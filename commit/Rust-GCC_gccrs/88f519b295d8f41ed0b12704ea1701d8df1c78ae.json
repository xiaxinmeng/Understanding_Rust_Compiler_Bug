{"sha": "88f519b295d8f41ed0b12704ea1701d8df1c78ae", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6ODhmNTE5YjI5NWQ4ZjQxZWQwYjEyNzA0ZWExNzAxZDhkZjFjNzhhZQ==", "commit": {"author": {"name": "Matthew Gretton-Dann", "email": "matthew.gretton-dann@linaro.org", "date": "2012-11-29T10:02:16Z"}, "committer": {"name": "Matthew Gretton-Dann", "email": "mgretton@gcc.gnu.org", "date": "2012-11-29T10:02:16Z"}, "message": "re PR target/54974 ([ARM] [thumb] Incorrect placement of constant pools)\n\n\tPR target/54974\n\t* config/arm/arm.md (thumb2_pool_range, pool_range): Add comment on\n\tThumb pool ranges.\n\t(thumb1_extendhisi2): Reduce Thumb pool range.\n\t(arm_movdi): Likewise.\n\t(thumb1_movdi_insn): Likewise.\n\t(thumb1_movsi_insn): Likewise.\n\t(pic_load_addr_unified): Likewise.\n\t(pic_load_addr_32bit): Likewise.\n\t(pic_load_addr_thumb1): Likewise.\n\t(thumb1_movhf): Likewise.\n\t(arm_movsf_soft_insn): Likewise.\n\t(thumb1_movsf_soft_insn): Likewise.\n\t(movdf_soft_insn): Likewise.\n\t(thumb1_movdf_soft_insn): Likewise.\n\t* config/arm/neon.md (*neon_mov<mode>): Likewise.\n\t(*neon_mov<mode>): Likwise.\n\t* config/arm/thumb2.md: (*thumb2_movsi_insn): Likewise.\n\t(*thumb2_movhi_insn): Likewise.\n\t(*thumb2_extendqisi_v6): Likewise.\n\t(*thumb2_zero_extendqisi_v6): Likewise.\n\t(*thumb2_zero_extendqisi2_v6): Likewise.\n\t* config/arm/vfp.md: (*thumb2_movsi_vfp): Likewise.\n\t(*movdi_vfp): Likewise.\n\t(*movdi_vfp_cortexa8): Likewise.\n\t(*thumb2_movsf_vfp): Likewise.\n\t(*thumb2_movdf_vfp): Likewise.\n\nFrom-SVN: r193930", "tree": {"sha": "5130bd0ebe351a795dd2640cf7ecc0b2df7c720e", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/5130bd0ebe351a795dd2640cf7ecc0b2df7c720e"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/88f519b295d8f41ed0b12704ea1701d8df1c78ae", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/88f519b295d8f41ed0b12704ea1701d8df1c78ae", "html_url": "https://github.com/Rust-GCC/gccrs/commit/88f519b295d8f41ed0b12704ea1701d8df1c78ae", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/88f519b295d8f41ed0b12704ea1701d8df1c78ae/comments", "author": null, "committer": null, "parents": [{"sha": "02f9e21a26d1b17ecc982e78471075f9fa70c09f", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/02f9e21a26d1b17ecc982e78471075f9fa70c09f", "html_url": "https://github.com/Rust-GCC/gccrs/commit/02f9e21a26d1b17ecc982e78471075f9fa70c09f"}], "stats": {"total": 90, "additions": 66, "deletions": 24}, "files": [{"sha": "adbf8ed24ec73f1b9e5d6070c6dc1bb64896b5c5", "filename": "gcc/ChangeLog", "status": "modified", "additions": 30, "deletions": 0, "changes": 30, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/88f519b295d8f41ed0b12704ea1701d8df1c78ae/gcc%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/88f519b295d8f41ed0b12704ea1701d8df1c78ae/gcc%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2FChangeLog?ref=88f519b295d8f41ed0b12704ea1701d8df1c78ae", "patch": "@@ -1,3 +1,33 @@\n+2012-11-29  Matthew Gretton-Dann  <matthew.gretton-dann@linaro.org>\n+\n+\tPR target/54974\n+\t* config/arm/arm.md (thumb2_pool_range, pool_range): Add comment on\n+\tThumb pool ranges.\n+\t(thumb1_extendhisi2): Reduce Thumb pool range.\n+\t(arm_movdi): Likewise.\n+\t(thumb1_movdi_insn): Likewise.\n+\t(thumb1_movsi_insn): Likewise.\n+\t(pic_load_addr_unified): Likewise.\n+\t(pic_load_addr_32bit): Likewise.\n+\t(pic_load_addr_thumb1): Likewise.\n+\t(thumb1_movhf): Likewise.\n+\t(arm_movsf_soft_insn): Likewise.\n+\t(thumb1_movsf_soft_insn): Likewise.\n+\t(movdf_soft_insn): Likewise.\n+\t(thumb1_movdf_soft_insn): Likewise.\n+\t* config/arm/neon.md (*neon_mov<mode>): Likewise.\n+\t(*neon_mov<mode>): Likwise.\n+\t* config/arm/thumb2.md: (*thumb2_movsi_insn): Likewise.\n+\t(*thumb2_movhi_insn): Likewise.\n+\t(*thumb2_extendqisi_v6): Likewise.\n+\t(*thumb2_zero_extendqisi_v6): Likewise.\n+\t(*thumb2_zero_extendqisi2_v6): Likewise.\n+\t* config/arm/vfp.md: (*thumb2_movsi_vfp): Likewise.\n+\t(*movdi_vfp): Likewise.\n+\t(*movdi_vfp_cortexa8): Likewise.\n+\t(*thumb2_movsf_vfp): Likewise.\n+\t(*thumb2_movdf_vfp): Likewise.\n+\n 2012-11-29  Kai Tietz  <ktietz@redhat.com>\n \n \tPR target/55171"}, {"sha": "da8e0b2b822584be5d36c9d9c56f872124d2f6dc", "filename": "gcc/config/arm/arm.md", "status": "modified", "additions": 20, "deletions": 12, "changes": 32, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/88f519b295d8f41ed0b12704ea1701d8df1c78ae/gcc%2Fconfig%2Farm%2Farm.md", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/88f519b295d8f41ed0b12704ea1701d8df1c78ae/gcc%2Fconfig%2Farm%2Farm.md", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fconfig%2Farm%2Farm.md?ref=88f519b295d8f41ed0b12704ea1701d8df1c78ae", "patch": "@@ -297,6 +297,9 @@\n ; POOL_RANGE is how far away from a constant pool entry that this insn\n ; can be placed.  If the distance is zero, then this insn will never\n ; reference the pool.\n+; Note that for Thumb constant pools the PC value is rounded down to the\n+; nearest multiple of four.  Therefore, THUMB2_POOL_RANGE (and POOL_RANGE for\n+; Thumb insns) should be set to <max_range> - 2.\n ; NEG_POOL_RANGE is nonzero for insns that can reference a constant pool entry\n ; before its address.  It is set to <max_range> - (8 + <data_size>).\n (define_attr \"arm_pool_range\" \"\" (const_int 0))\n@@ -4966,7 +4969,7 @@\n \t\t\t\t\t(const_int 2) (const_int 4))\n \t\t\t  (const_int 4)])\n    (set_attr \"type\" \"alu_shift,load_byte\")\n-   (set_attr \"pool_range\" \"*,1020\")]\n+   (set_attr \"pool_range\" \"*,1018\")]\n )\n \n ;; This pattern will only be used when ldsh is not available\n@@ -5373,7 +5376,7 @@\n    (set_attr \"type\" \"*,*,*,load2,store2\")\n    (set_attr \"arm_pool_range\" \"*,*,*,1020,*\")\n    (set_attr \"arm_neg_pool_range\" \"*,*,*,1004,*\")\n-   (set_attr \"thumb2_pool_range\" \"*,*,*,4096,*\")\n+   (set_attr \"thumb2_pool_range\" \"*,*,*,4094,*\")\n    (set_attr \"thumb2_neg_pool_range\" \"*,*,*,0,*\")]\n )\n \n@@ -5512,7 +5515,7 @@\n   [(set_attr \"length\" \"4,4,6,2,2,6,4,4\")\n    (set_attr \"type\" \"*,*,*,load2,store2,load2,store2,*\")\n    (set_attr \"insn\" \"*,mov,*,*,*,*,*,mov\")\n-   (set_attr \"pool_range\" \"*,*,*,*,*,1020,*,*\")]\n+   (set_attr \"pool_range\" \"*,*,*,*,*,1018,*,*\")]\n )\n \n (define_expand \"movsi\"\n@@ -5682,7 +5685,7 @@\n    mov\\\\t%0, %1\"\n   [(set_attr \"length\" \"2,2,4,4,2,2,2,2,2\")\n    (set_attr \"type\" \"*,*,*,*,load1,store1,load1,store1,*\")\n-   (set_attr \"pool_range\" \"*,*,*,*,*,*,1020,*,*\")\n+   (set_attr \"pool_range\" \"*,*,*,*,*,*,1018,*,*\")\n    (set_attr \"conds\" \"set,clob,*,*,nocond,nocond,nocond,nocond,nocond\")])\n \n (define_split \n@@ -5790,7 +5793,7 @@\n        \t\t     \t\t (match_dup 2)] UNSPEC_PIC_BASE))]\n  \"operands[3] = TARGET_THUMB ? GEN_INT (4) : GEN_INT (8);\"\n  [(set_attr \"type\" \"load1,load1,load1\")\n-  (set_attr \"pool_range\" \"4096,4096,1024\")\n+  (set_attr \"pool_range\" \"4096,4094,1022\")\n   (set_attr \"neg_pool_range\" \"4084,0,0\")\n   (set_attr \"arch\"  \"a,t2,t1\")    \n   (set_attr \"length\" \"8,6,4\")]\n@@ -5806,7 +5809,10 @@\n   \"TARGET_32BIT && flag_pic\"\n   \"ldr%?\\\\t%0, %1\"\n   [(set_attr \"type\" \"load1\")\n-   (set_attr \"pool_range\" \"4096\")\n+   (set (attr \"pool_range\")\n+\t(if_then_else (eq_attr \"is_thumb\" \"no\")\n+\t\t      (const_int 4096)\n+\t\t      (const_int 4094)))\n    (set (attr \"neg_pool_range\")\n \t(if_then_else (eq_attr \"is_thumb\" \"no\")\n \t\t      (const_int 4084)\n@@ -5819,7 +5825,7 @@\n   \"TARGET_THUMB1 && flag_pic\"\n   \"ldr\\\\t%0, %1\"\n   [(set_attr \"type\" \"load1\")\n-   (set (attr \"pool_range\") (const_int 1024))]\n+   (set (attr \"pool_range\") (const_int 1018))]\n )\n \n (define_insn \"pic_add_dot_plus_four\"\n@@ -6614,7 +6620,7 @@\n   [(set_attr \"length\" \"2\")\n    (set_attr \"type\" \"*,load1,store1,*,*\")\n    (set_attr \"insn\" \"mov,*,*,mov,mov\")\n-   (set_attr \"pool_range\" \"*,1020,*,*,*\")\n+   (set_attr \"pool_range\" \"*,1018,*,*,*\")\n    (set_attr \"conds\" \"clob,nocond,nocond,nocond,nocond\")])\n \n (define_expand \"movsf\"\n@@ -6669,7 +6675,8 @@\n   [(set_attr \"predicable\" \"yes\")\n    (set_attr \"type\" \"*,load1,store1\")\n    (set_attr \"insn\" \"mov,*,*\")\n-   (set_attr \"pool_range\" \"*,4096,*\")\n+   (set_attr \"arm_pool_range\" \"*,4096,*\")\n+   (set_attr \"thumb2_pool_range\" \"*,4094,*\")\n    (set_attr \"arm_neg_pool_range\" \"*,4084,*\")\n    (set_attr \"thumb2_neg_pool_range\" \"*,0,*\")]\n )\n@@ -6691,7 +6698,7 @@\n    mov\\\\t%0, %1\"\n   [(set_attr \"length\" \"2\")\n    (set_attr \"type\" \"*,load1,store1,load1,store1,*,*\")\n-   (set_attr \"pool_range\" \"*,*,*,1020,*,*,*\")\n+   (set_attr \"pool_range\" \"*,*,*,1018,*,*,*\")\n    (set_attr \"insn\" \"*,*,*,*,*,mov,mov\")\n    (set_attr \"conds\" \"clob,nocond,nocond,nocond,nocond,nocond,nocond\")]\n )\n@@ -6780,7 +6787,8 @@\n   \"\n   [(set_attr \"length\" \"8,12,16,8,8\")\n    (set_attr \"type\" \"*,*,*,load2,store2\")\n-   (set_attr \"pool_range\" \"*,*,*,1020,*\")\n+   (set_attr \"arm_pool_range\" \"*,*,*,1020,*\")\n+   (set_attr \"thumb2_pool_range\" \"*,*,*,1018,*\")\n    (set_attr \"arm_neg_pool_range\" \"*,*,*,1004,*\")\n    (set_attr \"thumb2_neg_pool_range\" \"*,*,*,0,*\")]\n )\n@@ -6824,7 +6832,7 @@\n   [(set_attr \"length\" \"4,2,2,6,4,4\")\n    (set_attr \"type\" \"*,load2,store2,load2,store2,*\")\n    (set_attr \"insn\" \"*,*,*,*,*,mov\")\n-   (set_attr \"pool_range\" \"*,*,*,1020,*,*\")]\n+   (set_attr \"pool_range\" \"*,*,*,1018,*,*\")]\n )\n \f\n "}, {"sha": "8f84795334b7ccc9b811f7cd8c086394b30e3090", "filename": "gcc/config/arm/neon.md", "status": "modified", "additions": 4, "deletions": 2, "changes": 6, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/88f519b295d8f41ed0b12704ea1701d8df1c78ae/gcc%2Fconfig%2Farm%2Fneon.md", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/88f519b295d8f41ed0b12704ea1701d8df1c78ae/gcc%2Fconfig%2Farm%2Fneon.md", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fconfig%2Farm%2Fneon.md?ref=88f519b295d8f41ed0b12704ea1701d8df1c78ae", "patch": "@@ -196,7 +196,8 @@\n   (set_attr \"type\" \"*,f_stored,*,f_loadd,*,*,alu,load2,store2\")\n   (set_attr \"insn\" \"*,*,*,*,*,*,mov,*,*\")\n   (set_attr \"length\" \"4,4,4,4,4,4,8,8,8\")\n-  (set_attr \"pool_range\"     \"*,*,*,1020,*,*,*,1020,*\")\n+  (set_attr \"arm_pool_range\"     \"*,*,*,1020,*,*,*,1020,*\")\n+  (set_attr \"thumb2_pool_range\"     \"*,*,*,1018,*,*,*,1018,*\")\n   (set_attr \"neg_pool_range\" \"*,*,*,1004,*,*,*,1004,*\")])\n \n (define_insn \"*neon_mov<mode>\"\n@@ -241,7 +242,8 @@\n    (set_attr \"type\" \"*,*,*,*,*,*,alu,load4,store4\")\n    (set_attr \"insn\" \"*,*,*,*,*,*,mov,*,*\")\n    (set_attr \"length\" \"4,8,4,8,8,8,16,8,16\")\n-   (set_attr \"pool_range\" \"*,*,*,1020,*,*,*,1020,*\")\n+   (set_attr \"arm_pool_range\" \"*,*,*,1020,*,*,*,1020,*\")\n+   (set_attr \"thumb2_pool_range\" \"*,*,*,1018,*,*,*,1018,*\")\n    (set_attr \"neg_pool_range\" \"*,*,*,996,*,*,*,996,*\")])\n \n (define_expand \"movti\""}, {"sha": "fe150c70f227b33c4187a966e28ca148e3fd5eac", "filename": "gcc/config/arm/thumb2.md", "status": "modified", "additions": 5, "deletions": 5, "changes": 10, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/88f519b295d8f41ed0b12704ea1701d8df1c78ae/gcc%2Fconfig%2Farm%2Fthumb2.md", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/88f519b295d8f41ed0b12704ea1701d8df1c78ae/gcc%2Fconfig%2Farm%2Fthumb2.md", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fconfig%2Farm%2Fthumb2.md?ref=88f519b295d8f41ed0b12704ea1701d8df1c78ae", "patch": "@@ -182,7 +182,7 @@\n    str%?\\\\t%1, %0\"\n   [(set_attr \"type\" \"*,*,*,*,load1,load1,store1,store1\")\n    (set_attr \"predicable\" \"yes\")\n-   (set_attr \"pool_range\" \"*,*,*,*,1020,4096,*,*\")\n+   (set_attr \"pool_range\" \"*,*,*,*,1018,4094,*,*\")\n    (set_attr \"neg_pool_range\" \"*,*,*,*,0,0,*,*\")]\n )\n \n@@ -217,7 +217,7 @@\n    ldr%(h%)\\\\t%0, %1\\\\t%@ movhi\"\n   [(set_attr \"type\" \"*,*,store1,load1\")\n    (set_attr \"predicable\" \"yes\")\n-   (set_attr \"pool_range\" \"*,*,*,4096\")\n+   (set_attr \"pool_range\" \"*,*,*,4094\")\n    (set_attr \"neg_pool_range\" \"*,*,*,250\")]\n )\n \n@@ -570,7 +570,7 @@\n    ldr%(sb%)\\\\t%0, %1\"\n   [(set_attr \"type\" \"alu_shift,load_byte\")\n    (set_attr \"predicable\" \"yes\")\n-   (set_attr \"pool_range\" \"*,4096\")\n+   (set_attr \"pool_range\" \"*,4094\")\n    (set_attr \"neg_pool_range\" \"*,250\")]\n )\n \n@@ -583,7 +583,7 @@\n    ldr%(h%)\\\\t%0, %1\"\n   [(set_attr \"type\" \"alu_shift,load_byte\")\n    (set_attr \"predicable\" \"yes\")\n-   (set_attr \"pool_range\" \"*,4096\")\n+   (set_attr \"pool_range\" \"*,4094\")\n    (set_attr \"neg_pool_range\" \"*,250\")]\n )\n \n@@ -596,7 +596,7 @@\n    ldr%(b%)\\\\t%0, %1\\\\t%@ zero_extendqisi2\"\n   [(set_attr \"type\" \"alu_shift,load_byte\")\n    (set_attr \"predicable\" \"yes\")\n-   (set_attr \"pool_range\" \"*,4096\")\n+   (set_attr \"pool_range\" \"*,4094\")\n    (set_attr \"neg_pool_range\" \"*,250\")]\n )\n "}, {"sha": "98e76c702d3cbed3464a062745b1107f3474b382", "filename": "gcc/config/arm/vfp.md", "status": "modified", "additions": 7, "deletions": 5, "changes": 12, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/88f519b295d8f41ed0b12704ea1701d8df1c78ae/gcc%2Fconfig%2Farm%2Fvfp.md", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/88f519b295d8f41ed0b12704ea1701d8df1c78ae/gcc%2Fconfig%2Farm%2Fvfp.md", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fconfig%2Farm%2Fvfp.md?ref=88f519b295d8f41ed0b12704ea1701d8df1c78ae", "patch": "@@ -123,7 +123,7 @@\n    (set_attr \"type\" \"*,*,*,*,load1,load1,store1,store1,r_2_f,f_2_r,fcpys,f_loads,f_stores\")\n    (set_attr \"neon_type\" \"*,*,*,*,*,*,*,*,neon_mcr,neon_mrc,neon_vmov,*,*\")\n    (set_attr \"insn\" \"mov,mov,mvn,mov,*,*,*,*,*,*,*,*,*\")\n-   (set_attr \"pool_range\"     \"*,*,*,*,1020,4096,*,*,*,*,*,1020,*\")\n+   (set_attr \"pool_range\"     \"*,*,*,*,1018,4094,*,*,*,*,*,1018,*\")\n    (set_attr \"neg_pool_range\" \"*,*,*,*,   0,   0,*,*,*,*,*,1008,*\")]\n )\n \n@@ -176,7 +176,8 @@\n                                  (const_int 8)\n                                  (const_int 4))]\n                               (const_int 4)))\n-   (set_attr \"pool_range\"     \"*,*,*,*,1020,4096,*,*,*,*,1020,*\")\n+   (set_attr \"arm_pool_range\"     \"*,*,*,*,1020,4096,*,*,*,*,1020,*\")\n+   (set_attr \"thumb2_pool_range\"     \"*,*,*,*,1018,4094,*,*,*,*,1018,*\")\n    (set_attr \"neg_pool_range\" \"*,*,*,*,1004,0,*,*,*,*,1004,*\")\n    (set_attr \"arch\"           \"t2,any,any,any,a,t2,any,any,any,any,any,any\")]\n )\n@@ -224,7 +225,8 @@\n                                  * 4\")]\n                               (const_int 4)))\n    (set_attr \"predicable\"    \"yes\")\n-   (set_attr \"pool_range\"     \"*,*,*,*,1020,4096,*,*,*,*,1020,*\")\n+   (set_attr \"arm_pool_range\"     \"*,*,*,*,1018,4094,*,*,*,*,1018,*\")\n+   (set_attr \"thumb2_pool_range\"     \"*,*,*,*,1018,4094,*,*,*,*,1018,*\")\n    (set_attr \"neg_pool_range\" \"*,*,*,*,1004,0,*,*,*,*,1004,*\")\n    (set (attr \"ce_count\") \n \t(symbol_ref \"get_attr_length (insn) / 4\"))\n@@ -413,7 +415,7 @@\n      \"r_2_f,f_2_r,fconsts,f_loads,f_stores,load1,store1,fcpys,*\")\n    (set_attr \"neon_type\" \"neon_mcr,neon_mrc,*,*,*,*,*,neon_vmov,*\")\n    (set_attr \"insn\" \"*,*,*,*,*,*,*,*,mov\")\n-   (set_attr \"pool_range\" \"*,*,*,1020,*,4092,*,*,*\")\n+   (set_attr \"pool_range\" \"*,*,*,1018,*,4090,*,*,*\")\n    (set_attr \"neg_pool_range\" \"*,*,*,1008,*,0,*,*,*\")]\n )\n \n@@ -509,7 +511,7 @@\n \t\t\t\t (const_int 8)\n \t\t\t\t (const_int 4))]\n \t\t\t      (const_int 4)))\n-   (set_attr \"pool_range\" \"*,*,*,1020,*,4096,*,*,*\")\n+   (set_attr \"pool_range\" \"*,*,*,1018,*,4094,*,*,*\")\n    (set_attr \"neg_pool_range\" \"*,*,*,1008,*,0,*,*,*\")]\n )\n "}]}