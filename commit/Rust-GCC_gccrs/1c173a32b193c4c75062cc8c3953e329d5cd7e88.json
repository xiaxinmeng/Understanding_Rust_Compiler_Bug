{"sha": "1c173a32b193c4c75062cc8c3953e329d5cd7e88", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6MWMxNzNhMzJiMTkzYzRjNzUwNjJjYzhjMzk1M2UzMjlkNWNkN2U4OA==", "commit": {"author": {"name": "Uros Bizjak", "email": "ubizjak@gmail.com", "date": "2014-09-21T15:13:14Z"}, "committer": {"name": "Uros Bizjak", "email": "uros@gcc.gnu.org", "date": "2014-09-21T15:13:14Z"}, "message": "i386.c (ix86_expand_call): Generate MS->SYSV extra clobbered registers using clobber_reg.\n\n\t* config/i386/i386.c (ix86_expand_call): Generate MS->SYSV extra\n\tclobbered registers using clobber_reg.  Remove UNSPEC decoration.\n\t* config/i386/i386.md (unspec) <UNSPEC_MS_TO_SYSV_CALL>: Remove.\n\t(*call_rex64_ms_sysv): Remove.\n\t(*call_value_rex64_ms_sysv): Ditto.\n\t* config/i386/predicates.md (call_rex64_ms_sysv_operation): Remove.\n\ntestsuite/ChangeLog:\n\n\t* gcc.target/i386/avx-vzeroupper-16.c (dg-final): Remove check\n\tfor call_value_rex64_ms_sysv.\n\t* gcc.target/i386/avx-vzeroupper-17.c (dg-final): Ditto.\n\t* gcc.target/i386/avx-vzeroupper-18.c (dg-final): Remove check\n\tfor call_rex64_ms_sysv.\n\nFrom-SVN: r215428", "tree": {"sha": "d1a5ebfb093cb66d6fd22ec255f0f3ce2ed508ca", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/d1a5ebfb093cb66d6fd22ec255f0f3ce2ed508ca"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/1c173a32b193c4c75062cc8c3953e329d5cd7e88", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/1c173a32b193c4c75062cc8c3953e329d5cd7e88", "html_url": "https://github.com/Rust-GCC/gccrs/commit/1c173a32b193c4c75062cc8c3953e329d5cd7e88", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/1c173a32b193c4c75062cc8c3953e329d5cd7e88/comments", "author": {"login": "ubizjak", "id": 55479990, "node_id": "MDQ6VXNlcjU1NDc5OTkw", "avatar_url": "https://avatars.githubusercontent.com/u/55479990?v=4", "gravatar_id": "", "url": "https://api.github.com/users/ubizjak", "html_url": "https://github.com/ubizjak", "followers_url": "https://api.github.com/users/ubizjak/followers", "following_url": "https://api.github.com/users/ubizjak/following{/other_user}", "gists_url": "https://api.github.com/users/ubizjak/gists{/gist_id}", "starred_url": "https://api.github.com/users/ubizjak/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/ubizjak/subscriptions", "organizations_url": "https://api.github.com/users/ubizjak/orgs", "repos_url": "https://api.github.com/users/ubizjak/repos", "events_url": "https://api.github.com/users/ubizjak/events{/privacy}", "received_events_url": "https://api.github.com/users/ubizjak/received_events", "type": "User", "site_admin": false}, "committer": null, "parents": [{"sha": "1dc7b1f2086931a2b885ebb3cd09cc7a7639c276", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/1dc7b1f2086931a2b885ebb3cd09cc7a7639c276", "html_url": "https://github.com/Rust-GCC/gccrs/commit/1dc7b1f2086931a2b885ebb3cd09cc7a7639c276"}], "stats": {"total": 84, "additions": 22, "deletions": 62}, "files": [{"sha": "b60797c077522f321f000193a63e2c6730386397", "filename": "gcc/ChangeLog", "status": "modified", "additions": 9, "deletions": 0, "changes": 9, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/1c173a32b193c4c75062cc8c3953e329d5cd7e88/gcc%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/1c173a32b193c4c75062cc8c3953e329d5cd7e88/gcc%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2FChangeLog?ref=1c173a32b193c4c75062cc8c3953e329d5cd7e88", "patch": "@@ -1,3 +1,12 @@\n+2014-09-21  Uros Bizjak  <ubizjak@gmail.com>\n+\n+\t* config/i386/i386.c (ix86_expand_call): Generate MS->SYSV extra\n+\tclobbered registers using clobber_reg.  Remove UNSPEC decoration.\n+\t* config/i386/i386.md (unspec) <UNSPEC_MS_TO_SYSV_CALL>: Remove.\n+\t(*call_rex64_ms_sysv): Remove.\n+\t(*call_value_rex64_ms_sysv): Ditto.\n+\t* config/i386/predicates.md (call_rex64_ms_sysv_operation): Remove.\n+\n 2014-09-20  Joern Rennecke  <joern.rennecke@embecosm.com>\n \n \t* config/epiphany/epiphany.md (sub_f_add_imm): Change constraint of"}, {"sha": "c9324367c2b0ef3f831b325f320eae93a1595faa", "filename": "gcc/config/i386/i386.c", "status": "modified", "additions": 5, "deletions": 9, "changes": 14, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/1c173a32b193c4c75062cc8c3953e329d5cd7e88/gcc%2Fconfig%2Fi386%2Fi386.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/1c173a32b193c4c75062cc8c3953e329d5cd7e88/gcc%2Fconfig%2Fi386%2Fi386.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fconfig%2Fi386%2Fi386.c?ref=1c173a32b193c4c75062cc8c3953e329d5cd7e88", "patch": "@@ -24865,9 +24865,7 @@ ix86_expand_call (rtx retval, rtx fnaddr, rtx callarg1,\n \t\t  rtx callarg2,\n \t\t  rtx pop, bool sibcall)\n {\n-  unsigned int const cregs_size\n-    = ARRAY_SIZE (x86_64_ms_sysv_extra_clobbered_registers);\n-  rtx vec[3 + cregs_size];\n+  rtx vec[3];\n   rtx use = NULL, call;\n   unsigned int vec_len = 0;\n \n@@ -24930,18 +24928,16 @@ ix86_expand_call (rtx retval, rtx fnaddr, rtx callarg1,\n   if (TARGET_64BIT_MS_ABI\n       && (!callarg2 || INTVAL (callarg2) != -2))\n     {\n-      unsigned i;\n-\n-      vec[vec_len++] = gen_rtx_UNSPEC (VOIDmode, gen_rtvec (1, const0_rtx),\n-\t\t\t\t       UNSPEC_MS_TO_SYSV_CALL);\n+      int const cregs_size\n+\t= ARRAY_SIZE (x86_64_ms_sysv_extra_clobbered_registers);\n+      int i;\n \n       for (i = 0; i < cregs_size; i++)\n \t{\n \t  int regno = x86_64_ms_sysv_extra_clobbered_registers[i];\n \t  enum machine_mode mode = SSE_REGNO_P (regno) ? TImode : DImode;\n \n-\t  vec[vec_len++]\n-\t    = gen_rtx_CLOBBER (VOIDmode, gen_rtx_REG (mode, regno));\n+\t  clobber_reg (&use, gen_rtx_REG (mode, regno));\n \t}\n     }\n "}, {"sha": "004302df4f0b1b7c2885869ec67a613c5feab5a0", "filename": "gcc/config/i386/i386.md", "status": "modified", "additions": 0, "deletions": 20, "changes": 20, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/1c173a32b193c4c75062cc8c3953e329d5cd7e88/gcc%2Fconfig%2Fi386%2Fi386.md", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/1c173a32b193c4c75062cc8c3953e329d5cd7e88/gcc%2Fconfig%2Fi386%2Fi386.md", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fconfig%2Fi386%2Fi386.md?ref=1c173a32b193c4c75062cc8c3953e329d5cd7e88", "patch": "@@ -106,7 +106,6 @@\n   UNSPEC_LD_MPIC\t; load_macho_picbase\n   UNSPEC_TRUNC_NOOP\n   UNSPEC_DIV_ALREADY_SPLIT\n-  UNSPEC_MS_TO_SYSV_CALL\n   UNSPEC_PAUSE\n   UNSPEC_LEA_ADDR\n   UNSPEC_XBEGIN_ABORT\n@@ -11477,15 +11476,6 @@\n   \"* return ix86_output_call_insn (insn, operands[0]);\"\n   [(set_attr \"type\" \"call\")])\n \n-(define_insn \"*call_rex64_ms_sysv\"\n-  [(match_parallel 2 \"call_rex64_ms_sysv_operation\"\n-    [(call (mem:QI (match_operand:DI 0 \"call_insn_operand\" \"rBwBz\"))\n-\t   (match_operand 1))\n-     (unspec [(const_int 0)] UNSPEC_MS_TO_SYSV_CALL)])]\n-  \"TARGET_64BIT && !SIBLING_CALL_P (insn)\"\n-  \"* return ix86_output_call_insn (insn, operands[0]);\"\n-  [(set_attr \"type\" \"call\")])\n-\n (define_insn \"*sibcall\"\n   [(call (mem:QI (match_operand:W 0 \"sibcall_insn_operand\" \"UBsBz\"))\n \t (match_operand 1))]\n@@ -11693,16 +11683,6 @@\n \t\t\t (match_dup 3)))\n \t      (unspec [(const_int 0)] UNSPEC_PEEPSIB)])])\n \n-(define_insn \"*call_value_rex64_ms_sysv\"\n-  [(match_parallel 3 \"call_rex64_ms_sysv_operation\"\n-    [(set (match_operand 0)\n-\t  (call (mem:QI (match_operand:DI 1 \"call_insn_operand\" \"rBwBz\"))\n-\t\t(match_operand 2)))\n-     (unspec [(const_int 0)] UNSPEC_MS_TO_SYSV_CALL)])]\n- \"TARGET_64BIT && !SIBLING_CALL_P (insn)\"\n-  \"* return ix86_output_call_insn (insn, operands[1]);\"\n-  [(set_attr \"type\" \"callv\")])\n-\n (define_expand \"call_value_pop\"\n   [(parallel [(set (match_operand 0)\n \t\t   (call (match_operand:QI 1)"}, {"sha": "690bed5f70b3286c2fefeb94e60fd6b4ad6f0b8d", "filename": "gcc/config/i386/predicates.md", "status": "modified", "additions": 0, "deletions": 30, "changes": 30, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/1c173a32b193c4c75062cc8c3953e329d5cd7e88/gcc%2Fconfig%2Fi386%2Fpredicates.md", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/1c173a32b193c4c75062cc8c3953e329d5cd7e88/gcc%2Fconfig%2Fi386%2Fpredicates.md", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fconfig%2Fi386%2Fpredicates.md?ref=1c173a32b193c4c75062cc8c3953e329d5cd7e88", "patch": "@@ -609,36 +609,6 @@\n        (and (not (match_test \"TARGET_X32\"))\n \t    (match_operand 0 \"sibcall_memory_operand\"))))\n \n-;; Return true if OP is a call from MS ABI to SYSV ABI function.\n-(define_predicate \"call_rex64_ms_sysv_operation\"\n-  (match_code \"parallel\")\n-{\n-  unsigned creg_size = ARRAY_SIZE (x86_64_ms_sysv_extra_clobbered_registers);\n-  unsigned i;\n-\n-  if ((unsigned) XVECLEN (op, 0) != creg_size + 2)\n-    return false;\n-\n-  for (i = 0; i < creg_size; i++)\n-    {\n-      rtx elt = XVECEXP (op, 0, i+2);\n-      enum machine_mode mode;\n-      unsigned regno;\n-\n-      if (GET_CODE (elt) != CLOBBER\n-          || GET_CODE (SET_DEST (elt)) != REG)\n-        return false;\n-\n-      regno = x86_64_ms_sysv_extra_clobbered_registers[i];\n-      mode = SSE_REGNO_P (regno) ? TImode : DImode;\n-\n-      if (GET_MODE (SET_DEST (elt)) != mode\n-\t  || REGNO (SET_DEST (elt)) != regno)\n-\treturn false;\n-    }\n-  return true;\n-})\n-\n ;; Match exactly zero.\n (define_predicate \"const0_operand\"\n   (match_code \"const_int,const_double,const_vector\")"}, {"sha": "61b15e087576e7b0c8bf910ac3779099dbf8c780", "filename": "gcc/testsuite/ChangeLog", "status": "modified", "additions": 8, "deletions": 0, "changes": 8, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/1c173a32b193c4c75062cc8c3953e329d5cd7e88/gcc%2Ftestsuite%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/1c173a32b193c4c75062cc8c3953e329d5cd7e88/gcc%2Ftestsuite%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2FChangeLog?ref=1c173a32b193c4c75062cc8c3953e329d5cd7e88", "patch": "@@ -1,3 +1,11 @@\n+2014-09-21  Uros Bizjak  <ubizjak@gmail.com>\n+\n+\t* gcc.target/i386/avx-vzeroupper-16.c (dg-final): Remove check\n+\tfor call_value_rex64_ms_sysv.\n+\t* gcc.target/i386/avx-vzeroupper-17.c (dg-final): Ditto.\n+\t* gcc.target/i386/avx-vzeroupper-18.c (dg-final): Remove check\n+\tfor call_rex64_ms_sysv.\n+\n 2014-09-20  Alessandro Fanfarillo  <fanfarillo.gcc@gmail.com>\n \t    Tobias Burnus  <burnus@net-b.de>\n "}, {"sha": "f445a6910b2f264d0143e8effaa01492b1f08d9b", "filename": "gcc/testsuite/gcc.target/i386/avx-vzeroupper-16.c", "status": "modified", "additions": 0, "deletions": 1, "changes": 1, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/1c173a32b193c4c75062cc8c3953e329d5cd7e88/gcc%2Ftestsuite%2Fgcc.target%2Fi386%2Favx-vzeroupper-16.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/1c173a32b193c4c75062cc8c3953e329d5cd7e88/gcc%2Ftestsuite%2Fgcc.target%2Fi386%2Favx-vzeroupper-16.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgcc.target%2Fi386%2Favx-vzeroupper-16.c?ref=1c173a32b193c4c75062cc8c3953e329d5cd7e88", "patch": "@@ -14,4 +14,3 @@ foo (void)\n }\n \n /* { dg-final { scan-assembler-times \"avx_vzeroupper\" 1 } } */\n-/* { dg-final { scan-assembler-times \"\\\\*call_value_rex64_ms_sysv\" 1 } } */"}, {"sha": "6dc0dc053214768acb2c07d4ceeec67efdd64556", "filename": "gcc/testsuite/gcc.target/i386/avx-vzeroupper-17.c", "status": "modified", "additions": 0, "deletions": 1, "changes": 1, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/1c173a32b193c4c75062cc8c3953e329d5cd7e88/gcc%2Ftestsuite%2Fgcc.target%2Fi386%2Favx-vzeroupper-17.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/1c173a32b193c4c75062cc8c3953e329d5cd7e88/gcc%2Ftestsuite%2Fgcc.target%2Fi386%2Favx-vzeroupper-17.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgcc.target%2Fi386%2Favx-vzeroupper-17.c?ref=1c173a32b193c4c75062cc8c3953e329d5cd7e88", "patch": "@@ -14,4 +14,3 @@ foo (void)\n }\n \n /* { dg-final { scan-assembler-times \"avx_vzeroupper\" 1 } } */\n-/* { dg-final { scan-assembler-times \"\\\\*call_value_rex64_ms_sysv\" 1 } } */"}, {"sha": "0749181fd2b3171e481e52502361ead87441c6e3", "filename": "gcc/testsuite/gcc.target/i386/avx-vzeroupper-18.c", "status": "modified", "additions": 0, "deletions": 1, "changes": 1, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/1c173a32b193c4c75062cc8c3953e329d5cd7e88/gcc%2Ftestsuite%2Fgcc.target%2Fi386%2Favx-vzeroupper-18.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/1c173a32b193c4c75062cc8c3953e329d5cd7e88/gcc%2Ftestsuite%2Fgcc.target%2Fi386%2Favx-vzeroupper-18.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgcc.target%2Fi386%2Favx-vzeroupper-18.c?ref=1c173a32b193c4c75062cc8c3953e329d5cd7e88", "patch": "@@ -14,4 +14,3 @@ foo (void)\n }\n \n /* { dg-final { scan-assembler-not \"avx_vzeroupper\" } } */\n-/* { dg-final { scan-assembler-times \"\\\\*call_rex64_ms_sysv\" 1 } } */"}]}