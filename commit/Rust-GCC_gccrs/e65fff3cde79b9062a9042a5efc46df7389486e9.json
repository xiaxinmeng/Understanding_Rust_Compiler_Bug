{"sha": "e65fff3cde79b9062a9042a5efc46df7389486e9", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6ZTY1ZmZmM2NkZTc5YjkwNjJhOTA0MmE1ZWZjNDZkZjczODk0ODZlOQ==", "commit": {"author": {"name": "Manuel L\u00f3pez-Ib\u00e1\u00f1ez", "email": "manu@gcc.gnu.org", "date": "2007-01-19T16:04:57Z"}, "committer": {"name": "Manuel L\u00f3pez-Ib\u00e1\u00f1ez", "email": "manu@gcc.gnu.org", "date": "2007-01-19T16:04:57Z"}, "message": "re PR c++/17947 (bad warning with implicit conversion and __attribute__((deprecated)))\n\n2007-01-19  Manuel Lopez-Ibanez  <manu@gcc.gnu.org>\n\n\tPR c++/17947\n\t* toplev.c (warn_deprecated_use): Use %qD instead of %qs to\n\tprint the name of the declared identifier.\n\t\t\ntestsuite/\n\t* g++.dg/warn/deprecated.C: Update warning output.\n\t* g++.dg/warn/deprecated-2.C: Likewise.\n\t* g++.dg/warn/deprecated-3.C: New.\n\nFrom-SVN: r120969", "tree": {"sha": "5b96e701d3d706d8fc0921298755fa9474f24446", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/5b96e701d3d706d8fc0921298755fa9474f24446"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/e65fff3cde79b9062a9042a5efc46df7389486e9", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/e65fff3cde79b9062a9042a5efc46df7389486e9", "html_url": "https://github.com/Rust-GCC/gccrs/commit/e65fff3cde79b9062a9042a5efc46df7389486e9", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/e65fff3cde79b9062a9042a5efc46df7389486e9/comments", "author": null, "committer": null, "parents": [{"sha": "b0fede98c078674e4b953ec9644b11088878b08f", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/b0fede98c078674e4b953ec9644b11088878b08f", "html_url": "https://github.com/Rust-GCC/gccrs/commit/b0fede98c078674e4b953ec9644b11088878b08f"}], "stats": {"total": 58, "additions": 42, "deletions": 16}, "files": [{"sha": "6f9f257597ba3fbe3332d7a24e3ae880baf50933", "filename": "gcc/ChangeLog", "status": "modified", "additions": 6, "deletions": 0, "changes": 6, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/e65fff3cde79b9062a9042a5efc46df7389486e9/gcc%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/e65fff3cde79b9062a9042a5efc46df7389486e9/gcc%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2FChangeLog?ref=e65fff3cde79b9062a9042a5efc46df7389486e9", "patch": "@@ -1,3 +1,9 @@\n+2007-01-19  Manuel Lopez-Ibanez  <manu@gcc.gnu.org>\n+\n+\tPR c++/17947\n+\t* toplev.c (warn_deprecated_use): Use %qD instead of %qs to print\n+\tthe name of the declared identifier.\n+\t\t\n 2007-01-19  Dirk Mueller  <dmueller@suse.de>\n \n \t* config/i386.h (CONDITIONAL_REGISTER_USAGE): Store"}, {"sha": "34b02acefa82657d1072686bedcd58c09048c003", "filename": "gcc/testsuite/ChangeLog", "status": "modified", "additions": 7, "deletions": 0, "changes": 7, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/e65fff3cde79b9062a9042a5efc46df7389486e9/gcc%2Ftestsuite%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/e65fff3cde79b9062a9042a5efc46df7389486e9/gcc%2Ftestsuite%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2FChangeLog?ref=e65fff3cde79b9062a9042a5efc46df7389486e9", "patch": "@@ -1,3 +1,10 @@\n+2007-01-19  Manuel Lopez-Ibanez  <manu@gcc.gnu.org>\n+\n+\tPR c++/17947\n+\t* g++.dg/warn/deprecated.C: Update warning output.\n+\t* g++.dg/warn/deprecated-2.C: Likewise.\n+\t* g++.dg/warn/deprecated-3.C: New.\n+\t\n 2007-01-19  Nathan Sidwell  <nathan@codesourcery.com>\n \n \t* gcc.c-torture/execute/nestfunc-7.c: New."}, {"sha": "d79a7f9e6ac3671d5f1ac5e9cd75c09a4657a5c3", "filename": "gcc/testsuite/g++.dg/warn/deprecated-2.C", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/e65fff3cde79b9062a9042a5efc46df7389486e9/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Fwarn%2Fdeprecated-2.C", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/e65fff3cde79b9062a9042a5efc46df7389486e9/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Fwarn%2Fdeprecated-2.C", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Fwarn%2Fdeprecated-2.C?ref=e65fff3cde79b9062a9042a5efc46df7389486e9", "patch": "@@ -7,5 +7,5 @@ void func(void);\n void func(void) __attribute__((deprecated));\n \n void f(void) {\n-  func(); /* { dg-warning \"'func' is deprecated\" } */\n+  func(); /* { dg-warning \"'void func\\\\(\\\\)' is deprecated\" } */\n }"}, {"sha": "6087cc733fdd18a7a6d2a3810b43e83a38896d8d", "filename": "gcc/testsuite/g++.dg/warn/deprecated-3.C", "status": "added", "additions": 14, "deletions": 0, "changes": 14, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/e65fff3cde79b9062a9042a5efc46df7389486e9/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Fwarn%2Fdeprecated-3.C", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/e65fff3cde79b9062a9042a5efc46df7389486e9/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Fwarn%2Fdeprecated-3.C", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Fwarn%2Fdeprecated-3.C?ref=e65fff3cde79b9062a9042a5efc46df7389486e9", "patch": "@@ -0,0 +1,14 @@\n+/* PR 17947 bad warning with implicit conversion and __attribute__((deprecated)) */\n+/* { dg-do compile } */\n+/* { dg-options \"\" } */\n+\n+struct Foo\n+{\n+  operator int() __attribute__((deprecated));\n+};\n+\n+void g(void)\n+{\n+  Foo f;\n+  (int)f; // { dg-warning \"warning: 'Foo::operator int\\\\(\\\\)' is deprecated \\\\(declared at\" }\n+}"}, {"sha": "15e8475e787d21e282b9a8e248470f2779f49b4a", "filename": "gcc/testsuite/g++.dg/warn/deprecated.C", "status": "modified", "additions": 12, "deletions": 12, "changes": 24, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/e65fff3cde79b9062a9042a5efc46df7389486e9/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Fwarn%2Fdeprecated.C", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/e65fff3cde79b9062a9042a5efc46df7389486e9/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Fwarn%2Fdeprecated.C", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Fwarn%2Fdeprecated.C?ref=e65fff3cde79b9062a9042a5efc46df7389486e9", "patch": "@@ -50,28 +50,28 @@ int func1()\n    int x __attribute__ ((deprecated));\n    int y __attribute__ ((__deprecated__));\n    int z;\n-   int (*pf)() = f1;\t\t\t/* { dg-warning \"'f1' is deprecated\" \"\" } */\n+   int (*pf)() = f1;\t\t\t/* { dg-warning \"'INT1 f1\\\\(\\\\)' is deprecated\" \"\" } */\n \n    z = w + x + y + g1 + g2 + g3;\t/* { dg-warning \"'x' is deprecated\" \"\" } */\n    \t\t\t\t\t/* { dg-warning \"'y' is deprecated\" \"y\" { target *-*-* } 55 } */\n    \t\t\t\t\t/* { dg-warning \"'g2' is deprecated\" \"g2\" { target *-*-* } 55 } */\n    \t\t\t\t\t/* { dg-warning \"'g3' is deprecated\" \"g3\" { target *-*-* } 55 } */\n-   return f1(); \t\t\t/* { dg-warning \"'f1' is deprecated\" \"f1\" } */\n+   return f1(); \t\t\t/* { dg-warning \"'INT1 f1\\\\(\\\\)' is deprecated\" \"f1\" } */\n }\n \n int func2(S1 *p)\n {\n   S1 lp;\n   \n   if (p->field1)\n-     return p->field2;\t\t\t/* { dg-warning \"'field2' is deprecated\" \"\" } */\n-  else if (lp.field4)\t\t\t/* { dg-warning \"'field4' is deprecated\" \"\" } */\n+     return p->field2;\t\t\t/* { dg-warning \"'S1::field2' is deprecated\" \"\" } */\n+  else if (lp.field4)\t\t\t/* { dg-warning \"'S1::field4' is deprecated\" \"\" } */\n      return p->field3;\n   \n   p->u1.field5 = g1 + p->field7;\n-  p->u2.field9;\t\t\t\t/* { dg-warning \"'u2' is deprecated\" \"\" } */\n-  return p->u1.field6 + p->field8;\t/* { dg-warning \"'field6' is deprecated\" \"\" } */\n-  \t\t\t\t\t/* { dg-warning \"'field8' is deprecated\" \"field8\" { target *-*-* } 73 } */\n+  p->u2.field9;\t\t\t\t/* { dg-warning \"'S1::u2' is deprecated\" \"\" } */\n+  return p->u1.field6 + p->field8;\t/* { dg-warning \"'S1::<anonymous union>::field6' is deprecated\" \"\" } */\n+  \t\t\t\t\t/* { dg-warning \"'S1::field8' is deprecated\" \"field8\" { target *-*-* } 73 } */\n }\n \n struct SS1 {\n@@ -104,13 +104,13 @@ inline void T::member1(int) {}\n \n int T::member3(T *p)\n {\n-  p->member1(1);\t\t\t/* { dg-warning \"'member1' is deprecated\" \"\" } */\n-  (*p).member1(2);\t\t\t/* { dg-warning \"'member1' is deprecated\" \"\" } */\n-  p->member2(1);\t\t\t/* { dg-warning \"'member2' is deprecated\" \"\" } */\n-  (*p).member2(2);\t\t\t/* { dg-warning \"'member2' is deprecated\" \"\" } */\n+  p->member1(1);\t\t\t/* { dg-warning \"'void T::member1\\\\(int\\\\)' is deprecated\" \"\" } */\n+  (*p).member1(2);\t\t\t/* { dg-warning \"'void T::member1\\\\(int\\\\)' is deprecated\" \"\" } */\n+  p->member2(1);\t\t\t/* { dg-warning \"'void T::member2\\\\(INT1\\\\)' is deprecated\" \"\" } */\n+  (*p).member2(2);\t\t\t/* { dg-warning \"'void T::member2\\\\(INT1\\\\)' is deprecated\" \"\" } */\n   p->member3(p);\n   (*p).member3(p);\n-  return f1(); \t\t\t\t/* { dg-warning \"'f1' is deprecated\" \"\" } */\n+  return f1(); \t\t\t\t/* { dg-warning \"'INT1 f1\\\\(\\\\)' is deprecated\" \"\" } */\n }\n #endif\n "}, {"sha": "569dbfdc7475f110f9eef78b98d7fad0a86910f5", "filename": "gcc/toplev.c", "status": "modified", "additions": 2, "deletions": 3, "changes": 5, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/e65fff3cde79b9062a9042a5efc46df7389486e9/gcc%2Ftoplev.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/e65fff3cde79b9062a9042a5efc46df7389486e9/gcc%2Ftoplev.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftoplev.c?ref=e65fff3cde79b9062a9042a5efc46df7389486e9", "patch": "@@ -901,9 +901,8 @@ warn_deprecated_use (tree node)\n     {\n       expanded_location xloc = expand_location (DECL_SOURCE_LOCATION (node));\n       warning (OPT_Wdeprecated_declarations,\n-\t       \"%qs is deprecated (declared at %s:%d)\",\n-\t       IDENTIFIER_POINTER (DECL_NAME (node)),\n-\t       xloc.file, xloc.line);\n+\t       \"%qD is deprecated (declared at %s:%d)\",\n+\t       node, xloc.file, xloc.line);\n     }\n   else if (TYPE_P (node))\n     {"}]}