{"sha": "5c43016f2d1bdbf9ac2be60fcec6209d4f12416e", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6NWM0MzAxNmYyZDFiZGJmOWFjMmJlNjBmY2VjNjIwOWQ0ZjEyNDE2ZQ==", "commit": {"author": {"name": "Jakub Jelinek", "email": "jakub@redhat.com", "date": "2011-11-30T22:00:28Z"}, "committer": {"name": "Jakub Jelinek", "email": "jakub@gcc.gnu.org", "date": "2011-11-30T22:00:28Z"}, "message": "re PR target/50725 (-O3 -mstackrealign -march=core2 generates invalid prologue code in callee procedure)\n\n\tPR target/50725\n\t* function.c (thread_prologue_and_epilogue_insns): If\n\tstack_realign_drap, add drap_reg to SET_UP_BY_PROLOGUE\n\tregset.\n\n\t* gcc.target/i386/pr50725.c: New test.\n\nFrom-SVN: r181860", "tree": {"sha": "e9143362523d9ba8243ee089723d2b1ee9ef5754", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/e9143362523d9ba8243ee089723d2b1ee9ef5754"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/5c43016f2d1bdbf9ac2be60fcec6209d4f12416e", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/5c43016f2d1bdbf9ac2be60fcec6209d4f12416e", "html_url": "https://github.com/Rust-GCC/gccrs/commit/5c43016f2d1bdbf9ac2be60fcec6209d4f12416e", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/5c43016f2d1bdbf9ac2be60fcec6209d4f12416e/comments", "author": {"login": "jakubjelinek", "id": 9370665, "node_id": "MDQ6VXNlcjkzNzA2NjU=", "avatar_url": "https://avatars.githubusercontent.com/u/9370665?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jakubjelinek", "html_url": "https://github.com/jakubjelinek", "followers_url": "https://api.github.com/users/jakubjelinek/followers", "following_url": "https://api.github.com/users/jakubjelinek/following{/other_user}", "gists_url": "https://api.github.com/users/jakubjelinek/gists{/gist_id}", "starred_url": "https://api.github.com/users/jakubjelinek/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jakubjelinek/subscriptions", "organizations_url": "https://api.github.com/users/jakubjelinek/orgs", "repos_url": "https://api.github.com/users/jakubjelinek/repos", "events_url": "https://api.github.com/users/jakubjelinek/events{/privacy}", "received_events_url": "https://api.github.com/users/jakubjelinek/received_events", "type": "User", "site_admin": false}, "committer": null, "parents": [{"sha": "336ead04abf0b0cf45dbcc1172e35330a5fded40", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/336ead04abf0b0cf45dbcc1172e35330a5fded40", "html_url": "https://github.com/Rust-GCC/gccrs/commit/336ead04abf0b0cf45dbcc1172e35330a5fded40"}], "stats": {"total": 59, "additions": 59, "deletions": 0}, "files": [{"sha": "66093b15d5b86c6be294f18454c64d004301332b", "filename": "gcc/ChangeLog", "status": "modified", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/5c43016f2d1bdbf9ac2be60fcec6209d4f12416e/gcc%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/5c43016f2d1bdbf9ac2be60fcec6209d4f12416e/gcc%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2FChangeLog?ref=5c43016f2d1bdbf9ac2be60fcec6209d4f12416e", "patch": "@@ -1,5 +1,10 @@\n 2011-11-30  Jakub Jelinek  <jakub@redhat.com>\n \n+\tPR target/50725\n+\t* function.c (thread_prologue_and_epilogue_insns): If\n+\tstack_realign_drap, add drap_reg to SET_UP_BY_PROLOGUE\n+\tregset.\n+\n \tPR middle-end/51089\n \t* tree-eh.c (cleanup_empty_eh_merge_phis): Add check to\n \tavoid creating duplicate edges here."}, {"sha": "fa9236ce4b84d9d54ffeafbdd42deab37766471d", "filename": "gcc/function.c", "status": "modified", "additions": 3, "deletions": 0, "changes": 3, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/5c43016f2d1bdbf9ac2be60fcec6209d4f12416e/gcc%2Ffunction.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/5c43016f2d1bdbf9ac2be60fcec6209d4f12416e/gcc%2Ffunction.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ffunction.c?ref=5c43016f2d1bdbf9ac2be60fcec6209d4f12416e", "patch": "@@ -5893,6 +5893,9 @@ thread_prologue_and_epilogue_insns (void)\n       if (pic_offset_table_rtx)\n \tadd_to_hard_reg_set (&set_up_by_prologue, Pmode,\n \t\t\t     PIC_OFFSET_TABLE_REGNUM);\n+      if (stack_realign_drap && crtl->drap_reg)\n+\tadd_to_hard_reg_set (&set_up_by_prologue, GET_MODE (crtl->drap_reg),\n+\t\t\t     REGNO (crtl->drap_reg));\n \n       /* We don't use a different max size depending on\n \t optimize_bb_for_speed_p because increasing shrink-wrapping"}, {"sha": "9e8ec39ceee390e4c64b99121c68fa40b68c1640", "filename": "gcc/testsuite/ChangeLog", "status": "modified", "additions": 3, "deletions": 0, "changes": 3, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/5c43016f2d1bdbf9ac2be60fcec6209d4f12416e/gcc%2Ftestsuite%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/5c43016f2d1bdbf9ac2be60fcec6209d4f12416e/gcc%2Ftestsuite%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2FChangeLog?ref=5c43016f2d1bdbf9ac2be60fcec6209d4f12416e", "patch": "@@ -1,5 +1,8 @@\n 2011-11-30  Jakub Jelinek  <jakub@redhat.com>\n \n+\tPR target/50725\n+\t* gcc.target/i386/pr50725.c: New test.\n+\n \tPR middle-end/51089\n \t* gfortran.dg/gomp/pr51089.f90: New test.\n "}, {"sha": "ef74ecb0211bb86b95bafd6ea39b8d51eb4c351e", "filename": "gcc/testsuite/gcc.target/i386/pr50725.c", "status": "added", "additions": 48, "deletions": 0, "changes": 48, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/5c43016f2d1bdbf9ac2be60fcec6209d4f12416e/gcc%2Ftestsuite%2Fgcc.target%2Fi386%2Fpr50725.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/5c43016f2d1bdbf9ac2be60fcec6209d4f12416e/gcc%2Ftestsuite%2Fgcc.target%2Fi386%2Fpr50725.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgcc.target%2Fi386%2Fpr50725.c?ref=5c43016f2d1bdbf9ac2be60fcec6209d4f12416e", "patch": "@@ -0,0 +1,48 @@\n+/* PR target/50725 */\n+/* { dg-do run { target avx_runtime } } */\n+/* { dg-options \"-O2 -mavx\" } */\n+\n+extern void abort (void);\n+\n+typedef int __attribute__((vector_size (32))) m256i;\n+\n+__attribute__((noinline, noclone)) void\n+foo (int *x, m256i *y)\n+{\n+  asm volatile (\"\" : : \"r\" (x), \"r\" (y) : \"memory\");\n+}\n+\n+__attribute__((noinline, noclone)) int\n+bar (int x)\n+{\n+  if (x > 20)\n+    return 24;\n+  m256i i;\n+  foo (__builtin_alloca (x), &i);\n+  return 128;\n+}\n+\n+__attribute__((noinline, noclone)) int\n+baz (int d0, int d1, int d2, int d3, int d4, int d5, int x)\n+{\n+  if (x > 20)\n+    return 24;\n+  m256i i;\n+  d0 += d1 + d2 + d3 + d4 + d5; d1 += d0;\n+  foo (__builtin_alloca (x), &i);\n+  return 128;\n+}\n+\n+int\n+main ()\n+{\n+  if (bar (22) != 24 || bar (20) != 128)\n+    abort ();\n+#ifdef __x86_64__\n+  register long r10 __asm__ (\"r10\") = 0xdeadbeefdeadbeefUL;\n+  asm volatile (\"\" : \"+r\" (r10));\n+#endif\n+  if (baz (0, 0, 0, 0, 0, 0, 22) != 24 || baz (0, 0, 0, 0, 0, 0, 20) != 128)\n+    abort ();\n+  return 0;\n+}"}]}