{"sha": "4642ccb1d0dcd50c52850cd7a5f0d467735b9735", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6NDY0MmNjYjFkMGRjZDUwYzUyODUwY2Q3YTVmMGQ0Njc3MzViOTczNQ==", "commit": {"author": {"name": "Richard Earnshaw", "email": "rearnsha@arm.com", "date": "2005-05-09T22:09:47Z"}, "committer": {"name": "Richard Earnshaw", "email": "rearnsha@gcc.gnu.org", "date": "2005-05-09T22:09:47Z"}, "message": "* arm.c (const_ok_for_arm): Use a faster algorithm.\n\nFrom-SVN: r99476", "tree": {"sha": "dbebfeb8fce7454ee0ce4ccd21a8182c2cca9eda", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/dbebfeb8fce7454ee0ce4ccd21a8182c2cca9eda"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/4642ccb1d0dcd50c52850cd7a5f0d467735b9735", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/4642ccb1d0dcd50c52850cd7a5f0d467735b9735", "html_url": "https://github.com/Rust-GCC/gccrs/commit/4642ccb1d0dcd50c52850cd7a5f0d467735b9735", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/4642ccb1d0dcd50c52850cd7a5f0d467735b9735/comments", "author": null, "committer": null, "parents": [{"sha": "4a6ac6a5e6107c301a771ab2398ba3c3ae7ff946", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/4a6ac6a5e6107c301a771ab2398ba3c3ae7ff946", "html_url": "https://github.com/Rust-GCC/gccrs/commit/4a6ac6a5e6107c301a771ab2398ba3c3ae7ff946"}], "stats": {"total": 35, "additions": 22, "deletions": 13}, "files": [{"sha": "4f0f8598093b8ef6c2ecdfab22ba4ad242bce09a", "filename": "gcc/ChangeLog", "status": "modified", "additions": 4, "deletions": 0, "changes": 4, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/4642ccb1d0dcd50c52850cd7a5f0d467735b9735/gcc%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/4642ccb1d0dcd50c52850cd7a5f0d467735b9735/gcc%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2FChangeLog?ref=4642ccb1d0dcd50c52850cd7a5f0d467735b9735", "patch": "@@ -1,3 +1,7 @@\n+2005-05-09  Richard Earnshaw  <richard.earnshaw@arm.com>\n+\n+\t* arm.c (const_ok_for_arm): Use a faster algorithm.\n+\n 2005-05-09  David Edelsohn  <edelsohn@gnu.org>\n \n         PR target/21477"}, {"sha": "905187ad2f97df35014e732798fb7ef33281c7f3", "filename": "gcc/config/arm/arm.c", "status": "modified", "additions": 18, "deletions": 13, "changes": 31, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/4642ccb1d0dcd50c52850cd7a5f0d467735b9735/gcc%2Fconfig%2Farm%2Farm.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/4642ccb1d0dcd50c52850cd7a5f0d467735b9735/gcc%2Fconfig%2Farm%2Farm.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fconfig%2Farm%2Farm.c?ref=4642ccb1d0dcd50c52850cd7a5f0d467735b9735", "patch": "@@ -1531,8 +1531,8 @@ use_return_insn (int iscond, rtx sibling)\n int\n const_ok_for_arm (HOST_WIDE_INT i)\n {\n-  unsigned HOST_WIDE_INT mask = ~(unsigned HOST_WIDE_INT)0xFF;\n-\n+  int lowbit;\n+  \n   /* For machines with >32 bit HOST_WIDE_INT, the bits above bit 31 must\n      be all zero, or all one.  */\n   if ((i & ~(unsigned HOST_WIDE_INT) 0xffffffff) != 0\n@@ -1541,19 +1541,24 @@ const_ok_for_arm (HOST_WIDE_INT i)\n \t      & ~(unsigned HOST_WIDE_INT) 0xffffffff)))\n     return FALSE;\n \n-  /* Fast return for 0 and powers of 2 */\n-  if ((i & (i - 1)) == 0)\n+  i &= (unsigned HOST_WIDE_INT) 0xffffffff;\n+  \n+  /* Fast return for 0 and small values.  We must do this for zero, since\n+     the code below can't handle that one case.  */\n+  if ((i & ~(unsigned HOST_WIDE_INT) 0xff) == 0)\n     return TRUE;\n \n-  do\n-    {\n-      if ((i & mask & (unsigned HOST_WIDE_INT) 0xffffffff) == 0)\n-        return TRUE;\n-      mask =\n-\t  (mask << 2) | ((mask & (unsigned HOST_WIDE_INT) 0xffffffff)\n-\t\t\t  >> (32 - 2)) | ~(unsigned HOST_WIDE_INT) 0xffffffff;\n-    }\n-  while (mask != ~(unsigned HOST_WIDE_INT) 0xFF);\n+  /* Get the number of trailing zeros, rounded down to the nearest even\n+     number.  */\n+  lowbit = (ffs ((int) i) - 1) & ~1;\n+\n+  if ((i & ~(((unsigned HOST_WIDE_INT) 0xff) << lowbit)) == 0)\n+    return TRUE;\n+  else if (lowbit <= 4\n+\t   && ((i & ~0xc000003f) == 0\n+\t       || (i & ~0xf000000f) == 0\n+\t       || (i & ~0xfc000003) == 0))\n+    return TRUE;\n \n   return FALSE;\n }"}]}