{"sha": "8f4220dc9270f29f40fe5d7f3647eaa10511934b", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6OGY0MjIwZGM5MjcwZjI5ZjQwZmU1ZDdmMzY0N2VhYTEwNTExOTM0Yg==", "commit": {"author": {"name": "Matt Austern", "email": "austern@apple.com", "date": "2004-07-28T23:57:28Z"}, "committer": {"name": "Matt Austern", "email": "austern@gcc.gnu.org", "date": "2004-07-28T23:57:28Z"}, "message": "darwin.c (darwin_one_byte_bool): New global variable.\n\n        * config/darwin.c (darwin_one_byte_bool): New global variable.\n        * config/darwin.h (darwin_one_byte_bool): Declare.\n        (SUBTARGET_OPTIONS): Define macro.  (for -mone-byte-bool flag.)\n        * config/rs6000/darwin.h (BOOL_TYPE_SIZE): Conditionalize on\n        value of darwin_one_byte_bool.\n        * doc/invoke.texi: Document -mone-byte-bool flag.\n        * testsuite/gcc.dg/darwin-bool-1.c: New test.\n        * testsuite/gcc.dg/darwin-bool-2.c: New test.\n\nFrom-SVN: r85277", "tree": {"sha": "7316f0b087b8604c3dce7b83450841f30b955588", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/7316f0b087b8604c3dce7b83450841f30b955588"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/8f4220dc9270f29f40fe5d7f3647eaa10511934b", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/8f4220dc9270f29f40fe5d7f3647eaa10511934b", "html_url": "https://github.com/Rust-GCC/gccrs/commit/8f4220dc9270f29f40fe5d7f3647eaa10511934b", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/8f4220dc9270f29f40fe5d7f3647eaa10511934b/comments", "author": null, "committer": null, "parents": [{"sha": "9f63daea379c0d0c8a30b8f6ea6d8dc6c4ffa415", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/9f63daea379c0d0c8a30b8f6ea6d8dc6c4ffa415", "html_url": "https://github.com/Rust-GCC/gccrs/commit/9f63daea379c0d0c8a30b8f6ea6d8dc6c4ffa415"}], "stats": {"total": 73, "additions": 70, "deletions": 3}, "files": [{"sha": "3c2117284f58b9e7015ba90963a15c8f985ba965", "filename": "gcc/ChangeLog", "status": "modified", "additions": 9, "deletions": 0, "changes": 9, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/8f4220dc9270f29f40fe5d7f3647eaa10511934b/gcc%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/8f4220dc9270f29f40fe5d7f3647eaa10511934b/gcc%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2FChangeLog?ref=8f4220dc9270f29f40fe5d7f3647eaa10511934b", "patch": "@@ -1,3 +1,12 @@\n+2004-07-28  Matt Austern  <austern@apple.com>\n+\n+\t* config/darwin.c (darwin_one_byte_bool): New global variable.\n+\t* config/darwin.h (darwin_one_byte_bool): Declare.\n+\t(SUBTARGET_OPTIONS): Define macro.  (for -mone-byte-bool flag.)\n+\t* config/rs6000/darwin.h (BOOL_TYPE_SIZE): Conditionalize on\n+\tvalue of darwin_one_byte_bool.\n+\t* doc/invoke.texi: Document -mone-byte-bool flag.\n+\t\n 2004-07-28  Eric Christopher  <echristo@redhat.com>\n \n \t* c-common.c (c_common_unsafe_for_reeval): Delete."}, {"sha": "111abfc465a6c4f92f7a949cb2ae84883e3a9d5c", "filename": "gcc/config/darwin.c", "status": "modified", "additions": 4, "deletions": 0, "changes": 4, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/8f4220dc9270f29f40fe5d7f3647eaa10511934b/gcc%2Fconfig%2Fdarwin.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/8f4220dc9270f29f40fe5d7f3647eaa10511934b/gcc%2Fconfig%2Fdarwin.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fconfig%2Fdarwin.c?ref=8f4220dc9270f29f40fe5d7f3647eaa10511934b", "patch": "@@ -44,6 +44,10 @@ Boston, MA 02111-1307, USA.  */\n #include \"errors.h\"\n #include \"hashtab.h\"\n \n+/* Nonzero if the user passes the -mone-byte-bool switch, which forces\n+   sizeof(bool) to be 1. */\n+const char *darwin_one_byte_bool = 0;\n+\n int\n name_needs_quotes (const char *name)\n {"}, {"sha": "cb84eb12473d85f221fed0ec1d6ec017878ac732", "filename": "gcc/config/darwin.h", "status": "modified", "additions": 11, "deletions": 0, "changes": 11, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/8f4220dc9270f29f40fe5d7f3647eaa10511934b/gcc%2Fconfig%2Fdarwin.h", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/8f4220dc9270f29f40fe5d7f3647eaa10511934b/gcc%2Fconfig%2Fdarwin.h", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fconfig%2Fdarwin.h?ref=8f4220dc9270f29f40fe5d7f3647eaa10511934b", "patch": "@@ -130,7 +130,18 @@ Boston, MA 02111-1307, USA.  */\n   { \"-single_module\", \"-Zsingle_module\" },  \\\n   { \"-unexported_symbols_list\", \"-Zunexported_symbols_list\" }, \\\n   SUBTARGET_OPTION_TRANSLATE_TABLE\n+\n+/* Nonzero if the user has chosen to force sizeof(bool) to be 1\n+   by providing the -mone-byte-bool switch.  It would be better\n+   to use SUBTARGET_SWITCHES for this instead of SUBTARGET_OPTIONS,\n+   but there are no more bits in rs6000 TARGET_SWITCHES.  Note\n+   that this switch has no \"no-\" variant. */\n+extern const char *darwin_one_byte_bool;\n   \n+#undef SUBTARGET_OPTIONS\n+#define SUBTARGET_OPTIONS \\\n+  {\"one-byte-bool\", &darwin_one_byte_bool, N_(\"Set sizeof(bool) to 1\"), 0 }\n+\n /* These compiler options take n arguments.  */\n \n #undef  WORD_SWITCH_TAKES_ARG"}, {"sha": "e09e86b892d2098c4edb483ea9a068baea414e92", "filename": "gcc/config/rs6000/darwin.h", "status": "modified", "additions": 4, "deletions": 2, "changes": 6, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/8f4220dc9270f29f40fe5d7f3647eaa10511934b/gcc%2Fconfig%2Frs6000%2Fdarwin.h", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/8f4220dc9270f29f40fe5d7f3647eaa10511934b/gcc%2Fconfig%2Frs6000%2Fdarwin.h", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fconfig%2Frs6000%2Fdarwin.h?ref=8f4220dc9270f29f40fe5d7f3647eaa10511934b", "patch": "@@ -321,8 +321,10 @@ do {\t\t\t\t\t\t\t\t\t\\\n #define DOUBLE_INT_ASM_OP \"\\t.quad\\t\"\n \n /* For binary compatibility with 2.95; Darwin C APIs use bool from\n-   stdbool.h, which was an int-sized enum in 2.95.  */\n-#define BOOL_TYPE_SIZE INT_TYPE_SIZE\n+   stdbool.h, which was an int-sized enum in 2.95.  Users can explicitly\n+   choose to have sizeof(bool)==1 with the -mone-byte-bool switch. */\n+extern const char *darwin_one_byte_bool;\n+#define BOOL_TYPE_SIZE (darwin_one_byte_bool ? CHAR_TYPE_SIZE : INT_TYPE_SIZE)\n \n #undef REGISTER_TARGET_PRAGMAS\n #define REGISTER_TARGET_PRAGMAS DARWIN_REGISTER_TARGET_PRAGMAS"}, {"sha": "58eaaa3e9e5206bee9c94df0444816f80f6b5880", "filename": "gcc/doc/invoke.texi", "status": "modified", "additions": 14, "deletions": 1, "changes": 15, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/8f4220dc9270f29f40fe5d7f3647eaa10511934b/gcc%2Fdoc%2Finvoke.texi", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/8f4220dc9270f29f40fe5d7f3647eaa10511934b/gcc%2Fdoc%2Finvoke.texi", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fdoc%2Finvoke.texi?ref=8f4220dc9270f29f40fe5d7f3647eaa10511934b", "patch": "@@ -423,7 +423,7 @@ in the following sections.\n -single_module  -static  -sub_library  -sub_umbrella @gol\n -twolevel_namespace  -umbrella  -undefined @gol\n -unexported_symbols_list  -weak_reference_mismatches @gol\n--whatsloaded -F -gused -gfull}\n+-whatsloaded -F -gused -gfull -mone-byte-bool}\n \n @emph{DEC Alpha Options}\n @gccoptlist{-mno-fp-regs  -msoft-float  -malpha-as  -mgas @gol\n@@ -6931,6 +6931,19 @@ This is by default ON.\n @opindex -gfull\n Emit debugging information for all symbols and types.\n \n+@item -mone-byte-bool\n+@opindex -mone-byte-bool\n+Override the defaults for @samp{bool} so that @samp{sizeof(bool)==1}.\n+By default @samp{sizeof(bool)} is @samp{4} when compiling for \n+Darwin/PowerPC and @samp{1} when compiling for Darwin/x86, so this\n+option has no effect on x86.\n+\n+@strong{Warning:} The @option{-mone-byte-bool} switch causes GCC\n+to generate code that is not binary compatible with code generated\n+without that switch.  Using this switch may require recompiling all\n+other modules in a program, including system libraries.  Use this \n+switch to conform to a non-default data model.\n+\n @item -all_load\n @opindex all_load\n Loads all members of static archive libraries."}, {"sha": "2bb525981ecc1bcfb314411d8132f6b8443d862a", "filename": "gcc/testsuite/ChangeLog", "status": "modified", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/8f4220dc9270f29f40fe5d7f3647eaa10511934b/gcc%2Ftestsuite%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/8f4220dc9270f29f40fe5d7f3647eaa10511934b/gcc%2Ftestsuite%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2FChangeLog?ref=8f4220dc9270f29f40fe5d7f3647eaa10511934b", "patch": "@@ -1,3 +1,8 @@\n+2004-07-27  Matt Austern <austern@apple.com>\n+\n+\t* gcc.dg/darwin-bool-1.c: New test.\n+\t* gcc.dg/darwin-bool-2.c: New test.\n+\t\n 2004-07-28  Richard Henderson  <rth@redhat.com>\n \n \t* gfortran.fortran-torture/execute/intrinsic_spacing.f90: Pass"}, {"sha": "ef1e98b6ef25cce0871bc27a72fe738d3a28be06", "filename": "gcc/testsuite/gcc.dg/darwin-bool-1.c", "status": "added", "additions": 11, "deletions": 0, "changes": 11, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/8f4220dc9270f29f40fe5d7f3647eaa10511934b/gcc%2Ftestsuite%2Fgcc.dg%2Fdarwin-bool-1.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/8f4220dc9270f29f40fe5d7f3647eaa10511934b/gcc%2Ftestsuite%2Fgcc.dg%2Fdarwin-bool-1.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgcc.dg%2Fdarwin-bool-1.c?ref=8f4220dc9270f29f40fe5d7f3647eaa10511934b", "patch": "@@ -0,0 +1,11 @@\n+/* Check that sizeof(bool) is 4 if we don't use special options. */\n+/* Matt Austern  <austern@apple.com> */\n+/* { dg-do run { target powerpc*-*-darwin* } } */\n+\n+int dummy1[sizeof(_Bool) - 3];\n+int dummy2[5 - sizeof(_Bool)];\n+\n+int main()\n+{\n+  return sizeof(_Bool) == 4 ? 0 : 1;\n+}"}, {"sha": "fdbe1a2a4b8288df5cfb94d3515b885d5de08556", "filename": "gcc/testsuite/gcc.dg/darwin-bool-2.c", "status": "added", "additions": 12, "deletions": 0, "changes": 12, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/8f4220dc9270f29f40fe5d7f3647eaa10511934b/gcc%2Ftestsuite%2Fgcc.dg%2Fdarwin-bool-2.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/8f4220dc9270f29f40fe5d7f3647eaa10511934b/gcc%2Ftestsuite%2Fgcc.dg%2Fdarwin-bool-2.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgcc.dg%2Fdarwin-bool-2.c?ref=8f4220dc9270f29f40fe5d7f3647eaa10511934b", "patch": "@@ -0,0 +1,12 @@\n+/* Check that sizeof(bool) is 1 if we use the -mone-byte-bool option. */\n+/* Matt Austern  <austern@apple.com> */\n+/* { dg-do run { target powerpc*-*-darwin* } } */\n+/* { dg-options \"-mone-byte-bool\" } */\n+\n+int dummy1[sizeof(_Bool)];\n+int dummy2[2 - sizeof(_Bool)];\n+\n+int main()\n+{\n+  return sizeof(_Bool) == 1 ? 0 : 1;\n+}"}]}