{"sha": "f94302e90b09bc30d5ba357d4f84aa37f7a75ad1", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6Zjk0MzAyZTkwYjA5YmMzMGQ1YmEzNTdkNGY4NGFhMzdmN2E3NWFkMQ==", "commit": {"author": {"name": "H.J. Lu", "email": "hongjiu.lu@intel.com", "date": "2019-04-21T18:23:00Z"}, "committer": {"name": "H.J. Lu", "email": "hjl@gcc.gnu.org", "date": "2019-04-21T18:23:00Z"}, "message": "LRA: Revert \"Remove useless move insns\"\n\nUseless move insn removal was added to LRA just to avoid wasting CPU\ncycles on such insn processing afterwards.  Such insns are removed\nanyway later in the pass pipeline.  The CPU time savings are tiny but\nthe removal creates too many problems including PR target/90178.\nVladimir pre-approved the patch to remove the code:\n\nhttps://gcc.gnu.org/ml/gcc-patches/2019-04/msg00834.html\n\ngcc/\n\n\tPR target/90178\n\tRevert:\n\t2018-11-21  Uros Bizjak  <ubizjak@gmail.com>\n\n\tRevert the revert:\n\t2013-10-26  Vladimir Makarov  <vmakarov@redhat.com>\n\n\tRevert:\n\t2013-10-25  Vladimir Makarov  <vmakarov@redhat.com>\n\n\t* lra-spills.c (lra_final_code_change): Remove useless move insns.\n\ngcc/testsuite/\n\n\tPR target/90178\n\t* gcc.target/i386/pr90178.c: New test.\n\nFrom-SVN: r270484", "tree": {"sha": "9ddd83f023197d5d210e4a65188cb15843813408", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/9ddd83f023197d5d210e4a65188cb15843813408"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/f94302e90b09bc30d5ba357d4f84aa37f7a75ad1", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/f94302e90b09bc30d5ba357d4f84aa37f7a75ad1", "html_url": "https://github.com/Rust-GCC/gccrs/commit/f94302e90b09bc30d5ba357d4f84aa37f7a75ad1", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/f94302e90b09bc30d5ba357d4f84aa37f7a75ad1/comments", "author": {"login": "hjl-tools", "id": 1072356, "node_id": "MDQ6VXNlcjEwNzIzNTY=", "avatar_url": "https://avatars.githubusercontent.com/u/1072356?v=4", "gravatar_id": "", "url": "https://api.github.com/users/hjl-tools", "html_url": "https://github.com/hjl-tools", "followers_url": "https://api.github.com/users/hjl-tools/followers", "following_url": "https://api.github.com/users/hjl-tools/following{/other_user}", "gists_url": "https://api.github.com/users/hjl-tools/gists{/gist_id}", "starred_url": "https://api.github.com/users/hjl-tools/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/hjl-tools/subscriptions", "organizations_url": "https://api.github.com/users/hjl-tools/orgs", "repos_url": "https://api.github.com/users/hjl-tools/repos", "events_url": "https://api.github.com/users/hjl-tools/events{/privacy}", "received_events_url": "https://api.github.com/users/hjl-tools/received_events", "type": "User", "site_admin": false}, "committer": null, "parents": [{"sha": "6397d8df302d964740dca942445165d4c2a6c0aa", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/6397d8df302d964740dca942445165d4c2a6c0aa", "html_url": "https://github.com/Rust-GCC/gccrs/commit/6397d8df302d964740dca942445165d4c2a6c0aa"}], "stats": {"total": 47, "additions": 32, "deletions": 15}, "files": [{"sha": "d2446815605357952c6fce76e4290c465efcb51c", "filename": "gcc/ChangeLog", "status": "modified", "additions": 14, "deletions": 0, "changes": 14, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/f94302e90b09bc30d5ba357d4f84aa37f7a75ad1/gcc%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/f94302e90b09bc30d5ba357d4f84aa37f7a75ad1/gcc%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2FChangeLog?ref=f94302e90b09bc30d5ba357d4f84aa37f7a75ad1", "patch": "@@ -1,3 +1,17 @@\n+2019-04-21  H.J. Lu  <hongjiu.lu@intel.com>\n+\n+\tPR target/90178\n+\tRevert:\n+\t2018-11-21  Uros Bizjak  <ubizjak@gmail.com>\n+\n+\tRevert the revert:\n+\t2013-10-26  Vladimir Makarov  <vmakarov@redhat.com>\n+\n+\tRevert:\n+\t2013-10-25  Vladimir Makarov  <vmakarov@redhat.com>\n+\n+\t* lra-spills.c (lra_final_code_change): Remove useless move insns.\n+\n 2019-04-21  Iain Sandoe  <iain@sandoe.co.uk>\n \n \t* config/rs6000/rs6000.md (group_end_nop): Emit insn register"}, {"sha": "18db79e70a08ca36c77de6c8d1ba1bfd0572a1b5", "filename": "gcc/lra-spills.c", "status": "modified", "additions": 0, "deletions": 15, "changes": 15, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/f94302e90b09bc30d5ba357d4f84aa37f7a75ad1/gcc%2Flra-spills.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/f94302e90b09bc30d5ba357d4f84aa37f7a75ad1/gcc%2Flra-spills.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Flra-spills.c?ref=f94302e90b09bc30d5ba357d4f84aa37f7a75ad1", "patch": "@@ -740,7 +740,6 @@ lra_final_code_change (void)\n   int i, hard_regno;\n   basic_block bb;\n   rtx_insn *insn, *curr;\n-  rtx set;\n   int max_regno = max_reg_num ();\n \n   for (i = FIRST_PSEUDO_REGISTER; i < max_regno; i++)\n@@ -819,19 +818,5 @@ lra_final_code_change (void)\n \t      }\n \t  if (insn_change_p)\n \t    lra_update_operator_dups (id);\n-\n-\t  if ((set = single_set (insn)) != NULL\n-\t      && REG_P (SET_SRC (set)) && REG_P (SET_DEST (set))\n-\t      && REGNO (SET_SRC (set)) == REGNO (SET_DEST (set)))\n-\t    {\n-\t      /* Remove an useless move insn.  IRA can generate move\n-\t\t insns involving pseudos.  It is better remove them\n-\t\t earlier to speed up compiler a bit.  It is also\n-\t\t better to do it here as they might not pass final RTL\n-\t\t check in LRA, (e.g. insn moving a control register\n-\t\t into itself).  */\n-\t      lra_invalidate_insn_data (insn);\n-\t      delete_insn (insn);\n-\t    }\n \t}\n }"}, {"sha": "983382492f0837a39cd47dec7a77d9188990fc65", "filename": "gcc/testsuite/ChangeLog", "status": "modified", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/f94302e90b09bc30d5ba357d4f84aa37f7a75ad1/gcc%2Ftestsuite%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/f94302e90b09bc30d5ba357d4f84aa37f7a75ad1/gcc%2Ftestsuite%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2FChangeLog?ref=f94302e90b09bc30d5ba357d4f84aa37f7a75ad1", "patch": "@@ -1,3 +1,8 @@\n+2019-04-21  H.J. Lu  <hongjiu.lu@intel.com>\n+\n+\tPR target/90178\n+\t* gcc.target/i386/pr90178.c: New test.\n+\n 2019-04-20  Sandra Loosemore  <sandra@codesourcery.com>\n \n \t* g++.dg/ipa/pr89009.C: Add dg-require-effective-target fpic."}, {"sha": "1df36af0541c01f3624fe51efbc8cfa0ec67fe60", "filename": "gcc/testsuite/gcc.target/i386/pr90178.c", "status": "added", "additions": 13, "deletions": 0, "changes": 13, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/f94302e90b09bc30d5ba357d4f84aa37f7a75ad1/gcc%2Ftestsuite%2Fgcc.target%2Fi386%2Fpr90178.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/f94302e90b09bc30d5ba357d4f84aa37f7a75ad1/gcc%2Ftestsuite%2Fgcc.target%2Fi386%2Fpr90178.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgcc.target%2Fi386%2Fpr90178.c?ref=f94302e90b09bc30d5ba357d4f84aa37f7a75ad1", "patch": "@@ -0,0 +1,13 @@\n+/* { dg-do compile } */\n+/* { dg-options \"-O2 -mavx -mvzeroupper\" } */\n+\n+int*\n+find_ptr (int* mem, int sz, int val)\n+{\n+  for (int i = 0; i < sz; i++)\n+    if (mem[i] == val) \n+      return &mem[i];\n+  return 0;\n+}\n+\n+/* { dg-final { scan-assembler-times \"xorl\\[\\\\t \\]*\\\\\\%eax,\\[\\\\t \\]*%eax\" 1 } } */"}]}