{"sha": "871a0725ddee3c9ef8cf827cb85ce08e150fec44", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6ODcxYTA3MjVkZGVlM2M5ZWY4Y2Y4MjdjYjg1Y2UwOGUxNTBmZWM0NA==", "commit": {"author": {"name": "Richard Biener", "email": "rguenther@suse.de", "date": "2017-09-25T09:48:31Z"}, "committer": {"name": "Richard Biener", "email": "rguenth@gcc.gnu.org", "date": "2017-09-25T09:48:31Z"}, "message": "graphite-optimize-isl.c (optimize_isl): Fail and dump if ISL errors other than isl_error_quota happen.\n\n2017-09-25  Richard Biener  <rguenther@suse.de>\n\n\t* graphite-optimize-isl.c (optimize_isl): Fail and dump if\n\tISL errors other than isl_error_quota happen.  Dump if the\n\tschedule is the same.\n\t* graphite-sese-to-poly.c (build_poly_scop): Fail on ISL\n\terrors instead of aborting inside ISL.\n\nFrom-SVN: r253142", "tree": {"sha": "03aab835117a5662f821e9bed7cfa704fbe66ed6", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/03aab835117a5662f821e9bed7cfa704fbe66ed6"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/871a0725ddee3c9ef8cf827cb85ce08e150fec44", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/871a0725ddee3c9ef8cf827cb85ce08e150fec44", "html_url": "https://github.com/Rust-GCC/gccrs/commit/871a0725ddee3c9ef8cf827cb85ce08e150fec44", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/871a0725ddee3c9ef8cf827cb85ce08e150fec44/comments", "author": {"login": "rguenth", "id": 2046526, "node_id": "MDQ6VXNlcjIwNDY1MjY=", "avatar_url": "https://avatars.githubusercontent.com/u/2046526?v=4", "gravatar_id": "", "url": "https://api.github.com/users/rguenth", "html_url": "https://github.com/rguenth", "followers_url": "https://api.github.com/users/rguenth/followers", "following_url": "https://api.github.com/users/rguenth/following{/other_user}", "gists_url": "https://api.github.com/users/rguenth/gists{/gist_id}", "starred_url": "https://api.github.com/users/rguenth/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/rguenth/subscriptions", "organizations_url": "https://api.github.com/users/rguenth/orgs", "repos_url": "https://api.github.com/users/rguenth/repos", "events_url": "https://api.github.com/users/rguenth/events{/privacy}", "received_events_url": "https://api.github.com/users/rguenth/received_events", "type": "User", "site_admin": false}, "committer": null, "parents": [{"sha": "d449ed7517e34dc3b24c60f2d374a94f46b220d5", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/d449ed7517e34dc3b24c60f2d374a94f46b220d5", "html_url": "https://github.com/Rust-GCC/gccrs/commit/d449ed7517e34dc3b24c60f2d374a94f46b220d5"}], "stats": {"total": 49, "additions": 37, "deletions": 12}, "files": [{"sha": "4967e988a63a00f762f95e3d8a397538da0c020e", "filename": "gcc/ChangeLog", "status": "modified", "additions": 8, "deletions": 0, "changes": 8, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/871a0725ddee3c9ef8cf827cb85ce08e150fec44/gcc%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/871a0725ddee3c9ef8cf827cb85ce08e150fec44/gcc%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2FChangeLog?ref=871a0725ddee3c9ef8cf827cb85ce08e150fec44", "patch": "@@ -1,3 +1,11 @@\n+2017-09-25  Richard Biener  <rguenther@suse.de>\n+\n+\t* graphite-optimize-isl.c (optimize_isl): Fail and dump if\n+\tISL errors other than isl_error_quota happen.  Dump if the\n+\tschedule is the same.\n+\t* graphite-sese-to-poly.c (build_poly_scop): Fail on ISL\n+\terrors instead of aborting inside ISL.\n+\n 2017-09-25  Iain Sandoe  <iain@codesourcery.com>\n \n \tPR target/80556"}, {"sha": "dbf10ead1ca9573ca6b7884a7902e95dd7996d57", "filename": "gcc/graphite-optimize-isl.c", "status": "modified", "additions": 17, "deletions": 11, "changes": 28, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/871a0725ddee3c9ef8cf827cb85ce08e150fec44/gcc%2Fgraphite-optimize-isl.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/871a0725ddee3c9ef8cf827cb85ce08e150fec44/gcc%2Fgraphite-optimize-isl.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fgraphite-optimize-isl.c?ref=871a0725ddee3c9ef8cf827cb85ce08e150fec44", "patch": "@@ -111,6 +111,7 @@ scop_get_domains (scop_p scop)\n static bool\n optimize_isl (scop_p scop)\n {\n+  int old_err = isl_options_get_on_error (scop->isl_context);\n   int old_max_operations = isl_ctx_get_max_operations (scop->isl_context);\n   int max_operations = PARAM_VALUE (PARAM_MAX_ISL_OPERATIONS);\n   if (max_operations)\n@@ -150,19 +151,23 @@ optimize_isl (scop_p scop)\n   scop->transformed_schedule =\n     isl_schedule_map_schedule_node_bottom_up (scop->transformed_schedule,\n \t\t\t\t\t      get_schedule_for_node_st, NULL);\n-  isl_options_set_on_error (scop->isl_context, ISL_ON_ERROR_ABORT);\n \n+  isl_options_set_on_error (scop->isl_context, old_err);\n   isl_ctx_reset_operations (scop->isl_context);\n   isl_ctx_set_max_operations (scop->isl_context, old_max_operations);\n   if (!scop->transformed_schedule\n-      || isl_ctx_last_error (scop->isl_context) == isl_error_quota)\n+      || isl_ctx_last_error (scop->isl_context) != isl_error_none)\n     {\n       location_t loc = find_loop_location\n \t(scop->scop_info->region.entry->dest->loop_father);\n-      dump_printf_loc (MSG_MISSED_OPTIMIZATION, loc,\n-\t\t       \"loop nest not optimized, optimization timed out \"\n-\t\t       \"after %d operations [--param max-isl-operations]\\n\",\n-\t\t       max_operations);\n+      if (isl_ctx_last_error (scop->isl_context) == isl_error_quota)\n+\tdump_printf_loc (MSG_MISSED_OPTIMIZATION, loc,\n+\t\t\t \"loop nest not optimized, optimization timed out \"\n+\t\t\t \"after %d operations [--param max-isl-operations]\\n\",\n+\t\t\t max_operations);\n+      else\n+\tdump_printf_loc (MSG_MISSED_OPTIMIZATION, loc,\n+\t\t\t \"loop nest not optimized, ISL signalled an error\\n\");\n       return false;\n     }\n \n@@ -175,12 +180,13 @@ optimize_isl (scop_p scop)\n \n   if (same_schedule)\n     {\n+      location_t loc = find_loop_location\n+\t(scop->scop_info->region.entry->dest->loop_father);\n+      dump_printf_loc (MSG_NOTE, loc,\n+\t\t       \"loop nest not optimized, optimized schedule is \"\n+\t\t       \"identical to original schedule\\n\");\n       if (dump_file)\n-\t{\n-\t  fprintf (dump_file, \"[scheduler] isl optimized schedule is \"\n-\t\t   \"identical to the original schedule.\\n\");\n-\t  print_schedule_ast (dump_file, scop->original_schedule, scop);\n-\t}\n+\tprint_schedule_ast (dump_file, scop->original_schedule, scop);\n       isl_schedule_free (scop->transformed_schedule);\n       scop->transformed_schedule = isl_schedule_copy (scop->original_schedule);\n       return false;"}, {"sha": "fc8cd89239c665446bcf8b2a77f4a5ad6bafaec1", "filename": "gcc/graphite-sese-to-poly.c", "status": "modified", "additions": 12, "deletions": 1, "changes": 13, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/871a0725ddee3c9ef8cf827cb85ce08e150fec44/gcc%2Fgraphite-sese-to-poly.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/871a0725ddee3c9ef8cf827cb85ce08e150fec44/gcc%2Fgraphite-sese-to-poly.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fgraphite-sese-to-poly.c?ref=871a0725ddee3c9ef8cf827cb85ce08e150fec44", "patch": "@@ -1244,6 +1244,9 @@ build_original_schedule (scop_p scop)\n bool\n build_poly_scop (scop_p scop)\n {\n+  int old_err = isl_options_get_on_error (scop->isl_context);\n+  isl_options_set_on_error (scop->isl_context, ISL_ON_ERROR_CONTINUE);\n+\n   build_scop_context (scop);\n \n   unsigned i = 0;\n@@ -1253,6 +1256,14 @@ build_poly_scop (scop_p scop)\n \n   build_scop_drs (scop);\n   build_original_schedule (scop);\n-  return true;\n+\n+  enum isl_error err = isl_ctx_last_error (scop->isl_context);\n+  isl_ctx_reset_error (scop->isl_context);\n+  isl_options_set_on_error (scop->isl_context, old_err);\n+  if (err != isl_error_none)\n+    dump_printf (MSG_MISSED_OPTIMIZATION,\n+\t\t \"ISL error while building poly scop\\n\");\n+\n+  return err == isl_error_none;\n }\n #endif  /* HAVE_isl */"}]}