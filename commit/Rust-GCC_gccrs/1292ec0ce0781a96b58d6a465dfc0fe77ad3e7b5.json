{"sha": "1292ec0ce0781a96b58d6a465dfc0fe77ad3e7b5", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6MTI5MmVjMGNlMDc4MWE5NmI1OGQ2YTQ2NWRmYzBmZTc3YWQzZTdiNQ==", "commit": {"author": {"name": "Jan Hubicka", "email": "jh@suse.cz", "date": "2002-06-21T02:09:11Z"}, "committer": {"name": "Jeff Law", "email": "law@gcc.gnu.org", "date": "2002-06-21T02:09:11Z"}, "message": "cfglayout.c (scope_to_insns_initialize): Call set_block_levels.\n\n        * cfglayout.c (scope_to_insns_initialize): Call set_block_levels.\n        (scope_to_insns_finalize): Do not call set_block_levels; handle\n        sequences.\n        (choose_inner_scope): New.\n        * rtl.h (choose_inner_scope): Declare.\n\nFrom-SVN: r54868", "tree": {"sha": "fa827424c64695a60e9c17f4a7dce7f0632079d6", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/fa827424c64695a60e9c17f4a7dce7f0632079d6"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/1292ec0ce0781a96b58d6a465dfc0fe77ad3e7b5", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/1292ec0ce0781a96b58d6a465dfc0fe77ad3e7b5", "html_url": "https://github.com/Rust-GCC/gccrs/commit/1292ec0ce0781a96b58d6a465dfc0fe77ad3e7b5", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/1292ec0ce0781a96b58d6a465dfc0fe77ad3e7b5/comments", "author": null, "committer": null, "parents": [{"sha": "0f8e3849609032a71f93d9c4835d586888938d63", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/0f8e3849609032a71f93d9c4835d586888938d63", "html_url": "https://github.com/Rust-GCC/gccrs/commit/0f8e3849609032a71f93d9c4835d586888938d63"}], "stats": {"total": 45, "additions": 41, "deletions": 4}, "files": [{"sha": "efe3e9df8083066afb590cdf951f5b587218d3e0", "filename": "gcc/ChangeLog", "status": "modified", "additions": 8, "deletions": 0, "changes": 8, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/1292ec0ce0781a96b58d6a465dfc0fe77ad3e7b5/gcc%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/1292ec0ce0781a96b58d6a465dfc0fe77ad3e7b5/gcc%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2FChangeLog?ref=1292ec0ce0781a96b58d6a465dfc0fe77ad3e7b5", "patch": "@@ -1,3 +1,11 @@\n+2002-06-20 Jan Hubicka  <jh@suse.cz>\n+\n+\t* cfglayout.c (scope_to_insns_initialize): Call set_block_levels.\n+\t(scope_to_insns_finalize): Do not call set_block_levels; handle\n+\tsequences.\n+\t(choose_inner_scope): New.\n+\t* rtl.h (choose_inner_scope): Declare.\n+\n 2002-06-20  John David Anglin  <dave@hiauly1.hia.nrc.ca>\n \n \t* pa-protos.h (pa_asm_output_mi_thunk): Change third argument to"}, {"sha": "bd589728bdfa80f441b24b31778fd17d45610d22", "filename": "gcc/cfglayout.c", "status": "modified", "additions": 30, "deletions": 4, "changes": 34, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/1292ec0ce0781a96b58d6a465dfc0fe77ad3e7b5/gcc%2Fcfglayout.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/1292ec0ce0781a96b58d6a465dfc0fe77ad3e7b5/gcc%2Fcfglayout.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fcfglayout.c?ref=1292ec0ce0781a96b58d6a465dfc0fe77ad3e7b5", "patch": "@@ -241,6 +241,10 @@ scope_to_insns_initialize ()\n \t    }\n \t}\n     }\n+\n+  /* Tag the blocks with a depth number so that change_scope can find\n+     the common parent easily.  */\n+  set_block_levels (DECL_INITIAL (cfun->decl), 0);\n }\n \n /* For each lexical block, set BLOCK_NUMBER to the depth at which it is\n@@ -259,6 +263,20 @@ set_block_levels (block, level)\n     }\n }\n \f\n+/* Return sope resulting from combination of S1 and S2.  */\n+tree\n+choose_inner_scope (s1, s2)\n+     tree s1, s2;\n+{\n+   if (!s1)\n+     return s2;\n+   if (!s2)\n+     return s1;\n+   if (BLOCK_NUMBER (s1) > BLOCK_NUMBER (s2))\n+     return s1;\n+   return s2;\n+}\n+\f\n /* Emit lexical block notes needed to change scope from S1 to S2.  */\n \n static void\n@@ -315,10 +333,6 @@ scope_to_insns_finalize ()\n   tree cur_block = DECL_INITIAL (cfun->decl);\n   rtx insn, note;\n \n-  /* Tag the blocks with a depth number so that change_scope can find\n-     the common parent easily.  */\n-  set_block_levels (cur_block, 0);\n-\n   insn = get_insns ();\n   if (!active_insn_p (insn))\n     insn = next_active_insn (insn);\n@@ -327,6 +341,18 @@ scope_to_insns_finalize ()\n       tree this_block;\n \n       this_block = INSN_SCOPE (insn);\n+      /* For sequences compute scope resulting from merging all scopes\n+         of instructions nested inside. */\n+      if (GET_CODE (PATTERN (insn)) == SEQUENCE)\n+\t{\n+\t  int i;\n+\t  rtx body = PATTERN (insn);\n+\n+\t  this_block = NULL;\n+\t  for (i = 0; i < XVECLEN (body, 0); i++)\n+\t    this_block = choose_inner_scope (this_block,\n+\t\t\t    \t\t INSN_SCOPE (XVECEXP (body, 0, i)));\n+\t}\n       if (! this_block)\n \tcontinue;\n "}, {"sha": "0fba875aa031f16db23a3d0686ae9e87f5d6465c", "filename": "gcc/rtl.h", "status": "modified", "additions": 3, "deletions": 0, "changes": 3, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/1292ec0ce0781a96b58d6a465dfc0fe77ad3e7b5/gcc%2Frtl.h", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/1292ec0ce0781a96b58d6a465dfc0fe77ad3e7b5/gcc%2Frtl.h", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Frtl.h?ref=1292ec0ce0781a96b58d6a465dfc0fe77ad3e7b5", "patch": "@@ -1414,6 +1414,9 @@ extern rtx next_label\t\t\tPARAMS ((rtx));\n extern rtx next_cc0_user\t\tPARAMS ((rtx));\n extern rtx prev_cc0_setter\t\tPARAMS ((rtx));\n \n+/* In cfglayout.c  */\n+extern tree choose_inner_scope\t\tPARAMS ((tree, tree));\n+\n /* In jump.c */\n extern rtx next_nondeleted_insn\t\tPARAMS ((rtx));\n extern enum rtx_code reverse_condition\tPARAMS ((enum rtx_code));"}]}