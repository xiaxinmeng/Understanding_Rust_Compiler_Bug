{"sha": "16ad9ae85bb5b9acf80f9d1cf2be5a989ef7ba49", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6MTZhZDlhZTg1YmI1YjlhY2Y4MGY5ZDFjZjJiZTVhOTg5ZWY3YmE0OQ==", "commit": {"author": {"name": "David Malcolm", "email": "dmalcolm@redhat.com", "date": "2020-10-27T13:54:25Z"}, "committer": {"name": "David Malcolm", "email": "dmalcolm@redhat.com", "date": "2020-10-27T13:56:25Z"}, "message": "analyzer: don't assume extern const vars are zero-initialized [PR97568]\n\ngcc/analyzer/ChangeLog:\n\tPR analyzer/97568\n\t* region-model.cc (region_model::get_initial_value_for_global):\n\tMove check that !DECL_EXTERNAL from here to...\n\t* region.cc (decl_region::get_svalue_for_initializer): ...here,\n\tusing it to reject zero initialization.\n\ngcc/testsuite/ChangeLog:\n\tPR analyzer/97568\n\t* gcc.dg/analyzer/pr97568.c: New test.", "tree": {"sha": "8e134356ff4d967b99e1cde3c99be3c795151454", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/8e134356ff4d967b99e1cde3c99be3c795151454"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/16ad9ae85bb5b9acf80f9d1cf2be5a989ef7ba49", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/16ad9ae85bb5b9acf80f9d1cf2be5a989ef7ba49", "html_url": "https://github.com/Rust-GCC/gccrs/commit/16ad9ae85bb5b9acf80f9d1cf2be5a989ef7ba49", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/16ad9ae85bb5b9acf80f9d1cf2be5a989ef7ba49/comments", "author": {"login": "davidmalcolm", "id": 1553248, "node_id": "MDQ6VXNlcjE1NTMyNDg=", "avatar_url": "https://avatars.githubusercontent.com/u/1553248?v=4", "gravatar_id": "", "url": "https://api.github.com/users/davidmalcolm", "html_url": "https://github.com/davidmalcolm", "followers_url": "https://api.github.com/users/davidmalcolm/followers", "following_url": "https://api.github.com/users/davidmalcolm/following{/other_user}", "gists_url": "https://api.github.com/users/davidmalcolm/gists{/gist_id}", "starred_url": "https://api.github.com/users/davidmalcolm/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/davidmalcolm/subscriptions", "organizations_url": "https://api.github.com/users/davidmalcolm/orgs", "repos_url": "https://api.github.com/users/davidmalcolm/repos", "events_url": "https://api.github.com/users/davidmalcolm/events{/privacy}", "received_events_url": "https://api.github.com/users/davidmalcolm/received_events", "type": "User", "site_admin": false}, "committer": {"login": "davidmalcolm", "id": 1553248, "node_id": "MDQ6VXNlcjE1NTMyNDg=", "avatar_url": "https://avatars.githubusercontent.com/u/1553248?v=4", "gravatar_id": "", "url": "https://api.github.com/users/davidmalcolm", "html_url": "https://github.com/davidmalcolm", "followers_url": "https://api.github.com/users/davidmalcolm/followers", "following_url": "https://api.github.com/users/davidmalcolm/following{/other_user}", "gists_url": "https://api.github.com/users/davidmalcolm/gists{/gist_id}", "starred_url": "https://api.github.com/users/davidmalcolm/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/davidmalcolm/subscriptions", "organizations_url": "https://api.github.com/users/davidmalcolm/orgs", "repos_url": "https://api.github.com/users/davidmalcolm/repos", "events_url": "https://api.github.com/users/davidmalcolm/events{/privacy}", "received_events_url": "https://api.github.com/users/davidmalcolm/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "942086bf73ee2ba6cfd7fdacc552940048437a6e", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/942086bf73ee2ba6cfd7fdacc552940048437a6e", "html_url": "https://github.com/Rust-GCC/gccrs/commit/942086bf73ee2ba6cfd7fdacc552940048437a6e"}], "stats": {"total": 37, "additions": 35, "deletions": 2}, "files": [{"sha": "e5f027b6059b5caca22de385bc35404e70a3c9a1", "filename": "gcc/analyzer/region-model.cc", "status": "modified", "additions": 1, "deletions": 2, "changes": 3, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/16ad9ae85bb5b9acf80f9d1cf2be5a989ef7ba49/gcc%2Fanalyzer%2Fregion-model.cc", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/16ad9ae85bb5b9acf80f9d1cf2be5a989ef7ba49/gcc%2Fanalyzer%2Fregion-model.cc", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fanalyzer%2Fregion-model.cc?ref=16ad9ae85bb5b9acf80f9d1cf2be5a989ef7ba49", "patch": "@@ -1342,8 +1342,7 @@ region_model::get_initial_value_for_global (const region *reg) const\n      global decl defined in this TU that hasn't been touched yet, then\n      the initial value of REG can be taken from the initialization value\n      of the decl.  */\n-  if ((called_from_main_p () && !DECL_EXTERNAL (decl))\n-      || TREE_READONLY (decl))\n+  if (called_from_main_p () || TREE_READONLY (decl))\n     {\n       /* Attempt to get the initializer value for base_reg.  */\n       if (const svalue *base_reg_init"}, {"sha": "c43fb782b7d34d0d72616fdd8ad1d6187c8ba21b", "filename": "gcc/analyzer/region.cc", "status": "modified", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/16ad9ae85bb5b9acf80f9d1cf2be5a989ef7ba49/gcc%2Fanalyzer%2Fregion.cc", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/16ad9ae85bb5b9acf80f9d1cf2be5a989ef7ba49/gcc%2Fanalyzer%2Fregion.cc", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fanalyzer%2Fregion.cc?ref=16ad9ae85bb5b9acf80f9d1cf2be5a989ef7ba49", "patch": "@@ -938,6 +938,11 @@ decl_region::get_svalue_for_initializer (region_model_manager *mgr) const\n   tree init = DECL_INITIAL (m_decl);\n   if (!init)\n     {\n+      /* If we have an \"extern\" decl then there may be an initializer in\n+\t another TU.  */\n+      if (DECL_EXTERNAL (m_decl))\n+\treturn NULL;\n+\n       /* Implicit initialization to zero; use a compound_svalue for it.\n \t Doing so requires that we have a concrete binding for this region,\n \t which can fail if we have a region with unknown size"}, {"sha": "22d574b5fbd3ddf1ce9e515bab6506f2c433bb3f", "filename": "gcc/testsuite/gcc.dg/analyzer/pr97568.c", "status": "added", "additions": 29, "deletions": 0, "changes": 29, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/16ad9ae85bb5b9acf80f9d1cf2be5a989ef7ba49/gcc%2Ftestsuite%2Fgcc.dg%2Fanalyzer%2Fpr97568.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/16ad9ae85bb5b9acf80f9d1cf2be5a989ef7ba49/gcc%2Ftestsuite%2Fgcc.dg%2Fanalyzer%2Fpr97568.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgcc.dg%2Fanalyzer%2Fpr97568.c?ref=16ad9ae85bb5b9acf80f9d1cf2be5a989ef7ba49", "patch": "@@ -0,0 +1,29 @@\n+#include \"analyzer-decls.h\"\n+\n+#define NULL ((void *)0)\n+\n+extern int *const p1;\n+\n+int *const p2;\n+\n+int v3;\n+extern int *const p3 = &v3; /* { dg-warning \"'p3' initialized and declared 'extern'\" } */\n+\n+int v4;\n+int *const p4 = &v4;\n+\n+int main (void)\n+{\n+  __analyzer_describe (0, p1); /* { dg-message \"INIT_VAL\\\\(p1\\\\)\" } */\n+  __analyzer_eval (p1 == NULL); /* { dg-message \"UNKNOWN\" } */\n+\n+  __analyzer_eval (p2 == NULL); /* { dg-message \"TRUE\" } */\n+\n+  __analyzer_describe (0, p3); /* { dg-message \"&v3\" } */\n+  __analyzer_eval (p3 == NULL); /* { dg-message \"FALSE\" } */\n+\n+  __analyzer_describe (0, p4); /* { dg-message \"&v4\" } */\n+  __analyzer_eval (p4 == NULL); /* { dg-message \"FALSE\" } */\n+\n+  return p1[0];\n+}"}]}