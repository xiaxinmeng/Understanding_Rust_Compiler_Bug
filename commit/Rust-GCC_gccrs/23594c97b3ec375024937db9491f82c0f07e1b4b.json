{"sha": "23594c97b3ec375024937db9491f82c0f07e1b4b", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6MjM1OTRjOTdiM2VjMzc1MDI0OTM3ZGI5NDkxZjgyYzBmMDdlMWI0Yg==", "commit": {"author": {"name": "H.J. Lu", "email": "hongjiu.lu@intel.com", "date": "2008-03-30T21:13:33Z"}, "committer": {"name": "H.J. Lu", "email": "hjl@gcc.gnu.org", "date": "2008-03-30T21:13:33Z"}, "message": "re PR target/35757 (Incorrect contraint on sse4_1_blendp<ssemodesuffixf2c>)\n\ngcc/\n\n2008-03-30  H.J. Lu  <hongjiu.lu@intel.com>\n\n\tPR target/35757\n\t* config/i386/i386.c (ix86_expand_sse_4_operands_builtin): Issue\n\tproper error message for the third argument on blendpd and\n\tblendps.\n\n\t* config/i386/sse.md (blendbits): New.\n\t(sse4_1_blendp<ssemodesuffixf2c>): Use it.\n\ngcc/testsuite/\n\n2008-03-30  H.J. Lu  <hongjiu.lu@intel.com>\n\n\tPR target/35757\n\t* gcc.target/i386/sse4_1-blendps-2.c: New.\n\t* gcc.target/i386/sse4_1-pblendw-2.c: Likewise.\n\nFrom-SVN: r133736", "tree": {"sha": "0b45e84e519da8194c4e2bcafac2c49309fb4e3e", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/0b45e84e519da8194c4e2bcafac2c49309fb4e3e"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/23594c97b3ec375024937db9491f82c0f07e1b4b", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/23594c97b3ec375024937db9491f82c0f07e1b4b", "html_url": "https://github.com/Rust-GCC/gccrs/commit/23594c97b3ec375024937db9491f82c0f07e1b4b", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/23594c97b3ec375024937db9491f82c0f07e1b4b/comments", "author": {"login": "hjl-tools", "id": 1072356, "node_id": "MDQ6VXNlcjEwNzIzNTY=", "avatar_url": "https://avatars.githubusercontent.com/u/1072356?v=4", "gravatar_id": "", "url": "https://api.github.com/users/hjl-tools", "html_url": "https://github.com/hjl-tools", "followers_url": "https://api.github.com/users/hjl-tools/followers", "following_url": "https://api.github.com/users/hjl-tools/following{/other_user}", "gists_url": "https://api.github.com/users/hjl-tools/gists{/gist_id}", "starred_url": "https://api.github.com/users/hjl-tools/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/hjl-tools/subscriptions", "organizations_url": "https://api.github.com/users/hjl-tools/orgs", "repos_url": "https://api.github.com/users/hjl-tools/repos", "events_url": "https://api.github.com/users/hjl-tools/events{/privacy}", "received_events_url": "https://api.github.com/users/hjl-tools/received_events", "type": "User", "site_admin": false}, "committer": null, "parents": [{"sha": "e14c931f31a05f6e1bacbdde9d8d87033e8dc093", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/e14c931f31a05f6e1bacbdde9d8d87033e8dc093", "html_url": "https://github.com/Rust-GCC/gccrs/commit/e14c931f31a05f6e1bacbdde9d8d87033e8dc093"}], "stats": {"total": 182, "additions": 181, "deletions": 1}, "files": [{"sha": "a0e29ccedb18a5662d58bc53c118dd8fe8af6979", "filename": "gcc/ChangeLog", "status": "modified", "additions": 10, "deletions": 0, "changes": 10, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/23594c97b3ec375024937db9491f82c0f07e1b4b/gcc%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/23594c97b3ec375024937db9491f82c0f07e1b4b/gcc%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2FChangeLog?ref=23594c97b3ec375024937db9491f82c0f07e1b4b", "patch": "@@ -1,3 +1,13 @@\n+2008-03-30  H.J. Lu  <hongjiu.lu@intel.com>\n+\n+\tPR target/35757\n+\t* config/i386/i386.c (ix86_expand_sse_4_operands_builtin): Issue\n+\tproper error message for the third argument on blendpd and\n+\tblendps.\n+\n+\t* config/i386/sse.md (blendbits): New.\n+\t(sse4_1_blendp<ssemodesuffixf2c>): Use it.\n+\n 2008-03-30  Eric Botcazou  <ebotcazou@adacore.com>\n \n \t* fold-const.c (fold_binary) <BIT_IOR_EXPR>: Add missing conversions."}, {"sha": "db593a69ad8bffd72000ca360f3364e5eab4811c", "filename": "gcc/config/i386/i386.c", "status": "modified", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/23594c97b3ec375024937db9491f82c0f07e1b4b/gcc%2Fconfig%2Fi386%2Fi386.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/23594c97b3ec375024937db9491f82c0f07e1b4b/gcc%2Fconfig%2Fi386%2Fi386.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fconfig%2Fi386%2Fi386.c?ref=23594c97b3ec375024937db9491f82c0f07e1b4b", "patch": "@@ -19738,9 +19738,14 @@ ix86_expand_sse_4_operands_builtin (enum insn_code icode, tree exp,\n \n       case CODE_FOR_sse4_1_roundsd:\n       case CODE_FOR_sse4_1_roundss:\n+      case CODE_FOR_sse4_1_blendps:\n \terror (\"the third argument must be a 4-bit immediate\");\n \treturn const0_rtx;\n \n+      case CODE_FOR_sse4_1_blendpd:\n+\terror (\"the third argument must be a 2-bit immediate\");\n+\treturn const0_rtx;\n+\n       default:\n \terror (\"the third argument must be an 8-bit immediate\");\n \treturn const0_rtx;"}, {"sha": "ad17209e5426bb9ee7bab549bfa0f2418873e818", "filename": "gcc/config/i386/sse.md", "status": "modified", "additions": 4, "deletions": 1, "changes": 5, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/23594c97b3ec375024937db9491f82c0f07e1b4b/gcc%2Fconfig%2Fi386%2Fsse.md", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/23594c97b3ec375024937db9491f82c0f07e1b4b/gcc%2Fconfig%2Fi386%2Fsse.md", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fconfig%2Fi386%2Fsse.md?ref=23594c97b3ec375024937db9491f82c0f07e1b4b", "patch": "@@ -53,6 +53,9 @@\n ;; Mapping of vector modes back to the scalar modes\n (define_mode_attr ssescalarmode [(V4SF \"SF\") (V2DF \"DF\")])\n \n+;; Mapping of immediate bits for blend instructions\n+(define_mode_attr blendbits [(V4SF \"15\") (V2DF \"3\")])\n+\n ;; Patterns whose name begins with \"sse{,2,3}_\" are invoked by intrinsics.\n \n ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;\n@@ -6283,7 +6286,7 @@\n \t(vec_merge:SSEMODEF2P\n \t  (match_operand:SSEMODEF2P 2 \"nonimmediate_operand\" \"xm\")\n \t  (match_operand:SSEMODEF2P 1 \"register_operand\" \"0\")\n-\t  (match_operand:SI 3 \"const_0_to_3_operand\" \"n\")))]\n+\t  (match_operand:SI 3 \"const_0_to_<blendbits>_operand\" \"n\")))]\n   \"TARGET_SSE4_1\"\n   \"blendp<ssemodesuffixf2c>\\t{%3, %2, %0|%0, %2, %3}\"\n   [(set_attr \"type\" \"ssemov\")"}, {"sha": "3f8205a65fb2c926e08b865661836ea0656038b2", "filename": "gcc/testsuite/ChangeLog", "status": "modified", "additions": 6, "deletions": 0, "changes": 6, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/23594c97b3ec375024937db9491f82c0f07e1b4b/gcc%2Ftestsuite%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/23594c97b3ec375024937db9491f82c0f07e1b4b/gcc%2Ftestsuite%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2FChangeLog?ref=23594c97b3ec375024937db9491f82c0f07e1b4b", "patch": "@@ -1,3 +1,9 @@\n+2008-03-30  H.J. Lu  <hongjiu.lu@intel.com>\n+\n+\tPR target/35757\n+\t* gcc.target/i386/sse4_1-blendps-2.c: New.\n+\t* gcc.target/i386/sse4_1-pblendw-2.c: Likewise.\n+\n 2008-03-30  Thomas Koenig  <tkoenig@gcc.gnu.org>\n \n \t* gfortran.dg/internal_pack_1.f90:  Added complex to test case."}, {"sha": "b66bbfd3b8cac7908309b2511c997f69c5aabc4c", "filename": "gcc/testsuite/gcc.target/i386/sse4_1-blendps-2.c", "status": "added", "additions": 77, "deletions": 0, "changes": 77, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/23594c97b3ec375024937db9491f82c0f07e1b4b/gcc%2Ftestsuite%2Fgcc.target%2Fi386%2Fsse4_1-blendps-2.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/23594c97b3ec375024937db9491f82c0f07e1b4b/gcc%2Ftestsuite%2Fgcc.target%2Fi386%2Fsse4_1-blendps-2.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgcc.target%2Fi386%2Fsse4_1-blendps-2.c?ref=23594c97b3ec375024937db9491f82c0f07e1b4b", "patch": "@@ -0,0 +1,77 @@\n+/* { dg-do run } */\n+/* { dg-require-effective-target sse4 } */\n+/* { dg-options \"-O2 -msse4.1\" } */\n+\n+#include \"sse4_1-check.h\"\n+\n+#include <smmintrin.h>\n+#include <string.h>\n+\n+#define NUM 20\n+\n+#undef MASK\n+#define MASK 0xe\n+\n+static void\n+init_blendps (float *src1, float *src2)\n+{\n+  int i, sign = 1;\n+\n+  for (i = 0; i < NUM * 4; i++)\n+    {\n+      src1[i] = i * i * sign;\n+      src2[i] = (i + 20) * sign;\n+      sign = -sign;\n+    }\n+}\n+\n+static int\n+check_blendps (__m128 *dst, float *src1, float *src2)\n+{\n+  float tmp[4];\n+  int j;\n+\n+  memcpy (&tmp[0], src1, sizeof (tmp));\n+  for (j = 0; j < 4; j++)\n+    if ((MASK & (1 << j)))\n+      tmp[j] = src2[j];\n+\n+  return memcmp (dst, &tmp[0], sizeof (tmp));\n+}\n+\n+static void\n+sse4_1_test (void)\n+{\n+  __m128 x, y;\n+  union\n+    {\n+      __m128 x[NUM];\n+      float f[NUM * 4];\n+    } dst, src1, src2;\n+  union\n+    {\n+      __m128 x;\n+      float f[4];\n+    } src3;\n+  int i;\n+\n+  init_blendps (src1.f, src2.f);\n+\n+  /* Check blendps imm8, m128, xmm */\n+  for (i = 0; i < NUM; i++)\n+    {\n+      dst.x[i] = _mm_blend_ps (src1.x[i], src2.x[i], MASK); \n+      if (check_blendps (&dst.x[i], &src1.f[i * 4], &src2.f[i * 4]))\n+\tabort ();\n+    }\n+    \n+   /* Check blendps imm8, xmm, xmm */\n+  x = _mm_blend_ps (dst.x[2], src3.x, MASK);\n+  y = _mm_blend_ps (src3.x, dst.x[2], MASK);\n+\n+  if (check_blendps (&x, &dst.f[8], &src3.f[0]))\n+    abort ();\n+\n+  if (check_blendps (&y, &src3.f[0], &dst.f[8]))\n+    abort ();\n+}"}, {"sha": "eecc6edf600329b13b649cd6e4e05643a5eccb63", "filename": "gcc/testsuite/gcc.target/i386/sse4_1-pblendw-2.c", "status": "added", "additions": 79, "deletions": 0, "changes": 79, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/23594c97b3ec375024937db9491f82c0f07e1b4b/gcc%2Ftestsuite%2Fgcc.target%2Fi386%2Fsse4_1-pblendw-2.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/23594c97b3ec375024937db9491f82c0f07e1b4b/gcc%2Ftestsuite%2Fgcc.target%2Fi386%2Fsse4_1-pblendw-2.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgcc.target%2Fi386%2Fsse4_1-pblendw-2.c?ref=23594c97b3ec375024937db9491f82c0f07e1b4b", "patch": "@@ -0,0 +1,79 @@\n+/* { dg-do run } */\n+/* { dg-require-effective-target sse4 } */\n+/* { dg-options \"-O2 -msse4.1\" } */\n+\n+#include \"sse4_1-check.h\"\n+\n+#include <smmintrin.h>\n+#include <string.h>\n+\n+#define NUM 20\n+\n+#undef MASK\n+#define MASK 0xfe\n+\n+static void\n+init_pblendw (short *src1, short *src2)\n+{\n+  int i, sign = 1;\n+\n+  for (i = 0; i < NUM * 8; i++)\n+    {\n+      src1[i] = i * i * sign;\n+      src2[i] = (i + 20) * sign;\n+      sign = -sign;\n+    }\n+}\n+\n+static int\n+check_pblendw (__m128i *dst, short *src1, short *src2)\n+{\n+  short tmp[8];\n+  int j;\n+\n+  memcpy (&tmp[0], src1, sizeof (tmp));\n+  for (j = 0; j < 8; j++)\n+    if ((MASK & (1 << j)))\n+      tmp[j] = src2[j];\n+\n+  return memcmp (dst, &tmp[0], sizeof (tmp));\n+}\n+\n+static void\n+sse4_1_test (void)\n+{\n+  __m128i x, y;\n+  union\n+    {\n+      __m128i x[NUM];\n+      short s[NUM * 8];\n+    } dst, src1, src2;\n+  union\n+    {\n+      __m128i x;\n+      short s[8];\n+    } src3;\n+  int i;\n+\n+  init_pblendw (src1.s, src2.s);\n+\n+  /* Check pblendw imm8, m128, xmm */\n+  for (i = 0; i < NUM; i++)\n+    {\n+      dst.x[i] = _mm_blend_epi16 (src1.x[i], src2.x[i], MASK); \n+      if (check_pblendw (&dst.x[i], &src1.s[i * 8], &src2.s[i * 8]))\n+\tabort ();\n+    }\n+    \n+   /* Check pblendw imm8, xmm, xmm */\n+  src3.x = _mm_setzero_si128 ();\n+\n+  x = _mm_blend_epi16 (dst.x[2], src3.x, MASK);\n+  y = _mm_blend_epi16 (src3.x, dst.x[2], MASK);\n+\n+  if (check_pblendw (&x, &dst.s[16], &src3.s[0]))\n+    abort ();\n+\n+  if (check_pblendw (&y, &src3.s[0], &dst.s[16]))\n+    abort ();\n+}"}]}