{"sha": "20770eb80bf59f4fe1d71408b841669c70550e6c", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6MjA3NzBlYjgwYmY1OWY0ZmUxZDcxNDA4Yjg0MTY2OWM3MDU1MGU2Yw==", "commit": {"author": {"name": "Richard Biener", "email": "rguenther@suse.de", "date": "2016-11-07T12:26:00Z"}, "committer": {"name": "Richard Biener", "email": "rguenth@gcc.gnu.org", "date": "2016-11-07T12:26:00Z"}, "message": "re PR tree-optimization/78218 (wrong code at -Os and above on x86_64-linux-gnu (in both 32-bit and 64-bit modes))\n\n2016-11-07  Richard Biener  <rguenther@suse.de>\n\n\tPR tree-optimization/78218\n\t* gimple-ssa-store-merging.c\n\t(pass_store_merging::terminate_all_aliasing_chains):\n\tDrop unused argument, fix alias check to also consider uses.\n\t(pass_store_merging::execute): Adjust.\n\n\t* gcc.dg/torture/pr78218.c: New testcase.\n\nFrom-SVN: r241900", "tree": {"sha": "40cda2f82959c26f706bbc6c773b5682bba61a36", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/40cda2f82959c26f706bbc6c773b5682bba61a36"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/20770eb80bf59f4fe1d71408b841669c70550e6c", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/20770eb80bf59f4fe1d71408b841669c70550e6c", "html_url": "https://github.com/Rust-GCC/gccrs/commit/20770eb80bf59f4fe1d71408b841669c70550e6c", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/20770eb80bf59f4fe1d71408b841669c70550e6c/comments", "author": {"login": "rguenth", "id": 2046526, "node_id": "MDQ6VXNlcjIwNDY1MjY=", "avatar_url": "https://avatars.githubusercontent.com/u/2046526?v=4", "gravatar_id": "", "url": "https://api.github.com/users/rguenth", "html_url": "https://github.com/rguenth", "followers_url": "https://api.github.com/users/rguenth/followers", "following_url": "https://api.github.com/users/rguenth/following{/other_user}", "gists_url": "https://api.github.com/users/rguenth/gists{/gist_id}", "starred_url": "https://api.github.com/users/rguenth/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/rguenth/subscriptions", "organizations_url": "https://api.github.com/users/rguenth/orgs", "repos_url": "https://api.github.com/users/rguenth/repos", "events_url": "https://api.github.com/users/rguenth/events{/privacy}", "received_events_url": "https://api.github.com/users/rguenth/received_events", "type": "User", "site_admin": false}, "committer": null, "parents": [{"sha": "32894793ff96f4c56b90e0f0e1d961e526a6edc7", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/32894793ff96f4c56b90e0f0e1d961e526a6edc7", "html_url": "https://github.com/Rust-GCC/gccrs/commit/32894793ff96f4c56b90e0f0e1d961e526a6edc7"}], "stats": {"total": 53, "additions": 46, "deletions": 7}, "files": [{"sha": "5ccd3b4ca62ca447a9b2d2e321deb72bef8f415f", "filename": "gcc/ChangeLog", "status": "modified", "additions": 8, "deletions": 0, "changes": 8, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/20770eb80bf59f4fe1d71408b841669c70550e6c/gcc%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/20770eb80bf59f4fe1d71408b841669c70550e6c/gcc%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2FChangeLog?ref=20770eb80bf59f4fe1d71408b841669c70550e6c", "patch": "@@ -1,3 +1,11 @@\n+2016-11-07  Richard Biener  <rguenther@suse.de>\n+\n+\tPR tree-optimization/78218\n+\t* gimple-ssa-store-merging.c\n+\t(pass_store_merging::terminate_all_aliasing_chains):\n+\tDrop unused argument, fix alias check to also consider uses.\n+\t(pass_store_merging::execute): Adjust.\n+\n 2016-11-07  Richard Biener  <rguenther@suse.de>\n \n \tPR tree-optimization/78228"}, {"sha": "57b855671dbbda59c206403ce3adb4acf65a3cad", "filename": "gcc/gimple-ssa-store-merging.c", "status": "modified", "additions": 9, "deletions": 7, "changes": 16, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/20770eb80bf59f4fe1d71408b841669c70550e6c/gcc%2Fgimple-ssa-store-merging.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/20770eb80bf59f4fe1d71408b841669c70550e6c/gcc%2Fgimple-ssa-store-merging.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fgimple-ssa-store-merging.c?ref=20770eb80bf59f4fe1d71408b841669c70550e6c", "patch": "@@ -726,7 +726,7 @@ class pass_store_merging : public gimple_opt_pass\n   hash_map<tree_operand_hash, struct imm_store_chain_info *> m_stores;\n \n   bool terminate_and_process_all_chains ();\n-  bool terminate_all_aliasing_chains (tree, imm_store_chain_info **,\n+  bool terminate_all_aliasing_chains (imm_store_chain_info **,\n \t\t\t\t      bool, gimple *);\n   bool terminate_and_release_chain (imm_store_chain_info *);\n }; // class pass_store_merging\n@@ -755,8 +755,7 @@ pass_store_merging::terminate_and_process_all_chains ()\n    If that is the case we have to terminate any chain anchored at BASE.  */\n \n bool\n-pass_store_merging::terminate_all_aliasing_chains (tree dest,\n-\t\t\t\t\t\t   imm_store_chain_info\n+pass_store_merging::terminate_all_aliasing_chains (imm_store_chain_info\n \t\t\t\t\t\t     **chain_info,\n \t\t\t\t\t\t   bool var_offset_p,\n \t\t\t\t\t\t   gimple *stmt)\n@@ -788,7 +787,10 @@ pass_store_merging::terminate_all_aliasing_chains (tree dest,\n \t  unsigned int i;\n \t  FOR_EACH_VEC_ELT ((*chain_info)->m_store_info, i, info)\n \t    {\n-\t      if (stmt_may_clobber_ref_p (info->stmt, dest))\n+\t      if (ref_maybe_used_by_stmt_p (stmt,\n+\t\t\t\t\t    gimple_assign_lhs (info->stmt))\n+\t\t  || stmt_may_clobber_ref_p (stmt,\n+\t\t\t\t\t     gimple_assign_lhs (info->stmt)))\n \t\t{\n \t\t  if (dump_file && (dump_flags & TDF_DETAILS))\n \t\t    {\n@@ -1458,7 +1460,7 @@ pass_store_merging::execute (function *fun)\n \t\t    }\n \n \t\t  /* Store aliases any existing chain?  */\n-\t\t  terminate_all_aliasing_chains (lhs, chain_info, false, stmt);\n+\t\t  terminate_all_aliasing_chains (chain_info, false, stmt);\n \t\t  /* Start a new chain.  */\n \t\t  struct imm_store_chain_info *new_chain\n \t\t    = new imm_store_chain_info (base_addr);\n@@ -1477,13 +1479,13 @@ pass_store_merging::execute (function *fun)\n \t\t    }\n \t\t}\n \t      else\n-\t\tterminate_all_aliasing_chains (lhs, chain_info,\n+\t\tterminate_all_aliasing_chains (chain_info,\n \t\t\t\t\t       offset != NULL_TREE, stmt);\n \n \t      continue;\n \t    }\n \n-\t  terminate_all_aliasing_chains (NULL_TREE, NULL, false, stmt);\n+\t  terminate_all_aliasing_chains (NULL, false, stmt);\n \t}\n       terminate_and_process_all_chains ();\n     }"}, {"sha": "242b51b3764ba964b9d5749ce6edefd9f41d65a6", "filename": "gcc/testsuite/ChangeLog", "status": "modified", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/20770eb80bf59f4fe1d71408b841669c70550e6c/gcc%2Ftestsuite%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/20770eb80bf59f4fe1d71408b841669c70550e6c/gcc%2Ftestsuite%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2FChangeLog?ref=20770eb80bf59f4fe1d71408b841669c70550e6c", "patch": "@@ -1,3 +1,8 @@\n+2016-11-07  Richard Biener  <rguenther@suse.de>\n+\n+\tPR tree-optimization/78218\n+\t* gcc.dg/torture/pr78218.c: New testcase.\n+\n 2016-11-07  Richard Biener  <rguenther@suse.de>\n \n \tPR tree-optimization/78228"}, {"sha": "b3e2892429d07ed1da0c0c02177119a97a9cac11", "filename": "gcc/testsuite/gcc.dg/torture/pr78218.c", "status": "added", "additions": 24, "deletions": 0, "changes": 24, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/20770eb80bf59f4fe1d71408b841669c70550e6c/gcc%2Ftestsuite%2Fgcc.dg%2Ftorture%2Fpr78218.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/20770eb80bf59f4fe1d71408b841669c70550e6c/gcc%2Ftestsuite%2Fgcc.dg%2Ftorture%2Fpr78218.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgcc.dg%2Ftorture%2Fpr78218.c?ref=20770eb80bf59f4fe1d71408b841669c70550e6c", "patch": "@@ -0,0 +1,24 @@\n+/* { dg-do run } */\n+\n+struct \n+{\n+  int v;\n+} a[2];\n+\n+int b; \n+\n+void __attribute__((noinline,noclone))\n+check ()\n+{\n+  if (a[0].v != 1)\n+    __builtin_abort ();\n+}\n+\n+int main ()\n+{\n+  a[1].v = 1;\n+  a[0] = a[1];\n+  a[1].v = 0;\n+  check (a);\n+  return 0;\n+}"}]}