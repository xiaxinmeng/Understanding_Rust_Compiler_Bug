{"sha": "c1c7f1fc21ff3b3ebbb8bf7eb91f68b2fec64d60", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6YzFjN2YxZmMyMWZmM2IzZWJiYjhiZjdlYjkxZjY4YjJmZWM2NGQ2MA==", "commit": {"author": {"name": "Patrick Palka", "email": "ppalka@gcc.gnu.org", "date": "2014-11-17T02:01:36Z"}, "committer": {"name": "Patrick Palka", "email": "ppalka@gcc.gnu.org", "date": "2014-11-17T02:01:36Z"}, "message": "Always combine comparisons or conversions from booleans.\n\n2014-11-16  Patrick Palka  <ppalka@gcc.gnu.org>\n\ngcc/\n\tPR middle-end/63790\n\t* tree-ssa-forwprop.c (forward_propagate_into_comparison_1):\n\tAlways combine comparisons or conversions from booleans.\n\ngcc/testsuite/\n\tPR middle-end/63790\n\t* gcc.dg/tree-ssa/pr21031.c: Drop XFAIL.\n\t* gcc.dg/tree-ssa/forwprop-29.c: New test.\n\nFrom-SVN: r217638", "tree": {"sha": "3ba9abd59af95a71bcd793ab1693a17da7c20e53", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/3ba9abd59af95a71bcd793ab1693a17da7c20e53"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/c1c7f1fc21ff3b3ebbb8bf7eb91f68b2fec64d60", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/c1c7f1fc21ff3b3ebbb8bf7eb91f68b2fec64d60", "html_url": "https://github.com/Rust-GCC/gccrs/commit/c1c7f1fc21ff3b3ebbb8bf7eb91f68b2fec64d60", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/c1c7f1fc21ff3b3ebbb8bf7eb91f68b2fec64d60/comments", "author": null, "committer": null, "parents": [{"sha": "6e2826178d775918fd0be177bdb8ae876f21965c", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/6e2826178d775918fd0be177bdb8ae876f21965c", "html_url": "https://github.com/Rust-GCC/gccrs/commit/6e2826178d775918fd0be177bdb8ae876f21965c"}], "stats": {"total": 59, "additions": 57, "deletions": 2}, "files": [{"sha": "de6db6dd5e6a0c0770b218ea1c5e96c1914c9197", "filename": "gcc/ChangeLog", "status": "modified", "additions": 6, "deletions": 0, "changes": 6, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/c1c7f1fc21ff3b3ebbb8bf7eb91f68b2fec64d60/gcc%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/c1c7f1fc21ff3b3ebbb8bf7eb91f68b2fec64d60/gcc%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2FChangeLog?ref=c1c7f1fc21ff3b3ebbb8bf7eb91f68b2fec64d60", "patch": "@@ -1,3 +1,9 @@\n+2014-11-16  Patrick Palka  <ppalka@gcc.gnu.org>\n+\n+\tPR middle-end/63790\n+\t* tree-ssa-forwprop.c (forward_propagate_into_comparison_1):\n+\tAlways combine comparisons or conversions from booleans.\n+\n 2014-11-16  Jan Hubicka  <hubicka@ucw.cz>\n \n \t* ipa-polymorphic-call.c"}, {"sha": "4ddc713a37ef9568a5c70dd70b47ee803edceabf", "filename": "gcc/testsuite/ChangeLog", "status": "modified", "additions": 6, "deletions": 0, "changes": 6, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/c1c7f1fc21ff3b3ebbb8bf7eb91f68b2fec64d60/gcc%2Ftestsuite%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/c1c7f1fc21ff3b3ebbb8bf7eb91f68b2fec64d60/gcc%2Ftestsuite%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2FChangeLog?ref=c1c7f1fc21ff3b3ebbb8bf7eb91f68b2fec64d60", "patch": "@@ -1,3 +1,9 @@\n+2014-11-16  Patrick Palka  <ppalka@gcc.gnu.org>\n+\n+\tPR middle-end/63790\n+\t* gcc.dg/tree-ssa/pr21031.c: Drop XFAIL.\n+\t* gcc.dg/tree-ssa/forwprop-29.c: New test.\n+\n 2014-11-16  Andrew Pinski  <apinski@cavium.com>\n \n \t* gcc.c-torture/execute/memset-4.c: New test."}, {"sha": "df5334e2d071158e085999ed7582f399007080a9", "filename": "gcc/testsuite/gcc.dg/tree-ssa/forwprop-29.c", "status": "added", "additions": 31, "deletions": 0, "changes": 31, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/c1c7f1fc21ff3b3ebbb8bf7eb91f68b2fec64d60/gcc%2Ftestsuite%2Fgcc.dg%2Ftree-ssa%2Fforwprop-29.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/c1c7f1fc21ff3b3ebbb8bf7eb91f68b2fec64d60/gcc%2Ftestsuite%2Fgcc.dg%2Ftree-ssa%2Fforwprop-29.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgcc.dg%2Ftree-ssa%2Fforwprop-29.c?ref=c1c7f1fc21ff3b3ebbb8bf7eb91f68b2fec64d60", "patch": "@@ -0,0 +1,31 @@\n+/* { dg-options \"-O2\" } */\n+\n+void runtime_error (void) __attribute__ ((noreturn));\n+void compiletime_error (void) __attribute__ ((noreturn, error (\"\")));\n+\n+static void\n+compiletime_check_equals_1 (int *x, int y)\n+{\n+  int __p = *x != y;\n+  if (__builtin_constant_p (__p) && __p)\n+    compiletime_error ();\n+  if (__p)\n+    runtime_error ();\n+}\n+\n+static void\n+compiletime_check_equals_2 (int *x, int y)\n+{\n+  int __p = *x != y;\n+  if (__builtin_constant_p (__p) && __p)\n+    compiletime_error (); /* { dg-error \"call to\" } */\n+  if (__p)\n+    runtime_error ();\n+}\n+\n+void\n+foo (int *x)\n+{\n+  compiletime_check_equals_1 (x, 5);\n+  compiletime_check_equals_2 (x, 10);\n+}"}, {"sha": "1ff182055364952d0921443a7bad6302ddd64fd9", "filename": "gcc/testsuite/gcc.dg/tree-ssa/pr21031.c", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/c1c7f1fc21ff3b3ebbb8bf7eb91f68b2fec64d60/gcc%2Ftestsuite%2Fgcc.dg%2Ftree-ssa%2Fpr21031.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/c1c7f1fc21ff3b3ebbb8bf7eb91f68b2fec64d60/gcc%2Ftestsuite%2Fgcc.dg%2Ftree-ssa%2Fpr21031.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgcc.dg%2Ftree-ssa%2Fpr21031.c?ref=c1c7f1fc21ff3b3ebbb8bf7eb91f68b2fec64d60", "patch": "@@ -16,5 +16,5 @@ foo (int a)\n     return 0;\n }\n \n-/* { dg-final { scan-tree-dump-times \"Replaced\" 2 \"forwprop1\" { xfail *-*-* } } } */\n+/* { dg-final { scan-tree-dump-times \"Replaced\" 2 \"forwprop1\" } } */\n /* { dg-final { cleanup-tree-dump \"forwprop1\" } } */"}, {"sha": "5b8c10e8f8e86276122f560112e50e55ede6dddd", "filename": "gcc/tree-ssa-forwprop.c", "status": "modified", "additions": 13, "deletions": 1, "changes": 14, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/c1c7f1fc21ff3b3ebbb8bf7eb91f68b2fec64d60/gcc%2Ftree-ssa-forwprop.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/c1c7f1fc21ff3b3ebbb8bf7eb91f68b2fec64d60/gcc%2Ftree-ssa-forwprop.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftree-ssa-forwprop.c?ref=c1c7f1fc21ff3b3ebbb8bf7eb91f68b2fec64d60", "patch": "@@ -442,9 +442,21 @@ forward_propagate_into_comparison_1 (gimple stmt,\n       gimple def_stmt = get_prop_source_stmt (op0, false, &single_use0_p);\n       if (def_stmt && can_propagate_from (def_stmt))\n \t{\n+\t  enum tree_code def_code = gimple_assign_rhs_code (def_stmt);\n+\t  bool invariant_only_p = !single_use0_p;\n+\n \t  rhs0 = rhs_to_tree (TREE_TYPE (op1), def_stmt);\n+\n+\t  /* Always combine comparisons or conversions from booleans.  */\n+\t  if (TREE_CODE (op1) == INTEGER_CST\n+\t      && ((CONVERT_EXPR_CODE_P (def_code)\n+\t\t   && TREE_CODE (TREE_TYPE (TREE_OPERAND (rhs0, 0)))\n+\t\t      == BOOLEAN_TYPE)\n+\t\t  || TREE_CODE_CLASS (def_code) == tcc_comparison))\n+\t    invariant_only_p = false;\n+\n \t  tmp = combine_cond_expr_cond (stmt, code, type,\n-\t\t\t\t\trhs0, op1, !single_use0_p);\n+\t\t\t\t\trhs0, op1, invariant_only_p);\n \t  if (tmp)\n \t    return tmp;\n \t}"}]}