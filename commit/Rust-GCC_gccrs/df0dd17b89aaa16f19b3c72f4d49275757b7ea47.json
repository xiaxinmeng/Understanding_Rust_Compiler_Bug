{"sha": "df0dd17b89aaa16f19b3c72f4d49275757b7ea47", "node_id": "C_kwDOANBUbNoAKGRmMGRkMTdiODlhYWExNmYxOWIzYzcyZjRkNDkyNzU3NTdiN2VhNDc", "commit": {"author": {"name": "Arthur Cohen", "email": "arthur.cohen@embecosm.com", "date": "2022-07-28T07:14:40Z"}, "committer": {"name": "Arthur Cohen", "email": "arthur.cohen@embecosm.com", "date": "2022-07-29T16:18:54Z"}, "message": "testsuite: Calls to transmute are unsafe", "tree": {"sha": "33ba26f2fa5e9640d1c9bbad7f89071a58609e8c", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/33ba26f2fa5e9640d1c9bbad7f89071a58609e8c"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/df0dd17b89aaa16f19b3c72f4d49275757b7ea47", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/df0dd17b89aaa16f19b3c72f4d49275757b7ea47", "html_url": "https://github.com/Rust-GCC/gccrs/commit/df0dd17b89aaa16f19b3c72f4d49275757b7ea47", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/df0dd17b89aaa16f19b3c72f4d49275757b7ea47/comments", "author": {"login": "CohenArthur", "id": 43524065, "node_id": "MDQ6VXNlcjQzNTI0MDY1", "avatar_url": "https://avatars.githubusercontent.com/u/43524065?v=4", "gravatar_id": "", "url": "https://api.github.com/users/CohenArthur", "html_url": "https://github.com/CohenArthur", "followers_url": "https://api.github.com/users/CohenArthur/followers", "following_url": "https://api.github.com/users/CohenArthur/following{/other_user}", "gists_url": "https://api.github.com/users/CohenArthur/gists{/gist_id}", "starred_url": "https://api.github.com/users/CohenArthur/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/CohenArthur/subscriptions", "organizations_url": "https://api.github.com/users/CohenArthur/orgs", "repos_url": "https://api.github.com/users/CohenArthur/repos", "events_url": "https://api.github.com/users/CohenArthur/events{/privacy}", "received_events_url": "https://api.github.com/users/CohenArthur/received_events", "type": "User", "site_admin": false}, "committer": {"login": "CohenArthur", "id": 43524065, "node_id": "MDQ6VXNlcjQzNTI0MDY1", "avatar_url": "https://avatars.githubusercontent.com/u/43524065?v=4", "gravatar_id": "", "url": "https://api.github.com/users/CohenArthur", "html_url": "https://github.com/CohenArthur", "followers_url": "https://api.github.com/users/CohenArthur/followers", "following_url": "https://api.github.com/users/CohenArthur/following{/other_user}", "gists_url": "https://api.github.com/users/CohenArthur/gists{/gist_id}", "starred_url": "https://api.github.com/users/CohenArthur/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/CohenArthur/subscriptions", "organizations_url": "https://api.github.com/users/CohenArthur/orgs", "repos_url": "https://api.github.com/users/CohenArthur/repos", "events_url": "https://api.github.com/users/CohenArthur/events{/privacy}", "received_events_url": "https://api.github.com/users/CohenArthur/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "2d824b796cde571d270f4c20af8183dbd93614d5", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/2d824b796cde571d270f4c20af8183dbd93614d5", "html_url": "https://github.com/Rust-GCC/gccrs/commit/2d824b796cde571d270f4c20af8183dbd93614d5"}], "stats": {"total": 27, "additions": 18, "deletions": 9}, "files": [{"sha": "5c2a9173241d38fdb45d78cda9aeae4b2b363067", "filename": "gcc/testsuite/rust/compile/issue-1173.rs", "status": "modified", "additions": 5, "deletions": 2, "changes": 7, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/df0dd17b89aaa16f19b3c72f4d49275757b7ea47/gcc%2Ftestsuite%2Frust%2Fcompile%2Fissue-1173.rs", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/df0dd17b89aaa16f19b3c72f4d49275757b7ea47/gcc%2Ftestsuite%2Frust%2Fcompile%2Fissue-1173.rs", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Frust%2Fcompile%2Fissue-1173.rs?ref=df0dd17b89aaa16f19b3c72f4d49275757b7ea47", "patch": "@@ -1,14 +1,17 @@\n // { dg-additional-options \"-w\" }\n+\n+#![feature(intrinsics)]\n+\n mod mem {\n     extern \"rust-intrinsic\" {\n-        fn transmute<U, V>(_: U) -> V;\n+        pub fn transmute<U, V>(_: U) -> V;\n     }\n }\n \n pub trait Hasher {\n     fn write(&mut self, bytes: &[u8]);\n     fn write_u16(&mut self, i: u16) {\n-        self.write(&mem::transmute::<_, [u8; 2]>(i))\n+        self.write(unsafe { &mem::transmute::<_, [u8; 2]>(i) })\n     }\n }\n "}, {"sha": "6704c0210d1a2484feb2bd7c231601918a1ac4c7", "filename": "gcc/testsuite/rust/compile/torture/intrinsics-1.rs", "status": "modified", "additions": 11, "deletions": 5, "changes": 16, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/df0dd17b89aaa16f19b3c72f4d49275757b7ea47/gcc%2Ftestsuite%2Frust%2Fcompile%2Ftorture%2Fintrinsics-1.rs", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/df0dd17b89aaa16f19b3c72f4d49275757b7ea47/gcc%2Ftestsuite%2Frust%2Fcompile%2Ftorture%2Fintrinsics-1.rs", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Frust%2Fcompile%2Ftorture%2Fintrinsics-1.rs?ref=df0dd17b89aaa16f19b3c72f4d49275757b7ea47", "patch": "@@ -1,16 +1,22 @@\n // { dg-additional-options -fdump-tree-original }\n \n+#![feature(intrinsics)]\n+\n extern \"rust-intrinsic\" {\n     pub fn sqrtf32(x: f32) -> f32;\n     pub fn sinf32(x: f32) -> f32;\n }\n \n fn main() {\n-    let mut f32;\n+    unsafe fn foo() {\n+        let mut f32;\n+\n+        f32 = sqrtf32(5f32);\n+        // { dg-final { scan-tree-dump-times {(?n)f32 = __builtin_sqrtf \\(5\\.0e\\+0\\);$} 1 original } }\n \n-    f32 = sqrtf32(5f32);\n-    // { dg-final { scan-tree-dump-times {(?n)f32 = __builtin_sqrtf \\(5\\.0e\\+0\\);$} 1 original } }\n+        f32 = sinf32(39f32);\n+        // { dg-final { scan-tree-dump-times {(?n)f32 = __builtin_sinf \\(3\\.9e\\+1\\);$} 1 original } }\n+    }\n \n-    f32 = sinf32(39f32);\n-    // { dg-final { scan-tree-dump-times {(?n)f32 = __builtin_sinf \\(3\\.9e\\+1\\);$} 1 original } }\n+    unsafe { foo() };\n }"}, {"sha": "461a35de8efd9a42de498b4f4961cd1a2bab3ea7", "filename": "gcc/testsuite/rust/compile/torture/transmute-size-check-1.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/df0dd17b89aaa16f19b3c72f4d49275757b7ea47/gcc%2Ftestsuite%2Frust%2Fcompile%2Ftorture%2Ftransmute-size-check-1.rs", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/df0dd17b89aaa16f19b3c72f4d49275757b7ea47/gcc%2Ftestsuite%2Frust%2Fcompile%2Ftorture%2Ftransmute-size-check-1.rs", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Frust%2Fcompile%2Ftorture%2Ftransmute-size-check-1.rs?ref=df0dd17b89aaa16f19b3c72f4d49275757b7ea47", "patch": "@@ -7,5 +7,5 @@ mod mem {\n \n fn main() {\n     let a = 123;\n-    let _b: [u32; mem::size_of::<i32>()] = mem::transmute(a);\n+    let _b: [u32; mem::size_of::<i32>()] = unsafe { mem::transmute(a) };\n }"}, {"sha": "af9a55d1b978e377609bc7d4e6a790136ad2f63b", "filename": "gcc/testsuite/rust/compile/torture/transmute1.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/df0dd17b89aaa16f19b3c72f4d49275757b7ea47/gcc%2Ftestsuite%2Frust%2Fcompile%2Ftorture%2Ftransmute1.rs", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/df0dd17b89aaa16f19b3c72f4d49275757b7ea47/gcc%2Ftestsuite%2Frust%2Fcompile%2Ftorture%2Ftransmute1.rs", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Frust%2Fcompile%2Ftorture%2Ftransmute1.rs?ref=df0dd17b89aaa16f19b3c72f4d49275757b7ea47", "patch": "@@ -7,5 +7,5 @@ mod mem {\n \n fn main() {\n     let a = 123;\n-    let _b: [u8; mem::size_of::<i32>()] = mem::transmute(a);\n+    let _b: [u8; mem::size_of::<i32>()] = unsafe { mem::transmute(a) };\n }"}]}