{"sha": "362432c00db860483058ff609a893151bf8e4b1c", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6MzYyNDMyYzAwZGI4NjA0ODMwNThmZjYwOWE4OTMxNTFiZjhlNGIxYw==", "commit": {"author": {"name": "Eric Botcazou", "email": "ebotcazou@gcc.gnu.org", "date": "2019-02-15T21:40:24Z"}, "committer": {"name": "Eric Botcazou", "email": "ebotcazou@gcc.gnu.org", "date": "2019-02-15T21:40:24Z"}, "message": "asan.c (asan_emit_stack_protection): Use full-sized mask to align the base address on 64-bit strict-alignment platforms.\n\n\t* asan.c (asan_emit_stack_protection): Use full-sized mask to align\n\tthe base address on 64-bit strict-alignment platforms.\n\nFrom-SVN: r268949", "tree": {"sha": "e19a433d3eed4a55aee8a47c74bcd0cdeac20a4c", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/e19a433d3eed4a55aee8a47c74bcd0cdeac20a4c"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/362432c00db860483058ff609a893151bf8e4b1c", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/362432c00db860483058ff609a893151bf8e4b1c", "html_url": "https://github.com/Rust-GCC/gccrs/commit/362432c00db860483058ff609a893151bf8e4b1c", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/362432c00db860483058ff609a893151bf8e4b1c/comments", "author": null, "committer": null, "parents": [{"sha": "dd66d9d71d71c2b48c109fdd7908b754b7594677", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/dd66d9d71d71c2b48c109fdd7908b754b7594677", "html_url": "https://github.com/Rust-GCC/gccrs/commit/dd66d9d71d71c2b48c109fdd7908b754b7594677"}], "stats": {"total": 20, "additions": 13, "deletions": 7}, "files": [{"sha": "63d1f4198694d66e180bef8fa85549c34867221d", "filename": "gcc/ChangeLog", "status": "modified", "additions": 6, "deletions": 2, "changes": 8, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/362432c00db860483058ff609a893151bf8e4b1c/gcc%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/362432c00db860483058ff609a893151bf8e4b1c/gcc%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2FChangeLog?ref=362432c00db860483058ff609a893151bf8e4b1c", "patch": "@@ -1,7 +1,11 @@\n+2019-02-15  Eric Botcazou  <ebotcazou@adacore.com>\n+\n+\t* asan.c (asan_emit_stack_protection): Use full-sized mask to align\n+\tthe base address on 64-bit strict-alignment platforms.\n+\n 2019-02-15  H.J. Lu  <hongjiu.lu@intel.com>\n \n-\t* config/i386/i386.h (VALID_MMX_REG_MODE): Correct the misplaced\n-\t')'.\n+\t* config/i386/i386.h (VALID_MMX_REG_MODE): Correct the misplaced ')'.\n \n 2019-02-15  Uro\u0161 Bizjak  <ubizjak@gmail.com>\n "}, {"sha": "3b800b26b6991c5a79116a7de838751b04db496a", "filename": "gcc/asan.c", "status": "modified", "additions": 7, "deletions": 5, "changes": 12, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/362432c00db860483058ff609a893151bf8e4b1c/gcc%2Fasan.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/362432c00db860483058ff609a893151bf8e4b1c/gcc%2Fasan.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fasan.c?ref=362432c00db860483058ff609a893151bf8e4b1c", "patch": "@@ -1440,13 +1440,15 @@ asan_emit_stack_protection (rtx base, rtx pbase, unsigned int alignb,\n \tbase_align_bias = ((asan_frame_size + alignb - 1)\n \t\t\t   & ~(alignb - HOST_WIDE_INT_1)) - asan_frame_size;\n     }\n+\n   /* Align base if target is STRICT_ALIGNMENT.  */\n   if (STRICT_ALIGNMENT)\n-    base = expand_binop (Pmode, and_optab, base,\n-\t\t\t gen_int_mode (-((GET_MODE_ALIGNMENT (SImode)\n-\t\t\t\t\t  << ASAN_SHADOW_SHIFT)\n-\t\t\t\t\t / BITS_PER_UNIT), Pmode), NULL_RTX,\n-\t\t\t 1, OPTAB_DIRECT);\n+    {\n+      const HOST_WIDE_INT align\n+\t= (GET_MODE_ALIGNMENT (SImode) / BITS_PER_UNIT) << ASAN_SHADOW_SHIFT;\n+      base = expand_binop (Pmode, and_optab, base, gen_int_mode (-align, Pmode),\n+\t\t\t   NULL_RTX, 1, OPTAB_DIRECT);\n+    }\n \n   if (use_after_return_class == -1 && pbase)\n     emit_move_insn (pbase, base);"}]}