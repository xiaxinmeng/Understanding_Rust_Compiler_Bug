{"sha": "fc2b84778bb51750c841f53b1ba30950935cc901", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6ZmMyYjg0Nzc4YmI1MTc1MGM4NDFmNTNiMWJhMzA5NTA5MzVjYzkwMQ==", "commit": {"author": {"name": "Mark Mitchell", "email": "mark@codesourcery.com", "date": "2003-08-29T23:11:14Z"}, "committer": {"name": "Mark Mitchell", "email": "mmitchel@gcc.gnu.org", "date": "2003-08-29T23:11:14Z"}, "message": "re PR middle-end/6196 (ICE in copy_to_mode_reg, at explow.c:711)\n\n\tPR c++/6196\n\t* pt.c (tsubst_copy_and_build): Correct handling of\n\taddress-of-label extension.\n\t* semantics.c (finish_goto_stmt): The address of a label must go\n\tthrough the lvalue-to-rvalue conversion.\n\n\tPR c++/6196\n\t* g++.dg/ext/label1.C: New test.\n\t* g++.dg/ext/label2.C: Likewise.\n\nFrom-SVN: r70932", "tree": {"sha": "9804609df286984088c3db599152fdef7af2c07f", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/9804609df286984088c3db599152fdef7af2c07f"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/fc2b84778bb51750c841f53b1ba30950935cc901", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/fc2b84778bb51750c841f53b1ba30950935cc901", "html_url": "https://github.com/Rust-GCC/gccrs/commit/fc2b84778bb51750c841f53b1ba30950935cc901", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/fc2b84778bb51750c841f53b1ba30950935cc901/comments", "author": null, "committer": null, "parents": [{"sha": "d560a41c5c43524d82795ac4421eab2df6764e30", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/d560a41c5c43524d82795ac4421eab2df6764e30", "html_url": "https://github.com/Rust-GCC/gccrs/commit/d560a41c5c43524d82795ac4421eab2df6764e30"}], "stats": {"total": 45, "additions": 38, "deletions": 7}, "files": [{"sha": "ff3518e069a3118945d858f2f84dd3de1c84f1af", "filename": "gcc/cp/pt.c", "status": "modified", "additions": 2, "deletions": 0, "changes": 2, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/fc2b84778bb51750c841f53b1ba30950935cc901/gcc%2Fcp%2Fpt.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/fc2b84778bb51750c841f53b1ba30950935cc901/gcc%2Fcp%2Fpt.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fcp%2Fpt.c?ref=fc2b84778bb51750c841f53b1ba30950935cc901", "patch": "@@ -7972,6 +7972,8 @@ tsubst_copy_and_build (tree t,\n       else\n \top1 = tsubst_non_call_postfix_expression (op1, args, complain, \n \t\t\t\t\t\t  in_decl);\n+      if (TREE_CODE (op1) == LABEL_DECL)\n+\treturn finish_label_address_expr (DECL_NAME (op1));\n       return build_x_unary_op (ADDR_EXPR, op1);\n \n     case PLUS_EXPR:"}, {"sha": "c38bdd3681a0677d1d8834e5b6c1d2dbd265146c", "filename": "gcc/cp/semantics.c", "status": "modified", "additions": 11, "deletions": 7, "changes": 18, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/fc2b84778bb51750c841f53b1ba30950935cc901/gcc%2Fcp%2Fsemantics.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/fc2b84778bb51750c841f53b1ba30950935cc901/gcc%2Fcp%2Fsemantics.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fcp%2Fsemantics.c?ref=fc2b84778bb51750c841f53b1ba30950935cc901", "patch": "@@ -378,13 +378,17 @@ finish_goto_stmt (tree destination)\n      mark the used labels as used.  */\n   if (TREE_CODE (destination) == LABEL_DECL)\n     TREE_USED (destination) = 1;\n-    \n-  if (TREE_CODE (destination) != LABEL_DECL)\n-    /* We don't inline calls to functions with computed gotos.\n-       Those functions are typically up to some funny business,\n-       and may be depending on the labels being at particular\n-       addresses, or some such.  */\n-    DECL_UNINLINABLE (current_function_decl) = 1;\n+  else\n+    {\n+      /* The DESTINATION is being used as an rvalue.  */\n+      if (!processing_template_decl)\n+\tdestination = decay_conversion (destination);\n+      /* We don't inline calls to functions with computed gotos.\n+\t Those functions are typically up to some funny business,\n+\t and may be depending on the labels being at particular\n+\t addresses, or some such.  */\n+      DECL_UNINLINABLE (current_function_decl) = 1;\n+    }\n   \n   check_goto (destination);\n "}, {"sha": "7b983d8e743b8da0f4b83df332834d459b9faf21", "filename": "gcc/testsuite/ChangeLog", "status": "modified", "additions": 6, "deletions": 0, "changes": 6, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/fc2b84778bb51750c841f53b1ba30950935cc901/gcc%2Ftestsuite%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/fc2b84778bb51750c841f53b1ba30950935cc901/gcc%2Ftestsuite%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2FChangeLog?ref=fc2b84778bb51750c841f53b1ba30950935cc901", "patch": "@@ -1,3 +1,9 @@\n+2003-08-29  Mark Mitchell  <mark@codesourcery.com>\n+\n+\tPR c++/6196\n+\t* g++.dg/ext/label1.C: New test.\n+\t* g++.dg/ext/label2.C: Likewise.\n+\n 2003-08-28  Mark Mitchell  <mark@codesourcery.com>\n \n \t* g++.dg/expr/cond3.C: New test."}, {"sha": "8c6684dce0e7dd4baa54842c1a3cf5ae36ed91b1", "filename": "gcc/testsuite/g++.dg/ext/label1.C", "status": "added", "additions": 8, "deletions": 0, "changes": 8, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/fc2b84778bb51750c841f53b1ba30950935cc901/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Fext%2Flabel1.C", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/fc2b84778bb51750c841f53b1ba30950935cc901/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Fext%2Flabel1.C", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Fext%2Flabel1.C?ref=fc2b84778bb51750c841f53b1ba30950935cc901", "patch": "@@ -0,0 +1,8 @@\n+// { dg-options \"\" }\n+\n+int main(void) {\n+  static const void* lbls[2][2] = {{&&lbl0, &&lbl0}, {&&lbl0, &&lbl0}};\n+  goto *lbls[0];\n+ lbl0:\n+  ;\n+}"}, {"sha": "1b66f603fe464c6ba55ea69edf54a2a7ff31456a", "filename": "gcc/testsuite/g++.dg/ext/label2.C", "status": "added", "additions": 11, "deletions": 0, "changes": 11, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/fc2b84778bb51750c841f53b1ba30950935cc901/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Fext%2Flabel2.C", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/fc2b84778bb51750c841f53b1ba30950935cc901/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Fext%2Flabel2.C", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Fext%2Flabel2.C?ref=fc2b84778bb51750c841f53b1ba30950935cc901", "patch": "@@ -0,0 +1,11 @@\n+// { dg-options \"\" }\n+\n+template <typename T>\n+void f() {\n+ l:\n+  void *p[] = { &&l };\n+\n+  goto *p;\n+}\n+\n+template void f<int>();"}]}