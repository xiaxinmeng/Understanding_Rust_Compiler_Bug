{"sha": "4616ef9b8517396fc1b4edd6d1fcdbe3705c0892", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6NDYxNmVmOWI4NTE3Mzk2ZmMxYjRlZGQ2ZDFmY2RiZTM3MDVjMDg5Mg==", "commit": {"author": {"name": "Mikael Morin", "email": "mikael@gcc.gnu.org", "date": "2011-11-03T23:45:19Z"}, "committer": {"name": "Mikael Morin", "email": "mikael@gcc.gnu.org", "date": "2011-11-03T23:45:19Z"}, "message": "trans.h (struct gfc_loopinfo): New field parent.\n\n\t* trans.h (struct gfc_loopinfo): New field parent.\n\t* trans-array.c (gfc_cleanup_loop): Free nested loops.\n\t(gfc_add_ss_to_loop): Set nested_loop's parent loop.\n\t(gfc_trans_array_constructor): Update assertion.\n\t(gfc_conv_loop_setup): Ditto.\n\nFrom-SVN: r180899", "tree": {"sha": "212b0b08d13637e33f555064283fb3ad084f5936", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/212b0b08d13637e33f555064283fb3ad084f5936"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/4616ef9b8517396fc1b4edd6d1fcdbe3705c0892", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/4616ef9b8517396fc1b4edd6d1fcdbe3705c0892", "html_url": "https://github.com/Rust-GCC/gccrs/commit/4616ef9b8517396fc1b4edd6d1fcdbe3705c0892", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/4616ef9b8517396fc1b4edd6d1fcdbe3705c0892/comments", "author": null, "committer": null, "parents": [{"sha": "30ae600f1fb18945d44e94a70c8818dcd63dbe07", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/30ae600f1fb18945d44e94a70c8818dcd63dbe07", "html_url": "https://github.com/Rust-GCC/gccrs/commit/30ae600f1fb18945d44e94a70c8818dcd63dbe07"}], "stats": {"total": 36, "additions": 36, "deletions": 0}, "files": [{"sha": "89ba5847fde3b4491e2f0114e644ce87cce30c70", "filename": "gcc/fortran/ChangeLog", "status": "modified", "additions": 8, "deletions": 0, "changes": 8, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/4616ef9b8517396fc1b4edd6d1fcdbe3705c0892/gcc%2Ffortran%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/4616ef9b8517396fc1b4edd6d1fcdbe3705c0892/gcc%2Ffortran%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ffortran%2FChangeLog?ref=4616ef9b8517396fc1b4edd6d1fcdbe3705c0892", "patch": "@@ -1,3 +1,11 @@\n+2011-11-03  Mikael Morin  <mikael@gcc.gnu.org>\n+\n+\t* trans.h (struct gfc_loopinfo): New field parent.\n+\t* trans-array.c (gfc_cleanup_loop): Free nested loops.\n+\t(gfc_add_ss_to_loop): Set nested_loop's parent loop.\n+\t(gfc_trans_array_constructor): Update assertion.\n+\t(gfc_conv_loop_setup): Ditto.\n+\n 2011-11-03  Mikael Morin  <mikael@gcc.gnu.org>\n \n \t* trans-array.c (gfc_add_loop_ss_code): Skip non-nestedmost ss."}, {"sha": "5659b70846e1949ad2a9f9d5322c5ab606d39b46", "filename": "gcc/fortran/trans-array.c", "status": "modified", "additions": 25, "deletions": 0, "changes": 25, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/4616ef9b8517396fc1b4edd6d1fcdbe3705c0892/gcc%2Ffortran%2Ftrans-array.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/4616ef9b8517396fc1b4edd6d1fcdbe3705c0892/gcc%2Ffortran%2Ftrans-array.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ffortran%2Ftrans-array.c?ref=4616ef9b8517396fc1b4edd6d1fcdbe3705c0892", "patch": "@@ -604,6 +604,7 @@ gfc_get_scalar_ss (gfc_ss *next, gfc_expr *expr)\n void\n gfc_cleanup_loop (gfc_loopinfo * loop)\n {\n+  gfc_loopinfo *loop_next, **ploop;\n   gfc_ss *ss;\n   gfc_ss *next;\n \n@@ -615,6 +616,23 @@ gfc_cleanup_loop (gfc_loopinfo * loop)\n       gfc_free_ss (ss);\n       ss = next;\n     }\n+\n+  /* Remove reference to self in the parent loop.  */\n+  if (loop->parent)\n+    for (ploop = &loop->parent->nested; *ploop; ploop = &(*ploop)->next)\n+      if (*ploop == loop)\n+\t{\n+\t  *ploop = loop->next;\n+\t  break;\n+\t}\n+\n+  /* Free non-freed nested loops.  */\n+  for (loop = loop->nested; loop; loop = loop_next)\n+    {\n+      loop_next = loop->next;\n+      gfc_cleanup_loop (loop);\n+      free (loop);\n+    }\n }\n \n \n@@ -664,10 +682,15 @@ gfc_add_ss_to_loop (gfc_loopinfo * loop, gfc_ss * head)\n \t     added one, to avoid duplicate nested loops.  */\n \t  if (nested_loop != loop->nested)\n \t    {\n+\t      gcc_assert (nested_loop->parent == NULL);\n+\t      nested_loop->parent = loop;\n+\n \t      gcc_assert (nested_loop->next == NULL);\n \t      nested_loop->next = loop->nested;\n \t      loop->nested = nested_loop;\n \t    }\n+\t  else\n+\t    gcc_assert (nested_loop->parent == loop);\n \t}\n \n       if (ss->next == gfc_ss_terminator)\n@@ -2158,6 +2181,7 @@ trans_array_constructor (gfc_ss * ss, locus * where)\n       mpz_t size;\n \n       /* We should have a 1-dimensional, zero-based loop.  */\n+      gcc_assert (loop->parent == NULL && loop->nested == NULL);\n       gcc_assert (loop->dimen == 1);\n       gcc_assert (integer_zerop (loop->from[0]));\n \n@@ -4302,6 +4326,7 @@ gfc_conv_loop_setup (gfc_loopinfo * loop, locus * where)\n \n       tmp_ss_info = tmp_ss->info;\n       gcc_assert (tmp_ss_info->type == GFC_SS_TEMP);\n+      gcc_assert (loop->parent == NULL);\n \n       /* Make absolutely sure that this is a complete type.  */\n       if (tmp_ss_info->string_length)"}, {"sha": "4d745f144ceb205db9c6aec76ad08c815a654e23", "filename": "gcc/fortran/trans.h", "status": "modified", "additions": 3, "deletions": 0, "changes": 3, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/4616ef9b8517396fc1b4edd6d1fcdbe3705c0892/gcc%2Ffortran%2Ftrans.h", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/4616ef9b8517396fc1b4edd6d1fcdbe3705c0892/gcc%2Ffortran%2Ftrans.h", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ffortran%2Ftrans.h?ref=4616ef9b8517396fc1b4edd6d1fcdbe3705c0892", "patch": "@@ -279,6 +279,9 @@ typedef struct gfc_loopinfo\n   /* The SS describing the temporary used in an assignment.  */\n   gfc_ss *temp_ss;\n \n+  /* Non-null if this loop is nested in another one.  */\n+  struct gfc_loopinfo *parent;\n+\n   /* Chain of nested loops.  */\n   struct gfc_loopinfo *nested, *next;\n "}]}