{"sha": "5db0241f0c3d3130a502d9c6a59713302a1377bf", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6NWRiMDI0MWYwYzNkMzEzMGE1MDJkOWM2YTU5NzEzMzAyYTEzNzdiZg==", "commit": {"author": {"name": "Jan Hubicka", "email": "jh@suse.cz", "date": "2004-09-25T23:21:07Z"}, "committer": {"name": "Jan Hubicka", "email": "hubicka@gcc.gnu.org", "date": "2004-09-25T23:21:07Z"}, "message": "profile.c (compute_branch_probabilities): Use REG_BR_PROB notes when re-constructing profile previously invalidated by loop.\n\n\t* profile.c (compute_branch_probabilities): Use REG_BR_PROB notes\n\twhen re-constructing profile previously invalidated by loop.\n\nFrom-SVN: r88115", "tree": {"sha": "4392e10fd036d9f719e777e135df217f0ac7eee9", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/4392e10fd036d9f719e777e135df217f0ac7eee9"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/5db0241f0c3d3130a502d9c6a59713302a1377bf", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/5db0241f0c3d3130a502d9c6a59713302a1377bf", "html_url": "https://github.com/Rust-GCC/gccrs/commit/5db0241f0c3d3130a502d9c6a59713302a1377bf", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/5db0241f0c3d3130a502d9c6a59713302a1377bf/comments", "author": null, "committer": null, "parents": [{"sha": "ffe2e220bdb8fee858045b645601923656864cc5", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/ffe2e220bdb8fee858045b645601923656864cc5", "html_url": "https://github.com/Rust-GCC/gccrs/commit/ffe2e220bdb8fee858045b645601923656864cc5"}], "stats": {"total": 23, "additions": 20, "deletions": 3}, "files": [{"sha": "7cd05ada7477b2743f4830df42d347d91557f11c", "filename": "gcc/ChangeLog", "status": "modified", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/5db0241f0c3d3130a502d9c6a59713302a1377bf/gcc%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/5db0241f0c3d3130a502d9c6a59713302a1377bf/gcc%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2FChangeLog?ref=5db0241f0c3d3130a502d9c6a59713302a1377bf", "patch": "@@ -1,3 +1,8 @@\n+2004-09-26  Jan Hubicka  <jh@suse.cz>\n+\n+\t* profile.c (compute_branch_probabilities): Use REG_BR_PROB notes\n+\twhen re-constructing profile previously invalidated by loop.\n+\n 2004-09-25  Dale Johannesen  <dalej@apple.com>\n \n \t* tree-gimple.c:  Move GIMPLE definition..."}, {"sha": "39d0493c6dd91dd417f656e996e081e9ea7bd7f3", "filename": "gcc/profile.c", "status": "modified", "additions": 15, "deletions": 3, "changes": 18, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/5db0241f0c3d3130a502d9c6a59713302a1377bf/gcc%2Fprofile.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/5db0241f0c3d3130a502d9c6a59713302a1377bf/gcc%2Fprofile.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fprofile.c?ref=5db0241f0c3d3130a502d9c6a59713302a1377bf", "patch": "@@ -557,12 +557,24 @@ compute_branch_probabilities (void)\n \t      num_branches++;\n \t    }\n \t}\n-      /* Otherwise distribute the probabilities evenly so we get sane\n-\t sum.  Use simple heuristics that if there are normal edges,\n+      /* Otherwise try to preserve the existing REG_BR_PROB probabilities\n+         tree based profile guessing put into code.  */\n+      else if (profile_status == PROFILE_ABSENT\n+\t       && !ir_type ()\n+\t       && bb->succ && bb->succ->succ_next\n+\t       && (note = find_reg_note (BB_END (bb), REG_BR_PROB, 0)))\n+\t{\n+\t  int prob = INTVAL (XEXP (note, 0));\n+\n+\t  BRANCH_EDGE (bb)->probability = prob;\n+\t  FALLTHRU_EDGE (bb)->probability = REG_BR_PROB_BASE - prob;\n+\t}\n+      /* As a last resolt, distribute the probabilities evenly.\n+\t Use simple heuristics that if there are normal edges,\n \t give all abnormals frequency of 0, otherwise distribute the\n \t frequency over abnormals (this is the case of noreturn\n \t calls).  */\n-      else\n+      else if (profile_status == PROFILE_ABSENT)\n \t{\n \t  int total = 0;\n "}]}