{"sha": "da942ca0e2814f1f7420e508e80d9939cf799390", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6ZGE5NDJjYTBlMjgxNGYxZjc0MjBlNTA4ZTgwZDk5MzljZjc5OTM5MA==", "commit": {"author": {"name": "Jan Hubicka", "email": "jh@suse.cz", "date": "2012-12-19T11:42:30Z"}, "committer": {"name": "Jan Hubicka", "email": "hubicka@gcc.gnu.org", "date": "2012-12-19T11:42:30Z"}, "message": "re PR tree-optimization/55683 (ICE in inline_call, at ipa-inline-transform.c:270)\n\n\n\tPR tree-optimization/55683\n\t* g++.dg/ipa/devirt-9.C: New testcase.\n\n\t* ipa-prop.c (try_make_edge_direct_virtual_call): Look into constants for binfo.\n\nFrom-SVN: r194606", "tree": {"sha": "b4a6cf8d09ece86719d87f79f3bcfca0c7c4a6da", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/b4a6cf8d09ece86719d87f79f3bcfca0c7c4a6da"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/da942ca0e2814f1f7420e508e80d9939cf799390", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/da942ca0e2814f1f7420e508e80d9939cf799390", "html_url": "https://github.com/Rust-GCC/gccrs/commit/da942ca0e2814f1f7420e508e80d9939cf799390", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/da942ca0e2814f1f7420e508e80d9939cf799390/comments", "author": null, "committer": null, "parents": [{"sha": "47b33e4c65161d94faafc23832ea9d1978f339f9", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/47b33e4c65161d94faafc23832ea9d1978f339f9", "html_url": "https://github.com/Rust-GCC/gccrs/commit/47b33e4c65161d94faafc23832ea9d1978f339f9"}], "stats": {"total": 49, "additions": 48, "deletions": 1}, "files": [{"sha": "694062f727406c86b233cda681bf7b8a6657e196", "filename": "gcc/ChangeLog", "status": "modified", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/da942ca0e2814f1f7420e508e80d9939cf799390/gcc%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/da942ca0e2814f1f7420e508e80d9939cf799390/gcc%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2FChangeLog?ref=da942ca0e2814f1f7420e508e80d9939cf799390", "patch": "@@ -1,3 +1,8 @@\n+2012-12-18  Jan Hubicka  <jh@suse.cz>\n+\n+\tPR tree-optimization/55683\n+\t* ipa-prop.c (try_make_edge_direct_virtual_call): Look into constants for binfo.\n+\n 2012-12-19  Terry Guo  <terry.guo@arm.com>\n \n \t* config/arm/arm.c (thumb_find_work_register): Check argument"}, {"sha": "4f887a0acc4974cc73cf65915ff74d36edb1e738", "filename": "gcc/ipa-prop.c", "status": "modified", "additions": 8, "deletions": 1, "changes": 9, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/da942ca0e2814f1f7420e508e80d9939cf799390/gcc%2Fipa-prop.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/da942ca0e2814f1f7420e508e80d9939cf799390/gcc%2Fipa-prop.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fipa-prop.c?ref=da942ca0e2814f1f7420e508e80d9939cf799390", "patch": "@@ -2223,9 +2223,16 @@ try_make_edge_direct_virtual_call (struct cgraph_edge *ie,\n \n   binfo = ipa_value_from_jfunc (new_root_info, jfunc);\n \n-  if (!binfo || TREE_CODE (binfo) != TREE_BINFO)\n+  if (!binfo)\n     return NULL;\n \n+  if (TREE_CODE (binfo) != TREE_BINFO)\n+    {\n+      binfo = gimple_extract_devirt_binfo_from_cst (binfo);\n+      if (!binfo)\n+        return NULL;\n+    }\n+\n   binfo = get_binfo_at_offset (binfo, ie->indirect_info->offset,\n \t\t\t       ie->indirect_info->otr_type);\n   if (binfo)"}, {"sha": "0a8580c4d8ff24fd193dc3c2d16aa542a8482490", "filename": "gcc/testsuite/ChangeLog", "status": "modified", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/da942ca0e2814f1f7420e508e80d9939cf799390/gcc%2Ftestsuite%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/da942ca0e2814f1f7420e508e80d9939cf799390/gcc%2Ftestsuite%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2FChangeLog?ref=da942ca0e2814f1f7420e508e80d9939cf799390", "patch": "@@ -1,3 +1,8 @@\n+2012-12-18  Jan Hubicka  <jh@suse.cz>\n+\n+\tPR tree-optimization/55683\n+\t* g++.dg/ipa/devirt-9.C: New testcase.\n+\n 2012-12-19  Terry Guo  <terry.guo@arm.com>\n \n \t* gcc.target/arm/thumb-find-work-register.c: New."}, {"sha": "62ea96e5eed48b57d7957ad1eb234957835b1e65", "filename": "gcc/testsuite/g++.dg/ipa/devirt-9.C", "status": "added", "additions": 30, "deletions": 0, "changes": 30, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/da942ca0e2814f1f7420e508e80d9939cf799390/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Fipa%2Fdevirt-9.C", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/da942ca0e2814f1f7420e508e80d9939cf799390/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Fipa%2Fdevirt-9.C", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Fipa%2Fdevirt-9.C?ref=da942ca0e2814f1f7420e508e80d9939cf799390", "patch": "@@ -0,0 +1,30 @@\n+/* { dg-do compile } */\n+/* { dg-options \"-O2 -fdump-ipa-inline\"  } */\n+double foo ();\n+struct B\n+{\n+  bool b1 () { return b3 (); }\n+  void b2 ();\n+  virtual bool b3 ();\n+};\n+struct C\n+{\n+  C () {}\n+  bool\n+  c1 (float x, float y)\n+  {\n+    if (x != c3 || y != c4)\n+      c2.b2 ();\n+    return c2.b1 ();\n+  }\n+  B c2;\n+  float c3, c4;\n+};\n+\n+void\n+bar ()\n+{\n+  static C c;\n+  c.c1 (60, (int) foo ());\n+}\n+/* { dg-final { scan-ipa-dump \"Discovered a virtual call to a known target\"  \"inline\"  } } */"}]}