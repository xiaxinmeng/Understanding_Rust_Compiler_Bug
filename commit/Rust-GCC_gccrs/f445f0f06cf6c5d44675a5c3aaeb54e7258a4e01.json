{"sha": "f445f0f06cf6c5d44675a5c3aaeb54e7258a4e01", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6ZjQ0NWYwZjA2Y2Y2YzVkNDQ2NzVhNWMzYWFlYjU0ZTcyNThhNGUwMQ==", "commit": {"author": {"name": "Jonathan Wakely", "email": "jwakely@redhat.com", "date": "2019-05-21T13:50:41Z"}, "committer": {"name": "Jonathan Wakely", "email": "redi@gcc.gnu.org", "date": "2019-05-21T13:50:41Z"}, "message": "PR libstdc++/90252 fix effective-target check for TBB\n\n\tPR libstdc++/90252\n\t* testsuite/lib/libstdc++.exp (check_effective_target_tbb-backend):\n\tUse \"additional_flags\" to pass -ltbb to v3_target_compile command.\n\tUse check_v3_target_prop_cached to cache the result of the test.\n\nFrom-SVN: r271466", "tree": {"sha": "ff0d6b01df3a61d9e69b15e665657242686a076e", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/ff0d6b01df3a61d9e69b15e665657242686a076e"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/f445f0f06cf6c5d44675a5c3aaeb54e7258a4e01", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/f445f0f06cf6c5d44675a5c3aaeb54e7258a4e01", "html_url": "https://github.com/Rust-GCC/gccrs/commit/f445f0f06cf6c5d44675a5c3aaeb54e7258a4e01", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/f445f0f06cf6c5d44675a5c3aaeb54e7258a4e01/comments", "author": {"login": "jwakely", "id": 1254480, "node_id": "MDQ6VXNlcjEyNTQ0ODA=", "avatar_url": "https://avatars.githubusercontent.com/u/1254480?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jwakely", "html_url": "https://github.com/jwakely", "followers_url": "https://api.github.com/users/jwakely/followers", "following_url": "https://api.github.com/users/jwakely/following{/other_user}", "gists_url": "https://api.github.com/users/jwakely/gists{/gist_id}", "starred_url": "https://api.github.com/users/jwakely/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jwakely/subscriptions", "organizations_url": "https://api.github.com/users/jwakely/orgs", "repos_url": "https://api.github.com/users/jwakely/repos", "events_url": "https://api.github.com/users/jwakely/events{/privacy}", "received_events_url": "https://api.github.com/users/jwakely/received_events", "type": "User", "site_admin": false}, "committer": {"login": "jwakely", "id": 1254480, "node_id": "MDQ6VXNlcjEyNTQ0ODA=", "avatar_url": "https://avatars.githubusercontent.com/u/1254480?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jwakely", "html_url": "https://github.com/jwakely", "followers_url": "https://api.github.com/users/jwakely/followers", "following_url": "https://api.github.com/users/jwakely/following{/other_user}", "gists_url": "https://api.github.com/users/jwakely/gists{/gist_id}", "starred_url": "https://api.github.com/users/jwakely/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jwakely/subscriptions", "organizations_url": "https://api.github.com/users/jwakely/orgs", "repos_url": "https://api.github.com/users/jwakely/repos", "events_url": "https://api.github.com/users/jwakely/events{/privacy}", "received_events_url": "https://api.github.com/users/jwakely/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "049f115abb8dbb847762c1348c583ece886c0a32", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/049f115abb8dbb847762c1348c583ece886c0a32", "html_url": "https://github.com/Rust-GCC/gccrs/commit/049f115abb8dbb847762c1348c583ece886c0a32"}], "stats": {"total": 60, "additions": 32, "deletions": 28}, "files": [{"sha": "804bace5e032dc784886d5fd81b4631fd965275b", "filename": "libstdc++-v3/ChangeLog", "status": "modified", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/f445f0f06cf6c5d44675a5c3aaeb54e7258a4e01/libstdc%2B%2B-v3%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/f445f0f06cf6c5d44675a5c3aaeb54e7258a4e01/libstdc%2B%2B-v3%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libstdc%2B%2B-v3%2FChangeLog?ref=f445f0f06cf6c5d44675a5c3aaeb54e7258a4e01", "patch": "@@ -1,5 +1,10 @@\n 2019-05-21  Jonathan Wakely  <jwakely@redhat.com>\n \n+\tPR libstdc++/90252\n+\t* testsuite/lib/libstdc++.exp (check_effective_target_tbb-backend):\n+\tUse \"additional_flags\" to pass -ltbb to v3_target_compile command.\n+\tUse check_v3_target_prop_cached to cache the result of the test.\n+\n \t* doc/xml/manual/shared_ptr.xml: Fix names of lock policy constants.\n \n 2019-05-20  Thomas Rodgers  <trodgers@redhat.com>"}, {"sha": "868a7cf7aeceb1795fc1f7ad9e16b0ade1e861fe", "filename": "libstdc++-v3/testsuite/lib/libstdc++.exp", "status": "modified", "additions": 27, "deletions": 28, "changes": 55, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/f445f0f06cf6c5d44675a5c3aaeb54e7258a4e01/libstdc%2B%2B-v3%2Ftestsuite%2Flib%2Flibstdc%2B%2B.exp", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/f445f0f06cf6c5d44675a5c3aaeb54e7258a4e01/libstdc%2B%2B-v3%2Ftestsuite%2Flib%2Flibstdc%2B%2B.exp", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libstdc%2B%2B-v3%2Ftestsuite%2Flib%2Flibstdc%2B%2B.exp?ref=f445f0f06cf6c5d44675a5c3aaeb54e7258a4e01", "patch": "@@ -1581,34 +1581,33 @@ proc check_effective_target_random_device { } {\n \n # Return 1 if tbb parallel backend is available\n proc check_effective_target_tbb-backend { } {\n-    global cxxflags\n-\n-    # Set up and preprocess a C++ test program that depends\n-    # on tbb\n-    set src tbb_backend[pid].cc\n-    set exe tbb_backend[pid].x\n-    \n-    set f [open $src \"w\"]\n-    puts $f \"#include <tbb/tbb.h>\"\n-    puts $f \"#if TBB_INTERFACE_VERSION < 10000\"\n-    puts $f \"#  error Intel(R) Threading Building Blocks 2018 is required; older versions are not supported.\"\n-    puts $f \"#endif\"\n-    puts $f \"int main ()\"\n-    puts $f \"{\"\n-    puts $f \"  return 0;\"\n-    puts $f \"}\"\n-    close $f\n-    \n-    set lines [v3_target_compile $src $exe executable \"-ltbb\"]\n-    file delete $src\n-\n-    if [string match \"\" $lines] {\n-\t# No error message, preprocessing succeeded.\n-\tverbose \"check_v3_tbb-backend: `1'\" 2\n-\treturn 1\n-    }\n-    verbose \"check_v3_tbb-backend: `0'\" 2\n-    return 0\n+    return [check_v3_target_prop_cached et_tbb {\n+        # Set up and compile a C++ test program that depends on tbb\n+        set src tbb_backend[pid].cc\n+        set exe tbb_backend[pid].x\n+\n+        set f [open $src \"w\"]\n+        puts $f \"#include <tbb/tbb.h>\"\n+        puts $f \"#if TBB_INTERFACE_VERSION < 10000\"\n+        puts $f \"#  error Intel(R) Threading Building Blocks 2018 is required; older versions are not supported.\"\n+        puts $f \"#endif\"\n+        puts $f \"int main ()\"\n+        puts $f \"{\"\n+        puts $f \"  return 0;\"\n+        puts $f \"}\"\n+        close $f\n+\n+        set lines [v3_target_compile $src $exe executable \"additional_flags=-std=c++17 additional_flags=-ltbb\"]\n+        file delete $src\n+\n+        if [string match \"\" $lines] {\n+            # No error message, compilation succeeded.\n+            verbose \"check_v3_tbb-backend: `1'\" 2\n+            return 1\n+        }\n+        verbose \"check_v3_tbb-backend: `0'\" 2\n+        return 0\n+    }]\n }\n \n set additional_prunes \"\""}]}