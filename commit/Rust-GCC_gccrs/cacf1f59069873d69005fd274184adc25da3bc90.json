{"sha": "cacf1f59069873d69005fd274184adc25da3bc90", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6Y2FjZjFmNTkwNjk4NzNkNjkwMDVmZDI3NDE4NGFkYzI1ZGEzYmM5MA==", "commit": {"author": {"name": "Jakub Jelinek", "email": "jakub@redhat.com", "date": "2015-04-10T06:43:52Z"}, "committer": {"name": "Iain Sandoe", "email": "iains@gcc.gnu.org", "date": "2015-04-10T06:43:52Z"}, "message": "re PR target/65351 (libiberty's pic version contains non-pic code on m32 darwin; causes bootstrap fail building libcc1.)\n\n\tPR target/65351\nconfig/\n\t* mh-darwin: Only apply -mdynamic-no-pic for m32 Darwin when the compiler in\n\tuse supports -mno-dynamic-no-pic.\n\t* picflag.m4: Only append -mno-dynamic-no-pic for Darwin when -mdynamic-no-pic\n\tis present in CFLAGS.\n\nlibiberty/\n\t* configure: Regenerate.\nlibada/\n\t* configure: Regenerate.\nlibgcc/\n\t* configure: Regenerate.\ngcc/\n\t* configure: Regenerate.\n\n\nCo-Authored-By: Iain Sandoe <iain@codesourcery.com>\n\nFrom-SVN: r221967", "tree": {"sha": "7b815277dd56cf4c4aa0686897089fe68d9e2937", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/7b815277dd56cf4c4aa0686897089fe68d9e2937"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/cacf1f59069873d69005fd274184adc25da3bc90", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/cacf1f59069873d69005fd274184adc25da3bc90", "html_url": "https://github.com/Rust-GCC/gccrs/commit/cacf1f59069873d69005fd274184adc25da3bc90", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/cacf1f59069873d69005fd274184adc25da3bc90/comments", "author": {"login": "jakubjelinek", "id": 9370665, "node_id": "MDQ6VXNlcjkzNzA2NjU=", "avatar_url": "https://avatars.githubusercontent.com/u/9370665?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jakubjelinek", "html_url": "https://github.com/jakubjelinek", "followers_url": "https://api.github.com/users/jakubjelinek/followers", "following_url": "https://api.github.com/users/jakubjelinek/following{/other_user}", "gists_url": "https://api.github.com/users/jakubjelinek/gists{/gist_id}", "starred_url": "https://api.github.com/users/jakubjelinek/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jakubjelinek/subscriptions", "organizations_url": "https://api.github.com/users/jakubjelinek/orgs", "repos_url": "https://api.github.com/users/jakubjelinek/repos", "events_url": "https://api.github.com/users/jakubjelinek/events{/privacy}", "received_events_url": "https://api.github.com/users/jakubjelinek/received_events", "type": "User", "site_admin": false}, "committer": {"login": "iains", "id": 4039407, "node_id": "MDQ6VXNlcjQwMzk0MDc=", "avatar_url": "https://avatars.githubusercontent.com/u/4039407?v=4", "gravatar_id": "", "url": "https://api.github.com/users/iains", "html_url": "https://github.com/iains", "followers_url": "https://api.github.com/users/iains/followers", "following_url": "https://api.github.com/users/iains/following{/other_user}", "gists_url": "https://api.github.com/users/iains/gists{/gist_id}", "starred_url": "https://api.github.com/users/iains/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/iains/subscriptions", "organizations_url": "https://api.github.com/users/iains/orgs", "repos_url": "https://api.github.com/users/iains/repos", "events_url": "https://api.github.com/users/iains/events{/privacy}", "received_events_url": "https://api.github.com/users/iains/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "c620a1686faf1e546d292515be12f3c94421e212", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/c620a1686faf1e546d292515be12f3c94421e212", "html_url": "https://github.com/Rust-GCC/gccrs/commit/c620a1686faf1e546d292515be12f3c94421e212"}], "stats": {"total": 138, "additions": 101, "deletions": 37}, "files": [{"sha": "a2225cdab705e217b12540767b5aa5c788420378", "filename": "config/ChangeLog", "status": "modified", "additions": 9, "deletions": 0, "changes": 9, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/cacf1f59069873d69005fd274184adc25da3bc90/config%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/cacf1f59069873d69005fd274184adc25da3bc90/config%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/config%2FChangeLog?ref=cacf1f59069873d69005fd274184adc25da3bc90", "patch": "@@ -1,3 +1,12 @@\n+2015-04-10  Jakub Jelinek  <jakub@redhat.com>\n+\t    Iain Sandoe  <iain@codesourcery.com>\n+\n+\tPR target/65351\n+\t* mh-darwin: Only apply -mdynamic-no-pic for m32 Darwin when the\n+\tcompiler in use supports -mno-dynamic-no-pic.\n+\t* picflag.m4: Only append -mno-dynamic-no-pic for Darwin when\n+\t-mdynamic-no-pic is present in CFLAGS.\n+\n 2015-04-07  Jakub Jelinek  <jakub@redhat.com>\n \t    Iain Sandoe  <iain@codesourcery.com>\n "}, {"sha": "148b73038c3e429a671d04b1c62eff79220435a7", "filename": "config/mh-darwin", "status": "modified", "additions": 21, "deletions": 10, "changes": 31, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/cacf1f59069873d69005fd274184adc25da3bc90/config%2Fmh-darwin", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/cacf1f59069873d69005fd274184adc25da3bc90/config%2Fmh-darwin", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/config%2Fmh-darwin?ref=cacf1f59069873d69005fd274184adc25da3bc90", "patch": "@@ -1,18 +1,29 @@\n # The -mdynamic-no-pic ensures that the compiler executable is built without\n # position-independent-code -- the usual default on Darwin. This fix speeds\n-# compiles by 3-5%.\n-BOOT_CFLAGS += \\\n+# compiles by 3-5%.  Don't add it if the compiler doesn't also support\n+# -mno-dynamic-no-pic to undo it.\n+DARWIN_MDYNAMIC_NO_PIC := \\\n `case ${host} in i?86-*-darwin* | powerpc-*-darwin*) \\\n-                 echo -mdynamic-no-pic ;; esac;`\n+   $(CC) -S -xc /dev/null -o /dev/null -mno-dynamic-no-pic 2>/dev/null \\\n+   && echo -mdynamic-no-pic ;; esac`\n+DARWIN_GCC_MDYNAMIC_NO_PIC := \\\n+`case ${host} in i?86-*-darwin* | powerpc-*-darwin*) \\\n+   $(CC) -S -xc /dev/null -o /dev/null -mno-dynamic-no-pic 2>/dev/null \\\n+   || echo -mdynamic-no-pic ;; esac`\n \n # ld on Darwin versions >= 10.7 defaults to PIE executables. Disable this for\n # gcc components, since it is incompatible with our pch implementation.\n-BOOT_LDFLAGS += \\\n-`case ${host} in *-*-darwin[1][1-9]*) echo -Wl,-no_pie ;; esac;`\n+DARWIN_NO_PIE := `case ${host} in *-*-darwin[1][1-9]*) echo -Wl,-no_pie ;; esac;`\n+\n+BOOT_CFLAGS += $(DARWIN_MDYNAMIC_NO_PIC)\n+BOOT_LDFLAGS += $(DARWIN_NO_PIE)\n \n # Similarly, for cross-compilation.\n-STAGE1_CFLAGS += \\\n-`case ${host} in i?86-*-darwin* | powerpc-*-darwin*)\\\n-                 echo -mdynamic-no-pic ;; esac;`\n-STAGE1_LDFLAGS += \\\n-`case ${host} in *-*-darwin[1][1-9]*) echo -Wl,-no_pie ;; esac;`\n+STAGE1_CFLAGS += $(DARWIN_MDYNAMIC_NO_PIC)\n+STAGE1_LDFLAGS += $(DARWIN_NO_PIE)\n+\n+# Without -mno-dynamic-no-pic support, add -mdynamic-no-pic just to later\n+# stages when we know it is built with gcc.\n+STAGE2_CFLAGS += $(DARWIN_GCC_MDYNAMIC_NO_PIC)\n+STAGE3_CFLAGS += $(DARWIN_GCC_MDYNAMIC_NO_PIC)\n+STAGE4_CFLAGS += $(DARWIN_GCC_MDYNAMIC_NO_PIC)"}, {"sha": "2f5b9721eb2fa8f6058beb9a15585612df49bb13", "filename": "config/picflag.m4", "status": "modified", "additions": 9, "deletions": 5, "changes": 14, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/cacf1f59069873d69005fd274184adc25da3bc90/config%2Fpicflag.m4", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/cacf1f59069873d69005fd274184adc25da3bc90/config%2Fpicflag.m4", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/config%2Fpicflag.m4?ref=cacf1f59069873d69005fd274184adc25da3bc90", "patch": "@@ -7,11 +7,15 @@ AC_DEFUN([_GCC_PICFLAG], [\n case \"${$2}\" in\n     # PIC is the default on some targets or must not be used.\n     *-*-darwin*)\n-\t# PIC is the default on this platform\n-\t# Common symbols not allowed in MH_DYLIB files\n-\t# Cancel any earlier -mdynamic-no-pic, as that makes\n-\t# the code not suitable for shared libraries.\n-\t$1='-fno-common -mno-dynamic-no-pic'\n+\t# For darwin, common symbols are not allowed in MH_DYLIB files\n+\tcase \"${CFLAGS}\" in\n+\t  # If we are using a compiler supporting mdynamic-no-pic\n+\t  # and the option has been tested as safe to add, then cancel\n+\t  # it here, since the code generated is incompatible with shared\n+\t  #\u00a0libs.\n+\t  *-mdynamic-no-pic*) $1='-fno-common -mno-dynamic-no-pic' ;;\n+\t  *) $1=-fno-common ;;\n+\tesac\n \t;;\n     alpha*-dec-osf5*)\n \t# PIC is the default."}, {"sha": "ac2604220f5ac45f245106e115c616740d2815dd", "filename": "gcc/ChangeLog", "status": "modified", "additions": 6, "deletions": 0, "changes": 6, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/cacf1f59069873d69005fd274184adc25da3bc90/gcc%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/cacf1f59069873d69005fd274184adc25da3bc90/gcc%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2FChangeLog?ref=cacf1f59069873d69005fd274184adc25da3bc90", "patch": "@@ -1,3 +1,9 @@\n+2015-04-10  Jakub Jelinek  <jakub@redhat.com>\n+\t    Iain Sandoe  <iain@codesourcery.com>\n+\n+\tPR target/65351\n+\t* configure: Regenerate.\n+\n 2015-04-09  Kirill Yukhin  <kirill.yukhin@intel.com>\n \n \tPR target/65671"}, {"sha": "9523773e721bd8dd162aca96671a29d037bc10c2", "filename": "gcc/configure", "status": "modified", "additions": 11, "deletions": 7, "changes": 18, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/cacf1f59069873d69005fd274184adc25da3bc90/gcc%2Fconfigure", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/cacf1f59069873d69005fd274184adc25da3bc90/gcc%2Fconfigure", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fconfigure?ref=cacf1f59069873d69005fd274184adc25da3bc90", "patch": "@@ -4786,11 +4786,15 @@ esac\n case \"${target}\" in\n     # PIC is the default on some targets or must not be used.\n     *-*-darwin*)\n-\t# PIC is the default on this platform\n-\t# Common symbols not allowed in MH_DYLIB files\n-\t# Cancel any earlier -mdynamic-no-pic, as that makes\n-\t# the code not suitable for shared libraries.\n-\tPICFLAG_FOR_TARGET='-fno-common -mno-dynamic-no-pic'\n+\t# For darwin, common symbols are not allowed in MH_DYLIB files\n+\tcase \"${CFLAGS}\" in\n+\t  # If we are using a compiler supporting mdynamic-no-pic\n+\t  # and the option has been tested as safe to add, then cancel\n+\t  # it here, since the code generated is incompatible with shared\n+\t  #\u00a0libs.\n+\t  *-mdynamic-no-pic*) PICFLAG_FOR_TARGET='-fno-common -mno-dynamic-no-pic' ;;\n+\t  *) PICFLAG_FOR_TARGET=-fno-common ;;\n+\tesac\n \t;;\n     alpha*-dec-osf5*)\n \t# PIC is the default.\n@@ -18149,7 +18153,7 @@ else\n   lt_dlunknown=0; lt_dlno_uscore=1; lt_dlneed_uscore=2\n   lt_status=$lt_dlunknown\n   cat > conftest.$ac_ext <<_LT_EOF\n-#line 18152 \"configure\"\n+#line 18156 \"configure\"\n #include \"confdefs.h\"\n \n #if HAVE_DLFCN_H\n@@ -18255,7 +18259,7 @@ else\n   lt_dlunknown=0; lt_dlno_uscore=1; lt_dlneed_uscore=2\n   lt_status=$lt_dlunknown\n   cat > conftest.$ac_ext <<_LT_EOF\n-#line 18258 \"configure\"\n+#line 18262 \"configure\"\n #include \"confdefs.h\"\n \n #if HAVE_DLFCN_H"}, {"sha": "5c006de6f43e2e21a2d9c0fa048ad68543711376", "filename": "libada/ChangeLog", "status": "modified", "additions": 6, "deletions": 0, "changes": 6, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/cacf1f59069873d69005fd274184adc25da3bc90/libada%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/cacf1f59069873d69005fd274184adc25da3bc90/libada%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libada%2FChangeLog?ref=cacf1f59069873d69005fd274184adc25da3bc90", "patch": "@@ -1,3 +1,9 @@\n+2015-04-10  Jakub Jelinek  <jakub@redhat.com>\n+\t    Iain Sandoe  <iain@codesourcery.com>\n+\n+\tPR target/65351\n+\t* configure: Regenerate.\n+\n 2015-04-07  Jakub Jelinek  <jakub@redhat.com>\n \t    Iain Sandoe  <iain@codesourcery.com>\n "}, {"sha": "2296096d4d242fa78ab0e89a626980a0023b63c0", "filename": "libada/configure", "status": "modified", "additions": 9, "deletions": 5, "changes": 14, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/cacf1f59069873d69005fd274184adc25da3bc90/libada%2Fconfigure", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/cacf1f59069873d69005fd274184adc25da3bc90/libada%2Fconfigure", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libada%2Fconfigure?ref=cacf1f59069873d69005fd274184adc25da3bc90", "patch": "@@ -2824,11 +2824,15 @@ fi\n case \"${host}\" in\n     # PIC is the default on some targets or must not be used.\n     *-*-darwin*)\n-\t# PIC is the default on this platform\n-\t# Common symbols not allowed in MH_DYLIB files\n-\t# Cancel any earlier -mdynamic-no-pic, as that makes\n-\t# the code not suitable for shared libraries.\n-\tPICFLAG='-fno-common -mno-dynamic-no-pic'\n+\t# For darwin, common symbols are not allowed in MH_DYLIB files\n+\tcase \"${CFLAGS}\" in\n+\t  # If we are using a compiler supporting mdynamic-no-pic\n+\t  # and the option has been tested as safe to add, then cancel\n+\t  # it here, since the code generated is incompatible with shared\n+\t  #\u00a0libs.\n+\t  *-mdynamic-no-pic*) PICFLAG='-fno-common -mno-dynamic-no-pic' ;;\n+\t  *) PICFLAG=-fno-common ;;\n+\tesac\n \t;;\n     alpha*-dec-osf5*)\n \t# PIC is the default."}, {"sha": "6fd8b8e0ca681dfe983bc6956b164adb4d483d16", "filename": "libgcc/ChangeLog", "status": "modified", "additions": 6, "deletions": 0, "changes": 6, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/cacf1f59069873d69005fd274184adc25da3bc90/libgcc%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/cacf1f59069873d69005fd274184adc25da3bc90/libgcc%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libgcc%2FChangeLog?ref=cacf1f59069873d69005fd274184adc25da3bc90", "patch": "@@ -1,3 +1,9 @@\n+2015-04-10  Jakub Jelinek  <jakub@redhat.com>\n+\t    Iain Sandoe  <iain@codesourcery.com>\n+\n+\tPR target/65351\n+\t* configure: Regenerate.\n+\n 2015-04-07  Jakub Jelinek  <jakub@redhat.com>\n \t    Iain Sandoe  <iain@codesourcery.com>\n "}, {"sha": "08c931929c7c7ba4c3d80ff3d2c3ff04b9701da7", "filename": "libgcc/configure", "status": "modified", "additions": 9, "deletions": 5, "changes": 14, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/cacf1f59069873d69005fd274184adc25da3bc90/libgcc%2Fconfigure", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/cacf1f59069873d69005fd274184adc25da3bc90/libgcc%2Fconfigure", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libgcc%2Fconfigure?ref=cacf1f59069873d69005fd274184adc25da3bc90", "patch": "@@ -2303,11 +2303,15 @@ case $host_os in *\\ *) host_os=`echo \"$host_os\" | sed 's/ /-/g'`;; esac\n case \"${host}\" in\n     # PIC is the default on some targets or must not be used.\n     *-*-darwin*)\n-\t# PIC is the default on this platform\n-\t# Common symbols not allowed in MH_DYLIB files\n-\t# Cancel any earlier -mdynamic-no-pic, as that makes\n-\t# the code not suitable for shared libraries.\n-\tPICFLAG='-fno-common -mno-dynamic-no-pic'\n+\t# For darwin, common symbols are not allowed in MH_DYLIB files\n+\tcase \"${CFLAGS}\" in\n+\t  # If we are using a compiler supporting mdynamic-no-pic\n+\t  # and the option has been tested as safe to add, then cancel\n+\t  # it here, since the code generated is incompatible with shared\n+\t  #\u00a0libs.\n+\t  *-mdynamic-no-pic*) PICFLAG='-fno-common -mno-dynamic-no-pic' ;;\n+\t  *) PICFLAG=-fno-common ;;\n+\tesac\n \t;;\n     alpha*-dec-osf5*)\n \t# PIC is the default."}, {"sha": "bdf5a0487c1923a9557bf8bb9fc9e4a77412e5dd", "filename": "libiberty/ChangeLog", "status": "modified", "additions": 6, "deletions": 0, "changes": 6, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/cacf1f59069873d69005fd274184adc25da3bc90/libiberty%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/cacf1f59069873d69005fd274184adc25da3bc90/libiberty%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libiberty%2FChangeLog?ref=cacf1f59069873d69005fd274184adc25da3bc90", "patch": "@@ -1,3 +1,9 @@\n+2015-04-10  Jakub Jelinek  <jakub@redhat.com>\n+\t    Iain Sandoe  <iain@codesourcery.com>\n+\n+\tPR target/65351\n+\t* configure: Regenerate.\n+\n 2015-04-07  Jakub Jelinek  <jakub@redhat.com>\n \t    Iain Sandoe  <iain@codesourcery.com>\n "}, {"sha": "b06cab24efa57a9bc6aff387d47833188b796e53", "filename": "libiberty/configure", "status": "modified", "additions": 9, "deletions": 5, "changes": 14, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/cacf1f59069873d69005fd274184adc25da3bc90/libiberty%2Fconfigure", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/cacf1f59069873d69005fd274184adc25da3bc90/libiberty%2Fconfigure", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libiberty%2Fconfigure?ref=cacf1f59069873d69005fd274184adc25da3bc90", "patch": "@@ -4885,11 +4885,15 @@ fi\n case \"${host}\" in\n     # PIC is the default on some targets or must not be used.\n     *-*-darwin*)\n-\t# PIC is the default on this platform\n-\t# Common symbols not allowed in MH_DYLIB files\n-\t# Cancel any earlier -mdynamic-no-pic, as that makes\n-\t# the code not suitable for shared libraries.\n-\tPICFLAG='-fno-common -mno-dynamic-no-pic'\n+\t# For darwin, common symbols are not allowed in MH_DYLIB files\n+\tcase \"${CFLAGS}\" in\n+\t  # If we are using a compiler supporting mdynamic-no-pic\n+\t  # and the option has been tested as safe to add, then cancel\n+\t  # it here, since the code generated is incompatible with shared\n+\t  #\u00a0libs.\n+\t  *-mdynamic-no-pic*) PICFLAG='-fno-common -mno-dynamic-no-pic' ;;\n+\t  *) PICFLAG=-fno-common ;;\n+\tesac\n \t;;\n     alpha*-dec-osf5*)\n \t# PIC is the default."}]}