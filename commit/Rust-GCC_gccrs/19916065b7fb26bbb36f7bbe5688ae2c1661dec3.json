{"sha": "19916065b7fb26bbb36f7bbe5688ae2c1661dec3", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6MTk5MTYwNjViN2ZiMjZiYmIzNmY3YmJlNTY4OGFlMmMxNjYxZGVjMw==", "commit": {"author": {"name": "Martin Liska", "email": "mliska@suse.cz", "date": "2018-05-11T07:37:35Z"}, "committer": {"name": "Martin Liska", "email": "marxin@gcc.gnu.org", "date": "2018-05-11T07:37:35Z"}, "message": "Support LLVM style of no_sanitize attribute (PR sanitizer/85556).\n\n2018-05-11  Martin Liska  <mliska@suse.cz>\n\n        PR sanitizer/85556\n\t* doc/extend.texi: Document LLVM style format for no_sanitize\n\tattribute.\n2018-05-11  Martin Liska  <mliska@suse.cz>\n\n        PR sanitizer/85556\n\t* c-attribs.c (handle_no_sanitize_attribute): Iterate all\n\tTREE_LIST values.\n2018-05-11  Martin Liska  <mliska@suse.cz>\n\n        PR sanitizer/85556\n\t* c-c++-common/ubsan/attrib-6.c: New test.\n\nFrom-SVN: r260154", "tree": {"sha": "f5d45b2c3debefede4370624eb06a7a8ed2947ab", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/f5d45b2c3debefede4370624eb06a7a8ed2947ab"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/19916065b7fb26bbb36f7bbe5688ae2c1661dec3", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/19916065b7fb26bbb36f7bbe5688ae2c1661dec3", "html_url": "https://github.com/Rust-GCC/gccrs/commit/19916065b7fb26bbb36f7bbe5688ae2c1661dec3", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/19916065b7fb26bbb36f7bbe5688ae2c1661dec3/comments", "author": {"login": "marxin", "id": 2658545, "node_id": "MDQ6VXNlcjI2NTg1NDU=", "avatar_url": "https://avatars.githubusercontent.com/u/2658545?v=4", "gravatar_id": "", "url": "https://api.github.com/users/marxin", "html_url": "https://github.com/marxin", "followers_url": "https://api.github.com/users/marxin/followers", "following_url": "https://api.github.com/users/marxin/following{/other_user}", "gists_url": "https://api.github.com/users/marxin/gists{/gist_id}", "starred_url": "https://api.github.com/users/marxin/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/marxin/subscriptions", "organizations_url": "https://api.github.com/users/marxin/orgs", "repos_url": "https://api.github.com/users/marxin/repos", "events_url": "https://api.github.com/users/marxin/events{/privacy}", "received_events_url": "https://api.github.com/users/marxin/received_events", "type": "User", "site_admin": false}, "committer": null, "parents": [{"sha": "683be2f77b3ce4db09e1175c1de4ec7f26f803e6", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/683be2f77b3ce4db09e1175c1de4ec7f26f803e6", "html_url": "https://github.com/Rust-GCC/gccrs/commit/683be2f77b3ce4db09e1175c1de4ec7f26f803e6"}], "stats": {"total": 65, "additions": 57, "deletions": 8}, "files": [{"sha": "75ed3b33f70463913cb63d75efa04561754a6634", "filename": "gcc/ChangeLog", "status": "modified", "additions": 6, "deletions": 0, "changes": 6, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/19916065b7fb26bbb36f7bbe5688ae2c1661dec3/gcc%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/19916065b7fb26bbb36f7bbe5688ae2c1661dec3/gcc%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2FChangeLog?ref=19916065b7fb26bbb36f7bbe5688ae2c1661dec3", "patch": "@@ -1,3 +1,9 @@\n+2018-05-11  Martin Liska  <mliska@suse.cz>\n+\n+        PR sanitizer/85556\n+\t* doc/extend.texi: Document LLVM style format for no_sanitize\n+\tattribute.\n+\n 2018-05-10  Michael Meissner  <meissner@linux.vnet.ibm.com>\n \n \t* config/rs6000/rs6000.c (mode_supports_dq_form): Rename"}, {"sha": "d2fba2fae8a3acae5254ed262e3dadf24609514d", "filename": "gcc/c-family/ChangeLog", "status": "modified", "additions": 6, "deletions": 0, "changes": 6, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/19916065b7fb26bbb36f7bbe5688ae2c1661dec3/gcc%2Fc-family%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/19916065b7fb26bbb36f7bbe5688ae2c1661dec3/gcc%2Fc-family%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fc-family%2FChangeLog?ref=19916065b7fb26bbb36f7bbe5688ae2c1661dec3", "patch": "@@ -1,3 +1,9 @@\n+2018-05-11  Martin Liska  <mliska@suse.cz>\n+\n+        PR sanitizer/85556\n+\t* c-attribs.c (handle_no_sanitize_attribute): Iterate all\n+\tTREE_LIST values.\n+\n 2018-05-10  Jakub Jelinek  <jakub@redhat.com>\n \n \tPR c++/85662"}, {"sha": "d302b4f22c7863c4a04aa828b73d8f63543b91da", "filename": "gcc/c-family/c-attribs.c", "status": "modified", "additions": 12, "deletions": 8, "changes": 20, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/19916065b7fb26bbb36f7bbe5688ae2c1661dec3/gcc%2Fc-family%2Fc-attribs.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/19916065b7fb26bbb36f7bbe5688ae2c1661dec3/gcc%2Fc-family%2Fc-attribs.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fc-family%2Fc-attribs.c?ref=19916065b7fb26bbb36f7bbe5688ae2c1661dec3", "patch": "@@ -403,7 +403,7 @@ const struct attribute_spec c_common_attribute_table[] =\n \t\t\t      0, 0, true, false, false, false,\n \t\t\t      handle_no_address_safety_analysis_attribute,\n \t\t\t      NULL },\n-  { \"no_sanitize\",\t      1, 1, true, false, false, false,\n+  { \"no_sanitize\",\t      1, -1, true, false, false, false,\n \t\t\t      handle_no_sanitize_attribute, NULL },\n   { \"no_sanitize_address\",    0, 0, true, false, false, false,\n \t\t\t      handle_no_sanitize_address_attribute, NULL },\n@@ -683,22 +683,26 @@ static tree\n handle_no_sanitize_attribute (tree *node, tree name, tree args, int,\n \t\t\t      bool *no_add_attrs)\n {\n+  unsigned int flags = 0;\n   *no_add_attrs = true;\n-  tree id = TREE_VALUE (args);\n   if (TREE_CODE (*node) != FUNCTION_DECL)\n     {\n       warning (OPT_Wattributes, \"%qE attribute ignored\", name);\n       return NULL_TREE;\n     }\n \n-  if (TREE_CODE (id) != STRING_CST)\n+  for (; args; args = TREE_CHAIN (args))\n     {\n-      error (\"no_sanitize argument not a string\");\n-      return NULL_TREE;\n-    }\n+      tree id = TREE_VALUE (args);\n+      if (TREE_CODE (id) != STRING_CST)\n+\t{\n+\t  error (\"no_sanitize argument not a string\");\n+\t  return NULL_TREE;\n+\t}\n \n-  char *string = ASTRDUP (TREE_STRING_POINTER (id));\n-  unsigned int flags = parse_no_sanitize_attribute (string);\n+      char *string = ASTRDUP (TREE_STRING_POINTER (id));\n+      flags |= parse_no_sanitize_attribute (string);\n+    }\n \n   add_no_sanitize_value (*node, flags);\n "}, {"sha": "a4664cad8195619065df1ba6ae54b1c2aa9871a3", "filename": "gcc/doc/extend.texi", "status": "modified", "additions": 2, "deletions": 0, "changes": 2, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/19916065b7fb26bbb36f7bbe5688ae2c1661dec3/gcc%2Fdoc%2Fextend.texi", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/19916065b7fb26bbb36f7bbe5688ae2c1661dec3/gcc%2Fdoc%2Fextend.texi", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fdoc%2Fextend.texi?ref=19916065b7fb26bbb36f7bbe5688ae2c1661dec3", "patch": "@@ -2977,6 +2977,8 @@ mentioned in @var{sanitize_option}.  A list of values acceptable by\n @smallexample\n void __attribute__ ((no_sanitize (\"alignment\", \"object-size\")))\n f () @{ /* @r{Do something.} */; @}\n+void __attribute__ ((no_sanitize (\"alignment,object-size\")))\n+g () @{ /* @r{Do something.} */; @}\n @end smallexample\n \n @item no_sanitize_address"}, {"sha": "ee9f633ad8473a48576645450e59b0a9708ed896", "filename": "gcc/testsuite/ChangeLog", "status": "modified", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/19916065b7fb26bbb36f7bbe5688ae2c1661dec3/gcc%2Ftestsuite%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/19916065b7fb26bbb36f7bbe5688ae2c1661dec3/gcc%2Ftestsuite%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2FChangeLog?ref=19916065b7fb26bbb36f7bbe5688ae2c1661dec3", "patch": "@@ -1,3 +1,8 @@\n+2018-05-11  Martin Liska  <mliska@suse.cz>\n+\n+        PR sanitizer/85556\n+\t* c-c++-common/ubsan/attrib-6.c: New test.\n+\n 2018-05-10  Steven G. Kargl  <kargl@gcc.gnu.org>\n \n \tPR fortran/85687"}, {"sha": "2af70c8c2cfe80c6266b0b931009f1833400590d", "filename": "gcc/testsuite/c-c++-common/ubsan/attrib-6.c", "status": "added", "additions": 26, "deletions": 0, "changes": 26, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/19916065b7fb26bbb36f7bbe5688ae2c1661dec3/gcc%2Ftestsuite%2Fc-c%2B%2B-common%2Fubsan%2Fattrib-6.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/19916065b7fb26bbb36f7bbe5688ae2c1661dec3/gcc%2Ftestsuite%2Fc-c%2B%2B-common%2Fubsan%2Fattrib-6.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fc-c%2B%2B-common%2Fubsan%2Fattrib-6.c?ref=19916065b7fb26bbb36f7bbe5688ae2c1661dec3", "patch": "@@ -0,0 +1,26 @@\n+/* { dg-do compile } */\n+/* { dg-options \"-fsanitize=undefined\" } */\n+\n+static void __attribute__((no_sanitize(\"foobar\")))\n+foo (void) { /* { dg-warning \"attribute directive ignored\" } */\n+}\n+\n+static void __attribute__((no_sanitize(\"address,undefined\")))\n+foo2 (void) {\n+}\n+\n+static void __attribute__((no_sanitize(\"address\", \"undefined\")))\n+foo3 (void) {\n+}\n+\n+static void __attribute__((no_sanitize(\"address\", \"address\", \"\")))\n+foo4 (void) {\n+}\n+\n+static void __attribute__((no_sanitize(\"address\", \"address\", \"address,address\")))\n+foo5 (void) {\n+}\n+\n+static void __attribute__((no_sanitize(\"address\", \"address,kernel-address,thread,leak,undefined,vptr,shift,integer-divide-by-zero,unreachable,vla-bound,null,return,signed-integer-overflow,bounds,bounds-strict,alignment,object-size,float-divide-by-zero,float-cast-overflow,nonnull-attribute,returns-nonnull-attribute,bool,enum\")))\n+foo6 (void) {\n+}"}]}