{"sha": "af90c10fe1738861ec3b9be24a13e8215905c6e2", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6YWY5MGMxMGZlMTczODg2MWVjM2I5YmUyNGExM2U4MjE1OTA1YzZlMg==", "commit": {"author": {"name": "Christopher D. Rickett", "email": "crickett@lanl.gov", "date": "2007-11-24T05:42:07Z"}, "committer": {"name": "Jerry DeLisle", "email": "jvdelisle@gcc.gnu.org", "date": "2007-11-24T05:42:07Z"}, "message": "trans-common.c (build_common_decl): Fix the alignment for BIND(C) common blocks.\n\n2007-11-23 Christopher D. Rickett <crickett@lanl.gov>\n\n\t* trans-common.c (build_common_decl): Fix the alignment for\n\tBIND(C) common blocks.\n\nFrom-SVN: r130393", "tree": {"sha": "c5a64ccde3c654fc170b739328b5f5ab27f8e278", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/c5a64ccde3c654fc170b739328b5f5ab27f8e278"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/af90c10fe1738861ec3b9be24a13e8215905c6e2", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/af90c10fe1738861ec3b9be24a13e8215905c6e2", "html_url": "https://github.com/Rust-GCC/gccrs/commit/af90c10fe1738861ec3b9be24a13e8215905c6e2", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/af90c10fe1738861ec3b9be24a13e8215905c6e2/comments", "author": null, "committer": null, "parents": [{"sha": "b769ac9cb87157122d3aae1086d41566575a15b0", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/b769ac9cb87157122d3aae1086d41566575a15b0", "html_url": "https://github.com/Rust-GCC/gccrs/commit/b769ac9cb87157122d3aae1086d41566575a15b0"}], "stats": {"total": 20, "additions": 19, "deletions": 1}, "files": [{"sha": "e7c00b2a4ab0f0ed368a56d11399068d20351be4", "filename": "gcc/fortran/ChangeLog", "status": "modified", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/af90c10fe1738861ec3b9be24a13e8215905c6e2/gcc%2Ffortran%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/af90c10fe1738861ec3b9be24a13e8215905c6e2/gcc%2Ffortran%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ffortran%2FChangeLog?ref=af90c10fe1738861ec3b9be24a13e8215905c6e2", "patch": "@@ -1,3 +1,8 @@\n+2007-11-23 Christopher D. Rickett <crickett@lanl.gov>\n+\n+\t* trans-common.c (build_common_decl): Fix the alignment for\n+\tBIND(C) common blocks.\n+\n 2007-11-23  Jerry DeLisle  <jvdelisle@gcc.gnu.org>\n \n \tPR fortran/34209"}, {"sha": "64cee0db5c102bb866f1a9dcb31a8c8837de048c", "filename": "gcc/fortran/trans-common.c", "status": "modified", "additions": 14, "deletions": 1, "changes": 15, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/af90c10fe1738861ec3b9be24a13e8215905c6e2/gcc%2Ffortran%2Ftrans-common.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/af90c10fe1738861ec3b9be24a13e8215905c6e2/gcc%2Ffortran%2Ftrans-common.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ffortran%2Ftrans-common.c?ref=af90c10fe1738861ec3b9be24a13e8215905c6e2", "patch": "@@ -407,7 +407,20 @@ build_common_decl (gfc_common_head *com, tree union_type, bool is_init)\n       SET_DECL_ASSEMBLER_NAME (decl, gfc_sym_mangled_common_id (com));\n       TREE_PUBLIC (decl) = 1;\n       TREE_STATIC (decl) = 1;\n-      DECL_ALIGN (decl) = BIGGEST_ALIGNMENT;\n+      if (!com->is_bind_c)\n+\tDECL_ALIGN (decl) = BIGGEST_ALIGNMENT;\n+      else\n+        {\n+\t  /* Do not set the alignment for bind(c) common blocks to\n+\t     BIGGEST_ALIGNMENT because that won't match what C does.  Also,\n+\t     for common blocks with one element, the alignment must be\n+\t     that of the field within the common block in order to match\n+\t     what C will do.  */\n+\t  tree field = NULL_TREE;\n+\t  field = TYPE_FIELDS (TREE_TYPE (decl));\n+\t  if (TREE_CHAIN (field) == NULL_TREE)\n+\t    DECL_ALIGN (decl) = TYPE_ALIGN (TREE_TYPE (field));\n+\t}\n       DECL_USER_ALIGN (decl) = 0;\n       GFC_DECL_COMMON_OR_EQUIV (decl) = 1;\n "}]}