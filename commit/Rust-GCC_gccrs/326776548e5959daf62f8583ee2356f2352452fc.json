{"sha": "326776548e5959daf62f8583ee2356f2352452fc", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6MzI2Nzc2NTQ4ZTU5NTlkYWY2MmY4NTgzZWUyMzU2ZjIzNTI0NTJmYw==", "commit": {"author": {"name": "Bob Duff", "email": "duff@adacore.com", "date": "2018-05-23T10:21:53Z"}, "committer": {"name": "Pierre-Marie de Rodat", "email": "pmderodat@gcc.gnu.org", "date": "2018-05-23T10:21:53Z"}, "message": "[Ada] Build-in-place aggregates and Address clauses\n\nThis patch fixes a bug in which if a limited volatile variable with\nan Address aspect is initialized with a build-in-place aggregate\ncontaining build-in-place function calls, the compiler can crash.\n\n2018-05-23  Bob Duff  <duff@adacore.com>\n\ngcc/ada/\n\n\t* freeze.adb: (Check_Address_Clause): Deal with build-in-place\n\taggregates in addition to build-in-place calls.\n\ngcc/testsuite/\n\n\t* gnat.dg/addr10.adb: New testcase.\n\nFrom-SVN: r260574", "tree": {"sha": "6cc0ad0f60d5fe93ba5f79ae3bd4fc3e32ea5141", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/6cc0ad0f60d5fe93ba5f79ae3bd4fc3e32ea5141"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/326776548e5959daf62f8583ee2356f2352452fc", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/326776548e5959daf62f8583ee2356f2352452fc", "html_url": "https://github.com/Rust-GCC/gccrs/commit/326776548e5959daf62f8583ee2356f2352452fc", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/326776548e5959daf62f8583ee2356f2352452fc/comments", "author": {"login": "bobduff", "id": 29099567, "node_id": "MDQ6VXNlcjI5MDk5NTY3", "avatar_url": "https://avatars.githubusercontent.com/u/29099567?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bobduff", "html_url": "https://github.com/bobduff", "followers_url": "https://api.github.com/users/bobduff/followers", "following_url": "https://api.github.com/users/bobduff/following{/other_user}", "gists_url": "https://api.github.com/users/bobduff/gists{/gist_id}", "starred_url": "https://api.github.com/users/bobduff/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bobduff/subscriptions", "organizations_url": "https://api.github.com/users/bobduff/orgs", "repos_url": "https://api.github.com/users/bobduff/repos", "events_url": "https://api.github.com/users/bobduff/events{/privacy}", "received_events_url": "https://api.github.com/users/bobduff/received_events", "type": "User", "site_admin": false}, "committer": null, "parents": [{"sha": "95872381f0e22ef13e95788e7000ae2623ed03cd", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/95872381f0e22ef13e95788e7000ae2623ed03cd", "html_url": "https://github.com/Rust-GCC/gccrs/commit/95872381f0e22ef13e95788e7000ae2623ed03cd"}], "stats": {"total": 46, "additions": 39, "deletions": 7}, "files": [{"sha": "f9ad15908a6d98cda4f306bbe2e2005362cf1977", "filename": "gcc/ada/ChangeLog", "status": "modified", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/326776548e5959daf62f8583ee2356f2352452fc/gcc%2Fada%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/326776548e5959daf62f8583ee2356f2352452fc/gcc%2Fada%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fada%2FChangeLog?ref=326776548e5959daf62f8583ee2356f2352452fc", "patch": "@@ -1,3 +1,8 @@\n+2018-05-23  Bob Duff  <duff@adacore.com>\n+\n+\t* freeze.adb: (Check_Address_Clause): Deal with build-in-place\n+\taggregates in addition to build-in-place calls.\n+\n 2018-05-23  Bob Duff  <duff@adacore.com>\n \n \t* einfo.ads: Minor reformatting."}, {"sha": "032dcf516f8bf269b3e83eddcf5081d13b503b23", "filename": "gcc/ada/freeze.adb", "status": "modified", "additions": 6, "deletions": 7, "changes": 13, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/326776548e5959daf62f8583ee2356f2352452fc/gcc%2Fada%2Ffreeze.adb", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/326776548e5959daf62f8583ee2356f2352452fc/gcc%2Fada%2Ffreeze.adb", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fada%2Ffreeze.adb?ref=326776548e5959daf62f8583ee2356f2352452fc", "patch": "@@ -710,13 +710,12 @@ package body Freeze is\n             end;\n          end if;\n \n-         --  Remove side effects from initial expression, except in the case\n-         --  of a build-in-place call, which has its own later expansion.\n+         --  Remove side effects from initial expression, except in the case of\n+         --  limited build-in-place calls and aggregates, which have their own\n+         --  expansion elsewhere. This exception is necessary to avoid copying\n+         --  limited objects.\n \n-         if Present (Init)\n-           and then (Nkind (Init) /= N_Function_Call\n-                      or else not Is_Expanded_Build_In_Place_Call (Init))\n-         then\n+         if Present (Init) and then not Is_Limited_View (Typ) then\n             --  Capture initialization value at point of declaration, and make\n             --  explicit assignment legal, because object may be a constant.\n \n@@ -735,7 +734,7 @@ package body Freeze is\n \n             Set_No_Initialization (Decl);\n \n-            --  If the objet is tagged, check whether the tag must be\n+            --  If the object is tagged, check whether the tag must be\n             --  reassigned explicitly.\n \n             Tag_Assign := Make_Tag_Assignment (Decl);"}, {"sha": "b12fb9e2d3649f67e74c3dd1e89fbb7d5584e235", "filename": "gcc/testsuite/ChangeLog", "status": "modified", "additions": 4, "deletions": 0, "changes": 4, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/326776548e5959daf62f8583ee2356f2352452fc/gcc%2Ftestsuite%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/326776548e5959daf62f8583ee2356f2352452fc/gcc%2Ftestsuite%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2FChangeLog?ref=326776548e5959daf62f8583ee2356f2352452fc", "patch": "@@ -1,3 +1,7 @@\n+2018-05-23  Bob Duff  <duff@adacore.com>\n+\n+\t* gnat.dg/addr10.adb: New testcase.\n+\n 2018-05-23  Richard Biener  <rguenther@suse.de>\n \n \tPR middle-end/85874"}, {"sha": "16efa28ed6b2999948be8f3215c17e70a738f521", "filename": "gcc/testsuite/gnat.dg/addr10.adb", "status": "added", "additions": 24, "deletions": 0, "changes": 24, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/326776548e5959daf62f8583ee2356f2352452fc/gcc%2Ftestsuite%2Fgnat.dg%2Faddr10.adb", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/326776548e5959daf62f8583ee2356f2352452fc/gcc%2Ftestsuite%2Fgnat.dg%2Faddr10.adb", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgnat.dg%2Faddr10.adb?ref=326776548e5959daf62f8583ee2356f2352452fc", "patch": "@@ -0,0 +1,24 @@\n+--  { dg-do compile }\n+\n+with System;\n+\n+procedure Addr10 is\n+   type Limited_Type is limited record\n+      Element : Integer;\n+   end record;\n+\n+   function Initial_State return Limited_Type is ((Element => 0));\n+\n+   type Double_Limited_Type is\n+      record\n+         A : Limited_Type;\n+      end record;\n+\n+   Double_Limited : Double_Limited_Type :=\n+      (A => Initial_State)\n+   with\n+      Volatile,\n+      Address => System'To_Address (16#1234_5678#);\n+begin\n+   null;\n+end Addr10;"}]}