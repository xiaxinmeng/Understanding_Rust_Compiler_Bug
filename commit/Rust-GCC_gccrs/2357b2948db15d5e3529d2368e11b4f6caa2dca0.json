{"sha": "2357b2948db15d5e3529d2368e11b4f6caa2dca0", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6MjM1N2IyOTQ4ZGIxNWQ1ZTM1MjlkMjM2OGUxMWI0ZjZjYWEyZGNhMA==", "commit": {"author": {"name": "Javier Miranda", "email": "miranda@adacore.com", "date": "2020-06-30T18:20:09Z"}, "committer": {"name": "Pierre-Marie de Rodat", "email": "derodat@adacore.com", "date": "2020-10-16T07:34:52Z"}, "message": "[Ada] Crash in generic renaming declaration of child unit\n\ngcc/ada/\n\n\t* sem_ch12.adb (Check_Generic_Child_Unit): When the child unit\n\tis a renaming of a generic child unit then traverse the scope\n\tcontaining the renaming declaration to locate the instance of\n\tits parent.  Otherwise the parent is not installed and the\n\tfrontend cannot process the instantiation.", "tree": {"sha": "d09f6f8a6e7379142f18de3ec61d1c1405e15a9d", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/d09f6f8a6e7379142f18de3ec61d1c1405e15a9d"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/2357b2948db15d5e3529d2368e11b4f6caa2dca0", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/2357b2948db15d5e3529d2368e11b4f6caa2dca0", "html_url": "https://github.com/Rust-GCC/gccrs/commit/2357b2948db15d5e3529d2368e11b4f6caa2dca0", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/2357b2948db15d5e3529d2368e11b4f6caa2dca0/comments", "author": {"login": "miranda-adacore", "id": 54413934, "node_id": "MDQ6VXNlcjU0NDEzOTM0", "avatar_url": "https://avatars.githubusercontent.com/u/54413934?v=4", "gravatar_id": "", "url": "https://api.github.com/users/miranda-adacore", "html_url": "https://github.com/miranda-adacore", "followers_url": "https://api.github.com/users/miranda-adacore/followers", "following_url": "https://api.github.com/users/miranda-adacore/following{/other_user}", "gists_url": "https://api.github.com/users/miranda-adacore/gists{/gist_id}", "starred_url": "https://api.github.com/users/miranda-adacore/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/miranda-adacore/subscriptions", "organizations_url": "https://api.github.com/users/miranda-adacore/orgs", "repos_url": "https://api.github.com/users/miranda-adacore/repos", "events_url": "https://api.github.com/users/miranda-adacore/events{/privacy}", "received_events_url": "https://api.github.com/users/miranda-adacore/received_events", "type": "User", "site_admin": false}, "committer": {"login": "pmderodat", "id": 758452, "node_id": "MDQ6VXNlcjc1ODQ1Mg==", "avatar_url": "https://avatars.githubusercontent.com/u/758452?v=4", "gravatar_id": "", "url": "https://api.github.com/users/pmderodat", "html_url": "https://github.com/pmderodat", "followers_url": "https://api.github.com/users/pmderodat/followers", "following_url": "https://api.github.com/users/pmderodat/following{/other_user}", "gists_url": "https://api.github.com/users/pmderodat/gists{/gist_id}", "starred_url": "https://api.github.com/users/pmderodat/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/pmderodat/subscriptions", "organizations_url": "https://api.github.com/users/pmderodat/orgs", "repos_url": "https://api.github.com/users/pmderodat/repos", "events_url": "https://api.github.com/users/pmderodat/events{/privacy}", "received_events_url": "https://api.github.com/users/pmderodat/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "8dfdfd4048e7a67f2ba01e9efc5d83554d6546ba", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/8dfdfd4048e7a67f2ba01e9efc5d83554d6546ba", "html_url": "https://github.com/Rust-GCC/gccrs/commit/8dfdfd4048e7a67f2ba01e9efc5d83554d6546ba"}], "stats": {"total": 49, "additions": 49, "deletions": 0}, "files": [{"sha": "5f44e813b2fd11d00b6584f9a1dca8c2c88e44d2", "filename": "gcc/ada/sem_ch12.adb", "status": "modified", "additions": 49, "deletions": 0, "changes": 49, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/2357b2948db15d5e3529d2368e11b4f6caa2dca0/gcc%2Fada%2Fsem_ch12.adb", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/2357b2948db15d5e3529d2368e11b4f6caa2dca0/gcc%2Fada%2Fsem_ch12.adb", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fada%2Fsem_ch12.adb?ref=2357b2948db15d5e3529d2368e11b4f6caa2dca0", "patch": "@@ -7512,11 +7512,60 @@ package body Sem_Ch12 is\n             null;\n \n          elsif Present (Entity (Gen_Id))\n+           and then No (Renamed_Entity (Entity (Gen_Id)))\n            and then Is_Child_Unit (Entity (Gen_Id))\n            and then not In_Open_Scopes (Inst_Par)\n          then\n             Install_Parent (Inst_Par);\n             Parent_Installed := True;\n+\n+         --  Handle renaming of generic child unit\n+\n+         elsif Present (Entity (Gen_Id))\n+           and then Present (Renamed_Entity (Entity (Gen_Id)))\n+           and then Is_Child_Unit (Renamed_Entity (Entity (Gen_Id)))\n+         then\n+            declare\n+               E        : Entity_Id;\n+               Ren_Decl : Node_Id;\n+\n+            begin\n+               --  The entity of the renamed generic child unit does not\n+               --  have any reference to the instantiated parent. In order to\n+               --  locate it we traverse the scope containing the renaming\n+               --  declaration; the instance of the parent is available in\n+               --  the prefix of the renaming declaration. For example:\n+\n+               --     package A is\n+               --       package Inst_Par is new ...\n+               --       generic package Ren_Child renames Ins_Par.Child;\n+               --     end;\n+\n+               --     with A;\n+               --     package B is\n+               --       package Inst_Child is new A.Ren_Child;\n+               --     end;\n+\n+               E := First_Entity (Entity (Prefix (Gen_Id)));\n+               while Present (E) loop\n+                  if Present (Renamed_Entity (E))\n+                    and then\n+                      Renamed_Entity (E) = Renamed_Entity (Entity (Gen_Id))\n+                  then\n+                     Ren_Decl := Parent (E);\n+                     Inst_Par := Entity (Prefix (Name (Ren_Decl)));\n+\n+                     if not In_Open_Scopes (Inst_Par) then\n+                        Install_Parent (Inst_Par);\n+                        Parent_Installed := True;\n+                     end if;\n+\n+                     exit;\n+                  end if;\n+\n+                  E := Next_Entity (E);\n+               end loop;\n+            end;\n          end if;\n \n       elsif In_Enclosing_Instance then"}]}