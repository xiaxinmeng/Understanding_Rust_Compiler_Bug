{"sha": "1fc3998daa162619e2826523d2b9efad2a3c7725", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6MWZjMzk5OGRhYTE2MjYxOWUyODI2NTIzZDJiOWVmYWQyYTNjNzcyNQ==", "commit": {"author": {"name": "Zdenek Dvorak", "email": "dvorakz@suse.cz", "date": "2007-06-08T07:28:50Z"}, "committer": {"name": "Zdenek Dvorak", "email": "rakdver@gcc.gnu.org", "date": "2007-06-08T07:28:50Z"}, "message": "re PR middle-end/32209 (Boot failure  Comparing stages 2 and 3 with --disable-checking)\n\n\tPR middle-end/32209\n\t* dominance.c (debug_dominance_tree, debug_dominance_tree_1): New\n\tfunctions.\n\t(verify_dominators): Do not change dominance tree.\n\nFrom-SVN: r125563", "tree": {"sha": "ac0d18d45cdef103f030e114f2c61dc3ba28ccf0", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/ac0d18d45cdef103f030e114f2c61dc3ba28ccf0"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/1fc3998daa162619e2826523d2b9efad2a3c7725", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/1fc3998daa162619e2826523d2b9efad2a3c7725", "html_url": "https://github.com/Rust-GCC/gccrs/commit/1fc3998daa162619e2826523d2b9efad2a3c7725", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/1fc3998daa162619e2826523d2b9efad2a3c7725/comments", "author": null, "committer": null, "parents": [{"sha": "32a7ab3d8069ff4cc16c3be5ff157e732f55203c", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/32a7ab3d8069ff4cc16c3be5ff157e732f55203c", "html_url": "https://github.com/Rust-GCC/gccrs/commit/32a7ab3d8069ff4cc16c3be5ff157e732f55203c"}], "stats": {"total": 74, "additions": 59, "deletions": 15}, "files": [{"sha": "14ac46ac54aef454f54f87553c1e27c97391cd43", "filename": "gcc/ChangeLog", "status": "modified", "additions": 7, "deletions": 0, "changes": 7, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/1fc3998daa162619e2826523d2b9efad2a3c7725/gcc%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/1fc3998daa162619e2826523d2b9efad2a3c7725/gcc%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2FChangeLog?ref=1fc3998daa162619e2826523d2b9efad2a3c7725", "patch": "@@ -1,3 +1,10 @@\n+2007-06-08  Zdenek Dvorak  <dvorakz@suse.cz>\n+\n+\tPR middle-end/32209\n+\t* dominance.c (debug_dominance_tree, debug_dominance_tree_1): New\n+\tfunctions.\n+\t(verify_dominators): Do not change dominance tree.\n+\n 2007-06-08  Kaz Kojima  <kkojima@gcc.gnu.org>\n \n \t* config/sh/constraints.md: New file."}, {"sha": "3ad0d204cdf9f60940c1fb01f367eaf9876566bb", "filename": "gcc/dominance.c", "status": "modified", "additions": 52, "deletions": 15, "changes": 67, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/1fc3998daa162619e2826523d2b9efad2a3c7725/gcc%2Fdominance.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/1fc3998daa162619e2826523d2b9efad2a3c7725/gcc%2Fdominance.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fdominance.c?ref=1fc3998daa162619e2826523d2b9efad2a3c7725", "patch": "@@ -124,6 +124,7 @@ static TBB eval (struct dom_info *, TBB);\n static void link_roots (struct dom_info *, TBB, TBB);\n static void calc_idoms (struct dom_info *, bool);\n void debug_dominance_info (enum cdi_direction);\n+void debug_dominance_tree (enum cdi_direction, basic_block);\n \n /* Keeps track of the*/\n static unsigned n_bbs_in_dom_tree[2];\n@@ -970,37 +971,35 @@ void\n verify_dominators (enum cdi_direction dir)\n {\n   int err = 0;\n-  basic_block *old_dom = XNEWVEC (basic_block, last_basic_block);\n-  basic_block bb, imm_bb;\n+  basic_block bb, imm_bb, imm_bb_correct;\n+  struct dom_info di;\n+  bool reverse = (dir == CDI_POST_DOMINATORS) ? true : false;\n \n   gcc_assert (dom_info_available_p (dir));\n \n+  init_dom_info (&di, dir);\n+  calc_dfs_tree (&di, reverse);\n+  calc_idoms (&di, reverse);\n+\n   FOR_EACH_BB (bb)\n     {\n-      old_dom[bb->index] = get_immediate_dominator (dir, bb);\n-\n-      if (!old_dom[bb->index])\n+      imm_bb = get_immediate_dominator (dir, bb);\n+      if (!imm_bb)\n \t{\n \t  error (\"dominator of %d status unknown\", bb->index);\n \t  err = 1;\n \t}\n-    }\n-\n-  free_dominance_info (dir);\n-  calculate_dominance_info (dir);\n \n-  FOR_EACH_BB (bb)\n-    {\n-      imm_bb = get_immediate_dominator (dir, bb);\n-      if (old_dom[bb->index] != imm_bb)\n+      imm_bb_correct = di.dfs_to_bb[di.dom[di.dfs_order[bb->index]]];\n+      if (imm_bb != imm_bb_correct)\n \t{\n \t  error (\"dominator of %d should be %d, not %d\",\n-\t\t bb->index, imm_bb->index, old_dom[bb->index]->index);\n+\t\t bb->index, imm_bb_correct->index, imm_bb->index);\n \t  err = 1;\n \t}\n     }\n \n-  free (old_dom);\n+  free_dom_info (&di);\n   gcc_assert (!err);\n }\n \n@@ -1453,3 +1452,41 @@ debug_dominance_info (enum cdi_direction dir)\n     if ((bb2 = get_immediate_dominator (dir, bb)))\n       fprintf (stderr, \"%i %i\\n\", bb->index, bb2->index);\n }\n+\n+/* Prints to stderr representation of the dominance tree (for direction DIR)\n+   rooted in ROOT, indented by INDENT tabelators.  If INDENT_FIRST is false,\n+   the first line of the output is not indented.  */\n+\n+static void\n+debug_dominance_tree_1 (enum cdi_direction dir, basic_block root,\n+\t\t\tunsigned indent, bool indent_first)\n+{\n+  basic_block son;\n+  unsigned i;\n+  bool first = true;\n+\n+  if (indent_first)\n+    for (i = 0; i < indent; i++)\n+      fprintf (stderr, \"\\t\");\n+  fprintf (stderr, \"%d\\t\", root->index);\n+\n+  for (son = first_dom_son (dir, root);\n+       son;\n+       son = next_dom_son (dir, son))\n+    {\n+      debug_dominance_tree_1 (dir, son, indent + 1, !first);\n+      first = false;\n+    }\n+\n+  if (first)\n+    fprintf (stderr, \"\\n\");\n+}\n+\n+/* Prints to stderr representation of the dominance tree (for direction DIR)\n+   rooted in ROOT.  */\n+\n+void\n+debug_dominance_tree (enum cdi_direction dir, basic_block root)\n+{\n+  debug_dominance_tree_1 (dir, root, 0, false);\n+}"}]}