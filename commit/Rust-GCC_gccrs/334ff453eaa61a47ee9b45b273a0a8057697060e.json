{"sha": "334ff453eaa61a47ee9b45b273a0a8057697060e", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6MzM0ZmY0NTNlYWE2MWE0N2VlOWI0NWIyNzNhMGE4MDU3Njk3MDYwZQ==", "commit": {"author": {"name": "Paul Brook", "email": "pbrook@gcc.gnu.org", "date": "2004-08-31T20:37:43Z"}, "committer": {"name": "Paul Brook", "email": "pbrook@gcc.gnu.org", "date": "2004-08-31T20:37:43Z"}, "message": "re PR libfortran/16805 (Runtime failure using list directed read from string)\n\n\tPR libfortran/16805\n\t* io/list_read.c (next_char): Don't signal EOF for internal files.\n\t* io/unix.c (mem_alloc_r_at): Don't return NULL for incomplete reads.\ntestsuite/\n2004-08-31  Bud Davis  <bdavis9659@comcast.net>\n\n\t* gfortran.dg/list_read_2.f90: New test.\n\nFrom-SVN: r86844", "tree": {"sha": "dc7a4ca767a0ceaea51b4b9fda68b21315cdcfa6", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/dc7a4ca767a0ceaea51b4b9fda68b21315cdcfa6"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/334ff453eaa61a47ee9b45b273a0a8057697060e", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/334ff453eaa61a47ee9b45b273a0a8057697060e", "html_url": "https://github.com/Rust-GCC/gccrs/commit/334ff453eaa61a47ee9b45b273a0a8057697060e", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/334ff453eaa61a47ee9b45b273a0a8057697060e/comments", "author": null, "committer": null, "parents": [{"sha": "af287697443400b33dbfd2297bdcf63121e7bc86", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/af287697443400b33dbfd2297bdcf63121e7bc86", "html_url": "https://github.com/Rust-GCC/gccrs/commit/af287697443400b33dbfd2297bdcf63121e7bc86"}], "stats": {"total": 52, "additions": 47, "deletions": 5}, "files": [{"sha": "10dd9bf3c1dd95dec267892b58f523e718a2f872", "filename": "gcc/testsuite/ChangeLog", "status": "modified", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/334ff453eaa61a47ee9b45b273a0a8057697060e/gcc%2Ftestsuite%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/334ff453eaa61a47ee9b45b273a0a8057697060e/gcc%2Ftestsuite%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2FChangeLog?ref=334ff453eaa61a47ee9b45b273a0a8057697060e", "patch": "@@ -1,3 +1,8 @@\n+2004-08-31  Bud Davis  <bdavis9659@comcast.net>\n+\n+\tPR libfortran/16805\n+\t* gfortran.dg/list_read_2.f90: New test.\n+\n 2004-08-31  Mark Mitchell  <mark@codesourcery.com>\n \n \t* g++.dg/abi/key1.C: New test."}, {"sha": "f60a83620109fb42ab54f328f0b172613ecb34ca", "filename": "gcc/testsuite/gfortran.dg/list_read_2.f90", "status": "added", "additions": 25, "deletions": 0, "changes": 25, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/334ff453eaa61a47ee9b45b273a0a8057697060e/gcc%2Ftestsuite%2Fgfortran.dg%2Flist_read_2.f90", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/334ff453eaa61a47ee9b45b273a0a8057697060e/gcc%2Ftestsuite%2Fgfortran.dg%2Flist_read_2.f90", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgfortran.dg%2Flist_read_2.f90?ref=334ff453eaa61a47ee9b45b273a0a8057697060e", "patch": "@@ -0,0 +1,25 @@\n+! { dg-do run }\n+! PR16805\n+! Test list directed reads from character substrings\n+! The IO library was reporting an error rather the end-or-fecord when it\n+! got to the end of an internal file record.\n+program list_read_2\n+  implicit none\n+  character*10 a\n+  data a /'1234567890'/\n+  integer i\n+  logical debug\n+  data debug /.TRUE./\n+  read(a,*)i\n+  if (i.ne.1234567890) call abort\n+  read(a(1:1),*)i\n+  if (i.ne.1) call abort\n+  read(a(2:2),*)i\n+  if (i.ne.2) call abort\n+  read(a(1:5),*)i\n+  if (i.ne.12345) call abort\n+  read(a(5:10),*)i\n+  if (i.ne.567890) call abort\n+  read(a(10:10),*)i\n+  if (i.ne.0) call abort\n+end"}, {"sha": "50ad7a6290f0a40e8101173ca3771a349f37996e", "filename": "libgfortran/ChangeLog", "status": "modified", "additions": 6, "deletions": 0, "changes": 6, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/334ff453eaa61a47ee9b45b273a0a8057697060e/libgfortran%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/334ff453eaa61a47ee9b45b273a0a8057697060e/libgfortran%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libgfortran%2FChangeLog?ref=334ff453eaa61a47ee9b45b273a0a8057697060e", "patch": "@@ -1,3 +1,9 @@\n+2004-08-31  Paul Brook  <paul@codesourcery.com>\n+\n+\tPR libfortran/16805\n+\t* io/list_read.c (next_char): Don't signal EOF for internal files.\n+\t* io/unix.c (mem_alloc_r_at): Don't return NULL for incomplete reads.\n+\n 2004-08-31  Tobias Schlueter  <tobias.schlueter@physik.uni-muenchen.de>\n \n \t* io/unit.c: Separate copyright years by ','."}, {"sha": "f47d473df91dcef586ca41f259049edd7995473b", "filename": "libgfortran/io/list_read.c", "status": "modified", "additions": 11, "deletions": 2, "changes": 13, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/334ff453eaa61a47ee9b45b273a0a8057697060e/libgfortran%2Fio%2Flist_read.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/334ff453eaa61a47ee9b45b273a0a8057697060e/libgfortran%2Fio%2Flist_read.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libgfortran%2Fio%2Flist_read.c?ref=334ff453eaa61a47ee9b45b273a0a8057697060e", "patch": "@@ -142,8 +142,17 @@ next_char (void)\n     }\n \n   if (length == 0)\n-    longjmp (g.eof_jump, 1);\n-  c = *p;\n+    {\n+      /* For internal files return a newline instead of signalling EOF.  */\n+      /* ??? This isn't quite right, but we don't handle internal files\n+\t with multiple records.  */\n+      if (is_internal_unit ())\n+\tc = '\\n';\n+      else\n+\tlongjmp (g.eof_jump, 1);\n+    }\n+  else\n+    c = *p;\n \n done:\n   at_eol = (c == '\\n');"}, {"sha": "377cadd438e1aa2ab51ba7f21c8d597fac9702dc", "filename": "libgfortran/io/unix.c", "status": "modified", "additions": 0, "deletions": 3, "changes": 3, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/334ff453eaa61a47ee9b45b273a0a8057697060e/libgfortran%2Fio%2Funix.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/334ff453eaa61a47ee9b45b273a0a8057697060e/libgfortran%2Fio%2Funix.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libgfortran%2Fio%2Funix.c?ref=334ff453eaa61a47ee9b45b273a0a8057697060e", "patch": "@@ -746,9 +746,6 @@ mem_alloc_r_at (unix_stream * s, int *len, gfc_offset where)\n   if (where < s->buffer_offset || where > s->buffer_offset + s->active)\n     return NULL;\n \n-  if (is_internal_unit() && where + *len > s->file_length)\n-    return NULL;\n-\n   s->logical_offset = where + *len;\n \n   n = s->buffer_offset + s->active - where;"}]}