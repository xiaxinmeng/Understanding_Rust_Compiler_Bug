{"sha": "72c5ce77a028e57048c8666a7b782e3b921ee28c", "node_id": "C_kwDOANBUbNoAKDcyYzVjZTc3YTAyOGU1NzA0OGM4NjY2YTdiNzgyZTNiOTIxZWUyOGM", "commit": {"author": {"name": "Arnaud Charlet", "email": "charlet@adacore.com", "date": "2022-07-18T07:43:54Z"}, "committer": {"name": "Marc Poulhi\u00e8s", "email": "poulhies@adacore.com", "date": "2022-09-05T07:21:01Z"}, "message": "[Ada] New gnatbind switch -k\n\nThis switch can be used to disable the effect of -F when using -n\nexplicitly or implicitly.\n\ngcc/ada/\n\n\t* bindgen.adb (Gen_Elab_Calls): Check for Check_Elaboration_Flags.\n\t* bindusg.adb (Display): Add -k.\n\t* opt.ads (Check_Elaboration_Flags): New.\n\t* switch-b.adb (Scan_Binder_Switches): Add processing of -k.\n\t* doc/gnat_ugn/building_executable_programs_with_gnat.rst: Add\n\tdocumentation for -k and -K.\n\t* gnat_ugn.texi: Regenerate.", "tree": {"sha": "82113a85dabbb10dac79065686ceed7d2eda1f6d", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/82113a85dabbb10dac79065686ceed7d2eda1f6d"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/72c5ce77a028e57048c8666a7b782e3b921ee28c", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/72c5ce77a028e57048c8666a7b782e3b921ee28c", "html_url": "https://github.com/Rust-GCC/gccrs/commit/72c5ce77a028e57048c8666a7b782e3b921ee28c", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/72c5ce77a028e57048c8666a7b782e3b921ee28c/comments", "author": {"login": "ArnaudCharlet", "id": 30291825, "node_id": "MDQ6VXNlcjMwMjkxODI1", "avatar_url": "https://avatars.githubusercontent.com/u/30291825?v=4", "gravatar_id": "", "url": "https://api.github.com/users/ArnaudCharlet", "html_url": "https://github.com/ArnaudCharlet", "followers_url": "https://api.github.com/users/ArnaudCharlet/followers", "following_url": "https://api.github.com/users/ArnaudCharlet/following{/other_user}", "gists_url": "https://api.github.com/users/ArnaudCharlet/gists{/gist_id}", "starred_url": "https://api.github.com/users/ArnaudCharlet/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/ArnaudCharlet/subscriptions", "organizations_url": "https://api.github.com/users/ArnaudCharlet/orgs", "repos_url": "https://api.github.com/users/ArnaudCharlet/repos", "events_url": "https://api.github.com/users/ArnaudCharlet/events{/privacy}", "received_events_url": "https://api.github.com/users/ArnaudCharlet/received_events", "type": "User", "site_admin": false}, "committer": {"login": "dkm", "id": 87603, "node_id": "MDQ6VXNlcjg3NjAz", "avatar_url": "https://avatars.githubusercontent.com/u/87603?v=4", "gravatar_id": "", "url": "https://api.github.com/users/dkm", "html_url": "https://github.com/dkm", "followers_url": "https://api.github.com/users/dkm/followers", "following_url": "https://api.github.com/users/dkm/following{/other_user}", "gists_url": "https://api.github.com/users/dkm/gists{/gist_id}", "starred_url": "https://api.github.com/users/dkm/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/dkm/subscriptions", "organizations_url": "https://api.github.com/users/dkm/orgs", "repos_url": "https://api.github.com/users/dkm/repos", "events_url": "https://api.github.com/users/dkm/events{/privacy}", "received_events_url": "https://api.github.com/users/dkm/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "2322afe68dcee22842e6feb60aed262c584ec48a", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/2322afe68dcee22842e6feb60aed262c584ec48a", "html_url": "https://github.com/Rust-GCC/gccrs/commit/2322afe68dcee22842e6feb60aed262c584ec48a"}], "stats": {"total": 50, "additions": 49, "deletions": 1}, "files": [{"sha": "d5877c6ed844af1c5d1c01f0ea2f524d2dfab024", "filename": "gcc/ada/bindgen.adb", "status": "modified", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/72c5ce77a028e57048c8666a7b782e3b921ee28c/gcc%2Fada%2Fbindgen.adb", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/72c5ce77a028e57048c8666a7b782e3b921ee28c/gcc%2Fada%2Fbindgen.adb", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fada%2Fbindgen.adb?ref=72c5ce77a028e57048c8666a7b782e3b921ee28c", "patch": "@@ -1544,6 +1544,7 @@ package body Bindgen is\n \n                Check_Elab_Flag :=\n                  Units.Table (Unum_Spec).Set_Elab_Entity\n+                   and then Check_Elaboration_Flags\n                    and then not CodePeer_Mode\n                    and then (Force_Checking_Of_Elaboration_Flags\n                               or Interface_Library_Unit"}, {"sha": "3f99bae8afe8dfc316768b2f4638cbe7c1ede281", "filename": "gcc/ada/bindusg.adb", "status": "modified", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/72c5ce77a028e57048c8666a7b782e3b921ee28c/gcc%2Fada%2Fbindusg.adb", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/72c5ce77a028e57048c8666a7b782e3b921ee28c/gcc%2Fada%2Fbindusg.adb", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fada%2Fbindusg.adb?ref=72c5ce77a028e57048c8666a7b782e3b921ee28c", "patch": "@@ -156,6 +156,11 @@ package body Bindusg is\n         (\"  -I-       Don't look for sources & library files in default \"\n          & \"directory\");\n \n+      --  Line for -k switch\n+\n+      Write_Line\n+        (\"  -k        Disable checking of elaboration flags\");\n+\n       --  Line for -K switch\n \n       Write_Line"}, {"sha": "37b6e9503c7a0bf0ffba48bb5aadfbe54c775f3e", "filename": "gcc/ada/doc/gnat_ugn/building_executable_programs_with_gnat.rst", "status": "modified", "additions": 16, "deletions": 0, "changes": 16, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/72c5ce77a028e57048c8666a7b782e3b921ee28c/gcc%2Fada%2Fdoc%2Fgnat_ugn%2Fbuilding_executable_programs_with_gnat.rst", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/72c5ce77a028e57048c8666a7b782e3b921ee28c/gcc%2Fada%2Fdoc%2Fgnat_ugn%2Fbuilding_executable_programs_with_gnat.rst", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fada%2Fdoc%2Fgnat_ugn%2Fbuilding_executable_programs_with_gnat.rst?ref=72c5ce77a028e57048c8666a7b782e3b921ee28c", "patch": "@@ -6534,6 +6534,22 @@ be presented in subsequent sections.\n   ALI file named in the ``gnatbind`` command line.\n \n \n+  .. index:: -k  (gnatbind)\n+\n+:switch:`-k`\n+  Disable checking of elaboration flags. When using :switch:`-n`\n+  either explicitly or implicitly, :switch:`-F` is also implied,\n+  unless :switch:`-k` is used. This switch should be used with care\n+  and you should ensure manually that elaboration routines are not called\n+  twice unintentionally.\n+\n+\n+  .. index:: -K  (gnatbind)\n+\n+:switch:`-K`\n+  Give list of linker options specified for link.\n+\n+\n   .. index:: -l  (gnatbind)\n \n :switch:`-l`"}, {"sha": "e1a4192a9589b78755f0fabfbc5431cfdcc7ad7b", "filename": "gcc/ada/gnat_ugn.texi", "status": "modified", "additions": 17, "deletions": 1, "changes": 18, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/72c5ce77a028e57048c8666a7b782e3b921ee28c/gcc%2Fada%2Fgnat_ugn.texi", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/72c5ce77a028e57048c8666a7b782e3b921ee28c/gcc%2Fada%2Fgnat_ugn.texi", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fada%2Fgnat_ugn.texi?ref=72c5ce77a028e57048c8666a7b782e3b921ee28c", "patch": "@@ -15724,6 +15724,22 @@ Do not look for sources in the current directory where @code{gnatbind} was\n invoked, and do not look for ALI files in the directory containing the\n ALI file named in the @code{gnatbind} command line.\n \n+@geindex -k (gnatbind)\n+\n+@item @code{-k}\n+\n+Disable checking of elaboration flags. When using @code{-n}\n+either explicitly or implicitly, @code{-F} is also implied,\n+unless @code{-k} is used. This switch should be used with care\n+and you should ensure manually that elaboration routines are not called\n+twice unintentionally.\n+\n+@geindex -K (gnatbind)\n+\n+@item @code{-K}\n+\n+Give list of linker options specified for link.\n+\n @geindex -l (gnatbind)\n \n @item @code{-l}\n@@ -29292,8 +29308,8 @@ to permit their use in free software.\n \n @printindex ge\n \n-@anchor{cf}@w{                              }\n @anchor{gnat_ugn/gnat_utility_programs switches-related-to-project-files}@w{                              }\n+@anchor{cf}@w{                              }\n \n @c %**end of body\n @bye"}, {"sha": "19a8b4112e7de112f8e125235c89c4bc5382f3e0", "filename": "gcc/ada/opt.ads", "status": "modified", "additions": 4, "deletions": 0, "changes": 4, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/72c5ce77a028e57048c8666a7b782e3b921ee28c/gcc%2Fada%2Fopt.ads", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/72c5ce77a028e57048c8666a7b782e3b921ee28c/gcc%2Fada%2Fopt.ads", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fada%2Fopt.ads?ref=72c5ce77a028e57048c8666a7b782e3b921ee28c", "patch": "@@ -267,6 +267,10 @@ package Opt is\n    --  Set to True to detect whether subprogram parameters and function results\n    --  alias the same object(s).\n \n+   Check_Elaboration_Flags : Boolean := True;\n+   --  GNATBIND\n+   --  Set to False if switch -k is set.\n+\n    Check_Float_Overflow : Boolean := False;\n    --  GNAT\n    --  Set to True to check that operations on predefined unconstrained float"}, {"sha": "a543ad9e0ed50602970f2ee67b8ba32bc07066d8", "filename": "gcc/ada/switch-b.adb", "status": "modified", "additions": 6, "deletions": 0, "changes": 6, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/72c5ce77a028e57048c8666a7b782e3b921ee28c/gcc%2Fada%2Fswitch-b.adb", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/72c5ce77a028e57048c8666a7b782e3b921ee28c/gcc%2Fada%2Fswitch-b.adb", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fada%2Fswitch-b.adb?ref=72c5ce77a028e57048c8666a7b782e3b921ee28c", "patch": "@@ -379,6 +379,12 @@ package body Switch.B is\n                Bad_Switch (Switch_Chars);\n             end if;\n \n+         --  Processing for k switch\n+\n+         when 'k' =>\n+            Ptr := Ptr + 1;\n+            Check_Elaboration_Flags := False;\n+\n          --  Processing for K switch\n \n          when 'K' =>"}]}