{"sha": "faa0c328ee65f0d6d65d6e20181d26e336071919", "node_id": "C_kwDOANBUbNoAKGZhYTBjMzI4ZWU2NWYwZDZkNjVkNmUyMDE4MWQyNmUzMzYwNzE5MTk", "commit": {"author": {"name": "Thomas Schwinge", "email": "thomas@codesourcery.com", "date": "2022-07-07T13:11:03Z"}, "committer": {"name": "Thomas Schwinge", "email": "thomas@codesourcery.com", "date": "2022-07-08T06:53:58Z"}, "message": "Fix one issue in OpenMP 'requires' directive diagnostics\n\nFix-up for recent commit 683f11843974f0bdf42f79cdcbb0c2b43c7b81b0\n\"OpenMP: Move omp requires checks to libgomp\".\n\n\tgcc/\n\t* lto-cgraph.cc (input_offload_tables) <LTO_symtab_edge>: Correct\n\t'fn2' computation.\n\tlibgomp/\n\t* testsuite/libgomp.c-c++-common/requires-1.c: Add 'dg-note's.\n\t* testsuite/libgomp.c-c++-common/requires-2.c: Likewise.\n\t* testsuite/libgomp.c-c++-common/requires-3.c: Likewise.\n\t* testsuite/libgomp.c-c++-common/requires-7.c: Likewise.\n\t* testsuite/libgomp.fortran/requires-1.f90: Likewise.", "tree": {"sha": "7a3b18b3b057863c05ee37c215abb14fd3d302db", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/7a3b18b3b057863c05ee37c215abb14fd3d302db"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/faa0c328ee65f0d6d65d6e20181d26e336071919", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/faa0c328ee65f0d6d65d6e20181d26e336071919", "html_url": "https://github.com/Rust-GCC/gccrs/commit/faa0c328ee65f0d6d65d6e20181d26e336071919", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/faa0c328ee65f0d6d65d6e20181d26e336071919/comments", "author": {"login": "tschwinge", "id": 21753, "node_id": "MDQ6VXNlcjIxNzUz", "avatar_url": "https://avatars.githubusercontent.com/u/21753?v=4", "gravatar_id": "", "url": "https://api.github.com/users/tschwinge", "html_url": "https://github.com/tschwinge", "followers_url": "https://api.github.com/users/tschwinge/followers", "following_url": "https://api.github.com/users/tschwinge/following{/other_user}", "gists_url": "https://api.github.com/users/tschwinge/gists{/gist_id}", "starred_url": "https://api.github.com/users/tschwinge/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/tschwinge/subscriptions", "organizations_url": "https://api.github.com/users/tschwinge/orgs", "repos_url": "https://api.github.com/users/tschwinge/repos", "events_url": "https://api.github.com/users/tschwinge/events{/privacy}", "received_events_url": "https://api.github.com/users/tschwinge/received_events", "type": "User", "site_admin": false}, "committer": {"login": "tschwinge", "id": 21753, "node_id": "MDQ6VXNlcjIxNzUz", "avatar_url": "https://avatars.githubusercontent.com/u/21753?v=4", "gravatar_id": "", "url": "https://api.github.com/users/tschwinge", "html_url": "https://github.com/tschwinge", "followers_url": "https://api.github.com/users/tschwinge/followers", "following_url": "https://api.github.com/users/tschwinge/following{/other_user}", "gists_url": "https://api.github.com/users/tschwinge/gists{/gist_id}", "starred_url": "https://api.github.com/users/tschwinge/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/tschwinge/subscriptions", "organizations_url": "https://api.github.com/users/tschwinge/orgs", "repos_url": "https://api.github.com/users/tschwinge/repos", "events_url": "https://api.github.com/users/tschwinge/events{/privacy}", "received_events_url": "https://api.github.com/users/tschwinge/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "13f44099bcc64ddb50a6dbd462bf79b258dfd02c", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/13f44099bcc64ddb50a6dbd462bf79b258dfd02c", "html_url": "https://github.com/Rust-GCC/gccrs/commit/13f44099bcc64ddb50a6dbd462bf79b258dfd02c"}], "stats": {"total": 32, "additions": 27, "deletions": 5}, "files": [{"sha": "6d9c36ea8b67f60ac66d0e2bf50b7f58d8a53732", "filename": "gcc/lto-cgraph.cc", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/faa0c328ee65f0d6d65d6e20181d26e336071919/gcc%2Flto-cgraph.cc", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/faa0c328ee65f0d6d65d6e20181d26e336071919/gcc%2Flto-cgraph.cc", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Flto-cgraph.cc?ref=faa0c328ee65f0d6d65d6e20181d26e336071919", "patch": "@@ -1879,7 +1879,7 @@ input_offload_tables (bool do_force_output)\n \t\t\t     && TREE_CODE (tmp_decl) != TRANSLATION_UNIT_DECL)\n \t\t\ttmp_decl = DECL_CONTEXT (tmp_decl);\n \t\t      if (tmp_decl != NULL_TREE)\n-\t\t\tfn2 = IDENTIFIER_POINTER (DECL_NAME (requires_decl));\n+\t\t\tfn2 = IDENTIFIER_POINTER (DECL_NAME (tmp_decl));\n \t\t    }\n \n \t\t  char buf1[sizeof (\"unified_address, unified_shared_memory, \""}, {"sha": "31996f1ecf657348f8cf25d97df8aac098ff3ee7", "filename": "libgomp/testsuite/libgomp.c-c++-common/requires-1.c", "status": "modified", "additions": 3, "deletions": 1, "changes": 4, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/faa0c328ee65f0d6d65d6e20181d26e336071919/libgomp%2Ftestsuite%2Flibgomp.c-c%2B%2B-common%2Frequires-1.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/faa0c328ee65f0d6d65d6e20181d26e336071919/libgomp%2Ftestsuite%2Flibgomp.c-c%2B%2B-common%2Frequires-1.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libgomp%2Ftestsuite%2Flibgomp.c-c%2B%2B-common%2Frequires-1.c?ref=faa0c328ee65f0d6d65d6e20181d26e336071919", "patch": "@@ -20,5 +20,7 @@ main (void)\n   return 0;\n }\n \n-/* { dg-error \"OpenMP 'requires' directive with non-identical clauses in multiple compilation units: 'unified_shared_memory' vs. 'unified_address'\" \"\" { target *-*-* } 0 }  */\n+/* { dg-error \"OpenMP 'requires' directive with non-identical clauses in multiple compilation units: 'unified_shared_memory' vs. 'unified_address'\" \"\" { target *-*-* } 0 }\n+     { dg-note {requires-1\\.c' has 'unified_shared_memory'} {} { target *-*-* } 0 }\n+     { dg-note {requires-1-aux\\.c' has 'unified_address'} {} { target *-*-* } 0 } */\n /* { dg-excess-errors \"Ignore messages like: errors during merging of translation units|mkoffload returned 1 exit status\" } */"}, {"sha": "b20e154b0c70bc54fcd6e785cc3911392015c2b7", "filename": "libgomp/testsuite/libgomp.c-c++-common/requires-2.c", "status": "modified", "additions": 3, "deletions": 1, "changes": 4, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/faa0c328ee65f0d6d65d6e20181d26e336071919/libgomp%2Ftestsuite%2Flibgomp.c-c%2B%2B-common%2Frequires-2.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/faa0c328ee65f0d6d65d6e20181d26e336071919/libgomp%2Ftestsuite%2Flibgomp.c-c%2B%2B-common%2Frequires-2.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libgomp%2Ftestsuite%2Flibgomp.c-c%2B%2B-common%2Frequires-2.c?ref=faa0c328ee65f0d6d65d6e20181d26e336071919", "patch": "@@ -21,5 +21,7 @@ main (void)\n   return 0;\n }\n \n-/* { dg-error \"OpenMP 'requires' directive with 'unified_shared_memory' specified only in some compilation units\" \"\" { target *-*-* } 0 }  */\n+/* { dg-error \"OpenMP 'requires' directive with 'unified_shared_memory' specified only in some compilation units\" \"\" { target *-*-* } 0 }\n+     { dg-note {requires-2\\.c' has 'unified_shared_memory'} {} { target *-*-* } 0 }\n+     { dg-note {but '[^']*requires-2-aux\\.c' has not} {} { target *-*-* } 0 } */\n /* { dg-excess-errors \"Ignore messages like: errors during merging of translation units|mkoffload returned 1 exit status\" } */"}, {"sha": "a549a19ebbbac9283e4437a09d92fae7b177dbfd", "filename": "libgomp/testsuite/libgomp.c-c++-common/requires-3.c", "status": "modified", "additions": 3, "deletions": 1, "changes": 4, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/faa0c328ee65f0d6d65d6e20181d26e336071919/libgomp%2Ftestsuite%2Flibgomp.c-c%2B%2B-common%2Frequires-3.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/faa0c328ee65f0d6d65d6e20181d26e336071919/libgomp%2Ftestsuite%2Flibgomp.c-c%2B%2B-common%2Frequires-3.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libgomp%2Ftestsuite%2Flibgomp.c-c%2B%2B-common%2Frequires-3.c?ref=faa0c328ee65f0d6d65d6e20181d26e336071919", "patch": "@@ -20,5 +20,7 @@ main (void)\n   return 0;\n }\n \n-/* { dg-error \"OpenMP 'requires' directive with non-identical clauses in multiple compilation units: 'unified_address, unified_shared_memory' vs. 'unified_address'\" \"\" { target *-*-* } 0 }  */\n+/* { dg-error \"OpenMP 'requires' directive with non-identical clauses in multiple compilation units: 'unified_address, unified_shared_memory' vs. 'unified_address'\" \"\" { target *-*-* } 0 }\n+     { dg-note {requires-3\\.c' has 'unified_address, unified_shared_memory'} {} { target *-*-* } 0 }\n+     { dg-note {requires-3-aux\\.c' has 'unified_address'} {} { target *-*-* } 0 } */\n /* { dg-excess-errors \"Ignore messages like: errors during merging of translation units|mkoffload returned 1 exit status\" } */"}, {"sha": "63afcc92b9a9988159aa3b6dce709868a93b2693", "filename": "libgomp/testsuite/libgomp.c-c++-common/requires-7.c", "status": "modified", "additions": 9, "deletions": 1, "changes": 10, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/faa0c328ee65f0d6d65d6e20181d26e336071919/libgomp%2Ftestsuite%2Flibgomp.c-c%2B%2B-common%2Frequires-7.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/faa0c328ee65f0d6d65d6e20181d26e336071919/libgomp%2Ftestsuite%2Flibgomp.c-c%2B%2B-common%2Frequires-7.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libgomp%2Ftestsuite%2Flibgomp.c-c%2B%2B-common%2Frequires-7.c?ref=faa0c328ee65f0d6d65d6e20181d26e336071919", "patch": "@@ -20,5 +20,13 @@ main (void)\n   return 0;\n }\n \n-/* { dg-error \"OpenMP 'requires' directive with non-identical clauses in multiple compilation units: 'unified_shared_memory' vs. 'unified_address'\" \"\" { target *-*-* } 0 }  */\n+/* { dg-error \"OpenMP 'requires' directive with non-identical clauses in multiple compilation units: 'unified_shared_memory' vs. 'unified_address'\" \"\" { target *-*-* } 0 }\n+     { dg-note {requires-7\\.c' has 'unified_shared_memory'} {} { target *-*-* } 0 }\n+     TODO We're currently not streaming location information for the OpenMP\n+     directives used in 'requires-7-aux.c', so we're not seeing the source file\n+     name here (but a temporary '*.o' instead; for details, see\n+     <https://gcc.gnu.org/pipermail/gcc-patches/2022-July/598011.html>):\n+     { dg-note {requires-7-aux\\.c' has 'unified_address'} {} { xfail *-*-* } 0 }\n+     ..., but we may still verify that the rest of the diagnostic is correct:\n+     { dg-note {' has 'unified_address'} {} { target *-*-* } 0 } */\n /* { dg-excess-errors \"Ignore messages like: errors during merging of translation units|mkoffload returned 1 exit status\" } */"}, {"sha": "9a0c33461f81c76672127b6e0333383810e0fb19", "filename": "libgomp/testsuite/libgomp.fortran/requires-1.f90", "status": "modified", "additions": 8, "deletions": 0, "changes": 8, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/faa0c328ee65f0d6d65d6e20181d26e336071919/libgomp%2Ftestsuite%2Flibgomp.fortran%2Frequires-1.f90", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/faa0c328ee65f0d6d65d6e20181d26e336071919/libgomp%2Ftestsuite%2Flibgomp.fortran%2Frequires-1.f90", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libgomp%2Ftestsuite%2Flibgomp.fortran%2Frequires-1.f90?ref=faa0c328ee65f0d6d65d6e20181d26e336071919", "patch": "@@ -23,4 +23,12 @@ program main\n end\n \n ! { dg-error \"OpenMP 'requires' directive with non-identical clauses in multiple compilation units: 'unified_shared_memory' vs. 'unified_address'\" \"\" { target *-*-* } 0 }\n+!   { dg-note {requires-1\\.f90' has 'unified_shared_memory'} {} { target *-*-* } 0 }\n+!   TODO We're currently not streaming location information for the OpenMP\n+!   directives used in 'requires-7-aux.c', so we're not seeing the source file\n+!   name here (but a temporary '*.o' instead; for details, see\n+!   <https://gcc.gnu.org/pipermail/gcc-patches/2022-July/598011.html>):\n+!   { dg-note {requires-1-aux\\.f90' has 'unified_address'} {} { xfail *-*-* } 0 }\n+!   ..., but we may still verify that the rest of the diagnostic is correct:\n+!   { dg-note {' has 'unified_address'} {} { target *-*-* } 0 }\n ! { dg-excess-errors \"Ignore messages like: errors during merging of translation units|mkoffload returned 1 exit status\" }"}]}