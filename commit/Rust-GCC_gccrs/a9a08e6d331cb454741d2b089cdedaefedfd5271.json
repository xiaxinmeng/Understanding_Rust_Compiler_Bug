{"sha": "a9a08e6d331cb454741d2b089cdedaefedfd5271", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6YTlhMDhlNmQzMzFjYjQ1NDc0MWQyYjA4OWNkZWRhZWZlZGZkNTI3MQ==", "commit": {"author": {"name": "Ed Schonberg", "email": "schonberg@adacore.com", "date": "2019-09-17T08:00:07Z"}, "committer": {"name": "Pierre-Marie de Rodat", "email": "pmderodat@gcc.gnu.org", "date": "2019-09-17T08:00:07Z"}, "message": "[Ada] In a generic use Presanalyze_Spec_Expression on Predicates\n\nWhen verifying that the meaning of an aspect has not changed between the\nfreeze point of the entity and the end of the declarations, we analkyze\na copy of the expression to verify its conformance to previous analysis.\nIf the expression contains overloaded references, these have to be\nresolved, which is not done if the expression is only preanalyzed.  This\napplies in particular to expressions in predicates.\n\n2019-09-17  Ed Schonberg  <schonberg@adacore.com>\n\ngcc/ada/\n\n\t* sem_ch13.adb (Check_Aspect_At_End_Of_Declarations): In a\n\tgeneric context, for a Predicate aspect, use\n\tPreanalyze_Spec_Expression to verify conformance.\n\ngcc/testsuite/\n\n\t* gnat.dg/predicate13.adb, gnat.dg/predicate13.ads: New\n\ttestcase.\n\nFrom-SVN: r275778", "tree": {"sha": "e16bb4785cb0191756fb6d85af223dc5a7ba4537", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/e16bb4785cb0191756fb6d85af223dc5a7ba4537"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/a9a08e6d331cb454741d2b089cdedaefedfd5271", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/a9a08e6d331cb454741d2b089cdedaefedfd5271", "html_url": "https://github.com/Rust-GCC/gccrs/commit/a9a08e6d331cb454741d2b089cdedaefedfd5271", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/a9a08e6d331cb454741d2b089cdedaefedfd5271/comments", "author": {"login": "Edschonberg", "id": 6352375, "node_id": "MDQ6VXNlcjYzNTIzNzU=", "avatar_url": "https://avatars.githubusercontent.com/u/6352375?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Edschonberg", "html_url": "https://github.com/Edschonberg", "followers_url": "https://api.github.com/users/Edschonberg/followers", "following_url": "https://api.github.com/users/Edschonberg/following{/other_user}", "gists_url": "https://api.github.com/users/Edschonberg/gists{/gist_id}", "starred_url": "https://api.github.com/users/Edschonberg/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Edschonberg/subscriptions", "organizations_url": "https://api.github.com/users/Edschonberg/orgs", "repos_url": "https://api.github.com/users/Edschonberg/repos", "events_url": "https://api.github.com/users/Edschonberg/events{/privacy}", "received_events_url": "https://api.github.com/users/Edschonberg/received_events", "type": "User", "site_admin": false}, "committer": null, "parents": [{"sha": "01e44bfa81a3423d55e5d624e2c7241daedf44e4", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/01e44bfa81a3423d55e5d624e2c7241daedf44e4", "html_url": "https://github.com/Rust-GCC/gccrs/commit/01e44bfa81a3423d55e5d624e2c7241daedf44e4"}], "stats": {"total": 39, "additions": 38, "deletions": 1}, "files": [{"sha": "94877b24ea138fd545274c988598eb9895f3f12b", "filename": "gcc/ada/ChangeLog", "status": "modified", "additions": 6, "deletions": 0, "changes": 6, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/a9a08e6d331cb454741d2b089cdedaefedfd5271/gcc%2Fada%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/a9a08e6d331cb454741d2b089cdedaefedfd5271/gcc%2Fada%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fada%2FChangeLog?ref=a9a08e6d331cb454741d2b089cdedaefedfd5271", "patch": "@@ -1,3 +1,9 @@\n+2019-09-17  Ed Schonberg  <schonberg@adacore.com>\n+\n+\t* sem_ch13.adb (Check_Aspect_At_End_Of_Declarations): In a\n+\tgeneric context, for a Predicate aspect, use\n+\tPreanalyze_Spec_Expression to verify conformance.\n+\n 2019-09-17  Javier Miranda  <miranda@adacore.com>\n \n \t* sem_ch3.adb (Constrain_Corresponding_Record): Propagate"}, {"sha": "ef9f965a564b3d5cce5f5c899963c35ebfa5ba21", "filename": "gcc/ada/sem_ch13.adb", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/a9a08e6d331cb454741d2b089cdedaefedfd5271/gcc%2Fada%2Fsem_ch13.adb", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/a9a08e6d331cb454741d2b089cdedaefedfd5271/gcc%2Fada%2Fsem_ch13.adb", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fada%2Fsem_ch13.adb?ref=a9a08e6d331cb454741d2b089cdedaefedfd5271", "patch": "@@ -9383,7 +9383,7 @@ package body Sem_Ch13 is\n               or else A_Id = Aspect_Priority\n             then\n                Push_Type (Ent);\n-               Preanalyze (Freeze_Expr);\n+               Preanalyze_Spec_Expression (Freeze_Expr, T);\n                Pop_Type (Ent);\n             else\n                Preanalyze (Freeze_Expr);"}, {"sha": "d5b3e5a659042475935e0f4d1c696cde265ae04f", "filename": "gcc/testsuite/ChangeLog", "status": "modified", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/a9a08e6d331cb454741d2b089cdedaefedfd5271/gcc%2Ftestsuite%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/a9a08e6d331cb454741d2b089cdedaefedfd5271/gcc%2Ftestsuite%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2FChangeLog?ref=a9a08e6d331cb454741d2b089cdedaefedfd5271", "patch": "@@ -1,3 +1,8 @@\n+2019-09-17  Ed Schonberg  <schonberg@adacore.com>\n+\n+\t* gnat.dg/predicate13.adb, gnat.dg/predicate13.ads: New\n+\ttestcase.\n+\n 2019-09-17  Javier Miranda  <miranda@adacore.com>\n \n \t* gnat.dg/limited4.adb: New testcase."}, {"sha": "24b6918bfc1e93cce0e28cd0c8483dc552a3e169", "filename": "gcc/testsuite/gnat.dg/predicate13.adb", "status": "added", "additions": 3, "deletions": 0, "changes": 3, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/a9a08e6d331cb454741d2b089cdedaefedfd5271/gcc%2Ftestsuite%2Fgnat.dg%2Fpredicate13.adb", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/a9a08e6d331cb454741d2b089cdedaefedfd5271/gcc%2Ftestsuite%2Fgnat.dg%2Fpredicate13.adb", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgnat.dg%2Fpredicate13.adb?ref=a9a08e6d331cb454741d2b089cdedaefedfd5271", "patch": "@@ -0,0 +1,3 @@\n+package body Predicate13 is\n+    procedure Dummy is null;\n+end Predicate13;\n\\ No newline at end of file"}, {"sha": "2e19d491fec0bd29e3c13f5f3d1e610885b85458", "filename": "gcc/testsuite/gnat.dg/predicate13.ads", "status": "added", "additions": 23, "deletions": 0, "changes": 23, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/a9a08e6d331cb454741d2b089cdedaefedfd5271/gcc%2Ftestsuite%2Fgnat.dg%2Fpredicate13.ads", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/a9a08e6d331cb454741d2b089cdedaefedfd5271/gcc%2Ftestsuite%2Fgnat.dg%2Fpredicate13.ads", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgnat.dg%2Fpredicate13.ads?ref=a9a08e6d331cb454741d2b089cdedaefedfd5271", "patch": "@@ -0,0 +1,23 @@\n+--  { dg-do compile }\n+generic\n+package Predicate13 is\n+\n+    function Valid return Boolean is\n+    (True);\n+\n+    function Foo return Boolean is\n+    (True);\n+\n+    type State_Type is (Valid, Invalid);\n+    type Context_Type is private;\n+\n+    private\n+\n+    type Context_Type is\n+    record\n+    State : State_Type;\n+    end record  with Dynamic_Predicate => (State = Valid);\n+\n+    procedure Dummy;\n+\n+end Predicate13;"}]}