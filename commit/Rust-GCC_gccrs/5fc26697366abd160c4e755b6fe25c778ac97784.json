{"sha": "5fc26697366abd160c4e755b6fe25c778ac97784", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6NWZjMjY2OTczNjZhYmQxNjBjNGU3NTViNmZlMjVjNzc4YWM5Nzc4NA==", "commit": {"author": {"name": "Yannick Moy", "email": "moy@adacore.com", "date": "2018-12-11T11:10:07Z"}, "committer": {"name": "Pierre-Marie de Rodat", "email": "pmderodat@gcc.gnu.org", "date": "2018-12-11T11:10:07Z"}, "message": "[Ada] Better error message from GNATprove on illegal switch\n\nWhen a compilation switch is wrongly passed to GNATprove without the\nleading hyphen, this patch issues a clear error message instead of the\nobscure 'usage' message previously displayed.\n\nThere is no impact on compilation.\n\n2018-12-11  Yannick Moy  <moy@adacore.com>\n\ngcc/ada/\n\n\t* gnat1drv.adb (Gnat1drv): Issue specific error message in\n\tGNATprove mode when multiple file names on the command line.\n\t* osint.adb, osint.ads (Dump_Command_Line_Source_File_Names):\n\tNew procedure to print file names on the command line.\n\nFrom-SVN: r266989", "tree": {"sha": "1af5b93a7d1bc3ccf9cc3fd5f8d32f5ba45cafe1", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/1af5b93a7d1bc3ccf9cc3fd5f8d32f5ba45cafe1"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/5fc26697366abd160c4e755b6fe25c778ac97784", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/5fc26697366abd160c4e755b6fe25c778ac97784", "html_url": "https://github.com/Rust-GCC/gccrs/commit/5fc26697366abd160c4e755b6fe25c778ac97784", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/5fc26697366abd160c4e755b6fe25c778ac97784/comments", "author": {"login": "yannickmoy", "id": 859440, "node_id": "MDQ6VXNlcjg1OTQ0MA==", "avatar_url": "https://avatars.githubusercontent.com/u/859440?v=4", "gravatar_id": "", "url": "https://api.github.com/users/yannickmoy", "html_url": "https://github.com/yannickmoy", "followers_url": "https://api.github.com/users/yannickmoy/followers", "following_url": "https://api.github.com/users/yannickmoy/following{/other_user}", "gists_url": "https://api.github.com/users/yannickmoy/gists{/gist_id}", "starred_url": "https://api.github.com/users/yannickmoy/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/yannickmoy/subscriptions", "organizations_url": "https://api.github.com/users/yannickmoy/orgs", "repos_url": "https://api.github.com/users/yannickmoy/repos", "events_url": "https://api.github.com/users/yannickmoy/events{/privacy}", "received_events_url": "https://api.github.com/users/yannickmoy/received_events", "type": "User", "site_admin": false}, "committer": null, "parents": [{"sha": "e64ac63149a6ec0ee9403079eea7df857ff59587", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/e64ac63149a6ec0ee9403079eea7df857ff59587", "html_url": "https://github.com/Rust-GCC/gccrs/commit/e64ac63149a6ec0ee9403079eea7df857ff59587"}], "stats": {"total": 38, "additions": 36, "deletions": 2}, "files": [{"sha": "003bea4501d131e75e6668873213293df8f242ea", "filename": "gcc/ada/ChangeLog", "status": "modified", "additions": 7, "deletions": 0, "changes": 7, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/5fc26697366abd160c4e755b6fe25c778ac97784/gcc%2Fada%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/5fc26697366abd160c4e755b6fe25c778ac97784/gcc%2Fada%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fada%2FChangeLog?ref=5fc26697366abd160c4e755b6fe25c778ac97784", "patch": "@@ -1,3 +1,10 @@\n+2018-12-11  Yannick Moy  <moy@adacore.com>\n+\n+\t* gnat1drv.adb (Gnat1drv): Issue specific error message in\n+\tGNATprove mode when multiple file names on the command line.\n+\t* osint.adb, osint.ads (Dump_Command_Line_Source_File_Names):\n+\tNew procedure to print file names on the command line.\n+\n 2018-12-11  Javier Miranda  <miranda@adacore.com>\n \n \t* exp_aggr.adb (Convert_To_Assignments): When gnerating C, do"}, {"sha": "3c1bf360c25285f520be50acf0bdf391828659e6", "filename": "gcc/ada/gnat1drv.adb", "status": "modified", "additions": 15, "deletions": 2, "changes": 17, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/5fc26697366abd160c4e755b6fe25c778ac97784/gcc%2Fada%2Fgnat1drv.adb", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/5fc26697366abd160c4e755b6fe25c778ac97784/gcc%2Fada%2Fgnat1drv.adb", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fada%2Fgnat1drv.adb?ref=5fc26697366abd160c4e755b6fe25c778ac97784", "patch": "@@ -1161,8 +1161,21 @@ begin\n       --  gnat1 is invoked from gcc in the normal case.\n \n       if Osint.Number_Of_Files /= 1 then\n-         Usage;\n-         Write_Eol;\n+\n+         --  In GNATprove mode, gcc is not called, so we may end up with\n+         --  switches wrongly interpreted as source file names when they are\n+         --  written by mistake without a starting hyphen. Issue a specific\n+         --  error message but do not print the internal 'usage' message.\n+\n+         if GNATprove_Mode then\n+            Write_Str (\"one of the following is not a valid switch\"\n+                       & \" or source file name: \");\n+            Osint.Dump_Command_Line_Source_File_Names;\n+         else\n+            Usage;\n+            Write_Eol;\n+         end if;\n+\n          Osint.Fail (\"you must provide one source file\");\n \n       elsif Usage_Requested then"}, {"sha": "58e49323747031ad242c1061018cfaa2421a2d87", "filename": "gcc/ada/osint.adb", "status": "modified", "additions": 11, "deletions": 0, "changes": 11, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/5fc26697366abd160c4e755b6fe25c778ac97784/gcc%2Fada%2Fosint.adb", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/5fc26697366abd160c4e755b6fe25c778ac97784/gcc%2Fada%2Fosint.adb", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fada%2Fosint.adb?ref=5fc26697366abd160c4e755b6fe25c778ac97784", "patch": "@@ -787,6 +787,17 @@ package body Osint is\n       end if;\n    end Dir_In_Src_Search_Path;\n \n+   -----------------------------------------\n+   -- Dump_Command_Line_Source_File_Names --\n+   -----------------------------------------\n+\n+   procedure Dump_Command_Line_Source_File_Names is\n+   begin\n+      for J in 1 .. Number_Of_Files loop\n+         Write_Str (File_Names (J).all & \" \");\n+      end loop;\n+   end Dump_Command_Line_Source_File_Names;\n+\n    ----------------------------\n    -- Dump_Source_File_Names --\n    ----------------------------"}, {"sha": "4be420ed75ec62a782da1e7617e3be6550cd16b4", "filename": "gcc/ada/osint.ads", "status": "modified", "additions": 3, "deletions": 0, "changes": 3, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/5fc26697366abd160c4e755b6fe25c778ac97784/gcc%2Fada%2Fosint.ads", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/5fc26697366abd160c4e755b6fe25c778ac97784/gcc%2Fada%2Fosint.ads", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fada%2Fosint.ads?ref=5fc26697366abd160c4e755b6fe25c778ac97784", "patch": "@@ -508,6 +508,9 @@ package Osint is\n    --  (i.e. Include_Dir_Default_Prefix). The text is sent to whatever Output\n    --  is currently using (e.g. standard output or standard error).\n \n+   procedure Dump_Command_Line_Source_File_Names;\n+   --  Prints out the names of all source files on the command-line\n+\n    -------------------------------------------\n    -- Representation of Library Information --\n    -------------------------------------------"}]}