{"sha": "3c19e9be432611cd1be9f71a12984fa90919f5d3", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6M2MxOWU5YmU0MzI2MTFjZDFiZTlmNzFhMTI5ODRmYTkwOTE5ZjVkMw==", "commit": {"author": {"name": "Ed Schonberg", "email": "schonberg@adacore.com", "date": "2009-04-20T12:29:39Z"}, "committer": {"name": "Arnaud Charlet", "email": "charlet@gcc.gnu.org", "date": "2009-04-20T12:29:39Z"}, "message": "sem_ch8,adb (Analyze_Object_Renaming): Reject ambiguous expressions in an object renaming declaration when...\n\n2009-04-20  Ed Schonberg  <schonberg@adacore.com>\n\n\t* sem_ch8,adb (Analyze_Object_Renaming): Reject ambiguous expressions\n\tin an object renaming declaration when the expected type is an\n\tanonymous access type.\n\n\t* sem_type.adb (Disambiguate): Use anonymousness to resolve a potential\n\tambiguity when one interpretation is an anonymous access type and the\n\tother is a named access type, and the context itself is anonymous\n\nFrom-SVN: r146404", "tree": {"sha": "8191080efbf741c0c8422d2f756457ec7452e8c8", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/8191080efbf741c0c8422d2f756457ec7452e8c8"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/3c19e9be432611cd1be9f71a12984fa90919f5d3", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/3c19e9be432611cd1be9f71a12984fa90919f5d3", "html_url": "https://github.com/Rust-GCC/gccrs/commit/3c19e9be432611cd1be9f71a12984fa90919f5d3", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/3c19e9be432611cd1be9f71a12984fa90919f5d3/comments", "author": {"login": "Edschonberg", "id": 6352375, "node_id": "MDQ6VXNlcjYzNTIzNzU=", "avatar_url": "https://avatars.githubusercontent.com/u/6352375?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Edschonberg", "html_url": "https://github.com/Edschonberg", "followers_url": "https://api.github.com/users/Edschonberg/followers", "following_url": "https://api.github.com/users/Edschonberg/following{/other_user}", "gists_url": "https://api.github.com/users/Edschonberg/gists{/gist_id}", "starred_url": "https://api.github.com/users/Edschonberg/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Edschonberg/subscriptions", "organizations_url": "https://api.github.com/users/Edschonberg/orgs", "repos_url": "https://api.github.com/users/Edschonberg/repos", "events_url": "https://api.github.com/users/Edschonberg/events{/privacy}", "received_events_url": "https://api.github.com/users/Edschonberg/received_events", "type": "User", "site_admin": false}, "committer": null, "parents": [{"sha": "5e9579b495d638798241fdc2e59de2b7b13d67e5", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/5e9579b495d638798241fdc2e59de2b7b13d67e5", "html_url": "https://github.com/Rust-GCC/gccrs/commit/5e9579b495d638798241fdc2e59de2b7b13d67e5"}], "stats": {"total": 72, "additions": 64, "deletions": 8}, "files": [{"sha": "56b55438650cf837c810f41600e0d00c725c7630", "filename": "gcc/ada/sem_ch8.adb", "status": "modified", "additions": 33, "deletions": 8, "changes": 41, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/3c19e9be432611cd1be9f71a12984fa90919f5d3/gcc%2Fada%2Fsem_ch8.adb", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/3c19e9be432611cd1be9f71a12984fa90919f5d3/gcc%2Fada%2Fsem_ch8.adb", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fada%2Fsem_ch8.adb?ref=3c19e9be432611cd1be9f71a12984fa90919f5d3", "patch": "@@ -782,25 +782,50 @@ package body Sem_Ch8 is\n                Error_Msg_N\n                  (\"expect anonymous access type in object renaming\", N);\n             end if;\n+\n          else\n             declare\n-               I   : Interp_Index;\n-               It  : Interp;\n-               Typ : Entity_Id := Empty;\n+               I    : Interp_Index;\n+               It   : Interp;\n+               Typ  : Entity_Id := Empty;\n+               Seen : Boolean := False;\n \n             begin\n                Get_First_Interp (Nam, I, It);\n                while Present (It.Typ) loop\n-                  if No (Typ) then\n-                     if Ekind (It.Typ) = Ekind (T)\n-                       and then Covers (T, It.Typ)\n+\n+                  --  Renaming is ambiguous if more than one candidate\n+                  --  interpretation is type-conformant with the context.\n+\n+                  if Ekind (It.Typ) = Ekind (T) then\n+                     if Ekind (T) = E_Anonymous_Access_Subprogram_Type\n+                       and then Type_Conformant\n+                         (Designated_Type (T), Designated_Type (It.Typ))\n+                     then\n+                        if not Seen then\n+                           Seen := True;\n+                        else\n+                           Error_Msg_N\n+                             (\"ambiguous expression in renaming\", Nam);\n+                        end if;\n+\n+                     elsif Ekind (T) = E_Anonymous_Access_Type\n+                       and then Covers\n+                         (Designated_Type (T), Designated_Type (It.Typ))\n                      then\n+                        if not Seen then\n+                           Seen := True;\n+                        else\n+                           Error_Msg_N\n+                             (\"ambiguous expression in renaming\", Nam);\n+                        end if;\n+                     end if;\n+\n+                     if Covers (T, It.Typ) then\n                         Typ := It.Typ;\n                         Set_Etype (Nam, Typ);\n                         Set_Is_Overloaded (Nam, False);\n                      end if;\n-                  else\n-                     Error_Msg_N (\"ambiguous expression in renaming\", N);\n                   end if;\n \n                   Get_Next_Interp (I, It);"}, {"sha": "6da87733ccd22ac483bd6ec79d2dfb3d09d263d5", "filename": "gcc/ada/sem_type.adb", "status": "modified", "additions": 31, "deletions": 0, "changes": 31, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/3c19e9be432611cd1be9f71a12984fa90919f5d3/gcc%2Fada%2Fsem_type.adb", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/3c19e9be432611cd1be9f71a12984fa90919f5d3/gcc%2Fada%2Fsem_type.adb", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fada%2Fsem_type.adb?ref=3c19e9be432611cd1be9f71a12984fa90919f5d3", "patch": "@@ -1680,6 +1680,37 @@ package body Sem_Type is\n       elsif Nkind (N) = N_Range then\n          return It1;\n \n+      --  Implement AI05-105: A renaming declaration with an access\n+      --  definition must resolve to an anonymous access type. This\n+      --  is a resolution rule and can be used to disambiguate.\n+\n+      elsif Nkind (Parent (N)) = N_Object_Renaming_Declaration\n+        and then Present (Access_Definition (Parent (N)))\n+      then\n+         if Ekind (It1.Typ) = E_Anonymous_Access_Type\n+           or else Ekind (It1.Typ) = E_Anonymous_Access_Subprogram_Type\n+         then\n+            if Ekind (It2.Typ) = Ekind (It1.Typ) then\n+\n+               --  True ambiguity\n+\n+               return No_Interp;\n+            else\n+               return It1;\n+            end if;\n+\n+         elsif Ekind (It2.Typ) = E_Anonymous_Access_Type\n+           or else Ekind (It2.Typ) = E_Anonymous_Access_Subprogram_Type\n+         then\n+            return It2;\n+\n+         else\n+\n+            --  No legal interpretation.\n+\n+            return No_Interp;\n+         end if;\n+\n       --  If two user defined-subprograms are visible, it is a true ambiguity,\n       --  unless one of them is an entry and the context is a conditional or\n       --  timed entry call, or unless we are within an instance and this is"}]}