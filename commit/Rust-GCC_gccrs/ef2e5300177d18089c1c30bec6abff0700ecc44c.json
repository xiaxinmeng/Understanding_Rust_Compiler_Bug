{"sha": "ef2e5300177d18089c1c30bec6abff0700ecc44c", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6ZWYyZTUzMDAxNzdkMTgwODljMWMzMGJlYzZhYmZmMDcwMGVjYzQ0Yw==", "commit": {"author": {"name": "Sandra Loosemore", "email": "sandra@codesourcery.com", "date": "2012-08-15T23:56:52Z"}, "committer": {"name": "Sandra Loosemore", "email": "sandra@gcc.gnu.org", "date": "2012-08-15T23:56:52Z"}, "message": "MIPS Technologies, Inc.\n\n2012-08-15  Sandra Loosemore  <sandra@codesourcery.com>\n\t    Maxim Kuvyrkov  <maxim@codesourcery.com>\n\t    Julian Brown  <julian@codesourcery.com>\n\t    MIPS Technologies, Inc.\n\n\tgcc/\n\t* config/mips/mips.md (dspmac, dspmacsat, accext, accmod, dspalu)\n\t(dspalusat): Add insn types.\n\t* config/mips/mips-dsp.md (add<DSPV:mode>3)\n\t(mips_add<DSP:dspfmt1>_s_<DSP:dspfmt2>)\n\t(sub<DSPV:mode>3, mips_sub<DSP:dspfmt1>_s_<DSP:dspfmt2>, mips_addsc)\n\t(mips_addwc, mips_modsub, mips_raddu_w_qb, mips_absq_s_<DSPQ:dspfmt2>)\n\t(mips_precrq_qb_ph, mips_precrq_ph_w, mips_precrq_rs_ph_w)\n\t(mips_precrqu_s_qb_ph, mips_preceq_w_phl, mips_preceq_w_phr)\n\t(mips_precequ_ph_qbl, mips_precequ_ph_qbr, mips_precequ_ph_qbla)\n\t(mips_precequ_ph_qbra, mips_preceu_ph_qbl, mips_preceu_ph_qbr)\n\t(mips_preceu_ph_qbla, mips_preceu_ph_qbra, mips_shll_<DSPV:dspfmt2>)\n\t(mips_shll_s_<DSPQ:dspfmt2>, mips_shll_s_<DSPQ:dspfmt2>, mips_shrl_qb)\n\t(mips_shra_ph, mips_shra_r_<DSPQ:dspfmt2>, mips_bitrev, mips_insv)\n\t(mips_repl_qb, mips_repl_ph)\n\t(mips_cmp<DSPV:dspfmt1_1>_eq_<DSPV:dspfmt2>)\n\t(mips_cmp<DSPV:dspfmt1_1>_lt_<DSPV:dspfmt2>)\n\t(mips_cmp<DSPV:dspfmt1_1>_le_<DSPV:dspfmt2>, mips_cmpgu_eq_qb)\n\t(mips_cmpgu_lt_qb, mips_cmpgu_le_qb, mips_pick_<DSPV:dspfmt2>)\n\t(mips_packrl_ph, mips_wrdsp, mips_rddsp): Change type to dspalu.\n\t(mips_dpau_h_qbl, mips_dpau_h_qbr, mips_dpsu_h_qbl, mips_dpsu_h_qbr)\n\t(mips_dpaq_s_w_ph, mips_dpsq_s_w_ph, mips_mulsaq_s_w_ph)\n\t(mips_maq_s_w_phl, mips_maq_s_w_phr, mips_maq_sa_w_phr): Set type to\n\tdspmac.\n\t(mips_dpaq_sa_l_w, mips_dpsq_sa_l_w, mips_maq_sa_w_phl): Set type to\n\tdspmacsat.\n\t(mips_extr_w, mips_extr_r_w, mips_extr_rs_w, mips_extp, mips_extpdp):\n\tSet type to accext.\n\t(mips_shilo, mips_mthlip): Set type to accmod.\n\t* config/mips/mips-dspr2.md (mips_absq_s_qb, mips_addu_s_ph)\n\t(mips_adduh_r_qb): Set type to dspalusat.\n\t(mips_addu_ph, mips_adduh_qb, mips_append, mips_balign)\n\t(mips_cmpgdu_eq_qb, mips_cmpgdu_lt_qb, mips_cmpgdu_le_qb)\n\t(mips_precr_qb_ph, mips_precr_sra_ph_w, mips_precr_sra_r_ph_w)\n\t(mips_prepend, mips_shra_qb, mips_shra_r_qb, mips_shrl_ph)\n\t(mips_subu_ph, mips_subuh_qb, mips_subuh_r_qb, mips_addqh_ph)\n\t(mips_addqh_r_ph, mips_addqh_w, mips_addqh_r_w, mips_subqh_ph)\n\t(mips_subqh_r_ph, mips_subqh_w, mips_subqh_r_w): Set type to dspalu.\n\t(mips_dpa_w_ph, mips_dps_w_ph, mips_mulsa_w_ph, mips_dpax_w_ph)\n\t(mips_dpsx_w_ph, mips_dpaqx_s_w_ph, mips_dpsqx_s_w_ph): Set type to\n\tdspmac.  Set accum_in attribute.\n\t(mips_subu_s_ph): Set type to dspalusat. \n\t(mips_dpaqx_sa_w_ph, mips_dpsqx_sa_w_ph): Set type to dspmacsat.\n\tSet accum_in attribute.\n\t* config/mips/mips-protos.h (mips_dspalu_bypass_p): Add prototype.\n\t* config/mips/mips.c (dspalu_bypass_table): New.\n\t(mips_dspalu_bypass_p): New.\n\t* config/mips/24k.md (r24k_dsp_alu, r24k_dsp_mac, r24k_dsp_mac_sat)\n\t(r24k_dsp_acc_ext, r24k_dsp_acc_mod): New insn reservations.\n\t(r24k_int_mult, r24k_int_mthilo, r24k_dsp_mac, r24k_dsp_mac_sat)\n\t(r24k_dsp_acc_ext, r24k_dsp_acc_mod, r24k_dsp_alu): New bypasses.\n\t* config/mips/74k.md (r74k_dsp_alu, r74k_dsp_alu_sat, r74k_dsp_mac)\n\t(r74k_dsp_mac_sat, r74k_dsp_acc_ext, r74k_dsp_acc_mod): New insn\n\treservations.\n\t(r74k_dsp_mac, r74k_dsp_mac_sat, r74k_int_mult, r74k_int_mul3)\n\t(r74k_dsp_mac, r74k_dsp_mac_sat): New bypasses.\n\nCo-Authored-By: Julian Brown <julian@codesourcery.com>\nCo-Authored-By: Maxim Kuvyrkov <maxim@codesourcery.com>\n\nFrom-SVN: r190423", "tree": {"sha": "4cc6f27453fb259c79914fec3212edf412165337", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/4cc6f27453fb259c79914fec3212edf412165337"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/ef2e5300177d18089c1c30bec6abff0700ecc44c", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/ef2e5300177d18089c1c30bec6abff0700ecc44c", "html_url": "https://github.com/Rust-GCC/gccrs/commit/ef2e5300177d18089c1c30bec6abff0700ecc44c", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/ef2e5300177d18089c1c30bec6abff0700ecc44c/comments", "author": {"login": "SandraLoosemore", "id": 104087111, "node_id": "U_kgDOBjQ-Rw", "avatar_url": "https://avatars.githubusercontent.com/u/104087111?v=4", "gravatar_id": "", "url": "https://api.github.com/users/SandraLoosemore", "html_url": "https://github.com/SandraLoosemore", "followers_url": "https://api.github.com/users/SandraLoosemore/followers", "following_url": "https://api.github.com/users/SandraLoosemore/following{/other_user}", "gists_url": "https://api.github.com/users/SandraLoosemore/gists{/gist_id}", "starred_url": "https://api.github.com/users/SandraLoosemore/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/SandraLoosemore/subscriptions", "organizations_url": "https://api.github.com/users/SandraLoosemore/orgs", "repos_url": "https://api.github.com/users/SandraLoosemore/repos", "events_url": "https://api.github.com/users/SandraLoosemore/events{/privacy}", "received_events_url": "https://api.github.com/users/SandraLoosemore/received_events", "type": "User", "site_admin": false}, "committer": null, "parents": [{"sha": "66b038ce225f80bd7ca5b1af0e9b7be30f9171ca", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/66b038ce225f80bd7ca5b1af0e9b7be30f9171ca", "html_url": "https://github.com/Rust-GCC/gccrs/commit/66b038ce225f80bd7ca5b1af0e9b7be30f9171ca"}], "stats": {"total": 490, "additions": 388, "deletions": 102}, "files": [{"sha": "1f990cff88b0bac1b2a577833ca823765d6e1236", "filename": "gcc/ChangeLog", "status": "modified", "additions": 62, "deletions": 0, "changes": 62, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/ef2e5300177d18089c1c30bec6abff0700ecc44c/gcc%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/ef2e5300177d18089c1c30bec6abff0700ecc44c/gcc%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2FChangeLog?ref=ef2e5300177d18089c1c30bec6abff0700ecc44c", "patch": "@@ -1,3 +1,65 @@\n+2012-08-15  Sandra Loosemore  <sandra@codesourcery.com>\n+\t    Maxim Kuvyrkov  <maxim@codesourcery.com>\n+\t    Julian Brown  <julian@codesourcery.com>\n+\t    MIPS Technologies, Inc.\n+\n+\tgcc/\n+\t* config/mips/mips.md (dspmac, dspmacsat, accext, accmod, dspalu)\n+\t(dspalusat): Add insn types.\n+\t* config/mips/mips-dsp.md (add<DSPV:mode>3)\n+\t(mips_add<DSP:dspfmt1>_s_<DSP:dspfmt2>)\n+\t(sub<DSPV:mode>3, mips_sub<DSP:dspfmt1>_s_<DSP:dspfmt2>, mips_addsc)\n+\t(mips_addwc, mips_modsub, mips_raddu_w_qb, mips_absq_s_<DSPQ:dspfmt2>)\n+\t(mips_precrq_qb_ph, mips_precrq_ph_w, mips_precrq_rs_ph_w)\n+\t(mips_precrqu_s_qb_ph, mips_preceq_w_phl, mips_preceq_w_phr)\n+\t(mips_precequ_ph_qbl, mips_precequ_ph_qbr, mips_precequ_ph_qbla)\n+\t(mips_precequ_ph_qbra, mips_preceu_ph_qbl, mips_preceu_ph_qbr)\n+\t(mips_preceu_ph_qbla, mips_preceu_ph_qbra, mips_shll_<DSPV:dspfmt2>)\n+\t(mips_shll_s_<DSPQ:dspfmt2>, mips_shll_s_<DSPQ:dspfmt2>, mips_shrl_qb)\n+\t(mips_shra_ph, mips_shra_r_<DSPQ:dspfmt2>, mips_bitrev, mips_insv)\n+\t(mips_repl_qb, mips_repl_ph)\n+\t(mips_cmp<DSPV:dspfmt1_1>_eq_<DSPV:dspfmt2>)\n+\t(mips_cmp<DSPV:dspfmt1_1>_lt_<DSPV:dspfmt2>)\n+\t(mips_cmp<DSPV:dspfmt1_1>_le_<DSPV:dspfmt2>, mips_cmpgu_eq_qb)\n+\t(mips_cmpgu_lt_qb, mips_cmpgu_le_qb, mips_pick_<DSPV:dspfmt2>)\n+\t(mips_packrl_ph, mips_wrdsp, mips_rddsp): Change type to dspalu.\n+\t(mips_dpau_h_qbl, mips_dpau_h_qbr, mips_dpsu_h_qbl, mips_dpsu_h_qbr)\n+\t(mips_dpaq_s_w_ph, mips_dpsq_s_w_ph, mips_mulsaq_s_w_ph)\n+\t(mips_maq_s_w_phl, mips_maq_s_w_phr, mips_maq_sa_w_phr): Set type to\n+\tdspmac.\n+\t(mips_dpaq_sa_l_w, mips_dpsq_sa_l_w, mips_maq_sa_w_phl): Set type to\n+\tdspmacsat.\n+\t(mips_extr_w, mips_extr_r_w, mips_extr_rs_w, mips_extp, mips_extpdp):\n+\tSet type to accext.\n+\t(mips_shilo, mips_mthlip): Set type to accmod.\n+\t* config/mips/mips-dspr2.md (mips_absq_s_qb, mips_addu_s_ph)\n+\t(mips_adduh_r_qb): Set type to dspalusat.\n+\t(mips_addu_ph, mips_adduh_qb, mips_append, mips_balign)\n+\t(mips_cmpgdu_eq_qb, mips_cmpgdu_lt_qb, mips_cmpgdu_le_qb)\n+\t(mips_precr_qb_ph, mips_precr_sra_ph_w, mips_precr_sra_r_ph_w)\n+\t(mips_prepend, mips_shra_qb, mips_shra_r_qb, mips_shrl_ph)\n+\t(mips_subu_ph, mips_subuh_qb, mips_subuh_r_qb, mips_addqh_ph)\n+\t(mips_addqh_r_ph, mips_addqh_w, mips_addqh_r_w, mips_subqh_ph)\n+\t(mips_subqh_r_ph, mips_subqh_w, mips_subqh_r_w): Set type to dspalu.\n+\t(mips_dpa_w_ph, mips_dps_w_ph, mips_mulsa_w_ph, mips_dpax_w_ph)\n+\t(mips_dpsx_w_ph, mips_dpaqx_s_w_ph, mips_dpsqx_s_w_ph): Set type to\n+\tdspmac.  Set accum_in attribute.\n+\t(mips_subu_s_ph): Set type to dspalusat. \n+\t(mips_dpaqx_sa_w_ph, mips_dpsqx_sa_w_ph): Set type to dspmacsat.\n+\tSet accum_in attribute.\n+\t* config/mips/mips-protos.h (mips_dspalu_bypass_p): Add prototype.\n+\t* config/mips/mips.c (dspalu_bypass_table): New.\n+\t(mips_dspalu_bypass_p): New.\n+\t* config/mips/24k.md (r24k_dsp_alu, r24k_dsp_mac, r24k_dsp_mac_sat)\n+\t(r24k_dsp_acc_ext, r24k_dsp_acc_mod): New insn reservations.\n+\t(r24k_int_mult, r24k_int_mthilo, r24k_dsp_mac, r24k_dsp_mac_sat)\n+\t(r24k_dsp_acc_ext, r24k_dsp_acc_mod, r24k_dsp_alu): New bypasses.\n+\t* config/mips/74k.md (r74k_dsp_alu, r74k_dsp_alu_sat, r74k_dsp_mac)\n+\t(r74k_dsp_mac_sat, r74k_dsp_acc_ext, r74k_dsp_acc_mod): New insn\n+\treservations.\n+\t(r74k_dsp_mac, r74k_dsp_mac_sat, r74k_int_mult, r74k_int_mul3)\n+\t(r74k_dsp_mac, r74k_dsp_mac_sat): New bypasses.\n+\n 2012-08-15  Ulrich Weigand  <Ulrich.Weigand@de.ibm.com>\n \n \t* config/spu/spu.c: Include \"cfgloop.h\"."}, {"sha": "3860d1eef0dc7b06dfc59f15524c3b48acb4763e", "filename": "gcc/config/mips/24k.md", "status": "modified", "additions": 95, "deletions": 0, "changes": 95, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/ef2e5300177d18089c1c30bec6abff0700ecc44c/gcc%2Fconfig%2Fmips%2F24k.md", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/ef2e5300177d18089c1c30bec6abff0700ecc44c/gcc%2Fconfig%2Fmips%2F24k.md", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fconfig%2Fmips%2F24k.md?ref=ef2e5300177d18089c1c30bec6abff0700ecc44c", "patch": "@@ -203,6 +203,101 @@\n (define_bypass 2 \"r24k_int_multi\" \"r24k_int_prefetch\")\n \n \n+;; --------------------------------------------------------------\n+;; DSP instructions\n+;; --------------------------------------------------------------\n+\n+;; absq, addq, addsc, addu, addwc, bitrev, cmp, cmpgu, cmpu, insv, modsub,\n+;; packrl, pick, preceq, preceu, precequ, precrq, precrqu, raddu, rddsp, repl,\n+;; replv, shll, shllv, shra, shrav, shrl, shrlv, subq, subu, wrdsp\n+(define_insn_reservation \"r24k_dsp_alu\" 2\n+  (and (eq_attr \"cpu\" \"24kc,24kf2_1,24kf1_1\")\n+       (eq_attr \"type\" \"dspalu,dspalusat\"))\n+  \"r24k_iss+r24k_ixu_arith\")\n+\n+;; dpaq_s, dpau, dpsq_s, dpsu, maq_s, mulsaq\n+(define_insn_reservation \"r24k_dsp_mac\" 1\n+  (and (eq_attr \"cpu\" \"24kc,24kf2_1,24kf1_1\")\n+       (eq_attr \"type\" \"dspmac\"))\n+  \"r24k_iss+(r24k_mul3a|r24k_mul3b|r24k_mul3c)\")\n+\n+;; dpaq_sa, dpsq_sa, maq_sa\n+(define_insn_reservation \"r24k_dsp_mac_sat\" 1\n+  (and (eq_attr \"cpu\" \"24kc,24kf2_1,24kf1_1\")\n+       (eq_attr \"type\" \"dspmacsat\"))\n+  \"r24k_iss+(r24k_mul3a|r24k_mul3b|r24k_mul3c)\")\n+\n+;; extp, extpdp, extpdpv, extpv, extr, extrv\n+(define_insn_reservation \"r24k_dsp_acc_ext\" 5\n+  (and (eq_attr \"cpu\" \"24kc,24kf2_1,24kf1_1\")\n+       (eq_attr \"type\" \"accext\"))\n+  \"r24k_iss+(r24k_mul3a|r24k_mul3b|r24k_mul3c)\")\n+\n+;; mthlip, shilo, shilov\n+(define_insn_reservation \"r24k_dsp_acc_mod\" 1\n+  (and (eq_attr \"cpu\" \"24kc,24kf2_1,24kf1_1\")\n+       (eq_attr \"type\" \"accmod\"))\n+  \"r24k_iss+(r24k_mul3a|r24k_mul3b|r24k_mul3c)\")\n+\n+\n+;; mult/madd->dsp_acc_ext : 4 cycles\n+;; mult/madd->dsp_acc_mod : 4 cycles\n+(define_bypass 4 \"r24k_int_mult\" \"r24k_dsp_acc_ext\")\n+(define_bypass 4 \"r24k_int_mult\" \"r24k_dsp_acc_mod\")\n+\n+;; mthilo->dsp_acc_ext : 4 cycles\n+;; mthilo->dsp_acc_ext : 4 cycles\n+(define_bypass 4 \"r24k_int_mthilo\" \"r24k_dsp_acc_ext\")\n+(define_bypass 4 \"r24k_int_mthilo\" \"r24k_dsp_acc_mod\")\n+\n+;; dsp_mac->next use    : 1 cycles (default)\n+;; dsp_mac->dsp_acc_ext : 4 cycles\n+;; dsp_mac->dsp_acc_mod : 4 cycles\n+(define_bypass 4 \"r24k_dsp_mac\" \"r24k_dsp_acc_ext\")\n+(define_bypass 4 \"r24k_dsp_mac\" \"r24k_dsp_acc_mod\")\n+\n+;; dsp_mac_sat->next use    : 1 cycles (default)\n+;; dsp_mac_sat->mult/madd   : 2 cycles\n+;; dsp_mac_sat->dsp_mac     : 2 cycles\n+;; dsp_mac_sat->dsp_mac_sat : 2 cycles\n+;; dsp_mac_sat->dsp_acc_ext : 4 cycles\n+;; dsp_mac_sat->dsp_acc_mod : 4 cycles\n+(define_bypass 2 \"r24k_dsp_mac_sat\" \"r24k_int_mult\")\n+(define_bypass 2 \"r24k_dsp_mac_sat\" \"r24k_dsp_mac\")\n+(define_bypass 2 \"r24k_dsp_mac_sat\" \"r24k_dsp_mac_sat\")\n+(define_bypass 4 \"r24k_dsp_mac_sat\" \"r24k_dsp_acc_ext\")\n+(define_bypass 4 \"r24k_dsp_mac_sat\" \"r24k_dsp_acc_mod\")\n+\n+;; dsp_acc_ext->next use : 5 cycles (default)\n+;; dsp_acc_ext->l/s base : 6 cycles\n+;; dsp_acc_ext->prefetch : 6 cycles\n+(define_bypass 6 \"r24k_dsp_acc_ext\" \"r24k_int_load\")\n+(define_bypass 6 \"r24k_dsp_acc_ext\" \"r24k_int_store\"\n+  \"!mips_store_data_bypass_p\")\n+(define_bypass 6 \"r24k_dsp_acc_ext\" \"r24k_int_prefetch\")\n+\n+;; dsp_acc_mod->next use    : 1 cycles (default)\n+;; dsp_acc_mod->mult/madd   : 2 cycles\n+;; dsp_acc_mod->dsp_mac     : 2 cycles\n+;; dsp_acc_mod->dsp_mac_sat : 2 cycles\n+;; dsp_acc_mod->dsp_acc_ext : 4 cycles\n+;; dsp_acc_mod->dsp_acc_mod : 4 cycles\n+(define_bypass 2 \"r24k_dsp_acc_mod\" \"r24k_int_mult\")\n+(define_bypass 2 \"r24k_dsp_acc_mod\" \"r24k_dsp_mac\")\n+(define_bypass 2 \"r24k_dsp_acc_mod\" \"r24k_dsp_mac_sat\")\n+(define_bypass 4 \"r24k_dsp_acc_mod\" \"r24k_dsp_acc_ext\")\n+(define_bypass 4 \"r24k_dsp_acc_mod\" \"r24k_dsp_acc_mod\")\n+\n+;; dspalu->next use : 2 cycles (default)\n+;; dspalu->l/s base : 3 cycles\n+;; dspalu->prefetch : 3 cycles\n+;; some pairs of dspalu (addsc/addwc, cmp/pick, wrdsp/insv) : 1 cycle\n+(define_bypass 3 \"r24k_dsp_alu\" \"r24k_int_load\")\n+(define_bypass 3 \"r24k_dsp_alu\" \"r24k_int_store\" \"!mips_store_data_bypass_p\")\n+(define_bypass 3 \"r24k_dsp_alu\" \"r24k_int_prefetch\")\n+(define_bypass 1 \"r24k_dsp_alu\" \"r24k_dsp_alu\" \"mips_dspalu_bypass_p\")\n+\n+\n ;; --------------------------------------------------------------\n ;; Floating Point Instructions\n ;; --------------------------------------------------------------"}, {"sha": "721834c7d9ef012d84d28d00d4af9e8657b3c839", "filename": "gcc/config/mips/74k.md", "status": "modified", "additions": 82, "deletions": 0, "changes": 82, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/ef2e5300177d18089c1c30bec6abff0700ecc44c/gcc%2Fconfig%2Fmips%2F74k.md", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/ef2e5300177d18089c1c30bec6abff0700ecc44c/gcc%2Fconfig%2Fmips%2F74k.md", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fconfig%2Fmips%2F74k.md?ref=ef2e5300177d18089c1c30bec6abff0700ecc44c", "patch": "@@ -174,6 +174,88 @@\n (define_bypass 1 \"r74k_int_madd\" \"r74k_int_madd\"\n   \"mips_linked_madd_p\")\n \n+\n+;; --------------------------------------------------------------\n+;; DSP instructions\n+;; --------------------------------------------------------------\n+\n+;; Non-saturating insn have the same latency as normal ALU operations,\n+(define_insn_reservation \"r74k_dsp_alu\" 2\n+  (and (eq_attr \"cpu\" \"74kc,74kf2_1,74kf1_1,74kf3_2\")\n+       (eq_attr \"type\" \"dspalu\"))\n+  \"r74k_alu\")\n+\n+;; Saturating insn takes an extra cycle.\n+(define_insn_reservation \"r74k_dsp_alu_sat\" 3\n+  (and (eq_attr \"cpu\" \"74kc,74kf2_1,74kf1_1,74kf3_2\")\n+       (eq_attr \"type\" \"dspalusat\"))\n+  \"r74k_alu\")\n+\n+;; dpaq_s, dpau, dpsq_s, dpsu, maq_s, mulsaq\n+;; - delivers result to hi/lo in 6 cycle (bypass at M4)\n+(define_insn_reservation \"r74k_dsp_mac\" 6\n+  (and (eq_attr \"cpu\" \"74kc,74kf2_1,74kf1_1,74kf3_2\")\n+       (eq_attr \"type\" \"dspmac\"))\n+  \"r74k_alu+r74k_mul\")\n+\n+;; dpaq_sa, dpsq_sa, maq_sa\n+;; - delivers result to hi/lo in 7 cycle (bypass at WB)\n+(define_insn_reservation \"r74k_dsp_mac_sat\" 7\n+  (and (eq_attr \"cpu\" \"74kc,74kf2_1,74kf1_1,74kf3_2\")\n+       (eq_attr \"type\" \"dspmacsat\"))\n+  \"r74k_alu+r74k_mul\")\n+\n+;; extp, extpdp, extpdpv, extpv, extr, extrv\n+;; - same latency as \"mul\"\n+(define_insn_reservation \"r74k_dsp_acc_ext\" 7\n+  (and (eq_attr \"cpu\" \"74kc,74kf2_1,74kf1_1,74kf3_2\")\n+       (eq_attr \"type\" \"accext\"))\n+  \"r74k_alu+r74k_mul\")\n+\n+;; mthlip, shilo, shilov\n+;; - same latency as \"mul\"\n+(define_insn_reservation \"r74k_dsp_acc_mod\" 7\n+  (and (eq_attr \"cpu\" \"74kc,74kf2_1,74kf1_1,74kf3_2\")\n+       (eq_attr \"type\" \"accmod\"))\n+  \"r74k_alu+r74k_mul\")\n+\n+;; dspalu   ->load/store base\n+;; dspalusat->load/store base\n+;; - we should never see these in real life.\n+\n+;; dsp_mac->dsp_mac     : 1 cycles (repeat rate of 1)\n+;; dsp_mac->dsp_mac_sat : 1 cycles (repeat rate of 1)\n+(define_bypass 1 \"r74k_dsp_mac\" \"r74k_dsp_mac\")\n+(define_bypass 1 \"r74k_dsp_mac\" \"r74k_dsp_mac_sat\")\n+\n+;; dsp_mac_sat->dsp_mac_sat : 2 cycles (repeat rate of 2)\n+;; dsp_mac_sat->dsp_mac     : 2 cycles (repeat rate of 2)\n+(define_bypass 2 \"r74k_dsp_mac_sat\" \"r74k_dsp_mac_sat\")\n+(define_bypass 2 \"r74k_dsp_mac_sat\" \"r74k_dsp_mac\")\n+\n+(define_bypass 1 \"r74k_int_mult\" \"r74k_dsp_mac\")\n+(define_bypass 1 \"r74k_int_mult\" \"r74k_dsp_mac_sat\")\n+\n+(define_bypass 1 \"r74k_int_mul3\" \"r74k_dsp_mac\" \"mips_linked_madd_p\")\n+(define_bypass 1 \"r74k_int_mul3\" \"r74k_dsp_mac_sat\" \"mips_linked_madd_p\")\n+\n+;; Assuming the following is true (bypass at M4)\n+;;  AP AF AM MB M1 M2 M3 M4 WB GR GC\n+;;              AP AF AM MB M1 M2 M3 M4 WB GR GC\n+;; dsp_mac->dsp_acc_ext : 4 cycles\n+;; dsp_mac->dsp_acc_mod : 4 cycles\n+(define_bypass 4 \"r74k_dsp_mac\" \"r74k_dsp_acc_ext\")\n+(define_bypass 4 \"r74k_dsp_mac\" \"r74k_dsp_acc_mod\")\n+\n+;; Assuming the following is true (bypass at WB)\n+;;  AP AF AM MB M1 M2 M3 M4 WB GR GC\n+;;                 AP AF AM MB M1 M2 M3 M4 WB GR GC\n+;; dsp_mac_sat->dsp_acc_ext : 5 cycles\n+;; dsp_mac_sat->dsp_acc_mod : 5 cycles\n+(define_bypass 5 \"r74k_dsp_mac_sat\" \"r74k_dsp_acc_ext\")\n+(define_bypass 5 \"r74k_dsp_mac_sat\" \"r74k_dsp_acc_mod\")\n+\n+\n ;; --------------------------------------------------------------\n ;; Floating Point Instructions\n ;; --------------------------------------------------------------"}, {"sha": "3c23448177f1dd6c5851d8a13f7975104856a065", "filename": "gcc/config/mips/mips-dsp.md", "status": "modified", "additions": 63, "deletions": 63, "changes": 126, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/ef2e5300177d18089c1c30bec6abff0700ecc44c/gcc%2Fconfig%2Fmips%2Fmips-dsp.md", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/ef2e5300177d18089c1c30bec6abff0700ecc44c/gcc%2Fconfig%2Fmips%2Fmips-dsp.md", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fconfig%2Fmips%2Fmips-dsp.md?ref=ef2e5300177d18089c1c30bec6abff0700ecc44c", "patch": "@@ -135,7 +135,7 @@\n \t  (unspec:CCDSP [(match_dup 1) (match_dup 2)] UNSPEC_ADDQ))])]\n   \"ISA_HAS_DSP\"\n   \"add<DSPV:dspfmt1>.<DSPV:dspfmt2>\\t%0,%1,%2\"\n-  [(set_attr \"type\"\t\"arith\")\n+  [(set_attr \"type\"\t\"dspalu\")\n    (set_attr \"mode\"\t\"SI\")])\n \n (define_insn \"mips_add<DSP:dspfmt1>_s_<DSP:dspfmt2>\"\n@@ -148,7 +148,7 @@\n \t  (unspec:CCDSP [(match_dup 1) (match_dup 2)] UNSPEC_ADDQ_S))])]\n   \"ISA_HAS_DSP\"\n   \"add<DSP:dspfmt1>_s.<DSP:dspfmt2>\\t%0,%1,%2\"\n-  [(set_attr \"type\"\t\"arith\")\n+  [(set_attr \"type\"\t\"dspalusat\")\n    (set_attr \"mode\"\t\"SI\")])\n \n ;; SUBQ*\n@@ -161,7 +161,7 @@\n \t  (unspec:CCDSP [(match_dup 1) (match_dup 2)] UNSPEC_SUBQ))])]\n   \"ISA_HAS_DSP\"\n   \"sub<DSPV:dspfmt1>.<DSPV:dspfmt2>\\t%0,%1,%2\"\n-  [(set_attr \"type\"\t\"arith\")\n+  [(set_attr \"type\"\t\"dspalu\")\n    (set_attr \"mode\"\t\"SI\")])\n \n (define_insn \"mips_sub<DSP:dspfmt1>_s_<DSP:dspfmt2>\"\n@@ -174,7 +174,7 @@\n \t  (unspec:CCDSP [(match_dup 1) (match_dup 2)] UNSPEC_SUBQ_S))])]\n   \"ISA_HAS_DSP\"\n   \"sub<DSP:dspfmt1>_s.<DSP:dspfmt2>\\t%0,%1,%2\"\n-  [(set_attr \"type\"\t\"arith\")\n+  [(set_attr \"type\"\t\"dspalusat\")\n    (set_attr \"mode\"\t\"SI\")])\n \n ;; ADDSC\n@@ -188,7 +188,7 @@\n \t  (unspec:CCDSP [(match_dup 1) (match_dup 2)] UNSPEC_ADDSC))])]\n   \"ISA_HAS_DSP\"\n   \"addsc\\t%0,%1,%2\"\n-  [(set_attr \"type\"\t\"arith\")\n+  [(set_attr \"type\"\t\"dspalu\")\n    (set_attr \"mode\"\t\"SI\")])\n \n ;; ADDWC\n@@ -203,7 +203,7 @@\n \t  (unspec:CCDSP [(match_dup 1) (match_dup 2)] UNSPEC_ADDWC))])]\n   \"ISA_HAS_DSP\"\n   \"addwc\\t%0,%1,%2\"\n-  [(set_attr \"type\"\t\"arith\")\n+  [(set_attr \"type\"\t\"dspalu\")\n    (set_attr \"mode\"\t\"SI\")])\n \n ;; MODSUB\n@@ -214,7 +214,7 @@\n \t\t   UNSPEC_MODSUB))]\n   \"ISA_HAS_DSP\"\n   \"modsub\\t%0,%1,%2\"\n-  [(set_attr \"type\"\t\"arith\")\n+  [(set_attr \"type\"\t\"dspalu\")\n    (set_attr \"mode\"\t\"SI\")])\n \n ;; RADDU*\n@@ -224,7 +224,7 @@\n \t\t   UNSPEC_RADDU_W_QB))]\n   \"ISA_HAS_DSP\"\n   \"raddu.w.qb\\t%0,%1\"\n-  [(set_attr \"type\"\t\"arith\")\n+  [(set_attr \"type\"\t\"dspalu\")\n    (set_attr \"mode\"\t\"SI\")])\n \n ;; ABSQ*\n@@ -237,7 +237,7 @@\n \t  (unspec:CCDSP [(match_dup 1)] UNSPEC_ABSQ_S))])]\n   \"ISA_HAS_DSP\"\n   \"absq_s.<DSPQ:dspfmt2>\\t%0,%1\"\n-  [(set_attr \"type\"\t\"arith\")\n+  [(set_attr \"type\"\t\"dspalusat\")\n    (set_attr \"mode\"\t\"SI\")])\n \n ;; PRECRQ*\n@@ -248,7 +248,7 @@\n \t\t     UNSPEC_PRECRQ_QB_PH))]\n   \"ISA_HAS_DSP\"\n   \"precrq.qb.ph\\t%0,%1,%2\"\n-  [(set_attr \"type\"\t\"arith\")\n+  [(set_attr \"type\"\t\"dspalu\")\n    (set_attr \"mode\"\t\"SI\")])\n \n (define_insn \"mips_precrq_ph_w\"\n@@ -258,7 +258,7 @@\n \t\t     UNSPEC_PRECRQ_PH_W))]\n   \"ISA_HAS_DSP\"\n   \"precrq.ph.w\\t%0,%1,%2\"\n-  [(set_attr \"type\"\t\"arith\")\n+  [(set_attr \"type\"\t\"dspalu\")\n    (set_attr \"mode\"\t\"SI\")])\n \n (define_insn \"mips_precrq_rs_ph_w\"\n@@ -272,7 +272,7 @@\n \t\t\tUNSPEC_PRECRQ_RS_PH_W))])]\n   \"ISA_HAS_DSP\"\n   \"precrq_rs.ph.w\\t%0,%1,%2\"\n-  [(set_attr \"type\"\t\"arith\")\n+  [(set_attr \"type\"\t\"dspalu\")\n    (set_attr \"mode\"\t\"SI\")])\n \n ;; PRECRQU*\n@@ -287,7 +287,7 @@\n \t\t\tUNSPEC_PRECRQU_S_QB_PH))])]\n   \"ISA_HAS_DSP\"\n   \"precrqu_s.qb.ph\\t%0,%1,%2\"\n-  [(set_attr \"type\"\t\"arith\")\n+  [(set_attr \"type\"\t\"dspalusat\")\n    (set_attr \"mode\"\t\"SI\")])\n \n ;; PRECEQ*\n@@ -297,7 +297,7 @@\n \t\t   UNSPEC_PRECEQ_W_PHL))]\n   \"ISA_HAS_DSP\"\n   \"preceq.w.phl\\t%0,%1\"\n-  [(set_attr \"type\"\t\"arith\")\n+  [(set_attr \"type\"\t\"dspalu\")\n    (set_attr \"mode\"\t\"SI\")])\n \n (define_insn \"mips_preceq_w_phr\"\n@@ -306,7 +306,7 @@\n \t\t   UNSPEC_PRECEQ_W_PHR))]\n   \"ISA_HAS_DSP\"\n   \"preceq.w.phr\\t%0,%1\"\n-  [(set_attr \"type\"\t\"arith\")\n+  [(set_attr \"type\"\t\"dspalu\")\n    (set_attr \"mode\"\t\"SI\")])\n \n ;; PRECEQU*\n@@ -316,7 +316,7 @@\n \t\t     UNSPEC_PRECEQU_PH_QBL))]\n   \"ISA_HAS_DSP\"\n   \"precequ.ph.qbl\\t%0,%1\"\n-  [(set_attr \"type\"\t\"arith\")\n+  [(set_attr \"type\"\t\"dspalu\")\n    (set_attr \"mode\"\t\"SI\")])\n \n (define_insn \"mips_precequ_ph_qbr\"\n@@ -325,7 +325,7 @@\n \t\t     UNSPEC_PRECEQU_PH_QBR))]\n   \"ISA_HAS_DSP\"\n   \"precequ.ph.qbr\\t%0,%1\"\n-  [(set_attr \"type\"\t\"arith\")\n+  [(set_attr \"type\"\t\"dspalu\")\n    (set_attr \"mode\"\t\"SI\")])\n \n (define_insn \"mips_precequ_ph_qbla\"\n@@ -334,7 +334,7 @@\n \t\t     UNSPEC_PRECEQU_PH_QBLA))]\n   \"ISA_HAS_DSP\"\n   \"precequ.ph.qbla\\t%0,%1\"\n-  [(set_attr \"type\"\t\"arith\")\n+  [(set_attr \"type\"\t\"dspalu\")\n    (set_attr \"mode\"\t\"SI\")])\n \n (define_insn \"mips_precequ_ph_qbra\"\n@@ -343,7 +343,7 @@\n \t\t     UNSPEC_PRECEQU_PH_QBRA))]\n   \"ISA_HAS_DSP\"\n   \"precequ.ph.qbra\\t%0,%1\"\n-  [(set_attr \"type\"\t\"arith\")\n+  [(set_attr \"type\"\t\"dspalu\")\n    (set_attr \"mode\"\t\"SI\")])\n \n ;; PRECEU*\n@@ -353,7 +353,7 @@\n \t\t     UNSPEC_PRECEU_PH_QBL))]\n   \"ISA_HAS_DSP\"\n   \"preceu.ph.qbl\\t%0,%1\"\n-  [(set_attr \"type\"\t\"arith\")\n+  [(set_attr \"type\"\t\"dspalu\")\n    (set_attr \"mode\"\t\"SI\")])\n \n (define_insn \"mips_preceu_ph_qbr\"\n@@ -362,7 +362,7 @@\n \t\t     UNSPEC_PRECEU_PH_QBR))]\n   \"ISA_HAS_DSP\"\n   \"preceu.ph.qbr\\t%0,%1\"\n-  [(set_attr \"type\"\t\"arith\")\n+  [(set_attr \"type\"\t\"dspalu\")\n    (set_attr \"mode\"\t\"SI\")])\n \n (define_insn \"mips_preceu_ph_qbla\"\n@@ -371,7 +371,7 @@\n \t\t     UNSPEC_PRECEU_PH_QBLA))]\n   \"ISA_HAS_DSP\"\n   \"preceu.ph.qbla\\t%0,%1\"\n-  [(set_attr \"type\"\t\"arith\")\n+  [(set_attr \"type\"\t\"dspalu\")\n    (set_attr \"mode\"\t\"SI\")])\n \n (define_insn \"mips_preceu_ph_qbra\"\n@@ -380,7 +380,7 @@\n \t\t     UNSPEC_PRECEU_PH_QBRA))]\n   \"ISA_HAS_DSP\"\n   \"preceu.ph.qbra\\t%0,%1\"\n-  [(set_attr \"type\"\t\"arith\")\n+  [(set_attr \"type\"\t\"dspalu\")\n    (set_attr \"mode\"\t\"SI\")])\n \n ;; Table 2-2. MIPS DSP ASE Instructions: Shift\n@@ -404,7 +404,7 @@\n     }\n   return \"shllv.<DSPV:dspfmt2>\\t%0,%1,%2\";\n }\n-  [(set_attr \"type\"\t\"shift\")\n+  [(set_attr \"type\"\t\"dspalu\")\n    (set_attr \"mode\"\t\"SI\")])\n \n (define_insn \"mips_shll_s_<DSPQ:dspfmt2>\"\n@@ -426,7 +426,7 @@\n     }\n   return \"shllv_s.<DSPQ:dspfmt2>\\t%0,%1,%2\";\n }\n-  [(set_attr \"type\"\t\"shift\")\n+  [(set_attr \"type\"\t\"dspalusat\")\n    (set_attr \"mode\"\t\"SI\")])\n \n ;; SHRL*\n@@ -445,7 +445,7 @@\n     }\n   return \"shrlv.qb\\t%0,%1,%2\";\n }\n-  [(set_attr \"type\"\t\"shift\")\n+  [(set_attr \"type\"\t\"dspalu\")\n    (set_attr \"mode\"\t\"SI\")])\n \n ;; SHRA*\n@@ -464,7 +464,7 @@\n     }\n   return \"shrav.ph\\t%0,%1,%2\";\n }\n-  [(set_attr \"type\"\t\"shift\")\n+  [(set_attr \"type\"\t\"dspalu\")\n    (set_attr \"mode\"\t\"SI\")])\n \n (define_insn \"mips_shra_r_<DSPQ:dspfmt2>\"\n@@ -483,7 +483,7 @@\n     }\n   return \"shrav_r.<DSPQ:dspfmt2>\\t%0,%1,%2\";\n }\n-  [(set_attr \"type\"\t\"shift\")\n+  [(set_attr \"type\"\t\"dspalu\")\n    (set_attr \"mode\"\t\"SI\")])\n \n ;; Table 2-3. MIPS DSP ASE Instructions: Multiply\n@@ -569,7 +569,7 @@\n \t\t   UNSPEC_DPAU_H_QBL))]\n   \"ISA_HAS_DSP && !TARGET_64BIT\"\n   \"dpau.h.qbl\\t%q0,%2,%3\"\n-  [(set_attr \"type\"\t\"imadd\")\n+  [(set_attr \"type\"\t\"dspmac\")\n    (set_attr \"mode\"\t\"SI\")])\n \n (define_insn \"mips_dpau_h_qbr\"\n@@ -580,7 +580,7 @@\n \t\t   UNSPEC_DPAU_H_QBR))]\n   \"ISA_HAS_DSP && !TARGET_64BIT\"\n   \"dpau.h.qbr\\t%q0,%2,%3\"\n-  [(set_attr \"type\"\t\"imadd\")\n+  [(set_attr \"type\"\t\"dspmac\")\n    (set_attr \"mode\"\t\"SI\")])\n \n ;; DPSU*\n@@ -592,7 +592,7 @@\n \t\t   UNSPEC_DPSU_H_QBL))]\n   \"ISA_HAS_DSP && !TARGET_64BIT\"\n   \"dpsu.h.qbl\\t%q0,%2,%3\"\n-  [(set_attr \"type\"\t\"imadd\")\n+  [(set_attr \"type\"\t\"dspmac\")\n    (set_attr \"mode\"\t\"SI\")])\n \n (define_insn \"mips_dpsu_h_qbr\"\n@@ -603,7 +603,7 @@\n \t\t   UNSPEC_DPSU_H_QBR))]\n   \"ISA_HAS_DSP && !TARGET_64BIT\"\n   \"dpsu.h.qbr\\t%q0,%2,%3\"\n-  [(set_attr \"type\"\t\"imadd\")\n+  [(set_attr \"type\"\t\"dspmac\")\n    (set_attr \"mode\"\t\"SI\")])\n \n ;; DPAQ*\n@@ -619,7 +619,7 @@\n \t\t\tUNSPEC_DPAQ_S_W_PH))])]\n   \"ISA_HAS_DSP && !TARGET_64BIT\"\n   \"dpaq_s.w.ph\\t%q0,%2,%3\"\n-  [(set_attr \"type\"\t\"imadd\")\n+  [(set_attr \"type\"\t\"dspmac\")\n    (set_attr \"mode\"\t\"SI\")])\n \n ;; DPSQ*\n@@ -635,7 +635,7 @@\n \t\t\tUNSPEC_DPSQ_S_W_PH))])]\n   \"ISA_HAS_DSP && !TARGET_64BIT\"\n   \"dpsq_s.w.ph\\t%q0,%2,%3\"\n-  [(set_attr \"type\"\t\"imadd\")\n+  [(set_attr \"type\"\t\"dspmac\")\n    (set_attr \"mode\"\t\"SI\")])\n \n ;; MULSAQ*\n@@ -651,7 +651,7 @@\n \t\t\tUNSPEC_MULSAQ_S_W_PH))])]\n   \"ISA_HAS_DSP && !TARGET_64BIT\"\n   \"mulsaq_s.w.ph\\t%q0,%2,%3\"\n-  [(set_attr \"type\"\t\"imadd\")\n+  [(set_attr \"type\"\t\"dspmac\")\n    (set_attr \"mode\"\t\"SI\")])\n \n ;; DPAQ*\n@@ -667,7 +667,7 @@\n \t\t\tUNSPEC_DPAQ_SA_L_W))])]\n   \"ISA_HAS_DSP && !TARGET_64BIT\"\n   \"dpaq_sa.l.w\\t%q0,%2,%3\"\n-  [(set_attr \"type\"\t\"imadd\")\n+  [(set_attr \"type\"\t\"dspmacsat\")\n    (set_attr \"mode\"\t\"SI\")])\n \n ;; DPSQ*\n@@ -683,7 +683,7 @@\n \t\t\tUNSPEC_DPSQ_SA_L_W))])]\n   \"ISA_HAS_DSP && !TARGET_64BIT\"\n   \"dpsq_sa.l.w\\t%q0,%2,%3\"\n-  [(set_attr \"type\"\t\"imadd\")\n+  [(set_attr \"type\"\t\"dspmacsat\")\n    (set_attr \"mode\"\t\"SI\")])\n \n ;; MAQ*\n@@ -699,7 +699,7 @@\n \t\t\tUNSPEC_MAQ_S_W_PHL))])]\n   \"ISA_HAS_DSP && !TARGET_64BIT\"\n   \"maq_s.w.phl\\t%q0,%2,%3\"\n-  [(set_attr \"type\"\t\"imadd\")\n+  [(set_attr \"type\"\t\"dspmac\")\n    (set_attr \"mode\"\t\"SI\")])\n \n (define_insn \"mips_maq_s_w_phr\"\n@@ -714,7 +714,7 @@\n \t\t\tUNSPEC_MAQ_S_W_PHR))])]\n   \"ISA_HAS_DSP && !TARGET_64BIT\"\n   \"maq_s.w.phr\\t%q0,%2,%3\"\n-  [(set_attr \"type\"\t\"imadd\")\n+  [(set_attr \"type\"\t\"dspmac\")\n    (set_attr \"mode\"\t\"SI\")])\n \n ;; MAQ_SA*\n@@ -730,7 +730,7 @@\n \t\t\tUNSPEC_MAQ_SA_W_PHL))])]\n   \"ISA_HAS_DSP && !TARGET_64BIT\"\n   \"maq_sa.w.phl\\t%q0,%2,%3\"\n-  [(set_attr \"type\"\t\"imadd\")\n+  [(set_attr \"type\"\t\"dspmacsat\")\n    (set_attr \"mode\"\t\"SI\")])\n \n (define_insn \"mips_maq_sa_w_phr\"\n@@ -745,7 +745,7 @@\n \t\t\tUNSPEC_MAQ_SA_W_PHR))])]\n   \"ISA_HAS_DSP && !TARGET_64BIT\"\n   \"maq_sa.w.phr\\t%q0,%2,%3\"\n-  [(set_attr \"type\"\t\"imadd\")\n+  [(set_attr \"type\"\t\"dspmacsat\")\n    (set_attr \"mode\"\t\"SI\")])\n \n ;; Table 2-4. MIPS DSP ASE Instructions: General Bit/Manipulation\n@@ -756,7 +756,7 @@\n \t\t   UNSPEC_BITREV))]\n   \"ISA_HAS_DSP\"\n   \"bitrev\\t%0,%1\"\n-  [(set_attr \"type\"\t\"arith\")\n+  [(set_attr \"type\"\t\"dspalu\")\n    (set_attr \"mode\"\t\"SI\")])\n \n ;; INSV\n@@ -769,7 +769,7 @@\n \t\t   UNSPEC_INSV))]\n   \"ISA_HAS_DSP\"\n   \"insv\\t%0,%2\"\n-  [(set_attr \"type\"\t\"arith\")\n+  [(set_attr \"type\"\t\"dspalu\")\n    (set_attr \"mode\"\t\"SI\")])\n \n ;; REPL*\n@@ -787,7 +787,7 @@\n     }\n   return \"replv.qb\\t%0,%1\";\n }\n-  [(set_attr \"type\"\t\"arith\")\n+  [(set_attr \"type\"\t\"dspalu\")\n    (set_attr \"mode\"\t\"SI\")])\n \n (define_insn \"mips_repl_ph\"\n@@ -798,7 +798,7 @@\n   \"@\n    repl.ph\\t%0,%1\n    replv.ph\\t%0,%1\"\n-  [(set_attr \"type\"\t\"arith\")\n+  [(set_attr \"type\"\t\"dspalu\")\n    (set_attr \"mode\"\t\"SI\")])\n \n ;; Table 2-5. MIPS DSP ASE Instructions: Compare-Pick\n@@ -811,7 +811,7 @@\n \t\t      UNSPEC_CMP_EQ))]\n   \"ISA_HAS_DSP\"\n   \"cmp<DSPV:dspfmt1_1>.eq.<DSPV:dspfmt2>\\t%0,%1\"\n-  [(set_attr \"type\"\t\"arith\")\n+  [(set_attr \"type\"\t\"dspalu\")\n    (set_attr \"mode\"\t\"SI\")])\n \n (define_insn \"mips_cmp<DSPV:dspfmt1_1>_lt_<DSPV:dspfmt2>\"\n@@ -822,7 +822,7 @@\n \t\t      UNSPEC_CMP_LT))]\n   \"ISA_HAS_DSP\"\n   \"cmp<DSPV:dspfmt1_1>.lt.<DSPV:dspfmt2>\\t%0,%1\"\n-  [(set_attr \"type\"\t\"arith\")\n+  [(set_attr \"type\"\t\"dspalu\")\n    (set_attr \"mode\"\t\"SI\")])\n \n (define_insn \"mips_cmp<DSPV:dspfmt1_1>_le_<DSPV:dspfmt2>\"\n@@ -833,7 +833,7 @@\n \t\t      UNSPEC_CMP_LE))]\n   \"ISA_HAS_DSP\"\n   \"cmp<DSPV:dspfmt1_1>.le.<DSPV:dspfmt2>\\t%0,%1\"\n-  [(set_attr \"type\"\t\"arith\")\n+  [(set_attr \"type\"\t\"dspalu\")\n    (set_attr \"mode\"\t\"SI\")])\n \n (define_insn \"mips_cmpgu_eq_qb\"\n@@ -843,7 +843,7 @@\n \t\t   UNSPEC_CMPGU_EQ_QB))]\n   \"ISA_HAS_DSP\"\n   \"cmpgu.eq.qb\\t%0,%1,%2\"\n-  [(set_attr \"type\"\t\"arith\")\n+  [(set_attr \"type\"\t\"dspalu\")\n    (set_attr \"mode\"\t\"SI\")])\n \n (define_insn \"mips_cmpgu_lt_qb\"\n@@ -853,7 +853,7 @@\n \t\t   UNSPEC_CMPGU_LT_QB))]\n   \"ISA_HAS_DSP\"\n   \"cmpgu.lt.qb\\t%0,%1,%2\"\n-  [(set_attr \"type\"\t\"arith\")\n+  [(set_attr \"type\"\t\"dspalu\")\n    (set_attr \"mode\"\t\"SI\")])\n \n (define_insn \"mips_cmpgu_le_qb\"\n@@ -863,7 +863,7 @@\n \t\t   UNSPEC_CMPGU_LE_QB))]\n   \"ISA_HAS_DSP\"\n   \"cmpgu.le.qb\\t%0,%1,%2\"\n-  [(set_attr \"type\"\t\"arith\")\n+  [(set_attr \"type\"\t\"dspalu\")\n    (set_attr \"mode\"\t\"SI\")])\n \n ;; PICK*\n@@ -875,7 +875,7 @@\n \t\t     UNSPEC_PICK))]\n   \"ISA_HAS_DSP\"\n   \"pick.<DSPV:dspfmt2>\\t%0,%1,%2\"\n-  [(set_attr \"type\"\t\"arith\")\n+  [(set_attr \"type\"\t\"dspalu\")\n    (set_attr \"mode\"\t\"SI\")])\n \n ;; PACKRL*\n@@ -886,7 +886,7 @@\n \t\t     UNSPEC_PACKRL_PH))]\n   \"ISA_HAS_DSP\"\n   \"packrl.ph\\t%0,%1,%2\"\n-  [(set_attr \"type\"\t\"arith\")\n+  [(set_attr \"type\"\t\"dspalu\")\n    (set_attr \"mode\"\t\"SI\")])\n \n ;; Table 2-6. MIPS DSP ASE Instructions: Accumulator and DSPControl Access\n@@ -909,7 +909,7 @@\n     }\n   return \"extrv.w\\t%0,%q1,%2\";\n }\n-  [(set_attr \"type\"\t\"mflo\")\n+  [(set_attr \"type\"\t\"accext\")\n    (set_attr \"mode\"\t\"SI\")])\n \n (define_insn \"mips_extr_r_w\"\n@@ -930,7 +930,7 @@\n     }\n   return \"extrv_r.w\\t%0,%q1,%2\";\n }\n-  [(set_attr \"type\"\t\"mflo\")\n+  [(set_attr \"type\"\t\"accext\")\n    (set_attr \"mode\"\t\"SI\")])\n \n (define_insn \"mips_extr_rs_w\"\n@@ -951,7 +951,7 @@\n     }\n   return \"extrv_rs.w\\t%0,%q1,%2\";\n }\n-  [(set_attr \"type\"\t\"mflo\")\n+  [(set_attr \"type\"\t\"accext\")\n    (set_attr \"mode\"\t\"SI\")])\n \n ;; EXTR*_S.H\n@@ -973,7 +973,7 @@\n     }\n   return \"extrv_s.h\\t%0,%q1,%2\";\n }\n-  [(set_attr \"type\"\t\"mflo\")\n+  [(set_attr \"type\"\t\"accext\")\n    (set_attr \"mode\"\t\"SI\")])\n \n ;; EXTP*\n@@ -996,7 +996,7 @@\n     }\n   return \"extpv\\t%0,%q1,%2\";\n }\n-  [(set_attr \"type\"\t\"mflo\")\n+  [(set_attr \"type\"\t\"accext\")\n    (set_attr \"mode\"\t\"SI\")])\n \n (define_insn \"mips_extpdp\"\n@@ -1021,7 +1021,7 @@\n     }\n   return \"extpdpv\\t%0,%q1,%2\";\n }\n-  [(set_attr \"type\"\t\"mflo\")\n+  [(set_attr \"type\"\t\"accext\")\n    (set_attr \"mode\"\t\"SI\")])\n \n ;; SHILO*\n@@ -1040,7 +1040,7 @@\n     }\n   return \"shilov\\t%q0,%2\";\n }\n-  [(set_attr \"type\"\t\"mflo\")\n+  [(set_attr \"type\"\t\"accmod\")\n    (set_attr \"mode\"\t\"SI\")])\n \n ;; MTHLIP*\n@@ -1056,7 +1056,7 @@\n \t\t\t (reg:CCDSP CCDSP_PO_REGNUM)] UNSPEC_MTHLIP))])]\n   \"ISA_HAS_DSP && !TARGET_64BIT\"\n   \"mthlip\\t%2,%q0\"\n-  [(set_attr \"type\"\t\"mflo\")\n+  [(set_attr \"type\"\t\"accmod\")\n    (set_attr \"mode\"\t\"SI\")])\n \n ;; WRDSP\n@@ -1078,7 +1078,7 @@\n \t  (unspec:CCDSP [(match_dup 0) (match_dup 1)] UNSPEC_WRDSP))])]\n   \"ISA_HAS_DSP\"\n   \"wrdsp\\t%0,%1\"\n-  [(set_attr \"type\"\t\"arith\")\n+  [(set_attr \"type\"\t\"dspalu\")\n    (set_attr \"mode\"\t\"SI\")])\n \n ;; RDDSP\n@@ -1094,7 +1094,7 @@\n \t\t   UNSPEC_RDDSP))]\n   \"ISA_HAS_DSP\"\n   \"rddsp\\t%0,%1\"\n-  [(set_attr \"type\"\t\"arith\")\n+  [(set_attr \"type\"\t\"dspalu\")\n    (set_attr \"mode\"\t\"SI\")])\n \n ;; Table 2-7. MIPS DSP ASE Instructions: Indexed-Load"}, {"sha": "0d025809907e710caac637c49ef612a2fce52ef9", "filename": "gcc/config/mips/mips-dspr2.md", "status": "modified", "additions": 47, "deletions": 38, "changes": 85, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/ef2e5300177d18089c1c30bec6abff0700ecc44c/gcc%2Fconfig%2Fmips%2Fmips-dspr2.md", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/ef2e5300177d18089c1c30bec6abff0700ecc44c/gcc%2Fconfig%2Fmips%2Fmips-dspr2.md", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fconfig%2Fmips%2Fmips-dspr2.md?ref=ef2e5300177d18089c1c30bec6abff0700ecc44c", "patch": "@@ -79,7 +79,7 @@\n \t  (unspec:CCDSP [(match_dup 1)] UNSPEC_ABSQ_S_QB))])]\n   \"ISA_HAS_DSPR2\"\n   \"absq_s.qb\\t%0,%z1\"\n-  [(set_attr \"type\"\t\"arith\")\n+  [(set_attr \"type\"\t\"dspalusat\")\n    (set_attr \"mode\"\t\"SI\")])\n \n (define_insn \"mips_addu_ph\"\n@@ -91,7 +91,7 @@\n \t  (unspec:CCDSP [(match_dup 1) (match_dup 2)] UNSPEC_ADDU_PH))])]\n   \"ISA_HAS_DSPR2\"\n   \"addu.ph\\t%0,%z1,%z2\"\n-  [(set_attr \"type\"\t\"arith\")\n+  [(set_attr \"type\"\t\"dspalu\")\n    (set_attr \"mode\"\t\"SI\")])\n \n (define_insn \"mips_addu_s_ph\"\n@@ -104,7 +104,7 @@\n \t  (unspec:CCDSP [(match_dup 1) (match_dup 2)] UNSPEC_ADDU_S_PH))])]\n   \"ISA_HAS_DSPR2\"\n   \"addu_s.ph\\t%0,%z1,%z2\"\n-  [(set_attr \"type\"\t\"arith\")\n+  [(set_attr \"type\"\t\"dspalusat\")\n    (set_attr \"mode\"\t\"SI\")])\n \n (define_insn \"mips_adduh_qb\"\n@@ -114,7 +114,7 @@\n \t\t     UNSPEC_ADDUH_QB))]\n   \"ISA_HAS_DSPR2\"\n   \"adduh.qb\\t%0,%z1,%z2\"\n-  [(set_attr \"type\"\t\"arith\")\n+  [(set_attr \"type\"\t\"dspalu\")\n    (set_attr \"mode\"\t\"SI\")])\n \n (define_insn \"mips_adduh_r_qb\"\n@@ -124,7 +124,7 @@\n \t\t     UNSPEC_ADDUH_R_QB))]\n   \"ISA_HAS_DSPR2\"\n   \"adduh_r.qb\\t%0,%z1,%z2\"\n-  [(set_attr \"type\"\t\"arith\")\n+  [(set_attr \"type\"\t\"dspalusat\")\n    (set_attr \"mode\"\t\"SI\")])\n \n (define_insn \"mips_append\"\n@@ -139,7 +139,7 @@\n     operands[2] = GEN_INT (INTVAL (operands[2]) & 31);\n   return \"append\\t%0,%z2,%3\";\n }\n-  [(set_attr \"type\"\t\"arith\")\n+  [(set_attr \"type\"\t\"dspalu\")\n    (set_attr \"mode\"\t\"SI\")])\n \n (define_insn \"mips_balign\"\n@@ -154,7 +154,7 @@\n     operands[2] = GEN_INT (INTVAL (operands[2]) & 3);\n   return \"balign\\t%0,%z2,%3\";\n }\n-  [(set_attr \"type\"\t\"arith\")\n+  [(set_attr \"type\"\t\"dspalu\")\n    (set_attr \"mode\"\t\"SI\")])\n \n (define_insn \"mips_cmpgdu_eq_qb\"\n@@ -169,7 +169,7 @@\n \t\t\tUNSPEC_CMPGDU_EQ_QB))])]\n   \"ISA_HAS_DSPR2\"\n   \"cmpgdu.eq.qb\\t%0,%z1,%z2\"\n-  [(set_attr \"type\"\t\"arith\")\n+  [(set_attr \"type\"\t\"dspalu\")\n    (set_attr \"mode\"\t\"SI\")])\n \n (define_insn \"mips_cmpgdu_lt_qb\"\n@@ -184,7 +184,7 @@\n \t\t\tUNSPEC_CMPGDU_LT_QB))])]\n   \"ISA_HAS_DSPR2\"\n   \"cmpgdu.lt.qb\\t%0,%z1,%z2\"\n-  [(set_attr \"type\"\t\"arith\")\n+  [(set_attr \"type\"\t\"dspalu\")\n    (set_attr \"mode\"\t\"SI\")])\n \n (define_insn \"mips_cmpgdu_le_qb\"\n@@ -199,7 +199,7 @@\n \t\t\tUNSPEC_CMPGDU_LE_QB))])]\n   \"ISA_HAS_DSPR2\"\n   \"cmpgdu.le.qb\\t%0,%z1,%z2\"\n-  [(set_attr \"type\"\t\"arith\")\n+  [(set_attr \"type\"\t\"dspalu\")\n    (set_attr \"mode\"\t\"SI\")])\n \n (define_insn \"mips_dpa_w_ph\"\n@@ -210,7 +210,8 @@\n \t\t   UNSPEC_DPA_W_PH))]\n   \"ISA_HAS_DSPR2 && !TARGET_64BIT\"\n   \"dpa.w.ph\\t%q0,%z2,%z3\"\n-  [(set_attr \"type\"\t\"imadd\")\n+  [(set_attr \"type\"\t\"dspmac\")\n+   (set_attr \"accum_in\" \"1\")\n    (set_attr \"mode\"\t\"SI\")])\n \n (define_insn \"mips_dps_w_ph\"\n@@ -221,7 +222,8 @@\n \t\t   UNSPEC_DPS_W_PH))]\n   \"ISA_HAS_DSPR2 && !TARGET_64BIT\"\n   \"dps.w.ph\\t%q0,%z2,%z3\"\n-  [(set_attr \"type\"\t\"imadd\")\n+  [(set_attr \"type\"\t\"dspmac\")\n+   (set_attr \"accum_in\" \"1\")\n    (set_attr \"mode\"\t\"SI\")])\n \n (define_insn \"mulv2hi3\"\n@@ -301,7 +303,8 @@\n \t\t   UNSPEC_MULSA_W_PH))]\n   \"ISA_HAS_DSPR2 && !TARGET_64BIT\"\n   \"mulsa.w.ph\\t%q0,%z2,%z3\"\n-  [(set_attr \"type\"\t\"imadd\")\n+  [(set_attr \"type\"\t\"dspmac\")\n+   (set_attr \"accum_in\" \"1\")\n    (set_attr \"mode\"\t\"SI\")])\n \n (define_insn \"mips_precr_qb_ph\"\n@@ -311,7 +314,7 @@\n \t\t     UNSPEC_PRECR_QB_PH))]\n   \"ISA_HAS_DSPR2\"\n   \"precr.qb.ph\\t%0,%z1,%z2\"\n-  [(set_attr \"type\"\t\"arith\")\n+  [(set_attr \"type\"\t\"dspalu\")\n    (set_attr \"mode\"\t\"SI\")])\n \n (define_insn \"mips_precr_sra_ph_w\"\n@@ -326,7 +329,7 @@\n     operands[2] = GEN_INT (INTVAL (operands[2]) & 31);\n   return \"precr_sra.ph.w\\t%0,%z2,%3\";\n }\n-  [(set_attr \"type\"\t\"arith\")\n+  [(set_attr \"type\"\t\"dspalu\")\n    (set_attr \"mode\"\t\"SI\")])\n \n (define_insn \"mips_precr_sra_r_ph_w\"\n@@ -341,7 +344,7 @@\n     operands[2] = GEN_INT (INTVAL (operands[2]) & 31);\n   return \"precr_sra_r.ph.w\\t%0,%z2,%3\";\n }\n-  [(set_attr \"type\"\t\"arith\")\n+  [(set_attr \"type\"\t\"dspalu\")\n    (set_attr \"mode\"\t\"SI\")])\n \n (define_insn \"mips_prepend\"\n@@ -356,7 +359,7 @@\n     operands[3] = GEN_INT (INTVAL (operands[3]) & 31);\n   return \"prepend\\t%0,%z2,%3\";\n }\n-  [(set_attr \"type\"\t\"arith\")\n+  [(set_attr \"type\"\t\"dspalu\")\n    (set_attr \"mode\"\t\"SI\")])\n \n (define_insn \"mips_shra_qb\"\n@@ -374,7 +377,7 @@\n     }\n   return \"shrav.qb\\t%0,%z1,%2\";\n }\n-  [(set_attr \"type\"\t\"shift\")\n+  [(set_attr \"type\"\t\"dspalu\")\n    (set_attr \"mode\"\t\"SI\")])\n \n \n@@ -393,7 +396,7 @@\n     }\n   return \"shrav_r.qb\\t%0,%z1,%2\";\n }\n-  [(set_attr \"type\"\t\"shift\")\n+  [(set_attr \"type\"\t\"dspalu\")\n    (set_attr \"mode\"\t\"SI\")])\n \n (define_insn \"mips_shrl_ph\"\n@@ -411,7 +414,7 @@\n     }\n   return \"shrlv.ph\\t%0,%z1,%2\";\n }\n-  [(set_attr \"type\"\t\"shift\")\n+  [(set_attr \"type\"\t\"dspalu\")\n    (set_attr \"mode\"\t\"SI\")])\n \n (define_insn \"mips_subu_ph\"\n@@ -424,7 +427,7 @@\n \t  (unspec:CCDSP [(match_dup 1) (match_dup 2)] UNSPEC_SUBU_PH))])]\n   \"ISA_HAS_DSPR2\"\n   \"subu.ph\\t%0,%z1,%z2\"\n-  [(set_attr \"type\"\t\"arith\")\n+  [(set_attr \"type\"\t\"dspalu\")\n    (set_attr \"mode\"\t\"SI\")])\n \n (define_insn \"mips_subu_s_ph\"\n@@ -437,7 +440,7 @@\n \t  (unspec:CCDSP [(match_dup 1) (match_dup 2)] UNSPEC_SUBU_S_PH))])]\n   \"ISA_HAS_DSPR2\"\n   \"subu_s.ph\\t%0,%z1,%z2\"\n-  [(set_attr \"type\"\t\"arith\")\n+  [(set_attr \"type\"\t\"dspalusat\")\n    (set_attr \"mode\"\t\"SI\")])\n \n (define_insn \"mips_subuh_qb\"\n@@ -447,7 +450,7 @@\n \t\t     UNSPEC_SUBUH_QB))]\n   \"ISA_HAS_DSPR2\"\n   \"subuh.qb\\t%0,%z1,%z2\"\n-  [(set_attr \"type\"\t\"arith\")\n+  [(set_attr \"type\"\t\"dspalu\")\n    (set_attr \"mode\"\t\"SI\")])\n \n (define_insn \"mips_subuh_r_qb\"\n@@ -457,7 +460,7 @@\n \t\t     UNSPEC_SUBUH_R_QB))]\n   \"ISA_HAS_DSPR2\"\n   \"subuh_r.qb\\t%0,%z1,%z2\"\n-  [(set_attr \"type\"\t\"arith\")\n+  [(set_attr \"type\"\t\"dspalu\")\n    (set_attr \"mode\"\t\"SI\")])\n \n (define_insn \"mips_addqh_ph\"\n@@ -467,7 +470,7 @@\n \t\t     UNSPEC_ADDQH_PH))]\n   \"ISA_HAS_DSPR2\"\n   \"addqh.ph\\t%0,%z1,%z2\"\n-  [(set_attr \"type\"\t\"arith\")\n+  [(set_attr \"type\"\t\"dspalu\")\n    (set_attr \"mode\"\t\"SI\")])\n \n (define_insn \"mips_addqh_r_ph\"\n@@ -477,7 +480,7 @@\n \t\t     UNSPEC_ADDQH_R_PH))]\n   \"ISA_HAS_DSPR2\"\n   \"addqh_r.ph\\t%0,%z1,%z2\"\n-  [(set_attr \"type\"\t\"arith\")\n+  [(set_attr \"type\"\t\"dspalu\")\n    (set_attr \"mode\"\t\"SI\")])\n \n (define_insn \"mips_addqh_w\"\n@@ -487,7 +490,7 @@\n \t\t   UNSPEC_ADDQH_W))]\n   \"ISA_HAS_DSPR2\"\n   \"addqh.w\\t%0,%z1,%z2\"\n-  [(set_attr \"type\"\t\"arith\")\n+  [(set_attr \"type\"\t\"dspalu\")\n    (set_attr \"mode\"\t\"SI\")])\n \n (define_insn \"mips_addqh_r_w\"\n@@ -497,7 +500,7 @@\n \t\t   UNSPEC_ADDQH_R_W))]\n   \"ISA_HAS_DSPR2\"\n   \"addqh_r.w\\t%0,%z1,%z2\"\n-  [(set_attr \"type\"\t\"arith\")\n+  [(set_attr \"type\"\t\"dspalu\")\n    (set_attr \"mode\"\t\"SI\")])\n \n (define_insn \"mips_subqh_ph\"\n@@ -507,7 +510,7 @@\n \t\t     UNSPEC_SUBQH_PH))]\n   \"ISA_HAS_DSPR2\"\n   \"subqh.ph\\t%0,%z1,%z2\"\n-  [(set_attr \"type\"\t\"arith\")\n+  [(set_attr \"type\"\t\"dspalu\")\n    (set_attr \"mode\"\t\"SI\")])\n \n (define_insn \"mips_subqh_r_ph\"\n@@ -517,7 +520,7 @@\n \t\t     UNSPEC_SUBQH_R_PH))]\n   \"ISA_HAS_DSPR2\"\n   \"subqh_r.ph\\t%0,%z1,%z2\"\n-  [(set_attr \"type\"\t\"arith\")\n+  [(set_attr \"type\"\t\"dspalu\")\n    (set_attr \"mode\"\t\"SI\")])\n \n (define_insn \"mips_subqh_w\"\n@@ -527,7 +530,7 @@\n \t\t   UNSPEC_SUBQH_W))]\n   \"ISA_HAS_DSPR2\"\n   \"subqh.w\\t%0,%z1,%z2\"\n-  [(set_attr \"type\"\t\"arith\")\n+  [(set_attr \"type\"\t\"dspalu\")\n    (set_attr \"mode\"\t\"SI\")])\n \n (define_insn \"mips_subqh_r_w\"\n@@ -537,7 +540,7 @@\n \t\t   UNSPEC_SUBQH_R_W))]\n   \"ISA_HAS_DSPR2\"\n   \"subqh_r.w\\t%0,%z1,%z2\"\n-  [(set_attr \"type\"\t\"arith\")\n+  [(set_attr \"type\"\t\"dspalu\")\n    (set_attr \"mode\"\t\"SI\")])\n \n (define_insn \"mips_dpax_w_ph\"\n@@ -548,7 +551,8 @@\n \t\t   UNSPEC_DPAX_W_PH))]\n   \"ISA_HAS_DSPR2 && !TARGET_64BIT\"\n   \"dpax.w.ph\\t%q0,%z2,%z3\"\n-  [(set_attr \"type\"\t\"imadd\")\n+  [(set_attr \"type\"\t\"dspmac\")\n+   (set_attr \"accum_in\" \"1\")\n    (set_attr \"mode\"\t\"SI\")])\n \n (define_insn \"mips_dpsx_w_ph\"\n@@ -559,7 +563,8 @@\n \t\t   UNSPEC_DPSX_W_PH))]\n   \"ISA_HAS_DSPR2 && !TARGET_64BIT\"\n   \"dpsx.w.ph\\t%q0,%z2,%z3\"\n-  [(set_attr \"type\"\t\"imadd\")\n+  [(set_attr \"type\"\t\"dspmac\")\n+   (set_attr \"accum_in\" \"1\")\n    (set_attr \"mode\"\t\"SI\")])\n \n (define_insn \"mips_dpaqx_s_w_ph\"\n@@ -574,7 +579,8 @@\n \t\t\tUNSPEC_DPAQX_S_W_PH))])]\n   \"ISA_HAS_DSPR2 && !TARGET_64BIT\"\n   \"dpaqx_s.w.ph\\t%q0,%z2,%z3\"\n-  [(set_attr \"type\"\t\"imadd\")\n+  [(set_attr \"type\"\t\"dspmac\")\n+   (set_attr \"accum_in\" \"1\")\n    (set_attr \"mode\"\t\"SI\")])\n \n (define_insn \"mips_dpaqx_sa_w_ph\"\n@@ -589,7 +595,8 @@\n \t\t\tUNSPEC_DPAQX_SA_W_PH))])]\n   \"ISA_HAS_DSPR2 && !TARGET_64BIT\"\n   \"dpaqx_sa.w.ph\\t%q0,%z2,%z3\"\n-  [(set_attr \"type\"\t\"imadd\")\n+  [(set_attr \"type\"\t\"dspmacsat\")\n+   (set_attr \"accum_in\" \"1\")\n    (set_attr \"mode\"\t\"SI\")])\n \n (define_insn \"mips_dpsqx_s_w_ph\"\n@@ -604,7 +611,8 @@\n \t\t\tUNSPEC_DPSQX_S_W_PH))])]\n   \"ISA_HAS_DSPR2 && !TARGET_64BIT\"\n   \"dpsqx_s.w.ph\\t%q0,%z2,%z3\"\n-  [(set_attr \"type\"\t\"imadd\")\n+  [(set_attr \"type\"\t\"dspmac\")\n+   (set_attr \"accum_in\" \"1\")\n    (set_attr \"mode\"\t\"SI\")])\n \n (define_insn \"mips_dpsqx_sa_w_ph\"\n@@ -619,5 +627,6 @@\n \t\t\tUNSPEC_DPSQX_SA_W_PH))])]\n   \"ISA_HAS_DSPR2 && !TARGET_64BIT\"\n   \"dpsqx_sa.w.ph\\t%q0,%z2,%z3\"\n-  [(set_attr \"type\"\t\"imadd\")\n+  [(set_attr \"type\"\t\"dspmacsat\")\n+   (set_attr \"accum_in\" \"1\")\n    (set_attr \"mode\"\t\"SI\")])"}, {"sha": "2584bc76c8edd34583e066ca1f021af68e0a4bf3", "filename": "gcc/config/mips/mips-protos.h", "status": "modified", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/ef2e5300177d18089c1c30bec6abff0700ecc44c/gcc%2Fconfig%2Fmips%2Fmips-protos.h", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/ef2e5300177d18089c1c30bec6abff0700ecc44c/gcc%2Fconfig%2Fmips%2Fmips-protos.h", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fconfig%2Fmips%2Fmips-protos.h?ref=ef2e5300177d18089c1c30bec6abff0700ecc44c", "patch": "@@ -298,6 +298,7 @@ extern const char *mips_output_division (const char *, rtx *);\n extern unsigned int mips_hard_regno_nregs (int, enum machine_mode);\n extern bool mips_linked_madd_p (rtx, rtx);\n extern bool mips_store_data_bypass_p (rtx, rtx);\n+extern int mips_dspalu_bypass_p (rtx, rtx);\n extern rtx mips_prefetch_cookie (rtx, rtx);\n \n extern const char *current_section_name (void);"}, {"sha": "051f3b304d42b81d9edc905bedfa7d483852d1d5", "filename": "gcc/config/mips/mips.c", "status": "modified", "additions": 30, "deletions": 0, "changes": 30, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/ef2e5300177d18089c1c30bec6abff0700ecc44c/gcc%2Fconfig%2Fmips%2Fmips.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/ef2e5300177d18089c1c30bec6abff0700ecc44c/gcc%2Fconfig%2Fmips%2Fmips.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fconfig%2Fmips%2Fmips.c?ref=ef2e5300177d18089c1c30bec6abff0700ecc44c", "patch": "@@ -8307,6 +8307,36 @@ mips_dwarf_register_span (rtx reg)\n   return NULL_RTX;\n }\n \n+/* DSP ALU can bypass data with no delays for the following pairs. */\n+enum insn_code dspalu_bypass_table[][2] =\n+{\n+  {CODE_FOR_mips_addsc, CODE_FOR_mips_addwc},\n+  {CODE_FOR_mips_cmpu_eq_qb, CODE_FOR_mips_pick_qb},\n+  {CODE_FOR_mips_cmpu_lt_qb, CODE_FOR_mips_pick_qb},\n+  {CODE_FOR_mips_cmpu_le_qb, CODE_FOR_mips_pick_qb},\n+  {CODE_FOR_mips_cmp_eq_ph, CODE_FOR_mips_pick_ph},\n+  {CODE_FOR_mips_cmp_lt_ph, CODE_FOR_mips_pick_ph},\n+  {CODE_FOR_mips_cmp_le_ph, CODE_FOR_mips_pick_ph},\n+  {CODE_FOR_mips_wrdsp, CODE_FOR_mips_insv}\n+};\n+\n+int\n+mips_dspalu_bypass_p (rtx out_insn, rtx in_insn)\n+{\n+  int i;\n+  int num_bypass = ARRAY_SIZE (dspalu_bypass_table);\n+  enum insn_code out_icode = (enum insn_code) INSN_CODE (out_insn);\n+  enum insn_code in_icode = (enum insn_code) INSN_CODE (in_insn);\n+\n+  for (i = 0; i < num_bypass; i++)\n+    {\n+      if (out_icode == dspalu_bypass_table[i][0]\n+\t  && in_icode == dspalu_bypass_table[i][1])\n+       return true;\n+    }\n+\n+  return false;\n+}\n /* Implement ASM_OUTPUT_ASCII.  */\n \n void"}, {"sha": "ca89cc1e3bf03bf528b32b9cfa418bf262a3ab6e", "filename": "gcc/config/mips/mips.md", "status": "modified", "additions": 8, "deletions": 1, "changes": 9, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/ef2e5300177d18089c1c30bec6abff0700ecc44c/gcc%2Fconfig%2Fmips%2Fmips.md", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/ef2e5300177d18089c1c30bec6abff0700ecc44c/gcc%2Fconfig%2Fmips%2Fmips.md", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fconfig%2Fmips%2Fmips.md?ref=ef2e5300177d18089c1c30bec6abff0700ecc44c", "patch": "@@ -328,6 +328,12 @@\n ;; frsqrt       floating point reciprocal square root\n ;; frsqrt1      floating point reciprocal square root step1\n ;; frsqrt2      floating point reciprocal square root step2\n+;; dspmac       DSP MAC instructions not saturating the accumulator\n+;; dspmacsat    DSP MAC instructions that saturate the accumulator\n+;; accext       DSP accumulator extract instructions\n+;; accmod       DSP accumulator modify instructions\n+;; dspalu       DSP ALU instructions not saturating the result\n+;; dspalusat    DSP ALU instructions that saturate the result\n ;; multi\tmultiword sequence (or user asm statements)\n ;; atomic\tatomic memory update instruction\n ;; syncloop\tmemory atomic operation implemented as a sync loop\n@@ -338,7 +344,8 @@\n    prefetch,prefetchx,condmove,mtc,mfc,mthi,mtlo,mfhi,mflo,const,arith,logical,\n    shift,slt,signext,clz,pop,trap,imul,imul3,imul3nc,imadd,idiv,idiv3,move,\n    fmove,fadd,fmul,fmadd,fdiv,frdiv,frdiv1,frdiv2,fabs,fneg,fcmp,fcvt,fsqrt,\n-   frsqrt,frsqrt1,frsqrt2,multi,atomic,syncloop,nop,ghost\"\n+   frsqrt,frsqrt1,frsqrt2,dspmac,dspmacsat,accext,accmod,dspalu,dspalusat,\n+   multi,atomic,syncloop,nop,ghost\"\n   (cond [(eq_attr \"jal\" \"!unset\") (const_string \"call\")\n \t (eq_attr \"got\" \"load\") (const_string \"load\")\n "}]}