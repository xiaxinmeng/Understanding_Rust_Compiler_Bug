{"sha": "cd36c83e9bb1c8cf66082da63234925482695ef1", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6Y2QzNmM4M2U5YmIxYzhjZjY2MDgyZGE2MzIzNDkyNTQ4MjY5NWVmMQ==", "commit": {"author": {"name": "Pierre-Marie de Rodat", "email": "derodat@adacore.com", "date": "2016-05-10T15:57:37Z"}, "committer": {"name": "Pierre-Marie de Rodat", "email": "pmderodat@gcc.gnu.org", "date": "2016-05-10T15:57:37Z"}, "message": "DWARF: fix stack usage assessment for DW_OP_neg\n\nWhen the DWARF back-end generates DW_OP_neg operations in DWARF\nprocedures, we get an ICE because of inconsistent stack usage\ncomputation for the embedding expression. This is because\nresolve_args_picking_1 thinks DW_OP_neg is a binary operation (pops 2\nstack slots, pushes 1) whereas it really is an unary one (one pop, one\npush).\n\nThis change fixes resolve_args_picking_1 and adds a regression testcase\n(which crashes with the current trunk).  Bootstrapped and regtested\nwithout regression on x86_64-linux.\n\ngcc/\n\n\t* dwarf2out.c (resolve_args_picking_1): Consider DW_OP_neg as an\n\tunary operation, not a binary one.\n\ngcc/testsuite/\n\n\t* gnat.dg/debug6.adb, gnat.dg/debug6_pkg.ads: New testcase.\n\nFrom-SVN: r236087", "tree": {"sha": "70b03e461d6650956ff172656edd2eeb9bc01fb3", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/70b03e461d6650956ff172656edd2eeb9bc01fb3"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/cd36c83e9bb1c8cf66082da63234925482695ef1", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/cd36c83e9bb1c8cf66082da63234925482695ef1", "html_url": "https://github.com/Rust-GCC/gccrs/commit/cd36c83e9bb1c8cf66082da63234925482695ef1", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/cd36c83e9bb1c8cf66082da63234925482695ef1/comments", "author": {"login": "pmderodat", "id": 758452, "node_id": "MDQ6VXNlcjc1ODQ1Mg==", "avatar_url": "https://avatars.githubusercontent.com/u/758452?v=4", "gravatar_id": "", "url": "https://api.github.com/users/pmderodat", "html_url": "https://github.com/pmderodat", "followers_url": "https://api.github.com/users/pmderodat/followers", "following_url": "https://api.github.com/users/pmderodat/following{/other_user}", "gists_url": "https://api.github.com/users/pmderodat/gists{/gist_id}", "starred_url": "https://api.github.com/users/pmderodat/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/pmderodat/subscriptions", "organizations_url": "https://api.github.com/users/pmderodat/orgs", "repos_url": "https://api.github.com/users/pmderodat/repos", "events_url": "https://api.github.com/users/pmderodat/events{/privacy}", "received_events_url": "https://api.github.com/users/pmderodat/received_events", "type": "User", "site_admin": false}, "committer": null, "parents": [{"sha": "afc610dba10fd532e83da10e19c5e0c5d7bcc34d", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/afc610dba10fd532e83da10e19c5e0c5d7bcc34d", "html_url": "https://github.com/Rust-GCC/gccrs/commit/afc610dba10fd532e83da10e19c5e0c5d7bcc34d"}], "stats": {"total": 37, "additions": 36, "deletions": 1}, "files": [{"sha": "941748c10eb9300cbaf9357db0ff649e46fb112c", "filename": "gcc/ChangeLog", "status": "modified", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/cd36c83e9bb1c8cf66082da63234925482695ef1/gcc%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/cd36c83e9bb1c8cf66082da63234925482695ef1/gcc%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2FChangeLog?ref=cd36c83e9bb1c8cf66082da63234925482695ef1", "patch": "@@ -1,3 +1,8 @@\n+2016-05-10  Pierre-Marie de Rodat  <derodat@adacore.com>\n+\n+\t* dwarf2out.c (resolve_args_picking_1): Consider DW_OP_neg as an\n+\tunary operation, not a binary one.\n+\n 2016-05-10  Ilya Enkovich  <ilya.enkovich@intel.com>\n \n \tPR tree-optimization/70786"}, {"sha": "8f192e877d709c37b106758fac6f76b7ec2797f6", "filename": "gcc/dwarf2out.c", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/cd36c83e9bb1c8cf66082da63234925482695ef1/gcc%2Fdwarf2out.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/cd36c83e9bb1c8cf66082da63234925482695ef1/gcc%2Fdwarf2out.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fdwarf2out.c?ref=cd36c83e9bb1c8cf66082da63234925482695ef1", "patch": "@@ -15407,6 +15407,7 @@ resolve_args_picking_1 (dw_loc_descr_ref loc, unsigned initial_frame_offset,\n \tcase DW_OP_swap:\n \tcase DW_OP_rot:\n \tcase DW_OP_abs:\n+\tcase DW_OP_neg:\n \tcase DW_OP_not:\n \tcase DW_OP_plus_uconst:\n \tcase DW_OP_skip:\n@@ -15543,7 +15544,6 @@ resolve_args_picking_1 (dw_loc_descr_ref loc, unsigned initial_frame_offset,\n \tcase DW_OP_minus:\n \tcase DW_OP_mod:\n \tcase DW_OP_mul:\n-\tcase DW_OP_neg:\n \tcase DW_OP_or:\n \tcase DW_OP_plus:\n \tcase DW_OP_shl:"}, {"sha": "1e42f38989cb2505437f0b58f61808f8106572ca", "filename": "gcc/testsuite/ChangeLog", "status": "modified", "additions": 4, "deletions": 0, "changes": 4, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/cd36c83e9bb1c8cf66082da63234925482695ef1/gcc%2Ftestsuite%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/cd36c83e9bb1c8cf66082da63234925482695ef1/gcc%2Ftestsuite%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2FChangeLog?ref=cd36c83e9bb1c8cf66082da63234925482695ef1", "patch": "@@ -1,3 +1,7 @@\n+2016-05-10  Pierre-Marie de Rodat  <derodat@adacore.com>\n+\n+\t* gnat.dg/debug6.adb, gnat.dg/debug6_pkg.ads: New testcase.\n+\n 2016-05-10  Ilya Enkovich  <ilya.enkovich@intel.com>\n \n \tPR tree-optimization/70786"}, {"sha": "25fdef206df91bf0a65c7d404f0c22ac2f03ff09", "filename": "gcc/testsuite/gnat.dg/debug6.adb", "status": "added", "additions": 10, "deletions": 0, "changes": 10, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/cd36c83e9bb1c8cf66082da63234925482695ef1/gcc%2Ftestsuite%2Fgnat.dg%2Fdebug6.adb", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/cd36c83e9bb1c8cf66082da63234925482695ef1/gcc%2Ftestsuite%2Fgnat.dg%2Fdebug6.adb", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgnat.dg%2Fdebug6.adb?ref=cd36c83e9bb1c8cf66082da63234925482695ef1", "patch": "@@ -0,0 +1,10 @@\n+-- { dg-do compile }\n+-- { dg-options \"-g\" }\n+\n+with Debug6_Pkg; use Debug6_Pkg;\n+\n+procedure Debug6 is\n+   V : Value := (Kind => Undefined);\n+begin\n+   Process (V);\n+end Debug6;"}, {"sha": "dfc9744079b806afc345d0ade7a9c94ed8dd4bfc", "filename": "gcc/testsuite/gnat.dg/debug6_pkg.ads", "status": "added", "additions": 16, "deletions": 0, "changes": 16, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/cd36c83e9bb1c8cf66082da63234925482695ef1/gcc%2Ftestsuite%2Fgnat.dg%2Fdebug6_pkg.ads", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/cd36c83e9bb1c8cf66082da63234925482695ef1/gcc%2Ftestsuite%2Fgnat.dg%2Fdebug6_pkg.ads", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgnat.dg%2Fdebug6_pkg.ads?ref=cd36c83e9bb1c8cf66082da63234925482695ef1", "patch": "@@ -0,0 +1,16 @@\n+package Debug6_Pkg is\n+\n+   type Vkind is (Int, Undefined);\n+   for Vkind use (Int => -2 ** 31, Undefined => 0);\n+\n+    type Value (Kind : Vkind) is record\n+       case Kind is\n+          when Undefined => null;\n+          when Int       => Value : Integer;\n+          when others    => null;\n+       end case;\n+    end record;\n+\n+    procedure Process (V : Value);\n+\n+end Debug6_Pkg;"}]}