{"sha": "054bf99841aad3869c70643b2ba2d9f85770c980", "node_id": "C_kwDOANBUbNoAKDA1NGJmOTk4NDFhYWQzODY5YzcwNjQzYjJiYTJkOWY4NTc3MGM5ODA", "commit": {"author": {"name": "Jonathan Wakely", "email": "jwakely@redhat.com", "date": "2021-11-16T21:03:21Z"}, "committer": {"name": "Jonathan Wakely", "email": "jwakely@redhat.com", "date": "2021-11-17T17:21:24Z"}, "message": "libstdc++: Fix std::type_info::before for ARM [PR103240]\n\nThe r179236 fix for std::type_info::operator== should also have been\napplied to std::type_info::before. Otherwise two distinct types can\ncompare equivalent due to using a string comparison, when they should do\na pointer comparison.\n\nlibstdc++-v3/ChangeLog:\n\n\tPR libstdc++/103240\n\t* libsupc++/tinfo2.cc (type_info::before): Use unadjusted name\n\tto check for the '*' prefix.\n\t* testsuite/util/testsuite_shared.cc: Add type_info object for\n\tuse in new test.\n\t* testsuite/18_support/type_info/103240.cc: New test.", "tree": {"sha": "32f79aea7584caae05ee00d1cf807a0bc5d8e3a1", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/32f79aea7584caae05ee00d1cf807a0bc5d8e3a1"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/054bf99841aad3869c70643b2ba2d9f85770c980", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/054bf99841aad3869c70643b2ba2d9f85770c980", "html_url": "https://github.com/Rust-GCC/gccrs/commit/054bf99841aad3869c70643b2ba2d9f85770c980", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/054bf99841aad3869c70643b2ba2d9f85770c980/comments", "author": {"login": "jwakely", "id": 1254480, "node_id": "MDQ6VXNlcjEyNTQ0ODA=", "avatar_url": "https://avatars.githubusercontent.com/u/1254480?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jwakely", "html_url": "https://github.com/jwakely", "followers_url": "https://api.github.com/users/jwakely/followers", "following_url": "https://api.github.com/users/jwakely/following{/other_user}", "gists_url": "https://api.github.com/users/jwakely/gists{/gist_id}", "starred_url": "https://api.github.com/users/jwakely/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jwakely/subscriptions", "organizations_url": "https://api.github.com/users/jwakely/orgs", "repos_url": "https://api.github.com/users/jwakely/repos", "events_url": "https://api.github.com/users/jwakely/events{/privacy}", "received_events_url": "https://api.github.com/users/jwakely/received_events", "type": "User", "site_admin": false}, "committer": {"login": "jwakely", "id": 1254480, "node_id": "MDQ6VXNlcjEyNTQ0ODA=", "avatar_url": "https://avatars.githubusercontent.com/u/1254480?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jwakely", "html_url": "https://github.com/jwakely", "followers_url": "https://api.github.com/users/jwakely/followers", "following_url": "https://api.github.com/users/jwakely/following{/other_user}", "gists_url": "https://api.github.com/users/jwakely/gists{/gist_id}", "starred_url": "https://api.github.com/users/jwakely/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jwakely/subscriptions", "organizations_url": "https://api.github.com/users/jwakely/orgs", "repos_url": "https://api.github.com/users/jwakely/repos", "events_url": "https://api.github.com/users/jwakely/events{/privacy}", "received_events_url": "https://api.github.com/users/jwakely/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "c70546482388951b5c9c19cff002ee6ab920b7f5", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/c70546482388951b5c9c19cff002ee6ab920b7f5", "html_url": "https://github.com/Rust-GCC/gccrs/commit/c70546482388951b5c9c19cff002ee6ab920b7f5"}], "stats": {"total": 53, "additions": 52, "deletions": 1}, "files": [{"sha": "d02021fe538cae4f88240b654fda8e54b7e7e820", "filename": "libstdc++-v3/libsupc++/tinfo2.cc", "status": "modified", "additions": 4, "deletions": 1, "changes": 5, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/054bf99841aad3869c70643b2ba2d9f85770c980/libstdc%2B%2B-v3%2Flibsupc%2B%2B%2Ftinfo2.cc", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/054bf99841aad3869c70643b2ba2d9f85770c980/libstdc%2B%2B-v3%2Flibsupc%2B%2B%2Ftinfo2.cc", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libstdc%2B%2B-v3%2Flibsupc%2B%2B%2Ftinfo2.cc?ref=054bf99841aad3869c70643b2ba2d9f85770c980", "patch": "@@ -36,7 +36,10 @@ type_info::before (const type_info &arg) const _GLIBCXX_NOEXCEPT\n #if __GXX_MERGED_TYPEINFO_NAMES\n   return name () < arg.name ();\n #else\n-  return (name ()[0] == '*') ? name () < arg.name ()\n+  /* The name() method will strip any leading '*' prefix. Therefore\n+     take care to look at __name rather than name() when looking for\n+     the \"pointer\" prefix.  */\n+  return (__name[0] == '*') ? name () < arg.name ()\n     :  __builtin_strcmp (name (), arg.name ()) < 0;\n #endif\n }"}, {"sha": "3d5968ac25cc830b7a8b572e3640518372541715", "filename": "libstdc++-v3/testsuite/18_support/type_info/103240.cc", "status": "added", "additions": 36, "deletions": 0, "changes": 36, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/054bf99841aad3869c70643b2ba2d9f85770c980/libstdc%2B%2B-v3%2Ftestsuite%2F18_support%2Ftype_info%2F103240.cc", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/054bf99841aad3869c70643b2ba2d9f85770c980/libstdc%2B%2B-v3%2Ftestsuite%2F18_support%2Ftype_info%2F103240.cc", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libstdc%2B%2B-v3%2Ftestsuite%2F18_support%2Ftype_info%2F103240.cc?ref=054bf99841aad3869c70643b2ba2d9f85770c980", "patch": "@@ -0,0 +1,36 @@\n+// { dg-do run }\n+// { dg-require-sharedlib \"\" }\n+// { dg-options \"./testsuite_shared.so\" }\n+\n+#include <typeinfo>\n+#include <testsuite_hooks.h>\n+\n+namespace __gnu_test\n+{\n+namespace\n+{\n+  struct S { };\n+  struct T { };\n+}\n+\n+// Defined in testsuite_shared.so, referring to private type in that library\n+// with the same mangled name as __gnu_test::<anonymous>::S defined here.\n+extern const std::type_info& pr103240_private_S;\n+}\n+\n+const std::type_info& private_S = __gnu_test::pr103240_private_S;\n+const std::type_info& local_S = typeid(__gnu_test::S);\n+const std::type_info& local_T = typeid(__gnu_test::T);\n+\n+int main()\n+{\n+  VERIFY( local_S == local_S );\n+  VERIFY( ! local_S.before(local_S) );\n+\n+  VERIFY( local_S != local_T );\n+  VERIFY( local_S.before(local_T) || local_T.before(local_S) );\n+\n+  VERIFY( local_S != private_S );\n+  // PR libstdc++/103240\n+  VERIFY( local_S.before(private_S) || private_S.before(local_S) );\n+}"}, {"sha": "8c10534c5115f3b5d215156f9e72748ab53967cf", "filename": "libstdc++-v3/testsuite/util/testsuite_shared.cc", "status": "modified", "additions": 12, "deletions": 0, "changes": 12, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/054bf99841aad3869c70643b2ba2d9f85770c980/libstdc%2B%2B-v3%2Ftestsuite%2Futil%2Ftestsuite_shared.cc", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/054bf99841aad3869c70643b2ba2d9f85770c980/libstdc%2B%2B-v3%2Ftestsuite%2Futil%2Ftestsuite_shared.cc", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libstdc%2B%2B-v3%2Ftestsuite%2Futil%2Ftestsuite_shared.cc?ref=054bf99841aad3869c70643b2ba2d9f85770c980", "patch": "@@ -23,6 +23,9 @@\n #include <map>\n #include <ext/mt_allocator.h>\n #include <bits/functexcept.h>\n+#if __cpp_rtti\n+# include <typeinfo>\n+#endif\n \n namespace __gnu_test\n {\n@@ -130,4 +133,13 @@ try_function_random_fail()\n   }\n #endif\n \n+#if __cpp_rtti\n+// PR libstdc++/103240\n+namespace\n+{\n+  struct S { };\n+}\n+const std::type_info& pr103240_private_S = typeid(S);\n+#endif\n+\n } // end namepace __gnu_test"}]}