{"sha": "e666a0a22a5c11b5bb894a75b73b6b7f3e364e4d", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6ZTY2NmEwYTIyYTVjMTFiNWJiODk0YTc1YjczYjZiN2YzZTM2NGU0ZA==", "commit": {"author": {"name": "liuhongt", "email": "hongtao.liu@intel.com", "date": "2021-09-18T02:49:54Z"}, "committer": {"name": "liuhongt", "email": "hongtao.liu@intel.com", "date": "2021-09-18T07:52:20Z"}, "message": "Fix ICE in pass_rpad.\n\nBesides conversion instructions, pass_rpad also handles scalar\nsqrt/rsqrt/rcp/round instructions, while r12-3614 should only want to\nhandle conversion instructions, so fix it.\n\ngcc/ChangeLog:\n\n\t* config/i386/i386-features.c (remove_partial_avx_dependency):\n\tRestrict TARGET_USE_VECTOR_FP_CONVERTS and\n\tTARGET_USE_VECTOR_CONVERTS to conversion instructions only.", "tree": {"sha": "5050093cd353f0421a574ef31bccebfc5337d8bf", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/5050093cd353f0421a574ef31bccebfc5337d8bf"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/e666a0a22a5c11b5bb894a75b73b6b7f3e364e4d", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/e666a0a22a5c11b5bb894a75b73b6b7f3e364e4d", "html_url": "https://github.com/Rust-GCC/gccrs/commit/e666a0a22a5c11b5bb894a75b73b6b7f3e364e4d", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/e666a0a22a5c11b5bb894a75b73b6b7f3e364e4d/comments", "author": {"login": "algebra84", "id": 22926165, "node_id": "MDQ6VXNlcjIyOTI2MTY1", "avatar_url": "https://avatars.githubusercontent.com/u/22926165?v=4", "gravatar_id": "", "url": "https://api.github.com/users/algebra84", "html_url": "https://github.com/algebra84", "followers_url": "https://api.github.com/users/algebra84/followers", "following_url": "https://api.github.com/users/algebra84/following{/other_user}", "gists_url": "https://api.github.com/users/algebra84/gists{/gist_id}", "starred_url": "https://api.github.com/users/algebra84/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/algebra84/subscriptions", "organizations_url": "https://api.github.com/users/algebra84/orgs", "repos_url": "https://api.github.com/users/algebra84/repos", "events_url": "https://api.github.com/users/algebra84/events{/privacy}", "received_events_url": "https://api.github.com/users/algebra84/received_events", "type": "User", "site_admin": false}, "committer": {"login": "algebra84", "id": 22926165, "node_id": "MDQ6VXNlcjIyOTI2MTY1", "avatar_url": "https://avatars.githubusercontent.com/u/22926165?v=4", "gravatar_id": "", "url": "https://api.github.com/users/algebra84", "html_url": "https://github.com/algebra84", "followers_url": "https://api.github.com/users/algebra84/followers", "following_url": "https://api.github.com/users/algebra84/following{/other_user}", "gists_url": "https://api.github.com/users/algebra84/gists{/gist_id}", "starred_url": "https://api.github.com/users/algebra84/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/algebra84/subscriptions", "organizations_url": "https://api.github.com/users/algebra84/orgs", "repos_url": "https://api.github.com/users/algebra84/repos", "events_url": "https://api.github.com/users/algebra84/events{/privacy}", "received_events_url": "https://api.github.com/users/algebra84/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "e5597f2ad55219092929dc12ea15e1edba06df18", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/e5597f2ad55219092929dc12ea15e1edba06df18", "html_url": "https://github.com/Rust-GCC/gccrs/commit/e5597f2ad55219092929dc12ea15e1edba06df18"}], "stats": {"total": 27, "additions": 22, "deletions": 5}, "files": [{"sha": "14f816feee0079af324c2ced65e2979729890a94", "filename": "gcc/config/i386/i386-features.c", "status": "modified", "additions": 22, "deletions": 5, "changes": 27, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/e666a0a22a5c11b5bb894a75b73b6b7f3e364e4d/gcc%2Fconfig%2Fi386%2Fi386-features.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/e666a0a22a5c11b5bb894a75b73b6b7f3e364e4d/gcc%2Fconfig%2Fi386%2Fi386-features.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fconfig%2Fi386%2Fi386-features.c?ref=e666a0a22a5c11b5bb894a75b73b6b7f3e364e4d", "patch": "@@ -2165,7 +2165,7 @@ make_pass_insert_endbr_and_patchable_area (gcc::context *ctxt)\n }\n \n /* At entry of the nearest common dominator for basic blocks with\n-   conversions, generate a single\n+   conversions/rcp/sqrt/rsqrt/round, generate a single\n \tvxorps %xmmN, %xmmN, %xmmN\n    for all\n \tvcvtss2sd  op, %xmmN, %xmmX\n@@ -2211,13 +2211,27 @@ remove_partial_avx_dependency (void)\n \t    continue;\n \n \t  /* Convert PARTIAL_XMM_UPDATE_TRUE insns, DF -> SF, SF -> DF,\n-\t     SI -> SF, SI -> DF, DI -> SF, DI -> DF, to vec_dup and\n-\t     vec_merge with subreg.  */\n+\t     SI -> SF, SI -> DF, DI -> SF, DI -> DF, sqrt, rsqrt, rcp,\n+\t     round, to vec_dup and vec_merge with subreg.  */\n \t  rtx src = SET_SRC (set);\n \t  rtx dest = SET_DEST (set);\n \t  machine_mode dest_mode = GET_MODE (dest);\n-\t  machine_mode src_mode = GET_MODE (XEXP (src, 0));\n+\t  bool convert_p = false;\n+\t  switch (GET_CODE (src))\n+\t    {\n+\t    case FLOAT:\n+\t    case FLOAT_EXTEND:\n+\t    case FLOAT_TRUNCATE:\n+\t    case UNSIGNED_FLOAT:\n+\t      convert_p = true;\n+\t      break;\n+\t    default:\n+\t      break;\n+\t    }\n \n+\t  /* Only hanlde conversion here.  */\n+\t  machine_mode src_mode\n+\t    = convert_p ? GET_MODE (XEXP (src, 0)) : VOIDmode;\n \t  switch (src_mode)\n \t    {\n \t    case E_SFmode:\n@@ -2232,8 +2246,11 @@ remove_partial_avx_dependency (void)\n \t\t  || !TARGET_SSE_PARTIAL_REG_CONVERTS_DEPENDENCY)\n \t\tcontinue;\n \t      break;\n-\t    default:\n+\t    case E_VOIDmode:\n+\t      gcc_assert (!convert_p);\n \t      break;\n+\t    default:\n+\t      gcc_unreachable ();\n \t    }\n \n \t  if (!v4sf_const0)"}]}