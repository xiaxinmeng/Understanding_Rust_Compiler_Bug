{"sha": "00fa28d1b471a3aca9994a21363ce3f58b6bd2f2", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6MDBmYTI4ZDFiNDcxYTNhY2E5OTk0YTIxMzYzY2UzZjU4YjZiZDJmMg==", "commit": {"author": {"name": "Jan Hubicka", "email": "hubicka@ucw.cz", "date": "2017-11-16T11:04:40Z"}, "committer": {"name": "Jan Hubicka", "email": "hubicka@gcc.gnu.org", "date": "2017-11-16T11:04:40Z"}, "message": "tree-vect-loop-manip.c (vect_do_peeling): Do not use scale_bbs_frequencies_int.\n\n\n\t* tree-vect-loop-manip.c (vect_do_peeling): Do not use\n\tscale_bbs_frequencies_int.\n\nFrom-SVN: r254810", "tree": {"sha": "892d02bc9b02055ad24a0e16a752fe60721e5dcc", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/892d02bc9b02055ad24a0e16a752fe60721e5dcc"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/00fa28d1b471a3aca9994a21363ce3f58b6bd2f2", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/00fa28d1b471a3aca9994a21363ce3f58b6bd2f2", "html_url": "https://github.com/Rust-GCC/gccrs/commit/00fa28d1b471a3aca9994a21363ce3f58b6bd2f2", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/00fa28d1b471a3aca9994a21363ce3f58b6bd2f2/comments", "author": null, "committer": null, "parents": [{"sha": "6786ba1aaa8533e286b8d8f333cc9d75cf5c9989", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/6786ba1aaa8533e286b8d8f333cc9d75cf5c9989", "html_url": "https://github.com/Rust-GCC/gccrs/commit/6786ba1aaa8533e286b8d8f333cc9d75cf5c9989"}], "stats": {"total": 15, "additions": 11, "deletions": 4}, "files": [{"sha": "872ca086308ed29b830dd500139107b64856c27e", "filename": "gcc/ChangeLog", "status": "modified", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/00fa28d1b471a3aca9994a21363ce3f58b6bd2f2/gcc%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/00fa28d1b471a3aca9994a21363ce3f58b6bd2f2/gcc%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2FChangeLog?ref=00fa28d1b471a3aca9994a21363ce3f58b6bd2f2", "patch": "@@ -1,3 +1,8 @@\n+2017-11-14  Jan Hubicka  <hubicka@ucw.cz>\n+\n+\t* tree-vect-loop-manip.c (vect_do_peeling): Do not use\n+\tscale_bbs_frequencies_int.\n+\n 2017-11-14  Jan Hubicka  <hubicka@ucw.cz>\n \n \t* final.c (compute_alignments): Use counts rather than frequencies."}, {"sha": "1df591e69f21674bd410aa7295476dd4b778d27a", "filename": "gcc/tree-vect-loop-manip.c", "status": "modified", "additions": 6, "deletions": 4, "changes": 10, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/00fa28d1b471a3aca9994a21363ce3f58b6bd2f2/gcc%2Ftree-vect-loop-manip.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/00fa28d1b471a3aca9994a21363ce3f58b6bd2f2/gcc%2Ftree-vect-loop-manip.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftree-vect-loop-manip.c?ref=00fa28d1b471a3aca9994a21363ce3f58b6bd2f2", "patch": "@@ -1844,14 +1844,16 @@ vect_do_peeling (loop_vec_info loop_vinfo, tree niters, tree nitersm1,\n \t  /* Simply propagate profile info from guard_bb to guard_to which is\n \t     a merge point of control flow.  */\n \t  guard_to->count = guard_bb->count;\n+\n \t  /* Scale probability of epilog loop back.\n \t     FIXME: We should avoid scaling down and back up.  Profile may\n \t     get lost if we scale down to 0.  */\n-\t  int scale_up = REG_BR_PROB_BASE * REG_BR_PROB_BASE\n-\t\t\t / prob_vector.to_reg_br_prob_base ();\n \t  basic_block *bbs = get_loop_body (epilog);\n-\t  scale_bbs_frequencies_int (bbs, epilog->num_nodes, scale_up,\n-\t\t\t\t     REG_BR_PROB_BASE);\n+\t  for (unsigned int i = 0; i < epilog->num_nodes; i++)\n+\t    bbs[i]->count = bbs[i]->count.apply_scale\n+\t\t\t\t (bbs[i]->count,\n+\t\t\t\t  bbs[i]->count.apply_probability\n+\t\t\t\t    (prob_vector));\n \t  free (bbs);\n \t}\n "}]}