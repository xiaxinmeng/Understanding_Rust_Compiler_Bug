{"sha": "f8c677776617ab91826af1d950b00d853eaff622", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6ZjhjNjc3Nzc2NjE3YWI5MTgyNmFmMWQ5NTBiMDBkODUzZWFmZjYyMg==", "commit": {"author": {"name": "Segher Boessenkool", "email": "segher@kernel.crashing.org", "date": "2021-01-19T23:43:56Z"}, "committer": {"name": "Segher Boessenkool", "email": "segher@kernel.crashing.org", "date": "2021-01-20T19:00:22Z"}, "message": "rs6000: Fix rs6000_emit_le_vsx_store (PR98549)\n\nOne of the advantages of LRA is that you can create new pseudos from it\njust fine.  The code in rs6000_emit_le_vsx_store was not aware of this.\nThis patch changes that, in the process fixing PR98549 (where it is\nshown that we do call rs6000_emit_le_vsx_store during LRA, which we\nused to assert can not happen).\n\n2021-01-20  Segher Boessenkool  <segher@kernel.crashing.org>\n\n\t* config/rs6000/rs6000.c (rs6000_emit_le_vsx_store): Change assert.\n\tAdjust comment.  Simplify code.", "tree": {"sha": "06992df7007f3ff6f87669ca6a1f3803d87df017", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/06992df7007f3ff6f87669ca6a1f3803d87df017"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/f8c677776617ab91826af1d950b00d853eaff622", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/f8c677776617ab91826af1d950b00d853eaff622", "html_url": "https://github.com/Rust-GCC/gccrs/commit/f8c677776617ab91826af1d950b00d853eaff622", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/f8c677776617ab91826af1d950b00d853eaff622/comments", "author": {"login": "segher", "id": 417629, "node_id": "MDQ6VXNlcjQxNzYyOQ==", "avatar_url": "https://avatars.githubusercontent.com/u/417629?v=4", "gravatar_id": "", "url": "https://api.github.com/users/segher", "html_url": "https://github.com/segher", "followers_url": "https://api.github.com/users/segher/followers", "following_url": "https://api.github.com/users/segher/following{/other_user}", "gists_url": "https://api.github.com/users/segher/gists{/gist_id}", "starred_url": "https://api.github.com/users/segher/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/segher/subscriptions", "organizations_url": "https://api.github.com/users/segher/orgs", "repos_url": "https://api.github.com/users/segher/repos", "events_url": "https://api.github.com/users/segher/events{/privacy}", "received_events_url": "https://api.github.com/users/segher/received_events", "type": "User", "site_admin": false}, "committer": {"login": "segher", "id": 417629, "node_id": "MDQ6VXNlcjQxNzYyOQ==", "avatar_url": "https://avatars.githubusercontent.com/u/417629?v=4", "gravatar_id": "", "url": "https://api.github.com/users/segher", "html_url": "https://github.com/segher", "followers_url": "https://api.github.com/users/segher/followers", "following_url": "https://api.github.com/users/segher/following{/other_user}", "gists_url": "https://api.github.com/users/segher/gists{/gist_id}", "starred_url": "https://api.github.com/users/segher/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/segher/subscriptions", "organizations_url": "https://api.github.com/users/segher/orgs", "repos_url": "https://api.github.com/users/segher/repos", "events_url": "https://api.github.com/users/segher/events{/privacy}", "received_events_url": "https://api.github.com/users/segher/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "27c792895bd809115c1f70672835b7fdff74d318", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/27c792895bd809115c1f70672835b7fdff74d318", "html_url": "https://github.com/Rust-GCC/gccrs/commit/27c792895bd809115c1f70672835b7fdff74d318"}], "stats": {"total": 8, "additions": 3, "deletions": 5}, "files": [{"sha": "57bf7f7828e45d6b17b3eac24978ce9875d469e9", "filename": "gcc/config/rs6000/rs6000.c", "status": "modified", "additions": 3, "deletions": 5, "changes": 8, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/f8c677776617ab91826af1d950b00d853eaff622/gcc%2Fconfig%2Frs6000%2Frs6000.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/f8c677776617ab91826af1d950b00d853eaff622/gcc%2Fconfig%2Frs6000%2Frs6000.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fconfig%2Frs6000%2Frs6000.c?ref=f8c677776617ab91826af1d950b00d853eaff622", "patch": "@@ -9932,10 +9932,8 @@ rs6000_emit_le_vsx_load (rtx dest, rtx source, machine_mode mode)\n void\n rs6000_emit_le_vsx_store (rtx dest, rtx source, machine_mode mode)\n {\n-  /* This should never be called during or after LRA, because it does\n-     not re-permute the source register.  It is intended only for use\n-     during expand.  */\n-  gcc_assert (!lra_in_progress && !reload_completed);\n+  /* This should never be called after LRA.  */\n+  gcc_assert (can_create_pseudo_p ());\n \n   /* Use V2DImode to do swaps of types with 128-bit scalar parts (TImode,\n      V1TImode).  */\n@@ -9946,7 +9944,7 @@ rs6000_emit_le_vsx_store (rtx dest, rtx source, machine_mode mode)\n       source = gen_lowpart (V2DImode, source);\n     }\n \n-  rtx tmp = can_create_pseudo_p () ? gen_reg_rtx_and_attrs (source) : source;\n+  rtx tmp = gen_reg_rtx_and_attrs (source);\n   rs6000_emit_le_vsx_permute (tmp, source, mode);\n   rs6000_emit_le_vsx_permute (dest, tmp, mode);\n }"}]}