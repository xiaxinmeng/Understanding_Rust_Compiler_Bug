{"sha": "7dbca013b298ba0506921f40622ae17fe9442b99", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6N2RiY2EwMTNiMjk4YmEwNTA2OTIxZjQwNjIyYWUxN2ZlOTQ0MmI5OQ==", "commit": {"author": {"name": "Daniel Berlin", "email": "dberlin@dberlin.org", "date": "2006-01-19T00:28:07Z"}, "committer": {"name": "Daniel Berlin", "email": "dberlin@gcc.gnu.org", "date": "2006-01-19T00:28:07Z"}, "message": "ipa-reference.c (check_operand): Allow FUNCTION_DECL.\n\n2006-01-18  Daniel Berlin  <dberlin@dberlin.org>\n\n\t* ipa-reference.c (check_operand):  Allow FUNCTION_DECL.\n\t(look_for_address_of): Ditto.\n\t(ipa_init): Walk the function decls.\n\t(static_execute): Don't set readonly on FUNCTION_DECL's.\n\nFrom-SVN: r109932", "tree": {"sha": "316d8ff0fe2b1de172204faffd748aa6915642e6", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/316d8ff0fe2b1de172204faffd748aa6915642e6"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/7dbca013b298ba0506921f40622ae17fe9442b99", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/7dbca013b298ba0506921f40622ae17fe9442b99", "html_url": "https://github.com/Rust-GCC/gccrs/commit/7dbca013b298ba0506921f40622ae17fe9442b99", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/7dbca013b298ba0506921f40622ae17fe9442b99/comments", "author": {"login": "dberlin", "id": 324715, "node_id": "MDQ6VXNlcjMyNDcxNQ==", "avatar_url": "https://avatars.githubusercontent.com/u/324715?v=4", "gravatar_id": "", "url": "https://api.github.com/users/dberlin", "html_url": "https://github.com/dberlin", "followers_url": "https://api.github.com/users/dberlin/followers", "following_url": "https://api.github.com/users/dberlin/following{/other_user}", "gists_url": "https://api.github.com/users/dberlin/gists{/gist_id}", "starred_url": "https://api.github.com/users/dberlin/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/dberlin/subscriptions", "organizations_url": "https://api.github.com/users/dberlin/orgs", "repos_url": "https://api.github.com/users/dberlin/repos", "events_url": "https://api.github.com/users/dberlin/events{/privacy}", "received_events_url": "https://api.github.com/users/dberlin/received_events", "type": "User", "site_admin": false}, "committer": null, "parents": [{"sha": "db08384acf11b58c48b27fc236905fc609a46180", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/db08384acf11b58c48b27fc236905fc609a46180", "html_url": "https://github.com/Rust-GCC/gccrs/commit/db08384acf11b58c48b27fc236905fc609a46180"}], "stats": {"total": 21, "additions": 19, "deletions": 2}, "files": [{"sha": "642a89154ce6d5bfb37ccb182259cb4075b7a205", "filename": "gcc/ChangeLog", "status": "modified", "additions": 7, "deletions": 0, "changes": 7, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/7dbca013b298ba0506921f40622ae17fe9442b99/gcc%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/7dbca013b298ba0506921f40622ae17fe9442b99/gcc%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2FChangeLog?ref=7dbca013b298ba0506921f40622ae17fe9442b99", "patch": "@@ -1,3 +1,10 @@\n+2006-01-18  Daniel Berlin  <dberlin@dberlin.org>\n+\n+\t* ipa-reference.c (check_operand):  Allow FUNCTION_DECL.\n+\t(look_for_address_of): Ditto.\n+\t(ipa_init): Walk the function decls.\n+\t(static_execute): Don't set readonly on FUNCTION_DECL's.\n+\n 2006-01-18  Roger Sayle  <roger@eyesopen.com>\n \n \t* config/i386/i386.md (shift spliter): Fix a a typo in the splitter"}, {"sha": "fe2f807d3e8b9f4d05993ddef1b3d3ca6b4548ab", "filename": "gcc/ipa-reference.c", "status": "modified", "additions": 12, "deletions": 2, "changes": 14, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/7dbca013b298ba0506921f40622ae17fe9442b99/gcc%2Fipa-reference.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/7dbca013b298ba0506921f40622ae17fe9442b99/gcc%2Fipa-reference.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fipa-reference.c?ref=7dbca013b298ba0506921f40622ae17fe9442b99", "patch": "@@ -286,7 +286,7 @@ check_operand (ipa_reference_local_vars_info_t local,\n {\n   if (!t) return;\n \n-  if ((TREE_CODE (t) == VAR_DECL)\n+  if ((TREE_CODE (t) == VAR_DECL || TREE_CODE (t) == FUNCTION_DECL)\n       && (has_proper_scope_for_analysis (t))) \n     {\n       if (checking_write)\n@@ -343,7 +343,7 @@ look_for_address_of (tree t)\n   if (TREE_CODE (t) == ADDR_EXPR)\n     {\n       tree x = get_base_var (t);\n-      if (TREE_CODE (x) == VAR_DECL) \n+      if (TREE_CODE (x) == VAR_DECL || TREE_CODE (x) == FUNCTION_DECL) \n \tif (has_proper_scope_for_analysis (x))\n \t  bitmap_set_bit (module_statics_escape, DECL_UID (x));\n     }\n@@ -741,6 +741,7 @@ merge_callee_local_info (struct cgraph_node *target,\n static void \n ipa_init (void) \n {\n+  struct cgraph_node *node;\n   memory_identifier_string = build_string(7, \"memory\");\n \n   reference_vars_to_consider =\n@@ -751,6 +752,10 @@ ipa_init (void)\n   module_statics_written = BITMAP_ALLOC (&ipa_obstack);\n   all_module_statics = BITMAP_ALLOC (&ipa_obstack);\n \n+  /* This will add NODE->DECL to the splay trees.  */\n+  for (node = cgraph_nodes; node; node = node->next)\n+    has_proper_scope_for_analysis (node->decl);\n+\n   /* There are some shared nodes, in particular the initializers on\n      static declarations.  We do not need to scan them more than once\n      since all we would be interested in are the addressof\n@@ -964,6 +969,11 @@ static_execute (void)\n       {\n \ttree var = get_static_decl (index);\n \n+\t/* Readonly on a function decl is very different from the\n+\t   variable.  */\n+\tif (TREE_CODE (var) == FUNCTION_DECL)\n+\t  continue;\n+\n \t/* Ignore variables in named sections - changing TREE_READONLY\n \t   changes the section flags, potentially causing conflicts with\n \t   other variables in the same named section.  */"}]}