{"sha": "20d6556070b6952b34cb92622fd61f051216bc37", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6MjBkNjU1NjA3MGI2OTUyYjM0Y2I5MjYyMmZkNjFmMDUxMjE2YmMzNw==", "commit": {"author": {"name": "Mark Mitchell", "email": "mark@codesourcery.com", "date": "2003-08-29T23:51:17Z"}, "committer": {"name": "Mark Mitchell", "email": "mmitchel@gcc.gnu.org", "date": "2003-08-29T23:51:17Z"}, "message": "re PR c++/11928 (c++ typedef handling)\n\n\tPR c++/11928\n\t* search.c (add_conversions): Avoid adding two conversion\n\toperators for the same type.\n\n\tPR c++/11928\n\t* g++.dg/inherit/conv1.C: New test.\n\nFrom-SVN: r70934", "tree": {"sha": "c0a5cc434b3f8c8eb3b9c6539cd08a9664d7c38e", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/c0a5cc434b3f8c8eb3b9c6539cd08a9664d7c38e"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/20d6556070b6952b34cb92622fd61f051216bc37", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/20d6556070b6952b34cb92622fd61f051216bc37", "html_url": "https://github.com/Rust-GCC/gccrs/commit/20d6556070b6952b34cb92622fd61f051216bc37", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/20d6556070b6952b34cb92622fd61f051216bc37/comments", "author": null, "committer": null, "parents": [{"sha": "4985cde3ef44391a43fd95c0972bf72c86e127cb", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/4985cde3ef44391a43fd95c0972bf72c86e127cb", "html_url": "https://github.com/Rust-GCC/gccrs/commit/4985cde3ef44391a43fd95c0972bf72c86e127cb"}], "stats": {"total": 57, "additions": 55, "deletions": 2}, "files": [{"sha": "fc18cc116f8e272daf4d91e3ef4bba2c05087b4b", "filename": "gcc/cp/ChangeLog", "status": "modified", "additions": 6, "deletions": 0, "changes": 6, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/20d6556070b6952b34cb92622fd61f051216bc37/gcc%2Fcp%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/20d6556070b6952b34cb92622fd61f051216bc37/gcc%2Fcp%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fcp%2FChangeLog?ref=20d6556070b6952b34cb92622fd61f051216bc37", "patch": "@@ -1,3 +1,9 @@\n+2003-08-29  Mark Mitchell  <mark@codesourcery.com>\n+\n+\tPR c++/11928\n+\t* search.c (add_conversions): Avoid adding two conversion\n+\toperators for the same type.\n+\n 2003-08-29  Richard Henderson  <rth@redhat.com>\n \t    Jason Merrill <jason@redhat.com>\n "}, {"sha": "3751c006d131b72fce019ae9fc7b81ee5d25c641", "filename": "gcc/cp/search.c", "status": "modified", "additions": 21, "deletions": 2, "changes": 23, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/20d6556070b6952b34cb92622fd61f051216bc37/gcc%2Fcp%2Fsearch.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/20d6556070b6952b34cb92622fd61f051216bc37/gcc%2Fcp%2Fsearch.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fcp%2Fsearch.c?ref=20d6556070b6952b34cb92622fd61f051216bc37", "patch": "@@ -2323,8 +2323,27 @@ add_conversions (tree binfo, void *data)\n       /* Make sure we don't already have this conversion.  */\n       if (! IDENTIFIER_MARKED (name))\n \t{\n-\t  *conversions = tree_cons (binfo, tmp, *conversions);\n-\t  IDENTIFIER_MARKED (name) = 1;\n+\t  tree t;\n+\n+\t  /* Make sure that we do not already have a conversion\n+\t     operator for this type.  Merely checking the NAME is not\n+\t     enough because two conversion operators to the same type\n+\t     may not have the same NAME.  */\n+\t  for (t = *conversions; t; t = TREE_CHAIN (t))\n+\t    {\n+\t      tree fn;\n+\t      for (fn = TREE_VALUE (t); fn; fn = OVL_NEXT (fn))\n+\t\tif (same_type_p (TREE_TYPE (name),\n+\t\t\t\t DECL_CONV_FN_TYPE (OVL_CURRENT (fn))))\n+\t\t  break;\n+\t      if (fn)\n+\t\tbreak;\n+\t    }\n+\t  if (!t)\n+\t    {\n+\t      *conversions = tree_cons (binfo, tmp, *conversions);\n+\t      IDENTIFIER_MARKED (name) = 1;\n+\t    }\n \t}\n     }\n   return NULL_TREE;"}, {"sha": "c057ea2644a4b72316bb8ea9a54030b93dced732", "filename": "gcc/testsuite/ChangeLog", "status": "modified", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/20d6556070b6952b34cb92622fd61f051216bc37/gcc%2Ftestsuite%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/20d6556070b6952b34cb92622fd61f051216bc37/gcc%2Ftestsuite%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2FChangeLog?ref=20d6556070b6952b34cb92622fd61f051216bc37", "patch": "@@ -1,3 +1,8 @@\n+2003-08-29  Mark Mitchell  <mark@codesourcery.com>\n+\n+\tPR c++/11928\n+\t* g++.dg/inherit/conv1.C: New test.\n+\n 2003-08-29  Mark Mitchell  <mark@codesourcery.com>\n \n \tPR c++/6196"}, {"sha": "e16c489a23544b6805f0f40f1dca9b122f02e10a", "filename": "gcc/testsuite/g++.dg/inherit/conv1.C", "status": "added", "additions": 23, "deletions": 0, "changes": 23, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/20d6556070b6952b34cb92622fd61f051216bc37/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Finherit%2Fconv1.C", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/20d6556070b6952b34cb92622fd61f051216bc37/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Finherit%2Fconv1.C", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Finherit%2Fconv1.C?ref=20d6556070b6952b34cb92622fd61f051216bc37", "patch": "@@ -0,0 +1,23 @@\n+typedef struct _A A;\n+typedef struct _A B;\n+\n+void some_function(B *b);\n+\n+class AClass {\n+\n+public:\n+  operator A*() { return 0;}\n+\n+};\n+\n+class BClass :public AClass {\n+\n+public:\n+  operator B*() { return 0;}\n+\n+};\n+\n+int main(int argc, char **argv) {\n+  BClass b;\n+  some_function(b);\n+}"}]}