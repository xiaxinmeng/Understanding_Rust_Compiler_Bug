{"sha": "d36405344205c58beb1947719345ec80fdc00a34", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6ZDM2NDA1MzQ0MjA1YzU4YmViMTk0NzcxOTM0NWVjODBmZGMwMGEzNA==", "commit": {"author": {"name": "Jeff Law", "email": "law@redhat.com", "date": "2019-05-01T17:33:32Z"}, "committer": {"name": "Jeff Law", "email": "law@gcc.gnu.org", "date": "2019-05-01T17:33:32Z"}, "message": "re PR tree-optimization/88797 (Unneeded branch added when function is inlined (function runs faster if not inlined))\n\n\tPR tree-optimization/88797\n\t* gimple-ssa-split-paths (is_feasible_trace): Reject cases where the\n\tPHI feeds a conditional on the RHS of an assignment.\n\n\tPR tree-optimization/88797\n\t* g++.dg/tree-ssa/pr88797.C: New test.\n\nFrom-SVN: r270775", "tree": {"sha": "dff72bf9a187ac1e44917ac2df46e9c995abc933", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/dff72bf9a187ac1e44917ac2df46e9c995abc933"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/d36405344205c58beb1947719345ec80fdc00a34", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/d36405344205c58beb1947719345ec80fdc00a34", "html_url": "https://github.com/Rust-GCC/gccrs/commit/d36405344205c58beb1947719345ec80fdc00a34", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/d36405344205c58beb1947719345ec80fdc00a34/comments", "author": null, "committer": null, "parents": [{"sha": "7ee7c293558326468f84720dca35767632f7b662", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/7ee7c293558326468f84720dca35767632f7b662", "html_url": "https://github.com/Rust-GCC/gccrs/commit/7ee7c293558326468f84720dca35767632f7b662"}], "stats": {"total": 35, "additions": 33, "deletions": 2}, "files": [{"sha": "7f6ccd98c1117689a5c5483f12532ddf4ab122f2", "filename": "gcc/ChangeLog", "status": "modified", "additions": 6, "deletions": 0, "changes": 6, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/d36405344205c58beb1947719345ec80fdc00a34/gcc%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/d36405344205c58beb1947719345ec80fdc00a34/gcc%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2FChangeLog?ref=d36405344205c58beb1947719345ec80fdc00a34", "patch": "@@ -1,3 +1,9 @@\n+2019-05-01  Jeff Law  <law@redhat.com>\n+\n+\tPR tree-optimization/88797\n+\t* gimple-ssa-split-paths (is_feasible_trace): Reject cases where the\n+\tPHI feeds a conditional on the RHS of an assignment.\n+\n 2019-04-30  Andrew Waterman  <andrew@sifive.com>\n \t    Jim Wilson  <jimw@sifive.com>\n "}, {"sha": "5bf45eeac28c9e3b124337802287d8933b67655e", "filename": "gcc/gimple-ssa-split-paths.c", "status": "modified", "additions": 6, "deletions": 2, "changes": 8, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/d36405344205c58beb1947719345ec80fdc00a34/gcc%2Fgimple-ssa-split-paths.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/d36405344205c58beb1947719345ec80fdc00a34/gcc%2Fgimple-ssa-split-paths.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fgimple-ssa-split-paths.c?ref=d36405344205c58beb1947719345ec80fdc00a34", "patch": "@@ -264,8 +264,12 @@ is_feasible_trace (basic_block bb)\n \t  if (is_gimple_debug (stmt))\n \t    continue;\n \t  /* If there's a use in the joiner this might be a CSE/DCE\n-\t     opportunity.  */\n-\t  if (gimple_bb (stmt) == bb)\n+\t     opportunity, but not if the use is in a conditional\n+\t     which makes this a likely if-conversion candidate.  */\n+\t  if (gimple_bb (stmt) == bb\n+\t      && (!is_gimple_assign (stmt)\n+\t\t  || (TREE_CODE_CLASS (gimple_assign_rhs_code (stmt))\n+\t\t      != tcc_comparison)))\n \t    {\n \t      found_useful_phi = true;\n \t      break;"}, {"sha": "3620c23f82ed708134412fd3da3cbf81af8ffc5d", "filename": "gcc/testsuite/ChangeLog", "status": "modified", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/d36405344205c58beb1947719345ec80fdc00a34/gcc%2Ftestsuite%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/d36405344205c58beb1947719345ec80fdc00a34/gcc%2Ftestsuite%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2FChangeLog?ref=d36405344205c58beb1947719345ec80fdc00a34", "patch": "@@ -1,3 +1,8 @@\n+2019-05-01  Jeff Law  <law@redhat.com>\n+\n+\tPR tree-optimization/90037\n+\t* g++.dg/tree-ssa/pr88797.C: New test.\n+\n 2019-05-01  Nathan Sidwell  <nathan@acm.org>\n \n \t* g++.dg/cpp0x/decltype9.C: Adjust expected diagnostics."}, {"sha": "75391d6c049a7bcb5afc0bacc1d4101b65429cd1", "filename": "gcc/testsuite/g++.dg/tree-ssa/pr88797.C", "status": "added", "additions": 16, "deletions": 0, "changes": 16, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/d36405344205c58beb1947719345ec80fdc00a34/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Ftree-ssa%2Fpr88797.C", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/d36405344205c58beb1947719345ec80fdc00a34/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Ftree-ssa%2Fpr88797.C", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Ftree-ssa%2Fpr88797.C?ref=d36405344205c58beb1947719345ec80fdc00a34", "patch": "@@ -0,0 +1,16 @@\n+/* { dg-do compile } */\n+/* { dg-options \"-O3 -fdump-tree-split-paths-details\" } */\n+\n+\n+void use(unsigned);\n+bool f(unsigned x, unsigned y) {\n+    return x < 1111 + (y <= 2222);\n+}\n+void test_f(unsigned x, unsigned y) {\n+    for (unsigned i = 0; i < 3333; ++i)\n+        use(f(x++, y++));\n+}\n+\n+/* { dg-final { scan-tree-dump-not \"Duplicating join block\" \"split-paths\" } } */\n+/* { dg-final { scan-tree-dump-times \"Block . is a join that does not expose\" 1 \"split-paths\" } } */\n+"}]}