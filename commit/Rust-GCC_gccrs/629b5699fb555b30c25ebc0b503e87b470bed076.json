{"sha": "629b5699fb555b30c25ebc0b503e87b470bed076", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6NjI5YjU2OTlmYjU1NWIzMGMyNWViYzBiNTAzZTg3YjQ3MGJlZDA3Ng==", "commit": {"author": {"name": "Cherry Mui", "email": "cherryyz@google.com", "date": "2021-08-06T15:03:47Z"}, "committer": {"name": "Ian Lance Taylor", "email": "iant@golang.org", "date": "2021-08-06T19:37:48Z"}, "message": "compiler: make escape analysis more strict about runtime calls\n\nFollowing the previous CL, in the escape analysis list all the\nexpected runtime calls, and fail if an unexpected one is seen.\n\nReviewed-on: https://go-review.googlesource.com/c/gofrontend/+/340397", "tree": {"sha": "c01805b416d7e3e00edd29a4b08a5ee6a5ebf4dc", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/c01805b416d7e3e00edd29a4b08a5ee6a5ebf4dc"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/629b5699fb555b30c25ebc0b503e87b470bed076", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/629b5699fb555b30c25ebc0b503e87b470bed076", "html_url": "https://github.com/Rust-GCC/gccrs/commit/629b5699fb555b30c25ebc0b503e87b470bed076", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/629b5699fb555b30c25ebc0b503e87b470bed076/comments", "author": {"login": "cherrymui", "id": 14119929, "node_id": "MDQ6VXNlcjE0MTE5OTI5", "avatar_url": "https://avatars.githubusercontent.com/u/14119929?v=4", "gravatar_id": "", "url": "https://api.github.com/users/cherrymui", "html_url": "https://github.com/cherrymui", "followers_url": "https://api.github.com/users/cherrymui/followers", "following_url": "https://api.github.com/users/cherrymui/following{/other_user}", "gists_url": "https://api.github.com/users/cherrymui/gists{/gist_id}", "starred_url": "https://api.github.com/users/cherrymui/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/cherrymui/subscriptions", "organizations_url": "https://api.github.com/users/cherrymui/orgs", "repos_url": "https://api.github.com/users/cherrymui/repos", "events_url": "https://api.github.com/users/cherrymui/events{/privacy}", "received_events_url": "https://api.github.com/users/cherrymui/received_events", "type": "User", "site_admin": false}, "committer": {"login": "ianlancetaylor", "id": 3194333, "node_id": "MDQ6VXNlcjMxOTQzMzM=", "avatar_url": "https://avatars.githubusercontent.com/u/3194333?v=4", "gravatar_id": "", "url": "https://api.github.com/users/ianlancetaylor", "html_url": "https://github.com/ianlancetaylor", "followers_url": "https://api.github.com/users/ianlancetaylor/followers", "following_url": "https://api.github.com/users/ianlancetaylor/following{/other_user}", "gists_url": "https://api.github.com/users/ianlancetaylor/gists{/gist_id}", "starred_url": "https://api.github.com/users/ianlancetaylor/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/ianlancetaylor/subscriptions", "organizations_url": "https://api.github.com/users/ianlancetaylor/orgs", "repos_url": "https://api.github.com/users/ianlancetaylor/repos", "events_url": "https://api.github.com/users/ianlancetaylor/events{/privacy}", "received_events_url": "https://api.github.com/users/ianlancetaylor/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "aff75af3b50f8c039ed6fbfa3f313ba45d44f6e6", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/aff75af3b50f8c039ed6fbfa3f313ba45d44f6e6", "html_url": "https://github.com/Rust-GCC/gccrs/commit/aff75af3b50f8c039ed6fbfa3f313ba45d44f6e6"}], "stats": {"total": 49, "additions": 47, "deletions": 2}, "files": [{"sha": "9ed527f7eb495885817ba1856336b16fc691efc8", "filename": "gcc/go/gofrontend/MERGE", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/629b5699fb555b30c25ebc0b503e87b470bed076/gcc%2Fgo%2Fgofrontend%2FMERGE", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/629b5699fb555b30c25ebc0b503e87b470bed076/gcc%2Fgo%2Fgofrontend%2FMERGE", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fgo%2Fgofrontend%2FMERGE?ref=629b5699fb555b30c25ebc0b503e87b470bed076", "patch": "@@ -1,4 +1,4 @@\n-32590102c464679f845667b5554e1dcce2549ad2\n+747f3a2d78c073e9b03dd81914d0edb7ddc5be14\n \n The first line of this file holds the git revision number of the last\n merge done from the gofrontend repository."}, {"sha": "6da29edc419f6d40d8690fac9d8c1c079600ec64", "filename": "gcc/go/gofrontend/escape.cc", "status": "modified", "additions": 46, "deletions": 1, "changes": 47, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/629b5699fb555b30c25ebc0b503e87b470bed076/gcc%2Fgo%2Fgofrontend%2Fescape.cc", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/629b5699fb555b30c25ebc0b503e87b470bed076/gcc%2Fgo%2Fgofrontend%2Fescape.cc", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fgo%2Fgofrontend%2Fescape.cc?ref=629b5699fb555b30c25ebc0b503e87b470bed076", "patch": "@@ -1646,6 +1646,7 @@ Escape_analysis_assign::expression(Expression** pexpr)\n \t      case Runtime::MAKECHAN:\n \t      case Runtime::MAKECHAN64:\n \t      case Runtime::MAKEMAP:\n+\t      case Runtime::MAKEMAP64:\n \t      case Runtime::MAKESLICE:\n \t      case Runtime::MAKESLICE64:\n                 this->context_->track(n);\n@@ -1705,8 +1706,52 @@ Escape_analysis_assign::expression(Expression** pexpr)\n                 }\n                 break;\n \n+              case Runtime::MEMCMP:\n+              case Runtime::DECODERUNE:\n+              case Runtime::INTSTRING:\n+              case Runtime::MAKEMAP_SMALL:\n+              case Runtime::MAPACCESS1:\n+              case Runtime::MAPACCESS1_FAST32:\n+              case Runtime::MAPACCESS1_FAST64:\n+              case Runtime::MAPACCESS1_FASTSTR:\n+              case Runtime::MAPACCESS1_FAT:\n+              case Runtime::MAPACCESS2:\n+              case Runtime::MAPACCESS2_FAST32:\n+              case Runtime::MAPACCESS2_FAST64:\n+              case Runtime::MAPACCESS2_FASTSTR:\n+              case Runtime::MAPACCESS2_FAT:\n+              case Runtime::MAPASSIGN_FAST32:\n+              case Runtime::MAPASSIGN_FAST64:\n+              case Runtime::MAPITERINIT:\n+              case Runtime::MAPITERNEXT:\n+              case Runtime::MAPCLEAR:\n+              case Runtime::CHANRECV2:\n+              case Runtime::SELECTGO:\n+              case Runtime::SELECTNBSEND:\n+              case Runtime::SELECTNBRECV:\n+              case Runtime::BLOCK:\n+              case Runtime::IFACET2IP:\n+              case Runtime::EQTYPE:\n+              case Runtime::MEMCLRHASPTR:\n+              case Runtime::FIELDTRACK:\n+              case Runtime::BUILTIN_MEMSET:\n+              case Runtime::PANIC_SLICE_CONVERT:\n+                // these do not escape.\n+                break;\n+\n+              case Runtime::IFACEE2E2:\n+              case Runtime::IFACEI2E2:\n+              case Runtime::IFACEE2I2:\n+              case Runtime::IFACEI2I2:\n+              case Runtime::IFACEE2T2P:\n+              case Runtime::IFACEI2T2P:\n+                // handled in ::assign.\n+                break;\n+\n \t      default:\n-\t\tbreak;\n+                // should not see other runtime calls. they are not yet\n+                // lowered to runtime calls at this point.\n+                go_unreachable();\n \t      }\n \t  }\n         else"}]}