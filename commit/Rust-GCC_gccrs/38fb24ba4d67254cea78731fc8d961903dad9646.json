{"sha": "38fb24ba4d67254cea78731fc8d961903dad9646", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6MzhmYjI0YmE0ZDY3MjU0Y2VhNzg3MzFmYzhkOTYxOTAzZGFkOTY0Ng==", "commit": {"author": {"name": "Jonathan Wakely", "email": "jwakely@redhat.com", "date": "2021-08-02T14:52:41Z"}, "committer": {"name": "Jonathan Wakely", "email": "jwakely@redhat.com", "date": "2021-08-02T15:33:44Z"}, "message": "libstdc++: Fix filesystem::temp_directory_path [PR101709]\n\nSigned-off-by: Jonathan Wakely <jwakely@redhat.com>\n\nlibstdc++-v3/ChangeLog:\n\n\tPR libstdc++/101709\n\t* src/filesystem/ops-common.h (get_temp_directory_from_env):\n\tAdd error_code parameter.\n\t* src/c++17/fs_ops.cc (fs::temp_directory_path): Pass error_code\n\targument to get_temp_directory_from_env and check it.\n\t* src/filesystem/ops.cc (fs::temp_directory_path): Likewise.", "tree": {"sha": "ecfe14aa82cb148abde2bc5e562d8e4571d9cd81", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/ecfe14aa82cb148abde2bc5e562d8e4571d9cd81"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/38fb24ba4d67254cea78731fc8d961903dad9646", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/38fb24ba4d67254cea78731fc8d961903dad9646", "html_url": "https://github.com/Rust-GCC/gccrs/commit/38fb24ba4d67254cea78731fc8d961903dad9646", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/38fb24ba4d67254cea78731fc8d961903dad9646/comments", "author": {"login": "jwakely", "id": 1254480, "node_id": "MDQ6VXNlcjEyNTQ0ODA=", "avatar_url": "https://avatars.githubusercontent.com/u/1254480?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jwakely", "html_url": "https://github.com/jwakely", "followers_url": "https://api.github.com/users/jwakely/followers", "following_url": "https://api.github.com/users/jwakely/following{/other_user}", "gists_url": "https://api.github.com/users/jwakely/gists{/gist_id}", "starred_url": "https://api.github.com/users/jwakely/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jwakely/subscriptions", "organizations_url": "https://api.github.com/users/jwakely/orgs", "repos_url": "https://api.github.com/users/jwakely/repos", "events_url": "https://api.github.com/users/jwakely/events{/privacy}", "received_events_url": "https://api.github.com/users/jwakely/received_events", "type": "User", "site_admin": false}, "committer": {"login": "jwakely", "id": 1254480, "node_id": "MDQ6VXNlcjEyNTQ0ODA=", "avatar_url": "https://avatars.githubusercontent.com/u/1254480?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jwakely", "html_url": "https://github.com/jwakely", "followers_url": "https://api.github.com/users/jwakely/followers", "following_url": "https://api.github.com/users/jwakely/following{/other_user}", "gists_url": "https://api.github.com/users/jwakely/gists{/gist_id}", "starred_url": "https://api.github.com/users/jwakely/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jwakely/subscriptions", "organizations_url": "https://api.github.com/users/jwakely/orgs", "repos_url": "https://api.github.com/users/jwakely/repos", "events_url": "https://api.github.com/users/jwakely/events{/privacy}", "received_events_url": "https://api.github.com/users/jwakely/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "2aaf69133f39f2409baa146e755a6c52eee4452f", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/2aaf69133f39f2409baa146e755a6c52eee4452f", "html_url": "https://github.com/Rust-GCC/gccrs/commit/2aaf69133f39f2409baa146e755a6c52eee4452f"}], "stats": {"total": 21, "additions": 13, "deletions": 8}, "files": [{"sha": "0e2d952673fd04ed4edb5adf6d639708ff1e0491", "filename": "libstdc++-v3/src/c++17/fs_ops.cc", "status": "modified", "additions": 3, "deletions": 1, "changes": 4, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/38fb24ba4d67254cea78731fc8d961903dad9646/libstdc%2B%2B-v3%2Fsrc%2Fc%2B%2B17%2Ffs_ops.cc", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/38fb24ba4d67254cea78731fc8d961903dad9646/libstdc%2B%2B-v3%2Fsrc%2Fc%2B%2B17%2Ffs_ops.cc", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libstdc%2B%2B-v3%2Fsrc%2Fc%2B%2B17%2Ffs_ops.cc?ref=38fb24ba4d67254cea78731fc8d961903dad9646", "patch": "@@ -1604,7 +1604,9 @@ fs::temp_directory_path()\n fs::path\n fs::temp_directory_path(error_code& ec)\n {\n-  path p = fs::get_temp_directory_from_env();\n+  path p = fs::get_temp_directory_from_env(ec);\n+  if (ec)\n+    return p;\n   auto st = status(p, ec);\n   if (ec)\n     p.clear();"}, {"sha": "304e5b263fb77881ff7bc5f415649db9333111ff", "filename": "libstdc++-v3/src/filesystem/ops-common.h", "status": "modified", "additions": 7, "deletions": 6, "changes": 13, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/38fb24ba4d67254cea78731fc8d961903dad9646/libstdc%2B%2B-v3%2Fsrc%2Ffilesystem%2Fops-common.h", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/38fb24ba4d67254cea78731fc8d961903dad9646/libstdc%2B%2B-v3%2Fsrc%2Ffilesystem%2Fops-common.h", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libstdc%2B%2B-v3%2Fsrc%2Ffilesystem%2Fops-common.h?ref=38fb24ba4d67254cea78731fc8d961903dad9646", "patch": "@@ -572,7 +572,7 @@ _GLIBCXX_BEGIN_NAMESPACE_FILESYSTEM\n   // Caller must check that the path is an accessible directory.\n #ifdef _GLIBCXX_FILESYSTEM_IS_WINDOWS\n   inline wstring\n-  get_temp_directory_from_env()\n+  get_temp_directory_from_env(error_code& ec)\n   {\n     unsigned len = 1024;\n     std::wstring buf;\n@@ -583,17 +583,18 @@ _GLIBCXX_BEGIN_NAMESPACE_FILESYSTEM\n       } while (len > buf.size());\n \n     if (len == 0)\n-      {\n-\tec.assign((int)GetLastError(), std::system_category());\n-\treturn p;\n-      }\n+      ec.assign((int)GetLastError(), std::system_category());\n+    else\n+      ec.clear();\n+\n     buf.resize(len);\n     return buf;\n   }\n #else\n   inline const char*\n-  get_temp_directory_from_env() noexcept\n+  get_temp_directory_from_env(error_code& ec) noexcept\n   {\n+    ec.clear();\n     for (auto env : { \"TMPDIR\", \"TMP\", \"TEMP\", \"TEMPDIR\" })\n       {\n #if _GLIBCXX_HAVE_SECURE_GETENV"}, {"sha": "b0a0f15e98fd7cc3290d46cb2d2ee5f5981653c4", "filename": "libstdc++-v3/src/filesystem/ops.cc", "status": "modified", "additions": 3, "deletions": 1, "changes": 4, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/38fb24ba4d67254cea78731fc8d961903dad9646/libstdc%2B%2B-v3%2Fsrc%2Ffilesystem%2Fops.cc", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/38fb24ba4d67254cea78731fc8d961903dad9646/libstdc%2B%2B-v3%2Fsrc%2Ffilesystem%2Fops.cc", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libstdc%2B%2B-v3%2Fsrc%2Ffilesystem%2Fops.cc?ref=38fb24ba4d67254cea78731fc8d961903dad9646", "patch": "@@ -1302,7 +1302,9 @@ fs::temp_directory_path()\n fs::path\n fs::temp_directory_path(error_code& ec)\n {\n-  path p = fs::get_temp_directory_from_env();\n+  path p = fs::get_temp_directory_from_env(ec);\n+  if (ec)\n+    return p;\n   auto st = status(p, ec);\n   if (ec)\n     p.clear();"}]}