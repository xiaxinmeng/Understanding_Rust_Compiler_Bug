{"sha": "99176a91bde0a657dc3109894e6790cee0585909", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6OTkxNzZhOTFiZGUwYTY1N2RjMzEwOTg5NGU2NzkwY2VlMDU4NTkwOQ==", "commit": {"author": {"name": "Aldy Hernandez", "email": "aldyh@redhat.com", "date": "2004-11-10T01:08:22Z"}, "committer": {"name": "Aldy Hernandez", "email": "aldyh@gcc.gnu.org", "date": "2004-11-10T01:08:22Z"}, "message": "rs6000.md (fix_truncdfsi2): Handle e500 doubles.\n\n\t* config/rs6000/rs6000.md (fix_truncdfsi2): Handle e500\n\tdoubles.\n\t(floatunssidf2): Same.\n\t(floatsidf2): Same.\n\t(\"extendsfdf2\"): New expander.\n\t(*extendsfdf2_fpr): Rename.\n\t(*truncdfsf2_fpr): Same.\n\t(*negdf2_fpr): Same.\n\t(*absdf2_fpr): Same.\n\t(*nabsdf2_fpr): Same.\n\t(*adddf3_fpr): Same.\n\t(*subdf3_fpr): Same.\n\t(*muldf3_fpr): Same.\n\t(*divdf3_fpr): Same.\n\n\t* config/rs6000/spe.md (\"spe_extendsfdf2\"): Remove FIXME comment.\n\t(\"spe_fix_truncdfsi2\"): Same.\n\t(spe_floatunssidf2): Same.\n\t(spe_floatsidf2): Same.\n\nFrom-SVN: r90379", "tree": {"sha": "942a84acfea27dac8780f81d4e317ed03c64dbed", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/942a84acfea27dac8780f81d4e317ed03c64dbed"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/99176a91bde0a657dc3109894e6790cee0585909", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/99176a91bde0a657dc3109894e6790cee0585909", "html_url": "https://github.com/Rust-GCC/gccrs/commit/99176a91bde0a657dc3109894e6790cee0585909", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/99176a91bde0a657dc3109894e6790cee0585909/comments", "author": {"login": "aldyh", "id": 12937877, "node_id": "MDQ6VXNlcjEyOTM3ODc3", "avatar_url": "https://avatars.githubusercontent.com/u/12937877?v=4", "gravatar_id": "", "url": "https://api.github.com/users/aldyh", "html_url": "https://github.com/aldyh", "followers_url": "https://api.github.com/users/aldyh/followers", "following_url": "https://api.github.com/users/aldyh/following{/other_user}", "gists_url": "https://api.github.com/users/aldyh/gists{/gist_id}", "starred_url": "https://api.github.com/users/aldyh/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/aldyh/subscriptions", "organizations_url": "https://api.github.com/users/aldyh/orgs", "repos_url": "https://api.github.com/users/aldyh/repos", "events_url": "https://api.github.com/users/aldyh/events{/privacy}", "received_events_url": "https://api.github.com/users/aldyh/received_events", "type": "User", "site_admin": false}, "committer": null, "parents": [{"sha": "df2ae6e216985a38155d389089b3f0b6d74e9aa4", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/df2ae6e216985a38155d389089b3f0b6d74e9aa4", "html_url": "https://github.com/Rust-GCC/gccrs/commit/df2ae6e216985a38155d389089b3f0b6d74e9aa4"}], "stats": {"total": 70, "additions": 55, "deletions": 15}, "files": [{"sha": "a1f25feb9bcc3fd9c959915a15d55536a82447be", "filename": "gcc/ChangeLog", "status": "modified", "additions": 22, "deletions": 0, "changes": 22, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/99176a91bde0a657dc3109894e6790cee0585909/gcc%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/99176a91bde0a657dc3109894e6790cee0585909/gcc%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2FChangeLog?ref=99176a91bde0a657dc3109894e6790cee0585909", "patch": "@@ -1,3 +1,25 @@\n+2004-10-22  Aldy Hernandez  <aldyh@redhat.com>\n+\n+\t* config/rs6000/rs6000.md (fix_truncdfsi2): Handle e500\n+\tdoubles.\n+\t(floatunssidf2): Same.\n+\t(floatsidf2): Same.\n+\t(\"extendsfdf2\"): New expander.\n+\t(*extendsfdf2_fpr): Rename.\n+\t(*truncdfsf2_fpr): Same.\n+\t(*negdf2_fpr): Same.\n+\t(*absdf2_fpr): Same.\n+\t(*nabsdf2_fpr): Same.\n+\t(*adddf3_fpr): Same.\n+\t(*subdf3_fpr): Same.\n+\t(*muldf3_fpr): Same.\n+\t(*divdf3_fpr): Same.\n+\n+\t* config/rs6000/spe.md (\"spe_extendsfdf2\"): Remove FIXME comment.\n+\t(\"spe_fix_truncdfsi2\"): Same.\n+\t(spe_floatunssidf2): Same.\n+\t(spe_floatsidf2): Same.\n+\n 2004-11-09  Joseph S. Myers  <joseph@codesourcery.com>\n \n \tPR c/18322"}, {"sha": "99edc3797ed9c9dda01c028b59c552c4715f69d6", "filename": "gcc/config/rs6000/rs6000.md", "status": "modified", "additions": 33, "deletions": 11, "changes": 44, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/99176a91bde0a657dc3109894e6790cee0585909/gcc%2Fconfig%2Frs6000%2Frs6000.md", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/99176a91bde0a657dc3109894e6790cee0585909/gcc%2Fconfig%2Frs6000%2Frs6000.md", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fconfig%2Frs6000%2Frs6000.md?ref=99176a91bde0a657dc3109894e6790cee0585909", "patch": "@@ -4458,7 +4458,13 @@\n ;; this case, we just lose precision that we would have otherwise gotten but\n ;; is not guaranteed.  Perhaps this should be tightened up at some point.\n \n-(define_insn_and_split \"extendsfdf2\"\n+(define_expand \"extendsfdf2\"\n+  [(set (match_operand:DF 0 \"gpc_reg_operand\" \"\")\n+\t(float_extend:DF (match_operand:SF 1 \"gpc_reg_operand\" \"\")))]\n+  \"TARGET_HARD_FLOAT && (TARGET_FPRS || TARGET_E500_DOUBLE)\"\n+  \"\")\n+\n+(define_insn_and_split \"*extendsfdf2_fpr\"\n   [(set (match_operand:DF 0 \"gpc_reg_operand\" \"=f,?f\")\n \t(float_extend:DF (match_operand:SF 1 \"gpc_reg_operand\" \"0,f\")))]\n   \"TARGET_HARD_FLOAT && TARGET_FPRS\"\n@@ -4479,7 +4485,7 @@\n   \"TARGET_HARD_FLOAT && (TARGET_FPRS || TARGET_E500_DOUBLE)\"\n   \"\")\n \n-(define_insn \"fpr_truncdfsf2\"\n+(define_insn \"*truncdfsf2_fpr\"\n   [(set (match_operand:SF 0 \"gpc_reg_operand\" \"=f\")\n \t(float_truncate:SF (match_operand:DF 1 \"gpc_reg_operand\" \"f\")))]\n   \"TARGET_HARD_FLOAT && TARGET_FPRS\"\n@@ -4875,7 +4881,7 @@\n   \"TARGET_HARD_FLOAT && (TARGET_FPRS || TARGET_E500_DOUBLE)\"\n   \"\")\n \n-(define_insn \"fpr_negdf2\"\n+(define_insn \"*negdf2_fpr\"\n   [(set (match_operand:DF 0 \"gpc_reg_operand\" \"=f\")\n \t(neg:DF (match_operand:DF 1 \"gpc_reg_operand\" \"f\")))]\n   \"TARGET_HARD_FLOAT && TARGET_FPRS\"\n@@ -4888,14 +4894,14 @@\n   \"TARGET_HARD_FLOAT && (TARGET_FPRS || TARGET_E500_DOUBLE)\"\n   \"\")\n \n-(define_insn \"fpr_absdf2\"\n+(define_insn \"*absdf2_fpr\"\n   [(set (match_operand:DF 0 \"gpc_reg_operand\" \"=f\")\n \t(abs:DF (match_operand:DF 1 \"gpc_reg_operand\" \"f\")))]\n   \"TARGET_HARD_FLOAT && TARGET_FPRS\"\n   \"fabs %0,%1\"\n   [(set_attr \"type\" \"fp\")])\n \n-(define_insn \"fpr_nabsdf2\"\n+(define_insn \"*nabsdf2_fpr\"\n   [(set (match_operand:DF 0 \"gpc_reg_operand\" \"=f\")\n \t(neg:DF (abs:DF (match_operand:DF 1 \"gpc_reg_operand\" \"f\"))))]\n   \"TARGET_HARD_FLOAT && TARGET_FPRS\"\n@@ -4909,7 +4915,7 @@\n   \"TARGET_HARD_FLOAT && (TARGET_FPRS || TARGET_E500_DOUBLE)\"\n   \"\")\n \n-(define_insn \"fpr_adddf3\"\n+(define_insn \"*adddf3_fpr\"\n   [(set (match_operand:DF 0 \"gpc_reg_operand\" \"=f\")\n \t(plus:DF (match_operand:DF 1 \"gpc_reg_operand\" \"%f\")\n \t\t (match_operand:DF 2 \"gpc_reg_operand\" \"f\")))]\n@@ -4924,7 +4930,7 @@\n   \"TARGET_HARD_FLOAT && (TARGET_FPRS || TARGET_E500_DOUBLE)\"\n   \"\")\n \n-(define_insn \"fpr_subdf3\"\n+(define_insn \"*subdf3_fpr\"\n   [(set (match_operand:DF 0 \"gpc_reg_operand\" \"=f\")\n \t(minus:DF (match_operand:DF 1 \"gpc_reg_operand\" \"f\")\n \t\t  (match_operand:DF 2 \"gpc_reg_operand\" \"f\")))]\n@@ -4939,7 +4945,7 @@\n   \"TARGET_HARD_FLOAT && (TARGET_FPRS || TARGET_E500_DOUBLE)\"\n   \"\")\n \n-(define_insn \"fpr_muldf3\"\n+(define_insn \"*muldf3_fpr\"\n   [(set (match_operand:DF 0 \"gpc_reg_operand\" \"=f\")\n \t(mult:DF (match_operand:DF 1 \"gpc_reg_operand\" \"%f\")\n \t\t (match_operand:DF 2 \"gpc_reg_operand\" \"f\")))]\n@@ -4954,7 +4960,7 @@\n   \"TARGET_HARD_FLOAT && (TARGET_FPRS || TARGET_E500_DOUBLE)\"\n   \"\")\n \n-(define_insn \"fpr_divdf3\"\n+(define_insn \"*divdf3_fpr\"\n   [(set (match_operand:DF 0 \"gpc_reg_operand\" \"=f\")\n \t(div:DF (match_operand:DF 1 \"gpc_reg_operand\" \"f\")\n \t\t(match_operand:DF 2 \"gpc_reg_operand\" \"f\")))]\n@@ -5125,6 +5131,11 @@\n   \"TARGET_HARD_FLOAT && TARGET_FPRS\"\n   \"\n {\n+  if (TARGET_E500_DOUBLE)\n+    {\n+      emit_insn (gen_spe_floatsidf2 (operands[0], operands[1]));\n+      DONE;\n+    }\n   if (TARGET_POWERPC64)\n     {\n       rtx mem = assign_stack_temp (DImode, GET_MODE_SIZE (DImode), 0);\n@@ -5204,9 +5215,14 @@\n \t      (use (match_dup 3))\n \t      (clobber (match_dup 4))\n \t      (clobber (match_dup 5))])]\n-  \"TARGET_HARD_FLOAT && TARGET_FPRS\"\n+  \"TARGET_HARD_FLOAT && (TARGET_FPRS || TARGET_E500_DOUBLE)\"\n   \"\n {\n+  if (TARGET_E500_DOUBLE)\n+    {\n+      emit_insn (gen_spe_floatunssidf2 (operands[0], operands[1]));\n+      DONE;\n+    }\n   if (TARGET_POWERPC64)\n     {\n       rtx mem = assign_stack_temp (DImode, GET_MODE_SIZE (DImode), 0);\n@@ -5273,9 +5289,15 @@\n \t\t   (fix:SI (match_operand:DF 1 \"gpc_reg_operand\" \"\")))\n \t      (clobber (match_dup 2))\n \t      (clobber (match_dup 3))])]\n-  \"(TARGET_POWER2 || TARGET_POWERPC) && TARGET_HARD_FLOAT && TARGET_FPRS\"\n+  \"(TARGET_POWER2 || TARGET_POWERPC)\n+   && TARGET_HARD_FLOAT && (TARGET_FPRS || TARGET_E500_DOUBLE)\"\n   \"\n {\n+  if (TARGET_E500_DOUBLE)\n+    {\n+     emit_insn (gen_spe_fix_truncdfsi2 (operands[0], operands[1]));\n+     DONE;\n+    }\n   operands[2] = gen_reg_rtx (DImode);\n   operands[3] = assign_stack_temp (DImode, GET_MODE_SIZE (DImode), 0);\n }\")"}, {"sha": "6e40371f0cac4a870ee4b70c5cdb47f55b01f7a6", "filename": "gcc/config/rs6000/spe.md", "status": "modified", "additions": 0, "deletions": 4, "changes": 4, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/99176a91bde0a657dc3109894e6790cee0585909/gcc%2Fconfig%2Frs6000%2Fspe.md", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/99176a91bde0a657dc3109894e6790cee0585909/gcc%2Fconfig%2Frs6000%2Fspe.md", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fconfig%2Frs6000%2Fspe.md?ref=99176a91bde0a657dc3109894e6790cee0585909", "patch": "@@ -93,7 +93,6 @@\n   \"efdctuiz %0,%1\"\n   [(set_attr \"type\" \"fp\")])\n \n-;; FIXME: fix expander.\n (define_insn \"spe_extendsfdf2\"\n   [(set (match_operand:DF 0 \"gpc_reg_operand\" \"=r\")\n \t(float_extend:DF (match_operand:SF 1 \"gpc_reg_operand\" \"r\")))]\n@@ -115,7 +114,6 @@\n   \"efsctsiz %0,%1\"\n   [(set_attr \"type\" \"fp\")])\n \n-;; FIXME: fix expander.\n (define_insn \"spe_fix_truncdfsi2\"\n   [(set (match_operand:SI 0 \"gpc_reg_operand\" \"=r\")\n \t(fix:SI (match_operand:DF 1 \"gpc_reg_operand\" \"r\")))]\n@@ -130,7 +128,6 @@\n   \"efscfui %0,%1\"\n   [(set_attr \"type\" \"fp\")])\n \n-;; FIXME: fix expander.\n (define_insn \"spe_floatunssidf2\"\n   [(set (match_operand:DF 0 \"gpc_reg_operand\" \"=r\")\n         (unsigned_float:DF (match_operand:SI 1 \"gpc_reg_operand\" \"r\")))]\n@@ -145,7 +142,6 @@\n   \"efscfsi %0,%1\"\n   [(set_attr \"type\" \"fp\")])\n \n-;; FIXME: fix expander.\n (define_insn \"spe_floatsidf2\"\n   [(set (match_operand:DF 0 \"gpc_reg_operand\" \"=r\")\n \t(float:DF (match_operand:SI 1 \"gpc_reg_operand\" \"r\")))]"}]}