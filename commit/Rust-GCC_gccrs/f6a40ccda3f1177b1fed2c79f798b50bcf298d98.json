{"sha": "f6a40ccda3f1177b1fed2c79f798b50bcf298d98", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6ZjZhNDBjY2RhM2YxMTc3YjFmZWQyYzc5Zjc5OGI1MGJjZjI5OGQ5OA==", "commit": {"author": {"name": "Mikael Morin", "email": "mikael@gcc.gnu.org", "date": "2011-11-25T20:18:21Z"}, "committer": {"name": "Mikael Morin", "email": "mikael@gcc.gnu.org", "date": "2011-11-25T20:18:21Z"}, "message": "re PR fortran/51250 (Bug with SUM(,dim,mask))\n\nfortran/\n\tPR fortran/51250\n\tPR fortran/43829\n\t* trans-array.c (gfc_trans_create_temp_array): Get dimension from\n\tthe right gfc_ss struct.\n\ntestsuite/\n\tPR fortran/51250\n\tPR fortran/43829\n\t* gfortran.dg/inline_sum_3.f90: New test.\n\nFrom-SVN: r181730", "tree": {"sha": "56b1c81ce6bff0117fad9c0e617304d4814f6478", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/56b1c81ce6bff0117fad9c0e617304d4814f6478"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/f6a40ccda3f1177b1fed2c79f798b50bcf298d98", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/f6a40ccda3f1177b1fed2c79f798b50bcf298d98", "html_url": "https://github.com/Rust-GCC/gccrs/commit/f6a40ccda3f1177b1fed2c79f798b50bcf298d98", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/f6a40ccda3f1177b1fed2c79f798b50bcf298d98/comments", "author": null, "committer": null, "parents": [{"sha": "9e08718a4ae1f5cafc67e890c5e1638454ec395f", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/9e08718a4ae1f5cafc67e890c5e1638454ec395f", "html_url": "https://github.com/Rust-GCC/gccrs/commit/9e08718a4ae1f5cafc67e890c5e1638454ec395f"}], "stats": {"total": 46, "additions": 45, "deletions": 1}, "files": [{"sha": "d669f5aedf6c52e9051d6f38bb40195c2d6a1fb2", "filename": "gcc/fortran/ChangeLog", "status": "modified", "additions": 7, "deletions": 0, "changes": 7, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/f6a40ccda3f1177b1fed2c79f798b50bcf298d98/gcc%2Ffortran%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/f6a40ccda3f1177b1fed2c79f798b50bcf298d98/gcc%2Ffortran%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ffortran%2FChangeLog?ref=f6a40ccda3f1177b1fed2c79f798b50bcf298d98", "patch": "@@ -1,3 +1,10 @@\n+2011-11-25  Mikael Morin  <mikael@gcc.gnu.org>\n+\n+\tPR fortran/51250\n+\tPR fortran/43829\n+\t* trans-array.c (gfc_trans_create_temp_array): Get dimension from\n+\tthe right gfc_ss struct.\n+\n 2011-11-25  Tobias Burnus  <burnus@net-b.de>\n \n \tPR fortran/50408"}, {"sha": "943503a4274f89608022d3edf0366e90d6861527", "filename": "gcc/fortran/trans-array.c", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/f6a40ccda3f1177b1fed2c79f798b50bcf298d98/gcc%2Ffortran%2Ftrans-array.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/f6a40ccda3f1177b1fed2c79f798b50bcf298d98/gcc%2Ffortran%2Ftrans-array.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ffortran%2Ftrans-array.c?ref=f6a40ccda3f1177b1fed2c79f798b50bcf298d98", "patch": "@@ -1087,7 +1087,7 @@ gfc_trans_create_temp_array (stmtblock_t * pre, stmtblock_t * post, gfc_ss * ss,\n     for (s = ss; s; s = s->parent)\n       for (n = 0; n < s->loop->dimen; n++)\n \t{\n-\t  dim = get_scalarizer_dim_for_array_dim (ss, ss->dim[n]);\n+\t  dim = get_scalarizer_dim_for_array_dim (ss, s->dim[n]);\n \n \t  /* For a callee allocated array express the loop bounds in terms\n \t     of the descriptor fields.  */"}, {"sha": "eafeb9e363e3dc3845b7275e84790345a8099370", "filename": "gcc/testsuite/ChangeLog", "status": "modified", "additions": 6, "deletions": 0, "changes": 6, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/f6a40ccda3f1177b1fed2c79f798b50bcf298d98/gcc%2Ftestsuite%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/f6a40ccda3f1177b1fed2c79f798b50bcf298d98/gcc%2Ftestsuite%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2FChangeLog?ref=f6a40ccda3f1177b1fed2c79f798b50bcf298d98", "patch": "@@ -1,3 +1,9 @@\n+2011-11-25  Mikael Morin  <mikael@gcc.gnu.org>\n+\n+\tPR fortran/51250\n+\tPR fortran/43829\n+\t* gfortran.dg/inline_sum_3.f90: New test.\n+\n 2011-11-25  Uros Bizjak  <ubizjak@gmail.com>\n \n \tPR testsuite/51258"}, {"sha": "6858228aaded64fd2a74810dbef95227b66004f6", "filename": "gcc/testsuite/gfortran.dg/inline_sum_3.f90", "status": "added", "additions": 31, "deletions": 0, "changes": 31, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/f6a40ccda3f1177b1fed2c79f798b50bcf298d98/gcc%2Ftestsuite%2Fgfortran.dg%2Finline_sum_3.f90", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/f6a40ccda3f1177b1fed2c79f798b50bcf298d98/gcc%2Ftestsuite%2Fgfortran.dg%2Finline_sum_3.f90", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgfortran.dg%2Finline_sum_3.f90?ref=f6a40ccda3f1177b1fed2c79f798b50bcf298d98", "patch": "@@ -0,0 +1,31 @@\n+! { dg-do run }\n+!\n+! PR fortran/51250\n+! Wrong loop shape for SUM when arguments are library-allocated arrays.\n+!\n+! Original testcase provided by Harald Anlauf <anlauf@gmx.de>\n+\n+program gfcbug115\n+  implicit none\n+  integer :: n_obstype = 2\n+  integer :: nboxes = 1\n+  integer :: nprocs = 1\n+  integer :: nbox, j\n+  integer, allocatable :: nbx(:,:), pes(:)\n+\n+  allocate (pes(nboxes))\n+  allocate (nbx(n_obstype,nboxes))\n+  nbx(:,:) = 1\n+  do j = 1, nboxes\n+     pes(j) = modulo (j-1, nprocs)\n+  end do\n+  if (any(nbx /= 1)) call abort\n+  do j = 0, nprocs-1\n+     if (.not. all(spread (pes==j,dim=1,ncopies=n_obstype))) call abort\n+     ! The two following tests used to fail\n+     if (any(shape(sum(nbx,dim=2,mask=spread (pes==j,dim=1,ncopies=n_obstype))) &\n+             /= (/ 2 /))) call abort\n+     if (any(sum (nbx,dim=2,mask=spread (pes==j,dim=1,ncopies=n_obstype)) &\n+             /= (/ 1, 1 /))) call abort\n+  end do\n+end program gfcbug115"}]}