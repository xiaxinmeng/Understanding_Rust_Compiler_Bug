{"sha": "bc162b0e6f9af9b03441e0e2b85ba0a98e4e5314", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6YmMxNjJiMGU2ZjlhZjliMDM0NDFlMGUyYjg1YmEwYTk4ZTRlNTMxNA==", "commit": {"author": {"name": "Indu Bhagat", "email": "indu.bhagat@oracle.com", "date": "2018-09-26T22:29:54Z"}, "committer": {"name": "Qing Zhao", "email": "qinzhao@gcc.gnu.org", "date": "2018-09-26T22:29:54Z"}, "message": "re PR gcov-profile/86957 (gcc should warn about missing profiles for a compilation unit or a new function with -fprofile-use)\n\n2018-09-26  Indu Bhagat  <indu.bhagat@oracle.com>\n\n\tPR gcov-profile/86957\n\t* common.opt: New warning option -Wmissing-profile.\n\t* coverage.c (get_coverage_counts): Add warning for missing .gcda file.\n\t* doc/invoke.texi: Document -Wmissing-profile.\n\nFrom-SVN: r264657", "tree": {"sha": "55efbf771f6510f27e17ff5967320a448be1a27a", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/55efbf771f6510f27e17ff5967320a448be1a27a"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/bc162b0e6f9af9b03441e0e2b85ba0a98e4e5314", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/bc162b0e6f9af9b03441e0e2b85ba0a98e4e5314", "html_url": "https://github.com/Rust-GCC/gccrs/commit/bc162b0e6f9af9b03441e0e2b85ba0a98e4e5314", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/bc162b0e6f9af9b03441e0e2b85ba0a98e4e5314/comments", "author": {"login": "ibhagatgnu", "id": 51812649, "node_id": "MDQ6VXNlcjUxODEyNjQ5", "avatar_url": "https://avatars.githubusercontent.com/u/51812649?v=4", "gravatar_id": "", "url": "https://api.github.com/users/ibhagatgnu", "html_url": "https://github.com/ibhagatgnu", "followers_url": "https://api.github.com/users/ibhagatgnu/followers", "following_url": "https://api.github.com/users/ibhagatgnu/following{/other_user}", "gists_url": "https://api.github.com/users/ibhagatgnu/gists{/gist_id}", "starred_url": "https://api.github.com/users/ibhagatgnu/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/ibhagatgnu/subscriptions", "organizations_url": "https://api.github.com/users/ibhagatgnu/orgs", "repos_url": "https://api.github.com/users/ibhagatgnu/repos", "events_url": "https://api.github.com/users/ibhagatgnu/events{/privacy}", "received_events_url": "https://api.github.com/users/ibhagatgnu/received_events", "type": "User", "site_admin": false}, "committer": null, "parents": [{"sha": "8313a7643a2cf5f0037e08f4e6a6d7002aeef8a0", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/8313a7643a2cf5f0037e08f4e6a6d7002aeef8a0", "html_url": "https://github.com/Rust-GCC/gccrs/commit/8313a7643a2cf5f0037e08f4e6a6d7002aeef8a0"}], "stats": {"total": 87, "additions": 70, "deletions": 17}, "files": [{"sha": "54eb0b8d15a957e50c682b8a23823654914e7c91", "filename": "gcc/ChangeLog", "status": "modified", "additions": 7, "deletions": 0, "changes": 7, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/bc162b0e6f9af9b03441e0e2b85ba0a98e4e5314/gcc%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/bc162b0e6f9af9b03441e0e2b85ba0a98e4e5314/gcc%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2FChangeLog?ref=bc162b0e6f9af9b03441e0e2b85ba0a98e4e5314", "patch": "@@ -1,3 +1,10 @@\n+2018-09-26  Indu Bhagat  <indu.bhagat@oracle.com>\n+\n+\tPR gcov-profile/86957\n+\t* common.opt: New warning option -Wmissing-profile.\n+\t* coverage.c (get_coverage_counts): Add warning for missing .gcda file.\n+\t* doc/invoke.texi: Document -Wmissing-profile.\n+\n 2018-09-26  Jim Wilson  <jimw@sifive.com>\n \n \t* config/riscv/riscv.md (subsi3_extended2): Add J constraint."}, {"sha": "53aac194899bcaf856e915e67e8af48089c42d02", "filename": "gcc/common.opt", "status": "modified", "additions": 4, "deletions": 0, "changes": 4, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/bc162b0e6f9af9b03441e0e2b85ba0a98e4e5314/gcc%2Fcommon.opt", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/bc162b0e6f9af9b03441e0e2b85ba0a98e4e5314/gcc%2Fcommon.opt", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fcommon.opt?ref=bc162b0e6f9af9b03441e0e2b85ba0a98e4e5314", "patch": "@@ -811,6 +811,10 @@ Wcoverage-mismatch\n Common Var(warn_coverage_mismatch) Init(1) Warning\n Warn in case profiles in -fprofile-use do not match.\n \n+Wmissing-profile\n+Common Var(warn_missing_profile) Init(1) Warning\n+Warn in case profiles in -fprofile-use do not exist.\n+\n Wvector-operation-performance\n Common Var(warn_vector_operation_performance) Warning\n Warn when a vector operation is compiled outside the SIMD."}, {"sha": "19c696c34930ee3f6f59f69f8a72c3910939b773", "filename": "gcc/coverage.c", "status": "modified", "additions": 26, "deletions": 12, "changes": 38, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/bc162b0e6f9af9b03441e0e2b85ba0a98e4e5314/gcc%2Fcoverage.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/bc162b0e6f9af9b03441e0e2b85ba0a98e4e5314/gcc%2Fcoverage.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fcoverage.c?ref=bc162b0e6f9af9b03441e0e2b85ba0a98e4e5314", "patch": "@@ -304,16 +304,23 @@ get_coverage_counts (unsigned counter, unsigned cfg_checksum,\n     {\n       static int warned = 0;\n \n-      if (!warned++ && dump_enabled_p ())\n+      if (!warned++)\n \t{\n-\t  dump_user_location_t loc\n-\t    = dump_user_location_t::from_location_t (input_location);\n-\t  dump_printf_loc (MSG_OPTIMIZED_LOCATIONS, loc,\n+\t  warning (OPT_Wmissing_profile,\n+\t\t   \"%qs profile count data file not found\",\n+\t\t   da_file_name);\n+\t  if (dump_enabled_p ())\n+\t    {\n+\t      dump_user_location_t loc\n+\t\t= dump_user_location_t::from_location_t (input_location);\n+\t      dump_printf_loc (MSG_OPTIMIZED_LOCATIONS, loc,\n+\t\t\t       \"file %s not found\\n\",\n+\t\t\t       da_file_name);\n+\t      dump_printf (MSG_OPTIMIZED_LOCATIONS,\n \t\t\t   (flag_guess_branch_prob\n-\t\t\t    ? \"file %s not found, execution counts estimated\\n\"\n-\t\t\t    : \"file %s not found, execution counts assumed to \"\n-\t\t\t    \"be zero\\n\"),\n-\t\t\t   da_file_name);\n+\t\t\t    ? \"execution counts estimated\\n\"\n+\t\t\t    : \"execution counts assumed to be zero\\n\"));\n+\t    }\n \t}\n       return NULL;\n     }\n@@ -327,10 +334,17 @@ get_coverage_counts (unsigned counter, unsigned cfg_checksum,\n   elt.ctr = counter;\n   entry = counts_hash->find (&elt);\n   if (!entry)\n-    /* The function was not emitted, or is weak and not chosen in the\n-       final executable.  Silently fail, because there's nothing we\n-       can do about it.  */\n-    return NULL;\n+    {\n+      if (counter == GCOV_COUNTER_ARCS)\n+\twarning_at (DECL_SOURCE_LOCATION (current_function_decl),\n+\t\t    OPT_Wmissing_profile,\n+\t\t    \"profile for function %qD not found in profile data\",\n+\t\t    current_function_decl);\n+      /* The function was not emitted, or is weak and not chosen in the\n+\t final executable.  Silently fail, because there's nothing we\n+\t can do about it.  */\n+      return NULL;\n+    }\n   \n   if (entry->cfg_checksum != cfg_checksum)\n     {"}, {"sha": "5c95f674e0c4ea7c5a064d0474ce684d65dc4e02", "filename": "gcc/doc/invoke.texi", "status": "modified", "additions": 23, "deletions": 5, "changes": 28, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/bc162b0e6f9af9b03441e0e2b85ba0a98e4e5314/gcc%2Fdoc%2Finvoke.texi", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/bc162b0e6f9af9b03441e0e2b85ba0a98e4e5314/gcc%2Fdoc%2Finvoke.texi", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fdoc%2Finvoke.texi?ref=bc162b0e6f9af9b03441e0e2b85ba0a98e4e5314", "patch": "@@ -315,7 +315,7 @@ Objective-C and Objective-C++ Dialects}.\n -Wlogical-op  -Wlogical-not-parentheses  -Wlong-long @gol\n -Wmain  -Wmaybe-uninitialized  -Wmemset-elt-size  -Wmemset-transposed-args @gol\n -Wmisleading-indentation  -Wmissing-attributes -Wmissing-braces @gol\n--Wmissing-field-initializers  -Wmissing-include-dirs @gol\n+-Wmissing-field-initializers  -Wmissing-include-dirs  -Wmissing-profile @gol\n -Wno-multichar  -Wmultistatement-macros  -Wnonnull  -Wnonnull-compare @gol\n -Wnormalized=@r{[}none@r{|}id@r{|}nfc@r{|}nfkc@r{]} @gol\n -Wnull-dereference  -Wodr  -Wno-overflow  -Wopenmp-simd  @gol\n@@ -4215,8 +4215,8 @@ Warn about an invalid memory access that is found by Pointer Bounds Checker\n @opindex Wcoverage-mismatch\n Warn if feedback profiles do not match when using the\n @option{-fprofile-use} option.\n-If a source file is changed between compiling with @option{-fprofile-gen} and\n-with @option{-fprofile-use}, the files with the profile feedback can fail\n+If a source file is changed between compiling with @option{-fprofile-generate}\n+and with @option{-fprofile-use}, the files with the profile feedback can fail\n to match the source file and GCC cannot use the profile feedback\n information.  By default, this warning is enabled and is treated as an\n error.  @option{-Wno-coverage-mismatch} can be used to disable the\n@@ -4820,6 +4820,23 @@ This warning is enabled by @option{-Wall}.\n @opindex Wno-missing-include-dirs\n Warn if a user-supplied include directory does not exist.\n \n+@item -Wmissing-profile\n+@opindex Wmissing-profile\n+@opindex Wno-missing-profile\n+Warn if feedback profiles are missing when using the\n+@option{-fprofile-use} option.\n+This option diagnoses those cases where a new function or a new file is added\n+to the user code between compiling with @option{-fprofile-generate} and with\n+@option{-fprofile-use}, without regenerating the profiles.  In these cases, the\n+profile feedback data files do not contain any profile feedback information for\n+the newly added function or file respectively.  Also, in the case when profile\n+count data (.gcda) files are removed, GCC cannot use any profile feedback\n+information.  In all these cases, warnings are issued to inform the user that a\n+profile generation step is due.  @option{-Wno-missing-profile} can be used to\n+disable the warning.  Ignoring the warning can result in poorly optimized code.\n+Completely disabling the warning is not recommended and should be done only\n+when non-existent profile data is justified.\n+\n @item -Wmultistatement-macros\n @opindex Wmultistatement-macros\n @opindex Wno-multistatement-macros\n@@ -9917,8 +9934,9 @@ Before you can use this option, you must first generate profiling information.\n \n By default, GCC emits an error message if the feedback profiles do not\n match the source code.  This error can be turned into a warning by using\n-@option{-Wcoverage-mismatch}.  Note this may result in poorly optimized\n-code.\n+@option{-Wno-error=coverage-mismatch}.  Note this may result in poorly\n+optimized code.  Additionally, by default, GCC also emits a warning message if\n+the feedback profiles do not exist (See @option{-Wmissing-profile}).\n \n If @var{path} is specified, GCC looks at the @var{path} to find\n the profile feedback data files. See @option{-fprofile-dir}."}, {"sha": "b7dd6734bca29c54af40244b816a27d1d8fe3455", "filename": "gcc/testsuite/ChangeLog", "status": "modified", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/bc162b0e6f9af9b03441e0e2b85ba0a98e4e5314/gcc%2Ftestsuite%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/bc162b0e6f9af9b03441e0e2b85ba0a98e4e5314/gcc%2Ftestsuite%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2FChangeLog?ref=bc162b0e6f9af9b03441e0e2b85ba0a98e4e5314", "patch": "@@ -1,3 +1,8 @@\n+2018-09-26  Indu Bhagat  <indu.bhagat@oracle.com>\n+\n+\tPR gcov-profile/86957\n+\t* gcc.dg/Wmissing-profile.c: New test.\n+\n 2018-09-26  Joseph Myers  <joseph@codesourcery.com>\n \n \tPR c/87390"}, {"sha": "6ef1ac16c98df4dad5de0376826f87a638c5a4a1", "filename": "gcc/testsuite/gcc.dg/Wmissing-profile.c", "status": "added", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/bc162b0e6f9af9b03441e0e2b85ba0a98e4e5314/gcc%2Ftestsuite%2Fgcc.dg%2FWmissing-profile.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/bc162b0e6f9af9b03441e0e2b85ba0a98e4e5314/gcc%2Ftestsuite%2Fgcc.dg%2FWmissing-profile.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgcc.dg%2FWmissing-profile.c?ref=bc162b0e6f9af9b03441e0e2b85ba0a98e4e5314", "patch": "@@ -0,0 +1,5 @@\n+/* PR gcov-profile/86957 */\n+/* { dg-do compile } */\n+/* { dg-options \"-fprofile-use\" } */\n+\n+void foo () { } /* { dg-warning \"profile count data file not found\" } */"}]}