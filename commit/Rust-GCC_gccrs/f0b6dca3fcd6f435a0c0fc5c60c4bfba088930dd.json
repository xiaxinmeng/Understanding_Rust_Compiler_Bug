{"sha": "f0b6dca3fcd6f435a0c0fc5c60c4bfba088930dd", "node_id": "C_kwDOANBUbNoAKGYwYjZkY2EzZmNkNmY0MzVhMGMwZmM1YzYwYzRiZmJhMDg4OTMwZGQ", "commit": {"author": {"name": "bors[bot]", "email": "26634292+bors[bot]@users.noreply.github.com", "date": "2022-04-22T09:31:08Z"}, "committer": {"name": "GitHub", "email": "noreply@github.com", "date": "2022-04-22T09:31:08Z"}, "message": "Merge #1145\n\n1145: Fix generic param redefined bug r=philberty a=philberty\n\nWhen we name-resolve generic parameters their declaration gets inserted in\r\nto the upper-most rib on the stack. Then when this is referenced we lookup\r\nthe relevant binding starting from the uppermost rib this lead to the 2nd\r\nextern item adding the same binding into the same rib which caused this\r\nclash. To fix this we need to have a seperate rib for each declaration\r\nso as reusing the same names don't clash with each other.\r\n\r\nFixes #1131\r\n\n\nCo-authored-by: Philip Herron <philip.herron@embecosm.com>", "tree": {"sha": "b313d302580ea5261a4a65c8ea893ac360201802", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/b313d302580ea5261a4a65c8ea893ac360201802"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/f0b6dca3fcd6f435a0c0fc5c60c4bfba088930dd", "comment_count": 0, "verification": {"verified": true, "reason": "valid", "signature": "-----BEGIN PGP SIGNATURE-----\n\nwsBcBAABCAAQBQJiYnXcCRBK7hj4Ov3rIwAARwcIAFJQBp5UNR75OAl8XSLSvApv\n8miu4ngZZmGaw6HsQCOue95yf6vBffHB1Zo3o/NuVE+zrR2CpFrknu/miiRP8Ioy\nBsFIIx1XnaydNBB+d8oYL39r5fZ5HzDwwayo8KL5yFjtitY5UkAtSKJyZgZIH9M9\nPlODYRSTHL07dCj0G56wQeZwuI8sCA3iPhPFM4drNL5FTZQCNrrWWkJxhHfKIQth\n4l8+09cCwZBk0Ayb9ZmMp4EqT2LdZvwEyfWX75hLRiie4Khqy19xjtcf4MKkBpc5\nR8afT3b0dnMHiZMK1bst+Vco8H3+PRRVmO6tZXOrJsdJw48/8Sq9ngcrPlFUE/c=\n=91SX\n-----END PGP SIGNATURE-----\n", "payload": "tree b313d302580ea5261a4a65c8ea893ac360201802\nparent 243ef0dfe713a9fc8d4d80feb488a58b2639f39f\nparent 0d4fc557c7f1e8e645354d7e40b955a7a03b52d0\nauthor bors[bot] <26634292+bors[bot]@users.noreply.github.com> 1650619868 +0000\ncommitter GitHub <noreply@github.com> 1650619868 +0000\n\nMerge #1145\n\n1145: Fix generic param redefined bug r=philberty a=philberty\n\nWhen we name-resolve generic parameters their declaration gets inserted in\r\nto the upper-most rib on the stack. Then when this is referenced we lookup\r\nthe relevant binding starting from the uppermost rib this lead to the 2nd\r\nextern item adding the same binding into the same rib which caused this\r\nclash. To fix this we need to have a seperate rib for each declaration\r\nso as reusing the same names don't clash with each other.\r\n\r\nFixes #1131\r\n\n\nCo-authored-by: Philip Herron <philip.herron@embecosm.com>\n"}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/f0b6dca3fcd6f435a0c0fc5c60c4bfba088930dd", "html_url": "https://github.com/Rust-GCC/gccrs/commit/f0b6dca3fcd6f435a0c0fc5c60c4bfba088930dd", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/f0b6dca3fcd6f435a0c0fc5c60c4bfba088930dd/comments", "author": {"login": "bors[bot]", "id": 26634292, "node_id": "MDM6Qm90MjY2MzQyOTI=", "avatar_url": "https://avatars.githubusercontent.com/in/1847?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors%5Bbot%5D", "html_url": "https://github.com/apps/bors", "followers_url": "https://api.github.com/users/bors%5Bbot%5D/followers", "following_url": "https://api.github.com/users/bors%5Bbot%5D/following{/other_user}", "gists_url": "https://api.github.com/users/bors%5Bbot%5D/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors%5Bbot%5D/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors%5Bbot%5D/subscriptions", "organizations_url": "https://api.github.com/users/bors%5Bbot%5D/orgs", "repos_url": "https://api.github.com/users/bors%5Bbot%5D/repos", "events_url": "https://api.github.com/users/bors%5Bbot%5D/events{/privacy}", "received_events_url": "https://api.github.com/users/bors%5Bbot%5D/received_events", "type": "Bot", "site_admin": false}, "committer": {"login": "web-flow", "id": 19864447, "node_id": "MDQ6VXNlcjE5ODY0NDQ3", "avatar_url": "https://avatars.githubusercontent.com/u/19864447?v=4", "gravatar_id": "", "url": "https://api.github.com/users/web-flow", "html_url": "https://github.com/web-flow", "followers_url": "https://api.github.com/users/web-flow/followers", "following_url": "https://api.github.com/users/web-flow/following{/other_user}", "gists_url": "https://api.github.com/users/web-flow/gists{/gist_id}", "starred_url": "https://api.github.com/users/web-flow/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/web-flow/subscriptions", "organizations_url": "https://api.github.com/users/web-flow/orgs", "repos_url": "https://api.github.com/users/web-flow/repos", "events_url": "https://api.github.com/users/web-flow/events{/privacy}", "received_events_url": "https://api.github.com/users/web-flow/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "243ef0dfe713a9fc8d4d80feb488a58b2639f39f", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/243ef0dfe713a9fc8d4d80feb488a58b2639f39f", "html_url": "https://github.com/Rust-GCC/gccrs/commit/243ef0dfe713a9fc8d4d80feb488a58b2639f39f"}, {"sha": "0d4fc557c7f1e8e645354d7e40b955a7a03b52d0", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/0d4fc557c7f1e8e645354d7e40b955a7a03b52d0", "html_url": "https://github.com/Rust-GCC/gccrs/commit/0d4fc557c7f1e8e645354d7e40b955a7a03b52d0"}], "stats": {"total": 18, "additions": 18, "deletions": 0}, "files": [{"sha": "f662d5df507dfb8f8c7f226c8f3154a566c4ad2b", "filename": "gcc/rust/resolve/rust-ast-resolve-item.h", "status": "modified", "additions": 14, "deletions": 0, "changes": 14, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/f0b6dca3fcd6f435a0c0fc5c60c4bfba088930dd/gcc%2Frust%2Fresolve%2Frust-ast-resolve-item.h", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/f0b6dca3fcd6f435a0c0fc5c60c4bfba088930dd/gcc%2Frust%2Fresolve%2Frust-ast-resolve-item.h", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Frust%2Fresolve%2Frust-ast-resolve-item.h?ref=f0b6dca3fcd6f435a0c0fc5c60c4bfba088930dd", "patch": "@@ -955,6 +955,15 @@ class ResolveExternItem : public ResolverBase\n \n   void visit (AST::ExternalFunctionItem &function) override\n   {\n+    NodeId scope_node_id = function.get_node_id ();\n+    resolver->get_name_scope ().push (scope_node_id);\n+    resolver->get_type_scope ().push (scope_node_id);\n+    resolver->get_label_scope ().push (scope_node_id);\n+    resolver->push_new_name_rib (resolver->get_name_scope ().peek ());\n+    resolver->push_new_type_rib (resolver->get_type_scope ().peek ());\n+    resolver->push_new_label_rib (resolver->get_type_scope ().peek ());\n+\n+    // resolve the generics\n     if (function.has_generics ())\n       {\n \tfor (auto &generic : function.get_generic_params ())\n@@ -971,6 +980,11 @@ class ResolveExternItem : public ResolverBase\n       {\n \tResolveType::go (param.get_type ().get (), param.get_node_id ());\n       }\n+\n+    // done\n+    resolver->get_name_scope ().pop ();\n+    resolver->get_type_scope ().pop ();\n+    resolver->get_label_scope ().pop ();\n   }\n \n   void visit (AST::ExternalStaticItem &item) override"}, {"sha": "fd158abc700f3026dddbf54becd81aa5a67f43cf", "filename": "gcc/testsuite/rust/compile/issue-1131.rs", "status": "added", "additions": 4, "deletions": 0, "changes": 4, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/f0b6dca3fcd6f435a0c0fc5c60c4bfba088930dd/gcc%2Ftestsuite%2Frust%2Fcompile%2Fissue-1131.rs", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/f0b6dca3fcd6f435a0c0fc5c60c4bfba088930dd/gcc%2Ftestsuite%2Frust%2Fcompile%2Fissue-1131.rs", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Frust%2Fcompile%2Fissue-1131.rs?ref=f0b6dca3fcd6f435a0c0fc5c60c4bfba088930dd", "patch": "@@ -0,0 +1,4 @@\n+extern \"rust-intrinsic\" {\n+    fn size_of<T>() -> usize;\n+    fn offset<T>(dst: *const T, offset: isize) -> *const T;\n+}"}]}