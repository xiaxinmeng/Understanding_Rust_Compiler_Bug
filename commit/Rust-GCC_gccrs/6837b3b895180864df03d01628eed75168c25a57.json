{"sha": "6837b3b895180864df03d01628eed75168c25a57", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6NjgzN2IzYjg5NTE4MDg2NGRmMDNkMDE2MjhlZWQ3NTE2OGMyNWE1Nw==", "commit": {"author": {"name": "Jakub Jelinek", "email": "jakub@redhat.com", "date": "2008-02-15T17:36:43Z"}, "committer": {"name": "Jakub Jelinek", "email": "jakub@gcc.gnu.org", "date": "2008-02-15T17:36:43Z"}, "message": "re PR middle-end/35130 (OpenMP: Private variable passed to subroutine)\n\n\tPR middle-end/35130\n\t* tree-nested.c (convert_call_expr): Put FRAME.* vars into\n\tOMP_CLAUSE_SHARED rather than OMP_CLAUSE_FIRSTPRIVATE clause.\n\n\t* testsuite/libgomp.fortran/pr35130.f90: New test.\n\t* testsuite/libgomp.c/pr35130.c: New test.\n\nFrom-SVN: r132349", "tree": {"sha": "259f85cd6ed7d67f133847ea1613a7e509e0bffb", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/259f85cd6ed7d67f133847ea1613a7e509e0bffb"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/6837b3b895180864df03d01628eed75168c25a57", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/6837b3b895180864df03d01628eed75168c25a57", "html_url": "https://github.com/Rust-GCC/gccrs/commit/6837b3b895180864df03d01628eed75168c25a57", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/6837b3b895180864df03d01628eed75168c25a57/comments", "author": {"login": "jakubjelinek", "id": 9370665, "node_id": "MDQ6VXNlcjkzNzA2NjU=", "avatar_url": "https://avatars.githubusercontent.com/u/9370665?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jakubjelinek", "html_url": "https://github.com/jakubjelinek", "followers_url": "https://api.github.com/users/jakubjelinek/followers", "following_url": "https://api.github.com/users/jakubjelinek/following{/other_user}", "gists_url": "https://api.github.com/users/jakubjelinek/gists{/gist_id}", "starred_url": "https://api.github.com/users/jakubjelinek/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jakubjelinek/subscriptions", "organizations_url": "https://api.github.com/users/jakubjelinek/orgs", "repos_url": "https://api.github.com/users/jakubjelinek/repos", "events_url": "https://api.github.com/users/jakubjelinek/events{/privacy}", "received_events_url": "https://api.github.com/users/jakubjelinek/received_events", "type": "User", "site_admin": false}, "committer": null, "parents": [{"sha": "92fab505d29cc38f12ad0369648ef7d0a54a3aef", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/92fab505d29cc38f12ad0369648ef7d0a54a3aef", "html_url": "https://github.com/Rust-GCC/gccrs/commit/92fab505d29cc38f12ad0369648ef7d0a54a3aef"}], "stats": {"total": 166, "additions": 165, "deletions": 1}, "files": [{"sha": "9ffb21758e18afa93ffc7c7647f5007719aaabc4", "filename": "gcc/ChangeLog", "status": "modified", "additions": 6, "deletions": 0, "changes": 6, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/6837b3b895180864df03d01628eed75168c25a57/gcc%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/6837b3b895180864df03d01628eed75168c25a57/gcc%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2FChangeLog?ref=6837b3b895180864df03d01628eed75168c25a57", "patch": "@@ -1,3 +1,9 @@\n+2008-02-15  Jakub Jelinek  <jakub@redhat.com>\n+\n+\tPR middle-end/35130\n+\t* tree-nested.c (convert_call_expr): Put FRAME.* vars into\n+\tOMP_CLAUSE_SHARED rather than OMP_CLAUSE_FIRSTPRIVATE clause.\n+\n 2008-02-15  Richard Guenther  <rguenther@suse.de>\n \tZdenek Dvorak  <ook@ucw.cz>\n "}, {"sha": "a20e320ad2e1df7b493d0ce4a60c0e8369f964c9", "filename": "gcc/tree-nested.c", "status": "modified", "additions": 2, "deletions": 1, "changes": 3, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/6837b3b895180864df03d01628eed75168c25a57/gcc%2Ftree-nested.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/6837b3b895180864df03d01628eed75168c25a57/gcc%2Ftree-nested.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftree-nested.c?ref=6837b3b895180864df03d01628eed75168c25a57", "patch": "@@ -1739,7 +1739,8 @@ convert_call_expr (tree *tp, int *walk_subtrees, void *data)\n \t      break;\n \t  if (c == NULL)\n \t    {\n-\t      c = build_omp_clause (OMP_CLAUSE_FIRSTPRIVATE);\n+\t      c = build_omp_clause (i ? OMP_CLAUSE_FIRSTPRIVATE\n+\t\t\t\t      : OMP_CLAUSE_SHARED);\n \t      OMP_CLAUSE_DECL (c) = decl;\n \t      OMP_CLAUSE_CHAIN (c) = OMP_PARALLEL_CLAUSES (t);\n \t      OMP_PARALLEL_CLAUSES (t) = c;"}, {"sha": "6a8ba530490c4d1600fb742f2bdb885e08edfb40", "filename": "libgomp/ChangeLog", "status": "modified", "additions": 6, "deletions": 0, "changes": 6, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/6837b3b895180864df03d01628eed75168c25a57/libgomp%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/6837b3b895180864df03d01628eed75168c25a57/libgomp%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libgomp%2FChangeLog?ref=6837b3b895180864df03d01628eed75168c25a57", "patch": "@@ -1,3 +1,9 @@\n+2008-02-15  Jakub Jelinek  <jakub@redhat.com>\n+\n+\tPR middle-end/35130\n+\t* testsuite/libgomp.fortran/pr35130.f90: New test.\n+\t* testsuite/libgomp.c/pr35130.c: New test.\n+\n 2008-01-25  Jakub Jelinek  <jakub@redhat.com>\n \n \tPR middle-end/33880"}, {"sha": "12962d80705e4a3fe905bc4a5c453128ae198a26", "filename": "libgomp/testsuite/libgomp.c/pr35130.c", "status": "added", "additions": 131, "deletions": 0, "changes": 131, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/6837b3b895180864df03d01628eed75168c25a57/libgomp%2Ftestsuite%2Flibgomp.c%2Fpr35130.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/6837b3b895180864df03d01628eed75168c25a57/libgomp%2Ftestsuite%2Flibgomp.c%2Fpr35130.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libgomp%2Ftestsuite%2Flibgomp.c%2Fpr35130.c?ref=6837b3b895180864df03d01628eed75168c25a57", "patch": "@@ -0,0 +1,131 @@\n+/* PR middle-end/35130 */\n+\n+extern void abort (void);\n+\n+void\n+f1 (void)\n+{\n+  int a[4], k;\n+  void nested (int x)\n+  {\n+    a[x] = 42;\n+  }\n+\n+  for (k = 0; k < 4; k++)\n+    a[k] = 0;\n+#pragma omp parallel for\n+  for (k = 0; k < 4; k++)\n+    nested (k);\n+\n+  if (a[0] != 42 || a[1] != 42 || a[2] != 42 || a[3] != 42)\n+    abort ();\n+}\n+\n+void\n+f2 (void)\n+{\n+  int a[4], k;\n+  void nested (void)\n+  {\n+    int l;\n+    void nested2 (int x)\n+    {\n+      a[x] = 42;\n+    }\n+#pragma omp parallel for\n+    for (l = 0; l < 4; l++)\n+      nested2 (l);\n+  }\n+\n+  for (k = 0; k < 4; k++)\n+    a[k] = 0;\n+\n+  nested ();\n+\n+  if (a[0] != 42 || a[1] != 42 || a[2] != 42 || a[3] != 42)\n+    abort ();\n+}\n+\n+void\n+f3 (void)\n+{\n+  int a[4], b[4], c[4], k;\n+  void nested (int x)\n+  {\n+    a[x] = b[x] = c[x] = 42;\n+  }\n+\n+  for (k = 0; k < 4; k++)\n+    a[k] = b[k] = c[k] = 0;\n+  nested (0);\n+\n+#pragma omp parallel\n+  {\n+  #pragma omp single\n+    {\n+      a[1] = 43;\n+      b[1] = 43;\n+    }\n+  #pragma omp parallel\n+    {\n+    #pragma omp single\n+      {\n+\tb[2] = 44;\n+\tc[2] = 44;\n+      }\n+    }\n+  }\n+\n+  if (a[0] != 42 || a[1] != 43 || a[2] != 0 || a[3] != 0)\n+    abort ();\n+  if (b[0] != 42 || b[1] != 43 || b[2] != 44 || b[3] != 0)\n+    abort ();\n+  if (c[0] != 42 || c[1] != 0 || c[2] != 44 || c[3] != 0)\n+    abort ();\n+}\n+\n+void\n+f4 (void)\n+{\n+  int a[4], b[4], c[4], k;\n+  void nested ()\n+  {\n+  #pragma omp parallel\n+    {\n+    #pragma omp single\n+      {\n+\ta[1] = 43;\n+\tb[1] = 43;\n+      }\n+    #pragma omp parallel\n+      {\n+      #pragma omp single\n+\t{\n+\t  b[2] = 44;\n+\t  c[2] = 44;\n+\t}\n+      }\n+    }\n+  }\n+\n+  for (k = 0; k < 4; k++)\n+    a[k] = b[k] = c[k] = k == 0 ? 42 : 0;\n+  nested ();\n+\n+  if (a[0] != 42 || a[1] != 43 || a[2] != 0 || a[3] != 0)\n+    abort ();\n+  if (b[0] != 42 || b[1] != 43 || b[2] != 44 || b[3] != 0)\n+    abort ();\n+  if (c[0] != 42 || c[1] != 0 || c[2] != 44 || c[3] != 0)\n+    abort ();\n+}\n+\n+int\n+main (void)\n+{\n+  f1 ();\n+  f2 ();\n+  f3 ();\n+  f4 ();\n+  return 0;\n+}"}, {"sha": "50ff351527abcfe736bf72a333fd1e70d36ebfae", "filename": "libgomp/testsuite/libgomp.fortran/pr35130.f90", "status": "added", "additions": 20, "deletions": 0, "changes": 20, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/6837b3b895180864df03d01628eed75168c25a57/libgomp%2Ftestsuite%2Flibgomp.fortran%2Fpr35130.f90", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/6837b3b895180864df03d01628eed75168c25a57/libgomp%2Ftestsuite%2Flibgomp.fortran%2Fpr35130.f90", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libgomp%2Ftestsuite%2Flibgomp.fortran%2Fpr35130.f90?ref=6837b3b895180864df03d01628eed75168c25a57", "patch": "@@ -0,0 +1,20 @@\n+! PR middle-end/35130\n+\n+program pr35130\n+  implicit none\n+  real, dimension(20) :: a\n+  integer :: k\n+  a(:) = 0.0\n+!$omp parallel do private(k)\n+  do k=1,size(a)\n+    call inner(k)\n+  end do\n+!$omp end parallel do\n+  if (any (a.ne.42)) call abort\n+contains\n+ subroutine inner(i)\n+   implicit none\n+   integer :: i\n+   a(i) = 42\n+ end subroutine inner\n+end program pr35130"}]}