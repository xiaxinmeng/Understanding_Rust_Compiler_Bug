{"sha": "199988774d74091e467aef695d0d985528360613", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6MTk5OTg4Nzc0ZDc0MDkxZTQ2N2FlZjY5NWQwZDk4NTUyODM2MDYxMw==", "commit": {"author": {"name": "Tamar Christina", "email": "tamar.christina@arm.com", "date": "2020-11-05T11:46:35Z"}, "committer": {"name": "Tamar Christina", "email": "tamar.christina@arm.com", "date": "2020-11-05T11:46:35Z"}, "message": "middle-end: optimize slp simplify back to back permutes.\n\nThis optimizes sequential permutes. i.e. if there are two permutes back to back\nthis function applies the permute of the parent to the child and removed the\nparent.\n\nThis relies on the materialization point calculation in optimize SLP.\n\nThis allows us to remove useless permutes such as\n\n\tldr     q0, [x0, x3]\n\tldr     q2, [x1, x3]\n\ttrn1    v1.4s, v0.4s, v0.4s\n\ttrn2    v0.4s, v0.4s, v0.4s\n\ttrn1    v0.4s, v1.4s, v0.4s\n\tmov     v1.16b, v3.16b\n\tfcmla   v1.4s, v0.4s, v2.4s, #0\n\tfcmla   v1.4s, v0.4s, v2.4s, #90\n\tstr     q1, [x2, x3]\n\nfrom the sequence the vectorizer puts out and give\n\n\tldr     q0, [x0, x3]\n\tldr     q2, [x1, x3]\n\tmov     v1.16b, v3.16b\n\tfcmla   v1.4s, v0.4s, v2.4s, #0\n\tfcmla   v1.4s, v0.4s, v2.4s, #90\n\tstr     q1, [x2, x3]\n\ninstead.\n\ngcc/ChangeLog:\n\n\t* tree-vect-slp.c (vect_slp_tree_permute_noop_p): New.\n\t(vect_optimize_slp): Optimize permutes.\n\t(vectorizable_slp_permutation): Fix typo.", "tree": {"sha": "1eb96fe6c46d75a4e779ac17499b4bcc496432fc", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/1eb96fe6c46d75a4e779ac17499b4bcc496432fc"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/199988774d74091e467aef695d0d985528360613", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/199988774d74091e467aef695d0d985528360613", "html_url": "https://github.com/Rust-GCC/gccrs/commit/199988774d74091e467aef695d0d985528360613", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/199988774d74091e467aef695d0d985528360613/comments", "author": {"login": "TamarChristinaArm", "id": 48126768, "node_id": "MDQ6VXNlcjQ4MTI2NzY4", "avatar_url": "https://avatars.githubusercontent.com/u/48126768?v=4", "gravatar_id": "", "url": "https://api.github.com/users/TamarChristinaArm", "html_url": "https://github.com/TamarChristinaArm", "followers_url": "https://api.github.com/users/TamarChristinaArm/followers", "following_url": "https://api.github.com/users/TamarChristinaArm/following{/other_user}", "gists_url": "https://api.github.com/users/TamarChristinaArm/gists{/gist_id}", "starred_url": "https://api.github.com/users/TamarChristinaArm/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/TamarChristinaArm/subscriptions", "organizations_url": "https://api.github.com/users/TamarChristinaArm/orgs", "repos_url": "https://api.github.com/users/TamarChristinaArm/repos", "events_url": "https://api.github.com/users/TamarChristinaArm/events{/privacy}", "received_events_url": "https://api.github.com/users/TamarChristinaArm/received_events", "type": "User", "site_admin": false}, "committer": {"login": "TamarChristinaArm", "id": 48126768, "node_id": "MDQ6VXNlcjQ4MTI2NzY4", "avatar_url": "https://avatars.githubusercontent.com/u/48126768?v=4", "gravatar_id": "", "url": "https://api.github.com/users/TamarChristinaArm", "html_url": "https://github.com/TamarChristinaArm", "followers_url": "https://api.github.com/users/TamarChristinaArm/followers", "following_url": "https://api.github.com/users/TamarChristinaArm/following{/other_user}", "gists_url": "https://api.github.com/users/TamarChristinaArm/gists{/gist_id}", "starred_url": "https://api.github.com/users/TamarChristinaArm/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/TamarChristinaArm/subscriptions", "organizations_url": "https://api.github.com/users/TamarChristinaArm/orgs", "repos_url": "https://api.github.com/users/TamarChristinaArm/repos", "events_url": "https://api.github.com/users/TamarChristinaArm/events{/privacy}", "received_events_url": "https://api.github.com/users/TamarChristinaArm/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "7eb6c0ad2611e0802c3684196c9a7e94162f2c51", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/7eb6c0ad2611e0802c3684196c9a7e94162f2c51", "html_url": "https://github.com/Rust-GCC/gccrs/commit/7eb6c0ad2611e0802c3684196c9a7e94162f2c51"}], "stats": {"total": 14, "additions": 13, "deletions": 1}, "files": [{"sha": "016883a26553e90cd955cf5df6bb0585cb38063d", "filename": "gcc/tree-vect-slp.c", "status": "modified", "additions": 13, "deletions": 1, "changes": 14, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/199988774d74091e467aef695d0d985528360613/gcc%2Ftree-vect-slp.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/199988774d74091e467aef695d0d985528360613/gcc%2Ftree-vect-slp.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftree-vect-slp.c?ref=199988774d74091e467aef695d0d985528360613", "patch": "@@ -2941,6 +2941,18 @@ vect_optimize_slp (vec_info *vinfo)\n \t    /* For loads simply drop the permutation, the load permutation\n \t       already performs the desired permutation.  */\n \t    ;\n+\t  else if (SLP_TREE_LANE_PERMUTATION (node).exists ())\n+\t    {\n+\t      /* If the node if already a permute node we just need to apply\n+\t\t the permutation to the permute node itself.  */\n+\t      if (dump_enabled_p ())\n+\t\tdump_printf_loc (MSG_NOTE, vect_location,\n+\t\t\t\t \"simplifying permute node %p\\n\",\n+\t\t\t\t node);\n+\n+\t      vect_slp_permute (perms[perm], SLP_TREE_LANE_PERMUTATION (node),\n+\t\t\t\ttrue);\n+\t    }\n \t  else\n \t    {\n \t      if (dump_enabled_p ())\n@@ -5152,7 +5164,7 @@ vectorizable_slp_permutation (vec_info *vinfo, gimple_stmt_iterator *gsi,\n \t  if (dump_enabled_p ())\n \t    dump_printf_loc (MSG_MISSED_OPTIMIZATION, vect_location,\n \t\t\t     \"permutation requires at \"\n-\t\t\t     \"least three vectors\");\n+\t\t\t     \"least three vectors\\n\");\n \t  gcc_assert (!gsi);\n \t  return false;\n \t}"}]}