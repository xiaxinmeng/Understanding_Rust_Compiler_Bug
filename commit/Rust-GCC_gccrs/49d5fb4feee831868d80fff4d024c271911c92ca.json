{"sha": "49d5fb4feee831868d80fff4d024c271911c92ca", "node_id": "C_kwDOANBUbNoAKDQ5ZDVmYjRmZWVlODMxODY4ZDgwZmZmNGQwMjRjMjcxOTExYzkyY2E", "commit": {"author": {"name": "Andrew MacLeod", "email": "amacleod@redhat.com", "date": "2022-01-12T18:31:08Z"}, "committer": {"name": "Andrew MacLeod", "email": "amacleod@redhat.com", "date": "2022-01-13T18:51:30Z"}, "message": "Allow more precision when querying from fold_const.\n\nfold_const::expr_not_equal_to queries for a current range, but still uses\nthe old value_range class.  This is causing it to miss opportunities when\nranger can provide something better.\n\n\tPR tree-optimization/83072\n\tPR tree-optimization/83073\n\tPR tree-optimization/97909\n\tgcc/\n\t* fold-const.c (expr_not_equal_to): Use a multi-range class.\n\n\tgcc/testsuite/\n\t* gcc.dg/pr83072-2.c: New.\n\t* gcc.dg/pr83073.c: New.", "tree": {"sha": "3ddef029955525380150636e13c8fb8252fb8e8f", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/3ddef029955525380150636e13c8fb8252fb8e8f"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/49d5fb4feee831868d80fff4d024c271911c92ca", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/49d5fb4feee831868d80fff4d024c271911c92ca", "html_url": "https://github.com/Rust-GCC/gccrs/commit/49d5fb4feee831868d80fff4d024c271911c92ca", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/49d5fb4feee831868d80fff4d024c271911c92ca/comments", "author": null, "committer": null, "parents": [{"sha": "27e4260166950b784fe270ba4f0cae9a66faf1c4", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/27e4260166950b784fe270ba4f0cae9a66faf1c4", "html_url": "https://github.com/Rust-GCC/gccrs/commit/27e4260166950b784fe270ba4f0cae9a66faf1c4"}], "stats": {"total": 30, "additions": 29, "deletions": 1}, "files": [{"sha": "cd540e1f2b3c2c2ee042d4ab464d0cd2973669d3", "filename": "gcc/fold-const.c", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/49d5fb4feee831868d80fff4d024c271911c92ca/gcc%2Ffold-const.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/49d5fb4feee831868d80fff4d024c271911c92ca/gcc%2Ffold-const.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ffold-const.c?ref=49d5fb4feee831868d80fff4d024c271911c92ca", "patch": "@@ -10734,7 +10734,7 @@ tree_expr_nonzero_p (tree t)\n bool\n expr_not_equal_to (tree t, const wide_int &w)\n {\n-  value_range vr;\n+  int_range_max vr;\n   switch (TREE_CODE (t))\n     {\n     case INTEGER_CST:"}, {"sha": "f495f2582c437e411d1ecdfe002e526a6c20634e", "filename": "gcc/testsuite/gcc.dg/pr83072-2.c", "status": "added", "additions": 18, "deletions": 0, "changes": 18, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/49d5fb4feee831868d80fff4d024c271911c92ca/gcc%2Ftestsuite%2Fgcc.dg%2Fpr83072-2.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/49d5fb4feee831868d80fff4d024c271911c92ca/gcc%2Ftestsuite%2Fgcc.dg%2Fpr83072-2.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgcc.dg%2Fpr83072-2.c?ref=49d5fb4feee831868d80fff4d024c271911c92ca", "patch": "@@ -0,0 +1,18 @@\n+/* { dg-do compile} */\n+/* { dg-options \"-O2 -fdump-tree-evrp-details\" } */\n+\n+int f1(int a, int b, int c){\n+  if(c==0)__builtin_unreachable();\n+  a *= c;\n+  b *= c;\n+  return a == b;\n+}\n+\n+int f2(int a, int b, int c){\n+  c |= 1;\n+  a *= c;\n+  b *= c;\n+  return a == b;\n+}\n+\n+/* { dg-final { scan-tree-dump-times \"gimple_simplified to\" 2 \"evrp\" } }  */"}, {"sha": "1168ae822a41b8656b253d3b186b9c21d6dfe206", "filename": "gcc/testsuite/gcc.dg/pr83073.c", "status": "added", "additions": 10, "deletions": 0, "changes": 10, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/49d5fb4feee831868d80fff4d024c271911c92ca/gcc%2Ftestsuite%2Fgcc.dg%2Fpr83073.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/49d5fb4feee831868d80fff4d024c271911c92ca/gcc%2Ftestsuite%2Fgcc.dg%2Fpr83073.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgcc.dg%2Fpr83073.c?ref=49d5fb4feee831868d80fff4d024c271911c92ca", "patch": "@@ -0,0 +1,10 @@\n+/* { dg-do compile} */\n+/* { dg-options \"-O2 -fdump-tree-evrp-details -fno-tree-fre -fno-tree-ccp -fno-tree-forwprop\" } */\n+\n+int f(int x)\n+{\n+    x = x|1;\n+    return x & 1;\n+}\n+\n+/* { dg-final { scan-tree-dump \"gimple_simplified to.* = 1\" \"evrp\" } }  */"}]}