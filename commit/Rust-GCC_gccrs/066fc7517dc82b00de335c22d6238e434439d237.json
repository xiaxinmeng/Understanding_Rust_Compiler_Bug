{"sha": "066fc7517dc82b00de335c22d6238e434439d237", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6MDY2ZmM3NTE3ZGM4MmIwMGRlMzM1YzIyZDYyMzhlNDM0NDM5ZDIzNw==", "commit": {"author": {"name": "Marek Polacek", "email": "polacek@redhat.com", "date": "2017-12-18T16:44:35Z"}, "committer": {"name": "Marek Polacek", "email": "mpolacek@gcc.gnu.org", "date": "2017-12-18T16:44:35Z"}, "message": "re PR middle-end/83463 (ICE: tree check: expected integer_type or enumeral_type or boolean_type or real_type or fixed_point_type, have pointer_type in builtin_memr ef, at gimple-ssa-warn-restrict.c:297)\n\n\tPR middle-end/83463\n\t* gimple-ssa-warn-restrict.c (builtin_memref::builtin_memref):\n\tCheck if TYPE is INTEGRAL_TYPE_P before accessing its min/max\n\tvalues.\n\n\t* gcc.dg/pr83463.c: New test.\n\nFrom-SVN: r255781", "tree": {"sha": "1fa88d8a9432b53085d0e9aa6ed9bbdfd063c378", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/1fa88d8a9432b53085d0e9aa6ed9bbdfd063c378"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/066fc7517dc82b00de335c22d6238e434439d237", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/066fc7517dc82b00de335c22d6238e434439d237", "html_url": "https://github.com/Rust-GCC/gccrs/commit/066fc7517dc82b00de335c22d6238e434439d237", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/066fc7517dc82b00de335c22d6238e434439d237/comments", "author": {"login": "mpolacek", "id": 10496300, "node_id": "MDQ6VXNlcjEwNDk2MzAw", "avatar_url": "https://avatars.githubusercontent.com/u/10496300?v=4", "gravatar_id": "", "url": "https://api.github.com/users/mpolacek", "html_url": "https://github.com/mpolacek", "followers_url": "https://api.github.com/users/mpolacek/followers", "following_url": "https://api.github.com/users/mpolacek/following{/other_user}", "gists_url": "https://api.github.com/users/mpolacek/gists{/gist_id}", "starred_url": "https://api.github.com/users/mpolacek/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/mpolacek/subscriptions", "organizations_url": "https://api.github.com/users/mpolacek/orgs", "repos_url": "https://api.github.com/users/mpolacek/repos", "events_url": "https://api.github.com/users/mpolacek/events{/privacy}", "received_events_url": "https://api.github.com/users/mpolacek/received_events", "type": "User", "site_admin": false}, "committer": null, "parents": [{"sha": "02c7dd78fa0a3d05231f6340c4cc80d91b2393a5", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/02c7dd78fa0a3d05231f6340c4cc80d91b2393a5", "html_url": "https://github.com/Rust-GCC/gccrs/commit/02c7dd78fa0a3d05231f6340c4cc80d91b2393a5"}], "stats": {"total": 35, "additions": 33, "deletions": 2}, "files": [{"sha": "a4a2afe6348b88a61f04bd7db69af1545b4744c3", "filename": "gcc/ChangeLog", "status": "modified", "additions": 7, "deletions": 0, "changes": 7, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/066fc7517dc82b00de335c22d6238e434439d237/gcc%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/066fc7517dc82b00de335c22d6238e434439d237/gcc%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2FChangeLog?ref=066fc7517dc82b00de335c22d6238e434439d237", "patch": "@@ -1,3 +1,10 @@\n+2017-12-18  Marek Polacek  <polacek@redhat.com>\n+\n+\tPR middle-end/83463\n+\t* gimple-ssa-warn-restrict.c (builtin_memref::builtin_memref):\n+\tCheck if TYPE is INTEGRAL_TYPE_P before accessing its min/max\n+\tvalues.\n+\n 2017-12-18  Claudiu Zissulescu  <claziss@synopsys.com>\n \n \t* config/arc/arc.md (maddsidi4, maddsidi4_split): Update pattern."}, {"sha": "d1a376637a2d75a14286be35294f002362f93209", "filename": "gcc/gimple-ssa-warn-restrict.c", "status": "modified", "additions": 4, "deletions": 2, "changes": 6, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/066fc7517dc82b00de335c22d6238e434439d237/gcc%2Fgimple-ssa-warn-restrict.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/066fc7517dc82b00de335c22d6238e434439d237/gcc%2Fgimple-ssa-warn-restrict.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fgimple-ssa-warn-restrict.c?ref=066fc7517dc82b00de335c22d6238e434439d237", "patch": "@@ -287,13 +287,15 @@ builtin_memref::builtin_memref (tree expr, tree size)\n \t\t  else\n \t\t    {\n \t\t      gimple *stmt = SSA_NAME_DEF_STMT (offset);\n+\t\t      tree type;\n \t\t      if (is_gimple_assign (stmt)\n-\t\t\t  && gimple_assign_rhs_code (stmt) == NOP_EXPR)\n+\t\t\t  && gimple_assign_rhs_code (stmt) == NOP_EXPR\n+\t\t\t  && (type = TREE_TYPE (gimple_assign_rhs1 (stmt)))\n+\t\t\t  && INTEGRAL_TYPE_P (type))\n \t\t\t{\n \t\t\t  /* Use the bounds of the type of the NOP_EXPR operand\n \t\t\t     even if it's signed.  The result doesn't trigger\n \t\t\t     warnings but makes their output more readable.  */\n-\t\t\t  tree type = TREE_TYPE (gimple_assign_rhs1 (stmt));\n \t\t\t  offrange[0] = wi::to_offset (TYPE_MIN_VALUE (type));\n \t\t\t  offrange[1] = wi::to_offset (TYPE_MAX_VALUE (type));\n \t\t\t}"}, {"sha": "57ef599565c8765d618050dbf64e53c0f8732f87", "filename": "gcc/testsuite/ChangeLog", "status": "modified", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/066fc7517dc82b00de335c22d6238e434439d237/gcc%2Ftestsuite%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/066fc7517dc82b00de335c22d6238e434439d237/gcc%2Ftestsuite%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2FChangeLog?ref=066fc7517dc82b00de335c22d6238e434439d237", "patch": "@@ -1,3 +1,8 @@\n+2017-12-18  Marek Polacek  <polacek@redhat.com>\n+\n+\tPR middle-end/83463\n+\t* gcc.dg/pr83463.c: New test.\n+\n 2017-12-18  Nathan Sidwell  <nathan@acm.org>\n \n \tPR c++/59930"}, {"sha": "735ef3c6dc8f62bf43f05e999fe1d539721ed7ea", "filename": "gcc/testsuite/gcc.dg/pr83463.c", "status": "added", "additions": 17, "deletions": 0, "changes": 17, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/066fc7517dc82b00de335c22d6238e434439d237/gcc%2Ftestsuite%2Fgcc.dg%2Fpr83463.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/066fc7517dc82b00de335c22d6238e434439d237/gcc%2Ftestsuite%2Fgcc.dg%2Fpr83463.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgcc.dg%2Fpr83463.c?ref=066fc7517dc82b00de335c22d6238e434439d237", "patch": "@@ -0,0 +1,17 @@\n+/* PR middle-end/83463 */\n+/* { dg-do compile } */\n+/* { dg-options \"-O2 -Wrestrict\" } */\n+\n+int *a;\n+void *memcpy ();\n+void\n+m (void *p1)\n+{\n+  memcpy (0, p1, 0);\n+}\n+\n+void\n+p ()\n+{\n+  m (p + (long) a);\n+}"}]}