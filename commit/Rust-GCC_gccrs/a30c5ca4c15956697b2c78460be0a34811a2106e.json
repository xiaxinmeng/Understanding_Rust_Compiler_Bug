{"sha": "a30c5ca4c15956697b2c78460be0a34811a2106e", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6YTMwYzVjYTRjMTU5NTY2OTdiMmM3ODQ2MGJlMGEzNDgxMWEyMTA2ZQ==", "commit": {"author": {"name": "Andrew Burgess", "email": "andrew.burgess@embecosm.com", "date": "2015-12-17T10:53:43Z"}, "committer": {"name": "Joern Rennecke", "email": "amylaar@gcc.gnu.org", "date": "2015-12-17T10:53:43Z"}, "message": "arc.c (arc_loop_hazard): Don't convert the jump label rtx to an rtx_insn until we confirm it's not a...\n\n2015-12-17  Andrew Burgess  <andrew.burgess@embecosm.com>\ngcc:\n        * config/arc/arc.c (arc_loop_hazard): Don't convert the jump label\n        rtx to an rtx_insn until we confirm it's not a return rtx.\ngcc/testsuite:\n        * gcc.target/arc/loop-hazard-1.c: New file\n\nFrom-SVN: r231752", "tree": {"sha": "76a7e5538586cca43ef71c911ae0791a047501ab", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/76a7e5538586cca43ef71c911ae0791a047501ab"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/a30c5ca4c15956697b2c78460be0a34811a2106e", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/a30c5ca4c15956697b2c78460be0a34811a2106e", "html_url": "https://github.com/Rust-GCC/gccrs/commit/a30c5ca4c15956697b2c78460be0a34811a2106e", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/a30c5ca4c15956697b2c78460be0a34811a2106e/comments", "author": {"login": "T-J-Teru", "id": 475372, "node_id": "MDQ6VXNlcjQ3NTM3Mg==", "avatar_url": "https://avatars.githubusercontent.com/u/475372?v=4", "gravatar_id": "", "url": "https://api.github.com/users/T-J-Teru", "html_url": "https://github.com/T-J-Teru", "followers_url": "https://api.github.com/users/T-J-Teru/followers", "following_url": "https://api.github.com/users/T-J-Teru/following{/other_user}", "gists_url": "https://api.github.com/users/T-J-Teru/gists{/gist_id}", "starred_url": "https://api.github.com/users/T-J-Teru/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/T-J-Teru/subscriptions", "organizations_url": "https://api.github.com/users/T-J-Teru/orgs", "repos_url": "https://api.github.com/users/T-J-Teru/repos", "events_url": "https://api.github.com/users/T-J-Teru/events{/privacy}", "received_events_url": "https://api.github.com/users/T-J-Teru/received_events", "type": "User", "site_admin": false}, "committer": null, "parents": [{"sha": "38fc3edcb9397eb37ce98ceee210eac823e6a92c", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/38fc3edcb9397eb37ce98ceee210eac823e6a92c", "html_url": "https://github.com/Rust-GCC/gccrs/commit/38fc3edcb9397eb37ce98ceee210eac823e6a92c"}], "stats": {"total": 40, "additions": 33, "deletions": 7}, "files": [{"sha": "375ab755e80357062167cc973295133a588c4b70", "filename": "gcc/ChangeLog", "status": "modified", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/a30c5ca4c15956697b2c78460be0a34811a2106e/gcc%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/a30c5ca4c15956697b2c78460be0a34811a2106e/gcc%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2FChangeLog?ref=a30c5ca4c15956697b2c78460be0a34811a2106e", "patch": "@@ -1,3 +1,8 @@\n+2015-12-17  Andrew Burgess  <andrew.burgess@embecosm.com>\n+\n+\t* config/arc/arc.c (arc_loop_hazard): Don't convert the jump label\n+\trtx to an rtx_insn until we confirm it's not a return rtx.\n+\n 2015-12-17  Richard Biener  <rguenther@suse.de>\n \n \t* gimple-ssa.h (struct gimple_df): Remove modified_noreturn_calls"}, {"sha": "d3a6f27332a288a4b9cf7f3eb7e61a9e7103f29d", "filename": "gcc/config/arc/arc.c", "status": "modified", "additions": 8, "deletions": 7, "changes": 15, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/a30c5ca4c15956697b2c78460be0a34811a2106e/gcc%2Fconfig%2Farc%2Farc.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/a30c5ca4c15956697b2c78460be0a34811a2106e/gcc%2Fconfig%2Farc%2Farc.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fconfig%2Farc%2Farc.c?ref=a30c5ca4c15956697b2c78460be0a34811a2106e", "patch": "@@ -8041,6 +8041,7 @@ static bool\n arc_loop_hazard (rtx_insn *pred, rtx_insn *succ)\n {\n   rtx_insn *jump  = NULL;\n+  rtx label_rtx = NULL_RTX;\n   rtx_insn *label = NULL;\n   basic_block succ_bb;\n \n@@ -8067,22 +8068,22 @@ arc_loop_hazard (rtx_insn *pred, rtx_insn *succ)\n   else\n     return false;\n \n-  label = JUMP_LABEL_AS_INSN (jump);\n-  if (!label)\n-    return false;\n-\n   /* Phase 2b: Make sure is not a millicode jump.  */\n   if ((GET_CODE (PATTERN (jump)) == PARALLEL)\n       && (XVECEXP (PATTERN (jump), 0, 0) == ret_rtx))\n     return false;\n \n-  /* Phase 2c: Make sure is not a simple_return.  */\n-  if ((GET_CODE (PATTERN (jump)) == SIMPLE_RETURN)\n-      || (GET_CODE (label) == SIMPLE_RETURN))\n+  label_rtx = JUMP_LABEL (jump);\n+  if (!label_rtx)\n+    return false;\n+\n+  /* Phase 2c: Make sure is not a return.  */\n+  if (ANY_RETURN_P (label_rtx))\n     return false;\n \n   /* Pahse 2d: Go to the target of the jump and check for aliveness of\n      LP_COUNT register.  */\n+  label = safe_as_a <rtx_insn *> (label_rtx);\n   succ_bb = BLOCK_FOR_INSN (label);\n   if (!succ_bb)\n     {"}, {"sha": "674c868cf1100ab52b48cef6bd2196f0b779ef07", "filename": "gcc/testsuite/ChangeLog", "status": "modified", "additions": 4, "deletions": 0, "changes": 4, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/a30c5ca4c15956697b2c78460be0a34811a2106e/gcc%2Ftestsuite%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/a30c5ca4c15956697b2c78460be0a34811a2106e/gcc%2Ftestsuite%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2FChangeLog?ref=a30c5ca4c15956697b2c78460be0a34811a2106e", "patch": "@@ -10,6 +10,10 @@\n \t* gcc.dg/darwin-20040809-2.c: Likewise.\n \t* objc.dg/stabs-1.m: Likewise.\n \n+2015-12-17  Andrew Burgess  <andrew.burgess@embecosm.com>\n+\n+\t* gcc.target/arc/loop-hazard-1.c: New file.\n+\n 2015-12-17  Andrew Burgess  <andrew.burgess@embecosm.com>\n \n \t* gcc.target/arc/jump-around-jump.c (rtc_set_time): Declare."}, {"sha": "7c688bbc236a57aa049ed544de52f7eb81c4f674", "filename": "gcc/testsuite/gcc.target/arc/loop-hazard-1.c", "status": "added", "additions": 16, "deletions": 0, "changes": 16, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/a30c5ca4c15956697b2c78460be0a34811a2106e/gcc%2Ftestsuite%2Fgcc.target%2Farc%2Floop-hazard-1.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/a30c5ca4c15956697b2c78460be0a34811a2106e/gcc%2Ftestsuite%2Fgcc.target%2Farc%2Floop-hazard-1.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgcc.target%2Farc%2Floop-hazard-1.c?ref=a30c5ca4c15956697b2c78460be0a34811a2106e", "patch": "@@ -0,0 +1,16 @@\n+/* { dg-do compile } */\n+/* { dg-options \"-Os\" } */\n+\n+/* This caused an assertion within arc_loop_hazard.  */\n+\n+unsigned a, b;\n+\n+long fn1()\n+{\n+  long c = 1, d = 0;\n+  while (a && c && b)\n+    c <<= 1;\n+  while (c)\n+    d |= c;\n+  return d;\n+}"}]}