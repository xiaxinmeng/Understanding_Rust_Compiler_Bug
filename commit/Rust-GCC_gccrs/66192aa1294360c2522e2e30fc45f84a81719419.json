{"sha": "66192aa1294360c2522e2e30fc45f84a81719419", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6NjYxOTJhYTEyOTQzNjBjMjUyMmUyZTMwZmM0NWY4NGE4MTcxOTQxOQ==", "commit": {"author": {"name": "Ding-Kai Chen", "email": "dkchen@cadence.com", "date": "2016-10-18T19:06:33Z"}, "committer": {"name": "Max Filippov", "email": "jcmvbkbc@gcc.gnu.org", "date": "2016-10-18T19:06:33Z"}, "message": "xtensa: add HW FPU sequences for DIV/SQRT/RECIP/RSQRT\n\nUse new FPU instruction sequences documented in the ISA book to\nimplement __divsf3, __divdf3, __recipsf2, __recipdf2, __rsqrtsf2,\n__rsqrtdf2 and __ieee754_sqrtf and __ieee754_sqrt.\n\n2016-10-18  Ding-Kai Chen  <dkchen@cadence.com>\nlibgcc/\n\t* config/xtensa/ieee754-df.S (__recipdf2, __rsqrtdf2,\n\t__ieee754_sqrt): New functions.\n\t(__divdf3): Add implementation with new FPU instructions under\n\t#if XCHAL_HAVE_DFP_DIV.\n\t* config/xtensa/ieee754-sf.S (__recipsf2, __rsqrtsf2,\n\t__ieee754_sqrtf): New functions.\n\t(__divsf3): Add implementation with new FPU instructions under\n\t#if XCHAL_HAVE_FP_DIV.\n\t* config/xtensa/t-xtensa (LIB1ASMFUNCS): Add _sqrtf, _recipsf2\n\t_rsqrtsf2, _sqrt, _recipdf2 and _rsqrtdf2.\n\nFrom-SVN: r241312", "tree": {"sha": "a2d0d16150c035c44a7b6c0b5c853224f80ee657", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/a2d0d16150c035c44a7b6c0b5c853224f80ee657"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/66192aa1294360c2522e2e30fc45f84a81719419", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/66192aa1294360c2522e2e30fc45f84a81719419", "html_url": "https://github.com/Rust-GCC/gccrs/commit/66192aa1294360c2522e2e30fc45f84a81719419", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/66192aa1294360c2522e2e30fc45f84a81719419/comments", "author": {"login": "dkchen", "id": 4873929, "node_id": "MDQ6VXNlcjQ4NzM5Mjk=", "avatar_url": "https://avatars.githubusercontent.com/u/4873929?v=4", "gravatar_id": "", "url": "https://api.github.com/users/dkchen", "html_url": "https://github.com/dkchen", "followers_url": "https://api.github.com/users/dkchen/followers", "following_url": "https://api.github.com/users/dkchen/following{/other_user}", "gists_url": "https://api.github.com/users/dkchen/gists{/gist_id}", "starred_url": "https://api.github.com/users/dkchen/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/dkchen/subscriptions", "organizations_url": "https://api.github.com/users/dkchen/orgs", "repos_url": "https://api.github.com/users/dkchen/repos", "events_url": "https://api.github.com/users/dkchen/events{/privacy}", "received_events_url": "https://api.github.com/users/dkchen/received_events", "type": "User", "site_admin": false}, "committer": null, "parents": [{"sha": "6dddab0845c9056db22ecb86c12564244fa0f911", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/6dddab0845c9056db22ecb86c12564244fa0f911", "html_url": "https://github.com/Rust-GCC/gccrs/commit/6dddab0845c9056db22ecb86c12564244fa0f911"}], "stats": {"total": 351, "additions": 348, "deletions": 3}, "files": [{"sha": "b98f6d49f3f03ba21f2bd2c5e945d07bde13da37", "filename": "libgcc/ChangeLog", "status": "modified", "additions": 13, "deletions": 0, "changes": 13, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/66192aa1294360c2522e2e30fc45f84a81719419/libgcc%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/66192aa1294360c2522e2e30fc45f84a81719419/libgcc%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libgcc%2FChangeLog?ref=66192aa1294360c2522e2e30fc45f84a81719419", "patch": "@@ -1,3 +1,16 @@\n+2016-10-18  Ding-Kai Chen  <dkchen@cadence.com>\n+\n+\t* config/xtensa/ieee754-df.S (__recipdf2, __rsqrtdf2,\n+\t__ieee754_sqrt): New functions.\n+\t(__divdf3): Add implementation with new FPU instructions under\n+\t#if XCHAL_HAVE_DFP_DIV.\n+\t* config/xtensa/ieee754-sf.S (__recipsf2, __rsqrtsf2,\n+\t__ieee754_sqrtf): New functions.\n+\t(__divsf3): Add implementation with new FPU instructions under\n+\t#if XCHAL_HAVE_FP_DIV.\n+\t* config/xtensa/t-xtensa (LIB1ASMFUNCS): Add _sqrtf, _recipsf2\n+\t_rsqrtsf2, _sqrt, _recipdf2 and _rsqrtdf2.\n+\n 2016-10-13  Thomas Preud'homme  <thomas.preudhomme@arm.com>\n \n \t* libgcov-profiler.c: Replace MEMMODEL_* macros by their __ATOMIC_*"}, {"sha": "a2fb166d3b2283cb2f7c9eff9d16552696241f0b", "filename": "libgcc/config/xtensa/ieee754-df.S", "status": "modified", "additions": 177, "deletions": 1, "changes": 178, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/66192aa1294360c2522e2e30fc45f84a81719419/libgcc%2Fconfig%2Fxtensa%2Fieee754-df.S", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/66192aa1294360c2522e2e30fc45f84a81719419/libgcc%2Fconfig%2Fxtensa%2Fieee754-df.S", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libgcc%2Fconfig%2Fxtensa%2Fieee754-df.S?ref=66192aa1294360c2522e2e30fc45f84a81719419", "patch": "@@ -1217,8 +1217,58 @@ __muldf3:\n \n #ifdef L_divdf3\n \n-\t.literal_position\n \t/* Division */\n+\n+#if XCHAL_HAVE_DFP_DIV\n+\n+        .text\n+        .align 4\n+        .global __divdf3\n+        .type\t__divdf3, @function\n+__divdf3:\n+\tleaf_entry\tsp, 16\n+\n+\twfrd\t\tf1, xh, xl\n+\twfrd\t\tf2, yh, yl\n+\n+\tdiv0.d\t\tf3, f2\n+\tnexp01.d\tf4, f2\n+\tconst.d\t\tf0, 1\n+\tmaddn.d\t\tf0, f4, f3\n+\tconst.d\t\tf5, 0\n+\tmov.d\t\tf7, f2\n+\tmkdadj.d\tf7, f1\n+\tmaddn.d\t\tf3, f0, f3\n+\tmaddn.d\t\tf5, f0, f0\n+\tnexp01.d\tf1, f1\n+\tdiv0.d\t\tf2, f2\n+\tmaddn.d\t\tf3, f5, f3\n+\tconst.d\t\tf5, 1\n+\tconst.d\t\tf0, 0\n+\tneg.d\t\tf6, f1\n+\tmaddn.d\t\tf5, f4, f3\n+\tmaddn.d\t\tf0, f6, f2\n+\tmaddn.d\t\tf3, f5, f3\n+\tmaddn.d\t\tf6, f4, f0\n+\tconst.d\t\tf2, 1\n+\tmaddn.d\t\tf2, f4, f3\n+\tmaddn.d\t\tf0, f6, f3\n+\tneg.d\t\tf1, f1\n+\tmaddn.d\t\tf3, f2, f3\n+\tmaddn.d\t\tf1, f4, f0\n+\taddexpm.d\tf0, f7\n+\taddexp.d\tf3, f7\n+\tdivn.d\t\tf0, f1, f3\n+\n+\trfr\t\txl, f0\n+\trfrd\t\txh, f0\n+\n+\tleaf_return\n+\n+#else\n+\n+\t.literal_position\n+\n __divdf3_aux:\n \n \t/* Handle unusual cases (zeros, subnormals, NaNs and Infinities).\n@@ -1537,6 +1587,8 @@ __divdf3:\n \tmovi\txl, 0\n \tleaf_return\n \n+#endif /* XCHAL_HAVE_DFP_DIV */\n+\n #endif /* L_divdf3 */\n \n #ifdef L_cmpdf2\n@@ -2388,3 +2440,127 @@ __extendsfdf2:\n #endif /* L_extendsfdf2 */\n \n \n+#if XCHAL_HAVE_DFP_SQRT\n+#ifdef L_sqrt\n+\n+        .text\n+        .align 4\n+        .global __ieee754_sqrt\n+        .type\t__ieee754_sqrt, @function\n+__ieee754_sqrt:\n+\tleaf_entry\tsp, 16\n+\n+\twfrd\t\tf1, xh, xl\n+\n+\tsqrt0.d\t\tf2, f1\n+\tconst.d\t\tf4, 0\n+\tmaddn.d\t\tf4, f2, f2\n+\tnexp01.d\tf3, f1\n+\tconst.d\t\tf0, 3\n+\taddexp.d\tf3, f0\n+\tmaddn.d\t\tf0, f4, f3\n+\tnexp01.d\tf4, f1\n+\tmaddn.d\t\tf2, f0, f2\n+\tconst.d\t\tf5, 0\n+\tmaddn.d\t\tf5, f2, f3\n+\tconst.d\t\tf0, 3\n+\tmaddn.d\t\tf0, f5, f2\n+\tneg.d\t\tf6, f4\n+\tmaddn.d\t\tf2, f0, f2\n+\tconst.d\t\tf0, 0\n+\tconst.d\t\tf5, 0\n+\tconst.d\t\tf7, 0\n+\tmaddn.d\t\tf0, f6, f2\n+\tmaddn.d\t\tf5, f2, f3\n+\tconst.d\t\tf3, 3\n+\tmaddn.d\t\tf7, f3, f2\n+\tmaddn.d\t\tf4, f0, f0\n+\tmaddn.d\t\tf3, f5, f2\n+\tneg.d\t\tf2, f7\n+\tmaddn.d\t\tf0, f4, f2\n+\tmaddn.d\t\tf7, f3, f7\n+\tmksadj.d\tf2, f1\n+\tnexp01.d\tf1, f1\n+\tmaddn.d\t\tf1, f0, f0\n+\tneg.d\t\tf3, f7\n+\taddexpm.d\tf0, f2\n+\taddexp.d\tf3, f2\n+\tdivn.d\t\tf0, f1, f3\n+\n+\trfr\t\txl, f0\n+\trfrd\t\txh, f0\n+\n+\tleaf_return\n+\n+#endif /* L_sqrt */\n+#endif /* XCHAL_HAVE_DFP_SQRT */\n+\n+#if XCHAL_HAVE_DFP_RECIP\n+#ifdef L_recipdf2\n+\t/* Reciprocal */\n+\n+\t.align\t4\n+\t.global\t__recipdf2\n+\t.type\t__recipdf2, @function\n+__recipdf2:\n+\tleaf_entry\tsp, 16\n+\n+\twfrd\t\tf1, xh, xl\n+\n+\trecip0.d\tf0, f1\n+\tconst.d\t\tf2, 2\n+\tmsub.d\t\tf2, f1, f0\n+\tmul.d\t\tf3, f1, f0\n+\tconst.d\t\tf4, 2\n+\tmul.d\t\tf5, f0, f2\n+\tmsub.d\t\tf4, f3, f2\n+\tconst.d\t\tf2, 1\n+\tmul.d\t\tf0, f5, f4\n+\tmsub.d\t\tf2, f1, f0\n+\tmaddn.d\t\tf0, f0, f2\n+\n+\trfr\t\txl, f0\n+\trfrd\t\txh, f0\n+\n+\tleaf_return\n+\n+#endif /* L_recipdf2 */\n+#endif /* XCHAL_HAVE_DFP_RECIP */\n+\n+#if XCHAL_HAVE_DFP_RSQRT\n+#ifdef L_rsqrtdf2\n+\t/* Reciprocal square root */\n+\n+\t.align\t4\n+\t.global\t__rsqrtdf2\n+\t.type\t__rsqrtdf2, @function\n+__rsqrtdf2:\n+\tleaf_entry\tsp, 16\n+\n+\twfrd\t\tf1, xh, xl\n+\n+\trsqrt0.d\tf0, f1\n+\tmul.d\t\tf2, f1, f0\n+\tconst.d\t\tf3, 3\n+\tmul.d\t\tf4, f3, f0\n+\tconst.d\t\tf5, 1\n+\tmsub.d\t\tf5, f2, f0\n+\tmaddn.d\t\tf0, f4, f5\n+\tconst.d\t\tf2, 1\n+\tmul.d\t\tf4, f1, f0\n+\tmul.d\t\tf5, f3, f0\n+\tmsub.d\t\tf2, f4, f0\n+\tmaddn.d\t\tf0, f5, f2\n+\tconst.d\t\tf2, 1\n+\tmul.d\t\tf1, f1, f0\n+\tmul.d\t\tf3, f3, f0\n+\tmsub.d\t\tf2, f1, f0\n+\tmaddn.d\t\tf0, f3, f2\n+\n+\trfr\t\txl, f0\n+\trfrd\t\txh, f0\n+\n+\tleaf_return\n+\n+#endif /* L_rsqrtdf2 */\n+#endif /* XCHAL_HAVE_DFP_RSQRT */"}, {"sha": "6acad59a6ae0a878db4127f6f55fda172f1392a0", "filename": "libgcc/config/xtensa/ieee754-sf.S", "status": "modified", "additions": 155, "deletions": 1, "changes": 156, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/66192aa1294360c2522e2e30fc45f84a81719419/libgcc%2Fconfig%2Fxtensa%2Fieee754-sf.S", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/66192aa1294360c2522e2e30fc45f84a81719419/libgcc%2Fconfig%2Fxtensa%2Fieee754-sf.S", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libgcc%2Fconfig%2Fxtensa%2Fieee754-sf.S?ref=66192aa1294360c2522e2e30fc45f84a81719419", "patch": "@@ -885,8 +885,52 @@ __mulsf3:\n \n #ifdef L_divsf3\n \n-\t.literal_position\n \t/* Division */\n+\n+#if XCHAL_HAVE_FP_DIV\n+\n+\t.align\t4\n+\t.global\t__divsf3\n+\t.type\t__divsf3, @function\n+__divsf3:\n+\tleaf_entry\tsp, 16\n+\n+\twfr\t\tf1, a2\t/* dividend */\n+\twfr\t\tf2, a3\t/* divisor */\n+\n+\tdiv0.s\t\tf3, f2\n+\tnexp01.s\tf4, f2\n+\tconst.s\t\tf5, 1\n+\tmaddn.s\t\tf5, f4, f3\n+\tmov.s\t\tf6, f3\n+\tmov.s\t\tf7, f2\n+\tnexp01.s\tf2, f1\n+\tmaddn.s\t\tf6, f5, f6\n+\tconst.s\t\tf5, 1\n+\tconst.s\t\tf0, 0\n+\tneg.s\t\tf8, f2\n+\tmaddn.s\t\tf5, f4, f6\n+\tmaddn.s\t\tf0, f8, f3\n+\tmkdadj.s\tf7, f1\n+\tmaddn.s\t\tf6, f5, f6\n+\tmaddn.s\t\tf8, f4, f0\n+\tconst.s\t\tf3, 1\n+\tmaddn.s\t\tf3, f4, f6\n+\tmaddn.s\t\tf0, f8, f6\n+\tneg.s\t\tf2, f2\n+\tmaddn.s\t\tf6, f3, f6\n+\tmaddn.s\t\tf2, f4, f0\n+\taddexpm.s\tf0, f7\n+\taddexp.s\tf6, f7\n+\tdivn.s\t\tf0, f2, f6\n+\n+\trfr\t\ta2, f0\n+\n+\tleaf_return\n+\n+#else\n+\n+\t.literal_position\n __divsf3_aux:\n \n \t/* Handle unusual cases (zeros, subnormals, NaNs and Infinities).\n@@ -1112,6 +1156,8 @@ __divsf3:\n \tslli\ta2, a2, 31\n \tleaf_return\n \n+#endif /* XCHAL_HAVE_FP_DIV */\n+\n #endif /* L_divsf3 */\n \n #ifdef L_cmpsf2\n@@ -1757,3 +1803,111 @@ __floatdisf:\n \tleaf_return\n \n #endif /* L_floatdisf */\n+\n+#if XCHAL_HAVE_FP_SQRT\n+#ifdef L_sqrtf\n+\t/* Square root */\n+\n+\t.align\t4\n+\t.global\t__ieee754_sqrtf\n+\t.type\t__ieee754_sqrtf, @function\n+__ieee754_sqrtf:\n+\tleaf_entry\tsp, 16\n+\n+\twfr\t\tf1, a2\n+\n+\tsqrt0.s\t\tf2, f1\n+\tconst.s\t\tf3, 0\n+\tmaddn.s\t\tf3, f2, f2\n+\tnexp01.s\tf4, f1\n+\tconst.s\t\tf0, 3\n+\taddexp.s\tf4, f0\n+\tmaddn.s\t\tf0, f3, f4\n+\tnexp01.s\tf3, f1\n+\tneg.s\t\tf5, f3\n+\tmaddn.s\t\tf2, f0, f2\n+\tconst.s\t\tf0, 0\n+\tconst.s\t\tf6, 0\n+\tconst.s\t\tf7, 0\n+\tmaddn.s\t\tf0, f5, f2\n+\tmaddn.s\t\tf6, f2, f4\n+\tconst.s\t\tf4, 3\n+\tmaddn.s\t\tf7, f4, f2\n+\tmaddn.s\t\tf3, f0, f0\n+\tmaddn.s\t\tf4, f6, f2\n+\tneg.s\t\tf2, f7\n+\tmaddn.s\t\tf0, f3, f2\n+\tmaddn.s\t\tf7, f4, f7\n+\tmksadj.s\tf2, f1\n+\tnexp01.s\tf1, f1\n+\tmaddn.s\t\tf1, f0, f0\n+\tneg.s\t\tf3, f7\n+\taddexpm.s\tf0, f2\n+\taddexp.s\tf3, f2\n+\tdivn.s\t\tf0, f1, f3\n+\n+\trfr\t\ta2, f0\n+\n+\tleaf_return\n+\n+#endif /* L_sqrtf */\n+#endif /* XCHAL_HAVE_FP_SQRT */\n+\n+#if XCHAL_HAVE_FP_RECIP\n+#ifdef L_recipsf2\n+\t/* Reciprocal */\n+\n+\t.align\t4\n+\t.global\t__recipsf2\n+\t.type\t__recipsf2, @function\n+__recipsf2:\n+\tleaf_entry\tsp, 16\n+\n+\twfr\t\tf1, a2\n+\n+\trecip0.s\tf0, f1\n+\tconst.s\t\tf2, 1\n+\tmsub.s\t\tf2, f1, f0\n+\tmaddn.s\t\tf0, f0, f2\n+\tconst.s\t\tf2, 1\n+\tmsub.s\t\tf2, f1, f0\n+\tmaddn.s\t\tf0, f0, f2\n+\n+\trfr\t\ta2, f0\n+\n+\tleaf_return\n+\n+#endif /* L_recipsf2 */\n+#endif /* XCHAL_HAVE_FP_RECIP */\n+\n+#if XCHAL_HAVE_FP_RSQRT\n+#ifdef L_rsqrtsf2\n+\t/* Reciprocal square root */\n+\n+\t.align\t4\n+\t.global\t__rsqrtsf2\n+\t.type\t__rsqrtsf2, @function\n+__rsqrtsf2:\n+\tleaf_entry\tsp, 16\n+\n+\twfr\t\tf1, a2\n+\n+\trsqrt0.s\tf0, f1\n+\tmul.s\t\tf2, f1, f0\n+\tconst.s\t\tf3, 3;\n+\tmul.s\t\tf4, f3, f0\n+\tconst.s\t\tf5, 1\n+\tmsub.s\t\tf5, f2, f0\n+\tmaddn.s\t\tf0, f4, f5\n+\tmul.s\t\tf2, f1, f0\n+\tmul.s\t\tf1, f3, f0\n+\tconst.s\t\tf3, 1\n+\tmsub.s\t\tf3, f2, f0\n+\tmaddn.s\t\tf0, f1, f3\n+\n+\trfr\t\ta2, f0\n+\n+\tleaf_return\n+\n+#endif /* L_rsqrtsf2 */\n+#endif /* XCHAL_HAVE_FP_RSQRT */"}, {"sha": "90df5f15daa91146d8d9d095d3756b6aa53c1939", "filename": "libgcc/config/xtensa/t-xtensa", "status": "modified", "additions": 3, "deletions": 1, "changes": 4, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/66192aa1294360c2522e2e30fc45f84a81719419/libgcc%2Fconfig%2Fxtensa%2Ft-xtensa", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/66192aa1294360c2522e2e30fc45f84a81719419/libgcc%2Fconfig%2Fxtensa%2Ft-xtensa", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libgcc%2Fconfig%2Fxtensa%2Ft-xtensa?ref=66192aa1294360c2522e2e30fc45f84a81719419", "patch": "@@ -4,10 +4,12 @@ LIB1ASMFUNCS = _mulsi3 _divsi3 _modsi3 _udivsi3 _umodsi3 \\\n \t_ashldi3 _ashrdi3 _lshrdi3 \\\n \t_negsf2 _addsubsf3 _mulsf3 _divsf3 _cmpsf2 _fixsfsi _fixsfdi \\\n \t_fixunssfsi _fixunssfdi _floatsisf _floatunsisf \\\n+\t_sqrtf _recipsf2 _rsqrtsf2 \\\n \t_floatdisf _floatundisf \\\n \t_negdf2 _addsubdf3 _muldf3 _divdf3 _cmpdf2 _fixdfsi _fixdfdi \\\n \t_fixunsdfsi _fixunsdfdi _floatsidf _floatunsidf \\\n \t_floatdidf _floatundidf \\\n-\t_truncdfsf2 _extendsfdf2\n+\t_truncdfsf2 _extendsfdf2 \\\n+\t_sqrt _recipdf2 _rsqrtdf2\n \n LIB2ADD = $(srcdir)/config/xtensa/lib2funcs.S"}]}