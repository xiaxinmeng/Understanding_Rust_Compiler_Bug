{"sha": "817aed6fc35ad24f7a04f6a9ac6616d4a6915ff4", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6ODE3YWVkNmZjMzVhZDI0ZjdhMDRmNmE5YWM2NjE2ZDRhNjkxNWZmNA==", "commit": {"author": {"name": "Nathan Sidwell", "email": "nathan@codesourcery.com", "date": "2003-07-22T16:49:48Z"}, "committer": {"name": "Nathan Sidwell", "email": "nathan@gcc.gnu.org", "date": "2003-07-22T16:49:48Z"}, "message": "re PR c++/11614 (Incorrect handling of pointers to arrays)\n\ncp:\n\tPR c++/11614\n\t* decl.c (grokdeclarator): An array member is only a flexible\n\tarray member if the field itself is the array.\ntestsuite:\n\t* g++.dg/ext/flexary1.C: New test.\n\nFrom-SVN: r69673", "tree": {"sha": "9645e711506a5ff94abebf6f0db96dfe083c339e", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/9645e711506a5ff94abebf6f0db96dfe083c339e"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/817aed6fc35ad24f7a04f6a9ac6616d4a6915ff4", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/817aed6fc35ad24f7a04f6a9ac6616d4a6915ff4", "html_url": "https://github.com/Rust-GCC/gccrs/commit/817aed6fc35ad24f7a04f6a9ac6616d4a6915ff4", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/817aed6fc35ad24f7a04f6a9ac6616d4a6915ff4/comments", "author": null, "committer": null, "parents": [{"sha": "a2f7be91fc5f7347408fb24fe132194be4860bec", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/a2f7be91fc5f7347408fb24fe132194be4860bec", "html_url": "https://github.com/Rust-GCC/gccrs/commit/a2f7be91fc5f7347408fb24fe132194be4860bec"}], "stats": {"total": 55, "additions": 51, "deletions": 4}, "files": [{"sha": "8f37c7e872340d96229916a945815c4032be8c28", "filename": "gcc/cp/ChangeLog", "status": "modified", "additions": 6, "deletions": 0, "changes": 6, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/817aed6fc35ad24f7a04f6a9ac6616d4a6915ff4/gcc%2Fcp%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/817aed6fc35ad24f7a04f6a9ac6616d4a6915ff4/gcc%2Fcp%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fcp%2FChangeLog?ref=817aed6fc35ad24f7a04f6a9ac6616d4a6915ff4", "patch": "@@ -1,3 +1,9 @@\n+2003-07-22  Nathan Sidwell  <nathan@codesourcery.com>\n+\n+\tPR c++/11614\n+\t* decl.c (grokdeclarator): An array member is only a flexible\n+\tarray member if the field itself is the array.\n+\n 2003-07-22  Kriang Lerdsuwanakij  <lerdsuwa@users.sourceforge.net>\n \n \tPR c++/10793"}, {"sha": "22137be5967924bd7c2036d5ddde75d90d7d1faf", "filename": "gcc/cp/decl.c", "status": "modified", "additions": 8, "deletions": 4, "changes": 12, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/817aed6fc35ad24f7a04f6a9ac6616d4a6915ff4/gcc%2Fcp%2Fdecl.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/817aed6fc35ad24f7a04f6a9ac6616d4a6915ff4/gcc%2Fcp%2Fdecl.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fcp%2Fdecl.c?ref=817aed6fc35ad24f7a04f6a9ac6616d4a6915ff4", "patch": "@@ -10615,14 +10615,18 @@ grokdeclarator (tree declarator,\n \t    register tree size;\n \n \t    size = TREE_OPERAND (declarator, 1);\n+\t    declarator = TREE_OPERAND (declarator, 0);\n \n-\t    /* VC++ spells a zero-sized array with [].  */\n+\t    /* C99 spells a flexible array member [].  */\n \t    if (size == NULL_TREE && decl_context == FIELD && !\tstaticp\n-\t\t&& ! RIDBIT_SETP (RID_TYPEDEF, specbits))\n+\t\t&& ! RIDBIT_SETP (RID_TYPEDEF, specbits)\n+\t\t&& !(declarator &&\n+\t\t    (TREE_CODE (declarator) == CALL_EXPR\n+\t\t      || TREE_CODE (declarator) == INDIRECT_REF\n+\t\t      || TREE_CODE (declarator) == ADDR_EXPR\n+\t\t      || TREE_CODE (declarator) == ARRAY_REF)))\n \t      size = integer_zero_node;\n \n-\t    declarator = TREE_OPERAND (declarator, 0);\n-\n \t    type = create_array_type_for_decl (dname, type, size);\n \n \t    ctype = NULL_TREE;"}, {"sha": "085f25d4ec54a5c4401665b505e623ce84c5150b", "filename": "gcc/testsuite/ChangeLog", "status": "modified", "additions": 4, "deletions": 0, "changes": 4, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/817aed6fc35ad24f7a04f6a9ac6616d4a6915ff4/gcc%2Ftestsuite%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/817aed6fc35ad24f7a04f6a9ac6616d4a6915ff4/gcc%2Ftestsuite%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2FChangeLog?ref=817aed6fc35ad24f7a04f6a9ac6616d4a6915ff4", "patch": "@@ -1,3 +1,7 @@\n+2003-07-22  Nathan Sidwell  <nathan@codesourcery.com>\n+\n+\t* g++.dg/ext/flexary1.C: New test.\n+\t\n 2003-07-22  Kriang Lerdsuwanakij  <lerdsuwa@users.sourceforge.net>\n \n \tPR c++/10793"}, {"sha": "4033e339da011f150fad0a2c82f61b3886380462", "filename": "gcc/testsuite/g++.dg/ext/flexary1.C", "status": "added", "additions": 33, "deletions": 0, "changes": 33, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/817aed6fc35ad24f7a04f6a9ac6616d4a6915ff4/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Fext%2Fflexary1.C", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/817aed6fc35ad24f7a04f6a9ac6616d4a6915ff4/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Fext%2Fflexary1.C", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Fext%2Fflexary1.C?ref=817aed6fc35ad24f7a04f6a9ac6616d4a6915ff4", "patch": "@@ -0,0 +1,33 @@\n+// { dg-do compile }\n+\n+// Copyright (C) 2003 Free Software Foundation, Inc.\n+// Contributed by Nathan Sidwell 22 Jul 2003 <nathan@codesourcery.com>\n+\n+// PR c++ 11614\n+\n+typedef int ary_t[];\n+\n+struct test\n+{\n+  ary_t *b;\n+  int (*a)[]; // this is not a flexible array member\n+};\n+ \n+void test(void)\n+{\n+  struct test s;\n+  int (*a)[] = 0;\n+  ary_t *b = 0;\n+  \n+  a = s.a;\n+  a = s.b;\n+\n+  s.a = a;\n+  s.b = a;\n+\n+  b = s.a;\n+  b = s.b;\n+\n+  s.a = b;\n+  s.b = b;\n+}"}]}