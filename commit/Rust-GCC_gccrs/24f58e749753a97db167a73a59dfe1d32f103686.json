{"sha": "24f58e749753a97db167a73a59dfe1d32f103686", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6MjRmNThlNzQ5NzUzYTk3ZGIxNjdhNzNhNTlkZmUxZDMyZjEwMzY4Ng==", "commit": {"author": {"name": "Paolo Carlini", "email": "pcarlini@suse.de", "date": "2007-09-20T23:05:38Z"}, "committer": {"name": "Paolo Carlini", "email": "paolo@gcc.gnu.org", "date": "2007-09-20T23:05:38Z"}, "message": "re PR c++/33460 (ICE with static member in anonymous union)\n\ncp/\n2007-09-20  Paolo Carlini  <pcarlini@suse.de>\n\n\tPR c++/33460\n\t* semantics.c (finish_id_expression): Use consistently\n\tcontext_for_name_lookup.\n\t* decl.c (fixup_anonymous_aggr): Fix error message for\n\tanonymous struct (vs union).\n\ntestsuite/\n2007-09-20  Paolo Carlini  <pcarlini@suse.de>\n\n\tPR c++/33460\n\t* g++.dg/ext/anon-struct6.C: New.\n\nFrom-SVN: r128637", "tree": {"sha": "eeb3fc84c1a2e18eaf34351b6a02cbd84c8b4688", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/eeb3fc84c1a2e18eaf34351b6a02cbd84c8b4688"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/24f58e749753a97db167a73a59dfe1d32f103686", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/24f58e749753a97db167a73a59dfe1d32f103686", "html_url": "https://github.com/Rust-GCC/gccrs/commit/24f58e749753a97db167a73a59dfe1d32f103686", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/24f58e749753a97db167a73a59dfe1d32f103686/comments", "author": null, "committer": null, "parents": [{"sha": "fe046210e2d5fa3ac4c0d0d5d48f6851b1dcbe24", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/fe046210e2d5fa3ac4c0d0d5d48f6851b1dcbe24", "html_url": "https://github.com/Rust-GCC/gccrs/commit/fe046210e2d5fa3ac4c0d0d5d48f6851b1dcbe24"}], "stats": {"total": 47, "additions": 39, "deletions": 8}, "files": [{"sha": "c9316c695fc129910d2062c5dfa2f6b92d73c2dc", "filename": "gcc/cp/ChangeLog", "status": "modified", "additions": 8, "deletions": 0, "changes": 8, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/24f58e749753a97db167a73a59dfe1d32f103686/gcc%2Fcp%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/24f58e749753a97db167a73a59dfe1d32f103686/gcc%2Fcp%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fcp%2FChangeLog?ref=24f58e749753a97db167a73a59dfe1d32f103686", "patch": "@@ -1,3 +1,11 @@\n+2007-09-20  Paolo Carlini  <pcarlini@suse.de>\n+\n+\tPR c++/33460\n+\t* semantics.c (finish_id_expression): Use consistently\n+\tcontext_for_name_lookup.\n+\t* decl.c (fixup_anonymous_aggr): Fix error message for\n+\tanonymous struct (vs union).\n+\n 2007-09-19  Jason Merrill  <jason@redhat.com>\n \n \tPR c++/7586"}, {"sha": "c589a4bf5cdbd813f90f58ca9a6f5233d855e0c4", "filename": "gcc/cp/decl.c", "status": "modified", "additions": 8, "deletions": 2, "changes": 10, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/24f58e749753a97db167a73a59dfe1d32f103686/gcc%2Fcp%2Fdecl.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/24f58e749753a97db167a73a59dfe1d32f103686/gcc%2Fcp%2Fdecl.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fcp%2Fdecl.c?ref=24f58e749753a97db167a73a59dfe1d32f103686", "patch": "@@ -3704,8 +3704,14 @@ fixup_anonymous_aggr (tree t)\n \n   /* ISO C++ 9.5.3.  Anonymous unions may not have function members.  */\n   if (TYPE_METHODS (t))\n-    error (\"%Jan anonymous union cannot have function members\",\n-\t   TYPE_MAIN_DECL (t));\n+    {\n+      tree decl = TYPE_MAIN_DECL (t);\n+\n+      if (TREE_CODE (t) != UNION_TYPE)\n+\terror (\"%Jan anonymous struct cannot have function members\", decl);\n+      else\n+\terror (\"%Jan anonymous union cannot have function members\", decl);\n+    }\n \n   /* Anonymous aggregates cannot have fields with ctors, dtors or complex\n      assignment operators (because they cannot have these methods themselves)."}, {"sha": "b770269100d230b4e18a89ed2d4831f4ff37244f", "filename": "gcc/cp/semantics.c", "status": "modified", "additions": 8, "deletions": 6, "changes": 14, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/24f58e749753a97db167a73a59dfe1d32f103686/gcc%2Fcp%2Fsemantics.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/24f58e749753a97db167a73a59dfe1d32f103686/gcc%2Fcp%2Fsemantics.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fcp%2Fsemantics.c?ref=24f58e749753a97db167a73a59dfe1d32f103686", "patch": "@@ -2926,13 +2926,15 @@ finish_id_expression (tree id_expression,\n       else\n \t{\n \t  if (DECL_P (decl) && DECL_NONLOCAL (decl)\n-\t      && DECL_CLASS_SCOPE_P (decl)\n-\t      && context_for_name_lookup (decl) != current_class_type)\n+\t      && DECL_CLASS_SCOPE_P (decl))\n \t    {\n-\t      tree path;\n-\n-\t      path = currently_open_derived_class (DECL_CONTEXT (decl));\n-\t      perform_or_defer_access_check (TYPE_BINFO (path), decl, decl);\n+\t      tree context = context_for_name_lookup (decl); \n+\t      if (context != current_class_type)\n+\t\t{\n+\t\t  tree path = currently_open_derived_class (context);\n+\t\t  perform_or_defer_access_check (TYPE_BINFO (path),\n+\t\t\t\t\t\t decl, decl);\n+\t\t}\n \t    }\n \n \t  decl = convert_from_reference (decl);"}, {"sha": "3c6c9c82a8a2bf0083b477e8111ffefcfbeb0b5a", "filename": "gcc/testsuite/ChangeLog", "status": "modified", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/24f58e749753a97db167a73a59dfe1d32f103686/gcc%2Ftestsuite%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/24f58e749753a97db167a73a59dfe1d32f103686/gcc%2Ftestsuite%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2FChangeLog?ref=24f58e749753a97db167a73a59dfe1d32f103686", "patch": "@@ -1,3 +1,8 @@\n+2007-09-20  Paolo Carlini  <pcarlini@suse.de>\n+\n+\tPR c++/33460\n+\t* g++.dg/ext/anon-struct6.C: New.\n+\n 2007-09-21  Francois-Xavier Coudert  <fxcoudert@gcc.gnu.org>\n \n \tPR libfortran/23272"}, {"sha": "11a7bbd6076245a482d7905dc532aec3ad53ead2", "filename": "gcc/testsuite/g++.dg/ext/anon-struct6.C", "status": "added", "additions": 10, "deletions": 0, "changes": 10, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/24f58e749753a97db167a73a59dfe1d32f103686/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Fext%2Fanon-struct6.C", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/24f58e749753a97db167a73a59dfe1d32f103686/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Fext%2Fanon-struct6.C", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Fext%2Fanon-struct6.C?ref=24f58e749753a97db167a73a59dfe1d32f103686", "patch": "@@ -0,0 +1,10 @@\n+// PR c++/33460\n+\n+struct A\n+{\n+  struct\n+  {  // { dg-error \"anonymous struct cannot have function members\" }\n+    struct { static int i; }; // { dg-error \"prohibits anonymous structs|non-static data members\" } \n+    void foo() { i; }\n+  }; // { dg-error \"prohibits anonymous structs\" }\n+};"}]}