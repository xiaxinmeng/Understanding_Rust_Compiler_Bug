{"sha": "02149a789076495212f47452550971bc3c5a0b9a", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6MDIxNDlhNzg5MDc2NDk1MjEyZjQ3NDUyNTUwOTcxYmMzYzVhMGI5YQ==", "commit": {"author": {"name": "Richard Sandiford", "email": "richard.sandiford@linaro.org", "date": "2018-04-10T10:28:05Z"}, "committer": {"name": "Richard Sandiford", "email": "rsandifo@gcc.gnu.org", "date": "2018-04-10T10:28:05Z"}, "message": "Set insn_last_address in final_1\n\nfinal_1 already sets insn_current_address for each instruction, making\nit possible to use some of the address functions in final.c during\nassembly generation.  This patch also sets insn_last_address, since\nas the comment says, we can treat final as a shorten_branches pass that\ndoes nothing.  It's then possible to use insn_current_reference_address\nduring final as well.\n\nThis is needed for the aarch64.md definitions of far_branch to work:\n\n   (set (attr \"far_branch\")\n\t(if_then_else (and (ge (minus (match_dup 2) (pc)) (const_int -1048576))\n\t\t\t   (lt (minus (match_dup 2) (pc)) (const_int 1048572)))\n\t\t      (const_int 0)\n\t\t      (const_int 1)))]\n\nThis value (tested only during final) uses the difference between\nthe INSN_ADDRESSES of operand 2 and insn_current_reference_address\nto calculate a conservatively-correct estimate of the branch distance.\nIt takes into account the worst-case gap due to alignment, whereas\na direct comparison of INSN_ADDRESSES would give an unreliable,\noptimistic result.\n\n2018-04-10  Richard Sandiford  <richard.sandiford@linaro.org>\n\ngcc/\n\t* final.c (final_1): Set insn_last_address as well as\n\tinsn_current_address.\n\nFrom-SVN: r259267", "tree": {"sha": "020fe027bf566bd895a9f12a6310dd1f9061fc9d", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/020fe027bf566bd895a9f12a6310dd1f9061fc9d"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/02149a789076495212f47452550971bc3c5a0b9a", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/02149a789076495212f47452550971bc3c5a0b9a", "html_url": "https://github.com/Rust-GCC/gccrs/commit/02149a789076495212f47452550971bc3c5a0b9a", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/02149a789076495212f47452550971bc3c5a0b9a/comments", "author": null, "committer": null, "parents": [{"sha": "5c35bc3e16f0e238488423e37aed5dcbb9bfde46", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/5c35bc3e16f0e238488423e37aed5dcbb9bfde46", "html_url": "https://github.com/Rust-GCC/gccrs/commit/5c35bc3e16f0e238488423e37aed5dcbb9bfde46"}], "stats": {"total": 8, "additions": 8, "deletions": 0}, "files": [{"sha": "50484facbb9d32e7077deb10d11743519b4a691c", "filename": "gcc/ChangeLog", "status": "modified", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/02149a789076495212f47452550971bc3c5a0b9a/gcc%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/02149a789076495212f47452550971bc3c5a0b9a/gcc%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2FChangeLog?ref=02149a789076495212f47452550971bc3c5a0b9a", "patch": "@@ -1,3 +1,8 @@\n+2018-04-10  Richard Sandiford  <richard.sandiford@linaro.org>\n+\n+\t* final.c (final_1): Set insn_last_address as well as\n+\tinsn_current_address.\n+\n 2018-04-10  Kyrylo Tkachov  <kyrylo.tkachov@arm.com>\n \n \tPR target/85173"}, {"sha": "19817e240dacfeee1778b0bce7f7f8498eece55f", "filename": "gcc/final.c", "status": "modified", "additions": 3, "deletions": 0, "changes": 3, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/02149a789076495212f47452550971bc3c5a0b9a/gcc%2Ffinal.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/02149a789076495212f47452550971bc3c5a0b9a/gcc%2Ffinal.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ffinal.c?ref=02149a789076495212f47452550971bc3c5a0b9a", "patch": "@@ -2081,6 +2081,9 @@ final_1 (rtx_insn *first, FILE *file, int seen, int optimize_p)\n \t    }\n \t  else\n \t    insn_current_address = INSN_ADDRESSES (INSN_UID (insn));\n+\t  /* final can be seen as an iteration of shorten_branches that\n+\t     does nothing (since a fixed point has already been reached).  */\n+\t  insn_last_address = insn_current_address;\n \t}\n \n       dump_basic_block_info (file, insn, start_to_bb, end_to_bb,"}]}