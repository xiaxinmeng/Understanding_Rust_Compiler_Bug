{"sha": "a86416613524dc3f345afef4d66c19e7e35380df", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6YTg2NDE2NjEzNTI0ZGMzZjM0NWFmZWY0ZDY2YzE5ZTdlMzUzODBkZg==", "commit": {"author": {"name": "Nathan Sidwell", "email": "nathan@codesourcery.com", "date": "2001-01-12T09:13:16Z"}, "committer": {"name": "Nathan Sidwell", "email": "nathan@gcc.gnu.org", "date": "2001-01-12T09:13:16Z"}, "message": "friend.c (make_friend_class): Make sure a templated class is actually a template.\n\ncp:\n\t* friend.c (make_friend_class): Make sure a templated class is\n\tactually a template.\ntestsuite:\n\t* g++.old-deja/g++.pt/friend47.C: New test.\n\nFrom-SVN: r38939", "tree": {"sha": "e5057553b77437c2e9d30b11db8c1abefd968f62", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/e5057553b77437c2e9d30b11db8c1abefd968f62"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/a86416613524dc3f345afef4d66c19e7e35380df", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/a86416613524dc3f345afef4d66c19e7e35380df", "html_url": "https://github.com/Rust-GCC/gccrs/commit/a86416613524dc3f345afef4d66c19e7e35380df", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/a86416613524dc3f345afef4d66c19e7e35380df/comments", "author": null, "committer": null, "parents": [{"sha": "47d4f116352ea38ee0e0c156d9bd06eddb888fee", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/47d4f116352ea38ee0e0c156d9bd06eddb888fee", "html_url": "https://github.com/Rust-GCC/gccrs/commit/47d4f116352ea38ee0e0c156d9bd06eddb888fee"}], "stats": {"total": 71, "additions": 46, "deletions": 25}, "files": [{"sha": "1297b2f51077a451ce8b86d6cb822c883096014b", "filename": "gcc/cp/ChangeLog", "status": "modified", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/a86416613524dc3f345afef4d66c19e7e35380df/gcc%2Fcp%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/a86416613524dc3f345afef4d66c19e7e35380df/gcc%2Fcp%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fcp%2FChangeLog?ref=a86416613524dc3f345afef4d66c19e7e35380df", "patch": "@@ -1,3 +1,8 @@\n+2001-01-12  Nathan Sidwell  <nathan@codesourcery.com>\n+\n+\t* friend.c (make_friend_class): Make sure a templated class is\n+\tactually a template.\n+\n 2001-01-11  Nathan Sidwell  <nathan@codesourcery.com>\n \n \t* decl2.c (get_guard): Set linkage from guarded decl."}, {"sha": "b817c7c391793b5baab3c36eabc35eee802c591d", "filename": "gcc/cp/friend.c", "status": "modified", "additions": 23, "deletions": 25, "changes": 48, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/a86416613524dc3f345afef4d66c19e7e35380df/gcc%2Fcp%2Ffriend.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/a86416613524dc3f345afef4d66c19e7e35380df/gcc%2Fcp%2Ffriend.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fcp%2Ffriend.c?ref=a86416613524dc3f345afef4d66c19e7e35380df", "patch": "@@ -225,32 +225,30 @@ make_friend_class (type, friend_type)\n   else\n     is_template_friend = 0;\n \n-  if (is_template_friend \n-      && (TREE_CODE (friend_type) == TYPENAME_TYPE\n-\t  || TREE_CODE (friend_type) == TEMPLATE_TYPE_PARM))\n+  /* [temp.friend]\n+\n+     A friend of a class or class template can be a function or\n+     class template, a specialization of a function template or\n+     class template, or an ordinary (nontemplate) function or\n+     class. */\n+  if (!is_template_friend)\n+    ;/* ok */\n+  else if (TREE_CODE (friend_type) == TYPENAME_TYPE)\n     {\n-      /* [temp.friend]\n-\n-\t   A friend of a class or class template can be a function or\n-\t   class template, a specialization of a function template or\n-\t   class template, or an ordinary (nontemplate) function or\n-\t   class. \n-\t   \n-\t But, we're looking at something like:\n-\n-\t   template <class T> friend typename S<T>::X;\n-\n-\t or:\n-\n-\t   template <class T> friend class T;\n-\n-\t which isn't any of these.  */\n-      if (TREE_CODE (friend_type) == TYPENAME_TYPE)\n-\tcp_error (\"typename type `%T' declared `friend'\",\n-\t\t  friend_type);\n-      else\n-\tcp_error (\"template parameter type `%T' declared `friend'\",\n-\t\t  friend_type);\n+      /* template <class T> friend typename S<T>::X; */\n+      cp_error (\"typename type `%#T' declared `friend'\", friend_type);\n+      return;\n+    }\n+  else if (TREE_CODE (friend_type) == TEMPLATE_TYPE_PARM)\n+    {\n+      /* template <class T> friend class T; */\n+      cp_error (\"template parameter type `%T' declared `friend'\", friend_type);\n+      return;\n+    }\n+  else if (!CLASSTYPE_TEMPLATE_INFO (friend_type))\n+    {\n+      /* template <class T> friend class A; where A is not a template */\n+      cp_error (\"`%#T' is not a template\", friend_type);\n       return;\n     }\n "}, {"sha": "8c413ab4e0226d1d001ca9d3d5f60f569390feb5", "filename": "gcc/testsuite/ChangeLog", "status": "modified", "additions": 4, "deletions": 0, "changes": 4, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/a86416613524dc3f345afef4d66c19e7e35380df/gcc%2Ftestsuite%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/a86416613524dc3f345afef4d66c19e7e35380df/gcc%2Ftestsuite%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2FChangeLog?ref=a86416613524dc3f345afef4d66c19e7e35380df", "patch": "@@ -1,3 +1,7 @@\n+2001-01-12  Nathan Sidwell  <nathan@codesourcery.com>\n+\n+\t* g++.old-deja/g++.pt/friend47.C: New test.\n+\n 2001-01-11  Nathan Sidwell  <nathan@codesourcery.com>\n \n \t* g++.old-deja/g++.pt/instantiate13.C: New test."}, {"sha": "37aa921d18bb323dedf85dab9dc50d2f6361febd", "filename": "gcc/testsuite/g++.old-deja/g++.pt/friend47.C", "status": "added", "additions": 14, "deletions": 0, "changes": 14, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/a86416613524dc3f345afef4d66c19e7e35380df/gcc%2Ftestsuite%2Fg%2B%2B.old-deja%2Fg%2B%2B.pt%2Ffriend47.C", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/a86416613524dc3f345afef4d66c19e7e35380df/gcc%2Ftestsuite%2Fg%2B%2B.old-deja%2Fg%2B%2B.pt%2Ffriend47.C", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fg%2B%2B.old-deja%2Fg%2B%2B.pt%2Ffriend47.C?ref=a86416613524dc3f345afef4d66c19e7e35380df", "patch": "@@ -0,0 +1,14 @@\n+// Build don't link:\n+\n+// Copyright (C) 2000 Free Software Foundation, Inc.\n+// Contributed by Nathan Sidwell 7 Jan 2001 <nathan@codesourcery.com>\n+\n+// Bug 1033. We ICE'd when trying to make a non template class a templated\n+// friend.\n+\n+class A {};\n+class B {\n+  template<class T> friend class A;   // ERROR - not a template\n+};\n+\n+"}]}