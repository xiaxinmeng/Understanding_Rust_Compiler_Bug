{"sha": "7349698ee4147cf36862081e21736d4c2b96b9d9", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6NzM0OTY5OGVlNDE0N2NmMzY4NjIwODFlMjE3MzZkNGMyYjk2YjlkOQ==", "commit": {"author": {"name": "Jan Hubicka", "email": "hubicka@ucw.cz", "date": "2017-11-23T15:59:07Z"}, "committer": {"name": "Jan Hubicka", "email": "hubicka@gcc.gnu.org", "date": "2017-11-23T15:59:07Z"}, "message": "ipa-profile.c (ipa_propagate_frequency_1): Use count instead of frequency.\n\n\t* ipa-profile.c (ipa_propagate_frequency_1): Use count instead of\n\tfrequency.\n\t* cgraph.c (cgraph_edge::dump_edge_flags): Dump sreal frequencies.\n\t(cgraph_edge::maybe_hot_p): Use sreal frequencies.\n\nFrom-SVN: r255104", "tree": {"sha": "535b11fd8653e7e3108910ce67f9a0965e43310a", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/535b11fd8653e7e3108910ce67f9a0965e43310a"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/7349698ee4147cf36862081e21736d4c2b96b9d9", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/7349698ee4147cf36862081e21736d4c2b96b9d9", "html_url": "https://github.com/Rust-GCC/gccrs/commit/7349698ee4147cf36862081e21736d4c2b96b9d9", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/7349698ee4147cf36862081e21736d4c2b96b9d9/comments", "author": null, "committer": null, "parents": [{"sha": "0009a6c3c7d7c9c31d253558b602c35d3ad51d1b", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/0009a6c3c7d7c9c31d253558b602c35d3ad51d1b", "html_url": "https://github.com/Rust-GCC/gccrs/commit/0009a6c3c7d7c9c31d253558b602c35d3ad51d1b"}], "stats": {"total": 27, "additions": 14, "deletions": 13}, "files": [{"sha": "b9852e98e832bb424e76b579d57b3b01e69356f9", "filename": "gcc/ChangeLog", "status": "modified", "additions": 7, "deletions": 0, "changes": 7, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/7349698ee4147cf36862081e21736d4c2b96b9d9/gcc%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/7349698ee4147cf36862081e21736d4c2b96b9d9/gcc%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2FChangeLog?ref=7349698ee4147cf36862081e21736d4c2b96b9d9", "patch": "@@ -1,3 +1,10 @@\n+2017-11-23  Jan Hubicka  <hubicka@ucw.cz>\n+\n+\t* ipa-profile.c (ipa_propagate_frequency_1): Use count instead of\n+\tfrequency.\n+\t* cgraph.c (cgraph_edge::dump_edge_flags): Dump sreal frequencies.\n+\t(cgraph_edge::maybe_hot_p): Use sreal frequencies.\n+\n 2017-11-23  Jan Hubicka  <hubicka@ucw.cz>\n \n \t* ipa-fnsummary.c (record_modified_bb_info): Use sreal"}, {"sha": "7ac58ce91c1aea4145b87f8175f68a377c0c35d3", "filename": "gcc/cgraph.c", "status": "modified", "additions": 6, "deletions": 12, "changes": 18, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/7349698ee4147cf36862081e21736d4c2b96b9d9/gcc%2Fcgraph.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/7349698ee4147cf36862081e21736d4c2b96b9d9/gcc%2Fcgraph.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fcgraph.c?ref=7349698ee4147cf36862081e21736d4c2b96b9d9", "patch": "@@ -2024,7 +2024,7 @@ cgraph_edge::dump_edge_flags (FILE *f)\n       fprintf (f, \"(\");\n       count.dump (f);\n       fprintf (f, \",\");\n-      fprintf (f, \"%.2f per call) \", frequency () / (double)CGRAPH_FREQ_BASE);\n+      fprintf (f, \"%.2f per call) \", sreal_frequency ().to_double ());\n     }\n   if (can_throw_external)\n     fprintf (f, \"(can throw external) \");\n@@ -2811,15 +2811,11 @@ cgraph_edge::maybe_hot_p (void)\n   if (symtab->state < IPA_SSA)\n     return true;\n   if (caller->frequency == NODE_FREQUENCY_EXECUTED_ONCE\n-      && frequency () < CGRAPH_FREQ_BASE * 3 / 2)\n+      && sreal_frequency () * 2 < 3)\n+    return false;\n+  if (PARAM_VALUE (HOT_BB_FREQUENCY_FRACTION) == 0\n+      || sreal_frequency () * PARAM_VALUE (HOT_BB_FREQUENCY_FRACTION) <= 1)\n     return false;\n-  if (opt_for_fn (caller->decl, flag_guess_branch_prob))\n-    {\n-      if (PARAM_VALUE (HOT_BB_FREQUENCY_FRACTION) == 0\n-\t  || frequency () <= (CGRAPH_FREQ_BASE\n-\t\t\t   / PARAM_VALUE (HOT_BB_FREQUENCY_FRACTION)))\n-        return false;\n-    }\n   return true;\n }\n \n@@ -3880,9 +3876,7 @@ cgraph_node::has_thunk_p (cgraph_node *node, void *)\n   return false;\n }\n \n-/* Expected frequency of executions within the function.\n-   When set to CGRAPH_FREQ_BASE, the edge is expected to be called once\n-   per function call.  The range is 0 to CGRAPH_FREQ_MAX.  */\n+/* Expected frequency of executions within the function.  */\n \n sreal\n cgraph_edge::sreal_frequency ()"}, {"sha": "7c7c0d0faea42e069c1615ba89573cebeabcb85e", "filename": "gcc/ipa-profile.c", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/7349698ee4147cf36862081e21736d4c2b96b9d9/gcc%2Fipa-profile.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/7349698ee4147cf36862081e21736d4c2b96b9d9/gcc%2Fipa-profile.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fipa-profile.c?ref=7349698ee4147cf36862081e21736d4c2b96b9d9", "patch": "@@ -340,7 +340,7 @@ ipa_propagate_frequency_1 (struct cgraph_node *node, void *data)\n \t\t  && edge->caller->global.inlined_to->frequency\n \t\t     != NODE_FREQUENCY_UNLIKELY_EXECUTED)))\n \t  d->maybe_unlikely_executed = false;\n-      if (!edge->frequency ())\n+      if (edge->count.initialized_p () && !edge->count.nonzero_p ())\n \tcontinue;\n       switch (edge->caller->frequency)\n         {"}]}