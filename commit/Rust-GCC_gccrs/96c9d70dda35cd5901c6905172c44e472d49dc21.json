{"sha": "96c9d70dda35cd5901c6905172c44e472d49dc21", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6OTZjOWQ3MGRkYTM1Y2Q1OTAxYzY5MDUxNzJjNDRlNDcyZDQ5ZGMyMQ==", "commit": {"author": {"name": "Richard Kenner", "email": "kenner@gcc.gnu.org", "date": "1994-07-30T16:54:26Z"}, "committer": {"name": "Richard Kenner", "email": "kenner@gcc.gnu.org", "date": "1994-07-30T16:54:26Z"}, "message": "(tablejump): Rework to look like normal add but verify that label is for next insn and is tablejump...\n\n(tablejump): Rework to look like normal add but verify that label is\nfor next insn and is tablejump; look for ADDR_DIFF_ELT.\n\nFrom-SVN: r7831", "tree": {"sha": "1e392c1d1b880f9fbed9c70c9957d31f9a1ee5b2", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/1e392c1d1b880f9fbed9c70c9957d31f9a1ee5b2"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/96c9d70dda35cd5901c6905172c44e472d49dc21", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/96c9d70dda35cd5901c6905172c44e472d49dc21", "html_url": "https://github.com/Rust-GCC/gccrs/commit/96c9d70dda35cd5901c6905172c44e472d49dc21", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/96c9d70dda35cd5901c6905172c44e472d49dc21/comments", "author": null, "committer": null, "parents": [{"sha": "260ced47a74fd7867dac1853f75f9a6837501869", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/260ced47a74fd7867dac1853f75f9a6837501869", "html_url": "https://github.com/Rust-GCC/gccrs/commit/260ced47a74fd7867dac1853f75f9a6837501869"}], "stats": {"total": 22, "additions": 12, "deletions": 10}, "files": [{"sha": "93dec2c12d99d6418c321862081c58bcfade7bb3", "filename": "gcc/config/alpha/alpha.md", "status": "modified", "additions": 12, "deletions": 10, "changes": 22, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/96c9d70dda35cd5901c6905172c44e472d49dc21/gcc%2Fconfig%2Falpha%2Falpha.md", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/96c9d70dda35cd5901c6905172c44e472d49dc21/gcc%2Fconfig%2Falpha%2Falpha.md", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fconfig%2Falpha%2Falpha.md?ref=96c9d70dda35cd5901c6905172c44e472d49dc21", "patch": "@@ -2546,8 +2546,9 @@\n (define_expand \"tablejump\"\n   [(set (match_dup 3)\n \t(sign_extend:DI (match_operand:SI 0 \"register_operand\" \"\")))\n-   (parallel [(set (pc) (plus:DI (match_dup 3) (reg:DI 29)))\n-\t      (use (label_ref (match_operand 1 \"\" \"\")))\n+   (parallel [(set (pc)\n+\t\t   (plus:DI (match_dup 3)\n+\t\t\t    (label_ref:DI (match_operand 1 \"\" \"\"))))\n \t      (clobber (match_scratch:DI 2 \"=r\"))])]\n   \"\"\n   \"\n@@ -2556,19 +2557,20 @@\n (define_insn \"\"\n   [(set (pc)\n \t(plus:DI (match_operand:DI 0 \"register_operand\" \"r\")\n-\t\t (reg:DI 29)))\n-   (use (label_ref (match_operand 1 \"\" \"\")))\n+\t\t (label_ref:DI (match_operand 1 \"\" \"\"))))\n    (clobber (match_scratch:DI 2 \"=r\"))]\n-  \"\"\n+  \"next_active_insn (insn) != 0\n+   && GET_CODE (PATTERN (next_active_insn (insn))) == ADDR_DIFF_VEC\n+   && PREV_INSN (next_active_insn (insn)) == operands[1]\"\n   \"*\n { rtx best_label = 0;\n   rtx jump_table_insn = next_active_insn (operands[1]);\n \n   if (GET_CODE (jump_table_insn) == JUMP_INSN\n-      && GET_CODE (PATTERN (jump_table_insn)) == ADDR_VEC)\n+      && GET_CODE (PATTERN (jump_table_insn)) == ADDR_DIFF_VEC)\n     {\n       rtx jump_table = PATTERN (jump_table_insn);\n-      int n_labels = XVECLEN (jump_table, 0);\n+      int n_labels = XVECLEN (jump_table, 1);\n       int best_count = -1;\n       int i, j;\n \n@@ -2577,12 +2579,12 @@\n \t  int count = 1;\n \n \t  for (j = i + 1; j < n_labels; j++)\n-\t    if (XEXP (XVECEXP (jump_table, 0, i), 0)\n-\t\t== XEXP (XVECEXP (jump_table, 0, j), 0))\n+\t    if (XEXP (XVECEXP (jump_table, 1, i), 0)\n+\t\t== XEXP (XVECEXP (jump_table, 1, j), 0))\n \t      count++;\n \n \t  if (count > best_count)\n-\t    best_count = count, best_label = XVECEXP (jump_table, 0, i);\n+\t    best_count = count, best_label = XVECEXP (jump_table, 1, i);\n \t}\n     }\n "}]}