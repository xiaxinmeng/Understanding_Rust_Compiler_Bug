{"sha": "15ed55eabb0cf8a2974b8025a9f46c9e58960811", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6MTVlZDU1ZWFiYjBjZjhhMjk3NGI4MDI1YTlmNDZjOWU1ODk2MDgxMQ==", "commit": {"author": {"name": "Marek Polacek", "email": "polacek@redhat.com", "date": "2020-01-22T16:44:13Z"}, "committer": {"name": "Marek Polacek", "email": "polacek@redhat.com", "date": "2020-01-22T16:44:13Z"}, "message": "PR c++/93324 - ICE with -Wall on constexpr if.\n\nThis is a crash with constexpr if, when trying to see if the call in\nthe if-statement is std::is_constant_evaluated.\n\ncp_get_callee_fndecl_nofold can return NULL_TREE and fndecl_built_in_p\ndoesn't expect to get a null tree, so check FNDECL first.", "tree": {"sha": "4f2efc2b13abc0a38a5ff2385d61e6ef30fd27a0", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/4f2efc2b13abc0a38a5ff2385d61e6ef30fd27a0"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/15ed55eabb0cf8a2974b8025a9f46c9e58960811", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/15ed55eabb0cf8a2974b8025a9f46c9e58960811", "html_url": "https://github.com/Rust-GCC/gccrs/commit/15ed55eabb0cf8a2974b8025a9f46c9e58960811", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/15ed55eabb0cf8a2974b8025a9f46c9e58960811/comments", "author": {"login": "mpolacek", "id": 10496300, "node_id": "MDQ6VXNlcjEwNDk2MzAw", "avatar_url": "https://avatars.githubusercontent.com/u/10496300?v=4", "gravatar_id": "", "url": "https://api.github.com/users/mpolacek", "html_url": "https://github.com/mpolacek", "followers_url": "https://api.github.com/users/mpolacek/followers", "following_url": "https://api.github.com/users/mpolacek/following{/other_user}", "gists_url": "https://api.github.com/users/mpolacek/gists{/gist_id}", "starred_url": "https://api.github.com/users/mpolacek/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/mpolacek/subscriptions", "organizations_url": "https://api.github.com/users/mpolacek/orgs", "repos_url": "https://api.github.com/users/mpolacek/repos", "events_url": "https://api.github.com/users/mpolacek/events{/privacy}", "received_events_url": "https://api.github.com/users/mpolacek/received_events", "type": "User", "site_admin": false}, "committer": {"login": "mpolacek", "id": 10496300, "node_id": "MDQ6VXNlcjEwNDk2MzAw", "avatar_url": "https://avatars.githubusercontent.com/u/10496300?v=4", "gravatar_id": "", "url": "https://api.github.com/users/mpolacek", "html_url": "https://github.com/mpolacek", "followers_url": "https://api.github.com/users/mpolacek/followers", "following_url": "https://api.github.com/users/mpolacek/following{/other_user}", "gists_url": "https://api.github.com/users/mpolacek/gists{/gist_id}", "starred_url": "https://api.github.com/users/mpolacek/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/mpolacek/subscriptions", "organizations_url": "https://api.github.com/users/mpolacek/orgs", "repos_url": "https://api.github.com/users/mpolacek/repos", "events_url": "https://api.github.com/users/mpolacek/events{/privacy}", "received_events_url": "https://api.github.com/users/mpolacek/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "bf91504dc23f17248df6302f7bad849f3ddedee7", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/bf91504dc23f17248df6302f7bad849f3ddedee7", "html_url": "https://github.com/Rust-GCC/gccrs/commit/bf91504dc23f17248df6302f7bad849f3ddedee7"}], "stats": {"total": 29, "additions": 29, "deletions": 0}, "files": [{"sha": "d9946997ba093e8d12c46b126e5a33cf990b9b84", "filename": "gcc/cp/ChangeLog", "status": "modified", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/15ed55eabb0cf8a2974b8025a9f46c9e58960811/gcc%2Fcp%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/15ed55eabb0cf8a2974b8025a9f46c9e58960811/gcc%2Fcp%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fcp%2FChangeLog?ref=15ed55eabb0cf8a2974b8025a9f46c9e58960811", "patch": "@@ -1,3 +1,8 @@\n+2020-01-22  Marek Polacek  <polacek@redhat.com>\n+\n+\tPR c++/93324 - ICE with -Wall on constexpr if.\n+\t* semantics.c (is_std_constant_evaluated_p): Check fndecl.\n+\n 2020-01-22  Patrick Palka  <ppalka@redhat.com>\n \n \t* constraint.cc (get_mapped_args): Avoid using auto_vec"}, {"sha": "3b88f1520bc88e7b879b5acaa98b1f8276882531", "filename": "gcc/cp/semantics.c", "status": "modified", "additions": 3, "deletions": 0, "changes": 3, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/15ed55eabb0cf8a2974b8025a9f46c9e58960811/gcc%2Fcp%2Fsemantics.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/15ed55eabb0cf8a2974b8025a9f46c9e58960811/gcc%2Fcp%2Fsemantics.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fcp%2Fsemantics.c?ref=15ed55eabb0cf8a2974b8025a9f46c9e58960811", "patch": "@@ -734,6 +734,9 @@ is_std_constant_evaluated_p (tree fn)\n     return false;\n \n   tree fndecl = cp_get_callee_fndecl_nofold (fn);\n+  if (fndecl == NULL_TREE)\n+    return false;\n+\n   if (fndecl_built_in_p (fndecl, CP_BUILT_IN_IS_CONSTANT_EVALUATED,\n \t\t\t BUILT_IN_FRONTEND))\n     return true;"}, {"sha": "70d7e8869e1816dc811952856bedb61a5b72c365", "filename": "gcc/testsuite/ChangeLog", "status": "modified", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/15ed55eabb0cf8a2974b8025a9f46c9e58960811/gcc%2Ftestsuite%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/15ed55eabb0cf8a2974b8025a9f46c9e58960811/gcc%2Ftestsuite%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2FChangeLog?ref=15ed55eabb0cf8a2974b8025a9f46c9e58960811", "patch": "@@ -1,3 +1,8 @@\n+2020-01-22  Marek Polacek  <polacek@redhat.com>\n+\n+\tPR c++/93324 - ICE with -Wall on constexpr if.\n+\t* g++.dg/cpp1z/constexpr-if33.C: New test.\n+\n 2020-01-22  Richard Sandiford  <richard.sandiford@arm.com>\n \n \t* gcc.target/aarch64/sve/acle/general/stack_vars_1.c: New test."}, {"sha": "e5ef659932b3b343b5ba1703d16d989902c5ad92", "filename": "gcc/testsuite/g++.dg/cpp1z/constexpr-if33.C", "status": "added", "additions": 16, "deletions": 0, "changes": 16, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/15ed55eabb0cf8a2974b8025a9f46c9e58960811/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Fcpp1z%2Fconstexpr-if33.C", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/15ed55eabb0cf8a2974b8025a9f46c9e58960811/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Fcpp1z%2Fconstexpr-if33.C", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Fcpp1z%2Fconstexpr-if33.C?ref=15ed55eabb0cf8a2974b8025a9f46c9e58960811", "patch": "@@ -0,0 +1,16 @@\n+// PR c++/93324 - ICE with -Wall on constexpr if.\n+// { dg-do compile { target c++17 } }\n+// { dg-options \"-Wall\" }\n+\n+struct {\n+  template <int>\n+  static constexpr bool a() { return 0; }\n+} e;\n+\n+template <typename>\n+void d()\n+{\n+  auto c(e);\n+  using b = decltype(c);\n+  if constexpr (b::a<2>());\n+}"}]}