{"sha": "3d3b81932db70022b4479171a030006a78e65299", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6M2QzYjgxOTMyZGI3MDAyMmI0NDc5MTcxYTAzMDAwNmE3OGU2NTI5OQ==", "commit": {"author": {"name": "Thomas Koenig", "email": "tkoenig@gcc.gnu.org", "date": "2012-04-29T07:12:03Z"}, "committer": {"name": "Thomas Koenig", "email": "tkoenig@gcc.gnu.org", "date": "2012-04-29T07:12:03Z"}, "message": "re PR fortran/53148 (Incorrect intrinsic function parsing on labeled statements when compiled w/ -ffrontend-optimize)\n\n2012-04-29  Thomas Koenig  <tkoenig@gcc.gnu.org>\n\n\tPR fortran/53148\n\t* frontend-passes.c (create_var):  If the statement has a label,\n\tput the label around the block.\n\n2012-04-29  Thomas Koenig  <tkoenig@gcc.gnu.org>\n\n\tPR fortran/53148\n\t* gfortran.dg/function_optimize_12.f90:  New test.\n\nFrom-SVN: r186942", "tree": {"sha": "f047a54fdce92d366bf2790915eec148ec7a6365", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/f047a54fdce92d366bf2790915eec148ec7a6365"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/3d3b81932db70022b4479171a030006a78e65299", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/3d3b81932db70022b4479171a030006a78e65299", "html_url": "https://github.com/Rust-GCC/gccrs/commit/3d3b81932db70022b4479171a030006a78e65299", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/3d3b81932db70022b4479171a030006a78e65299/comments", "author": null, "committer": null, "parents": [{"sha": "78900a5421c526fe58475d686673d8929629ecba", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/78900a5421c526fe58475d686673d8929629ecba", "html_url": "https://github.com/Rust-GCC/gccrs/commit/78900a5421c526fe58475d686673d8929629ecba"}], "stats": {"total": 33, "additions": 33, "deletions": 0}, "files": [{"sha": "8d0490469f4a2c1d0b198e026a0362400dae6df6", "filename": "gcc/fortran/ChangeLog", "status": "modified", "additions": 6, "deletions": 0, "changes": 6, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/3d3b81932db70022b4479171a030006a78e65299/gcc%2Ffortran%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/3d3b81932db70022b4479171a030006a78e65299/gcc%2Ffortran%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ffortran%2FChangeLog?ref=3d3b81932db70022b4479171a030006a78e65299", "patch": "@@ -1,3 +1,9 @@\n+2012-04-29  Thomas Koenig  <tkoenig@gcc.gnu.org>\n+\n+\tPR fortran/53148\n+\t* frontend-passes.c (create_var):  If the statement has a label,\n+\tput the label around the block.\n+\n 2012-04-25  Tobias Burnus  <burnus@net-b.de>\n \n \tPR fortran/52196"}, {"sha": "92a3f8fb3b273f5bc7eb500cfc36a1fdbdb05bb7", "filename": "gcc/fortran/frontend-passes.c", "status": "modified", "additions": 10, "deletions": 0, "changes": 10, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/3d3b81932db70022b4479171a030006a78e65299/gcc%2Ffortran%2Ffrontend-passes.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/3d3b81932db70022b4479171a030006a78e65299/gcc%2Ffortran%2Ffrontend-passes.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ffortran%2Ffrontend-passes.c?ref=3d3b81932db70022b4479171a030006a78e65299", "patch": "@@ -271,6 +271,16 @@ create_var (gfc_expr * e)\n       inserted_block->ext.block.assoc = NULL;\n \n       ns->code = *current_code;\n+\n+      /* If the statement has a label,  make sure it is transferred to\n+\t the newly created block.  */\n+\n+      if ((*current_code)->here) \n+\t{\n+\t  inserted_block->here = (*current_code)->here;\n+\t  (*current_code)->here = NULL;\n+\t}\n+\n       inserted_block->next = (*current_code)->next;\n       changed_statement = &(inserted_block->ext.block.ns->code);\n       (*current_code)->next = NULL;"}, {"sha": "a5e7cf2ec05479adefd47fa5e61e1e9fa94637df", "filename": "gcc/testsuite/ChangeLog", "status": "modified", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/3d3b81932db70022b4479171a030006a78e65299/gcc%2Ftestsuite%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/3d3b81932db70022b4479171a030006a78e65299/gcc%2Ftestsuite%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2FChangeLog?ref=3d3b81932db70022b4479171a030006a78e65299", "patch": "@@ -1,3 +1,8 @@\n+2012-04-29  Thomas Koenig  <tkoenig@gcc.gnu.org>\n+\n+\tPR fortran/53148\n+\t* gfortran.dg/function_optimize_12.f90:  New test.\n+\n 2012-04-29  Hans-Peter Nilsson  <hp@axis.com>\n \n \tPR target/53156"}, {"sha": "3c49add5ae716023eb5652f425f49d732ece7163", "filename": "gcc/testsuite/gfortran.dg/function_optimize_12.f90", "status": "added", "additions": 12, "deletions": 0, "changes": 12, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/3d3b81932db70022b4479171a030006a78e65299/gcc%2Ftestsuite%2Fgfortran.dg%2Ffunction_optimize_12.f90", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/3d3b81932db70022b4479171a030006a78e65299/gcc%2Ftestsuite%2Fgfortran.dg%2Ffunction_optimize_12.f90", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgfortran.dg%2Ffunction_optimize_12.f90?ref=3d3b81932db70022b4479171a030006a78e65299", "patch": "@@ -0,0 +1,12 @@\n+! { dg-do run }\n+! { dg-options \"-ffrontend-optimize\" }\n+! PR 53148 - this used to cause wrong code because the label was\n+! placed after the statement assigning the new variables.\n+program main\n+  integer :: n\n+  double precision x\n+  n = 3\n+  goto 100\n+100 x = dble(n) + dble(n)\n+  if (x /= 6.d0) call abort\n+end program main"}]}