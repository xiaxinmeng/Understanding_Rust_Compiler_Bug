{"sha": "ea4dd8f512979db247c54d6b41377bb73699bcd7", "node_id": "C_kwDOANBUbNoAKGVhNGRkOGY1MTI5NzlkYjI0N2M1NGQ2YjQxMzc3YmI3MzY5OWJjZDc", "commit": {"author": {"name": "Jason Merrill", "email": "jason@redhat.com", "date": "2023-03-15T20:33:37Z"}, "committer": {"name": "Jason Merrill", "email": "jason@redhat.com", "date": "2023-03-15T22:29:39Z"}, "message": "c++: co_await and initializer_list [PR103871]\n\nWhen flatten_await_stmt processes the backing array for an initializer_list,\nwe call cp_build_modify_expr to initialize the promoted variable from the\nTARGET_EXPR; that needs to be accepted.\n\n\tPR c++/103871\n\tPR c++/98056\n\ngcc/cp/ChangeLog:\n\n\t* typeck.cc (cp_build_modify_expr): Allow array initialization of\n\tDECL_ARTIFICIAL variable.\n\ngcc/testsuite/ChangeLog:\n\n\t* g++.dg/coroutines/co-await-initlist1.C: New test.", "tree": {"sha": "a62e8a53f54ee4aaff82c96bc04637ab0c993e47", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/a62e8a53f54ee4aaff82c96bc04637ab0c993e47"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/ea4dd8f512979db247c54d6b41377bb73699bcd7", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/ea4dd8f512979db247c54d6b41377bb73699bcd7", "html_url": "https://github.com/Rust-GCC/gccrs/commit/ea4dd8f512979db247c54d6b41377bb73699bcd7", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/ea4dd8f512979db247c54d6b41377bb73699bcd7/comments", "author": {"login": "jicama", "id": 266146, "node_id": "MDQ6VXNlcjI2NjE0Ng==", "avatar_url": "https://avatars.githubusercontent.com/u/266146?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jicama", "html_url": "https://github.com/jicama", "followers_url": "https://api.github.com/users/jicama/followers", "following_url": "https://api.github.com/users/jicama/following{/other_user}", "gists_url": "https://api.github.com/users/jicama/gists{/gist_id}", "starred_url": "https://api.github.com/users/jicama/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jicama/subscriptions", "organizations_url": "https://api.github.com/users/jicama/orgs", "repos_url": "https://api.github.com/users/jicama/repos", "events_url": "https://api.github.com/users/jicama/events{/privacy}", "received_events_url": "https://api.github.com/users/jicama/received_events", "type": "User", "site_admin": false}, "committer": {"login": "jicama", "id": 266146, "node_id": "MDQ6VXNlcjI2NjE0Ng==", "avatar_url": "https://avatars.githubusercontent.com/u/266146?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jicama", "html_url": "https://github.com/jicama", "followers_url": "https://api.github.com/users/jicama/followers", "following_url": "https://api.github.com/users/jicama/following{/other_user}", "gists_url": "https://api.github.com/users/jicama/gists{/gist_id}", "starred_url": "https://api.github.com/users/jicama/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jicama/subscriptions", "organizations_url": "https://api.github.com/users/jicama/orgs", "repos_url": "https://api.github.com/users/jicama/repos", "events_url": "https://api.github.com/users/jicama/events{/privacy}", "received_events_url": "https://api.github.com/users/jicama/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "79aaba0a71f34ac1ac2c4cec907ff74740a6cf1a", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/79aaba0a71f34ac1ac2c4cec907ff74740a6cf1a", "html_url": "https://github.com/Rust-GCC/gccrs/commit/79aaba0a71f34ac1ac2c4cec907ff74740a6cf1a"}], "stats": {"total": 23, "additions": 23, "deletions": 0}, "files": [{"sha": "afb956087ce1599118134acefb597c120bd2f5da", "filename": "gcc/cp/typeck.cc", "status": "modified", "additions": 2, "deletions": 0, "changes": 2, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/ea4dd8f512979db247c54d6b41377bb73699bcd7/gcc%2Fcp%2Ftypeck.cc", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/ea4dd8f512979db247c54d6b41377bb73699bcd7/gcc%2Fcp%2Ftypeck.cc", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fcp%2Ftypeck.cc?ref=ea4dd8f512979db247c54d6b41377bb73699bcd7", "patch": "@@ -9630,6 +9630,8 @@ cp_build_modify_expr (location_t loc, tree lhs, enum tree_code modifycode,\n \t}\n \n       /* Allow array assignment in compiler-generated code.  */\n+      else if (DECL_P (lhs) && DECL_ARTIFICIAL (lhs))\n+\t/* OK, used by coroutines (co-await-initlist1.C).  */;\n       else if (!current_function_decl\n \t       || !DECL_DEFAULTED_FN (current_function_decl))\n \t{"}, {"sha": "b8e8923a9c81e336e6826c85429ffe5d4fdfc7bd", "filename": "gcc/testsuite/g++.dg/coroutines/co-await-initlist1.C", "status": "added", "additions": 21, "deletions": 0, "changes": 21, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/ea4dd8f512979db247c54d6b41377bb73699bcd7/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Fcoroutines%2Fco-await-initlist1.C", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/ea4dd8f512979db247c54d6b41377bb73699bcd7/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Fcoroutines%2Fco-await-initlist1.C", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Fcoroutines%2Fco-await-initlist1.C?ref=ea4dd8f512979db247c54d6b41377bb73699bcd7", "patch": "@@ -0,0 +1,21 @@\n+// PR c++/103871\n+// { dg-do compile { target c++20 } }\n+\n+#include <coroutine>\n+#include <initializer_list>\n+\n+struct my_coro {\n+  struct promise_type {\n+    my_coro get_return_object();\n+    std::suspend_never initial_suspend();\n+    std::suspend_never final_suspend() noexcept;\n+    void unhandled_exception();\n+  };\n+};\n+\n+std::suspend_never inner(std::initializer_list<int>);\n+\n+my_coro doesnt_work()\n+{\n+  co_await inner({ 1,2,3 });\n+}"}]}