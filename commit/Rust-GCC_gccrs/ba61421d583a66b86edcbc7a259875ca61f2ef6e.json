{"sha": "ba61421d583a66b86edcbc7a259875ca61f2ef6e", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6YmE2MTQyMWQ1ODNhNjZiODZlZGNiYzdhMjU5ODc1Y2E2MWYyZWY2ZQ==", "commit": {"author": {"name": "H.J. Lu", "email": "hongjiu.lu@intel.com", "date": "2012-03-11T16:37:45Z"}, "committer": {"name": "H.J. Lu", "email": "hjl@gcc.gnu.org", "date": "2012-03-11T16:37:45Z"}, "message": "Check ptr_mode and use Pmode in ix86_trampoline_init\n\n2012-03-11  H.J. Lu  <hongjiu.lu@intel.com>\n\n\t* config/i386/i386.c (ix86_trampoline_init): Use movl for 64bit if\n\tptr_mode == SImode.  Replace DImode with Pmode or ptr_mode.\n\nFrom-SVN: r185197", "tree": {"sha": "517bb1e2aae3b7213523a6823f60e4af1a2c39b0", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/517bb1e2aae3b7213523a6823f60e4af1a2c39b0"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/ba61421d583a66b86edcbc7a259875ca61f2ef6e", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/ba61421d583a66b86edcbc7a259875ca61f2ef6e", "html_url": "https://github.com/Rust-GCC/gccrs/commit/ba61421d583a66b86edcbc7a259875ca61f2ef6e", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/ba61421d583a66b86edcbc7a259875ca61f2ef6e/comments", "author": {"login": "hjl-tools", "id": 1072356, "node_id": "MDQ6VXNlcjEwNzIzNTY=", "avatar_url": "https://avatars.githubusercontent.com/u/1072356?v=4", "gravatar_id": "", "url": "https://api.github.com/users/hjl-tools", "html_url": "https://github.com/hjl-tools", "followers_url": "https://api.github.com/users/hjl-tools/followers", "following_url": "https://api.github.com/users/hjl-tools/following{/other_user}", "gists_url": "https://api.github.com/users/hjl-tools/gists{/gist_id}", "starred_url": "https://api.github.com/users/hjl-tools/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/hjl-tools/subscriptions", "organizations_url": "https://api.github.com/users/hjl-tools/orgs", "repos_url": "https://api.github.com/users/hjl-tools/repos", "events_url": "https://api.github.com/users/hjl-tools/events{/privacy}", "received_events_url": "https://api.github.com/users/hjl-tools/received_events", "type": "User", "site_admin": false}, "committer": null, "parents": [{"sha": "649507afb03f0e5cc688215f49fce8597518f0dd", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/649507afb03f0e5cc688215f49fce8597518f0dd", "html_url": "https://github.com/Rust-GCC/gccrs/commit/649507afb03f0e5cc688215f49fce8597518f0dd"}], "stats": {"total": 20, "additions": 14, "deletions": 6}, "files": [{"sha": "a3b135108213bbbb143d88269051e060a4199e97", "filename": "gcc/ChangeLog", "status": "modified", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/ba61421d583a66b86edcbc7a259875ca61f2ef6e/gcc%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/ba61421d583a66b86edcbc7a259875ca61f2ef6e/gcc%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2FChangeLog?ref=ba61421d583a66b86edcbc7a259875ca61f2ef6e", "patch": "@@ -1,3 +1,8 @@\n+2012-03-11  H.J. Lu  <hongjiu.lu@intel.com>\n+\n+\t* config/i386/i386.c (ix86_trampoline_init): Use movl for 64bit if\n+\tptr_mode == SImode.  Replace DImode with Pmode or ptr_mode.\n+\n 2012-03-11  H.J. Lu  <hongjiu.lu@intel.com>\n \n \t* config/i386/i386.c (x86_this_parameter): Replace DImode with"}, {"sha": "f74914fbe405eb8b97db615bacb2c832565c31a2", "filename": "gcc/config/i386/i386.c", "status": "modified", "additions": 9, "deletions": 6, "changes": 15, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/ba61421d583a66b86edcbc7a259875ca61f2ef6e/gcc%2Fconfig%2Fi386%2Fi386.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/ba61421d583a66b86edcbc7a259875ca61f2ef6e/gcc%2Fconfig%2Fi386%2Fi386.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fconfig%2Fi386%2Fi386.c?ref=ba61421d583a66b86edcbc7a259875ca61f2ef6e", "patch": "@@ -24309,10 +24309,13 @@ ix86_trampoline_init (rtx m_tramp, tree fndecl, rtx chain_value)\n       /* Load the function address to r11.  Try to load address using\n \t the shorter movl instead of movabs.  We may want to support\n \t movq for kernel mode, but kernel does not use trampolines at\n-\t the moment.  */\n-      if (x86_64_zext_immediate_operand (fnaddr, VOIDmode))\n+\t the moment.  FNADDR is a 32bit address and may not be in\n+\t DImode when ptr_mode == SImode.  Always use movl in this\n+\t case.  */\n+      if (ptr_mode == SImode\n+\t  || x86_64_zext_immediate_operand (fnaddr, VOIDmode))\n \t{\n-\t  fnaddr = copy_to_mode_reg (DImode, fnaddr);\n+\t  fnaddr = copy_to_mode_reg (Pmode, fnaddr);\n \n \t  mem = adjust_address (m_tramp, HImode, offset);\n \t  emit_move_insn (mem, gen_int_mode (0xbb41, HImode));\n@@ -24331,9 +24334,9 @@ ix86_trampoline_init (rtx m_tramp, tree fndecl, rtx chain_value)\n \t  offset += 10;\n \t}\n \n-      /* Load static chain using movabs to r10.  Use the\n-\t shorter movl instead of movabs for x32.  */\n-      if (TARGET_X32)\n+      /* Load static chain using movabs to r10.  Use the shorter movl\n+         instead of movabs when ptr_mode == SImode.  */\n+      if (ptr_mode == SImode)\n \t{\n \t  opcode = 0xba41;\n \t  size = 6;"}]}