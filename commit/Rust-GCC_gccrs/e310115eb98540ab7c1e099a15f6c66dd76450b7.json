{"sha": "e310115eb98540ab7c1e099a15f6c66dd76450b7", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6ZTMxMDExNWViOTg1NDBhYjdjMWUwOTlhMTVmNmM2NmRkNzY0NTBiNw==", "commit": {"author": {"name": "Arnaud Charlet", "email": "charlet@gcc.gnu.org", "date": "2015-10-26T11:29:34Z"}, "committer": {"name": "Arnaud Charlet", "email": "charlet@gcc.gnu.org", "date": "2015-10-26T11:29:34Z"}, "message": "Code clean ups.\n\nFrom-SVN: r229335", "tree": {"sha": "9c7d8ff583c0a37ec1798f9226fc7014fd550d53", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/9c7d8ff583c0a37ec1798f9226fc7014fd550d53"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/e310115eb98540ab7c1e099a15f6c66dd76450b7", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/e310115eb98540ab7c1e099a15f6c66dd76450b7", "html_url": "https://github.com/Rust-GCC/gccrs/commit/e310115eb98540ab7c1e099a15f6c66dd76450b7", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/e310115eb98540ab7c1e099a15f6c66dd76450b7/comments", "author": null, "committer": null, "parents": [{"sha": "ca7e6c2640e197797b544a7238d1e362f85c2921", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/ca7e6c2640e197797b544a7238d1e362f85c2921", "html_url": "https://github.com/Rust-GCC/gccrs/commit/ca7e6c2640e197797b544a7238d1e362f85c2921"}], "stats": {"total": 41, "additions": 23, "deletions": 18}, "files": [{"sha": "5ef60948d7c5e4a55b037ec2f6a58c056b94affa", "filename": "gcc/ada/contracts.adb", "status": "modified", "additions": 23, "deletions": 18, "changes": 41, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/e310115eb98540ab7c1e099a15f6c66dd76450b7/gcc%2Fada%2Fcontracts.adb", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/e310115eb98540ab7c1e099a15f6c66dd76450b7/gcc%2Fada%2Fcontracts.adb", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fada%2Fcontracts.adb?ref=e310115eb98540ab7c1e099a15f6c66dd76450b7", "patch": "@@ -431,20 +431,9 @@ package body Contracts is\n       Prag_Nam  : Name_Id;\n \n    begin\n-      --  Do not analyze the contract of an entry declaration unless annotating\n-      --  the original tree. It is preferable to analyze the contract after the\n-      --  entry declaration has been transformed into a subprogram declaration\n-      --  to properly handle references to unpacked formals.\n-\n-      if Ekind_In (Subp_Id, E_Entry, E_Entry_Family)\n-        and then not ASIS_Mode\n-        and then not GNATprove_Mode\n-      then\n-         return;\n-\n       --  Do not analyze a contract multiple times\n \n-      elsif Present (Items) then\n+      if Present (Items) then\n          if Analyzed (Items) then\n             return;\n          else\n@@ -467,13 +456,29 @@ package body Contracts is\n \n       elsif Present (Items) then\n \n-         --  Analyze pre- and postconditions\n+         --  Do not analyze the pre/postconditions of an entry declaration\n+         --  unless annotating the original tree for ASIS or GNATprove.\n \n-         Prag := Pre_Post_Conditions (Items);\n-         while Present (Prag) loop\n-            Analyze_Pre_Post_Condition_In_Decl_Part (Prag);\n-            Prag := Next_Pragma (Prag);\n-         end loop;\n+         --  ??? References to formals are causing problems during contract\n+         --  expansion as the references resolve to the entry formals, not\n+         --  the subprogram body emulating the entry body. This will have to\n+         --  be addressed.\n+\n+         if Ekind_In (Subp_Id, E_Entry, E_Entry_Family)\n+           and then not ASIS_Mode\n+           and then not GNATprove_Mode\n+         then\n+            null;\n+\n+         --  Otherwise analyze the pre/postconditions\n+\n+         else\n+            Prag := Pre_Post_Conditions (Items);\n+            while Present (Prag) loop\n+               Analyze_Pre_Post_Condition_In_Decl_Part (Prag);\n+               Prag := Next_Pragma (Prag);\n+            end loop;\n+         end if;\n \n          --  Analyze contract-cases and test-cases\n "}]}