{"sha": "35e24106fc1b782e70f8339e0a1321a2bc7a7f15", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6MzVlMjQxMDZmYzFiNzgyZTcwZjgzMzllMGExMzIxYTJiYzdhN2YxNQ==", "commit": {"author": {"name": "David Malcolm", "email": "dmalcolm@redhat.com", "date": "2019-11-21T17:30:45Z"}, "committer": {"name": "David Malcolm", "email": "dmalcolm@redhat.com", "date": "2020-02-12T01:58:38Z"}, "message": "analyzer: g++ testsuite support\n\nPR analyzer/93288 reports a C++-specific ICE with -fanalyzer.\n\nThis patch creates the beginnings of a C++ test suite for the analyzer,\nso that there's a place to put test coverage for the fix.\nIt adds a regression test for PR analyzer/93212, an ICE fixed\nin r10-5970-g32077b693df8e3ed0424031a322df23822bf2f7e.\n\ngcc/testsuite/ChangeLog:\n\tPR analyzer/93212\n\t* g++.dg/analyzer/analyzer.exp: New subdirectory and .exp suite.\n\t* g++.dg/analyzer/malloc.C: New test.\n\t* g++.dg/analyzer/pr93212.C: New test.", "tree": {"sha": "5028693a43030791c10a0fd7330acf20b0894342", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/5028693a43030791c10a0fd7330acf20b0894342"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/35e24106fc1b782e70f8339e0a1321a2bc7a7f15", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/35e24106fc1b782e70f8339e0a1321a2bc7a7f15", "html_url": "https://github.com/Rust-GCC/gccrs/commit/35e24106fc1b782e70f8339e0a1321a2bc7a7f15", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/35e24106fc1b782e70f8339e0a1321a2bc7a7f15/comments", "author": {"login": "davidmalcolm", "id": 1553248, "node_id": "MDQ6VXNlcjE1NTMyNDg=", "avatar_url": "https://avatars.githubusercontent.com/u/1553248?v=4", "gravatar_id": "", "url": "https://api.github.com/users/davidmalcolm", "html_url": "https://github.com/davidmalcolm", "followers_url": "https://api.github.com/users/davidmalcolm/followers", "following_url": "https://api.github.com/users/davidmalcolm/following{/other_user}", "gists_url": "https://api.github.com/users/davidmalcolm/gists{/gist_id}", "starred_url": "https://api.github.com/users/davidmalcolm/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/davidmalcolm/subscriptions", "organizations_url": "https://api.github.com/users/davidmalcolm/orgs", "repos_url": "https://api.github.com/users/davidmalcolm/repos", "events_url": "https://api.github.com/users/davidmalcolm/events{/privacy}", "received_events_url": "https://api.github.com/users/davidmalcolm/received_events", "type": "User", "site_admin": false}, "committer": {"login": "davidmalcolm", "id": 1553248, "node_id": "MDQ6VXNlcjE1NTMyNDg=", "avatar_url": "https://avatars.githubusercontent.com/u/1553248?v=4", "gravatar_id": "", "url": "https://api.github.com/users/davidmalcolm", "html_url": "https://github.com/davidmalcolm", "followers_url": "https://api.github.com/users/davidmalcolm/followers", "following_url": "https://api.github.com/users/davidmalcolm/following{/other_user}", "gists_url": "https://api.github.com/users/davidmalcolm/gists{/gist_id}", "starred_url": "https://api.github.com/users/davidmalcolm/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/davidmalcolm/subscriptions", "organizations_url": "https://api.github.com/users/davidmalcolm/orgs", "repos_url": "https://api.github.com/users/davidmalcolm/repos", "events_url": "https://api.github.com/users/davidmalcolm/events{/privacy}", "received_events_url": "https://api.github.com/users/davidmalcolm/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "3889b0cb458370072839ec27fb03881fa4cbe94d", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/3889b0cb458370072839ec27fb03881fa4cbe94d", "html_url": "https://github.com/Rust-GCC/gccrs/commit/3889b0cb458370072839ec27fb03881fa4cbe94d"}], "stats": {"total": 82, "additions": 82, "deletions": 0}, "files": [{"sha": "c077000d3047ba8c7eeca72046d753519516adcd", "filename": "gcc/testsuite/ChangeLog", "status": "modified", "additions": 7, "deletions": 0, "changes": 7, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/35e24106fc1b782e70f8339e0a1321a2bc7a7f15/gcc%2Ftestsuite%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/35e24106fc1b782e70f8339e0a1321a2bc7a7f15/gcc%2Ftestsuite%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2FChangeLog?ref=35e24106fc1b782e70f8339e0a1321a2bc7a7f15", "patch": "@@ -1,3 +1,10 @@\n+2020-02-11  David Malcolm  <dmalcolm@redhat.com>\n+\n+\tPR analyzer/93212\n+\t* g++.dg/analyzer/analyzer.exp: New subdirectory and .exp suite.\n+\t* g++.dg/analyzer/malloc.C: New test.\n+\t* g++.dg/analyzer/pr93212.C: New test.\n+\n 2020-02-11  Martin Sebor  <msebor@redhat.com>\n \n \tPR tree-optimization/93683"}, {"sha": "60262f678eed00473a53a711c50555ad76d5524a", "filename": "gcc/testsuite/g++.dg/analyzer/analyzer.exp", "status": "added", "additions": 49, "deletions": 0, "changes": 49, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/35e24106fc1b782e70f8339e0a1321a2bc7a7f15/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Fanalyzer%2Fanalyzer.exp", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/35e24106fc1b782e70f8339e0a1321a2bc7a7f15/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Fanalyzer%2Fanalyzer.exp", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Fanalyzer%2Fanalyzer.exp?ref=35e24106fc1b782e70f8339e0a1321a2bc7a7f15", "patch": "@@ -0,0 +1,49 @@\n+#   Copyright (C) 2020 Free Software Foundation, Inc.\n+\n+# This program is free software; you can redistribute it and/or modify\n+# it under the terms of the GNU General Public License as published by\n+# the Free Software Foundation; either version 3 of the License, or\n+# (at your option) any later version.\n+#\n+# This program is distributed in the hope that it will be useful,\n+# but WITHOUT ANY WARRANTY; without even the implied warranty of\n+# MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n+# GNU General Public License for more details.\n+#\n+# You should have received a copy of the GNU General Public License\n+# along with GCC; see the file COPYING3.  If not see\n+# <http://www.gnu.org/licenses/>.\n+\n+# G++ testsuite that uses the `dg.exp' driver.\n+\n+# Load support procs.\n+load_lib g++-dg.exp\n+\n+# If the analyzer has not been enabled, bail.\n+if { ![check_effective_target_analyzer] } {\n+    return\n+}\n+\n+if [info exists DEFAULT_CXXFLAGS] then {\n+  set save_default_cxxflags $DEFAULT_CXXFLAGS\n+}\n+\n+# If a testcase doesn't have special options, use these.\n+set DEFAULT_CXXFLAGS \" -fanalyzer -fdiagnostics-path-format=separate-events -Wanalyzer-too-complex -fanalyzer-call-summaries\"\n+\n+# Initialize `dg'.\n+dg-init\n+\n+# Main loop.\n+set tests [lsort [glob -nocomplain $srcdir/$subdir/*.C]]\n+\n+g++-dg-runtest $tests \"\" $DEFAULT_CXXFLAGS\n+\n+# All done.\n+dg-finish\n+\n+if [info exists save_default_cxxflags] {\n+  set DEFAULT_CXXFLAGS $save_default_cxxflags\n+} else {\n+  unset DEFAULT_CXXFLAGS\n+}"}, {"sha": "0637295e1f2009f4a122e76e03432fe1e1525c8e", "filename": "gcc/testsuite/g++.dg/analyzer/malloc.C", "status": "added", "additions": 9, "deletions": 0, "changes": 9, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/35e24106fc1b782e70f8339e0a1321a2bc7a7f15/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Fanalyzer%2Fmalloc.C", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/35e24106fc1b782e70f8339e0a1321a2bc7a7f15/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Fanalyzer%2Fmalloc.C", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Fanalyzer%2Fmalloc.C?ref=35e24106fc1b782e70f8339e0a1321a2bc7a7f15", "patch": "@@ -0,0 +1,9 @@\n+// { dg-do compile }\n+\n+#include <stdlib.h>\n+\n+void test_1 (void *ptr)\n+{\n+  free (ptr);\n+  free (ptr); /* { dg-warning \"double-'free' of 'ptr'\" } */\n+}"}, {"sha": "cfbb42d2275a172af5d42ba4f4d33086d73fe1bb", "filename": "gcc/testsuite/g++.dg/analyzer/pr93212.C", "status": "added", "additions": 17, "deletions": 0, "changes": 17, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/35e24106fc1b782e70f8339e0a1321a2bc7a7f15/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Fanalyzer%2Fpr93212.C", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/35e24106fc1b782e70f8339e0a1321a2bc7a7f15/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Fanalyzer%2Fpr93212.C", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Fanalyzer%2Fpr93212.C?ref=35e24106fc1b782e70f8339e0a1321a2bc7a7f15", "patch": "@@ -0,0 +1,17 @@\n+// { dg-do compile { target c++11 } }\n+\n+#include <iostream>\n+auto lol()\n+{\n+    int aha = 3;\n+    return [&aha] {\n+        return aha;\n+    };\n+}\n+\n+int main()\n+{\n+    auto lambda = lol();\n+    std::cout << lambda() << std::endl;\n+    return 0;\n+}"}]}