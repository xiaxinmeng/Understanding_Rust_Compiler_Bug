{"sha": "aab1da2af490f53c882ff7508b640c782dbc68f8", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6YWFiMWRhMmFmNDkwZjUzYzg4MmZmNzUwOGI2NDBjNzgyZGJjNjhmOA==", "commit": {"author": {"name": "Hristian Kirtchev", "email": "kirtchev@adacore.com", "date": "2018-05-28T08:53:22Z"}, "committer": {"name": "Pierre-Marie de Rodat", "email": "pmderodat@gcc.gnu.org", "date": "2018-05-28T08:53:22Z"}, "message": "[Ada] Spurious error on aspect Volatile\n\nThis patch modifies the analysis of aspect/pragma Volatile to correct accept\nthe annotation when it applies to single protected and single task types, and\nSPARK_Mode On is in effect.\n\n------------\n-- Source --\n------------\n\n--  pack.ads\n\npackage Pack with SPARK_Mode is\n   protected PO_Aspect with Volatile is end;                         --  OK\n\n   protected PO_Pragma is end;\n   pragma Volatile (PO_Pragma);                                      --  OK\n\n   task TO_Aspect with Volatile;                                     --  OK\n\n   task TO_Pragma;\n   pragma Volatile (TO_Pragma);                                      --  OK\nend Pack;\n\n----------------------------\n-- Compilation and output --\n----------------------------\n\n$ gcc -c pack.ads\n$ gcc -c pack.ads -gnatd.F\ncannot generate code for file pack.ads (package spec)\n\n2018-05-28  Hristian Kirtchev  <kirtchev@adacore.com>\n\ngcc/ada/\n\n\t* sem_prag.adb (Process_Atomic_Independent_Shared_Volatile): Include\n\tthe declarations of single concurrent types because they fall in the\n\tcategory of full type and object declarations.\n\nFrom-SVN: r260820", "tree": {"sha": "57256f3d4e74f7f9a76bb475c393383020f8cc4b", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/57256f3d4e74f7f9a76bb475c393383020f8cc4b"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/aab1da2af490f53c882ff7508b640c782dbc68f8", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/aab1da2af490f53c882ff7508b640c782dbc68f8", "html_url": "https://github.com/Rust-GCC/gccrs/commit/aab1da2af490f53c882ff7508b640c782dbc68f8", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/aab1da2af490f53c882ff7508b640c782dbc68f8/comments", "author": {"login": "kirtchev-adacore", "id": 60669983, "node_id": "MDQ6VXNlcjYwNjY5OTgz", "avatar_url": "https://avatars.githubusercontent.com/u/60669983?v=4", "gravatar_id": "", "url": "https://api.github.com/users/kirtchev-adacore", "html_url": "https://github.com/kirtchev-adacore", "followers_url": "https://api.github.com/users/kirtchev-adacore/followers", "following_url": "https://api.github.com/users/kirtchev-adacore/following{/other_user}", "gists_url": "https://api.github.com/users/kirtchev-adacore/gists{/gist_id}", "starred_url": "https://api.github.com/users/kirtchev-adacore/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/kirtchev-adacore/subscriptions", "organizations_url": "https://api.github.com/users/kirtchev-adacore/orgs", "repos_url": "https://api.github.com/users/kirtchev-adacore/repos", "events_url": "https://api.github.com/users/kirtchev-adacore/events{/privacy}", "received_events_url": "https://api.github.com/users/kirtchev-adacore/received_events", "type": "User", "site_admin": false}, "committer": null, "parents": [{"sha": "c8e95568a1fa2957eca057c659497aed2b58bfd3", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/c8e95568a1fa2957eca057c659497aed2b58bfd3", "html_url": "https://github.com/Rust-GCC/gccrs/commit/c8e95568a1fa2957eca057c659497aed2b58bfd3"}], "stats": {"total": 14, "additions": 11, "deletions": 3}, "files": [{"sha": "324645dd9700873e55b03df851094fad4b29456f", "filename": "gcc/ada/ChangeLog", "status": "modified", "additions": 6, "deletions": 0, "changes": 6, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/aab1da2af490f53c882ff7508b640c782dbc68f8/gcc%2Fada%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/aab1da2af490f53c882ff7508b640c782dbc68f8/gcc%2Fada%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fada%2FChangeLog?ref=aab1da2af490f53c882ff7508b640c782dbc68f8", "patch": "@@ -1,3 +1,9 @@\n+2018-05-28  Hristian Kirtchev  <kirtchev@adacore.com>\n+\n+\t* sem_prag.adb (Process_Atomic_Independent_Shared_Volatile): Include\n+\tthe declarations of single concurrent types because they fall in the\n+\tcategory of full type and object declarations.\n+\n 2018-05-28  Eric Botcazou  <ebotcazou@adacore.com>\n \n \t* repinfo.adb (Compute_Max_Length): Skip _Parent component."}, {"sha": "ae340aade447537be3d3f3261775f8f4b06de064", "filename": "gcc/ada/sem_prag.adb", "status": "modified", "additions": 5, "deletions": 3, "changes": 8, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/aab1da2af490f53c882ff7508b640c782dbc68f8/gcc%2Fada%2Fsem_prag.adb", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/aab1da2af490f53c882ff7508b640c782dbc68f8/gcc%2Fada%2Fsem_prag.adb", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fada%2Fsem_prag.adb?ref=aab1da2af490f53c882ff7508b640c782dbc68f8", "patch": "@@ -7399,9 +7399,11 @@ package body Sem_Prag is\n \n          if SPARK_Mode = On\n            and then Prag_Id = Pragma_Volatile\n-           and then\n-             not Nkind_In (Original_Node (Decl), N_Full_Type_Declaration,\n-                                                 N_Object_Declaration)\n+           and then not Nkind_In (Original_Node (Decl),\n+                                  N_Full_Type_Declaration,\n+                                  N_Object_Declaration,\n+                                  N_Single_Protected_Declaration,\n+                                  N_Single_Task_Declaration)\n          then\n             Error_Pragma_Arg\n               (\"argument of pragma % must denote a full type or object \""}]}