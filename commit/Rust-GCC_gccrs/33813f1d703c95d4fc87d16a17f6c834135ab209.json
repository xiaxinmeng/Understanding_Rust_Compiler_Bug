{"sha": "33813f1d703c95d4fc87d16a17f6c834135ab209", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6MzM4MTNmMWQ3MDNjOTVkNGZjODdkMTZhMTdmNmM4MzQxMzVhYjIwOQ==", "commit": {"author": {"name": "Jakub Jelinek", "email": "jakub@gcc.gnu.org", "date": "2019-03-13T08:24:41Z"}, "committer": {"name": "Jakub Jelinek", "email": "jakub@gcc.gnu.org", "date": "2019-03-13T08:24:41Z"}, "message": "re PR middle-end/88588 (ICE in make_decl_rtl, at varasm.c:1329)\n\n\tPR middle-end/88588\n\t* omp-simd-clone.c (ipa_simd_modify_stmt_ops): Handle PHI args.\n\t(ipa_simd_modify_function_body): Handle PHIs.\n\n\t* c-c++-common/gomp/pr88588.c: New test.\n\nFrom-SVN: r269636", "tree": {"sha": "ccbc0a45737f85203c30868918bf2f903829cb07", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/ccbc0a45737f85203c30868918bf2f903829cb07"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/33813f1d703c95d4fc87d16a17f6c834135ab209", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/33813f1d703c95d4fc87d16a17f6c834135ab209", "html_url": "https://github.com/Rust-GCC/gccrs/commit/33813f1d703c95d4fc87d16a17f6c834135ab209", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/33813f1d703c95d4fc87d16a17f6c834135ab209/comments", "author": null, "committer": null, "parents": [{"sha": "55b9c612573a120ea39f0a80a51b3b1757248f12", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/55b9c612573a120ea39f0a80a51b3b1757248f12", "html_url": "https://github.com/Rust-GCC/gccrs/commit/55b9c612573a120ea39f0a80a51b3b1757248f12"}], "stats": {"total": 81, "additions": 79, "deletions": 2}, "files": [{"sha": "74ed2670675edf2497670edc221f126526d43f39", "filename": "gcc/ChangeLog", "status": "modified", "additions": 6, "deletions": 0, "changes": 6, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/33813f1d703c95d4fc87d16a17f6c834135ab209/gcc%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/33813f1d703c95d4fc87d16a17f6c834135ab209/gcc%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2FChangeLog?ref=33813f1d703c95d4fc87d16a17f6c834135ab209", "patch": "@@ -1,3 +1,9 @@\n+2019-03-13  Jakub Jelinek  <jakub@redhat.com>\n+\n+\tPR middle-end/88588\n+\t* omp-simd-clone.c (ipa_simd_modify_stmt_ops): Handle PHI args.\n+\t(ipa_simd_modify_function_body): Handle PHIs.\n+\n 2019-03-12  Robin Dapp  <rdapp@linux.ibm.com>\n \n \t* config/s390/s390.c (s390_option_override_internal): Use more"}, {"sha": "472e2025e19b5ccc2837593f23fce190b0da8e72", "filename": "gcc/omp-simd-clone.c", "status": "modified", "additions": 49, "deletions": 1, "changes": 50, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/33813f1d703c95d4fc87d16a17f6c834135ab209/gcc%2Fomp-simd-clone.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/33813f1d703c95d4fc87d16a17f6c834135ab209/gcc%2Fomp-simd-clone.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fomp-simd-clone.c?ref=33813f1d703c95d4fc87d16a17f6c834135ab209", "patch": "@@ -866,6 +866,18 @@ ipa_simd_modify_stmt_ops (tree *tp, int *walk_subtrees, void *data)\n \n   if (tp != orig_tp)\n     {\n+      if (gimple_code (info->stmt) == GIMPLE_PHI\n+\t  && cand\n+\t  && TREE_CODE (*orig_tp) == ADDR_EXPR\n+\t  && TREE_CODE (TREE_OPERAND (*orig_tp, 0)) == PARM_DECL\n+\t  && cand->alias_ptr_type)\n+\t{\n+\t  gcc_assert (TREE_CODE (cand->alias_ptr_type) == SSA_NAME);\n+\t  *orig_tp = cand->alias_ptr_type;\n+\t  info->modified = true;\n+\t  return NULL_TREE;\n+\t}\n+\n       repl = build_fold_addr_expr (repl);\n       gimple *stmt;\n       if (is_gimple_debug (info->stmt))\n@@ -882,7 +894,18 @@ ipa_simd_modify_stmt_ops (tree *tp, int *walk_subtrees, void *data)\n \t  stmt = gimple_build_assign (make_ssa_name (TREE_TYPE (repl)), repl);\n \t  repl = gimple_assign_lhs (stmt);\n \t}\n-      gimple_stmt_iterator gsi = gsi_for_stmt (info->stmt);\n+      gimple_stmt_iterator gsi;\n+      if (gimple_code (info->stmt) == GIMPLE_PHI)\n+\t{\n+\t  gsi = gsi_after_labels (single_succ (ENTRY_BLOCK_PTR_FOR_FN (cfun)));\n+\t  /* Cache SSA_NAME for next time.  */\n+\t  if (cand\n+\t      && TREE_CODE (*orig_tp) == ADDR_EXPR\n+\t      && TREE_CODE (TREE_OPERAND (*orig_tp, 0)) == PARM_DECL)\n+\t    cand->alias_ptr_type = repl;\n+\t}\n+      else\n+\tgsi = gsi_for_stmt (info->stmt);\n       gsi_insert_before (&gsi, stmt, GSI_SAME_STMT);\n       *orig_tp = repl;\n     }\n@@ -983,6 +1006,31 @@ ipa_simd_modify_function_body (struct cgraph_node *node,\n     {\n       gimple_stmt_iterator gsi;\n \n+      for (gsi = gsi_start_phis (bb); !gsi_end_p (gsi); gsi_next (&gsi))\n+\t{\n+\t  gphi *phi = as_a <gphi *> (gsi_stmt (gsi));\n+\t  int i, n = gimple_phi_num_args (phi);\n+\t  info.stmt = phi;\n+\t  struct walk_stmt_info wi;\n+\t  memset (&wi, 0, sizeof (wi));\n+\t  info.modified = false;\n+\t  wi.info = &info;\n+\t  for (i = 0; i < n; ++i)\n+\t    {\n+\t      int walk_subtrees = 1;\n+\t      tree arg = gimple_phi_arg_def (phi, i);\n+\t      tree op = arg;\n+\t      ipa_simd_modify_stmt_ops (&op, &walk_subtrees, &wi);\n+\t      if (op != arg)\n+\t\t{\n+\t\t  SET_PHI_ARG_DEF (phi, i, op);\n+\t\t  gcc_assert (TREE_CODE (op) == SSA_NAME);\n+\t\t  if (gimple_phi_arg_edge (phi, i)->flags & EDGE_ABNORMAL)\n+\t\t    SSA_NAME_OCCURS_IN_ABNORMAL_PHI (op) = 1;\n+\t\t}\n+\t    }\n+\t}\n+\n       gsi = gsi_start_bb (bb);\n       while (!gsi_end_p (gsi))\n \t{"}, {"sha": "5ba400fa2b3e81c55171b92fb340e0454ac86d68", "filename": "gcc/testsuite/ChangeLog", "status": "modified", "additions": 6, "deletions": 1, "changes": 7, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/33813f1d703c95d4fc87d16a17f6c834135ab209/gcc%2Ftestsuite%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/33813f1d703c95d4fc87d16a17f6c834135ab209/gcc%2Ftestsuite%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2FChangeLog?ref=33813f1d703c95d4fc87d16a17f6c834135ab209", "patch": "@@ -1,4 +1,9 @@\n-2019-03-13 Thomas Koenig  <tkoenig@gcc.gnu.org>\n+2019-03-13  Jakub Jelinek  <jakub@redhat.com>\n+\n+\tPR middle-end/88588\n+\t* c-c++-common/gomp/pr88588.c: New test.\n+\n+2019-03-13  Thomas Koenig  <tkoenig@gcc.gnu.org>\n \n \tPR fortran/66695\n \tPR fortran/77746"}, {"sha": "fb1a671b1ee00e58822b267017252098cb1ab083", "filename": "gcc/testsuite/c-c++-common/gomp/pr88588.c", "status": "added", "additions": 18, "deletions": 0, "changes": 18, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/33813f1d703c95d4fc87d16a17f6c834135ab209/gcc%2Ftestsuite%2Fc-c%2B%2B-common%2Fgomp%2Fpr88588.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/33813f1d703c95d4fc87d16a17f6c834135ab209/gcc%2Ftestsuite%2Fc-c%2B%2B-common%2Fgomp%2Fpr88588.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fc-c%2B%2B-common%2Fgomp%2Fpr88588.c?ref=33813f1d703c95d4fc87d16a17f6c834135ab209", "patch": "@@ -0,0 +1,18 @@\n+/* PR middle-end/88588 */\n+/* { dg-do compile } */\n+/* { dg-options \"-fopenmp -O1\" } */\n+\n+int *v;\n+\n+#pragma omp declare simd\n+void\n+foo (int x)\n+{\n+  int *a = &x;\n+\n+  for (;;)\n+    {\n+      *v = *a;\n+      a = v;\n+    }\n+}"}]}