{"sha": "4ade7b1af1b9c853410ea15b82979fc17ec427d1", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6NGFkZTdiMWFmMWI5Yzg1MzQxMGVhMTViODI5NzlmYzE3ZWM0MjdkMQ==", "commit": {"author": {"name": "Kelley Cook", "email": "kelleycook@wideopenwest.com", "date": "2003-07-10T20:42:05Z"}, "committer": {"name": "Neil Booth", "email": "neil@gcc.gnu.org", "date": "2003-07-10T20:42:05Z"}, "message": "Makefile.in (options.h): Depend on Makefile.\n\n\t* Makefile.in (options.h): Depend on Makefile.  Add move-if-change\n\tto opts.sh command line.\n\t* opts.sh: Write to temporary files with a move-if-change at the end.\n\nFrom-SVN: r69200", "tree": {"sha": "9427980c5142749e9c8310d65c59717e50802afc", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/9427980c5142749e9c8310d65c59717e50802afc"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/4ade7b1af1b9c853410ea15b82979fc17ec427d1", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/4ade7b1af1b9c853410ea15b82979fc17ec427d1", "html_url": "https://github.com/Rust-GCC/gccrs/commit/4ade7b1af1b9c853410ea15b82979fc17ec427d1", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/4ade7b1af1b9c853410ea15b82979fc17ec427d1/comments", "author": null, "committer": null, "parents": [{"sha": "9db367b45cc60c446821eb9c8aa7e96402376afb", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/9db367b45cc60c446821eb9c8aa7e96402376afb", "html_url": "https://github.com/Rust-GCC/gccrs/commit/9db367b45cc60c446821eb9c8aa7e96402376afb"}], "stats": {"total": 24, "additions": 17, "deletions": 7}, "files": [{"sha": "a62873f27a0259207eb1d75399d5723070a2613e", "filename": "gcc/Makefile.in", "status": "modified", "additions": 4, "deletions": 3, "changes": 7, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/4ade7b1af1b9c853410ea15b82979fc17ec427d1/gcc%2FMakefile.in", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/4ade7b1af1b9c853410ea15b82979fc17ec427d1/gcc%2FMakefile.in", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2FMakefile.in?ref=4ade7b1af1b9c853410ea15b82979fc17ec427d1", "patch": "@@ -1416,9 +1416,10 @@ s-specs : Makefile\n \n options.c: $(lang_opt_files) $(srcdir)/opts.sh options.h intl.h\n \n-options.h: $(lang_opt_files) $(srcdir)/opts.sh\n-\tAWK=$(AWK) $(SHELL) $(srcdir)/opts.sh options.c options.h \\\n-\t\t$(lang_opt_files)\n+options.h: $(lang_opt_files) $(srcdir)/opts.sh Makefile\n+\tAWK=$(AWK) $(SHELL) $(srcdir)/opts.sh \\\n+               '$(SHELL) $(srcdir)/move-if-change' \\\n+               options.c options.h $(lang_opt_files)\n \n dumpvers: dumpvers.c\n "}, {"sha": "3509dfdafef7e11136ef2aa383318595def046de", "filename": "gcc/opts.sh", "status": "modified", "additions": 13, "deletions": 4, "changes": 17, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/4ade7b1af1b9c853410ea15b82979fc17ec427d1/gcc%2Fopts.sh", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/4ade7b1af1b9c853410ea15b82979fc17ec427d1/gcc%2Fopts.sh", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fopts.sh?ref=4ade7b1af1b9c853410ea15b82979fc17ec427d1", "patch": "@@ -17,7 +17,7 @@\n # along with this program; if not, write to the Free Software\n # Foundation, 59 Temple Place - Suite 330, Boston, MA 02111-1307, USA.\n #\n-# Usage: opts.sh outfile.c outfile.h file1.opt [file2.opt, ...]\n+# Usage: opts.sh moveifchange srcdir outfile.c outfile.h file1.opt [ ...]\n \n # Always operate in the C locale.\n LANG=C\n@@ -30,8 +30,11 @@ AWK=${AWK-awk}\n \n SORT=sort\t\t# Could be /bin/sort or /usr/bin/sort\n \n+MOVEIFCHANGE=$1; shift\n C_FILE=$1; shift\n H_FILE=$1; shift\n+TMP_C_FILE=tmp-${C_FILE}\n+TMP_H_FILE=tmp-${H_FILE}\n \n ${AWK} '\n \t# Ignore comments and blank lines\n@@ -88,13 +91,14 @@ ${AWK} '\n # Dump out an enumeration into a .h file, and an array of options into a\n # C file.  Combine the flags of duplicate options.\n     END {\n-\tc_file = \"'${C_FILE}'\"\n-\th_file = \"'${H_FILE}'\"\n+ \tc_file = \"'${TMP_C_FILE}'\"\n+ \th_file = \"'${TMP_H_FILE}'\"\n+ \trealh_file = \"'${H_FILE}'\"\n \tcomma = \",\"\n \n \tprint \"/* This file is auto-generated by opts.sh.  */\\n\" > c_file\n \tprint \"#include <intl.h>\"\t\t\t>> c_file\n-\tprint \"#include \\\"\" h_file \"\\\"\"\t\t\t>> c_file\n+\tprint \"#include \\\"\" realh_file \"\\\"\"\t\t>> c_file\n \tprint \"#include \\\"opts.h\\\"\\n\"\t\t\t>> c_file\n \tprint \"const char * const lang_names[] =\\n{\"\t>> c_file\n \n@@ -163,3 +167,8 @@ ${AWK} '\n \tprint \"};\"\t\t\t\t\t>> c_file\n     }\n '\n+\n+# Copy the newly generated files back to the correct names only if different.\n+# This is to prevent a cascade of file rebuilds when not necessary.\n+${MOVEIFCHANGE} ${TMP_H_FILE} ${H_FILE}\n+${MOVEIFCHANGE} ${TMP_C_FILE} ${C_FILE}"}]}