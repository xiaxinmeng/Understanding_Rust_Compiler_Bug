{"sha": "665733c1215086f71896682d631dd03aec7710d2", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6NjY1NzMzYzEyMTUwODZmNzE4OTY2ODJkNjMxZGQwM2FlYzc3MTBkMg==", "commit": {"author": {"name": "Jakub Jelinek", "email": "jakub@redhat.com", "date": "2009-03-30T14:38:08Z"}, "committer": {"name": "Jakub Jelinek", "email": "jakub@gcc.gnu.org", "date": "2009-03-30T14:38:08Z"}, "message": "trans-types.c (gfc_sym_type, [...]): For sym->attr.result check sym->ns->proc_name->attr.is_bind_c.\n\n\t* trans-types.c (gfc_sym_type, gfc_return_by_reference): For\n\tsym->attr.result check sym->ns->proc_name->attr.is_bind_c.\n\n\t* gfortran.dg/bind_c_usage_19.f90: New test.\n\nFrom-SVN: r145294", "tree": {"sha": "80388c8b8c4e0b0796529810d742e6b4760a67fb", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/80388c8b8c4e0b0796529810d742e6b4760a67fb"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/665733c1215086f71896682d631dd03aec7710d2", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/665733c1215086f71896682d631dd03aec7710d2", "html_url": "https://github.com/Rust-GCC/gccrs/commit/665733c1215086f71896682d631dd03aec7710d2", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/665733c1215086f71896682d631dd03aec7710d2/comments", "author": {"login": "jakubjelinek", "id": 9370665, "node_id": "MDQ6VXNlcjkzNzA2NjU=", "avatar_url": "https://avatars.githubusercontent.com/u/9370665?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jakubjelinek", "html_url": "https://github.com/jakubjelinek", "followers_url": "https://api.github.com/users/jakubjelinek/followers", "following_url": "https://api.github.com/users/jakubjelinek/following{/other_user}", "gists_url": "https://api.github.com/users/jakubjelinek/gists{/gist_id}", "starred_url": "https://api.github.com/users/jakubjelinek/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jakubjelinek/subscriptions", "organizations_url": "https://api.github.com/users/jakubjelinek/orgs", "repos_url": "https://api.github.com/users/jakubjelinek/repos", "events_url": "https://api.github.com/users/jakubjelinek/events{/privacy}", "received_events_url": "https://api.github.com/users/jakubjelinek/received_events", "type": "User", "site_admin": false}, "committer": null, "parents": [{"sha": "b3f27c1577aba48ad3dc74ebb59587f23506e726", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/b3f27c1577aba48ad3dc74ebb59587f23506e726", "html_url": "https://github.com/Rust-GCC/gccrs/commit/b3f27c1577aba48ad3dc74ebb59587f23506e726"}], "stats": {"total": 53, "additions": 50, "deletions": 3}, "files": [{"sha": "bcb3a6022f29f531b98798f62b3d9dde4d60ddbb", "filename": "gcc/fortran/ChangeLog", "status": "modified", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/665733c1215086f71896682d631dd03aec7710d2/gcc%2Ffortran%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/665733c1215086f71896682d631dd03aec7710d2/gcc%2Ffortran%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ffortran%2FChangeLog?ref=665733c1215086f71896682d631dd03aec7710d2", "patch": "@@ -1,3 +1,8 @@\n+2009-03-30  Jakub Jelinek  <jakub@redhat.com>\n+\n+\t* trans-types.c (gfc_sym_type, gfc_return_by_reference): For\n+\tsym->attr.result check sym->ns->proc_name->attr.is_bind_c.\n+\n 2009-03-30  Joseph Myers  <joseph@codesourcery.com>\n \n \tPR rtl-optimization/323"}, {"sha": "717859c5360f61f0683610a696309f4a7a5b0230", "filename": "gcc/fortran/trans-types.c", "status": "modified", "additions": 10, "deletions": 3, "changes": 13, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/665733c1215086f71896682d631dd03aec7710d2/gcc%2Ffortran%2Ftrans-types.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/665733c1215086f71896682d631dd03aec7710d2/gcc%2Ffortran%2Ftrans-types.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ffortran%2Ftrans-types.c?ref=665733c1215086f71896682d631dd03aec7710d2", "patch": "@@ -1632,8 +1632,11 @@ gfc_sym_type (gfc_symbol * sym)\n   if (sym->backend_decl && !sym->attr.function)\n     return TREE_TYPE (sym->backend_decl);\n \n-  if (sym->ts.type == BT_CHARACTER && sym->attr.is_bind_c\n-      && (sym->attr.function || sym->attr.result))\n+  if (sym->ts.type == BT_CHARACTER\n+      && ((sym->attr.function && sym->attr.is_bind_c)\n+\t  || (sym->attr.result\n+\t      && sym->ns->proc_name\n+\t      && sym->ns->proc_name->attr.is_bind_c)))\n     type = gfc_character1_type_node;\n   else\n     type = gfc_typenode_for_spec (&sym->ts);\n@@ -1962,7 +1965,11 @@ gfc_return_by_reference (gfc_symbol * sym)\n   if (sym->attr.dimension)\n     return 1;\n \n-  if (sym->ts.type == BT_CHARACTER && !sym->attr.is_bind_c)\n+  if (sym->ts.type == BT_CHARACTER\n+      && !sym->attr.is_bind_c\n+      && (!sym->attr.result\n+\t  || !sym->ns->proc_name\n+\t  || !sym->ns->proc_name->attr.is_bind_c))\n     return 1;\n \n   /* Possibly return complex numbers by reference for g77 compatibility."}, {"sha": "d672724fbbdc7fab9d3ded16521d8e066105d331", "filename": "gcc/testsuite/ChangeLog", "status": "modified", "additions": 4, "deletions": 0, "changes": 4, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/665733c1215086f71896682d631dd03aec7710d2/gcc%2Ftestsuite%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/665733c1215086f71896682d631dd03aec7710d2/gcc%2Ftestsuite%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2FChangeLog?ref=665733c1215086f71896682d631dd03aec7710d2", "patch": "@@ -1,3 +1,7 @@\n+2009-03-30  Jakub Jelinek  <jakub@redhat.com>\n+\n+\t* gfortran.dg/bind_c_usage_19.f90: New test.\n+\n 2009-03-30  Joseph Myers  <joseph@codesourcery.com>\n \n \tPR rtl-optimization/323"}, {"sha": "30f9f5ee1fee3f9e94cf067700816f445a1c9477", "filename": "gcc/testsuite/gfortran.dg/bind_c_usage_19.f90", "status": "added", "additions": 31, "deletions": 0, "changes": 31, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/665733c1215086f71896682d631dd03aec7710d2/gcc%2Ftestsuite%2Fgfortran.dg%2Fbind_c_usage_19.f90", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/665733c1215086f71896682d631dd03aec7710d2/gcc%2Ftestsuite%2Fgfortran.dg%2Fbind_c_usage_19.f90", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgfortran.dg%2Fbind_c_usage_19.f90?ref=665733c1215086f71896682d631dd03aec7710d2", "patch": "@@ -0,0 +1,31 @@\n+! { dg-do compile }\n+function return_char1(i) bind(c,name='return_char1')\n+  use iso_c_binding\n+  implicit none\n+  integer(c_int) :: i\n+  character(c_char) :: j\n+  character(c_char) :: return_char1\n+\n+  j = achar(i)\n+  return_char1 = j\n+end function return_char1\n+function return_char2(i) result(output) bind(c,name='return_char2')\n+  use iso_c_binding\n+  implicit none\n+  integer(c_int) :: i\n+  character(c_char) :: j\n+  character(c_char) :: output\n+\n+  j = achar(i)\n+  output = j\n+end function return_char2\n+function return_char3(i) bind(c,name='return_char3') result(output)\n+  use iso_c_binding\n+  implicit none\n+  integer(c_int) :: i\n+  character(c_char) :: j\n+  character(c_char) :: output\n+\n+  j = achar(i)\n+  output = j\n+end function return_char3"}]}