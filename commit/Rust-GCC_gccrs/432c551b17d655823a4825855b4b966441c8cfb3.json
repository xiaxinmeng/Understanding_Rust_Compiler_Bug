{"sha": "432c551b17d655823a4825855b4b966441c8cfb3", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6NDMyYzU1MWIxN2Q2NTU4MjNhNDgyNTg1NWI0Yjk2NjQ0MWM4Y2ZiMw==", "commit": {"author": {"name": "Martin Liska", "email": "mliska@suse.cz", "date": "2020-09-01T12:14:45Z"}, "committer": {"name": "Martin Liska", "email": "mliska@suse.cz", "date": "2020-09-21T08:09:26Z"}, "message": "Support new mallinfo2 function.\n\ngcc/ChangeLog:\n\n\t* config.in: Regenerate.\n\t* configure: Likewise.\n\t* configure.ac: Detect for mallinfo2.\n\t* ggc-common.c (defined): Use it.\n\t* system.h: Handle also HAVE_MALLINFO2.", "tree": {"sha": "3959fd2a8a6da15120a7334e5ca542e4aa0e568e", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/3959fd2a8a6da15120a7334e5ca542e4aa0e568e"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/432c551b17d655823a4825855b4b966441c8cfb3", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/432c551b17d655823a4825855b4b966441c8cfb3", "html_url": "https://github.com/Rust-GCC/gccrs/commit/432c551b17d655823a4825855b4b966441c8cfb3", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/432c551b17d655823a4825855b4b966441c8cfb3/comments", "author": {"login": "marxin", "id": 2658545, "node_id": "MDQ6VXNlcjI2NTg1NDU=", "avatar_url": "https://avatars.githubusercontent.com/u/2658545?v=4", "gravatar_id": "", "url": "https://api.github.com/users/marxin", "html_url": "https://github.com/marxin", "followers_url": "https://api.github.com/users/marxin/followers", "following_url": "https://api.github.com/users/marxin/following{/other_user}", "gists_url": "https://api.github.com/users/marxin/gists{/gist_id}", "starred_url": "https://api.github.com/users/marxin/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/marxin/subscriptions", "organizations_url": "https://api.github.com/users/marxin/orgs", "repos_url": "https://api.github.com/users/marxin/repos", "events_url": "https://api.github.com/users/marxin/events{/privacy}", "received_events_url": "https://api.github.com/users/marxin/received_events", "type": "User", "site_admin": false}, "committer": {"login": "marxin", "id": 2658545, "node_id": "MDQ6VXNlcjI2NTg1NDU=", "avatar_url": "https://avatars.githubusercontent.com/u/2658545?v=4", "gravatar_id": "", "url": "https://api.github.com/users/marxin", "html_url": "https://github.com/marxin", "followers_url": "https://api.github.com/users/marxin/followers", "following_url": "https://api.github.com/users/marxin/following{/other_user}", "gists_url": "https://api.github.com/users/marxin/gists{/gist_id}", "starred_url": "https://api.github.com/users/marxin/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/marxin/subscriptions", "organizations_url": "https://api.github.com/users/marxin/orgs", "repos_url": "https://api.github.com/users/marxin/repos", "events_url": "https://api.github.com/users/marxin/events{/privacy}", "received_events_url": "https://api.github.com/users/marxin/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "11da31998af6d7b7d4d6fcd3f705c17d69baf58b", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/11da31998af6d7b7d4d6fcd3f705c17d69baf58b", "html_url": "https://github.com/Rust-GCC/gccrs/commit/11da31998af6d7b7d4d6fcd3f705c17d69baf58b"}], "stats": {"total": 38, "additions": 28, "deletions": 10}, "files": [{"sha": "1832c112ed918731eda49efec876876f1a9df5b3", "filename": "gcc/config.in", "status": "modified", "additions": 14, "deletions": 2, "changes": 16, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/432c551b17d655823a4825855b4b966441c8cfb3/gcc%2Fconfig.in", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/432c551b17d655823a4825855b4b966441c8cfb3/gcc%2Fconfig.in", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fconfig.in?ref=432c551b17d655823a4825855b4b966441c8cfb3", "patch": "@@ -983,13 +983,19 @@\n #endif\n \n \n-/* Define to 1 if we found a declaration for 'mallinfo', otherwise define to\n-   0. */\n+/* Define to 1 if we found a declaration for 'mallinfo */\n #ifndef USED_FOR_TARGET\n #undef HAVE_DECL_MALLINFO\n #endif\n \n \n+/* Define to 1 if we found a declaration for 'mallinfo2', otherwise define to\n+   0. */\n+#ifndef USED_FOR_TARGET\n+#undef HAVE_DECL_MALLINFO2\n+#endif\n+\n+\n /* Define to 1 if we found a declaration for 'malloc', otherwise define to 0.\n    */\n #ifndef USED_FOR_TARGET\n@@ -1665,6 +1671,12 @@\n #endif\n \n \n+/* Define to 1 if you have the `mallinfo2' function. */\n+#ifndef USED_FOR_TARGET\n+#undef HAVE_MALLINFO2\n+#endif\n+\n+\n /* Define to 1 if you have the <malloc.h> header file. */\n #ifndef USED_FOR_TARGET\n #undef HAVE_MALLOC_H"}, {"sha": "d33ee9fc5d2c08689de119642c9d57609c7a9549", "filename": "gcc/configure", "status": "modified", "additions": 2, "deletions": 2, "changes": 4, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/432c551b17d655823a4825855b4b966441c8cfb3/gcc%2Fconfigure", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/432c551b17d655823a4825855b4b966441c8cfb3/gcc%2Fconfigure", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fconfigure?ref=432c551b17d655823a4825855b4b966441c8cfb3", "patch": "@@ -10120,7 +10120,7 @@ fi\n for ac_func in times clock kill getrlimit setrlimit atoq \\\n \tpopen sysconf strsignal getrusage nl_langinfo \\\n \tgettimeofday mbstowcs wcswidth mmap setlocale \\\n-\tclearerr_unlocked feof_unlocked   ferror_unlocked fflush_unlocked fgetc_unlocked fgets_unlocked   fileno_unlocked fprintf_unlocked fputc_unlocked fputs_unlocked   fread_unlocked fwrite_unlocked getchar_unlocked getc_unlocked   putchar_unlocked putc_unlocked madvise mallinfo\n+\tclearerr_unlocked feof_unlocked   ferror_unlocked fflush_unlocked fgetc_unlocked fgets_unlocked   fileno_unlocked fprintf_unlocked fputc_unlocked fputs_unlocked   fread_unlocked fwrite_unlocked getchar_unlocked getc_unlocked   putchar_unlocked putc_unlocked madvise mallinfo mallinfo2\n do :\n   as_ac_var=`$as_echo \"ac_cv_func_$ac_func\" | $as_tr_sh`\n ac_fn_cxx_check_func \"$LINENO\" \"$ac_func\" \"$as_ac_var\"\n@@ -11549,7 +11549,7 @@ fi\n done\n \n \n-for ac_func in mallinfo\n+for ac_func in mallinfo, mallinfo2\n do\n   ac_tr_decl=`$as_echo \"HAVE_DECL_$ac_func\" | $as_tr_cpp`\n { $as_echo \"$as_me:${as_lineno-$LINENO}: checking whether $ac_func is declared\" >&5"}, {"sha": "fedb7b2800fef1588c0b1bf426b132acda1cd45f", "filename": "gcc/configure.ac", "status": "modified", "additions": 2, "deletions": 2, "changes": 4, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/432c551b17d655823a4825855b4b966441c8cfb3/gcc%2Fconfigure.ac", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/432c551b17d655823a4825855b4b966441c8cfb3/gcc%2Fconfigure.ac", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fconfigure.ac?ref=432c551b17d655823a4825855b4b966441c8cfb3", "patch": "@@ -1408,7 +1408,7 @@ define(gcc_UNLOCKED_FUNCS, clearerr_unlocked feof_unlocked dnl\n AC_CHECK_FUNCS(times clock kill getrlimit setrlimit atoq \\\n \tpopen sysconf strsignal getrusage nl_langinfo \\\n \tgettimeofday mbstowcs wcswidth mmap setlocale \\\n-\tgcc_UNLOCKED_FUNCS madvise mallinfo)\n+\tgcc_UNLOCKED_FUNCS madvise mallinfo mallinfo2)\n \n if test x$ac_cv_func_mbstowcs = xyes; then\n   AC_CACHE_CHECK(whether mbstowcs works, gcc_cv_func_mbstowcs_works,\n@@ -1488,7 +1488,7 @@ gcc_AC_CHECK_DECLS(getrlimit setrlimit getrusage, , ,[\n #endif\n ])\n \n-gcc_AC_CHECK_DECLS(mallinfo, , ,[\n+gcc_AC_CHECK_DECLS([mallinfo, mallinfo2], , ,[\n #include \"ansidecl.h\"\n #include \"system.h\"\n #ifdef HAVE_MALLOC_H"}, {"sha": "6f8da300970ebec268fd50abe186091ba5d50273", "filename": "gcc/ggc-common.c", "status": "modified", "additions": 9, "deletions": 3, "changes": 12, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/432c551b17d655823a4825855b4b966441c8cfb3/gcc%2Fggc-common.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/432c551b17d655823a4825855b4b966441c8cfb3/gcc%2Fggc-common.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fggc-common.c?ref=432c551b17d655823a4825855b4b966441c8cfb3", "patch": "@@ -1008,13 +1008,19 @@ ggc_prune_overhead_list (void)\n       }\n }\n \n-/* Return memory used by heap in kb, 0 if this info is not available.  */\n+/* Print memory used by heap in kb if this info is available.  */\n \n void\n report_heap_memory_use ()\n {\n-#ifdef HAVE_MALLINFO\n+#if defined(HAVE_MALLINFO) || defined(HAVE_MALLINFO2)\n+#ifdef HAVE_MALLINFO2\n+  #define MALLINFO_FN mallinfo2\n+#else\n+  #define MALLINFO_FN mallinfo\n+#endif\n   if (!quiet_flag)\n-    fprintf (stderr,\" {heap %luk}\", (unsigned long)(mallinfo().arena / 1024));\n+    fprintf (stderr,\" {heap %luk}\",\n+\t     (unsigned long) MALLINFO_FN ().arena / ONE_K);\n #endif\n }"}, {"sha": "4f0482be25d7b06ad329afef17ee02bbd3c16620", "filename": "gcc/system.h", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/432c551b17d655823a4825855b4b966441c8cfb3/gcc%2Fsystem.h", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/432c551b17d655823a4825855b4b966441c8cfb3/gcc%2Fsystem.h", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fsystem.h?ref=432c551b17d655823a4825855b4b966441c8cfb3", "patch": "@@ -732,7 +732,7 @@ extern int vsnprintf (char *, size_t, const char *, va_list);\n #endif\n \n #ifdef INCLUDE_MALLOC_H\n-#ifdef HAVE_MALLINFO\n+#if defined(HAVE_MALLINFO) || defined(HAVE_MALLINFO2)\n #include <malloc.h>\n #endif\n #endif"}]}