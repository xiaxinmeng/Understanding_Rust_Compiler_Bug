{"sha": "aaf176ca1896931ac8777c0fd527b0198032b38e", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6YWFmMTc2Y2ExODk2OTMxYWM4Nzc3YzBmZDUyN2IwMTk4MDMyYjM4ZQ==", "commit": {"author": {"name": "Ville Voutilainen", "email": "ville.voutilainen@gmail.com", "date": "2014-11-26T15:16:07Z"}, "committer": {"name": "Jason Merrill", "email": "jason@gcc.gnu.org", "date": "2014-11-26T15:16:07Z"}, "message": "Diagnose string constant conversion to char* in c++11 and above as forbidden, not deprecated.\n\n\tDiagnose string constant conversion to char* in c++11 and above\n\tas forbidden, not deprecated.\n\t* typeck.c (string_conv_p): Do a pedwarn in c++11 and above,\n\tchange the diagnostic for the Wwrite-strings case for c++11 and above.\n\nFrom-SVN: r218087", "tree": {"sha": "1d0719c39e7bc778963f5959e441ce9f55e4c8b9", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/1d0719c39e7bc778963f5959e441ce9f55e4c8b9"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/aaf176ca1896931ac8777c0fd527b0198032b38e", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/aaf176ca1896931ac8777c0fd527b0198032b38e", "html_url": "https://github.com/Rust-GCC/gccrs/commit/aaf176ca1896931ac8777c0fd527b0198032b38e", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/aaf176ca1896931ac8777c0fd527b0198032b38e/comments", "author": {"login": "villevoutilainen", "id": 963599, "node_id": "MDQ6VXNlcjk2MzU5OQ==", "avatar_url": "https://avatars.githubusercontent.com/u/963599?v=4", "gravatar_id": "", "url": "https://api.github.com/users/villevoutilainen", "html_url": "https://github.com/villevoutilainen", "followers_url": "https://api.github.com/users/villevoutilainen/followers", "following_url": "https://api.github.com/users/villevoutilainen/following{/other_user}", "gists_url": "https://api.github.com/users/villevoutilainen/gists{/gist_id}", "starred_url": "https://api.github.com/users/villevoutilainen/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/villevoutilainen/subscriptions", "organizations_url": "https://api.github.com/users/villevoutilainen/orgs", "repos_url": "https://api.github.com/users/villevoutilainen/repos", "events_url": "https://api.github.com/users/villevoutilainen/events{/privacy}", "received_events_url": "https://api.github.com/users/villevoutilainen/received_events", "type": "User", "site_admin": false}, "committer": null, "parents": [{"sha": "8006f46bdd8be581f287ed7d1c2d204c608fb426", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/8006f46bdd8be581f287ed7d1c2d204c608fb426", "html_url": "https://github.com/Rust-GCC/gccrs/commit/8006f46bdd8be581f287ed7d1c2d204c608fb426"}], "stats": {"total": 35, "additions": 24, "deletions": 11}, "files": [{"sha": "e5f6305faf70a22a0013a636aba9f4ac0059348e", "filename": "gcc/cp/ChangeLog", "status": "modified", "additions": 7, "deletions": 0, "changes": 7, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/aaf176ca1896931ac8777c0fd527b0198032b38e/gcc%2Fcp%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/aaf176ca1896931ac8777c0fd527b0198032b38e/gcc%2Fcp%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fcp%2FChangeLog?ref=aaf176ca1896931ac8777c0fd527b0198032b38e", "patch": "@@ -1,3 +1,10 @@\n+2014-11-26  Ville Voutilainen  <ville.voutilainen@gmail.com>\n+\n+\tDiagnose string constant conversion to char* in c++11 and above\n+\tas forbidden, not deprecated.\n+\t* typeck.c (string_conv_p): Do a pedwarn in c++11 and above,\n+\tchange the diagnostic for the Wwrite-strings case for c++11 and above.\n+\n 2014-11-24  Jason Merrill  <jason@redhat.com>\n \n \t* pt.c (lookup_template_variable): Always unknown_type_node."}, {"sha": "8b66acc9011e6dbe06195ff104ea0eab5eb2168f", "filename": "gcc/cp/typeck.c", "status": "modified", "additions": 11, "deletions": 5, "changes": 16, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/aaf176ca1896931ac8777c0fd527b0198032b38e/gcc%2Fcp%2Ftypeck.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/aaf176ca1896931ac8777c0fd527b0198032b38e/gcc%2Fcp%2Ftypeck.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fcp%2Ftypeck.c?ref=aaf176ca1896931ac8777c0fd527b0198032b38e", "patch": "@@ -2139,12 +2139,18 @@ string_conv_p (const_tree totype, const_tree exp, int warn)\n \t  || TREE_CODE (TREE_OPERAND (exp, 0)) != STRING_CST)\n \treturn 0;\n     }\n-\n-  /* This warning is not very useful, as it complains about printf.  */\n   if (warn)\n-    warning (OPT_Wwrite_strings,\n-\t     \"deprecated conversion from string constant to %qT\",\n-\t     totype);\n+    {\n+      if (cxx_dialect >= cxx11)\n+\tpedwarn (input_location,\n+\t\t pedantic ? OPT_Wpedantic : OPT_Wwrite_strings,\n+\t\t \"ISO C++ forbids converting a string constant to %qT\",\n+\t\t totype);\n+      else\n+\twarning (OPT_Wwrite_strings,\n+\t\t \"deprecated conversion from string constant to %qT\",\n+\t\t totype);\n+    }\n \n   return 1;\n }"}, {"sha": "063b303f66039a2108602f768e5645277b628388", "filename": "gcc/testsuite/g++.dg/warn/write-strings-default.C", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/aaf176ca1896931ac8777c0fd527b0198032b38e/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Fwarn%2Fwrite-strings-default.C", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/aaf176ca1896931ac8777c0fd527b0198032b38e/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Fwarn%2Fwrite-strings-default.C", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Fwarn%2Fwrite-strings-default.C?ref=aaf176ca1896931ac8777c0fd527b0198032b38e", "patch": "@@ -3,5 +3,5 @@\n \n int main()\n {\n-   char* p = \"Asgaard\";         // { dg-warning \"deprecated\" }\n+   char* p = \"Asgaard\";         // { dg-warning \"deprecated|forbids converting a string constant\" }\n }"}, {"sha": "1293e859156ba15812a2090c00fed78d5c2225c8", "filename": "gcc/testsuite/g++.dg/warn/write-strings.C", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/aaf176ca1896931ac8777c0fd527b0198032b38e/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Fwarn%2Fwrite-strings.C", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/aaf176ca1896931ac8777c0fd527b0198032b38e/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Fwarn%2Fwrite-strings.C", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Fwarn%2Fwrite-strings.C?ref=aaf176ca1896931ac8777c0fd527b0198032b38e", "patch": "@@ -3,5 +3,5 @@\n \n int main()\n {\n-   char* p = \"Asgaard\";         // { dg-warning \"deprecated\" }\n+   char* p = \"Asgaard\";         // { dg-warning \"deprecated|forbids converting a string constant\" }\n }"}, {"sha": "c037a1c0b2d21b76689f3fba94f4cd1291423403", "filename": "gcc/testsuite/g++.old-deja/g++.bob/inherit1.C", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/aaf176ca1896931ac8777c0fd527b0198032b38e/gcc%2Ftestsuite%2Fg%2B%2B.old-deja%2Fg%2B%2B.bob%2Finherit1.C", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/aaf176ca1896931ac8777c0fd527b0198032b38e/gcc%2Ftestsuite%2Fg%2B%2B.old-deja%2Fg%2B%2B.bob%2Finherit1.C", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fg%2B%2B.old-deja%2Fg%2B%2B.bob%2Finherit1.C?ref=aaf176ca1896931ac8777c0fd527b0198032b38e", "patch": "@@ -12,7 +12,7 @@ public:\n class B : public A {\n public:\n     char* m1 () { C::m1(); return \"\"; } // { dg-error \"cannot call\" } \n-    // { dg-warning \"deprecated\" \"depr\" { target *-*-* } 14 }\n+    // { dg-warning \"deprecated|forbids converting a string constant\" \"depr\" { target *-*-* } 14 }\n };\n \n int main () {"}, {"sha": "b8e2a0ba1454ac865b04b4be47ffe14c7ed5e3fd", "filename": "gcc/testsuite/g++.old-deja/g++.brendan/template17.C", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/aaf176ca1896931ac8777c0fd527b0198032b38e/gcc%2Ftestsuite%2Fg%2B%2B.old-deja%2Fg%2B%2B.brendan%2Ftemplate17.C", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/aaf176ca1896931ac8777c0fd527b0198032b38e/gcc%2Ftestsuite%2Fg%2B%2B.old-deja%2Fg%2B%2B.brendan%2Ftemplate17.C", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fg%2B%2B.old-deja%2Fg%2B%2B.brendan%2Ftemplate17.C?ref=aaf176ca1896931ac8777c0fd527b0198032b38e", "patch": "@@ -10,6 +10,6 @@ public:\n \n const Regex NDAMName<'L'>::pattern(\"^[Ll](.*)$\",   1);// { dg-error \"type/value mismatch\" \"mismatch\" }\n // { dg-message \"expected a type\" \"expected\" { target *-*-* } 11 }\n-// { dg-warning \"deprecated\" \"depr\" { target *-*-* } 11 }\n+// { dg-warning \"deprecated|forbids converting a string constant\" \"depr\" { target *-*-* } 11 }\n unsigned NDAMName<'L'>::sequence_number = 0;// { dg-error \"type/value mismatch\" \"mismatch\" }\n // { dg-message \"expected a type\" \"exp\" { target *-*-* } 14 }"}, {"sha": "5734210cc88f7d6ccc8add46d5c4ec4742ef91cf", "filename": "gcc/testsuite/g++.old-deja/g++.law/temps1.C", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/aaf176ca1896931ac8777c0fd527b0198032b38e/gcc%2Ftestsuite%2Fg%2B%2B.old-deja%2Fg%2B%2B.law%2Ftemps1.C", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/aaf176ca1896931ac8777c0fd527b0198032b38e/gcc%2Ftestsuite%2Fg%2B%2B.old-deja%2Fg%2B%2B.law%2Ftemps1.C", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fg%2B%2B.old-deja%2Fg%2B%2B.law%2Ftemps1.C?ref=aaf176ca1896931ac8777c0fd527b0198032b38e", "patch": "@@ -16,5 +16,5 @@ struct cookie\n   cookie ( foo * x) { v=x; }\n };\n \n-cookie cat(&foo(\"apabepa\"));// { dg-warning \"deprecated conversion\" \"dep\" }\n+cookie cat(&foo(\"apabepa\"));// { dg-warning \"deprecated conversion|forbids converting a string constant\" \"dep\" }\n // { dg-warning \"taking address of temporary\" \"add\" { target *-*-* } 19 }"}, {"sha": "99603cf9251560b731697506c57694bd2282b2b7", "filename": "gcc/testsuite/g++.old-deja/g++.martin/typedef2.C", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/aaf176ca1896931ac8777c0fd527b0198032b38e/gcc%2Ftestsuite%2Fg%2B%2B.old-deja%2Fg%2B%2B.martin%2Ftypedef2.C", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/aaf176ca1896931ac8777c0fd527b0198032b38e/gcc%2Ftestsuite%2Fg%2B%2B.old-deja%2Fg%2B%2B.martin%2Ftypedef2.C", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fg%2B%2B.old-deja%2Fg%2B%2B.martin%2Ftypedef2.C?ref=aaf176ca1896931ac8777c0fd527b0198032b38e", "patch": "@@ -3,5 +3,5 @@\n // Check implicit conversion from string constants into typedefs\n \n typedef char CHAR;\n-void f2(CHAR *s=\"\");\t\t// { dg-warning \"deprecated\" }\n+void f2(CHAR *s=\"\");\t\t// { dg-warning \"deprecated|forbids converting a string constant\" }\n "}]}