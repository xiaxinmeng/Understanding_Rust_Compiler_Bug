{"sha": "5d4d78403cbd2fe450425ce8e9e42c8b14b8fca9", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6NWQ0ZDc4NDAzY2JkMmZlNDUwNDI1Y2U4ZTllNDJjOGIxNGI4ZmNhOQ==", "commit": {"author": {"name": "Kyrylo Tkachov", "email": "kyrylo.tkachov@arm.com", "date": "2016-10-17T16:37:38Z"}, "committer": {"name": "Kyrylo Tkachov", "email": "ktkachov@gcc.gnu.org", "date": "2016-10-17T16:37:38Z"}, "message": "[AArch64] Use new target pass registration framework for FMA steering pass\n\n\t* config/aarch64/aarch64.c: Delete inclusion of\n\tcortex-a57-fma-steering.h.\n\t(aarch64_override_options): Delete call\n\tto aarch64_register_fma_steering.\n\t* config/aarch64/aarch64-protos.h (make_pass_fma_steering): Declare.\n\t* config/aarch64/cortex-a57-fma-steering.h: Delete.\n\t* config/aarch64/aarch64-passes.def: New file.\n\t* config/aarch64/cortex-a57-fma-steering.c\n\t(aarch64_register_fma_steering): Delete definition.\n\t(make_pass_fma_steering): Remove static qualifier.\n\t* config/aarch64/t-aarch64 (PASSES_EXTRA): New directive.\n\t(cortex-a57-fma-steering.o): Remove dependency on\n\tcortex-a57-fma-steering.h.\n\nFrom-SVN: r241248", "tree": {"sha": "eaf77bb714df8c0eb5b4bef2cf6a27e5d67fd7cf", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/eaf77bb714df8c0eb5b4bef2cf6a27e5d67fd7cf"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/5d4d78403cbd2fe450425ce8e9e42c8b14b8fca9", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/5d4d78403cbd2fe450425ce8e9e42c8b14b8fca9", "html_url": "https://github.com/Rust-GCC/gccrs/commit/5d4d78403cbd2fe450425ce8e9e42c8b14b8fca9", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/5d4d78403cbd2fe450425ce8e9e42c8b14b8fca9/comments", "author": {"login": "ktkachov-arm", "id": 74917949, "node_id": "MDQ6VXNlcjc0OTE3OTQ5", "avatar_url": "https://avatars.githubusercontent.com/u/74917949?v=4", "gravatar_id": "", "url": "https://api.github.com/users/ktkachov-arm", "html_url": "https://github.com/ktkachov-arm", "followers_url": "https://api.github.com/users/ktkachov-arm/followers", "following_url": "https://api.github.com/users/ktkachov-arm/following{/other_user}", "gists_url": "https://api.github.com/users/ktkachov-arm/gists{/gist_id}", "starred_url": "https://api.github.com/users/ktkachov-arm/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/ktkachov-arm/subscriptions", "organizations_url": "https://api.github.com/users/ktkachov-arm/orgs", "repos_url": "https://api.github.com/users/ktkachov-arm/repos", "events_url": "https://api.github.com/users/ktkachov-arm/events{/privacy}", "received_events_url": "https://api.github.com/users/ktkachov-arm/received_events", "type": "User", "site_admin": false}, "committer": null, "parents": [{"sha": "b8105705495f00ff9060fea7d70c69009c7a4f96", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/b8105705495f00ff9060fea7d70c69009c7a4f96", "html_url": "https://github.com/Rust-GCC/gccrs/commit/b8105705495f00ff9060fea7d70c69009c7a4f96"}], "stats": {"total": 48, "additions": 24, "deletions": 24}, "files": [{"sha": "92d06ce27664b3a12ca304d4e8b24ef9fde224a2", "filename": "gcc/ChangeLog", "status": "modified", "additions": 16, "deletions": 0, "changes": 16, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/5d4d78403cbd2fe450425ce8e9e42c8b14b8fca9/gcc%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/5d4d78403cbd2fe450425ce8e9e42c8b14b8fca9/gcc%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2FChangeLog?ref=5d4d78403cbd2fe450425ce8e9e42c8b14b8fca9", "patch": "@@ -1,3 +1,19 @@\n+2016-10-17  Kyrylo Tkachov  <kyrylo.tkachov@arm.com>\n+\n+\t* config/aarch64/aarch64.c: Delete inclusion of\n+\tcortex-a57-fma-steering.h.\n+\t(aarch64_override_options): Delete call\n+\tto aarch64_register_fma_steering.\n+\t* config/aarch64/aarch64-protos.h (make_pass_fma_steering): Declare.\n+\t* config/aarch64/cortex-a57-fma-steering.h: Delete.\n+\t* config/aarch64/aarch64-passes.def: New file.\n+\t* config/aarch64/cortex-a57-fma-steering.c\n+\t(aarch64_register_fma_steering): Delete definition.\n+\t(make_pass_fma_steering): Remove static qualifier.\n+\t* config/aarch64/t-aarch64 (PASSES_EXTRA): New directive.\n+\t(cortex-a57-fma-steering.o): Remove dependency on\n+\tcortex-a57-fma-steering.h.\n+\n 2016-10-17  Eric Botcazou  <ebotcazou@adacore.com>\n \n \t* explow.c (validize_mem): Do not modify the argument in-place."}, {"sha": "7fe80391a3fb0dc79715b9fb23fd4c08a9d26d74", "filename": "gcc/config/aarch64/aarch64-passes.def", "status": "renamed", "additions": 3, "deletions": 4, "changes": 7, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/5d4d78403cbd2fe450425ce8e9e42c8b14b8fca9/gcc%2Fconfig%2Faarch64%2Faarch64-passes.def", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/5d4d78403cbd2fe450425ce8e9e42c8b14b8fca9/gcc%2Fconfig%2Faarch64%2Faarch64-passes.def", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fconfig%2Faarch64%2Faarch64-passes.def?ref=5d4d78403cbd2fe450425ce8e9e42c8b14b8fca9", "patch": "@@ -1,6 +1,5 @@\n-/* This file contains declarations for the FMA steering optimization\n-   pass for Cortex-A57.\n-   Copyright (C) 2015-2016 Free Software Foundation, Inc.\n+/* AArch64-specific passes declarations.\n+   Copyright (C) 2016 Free Software Foundation, Inc.\n    Contributed by ARM Ltd.\n \n    This file is part of GCC.\n@@ -19,4 +18,4 @@\n    along with GCC; see the file COPYING3.  If not see\n    <http://www.gnu.org/licenses/>.  */\n \n-void aarch64_register_fma_steering (void);\n+INSERT_PASS_AFTER (pass_regrename, 1, pass_fma_steering);", "previous_filename": "gcc/config/aarch64/cortex-a57-fma-steering.h"}, {"sha": "4f4989d8b0da91096000d0b51736eaa5b0aa9474", "filename": "gcc/config/aarch64/aarch64-protos.h", "status": "modified", "additions": 2, "deletions": 0, "changes": 2, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/5d4d78403cbd2fe450425ce8e9e42c8b14b8fca9/gcc%2Fconfig%2Faarch64%2Faarch64-protos.h", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/5d4d78403cbd2fe450425ce8e9e42c8b14b8fca9/gcc%2Fconfig%2Faarch64%2Faarch64-protos.h", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fconfig%2Faarch64%2Faarch64-protos.h?ref=5d4d78403cbd2fe450425ce8e9e42c8b14b8fca9", "patch": "@@ -463,4 +463,6 @@ enum aarch64_parse_opt_result aarch64_parse_extension (const char *,\n std::string aarch64_get_extension_string_for_isa_flags (unsigned long,\n \t\t\t\t\t\t\tunsigned long);\n \n+rtl_opt_pass *make_pass_fma_steering (gcc::context *ctxt);\n+\n #endif /* GCC_AARCH64_PROTOS_H */"}, {"sha": "6b27309337b4e34f877fbdb632f177bf38b681e0", "filename": "gcc/config/aarch64/aarch64.c", "status": "modified", "additions": 0, "deletions": 4, "changes": 4, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/5d4d78403cbd2fe450425ce8e9e42c8b14b8fca9/gcc%2Fconfig%2Faarch64%2Faarch64.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/5d4d78403cbd2fe450425ce8e9e42c8b14b8fca9/gcc%2Fconfig%2Faarch64%2Faarch64.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fconfig%2Faarch64%2Faarch64.c?ref=5d4d78403cbd2fe450425ce8e9e42c8b14b8fca9", "patch": "@@ -62,7 +62,6 @@\n #include \"rtl-iter.h\"\n #include \"tm-constrs.h\"\n #include \"sched-int.h\"\n-#include \"cortex-a57-fma-steering.h\"\n #include \"target-globals.h\"\n #include \"common/common-target.h\"\n \n@@ -8554,9 +8553,6 @@ aarch64_override_options (void)\n      while processing functions with potential target attributes.  */\n   target_option_default_node = target_option_current_node\n       = build_target_option_node (&global_options);\n-\n-  aarch64_register_fma_steering ();\n-\n }\n \n /* Implement targetm.override_options_after_change.  */"}, {"sha": "8b4384c2937a93748df9f24479ba19281a0e69f5", "filename": "gcc/config/aarch64/cortex-a57-fma-steering.c", "status": "modified", "additions": 1, "deletions": 15, "changes": 16, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/5d4d78403cbd2fe450425ce8e9e42c8b14b8fca9/gcc%2Fconfig%2Faarch64%2Fcortex-a57-fma-steering.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/5d4d78403cbd2fe450425ce8e9e42c8b14b8fca9/gcc%2Fconfig%2Faarch64%2Fcortex-a57-fma-steering.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fconfig%2Faarch64%2Fcortex-a57-fma-steering.c?ref=5d4d78403cbd2fe450425ce8e9e42c8b14b8fca9", "patch": "@@ -36,7 +36,6 @@\n #include \"context.h\"\n #include \"tree-pass.h\"\n #include \"regrename.h\"\n-#include \"cortex-a57-fma-steering.h\"\n #include \"aarch64-protos.h\"\n \n /* For better performance, the destination of FMADD/FMSUB instructions should\n@@ -1069,21 +1068,8 @@ class pass_fma_steering : public rtl_opt_pass\n \n /* Create a new fma steering pass instance.  */\n \n-static rtl_opt_pass *\n+rtl_opt_pass *\n make_pass_fma_steering (gcc::context *ctxt)\n {\n   return new pass_fma_steering (ctxt);\n }\n-\n-/* Register the FMA steering pass to the pass manager.  */\n-\n-void\n-aarch64_register_fma_steering ()\n-{\n-  opt_pass *pass_fma_steering = make_pass_fma_steering (g);\n-\n-  struct register_pass_info fma_steering_info\n-    = { pass_fma_steering, \"rnreg\", 1, PASS_POS_INSERT_AFTER };\n-\n-  register_pass (&fma_steering_info);\n-}"}, {"sha": "04eb63666e8db38367235fc82bb55f826eb8af9a", "filename": "gcc/config/aarch64/t-aarch64", "status": "modified", "additions": 2, "deletions": 1, "changes": 3, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/5d4d78403cbd2fe450425ce8e9e42c8b14b8fca9/gcc%2Fconfig%2Faarch64%2Ft-aarch64", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/5d4d78403cbd2fe450425ce8e9e42c8b14b8fca9/gcc%2Fconfig%2Faarch64%2Ft-aarch64", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fconfig%2Faarch64%2Ft-aarch64?ref=5d4d78403cbd2fe450425ce8e9e42c8b14b8fca9", "patch": "@@ -56,12 +56,13 @@ aarch64-c.o: $(srcdir)/config/aarch64/aarch64-c.c $(CONFIG_H) $(SYSTEM_H) \\\n \t$(COMPILER) -c $(ALL_COMPILERFLAGS) $(ALL_CPPFLAGS) $(INCLUDES) \\\n \t\t$(srcdir)/config/aarch64/aarch64-c.c\n \n+PASSES_EXTRA += $(srcdir)/config/aarch64/aarch64-passes.def\n+\n cortex-a57-fma-steering.o: $(srcdir)/config/aarch64/cortex-a57-fma-steering.c \\\n     $(CONFIG_H) $(SYSTEM_H) $(TM_H) $(REGS_H) insn-config.h $(RTL_BASE_H) \\\n     dominance.h cfg.h cfganal.h $(BASIC_BLOCK_H) $(INSN_ATTR_H) $(RECOG_H) \\\n     output.h hash-map.h $(DF_H) $(OBSTACK_H) $(TARGET_H) $(RTL_H) \\\n     $(CONTEXT_H) $(TREE_PASS_H) regrename.h \\\n-    $(srcdir)/config/aarch64/cortex-a57-fma-steering.h \\\n     $(srcdir)/config/aarch64/aarch64-protos.h\n \t$(COMPILER) -c $(ALL_COMPILERFLAGS) $(ALL_CPPFLAGS) $(INCLUDES) \\\n \t\t$(srcdir)/config/aarch64/cortex-a57-fma-steering.c"}]}