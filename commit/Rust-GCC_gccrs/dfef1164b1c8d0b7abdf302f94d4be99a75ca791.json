{"sha": "dfef1164b1c8d0b7abdf302f94d4be99a75ca791", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6ZGZlZjExNjRiMWM4ZDBiN2FiZGYzMDJmOTRkNGJlOTlhNzVjYTc5MQ==", "commit": {"author": {"name": "Richard Biener", "email": "rguenther@suse.de", "date": "2021-06-14T13:36:57Z"}, "committer": {"name": "Richard Biener", "email": "rguenther@suse.de", "date": "2021-06-15T08:31:16Z"}, "message": "Handle multiple latches in irreducible region mark\n\nThe following makes irreducible region discovery handle multiple latches.\n\n2021-06-14  Richard Biener  <rguenther@suse.de>\n\n\t* cfgloopanal.c (mark_irreducible_loops): Use a dominance\n\tcheck to identify loop latches.\n\t* cfgloop.c (verify_loop_structure): Likewise.\n\t* loop-init.c (apply_loop_flags): Allow marked irreducible\n\tregions even with multiple latches.\n\t* predict.c (rebuild_frequencies): Simplify.", "tree": {"sha": "cb1f0c425f68d95fb5fd006ffed93e366baa1b00", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/cb1f0c425f68d95fb5fd006ffed93e366baa1b00"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/dfef1164b1c8d0b7abdf302f94d4be99a75ca791", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/dfef1164b1c8d0b7abdf302f94d4be99a75ca791", "html_url": "https://github.com/Rust-GCC/gccrs/commit/dfef1164b1c8d0b7abdf302f94d4be99a75ca791", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/dfef1164b1c8d0b7abdf302f94d4be99a75ca791/comments", "author": {"login": "rguenth", "id": 2046526, "node_id": "MDQ6VXNlcjIwNDY1MjY=", "avatar_url": "https://avatars.githubusercontent.com/u/2046526?v=4", "gravatar_id": "", "url": "https://api.github.com/users/rguenth", "html_url": "https://github.com/rguenth", "followers_url": "https://api.github.com/users/rguenth/followers", "following_url": "https://api.github.com/users/rguenth/following{/other_user}", "gists_url": "https://api.github.com/users/rguenth/gists{/gist_id}", "starred_url": "https://api.github.com/users/rguenth/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/rguenth/subscriptions", "organizations_url": "https://api.github.com/users/rguenth/orgs", "repos_url": "https://api.github.com/users/rguenth/repos", "events_url": "https://api.github.com/users/rguenth/events{/privacy}", "received_events_url": "https://api.github.com/users/rguenth/received_events", "type": "User", "site_admin": false}, "committer": {"login": "rguenth", "id": 2046526, "node_id": "MDQ6VXNlcjIwNDY1MjY=", "avatar_url": "https://avatars.githubusercontent.com/u/2046526?v=4", "gravatar_id": "", "url": "https://api.github.com/users/rguenth", "html_url": "https://github.com/rguenth", "followers_url": "https://api.github.com/users/rguenth/followers", "following_url": "https://api.github.com/users/rguenth/following{/other_user}", "gists_url": "https://api.github.com/users/rguenth/gists{/gist_id}", "starred_url": "https://api.github.com/users/rguenth/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/rguenth/subscriptions", "organizations_url": "https://api.github.com/users/rguenth/orgs", "repos_url": "https://api.github.com/users/rguenth/repos", "events_url": "https://api.github.com/users/rguenth/events{/privacy}", "received_events_url": "https://api.github.com/users/rguenth/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "b10f895f41dbe98f2a7d448b91d083a68792a6a0", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/b10f895f41dbe98f2a7d448b91d083a68792a6a0", "html_url": "https://github.com/Rust-GCC/gccrs/commit/b10f895f41dbe98f2a7d448b91d083a68792a6a0"}], "stats": {"total": 22, "additions": 14, "deletions": 8}, "files": [{"sha": "f094538b9ff033c07b8e13f9c368a9d2a7ec322c", "filename": "gcc/cfgloop.c", "status": "modified", "additions": 10, "deletions": 4, "changes": 14, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/dfef1164b1c8d0b7abdf302f94d4be99a75ca791/gcc%2Fcfgloop.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/dfef1164b1c8d0b7abdf302f94d4be99a75ca791/gcc%2Fcfgloop.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fcfgloop.c?ref=dfef1164b1c8d0b7abdf302f94d4be99a75ca791", "patch": "@@ -1555,11 +1555,17 @@ verify_loop_structure (void)\n \t  error (\"loop %d%'s header does not belong directly to it\", i);\n \t  err = 1;\n \t}\n-      if (loops_state_satisfies_p (LOOPS_HAVE_MARKED_IRREDUCIBLE_REGIONS)\n-\t  && (loop_latch_edge (loop)->flags & EDGE_IRREDUCIBLE_LOOP))\n+      if (loops_state_satisfies_p (LOOPS_HAVE_MARKED_IRREDUCIBLE_REGIONS))\n \t{\n-\t  error (\"loop %d%'s latch is marked as part of irreducible region\", i);\n-\t  err = 1;\n+\t  edge_iterator ei;\n+\t  FOR_EACH_EDGE (e, ei, loop->header->preds)\n+\t    if (dominated_by_p (CDI_DOMINATORS, e->src, loop->header)\n+\t\t&& e->flags & EDGE_IRREDUCIBLE_LOOP)\n+\t      {\n+\t\terror (\"loop %d%'s latch is marked as part of irreducible\"\n+\t\t       \" region\", i);\n+\t\terr = 1;\n+\t      }\n \t}\n     }\n "}, {"sha": "54426b54881f4fc658717478326a6998a53efb39", "filename": "gcc/cfgloopanal.c", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/dfef1164b1c8d0b7abdf302f94d4be99a75ca791/gcc%2Fcfgloopanal.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/dfef1164b1c8d0b7abdf302f94d4be99a75ca791/gcc%2Fcfgloopanal.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fcfgloopanal.c?ref=dfef1164b1c8d0b7abdf302f94d4be99a75ca791", "patch": "@@ -113,7 +113,7 @@ mark_irreducible_loops (void)\n \n \t/* Ignore latch edges.  */\n \tif (e->dest->loop_father->header == e->dest\n-\t    && e->dest->loop_father->latch == act)\n+\t    && dominated_by_p (CDI_DOMINATORS, act, e->dest))\n \t  continue;\n \n \t/* Edges inside a single loop should be left where they are.  Edges"}, {"sha": "1fde0ede441246c163abc0d6f3fc73d625e350a8", "filename": "gcc/loop-init.c", "status": "modified", "additions": 2, "deletions": 1, "changes": 3, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/dfef1164b1c8d0b7abdf302f94d4be99a75ca791/gcc%2Floop-init.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/dfef1164b1c8d0b7abdf302f94d4be99a75ca791/gcc%2Floop-init.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Floop-init.c?ref=dfef1164b1c8d0b7abdf302f94d4be99a75ca791", "patch": "@@ -48,7 +48,8 @@ apply_loop_flags (unsigned flags)\n \t not work).  However, we avoid modifying cfg, which some\n \t passes may want.  */\n       gcc_assert ((flags & ~(LOOPS_MAY_HAVE_MULTIPLE_LATCHES\n-\t\t\t     | LOOPS_HAVE_RECORDED_EXITS)) == 0);\n+\t\t\t     | LOOPS_HAVE_RECORDED_EXITS\n+\t\t\t     | LOOPS_HAVE_MARKED_IRREDUCIBLE_REGIONS)) == 0);\n       loops_state_set (LOOPS_MAY_HAVE_MULTIPLE_LATCHES);\n     }\n   else"}, {"sha": "d751e6cecce15a6e806198d5d79a489912f9e518", "filename": "gcc/predict.c", "status": "modified", "additions": 1, "deletions": 2, "changes": 3, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/dfef1164b1c8d0b7abdf302f94d4be99a75ca791/gcc%2Fpredict.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/dfef1164b1c8d0b7abdf302f94d4be99a75ca791/gcc%2Fpredict.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fpredict.c?ref=dfef1164b1c8d0b7abdf302f94d4be99a75ca791", "patch": "@@ -4287,8 +4287,7 @@ rebuild_frequencies (void)\n \n   if (profile_status_for_fn (cfun) == PROFILE_GUESSED)\n     {\n-      loop_optimizer_init (0);\n-      mark_irreducible_loops ();\n+      loop_optimizer_init (LOOPS_HAVE_MARKED_IRREDUCIBLE_REGIONS);\n       connect_infinite_loops_to_exit ();\n       estimate_bb_frequencies (true);\n       remove_fake_exit_edges ();"}]}