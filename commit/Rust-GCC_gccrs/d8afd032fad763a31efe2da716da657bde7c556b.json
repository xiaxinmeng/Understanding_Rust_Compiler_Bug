{"sha": "d8afd032fad763a31efe2da716da657bde7c556b", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6ZDhhZmQwMzJmYWQ3NjNhMzFlZmUyZGE3MTZkYTY1N2JkZTdjNTU2Yg==", "commit": {"author": {"name": "Thomas Koenig", "email": "tkoenig@gcc.gnu.org", "date": "2017-08-01T19:09:02Z"}, "committer": {"name": "Thomas Koenig", "email": "tkoenig@gcc.gnu.org", "date": "2017-08-01T19:09:02Z"}, "message": "re PR fortran/79312 (Empty array in assignment not correctly type-checked)\n\n2017-08-01  Thomas K\u00f6nig  <tkoenig@gcc.gnu.org>\n\n\tPR fortran/79312\n\t* intrisic.c (gfc_convert_type_warn):  Only set typespec for\n\tempty array constructors which don't have it already.\n\n2017-08-01  Thomas K\u00f6nig  <tkoenig@gcc.gnu.org>\n\n\tPR fortran/79312\n\t* gfortran.dg/logical_assignment_1.f90:  New test.\n\nFrom-SVN: r250792", "tree": {"sha": "a3447ff3781055304ee585118d953f2687c5e14e", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/a3447ff3781055304ee585118d953f2687c5e14e"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/d8afd032fad763a31efe2da716da657bde7c556b", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/d8afd032fad763a31efe2da716da657bde7c556b", "html_url": "https://github.com/Rust-GCC/gccrs/commit/d8afd032fad763a31efe2da716da657bde7c556b", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/d8afd032fad763a31efe2da716da657bde7c556b/comments", "author": null, "committer": null, "parents": [{"sha": "e655a6cc43e880b291b726394c1c6be6db461e89", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/e655a6cc43e880b291b726394c1c6be6db461e89", "html_url": "https://github.com/Rust-GCC/gccrs/commit/e655a6cc43e880b291b726394c1c6be6db461e89"}], "stats": {"total": 29, "additions": 26, "deletions": 3}, "files": [{"sha": "7c10d8c59f3c32b90917610dccc37132e2ff09d7", "filename": "gcc/fortran/ChangeLog", "status": "modified", "additions": 6, "deletions": 0, "changes": 6, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/d8afd032fad763a31efe2da716da657bde7c556b/gcc%2Ffortran%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/d8afd032fad763a31efe2da716da657bde7c556b/gcc%2Ffortran%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ffortran%2FChangeLog?ref=d8afd032fad763a31efe2da716da657bde7c556b", "patch": "@@ -1,3 +1,9 @@\n+2017-08-01  Thomas K\u00f6nig  <tkoenig@gcc.gnu.org>\n+\n+\tPR fortran/79312\n+\t* intrisic.c (gfc_convert_type_warn):  Only set typespec for\n+\tempty array constructors which don't have it already.\n+\n 2017-08-01  Thomas Koenig  <tkoenig@gcc.gnu.org>\n \n \tPR fortran/45435"}, {"sha": "8965d509882bc40dd3a03fd8dfc6a6453d8a5685", "filename": "gcc/fortran/intrinsic.c", "status": "modified", "additions": 5, "deletions": 3, "changes": 8, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/d8afd032fad763a31efe2da716da657bde7c556b/gcc%2Ffortran%2Fintrinsic.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/d8afd032fad763a31efe2da716da657bde7c556b/gcc%2Ffortran%2Fintrinsic.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ffortran%2Fintrinsic.c?ref=d8afd032fad763a31efe2da716da657bde7c556b", "patch": "@@ -4919,9 +4919,11 @@ gfc_convert_type_warn (gfc_expr *expr, gfc_typespec *ts, int eflag, int wflag)\n   if (ts->type == BT_UNKNOWN)\n     goto bad;\n \n-  /* NULL and zero size arrays get their type here.  */\n-  if (expr->expr_type == EXPR_NULL\n-      || (expr->expr_type == EXPR_ARRAY && expr->value.constructor == NULL))\n+  /* NULL and zero size arrays get their type here, unless they already have a\n+     typespec.  */\n+  if ((expr->expr_type == EXPR_NULL\n+       || (expr->expr_type == EXPR_ARRAY && expr->value.constructor == NULL))\n+      && expr->ts.type == BT_UNKNOWN)\n     {\n       /* Sometimes the RHS acquire the type.  */\n       expr->ts = *ts;"}, {"sha": "3ba6bb980706a3f53a3bdce463f699033f4fd0b2", "filename": "gcc/testsuite/ChangeLog", "status": "modified", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/d8afd032fad763a31efe2da716da657bde7c556b/gcc%2Ftestsuite%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/d8afd032fad763a31efe2da716da657bde7c556b/gcc%2Ftestsuite%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2FChangeLog?ref=d8afd032fad763a31efe2da716da657bde7c556b", "patch": "@@ -1,3 +1,8 @@\n+2017-08-01  Thomas K\u00f6nig  <tkoenig@gcc.gnu.org>\n+\n+\tPR fortran/79312\n+\t* gfortran.dg/logical_assignment_1.f90:  New test.\n+\n 2017-08-01  Martin Liska  <mliska@suse.cz>\n \n \tPR middle-end/70140"}, {"sha": "c22898051183e9d0701e309916a5d1a656711ca8", "filename": "gcc/testsuite/gfortran.dg/logical_assignment_1.f90", "status": "added", "additions": 10, "deletions": 0, "changes": 10, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/d8afd032fad763a31efe2da716da657bde7c556b/gcc%2Ftestsuite%2Fgfortran.dg%2Flogical_assignment_1.f90", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/d8afd032fad763a31efe2da716da657bde7c556b/gcc%2Ftestsuite%2Fgfortran.dg%2Flogical_assignment_1.f90", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgfortran.dg%2Flogical_assignment_1.f90?ref=d8afd032fad763a31efe2da716da657bde7c556b", "patch": "@@ -0,0 +1,10 @@\n+! { dg-do compile }\n+! PR 79312 - assigning a logical value to a real\n+! is invalid.\n+! Test case by John Harper.\n+program emptyarray5\n+  implicit none\n+  real a(0)\n+  a = [logical::] ! { dg-error \"Can't convert LOGICAL\" }\n+  print *,size(a)\n+end program emptyarray5"}]}