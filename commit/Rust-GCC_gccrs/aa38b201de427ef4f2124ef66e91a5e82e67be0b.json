{"sha": "aa38b201de427ef4f2124ef66e91a5e82e67be0b", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6YWEzOGIyMDFkZTQyN2VmNGYyMTI0ZWY2NmU5MWE1ZTgyZTY3YmUwYg==", "commit": {"author": {"name": "Torbjorn Granlund", "email": "tege@gnu.org", "date": "1994-01-03T22:20:01Z"}, "committer": {"name": "Torbjorn Granlund", "email": "tege@gnu.org", "date": "1994-01-03T22:20:01Z"}, "message": "(thread_jumps): Don't thread to loop label; create new label before loop instead.\n\n(thread_jumps): Don't thread to loop label; create new label\nbefore loop instead.\n(thread_jumps): Rename argument `verbose' -> `flag_before_jump'.\n\nFrom-SVN: r6354", "tree": {"sha": "a25165f35d2b4b27922886fde5a1d43d8ad2efb2", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/a25165f35d2b4b27922886fde5a1d43d8ad2efb2"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/aa38b201de427ef4f2124ef66e91a5e82e67be0b", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/aa38b201de427ef4f2124ef66e91a5e82e67be0b", "html_url": "https://github.com/Rust-GCC/gccrs/commit/aa38b201de427ef4f2124ef66e91a5e82e67be0b", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/aa38b201de427ef4f2124ef66e91a5e82e67be0b/comments", "author": null, "committer": null, "parents": [{"sha": "8b39ed65f13d64dbf5fe0083837eb1cbf039a5f4", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/8b39ed65f13d64dbf5fe0083837eb1cbf039a5f4", "html_url": "https://github.com/Rust-GCC/gccrs/commit/8b39ed65f13d64dbf5fe0083837eb1cbf039a5f4"}], "stats": {"total": 22, "additions": 17, "deletions": 5}, "files": [{"sha": "9e0230fb05e5fd11c3245b92093fa7a81117bf96", "filename": "gcc/jump.c", "status": "modified", "additions": 17, "deletions": 5, "changes": 22, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/aa38b201de427ef4f2124ef66e91a5e82e67be0b/gcc%2Fjump.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/aa38b201de427ef4f2124ef66e91a5e82e67be0b/gcc%2Fjump.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fjump.c?ref=aa38b201de427ef4f2124ef66e91a5e82e67be0b", "patch": "@@ -3946,10 +3946,10 @@ mark_modified_reg (dest, x)\n /* F is the first insn in the chain of insns.  */\n    \n void\n-thread_jumps (f, max_reg, verbose)\n+thread_jumps (f, max_reg, flag_before_loop)\n      rtx f;\n      int max_reg;\n-     int verbose;\n+     int flag_before_loop;\n {\n   /* Basic algorithm is to find a conditional branch,\n      the label it may branch to, and the branch after\n@@ -4090,9 +4090,21 @@ thread_jumps (f, max_reg, verbose)\n \t\t      else\n \t\t\tnew_label = get_label_after (b2);\n \n-\t\t      if (JUMP_LABEL (b1) != new_label\n-\t\t\t  && redirect_jump (b1, new_label))\n-\t\t\tchanged = 1;\n+\t\t      if (JUMP_LABEL (b1) != new_label)\n+\t\t\t{\n+\t\t\t  rtx prev = PREV_INSN (new_label);\n+\n+\t\t\t  if (flag_before_loop\n+\t\t\t      && NOTE_LINE_NUMBER (prev) == NOTE_INSN_LOOP_BEG)\n+\t\t\t    {\n+\t\t\t      /* Don't thread to the loop label.  If a loop\n+\t\t\t\t label is reused, loop optimization will\n+\t\t\t\t be disabled for that loop.  */\n+\t\t\t      new_label = gen_label_rtx ();\n+\t\t\t      emit_label_after (new_label, PREV_INSN (prev));\n+\t\t\t    }\n+\t\t\t  changed |= redirect_jump (b1, new_label);\n+\t\t\t}\n \t\t      break;\n \t\t    }\n \t\t    "}]}