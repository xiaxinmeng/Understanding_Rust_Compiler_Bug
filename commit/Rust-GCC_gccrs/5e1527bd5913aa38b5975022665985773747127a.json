{"sha": "5e1527bd5913aa38b5975022665985773747127a", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6NWUxNTI3YmQ1OTEzYWEzOGI1OTc1MDIyNjY1OTg1NzczNzQ3MTI3YQ==", "commit": {"author": {"name": "Javier Miranda", "email": "miranda@adacore.com", "date": "2007-08-14T08:44:53Z"}, "committer": {"name": "Arnaud Charlet", "email": "charlet@gcc.gnu.org", "date": "2007-08-14T08:44:53Z"}, "message": "a-tags.ads, a-tags.adb (Displace): Associate a message with the raised CE exception.\n\n2007-08-14  Javier Miranda  <miranda@adacore.com>\n\n\t* a-tags.ads, \n\ta-tags.adb (Displace): Associate a message with the raised CE\n\texception.\n\t(To_Addr_Ptr, To_Address, To_Dispatch_Table_Ptr,\n\tTo_Object_Specific_Data_Ptr To_Predef_Prims_Ptr,\n\tTo_Tag_Ptr, To_Type_Specific_Data_Ptr): Moved here from the package\n\tspec.\n\t(Default_Prim_Op_Count): Removed.\n\t(IW_Membership, Get_Entry_Index, Get_Offset_Index, Get_Prim_Op_Kind,\n\tRegister_Tag, Set_Entry_Index, Set_Offset_To_Top, Set_Prim_Op_Kind):\n\tRemove pragma Inline_Always.\n\n\t* rtsfind.ads (Default_Prim_Op_Count): Removed\n\t(Max_Predef_Prims): New entity\n\t(RE_Expanded_Name): Removed\n\t(RE_HT_Link): Removed\n\t(RE_Iface_Tag): Remmoved\n\t(RE_Ifaces_Table): Removed\n\t(RE_Interfaces_Array): Removed\n\t(RE_Interface_Data_Element): Removed\n\t(RE_Nb_Ifaces): Removed\n\t(RE_RC_Offset): Removed\n\t(RE_Static_Offset_To_Top): Removed\n\n\t* exp_atag.ads (Build_Inherit_Prims): Addition of a new formal.\n\t(Build_Inherit_Predefined_Prims): Replace occurrences of Default_\n\tPrim_Op_Count by Max_Predef_Prims.\n\nFrom-SVN: r127438", "tree": {"sha": "57ff8ef3f27de425565772583668292443f40cb5", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/57ff8ef3f27de425565772583668292443f40cb5"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/5e1527bd5913aa38b5975022665985773747127a", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/5e1527bd5913aa38b5975022665985773747127a", "html_url": "https://github.com/Rust-GCC/gccrs/commit/5e1527bd5913aa38b5975022665985773747127a", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/5e1527bd5913aa38b5975022665985773747127a/comments", "author": {"login": "miranda-adacore", "id": 54413934, "node_id": "MDQ6VXNlcjU0NDEzOTM0", "avatar_url": "https://avatars.githubusercontent.com/u/54413934?v=4", "gravatar_id": "", "url": "https://api.github.com/users/miranda-adacore", "html_url": "https://github.com/miranda-adacore", "followers_url": "https://api.github.com/users/miranda-adacore/followers", "following_url": "https://api.github.com/users/miranda-adacore/following{/other_user}", "gists_url": "https://api.github.com/users/miranda-adacore/gists{/gist_id}", "starred_url": "https://api.github.com/users/miranda-adacore/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/miranda-adacore/subscriptions", "organizations_url": "https://api.github.com/users/miranda-adacore/orgs", "repos_url": "https://api.github.com/users/miranda-adacore/repos", "events_url": "https://api.github.com/users/miranda-adacore/events{/privacy}", "received_events_url": "https://api.github.com/users/miranda-adacore/received_events", "type": "User", "site_admin": false}, "committer": null, "parents": [{"sha": "fdcf961c8e31aac50b7b5f3f1a9ea4f77950c0d7", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/fdcf961c8e31aac50b7b5f3f1a9ea4f77950c0d7", "html_url": "https://github.com/Rust-GCC/gccrs/commit/fdcf961c8e31aac50b7b5f3f1a9ea4f77950c0d7"}], "stats": {"total": 134, "additions": 57, "deletions": 77}, "files": [{"sha": "5a0cf71494a2236db3d4c0d8db1dc1bc5189c3c5", "filename": "gcc/ada/a-tags.adb", "status": "modified", "additions": 27, "deletions": 10, "changes": 37, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/5e1527bd5913aa38b5975022665985773747127a/gcc%2Fada%2Fa-tags.adb", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/5e1527bd5913aa38b5975022665985773747127a/gcc%2Fada%2Fa-tags.adb", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fada%2Fa-tags.adb?ref=5e1527bd5913aa38b5975022665985773747127a", "patch": "@@ -32,6 +32,7 @@\n ------------------------------------------------------------------------------\n \n with Ada.Exceptions;\n+with Ada.Unchecked_Conversion;\n with System.HTable;\n with System.Storage_Elements; use System.Storage_Elements;\n with System.WCh_Con;          use System.WCh_Con;\n@@ -76,26 +77,42 @@ package body Ada.Tags is\n    pragma Inline_Always (OSD);\n    pragma Inline_Always (SSD);\n \n-   ---------------------------------------------\n-   -- Unchecked Conversions for String Fields --\n-   ---------------------------------------------\n+   --  Unchecked conversions\n \n    function To_Address is\n      new Unchecked_Conversion (Cstring_Ptr, System.Address);\n \n    function To_Cstring_Ptr is\n      new Unchecked_Conversion (System.Address, Cstring_Ptr);\n \n-   --  Disable warnings on possible aliasing problem because we only use\n-   --  use this function to convert tags found in the External_Tag of\n-   --  locally defined tagged types.\n-\n-   pragma Warnings (off);\n+   --  Disable warnings on possible aliasing problem\n \n    function To_Tag is\n      new Unchecked_Conversion (Integer_Address, Tag);\n \n-   pragma Warnings (on);\n+   function To_Addr_Ptr is\n+      new Ada.Unchecked_Conversion (System.Address, Addr_Ptr);\n+\n+   function To_Address is\n+     new Ada.Unchecked_Conversion (Tag, System.Address);\n+\n+   function To_Dispatch_Table_Ptr is\n+      new Ada.Unchecked_Conversion (Tag, Dispatch_Table_Ptr);\n+\n+   function To_Dispatch_Table_Ptr is\n+      new Ada.Unchecked_Conversion (System.Address, Dispatch_Table_Ptr);\n+\n+   function To_Object_Specific_Data_Ptr is\n+     new Ada.Unchecked_Conversion (System.Address, Object_Specific_Data_Ptr);\n+\n+   function To_Predef_Prims_Table_Ptr is\n+     new Ada.Unchecked_Conversion (System.Address, Predef_Prims_Table_Ptr);\n+\n+   function To_Tag_Ptr is\n+     new Ada.Unchecked_Conversion (System.Address, Tag_Ptr);\n+\n+   function To_Type_Specific_Data_Ptr is\n+     new Ada.Unchecked_Conversion (System.Address, Type_Specific_Data_Ptr);\n \n    ------------------------------------------------\n    -- Unchecked Conversions for other components --\n@@ -357,7 +374,7 @@ package body Ada.Tags is\n \n       --  If the object does not implement the interface we must raise CE\n \n-      raise Constraint_Error;\n+      raise Constraint_Error with \"invalid interface conversion\";\n    end Displace;\n \n    --------"}, {"sha": "a41ae9d1240bc8a2b5431f9de97f72eb067ed1f1", "filename": "gcc/ada/a-tags.ads", "status": "modified", "additions": 14, "deletions": 49, "changes": 63, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/5e1527bd5913aa38b5975022665985773747127a/gcc%2Fada%2Fa-tags.ads", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/5e1527bd5913aa38b5975022665985773747127a/gcc%2Fada%2Fa-tags.ads", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fada%2Fa-tags.ads?ref=5e1527bd5913aa38b5975022665985773747127a", "patch": "@@ -37,7 +37,6 @@\n \n with System;\n with System.Storage_Elements;\n-with Ada.Unchecked_Conversion;\n \n package Ada.Tags is\n    pragma Preelaborate_05;\n@@ -273,6 +272,7 @@ private\n    end record;\n \n    type Type_Specific_Data_Ptr is access all Type_Specific_Data;\n+   pragma No_Strict_Aliasing (Type_Specific_Data_Ptr);\n \n    --  Declarations for the dispatch table record\n \n@@ -321,6 +321,8 @@ private\n    --  gdb, its name must not be changed.\n \n    type Tag is access all Dispatch_Table;\n+   pragma No_Strict_Aliasing (Tag);\n+\n    type Interface_Tag is access all Dispatch_Table;\n \n    No_Tag : constant Tag := null;\n@@ -329,7 +331,10 @@ private\n    --  of the wrapper.\n \n    type Tag_Ptr is access all Tag;\n+   pragma No_Strict_Aliasing (Tag_Ptr);\n+\n    type Dispatch_Table_Ptr is access all Dispatch_Table_Wrapper;\n+   pragma No_Strict_Aliasing (Dispatch_Table_Ptr);\n \n    --  The following type declaration is used by the compiler when the program\n    --  is compiled with restriction No_Dispatching_Calls. It is also used with\n@@ -341,11 +346,6 @@ private\n       NDT_Prims_Ptr : Natural;\n    end record;\n \n-   Default_Prim_Op_Count : constant Positive := 15;\n-   --  Number of predefined ada primitives: Size, Alignment, Read, Write,\n-   --  Input, Output, \"=\", assignment, deep adjust, deep finalize, async\n-   --  select, conditional select, prim_op kind, task_id, and timed select.\n-\n    DT_Predef_Prims_Size : constant SSE.Storage_Count :=\n                             SSE.Storage_Count\n                               (1 * (Standard'Address_Size /\n@@ -385,6 +385,7 @@ private\n    end record;\n \n    type Object_Specific_Data_Ptr is access all Object_Specific_Data;\n+   pragma No_Strict_Aliasing (Object_Specific_Data_Ptr);\n \n    --  The following subprogram specifications are placed here instead of\n    --  the package body to see them from the frontend through rtsfind.\n@@ -494,52 +495,16 @@ private\n    --  Ada 2005 (AI-251): Set the kind of a primitive operation in T's TSD\n    --  table indexed by Position.\n \n-   --  Unchecked Conversions\n-\n-   Max_Predef_Prims : constant Natural := 16;\n-   --  Compiler should check this constant is OK ???\n+   Max_Predef_Prims : constant Positive := 15;\n+   --  Number of reserved slots for predefined ada primitives: Size, Alignment,\n+   --  Read, Write, Input, Output, \"=\", assignment, deep adjust, deep finalize,\n+   --  async select, conditional select, prim_op kind, task_id, and timed\n+   --  select. The compiler checks that this value is correct.\n \n    subtype Predef_Prims_Table  is Address_Array (1 .. Max_Predef_Prims);\n    type Predef_Prims_Table_Ptr is access Predef_Prims_Table;\n+   pragma No_Strict_Aliasing (Predef_Prims_Table_Ptr);\n \n    type Addr_Ptr is access System.Address;\n-\n-   function To_Addr_Ptr is\n-      new Ada.Unchecked_Conversion (System.Address, Addr_Ptr);\n-\n-   function To_Address is\n-     new Ada.Unchecked_Conversion (Tag, System.Address);\n-\n-   function To_Dispatch_Table_Ptr is\n-      new Ada.Unchecked_Conversion (Tag, Dispatch_Table_Ptr);\n-\n-   function To_Dispatch_Table_Ptr is\n-      new Ada.Unchecked_Conversion (System.Address, Dispatch_Table_Ptr);\n-\n-   function To_Object_Specific_Data_Ptr is\n-     new Ada.Unchecked_Conversion (System.Address, Object_Specific_Data_Ptr);\n-\n-   function To_Predef_Prims_Table_Ptr is\n-      new Ada.Unchecked_Conversion (System.Address, Predef_Prims_Table_Ptr);\n-\n-   function To_Tag_Ptr is\n-     new Ada.Unchecked_Conversion (System.Address, Tag_Ptr);\n-\n-   function To_Type_Specific_Data_Ptr is\n-     new Ada.Unchecked_Conversion (System.Address, Type_Specific_Data_Ptr);\n-\n-   --  Primitive dispatching operations are always inlined, to facilitate use\n-   --  in a minimal/no run-time environment for high integrity use.\n-\n-   pragma Inline_Always (Displace);\n-   pragma Inline_Always (IW_Membership);\n-   pragma Inline_Always (Get_Entry_Index);\n-   pragma Inline_Always (Get_Offset_Index);\n-   pragma Inline_Always (Get_Prim_Op_Kind);\n-   pragma Inline_Always (Get_Tagged_Kind);\n-   pragma Inline_Always (Register_Tag);\n-   pragma Inline_Always (Set_Entry_Index);\n-   pragma Inline_Always (Set_Offset_To_Top);\n-   pragma Inline_Always (Set_Prim_Op_Kind);\n-\n+   pragma No_Strict_Aliasing (Addr_Ptr);\n end Ada.Tags;"}, {"sha": "3e7e77300466798c9cb4e2a9cee0797fba30fee9", "filename": "gcc/ada/exp_atag.ads", "status": "modified", "additions": 8, "deletions": 2, "changes": 10, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/5e1527bd5913aa38b5975022665985773747127a/gcc%2Fada%2Fexp_atag.ads", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/5e1527bd5913aa38b5975022665985773747127a/gcc%2Fada%2Fexp_atag.ads", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fada%2Fexp_atag.ads?ref=5e1527bd5913aa38b5975022665985773747127a", "patch": "@@ -32,6 +32,9 @@ with Uintp; use Uintp;\n \n package Exp_Atag is\n \n+   --  Note: In all the subprograms of this package formal 'Loc' is the source\n+   --  location used in constructing the corresponding nodes.\n+\n    procedure Build_Common_Dispatching_Select_Statements\n      (Loc    : Source_Ptr;\n       DT_Ptr : Entity_Id;\n@@ -100,12 +103,15 @@ package Exp_Atag is\n \n    function Build_Inherit_Prims\n      (Loc          : Source_Ptr;\n+      Typ          : Entity_Id;\n       Old_Tag_Node : Node_Id;\n       New_Tag_Node : Node_Id;\n       Num_Prims    : Nat) return Node_Id;\n    --  Build code that inherits Num_Prims user-defined primitives from the\n-   --  dispatch table of the parent type. It is used to copy the dispatch\n-   --  table of the parent in case of derivations of CPP_Class types.\n+   --  dispatch table of the parent type of tagged type Typ. It is used to\n+   --  copy the dispatch table of the parent in the following cases:\n+   --    a) case of derivations of CPP_Class types\n+   --    b) tagged types whose dispatch table is not statically allocated\n    --\n    --  Generates:\n    --    New_Tag.Prims_Ptr (1 .. Num_Prims) :="}, {"sha": "769720e458cda7ae958234f58a1802552f979f3a", "filename": "gcc/ada/rtsfind.ads", "status": "modified", "additions": 8, "deletions": 16, "changes": 24, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/5e1527bd5913aa38b5975022665985773747127a/gcc%2Fada%2Frtsfind.ads", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/5e1527bd5913aa38b5975022665985773747127a/gcc%2Fada%2Frtsfind.ads", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fada%2Frtsfind.ads?ref=5e1527bd5913aa38b5975022665985773747127a", "patch": "@@ -492,31 +492,28 @@ package Rtsfind is\n      RE_Addr_Ptr,                        -- Ada.Tags\n      RE_Base_Address,                    -- Ada.Tags\n      RE_Cstring_Ptr,                     -- Ada.Tags\n-     RE_Default_Prim_Op_Count,           -- Ada.Tags\n      RE_Descendant_Tag,                  -- Ada.Tags\n      RE_Dispatch_Table,                  -- Ada.Tags\n      RE_Dispatch_Table_Wrapper,          -- Ada.Tags\n      RE_Displace,                        -- Ada.Tags\n      RE_DT,                              -- Ada.Tags\n      RE_DT_Predef_Prims_Offset,          -- Ada.Tags\n      RE_DT_Typeinfo_Ptr_Size,            -- Ada.Tags\n-     RE_Expanded_Name,                   -- Ada.Tags\n      RE_External_Tag,                    -- Ada.Tags\n-     RE_HT_Link,                         -- Ada.Tags\n      RO_TA_External_Tag,                 -- Ada.Tags\n      RE_Get_Access_Level,                -- Ada.Tags\n      RE_Get_Entry_Index,                 -- Ada.Tags\n      RE_Get_Offset_Index,                -- Ada.Tags\n      RE_Get_Prim_Op_Kind,                -- Ada.Tags\n      RE_Get_Tagged_Kind,                 -- Ada.Tags\n      RE_Idepth,                          -- Ada.Tags\n-     RE_Iface_Tag,                       -- Ada.Tags\n-     RE_Ifaces_Table,                    -- Ada.Tags\n+     RE_Interfaces_Array,                -- Ada.Tags\n      RE_Interfaces_Table,                -- Ada.Tags\n      RE_Interface_Data,                  -- Ada.Tags\n+     RE_Interface_Data_Element,          -- Ada.Tags\n      RE_Interface_Tag,                   -- Ada.Tags\n      RE_IW_Membership,                   -- Ada.Tags\n-     RE_Nb_Ifaces,                       -- Ada.Tags\n+     RE_Max_Predef_Prims,                -- Ada.Tags\n      RE_No_Dispatch_Table_Wrapper,       -- Ada.Tags\n      RE_NDT_Prims_Ptr,                   -- Ada.Tags\n      RE_NDT_TSD,                         -- Ada.Tags\n@@ -545,13 +542,11 @@ package Rtsfind is\n      RE_Type_Specific_Data,              -- Ada.Tags\n      RE_Register_Tag,                    -- Ada.Tags\n      RE_Transportable,                   -- Ada.Tags\n-     RE_RC_Offset,                       -- Ada.Tags\n      RE_Secondary_DT,                    -- Ada.Tags\n      RE_Select_Specific_Data,            -- Ada.Tags\n      RE_Set_Entry_Index,                 -- Ada.Tags\n      RE_Set_Offset_To_Top,               -- Ada.Tags\n      RE_Set_Prim_Op_Kind,                -- Ada.Tags\n-     RE_Static_Offset_To_Top,            -- Ada.Tags\n      RE_Tag,                             -- Ada.Tags\n      RE_Tag_Error,                       -- Ada.Tags\n      RE_Tag_Kind,                        -- Ada.Tags\n@@ -1050,6 +1045,7 @@ package Rtsfind is\n      RE_Unspecified_Size,                -- System.Parameters\n \n      RE_DSA_Implementation,              -- System.Partition_Interface\n+     RE_PCS_Version,                     -- System.Partition_Interface\n      RE_Get_RCI_Package_Receiver,        -- System.Partition_Interface\n      RE_Get_Unique_Remote_Pointer,       -- System.Partition_Interface\n      RE_RACW_Stub_Type_Access,           -- System.Partition_Interface\n@@ -1598,31 +1594,28 @@ package Rtsfind is\n      RE_Addr_Ptr                         => Ada_Tags,\n      RE_Base_Address                     => Ada_Tags,\n      RE_Cstring_Ptr                      => Ada_Tags,\n-     RE_Default_Prim_Op_Count            => Ada_Tags,\n      RE_Descendant_Tag                   => Ada_Tags,\n      RE_Dispatch_Table                   => Ada_Tags,\n      RE_Dispatch_Table_Wrapper           => Ada_Tags,\n      RE_Displace                         => Ada_Tags,\n      RE_DT                               => Ada_Tags,\n      RE_DT_Predef_Prims_Offset           => Ada_Tags,\n      RE_DT_Typeinfo_Ptr_Size             => Ada_Tags,\n-     RE_Expanded_Name                    => Ada_Tags,\n      RE_External_Tag                     => Ada_Tags,\n-     RE_HT_Link                          => Ada_Tags,\n      RO_TA_External_Tag                  => Ada_Tags,\n      RE_Get_Access_Level                 => Ada_Tags,\n      RE_Get_Entry_Index                  => Ada_Tags,\n      RE_Get_Offset_Index                 => Ada_Tags,\n      RE_Get_Prim_Op_Kind                 => Ada_Tags,\n      RE_Get_Tagged_Kind                  => Ada_Tags,\n      RE_Idepth                           => Ada_Tags,\n-     RE_Iface_Tag                        => Ada_Tags,\n-     RE_Ifaces_Table                     => Ada_Tags,\n+     RE_Interfaces_Array                 => Ada_Tags,\n      RE_Interfaces_Table                 => Ada_Tags,\n      RE_Interface_Data                   => Ada_Tags,\n+     RE_Interface_Data_Element           => Ada_Tags,\n      RE_Interface_Tag                    => Ada_Tags,\n      RE_IW_Membership                    => Ada_Tags,\n-     RE_Nb_Ifaces                        => Ada_Tags,\n+     RE_Max_Predef_Prims                 => Ada_Tags,\n      RE_No_Dispatch_Table_Wrapper        => Ada_Tags,\n      RE_NDT_Prims_Ptr                    => Ada_Tags,\n      RE_NDT_TSD                          => Ada_Tags,\n@@ -1651,13 +1644,11 @@ package Rtsfind is\n      RE_Type_Specific_Data               => Ada_Tags,\n      RE_Register_Tag                     => Ada_Tags,\n      RE_Transportable                    => Ada_Tags,\n-     RE_RC_Offset                        => Ada_Tags,\n      RE_Secondary_DT                     => Ada_Tags,\n      RE_Select_Specific_Data             => Ada_Tags,\n      RE_Set_Entry_Index                  => Ada_Tags,\n      RE_Set_Offset_To_Top                => Ada_Tags,\n      RE_Set_Prim_Op_Kind                 => Ada_Tags,\n-     RE_Static_Offset_To_Top             => Ada_Tags,\n      RE_Tag                              => Ada_Tags,\n      RE_Tag_Error                        => Ada_Tags,\n      RE_Tag_Kind                         => Ada_Tags,\n@@ -2154,6 +2145,7 @@ package Rtsfind is\n      RE_Unspecified_Size                 => System_Parameters,\n \n      RE_DSA_Implementation               => System_Partition_Interface,\n+     RE_PCS_Version                      => System_Partition_Interface,\n      RE_Get_RCI_Package_Receiver         => System_Partition_Interface,\n      RE_Get_Unique_Remote_Pointer        => System_Partition_Interface,\n      RE_RACW_Stub_Type_Access            => System_Partition_Interface,"}]}