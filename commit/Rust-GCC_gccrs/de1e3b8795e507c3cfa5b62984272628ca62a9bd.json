{"sha": "de1e3b8795e507c3cfa5b62984272628ca62a9bd", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6ZGUxZTNiODc5NWU1MDdjM2NmYTViNjI5ODQyNzI2MjhjYTYyYTliZA==", "commit": {"author": {"name": "Jonathan Wakely", "email": "jwakely@redhat.com", "date": "2020-08-07T19:29:11Z"}, "committer": {"name": "Jonathan Wakely", "email": "jwakely@redhat.com", "date": "2020-08-07T19:29:11Z"}, "message": "libstdc++: Fix ambiguous comparisons in __gnu_debug::bitset [PR 96303]\n\nWith -pedantic the debug mode bitset has an ambiguous equality\ncomparison operator, because it tries to compare the non-debug base to\nthe debug object. The base object can be converted to another debug\nbitset, making the same operator== a candidate again.\n\nThe fix is to do the comparison on both base objects, so the operator\nfor the derived type isn't a candidate.\n\nFor the inequality operator the same change should be done, but that\noperator can be removed entirely for C++20 because it can be synthesized\nby the compiler.\n\nI don't think either equality or inequality operators are really needed,\nbecause the public _GLIBCXX_STD_C::bitset base class cam always be\ncompared using its own comparison operators. I'm not changing that here\nthough.\n\nlibstdc++-v3/ChangeLog:\n\n\tPR libstdc++/96303\n\t* include/debug/bitset (bitset::operator==): Call _M_base() on\n\tright operand.\n\t(bitset::operator!=): Likewise, but don't define it at all when\n\tdefault comparisons are supported by the compiler.\n\t* testsuite/23_containers/bitset/operations/96303.cc: New test.", "tree": {"sha": "6f23a36ecf57b28a78f87cec837069e3eabe5147", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/6f23a36ecf57b28a78f87cec837069e3eabe5147"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/de1e3b8795e507c3cfa5b62984272628ca62a9bd", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/de1e3b8795e507c3cfa5b62984272628ca62a9bd", "html_url": "https://github.com/Rust-GCC/gccrs/commit/de1e3b8795e507c3cfa5b62984272628ca62a9bd", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/de1e3b8795e507c3cfa5b62984272628ca62a9bd/comments", "author": {"login": "jwakely", "id": 1254480, "node_id": "MDQ6VXNlcjEyNTQ0ODA=", "avatar_url": "https://avatars.githubusercontent.com/u/1254480?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jwakely", "html_url": "https://github.com/jwakely", "followers_url": "https://api.github.com/users/jwakely/followers", "following_url": "https://api.github.com/users/jwakely/following{/other_user}", "gists_url": "https://api.github.com/users/jwakely/gists{/gist_id}", "starred_url": "https://api.github.com/users/jwakely/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jwakely/subscriptions", "organizations_url": "https://api.github.com/users/jwakely/orgs", "repos_url": "https://api.github.com/users/jwakely/repos", "events_url": "https://api.github.com/users/jwakely/events{/privacy}", "received_events_url": "https://api.github.com/users/jwakely/received_events", "type": "User", "site_admin": false}, "committer": {"login": "jwakely", "id": 1254480, "node_id": "MDQ6VXNlcjEyNTQ0ODA=", "avatar_url": "https://avatars.githubusercontent.com/u/1254480?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jwakely", "html_url": "https://github.com/jwakely", "followers_url": "https://api.github.com/users/jwakely/followers", "following_url": "https://api.github.com/users/jwakely/following{/other_user}", "gists_url": "https://api.github.com/users/jwakely/gists{/gist_id}", "starred_url": "https://api.github.com/users/jwakely/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jwakely/subscriptions", "organizations_url": "https://api.github.com/users/jwakely/orgs", "repos_url": "https://api.github.com/users/jwakely/repos", "events_url": "https://api.github.com/users/jwakely/events{/privacy}", "received_events_url": "https://api.github.com/users/jwakely/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "a1ee6d507b0c26466be519d177f5a08b22f63647", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/a1ee6d507b0c26466be519d177f5a08b22f63647", "html_url": "https://github.com/Rust-GCC/gccrs/commit/a1ee6d507b0c26466be519d177f5a08b22f63647"}], "stats": {"total": 37, "additions": 35, "deletions": 2}, "files": [{"sha": "1b8dc6d422ce6f504d24e7d80225edc75413054a", "filename": "libstdc++-v3/include/debug/bitset", "status": "modified", "additions": 4, "deletions": 2, "changes": 6, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/de1e3b8795e507c3cfa5b62984272628ca62a9bd/libstdc%2B%2B-v3%2Finclude%2Fdebug%2Fbitset", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/de1e3b8795e507c3cfa5b62984272628ca62a9bd/libstdc%2B%2B-v3%2Finclude%2Fdebug%2Fbitset", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libstdc%2B%2B-v3%2Finclude%2Fdebug%2Fbitset?ref=de1e3b8795e507c3cfa5b62984272628ca62a9bd", "patch": "@@ -353,11 +353,13 @@ namespace __debug\n \n       bool\n       operator==(const bitset<_Nb>& __rhs) const _GLIBCXX_NOEXCEPT\n-      { return _M_base() == __rhs; }\n+      { return _M_base() == __rhs._M_base(); }\n \n+#if __cpp_impl_three_way_comparison < 201907L\n       bool\n       operator!=(const bitset<_Nb>& __rhs) const _GLIBCXX_NOEXCEPT\n-      { return _M_base() != __rhs; }\n+      { return _M_base() != __rhs._M_base(); }\n+#endif\n \n       using _Base::test;\n       using _Base::all;"}, {"sha": "ab31e3c47d5744c3796587aaf9790f0bf8f7dd8f", "filename": "libstdc++-v3/testsuite/23_containers/bitset/operations/96303.cc", "status": "added", "additions": 31, "deletions": 0, "changes": 31, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/de1e3b8795e507c3cfa5b62984272628ca62a9bd/libstdc%2B%2B-v3%2Ftestsuite%2F23_containers%2Fbitset%2Foperations%2F96303.cc", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/de1e3b8795e507c3cfa5b62984272628ca62a9bd/libstdc%2B%2B-v3%2Ftestsuite%2F23_containers%2Fbitset%2Foperations%2F96303.cc", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libstdc%2B%2B-v3%2Ftestsuite%2F23_containers%2Fbitset%2Foperations%2F96303.cc?ref=de1e3b8795e507c3cfa5b62984272628ca62a9bd", "patch": "@@ -0,0 +1,31 @@\n+// Copyright (C) 2020 Free Software Foundation, Inc.\n+//\n+// This file is part of the GNU ISO C++ Library.  This library is free\n+// software; you can redistribute it and/or modify it under the\n+// terms of the GNU General Public License as published by the\n+// Free Software Foundation; either version 3, or (at your option)\n+// any later version.\n+\n+// This library is distributed in the hope that it will be useful,\n+// but WITHOUT ANY WARRANTY; without even the implied warranty of\n+// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n+// GNU General Public License for more details.\n+\n+// You should have received a copy of the GNU General Public License along\n+// with this library; see the file COPYING3.  If not see\n+// <http://www.gnu.org/licenses/>.\n+\n+// { dg-options \"-std=gnu++2a -pedantic\" }\n+// { dg-do compile { target c++2a } }\n+\n+#include <debug/bitset>\n+\n+bool\n+test01()\n+{\n+  __gnu_debug::bitset<1> b;\n+  // PR libstdc++/96303\n+  bool eq = b == b;\n+  bool ne = b != b;\n+  return eq && !ne;\n+}"}]}