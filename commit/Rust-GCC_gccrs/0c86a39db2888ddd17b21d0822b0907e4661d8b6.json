{"sha": "0c86a39db2888ddd17b21d0822b0907e4661d8b6", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6MGM4NmEzOWRiMjg4OGRkZDE3YjIxZDA4MjJiMDkwN2U0NjYxZDhiNg==", "commit": {"author": {"name": "Jakub Jelinek", "email": "jakub@gcc.gnu.org", "date": "2018-07-17T18:10:57Z"}, "committer": {"name": "Jakub Jelinek", "email": "jakub@gcc.gnu.org", "date": "2018-07-17T18:10:57Z"}, "message": "lex.c (_cpp_lex_direct): Use CPP_DL_NOTE instead of CPP_DL_PEDWARN...\n\n\t* lex.c (_cpp_lex_direct): Use CPP_DL_NOTE instead of CPP_DL_PEDWARN,\n\tCPP_DL_WARNING or CPP_DL_ERROR for note that diagnostics for C++ style\n\tcomments is reported only once per file and guard those calls on the\n\tpreceding cpp_error returning true.\n\n\t* gcc.dg/cpp/pr61854-c90.c (foo): Expect a note, rather than error.\n\t* gcc.dg/cpp/pr61854-c94.c (foo): Likewise.\n\t* gcc.dg/cpp/pr61854-4.c (foo): Likewise.\n\t* gcc.dg/cpp/pr61854-8.c: New test.\n\nFrom-SVN: r262832", "tree": {"sha": "f900c8a020892d4af02d171ffe5ed7c3a00eb702", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/f900c8a020892d4af02d171ffe5ed7c3a00eb702"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/0c86a39db2888ddd17b21d0822b0907e4661d8b6", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/0c86a39db2888ddd17b21d0822b0907e4661d8b6", "html_url": "https://github.com/Rust-GCC/gccrs/commit/0c86a39db2888ddd17b21d0822b0907e4661d8b6", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/0c86a39db2888ddd17b21d0822b0907e4661d8b6/comments", "author": null, "committer": null, "parents": [{"sha": "0ef03fe3d09f799b457eccf83247976e9a6da77d", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/0ef03fe3d09f799b457eccf83247976e9a6da77d", "html_url": "https://github.com/Rust-GCC/gccrs/commit/0ef03fe3d09f799b457eccf83247976e9a6da77d"}], "stats": {"total": 60, "additions": 44, "deletions": 16}, "files": [{"sha": "11936ee4610af9941587815337fddf7e06b123b7", "filename": "gcc/testsuite/ChangeLog", "status": "modified", "additions": 7, "deletions": 0, "changes": 7, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/0c86a39db2888ddd17b21d0822b0907e4661d8b6/gcc%2Ftestsuite%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/0c86a39db2888ddd17b21d0822b0907e4661d8b6/gcc%2Ftestsuite%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2FChangeLog?ref=0c86a39db2888ddd17b21d0822b0907e4661d8b6", "patch": "@@ -1,3 +1,10 @@\n+2018-07-17  Jakub Jelinek  <jakub@redhat.com>\n+\n+\t* gcc.dg/cpp/pr61854-c90.c (foo): Expect a note, rather than error.\n+\t* gcc.dg/cpp/pr61854-c94.c (foo): Likewise.\n+\t* gcc.dg/cpp/pr61854-4.c (foo): Likewise.\n+\t* gcc.dg/cpp/pr61854-8.c: New test.\n+\n 2018-07-17  David Edelsohn <dje.gcc@gmail.com>\n \n \t* gcc.target/powerpc/pr85456.c: Require longdouble128."}, {"sha": "3533ae04df9c0692257bfca829ab37e6beaf6cd4", "filename": "gcc/testsuite/gcc.dg/cpp/pr61854-4.c", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/0c86a39db2888ddd17b21d0822b0907e4661d8b6/gcc%2Ftestsuite%2Fgcc.dg%2Fcpp%2Fpr61854-4.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/0c86a39db2888ddd17b21d0822b0907e4661d8b6/gcc%2Ftestsuite%2Fgcc.dg%2Fcpp%2Fpr61854-4.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgcc.dg%2Fcpp%2Fpr61854-4.c?ref=0c86a39db2888ddd17b21d0822b0907e4661d8b6", "patch": "@@ -12,5 +12,5 @@ foo (void)\n   // But error here.\n #endif\n   /* { dg-error \"C\\\\+\\\\+ style comments are not allowed in ISO C90\" \"comments\"  { target *-*-*} 12 } */\n-  /* { dg-error \"reported only once\" \"\"  { target *-*-*} 12 } */\n+  /* { dg-message \"note: \\[^\\n\\r]*reported only once\" \"\"  { target *-*-*} 12 } */\n }"}, {"sha": "307513caf4a2cd9952e92557655458f84d4c6b5f", "filename": "gcc/testsuite/gcc.dg/cpp/pr61854-8.c", "status": "added", "additions": 12, "deletions": 0, "changes": 12, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/0c86a39db2888ddd17b21d0822b0907e4661d8b6/gcc%2Ftestsuite%2Fgcc.dg%2Fcpp%2Fpr61854-8.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/0c86a39db2888ddd17b21d0822b0907e4661d8b6/gcc%2Ftestsuite%2Fgcc.dg%2Fcpp%2Fpr61854-8.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgcc.dg%2Fcpp%2Fpr61854-8.c?ref=0c86a39db2888ddd17b21d0822b0907e4661d8b6", "patch": "@@ -0,0 +1,12 @@\n+/* PR c/61854 */\n+/* { dg-do compile } */\n+/* { dg-options \"-std=gnu89 -pedantic -w\" } */\n+\n+int\n+main (void)\n+{\n+  // Comment.\n+  /* { dg-bogus \"C\\\\+\\\\+ style comments are not allowed in ISO C90\" \"comments\"  { target *-*-*} .-1 } */\n+  /* { dg-bogus \"note: \\[^\\n\\r]*reported only once\" \"\"  { target *-*-*} .-2 } */\n+  return 0;\n+}"}, {"sha": "907e975668e08c8b7f952ae1fca8f2db2f075f70", "filename": "gcc/testsuite/gcc.dg/cpp/pr61854-c90.c", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/0c86a39db2888ddd17b21d0822b0907e4661d8b6/gcc%2Ftestsuite%2Fgcc.dg%2Fcpp%2Fpr61854-c90.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/0c86a39db2888ddd17b21d0822b0907e4661d8b6/gcc%2Ftestsuite%2Fgcc.dg%2Fcpp%2Fpr61854-c90.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgcc.dg%2Fcpp%2Fpr61854-c90.c?ref=0c86a39db2888ddd17b21d0822b0907e4661d8b6", "patch": "@@ -7,7 +7,7 @@ foo (void)\n {\n   // 1st\n   /* { dg-error \"C\\\\+\\\\+ style comments are not allowed in ISO C90\" \"comments\"  { target *-*-*} .-1 } */\n-  /* { dg-error \"reported only once\" \"\"  { target *-*-*} .-2 } */\n+  /* { dg-message \"note: \\[^\\n\\r]*reported only once\" \"\"  { target *-*-*} .-2 } */\n   // 2nd\n   // 3rd\n }"}, {"sha": "a8c301d406c2f9d8536ae34a6e90d2113c4f6a5c", "filename": "gcc/testsuite/gcc.dg/cpp/pr61854-c94.c", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/0c86a39db2888ddd17b21d0822b0907e4661d8b6/gcc%2Ftestsuite%2Fgcc.dg%2Fcpp%2Fpr61854-c94.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/0c86a39db2888ddd17b21d0822b0907e4661d8b6/gcc%2Ftestsuite%2Fgcc.dg%2Fcpp%2Fpr61854-c94.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgcc.dg%2Fcpp%2Fpr61854-c94.c?ref=0c86a39db2888ddd17b21d0822b0907e4661d8b6", "patch": "@@ -7,7 +7,7 @@ foo (void)\n {\n   // 1st\n   /* { dg-error \"C\\\\+\\\\+ style comments are not allowed in ISO C90\" \"comments\"  { target *-*-*} .-1 } */\n-  /* { dg-error \"reported only once\" \"\"  { target *-*-*} .-2 } */\n+  /* { dg-message \"note: \\[^\\n\\r]*reported only once\" \"\"  { target *-*-*} .-2 } */\n   // 2nd\n   // 3rd\n }"}, {"sha": "3fef9c957cf2cdbdc2260ee849db7938676341cb", "filename": "libcpp/ChangeLog", "status": "modified", "additions": 8, "deletions": 0, "changes": 8, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/0c86a39db2888ddd17b21d0822b0907e4661d8b6/libcpp%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/0c86a39db2888ddd17b21d0822b0907e4661d8b6/libcpp%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libcpp%2FChangeLog?ref=0c86a39db2888ddd17b21d0822b0907e4661d8b6", "patch": "@@ -1,3 +1,11 @@\n+2018-07-17  Jason Franklin  <j_fra@fastmail.us>\n+\t    Jakub Jelinek  <jakub@redhat.com>\n+\n+\t* lex.c (_cpp_lex_direct): Use CPP_DL_NOTE instead of CPP_DL_PEDWARN,\n+\tCPP_DL_WARNING or CPP_DL_ERROR for note that diagnostics for C++ style\n+\tcomments is reported only once per file and guard those calls on the\n+\tpreceding cpp_error returning true.\n+\n 2018-07-03  Nathan Sidwell  <nathan@acm.org>\n \n \tReorg line_map data structures for better packing."}, {"sha": "a2592e045d28001c31a31a5d54cc2945ab6456dd", "filename": "libcpp/lex.c", "status": "modified", "additions": 14, "deletions": 13, "changes": 27, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/0c86a39db2888ddd17b21d0822b0907e4661d8b6/libcpp%2Flex.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/0c86a39db2888ddd17b21d0822b0907e4661d8b6/libcpp%2Flex.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libcpp%2Flex.c?ref=0c86a39db2888ddd17b21d0822b0907e4661d8b6", "patch": "@@ -2872,21 +2872,21 @@ _cpp_lex_direct (cpp_reader *pfile)\n \t\t   && CPP_PEDANTIC (pfile)\n \t\t   && ! buffer->warned_cplusplus_comments)\n \t    {\n-\t      cpp_error (pfile, CPP_DL_PEDWARN,\n-\t\t\t \"C++ style comments are not allowed in ISO C90\");\n-\t      cpp_error (pfile, CPP_DL_PEDWARN,\n-\t\t\t \"(this will be reported only once per input file)\");\n+\t      if (cpp_error (pfile, CPP_DL_PEDWARN,\n+\t\t\t     \"C++ style comments are not allowed in ISO C90\"))\n+\t\tcpp_error (pfile, CPP_DL_NOTE,\n+\t\t\t   \"(this will be reported only once per input file)\");\n \t      buffer->warned_cplusplus_comments = 1;\n \t    }\n \t  /* Or if specifically desired via -Wc90-c99-compat.  */\n \t  else if (CPP_OPTION (pfile, cpp_warn_c90_c99_compat) > 0\n \t\t   && ! CPP_OPTION (pfile, cplusplus)\n \t\t   && ! buffer->warned_cplusplus_comments)\n \t    {\n-\t      cpp_error (pfile, CPP_DL_WARNING,\n-\t\t\t \"C++ style comments are incompatible with C90\");\n-\t      cpp_error (pfile, CPP_DL_WARNING,\n-\t\t\t \"(this will be reported only once per input file)\");\n+\t      if (cpp_error (pfile, CPP_DL_WARNING,\n+\t\t\t     \"C++ style comments are incompatible with C90\"))\n+\t\tcpp_error (pfile, CPP_DL_NOTE,\n+\t\t\t   \"(this will be reported only once per input file)\");\n \t      buffer->warned_cplusplus_comments = 1;\n \t    }\n \t  /* In C89/C94, C++ style comments are forbidden.  */\n@@ -2906,11 +2906,12 @@ _cpp_lex_direct (cpp_reader *pfile)\n \t\t}\n \t      else if (! buffer->warned_cplusplus_comments)\n \t\t{\n-\t\t  cpp_error (pfile, CPP_DL_ERROR,\n-\t\t\t     \"C++ style comments are not allowed in ISO C90\");\n-\t\t  cpp_error (pfile, CPP_DL_ERROR,\n-\t\t\t     \"(this will be reported only once per input \"\n-\t\t\t     \"file)\");\n+\t\t  if (cpp_error (pfile, CPP_DL_ERROR,\n+\t\t\t\t \"C++ style comments are not allowed in \"\n+\t\t\t\t \"ISO C90\"))\n+\t\t    cpp_error (pfile, CPP_DL_NOTE,\n+\t\t\t       \"(this will be reported only once per input \"\n+\t\t\t       \"file)\");\n \t\t  buffer->warned_cplusplus_comments = 1;\n \t\t}\n \t    }"}]}