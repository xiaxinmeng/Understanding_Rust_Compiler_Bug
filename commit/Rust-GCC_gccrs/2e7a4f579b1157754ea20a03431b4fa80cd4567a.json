{"sha": "2e7a4f579b1157754ea20a03431b4fa80cd4567a", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6MmU3YTRmNTc5YjExNTc3NTRlYTIwYTAzNDMxYjRmYTgwY2Q0NTY3YQ==", "commit": {"author": {"name": "Andre Vieira", "email": "andre.simoesdiasvieira@arm.com", "date": "2019-11-06T11:22:35Z"}, "committer": {"name": "Andre Vieira", "email": "avieira@gcc.gnu.org", "date": "2019-11-06T11:22:35Z"}, "message": "[vect] PR92317: fix skip_epilogue creation for epilogues\n\ngcc/ChangeLog:\n2019-11-06  Andre Vieira  <andre.simoesdiasvieira@arm.com>\n\n\tPR tree-optimization/92317\n\t* tree-vect-loop-manip.c (slpeel_update_phi_nodes_for_guard2): Also\n\tupdate phi's with constant phi arguments.\n\ngcc/testsuite/ChangeLog:\n2019-11-06  Andre Vieira  <andre.simoesdiasvieira@arm.com>\n\n\tPR tree-optimization/92317\n\t* gcc/testsuite/g++.dg/opt/pr92317.C: New test.\n\nFrom-SVN: r277877", "tree": {"sha": "aaf27c52aa95d14e8b7ddb3b27621128025f43ca", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/aaf27c52aa95d14e8b7ddb3b27621128025f43ca"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/2e7a4f579b1157754ea20a03431b4fa80cd4567a", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/2e7a4f579b1157754ea20a03431b4fa80cd4567a", "html_url": "https://github.com/Rust-GCC/gccrs/commit/2e7a4f579b1157754ea20a03431b4fa80cd4567a", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/2e7a4f579b1157754ea20a03431b4fa80cd4567a/comments", "author": {"login": "avieira-arm", "id": 68072104, "node_id": "MDQ6VXNlcjY4MDcyMTA0", "avatar_url": "https://avatars.githubusercontent.com/u/68072104?v=4", "gravatar_id": "", "url": "https://api.github.com/users/avieira-arm", "html_url": "https://github.com/avieira-arm", "followers_url": "https://api.github.com/users/avieira-arm/followers", "following_url": "https://api.github.com/users/avieira-arm/following{/other_user}", "gists_url": "https://api.github.com/users/avieira-arm/gists{/gist_id}", "starred_url": "https://api.github.com/users/avieira-arm/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/avieira-arm/subscriptions", "organizations_url": "https://api.github.com/users/avieira-arm/orgs", "repos_url": "https://api.github.com/users/avieira-arm/repos", "events_url": "https://api.github.com/users/avieira-arm/events{/privacy}", "received_events_url": "https://api.github.com/users/avieira-arm/received_events", "type": "User", "site_admin": false}, "committer": null, "parents": [{"sha": "3cf3da88be453f3fceaa596ee78be8d1e5aa21ca", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/3cf3da88be453f3fceaa596ee78be8d1e5aa21ca", "html_url": "https://github.com/Rust-GCC/gccrs/commit/3cf3da88be453f3fceaa596ee78be8d1e5aa21ca"}], "stats": {"total": 74, "additions": 69, "deletions": 5}, "files": [{"sha": "e74c57aaf13a8e657021ffa6555c649b03c37c7f", "filename": "gcc/ChangeLog", "status": "modified", "additions": 6, "deletions": 0, "changes": 6, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/2e7a4f579b1157754ea20a03431b4fa80cd4567a/gcc%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/2e7a4f579b1157754ea20a03431b4fa80cd4567a/gcc%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2FChangeLog?ref=2e7a4f579b1157754ea20a03431b4fa80cd4567a", "patch": "@@ -1,3 +1,9 @@\n+2019-11-06  Andre Vieira  <andre.simoesdiasvieira@arm.com>\n+\n+\tPR tree-optimization/92317\n+\t* tree-vect-loop-manip.c (slpeel_update_phi_nodes_for_guard2): Also\n+\tupdate phi's with constant phi arguments.\n+\n 2019-11-06  Eric Botcazou  <ebotcazou@adacore.com>\n \t    Alexandre Oliva  <oliva@adacore.com>\n "}, {"sha": "b7fb5ce3a92bf38fe85f694673e16915786f7c03", "filename": "gcc/testsuite/ChangeLog", "status": "modified", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/2e7a4f579b1157754ea20a03431b4fa80cd4567a/gcc%2Ftestsuite%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/2e7a4f579b1157754ea20a03431b4fa80cd4567a/gcc%2Ftestsuite%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2FChangeLog?ref=2e7a4f579b1157754ea20a03431b4fa80cd4567a", "patch": "@@ -1,3 +1,8 @@\n+2019-11-06  Andre Vieira  <andre.simoesdiasvieira@arm.com>\n+\n+\tPR tree-optimization/92317\n+\t* gcc/testsuite/g++.dg/opt/pr92317.C: New test.\n+\n 2019-11-06  Gerg\u00f6 Barany  <gergo@codesourcery.com>\n \t    Frederik Harwath  <frederik@codesourcery.com>\n \t    Thomas Schwinge  <thomas@codesourcery.com>"}, {"sha": "2bb9729fc961a998db9a88045ee04a81e12b07a8", "filename": "gcc/testsuite/g++.dg/opt/pr92317.C", "status": "added", "additions": 51, "deletions": 0, "changes": 51, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/2e7a4f579b1157754ea20a03431b4fa80cd4567a/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Fopt%2Fpr92317.C", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/2e7a4f579b1157754ea20a03431b4fa80cd4567a/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Fopt%2Fpr92317.C", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Fopt%2Fpr92317.C?ref=2e7a4f579b1157754ea20a03431b4fa80cd4567a", "patch": "@@ -0,0 +1,51 @@\n+// Copied from pr87967.C\n+// { dg-do compile { target c++11 } }\n+// { dg-options \"-O2 -ftree-vectorize -fno-tree-pre --param vect-epilogues-nomask=1\" }\n+\n+void h();\n+template <typename b> struct k { using d = b; };\n+template <typename b, template <typename> class> using e = k<b>;\n+template <typename b, template <typename> class f>\n+using g = typename e<b, f>::d;\n+struct l {\n+  template <typename i> using ab = typename i::j;\n+};\n+struct n : l {\n+  using j = g<char *, ab>;\n+};\n+class o {\n+public:\n+  long r();\n+};\n+char m;\n+char s() {\n+  if (m)\n+    return '0';\n+  return 'A';\n+}\n+class t {\n+public:\n+  typedef char *ad;\n+  ad m_fn2();\n+};\n+void fn3() {\n+  char *a;\n+  t b;\n+  bool p = false;\n+  while (*a) {\n+    h();\n+    o c;\n+    if (*a)\n+      a++;\n+    if (c.r()) {\n+      n::j q;\n+      for (t::ad d = b.m_fn2(), e; d != e; d++) {\n+        char f = *q;\n+        *d = f + s();\n+      }\n+      p = true;\n+    }\n+  }\n+  if (p)\n+    throw;\n+}"}, {"sha": "54f3ccf3ec373b5621e7778e6e80bab853a57687", "filename": "gcc/tree-vect-loop-manip.c", "status": "modified", "additions": 7, "deletions": 5, "changes": 12, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/2e7a4f579b1157754ea20a03431b4fa80cd4567a/gcc%2Ftree-vect-loop-manip.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/2e7a4f579b1157754ea20a03431b4fa80cd4567a/gcc%2Ftree-vect-loop-manip.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftree-vect-loop-manip.c?ref=2e7a4f579b1157754ea20a03431b4fa80cd4567a", "patch": "@@ -2291,12 +2291,14 @@ slpeel_update_phi_nodes_for_guard2 (class loop *loop, class loop *epilog,\n     {\n       gphi *update_phi = gsi.phi ();\n       tree old_arg = PHI_ARG_DEF (update_phi, 0);\n-      /* This loop-closed-phi actually doesn't represent a use out of the\n-\t loop - the phi arg is a constant.  */\n-      if (TREE_CODE (old_arg) != SSA_NAME)\n-\tcontinue;\n \n-      tree merge_arg = get_current_def (old_arg);\n+      tree merge_arg = NULL_TREE;\n+\n+      /* If the old argument is a SSA_NAME use its current_def.  */\n+      if (TREE_CODE (old_arg) == SSA_NAME)\n+\tmerge_arg = get_current_def (old_arg);\n+      /* If it's a constant or doesn't have a current_def, just use the old\n+\t argument.  */\n       if (!merge_arg)\n \tmerge_arg = old_arg;\n "}]}