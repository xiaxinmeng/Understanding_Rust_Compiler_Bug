{"sha": "930e7637828b6c6da7ff33ff3bd20c5c4c9164e7", "node_id": "C_kwDOANBUbNoAKDkzMGU3NjM3ODI4YjZjNmRhN2ZmMzNmZjNiZDIwYzVjNGM5MTY0ZTc", "commit": {"author": {"name": "Rasmus Villemoes", "email": "rasmus.villemoes@prevas.dk", "date": "2021-10-29T08:10:12Z"}, "committer": {"name": "Rasmus Villemoes", "email": "rv@rasmusvillemoes.dk", "date": "2021-11-30T08:05:03Z"}, "message": "libgcc: vxcrtstuff.c: add a few undefs\n\nWhen vxcrtstuff.c was created, the set of #includes was copied from\ncrtstuff.c. But crtstuff.c also has a bunch of #undefs after the first\n#include, because, as the comment says, including auto-host.h when\nbuilding objects that are meant for target is technically not\ncorrect.\n\nThis manifests when I try do do a canadian cross, with build=linux,\nhost=windows and target=vxworks, in that we pick up a\n\n  #define caddr_t char *\n\nfrom auto-host.h, which then of course creates a problem when we later\ninclude a target header that has\n\n  typedef char * caddr_t;\n\nI assume that the #undefs in crtstuff.c have been added for similar\nreasons.\n\nThese potentially problematic #defines all seem to be guarded by\n#ifndef USED_FOR_TARGET, which tconfig.h defines before including\nauto-host.h. So at first, it seems that one could avoid the problem\nby simply removing the initial include of auto-host.h. Unfortunately,\nwe do need some of the things defined in auto-host.h within such an\nifndef USED_FOR_TARGET, namely the define of\nHAVE_INITFINI_ARRAY_SUPPORT, which is what later causes\ninitfini-array.h to define USE_INITFINI_ARRAY. So as the next best\nfix, just copy the #undefs from crtstuff.c.\n\nlibgcc/\n\t* config/vxcrtstuff.c: Undefine caddr_t, pid_t, rlim_t,\n\tssize_t and vfork after including auto-host.h.", "tree": {"sha": "b24eb43b2e39c12ae20ccda214e83f8c82d434e5", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/b24eb43b2e39c12ae20ccda214e83f8c82d434e5"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/930e7637828b6c6da7ff33ff3bd20c5c4c9164e7", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/930e7637828b6c6da7ff33ff3bd20c5c4c9164e7", "html_url": "https://github.com/Rust-GCC/gccrs/commit/930e7637828b6c6da7ff33ff3bd20c5c4c9164e7", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/930e7637828b6c6da7ff33ff3bd20c5c4c9164e7/comments", "author": null, "committer": {"login": "Villemoes", "id": 4375908, "node_id": "MDQ6VXNlcjQzNzU5MDg=", "avatar_url": "https://avatars.githubusercontent.com/u/4375908?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Villemoes", "html_url": "https://github.com/Villemoes", "followers_url": "https://api.github.com/users/Villemoes/followers", "following_url": "https://api.github.com/users/Villemoes/following{/other_user}", "gists_url": "https://api.github.com/users/Villemoes/gists{/gist_id}", "starred_url": "https://api.github.com/users/Villemoes/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Villemoes/subscriptions", "organizations_url": "https://api.github.com/users/Villemoes/orgs", "repos_url": "https://api.github.com/users/Villemoes/repos", "events_url": "https://api.github.com/users/Villemoes/events{/privacy}", "received_events_url": "https://api.github.com/users/Villemoes/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "2acbc4eba33574a5e655c01d1be8b17fad0be535", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/2acbc4eba33574a5e655c01d1be8b17fad0be535", "html_url": "https://github.com/Rust-GCC/gccrs/commit/2acbc4eba33574a5e655c01d1be8b17fad0be535"}], "stats": {"total": 8, "additions": 8, "deletions": 0}, "files": [{"sha": "767b9de577daadeecfda9707a3c2455430d125c6", "filename": "libgcc/config/vxcrtstuff.c", "status": "modified", "additions": 8, "deletions": 0, "changes": 8, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/930e7637828b6c6da7ff33ff3bd20c5c4c9164e7/libgcc%2Fconfig%2Fvxcrtstuff.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/930e7637828b6c6da7ff33ff3bd20c5c4c9164e7/libgcc%2Fconfig%2Fvxcrtstuff.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libgcc%2Fconfig%2Fvxcrtstuff.c?ref=930e7637828b6c6da7ff33ff3bd20c5c4c9164e7", "patch": "@@ -26,7 +26,15 @@ see the files COPYING3 and COPYING.RUNTIME respectively.  If not, see\n \n #define IN_LIBGCC2\n \n+/* FIXME: Including auto-host is incorrect, but until we have\n+   identified the set of defines that need to go into auto-target.h,\n+   this will have to do.  */\n #include \"auto-host.h\"\n+#undef caddr_t\n+#undef pid_t\n+#undef rlim_t\n+#undef ssize_t\n+#undef vfork\n #include \"tconfig.h\"\n #include \"tsystem.h\"\n #include \"coretypes.h\""}]}