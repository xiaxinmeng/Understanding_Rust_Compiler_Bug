{"sha": "7a85da896a9ceac338801d6ad0997ef7834660cb", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6N2E4NWRhODk2YTljZWFjMzM4ODAxZDZhZDA5OTdlZjc4MzQ2NjBjYg==", "commit": {"author": {"name": "Andre Vehreschild", "email": "vehre@gcc.gnu.org", "date": "2016-04-04T10:32:32Z"}, "committer": {"name": "Andre Vehreschild", "email": "vehre@gcc.gnu.org", "date": "2016-04-04T10:32:32Z"}, "message": "re PR fortran/67538 (ICE with invalid source allocation)\n\ngcc/fortran/ChangeLog:\n\n2016-04-04  Andre Vehreschild  <vehre@gcc.gnu.org>\n\n\tPR fortran/67538\n\t* resolve.c (resolve_allocate_expr): Emit error message when no\n\tarray spec and no array valued source= expression is given in an\n\tF2008 allocate() for an array to allocate.\n\ngcc/testsuite/ChangeLog:\n\n2016-04-04  Andre Vehreschild  <vehre@gcc.gnu.org>\n\n\tPR fortran/67538\n\t* gfortran.dg/allocate_with_source_19.f08: New test.\n\nFrom-SVN: r234714", "tree": {"sha": "afc2fedbeca840b624e3578d2279211a44b77cb5", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/afc2fedbeca840b624e3578d2279211a44b77cb5"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/7a85da896a9ceac338801d6ad0997ef7834660cb", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/7a85da896a9ceac338801d6ad0997ef7834660cb", "html_url": "https://github.com/Rust-GCC/gccrs/commit/7a85da896a9ceac338801d6ad0997ef7834660cb", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/7a85da896a9ceac338801d6ad0997ef7834660cb/comments", "author": null, "committer": null, "parents": [{"sha": "de517e644a374f7df40bf0b43254684dab717ac0", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/de517e644a374f7df40bf0b43254684dab717ac0", "html_url": "https://github.com/Rust-GCC/gccrs/commit/de517e644a374f7df40bf0b43254684dab717ac0"}], "stats": {"total": 44, "additions": 43, "deletions": 1}, "files": [{"sha": "4ad92c0fb2dc7139ac4ab55b7e5df886c4e2d002", "filename": "gcc/fortran/ChangeLog", "status": "modified", "additions": 7, "deletions": 0, "changes": 7, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/7a85da896a9ceac338801d6ad0997ef7834660cb/gcc%2Ffortran%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/7a85da896a9ceac338801d6ad0997ef7834660cb/gcc%2Ffortran%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ffortran%2FChangeLog?ref=7a85da896a9ceac338801d6ad0997ef7834660cb", "patch": "@@ -1,3 +1,10 @@\n+2016-04-04  Andre Vehreschild  <vehre@gcc.gnu.org>\n+\n+\tPR fortran/67538\n+\t* resolve.c (resolve_allocate_expr): Emit error message when no\n+\tarray spec and no array valued source= expression is given in an\n+\tF2008 allocate() for an array to allocate.\n+\n 2016-04-04  Andre Vehreschild  <vehre@gcc.gnu.org>\n \n \tPR fortran/65795"}, {"sha": "f5cd588308a63cec2fc4e86fea984b1775d06833", "filename": "gcc/fortran/resolve.c", "status": "modified", "additions": 9, "deletions": 1, "changes": 10, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/7a85da896a9ceac338801d6ad0997ef7834660cb/gcc%2Ffortran%2Fresolve.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/7a85da896a9ceac338801d6ad0997ef7834660cb/gcc%2Ffortran%2Fresolve.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ffortran%2Fresolve.c?ref=7a85da896a9ceac338801d6ad0997ef7834660cb", "patch": "@@ -7217,7 +7217,15 @@ resolve_allocate_expr (gfc_expr *e, gfc_code *code, bool *array_alloc_wo_spec)\n \t  if (!gfc_notify_std (GFC_STD_F2008, \"Array specification required \"\n \t\t\t       \"in ALLOCATE statement at %L\", &e->where))\n \t    goto failure;\n-\t  *array_alloc_wo_spec = true;\n+\t  if (code->expr3->rank != 0)\n+\t    *array_alloc_wo_spec = true;\n+\t  else\n+\t    {\n+\t      gfc_error (\"Array specification or array-valued SOURCE= \"\n+\t\t\t \"expression required in ALLOCATE statement at %L\",\n+\t\t\t &e->where);\n+\t      goto failure;\n+\t    }\n \t}\n       else\n \t{"}, {"sha": "2de8ea55fd08be52f80f6d527b657f4110af206c", "filename": "gcc/testsuite/ChangeLog", "status": "modified", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/7a85da896a9ceac338801d6ad0997ef7834660cb/gcc%2Ftestsuite%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/7a85da896a9ceac338801d6ad0997ef7834660cb/gcc%2Ftestsuite%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2FChangeLog?ref=7a85da896a9ceac338801d6ad0997ef7834660cb", "patch": "@@ -1,3 +1,8 @@\n+2016-04-04  Andre Vehreschild  <vehre@gcc.gnu.org>\n+\n+\tPR fortran/67538\n+\t* gfortran.dg/allocate_with_source_19.f08: New test.\n+\n 2016-04-04  Andre Vehreschild  <vehre@gcc.gnu.org>\n \n \tPR fortran/65795"}, {"sha": "ff8451093a842c956e7a34d6aa5ab0173d07f62c", "filename": "gcc/testsuite/gfortran.dg/allocate_with_source_19.f08", "status": "added", "additions": 22, "deletions": 0, "changes": 22, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/7a85da896a9ceac338801d6ad0997ef7834660cb/gcc%2Ftestsuite%2Fgfortran.dg%2Fallocate_with_source_19.f08", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/7a85da896a9ceac338801d6ad0997ef7834660cb/gcc%2Ftestsuite%2Fgfortran.dg%2Fallocate_with_source_19.f08", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgfortran.dg%2Fallocate_with_source_19.f08?ref=7a85da896a9ceac338801d6ad0997ef7834660cb", "patch": "@@ -0,0 +1,22 @@\n+! { dg-do compile }\n+! { dg-options -std=f2008 }\n+\n+! Contributed by mrestelli@gmail.com\n+! Check that instead of an ICE the error message is emitted.\n+\n+module m\n+ implicit none\n+contains\n+\n+ subroutine s()\n+  real, allocatable :: x(:)\n+  real :: y\n+\n+   y = 5.0\n+   ! x either needs an array spec, or y needs to be an array.\n+   allocate( x , source=y ) ! { dg-error \"Array specification or array-valued SOURCE= expression required in ALLOCATE statement\" }\n+\n+ end subroutine s\n+\n+end module m\n+"}]}