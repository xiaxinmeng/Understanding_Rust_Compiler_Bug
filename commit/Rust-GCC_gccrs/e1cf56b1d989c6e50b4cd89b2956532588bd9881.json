{"sha": "e1cf56b1d989c6e50b4cd89b2956532588bd9881", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6ZTFjZjU2YjFkOTg5YzZlNTBiNGNkODliMjk1NjUzMjU4OGJkOTg4MQ==", "commit": {"author": {"name": "Alexandre Oliva", "email": "aoliva@redhat.com", "date": "2006-07-18T06:41:13Z"}, "committer": {"name": "Alexandre Oliva", "email": "aoliva@gcc.gnu.org", "date": "2006-07-18T06:41:13Z"}, "message": "re PR c/26993 (ICE on invalid code with weakref)\n\nPR c/26993\n* c-common.c (handle_weakref_attribute): Ignore attribute in\nthe same conditions the alias attribute is ignored.\n\nFrom-SVN: r115545", "tree": {"sha": "37cc37972a3fa0fb18d5b251d292e90f45e3399e", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/37cc37972a3fa0fb18d5b251d292e90f45e3399e"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/e1cf56b1d989c6e50b4cd89b2956532588bd9881", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/e1cf56b1d989c6e50b4cd89b2956532588bd9881", "html_url": "https://github.com/Rust-GCC/gccrs/commit/e1cf56b1d989c6e50b4cd89b2956532588bd9881", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/e1cf56b1d989c6e50b4cd89b2956532588bd9881/comments", "author": null, "committer": null, "parents": [{"sha": "e098f3a586a9aeee60f97def2bbe64ca080c13cc", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/e098f3a586a9aeee60f97def2bbe64ca080c13cc", "html_url": "https://github.com/Rust-GCC/gccrs/commit/e098f3a586a9aeee60f97def2bbe64ca080c13cc"}], "stats": {"total": 16, "additions": 16, "deletions": 0}, "files": [{"sha": "65b6b2f9bd084d59655d4e7ce64865af3cfe5d32", "filename": "gcc/ChangeLog", "status": "modified", "additions": 6, "deletions": 0, "changes": 6, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/e1cf56b1d989c6e50b4cd89b2956532588bd9881/gcc%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/e1cf56b1d989c6e50b4cd89b2956532588bd9881/gcc%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2FChangeLog?ref=e1cf56b1d989c6e50b4cd89b2956532588bd9881", "patch": "@@ -1,3 +1,9 @@\n+2006-07-18  Alexandre Oliva  <aoliva@redhat.com>\n+\n+\tPR c/26993\n+\t* c-common.c (handle_weakref_attribute): Ignore attribute in\n+\tthe same conditions the alias attribute is ignored.\n+\n 2006-07-17  Carlos O'Donell  <carlos@codesourcery.com>\n \n \t* dbxout.c (dbxout_function_end): Do not increment scope_labelno."}, {"sha": "9c260615fd710ce7ca791589b1f78c47229e30c9", "filename": "gcc/c-common.c", "status": "modified", "additions": 10, "deletions": 0, "changes": 10, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/e1cf56b1d989c6e50b4cd89b2956532588bd9881/gcc%2Fc-common.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/e1cf56b1d989c6e50b4cd89b2956532588bd9881/gcc%2Fc-common.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fc-common.c?ref=e1cf56b1d989c6e50b4cd89b2956532588bd9881", "patch": "@@ -4828,6 +4828,16 @@ handle_weakref_attribute (tree *node, tree ARG_UNUSED (name), tree args,\n {\n   tree attr = NULL_TREE;\n \n+  /* We must ignore the attribute when it is associated with\n+     local-scoped decls, since attribute alias is ignored and many\n+     such symbols do not even have a DECL_WEAK field.  */\n+  if (decl_function_context (*node) || current_function_decl)\n+    {\n+      warning (OPT_Wattributes, \"%qE attribute ignored\", name);\n+      *no_add_attrs = true;\n+      return NULL_TREE;\n+    }\n+\n   /* The idea here is that `weakref(\"name\")' mutates into `weakref,\n      alias(\"name\")', and weakref without arguments, in turn,\n      implicitly adds weak. */"}]}