{"sha": "526ed6c2419a18727a0dfafbd712c464ea02930b", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6NTI2ZWQ2YzI0MTlhMTg3MjdhMGRmYWZiZDcxMmM0NjRlYTAyOTMwYg==", "commit": {"author": {"name": "Ulrich Weigand", "email": "uweigand@de.ibm.com", "date": "2011-04-27T13:10:17Z"}, "committer": {"name": "Ulrich Weigand", "email": "uweigand@gcc.gnu.org", "date": "2011-04-27T13:10:17Z"}, "message": "divmovti4.c (union qword_UTItype): New data type.\n\n\t* config/spu/divmovti4.c (union qword_UTItype): New data type.\n\t(si_from_UTItype, si_to_UTItype): New functions.\n\t(__udivmodti4): Use them to implement type-punning.\n\t* config/spu/multi3.c (union qword_TItype): New data type.\n\t(si_from_TItype, si_to_TItype): New functions.\n\t(__multi3): Use them to implement type-punning.\n\nFrom-SVN: r173029", "tree": {"sha": "cace42c28ae039582041b10a0081a13b3e71eb16", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/cace42c28ae039582041b10a0081a13b3e71eb16"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/526ed6c2419a18727a0dfafbd712c464ea02930b", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/526ed6c2419a18727a0dfafbd712c464ea02930b", "html_url": "https://github.com/Rust-GCC/gccrs/commit/526ed6c2419a18727a0dfafbd712c464ea02930b", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/526ed6c2419a18727a0dfafbd712c464ea02930b/comments", "author": null, "committer": null, "parents": [{"sha": "c187d33c807f8f48b871ee4a736eb276f34763cd", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/c187d33c807f8f48b871ee4a736eb276f34763cd", "html_url": "https://github.com/Rust-GCC/gccrs/commit/c187d33c807f8f48b871ee4a736eb276f34763cd"}], "stats": {"total": 67, "additions": 60, "deletions": 7}, "files": [{"sha": "f2b75b07e91df90e7a098fc9889de47cf8e94643", "filename": "gcc/ChangeLog", "status": "modified", "additions": 9, "deletions": 0, "changes": 9, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/526ed6c2419a18727a0dfafbd712c464ea02930b/gcc%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/526ed6c2419a18727a0dfafbd712c464ea02930b/gcc%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2FChangeLog?ref=526ed6c2419a18727a0dfafbd712c464ea02930b", "patch": "@@ -1,3 +1,12 @@\n+2011-04-27  Ulrich Weigand  <Ulrich.Weigand@de.ibm.com>\n+\n+\t* config/spu/divmovti4.c (union qword_UTItype): New data type.\n+\t(si_from_UTItype, si_to_UTItype): New functions.\n+\t(__udivmodti4): Use them to implement type-punning.\n+\t* config/spu/multi3.c (union qword_TItype): New data type.\n+\t(si_from_TItype, si_to_TItype): New functions.\n+\t(__multi3): Use them to implement type-punning.\n+\n 2011-04-27  Ulrich Weigand  <Ulrich.Weigand@de.ibm.com>\n \n \t* config/spu/spu.c (spu_expand_epilogue): Do not emit barrier."}, {"sha": "57c975c6b3c5aab2ad730d0a46d9ea583ea36089", "filename": "gcc/config/spu/divmodti4.c", "status": "modified", "additions": 26, "deletions": 4, "changes": 30, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/526ed6c2419a18727a0dfafbd712c464ea02930b/gcc%2Fconfig%2Fspu%2Fdivmodti4.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/526ed6c2419a18727a0dfafbd712c464ea02930b/gcc%2Fconfig%2Fspu%2Fdivmodti4.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fconfig%2Fspu%2Fdivmodti4.c?ref=526ed6c2419a18727a0dfafbd712c464ea02930b", "patch": "@@ -29,6 +29,28 @@ UTItype __udivti3 (UTItype u, UTItype v);\n UTItype __umodti3 (UTItype u, UTItype v);\n UTItype __udivmodti4 (UTItype u, UTItype v, UTItype *w);\n \n+union qword_UTItype\n+  {\n+    qword q;\n+    UTItype t;\n+  };\n+  \n+inline static qword\n+si_from_UTItype (UTItype t)\n+{ \n+  union qword_UTItype u;\n+  u.t = t;\n+  return u.q;\n+}\n+\n+inline static UTItype\n+si_to_UTItype (qword q)\n+{ \n+  union qword_UTItype u;\n+  u.q = q;\n+  return u.t;\n+}\n+\n inline static unsigned int\n count_leading_zeros (UTItype x)\n {\n@@ -67,8 +89,8 @@ __udivmodti4 (UTItype num, UTItype den, UTItype * rp)\n {\n   qword shift =\n     si_from_uint (count_leading_zeros (den) - count_leading_zeros (num));\n-  qword n0 = *(qword *) & num;\n-  qword d0 = *(qword *) & den;\n+  qword n0 = si_from_UTItype (num);\n+  qword d0 = si_from_UTItype (den);\n   qword bit = si_andi (si_fsmbi (1), 1);\n   qword r0 = si_il (0);\n   qword m1 = si_fsmbi (0x000f);\n@@ -101,8 +123,8 @@ __udivmodti4 (UTItype num, UTItype den, UTItype * rp)\n     }\n   while (si_to_uint (si_orx (bit)));\n   if (rp)\n-    *rp = *(UTItype *) & n0;\n-  return *(UTItype *) & r0;\n+    *rp = si_to_UTItype (n0);\n+  return si_to_UTItype (r0);\n }\n \n UTItype"}, {"sha": "b8b0e90ee252ac4658b00433eca70eef19cc4fac", "filename": "gcc/config/spu/multi3.c", "status": "modified", "additions": 25, "deletions": 3, "changes": 28, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/526ed6c2419a18727a0dfafbd712c464ea02930b/gcc%2Fconfig%2Fspu%2Fmulti3.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/526ed6c2419a18727a0dfafbd712c464ea02930b/gcc%2Fconfig%2Fspu%2Fmulti3.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fconfig%2Fspu%2Fmulti3.c?ref=526ed6c2419a18727a0dfafbd712c464ea02930b", "patch": "@@ -23,6 +23,28 @@\n \n typedef int TItype __attribute__ ((mode (TI)));\n \n+union qword_TItype\n+  {\n+    qword q;\n+    TItype t;\n+  };\n+  \n+inline static qword\n+si_from_TItype (TItype t)\n+{ \n+  union qword_TItype u;\n+  u.t = t;\n+  return u.q;\n+}\n+\n+inline static TItype\n+si_to_TItype (qword q)\n+{ \n+  union qword_TItype u;\n+  u.q = q;\n+  return u.t;\n+}\n+\n /* A straight forward vectorization and unrolling of\n  *   short l[8], r[8];\n  *   TItype total = 0;\n@@ -33,8 +55,8 @@ typedef int TItype __attribute__ ((mode (TI)));\n TItype\n __multi3 (TItype l, TItype r)\n {\n-  qword u = *(qword *) & l;\n-  qword v = *(qword *) & r;\n+  qword u = si_from_TItype (l);\n+  qword v = si_from_TItype (r);\n   qword splat0 = si_shufb (v, v, si_ilh (0x0001));\n   qword splat1 = si_shufb (v, v, si_ilh (0x0203));\n   qword splat2 = si_shufb (v, v, si_ilh (0x0405));\n@@ -93,5 +115,5 @@ __multi3 (TItype l, TItype r)\n   total = si_cgx (total10, carry, total);\n   total = si_shlqbyi (total, 4);\n   total = si_addx (total10, carry, total);\n-  return *(TItype *) & total;\n+  return si_to_TItype (total);\n }"}]}