{"sha": "558b8548b432b0c0ba14009070940b73409fc721", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6NTU4Yjg1NDhiNDMyYjBjMGJhMTQwMDkwNzA5NDBiNzM0MDlmYzcyMQ==", "commit": {"author": {"name": "Tom Tromey", "email": "tromey@redhat.com", "date": "2005-03-11T17:35:37Z"}, "committer": {"name": "Tom Tromey", "email": "tromey@gcc.gnu.org", "date": "2005-03-11T17:35:37Z"}, "message": "Main.java (main): Handle '-p'.\n\nlibjava:\n\t* gnu/gcj/tools/gcj_dbtool/Main.java (main): Handle '-p'.\n\t(usage): Document '-p'.\n\t* Makefile.in: Rebuilt.\n\t* Makefile.am (dbexecdir): New variable.\n\t(db_name): Likewise.\n\t(dbexec_DATA): Likewise.\n\t($(db_name)): New target.\n\t(AM_CXXFLAGS): Define LIBGCJ_DEFAULT_DATABASE.\n\t* java/lang/natRuntime.cc (insertSystemProperties): Set default\n\tsystem database.\ngcc/java:\n\t* gcj.texi (Invoking gcj-dbtool): Document 'gcj-dbtool -p'.\n\t(libgcj Runtime Properties): Document the default .db.\n\nFrom-SVN: r96303", "tree": {"sha": "ebb9827ca31651ccaf01d0d7702159f6bc188a9c", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/ebb9827ca31651ccaf01d0d7702159f6bc188a9c"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/558b8548b432b0c0ba14009070940b73409fc721", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/558b8548b432b0c0ba14009070940b73409fc721", "html_url": "https://github.com/Rust-GCC/gccrs/commit/558b8548b432b0c0ba14009070940b73409fc721", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/558b8548b432b0c0ba14009070940b73409fc721/comments", "author": null, "committer": null, "parents": [{"sha": "0ac40e7a866e3b149bdeacbf5cc36d1fe364a952", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/0ac40e7a866e3b149bdeacbf5cc36d1fe364a952", "html_url": "https://github.com/Rust-GCC/gccrs/commit/0ac40e7a866e3b149bdeacbf5cc36d1fe364a952"}], "stats": {"total": 124, "additions": 106, "deletions": 18}, "files": [{"sha": "e32c9e82c95ff8ddd81a9060cd5d1462ae0d9fa5", "filename": "gcc/java/ChangeLog", "status": "modified", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/558b8548b432b0c0ba14009070940b73409fc721/gcc%2Fjava%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/558b8548b432b0c0ba14009070940b73409fc721/gcc%2Fjava%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fjava%2FChangeLog?ref=558b8548b432b0c0ba14009070940b73409fc721", "patch": "@@ -1,3 +1,8 @@\n+2005-03-11  Tom Tromey  <tromey@redhat.com>\n+\n+\t* gcj.texi (Invoking gcj-dbtool): Document 'gcj-dbtool -p'.\n+\t(libgcj Runtime Properties): Document the default .db.\n+\n 2005-03-10  Ranjit Mathew  <rmathew@hotmail.com>\n \n \tPR java/20312"}, {"sha": "ffa54a88df8f7bc6bdf568864dfe61844da47461", "filename": "gcc/java/gcj.texi", "status": "modified", "additions": 7, "deletions": 2, "changes": 9, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/558b8548b432b0c0ba14009070940b73409fc721/gcc%2Fjava%2Fgcj.texi", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/558b8548b432b0c0ba14009070940b73409fc721/gcc%2Fjava%2Fgcj.texi", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fjava%2Fgcj.texi?ref=558b8548b432b0c0ba14009070940b73409fc721", "patch": "@@ -991,7 +991,7 @@ Each time a class is initialized, print a short message on standard error.\n gcj-dbtool @option{OPTION} @var{DBFILE} [@option{MORE}] @dots{}\n \n gcj-dbtool [@option{-n}] [@option{-a}] [@option{-f}]\n-  [@option{-t}] [@option{-l}]\n+  [@option{-t}] [@option{-l}] [@option{-p}]\n   [@option{-v}] [@option{--version}] [@option{--help}]\n \n @c man end\n@@ -1043,6 +1043,10 @@ Test a database.\n @item -l @var{DBFILE}\n List the contents of a database.\n \n+@item -p\n+Print the name of the default database.  If there is no default\n+database, this prints a blank line.\n+\n @item --help\n Print a help message, then exit.\n \n@@ -2531,7 +2535,8 @@ be set to a directory that is writable by any other user.\n This is a sequence of file names, each referring to a file created by\n @command{gcj-dbtool}.  These files will be used by @code{libgcj} to\n find shared libraries corresponding to classes that are loaded from\n-bytecode.\n+bytecode.  @code{libgcj} often has a built-in default database; it\n+can be queried using @code{gcj-dbtool -p}.\n \n @end table\n "}, {"sha": "40de41588fb59db2d111dbe8bca3b6ef3fbe91df", "filename": "libjava/ChangeLog", "status": "modified", "additions": 13, "deletions": 0, "changes": 13, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/558b8548b432b0c0ba14009070940b73409fc721/libjava%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/558b8548b432b0c0ba14009070940b73409fc721/libjava%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libjava%2FChangeLog?ref=558b8548b432b0c0ba14009070940b73409fc721", "patch": "@@ -1,3 +1,16 @@\n+2005-03-11  Tom Tromey  <tromey@redhat.com>\n+\n+\t* gnu/gcj/tools/gcj_dbtool/Main.java (main): Handle '-p'.\n+\t(usage): Document '-p'.\n+\t* Makefile.in: Rebuilt.\n+\t* Makefile.am (dbexecdir): New variable.\n+\t(db_name): Likewise.\n+\t(dbexec_DATA): Likewise.\n+\t($(db_name)): New target.\n+\t(AM_CXXFLAGS): Define LIBGCJ_DEFAULT_DATABASE.\n+\t* java/lang/natRuntime.cc (insertSystemProperties): Set default\n+\tsystem database.\n+\n 2005-03-10  Bryce McKinlay  <mckinlay@redhat.com>\n \n \t* exception.cc: Remove stray MethodRef.h include."}, {"sha": "2b1314e714d0020894297b8ec5ae2c62bd4c8593", "filename": "libjava/Makefile.am", "status": "modified", "additions": 22, "deletions": 1, "changes": 23, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/558b8548b432b0c0ba14009070940b73409fc721/libjava%2FMakefile.am", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/558b8548b432b0c0ba14009070940b73409fc721/libjava%2FMakefile.am", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libjava%2FMakefile.am?ref=558b8548b432b0c0ba14009070940b73409fc721", "patch": "@@ -123,9 +123,18 @@ secdir = $(libdir)/security\n ## Where to install default logging property file.\n propdir = $(libdir)\n \n+## Where the standard .db file is found.\n+dbexecdir = $(libdir)/gcj-@gcc_version@\n+## Name of the default .db.\n+db_name = classmap.db\n+\n ## For now, only on native systems.  FIXME.\n if NATIVE\n bin_PROGRAMS = jv-convert gij grmic grmiregistry gcj-dbtool\n+\n+## It is convenient to actually build and install the default database\n+## when gcj-dbtool is available.\n+dbexec_DATA = $(db_name)\n endif\n \n bin_SCRIPTS = addr2name.awk\n@@ -171,7 +180,8 @@ AM_CXXFLAGS = \\\n \t-DPREFIX=\"\\\"$(prefix)\\\"\" \\\n \t-DLIBDIR=\"\\\"$(libdir)\\\"\" \\\n \t-DBOOT_CLASS_PATH=\"\\\"$(jardir)/$(jar_DATA)\\\"\" \\\n-\t-DJAVA_EXT_DIRS=\"\\\"$(jardir)/ext\\\"\"\n+\t-DJAVA_EXT_DIRS=\"\\\"$(jardir)/ext\\\"\" \\\n+\t-DLIBGCJ_DEFAULT_DATABASE=\"\\\"$(dbexecdir)/$(db_name)\\\"\"\n \n AM_GCJFLAGS = \\\n \t@LIBGCJ_JAVAFLAGS@ \\\n@@ -250,6 +260,17 @@ libgcj_la_DEPENDENCIES = libgcj-@gcc_version@.jar \\\n \t$(libgcj_la_LIBADD)\n libgcj_la_LINK = $(LIBLINK)\n \n+\n+## The .db file.  This rule is only used for native builds, so it is\n+## safe to invoke gcj-dbtool.\n+$(db_name): gcj-dbtool\n+## In case it exists already.\n+\t@rm -f $(db_name)\n+## We don't actually care if it fails -- if it does, just make an\n+## empty file.  This is simpler than trying to discover when mmap is\n+## not available.\n+\t./gcj-dbtool -n $(db_name) || touch $(db_name)\n+\n # Gtk/Cairo JNI sources.\n if GTK_CAIRO\n gtk_cairo_c_source_files = \\"}, {"sha": "04d4ad783d493edabe9e78c1c8bb6efdfa9a1fc9", "filename": "libjava/Makefile.in", "status": "modified", "additions": 45, "deletions": 14, "changes": 59, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/558b8548b432b0c0ba14009070940b73409fc721/libjava%2FMakefile.in", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/558b8548b432b0c0ba14009070940b73409fc721/libjava%2FMakefile.in", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libjava%2FMakefile.in?ref=558b8548b432b0c0ba14009070940b73409fc721", "patch": "@@ -93,8 +93,9 @@ am__vpath_adj = case $$p in \\\n   esac;\n am__strip_dir = `echo $$p | sed -e 's|^.*/||'`;\n am__installdirs = \"$(DESTDIR)$(toolexeclibdir)\" \"$(DESTDIR)$(bindir)\" \\\n-\t\"$(DESTDIR)$(bindir)\" \"$(DESTDIR)$(jardir)\" \\\n-\t\"$(DESTDIR)$(pkgconfigdir)\" \"$(DESTDIR)$(toolexecmainlibdir)\"\n+\t\"$(DESTDIR)$(bindir)\" \"$(DESTDIR)$(dbexecdir)\" \\\n+\t\"$(DESTDIR)$(jardir)\" \"$(DESTDIR)$(pkgconfigdir)\" \\\n+\t\"$(DESTDIR)$(toolexecmainlibdir)\"\n toolexeclibLTLIBRARIES_INSTALL = $(INSTALL)\n LTLIBRARIES = $(noinst_LTLIBRARIES) $(toolexeclib_LTLIBRARIES)\n am__dirstamp = $(am__leading_dot)dirstamp\n@@ -4817,10 +4818,12 @@ RECURSIVE_TARGETS = all-recursive check-recursive dvi-recursive \\\n \tinstall-recursive installcheck-recursive installdirs-recursive \\\n \tpdf-recursive ps-recursive uninstall-info-recursive \\\n \tuninstall-recursive\n+dbexecDATA_INSTALL = $(INSTALL_DATA)\n jarDATA_INSTALL = $(INSTALL_DATA)\n pkgconfigDATA_INSTALL = $(INSTALL_DATA)\n toolexecmainlibDATA_INSTALL = $(INSTALL_DATA)\n-DATA = $(jar_DATA) $(pkgconfig_DATA) $(toolexecmainlib_DATA)\n+DATA = $(dbexec_DATA) $(jar_DATA) $(pkgconfig_DATA) \\\n+\t$(toolexecmainlib_DATA)\n ETAGS = etags\n CTAGS = ctags\n DIST_SUBDIRS = @DIRLTDL@ gcj include external testsuite\n@@ -5109,6 +5112,9 @@ jardir = $(datadir)/java\n jar_DATA = libgcj-@gcc_version@.jar\n secdir = $(libdir)/security\n propdir = $(libdir)\n+dbexecdir = $(libdir)/gcj-@gcc_version@\n+db_name = classmap.db\n+@NATIVE_TRUE@dbexec_DATA = $(db_name)\n bin_SCRIPTS = addr2name.awk\n GCJ_WITH_FLAGS = $(GCJ) --encoding=UTF-8 -Wno-deprecated\n GCJLINK = $(LIBTOOL) --tag=GCJ --mode=link $(GCJ) -L$(here) $(JC1FLAGS) $(LDFLAGS) -o $@\n@@ -5129,7 +5135,8 @@ AM_CXXFLAGS = \\\n \t-DPREFIX=\"\\\"$(prefix)\\\"\" \\\n \t-DLIBDIR=\"\\\"$(libdir)\\\"\" \\\n \t-DBOOT_CLASS_PATH=\"\\\"$(jardir)/$(jar_DATA)\\\"\" \\\n-\t-DJAVA_EXT_DIRS=\"\\\"$(jardir)/ext\\\"\"\n+\t-DJAVA_EXT_DIRS=\"\\\"$(jardir)/ext\\\"\" \\\n+\t-DLIBGCJ_DEFAULT_DATABASE=\"\\\"$(dbexecdir)/$(db_name)\\\"\"\n \n AM_GCJFLAGS = \\\n \t@LIBGCJ_JAVAFLAGS@ \\\n@@ -25751,6 +25758,23 @@ clean-libtool:\n distclean-libtool:\n \t-rm -f libtool\n uninstall-info-am:\n+install-dbexecDATA: $(dbexec_DATA)\n+\t@$(NORMAL_INSTALL)\n+\ttest -z \"$(dbexecdir)\" || $(mkdir_p) \"$(DESTDIR)$(dbexecdir)\"\n+\t@list='$(dbexec_DATA)'; for p in $$list; do \\\n+\t  if test -f \"$$p\"; then d=; else d=\"$(srcdir)/\"; fi; \\\n+\t  f=$(am__strip_dir) \\\n+\t  echo \" $(dbexecDATA_INSTALL) '$$d$$p' '$(DESTDIR)$(dbexecdir)/$$f'\"; \\\n+\t  $(dbexecDATA_INSTALL) \"$$d$$p\" \"$(DESTDIR)$(dbexecdir)/$$f\"; \\\n+\tdone\n+\n+uninstall-dbexecDATA:\n+\t@$(NORMAL_UNINSTALL)\n+\t@list='$(dbexec_DATA)'; for p in $$list; do \\\n+\t  f=$(am__strip_dir) \\\n+\t  echo \" rm -f '$(DESTDIR)$(dbexecdir)/$$f'\"; \\\n+\t  rm -f \"$(DESTDIR)$(dbexecdir)/$$f\"; \\\n+\tdone\n install-jarDATA: $(jar_DATA)\n \t@$(NORMAL_INSTALL)\n \ttest -z \"$(jardir)\" || $(mkdir_p) \"$(DESTDIR)$(jardir)\"\n@@ -26070,7 +26094,7 @@ check: check-recursive\n all-am: Makefile $(LTLIBRARIES) $(PROGRAMS) $(SCRIPTS) $(DATA)\n installdirs: installdirs-recursive\n installdirs-am:\n-\tfor dir in \"$(DESTDIR)$(toolexeclibdir)\" \"$(DESTDIR)$(bindir)\" \"$(DESTDIR)$(bindir)\" \"$(DESTDIR)$(jardir)\" \"$(DESTDIR)$(pkgconfigdir)\" \"$(DESTDIR)$(toolexecmainlibdir)\"; do \\\n+\tfor dir in \"$(DESTDIR)$(toolexeclibdir)\" \"$(DESTDIR)$(bindir)\" \"$(DESTDIR)$(bindir)\" \"$(DESTDIR)$(dbexecdir)\" \"$(DESTDIR)$(jardir)\" \"$(DESTDIR)$(pkgconfigdir)\" \"$(DESTDIR)$(toolexecmainlibdir)\"; do \\\n \t  test -z \"$$dir\" || $(mkdir_p) \"$$dir\"; \\\n \tdone\n install: install-recursive\n@@ -26453,7 +26477,8 @@ install-data-am: install-data-local install-jarDATA \\\n \tinstall-pkgconfigDATA\n \n install-exec-am: install-binPROGRAMS install-binSCRIPTS \\\n-\tinstall-toolexeclibLTLIBRARIES install-toolexecmainlibDATA\n+\tinstall-dbexecDATA install-toolexeclibLTLIBRARIES \\\n+\tinstall-toolexecmainlibDATA\n \n install-info: install-info-recursive\n \n@@ -26482,8 +26507,9 @@ ps: ps-recursive\n ps-am:\n \n uninstall-am: uninstall-binPROGRAMS uninstall-binSCRIPTS \\\n-\tuninstall-info-am uninstall-jarDATA uninstall-pkgconfigDATA \\\n-\tuninstall-toolexeclibLTLIBRARIES uninstall-toolexecmainlibDATA\n+\tuninstall-dbexecDATA uninstall-info-am uninstall-jarDATA \\\n+\tuninstall-pkgconfigDATA uninstall-toolexeclibLTLIBRARIES \\\n+\tuninstall-toolexecmainlibDATA\n \n uninstall-info: uninstall-info-recursive\n \n@@ -26497,20 +26523,25 @@ uninstall-info: uninstall-info-recursive\n \tdistclean-recursive distclean-tags distcleancheck distdir \\\n \tdistuninstallcheck dvi dvi-am html html-am info info-am \\\n \tinstall install-am install-binPROGRAMS install-binSCRIPTS \\\n-\tinstall-data install-data-am install-data-local install-exec \\\n-\tinstall-exec-am install-info install-info-am install-jarDATA \\\n-\tinstall-man install-pkgconfigDATA install-strip \\\n+\tinstall-data install-data-am install-data-local \\\n+\tinstall-dbexecDATA install-exec install-exec-am install-info \\\n+\tinstall-info-am install-jarDATA install-man \\\n+\tinstall-pkgconfigDATA install-strip \\\n \tinstall-toolexeclibLTLIBRARIES install-toolexecmainlibDATA \\\n \tinstallcheck installcheck-am installdirs installdirs-am \\\n \tmaintainer-clean maintainer-clean-generic \\\n \tmaintainer-clean-recursive mostlyclean mostlyclean-compile \\\n \tmostlyclean-generic mostlyclean-libtool mostlyclean-local \\\n \tmostlyclean-recursive pdf pdf-am ps ps-am tags tags-recursive \\\n \tuninstall uninstall-am uninstall-binPROGRAMS \\\n-\tuninstall-binSCRIPTS uninstall-info-am uninstall-jarDATA \\\n-\tuninstall-pkgconfigDATA uninstall-toolexeclibLTLIBRARIES \\\n-\tuninstall-toolexecmainlibDATA\n+\tuninstall-binSCRIPTS uninstall-dbexecDATA uninstall-info-am \\\n+\tuninstall-jarDATA uninstall-pkgconfigDATA \\\n+\tuninstall-toolexeclibLTLIBRARIES uninstall-toolexecmainlibDATA\n+\n \n+$(db_name): gcj-dbtool\n+\t@rm -f $(db_name)\n+\t./gcj-dbtool -n $(db_name) || touch $(db_name)\n \n jniinclude/gnu_java_awt_peer_gtk_GdkGraphics.h: gnu/java/awt/peer/gtk/GdkGraphics.java\n jniinclude/gnu_java_awt_peer_gtk_GdkGraphics2D.h: gnu/java/awt/peer/gtk/GdkGraphics2D.java"}, {"sha": "84b6f6dc369b89896e09f2a47f069fd332d3e409", "filename": "libjava/gnu/gcj/tools/gcj_dbtool/Main.java", "status": "modified", "additions": 11, "deletions": 1, "changes": 12, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/558b8548b432b0c0ba14009070940b73409fc721/libjava%2Fgnu%2Fgcj%2Ftools%2Fgcj_dbtool%2FMain.java", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/558b8548b432b0c0ba14009070940b73409fc721/libjava%2Fgnu%2Fgcj%2Ftools%2Fgcj_dbtool%2FMain.java", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libjava%2Fgnu%2Fgcj%2Ftools%2Fgcj_dbtool%2FMain.java?ref=558b8548b432b0c0ba14009070940b73409fc721", "patch": "@@ -256,7 +256,16 @@ public static void main (String[] s)\n \t  }\t    \n \treturn;\n       }\n-    \n+\n+    if (s[0].equals(\"-p\"))\n+      {\n+\tinsist (s.length == 1);\n+\tString result = System.getProperty(\"gnu.gcj.precompiled.db.path\",\n+\t\t\t\t\t   \"\");\n+\tSystem.out.println (result);\n+\treturn;\n+      }\n+\n     usage(System.err);\n     System.exit(1);\t    \n   }\n@@ -284,6 +293,7 @@ private static void usage(PrintStream out)\n        + \"    gcj-dbtool -t file.gcjdb            - Test a gcj map database\\n\"\n        + \"    gcj-dbtool -l file.gcjdb            - List a gcj map database\\n\"\n        + \"    gcj-dbtool -m dest.gcjdb [source.gcjdb]...\\n\"\n+       + \"    gcj-dbtool -p                       - Print default database name\\n\"\n        + \"             - Merge gcj map databases into dest\\n\"\n        + \"               Replaces dest\\n\"\n        + \"               To add to dest, include dest in the list of sources\");"}, {"sha": "56385442da438007f94e5b0b7bced982f8ee8525", "filename": "libjava/java/lang/natRuntime.cc", "status": "modified", "additions": 3, "deletions": 0, "changes": 3, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/558b8548b432b0c0ba14009070940b73409fc721/libjava%2Fjava%2Flang%2FnatRuntime.cc", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/558b8548b432b0c0ba14009070940b73409fc721/libjava%2Fjava%2Flang%2FnatRuntime.cc", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libjava%2Fjava%2Flang%2FnatRuntime.cc?ref=558b8548b432b0c0ba14009070940b73409fc721", "patch": "@@ -531,6 +531,9 @@ java::lang::Runtime::insertSystemProperties (java::util::Properties *newprops)\n   // The path to libgcj's boot classes\n   SET (\"sun.boot.class.path\", BOOT_CLASS_PATH);\n \n+  // If there is a default system database, set it.\n+  SET (\"gnu.gcj.precompiled.db.path\", LIBGCJ_DEFAULT_DATABASE);\n+\n   // Set some properties according to whatever was compiled in with\n   // `-D'.  Important: after this point, the only properties that\n   // should be set are those which either the user cannot meaningfully"}]}