{"sha": "d35a1ef103fd000a52a2d9395be20d53bcadac1e", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6ZDM1YTFlZjEwM2ZkMDAwYTUyYTJkOTM5NWJlMjBkNTNiY2FkYWMxZQ==", "commit": {"author": {"name": "H.J. Lu", "email": "hongjiu.lu@intel.com", "date": "2008-11-25T15:33:27Z"}, "committer": {"name": "H.J. Lu", "email": "hjl@gcc.gnu.org", "date": "2008-11-25T15:33:27Z"}, "message": "re PR middle-end/37843 (unaligned stack in main due to tail call optimization)\n\ngcc/\n\n2008-11-25  H.J. Lu  <hongjiu.lu@intel.com>\n\t    Joey Ye  <joey.ye@intel.com>\n\n\tPR middle-end/37843\n\t* config/i386/i386.c (ix86_function_ok_for_sibcall): Return\n\tfalse if we need to align the outgoing stack.\n\t(ix86_update_stack_boundary): Check parm_stack_boundary.\n\ngcc/testsuite/\n\n2008-11-25  H.J. Lu  <hongjiu.lu@intel.com>\n\n\tPR middle-end/37843\n\t* gcc.target/i386/align-main-3.c: New.\n\t* gcc.target/i386/pr37843-1.c: Likewise.\n\t* gcc.target/i386/pr37843-2.c: Likewise.\n\t* gcc.target/i386/pr37843-3.c: Likewise.\n\nCo-Authored-By: Joey Ye <joey.ye@intel.com>\n\nFrom-SVN: r142193", "tree": {"sha": "943ddede9ec1114f2a6dfe5f3297c697e0afb359", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/943ddede9ec1114f2a6dfe5f3297c697e0afb359"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/d35a1ef103fd000a52a2d9395be20d53bcadac1e", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/d35a1ef103fd000a52a2d9395be20d53bcadac1e", "html_url": "https://github.com/Rust-GCC/gccrs/commit/d35a1ef103fd000a52a2d9395be20d53bcadac1e", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/d35a1ef103fd000a52a2d9395be20d53bcadac1e/comments", "author": {"login": "hjl-tools", "id": 1072356, "node_id": "MDQ6VXNlcjEwNzIzNTY=", "avatar_url": "https://avatars.githubusercontent.com/u/1072356?v=4", "gravatar_id": "", "url": "https://api.github.com/users/hjl-tools", "html_url": "https://github.com/hjl-tools", "followers_url": "https://api.github.com/users/hjl-tools/followers", "following_url": "https://api.github.com/users/hjl-tools/following{/other_user}", "gists_url": "https://api.github.com/users/hjl-tools/gists{/gist_id}", "starred_url": "https://api.github.com/users/hjl-tools/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/hjl-tools/subscriptions", "organizations_url": "https://api.github.com/users/hjl-tools/orgs", "repos_url": "https://api.github.com/users/hjl-tools/repos", "events_url": "https://api.github.com/users/hjl-tools/events{/privacy}", "received_events_url": "https://api.github.com/users/hjl-tools/received_events", "type": "User", "site_admin": false}, "committer": null, "parents": [{"sha": "5308fd74fdb4e60b11866cadb5fdaa3e42809a1c", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/5308fd74fdb4e60b11866cadb5fdaa3e42809a1c", "html_url": "https://github.com/Rust-GCC/gccrs/commit/5308fd74fdb4e60b11866cadb5fdaa3e42809a1c"}], "stats": {"total": 77, "additions": 77, "deletions": 0}, "files": [{"sha": "bf00b6838941a3784e45d18b2dac6457bc68eb3b", "filename": "gcc/ChangeLog", "status": "modified", "additions": 8, "deletions": 0, "changes": 8, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/d35a1ef103fd000a52a2d9395be20d53bcadac1e/gcc%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/d35a1ef103fd000a52a2d9395be20d53bcadac1e/gcc%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2FChangeLog?ref=d35a1ef103fd000a52a2d9395be20d53bcadac1e", "patch": "@@ -1,3 +1,11 @@\n+2008-11-25  H.J. Lu  <hongjiu.lu@intel.com>\n+\t    Joey Ye  <joey.ye@intel.com>\n+\n+\tPR middle-end/37843\n+\t* config/i386/i386.c (ix86_function_ok_for_sibcall): Return\n+\tfalse if we need to align the outgoing stack.\n+\t(ix86_update_stack_boundary): Check parm_stack_boundary.\n+\n 2008-11-25  Richard Guenther  <rguenther@suse.de>\n \n \tPR middle-end/38151"}, {"sha": "1f7d506fa49de6fdd1f24b99258ec8a0b4774999", "filename": "gcc/config/i386/i386.c", "status": "modified", "additions": 10, "deletions": 0, "changes": 10, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/d35a1ef103fd000a52a2d9395be20d53bcadac1e/gcc%2Fconfig%2Fi386%2Fi386.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/d35a1ef103fd000a52a2d9395be20d53bcadac1e/gcc%2Fconfig%2Fi386%2Fi386.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fconfig%2Fi386%2Fi386.c?ref=d35a1ef103fd000a52a2d9395be20d53bcadac1e", "patch": "@@ -4112,6 +4112,11 @@ ix86_function_ok_for_sibcall (tree decl, tree exp)\n       && ix86_function_regparm (TREE_TYPE (decl), NULL) >= 3)\n     return false;\n \n+  /* If we need to align the outgoing stack, then sibcalling would\n+     unalign the stack, which may break the called function.  */\n+  if (ix86_incoming_stack_boundary < PREFERRED_STACK_BOUNDARY)\n+    return false;\n+\n   /* Otherwise okay.  That also includes certain types of indirect calls.  */\n   return true;\n }\n@@ -7770,6 +7775,11 @@ ix86_update_stack_boundary (void)\n \t\t\t   TYPE_ATTRIBUTES (TREE_TYPE (current_function_decl))))\n     ix86_incoming_stack_boundary = MIN_STACK_BOUNDARY;\n \n+  /* The incoming stack frame has to be aligned at least at\n+     parm_stack_boundary.  */\n+  if (ix86_incoming_stack_boundary < crtl->parm_stack_boundary)\n+    ix86_incoming_stack_boundary = crtl->parm_stack_boundary;\n+\n   /* Stack at entrance of main is aligned by runtime.  We use the\n      smallest incoming stack boundary. */\n   if (ix86_incoming_stack_boundary > MAIN_STACK_BOUNDARY"}, {"sha": "1548eedc7755f31e2f37b04959b5b1240e4f2442", "filename": "gcc/testsuite/ChangeLog", "status": "modified", "additions": 8, "deletions": 0, "changes": 8, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/d35a1ef103fd000a52a2d9395be20d53bcadac1e/gcc%2Ftestsuite%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/d35a1ef103fd000a52a2d9395be20d53bcadac1e/gcc%2Ftestsuite%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2FChangeLog?ref=d35a1ef103fd000a52a2d9395be20d53bcadac1e", "patch": "@@ -1,3 +1,11 @@\n+2008-11-25  H.J. Lu  <hongjiu.lu@intel.com>\n+\n+\tPR middle-end/37843\n+\t* gcc.target/i386/align-main-3.c: New.\n+\t* gcc.target/i386/pr37843-1.c: Likewise.\n+\t* gcc.target/i386/pr37843-2.c: Likewise.\n+\t* gcc.target/i386/pr37843-3.c: Likewise.\n+\n 2008-11-25  Mikael Morin  <mikael.morin@tele2.fr>\n \n \tPR fortran/36463"}, {"sha": "d2f88d859610c15652d1549ef6645a7c044f0d45", "filename": "gcc/testsuite/gcc.target/i386/align-main-3.c", "status": "added", "additions": 14, "deletions": 0, "changes": 14, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/d35a1ef103fd000a52a2d9395be20d53bcadac1e/gcc%2Ftestsuite%2Fgcc.target%2Fi386%2Falign-main-3.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/d35a1ef103fd000a52a2d9395be20d53bcadac1e/gcc%2Ftestsuite%2Fgcc.target%2Fi386%2Falign-main-3.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgcc.target%2Fi386%2Falign-main-3.c?ref=d35a1ef103fd000a52a2d9395be20d53bcadac1e", "patch": "@@ -0,0 +1,14 @@\n+/* Test for stack alignment with sibcall optimization.  */\n+/* { dg-do compile { target { *-*-linux* && ilp32 } } } */\n+/* { dg-options \"-O2 -mpreferred-stack-boundary=4 -mincoming-stack-boundary=2\" } */\n+/* { dg-final { scan-assembler \"andl\\[\\\\t \\]*\\\\$-16,\\[\\\\t \\]*%\\[re\\]?sp\" } } */\n+/* { dg-final { scan-assembler \"call\\[\\\\t \\]*foo\" } } */\n+/* { dg-final { scan-assembler-not \"jmp\\[\\\\t \\]*foo\" } } */\n+\n+extern int foo (void);\n+\n+int\n+main ()\n+{\n+  return foo ();\n+}"}, {"sha": "12b70fdd3084af8ea458a9538c90ddcc318bf44d", "filename": "gcc/testsuite/gcc.target/i386/pr37843-1.c", "status": "added", "additions": 12, "deletions": 0, "changes": 12, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/d35a1ef103fd000a52a2d9395be20d53bcadac1e/gcc%2Ftestsuite%2Fgcc.target%2Fi386%2Fpr37843-1.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/d35a1ef103fd000a52a2d9395be20d53bcadac1e/gcc%2Ftestsuite%2Fgcc.target%2Fi386%2Fpr37843-1.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgcc.target%2Fi386%2Fpr37843-1.c?ref=d35a1ef103fd000a52a2d9395be20d53bcadac1e", "patch": "@@ -0,0 +1,12 @@\n+/* Test for stack alignment with sibcall optimization.  */\n+/* { dg-options \"-O2 -mpreferred-stack-boundary=6 -mincoming-stack-boundary=5\" } */\n+/* { dg-final { scan-assembler \"and\\[lq\\]?\\[\\\\t \\]*\\\\$-64,\\[\\\\t \\]*%\\[re\\]?sp\" } } */\n+/* { dg-final { scan-assembler \"call\\[\\\\t \\]*foo\" } } */\n+/* { dg-final { scan-assembler-not \"jmp\\[\\\\t \\]*foo\" } } */\n+\n+extern int foo (void);\n+\n+int bar (void)\n+{\n+    return foo();\n+}"}, {"sha": "6b26d0d7c47432842565f4e18e8e1ae650077e6f", "filename": "gcc/testsuite/gcc.target/i386/pr37843-2.c", "status": "added", "additions": 12, "deletions": 0, "changes": 12, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/d35a1ef103fd000a52a2d9395be20d53bcadac1e/gcc%2Ftestsuite%2Fgcc.target%2Fi386%2Fpr37843-2.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/d35a1ef103fd000a52a2d9395be20d53bcadac1e/gcc%2Ftestsuite%2Fgcc.target%2Fi386%2Fpr37843-2.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgcc.target%2Fi386%2Fpr37843-2.c?ref=d35a1ef103fd000a52a2d9395be20d53bcadac1e", "patch": "@@ -0,0 +1,12 @@\n+/* Test for stack alignment with sibcall optimization.  */\n+/* { dg-options \"-O2 -mpreferred-stack-boundary=6 -mincoming-stack-boundary=6\" } */\n+/* { dg-final { scan-assembler-not \"and\\[lq\\]?\\[\\\\t \\]*\\\\$-64,\\[\\\\t \\]*%\\[re\\]?sp\" } } */\n+/* { dg-final { scan-assembler-not \"call\\[\\\\t \\]*foo\" } } */\n+/* { dg-final { scan-assembler \"jmp\\[\\\\t \\]*foo\" } } */\n+\n+extern int foo (void);\n+\n+int bar (void)\n+{\n+    return foo();\n+}"}, {"sha": "7923b29529436491670a86c764f714153c9d78e6", "filename": "gcc/testsuite/gcc.target/i386/pr37843-3.c", "status": "added", "additions": 13, "deletions": 0, "changes": 13, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/d35a1ef103fd000a52a2d9395be20d53bcadac1e/gcc%2Ftestsuite%2Fgcc.target%2Fi386%2Fpr37843-3.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/d35a1ef103fd000a52a2d9395be20d53bcadac1e/gcc%2Ftestsuite%2Fgcc.target%2Fi386%2Fpr37843-3.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgcc.target%2Fi386%2Fpr37843-3.c?ref=d35a1ef103fd000a52a2d9395be20d53bcadac1e", "patch": "@@ -0,0 +1,13 @@\n+/* Test for stack alignment with sibcall optimization.  */\n+/* { dg-do compile { target { *-*-linux* && ilp32 } } } */\n+/* { dg-options \"-O2 -std=gnu99 -mpreferred-stack-boundary=4 -mincoming-stack-boundary=2\" } */\n+/* { dg-final { scan-assembler-not \"andl\\[\\\\t \\]*\\\\$-16,\\[\\\\t \\]*%\\[re\\]?sp\" } } */\n+/* { dg-final { scan-assembler-not \"call\\[\\\\t \\]*foo\" } } */\n+/* { dg-final { scan-assembler \"jmp\\[\\\\t \\]*foo\" } } */\n+\n+extern int foo (_Decimal128);\n+\n+int bar (_Decimal128 x)\n+{\n+    return foo(x);\n+}"}]}