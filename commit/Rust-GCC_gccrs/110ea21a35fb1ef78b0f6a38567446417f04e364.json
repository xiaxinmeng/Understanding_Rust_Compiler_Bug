{"sha": "110ea21a35fb1ef78b0f6a38567446417f04e364", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6MTEwZWEyMWEzNWZiMWVmNzhiMGY2YTM4NTY3NDQ2NDE3ZjA0ZTM2NA==", "commit": {"author": {"name": "Paul Thomas", "email": "pault@gcc.gnu.org", "date": "2009-05-10T10:21:08Z"}, "committer": {"name": "Paul Thomas", "email": "pault@gcc.gnu.org", "date": "2009-05-10T10:21:08Z"}, "message": "re PR fortran/40018 (ICE in output_constructor)\n\n2009-05-10  Paul Thomas  <pault@gcc.gnu.org>\n\n\tPR fortran/40018\n\t* trans-array.c (gfc_trans_array_constructor_value): Fold\n\tconvert numeric constants.\n\t(gfc_build_constant_array_constructor): The same.\n\n2009-05-10  Paul Thomas  <pault@gcc.gnu.org>\n\n\tPR fortran/40018\n\t* gfortran.dg/array_constructor_31.f90: New test.\n\nFrom-SVN: r147331", "tree": {"sha": "b0276501ec4fd45f4455eecb2ced44a2530c73e9", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/b0276501ec4fd45f4455eecb2ced44a2530c73e9"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/110ea21a35fb1ef78b0f6a38567446417f04e364", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/110ea21a35fb1ef78b0f6a38567446417f04e364", "html_url": "https://github.com/Rust-GCC/gccrs/commit/110ea21a35fb1ef78b0f6a38567446417f04e364", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/110ea21a35fb1ef78b0f6a38567446417f04e364/comments", "author": null, "committer": null, "parents": [{"sha": "896d7dbd746289b7cdc08505f56860bd73ec5998", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/896d7dbd746289b7cdc08505f56860bd73ec5998", "html_url": "https://github.com/Rust-GCC/gccrs/commit/896d7dbd746289b7cdc08505f56860bd73ec5998"}], "stats": {"total": 21, "additions": 18, "deletions": 3}, "files": [{"sha": "6413f116010a49d7ce76984f125a85ec102718b4", "filename": "gcc/fortran/ChangeLog", "status": "modified", "additions": 7, "deletions": 0, "changes": 7, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/110ea21a35fb1ef78b0f6a38567446417f04e364/gcc%2Ffortran%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/110ea21a35fb1ef78b0f6a38567446417f04e364/gcc%2Ffortran%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ffortran%2FChangeLog?ref=110ea21a35fb1ef78b0f6a38567446417f04e364", "patch": "@@ -1,3 +1,10 @@\n+2009-05-10  Paul Thomas  <pault@gcc.gnu.org>\n+\n+\tPR fortran/40018\n+\t* trans-array.c (gfc_trans_array_constructor_value): Fold\n+\tconvert numeric constants.\n+\t(gfc_build_constant_array_constructor): The same.\n+\n 2009-05-10  Paul Thomas  <pault@gcc.gnu.org>\n \n \tPR fortran/38863"}, {"sha": "71db46d18b22648c566009ef2beb413afb8e11b5", "filename": "gcc/fortran/trans-array.c", "status": "modified", "additions": 6, "deletions": 3, "changes": 9, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/110ea21a35fb1ef78b0f6a38567446417f04e364/gcc%2Ffortran%2Ftrans-array.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/110ea21a35fb1ef78b0f6a38567446417f04e364/gcc%2Ffortran%2Ftrans-array.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ffortran%2Ftrans-array.c?ref=110ea21a35fb1ef78b0f6a38567446417f04e364", "patch": "@@ -1263,10 +1263,11 @@ gfc_trans_array_constructor_value (stmtblock_t * pblock, tree type,\n \t\t  gfc_init_se (&se, NULL);\n \t\t  gfc_conv_constant (&se, p->expr);\n \n+\t\t  if (c->expr->ts.type != BT_CHARACTER)\n+\t\t    se.expr = fold_convert (type, se.expr);\n \t\t  /* For constant character array constructors we build\n \t\t     an array of pointers.  */\n-\t\t  if (p->expr->ts.type == BT_CHARACTER\n-\t\t      && POINTER_TYPE_P (type))\n+\t\t  else if (POINTER_TYPE_P (type))\n \t\t    se.expr = gfc_build_addr_expr\n \t\t\t\t(gfc_get_pchar_type (p->expr->ts.kind),\n \t\t\t\t se.expr);\n@@ -1620,7 +1621,9 @@ gfc_build_constant_array_constructor (gfc_expr * expr, tree type)\n     {\n       gfc_init_se (&se, NULL);\n       gfc_conv_constant (&se, c->expr);\n-      if (c->expr->ts.type == BT_CHARACTER && POINTER_TYPE_P (type))\n+      if (c->expr->ts.type != BT_CHARACTER)\n+\tse.expr = fold_convert (type, se.expr);\n+      else if (POINTER_TYPE_P (type))\n \tse.expr = gfc_build_addr_expr (gfc_get_pchar_type (c->expr->ts.kind),\n \t\t\t\t       se.expr);\n       list = tree_cons (build_int_cst (gfc_array_index_type, nelem),"}, {"sha": "017cbf4cfd070dd47db1f6dae1310913aa93909e", "filename": "gcc/testsuite/ChangeLog", "status": "modified", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/110ea21a35fb1ef78b0f6a38567446417f04e364/gcc%2Ftestsuite%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/110ea21a35fb1ef78b0f6a38567446417f04e364/gcc%2Ftestsuite%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2FChangeLog?ref=110ea21a35fb1ef78b0f6a38567446417f04e364", "patch": "@@ -1,3 +1,8 @@\n+2009-05-10  Paul Thomas  <pault@gcc.gnu.org>\n+\n+\tPR fortran/40018\n+\t* gfortran.dg/array_constructor_31.f90: New test.\n+\n 2009-05-10  Richard Guenther  <rguenther@suse.de>\n \n \tPR tree-optimization/40081"}]}