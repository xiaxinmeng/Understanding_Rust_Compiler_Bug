{"sha": "a00ce5fe3ef7372f13019de6bd2d2cf674d0417e", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6YTAwY2U1ZmUzZWY3MzcyZjEzMDE5ZGU2YmQyZDJjZjY3NGQwNDE3ZQ==", "commit": {"author": {"name": "Uros Bizjak", "email": "ubizjak@gmail.com", "date": "2008-11-22T14:16:57Z"}, "committer": {"name": "Uros Bizjak", "email": "uros@gcc.gnu.org", "date": "2008-11-22T14:16:57Z"}, "message": "re PR target/38222 (gcc.target/i386/sse4_2-popcntl.c fails on i686-apple-darwin9)\n\n\n\tPR target/38222\n\t* config/i386/i386.md (SWI248): New mode iterator.\n\t(SWI32): Remove mode iterator.\n\t(popcount<mode>2): Rename from popcounthi2, popcountsi2 and\n\tpopcounthi2 insn patterns. Macroize pattern using SWI248 mode\n\titerator.  Generate popcnt mnemonic without mode extensions\n\tfor Darwin x86 targets.\n\t(*popcount<mode>2_cmp): Ditto.\n\t(*popcountsi2_cmp_zext): Generate popcnt mnemonic without mode\n\textensions for Darwin x86 targets.\n\ntestsuite/ChangeLog:\n\n\tPR target/38222\n\t* gcc.target/i386/funcspec-3.c: Scan for popcnt on Darwin targets.\n\nFrom-SVN: r142121", "tree": {"sha": "64e5e90d94141e6b76b8dc8129b0d825daea5378", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/64e5e90d94141e6b76b8dc8129b0d825daea5378"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/a00ce5fe3ef7372f13019de6bd2d2cf674d0417e", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/a00ce5fe3ef7372f13019de6bd2d2cf674d0417e", "html_url": "https://github.com/Rust-GCC/gccrs/commit/a00ce5fe3ef7372f13019de6bd2d2cf674d0417e", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/a00ce5fe3ef7372f13019de6bd2d2cf674d0417e/comments", "author": {"login": "ubizjak", "id": 55479990, "node_id": "MDQ6VXNlcjU1NDc5OTkw", "avatar_url": "https://avatars.githubusercontent.com/u/55479990?v=4", "gravatar_id": "", "url": "https://api.github.com/users/ubizjak", "html_url": "https://github.com/ubizjak", "followers_url": "https://api.github.com/users/ubizjak/followers", "following_url": "https://api.github.com/users/ubizjak/following{/other_user}", "gists_url": "https://api.github.com/users/ubizjak/gists{/gist_id}", "starred_url": "https://api.github.com/users/ubizjak/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/ubizjak/subscriptions", "organizations_url": "https://api.github.com/users/ubizjak/orgs", "repos_url": "https://api.github.com/users/ubizjak/repos", "events_url": "https://api.github.com/users/ubizjak/events{/privacy}", "received_events_url": "https://api.github.com/users/ubizjak/received_events", "type": "User", "site_admin": false}, "committer": null, "parents": [{"sha": "f06fb22be5ab362c5cf6c0b235e0baa9917bb74d", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/f06fb22be5ab362c5cf6c0b235e0baa9917bb74d", "html_url": "https://github.com/Rust-GCC/gccrs/commit/f06fb22be5ab362c5cf6c0b235e0baa9917bb74d"}], "stats": {"total": 117, "additions": 55, "deletions": 62}, "files": [{"sha": "e58190e88e54a50e7b8faeaf3848dc33f4772961", "filename": "gcc/ChangeLog", "status": "modified", "additions": 13, "deletions": 0, "changes": 13, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/a00ce5fe3ef7372f13019de6bd2d2cf674d0417e/gcc%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/a00ce5fe3ef7372f13019de6bd2d2cf674d0417e/gcc%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2FChangeLog?ref=a00ce5fe3ef7372f13019de6bd2d2cf674d0417e", "patch": "@@ -1,3 +1,16 @@\n+2008-11-22  Uros Bizjak  <ubizjak@gmail.com>\n+\n+\tPR target/38222\n+\t* config/i386/i386.md (SWI248): New mode iterator.\n+\t(SWI32): Remove mode iterator.\n+\t(popcount<mode>2): Rename from popcounthi2, popcountsi2 and\n+\tpopcounthi2 insn patterns. Macroize pattern using SWI248 mode\n+\titerator.  Generate popcnt mnemonic without mode extensions\n+\tfor Darwin x86 targets.\n+\t(*popcount<mode>2_cmp): Ditto.\n+\t(*popcountsi2_cmp_zext): Generate popcnt mnemonic without mode\n+\textensions for Darwin x86 targets.\n+\n 2008-11-22  Eric Botcazou  <ebotcazou@adacore.com>\n \n \t* config/sparc/sparc.c (TARGET_ASM_OUTPUT_DWARF_DTPREL): Define"}, {"sha": "cca7c89427d0fc3cc1022a847c84621e6d844381", "filename": "gcc/config/i386/i386.md", "status": "modified", "additions": 34, "deletions": 60, "changes": 94, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/a00ce5fe3ef7372f13019de6bd2d2cf674d0417e/gcc%2Fconfig%2Fi386%2Fi386.md", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/a00ce5fe3ef7372f13019de6bd2d2cf674d0417e/gcc%2Fconfig%2Fi386%2Fi386.md", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fconfig%2Fi386%2Fi386.md?ref=a00ce5fe3ef7372f13019de6bd2d2cf674d0417e", "patch": "@@ -652,8 +652,8 @@\n ;; All single word integer modes.\n (define_mode_iterator SWI [QI HI SI (DI \"TARGET_64BIT\")])\n \n-;; Single word integer modes up to SImode.\n-(define_mode_iterator SWI32 [QI HI SI])\n+;; Single word integer modes without QImode.\n+(define_mode_iterator SWI248 [HI SI (DI \"TARGET_64BIT\")])\n \n ;; Instruction suffix for integer modes.\n (define_mode_attr imodesuffix [(QI \"b\") (HI \"w\") (SI \"l\") (DI \"q\")])\n@@ -15493,28 +15493,42 @@\n   [(set_attr \"prefix_0f\" \"1\")\n    (set_attr \"mode\" \"SI\")])\n \n-(define_insn \"popcountsi2\"\n-  [(set (match_operand:SI 0 \"register_operand\" \"=r\")\n-\t(popcount:SI (match_operand:SI 1 \"nonimmediate_operand\" \"rm\")))\n+(define_insn \"popcount<mode>2\"\n+  [(set (match_operand:SWI248 0 \"register_operand\" \"=r\")\n+\t(popcount:SWI248\n+\t  (match_operand:SWI248 1 \"nonimmediate_operand\" \"rm\")))\n    (clobber (reg:CC FLAGS_REG))]\n   \"TARGET_POPCNT\"\n-  \"popcnt{l}\\t{%1, %0|%0, %1}\"\n+{\n+#if TARGET_MACHO\n+  return \"popcnt\\t{%1, %0|%0, %1}\";\n+#else\n+  return \"popcnt{<imodesuffix>}\\t{%1, %0|%0, %1}\";\n+#endif\n+}\n   [(set_attr \"prefix_rep\" \"1\")\n    (set_attr \"type\" \"bitmanip\")\n-   (set_attr \"mode\" \"SI\")])\n+   (set_attr \"mode\" \"<MODE>\")])\n \n-(define_insn \"*popcountsi2_cmp\"\n+(define_insn \"*popcount<mode>2_cmp\"\n   [(set (reg FLAGS_REG)\n \t(compare\n-\t  (popcount:SI (match_operand:SI 1 \"nonimmediate_operand\" \"rm\"))\n+\t  (popcount:SWI248\n+\t    (match_operand:SWI248 1 \"nonimmediate_operand\" \"rm\"))\n \t  (const_int 0)))\n-   (set (match_operand:SI 0 \"register_operand\" \"=r\")\n-\t(popcount:SI (match_dup 1)))]\n+   (set (match_operand:SWI248 0 \"register_operand\" \"=r\")\n+\t(popcount:SWI248 (match_dup 1)))]\n   \"TARGET_POPCNT && ix86_match_ccmode (insn, CCZmode)\"\n-  \"popcnt{l}\\t{%1, %0|%0, %1}\"\n+{\n+#if TARGET_MACHO\n+  return \"popcnt\\t{%1, %0|%0, %1}\";\n+#else\n+  return \"popcnt{<imodesuffix>}\\t{%1, %0|%0, %1}\";\n+#endif\n+}\n   [(set_attr \"prefix_rep\" \"1\")\n    (set_attr \"type\" \"bitmanip\")\n-   (set_attr \"mode\" \"SI\")])\n+   (set_attr \"mode\" \"<MODE>\")])\n \n (define_insn \"*popcountsi2_cmp_zext\"\n   [(set (reg FLAGS_REG)\n@@ -15524,7 +15538,13 @@\n    (set (match_operand:DI 0 \"register_operand\" \"=r\")\n         (zero_extend:DI(popcount:SI (match_dup 1))))]\n   \"TARGET_64BIT && TARGET_POPCNT && ix86_match_ccmode (insn, CCZmode)\"\n-  \"popcnt{l}\\t{%1, %0|%0, %1}\"\n+{\n+#if TARGET_MACHO\n+  return \"popcnt\\t{%1, %0|%0, %1}\";\n+#else\n+  return \"popcnt{<imodesuffix>}\\t{%1, %0|%0, %1}\";\n+#endif\n+}\n   [(set_attr \"prefix_rep\" \"1\")\n    (set_attr \"type\" \"bitmanip\")\n    (set_attr \"mode\" \"SI\")])\n@@ -15620,29 +15640,6 @@\n   [(set_attr \"prefix_0f\" \"1\")\n    (set_attr \"mode\" \"DI\")])\n \n-(define_insn \"popcountdi2\"\n-  [(set (match_operand:DI 0 \"register_operand\" \"=r\")\n-\t(popcount:DI (match_operand:DI 1 \"nonimmediate_operand\" \"rm\")))\n-   (clobber (reg:CC FLAGS_REG))]\n-  \"TARGET_64BIT && TARGET_POPCNT\"\n-  \"popcnt{q}\\t{%1, %0|%0, %1}\"\n-  [(set_attr \"prefix_rep\" \"1\")\n-   (set_attr \"type\" \"bitmanip\")\n-   (set_attr \"mode\" \"DI\")])\n-\n-(define_insn \"*popcountdi2_cmp\"\n-  [(set (reg FLAGS_REG)\n-\t(compare\n-\t  (popcount:DI (match_operand:DI 1 \"nonimmediate_operand\" \"rm\"))\n-\t  (const_int 0)))\n-   (set (match_operand:DI 0 \"register_operand\" \"=r\")\n-\t(popcount:DI (match_dup 1)))]\n-  \"TARGET_64BIT && TARGET_POPCNT && ix86_match_ccmode (insn, CCZmode)\"\n-  \"popcnt{q}\\t{%1, %0|%0, %1}\"\n-  [(set_attr \"prefix_rep\" \"1\")\n-   (set_attr \"type\" \"bitmanip\")\n-   (set_attr \"mode\" \"DI\")])\n-\n (define_expand \"clzhi2\"\n   [(parallel\n      [(set (match_operand:HI 0 \"register_operand\" \"\")\n@@ -15681,29 +15678,6 @@\n   [(set_attr \"prefix_0f\" \"1\")\n    (set_attr \"mode\" \"HI\")])\n \n-(define_insn \"popcounthi2\"\n-  [(set (match_operand:HI 0 \"register_operand\" \"=r\")\n-\t(popcount:HI (match_operand:HI 1 \"nonimmediate_operand\" \"rm\")))\n-   (clobber (reg:CC FLAGS_REG))]\n-  \"TARGET_POPCNT\"\n-  \"popcnt{w}\\t{%1, %0|%0, %1}\"\n-  [(set_attr \"prefix_rep\" \"1\")\n-   (set_attr \"type\" \"bitmanip\")\n-   (set_attr \"mode\" \"HI\")])\n-\n-(define_insn \"*popcounthi2_cmp\"\n-  [(set (reg FLAGS_REG)\n-        (compare\n-          (popcount:HI (match_operand:HI 1 \"nonimmediate_operand\" \"rm\"))\n-          (const_int 0)))\n-   (set (match_operand:HI 0 \"register_operand\" \"=r\")\n-        (popcount:HI (match_dup 1)))]\n-  \"TARGET_POPCNT && ix86_match_ccmode (insn, CCZmode)\"\n-  \"popcnt{w}\\t{%1, %0|%0, %1}\"\n-  [(set_attr \"prefix_rep\" \"1\")\n-   (set_attr \"type\" \"bitmanip\")\n-   (set_attr \"mode\" \"HI\")])\n-\n (define_expand \"paritydi2\"\n   [(set (match_operand:DI 0 \"register_operand\" \"\")\n \t(parity:DI (match_operand:DI 1 \"register_operand\" \"\")))]"}, {"sha": "194a90c3d7b80e798f06c138834350ee7651c4e7", "filename": "gcc/testsuite/ChangeLog", "status": "modified", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/a00ce5fe3ef7372f13019de6bd2d2cf674d0417e/gcc%2Ftestsuite%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/a00ce5fe3ef7372f13019de6bd2d2cf674d0417e/gcc%2Ftestsuite%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2FChangeLog?ref=a00ce5fe3ef7372f13019de6bd2d2cf674d0417e", "patch": "@@ -1,3 +1,8 @@\n+2008-11-22  Uros Bizjak  <ubizjak@gmail.com>\n+\n+\tPR target/38222\n+\t* gcc.target/i386/funcspec-3.c: Scan for popcnt on Darwin targets.\n+\n 2008-11-22  Jakub Jelinek  <jakub@redhat.com>\n \n \tPR libfortran/37839"}, {"sha": "01c7e4ca05e37fdad4311aa8040f876f22cc7e6b", "filename": "gcc/testsuite/gcc.target/i386/funcspec-3.c", "status": "modified", "additions": 3, "deletions": 2, "changes": 5, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/a00ce5fe3ef7372f13019de6bd2d2cf674d0417e/gcc%2Ftestsuite%2Fgcc.target%2Fi386%2Ffuncspec-3.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/a00ce5fe3ef7372f13019de6bd2d2cf674d0417e/gcc%2Ftestsuite%2Fgcc.target%2Fi386%2Ffuncspec-3.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgcc.target%2Fi386%2Ffuncspec-3.c?ref=a00ce5fe3ef7372f13019de6bd2d2cf674d0417e", "patch": "@@ -59,8 +59,9 @@ int main ()\n   exit (0);\n }\n \n-/* { dg-final { scan-assembler \"popcntl\" } } */\n-/* { dg-final { scan-assembler \"popcntq\" } } */\n+/* { dg-final { scan-assembler \"popcntl\" { target { ! *-*-darwin* } } } } */\n+/* { dg-final { scan-assembler \"popcntq\" { target { ! *-*-darwin* } } } } */\n+/* { dg-final { scan-assembler-times \"popcnt\" 2 { target *-*-darwin* } } } */\n /* { dg-final { scan-assembler \"call\\t(.*)sse4a_pop_i\" } } */\n /* { dg-final { scan-assembler \"call\\t(.*)sse42_pop_l\" } } */\n /* { dg-final { scan-assembler \"call\\t(.*)popcountdi2\" } } */"}]}