{"sha": "72eb8e780fe462a0f5e4f5f2c77cf2a1ff0454d4", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6NzJlYjhlNzgwZmU0NjJhMGY1ZTRmNWYyYzc3Y2YyYTFmZjA0NTRkNA==", "commit": {"author": {"name": "Steven G. Kargl", "email": "kargl@gcc.gnu.org", "date": "2018-12-09T23:49:14Z"}, "committer": {"name": "Steven G. Kargl", "email": "kargl@gcc.gnu.org", "date": "2018-12-09T23:49:14Z"}, "message": "re PR fortran/88205 (ICE in gfc_wide_strncasecmp, at fortran/scanner.c:249)\n\n2018-12-09  Steven G. Kargl  <kargl@gcc.gnu.org>\n\n\tPR fortran/88205\n\t* io.c (gfc_match_open): Move NEWUNIT checks to after STATUS checks.\n\n2018-12-09  Steven G. Kargl  <kargl@gcc.gnu.org>\n\n\tPR fortran/88205\n\t* gfortran.dg/pr88205.f90: New unit.\n\nFrom-SVN: r266936", "tree": {"sha": "cb5f8205498d179ee6a5784f4ee00cfa8758cb08", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/cb5f8205498d179ee6a5784f4ee00cfa8758cb08"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/72eb8e780fe462a0f5e4f5f2c77cf2a1ff0454d4", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/72eb8e780fe462a0f5e4f5f2c77cf2a1ff0454d4", "html_url": "https://github.com/Rust-GCC/gccrs/commit/72eb8e780fe462a0f5e4f5f2c77cf2a1ff0454d4", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/72eb8e780fe462a0f5e4f5f2c77cf2a1ff0454d4/comments", "author": null, "committer": null, "parents": [{"sha": "899b398116b48b9bcc8ab00f56a01569ddd2f554", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/899b398116b48b9bcc8ab00f56a01569ddd2f554", "html_url": "https://github.com/Rust-GCC/gccrs/commit/899b398116b48b9bcc8ab00f56a01569ddd2f554"}], "stats": {"total": 78, "additions": 51, "deletions": 27}, "files": [{"sha": "031a988e8c797034ccda266adf84b9b5cb322075", "filename": "gcc/fortran/ChangeLog", "status": "modified", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/72eb8e780fe462a0f5e4f5f2c77cf2a1ff0454d4/gcc%2Ffortran%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/72eb8e780fe462a0f5e4f5f2c77cf2a1ff0454d4/gcc%2Ffortran%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ffortran%2FChangeLog?ref=72eb8e780fe462a0f5e4f5f2c77cf2a1ff0454d4", "patch": "@@ -1,3 +1,8 @@\n+2018-12-09  Steven G. Kargl  <kargl@gcc.gnu.org>\n+\n+\tPR fortran/88205\n+\t* io.c (gfc_match_open): Move NEWUNIT checks to after STATUS checks.\n+\n 2018-12-09  Steven G. Kargl  <kargl@gcc.gnu.org>\n \n \tPR fortran/88206"}, {"sha": "8008f92f38c2d2d06b9271c8db9b1dd6997e4e27", "filename": "gcc/fortran/io.c", "status": "modified", "additions": 27, "deletions": 27, "changes": 54, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/72eb8e780fe462a0f5e4f5f2c77cf2a1ff0454d4/gcc%2Ffortran%2Fio.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/72eb8e780fe462a0f5e4f5f2c77cf2a1ff0454d4/gcc%2Ffortran%2Fio.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ffortran%2Fio.c?ref=72eb8e780fe462a0f5e4f5f2c77cf2a1ff0454d4", "patch": "@@ -2150,33 +2150,6 @@ gfc_match_open (void)\n \n   warn = (open->err || open->iostat) ? true : false;\n \n-  /* Checks on NEWUNIT specifier.  */\n-  if (open->newunit)\n-    {\n-      if (open->unit)\n-\t{\n-\t  gfc_error (\"UNIT specifier not allowed with NEWUNIT at %C\");\n-\t  goto cleanup;\n-\t}\n-\n-      if (!open->file && open->status)\n-        {\n-\t  if (open->status->expr_type == EXPR_CONSTANT\n-\t     && gfc_wide_strncasecmp (open->status->value.character.string,\n-\t\t\t\t       \"scratch\", 7) != 0)\n-\t   {\n-\t     gfc_error (\"NEWUNIT specifier must have FILE= \"\n-\t\t\t\"or STATUS='scratch' at %C\");\n-\t     goto cleanup;\n-\t   }\n-\t}\n-    }\n-  else if (!open->unit)\n-    {\n-      gfc_error (\"OPEN statement at %C must have UNIT or NEWUNIT specified\");\n-      goto cleanup;\n-    }\n-\n   /* Checks on the ACCESS specifier.  */\n   if (open->access && open->access->expr_type == EXPR_CONSTANT)\n     {\n@@ -2501,6 +2474,33 @@ gfc_match_open (void)\n \t}\n     }\n \n+  /* Checks on NEWUNIT specifier.  */\n+  if (open->newunit)\n+    {\n+      if (open->unit)\n+\t{\n+\t  gfc_error (\"UNIT specifier not allowed with NEWUNIT at %C\");\n+\t  goto cleanup;\n+\t}\n+\n+      if (!open->file && open->status)\n+        {\n+\t  if (open->status->expr_type == EXPR_CONSTANT\n+\t     && gfc_wide_strncasecmp (open->status->value.character.string,\n+\t\t\t\t       \"scratch\", 7) != 0)\n+\t   {\n+\t     gfc_error (\"NEWUNIT specifier must have FILE= \"\n+\t\t\t\"or STATUS='scratch' at %C\");\n+\t     goto cleanup;\n+\t   }\n+\t}\n+    }\n+  else if (!open->unit)\n+    {\n+      gfc_error (\"OPEN statement at %C must have UNIT or NEWUNIT specified\");\n+      goto cleanup;\n+    }\n+\n   /* Things that are not allowed for unformatted I/O.  */\n   if (open->form && open->form->expr_type == EXPR_CONSTANT\n       && (open->delim || open->decimal || open->encoding || open->round"}, {"sha": "7b90d56c769ae843864f526abef1b8dd53d2c69f", "filename": "gcc/testsuite/ChangeLog", "status": "modified", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/72eb8e780fe462a0f5e4f5f2c77cf2a1ff0454d4/gcc%2Ftestsuite%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/72eb8e780fe462a0f5e4f5f2c77cf2a1ff0454d4/gcc%2Ftestsuite%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2FChangeLog?ref=72eb8e780fe462a0f5e4f5f2c77cf2a1ff0454d4", "patch": "@@ -1,3 +1,8 @@\n+2018-12-09  Steven G. Kargl  <kargl@gcc.gnu.org>\n+\n+\tPR fortran/88205\n+\t* gfortran.dg/pr88205.f90: New unit.\n+\n 2018-12-09  Iain Buclaw  <ibuclaw@gdcproject.org>\n \n \tPR d/88039"}, {"sha": "d9e08069109cfdad156fc491cc570d0605085703", "filename": "gcc/testsuite/gfortran.dg/pr88205.f90", "status": "added", "additions": 14, "deletions": 0, "changes": 14, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/72eb8e780fe462a0f5e4f5f2c77cf2a1ff0454d4/gcc%2Ftestsuite%2Fgfortran.dg%2Fpr88205.f90", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/72eb8e780fe462a0f5e4f5f2c77cf2a1ff0454d4/gcc%2Ftestsuite%2Fgfortran.dg%2Fpr88205.f90", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgfortran.dg%2Fpr88205.f90?ref=72eb8e780fe462a0f5e4f5f2c77cf2a1ff0454d4", "patch": "@@ -0,0 +1,14 @@\n+! { dg-do compile }\n+! PR fortran/88205\n+subroutine s1\n+   real, parameter :: status = 0\n+   open (newunit=n, status=status)        ! { dg-error \"STATUS requires\" }\n+end\n+subroutine s2\n+   complex, parameter :: status = 0\n+   open (newunit=n, status=status)        ! { dg-error \"STATUS requires\" }\n+end\n+program p\n+  logical, parameter :: status = .false.\n+  open (newunit=a, status=status)         ! { dg-error \"STATUS requires\" }\n+end"}]}