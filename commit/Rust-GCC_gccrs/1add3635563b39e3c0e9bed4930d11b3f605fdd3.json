{"sha": "1add3635563b39e3c0e9bed4930d11b3f605fdd3", "node_id": "C_kwDOANBUbNoAKDFhZGQzNjM1NTYzYjM5ZTNjMGU5YmVkNDkzMGQxMWIzZjYwNWZkZDM", "commit": {"author": {"name": "Richard Biener", "email": "rguenther@suse.de", "date": "2022-10-28T12:20:36Z"}, "committer": {"name": "Richard Biener", "email": "rguenther@suse.de", "date": "2022-10-28T13:07:02Z"}, "message": "tree-optimization/107447 - avoid hoisting returns-twice calls in LIM\n\nThe following makes sure to not hoist returns-twice calls in LIM\nsince we have no way to move the abnormal edge associated with it\nand we are prone having stray abnormal edges in the IL which will\nthen cause IL verification failures even when the actual call\ndoes not return twice.\n\n\tPR tree-optimization/107447\n\t* tree-ssa-loop-im.cc (determine_max_movement): Do not\n\thoist returns-twice calls.\n\n\t* gcc.dg/torture/pr107447.c: New testcase.", "tree": {"sha": "172b91256d2daa827f12492d66f763b8292a9021", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/172b91256d2daa827f12492d66f763b8292a9021"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/1add3635563b39e3c0e9bed4930d11b3f605fdd3", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/1add3635563b39e3c0e9bed4930d11b3f605fdd3", "html_url": "https://github.com/Rust-GCC/gccrs/commit/1add3635563b39e3c0e9bed4930d11b3f605fdd3", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/1add3635563b39e3c0e9bed4930d11b3f605fdd3/comments", "author": {"login": "rguenth", "id": 2046526, "node_id": "MDQ6VXNlcjIwNDY1MjY=", "avatar_url": "https://avatars.githubusercontent.com/u/2046526?v=4", "gravatar_id": "", "url": "https://api.github.com/users/rguenth", "html_url": "https://github.com/rguenth", "followers_url": "https://api.github.com/users/rguenth/followers", "following_url": "https://api.github.com/users/rguenth/following{/other_user}", "gists_url": "https://api.github.com/users/rguenth/gists{/gist_id}", "starred_url": "https://api.github.com/users/rguenth/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/rguenth/subscriptions", "organizations_url": "https://api.github.com/users/rguenth/orgs", "repos_url": "https://api.github.com/users/rguenth/repos", "events_url": "https://api.github.com/users/rguenth/events{/privacy}", "received_events_url": "https://api.github.com/users/rguenth/received_events", "type": "User", "site_admin": false}, "committer": {"login": "rguenth", "id": 2046526, "node_id": "MDQ6VXNlcjIwNDY1MjY=", "avatar_url": "https://avatars.githubusercontent.com/u/2046526?v=4", "gravatar_id": "", "url": "https://api.github.com/users/rguenth", "html_url": "https://github.com/rguenth", "followers_url": "https://api.github.com/users/rguenth/followers", "following_url": "https://api.github.com/users/rguenth/following{/other_user}", "gists_url": "https://api.github.com/users/rguenth/gists{/gist_id}", "starred_url": "https://api.github.com/users/rguenth/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/rguenth/subscriptions", "organizations_url": "https://api.github.com/users/rguenth/orgs", "repos_url": "https://api.github.com/users/rguenth/repos", "events_url": "https://api.github.com/users/rguenth/events{/privacy}", "received_events_url": "https://api.github.com/users/rguenth/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "084128583212bd64308f50c2ab5f4c03be40e48c", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/084128583212bd64308f50c2ab5f4c03be40e48c", "html_url": "https://github.com/Rust-GCC/gccrs/commit/084128583212bd64308f50c2ab5f4c03be40e48c"}], "stats": {"total": 36, "additions": 32, "deletions": 4}, "files": [{"sha": "06f7b7b15ae7b138ea126be8ef10701f03814948", "filename": "gcc/testsuite/gcc.dg/torture/pr107447.c", "status": "added", "additions": 23, "deletions": 0, "changes": 23, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/1add3635563b39e3c0e9bed4930d11b3f605fdd3/gcc%2Ftestsuite%2Fgcc.dg%2Ftorture%2Fpr107447.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/1add3635563b39e3c0e9bed4930d11b3f605fdd3/gcc%2Ftestsuite%2Fgcc.dg%2Ftorture%2Fpr107447.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgcc.dg%2Ftorture%2Fpr107447.c?ref=1add3635563b39e3c0e9bed4930d11b3f605fdd3", "patch": "@@ -0,0 +1,23 @@\n+/* { dg-do compile } */\n+\n+int n;\n+\n+void\n+bar (int, int);\n+\n+__attribute__ ((noinline, returns_twice)) int\n+zero (void)\n+{\n+  return 0;\n+}\n+\n+void\n+foo (void)\n+{\n+  (void) zero ();\n+\n+  n = 0;\n+\n+  for (;;)\n+    bar (zero (), n);\n+}"}, {"sha": "2119d4072d3a9dd36ff5b92b8e7d563b9c8c1c5d", "filename": "gcc/tree-ssa-loop-im.cc", "status": "modified", "additions": 9, "deletions": 4, "changes": 13, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/1add3635563b39e3c0e9bed4930d11b3f605fdd3/gcc%2Ftree-ssa-loop-im.cc", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/1add3635563b39e3c0e9bed4930d11b3f605fdd3/gcc%2Ftree-ssa-loop-im.cc", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftree-ssa-loop-im.cc?ref=1add3635563b39e3c0e9bed4930d11b3f605fdd3", "patch": "@@ -835,10 +835,15 @@ determine_max_movement (gimple *stmt, bool must_preserve_exec)\n \n       return true;\n     }\n-  else\n-    FOR_EACH_SSA_TREE_OPERAND (val, stmt, iter, SSA_OP_USE)\n-      if (!add_dependency (val, lim_data, loop, true))\n-\treturn false;\n+\n+  /* A stmt that receives abnormal edges cannot be hoisted.  */\n+  if (is_a <gcall *> (stmt)\n+      && (gimple_call_flags (stmt) & ECF_RETURNS_TWICE))\n+    return false;\n+\n+  FOR_EACH_SSA_TREE_OPERAND (val, stmt, iter, SSA_OP_USE)\n+    if (!add_dependency (val, lim_data, loop, true))\n+      return false;\n \n   if (gimple_vuse (stmt))\n     {"}]}