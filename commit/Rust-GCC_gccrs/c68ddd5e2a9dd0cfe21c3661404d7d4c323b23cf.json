{"sha": "c68ddd5e2a9dd0cfe21c3661404d7d4c323b23cf", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6YzY4ZGRkNWUyYTlkZDBjZmUyMWMzNjYxNDA0ZDdkNGMzMjNiMjNjZg==", "commit": {"author": {"name": "Thomas Schwinge", "email": "thomas@codesourcery.com", "date": "2019-10-31T16:40:13Z"}, "committer": {"name": "Thomas Schwinge", "email": "thomas@codesourcery.com", "date": "2021-06-08T09:51:45Z"}, "message": "Enable more 'libgomp.oacc-*/lib-*' testcases for non-'openacc_nvidia_accel_selected'\n\n\tlibgomp/\n\t* testsuite/libgomp.oacc-c-c++-common/lib-11.c: Enable for all but\n\t'-DACC_MEM_SHARED=0'.\n\t* testsuite/libgomp.oacc-c-c++-common/lib-13.c: Likewise.\n\t* testsuite/libgomp.oacc-c-c++-common/lib-14.c: Likewise.\n\t* testsuite/libgomp.oacc-c-c++-common/lib-15.c: Likewise.\n\t* testsuite/libgomp.oacc-c-c++-common/lib-20.c: Likewise.\n\t* testsuite/libgomp.oacc-c-c++-common/lib-23.c: Likewise.\n\t* testsuite/libgomp.oacc-c-c++-common/lib-24.c: Likewise.\n\t* testsuite/libgomp.oacc-c-c++-common/lib-34.c: Likewise.\n\t* testsuite/libgomp.oacc-c-c++-common/lib-42.c: Likewise.\n\t* testsuite/libgomp.oacc-c-c++-common/lib-44.c: Likewise.\n\t* testsuite/libgomp.oacc-c-c++-common/lib-48.c: Likewise.\n\t* testsuite/libgomp.oacc-c-c++-common/lib-88.c: Likewise.\n\t* testsuite/libgomp.oacc-c-c++-common/lib-89.c: Likewise.\n\t* testsuite/libgomp.oacc-c-c++-common/lib-92.c: Likewise.\n\t* testsuite/libgomp.oacc-fortran/lib-14.f90: Likewise.\n\t* testsuite/libgomp.oacc-c-c++-common/lib-5.c: Add\n\t'acc_device_radeon' testing.\n\t* testsuite/libgomp.oacc-c-c++-common/lib-6.c: Likewise.\n\t* testsuite/libgomp.oacc-fortran/lib-5.f90: Likewise.\n\t* testsuite/libgomp.oacc-fortran/lib-7.f90: Likewise.\n\t* testsuite/libgomp.oacc-c-c++-common/lib-52.c: Enable for all.\n\t* testsuite/libgomp.oacc-c-c++-common/lib-53.c: Likewise.\n\t* testsuite/libgomp.oacc-c-c++-common/lib-54.c: Likewise.\n\t* testsuite/libgomp.oacc-c-c++-common/lib-86.c: Likewise.\n\t* testsuite/libgomp.oacc-c-c++-common/lib-87.c: Likewise.\n\t* testsuite/libgomp.oacc-fortran/lib-10.f90: Likewise.\n\t* testsuite/libgomp.oacc-fortran/lib-8.f90: Likewise.\n\t* testsuite/libgomp.oacc-c-c++-common/lib-57.c: Improve checking\n\tfor non-'openacc_nvidia_accel_selected'.\n\t* testsuite/libgomp.oacc-c-c++-common/lib-58.c: Likewise.\n\t* testsuite/libgomp.oacc-c-c++-common/lib-62.c: Clarify that \"Not\n\tall implement this checking\".\n\t* testsuite/libgomp.oacc-c-c++-common/lib-63.c: Likewise.\n\t* testsuite/libgomp.oacc-c-c++-common/lib-64.c: Likewise.\n\t* testsuite/libgomp.oacc-c-c++-common/lib-65.c: Likewise.\n\t* testsuite/libgomp.oacc-c-c++-common/lib-67.c: Likewise.\n\t* testsuite/libgomp.oacc-c-c++-common/lib-68.c: Likewise.", "tree": {"sha": "ea48230103859376ae487f4090b1c5346cc5abff", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/ea48230103859376ae487f4090b1c5346cc5abff"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/c68ddd5e2a9dd0cfe21c3661404d7d4c323b23cf", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/c68ddd5e2a9dd0cfe21c3661404d7d4c323b23cf", "html_url": "https://github.com/Rust-GCC/gccrs/commit/c68ddd5e2a9dd0cfe21c3661404d7d4c323b23cf", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/c68ddd5e2a9dd0cfe21c3661404d7d4c323b23cf/comments", "author": {"login": "tschwinge", "id": 21753, "node_id": "MDQ6VXNlcjIxNzUz", "avatar_url": "https://avatars.githubusercontent.com/u/21753?v=4", "gravatar_id": "", "url": "https://api.github.com/users/tschwinge", "html_url": "https://github.com/tschwinge", "followers_url": "https://api.github.com/users/tschwinge/followers", "following_url": "https://api.github.com/users/tschwinge/following{/other_user}", "gists_url": "https://api.github.com/users/tschwinge/gists{/gist_id}", "starred_url": "https://api.github.com/users/tschwinge/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/tschwinge/subscriptions", "organizations_url": "https://api.github.com/users/tschwinge/orgs", "repos_url": "https://api.github.com/users/tschwinge/repos", "events_url": "https://api.github.com/users/tschwinge/events{/privacy}", "received_events_url": "https://api.github.com/users/tschwinge/received_events", "type": "User", "site_admin": false}, "committer": {"login": "tschwinge", "id": 21753, "node_id": "MDQ6VXNlcjIxNzUz", "avatar_url": "https://avatars.githubusercontent.com/u/21753?v=4", "gravatar_id": "", "url": "https://api.github.com/users/tschwinge", "html_url": "https://github.com/tschwinge", "followers_url": "https://api.github.com/users/tschwinge/followers", "following_url": "https://api.github.com/users/tschwinge/following{/other_user}", "gists_url": "https://api.github.com/users/tschwinge/gists{/gist_id}", "starred_url": "https://api.github.com/users/tschwinge/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/tschwinge/subscriptions", "organizations_url": "https://api.github.com/users/tschwinge/orgs", "repos_url": "https://api.github.com/users/tschwinge/repos", "events_url": "https://api.github.com/users/tschwinge/events{/privacy}", "received_events_url": "https://api.github.com/users/tschwinge/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "32099c0d24adb93a031e0301ffd77b065b6f5472", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/32099c0d24adb93a031e0301ffd77b065b6f5472", "html_url": "https://github.com/Rust-GCC/gccrs/commit/32099c0d24adb93a031e0301ffd77b065b6f5472"}], "stats": {"total": 355, "additions": 225, "deletions": 130}, "files": [{"sha": "1f05161436c02c46d480d15e16250b0802b7e024", "filename": "libgomp/testsuite/libgomp.oacc-c-c++-common/lib-11.c", "status": "modified", "additions": 6, "deletions": 4, "changes": 10, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/c68ddd5e2a9dd0cfe21c3661404d7d4c323b23cf/libgomp%2Ftestsuite%2Flibgomp.oacc-c-c%2B%2B-common%2Flib-11.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/c68ddd5e2a9dd0cfe21c3661404d7d4c323b23cf/libgomp%2Ftestsuite%2Flibgomp.oacc-c-c%2B%2B-common%2Flib-11.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libgomp%2Ftestsuite%2Flibgomp.oacc-c-c%2B%2B-common%2Flib-11.c?ref=c68ddd5e2a9dd0cfe21c3661404d7d4c323b23cf", "patch": "@@ -1,5 +1,4 @@\n-/* Only nvptx plugin does the required error checking.\n-   { dg-do run { target openacc_nvidia_accel_selected } } */\n+/* { dg-skip-if \"\" { *-*-* } { \"*\" } { \"-DACC_MEM_SHARED=0\" } } */\n \n #include <stdio.h>\n #include <stdlib.h>\n@@ -22,6 +21,9 @@ main (int argc, char **argv)\n   return 0;\n }\n \n-/* { dg-output \"CheCKpOInT(\\n|\\r\\n|\\r).*\" } */\n-/* { dg-output \"invalid device address\" } */\n+/* { dg-output \"CheCKpOInT(\\n|\\r\\n|\\r)+\" } */\n+/* { dg-output \"libgomp: invalid device address(\\n|\\r\\n|\\r)+\" { target openacc_nvidia_accel_selected } } */\n+/* { dg-output \"libgomp: GCN fatal error: Could not free device memory(\\n|\\r\\n|\\r)+\" { target openacc_radeon_accel_selected } }\n+   { dg-output \"Runtime message: HSA_STATUS_ERROR_INVALID_ALLOCATION: The requested allocation is not valid\\.(\\n|\\r\\n|\\r)+\" { target openacc_radeon_accel_selected } } */\n+/* { dg-output \"libgomp: error in freeing device memory in acc_free(\\n|\\r\\n|\\r)+$\" } */\n /* { dg-shouldfail \"\" } */"}, {"sha": "90b137fb20ba3f890e904cf1d661a72aa1f9b9e0", "filename": "libgomp/testsuite/libgomp.oacc-c-c++-common/lib-13.c", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/c68ddd5e2a9dd0cfe21c3661404d7d4c323b23cf/libgomp%2Ftestsuite%2Flibgomp.oacc-c-c%2B%2B-common%2Flib-13.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/c68ddd5e2a9dd0cfe21c3661404d7d4c323b23cf/libgomp%2Ftestsuite%2Flibgomp.oacc-c-c%2B%2B-common%2Flib-13.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libgomp%2Ftestsuite%2Flibgomp.oacc-c-c%2B%2B-common%2Flib-13.c?ref=c68ddd5e2a9dd0cfe21c3661404d7d4c323b23cf", "patch": "@@ -1,6 +1,6 @@\n /* Check acc_is_present and acc_delete.  */\n \n-/* { dg-do run { target openacc_nvidia_accel_selected } } */\n+/* { dg-skip-if \"\" { *-*-* } { \"*\" } { \"-DACC_MEM_SHARED=0\" } } */\n \n #include <stdlib.h>\n #include <openacc.h>"}, {"sha": "892f97c31efdbec7b60f6ba8b4b9e4870dbbdbd8", "filename": "libgomp/testsuite/libgomp.oacc-c-c++-common/lib-14.c", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/c68ddd5e2a9dd0cfe21c3661404d7d4c323b23cf/libgomp%2Ftestsuite%2Flibgomp.oacc-c-c%2B%2B-common%2Flib-14.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/c68ddd5e2a9dd0cfe21c3661404d7d4c323b23cf/libgomp%2Ftestsuite%2Flibgomp.oacc-c-c%2B%2B-common%2Flib-14.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libgomp%2Ftestsuite%2Flibgomp.oacc-c-c%2B%2B-common%2Flib-14.c?ref=c68ddd5e2a9dd0cfe21c3661404d7d4c323b23cf", "patch": "@@ -1,6 +1,6 @@\n /* Check acc_is_present.  */\n \n-/* { dg-do run { target openacc_nvidia_accel_selected } } */\n+/* { dg-skip-if \"\" { *-*-* } { \"*\" } { \"-DACC_MEM_SHARED=0\" } } */\n \n #include <stdlib.h>\n #include <openacc.h>"}, {"sha": "335b26f8fcac0bf8488f27876ce76530b4ac688e", "filename": "libgomp/testsuite/libgomp.oacc-c-c++-common/lib-15.c", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/c68ddd5e2a9dd0cfe21c3661404d7d4c323b23cf/libgomp%2Ftestsuite%2Flibgomp.oacc-c-c%2B%2B-common%2Flib-15.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/c68ddd5e2a9dd0cfe21c3661404d7d4c323b23cf/libgomp%2Ftestsuite%2Flibgomp.oacc-c-c%2B%2B-common%2Flib-15.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libgomp%2Ftestsuite%2Flibgomp.oacc-c-c%2B%2B-common%2Flib-15.c?ref=c68ddd5e2a9dd0cfe21c3661404d7d4c323b23cf", "patch": "@@ -1,6 +1,6 @@\n /* Check acc_is_present and acc_copyout.  */\n \n-/* { dg-do run { target openacc_nvidia_accel_selected } } */\n+/* { dg-skip-if \"\" { *-*-* } { \"*\" } { \"-DACC_MEM_SHARED=0\" } } */\n \n #include <stdlib.h>\n #include <openacc.h>"}, {"sha": "f1d9a21ecd38283f7281cea0a5006f5f4d0efd05", "filename": "libgomp/testsuite/libgomp.oacc-c-c++-common/lib-20.c", "status": "modified", "additions": 2, "deletions": 2, "changes": 4, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/c68ddd5e2a9dd0cfe21c3661404d7d4c323b23cf/libgomp%2Ftestsuite%2Flibgomp.oacc-c-c%2B%2B-common%2Flib-20.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/c68ddd5e2a9dd0cfe21c3661404d7d4c323b23cf/libgomp%2Ftestsuite%2Flibgomp.oacc-c-c%2B%2B-common%2Flib-20.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libgomp%2Ftestsuite%2Flibgomp.oacc-c-c%2B%2B-common%2Flib-20.c?ref=c68ddd5e2a9dd0cfe21c3661404d7d4c323b23cf", "patch": "@@ -1,6 +1,6 @@\n-/* Exercise acc_copyin and acc_copyout on nvidia targets.  */\n+/* Exercise acc_copyin and acc_copyout.  */\n \n-/* { dg-do run { target openacc_nvidia_accel_selected } } */\n+/* { dg-skip-if \"\" { *-*-* } { \"*\" } { \"-DACC_MEM_SHARED=0\" } } */\n \n #include <stdio.h>\n #include <stdlib.h>"}, {"sha": "d39f31e6245e0ef5d81f81aecdacb0830dea9632", "filename": "libgomp/testsuite/libgomp.oacc-c-c++-common/lib-23.c", "status": "modified", "additions": 2, "deletions": 2, "changes": 4, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/c68ddd5e2a9dd0cfe21c3661404d7d4c323b23cf/libgomp%2Ftestsuite%2Flibgomp.oacc-c-c%2B%2B-common%2Flib-23.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/c68ddd5e2a9dd0cfe21c3661404d7d4c323b23cf/libgomp%2Ftestsuite%2Flibgomp.oacc-c-c%2B%2B-common%2Flib-23.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libgomp%2Ftestsuite%2Flibgomp.oacc-c-c%2B%2B-common%2Flib-23.c?ref=c68ddd5e2a9dd0cfe21c3661404d7d4c323b23cf", "patch": "@@ -1,6 +1,6 @@\n-/* Exercise acc_copyin and acc_copyout on nvidia targets.  */\n+/* Exercise acc_copyin and acc_copyout.  */\n \n-/* { dg-do run { target openacc_nvidia_accel_selected } } */\n+/* { dg-skip-if \"\" { *-*-* } { \"*\" } { \"-DACC_MEM_SHARED=0\" } } */\n \n #include <stdio.h>\n #include <stdlib.h>"}, {"sha": "96e3129e563588d963be008a96192e0276e76a7b", "filename": "libgomp/testsuite/libgomp.oacc-c-c++-common/lib-24.c", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/c68ddd5e2a9dd0cfe21c3661404d7d4c323b23cf/libgomp%2Ftestsuite%2Flibgomp.oacc-c-c%2B%2B-common%2Flib-24.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/c68ddd5e2a9dd0cfe21c3661404d7d4c323b23cf/libgomp%2Ftestsuite%2Flibgomp.oacc-c-c%2B%2B-common%2Flib-24.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libgomp%2Ftestsuite%2Flibgomp.oacc-c-c%2B%2B-common%2Flib-24.c?ref=c68ddd5e2a9dd0cfe21c3661404d7d4c323b23cf", "patch": "@@ -1,6 +1,6 @@\n /* Exercise acc_create, acc_is_present and acc_delete.  */\n \n-/* { dg-do run { target openacc_nvidia_accel_selected } } */\n+/* { dg-skip-if \"\" { *-*-* } { \"*\" } { \"-DACC_MEM_SHARED=0\" } } */\n \n #include <stdlib.h>\n #include <openacc.h>"}, {"sha": "8ddd897826ffa0f00ef7769c6f7df374b6a884d1", "filename": "libgomp/testsuite/libgomp.oacc-c-c++-common/lib-34.c", "status": "modified", "additions": 2, "deletions": 2, "changes": 4, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/c68ddd5e2a9dd0cfe21c3661404d7d4c323b23cf/libgomp%2Ftestsuite%2Flibgomp.oacc-c-c%2B%2B-common%2Flib-34.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/c68ddd5e2a9dd0cfe21c3661404d7d4c323b23cf/libgomp%2Ftestsuite%2Flibgomp.oacc-c-c%2B%2B-common%2Flib-34.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libgomp%2Ftestsuite%2Flibgomp.oacc-c-c%2B%2B-common%2Flib-34.c?ref=c68ddd5e2a9dd0cfe21c3661404d7d4c323b23cf", "patch": "@@ -1,6 +1,6 @@\n-/* Exercise an invalid acc_present_or_create on nvidia targets.  */\n+/* Exercise an invalid acc_present_or_create.  */\n \n-/* { dg-do run { target openacc_nvidia_accel_selected } } */\n+/* { dg-skip-if \"\" { *-*-* } { \"*\" } { \"-DACC_MEM_SHARED=0\" } } */\n \n #include <stdio.h>\n #include <stdlib.h>"}, {"sha": "adab1098ed82d827d34b29a004979e60ef84c774", "filename": "libgomp/testsuite/libgomp.oacc-c-c++-common/lib-42.c", "status": "modified", "additions": 2, "deletions": 2, "changes": 4, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/c68ddd5e2a9dd0cfe21c3661404d7d4c323b23cf/libgomp%2Ftestsuite%2Flibgomp.oacc-c-c%2B%2B-common%2Flib-42.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/c68ddd5e2a9dd0cfe21c3661404d7d4c323b23cf/libgomp%2Ftestsuite%2Flibgomp.oacc-c-c%2B%2B-common%2Flib-42.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libgomp%2Ftestsuite%2Flibgomp.oacc-c-c%2B%2B-common%2Flib-42.c?ref=c68ddd5e2a9dd0cfe21c3661404d7d4c323b23cf", "patch": "@@ -1,6 +1,6 @@\n-/* Exercise acc_update_device on unmapped data on nvidia targets.  */\n+/* Exercise acc_update_device on unmapped data.  */\n \n-/* { dg-do run { target openacc_nvidia_accel_selected } } */\n+/* { dg-skip-if \"\" { *-*-* } { \"*\" } { \"-DACC_MEM_SHARED=0\" } } */\n \n #include <stdio.h>\n #include <stdlib.h>"}, {"sha": "f02fe2188dc1622a477dadb89d74b41f7205334b", "filename": "libgomp/testsuite/libgomp.oacc-c-c++-common/lib-44.c", "status": "modified", "additions": 2, "deletions": 2, "changes": 4, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/c68ddd5e2a9dd0cfe21c3661404d7d4c323b23cf/libgomp%2Ftestsuite%2Flibgomp.oacc-c-c%2B%2B-common%2Flib-44.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/c68ddd5e2a9dd0cfe21c3661404d7d4c323b23cf/libgomp%2Ftestsuite%2Flibgomp.oacc-c-c%2B%2B-common%2Flib-44.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libgomp%2Ftestsuite%2Flibgomp.oacc-c-c%2B%2B-common%2Flib-44.c?ref=c68ddd5e2a9dd0cfe21c3661404d7d4c323b23cf", "patch": "@@ -1,6 +1,6 @@\n-/* Exercise acc_update_device with size zero data on nvidia targets.  */\n+/* Exercise acc_update_device with size zero data.  */\n \n-/* { dg-do run { target openacc_nvidia_accel_selected } } */\n+/* { dg-skip-if \"\" { *-*-* } { \"*\" } { \"-DACC_MEM_SHARED=0\" } } */\n \n #include <stdio.h>\n #include <stdlib.h>"}, {"sha": "9975c9e990be758cf6dcc8045983f6985f7c38a9", "filename": "libgomp/testsuite/libgomp.oacc-c-c++-common/lib-48.c", "status": "modified", "additions": 2, "deletions": 2, "changes": 4, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/c68ddd5e2a9dd0cfe21c3661404d7d4c323b23cf/libgomp%2Ftestsuite%2Flibgomp.oacc-c-c%2B%2B-common%2Flib-48.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/c68ddd5e2a9dd0cfe21c3661404d7d4c323b23cf/libgomp%2Ftestsuite%2Flibgomp.oacc-c-c%2B%2B-common%2Flib-48.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libgomp%2Ftestsuite%2Flibgomp.oacc-c-c%2B%2B-common%2Flib-48.c?ref=c68ddd5e2a9dd0cfe21c3661404d7d4c323b23cf", "patch": "@@ -1,6 +1,6 @@\n-/* Exercise acc_update_self with a size zero data mapping on nvidia targets.  */\n+/* Exercise acc_update_self with a size zero data mapping.  */\n \n-/* { dg-do run { target openacc_nvidia_accel_selected } } */\n+/* { dg-skip-if \"\" { *-*-* } { \"*\" } { \"-DACC_MEM_SHARED=0\" } } */\n \n #include <stdio.h>\n #include <string.h>"}, {"sha": "1e0ab9cca70d68e89563b95637b86f4a1edade32", "filename": "libgomp/testsuite/libgomp.oacc-c-c++-common/lib-5.c", "status": "modified", "additions": 19, "deletions": 1, "changes": 20, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/c68ddd5e2a9dd0cfe21c3661404d7d4c323b23cf/libgomp%2Ftestsuite%2Flibgomp.oacc-c-c%2B%2B-common%2Flib-5.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/c68ddd5e2a9dd0cfe21c3661404d7d4c323b23cf/libgomp%2Ftestsuite%2Flibgomp.oacc-c-c%2B%2B-common%2Flib-5.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libgomp%2Ftestsuite%2Flibgomp.oacc-c-c%2B%2B-common%2Flib-5.c?ref=c68ddd5e2a9dd0cfe21c3661404d7d4c323b23cf", "patch": "@@ -35,6 +35,24 @@ main (int argc, char **argv)\n       acc_shutdown (acc_device_nvidia);\n     }\n \n-  return 0;\n+  if (acc_get_num_devices (acc_device_radeon) != 0)\n+    {\n+      acc_init (acc_device_radeon);\n+\n+      if (acc_get_device_type () != acc_device_radeon)\n+        abort ();\n+\n+      acc_shutdown (acc_device_radeon);\n+\n+      acc_init (acc_device_default);\n \n+      acc_set_device_type (acc_device_radeon);\n+\n+      if (acc_get_device_type () != acc_device_radeon)\n+        abort ();\n+\n+      acc_shutdown (acc_device_radeon);\n+    }\n+\n+  return 0;\n }"}, {"sha": "9a562b3d0aa7573250aa5e86050352b8dcb69cfa", "filename": "libgomp/testsuite/libgomp.oacc-c-c++-common/lib-52.c", "status": "modified", "additions": 2, "deletions": 4, "changes": 6, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/c68ddd5e2a9dd0cfe21c3661404d7d4c323b23cf/libgomp%2Ftestsuite%2Flibgomp.oacc-c-c%2B%2B-common%2Flib-52.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/c68ddd5e2a9dd0cfe21c3661404d7d4c323b23cf/libgomp%2Ftestsuite%2Flibgomp.oacc-c-c%2B%2B-common%2Flib-52.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libgomp%2Ftestsuite%2Flibgomp.oacc-c-c%2B%2B-common%2Flib-52.c?ref=c68ddd5e2a9dd0cfe21c3661404d7d4c323b23cf", "patch": "@@ -1,6 +1,4 @@\n-/* Exercise acc_map_data with a NULL data mapping on nvidia targets.  */\n-\n-/* { dg-do run { target openacc_nvidia_accel_selected } } */\n+/* Exercise acc_map_data with a NULL data mapping.  */\n \n #include <stdio.h>\n #include <stdlib.h>\n@@ -30,6 +28,6 @@ main (int argc, char **argv)\n }\n \n /* { dg-output \"CheCKpOInT(\\n|\\r\\n|\\r).*\" } */\n-/* { dg-output \"\\\\\\[\\[^\\n\\r]*,\\\\\\+256\\]->\\[\\[0-9a-fA-FxX\\]+,\\\\\\+256\\\\\\] is a bad map\" { target openacc_nvidia_accel_selected } } */\n+/* { dg-output \"\\\\\\[\\[^\\n\\r]*,\\\\\\+256\\]->\\[\\[0-9a-fA-FxX\\]+,\\\\\\+256\\\\\\] is a bad map\" { target { ! openacc_host_selected } } } */\n /* { dg-output \"cannot map data on shared-memory system\" { target openacc_host_selected } } */\n /* { dg-shouldfail \"\" } */"}, {"sha": "d452a694750201668ed7c05b50f6182402e6e70d", "filename": "libgomp/testsuite/libgomp.oacc-c-c++-common/lib-53.c", "status": "modified", "additions": 2, "deletions": 4, "changes": 6, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/c68ddd5e2a9dd0cfe21c3661404d7d4c323b23cf/libgomp%2Ftestsuite%2Flibgomp.oacc-c-c%2B%2B-common%2Flib-53.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/c68ddd5e2a9dd0cfe21c3661404d7d4c323b23cf/libgomp%2Ftestsuite%2Flibgomp.oacc-c-c%2B%2B-common%2Flib-53.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libgomp%2Ftestsuite%2Flibgomp.oacc-c-c%2B%2B-common%2Flib-53.c?ref=c68ddd5e2a9dd0cfe21c3661404d7d4c323b23cf", "patch": "@@ -1,6 +1,4 @@\n-/* Exercise acc_map_data with a NULL data mapping on nvidia targets.  */\n-\n-/* { dg-do run { target openacc_nvidia_accel_selected } } */\n+/* Exercise acc_map_data with a NULL data mapping.  */\n \n #include <stdio.h>\n #include <stdlib.h>\n@@ -30,6 +28,6 @@ main (int argc, char **argv)\n }\n \n /* { dg-output \"CheCKpOInT(\\n|\\r\\n|\\r).*\" } */\n-/* { dg-output \"\\\\\\[\\[0-9a-fA-FxX\\]+,\\\\\\+256\\]->\\\\\\[\\[^\\n\\r]*,\\\\\\+256\\\\\\] is a bad map\" { target openacc_nvidia_accel_selected } } */\n+/* { dg-output \"\\\\\\[\\[0-9a-fA-FxX\\]+,\\\\\\+256\\]->\\\\\\[\\[^\\n\\r]*,\\\\\\+256\\\\\\] is a bad map\" { target { ! openacc_host_selected } } } */\n /* { dg-output \"cannot map data on shared-memory system\" { target openacc_host_selected } } */\n /* { dg-shouldfail \"\" } */"}, {"sha": "1922754631249cd84ea3d4393e852d8c4454c475", "filename": "libgomp/testsuite/libgomp.oacc-c-c++-common/lib-54.c", "status": "modified", "additions": 2, "deletions": 4, "changes": 6, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/c68ddd5e2a9dd0cfe21c3661404d7d4c323b23cf/libgomp%2Ftestsuite%2Flibgomp.oacc-c-c%2B%2B-common%2Flib-54.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/c68ddd5e2a9dd0cfe21c3661404d7d4c323b23cf/libgomp%2Ftestsuite%2Flibgomp.oacc-c-c%2B%2B-common%2Flib-54.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libgomp%2Ftestsuite%2Flibgomp.oacc-c-c%2B%2B-common%2Flib-54.c?ref=c68ddd5e2a9dd0cfe21c3661404d7d4c323b23cf", "patch": "@@ -1,6 +1,4 @@\n-/* Exercise acc_map_data with data size of zero on nvidia targets.  */\n-\n-/* { dg-do run { target openacc_nvidia_accel_selected } } */\n+/* Exercise acc_map_data with data size of zero.  */\n \n #include <stdio.h>\n #include <stdlib.h>\n@@ -30,6 +28,6 @@ main (int argc, char **argv)\n }\n \n /* { dg-output \"CheCKpOInT(\\n|\\r\\n|\\r).*\" } */\n-/* { dg-output \"\\\\\\[\\[0-9a-fA-FxX\\]+,\\\\\\+0\\\\\\]->\\\\\\[\\[0-9a-fA-FxX\\]+,\\\\\\+0\\\\\\] is a bad map\" { target openacc_nvidia_accel_selected } } */\n+/* { dg-output \"\\\\\\[\\[0-9a-fA-FxX\\]+,\\\\\\+0\\\\\\]->\\\\\\[\\[0-9a-fA-FxX\\]+,\\\\\\+0\\\\\\] is a bad map\" { target { ! openacc_host_selected } } } */\n /* { dg-output \"cannot map data on shared-memory system\" { target openacc_host_selected } } */\n /* { dg-shouldfail \"\" } */"}, {"sha": "81653c6a0832ae56b84cf92a19c4f86b821158df", "filename": "libgomp/testsuite/libgomp.oacc-c-c++-common/lib-57.c", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/c68ddd5e2a9dd0cfe21c3661404d7d4c323b23cf/libgomp%2Ftestsuite%2Flibgomp.oacc-c-c%2B%2B-common%2Flib-57.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/c68ddd5e2a9dd0cfe21c3661404d7d4c323b23cf/libgomp%2Ftestsuite%2Flibgomp.oacc-c-c%2B%2B-common%2Flib-57.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libgomp%2Ftestsuite%2Flibgomp.oacc-c-c%2B%2B-common%2Flib-57.c?ref=c68ddd5e2a9dd0cfe21c3661404d7d4c323b23cf", "patch": "@@ -33,6 +33,6 @@ main (int argc, char **argv)\n }\n \n /* { dg-output \"CheCKpOInT(\\n|\\r\\n|\\r).*\" } */\n-/* { dg-output \"\\[0-9a-fA-FxX\\]+ is not a mapped block\" { target openacc_nvidia_accel_selected } } */\n+/* { dg-output \"\\[0-9a-fA-FxX\\]+ is not a mapped block\" { target { ! openacc_host_selected } } } */\n /* { dg-output \"cannot map data on shared-memory system\" { target openacc_host_selected } } */\n /* { dg-shouldfail \"\" } */"}, {"sha": "c6bc2610cac6b5aec05097fcc4ad0dffaf356e90", "filename": "libgomp/testsuite/libgomp.oacc-c-c++-common/lib-58.c", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/c68ddd5e2a9dd0cfe21c3661404d7d4c323b23cf/libgomp%2Ftestsuite%2Flibgomp.oacc-c-c%2B%2B-common%2Flib-58.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/c68ddd5e2a9dd0cfe21c3661404d7d4c323b23cf/libgomp%2Ftestsuite%2Flibgomp.oacc-c-c%2B%2B-common%2Flib-58.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libgomp%2Ftestsuite%2Flibgomp.oacc-c-c%2B%2B-common%2Flib-58.c?ref=c68ddd5e2a9dd0cfe21c3661404d7d4c323b23cf", "patch": "@@ -33,6 +33,6 @@ main (int argc, char **argv)\n }\n \n /* { dg-output \"CheCKpOInT(\\n|\\r\\n|\\r).*\" } */\n-/* { dg-output \"\\[^\\n\\r]* is not a mapped block\" { target openacc_nvidia_accel_selected } } */\n+/* { dg-output \"\\[^\\n\\r]* is not a mapped block\" { target { ! openacc_host_selected } } } */\n /* { dg-output \"cannot map data on shared-memory system\" { target openacc_host_selected } } */\n /* { dg-shouldfail \"\" } */"}, {"sha": "a3affc0c20d97c2afd958af1a04cd05448933708", "filename": "libgomp/testsuite/libgomp.oacc-c-c++-common/lib-6.c", "status": "modified", "additions": 34, "deletions": 13, "changes": 47, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/c68ddd5e2a9dd0cfe21c3661404d7d4c323b23cf/libgomp%2Ftestsuite%2Flibgomp.oacc-c-c%2B%2B-common%2Flib-6.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/c68ddd5e2a9dd0cfe21c3661404d7d4c323b23cf/libgomp%2Ftestsuite%2Flibgomp.oacc-c-c%2B%2B-common%2Flib-6.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libgomp%2Ftestsuite%2Flibgomp.oacc-c-c%2B%2B-common%2Flib-6.c?ref=c68ddd5e2a9dd0cfe21c3661404d7d4c323b23cf", "patch": "@@ -11,26 +11,47 @@ main (int argc, char **argv)\n   if (acc_get_device_type () == acc_device_default)\n     abort ();\n \n-  if (acc_get_num_devices (acc_device_nvidia) == 0)\n-    return 0;\n+  if (acc_get_num_devices (acc_device_nvidia))\n+    {\n+      acc_set_device_type (acc_device_nvidia);\n \n-  acc_set_device_type (acc_device_nvidia);\n+      if (acc_get_device_type () != acc_device_nvidia)\n+\tabort ();\n \n-  if (acc_get_device_type () != acc_device_nvidia)\n-    abort ();\n+      acc_shutdown (acc_device_nvidia);\n \n-  acc_shutdown (acc_device_nvidia);\n+      acc_set_device_type (acc_device_nvidia);\n \n-  acc_set_device_type (acc_device_nvidia);\n+      if (acc_get_device_type () != acc_device_nvidia)\n+\tabort ();\n \n-  if (acc_get_device_type () != acc_device_nvidia)\n-    abort ();\n+      devnum = acc_get_num_devices (acc_device_host);\n+      if (devnum != 1)\n+\tabort ();\n \n-  devnum = acc_get_num_devices (acc_device_host);\n-  if (devnum != 1)\n-    abort ();\n+      acc_shutdown (acc_device_nvidia);\n+    }\n+\n+  if (acc_get_num_devices (acc_device_radeon))\n+    {\n+      acc_set_device_type (acc_device_radeon);\n+\n+      if (acc_get_device_type () != acc_device_radeon)\n+\tabort ();\n+\n+      acc_shutdown (acc_device_radeon);\n+\n+      acc_set_device_type (acc_device_radeon);\n+\n+      if (acc_get_device_type () != acc_device_radeon)\n+\tabort ();\n+\n+      devnum = acc_get_num_devices (acc_device_host);\n+      if (devnum != 1)\n+\tabort ();\n \n-  acc_shutdown (acc_device_nvidia);\n+      acc_shutdown (acc_device_radeon);\n+    }\n \n   if (acc_get_device_type () == acc_device_default)\n     abort ();"}, {"sha": "2e7184a918bbfb2625a599ad286ad39e451a4e28", "filename": "libgomp/testsuite/libgomp.oacc-c-c++-common/lib-62.c", "status": "modified", "additions": 2, "deletions": 1, "changes": 3, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/c68ddd5e2a9dd0cfe21c3661404d7d4c323b23cf/libgomp%2Ftestsuite%2Flibgomp.oacc-c-c%2B%2B-common%2Flib-62.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/c68ddd5e2a9dd0cfe21c3661404d7d4c323b23cf/libgomp%2Ftestsuite%2Flibgomp.oacc-c-c%2B%2B-common%2Flib-62.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libgomp%2Ftestsuite%2Flibgomp.oacc-c-c%2B%2B-common%2Flib-62.c?ref=c68ddd5e2a9dd0cfe21c3661404d7d4c323b23cf", "patch": "@@ -1,4 +1,5 @@\n-/* { dg-do run { target openacc_nvidia_accel_selected } } */\n+/* Not all implement this checking.\n+   { dg-skip-if \"\" { openacc_radeon_accel_selected || openacc_host_selected } } */\n \n #include <stdio.h>\n #include <string.h>"}, {"sha": "84bbccb448e6b69a6cc2e279c2ccc3668e05d46f", "filename": "libgomp/testsuite/libgomp.oacc-c-c++-common/lib-63.c", "status": "modified", "additions": 2, "deletions": 1, "changes": 3, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/c68ddd5e2a9dd0cfe21c3661404d7d4c323b23cf/libgomp%2Ftestsuite%2Flibgomp.oacc-c-c%2B%2B-common%2Flib-63.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/c68ddd5e2a9dd0cfe21c3661404d7d4c323b23cf/libgomp%2Ftestsuite%2Flibgomp.oacc-c-c%2B%2B-common%2Flib-63.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libgomp%2Ftestsuite%2Flibgomp.oacc-c-c%2B%2B-common%2Flib-63.c?ref=c68ddd5e2a9dd0cfe21c3661404d7d4c323b23cf", "patch": "@@ -1,4 +1,5 @@\n-/* { dg-do run { target openacc_nvidia_accel_selected } } */\n+/* Not all implement this checking.\n+   { dg-skip-if \"\" { openacc_radeon_accel_selected || openacc_host_selected } } */\n \n #include <stdio.h>\n #include <string.h>"}, {"sha": "e26681a7b4d884b7f414188bb7b1e91184d0f3b8", "filename": "libgomp/testsuite/libgomp.oacc-c-c++-common/lib-64.c", "status": "modified", "additions": 2, "deletions": 1, "changes": 3, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/c68ddd5e2a9dd0cfe21c3661404d7d4c323b23cf/libgomp%2Ftestsuite%2Flibgomp.oacc-c-c%2B%2B-common%2Flib-64.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/c68ddd5e2a9dd0cfe21c3661404d7d4c323b23cf/libgomp%2Ftestsuite%2Flibgomp.oacc-c-c%2B%2B-common%2Flib-64.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libgomp%2Ftestsuite%2Flibgomp.oacc-c-c%2B%2B-common%2Flib-64.c?ref=c68ddd5e2a9dd0cfe21c3661404d7d4c323b23cf", "patch": "@@ -1,4 +1,5 @@\n-/* { dg-do run { target openacc_nvidia_accel_selected } } */\n+/* Not all implement this checking.\n+   { dg-skip-if \"\" { openacc_radeon_accel_selected || openacc_host_selected } } */\n \n #include <stdio.h>\n #include <string.h>"}, {"sha": "69add3ffedb5b74ef7784b4d48c110f4d7f43533", "filename": "libgomp/testsuite/libgomp.oacc-c-c++-common/lib-65.c", "status": "modified", "additions": 2, "deletions": 1, "changes": 3, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/c68ddd5e2a9dd0cfe21c3661404d7d4c323b23cf/libgomp%2Ftestsuite%2Flibgomp.oacc-c-c%2B%2B-common%2Flib-65.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/c68ddd5e2a9dd0cfe21c3661404d7d4c323b23cf/libgomp%2Ftestsuite%2Flibgomp.oacc-c-c%2B%2B-common%2Flib-65.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libgomp%2Ftestsuite%2Flibgomp.oacc-c-c%2B%2B-common%2Flib-65.c?ref=c68ddd5e2a9dd0cfe21c3661404d7d4c323b23cf", "patch": "@@ -1,4 +1,5 @@\n-/* { dg-do run { target openacc_nvidia_accel_selected } } */\n+/* Not all implement this checking.\n+   { dg-skip-if \"\" { openacc_radeon_accel_selected || openacc_host_selected } } */\n \n #include <stdio.h>\n #include <string.h>"}, {"sha": "c13333b3b48fe109021795f3ca8ffddc7b6b8f52", "filename": "libgomp/testsuite/libgomp.oacc-c-c++-common/lib-67.c", "status": "modified", "additions": 2, "deletions": 1, "changes": 3, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/c68ddd5e2a9dd0cfe21c3661404d7d4c323b23cf/libgomp%2Ftestsuite%2Flibgomp.oacc-c-c%2B%2B-common%2Flib-67.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/c68ddd5e2a9dd0cfe21c3661404d7d4c323b23cf/libgomp%2Ftestsuite%2Flibgomp.oacc-c-c%2B%2B-common%2Flib-67.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libgomp%2Ftestsuite%2Flibgomp.oacc-c-c%2B%2B-common%2Flib-67.c?ref=c68ddd5e2a9dd0cfe21c3661404d7d4c323b23cf", "patch": "@@ -1,4 +1,5 @@\n-/* { dg-do run { target openacc_nvidia_accel_selected } } */\n+/* Not all implement this checking.\n+   { dg-skip-if \"\" { openacc_radeon_accel_selected || openacc_host_selected } } */\n \n #include <stdio.h>\n #include <string.h>"}, {"sha": "7fffd0b9f0b82362b7985c0c672c006546e14a43", "filename": "libgomp/testsuite/libgomp.oacc-c-c++-common/lib-68.c", "status": "modified", "additions": 2, "deletions": 1, "changes": 3, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/c68ddd5e2a9dd0cfe21c3661404d7d4c323b23cf/libgomp%2Ftestsuite%2Flibgomp.oacc-c-c%2B%2B-common%2Flib-68.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/c68ddd5e2a9dd0cfe21c3661404d7d4c323b23cf/libgomp%2Ftestsuite%2Flibgomp.oacc-c-c%2B%2B-common%2Flib-68.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libgomp%2Ftestsuite%2Flibgomp.oacc-c-c%2B%2B-common%2Flib-68.c?ref=c68ddd5e2a9dd0cfe21c3661404d7d4c323b23cf", "patch": "@@ -1,4 +1,5 @@\n-/* { dg-do run { target openacc_nvidia_accel_selected } } */\n+/* Not all implement this checking.\n+   { dg-skip-if \"\" { openacc_radeon_accel_selected || openacc_host_selected } } */\n \n #include <stdio.h>\n #include <string.h>"}, {"sha": "7e8a7e20203fde5f27642c4487a977621378d43f", "filename": "libgomp/testsuite/libgomp.oacc-c-c++-common/lib-86.c", "status": "modified", "additions": 17, "deletions": 10, "changes": 27, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/c68ddd5e2a9dd0cfe21c3661404d7d4c323b23cf/libgomp%2Ftestsuite%2Flibgomp.oacc-c-c%2B%2B-common%2Flib-86.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/c68ddd5e2a9dd0cfe21c3661404d7d4c323b23cf/libgomp%2Ftestsuite%2Flibgomp.oacc-c-c%2B%2B-common%2Flib-86.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libgomp%2Ftestsuite%2Flibgomp.oacc-c-c%2B%2B-common%2Flib-86.c?ref=c68ddd5e2a9dd0cfe21c3661404d7d4c323b23cf", "patch": "@@ -7,9 +7,6 @@\n int\n main (int argc, char **argv)\n {\n-  if (acc_get_num_devices (acc_device_nvidia) == 0)\n-    return 0;\n-\n   if (acc_get_current_cuda_device () != 0)\n     abort ();\n \n@@ -20,18 +17,28 @@ main (int argc, char **argv)\n \n   acc_shutdown (acc_device_host);\n \n-  if (acc_get_num_devices (acc_device_nvidia) == 0)\n-    return 0;\n-\n   if (acc_get_current_cuda_device () != 0)\n     abort ();\n \n-  acc_init (acc_device_nvidia);\n+  if (acc_get_num_devices (acc_device_nvidia))\n+    {\n+      acc_init (acc_device_nvidia);\n \n-  if (acc_get_current_cuda_device () == 0)\n-    abort ();\n+      if (acc_get_current_cuda_device () == 0)\n+\tabort ();\n+\n+      acc_shutdown (acc_device_nvidia);\n+    }\n+\n+  if (acc_get_num_devices (acc_device_radeon))\n+    {\n+      acc_init (acc_device_radeon);\n+\n+      if (acc_get_current_cuda_device () != 0)\n+\tabort ();\n \n-  acc_shutdown (acc_device_nvidia);\n+      acc_shutdown (acc_device_radeon);\n+    }\n \n   if (acc_get_current_cuda_device () != 0)\n     abort ();"}, {"sha": "cdc87edc5908a28e3b6270000924de5d882fce90", "filename": "libgomp/testsuite/libgomp.oacc-c-c++-common/lib-87.c", "status": "modified", "additions": 17, "deletions": 10, "changes": 27, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/c68ddd5e2a9dd0cfe21c3661404d7d4c323b23cf/libgomp%2Ftestsuite%2Flibgomp.oacc-c-c%2B%2B-common%2Flib-87.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/c68ddd5e2a9dd0cfe21c3661404d7d4c323b23cf/libgomp%2Ftestsuite%2Flibgomp.oacc-c-c%2B%2B-common%2Flib-87.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libgomp%2Ftestsuite%2Flibgomp.oacc-c-c%2B%2B-common%2Flib-87.c?ref=c68ddd5e2a9dd0cfe21c3661404d7d4c323b23cf", "patch": "@@ -7,9 +7,6 @@\n int\n main (int argc, char **argv)\n {\n-  if (acc_get_num_devices (acc_device_nvidia) == 0)\n-    return 0;\n-\n   if (acc_get_current_cuda_context () != 0)\n     abort ();\n \n@@ -20,18 +17,28 @@ main (int argc, char **argv)\n \n   acc_shutdown (acc_device_host);\n \n-  if (acc_get_num_devices (acc_device_nvidia) == 0)\n-    return 0;\n-\n   if (acc_get_current_cuda_context () != 0)\n     abort ();\n \n-  acc_init (acc_device_nvidia);\n+  if (acc_get_num_devices (acc_device_nvidia))\n+    {\n+      acc_init (acc_device_nvidia);\n \n-  if (acc_get_current_cuda_context () == 0)\n-    abort ();\n+      if (acc_get_current_cuda_context () == 0)\n+\tabort ();\n+\n+      acc_shutdown (acc_device_nvidia);\n+    }\n+\n+  if (acc_get_num_devices (acc_device_radeon))\n+    {\n+      acc_init (acc_device_radeon);\n+\n+      if (acc_get_current_cuda_context () != 0)\n+\tabort ();\n \n-  acc_shutdown (acc_device_nvidia);\n+      acc_shutdown (acc_device_radeon);\n+    }\n \n   if (acc_get_current_cuda_context () != 0)\n     abort ();"}, {"sha": "c1cccd919c3152ce6c532a89a6528cc7b3c476d6", "filename": "libgomp/testsuite/libgomp.oacc-c-c++-common/lib-88.c", "status": "modified", "additions": 2, "deletions": 7, "changes": 9, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/c68ddd5e2a9dd0cfe21c3661404d7d4c323b23cf/libgomp%2Ftestsuite%2Flibgomp.oacc-c-c%2B%2B-common%2Flib-88.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/c68ddd5e2a9dd0cfe21c3661404d7d4c323b23cf/libgomp%2Ftestsuite%2Flibgomp.oacc-c-c%2B%2B-common%2Flib-88.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libgomp%2Ftestsuite%2Flibgomp.oacc-c-c%2B%2B-common%2Flib-88.c?ref=c68ddd5e2a9dd0cfe21c3661404d7d4c323b23cf", "patch": "@@ -1,4 +1,4 @@\n-/* { dg-do run } */\n+/* { dg-skip-if \"\" { *-*-* } { \"*\" } { \"-DACC_MEM_SHARED=0\" } } */\n \n #include <stdio.h>\n #include <pthread.h>\n@@ -47,10 +47,7 @@ main (int argc, char **argv)\n   pthread_attr_t attr;\n   pthread_t *tid;\n \n-  if (acc_get_num_devices (acc_device_nvidia) == 0)\n-    return 0;\n-\n-  acc_init (acc_device_nvidia);\n+  acc_init (acc_device_default);\n \n   x = (unsigned char *) malloc (N);\n \n@@ -103,8 +100,6 @@ main (int argc, char **argv)\n   if (acc_is_present (x, N) != 0)\n     abort ();\n \n-  acc_shutdown (acc_device_nvidia);\n-\n   return 0;\n }\n "}, {"sha": "6b4e3acf7dbded041408b807566e44d268459bbb", "filename": "libgomp/testsuite/libgomp.oacc-c-c++-common/lib-89.c", "status": "modified", "additions": 9, "deletions": 9, "changes": 18, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/c68ddd5e2a9dd0cfe21c3661404d7d4c323b23cf/libgomp%2Ftestsuite%2Flibgomp.oacc-c-c%2B%2B-common%2Flib-89.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/c68ddd5e2a9dd0cfe21c3661404d7d4c323b23cf/libgomp%2Ftestsuite%2Flibgomp.oacc-c-c%2B%2B-common%2Flib-89.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libgomp%2Ftestsuite%2Flibgomp.oacc-c-c%2B%2B-common%2Flib-89.c?ref=c68ddd5e2a9dd0cfe21c3661404d7d4c323b23cf", "patch": "@@ -1,4 +1,4 @@\n-/* { dg-do run } */\n+/* { dg-skip-if \"\" { *-*-* } { \"*\" } { \"-DACC_MEM_SHARED=0\" } } */\n \n #include <stdio.h>\n #include <pthread.h>\n@@ -23,11 +23,16 @@ test (void *arg)\n \n   tid = (int) (long) arg;\n \n-  devnum = acc_get_device_num (acc_device_nvidia);\n-  acc_set_device_num (devnum, acc_device_nvidia);\n+  devnum = acc_get_device_num (acc_device_default);\n+  acc_set_device_num (devnum, acc_device_default);\n \n+#if ACC_DEVICE_TYPE_nvidia\n   if (acc_get_current_cuda_context () == NULL)\n     abort ();\n+#else\n+  if (acc_get_current_cuda_context () != NULL)\n+    abort ();\n+#endif\n \n   p = (unsigned char *) malloc (N);\n \n@@ -50,10 +55,7 @@ main (int argc, char **argv)\n   pthread_attr_t attr;\n   pthread_t *tid;\n \n-  if (acc_get_num_devices (acc_device_nvidia) == 0)\n-    return 0;\n-\n-  acc_init (acc_device_nvidia);\n+  acc_init (acc_device_default);\n \n   x = (unsigned char **) malloc (NTHREADS * N);\n   d_x = (void **) malloc (NTHREADS * N);\n@@ -110,8 +112,6 @@ main (int argc, char **argv)\n \tabort ();\n     }\n \n-  acc_shutdown (acc_device_nvidia);\n-\n   return 0;\n }\n "}, {"sha": "0043fb3109db54b0b3684a732a124fe3d757bd30", "filename": "libgomp/testsuite/libgomp.oacc-c-c++-common/lib-92.c", "status": "modified", "additions": 9, "deletions": 9, "changes": 18, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/c68ddd5e2a9dd0cfe21c3661404d7d4c323b23cf/libgomp%2Ftestsuite%2Flibgomp.oacc-c-c%2B%2B-common%2Flib-92.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/c68ddd5e2a9dd0cfe21c3661404d7d4c323b23cf/libgomp%2Ftestsuite%2Flibgomp.oacc-c-c%2B%2B-common%2Flib-92.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libgomp%2Ftestsuite%2Flibgomp.oacc-c-c%2B%2B-common%2Flib-92.c?ref=c68ddd5e2a9dd0cfe21c3661404d7d4c323b23cf", "patch": "@@ -1,4 +1,4 @@\n-/* { dg-do run } */\n+/* { dg-skip-if \"\" { *-*-* } { \"*\" } { \"-DACC_MEM_SHARED=0\" } } */\n \n #include <pthread.h>\n #include <stdio.h>\n@@ -22,11 +22,16 @@ test (void *arg)\n \n   tid = (int) (long) arg;\n \n-  devnum = acc_get_device_num (acc_device_nvidia);\n-  acc_set_device_num (devnum, acc_device_nvidia);\n+  devnum = acc_get_device_num (acc_device_default);\n+  acc_set_device_num (devnum, acc_device_default);\n \n+#if ACC_DEVICE_TYPE_nvidia\n   if (acc_get_current_cuda_context () == NULL)\n     abort ();\n+#else\n+  if (acc_get_current_cuda_context () != NULL)\n+    abort ();\n+#endif\n \n   acc_copyout (x[tid], N);\n \n@@ -49,10 +54,7 @@ main (int argc, char **argv)\n   pthread_t *tid;\n   unsigned char *p;\n \n-  if (acc_get_num_devices (acc_device_nvidia) == 0)\n-    return 0;\n-\n-  acc_init (acc_device_nvidia);\n+  acc_init (acc_device_default);\n \n   x = (unsigned char **) malloc (NTHREADS * N);\n   d_x = (void **) malloc (NTHREADS * N);\n@@ -104,8 +106,6 @@ main (int argc, char **argv)\n \tabort ();\n     }\n \n-  acc_shutdown (acc_device_nvidia);\n-\n   return 0;\n }\n "}, {"sha": "2b2f8fede0289de6f1d220de613a9bc69c91a6a2", "filename": "libgomp/testsuite/libgomp.oacc-fortran/lib-10.f90", "status": "modified", "additions": 1, "deletions": 5, "changes": 6, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/c68ddd5e2a9dd0cfe21c3661404d7d4c323b23cf/libgomp%2Ftestsuite%2Flibgomp.oacc-fortran%2Flib-10.f90", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/c68ddd5e2a9dd0cfe21c3661404d7d4c323b23cf/libgomp%2Ftestsuite%2Flibgomp.oacc-fortran%2Flib-10.f90", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libgomp%2Ftestsuite%2Flibgomp.oacc-fortran%2Flib-10.f90?ref=c68ddd5e2a9dd0cfe21c3661404d7d4c323b23cf", "patch": "@@ -15,9 +15,7 @@ program main\n   integer, parameter :: c_size = sizeof (c)\n   integer, parameter :: r_size = sizeof (r)\n \n-  if (acc_get_num_devices (acc_device_nvidia) .eq. 0) call exit\n-\n-  call acc_init (acc_device_nvidia)\n+  call acc_init (acc_device_default)\n \n   call set3d (.FALSE., a_3d_i, a_3d_c, a_3d_r)\n \n@@ -39,8 +37,6 @@ program main\n     end do\n   end do\n \n-  call acc_shutdown (acc_device_nvidia)\n-\n contains\n \n   subroutine set3d (clear, a_i, a_c, a_r)"}, {"sha": "90c2868e643fc656bebde37f6d2677c1c79c0e75", "filename": "libgomp/testsuite/libgomp.oacc-fortran/lib-14.f90", "status": "modified", "additions": 2, "deletions": 1, "changes": 3, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/c68ddd5e2a9dd0cfe21c3661404d7d4c323b23cf/libgomp%2Ftestsuite%2Flibgomp.oacc-fortran%2Flib-14.f90", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/c68ddd5e2a9dd0cfe21c3661404d7d4c323b23cf/libgomp%2Ftestsuite%2Flibgomp.oacc-fortran%2Flib-14.f90", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libgomp%2Ftestsuite%2Flibgomp.oacc-fortran%2Flib-14.f90?ref=c68ddd5e2a9dd0cfe21c3661404d7d4c323b23cf", "patch": "@@ -1,7 +1,8 @@\n ! Exercise the data movement runtime library functions on non-shared memory\n ! targets.\n \n-! { dg-do run { target openacc_nvidia_accel_selected } }\n+! { dg-do run }\n+! { dg-skip-if \"\" { *-*-* } { \"*\" } { \"-DACC_MEM_SHARED=0\" } }\n \n program main\n   use openacc"}, {"sha": "08808a4023bac94a214e5b36e33f2b0c8020a450", "filename": "libgomp/testsuite/libgomp.oacc-fortran/lib-5.f90", "status": "modified", "additions": 36, "deletions": 10, "changes": 46, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/c68ddd5e2a9dd0cfe21c3661404d7d4c323b23cf/libgomp%2Ftestsuite%2Flibgomp.oacc-fortran%2Flib-5.f90", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/c68ddd5e2a9dd0cfe21c3661404d7d4c323b23cf/libgomp%2Ftestsuite%2Flibgomp.oacc-fortran%2Flib-5.f90", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libgomp%2Ftestsuite%2Flibgomp.oacc-fortran%2Flib-5.f90?ref=c68ddd5e2a9dd0cfe21c3661404d7d4c323b23cf", "patch": "@@ -6,26 +6,52 @@ program main\n \n   integer n\n \n-  if (acc_get_num_devices (acc_device_nvidia) .eq. 0) call exit\n+  if (acc_get_num_devices (acc_device_nvidia) .ne. 0) then\n \n-  call acc_init (acc_device_nvidia)\n+     call acc_init (acc_device_nvidia)\n \n-  n = 0\n+     n = 0\n \n-  call acc_set_device_num (n, acc_device_nvidia)\n+     call acc_set_device_num (n, acc_device_nvidia)\n \n-  if (acc_get_device_num (acc_device_nvidia) .ne. 0) STOP 1\n+     if (acc_get_device_num (acc_device_nvidia) .ne. 0) stop 11\n \n-  if (acc_get_num_devices (acc_device_nvidia) .gt. 1) then\n+     if (acc_get_num_devices (acc_device_nvidia) .gt. 1) then\n \n-    n = 1\n+        n = 1\n \n-    call acc_set_device_num (n, acc_device_nvidia)\n+        call acc_set_device_num (n, acc_device_nvidia)\n \n-    if (acc_get_device_num (acc_device_nvidia) .ne. 1) STOP 2\n+        if (acc_get_device_num (acc_device_nvidia) .ne. 1) stop 12\n+\n+     end if\n+\n+     call acc_shutdown (acc_device_nvidia)\n \n   end if\n \n-  call acc_shutdown (acc_device_nvidia)\n+  if (acc_get_num_devices (acc_device_radeon) .ne. 0) then\n+\n+     call acc_init (acc_device_radeon)\n+\n+     n = 0\n+\n+     call acc_set_device_num (n, acc_device_radeon)\n+\n+     if (acc_get_device_num (acc_device_radeon) .ne. 0) stop 21\n+\n+     if (acc_get_num_devices (acc_device_radeon) .gt. 1) then\n+\n+        n = 1\n+\n+        call acc_set_device_num (n, acc_device_radeon)\n+\n+        if (acc_get_device_num (acc_device_radeon) .ne. 1) stop 22\n+\n+     end if\n+\n+     call acc_shutdown (acc_device_radeon)\n+\n+  end if\n \n end program"}, {"sha": "fa610b16d34f767018e7cb02ebe2fdd875f5c4be", "filename": "libgomp/testsuite/libgomp.oacc-fortran/lib-7.f90", "status": "modified", "additions": 36, "deletions": 10, "changes": 46, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/c68ddd5e2a9dd0cfe21c3661404d7d4c323b23cf/libgomp%2Ftestsuite%2Flibgomp.oacc-fortran%2Flib-7.f90", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/c68ddd5e2a9dd0cfe21c3661404d7d4c323b23cf/libgomp%2Ftestsuite%2Flibgomp.oacc-fortran%2Flib-7.f90", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libgomp%2Ftestsuite%2Flibgomp.oacc-fortran%2Flib-7.f90?ref=c68ddd5e2a9dd0cfe21c3661404d7d4c323b23cf", "patch": "@@ -6,26 +6,52 @@ program main\n \n   integer n\n \n-  if (acc_get_num_devices (acc_device_nvidia) .eq. 0) call exit\n+  if (acc_get_num_devices (acc_device_nvidia) .ne. 0) then\n \n-  call acc_init (acc_device_nvidia)\n+     call acc_init (acc_device_nvidia)\n \n-  n = 0\n+     n = 0\n \n-  call acc_set_device_num (n, acc_device_nvidia)\n+     call acc_set_device_num (n, acc_device_nvidia)\n \n-  if (acc_get_device_num (acc_device_nvidia) .ne. 0) STOP 1\n+     if (acc_get_device_num (acc_device_nvidia) .ne. 0) STOP 1\n \n-  if (acc_get_num_devices (acc_device_nvidia) .gt. 1) then\n+     if (acc_get_num_devices (acc_device_nvidia) .gt. 1) then\n \n-    n = 1\n+        n = 1\n \n-    call acc_set_device_num (n, acc_device_nvidia)\n+        call acc_set_device_num (n, acc_device_nvidia)\n \n-    if (acc_get_device_num (acc_device_nvidia) .ne. 1) STOP 2\n+        if (acc_get_device_num (acc_device_nvidia) .ne. 1) STOP 2\n+\n+     end if\n+\n+     call acc_shutdown (acc_device_nvidia)\n \n   end if\n \n-  call acc_shutdown (acc_device_nvidia)\n+  if (acc_get_num_devices (acc_device_radeon) .ne. 0) then\n+\n+     call acc_init (acc_device_radeon)\n+\n+     n = 0\n+\n+     call acc_set_device_num (n, acc_device_radeon)\n+\n+     if (acc_get_device_num (acc_device_radeon) .ne. 0) STOP 1\n+\n+     if (acc_get_num_devices (acc_device_radeon) .gt. 1) then\n+\n+        n = 1\n+\n+        call acc_set_device_num (n, acc_device_radeon)\n+\n+        if (acc_get_device_num (acc_device_radeon) .ne. 1) STOP 2\n+\n+     end if\n+\n+     call acc_shutdown (acc_device_radeon)\n+\n+  end if\n \n end program"}, {"sha": "2b36b4078f6cb5182661c2682a14a4e5767bef70", "filename": "libgomp/testsuite/libgomp.oacc-fortran/lib-8.f90", "status": "modified", "additions": 1, "deletions": 5, "changes": 6, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/c68ddd5e2a9dd0cfe21c3661404d7d4c323b23cf/libgomp%2Ftestsuite%2Flibgomp.oacc-fortran%2Flib-8.f90", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/c68ddd5e2a9dd0cfe21c3661404d7d4c323b23cf/libgomp%2Ftestsuite%2Flibgomp.oacc-fortran%2Flib-8.f90", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libgomp%2Ftestsuite%2Flibgomp.oacc-fortran%2Flib-8.f90?ref=c68ddd5e2a9dd0cfe21c3661404d7d4c323b23cf", "patch": "@@ -16,9 +16,7 @@ program main\n   integer, parameter :: c_size = sizeof (c)\n   integer, parameter :: r_size = sizeof (r)\n \n-  if (acc_get_num_devices (acc_device_nvidia) .eq. 0) call exit\n-\n-  call acc_init (acc_device_nvidia)\n+  call acc_init (acc_device_default)\n \n   call set3d (.FALSE., a_3d_i, a_3d_c, a_3d_r)\n \n@@ -40,8 +38,6 @@ program main\n     end do\n   end do\n \n-  call acc_shutdown (acc_device_nvidia)\n-\n contains\n \n   subroutine set3d (clear, a_i, a_c, a_r)"}]}