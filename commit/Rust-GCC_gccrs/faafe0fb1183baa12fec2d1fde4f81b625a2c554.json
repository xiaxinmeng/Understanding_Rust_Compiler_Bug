{"sha": "faafe0fb1183baa12fec2d1fde4f81b625a2c554", "node_id": "C_kwDOANBUbNoAKGZhYWZlMGZiMTE4M2JhYTEyZmVjMmQxZmRlNGY4MWI2MjVhMmM1NTQ", "commit": {"author": {"name": "Philip Herron", "email": "philip.herron@embecosm.com", "date": "2021-09-24T13:47:05Z"}, "committer": {"name": "Philip Herron", "email": "philip.herron@embecosm.com", "date": "2021-09-24T13:47:05Z"}, "message": "Update docker build workflow", "tree": {"sha": "221aa2489607471e84c2f9cee82392431764d812", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/221aa2489607471e84c2f9cee82392431764d812"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/faafe0fb1183baa12fec2d1fde4f81b625a2c554", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/faafe0fb1183baa12fec2d1fde4f81b625a2c554", "html_url": "https://github.com/Rust-GCC/gccrs/commit/faafe0fb1183baa12fec2d1fde4f81b625a2c554", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/faafe0fb1183baa12fec2d1fde4f81b625a2c554/comments", "author": {"login": "philberty", "id": 84585, "node_id": "MDQ6VXNlcjg0NTg1", "avatar_url": "https://avatars.githubusercontent.com/u/84585?v=4", "gravatar_id": "", "url": "https://api.github.com/users/philberty", "html_url": "https://github.com/philberty", "followers_url": "https://api.github.com/users/philberty/followers", "following_url": "https://api.github.com/users/philberty/following{/other_user}", "gists_url": "https://api.github.com/users/philberty/gists{/gist_id}", "starred_url": "https://api.github.com/users/philberty/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/philberty/subscriptions", "organizations_url": "https://api.github.com/users/philberty/orgs", "repos_url": "https://api.github.com/users/philberty/repos", "events_url": "https://api.github.com/users/philberty/events{/privacy}", "received_events_url": "https://api.github.com/users/philberty/received_events", "type": "User", "site_admin": false}, "committer": {"login": "philberty", "id": 84585, "node_id": "MDQ6VXNlcjg0NTg1", "avatar_url": "https://avatars.githubusercontent.com/u/84585?v=4", "gravatar_id": "", "url": "https://api.github.com/users/philberty", "html_url": "https://github.com/philberty", "followers_url": "https://api.github.com/users/philberty/followers", "following_url": "https://api.github.com/users/philberty/following{/other_user}", "gists_url": "https://api.github.com/users/philberty/gists{/gist_id}", "starred_url": "https://api.github.com/users/philberty/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/philberty/subscriptions", "organizations_url": "https://api.github.com/users/philberty/orgs", "repos_url": "https://api.github.com/users/philberty/repos", "events_url": "https://api.github.com/users/philberty/events{/privacy}", "received_events_url": "https://api.github.com/users/philberty/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "8a0dd2bd98150b79962f6f1f6f4f6555d6dc8f4f", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/8a0dd2bd98150b79962f6f1f6f4f6555d6dc8f4f", "html_url": "https://github.com/Rust-GCC/gccrs/commit/8a0dd2bd98150b79962f6f1f6f4f6555d6dc8f4f"}], "stats": {"total": 39, "additions": 16, "deletions": 23}, "files": [{"sha": "46ec86704151374451b2ccfed94b9f2d03b13b69", "filename": ".github/workflows/docker.yml", "status": "modified", "additions": 16, "deletions": 23, "changes": 39, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/faafe0fb1183baa12fec2d1fde4f81b625a2c554/.github%2Fworkflows%2Fdocker.yml", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/faafe0fb1183baa12fec2d1fde4f81b625a2c554/.github%2Fworkflows%2Fdocker.yml", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/.github%2Fworkflows%2Fdocker.yml?ref=faafe0fb1183baa12fec2d1fde4f81b625a2c554", "patch": "@@ -5,29 +5,22 @@ on:\n     branches: [ master ]\n \n jobs:\n-  push_to_registry:\n-    name: Push Docker image to Docker Hub\n+  build:\n     runs-on: ubuntu-latest\n     steps:\n-      - name: Check out the repo\n+      - name: git checkout\n         uses: actions/checkout@v2\n-      \n-      - name: Log in to Docker Hub\n-        uses: docker/login-action@f054a8b539a109f9f41c372932f1ae047eff08c9\n-        with:\n-          username: ${{ secrets.DOCKER_USERNAME }}\n-          password: ${{ secrets.DOCKER_PASSWORD }}\n-      \n-      - name: Extract metadata (tags, labels) for Docker\n-        id: meta\n-        uses: docker/metadata-action@98669ae865ea3cffbcbaa878cf57c20bbf1c6c38\n-        with:\n-          images: philberty/gccrs\n-      \n-      - name: Build and push Docker image\n-        uses: docker/build-push-action@ad44023a93711e3deb337508980b4b5e9bcdc5dc\n-        with:\n-          context: .\n-          push: true\n-          tags: ${{ steps.meta.outputs.tags }}\n-          labels: ${{ steps.meta.outputs.labels }}\n+\n+      - name: docker login\n+        env:\n+          DOCKER_USER: ${{ secrets.DOCKER_USERNAME }}\n+          DOCKER_PASSWORD: ${{ secrets.DOCKER_PASSWORD }}\n+        run: |\n+          docker login -u $DOCKER_USER -p $DOCKER_PASSWORD\n+\n+      - name: docker build\n+        run: docker build .\n+\n+      - name: docker push\n+        run: docker push ${{secrets.DOCKER_USER}}/gccrs\n+"}]}