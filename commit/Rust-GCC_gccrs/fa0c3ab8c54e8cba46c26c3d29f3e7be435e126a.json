{"sha": "fa0c3ab8c54e8cba46c26c3d29f3e7be435e126a", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6ZmEwYzNhYjhjNTRlOGNiYTQ2YzI2YzNkMjlmM2U3YmU0MzVlMTI2YQ==", "commit": {"author": {"name": "Yannick Moy", "email": "moy@adacore.com", "date": "2019-08-13T08:06:55Z"}, "committer": {"name": "Pierre-Marie de Rodat", "email": "pmderodat@gcc.gnu.org", "date": "2019-08-13T08:06:55Z"}, "message": "[Ada] Avoid spurious errors on dimensionality checking in GNATprove\n\nComplete the partial treatment that was started in r273405.  Instead of\nchecking for the special case of nodes inside inlined bodies at the call\nsite, check for this condition inside the top-level procedures called\nfor dimensionality checking.\n\nThere is no impact on compilation.\n\n2019-08-13  Yannick Moy  <moy@adacore.com>\n\ngcc/ada/\n\n\t* sem_dim.adb (Analyze_Dimension,\n\tAnalyze_Dimension_Array_Aggregate, Analyze_Dimension_Call,\n\tAnalyze_Dimension_Extension_Or_Record_Aggregate): Return\n\timmediately when inside an inlined body.\n\t* sem_res.adb (Resolve_Call): Remove special checking now done\n\tinside Analyze_Dimension_Call.\n\nFrom-SVN: r274339", "tree": {"sha": "11e38229b6417efe1a0d40a55bdf112c4128a9df", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/11e38229b6417efe1a0d40a55bdf112c4128a9df"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/fa0c3ab8c54e8cba46c26c3d29f3e7be435e126a", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/fa0c3ab8c54e8cba46c26c3d29f3e7be435e126a", "html_url": "https://github.com/Rust-GCC/gccrs/commit/fa0c3ab8c54e8cba46c26c3d29f3e7be435e126a", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/fa0c3ab8c54e8cba46c26c3d29f3e7be435e126a/comments", "author": {"login": "yannickmoy", "id": 859440, "node_id": "MDQ6VXNlcjg1OTQ0MA==", "avatar_url": "https://avatars.githubusercontent.com/u/859440?v=4", "gravatar_id": "", "url": "https://api.github.com/users/yannickmoy", "html_url": "https://github.com/yannickmoy", "followers_url": "https://api.github.com/users/yannickmoy/followers", "following_url": "https://api.github.com/users/yannickmoy/following{/other_user}", "gists_url": "https://api.github.com/users/yannickmoy/gists{/gist_id}", "starred_url": "https://api.github.com/users/yannickmoy/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/yannickmoy/subscriptions", "organizations_url": "https://api.github.com/users/yannickmoy/orgs", "repos_url": "https://api.github.com/users/yannickmoy/repos", "events_url": "https://api.github.com/users/yannickmoy/events{/privacy}", "received_events_url": "https://api.github.com/users/yannickmoy/received_events", "type": "User", "site_admin": false}, "committer": null, "parents": [{"sha": "943c82d7b9bc15161ac344953b2deb0a4121b279", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/943c82d7b9bc15161ac344953b2deb0a4121b279", "html_url": "https://github.com/Rust-GCC/gccrs/commit/943c82d7b9bc15161ac344953b2deb0a4121b279"}], "stats": {"total": 33, "additions": 25, "deletions": 8}, "files": [{"sha": "9ae91db8491eb3a83bfa7c1d719e5e2447e5c489", "filename": "gcc/ada/ChangeLog", "status": "modified", "additions": 9, "deletions": 0, "changes": 9, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/fa0c3ab8c54e8cba46c26c3d29f3e7be435e126a/gcc%2Fada%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/fa0c3ab8c54e8cba46c26c3d29f3e7be435e126a/gcc%2Fada%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fada%2FChangeLog?ref=fa0c3ab8c54e8cba46c26c3d29f3e7be435e126a", "patch": "@@ -1,3 +1,12 @@\n+2019-08-13  Yannick Moy  <moy@adacore.com>\n+\n+\t* sem_dim.adb (Analyze_Dimension,\n+\tAnalyze_Dimension_Array_Aggregate, Analyze_Dimension_Call,\n+\tAnalyze_Dimension_Extension_Or_Record_Aggregate): Return\n+\timmediately when inside an inlined body.\n+\t* sem_res.adb (Resolve_Call): Remove special checking now done\n+\tinside Analyze_Dimension_Call.\n+\n 2019-08-13  Justin Squirek  <squirek@adacore.com>\n \n \t* exp_ch4.adb (Expand_N_Allocator): Add condition to detect"}, {"sha": "177902f333d68911cb8b8df8bf8e082f55a3ed33", "filename": "gcc/ada/sem_dim.adb", "status": "modified", "additions": 15, "deletions": 5, "changes": 20, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/fa0c3ab8c54e8cba46c26c3d29f3e7be435e126a/gcc%2Fada%2Fsem_dim.adb", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/fa0c3ab8c54e8cba46c26c3d29f3e7be435e126a/gcc%2Fada%2Fsem_dim.adb", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fada%2Fsem_dim.adb?ref=fa0c3ab8c54e8cba46c26c3d29f3e7be435e126a", "patch": "@@ -1142,6 +1142,11 @@ package body Sem_Dim is\n       if Ada_Version < Ada_2012 then\n          return;\n \n+      --  Inlined bodies have already been checked for dimensionality\n+\n+      elsif In_Inlined_Body then\n+         return;\n+\n       elsif not Comes_From_Source (N) then\n          if Nkind_In (N, N_Explicit_Dereference,\n                          N_Identifier,\n@@ -1245,10 +1250,13 @@ package body Sem_Dim is\n       --  Aspect is an Ada 2012 feature. Nothing to do here if the component\n       --  base type is not a dimensioned type.\n \n+      --  Inlined bodies have already been checked for dimensionality.\n+\n       --  Note that here the original node must come from source since the\n       --  original array aggregate may not have been entirely decorated.\n \n       if Ada_Version < Ada_2012\n+        or else In_Inlined_Body\n         or else not Comes_From_Source (Original_Node (N))\n         or else not Has_Dimension_System (Base_Type (Comp_Typ))\n       then\n@@ -1634,10 +1642,11 @@ package body Sem_Dim is\n \n    begin\n       --  Aspect is an Ada 2012 feature. Note that there is no need to check\n-      --  dimensions for calls that don't come from source, or those that may\n-      --  have semantic errors.\n+      --  dimensions for calls in inlined bodies, or calls that don't come\n+      --  from source, or those that may have semantic errors.\n \n       if Ada_Version < Ada_2012\n+        or else In_Inlined_Body\n         or else not Comes_From_Source (N)\n         or else Error_Posted (N)\n       then\n@@ -1966,11 +1975,12 @@ package body Sem_Dim is\n \n    begin\n       --  Aspect is an Ada 2012 feature. Note that there is no need to check\n-      --  dimensions for aggregates that don't come from source, or if we are\n-      --  within an initialization procedure, whose expressions have been\n-      --  checked at the point of record declaration.\n+      --  dimensions in inlined bodies, or for aggregates that don't come\n+      --  from source, or if we are within an initialization procedure, whose\n+      --  expressions have been checked at the point of record declaration.\n \n       if Ada_Version < Ada_2012\n+        or else In_Inlined_Body\n         or else not Comes_From_Source (N)\n         or else Inside_Init_Proc\n       then"}, {"sha": "759887ccd311d99aaa0ef20360ae20996c47ed3f", "filename": "gcc/ada/sem_res.adb", "status": "modified", "additions": 1, "deletions": 3, "changes": 4, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/fa0c3ab8c54e8cba46c26c3d29f3e7be435e126a/gcc%2Fada%2Fsem_res.adb", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/fa0c3ab8c54e8cba46c26c3d29f3e7be435e126a/gcc%2Fada%2Fsem_res.adb", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fada%2Fsem_res.adb?ref=fa0c3ab8c54e8cba46c26c3d29f3e7be435e126a", "patch": "@@ -6952,9 +6952,7 @@ package body Sem_Res is\n       --  Check the dimensions of the actuals in the call. For function calls,\n       --  propagate the dimensions from the returned type to N.\n \n-      if not In_Inlined_Body then\n-         Analyze_Dimension_Call (N, Nam);\n-      end if;\n+      Analyze_Dimension_Call (N, Nam);\n \n       --  All done, evaluate call and deal with elaboration issues\n "}]}