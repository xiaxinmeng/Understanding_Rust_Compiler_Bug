{"sha": "5828c09abe00cce5ddff7eefef274c48021c72c9", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6NTgyOGMwOWFiZTAwY2NlNWRkZmY3ZWVmZWYyNzRjNDgwMjFjNzJjOQ==", "commit": {"author": {"name": "Bernd Edlinger", "email": "bernd.edlinger@hotmail.de", "date": "2018-07-16T18:03:15Z"}, "committer": {"name": "Bernd Edlinger", "email": "edlinger@gcc.gnu.org", "date": "2018-07-16T18:03:15Z"}, "message": "re PR middle-end/86528 (strlen of constant string malfunction -- had to back out fix for PR middle-end/77357)\n\ngcc:\n2018-07-16  Bernd Edlinger  <bernd.edlinger@hotmail.de>\n\n        PR middle-end/86528\n        * builtins.c (check_access): Bail out if range[0] is no INTEGER_CST.\n        * expr.c (string_constant): Fix the element size of ARRAY_TYPE.\n\ntestsuite:\n2018-07-16  Bernd Edlinger  <bernd.edlinger@hotmail.de>\n\n        PR middle-end/86528\n        * gcc.c-torture/execute/pr86528.c: New test.\n        * gcc.dg/Wrestrict-10.c (test_arr_strcat_2): Fix typo.\n\nFrom-SVN: r262742", "tree": {"sha": "02407fe16cba02310f6f45f81b7d684f739a7be5", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/02407fe16cba02310f6f45f81b7d684f739a7be5"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/5828c09abe00cce5ddff7eefef274c48021c72c9", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/5828c09abe00cce5ddff7eefef274c48021c72c9", "html_url": "https://github.com/Rust-GCC/gccrs/commit/5828c09abe00cce5ddff7eefef274c48021c72c9", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/5828c09abe00cce5ddff7eefef274c48021c72c9/comments", "author": {"login": "bernd-edlinger", "id": 17638929, "node_id": "MDQ6VXNlcjE3NjM4OTI5", "avatar_url": "https://avatars.githubusercontent.com/u/17638929?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bernd-edlinger", "html_url": "https://github.com/bernd-edlinger", "followers_url": "https://api.github.com/users/bernd-edlinger/followers", "following_url": "https://api.github.com/users/bernd-edlinger/following{/other_user}", "gists_url": "https://api.github.com/users/bernd-edlinger/gists{/gist_id}", "starred_url": "https://api.github.com/users/bernd-edlinger/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bernd-edlinger/subscriptions", "organizations_url": "https://api.github.com/users/bernd-edlinger/orgs", "repos_url": "https://api.github.com/users/bernd-edlinger/repos", "events_url": "https://api.github.com/users/bernd-edlinger/events{/privacy}", "received_events_url": "https://api.github.com/users/bernd-edlinger/received_events", "type": "User", "site_admin": false}, "committer": null, "parents": [{"sha": "b8c9cad352b8c40693dd7f6b15aec17bfb37c2a1", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/b8c9cad352b8c40693dd7f6b15aec17bfb37c2a1", "html_url": "https://github.com/Rust-GCC/gccrs/commit/b8c9cad352b8c40693dd7f6b15aec17bfb37c2a1"}], "stats": {"total": 43, "additions": 40, "deletions": 3}, "files": [{"sha": "8fe8dfce28352ba532b378fa8e8a59e7a02b4c07", "filename": "gcc/ChangeLog", "status": "modified", "additions": 6, "deletions": 0, "changes": 6, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/5828c09abe00cce5ddff7eefef274c48021c72c9/gcc%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/5828c09abe00cce5ddff7eefef274c48021c72c9/gcc%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2FChangeLog?ref=5828c09abe00cce5ddff7eefef274c48021c72c9", "patch": "@@ -1,3 +1,9 @@\n+2018-07-16  Bernd Edlinger  <bernd.edlinger@hotmail.de>\n+\n+\tPR middle-end/86528\n+\t* builtins.c (check_access): Bail out if range[0] is no INTEGER_CST.\n+\t* expr.c (string_constant): Fix the element size of ARRAY_TYPE.\n+\n 2018-07-16  Kelvin Nilsen  <kelvin@gcc.gnu.org>\n \n \t* doc/extend.texi (PowerPC AltiVec Built-in Functions):"}, {"sha": "c041641caa4f74cf9555b7afb1818f207450904f", "filename": "gcc/builtins.c", "status": "modified", "additions": 4, "deletions": 0, "changes": 4, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/5828c09abe00cce5ddff7eefef274c48021c72c9/gcc%2Fbuiltins.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/5828c09abe00cce5ddff7eefef274c48021c72c9/gcc%2Fbuiltins.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fbuiltins.c?ref=5828c09abe00cce5ddff7eefef274c48021c72c9", "patch": "@@ -3192,6 +3192,10 @@ check_access (tree exp, tree, tree, tree dstwrite,\n   if (dstwrite)\n     get_size_range (dstwrite, range);\n \n+  /* This can happen at -O0.  */\n+  if (range[0] && TREE_CODE (range[0]) != INTEGER_CST)\n+    return false;\n+\n   tree func = get_callee_fndecl (exp);\n \n   /* First check the number of bytes to be written against the maximum"}, {"sha": "f665e187ebbbc7874ec88e84ca47ed991491c3e5", "filename": "gcc/expr.c", "status": "modified", "additions": 3, "deletions": 1, "changes": 4, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/5828c09abe00cce5ddff7eefef274c48021c72c9/gcc%2Fexpr.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/5828c09abe00cce5ddff7eefef274c48021c72c9/gcc%2Fexpr.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fexpr.c?ref=5828c09abe00cce5ddff7eefef274c48021c72c9", "patch": "@@ -11341,7 +11341,9 @@ string_constant (tree arg, tree *ptr_offset)\n   tree offset = wide_int_to_tree (sizetype, base_off);\n   if (varidx)\n     {\n-      if (tree eltsize = TYPE_SIZE_UNIT (TREE_TYPE (array)))\n+      if (TREE_CODE (TREE_TYPE (array)) != ARRAY_TYPE)\n+\treturn NULL_TREE;\n+      if (tree eltsize = TYPE_SIZE_UNIT (TREE_TYPE (TREE_TYPE (array))))\n \t{\n \t  /* Add the scaled variable index to the constant offset.  */\n \t  tree eltoff = fold_build2 (MULT_EXPR, TREE_TYPE (offset),"}, {"sha": "854d28ef6798c85d3b5ef4bf5c1c0e0b42257280", "filename": "gcc/testsuite/ChangeLog", "status": "modified", "additions": 6, "deletions": 0, "changes": 6, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/5828c09abe00cce5ddff7eefef274c48021c72c9/gcc%2Ftestsuite%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/5828c09abe00cce5ddff7eefef274c48021c72c9/gcc%2Ftestsuite%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2FChangeLog?ref=5828c09abe00cce5ddff7eefef274c48021c72c9", "patch": "@@ -1,3 +1,9 @@\n+2018-07-16  Bernd Edlinger  <bernd.edlinger@hotmail.de>\n+\n+\tPR middle-end/86528\n+\t* gcc.c-torture/execute/pr86528.c: New test.\n+\t* gcc.dg/Wrestrict-10.c (test_arr_strcat_2): Fix typo.\n+\n 2018-07-16  Paolo Carlini  <paolo.carlini@oracle.com>\n \n \t* g++.dg/template/spec40.C: New."}, {"sha": "2a7b0110d6476df2d3f3eb607906ce02e70b89fb", "filename": "gcc/testsuite/gcc.c-torture/execute/pr86528.c", "status": "added", "additions": 20, "deletions": 0, "changes": 20, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/5828c09abe00cce5ddff7eefef274c48021c72c9/gcc%2Ftestsuite%2Fgcc.c-torture%2Fexecute%2Fpr86528.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/5828c09abe00cce5ddff7eefef274c48021c72c9/gcc%2Ftestsuite%2Fgcc.c-torture%2Fexecute%2Fpr86528.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgcc.c-torture%2Fexecute%2Fpr86528.c?ref=5828c09abe00cce5ddff7eefef274c48021c72c9", "patch": "@@ -0,0 +1,20 @@\n+/* PR middle-end/86528 */\n+\n+void __attribute__((noinline, noclone))\n+test(char *data, __SIZE_TYPE__ len)\n+{\n+    static char const appended[] = \"/./\";\n+    char *buf = __builtin_alloca (len + sizeof appended);\n+    __builtin_memcpy (buf, data, len);\n+    __builtin_strcpy (buf + len, &appended[data[len - 1] == '/']);\n+    if (__builtin_strcmp(buf, \"test1234/./\"))\n+        __builtin_abort();\n+}\n+\n+int\n+main()\n+{\n+   char *arg = \"test1234/\";\n+   test(arg, __builtin_strlen(arg));\n+   return 0;\n+}"}, {"sha": "8bdabdb033b5269a86e22e091485fac31038244b", "filename": "gcc/testsuite/gcc.dg/Wrestrict-10.c", "status": "modified", "additions": 1, "deletions": 2, "changes": 3, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/5828c09abe00cce5ddff7eefef274c48021c72c9/gcc%2Ftestsuite%2Fgcc.dg%2FWrestrict-10.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/5828c09abe00cce5ddff7eefef274c48021c72c9/gcc%2Ftestsuite%2Fgcc.dg%2FWrestrict-10.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgcc.dg%2FWrestrict-10.c?ref=5828c09abe00cce5ddff7eefef274c48021c72c9", "patch": "@@ -39,8 +39,7 @@ test_arr_strcat_1 (void)\n void __attribute__ ((noclone, noinline))\n test_arr_strcat_2 (void)\n {\n-  /* This probably deserves a warning.  */\n-  strcpy (b.a, &b.a[i]);\n+  strcat (b.a, &b.a[i]);            /* { dg-warning \"\\\\\\[-Wrestrict\" } */\n }\n \n void __attribute__ ((noclone, noinline))"}]}