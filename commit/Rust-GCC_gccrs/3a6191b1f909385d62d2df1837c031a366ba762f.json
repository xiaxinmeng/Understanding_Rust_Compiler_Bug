{"sha": "3a6191b1f909385d62d2df1837c031a366ba762f", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6M2E2MTkxYjFmOTA5Mzg1ZDYyZDJkZjE4MzdjMDMxYTM2NmJhNzYyZg==", "commit": {"author": {"name": "Jakub Jelinek", "email": "jakub@redhat.com", "date": "2010-03-24T16:50:11Z"}, "committer": {"name": "Jakub Jelinek", "email": "jakub@gcc.gnu.org", "date": "2010-03-24T16:50:11Z"}, "message": "re PR debug/43479 (Missing DW_TAG_lexical_block+DW_TAG_variable)\n\n\tPR debug/43479\n\t* ira.c (adjust_cleared_regs): New function.\n\t(update_equiv_regs): Adjust cleared_regs in DEBUG_INSNs.\n\nFrom-SVN: r157702", "tree": {"sha": "f6c43bec236d3651d319f9bfbf4ace3a1a1e4c59", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/f6c43bec236d3651d319f9bfbf4ace3a1a1e4c59"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/3a6191b1f909385d62d2df1837c031a366ba762f", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/3a6191b1f909385d62d2df1837c031a366ba762f", "html_url": "https://github.com/Rust-GCC/gccrs/commit/3a6191b1f909385d62d2df1837c031a366ba762f", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/3a6191b1f909385d62d2df1837c031a366ba762f/comments", "author": {"login": "jakubjelinek", "id": 9370665, "node_id": "MDQ6VXNlcjkzNzA2NjU=", "avatar_url": "https://avatars.githubusercontent.com/u/9370665?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jakubjelinek", "html_url": "https://github.com/jakubjelinek", "followers_url": "https://api.github.com/users/jakubjelinek/followers", "following_url": "https://api.github.com/users/jakubjelinek/following{/other_user}", "gists_url": "https://api.github.com/users/jakubjelinek/gists{/gist_id}", "starred_url": "https://api.github.com/users/jakubjelinek/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jakubjelinek/subscriptions", "organizations_url": "https://api.github.com/users/jakubjelinek/orgs", "repos_url": "https://api.github.com/users/jakubjelinek/repos", "events_url": "https://api.github.com/users/jakubjelinek/events{/privacy}", "received_events_url": "https://api.github.com/users/jakubjelinek/received_events", "type": "User", "site_admin": false}, "committer": null, "parents": [{"sha": "bff0b1a6df2f43750d5b4c6eeb02b0e9ad15fc30", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/bff0b1a6df2f43750d5b4c6eeb02b0e9ad15fc30", "html_url": "https://github.com/Rust-GCC/gccrs/commit/bff0b1a6df2f43750d5b4c6eeb02b0e9ad15fc30"}], "stats": {"total": 52, "additions": 44, "deletions": 8}, "files": [{"sha": "d11614ad57427f71bae8b83dc02b8f645c7c6a9f", "filename": "gcc/ChangeLog", "status": "modified", "additions": 4, "deletions": 0, "changes": 4, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/3a6191b1f909385d62d2df1837c031a366ba762f/gcc%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/3a6191b1f909385d62d2df1837c031a366ba762f/gcc%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2FChangeLog?ref=3a6191b1f909385d62d2df1837c031a366ba762f", "patch": "@@ -1,5 +1,9 @@\n 2010-03-24  Jakub Jelinek  <jakub@redhat.com>\n \n+\tPR debug/43479\n+\t* ira.c (adjust_cleared_regs): New function.\n+\t(update_equiv_regs): Adjust cleared_regs in DEBUG_INSNs.\n+\n \tPR debug/19192\n \tPR debug/43479\n \t* cfgexpand.c (gimple_assign_rhs_to_tree): Also set TREE_BLOCK"}, {"sha": "b4397c884f307b017be0e2588787774fe6babf36", "filename": "gcc/ira.c", "status": "modified", "additions": 40, "deletions": 8, "changes": 48, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/3a6191b1f909385d62d2df1837c031a366ba762f/gcc%2Fira.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/3a6191b1f909385d62d2df1837c031a366ba762f/gcc%2Fira.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fira.c?ref=3a6191b1f909385d62d2df1837c031a366ba762f", "patch": "@@ -1,5 +1,5 @@\n /* Integrated Register Allocator (IRA) entry point.\n-   Copyright (C) 2006, 2007, 2008, 2009\n+   Copyright (C) 2006, 2007, 2008, 2009, 2010\n    Free Software Foundation, Inc.\n    Contributed by Vladimir Makarov <vmakarov@redhat.com>.\n \n@@ -2282,6 +2282,22 @@ no_equiv (rtx reg, const_rtx store ATTRIBUTE_UNUSED, void *data ATTRIBUTE_UNUSED\n     }\n }\n \n+/* In DEBUG_INSN location adjust REGs from CLEARED_REGS bitmap to the\n+   equivalent replacement.  */\n+\n+static rtx\n+adjust_cleared_regs (rtx loc, const_rtx old_rtx ATTRIBUTE_UNUSED, void *data)\n+{\n+  if (REG_P (loc))\n+    {\n+      bitmap cleared_regs = (bitmap) data;\n+      if (bitmap_bit_p (cleared_regs, REGNO (loc)))\n+\treturn simplify_replace_fn_rtx (*reg_equiv[REGNO (loc)].src_p,\n+\t\t\t\t\tNULL_RTX, adjust_cleared_regs, data);\n+    }\n+  return NULL_RTX;\n+}\n+\n /* Nonzero if we recorded an equivalence for a LABEL_REF.  */\n static int recorded_label_ref;\n \n@@ -2717,13 +2733,29 @@ update_equiv_regs (void)\n     }\n \n   if (!bitmap_empty_p (cleared_regs))\n-    FOR_EACH_BB (bb)\n-      {\n-\tbitmap_and_compl_into (DF_LIVE_IN (bb), cleared_regs);\n-\tbitmap_and_compl_into (DF_LIVE_OUT (bb), cleared_regs);\n-\tbitmap_and_compl_into (DF_LR_IN (bb), cleared_regs);\n-\tbitmap_and_compl_into (DF_LR_OUT (bb), cleared_regs);\n-      }\n+    {\n+      FOR_EACH_BB (bb)\n+\t{\n+\t  bitmap_and_compl_into (DF_LIVE_IN (bb), cleared_regs);\n+\t  bitmap_and_compl_into (DF_LIVE_OUT (bb), cleared_regs);\n+\t  bitmap_and_compl_into (DF_LR_IN (bb), cleared_regs);\n+\t  bitmap_and_compl_into (DF_LR_OUT (bb), cleared_regs);\n+\t}\n+\n+      /* Last pass - adjust debug insns referencing cleared regs.  */\n+      if (MAY_HAVE_DEBUG_INSNS)\n+\tfor (insn = get_insns (); insn; insn = NEXT_INSN (insn))\n+\t  if (DEBUG_INSN_P (insn))\n+\t    {\n+\t      rtx old_loc = INSN_VAR_LOCATION_LOC (insn);\n+\t      INSN_VAR_LOCATION_LOC (insn)\n+\t\t= simplify_replace_fn_rtx (old_loc, NULL_RTX,\n+\t\t\t\t\t   adjust_cleared_regs,\n+\t\t\t\t\t   (void *) cleared_regs);\n+\t      if (old_loc != INSN_VAR_LOCATION_LOC (insn))\n+\t\tdf_insn_rescan (insn);\n+\t    }\n+    }\n \n   BITMAP_FREE (cleared_regs);\n "}]}