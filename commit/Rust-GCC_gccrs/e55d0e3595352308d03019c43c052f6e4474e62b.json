{"sha": "e55d0e3595352308d03019c43c052f6e4474e62b", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6ZTU1ZDBlMzU5NTM1MjMwOGQwMzAxOWM0M2MwNTJmNmU0NDc0ZTYyYg==", "commit": {"author": {"name": "Benjamin Kosnik", "email": "bkoz@redhat.com", "date": "2008-04-25T18:37:22Z"}, "committer": {"name": "Benjamin Kosnik", "email": "bkoz@gcc.gnu.org", "date": "2008-04-25T18:37:22Z"}, "message": "re PR libstdc++/35887 (stl parallel includes installed for --disable-libgomp)\n\n2008-04-25  Benjamin Kosnik  <bkoz@redhat.com>\n\n\tPR libstdc++/35887\n\t* acinclude.m4: (GLIBCXX_ENABLE_PARALLEL): Check for thread support.\n\t* configure.ac: Re-order compiler macros.\n\t* configure: Regenerated.\n\nFrom-SVN: r134675", "tree": {"sha": "55687f11c55f3bb14acecd907f8d8d92389f7781", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/55687f11c55f3bb14acecd907f8d8d92389f7781"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/e55d0e3595352308d03019c43c052f6e4474e62b", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/e55d0e3595352308d03019c43c052f6e4474e62b", "html_url": "https://github.com/Rust-GCC/gccrs/commit/e55d0e3595352308d03019c43c052f6e4474e62b", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/e55d0e3595352308d03019c43c052f6e4474e62b/comments", "author": null, "committer": null, "parents": [{"sha": "d116398717ba3d7a32fb4065c8ee347405380482", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/d116398717ba3d7a32fb4065c8ee347405380482", "html_url": "https://github.com/Rust-GCC/gccrs/commit/d116398717ba3d7a32fb4065c8ee347405380482"}], "stats": {"total": 850, "additions": 434, "deletions": 416}, "files": [{"sha": "23057295399df1760c1de0c5c341a1c5f434dfd8", "filename": "libstdc++-v3/ChangeLog", "status": "modified", "additions": 10, "deletions": 3, "changes": 13, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/e55d0e3595352308d03019c43c052f6e4474e62b/libstdc%2B%2B-v3%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/e55d0e3595352308d03019c43c052f6e4474e62b/libstdc%2B%2B-v3%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libstdc%2B%2B-v3%2FChangeLog?ref=e55d0e3595352308d03019c43c052f6e4474e62b", "patch": "@@ -1,6 +1,13 @@\n+2008-04-25  Benjamin Kosnik  <bkoz@redhat.com>\n+\n+\tPR libstdc++/35887\n+\t* acinclude.m4: (GLIBCXX_ENABLE_PARALLEL): Check for thread support.\n+\t* configure.ac: Re-order compiler macros.\n+\t* configure: Regenerated.\n+\n 2008-04-24  Benjamin Kosnik  <bkoz@redhat.com>\n \n-\tPR libstdc++/35887 \n+\tPR libstdc++/35887\n \t* configure.ac: Add default argument to GLIBCXX_ENABLE_PARALLEL.\n \tMove atomic warnings to GLIBCXX_ENABLE_ATOMIC_BUILTINS.\n \t* acinclude.m4 (GLIBCXX_ENABLE_PARALLEL): Check for --disable-libgomp.\n@@ -9,7 +16,7 @@\n \t* include/Makefile.am (parallel_headers): Make conditional on\n \tENABLE_PARALLEL.\n \t* include/Makefile.in: Regenerate.\n-\t\n+\n 2008-04-24  Paolo Carlini  <pcarlini@suse.de>\n \n \tPR libstdc++/35969\n@@ -30,7 +37,7 @@\n \t* include/ext/atomicity.h: Use  _GLIBCXX_ATOMIC_BUILTINS_4.\n \t* libsupc++/guard.cc: Use  _GLIBCXX_ATOMIC_BUILTINS_4.\n \t* doc/xml/manual/concurrency.xm: Update docs.\n-\t\n+\n 2008-04-23  Benjamin Kosnik  <bkoz@redhat.com>\n \n \t* config/os/hpux/os_defines.h: Use _GLIBCXX_BEGIN_NAMESPACE,"}, {"sha": "0b76efcc46b384beee5dfe9da4ad7689fa34c937", "filename": "libstdc++-v3/acinclude.m4", "status": "modified", "additions": 13, "deletions": 8, "changes": 21, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/e55d0e3595352308d03019c43c052f6e4474e62b/libstdc%2B%2B-v3%2Facinclude.m4", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/e55d0e3595352308d03019c43c052f6e4474e62b/libstdc%2B%2B-v3%2Facinclude.m4", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libstdc%2B%2B-v3%2Facinclude.m4?ref=e55d0e3595352308d03019c43c052f6e4474e62b", "patch": "@@ -1748,14 +1748,19 @@ AC_DEFUN([GLIBCXX_ENABLE_PARALLEL], [\n \n   enable_parallel=no;\n \n-  # Check to see if OpenMP is explicitly disabled.\n-  AC_MSG_CHECKING([for libgomp support])\n-  GLIBCXX_ENABLE(libgomp,$1,,[enable code depending on libgomp],[permit yes|no])\n-  AC_MSG_RESULT([$enable_libgomp])\n-  if test x$enable_libgomp = xno; then\n-    enable_parallel=no\n-  else\n-    enable_parallel=yes\n+  # Check to see if threads are disabled.\n+  # Requires GLIBCXX_ENABLE_THREADS.\n+  if test x$enable_thread = xyes; then\n+\n+    # Check to see if OpenMP is disabled.\n+    AC_MSG_CHECKING([for libgomp support])\n+    GLIBCXX_ENABLE(libgomp,$1,,[enable code depending on libgomp],\n+                   [permit yes|no])\n+    AC_MSG_RESULT([$enable_libgomp])\n+    if test x$enable_libgomp = xyes; then\n+      enable_parallel=yes\n+    fi\n+\n   fi\n \n   AC_MSG_CHECKING([for parallel mode support])"}, {"sha": "ded1ca36a6630655f6425bd368ad239c390f86a1", "filename": "libstdc++-v3/configure", "status": "modified", "additions": 405, "deletions": 400, "changes": 805, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/e55d0e3595352308d03019c43c052f6e4474e62b/libstdc%2B%2B-v3%2Fconfigure", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/e55d0e3595352308d03019c43c052f6e4474e62b/libstdc%2B%2B-v3%2Fconfigure", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libstdc%2B%2B-v3%2Fconfigure?ref=e55d0e3595352308d03019c43c052f6e4474e62b", "patch": "@@ -458,7 +458,7 @@ ac_includes_default=\"\\\n # include <unistd.h>\n #endif\"\n \n-ac_subst_vars='SHELL PATH_SEPARATOR PACKAGE_NAME PACKAGE_TARNAME PACKAGE_VERSION PACKAGE_STRING PACKAGE_BUGREPORT exec_prefix prefix program_transform_name bindir sbindir libexecdir datadir sysconfdir sharedstatedir localstatedir libdir includedir oldincludedir infodir mandir build_alias host_alias target_alias DEFS ECHO_C ECHO_N ECHO_T LIBS libtool_VERSION multi_basedir build build_cpu build_vendor build_os host host_cpu host_vendor host_os target target_cpu target_vendor target_os INSTALL_PROGRAM INSTALL_SCRIPT INSTALL_DATA CYGPATH_W PACKAGE VERSION ACLOCAL AUTOCONF AUTOMAKE AUTOHEADER MAKEINFO install_sh STRIP ac_ct_STRIP INSTALL_STRIP_PROGRAM mkdir_p AWK SET_MAKE am__leading_dot AMTAR am__tar am__untar glibcxx_builddir glibcxx_srcdir toplevel_srcdir CC ac_ct_CC EXEEXT OBJEXT CXX ac_ct_CXX CFLAGS CXXFLAGS LN_S AS ac_ct_AS AR ac_ct_AR RANLIB ac_ct_RANLIB MAINTAINER_MODE_TRUE MAINTAINER_MODE_FALSE MAINT CPP CPPFLAGS EGREP LIBTOOL SED FGREP GREP LD DUMPBIN ac_ct_DUMPBIN NM lt_ECHO LDFLAGS CXXCPP enable_shared enable_static GLIBCXX_HOSTED_TRUE GLIBCXX_HOSTED_FALSE GLIBCXX_BUILD_PCH_TRUE GLIBCXX_BUILD_PCH_FALSE glibcxx_PCHFLAGS CSTDIO_H BASIC_FILE_H BASIC_FILE_CC check_msgfmt glibcxx_MOFILES glibcxx_POFILES glibcxx_localedir USE_NLS CLOCALE_H CMESSAGES_H CCODECVT_CC CCOLLATE_CC CCTYPE_CC CMESSAGES_CC CMONEY_CC CNUMERIC_CC CTIME_H CTIME_CC CLOCALE_CC CLOCALE_INTERNAL_H ALLOCATOR_H ALLOCATOR_NAME C_INCLUDE_DIR GLIBCXX_C_HEADERS_C_TRUE GLIBCXX_C_HEADERS_C_FALSE GLIBCXX_C_HEADERS_C_STD_TRUE GLIBCXX_C_HEADERS_C_STD_FALSE GLIBCXX_C_HEADERS_C_GLOBAL_TRUE GLIBCXX_C_HEADERS_C_GLOBAL_FALSE GLIBCXX_C_HEADERS_COMPATIBILITY_TRUE GLIBCXX_C_HEADERS_COMPATIBILITY_FALSE GLIBCXX_C_HEADERS_EXTRA_TRUE GLIBCXX_C_HEADERS_EXTRA_FALSE DEBUG_FLAGS GLIBCXX_BUILD_DEBUG_TRUE GLIBCXX_BUILD_DEBUG_FALSE ENABLE_PARALLEL_TRUE ENABLE_PARALLEL_FALSE EXTRA_CXX_FLAGS glibcxx_thread_h WERROR SECTION_FLAGS SECTION_LDFLAGS OPT_LDFLAGS LIBMATHOBJS LIBICONV LTLIBICONV SYMVER_FILE port_specific_symbol_files ENABLE_SYMVERS_TRUE ENABLE_SYMVERS_FALSE ENABLE_SYMVERS_GNU_TRUE ENABLE_SYMVERS_GNU_FALSE ENABLE_SYMVERS_GNU_NAMESPACE_TRUE ENABLE_SYMVERS_GNU_NAMESPACE_FALSE ENABLE_SYMVERS_DARWIN_TRUE ENABLE_SYMVERS_DARWIN_FALSE ENABLE_VISIBILITY_TRUE ENABLE_VISIBILITY_FALSE GLIBCXX_LDBL_COMPAT_TRUE GLIBCXX_LDBL_COMPAT_FALSE baseline_dir ATOMICITY_SRCDIR ATOMIC_WORD_SRCDIR ATOMIC_FLAGS CPU_DEFINES_SRCDIR ABI_TWEAKS_SRCDIR OS_INC_SRCDIR ERROR_CONSTANTS_SRCDIR glibcxx_prefixdir gxx_include_dir glibcxx_toolexecdir glibcxx_toolexeclibdir GLIBCXX_INCLUDES TOPLEVEL_INCLUDES OPTIMIZE_CXXFLAGS WARN_FLAGS LIBSUPCXX_PICFLAGS LIBOBJS LTLIBOBJS'\n+ac_subst_vars='SHELL PATH_SEPARATOR PACKAGE_NAME PACKAGE_TARNAME PACKAGE_VERSION PACKAGE_STRING PACKAGE_BUGREPORT exec_prefix prefix program_transform_name bindir sbindir libexecdir datadir sysconfdir sharedstatedir localstatedir libdir includedir oldincludedir infodir mandir build_alias host_alias target_alias DEFS ECHO_C ECHO_N ECHO_T LIBS libtool_VERSION multi_basedir build build_cpu build_vendor build_os host host_cpu host_vendor host_os target target_cpu target_vendor target_os INSTALL_PROGRAM INSTALL_SCRIPT INSTALL_DATA CYGPATH_W PACKAGE VERSION ACLOCAL AUTOCONF AUTOMAKE AUTOHEADER MAKEINFO install_sh STRIP ac_ct_STRIP INSTALL_STRIP_PROGRAM mkdir_p AWK SET_MAKE am__leading_dot AMTAR am__tar am__untar glibcxx_builddir glibcxx_srcdir toplevel_srcdir CC ac_ct_CC EXEEXT OBJEXT CXX ac_ct_CXX CFLAGS CXXFLAGS LN_S AS ac_ct_AS AR ac_ct_AR RANLIB ac_ct_RANLIB MAINTAINER_MODE_TRUE MAINTAINER_MODE_FALSE MAINT CPP CPPFLAGS EGREP LIBTOOL SED FGREP GREP LD DUMPBIN ac_ct_DUMPBIN NM lt_ECHO LDFLAGS CXXCPP enable_shared enable_static GLIBCXX_HOSTED_TRUE GLIBCXX_HOSTED_FALSE GLIBCXX_BUILD_PCH_TRUE GLIBCXX_BUILD_PCH_FALSE glibcxx_PCHFLAGS glibcxx_thread_h WERROR SECTION_FLAGS CSTDIO_H BASIC_FILE_H BASIC_FILE_CC check_msgfmt glibcxx_MOFILES glibcxx_POFILES glibcxx_localedir USE_NLS CLOCALE_H CMESSAGES_H CCODECVT_CC CCOLLATE_CC CCTYPE_CC CMESSAGES_CC CMONEY_CC CNUMERIC_CC CTIME_H CTIME_CC CLOCALE_CC CLOCALE_INTERNAL_H ALLOCATOR_H ALLOCATOR_NAME C_INCLUDE_DIR GLIBCXX_C_HEADERS_C_TRUE GLIBCXX_C_HEADERS_C_FALSE GLIBCXX_C_HEADERS_C_STD_TRUE GLIBCXX_C_HEADERS_C_STD_FALSE GLIBCXX_C_HEADERS_C_GLOBAL_TRUE GLIBCXX_C_HEADERS_C_GLOBAL_FALSE GLIBCXX_C_HEADERS_COMPATIBILITY_TRUE GLIBCXX_C_HEADERS_COMPATIBILITY_FALSE GLIBCXX_C_HEADERS_EXTRA_TRUE GLIBCXX_C_HEADERS_EXTRA_FALSE DEBUG_FLAGS GLIBCXX_BUILD_DEBUG_TRUE GLIBCXX_BUILD_DEBUG_FALSE ENABLE_PARALLEL_TRUE ENABLE_PARALLEL_FALSE EXTRA_CXX_FLAGS SECTION_LDFLAGS OPT_LDFLAGS LIBMATHOBJS LIBICONV LTLIBICONV SYMVER_FILE port_specific_symbol_files ENABLE_SYMVERS_TRUE ENABLE_SYMVERS_FALSE ENABLE_SYMVERS_GNU_TRUE ENABLE_SYMVERS_GNU_FALSE ENABLE_SYMVERS_GNU_NAMESPACE_TRUE ENABLE_SYMVERS_GNU_NAMESPACE_FALSE ENABLE_SYMVERS_DARWIN_TRUE ENABLE_SYMVERS_DARWIN_FALSE ENABLE_VISIBILITY_TRUE ENABLE_VISIBILITY_FALSE GLIBCXX_LDBL_COMPAT_TRUE GLIBCXX_LDBL_COMPAT_FALSE baseline_dir ATOMICITY_SRCDIR ATOMIC_WORD_SRCDIR ATOMIC_FLAGS CPU_DEFINES_SRCDIR ABI_TWEAKS_SRCDIR OS_INC_SRCDIR ERROR_CONSTANTS_SRCDIR glibcxx_prefixdir gxx_include_dir glibcxx_toolexecdir glibcxx_toolexeclibdir GLIBCXX_INCLUDES TOPLEVEL_INCLUDES OPTIMIZE_CXXFLAGS WARN_FLAGS LIBSUPCXX_PICFLAGS LIBOBJS LTLIBOBJS'\n ac_subst_files=''\n \n # Initialize some variables set by options.\n@@ -13980,6 +13980,354 @@ echo \"${ECHO_T}$enable_libstdcxx_pch\" >&6\n \n \n \n+\n+\n+  ac_ext=cc\n+ac_cpp='$CXXCPP $CPPFLAGS'\n+ac_compile='$CXX -c $CXXFLAGS $CPPFLAGS conftest.$ac_ext >&5'\n+ac_link='$CXX -o conftest$ac_exeext $CXXFLAGS $CPPFLAGS $LDFLAGS conftest.$ac_ext $LIBS >&5'\n+ac_compiler_gnu=$ac_cv_cxx_compiler_gnu\n+\n+  old_CXXFLAGS=\"$CXXFLAGS\"\n+\n+  # Compile unoptimized.\n+  CXXFLAGS='-O0 -S'\n+\n+  # Fake what AC_TRY_COMPILE does, without linking as this is\n+  # unnecessary for a builtins test.\n+\n+    cat > conftest.$ac_ext << EOF\n+#line 14000 \"configure\"\n+int main()\n+{\n+  // NB: _Atomic_word not necessarily int.\n+  typedef int atomic_type;\n+  atomic_type c1;\n+  atomic_type c2;\n+  const atomic_type c3(0);\n+  __sync_fetch_and_add(&c1, c2);\n+  __sync_val_compare_and_swap(&c1, c3, c2);\n+  __sync_lock_test_and_set(&c1, c3);\n+  __sync_lock_release(&c1);\n+  __sync_synchronize();\n+  return 0;\n+}\n+EOF\n+\n+    echo \"$as_me:$LINENO: checking for atomic builtins for int\" >&5\n+echo $ECHO_N \"checking for atomic builtins for int... $ECHO_C\" >&6\n+    if { (eval echo \"$as_me:$LINENO: \\\"$ac_compile\\\"\") >&5\n+  (eval $ac_compile) 2>&5\n+  ac_status=$?\n+  echo \"$as_me:$LINENO: \\$? = $ac_status\" >&5\n+  (exit $ac_status); }; then\n+      if grep __sync_ conftest.s >/dev/null 2>&1 ; then\n+        enable_atomic_builtinsi=no\n+      else\n+\n+cat >>confdefs.h <<\\_ACEOF\n+#define _GLIBCXX_ATOMIC_BUILTINS_4 1\n+_ACEOF\n+\n+        enable_atomic_builtinsi=yes\n+      fi\n+    fi\n+    echo \"$as_me:$LINENO: result: $enable_atomic_builtinsi\" >&5\n+echo \"${ECHO_T}$enable_atomic_builtinsi\" >&6\n+    rm -f conftest*\n+\n+    cat > conftest.$ac_ext << EOF\n+#line 14040 \"configure\"\n+int main()\n+{\n+  typedef bool atomic_type;\n+  atomic_type c1;\n+  atomic_type c2;\n+  const atomic_type c3(0);\n+  __sync_fetch_and_add(&c1, c2);\n+  __sync_val_compare_and_swap(&c1, c3, c2);\n+  __sync_lock_test_and_set(&c1, c3);\n+  __sync_lock_release(&c1);\n+  __sync_synchronize();\n+  return 0;\n+}\n+EOF\n+\n+    echo \"$as_me:$LINENO: checking for atomic builtins for bool\" >&5\n+echo $ECHO_N \"checking for atomic builtins for bool... $ECHO_C\" >&6\n+    if { (eval echo \"$as_me:$LINENO: \\\"$ac_compile\\\"\") >&5\n+  (eval $ac_compile) 2>&5\n+  ac_status=$?\n+  echo \"$as_me:$LINENO: \\$? = $ac_status\" >&5\n+  (exit $ac_status); }; then\n+      if grep __sync_ conftest.s >/dev/null 2>&1 ; then\n+        enable_atomic_builtinsb=no\n+      else\n+\n+cat >>confdefs.h <<\\_ACEOF\n+#define _GLIBCXX_ATOMIC_BUILTINS_1 1\n+_ACEOF\n+\n+        enable_atomic_builtinsb=yes\n+      fi\n+    fi\n+    echo \"$as_me:$LINENO: result: $enable_atomic_builtinsb\" >&5\n+echo \"${ECHO_T}$enable_atomic_builtinsb\" >&6\n+    rm -f conftest*\n+\n+  CXXFLAGS=\"$old_CXXFLAGS\"\n+  ac_ext=c\n+ac_cpp='$CPP $CPPFLAGS'\n+ac_compile='$CC -c $CFLAGS $CPPFLAGS conftest.$ac_ext >&5'\n+ac_link='$CC -o conftest$ac_exeext $CFLAGS $CPPFLAGS $LDFLAGS conftest.$ac_ext $LIBS >&5'\n+ac_compiler_gnu=$ac_cv_c_compiler_gnu\n+\n+\n+  # Set atomicity_dir to builtins if either of above tests pass.\n+  if test $enable_atomic_builtinsi = yes || test $enable_atomic_builtinsb = yes ; then\n+    atomicity_dir=cpu/generic/atomicity_builtins\n+  fi\n+\n+  # If still generic, set to mutex.\n+  if test $atomicity_dir = \"cpu/generic\" ; then\n+    atomicity_dir=cpu/generic/atomicity_mutex\n+    { echo \"$as_me:$LINENO: WARNING: No native atomic operations are provided for this platform.\" >&5\n+echo \"$as_me: WARNING: No native atomic operations are provided for this platform.\" >&2;}\n+      if test $target_thread_file = single; then\n+        { echo \"$as_me:$LINENO: WARNING: They cannot be faked when thread support is disabled.\" >&5\n+echo \"$as_me: WARNING: They cannot be faked when thread support is disabled.\" >&2;}\n+        { echo \"$as_me:$LINENO: WARNING: Thread-safety of certain classes is not guaranteed.\" >&5\n+echo \"$as_me: WARNING: Thread-safety of certain classes is not guaranteed.\" >&2;}\n+      else\n+        { echo \"$as_me:$LINENO: WARNING: They will be faked using a mutex.\" >&5\n+echo \"$as_me: WARNING: They will be faked using a mutex.\" >&2;}\n+        { echo \"$as_me:$LINENO: WARNING: Performance of certain classes will degrade as a result.\" >&5\n+echo \"$as_me: WARNING: Performance of certain classes will degrade as a result.\" >&2;}\n+      fi\n+  fi\n+\n+\n+\n+  echo \"$as_me:$LINENO: checking for thread model used by GCC\" >&5\n+echo $ECHO_N \"checking for thread model used by GCC... $ECHO_C\" >&6\n+  target_thread_file=`$CXX -v 2>&1 | sed -n 's/^Thread model: //p'`\n+  echo \"$as_me:$LINENO: result: $target_thread_file\" >&5\n+echo \"${ECHO_T}$target_thread_file\" >&6\n+\n+  if test $target_thread_file != single; then\n+\n+cat >>confdefs.h <<\\_ACEOF\n+#define HAVE_GTHR_DEFAULT 1\n+_ACEOF\n+\n+  fi\n+\n+  glibcxx_thread_h=gthr-$target_thread_file.h\n+\n+    gthread_file=${toplevel_srcdir}/gcc/${glibcxx_thread_h}\n+  if grep __GTHREADS $gthread_file >/dev/null 2>&1 ; then\n+    enable_thread=yes\n+  else\n+   enable_thread=no\n+  fi\n+\n+\n+\n+\n+# Checks for compiler support that don't require linking.\n+\n+  # All these tests are for C++; save the language and the compiler flags.\n+  # The CXXFLAGS thing is suspicious, but based on similar bits previously\n+  # found in GLIBCXX_CONFIGURE.\n+\n+\n+  ac_ext=cc\n+ac_cpp='$CXXCPP $CPPFLAGS'\n+ac_compile='$CXX -c $CXXFLAGS $CPPFLAGS conftest.$ac_ext >&5'\n+ac_link='$CXX -o conftest$ac_exeext $CXXFLAGS $CPPFLAGS $LDFLAGS conftest.$ac_ext $LIBS >&5'\n+ac_compiler_gnu=$ac_cv_cxx_compiler_gnu\n+\n+  ac_test_CXXFLAGS=\"${CXXFLAGS+set}\"\n+  ac_save_CXXFLAGS=\"$CXXFLAGS\"\n+\n+  # Check for maintainer-mode bits.\n+  if test x\"$USE_MAINTAINER_MODE\" = xno; then\n+    WERROR=''\n+  else\n+    WERROR='-Werror'\n+  fi\n+\n+  # Check for -ffunction-sections -fdata-sections\n+  echo \"$as_me:$LINENO: checking for g++ that supports -ffunction-sections -fdata-sections\" >&5\n+echo $ECHO_N \"checking for g++ that supports -ffunction-sections -fdata-sections... $ECHO_C\" >&6\n+  CXXFLAGS='-g -Werror -ffunction-sections -fdata-sections'\n+  cat >conftest.$ac_ext <<_ACEOF\n+/* confdefs.h.  */\n+_ACEOF\n+cat confdefs.h >>conftest.$ac_ext\n+cat >>conftest.$ac_ext <<_ACEOF\n+/* end confdefs.h.  */\n+int foo; void bar() { };\n+int\n+main ()\n+{\n+\n+  ;\n+  return 0;\n+}\n+_ACEOF\n+rm -f conftest.$ac_objext\n+if { (eval echo \"$as_me:$LINENO: \\\"$ac_compile\\\"\") >&5\n+  (eval $ac_compile) 2>conftest.er1\n+  ac_status=$?\n+  grep -v '^ *+' conftest.er1 >conftest.err\n+  rm -f conftest.er1\n+  cat conftest.err >&5\n+  echo \"$as_me:$LINENO: \\$? = $ac_status\" >&5\n+  (exit $ac_status); } &&\n+\t { ac_try='test -z \"$ac_cxx_werror_flag\"\n+\t\t\t || test ! -s conftest.err'\n+  { (eval echo \"$as_me:$LINENO: \\\"$ac_try\\\"\") >&5\n+  (eval $ac_try) 2>&5\n+  ac_status=$?\n+  echo \"$as_me:$LINENO: \\$? = $ac_status\" >&5\n+  (exit $ac_status); }; } &&\n+\t { ac_try='test -s conftest.$ac_objext'\n+  { (eval echo \"$as_me:$LINENO: \\\"$ac_try\\\"\") >&5\n+  (eval $ac_try) 2>&5\n+  ac_status=$?\n+  echo \"$as_me:$LINENO: \\$? = $ac_status\" >&5\n+  (exit $ac_status); }; }; then\n+  ac_fdsections=yes\n+else\n+  echo \"$as_me: failed program was:\" >&5\n+sed 's/^/| /' conftest.$ac_ext >&5\n+\n+ac_fdsections=no\n+fi\n+rm -f conftest.err conftest.$ac_objext conftest.$ac_ext\n+  if test \"$ac_test_CXXFLAGS\" = set; then\n+    CXXFLAGS=\"$ac_save_CXXFLAGS\"\n+  else\n+    # this is the suspicious part\n+    CXXFLAGS=''\n+  fi\n+  if test x\"$ac_fdsections\" = x\"yes\"; then\n+    SECTION_FLAGS='-ffunction-sections -fdata-sections'\n+  fi\n+  echo \"$as_me:$LINENO: result: $ac_fdsections\" >&5\n+echo \"${ECHO_T}$ac_fdsections\" >&6\n+\n+  ac_ext=c\n+ac_cpp='$CPP $CPPFLAGS'\n+ac_compile='$CC -c $CFLAGS $CPPFLAGS conftest.$ac_ext >&5'\n+ac_link='$CC -o conftest$ac_exeext $CFLAGS $CPPFLAGS $LDFLAGS conftest.$ac_ext $LIBS >&5'\n+ac_compiler_gnu=$ac_cv_c_compiler_gnu\n+\n+\n+\n+\n+\n+\n+  echo \"$as_me:$LINENO: checking for ISO C++200x standard layout type support\" >&5\n+echo $ECHO_N \"checking for ISO C++200x standard layout type support... $ECHO_C\" >&6\n+  if test \"${ac_standard_layout+set}\" = set; then\n+  echo $ECHO_N \"(cached) $ECHO_C\" >&6\n+else\n+\n+\n+\n+  ac_ext=cc\n+ac_cpp='$CXXCPP $CPPFLAGS'\n+ac_compile='$CXX -c $CXXFLAGS $CPPFLAGS conftest.$ac_ext >&5'\n+ac_link='$CXX -o conftest$ac_exeext $CXXFLAGS $CPPFLAGS $LDFLAGS conftest.$ac_ext $LIBS >&5'\n+ac_compiler_gnu=$ac_cv_cxx_compiler_gnu\n+\n+  ac_test_CXXFLAGS=\"${CXXFLAGS+set}\"\n+  ac_save_CXXFLAGS=\"$CXXFLAGS\"\n+  CXXFLAGS='-std=gnu++0x'\n+\n+  cat >conftest.$ac_ext <<_ACEOF\n+/* confdefs.h.  */\n+_ACEOF\n+cat confdefs.h >>conftest.$ac_ext\n+cat >>conftest.$ac_ext <<_ACEOF\n+/* end confdefs.h.  */\n+struct b\n+                  {\n+  \t\t    bool t;\n+\n+\t\t    // Need standard layout relaxation from POD\n+\t\t    private:\n+  \t\t    b& operator=(const b&);\n+  \t\t    b(const b&);\n+\t\t    };\n+\n+\t\t    int main()\n+\t\t    {\n+\t\t      b tst1 = { false };\n+\t\t       return 0;\n+\t\t    }\n+int\n+main ()\n+{\n+\n+  ;\n+  return 0;\n+}\n+_ACEOF\n+rm -f conftest.$ac_objext\n+if { (eval echo \"$as_me:$LINENO: \\\"$ac_compile\\\"\") >&5\n+  (eval $ac_compile) 2>conftest.er1\n+  ac_status=$?\n+  grep -v '^ *+' conftest.er1 >conftest.err\n+  rm -f conftest.er1\n+  cat conftest.err >&5\n+  echo \"$as_me:$LINENO: \\$? = $ac_status\" >&5\n+  (exit $ac_status); } &&\n+\t { ac_try='test -z \"$ac_cxx_werror_flag\"\n+\t\t\t || test ! -s conftest.err'\n+  { (eval echo \"$as_me:$LINENO: \\\"$ac_try\\\"\") >&5\n+  (eval $ac_try) 2>&5\n+  ac_status=$?\n+  echo \"$as_me:$LINENO: \\$? = $ac_status\" >&5\n+  (exit $ac_status); }; } &&\n+\t { ac_try='test -s conftest.$ac_objext'\n+  { (eval echo \"$as_me:$LINENO: \\\"$ac_try\\\"\") >&5\n+  (eval $ac_try) 2>&5\n+  ac_status=$?\n+  echo \"$as_me:$LINENO: \\$? = $ac_status\" >&5\n+  (exit $ac_status); }; }; then\n+  ac_standard_layout=yes\n+else\n+  echo \"$as_me: failed program was:\" >&5\n+sed 's/^/| /' conftest.$ac_ext >&5\n+\n+ac_standard_layout=no\n+fi\n+rm -f conftest.err conftest.$ac_objext conftest.$ac_ext\n+\n+  CXXFLAGS=\"$ac_save_CXXFLAGS\"\n+  ac_ext=c\n+ac_cpp='$CPP $CPPFLAGS'\n+ac_compile='$CC -c $CFLAGS $CPPFLAGS conftest.$ac_ext >&5'\n+ac_link='$CC -o conftest$ac_exeext $CFLAGS $CPPFLAGS $LDFLAGS conftest.$ac_ext $LIBS >&5'\n+ac_compiler_gnu=$ac_cv_c_compiler_gnu\n+\n+\n+fi\n+\n+  echo \"$as_me:$LINENO: result: $ac_standard_layout\" >&5\n+echo \"${ECHO_T}$ac_standard_layout\" >&6\n+  if test x\"$ac_standard_layout\" = x\"yes\"; then\n+\n+cat >>confdefs.h <<\\_ACEOF\n+#define _GLIBCXX_USE_STANDARD_LAYOUT 1\n+_ACEOF\n+\n+  fi\n+\n+\n # Enable all the variable C++ runtime options that doesn't require linking.\n \n   echo \"$as_me:$LINENO: checking for underlying I/O to use\" >&5\n@@ -16909,10 +17257,14 @@ echo \"${ECHO_T}$enable_libstdcxx_debug\" >&6\n \n   enable_parallel=no;\n \n-  # Check to see if OpenMP is explicitly disabled.\n-  echo \"$as_me:$LINENO: checking for libgomp support\" >&5\n+  # Check to see if threads are disabled.\n+  # Requires GLIBCXX_ENABLE_THREADS.\n+  if test x$enable_thread = xyes; then\n+\n+    # Check to see if OpenMP is disabled.\n+    echo \"$as_me:$LINENO: checking for libgomp support\" >&5\n echo $ECHO_N \"checking for libgomp support... $ECHO_C\" >&6\n-   # Check whether --enable-libgomp or --disable-libgomp was given.\n+     # Check whether --enable-libgomp or --disable-libgomp was given.\n if test \"${enable_libgomp+set}\" = set; then\n   enableval=\"$enable_libgomp\"\n \n@@ -16927,12 +17279,12 @@ else\n   enable_libgomp=yes\n fi;\n \n-  echo \"$as_me:$LINENO: result: $enable_libgomp\" >&5\n+    echo \"$as_me:$LINENO: result: $enable_libgomp\" >&5\n echo \"${ECHO_T}$enable_libgomp\" >&6\n-  if test x$enable_libgomp = xno; then\n-    enable_parallel=no\n-  else\n-    enable_parallel=yes\n+    if test x$enable_libgomp = xyes; then\n+      enable_parallel=yes\n+    fi\n+\n   fi\n \n   echo \"$as_me:$LINENO: checking for parallel mode support\" >&5\n@@ -17805,199 +18157,43 @@ if { (eval echo \"$as_me:$LINENO: \\\"$ac_compile\\\"\") >&5\n   ac_status=$?\n   echo \"$as_me:$LINENO: \\$? = $ac_status\" >&5\n   (exit $ac_status); }; }; then\n-  glibcxx_cv_system_error13=yes\n-else\n-  echo \"$as_me: failed program was:\" >&5\n-sed 's/^/| /' conftest.$ac_ext >&5\n-\n-glibcxx_cv_system_error13=no\n-fi\n-rm -f conftest.err conftest.$ac_objext conftest.$ac_ext\n-\n-fi\n-\n-echo \"$as_me:$LINENO: result: $glibcxx_cv_system_error13\" >&5\n-echo \"${ECHO_T}$glibcxx_cv_system_error13\" >&6\n-if test x\"$glibcxx_cv_system_error13\" = x\"yes\"; then\n-\n-cat >>confdefs.h <<\\_ACEOF\n-#define HAVE_ENOTSUP 1\n-_ACEOF\n-\n-fi\n-echo \"$as_me:$LINENO: checking for EIDRM\" >&5\n-echo $ECHO_N \"checking for EIDRM... $ECHO_C\" >&6\n-if test \"${glibcxx_cv_system_error14+set}\" = set; then\n-  echo $ECHO_N \"(cached) $ECHO_C\" >&6\n-else\n-\n-cat >conftest.$ac_ext <<_ACEOF\n-/* confdefs.h.  */\n-_ACEOF\n-cat confdefs.h >>conftest.$ac_ext\n-cat >>conftest.$ac_ext <<_ACEOF\n-/* end confdefs.h.  */\n-#include <errno.h>\n-int\n-main ()\n-{\n-int i = EIDRM;\n-  ;\n-  return 0;\n-}\n-_ACEOF\n-rm -f conftest.$ac_objext\n-if { (eval echo \"$as_me:$LINENO: \\\"$ac_compile\\\"\") >&5\n-  (eval $ac_compile) 2>conftest.er1\n-  ac_status=$?\n-  grep -v '^ *+' conftest.er1 >conftest.err\n-  rm -f conftest.er1\n-  cat conftest.err >&5\n-  echo \"$as_me:$LINENO: \\$? = $ac_status\" >&5\n-  (exit $ac_status); } &&\n-\t { ac_try='test -z \"$ac_c_werror_flag\"\n-\t\t\t || test ! -s conftest.err'\n-  { (eval echo \"$as_me:$LINENO: \\\"$ac_try\\\"\") >&5\n-  (eval $ac_try) 2>&5\n-  ac_status=$?\n-  echo \"$as_me:$LINENO: \\$? = $ac_status\" >&5\n-  (exit $ac_status); }; } &&\n-\t { ac_try='test -s conftest.$ac_objext'\n-  { (eval echo \"$as_me:$LINENO: \\\"$ac_try\\\"\") >&5\n-  (eval $ac_try) 2>&5\n-  ac_status=$?\n-  echo \"$as_me:$LINENO: \\$? = $ac_status\" >&5\n-  (exit $ac_status); }; }; then\n-  glibcxx_cv_system_error14=yes\n-else\n-  echo \"$as_me: failed program was:\" >&5\n-sed 's/^/| /' conftest.$ac_ext >&5\n-\n-glibcxx_cv_system_error14=no\n-fi\n-rm -f conftest.err conftest.$ac_objext conftest.$ac_ext\n-\n-fi\n-\n-echo \"$as_me:$LINENO: result: $glibcxx_cv_system_error14\" >&5\n-echo \"${ECHO_T}$glibcxx_cv_system_error14\" >&6\n-if test x\"$glibcxx_cv_system_error14\" = x\"yes\"; then\n-\n-cat >>confdefs.h <<\\_ACEOF\n-#define HAVE_EIDRM 1\n-_ACEOF\n-\n-fi\n-echo \"$as_me:$LINENO: checking for ETXTBSY\" >&5\n-echo $ECHO_N \"checking for ETXTBSY... $ECHO_C\" >&6\n-if test \"${glibcxx_cv_system_error15+set}\" = set; then\n-  echo $ECHO_N \"(cached) $ECHO_C\" >&6\n-else\n-\n-cat >conftest.$ac_ext <<_ACEOF\n-/* confdefs.h.  */\n-_ACEOF\n-cat confdefs.h >>conftest.$ac_ext\n-cat >>conftest.$ac_ext <<_ACEOF\n-/* end confdefs.h.  */\n-#include <errno.h>\n-int\n-main ()\n-{\n-int i = ETXTBSY;\n-  ;\n-  return 0;\n-}\n-_ACEOF\n-rm -f conftest.$ac_objext\n-if { (eval echo \"$as_me:$LINENO: \\\"$ac_compile\\\"\") >&5\n-  (eval $ac_compile) 2>conftest.er1\n-  ac_status=$?\n-  grep -v '^ *+' conftest.er1 >conftest.err\n-  rm -f conftest.er1\n-  cat conftest.err >&5\n-  echo \"$as_me:$LINENO: \\$? = $ac_status\" >&5\n-  (exit $ac_status); } &&\n-\t { ac_try='test -z \"$ac_c_werror_flag\"\n-\t\t\t || test ! -s conftest.err'\n-  { (eval echo \"$as_me:$LINENO: \\\"$ac_try\\\"\") >&5\n-  (eval $ac_try) 2>&5\n-  ac_status=$?\n-  echo \"$as_me:$LINENO: \\$? = $ac_status\" >&5\n-  (exit $ac_status); }; } &&\n-\t { ac_try='test -s conftest.$ac_objext'\n-  { (eval echo \"$as_me:$LINENO: \\\"$ac_try\\\"\") >&5\n-  (eval $ac_try) 2>&5\n-  ac_status=$?\n-  echo \"$as_me:$LINENO: \\$? = $ac_status\" >&5\n-  (exit $ac_status); }; }; then\n-  glibcxx_cv_system_error15=yes\n+  glibcxx_cv_system_error13=yes\n else\n   echo \"$as_me: failed program was:\" >&5\n sed 's/^/| /' conftest.$ac_ext >&5\n \n-glibcxx_cv_system_error15=no\n+glibcxx_cv_system_error13=no\n fi\n rm -f conftest.err conftest.$ac_objext conftest.$ac_ext\n \n fi\n \n-echo \"$as_me:$LINENO: result: $glibcxx_cv_system_error15\" >&5\n-echo \"${ECHO_T}$glibcxx_cv_system_error15\" >&6\n-if test x\"$glibcxx_cv_system_error15\" = x\"yes\"; then\n+echo \"$as_me:$LINENO: result: $glibcxx_cv_system_error13\" >&5\n+echo \"${ECHO_T}$glibcxx_cv_system_error13\" >&6\n+if test x\"$glibcxx_cv_system_error13\" = x\"yes\"; then\n \n cat >>confdefs.h <<\\_ACEOF\n-#define HAVE_ETXTBSY 1\n+#define HAVE_ENOTSUP 1\n _ACEOF\n \n fi\n-\n-\n-\n-\n-  echo \"$as_me:$LINENO: checking for ISO C++200x standard layout type support\" >&5\n-echo $ECHO_N \"checking for ISO C++200x standard layout type support... $ECHO_C\" >&6\n-  if test \"${ac_standard_layout+set}\" = set; then\n+echo \"$as_me:$LINENO: checking for EIDRM\" >&5\n+echo $ECHO_N \"checking for EIDRM... $ECHO_C\" >&6\n+if test \"${glibcxx_cv_system_error14+set}\" = set; then\n   echo $ECHO_N \"(cached) $ECHO_C\" >&6\n else\n \n-\n-\n-  ac_ext=cc\n-ac_cpp='$CXXCPP $CPPFLAGS'\n-ac_compile='$CXX -c $CXXFLAGS $CPPFLAGS conftest.$ac_ext >&5'\n-ac_link='$CXX -o conftest$ac_exeext $CXXFLAGS $CPPFLAGS $LDFLAGS conftest.$ac_ext $LIBS >&5'\n-ac_compiler_gnu=$ac_cv_cxx_compiler_gnu\n-\n-  ac_test_CXXFLAGS=\"${CXXFLAGS+set}\"\n-  ac_save_CXXFLAGS=\"$CXXFLAGS\"\n-  CXXFLAGS='-std=gnu++0x'\n-\n-  cat >conftest.$ac_ext <<_ACEOF\n+cat >conftest.$ac_ext <<_ACEOF\n /* confdefs.h.  */\n _ACEOF\n cat confdefs.h >>conftest.$ac_ext\n cat >>conftest.$ac_ext <<_ACEOF\n /* end confdefs.h.  */\n-struct b\n-                  {\n-  \t\t    bool t;\n-\n-\t\t    // Need standard layout relaxation from POD\n-\t\t    private:\n-  \t\t    b& operator=(const b&);\n-  \t\t    b(const b&);\n-\t\t    };\n-\n-\t\t    int main()\n-\t\t    {\n-\t\t      b tst1 = { false };\n-\t\t       return 0;\n-\t\t    }\n+#include <errno.h>\n int\n main ()\n {\n-\n+int i = EIDRM;\n   ;\n   return 0;\n }\n@@ -18011,7 +18207,7 @@ if { (eval echo \"$as_me:$LINENO: \\\"$ac_compile\\\"\") >&5\n   cat conftest.err >&5\n   echo \"$as_me:$LINENO: \\$? = $ac_status\" >&5\n   (exit $ac_status); } &&\n-\t { ac_try='test -z \"$ac_cxx_werror_flag\"\n+\t { ac_try='test -z \"$ac_c_werror_flag\"\n \t\t\t || test ! -s conftest.err'\n   { (eval echo \"$as_me:$LINENO: \\\"$ac_try\\\"\") >&5\n   (eval $ac_try) 2>&5\n@@ -18024,228 +18220,43 @@ if { (eval echo \"$as_me:$LINENO: \\\"$ac_compile\\\"\") >&5\n   ac_status=$?\n   echo \"$as_me:$LINENO: \\$? = $ac_status\" >&5\n   (exit $ac_status); }; }; then\n-  ac_standard_layout=yes\n+  glibcxx_cv_system_error14=yes\n else\n   echo \"$as_me: failed program was:\" >&5\n sed 's/^/| /' conftest.$ac_ext >&5\n \n-ac_standard_layout=no\n+glibcxx_cv_system_error14=no\n fi\n rm -f conftest.err conftest.$ac_objext conftest.$ac_ext\n \n-  CXXFLAGS=\"$ac_save_CXXFLAGS\"\n-  ac_ext=c\n-ac_cpp='$CPP $CPPFLAGS'\n-ac_compile='$CC -c $CFLAGS $CPPFLAGS conftest.$ac_ext >&5'\n-ac_link='$CC -o conftest$ac_exeext $CFLAGS $CPPFLAGS $LDFLAGS conftest.$ac_ext $LIBS >&5'\n-ac_compiler_gnu=$ac_cv_c_compiler_gnu\n-\n-\n fi\n \n-  echo \"$as_me:$LINENO: result: $ac_standard_layout\" >&5\n-echo \"${ECHO_T}$ac_standard_layout\" >&6\n-  if test x\"$ac_standard_layout\" = x\"yes\"; then\n-\n-cat >>confdefs.h <<\\_ACEOF\n-#define _GLIBCXX_USE_STANDARD_LAYOUT 1\n-_ACEOF\n-\n-  fi\n-\n-\n-  echo \"$as_me:$LINENO: checking for thread model used by GCC\" >&5\n-echo $ECHO_N \"checking for thread model used by GCC... $ECHO_C\" >&6\n-  target_thread_file=`$CXX -v 2>&1 | sed -n 's/^Thread model: //p'`\n-  echo \"$as_me:$LINENO: result: $target_thread_file\" >&5\n-echo \"${ECHO_T}$target_thread_file\" >&6\n-\n-  if test $target_thread_file != single; then\n-\n-cat >>confdefs.h <<\\_ACEOF\n-#define HAVE_GTHR_DEFAULT 1\n-_ACEOF\n-\n-  fi\n-\n-  glibcxx_thread_h=gthr-$target_thread_file.h\n-\n-    gthread_file=${toplevel_srcdir}/gcc/${glibcxx_thread_h}\n-  if grep __GTHREADS $gthread_file >/dev/null 2>&1 ; then\n-    enable_thread=yes\n-  else\n-   enable_thread=no\n-  fi\n-\n-\n-\n-\n-# Checks for compiler support that don't require linking.\n-\n-\n-\n-  ac_ext=cc\n-ac_cpp='$CXXCPP $CPPFLAGS'\n-ac_compile='$CXX -c $CXXFLAGS $CPPFLAGS conftest.$ac_ext >&5'\n-ac_link='$CXX -o conftest$ac_exeext $CXXFLAGS $CPPFLAGS $LDFLAGS conftest.$ac_ext $LIBS >&5'\n-ac_compiler_gnu=$ac_cv_cxx_compiler_gnu\n-\n-  old_CXXFLAGS=\"$CXXFLAGS\"\n-\n-  # Compile unoptimized.\n-  CXXFLAGS='-O0 -S'\n-\n-  # Fake what AC_TRY_COMPILE does, without linking as this is\n-  # unnecessary for a builtins test.\n-\n-    cat > conftest.$ac_ext << EOF\n-#line 18102 \"configure\"\n-int main()\n-{\n-  // NB: _Atomic_word not necessarily int.\n-  typedef int atomic_type;\n-  atomic_type c1;\n-  atomic_type c2;\n-  const atomic_type c3(0);\n-  __sync_fetch_and_add(&c1, c2);\n-  __sync_val_compare_and_swap(&c1, c3, c2);\n-  __sync_lock_test_and_set(&c1, c3);\n-  __sync_lock_release(&c1);\n-  __sync_synchronize();\n-  return 0;\n-}\n-EOF\n-\n-    echo \"$as_me:$LINENO: checking for atomic builtins for int\" >&5\n-echo $ECHO_N \"checking for atomic builtins for int... $ECHO_C\" >&6\n-    if { (eval echo \"$as_me:$LINENO: \\\"$ac_compile\\\"\") >&5\n-  (eval $ac_compile) 2>&5\n-  ac_status=$?\n-  echo \"$as_me:$LINENO: \\$? = $ac_status\" >&5\n-  (exit $ac_status); }; then\n-      if grep __sync_ conftest.s >/dev/null 2>&1 ; then\n-        enable_atomic_builtinsi=no\n-      else\n-\n-cat >>confdefs.h <<\\_ACEOF\n-#define _GLIBCXX_ATOMIC_BUILTINS_4 1\n-_ACEOF\n-\n-        enable_atomic_builtinsi=yes\n-      fi\n-    fi\n-    echo \"$as_me:$LINENO: result: $enable_atomic_builtinsi\" >&5\n-echo \"${ECHO_T}$enable_atomic_builtinsi\" >&6\n-    rm -f conftest*\n-\n-    cat > conftest.$ac_ext << EOF\n-#line 18142 \"configure\"\n-int main()\n-{\n-  typedef bool atomic_type;\n-  atomic_type c1;\n-  atomic_type c2;\n-  const atomic_type c3(0);\n-  __sync_fetch_and_add(&c1, c2);\n-  __sync_val_compare_and_swap(&c1, c3, c2);\n-  __sync_lock_test_and_set(&c1, c3);\n-  __sync_lock_release(&c1);\n-  __sync_synchronize();\n-  return 0;\n-}\n-EOF\n-\n-    echo \"$as_me:$LINENO: checking for atomic builtins for bool\" >&5\n-echo $ECHO_N \"checking for atomic builtins for bool... $ECHO_C\" >&6\n-    if { (eval echo \"$as_me:$LINENO: \\\"$ac_compile\\\"\") >&5\n-  (eval $ac_compile) 2>&5\n-  ac_status=$?\n-  echo \"$as_me:$LINENO: \\$? = $ac_status\" >&5\n-  (exit $ac_status); }; then\n-      if grep __sync_ conftest.s >/dev/null 2>&1 ; then\n-        enable_atomic_builtinsb=no\n-      else\n+echo \"$as_me:$LINENO: result: $glibcxx_cv_system_error14\" >&5\n+echo \"${ECHO_T}$glibcxx_cv_system_error14\" >&6\n+if test x\"$glibcxx_cv_system_error14\" = x\"yes\"; then\n \n cat >>confdefs.h <<\\_ACEOF\n-#define _GLIBCXX_ATOMIC_BUILTINS_1 1\n+#define HAVE_EIDRM 1\n _ACEOF\n \n-        enable_atomic_builtinsb=yes\n-      fi\n-    fi\n-    echo \"$as_me:$LINENO: result: $enable_atomic_builtinsb\" >&5\n-echo \"${ECHO_T}$enable_atomic_builtinsb\" >&6\n-    rm -f conftest*\n-\n-  CXXFLAGS=\"$old_CXXFLAGS\"\n-  ac_ext=c\n-ac_cpp='$CPP $CPPFLAGS'\n-ac_compile='$CC -c $CFLAGS $CPPFLAGS conftest.$ac_ext >&5'\n-ac_link='$CC -o conftest$ac_exeext $CFLAGS $CPPFLAGS $LDFLAGS conftest.$ac_ext $LIBS >&5'\n-ac_compiler_gnu=$ac_cv_c_compiler_gnu\n-\n-\n-  # Set atomicity_dir to builtins if either of above tests pass.\n-  if test $enable_atomic_builtinsi = yes || test $enable_atomic_builtinsb = yes ; then\n-    atomicity_dir=cpu/generic/atomicity_builtins\n-  fi\n-\n-  # If still generic, set to mutex.\n-  if test $atomicity_dir = \"cpu/generic\" ; then\n-    atomicity_dir=cpu/generic/atomicity_mutex\n-    { echo \"$as_me:$LINENO: WARNING: No native atomic operations are provided for this platform.\" >&5\n-echo \"$as_me: WARNING: No native atomic operations are provided for this platform.\" >&2;}\n-      if test $target_thread_file = single; then\n-        { echo \"$as_me:$LINENO: WARNING: They cannot be faked when thread support is disabled.\" >&5\n-echo \"$as_me: WARNING: They cannot be faked when thread support is disabled.\" >&2;}\n-        { echo \"$as_me:$LINENO: WARNING: Thread-safety of certain classes is not guaranteed.\" >&5\n-echo \"$as_me: WARNING: Thread-safety of certain classes is not guaranteed.\" >&2;}\n-      else\n-        { echo \"$as_me:$LINENO: WARNING: They will be faked using a mutex.\" >&5\n-echo \"$as_me: WARNING: They will be faked using a mutex.\" >&2;}\n-        { echo \"$as_me:$LINENO: WARNING: Performance of certain classes will degrade as a result.\" >&5\n-echo \"$as_me: WARNING: Performance of certain classes will degrade as a result.\" >&2;}\n-      fi\n-  fi\n-\n-\n-\n-  # All these tests are for C++; save the language and the compiler flags.\n-  # The CXXFLAGS thing is suspicious, but based on similar bits previously\n-  # found in GLIBCXX_CONFIGURE.\n-\n-\n-  ac_ext=cc\n-ac_cpp='$CXXCPP $CPPFLAGS'\n-ac_compile='$CXX -c $CXXFLAGS $CPPFLAGS conftest.$ac_ext >&5'\n-ac_link='$CXX -o conftest$ac_exeext $CXXFLAGS $CPPFLAGS $LDFLAGS conftest.$ac_ext $LIBS >&5'\n-ac_compiler_gnu=$ac_cv_cxx_compiler_gnu\n-\n-  ac_test_CXXFLAGS=\"${CXXFLAGS+set}\"\n-  ac_save_CXXFLAGS=\"$CXXFLAGS\"\n-\n-  # Check for maintainer-mode bits.\n-  if test x\"$USE_MAINTAINER_MODE\" = xno; then\n-    WERROR=''\n-  else\n-    WERROR='-Werror'\n-  fi\n+fi\n+echo \"$as_me:$LINENO: checking for ETXTBSY\" >&5\n+echo $ECHO_N \"checking for ETXTBSY... $ECHO_C\" >&6\n+if test \"${glibcxx_cv_system_error15+set}\" = set; then\n+  echo $ECHO_N \"(cached) $ECHO_C\" >&6\n+else\n \n-  # Check for -ffunction-sections -fdata-sections\n-  echo \"$as_me:$LINENO: checking for g++ that supports -ffunction-sections -fdata-sections\" >&5\n-echo $ECHO_N \"checking for g++ that supports -ffunction-sections -fdata-sections... $ECHO_C\" >&6\n-  CXXFLAGS='-g -Werror -ffunction-sections -fdata-sections'\n-  cat >conftest.$ac_ext <<_ACEOF\n+cat >conftest.$ac_ext <<_ACEOF\n /* confdefs.h.  */\n _ACEOF\n cat confdefs.h >>conftest.$ac_ext\n cat >>conftest.$ac_ext <<_ACEOF\n /* end confdefs.h.  */\n-int foo; void bar() { };\n+#include <errno.h>\n int\n main ()\n {\n-\n+int i = ETXTBSY;\n   ;\n   return 0;\n }\n@@ -18259,7 +18270,7 @@ if { (eval echo \"$as_me:$LINENO: \\\"$ac_compile\\\"\") >&5\n   cat conftest.err >&5\n   echo \"$as_me:$LINENO: \\$? = $ac_status\" >&5\n   (exit $ac_status); } &&\n-\t { ac_try='test -z \"$ac_cxx_werror_flag\"\n+\t { ac_try='test -z \"$ac_c_werror_flag\"\n \t\t\t || test ! -s conftest.err'\n   { (eval echo \"$as_me:$LINENO: \\\"$ac_try\\\"\") >&5\n   (eval $ac_try) 2>&5\n@@ -18272,32 +18283,26 @@ if { (eval echo \"$as_me:$LINENO: \\\"$ac_compile\\\"\") >&5\n   ac_status=$?\n   echo \"$as_me:$LINENO: \\$? = $ac_status\" >&5\n   (exit $ac_status); }; }; then\n-  ac_fdsections=yes\n+  glibcxx_cv_system_error15=yes\n else\n   echo \"$as_me: failed program was:\" >&5\n sed 's/^/| /' conftest.$ac_ext >&5\n \n-ac_fdsections=no\n+glibcxx_cv_system_error15=no\n fi\n rm -f conftest.err conftest.$ac_objext conftest.$ac_ext\n-  if test \"$ac_test_CXXFLAGS\" = set; then\n-    CXXFLAGS=\"$ac_save_CXXFLAGS\"\n-  else\n-    # this is the suspicious part\n-    CXXFLAGS=''\n-  fi\n-  if test x\"$ac_fdsections\" = x\"yes\"; then\n-    SECTION_FLAGS='-ffunction-sections -fdata-sections'\n-  fi\n-  echo \"$as_me:$LINENO: result: $ac_fdsections\" >&5\n-echo \"${ECHO_T}$ac_fdsections\" >&6\n \n-  ac_ext=c\n-ac_cpp='$CPP $CPPFLAGS'\n-ac_compile='$CC -c $CFLAGS $CPPFLAGS conftest.$ac_ext >&5'\n-ac_link='$CC -o conftest$ac_exeext $CFLAGS $CPPFLAGS $LDFLAGS conftest.$ac_ext $LIBS >&5'\n-ac_compiler_gnu=$ac_cv_c_compiler_gnu\n+fi\n \n+echo \"$as_me:$LINENO: result: $glibcxx_cv_system_error15\" >&5\n+echo \"${ECHO_T}$glibcxx_cv_system_error15\" >&6\n+if test x\"$glibcxx_cv_system_error15\" = x\"yes\"; then\n+\n+cat >>confdefs.h <<\\_ACEOF\n+#define HAVE_ETXTBSY 1\n+_ACEOF\n+\n+fi\n \n \n \n@@ -121659,6 +121664,9 @@ s,@GLIBCXX_HOSTED_FALSE@,$GLIBCXX_HOSTED_FALSE,;t t\n s,@GLIBCXX_BUILD_PCH_TRUE@,$GLIBCXX_BUILD_PCH_TRUE,;t t\n s,@GLIBCXX_BUILD_PCH_FALSE@,$GLIBCXX_BUILD_PCH_FALSE,;t t\n s,@glibcxx_PCHFLAGS@,$glibcxx_PCHFLAGS,;t t\n+s,@glibcxx_thread_h@,$glibcxx_thread_h,;t t\n+s,@WERROR@,$WERROR,;t t\n+s,@SECTION_FLAGS@,$SECTION_FLAGS,;t t\n s,@CSTDIO_H@,$CSTDIO_H,;t t\n s,@BASIC_FILE_H@,$BASIC_FILE_H,;t t\n s,@BASIC_FILE_CC@,$BASIC_FILE_CC,;t t\n@@ -121698,9 +121706,6 @@ s,@GLIBCXX_BUILD_DEBUG_FALSE@,$GLIBCXX_BUILD_DEBUG_FALSE,;t t\n s,@ENABLE_PARALLEL_TRUE@,$ENABLE_PARALLEL_TRUE,;t t\n s,@ENABLE_PARALLEL_FALSE@,$ENABLE_PARALLEL_FALSE,;t t\n s,@EXTRA_CXX_FLAGS@,$EXTRA_CXX_FLAGS,;t t\n-s,@glibcxx_thread_h@,$glibcxx_thread_h,;t t\n-s,@WERROR@,$WERROR,;t t\n-s,@SECTION_FLAGS@,$SECTION_FLAGS,;t t\n s,@SECTION_LDFLAGS@,$SECTION_LDFLAGS,;t t\n s,@OPT_LDFLAGS@,$OPT_LDFLAGS,;t t\n s,@LIBMATHOBJS@,$LIBMATHOBJS,;t t"}, {"sha": "7279b118923a4464d5c79b06340e3ac9282a77fe", "filename": "libstdc++-v3/configure.ac", "status": "modified", "additions": 6, "deletions": 5, "changes": 11, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/e55d0e3595352308d03019c43c052f6e4474e62b/libstdc%2B%2B-v3%2Fconfigure.ac", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/e55d0e3595352308d03019c43c052f6e4474e62b/libstdc%2B%2B-v3%2Fconfigure.ac", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libstdc%2B%2B-v3%2Fconfigure.ac?ref=e55d0e3595352308d03019c43c052f6e4474e62b", "patch": "@@ -95,6 +95,12 @@ GLIBCXX_ENABLE_HOSTED\n # Enable compiler support that doesn't require linking.\n GLIBCXX_ENABLE_SJLJ_EXCEPTIONS\n GLIBCXX_ENABLE_PCH($is_hosted)\n+GLIBCXX_ENABLE_ATOMIC_BUILTINS\n+GLIBCXX_ENABLE_THREADS\n+\n+# Checks for compiler support that don't require linking.\n+GLIBCXX_CHECK_COMPILER_FEATURES\n+GLIBCXX_CHECK_STANDARD_LAYOUT\n \n # Enable all the variable C++ runtime options that doesn't require linking.\n GLIBCXX_ENABLE_CSTDIO\n@@ -113,12 +119,7 @@ GLIBCXX_ENABLE_FULLY_DYNAMIC_STRING([no])\n \n # Checks for operating systems support that don't require linking.\n GLIBCXX_CHECK_SYSTEM_ERROR\n-GLIBCXX_CHECK_STANDARD_LAYOUT\n-GLIBCXX_ENABLE_THREADS\n \n-# Checks for compiler support that don't require linking.\n-GLIBCXX_ENABLE_ATOMIC_BUILTINS\n-GLIBCXX_CHECK_COMPILER_FEATURES\n \n # Only do link tests if native. Else, hardcode.\n if $GLIBCXX_IS_NATIVE; then"}]}