{"sha": "5cd09fac3dc9c8ef5fbb6de8311d6646618ebcdb", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6NWNkMDlmYWMzZGM5YzhlZjVmYmI2ZGU4MzExZDY2NDY2MThlYmNkYg==", "commit": {"author": {"name": "Tobias Schl\u00fcter", "email": "tobi@gcc.gnu.org", "date": "2007-04-12T18:48:06Z"}, "committer": {"name": "Tobias Schl\u00fcter", "email": "tobi@gcc.gnu.org", "date": "2007-04-12T18:48:06Z"}, "message": "re PR fortran/31250 (Initialization expr as constant character length rejected)\n\nPR fortran/31250\nfortran/\n* decl.c (match_char_spec): Move check for negative CHARACTER\nlength ...\n* resolve.c (resolve_charlen): ... here.\n(resolve_types): Resolve CHARACTER lengths earlier.\nteststuite/\n* gfortran.dg/char_length_2.f90: New.\n\nFrom-SVN: r123763", "tree": {"sha": "103efb58637a26252c0894047230daacbfd5f1e5", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/103efb58637a26252c0894047230daacbfd5f1e5"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/5cd09fac3dc9c8ef5fbb6de8311d6646618ebcdb", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/5cd09fac3dc9c8ef5fbb6de8311d6646618ebcdb", "html_url": "https://github.com/Rust-GCC/gccrs/commit/5cd09fac3dc9c8ef5fbb6de8311d6646618ebcdb", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/5cd09fac3dc9c8ef5fbb6de8311d6646618ebcdb/comments", "author": {"login": "TobiSchluter", "id": 11887541, "node_id": "MDQ6VXNlcjExODg3NTQx", "avatar_url": "https://avatars.githubusercontent.com/u/11887541?v=4", "gravatar_id": "", "url": "https://api.github.com/users/TobiSchluter", "html_url": "https://github.com/TobiSchluter", "followers_url": "https://api.github.com/users/TobiSchluter/followers", "following_url": "https://api.github.com/users/TobiSchluter/following{/other_user}", "gists_url": "https://api.github.com/users/TobiSchluter/gists{/gist_id}", "starred_url": "https://api.github.com/users/TobiSchluter/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/TobiSchluter/subscriptions", "organizations_url": "https://api.github.com/users/TobiSchluter/orgs", "repos_url": "https://api.github.com/users/TobiSchluter/repos", "events_url": "https://api.github.com/users/TobiSchluter/events{/privacy}", "received_events_url": "https://api.github.com/users/TobiSchluter/received_events", "type": "User", "site_admin": false}, "committer": {"login": "TobiSchluter", "id": 11887541, "node_id": "MDQ6VXNlcjExODg3NTQx", "avatar_url": "https://avatars.githubusercontent.com/u/11887541?v=4", "gravatar_id": "", "url": "https://api.github.com/users/TobiSchluter", "html_url": "https://github.com/TobiSchluter", "followers_url": "https://api.github.com/users/TobiSchluter/followers", "following_url": "https://api.github.com/users/TobiSchluter/following{/other_user}", "gists_url": "https://api.github.com/users/TobiSchluter/gists{/gist_id}", "starred_url": "https://api.github.com/users/TobiSchluter/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/TobiSchluter/subscriptions", "organizations_url": "https://api.github.com/users/TobiSchluter/orgs", "repos_url": "https://api.github.com/users/TobiSchluter/repos", "events_url": "https://api.github.com/users/TobiSchluter/events{/privacy}", "received_events_url": "https://api.github.com/users/TobiSchluter/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "c6214a7507757f2e4222e4901991a545c12594d4", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/c6214a7507757f2e4222e4901991a545c12594d4", "html_url": "https://github.com/Rust-GCC/gccrs/commit/c6214a7507757f2e4222e4901991a545c12594d4"}], "stats": {"total": 61, "additions": 48, "deletions": 13}, "files": [{"sha": "fe6b13997d35d88bd05696aa896d73ac40e3987a", "filename": "gcc/fortran/ChangeLog", "status": "modified", "additions": 8, "deletions": 0, "changes": 8, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/5cd09fac3dc9c8ef5fbb6de8311d6646618ebcdb/gcc%2Ffortran%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/5cd09fac3dc9c8ef5fbb6de8311d6646618ebcdb/gcc%2Ffortran%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ffortran%2FChangeLog?ref=5cd09fac3dc9c8ef5fbb6de8311d6646618ebcdb", "patch": "@@ -1,3 +1,11 @@\n+2007-04-12  Tobias Schl\ufffdter  <tobi@gcc.gnu.org>\n+\n+\tPR fortran/31250\n+\t* decl.c (match_char_spec): Move check for negative CHARACTER\n+\tlength ...\n+\t* resolve.c (resolve_charlen): ... here.\n+\t(resolve_types): Resolve CHARACTER lengths earlier.\n+\n 2007-04-12  Daniel Franke  <franke.daniel@gmail.com>\n \n \tPR fortran/31234"}, {"sha": "9b54bcab10b4815935187f0b265a8bc3b8627b9d", "filename": "gcc/fortran/decl.c", "status": "modified", "additions": 2, "deletions": 10, "changes": 12, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/5cd09fac3dc9c8ef5fbb6de8311d6646618ebcdb/gcc%2Ffortran%2Fdecl.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/5cd09fac3dc9c8ef5fbb6de8311d6646618ebcdb/gcc%2Ffortran%2Fdecl.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ffortran%2Fdecl.c?ref=5cd09fac3dc9c8ef5fbb6de8311d6646618ebcdb", "patch": "@@ -1515,7 +1515,7 @@ gfc_match_kind_spec (gfc_typespec *ts)\n static match\n match_char_spec (gfc_typespec *ts)\n {\n-  int i, kind, seen_length;\n+  int kind, seen_length;\n   gfc_charlen *cl;\n   gfc_expr *len;\n   match m;\n@@ -1646,15 +1646,7 @@ match_char_spec (gfc_typespec *ts)\n   if (seen_length == 0)\n     cl->length = gfc_int_expr (1);\n   else\n-    {\n-      if (len == NULL || gfc_extract_int (len, &i) != NULL || i >= 0)\n-\tcl->length = len;\n-      else\n-\t{\n-\t  gfc_free_expr (len);\n-\t  cl->length = gfc_int_expr (0);\n-\t}\n-    }\n+    cl->length = len;\n \n   ts->cl = cl;\n   ts->kind = kind;"}, {"sha": "8c4b46ac27fcb735772277dddfa836281955bfe4", "filename": "gcc/fortran/resolve.c", "status": "modified", "additions": 14, "deletions": 3, "changes": 17, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/5cd09fac3dc9c8ef5fbb6de8311d6646618ebcdb/gcc%2Ffortran%2Fresolve.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/5cd09fac3dc9c8ef5fbb6de8311d6646618ebcdb/gcc%2Ffortran%2Fresolve.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ffortran%2Fresolve.c?ref=5cd09fac3dc9c8ef5fbb6de8311d6646618ebcdb", "patch": "@@ -5389,6 +5389,8 @@ resolve_index_expr (gfc_expr *e)\n static try\n resolve_charlen (gfc_charlen *cl)\n {\n+  int i;\n+\n   if (cl->resolved)\n     return SUCCESS;\n \n@@ -5402,6 +5404,15 @@ resolve_charlen (gfc_charlen *cl)\n       return FAILURE;\n     }\n \n+  /* \"If the character length parameter value evaluates to a negative\n+     value, the length of character entities declared is zero.\"  */\n+  if (cl->length && !gfc_extract_int (cl->length, &i) && i <= 0)\n+    {\n+      gfc_warning_now (\"CHARACTER variable has zero length at %L\",\n+\t\t       &cl->length->where);\n+      gfc_replace_expr (cl->length, gfc_int_expr (0));\n+    }\n+\n   return SUCCESS;\n }\n \n@@ -7270,6 +7281,9 @@ resolve_types (gfc_namespace *ns)\n \n   resolve_contained_functions (ns);\n \n+  for (cl = ns->cl_list; cl; cl = cl->next)\n+    resolve_charlen (cl);\n+\n   gfc_traverse_ns (ns, resolve_symbol);\n \n   resolve_fntype (ns);\n@@ -7287,9 +7301,6 @@ resolve_types (gfc_namespace *ns)\n   forall_flag = 0;\n   gfc_check_interfaces (ns);\n \n-  for (cl = ns->cl_list; cl; cl = cl->next)\n-    resolve_charlen (cl);\n-\n   gfc_traverse_ns (ns, resolve_values);\n \n   if (ns->save_all)"}, {"sha": "9f48f14270d4baa144020f97ee9937982154f608", "filename": "gcc/testsuite/ChangeLog", "status": "modified", "additions": 3, "deletions": 0, "changes": 3, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/5cd09fac3dc9c8ef5fbb6de8311d6646618ebcdb/gcc%2Ftestsuite%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/5cd09fac3dc9c8ef5fbb6de8311d6646618ebcdb/gcc%2Ftestsuite%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2FChangeLog?ref=5cd09fac3dc9c8ef5fbb6de8311d6646618ebcdb", "patch": "@@ -1,5 +1,8 @@\n 2007-04-12  Tobias Schl\ufffdter  <tobi@gcc.gnu.org>\n \n+\tPR fortran/31250\n+\t* gfortran.dg/char_length_2.f90: New.\n+\n \tPR fortran/31266\n \t* gfortran.dg/char_assign_1.f90: New.\n "}, {"sha": "dc2efb94f77921ac4dcea552cb55c5f74c890780", "filename": "gcc/testsuite/gfortran.dg/char_length_2.f90", "status": "added", "additions": 21, "deletions": 0, "changes": 21, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/5cd09fac3dc9c8ef5fbb6de8311d6646618ebcdb/gcc%2Ftestsuite%2Fgfortran.dg%2Fchar_length_2.f90", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/5cd09fac3dc9c8ef5fbb6de8311d6646618ebcdb/gcc%2Ftestsuite%2Fgfortran.dg%2Fchar_length_2.f90", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgfortran.dg%2Fchar_length_2.f90?ref=5cd09fac3dc9c8ef5fbb6de8311d6646618ebcdb", "patch": "@@ -0,0 +1,21 @@\n+! { dg-do link }\n+! Tests the fix for PR 31250\n+! CHARACTER lengths weren't reduced early enough for all checks of\n+! them to be meaningful.  Furthermore negative string lengths weren't\n+! dealt with correctly.\n+CHARACTER(len=0) :: c1  ! { dg-warning \"CHARACTER variable has zero length\" }\n+CHARACTER(len=-1) :: c2  ! { dg-warning \"CHARACTER variable has zero length\" }\n+PARAMETER(I=-100)\n+CHARACTER(len=I) :: c3   ! { dg-warning \"CHARACTER variable has zero length\" }\n+CHARACTER(len=min(I,500)) :: c4  ! { dg-warning \"CHARACTER variable has zero length\" }\n+CHARACTER(len=max(I,500)) :: d1  ! no warning\n+CHARACTER(len=5) :: d2   ! no warning\n+\n+if (len(c1) .ne. 0) call link_error ()\n+if (len(c2) .ne. len(c1)) call link_error ()\n+if (len(c3) .ne. len(c2)) call link_error ()\n+if (len(c4) .ne. len(c3)) call link_error ()\n+\n+if (len(d1) .ne. 500) call link_error ()\n+if (len(d2) .ne. 5) call link_error ()\n+END"}]}