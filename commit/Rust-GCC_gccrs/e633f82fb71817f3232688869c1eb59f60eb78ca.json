{"sha": "e633f82fb71817f3232688869c1eb59f60eb78ca", "node_id": "C_kwDOANBUbNoAKGU2MzNmODJmYjcxODE3ZjMyMzI2ODg4NjljMWViNTlmNjBlYjc4Y2E", "commit": {"author": {"name": "Jakub Jelinek", "email": "jakub@redhat.com", "date": "2021-10-21T09:12:55Z"}, "committer": {"name": "Jakub Jelinek", "email": "jakub@redhat.com", "date": "2021-10-21T09:17:57Z"}, "message": "testsuite: Fix up gfortran.dg/gomp/strictly*.f90 testcases\n\nWhile these testcases are dg-do compile only, I think it is better not to\ngive users bad examples and avoid unnecessary data races in testcases (unless\nit is exactly what we want to test).  Perhaps one day we'll do some analysis\nand warn about data races...\n\n2021-10-21  Jakub Jelinek  <jakub@redhat.com>\n\n\t* gfortran.dg/gomp/strictly-structured-block-1.f90: Use call do_work\n\tinstead of x = x + 1 in places where the latter could be a data race.\n\t* gfortran.dg/gomp/strictly-structured-block-2.f90: Likewise.\n\t* gfortran.dg/gomp/strictly-structured-block-3.f90: Likewise.", "tree": {"sha": "1bdf1471e7afb9d3eab3f111b1dbb4066c675595", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/1bdf1471e7afb9d3eab3f111b1dbb4066c675595"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/e633f82fb71817f3232688869c1eb59f60eb78ca", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/e633f82fb71817f3232688869c1eb59f60eb78ca", "html_url": "https://github.com/Rust-GCC/gccrs/commit/e633f82fb71817f3232688869c1eb59f60eb78ca", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/e633f82fb71817f3232688869c1eb59f60eb78ca/comments", "author": {"login": "jakubjelinek", "id": 9370665, "node_id": "MDQ6VXNlcjkzNzA2NjU=", "avatar_url": "https://avatars.githubusercontent.com/u/9370665?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jakubjelinek", "html_url": "https://github.com/jakubjelinek", "followers_url": "https://api.github.com/users/jakubjelinek/followers", "following_url": "https://api.github.com/users/jakubjelinek/following{/other_user}", "gists_url": "https://api.github.com/users/jakubjelinek/gists{/gist_id}", "starred_url": "https://api.github.com/users/jakubjelinek/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jakubjelinek/subscriptions", "organizations_url": "https://api.github.com/users/jakubjelinek/orgs", "repos_url": "https://api.github.com/users/jakubjelinek/repos", "events_url": "https://api.github.com/users/jakubjelinek/events{/privacy}", "received_events_url": "https://api.github.com/users/jakubjelinek/received_events", "type": "User", "site_admin": false}, "committer": {"login": "jakubjelinek", "id": 9370665, "node_id": "MDQ6VXNlcjkzNzA2NjU=", "avatar_url": "https://avatars.githubusercontent.com/u/9370665?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jakubjelinek", "html_url": "https://github.com/jakubjelinek", "followers_url": "https://api.github.com/users/jakubjelinek/followers", "following_url": "https://api.github.com/users/jakubjelinek/following{/other_user}", "gists_url": "https://api.github.com/users/jakubjelinek/gists{/gist_id}", "starred_url": "https://api.github.com/users/jakubjelinek/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jakubjelinek/subscriptions", "organizations_url": "https://api.github.com/users/jakubjelinek/orgs", "repos_url": "https://api.github.com/users/jakubjelinek/repos", "events_url": "https://api.github.com/users/jakubjelinek/events{/privacy}", "received_events_url": "https://api.github.com/users/jakubjelinek/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "c8a889fc0e115d40a2d02f32842655f3eadc8fa1", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/c8a889fc0e115d40a2d02f32842655f3eadc8fa1", "html_url": "https://github.com/Rust-GCC/gccrs/commit/c8a889fc0e115d40a2d02f32842655f3eadc8fa1"}], "stats": {"total": 60, "additions": 30, "deletions": 30}, "files": [{"sha": "ef8507eb7f019bd27b1e3687f909873aaa2d6c52", "filename": "gcc/testsuite/gfortran.dg/gomp/strictly-structured-block-1.f90", "status": "modified", "additions": 14, "deletions": 14, "changes": 28, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/e633f82fb71817f3232688869c1eb59f60eb78ca/gcc%2Ftestsuite%2Fgfortran.dg%2Fgomp%2Fstrictly-structured-block-1.f90", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/e633f82fb71817f3232688869c1eb59f60eb78ca/gcc%2Ftestsuite%2Fgfortran.dg%2Fgomp%2Fstrictly-structured-block-1.f90", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgfortran.dg%2Fgomp%2Fstrictly-structured-block-1.f90?ref=e633f82fb71817f3232688869c1eb59f60eb78ca", "patch": "@@ -9,23 +9,23 @@ program main\n \n   !$omp parallel\n   block\n-    x = x + 1\n+    call do_work\n   end block\n \n   !$omp parallel\n   block\n-    x = x + 1\n+    call do_work\n   end block\n   !$omp end parallel\n \n   !$omp teams\n   block\n-    x = x + 1\n+    call do_work\n   end block\n \n   !$omp teams\n   block\n-    x = x + 1\n+    call do_work\n   end block\n   !$omp end teams\n \n@@ -42,12 +42,12 @@ program main\n \n   !$omp scope\n   block\n-    x = x + 1\n+    call do_work\n   end block\n \n   !$omp scope\n   block\n-    x = x + 1\n+    call do_work\n   end block\n   !$omp end scope\n \n@@ -75,12 +75,12 @@ program main\n \n   !$omp task\n   block\n-    x = x + 1\n+    call do_work\n   end block\n \n   !$omp task\n   block\n-    x = x + 1\n+    call do_work\n   end block\n   !$omp end task\n \n@@ -130,23 +130,23 @@ program main\n \n   !$omp target parallel\n   block\n-    x = x + 1\n+    call do_work\n   end block\n \n   !$omp target parallel\n   block\n-    x = x + 1\n+    call do_work\n   end block\n   !$omp end target parallel\n \n   !$omp target teams\n   block\n-    x = x + 1\n+    call do_work\n   end block\n \n   !$omp target teams\n   block\n-    x = x + 1\n+    call do_work\n   end block\n   !$omp end target teams\n \n@@ -176,15 +176,15 @@ program main\n   do i = 1, n\n      !$omp ordered\n      block\n-       x = x + 1\n+       call do_work\n      end block\n   end do\n \n   !$omp do ordered\n   do i = 1, n\n      !$omp ordered\n      block\n-       x = x + 1\n+       call do_work\n      end block\n      !$omp end ordered\n   end do"}, {"sha": "ad4d08a1d49574da774b96338c56afcacd3b38dd", "filename": "gcc/testsuite/gfortran.dg/gomp/strictly-structured-block-2.f90", "status": "modified", "additions": 14, "deletions": 14, "changes": 28, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/e633f82fb71817f3232688869c1eb59f60eb78ca/gcc%2Ftestsuite%2Fgfortran.dg%2Fgomp%2Fstrictly-structured-block-2.f90", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/e633f82fb71817f3232688869c1eb59f60eb78ca/gcc%2Ftestsuite%2Fgfortran.dg%2Fgomp%2Fstrictly-structured-block-2.f90", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgfortran.dg%2Fgomp%2Fstrictly-structured-block-2.f90?ref=e633f82fb71817f3232688869c1eb59f60eb78ca", "patch": "@@ -9,16 +9,16 @@ program main\n \n   !$omp parallel\n   block\n-    x = x + 1\n+    call do_work\n   end block\n-  x = x + 1\n+  call do_work\n   !$omp end parallel ! { dg-error \"Unexpected !.OMP END PARALLEL statement\" }\n \n   !$omp teams\n   block\n-    x = x + 1\n+    call do_work\n   end block\n-  x = x + 1\n+  call do_work\n   !$omp end teams ! { dg-error \"Unexpected !.OMP END TEAMS statement\" }\n \n   !$omp masked\n@@ -30,9 +30,9 @@ program main\n \n   !$omp scope\n   block\n-    x = x + 1\n+    call do_work\n   end block\n-  x = x + 1\n+  call do_work\n   !$omp end scope ! { dg-error \"Unexpected !.OMP END SCOPE statement\" }\n \n   !$omp single\n@@ -51,9 +51,9 @@ program main\n \n   !$omp task\n   block\n-    x = x + 1\n+    call do_work\n   end block\n-  x = x + 1\n+  call do_work\n   !$omp end task ! { dg-error \"Unexpected !.OMP END TASK statement\" }\n \n   !$omp target data map(x)\n@@ -86,16 +86,16 @@ program main\n \n   !$omp target parallel\n   block\n-    x = x + 1\n+    call do_work\n   end block\n-  x = x + 1\n+  call do_work\n   !$omp end target parallel ! { dg-error \"Unexpected !.OMP END TARGET PARALLEL statement\" }\n \n   !$omp target teams\n   block\n-    x = x + 1\n+    call do_work\n   end block\n-  x = x + 1\n+  call do_work\n   !$omp end target teams ! { dg-error \"Unexpected !.OMP END TARGET TEAMS statement\" }\n \n   !$omp critical\n@@ -116,9 +116,9 @@ program main\n   do i = 1, n\n      !$omp ordered\n      block\n-       x = x + 1\n+       call do_work\n      end block\n-     x = x + 1\n+     call do_work\n      !$omp end ordered ! { dg-error \"Unexpected !.OMP END ORDERED statement\" }\n   end do\n "}, {"sha": "ae85fa0864386d8b167a3ae4fac17c7b921a1074", "filename": "gcc/testsuite/gfortran.dg/gomp/strictly-structured-block-3.f90", "status": "modified", "additions": 2, "deletions": 2, "changes": 4, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/e633f82fb71817f3232688869c1eb59f60eb78ca/gcc%2Ftestsuite%2Fgfortran.dg%2Fgomp%2Fstrictly-structured-block-3.f90", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/e633f82fb71817f3232688869c1eb59f60eb78ca/gcc%2Ftestsuite%2Fgfortran.dg%2Fgomp%2Fstrictly-structured-block-3.f90", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgfortran.dg%2Fgomp%2Fstrictly-structured-block-3.f90?ref=e633f82fb71817f3232688869c1eb59f60eb78ca", "patch": "@@ -10,7 +10,7 @@ program main\n   !$omp parallel\n     !$omp parallel\n     block\n-      x = x + 1\n+      call do_work\n     end block\n     !$omp end parallel\n   !$omp end parallel\n@@ -32,7 +32,7 @@ program main\n     end block\n     x = x + 2\n     !$omp section\n-    x = x + 4\n+    call do_work\n   end block\n \n   !$omp sections"}]}