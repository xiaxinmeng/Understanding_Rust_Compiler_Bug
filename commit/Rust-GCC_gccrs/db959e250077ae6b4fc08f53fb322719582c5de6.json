{"sha": "db959e250077ae6b4fc08f53fb322719582c5de6", "node_id": "C_kwDOANBUbNoAKGRiOTU5ZTI1MDA3N2FlNmI0ZmMwOGY1M2ZiMzIyNzE5NTgyYzVkZTY", "commit": {"author": {"name": "Martin Jambor", "email": "mjambor@suse.cz", "date": "2023-01-18T14:29:54Z"}, "committer": {"name": "Martin Jambor", "email": "mjambor@suse.cz", "date": "2023-01-18T14:43:30Z"}, "message": "ipa: Release body more carefully when removing nodes (PR 107944)\n\nThe code removing function bodies when the last call graph clone of a\nnode is removed is too aggressive when there are nodes up the\nclone_of chain which still need them.  Fixed by expanding the check.\n\ngcc/ChangeLog:\n\n2023-01-18  Martin Jambor  <mjambor@suse.cz>\n\n\tPR ipa/107944\n\t* cgraph.cc (cgraph_node::remove): Check whether nodes up the\n\tlcone_of chain also do not need the body.", "tree": {"sha": "aedd0af0867c8c989cdf2f7df312e27d00305599", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/aedd0af0867c8c989cdf2f7df312e27d00305599"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/db959e250077ae6b4fc08f53fb322719582c5de6", "comment_count": 0, "verification": {"verified": true, "reason": "valid", "signature": "-----BEGIN PGP SIGNATURE-----\n\niQIzBAABCgAdFiEE5elVTFt/d09Vsoczv2PBvD+kNUAFAmPIBZIACgkQv2PBvD+k\nNUA9tg//Yinv0fux8CDr271scUxhgGmJs58F6fWpodMyJrgtEXFfSRQfWKC5YlL8\nVZJDQJ/bo4czNnuPmetMhKZS9jsujHjr6XuvzQYmpIisi2PYfChS7SizlnpIdOK6\nLLkF3834RVZYS0UDAMez48oRQzWf5WdZzwLsmi7azjvpj8/v2WAprS+/AVD2tgPu\nBtrsHhqTQcec0g7xxeO8AGZBQAXdJnVgdEL5C9+A997lyuVB6TliJCOn5tduPy/9\nyblg3mmHWRboLEWIZ0NKFWKInD58RuFl0pQ3Ls+x6//YXbmNkFzixNRtijJd0raT\nr5d7OVIjLJj2WpUK/woYYE72UzxBJE8g6r+W1Zj8/35u4uM4+K/lymNAx2Czrr0a\nwO8hgYK+PbJwf5asiWDFc3TU7RR/84jP6goTL2a5tJpIHkaKmmRGuzETRTw91sSd\nzttkz0h9/DacWOdUXtW7jzqv17w8aPpRPZ41wdCcaiT2GxjtP8GSp13bkQfJ4uD6\n1M6JplTEF6YQVnXf4OCNBEEq3/hN06/2HJ+aBatHTKOYs/9ooaiW5l6mOmu88B5p\nZ8i5x05aHGFy/BX+D068RbV4XSizCuQa228lONkBamWgfINlqBM+MJKB6eYVt+n9\nyzXtHdf5nnV131bb6e2+0NP84HfLkDTwUK51brDfSNddT/dX0OA=\n=CFeY\n-----END PGP SIGNATURE-----", "payload": "tree aedd0af0867c8c989cdf2f7df312e27d00305599\nparent d4abe5c456a3023f61c3e053255b7dd72ca0d7ec\nauthor Martin Jambor <mjambor@suse.cz> 1674052194 +0100\ncommitter Martin Jambor <mjambor@suse.cz> 1674053010 +0100\n\nipa: Release body more carefully when removing nodes (PR 107944)\n\nThe code removing function bodies when the last call graph clone of a\nnode is removed is too aggressive when there are nodes up the\nclone_of chain which still need them.  Fixed by expanding the check.\n\ngcc/ChangeLog:\n\n2023-01-18  Martin Jambor  <mjambor@suse.cz>\n\n\tPR ipa/107944\n\t* cgraph.cc (cgraph_node::remove): Check whether nodes up the\n\tlcone_of chain also do not need the body.\n"}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/db959e250077ae6b4fc08f53fb322719582c5de6", "html_url": "https://github.com/Rust-GCC/gccrs/commit/db959e250077ae6b4fc08f53fb322719582c5de6", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/db959e250077ae6b4fc08f53fb322719582c5de6/comments", "author": {"login": "jamborm", "id": 2180070, "node_id": "MDQ6VXNlcjIxODAwNzA=", "avatar_url": "https://avatars.githubusercontent.com/u/2180070?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jamborm", "html_url": "https://github.com/jamborm", "followers_url": "https://api.github.com/users/jamborm/followers", "following_url": "https://api.github.com/users/jamborm/following{/other_user}", "gists_url": "https://api.github.com/users/jamborm/gists{/gist_id}", "starred_url": "https://api.github.com/users/jamborm/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jamborm/subscriptions", "organizations_url": "https://api.github.com/users/jamborm/orgs", "repos_url": "https://api.github.com/users/jamborm/repos", "events_url": "https://api.github.com/users/jamborm/events{/privacy}", "received_events_url": "https://api.github.com/users/jamborm/received_events", "type": "User", "site_admin": false}, "committer": {"login": "jamborm", "id": 2180070, "node_id": "MDQ6VXNlcjIxODAwNzA=", "avatar_url": "https://avatars.githubusercontent.com/u/2180070?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jamborm", "html_url": "https://github.com/jamborm", "followers_url": "https://api.github.com/users/jamborm/followers", "following_url": "https://api.github.com/users/jamborm/following{/other_user}", "gists_url": "https://api.github.com/users/jamborm/gists{/gist_id}", "starred_url": "https://api.github.com/users/jamborm/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jamborm/subscriptions", "organizations_url": "https://api.github.com/users/jamborm/orgs", "repos_url": "https://api.github.com/users/jamborm/repos", "events_url": "https://api.github.com/users/jamborm/events{/privacy}", "received_events_url": "https://api.github.com/users/jamborm/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "d4abe5c456a3023f61c3e053255b7dd72ca0d7ec", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/d4abe5c456a3023f61c3e053255b7dd72ca0d7ec", "html_url": "https://github.com/Rust-GCC/gccrs/commit/d4abe5c456a3023f61c3e053255b7dd72ca0d7ec"}], "stats": {"total": 14, "additions": 12, "deletions": 2}, "files": [{"sha": "5f72ace9b57b16a74262055e7686f1916763de42", "filename": "gcc/cgraph.cc", "status": "modified", "additions": 12, "deletions": 2, "changes": 14, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/db959e250077ae6b4fc08f53fb322719582c5de6/gcc%2Fcgraph.cc", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/db959e250077ae6b4fc08f53fb322719582c5de6/gcc%2Fcgraph.cc", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fcgraph.cc?ref=db959e250077ae6b4fc08f53fb322719582c5de6", "patch": "@@ -1893,8 +1893,18 @@ cgraph_node::remove (void)\n   else if (clone_of)\n     {\n       clone_of->clones = next_sibling_clone;\n-      if (!clone_of->analyzed && !clone_of->clones && !clones)\n-\tclone_of->release_body ();\n+      if (!clones)\n+\t{\n+\t  bool need_body = false;\n+\t  for (cgraph_node *n = clone_of; n; n = n->clone_of)\n+\t    if (n->analyzed || n->clones)\n+\t      {\n+\t\tneed_body = true;\n+\t\tbreak;\n+\t      }\n+\t  if (!need_body)\n+\t    clone_of->release_body ();\n+\t}\n     }\n   if (next_sibling_clone)\n     next_sibling_clone->prev_sibling_clone = prev_sibling_clone;"}]}