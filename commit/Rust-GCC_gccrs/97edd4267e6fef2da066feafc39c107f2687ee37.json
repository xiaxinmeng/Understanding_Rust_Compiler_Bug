{"sha": "97edd4267e6fef2da066feafc39c107f2687ee37", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6OTdlZGQ0MjY3ZTZmZWYyZGEwNjZmZWFmYzM5YzEwN2YyNjg3ZWUzNw==", "commit": {"author": {"name": "Arnaud Charlet", "email": "charlet@adacore.com", "date": "2019-07-03T08:14:00Z"}, "committer": {"name": "Pierre-Marie de Rodat", "email": "pmderodat@gcc.gnu.org", "date": "2019-07-03T08:14:00Z"}, "message": "[Ada] Add a gnatbind option to generate C code\n\n2019-07-03  Arnaud Charlet  <charlet@adacore.com>\n\ngcc/ada/\n\n\t* bindgen.adb (Gen_Main): Disable generation of reference to\n\tAda_Main_Program_Name for CCG.\n\t* bindusg.adb (Display): Add -G to the command-line usage for\n\tgnatbind.\n\t* opt.ads (Generate_C_Code): Update comment.\n\t* switch-b.adb (Scan_Binder_Switches): Add handling for -G.\n\nFrom-SVN: r272965", "tree": {"sha": "c4db6474b9676fdbe1cf19491771c2c04c6b4a64", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/c4db6474b9676fdbe1cf19491771c2c04c6b4a64"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/97edd4267e6fef2da066feafc39c107f2687ee37", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/97edd4267e6fef2da066feafc39c107f2687ee37", "html_url": "https://github.com/Rust-GCC/gccrs/commit/97edd4267e6fef2da066feafc39c107f2687ee37", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/97edd4267e6fef2da066feafc39c107f2687ee37/comments", "author": {"login": "ArnaudCharlet", "id": 30291825, "node_id": "MDQ6VXNlcjMwMjkxODI1", "avatar_url": "https://avatars.githubusercontent.com/u/30291825?v=4", "gravatar_id": "", "url": "https://api.github.com/users/ArnaudCharlet", "html_url": "https://github.com/ArnaudCharlet", "followers_url": "https://api.github.com/users/ArnaudCharlet/followers", "following_url": "https://api.github.com/users/ArnaudCharlet/following{/other_user}", "gists_url": "https://api.github.com/users/ArnaudCharlet/gists{/gist_id}", "starred_url": "https://api.github.com/users/ArnaudCharlet/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/ArnaudCharlet/subscriptions", "organizations_url": "https://api.github.com/users/ArnaudCharlet/orgs", "repos_url": "https://api.github.com/users/ArnaudCharlet/repos", "events_url": "https://api.github.com/users/ArnaudCharlet/events{/privacy}", "received_events_url": "https://api.github.com/users/ArnaudCharlet/received_events", "type": "User", "site_admin": false}, "committer": null, "parents": [{"sha": "81c10c3f91cb42ecf1b32de800f09282bed31553", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/81c10c3f91cb42ecf1b32de800f09282bed31553", "html_url": "https://github.com/Rust-GCC/gccrs/commit/81c10c3f91cb42ecf1b32de800f09282bed31553"}], "stats": {"total": 33, "additions": 29, "deletions": 4}, "files": [{"sha": "755c9fb2bf792ffc1f249557d487dcf362fbf9de", "filename": "gcc/ada/ChangeLog", "status": "modified", "additions": 9, "deletions": 0, "changes": 9, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/97edd4267e6fef2da066feafc39c107f2687ee37/gcc%2Fada%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/97edd4267e6fef2da066feafc39c107f2687ee37/gcc%2Fada%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fada%2FChangeLog?ref=97edd4267e6fef2da066feafc39c107f2687ee37", "patch": "@@ -1,3 +1,12 @@\n+2019-07-03  Arnaud Charlet  <charlet@adacore.com>\n+\n+\t* bindgen.adb (Gen_Main): Disable generation of reference to\n+\tAda_Main_Program_Name for CCG.\n+\t* bindusg.adb (Display): Add -G to the command-line usage for\n+\tgnatbind.\n+\t* opt.ads (Generate_C_Code): Update comment.\n+\t* switch-b.adb (Scan_Binder_Switches): Add handling for -G.\n+\n 2019-07-03  Arnaud Charlet  <charlet@adacore.com>\n \n \t* sem_ch7.adb (Has_Referencer): Do not consider inlined"}, {"sha": "9efc873c3e44a1765a9bbfd6ca3fb7c836246db8", "filename": "gcc/ada/bindgen.adb", "status": "modified", "additions": 7, "deletions": 2, "changes": 9, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/97edd4267e6fef2da066feafc39c107f2687ee37/gcc%2Fada%2Fbindgen.adb", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/97edd4267e6fef2da066feafc39c107f2687ee37/gcc%2Fada%2Fbindgen.adb", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fada%2Fbindgen.adb?ref=97edd4267e6fef2da066feafc39c107f2687ee37", "patch": "@@ -1805,13 +1805,18 @@ package body Bindgen is\n       --  referenced elsewhere in the generated program, but is needed by\n       --  the debugger (that's why it is generated in the first place). The\n       --  reference stops Ada_Main_Program_Name from being optimized away by\n-      --  smart linkers, such as the AiX linker.\n+      --  smart linkers.\n \n       --  Because this variable is unused, we make this variable \"aliased\"\n       --  with a pragma Volatile in order to tell the compiler to preserve\n       --  this variable at any level of optimization.\n \n-      if Bind_Main_Program and not CodePeer_Mode then\n+      --  CodePeer and CCG do not need this extra code on the other hand.\n+\n+      if Bind_Main_Program\n+        and then not CodePeer_Mode\n+        and then not Generate_C_Code\n+      then\n          WBI (\"      Ensure_Reference : aliased System.Address := \" &\n               \"Ada_Main_Program_Name'Address;\");\n          WBI (\"      pragma Volatile (Ensure_Reference);\");"}, {"sha": "8c51d116feed162cf486610391a2bc1b79c9daee", "filename": "gcc/ada/bindusg.adb", "status": "modified", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/97edd4267e6fef2da066feafc39c107f2687ee37/gcc%2Fada%2Fbindusg.adb", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/97edd4267e6fef2da066feafc39c107f2687ee37/gcc%2Fada%2Fbindusg.adb", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fada%2Fbindusg.adb?ref=97edd4267e6fef2da066feafc39c107f2687ee37", "patch": "@@ -133,6 +133,11 @@ package body Bindusg is\n       Write_Line\n         (\"  -F        Force checking of elaboration Flags\");\n \n+      --  Line for -G switch\n+\n+      Write_Line\n+        (\"  -G        Generate binder file suitable for CCG\");\n+\n       --  Line for -h switch\n \n       Write_Line"}, {"sha": "16b5cbae00a64e2fe88a8dd16d97b36c332aa465", "filename": "gcc/ada/opt.ads", "status": "modified", "additions": 2, "deletions": 2, "changes": 4, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/97edd4267e6fef2da066feafc39c107f2687ee37/gcc%2Fada%2Fopt.ads", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/97edd4267e6fef2da066feafc39c107f2687ee37/gcc%2Fada%2Fopt.ads", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fada%2Fopt.ads?ref=97edd4267e6fef2da066feafc39c107f2687ee37", "patch": "@@ -746,9 +746,9 @@ package Opt is\n    --  file name with extension stripped.\n \n    Generate_C_Code : Boolean := False;\n-   --  GNAT\n+   --  GNAT, GNATBIND\n    --  If True, the Cprint circuitry to generate C code output is activated.\n-   --  Set True by use of -gnateg or -gnatd.V.\n+   --  Set True by use of -gnateg or -gnatd.V for GNAT, and -G for GNATBIND.\n \n    Generate_CodePeer_Messages : Boolean := False;\n    --  GNAT"}, {"sha": "fdba595166ece7226904ce388e8c68d103ae33cb", "filename": "gcc/ada/switch-b.adb", "status": "modified", "additions": 6, "deletions": 0, "changes": 6, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/97edd4267e6fef2da066feafc39c107f2687ee37/gcc%2Fada%2Fswitch-b.adb", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/97edd4267e6fef2da066feafc39c107f2687ee37/gcc%2Fada%2Fswitch-b.adb", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fada%2Fswitch-b.adb?ref=97edd4267e6fef2da066feafc39c107f2687ee37", "patch": "@@ -294,6 +294,12 @@ package body Switch.B is\n                Debugger_Level := 2;\n             end if;\n \n+         --  Processing for G switch\n+\n+         when 'G' =>\n+            Ptr := Ptr + 1;\n+            Generate_C_Code := True;\n+\n          --  Processing for h switch\n \n          when 'h' =>"}]}