{"sha": "f8ac7d8f35e7c4a5444d4e554cb822f6346c1f2b", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6ZjhhYzdkOGYzNWU3YzRhNTQ0NGQ0ZTU1NGNiODIyZjYzNDZjMWYyYg==", "commit": {"author": {"name": "Jakub Jelinek", "email": "jakub@gcc.gnu.org", "date": "2019-12-11T23:58:04Z"}, "committer": {"name": "Jakub Jelinek", "email": "jakub@gcc.gnu.org", "date": "2019-12-11T23:58:04Z"}, "message": "re PR fortran/92899 ([OpenMP] ICE in gfc_trans_omp_atomic, at fortran/trans-openmp.c:3769)\n\n\tPR fortran/92899\n\t* trans-openmp.c (gfc_trans_omp_atomic): For GFC_OMP_ATOMIC_SWAP,\n\tdo look through conversion on expr2 if any.\n\n\t* testsuite/libgomp.fortran/atomic1.f90: New test.\n\nFrom-SVN: r279266", "tree": {"sha": "7d20a573af1e06236f0853fb15c674f275417f72", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/7d20a573af1e06236f0853fb15c674f275417f72"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/f8ac7d8f35e7c4a5444d4e554cb822f6346c1f2b", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/f8ac7d8f35e7c4a5444d4e554cb822f6346c1f2b", "html_url": "https://github.com/Rust-GCC/gccrs/commit/f8ac7d8f35e7c4a5444d4e554cb822f6346c1f2b", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/f8ac7d8f35e7c4a5444d4e554cb822f6346c1f2b/comments", "author": null, "committer": null, "parents": [{"sha": "f5c03155aa77bdb065fed3c5a0031db45a850493", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/f5c03155aa77bdb065fed3c5a0031db45a850493", "html_url": "https://github.com/Rust-GCC/gccrs/commit/f5c03155aa77bdb065fed3c5a0031db45a850493"}], "stats": {"total": 60, "additions": 58, "deletions": 2}, "files": [{"sha": "5fae7f295e139dc707fd4daf6fa950d448c25f7f", "filename": "gcc/fortran/ChangeLog", "status": "modified", "additions": 7, "deletions": 1, "changes": 8, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/f8ac7d8f35e7c4a5444d4e554cb822f6346c1f2b/gcc%2Ffortran%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/f8ac7d8f35e7c4a5444d4e554cb822f6346c1f2b/gcc%2Ffortran%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ffortran%2FChangeLog?ref=f8ac7d8f35e7c4a5444d4e554cb822f6346c1f2b", "patch": "@@ -1,4 +1,10 @@\n-2019-12-11 Steven G. Kargl  <kargl@gcc.gnu.org>\n+2019-12-11  Jakub Jelinek  <jakub@redhat.com>\n+\n+\tPR fortran/92899\n+\t* trans-openmp.c (gfc_trans_omp_atomic): For GFC_OMP_ATOMIC_SWAP,\n+\tdo look through conversion on expr2 if any.\n+\n+2019-12-11  Steven G. Kargl  <kargl@gcc.gnu.org>\n \n \tPR fortran/92897\n \t* array.c (gfc_set_array_spec):  Remove invalid assert() triggered"}, {"sha": "b6da7b983d5e79115dc0e18676df91bb5bb67fd0", "filename": "gcc/fortran/trans-openmp.c", "status": "modified", "additions": 0, "deletions": 1, "changes": 1, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/f8ac7d8f35e7c4a5444d4e554cb822f6346c1f2b/gcc%2Ffortran%2Ftrans-openmp.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/f8ac7d8f35e7c4a5444d4e554cb822f6346c1f2b/gcc%2Ffortran%2Ftrans-openmp.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ffortran%2Ftrans-openmp.c?ref=f8ac7d8f35e7c4a5444d4e554cb822f6346c1f2b", "patch": "@@ -3534,7 +3534,6 @@ gfc_trans_omp_atomic (gfc_code *code)\n   expr2 = code->expr2;\n   if (((atomic_code->ext.omp_atomic & GFC_OMP_ATOMIC_MASK)\n        != GFC_OMP_ATOMIC_WRITE)\n-      && (atomic_code->ext.omp_atomic & GFC_OMP_ATOMIC_SWAP) == 0\n       && expr2->expr_type == EXPR_FUNCTION\n       && expr2->value.function.isym\n       && expr2->value.function.isym->id == GFC_ISYM_CONVERSION)"}, {"sha": "dda2d9a09fc6f3c7b2933479c7661ac95cf8984f", "filename": "libgomp/ChangeLog", "status": "modified", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/f8ac7d8f35e7c4a5444d4e554cb822f6346c1f2b/libgomp%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/f8ac7d8f35e7c4a5444d4e554cb822f6346c1f2b/libgomp%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libgomp%2FChangeLog?ref=f8ac7d8f35e7c4a5444d4e554cb822f6346c1f2b", "patch": "@@ -1,3 +1,8 @@\n+2019-12-11  Jakub Jelinek  <jakub@redhat.com>\n+\n+\tPR fortran/92899\n+\t* testsuite/libgomp.fortran/atomic1.f90: New test.\n+\n 2019-12-11  Thomas Schwinge  <thomas@codesourcery.com>\n \n \tPR libgomp/92843"}, {"sha": "e0c13536f940e14bbc2050c60c75c908ab02aaa8", "filename": "libgomp/testsuite/libgomp.fortran/atomic1.f90", "status": "added", "additions": 46, "deletions": 0, "changes": 46, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/f8ac7d8f35e7c4a5444d4e554cb822f6346c1f2b/libgomp%2Ftestsuite%2Flibgomp.fortran%2Fatomic1.f90", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/f8ac7d8f35e7c4a5444d4e554cb822f6346c1f2b/libgomp%2Ftestsuite%2Flibgomp.fortran%2Fatomic1.f90", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libgomp%2Ftestsuite%2Flibgomp.fortran%2Fatomic1.f90?ref=f8ac7d8f35e7c4a5444d4e554cb822f6346c1f2b", "patch": "@@ -0,0 +1,46 @@\n+! PR fortran/92899\n+\n+program pr92899\n+  real :: x = 1.0\n+  double precision :: y\n+  integer(kind=4) :: z = 4\n+  integer(kind=8) :: w\n+  !$omp atomic capture\n+  y = x\n+  x = 2.0\n+  !$omp end atomic\n+  if (y /= 1.0 .or. x /= 2.0) stop 1\n+  !$omp atomic capture\n+  x = y\n+  y = 3.0\n+  !$omp end atomic\n+  if (x /= 1.0 .or. y /= 3.0) stop 2\n+  !$omp atomic capture\n+  w = z\n+  z = 5\n+  !$omp end atomic\n+  if (w /= 4 .or. z /= 5) stop 3\n+  !$omp atomic capture\n+  z = w\n+  w = 6\n+  !$omp end atomic\n+  if (z /= 4 .or. w /= 6) stop 4\n+  !$omp atomic write\n+  x = y\n+  !$omp end atomic\n+  if (x /= 3.0 .or. y /= 3.0) stop 5\n+  x = 7.0\n+  !$omp atomic write\n+  y = x\n+  !$omp end atomic\n+  if (x /= 7.0 .or. y /= 7.0) stop 6\n+  !$omp atomic write\n+  z = w\n+  !$omp end atomic\n+  if (z /= 6 .or. w /= 6) stop 7\n+  z = 8\n+  !$omp atomic write\n+  w = z\n+  !$omp end atomic\n+  if (z /= 8 .or. w /= 8) stop 8\n+end"}]}