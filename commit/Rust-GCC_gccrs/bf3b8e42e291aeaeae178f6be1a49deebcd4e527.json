{"sha": "bf3b8e42e291aeaeae178f6be1a49deebcd4e527", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6YmYzYjhlNDJlMjkxYWVhZWFlMTc4ZjZiZTFhNDlkZWViY2Q0ZTUyNw==", "commit": {"author": {"name": "Hans Boehm", "email": "boehm@acm.org", "date": "2000-09-30T09:56:58Z"}, "committer": {"name": "Bryce McKinlay", "email": "bryce@gcc.gnu.org", "date": "2000-09-30T09:56:58Z"}, "message": "Implement bitmap descriptor based marking for Boehm GC.\n\n2000-09-30  Hans Boehm  <boehm@acm.org>\n\t    Bryce McKinlay  <bryce@albatross.co.nz>\n\n\tImplement bitmap descriptor based marking for Boehm GC.\n\n\t* configure.in: Define JC1GCSPEC. Set it if boehm-gc is used.\n\t* configure: Rebuilt.\n\t* libgcj.spec.in: Pass JC1GCSPEC to jc1.\n\t* include/jvm.h (struct _Jv_VTable): New field `gc_descr'. New inline\n\tmethod get_finalizer().\n\t(struct _Jv_ArrayVTable): Ditto. Declare method array with\n\tNUM_OBJECT_METHODS elements instead of NUM_OBJECT_METHODS + 1.\n\t(_Jv_AllocObj): Add new jclass parameter.\n\t(_Jv_AllocArray): Ditto.\n\t(_Jv_BuildGCDescr): New prototype.\n\t* prims.cc (_Jv_AllocObject): Rename parameter `c' to `klass'. Pass\n\t`klass' to _Jv_AllocObj. Don't set the new object's vtable. Use\n\tget_finalizer() instead of direct finalizer vtable offset.\n\t(_Jv_NewObjectArray): Rename parameter `clas' to `klass'. Pass\n\t`klass' to _Jv_AllocArray. Don't set the new array's vtable.\n\t(_Jv_NewPrimArray): Call _Jv_FindArrayClass before _Jv_AllocObj.\n\tPass `klass' to _Jv_AllocObj. Don't set the new array's vtable.\n\t* resolve.cc (METHOD_NOT_THERE, METHOD_INACCESSIBLE): New #defines.\n\t(_Jv_ResolvePoolEntry): Use METHOD_NOT_THERE and METHOD_INACCESSIBLE.\n\t(_Jv_DetermineVTableIndex): Ditto.\n\t(_Jv_PrepareClass): Ditto. Remove offset-by-one adjustments from vtable\n\tcalculations to account for new gc_descr field.\n\t* boehm.cc: #include gc_gcj.h.\n\t(obj_kind_x, obj_free_list): `#if 0'-ed away.\n\t(_Jv_MarkObj): Check that vtable doesn't point to a cleared object.\n\tNew commentary from HB. Mark the classes vtable.\n\t(_Jv_MarkArray): Check that vtable doesn't point to a cleared object.\n\t(GC_DEFAULT_DESCR): New #define.\n\t(_Jv_BuildGCDescr): New function. Use GC_DEFAULT_DESCR, for now.\n\t(_Jv_AllocObj): New parameter `klass'. Use GC_GCJ_MALLOC ().\n\t(_Jv_AllocArray): New parameter `klass'. Allocate with GC_MALLOC and\n\tscan conservativly if size is less than min_heap_addr. Set vtable\n\tpointer of new object before returning.\n\t(_Jv_AllocBytes): Use GC_MALLOC_ATOMIC, not GC_GENERIC_MALLOC.\n\t(_Jv_InitGC): Call GC_init_gcj_malloc(). Don't set up marking and\n\tallocation for obj_kind_x.\n\t* nogc.cc (_Jv_BuildGCDescr): New function. Return 0.\n\t(_Jv_AllocObj): Set vtable on returned object.\n\t(_Jv_AllocArray): Ditto.\n\t* java/lang/Class.h (_Jv_NewObjectArray): No longer a friend.\n\t(_Jv_NewPrimArray): Ditto.\n\t(_Jv_AllocObj): Declare as a friend.\n\t(_Jv_AllocArray): Ditto.\n\t* java/lang/natClassLoader.cc (_Jv_FindArrayClass): Copy gc_descr\n\tfrom &ObjectClass into new array class. Remove offset-by-one\n\tadjustments from `method' size calculations to account for gc_descr\n\tfield.\n\nCo-Authored-By: Bryce McKinlay <bryce@albatross.co.nz>\n\nFrom-SVN: r36679", "tree": {"sha": "546907bd61de305c953b5ae99d05489fc543bc16", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/546907bd61de305c953b5ae99d05489fc543bc16"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/bf3b8e42e291aeaeae178f6be1a49deebcd4e527", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/bf3b8e42e291aeaeae178f6be1a49deebcd4e527", "html_url": "https://github.com/Rust-GCC/gccrs/commit/bf3b8e42e291aeaeae178f6be1a49deebcd4e527", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/bf3b8e42e291aeaeae178f6be1a49deebcd4e527/comments", "author": {"login": "hboehm", "id": 1000362, "node_id": "MDQ6VXNlcjEwMDAzNjI=", "avatar_url": "https://avatars.githubusercontent.com/u/1000362?v=4", "gravatar_id": "", "url": "https://api.github.com/users/hboehm", "html_url": "https://github.com/hboehm", "followers_url": "https://api.github.com/users/hboehm/followers", "following_url": "https://api.github.com/users/hboehm/following{/other_user}", "gists_url": "https://api.github.com/users/hboehm/gists{/gist_id}", "starred_url": "https://api.github.com/users/hboehm/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/hboehm/subscriptions", "organizations_url": "https://api.github.com/users/hboehm/orgs", "repos_url": "https://api.github.com/users/hboehm/repos", "events_url": "https://api.github.com/users/hboehm/events{/privacy}", "received_events_url": "https://api.github.com/users/hboehm/received_events", "type": "User", "site_admin": false}, "committer": null, "parents": [{"sha": "0476f09843348e065b11bac1265b723266b85fd5", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/0476f09843348e065b11bac1265b723266b85fd5", "html_url": "https://github.com/Rust-GCC/gccrs/commit/0476f09843348e065b11bac1265b723266b85fd5"}], "stats": {"total": 638, "additions": 412, "deletions": 226}, "files": [{"sha": "543d04b58836b888fe9895ac33a150f5ac76d905", "filename": "libjava/ChangeLog", "status": "modified", "additions": 53, "deletions": 0, "changes": 53, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/bf3b8e42e291aeaeae178f6be1a49deebcd4e527/libjava%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/bf3b8e42e291aeaeae178f6be1a49deebcd4e527/libjava%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libjava%2FChangeLog?ref=bf3b8e42e291aeaeae178f6be1a49deebcd4e527", "patch": "@@ -1,3 +1,56 @@\n+2000-09-30  Hans Boehm  <boehm@acm.org>\n+\t    Bryce McKinlay  <bryce@albatross.co.nz>\n+\t    \n+\tImplement bitmap descriptor based marking for Boehm GC.\n+\n+\t* configure.in: Define JC1GCSPEC. Set it if boehm-gc is used.\n+\t* configure: Rebuilt.\n+\t* libgcj.spec.in: Pass JC1GCSPEC to jc1.\n+\t* include/jvm.h (struct _Jv_VTable): New field `gc_descr'. New inline\n+\tmethod get_finalizer().\n+\t(struct _Jv_ArrayVTable): Ditto. Declare method array with \n+\tNUM_OBJECT_METHODS elements instead of NUM_OBJECT_METHODS + 1.\n+\t(_Jv_AllocObj): Add new jclass parameter.\n+\t(_Jv_AllocArray): Ditto.\n+\t(_Jv_BuildGCDescr): New prototype.\n+\t* prims.cc (_Jv_AllocObject): Rename parameter `c' to `klass'. Pass\n+\t`klass' to _Jv_AllocObj. Don't set the new object's vtable. Use\n+\tget_finalizer() instead of direct finalizer vtable offset.\n+\t(_Jv_NewObjectArray): Rename parameter `clas' to `klass'. Pass\n+\t`klass' to _Jv_AllocArray. Don't set the new array's vtable.\n+\t(_Jv_NewPrimArray): Call _Jv_FindArrayClass before _Jv_AllocObj. Pass\n+\t`klass' to _Jv_AllocObj. Don't set the new array's vtable.\n+\t* resolve.cc (METHOD_NOT_THERE, METHOD_INACCESSIBLE): New #defines.\n+\t(_Jv_ResolvePoolEntry): Use METHOD_NOT_THERE and METHOD_INACCESSIBLE.\n+\t(_Jv_DetermineVTableIndex): Ditto.\n+\t(_Jv_PrepareClass): Ditto. Remove offset-by-one adjustments from vtable \n+\tcalculations to account for new gc_descr field.\n+\t* boehm.cc: #include gc_gcj.h.\n+\t(obj_kind_x, obj_free_list): `#if 0'-ed away.\n+\t(_Jv_MarkObj): Check that vtable doesn't point to a cleared object.\n+\tNew commentary from HB. Mark the classes vtable.\n+\t(_Jv_MarkArray): Check that vtable doesn't point to a cleared object.\n+\t(GC_DEFAULT_DESCR): New #define.\n+\t(_Jv_BuildGCDescr): New function. Use GC_DEFAULT_DESCR, for now.\t\n+\t(_Jv_AllocObj): New parameter `klass'. Use GC_GCJ_MALLOC ().\n+\t(_Jv_AllocArray): New parameter `klass'. Allocate with GC_MALLOC and\n+\tscan conservativly if size is less than min_heap_addr. Set vtable \n+\tpointer of new object before returning.\n+\t(_Jv_AllocBytes): Use GC_MALLOC_ATOMIC, not GC_GENERIC_MALLOC.\n+\t(_Jv_InitGC): Call GC_init_gcj_malloc(). Don't set up marking and\n+\tallocation for obj_kind_x.\n+\t* nogc.cc (_Jv_BuildGCDescr): New function. Return 0.\n+\t(_Jv_AllocObj): Set vtable on returned object.\n+\t(_Jv_AllocArray): Ditto.\n+\t* java/lang/Class.h (_Jv_NewObjectArray): No longer a friend.\n+\t(_Jv_NewPrimArray): Ditto.\n+\t(_Jv_AllocObj): Declare as a friend.\n+\t(_Jv_AllocArray): Ditto.\t\n+\t* java/lang/natClassLoader.cc (_Jv_FindArrayClass): Copy gc_descr\n+\tfrom &ObjectClass into new array class. Remove offset-by-one \n+\tadjustments from `method' size calculations to account for gc_descr \n+\tfield.\n+\n 2000-09-26  Tom Tromey  <tromey@cygnus.com>\n \n \t* java/awt/Scrollbar.java (removeAdjustmentListener): Use"}, {"sha": "f0d679c06acad588afa9182b287bcef1ea5f6b78", "filename": "libjava/boehm.cc", "status": "modified", "additions": 130, "deletions": 21, "changes": 151, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/bf3b8e42e291aeaeae178f6be1a49deebcd4e527/libjava%2Fboehm.cc", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/bf3b8e42e291aeaeae178f6be1a49deebcd4e527/libjava%2Fboehm.cc", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libjava%2Fboehm.cc?ref=bf3b8e42e291aeaeae178f6be1a49deebcd4e527", "patch": "@@ -28,6 +28,7 @@ extern \"C\"\n {\n #include <gc_priv.h>\n #include <gc_mark.h>\n+#include <include/gc_gcj.h>\n \n   // These aren't declared in any Boehm GC header.\n   void GC_finalize_all (void);\n@@ -58,14 +59,16 @@ extern java::lang::Class ClassClass;\n // Nonzero if this module has been initialized.\n static int initialized = 0;\n \n+#if 0\n // `kind' index used when allocating Java objects.\n static int obj_kind_x;\n \n-// `kind' index used when allocating Java arrays.\n-static int array_kind_x;\n-\n // Freelist used for Java objects.\n static ptr_t *obj_free_list;\n+#endif /* 0 */\n+\n+// `kind' index used when allocating Java arrays.\n+static int array_kind_x;\n \n // Freelist used for Java arrays.\n static ptr_t *array_free_list;\n@@ -79,16 +82,24 @@ static _Jv_Mutex_t disable_gc_mutex;\n // object.  We use `void *' arguments and return, and not what the\n // Boehm GC wants, to avoid pollution in our headers.\n void *\n-_Jv_MarkObj (void *addr, void *msp, void *msl, void * /*env*/)\n+_Jv_MarkObj (void *addr, void *msp, void *msl, void * /* env */)\n {\n   mse *mark_stack_ptr = (mse *) msp;\n   mse *mark_stack_limit = (mse *) msl;\n   jobject obj = (jobject) addr;\n \n+  // FIXME: if env is 1, this object was allocated through the debug\n+  // interface, and addr points to the beginning of the debug header.\n+  // In that case, we should really add the size of the header to addr.\n+\n   _Jv_VTable *dt = *(_Jv_VTable **) addr;\n-  // We check this in case a GC occurs before the vtbl is set.  FIXME:\n-  // should use allocation lock while initializing object.\n-  if (__builtin_expect (! dt, false))\n+  // The object might not yet have its vtable set, or it might\n+  // really be an object on the freelist.  In either case, the vtable slot\n+  // will either be 0, or it will point to a cleared object.\n+  // This assumes Java objects have size at least 3 words,\n+  // including the header.   But this should remain true, since this\n+  // should only be used with debugging allocation or with large objects.\n+  if (__builtin_expect (! dt || !(dt -> get_finalizer()), false))\n     return mark_stack_ptr;\n   jclass klass = dt->clas;\n \n@@ -101,6 +112,18 @@ _Jv_MarkObj (void *addr, void *msp, void *msl, void * /*env*/)\n \n   if (__builtin_expect (klass == &ClassClass, false))\n     {\n+      // Currently we allocate some of the memory referenced from class objects\n+      // as pointerfree memory, and then mark it more intelligently here.\n+      // We ensure that the ClassClass mark descriptor forces invocation of\n+      // this procedure.\n+      // Correctness of this is subtle, but it looks OK to me for now.  For the incremental\n+      // collector, we need to make sure that the class object is written whenever\n+      // any of the subobjects are altered and may need rescanning.  This may be tricky\n+      // during construction, and this may not be the right way to do this with\n+      // incremental collection.\n+      // If we overflow the mark stack, we will rescan the class object, so we should\n+      // be OK.  The same applies if we redo the mark phase because win32 unmapped part\n+      // of our root set.\t\t- HB\n       jclass c = (jclass) addr;\n \n       p = (ptr_t) c->name;\n@@ -121,6 +144,8 @@ _Jv_MarkObj (void *addr, void *msp, void *msl, void * /*env*/)\n \t  MAYBE_MARK (p, mark_stack_ptr, mark_stack_limit, c, c5alabel);\n \t  p = (ptr_t) c->constants.data;\n \t  MAYBE_MARK (p, mark_stack_ptr, mark_stack_limit, c, c5blabel);\n+\t  p = (ptr_t) c->vtable;\n+\t  MAYBE_MARK (p, mark_stack_ptr, mark_stack_limit, c, c5clabel);\n \t}\n #endif\n \n@@ -272,9 +297,10 @@ _Jv_MarkArray (void *addr, void *msp, void *msl, void * /*env*/)\n   jobjectArray array = (jobjectArray) addr;\n \n   _Jv_VTable *dt = *(_Jv_VTable **) addr;\n-  // We check this in case a GC occurs before the vtbl is set.  FIXME:\n-  // should use allocation lock while initializing object.\n-  if (__builtin_expect (! dt, false))\n+  // Assumes size >= 3 words.  That's currently true since arrays have\n+  // a vtable, sync pointer, and size.  If the sync pointer goes away,\n+  // we may need to round up the size.\n+  if (__builtin_expect (! dt || !(dt -> get_finalizer()), false))\n     return mark_stack_ptr;\n   jclass klass = dt->clas;\n \n@@ -295,29 +321,61 @@ _Jv_MarkArray (void *addr, void *msp, void *msl, void * /*env*/)\n   return mark_stack_ptr;\n }\n \n-// Allocate space for a new Java object.  FIXME: this might be the\n-// wrong interface; we might prefer to pass in the object type as\n-// well.  It isn't important for this collector, but it might be for\n-// other collectors.\n+// Return GC descriptor for interpreted class\n+#ifdef INTERPRETER\n+\n+// We assume that the gcj mark proc has index 0.  This is a dubious assumption,\n+// since another one could be registered first.  But the compiler also\n+// knows this, so in that case everything else will break, too.\n+#define GCJ_DEFAULT_DESCR MAKE_PROC(GCJ_RESERVED_MARK_PROC_INDEX,0)\n+void *\n+_Jv_BuildGCDescr(jclass klass)\n+{\n+  /* FIXME: We should really look at the class and build the descriptor. */\n+  return (void *)(GCJ_DEFAULT_DESCR);\n+}\n+#endif\n+\n+// Allocate space for a new Java object.\n void *\n-_Jv_AllocObj (jsize size)\n+_Jv_AllocObj (jsize size, jclass klass)\n {\n-  return GC_GENERIC_MALLOC (size, obj_kind_x);\n+  return GC_GCJ_MALLOC (size, klass->vtable);\n }\n \n-// Allocate space for a new Java array.  FIXME: again, this might be\n-// the wrong interface.\n+// Allocate space for a new Java array.\n+// Used only for arrays of objects.\n void *\n-_Jv_AllocArray (jsize size)\n+_Jv_AllocArray (jsize size, jclass klass)\n {\n-  return GC_GENERIC_MALLOC (size, array_kind_x);\n+  void *obj;\n+  const jsize min_heap_addr = 16*1024;\n+  // A heuristic.  If size is less than this value, the size\n+  // stored in the array can't possibly be misinterpreted as\n+  // a pointer.   Thus we lose nothing by scanning the object\n+  // completely conservatively, since no misidentification can\n+  // take place.\n+  \n+#ifdef GC_DEBUG\n+  // There isn't much to lose by scanning this conservatively.\n+  // If we didn't, the mark proc would have to understand that\n+  // it needed to skip the header.\n+  obj = GC_MALLOC(size);\n+#else\n+  if (size < min_heap_addr) \n+    obj = GC_MALLOC(size);\n+  else \n+    obj = GC_GENERIC_MALLOC (size, array_kind_x);\n+#endif\n+  *((_Jv_VTable **) obj) = klass->vtable;\n+  return obj;\n }\n \n // Allocate some space that is known to be pointer-free.\n void *\n _Jv_AllocBytes (jsize size)\n {\n-  void *r = GC_GENERIC_MALLOC (size, PTRFREE);\n+  void *r = GC_MALLOC_ATOMIC (size);\n   // We have to explicitly zero memory here, as the GC doesn't\n   // guarantee that PTRFREE allocations are zeroed.  Note that we\n   // don't have to do this for other allocation types because we set\n@@ -423,6 +481,56 @@ _Jv_InitGC (void)\n       return;\n     }\n   initialized = 1;\n+  UNLOCK ();\n+\n+  // Configure the collector to use the bitmap marking descriptors that we\n+  // stash in the class vtable.\n+  GC_init_gcj_malloc (0, (void *) _Jv_MarkObj);  \n+\n+  LOCK ();\n+  GC_java_finalization = 1;\n+\n+  // We use a different mark procedure for object arrays. This code \n+  // configures a different object `kind' for object array allocation and\n+  // marking. FIXME: see above.\n+  array_free_list = (ptr_t *) GC_generic_malloc_inner ((MAXOBJSZ + 1)\n+\t\t\t\t\t\t       * sizeof (ptr_t),\n+\t\t\t\t\t\t       PTRFREE);\n+  memset (array_free_list, 0, (MAXOBJSZ + 1) * sizeof (ptr_t));\n+\n+  proc = GC_n_mark_procs++;\n+  GC_mark_procs[proc] = (mark_proc) _Jv_MarkArray;\n+\n+  array_kind_x = GC_n_kinds++;\n+  GC_obj_kinds[array_kind_x].ok_freelist = array_free_list;\n+  GC_obj_kinds[array_kind_x].ok_reclaim_list = 0;\n+  GC_obj_kinds[array_kind_x].ok_descriptor = MAKE_PROC (proc, 0);\n+  GC_obj_kinds[array_kind_x].ok_relocate_descr = FALSE;\n+  GC_obj_kinds[array_kind_x].ok_init = TRUE;\n+\n+  _Jv_MutexInit (&disable_gc_mutex);\n+\n+  UNLOCK ();\n+  ENABLE_SIGNALS ();\n+}\n+\n+#if 0\n+void\n+_Jv_InitGC (void)\n+{\n+  int proc;\n+  DCL_LOCK_STATE;\n+\n+  DISABLE_SIGNALS ();\n+  LOCK ();\n+\n+  if (initialized)\n+   {\n+     UNLOCK ();\n+     ENABLE_SIGNALS ();\n+     return;\n+   }\n+  initialized = 1;\n \n   GC_java_finalization = 1;\n \n@@ -464,3 +572,4 @@ _Jv_InitGC (void)\n   UNLOCK ();\n   ENABLE_SIGNALS ();\n }\n+#endif /* 0 */"}, {"sha": "e4a5528c0ea50731b3381c86c93dba0eabb10910", "filename": "libjava/configure", "status": "modified", "additions": 157, "deletions": 153, "changes": 310, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/bf3b8e42e291aeaeae178f6be1a49deebcd4e527/libjava%2Fconfigure", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/bf3b8e42e291aeaeae178f6be1a49deebcd4e527/libjava%2Fconfigure", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libjava%2Fconfigure?ref=bf3b8e42e291aeaeae178f6be1a49deebcd4e527", "patch": "@@ -2995,6 +2995,7 @@ GCINCS=\n GCDEPS=\n GCOBJS=\n GCSPEC=\n+JC1GCSPEC=\n GCTESTSPEC=\n case \"$GC\" in\n  boehm)\n@@ -3005,6 +3006,7 @@ case \"$GC\" in\n     GCLIBS=\"$GCDEPS -L\\$(here)/../boehm-gc/$libsubdir\"\n     GCINCS='-I$(top_srcdir)/../boehm-gc -I$(top_builddir)/../boehm-gc'\n     GCSPEC='-lgcjgc'\n+    JC1GCSPEC='-fuse-boehm-gc'\n     GCTESTSPEC=\"-L`pwd`/../boehm-gc/.libs -rpath `pwd`/../boehm-gc/.libs\"\n             GCINCS=\"$GCINCS `cat ../boehm-gc/boehm-cflags`\"\n     GCOBJS=boehm.lo\n@@ -3032,8 +3034,9 @@ esac\n \n \n \n+\n echo $ac_n \"checking for threads package to use\"\"... $ac_c\" 1>&6\n-echo \"configure:3037: checking for threads package to use\" >&5\n+echo \"configure:3040: checking for threads package to use\" >&5\n # Check whether --enable-threads or --disable-threads was given.\n if test \"${enable_threads+set}\" = set; then\n   enableval=\"$enable_threads\"\n@@ -3227,12 +3230,12 @@ else\n    for ac_func in strerror ioctl select fstat open fsync sleep\n do\n echo $ac_n \"checking for $ac_func\"\"... $ac_c\" 1>&6\n-echo \"configure:3231: checking for $ac_func\" >&5\n+echo \"configure:3234: checking for $ac_func\" >&5\n if eval \"test \\\"`echo '$''{'ac_cv_func_$ac_func'+set}'`\\\" = set\"; then\n   echo $ac_n \"(cached) $ac_c\" 1>&6\n else\n   cat > conftest.$ac_ext <<EOF\n-#line 3236 \"configure\"\n+#line 3239 \"configure\"\n #include \"confdefs.h\"\n /* System header to define __stub macros and hopefully few prototypes,\n     which can conflict with char $ac_func(); below.  */\n@@ -3255,7 +3258,7 @@ $ac_func();\n \n ; return 0; }\n EOF\n-if { (eval echo configure:3259: \\\"$ac_link\\\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest${ac_exeext}; then\n+if { (eval echo configure:3262: \\\"$ac_link\\\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest${ac_exeext}; then\n   rm -rf conftest*\n   eval \"ac_cv_func_$ac_func=yes\"\n else\n@@ -3282,12 +3285,12 @@ done\n    for ac_func in gmtime_r localtime_r readdir_r getpwuid_r getcwd\n do\n echo $ac_n \"checking for $ac_func\"\"... $ac_c\" 1>&6\n-echo \"configure:3286: checking for $ac_func\" >&5\n+echo \"configure:3289: checking for $ac_func\" >&5\n if eval \"test \\\"`echo '$''{'ac_cv_func_$ac_func'+set}'`\\\" = set\"; then\n   echo $ac_n \"(cached) $ac_c\" 1>&6\n else\n   cat > conftest.$ac_ext <<EOF\n-#line 3291 \"configure\"\n+#line 3294 \"configure\"\n #include \"confdefs.h\"\n /* System header to define __stub macros and hopefully few prototypes,\n     which can conflict with char $ac_func(); below.  */\n@@ -3310,7 +3313,7 @@ $ac_func();\n \n ; return 0; }\n EOF\n-if { (eval echo configure:3314: \\\"$ac_link\\\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest${ac_exeext}; then\n+if { (eval echo configure:3317: \\\"$ac_link\\\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest${ac_exeext}; then\n   rm -rf conftest*\n   eval \"ac_cv_func_$ac_func=yes\"\n else\n@@ -3337,12 +3340,12 @@ done\n    for ac_func in access stat mkdir rename rmdir unlink realpath\n do\n echo $ac_n \"checking for $ac_func\"\"... $ac_c\" 1>&6\n-echo \"configure:3341: checking for $ac_func\" >&5\n+echo \"configure:3344: checking for $ac_func\" >&5\n if eval \"test \\\"`echo '$''{'ac_cv_func_$ac_func'+set}'`\\\" = set\"; then\n   echo $ac_n \"(cached) $ac_c\" 1>&6\n else\n   cat > conftest.$ac_ext <<EOF\n-#line 3346 \"configure\"\n+#line 3349 \"configure\"\n #include \"confdefs.h\"\n /* System header to define __stub macros and hopefully few prototypes,\n     which can conflict with char $ac_func(); below.  */\n@@ -3365,7 +3368,7 @@ $ac_func();\n \n ; return 0; }\n EOF\n-if { (eval echo configure:3369: \\\"$ac_link\\\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest${ac_exeext}; then\n+if { (eval echo configure:3372: \\\"$ac_link\\\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest${ac_exeext}; then\n   rm -rf conftest*\n   eval \"ac_cv_func_$ac_func=yes\"\n else\n@@ -3392,12 +3395,12 @@ done\n    for ac_func in iconv nl_langinfo\n do\n echo $ac_n \"checking for $ac_func\"\"... $ac_c\" 1>&6\n-echo \"configure:3396: checking for $ac_func\" >&5\n+echo \"configure:3399: checking for $ac_func\" >&5\n if eval \"test \\\"`echo '$''{'ac_cv_func_$ac_func'+set}'`\\\" = set\"; then\n   echo $ac_n \"(cached) $ac_c\" 1>&6\n else\n   cat > conftest.$ac_ext <<EOF\n-#line 3401 \"configure\"\n+#line 3404 \"configure\"\n #include \"confdefs.h\"\n /* System header to define __stub macros and hopefully few prototypes,\n     which can conflict with char $ac_func(); below.  */\n@@ -3420,7 +3423,7 @@ $ac_func();\n \n ; return 0; }\n EOF\n-if { (eval echo configure:3424: \\\"$ac_link\\\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest${ac_exeext}; then\n+if { (eval echo configure:3427: \\\"$ac_link\\\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest${ac_exeext}; then\n   rm -rf conftest*\n   eval \"ac_cv_func_$ac_func=yes\"\n else\n@@ -3447,12 +3450,12 @@ done\n    for ac_func in inet_aton inet_addr\n do\n echo $ac_n \"checking for $ac_func\"\"... $ac_c\" 1>&6\n-echo \"configure:3451: checking for $ac_func\" >&5\n+echo \"configure:3454: checking for $ac_func\" >&5\n if eval \"test \\\"`echo '$''{'ac_cv_func_$ac_func'+set}'`\\\" = set\"; then\n   echo $ac_n \"(cached) $ac_c\" 1>&6\n else\n   cat > conftest.$ac_ext <<EOF\n-#line 3456 \"configure\"\n+#line 3459 \"configure\"\n #include \"confdefs.h\"\n /* System header to define __stub macros and hopefully few prototypes,\n     which can conflict with char $ac_func(); below.  */\n@@ -3475,7 +3478,7 @@ $ac_func();\n \n ; return 0; }\n EOF\n-if { (eval echo configure:3479: \\\"$ac_link\\\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest${ac_exeext}; then\n+if { (eval echo configure:3482: \\\"$ac_link\\\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest${ac_exeext}; then\n   rm -rf conftest*\n   eval \"ac_cv_func_$ac_func=yes\"\n else\n@@ -3502,12 +3505,12 @@ done\n    for ac_func in inet_pton uname inet_ntoa\n do\n echo $ac_n \"checking for $ac_func\"\"... $ac_c\" 1>&6\n-echo \"configure:3506: checking for $ac_func\" >&5\n+echo \"configure:3509: checking for $ac_func\" >&5\n if eval \"test \\\"`echo '$''{'ac_cv_func_$ac_func'+set}'`\\\" = set\"; then\n   echo $ac_n \"(cached) $ac_c\" 1>&6\n else\n   cat > conftest.$ac_ext <<EOF\n-#line 3511 \"configure\"\n+#line 3514 \"configure\"\n #include \"confdefs.h\"\n /* System header to define __stub macros and hopefully few prototypes,\n     which can conflict with char $ac_func(); below.  */\n@@ -3530,7 +3533,7 @@ $ac_func();\n \n ; return 0; }\n EOF\n-if { (eval echo configure:3534: \\\"$ac_link\\\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest${ac_exeext}; then\n+if { (eval echo configure:3537: \\\"$ac_link\\\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest${ac_exeext}; then\n   rm -rf conftest*\n   eval \"ac_cv_func_$ac_func=yes\"\n else\n@@ -3557,12 +3560,12 @@ done\n    for ac_func in backtrace fork execvp pipe\n do\n echo $ac_n \"checking for $ac_func\"\"... $ac_c\" 1>&6\n-echo \"configure:3561: checking for $ac_func\" >&5\n+echo \"configure:3564: checking for $ac_func\" >&5\n if eval \"test \\\"`echo '$''{'ac_cv_func_$ac_func'+set}'`\\\" = set\"; then\n   echo $ac_n \"(cached) $ac_c\" 1>&6\n else\n   cat > conftest.$ac_ext <<EOF\n-#line 3566 \"configure\"\n+#line 3569 \"configure\"\n #include \"confdefs.h\"\n /* System header to define __stub macros and hopefully few prototypes,\n     which can conflict with char $ac_func(); below.  */\n@@ -3585,7 +3588,7 @@ $ac_func();\n \n ; return 0; }\n EOF\n-if { (eval echo configure:3589: \\\"$ac_link\\\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest${ac_exeext}; then\n+if { (eval echo configure:3592: \\\"$ac_link\\\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest${ac_exeext}; then\n   rm -rf conftest*\n   eval \"ac_cv_func_$ac_func=yes\"\n else\n@@ -3613,17 +3616,17 @@ done\n do\n ac_safe=`echo \"$ac_hdr\" | sed 'y%./+-%__p_%'`\n echo $ac_n \"checking for $ac_hdr\"\"... $ac_c\" 1>&6\n-echo \"configure:3617: checking for $ac_hdr\" >&5\n+echo \"configure:3620: checking for $ac_hdr\" >&5\n if eval \"test \\\"`echo '$''{'ac_cv_header_$ac_safe'+set}'`\\\" = set\"; then\n   echo $ac_n \"(cached) $ac_c\" 1>&6\n else\n   cat > conftest.$ac_ext <<EOF\n-#line 3622 \"configure\"\n+#line 3625 \"configure\"\n #include \"confdefs.h\"\n #include <$ac_hdr>\n EOF\n ac_try=\"$ac_cpp conftest.$ac_ext >/dev/null 2>conftest.out\"\n-{ (eval echo configure:3627: \\\"$ac_try\\\") 1>&5; (eval $ac_try) 2>&5; }\n+{ (eval echo configure:3630: \\\"$ac_try\\\") 1>&5; (eval $ac_try) 2>&5; }\n ac_err=`grep -v '^ *+' conftest.out | grep -v \"^conftest.${ac_ext}\\$\"`\n if test -z \"$ac_err\"; then\n   rm -rf conftest*\n@@ -3650,15 +3653,15 @@ fi\n done\n  \n    echo $ac_n \"checking for dladdr in -ldl\"\"... $ac_c\" 1>&6\n-echo \"configure:3654: checking for dladdr in -ldl\" >&5\n+echo \"configure:3657: checking for dladdr in -ldl\" >&5\n ac_lib_var=`echo dl'_'dladdr | sed 'y%./+-%__p_%'`\n if eval \"test \\\"`echo '$''{'ac_cv_lib_$ac_lib_var'+set}'`\\\" = set\"; then\n   echo $ac_n \"(cached) $ac_c\" 1>&6\n else\n   ac_save_LIBS=\"$LIBS\"\n LIBS=\"-ldl  $LIBS\"\n cat > conftest.$ac_ext <<EOF\n-#line 3662 \"configure\"\n+#line 3665 \"configure\"\n #include \"confdefs.h\"\n /* Override any gcc2 internal prototype to avoid an error.  */\n /* We use char because int might match the return type of a gcc2\n@@ -3669,7 +3672,7 @@ int main() {\n dladdr()\n ; return 0; }\n EOF\n-if { (eval echo configure:3673: \\\"$ac_link\\\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest${ac_exeext}; then\n+if { (eval echo configure:3676: \\\"$ac_link\\\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest${ac_exeext}; then\n   rm -rf conftest*\n   eval \"ac_cv_lib_$ac_lib_var=yes\"\n else\n@@ -3698,7 +3701,7 @@ do\n \n ac_safe=`echo \"$ac_file\" | sed 'y%./+-%__p_%'`\n echo $ac_n \"checking for $ac_file\"\"... $ac_c\" 1>&6\n-echo \"configure:3702: checking for $ac_file\" >&5\n+echo \"configure:3705: checking for $ac_file\" >&5\n if eval \"test \\\"`echo '$''{'ac_cv_file_$ac_safe'+set}'`\\\" = set\"; then\n   echo $ac_n \"(cached) $ac_c\" 1>&6\n else\n@@ -3733,12 +3736,12 @@ done\n    for ac_func in gethostbyname_r\n do\n echo $ac_n \"checking for $ac_func\"\"... $ac_c\" 1>&6\n-echo \"configure:3737: checking for $ac_func\" >&5\n+echo \"configure:3740: checking for $ac_func\" >&5\n if eval \"test \\\"`echo '$''{'ac_cv_func_$ac_func'+set}'`\\\" = set\"; then\n   echo $ac_n \"(cached) $ac_c\" 1>&6\n else\n   cat > conftest.$ac_ext <<EOF\n-#line 3742 \"configure\"\n+#line 3745 \"configure\"\n #include \"confdefs.h\"\n /* System header to define __stub macros and hopefully few prototypes,\n     which can conflict with char $ac_func(); below.  */\n@@ -3761,7 +3764,7 @@ $ac_func();\n \n ; return 0; }\n EOF\n-if { (eval echo configure:3765: \\\"$ac_link\\\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest${ac_exeext}; then\n+if { (eval echo configure:3768: \\\"$ac_link\\\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest${ac_exeext}; then\n   rm -rf conftest*\n   eval \"ac_cv_func_$ac_func=yes\"\n else\n@@ -3788,7 +3791,7 @@ EOF\n      # We look for the one that returns `int'.\n      # Hopefully this check is robust enough.\n      cat > conftest.$ac_ext <<EOF\n-#line 3792 \"configure\"\n+#line 3795 \"configure\"\n #include \"confdefs.h\"\n #include <netdb.h>\n EOF\n@@ -3808,7 +3811,7 @@ rm -f conftest*\n      *\" -D_REENTRANT \"*) ;;\n      *)\n \t\techo $ac_n \"checking whether gethostbyname_r declaration requires -D_REENTRANT\"\"... $ac_c\" 1>&6\n-echo \"configure:3812: checking whether gethostbyname_r declaration requires -D_REENTRANT\" >&5\n+echo \"configure:3815: checking whether gethostbyname_r declaration requires -D_REENTRANT\" >&5\n if eval \"test \\\"`echo '$''{'libjava_cv_gethostbyname_r_needs_reentrant'+set}'`\\\" = set\"; then\n   echo $ac_n \"(cached) $ac_c\" 1>&6\n else\n@@ -3821,14 +3824,14 @@ ac_link='${CXX-g++} -o conftest${ac_exeext} $CXXFLAGS $CPPFLAGS $LDFLAGS conftes\n cross_compiling=$ac_cv_prog_cxx_cross\n \n \t  cat > conftest.$ac_ext <<EOF\n-#line 3825 \"configure\"\n+#line 3828 \"configure\"\n #include \"confdefs.h\"\n #include <netdb.h>\n int main() {\n gethostbyname_r(\"\", 0, 0);\n ; return 0; }\n EOF\n-if { (eval echo configure:3832: \\\"$ac_compile\\\") 1>&5; (eval $ac_compile) 2>&5; }; then\n+if { (eval echo configure:3835: \\\"$ac_compile\\\") 1>&5; (eval $ac_compile) 2>&5; }; then\n   rm -rf conftest*\n   libjava_cv_gethostbyname_r_needs_reentrant=no\n else\n@@ -3838,14 +3841,14 @@ else\n   \t\tCPPFLAGS_SAVE=\"$CPPFLAGS\"\n \t\tCPPFLAGS=\"$CPPFLAGS -D_REENTRANT\"\n \t\tcat > conftest.$ac_ext <<EOF\n-#line 3842 \"configure\"\n+#line 3845 \"configure\"\n #include \"confdefs.h\"\n #include <netdb.h>\n int main() {\n gethostbyname_r(\"\", 0, 0);\n ; return 0; }\n EOF\n-if { (eval echo configure:3849: \\\"$ac_compile\\\") 1>&5; (eval $ac_compile) 2>&5; }; then\n+if { (eval echo configure:3852: \\\"$ac_compile\\\") 1>&5; (eval $ac_compile) 2>&5; }; then\n   rm -rf conftest*\n   libjava_cv_gethostbyname_r_needs_reentrant=yes\n else\n@@ -3880,12 +3883,12 @@ EOF\n      esac\n \n      echo $ac_n \"checking for struct hostent_data\"\"... $ac_c\" 1>&6\n-echo \"configure:3884: checking for struct hostent_data\" >&5\n+echo \"configure:3887: checking for struct hostent_data\" >&5\n if eval \"test \\\"`echo '$''{'libjava_cv_struct_hostent_data'+set}'`\\\" = set\"; then\n   echo $ac_n \"(cached) $ac_c\" 1>&6\n else\n   \tcat > conftest.$ac_ext <<EOF\n-#line 3889 \"configure\"\n+#line 3892 \"configure\"\n #include \"confdefs.h\"\n \n #if GETHOSTBYNAME_R_NEEDS_REENTRANT && !defined(_REENTRANT)\n@@ -3896,7 +3899,7 @@ int main() {\n struct hostent_data data;\n ; return 0; }\n EOF\n-if { (eval echo configure:3900: \\\"$ac_compile\\\") 1>&5; (eval $ac_compile) 2>&5; }; then\n+if { (eval echo configure:3903: \\\"$ac_compile\\\") 1>&5; (eval $ac_compile) 2>&5; }; then\n   rm -rf conftest*\n   libjava_cv_struct_hostent_data=yes\n else\n@@ -3925,12 +3928,12 @@ done\n    for ac_func in gethostbyaddr_r\n do\n echo $ac_n \"checking for $ac_func\"\"... $ac_c\" 1>&6\n-echo \"configure:3929: checking for $ac_func\" >&5\n+echo \"configure:3932: checking for $ac_func\" >&5\n if eval \"test \\\"`echo '$''{'ac_cv_func_$ac_func'+set}'`\\\" = set\"; then\n   echo $ac_n \"(cached) $ac_c\" 1>&6\n else\n   cat > conftest.$ac_ext <<EOF\n-#line 3934 \"configure\"\n+#line 3937 \"configure\"\n #include \"confdefs.h\"\n /* System header to define __stub macros and hopefully few prototypes,\n     which can conflict with char $ac_func(); below.  */\n@@ -3953,7 +3956,7 @@ $ac_func();\n \n ; return 0; }\n EOF\n-if { (eval echo configure:3957: \\\"$ac_link\\\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest${ac_exeext}; then\n+if { (eval echo configure:3960: \\\"$ac_link\\\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest${ac_exeext}; then\n   rm -rf conftest*\n   eval \"ac_cv_func_$ac_func=yes\"\n else\n@@ -3980,7 +3983,7 @@ EOF\n      # We look for the one that returns `int'.\n      # Hopefully this check is robust enough.\n      cat > conftest.$ac_ext <<EOF\n-#line 3984 \"configure\"\n+#line 3987 \"configure\"\n #include \"confdefs.h\"\n #include <netdb.h>\n EOF\n@@ -4004,12 +4007,12 @@ done\n    for ac_func in gethostname\n do\n echo $ac_n \"checking for $ac_func\"\"... $ac_c\" 1>&6\n-echo \"configure:4008: checking for $ac_func\" >&5\n+echo \"configure:4011: checking for $ac_func\" >&5\n if eval \"test \\\"`echo '$''{'ac_cv_func_$ac_func'+set}'`\\\" = set\"; then\n   echo $ac_n \"(cached) $ac_c\" 1>&6\n else\n   cat > conftest.$ac_ext <<EOF\n-#line 4013 \"configure\"\n+#line 4016 \"configure\"\n #include \"confdefs.h\"\n /* System header to define __stub macros and hopefully few prototypes,\n     which can conflict with char $ac_func(); below.  */\n@@ -4032,7 +4035,7 @@ $ac_func();\n \n ; return 0; }\n EOF\n-if { (eval echo configure:4036: \\\"$ac_link\\\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest${ac_exeext}; then\n+if { (eval echo configure:4039: \\\"$ac_link\\\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest${ac_exeext}; then\n   rm -rf conftest*\n   eval \"ac_cv_func_$ac_func=yes\"\n else\n@@ -4056,7 +4059,7 @@ EOF\n EOF\n \n      cat > conftest.$ac_ext <<EOF\n-#line 4060 \"configure\"\n+#line 4063 \"configure\"\n #include \"confdefs.h\"\n #include <unistd.h>\n EOF\n@@ -4087,12 +4090,12 @@ done\n       for ac_func in pthread_mutexattr_settype pthread_mutexattr_setkind_np\n do\n echo $ac_n \"checking for $ac_func\"\"... $ac_c\" 1>&6\n-echo \"configure:4091: checking for $ac_func\" >&5\n+echo \"configure:4094: checking for $ac_func\" >&5\n if eval \"test \\\"`echo '$''{'ac_cv_func_$ac_func'+set}'`\\\" = set\"; then\n   echo $ac_n \"(cached) $ac_c\" 1>&6\n else\n   cat > conftest.$ac_ext <<EOF\n-#line 4096 \"configure\"\n+#line 4099 \"configure\"\n #include \"confdefs.h\"\n /* System header to define __stub macros and hopefully few prototypes,\n     which can conflict with char $ac_func(); below.  */\n@@ -4115,7 +4118,7 @@ $ac_func();\n \n ; return 0; }\n EOF\n-if { (eval echo configure:4119: \\\"$ac_link\\\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest${ac_exeext}; then\n+if { (eval echo configure:4122: \\\"$ac_link\\\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest${ac_exeext}; then\n   rm -rf conftest*\n   eval \"ac_cv_func_$ac_func=yes\"\n else\n@@ -4145,12 +4148,12 @@ done\n       for ac_func in sched_yield\n do\n echo $ac_n \"checking for $ac_func\"\"... $ac_c\" 1>&6\n-echo \"configure:4149: checking for $ac_func\" >&5\n+echo \"configure:4152: checking for $ac_func\" >&5\n if eval \"test \\\"`echo '$''{'ac_cv_func_$ac_func'+set}'`\\\" = set\"; then\n   echo $ac_n \"(cached) $ac_c\" 1>&6\n else\n   cat > conftest.$ac_ext <<EOF\n-#line 4154 \"configure\"\n+#line 4157 \"configure\"\n #include \"confdefs.h\"\n /* System header to define __stub macros and hopefully few prototypes,\n     which can conflict with char $ac_func(); below.  */\n@@ -4173,7 +4176,7 @@ $ac_func();\n \n ; return 0; }\n EOF\n-if { (eval echo configure:4177: \\\"$ac_link\\\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest${ac_exeext}; then\n+if { (eval echo configure:4180: \\\"$ac_link\\\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest${ac_exeext}; then\n   rm -rf conftest*\n   eval \"ac_cv_func_$ac_func=yes\"\n else\n@@ -4195,15 +4198,15 @@ EOF\n else\n   echo \"$ac_t\"\"no\" 1>&6\n echo $ac_n \"checking for sched_yield in -lrt\"\"... $ac_c\" 1>&6\n-echo \"configure:4199: checking for sched_yield in -lrt\" >&5\n+echo \"configure:4202: checking for sched_yield in -lrt\" >&5\n ac_lib_var=`echo rt'_'sched_yield | sed 'y%./+-%__p_%'`\n if eval \"test \\\"`echo '$''{'ac_cv_lib_$ac_lib_var'+set}'`\\\" = set\"; then\n   echo $ac_n \"(cached) $ac_c\" 1>&6\n else\n   ac_save_LIBS=\"$LIBS\"\n LIBS=\"-lrt  $LIBS\"\n cat > conftest.$ac_ext <<EOF\n-#line 4207 \"configure\"\n+#line 4210 \"configure\"\n #include \"confdefs.h\"\n /* Override any gcc2 internal prototype to avoid an error.  */\n /* We use char because int might match the return type of a gcc2\n@@ -4214,7 +4217,7 @@ int main() {\n sched_yield()\n ; return 0; }\n EOF\n-if { (eval echo configure:4218: \\\"$ac_link\\\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest${ac_exeext}; then\n+if { (eval echo configure:4221: \\\"$ac_link\\\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest${ac_exeext}; then\n   rm -rf conftest*\n   eval \"ac_cv_lib_$ac_lib_var=yes\"\n else\n@@ -4240,15 +4243,15 @@ else\n   echo \"$ac_t\"\"no\" 1>&6\n \n \t  echo $ac_n \"checking for sched_yield in -lposix4\"\"... $ac_c\" 1>&6\n-echo \"configure:4244: checking for sched_yield in -lposix4\" >&5\n+echo \"configure:4247: checking for sched_yield in -lposix4\" >&5\n ac_lib_var=`echo posix4'_'sched_yield | sed 'y%./+-%__p_%'`\n if eval \"test \\\"`echo '$''{'ac_cv_lib_$ac_lib_var'+set}'`\\\" = set\"; then\n   echo $ac_n \"(cached) $ac_c\" 1>&6\n else\n   ac_save_LIBS=\"$LIBS\"\n LIBS=\"-lposix4  $LIBS\"\n cat > conftest.$ac_ext <<EOF\n-#line 4252 \"configure\"\n+#line 4255 \"configure\"\n #include \"confdefs.h\"\n /* Override any gcc2 internal prototype to avoid an error.  */\n /* We use char because int might match the return type of a gcc2\n@@ -4259,7 +4262,7 @@ int main() {\n sched_yield()\n ; return 0; }\n EOF\n-if { (eval echo configure:4263: \\\"$ac_link\\\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest${ac_exeext}; then\n+if { (eval echo configure:4266: \\\"$ac_link\\\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest${ac_exeext}; then\n   rm -rf conftest*\n   eval \"ac_cv_lib_$ac_lib_var=yes\"\n else\n@@ -4295,7 +4298,7 @@ done\n       # We can save a little space at runtime if the mutex has m_count\n       # or __m_count.  This is a nice hack for Linux.\n       cat > conftest.$ac_ext <<EOF\n-#line 4299 \"configure\"\n+#line 4302 \"configure\"\n #include \"confdefs.h\"\n #include <pthread.h>\n int main() {\n@@ -4304,7 +4307,7 @@ int main() {\n         \n ; return 0; }\n EOF\n-if { (eval echo configure:4308: \\\"$ac_compile\\\") 1>&5; (eval $ac_compile) 2>&5; }; then\n+if { (eval echo configure:4311: \\\"$ac_compile\\\") 1>&5; (eval $ac_compile) 2>&5; }; then\n   rm -rf conftest*\n   cat >> confdefs.h <<\\EOF\n #define PTHREAD_MUTEX_HAVE_M_COUNT 1\n@@ -4316,7 +4319,7 @@ else\n   rm -rf conftest*\n   \n \tcat > conftest.$ac_ext <<EOF\n-#line 4320 \"configure\"\n+#line 4323 \"configure\"\n #include \"confdefs.h\"\n #include <pthread.h>\n int main() {\n@@ -4325,7 +4328,7 @@ int main() {\n \t  \n ; return 0; }\n EOF\n-if { (eval echo configure:4329: \\\"$ac_compile\\\") 1>&5; (eval $ac_compile) 2>&5; }; then\n+if { (eval echo configure:4332: \\\"$ac_compile\\\") 1>&5; (eval $ac_compile) 2>&5; }; then\n   rm -rf conftest*\n   cat >> confdefs.h <<\\EOF\n #define PTHREAD_MUTEX_HAVE___M_COUNT 1\n@@ -4345,12 +4348,12 @@ rm -f conftest*\n    for ac_func in gettimeofday time ftime\n do\n echo $ac_n \"checking for $ac_func\"\"... $ac_c\" 1>&6\n-echo \"configure:4349: checking for $ac_func\" >&5\n+echo \"configure:4352: checking for $ac_func\" >&5\n if eval \"test \\\"`echo '$''{'ac_cv_func_$ac_func'+set}'`\\\" = set\"; then\n   echo $ac_n \"(cached) $ac_c\" 1>&6\n else\n   cat > conftest.$ac_ext <<EOF\n-#line 4354 \"configure\"\n+#line 4357 \"configure\"\n #include \"confdefs.h\"\n /* System header to define __stub macros and hopefully few prototypes,\n     which can conflict with char $ac_func(); below.  */\n@@ -4373,7 +4376,7 @@ $ac_func();\n \n ; return 0; }\n EOF\n-if { (eval echo configure:4377: \\\"$ac_link\\\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest${ac_exeext}; then\n+if { (eval echo configure:4380: \\\"$ac_link\\\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest${ac_exeext}; then\n   rm -rf conftest*\n   eval \"ac_cv_func_$ac_func=yes\"\n else\n@@ -4404,12 +4407,12 @@ done\n    for ac_func in memmove\n do\n echo $ac_n \"checking for $ac_func\"\"... $ac_c\" 1>&6\n-echo \"configure:4408: checking for $ac_func\" >&5\n+echo \"configure:4411: checking for $ac_func\" >&5\n if eval \"test \\\"`echo '$''{'ac_cv_func_$ac_func'+set}'`\\\" = set\"; then\n   echo $ac_n \"(cached) $ac_c\" 1>&6\n else\n   cat > conftest.$ac_ext <<EOF\n-#line 4413 \"configure\"\n+#line 4416 \"configure\"\n #include \"confdefs.h\"\n /* System header to define __stub macros and hopefully few prototypes,\n     which can conflict with char $ac_func(); below.  */\n@@ -4432,7 +4435,7 @@ $ac_func();\n \n ; return 0; }\n EOF\n-if { (eval echo configure:4436: \\\"$ac_link\\\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest${ac_exeext}; then\n+if { (eval echo configure:4439: \\\"$ac_link\\\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest${ac_exeext}; then\n   rm -rf conftest*\n   eval \"ac_cv_func_$ac_func=yes\"\n else\n@@ -4462,12 +4465,12 @@ done\n    for ac_func in memcpy\n do\n echo $ac_n \"checking for $ac_func\"\"... $ac_c\" 1>&6\n-echo \"configure:4466: checking for $ac_func\" >&5\n+echo \"configure:4469: checking for $ac_func\" >&5\n if eval \"test \\\"`echo '$''{'ac_cv_func_$ac_func'+set}'`\\\" = set\"; then\n   echo $ac_n \"(cached) $ac_c\" 1>&6\n else\n   cat > conftest.$ac_ext <<EOF\n-#line 4471 \"configure\"\n+#line 4474 \"configure\"\n #include \"confdefs.h\"\n /* System header to define __stub macros and hopefully few prototypes,\n     which can conflict with char $ac_func(); below.  */\n@@ -4490,7 +4493,7 @@ $ac_func();\n \n ; return 0; }\n EOF\n-if { (eval echo configure:4494: \\\"$ac_link\\\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest${ac_exeext}; then\n+if { (eval echo configure:4497: \\\"$ac_link\\\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest${ac_exeext}; then\n   rm -rf conftest*\n   eval \"ac_cv_func_$ac_func=yes\"\n else\n@@ -4538,20 +4541,20 @@ done\n    #--------------------------------------------------------------------\n \n    echo $ac_n \"checking for socket libraries\"\"... $ac_c\" 1>&6\n-echo \"configure:4542: checking for socket libraries\" >&5\n+echo \"configure:4545: checking for socket libraries\" >&5\n if eval \"test \\\"`echo '$''{'gcj_cv_lib_sockets'+set}'`\\\" = set\"; then\n   echo $ac_n \"(cached) $ac_c\" 1>&6\n else\n   gcj_cv_lib_sockets=\n      gcj_checkBoth=0\n      unset ac_cv_func_connect\n      echo $ac_n \"checking for connect\"\"... $ac_c\" 1>&6\n-echo \"configure:4550: checking for connect\" >&5\n+echo \"configure:4553: checking for connect\" >&5\n if eval \"test \\\"`echo '$''{'ac_cv_func_connect'+set}'`\\\" = set\"; then\n   echo $ac_n \"(cached) $ac_c\" 1>&6\n else\n   cat > conftest.$ac_ext <<EOF\n-#line 4555 \"configure\"\n+#line 4558 \"configure\"\n #include \"confdefs.h\"\n /* System header to define __stub macros and hopefully few prototypes,\n     which can conflict with char connect(); below.  */\n@@ -4574,7 +4577,7 @@ connect();\n \n ; return 0; }\n EOF\n-if { (eval echo configure:4578: \\\"$ac_link\\\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest${ac_exeext}; then\n+if { (eval echo configure:4581: \\\"$ac_link\\\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest${ac_exeext}; then\n   rm -rf conftest*\n   eval \"ac_cv_func_connect=yes\"\n else\n@@ -4597,22 +4600,22 @@ fi\n      if test \"$gcj_checkSocket\" = 1; then\n \t unset ac_cv_func_connect\n \t echo $ac_n \"checking for main in -lsocket\"\"... $ac_c\" 1>&6\n-echo \"configure:4601: checking for main in -lsocket\" >&5\n+echo \"configure:4604: checking for main in -lsocket\" >&5\n ac_lib_var=`echo socket'_'main | sed 'y%./+-%__p_%'`\n if eval \"test \\\"`echo '$''{'ac_cv_lib_$ac_lib_var'+set}'`\\\" = set\"; then\n   echo $ac_n \"(cached) $ac_c\" 1>&6\n else\n   ac_save_LIBS=\"$LIBS\"\n LIBS=\"-lsocket  $LIBS\"\n cat > conftest.$ac_ext <<EOF\n-#line 4609 \"configure\"\n+#line 4612 \"configure\"\n #include \"confdefs.h\"\n \n int main() {\n main()\n ; return 0; }\n EOF\n-if { (eval echo configure:4616: \\\"$ac_link\\\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest${ac_exeext}; then\n+if { (eval echo configure:4619: \\\"$ac_link\\\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest${ac_exeext}; then\n   rm -rf conftest*\n   eval \"ac_cv_lib_$ac_lib_var=yes\"\n else\n@@ -4639,12 +4642,12 @@ fi\n \t LIBS=\"$LIBS -lsocket -lnsl\"\n \t unset ac_cv_func_accept\n \t echo $ac_n \"checking for accept\"\"... $ac_c\" 1>&6\n-echo \"configure:4643: checking for accept\" >&5\n+echo \"configure:4646: checking for accept\" >&5\n if eval \"test \\\"`echo '$''{'ac_cv_func_accept'+set}'`\\\" = set\"; then\n   echo $ac_n \"(cached) $ac_c\" 1>&6\n else\n   cat > conftest.$ac_ext <<EOF\n-#line 4648 \"configure\"\n+#line 4651 \"configure\"\n #include \"confdefs.h\"\n /* System header to define __stub macros and hopefully few prototypes,\n     which can conflict with char accept(); below.  */\n@@ -4667,7 +4670,7 @@ accept();\n \n ; return 0; }\n EOF\n-if { (eval echo configure:4671: \\\"$ac_link\\\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest${ac_exeext}; then\n+if { (eval echo configure:4674: \\\"$ac_link\\\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest${ac_exeext}; then\n   rm -rf conftest*\n   eval \"ac_cv_func_accept=yes\"\n else\n@@ -4694,12 +4697,12 @@ fi\n      gcj_oldLibs=$LIBS\n      LIBS=\"$LIBS $gcj_cv_lib_sockets\"\n      echo $ac_n \"checking for gethostbyname\"\"... $ac_c\" 1>&6\n-echo \"configure:4698: checking for gethostbyname\" >&5\n+echo \"configure:4701: checking for gethostbyname\" >&5\n if eval \"test \\\"`echo '$''{'ac_cv_func_gethostbyname'+set}'`\\\" = set\"; then\n   echo $ac_n \"(cached) $ac_c\" 1>&6\n else\n   cat > conftest.$ac_ext <<EOF\n-#line 4703 \"configure\"\n+#line 4706 \"configure\"\n #include \"confdefs.h\"\n /* System header to define __stub macros and hopefully few prototypes,\n     which can conflict with char gethostbyname(); below.  */\n@@ -4722,7 +4725,7 @@ gethostbyname();\n \n ; return 0; }\n EOF\n-if { (eval echo configure:4726: \\\"$ac_link\\\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest${ac_exeext}; then\n+if { (eval echo configure:4729: \\\"$ac_link\\\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest${ac_exeext}; then\n   rm -rf conftest*\n   eval \"ac_cv_func_gethostbyname=yes\"\n else\n@@ -4740,22 +4743,22 @@ if eval \"test \\\"`echo '$ac_cv_func_'gethostbyname`\\\" = yes\"; then\n else\n   echo \"$ac_t\"\"no\" 1>&6\n echo $ac_n \"checking for main in -lnsl\"\"... $ac_c\" 1>&6\n-echo \"configure:4744: checking for main in -lnsl\" >&5\n+echo \"configure:4747: checking for main in -lnsl\" >&5\n ac_lib_var=`echo nsl'_'main | sed 'y%./+-%__p_%'`\n if eval \"test \\\"`echo '$''{'ac_cv_lib_$ac_lib_var'+set}'`\\\" = set\"; then\n   echo $ac_n \"(cached) $ac_c\" 1>&6\n else\n   ac_save_LIBS=\"$LIBS\"\n LIBS=\"-lnsl  $LIBS\"\n cat > conftest.$ac_ext <<EOF\n-#line 4752 \"configure\"\n+#line 4755 \"configure\"\n #include \"confdefs.h\"\n \n int main() {\n main()\n ; return 0; }\n EOF\n-if { (eval echo configure:4759: \\\"$ac_link\\\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest${ac_exeext}; then\n+if { (eval echo configure:4762: \\\"$ac_link\\\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest${ac_exeext}; then\n   rm -rf conftest*\n   eval \"ac_cv_lib_$ac_lib_var=yes\"\n else\n@@ -4787,15 +4790,15 @@ echo \"$ac_t\"\"$gcj_cv_lib_sockets\" 1>&6\n \n    if test \"$with_system_zlib\" = yes; then\n       echo $ac_n \"checking for deflate in -lz\"\"... $ac_c\" 1>&6\n-echo \"configure:4791: checking for deflate in -lz\" >&5\n+echo \"configure:4794: checking for deflate in -lz\" >&5\n ac_lib_var=`echo z'_'deflate | sed 'y%./+-%__p_%'`\n if eval \"test \\\"`echo '$''{'ac_cv_lib_$ac_lib_var'+set}'`\\\" = set\"; then\n   echo $ac_n \"(cached) $ac_c\" 1>&6\n else\n   ac_save_LIBS=\"$LIBS\"\n LIBS=\"-lz  $LIBS\"\n cat > conftest.$ac_ext <<EOF\n-#line 4799 \"configure\"\n+#line 4802 \"configure\"\n #include \"confdefs.h\"\n /* Override any gcc2 internal prototype to avoid an error.  */\n /* We use char because int might match the return type of a gcc2\n@@ -4806,7 +4809,7 @@ int main() {\n deflate()\n ; return 0; }\n EOF\n-if { (eval echo configure:4810: \\\"$ac_link\\\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest${ac_exeext}; then\n+if { (eval echo configure:4813: \\\"$ac_link\\\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest${ac_exeext}; then\n   rm -rf conftest*\n   eval \"ac_cv_lib_$ac_lib_var=yes\"\n else\n@@ -4836,22 +4839,22 @@ fi\n    # requires -ldl.\n    if test \"$GC\" = boehm; then\n       echo $ac_n \"checking for main in -ldl\"\"... $ac_c\" 1>&6\n-echo \"configure:4840: checking for main in -ldl\" >&5\n+echo \"configure:4843: checking for main in -ldl\" >&5\n ac_lib_var=`echo dl'_'main | sed 'y%./+-%__p_%'`\n if eval \"test \\\"`echo '$''{'ac_cv_lib_$ac_lib_var'+set}'`\\\" = set\"; then\n   echo $ac_n \"(cached) $ac_c\" 1>&6\n else\n   ac_save_LIBS=\"$LIBS\"\n LIBS=\"-ldl  $LIBS\"\n cat > conftest.$ac_ext <<EOF\n-#line 4848 \"configure\"\n+#line 4851 \"configure\"\n #include \"confdefs.h\"\n \n int main() {\n main()\n ; return 0; }\n EOF\n-if { (eval echo configure:4855: \\\"$ac_link\\\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest${ac_exeext}; then\n+if { (eval echo configure:4858: \\\"$ac_link\\\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest${ac_exeext}; then\n   rm -rf conftest*\n   eval \"ac_cv_lib_$ac_lib_var=yes\"\n else\n@@ -4898,7 +4901,7 @@ GCJ=\"$GCJ -I$srcdir\"\n   # Extract the first word of \"${ac_tool_prefix}gcj\", so it can be a program name with args.\n set dummy ${ac_tool_prefix}gcj; ac_word=$2\n echo $ac_n \"checking for $ac_word\"\"... $ac_c\" 1>&6\n-echo \"configure:4902: checking for $ac_word\" >&5\n+echo \"configure:4905: checking for $ac_word\" >&5\n if eval \"test \\\"`echo '$''{'ac_cv_prog_GCJ'+set}'`\\\" = set\"; then\n   echo $ac_n \"(cached) $ac_c\" 1>&6\n else\n@@ -4930,7 +4933,7 @@ if test -n \"$ac_tool_prefix\"; then\n   # Extract the first word of \"gcj\", so it can be a program name with args.\n set dummy gcj; ac_word=$2\n echo $ac_n \"checking for $ac_word\"\"... $ac_c\" 1>&6\n-echo \"configure:4934: checking for $ac_word\" >&5\n+echo \"configure:4937: checking for $ac_word\" >&5\n if eval \"test \\\"`echo '$''{'ac_cv_prog_GCJ'+set}'`\\\" = set\"; then\n   echo $ac_n \"(cached) $ac_c\" 1>&6\n else\n@@ -4990,15 +4993,15 @@ exec 5>>./config.log\n \n \n echo $ac_n \"checking size of void *\"\"... $ac_c\" 1>&6\n-echo \"configure:4994: checking size of void *\" >&5\n+echo \"configure:4997: checking size of void *\" >&5\n if eval \"test \\\"`echo '$''{'ac_cv_sizeof_void_p'+set}'`\\\" = set\"; then\n   echo $ac_n \"(cached) $ac_c\" 1>&6\n else\n   if test \"$cross_compiling\" = yes; then\n     { echo \"configure: error: can not run test program while cross compiling\" 1>&2; exit 1; }\n else\n   cat > conftest.$ac_ext <<EOF\n-#line 5002 \"configure\"\n+#line 5005 \"configure\"\n #include \"confdefs.h\"\n #include <stdio.h>\n main()\n@@ -5009,7 +5012,7 @@ main()\n   exit(0);\n }\n EOF\n-if { (eval echo configure:5013: \\\"$ac_link\\\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest${ac_exeext} && (./conftest; exit) 2>/dev/null\n+if { (eval echo configure:5016: \\\"$ac_link\\\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest${ac_exeext} && (./conftest; exit) 2>/dev/null\n then\n   ac_cv_sizeof_void_p=`cat conftestval`\n else\n@@ -5107,7 +5110,7 @@ EOF\n # See if gcj supports -fuse-divide-subroutine.  gcc 2.95 does not, and\n # we want to continue to support that version.\n echo $ac_n \"checking whether gcj supports -fuse-divide-subroutine\"\"... $ac_c\" 1>&6\n-echo \"configure:5111: checking whether gcj supports -fuse-divide-subroutine\" >&5\n+echo \"configure:5114: checking whether gcj supports -fuse-divide-subroutine\" >&5\n cat > conftest.java << 'END'\n public class conftest { }\n END\n@@ -5124,18 +5127,18 @@ echo \"$ac_t\"\"$use_fuse\" 1>&6\n \n \n echo $ac_n \"checking for g++ -ffloat-store bug\"\"... $ac_c\" 1>&6\n-echo \"configure:5128: checking for g++ -ffloat-store bug\" >&5\n+echo \"configure:5131: checking for g++ -ffloat-store bug\" >&5\n save_CFLAGS=\"$CFLAGS\"\n CFLAGS=\"-x c++ -O2 -ffloat-store\"\n cat > conftest.$ac_ext <<EOF\n-#line 5132 \"configure\"\n+#line 5135 \"configure\"\n #include \"confdefs.h\"\n #include <math.h>\n int main() {\n \n ; return 0; }\n EOF\n-if { (eval echo configure:5139: \\\"$ac_compile\\\") 1>&5; (eval $ac_compile) 2>&5; }; then\n+if { (eval echo configure:5142: \\\"$ac_compile\\\") 1>&5; (eval $ac_compile) 2>&5; }; then\n   rm -rf conftest*\n   echo \"$ac_t\"\"no\" 1>&6\n else\n@@ -5155,17 +5158,17 @@ for ac_hdr in unistd.h bstring.h sys/time.h sys/types.h fcntl.h sys/ioctl.h sys/\n do\n ac_safe=`echo \"$ac_hdr\" | sed 'y%./+-%__p_%'`\n echo $ac_n \"checking for $ac_hdr\"\"... $ac_c\" 1>&6\n-echo \"configure:5159: checking for $ac_hdr\" >&5\n+echo \"configure:5162: checking for $ac_hdr\" >&5\n if eval \"test \\\"`echo '$''{'ac_cv_header_$ac_safe'+set}'`\\\" = set\"; then\n   echo $ac_n \"(cached) $ac_c\" 1>&6\n else\n   cat > conftest.$ac_ext <<EOF\n-#line 5164 \"configure\"\n+#line 5167 \"configure\"\n #include \"confdefs.h\"\n #include <$ac_hdr>\n EOF\n ac_try=\"$ac_cpp conftest.$ac_ext >/dev/null 2>conftest.out\"\n-{ (eval echo configure:5169: \\\"$ac_try\\\") 1>&5; (eval $ac_try) 2>&5; }\n+{ (eval echo configure:5172: \\\"$ac_try\\\") 1>&5; (eval $ac_try) 2>&5; }\n ac_err=`grep -v '^ *+' conftest.out | grep -v \"^conftest.${ac_ext}\\$\"`\n if test -z \"$ac_err\"; then\n   rm -rf conftest*\n@@ -5195,17 +5198,17 @@ for ac_hdr in dirent.h\n do\n ac_safe=`echo \"$ac_hdr\" | sed 'y%./+-%__p_%'`\n echo $ac_n \"checking for $ac_hdr\"\"... $ac_c\" 1>&6\n-echo \"configure:5199: checking for $ac_hdr\" >&5\n+echo \"configure:5202: checking for $ac_hdr\" >&5\n if eval \"test \\\"`echo '$''{'ac_cv_header_$ac_safe'+set}'`\\\" = set\"; then\n   echo $ac_n \"(cached) $ac_c\" 1>&6\n else\n   cat > conftest.$ac_ext <<EOF\n-#line 5204 \"configure\"\n+#line 5207 \"configure\"\n #include \"confdefs.h\"\n #include <$ac_hdr>\n EOF\n ac_try=\"$ac_cpp conftest.$ac_ext >/dev/null 2>conftest.out\"\n-{ (eval echo configure:5209: \\\"$ac_try\\\") 1>&5; (eval $ac_try) 2>&5; }\n+{ (eval echo configure:5212: \\\"$ac_try\\\") 1>&5; (eval $ac_try) 2>&5; }\n ac_err=`grep -v '^ *+' conftest.out | grep -v \"^conftest.${ac_ext}\\$\"`\n if test -z \"$ac_err\"; then\n   rm -rf conftest*\n@@ -5233,20 +5236,20 @@ done\n \n \n echo $ac_n \"checking for ANSI C header files\"\"... $ac_c\" 1>&6\n-echo \"configure:5237: checking for ANSI C header files\" >&5\n+echo \"configure:5240: checking for ANSI C header files\" >&5\n if eval \"test \\\"`echo '$''{'ac_cv_header_stdc'+set}'`\\\" = set\"; then\n   echo $ac_n \"(cached) $ac_c\" 1>&6\n else\n   cat > conftest.$ac_ext <<EOF\n-#line 5242 \"configure\"\n+#line 5245 \"configure\"\n #include \"confdefs.h\"\n #include <stdlib.h>\n #include <stdarg.h>\n #include <string.h>\n #include <float.h>\n EOF\n ac_try=\"$ac_cpp conftest.$ac_ext >/dev/null 2>conftest.out\"\n-{ (eval echo configure:5250: \\\"$ac_try\\\") 1>&5; (eval $ac_try) 2>&5; }\n+{ (eval echo configure:5253: \\\"$ac_try\\\") 1>&5; (eval $ac_try) 2>&5; }\n ac_err=`grep -v '^ *+' conftest.out | grep -v \"^conftest.${ac_ext}\\$\"`\n if test -z \"$ac_err\"; then\n   rm -rf conftest*\n@@ -5263,7 +5266,7 @@ rm -f conftest*\n if test $ac_cv_header_stdc = yes; then\n   # SunOS 4.x string.h does not declare mem*, contrary to ANSI.\n cat > conftest.$ac_ext <<EOF\n-#line 5267 \"configure\"\n+#line 5270 \"configure\"\n #include \"confdefs.h\"\n #include <string.h>\n EOF\n@@ -5281,7 +5284,7 @@ fi\n if test $ac_cv_header_stdc = yes; then\n   # ISC 2.0.2 stdlib.h does not declare free, contrary to ANSI.\n cat > conftest.$ac_ext <<EOF\n-#line 5285 \"configure\"\n+#line 5288 \"configure\"\n #include \"confdefs.h\"\n #include <stdlib.h>\n EOF\n@@ -5302,7 +5305,7 @@ if test \"$cross_compiling\" = yes; then\n   :\n else\n   cat > conftest.$ac_ext <<EOF\n-#line 5306 \"configure\"\n+#line 5309 \"configure\"\n #include \"confdefs.h\"\n #include <ctype.h>\n #define ISLOWER(c) ('a' <= (c) && (c) <= 'z')\n@@ -5313,7 +5316,7 @@ if (XOR (islower (i), ISLOWER (i)) || toupper (i) != TOUPPER (i)) exit(2);\n exit (0); }\n \n EOF\n-if { (eval echo configure:5317: \\\"$ac_link\\\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest${ac_exeext} && (./conftest; exit) 2>/dev/null\n+if { (eval echo configure:5320: \\\"$ac_link\\\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest${ac_exeext} && (./conftest; exit) 2>/dev/null\n then\n   :\n else\n@@ -5337,12 +5340,12 @@ EOF\n fi\n \n echo $ac_n \"checking for ssize_t\"\"... $ac_c\" 1>&6\n-echo \"configure:5341: checking for ssize_t\" >&5\n+echo \"configure:5344: checking for ssize_t\" >&5\n if eval \"test \\\"`echo '$''{'ac_cv_type_ssize_t'+set}'`\\\" = set\"; then\n   echo $ac_n \"(cached) $ac_c\" 1>&6\n else\n   cat > conftest.$ac_ext <<EOF\n-#line 5346 \"configure\"\n+#line 5349 \"configure\"\n #include \"confdefs.h\"\n #include <sys/types.h>\n #if STDC_HEADERS\n@@ -5371,9 +5374,9 @@ fi\n \n \n echo $ac_n \"checking for in_addr_t\"\"... $ac_c\" 1>&6\n-echo \"configure:5375: checking for in_addr_t\" >&5\n+echo \"configure:5378: checking for in_addr_t\" >&5\n cat > conftest.$ac_ext <<EOF\n-#line 5377 \"configure\"\n+#line 5380 \"configure\"\n #include \"confdefs.h\"\n #include <sys/types.h>\n #if STDC_HEADERS\n@@ -5387,7 +5390,7 @@ int main() {\n in_addr_t foo;\n ; return 0; }\n EOF\n-if { (eval echo configure:5391: \\\"$ac_compile\\\") 1>&5; (eval $ac_compile) 2>&5; }; then\n+if { (eval echo configure:5394: \\\"$ac_compile\\\") 1>&5; (eval $ac_compile) 2>&5; }; then\n   rm -rf conftest*\n   cat >> confdefs.h <<\\EOF\n #define HAVE_IN_ADDR_T 1\n@@ -5403,16 +5406,16 @@ fi\n rm -f conftest*\n \n echo $ac_n \"checking whether struct ip_mreq is in netinet/in.h\"\"... $ac_c\" 1>&6\n-echo \"configure:5407: checking whether struct ip_mreq is in netinet/in.h\" >&5\n+echo \"configure:5410: checking whether struct ip_mreq is in netinet/in.h\" >&5\n cat > conftest.$ac_ext <<EOF\n-#line 5409 \"configure\"\n+#line 5412 \"configure\"\n #include \"confdefs.h\"\n #include <netinet/in.h>\n int main() {\n struct ip_mreq mreq;\n ; return 0; }\n EOF\n-if { (eval echo configure:5416: \\\"$ac_compile\\\") 1>&5; (eval $ac_compile) 2>&5; }; then\n+if { (eval echo configure:5419: \\\"$ac_compile\\\") 1>&5; (eval $ac_compile) 2>&5; }; then\n   rm -rf conftest*\n   cat >> confdefs.h <<\\EOF\n #define HAVE_STRUCT_IP_MREQ 1\n@@ -5428,16 +5431,16 @@ fi\n rm -f conftest*\n \n echo $ac_n \"checking whether struct sockaddr_in6 is in netinet/in.h\"\"... $ac_c\" 1>&6\n-echo \"configure:5432: checking whether struct sockaddr_in6 is in netinet/in.h\" >&5\n+echo \"configure:5435: checking whether struct sockaddr_in6 is in netinet/in.h\" >&5\n cat > conftest.$ac_ext <<EOF\n-#line 5434 \"configure\"\n+#line 5437 \"configure\"\n #include \"confdefs.h\"\n #include <netinet/in.h>\n int main() {\n struct sockaddr_in6 addr6;\n ; return 0; }\n EOF\n-if { (eval echo configure:5441: \\\"$ac_compile\\\") 1>&5; (eval $ac_compile) 2>&5; }; then\n+if { (eval echo configure:5444: \\\"$ac_compile\\\") 1>&5; (eval $ac_compile) 2>&5; }; then\n   rm -rf conftest*\n   cat >> confdefs.h <<\\EOF\n #define HAVE_INET6 1\n@@ -5453,16 +5456,16 @@ fi\n rm -f conftest*\n \n echo $ac_n \"checking for socklen_t in sys/socket.h\"\"... $ac_c\" 1>&6\n-echo \"configure:5457: checking for socklen_t in sys/socket.h\" >&5\n+echo \"configure:5460: checking for socklen_t in sys/socket.h\" >&5\n cat > conftest.$ac_ext <<EOF\n-#line 5459 \"configure\"\n+#line 5462 \"configure\"\n #include \"confdefs.h\"\n #include <sys/socket.h>\n int main() {\n socklen_t x = 5;\n ; return 0; }\n EOF\n-if { (eval echo configure:5466: \\\"$ac_compile\\\") 1>&5; (eval $ac_compile) 2>&5; }; then\n+if { (eval echo configure:5469: \\\"$ac_compile\\\") 1>&5; (eval $ac_compile) 2>&5; }; then\n   rm -rf conftest*\n   cat >> confdefs.h <<\\EOF\n #define HAVE_SOCKLEN_T 1\n@@ -5478,16 +5481,16 @@ fi\n rm -f conftest*\n \n echo $ac_n \"checking for tm_gmtoff in struct tm\"\"... $ac_c\" 1>&6\n-echo \"configure:5482: checking for tm_gmtoff in struct tm\" >&5\n+echo \"configure:5485: checking for tm_gmtoff in struct tm\" >&5\n cat > conftest.$ac_ext <<EOF\n-#line 5484 \"configure\"\n+#line 5487 \"configure\"\n #include \"confdefs.h\"\n #include <time.h>\n int main() {\n struct tm tim; tim.tm_gmtoff = 0;\n ; return 0; }\n EOF\n-if { (eval echo configure:5491: \\\"$ac_compile\\\") 1>&5; (eval $ac_compile) 2>&5; }; then\n+if { (eval echo configure:5494: \\\"$ac_compile\\\") 1>&5; (eval $ac_compile) 2>&5; }; then\n   rm -rf conftest*\n   cat >> confdefs.h <<\\EOF\n #define STRUCT_TM_HAS_GMTOFF 1\n@@ -5500,16 +5503,16 @@ else\n   rm -rf conftest*\n   echo \"$ac_t\"\"no\" 1>&6\n    echo $ac_n \"checking for global timezone variable\"\"... $ac_c\" 1>&6\n-echo \"configure:5504: checking for global timezone variable\" >&5\n+echo \"configure:5507: checking for global timezone variable\" >&5\n             cat > conftest.$ac_ext <<EOF\n-#line 5506 \"configure\"\n+#line 5509 \"configure\"\n #include \"confdefs.h\"\n #include <time.h>\n int main() {\n long z2 = timezone;\n ; return 0; }\n EOF\n-if { (eval echo configure:5513: \\\"$ac_compile\\\") 1>&5; (eval $ac_compile) 2>&5; }; then\n+if { (eval echo configure:5516: \\\"$ac_compile\\\") 1>&5; (eval $ac_compile) 2>&5; }; then\n   rm -rf conftest*\n   cat >> confdefs.h <<\\EOF\n #define HAVE_TIMEZONE 1\n@@ -5529,19 +5532,19 @@ rm -f conftest*\n # The Ultrix 4.2 mips builtin alloca declared by alloca.h only works\n # for constant arguments.  Useless!\n echo $ac_n \"checking for working alloca.h\"\"... $ac_c\" 1>&6\n-echo \"configure:5533: checking for working alloca.h\" >&5\n+echo \"configure:5536: checking for working alloca.h\" >&5\n if eval \"test \\\"`echo '$''{'ac_cv_header_alloca_h'+set}'`\\\" = set\"; then\n   echo $ac_n \"(cached) $ac_c\" 1>&6\n else\n   cat > conftest.$ac_ext <<EOF\n-#line 5538 \"configure\"\n+#line 5541 \"configure\"\n #include \"confdefs.h\"\n #include <alloca.h>\n int main() {\n char *p = alloca(2 * sizeof(int));\n ; return 0; }\n EOF\n-if { (eval echo configure:5545: \\\"$ac_link\\\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest${ac_exeext}; then\n+if { (eval echo configure:5548: \\\"$ac_link\\\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest${ac_exeext}; then\n   rm -rf conftest*\n   ac_cv_header_alloca_h=yes\n else\n@@ -5562,12 +5565,12 @@ EOF\n fi\n \n echo $ac_n \"checking for alloca\"\"... $ac_c\" 1>&6\n-echo \"configure:5566: checking for alloca\" >&5\n+echo \"configure:5569: checking for alloca\" >&5\n if eval \"test \\\"`echo '$''{'ac_cv_func_alloca_works'+set}'`\\\" = set\"; then\n   echo $ac_n \"(cached) $ac_c\" 1>&6\n else\n   cat > conftest.$ac_ext <<EOF\n-#line 5571 \"configure\"\n+#line 5574 \"configure\"\n #include \"confdefs.h\"\n \n #ifdef __GNUC__\n@@ -5595,7 +5598,7 @@ int main() {\n char *p = (char *) alloca(1);\n ; return 0; }\n EOF\n-if { (eval echo configure:5599: \\\"$ac_link\\\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest${ac_exeext}; then\n+if { (eval echo configure:5602: \\\"$ac_link\\\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest${ac_exeext}; then\n   rm -rf conftest*\n   ac_cv_func_alloca_works=yes\n else\n@@ -5627,12 +5630,12 @@ EOF\n \n \n echo $ac_n \"checking whether alloca needs Cray hooks\"\"... $ac_c\" 1>&6\n-echo \"configure:5631: checking whether alloca needs Cray hooks\" >&5\n+echo \"configure:5634: checking whether alloca needs Cray hooks\" >&5\n if eval \"test \\\"`echo '$''{'ac_cv_os_cray'+set}'`\\\" = set\"; then\n   echo $ac_n \"(cached) $ac_c\" 1>&6\n else\n   cat > conftest.$ac_ext <<EOF\n-#line 5636 \"configure\"\n+#line 5639 \"configure\"\n #include \"confdefs.h\"\n #if defined(CRAY) && ! defined(CRAY2)\n webecray\n@@ -5657,12 +5660,12 @@ echo \"$ac_t\"\"$ac_cv_os_cray\" 1>&6\n if test $ac_cv_os_cray = yes; then\n for ac_func in _getb67 GETB67 getb67; do\n   echo $ac_n \"checking for $ac_func\"\"... $ac_c\" 1>&6\n-echo \"configure:5661: checking for $ac_func\" >&5\n+echo \"configure:5664: checking for $ac_func\" >&5\n if eval \"test \\\"`echo '$''{'ac_cv_func_$ac_func'+set}'`\\\" = set\"; then\n   echo $ac_n \"(cached) $ac_c\" 1>&6\n else\n   cat > conftest.$ac_ext <<EOF\n-#line 5666 \"configure\"\n+#line 5669 \"configure\"\n #include \"confdefs.h\"\n /* System header to define __stub macros and hopefully few prototypes,\n     which can conflict with char $ac_func(); below.  */\n@@ -5685,7 +5688,7 @@ $ac_func();\n \n ; return 0; }\n EOF\n-if { (eval echo configure:5689: \\\"$ac_link\\\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest${ac_exeext}; then\n+if { (eval echo configure:5692: \\\"$ac_link\\\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest${ac_exeext}; then\n   rm -rf conftest*\n   eval \"ac_cv_func_$ac_func=yes\"\n else\n@@ -5712,15 +5715,15 @@ done\n fi\n \n echo $ac_n \"checking stack direction for C alloca\"\"... $ac_c\" 1>&6\n-echo \"configure:5716: checking stack direction for C alloca\" >&5\n+echo \"configure:5719: checking stack direction for C alloca\" >&5\n if eval \"test \\\"`echo '$''{'ac_cv_c_stack_direction'+set}'`\\\" = set\"; then\n   echo $ac_n \"(cached) $ac_c\" 1>&6\n else\n   if test \"$cross_compiling\" = yes; then\n   ac_cv_c_stack_direction=0\n else\n   cat > conftest.$ac_ext <<EOF\n-#line 5724 \"configure\"\n+#line 5727 \"configure\"\n #include \"confdefs.h\"\n find_stack_direction ()\n {\n@@ -5739,7 +5742,7 @@ main ()\n   exit (find_stack_direction() < 0);\n }\n EOF\n-if { (eval echo configure:5743: \\\"$ac_link\\\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest${ac_exeext} && (./conftest; exit) 2>/dev/null\n+if { (eval echo configure:5746: \\\"$ac_link\\\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest${ac_exeext} && (./conftest; exit) 2>/dev/null\n then\n   ac_cv_c_stack_direction=1\n else\n@@ -5766,7 +5769,7 @@ do\n # Extract the first word of \"$ac_prog\", so it can be a program name with args.\n set dummy $ac_prog; ac_word=$2\n echo $ac_n \"checking for $ac_word\"\"... $ac_c\" 1>&6\n-echo \"configure:5770: checking for $ac_word\" >&5\n+echo \"configure:5773: checking for $ac_word\" >&5\n if eval \"test \\\"`echo '$''{'ac_cv_prog_PERL'+set}'`\\\" = set\"; then\n   echo $ac_n \"(cached) $ac_c\" 1>&6\n else\n@@ -6028,6 +6031,7 @@ s%@GCINCS@%$GCINCS%g\n s%@GCDEPS@%$GCDEPS%g\n s%@GCOBJS@%$GCOBJS%g\n s%@GCSPEC@%$GCSPEC%g\n+s%@JC1GCSPEC@%$JC1GCSPEC%g\n s%@GCTESTSPEC@%$GCTESTSPEC%g\n s%@THREADLIBS@%$THREADLIBS%g\n s%@THREADINCS@%$THREADINCS%g"}, {"sha": "0cbdcb2149a1e42d8c5690656f470e921c777918", "filename": "libjava/configure.in", "status": "modified", "additions": 3, "deletions": 0, "changes": 3, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/bf3b8e42e291aeaeae178f6be1a49deebcd4e527/libjava%2Fconfigure.in", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/bf3b8e42e291aeaeae178f6be1a49deebcd4e527/libjava%2Fconfigure.in", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libjava%2Fconfigure.in?ref=bf3b8e42e291aeaeae178f6be1a49deebcd4e527", "patch": "@@ -208,6 +208,7 @@ GCINCS=\n GCDEPS=\n GCOBJS=\n GCSPEC=\n+JC1GCSPEC=\n GCTESTSPEC=\n case \"$GC\" in\n  boehm)\n@@ -218,6 +219,7 @@ case \"$GC\" in\n     GCLIBS=\"$GCDEPS -L\\$(here)/../boehm-gc/$libsubdir\"\n     GCINCS='-I$(top_srcdir)/../boehm-gc -I$(top_builddir)/../boehm-gc'\n     GCSPEC='-lgcjgc'\n+    JC1GCSPEC='-fuse-boehm-gc'\n     GCTESTSPEC=\"-L`pwd`/../boehm-gc/.libs -rpath `pwd`/../boehm-gc/.libs\"\n     dnl We also want to pick up some cpp flags required when including\n     dnl boehm-config.h.  Yuck.\n@@ -241,6 +243,7 @@ AC_SUBST(GCINCS)\n AC_SUBST(GCDEPS)\n AC_SUBST(GCOBJS)\n AC_SUBST(GCSPEC)\n+AC_SUBST(JC1GCSPEC)\n AC_SUBST(GCTESTSPEC)\n AC_LINK_FILES(include/$GCHDR, include/java-gc.h)\n "}, {"sha": "8d93ed58f225953179156700cdd757298978d71f", "filename": "libjava/include/jvm.h", "status": "modified", "additions": 11, "deletions": 4, "changes": 15, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/bf3b8e42e291aeaeae178f6be1a49deebcd4e527/libjava%2Finclude%2Fjvm.h", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/bf3b8e42e291aeaeae178f6be1a49deebcd4e527/libjava%2Finclude%2Fjvm.h", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libjava%2Finclude%2Fjvm.h?ref=bf3b8e42e291aeaeae178f6be1a49deebcd4e527", "patch": "@@ -31,7 +31,9 @@ details.  */\n struct _Jv_VTable\n {\n   jclass clas;\n+  void *gc_descr;\n   void *method[1];\n+  void *get_finalizer() { return method[0]; }\n };\n \n // Number of virtual methods on object.  FIXME: it sucks that we have\n@@ -42,8 +44,9 @@ struct _Jv_VTable\n struct _Jv_ArrayVTable\n {\n   jclass clas;\n-  // `+1' because there is an extra slot for C++ RTTI compatibility.\n-  void *method[NUM_OBJECT_METHODS + 1];\n+  void *gc_descr;\n+  void *method[NUM_OBJECT_METHODS];\n+  void *get_finalizer() { return method[0]; }\n };\n \n union _Jv_word\n@@ -106,15 +109,19 @@ extern java::lang::Class StringClass;\n typedef void _Jv_FinalizerFunc (jobject);\n \n /* Allocate space for a new Java object.  */\n-void *_Jv_AllocObj (jsize size) __attribute__((__malloc__));\n+void *_Jv_AllocObj (jsize size, jclass cl) __attribute__((__malloc__));\n /* Allocate space for an array of Java objects.  */\n-void *_Jv_AllocArray (jsize size) __attribute__((__malloc__));\n+void *_Jv_AllocArray (jsize size, jclass cl) __attribute__((__malloc__));\n /* Allocate space that is known to be pointer-free.  */\n void *_Jv_AllocBytes (jsize size) __attribute__((__malloc__));\n /* Initialize the GC.  */\n void _Jv_InitGC (void);\n /* Register a finalizer.  */\n void _Jv_RegisterFinalizer (void *object, _Jv_FinalizerFunc *method);\n+/* Compute the GC descriptor for a class */\n+#ifdef INTERPRETER\n+void * _Jv_BuildGCDescr(jclass);\n+#endif\n \n /* Allocate some unscanned, unmoveable memory.  Return NULL if out of\n    memory.  */"}, {"sha": "0300a59b871f908c463b54490d8a764ad81be6a6", "filename": "libjava/java/lang/Class.h", "status": "modified", "additions": 2, "deletions": 2, "changes": 4, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/bf3b8e42e291aeaeae178f6be1a49deebcd4e527/libjava%2Fjava%2Flang%2FClass.h", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/bf3b8e42e291aeaeae178f6be1a49deebcd4e527/libjava%2Fjava%2Flang%2FClass.h", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libjava%2Fjava%2Flang%2FClass.h?ref=bf3b8e42e291aeaeae178f6be1a49deebcd4e527", "patch": "@@ -220,8 +220,8 @@ class java::lang::Class : public java::lang::Object\n   friend jint JvNumStaticFields (jclass);\n \n   friend jobject _Jv_AllocObject (jclass, jint);\n-  friend jobjectArray _Jv_NewObjectArray (jsize, jclass, jobject);\n-  friend jobject _Jv_NewPrimArray (jclass, jint);\n+  friend void *_Jv_AllocObj (jint, jclass);\n+  friend void *_Jv_AllocArray (jint, jclass);\n \n   friend jobject _Jv_JNI_ToReflectedField (_Jv_JNIEnv *, jclass, jfieldID,\n \t\t\t\t\t   jboolean);"}, {"sha": "b03b8c22a0fcda8a5f34212a2f0f3a430cf698fd", "filename": "libjava/java/lang/natClassLoader.cc", "status": "modified", "additions": 6, "deletions": 4, "changes": 10, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/bf3b8e42e291aeaeae178f6be1a49deebcd4e527/libjava%2Fjava%2Flang%2FnatClassLoader.cc", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/bf3b8e42e291aeaeae178f6be1a49deebcd4e527/libjava%2Fjava%2Flang%2FnatClassLoader.cc", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libjava%2Fjava%2Flang%2FnatClassLoader.cc?ref=bf3b8e42e291aeaeae178f6be1a49deebcd4e527", "patch": "@@ -586,16 +586,15 @@ _Jv_FindArrayClass (jclass element, java::lang::ClassLoader *loader,\n       array_class = _Jv_NewClass (array_name, &ObjectClass, element->loader);\n \n       // Note that `vtable_method_count' doesn't include the initial\n-      // NULL slot.\n+      // gc_descr slot.\n       JvAssert (ObjectClass.vtable_method_count == NUM_OBJECT_METHODS);\n-      int dm_count = ObjectClass.vtable_method_count + 1;\n+      int dm_count = ObjectClass.vtable_method_count;\n \n       // Create a new vtable by copying Object's vtable (except the\n       // class pointer, of course).  Note that we allocate this as\n       // unscanned memory -- the vtables are handled specially by the\n       // GC.\n-      int size = (sizeof (_Jv_VTable) +\n-\t\t  ((dm_count - 1) * sizeof (void *)));\n+      int size = (sizeof (_Jv_VTable) + ((dm_count - 1) * sizeof (void *)));\n       _Jv_VTable *vtable;\n       if (array_vtable)\n \tvtable = array_vtable;\n@@ -604,6 +603,7 @@ _Jv_FindArrayClass (jclass element, java::lang::ClassLoader *loader,\n       vtable->clas = array_class;\n       memcpy (vtable->method, ObjectClass.vtable->method,\n \t      dm_count * sizeof (void *));\n+      vtable->gc_descr = ObjectClass.vtable->gc_descr;\n       array_class->vtable = vtable;\n       array_class->vtable_method_count = ObjectClass.vtable_method_count;\n \n@@ -615,6 +615,8 @@ _Jv_FindArrayClass (jclass element, java::lang::ClassLoader *loader,\n       array_class->interfaces = interfaces;\n       array_class->interface_count = sizeof interfaces / sizeof interfaces[0];\n \n+      // FIXME: Shouldn't this be synchronized? _Jv_PrepareConstantTimeTables\n+      // needs to be called with the mutex for array_class held.\n       // Generate the interface dispatch table.\n       _Jv_PrepareConstantTimeTables (array_class);\n "}, {"sha": "ec026580f28fece7ed2ed562402385789366066b", "filename": "libjava/libgcj.spec.in", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/bf3b8e42e291aeaeae178f6be1a49deebcd4e527/libjava%2Flibgcj.spec.in", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/bf3b8e42e291aeaeae178f6be1a49deebcd4e527/libjava%2Flibgcj.spec.in", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libjava%2Flibgcj.spec.in?ref=bf3b8e42e291aeaeae178f6be1a49deebcd4e527", "patch": "@@ -6,7 +6,7 @@\n %rename lib liborig\n *lib: -lgcj -lm @GCSPEC@ @THREADSPEC@ @ZLIBSPEC@ @SYSTEMSPEC@ %(liborig)\n \n-*jc1:  @DIVIDESPEC@ @EXCEPTIONSPEC@ -fasynchronous-exceptions\n+*jc1:  @DIVIDESPEC@ @EXCEPTIONSPEC@ @JC1GCSPEC@ -fasynchronous-exceptions\n \n #\n # libgcc should really be a shared library.  This is a design flaw"}, {"sha": "b5bd6f3d1f569549ea8502d5fedac73545e1cb99", "filename": "libjava/nogc.cc", "status": "modified", "additions": 16, "deletions": 4, "changes": 20, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/bf3b8e42e291aeaeae178f6be1a49deebcd4e527/libjava%2Fnogc.cc", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/bf3b8e42e291aeaeae178f6be1a49deebcd4e527/libjava%2Fnogc.cc", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libjava%2Fnogc.cc?ref=bf3b8e42e291aeaeae178f6be1a49deebcd4e527", "patch": "@@ -19,18 +19,30 @@ details.  */\n // Total amount of memory allocated.\n static long total = 0;\n \n+#ifdef INTERPRETER\n void *\n-_Jv_AllocObj (jsize size)\n+_Jv_BuildGCDescr(jclass klass)\n+{\n+  return 0;\n+}\n+#endif\n+\n+void *\n+_Jv_AllocObj (jsize size, jclass klass)\n {\n   total += size;\n-  return calloc (size, 1);\n+  ptr_t obj = calloc (size, 1);\n+  *((_Jv_VTable **) obj) = klass->vtable;\n+  return obj;\n }\n \n void *\n-_Jv_AllocArray (jsize size)\n+_Jv_AllocArray (jsize size, jclass klass)\n {\n   total += size;\n-  return calloc (size, 1);\n+  ptr_t obj = calloc (size, 1);\n+  *((_Jv_VTable **) obj) = klass->vtable;\n+  return obj;\n }\n \n void *"}, {"sha": "ff48b9724d7e6983cf357a5d13d4d67a5a5038ba", "filename": "libjava/prims.cc", "status": "modified", "additions": 11, "deletions": 19, "changes": 30, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/bf3b8e42e291aeaeae178f6be1a49deebcd4e527/libjava%2Fprims.cc", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/bf3b8e42e291aeaeae178f6be1a49deebcd4e527/libjava%2Fprims.cc", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libjava%2Fprims.cc?ref=bf3b8e42e291aeaeae178f6be1a49deebcd4e527", "patch": "@@ -335,18 +335,17 @@ _Jv_AllocBytesChecked (jsize size)\n   return r;\n }\n \n-// Allocate a new object of class C.  SIZE is the size of the object\n+// Allocate a new object of class KLASS.  SIZE is the size of the object\n // to allocate.  You might think this is redundant, but it isn't; some\n // classes, such as String, aren't of fixed size.\n jobject\n-_Jv_AllocObject (jclass c, jint size)\n+_Jv_AllocObject (jclass klass, jint size)\n {\n-  _Jv_InitClass (c);\n+  _Jv_InitClass (klass);\n \n-  jobject obj = (jobject) _Jv_AllocObj (size);\n+  jobject obj = (jobject) _Jv_AllocObj (size, klass);\n   if (__builtin_expect (! obj, false))\n     JvThrow (no_memory);\n-  *((_Jv_VTable **) obj) = c->vtable;\n \n   // If this class has inherited finalize from Object, then don't\n   // bother registering a finalizer.  We know that finalize() is the\n@@ -355,7 +354,7 @@ _Jv_AllocObject (jclass c, jint size)\n   // implementation would look for Object.finalize in Object's method\n   // table at startup, and then use that information to find the\n   // appropriate index in the method vector.\n-  if (c->vtable->method[1] != ObjectClass.vtable->method[1])\n+  if (klass->vtable->get_finalizer() != ObjectClass.vtable->get_finalizer())\n     _Jv_RegisterFinalizer (obj, _Jv_FinalizeObject);\n \n #ifdef ENABLE_JVMPI\n@@ -368,7 +367,7 @@ _Jv_AllocObject (jclass c, jint size)\n       event.event_type = JVMPI_EVENT_OBJECT_ALLOC;\n       event.env_id = NULL;\n       event.u.obj_alloc.arena_id = 0;\n-      event.u.obj_alloc.class_id = (jobjectID) c;\n+      event.u.obj_alloc.class_id = (jobjectID) klass;\n       event.u.obj_alloc.is_array = 0;\n       event.u.obj_alloc.size = size;\n       event.u.obj_alloc.obj_id = (jobjectID) obj;\n@@ -405,9 +404,9 @@ _Jv_NewObjectArray (jsize count, jclass elementClass, jobject init)\n   size += count * sizeof (jobject);\n \n   // FIXME: second argument should be \"current loader\" //\n-  jclass clas = _Jv_FindArrayClass (elementClass, 0);\n+  jclass klass = _Jv_FindArrayClass (elementClass, 0);\n \n-  obj = (jobjectArray) _Jv_AllocArray (size);\n+  obj = (jobjectArray) _Jv_AllocArray (size, klass);\n   if (__builtin_expect (! obj, false))\n     JvThrow (no_memory);\n   obj->length = count;\n@@ -419,10 +418,6 @@ _Jv_NewObjectArray (jsize count, jclass elementClass, jobject init)\n       while (--count >= 0)\n \t*ptr++ = init;\n     }\n-  // Set the vtbl last to avoid problems if the GC happens during the\n-  // window in this function between the allocation and this\n-  // assignment.\n-  *((_Jv_VTable **) obj) = clas->vtable;\n   return obj;\n }\n \n@@ -444,17 +439,14 @@ _Jv_NewPrimArray (jclass eltype, jint count)\n \t\t\t(SIZE_T_MAX - size) / elsize, false))\n     JvThrow (no_memory);\n \n-  __JArray *arr = (__JArray*) _Jv_AllocObj (size + elsize * count);\n+  jclass klass = _Jv_FindArrayClass (eltype, 0);\n+\n+  __JArray *arr = (__JArray*) _Jv_AllocObj (size + elsize * count, klass);\n   if (__builtin_expect (! arr, false))\n     JvThrow (no_memory);\n   arr->length = count;\n   // Note that we assume we are given zeroed memory by the allocator.\n \n-  jclass klass = _Jv_FindArrayClass (eltype, 0);\n-  // Set the vtbl last to avoid problems if the GC happens during the\n-  // window in this function between the allocation and this\n-  // assignment.\n-  *((_Jv_VTable **) arr) = klass->vtable;\n   return arr;\n }\n "}, {"sha": "898de51ff5cdfde917f0c39fbb267824f01855e0", "filename": "libjava/resolve.cc", "status": "modified", "additions": 22, "deletions": 18, "changes": 40, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/bf3b8e42e291aeaeae178f6be1a49deebcd4e527/libjava%2Fresolve.cc", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/bf3b8e42e291aeaeae178f6be1a49deebcd4e527/libjava%2Fresolve.cc", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libjava%2Fresolve.cc?ref=bf3b8e42e291aeaeae178f6be1a49deebcd4e527", "patch": "@@ -46,6 +46,9 @@ extern java::lang::Class ClassObject;\n #define ObjectClass _CL_Q34java4lang6Object\n extern java::lang::Class ObjectClass;\n \n+// Exceptional return values for _Jv_DetermineVTableIndex\n+#define METHOD_NOT_THERE (-2)\n+#define METHOD_INACCESSIBLE (-1)\n \n static int get_alignment_from_class (jclass);\n \n@@ -299,7 +302,7 @@ _Jv_ResolvePoolEntry (jclass klass, int index)\n \tvtable_index = _Jv_DetermineVTableIndex\n \t  (found_class, method_name, method_signature);\n \n-      if (vtable_index == 0)\n+      if (vtable_index == METHOD_NOT_THERE)\n \tthrow_incompatible_class_change_error\n \t  (JvNewStringLatin1 (\"method not found\"));\n \n@@ -378,9 +381,9 @@ _Jv_ResolveField (_Jv_Field *field, java::lang::ClassLoader *loader)\n     things if compiled classes to know vtable offset, and _Jv_Method had\n     a field for this.\n \n-    Returns 0  if this class does not declare the given method.\n-    Returns -1 if the given method does not appear in the vtable.\n-               i.e., it is static, private, final or a constructor.\n+    Returns METHOD_NOT_THERE if this class does not declare the given method.\n+    Returns METHOD_INACCESSIBLE if the given method does not appear in the\n+\t\tvtable, i.e., it is static, private, final or a constructor.\n     Otherwise, returns the vtable index.  */\n int \n _Jv_DetermineVTableIndex (jclass klass,\n@@ -396,7 +399,7 @@ _Jv_DetermineVTableIndex (jclass klass,\n       int prev = _Jv_DetermineVTableIndex (super_class,\n \t\t\t\t\t   name,\n \t\t\t\t\t   signature);\n-      if (prev != 0)\n+      if (prev != METHOD_NOT_THERE)\n \treturn prev;\n     }\n \n@@ -410,7 +413,7 @@ _Jv_DetermineVTableIndex (jclass klass,\n \n   /* now, if we do not declare this method, return zero */\n   if (meth == NULL)\n-    return 0;\n+    return METHOD_NOT_THERE;\n \n   /* so now, we know not only that the super class does not declare the\n    * method, but we do!  So, this is a first declaration of the method. */\n@@ -427,21 +430,21 @@ _Jv_DetermineVTableIndex (jclass klass,\n \t\t\t | Modifier::FINAL)) != 0\n       || (klass->accflags & Modifier::FINAL) != 0\n       || _Jv_equalUtf8Consts (name, init_name))\n-    return -1;\n+    return METHOD_INACCESSIBLE;\n \n   /* reaching this point, we know for sure, that the method in question\n    * will be in the vtable.  The question is where. */\n \n   /* the base offset, is where we will start assigning vtable\n-   * indexes for this class.  It is 1 for base classes\n-   * (vtable->method[0] is unused), and for non-base classes it is the\n-   * number of entries in the super class' vtable plus 1. */\n+   * indexes for this class.  It is 0 for base classes\n+   * and for non-base classes it is the\n+   * number of entries in the super class' vtable. */\n \n   int base_offset;\n   if (super_class == 0)\n-    base_offset = 1;\n+    base_offset = 0;\n   else\n-    base_offset = super_class->vtable_method_count+1;\n+    base_offset = super_class->vtable_method_count;\n \n   /* we will consider methods 0..this_method_index-1.  And for each one,\n    * determine if it is new (i.e., if it appears in the super class),\n@@ -704,6 +707,7 @@ _Jv_PrepareClass(jclass klass)\n     _Jv_AllocBytesChecked (sizeof (_Jv_VTable) \n \t\t\t   + (sizeof (void*) * (vtable_count)));\n   vtable->clas = clz;\n+  vtable->gc_descr = _Jv_BuildGCDescr(clz);\n \n   {\n     jclass effective_superclass = super_class;\n@@ -713,10 +717,10 @@ _Jv_PrepareClass(jclass klass)\n     while (effective_superclass && effective_superclass->vtable == NULL)\n       effective_superclass = effective_superclass->superclass;\n \n-    /* copy super class' vtable entries (index 0 goes unused). */\n+    /* copy super class' vtable entries. */\n     if (effective_superclass && effective_superclass->vtable)\n-      memcpy ((void*)&vtable->method[1],\n-\t      (void*)&effective_superclass->vtable->method[1],\n+      memcpy ((void*)&vtable->method[0],\n+\t      (void*)&effective_superclass->vtable->method[0],\n \t      sizeof (void*) * effective_superclass->vtable_method_count);\n   }\n \n@@ -729,12 +733,12 @@ _Jv_PrepareClass(jclass klass)\n \t\t\t\t\t    this_meth->name,\n \t\t\t\t\t    this_meth->signature);\n \n-      if (index == 0)\n+      if (index == METHOD_NOT_THERE)\n \tthrow_internal_error (\"method now found in own class\");\n \n-      if (index != -1)\n+      if (index != METHOD_INACCESSIBLE)\n \t{\n-\t  if (index > clz->vtable_method_count+1)\n+\t  if (index > clz->vtable_method_count)\n \t    throw_internal_error (\"vtable problem...\");\n \n \t  if (clz->interpreted_methods[i] == 0)"}]}