{"sha": "5d7f4d9c8b2f59093e4d4661089a3f9d28002c61", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6NWQ3ZjRkOWM4YjJmNTkwOTNlNGQ0NjYxMDg5YTNmOWQyODAwMmM2MQ==", "commit": {"author": {"name": "Jan Hubicka", "email": "jh@suse.cz", "date": "2010-07-24T01:04:29Z"}, "committer": {"name": "Jan Hubicka", "email": "hubicka@gcc.gnu.org", "date": "2010-07-24T01:04:29Z"}, "message": "lto-streamer-out.c (write_symbol): Fix visibilities of external references.\n\n\n\t* lto-streamer-out.c (write_symbol): Fix visibilities of external\n\treferences.\n\nFrom-SVN: r162497", "tree": {"sha": "b4af0c6481e91c27c943e4bfaba4273f24431b31", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/b4af0c6481e91c27c943e4bfaba4273f24431b31"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/5d7f4d9c8b2f59093e4d4661089a3f9d28002c61", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/5d7f4d9c8b2f59093e4d4661089a3f9d28002c61", "html_url": "https://github.com/Rust-GCC/gccrs/commit/5d7f4d9c8b2f59093e4d4661089a3f9d28002c61", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/5d7f4d9c8b2f59093e4d4661089a3f9d28002c61/comments", "author": null, "committer": null, "parents": [{"sha": "67d8bd24cd70cf6d33d3babd293f1c8b18ff94ed", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/67d8bd24cd70cf6d33d3babd293f1c8b18ff94ed", "html_url": "https://github.com/Rust-GCC/gccrs/commit/67d8bd24cd70cf6d33d3babd293f1c8b18ff94ed"}], "stats": {"total": 46, "additions": 31, "deletions": 15}, "files": [{"sha": "cfdd938fb3e0da82b8876fc0f6fc4198db159ef0", "filename": "gcc/ChangeLog", "status": "modified", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/5d7f4d9c8b2f59093e4d4661089a3f9d28002c61/gcc%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/5d7f4d9c8b2f59093e4d4661089a3f9d28002c61/gcc%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2FChangeLog?ref=5d7f4d9c8b2f59093e4d4661089a3f9d28002c61", "patch": "@@ -1,3 +1,8 @@\n+2010-07-23  Jan Hubicka  <jh@suse.cz>\n+\n+\t* lto-streamer-out.c (write_symbol): Fix visibilities of external\n+\treferences.\n+\n 2010-07-23  Le-Chun Wu  <lcwu@google.com>\n \n \t* omega.c (omega_eliminate_redundant): Remove a self-assign statement."}, {"sha": "98d94428e57f67a36bc50ed061cd3b2afe1305c1", "filename": "gcc/lto-streamer-out.c", "status": "modified", "additions": 26, "deletions": 15, "changes": 41, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/5d7f4d9c8b2f59093e4d4661089a3f9d28002c61/gcc%2Flto-streamer-out.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/5d7f4d9c8b2f59093e4d4661089a3f9d28002c61/gcc%2Flto-streamer-out.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Flto-streamer-out.c?ref=5d7f4d9c8b2f59093e4d4661089a3f9d28002c61", "patch": "@@ -2352,21 +2352,32 @@ write_symbol (struct lto_streamer_cache_d *cache,\n \t\t      && cgraph_get_node (t)->analyzed));\n     }\n \n-  switch (DECL_VISIBILITY(t))\n-    {\n-    case VISIBILITY_DEFAULT:\n-      visibility = GCCPV_DEFAULT;\n-      break;\n-    case VISIBILITY_PROTECTED:\n-      visibility = GCCPV_PROTECTED;\n-      break;\n-    case VISIBILITY_HIDDEN:\n-      visibility = GCCPV_HIDDEN;\n-      break;\n-    case VISIBILITY_INTERNAL:\n-      visibility = GCCPV_INTERNAL;\n-      break;\n-    }\n+  /* Imitate what default_elf_asm_output_external do.\n+     When symbol is external, we need to output it with DEFAULT visibility\n+     when compiling with -fvisibility=default, while with HIDDEN visibility\n+     when symbol has attribute (visibility(\"hidden\")) specified.\n+     targetm.binds_local_p check DECL_VISIBILITY_SPECIFIED and gets this\n+     right. */\n+     \n+  if (DECL_EXTERNAL (t)\n+      && !targetm.binds_local_p (t))\n+    visibility = GCCPV_DEFAULT;\n+  else\n+    switch (DECL_VISIBILITY(t))\n+      {\n+      case VISIBILITY_DEFAULT:\n+\tvisibility = GCCPV_DEFAULT;\n+\tbreak;\n+      case VISIBILITY_PROTECTED:\n+\tvisibility = GCCPV_PROTECTED;\n+\tbreak;\n+      case VISIBILITY_HIDDEN:\n+\tvisibility = GCCPV_HIDDEN;\n+\tbreak;\n+      case VISIBILITY_INTERNAL:\n+\tvisibility = GCCPV_INTERNAL;\n+\tbreak;\n+      }\n \n   if (kind == GCCPK_COMMON\n       && DECL_SIZE (t)"}]}