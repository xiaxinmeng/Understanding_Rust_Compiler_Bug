{"sha": "e929d65b48ad5583e995d872ca5de95b23de4d72", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6ZTkyOWQ2NWI0OGFkNTU4M2U5OTVkODcyY2E1ZGU5NWIyM2RlNGQ3Mg==", "commit": {"author": {"name": "Julian Brown", "email": "julian@codesourcery.com", "date": "2020-02-10T20:26:57Z"}, "committer": {"name": "Julian Brown", "email": "julian@codesourcery.com", "date": "2020-09-08T20:26:42Z"}, "message": "amdgcn: Add waitcnt after LDS write instructions\n\nData-share write (ds_write) instructions do not necessarily complete\nthe write to LDS immediately. When a write completes, LGKM_CNT is\ndecremented. For now, we wait until LGKM_CNT reaches zero after each\nds_write instruction.\n\nThis fixes a race condition in the case where LDS is read immediately\nafter being written. This can happen with broadcast operations.\n\n2020-09-08  Julian Brown  <julian@codesourcery.com>\n\ngcc/\n\t* config/gcn/gcn-valu.md (scatter<mode>_insn_1offset_ds<exec_scatter>):\n\tAdd waitcnt.\n\t* config/gcn/gcn.md (*mov<mode>_insn, *movti_insn): Add waitcnt to\n\tds_write alternatives.", "tree": {"sha": "653ba525d9caf52a579a85f2e5e929cf36307744", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/653ba525d9caf52a579a85f2e5e929cf36307744"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/e929d65b48ad5583e995d872ca5de95b23de4d72", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/e929d65b48ad5583e995d872ca5de95b23de4d72", "html_url": "https://github.com/Rust-GCC/gccrs/commit/e929d65b48ad5583e995d872ca5de95b23de4d72", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/e929d65b48ad5583e995d872ca5de95b23de4d72/comments", "author": {"login": "jtb20", "id": 6094880, "node_id": "MDQ6VXNlcjYwOTQ4ODA=", "avatar_url": "https://avatars.githubusercontent.com/u/6094880?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jtb20", "html_url": "https://github.com/jtb20", "followers_url": "https://api.github.com/users/jtb20/followers", "following_url": "https://api.github.com/users/jtb20/following{/other_user}", "gists_url": "https://api.github.com/users/jtb20/gists{/gist_id}", "starred_url": "https://api.github.com/users/jtb20/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jtb20/subscriptions", "organizations_url": "https://api.github.com/users/jtb20/orgs", "repos_url": "https://api.github.com/users/jtb20/repos", "events_url": "https://api.github.com/users/jtb20/events{/privacy}", "received_events_url": "https://api.github.com/users/jtb20/received_events", "type": "User", "site_admin": false}, "committer": {"login": "jtb20", "id": 6094880, "node_id": "MDQ6VXNlcjYwOTQ4ODA=", "avatar_url": "https://avatars.githubusercontent.com/u/6094880?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jtb20", "html_url": "https://github.com/jtb20", "followers_url": "https://api.github.com/users/jtb20/followers", "following_url": "https://api.github.com/users/jtb20/following{/other_user}", "gists_url": "https://api.github.com/users/jtb20/gists{/gist_id}", "starred_url": "https://api.github.com/users/jtb20/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jtb20/subscriptions", "organizations_url": "https://api.github.com/users/jtb20/orgs", "repos_url": "https://api.github.com/users/jtb20/repos", "events_url": "https://api.github.com/users/jtb20/events{/privacy}", "received_events_url": "https://api.github.com/users/jtb20/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "3aee3aaf48be2d3d81e381690ae9dd305d8b505f", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/3aee3aaf48be2d3d81e381690ae9dd305d8b505f", "html_url": "https://github.com/Rust-GCC/gccrs/commit/3aee3aaf48be2d3d81e381690ae9dd305d8b505f"}], "stats": {"total": 10, "additions": 5, "deletions": 5}, "files": [{"sha": "e4d7f2a0f495f937cddf4498173d25e895b93fe5", "filename": "gcc/config/gcn/gcn-valu.md", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/e929d65b48ad5583e995d872ca5de95b23de4d72/gcc%2Fconfig%2Fgcn%2Fgcn-valu.md", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/e929d65b48ad5583e995d872ca5de95b23de4d72/gcc%2Fconfig%2Fgcn%2Fgcn-valu.md", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fconfig%2Fgcn%2Fgcn-valu.md?ref=e929d65b48ad5583e995d872ca5de95b23de4d72", "patch": "@@ -923,7 +923,7 @@\n   {\n     addr_space_t as = INTVAL (operands[3]);\n     static char buf[200];\n-    sprintf (buf, \"ds_write%%b2\\t%%0, %%2 offset:%%1%s\",\n+    sprintf (buf, \"ds_write%%b2\\t%%0, %%2 offset:%%1%s\\;s_waitcnt\\tlgkmcnt(0)\",\n \t     (AS_GDS_P (as) ? \" gds\" : \"\"));\n     return buf;\n   }"}, {"sha": "aeb25fbb931114376d3d640c45f99beadcb37e9f", "filename": "gcc/config/gcn/gcn.md", "status": "modified", "additions": 4, "deletions": 4, "changes": 8, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/e929d65b48ad5583e995d872ca5de95b23de4d72/gcc%2Fconfig%2Fgcn%2Fgcn.md", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/e929d65b48ad5583e995d872ca5de95b23de4d72/gcc%2Fconfig%2Fgcn%2Fgcn.md", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fconfig%2Fgcn%2Fgcn.md?ref=e929d65b48ad5583e995d872ca5de95b23de4d72", "patch": "@@ -554,7 +554,7 @@\n   flat_load_dword\\t%0, %A1%O1%g1\\;s_waitcnt\\t0\n   flat_store_dword\\t%A0, %1%O0%g0\n   v_mov_b32\\t%0, %1\n-  ds_write_b32\\t%A0, %1%O0\n+  ds_write_b32\\t%A0, %1%O0\\;s_waitcnt\\tlgkmcnt(0)\n   ds_read_b32\\t%0, %A1%O1\\;s_waitcnt\\tlgkmcnt(0)\n   s_mov_b32\\t%0, %1\n   global_load_dword\\t%0, %A1%O1%g1\\;s_waitcnt\\tvmcnt(0)\n@@ -582,7 +582,7 @@\n   flat_load%o1\\t%0, %A1%O1%g1\\;s_waitcnt\\t0\n   flat_store%s0\\t%A0, %1%O0%g0\n   v_mov_b32\\t%0, %1\n-  ds_write%b0\\t%A0, %1%O0\n+  ds_write%b0\\t%A0, %1%O0\\;s_waitcnt\\tlgkmcnt(0)\n   ds_read%u1\\t%0, %A1%O1\\;s_waitcnt\\tlgkmcnt(0)\n   global_load%o1\\t%0, %A1%O1%g1\\;s_waitcnt\\tvmcnt(0)\n   global_store%s0\\t%A0, %1%O0%g0\"\n@@ -611,7 +611,7 @@\n   #\n   flat_load_dwordx2\\t%0, %A1%O1%g1\\;s_waitcnt\\t0\n   flat_store_dwordx2\\t%A0, %1%O0%g0\n-  ds_write_b64\\t%A0, %1%O0\n+  ds_write_b64\\t%A0, %1%O0\\;s_waitcnt\\tlgkmcnt(0)\n   ds_read_b64\\t%0, %A1%O1\\;s_waitcnt\\tlgkmcnt(0)\n   global_load_dwordx2\\t%0, %A1%O1%g1\\;s_waitcnt\\tvmcnt(0)\n   global_store_dwordx2\\t%A0, %1%O0%g0\"\n@@ -667,7 +667,7 @@\n   #\n   global_store_dwordx4\\t%A0, %1%O0%g0\n   global_load_dwordx4\\t%0, %A1%O1%g1\\;s_waitcnt\\tvmcnt(0)\n-  ds_write_b128\\t%A0, %1%O0\n+  ds_write_b128\\t%A0, %1%O0\\;s_waitcnt\\tlgkmcnt(0)\n   ds_read_b128\\t%0, %A1%O1\\;s_waitcnt\\tlgkmcnt(0)\"\n   \"reload_completed\n    && REG_P (operands[0])"}]}