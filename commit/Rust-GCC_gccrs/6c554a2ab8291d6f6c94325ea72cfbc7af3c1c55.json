{"sha": "6c554a2ab8291d6f6c94325ea72cfbc7af3c1c55", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6NmM1NTRhMmFiODI5MWQ2ZjZjOTQzMjVlYTcyY2ZiYzdhZjNjMWM1NQ==", "commit": {"author": {"name": "Jakub Jelinek", "email": "jakub@redhat.com", "date": "2016-11-18T21:56:50Z"}, "committer": {"name": "Jakub Jelinek", "email": "jakub@gcc.gnu.org", "date": "2016-11-18T21:56:50Z"}, "message": "re PR c++/77285 (extern thread_local linkage)\n\n\tPR c++/77285\n\t* mangle.c (mangle_tls_init_fn, mangle_tls_wrapper_fn): Call\n\tcheck_abi_tags.\n\n\t* g++.dg/tls/pr77285-1.C: New test.\n\t* g++.dg/tls/pr77285-2.C: New test.\n\nFrom-SVN: r242607", "tree": {"sha": "bbef65c808b37d0d6fa2bcbe6b83f4e6baf14f29", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/bbef65c808b37d0d6fa2bcbe6b83f4e6baf14f29"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/6c554a2ab8291d6f6c94325ea72cfbc7af3c1c55", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/6c554a2ab8291d6f6c94325ea72cfbc7af3c1c55", "html_url": "https://github.com/Rust-GCC/gccrs/commit/6c554a2ab8291d6f6c94325ea72cfbc7af3c1c55", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/6c554a2ab8291d6f6c94325ea72cfbc7af3c1c55/comments", "author": {"login": "jakubjelinek", "id": 9370665, "node_id": "MDQ6VXNlcjkzNzA2NjU=", "avatar_url": "https://avatars.githubusercontent.com/u/9370665?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jakubjelinek", "html_url": "https://github.com/jakubjelinek", "followers_url": "https://api.github.com/users/jakubjelinek/followers", "following_url": "https://api.github.com/users/jakubjelinek/following{/other_user}", "gists_url": "https://api.github.com/users/jakubjelinek/gists{/gist_id}", "starred_url": "https://api.github.com/users/jakubjelinek/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jakubjelinek/subscriptions", "organizations_url": "https://api.github.com/users/jakubjelinek/orgs", "repos_url": "https://api.github.com/users/jakubjelinek/repos", "events_url": "https://api.github.com/users/jakubjelinek/events{/privacy}", "received_events_url": "https://api.github.com/users/jakubjelinek/received_events", "type": "User", "site_admin": false}, "committer": null, "parents": [{"sha": "33305b74b7b050a1a220c2d4d50fbb9ddccb7c58", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/33305b74b7b050a1a220c2d4d50fbb9ddccb7c58", "html_url": "https://github.com/Rust-GCC/gccrs/commit/33305b74b7b050a1a220c2d4d50fbb9ddccb7c58"}], "stats": {"total": 38, "additions": 38, "deletions": 0}, "files": [{"sha": "c26f1455a7aacd21491f1d60d34067c7eddcbe2d", "filename": "gcc/cp/ChangeLog", "status": "modified", "additions": 6, "deletions": 0, "changes": 6, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/6c554a2ab8291d6f6c94325ea72cfbc7af3c1c55/gcc%2Fcp%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/6c554a2ab8291d6f6c94325ea72cfbc7af3c1c55/gcc%2Fcp%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fcp%2FChangeLog?ref=6c554a2ab8291d6f6c94325ea72cfbc7af3c1c55", "patch": "@@ -1,3 +1,9 @@\n+2016-11-18  Jakub Jelinek  <jakub@redhat.com>\n+\n+\tPR c++/77285\n+\t* mangle.c (mangle_tls_init_fn, mangle_tls_wrapper_fn): Call\n+\tcheck_abi_tags.\n+\n 2016-11-18  Jason Merrill  <jason@redhat.com>\n \n \tPR c++/67631 - list-init and explicit conversions"}, {"sha": "4fffe0bb4d2d40fe2f32f2901a5e5638b81f6bf7", "filename": "gcc/cp/mangle.c", "status": "modified", "additions": 2, "deletions": 0, "changes": 2, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/6c554a2ab8291d6f6c94325ea72cfbc7af3c1c55/gcc%2Fcp%2Fmangle.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/6c554a2ab8291d6f6c94325ea72cfbc7af3c1c55/gcc%2Fcp%2Fmangle.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fcp%2Fmangle.c?ref=6c554a2ab8291d6f6c94325ea72cfbc7af3c1c55", "patch": "@@ -4301,6 +4301,7 @@ mangle_guard_variable (const tree variable)\n tree\n mangle_tls_init_fn (const tree variable)\n {\n+  check_abi_tags (variable);\n   start_mangling (variable);\n   write_string (\"_ZTH\");\n   write_guarded_var_name (variable);\n@@ -4315,6 +4316,7 @@ mangle_tls_init_fn (const tree variable)\n tree\n mangle_tls_wrapper_fn (const tree variable)\n {\n+  check_abi_tags (variable);\n   start_mangling (variable);\n   write_string (TLS_WRAPPER_PREFIX);\n   write_guarded_var_name (variable);"}, {"sha": "c94d808a1debe8cce8542ed3efd33fd8464c489c", "filename": "gcc/testsuite/ChangeLog", "status": "modified", "additions": 6, "deletions": 0, "changes": 6, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/6c554a2ab8291d6f6c94325ea72cfbc7af3c1c55/gcc%2Ftestsuite%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/6c554a2ab8291d6f6c94325ea72cfbc7af3c1c55/gcc%2Ftestsuite%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2FChangeLog?ref=6c554a2ab8291d6f6c94325ea72cfbc7af3c1c55", "patch": "@@ -1,3 +1,9 @@\n+2016-11-18  Jakub Jelinek  <jakub@redhat.com>\n+\n+\tPR c++/77285\n+\t* g++.dg/tls/pr77285-1.C: New test.\n+\t* g++.dg/tls/pr77285-2.C: New test.\n+\n 2016-11-18  Jeff Law  <law@redhat.com>\n \n \tPR target/25112"}, {"sha": "d8f69b2010ced8267e32a8c777416e3dc127edf7", "filename": "gcc/testsuite/g++.dg/tls/pr77285-1.C", "status": "added", "additions": 7, "deletions": 0, "changes": 7, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/6c554a2ab8291d6f6c94325ea72cfbc7af3c1c55/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Ftls%2Fpr77285-1.C", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/6c554a2ab8291d6f6c94325ea72cfbc7af3c1c55/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Ftls%2Fpr77285-1.C", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Ftls%2Fpr77285-1.C?ref=6c554a2ab8291d6f6c94325ea72cfbc7af3c1c55", "patch": "@@ -0,0 +1,7 @@\n+// { dg-do link { target c++11 } }\n+// { dg-require-effective-target tls }\n+// { dg-additional-sources pr77285-2.C }\n+\n+struct __attribute__((abi_tag(\"tag\"))) X { ~X () {} int i = 0; };\n+thread_local X var1;\n+X var2;"}, {"sha": "bac273a4d6837dee589cb7a130d18168f1e502c8", "filename": "gcc/testsuite/g++.dg/tls/pr77285-2.C", "status": "added", "additions": 17, "deletions": 0, "changes": 17, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/6c554a2ab8291d6f6c94325ea72cfbc7af3c1c55/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Ftls%2Fpr77285-2.C", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/6c554a2ab8291d6f6c94325ea72cfbc7af3c1c55/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Ftls%2Fpr77285-2.C", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Ftls%2Fpr77285-2.C?ref=6c554a2ab8291d6f6c94325ea72cfbc7af3c1c55", "patch": "@@ -0,0 +1,17 @@\n+// PR c++/77285\n+// { dg-do compile { target c++11 } }\n+// { dg-require-effective-target tls }\n+// { dg-final { scan-assembler \"_Z4var1B3tag\" } }\n+// { dg-final { scan-assembler \"_Z4var2B3tag\" } }\n+// { dg-final { scan-assembler \"_ZTH4var1B3tag\" } }\n+// { dg-final { scan-assembler \"_ZTW4var1B3tag\" } }\n+\n+struct __attribute__((abi_tag(\"tag\"))) X { ~X () {} int i = 0; };\n+extern thread_local X var1;\n+extern X var2;\n+\n+int\n+main ()\n+{\n+ return var1.i + var2.i;\n+}"}]}