{"sha": "6ea5fb3cc7f3cc9b731d72183c66c23543876f5a", "node_id": "C_kwDOANBUbNoAKDZlYTVmYjNjYzdmM2NjOWI3MzFkNzIxODNjNjZjMjM1NDM4NzZmNWE", "commit": {"author": {"name": "Roger Sayle", "email": "roger@nextmovesoftware.com", "date": "2021-11-25T19:02:06Z"}, "committer": {"name": "Roger Sayle", "email": "roger@nextmovesoftware.com", "date": "2021-11-25T19:02:06Z"}, "message": "PR middle-end/103406: Check for Inf before simplifying x-x.\n\nThis is a simple one line fix to the regression PR middle-end/103406,\nwhere x - x is being folded to 0.0 even when x is +Inf or -Inf.\nIn GCC 11 and previously, we'd check whether the type honored NaNs\n(which implicitly covered the case where the type honors infinities),\nbut my patch to test whether the operand could potentially be NaN\nfailed to also check whether the operand could potentially be Inf.\n\n2021-11-25  Roger Sayle  <roger@nextmovesoftware.com>\n\ngcc/ChangeLog\n\tPR middle-end/103406\n\t* match.pd (minus @0 @0): Check tree_expr_maybe_infinite_p.\n\ngcc/testsuite/ChangeLog\n\tPR middle-end/103406\n\t* gcc.dg/pr103406.c: New test case.", "tree": {"sha": "2b5e6764bfe48e574083d57a5cfc6914717ffd7b", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/2b5e6764bfe48e574083d57a5cfc6914717ffd7b"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/6ea5fb3cc7f3cc9b731d72183c66c23543876f5a", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/6ea5fb3cc7f3cc9b731d72183c66c23543876f5a", "html_url": "https://github.com/Rust-GCC/gccrs/commit/6ea5fb3cc7f3cc9b731d72183c66c23543876f5a", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/6ea5fb3cc7f3cc9b731d72183c66c23543876f5a/comments", "author": {"login": "rogersayle", "id": 13512313, "node_id": "MDQ6VXNlcjEzNTEyMzEz", "avatar_url": "https://avatars.githubusercontent.com/u/13512313?v=4", "gravatar_id": "", "url": "https://api.github.com/users/rogersayle", "html_url": "https://github.com/rogersayle", "followers_url": "https://api.github.com/users/rogersayle/followers", "following_url": "https://api.github.com/users/rogersayle/following{/other_user}", "gists_url": "https://api.github.com/users/rogersayle/gists{/gist_id}", "starred_url": "https://api.github.com/users/rogersayle/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/rogersayle/subscriptions", "organizations_url": "https://api.github.com/users/rogersayle/orgs", "repos_url": "https://api.github.com/users/rogersayle/repos", "events_url": "https://api.github.com/users/rogersayle/events{/privacy}", "received_events_url": "https://api.github.com/users/rogersayle/received_events", "type": "User", "site_admin": false}, "committer": {"login": "rogersayle", "id": 13512313, "node_id": "MDQ6VXNlcjEzNTEyMzEz", "avatar_url": "https://avatars.githubusercontent.com/u/13512313?v=4", "gravatar_id": "", "url": "https://api.github.com/users/rogersayle", "html_url": "https://github.com/rogersayle", "followers_url": "https://api.github.com/users/rogersayle/followers", "following_url": "https://api.github.com/users/rogersayle/following{/other_user}", "gists_url": "https://api.github.com/users/rogersayle/gists{/gist_id}", "starred_url": "https://api.github.com/users/rogersayle/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/rogersayle/subscriptions", "organizations_url": "https://api.github.com/users/rogersayle/orgs", "repos_url": "https://api.github.com/users/rogersayle/repos", "events_url": "https://api.github.com/users/rogersayle/events{/privacy}", "received_events_url": "https://api.github.com/users/rogersayle/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "9488d24206687be80443dafdb2cdfc4ff3aca28c", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/9488d24206687be80443dafdb2cdfc4ff3aca28c", "html_url": "https://github.com/Rust-GCC/gccrs/commit/9488d24206687be80443dafdb2cdfc4ff3aca28c"}], "stats": {"total": 18, "additions": 17, "deletions": 1}, "files": [{"sha": "fbb5a5a1eeb98d114589ed3435313b135e9e44a4", "filename": "gcc/match.pd", "status": "modified", "additions": 3, "deletions": 1, "changes": 4, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/6ea5fb3cc7f3cc9b731d72183c66c23543876f5a/gcc%2Fmatch.pd", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/6ea5fb3cc7f3cc9b731d72183c66c23543876f5a/gcc%2Fmatch.pd", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fmatch.pd?ref=6ea5fb3cc7f3cc9b731d72183c66c23543876f5a", "patch": "@@ -233,7 +233,9 @@ DEFINE_INT_AND_FLOAT_ROUND_FN (RINT)\n    is volatile.  */\n (simplify\n  (minus @0 @0)\n- (if (!FLOAT_TYPE_P (type) || !tree_expr_maybe_nan_p (@0))\n+ (if (!FLOAT_TYPE_P (type)\n+      || (!tree_expr_maybe_nan_p (@0)\n+\t  && !tree_expr_maybe_infinite_p (@0)))\n   { build_zero_cst (type); }))\n (simplify\n  (pointer_diff @@0 @0)"}, {"sha": "9c7b83b2e9eadbe032eba26ca8ac2bfc8185a25e", "filename": "gcc/testsuite/gcc.dg/pr103406.c", "status": "added", "additions": 14, "deletions": 0, "changes": 14, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/6ea5fb3cc7f3cc9b731d72183c66c23543876f5a/gcc%2Ftestsuite%2Fgcc.dg%2Fpr103406.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/6ea5fb3cc7f3cc9b731d72183c66c23543876f5a/gcc%2Ftestsuite%2Fgcc.dg%2Fpr103406.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgcc.dg%2Fpr103406.c?ref=6ea5fb3cc7f3cc9b731d72183c66c23543876f5a", "patch": "@@ -0,0 +1,14 @@\n+/* { dg-do compile } */\n+/* { dg-options \"-O2 -fdump-tree-optimized\" } */\n+\n+#define HUGE __DBL_MAX__\n+#define INF (HUGE + HUGE)\n+#define NAN (INF - INF)\n+\n+double foo() {\n+  double x = -NAN;\n+  double y = NAN;\n+  return x + y;\n+}\n+\n+/* { dg-final { scan-tree-dump-not \"return 0\\.0\" \"optimized\" } } */"}]}