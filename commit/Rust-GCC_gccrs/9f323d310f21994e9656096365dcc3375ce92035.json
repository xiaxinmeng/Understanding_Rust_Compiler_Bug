{"sha": "9f323d310f21994e9656096365dcc3375ce92035", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6OWYzMjNkMzEwZjIxOTk0ZTk2NTYwOTYzNjVkY2MzMzc1Y2U5MjAzNQ==", "commit": {"author": {"name": "Richard Stallman", "email": "rms@gnu.org", "date": "1993-06-19T08:14:23Z"}, "committer": {"name": "Richard Stallman", "email": "rms@gnu.org", "date": "1993-06-19T08:14:23Z"}, "message": "(MAYBE_VMS_FUNCTION_PROLOGUE): adjust stack pointer by 4 prior to calling C$MAIN_ARGS...\n\n(MAYBE_VMS_FUNCTION_PROLOGUE): adjust stack pointer by 4 prior\nto calling C$MAIN_ARGS, otherwise POSIX edition of that routine dies.\n\nFrom-SVN: r4697", "tree": {"sha": "1713b8407af5d27da976acafd280584aefb21dc7", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/1713b8407af5d27da976acafd280584aefb21dc7"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/9f323d310f21994e9656096365dcc3375ce92035", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/9f323d310f21994e9656096365dcc3375ce92035", "html_url": "https://github.com/Rust-GCC/gccrs/commit/9f323d310f21994e9656096365dcc3375ce92035", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/9f323d310f21994e9656096365dcc3375ce92035/comments", "author": null, "committer": null, "parents": [{"sha": "adb65c99a624941344020ad77a866c0f4509de7d", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/adb65c99a624941344020ad77a866c0f4509de7d", "html_url": "https://github.com/Rust-GCC/gccrs/commit/adb65c99a624941344020ad77a866c0f4509de7d"}], "stats": {"total": 32, "additions": 18, "deletions": 14}, "files": [{"sha": "a52e8d5de8e77def648573f6f563ef34c7d6d8ad", "filename": "gcc/config/vax/vms.h", "status": "modified", "additions": 18, "deletions": 14, "changes": 32, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/9f323d310f21994e9656096365dcc3375ce92035/gcc%2Fconfig%2Fvax%2Fvms.h", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/9f323d310f21994e9656096365dcc3375ce92035/gcc%2Fconfig%2Fvax%2Fvms.h", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fconfig%2Fvax%2Fvms.h?ref=9f323d310f21994e9656096365dcc3375ce92035", "patch": "@@ -95,23 +95,27 @@ the Free Software Foundation, 675 Mass Ave, Cambridge, MA 02139, USA.  */\n  * if we are running g++, and add the jsb if it is.  In gcc there should never\n  * be a space in the function name, and in g++ there is always a \"(\" in the\n  * function name, thus there should never be any confusion.\n+ *\n+ * Adjusting the stack pointer by 4 before calling C$MAIN_ARGS is required\n+ * when linking with the VMS POSIX version of the C run-time library; using\n+ * `subl2 $4,r0' is adequate but we use `clrl -(sp)' instead.  The extra 4\n+ * bytes could be removed after the call because STARTING_FRAME_OFFSET's\n+ * setting of -4 will end up adding them right back again, but don't bother.\n  */\n #define MAYBE_VMS_FUNCTION_PROLOGUE(FILE)\t\\\n { extern char *current_function_name;\t\t\\\n-  if (!strcmp (\"main\", current_function_name))\t\\\n-    fprintf(FILE, \"\\tjsb _C$MAIN_ARGS\\n\"); \t\\\n-  else {\t\t\t\t\t\\\n-    char *p = current_function_name;\t\t\\\n-    while (*p != '\\0')\t\t\t\t\\\n-      if (*p == *__MAIN_NAME)\t\t\t\\\n-        if (strncmp(p, __MAIN_NAME, (sizeof __MAIN_NAME)-1) == 0) {\\\n-          fprintf(FILE, \"\\tjsb _C$MAIN_ARGS\\n\");\\\n-          break;\t\t\t\t\\\n-        } else\t\t\t\t\t\\\n-          p++;\t\t\t\t\t\\\n-      else\t\t\t\t\t\\\n-        p++;\t\t\t\t\t\\\n-     };\t\t\t\t\t\t\\\n+  char *p = current_function_name;\t\t\\\n+  int is_main = strcmp (\"main\", p) == 0;\t\\\n+  while (!is_main && *p != '\\0')\t\t\\\n+    {\t\t\t\t\t\t\\\n+       if (*p == *__MAIN_NAME\t\t\t\\\n+\t   && strncmp (p, __MAIN_NAME, sizeof __MAIN_NAME - sizeof \"\") == 0) \\\n+\t is_main = 1;\t\t\t\t\\\n+       else\t\t\t\t\t\\\n+\t p++;\t\t\t\t\t\\\n+     }\t\t\t\t\t\t\\\n+  if (is_main)\t\t\t\t\t\\\n+    fprintf (FILE, \"\\t%s\\n\\t%s\\n\", \"clrl -(sp)\", \"jsb _C$MAIN_ARGS\");\t\\\n }\n \n /* This macro definition sets up a default value for `main' to return.  */"}]}