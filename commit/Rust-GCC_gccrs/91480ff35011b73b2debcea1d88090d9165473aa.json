{"sha": "91480ff35011b73b2debcea1d88090d9165473aa", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6OTE0ODBmZjM1MDExYjczYjJkZWJjZWExZDg4MDkwZDkxNjU0NzNhYQ==", "commit": {"author": {"name": "Mikael Morin", "email": "mikael@gcc.gnu.org", "date": "2015-02-08T14:18:16Z"}, "committer": {"name": "Mikael Morin", "email": "mikael@gcc.gnu.org", "date": "2015-02-08T14:18:16Z"}, "message": "Use the local name instead of the original name in the check for name conflicts...\n\n\nUse the local name instead of the original name in the check for name conflicts\nbetween a hosting program unit and use-associated symbols\nin that program unit.\n\nfortran/\n\tPR fortran/63744\n\t* module.c (check_for_ambiguous): Change argument type\n\tfrom gfc_symbol to gfc_symtree.  Check local (symtree) name\n\tinstead of original (symbol) name.\n\t(read_module): Update caller.\n\ntestsuite/\n\tPR fortran/63744\n\tgfortran.dg/use_rename_8.f90: New.\n\nFrom-SVN: r220515", "tree": {"sha": "f3bddb2a80d9a83b808717fa412d39ff35b939d5", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/f3bddb2a80d9a83b808717fa412d39ff35b939d5"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/91480ff35011b73b2debcea1d88090d9165473aa", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/91480ff35011b73b2debcea1d88090d9165473aa", "html_url": "https://github.com/Rust-GCC/gccrs/commit/91480ff35011b73b2debcea1d88090d9165473aa", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/91480ff35011b73b2debcea1d88090d9165473aa/comments", "author": null, "committer": null, "parents": [{"sha": "57f4f0d5f662eec0aa38ac0f554262ce072a8eeb", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/57f4f0d5f662eec0aa38ac0f554262ce072a8eeb", "html_url": "https://github.com/Rust-GCC/gccrs/commit/57f4f0d5f662eec0aa38ac0f554262ce072a8eeb"}], "stats": {"total": 73, "additions": 69, "deletions": 4}, "files": [{"sha": "a884220f21ff1f585bbd2cea48e15b27dca31b69", "filename": "gcc/fortran/ChangeLog", "status": "modified", "additions": 8, "deletions": 0, "changes": 8, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/91480ff35011b73b2debcea1d88090d9165473aa/gcc%2Ffortran%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/91480ff35011b73b2debcea1d88090d9165473aa/gcc%2Ffortran%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ffortran%2FChangeLog?ref=91480ff35011b73b2debcea1d88090d9165473aa", "patch": "@@ -1,3 +1,11 @@\n+2015-02-08  Mikael Morin  <mikael@gcc.gnu.org>\n+\n+\tPR fortran/63744\n+\t* module.c (check_for_ambiguous): Change argument type\n+\tfrom gfc_symbol to gfc_symtree.  Check local (symtree) name\n+\tinstead of original (symbol) name.\n+\t(read_module): Update caller.\n+\n 2015-02-06  Paul Thomas  <pault@gcc.gnu.org>\n \n \tPR fortran/63205"}, {"sha": "b12f8247a9179f8e61ab58698acf757640589528", "filename": "gcc/fortran/module.c", "status": "modified", "additions": 6, "deletions": 4, "changes": 10, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/91480ff35011b73b2debcea1d88090d9165473aa/gcc%2Ffortran%2Fmodule.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/91480ff35011b73b2debcea1d88090d9165473aa/gcc%2Ffortran%2Fmodule.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ffortran%2Fmodule.c?ref=91480ff35011b73b2debcea1d88090d9165473aa", "patch": "@@ -4795,19 +4795,21 @@ read_cleanup (pointer_info *p)\n /* It is not quite enough to check for ambiguity in the symbols by\n    the loaded symbol and the new symbol not being identical.  */\n static bool\n-check_for_ambiguous (gfc_symbol *st_sym, pointer_info *info)\n+check_for_ambiguous (gfc_symtree *st, pointer_info *info)\n {\n   gfc_symbol *rsym;\n   module_locus locus;\n   symbol_attribute attr;\n+  gfc_symbol *st_sym;\n \n-  if (gfc_current_ns->proc_name && st_sym->name == gfc_current_ns->proc_name->name)\n+  if (gfc_current_ns->proc_name && st->name == gfc_current_ns->proc_name->name)\n     {\n       gfc_error (\"%qs of module %qs, imported at %C, is also the name of the \"\n-\t\t \"current program unit\", st_sym->name, module_name);\n+\t\t \"current program unit\", st->name, module_name);\n       return true;\n     }\n \n+  st_sym = st->n.sym;\n   rsym = info->u.rsym.sym;\n   if (st_sym == rsym)\n     return false;\n@@ -5037,7 +5039,7 @@ read_module (void)\n \t  if (st != NULL)\n \t    {\n \t      /* Check for ambiguous symbols.  */\n-\t      if (check_for_ambiguous (st->n.sym, info))\n+\t      if (check_for_ambiguous (st, info))\n \t\tst->ambiguous = 1;\n \t      else\n \t\tinfo->u.rsym.symtree = st;"}, {"sha": "685715f824ed364ae82b024a33ef65191daf0bfa", "filename": "gcc/testsuite/ChangeLog", "status": "modified", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/91480ff35011b73b2debcea1d88090d9165473aa/gcc%2Ftestsuite%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/91480ff35011b73b2debcea1d88090d9165473aa/gcc%2Ftestsuite%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2FChangeLog?ref=91480ff35011b73b2debcea1d88090d9165473aa", "patch": "@@ -1,3 +1,8 @@\n+2015-02-08  Mikael Morin  <mikael@gcc.gnu.org>\n+\n+\tPR fortran/63744\n+\tgfortran.dg/use_rename_8.f90: New.\n+\n 2015-02-08  Eric Botcazou  <ebotcazou@adacore.com>\n \n \t* gnat.dg/addr7.ad[sb]: New test."}, {"sha": "ad3ab3977c5b796f78512b47d96d72510ae4d4b1", "filename": "gcc/testsuite/gfortran.dg/use_rename_8.f90", "status": "added", "additions": 50, "deletions": 0, "changes": 50, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/91480ff35011b73b2debcea1d88090d9165473aa/gcc%2Ftestsuite%2Fgfortran.dg%2Fuse_rename_8.f90", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/91480ff35011b73b2debcea1d88090d9165473aa/gcc%2Ftestsuite%2Fgfortran.dg%2Fuse_rename_8.f90", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgfortran.dg%2Fuse_rename_8.f90?ref=91480ff35011b73b2debcea1d88090d9165473aa", "patch": "@@ -0,0 +1,50 @@\n+! { dg-do compile }\n+!\n+! PR fortran/63744\n+! duplicate use rename used to be rejected when the target name\n+! was that of the current program unit \n+!\n+! Original testcase from Roger Ferrer Ibanez <roger.ferrer@bsc.es>\n+\n+MODULE MOO\n+    INTEGER :: A, B, C, D, E, F, G, H, I\n+END MODULE MOO\n+\n+SUBROUTINE S\n+    USE MOO, ONLY: X => A, X => A\n+END SUBROUTINE S\n+\n+SUBROUTINE T\n+    USE MOO, ONLY: X => B\n+    USE MOO, ONLY: X => B\n+END SUBROUTINE T\n+\n+SUBROUTINE C\n+    USE MOO, ONLY: C  ! { dg-error \"is also the name of the current program unit\" }\n+END SUBROUTINE C\n+\n+SUBROUTINE D\n+    USE MOO, ONLY: X => D\n+END SUBROUTINE D\n+\n+SUBROUTINE E\n+    USE MOO, ONLY: X => E, X => E\n+END SUBROUTINE E\n+\n+SUBROUTINE F\n+    USE MOO, ONLY: X => F\n+    USE MOO, ONLY: X => F\n+END SUBROUTINE F\n+\n+SUBROUTINE X\n+    USE MOO, ONLY: X => G ! { dg-error \"is also the name of the current program unit\" }\n+END SUBROUTINE X\n+\n+SUBROUTINE Y\n+    USE MOO, ONLY: Y => H ! { dg-error \"is also the name of the current program unit\" }\n+END SUBROUTINE Y\n+\n+SUBROUTINE Z\n+    USE MOO, ONLY: Z => I, Z => I ! { dg-error \"is also the name of the current program unit\" }\n+END SUBROUTINE Z\n+"}]}