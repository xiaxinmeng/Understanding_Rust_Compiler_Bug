{"sha": "89cd5050928afa2d2e9cf836ae39f6cb947f5602", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6ODljZDUwNTA5MjhhZmEyZDJlOWNmODM2YWUzOWY2Y2I5NDdmNTYwMg==", "commit": {"author": {"name": "Richard Henderson", "email": "richard.henderson@linaro.org", "date": "2019-11-14T13:45:01Z"}, "committer": {"name": "Richard Henderson", "email": "rth@gcc.gnu.org", "date": "2019-11-14T13:45:01Z"}, "message": "aarch64: Add testsuite checks for asm-flag\n\nInspired by the tests in gcc.target/i386.  Testing code generation,\ndiagnostics, and execution.\n\n\t* gcc.target/aarch64/asm-flag-1.c: New test.\n\t* gcc.target/aarch64/asm-flag-3.c: New test.\n\t* gcc.target/aarch64/asm-flag-5.c: New test.\n\t* gcc.target/aarch64/asm-flag-6.c: New test.\n\nFrom-SVN: r278228", "tree": {"sha": "c2f62f6b52f333fb2e9a7d27a6ea47ce0ce75a68", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/c2f62f6b52f333fb2e9a7d27a6ea47ce0ce75a68"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/89cd5050928afa2d2e9cf836ae39f6cb947f5602", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/89cd5050928afa2d2e9cf836ae39f6cb947f5602", "html_url": "https://github.com/Rust-GCC/gccrs/commit/89cd5050928afa2d2e9cf836ae39f6cb947f5602", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/89cd5050928afa2d2e9cf836ae39f6cb947f5602/comments", "author": {"login": "rth7680", "id": 2529319, "node_id": "MDQ6VXNlcjI1MjkzMTk=", "avatar_url": "https://avatars.githubusercontent.com/u/2529319?v=4", "gravatar_id": "", "url": "https://api.github.com/users/rth7680", "html_url": "https://github.com/rth7680", "followers_url": "https://api.github.com/users/rth7680/followers", "following_url": "https://api.github.com/users/rth7680/following{/other_user}", "gists_url": "https://api.github.com/users/rth7680/gists{/gist_id}", "starred_url": "https://api.github.com/users/rth7680/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/rth7680/subscriptions", "organizations_url": "https://api.github.com/users/rth7680/orgs", "repos_url": "https://api.github.com/users/rth7680/repos", "events_url": "https://api.github.com/users/rth7680/events{/privacy}", "received_events_url": "https://api.github.com/users/rth7680/received_events", "type": "User", "site_admin": false}, "committer": null, "parents": [{"sha": "bcdfe5c817eb427f8bdc901bebc15b55bc85e319", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/bcdfe5c817eb427f8bdc901bebc15b55bc85e319", "html_url": "https://github.com/Rust-GCC/gccrs/commit/bcdfe5c817eb427f8bdc901bebc15b55bc85e319"}], "stats": {"total": 170, "additions": 170, "deletions": 0}, "files": [{"sha": "1b937c89d573ca45d7e31c0af4efa15fee32743b", "filename": "gcc/testsuite/ChangeLog", "status": "modified", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/89cd5050928afa2d2e9cf836ae39f6cb947f5602/gcc%2Ftestsuite%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/89cd5050928afa2d2e9cf836ae39f6cb947f5602/gcc%2Ftestsuite%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2FChangeLog?ref=89cd5050928afa2d2e9cf836ae39f6cb947f5602", "patch": "@@ -1,5 +1,10 @@\n 2019-11-14  Richard Henderson  <richard.henderson@linaro.org>\n \n+\t* gcc.target/aarch64/asm-flag-1.c: New test.\n+\t* gcc.target/aarch64/asm-flag-3.c: New test.\n+\t* gcc.target/aarch64/asm-flag-5.c: New test.\n+\t* gcc.target/aarch64/asm-flag-6.c: New test.\n+\n \t* gcc.target/arm/asm-flag-1.c: New test.\n \t* gcc.target/arm/asm-flag-3.c: New test.\n \t* gcc.target/arm/asm-flag-5.c: New test."}, {"sha": "49901e59c38e7de186b614d36479790a7b9f89a9", "filename": "gcc/testsuite/gcc.target/aarch64/asm-flag-1.c", "status": "added", "additions": 35, "deletions": 0, "changes": 35, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/89cd5050928afa2d2e9cf836ae39f6cb947f5602/gcc%2Ftestsuite%2Fgcc.target%2Faarch64%2Fasm-flag-1.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/89cd5050928afa2d2e9cf836ae39f6cb947f5602/gcc%2Ftestsuite%2Fgcc.target%2Faarch64%2Fasm-flag-1.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgcc.target%2Faarch64%2Fasm-flag-1.c?ref=89cd5050928afa2d2e9cf836ae39f6cb947f5602", "patch": "@@ -0,0 +1,35 @@\n+/* Test the valid @cc<cc> asm flag outputs.  */\n+/* { dg-do compile } */\n+/* { dg-options \"-O\" } */\n+\n+#ifndef __GCC_ASM_FLAG_OUTPUTS__\n+#error \"missing preprocessor define\"\n+#endif\n+\n+void f(char *out)\n+{\n+  asm(\"\"\n+      : \"=@ccne\"(out[0]), \"=@cceq\"(out[1]),\n+\t\"=@cccs\"(out[2]), \"=@cccc\"(out[3]),\n+\t\"=@ccmi\"(out[4]), \"=@ccpl\"(out[5]),\n+\t\"=@ccvs\"(out[6]), \"=@ccvc\"(out[7]),\n+\t\"=@cchi\"(out[8]), \"=@ccls\"(out[9]),\n+\t\"=@ccge\"(out[10]), \"=@cclt\"(out[11]),\n+\t\"=@ccgt\"(out[12]), \"=@ccle\"(out[13]),\n+\t\"=@cchs\"(out[14]), \"=@cclo\"(out[15]));\n+}\n+\n+/* { dg-final { scan-assembler \"cset.*, ne\" } } */\n+/* { dg-final { scan-assembler \"cset.*, eq\" } } */\n+/* { dg-final { scan-assembler \"cset.*, cs\" } } */\n+/* { dg-final { scan-assembler \"cset.*, cc\" } } */\n+/* { dg-final { scan-assembler \"cset.*, mi\" } } */\n+/* { dg-final { scan-assembler \"cset.*, pl\" } } */\n+/* { dg-final { scan-assembler \"cset.*, vs\" } } */\n+/* { dg-final { scan-assembler \"cset.*, vc\" } } */\n+/* { dg-final { scan-assembler \"cset.*, hi\" } } */\n+/* { dg-final { scan-assembler \"cset.*, ls\" } } */\n+/* { dg-final { scan-assembler \"cset.*, ge\" } } */\n+/* { dg-final { scan-assembler \"cset.*, ls\" } } */\n+/* { dg-final { scan-assembler \"cset.*, gt\" } } */\n+/* { dg-final { scan-assembler \"cset.*, le\" } } */"}, {"sha": "e84e3431277d3d0f2ca22471dd3c58a7c12c601b", "filename": "gcc/testsuite/gcc.target/aarch64/asm-flag-3.c", "status": "added", "additions": 38, "deletions": 0, "changes": 38, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/89cd5050928afa2d2e9cf836ae39f6cb947f5602/gcc%2Ftestsuite%2Fgcc.target%2Faarch64%2Fasm-flag-3.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/89cd5050928afa2d2e9cf836ae39f6cb947f5602/gcc%2Ftestsuite%2Fgcc.target%2Faarch64%2Fasm-flag-3.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgcc.target%2Faarch64%2Fasm-flag-3.c?ref=89cd5050928afa2d2e9cf836ae39f6cb947f5602", "patch": "@@ -0,0 +1,38 @@\n+/* Test some of the valid @cc<cc> asm flag outputs.  */\n+/* { dg-do compile } */\n+/* { dg-options \"-O\" } */\n+\n+#define DO(C) \\\n+void f##C(void) { char x; asm(\"\" : \"=@cc\"#C(x)); if (!x) asm(\"\"); asm(\"\"); }\n+\n+DO(ne)\n+DO(eq)\n+DO(cs)\n+DO(cc)\n+DO(hs)\n+DO(lo)\n+DO(mi)\n+DO(pl)\n+DO(vs)\n+DO(vc)\n+DO(hi)\n+DO(ls)\n+DO(ge)\n+DO(lt)\n+DO(gt)\n+DO(le)\n+\n+/* { dg-final { scan-assembler \"bne\" } } */\n+/* { dg-final { scan-assembler \"beq\" } } */\n+/* { dg-final { scan-assembler \"bcs\" } } */\n+/* { dg-final { scan-assembler \"bcc\" } } */\n+/* { dg-final { scan-assembler \"bmi\" } } */\n+/* { dg-final { scan-assembler \"bpl\" } } */\n+/* { dg-final { scan-assembler \"bvs\" } } */\n+/* { dg-final { scan-assembler \"bvc\" } } */\n+/* { dg-final { scan-assembler \"bhi\" } } */\n+/* { dg-final { scan-assembler \"bls\" } } */\n+/* { dg-final { scan-assembler \"bge\" } } */\n+/* { dg-final { scan-assembler \"blt\" } } */\n+/* { dg-final { scan-assembler \"bgt\" } } */\n+/* { dg-final { scan-assembler \"ble\" } } */"}, {"sha": "4d4394e1478273c5af77283916f5367ea4134fe7", "filename": "gcc/testsuite/gcc.target/aarch64/asm-flag-5.c", "status": "added", "additions": 30, "deletions": 0, "changes": 30, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/89cd5050928afa2d2e9cf836ae39f6cb947f5602/gcc%2Ftestsuite%2Fgcc.target%2Faarch64%2Fasm-flag-5.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/89cd5050928afa2d2e9cf836ae39f6cb947f5602/gcc%2Ftestsuite%2Fgcc.target%2Faarch64%2Fasm-flag-5.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgcc.target%2Faarch64%2Fasm-flag-5.c?ref=89cd5050928afa2d2e9cf836ae39f6cb947f5602", "patch": "@@ -0,0 +1,30 @@\n+/* Test error conditions of asm flag outputs.  */\n+/* { dg-do compile } */\n+/* { dg-options \"\" } */\n+\n+void f_B(void) { _Bool x; asm(\"\" : \"=@cccc\"(x)); }\n+void f_c(void) { char x; asm(\"\" : \"=@cccc\"(x)); }\n+void f_s(void) { short x; asm(\"\" : \"=@cccc\"(x)); }\n+void f_i(void) { int x; asm(\"\" : \"=@cccc\"(x)); }\n+void f_l(void) { long x; asm(\"\" : \"=@cccc\"(x)); }\n+void f_ll(void) { long long x; asm(\"\" : \"=@cccc\"(x)); }\n+\n+void f_f(void)\n+{\n+  float x;\n+  asm(\"\" : \"=@cccc\"(x)); /* { dg-error invalid type } */\n+}\n+\n+void f_d(void)\n+{\n+  double x;\n+  asm(\"\" : \"=@cccc\"(x)); /* { dg-error invalid type } */\n+}\n+\n+struct S { int x[3]; };\n+\n+void f_S(void)\n+{\n+  struct S x;\n+  asm(\"\" : \"=@cccc\"(x)); /* { dg-error invalid type } */\n+}"}, {"sha": "963b5a48c70d50234c900f31615cf0f4bbeaa9d9", "filename": "gcc/testsuite/gcc.target/aarch64/asm-flag-6.c", "status": "added", "additions": 62, "deletions": 0, "changes": 62, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/89cd5050928afa2d2e9cf836ae39f6cb947f5602/gcc%2Ftestsuite%2Fgcc.target%2Faarch64%2Fasm-flag-6.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/89cd5050928afa2d2e9cf836ae39f6cb947f5602/gcc%2Ftestsuite%2Fgcc.target%2Faarch64%2Fasm-flag-6.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgcc.target%2Faarch64%2Fasm-flag-6.c?ref=89cd5050928afa2d2e9cf836ae39f6cb947f5602", "patch": "@@ -0,0 +1,62 @@\n+/* Executable testcase for 'output flags.'  */\n+/* { dg-do run } */\n+\n+int test_bits (long nzcv)\n+{\n+  long n, z, c, v;\n+\n+  __asm__ (\"msr nzcv, %[in]\"\n+\t   : \"=@ccmi\"(n), \"=@cceq\"(z), \"=@cccs\"(c), \"=@ccvs\"(v)\n+\t   : [in] \"r\"(nzcv << 28));\n+\n+  return n * 8 + z * 4 + c * 2 + v == nzcv;\n+}\n+\t\n+int test_cmps (long x, long y)\n+{\n+  long gt, lt, ge, le;\n+\n+  __asm__ (\"cmp %[x], %[y]\"\n+\t   : \"=@ccgt\"(gt), \"=@cclt\"(lt), \"=@ccge\"(ge), \"=@ccle\"(le)\n+\t   : [x] \"r\"(x), [y] \"r\"(y));\n+\n+  return (gt == (x > y)\n+\t  && lt == (x < y)\n+\t  && ge == (x >= y)\n+\t  && le == (x <= y));\n+}\n+\n+int test_cmpu (unsigned long x, unsigned long y)\n+{\n+  long gt, lt, ge, le;\n+\n+  __asm__ (\"cmp %[x], %[y]\"\n+\t   : \"=@cchi\"(gt), \"=@cclo\"(lt), \"=@cchs\"(ge), \"=@ccls\"(le)\n+\t   : [x] \"r\"(x), [y] \"r\"(y));\n+\n+  return (gt == (x > y)\n+\t  && lt == (x < y)\n+\t  && ge == (x >= y)\n+\t  && le == (x <= y));\n+}\n+\n+int main ()\n+{\n+  long i, j;\n+\n+  for (i = 0; i < 16; ++i)\n+    if (!test_bits (i))\n+      __builtin_abort ();\n+\n+  for (i = -1; i <= 1; ++i)\n+    for (j = -1; j <= 1; ++j)\n+      if (!test_cmps (i, j))\n+        __builtin_abort ();\n+\n+  for (i = 0; i <= 2; ++i)\n+    for (j = 0; j <= 2; ++j)\n+      if (!test_cmpu (i, j))\n+        __builtin_abort ();\n+\n+  return 0;\n+}"}]}