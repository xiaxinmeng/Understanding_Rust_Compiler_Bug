{"sha": "a76ff304f905db9fd9b049c2ca4ec84f0420da53", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6YTc2ZmYzMDRmOTA1ZGI5ZmQ5YjA0OWMyY2E0ZWM4NGYwNDIwZGE1Mw==", "commit": {"author": {"name": "Tobias Burnus", "email": "tobias@codesourcery.com", "date": "2020-03-27T09:56:25Z"}, "committer": {"name": "Tobias Burnus", "email": "tobias@codesourcery.com", "date": "2020-03-27T09:56:25Z"}, "message": "Fortran] Reject invalid association target (PR93363)\n\n\tPR fortran/93363\n\t* resolve.c (resolve_assoc_var): Reject association to DT and\n\tfunction name.\n\n\tPR fortran/93363\n\t* gfortran.dg/associate_51.f90: Fix test case.\n\t* gfortran.dg/associate_53.f90: New.", "tree": {"sha": "a7b6a275cb723dea9c325d1ce614cb69403966c1", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/a7b6a275cb723dea9c325d1ce614cb69403966c1"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/a76ff304f905db9fd9b049c2ca4ec84f0420da53", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/a76ff304f905db9fd9b049c2ca4ec84f0420da53", "html_url": "https://github.com/Rust-GCC/gccrs/commit/a76ff304f905db9fd9b049c2ca4ec84f0420da53", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/a76ff304f905db9fd9b049c2ca4ec84f0420da53/comments", "author": {"login": "tob2", "id": 264461, "node_id": "MDQ6VXNlcjI2NDQ2MQ==", "avatar_url": "https://avatars.githubusercontent.com/u/264461?v=4", "gravatar_id": "", "url": "https://api.github.com/users/tob2", "html_url": "https://github.com/tob2", "followers_url": "https://api.github.com/users/tob2/followers", "following_url": "https://api.github.com/users/tob2/following{/other_user}", "gists_url": "https://api.github.com/users/tob2/gists{/gist_id}", "starred_url": "https://api.github.com/users/tob2/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/tob2/subscriptions", "organizations_url": "https://api.github.com/users/tob2/orgs", "repos_url": "https://api.github.com/users/tob2/repos", "events_url": "https://api.github.com/users/tob2/events{/privacy}", "received_events_url": "https://api.github.com/users/tob2/received_events", "type": "User", "site_admin": false}, "committer": {"login": "tob2", "id": 264461, "node_id": "MDQ6VXNlcjI2NDQ2MQ==", "avatar_url": "https://avatars.githubusercontent.com/u/264461?v=4", "gravatar_id": "", "url": "https://api.github.com/users/tob2", "html_url": "https://github.com/tob2", "followers_url": "https://api.github.com/users/tob2/followers", "following_url": "https://api.github.com/users/tob2/following{/other_user}", "gists_url": "https://api.github.com/users/tob2/gists{/gist_id}", "starred_url": "https://api.github.com/users/tob2/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/tob2/subscriptions", "organizations_url": "https://api.github.com/users/tob2/orgs", "repos_url": "https://api.github.com/users/tob2/repos", "events_url": "https://api.github.com/users/tob2/events{/privacy}", "received_events_url": "https://api.github.com/users/tob2/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "2eea00c518d5a72d0bdbc810ae675e7ad5fee414", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/2eea00c518d5a72d0bdbc810ae675e7ad5fee414", "html_url": "https://github.com/Rust-GCC/gccrs/commit/2eea00c518d5a72d0bdbc810ae675e7ad5fee414"}], "stats": {"total": 117, "additions": 109, "deletions": 8}, "files": [{"sha": "39aa22df298d8f8bc71bf0bcc2f3f0f290b682bb", "filename": "gcc/fortran/ChangeLog", "status": "modified", "additions": 6, "deletions": 0, "changes": 6, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/a76ff304f905db9fd9b049c2ca4ec84f0420da53/gcc%2Ffortran%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/a76ff304f905db9fd9b049c2ca4ec84f0420da53/gcc%2Ffortran%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ffortran%2FChangeLog?ref=a76ff304f905db9fd9b049c2ca4ec84f0420da53", "patch": "@@ -1,3 +1,9 @@\n+2020-03-27  Tobias Burnus  <tobias@codesourcery.com>\n+\n+\tPR fortran/93363\n+\t* resolve.c (resolve_assoc_var): Reject association to DT and\n+\tfunction name.\n+\n 2020-03-25  Steven G. Kargl  <kargl@gcc.gnu.org>\n \n \tPR fortran/93484"}, {"sha": "b6277d236da7aef72dea98986065d2c00b99bd27", "filename": "gcc/fortran/resolve.c", "status": "modified", "additions": 25, "deletions": 7, "changes": 32, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/a76ff304f905db9fd9b049c2ca4ec84f0420da53/gcc%2Ffortran%2Fresolve.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/a76ff304f905db9fd9b049c2ca4ec84f0420da53/gcc%2Ffortran%2Fresolve.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ffortran%2Fresolve.c?ref=a76ff304f905db9fd9b049c2ca4ec84f0420da53", "patch": "@@ -8868,27 +8868,45 @@ resolve_assoc_var (gfc_symbol* sym, bool resolve_target)\n   /* For variable targets, we get some attributes from the target.  */\n   if (target->expr_type == EXPR_VARIABLE)\n     {\n-      gfc_symbol* tsym;\n+      gfc_symbol *tsym, *dsym;\n \n       gcc_assert (target->symtree);\n       tsym = target->symtree->n.sym;\n \n-      if (tsym->attr.subroutine\n-\t  || tsym->attr.external\n-\t  || (tsym->attr.function && tsym->result != tsym))\n+      if (gfc_expr_attr (target).proc_pointer)\n \t{\n-\t  gfc_error (\"Associating entity %qs at %L is a procedure name\",\n+\t  gfc_error (\"Associating entity %qs at %L is a procedure pointer\",\n \t\t     tsym->name, &target->where);\n \t  return;\n \t}\n \n-      if (gfc_expr_attr (target).proc_pointer)\n+      if (tsym->attr.flavor == FL_PROCEDURE && tsym->generic\n+\t  && (dsym = gfc_find_dt_in_generic (tsym)) != NULL\n+\t  && dsym->attr.flavor == FL_DERIVED)\n \t{\n-\t  gfc_error (\"Associating entity %qs at %L is a procedure pointer\",\n+\t  gfc_error (\"Derived type %qs cannot be used as a variable at %L\",\n \t\t     tsym->name, &target->where);\n \t  return;\n \t}\n \n+      if (tsym->attr.flavor == FL_PROCEDURE)\n+\t{\n+\t  bool is_error = true;\n+\t  if (tsym->attr.function && tsym->result == tsym)\n+\t    for (gfc_namespace *ns = sym->ns; ns; ns = ns->parent)\n+\t      if (tsym == ns->proc_name)\n+\t\t{\n+\t\t  is_error = false;\n+\t\t  break;\n+\t\t}\n+\t  if (is_error)\n+\t    {\n+\t      gfc_error (\"Associating entity %qs at %L is a procedure name\",\n+\t\t\t tsym->name, &target->where);\n+\t      return;\n+\t    }\n+\t}\n+\n       sym->attr.asynchronous = tsym->attr.asynchronous;\n       sym->attr.volatile_ = tsym->attr.volatile_;\n "}, {"sha": "8107f0089994a66a195e61a96c287c33d4499c32", "filename": "gcc/testsuite/ChangeLog", "status": "modified", "additions": 6, "deletions": 0, "changes": 6, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/a76ff304f905db9fd9b049c2ca4ec84f0420da53/gcc%2Ftestsuite%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/a76ff304f905db9fd9b049c2ca4ec84f0420da53/gcc%2Ftestsuite%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2FChangeLog?ref=a76ff304f905db9fd9b049c2ca4ec84f0420da53", "patch": "@@ -1,3 +1,9 @@\n+2020-03-27  Tobias Burnus  <tobias@codesourcery.com>\n+\n+\tPR fortran/93363\n+\t* gfortran.dg/associate_51.f90: Fix test case.\n+\t* gfortran.dg/associate_53.f90: New.\n+\n 2020-03-27  Jakub Jelinek  <jakub@redhat.com>\n \n \tPR c++/94326"}, {"sha": "e6f2e4fafa37c196e379bcbb7c72b32cd18ed704", "filename": "gcc/testsuite/gfortran.dg/associate_51.f90", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/a76ff304f905db9fd9b049c2ca4ec84f0420da53/gcc%2Ftestsuite%2Fgfortran.dg%2Fassociate_51.f90", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/a76ff304f905db9fd9b049c2ca4ec84f0420da53/gcc%2Ftestsuite%2Fgfortran.dg%2Fassociate_51.f90", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgfortran.dg%2Fassociate_51.f90?ref=a76ff304f905db9fd9b049c2ca4ec84f0420da53", "patch": "@@ -29,7 +29,7 @@ subroutine p2\n   type t\n   end type\n   type(t) :: z = t()\n-  associate (y => t)\n+  associate (y => t())\n   end associate\n end\n "}, {"sha": "5b56af38e47d5d84f4a6329fd3533c32faad6d57", "filename": "gcc/testsuite/gfortran.dg/associate_53.f90", "status": "added", "additions": 71, "deletions": 0, "changes": 71, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/a76ff304f905db9fd9b049c2ca4ec84f0420da53/gcc%2Ftestsuite%2Fgfortran.dg%2Fassociate_53.f90", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/a76ff304f905db9fd9b049c2ca4ec84f0420da53/gcc%2Ftestsuite%2Fgfortran.dg%2Fassociate_53.f90", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgfortran.dg%2Fassociate_53.f90?ref=a76ff304f905db9fd9b049c2ca4ec84f0420da53", "patch": "@@ -0,0 +1,71 @@\n+! { dg-do compile }\n+!\n+! PR fortran/93363\n+!\n+! Contributed by G. Steinmetz\n+\n+program p\n+   type t\n+      integer :: a\n+   end type\n+   type(t) :: z\n+   z = t(1)\n+   associate (var1 => t)  ! { dg-error \"Derived type 't' cannot be used as a variable\" }\n+   end associate\n+end\n+\n+subroutine sub\n+   if (f() /= 1) stop\n+   associate (var2 => f)  ! { dg-error \"Associating entity 'f' at .1. is a procedure name\" }\n+   end associate\n+   block\n+      block\n+        associate (var2a => f)  ! { dg-error \"Associating entity 'f' at .1. is a procedure name\" }\n+        end associate\n+      end block\n+    end block\n+contains\n+   integer function f()\n+      f = 1\n+      associate (var3 => f)\n+      end associate\n+      block\n+        block\n+          associate (var4 => f)\n+          end associate\n+        end block\n+      end block\n+   end\n+   integer recursive function f2() result(res)\n+      res = 1\n+      associate (var5 => f2)  ! { dg-error \"Associating entity 'f2' at .1. is a procedure name\" }\n+      end associate\n+      block\n+        block\n+          associate (var6 => f2)  ! { dg-error \"Associating entity 'f2' at .1. is a procedure name\" }\n+          end associate\n+        end block\n+      end block\n+   end\n+   subroutine subsub\n+      associate (var7 => f)  ! { dg-error \"Associating entity 'f' at .1. is a procedure name\" }\n+      end associate\n+      block\n+        block\n+          associate (var8 => f)  ! { dg-error \"Associating entity 'f' at .1. is a procedure name\" }\n+          end associate\n+        end block\n+      end block\n+   end\n+end\n+\n+subroutine sub2\n+   interface g\n+      procedure s\n+   end interface\n+   associate (var9 => g)  ! { dg-error \"Associating entity 'g' at .1. is a procedure name\" }\n+   end associate\n+contains\n+   subroutine s\n+   end\n+end"}]}