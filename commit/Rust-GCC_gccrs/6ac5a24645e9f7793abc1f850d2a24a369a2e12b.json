{"sha": "6ac5a24645e9f7793abc1f850d2a24a369a2e12b", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6NmFjNWEyNDY0NWU5Zjc3OTNhYmMxZjg1MGQyYTI0YTM2OWEyZTEyYg==", "commit": {"author": {"name": "Jan Hubicka", "email": "jh@suse.cz", "date": "2006-12-23T00:27:44Z"}, "committer": {"name": "Jan Hubicka", "email": "hubicka@gcc.gnu.org", "date": "2006-12-23T00:27:44Z"}, "message": "tree-flow-inline.h (var_ann): External variable annotations are unshared too.\n\n\t* tree-flow-inline.h (var_ann): External variable annotations are\n\tunshared too.\n\t(tree_common_ann): Handle correctly unshared variables annotations.\n\t* tree-dfa.c (create_var_ann): External variable annotations are\n\tunshared too.\n\nFrom-SVN: r120164", "tree": {"sha": "6a329a1462ce5410f79cc96e19ef32901b223c94", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/6a329a1462ce5410f79cc96e19ef32901b223c94"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/6ac5a24645e9f7793abc1f850d2a24a369a2e12b", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/6ac5a24645e9f7793abc1f850d2a24a369a2e12b", "html_url": "https://github.com/Rust-GCC/gccrs/commit/6ac5a24645e9f7793abc1f850d2a24a369a2e12b", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/6ac5a24645e9f7793abc1f850d2a24a369a2e12b/comments", "author": null, "committer": null, "parents": [{"sha": "007948dfcfa6b47b1c0e507d6050f0e386a97839", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/007948dfcfa6b47b1c0e507d6050f0e386a97839", "html_url": "https://github.com/Rust-GCC/gccrs/commit/007948dfcfa6b47b1c0e507d6050f0e386a97839"}], "stats": {"total": 19, "additions": 15, "deletions": 4}, "files": [{"sha": "be8a3f568be78b446d17bfc1b4068399eb4fefd0", "filename": "gcc/ChangeLog", "status": "modified", "additions": 8, "deletions": 0, "changes": 8, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/6ac5a24645e9f7793abc1f850d2a24a369a2e12b/gcc%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/6ac5a24645e9f7793abc1f850d2a24a369a2e12b/gcc%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2FChangeLog?ref=6ac5a24645e9f7793abc1f850d2a24a369a2e12b", "patch": "@@ -1,3 +1,11 @@\n+2006-12-23  Jan Hubicka  <jh@suse.cz>\n+\n+\t* tree-flow-inline.h (var_ann): External variable annotations are\n+\tunshared too.\n+\t(tree_common_ann): Handle correctly unshared variables annotations.\n+\t* tree-dfa.c (create_var_ann): External variable annotations are\n+\tunshared too.\n+\n 2006-12-22  Kazu Hirata  <kazu@codesourcery.com>\n \n \t* basic-block.h: Remove the prototype for"}, {"sha": "59899f17f77aaccf2ae8abddd518de66d9c4687f", "filename": "gcc/tree-dfa.c", "status": "modified", "additions": 3, "deletions": 3, "changes": 6, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/6ac5a24645e9f7793abc1f850d2a24a369a2e12b/gcc%2Ftree-dfa.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/6ac5a24645e9f7793abc1f850d2a24a369a2e12b/gcc%2Ftree-dfa.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftree-dfa.c?ref=6ac5a24645e9f7793abc1f850d2a24a369a2e12b", "patch": "@@ -130,7 +130,7 @@ create_var_ann (tree t)\n   gcc_assert (DECL_P (t));\n   gcc_assert (!t->base.ann || t->base.ann->common.type == VAR_ANN);\n \n-  if (TREE_STATIC (t))\n+  if (!MTAG_P (t) && (TREE_STATIC (t) || DECL_EXTERNAL (t)))\n     {\n       sann = GGC_CNEW (struct static_var_ann_d);\n       ann = &sann->ann;\n@@ -140,7 +140,7 @@ create_var_ann (tree t)\n \n   ann->common.type = VAR_ANN;\n \n-  if (TREE_STATIC (t))\n+  if (!MTAG_P (t) && (TREE_STATIC (t) || DECL_EXTERNAL (t)))\n     {\n        void **slot;\n        sann->uid = DECL_UID (t);\n@@ -696,7 +696,7 @@ set_default_def (tree var, tree def)\n       htab_remove_elt (DEFAULT_DEFS (cfun), *loc);\n       return;\n     }\n-  gcc_assert (TREE_CODE (def) == SSA_NAME);\n+  gcc_assert (!def || TREE_CODE (def) == SSA_NAME);\n   loc = htab_find_slot_with_hash (DEFAULT_DEFS (cfun), &in,\n                                   DECL_UID (var), INSERT);\n "}, {"sha": "0695c6562939b991135a5bb3106f02bdd5427be7", "filename": "gcc/tree-flow-inline.h", "status": "modified", "additions": 4, "deletions": 1, "changes": 5, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/6ac5a24645e9f7793abc1f850d2a24a369a2e12b/gcc%2Ftree-flow-inline.h", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/6ac5a24645e9f7793abc1f850d2a24a369a2e12b/gcc%2Ftree-flow-inline.h", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftree-flow-inline.h?ref=6ac5a24645e9f7793abc1f850d2a24a369a2e12b", "patch": "@@ -203,7 +203,7 @@ var_ann (tree t)\n   gcc_assert (t);\n   gcc_assert (DECL_P (t));\n   gcc_assert (TREE_CODE (t) != FUNCTION_DECL);\n-  if (TREE_STATIC (t))\n+  if (!MTAG_P (t) && (TREE_STATIC (t) || DECL_EXTERNAL (t)))\n     {\n       struct static_var_ann_d *sann\n         = ((struct static_var_ann_d *)\n@@ -952,6 +952,9 @@ clear_call_clobbered (tree var)\n static inline tree_ann_common_t\n tree_common_ann (tree t)\n {\n+  /* Watch out static variables with unshared annotations.  */\n+  if (DECL_P (t) && TREE_CODE (t) == VAR_DECL)\n+    return &var_ann (t)->common;\n   return &t->base.ann->common;\n }\n "}]}