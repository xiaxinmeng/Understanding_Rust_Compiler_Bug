{"sha": "8a6a62614a8ae4544770420416d1632d6c3d3f6e", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6OGE2YTYyNjE0YThhZTQ1NDQ3NzA0MjA0MTZkMTYzMmQ2YzNkM2Y2ZQ==", "commit": {"author": {"name": "Tobias Burnus", "email": "tobias@codesourcery.com", "date": "2021-03-08T12:05:48Z"}, "committer": {"name": "Tobias Burnus", "email": "tobias@codesourcery.com", "date": "2021-03-08T12:05:48Z"}, "message": "tree-nested: Update assert for Fortran module vars [PR97927]\n\ngcc/ChangeLog:\n\n\tPR fortran/97927\n\t* tree-nested.c (convert_local_reference_stmt): Avoid calling\n\tlookup_field_for_decl for Fortran module (= namespace context).\n\ngcc/testsuite/ChangeLog:\n\n\tPR fortran/97927\n\t* gfortran.dg/module_variable_3.f90: New test.", "tree": {"sha": "89857a0aa12104ba1977c92c1993b2c8cda23ef5", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/89857a0aa12104ba1977c92c1993b2c8cda23ef5"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/8a6a62614a8ae4544770420416d1632d6c3d3f6e", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/8a6a62614a8ae4544770420416d1632d6c3d3f6e", "html_url": "https://github.com/Rust-GCC/gccrs/commit/8a6a62614a8ae4544770420416d1632d6c3d3f6e", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/8a6a62614a8ae4544770420416d1632d6c3d3f6e/comments", "author": {"login": "tob2", "id": 264461, "node_id": "MDQ6VXNlcjI2NDQ2MQ==", "avatar_url": "https://avatars.githubusercontent.com/u/264461?v=4", "gravatar_id": "", "url": "https://api.github.com/users/tob2", "html_url": "https://github.com/tob2", "followers_url": "https://api.github.com/users/tob2/followers", "following_url": "https://api.github.com/users/tob2/following{/other_user}", "gists_url": "https://api.github.com/users/tob2/gists{/gist_id}", "starred_url": "https://api.github.com/users/tob2/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/tob2/subscriptions", "organizations_url": "https://api.github.com/users/tob2/orgs", "repos_url": "https://api.github.com/users/tob2/repos", "events_url": "https://api.github.com/users/tob2/events{/privacy}", "received_events_url": "https://api.github.com/users/tob2/received_events", "type": "User", "site_admin": false}, "committer": {"login": "tob2", "id": 264461, "node_id": "MDQ6VXNlcjI2NDQ2MQ==", "avatar_url": "https://avatars.githubusercontent.com/u/264461?v=4", "gravatar_id": "", "url": "https://api.github.com/users/tob2", "html_url": "https://github.com/tob2", "followers_url": "https://api.github.com/users/tob2/followers", "following_url": "https://api.github.com/users/tob2/following{/other_user}", "gists_url": "https://api.github.com/users/tob2/gists{/gist_id}", "starred_url": "https://api.github.com/users/tob2/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/tob2/subscriptions", "organizations_url": "https://api.github.com/users/tob2/orgs", "repos_url": "https://api.github.com/users/tob2/repos", "events_url": "https://api.github.com/users/tob2/events{/privacy}", "received_events_url": "https://api.github.com/users/tob2/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "e99b25df68d4528141f6079e1e3af8ef20bbcb00", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/e99b25df68d4528141f6079e1e3af8ef20bbcb00", "html_url": "https://github.com/Rust-GCC/gccrs/commit/e99b25df68d4528141f6079e1e3af8ef20bbcb00"}], "stats": {"total": 38, "additions": 38, "deletions": 0}, "files": [{"sha": "0dae6d5bdd5c3cab2d0cd2f7cff11432f76f795c", "filename": "gcc/testsuite/gfortran.dg/module_variable_3.f90", "status": "added", "additions": 37, "deletions": 0, "changes": 37, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/8a6a62614a8ae4544770420416d1632d6c3d3f6e/gcc%2Ftestsuite%2Fgfortran.dg%2Fmodule_variable_3.f90", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/8a6a62614a8ae4544770420416d1632d6c3d3f6e/gcc%2Ftestsuite%2Fgfortran.dg%2Fmodule_variable_3.f90", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgfortran.dg%2Fmodule_variable_3.f90?ref=8a6a62614a8ae4544770420416d1632d6c3d3f6e", "patch": "@@ -0,0 +1,37 @@\n+! { dg-do compile }\n+! { dg-additional-options \"-fdump-tree-original\" }\n+!\n+! PR fortran/97927\n+!\n+! Did ICE due to the in tree-nested.c due to {clobber}\n+!\n+\n+module mpi2\n+ interface\n+   subroutine MPI_Allreduce(i)\n+     implicit none\n+     INTEGER, OPTIONAL, INTENT(OUT) :: i\n+   end subroutine MPI_Allreduce\n+ end interface\n+end module\n+\n+module modmpi\n+  implicit none\n+  integer ierror  ! module variable = context NAMESPACE_DECL\n+end module\n+\n+subroutine exxengy\n+  use modmpi\n+  use mpi2, only: mpi_allreduce\n+  implicit none\n+\n+  ! intent(out) implies: ierror = {clobber}\n+  call mpi_allreduce(ierror)\n+\n+contains\n+  subroutine zrho2\n+    return\n+  end subroutine\n+end subroutine\n+\n+! { dg-final { scan-tree-dump \"ierror = {CLOBBER};\" \"original\" } }"}, {"sha": "cea917a4d58a57e56f1335361574362aee416b77", "filename": "gcc/tree-nested.c", "status": "modified", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/8a6a62614a8ae4544770420416d1632d6c3d3f6e/gcc%2Ftree-nested.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/8a6a62614a8ae4544770420416d1632d6c3d3f6e/gcc%2Ftree-nested.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftree-nested.c?ref=8a6a62614a8ae4544770420416d1632d6c3d3f6e", "patch": "@@ -2526,6 +2526,7 @@ convert_local_reference_stmt (gimple_stmt_iterator *gsi, bool *handled_ops_p,\n \t{\n \t  tree lhs = gimple_assign_lhs (stmt);\n \t  if (DECL_P (lhs)\n+\t      && decl_function_context (lhs) == info->context\n \t      && !use_pointer_in_frame (lhs)\n \t      && lookup_field_for_decl (info, lhs, NO_INSERT))\n \t    {"}]}