{"sha": "e669bd2b69b82732454e51c8b9c2cad26ea8bbd7", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6ZTY2OWJkMmI2OWI4MjczMjQ1NGU1MWM4YjljMmNhZDI2ZWE4YmJkNw==", "commit": {"author": {"name": "Jakub Jelinek", "email": "jakub@redhat.com", "date": "2005-11-28T19:51:02Z"}, "committer": {"name": "Jakub Jelinek", "email": "jakub@gcc.gnu.org", "date": "2005-11-28T19:51:02Z"}, "message": "acinclude.m4 (LIBGFOR_CHECK_PRAGMA_WEAK): Rename to...\n\n\tlibfortran/24991\n\t* acinclude.m4 (LIBGFOR_CHECK_PRAGMA_WEAK): Rename to...\n\t(LIBGFOR_GTHREAD_WEAK): ... this.  Define SUPPORTS_WEAK rather\n\tthan HAVE_PRAGMA_WEAK.  Define GTHREAD_USE_WEAK to 0 on hosts\n\tthat shouldn't use weak in gthr.h.\n\t* configure.ac: Use LIBGFOR_GTHREAD_WEAK instead of\n\tLIBGFOR_CHECK_PRAGMA_WEAK.\n\t* config.h.in: Regenerated.\n\t* configure: Regenerated.\n\t* io/io.h (SUPPORTS_WEAK): Don't define here.\n\nFrom-SVN: r107616", "tree": {"sha": "e17bf7f18101609827ebfd58ef895adaef0032b4", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/e17bf7f18101609827ebfd58ef895adaef0032b4"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/e669bd2b69b82732454e51c8b9c2cad26ea8bbd7", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/e669bd2b69b82732454e51c8b9c2cad26ea8bbd7", "html_url": "https://github.com/Rust-GCC/gccrs/commit/e669bd2b69b82732454e51c8b9c2cad26ea8bbd7", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/e669bd2b69b82732454e51c8b9c2cad26ea8bbd7/comments", "author": {"login": "jakubjelinek", "id": 9370665, "node_id": "MDQ6VXNlcjkzNzA2NjU=", "avatar_url": "https://avatars.githubusercontent.com/u/9370665?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jakubjelinek", "html_url": "https://github.com/jakubjelinek", "followers_url": "https://api.github.com/users/jakubjelinek/followers", "following_url": "https://api.github.com/users/jakubjelinek/following{/other_user}", "gists_url": "https://api.github.com/users/jakubjelinek/gists{/gist_id}", "starred_url": "https://api.github.com/users/jakubjelinek/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jakubjelinek/subscriptions", "organizations_url": "https://api.github.com/users/jakubjelinek/orgs", "repos_url": "https://api.github.com/users/jakubjelinek/repos", "events_url": "https://api.github.com/users/jakubjelinek/events{/privacy}", "received_events_url": "https://api.github.com/users/jakubjelinek/received_events", "type": "User", "site_admin": false}, "committer": null, "parents": [{"sha": "c869fb40acef59be23a152a3589b8f8eb51527bd", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/c869fb40acef59be23a152a3589b8f8eb51527bd", "html_url": "https://github.com/Rust-GCC/gccrs/commit/c869fb40acef59be23a152a3589b8f8eb51527bd"}], "stats": {"total": 49, "additions": 37, "deletions": 12}, "files": [{"sha": "e7e8065118b65e651ff001ded763ff23670e6fc2", "filename": "libgfortran/ChangeLog", "status": "modified", "additions": 11, "deletions": 0, "changes": 11, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/e669bd2b69b82732454e51c8b9c2cad26ea8bbd7/libgfortran%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/e669bd2b69b82732454e51c8b9c2cad26ea8bbd7/libgfortran%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libgfortran%2FChangeLog?ref=e669bd2b69b82732454e51c8b9c2cad26ea8bbd7", "patch": "@@ -1,5 +1,16 @@\n 2005-11-28  Jakub Jelinek  <jakub@redhat.com>\n \n+\tlibfortran/24991\n+\t* acinclude.m4 (LIBGFOR_CHECK_PRAGMA_WEAK): Rename to...\n+\t(LIBGFOR_GTHREAD_WEAK): ... this.  Define SUPPORTS_WEAK rather\n+\tthan HAVE_PRAGMA_WEAK.  Define GTHREAD_USE_WEAK to 0 on hosts\n+\tthat shouldn't use weak in gthr.h.\n+\t* configure.ac: Use LIBGFOR_GTHREAD_WEAK instead of\n+\tLIBGFOR_CHECK_PRAGMA_WEAK.\n+\t* config.h.in: Regenerated.\n+\t* configure: Regenerated.\n+\t* io/io.h (SUPPORTS_WEAK): Don't define here.\n+\n \t* intrinsics/ftell.c (ftell, FTELL_SUB): Add unlock_unit call.\n \t* intrinsics/fget.c (fgetc, fputs): Likewise.\n \t* intrinsics/tty.c (ttynam): Likewise."}, {"sha": "3af0c0ea476c9a81631a1ecbbfeaa2aed6dc5929", "filename": "libgfortran/acinclude.m4", "status": "modified", "additions": 9, "deletions": 3, "changes": 12, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/e669bd2b69b82732454e51c8b9c2cad26ea8bbd7/libgfortran%2Facinclude.m4", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/e669bd2b69b82732454e51c8b9c2cad26ea8bbd7/libgfortran%2Facinclude.m4", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libgfortran%2Facinclude.m4?ref=e669bd2b69b82732454e51c8b9c2cad26ea8bbd7", "patch": "@@ -174,7 +174,7 @@ target_thread_file=`$CC -v 2>&1 | sed -n 's/^Thread model: //p'`])\n   fi])\n \n dnl Check for pragma weak.\n-AC_DEFUN([LIBGFOR_CHECK_PRAGMA_WEAK], [\n+AC_DEFUN([LIBGFOR_GTHREAD_WEAK], [\n   AC_CACHE_CHECK([whether pragma weak works],\n \t\t have_pragma_weak, [\n   gfor_save_CFLAGS=\"$CFLAGS\"\n@@ -183,9 +183,15 @@ AC_DEFUN([LIBGFOR_CHECK_PRAGMA_WEAK], [\n #pragma weak foo], [if (foo) foo ();],\n \t\t have_pragma_weak=yes, have_pragma_weak=no)])\n   if test $have_pragma_weak = yes; then\n-    AC_DEFINE(HAVE_PRAGMA_WEAK, 1,\n+    AC_DEFINE(SUPPORTS_WEAK, 1,\n \t      [Define to 1 if the target supports #pragma weak])\n-  fi])\n+  fi\n+  case \"$host\" in\n+    *-*-darwin* | *-*-hpux* | *-*-cygwin*)\n+      AC_DEFINE(GTHREAD_USE_WEAK, 0,\n+\t\t[Define to 0 if the target shouldn't use #pragma weak])\n+      ;;\n+  esac])\n \n dnl Check whether target can unlink a file still open.\n AC_DEFUN([LIBGFOR_CHECK_UNLINK_OPEN_FILE], ["}, {"sha": "92f088672d75a89e4eec6905687477e346480b08", "filename": "libgfortran/config.h.in", "status": "modified", "additions": 6, "deletions": 3, "changes": 9, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/e669bd2b69b82732454e51c8b9c2cad26ea8bbd7/libgfortran%2Fconfig.h.in", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/e669bd2b69b82732454e51c8b9c2cad26ea8bbd7/libgfortran%2Fconfig.h.in", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libgfortran%2Fconfig.h.in?ref=e669bd2b69b82732454e51c8b9c2cad26ea8bbd7", "patch": "@@ -3,6 +3,9 @@\n /* Does gettimeofday take a single argument */\n #undef GETTIMEOFDAY_ONE_ARGUMENT\n \n+/* Define to 0 if the target shouldn't use #pragma weak */\n+#undef GTHREAD_USE_WEAK\n+\n /* libm includes acos */\n #undef HAVE_ACOS\n \n@@ -465,9 +468,6 @@\n /* libm includes powl */\n #undef HAVE_POWL\n \n-/* Define to 1 if the target supports #pragma weak */\n-#undef HAVE_PRAGMA_WEAK\n-\n /* libm includes round */\n #undef HAVE_ROUND\n \n@@ -684,6 +684,9 @@\n /* Define to 1 if you have the ANSI C header files. */\n #undef STDC_HEADERS\n \n+/* Define to 1 if the target supports #pragma weak */\n+#undef SUPPORTS_WEAK\n+\n /* Define to 1 if the target is ILP32. */\n #undef TARGET_ILP32\n "}, {"sha": "6651af413beb552ebcfac08883c10c3c718c4e66", "filename": "libgfortran/configure", "status": "modified", "additions": 10, "deletions": 1, "changes": 11, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/e669bd2b69b82732454e51c8b9c2cad26ea8bbd7/libgfortran%2Fconfigure", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/e669bd2b69b82732454e51c8b9c2cad26ea8bbd7/libgfortran%2Fconfigure", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libgfortran%2Fconfigure?ref=e669bd2b69b82732454e51c8b9c2cad26ea8bbd7", "patch": "@@ -20854,10 +20854,19 @@ echo \"${ECHO_T}$have_pragma_weak\" >&6\n   if test $have_pragma_weak = yes; then\n \n cat >>confdefs.h <<\\_ACEOF\n-#define HAVE_PRAGMA_WEAK 1\n+#define SUPPORTS_WEAK 1\n _ACEOF\n \n   fi\n+  case \"$host\" in\n+    *-*-darwin* | *-*-hpux* | *-*-cygwin*)\n+\n+cat >>confdefs.h <<\\_ACEOF\n+#define GTHREAD_USE_WEAK 0\n+_ACEOF\n+\n+      ;;\n+  esac\n \n # Various other checks on target\n "}, {"sha": "cba9918ecbc945cdb027022240d7e11a3904eb34", "filename": "libgfortran/configure.ac", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/e669bd2b69b82732454e51c8b9c2cad26ea8bbd7/libgfortran%2Fconfigure.ac", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/e669bd2b69b82732454e51c8b9c2cad26ea8bbd7/libgfortran%2Fconfigure.ac", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libgfortran%2Fconfigure.ac?ref=e669bd2b69b82732454e51c8b9c2cad26ea8bbd7", "patch": "@@ -381,7 +381,7 @@ LIBGFOR_CHECK_SYNC_FETCH_AND_ADD\n LIBGFOR_CHECK_GTHR_DEFAULT\n \n # Check out #pragma weak.\n-LIBGFOR_CHECK_PRAGMA_WEAK\n+LIBGFOR_GTHREAD_WEAK\n \n # Various other checks on target\n LIBGFOR_CHECK_UNLINK_OPEN_FILE"}, {"sha": "9caf59fbd3e6344a67bdf0d523facadeaf2ca426", "filename": "libgfortran/io/io.h", "status": "modified", "additions": 0, "deletions": 4, "changes": 4, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/e669bd2b69b82732454e51c8b9c2cad26ea8bbd7/libgfortran%2Fio%2Fio.h", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/e669bd2b69b82732454e51c8b9c2cad26ea8bbd7/libgfortran%2Fio%2Fio.h", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libgfortran%2Fio%2Fio.h?ref=e669bd2b69b82732454e51c8b9c2cad26ea8bbd7", "patch": "@@ -32,10 +32,6 @@ Boston, MA 02110-1301, USA.  */\n \n #include <setjmp.h>\n #include \"libgfortran.h\"\n-#ifdef HAVE_PRAGMA_WEAK\n-/* Used by gthr.h.  */\n-#define SUPPORTS_WEAK 1\n-#endif\n \n #include <gthr.h>\n "}]}