{"sha": "c3879be19f1277f6641b6224b968b3d1d6453313", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6YzM4NzliZTE5ZjEyNzdmNjY0MWI2MjI0Yjk2OGIzZDFkNjQ1MzMxMw==", "commit": {"author": {"name": "Paul Thomas", "email": "pault@gcc.gnu.org", "date": "2016-12-10T18:35:47Z"}, "committer": {"name": "Paul Thomas", "email": "pault@gcc.gnu.org", "date": "2016-12-10T18:35:47Z"}, "message": "re PR fortran/78350 (ICE in gfc_code2string(): Bad code, at fortran/misc.c:193)\n\n2016-12-10 Paul Thomas  <pault@gcc.gnu.org>\n\n\tPR fortran/78350\n\t* resolve.c (resolve_structure_cons): Remove the block that\n\ttried to remove a charlen and rely on namespace cleanup.\n\nFrom-SVN: r243517", "tree": {"sha": "10004e588a1942421170bde3fb035b34ef37cd0e", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/10004e588a1942421170bde3fb035b34ef37cd0e"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/c3879be19f1277f6641b6224b968b3d1d6453313", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/c3879be19f1277f6641b6224b968b3d1d6453313", "html_url": "https://github.com/Rust-GCC/gccrs/commit/c3879be19f1277f6641b6224b968b3d1d6453313", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/c3879be19f1277f6641b6224b968b3d1d6453313/comments", "author": null, "committer": null, "parents": [{"sha": "c0140e3c5d3f3b8090e8c21ad530a8986525eb76", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/c0140e3c5d3f3b8090e8c21ad530a8986525eb76", "html_url": "https://github.com/Rust-GCC/gccrs/commit/c0140e3c5d3f3b8090e8c21ad530a8986525eb76"}], "stats": {"total": 33, "additions": 10, "deletions": 23}, "files": [{"sha": "42e0d61682af77c7cae5926b347a78c86c95e0db", "filename": "gcc/fortran/ChangeLog", "status": "modified", "additions": 6, "deletions": 0, "changes": 6, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/c3879be19f1277f6641b6224b968b3d1d6453313/gcc%2Ffortran%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/c3879be19f1277f6641b6224b968b3d1d6453313/gcc%2Ffortran%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ffortran%2FChangeLog?ref=c3879be19f1277f6641b6224b968b3d1d6453313", "patch": "@@ -1,3 +1,9 @@\n+2016-12-10 Paul Thomas  <pault@gcc.gnu.org>\n+\n+\tPR fortran/78350\n+\t* resolve.c (resolve_structure_cons): Remove the block that\n+\ttried to remove a charlen and rely on namespace cleanup.\n+\n 2016-12-09  Paul Thomas  <pault@gcc.gnu.org>\n \n \tPR fortran/77903"}, {"sha": "c7d872cb5b3391d07c3b3fdffc1d7fd79bd55709", "filename": "gcc/fortran/resolve.c", "status": "modified", "additions": 4, "deletions": 23, "changes": 27, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/c3879be19f1277f6641b6224b968b3d1d6453313/gcc%2Ffortran%2Fresolve.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/c3879be19f1277f6641b6224b968b3d1d6453313/gcc%2Ffortran%2Fresolve.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ffortran%2Fresolve.c?ref=c3879be19f1277f6641b6224b968b3d1d6453313", "patch": "@@ -1257,31 +1257,12 @@ resolve_structure_cons (gfc_expr *expr, int init)\n \t      gfc_constructor_append_expr (&cons->expr->value.constructor,\n \t\t\t\t\t   para, &cons->expr->where);\n \t    }\n+\n \t  if (cons->expr->expr_type == EXPR_ARRAY)\n \t    {\n-\t      gfc_constructor *p;\n-\t      p = gfc_constructor_first (cons->expr->value.constructor);\n-\t      if (cons->expr->ts.u.cl != p->expr->ts.u.cl)\n-\t\t{\n-\t\t  gfc_charlen *cl, *cl2;\n-\n-\t\t  cl2 = NULL;\n-\t\t  for (cl = gfc_current_ns->cl_list; cl; cl = cl->next)\n-\t\t    {\n-\t\t      if (cl == cons->expr->ts.u.cl)\n-\t\t\tbreak;\n-\t\t      cl2 = cl;\n-\t\t    }\n-\n-\t\t  gcc_assert (cl);\n-\n-\t\t  if (cl2)\n-\t\t    cl2->next = cl->next;\n-\n-\t\t  gfc_free_expr (cl->length);\n-\t\t  free (cl);\n-\t\t}\n-\n+\t      /* Rely on the cleanup of the namespace to deal correctly with\n+\t\t the old charlen.  (There was a block here that attempted to\n+\t\t remove the charlen but broke the chain in so doing.)  */\n \t      cons->expr->ts.u.cl = gfc_new_charlen (gfc_current_ns, NULL);\n \t      cons->expr->ts.u.cl->length_from_typespec = true;\n \t      cons->expr->ts.u.cl->length = gfc_copy_expr (comp->ts.u.cl->length);"}]}