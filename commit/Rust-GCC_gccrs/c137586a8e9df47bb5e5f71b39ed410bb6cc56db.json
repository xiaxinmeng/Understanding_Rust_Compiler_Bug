{"sha": "c137586a8e9df47bb5e5f71b39ed410bb6cc56db", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6YzEzNzU4NmE4ZTlkZjQ3YmI1ZTVmNzFiMzllZDQxMGJiNmNjNTZkYg==", "commit": {"author": {"name": "Momchil Velikov", "email": "velco@fadata.bg", "date": "2004-11-01T22:47:33Z"}, "committer": {"name": "Benjamin Kosnik", "email": "bkoz@gcc.gnu.org", "date": "2004-11-01T22:47:33Z"}, "message": "re PR libstdc++/18185 ([3.4 only] Unhandled exceptions leak)\n\n\n2004-11-01  Momchil Velikov  <velco@fadata.bg>\n\n\tPR libstdc++/18185\n\t* libsupc++/eh_globals.cc (get_globals_dtor): Delete unhandled\n\texceptions.\n\t* testsuite/thread/18185.cc: New.\n\nFrom-SVN: r89962", "tree": {"sha": "d97be966b802fd08c57e5b35b1953e3a7ed54c9c", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/d97be966b802fd08c57e5b35b1953e3a7ed54c9c"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/c137586a8e9df47bb5e5f71b39ed410bb6cc56db", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/c137586a8e9df47bb5e5f71b39ed410bb6cc56db", "html_url": "https://github.com/Rust-GCC/gccrs/commit/c137586a8e9df47bb5e5f71b39ed410bb6cc56db", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/c137586a8e9df47bb5e5f71b39ed410bb6cc56db/comments", "author": null, "committer": null, "parents": [{"sha": "f759c75e09bbce8fe6ad809bc27b1e832a82d422", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/f759c75e09bbce8fe6ad809bc27b1e832a82d422", "html_url": "https://github.com/Rust-GCC/gccrs/commit/f759c75e09bbce8fe6ad809bc27b1e832a82d422"}], "stats": {"total": 72, "additions": 71, "deletions": 1}, "files": [{"sha": "4e6167227efb40bb6764fd87d8abb7ab7ffbbd36", "filename": "libstdc++-v3/ChangeLog", "status": "modified", "additions": 7, "deletions": 0, "changes": 7, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/c137586a8e9df47bb5e5f71b39ed410bb6cc56db/libstdc%2B%2B-v3%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/c137586a8e9df47bb5e5f71b39ed410bb6cc56db/libstdc%2B%2B-v3%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libstdc%2B%2B-v3%2FChangeLog?ref=c137586a8e9df47bb5e5f71b39ed410bb6cc56db", "patch": "@@ -1,3 +1,10 @@\n+2004-11-01  Momchil Velikov  <velco@fadata.bg>\n+\n+\tPR libstdc++/18185\n+\t* libsupc++/eh_globals.cc (get_globals_dtor): Delete unhandled\n+\texceptions.\n+\t* testsuite/thread/18185.cc: New.\n+\t\n 2004-11-01  Chris Jefferson  <chris@bubblescope.net>\n \n         PR libstdc++/18159"}, {"sha": "0f0dee58d45709ae8217c85e956b3bac1eb918b0", "filename": "libstdc++-v3/libsupc++/eh_globals.cc", "status": "modified", "additions": 11, "deletions": 1, "changes": 12, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/c137586a8e9df47bb5e5f71b39ed410bb6cc56db/libstdc%2B%2B-v3%2Flibsupc%2B%2B%2Feh_globals.cc", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/c137586a8e9df47bb5e5f71b39ed410bb6cc56db/libstdc%2B%2B-v3%2Flibsupc%2B%2B%2Feh_globals.cc", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libstdc%2B%2B-v3%2Flibsupc%2B%2B%2Feh_globals.cc?ref=c137586a8e9df47bb5e5f71b39ed410bb6cc56db", "patch": "@@ -48,7 +48,17 @@ static void\n get_globals_dtor (void *ptr)\n {\n   if (ptr)\n-    std::free (ptr);\n+    {\n+      __cxa_exception *exn, *next;\n+      exn = ((__cxa_eh_globals *) ptr)->caughtExceptions;\n+      while (exn)\n+\t{\n+\t  next = exn->nextException;\n+\t  _Unwind_DeleteException (&exn->unwindHeader);\n+\t  exn = next;\n+\t}\n+      std::free (ptr);\n+    }\n }\n \n static void"}, {"sha": "5ea1db08526a269f6b389a0f9e769774e14cb115", "filename": "libstdc++-v3/testsuite/thread/18185.cc", "status": "added", "additions": 53, "deletions": 0, "changes": 53, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/c137586a8e9df47bb5e5f71b39ed410bb6cc56db/libstdc%2B%2B-v3%2Ftestsuite%2Fthread%2F18185.cc", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/c137586a8e9df47bb5e5f71b39ed410bb6cc56db/libstdc%2B%2B-v3%2Ftestsuite%2Fthread%2F18185.cc", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libstdc%2B%2B-v3%2Ftestsuite%2Fthread%2F18185.cc?ref=c137586a8e9df47bb5e5f71b39ed410bb6cc56db", "patch": "@@ -0,0 +1,53 @@\n+//\n+// Copyright (C) 2004 Free Software Foundation, Inc.\n+//\n+// This file is part of the GNU ISO C++ Library.  This library is free\n+// software; you can redistribute it and/or modify it under the\n+// terms of the GNU General Public License as published by the\n+// Free Software Foundation; either version 2, or (at your option)\n+// any later version.\n+//\n+// This library is distributed in the hope that it will be useful,\n+// but WITHOUT ANY WARRANTY; without even the implied warranty of\n+// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n+// GNU General Public License for more details.\n+//\n+// You should have received a copy of the GNU General Public License along\n+// with this library; see the file COPYING.  If not, write to the Free\n+// Software Foundation, 59 Temple Place - Suite 330, Boston, MA 02111-1307,\n+// USA.\n+\n+// { dg-do run { target *-*-freebsd* *-*-netbsd* *-*-linux* *-*-solaris* *-*-cygwin *-*-darwin* alpha*-*-osf* } }\n+// { dg-options \"-pthread\" { target *-*-freebsd* *-*-netbsd* *-*-linux* alpha*-*-osf* } }\n+// { dg-options \"-pthreads\" { target *-*-solaris* } }\n+\n+#include <ext/new_allocator.h>\n+#include <string>\n+#include <pthread.h>\n+\n+static void *\n+foo (void *p)\n+{\n+  typedef std::char_traits<char> traits_type;\n+  typedef __gnu_cxx::new_allocator<char> allocator_type;\n+  typedef std::basic_string<char, traits_type, allocator_type> string_type;\n+  try\n+    {\n+      throw string_type(\"leak\");\n+    }\n+  catch (const string_type&)\n+    {\n+      pthread_exit (0);\n+    }\n+}\n+\n+// c++/18185\n+// This used to leak memory.\n+int\n+main ()\n+{\n+  pthread_t t;\n+  int j = pthread_create (&t, 0, foo, 0);\n+  int i = pthread_join (t, 0);\n+  return 0;\n+}"}]}