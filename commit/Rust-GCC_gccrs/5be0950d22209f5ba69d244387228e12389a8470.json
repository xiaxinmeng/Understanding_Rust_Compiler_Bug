{"sha": "5be0950d22209f5ba69d244387228e12389a8470", "node_id": "C_kwDOANBUbNoAKDViZTA5NTBkMjIyMDlmNWJhNjlkMjQ0Mzg3MjI4ZTEyMzg5YTg0NzA", "commit": {"author": {"name": "Kewen Lin", "email": "linkw@linux.ibm.com", "date": "2022-09-26T05:33:18Z"}, "committer": {"name": "Kewen Lin", "email": "linkw@linux.ibm.com", "date": "2022-09-26T05:33:18Z"}, "message": "rs6000: Fix the condition with frame_pointer_needed_indeed [PR96072]\n\nAs PR96072 shows, the code adding REG_CFA_DEF_CFA reg note\nmakes one assumption that we have emitted one insn which\nrestores the frame pointer previously.  That part of code\nwas guarded with flag frame_pointer_needed before, it was\nconsistent, but it was replaced with flag\nframe_pointer_needed_indeed since commit r10-7981.  It\ncaused ICE due to unexpected NULL insn.\n\n\tPR target/96072\n\ngcc/ChangeLog:\n\n\t* config/rs6000/rs6000-logue.cc (rs6000_emit_epilogue): Update the\n\tcondition for adding REG_CFA_DEF_CFA reg note with\n\tframe_pointer_needed_indeed.\n\ngcc/testsuite/ChangeLog:\n\n\t* gcc.target/powerpc/pr96072.c: New test.", "tree": {"sha": "de35f0774f29e8d0c43ff1969b60b111b71a894a", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/de35f0774f29e8d0c43ff1969b60b111b71a894a"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/5be0950d22209f5ba69d244387228e12389a8470", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/5be0950d22209f5ba69d244387228e12389a8470", "html_url": "https://github.com/Rust-GCC/gccrs/commit/5be0950d22209f5ba69d244387228e12389a8470", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/5be0950d22209f5ba69d244387228e12389a8470/comments", "author": {"login": "jedilyn", "id": 38515402, "node_id": "MDQ6VXNlcjM4NTE1NDAy", "avatar_url": "https://avatars.githubusercontent.com/u/38515402?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jedilyn", "html_url": "https://github.com/jedilyn", "followers_url": "https://api.github.com/users/jedilyn/followers", "following_url": "https://api.github.com/users/jedilyn/following{/other_user}", "gists_url": "https://api.github.com/users/jedilyn/gists{/gist_id}", "starred_url": "https://api.github.com/users/jedilyn/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jedilyn/subscriptions", "organizations_url": "https://api.github.com/users/jedilyn/orgs", "repos_url": "https://api.github.com/users/jedilyn/repos", "events_url": "https://api.github.com/users/jedilyn/events{/privacy}", "received_events_url": "https://api.github.com/users/jedilyn/received_events", "type": "User", "site_admin": false}, "committer": {"login": "jedilyn", "id": 38515402, "node_id": "MDQ6VXNlcjM4NTE1NDAy", "avatar_url": "https://avatars.githubusercontent.com/u/38515402?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jedilyn", "html_url": "https://github.com/jedilyn", "followers_url": "https://api.github.com/users/jedilyn/followers", "following_url": "https://api.github.com/users/jedilyn/following{/other_user}", "gists_url": "https://api.github.com/users/jedilyn/gists{/gist_id}", "starred_url": "https://api.github.com/users/jedilyn/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jedilyn/subscriptions", "organizations_url": "https://api.github.com/users/jedilyn/orgs", "repos_url": "https://api.github.com/users/jedilyn/repos", "events_url": "https://api.github.com/users/jedilyn/events{/privacy}", "received_events_url": "https://api.github.com/users/jedilyn/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "9c9cf4f087f28dc3bf8dfa769380b3b58728a0f7", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/9c9cf4f087f28dc3bf8dfa769380b3b58728a0f7", "html_url": "https://github.com/Rust-GCC/gccrs/commit/9c9cf4f087f28dc3bf8dfa769380b3b58728a0f7"}], "stats": {"total": 16, "additions": 15, "deletions": 1}, "files": [{"sha": "a11d020ccd0ce4d2759d299e4a44f8ab8698197f", "filename": "gcc/config/rs6000/rs6000-logue.cc", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/5be0950d22209f5ba69d244387228e12389a8470/gcc%2Fconfig%2Frs6000%2Frs6000-logue.cc", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/5be0950d22209f5ba69d244387228e12389a8470/gcc%2Fconfig%2Frs6000%2Frs6000-logue.cc", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fconfig%2Frs6000%2Frs6000-logue.cc?ref=5be0950d22209f5ba69d244387228e12389a8470", "patch": "@@ -4920,7 +4920,7 @@ rs6000_emit_epilogue (enum epilogue_type epilogue_type)\n \t a REG_CFA_DEF_CFA note, but that's OK;  A duplicate is\n \t discarded by dwarf2cfi.cc/dwarf2out.cc, and in any case would\n \t be harmless if emitted.  */\n-      if (frame_pointer_needed)\n+      if (frame_pointer_needed_indeed)\n \t{\n \t  insn = get_last_insn ();\n \t  add_reg_note (insn, REG_CFA_DEF_CFA,"}, {"sha": "10341c91d2f57614699d32bae05d2e8360a0d395", "filename": "gcc/testsuite/gcc.target/powerpc/pr96072.c", "status": "added", "additions": 14, "deletions": 0, "changes": 14, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/5be0950d22209f5ba69d244387228e12389a8470/gcc%2Ftestsuite%2Fgcc.target%2Fpowerpc%2Fpr96072.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/5be0950d22209f5ba69d244387228e12389a8470/gcc%2Ftestsuite%2Fgcc.target%2Fpowerpc%2Fpr96072.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgcc.target%2Fpowerpc%2Fpr96072.c?ref=5be0950d22209f5ba69d244387228e12389a8470", "patch": "@@ -0,0 +1,14 @@\n+/* { dg-options \"-O2\" } */\n+\n+/* This used to ICE with the SYSV ABI (PR96072).  */\n+\n+void\n+he (int jn)\n+{\n+  {\n+    int bh[jn];\n+    if (jn != 0)\n+      goto wa;\n+  }\n+wa:;\n+}"}]}