{"sha": "19f0526a54834612872e13e2650e9c1f8dface4f", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6MTlmMDUyNmE1NDgzNDYxMjg3MmUxM2UyNjUwZTljMWY4ZGZhY2U0Zg==", "commit": {"author": {"name": "Arnaud Charlet", "email": "charlet@gcc.gnu.org", "date": "2003-11-20T09:54:03Z"}, "committer": {"name": "Arnaud Charlet", "email": "charlet@gcc.gnu.org", "date": "2003-11-20T09:54:03Z"}, "message": "[multiple changes]\n\n2003-11-19  Arnaud Charlet  <charlet@act-europe.fr>\n\n\t* gnatmem.adb: Clean up verbose output.\n\n\t* gprcmd.adb: Change copyright to FSF.\n\n2003-11-19  Vincent Celier  <celier@gnat.com>\n\n\t* symbols.adb: (Initialize): New parameters Reference, Symbol_Policy\n\tand Version (ignored).\n\n\t* symbols.ads: (Policy): New type\n\t(Initialize): New parameter Reference, Symbol_Policy and\n\tLibrary_Version.\n\tRemove parameter Force.\n\tMinor reformatting.\n\n\t* snames.ads, snames.adbadb: New standard names\n\tLibrary_Reference_Symbol_File and Library_Symbol_Policy\n\n\t* mlib-prj.adb:\n\t(Build_Library): Call Build_Dinamic_Library with the Symbol_Data of the\n\tproject.\n\n\t* mlib-tgt.adb:\n\t(Build_Dynamic_Library): New parameter Symbol_Data (ignored)\n\n\t* mlib-tgt.ads: (Build_Dynamic_Library): New parameter Symbol_Data\n\n\t* prj.adb: (Project_Empty): New component Symbol_Data\n\n\t* prj.ads: (Policy, Symbol_Record): New types\n\t(Project_Data): New component Symbol_Data\n\n\t* prj-attr.adb:\n\tNew attributes Library_Symbol_File, Library_Symbol_Policy and\n\tLibrary_Reference_Symbol_File.\n\n\t* prj-nmsc.adb:\n\t(Ada_Check): When project is a Stand-Alone library project, process\n\tattribute Library_Symbol_File, Library_Symbol_Policy and\n\tLibrary_Reference_Symbol_File.\n\n\t* 5aml-tgt.adb, 5bml-tgt.adb, 5gml-tgt.adb, 5hml-tgt.adb,\n\t5wml-tgt.adb, 5zml-tgt.adb, 5lml-tgt.adb,\n\t5sml-tgt.adb (Build_Dynamic_Library): New parameter\n\tSymbol_Data (ignored).\n\n\t* 5vml-tgt.adb (VMS_Options): Remove --for-linker=gsmatch=equal,1,0\n\t(Build_Dynamic_Library): New parameter Symbol_Data. New internal\n\tfunctions Option_File_Name and Version_String. Set new options of\n\tgnatsym related to symbol file, symbol policy and reference symbol\n\tfile.\n\n\t* 5vsymbol.adb:\n\tExtensive modifications to take into account the reference symbol file,\n\tthe symbol policy, the library version and to put in the symbol file the\n\tminor and major IDs.\n\n\t* bld.adb (Process_Declarative_Items): Put second argument of\n\tgprcmd to_absolute between single quotes, to avoid problems with\n\tWindows.\n\n\t* bld-io.adb: Update Copyright notice.\n\t(Flush): Remove last character of a line, if it is a back slash, to\n\tavoid make problems.\n\n\t* gnatsym.adb:\n\tImplement new scheme with reference symbol file and symbol policy.\n\n\t* g-os_lib.ads: (Is_Directory): Clarify comment\n\n2003-11-19  Robert Dewar  <dewar@gnat.com>\n\n\t* atree.adb: Move New_Copy_Tree global variables to head of package\n\n\t* errout.adb: Minor reformatting\n\n2003-11-19  Javier Miranda  <miranda@gnat.com>\n\n\t* sem_ch4.adb: (Diagnose_Call): Improve error message.\n\tAdd reference to Ada0Y (AI-50217)\n\n\t* sem_ch6.adb, sem_ch8.adb, sem_type.adb,\n\tsem_util.adb: Add reference to AI-50217\n\n\t* sinfo.ads: (N_With_Clause): Document fields referred to AI-50217\n\n\t* sprint.adb: Add reference to Ada0Y (AI-50217, AI-287)\n\n\t* sem_aggr.adb: Complete documentation of AI-287 changes\n\n\t* par-ch4.adb: Document previous changes.\n\n\t* lib-load.adb, lib-writ.adb, einfo.ads, par-ch10.adb,\n\tsem_cat.adb, sem_ch3.adb, sem_ch10.adb, sem_ch12.adb: Add references to\n\tAda0Y (AI-50217)\n\n\t* exp_aggr.adb: Add references to AI-287 in previous changes\n\n2003-11-19  Ed Schonberg  <schonberg@gnat.com>\n\n\t* exp_ch6.adb:\n\t(Add_Call_By_Copy_Node): Do not original node of rewritten expression\n\tin the rewriting is the result of an inlined call.\n\n\t* exp_ch6.adb (Add_Call_By_Copy_Node): If actual for (in-)out\n\tparameter is a type conversion, use original node to construct the\n\tpost-call assignment, because expression may have been rewritten, e.g.\n\tif it is a packed array.\n\n\t* sem_attr.adb:\n\t(Resolve_Attribute, case 'Constrained): Attribute is legal in an inlined\n\tbody, just as it is in an instance.\n\tCategorization routines\n\n\t* sem_ch12.adb (Analyze_Association, Instantiate_Formal_Subprogram,\n\tInstantiate_Object): Set proper sloc reference for message on missing\n\tactual.\n\n2003-11-19  Thomas Quinot  <quinot@act-europe.fr>\n\n\t* Makefile.in: Add FreeBSD libgnat pairs.\n\n\t* usage.adb: Fix typo in usage message.\n\n2003-11-19  Jerome Guitton  <guitton@act-europe.fr>\n\n\t* Makefile.in: On powerpc-wrs-vxworksae: Add s-thread.ad?,\n\ts-thrini.ad? and s-tiitho.adb to the full runtime, to support the\n\tpragma Thread_Body.\n\tRemove i-vthrea.ad? and s-tpae65.ad?, not needed anymore.\n\n\t* s-thread.adb: This file is now a dummy implementation of\n\tSystem.Thread.\n\n2003-11-19  Sergey Rybin  <rybin@act-europe.fr>\n\n\t* rtsfind.adb (Initialize): Add initialization for RTE_Is_Available\n\n2003-11-19  Emmanuel Briot  <briot@act-europe.fr>\n\n\t* xref_lib.adb (Parse_Identifier_Info): Add handling of generic\n\tinstanciation references in the parent type description.\n\nFrom-SVN: r73757", "tree": {"sha": "9ab2d4d0cdbbc9c975cf5fec2dfda695284b8754", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/9ab2d4d0cdbbc9c975cf5fec2dfda695284b8754"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/19f0526a54834612872e13e2650e9c1f8dface4f", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/19f0526a54834612872e13e2650e9c1f8dface4f", "html_url": "https://github.com/Rust-GCC/gccrs/commit/19f0526a54834612872e13e2650e9c1f8dface4f", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/19f0526a54834612872e13e2650e9c1f8dface4f/comments", "author": null, "committer": null, "parents": [{"sha": "371e8c4f52b053f5920d36482d650d70b7e592c1", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/371e8c4f52b053f5920d36482d650d70b7e592c1", "html_url": "https://github.com/Rust-GCC/gccrs/commit/371e8c4f52b053f5920d36482d650d70b7e592c1"}], "stats": {"total": 1513, "additions": 1187, "deletions": 326}, "files": [{"sha": "69385b66d3747aa7c840b53e59f7345a99447a9a", "filename": "gcc/ada/5aml-tgt.adb", "status": "modified", "additions": 2, "deletions": 0, "changes": 2, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/19f0526a54834612872e13e2650e9c1f8dface4f/gcc%2Fada%2F5aml-tgt.adb", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/19f0526a54834612872e13e2650e9c1f8dface4f/gcc%2Fada%2F5aml-tgt.adb", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fada%2F5aml-tgt.adb?ref=19f0526a54834612872e13e2650e9c1f8dface4f", "patch": "@@ -108,6 +108,7 @@ package body MLib.Tgt is\n       Interfaces   : Argument_List;\n       Lib_Filename : String;\n       Lib_Dir      : String;\n+      Symbol_Data  : Symbol_Record;\n       Driver_Name  : Name_Id := No_Name;\n       Lib_Address  : String  := \"\";\n       Lib_Version  : String  := \"\";\n@@ -117,6 +118,7 @@ package body MLib.Tgt is\n       pragma Unreferenced (Foreign);\n       pragma Unreferenced (Afiles);\n       pragma Unreferenced (Interfaces);\n+      pragma Unreferenced (Symbol_Data);\n       pragma Unreferenced (Lib_Address);\n       pragma Unreferenced (Relocatable);\n "}, {"sha": "c07d58cb01aacfd364ea7001607c0ae17c1d4a49", "filename": "gcc/ada/5bml-tgt.adb", "status": "modified", "additions": 2, "deletions": 0, "changes": 2, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/19f0526a54834612872e13e2650e9c1f8dface4f/gcc%2Fada%2F5bml-tgt.adb", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/19f0526a54834612872e13e2650e9c1f8dface4f/gcc%2Fada%2F5bml-tgt.adb", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fada%2F5bml-tgt.adb?ref=19f0526a54834612872e13e2650e9c1f8dface4f", "patch": "@@ -120,6 +120,7 @@ package body MLib.Tgt is\n       Interfaces   : Argument_List;\n       Lib_Filename : String;\n       Lib_Dir      : String;\n+      Symbol_Data  : Symbol_Record;\n       Driver_Name  : Name_Id := No_Name;\n       Lib_Address  : String  := \"\";\n       Lib_Version  : String  := \"\";\n@@ -129,6 +130,7 @@ package body MLib.Tgt is\n       pragma Unreferenced (Foreign);\n       pragma Unreferenced (Afiles);\n       pragma Unreferenced (Interfaces);\n+      pragma Unreferenced (Symbol_Data);\n       pragma Unreferenced (Lib_Address);\n       pragma Unreferenced (Lib_Version);\n       pragma Unreferenced (Relocatable);"}, {"sha": "c5390a685ce100064f5414071a6d0d867c4004b1", "filename": "gcc/ada/5gml-tgt.adb", "status": "modified", "additions": 2, "deletions": 0, "changes": 2, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/19f0526a54834612872e13e2650e9c1f8dface4f/gcc%2Fada%2F5gml-tgt.adb", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/19f0526a54834612872e13e2650e9c1f8dface4f/gcc%2Fada%2F5gml-tgt.adb", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fada%2F5gml-tgt.adb?ref=19f0526a54834612872e13e2650e9c1f8dface4f", "patch": "@@ -103,6 +103,7 @@ package body MLib.Tgt is\n       Interfaces   : Argument_List;\n       Lib_Filename : String;\n       Lib_Dir      : String;\n+      Symbol_Data  : Symbol_Record;\n       Driver_Name  : Name_Id := No_Name;\n       Lib_Address  : String  := \"\";\n       Lib_Version  : String  := \"\";\n@@ -112,6 +113,7 @@ package body MLib.Tgt is\n       pragma Unreferenced (Foreign);\n       pragma Unreferenced (Afiles);\n       pragma Unreferenced (Interfaces);\n+      pragma Unreferenced (Symbol_Data);\n       pragma Unreferenced (Lib_Address);\n       pragma Unreferenced (Relocatable);\n "}, {"sha": "c790df89bfbec06e42d5a553b2e799331bf74cd6", "filename": "gcc/ada/5hml-tgt.adb", "status": "modified", "additions": 2, "deletions": 0, "changes": 2, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/19f0526a54834612872e13e2650e9c1f8dface4f/gcc%2Fada%2F5hml-tgt.adb", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/19f0526a54834612872e13e2650e9c1f8dface4f/gcc%2Fada%2F5hml-tgt.adb", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fada%2F5hml-tgt.adb?ref=19f0526a54834612872e13e2650e9c1f8dface4f", "patch": "@@ -102,6 +102,7 @@ package body MLib.Tgt is\n       Interfaces   : Argument_List;\n       Lib_Filename : String;\n       Lib_Dir      : String;\n+      Symbol_Data  : Symbol_Record;\n       Driver_Name  : Name_Id := No_Name;\n       Lib_Address  : String  := \"\";\n       Lib_Version  : String  := \"\";\n@@ -111,6 +112,7 @@ package body MLib.Tgt is\n       pragma Unreferenced (Foreign);\n       pragma Unreferenced (Afiles);\n       pragma Unreferenced (Interfaces);\n+      pragma Unreferenced (Symbol_Data);\n       pragma Unreferenced (Lib_Address);\n       pragma Unreferenced (Relocatable);\n "}, {"sha": "b9d4217fe19cdf3b3545f429f6de134affeefcc6", "filename": "gcc/ada/5lml-tgt.adb", "status": "modified", "additions": 2, "deletions": 0, "changes": 2, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/19f0526a54834612872e13e2650e9c1f8dface4f/gcc%2Fada%2F5lml-tgt.adb", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/19f0526a54834612872e13e2650e9c1f8dface4f/gcc%2Fada%2F5lml-tgt.adb", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fada%2F5lml-tgt.adb?ref=19f0526a54834612872e13e2650e9c1f8dface4f", "patch": "@@ -106,6 +106,7 @@ package body MLib.Tgt is\n       Interfaces   : Argument_List;\n       Lib_Filename : String;\n       Lib_Dir      : String;\n+      Symbol_Data  : Symbol_Record;\n       Driver_Name  : Name_Id := No_Name;\n       Lib_Address  : String  := \"\";\n       Lib_Version  : String  := \"\";\n@@ -115,6 +116,7 @@ package body MLib.Tgt is\n       pragma Unreferenced (Foreign);\n       pragma Unreferenced (Afiles);\n       pragma Unreferenced (Interfaces);\n+      pragma Unreferenced (Symbol_Data);\n       pragma Unreferenced (Lib_Address);\n       pragma Unreferenced (Relocatable);\n "}, {"sha": "a7bc9333b66e9df0b2cb5e41254056d942068e45", "filename": "gcc/ada/5sml-tgt.adb", "status": "modified", "additions": 2, "deletions": 0, "changes": 2, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/19f0526a54834612872e13e2650e9c1f8dface4f/gcc%2Fada%2F5sml-tgt.adb", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/19f0526a54834612872e13e2650e9c1f8dface4f/gcc%2Fada%2F5sml-tgt.adb", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fada%2F5sml-tgt.adb?ref=19f0526a54834612872e13e2650e9c1f8dface4f", "patch": "@@ -100,6 +100,7 @@ package body MLib.Tgt is\n       Interfaces   : Argument_List;\n       Lib_Filename : String;\n       Lib_Dir      : String;\n+      Symbol_Data  : Symbol_Record;\n       Driver_Name  : Name_Id := No_Name;\n       Lib_Address  : String  := \"\";\n       Lib_Version  : String  := \"\";\n@@ -109,6 +110,7 @@ package body MLib.Tgt is\n       pragma Unreferenced (Foreign);\n       pragma Unreferenced (Afiles);\n       pragma Unreferenced (Interfaces);\n+      pragma Unreferenced (Symbol_Data);\n       pragma Unreferenced (Lib_Address);\n       pragma Unreferenced (Relocatable);\n "}, {"sha": "269e8b045e5fb125ed40fed954785ff22ca6633d", "filename": "gcc/ada/5vml-tgt.adb", "status": "modified", "additions": 106, "deletions": 11, "changes": 117, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/19f0526a54834612872e13e2650e9c1f8dface4f/gcc%2Fada%2F5vml-tgt.adb", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/19f0526a54834612872e13e2650e9c1f8dface4f/gcc%2Fada%2F5vml-tgt.adb", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fada%2F5vml-tgt.adb?ref=19f0526a54834612872e13e2650e9c1f8dface4f", "patch": "@@ -59,13 +59,9 @@ package body MLib.Tgt is\n    --  Options to use when invoking gcc to build the dynamic library\n \n    No_Start_Files : aliased String := \"-nostartfiles\";\n-   For_Linker_Opt : aliased String := \"--for-linker=symvec.opt\";\n-   Gsmatch        : aliased String := \"--for-linker=gsmatch=equal,1,0\";\n \n-   VMS_Options : constant Argument_List :=\n-     (No_Start_Files'Access, For_Linker_Opt'Access, Gsmatch'Access);\n-\n---   Command : String_Access;\n+   VMS_Options : Argument_List :=\n+     (No_Start_Files'Access, null);\n \n    Gnatsym_Name : constant String := \"gnatsym\";\n \n@@ -134,6 +130,7 @@ package body MLib.Tgt is\n       Interfaces   : Argument_List;\n       Lib_Filename : String;\n       Lib_Dir      : String;\n+      Symbol_Data  : Symbol_Record;\n       Driver_Name  : Name_Id := No_Name;\n       Lib_Address  : String  := \"\";\n       Lib_Version  : String  := \"\";\n@@ -143,10 +140,9 @@ package body MLib.Tgt is\n       pragma Unreferenced (Foreign);\n       pragma Unreferenced (Afiles);\n       pragma Unreferenced (Lib_Address);\n-      pragma Unreferenced (Lib_Version);\n       pragma Unreferenced (Relocatable);\n \n-      Opt_File_Name : constant String := \"symvec.opt\";\n+\n \n       Lib_File : constant String :=\n                    Lib_Dir & Directory_Separator & \"lib\" &\n@@ -163,6 +159,13 @@ package body MLib.Tgt is\n       --  file name of an interface of the SAL.\n       --  For other libraries, always return True.\n \n+      function Option_File_Name return String;\n+      --  Returns Symbol_File, if not empty. Otherwise, returns \"symvec.opt\"\n+\n+      function Version_String return String;\n+      --  Returns Lib_Version if not empty, otherwise returns \"1\".\n+      --  Fails gnatmake if Lib_Version is not the image of a positive number.\n+\n       ------------------\n       -- Is_Interface --\n       ------------------\n@@ -192,7 +195,57 @@ package body MLib.Tgt is\n          end if;\n       end Is_Interface;\n \n+      ----------------------\n+      -- Option_File_Name --\n+      ----------------------\n+\n+      function Option_File_Name return String is\n+      begin\n+         if Symbol_Data.Symbol_File = No_Name then\n+            return \"symvec.opt\";\n+\n+         else\n+            return Get_Name_String (Symbol_Data.Symbol_File);\n+         end if;\n+      end Option_File_Name;\n+\n+      --------------------\n+      -- Version_String --\n+      --------------------\n+\n+      function Version_String return String is\n+         Version : Integer := 0;\n+      begin\n+         if Lib_Version = \"\" then\n+            return \"1\";\n+\n+         else\n+            begin\n+               Version := Integer'Value (Lib_Version);\n+\n+               if Version <= 0 then\n+                  raise Constraint_Error;\n+               end if;\n+\n+               return Lib_Version;\n+\n+            exception\n+               when Constraint_Error =>\n+                  Fail (\"illegal version \"\"\", Lib_Version,\n+                        \"\"\" (on VMS version must be a positive number)\");\n+                  return \"\";\n+            end;\n+         end if;\n+      end Version_String;\n+\n+      Opt_File_Name  : constant String := Option_File_Name;\n+      For_Linker_Opt : constant String_Access :=\n+                         new String'(\"--for-linker=\" & Opt_File_Name);\n+      Version : constant String := Version_String;\n+\n    begin\n+      VMS_Options (VMS_Options'First + 1) := For_Linker_Opt;\n+\n       for J in Inter'Range loop\n          To_Lower (Inter (J).all);\n       end loop;\n@@ -288,19 +341,61 @@ package body MLib.Tgt is\n          end;\n       end if;\n \n-      --  Allocate the argument list and put the symbol file name\n+      --  Allocate the argument list and put the symbol file name, the\n+      --  reference (if any) and the policy (if not autonomous).\n \n-      Arguments := new Argument_List (1 .. Ofiles'Length + 2);\n+      Arguments := new Argument_List (1 .. Ofiles'Length + 8);\n \n-      Last_Argument := 1;\n+      Last_Argument := 0;\n+\n+      --  Verbosity\n \n       if Verbose_Mode then\n+         Last_Argument := Last_Argument + 1;\n          Arguments (Last_Argument) := new String'(\"-v\");\n+      end if;\n+\n+      --  Version number (major ID)\n+\n+      if Lib_Version /= \"\" then\n+         Last_Argument := Last_Argument + 1;\n+         Arguments (Last_Argument) := new String'(\"-V\");\n          Last_Argument := Last_Argument + 1;\n+         Arguments (Last_Argument) := new String'(Version);\n       end if;\n \n+      --  Symbol file\n+\n+      Last_Argument := Last_Argument + 1;\n+      Arguments (Last_Argument) := new String'(\"-s\");\n+      Last_Argument := Last_Argument + 1;\n       Arguments (Last_Argument) := new String'(Opt_File_Name);\n \n+      --  Reference Symbol File\n+\n+      if Symbol_Data.Reference /= No_Name then\n+         Last_Argument := Last_Argument + 1;\n+         Arguments (Last_Argument) := new String'(\"-r\");\n+         Last_Argument := Last_Argument + 1;\n+         Arguments (Last_Argument) :=\n+           new String'(Get_Name_String (Symbol_Data.Reference));\n+      end if;\n+\n+      --  Policy\n+\n+      case Symbol_Data.Symbol_Policy is\n+         when Autonomous =>\n+            null;\n+\n+         when Compliant =>\n+            Last_Argument := Last_Argument + 1;\n+            Arguments (Last_Argument) := new String'(\"-c\");\n+\n+         when Controlled =>\n+            Last_Argument := Last_Argument + 1;\n+            Arguments (Last_Argument) := new String'(\"-C\");\n+      end case;\n+\n       --  Add each relevant object file\n \n       for Index in Ofiles'Range loop"}, {"sha": "c623e42b383a7a1dfff1a5384752791e0e007805", "filename": "gcc/ada/5vsymbol.adb", "status": "modified", "additions": 229, "deletions": 14, "changes": 243, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/19f0526a54834612872e13e2650e9c1f8dface4f/gcc%2Fada%2F5vsymbol.adb", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/19f0526a54834612872e13e2650e9c1f8dface4f/gcc%2Fada%2F5vsymbol.adb", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fada%2F5vsymbol.adb?ref=19f0526a54834612872e13e2650e9c1f8dface4f", "patch": "@@ -36,10 +36,32 @@ package body Symbols is\n    Symbol_Vector   : constant String := \"SYMBOL_VECTOR=(\";\n    Equal_Data      : constant String := \"=DATA)\";\n    Equal_Procedure : constant String := \"=PROCEDURE)\";\n+   Gsmatch         : constant String := \"gsmatch=equal,\";\n \n    Symbol_File_Name : String_Access := null;\n    --  Name of the symbol file\n \n+   Sym_Policy : Policy := Autonomous;\n+   --  The symbol policy. Set by Initialize\n+\n+   Major_ID : Integer := 1;\n+   --  The Major ID. May be modified by Initialize if Library_Version is\n+   --  specified or if it is read from the reference symbol file.\n+\n+   Soft_Major_ID : Boolean := True;\n+   --  False if library version is specified in procedure Initialize.\n+   --  When True, Major_ID may be modified if found in the reference symbol\n+   --  file.\n+\n+   Minor_ID : Natural := 0;\n+   --  The Minor ID. May be modified if read from the reference symbol file\n+\n+   Soft_Minor_ID : Boolean := True;\n+   --  False if symbol policy is Autonomous, if library version is specified\n+   --  in procedure Initialize and is not the same as the major ID read from\n+   --  the reference symbol file. When True, Minor_ID may be increased in\n+   --  Compliant symbol policy.\n+\n    subtype Byte is Character;\n    --  Object files are stream of bytes, but some of these bytes, those for\n    --  the names of the symbols, are ASCII characters.\n@@ -67,6 +89,9 @@ package body Symbols is\n    Number_Of_Characters : Natural := 0;\n    --  The number of characters of each section\n \n+   --  The following variables are used by procedure Process when reading an\n+   --  object file.\n+\n    Code   : Number := 0;\n    Length : Natural := 0;\n \n@@ -87,6 +112,10 @@ package body Symbols is\n    procedure Get (N : out Natural);\n    --  Read two bytes from the object file, LSByte first, as a Natural\n \n+\n+   function Image (N : Integer) return String;\n+   --  Returns the image of N, without the initial space\n+\n    -----------\n    -- Equal --\n    -----------\n@@ -121,15 +150,32 @@ package body Symbols is\n       N := Natural (Result);\n    end Get;\n \n+   -----------\n+   -- Image --\n+   -----------\n+\n+   function Image (N : Integer) return String is\n+      Result : constant String := N'Img;\n+   begin\n+      if Result (Result'First) = ' ' then\n+         return Result (Result'First + 1 .. Result'Last);\n+\n+      else\n+         return Result;\n+      end if;\n+   end Image;\n+\n    ----------------\n    -- Initialize --\n    ----------------\n \n    procedure Initialize\n-     (Symbol_File : String;\n-      Force       : Boolean;\n-      Quiet       : Boolean;\n-      Success     : out Boolean)\n+     (Symbol_File   : String;\n+      Reference     : String;\n+      Symbol_Policy : Policy;\n+      Quiet         : Boolean;\n+      Version       : String;\n+      Success       : out Boolean)\n    is\n       File : Ada.Text_IO.File_Type;\n       Line : String (1 .. 1_000);\n@@ -140,6 +186,40 @@ package body Symbols is\n \n       Symbol_File_Name := new String'(Symbol_File);\n \n+      --  Record the policy\n+\n+      Sym_Policy := Symbol_Policy;\n+\n+      --  Record the version (Major ID)\n+\n+      if Version = \"\" then\n+         Major_ID := 1;\n+         Soft_Major_ID := True;\n+\n+      else\n+         begin\n+            Major_ID := Integer'Value (Version);\n+            Soft_Major_ID := False;\n+\n+            if Major_ID <= 0 then\n+               raise Constraint_Error;\n+            end if;\n+\n+         exception\n+            when Constraint_Error =>\n+               if not Quiet then\n+                  Put_Line (\"Version \"\"\" & Version & \"\"\" is illegal.\");\n+                  Put_Line (\"On VMS, version must be a positive number\");\n+               end if;\n+\n+               Success := False;\n+               return;\n+         end;\n+      end if;\n+\n+      Minor_ID := 0;\n+      Soft_Minor_ID := Sym_Policy /= Autonomous;\n+\n       --  Empty the symbol tables\n \n       Symbol_Table.Set_Last (Original_Symbols, 0);\n@@ -149,40 +229,51 @@ package body Symbols is\n \n       Success := True;\n \n-      --  If Force is not set, attempt to read the symbol file\n+      --  If policy is not autonomous, attempt to read the reference file\n \n-      if not Force then\n+      if Sym_Policy /= Autonomous then\n          begin\n-            Open (File, In_File, Symbol_File);\n+            Open (File, In_File, Reference);\n \n          exception\n             when Ada.Text_IO.Name_Error =>\n                return;\n \n             when X : others =>\n                if not Quiet then\n-                  Put_Line (\"could not open \"\"\" & Symbol_File & \"\"\"\");\n+                  Put_Line (\"could not open \"\"\" & Reference & \"\"\"\");\n                   Put_Line (Exception_Message (X));\n                end if;\n \n                Success := False;\n                return;\n          end;\n \n+         --  Read line by line\n+\n          while not End_Of_File (File) loop\n             Get_Line (File, Line, Last);\n \n+            --  Ignore empty lines\n+\n             if Last = 0 then\n                null;\n \n+            --  Ignore lines starting with \"case_sensitive=\"\n+\n             elsif Last > Case_Sensitive'Length\n               and then Line (1 .. Case_Sensitive'Length) = Case_Sensitive\n             then\n                null;\n \n+            --  Line starting with \"SYMBOL_VECTOR=(\"\n+\n             elsif Last > Symbol_Vector'Length\n               and then Line (1 .. Symbol_Vector'Length) = Symbol_Vector\n             then\n+\n+               --  SYMBOL_VECTOR=(<symbol>=DATA)\n+\n                if Last > Symbol_Vector'Length + Equal_Data'Length and then\n                  Line (Last - Equal_Data'Length + 1 .. Last) = Equal_Data\n                then\n@@ -195,6 +286,8 @@ package body Symbols is\n                        Kind => Data,\n                        Present => True);\n \n+               --  SYMBOL_VECTOR=(<symbol>=PROCEDURE)\n+\n                elsif Last > Symbol_Vector'Length + Equal_Procedure'Length\n                  and then\n                   Line (Last - Equal_Procedure'Length + 1 .. Last) =\n@@ -209,9 +302,11 @@ package body Symbols is\n                      Kind => Proc,\n                      Present => True);\n \n+               --  Anything else is incorrectly formatted\n+\n                else\n                   if not Quiet then\n-                     Put_Line (\"symbol file \"\"\" & Symbol_File &\n+                     Put_Line (\"symbol file \"\"\" & Reference &\n                                \"\"\" is incorrectly formatted:\");\n                      Put_Line (\"\"\"\" & Line (1 .. Last) & \"\"\"\");\n                   end if;\n@@ -221,10 +316,95 @@ package body Symbols is\n                   return;\n                end if;\n \n+            --  Lines with \"gsmatch=equal,<Major_ID>,<Minor_Id>\n+\n+            elsif Last > Gsmatch'Length\n+              and then Line (1 .. Gsmatch'Length) = Gsmatch\n+            then\n+               declare\n+                  Start  : Positive := Gsmatch'Length + 1;\n+                  Finish : Positive := Start;\n+                  OK     : Boolean  := True;\n+                  ID     : Integer;\n+\n+               begin\n+                  loop\n+                     if Line (Finish) not in '0' .. '9'\n+                       or else Finish >= Last - 1\n+                     then\n+                        OK := False;\n+                        exit;\n+                     end if;\n+\n+                     exit when Line (Finish + 1) = ',';\n+\n+                     Finish := Finish + 1;\n+                  end loop;\n+\n+                  if OK then\n+                     ID := Integer'Value (Line (Start .. Finish));\n+                     OK := ID /= 0;\n+\n+                     --  If Soft_Major_ID is True, it means that\n+                     --  Library_Version was not specified.\n+\n+                     if Soft_Major_ID then\n+                        Major_ID := ID;\n+\n+                     --  If the Major ID in the reference file is different\n+                     --  from the Library_Version, then the Minor ID will be 0\n+                     --  because there is no point in taking the Minor ID in\n+                     --  the reference file, or incrementing it. So, we set\n+                     --  Soft_Minor_ID to False, so that we don't modify\n+                     --  the Minor_ID later.\n+\n+                     elsif Major_ID /= ID then\n+                        Soft_Minor_ID := False;\n+                     end if;\n+\n+                     Start := Finish + 2;\n+                     Finish := Start;\n+\n+                     loop\n+                        if Line (Finish) not in '0' .. '9' then\n+                           OK := False;\n+                           exit;\n+                        end if;\n+\n+                        exit when Finish = Last;\n+\n+                        Finish := Finish + 1;\n+                     end loop;\n+\n+                     --  Only set Minor_ID if Soft_Minor_ID is True (see above)\n+\n+                     if OK and then Soft_Minor_ID then\n+                        Minor_ID := Integer'Value (Line (Start .. Finish));\n+                     end if;\n+                  end if;\n+\n+                  --  If OK is not True, that means the line is not correctly\n+                  --  formatted.\n+\n+                  if not OK then\n+                     if not Quiet then\n+                        Put_Line (\"symbol file \"\"\" & Reference &\n+                                  \"\"\" is incorrectly formatted\");\n+                        Put_Line (\"\"\"\" & Line (1 .. Last) & \"\"\"\");\n+                     end if;\n+\n+                     Close (File);\n+                     Success := False;\n+                     return;\n+                  end if;\n+               end;\n+\n+            --  Anything else is incorrectly formatted\n+\n             else\n                if not Quiet then\n                   Put_Line (\"unexpected line in symbol file \"\"\" &\n-                            Symbol_File & \"\"\"\");\n+                            Reference & \"\"\"\");\n                   Put_Line (\"\"\"\" & Line (1 .. Last) & \"\"\"\");\n                end if;\n \n@@ -247,7 +427,8 @@ package body Symbols is\n       Success     : out Boolean)\n    is\n    begin\n-      --  Open the object file. Return with Success = False if this fails.\n+      --  Open the object file with Byte_IO. Return with Success = False if\n+      --  this fails.\n \n       begin\n          Open (File, In_File, Object_File);\n@@ -410,8 +591,9 @@ package body Symbols is\n \n       else\n \n-         --  First find if the symbols in the symbol file are also in the\n-         --  object files.\n+         --  First find if the symbols in the reference symbol file are also\n+         --  in the object files. Note that this is not done if the policy is\n+         --  Autonomous, because no reference symbol file has been read.\n \n          --  Expect the first symbol in the symbol file to also be the first\n          --  in Complete_Symbols.\n@@ -450,13 +632,27 @@ package body Symbols is\n             --  If the symbol is not found, mark it as such in the table\n \n             if not Found then\n-               if not Quiet then\n+               if (not Quiet) or else Sym_Policy = Controlled then\n                   Put_Line (\"symbol \"\"\" & S_Data.Name.all &\n                             \"\"\" is no longer present in the object files\");\n                end if;\n \n+               if Sym_Policy = Controlled then\n+                  Success := False;\n+                  return;\n+\n+               elsif Soft_Minor_ID then\n+                  Minor_ID := Minor_ID + 1;\n+                  Soft_Minor_ID := False;\n+               end if;\n+\n                Original_Symbols.Table (Index_1).Present := False;\n                Free (Original_Symbols.Table (Index_1).Name);\n+\n+               if Soft_Minor_ID then\n+                  Minor_ID := Minor_ID + 1;\n+                  Soft_Minor_ID := False;\n+               end if;\n             end if;\n          end loop;\n \n@@ -466,6 +662,18 @@ package body Symbols is\n             S_Data := Complete_Symbols.Table (Index);\n \n             if S_Data.Present then\n+\n+               if Sym_Policy = Controlled then\n+                  Put_Line (\"symbol \"\"\" & S_Data.Name.all &\n+                            \"\"\" is not in the reference symbol file\");\n+                  Success := False;\n+                  return;\n+\n+               elsif Soft_Minor_ID then\n+                  Minor_ID := Minor_ID + 1;\n+                  Soft_Minor_ID := False;\n+               end if;\n+\n                Symbol_Table.Increment_Last (Original_Symbols);\n                Original_Symbols.Table (Symbol_Table.Last (Original_Symbols)) :=\n                  S_Data;\n@@ -501,6 +709,13 @@ package body Symbols is\n          Put (File, Case_Sensitive);\n          Put_Line (File, \"NO\");\n \n+         --  Put the version IDs\n+\n+         Put (File, Gsmatch);\n+         Put (File, Image (Major_ID));\n+         Put (File, ',');\n+         Put_Line  (File, Image (Minor_ID));\n+\n          --  And we are done\n \n          Close (File);"}, {"sha": "5747ead4cdb06adb4e976f226e81c3b972163247", "filename": "gcc/ada/5wml-tgt.adb", "status": "modified", "additions": 2, "deletions": 0, "changes": 2, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/19f0526a54834612872e13e2650e9c1f8dface4f/gcc%2Fada%2F5wml-tgt.adb", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/19f0526a54834612872e13e2650e9c1f8dface4f/gcc%2Fada%2F5wml-tgt.adb", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fada%2F5wml-tgt.adb?ref=19f0526a54834612872e13e2650e9c1f8dface4f", "patch": "@@ -91,6 +91,7 @@ package body MLib.Tgt is\n       Interfaces   : Argument_List;\n       Lib_Filename : String;\n       Lib_Dir      : String;\n+      Symbol_Data  : Symbol_Record;\n       Driver_Name  : Name_Id := No_Name;\n       Lib_Address  : String  := \"\";\n       Lib_Version  : String  := \"\";\n@@ -99,6 +100,7 @@ package body MLib.Tgt is\n    is\n       pragma Unreferenced (Ofiles);\n       pragma Unreferenced (Interfaces);\n+      pragma Unreferenced (Symbol_Data);\n       pragma Unreferenced (Driver_Name);\n       pragma Unreferenced (Lib_Version);\n       pragma Unreferenced (Auto_Init);"}, {"sha": "0331c9f23f8d413f692e6220c33574fac9d5c38c", "filename": "gcc/ada/5zml-tgt.adb", "status": "modified", "additions": 2, "deletions": 0, "changes": 2, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/19f0526a54834612872e13e2650e9c1f8dface4f/gcc%2Fada%2F5zml-tgt.adb", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/19f0526a54834612872e13e2650e9c1f8dface4f/gcc%2Fada%2F5zml-tgt.adb", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fada%2F5zml-tgt.adb?ref=19f0526a54834612872e13e2650e9c1f8dface4f", "patch": "@@ -93,6 +93,7 @@ package body MLib.Tgt is\n       Interfaces   : Argument_List;\n       Lib_Filename : String;\n       Lib_Dir      : String;\n+      Symbol_Data  : Symbol_Record;\n       Driver_Name  : Name_Id := No_Name;\n       Lib_Address  : String  := \"\";\n       Lib_Version  : String  := \"\";\n@@ -106,6 +107,7 @@ package body MLib.Tgt is\n       pragma Unreferenced (Interfaces);\n       pragma Unreferenced (Lib_Filename);\n       pragma Unreferenced (Lib_Dir);\n+      pragma Unreferenced (Symbol_Data);\n       pragma Unreferenced (Driver_Name);\n       pragma Unreferenced (Lib_Address);\n       pragma Unreferenced (Lib_Version);"}, {"sha": "ac5254f021e89012612d3b698f895ecec52c36f6", "filename": "gcc/ada/ChangeLog", "status": "modified", "additions": 145, "deletions": 0, "changes": 145, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/19f0526a54834612872e13e2650e9c1f8dface4f/gcc%2Fada%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/19f0526a54834612872e13e2650e9c1f8dface4f/gcc%2Fada%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fada%2FChangeLog?ref=19f0526a54834612872e13e2650e9c1f8dface4f", "patch": "@@ -1,3 +1,148 @@\n+2003-11-19  Arnaud Charlet  <charlet@act-europe.fr>\n+\n+\t* gnatmem.adb: Clean up verbose output.\n+\n+\t* gprcmd.adb: Change copyright to FSF.\n+\n+2003-11-19  Vincent Celier  <celier@gnat.com>\n+\n+\t* symbols.adb: (Initialize): New parameters Reference, Symbol_Policy\n+\tand Version (ignored).\n+\n+\t* symbols.ads: (Policy): New type\n+\t(Initialize): New parameter Reference, Symbol_Policy and\n+\tLibrary_Version.\n+\tRemove parameter Force.\n+\tMinor reformatting.\n+\n+\t* snames.ads, snames.adbadb: New standard names\n+\tLibrary_Reference_Symbol_File and Library_Symbol_Policy\n+\n+\t* mlib-prj.adb: \n+\t(Build_Library): Call Build_Dinamic_Library with the Symbol_Data of the\n+\tproject.\n+\n+\t* mlib-tgt.adb: \n+\t(Build_Dynamic_Library): New parameter Symbol_Data (ignored)\n+\n+\t* mlib-tgt.ads: (Build_Dynamic_Library): New parameter Symbol_Data\n+\n+\t* prj.adb: (Project_Empty): New component Symbol_Data\n+\n+\t* prj.ads: (Policy, Symbol_Record): New types\n+\t(Project_Data): New component Symbol_Data\n+\n+\t* prj-attr.adb: \n+\tNew attributes Library_Symbol_File, Library_Symbol_Policy and\n+\tLibrary_Reference_Symbol_File.\n+\n+\t* prj-nmsc.adb: \n+\t(Ada_Check): When project is a Stand-Alone library project, process\n+\tattribute Library_Symbol_File, Library_Symbol_Policy and\n+\tLibrary_Reference_Symbol_File.\n+\n+\t* 5aml-tgt.adb, 5bml-tgt.adb, 5gml-tgt.adb, 5hml-tgt.adb,\n+\t5wml-tgt.adb, 5zml-tgt.adb, 5lml-tgt.adb,\n+\t5sml-tgt.adb (Build_Dynamic_Library): New parameter\n+\tSymbol_Data (ignored).\n+\n+\t* 5vml-tgt.adb (VMS_Options): Remove --for-linker=gsmatch=equal,1,0\n+\t(Build_Dynamic_Library): New parameter Symbol_Data. New internal\n+\tfunctions Option_File_Name and Version_String. Set new options of\n+\tgnatsym related to symbol file, symbol policy and reference symbol\n+\tfile.\n+\n+\t* 5vsymbol.adb: \n+\tExtensive modifications to take into account the reference symbol file,\n+\tthe symbol policy, the library version and to put in the symbol file the\n+\tminor and major IDs.\n+\n+\t* bld.adb (Process_Declarative_Items): Put second argument of\n+\tgprcmd to_absolute between single quotes, to avoid problems with\n+\tWindows.\n+\n+\t* bld-io.adb: Update Copyright notice.\n+\t(Flush): Remove last character of a line, if it is a back slash, to\n+\tavoid make problems.\n+\n+\t* gnatsym.adb: \n+\tImplement new scheme with reference symbol file and symbol policy.\n+\n+\t* g-os_lib.ads: (Is_Directory): Clarify comment\n+\n+2003-11-19  Robert Dewar  <dewar@gnat.com>\n+\n+\t* atree.adb: Move New_Copy_Tree global variables to head of package\n+\n+\t* errout.adb: Minor reformatting\n+\n+2003-11-19  Javier Miranda  <miranda@gnat.com>\n+\n+\t* sem_ch4.adb: (Diagnose_Call): Improve error message.\n+\tAdd reference to Ada0Y (AI-50217)\n+\n+\t* sem_ch6.adb, sem_ch8.adb, sem_type.adb,\n+\tsem_util.adb: Add reference to AI-50217\n+\n+\t* sinfo.ads: (N_With_Clause): Document fields referred to AI-50217\n+\n+\t* sprint.adb: Add reference to Ada0Y (AI-50217, AI-287)\n+\n+\t* sem_aggr.adb: Complete documentation of AI-287 changes\n+\n+\t* par-ch4.adb: Document previous changes.\n+\n+\t* lib-load.adb, lib-writ.adb, einfo.ads, par-ch10.adb,\n+\tsem_cat.adb, sem_ch3.adb, sem_ch10.adb, sem_ch12.adb: Add references to\n+\tAda0Y (AI-50217)\n+\n+\t* exp_aggr.adb: Add references to AI-287 in previous changes\n+\n+2003-11-19  Ed Schonberg  <schonberg@gnat.com>\n+\n+\t* exp_ch6.adb: \n+\t(Add_Call_By_Copy_Node): Do not original node of rewritten expression\n+\tin the rewriting is the result of an inlined call.\n+\n+\t* exp_ch6.adb (Add_Call_By_Copy_Node): If actual for (in-)out\n+\tparameter is a type conversion, use original node to construct the\n+\tpost-call assignment, because expression may have been rewritten, e.g.\n+\tif it is a packed array.\n+\n+\t* sem_attr.adb: \n+\t(Resolve_Attribute, case 'Constrained): Attribute is legal in an inlined\n+\tbody, just as it is in an instance.\n+\tCategorization routines\n+\n+\t* sem_ch12.adb (Analyze_Association, Instantiate_Formal_Subprogram,\n+\tInstantiate_Object): Set proper sloc reference for message on missing\n+\tactual.\n+\n+2003-11-19  Thomas Quinot  <quinot@act-europe.fr>\n+\n+\t* Makefile.in: Add FreeBSD libgnat pairs.\n+\n+\t* usage.adb: Fix typo in usage message.\n+\n+2003-11-19  Jerome Guitton  <guitton@act-europe.fr>\n+\n+\t* Makefile.in: On powerpc-wrs-vxworksae: Add s-thread.ad?,\n+\ts-thrini.ad? and s-tiitho.adb to the full runtime, to support the\n+\tpragma Thread_Body.\n+\tRemove i-vthrea.ad? and s-tpae65.ad?, not needed anymore.\n+\n+\t* s-thread.adb: This file is now a dummy implementation of\n+\tSystem.Thread.\n+\n+2003-11-19  Sergey Rybin  <rybin@act-europe.fr>\n+\n+\t* rtsfind.adb (Initialize): Add initialization for RTE_Is_Available\n+\n+2003-11-19  Emmanuel Briot  <briot@act-europe.fr>\n+\n+\t* xref_lib.adb (Parse_Identifier_Info): Add handling of generic\n+\tinstanciation references in the parent type description.\n+\n 2003-11-18  Richard Kenner  <kenner@vlsi1.ultra.nyu.edu>\n \n \t* ada-tree.def: (ALLOCATE_EXPR): Class is \"2\", not \"s\"."}, {"sha": "66956a9a47e5ac3099310c3a436197d6710172bb", "filename": "gcc/ada/Makefile.in", "status": "modified", "additions": 26, "deletions": 2, "changes": 28, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/19f0526a54834612872e13e2650e9c1f8dface4f/gcc%2Fada%2FMakefile.in", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/19f0526a54834612872e13e2650e9c1f8dface4f/gcc%2Fada%2FMakefile.in", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fada%2FMakefile.in?ref=19f0526a54834612872e13e2650e9c1f8dface4f", "patch": "@@ -626,6 +626,10 @@ ifeq ($(strip $(filter-out powerpc% wrs vxworksae,$(targ))),)\n   s-parame.ads<5yparame.ads \\\n   s-taprop.adb<5ztaprop.adb \\\n   s-taspri.ads<5ztaspri.ads \\\n+  s-thread.adb<5zthread.adb \\\n+  s-thrini.ads<2sthrini.ads \\\n+  s-thrini.adb<5zthrini.adb \\\n+  s-tiitho.adb<5ytiitho.adb \\\n   s-tpopsp.adb<5ztpopsp.adb \\\n   s-vxwork.ads<5pvxwork.ads \\\n   g-soccon.ads<3zsoccon.ads \\\n@@ -640,8 +644,8 @@ ifeq ($(strip $(filter-out powerpc% wrs vxworksae,$(targ))),)\n \n   EXTRA_RAVEN_SOURCES=i-vxwork.ads s-vxwork.ads\n   EXTRA_RAVEN_OBJS=i-vxwork.o s-vxwork.o\n-  EXTRA_GNATRTL_NONTASKING_OBJS=i-vxwork.o i-vxwoio.o\n-  EXTRA_GNATRTL_TASKING_OBJS=i-vthrea.o s-tpae65.o s-vxwork.o\n+  EXTRA_GNATRTL_NONTASKING_OBJS=i-vxwork.o i-vxwoio.o s-thread.o s-thrini.o\n+  EXTRA_GNATRTL_TASKING_OBJS=s-vxwork.o\n   HIE_RAVEN_TARGET_PAIRS=\\\n   $(HIE_NONE_TARGET_PAIRS) \\\n   a-reatim.ads<1areatim.ads \\\n@@ -688,6 +692,7 @@ ifeq ($(strip $(filter-out powerpc% wrs vxworksae,$(targ))),)\n   s-soflin.ads<2ssoflin.ads \\\n   s-stalib.adb<1sstalib.adb \\\n   s-stalib.ads<1sstalib.ads \\\n+  s-thrini.adb<5zthrini.adb \\\n   s-thrini.ads<2sthrini.ads \\\n   s-thrini.adb<5zthrini.adb \\\n   s-tiitho.adb<5ytiitho.adb \\\n@@ -966,6 +971,25 @@ ifeq ($(strip $(filter-out %86 linux%,$(arch) $(osys))),)\n   endif\n endif\n \n+ifeq ($(strip $(filter-out %86 freebsd%,$(arch) $(osys))),)\n+  LIBGNAT_TARGET_PAIRS = \\\n+  a-intnam.ads<45intnam.ads \\\n+  g-soccon.ads<35soccon.ads \\\n+  s-inmaop.adb<7sinmaop.adb \\\n+  s-intman.adb<7sintman.adb \\\n+  s-mastop.adb<5omastop.adb \\\n+  s-osinte.adb<55osinte.adb \\\n+  s-osinte.ads<55osinte.ads \\\n+  s-osprim.adb<7sosprim.adb \\\n+  s-taprop.adb<7staprop.adb \\\n+  s-taspri.ads<7staspri.ads \\\n+  s-tpopsp.adb<7stpopsp.adb \\\n+  system.ads<56system.ads\n+\n+  THREADSLIB=\n+  LIBRARY_VERSION := $(strip $(shell grep Library_Version $(fsrcpfx)gnatvsn.ads | sed -e 's/.*GNAT Lib v\\(.*\\)[ \"].*/\\1/'))\n+endif\n+\n ifeq ($(strip $(filter-out mips sgi irix%,$(targ))),)\n   ifeq ($(strip $(filter-out mips sgi irix6%,$(targ))),)\n     LIBGNAT_TARGET_PAIRS = \\"}, {"sha": "bc4fb130be1a9b6bc60ac625770b29b41e40441b", "filename": "gcc/ada/atree.adb", "status": "modified", "additions": 29, "deletions": 23, "changes": 52, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/19f0526a54834612872e13e2650e9c1f8dface4f/gcc%2Fada%2Fatree.adb", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/19f0526a54834612872e13e2650e9c1f8dface4f/gcc%2Fada%2Fatree.adb", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fada%2Fatree.adb?ref=19f0526a54834612872e13e2650e9c1f8dface4f", "patch": "@@ -347,6 +347,35 @@ package body Atree is\n       Table_Increment      => Alloc.Orig_Nodes_Increment,\n       Table_Name           => \"Orig_Nodes\");\n \n+   ----------------------------------------\n+   -- Global_Variables for New_Copy_Tree --\n+   ----------------------------------------\n+\n+   --  These global variables are used by New_Copy_Tree. See description\n+   --  of the body of this subprogram for details. Global variables can be\n+   --  safely used by New_Copy_Tree, since there is no case of a recursive\n+   --  call from the processing inside New_Copy_Tree.\n+\n+   NCT_Hash_Threshhold : constant := 20;\n+   --  If there are more than this number of pairs of entries in the\n+   --  map, then Hash_Tables_Used will be set, and the hash tables will\n+   --  be initialized and used for the searches.\n+\n+   NCT_Hash_Tables_Used : Boolean := False;\n+   --  Set to True if hash tables are in use\n+\n+   NCT_Table_Entries : Nat;\n+   --  Count entries in table to see if threshhold is reached\n+\n+   NCT_Hash_Table_Setup : Boolean := False;\n+   --  Set to True if hash table contains data. We set this True if we\n+   --  setup the hash table with data, and leave it set permanently\n+   --  from then on, this is a signal that second and subsequent users\n+   --  of the hash table must clear the old entries before reuse.\n+\n+   subtype NCT_Header_Num is Int range 0 .. 511;\n+   --  Defines range of headers in hash tables (512 headers)\n+\n    -----------------------\n    -- Local Subprograms --\n    -----------------------\n@@ -959,29 +988,6 @@ package body Atree is\n    --  (because setting up a hash table for only a few entries takes\n    --  more time than it saves.\n \n-   --  Global variables are safe for this purpose, since there is no case\n-   --  of a recursive call from the processing inside New_Copy_Tree.\n-\n-   NCT_Hash_Threshhold : constant := 20;\n-   --  If there are more than this number of pairs of entries in the\n-   --  map, then Hash_Tables_Used will be set, and the hash tables will\n-   --  be initialized and used for the searches.\n-\n-   NCT_Hash_Tables_Used : Boolean := False;\n-   --  Set to True if hash tables are in use\n-\n-   NCT_Table_Entries : Nat;\n-   --  Count entries in table to see if threshhold is reached\n-\n-   NCT_Hash_Table_Setup : Boolean := False;\n-   --  Set to True if hash table contains data. We set this True if we\n-   --  setup the hash table with data, and leave it set permanently\n-   --  from then on, this is a signal that second and subsequent users\n-   --  of the hash table must clear the old entries before reuse.\n-\n-   subtype NCT_Header_Num is Int range 0 .. 511;\n-   --  Defines range of headers in hash tables (512 headers)\n-\n    function New_Copy_Hash (E : Entity_Id) return NCT_Header_Num;\n    --  Hash function used for hash operations\n "}, {"sha": "7bd01e6ac6d7b042b9ab21c838639f20538cc417", "filename": "gcc/ada/bld-io.adb", "status": "modified", "additions": 14, "deletions": 2, "changes": 16, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/19f0526a54834612872e13e2650e9c1f8dface4f/gcc%2Fada%2Fbld-io.adb", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/19f0526a54834612872e13e2650e9c1f8dface4f/gcc%2Fada%2Fbld-io.adb", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fada%2Fbld-io.adb?ref=19f0526a54834612872e13e2650e9c1f8dface4f", "patch": "@@ -6,7 +6,7 @@\n --                                                                          --\n --                                 B o d y                                  --\n --                                                                          --\n---        Copyright (C) 2002 Free Software Foundation, Inc.                 --\n+--        Copyright (C) 2002-2003 Free Software Foundation, Inc.            --\n --                                                                          --\n -- GNAT is free software;  you can  redistribute it  and/or modify it under --\n -- terms of the  GNU General Public License as published  by the Free Soft- --\n@@ -132,6 +132,7 @@ package body Bld.IO is\n    -----------\n \n    procedure Flush is\n+      Last : Natural;\n    begin\n       if Lines (Current).Length /= 0 then\n          Osint.Fail (\"INTERNAL ERROR: flushing before end of line: \"\"\" &\n@@ -141,7 +142,18 @@ package body Bld.IO is\n \n       for J in 1 .. Current - 1 loop\n          if not Lines (J).Suppressed then\n-            Text_IO.Put_Line (File, Lines (J).Value (1 .. Lines (J).Length));\n+            Last := Lines (J).Length;\n+\n+            --  The last character of a line cannot be a back slash ('\\'),\n+            --  otherwise make has a problem. The only real place were it\n+            --  should happen is for directory names on Windows, and then\n+            --  this terminal back slash is not needed.\n+\n+            if Last > 0 and then Lines (J).Value (Last) = '\\' then\n+               Last := Last - 1;\n+            end if;\n+\n+            Text_IO.Put_Line (File, Lines (J).Value (1 .. Last));\n          end if;\n       end loop;\n "}, {"sha": "d8cf51c6851e19e7dd056e927a317d15df0a64ba", "filename": "gcc/ada/bld.adb", "status": "modified", "additions": 7, "deletions": 7, "changes": 14, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/19f0526a54834612872e13e2650e9c1f8dface4f/gcc%2Fada%2Fbld.adb", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/19f0526a54834612872e13e2650e9c1f8dface4f/gcc%2Fada%2Fbld.adb", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fada%2Fbld.adb?ref=19f0526a54834612872e13e2650e9c1f8dface4f", "patch": "@@ -40,7 +40,7 @@ with GNAT.OS_Lib;               use GNAT.OS_Lib;\n \n with Erroutc;  use Erroutc;\n with Err_Vars; use Err_Vars;\n-with Gnatvsn;\n+with Gnatvsn;  use Gnatvsn;\n with Namet;    use Namet;\n with Opt;      use Opt;\n with Output;   use Output;\n@@ -1559,9 +1559,9 @@ package body Bld is\n                            Put (\"src.list_file:=\" &\n                                 \"$(strip $(shell gprcmd to_absolute $(\");\n                            Put (Project_Name);\n-                           Put (\".base_dir) $(\");\n+                           Put (\".base_dir) '$(\");\n                            Put_Attribute (Project, Pkg, Item_Name, No_Name);\n-                           Put_Line (\")))\");\n+                           Put_Line (\")'))\");\n \n                            if In_Case then\n                               if Source_List_File_Declaration = False then\n@@ -1595,9 +1595,9 @@ package body Bld is\n                            Put (\".obj_dir:=\" &\n                                 \"$(strip $(shell gprcmd to_absolute $(\");\n                            Put (Project_Name);\n-                           Put (\".base_dir) $(\");\n+                           Put (\".base_dir) '$(\");\n                            Put_Attribute (Project, Pkg, Item_Name, No_Name);\n-                           Put_Line (\")))\");\n+                           Put_Line (\")'))\");\n \n                         elsif Item_Name = Snames.Name_Exec_Dir then\n \n@@ -1611,9 +1611,9 @@ package body Bld is\n                            Put (\"EXEC_DIR:=\" &\n                                 \"$(strip $(shell gprcmd to_absolute $(\");\n                            Put (Project_Name);\n-                           Put (\".base_dir) $(\");\n+                           Put (\".base_dir) '$(\");\n                            Put_Attribute (Project, Pkg, Item_Name, No_Name);\n-                           Put_Line (\")))\");\n+                           Put_Line (\")'))\");\n \n                         elsif Item_Name = Snames.Name_Main then\n "}, {"sha": "07aa13fa4069d63f82d66552a28a3fcda448c5a4", "filename": "gcc/ada/einfo.ads", "status": "modified", "additions": 7, "deletions": 4, "changes": 11, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/19f0526a54834612872e13e2650e9c1f8dface4f/gcc%2Fada%2Feinfo.ads", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/19f0526a54834612872e13e2650e9c1f8dface4f/gcc%2Fada%2Feinfo.ads", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fada%2Feinfo.ads?ref=19f0526a54834612872e13e2650e9c1f8dface4f", "patch": "@@ -1162,6 +1162,9 @@ package Einfo is\n --       types, i.e. record types (Java classes) that hold pointers to each\n --       other. If such a type is an access type, it has no explicit freeze\n --       node, so that the back-end does not attempt to elaborate it.\n+--       Currently this flag is also used to implement Ada0Y (AI-50217).\n+--       It will be renamed to From_Limited_With after removal of the current\n+--       GNAT with_type clause???\n \n --    Full_View (Node11)\n --       Present in all type and subtype entities and in deferred constants.\n@@ -2385,7 +2388,7 @@ package Einfo is\n --       Present in non-generic package entities that are not instances.\n --       The elements of this list are the shadow entities created for the\n --       types and local packages that are declared in a package that appears\n---       in a limited_with clause.\n+--       in a limited_with clause (Ada0Y: AI-50217)\n \n --    Lit_Indexes (Node15)\n --       Present in enumeration types and subtypes. Non-empty only for the\n@@ -2554,9 +2557,9 @@ package Einfo is\n --       is other than a power of 2.\n \n --    Non_Limited_View (Node17)\n---       Present in incomplete types that are the shadow entities\n---       created when analyzing a limited_with_clause. Points to the\n---       definining entity in the original declaration.\n+--       Present in incomplete types that are the shadow entities created\n+--       when analyzing a limited_with_clause (Ada0Y: AI-50217). Points to\n+--       the defining entity in the original declaration.\n \n --    Nonzero_Is_True (Flag162) [base type only]\n --       Present in enumeration types. True if any non-zero value is to be"}, {"sha": "fb1cc76909a9357de2c307537f161b97c580e579", "filename": "gcc/ada/errout.adb", "status": "modified", "additions": 2, "deletions": 2, "changes": 4, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/19f0526a54834612872e13e2650e9c1f8dface4f/gcc%2Fada%2Ferrout.adb", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/19f0526a54834612872e13e2650e9c1f8dface4f/gcc%2Fada%2Ferrout.adb", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fada%2Ferrout.adb?ref=19f0526a54834612872e13e2650e9c1f8dface4f", "patch": "@@ -1409,11 +1409,11 @@ package body Errout is\n          Warnings.Table (Warnings.Last).Stop  := Source_Ptr'Last;\n       end if;\n \n-      --  Set all (???) the error nodes to Empty:\n+      --  Set the error nodes to Empty to avoid uninitialized variable\n+      --  references for saves/restores/moves.\n \n       Error_Msg_Node_1 := Empty;\n       Error_Msg_Node_2 := Empty;\n-\n    end Initialize;\n \n    -----------------"}, {"sha": "cf24a629f175b8daa153a7332661d08e2c46f52c", "filename": "gcc/ada/exp_aggr.adb", "status": "modified", "additions": 9, "deletions": 6, "changes": 15, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/19f0526a54834612872e13e2650e9c1f8dface4f/gcc%2Fada%2Fexp_aggr.adb", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/19f0526a54834612872e13e2650e9c1f8dface4f/gcc%2Fada%2Fexp_aggr.adb", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fada%2Fexp_aggr.adb?ref=19f0526a54834612872e13e2650e9c1f8dface4f", "patch": "@@ -71,8 +71,8 @@ package body Exp_Aggr is\n    --  sorted order.\n \n    function Has_Default_Init_Comps (N : Node_Id) return Boolean;\n-   --  N is an aggregate (record or array). Checks the presence of\n-   --  default initialization (<>) in any component.\n+   --  N is an aggregate (record or array). Checks the presence of default\n+   --  initialization (<>) in any component (Ada0Y: AI-287)\n \n    ------------------------------------------------------\n    -- Local subprograms for Record Aggregate Expansion --\n@@ -1540,8 +1540,8 @@ package body Exp_Aggr is\n              Selector_Name => Make_Identifier (Loc, Name_uController));\n          Set_Assignment_OK (Ref);\n \n-         --  Give support to default initialization of limited types and\n-         --  components\n+         --  Ada0Y (AI-287): Give support to default initialization of limited\n+         --  types and components\n \n          if (Nkind (Target) = N_Identifier\n              and then Is_Limited_Type (Etype (Target)))\n@@ -1678,8 +1678,8 @@ package body Exp_Aggr is\n                   Check_Ancestor_Discriminants (Entity (A));\n                end if;\n \n-            --  If the ancestor part is a limited type, a recursive call\n-            --  expands the ancestor.\n+            --  Ada0Y (AI-287): If the ancestor part is a limited type, a\n+            --  recursive call expands the ancestor.\n \n             elsif Is_Limited_Type (Etype (A)) then\n                Ancestor_Is_Expression := True;\n@@ -4145,6 +4145,9 @@ package body Exp_Aggr is\n       then\n          Convert_To_Assignments (N, Typ);\n \n+      --  Ada0Y (AI-287): In case of default initialized components we convert\n+      --  the aggregate into assignments.\n+\n       elsif Has_Default_Init_Comps (N) then\n          Convert_To_Assignments (N, Typ);\n "}, {"sha": "15730c7d2bf8d7c97897ecc99f8085678fa74d69", "filename": "gcc/ada/exp_ch6.adb", "status": "modified", "additions": 22, "deletions": 1, "changes": 23, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/19f0526a54834612872e13e2650e9c1f8dface4f/gcc%2Fada%2Fexp_ch6.adb", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/19f0526a54834612872e13e2650e9c1f8dface4f/gcc%2Fada%2Fexp_ch6.adb", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fada%2Fexp_ch6.adb?ref=19f0526a54834612872e13e2650e9c1f8dface4f", "patch": "@@ -541,7 +541,28 @@ package body Exp_Ch6 is\n \n          if Nkind (Actual) = N_Type_Conversion then\n             V_Typ := Etype (Expression (Actual));\n-            Var   := Make_Var (Expression (Actual));\n+\n+            --  If the formal is an (in-)out parameter, capture the name\n+            --  of the variable in order to build the post-call assignment.\n+            --  The variable itself may have been expanded, for example if\n+            --  it is a complex bit-packed array, so we need to recover the\n+            --  original to ensure that we have the proper target for the\n+            --  assignment. Examine the slocs of the two nodes to determine\n+            --  whether the rewriting is an expansion, or a substitution done\n+            --  on an inlined body, in which case it must be respected.\n+\n+            declare\n+               Orig : constant Node_Id := Original_Node (Expression (Actual));\n+            begin\n+               if Orig /= Expression (Actual)\n+                 and then Sloc (Orig) = Sloc (Expression (Actual))\n+               then\n+                  Var := Make_Var (Orig);\n+               else\n+                  Var := Make_Var (Expression (Actual));\n+               end if;\n+            end;\n+\n             Crep  := not Same_Representation\n                        (Etype (Formal), Etype (Expression (Actual)));\n          else"}, {"sha": "0e1af2ae9683263c46ea4998b6fc728622583cfe", "filename": "gcc/ada/g-os_lib.ads", "status": "modified", "additions": 9, "deletions": 3, "changes": 12, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/19f0526a54834612872e13e2650e9c1f8dface4f/gcc%2Fada%2Fg-os_lib.ads", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/19f0526a54834612872e13e2650e9c1f8dface4f/gcc%2Fada%2Fg-os_lib.ads", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fada%2Fg-os_lib.ads?ref=19f0526a54834612872e13e2650e9c1f8dface4f", "patch": "@@ -416,15 +416,21 @@ pragma Elaborate_Body (OS_Lib);\n \n    function Is_Absolute_Path (Name : String) return Boolean;\n    --  Returns True if Name is an absolute path name, i.e. it designates\n-   --  a directory absolutely, rather than relative to another directory.\n+   --  a file or a directory absolutely, rather than relative to another\n+   --  directory.\n \n    function Is_Regular_File (Name : String) return Boolean;\n    --  Determines if the given string, Name, is the name of an existing\n-   --  regular file. Returns True if so, False otherwise.\n+   --  regular file. Returns True if so, False otherwise. Name may be an\n+   --  absolute path name or a relative path name, including a simple file\n+   --  name. If it is a relative path name, it is relative to the current\n+   --  working directory.\n \n    function Is_Directory (Name : String) return Boolean;\n    --  Determines if the given string, Name, is the name of a directory.\n-   --  Returns True if so, False otherwise.\n+   --  Returns True if so, False otherwise. Name may be an absolute path\n+   --  name or a relative path name, including a simple file name. If it is\n+   --  a relative path name, it is relative to the current working directory.\n \n    function Is_Readable_File (Name : String) return Boolean;\n    --  Determines if the given string, Name, is the name of an existing"}, {"sha": "8deca2e1873f4484355dc2b68d667d112666d1a0", "filename": "gcc/ada/gnatmem.adb", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/19f0526a54834612872e13e2650e9c1f8dface4f/gcc%2Fada%2Fgnatmem.adb", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/19f0526a54834612872e13e2650e9c1f8dface4f/gcc%2Fada%2Fgnatmem.adb", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fada%2Fgnatmem.adb?ref=19f0526a54834612872e13e2650e9c1f8dface4f", "patch": "@@ -228,7 +228,7 @@ procedure Gnatmem is\n    procedure Usage is\n    begin\n       New_Line;\n-      Put (\"GNATMEM Pro \");\n+      Put (\"GNATMEM \");\n       Put (Gnat_Version_String);\n       Put_Line (\" Copyright 1997-2003 Free Software Foundation, Inc.\");\n       New_Line;"}, {"sha": "a15cb6df732b5448b4efbbde86cb2270fd16d43e", "filename": "gcc/ada/gnatsym.adb", "status": "modified", "additions": 55, "deletions": 21, "changes": 76, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/19f0526a54834612872e13e2650e9c1f8dface4f/gcc%2Fada%2Fgnatsym.adb", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/19f0526a54834612872e13e2650e9c1f8dface4f/gcc%2Fada%2Fgnatsym.adb", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fada%2Fgnatsym.adb?ref=19f0526a54834612872e13e2650e9c1f8dface4f", "patch": "@@ -37,7 +37,9 @@\n --  only on OpenVMS.\n \n --  gnatsym takes as parameters:\n---    - the name of the symbol file to create or update\n+--    - the name of the symbol file to create\n+--    - (optional) the policy to create the symbol file\n+--    - (optional) the name of the reference symbol file\n --    - the names of one or more object files where the symbols are found\n \n with GNAT.Command_Line; use GNAT.Command_Line;\n@@ -52,23 +54,32 @@ with Table;\n \n procedure Gnatsym is\n \n+   Empty_String : aliased String := \"\";\n+   Empty : constant String_Access := Empty_String'Unchecked_Access;\n+   --  To initialize variables Reference and Version_String\n+\n    Copyright_Displayed : Boolean := False;\n    --  A flag to prevent multiple display of the Copyright notice\n \n    Success : Boolean := True;\n \n-   Force : Boolean := False;\n-   --  True when -f switcxh is used\n+   Symbol_Policy : Policy := Autonomous;\n \n    Verbose : Boolean := False;\n    --  True when -v switch is used\n \n    Quiet : Boolean := False;\n    --  True when -q switch is used\n \n-   Symbol_File_Name : String_Access;\n+   Symbol_File_Name : String_Access := null;\n    --  The name of the symbol file\n \n+   Reference_Symbol_File_Name : String_Access := Empty;\n+   --  The name of the reference symbol file\n+\n+   Version_String : String_Access := Empty;\n+   --  The version of the library. Used on VMS.\n+\n    package Object_Files is new Table.Table\n      (Table_Component_Type => String_Access,\n       Table_Index_Type     => Natural,\n@@ -113,19 +124,32 @@ procedure Gnatsym is\n    procedure Parse_Cmd_Line is\n    begin\n       loop\n-         case GNAT.Command_Line.Getopt (\"f q v\") is\n+         case GNAT.Command_Line.Getopt (\"c C q r: s: v V:\") is\n             when ASCII.NUL =>\n                exit;\n \n-            when 'f' =>\n-               Force := True;\n+            when 'c' =>\n+               Symbol_Policy := Compliant;\n+\n+            when 'C' =>\n+               Symbol_Policy := Controlled;\n \n             when 'q' =>\n                Quiet := True;\n \n+            when 'r' =>\n+               Reference_Symbol_File_Name :=\n+                 new String'(GNAT.Command_Line.Parameter);\n+\n+            when 's' =>\n+               Symbol_File_Name := new String'(GNAT.Command_Line.Parameter);\n+\n             when 'v' =>\n                Verbose := True;\n \n+            when 'V' =>\n+               Version_String := new String'(GNAT.Command_Line.Parameter);\n+\n             when others =>\n                Fail (\"invalid switch: \", Full_Switch);\n          end case;\n@@ -141,13 +165,8 @@ procedure Gnatsym is\n          begin\n             exit when S'Length = 0;\n \n-            if Symbol_File_Name = null then\n-               Symbol_File_Name := S;\n-\n-            else\n-               Object_Files.Increment_Last;\n-               Object_Files.Table (Object_Files.Last) := S;\n-            end if;\n+            Object_Files.Increment_Last;\n+            Object_Files.Table (Object_Files.Last) := S;\n          end;\n       end loop;\n    exception\n@@ -162,11 +181,17 @@ procedure Gnatsym is\n \n    procedure Usage is\n    begin\n-      Write_Line (\"gnatsym [options] sym_file object_file {object_file}\");\n+      Write_Line (\"gnatsym [options] object_file {object_file}\");\n       Write_Eol;\n-      Write_Line (\"   -f  Force generation of symbol file\");\n-      Write_Line (\"   -q  Quiet mode\");\n-      Write_Line (\"   -v  Verbose mode\");\n+      Write_Line (\"   -c       Compliant policy\");\n+      Write_Line (\"   -C       Controlled policy\");\n+      Write_Line (\"   -q       Quiet mode\");\n+      Write_Line (\"   -r<ref>  Reference symbol file name\");\n+      Write_Line (\"   -s<sym>  Symbol file name\");\n+      Write_Line (\"   -v       Verbose mode\");\n+      Write_Line (\"   -V<ver>  Version\");\n+      Write_Eol;\n+      Write_Line (\"Specifying a symbol file with -s<sym> is compulsory\");\n       Write_Eol;\n    end Usage;\n \n@@ -188,7 +213,7 @@ begin\n    --  If there is no symbol file or no object files on the command line,\n    --  display the usage and exit with an error status.\n \n-   if Object_Files.Last = 0 then\n+   if Symbol_File_Name = null or else Object_Files.Last = 0 then\n       Usage;\n       OS_Exit (1);\n \n@@ -199,9 +224,16 @@ begin\n          Write_Line (\"\"\"\");\n       end if;\n \n-      --  Initialize the symbol file\n+      --  Initialize the symbol file and, if specified, read the reference\n+      --  file.\n \n-      Symbols.Initialize (Symbol_File_Name.all, Force, Quiet, Success);\n+      Symbols.Initialize\n+        (Symbol_File   => Symbol_File_Name.all,\n+         Reference     => Reference_Symbol_File_Name.all,\n+         Symbol_Policy => Symbol_Policy,\n+         Quiet         => Quiet,\n+         Version       => Version_String.all,\n+         Success       => Success);\n \n       --  Process the object files in order. Stop as soon as there is\n       --  something wrong.\n@@ -232,6 +264,8 @@ begin\n          Finalize (Quiet, Success);\n       end if;\n \n+      --  Fail if there was anything wrong\n+\n       if not Success then\n          Fail (\"unable to build symbol file\");\n       end if;"}, {"sha": "0757f47f0adc35c812cbe2eb98a9513f3f0969ef", "filename": "gcc/ada/gprcmd.adb", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/19f0526a54834612872e13e2650e9c1f8dface4f/gcc%2Fada%2Fgprcmd.adb", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/19f0526a54834612872e13e2650e9c1f8dface4f/gcc%2Fada%2Fgprcmd.adb", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fada%2Fgprcmd.adb?ref=19f0526a54834612872e13e2650e9c1f8dface4f", "patch": "@@ -55,7 +55,7 @@ procedure Gprcmd is\n \n    Version : constant String :=\n                \"GPRCMD \" & Gnatvsn.Gnat_Version_String &\n-               \" Copyright 2002-2003, Ada Core Technologies Inc.\";\n+               \" Copyright 2002-2003, Free Software Fundation, Inc.\";\n \n    procedure Cat (File : String);\n    --  Print the contents of file on standard output."}, {"sha": "015c92e76e0c0310e910ebc26ded3c7ad16fca88", "filename": "gcc/ada/lib-load.adb", "status": "modified", "additions": 2, "deletions": 2, "changes": 4, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/19f0526a54834612872e13e2650e9c1f8dface4f/gcc%2Fada%2Flib-load.adb", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/19f0526a54834612872e13e2650e9c1f8dface4f/gcc%2Fada%2Flib-load.adb", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fada%2Flib-load.adb?ref=19f0526a54834612872e13e2650e9c1f8dface4f", "patch": "@@ -519,8 +519,8 @@ package body Lib.Load is\n          --  legitimately occurs (e.g. two package bodies that contain\n          --  inlined subprogram referenced by the other).\n \n-         --  We also ignore limited_with clauses, because their purpose is\n-         --  precisely to create legal circular structures.\n+         --  Ada0Y (AI-50217): We also ignore limited_with clauses, because\n+         --  their purpose is precisely to create legal circular structures.\n \n          if Loading (Unum)\n            and then (Is_Spec_Name (Units.Table (Unum).Unit_Name)"}, {"sha": "fcb5f193778991c2e60be076e1c5d601baed6d3d", "filename": "gcc/ada/lib-writ.adb", "status": "modified", "additions": 2, "deletions": 1, "changes": 3, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/19f0526a54834612872e13e2650e9c1f8dface4f/gcc%2Fada%2Flib-writ.adb", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/19f0526a54834612872e13e2650e9c1f8dface4f/gcc%2Fada%2Flib-writ.adb", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fada%2Flib-writ.adb?ref=19f0526a54834612872e13e2650e9c1f8dface4f", "patch": "@@ -214,7 +214,8 @@ package body Lib.Writ is\n          Item := First (Context_Items (Cunit));\n          while Present (Item) loop\n \n-            --  limited_with_clauses do not create dependencies.\n+            --  Ada0Y (AI-50217): limited with_clauses do not create\n+            --  dependencies\n \n             if Nkind (Item) = N_With_Clause\n                and then not (Limited_Present (Item))"}, {"sha": "c1c45c5ba6979e0460b3cc0604bff507964cb094", "filename": "gcc/ada/mlib-prj.adb", "status": "modified", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/19f0526a54834612872e13e2650e9c1f8dface4f/gcc%2Fada%2Fmlib-prj.adb", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/19f0526a54834612872e13e2650e9c1f8dface4f/gcc%2Fada%2Fmlib-prj.adb", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fada%2Fmlib-prj.adb?ref=19f0526a54834612872e13e2650e9c1f8dface4f", "patch": "@@ -1313,6 +1313,7 @@ package body MLib.Prj is\n                   Interfaces    => Arguments (1 .. Argument_Number),\n                   Lib_Filename  => Lib_Filename.all,\n                   Lib_Dir       => Lib_Dirpath.all,\n+                  Symbol_Data   => Data.Symbol_Data,\n                   Driver_Name   => Driver_Name,\n                   Lib_Address   => DLL_Address.all,\n                   Lib_Version   => Lib_Version.all,"}, {"sha": "d8e280a706cd08d34f4cfc070297eb43b65ae242", "filename": "gcc/ada/mlib-tgt.adb", "status": "modified", "additions": 2, "deletions": 0, "changes": 2, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/19f0526a54834612872e13e2650e9c1f8dface4f/gcc%2Fada%2Fmlib-tgt.adb", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/19f0526a54834612872e13e2650e9c1f8dface4f/gcc%2Fada%2Fmlib-tgt.adb", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fada%2Fmlib-tgt.adb?ref=19f0526a54834612872e13e2650e9c1f8dface4f", "patch": "@@ -79,6 +79,7 @@ package body MLib.Tgt is\n       Interfaces   : Argument_List;\n       Lib_Filename : String;\n       Lib_Dir      : String;\n+      Symbol_Data  : Symbol_Record;\n       Driver_Name  : Name_Id := No_Name;\n       Lib_Address  : String  := \"\";\n       Lib_Version  : String  := \"\";\n@@ -92,6 +93,7 @@ package body MLib.Tgt is\n       pragma Unreferenced (Interfaces);\n       pragma Unreferenced (Lib_Filename);\n       pragma Unreferenced (Lib_Dir);\n+      pragma Unreferenced (Symbol_Data);\n       pragma Unreferenced (Driver_Name);\n       pragma Unreferenced (Lib_Address);\n       pragma Unreferenced (Lib_Version);"}, {"sha": "1fac4efe3fccdb20b6ee87579b5f339a3b5d4ca7", "filename": "gcc/ada/mlib-tgt.ads", "status": "modified", "additions": 16, "deletions": 5, "changes": 21, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/19f0526a54834612872e13e2650e9c1f8dface4f/gcc%2Fada%2Fmlib-tgt.ads", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/19f0526a54834612872e13e2650e9c1f8dface4f/gcc%2Fada%2Fmlib-tgt.ads", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fada%2Fmlib-tgt.ads?ref=19f0526a54834612872e13e2650e9c1f8dface4f", "patch": "@@ -113,6 +113,7 @@ package MLib.Tgt is\n       Interfaces   : Argument_List;\n       Lib_Filename : String;\n       Lib_Dir      : String;\n+      Symbol_Data  : Symbol_Record;\n       Driver_Name  : Name_Id := No_Name;\n       Lib_Address  : String  := \"\";\n       Lib_Version  : String  := \"\";\n@@ -125,23 +126,33 @@ package MLib.Tgt is\n    --  Afiles is the list of ALI files for the Ada object files.\n    --  Options is a list of options to be passed to the tool (gcc or other)\n    --  that effectively builds the dynamic library.\n+   --\n    --  Interfaces is the list of ALI files for the interfaces of a SAL.\n    --  It is empty if the library is not a SAL.\n+   --\n    --  Lib_Filename is the name of the library, without any prefix or\n    --  extension. For example, on Unix, if Lib_Filename is \"toto\", the name of\n    --  the library file will be \"libtoto.so\".\n+   --\n    --  Lib_Dir is the directory path where the library will be located.\n+   --\n    --  Lib_Address is the base address of the library for a non relocatable\n    --  library, given as an hexadecimal string.\n-   --  For OSes that support symbolic links, Lib_Version, if non null, is\n-   --  the actual file name of the library. For example on Unix,\n-   --  if Lib_Filename is \"toto\" and Lib_Version is \"libtoto.so.2.1\",\n-   --  \"libtoto.so\" will be a symbolic link to \"libtoto.so.2.1\" which will\n-   --  be the actual library file.\n+   --\n+   --  For OSes that support symbolic links, Lib_Version, if non null,\n+   --  is the actual file name of the library. For example on Unix, if\n+   --  Lib_Filename is \"toto\" and Lib_Version is \"libtoto.so.2.1\",\n+   --  \"libtoto.so\" will be a symbolic link to \"libtoto.so.2.1\" which\n+   --  will be the actual library file.\n+   --\n    --  Relocatable indicates if the library should be relocatable or not,\n    --  for those OSes that actually support non relocatable dynamic libraries.\n    --  Relocatable indicates that automatic elaboration/finalization must be\n    --  indicated to the linker, if possible.\n+   --\n+   --  Symbol_Data is used for some patforms, including VMS, to generate\n+   --  the symbols to be exported by the library.\n+   --\n    --  Note: Depending on the OS, some of the parameters may not be taken\n    --  into account. For example, on Linux, Foreign, Afiles Lib_Address and\n    --  Relocatable are ignored."}, {"sha": "8066aa77b96278a97156830c91bf0a0cc6097124", "filename": "gcc/ada/par-ch10.adb", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/19f0526a54834612872e13e2650e9c1f8dface4f/gcc%2Fada%2Fpar-ch10.adb", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/19f0526a54834612872e13e2650e9c1f8dface4f/gcc%2Fada%2Fpar-ch10.adb", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fada%2Fpar-ch10.adb?ref=19f0526a54834612872e13e2650e9c1f8dface4f", "patch": "@@ -782,7 +782,7 @@ package body Ch10 is\n \n          --  Processing for WITH clause\n \n-         --  First check for LIMITED WITH\n+         --  Ada0Y (AI-50217): First check for LIMITED WITH\n \n          if Token = Tok_Limited then\n             Has_Limited := True;"}, {"sha": "f560c8da6a2e295e07e610483fd2f6490ab29b64", "filename": "gcc/ada/par-ch4.adb", "status": "modified", "additions": 7, "deletions": 0, "changes": 7, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/19f0526a54834612872e13e2650e9c1f8dface4f/gcc%2Fada%2Fpar-ch4.adb", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/19f0526a54834612872e13e2650e9c1f8dface4f/gcc%2Fada%2Fpar-ch4.adb", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fada%2Fpar-ch4.adb?ref=19f0526a54834612872e13e2650e9c1f8dface4f", "patch": "@@ -1127,6 +1127,9 @@ package body Ch4 is\n \n    --  Error recovery: can raise Error_Resync\n \n+   --  Note: POSITIONAL_ARRAY_AGGREGATE rule has been extended to give support\n+   --        to Ada0Y limited aggregates (AI-287)\n+\n    function P_Aggregate_Or_Paren_Expr return Node_Id is\n       Aggregate_Node : Node_Id;\n       Expr_List      : List_Id;\n@@ -1373,6 +1376,10 @@ package body Ch4 is\n \n    --  Error recovery: can raise Error_Resync\n \n+   --  Note: RECORD_COMPONENT_ASSOCIATION and ARRAY_COMPONENT_ASSOCIATION\n+   --        rules have been extended to give support to Ada0Y limited\n+   --        aggregates (AI-287)\n+\n    function P_Record_Or_Array_Component_Association return Node_Id is\n       Assoc_Node : Node_Id;\n "}, {"sha": "8482fd2a2e38ea9a0b030e8abdc56caa3af4308d", "filename": "gcc/ada/prj-attr.adb", "status": "modified", "additions": 3, "deletions": 0, "changes": 3, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/19f0526a54834612872e13e2650e9c1f8dface4f/gcc%2Fada%2Fprj-attr.adb", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/19f0526a54834612872e13e2650e9c1f8dface4f/gcc%2Fada%2Fprj-attr.adb", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fada%2Fprj-attr.adb?ref=19f0526a54834612872e13e2650e9c1f8dface4f", "patch": "@@ -69,6 +69,9 @@ package body Prj.Attr is\n      \"LVlibrary_options#\" &\n      \"SVlibrary_src_dir#\" &\n      \"SVlibrary_gcc#\" &\n+     \"SVlibrary_symbol_file#\" &\n+     \"SVlibrary_symbol_policy#\" &\n+     \"SVlibrary_reference_symbol_file#\" &\n      \"LVmain#\" &\n      \"LVlanguages#\" &\n      \"SVmain_language#\" &"}, {"sha": "6089bea61ed252f381509f3781a3824cfddc2461", "filename": "gcc/ada/prj-nmsc.adb", "status": "modified", "additions": 251, "deletions": 80, "changes": 331, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/19f0526a54834612872e13e2650e9c1f8dface4f/gcc%2Fada%2Fprj-nmsc.adb", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/19f0526a54834612872e13e2650e9c1f8dface4f/gcc%2Fada%2Fprj-nmsc.adb", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fada%2Fprj-nmsc.adb?ref=19f0526a54834612872e13e2650e9c1f8dface4f", "patch": "@@ -1350,16 +1350,32 @@ package body Prj.Nmsc is\n                               (Snames.Name_Library_Src_Dir,\n                                Data.Decl.Attributes);\n \n-            Auto_Init_Supported\n-                           : constant Boolean :=\n-                               MLib.Tgt.\n-                                 Standalone_Library_Auto_Init_Is_Supported;\n+            Lib_Symbol_File : constant Prj.Variable_Value :=\n+                                Prj.Util.Value_Of\n+                                  (Snames.Name_Library_Symbol_File,\n+                                   Data.Decl.Attributes);\n+\n+            Lib_Symbol_Policy : constant Prj.Variable_Value :=\n+                                  Prj.Util.Value_Of\n+                                    (Snames.Name_Library_Symbol_Policy,\n+                                     Data.Decl.Attributes);\n+\n+            Lib_Ref_Symbol_File : constant Prj.Variable_Value :=\n+                                  Prj.Util.Value_Of\n+                                    (Snames.Name_Library_Reference_Symbol_File,\n+                                     Data.Decl.Attributes);\n+\n+            Auto_Init_Supported : constant Boolean :=\n+                                    MLib.Tgt.\n+                                     Standalone_Library_Auto_Init_Is_Supported;\n+\n+            OK : Boolean := True;\n \n          begin\n             pragma Assert (Lib_Interfaces.Kind = List);\n \n-            --  It is a library project file if attribute Library_Interface\n-            --  is defined.\n+            --  It is a stand-alone library project file if attribute\n+            --  Library_Interface is defined.\n \n             if not Lib_Interfaces.Default then\n                declare\n@@ -1566,102 +1582,257 @@ package body Prj.Nmsc is\n                            Lib_Auto_Init.Location);\n                      end if;\n                   end if;\n+               end;\n \n-                  if Lib_Src_Dir.Value /= Empty_String then\n-                     declare\n-                        Dir_Id : constant Name_Id := Lib_Src_Dir.Value;\n+               --  If attribute Library_Src_Dir is defined and not the\n+               --  empty string, check if the directory exist and is not\n+               --  the object directory or one of the source directories.\n+               --  This is the directory where copies of the interface\n+               --  sources will be copied. Note that this directory may be\n+               --  the library directory.\n \n-                     begin\n-                        Locate_Directory\n-                          (Dir_Id, Data.Display_Directory,\n-                           Data.Library_Src_Dir,\n-                           Data.Display_Library_Src_Dir);\n+               if Lib_Src_Dir.Value /= Empty_String then\n+                  declare\n+                     Dir_Id : constant Name_Id := Lib_Src_Dir.Value;\n \n-                        --  Comment needed here ???\n+                  begin\n+                     Locate_Directory\n+                       (Dir_Id, Data.Display_Directory,\n+                        Data.Library_Src_Dir,\n+                        Data.Display_Library_Src_Dir);\n \n-                        if Data.Library_Src_Dir = No_Name then\n+                     --  If directory does not exist, report an error\n \n-                           --  Get the absolute name of the library directory\n-                           --  that does not exist, to report an error.\n+                     if Data.Library_Src_Dir = No_Name then\n \n-                           declare\n-                              Dir_Name : constant String :=\n-                                           Get_Name_String (Dir_Id);\n-                           begin\n-                              if Is_Absolute_Path (Dir_Name) then\n-                                 Err_Vars.Error_Msg_Name_1 := Dir_Id;\n+                        --  Get the absolute name of the library directory\n+                        --  that does not exist, to report an error.\n \n-                              else\n-                                 Get_Name_String (Data.Directory);\n+                        declare\n+                           Dir_Name : constant String :=\n+                                        Get_Name_String (Dir_Id);\n \n-                                 if Name_Buffer (Name_Len) /=\n-                                    Directory_Separator\n-                                 then\n-                                    Name_Len := Name_Len + 1;\n-                                    Name_Buffer (Name_Len) :=\n-                                      Directory_Separator;\n-                                 end if;\n+                        begin\n+                           if Is_Absolute_Path (Dir_Name) then\n+                              Err_Vars.Error_Msg_Name_1 := Dir_Id;\n \n-                                 Name_Buffer\n-                                   (Name_Len + 1 ..\n-                                      Name_Len + Dir_Name'Length) :=\n-                                   Dir_Name;\n-                                 Name_Len := Name_Len + Dir_Name'Length;\n-                                 Err_Vars.Error_Msg_Name_1 := Name_Find;\n-                              end if;\n+                           else\n+                              Get_Name_String (Data.Directory);\n \n-                              --  Report the error\n+                              if Name_Buffer (Name_Len) /=\n+                                Directory_Separator\n+                              then\n+                                 Name_Len := Name_Len + 1;\n+                                 Name_Buffer (Name_Len) :=\n+                                   Directory_Separator;\n+                              end if;\n \n-                              Error_Msg\n-                                (Project,\n-                                 \"Directory { does not exist\",\n-                                 Lib_Src_Dir.Location);\n-                           end;\n+                              Name_Buffer\n+                                (Name_Len + 1 ..\n+                                   Name_Len + Dir_Name'Length) :=\n+                                  Dir_Name;\n+                              Name_Len := Name_Len + Dir_Name'Length;\n+                              Err_Vars.Error_Msg_Name_1 := Name_Find;\n+                           end if;\n \n-                        --  And comment needed here ???\n+                           --  Report the error\n \n-                        elsif Data.Library_Src_Dir = Data.Object_Directory then\n                            Error_Msg\n                              (Project,\n-                              \"directory to copy interfaces cannot be \" &\n-                              \"the object directory\",\n+                              \"Directory { does not exist\",\n                               Lib_Src_Dir.Location);\n-                           Data.Library_Src_Dir := No_Name;\n+                        end;\n \n-                        --  And comment needed here ???\n+                     --  Report an error if it is the same as the object\n+                     --  directory.\n \n-                        else\n-                           declare\n-                              Src_Dirs : String_List_Id := Data.Source_Dirs;\n-                              Src_Dir : String_Element;\n-                           begin\n-                              while Src_Dirs /= Nil_String loop\n-                                 Src_Dir := String_Elements.Table (Src_Dirs);\n-                                 Src_Dirs := Src_Dir.Next;\n-\n-                                 if Data.Library_Src_Dir = Src_Dir.Value then\n-                                    Error_Msg\n-                                      (Project,\n-                                       \"directory to copy interfaces cannot \" &\n-                                       \"be one of the source directories\",\n-                                       Lib_Src_Dir.Location);\n-                                    Data.Library_Src_Dir := No_Name;\n-                                    exit;\n-                                 end if;\n-                              end loop;\n-                           end;\n+                     elsif Data.Library_Src_Dir = Data.Object_Directory then\n+                        Error_Msg\n+                          (Project,\n+                           \"directory to copy interfaces cannot be \" &\n+                           \"the object directory\",\n+                           Lib_Src_Dir.Location);\n+                        Data.Library_Src_Dir := No_Name;\n \n-                           if Data.Library_Src_Dir /= No_Name\n-                             and then Current_Verbosity = High\n+                     --  Check if it is the same as one of the source\n+                     --  directories.\n+\n+                     else\n+                        declare\n+                           Src_Dirs : String_List_Id := Data.Source_Dirs;\n+                           Src_Dir  : String_Element;\n+\n+                        begin\n+                           while Src_Dirs /= Nil_String loop\n+                              Src_Dir := String_Elements.Table (Src_Dirs);\n+                              Src_Dirs := Src_Dir.Next;\n+\n+                              --  Report an error if it is one of the\n+                              --  source directories.\n+\n+                              if Data.Library_Src_Dir = Src_Dir.Value then\n+                                 Error_Msg\n+                                   (Project,\n+                                    \"directory to copy interfaces cannot \" &\n+                                    \"be one of the source directories\",\n+                                    Lib_Src_Dir.Location);\n+                                 Data.Library_Src_Dir := No_Name;\n+                                 exit;\n+                              end if;\n+                           end loop;\n+                        end;\n+\n+                        if Data.Library_Src_Dir /= No_Name\n+                          and then Current_Verbosity = High\n+                        then\n+                           Write_Str (\"Directory to copy interfaces =\"\"\");\n+                           Write_Str (Get_Name_String (Data.Library_Dir));\n+                           Write_Line (\"\"\"\");\n+                        end if;\n+                     end if;\n+                  end;\n+               end if;\n+\n+               if not Lib_Symbol_File.Default then\n+                  Data.Symbol_Data.Symbol_File := Lib_Symbol_File.Value;\n+\n+                  Get_Name_String (Lib_Symbol_File.Value);\n+\n+                  if Name_Len = 0 then\n+                     Error_Msg\n+                       (Project,\n+                        \"symbol file name cannot be an empty string\",\n+                        Lib_Symbol_File.Location);\n+\n+                  else\n+                     OK := not Is_Absolute_Path (Name_Buffer (1 .. Name_Len));\n+\n+                     if OK then\n+                        for J in 1 .. Name_Len loop\n+                           if Name_Buffer (J) = '/'\n+                             or else Name_Buffer (J) = Directory_Separator\n                            then\n-                              Write_Str (\"Directory to copy interfaces =\"\"\");\n-                              Write_Str (Get_Name_String (Data.Library_Dir));\n-                              Write_Line (\"\"\"\");\n+                              OK := False;\n+                              exit;\n                            end if;\n-                        end if;\n-                     end;\n+                        end loop;\n+                     end if;\n+\n+                     if not OK then\n+                        Error_Msg_Name_1 := Lib_Symbol_File.Value;\n+                        Error_Msg\n+                          (Project,\n+                           \"symbol file name { is illegal. \" &\n+                           \"Name canot include directory info.\",\n+                           Lib_Symbol_File.Location);\n+                     end if;\n                   end if;\n-               end;\n+               end if;\n+\n+               if not Lib_Symbol_Policy.Default then\n+                  declare\n+                     Value : constant String :=\n+                               To_Lower\n+                                 (Get_Name_String (Lib_Symbol_Policy.Value));\n+\n+                  begin\n+                     if Value = \"autonomous\" or else Value = \"default\" then\n+                        Data.Symbol_Data.Symbol_Policy := Autonomous;\n+\n+                     elsif Value = \"compliant\" then\n+                        Data.Symbol_Data.Symbol_Policy := Compliant;\n+\n+                     elsif Value = \"controlled\" then\n+                        Data.Symbol_Data.Symbol_Policy := Controlled;\n+\n+                     else\n+                        Error_Msg\n+                          (Project,\n+                           \"illegal value for Library_Symbol_Policy\",\n+                           Lib_Symbol_Policy.Location);\n+                     end if;\n+                  end;\n+               end if;\n+\n+               if Lib_Ref_Symbol_File.Default then\n+                  if Data.Symbol_Data.Symbol_Policy /= Autonomous then\n+                     Error_Msg\n+                       (Project,\n+                        \"a reference symbol file need to be defined\",\n+                        Lib_Symbol_Policy.Location);\n+                  end if;\n+\n+               else\n+                  Data.Symbol_Data.Reference := Lib_Ref_Symbol_File.Value;\n+\n+                  Get_Name_String (Lib_Symbol_File.Value);\n+\n+                  if Name_Len = 0 then\n+                     Error_Msg\n+                       (Project,\n+                        \"reference symbol file name cannot be an empty string\",\n+                        Lib_Symbol_File.Location);\n+\n+                  else\n+                     OK := not Is_Absolute_Path (Name_Buffer (1 .. Name_Len));\n+\n+                     if OK then\n+                        for J in 1 .. Name_Len loop\n+                           if Name_Buffer (J) = '/'\n+                             or else Name_Buffer (J) = Directory_Separator\n+                           then\n+                              OK := False;\n+                              exit;\n+                           end if;\n+                        end loop;\n+                     end if;\n+\n+                     if not OK then\n+                        Error_Msg_Name_1 := Lib_Ref_Symbol_File.Value;\n+                        Error_Msg\n+                          (Project,\n+                           \"reference symbol file { name is illegal. \" &\n+                           \"Name canot include directory info.\",\n+                           Lib_Ref_Symbol_File.Location);\n+                     end if;\n+\n+                     if not Is_Regular_File\n+                       (Get_Name_String (Data.Object_Directory) &\n+                        Directory_Separator &\n+                        Get_Name_String (Lib_Ref_Symbol_File.Value))\n+                     then\n+                        Error_Msg_Name_1 := Lib_Ref_Symbol_File.Value;\n+                        Error_Msg\n+                          (Project,\n+                           \"library reference symbol file { does not exist\",\n+                           Lib_Ref_Symbol_File.Location);\n+                     end if;\n+\n+                     if Data.Symbol_Data.Symbol_File /= No_Name then\n+                        declare\n+                           Symbol : String :=\n+                                      Get_Name_String\n+                                        (Data.Symbol_Data.Symbol_File);\n+\n+                           Reference : String :=\n+                                         Get_Name_String\n+                                           (Data.Symbol_Data.Reference);\n+\n+                        begin\n+                           Canonical_Case_File_Name (Symbol);\n+                           Canonical_Case_File_Name (Reference);\n+\n+                           if Symbol = Reference then\n+                              Error_Msg\n+                                (Project,\n+                                 \"reference symbol file and symbol file \" &\n+                                 \"cannot be the same file\",\n+                                 Lib_Ref_Symbol_File.Location);\n+                           end if;\n+                        end;\n+                     end if;\n+                  end if;\n+               end if;\n             end if;\n          end Standalone_Library;\n       end if;"}, {"sha": "fc817eabd6ea6e3ed4ddf639218434d40bfb43aa", "filename": "gcc/ada/prj.adb", "status": "modified", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/19f0526a54834612872e13e2650e9c1f8dface4f/gcc%2Fada%2Fprj.adb", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/19f0526a54834612872e13e2650e9c1f8dface4f/gcc%2Fada%2Fprj.adb", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fada%2Fprj.adb?ref=19f0526a54834612872e13e2650e9c1f8dface4f", "patch": "@@ -96,6 +96,7 @@ package body Prj is\n       Standalone_Library             => False,\n       Lib_Interface_ALIs             => Nil_String,\n       Lib_Auto_Init                  => False,\n+      Symbol_Data                    => No_Symbols,\n       Sources_Present                => True,\n       Sources                        => Nil_String,\n       Source_Dirs                    => Nil_String,"}, {"sha": "b323a86e1c0fa7ef889695c00102881997b0a144", "filename": "gcc/ada/prj.ads", "status": "modified", "additions": 18, "deletions": 0, "changes": 18, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/19f0526a54834612872e13e2650e9c1f8dface4f/gcc%2Fada%2Fprj.ads", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/19f0526a54834612872e13e2650e9c1f8dface4f/gcc%2Fada%2Fprj.ads", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fada%2Fprj.ads?ref=19f0526a54834612872e13e2650e9c1f8dface4f", "patch": "@@ -75,6 +75,21 @@ package Prj is\n \n    type Lib_Kind is (Static, Dynamic, Relocatable);\n \n+   type Policy is (Autonomous, Compliant, Controlled);\n+   --  See explaination about this type in package Symbol\n+\n+   type Symbol_Record is record\n+      Symbol_File   : Name_Id := No_Name;\n+      Reference     : Name_Id := No_Name;\n+      Symbol_Policy : Policy  := Autonomous;\n+   end record;\n+   --  Type to keep the symbol data to be used when building a shared library\n+\n+   No_Symbols : Symbol_Record :=\n+     (Symbol_File   => No_Name,\n+      Reference     => No_Name,\n+      Symbol_Policy => Autonomous);\n+\n    function Empty_String return Name_Id;\n \n    type Project_Id is new Nat;\n@@ -418,6 +433,9 @@ package Prj is\n       --  For non static Standalone Library Project Files, indicate if\n       --  the library initialisation should be automatic.\n \n+      Symbol_Data : Symbol_Record := No_Symbols;\n+      --  Symbol file name, reference symbol file name, symbol policy\n+\n       Sources_Present : Boolean := True;\n       --  A flag that indicates if there are sources in this project file.\n       --  There are no sources if 1) Source_Dirs is specified as an"}, {"sha": "4999e0bad3b2add99b58de800c2b9d521b34b2d5", "filename": "gcc/ada/rtsfind.adb", "status": "modified", "additions": 2, "deletions": 0, "changes": 2, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/19f0526a54834612872e13e2650e9c1f8dface4f/gcc%2Fada%2Frtsfind.adb", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/19f0526a54834612872e13e2650e9c1f8dface4f/gcc%2Fada%2Frtsfind.adb", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fada%2Frtsfind.adb?ref=19f0526a54834612872e13e2650e9c1f8dface4f", "patch": "@@ -258,6 +258,8 @@ package body Rtsfind is\n       for J in RE_Id loop\n          RE_Table (J) := Empty;\n       end loop;\n+\n+      RTE_Is_Available := False;\n    end Initialize;\n \n    ------------"}, {"sha": "369d46d0e84e14fb689422c95700f3987522f20b", "filename": "gcc/ada/s-thread.adb", "status": "modified", "additions": 12, "deletions": 54, "changes": 66, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/19f0526a54834612872e13e2650e9c1f8dface4f/gcc%2Fada%2Fs-thread.adb", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/19f0526a54834612872e13e2650e9c1f8dface4f/gcc%2Fada%2Fs-thread.adb", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fada%2Fs-thread.adb?ref=19f0526a54834612872e13e2650e9c1f8dface4f", "patch": "@@ -31,88 +31,59 @@\n --                                                                          --\n ------------------------------------------------------------------------------\n \n---  This is the VxWorks version of this package\n-\n-pragma Restrictions (No_Tasking);\n---  The VxWorks version of this package is intended only for programs\n---  which do not use Ada tasking. This restriction ensures that this\n---  will be checked by the binder.\n-\n-with System.Secondary_Stack;\n+--  This is a dummy version of this package.\n \n with Unchecked_Conversion;\n \n with System.Threads.Initialization;\n \n package body System.Threads is\n \n-   package SSS renames System.Secondary_Stack;\n-\n-   Current_ATSD  : aliased System.Address := System.Null_Address;\n-   pragma Export (C, Current_ATSD, \"__gnat_current_atsd\");\n-\n-   function From_Address is\n-      new Unchecked_Conversion (Address, ATSD_Access);\n-\n-   procedure Init_Float;\n-   pragma Import (C, Init_Float, \"__gnat_init_float\");\n-\n-   procedure Install_Handler;\n-   pragma Import (C, Install_Handler, \"__gnat_install_handler\");\n-\n    -----------------------\n    -- Get_Current_Excep --\n    -----------------------\n \n    function Get_Current_Excep return EOA is\n-      CTSD : ATSD_Access := From_Address (Current_ATSD);\n    begin\n-      pragma Assert (Current_ATSD /= System.Null_Address);\n-      return CTSD.Current_Excep'Access;\n+      return null;\n    end Get_Current_Excep;\n \n    ------------------------\n    -- Get_Jmpbuf_Address --\n    ------------------------\n \n    function  Get_Jmpbuf_Address return  Address is\n-      CTSD : ATSD_Access := From_Address (Current_ATSD);\n    begin\n-      pragma Assert (Current_ATSD /= System.Null_Address);\n-      return CTSD.Jmpbuf_Address;\n+      return Null_Address;\n    end Get_Jmpbuf_Address;\n \n    ------------------------\n    -- Get_Sec_Stack_Addr --\n    ------------------------\n \n    function  Get_Sec_Stack_Addr return  Address is\n-      CTSD : ATSD_Access := From_Address (Current_ATSD);\n    begin\n-      pragma Assert (Current_ATSD /= System.Null_Address);\n-      return CTSD.Sec_Stack_Addr;\n+      return Null_Address;\n    end Get_Sec_Stack_Addr;\n \n    ------------------------\n    -- Set_Jmpbuf_Address --\n    ------------------------\n \n    procedure Set_Jmpbuf_Address (Addr : Address) is\n-      CTSD : ATSD_Access := From_Address (Current_ATSD);\n+      pragma Unreferenced (Addr);\n    begin\n-      pragma Assert (Current_ATSD /= System.Null_Address);\n-      CTSD.Jmpbuf_Address := Addr;\n+      null;\n    end Set_Jmpbuf_Address;\n \n    ------------------------\n    -- Set_Sec_Stack_Addr --\n    ------------------------\n \n    procedure Set_Sec_Stack_Addr (Addr : Address) is\n-      CTSD : ATSD_Access := From_Address (Current_ATSD);\n+      pragma Unreferenced (Addr);\n    begin\n-      pragma Assert (Current_ATSD /= System.Null_Address);\n-      CTSD.Sec_Stack_Addr := Addr;\n+      null;\n    end Set_Sec_Stack_Addr;\n \n    -----------------------\n@@ -124,18 +95,11 @@ package body System.Threads is\n       Sec_Stack_Size       : Natural;\n       Process_ATSD_Address : System.Address)\n    is\n-      --  Current_ATSD must already be a taskVar of taskIdSelf.\n-      --  No assertion because taskVarGet is not available on VxWorks/CERT\n-\n-      TSD : ATSD_Access := From_Address (Process_ATSD_Address);\n-\n+      pragma Unreferenced (Sec_Stack_Address);\n+      pragma Unreferenced (Sec_Stack_Size);\n+      pragma Unreferenced (Process_ATSD_Address);\n    begin\n-      TSD.Sec_Stack_Addr := Sec_Stack_Address;\n-      SSS.SS_Init (TSD.Sec_Stack_Addr, Sec_Stack_Size);\n-      Current_ATSD := Process_ATSD_Address;\n-\n-      Install_Handler;\n-      Init_Float;\n+      null;\n    end Thread_Body_Enter;\n \n    ----------------------------------\n@@ -147,8 +111,6 @@ package body System.Threads is\n    is\n       pragma Unreferenced (EO);\n    begin\n-      --  No action for this target\n-\n       null;\n    end Thread_Body_Exceptional_Exit;\n \n@@ -158,11 +120,7 @@ package body System.Threads is\n \n    procedure Thread_Body_Leave is\n    begin\n-      --  No action for this target\n-\n       null;\n    end Thread_Body_Leave;\n \n-begin\n-   System.Threads.Initialization.Init_RTS;\n end System.Threads;"}, {"sha": "cb9c2a34c0998a60f2f6086b06c6dc7030005851", "filename": "gcc/ada/sem_aggr.adb", "status": "modified", "additions": 31, "deletions": 15, "changes": 46, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/19f0526a54834612872e13e2650e9c1f8dface4f/gcc%2Fada%2Fsem_aggr.adb", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/19f0526a54834612872e13e2650e9c1f8dface4f/gcc%2Fada%2Fsem_aggr.adb", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fada%2Fsem_aggr.adb?ref=19f0526a54834612872e13e2650e9c1f8dface4f", "patch": "@@ -866,6 +866,8 @@ package body Sem_Aggr is\n          Error_Msg_N (\"aggregate type cannot have limited component\", N);\n          Explain_Limited_Type (Typ, N);\n \n+      --  Ada0Y (AI-287): Limited aggregates allowed\n+\n       elsif Is_Limited_Type (Typ)\n         and not Extensions_Allowed\n       then\n@@ -1915,12 +1917,17 @@ package body Sem_Aggr is\n          Error_Msg_N (\"type of extension aggregate must be tagged\", N);\n          return;\n \n-      elsif Is_Limited_Type (Typ)\n-        and not Extensions_Allowed\n-      then\n-         Error_Msg_N (\"aggregate type cannot be limited\", N);\n-         Explain_Limited_Type (Typ, N);\n-         return;\n+      elsif Is_Limited_Type (Typ) then\n+\n+         --  Ada0Y (AI-287): Limited aggregates are allowed\n+\n+         if Extensions_Allowed then\n+            null;\n+         else\n+            Error_Msg_N (\"aggregate type cannot be limited\", N);\n+            Explain_Limited_Type (Typ, N);\n+            return;\n+         end if;\n \n       elsif Is_Class_Wide_Type (Typ) then\n          Error_Msg_N (\"aggregate cannot be of a class-wide type\", N);\n@@ -2023,12 +2030,12 @@ package body Sem_Aggr is\n \n       Mbox_Present : Boolean := False;\n       Others_Mbox  : Boolean := False;\n-      --  Variables used in case of default initialization to provide a\n-      --  functionality similar to Others_Etype. Mbox_Present indicates\n-      --  that the component takes its default initialization; Others_Mbox\n-      --  indicates that at least one component takes its default initiali-\n-      --  zation. Similar to Others_Etype, they are also updated as a side\n-      --  effect of function Get_Value.\n+      --  Ada0Y (AI-287): Variables used in case of default initialization to\n+      --  provide a functionality similar to Others_Etype. Mbox_Present\n+      --  indicates that the component takes its default initialization;\n+      --  Others_Mbox indicates that at least one component takes its default\n+      --  initialization. Similar to Others_Etype, they are also updated as a\n+      --  side effect of function Get_Value.\n \n       procedure Add_Association\n         (Component   : Entity_Id;\n@@ -2212,6 +2219,7 @@ package body Sem_Aggr is\n                and then Comes_From_Source (Compon)\n                and then not In_Instance_Body\n             then\n+               --  Ada0Y (AI-287): Limited aggregates are allowed\n \n                if Extensions_Allowed\n                  and then Present (Expression (Assoc))\n@@ -2251,6 +2259,10 @@ package body Sem_Aggr is\n                      --  indispensable otherwise, because each one must be\n                      --  expanded individually to preserve side-effects.\n \n+                     --  Ada0Y (AI-287): In case of default initialization of\n+                     --  components, we duplicate the corresponding default\n+                     --  expression (from the record type declaration).\n+\n                      if Box_Present (Assoc) then\n                         Others_Mbox  := True;\n                         Mbox_Present := True;\n@@ -2845,9 +2857,10 @@ package body Sem_Aggr is\n \n          if Mbox_Present and then Is_Limited_Type (Etype (Component)) then\n \n-            --  In case of default initialization of a limited component we\n-            --  pass the limited component to the expander. The expander will\n-            --  generate calls to the corresponding initialization subprograms.\n+            --  Ada0Y (AI-287): In case of default initialization of a limited\n+            --  component we pass the limited component to the expander. The\n+            --  expander will generate calls to the corresponding initiali-\n+            --  zation subprograms.\n \n             Add_Association\n               (Component   => Component,\n@@ -2884,6 +2897,9 @@ package body Sem_Aggr is\n             Typech := Empty;\n \n             if Nkind (Selectr) = N_Others_Choice then\n+\n+               --  Ada0Y (AI-287):  others choice may have expression or mbox\n+\n                if No (Others_Etype)\n                   and then not Others_Mbox\n                then"}, {"sha": "400b162cd6087116c2595b63c57e611845e96554", "filename": "gcc/ada/sem_attr.adb", "status": "modified", "additions": 5, "deletions": 2, "changes": 7, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/19f0526a54834612872e13e2650e9c1f8dface4f/gcc%2Fada%2Fsem_attr.adb", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/19f0526a54834612872e13e2650e9c1f8dface4f/gcc%2Fada%2Fsem_attr.adb", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fada%2Fsem_attr.adb?ref=19f0526a54834612872e13e2650e9c1f8dface4f", "patch": "@@ -2184,9 +2184,12 @@ package body Sem_Attr is\n          if Is_Entity_Name (P) and then Is_Type (Entity (P)) then\n \n             --  If we are within an instance, the attribute must be legal\n-            --  because it was valid in the generic unit.\n+            --  because it was valid in the generic unit. Ditto if this is\n+            --  an inlining of a function declared in an instance.\n \n-            if In_Instance then\n+            if In_Instance\n+              or else In_Inlined_Body\n+            then\n                return;\n \n             --  For sure OK if we have a real private type itself, but must"}, {"sha": "3dac1e3aa026c4ef8e69d16306acb9325cfa8466", "filename": "gcc/ada/sem_cat.adb", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/19f0526a54834612872e13e2650e9c1f8dface4f/gcc%2Fada%2Fsem_cat.adb", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/19f0526a54834612872e13e2650e9c1f8dface4f/gcc%2Fada%2Fsem_cat.adb", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fada%2Fsem_cat.adb?ref=19f0526a54834612872e13e2650e9c1f8dface4f", "patch": "@@ -761,7 +761,7 @@ package body Sem_Cat is\n          return;\n       end if;\n \n-      --  Process explicit with_clauses that are not limited.\n+      --  Ada0Y (AI-50217): Process explicit with_clauses that are not limited\n \n       declare\n          Item             : Node_Id;"}, {"sha": "4fdf9a9a4ca702fa88d94ad8c55e8e2f6c6d342b", "filename": "gcc/ada/sem_ch10.adb", "status": "modified", "additions": 16, "deletions": 10, "changes": 26, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/19f0526a54834612872e13e2650e9c1f8dface4f/gcc%2Fada%2Fsem_ch10.adb", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/19f0526a54834612872e13e2650e9c1f8dface4f/gcc%2Fada%2Fsem_ch10.adb", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fada%2Fsem_ch10.adb?ref=19f0526a54834612872e13e2650e9c1f8dface4f", "patch": "@@ -77,6 +77,7 @@ package body Sem_Ch10 is\n    --  in a limited_with clause. If the package was not previously analyzed\n    --  then it also performs a basic decoration of the real entities; this\n    --  is required to do not pass non-decorated entities to the back-end.\n+   --  Implements Ada0Y (AI-50217).\n \n    procedure Check_Body_Needed_For_SAL (Unit_Name : Entity_Id);\n    --  Check whether the source for the body of a compilation unit must\n@@ -95,11 +96,12 @@ package body Sem_Ch10 is\n    --  and not in an inner frame.\n \n    procedure Expand_Limited_With_Clause (Nam : Node_Id; N : Node_Id);\n-   --  if a child unit appears in a limited_with clause, there are implicit\n+   --  If a child unit appears in a limited_with clause, there are implicit\n    --  limited_with clauses on all parents that are not already visible\n    --  through a regular with clause. This procedure creates the implicit\n    --  limited with_clauses for the parents and loads the corresponding units.\n    --  The shadow entities are created when the inserted clause is analyzed.\n+   --  Implements Ada0Y (AI-50217).\n \n    procedure Expand_With_Clause (Nam : Node_Id; N : Node_Id);\n    --  When a child unit appears in a context clause, the implicit withs on\n@@ -127,11 +129,11 @@ package body Sem_Ch10 is\n \n    procedure Install_Limited_Context_Clauses (N : Node_Id);\n    --  Subsidiary to Install_Context. Process only limited with_clauses\n-   --  for current unit.\n+   --  for current unit. Implements Ada0Y (AI-50217).\n \n    procedure Install_Limited_Withed_Unit (N : Node_Id);\n    --  Place shadow entities for a limited_with package in the visibility\n-   --  structures for the current compilation.\n+   --  structures for the current compilation. Implements Ada0Y (AI-50217).\n \n    procedure Install_Withed_Unit (With_Clause : Node_Id);\n    --  If the unit is not a child unit, make unit immediately visible.\n@@ -174,7 +176,7 @@ package body Sem_Ch10 is\n \n    procedure Remove_Limited_With_Clause (N : Node_Id);\n    --  Remove from visibility the shadow entities introduced for a package\n-   --  mentioned in a limited_with clause.\n+   --  mentioned in a limited_with clause. Implements Ada0Y (AI-50217).\n \n    procedure Remove_Parents (Lib_Unit : Node_Id);\n    --  Remove_Parents checks if Lib_Unit is a child spec. If so then the parent\n@@ -611,6 +613,9 @@ package body Sem_Ch10 is\n          begin\n             Item := First (Context_Items (N));\n             while Present (Item) loop\n+\n+               --  Ada0Y (AI-50217): Do not consider limited-withed units\n+\n                if Nkind (Item) = N_With_Clause\n                   and then not Implicit_With (Item)\n                   and then not Limited_Present (Item)\n@@ -788,8 +793,8 @@ package body Sem_Ch10 is\n       --  Loop through context items. This is done is three passes:\n       --  a) The first pass analyze non-limited with-clauses.\n       --  b) The second pass add implicit limited_with clauses for\n-      --     the parents of child units.\n-      --  c) The third pass analyzes limited_with clauses.\n+      --     the parents of child units (Ada0Y: AI-50217)\n+      --  c) The third pass analyzes limited_with clauses (Ada0Y: AI-50217)\n \n       Item := First (Context_Items (N));\n       while Present (Item) loop\n@@ -1590,8 +1595,8 @@ package body Sem_Ch10 is\n \n    begin\n       if Limited_Present (N) then\n-\n-         --  Build visibility structures but do not analyze unit\n+         --  Ada0Y (AI-50217): Build visibility structures but do not\n+         --  analyze unit\n \n          Build_Limited_Views (N);\n          return;\n@@ -4006,8 +4011,9 @@ package body Sem_Ch10 is\n       Unit_Name : Entity_Id;\n \n    begin\n-      --  We remove the context clauses in two phases: limited-views first\n-      --  and regular-views later (to maintain the stack model).\n+      --  Ada0Y (AI-50217): We remove the context clauses in two phases:\n+      --  limited-views first and regular-views later (to maintain the\n+      --  stack model).\n \n       --  First Phase: Remove limited_with context clauses\n "}, {"sha": "c84006d46682b13d8be4eb3f8176cfe67e81a424", "filename": "gcc/ada/sem_ch12.adb", "status": "modified", "additions": 10, "deletions": 0, "changes": 10, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/19f0526a54834612872e13e2650e9c1f8dface4f/gcc%2Fada%2Fsem_ch12.adb", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/19f0526a54834612872e13e2650e9c1f8dface4f/gcc%2Fada%2Fsem_ch12.adb", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fada%2Fsem_ch12.adb?ref=19f0526a54834612872e13e2650e9c1f8dface4f", "patch": "@@ -987,6 +987,7 @@ package body Sem_Ch12 is\n                       Defining_Identifier (Analyzed_Formal));\n \n                   if No (Match) then\n+                     Error_Msg_Sloc := Sloc (Gen_Unit);\n                      Error_Msg_NE\n                        (\"missing actual&\",\n                          Instantiation_Node, Defining_Identifier (Formal));\n@@ -1075,6 +1076,7 @@ package body Sem_Ch12 is\n                       Defining_Identifier (Original_Node (Analyzed_Formal)));\n \n                   if No (Match) then\n+                     Error_Msg_Sloc := Sloc (Gen_Unit);\n                      Error_Msg_NE\n                        (\"missing actual&\",\n                          Instantiation_Node, Defining_Identifier (Formal));\n@@ -1111,6 +1113,8 @@ package body Sem_Ch12 is\n          end loop;\n \n          if Num_Actuals > Num_Matched then\n+            Error_Msg_Sloc := Sloc (Gen_Unit);\n+\n             if Present (Selector_Name (Actual)) then\n                Error_Msg_NE\n                  (\"unmatched actual&\",\n@@ -2348,6 +2352,8 @@ package body Sem_Ch12 is\n \n       elsif Ekind (Gen_Unit) /= E_Generic_Package then\n \n+         --  Ada0Y (AI-50217): Instance can not be used in limited with_clause\n+\n          if From_With_Type (Gen_Unit) then\n             Error_Msg_N\n               (\"cannot instantiate a limited withed package\", Gen_Id);\n@@ -6620,6 +6626,7 @@ package body Sem_Ch12 is\n          end if;\n \n       else\n+         Error_Msg_Sloc := Sloc (Scope (Analyzed_S));\n          Error_Msg_NE\n            (\"missing actual&\", Instantiation_Node, Formal_Sub);\n          Error_Msg_NE\n@@ -6746,6 +6753,9 @@ package body Sem_Ch12 is\n       Subt_Decl : Node_Id := Empty;\n \n    begin\n+      --  Sloc for error message on missing actual.\n+      Error_Msg_Sloc := Sloc (Scope (Defining_Identifier (Analyzed_Formal)));\n+\n       if Get_Instance_Of (Formal_Id) /= Formal_Id then\n          Error_Msg_N (\"duplicate instantiation of generic parameter\", Actual);\n       end if;"}, {"sha": "afdb50ff23570075a58668d7f2c4bc67df7f92bb", "filename": "gcc/ada/sem_ch3.adb", "status": "modified", "additions": 14, "deletions": 8, "changes": 22, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/19f0526a54834612872e13e2650e9c1f8dface4f/gcc%2Fada%2Fsem_ch3.adb", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/19f0526a54834612872e13e2650e9c1f8dface4f/gcc%2Fada%2Fsem_ch3.adb", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fada%2Fsem_ch3.adb?ref=19f0526a54834612872e13e2650e9c1f8dface4f", "patch": "@@ -690,6 +690,10 @@ package body Sem_Ch3 is\n       --  if the designated type is.\n \n       Set_Is_Public          (Anon_Type, Is_Public (Scope (Anon_Type)));\n+\n+      --  Ada0Y (AI-50217): Propagate the attribute that indicates that the\n+      --  designated type comes from the limited view (for back-end purposes).\n+\n       Set_From_With_Type     (Anon_Type, From_With_Type (Desig_Type));\n \n       --  The context is either a subprogram declaration or an access\n@@ -857,9 +861,9 @@ package body Sem_Ch3 is\n       --  access type is also imported, and therefore restricted in its use.\n       --  The access type may already be imported, so keep setting otherwise.\n \n-      --  If the non-limited view of the designated type is available, use\n-      --  it as the designated type of the access type, so that the back-end\n-      --  gets a usable entity.\n+      --  Ada0Y (AI-50217): If the non-limited view of the designated type is\n+      --  available, use it as the designated type of the access type, so that\n+      --  the back-end gets a usable entity.\n \n       if From_With_Type (Desig) then\n          Set_From_With_Type (T);\n@@ -2448,9 +2452,11 @@ package body Sem_Ch3 is\n    begin\n       Prev := Find_Type_Name (N);\n \n-      --  The full view, if present, now points to the current type. If the\n-      --  type was previously decorated when imported through a LIMITED WITH\n-      --  clause, it appears as incomplete but has no full view.\n+      --  The full view, if present, now points to the current type\n+\n+      --  Ada0Y (AI-50217): If the type was previously decorated when imported\n+      --  through a LIMITED WITH clause, it appears as incomplete but has no\n+      --  full view.\n \n       if Ekind (Prev) = E_Incomplete_Type\n         and then Present (Full_View (Prev))\n@@ -6234,8 +6240,8 @@ package body Sem_Ch3 is\n            or else Is_Limited_Composite (T))\n         and then not In_Instance\n       then\n-         --  Relax the strictness of the front-end in case of limited\n-         --  aggregates and extension aggregates.\n+         --  Ada0Y (AI-287): Relax the strictness of the front-end in case of\n+         --  limited aggregates and extension aggregates.\n \n          if Extensions_Allowed\n            and then (Nkind (Exp) = N_Aggregate"}, {"sha": "e122af79423deceb26b25992b07cdaed1ab9f393", "filename": "gcc/ada/sem_ch4.adb", "status": "modified", "additions": 7, "deletions": 0, "changes": 7, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/19f0526a54834612872e13e2650e9c1f8dface4f/gcc%2Fada%2Fsem_ch4.adb", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/19f0526a54834612872e13e2650e9c1f8dface4f/gcc%2Fada%2Fsem_ch4.adb", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fada%2Fsem_ch4.adb?ref=19f0526a54834612872e13e2650e9c1f8dface4f", "patch": "@@ -342,6 +342,10 @@ package body Sem_Ch4 is\n            and then Comes_From_Source (N)\n            and then not In_Instance_Body\n          then\n+            --  Ada0Y (AI-287): Do not post an error if the expression corres-\n+            --  ponds to a limited aggregate. Limited aggregates are checked in\n+            --  sem_aggr in a per-component manner (cf. Get_Value subprogram).\n+\n             if Extensions_Allowed\n               and then Nkind (Expression (E)) = N_Aggregate\n             then\n@@ -3442,6 +3446,9 @@ package body Sem_Ch4 is\n          Actual := First_Actual (N);\n \n          while Present (Actual) loop\n+            --  Ada0Y (AI-50217): Post an error in case of premature usage of\n+            --  an entity from the limited view.\n+\n             if not Analyzed (Etype (Actual))\n              and then From_With_Type (Etype (Actual))\n             then"}, {"sha": "d28109b1c5437e2c946486b281ebd7020c360f22", "filename": "gcc/ada/sem_ch6.adb", "status": "modified", "additions": 3, "deletions": 3, "changes": 6, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/19f0526a54834612872e13e2650e9c1f8dface4f/gcc%2Fada%2Fsem_ch6.adb", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/19f0526a54834612872e13e2650e9c1f8dface4f/gcc%2Fada%2Fsem_ch6.adb", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fada%2Fsem_ch6.adb?ref=19f0526a54834612872e13e2650e9c1f8dface4f", "patch": "@@ -4840,9 +4840,9 @@ package body Sem_Ch6 is\n                         and then Ekind (Root_Type (Formal_Type)) =\n                                                          E_Incomplete_Type)\n             then\n-\n-               --  Incomplete tagged types that are made visible through\n-               --  a limited with_clause are valid formal types.\n+               --  Ada0Y (AI-50217): Incomplete tagged types that are made\n+               --  visible through a limited with_clause are valid formal\n+               --  types.\n \n                if From_With_Type (Formal_Type)\n                  and then Is_Tagged_Type (Formal_Type)"}, {"sha": "6c65a7b5ecd8714cab8fa2253103c98946344ae4", "filename": "gcc/ada/sem_ch8.adb", "status": "modified", "additions": 6, "deletions": 0, "changes": 6, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/19f0526a54834612872e13e2650e9c1f8dface4f/gcc%2Fada%2Fsem_ch8.adb", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/19f0526a54834612872e13e2650e9c1f8dface4f/gcc%2Fada%2Fsem_ch8.adb", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fada%2Fsem_ch8.adb?ref=19f0526a54834612872e13e2650e9c1f8dface4f", "patch": "@@ -792,6 +792,8 @@ package body Sem_Ch8 is\n          Error_Msg_N\n            (\"expect package name in renaming\", Name (N));\n \n+      --  Ada0Y (AI-50217): Limited withed packages can not be renamed\n+\n       elsif Ekind (Old_P) = E_Package\n         and then From_With_Type (Old_P)\n       then\n@@ -3389,6 +3391,8 @@ package body Sem_Ch8 is\n          Set_Chars (Selector, Chars (Id));\n       end if;\n \n+      --  Ada0Y (AI-50217): Check usage of entities in limited withed units\n+\n       if Ekind (P_Name) = E_Package\n         and then From_With_Type (P_Name)\n       then\n@@ -5294,6 +5298,8 @@ package body Sem_Ch8 is\n \n       Set_In_Use (P);\n \n+      --  Ada0Y (AI-50217): Check restriction.\n+\n       if From_With_Type (P) then\n          Error_Msg_N (\"limited withed package cannot appear in use clause\", N);\n       end if;"}, {"sha": "57bbb3de759248399ebd0d2f67d4b2cb2218e721", "filename": "gcc/ada/sem_type.adb", "status": "modified", "additions": 3, "deletions": 0, "changes": 3, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/19f0526a54834612872e13e2650e9c1f8dface4f/gcc%2Fada%2Fsem_type.adb", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/19f0526a54834612872e13e2650e9c1f8dface4f/gcc%2Fada%2Fsem_type.adb", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fada%2Fsem_type.adb?ref=19f0526a54834612872e13e2650e9c1f8dface4f", "patch": "@@ -824,6 +824,9 @@ package body Sem_Type is\n       then\n          return True;\n \n+      --  Ada0Y (AI-50217): Additional branches to make the shadow entity\n+      --  compatible with its real entity.\n+\n       elsif From_With_Type (T1) then\n \n          --  If the expected type is the non-limited view of a type, the"}, {"sha": "44550392d9a539fa9d4b76726819ccd5b94915d9", "filename": "gcc/ada/sem_util.adb", "status": "modified", "additions": 2, "deletions": 2, "changes": 4, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/19f0526a54834612872e13e2650e9c1f8dface4f/gcc%2Fada%2Fsem_util.adb", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/19f0526a54834612872e13e2650e9c1f8dface4f/gcc%2Fada%2Fsem_util.adb", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fada%2Fsem_util.adb?ref=19f0526a54834612872e13e2650e9c1f8dface4f", "patch": "@@ -818,8 +818,8 @@ package body Sem_Util is\n    begin\n       if Ekind (T) = E_Incomplete_Type then\n \n-         --  If the type is available through a limited_with_clause,\n-         --  verify that its full view has been analyzed.\n+         --  Ada0Y (AI-50217): If the type is available through a limited\n+         --  with_clause, verify that its full view has been analyzed.\n \n          if From_With_Type (T)\n            and then Present (Non_Limited_View (T))"}, {"sha": "8691ab63feaff43f453cde5090c806c131d4713a", "filename": "gcc/ada/sinfo.ads", "status": "modified", "additions": 5, "deletions": 1, "changes": 6, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/19f0526a54834612872e13e2650e9c1f8dface4f/gcc%2Fada%2Fsinfo.ads", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/19f0526a54834612872e13e2650e9c1f8dface4f/gcc%2Fada%2Fsinfo.ads", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fada%2Fsinfo.ads?ref=19f0526a54834612872e13e2650e9c1f8dface4f", "patch": "@@ -3015,7 +3015,8 @@ package Sinfo is\n       --  separable by the parser. The choices list may represent either a\n       --  list of selector names in the record aggregate case, or a list of\n       --  discrete choices in the array aggregate case or an N_Others_Choice\n-      --  node (which appears as a singleton list).\n+      --  node (which appears as a singleton list). Box_Present gives support\n+      --  to Ada0Y (AI-287).\n \n       ------------------------------------\n       --  4.3.1  Commponent Choice List --\n@@ -5090,6 +5091,9 @@ package Sinfo is\n       --  Unreferenced_In_Spec (Flag7-Sem)\n       --  No_Entities_Ref_In_Spec (Flag8-Sem)\n \n+      --  Note: Limited_Present and Limited_View_Installed give support to\n+      --        Ada0Y (AI-50217).\n+\n       ----------------------\n       -- With_Type clause --\n       ----------------------"}, {"sha": "85294fe31590986f216b6344b55a339ab61ce6a9", "filename": "gcc/ada/snames.adb", "status": "modified", "additions": 2, "deletions": 0, "changes": 2, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/19f0526a54834612872e13e2650e9c1f8dface4f/gcc%2Fada%2Fsnames.adb", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/19f0526a54834612872e13e2650e9c1f8dface4f/gcc%2Fada%2Fsnames.adb", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fada%2Fsnames.adb?ref=19f0526a54834612872e13e2650e9c1f8dface4f", "patch": "@@ -618,8 +618,10 @@ package body Snames is\n      \"library_kind#\" &\n      \"library_name#\" &\n      \"library_options#\" &\n+     \"library_reference_symbol_file#\" &\n      \"library_src_dir#\" &\n      \"library_symbol_file#\" &\n+     \"library_symbol_policy#\" &\n      \"library_version#\" &\n      \"linker#\" &\n      \"local_configuration_pragmas#\" &"}, {"sha": "df33ca06bb0484ac400b557d882202e4cf6638cd", "filename": "gcc/ada/snames.ads", "status": "modified", "additions": 24, "deletions": 22, "changes": 46, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/19f0526a54834612872e13e2650e9c1f8dface4f/gcc%2Fada%2Fsnames.ads", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/19f0526a54834612872e13e2650e9c1f8dface4f/gcc%2Fada%2Fsnames.ads", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fada%2Fsnames.ads?ref=19f0526a54834612872e13e2650e9c1f8dface4f", "patch": "@@ -902,33 +902,35 @@ package Snames is\n    Name_Library_Kind                   : constant Name_Id := N + 558;\n    Name_Library_Name                   : constant Name_Id := N + 559;\n    Name_Library_Options                : constant Name_Id := N + 560;\n-   Name_Library_Src_Dir                : constant Name_Id := N + 561;\n-   Name_Library_Symbol_File            : constant Name_Id := N + 562;\n-   Name_Library_Version                : constant Name_Id := N + 563;\n-   Name_Linker                         : constant Name_Id := N + 564;\n-   Name_Local_Configuration_Pragmas    : constant Name_Id := N + 565;\n-   Name_Locally_Removed_Files          : constant Name_Id := N + 566;\n-   Name_Naming                         : constant Name_Id := N + 567;\n-   Name_Object_Dir                     : constant Name_Id := N + 568;\n-   Name_Pretty_Printer                 : constant Name_Id := N + 569;\n-   Name_Project                        : constant Name_Id := N + 570;\n-   Name_Separate_Suffix                : constant Name_Id := N + 571;\n-   Name_Source_Dirs                    : constant Name_Id := N + 572;\n-   Name_Source_Files                   : constant Name_Id := N + 573;\n-   Name_Source_List_File               : constant Name_Id := N + 574;\n-   Name_Spec                           : constant Name_Id := N + 575;\n-   Name_Spec_Suffix                    : constant Name_Id := N + 576;\n-   Name_Specification                  : constant Name_Id := N + 577;\n-   Name_Specification_Exceptions       : constant Name_Id := N + 578;\n-   Name_Specification_Suffix           : constant Name_Id := N + 579;\n-   Name_Switches                       : constant Name_Id := N + 580;\n+   Name_Library_Reference_Symbol_File  : constant Name_Id := N + 561;\n+   Name_Library_Src_Dir                : constant Name_Id := N + 562;\n+   Name_Library_Symbol_File            : constant Name_Id := N + 563;\n+   Name_Library_Symbol_Policy          : constant Name_Id := N + 564;\n+   Name_Library_Version                : constant Name_Id := N + 565;\n+   Name_Linker                         : constant Name_Id := N + 566;\n+   Name_Local_Configuration_Pragmas    : constant Name_Id := N + 567;\n+   Name_Locally_Removed_Files          : constant Name_Id := N + 568;\n+   Name_Naming                         : constant Name_Id := N + 569;\n+   Name_Object_Dir                     : constant Name_Id := N + 570;\n+   Name_Pretty_Printer                 : constant Name_Id := N + 571;\n+   Name_Project                        : constant Name_Id := N + 572;\n+   Name_Separate_Suffix                : constant Name_Id := N + 573;\n+   Name_Source_Dirs                    : constant Name_Id := N + 574;\n+   Name_Source_Files                   : constant Name_Id := N + 575;\n+   Name_Source_List_File               : constant Name_Id := N + 576;\n+   Name_Spec                           : constant Name_Id := N + 577;\n+   Name_Spec_Suffix                    : constant Name_Id := N + 578;\n+   Name_Specification                  : constant Name_Id := N + 579;\n+   Name_Specification_Exceptions       : constant Name_Id := N + 580;\n+   Name_Specification_Suffix           : constant Name_Id := N + 581;\n+   Name_Switches                       : constant Name_Id := N + 582;\n    --  Other miscellaneous names used in front end\n \n-   Name_Unaligned_Valid                : constant Name_Id := N + 581;\n+   Name_Unaligned_Valid                : constant Name_Id := N + 583;\n \n    --  Mark last defined name for consistency check in Snames body\n \n-   Last_Predefined_Name                : constant Name_Id := N + 581;\n+   Last_Predefined_Name                : constant Name_Id := N + 583;\n \n    subtype Any_Operator_Name is Name_Id range\n      First_Operator_Name .. Last_Operator_Name;"}, {"sha": "c0ac7bcd2b1b386137d2927279f0b782eb59bf2c", "filename": "gcc/ada/sprint.adb", "status": "modified", "additions": 5, "deletions": 1, "changes": 6, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/19f0526a54834612872e13e2650e9c1f8dface4f/gcc%2Fada%2Fsprint.adb", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/19f0526a54834612872e13e2650e9c1f8dface4f/gcc%2Fada%2Fsprint.adb", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fada%2Fsprint.adb?ref=19f0526a54834612872e13e2650e9c1f8dface4f", "patch": "@@ -929,6 +929,8 @@ package body Sprint is\n             Sprint_Bar_List (Choices (Node));\n             Write_Str (\" => \");\n \n+            --  Ada0Y (AI-287): Print the mbox if present\n+\n             if Box_Present (Node) then\n                Write_Str_With_Col_Check (\"<>\");\n             else\n@@ -2495,6 +2497,9 @@ package body Sprint is\n \n             else\n                if First_Name (Node) or else not Dump_Original_Only then\n+\n+                  --  Ada0Y (AI-50217): Print limited with_clauses\n+\n                   if Limited_Present (Node) then\n                      Write_Indent_Str (\"limited with \");\n                   else\n@@ -2513,7 +2518,6 @@ package body Sprint is\n             end if;\n \n          when N_With_Type_Clause =>\n-\n             Write_Indent_Str (\"with type \");\n             Sprint_Node_Sloc (Name (Node));\n "}, {"sha": "0ccd4cbf6665f784e4bb05869bc58266c41c9c9d", "filename": "gcc/ada/symbols.adb", "status": "modified", "additions": 9, "deletions": 5, "changes": 14, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/19f0526a54834612872e13e2650e9c1f8dface4f/gcc%2Fada%2Fsymbols.adb", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/19f0526a54834612872e13e2650e9c1f8dface4f/gcc%2Fada%2Fsymbols.adb", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fada%2Fsymbols.adb?ref=19f0526a54834612872e13e2650e9c1f8dface4f", "patch": "@@ -36,14 +36,18 @@ package body Symbols is\n    ----------------\n \n    procedure Initialize\n-     (Symbol_File : String;\n-      Force       : Boolean;\n-      Quiet       : Boolean;\n-      Success     : out Boolean)\n+     (Symbol_File   : String;\n+      Reference     : String;\n+      Symbol_Policy : Policy;\n+      Quiet         : Boolean;\n+      Version       : String;\n+      Success       : out Boolean)\n    is\n       pragma Unreferenced (Symbol_File);\n-      pragma Unreferenced (Force);\n+      pragma Unreferenced (Reference);\n+      pragma Unreferenced (Symbol_Policy);\n       pragma Unreferenced (Quiet);\n+      pragma Unreferenced (Version);\n    begin\n       Put_Line\n         (\"creation of symbol files are not supported on this platform\");"}, {"sha": "73fa2c8863c469e903b04c664d20317041146210", "filename": "gcc/ada/symbols.ads", "status": "modified", "additions": 21, "deletions": 5, "changes": 26, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/19f0526a54834612872e13e2650e9c1f8dface4f/gcc%2Fada%2Fsymbols.ads", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/19f0526a54834612872e13e2650e9c1f8dface4f/gcc%2Fada%2Fsymbols.ads", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fada%2Fsymbols.ads?ref=19f0526a54834612872e13e2650e9c1f8dface4f", "patch": "@@ -33,6 +33,20 @@ with GNAT.OS_Lib;         use GNAT.OS_Lib;\n \n package Symbols is\n \n+   type Policy is\n+   --  Symbol policy:\n+\n+     (Autonomous,\n+      --  Create a symbol file without considering any reference\n+\n+      Compliant,\n+      --  Either create a symbol file with the same major and minor IDs if\n+      --  all symbols are already found in the reference file or with an\n+      --  incremented minor ID, if not.\n+\n+       Controlled);\n+      --  Fail if symbols are not the same as those in the reference file\n+\n    type Symbol_Kind is (Data, Proc);\n    --  To distinguish between the different kinds of symbols\n \n@@ -52,16 +66,18 @@ package Symbols is\n    --  The symbol tables\n \n    Original_Symbols : Symbol_Table.Instance;\n-   --  The symbols, if any, found in the original symbol table\n+   --  The symbols, if any, found in the reference symbol table\n \n    Complete_Symbols : Symbol_Table.Instance;\n    --  The symbols, if any, found in the objects files\n \n    procedure Initialize\n-     (Symbol_File : String;\n-      Force       : Boolean;\n-      Quiet       : Boolean;\n-      Success     : out Boolean);\n+     (Symbol_File   : String;\n+      Reference     : String;\n+      Symbol_Policy : Policy;\n+      Quiet         : Boolean;\n+      Version       : String;\n+      Success       : out Boolean);\n    --  Initialize a symbol file. This procedure must be called before\n    --  Processing any object file. Depending on the platforms and the\n    --  circumstances, additional messages may be issued if Quiet is False."}, {"sha": "c729f4837916c54bcf539a960bf1544cf32bca24", "filename": "gcc/ada/usage.adb", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/19f0526a54834612872e13e2650e9c1f8dface4f/gcc%2Fada%2Fusage.adb", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/19f0526a54834612872e13e2650e9c1f8dface4f/gcc%2Fada%2Fusage.adb", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fada%2Fusage.adb?ref=19f0526a54834612872e13e2650e9c1f8dface4f", "patch": "@@ -235,7 +235,7 @@ begin\n    --  Line for -gnatN switch\n \n    Write_Switch_Char (\"N\");\n-   Write_Line (\"Full (frontend) inlining of subprograqms\");\n+   Write_Line (\"Full (frontend) inlining of subprograms\");\n \n    --  Line for -gnato switch\n "}, {"sha": "cca42856270b5d60f3727ce1730db7c06351f720", "filename": "gcc/ada/xref_lib.adb", "status": "modified", "additions": 26, "deletions": 9, "changes": 35, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/19f0526a54834612872e13e2650e9c1f8dface4f/gcc%2Fada%2Fxref_lib.adb", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/19f0526a54834612872e13e2650e9c1f8dface4f/gcc%2Fada%2Fxref_lib.adb", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fada%2Fxref_lib.adb?ref=19f0526a54834612872e13e2650e9c1f8dface4f", "patch": "@@ -6,7 +6,7 @@\n --                                                                          --\n --                                 B o d y                                  --\n --                                                                          --\n---          Copyright (C) 1998-2002 Free Software Foundation, Inc.          --\n+--          Copyright (C) 1998-2003 Free Software Foundation, Inc.          --\n --                                                                          --\n -- GNAT is free software;  you can  redistribute it  and/or modify it under --\n -- terms of the  GNU General Public License as published  by the Free Soft- --\n@@ -359,10 +359,7 @@ package body Xref_Lib is\n    -- Default_Project_File --\n    --------------------------\n \n-   function Default_Project_File\n-     (Dir_Name : String)\n-      return     String\n-   is\n+   function Default_Project_File (Dir_Name : String) return String is\n       My_Dir  : Dir_Type;\n       Dir_Ent : File_Name_String;\n       Last    : Natural;\n@@ -396,8 +393,7 @@ package body Xref_Lib is\n \n    function File_Name\n      (File : ALI_File;\n-      Num  : Positive)\n-      return File_Reference\n+      Num  : Positive) return File_Reference\n    is\n    begin\n       return File.Dep.Table (Num);\n@@ -876,6 +872,9 @@ package body Xref_Lib is\n          --  unit number is optional. It is specified only if the parent type\n          --  is not defined in the current unit.\n \n+         --  We also have the format for generic instantiations, as in\n+         --  7a5*Uid(3|5I8[4|2]) 2|4r74\n+\n          --  We could also have something like\n          --  16I9*I<integer>\n          --  that indicates that I derives from the predefined type integer.\n@@ -918,6 +917,25 @@ package body Xref_Lib is\n                Ptr := Ptr + 1;\n                Parse_Number (Ali, Ptr, P_Column);\n \n+               --  Skip the information for generics instantiations\n+\n+               if Ali (Ptr) = '[' then\n+                  declare\n+                     Num_Brackets : Natural := 1;\n+                  begin\n+                     while Num_Brackets /= 0 loop\n+                        Ptr := Ptr + 1;\n+                        if Ali (Ptr) = '[' then\n+                           Num_Brackets := Num_Brackets + 1;\n+                        elsif Ali (Ptr) = ']' then\n+                           Num_Brackets := Num_Brackets - 1;\n+                        end if;\n+                     end loop;\n+\n+                     Ptr := Ptr + 1;\n+                  end;\n+               end if;\n+\n                --  Skip '>', or ')' or '>'\n \n                Ptr := Ptr + 1;\n@@ -928,8 +946,7 @@ package body Xref_Lib is\n                if Der_Info or else Type_Tree then\n                   declare\n                      Symbol : constant String :=\n-                       Get_Symbol_Name (P_Eun, P_Line, P_Column);\n-\n+                                Get_Symbol_Name (P_Eun, P_Line, P_Column);\n                   begin\n                      if Symbol /= \"???\" then\n                         Add_Parent"}]}