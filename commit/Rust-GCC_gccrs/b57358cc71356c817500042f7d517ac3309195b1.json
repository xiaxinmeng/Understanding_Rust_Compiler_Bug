{"sha": "b57358cc71356c817500042f7d517ac3309195b1", "node_id": "C_kwDOANBUbNoAKGI1NzM1OGNjNzEzNTZjODE3NTAwMDQyZjdkNTE3YWMzMzA5MTk1YjE", "commit": {"author": {"name": "Tom de Vries", "email": "tdevries@suse.de", "date": "2022-03-18T15:42:23Z"}, "committer": {"name": "Tom de Vries", "email": "tdevries@suse.de", "date": "2022-03-22T13:35:35Z"}, "message": "[nvptx] Limit HFmode support to mexperimental\n\nWith PR104489 still open and end-of-stage-4 approaching, classify HFmode\nsupport as experimental, which is not enabled by default but can be enabled\nusing -mexperimental.\n\nThis fixes the nvptx build when the default sm_xx is set to sm_53 or higher.\n\nNote that we're not using -mfp16 or some such, because that might create\nexpectations about being able to switch support on or off in the future, and\nat this point it's not clear why, once reaching non-experimental status, it\nshouldn't always be enabled.\n\ngcc/ChangeLog:\n\n2022-03-19  Tom de Vries  <tdevries@suse.de>\n\n\t* config/nvptx/nvptx.cc (nvptx_scalar_mode_supported_p)\n\t(nvptx_libgcc_floating_mode_supported_p): Only enable HFmode for\n\tmexperimental.\n\ngcc/testsuite/ChangeLog:\n\n2022-03-19  Tom de Vries  <tdevries@suse.de>\n\n\t* gcc.target/nvptx/float16-1.c: Add additional-options -mexperimental.\n\t* gcc.target/nvptx/float16-2.c: Same.\n\t* gcc.target/nvptx/float16-3.c: Same.\n\t* gcc.target/nvptx/float16-4.c: Same.\n\t* gcc.target/nvptx/float16-5.c: Same.\n\t* gcc.target/nvptx/float16-6.c: Same.", "tree": {"sha": "8b542631339ba607d92cc72a4db0ca80a708f334", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/8b542631339ba607d92cc72a4db0ca80a708f334"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/b57358cc71356c817500042f7d517ac3309195b1", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/b57358cc71356c817500042f7d517ac3309195b1", "html_url": "https://github.com/Rust-GCC/gccrs/commit/b57358cc71356c817500042f7d517ac3309195b1", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/b57358cc71356c817500042f7d517ac3309195b1/comments", "author": {"login": "vries", "id": 4057235, "node_id": "MDQ6VXNlcjQwNTcyMzU=", "avatar_url": "https://avatars.githubusercontent.com/u/4057235?v=4", "gravatar_id": "", "url": "https://api.github.com/users/vries", "html_url": "https://github.com/vries", "followers_url": "https://api.github.com/users/vries/followers", "following_url": "https://api.github.com/users/vries/following{/other_user}", "gists_url": "https://api.github.com/users/vries/gists{/gist_id}", "starred_url": "https://api.github.com/users/vries/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/vries/subscriptions", "organizations_url": "https://api.github.com/users/vries/orgs", "repos_url": "https://api.github.com/users/vries/repos", "events_url": "https://api.github.com/users/vries/events{/privacy}", "received_events_url": "https://api.github.com/users/vries/received_events", "type": "User", "site_admin": false}, "committer": {"login": "vries", "id": 4057235, "node_id": "MDQ6VXNlcjQwNTcyMzU=", "avatar_url": "https://avatars.githubusercontent.com/u/4057235?v=4", "gravatar_id": "", "url": "https://api.github.com/users/vries", "html_url": "https://github.com/vries", "followers_url": "https://api.github.com/users/vries/followers", "following_url": "https://api.github.com/users/vries/following{/other_user}", "gists_url": "https://api.github.com/users/vries/gists{/gist_id}", "starred_url": "https://api.github.com/users/vries/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/vries/subscriptions", "organizations_url": "https://api.github.com/users/vries/orgs", "repos_url": "https://api.github.com/users/vries/repos", "events_url": "https://api.github.com/users/vries/events{/privacy}", "received_events_url": "https://api.github.com/users/vries/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "a4baa0d3c5ad66e5ec24b8b5db7042739f0290aa", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/a4baa0d3c5ad66e5ec24b8b5db7042739f0290aa", "html_url": "https://github.com/Rust-GCC/gccrs/commit/a4baa0d3c5ad66e5ec24b8b5db7042739f0290aa"}], "stats": {"total": 10, "additions": 8, "deletions": 2}, "files": [{"sha": "87efc23bd96a5a9c3d9476c528ae1d3ed76b81a2", "filename": "gcc/config/nvptx/nvptx.cc", "status": "modified", "additions": 2, "deletions": 2, "changes": 4, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/b57358cc71356c817500042f7d517ac3309195b1/gcc%2Fconfig%2Fnvptx%2Fnvptx.cc", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/b57358cc71356c817500042f7d517ac3309195b1/gcc%2Fconfig%2Fnvptx%2Fnvptx.cc", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fconfig%2Fnvptx%2Fnvptx.cc?ref=b57358cc71356c817500042f7d517ac3309195b1", "patch": "@@ -7156,7 +7156,7 @@ nvptx_cannot_force_const_mem (machine_mode mode ATTRIBUTE_UNUSED,\n static bool\n nvptx_scalar_mode_supported_p (scalar_mode mode)\n {\n-  if (mode == HFmode && TARGET_SM53)\n+  if (nvptx_experimental && mode == HFmode && TARGET_SM53)\n     return true;\n \n   return default_scalar_mode_supported_p (mode);\n@@ -7165,7 +7165,7 @@ nvptx_scalar_mode_supported_p (scalar_mode mode)\n static bool\n nvptx_libgcc_floating_mode_supported_p (scalar_float_mode mode)\n {\n-  if (mode == HFmode && TARGET_SM53)\n+  if (nvptx_experimental && mode == HFmode && TARGET_SM53)\n     return true;\n \n   return default_libgcc_floating_mode_supported_p (mode);"}, {"sha": "017774c29415b3798d78936693e5fcdea280ce47", "filename": "gcc/testsuite/gcc.target/nvptx/float16-1.c", "status": "modified", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/b57358cc71356c817500042f7d517ac3309195b1/gcc%2Ftestsuite%2Fgcc.target%2Fnvptx%2Ffloat16-1.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/b57358cc71356c817500042f7d517ac3309195b1/gcc%2Ftestsuite%2Fgcc.target%2Fnvptx%2Ffloat16-1.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgcc.target%2Fnvptx%2Ffloat16-1.c?ref=b57358cc71356c817500042f7d517ac3309195b1", "patch": "@@ -1,5 +1,6 @@\n /* { dg-do compile } */\n /* { dg-options \"-O2 -ffast-math -misa=sm_53 -mptx=_\" } */\n+/* { dg-additional-options \"-mexperimental\" } */\n \n _Float16 var;\n "}, {"sha": "e15b685253bae501bfe0608dbdf885dd4465c07d", "filename": "gcc/testsuite/gcc.target/nvptx/float16-2.c", "status": "modified", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/b57358cc71356c817500042f7d517ac3309195b1/gcc%2Ftestsuite%2Fgcc.target%2Fnvptx%2Ffloat16-2.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/b57358cc71356c817500042f7d517ac3309195b1/gcc%2Ftestsuite%2Fgcc.target%2Fnvptx%2Ffloat16-2.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgcc.target%2Fnvptx%2Ffloat16-2.c?ref=b57358cc71356c817500042f7d517ac3309195b1", "patch": "@@ -1,5 +1,6 @@\n /* { dg-do compile } */\n /* { dg-options \"-O2 -ffast-math -misa=sm_80 -mptx=_\" } */\n+/* { dg-additional-options \"-mexperimental\" } */\n \n _Float16 x;\n _Float16 y;"}, {"sha": "1c6469020555e5b2b2aaafa0a1ab73817a2ba9f3", "filename": "gcc/testsuite/gcc.target/nvptx/float16-3.c", "status": "modified", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/b57358cc71356c817500042f7d517ac3309195b1/gcc%2Ftestsuite%2Fgcc.target%2Fnvptx%2Ffloat16-3.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/b57358cc71356c817500042f7d517ac3309195b1/gcc%2Ftestsuite%2Fgcc.target%2Fnvptx%2Ffloat16-3.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgcc.target%2Fnvptx%2Ffloat16-3.c?ref=b57358cc71356c817500042f7d517ac3309195b1", "patch": "@@ -1,5 +1,6 @@\n /* { dg-do compile } */\n /* { dg-options \"-O2 -misa=sm_53 -mptx=_\" } */\n+/* { dg-additional-options \"-mexperimental\" } */\n \n _Float16 var;\n "}, {"sha": "1c24ec8c3b26c6ca8abc7ddba9048971f9110150", "filename": "gcc/testsuite/gcc.target/nvptx/float16-4.c", "status": "modified", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/b57358cc71356c817500042f7d517ac3309195b1/gcc%2Ftestsuite%2Fgcc.target%2Fnvptx%2Ffloat16-4.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/b57358cc71356c817500042f7d517ac3309195b1/gcc%2Ftestsuite%2Fgcc.target%2Fnvptx%2Ffloat16-4.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgcc.target%2Fnvptx%2Ffloat16-4.c?ref=b57358cc71356c817500042f7d517ac3309195b1", "patch": "@@ -1,5 +1,6 @@\n /* { dg-do compile } */\n /* { dg-options \"-O2 -ffast-math -misa=sm_53 -mptx=_\" } */\n+/* { dg-additional-options \"-mexperimental\" } */\n \n _Float16 var;\n "}, {"sha": "9ae3365e1a6e3c6685e6d41d11a897d8e1ad5625", "filename": "gcc/testsuite/gcc.target/nvptx/float16-5.c", "status": "modified", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/b57358cc71356c817500042f7d517ac3309195b1/gcc%2Ftestsuite%2Fgcc.target%2Fnvptx%2Ffloat16-5.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/b57358cc71356c817500042f7d517ac3309195b1/gcc%2Ftestsuite%2Fgcc.target%2Fnvptx%2Ffloat16-5.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgcc.target%2Fnvptx%2Ffloat16-5.c?ref=b57358cc71356c817500042f7d517ac3309195b1", "patch": "@@ -1,5 +1,6 @@\n /* { dg-do compile } */\n /* { dg-options \"-O2 -ffast-math -misa=sm_53 -mptx=_\" } */\n+/* { dg-additional-options \"-mexperimental\" } */\n \n _Float16 a;\n _Float16 b;"}, {"sha": "37c580429c559c6a593b6734359a7d9d5a6351ba", "filename": "gcc/testsuite/gcc.target/nvptx/float16-6.c", "status": "modified", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/b57358cc71356c817500042f7d517ac3309195b1/gcc%2Ftestsuite%2Fgcc.target%2Fnvptx%2Ffloat16-6.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/b57358cc71356c817500042f7d517ac3309195b1/gcc%2Ftestsuite%2Fgcc.target%2Fnvptx%2Ffloat16-6.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgcc.target%2Fnvptx%2Ffloat16-6.c?ref=b57358cc71356c817500042f7d517ac3309195b1", "patch": "@@ -1,5 +1,6 @@\n /* { dg-do compile } */\n /* { dg-options \"-O2 -misa=sm_53 -mptx=_\" } */\n+/* { dg-additional-options \"-mexperimental\" } */\n \n _Float16 x;\n _Float16 y;"}]}