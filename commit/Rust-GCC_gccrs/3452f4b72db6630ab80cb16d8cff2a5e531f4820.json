{"sha": "3452f4b72db6630ab80cb16d8cff2a5e531f4820", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6MzQ1MmY0YjcyZGI2NjMwYWI4MGNiMTZkOGNmZjJhNWU1MzFmNDgyMA==", "commit": {"author": {"name": "Bob Duff", "email": "duff@adacore.com", "date": "2020-05-16T15:59:50Z"}, "committer": {"name": "Pierre-Marie de Rodat", "email": "derodat@adacore.com", "date": "2020-07-08T14:55:49Z"}, "message": "[Ada] Check predicates for subtypes of private types\n\ngcc/ada/\n\n\t* sem_ch13.adb (Analyze_Aspect_Specifications): Add freeze node\n\tfor the Underlying_Full_View if it exists. The freeze node is\n\twhat triggers the generation of the predicate function.\n\t* freeze.adb: Minor reformatting.", "tree": {"sha": "eca653f573b3180f1db22fb49608d87069ed2b35", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/eca653f573b3180f1db22fb49608d87069ed2b35"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/3452f4b72db6630ab80cb16d8cff2a5e531f4820", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/3452f4b72db6630ab80cb16d8cff2a5e531f4820", "html_url": "https://github.com/Rust-GCC/gccrs/commit/3452f4b72db6630ab80cb16d8cff2a5e531f4820", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/3452f4b72db6630ab80cb16d8cff2a5e531f4820/comments", "author": {"login": "bobduff", "id": 29099567, "node_id": "MDQ6VXNlcjI5MDk5NTY3", "avatar_url": "https://avatars.githubusercontent.com/u/29099567?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bobduff", "html_url": "https://github.com/bobduff", "followers_url": "https://api.github.com/users/bobduff/followers", "following_url": "https://api.github.com/users/bobduff/following{/other_user}", "gists_url": "https://api.github.com/users/bobduff/gists{/gist_id}", "starred_url": "https://api.github.com/users/bobduff/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bobduff/subscriptions", "organizations_url": "https://api.github.com/users/bobduff/orgs", "repos_url": "https://api.github.com/users/bobduff/repos", "events_url": "https://api.github.com/users/bobduff/events{/privacy}", "received_events_url": "https://api.github.com/users/bobduff/received_events", "type": "User", "site_admin": false}, "committer": {"login": "pmderodat", "id": 758452, "node_id": "MDQ6VXNlcjc1ODQ1Mg==", "avatar_url": "https://avatars.githubusercontent.com/u/758452?v=4", "gravatar_id": "", "url": "https://api.github.com/users/pmderodat", "html_url": "https://github.com/pmderodat", "followers_url": "https://api.github.com/users/pmderodat/followers", "following_url": "https://api.github.com/users/pmderodat/following{/other_user}", "gists_url": "https://api.github.com/users/pmderodat/gists{/gist_id}", "starred_url": "https://api.github.com/users/pmderodat/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/pmderodat/subscriptions", "organizations_url": "https://api.github.com/users/pmderodat/orgs", "repos_url": "https://api.github.com/users/pmderodat/repos", "events_url": "https://api.github.com/users/pmderodat/events{/privacy}", "received_events_url": "https://api.github.com/users/pmderodat/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "19036072c6f7db967a3ecd1b2f3b9440ddbd68d4", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/19036072c6f7db967a3ecd1b2f3b9440ddbd68d4", "html_url": "https://github.com/Rust-GCC/gccrs/commit/19036072c6f7db967a3ecd1b2f3b9440ddbd68d4"}], "stats": {"total": 22, "additions": 17, "deletions": 5}, "files": [{"sha": "cb32f9d3c139db7a5a1413603b049ba135441216", "filename": "gcc/ada/freeze.adb", "status": "modified", "additions": 2, "deletions": 5, "changes": 7, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/3452f4b72db6630ab80cb16d8cff2a5e531f4820/gcc%2Fada%2Ffreeze.adb", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/3452f4b72db6630ab80cb16d8cff2a5e531f4820/gcc%2Fada%2Ffreeze.adb", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fada%2Ffreeze.adb?ref=3452f4b72db6630ab80cb16d8cff2a5e531f4820", "patch": "@@ -6175,8 +6175,7 @@ package body Freeze is\n \n                         if Present (F_Node) then\n                            Inherit_Freeze_Node\n-                             (Fnod => F_Node,\n-                              Typ  => Full_View (E));\n+                             (Fnod => F_Node, Typ => Full_View (E));\n                         else\n                            Set_Has_Delayed_Freeze (Full_View (E), False);\n                            Set_Freeze_Node (Full_View (E), Empty);\n@@ -6187,9 +6186,7 @@ package body Freeze is\n                         F_Node := Freeze_Node (Full_View (E));\n \n                         if Present (F_Node) then\n-                           Inherit_Freeze_Node\n-                             (Fnod => F_Node,\n-                              Typ  => E);\n+                           Inherit_Freeze_Node (Fnod => F_Node, Typ => E);\n                         else\n                            --  {Incomplete,Private}_Subtypes with Full_Views\n                            --  constrained by discriminants."}, {"sha": "4c8c650b427984001948d0639727e4b565ed4e1c", "filename": "gcc/ada/sem_ch13.adb", "status": "modified", "additions": 15, "deletions": 0, "changes": 15, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/3452f4b72db6630ab80cb16d8cff2a5e531f4820/gcc%2Fada%2Fsem_ch13.adb", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/3452f4b72db6630ab80cb16d8cff2a5e531f4820/gcc%2Fada%2Fsem_ch13.adb", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fada%2Fsem_ch13.adb?ref=3452f4b72db6630ab80cb16d8cff2a5e531f4820", "patch": "@@ -3051,6 +3051,21 @@ package body Sem_Ch13 is\n \n                      Set_Has_Delayed_Aspects (Full_View (E));\n                      Ensure_Freeze_Node (Full_View (E));\n+\n+                     --  If there is an Underlying_Full_View, also create a\n+                     --  freeze node for that one.\n+\n+                     if Is_Private_Type (Full_View (E)) then\n+                        declare\n+                           U_Full : constant Entity_Id :=\n+                             Underlying_Full_View (Full_View (E));\n+                        begin\n+                           if Present (U_Full) then\n+                              Set_Has_Delayed_Aspects (U_Full);\n+                              Ensure_Freeze_Node (U_Full);\n+                           end if;\n+                        end;\n+                     end if;\n                   end if;\n \n                --  Predicate_Failure"}]}