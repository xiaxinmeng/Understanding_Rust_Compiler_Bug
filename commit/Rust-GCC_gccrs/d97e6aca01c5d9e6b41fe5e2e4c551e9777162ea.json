{"sha": "d97e6aca01c5d9e6b41fe5e2e4c551e9777162ea", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6ZDk3ZTZhY2EwMWM1ZDllNmI0MWZlNWUyZTRjNTUxZTk3NzcxNjJlYQ==", "commit": {"author": {"name": "Adam Nemet", "email": "anemet@caviumnetworks.com", "date": "2008-08-25T00:57:01Z"}, "committer": {"name": "Adam Nemet", "email": "nemet@gcc.gnu.org", "date": "2008-08-25T00:57:01Z"}, "message": "config.gcc (mips64*-*-linux*): Handle mips64octeon*-*-linux*.\n\n\t* config.gcc (mips64*-*-linux*): Handle mips64octeon*-*-linux*.\n\t* config/mips/mips.h (enum processor_type): Add PROCESSOR_OCTEON.\n\t(TARGET_OCTEON): New macro.\n\t(TARGET_CPU_CPP_BUILTINS): Define __OCTEON__ for Octeon.\n\t(MIPS_ISA_LEVEL_SPEC, MIPS_ARCH_FLOAT_SPEC): Handle -march=octeon.\n\t(ISA_HAS_POP): New macro.\n\t* config/mips/driver-native.c (host_detect_local_cpu): Handle\n\tOcteon.\n\t* config/mips/mips.c (mips_cpu_info_table, mips_rtx_cost_data):\n\tHandle Octeon.\n\t* config/mips/mips.md (cpu): Add octeon.\n\t(type): Add pop attribute value.\n\t(popcount<mode>2): New pattern.\n\t* doc/invoke.texi (-march=@var{arch}): Add octeon.\ntestsuite/\n\t* gcc.target/mips/octeon-pop-1.c: New test.\n\nFrom-SVN: r139554", "tree": {"sha": "f13d95beb43ba81bd154edae66a1cafd6d601e63", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/f13d95beb43ba81bd154edae66a1cafd6d601e63"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/d97e6aca01c5d9e6b41fe5e2e4c551e9777162ea", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/d97e6aca01c5d9e6b41fe5e2e4c551e9777162ea", "html_url": "https://github.com/Rust-GCC/gccrs/commit/d97e6aca01c5d9e6b41fe5e2e4c551e9777162ea", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/d97e6aca01c5d9e6b41fe5e2e4c551e9777162ea/comments", "author": null, "committer": null, "parents": [{"sha": "807e74dbc6dcae64f4b6dc32cd376ec87607bd67", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/807e74dbc6dcae64f4b6dc32cd376ec87607bd67", "html_url": "https://github.com/Rust-GCC/gccrs/commit/807e74dbc6dcae64f4b6dc32cd376ec87607bd67"}], "stats": {"total": 93, "additions": 88, "deletions": 5}, "files": [{"sha": "a891119500a16caf44cf86b02986cc639f910a8c", "filename": "gcc/ChangeLog", "status": "modified", "additions": 17, "deletions": 0, "changes": 17, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/d97e6aca01c5d9e6b41fe5e2e4c551e9777162ea/gcc%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/d97e6aca01c5d9e6b41fe5e2e4c551e9777162ea/gcc%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2FChangeLog?ref=d97e6aca01c5d9e6b41fe5e2e4c551e9777162ea", "patch": "@@ -1,3 +1,20 @@\n+2008-08-24  Adam Nemet  <anemet@caviumnetworks.com>\n+\n+\t* config.gcc (mips64*-*-linux*): Handle mips64octeon*-*-linux*.\n+\t* config/mips/mips.h (enum processor_type): Add PROCESSOR_OCTEON.\n+\t(TARGET_OCTEON): New macro.\n+\t(TARGET_CPU_CPP_BUILTINS): Define __OCTEON__ for Octeon.\n+\t(MIPS_ISA_LEVEL_SPEC, MIPS_ARCH_FLOAT_SPEC): Handle -march=octeon.\n+\t(ISA_HAS_POP): New macro.\n+\t* config/mips/driver-native.c (host_detect_local_cpu): Handle\n+\tOcteon.\n+\t* config/mips/mips.c (mips_cpu_info_table, mips_rtx_cost_data):\n+\tHandle Octeon.\n+\t* config/mips/mips.md (cpu): Add octeon.\n+\t(type): Add pop attribute value.\n+\t(popcount<mode>2): New pattern.\n+\t* doc/invoke.texi (-march=@var{arch}): Add octeon.\n+\n 2008-08-24  Jan Hubicka  <jh@suse.cz>\n \n \t* doc/invoke.texi (-fipa-cp-clone): New option."}, {"sha": "559098ea499c14adc0b8ada39acb7013ac9fa6e7", "filename": "gcc/config.gcc", "status": "modified", "additions": 4, "deletions": 0, "changes": 4, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/d97e6aca01c5d9e6b41fe5e2e4c551e9777162ea/gcc%2Fconfig.gcc", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/d97e6aca01c5d9e6b41fe5e2e4c551e9777162ea/gcc%2Fconfig.gcc", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fconfig.gcc?ref=d97e6aca01c5d9e6b41fe5e2e4c551e9777162ea", "patch": "@@ -1551,6 +1551,10 @@ mips64*-*-linux* | mipsisa64*-*-linux*)\n \t\t\ttm_file=\"${tm_file} mips/st.h\"\n \t\t\ttmake_file=\"${tmake_file} mips/t-st\"\n \t\t\t;;\n+\t\tmips64octeon*-*-linux*)\n+\t\t\ttm_defines=\"${tm_defines} MIPS_CPU_STRING_DEFAULT=\\\\\\\"octeon\\\\\\\"\"\n+\t\t\ttarget_cpu_default=MASK_SOFT_FLOAT_ABI\n+\t\t\t;;\n \t\tmipsisa64r2*-*-linux*)\n \t\t\ttm_defines=\"${tm_defines} MIPS_ISA_DEFAULT=65\"\n \t\t\t;;"}, {"sha": "1947d7198622871c6f9f58775455a9b5a17758b6", "filename": "gcc/config/mips/driver-native.c", "status": "modified", "additions": 2, "deletions": 0, "changes": 2, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/d97e6aca01c5d9e6b41fe5e2e4c551e9777162ea/gcc%2Fconfig%2Fmips%2Fdriver-native.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/d97e6aca01c5d9e6b41fe5e2e4c551e9777162ea/gcc%2Fconfig%2Fmips%2Fdriver-native.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fconfig%2Fmips%2Fdriver-native.c?ref=d97e6aca01c5d9e6b41fe5e2e4c551e9777162ea", "patch": "@@ -67,6 +67,8 @@ host_detect_local_cpu (int argc, const char **argv)\n \t  cpu = \"sb1\";\n \telse if (strstr (buf, \"R5000\") != NULL)\n \t  cpu = \"r5000\";\n+\telse if (strstr (buf, \"Octeon\") != NULL)\n+\t  cpu = \"octeon\";\n \tbreak;\n       }\n "}, {"sha": "8a2ba16c452cea3fc5fabf6c449b283735fd9ae4", "filename": "gcc/config/mips/mips.c", "status": "modified", "additions": 14, "deletions": 1, "changes": 15, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/d97e6aca01c5d9e6b41fe5e2e4c551e9777162ea/gcc%2Fconfig%2Fmips%2Fmips.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/d97e6aca01c5d9e6b41fe5e2e4c551e9777162ea/gcc%2Fconfig%2Fmips%2Fmips.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fconfig%2Fmips%2Fmips.c?ref=d97e6aca01c5d9e6b41fe5e2e4c551e9777162ea", "patch": "@@ -652,7 +652,10 @@ static const struct mips_cpu_info mips_cpu_info_table[] = {\n   { \"sb1\", PROCESSOR_SB1, 64, PTF_AVOID_BRANCHLIKELY },\n   { \"sb1a\", PROCESSOR_SB1A, 64, PTF_AVOID_BRANCHLIKELY },\n   { \"sr71000\", PROCESSOR_SR71000, 64, PTF_AVOID_BRANCHLIKELY },\n-  { \"xlr\", PROCESSOR_XLR, 64, 0 }\n+  { \"xlr\", PROCESSOR_XLR, 64, 0 },\n+\n+  /* MIPS64 Release 2 processors.  */\n+  { \"octeon\", PROCESSOR_OCTEON, 65, PTF_AVOID_BRANCHLIKELY }\n };\n \n /* Default costs.  If these are used for a processor we should look\n@@ -851,6 +854,16 @@ static const struct mips_rtx_cost_data mips_rtx_cost_data[PROCESSOR_MAX] = {\n   },\n   { /* M4k */\n     DEFAULT_COSTS\n+  },\n+    /* Octeon */\n+  {\n+    SOFT_FP_COSTS,\n+    COSTS_N_INSNS (5),            /* int_mult_si */\n+    COSTS_N_INSNS (5),            /* int_mult_di */\n+    COSTS_N_INSNS (72),           /* int_div_si */\n+    COSTS_N_INSNS (72),           /* int_div_di */\n+                     1,\t\t  /* branch_cost */\n+                     4\t\t  /* memory_latency */\n   },\n   { /* R3900 */\n     COSTS_N_INSNS (2),            /* fp_add */"}, {"sha": "acf2b6cba3b8e1b149d475a9ab75e4c730086dcf", "filename": "gcc/config/mips/mips.h", "status": "modified", "additions": 11, "deletions": 2, "changes": 13, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/d97e6aca01c5d9e6b41fe5e2e4c551e9777162ea/gcc%2Fconfig%2Fmips%2Fmips.h", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/d97e6aca01c5d9e6b41fe5e2e4c551e9777162ea/gcc%2Fconfig%2Fmips%2Fmips.h", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fconfig%2Fmips%2Fmips.h?ref=d97e6aca01c5d9e6b41fe5e2e4c551e9777162ea", "patch": "@@ -50,6 +50,7 @@ enum processor_type {\n   PROCESSOR_LOONGSON_2E,\n   PROCESSOR_LOONGSON_2F,\n   PROCESSOR_M4K,\n+  PROCESSOR_OCTEON,\n   PROCESSOR_R3900,\n   PROCESSOR_R6000,\n   PROCESSOR_R4000,\n@@ -253,6 +254,7 @@ enum mips_code_readable_setting {\n #define TARGET_MIPS5500             (mips_arch == PROCESSOR_R5500)\n #define TARGET_MIPS7000             (mips_arch == PROCESSOR_R7000)\n #define TARGET_MIPS9000             (mips_arch == PROCESSOR_R9000)\n+#define TARGET_OCTEON\t\t    (mips_arch == PROCESSOR_OCTEON)\n #define TARGET_SB1                  (mips_arch == PROCESSOR_SB1\t\t\\\n \t\t\t\t     || mips_arch == PROCESSOR_SB1A)\n #define TARGET_SR71K                (mips_arch == PROCESSOR_SR71000)\n@@ -529,6 +531,10 @@ enum mips_code_readable_setting {\n       if (TARGET_LOONGSON_VECTORS)\t\t\t\t\t\\\n         builtin_define (\"__mips_loongson_vector_rev\");                  \\\n \t\t\t\t\t\t\t\t\t\\\n+      /* Historical Octeon macro.  */\t\t\t\t\t\\\n+      if (TARGET_OCTEON)\t\t\t\t\t\t\\\n+\tbuiltin_define (\"__OCTEON__\");\t\t\t\t\t\\\n+\t\t\t\t\t\t\t\t\t\\\n       /* Macros dependent on the C dialect.  */\t\t\t\t\\\n       if (preprocessing_asm_p ())\t\t\t\t\t\\\n \t{\t\t\t\t\t\t\t\t\\\n@@ -693,7 +699,7 @@ enum mips_code_readable_setting {\n      %{march=mips32r2|march=m4k|march=4ke*|march=4ksd|march=24k* \\\n        |march=34k*|march=74k*: -mips32r2} \\\n      %{march=mips64|march=5k*|march=20k*|march=sb1*|march=sr71000: -mips64} \\\n-     %{march=mips64r2: -mips64r2} \\\n+     %{march=mips64r2|march=octeon: -mips64r2} \\\n      %{!march=*: -\" MULTILIB_ISA_DEFAULT \"}}\"\n \n /* A spec that infers a -mhard-float or -msoft-float setting from an\n@@ -703,7 +709,7 @@ enum mips_code_readable_setting {\n #define MIPS_ARCH_FLOAT_SPEC \\\n   \"%{mhard-float|msoft-float|march=mips*:; \\\n      march=vr41*|march=m4k|march=4k*|march=24kc|march=24kec \\\n-     |march=34kc|march=74kc|march=5kc: -msoft-float; \\\n+     |march=34kc|march=74kc|march=5kc|march=octeon: -msoft-float; \\\n      march=*: -mhard-float}\"\n \n /* A spec condition that matches 32-bit options.  It only works if\n@@ -996,6 +1002,9 @@ enum mips_code_readable_setting {\n   (target_flags_explicit & MASK_LLSC\t\\\n    ? TARGET_LLSC && !TARGET_MIPS16\t\\\n    : ISA_HAS_LL_SC)\n+\n+/* ISA includes the pop instruction.  */\n+#define ISA_HAS_POP\t\tTARGET_OCTEON\n \f\n /* Add -G xx support.  */\n "}, {"sha": "4204ec1a6c99c9cb962e7e3e66d5fb0eb94c5ede", "filename": "gcc/config/mips/mips.md", "status": "modified", "additions": 19, "deletions": 2, "changes": 21, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/d97e6aca01c5d9e6b41fe5e2e4c551e9777162ea/gcc%2Fconfig%2Fmips%2Fmips.md", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/d97e6aca01c5d9e6b41fe5e2e4c551e9777162ea/gcc%2Fconfig%2Fmips%2Fmips.md", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fconfig%2Fmips%2Fmips.md?ref=d97e6aca01c5d9e6b41fe5e2e4c551e9777162ea", "patch": "@@ -344,6 +344,7 @@\n ;; slt\t\tset less than instructions\n ;; signext      sign extend instructions\n ;; clz\t\tthe clz and clo instructions\n+;; pop\t\tthe pop instruction\n ;; trap\t\ttrap if instructions\n ;; imul\t\tinteger multiply 2 operands\n ;; imul3\tinteger multiply 3 operands\n@@ -372,7 +373,7 @@\n (define_attr \"type\"\n   \"unknown,branch,jump,call,load,fpload,fpidxload,store,fpstore,fpidxstore,\n    prefetch,prefetchx,condmove,mtc,mfc,mthilo,mfhilo,const,arith,logical,\n-   shift,slt,signext,clz,trap,imul,imul3,imadd,idiv,move,fmove,fadd,fmul,\n+   shift,slt,signext,clz,pop,trap,imul,imul3,imadd,idiv,move,fmove,fadd,fmul,\n    fmadd,fdiv,frdiv,frdiv1,frdiv2,fabs,fneg,fcmp,fcvt,fsqrt,frsqrt,frsqrt1,\n    frsqrt2,multi,nop,ghost\"\n   (cond [(eq_attr \"jal\" \"!unset\") (const_string \"call\")\n@@ -556,7 +557,7 @@\n ;; Attribute describing the processor.  This attribute must match exactly\n ;; with the processor_type enumeration in mips.h.\n (define_attr \"cpu\"\n-  \"r3000,4kc,4kp,5kc,5kf,20kc,24kc,24kf2_1,24kf1_1,74kc,74kf2_1,74kf1_1,74kf3_2,loongson_2e,loongson_2f,m4k,r3900,r6000,r4000,r4100,r4111,r4120,r4130,r4300,r4600,r4650,r5000,r5400,r5500,r7000,r8000,r9000,sb1,sb1a,sr71000,xlr\"\n+  \"r3000,4kc,4kp,5kc,5kf,20kc,24kc,24kf2_1,24kf1_1,74kc,74kf2_1,74kf1_1,74kf3_2,loongson_2e,loongson_2f,m4k,octeon,r3900,r6000,r4000,r4100,r4111,r4120,r4130,r4300,r4600,r4650,r5000,r5400,r5500,r7000,r8000,r9000,sb1,sb1a,sr71000,xlr\"\n   (const (symbol_ref \"mips_tune\")))\n \n ;; The type of hardware hazard associated with this instruction.\n@@ -2410,6 +2411,22 @@\n   \"<d>clz\\t%0,%1\"\n   [(set_attr \"type\" \"clz\")\n    (set_attr \"mode\" \"<MODE>\")])\n+\n+;;\n+;;  ...................\n+;;\n+;;  Count number of set bits.\n+;;\n+;;  ...................\n+;;\n+\n+(define_insn \"popcount<mode>2\"\n+  [(set (match_operand:GPR 0 \"register_operand\" \"=d\")\n+\t(popcount:GPR (match_operand:GPR 1 \"register_operand\" \"d\")))]\n+  \"ISA_HAS_POP\"\n+  \"<d>pop\\t%0,%1\"\n+  [(set_attr \"type\" \"pop\")\n+   (set_attr \"mode\" \"<MODE>\")])\n \f\n ;;\n ;;  ...................."}, {"sha": "3789be6fdbdd824a6191ca92ceebe1e0e7af961b", "filename": "gcc/doc/invoke.texi", "status": "modified", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/d97e6aca01c5d9e6b41fe5e2e4c551e9777162ea/gcc%2Fdoc%2Finvoke.texi", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/d97e6aca01c5d9e6b41fe5e2e4c551e9777162ea/gcc%2Fdoc%2Finvoke.texi", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fdoc%2Finvoke.texi?ref=d97e6aca01c5d9e6b41fe5e2e4c551e9777162ea", "patch": "@@ -11999,6 +11999,7 @@ The processor names are:\n @samp{74kc}, @samp{74kf2_1}, @samp{74kf1_1}, @samp{74kf3_2},\n @samp{loongson2e}, @samp{loongson2f},\n @samp{m4k},\n+@samp{octeon},\n @samp{orion},\n @samp{r2000}, @samp{r3000}, @samp{r3900}, @samp{r4000}, @samp{r4400},\n @samp{r4600}, @samp{r4650}, @samp{r6000}, @samp{r8000},"}, {"sha": "1604c3bcc43877878c28688853ccc859ab663479", "filename": "gcc/testsuite/ChangeLog", "status": "modified", "additions": 4, "deletions": 0, "changes": 4, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/d97e6aca01c5d9e6b41fe5e2e4c551e9777162ea/gcc%2Ftestsuite%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/d97e6aca01c5d9e6b41fe5e2e4c551e9777162ea/gcc%2Ftestsuite%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2FChangeLog?ref=d97e6aca01c5d9e6b41fe5e2e4c551e9777162ea", "patch": "@@ -1,3 +1,7 @@\n+2008-08-24  Adam Nemet  <anemet@caviumnetworks.com>\n+\n+\t* gcc.target/mips/octeon-pop-1.c: New test.\n+\n 2008-08-24  Tobias Burnus  <burnus@net-b.de>\n \n \tPR fortran/37201"}, {"sha": "2554af6c8218fbb036f92851f844f45d69e8b67e", "filename": "gcc/testsuite/gcc.target/mips/octeon-pop-1.c", "status": "added", "additions": 16, "deletions": 0, "changes": 16, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/d97e6aca01c5d9e6b41fe5e2e4c551e9777162ea/gcc%2Ftestsuite%2Fgcc.target%2Fmips%2Focteon-pop-1.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/d97e6aca01c5d9e6b41fe5e2e4c551e9777162ea/gcc%2Ftestsuite%2Fgcc.target%2Fmips%2Focteon-pop-1.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgcc.target%2Fmips%2Focteon-pop-1.c?ref=d97e6aca01c5d9e6b41fe5e2e4c551e9777162ea", "patch": "@@ -0,0 +1,16 @@\n+/* { dg-do compile } */\n+/* { dg-mips-options \"-O -march=octeon -mgp64\" } */\n+/* { dg-final { scan-assembler \"\\tpop\\t\" } } */\n+/* { dg-final { scan-assembler \"\\tdpop\\t\" } } */\n+\n+NOMIPS16 int\n+f (long long a)\n+{\n+  return __builtin_popcountll (a);\n+}\n+\n+NOMIPS16 int\n+g (int a)\n+{\n+  return __builtin_popcount (a);\n+}"}]}