{"sha": "aa11163b181893ed79dc1c75547b0109b342372e", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6YWExMTE2M2IxODE4OTNlZDc5ZGMxYzc1NTQ3YjAxMDliMzQyMzcyZQ==", "commit": {"author": {"name": "Jan Hubicka", "email": "hubicka@ucw.cz", "date": "2017-06-16T19:02:46Z"}, "committer": {"name": "Jan Hubicka", "email": "hubicka@gcc.gnu.org", "date": "2017-06-16T19:02:46Z"}, "message": "gimple-ssa-isolate-paths.c (isolate_path): Set edge leading to path as unlikely; update profile.\n\n\n\t* gimple-ssa-isolate-paths.c (isolate_path): Set edge leading to path\n\tas unlikely; update profile.\n\nFrom-SVN: r249277", "tree": {"sha": "22146ca895c35eae24514389bea670f0509f1c89", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/22146ca895c35eae24514389bea670f0509f1c89"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/aa11163b181893ed79dc1c75547b0109b342372e", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/aa11163b181893ed79dc1c75547b0109b342372e", "html_url": "https://github.com/Rust-GCC/gccrs/commit/aa11163b181893ed79dc1c75547b0109b342372e", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/aa11163b181893ed79dc1c75547b0109b342372e/comments", "author": null, "committer": null, "parents": [{"sha": "8d71d7cd025d5b0b62a8cb9fd99c38f1b37fcc7d", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/8d71d7cd025d5b0b62a8cb9fd99c38f1b37fcc7d", "html_url": "https://github.com/Rust-GCC/gccrs/commit/8d71d7cd025d5b0b62a8cb9fd99c38f1b37fcc7d"}], "stats": {"total": 18, "additions": 18, "deletions": 0}, "files": [{"sha": "dfabe1752578002c6aa8cb8581c9224096724ada", "filename": "gcc/ChangeLog", "status": "modified", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/aa11163b181893ed79dc1c75547b0109b342372e/gcc%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/aa11163b181893ed79dc1c75547b0109b342372e/gcc%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2FChangeLog?ref=aa11163b181893ed79dc1c75547b0109b342372e", "patch": "@@ -1,3 +1,8 @@\n+2017-06-16  Jan Hubicka  <hubicka@ucw.cz>\n+\n+\t* gimple-ssa-isolate-paths.c (isolate_path): Set edge leading to path\n+\tas unlikely; update profile.\n+\n 2017-06-16  Jan Hubicka  <hubicka@ucw.cz>\n \n \t* predict.c (force_edge_cold): Handle declaring edges impossible"}, {"sha": "7ad39b4e09bb9f69189ba3d40c270bb116725709", "filename": "gcc/gimple-ssa-isolate-paths.c", "status": "modified", "additions": 13, "deletions": 0, "changes": 13, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/aa11163b181893ed79dc1c75547b0109b342372e/gcc%2Fgimple-ssa-isolate-paths.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/aa11163b181893ed79dc1c75547b0109b342372e/gcc%2Fgimple-ssa-isolate-paths.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fgimple-ssa-isolate-paths.c?ref=aa11163b181893ed79dc1c75547b0109b342372e", "patch": "@@ -137,6 +137,15 @@ isolate_path (basic_block bb, basic_block duplicate,\n   gimple_stmt_iterator si, si2;\n   edge_iterator ei;\n   edge e2;\n+  bool impossible = true;\n+\n+  for (si = gsi_start_bb (bb); gsi_stmt (si) != stmt; gsi_next (&si))\n+    if (stmt_can_terminate_bb_p (gsi_stmt (si)))\n+      {\n+\timpossible = false;\n+\tbreak;\n+      }\n+  force_edge_cold (e, impossible);\n \n   /* First duplicate BB if we have not done so already and remove all\n      the duplicate's outgoing edges as duplicate is going to unconditionally\n@@ -145,10 +154,14 @@ isolate_path (basic_block bb, basic_block duplicate,\n   if (!duplicate)\n     {\n       duplicate = duplicate_block (bb, NULL, NULL);\n+      bb->frequency = 0;\n+      bb->count = profile_count::zero ();\n       if (!ret_zero)\n \tfor (ei = ei_start (duplicate->succs); (e2 = ei_safe_edge (ei)); )\n \t  remove_edge (e2);\n     }\n+  bb->frequency += EDGE_FREQUENCY (e);\n+  bb->count += e->count;\n \n   /* Complete the isolation step by redirecting E to reach DUPLICATE.  */\n   e2 = redirect_edge_and_branch (e, duplicate);"}]}