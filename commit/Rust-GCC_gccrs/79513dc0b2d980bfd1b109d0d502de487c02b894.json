{"sha": "79513dc0b2d980bfd1b109d0d502de487c02b894", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6Nzk1MTNkYzBiMmQ5ODBiZmQxYjEwOWQwZDUwMmRlNDg3YzAyYjg5NA==", "commit": {"author": {"name": "Ian Lance Taylor", "email": "iant@golang.org", "date": "2021-08-20T18:33:29Z"}, "committer": {"name": "Ian Lance Taylor", "email": "iant@golang.org", "date": "2021-09-11T21:20:19Z"}, "message": "compiler: don't pad zero-sized trailing field in results struct\n\nNothing can take the address of that field anyhow.\n\nFixes PR go/101994\n\nReviewed-on: https://go-review.googlesource.com/c/gofrontend/+/343873", "tree": {"sha": "6b7e54fcd29baab91336719c02d4944fb2665f76", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/6b7e54fcd29baab91336719c02d4944fb2665f76"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/79513dc0b2d980bfd1b109d0d502de487c02b894", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/79513dc0b2d980bfd1b109d0d502de487c02b894", "html_url": "https://github.com/Rust-GCC/gccrs/commit/79513dc0b2d980bfd1b109d0d502de487c02b894", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/79513dc0b2d980bfd1b109d0d502de487c02b894/comments", "author": {"login": "ianlancetaylor", "id": 3194333, "node_id": "MDQ6VXNlcjMxOTQzMzM=", "avatar_url": "https://avatars.githubusercontent.com/u/3194333?v=4", "gravatar_id": "", "url": "https://api.github.com/users/ianlancetaylor", "html_url": "https://github.com/ianlancetaylor", "followers_url": "https://api.github.com/users/ianlancetaylor/followers", "following_url": "https://api.github.com/users/ianlancetaylor/following{/other_user}", "gists_url": "https://api.github.com/users/ianlancetaylor/gists{/gist_id}", "starred_url": "https://api.github.com/users/ianlancetaylor/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/ianlancetaylor/subscriptions", "organizations_url": "https://api.github.com/users/ianlancetaylor/orgs", "repos_url": "https://api.github.com/users/ianlancetaylor/repos", "events_url": "https://api.github.com/users/ianlancetaylor/events{/privacy}", "received_events_url": "https://api.github.com/users/ianlancetaylor/received_events", "type": "User", "site_admin": false}, "committer": {"login": "ianlancetaylor", "id": 3194333, "node_id": "MDQ6VXNlcjMxOTQzMzM=", "avatar_url": "https://avatars.githubusercontent.com/u/3194333?v=4", "gravatar_id": "", "url": "https://api.github.com/users/ianlancetaylor", "html_url": "https://github.com/ianlancetaylor", "followers_url": "https://api.github.com/users/ianlancetaylor/followers", "following_url": "https://api.github.com/users/ianlancetaylor/following{/other_user}", "gists_url": "https://api.github.com/users/ianlancetaylor/gists{/gist_id}", "starred_url": "https://api.github.com/users/ianlancetaylor/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/ianlancetaylor/subscriptions", "organizations_url": "https://api.github.com/users/ianlancetaylor/orgs", "repos_url": "https://api.github.com/users/ianlancetaylor/repos", "events_url": "https://api.github.com/users/ianlancetaylor/events{/privacy}", "received_events_url": "https://api.github.com/users/ianlancetaylor/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "5485bbebb3679245dd4bc7c149bbc940f8b2e632", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/5485bbebb3679245dd4bc7c149bbc940f8b2e632", "html_url": "https://github.com/Rust-GCC/gccrs/commit/5485bbebb3679245dd4bc7c149bbc940f8b2e632"}], "stats": {"total": 22, "additions": 19, "deletions": 3}, "files": [{"sha": "f481681650032924644cc3a4118e686909b943e8", "filename": "gcc/go/gofrontend/MERGE", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/79513dc0b2d980bfd1b109d0d502de487c02b894/gcc%2Fgo%2Fgofrontend%2FMERGE", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/79513dc0b2d980bfd1b109d0d502de487c02b894/gcc%2Fgo%2Fgofrontend%2FMERGE", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fgo%2Fgofrontend%2FMERGE?ref=79513dc0b2d980bfd1b109d0d502de487c02b894", "patch": "@@ -1,4 +1,4 @@\n-21b30eddc59d92a07264c3b21eb032d6c303d16f\n+c11d9f8275f2bbe9b05cdd815c79ac331f78e15c\n \n The first line of this file holds the git revision number of the last\n merge done from the gofrontend repository."}, {"sha": "cd692506efc0c057c4e2bf3aaec44a2c87cd3188", "filename": "gcc/go/gofrontend/types.cc", "status": "modified", "additions": 2, "deletions": 1, "changes": 3, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/79513dc0b2d980bfd1b109d0d502de487c02b894/gcc%2Fgo%2Fgofrontend%2Ftypes.cc", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/79513dc0b2d980bfd1b109d0d502de487c02b894/gcc%2Fgo%2Fgofrontend%2Ftypes.cc", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fgo%2Fgofrontend%2Ftypes.cc?ref=79513dc0b2d980bfd1b109d0d502de487c02b894", "patch": "@@ -5050,6 +5050,7 @@ Function_type::get_backend_fntype(Gogo* gogo)\n \t\t  Struct_type* st = Type::make_struct_type(sfl,\n \t\t\t\t\t\t\t   this->location());\n \t\t  st->set_is_struct_incomparable();\n+\t\t  st->set_is_results_struct();\n \t\t  ins.first->second = st->get_backend(gogo);\n \t\t}\n \t      bresult_struct = ins.first->second;\n@@ -6458,7 +6459,7 @@ get_backend_struct_fields(Gogo* gogo, Struct_type* type, bool use_placeholder,\n         saw_nonzero = true;\n     }\n   go_assert(i == fields->size());\n-  if (saw_nonzero && lastsize == 0)\n+  if (saw_nonzero && lastsize == 0 && !type->is_results_struct())\n     {\n       // For nonzero-sized structs which end in a zero-sized thing, we add\n       // an extra byte of padding to the type. This padding ensures that"}, {"sha": "0c5180668ea9e0e2f48eab34d0d70af38623d025", "filename": "gcc/go/gofrontend/types.h", "status": "modified", "additions": 16, "deletions": 1, "changes": 17, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/79513dc0b2d980bfd1b109d0d502de487c02b894/gcc%2Fgo%2Fgofrontend%2Ftypes.h", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/79513dc0b2d980bfd1b109d0d502de487c02b894/gcc%2Fgo%2Fgofrontend%2Ftypes.h", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fgo%2Fgofrontend%2Ftypes.h?ref=79513dc0b2d980bfd1b109d0d502de487c02b894", "patch": "@@ -2501,7 +2501,8 @@ class Struct_type : public Type\n   Struct_type(Struct_field_list* fields, Location location)\n     : Type(TYPE_STRUCT),\n       fields_(fields), location_(location), all_methods_(NULL),\n-      is_struct_incomparable_(false), has_padding_(false)\n+      is_struct_incomparable_(false), has_padding_(false),\n+      is_results_struct_(false)\n   { }\n \n   // Return the field NAME.  This only looks at local fields, not at\n@@ -2632,6 +2633,17 @@ class Struct_type : public Type\n   set_has_padding()\n   { this->has_padding_ = true; }\n \n+  // Return whether this is a results struct created to hold the\n+  // results of a function that returns multiple results.\n+  bool\n+  is_results_struct() const\n+  { return this->is_results_struct_; }\n+\n+  // Record that this is a results struct.\n+  void\n+  set_is_results_struct()\n+  { this->is_results_struct_ = true; }\n+\n   // Write the hash function for this type.\n   void\n   write_hash_function(Gogo*, Function_type*);\n@@ -2742,6 +2754,9 @@ class Struct_type : public Type\n   // True if this struct's backend type has padding, due to trailing\n   // zero-sized field.\n   bool has_padding_;\n+  // True if this is a results struct created to hold the results of a\n+  // function that returns multiple results.\n+  bool is_results_struct_;\n };\n \n // The type of an array."}]}