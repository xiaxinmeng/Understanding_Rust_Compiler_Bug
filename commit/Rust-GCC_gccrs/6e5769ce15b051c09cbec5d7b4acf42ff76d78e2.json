{"sha": "6e5769ce15b051c09cbec5d7b4acf42ff76d78e2", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6NmU1NzY5Y2UxNWIwNTFjMDljYmVjNWQ3YjRhY2Y0MmZmNzZkNzhlMg==", "commit": {"author": {"name": "Vladimir Makarov", "email": "vmakarov@redhat.com", "date": "2012-10-24T20:02:08Z"}, "committer": {"name": "Vladimir Makarov", "email": "vmakarov@gcc.gnu.org", "date": "2012-10-24T20:02:08Z"}, "message": "re PR rtl-optimization/55055 (RTL check: expected code 'reg', have 'subreg' in rhs_regno, at rtl.h:1123)\n\n2012-10-24  Vladimir Makarov  <vmakarov@redhat.com>\n\n\tPR rtl-optimization/55055\n\t* lra-spills.c (alter_subregs): New function.\n\t(lra_hard_reg_substitution): Use it.\n\nFrom-SVN: r192779", "tree": {"sha": "36ee294a9560f006e403f8db6c4ba8724bb2d744", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/36ee294a9560f006e403f8db6c4ba8724bb2d744"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/6e5769ce15b051c09cbec5d7b4acf42ff76d78e2", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/6e5769ce15b051c09cbec5d7b4acf42ff76d78e2", "html_url": "https://github.com/Rust-GCC/gccrs/commit/6e5769ce15b051c09cbec5d7b4acf42ff76d78e2", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/6e5769ce15b051c09cbec5d7b4acf42ff76d78e2/comments", "author": {"login": "vnmakarov", "id": 9855671, "node_id": "MDQ6VXNlcjk4NTU2NzE=", "avatar_url": "https://avatars.githubusercontent.com/u/9855671?v=4", "gravatar_id": "", "url": "https://api.github.com/users/vnmakarov", "html_url": "https://github.com/vnmakarov", "followers_url": "https://api.github.com/users/vnmakarov/followers", "following_url": "https://api.github.com/users/vnmakarov/following{/other_user}", "gists_url": "https://api.github.com/users/vnmakarov/gists{/gist_id}", "starred_url": "https://api.github.com/users/vnmakarov/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/vnmakarov/subscriptions", "organizations_url": "https://api.github.com/users/vnmakarov/orgs", "repos_url": "https://api.github.com/users/vnmakarov/repos", "events_url": "https://api.github.com/users/vnmakarov/events{/privacy}", "received_events_url": "https://api.github.com/users/vnmakarov/received_events", "type": "User", "site_admin": false}, "committer": null, "parents": [{"sha": "eb00e9592006bb3b5412a4857762e85ea56a8e3f", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/eb00e9592006bb3b5412a4857762e85ea56a8e3f", "html_url": "https://github.com/Rust-GCC/gccrs/commit/eb00e9592006bb3b5412a4857762e85ea56a8e3f"}], "stats": {"total": 67, "additions": 54, "deletions": 13}, "files": [{"sha": "9ee494d869ae9b2d83cfe0b94ff676475d3c8f44", "filename": "gcc/ChangeLog", "status": "modified", "additions": 6, "deletions": 0, "changes": 6, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/6e5769ce15b051c09cbec5d7b4acf42ff76d78e2/gcc%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/6e5769ce15b051c09cbec5d7b4acf42ff76d78e2/gcc%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2FChangeLog?ref=6e5769ce15b051c09cbec5d7b4acf42ff76d78e2", "patch": "@@ -1,3 +1,9 @@\n+2012-10-24  Vladimir Makarov  <vmakarov@redhat.com>\n+\n+\tPR rtl-optimization/55055\n+\t* lra-spills.c (alter_subregs): New function.\n+\t(lra_hard_reg_substitution): Use it.\n+\n 2012-10-24  Sharad Singhai  <singhai@google.com>\n \n \t* dumpfile.c (dump_enabled_p): Make it inline and move the definition"}, {"sha": "8ff91d811394436a9c6303ffb31dcc0f95f2c397", "filename": "gcc/lra-spills.c", "status": "modified", "additions": 48, "deletions": 13, "changes": 61, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/6e5769ce15b051c09cbec5d7b4acf42ff76d78e2/gcc%2Flra-spills.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/6e5769ce15b051c09cbec5d7b4acf42ff76d78e2/gcc%2Flra-spills.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Flra-spills.c?ref=6e5769ce15b051c09cbec5d7b4acf42ff76d78e2", "patch": "@@ -571,6 +571,48 @@ lra_spill (void)\n   free (pseudo_regnos);\n }\n \n+/* Apply alter_subreg for subregs of regs in *LOC.  Use FINAL_P for\n+   alter_subreg calls. Return true if any subreg of reg is\n+   processed.  */\n+static bool\n+alter_subregs (rtx *loc, bool final_p)\n+{\n+  int i;\n+  rtx x = *loc;\n+  bool res;\n+  const char *fmt;\n+  enum rtx_code code;\n+\n+  if (x == NULL_RTX)\n+    return false;\n+  code = GET_CODE (x);\n+  if (code == SUBREG && REG_P (SUBREG_REG (x)))\n+    {\n+      lra_assert (REGNO (SUBREG_REG (x)) < FIRST_PSEUDO_REGISTER);\n+      alter_subreg (loc, final_p);\n+      return true;\n+    }\n+  fmt = GET_RTX_FORMAT (code);\n+  res = false;\n+  for (i = GET_RTX_LENGTH (code) - 1; i >= 0; i--)\n+    {\n+      if (fmt[i] == 'e')\n+\t{\n+\t  if (alter_subregs (&XEXP (x, i), final_p))\n+\t    res = true;\n+\t}\n+      else if (fmt[i] == 'E')\n+\t{\n+\t  int j;\n+\t  \n+\t  for (j = XVECLEN (x, i) - 1; j >= 0; j--)\n+\t    if (alter_subregs (&XVECEXP (x, i, j), final_p))\n+\t      res = true;\n+\t}\n+    }\n+  return res;\n+}\n+\n /* Final change of pseudos got hard registers into the corresponding\n    hard registers.  */\n void\n@@ -589,22 +631,15 @@ lra_hard_reg_substitution (void)\n     FOR_BB_INSNS (bb, insn)\n       if (INSN_P (insn))\n \t{\n-\t  lra_insn_recog_data_t id;\n+\t  lra_insn_recog_data_t id = lra_get_insn_recog_data (insn);\n \t  bool insn_change_p = false;\n \n-\t  id = lra_get_insn_recog_data (insn);\n \t  for (i = id->insn_static_data->n_operands - 1; i >= 0; i--)\n-\t    {\n-\t      rtx op = *id->operand_loc[i];\n-\n-\t      if (GET_CODE (op) == SUBREG && REG_P (SUBREG_REG (op)))\n-\t\t{\n-\t\t  lra_assert (REGNO (SUBREG_REG (op)) < FIRST_PSEUDO_REGISTER);\n-\t\t  alter_subreg (id->operand_loc[i], ! DEBUG_INSN_P (insn));\n-\t\t  lra_update_dup (id, i);\n-\t\t  insn_change_p = true;\n-\t\t}\n-\t    }\n+\t    if (alter_subregs (id->operand_loc[i], ! DEBUG_INSN_P (insn)))\n+\t      {\n+\t\tlra_update_dup (id, i);\n+\t\tinsn_change_p = true;\n+\t      }\n \t  if (insn_change_p)\n \t    lra_update_operator_dups (id);\n \t}"}]}