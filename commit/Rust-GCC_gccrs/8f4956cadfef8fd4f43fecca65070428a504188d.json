{"sha": "8f4956cadfef8fd4f43fecca65070428a504188d", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6OGY0OTU2Y2FkZmVmOGZkNGY0M2ZlY2NhNjUwNzA0MjhhNTA0MTg4ZA==", "commit": {"author": {"name": "Maxim Ostapenko", "email": "m.ostapenko@samsung.com", "date": "2017-07-13T07:48:49Z"}, "committer": {"name": "Maxim Ostapenko", "email": "chefmax@gcc.gnu.org", "date": "2017-07-13T07:48:49Z"}, "message": "ASAN: fix ICE in gcc.dg/asan/pr80168.c on aarch64 -mabi=ilp32\n\ngcc/\n\t* asan.c (asan_emit_allocas_unpoison): Use ptr_mode for arguments\n\tduring expansion.\n\t* builtins.c (expand_asan_emit_allocas_unpoison): Likewise.\n\nFrom-SVN: r250176", "tree": {"sha": "cbcbf293d29c470c0cd5676d14c314239c404163", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/cbcbf293d29c470c0cd5676d14c314239c404163"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/8f4956cadfef8fd4f43fecca65070428a504188d", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/8f4956cadfef8fd4f43fecca65070428a504188d", "html_url": "https://github.com/Rust-GCC/gccrs/commit/8f4956cadfef8fd4f43fecca65070428a504188d", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/8f4956cadfef8fd4f43fecca65070428a504188d/comments", "author": null, "committer": null, "parents": [{"sha": "6eecb2932650cab7b3a19cce9e0cc90daf093f12", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/6eecb2932650cab7b3a19cce9e0cc90daf093f12", "html_url": "https://github.com/Rust-GCC/gccrs/commit/6eecb2932650cab7b3a19cce9e0cc90daf093f12"}], "stats": {"total": 19, "additions": 12, "deletions": 7}, "files": [{"sha": "4f7907aac4314d52632e0d23f2120510fa40434a", "filename": "gcc/ChangeLog", "status": "modified", "additions": 6, "deletions": 0, "changes": 6, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/8f4956cadfef8fd4f43fecca65070428a504188d/gcc%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/8f4956cadfef8fd4f43fecca65070428a504188d/gcc%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2FChangeLog?ref=8f4956cadfef8fd4f43fecca65070428a504188d", "patch": "@@ -1,3 +1,9 @@\n+2017-07-13  Maxim Ostapenko  <m.ostapenko@samsung.com>\n+\n+\t* asan.c (asan_emit_allocas_unpoison): Use ptr_mode for arguments\n+\tduring expansion.\n+\t* builtins.c (expand_asan_emit_allocas_unpoison): Likewise.\n+\n 2017-07-12  Michael Meissner  <meissner@linux.vnet.ibm.com>\n \n \tPR target/81193"}, {"sha": "89c2731e8cdb69d45fb91b345fdf7f081ad9e79d", "filename": "gcc/asan.c", "status": "modified", "additions": 3, "deletions": 2, "changes": 5, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/8f4956cadfef8fd4f43fecca65070428a504188d/gcc%2Fasan.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/8f4956cadfef8fd4f43fecca65070428a504188d/gcc%2Fasan.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fasan.c?ref=8f4956cadfef8fd4f43fecca65070428a504188d", "patch": "@@ -1567,9 +1567,10 @@ asan_emit_allocas_unpoison (rtx top, rtx bot, rtx_insn *before)\n   else\n     start_sequence ();\n   rtx ret = init_one_libfunc (\"__asan_allocas_unpoison\");\n+  top = convert_memory_address (ptr_mode, top);\n+  bot = convert_memory_address (ptr_mode, bot);\n   ret = emit_library_call_value (ret, NULL_RTX, LCT_NORMAL, ptr_mode, 2, top,\n-\t\t\t\t TYPE_MODE (pointer_sized_int_node), bot,\n-\t\t\t\t TYPE_MODE (pointer_sized_int_node));\n+\t\t\t\t ptr_mode, bot, ptr_mode);\n \n   do_pending_stack_adjust ();\n   rtx_insn *insns = get_insns ();"}, {"sha": "2deef725620b69ae855f21037e0dfb5fbf0336cc", "filename": "gcc/builtins.c", "status": "modified", "additions": 3, "deletions": 5, "changes": 8, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/8f4956cadfef8fd4f43fecca65070428a504188d/gcc%2Fbuiltins.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/8f4956cadfef8fd4f43fecca65070428a504188d/gcc%2Fbuiltins.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fbuiltins.c?ref=8f4956cadfef8fd4f43fecca65070428a504188d", "patch": "@@ -4972,13 +4972,11 @@ static rtx\n expand_asan_emit_allocas_unpoison (tree exp)\n {\n   tree arg0 = CALL_EXPR_ARG (exp, 0);\n-  rtx top = expand_expr (arg0, NULL_RTX, GET_MODE (virtual_stack_dynamic_rtx),\n-\t\t\t EXPAND_NORMAL);\n+  rtx top = expand_expr (arg0, NULL_RTX, ptr_mode, EXPAND_NORMAL);\n+  rtx bot = convert_memory_address (ptr_mode, virtual_stack_dynamic_rtx);\n   rtx ret = init_one_libfunc (\"__asan_allocas_unpoison\");\n   ret = emit_library_call_value (ret, NULL_RTX, LCT_NORMAL, ptr_mode, 2, top,\n-\t\t\t\t TYPE_MODE (pointer_sized_int_node),\n-\t\t\t\t virtual_stack_dynamic_rtx,\n-\t\t\t\t TYPE_MODE (pointer_sized_int_node));\n+\t\t\t\t ptr_mode, bot, ptr_mode);\n   return ret;\n }\n "}]}