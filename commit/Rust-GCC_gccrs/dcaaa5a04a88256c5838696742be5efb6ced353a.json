{"sha": "dcaaa5a04a88256c5838696742be5efb6ced353a", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6ZGNhYWE1YTA0YTg4MjU2YzU4Mzg2OTY3NDJiZTVlZmI2Y2VkMzUzYQ==", "commit": {"author": {"name": "Dimitris Papavasiliou", "email": "dpapavas@gmail.com", "date": "2014-04-24T15:58:44Z"}, "committer": {"name": "Mike Stump", "email": "mrs@gcc.gnu.org", "date": "2014-04-24T15:58:44Z"}, "message": "flag-types.h (enum ivar_visibility): Add.\n\n2014-04-24  Dimitris Papavasiliou  <dpapavas@gmail.com>\n\n\t    * flag-types.h (enum ivar_visibility): Add.\n\nc-family:\n\t    * c.opt (Wshadow-ivar, flocal-ivars, fivar-visibility): Add.\n\nobjc:\n\t* objc-act.c (objc_ivar_visibility, objc_default_ivar_visibility): Add.\n\t(objc_init): Initialize objc_default_ivar_visibility.\n\t(objc_start_class_interface): Use objc_default_ivar_visibility.\n\t(objc_start_class_implementation): Likewise.\n\t(objc_lookup_ivar): Implement -fno-local-ivars.\n\nFrom-SVN: r209753", "tree": {"sha": "ba1651fb43cb7ce456f3f31e912458a294219553", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/ba1651fb43cb7ce456f3f31e912458a294219553"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/dcaaa5a04a88256c5838696742be5efb6ced353a", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/dcaaa5a04a88256c5838696742be5efb6ced353a", "html_url": "https://github.com/Rust-GCC/gccrs/commit/dcaaa5a04a88256c5838696742be5efb6ced353a", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/dcaaa5a04a88256c5838696742be5efb6ced353a/comments", "author": null, "committer": null, "parents": [{"sha": "07fb62554c2667cc35033f7c6439acf3e35e1996", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/07fb62554c2667cc35033f7c6439acf3e35e1996", "html_url": "https://github.com/Rust-GCC/gccrs/commit/07fb62554c2667cc35033f7c6439acf3e35e1996"}], "stats": {"total": 88, "additions": 83, "deletions": 5}, "files": [{"sha": "a29383083b3759d9a038e14e8b3cbaca1f58d166", "filename": "gcc/ChangeLog", "status": "modified", "additions": 4, "deletions": 0, "changes": 4, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/dcaaa5a04a88256c5838696742be5efb6ced353a/gcc%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/dcaaa5a04a88256c5838696742be5efb6ced353a/gcc%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2FChangeLog?ref=dcaaa5a04a88256c5838696742be5efb6ced353a", "patch": "@@ -1,3 +1,7 @@\n+2014-04-24  Dimitris Papavasiliou  <dpapavas@gmail.com>\n+\n+\t* flag-types.h (enum ivar_visibility): Add.\n+\n 2014-04-24  Trevor Saunders  <tsaunders@mozilla.com>\n \n \t* config/sh/sh_treg_combine.c (sh_treg_combine::execute): Take"}, {"sha": "1b466ac4b51cd6fa906bf817559791f9e373ed10", "filename": "gcc/c-family/ChangeLog", "status": "modified", "additions": 4, "deletions": 0, "changes": 4, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/dcaaa5a04a88256c5838696742be5efb6ced353a/gcc%2Fc-family%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/dcaaa5a04a88256c5838696742be5efb6ced353a/gcc%2Fc-family%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fc-family%2FChangeLog?ref=dcaaa5a04a88256c5838696742be5efb6ced353a", "patch": "@@ -1,3 +1,7 @@\n+2014-04-24  Dimitris Papavasiliou  <dpapavas@gmail.com>\n+\n+\t* c.opt (Wshadow-ivar, flocal-ivars, fivar-visibility): Add.\n+\n 2014-04-23  Marek Polacek  <polacek@redhat.com>\n \n \t* c-common.c (handle_tm_wrap_attribute): Tweak error message."}, {"sha": "2bc06ba7bbac94a1bdeebb93536873fd8e80bcda", "filename": "gcc/c-family/c.opt", "status": "modified", "additions": 27, "deletions": 0, "changes": 27, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/dcaaa5a04a88256c5838696742be5efb6ced353a/gcc%2Fc-family%2Fc.opt", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/dcaaa5a04a88256c5838696742be5efb6ced353a/gcc%2Fc-family%2Fc.opt", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fc-family%2Fc.opt?ref=dcaaa5a04a88256c5838696742be5efb6ced353a", "patch": "@@ -684,6 +684,10 @@ Wselector\n ObjC ObjC++ Var(warn_selector) Warning\n Warn if a selector has multiple methods\n \n+Wshadow-ivar\n+ObjC ObjC++ Var(warn_shadow_ivar) Init(-1) Warning\n+Warn if a local declaration hides an instance variable\n+\n Wsequence-point\n C ObjC C++ ObjC++ Var(warn_sequence_point) Warning LangEnabledBy(C ObjC C++ ObjC++,Wall)\n Warn about possible violations of sequence point rules\n@@ -1038,6 +1042,29 @@ fnil-receivers\n ObjC ObjC++ Var(flag_nil_receivers) Init(1)\n Assume that receivers of Objective-C messages may be nil\n \n+flocal-ivars\n+ObjC ObjC++ Var(flag_local_ivars) Init(1)\n+Allow access to instance variables as if they were local declarations within instance method implementations.\n+\n+fivar-visibility=\n+ObjC ObjC++ Joined RejectNegative Enum(ivar_visibility) Var(default_ivar_visibility) Init(IVAR_VISIBILITY_PROTECTED)\n+-fvisibility=[private|protected|public|package]\tSet the default symbol visibility\n+\n+Enum\n+Name(ivar_visibility) Type(enum ivar_visibility) UnknownError(unrecognized ivar visibility value %qs)\n+\n+EnumValue\n+Enum(ivar_visibility) String(private) Value(IVAR_VISIBILITY_PRIVATE)\n+\n+EnumValue\n+Enum(ivar_visibility) String(protected) Value(IVAR_VISIBILITY_PROTECTED)\n+\n+EnumValue\n+Enum(ivar_visibility) String(public) Value(IVAR_VISIBILITY_PUBLIC)\n+\n+EnumValue\n+Enum(ivar_visibility) String(package) Value(IVAR_VISIBILITY_PACKAGE)\n+\n fnonansi-builtins\n C++ ObjC++ Var(flag_no_nonansi_builtin, 0)\n "}, {"sha": "fc3261bbbb72b2d1f98386d6ba7cd13efb541811", "filename": "gcc/flag-types.h", "status": "modified", "additions": 10, "deletions": 0, "changes": 10, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/dcaaa5a04a88256c5838696742be5efb6ced353a/gcc%2Fflag-types.h", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/dcaaa5a04a88256c5838696742be5efb6ced353a/gcc%2Fflag-types.h", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fflag-types.h?ref=dcaaa5a04a88256c5838696742be5efb6ced353a", "patch": "@@ -104,6 +104,16 @@ enum symbol_visibility\n };\n #endif\n \n+/* Enumerate Objective-c instance variable visibility settings. */\n+\n+enum ivar_visibility\n+{\n+  IVAR_VISIBILITY_PRIVATE,\n+  IVAR_VISIBILITY_PROTECTED,\n+  IVAR_VISIBILITY_PUBLIC,\n+  IVAR_VISIBILITY_PACKAGE\n+};\n+\n /* The stack reuse level.  */\n enum stack_reuse_level\n {"}, {"sha": "c10aa891d3da4842127716248749145b9fd27bd0", "filename": "gcc/objc/ChangeLog", "status": "modified", "additions": 8, "deletions": 0, "changes": 8, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/dcaaa5a04a88256c5838696742be5efb6ced353a/gcc%2Fobjc%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/dcaaa5a04a88256c5838696742be5efb6ced353a/gcc%2Fobjc%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fobjc%2FChangeLog?ref=dcaaa5a04a88256c5838696742be5efb6ced353a", "patch": "@@ -1,3 +1,11 @@\n+2014-04-24  Dimitris Papavasiliou  <dpapavas@gmail.com>\n+\n+\t* objc-act.c (objc_ivar_visibility, objc_default_ivar_visibility): Add.\n+\t(objc_init): Initialize objc_default_ivar_visibility.\n+\t(objc_start_class_interface): Use objc_default_ivar_visibility.\n+\t(objc_start_class_implementation): Likewise.\n+\t(objc_lookup_ivar): Implement -fno-local-ivars.\n+\n 2014-01-31  Marek Polacek  <polacek@redhat.com>\n \n \tPR c/59963"}, {"sha": "cda345b3de835a960c659ce04c63c9fc8365dda2", "filename": "gcc/objc/objc-act.c", "status": "modified", "additions": 30, "deletions": 5, "changes": 35, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/dcaaa5a04a88256c5838696742be5efb6ced353a/gcc%2Fobjc%2Fobjc-act.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/dcaaa5a04a88256c5838696742be5efb6ced353a/gcc%2Fobjc%2Fobjc-act.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fobjc%2Fobjc-act.c?ref=dcaaa5a04a88256c5838696742be5efb6ced353a", "patch": "@@ -226,7 +226,7 @@ struct imp_entry *imp_list = 0;\n int imp_count = 0;\t/* `@implementation' */\n int cat_count = 0;\t/* `@category' */\n \n-objc_ivar_visibility_kind objc_ivar_visibility;\n+objc_ivar_visibility_kind objc_ivar_visibility, objc_default_ivar_visibility;\n \n /* Use to generate method labels.  */\n static int method_slot = 0;\n@@ -394,6 +394,22 @@ objc_init (void)\n   if (!ok)\n     return false;\n \n+  /* Determine the default visibility for instance variables. */\n+  switch (default_ivar_visibility)\n+    {\n+    case IVAR_VISIBILITY_PRIVATE:\n+        objc_default_ivar_visibility = OBJC_IVAR_VIS_PRIVATE;\n+        break;\n+    case IVAR_VISIBILITY_PUBLIC:\n+        objc_default_ivar_visibility = OBJC_IVAR_VIS_PUBLIC;\n+        break;\n+    case IVAR_VISIBILITY_PACKAGE:\n+        objc_default_ivar_visibility = OBJC_IVAR_VIS_PACKAGE;\n+        break;\n+    default:\n+        objc_default_ivar_visibility = OBJC_IVAR_VIS_PROTECTED;\n+    }\n+      \n   /* Generate general types and push runtime-specific decls to file scope.  */\n   synth_module_prologue ();\n \n@@ -568,7 +584,7 @@ objc_start_class_interface (tree klass, tree super_class,\n   objc_interface_context\n     = objc_ivar_context\n     = start_class (CLASS_INTERFACE_TYPE, klass, super_class, protos, attributes);\n-  objc_ivar_visibility = OBJC_IVAR_VIS_PROTECTED;\n+  objc_ivar_visibility = objc_default_ivar_visibility;\n }\n \n void\n@@ -646,7 +662,7 @@ objc_start_class_implementation (tree klass, tree super_class)\n     = objc_ivar_context\n     = start_class (CLASS_IMPLEMENTATION_TYPE, klass, super_class, NULL_TREE,\n \t\t   NULL_TREE);\n-  objc_ivar_visibility = OBJC_IVAR_VIS_PROTECTED;\n+  objc_ivar_visibility = objc_default_ivar_visibility;\n }\n \n void\n@@ -9366,6 +9382,12 @@ objc_lookup_ivar (tree other, tree id)\n       && other && other != error_mark_node)\n     return other;\n \n+  /* Don't look up the ivar if the user has explicitly advised against\n+     it with -fno-local-ivars.  */\n+\n+  if (!flag_local_ivars)\n+    return other;\n+\n   /* Look up the ivar, but do not use it if it is not accessible.  */\n   ivar = is_ivar (objc_ivar_chain, id);\n \n@@ -9382,8 +9404,11 @@ objc_lookup_ivar (tree other, tree id)\n       && !DECL_FILE_SCOPE_P (other))\n #endif\n     {\n-      warning (0, \"local declaration of %qE hides instance variable\", id);\n-\n+      if (warn_shadow_ivar == 1 || (warn_shadow && warn_shadow_ivar != 0)) {\n+          warning (warn_shadow_ivar ? OPT_Wshadow_ivar : OPT_Wshadow,\n+                   \"local declaration of %qE hides instance variable\", id);\n+      }\n+        \n       return other;\n     }\n "}]}