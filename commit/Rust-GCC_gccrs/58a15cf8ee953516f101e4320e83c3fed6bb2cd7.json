{"sha": "58a15cf8ee953516f101e4320e83c3fed6bb2cd7", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6NThhMTVjZjhlZTk1MzUxNmYxMDFlNDMyMGU4M2MzZmVkNmJiMmNkNw==", "commit": {"author": {"name": "Jason Merrill", "email": "jason@redhat.com", "date": "2010-03-03T19:01:36Z"}, "committer": {"name": "Jason Merrill", "email": "jason@gcc.gnu.org", "date": "2010-03-03T19:01:36Z"}, "message": "re PR c++/12909 (ambiguity in mangling vector types)\n\n\tPR c++/12909\n\t* mangle.c: Include cgraph.h.\n\t(mangle_decl): If the mangled name will change in a later\n\tABI version, make the later mangled name an alias.\n\t* method.c (make_alias_for): Copy DECL_ARGUMENTS.\n\t* Make-lang.in (mangle.o): Depend on cgraph.h.\n\nFrom-SVN: r157201", "tree": {"sha": "b0e6ce167e689e6afaff218c91b0bafd5549edbd", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/b0e6ce167e689e6afaff218c91b0bafd5549edbd"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/58a15cf8ee953516f101e4320e83c3fed6bb2cd7", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/58a15cf8ee953516f101e4320e83c3fed6bb2cd7", "html_url": "https://github.com/Rust-GCC/gccrs/commit/58a15cf8ee953516f101e4320e83c3fed6bb2cd7", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/58a15cf8ee953516f101e4320e83c3fed6bb2cd7/comments", "author": {"login": "jicama", "id": 266146, "node_id": "MDQ6VXNlcjI2NjE0Ng==", "avatar_url": "https://avatars.githubusercontent.com/u/266146?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jicama", "html_url": "https://github.com/jicama", "followers_url": "https://api.github.com/users/jicama/followers", "following_url": "https://api.github.com/users/jicama/following{/other_user}", "gists_url": "https://api.github.com/users/jicama/gists{/gist_id}", "starred_url": "https://api.github.com/users/jicama/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jicama/subscriptions", "organizations_url": "https://api.github.com/users/jicama/orgs", "repos_url": "https://api.github.com/users/jicama/repos", "events_url": "https://api.github.com/users/jicama/events{/privacy}", "received_events_url": "https://api.github.com/users/jicama/received_events", "type": "User", "site_admin": false}, "committer": null, "parents": [{"sha": "2587aa3b3616a97fda88a87237e84577f76a096f", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/2587aa3b3616a97fda88a87237e84577f76a096f", "html_url": "https://github.com/Rust-GCC/gccrs/commit/2587aa3b3616a97fda88a87237e84577f76a096f"}], "stats": {"total": 83, "additions": 82, "deletions": 1}, "files": [{"sha": "1b0b72bc6ddb383ed35ce73a97fcb50a74b999e9", "filename": "gcc/cp/ChangeLog", "status": "modified", "additions": 9, "deletions": 0, "changes": 9, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/58a15cf8ee953516f101e4320e83c3fed6bb2cd7/gcc%2Fcp%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/58a15cf8ee953516f101e4320e83c3fed6bb2cd7/gcc%2Fcp%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fcp%2FChangeLog?ref=58a15cf8ee953516f101e4320e83c3fed6bb2cd7", "patch": "@@ -1,3 +1,12 @@\n+2010-03-03  Jason Merrill  <jason@redhat.com>\n+\n+\tPR c++/12909\n+\t* mangle.c: Include cgraph.h.\n+\t(mangle_decl): If the mangled name will change in a later\n+\tABI version, make the later mangled name an alias.\n+\t* method.c (make_alias_for): Copy DECL_ARGUMENTS.\n+\t* Make-lang.in (mangle.o): Depend on cgraph.h.\n+\n 2010-03-01  Marco Poletti  <poletti.marco@gmail.com>\n \n \t* pt.c (redeclare_class_template): Use error_n and inform_n."}, {"sha": "1484063fae5e9655447220717ecb050af56e733e", "filename": "gcc/cp/Make-lang.in", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/58a15cf8ee953516f101e4320e83c3fed6bb2cd7/gcc%2Fcp%2FMake-lang.in", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/58a15cf8ee953516f101e4320e83c3fed6bb2cd7/gcc%2Fcp%2FMake-lang.in", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fcp%2FMake-lang.in?ref=58a15cf8ee953516f101e4320e83c3fed6bb2cd7", "patch": "@@ -308,7 +308,7 @@ cp/optimize.o: cp/optimize.c $(CXX_TREE_H) $(TM_H) rtl.h $(INTEGRATE_H) \\\n   insn-config.h input.h $(PARAMS_H) debug.h $(TREE_INLINE_H) $(GIMPLE_H) \\\n   $(TARGET_H) tree-iterator.h $(CGRAPH_H)\n cp/mangle.o: cp/mangle.c $(CXX_TREE_H) $(TM_H) toplev.h $(REAL_H) \\\n-  gt-cp-mangle.h $(TARGET_H) $(TM_P_H)\n+  gt-cp-mangle.h $(TARGET_H) $(TM_P_H) $(CGRAPH_H)\n cp/parser.o: cp/parser.c $(CXX_TREE_H) $(TM_H) $(DIAGNOSTIC_H) gt-cp-parser.h \\\n   output.h $(TARGET_H) $(PLUGIN_H) intl.h\n cp/cp-gimplify.o: cp/cp-gimplify.c $(CXX_TREE_H) toplev.h $(C_COMMON_H) \\"}, {"sha": "9478092daf60be8f75afe950406605c5521b54c1", "filename": "gcc/cp/mangle.c", "status": "modified", "additions": 33, "deletions": 0, "changes": 33, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/58a15cf8ee953516f101e4320e83c3fed6bb2cd7/gcc%2Fcp%2Fmangle.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/58a15cf8ee953516f101e4320e83c3fed6bb2cd7/gcc%2Fcp%2Fmangle.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fcp%2Fmangle.c?ref=58a15cf8ee953516f101e4320e83c3fed6bb2cd7", "patch": "@@ -58,6 +58,7 @@ along with GCC; see the file COPYING3.  If not see\n #include \"varray.h\"\n #include \"flags.h\"\n #include \"target.h\"\n+#include \"cgraph.h\"\n \n /* Debugging support.  */\n \n@@ -3055,6 +3056,38 @@ mangle_decl (const tree decl)\n   tree id = mangle_decl_string (decl);\n   id = targetm.mangle_decl_assembler_name (decl, id);\n   SET_DECL_ASSEMBLER_NAME (decl, id);\n+\n+#ifdef ASM_OUTPUT_DEF\n+  if (G.need_abi_warning)\n+    {\n+      /* If the mangling will change in the future, emit an alias with the\n+\t future mangled name for forward-compatibility.  */\n+      int save_ver;\n+      tree id2, alias;\n+\n+      SET_IDENTIFIER_GLOBAL_VALUE (id, decl);\n+      if (IDENTIFIER_GLOBAL_VALUE (id) != decl)\n+\tinform (DECL_SOURCE_LOCATION (decl), \"-fabi-version=4 (or =0) \"\n+\t\t\"avoids this error with a change in vector mangling\");\n+\n+      if (TREE_CODE (decl) != FUNCTION_DECL)\n+\treturn;\n+\n+      save_ver = flag_abi_version;\n+      flag_abi_version = 0;\n+      id2 = mangle_decl_string (decl);\n+      id2 = targetm.mangle_decl_assembler_name (decl, id2);\n+      flag_abi_version = save_ver;\n+\n+      alias = make_alias_for (decl, id2);\n+      DECL_IGNORED_P (alias) = 1;\n+      TREE_PUBLIC (alias) = TREE_PUBLIC (decl);\n+      DECL_VISIBILITY (alias) = DECL_VISIBILITY (decl);\n+      if (vague_linkage_fn_p (decl))\n+\tDECL_WEAK (alias) = 1;\n+      cgraph_same_body_alias (alias, decl);\n+    }\n+#endif\n }\n \n /* Generate the mangled representation of TYPE.  */"}, {"sha": "c25cedba178c7817c7be9f0b31c30dcad6beaba7", "filename": "gcc/cp/method.c", "status": "modified", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/58a15cf8ee953516f101e4320e83c3fed6bb2cd7/gcc%2Fcp%2Fmethod.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/58a15cf8ee953516f101e4320e83c3fed6bb2cd7/gcc%2Fcp%2Fmethod.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fcp%2Fmethod.c?ref=58a15cf8ee953516f101e4320e83c3fed6bb2cd7", "patch": "@@ -234,6 +234,7 @@ make_alias_for (tree function, tree newid)\n   DECL_TEMPLATE_INSTANTIATED (alias) = 0;\n   DECL_TEMPLATE_INFO (alias) = NULL;\n   DECL_INITIAL (alias) = error_mark_node;\n+  DECL_ARGUMENTS (alias) = copy_list (DECL_ARGUMENTS (target));\n   TREE_ADDRESSABLE (alias) = 1;\n   TREE_USED (alias) = 1;\n   SET_DECL_ASSEMBLER_NAME (alias, DECL_NAME (alias));"}, {"sha": "77aaf9c6833549df06602742cb4581ef490d68a3", "filename": "gcc/testsuite/ChangeLog", "status": "modified", "additions": 6, "deletions": 0, "changes": 6, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/58a15cf8ee953516f101e4320e83c3fed6bb2cd7/gcc%2Ftestsuite%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/58a15cf8ee953516f101e4320e83c3fed6bb2cd7/gcc%2Ftestsuite%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2FChangeLog?ref=58a15cf8ee953516f101e4320e83c3fed6bb2cd7", "patch": "@@ -1,3 +1,9 @@\n+2010-03-03  Jason Merrill  <jason@redhat.com>\n+\n+\tPR c++/12909\n+\t* g++.dg/abi/mangle40.C: New.\n+\t* g++.dg/abi/mangle41.C: New.\n+\n 2010-03-03  Paul Thomas  <pault@gcc.gnu.org>\n \n \tPR fortran/43243"}, {"sha": "1d604ef162dc9b22e00a58a67466362a8c10a13e", "filename": "gcc/testsuite/g++.dg/abi/mangle40.C", "status": "added", "additions": 25, "deletions": 0, "changes": 25, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/58a15cf8ee953516f101e4320e83c3fed6bb2cd7/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Fabi%2Fmangle40.C", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/58a15cf8ee953516f101e4320e83c3fed6bb2cd7/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Fabi%2Fmangle40.C", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Fabi%2Fmangle40.C?ref=58a15cf8ee953516f101e4320e83c3fed6bb2cd7", "patch": "@@ -0,0 +1,25 @@\n+// PR c++/12909\n+// { dg-do compile { target i?86-*-* x86_64-*-* } }\n+// { dg-options \"-mavx -Wabi -fabi-version=2\" }\n+// { dg-final { scan-assembler \"weak\\[^\\n\\]*_Z1fIDv4_fEvT_\" } }\n+// { dg-final { scan-assembler \"weak\\[^\\n\\]*_Z1fIU8__vectorfEvT_\" } }\n+// { dg-final { scan-assembler \"weak\\[^\\n\\]*_ZN1AIU8__vectorfE1tE\" } }\n+\n+#include <x86intrin.h>\n+\n+template <class T>\n+struct A\n+{\n+  static T t;\n+};\n+\n+template <class T>\n+T A<T>::t;\t\t\t// { dg-warning \"mangled name\" }\n+\n+template <class T>\n+void f (T t) { }\t\t// { dg-warning \"mangled name\" }\n+\n+int main()\n+{\n+  f (A<__m128>::t);\n+}"}, {"sha": "3a9c04f77d00bee9f2101ccd1aa2a092abe0b8ed", "filename": "gcc/testsuite/g++.dg/abi/mangle41.C", "status": "added", "additions": 7, "deletions": 0, "changes": 7, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/58a15cf8ee953516f101e4320e83c3fed6bb2cd7/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Fabi%2Fmangle41.C", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/58a15cf8ee953516f101e4320e83c3fed6bb2cd7/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Fabi%2Fmangle41.C", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Fabi%2Fmangle41.C?ref=58a15cf8ee953516f101e4320e83c3fed6bb2cd7", "patch": "@@ -0,0 +1,7 @@\n+// PR c++/41959\n+// { dg-do compile { target i?86-*-* x86_64-*-* } }\n+// { dg-options \"-mavx -fabi-version=2\" }\n+\n+#include <x86intrin.h>\n+void f(__m128) { }\t\t// { dg-error \"previous\" }\n+void f(__m256) { }\t\t// { dg-message \"declaration|mangling\" }"}]}