{"sha": "33a5d8ccb5482e446410ffbba30f0b560fc1c8fc", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6MzNhNWQ4Y2NiNTQ4MmU0NDY0MTBmZmJiYTMwZjBiNTYwZmMxYzhmYw==", "commit": {"author": {"name": "Ian Lance Taylor", "email": "ian@gcc.gnu.org", "date": "2019-01-07T22:07:26Z"}, "committer": {"name": "Ian Lance Taylor", "email": "ian@gcc.gnu.org", "date": "2019-01-07T22:07:26Z"}, "message": "runtime: in doscanstackswitch, set gp->m before gogo\n    \n    This is following CL 156038. doscanstackswitch uses the same\n    mechanism of switching goroutines as getTraceback, and so has\n    the same problem as described in issue golang/go#29448. This CL\n    applies the same fix.\n    \n    Reviewed-on: https://go-review.googlesource.com/c/156697\n\nFrom-SVN: r267661", "tree": {"sha": "709c96bb2f7fb7e7419f59a1b0f0044acb36ce47", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/709c96bb2f7fb7e7419f59a1b0f0044acb36ce47"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/33a5d8ccb5482e446410ffbba30f0b560fc1c8fc", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/33a5d8ccb5482e446410ffbba30f0b560fc1c8fc", "html_url": "https://github.com/Rust-GCC/gccrs/commit/33a5d8ccb5482e446410ffbba30f0b560fc1c8fc", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/33a5d8ccb5482e446410ffbba30f0b560fc1c8fc/comments", "author": null, "committer": null, "parents": [{"sha": "fdcef314bcb0728d883cd87d6950d85217e82755", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/fdcef314bcb0728d883cd87d6950d85217e82755", "html_url": "https://github.com/Rust-GCC/gccrs/commit/fdcef314bcb0728d883cd87d6950d85217e82755"}], "stats": {"total": 15, "additions": 8, "deletions": 7}, "files": [{"sha": "267c32b4fd08e24c8e3e4180836e4fd213a45463", "filename": "gcc/go/gofrontend/MERGE", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/33a5d8ccb5482e446410ffbba30f0b560fc1c8fc/gcc%2Fgo%2Fgofrontend%2FMERGE", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/33a5d8ccb5482e446410ffbba30f0b560fc1c8fc/gcc%2Fgo%2Fgofrontend%2FMERGE", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fgo%2Fgofrontend%2FMERGE?ref=33a5d8ccb5482e446410ffbba30f0b560fc1c8fc", "patch": "@@ -1,4 +1,4 @@\n-c8a9bccbc524381d150c84907a61ac257c1b07cc\n+085ef4556ec810a5a9c422e7b86d98441dc92e86\n \n The first line of this file holds the git revision number of the last\n merge done from the gofrontend repository."}, {"sha": "1569b5bb898c189aa95271d52ba3dbbdff83fbf1", "filename": "libgo/runtime/proc.c", "status": "modified", "additions": 7, "deletions": 6, "changes": 13, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/33a5d8ccb5482e446410ffbba30f0b560fc1c8fc/libgo%2Fruntime%2Fproc.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/33a5d8ccb5482e446410ffbba30f0b560fc1c8fc/libgo%2Fruntime%2Fproc.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libgo%2Fruntime%2Fproc.c?ref=33a5d8ccb5482e446410ffbba30f0b560fc1c8fc", "patch": "@@ -482,9 +482,14 @@ void doscanstackswitch(G*, G*) __asm__(GOSYM_PREFIX \"runtime.doscanstackswitch\")\n void\n doscanstackswitch(G* me, G* gp)\n {\n+\tM* holdm;\n+\n \t__go_assert(me->entry == nil);\n \tme->fromgogo = false;\n \n+\tholdm = gp->m;\n+\tgp->m = me->m;\n+\n #ifdef USING_SPLIT_STACK\n \t__splitstack_getcontext((void*)(&me->stackcontext[0]));\n #endif\n@@ -507,6 +512,8 @@ doscanstackswitch(G* me, G* gp)\n \n \tif (gp->scang != 0)\n \t\truntime_gogo(gp);\n+\n+\tgp->m = holdm;\n }\n \n // Do a stack scan, then switch back to the g that triggers this scan.\n@@ -515,21 +522,15 @@ static void\n gscanstack(G *gp)\n {\n \tG *oldg, *oldcurg;\n-\tM* holdm;\n \n \toldg = (G*)gp->scang;\n \toldcurg = oldg->m->curg;\n-\tholdm = gp->m;\n-\tif(holdm != nil && holdm != g->m)\n-\t\truntime_throw(\"gscanstack: m is not nil\");\n \toldg->m->curg = gp;\n-\tgp->m = oldg->m;\n \tgp->scang = 0;\n \n \tdoscanstack(gp, (void*)gp->scangcw);\n \n \tgp->scangcw = 0;\n-\tgp->m = holdm;\n \toldg->m->curg = oldcurg;\n \truntime_gogo(oldg);\n }"}]}