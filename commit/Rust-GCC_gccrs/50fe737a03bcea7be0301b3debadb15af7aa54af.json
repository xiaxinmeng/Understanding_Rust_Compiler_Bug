{"sha": "50fe737a03bcea7be0301b3debadb15af7aa54af", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6NTBmZTczN2EwM2JjZWE3YmUwMzAxYjNkZWJhZGIxNWFmN2FhNTRhZg==", "commit": {"author": {"name": "Thomas Fitzsimmons", "email": "fitzsim@redhat.com", "date": "2003-08-22T20:33:50Z"}, "committer": {"name": "Thomas Fitzsimmons", "email": "fitzsim@gcc.gnu.org", "date": "2003-08-22T20:33:50Z"}, "message": "GdkGraphics.java (drawString): Pass font name, not XLFD, to native drawString.\n\n2003-08-22  Thomas Fitzsimmons  <fitzsim@redhat.com>\n\n\t* gnu/java/awt/peer/gtk/GdkGraphics.java (drawString): Pass font\n\tname, not XLFD, to native drawString.\n\t* jni/gtk-peer/gnu_java_awt_peer_gtk_GdkGraphics.c (drawString):\n\tReplace XLFD-based implementation with Pango-based\n\timplementation.\n\nFrom-SVN: r70698", "tree": {"sha": "2659c867c2e81ee9fa4fb77239ed3b3ce2f03896", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/2659c867c2e81ee9fa4fb77239ed3b3ce2f03896"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/50fe737a03bcea7be0301b3debadb15af7aa54af", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/50fe737a03bcea7be0301b3debadb15af7aa54af", "html_url": "https://github.com/Rust-GCC/gccrs/commit/50fe737a03bcea7be0301b3debadb15af7aa54af", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/50fe737a03bcea7be0301b3debadb15af7aa54af/comments", "author": null, "committer": null, "parents": [{"sha": "376de22592739c19b0d81eb295afd29ca53362d1", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/376de22592739c19b0d81eb295afd29ca53362d1", "html_url": "https://github.com/Rust-GCC/gccrs/commit/376de22592739c19b0d81eb295afd29ca53362d1"}], "stats": {"total": 46, "additions": 33, "deletions": 13}, "files": [{"sha": "bc0066d3f0e56064ae3daa573053319aa22f14e6", "filename": "libjava/ChangeLog", "status": "modified", "additions": 8, "deletions": 0, "changes": 8, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/50fe737a03bcea7be0301b3debadb15af7aa54af/libjava%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/50fe737a03bcea7be0301b3debadb15af7aa54af/libjava%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libjava%2FChangeLog?ref=50fe737a03bcea7be0301b3debadb15af7aa54af", "patch": "@@ -1,3 +1,11 @@\n+2003-08-22  Thomas Fitzsimmons  <fitzsim@redhat.com>\n+\n+\t* gnu/java/awt/peer/gtk/GdkGraphics.java (drawString): Pass font\n+\tname, not XLFD, to native drawString.\n+\t* jni/gtk-peer/gnu_java_awt_peer_gtk_GdkGraphics.c (drawString):\n+\tReplace XLFD-based implementation with Pango-based\n+\timplementation.\n+\n 2003-08-22  Thomas Fitzsimmons  <fitzsim@redhat.com>\n \n \t* gnu/java/awt/peer/gtk/GtkWindowPeer.java: Remove"}, {"sha": "9012da23cce4a43d63620d0343bef3e762e89ed4", "filename": "libjava/gnu/java/awt/peer/gtk/GdkGraphics.java", "status": "modified", "additions": 1, "deletions": 2, "changes": 3, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/50fe737a03bcea7be0301b3debadb15af7aa54af/libjava%2Fgnu%2Fjava%2Fawt%2Fpeer%2Fgtk%2FGdkGraphics.java", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/50fe737a03bcea7be0301b3debadb15af7aa54af/libjava%2Fgnu%2Fjava%2Fawt%2Fpeer%2Fgtk%2FGdkGraphics.java", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libjava%2Fgnu%2Fjava%2Fawt%2Fpeer%2Fgtk%2FGdkGraphics.java?ref=50fe737a03bcea7be0301b3debadb15af7aa54af", "patch": "@@ -215,8 +215,7 @@ native public void fillArc (int x, int y, int width, int height,\n   native void drawString (String str, int x, int y, String fname, int size);\n   public void drawString (String str, int x, int y)\n   {\n-    drawString (str, x, y,\n-\t\t((GtkFontPeer)font.getPeer ()).getXLFD (), font.getSize ());\n+    drawString (str, x, y, font.getName(), font.getSize());\n   }\n \n   public void drawString (AttributedCharacterIterator ci, int x, int y)"}, {"sha": "24b8f4e8c07d47aab8f53601d35e10b762841316", "filename": "libjava/jni/gtk-peer/gnu_java_awt_peer_gtk_GdkGraphics.c", "status": "modified", "additions": 23, "deletions": 10, "changes": 33, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/50fe737a03bcea7be0301b3debadb15af7aa54af/libjava%2Fjni%2Fgtk-peer%2Fgnu_java_awt_peer_gtk_GdkGraphics.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/50fe737a03bcea7be0301b3debadb15af7aa54af/libjava%2Fjni%2Fgtk-peer%2Fgnu_java_awt_peer_gtk_GdkGraphics.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libjava%2Fjni%2Fgtk-peer%2Fgnu_java_awt_peer_gtk_GdkGraphics.c?ref=50fe737a03bcea7be0301b3debadb15af7aa54af", "patch": "@@ -191,27 +191,40 @@ JNIEXPORT void JNICALL Java_gnu_java_awt_peer_gtk_GdkGraphics_drawString\n    jstring fname, jint size)\n {\n   struct graphics *g;\n-  const char *cfname, *cstr;\n-  gchar *xlfd;\n+  const char *cstr;\n+  const char *font_name;\n+  PangoFontDescription *font_desc;\n+  PangoContext *context;\n+  PangoLayout *layout;\n \n   g = (struct graphics *) NSA_GET_PTR (env, obj);\n-  \n-  cfname = (*env)->GetStringUTFChars (env, fname, NULL);\n-  xlfd = g_strdup_printf (cfname, (size * 10));\n-  (*env)->ReleaseStringUTFChars (env, fname, cfname);\n \n   cstr = (*env)->GetStringUTFChars (env, str, NULL);\n+  font_name = (*env)->GetStringUTFChars (env, fname, NULL);\n \n   gdk_threads_enter ();\n-  gdk_draw_string (g->drawable, gdk_font_load (xlfd), g->gc, \n-\t\t   x + g->x_offset, y + g->y_offset, cstr);\n+\n+  font_desc = pango_font_description_from_string (font_name);\n+  pango_font_description_set_size (font_desc, size * PANGO_SCALE);\n+\n+  context = gdk_pango_context_get();\n+  pango_context_set_font_description (context, font_desc);\n+\n+  layout = pango_layout_new (context);\n+\n+  pango_layout_set_text (layout, cstr, -1);\n+\n+  gdk_draw_layout (g->drawable, g->gc, \n+  \t\t   x + g->x_offset, y + g->y_offset, layout);\n+\n+  pango_font_description_free (font_desc);\n+\n   gdk_threads_leave ();\n \n+  (*env)->ReleaseStringUTFChars (env, fname, font_name);\n   (*env)->ReleaseStringUTFChars (env, str, cstr);\n-  g_free (xlfd);\n }\n \n-\n JNIEXPORT void JNICALL Java_gnu_java_awt_peer_gtk_GdkGraphics_drawLine\n   (JNIEnv *env, jobject obj, jint x, jint y, jint x2, jint y2)\n {"}, {"sha": "6559c5baf70afb472e108f8227673bd0526b035a", "filename": "libjava/jni/gtk-peer/gnu_java_awt_peer_gtk_GtkCanvasPeer.c", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/50fe737a03bcea7be0301b3debadb15af7aa54af/libjava%2Fjni%2Fgtk-peer%2Fgnu_java_awt_peer_gtk_GtkCanvasPeer.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/50fe737a03bcea7be0301b3debadb15af7aa54af/libjava%2Fjni%2Fgtk-peer%2Fgnu_java_awt_peer_gtk_GtkCanvasPeer.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libjava%2Fjni%2Fgtk-peer%2Fgnu_java_awt_peer_gtk_GtkCanvasPeer.c?ref=50fe737a03bcea7be0301b3debadb15af7aa54af", "patch": "@@ -43,7 +43,7 @@ JNIEXPORT void JNICALL Java_gnu_java_awt_peer_gtk_GtkCanvasPeer_create\n   (JNIEnv *env, jobject obj)\n {\n   gpointer widget;\n-    \n+\n   gdk_threads_enter ();\n   widget = gtk_type_new (gtk_drawing_area_get_type ());\n   gdk_threads_leave ();"}]}