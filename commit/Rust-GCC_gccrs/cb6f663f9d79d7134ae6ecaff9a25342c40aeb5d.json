{"sha": "cb6f663f9d79d7134ae6ecaff9a25342c40aeb5d", "node_id": "C_kwDOANBUbNoAKGNiNmY2NjNmOWQ3OWQ3MTM0YWU2ZWNhZmY5YTI1MzQyYzQwYWViNWQ", "commit": {"author": {"name": "Jonathan Wakely", "email": "jwakely@redhat.com", "date": "2023-03-28T10:12:58Z"}, "committer": {"name": "Jonathan Wakely", "email": "jwakely@redhat.com", "date": "2023-03-28T20:12:18Z"}, "message": "libstdc++: More fixes for null pointers used with std::char_traits\n\nThe std::char_traits member functions require that [p,p+n) is a valid\nrange, which is true for p==nullptr iff n==0. But we must not call\nmemcpy, memset etc, in that case, as they require non-null pointers even\nwhen n==0.\n\nThis std::char_traits<char> and std::char_traits<wchar_t> explicit\nspecializations are already correct, but the primary template has some\nbugs.\n\nlibstdc++-v3/ChangeLog:\n\n\t* include/bits/char_traits.h (char_traits::copy): Return without\n\tusing memcpy if n==0.\n\t(char_traits::assign): Likewise for memset.", "tree": {"sha": "7a187ca513f93f6dc064e062b94e0a2c57430558", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/7a187ca513f93f6dc064e062b94e0a2c57430558"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/cb6f663f9d79d7134ae6ecaff9a25342c40aeb5d", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/cb6f663f9d79d7134ae6ecaff9a25342c40aeb5d", "html_url": "https://github.com/Rust-GCC/gccrs/commit/cb6f663f9d79d7134ae6ecaff9a25342c40aeb5d", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/cb6f663f9d79d7134ae6ecaff9a25342c40aeb5d/comments", "author": {"login": "jwakely", "id": 1254480, "node_id": "MDQ6VXNlcjEyNTQ0ODA=", "avatar_url": "https://avatars.githubusercontent.com/u/1254480?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jwakely", "html_url": "https://github.com/jwakely", "followers_url": "https://api.github.com/users/jwakely/followers", "following_url": "https://api.github.com/users/jwakely/following{/other_user}", "gists_url": "https://api.github.com/users/jwakely/gists{/gist_id}", "starred_url": "https://api.github.com/users/jwakely/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jwakely/subscriptions", "organizations_url": "https://api.github.com/users/jwakely/orgs", "repos_url": "https://api.github.com/users/jwakely/repos", "events_url": "https://api.github.com/users/jwakely/events{/privacy}", "received_events_url": "https://api.github.com/users/jwakely/received_events", "type": "User", "site_admin": false}, "committer": {"login": "jwakely", "id": 1254480, "node_id": "MDQ6VXNlcjEyNTQ0ODA=", "avatar_url": "https://avatars.githubusercontent.com/u/1254480?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jwakely", "html_url": "https://github.com/jwakely", "followers_url": "https://api.github.com/users/jwakely/followers", "following_url": "https://api.github.com/users/jwakely/following{/other_user}", "gists_url": "https://api.github.com/users/jwakely/gists{/gist_id}", "starred_url": "https://api.github.com/users/jwakely/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jwakely/subscriptions", "organizations_url": "https://api.github.com/users/jwakely/orgs", "repos_url": "https://api.github.com/users/jwakely/repos", "events_url": "https://api.github.com/users/jwakely/events{/privacy}", "received_events_url": "https://api.github.com/users/jwakely/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "bf78b43873b0b7e8f9a430df38749b8b61f9c9b8", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/bf78b43873b0b7e8f9a430df38749b8b61f9c9b8", "html_url": "https://github.com/Rust-GCC/gccrs/commit/bf78b43873b0b7e8f9a430df38749b8b61f9c9b8"}], "stats": {"total": 12, "additions": 8, "deletions": 4}, "files": [{"sha": "68ed827f9826f37d9392c875eb622171a96d7682", "filename": "libstdc++-v3/include/bits/char_traits.h", "status": "modified", "additions": 8, "deletions": 4, "changes": 12, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/cb6f663f9d79d7134ae6ecaff9a25342c40aeb5d/libstdc%2B%2B-v3%2Finclude%2Fbits%2Fchar_traits.h", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/cb6f663f9d79d7134ae6ecaff9a25342c40aeb5d/libstdc%2B%2B-v3%2Finclude%2Fbits%2Fchar_traits.h", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libstdc%2B%2B-v3%2Finclude%2Fbits%2Fchar_traits.h?ref=cb6f663f9d79d7134ae6ecaff9a25342c40aeb5d", "patch": "@@ -263,6 +263,8 @@ _GLIBCXX_BEGIN_NAMESPACE_VERSION\n     char_traits<_CharT>::\n     copy(char_type* __s1, const char_type* __s2, std::size_t __n)\n     {\n+      if (__n == 0)\n+\treturn __s1;\n #if __cplusplus >= 202002L\n       if (std::__is_constant_evaluated())\n \t{\n@@ -271,7 +273,6 @@ _GLIBCXX_BEGIN_NAMESPACE_VERSION\n \t  return __s1;\n \t}\n #endif\n-\n       __builtin_memcpy(__s1, __s2, __n * sizeof(char_type));\n       return __s1;\n     }\n@@ -293,9 +294,12 @@ _GLIBCXX_BEGIN_NAMESPACE_VERSION\n \n       if _GLIBCXX17_CONSTEXPR (sizeof(_CharT) == 1 && __is_trivial(_CharT))\n \t{\n-\t  unsigned char __c;\n-\t  __builtin_memcpy(&__c, __builtin_addressof(__a), 1);\n-\t  __builtin_memset(__s, __c, __n);\n+\t  if (__n)\n+\t    {\n+\t      unsigned char __c;\n+\t      __builtin_memcpy(&__c, __builtin_addressof(__a), 1);\n+\t      __builtin_memset(__s, __c, __n);\n+\t    }\n \t}\n       else\n \t{"}]}