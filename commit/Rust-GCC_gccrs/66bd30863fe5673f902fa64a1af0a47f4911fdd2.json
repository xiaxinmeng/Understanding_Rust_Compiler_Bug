{"sha": "66bd30863fe5673f902fa64a1af0a47f4911fdd2", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6NjZiZDMwODYzZmU1NjczZjkwMmZhNjRhMWFmMGE0N2Y0OTExZmRkMg==", "commit": {"author": {"name": "David Malcolm", "email": "dmalcolm@redhat.com", "date": "2018-04-27T18:39:18Z"}, "committer": {"name": "David Malcolm", "email": "dmalcolm@gcc.gnu.org", "date": "2018-04-27T18:39:18Z"}, "message": "Don't offer suggestions for compiler-generated variables (PR c++/85515)\n\ngcc/cp/ChangeLog:\n\tPR c++/85515\n\t* name-lookup.c (consider_binding_level): Skip compiler-generated\n\tvariables.\n\t* search.c (lookup_field_fuzzy_info::fuzzy_lookup_field): Flatten\n\tnested if statements into a series of rejection tests.  Reject\n\tlambda-ignored entities as suggestions.\n\ngcc/testsuite/ChangeLog:\n\tPR c++/85515\n\t* g++.dg/pr85515-1.C: New test.\n\t* g++.dg/pr85515-2.C: New test.\n\nFrom-SVN: r259720", "tree": {"sha": "9d4bfe51102d1732770424d8fbdd728fd7a1b380", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/9d4bfe51102d1732770424d8fbdd728fd7a1b380"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/66bd30863fe5673f902fa64a1af0a47f4911fdd2", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/66bd30863fe5673f902fa64a1af0a47f4911fdd2", "html_url": "https://github.com/Rust-GCC/gccrs/commit/66bd30863fe5673f902fa64a1af0a47f4911fdd2", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/66bd30863fe5673f902fa64a1af0a47f4911fdd2/comments", "author": {"login": "davidmalcolm", "id": 1553248, "node_id": "MDQ6VXNlcjE1NTMyNDg=", "avatar_url": "https://avatars.githubusercontent.com/u/1553248?v=4", "gravatar_id": "", "url": "https://api.github.com/users/davidmalcolm", "html_url": "https://github.com/davidmalcolm", "followers_url": "https://api.github.com/users/davidmalcolm/followers", "following_url": "https://api.github.com/users/davidmalcolm/following{/other_user}", "gists_url": "https://api.github.com/users/davidmalcolm/gists{/gist_id}", "starred_url": "https://api.github.com/users/davidmalcolm/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/davidmalcolm/subscriptions", "organizations_url": "https://api.github.com/users/davidmalcolm/orgs", "repos_url": "https://api.github.com/users/davidmalcolm/repos", "events_url": "https://api.github.com/users/davidmalcolm/events{/privacy}", "received_events_url": "https://api.github.com/users/davidmalcolm/received_events", "type": "User", "site_admin": false}, "committer": null, "parents": [{"sha": "2885a4939a7c96441210d6b3507524b6970d1013", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/2885a4939a7c96441210d6b3507524b6970d1013", "html_url": "https://github.com/Rust-GCC/gccrs/commit/2885a4939a7c96441210d6b3507524b6970d1013"}], "stats": {"total": 74, "additions": 71, "deletions": 3}, "files": [{"sha": "d8e7089af859d94313acb5a602844f21e5040f23", "filename": "gcc/cp/ChangeLog", "status": "modified", "additions": 9, "deletions": 0, "changes": 9, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/66bd30863fe5673f902fa64a1af0a47f4911fdd2/gcc%2Fcp%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/66bd30863fe5673f902fa64a1af0a47f4911fdd2/gcc%2Fcp%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fcp%2FChangeLog?ref=66bd30863fe5673f902fa64a1af0a47f4911fdd2", "patch": "@@ -1,3 +1,12 @@\n+2018-04-27  David Malcolm  <dmalcolm@redhat.com>\n+\n+\tPR c++/85515\n+\t* name-lookup.c (consider_binding_level): Skip compiler-generated\n+\tvariables.\n+\t* search.c (lookup_field_fuzzy_info::fuzzy_lookup_field): Flatten\n+\tnested if statements into a series of rejection tests.  Reject\n+\tlambda-ignored entities as suggestions.\n+\n 2018-04-27  Jason Merrill  <jason@redhat.com>\n \n \t* cvt.c (cp_fold_convert): Use convert_ptrmem."}, {"sha": "2af2462825ca3b9117aa71f1ea37aeb82c4cf400", "filename": "gcc/cp/name-lookup.c", "status": "modified", "additions": 6, "deletions": 0, "changes": 6, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/66bd30863fe5673f902fa64a1af0a47f4911fdd2/gcc%2Fcp%2Fname-lookup.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/66bd30863fe5673f902fa64a1af0a47f4911fdd2/gcc%2Fcp%2Fname-lookup.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fcp%2Fname-lookup.c?ref=66bd30863fe5673f902fa64a1af0a47f4911fdd2", "patch": "@@ -5860,6 +5860,12 @@ consider_binding_level (tree name, best_match <tree, const char *> &bm,\n \t  && DECL_ANTICIPATED (d))\n \tcontinue;\n \n+      /* Skip compiler-generated variables (e.g. __for_begin/__for_end\n+\t within range for).  */\n+      if (TREE_CODE (d) == VAR_DECL\n+\t  && DECL_ARTIFICIAL (d))\n+\tcontinue;\n+\n       tree suggestion = DECL_NAME (d);\n       if (!suggestion)\n \tcontinue;"}, {"sha": "22c0492f535c1922808ecc7bd2ac02142c6d5915", "filename": "gcc/cp/search.c", "status": "modified", "additions": 10, "deletions": 3, "changes": 13, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/66bd30863fe5673f902fa64a1af0a47f4911fdd2/gcc%2Fcp%2Fsearch.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/66bd30863fe5673f902fa64a1af0a47f4911fdd2/gcc%2Fcp%2Fsearch.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fcp%2Fsearch.c?ref=66bd30863fe5673f902fa64a1af0a47f4911fdd2", "patch": "@@ -1224,9 +1224,16 @@ lookup_field_fuzzy_info::fuzzy_lookup_field (tree type)\n \n   for (tree field = TYPE_FIELDS (type); field; field = DECL_CHAIN (field))\n     {\n-      if (!m_want_type_p || DECL_DECLARES_TYPE_P (field))\n-\tif (DECL_NAME (field))\n-\t  m_candidates.safe_push (DECL_NAME (field));\n+      if (m_want_type_p && !DECL_DECLARES_TYPE_P (field))\n+\tcontinue;\n+\n+      if (!DECL_NAME (field))\n+\tcontinue;\n+\n+      if (is_lambda_ignored_entity (field))\n+\tcontinue;\n+\n+      m_candidates.safe_push (DECL_NAME (field));\n     }\n }\n "}, {"sha": "ce5eabadb5749924621cd535eae5f66980faee33", "filename": "gcc/testsuite/ChangeLog", "status": "modified", "additions": 6, "deletions": 0, "changes": 6, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/66bd30863fe5673f902fa64a1af0a47f4911fdd2/gcc%2Ftestsuite%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/66bd30863fe5673f902fa64a1af0a47f4911fdd2/gcc%2Ftestsuite%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2FChangeLog?ref=66bd30863fe5673f902fa64a1af0a47f4911fdd2", "patch": "@@ -1,3 +1,9 @@\n+2018-04-27  David Malcolm  <dmalcolm@redhat.com>\n+\n+\tPR c++/85515\n+\t* g++.dg/pr85515-1.C: New test.\n+\t* g++.dg/pr85515-2.C: New test.\n+\n 2018-04-27  Paolo Carlini  <paolo.carlini@oracle.com>\n \n \tPR c++/84691"}, {"sha": "0e27a9de6d9a19dbb50fb9731c5b94931726af1c", "filename": "gcc/testsuite/g++.dg/pr85515-1.C", "status": "added", "additions": 18, "deletions": 0, "changes": 18, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/66bd30863fe5673f902fa64a1af0a47f4911fdd2/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Fpr85515-1.C", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/66bd30863fe5673f902fa64a1af0a47f4911fdd2/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Fpr85515-1.C", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Fpr85515-1.C?ref=66bd30863fe5673f902fa64a1af0a47f4911fdd2", "patch": "@@ -0,0 +1,18 @@\n+// { dg-require-effective-target c++14 }\n+\n+void test_1 ()\n+{\n+  auto lambda = [val = 2](){};\n+  lambda.val; // { dg-bogus \"did you mean\" }\n+  // { dg-error \"has no member named 'val'\" \"\" { target *-*-* } .-1 }\n+}\n+\n+int test_2 ()\n+{\n+  auto lambda = [val = 2](){ return val; };\n+\n+  // TODO: should we issue an error for the following assignment?\n+  lambda.__val = 4;\n+\n+  return lambda();\n+}"}, {"sha": "621ddb87636f9e446659fcc65e0bf43e71783916", "filename": "gcc/testsuite/g++.dg/pr85515-2.C", "status": "added", "additions": 22, "deletions": 0, "changes": 22, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/66bd30863fe5673f902fa64a1af0a47f4911fdd2/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Fpr85515-2.C", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/66bd30863fe5673f902fa64a1af0a47f4911fdd2/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Fpr85515-2.C", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Fpr85515-2.C?ref=66bd30863fe5673f902fa64a1af0a47f4911fdd2", "patch": "@@ -0,0 +1,22 @@\n+// { dg-require-effective-target c++11 }\n+\n+void test_1 ()\n+{\n+  int arr[] = {1, 2, 3, 4, 5};\n+  for (const auto v: arr) {\n+    _forbegin; // { dg-bogus \"suggested alternative\" }\n+    // { dg-error \"'_forbegin' was not declared in this scope\" \"\" { target *-*-*} .-1 }\n+  }\n+}\n+\n+int test_2 ()\n+{\n+  int arr[] = {1, 2, 3, 4, 5};\n+  int sum = 0;\n+  for (const auto v: arr) {\n+    sum += v;\n+    // TODO: should we issue an error for the following assignment?\n+    __for_begin = __for_end;\n+  }\n+  return sum;\n+}"}]}