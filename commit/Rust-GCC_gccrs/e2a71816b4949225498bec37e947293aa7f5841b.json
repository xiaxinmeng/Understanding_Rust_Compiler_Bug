{"sha": "e2a71816b4949225498bec37e947293aa7f5841b", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6ZTJhNzE4MTZiNDk0OTIyNTQ5OGJlYzM3ZTk0NzI5M2FhN2Y1ODQxYg==", "commit": {"author": {"name": "Jakub Jelinek", "email": "jakub@redhat.com", "date": "2020-04-23T07:54:14Z"}, "committer": {"name": "Jakub Jelinek", "email": "jakub@redhat.com", "date": "2020-04-23T07:54:14Z"}, "message": "attribs: Don't diagnose attribute exclusions during error recovery [PR94705]\n\nOn the following testcase GCC ICEs, because last_decl is error_mark_node,\nand diag_attr_exclusions assumes that if it is not NULL, it must be a decl.\n\nThe following patch just doesn't diagnose attribute exclusions if the\nother decl is erroneous (and thus we've already reported errors for it).\n\n2020-04-23  Jakub Jelinek  <jakub@redhat.com>\n\n\tPR c/94705\n\t* attribs.c (decl_attribute): Don't diagnose attribute exclusions\n\tif last_decl is error_mark_node or has such a TREE_TYPE.\n\n\t* gcc.dg/pr94705.c: New test.", "tree": {"sha": "e4fc947b0d1b948672080b498981a07afe09841d", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/e4fc947b0d1b948672080b498981a07afe09841d"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/e2a71816b4949225498bec37e947293aa7f5841b", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/e2a71816b4949225498bec37e947293aa7f5841b", "html_url": "https://github.com/Rust-GCC/gccrs/commit/e2a71816b4949225498bec37e947293aa7f5841b", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/e2a71816b4949225498bec37e947293aa7f5841b/comments", "author": {"login": "jakubjelinek", "id": 9370665, "node_id": "MDQ6VXNlcjkzNzA2NjU=", "avatar_url": "https://avatars.githubusercontent.com/u/9370665?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jakubjelinek", "html_url": "https://github.com/jakubjelinek", "followers_url": "https://api.github.com/users/jakubjelinek/followers", "following_url": "https://api.github.com/users/jakubjelinek/following{/other_user}", "gists_url": "https://api.github.com/users/jakubjelinek/gists{/gist_id}", "starred_url": "https://api.github.com/users/jakubjelinek/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jakubjelinek/subscriptions", "organizations_url": "https://api.github.com/users/jakubjelinek/orgs", "repos_url": "https://api.github.com/users/jakubjelinek/repos", "events_url": "https://api.github.com/users/jakubjelinek/events{/privacy}", "received_events_url": "https://api.github.com/users/jakubjelinek/received_events", "type": "User", "site_admin": false}, "committer": {"login": "jakubjelinek", "id": 9370665, "node_id": "MDQ6VXNlcjkzNzA2NjU=", "avatar_url": "https://avatars.githubusercontent.com/u/9370665?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jakubjelinek", "html_url": "https://github.com/jakubjelinek", "followers_url": "https://api.github.com/users/jakubjelinek/followers", "following_url": "https://api.github.com/users/jakubjelinek/following{/other_user}", "gists_url": "https://api.github.com/users/jakubjelinek/gists{/gist_id}", "starred_url": "https://api.github.com/users/jakubjelinek/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jakubjelinek/subscriptions", "organizations_url": "https://api.github.com/users/jakubjelinek/orgs", "repos_url": "https://api.github.com/users/jakubjelinek/repos", "events_url": "https://api.github.com/users/jakubjelinek/events{/privacy}", "received_events_url": "https://api.github.com/users/jakubjelinek/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "49fc9f36a36e228c4fafb1a6a99fcfef83ff048e", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/49fc9f36a36e228c4fafb1a6a99fcfef83ff048e", "html_url": "https://github.com/Rust-GCC/gccrs/commit/49fc9f36a36e228c4fafb1a6a99fcfef83ff048e"}], "stats": {"total": 27, "additions": 26, "deletions": 1}, "files": [{"sha": "06f7eda00339cc8950fedffa21b11b2f8d500ac6", "filename": "gcc/ChangeLog", "status": "modified", "additions": 6, "deletions": 0, "changes": 6, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/e2a71816b4949225498bec37e947293aa7f5841b/gcc%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/e2a71816b4949225498bec37e947293aa7f5841b/gcc%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2FChangeLog?ref=e2a71816b4949225498bec37e947293aa7f5841b", "patch": "@@ -1,3 +1,9 @@\n+2020-04-23  Jakub Jelinek  <jakub@redhat.com>\n+\n+\tPR c/94705\n+\t* attribs.c (decl_attribute): Don't diagnose attribute exclusions\n+\tif last_decl is error_mark_node or has such a TREE_TYPE.\n+\n 2020-04-22  Felix Yang  <felix.yang@huawei.com>\n \n \tPR target/94678"}, {"sha": "7d0f4b5b7b4f9b64977b0111260b399ee9abb2cb", "filename": "gcc/attribs.c", "status": "modified", "additions": 2, "deletions": 1, "changes": 3, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/e2a71816b4949225498bec37e947293aa7f5841b/gcc%2Fattribs.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/e2a71816b4949225498bec37e947293aa7f5841b/gcc%2Fattribs.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fattribs.c?ref=e2a71816b4949225498bec37e947293aa7f5841b", "patch": "@@ -677,7 +677,8 @@ decl_attributes (tree *node, tree attributes, int flags,\n \t reject incompatible attributes.  */\n       bool built_in = flags & ATTR_FLAG_BUILT_IN;\n       if (spec->exclude\n-\t  && (flag_checking || !built_in))\n+\t  && (flag_checking || !built_in)\n+\t  && !error_operand_p (last_decl))\n \t{\n \t  /* Always check attributes on user-defined functions.\n \t     Check them on built-ins only when -fchecking is set."}, {"sha": "684e408c1a55a53b6fc9aea3c00b7851faf8ee46", "filename": "gcc/testsuite/ChangeLog", "status": "modified", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/e2a71816b4949225498bec37e947293aa7f5841b/gcc%2Ftestsuite%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/e2a71816b4949225498bec37e947293aa7f5841b/gcc%2Ftestsuite%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2FChangeLog?ref=e2a71816b4949225498bec37e947293aa7f5841b", "patch": "@@ -1,3 +1,8 @@\n+2020-04-23  Jakub Jelinek  <jakub@redhat.com>\n+\n+\tPR c/94705\n+\t* gcc.dg/pr94705.c: New test.\n+\n 2020-04-22  Patrick Palka  <ppalka@redhat.com>\n \n \tPR c++/94719"}, {"sha": "96392ab60ee12eb57e65e774b85594ff03ddb2b8", "filename": "gcc/testsuite/gcc.dg/pr94705.c", "status": "added", "additions": 13, "deletions": 0, "changes": 13, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/e2a71816b4949225498bec37e947293aa7f5841b/gcc%2Ftestsuite%2Fgcc.dg%2Fpr94705.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/e2a71816b4949225498bec37e947293aa7f5841b/gcc%2Ftestsuite%2Fgcc.dg%2Fpr94705.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgcc.dg%2Fpr94705.c?ref=e2a71816b4949225498bec37e947293aa7f5841b", "patch": "@@ -0,0 +1,13 @@\n+/* PR c/94705 */\n+/* { dg-do compile } */\n+/* { dg-options \"\" } */\n+\n+void foo ();\n+\n+int\n+bar (void)\n+{\n+  foo (baz);\t/* { dg-error \"'baz' undeclared\" } */\n+\t\t/* { dg-message \"only once\" \"\" { target *-*-* } .-1 } */\n+  void __attribute__ ((noinline)) baz (void);\n+}"}]}