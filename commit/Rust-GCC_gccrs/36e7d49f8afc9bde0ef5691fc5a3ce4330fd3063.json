{"sha": "36e7d49f8afc9bde0ef5691fc5a3ce4330fd3063", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6MzZlN2Q0OWY4YWZjOWJkZTBlZjU2OTFmYzVhM2NlNDMzMGZkMzA2Mw==", "commit": {"author": {"name": "Justin Squirek", "email": "squirek@adacore.com", "date": "2018-05-24T13:05:20Z"}, "committer": {"name": "Pierre-Marie de Rodat", "email": "pmderodat@gcc.gnu.org", "date": "2018-05-24T13:05:20Z"}, "message": "[Ada] Ineffective use warning is suppressed when performing verification\n\nThis patch fixes an issue whereby the compiler incorrectly marked use clauses\nas effective due to code generated for verification referencing certain types\nleading to missing use clause warnings.\n\nNo reasonably small testcase available.\n\n2018-05-24  Justin Squirek  <squirek@adacore.com>\n\ngcc/ada/\n\n\t* sem_res.adb (Resolve_Entity_Name): Add guard to protect against\n\tmarking use clauses as effective when the reference appears within\n\tgenerated code.\n\nFrom-SVN: r260652", "tree": {"sha": "a1f671816f03d35cf2f2d90b42ac6661e47fd123", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/a1f671816f03d35cf2f2d90b42ac6661e47fd123"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/36e7d49f8afc9bde0ef5691fc5a3ce4330fd3063", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/36e7d49f8afc9bde0ef5691fc5a3ce4330fd3063", "html_url": "https://github.com/Rust-GCC/gccrs/commit/36e7d49f8afc9bde0ef5691fc5a3ce4330fd3063", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/36e7d49f8afc9bde0ef5691fc5a3ce4330fd3063/comments", "author": {"login": "AdaDoom3", "id": 3445599, "node_id": "MDQ6VXNlcjM0NDU1OTk=", "avatar_url": "https://avatars.githubusercontent.com/u/3445599?v=4", "gravatar_id": "", "url": "https://api.github.com/users/AdaDoom3", "html_url": "https://github.com/AdaDoom3", "followers_url": "https://api.github.com/users/AdaDoom3/followers", "following_url": "https://api.github.com/users/AdaDoom3/following{/other_user}", "gists_url": "https://api.github.com/users/AdaDoom3/gists{/gist_id}", "starred_url": "https://api.github.com/users/AdaDoom3/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/AdaDoom3/subscriptions", "organizations_url": "https://api.github.com/users/AdaDoom3/orgs", "repos_url": "https://api.github.com/users/AdaDoom3/repos", "events_url": "https://api.github.com/users/AdaDoom3/events{/privacy}", "received_events_url": "https://api.github.com/users/AdaDoom3/received_events", "type": "User", "site_admin": false}, "committer": null, "parents": [{"sha": "37a104eaa89a54f7c1a64a58c332fc04d2d757a6", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/37a104eaa89a54f7c1a64a58c332fc04d2d757a6", "html_url": "https://github.com/Rust-GCC/gccrs/commit/37a104eaa89a54f7c1a64a58c332fc04d2d757a6"}], "stats": {"total": 14, "additions": 13, "deletions": 1}, "files": [{"sha": "6707a1aef0431514422ea3f8b3d7e63b50f61ba9", "filename": "gcc/ada/ChangeLog", "status": "modified", "additions": 6, "deletions": 0, "changes": 6, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/36e7d49f8afc9bde0ef5691fc5a3ce4330fd3063/gcc%2Fada%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/36e7d49f8afc9bde0ef5691fc5a3ce4330fd3063/gcc%2Fada%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fada%2FChangeLog?ref=36e7d49f8afc9bde0ef5691fc5a3ce4330fd3063", "patch": "@@ -1,3 +1,9 @@\n+2018-05-24  Justin Squirek  <squirek@adacore.com>\n+\n+\t* sem_res.adb (Resolve_Entity_Name): Add guard to protect against\n+\tmarking use clauses as effective when the reference appears within\n+\tgenerated code.\n+\n 2018-05-24  Cyrille Comar  <comar@adacore.com>\n \n \t* doc/gnat_rm/the_gnat_library.rst: Fix typos."}, {"sha": "f6caccc536243dfcfff752f44f4267e55cb3decd", "filename": "gcc/ada/sem_res.adb", "status": "modified", "additions": 7, "deletions": 1, "changes": 8, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/36e7d49f8afc9bde0ef5691fc5a3ce4330fd3063/gcc%2Fada%2Fsem_res.adb", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/36e7d49f8afc9bde0ef5691fc5a3ce4330fd3063/gcc%2Fada%2Fsem_res.adb", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fada%2Fsem_res.adb?ref=36e7d49f8afc9bde0ef5691fc5a3ce4330fd3063", "patch": "@@ -7293,7 +7293,13 @@ package body Sem_Res is\n          end if;\n       end if;\n \n-      Mark_Use_Clauses (E);\n+      --  We may be resolving an entity within expanded code, so a reference\n+      --  to an entity should be ignored when calculating effective use clauses\n+      --  to avoid inappropriate marking.\n+\n+      if Comes_From_Source (N) then\n+         Mark_Use_Clauses (E);\n+      end if;\n    end Resolve_Entity_Name;\n \n    -------------------"}]}