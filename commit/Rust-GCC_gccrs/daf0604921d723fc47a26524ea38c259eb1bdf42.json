{"sha": "daf0604921d723fc47a26524ea38c259eb1bdf42", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6ZGFmMDYwNDkyMWQ3MjNmYzQ3YTI2NTI0ZWEzOGMyNTllYjFiZGY0Mg==", "commit": {"author": {"name": "Jakub Jelinek", "email": "jakub@redhat.com", "date": "2002-08-07T23:20:35Z"}, "committer": {"name": "Jakub Jelinek", "email": "jakub@gcc.gnu.org", "date": "2002-08-07T23:20:35Z"}, "message": "stor-layout.c (place_union_field): For bitfields if PCC_BITFIELD_TYPE_MATTERS and TYPE_USER_ALIGN...\n\n\t* stor-layout.c (place_union_field): For bitfields if\n\tPCC_BITFIELD_TYPE_MATTERS and TYPE_USER_ALIGN, set record's\n\tTYPE_USER_ALIGN.\n\n\t* gcc.dg/bitfld-3.c: New test.\n\nFrom-SVN: r56112", "tree": {"sha": "9937e8dd70694ce6598cdf005340e12b054b06a7", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/9937e8dd70694ce6598cdf005340e12b054b06a7"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/daf0604921d723fc47a26524ea38c259eb1bdf42", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/daf0604921d723fc47a26524ea38c259eb1bdf42", "html_url": "https://github.com/Rust-GCC/gccrs/commit/daf0604921d723fc47a26524ea38c259eb1bdf42", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/daf0604921d723fc47a26524ea38c259eb1bdf42/comments", "author": {"login": "jakubjelinek", "id": 9370665, "node_id": "MDQ6VXNlcjkzNzA2NjU=", "avatar_url": "https://avatars.githubusercontent.com/u/9370665?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jakubjelinek", "html_url": "https://github.com/jakubjelinek", "followers_url": "https://api.github.com/users/jakubjelinek/followers", "following_url": "https://api.github.com/users/jakubjelinek/following{/other_user}", "gists_url": "https://api.github.com/users/jakubjelinek/gists{/gist_id}", "starred_url": "https://api.github.com/users/jakubjelinek/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jakubjelinek/subscriptions", "organizations_url": "https://api.github.com/users/jakubjelinek/orgs", "repos_url": "https://api.github.com/users/jakubjelinek/repos", "events_url": "https://api.github.com/users/jakubjelinek/events{/privacy}", "received_events_url": "https://api.github.com/users/jakubjelinek/received_events", "type": "User", "site_admin": false}, "committer": null, "parents": [{"sha": "043d39a683dfc5cddfe7042548cb39e3578365b2", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/043d39a683dfc5cddfe7042548cb39e3578365b2", "html_url": "https://github.com/Rust-GCC/gccrs/commit/043d39a683dfc5cddfe7042548cb39e3578365b2"}], "stats": {"total": 83, "additions": 83, "deletions": 0}, "files": [{"sha": "998b227b90e0ab682ea85b472d6cbaff6720db6d", "filename": "gcc/ChangeLog", "status": "modified", "additions": 6, "deletions": 0, "changes": 6, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/daf0604921d723fc47a26524ea38c259eb1bdf42/gcc%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/daf0604921d723fc47a26524ea38c259eb1bdf42/gcc%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2FChangeLog?ref=daf0604921d723fc47a26524ea38c259eb1bdf42", "patch": "@@ -1,3 +1,9 @@\n+2002-08-08  Jakub Jelinek  <jakub@redhat.com>\n+\n+\t* stor-layout.c (place_union_field): For bitfields if\n+\tPCC_BITFIELD_TYPE_MATTERS and TYPE_USER_ALIGN, set record's\n+\tTYPE_USER_ALIGN.\n+\n 2002-08-07  John David Anglin  <dave@hiauly1.hia.nrc.ca>\n \n \t* pa.c (struct deferred_plabel): Constify name field."}, {"sha": "28d8f6218d1a7e01a6d7ef06755ba02eec0bb4da", "filename": "gcc/stor-layout.c", "status": "modified", "additions": 6, "deletions": 0, "changes": 6, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/daf0604921d723fc47a26524ea38c259eb1bdf42/gcc%2Fstor-layout.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/daf0604921d723fc47a26524ea38c259eb1bdf42/gcc%2Fstor-layout.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fstor-layout.c?ref=daf0604921d723fc47a26524ea38c259eb1bdf42", "patch": "@@ -694,6 +694,7 @@ place_union_field (rli, field)\n #endif\n       rli->record_align = MAX (rli->record_align, type_align);\n       rli->unpadded_align = MAX (rli->unpadded_align, type_align);\n+      TYPE_USER_ALIGN (rli->t) |= TYPE_USER_ALIGN (TREE_TYPE (field));\n     }\n #endif\n \n@@ -849,6 +850,7 @@ place_field (rli, field)\n \t  rli->unpadded_align = MAX (rli->unpadded_align, DECL_ALIGN (field));\n \t  if (warn_packed)\n \t    rli->unpacked_align = MAX (rli->unpacked_align, TYPE_ALIGN (type));\n+\t  user_align |= TYPE_USER_ALIGN (type);\n \t}\n     }\n   else\n@@ -941,6 +943,8 @@ place_field (rli, field)\n \t   - (offset * BITS_PER_UNIT + bit_offset) / type_align)\n \t  > tree_low_cst (TYPE_SIZE (type), 1) / type_align)\n \trli->bitpos = round_up (rli->bitpos, type_align);\n+\n+      user_align |= TYPE_USER_ALIGN (type);\n     }\n #endif\n \n@@ -982,6 +986,8 @@ place_field (rli, field)\n \t  != ((offset * BITS_PER_UNIT + bit_offset + field_size - 1)\n \t      / type_align))\n \trli->bitpos = round_up (rli->bitpos, type_align);\n+\n+      user_align |= TYPE_USER_ALIGN (type);\n     }\n #endif\n "}, {"sha": "014919ddd33717e1154945d515eb190decfe701d", "filename": "gcc/testsuite/ChangeLog", "status": "modified", "additions": 4, "deletions": 0, "changes": 4, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/daf0604921d723fc47a26524ea38c259eb1bdf42/gcc%2Ftestsuite%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/daf0604921d723fc47a26524ea38c259eb1bdf42/gcc%2Ftestsuite%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2FChangeLog?ref=daf0604921d723fc47a26524ea38c259eb1bdf42", "patch": "@@ -1,3 +1,7 @@\n+2002-08-08  Jakub Jelinek  <jakub@redhat.com>\n+\n+\t* gcc.dg/bitfld-3.c: New test.\n+\n 2002-08-07  Jakub Jelinek  <jakub@redhat.com>\n \t    Richard Henderson  <rth@redhat.com>\n "}, {"sha": "3843acb6e393ebaf23a30b95e1f712c6c76a1c9c", "filename": "gcc/testsuite/gcc.dg/bitfld-3.c", "status": "added", "additions": 67, "deletions": 0, "changes": 67, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/daf0604921d723fc47a26524ea38c259eb1bdf42/gcc%2Ftestsuite%2Fgcc.dg%2Fbitfld-3.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/daf0604921d723fc47a26524ea38c259eb1bdf42/gcc%2Ftestsuite%2Fgcc.dg%2Fbitfld-3.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgcc.dg%2Fbitfld-3.c?ref=daf0604921d723fc47a26524ea38c259eb1bdf42", "patch": "@@ -0,0 +1,67 @@\n+/* Test for bitfield alignment in structs and unions.  */\n+/* { dg-do run }  */\n+/* { dg-options \"-O2\" }  */\n+\n+extern void abort (void);\n+extern void exit (int);\n+\n+typedef long la __attribute__((aligned (8)));\n+\n+struct A\n+{\n+  char a;\n+  union UA\n+  {\n+    char x;\n+    la y : 6;\n+  } b;\n+  char c;\n+} a;\n+\n+struct B\n+{\n+  char a;\n+  union UB\n+  {\n+    char x;\n+    long y : 6 __attribute__((aligned (8)));\n+  } b;\n+  char c;\n+} b;\n+\n+struct C\n+{\n+  char a;\n+  struct UC\n+  {\n+    la y : 6;\n+  } b;\n+  char c;\n+} c;\n+\n+struct D\n+{\n+  char a;\n+  struct UD\n+  {\n+    long y : 6 __attribute__((aligned (8)));\n+  } b;\n+  char c;\n+} d;\n+\n+int main (void)\n+{\n+  if (sizeof (a) != sizeof (b))\n+    abort ();\n+  if (sizeof (a) != sizeof (c))\n+    abort ();\n+  if (sizeof (a) != sizeof (d))\n+    abort ();\n+  if ((&a.c - &a.a) != (&b.c - &b.a))\n+    abort ();\n+  if ((&a.c - &a.a) != (&c.c - &c.a))\n+    abort ();\n+  if ((&a.c - &a.a) != (&d.c - &d.a))\n+    abort ();\n+  exit (0);\n+}"}]}