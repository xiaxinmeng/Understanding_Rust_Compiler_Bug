{"sha": "bdeb5f0c355d5f6d0d95798cd8c8de42ef80a853", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6YmRlYjVmMGMzNTVkNWY2ZDBkOTU3OThjZDhjOGRlNDJlZjgwYTg1Mw==", "commit": {"author": {"name": "Richard Henderson", "email": "rth@redhat.com", "date": "2009-09-22T15:14:32Z"}, "committer": {"name": "Richard Henderson", "email": "rth@gcc.gnu.org", "date": "2009-09-22T15:14:32Z"}, "message": "mn10300.c (TARGET_ASM_TRAMPOLINE_TEMPLATE, [...]): New.\n\n        * config/mn10300/mn10300.c (TARGET_ASM_TRAMPOLINE_TEMPLATE,\n        mn10300_asm_trampoline_template, TARGET_TRAMPOLINE_INIT,\n        mn10300_trampoline_init): New.\n        * config/mn10300/mn10300.h (TRAMPOLINE_TEMPLATE): Move code to\n        mn10300_asm_trampoline_template.\n        (INITIALIZE_TRAMPOLINE): Move code to mn10300_trampoline_init.\n\nFrom-SVN: r152003", "tree": {"sha": "0de8e1f6bd3972146e34dccdc5a97e243f17a26b", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/0de8e1f6bd3972146e34dccdc5a97e243f17a26b"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/bdeb5f0c355d5f6d0d95798cd8c8de42ef80a853", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/bdeb5f0c355d5f6d0d95798cd8c8de42ef80a853", "html_url": "https://github.com/Rust-GCC/gccrs/commit/bdeb5f0c355d5f6d0d95798cd8c8de42ef80a853", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/bdeb5f0c355d5f6d0d95798cd8c8de42ef80a853/comments", "author": null, "committer": null, "parents": [{"sha": "dbbdb385c4ec0ee9f2500ab53b81ae0e79ad9b5c", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/dbbdb385c4ec0ee9f2500ab53b81ae0e79ad9b5c", "html_url": "https://github.com/Rust-GCC/gccrs/commit/dbbdb385c4ec0ee9f2500ab53b81ae0e79ad9b5c"}], "stats": {"total": 73, "additions": 48, "deletions": 25}, "files": [{"sha": "8a1a13b745466cc9083e6b9bea29eab5b3d0aea5", "filename": "gcc/ChangeLog", "status": "modified", "additions": 7, "deletions": 0, "changes": 7, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/bdeb5f0c355d5f6d0d95798cd8c8de42ef80a853/gcc%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/bdeb5f0c355d5f6d0d95798cd8c8de42ef80a853/gcc%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2FChangeLog?ref=bdeb5f0c355d5f6d0d95798cd8c8de42ef80a853", "patch": "@@ -176,6 +176,13 @@\n \t(TRAMPOLINE_ALIGNMENT): New.\n \t* gcc/config/mmix/mmix-protos.h: Update.\n \n+\t* config/mn10300/mn10300.c (TARGET_ASM_TRAMPOLINE_TEMPLATE,\n+\tmn10300_asm_trampoline_template, TARGET_TRAMPOLINE_INIT,\n+\tmn10300_trampoline_init): New.\n+\t* config/mn10300/mn10300.h (TRAMPOLINE_TEMPLATE): Move code to\n+\tmn10300_asm_trampoline_template.\n+\t(INITIALIZE_TRAMPOLINE): Move code to mn10300_trampoline_init.\n+\n 2009-09-22  Jakub Jelinek  <jakub@redhat.com>\n \n \t* config/rs6000/rs6000.c (bdesc_2arg): Fix CODE_FOR_vector_gt* codes"}, {"sha": "1a0eb37bbded3a5c6eb3d4a588b379b422c0e970", "filename": "gcc/config/mn10300/mn10300.c", "status": "modified", "additions": 41, "deletions": 1, "changes": 42, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/bdeb5f0c355d5f6d0d95798cd8c8de42ef80a853/gcc%2Fconfig%2Fmn10300%2Fmn10300.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/bdeb5f0c355d5f6d0d95798cd8c8de42ef80a853/gcc%2Fconfig%2Fmn10300%2Fmn10300.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fconfig%2Fmn10300%2Fmn10300.c?ref=bdeb5f0c355d5f6d0d95798cd8c8de42ef80a853", "patch": "@@ -83,6 +83,9 @@ static bool mn10300_pass_by_reference (CUMULATIVE_ARGS *, enum machine_mode,\n static int mn10300_arg_partial_bytes (CUMULATIVE_ARGS *, enum machine_mode,\n \t\t\t\t      tree, bool);\n static unsigned int mn10300_case_values_threshold (void);\n+static void mn10300_encode_section_info (tree, rtx, int);\n+static void mn10300_asm_trampoline_template (FILE *);\n+static void mn10300_trampoline_init (rtx, tree, rtx);\n \f\n /* Initialize the GCC target structure.  */\n #undef TARGET_ASM_ALIGNED_HI_OP\n@@ -131,7 +134,11 @@ static unsigned int mn10300_case_values_threshold (void);\n #undef TARGET_LEGITIMATE_ADDRESS_P\n #define TARGET_LEGITIMATE_ADDRESS_P\tmn10300_legitimate_address_p\n \n-static void mn10300_encode_section_info (tree, rtx, int);\n+#undef TARGET_ASM_TRAMPOLINE_TEMPLATE\n+#define TARGET_ASM_TRAMPOLINE_TEMPLATE mn10300_asm_trampoline_template\n+#undef TARGET_TRAMPOLINE_INIT\n+#define TARGET_TRAMPOLINE_INIT mn10300_trampoline_init\n+\n struct gcc_target targetm = TARGET_INITIALIZER;\n \f\n /* Implement TARGET_HANDLE_OPTION.  */\n@@ -2165,3 +2172,36 @@ unsigned int mn10300_case_values_threshold (void)\n {\n   return 6;\n }\n+\n+/* Worker function for TARGET_ASM_TRAMPOLINE_TEMPLATE.  */\n+\n+static void\n+mn10300_asm_trampoline_template (FILE *f)\n+{\n+  fprintf (f, \"\\tadd -4,sp\\n\");\n+  fprintf (f, \"\\t.long 0x0004fffa\\n\");\n+  fprintf (f, \"\\tmov (0,sp),a0\\n\");\n+  fprintf (f, \"\\tadd 4,sp\\n\");\n+  fprintf (f, \"\\tmov (13,a0),a1\\n\");\t\n+  fprintf (f, \"\\tmov (17,a0),a0\\n\");\n+  fprintf (f, \"\\tjmp (a0)\\n\");\n+  fprintf (f, \"\\t.long 0\\n\");\n+  fprintf (f, \"\\t.long 0\\n\");\n+}\n+\n+/* Worker function for TARGET_TRAMPOLINE_INIT.  */\n+\n+static void\n+mn10300_trampoline_init (rtx m_tramp, tree fndecl, rtx chain_value)\n+{\n+  rtx fnaddr = XEXP (DECL_RTL (fndecl), 0);\n+  rtx mem;\n+\n+  emit_block_move (m_tramp, assemble_trampoline_template (),\n+\t\t   GEN_INT (TRAMPOLINE_SIZE), BLOCK_OP_NORMAL);\n+\n+  mem = adjust_address (m_tramp, SImode, 0x14);\n+  emit_move_insn (mem, chain_value);\n+  mem = adjust_address (m_tramp, SImode, 0x18);\n+  emit_move_insn (mem, fnaddr);\n+}"}, {"sha": "fc2ece3079056bcb3cbeab898f4441aa3577e26a", "filename": "gcc/config/mn10300/mn10300.h", "status": "modified", "additions": 0, "deletions": 24, "changes": 24, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/bdeb5f0c355d5f6d0d95798cd8c8de42ef80a853/gcc%2Fconfig%2Fmn10300%2Fmn10300.h", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/bdeb5f0c355d5f6d0d95798cd8c8de42ef80a853/gcc%2Fconfig%2Fmn10300%2Fmn10300.h", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fconfig%2Fmn10300%2Fmn10300.h?ref=bdeb5f0c355d5f6d0d95798cd8c8de42ef80a853", "patch": "@@ -598,36 +598,12 @@ struct cum_arg {int nbytes; };\n \n #define FUNCTION_PROFILER(FILE, LABELNO) ;\n \n-#define TRAMPOLINE_TEMPLATE(FILE)\t\t\t\\\n-  do {\t\t\t\t\t\t\t\\\n-    fprintf (FILE, \"\\tadd -4,sp\\n\");\t\t\t\\\n-    fprintf (FILE, \"\\t.long 0x0004fffa\\n\");\t\t\\\n-    fprintf (FILE, \"\\tmov (0,sp),a0\\n\");\t\t\\\n-    fprintf (FILE, \"\\tadd 4,sp\\n\");\t\t\t\\\n-    fprintf (FILE, \"\\tmov (13,a0),a1\\n\");\t\t\\\n-    fprintf (FILE, \"\\tmov (17,a0),a0\\n\");\t\t\\\n-    fprintf (FILE, \"\\tjmp (a0)\\n\");\t\t\t\\\n-    fprintf (FILE, \"\\t.long 0\\n\");\t\t\t\\\n-    fprintf (FILE, \"\\t.long 0\\n\");\t\t\t\\\n-  } while (0)\n-\n /* Length in units of the trampoline for entering a nested function.  */\n \n #define TRAMPOLINE_SIZE 0x1b\n \n #define TRAMPOLINE_ALIGNMENT 32\n \n-/* Emit RTL insns to initialize the variable parts of a trampoline.\n-   FNADDR is an RTX for the address of the function's pure code.\n-   CXT is an RTX for the static chain value for the function.  */\n-\n-#define INITIALIZE_TRAMPOLINE(TRAMP, FNADDR, CXT)\t\t\t\\\n-{\t\t\t\t\t\t\t\t\t\\\n-  emit_move_insn (gen_rtx_MEM (SImode, plus_constant ((TRAMP), 0x14)),\t\\\n- \t\t (CXT));\t\t\t\t\t\t\\\n-  emit_move_insn (gen_rtx_MEM (SImode, plus_constant ((TRAMP), 0x18)),\t\\\n-\t\t (FNADDR));\t\t\t\t\t\t\\\n-}\n /* A C expression whose value is RTL representing the value of the return\n    address for the frame COUNT steps up from the current frame.\n "}]}