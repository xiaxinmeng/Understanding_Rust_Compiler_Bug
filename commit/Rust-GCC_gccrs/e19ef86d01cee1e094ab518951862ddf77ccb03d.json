{"sha": "e19ef86d01cee1e094ab518951862ddf77ccb03d", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6ZTE5ZWY4NmQwMWNlZTFlMDk0YWI1MTg5NTE4NjJkZGY3N2NjYjAzZA==", "commit": {"author": {"name": "Martin Liska", "email": "mliska@suse.cz", "date": "2016-12-14T10:33:10Z"}, "committer": {"name": "Martin Liska", "email": "marxin@gcc.gnu.org", "date": "2016-12-14T10:33:10Z"}, "message": "Print 2 digits after decimal delimiter for BB frequencies\n\n\t* gimple-pretty-print.c (dump_probability): New function.\n\t(dump_edge_probability): Use the function.\n\t(dump_gimple_label): Likewise.\n\t(dump_gimple_bb_header): Likewise.\n\t* gcc.dg/tree-ssa/20040703-1.c: Update scanned pattern.\n\t* gcc.dg/tree-ssa/dump-2.c: Likewise.\n\nFrom-SVN: r243643", "tree": {"sha": "915109f7f0b7da8436662144444cbb5ffc9bd381", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/915109f7f0b7da8436662144444cbb5ffc9bd381"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/e19ef86d01cee1e094ab518951862ddf77ccb03d", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/e19ef86d01cee1e094ab518951862ddf77ccb03d", "html_url": "https://github.com/Rust-GCC/gccrs/commit/e19ef86d01cee1e094ab518951862ddf77ccb03d", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/e19ef86d01cee1e094ab518951862ddf77ccb03d/comments", "author": {"login": "marxin", "id": 2658545, "node_id": "MDQ6VXNlcjI2NTg1NDU=", "avatar_url": "https://avatars.githubusercontent.com/u/2658545?v=4", "gravatar_id": "", "url": "https://api.github.com/users/marxin", "html_url": "https://github.com/marxin", "followers_url": "https://api.github.com/users/marxin/followers", "following_url": "https://api.github.com/users/marxin/following{/other_user}", "gists_url": "https://api.github.com/users/marxin/gists{/gist_id}", "starred_url": "https://api.github.com/users/marxin/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/marxin/subscriptions", "organizations_url": "https://api.github.com/users/marxin/orgs", "repos_url": "https://api.github.com/users/marxin/repos", "events_url": "https://api.github.com/users/marxin/events{/privacy}", "received_events_url": "https://api.github.com/users/marxin/received_events", "type": "User", "site_admin": false}, "committer": null, "parents": [{"sha": "ca3b6071596b4c48d7b4c3eaf624dad449efd207", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/ca3b6071596b4c48d7b4c3eaf624dad449efd207", "html_url": "https://github.com/Rust-GCC/gccrs/commit/ca3b6071596b4c48d7b4c3eaf624dad449efd207"}], "stats": {"total": 49, "additions": 41, "deletions": 8}, "files": [{"sha": "25c01dba75284e176344fc6fc61fa64e971855a5", "filename": "gcc/ChangeLog", "status": "modified", "additions": 7, "deletions": 0, "changes": 7, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/e19ef86d01cee1e094ab518951862ddf77ccb03d/gcc%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/e19ef86d01cee1e094ab518951862ddf77ccb03d/gcc%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2FChangeLog?ref=e19ef86d01cee1e094ab518951862ddf77ccb03d", "patch": "@@ -1,3 +1,10 @@\n+2016-12-14  Martin Liska  <mliska@suse.cz>\n+\n+\t* gimple-pretty-print.c (dump_probability): New function.\n+\t(dump_edge_probability): Use the function.\n+\t(dump_gimple_label): Likewise.\n+\t(dump_gimple_bb_header): Likewise.\n+\n 2016-12-14  Prathamesh Kulkarni  <prathamesh.kulkarni@linaro.org>\n \t    Jakub Jelinek  <jakub@redhat.com>\n "}, {"sha": "1a66953533bf54f0dcd047da07053112240783e7", "filename": "gcc/gimple-pretty-print.c", "status": "modified", "additions": 27, "deletions": 6, "changes": 33, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/e19ef86d01cee1e094ab518951862ddf77ccb03d/gcc%2Fgimple-pretty-print.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/e19ef86d01cee1e094ab518951862ddf77ccb03d/gcc%2Fgimple-pretty-print.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fgimple-pretty-print.c?ref=e19ef86d01cee1e094ab518951862ddf77ccb03d", "patch": "@@ -73,13 +73,35 @@ debug_gimple_stmt (gimple *gs)\n   print_gimple_stmt (stderr, gs, 0, TDF_VOPS|TDF_MEMSYMS);\n }\n \n+\n+/* Return formatted string of a VALUE probability\n+   (biased by REG_BR_PROB_BASE).  Returned string is allocated\n+   by xstrdup_for_dump.  */\n+\n+static const char *\n+dump_probability (int value)\n+{\n+  float minimum = 0.01f;\n+\n+  gcc_assert (0 <= value && value <= REG_BR_PROB_BASE);\n+  float fvalue = value * 100.0f / REG_BR_PROB_BASE;\n+  if (fvalue < minimum && value > 0)\n+    return \"[0.01%]\";\n+\n+  char *buf;\n+  asprintf (&buf, \"[%.2f%%]\", fvalue);\n+  const char *ret = xstrdup_for_dump (buf);\n+  free (buf);\n+\n+  return ret;\n+}\n+\n /* Dump E probability to BUFFER.  */\n \n static void\n dump_edge_probability (pretty_printer *buffer, edge e)\n {\n-  pp_scalar (buffer, \" [%.1f%%]\",\n-\t     e->probability * 100.0 / REG_BR_PROB_BASE);\n+  pp_scalar (buffer, \" %s\", dump_probability (e->probability));\n }\n \n /* Print GIMPLE statement G to FILE using SPC indentation spaces and\n@@ -1032,8 +1054,7 @@ dump_gimple_label (pretty_printer *buffer, glabel *gs, int spc, int flags)\n       dump_generic_node (buffer, label, spc, flags, false);\n       basic_block bb = gimple_bb (gs);\n       if (bb && !(flags & TDF_GIMPLE))\n-\tpp_scalar (buffer, \" [%.1f%%]\",\n-\t\t   bb->frequency * 100.0 / REG_BR_PROB_BASE);\n+\tpp_scalar (buffer, \" %s\", dump_probability (bb->frequency));\n       pp_colon (buffer);\n     }\n   if (flags & TDF_GIMPLE)\n@@ -2599,8 +2620,8 @@ dump_gimple_bb_header (FILE *outf, basic_block bb, int indent, int flags)\n \t  if (flags & TDF_GIMPLE)\n \t    fprintf (outf, \"%*sbb_%d:\\n\", indent, \"\", bb->index);\n \t  else\n-\t    fprintf (outf, \"%*s<bb %d> [%.1f%%]:\\n\", indent, \"\", bb->index,\n-\t\t     bb->frequency * 100.0 / REG_BR_PROB_BASE);\n+\t    fprintf (outf, \"%*s<bb %d> %s:\\n\",\n+\t\t     indent, \"\", bb->index, dump_probability (bb->frequency));\n \t}\n     }\n }"}, {"sha": "43cf4900f5af3ac197f56d7f2a3dcf375fabb294", "filename": "gcc/testsuite/ChangeLog", "status": "modified", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/e19ef86d01cee1e094ab518951862ddf77ccb03d/gcc%2Ftestsuite%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/e19ef86d01cee1e094ab518951862ddf77ccb03d/gcc%2Ftestsuite%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2FChangeLog?ref=e19ef86d01cee1e094ab518951862ddf77ccb03d", "patch": "@@ -1,3 +1,8 @@\n+2016-12-14  Martin Liska  <mliska@suse.cz>\n+\n+\t* gcc.dg/tree-ssa/20040703-1.c: Update scanned pattern.\n+\t* gcc.dg/tree-ssa/dump-2.c: Likewise.\n+\n 2016-12-14  Toma Tabacu  <toma.tabacu@imgtec.com>\n \n \t* gcc.target/mips/msa-builtins-err.c (dg-options): Add "}, {"sha": "eb9fb5640f727fd7ec3eb50a808bda524e980d80", "filename": "gcc/testsuite/gcc.dg/tree-ssa/20040703-1.c", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/e19ef86d01cee1e094ab518951862ddf77ccb03d/gcc%2Ftestsuite%2Fgcc.dg%2Ftree-ssa%2F20040703-1.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/e19ef86d01cee1e094ab518951862ddf77ccb03d/gcc%2Ftestsuite%2Fgcc.dg%2Ftree-ssa%2F20040703-1.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgcc.dg%2Ftree-ssa%2F20040703-1.c?ref=e19ef86d01cee1e094ab518951862ddf77ccb03d", "patch": "@@ -9,4 +9,4 @@ float foo(float x)\n }\n \n /* We should *not* fold the arithmetic.  */\n-/* { dg-final { scan-tree-dump-times \"0\\\\.0\\[^%\\]\" 0 \"dom2\"} } */\n+/* { dg-final { scan-tree-dump-times \"0\\\\.0\\[^%0\\]\" 0 \"dom2\"} } */"}, {"sha": "8a63af4e0efe656295dd553005edcdce79321e1d", "filename": "gcc/testsuite/gcc.dg/tree-ssa/dump-2.c", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/e19ef86d01cee1e094ab518951862ddf77ccb03d/gcc%2Ftestsuite%2Fgcc.dg%2Ftree-ssa%2Fdump-2.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/e19ef86d01cee1e094ab518951862ddf77ccb03d/gcc%2Ftestsuite%2Fgcc.dg%2Ftree-ssa%2Fdump-2.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgcc.dg%2Ftree-ssa%2Fdump-2.c?ref=e19ef86d01cee1e094ab518951862ddf77ccb03d", "patch": "@@ -6,4 +6,4 @@ int f(void)\n   return 0;\n }\n \n-/* { dg-final { scan-tree-dump \"<bb \\[0-9\\]> \\\\\\[100\\\\\\.0%\\\\\\]:\" \"optimized\" } } */\n+/* { dg-final { scan-tree-dump \"<bb \\[0-9\\]> \\\\\\[100\\\\\\.00%\\\\\\]:\" \"optimized\" } } */"}]}