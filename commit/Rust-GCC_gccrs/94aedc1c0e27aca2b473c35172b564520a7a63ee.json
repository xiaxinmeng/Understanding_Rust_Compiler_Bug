{"sha": "94aedc1c0e27aca2b473c35172b564520a7a63ee", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6OTRhZWRjMWMwZTI3YWNhMmI0NzNjMzUxNzJiNTY0NTIwYTdhNjNlZQ==", "commit": {"author": {"name": "Jason Merrill", "email": "jason@redhat.com", "date": "2018-06-16T06:35:53Z"}, "committer": {"name": "Jason Merrill", "email": "jason@gcc.gnu.org", "date": "2018-06-16T06:35:53Z"}, "message": "PR c++/86147 - wrong capture for template argument.\n\n\t* expr.c (mark_use): Look through NOP_EXPR.\n\nFrom-SVN: r261676", "tree": {"sha": "31f92d67260c8bad14fd3f0b39ef7bd2d8a5dcdb", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/31f92d67260c8bad14fd3f0b39ef7bd2d8a5dcdb"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/94aedc1c0e27aca2b473c35172b564520a7a63ee", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/94aedc1c0e27aca2b473c35172b564520a7a63ee", "html_url": "https://github.com/Rust-GCC/gccrs/commit/94aedc1c0e27aca2b473c35172b564520a7a63ee", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/94aedc1c0e27aca2b473c35172b564520a7a63ee/comments", "author": {"login": "jicama", "id": 266146, "node_id": "MDQ6VXNlcjI2NjE0Ng==", "avatar_url": "https://avatars.githubusercontent.com/u/266146?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jicama", "html_url": "https://github.com/jicama", "followers_url": "https://api.github.com/users/jicama/followers", "following_url": "https://api.github.com/users/jicama/following{/other_user}", "gists_url": "https://api.github.com/users/jicama/gists{/gist_id}", "starred_url": "https://api.github.com/users/jicama/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jicama/subscriptions", "organizations_url": "https://api.github.com/users/jicama/orgs", "repos_url": "https://api.github.com/users/jicama/repos", "events_url": "https://api.github.com/users/jicama/events{/privacy}", "received_events_url": "https://api.github.com/users/jicama/received_events", "type": "User", "site_admin": false}, "committer": null, "parents": [{"sha": "29305f6018483963fa79b072cf8e95128f3e2cd8", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/29305f6018483963fa79b072cf8e95128f3e2cd8", "html_url": "https://github.com/Rust-GCC/gccrs/commit/29305f6018483963fa79b072cf8e95128f3e2cd8"}], "stats": {"total": 33, "additions": 28, "deletions": 5}, "files": [{"sha": "2e341f105276589e12b40f6fc3f60ffb88b9ceec", "filename": "gcc/cp/ChangeLog", "status": "modified", "additions": 3, "deletions": 0, "changes": 3, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/94aedc1c0e27aca2b473c35172b564520a7a63ee/gcc%2Fcp%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/94aedc1c0e27aca2b473c35172b564520a7a63ee/gcc%2Fcp%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fcp%2FChangeLog?ref=94aedc1c0e27aca2b473c35172b564520a7a63ee", "patch": "@@ -1,5 +1,8 @@\n 2018-06-15  Jason Merrill  <jason@redhat.com>\n \n+\tPR c++/86147 - wrong capture for template argument.\n+\t* expr.c (mark_use): Look through NOP_EXPR.\n+\n \t* name-lookup.c (do_pushtag): Don't look through complete types, but\n \tdon't add to them either.  Get context from current_binding_level.\n \t* pt.c (tsubst_default_argument): Use push_to/pop_from_top_level."}, {"sha": "133a01b8a51443c417833ef029f293fbcb4af9b7", "filename": "gcc/cp/expr.c", "status": "modified", "additions": 8, "deletions": 5, "changes": 13, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/94aedc1c0e27aca2b473c35172b564520a7a63ee/gcc%2Fcp%2Fexpr.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/94aedc1c0e27aca2b473c35172b564520a7a63ee/gcc%2Fcp%2Fexpr.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fcp%2Fexpr.c?ref=94aedc1c0e27aca2b473c35172b564520a7a63ee", "patch": "@@ -186,12 +186,15 @@ mark_use (tree expr, bool rvalue_p, bool read_p,\n \t    expr = convert_from_reference (r);\n \t}\n       break;\n-    default:\n+\n+    CASE_CONVERT:\n+    case VIEW_CONVERT_EXPR:\n       if (location_wrapper_p (expr))\n-\t{\n-\t  loc = EXPR_LOCATION (expr);\n-\t  recurse_op[0] = true;\n-\t}\n+\tloc = EXPR_LOCATION (expr);\n+      recurse_op[0] = true;\n+      break;\n+\n+    default:\n       break;\n     }\n "}, {"sha": "0724ae15d88474d18821f26b891004e4bf13ac56", "filename": "gcc/testsuite/g++.dg/cpp0x/lambda/lambda-const9.C", "status": "added", "additions": 17, "deletions": 0, "changes": 17, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/94aedc1c0e27aca2b473c35172b564520a7a63ee/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Fcpp0x%2Flambda%2Flambda-const9.C", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/94aedc1c0e27aca2b473c35172b564520a7a63ee/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Fcpp0x%2Flambda%2Flambda-const9.C", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Fcpp0x%2Flambda%2Flambda-const9.C?ref=94aedc1c0e27aca2b473c35172b564520a7a63ee", "patch": "@@ -0,0 +1,17 @@\n+// PR c++/86147\n+// { dg-do compile { target c++11 } }\n+\n+template <class T, T N> struct X { };\n+\n+struct A { static constexpr int value = 0; };\n+\n+template<class C>\n+void foo() {\n+    constexpr int N = C::value;\n+    auto f = [&]{  X<int, N> a; };\n+}\n+\n+int main() { \n+    foo<A>();\n+    return 0;\n+}"}]}