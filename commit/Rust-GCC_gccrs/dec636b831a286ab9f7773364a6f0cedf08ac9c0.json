{"sha": "dec636b831a286ab9f7773364a6f0cedf08ac9c0", "node_id": "C_kwDOANBUbNoAKGRlYzYzNmI4MzFhMjg2YWI5Zjc3NzMzNjRhNmYwY2VkZjA4YWM5YzA", "commit": {"author": {"name": "Joel Brobecker", "email": "brobecker@adacore.com", "date": "2022-03-11T04:22:15Z"}, "committer": {"name": "Pierre-Marie de Rodat", "email": "derodat@adacore.com", "date": "2022-05-16T08:42:05Z"}, "message": "[Ada] replace call to bzero in terminals.c by call to memset\n\nbzero is marked as legacy in POSIX.1-2001, and using it triggers a\ndeprecation warnings on some systems such as QNX. This change adjusts\nthe one place where we use it in terminals.c to use memset instead.\nThis, in turns, allows us to get rid of a hack for HP/UX and Solaris.\n\ngcc/ada/\n\n\t* terminals.c: Remove bzero #define on HP/UX or Solaris\n\tplatforms.\n\t(child_setup_tty): Replace bzero call by equivalent call to\n\tmemset.", "tree": {"sha": "fed77556c3cccde0192df20c0ce8e9a14a9d7b05", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/fed77556c3cccde0192df20c0ce8e9a14a9d7b05"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/dec636b831a286ab9f7773364a6f0cedf08ac9c0", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/dec636b831a286ab9f7773364a6f0cedf08ac9c0", "html_url": "https://github.com/Rust-GCC/gccrs/commit/dec636b831a286ab9f7773364a6f0cedf08ac9c0", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/dec636b831a286ab9f7773364a6f0cedf08ac9c0/comments", "author": {"login": "brobecke", "id": 11981700, "node_id": "MDQ6VXNlcjExOTgxNzAw", "avatar_url": "https://avatars.githubusercontent.com/u/11981700?v=4", "gravatar_id": "", "url": "https://api.github.com/users/brobecke", "html_url": "https://github.com/brobecke", "followers_url": "https://api.github.com/users/brobecke/followers", "following_url": "https://api.github.com/users/brobecke/following{/other_user}", "gists_url": "https://api.github.com/users/brobecke/gists{/gist_id}", "starred_url": "https://api.github.com/users/brobecke/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/brobecke/subscriptions", "organizations_url": "https://api.github.com/users/brobecke/orgs", "repos_url": "https://api.github.com/users/brobecke/repos", "events_url": "https://api.github.com/users/brobecke/events{/privacy}", "received_events_url": "https://api.github.com/users/brobecke/received_events", "type": "User", "site_admin": false}, "committer": {"login": "pmderodat", "id": 758452, "node_id": "MDQ6VXNlcjc1ODQ1Mg==", "avatar_url": "https://avatars.githubusercontent.com/u/758452?v=4", "gravatar_id": "", "url": "https://api.github.com/users/pmderodat", "html_url": "https://github.com/pmderodat", "followers_url": "https://api.github.com/users/pmderodat/followers", "following_url": "https://api.github.com/users/pmderodat/following{/other_user}", "gists_url": "https://api.github.com/users/pmderodat/gists{/gist_id}", "starred_url": "https://api.github.com/users/pmderodat/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/pmderodat/subscriptions", "organizations_url": "https://api.github.com/users/pmderodat/orgs", "repos_url": "https://api.github.com/users/pmderodat/repos", "events_url": "https://api.github.com/users/pmderodat/events{/privacy}", "received_events_url": "https://api.github.com/users/pmderodat/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "21f8b410511d1ee9a46b7a902a368762f6256ea0", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/21f8b410511d1ee9a46b7a902a368762f6256ea0", "html_url": "https://github.com/Rust-GCC/gccrs/commit/21f8b410511d1ee9a46b7a902a368762f6256ea0"}], "stats": {"total": 17, "additions": 9, "deletions": 8}, "files": [{"sha": "330128abf5d6af83e1ca6ae94e9b3227c6217d58", "filename": "gcc/ada/terminals.c", "status": "modified", "additions": 9, "deletions": 8, "changes": 17, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/dec636b831a286ab9f7773364a6f0cedf08ac9c0/gcc%2Fada%2Fterminals.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/dec636b831a286ab9f7773364a6f0cedf08ac9c0/gcc%2Fada%2Fterminals.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fada%2Fterminals.c?ref=dec636b831a286ab9f7773364a6f0cedf08ac9c0", "patch": "@@ -1123,12 +1123,6 @@ __gnat_setup_winsize (void *desc ATTRIBUTE_UNUSED,\n \n #define CDISABLE _POSIX_VDISABLE\n \n-/* On HP-UX and Sun system, there is a bzero function but with a different\n-   signature. Use memset instead */\n-#if defined (__hpux__) || defined (__sun__) || defined (_AIX)\n-#   define bzero(s,n) memset (s,0,n)\n-#endif\n-\n /* POSIX does not specify how to open the master side of a terminal.Several\n    methods are available (system specific):\n       1- using a cloning device (USE_CLONE_DEVICE)\n@@ -1289,8 +1283,15 @@ child_setup_tty (int fd)\n   struct termios s;\n   int    status;\n \n-  /* ensure that s is filled with 0 */\n-  bzero (&s, sizeof (s));\n+  /* Ensure that s is filled with 0.\n+\n+     Note that we avoid using bzero for a few reasons:\n+       - On HP-UX and Sun system, there is a bzero function but with\n+         a different signature, thus making the use of bzero more\n+\t complicated on these platforms (we used to define a bzero\n+\t macro that rewrote calls to bzero into calls to memset);\n+       - bzero is deprecated (marked as LEGACY in POSIX.1-2001).  */\n+  memset (&s, 0, sizeof (s));\n \n   /* Get the current terminal settings */\n   status = tcgetattr (fd, &s);"}]}