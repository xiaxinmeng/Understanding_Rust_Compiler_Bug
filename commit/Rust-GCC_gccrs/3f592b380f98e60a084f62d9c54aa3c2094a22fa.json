{"sha": "3f592b380f98e60a084f62d9c54aa3c2094a22fa", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6M2Y1OTJiMzgwZjk4ZTYwYTA4NGY2MmQ5YzU0YWEzYzIwOTRhMjJmYQ==", "commit": {"author": {"name": "Jakub Jelinek", "email": "jakub@redhat.com", "date": "2010-05-11T06:48:15Z"}, "committer": {"name": "Jakub Jelinek", "email": "jakub@gcc.gnu.org", "date": "2010-05-11T06:48:15Z"}, "message": "re PR debug/44023 (-fcompare-debug failure (length) for alphaev67 target (bootstrap failure))\n\n\tPR debug/44023\n\t* df-problems.c (struct dead_debug): Add to_rescan field.\n\t(dead_debug_init): Clear to_rescan field.\n\t(dead_debug_finish): Rescan all debug insns in to_rescan\n\tbitmap and free the bitmap.\n\t(dead_debug_insert_before): Instead of rescanning debug insns\n\timmediately queue their rescanning until dead_debug_finish.\n\t(df_note_bb_compute): After dead_debug_add do continue instead\n\tof break.\n\n\t* gcc.dg/pr44023.c: New test.\n\nFrom-SVN: r159254", "tree": {"sha": "a0baa9749d10a81b4d5315dd7e0d44516800e84a", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/a0baa9749d10a81b4d5315dd7e0d44516800e84a"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/3f592b380f98e60a084f62d9c54aa3c2094a22fa", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/3f592b380f98e60a084f62d9c54aa3c2094a22fa", "html_url": "https://github.com/Rust-GCC/gccrs/commit/3f592b380f98e60a084f62d9c54aa3c2094a22fa", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/3f592b380f98e60a084f62d9c54aa3c2094a22fa/comments", "author": {"login": "jakubjelinek", "id": 9370665, "node_id": "MDQ6VXNlcjkzNzA2NjU=", "avatar_url": "https://avatars.githubusercontent.com/u/9370665?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jakubjelinek", "html_url": "https://github.com/jakubjelinek", "followers_url": "https://api.github.com/users/jakubjelinek/followers", "following_url": "https://api.github.com/users/jakubjelinek/following{/other_user}", "gists_url": "https://api.github.com/users/jakubjelinek/gists{/gist_id}", "starred_url": "https://api.github.com/users/jakubjelinek/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jakubjelinek/subscriptions", "organizations_url": "https://api.github.com/users/jakubjelinek/orgs", "repos_url": "https://api.github.com/users/jakubjelinek/repos", "events_url": "https://api.github.com/users/jakubjelinek/events{/privacy}", "received_events_url": "https://api.github.com/users/jakubjelinek/received_events", "type": "User", "site_admin": false}, "committer": null, "parents": [{"sha": "1f8d1f8270f0acc4728a0e4c5665cc0020817f48", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/1f8d1f8270f0acc4728a0e4c5665cc0020817f48", "html_url": "https://github.com/Rust-GCC/gccrs/commit/1f8d1f8270f0acc4728a0e4c5665cc0020817f48"}], "stats": {"total": 92, "additions": 89, "deletions": 3}, "files": [{"sha": "07aad7be5c06ba4c5c3f67f44d38e6b230a0e19c", "filename": "gcc/ChangeLog", "status": "modified", "additions": 12, "deletions": 0, "changes": 12, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/3f592b380f98e60a084f62d9c54aa3c2094a22fa/gcc%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/3f592b380f98e60a084f62d9c54aa3c2094a22fa/gcc%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2FChangeLog?ref=3f592b380f98e60a084f62d9c54aa3c2094a22fa", "patch": "@@ -1,3 +1,15 @@\n+2010-05-11  Jakub Jelinek  <jakub@redhat.com>\n+\n+\tPR debug/44023\n+\t* df-problems.c (struct dead_debug): Add to_rescan field.\n+\t(dead_debug_init): Clear to_rescan field.\n+\t(dead_debug_finish): Rescan all debug insns in to_rescan\n+\tbitmap and free the bitmap.\n+\t(dead_debug_insert_before): Instead of rescanning debug insns\n+\timmediately queue their rescanning until dead_debug_finish.\n+\t(df_note_bb_compute): After dead_debug_add do continue instead\n+\tof break.\n+\n 2010-05-10  Jakub Jelinek  <jakub@redhat.com>\n \n \tPR debug/44028"}, {"sha": "25bbba61bb1d05b7f82bb99d0c014c98fa76e5bc", "filename": "gcc/df-problems.c", "status": "modified", "additions": 26, "deletions": 3, "changes": 29, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/3f592b380f98e60a084f62d9c54aa3c2094a22fa/gcc%2Fdf-problems.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/3f592b380f98e60a084f62d9c54aa3c2094a22fa/gcc%2Fdf-problems.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fdf-problems.c?ref=3f592b380f98e60a084f62d9c54aa3c2094a22fa", "patch": "@@ -1,6 +1,6 @@\n /* Standard problems for dataflow support routines.\n    Copyright (C) 1999, 2000, 2001, 2002, 2003, 2004, 2005, 2006, 2007,\n-   2008, 2009 Free Software Foundation, Inc.\n+   2008, 2009, 2010 Free Software Foundation, Inc.\n    Originally contributed by Michael P. Hayes\n              (m.hayes@elec.canterbury.ac.nz, mhayes@redhat.com)\n    Major rewrite contributed by Danny Berlin (dberlin@dberlin.org)\n@@ -3416,6 +3416,7 @@ struct dead_debug\n {\n   struct dead_debug_use *head;\n   bitmap used;\n+  bitmap to_rescan;\n };\n \n /* Initialize DEBUG to an empty list, and clear USED, if given.  */\n@@ -3424,6 +3425,7 @@ dead_debug_init (struct dead_debug *debug, bitmap used)\n {\n   debug->head = NULL;\n   debug->used = used;\n+  debug->to_rescan = NULL;\n   if (used)\n     bitmap_clear (used);\n }\n@@ -3447,10 +3449,26 @@ dead_debug_finish (struct dead_debug *debug, bitmap used)\n \t{\n \t  INSN_VAR_LOCATION_LOC (insn) = gen_rtx_UNKNOWN_VAR_LOC ();\n \t  df_insn_rescan_debug_internal (insn);\n+\t  if (debug->to_rescan)\n+\t    bitmap_clear_bit (debug->to_rescan, INSN_UID (insn));\n \t}\n       debug->head = head->next;\n       XDELETE (head);\n     }\n+\n+  if (debug->to_rescan)\n+    {\n+      bitmap_iterator bi;\n+      unsigned int uid;\n+\n+      EXECUTE_IF_SET_IN_BITMAP (debug->to_rescan, 0, uid, bi)\n+\t{\n+\t  struct df_insn_info *insn_info = DF_INSN_UID_SAFE_GET (uid);\n+\t  if (insn_info)\n+\t    df_insn_rescan (insn_info->insn);\n+\t}\n+      BITMAP_FREE (debug->to_rescan);\n+    }\n }\n \n /* Add USE to DEBUG.  It must be a dead reference to UREGNO in a debug\n@@ -3530,7 +3548,9 @@ dead_debug_insert_before (struct dead_debug *debug, unsigned int uregno,\n \t*DF_REF_REAL_LOC (cur->use)\n \t  = gen_lowpart_SUBREG (GET_MODE (*DF_REF_REAL_LOC (cur->use)), dval);\n       /* ??? Should we simplify subreg of subreg?  */\n-      df_insn_rescan (DF_REF_INSN (cur->use));\n+      if (debug->to_rescan == NULL)\n+\tdebug->to_rescan = BITMAP_ALLOC (NULL);\n+      bitmap_set_bit (debug->to_rescan, INSN_UID (DF_REF_INSN (cur->use)));\n       uses = cur->next;\n       XDELETE (cur);\n     }\n@@ -3728,7 +3748,10 @@ df_note_bb_compute (unsigned int bb_index,\n \t      if (debug_insn)\n \t\t{\n \t\t  if (debug_insn > 0)\n-\t\t    dead_debug_add (&debug, use, uregno);\n+\t\t    {\n+\t\t      dead_debug_add (&debug, use, uregno);\n+\t\t      continue;\n+\t\t    }\n \t\t  break;\n \t\t}\n \t      else"}, {"sha": "6035e5aeeb4b5ba1380bf12d6b5ee4acd70987b8", "filename": "gcc/testsuite/ChangeLog", "status": "modified", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/3f592b380f98e60a084f62d9c54aa3c2094a22fa/gcc%2Ftestsuite%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/3f592b380f98e60a084f62d9c54aa3c2094a22fa/gcc%2Ftestsuite%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2FChangeLog?ref=3f592b380f98e60a084f62d9c54aa3c2094a22fa", "patch": "@@ -1,3 +1,8 @@\n+2010-05-11  Jakub Jelinek  <jakub@redhat.com>\n+\n+\tPR debug/44023\n+\t* gcc.dg/pr44023.c: New test.\n+\n 2010-05-10  Eric Botcazou  <ebotcazou@adacore.com>\n \n \t* gnat.dg/lto7.adb: New test."}, {"sha": "ee99bf601bbd3d231ec3fc513dbd9d1e0c698df9", "filename": "gcc/testsuite/gcc.dg/pr44023.c", "status": "added", "additions": 46, "deletions": 0, "changes": 46, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/3f592b380f98e60a084f62d9c54aa3c2094a22fa/gcc%2Ftestsuite%2Fgcc.dg%2Fpr44023.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/3f592b380f98e60a084f62d9c54aa3c2094a22fa/gcc%2Ftestsuite%2Fgcc.dg%2Fpr44023.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgcc.dg%2Fpr44023.c?ref=3f592b380f98e60a084f62d9c54aa3c2094a22fa", "patch": "@@ -0,0 +1,46 @@\n+/* PR debug/44023 */\n+/* { dg-do compile } */\n+/* { dg-options \"-fcompare-debug -O2\" } */\n+/* { dg-options \"-fcompare-debug -O2 -mcpu=ev67\" { target alpha*-*-* } } */\n+\n+void\n+foo (unsigned f, long v, unsigned *w, unsigned a, unsigned b, unsigned e, unsigned c, unsigned d)\n+{\n+  unsigned h = v / 4, x[16];\n+  while (f < h)\n+    {\n+      unsigned i;\n+      f++;\n+      a |= (a >> 30);\n+      d = (d << 30) | ((unsigned) d >> 30);\n+      c = (c << 30) | ((unsigned) c >> 30);\n+      b = 30 | ((unsigned) b >> 30);\n+      d += a = (a << 30) | ((unsigned) a >> 2);\n+      c += ((d << 5) | (d >> 27)) + ((e & (a ^ b))) + 0x5a827999 + x[12];\n+      a += (c & e);\n+      c = 30 | ((unsigned) c);\n+      i = x[5] ^ x[7] ^ x[8] ^ x[3];\n+      x[5] = (i << 1) | ((unsigned) i >> 31);\n+      i = x[6] ^ x[2] ^ x[14] ^ x[13];\n+      x[6] = (i << 1) | (i >> 31);\n+      b += (c | (c >> 5)) + (d ^ e) + 0x6ed9eba1 + (x[7] = (i << 1) | ((unsigned) i >> 31));\n+      x[8] = i | 1;\n+      e += (a | 5) + b + (i = x[9] ^ x[6], x[10] = (i << (unsigned) i));\n+      e = 30 | ((unsigned) e >> 30);\n+      i = x[12] ^ x[14] ^ x[12] ^ x[12], (x[12] = 1 | ((unsigned) i));\n+      i = x[13] ^ x[5] ^ x[10], (x[13] = (i << (unsigned) 1));\n+      i = x[2] ^ x[7] ^ x[12], (x[15] = i | ((unsigned) i >> 1));\n+      i = x[2] ^ x[0] ^ x[13], (x[0] = (i << 1) | 31);\n+      e = (e << 30) | 2;\n+      i = x[14] ^ x[2] ^ x[15], (x[2] = i | 1);\n+      x[3] = i | ((unsigned) i);\n+      i = x[14] ^ x[12] ^ x[4], (x[4] = 1 | ((unsigned) i >> 1));\n+      x[5] = i | 1;\n+      e = (e << 30) | 30;\n+      b += (5 | ((unsigned) e >> 5)) + 0x8f1bbcdc + (x[9] = (i | ((unsigned) i >> 1)));\n+      i = x[2] ^ (x [10] = ((i << 1) | (i >> 1)));\n+      x[13] = (i | ((unsigned) i >> 1));\n+      (i = x[14] ^ x[0] ^ x[14], (x[14] = ((i << 1) | 31)));\n+      a = *w += a;\n+    }\n+}"}]}