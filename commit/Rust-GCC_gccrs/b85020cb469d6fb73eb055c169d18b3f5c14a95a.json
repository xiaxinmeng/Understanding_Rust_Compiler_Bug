{"sha": "b85020cb469d6fb73eb055c169d18b3f5c14a95a", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6Yjg1MDIwY2I0NjlkNmZiNzNlYjA1NWMxNjlkMThiM2Y1YzE0YTk1YQ==", "commit": {"author": {"name": "Martin Jambor", "email": "mjambor@suse.cz", "date": "2010-11-02T15:06:21Z"}, "committer": {"name": "Martin Jambor", "email": "jamborm@gcc.gnu.org", "date": "2010-11-02T15:06:21Z"}, "message": "re PR tree-optimization/45875 (ice in gimple_fold_obj_type_ref_known_binfo with -O2)\n\n2010-11-02  Martin Jambor  <mjambor@suse.cz>\n\n\tPR tree-optimization/45875\n\t* gimple-fold.c (get_first_base_binfo_with_virtuals): Removed.\n\t(gimple_get_relevant_ref_binfo): Detect primary bases according to\n\ttheir field offset.\n\n\t* testsuite/g++.dg/torture/pr45875.C: New test.\n\nFrom-SVN: r166190", "tree": {"sha": "6dc28e554ea1adf78ab13d47bed16c79ae66a360", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/6dc28e554ea1adf78ab13d47bed16c79ae66a360"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/b85020cb469d6fb73eb055c169d18b3f5c14a95a", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/b85020cb469d6fb73eb055c169d18b3f5c14a95a", "html_url": "https://github.com/Rust-GCC/gccrs/commit/b85020cb469d6fb73eb055c169d18b3f5c14a95a", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/b85020cb469d6fb73eb055c169d18b3f5c14a95a/comments", "author": {"login": "jamborm", "id": 2180070, "node_id": "MDQ6VXNlcjIxODAwNzA=", "avatar_url": "https://avatars.githubusercontent.com/u/2180070?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jamborm", "html_url": "https://github.com/jamborm", "followers_url": "https://api.github.com/users/jamborm/followers", "following_url": "https://api.github.com/users/jamborm/following{/other_user}", "gists_url": "https://api.github.com/users/jamborm/gists{/gist_id}", "starred_url": "https://api.github.com/users/jamborm/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jamborm/subscriptions", "organizations_url": "https://api.github.com/users/jamborm/orgs", "repos_url": "https://api.github.com/users/jamborm/repos", "events_url": "https://api.github.com/users/jamborm/events{/privacy}", "received_events_url": "https://api.github.com/users/jamborm/received_events", "type": "User", "site_admin": false}, "committer": null, "parents": [{"sha": "181e5ea4f4794af8339d86c5c186346951da810c", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/181e5ea4f4794af8339d86c5c186346951da810c", "html_url": "https://github.com/Rust-GCC/gccrs/commit/181e5ea4f4794af8339d86c5c186346951da810c"}], "stats": {"total": 62, "additions": 42, "deletions": 20}, "files": [{"sha": "c946683d46e2f6bf99ee44add3a65857409111ed", "filename": "gcc/ChangeLog", "status": "modified", "additions": 7, "deletions": 0, "changes": 7, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/b85020cb469d6fb73eb055c169d18b3f5c14a95a/gcc%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/b85020cb469d6fb73eb055c169d18b3f5c14a95a/gcc%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2FChangeLog?ref=b85020cb469d6fb73eb055c169d18b3f5c14a95a", "patch": "@@ -1,3 +1,10 @@\n+2010-11-02  Martin Jambor  <mjambor@suse.cz>\n+\n+\tPR tree-optimization/45875\n+\t* gimple-fold.c (get_first_base_binfo_with_virtuals): Removed.\n+\t(gimple_get_relevant_ref_binfo): Detect primary bases according to\n+\ttheir field offset.\n+\n 2010-11-02  Ian Lance Taylor  <iant@google.com>\n \n \t* configure.ac: Remove elf_getshdrstrndx test.  Don't substitute"}, {"sha": "f77b63085bd015b0e97cc5387b2ae6d88ad35e03", "filename": "gcc/gimple-fold.c", "status": "modified", "additions": 5, "deletions": 20, "changes": 25, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/b85020cb469d6fb73eb055c169d18b3f5c14a95a/gcc%2Fgimple-fold.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/b85020cb469d6fb73eb055c169d18b3f5c14a95a/gcc%2Fgimple-fold.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fgimple-fold.c?ref=b85020cb469d6fb73eb055c169d18b3f5c14a95a", "patch": "@@ -1360,22 +1360,6 @@ gimple_fold_builtin (gimple stmt)\n   return result;\n }\n \n-/* Return the first of the base binfos of BINFO that has virtual functions.  */\n-\n-static tree\n-get_first_base_binfo_with_virtuals (tree binfo)\n-{\n-  int i;\n-  tree base_binfo;\n-\n-  for (i = 0; BINFO_BASE_ITERATE (binfo, i, base_binfo); i++)\n-    if (BINFO_VIRTUALS (base_binfo))\n-      return base_binfo;\n-\n-  return NULL_TREE;\n-}\n-\n-\n /* Search for a base binfo of BINFO that corresponds to TYPE and return it if\n    it is found or NULL_TREE if it is not.  */\n \n@@ -1413,7 +1397,7 @@ gimple_get_relevant_ref_binfo (tree ref, tree known_binfo)\n       if (TREE_CODE (ref) == COMPONENT_REF)\n \t{\n \t  tree par_type;\n-\t  tree binfo, base_binfo;\n+\t  tree binfo;\n \t  tree field = TREE_OPERAND (ref, 1);\n \n \t  if (!DECL_ARTIFICIAL (field))\n@@ -1431,14 +1415,15 @@ gimple_get_relevant_ref_binfo (tree ref, tree known_binfo)\n \t      || BINFO_N_BASE_BINFOS (binfo) == 0)\n \t    return NULL_TREE;\n \n-\t  base_binfo = get_first_base_binfo_with_virtuals (binfo);\n-\t  if (base_binfo && BINFO_TYPE (base_binfo) != TREE_TYPE (field))\n+\t  /* Offset 0 indicates the primary base, whose vtable contents are\n+\t     represented in the binfo for the derived class.  */\n+\t  if (int_bit_position (field) != 0)\n \t    {\n \t      tree d_binfo;\n \n+\t      /* Get descendant binfo. */\n \t      d_binfo = gimple_get_relevant_ref_binfo (TREE_OPERAND (ref, 0),\n \t\t\t\t\t\t       known_binfo);\n-\t      /* Get descendant binfo. */\n \t      if (!d_binfo)\n \t\treturn NULL_TREE;\n \t      return get_base_binfo_for_type (d_binfo, TREE_TYPE (field));"}, {"sha": "aa80464b054e2e3a9fd49ae098c63fe456621687", "filename": "gcc/testsuite/ChangeLog", "status": "modified", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/b85020cb469d6fb73eb055c169d18b3f5c14a95a/gcc%2Ftestsuite%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/b85020cb469d6fb73eb055c169d18b3f5c14a95a/gcc%2Ftestsuite%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2FChangeLog?ref=b85020cb469d6fb73eb055c169d18b3f5c14a95a", "patch": "@@ -1,3 +1,8 @@\n+2010-11-02  Martin Jambor  <mjambor@suse.cz>\n+\n+\tPR tree-optimization/45875\n+\t* g++.dg/torture/pr45875.C: New test.\n+\n 2010-11-02  Richard Guenther  <rguenther@suse.de>\n \n \tPR testsuite/46249"}, {"sha": "f1347f543262210f7c76898ba69b0b4cc1e6b005", "filename": "gcc/testsuite/g++.dg/torture/pr45875.C", "status": "added", "additions": 25, "deletions": 0, "changes": 25, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/b85020cb469d6fb73eb055c169d18b3f5c14a95a/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Ftorture%2Fpr45875.C", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/b85020cb469d6fb73eb055c169d18b3f5c14a95a/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Ftorture%2Fpr45875.C", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Ftorture%2Fpr45875.C?ref=b85020cb469d6fb73eb055c169d18b3f5c14a95a", "patch": "@@ -0,0 +1,25 @@\n+// { dg-do compile }\n+\n+struct c1 {};\n+\n+struct c10 : c1\n+{\n+  virtual void foo ();\n+};\n+\n+struct c11 : c10, c1\t\t//  // { dg-warning \"\" }\n+{\n+  virtual void f6 ();\n+};\n+\n+struct c28 : virtual c11\n+{\n+  void f6 ();\n+};\n+\n+void check_c28 ()\n+{\n+  c28 obj;\n+  c11 *ptr = &obj;\n+  ptr->f6 ();\n+}"}]}