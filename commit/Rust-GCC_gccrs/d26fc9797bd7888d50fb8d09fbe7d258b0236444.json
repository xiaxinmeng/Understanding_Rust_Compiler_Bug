{"sha": "d26fc9797bd7888d50fb8d09fbe7d258b0236444", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6ZDI2ZmM5Nzk3YmQ3ODg4ZDUwZmI4ZDA5ZmJlN2QyNThiMDIzNjQ0NA==", "commit": {"author": {"name": "Jakub Jelinek", "email": "jakub@redhat.com", "date": "2015-07-10T10:26:19Z"}, "committer": {"name": "Jakub Jelinek", "email": "jakub@gcc.gnu.org", "date": "2015-07-10T10:26:19Z"}, "message": "re PR middle-end/66820 (internal compiler error: in get_expr_operands, at tree-ssa-operands.c:910)\n\n\tPR middle-end/66820\n\t* gimplify.c (maybe_fold_stmt): Don't fold in ORT_PARALLEL\n\tor ORT_TASK contexts.\n\t* omp-low.c (lower_omp): Call fold_stmt even if taskreg_nesting_level\n\tis non-zero.\n\n\t* gcc.dg/gomp/pr66820.c: New test.\n\nFrom-SVN: r225661", "tree": {"sha": "33d774f746d1bcb1f3b9de1fd52df76f9c290001", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/33d774f746d1bcb1f3b9de1fd52df76f9c290001"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/d26fc9797bd7888d50fb8d09fbe7d258b0236444", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/d26fc9797bd7888d50fb8d09fbe7d258b0236444", "html_url": "https://github.com/Rust-GCC/gccrs/commit/d26fc9797bd7888d50fb8d09fbe7d258b0236444", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/d26fc9797bd7888d50fb8d09fbe7d258b0236444/comments", "author": {"login": "jakubjelinek", "id": 9370665, "node_id": "MDQ6VXNlcjkzNzA2NjU=", "avatar_url": "https://avatars.githubusercontent.com/u/9370665?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jakubjelinek", "html_url": "https://github.com/jakubjelinek", "followers_url": "https://api.github.com/users/jakubjelinek/followers", "following_url": "https://api.github.com/users/jakubjelinek/following{/other_user}", "gists_url": "https://api.github.com/users/jakubjelinek/gists{/gist_id}", "starred_url": "https://api.github.com/users/jakubjelinek/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jakubjelinek/subscriptions", "organizations_url": "https://api.github.com/users/jakubjelinek/orgs", "repos_url": "https://api.github.com/users/jakubjelinek/repos", "events_url": "https://api.github.com/users/jakubjelinek/events{/privacy}", "received_events_url": "https://api.github.com/users/jakubjelinek/received_events", "type": "User", "site_admin": false}, "committer": null, "parents": [{"sha": "e9f4322e78d9f5be3ee2a61ffa9b44f9470f0042", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/e9f4322e78d9f5be3ee2a61ffa9b44f9470f0042", "html_url": "https://github.com/Rust-GCC/gccrs/commit/e9f4322e78d9f5be3ee2a61ffa9b44f9470f0042"}], "stats": {"total": 44, "additions": 38, "deletions": 6}, "files": [{"sha": "e3b8d27da864bcd665a444a2d1643dfbeb05ee47", "filename": "gcc/ChangeLog", "status": "modified", "additions": 8, "deletions": 0, "changes": 8, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/d26fc9797bd7888d50fb8d09fbe7d258b0236444/gcc%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/d26fc9797bd7888d50fb8d09fbe7d258b0236444/gcc%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2FChangeLog?ref=d26fc9797bd7888d50fb8d09fbe7d258b0236444", "patch": "@@ -1,3 +1,11 @@\n+2015-07-10  Jakub Jelinek  <jakub@redhat.com>\n+\n+\tPR middle-end/66820\n+\t* gimplify.c (maybe_fold_stmt): Don't fold in ORT_PARALLEL\n+\tor ORT_TASK contexts.\n+\t* omp-low.c (lower_omp): Call fold_stmt even if taskreg_nesting_level\n+\tis non-zero.\n+\n 2015-07-10  Kyrylo Tkachov  <kyrylo.tkachov@arm.com>\n \n \t* expr.c (expand_cond_expr_using_cmove): Fix typos in comment"}, {"sha": "07ea2a7aa61b25e356aef9711fa078493065d83e", "filename": "gcc/gimplify.c", "status": "modified", "additions": 5, "deletions": 4, "changes": 9, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/d26fc9797bd7888d50fb8d09fbe7d258b0236444/gcc%2Fgimplify.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/d26fc9797bd7888d50fb8d09fbe7d258b0236444/gcc%2Fgimplify.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fgimplify.c?ref=d26fc9797bd7888d50fb8d09fbe7d258b0236444", "patch": "@@ -2245,16 +2245,17 @@ gimplify_arg (tree *arg_p, gimple_seq *pre_p, location_t call_location)\n   return gimplify_expr (arg_p, pre_p, NULL, test, fb);\n }\n \n-/* Don't fold inside offloading regions: it can break code by adding decl\n-   references that weren't in the source.  We'll do it during omplower pass\n-   instead.  */\n+/* Don't fold inside offloading or taskreg regions: it can break code by\n+   adding decl references that weren't in the source.  We'll do it during\n+   omplower pass instead.  */\n \n static bool\n maybe_fold_stmt (gimple_stmt_iterator *gsi)\n {\n   struct gimplify_omp_ctx *ctx;\n   for (ctx = gimplify_omp_ctxp; ctx; ctx = ctx->outer_context)\n-    if (ctx->region_type == ORT_TARGET)\n+    if (ctx->region_type == ORT_TARGET\n+\t|| (ctx->region_type & (ORT_PARALLEL | ORT_TASK)) != 0)\n       return false;\n   return fold_stmt (gsi);\n }"}, {"sha": "aa1e6666dbdc447008f2c2bdd491de04e5f59f19", "filename": "gcc/omp-low.c", "status": "modified", "additions": 2, "deletions": 2, "changes": 4, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/d26fc9797bd7888d50fb8d09fbe7d258b0236444/gcc%2Fomp-low.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/d26fc9797bd7888d50fb8d09fbe7d258b0236444/gcc%2Fomp-low.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fomp-low.c?ref=d26fc9797bd7888d50fb8d09fbe7d258b0236444", "patch": "@@ -11890,8 +11890,8 @@ lower_omp (gimple_seq *body, omp_context *ctx)\n   for (gsi = gsi_start (*body); !gsi_end_p (gsi); gsi_next (&gsi))\n     lower_omp_1 (&gsi, ctx);\n   /* During gimplification, we haven't folded statments inside offloading\n-     regions (gimplify.c:maybe_fold_stmt); do that now.  */\n-  if (target_nesting_level)\n+     or taskreg regions (gimplify.c:maybe_fold_stmt); do that now.  */\n+  if (target_nesting_level || taskreg_nesting_level)\n     for (gsi = gsi_start (*body); !gsi_end_p (gsi); gsi_next (&gsi))\n       fold_stmt (&gsi);\n   input_location = saved_location;"}, {"sha": "04c64c45ff930cb2b24b441a75380112762366ea", "filename": "gcc/testsuite/ChangeLog", "status": "modified", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/d26fc9797bd7888d50fb8d09fbe7d258b0236444/gcc%2Ftestsuite%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/d26fc9797bd7888d50fb8d09fbe7d258b0236444/gcc%2Ftestsuite%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2FChangeLog?ref=d26fc9797bd7888d50fb8d09fbe7d258b0236444", "patch": "@@ -1,3 +1,8 @@\n+2015-07-10  Jakub Jelinek  <jakub@redhat.com>\n+\n+\tPR middle-end/66820\n+\t* gcc.dg/gomp/pr66820.c: New test.\n+\n 2015-07-10  Paolo Carlini  <paolo.carlini@oracle.com>\n \n \tPR c++/65592"}, {"sha": "2fe4af1871a46c87b8907896e8d3369bdb8d9ec9", "filename": "gcc/testsuite/gcc.dg/gomp/pr66820.c", "status": "added", "additions": 18, "deletions": 0, "changes": 18, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/d26fc9797bd7888d50fb8d09fbe7d258b0236444/gcc%2Ftestsuite%2Fgcc.dg%2Fgomp%2Fpr66820.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/d26fc9797bd7888d50fb8d09fbe7d258b0236444/gcc%2Ftestsuite%2Fgcc.dg%2Fgomp%2Fpr66820.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgcc.dg%2Fgomp%2Fpr66820.c?ref=d26fc9797bd7888d50fb8d09fbe7d258b0236444", "patch": "@@ -0,0 +1,18 @@\n+/* PR middle-end/66820 */\n+/* { dg-do compile } */\n+/* { dg-options \"-fopenmp\" } */\n+\n+void bar (char *);\n+\n+void\n+foo (char **x)\n+{\n+#pragma omp parallel for\n+  for (int i = 0; i < 16; i++)\n+    {\n+      char y[50];\n+      __builtin_strcpy (y, x[i]);\n+      __builtin_strcat (y, \"foo\");\n+      bar (y);\n+    }\n+}"}]}