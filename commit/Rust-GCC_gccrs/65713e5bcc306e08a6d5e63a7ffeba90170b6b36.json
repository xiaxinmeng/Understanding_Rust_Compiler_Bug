{"sha": "65713e5bcc306e08a6d5e63a7ffeba90170b6b36", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6NjU3MTNlNWJjYzMwNmUwOGE2ZDVlNjNhN2ZmZWJhOTAxNzBiNmIzNg==", "commit": {"author": {"name": "Tobias Burnus", "email": "burnus@net-b.de", "date": "2006-11-15T10:13:16Z"}, "committer": {"name": "Tobias Burnus", "email": "burnus@gcc.gnu.org", "date": "2006-11-15T10:13:16Z"}, "message": "re PR fortran/27588 (-fbounds-check should catch substring out of range accesses)\n\nfortran/\n2006-11-15  Tobias Burnus  <burnus@net-b.de>\n            Francois-Xavier Coudert  <fxcoudert@gcc.gnu.org>\n\n       PR fortran/27588\n       * trans-expr.c (gfc_conv_substring): Add bounds checking.\n         (gfc_conv_variable, gfc_conv_substring_expr): Pass more\n         arguments to gfc_conv_substring.\n\ntestsuite/\n2006-11-15  Tobias Burnus  <burnus@net-b.de>\n\n       PR fortran/27588\n       * gfortran.dg/char_bounds_check_fail_1.f90: New test.\n\n\nCo-Authored-By: Francois-Xavier Coudert <fxcoudert@gcc.gnu.org>\n\nFrom-SVN: r118852", "tree": {"sha": "bbc3008260eb8144684b57875d8190b3ae8b0001", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/bbc3008260eb8144684b57875d8190b3ae8b0001"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/65713e5bcc306e08a6d5e63a7ffeba90170b6b36", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/65713e5bcc306e08a6d5e63a7ffeba90170b6b36", "html_url": "https://github.com/Rust-GCC/gccrs/commit/65713e5bcc306e08a6d5e63a7ffeba90170b6b36", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/65713e5bcc306e08a6d5e63a7ffeba90170b6b36/comments", "author": {"login": "tob2", "id": 264461, "node_id": "MDQ6VXNlcjI2NDQ2MQ==", "avatar_url": "https://avatars.githubusercontent.com/u/264461?v=4", "gravatar_id": "", "url": "https://api.github.com/users/tob2", "html_url": "https://github.com/tob2", "followers_url": "https://api.github.com/users/tob2/followers", "following_url": "https://api.github.com/users/tob2/following{/other_user}", "gists_url": "https://api.github.com/users/tob2/gists{/gist_id}", "starred_url": "https://api.github.com/users/tob2/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/tob2/subscriptions", "organizations_url": "https://api.github.com/users/tob2/orgs", "repos_url": "https://api.github.com/users/tob2/repos", "events_url": "https://api.github.com/users/tob2/events{/privacy}", "received_events_url": "https://api.github.com/users/tob2/received_events", "type": "User", "site_admin": false}, "committer": null, "parents": [{"sha": "8c894ae273073a4a45cd37be4ee2b06c35c40dd6", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/8c894ae273073a4a45cd37be4ee2b06c35c40dd6", "html_url": "https://github.com/Rust-GCC/gccrs/commit/8c894ae273073a4a45cd37be4ee2b06c35c40dd6"}], "stats": {"total": 50, "additions": 47, "deletions": 3}, "files": [{"sha": "ea2d741981ebdce93768e22f57a706b710f8b101", "filename": "gcc/fortran/ChangeLog", "status": "modified", "additions": 8, "deletions": 0, "changes": 8, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/65713e5bcc306e08a6d5e63a7ffeba90170b6b36/gcc%2Ffortran%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/65713e5bcc306e08a6d5e63a7ffeba90170b6b36/gcc%2Ffortran%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ffortran%2FChangeLog?ref=65713e5bcc306e08a6d5e63a7ffeba90170b6b36", "patch": "@@ -1,3 +1,11 @@\n+2006-11-15  Tobias Burnus  <burnus@net-b.de>\n+\t    Francois-Xavier Coudert  <fxcoudert@gcc.gnu.org>\n+\n+\tPR fortran/27588\n+\t* trans-expr.c (gfc_conv_substring): Add bounds checking.\n+\t  (gfc_conv_variable, gfc_conv_substring_expr): Pass more\n+\t  arguments to gfc_conv_substring.\n+\n 2006-11-15  Tobias Burnus  <burnus@net-b.de>\n \n \tPR fortran/29806"}, {"sha": "984c6d34c5b3d99b695bada724026a00b26aca55", "filename": "gcc/fortran/trans-expr.c", "status": "modified", "additions": 34, "deletions": 3, "changes": 37, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/65713e5bcc306e08a6d5e63a7ffeba90170b6b36/gcc%2Ffortran%2Ftrans-expr.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/65713e5bcc306e08a6d5e63a7ffeba90170b6b36/gcc%2Ffortran%2Ftrans-expr.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ffortran%2Ftrans-expr.c?ref=65713e5bcc306e08a6d5e63a7ffeba90170b6b36", "patch": "@@ -234,13 +234,16 @@ gfc_trans_init_string_length (gfc_charlen * cl, stmtblock_t * pblock)\n \n \n static void\n-gfc_conv_substring (gfc_se * se, gfc_ref * ref, int kind)\n+gfc_conv_substring (gfc_se * se, gfc_ref * ref, int kind,\n+\t\t    const char *name, locus *where)\n {\n   tree tmp;\n   tree type;\n   tree var;\n+  tree fault;\n   gfc_se start;\n   gfc_se end;\n+  char *msg;\n \n   type = gfc_get_character_type (kind, ref->u.ss.length);\n   type = build_pointer_type (type);\n@@ -272,6 +275,33 @@ gfc_conv_substring (gfc_se * se, gfc_ref * ref, int kind)\n       gfc_conv_expr_type (&end, ref->u.ss.end, gfc_charlen_type_node);\n       gfc_add_block_to_block (&se->pre, &end.pre);\n     }\n+  if (flag_bounds_check)\n+    {\n+      /* Check lower bound.  */\n+      fault = fold_build2 (LT_EXPR, boolean_type_node, start.expr,\n+                           build_int_cst (gfc_charlen_type_node, 1));\n+      if (name)\n+\tasprintf (&msg, \"Substring out of bounds: lower bound of '%s' \"\n+\t\t  \"is less than one\", name);\n+      else\n+\tasprintf (&msg, \"Substring out of bounds: lower bound \"\n+\t\t  \"is less than one\");\n+      gfc_trans_runtime_check (fault, msg, &se->pre, where);\n+      gfc_free (msg);\n+\n+      /* Check upper bound.  */\n+      fault = fold_build2 (GT_EXPR, boolean_type_node, end.expr,\n+                           se->string_length);\n+      if (name)\n+\tasprintf (&msg, \"Substring out of bounds: upper bound of '%s' \"\n+\t\t  \"exceeds string length\", name);\n+      else\n+\tasprintf (&msg, \"Substring out of bounds: upper bound \"\n+\t\t  \"exceeds string length\");\n+      gfc_trans_runtime_check (fault, msg, &se->pre, where);\n+      gfc_free (msg);\n+    }\n+\n   tmp = fold_build2 (MINUS_EXPR, gfc_charlen_type_node,\n \t\t     build_int_cst (gfc_charlen_type_node, 1),\n \t\t     start.expr);\n@@ -485,7 +515,8 @@ gfc_conv_variable (gfc_se * se, gfc_expr * expr)\n \t  break;\n \n \tcase REF_SUBSTRING:\n-\t  gfc_conv_substring (se, ref, expr->ts.kind);\n+\t  gfc_conv_substring (se, ref, expr->ts.kind,\n+\t\t\t      expr->symtree->name, &expr->where);\n \t  break;\n \n \tdefault:\n@@ -2958,7 +2989,7 @@ gfc_conv_substring_expr (gfc_se * se, gfc_expr * expr)\n   se->string_length = TYPE_MAX_VALUE (TYPE_DOMAIN (TREE_TYPE (se->expr)));\n   TYPE_STRING_FLAG (TREE_TYPE (se->expr))=1;\n \n-  gfc_conv_substring(se,ref,expr->ts.kind);\n+  gfc_conv_substring(se,ref,expr->ts.kind,NULL,&expr->where);\n }\n \n "}, {"sha": "c485ed6b610468f1cf0e276f9867ff123145999f", "filename": "gcc/testsuite/ChangeLog", "status": "modified", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/65713e5bcc306e08a6d5e63a7ffeba90170b6b36/gcc%2Ftestsuite%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/65713e5bcc306e08a6d5e63a7ffeba90170b6b36/gcc%2Ftestsuite%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2FChangeLog?ref=65713e5bcc306e08a6d5e63a7ffeba90170b6b36", "patch": "@@ -1,3 +1,8 @@\n+2006-11-15  Tobias Burnus  <burnus@net-b.de>\n+\n+\tPR fortran/27588\n+\t* gfortran.dg/char_bounds_check_fail_1.f90: New test.\n+\n 2006-11-15  Tobias Burnus  <burnus@net-b.de>\n \n \tPR fortran/29806"}]}