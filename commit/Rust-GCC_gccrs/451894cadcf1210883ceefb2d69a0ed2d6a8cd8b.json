{"sha": "451894cadcf1210883ceefb2d69a0ed2d6a8cd8b", "node_id": "C_kwDOANBUbNoAKDQ1MTg5NGNhZGNmMTIxMDg4M2NlZWZiMmQ2OWEwZWQyZDZhOGNkOGI", "commit": {"author": {"name": "Nathan Sidwell", "email": "nathan@acm.org", "date": "2022-03-08T21:00:35Z"}, "committer": {"name": "Nathan Sidwell", "email": "nathan@acm.org", "date": "2022-05-17T18:10:03Z"}, "message": "demangler: Structured Bindings\n\nC++ Structured bindings have a mangling that has yet to be formally\ndocumented.  However, it's been around for a while and shows up for\nmodule support.\n\n\tinclude/\n\t* demangle.h (enum demangle_component_type): Add\n\tDEMANGLE_COMPONENT_STRUCTURED_BINDING.\n\tlibiberty/\n\t* cp-demangle.c (d_make_comp): Adjust.\n\t(d_unqualified_name): Add 'DC' support.\n\t(d_count_template_scopes): Adjust.\n\t(d_print_comp_inner): Add structured binding.\n\t* testsuite/demangle-expected: Add testcases.", "tree": {"sha": "1d02872b057666ed99f2fbd5d5abb1bcefb2293b", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/1d02872b057666ed99f2fbd5d5abb1bcefb2293b"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/451894cadcf1210883ceefb2d69a0ed2d6a8cd8b", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/451894cadcf1210883ceefb2d69a0ed2d6a8cd8b", "html_url": "https://github.com/Rust-GCC/gccrs/commit/451894cadcf1210883ceefb2d69a0ed2d6a8cd8b", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/451894cadcf1210883ceefb2d69a0ed2d6a8cd8b/comments", "author": {"login": "urnathan", "id": 13103001, "node_id": "MDQ6VXNlcjEzMTAzMDAx", "avatar_url": "https://avatars.githubusercontent.com/u/13103001?v=4", "gravatar_id": "", "url": "https://api.github.com/users/urnathan", "html_url": "https://github.com/urnathan", "followers_url": "https://api.github.com/users/urnathan/followers", "following_url": "https://api.github.com/users/urnathan/following{/other_user}", "gists_url": "https://api.github.com/users/urnathan/gists{/gist_id}", "starred_url": "https://api.github.com/users/urnathan/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/urnathan/subscriptions", "organizations_url": "https://api.github.com/users/urnathan/orgs", "repos_url": "https://api.github.com/users/urnathan/repos", "events_url": "https://api.github.com/users/urnathan/events{/privacy}", "received_events_url": "https://api.github.com/users/urnathan/received_events", "type": "User", "site_admin": false}, "committer": {"login": "urnathan", "id": 13103001, "node_id": "MDQ6VXNlcjEzMTAzMDAx", "avatar_url": "https://avatars.githubusercontent.com/u/13103001?v=4", "gravatar_id": "", "url": "https://api.github.com/users/urnathan", "html_url": "https://github.com/urnathan", "followers_url": "https://api.github.com/users/urnathan/followers", "following_url": "https://api.github.com/users/urnathan/following{/other_user}", "gists_url": "https://api.github.com/users/urnathan/gists{/gist_id}", "starred_url": "https://api.github.com/users/urnathan/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/urnathan/subscriptions", "organizations_url": "https://api.github.com/users/urnathan/orgs", "repos_url": "https://api.github.com/users/urnathan/repos", "events_url": "https://api.github.com/users/urnathan/events{/privacy}", "received_events_url": "https://api.github.com/users/urnathan/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "7a3f38a966a52893fb5bae301a1a3d56961358fb", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/7a3f38a966a52893fb5bae301a1a3d56961358fb", "html_url": "https://github.com/Rust-GCC/gccrs/commit/7a3f38a966a52893fb5bae301a1a3d56961358fb"}], "stats": {"total": 63, "additions": 56, "deletions": 7}, "files": [{"sha": "44a27374d4f4c883b26fdfab528db59fbd231e2e", "filename": "include/demangle.h", "status": "modified", "additions": 3, "deletions": 1, "changes": 4, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/451894cadcf1210883ceefb2d69a0ed2d6a8cd8b/include%2Fdemangle.h", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/451894cadcf1210883ceefb2d69a0ed2d6a8cd8b/include%2Fdemangle.h", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/include%2Fdemangle.h?ref=451894cadcf1210883ceefb2d69a0ed2d6a8cd8b", "patch": "@@ -449,7 +449,9 @@ enum demangle_component_type\n   /* A cloned function.  */\n   DEMANGLE_COMPONENT_CLONE,\n   DEMANGLE_COMPONENT_NOEXCEPT,\n-  DEMANGLE_COMPONENT_THROW_SPEC\n+  DEMANGLE_COMPONENT_THROW_SPEC,\n+\n+  DEMANGLE_COMPONENT_STRUCTURED_BINDING\n };\n \n /* Types which are only used internally.  */"}, {"sha": "fc618fa7383e2b6dcd202538ea44ef9ed79096a9", "filename": "libiberty/cp-demangle.c", "status": "modified", "additions": 43, "deletions": 6, "changes": 49, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/451894cadcf1210883ceefb2d69a0ed2d6a8cd8b/libiberty%2Fcp-demangle.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/451894cadcf1210883ceefb2d69a0ed2d6a8cd8b/libiberty%2Fcp-demangle.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libiberty%2Fcp-demangle.c?ref=451894cadcf1210883ceefb2d69a0ed2d6a8cd8b", "patch": "@@ -1020,6 +1020,7 @@ d_make_comp (struct d_info *di, enum demangle_component_type type,\n     case DEMANGLE_COMPONENT_NULLARY:\n     case DEMANGLE_COMPONENT_TRINARY_ARG2:\n     case DEMANGLE_COMPONENT_TPARM_OBJ:\n+    case DEMANGLE_COMPONENT_STRUCTURED_BINDING:\n       if (left == NULL)\n \treturn NULL;\n       break;\n@@ -1619,12 +1620,12 @@ d_prefix (struct d_info *di, int subst)\n     }\n }\n \n-/* <unqualified-name> ::= <operator-name>\n-                      ::= <ctor-dtor-name>\n-                      ::= <source-name>\n-\t\t      ::= <local-source-name> \n-\n-    <local-source-name>\t::= L <source-name> <discriminator>\n+/* <unqualified-name> ::= <operator-name> [<abi-tags>]\n+                      ::= <ctor-dtor-name> [<abi-tags>]\n+                      ::= <source-name> [<abi-tags>]\n+\t\t      ::= <local-source-name>  [<abi-tags>]\n+\t\t      ::= DC <source-name>+ E [<abi-tags>]\n+    <local-source-name>\t::= L <source-name> <discriminator> [<abi-tags>]\n */\n \n static struct demangle_component *\n@@ -1655,6 +1656,28 @@ d_unqualified_name (struct d_info *di)\n \t\t\t       d_source_name (di));\n \t}\n     }\n+  else if (peek == 'D' && d_peek_next_char (di) == 'C')\n+    {\n+      // structured binding\n+      d_advance (di, 2);\n+      struct demangle_component *prev = NULL;\n+      do\n+\t{\n+\t  struct demangle_component *next = \n+\t    d_make_comp (di, DEMANGLE_COMPONENT_STRUCTURED_BINDING,\n+\t\t\t d_source_name (di), NULL);\n+\t  if (prev)\n+\t    d_right (prev) = next;\n+\t  else\n+\t    ret = next;\n+\t  prev = next;\n+\t}\n+      while (prev && d_peek_char (di) != 'E');\n+      if (prev)\n+\td_advance (di, 1);\n+      else\n+\tret = NULL;\n+    }\n   else if (peek == 'C' || peek == 'D')\n     ret = d_ctor_dtor_name (di);\n   else if (peek == 'L')\n@@ -4179,6 +4202,7 @@ d_count_templates_scopes (struct d_print_info *dpi,\n     case DEMANGLE_COMPONENT_CHARACTER:\n     case DEMANGLE_COMPONENT_NUMBER:\n     case DEMANGLE_COMPONENT_UNNAMED_TYPE:\n+    case DEMANGLE_COMPONENT_STRUCTURED_BINDING:\n       break;\n \n     case DEMANGLE_COMPONENT_TEMPLATE:\n@@ -4850,6 +4874,19 @@ d_print_comp_inner (struct d_print_info *dpi, int options,\n       d_append_char (dpi, ']');\n       return;\n \n+    case DEMANGLE_COMPONENT_STRUCTURED_BINDING:\n+      d_append_char (dpi, '[');\n+      for (;;)\n+\t{\n+\t  d_print_comp (dpi, options, d_left (dc));\n+\t  dc = d_right (dc);\n+\t  if (!dc)\n+\t    break;\n+\t  d_append_string (dpi, \", \");\n+\t}\n+      d_append_char (dpi, ']');\n+      return;\n+\n     case DEMANGLE_COMPONENT_QUAL_NAME:\n     case DEMANGLE_COMPONENT_LOCAL_NAME:\n       d_print_comp (dpi, options, d_left (dc));"}, {"sha": "2b0b531d4bf69e42595eb8fb4a76f8bd1f9564dd", "filename": "libiberty/testsuite/demangle-expected", "status": "modified", "additions": 10, "deletions": 0, "changes": 10, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/451894cadcf1210883ceefb2d69a0ed2d6a8cd8b/libiberty%2Ftestsuite%2Fdemangle-expected", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/451894cadcf1210883ceefb2d69a0ed2d6a8cd8b/libiberty%2Ftestsuite%2Fdemangle-expected", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libiberty%2Ftestsuite%2Fdemangle-expected?ref=451894cadcf1210883ceefb2d69a0ed2d6a8cd8b", "patch": "@@ -1493,3 +1493,13 @@ decltype ({parm#1}.A::x) f<A>(A)\n \n _Z2f6IP1AEDtptfp_gssr1A1BE1xET_\n decltype ({parm#1}->(::A::B::x)) f6<A*>(A*)\n+\n+# Structured Bindings\n+_ZDC1a1bE\n+[a, b]\n+\n+_ZNStDC1aEE\n+std::[a]\n+\n+_ZN3NMSDC1aEE\n+NMS::[a]"}]}