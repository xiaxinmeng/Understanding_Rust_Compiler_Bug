{"sha": "6b99d1c036cedd5d1e123ffca8201946fbcd2929", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6NmI5OWQxYzAzNmNlZGQ1ZDFlMTIzZmZjYTgyMDE5NDZmYmNkMjkyOQ==", "commit": {"author": {"name": "Mark Mitchell", "email": "mark@codesourcery.com", "date": "2003-02-18T19:17:29Z"}, "committer": {"name": "Mark Mitchell", "email": "mmitchel@gcc.gnu.org", "date": "2003-02-18T19:17:29Z"}, "message": "re PR c++/9704 (miscompilation of classes with bit fields)\n\n\tPR c++/9704\n\t* class.c (layout_class_type): In the 3.2 ABI, take into account\n\ttrailing bit fields when computing CLASSTYPE_SIZE_UNIT.\n\n\tPR c++/9704\n\t* g++.dg/init/copy5.C: New test.\n\nFrom-SVN: r63055", "tree": {"sha": "6194e752687100426e32b0c55b5f09fae875b2d3", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/6194e752687100426e32b0c55b5f09fae875b2d3"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/6b99d1c036cedd5d1e123ffca8201946fbcd2929", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/6b99d1c036cedd5d1e123ffca8201946fbcd2929", "html_url": "https://github.com/Rust-GCC/gccrs/commit/6b99d1c036cedd5d1e123ffca8201946fbcd2929", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/6b99d1c036cedd5d1e123ffca8201946fbcd2929/comments", "author": null, "committer": null, "parents": [{"sha": "2e120205b3fef4037f776cdeb3159365be01e300", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/2e120205b3fef4037f776cdeb3159365be01e300", "html_url": "https://github.com/Rust-GCC/gccrs/commit/2e120205b3fef4037f776cdeb3159365be01e300"}], "stats": {"total": 31, "additions": 27, "deletions": 4}, "files": [{"sha": "9071de04bf3c3ec989c78fb61e0569167942b673", "filename": "gcc/cp/ChangeLog", "status": "modified", "additions": 6, "deletions": 0, "changes": 6, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/6b99d1c036cedd5d1e123ffca8201946fbcd2929/gcc%2Fcp%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/6b99d1c036cedd5d1e123ffca8201946fbcd2929/gcc%2Fcp%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fcp%2FChangeLog?ref=6b99d1c036cedd5d1e123ffca8201946fbcd2929", "patch": "@@ -1,3 +1,9 @@\n+2003-02-18  Mark Mitchell  <mark@codesourcery.com>\n+\n+\tPR c++/9704\n+\t* class.c (layout_class_type): In the 3.2 ABI, take into account\n+\ttrailing bit fields when computing CLASSTYPE_SIZE_UNIT.\n+\n 2003-02-18  Matt Austern <austern@apple.com>\n \t\n \t* cp/cp-lang.c: Change lang hooks so that final_write_globals does"}, {"sha": "5ee67bca7809c66be8151d49898aae7c67077f7f", "filename": "gcc/cp/class.c", "status": "modified", "additions": 16, "deletions": 4, "changes": 20, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/6b99d1c036cedd5d1e123ffca8201946fbcd2929/gcc%2Fcp%2Fclass.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/6b99d1c036cedd5d1e123ffca8201946fbcd2929/gcc%2Fcp%2Fclass.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fcp%2Fclass.c?ref=6b99d1c036cedd5d1e123ffca8201946fbcd2929", "patch": "@@ -5194,16 +5194,28 @@ layout_class_type (tree t, tree *virtuals_p)\n \t}\n       else\n \t{\n+\t  tree eoc;\n+\n+\t  /* If the ABI version is not at least two, and the last\n+\t     field was a bit-field, RLI may not be on a byte\n+\t     boundary.  In particular, rli_size_unit_so_far might\n+\t     indicate the last complete byte, while rli_size_so_far\n+\t     indicates the total number of bits used.  Therefore,\n+\t     rli_size_so_far, rather than rli_size_unit_so_far, is\n+\t     used to compute TYPE_SIZE_UNIT.  */\n+\t  eoc = end_of_class (t, /*include_virtuals_p=*/0);\n \t  TYPE_SIZE_UNIT (base_t) \n \t    = size_binop (MAX_EXPR,\n-\t\t\t  rli_size_unit_so_far (rli),\n-\t\t\t  end_of_class (t, /*include_virtuals_p=*/0));\n+\t\t\t  convert (sizetype,\n+\t\t\t\t   size_binop (CEIL_DIV_EXPR,\n+\t\t\t\t\t       rli_size_so_far (rli),\n+\t\t\t\t\t       bitsize_int (BITS_PER_UNIT))),\n+\t\t\t  eoc);\n \t  TYPE_SIZE (base_t) \n \t    = size_binop (MAX_EXPR,\n \t\t\t  rli_size_so_far (rli),\n \t\t\t  size_binop (MULT_EXPR,\n-\t\t\t\t      convert (bitsizetype,\n-\t\t\t\t\t       TYPE_SIZE_UNIT (base_t)),\n+\t\t\t\t      convert (bitsizetype, eoc),\n \t\t\t\t      bitsize_int (BITS_PER_UNIT)));\n \t}\n       TYPE_ALIGN (base_t) = rli->record_align;"}, {"sha": "220c69643e4e75318a572105ad5d2beab7a11d0e", "filename": "gcc/testsuite/ChangeLog", "status": "modified", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/6b99d1c036cedd5d1e123ffca8201946fbcd2929/gcc%2Ftestsuite%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/6b99d1c036cedd5d1e123ffca8201946fbcd2929/gcc%2Ftestsuite%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2FChangeLog?ref=6b99d1c036cedd5d1e123ffca8201946fbcd2929", "patch": "@@ -1,3 +1,8 @@\n+2003-02-18  Mark Mitchell  <mark@codesourcery.com>\n+\n+\tPR c++/9704\n+\t* g++.dg/init/copy5.C: New test.\n+\t\n 2003-02-18  Geoffrey Keating  <geoffk@apple.com>\n \n \t* gcc.dg/pch/pch.exp: Delete $bname.h before copying into it."}]}