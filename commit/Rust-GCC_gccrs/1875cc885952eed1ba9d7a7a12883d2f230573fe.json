{"sha": "1875cc885952eed1ba9d7a7a12883d2f230573fe", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6MTg3NWNjODg1OTUyZWVkMWJhOWQ3YTdhMTI4ODNkMmYyMzA1NzNmZQ==", "commit": {"author": {"name": "Jim Wilson", "email": "wilson@gcc.gnu.org", "date": "1993-08-27T17:15:28Z"}, "committer": {"name": "Jim Wilson", "email": "wilson@gcc.gnu.org", "date": "1993-08-27T17:15:28Z"}, "message": "(print_operand_address): When TARGET_MINIMAL_TOC, use r30 instead of r2 for TOC references.\n\n(print_operand_address): When TARGET_MINIMAL_TOC, use\nr30 instead of r2 for TOC references.\n(output_prologue): If TARGET_MINIMAL_TOC, and the constant pool\nis needed, then setup r30.\n(output_toc): When TARGET_MINIMAL_TOC, use .long instead of .tc.\n\nFrom-SVN: r5218", "tree": {"sha": "06506f15417da01f48dbbae0199bfc4038ff0e76", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/06506f15417da01f48dbbae0199bfc4038ff0e76"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/1875cc885952eed1ba9d7a7a12883d2f230573fe", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/1875cc885952eed1ba9d7a7a12883d2f230573fe", "html_url": "https://github.com/Rust-GCC/gccrs/commit/1875cc885952eed1ba9d7a7a12883d2f230573fe", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/1875cc885952eed1ba9d7a7a12883d2f230573fe/comments", "author": null, "committer": null, "parents": [{"sha": "b5a9fbb3d1ad79efb4b244a76672eeafcfb16d15", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/b5a9fbb3d1ad79efb4b244a76672eeafcfb16d15", "html_url": "https://github.com/Rust-GCC/gccrs/commit/b5a9fbb3d1ad79efb4b244a76672eeafcfb16d15"}], "stats": {"total": 46, "additions": 34, "deletions": 12}, "files": [{"sha": "f4e0ed80e721670b585dd0b7947e20acf89a1418", "filename": "gcc/config/rs6000/rs6000.c", "status": "modified", "additions": 34, "deletions": 12, "changes": 46, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/1875cc885952eed1ba9d7a7a12883d2f230573fe/gcc%2Fconfig%2Frs6000%2Frs6000.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/1875cc885952eed1ba9d7a7a12883d2f230573fe/gcc%2Fconfig%2Frs6000%2Frs6000.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fconfig%2Frs6000%2Frs6000.c?ref=1875cc885952eed1ba9d7a7a12883d2f230573fe", "patch": "@@ -1171,7 +1171,12 @@ print_operand_address (file, x)\n   else if (GET_CODE (x) == SYMBOL_REF || GET_CODE (x) == CONST)\n     {\n       output_addr_const (file, x);\n-      fprintf (file, \"(2)\");\n+      /* When TARGET_MINIMAL_TOC, use the indirected toc table pointer instead\n+\t of the toc pointer.  */\n+      if (TARGET_MINIMAL_TOC)\n+\tfprintf (file, \"(30)\");\n+      else\n+\tfprintf (file, \"(2)\");\n     }\n   else if (GET_CODE (x) == PLUS && GET_CODE (XEXP (x, 1)) == REG)\n     {\n@@ -1372,6 +1377,11 @@ output_prolog (file, size)\n   /* Set frame pointer, if needed.  */\n   if (frame_pointer_needed)\n     fprintf (file, \"\\toril 31,1,0\\n\");\n+\n+  /* If TARGET_MINIMAL_TOC, and the constant pool is needed, then load the\n+     TOC_TABLE address into register 30.  */\n+  if (TARGET_MINIMAL_TOC && get_pool_size () != 0)\n+    fprintf (file, \"\\tl 30,LCTOC..0(2)\\n\");\n }\n \n /* Write function epilogue.  */\n@@ -1643,9 +1653,13 @@ output_toc (file, x, labelno)\n       && BITS_PER_WORD == HOST_BITS_PER_INT\n       && TARGET_FP_IN_TOC)\n     {\n-      fprintf (file, \"\\t.tc FD_%x_%x[TC],%d,%d\\n\",\n-\t       CONST_DOUBLE_LOW (x), CONST_DOUBLE_HIGH (x),\n-\t       CONST_DOUBLE_LOW (x), CONST_DOUBLE_HIGH (x));\n+      if (TARGET_MINIMAL_TOC)\n+\tfprintf (file, \"\\t.long %d\\n\\t.long %d\\n\",\n+\t\t CONST_DOUBLE_LOW (x), CONST_DOUBLE_HIGH (x));\n+      else\n+\tfprintf (file, \"\\t.tc FD_%x_%x[TC],%d,%d\\n\",\n+\t\t CONST_DOUBLE_LOW (x), CONST_DOUBLE_HIGH (x),\n+\t\t CONST_DOUBLE_LOW (x), CONST_DOUBLE_HIGH (x));\n       return;\n     }\n   else if (GET_CODE (x) == CONST_DOUBLE && GET_MODE (x) == SFmode\n@@ -1656,7 +1670,10 @@ output_toc (file, x, labelno)\n       if (val == 0 || GET_CODE (val) != CONST_INT)\n \tabort ();\n \n-      fprintf (file, \"\\t.tc FS_%x[TC],%d\\n\", INTVAL (val), INTVAL (val));\n+      if (TARGET_MINIMAL_TOC)\n+\tfprintf (file, \"\\t.long %d\\n\", INTVAL (val));\n+      else\n+\tfprintf (file, \"\\t.tc FS_%x[TC],%d\\n\", INTVAL (val), INTVAL (val));\n       return;\n     }\n \n@@ -1675,15 +1692,20 @@ output_toc (file, x, labelno)\n   else\n     abort ();\n \n-  fprintf (file, \"\\t.tc \");\n-  RS6000_OUTPUT_BASENAME (file, name);\n+  if (TARGET_MINIMAL_TOC)\n+    fprintf (file, \"\\t.long \");\n+  else\n+    {\n+      fprintf (file, \"\\t.tc \");\n+      RS6000_OUTPUT_BASENAME (file, name);\n \n-  if (offset < 0)\n-    fprintf (file, \".N%d\", - offset);\n-  else if (offset)\n-    fprintf (file, \".P%d\", offset);\n+      if (offset < 0)\n+\tfprintf (file, \".N%d\", - offset);\n+      else if (offset)\n+\tfprintf (file, \".P%d\", offset);\n \n-  fprintf (file, \"[TC],\");\n+      fprintf (file, \"[TC],\");\n+    }\n   output_addr_const (file, x);\n   fprintf (file, \"\\n\");\n }"}]}