{"sha": "4123b473427ca6854f874c77f5ce78c7e8c133a7", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6NDEyM2I0NzM0MjdjYTY4NTRmODc0Yzc3ZjVjZTc4YzdlOGMxMzNhNw==", "commit": {"author": {"name": "Ed Schonberg", "email": "schonberg@adacore.com", "date": "2019-07-22T13:56:40Z"}, "committer": {"name": "Pierre-Marie de Rodat", "email": "pmderodat@gcc.gnu.org", "date": "2019-07-22T13:56:40Z"}, "message": "[Ada] Incorrect values in conversion from fixed-point subtype with 'Small\n\nThis patch fixes incorrect computations involving a fixed-point subtype\nwhose parent type has an aspect specification for 'Small.\n\nExecuting the following:\n\n   gnatmake -q conv\n   ./conv\n\nmust yield:\n\n   9000.000000\n    9.00000000000000E+03\n    9000.000000\n    9.00000000000000E+03\n    9.00000000000000E+03\n    9.00000000000000E+03\n    9.00000000000000E+03\n    9.00000000000000E+03\n\n----\nwith Text_IO; use Text_IO;\nprocedure Conv is\n  V_P : constant := 10.0 ** (-6);\n  M_V : constant := 9000.0;\n  N_V : constant := -9000.0;\n  type V_T is delta V_P range N_V .. M_V  with Small => V_P;\n  subtype S_T is V_T range 0.0 .. M_V;\n\n  function Convert (Input : in S_T) return Long_Float is\n  begin\n    Put_Line (Input'Img);\n    Put_Line (Long_Float'Image (Long_Float (Input)));\n    return Long_Float (Input);\n  end Convert;\n\nbegin\n\n  declare\n    Var_S : constant S_T := S_T'Last;\n    Output : constant Long_Float := Convert (Var_S);\n  begin\n    Put_Line (Long_Float'Image (Convert (Var_S)));\n    Put_Line (Long_Float'Image (Long_Float (Var_S)));\n    Put_Line (Output'Img);\n  end;\n\n  Put_Line (Long_Float'Image (Long_Float (S_T'Last)));\n\nend Conv;\n\n2019-07-22  Ed Schonberg  <schonberg@adacore.com>\n\ngcc/ada/\n\n\t* freeze.adb (Freeze_Fixed_Point_Type):  When freezing a\n\tfixed-point subtype, check whether the parent type declarastion\n\tincludes an aspect specification for the 'Small type attribute,\n\tand inherit the specified value.\n\nFrom-SVN: r273671", "tree": {"sha": "6c354aadb90dd3dfea9795411c01bb06c74658be", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/6c354aadb90dd3dfea9795411c01bb06c74658be"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/4123b473427ca6854f874c77f5ce78c7e8c133a7", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/4123b473427ca6854f874c77f5ce78c7e8c133a7", "html_url": "https://github.com/Rust-GCC/gccrs/commit/4123b473427ca6854f874c77f5ce78c7e8c133a7", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/4123b473427ca6854f874c77f5ce78c7e8c133a7/comments", "author": {"login": "Edschonberg", "id": 6352375, "node_id": "MDQ6VXNlcjYzNTIzNzU=", "avatar_url": "https://avatars.githubusercontent.com/u/6352375?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Edschonberg", "html_url": "https://github.com/Edschonberg", "followers_url": "https://api.github.com/users/Edschonberg/followers", "following_url": "https://api.github.com/users/Edschonberg/following{/other_user}", "gists_url": "https://api.github.com/users/Edschonberg/gists{/gist_id}", "starred_url": "https://api.github.com/users/Edschonberg/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Edschonberg/subscriptions", "organizations_url": "https://api.github.com/users/Edschonberg/orgs", "repos_url": "https://api.github.com/users/Edschonberg/repos", "events_url": "https://api.github.com/users/Edschonberg/events{/privacy}", "received_events_url": "https://api.github.com/users/Edschonberg/received_events", "type": "User", "site_admin": false}, "committer": null, "parents": [{"sha": "2fdc20b65c2f3409591aeea810001a29ff1d6739", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/2fdc20b65c2f3409591aeea810001a29ff1d6739", "html_url": "https://github.com/Rust-GCC/gccrs/commit/2fdc20b65c2f3409591aeea810001a29ff1d6739"}], "stats": {"total": 18, "additions": 18, "deletions": 0}, "files": [{"sha": "5113e77fea285cdfd378cbd0665186c56ea212c5", "filename": "gcc/ada/ChangeLog", "status": "modified", "additions": 7, "deletions": 0, "changes": 7, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/4123b473427ca6854f874c77f5ce78c7e8c133a7/gcc%2Fada%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/4123b473427ca6854f874c77f5ce78c7e8c133a7/gcc%2Fada%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fada%2FChangeLog?ref=4123b473427ca6854f874c77f5ce78c7e8c133a7", "patch": "@@ -1,3 +1,10 @@\n+2019-07-22  Ed Schonberg  <schonberg@adacore.com>\n+\n+\t* freeze.adb (Freeze_Fixed_Point_Type):  When freezing a\n+\tfixed-point subtype, check whether the parent type declarastion\n+\tincludes an aspect specification for the 'Small type attribute,\n+\tand inherit the specified value.\n+\n 2019-07-22  Javier Miranda  <miranda@adacore.com>\n \n \t* freeze.adb (Freeze_Subprogram): Check that C++ constructors"}, {"sha": "00d20e9016928ba870becc803e230ba6050aa26e", "filename": "gcc/ada/freeze.adb", "status": "modified", "additions": 11, "deletions": 0, "changes": 11, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/4123b473427ca6854f874c77f5ce78c7e8c133a7/gcc%2Fada%2Ffreeze.adb", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/4123b473427ca6854f874c77f5ce78c7e8c133a7/gcc%2Fada%2Ffreeze.adb", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fada%2Ffreeze.adb?ref=4123b473427ca6854f874c77f5ce78c7e8c133a7", "patch": "@@ -8003,6 +8003,7 @@ package body Freeze is\n       Brng  : constant Node_Id    := Scalar_Range (Btyp);\n       BLo   : constant Node_Id    := Low_Bound (Brng);\n       BHi   : constant Node_Id    := High_Bound (Brng);\n+      Par   : constant Entity_Id  := First_Subtype (Typ);\n       Small : constant Ureal      := Small_Value (Typ);\n       Loval : Ureal;\n       Hival : Ureal;\n@@ -8055,6 +8056,16 @@ package body Freeze is\n          end if;\n       end if;\n \n+      --  The 'small attribute may have been specified with an aspect,\n+      --  in which case it is processed after a subtype declaration, so\n+      --  inherit now the specified value.\n+\n+      if Typ /= Par\n+        and then Present (Find_Aspect (Par, Aspect_Small))\n+      then\n+         Set_Small_Value (Typ, Small_Value (Par));\n+      end if;\n+\n       --  Immediate return if the range is already analyzed. This means that\n       --  the range is already set, and does not need to be computed by this\n       --  routine."}]}