{"sha": "9231aa17d6498905234d8e35216b324a1b067c8c", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6OTIzMWFhMTdkNjQ5ODkwNTIzNGQ4ZTM1MjE2YjMyNGExYjA2N2M4Yw==", "commit": {"author": {"name": "Steven G. Kargl", "email": "kargl@gcc.gnu.org", "date": "2015-11-18T22:51:39Z"}, "committer": {"name": "Steven G. Kargl", "email": "kargl@gcc.gnu.org", "date": "2015-11-18T22:51:39Z"}, "message": "re PR fortran/43996 (ICE in gfc_conv_array_initializer due to incomplete simplification of init expressions)\n\n2015-11-18  Steven G. Kargl  <kargl@gcc.gnu.org>\n\n\tPR fortran/43996\n\t* simplify.c (gfc_simplify_spread): Issue error for too large array \n\tconstructor in a PARAMETER statement.\n\n2015-11-18  Steven G. Kargl  <kargl@gcc.gnu.org>\n\n\tPR fortran/43996\n\t* gfortran.dg/pr43996.f90: New test.\n\nFrom-SVN: r230579", "tree": {"sha": "c50d7aa9f872e8e46b85f3cbb814297892dddcaf", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/c50d7aa9f872e8e46b85f3cbb814297892dddcaf"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/9231aa17d6498905234d8e35216b324a1b067c8c", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/9231aa17d6498905234d8e35216b324a1b067c8c", "html_url": "https://github.com/Rust-GCC/gccrs/commit/9231aa17d6498905234d8e35216b324a1b067c8c", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/9231aa17d6498905234d8e35216b324a1b067c8c/comments", "author": null, "committer": null, "parents": [{"sha": "c29c36ad5d0b283404cbbaae75a4b9fb827491f2", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/c29c36ad5d0b283404cbbaae75a4b9fb827491f2", "html_url": "https://github.com/Rust-GCC/gccrs/commit/c29c36ad5d0b283404cbbaae75a4b9fb827491f2"}], "stats": {"total": 38, "additions": 34, "deletions": 4}, "files": [{"sha": "5e10387b8a03f6dd512d032d34116e0f8685ecd0", "filename": "gcc/fortran/ChangeLog", "status": "modified", "additions": 6, "deletions": 0, "changes": 6, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/9231aa17d6498905234d8e35216b324a1b067c8c/gcc%2Ffortran%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/9231aa17d6498905234d8e35216b324a1b067c8c/gcc%2Ffortran%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ffortran%2FChangeLog?ref=9231aa17d6498905234d8e35216b324a1b067c8c", "patch": "@@ -1,3 +1,9 @@\n+2015-11-18  Steven G. Kargl  <kargl@gcc.gnu.org>\n+\n+\tPR fortran/43996\n+\t* simplify.c (gfc_simplify_spread): Issue error for too large array \n+\tconstructor in a PARAMETER statement.\n+\n 2015-11-17  Steven G. Kargl  <kargl@gcc.gnu.org>\n \n \t* primary.c (gfc_match_structure_constructor): Fix whitespace."}, {"sha": "4df3fe6c5b52c18ff5e995dfdf3f0d84c5e838ea", "filename": "gcc/fortran/simplify.c", "status": "modified", "additions": 16, "deletions": 4, "changes": 20, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/9231aa17d6498905234d8e35216b324a1b067c8c/gcc%2Ffortran%2Fsimplify.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/9231aa17d6498905234d8e35216b324a1b067c8c/gcc%2Ffortran%2Fsimplify.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ffortran%2Fsimplify.c?ref=9231aa17d6498905234d8e35216b324a1b067c8c", "patch": "@@ -5991,8 +5991,8 @@ gfc_simplify_spacing (gfc_expr *x)\n gfc_expr *\n gfc_simplify_spread (gfc_expr *source, gfc_expr *dim_expr, gfc_expr *ncopies_expr)\n {\n-  gfc_expr *result = 0L;\n-  int i, j, dim, ncopies;\n+  gfc_expr *result = NULL;\n+  int nelem, i, j, dim, ncopies;\n   mpz_t size;\n \n   if ((!gfc_is_constant_expr (source)\n@@ -6019,8 +6019,20 @@ gfc_simplify_spread (gfc_expr *source, gfc_expr *dim_expr, gfc_expr *ncopies_exp\n   else\n     mpz_init_set_ui (size, 1);\n \n-  if (mpz_get_si (size)*ncopies > flag_max_array_constructor)\n-    return NULL;\n+  nelem = mpz_get_si (size) * ncopies;\n+  if (nelem > flag_max_array_constructor)\n+    {\n+      if (gfc_current_ns->sym_root->n.sym->attr.flavor == FL_PARAMETER)\n+\t{\n+\t  gfc_error (\"The number of elements (%d) in the array constructor \"\n+\t\t     \"at %L requires an increase of the allowed %d upper \"\n+\t\t     \"limit.  See %<-fmax-array-constructor%> option.\",\n+\t\t     nelem, &source->where, flag_max_array_constructor);\n+\t  return &gfc_bad_expr;\n+\t}\n+      else\n+\treturn NULL;\n+    }\n \n   if (source->expr_type == EXPR_CONSTANT)\n     {"}, {"sha": "b820e136246ab58e4ad073b01b02535b5979a8d3", "filename": "gcc/testsuite/ChangeLog", "status": "modified", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/9231aa17d6498905234d8e35216b324a1b067c8c/gcc%2Ftestsuite%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/9231aa17d6498905234d8e35216b324a1b067c8c/gcc%2Ftestsuite%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2FChangeLog?ref=9231aa17d6498905234d8e35216b324a1b067c8c", "patch": "@@ -1,3 +1,8 @@\n+2015-11-18  Steven G. Kargl  <kargl@gcc.gnu.org>\n+\n+\tPR fortran/43996\n+\t* gfortran.dg/pr43996.f90: New test.\n+\n 2015-11-18  Joseph Myers  <joseph@codesourcery.com>\n \n \tPR c/65083"}, {"sha": "d0a4daf3cc37b1ba6dbebe49782ee0d3ce3880bc", "filename": "gcc/testsuite/gfortran.dg/pr43996.f90", "status": "added", "additions": 7, "deletions": 0, "changes": 7, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/9231aa17d6498905234d8e35216b324a1b067c8c/gcc%2Ftestsuite%2Fgfortran.dg%2Fpr43996.f90", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/9231aa17d6498905234d8e35216b324a1b067c8c/gcc%2Ftestsuite%2Fgfortran.dg%2Fpr43996.f90", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgfortran.dg%2Fpr43996.f90?ref=9231aa17d6498905234d8e35216b324a1b067c8c", "patch": "@@ -0,0 +1,7 @@\n+! { dg-do compile }\n+! PR fortran/43996\n+!\n+real, parameter :: a(720,360) = spread((/(j, j=1,720) /), dim=2, ncopies=360) ! { dg-error \"number of elements\" }\n+real x\n+x = a(720,360)\n+end"}]}