{"sha": "e0bfe016712ace877dd5b057bc1eb06e3c307623", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6ZTBiZmUwMTY3MTJhY2U4NzdkZDViMDU3YmMxZWIwNmUzYzMwNzYyMw==", "commit": {"author": {"name": "Przemyslaw Wirkus", "email": "Przemyslaw.Wirkus@arm.com", "date": "2020-06-19T15:48:55Z"}, "committer": {"name": "Alex Coplan", "email": "alex.coplan@arm.com", "date": "2020-06-19T15:48:55Z"}, "message": "Fix PR94880: Failure to recognize andn pattern\n\nPattern \"(x | y) - y\" can be optimized to simple \"(x & ~y)\" andn\npattern.\n\nBootstrapped and tested on aarch64-none-linux-gnu.\n\ngcc/ChangeLog:\n\n\tPR tree-optimization/94880\n\t* match.pd (A | B) - B -> (A & ~B): New simplification.\n\ngcc/testsuite/ChangeLog:\n\n\tPR tree-optimization/94880\n\t* gcc.dg/tree-ssa/pr94880.c: New Test.", "tree": {"sha": "8b88b3db0c03f40ec236100ea1feee7fcf8fc060", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/8b88b3db0c03f40ec236100ea1feee7fcf8fc060"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/e0bfe016712ace877dd5b057bc1eb06e3c307623", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/e0bfe016712ace877dd5b057bc1eb06e3c307623", "html_url": "https://github.com/Rust-GCC/gccrs/commit/e0bfe016712ace877dd5b057bc1eb06e3c307623", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/e0bfe016712ace877dd5b057bc1eb06e3c307623/comments", "author": {"login": "PrzemekWirkus", "id": 6360720, "node_id": "MDQ6VXNlcjYzNjA3MjA=", "avatar_url": "https://avatars.githubusercontent.com/u/6360720?v=4", "gravatar_id": "", "url": "https://api.github.com/users/PrzemekWirkus", "html_url": "https://github.com/PrzemekWirkus", "followers_url": "https://api.github.com/users/PrzemekWirkus/followers", "following_url": "https://api.github.com/users/PrzemekWirkus/following{/other_user}", "gists_url": "https://api.github.com/users/PrzemekWirkus/gists{/gist_id}", "starred_url": "https://api.github.com/users/PrzemekWirkus/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/PrzemekWirkus/subscriptions", "organizations_url": "https://api.github.com/users/PrzemekWirkus/orgs", "repos_url": "https://api.github.com/users/PrzemekWirkus/repos", "events_url": "https://api.github.com/users/PrzemekWirkus/events{/privacy}", "received_events_url": "https://api.github.com/users/PrzemekWirkus/received_events", "type": "User", "site_admin": false}, "committer": {"login": "acoplan-arm", "id": 86676934, "node_id": "MDQ6VXNlcjg2Njc2OTM0", "avatar_url": "https://avatars.githubusercontent.com/u/86676934?v=4", "gravatar_id": "", "url": "https://api.github.com/users/acoplan-arm", "html_url": "https://github.com/acoplan-arm", "followers_url": "https://api.github.com/users/acoplan-arm/followers", "following_url": "https://api.github.com/users/acoplan-arm/following{/other_user}", "gists_url": "https://api.github.com/users/acoplan-arm/gists{/gist_id}", "starred_url": "https://api.github.com/users/acoplan-arm/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/acoplan-arm/subscriptions", "organizations_url": "https://api.github.com/users/acoplan-arm/orgs", "repos_url": "https://api.github.com/users/acoplan-arm/repos", "events_url": "https://api.github.com/users/acoplan-arm/events{/privacy}", "received_events_url": "https://api.github.com/users/acoplan-arm/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "6d8b2ee568bd17a398781d86aab140b8121aad30", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/6d8b2ee568bd17a398781d86aab140b8121aad30", "html_url": "https://github.com/Rust-GCC/gccrs/commit/6d8b2ee568bd17a398781d86aab140b8121aad30"}], "stats": {"total": 34, "additions": 34, "deletions": 0}, "files": [{"sha": "43f3d7ab0fa5838c543c795ca283d90d8cecd62a", "filename": "gcc/match.pd", "status": "modified", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/e0bfe016712ace877dd5b057bc1eb06e3c307623/gcc%2Fmatch.pd", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/e0bfe016712ace877dd5b057bc1eb06e3c307623/gcc%2Fmatch.pd", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fmatch.pd?ref=e0bfe016712ace877dd5b057bc1eb06e3c307623", "patch": "@@ -1109,6 +1109,11 @@ DEFINE_INT_AND_FLOAT_ROUND_FN (RINT)\n       && !TYPE_SATURATING (type))\n   (bit_ior @0 @1)))\n \n+/* (x | y) - y -> (x & ~y) */\n+(simplify\n+ (minus (bit_ior:cs @0 @1) @1)\n+ (bit_and @0 (bit_not @1)))\n+\n /* (x | y) - (x ^ y) -> x & y */\n (simplify\n  (minus (bit_ior @0 @1) (bit_xor @0 @1))"}, {"sha": "f72166181479d43762423e7e153ee1832760cad0", "filename": "gcc/testsuite/gcc.dg/tree-ssa/pr94880.c", "status": "added", "additions": 29, "deletions": 0, "changes": 29, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/e0bfe016712ace877dd5b057bc1eb06e3c307623/gcc%2Ftestsuite%2Fgcc.dg%2Ftree-ssa%2Fpr94880.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/e0bfe016712ace877dd5b057bc1eb06e3c307623/gcc%2Ftestsuite%2Fgcc.dg%2Ftree-ssa%2Fpr94880.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgcc.dg%2Ftree-ssa%2Fpr94880.c?ref=e0bfe016712ace877dd5b057bc1eb06e3c307623", "patch": "@@ -0,0 +1,29 @@\n+/* PR tree-optimization/94786 */\n+/* { dg-do compile } */\n+/* { dg-options \"-O2 -fdump-tree-optimized\" } */\n+/* { dg-final { scan-tree-dump-times \"= ~\\[xy\\]_\" 4 \"optimized\" } } */\n+/* { dg-final { scan-tree-dump-times \" & \\[xy\\]_\" 4 \"optimized\" } } */\n+\n+unsigned\n+foo_u(unsigned x, unsigned y)\n+{\n+  return (x | y) - y;\n+}\n+\n+int\n+foo_i(int x, int y)\n+{\n+  return (x | y) - y;\n+}\n+\n+unsigned long long\n+foo_ull(unsigned long long x, unsigned long long y)\n+{\n+  return (x | y) - y;\n+}\n+\n+long long\n+foo_ll(long long x, long long y)\n+{\n+  return (x | y) - y;\n+}"}]}