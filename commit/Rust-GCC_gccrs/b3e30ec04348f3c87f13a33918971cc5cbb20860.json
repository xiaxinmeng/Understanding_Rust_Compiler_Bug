{"sha": "b3e30ec04348f3c87f13a33918971cc5cbb20860", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6YjNlMzBlYzA0MzQ4ZjNjODdmMTNhMzM5MTg5NzFjYzVjYmIyMDg2MA==", "commit": {"author": {"name": "John David Anglin", "email": "dave.anglin@nrc-cnrc.gc.ca", "date": "2004-12-14T22:48:53Z"}, "committer": {"name": "John David Anglin", "email": "danglin@gcc.gnu.org", "date": "2004-12-14T22:48:53Z"}, "message": "pa-host.c (MAP_FAILED): Define if not defined.\n\n\t* pa-host.c (MAP_FAILED): Define if not defined.\n\t(pa_gt_pch_use_address): Handle short reads.\n\nFrom-SVN: r92166", "tree": {"sha": "fd05124d869bb15a8059922c0a71dcd3ee38bfb6", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/fd05124d869bb15a8059922c0a71dcd3ee38bfb6"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/b3e30ec04348f3c87f13a33918971cc5cbb20860", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/b3e30ec04348f3c87f13a33918971cc5cbb20860", "html_url": "https://github.com/Rust-GCC/gccrs/commit/b3e30ec04348f3c87f13a33918971cc5cbb20860", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/b3e30ec04348f3c87f13a33918971cc5cbb20860/comments", "author": null, "committer": null, "parents": [{"sha": "7cacf53e505b9143b7ae0e646dc83a4e5cf9f643", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/7cacf53e505b9143b7ae0e646dc83a4e5cf9f643", "html_url": "https://github.com/Rust-GCC/gccrs/commit/7cacf53e505b9143b7ae0e646dc83a4e5cf9f643"}], "stats": {"total": 21, "additions": 19, "deletions": 2}, "files": [{"sha": "bb38fc880084c86c9a0cfeb075fd9c388fb7c305", "filename": "gcc/ChangeLog", "status": "modified", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/b3e30ec04348f3c87f13a33918971cc5cbb20860/gcc%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/b3e30ec04348f3c87f13a33918971cc5cbb20860/gcc%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2FChangeLog?ref=b3e30ec04348f3c87f13a33918971cc5cbb20860", "patch": "@@ -1,3 +1,8 @@\n+2004-12-14  John David Anglin  <dave.anglin@nrc-cnrc.gc.ca>\n+\n+\t* pa-host.c (MAP_FAILED): Define if not defined.\n+\t(pa_gt_pch_use_address): Handle short reads.\n+\n 2004-12-14  Richard Henderson  <rth@redhat.com>\n \n \tPR target/17990"}, {"sha": "0d86e5822f80dd3fc0b2edc2677317df4d531896", "filename": "gcc/config/pa/pa-host.c", "status": "modified", "additions": 14, "deletions": 2, "changes": 16, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/b3e30ec04348f3c87f13a33918971cc5cbb20860/gcc%2Fconfig%2Fpa%2Fpa-host.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/b3e30ec04348f3c87f13a33918971cc5cbb20860/gcc%2Fconfig%2Fpa%2Fpa-host.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fconfig%2Fpa%2Fpa-host.c?ref=b3e30ec04348f3c87f13a33918971cc5cbb20860", "patch": "@@ -26,6 +26,10 @@\n #include \"hosthooks.h\"\n #include \"hosthooks-def.h\"\n \n+#ifndef MAP_FAILED\n+#define MAP_FAILED (void *)-1L\n+#endif\n+\n static void *pa_gt_pch_get_address (size_t, int);\n static int pa_gt_pch_use_address (void *, size_t, int, size_t);\n \n@@ -114,8 +118,16 @@ pa_gt_pch_use_address (void *base, size_t size, int fd, size_t offset)\n   if (lseek (fd, offset, SEEK_SET) == (off_t)-1)\n     return -1;\n \n-  if (read (fd, base, size) == -1)\n-    return -1;\n+  while (size)\n+    {\n+      ssize_t nbytes;\n+\n+      nbytes = read (fd, base, MIN (size, SSIZE_MAX));\n+      if (nbytes <= 0)\n+        return -1;\n+      base = (char *) base + nbytes;\n+      size -= nbytes;\n+    }\n \n   return 1;\n }"}]}