{"sha": "16e31964115f929a2f68fbce36cff148849b52bd", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6MTZlMzE5NjQxMTVmOTI5YTJmNjhmYmNlMzZjZmYxNDg4NDliNTJiZA==", "commit": {"author": {"name": "Danny Smith", "email": "dannysmith@users.sourceforge.net", "date": "2003-05-21T00:33:27Z"}, "committer": {"name": "Danny Smith", "email": "dannysmith@gcc.gnu.org", "date": "2003-05-21T00:33:27Z"}, "message": "re PR c++/9738 ([mingw] Internal compiler error in rest_of_compilation, at toplev.c: 3491)\n\n\tPR c++/9738\n\n\t* config/i386/winnt.c (i386_pe_encode_section_info): Enable\n\teven if not first.\n\n\t* cp/decl.c (duplicate_decls): Re-invoke make_decl_rtl\n\tif the old decl had instantiated DECL_RTL.\n\t(Base on Richard Henderson 2003-05-13 patch to c-decl.c).\n\n\t* testsuite/g++.dg/ext/dllimport2.C: New file.\n\t* testsuite/g++.dg/ext/dllimport3.C: New file.\n\nFrom-SVN: r67049", "tree": {"sha": "a66c513063ee090ac05335ce24377f1f8af6a567", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/a66c513063ee090ac05335ce24377f1f8af6a567"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/16e31964115f929a2f68fbce36cff148849b52bd", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/16e31964115f929a2f68fbce36cff148849b52bd", "html_url": "https://github.com/Rust-GCC/gccrs/commit/16e31964115f929a2f68fbce36cff148849b52bd", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/16e31964115f929a2f68fbce36cff148849b52bd/comments", "author": null, "committer": null, "parents": [{"sha": "36f72608a3270bef01a188cde1da10e6a98651e3", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/36f72608a3270bef01a188cde1da10e6a98651e3", "html_url": "https://github.com/Rust-GCC/gccrs/commit/36f72608a3270bef01a188cde1da10e6a98651e3"}], "stats": {"total": 74, "additions": 70, "deletions": 4}, "files": [{"sha": "c5c1792e147e32e96fd88a2d85b691f0faf9a75c", "filename": "gcc/ChangeLog", "status": "modified", "additions": 6, "deletions": 0, "changes": 6, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/16e31964115f929a2f68fbce36cff148849b52bd/gcc%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/16e31964115f929a2f68fbce36cff148849b52bd/gcc%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2FChangeLog?ref=16e31964115f929a2f68fbce36cff148849b52bd", "patch": "@@ -1,3 +1,9 @@\n+2003-05-21  Danny Smith  <dannysmith@users.sourceforge.net>\n+\n+\tPR c++/9738\n+\t* config/i386/winnt.c (i386_pe_encode_section_info): Enable\n+\teven if not first.\n+\n 2003-05-20  Kaveh R. Ghazi  <ghazi@caip.rutgers.edu>\n \n \t* genautomata.c (output_description, output_automaton_units,"}, {"sha": "04f5cedb036338f380a7081c4a01c7f19074137f", "filename": "gcc/config/i386/winnt.c", "status": "modified", "additions": 2, "deletions": 4, "changes": 6, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/16e31964115f929a2f68fbce36cff148849b52bd/gcc%2Fconfig%2Fi386%2Fwinnt.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/16e31964115f929a2f68fbce36cff148849b52bd/gcc%2Fconfig%2Fi386%2Fwinnt.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fconfig%2Fi386%2Fwinnt.c?ref=16e31964115f929a2f68fbce36cff148849b52bd", "patch": "@@ -427,9 +427,6 @@ i386_pe_encode_section_info (decl, rtl, first)\n      rtx rtl;\n      int first;\n {\n-  if (!first)\n-    return;\n-\n   default_encode_section_info (decl, rtl, first);\n \n   if (TREE_CODE (decl) == FUNCTION_DECL)\n@@ -445,7 +442,8 @@ i386_pe_encode_section_info (decl, rtl, first)\n     }\n \n   /* Mark the decl so we can tell from the rtl whether the object is\n-     dllexport'd or dllimport'd.  */\n+     dllexport'd or dllimport'd.  This also handles dllexport/dllimport\n+     override semantics.   */\n \n   if (i386_pe_dllexport_p (decl))\n     i386_pe_mark_dllexport (decl);"}, {"sha": "7ea230f968c0a80ce0f4585e7ea5fcb2fcf88767", "filename": "gcc/cp/ChangeLog", "status": "modified", "additions": 7, "deletions": 0, "changes": 7, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/16e31964115f929a2f68fbce36cff148849b52bd/gcc%2Fcp%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/16e31964115f929a2f68fbce36cff148849b52bd/gcc%2Fcp%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fcp%2FChangeLog?ref=16e31964115f929a2f68fbce36cff148849b52bd", "patch": "@@ -1,3 +1,10 @@\n+2003-05-21  Danny Smith  <dannysmith@users.sourceforge.net>\n+\n+\tPR c++/9738\n+\t* decl.c (duplicate_decls): Re-invoke make_decl_rtl\n+\tif the old decl had instantiated DECL_RTL.\n+\t(Base on Richard Henderson 2003-05-13 patch to c-decl.c).\n+\n 2003-05-19  Matt Austern  <austern@apple.com>\n \n \t* lang-options.h: Document -Wno-invalid-offsetof"}, {"sha": "71a582277050636cc46fc3c13f2d1f4693e2b68f", "filename": "gcc/cp/decl.c", "status": "modified", "additions": 9, "deletions": 0, "changes": 9, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/16e31964115f929a2f68fbce36cff148849b52bd/gcc%2Fcp%2Fdecl.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/16e31964115f929a2f68fbce36cff148849b52bd/gcc%2Fcp%2Fdecl.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fcp%2Fdecl.c?ref=16e31964115f929a2f68fbce36cff148849b52bd", "patch": "@@ -3593,6 +3593,15 @@ duplicate_decls (tree newdecl, tree olddecl)\n      Update OLDDECL to be the same.  */\n   DECL_ATTRIBUTES (olddecl) = DECL_ATTRIBUTES (newdecl);\n \n+  /* If OLDDECL had its DECL_RTL instantiated, re-invoke make_decl_rtl\n+    so that encode_section_info has a chance to look at the new decl\n+    flags and attributes.  */\n+  if (DECL_RTL_SET_P (olddecl) \n+      && (TREE_CODE (olddecl) == FUNCTION_DECL\n+\t  || (TREE_CODE (olddecl) == VAR_DECL\n+\t      && TREE_STATIC (olddecl))))\n+    make_decl_rtl (olddecl, NULL);\n+\n   return 1;\n }\n "}, {"sha": "db194e8b321f955561f30d58f8350a5bfe1d285a", "filename": "gcc/testsuite/ChangeLog", "status": "modified", "additions": 6, "deletions": 0, "changes": 6, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/16e31964115f929a2f68fbce36cff148849b52bd/gcc%2Ftestsuite%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/16e31964115f929a2f68fbce36cff148849b52bd/gcc%2Ftestsuite%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2FChangeLog?ref=16e31964115f929a2f68fbce36cff148849b52bd", "patch": "@@ -1,3 +1,9 @@\n+2003-05-21  Danny Smith  <dannysmith@users.sourceforge.net>\n+\n+\tPR c++/9738\n+\t* g++.dg/ext/dllimport2.C: New file.\n+\t* g++.dg/ext/dllimport3.C: New file.\n+\n 2003-05-20  Janis Johnson  <janis187@us.ibm.com>\n \n \t* gcc.dg/compat/struct-by-value-3_x.c: Move common pieces to headers."}, {"sha": "9564be4f74cf7ba572e0b558df5ee24ab678bceb", "filename": "gcc/testsuite/g++.dg/ext/dllimport2.C", "status": "added", "additions": 15, "deletions": 0, "changes": 15, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/16e31964115f929a2f68fbce36cff148849b52bd/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Fext%2Fdllimport2.C", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/16e31964115f929a2f68fbce36cff148849b52bd/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Fext%2Fdllimport2.C", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Fext%2Fdllimport2.C?ref=16e31964115f929a2f68fbce36cff148849b52bd", "patch": "@@ -0,0 +1,15 @@\n+// { dg-do compile { target i?86-*-cygwin* i?86-*-mingw*} }\n+\n+// PR 9738  Dllimport attribute is overriden by later definition\n+\n+void __attribute__((dllimport)) Bar(void);\n+ \n+ void Foo(void)\n+ {\n+     Bar();\n+ }\n+ \n+ void Bar(void)\n+ {\n+ }\n+ "}, {"sha": "d5e7955dbff81b2f1b1802f61ba52b91f6d78cfe", "filename": "gcc/testsuite/g++.dg/ext/dllimport3.C", "status": "added", "additions": 25, "deletions": 0, "changes": 25, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/16e31964115f929a2f68fbce36cff148849b52bd/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Fext%2Fdllimport3.C", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/16e31964115f929a2f68fbce36cff148849b52bd/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Fext%2Fdllimport3.C", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Fext%2Fdllimport3.C?ref=16e31964115f929a2f68fbce36cff148849b52bd", "patch": "@@ -0,0 +1,25 @@\n+// { dg-do compile { target i?86-*-cygwin* i?86-*-mingw*} }\n+\n+// PR 10148  Dllimport attribute of object is overriden by later\n+// redefinition without attribute.\n+ \n+struct Foo\n+ {\n+     int a;\n+ };\n+\n+ __attribute__((dllimport)) struct Foo f;\n+\n+ void Bar(void)\n+ {\n+     void* dummy = &f;\n+ }\n+\n+ struct Foo f;\n+\n+// Dllimport sets DECL_NON_ADDR_CONST_P to 1, so following\n+// assignment would require static_initialization_and_destruction\n+// if attribute is retained. \n+\n+ void* dummy = &f;\n+ "}]}