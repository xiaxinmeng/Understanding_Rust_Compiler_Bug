{"sha": "88e18fedad6803c5f9abdbcf1c4a51c25e12706c", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6ODhlMThmZWRhZDY4MDNjNWY5YWJkYmNmMWM0YTUxYzI1ZTEyNzA2Yw==", "commit": {"author": {"name": "Jakub Jelinek", "email": "jakub@redhat.com", "date": "2009-07-23T18:09:43Z"}, "committer": {"name": "Jakub Jelinek", "email": "jakub@gcc.gnu.org", "date": "2009-07-23T18:09:43Z"}, "message": "re PR fortran/40839 (gfortran segmentation fault when a unit number is missing)\n\n\tPR fortran/40839\n\t* io.c (gfc_resolve_dt): Add LOC argument.  Fail if\n\tdt->io_unit is NULL.  Return FAILURE after issuing error about\n\tnegative UNIT number.\n\t(match_io_element): Don't segfault if current_dt->io_unit is NULL.\n\t* gfortran.h (gfc_resolve_dt): Adjust prototype.\n\t* resolve.c (resolve_code): Adjust caller.\n\n\t* gfortran.dg/pr40839.f90: New test.\n\nFrom-SVN: r150021", "tree": {"sha": "e2355295ba4f503f046c98f919798986a5d39dbd", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/e2355295ba4f503f046c98f919798986a5d39dbd"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/88e18fedad6803c5f9abdbcf1c4a51c25e12706c", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/88e18fedad6803c5f9abdbcf1c4a51c25e12706c", "html_url": "https://github.com/Rust-GCC/gccrs/commit/88e18fedad6803c5f9abdbcf1c4a51c25e12706c", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/88e18fedad6803c5f9abdbcf1c4a51c25e12706c/comments", "author": {"login": "jakubjelinek", "id": 9370665, "node_id": "MDQ6VXNlcjkzNzA2NjU=", "avatar_url": "https://avatars.githubusercontent.com/u/9370665?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jakubjelinek", "html_url": "https://github.com/jakubjelinek", "followers_url": "https://api.github.com/users/jakubjelinek/followers", "following_url": "https://api.github.com/users/jakubjelinek/following{/other_user}", "gists_url": "https://api.github.com/users/jakubjelinek/gists{/gist_id}", "starred_url": "https://api.github.com/users/jakubjelinek/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jakubjelinek/subscriptions", "organizations_url": "https://api.github.com/users/jakubjelinek/orgs", "repos_url": "https://api.github.com/users/jakubjelinek/repos", "events_url": "https://api.github.com/users/jakubjelinek/events{/privacy}", "received_events_url": "https://api.github.com/users/jakubjelinek/received_events", "type": "User", "site_admin": false}, "committer": null, "parents": [{"sha": "93d7c9943f56fa9b69647433a5ca89a70a19a601", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/93d7c9943f56fa9b69647433a5ca89a70a19a601", "html_url": "https://github.com/Rust-GCC/gccrs/commit/93d7c9943f56fa9b69647433a5ca89a70a19a601"}], "stats": {"total": 37, "additions": 33, "deletions": 4}, "files": [{"sha": "c2d8c9d79d4549b0c054361fcb92dc4437a091b1", "filename": "gcc/fortran/ChangeLog", "status": "modified", "additions": 10, "deletions": 0, "changes": 10, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/88e18fedad6803c5f9abdbcf1c4a51c25e12706c/gcc%2Ffortran%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/88e18fedad6803c5f9abdbcf1c4a51c25e12706c/gcc%2Ffortran%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ffortran%2FChangeLog?ref=88e18fedad6803c5f9abdbcf1c4a51c25e12706c", "patch": "@@ -1,3 +1,13 @@\n+2009-07-23  Jakub Jelinek  <jakub@redhat.com>\n+\n+\tPR fortran/40839\n+\t* io.c (gfc_resolve_dt): Add LOC argument.  Fail if\n+\tdt->io_unit is NULL.  Return FAILURE after issuing error about\n+\tnegative UNIT number.\n+\t(match_io_element): Don't segfault if current_dt->io_unit is NULL.\n+\t* gfortran.h (gfc_resolve_dt): Adjust prototype.\n+\t* resolve.c (resolve_code): Adjust caller.\n+\n 2009-07-22  Paul Thomas  <pault@gcc.gnu.org>\n \n \tPR fortran/40796"}, {"sha": "83c36c5ad85f778d99dd2196efa0b31ab6b575ef", "filename": "gcc/fortran/gfortran.h", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/88e18fedad6803c5f9abdbcf1c4a51c25e12706c/gcc%2Ffortran%2Fgfortran.h", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/88e18fedad6803c5f9abdbcf1c4a51c25e12706c/gcc%2Ffortran%2Fgfortran.h", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ffortran%2Fgfortran.h?ref=88e18fedad6803c5f9abdbcf1c4a51c25e12706c", "patch": "@@ -2637,7 +2637,7 @@ gfc_try gfc_resolve_filepos (gfc_filepos *);\n void gfc_free_inquire (gfc_inquire *);\n gfc_try gfc_resolve_inquire (gfc_inquire *);\n void gfc_free_dt (gfc_dt *);\n-gfc_try gfc_resolve_dt (gfc_dt *);\n+gfc_try gfc_resolve_dt (gfc_dt *, locus *);\n void gfc_free_wait (gfc_wait *);\n gfc_try gfc_resolve_wait (gfc_wait *);\n "}, {"sha": "76cf6199abe48929971330430fef2f07209f36ce", "filename": "gcc/fortran/io.c", "status": "modified", "additions": 11, "deletions": 2, "changes": 13, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/88e18fedad6803c5f9abdbcf1c4a51c25e12706c/gcc%2Ffortran%2Fio.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/88e18fedad6803c5f9abdbcf1c4a51c25e12706c/gcc%2Ffortran%2Fio.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ffortran%2Fio.c?ref=88e18fedad6803c5f9abdbcf1c4a51c25e12706c", "patch": "@@ -2555,7 +2555,7 @@ gfc_free_dt (gfc_dt *dt)\n /* Resolve everything in a gfc_dt structure.  */\n \n gfc_try\n-gfc_resolve_dt (gfc_dt *dt)\n+gfc_resolve_dt (gfc_dt *dt, locus *loc)\n {\n   gfc_expr *e;\n \n@@ -2576,6 +2576,12 @@ gfc_resolve_dt (gfc_dt *dt)\n   RESOLVE_TAG (&tag_e_async, dt->asynchronous);\n \n   e = dt->io_unit;\n+  if (e == NULL)\n+    {\n+      gfc_error (\"UNIT not specified at %L\", loc);\n+      return FAILURE;\n+    }\n+\n   if (gfc_resolve_expr (e) == SUCCESS\n       && (e->ts.type != BT_INTEGER\n \t  && (e->ts.type != BT_CHARACTER || e->expr_type != EXPR_VARIABLE)))\n@@ -2635,6 +2641,7 @@ gfc_resolve_dt (gfc_dt *dt)\n       && mpz_sgn (e->value.integer) < 0)\n     {\n       gfc_error (\"UNIT number in statement at %L must be non-negative\", &e->where);\n+      return FAILURE;\n     }\n \n   if (dt->extra_comma\n@@ -2857,6 +2864,7 @@ match_io_element (io_kind k, gfc_code **cpp)\n \n \tif (gfc_pure (NULL)\n \t    && gfc_impure_variable (expr->symtree->n.sym)\n+\t    && current_dt->io_unit\n \t    && current_dt->io_unit->ts.type == BT_CHARACTER)\n \t  {\n \t    gfc_error (\"Cannot read to variable '%s' in PURE procedure at %C\",\n@@ -2870,7 +2878,8 @@ match_io_element (io_kind k, gfc_code **cpp)\n \tbreak;\n \n       case M_WRITE:\n-\tif (current_dt->io_unit->ts.type == BT_CHARACTER\n+\tif (current_dt->io_unit\n+\t    && current_dt->io_unit->ts.type == BT_CHARACTER\n \t    && gfc_pure (NULL)\n \t    && current_dt->io_unit->expr_type == EXPR_VARIABLE\n \t    && gfc_impure_variable (current_dt->io_unit->symtree->n.sym))"}, {"sha": "376803d69d994fb4726834e2c7cd90b42d6d2548", "filename": "gcc/fortran/resolve.c", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/88e18fedad6803c5f9abdbcf1c4a51c25e12706c/gcc%2Ffortran%2Fresolve.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/88e18fedad6803c5f9abdbcf1c4a51c25e12706c/gcc%2Ffortran%2Fresolve.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ffortran%2Fresolve.c?ref=88e18fedad6803c5f9abdbcf1c4a51c25e12706c", "patch": "@@ -7119,7 +7119,7 @@ resolve_code (gfc_code *code, gfc_namespace *ns)\n \n \tcase EXEC_READ:\n \tcase EXEC_WRITE:\n-\t  if (gfc_resolve_dt (code->ext.dt) == FAILURE)\n+\t  if (gfc_resolve_dt (code->ext.dt, &code->loc) == FAILURE)\n \t    break;\n \n \t  resolve_branch (code->ext.dt->err, code);"}, {"sha": "e9094b577331c3d3bff5ade1f201bce229a39995", "filename": "gcc/testsuite/ChangeLog", "status": "modified", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/88e18fedad6803c5f9abdbcf1c4a51c25e12706c/gcc%2Ftestsuite%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/88e18fedad6803c5f9abdbcf1c4a51c25e12706c/gcc%2Ftestsuite%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2FChangeLog?ref=88e18fedad6803c5f9abdbcf1c4a51c25e12706c", "patch": "@@ -1,3 +1,8 @@\n+2009-07-23  Jakub Jelinek  <jakub@redhat.com>\n+\n+\tPR fortran/40839\n+\t* gfortran.dg/pr40839.f90: New test.\n+\n 2009-07-23  Michael Matz  <matz@suse.de>\n \n \tPR middle-end/40830"}, {"sha": "92285295c21cf7b004a0d204f6fa3b0eb2deb9dd", "filename": "gcc/testsuite/gfortran.dg/pr40839.f90", "status": "added", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/88e18fedad6803c5f9abdbcf1c4a51c25e12706c/gcc%2Ftestsuite%2Fgfortran.dg%2Fpr40839.f90", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/88e18fedad6803c5f9abdbcf1c4a51c25e12706c/gcc%2Ftestsuite%2Fgfortran.dg%2Fpr40839.f90", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgfortran.dg%2Fpr40839.f90?ref=88e18fedad6803c5f9abdbcf1c4a51c25e12706c", "patch": "@@ -0,0 +1,5 @@\n+! PR fortran/40839\n+! { dg-do compile }\n+write(fmt='(a)'), 'abc'         ! { dg-error \"UNIT not specified\" }\n+write(fmt='()')                 ! { dg-error \"UNIT not specified\" }\n+end"}]}