{"sha": "e300e74f17fecbb6c2e81857e76ad73b90c4e0eb", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6ZTMwMGU3NGYxN2ZlY2JiNmMyZTgxODU3ZTc2YWQ3M2I5MGM0ZTBlYg==", "commit": {"author": {"name": "Kim Ho", "email": "kho@redhat.com", "date": "2004-01-27T19:29:57Z"}, "committer": {"name": "Kim Ho", "email": "kho@gcc.gnu.org", "date": "2004-01-27T19:29:57Z"}, "message": "2004-01-27  Kim Ho  <kho@redhat.com>\n\n        * gnu/java/awt/peer/gtk/GtkFramePeer.java\n        (removeMenuBarPeer): Remove MenuBarPeer argument.\n        * gnu/java/awt/peer/gtk/GtkMenuComponentPeer.java\n        (dispose): Call native method.\n        * java/awt/Frame.java (setMenuBar): Create and remove\n        MenuBar peers only if the Frame has a peer.\n        (addNotify): Create the MenuBar peer if one exists.\n        (removeNotify): Remove MenuBar peer if one exists.\n        * java/awt/Menu.java: Fix imports.\n        (addNotify): Don't use full class name.\n        (removeNotify): Call removeNotify on all children.\n        * java/awt/MenuBar.java (removeNotify): Call\n        removeNotify on all children.\n        * jni/gtk-peer/gnu_java_awt_peer_gtk_GtkWindowPeer.c\n        (removeMenuBarPeer): Remove MenuBarPeer argument.\n        Iterate through children to find the Frame's MenuBar.\n        * jni/gtk-peer/gnu_java_awt_peer_gtk_GtkMenuComponentPeer.c\n        New file.\n        (dispose): Remove references to the MenuComponent.\n\nFrom-SVN: r76740", "tree": {"sha": "a3afb43550d8b4af2eb0c9d58281277ebf3e398d", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/a3afb43550d8b4af2eb0c9d58281277ebf3e398d"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/e300e74f17fecbb6c2e81857e76ad73b90c4e0eb", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/e300e74f17fecbb6c2e81857e76ad73b90c4e0eb", "html_url": "https://github.com/Rust-GCC/gccrs/commit/e300e74f17fecbb6c2e81857e76ad73b90c4e0eb", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/e300e74f17fecbb6c2e81857e76ad73b90c4e0eb/comments", "author": {"login": "biscuitsandscones", "id": 133805869, "node_id": "U_kgDOB_m3LQ", "avatar_url": "https://avatars.githubusercontent.com/u/133805869?v=4", "gravatar_id": "", "url": "https://api.github.com/users/biscuitsandscones", "html_url": "https://github.com/biscuitsandscones", "followers_url": "https://api.github.com/users/biscuitsandscones/followers", "following_url": "https://api.github.com/users/biscuitsandscones/following{/other_user}", "gists_url": "https://api.github.com/users/biscuitsandscones/gists{/gist_id}", "starred_url": "https://api.github.com/users/biscuitsandscones/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/biscuitsandscones/subscriptions", "organizations_url": "https://api.github.com/users/biscuitsandscones/orgs", "repos_url": "https://api.github.com/users/biscuitsandscones/repos", "events_url": "https://api.github.com/users/biscuitsandscones/events{/privacy}", "received_events_url": "https://api.github.com/users/biscuitsandscones/received_events", "type": "User", "site_admin": false}, "committer": null, "parents": [{"sha": "69a45040007b26fada08e77f7b6716ced9fbe2ab", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/69a45040007b26fada08e77f7b6716ced9fbe2ab", "html_url": "https://github.com/Rust-GCC/gccrs/commit/69a45040007b26fada08e77f7b6716ced9fbe2ab"}], "stats": {"total": 152, "additions": 139, "deletions": 13}, "files": [{"sha": "7d16e2266a5ec2d52fb4d9b63b6c91394bc56e13", "filename": "libjava/ChangeLog", "status": "modified", "additions": 22, "deletions": 0, "changes": 22, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/e300e74f17fecbb6c2e81857e76ad73b90c4e0eb/libjava%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/e300e74f17fecbb6c2e81857e76ad73b90c4e0eb/libjava%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libjava%2FChangeLog?ref=e300e74f17fecbb6c2e81857e76ad73b90c4e0eb", "patch": "@@ -1,3 +1,25 @@\n+2004-01-27  Kim Ho  <kho@redhat.com>\n+\n+\t* gnu/java/awt/peer/gtk/GtkFramePeer.java\n+\t(removeMenuBarPeer): Remove MenuBarPeer argument.\n+\t* gnu/java/awt/peer/gtk/GtkMenuComponentPeer.java\n+\t(dispose): Call native method.\n+\t* java/awt/Frame.java (setMenuBar): Create and remove\n+\tMenuBar peers only if the Frame has a peer.\n+\t(addNotify): Create the MenuBar peer if one exists.\n+\t(removeNotify): Remove MenuBar peer if one exists.\n+\t* java/awt/Menu.java: Fix imports.\n+\t(addNotify): Don't use full class name.\n+\t(removeNotify): Call removeNotify on all children.\n+\t* java/awt/MenuBar.java (removeNotify): Call\n+\tremoveNotify on all children.\n+\t* jni/gtk-peer/gnu_java_awt_peer_gtk_GtkWindowPeer.c\n+\t(removeMenuBarPeer): Remove MenuBarPeer argument.\n+\tIterate through children to find the Frame's MenuBar.\n+\t* jni/gtk-peer/gnu_java_awt_peer_gtk_GtkMenuComponentPeer.c\n+\tNew file.\n+\t(dispose): Remove references to the MenuComponent.\n+\n 2004-01-27  Michael Koch  <konqueror@gmx.de>\n \n \t* javax/swing/AbstractCellEditor.java: Reformated."}, {"sha": "365fe9ec84f2caa3dbcd5661497aa77d09ac0673", "filename": "libjava/Makefile.am", "status": "modified", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/e300e74f17fecbb6c2e81857e76ad73b90c4e0eb/libjava%2FMakefile.am", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/e300e74f17fecbb6c2e81857e76ad73b90c4e0eb/libjava%2FMakefile.am", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libjava%2FMakefile.am?ref=e300e74f17fecbb6c2e81857e76ad73b90c4e0eb", "patch": "@@ -200,6 +200,7 @@ jni/gtk-peer/gnu_java_awt_peer_gtk_GtkLabelPeer.c \\\n jni/gtk-peer/gnu_java_awt_peer_gtk_GtkListPeer.c \\\n jni/gtk-peer/gnu_java_awt_peer_gtk_GtkMainThread.c \\\n jni/gtk-peer/gnu_java_awt_peer_gtk_GtkMenuBarPeer.c \\\n+jni/gtk-peer/gnu_java_awt_peer_gtk_GtkMenuComponentPeer.c \\\n jni/gtk-peer/gnu_java_awt_peer_gtk_GtkMenuItemPeer.c \\\n jni/gtk-peer/gnu_java_awt_peer_gtk_GtkMenuPeer.c \\\n jni/gtk-peer/gnu_java_awt_peer_gtk_GtkPanelPeer.c \\"}, {"sha": "ff53a32c2e9b4dc03647a7b5ca7be635d7761abb", "filename": "libjava/Makefile.in", "status": "modified", "additions": 4, "deletions": 0, "changes": 4, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/e300e74f17fecbb6c2e81857e76ad73b90c4e0eb/libjava%2FMakefile.in", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/e300e74f17fecbb6c2e81857e76ad73b90c4e0eb/libjava%2FMakefile.in", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libjava%2FMakefile.in?ref=e300e74f17fecbb6c2e81857e76ad73b90c4e0eb", "patch": "@@ -292,6 +292,7 @@ jni/gtk-peer/gnu_java_awt_peer_gtk_GtkLabelPeer.c \\\n jni/gtk-peer/gnu_java_awt_peer_gtk_GtkListPeer.c \\\n jni/gtk-peer/gnu_java_awt_peer_gtk_GtkMainThread.c \\\n jni/gtk-peer/gnu_java_awt_peer_gtk_GtkMenuBarPeer.c \\\n+jni/gtk-peer/gnu_java_awt_peer_gtk_GtkMenuComponentPeer.c \\\n jni/gtk-peer/gnu_java_awt_peer_gtk_GtkMenuItemPeer.c \\\n jni/gtk-peer/gnu_java_awt_peer_gtk_GtkMenuPeer.c \\\n jni/gtk-peer/gnu_java_awt_peer_gtk_GtkPanelPeer.c \\\n@@ -2794,6 +2795,7 @@ lib_gnu_java_awt_peer_gtk_la_DEPENDENCIES =\n @GTK_CAIRO_FALSE@jni/gtk-peer/gnu_java_awt_peer_gtk_GtkListPeer.lo \\\n @GTK_CAIRO_FALSE@jni/gtk-peer/gnu_java_awt_peer_gtk_GtkMainThread.lo \\\n @GTK_CAIRO_FALSE@jni/gtk-peer/gnu_java_awt_peer_gtk_GtkMenuBarPeer.lo \\\n+@GTK_CAIRO_FALSE@jni/gtk-peer/gnu_java_awt_peer_gtk_GtkMenuComponentPeer.lo \\\n @GTK_CAIRO_FALSE@jni/gtk-peer/gnu_java_awt_peer_gtk_GtkMenuItemPeer.lo \\\n @GTK_CAIRO_FALSE@jni/gtk-peer/gnu_java_awt_peer_gtk_GtkMenuPeer.lo \\\n @GTK_CAIRO_FALSE@jni/gtk-peer/gnu_java_awt_peer_gtk_GtkPanelPeer.lo \\\n@@ -2874,6 +2876,7 @@ lib_gnu_java_awt_peer_gtk_la_DEPENDENCIES =\n @GTK_CAIRO_TRUE@jni/gtk-peer/gnu_java_awt_peer_gtk_GtkListPeer.lo \\\n @GTK_CAIRO_TRUE@jni/gtk-peer/gnu_java_awt_peer_gtk_GtkMainThread.lo \\\n @GTK_CAIRO_TRUE@jni/gtk-peer/gnu_java_awt_peer_gtk_GtkMenuBarPeer.lo \\\n+@GTK_CAIRO_TRUE@jni/gtk-peer/gnu_java_awt_peer_gtk_GtkMenuComponentPeer.lo \\\n @GTK_CAIRO_TRUE@jni/gtk-peer/gnu_java_awt_peer_gtk_GtkMenuItemPeer.lo \\\n @GTK_CAIRO_TRUE@jni/gtk-peer/gnu_java_awt_peer_gtk_GtkMenuPeer.lo \\\n @GTK_CAIRO_TRUE@jni/gtk-peer/gnu_java_awt_peer_gtk_GtkPanelPeer.lo \\\n@@ -4581,6 +4584,7 @@ DEP_FILES =  .deps/$(srcdir)/$(CONVERT_DIR)/gen-from-JIS.P \\\n .deps/jni/gtk-peer/gnu_java_awt_peer_gtk_GtkListPeer.P \\\n .deps/jni/gtk-peer/gnu_java_awt_peer_gtk_GtkMainThread.P \\\n .deps/jni/gtk-peer/gnu_java_awt_peer_gtk_GtkMenuBarPeer.P \\\n+.deps/jni/gtk-peer/gnu_java_awt_peer_gtk_GtkMenuComponentPeer.P \\\n .deps/jni/gtk-peer/gnu_java_awt_peer_gtk_GtkMenuItemPeer.P \\\n .deps/jni/gtk-peer/gnu_java_awt_peer_gtk_GtkMenuPeer.P \\\n .deps/jni/gtk-peer/gnu_java_awt_peer_gtk_GtkPanelPeer.P \\"}, {"sha": "8fd96b45a5707fe54abb4c165e7f635cd4254969", "filename": "libjava/gnu/java/awt/peer/gtk/GtkFramePeer.java", "status": "modified", "additions": 3, "deletions": 3, "changes": 6, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/e300e74f17fecbb6c2e81857e76ad73b90c4e0eb/libjava%2Fgnu%2Fjava%2Fawt%2Fpeer%2Fgtk%2FGtkFramePeer.java", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/e300e74f17fecbb6c2e81857e76ad73b90c4e0eb/libjava%2Fgnu%2Fjava%2Fawt%2Fpeer%2Fgtk%2FGtkFramePeer.java", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libjava%2Fgnu%2Fjava%2Fawt%2Fpeer%2Fgtk%2FGtkFramePeer.java?ref=e300e74f17fecbb6c2e81857e76ad73b90c4e0eb", "patch": "@@ -58,7 +58,7 @@ public class GtkFramePeer extends GtkWindowPeer\n   native int getMenuBarHeight (MenuBarPeer bar);\n \n   native void setMenuBarPeer (MenuBarPeer bar);\n-  native void removeMenuBarPeer (MenuBarPeer bar);\n+  native void removeMenuBarPeer ();\n   native void moveLayout (int offset);\n \n   public void setMenuBar (MenuBar bar)\n@@ -67,7 +67,7 @@ public void setMenuBar (MenuBar bar)\n     {    \n       if (menuBar != null)\n       {\n-        removeMenuBarPeer(menuBar); \n+        removeMenuBarPeer(); \n         menuBar = null;\n         moveLayout(menuBarHeight);\n         insets.top -= menuBarHeight;\n@@ -80,7 +80,7 @@ public void setMenuBar (MenuBar bar)\n       int oldHeight = 0;\n       if (menuBar != null)\n       {\n-        removeMenuBarPeer(menuBar);\n+        removeMenuBarPeer();\n         oldHeight = menuBarHeight;\n         insets.top -= menuBarHeight;\n       }"}, {"sha": "92f02230621a755ae5bf752bd8d6c6a54fb149dd", "filename": "libjava/gnu/java/awt/peer/gtk/GtkMenuComponentPeer.java", "status": "modified", "additions": 2, "deletions": 4, "changes": 6, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/e300e74f17fecbb6c2e81857e76ad73b90c4e0eb/libjava%2Fgnu%2Fjava%2Fawt%2Fpeer%2Fgtk%2FGtkMenuComponentPeer.java", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/e300e74f17fecbb6c2e81857e76ad73b90c4e0eb/libjava%2Fgnu%2Fjava%2Fawt%2Fpeer%2Fgtk%2FGtkMenuComponentPeer.java", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libjava%2Fgnu%2Fjava%2Fawt%2Fpeer%2Fgtk%2FGtkMenuComponentPeer.java?ref=e300e74f17fecbb6c2e81857e76ad73b90c4e0eb", "patch": "@@ -47,8 +47,6 @@ public GtkMenuComponentPeer (Object awtWidget)\n   {\n     super (awtWidget);\n   }\n-\n-  public void dispose ()\n-  {\n-  }\n+  \n+  public native void dispose();\n }"}, {"sha": "c92585a6f6b9421386df0165f096c3bca750cc39", "filename": "libjava/java/awt/Frame.java", "status": "modified", "additions": 16, "deletions": 3, "changes": 19, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/e300e74f17fecbb6c2e81857e76ad73b90c4e0eb/libjava%2Fjava%2Fawt%2FFrame.java", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/e300e74f17fecbb6c2e81857e76ad73b90c4e0eb/libjava%2Fjava%2Fawt%2FFrame.java", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libjava%2Fjava%2Fawt%2FFrame.java?ref=e300e74f17fecbb6c2e81857e76ad73b90c4e0eb", "patch": "@@ -341,11 +341,15 @@ public class Frame extends Window implements MenuContainer\n public synchronized void\n setMenuBar(MenuBar menuBar)\n {\n-  this.menuBar = menuBar;\n-  if (menuBar != null)\n-    menuBar.addNotify(); \n   if (peer != null)\n+  {\n+    if (this.menuBar != null)\n+      this.menuBar.removeNotify();  \n+    if (menuBar != null)\n+      menuBar.addNotify();\n     ((FramePeer) peer).setMenuBar(menuBar);\n+  }\n+  this.menuBar = menuBar;\n }\n \n /*************************************************************************/\n@@ -432,11 +436,20 @@ public class Frame extends Window implements MenuContainer\n public void\n addNotify()\n {\n+  if (menuBar != null)\n+    menuBar.addNotify();\n   if (peer == null)\n     peer = getToolkit ().createFrame (this);\n   super.addNotify();\n }\n \n+public void removeNotify()\n+{\n+  if (menuBar != null)\n+    menuBar.removeNotify();\n+  super.removeNotify();\n+}\n+\n /*************************************************************************/\n \n /**"}, {"sha": "7fb2931184e65e8f2b816a386c9aa2048caed8ff", "filename": "libjava/java/awt/Menu.java", "status": "modified", "additions": 8, "deletions": 1, "changes": 9, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/e300e74f17fecbb6c2e81857e76ad73b90c4e0eb/libjava%2Fjava%2Fawt%2FMenu.java", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/e300e74f17fecbb6c2e81857e76ad73b90c4e0eb/libjava%2Fjava%2Fawt%2FMenu.java", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libjava%2Fjava%2Fawt%2FMenu.java?ref=e300e74f17fecbb6c2e81857e76ad73b90c4e0eb", "patch": "@@ -41,6 +41,7 @@\n import java.awt.peer.MenuPeer;\n import java.io.Serializable;\n import java.util.Vector;\n+import java.util.Enumeration;\n \n /**\n   * This class represents a pull down or tear off menu in Java's AWT.\n@@ -379,7 +380,7 @@ public int countItems ()\n {\n   if (peer == null)\n     peer = getToolkit().createMenu(this);\n-  java.util.Enumeration e = items.elements();\n+  Enumeration e = items.elements();\n   while (e.hasMoreElements())\n   {\n     MenuItem mi = (MenuItem)e.nextElement();\n@@ -396,6 +397,12 @@ public int countItems ()\n public void\n removeNotify()\n {\n+  Enumeration e = items.elements();\n+  while (e.hasMoreElements())\n+  {\n+    MenuItem mi = (MenuItem) e.nextElement();\n+    mi.removeNotify();\n+  }\n   super.removeNotify();\n }\n "}, {"sha": "9c278dfde0d4db80ac51e0b353bc3d5d0b4a5727", "filename": "libjava/java/awt/MenuBar.java", "status": "modified", "additions": 6, "deletions": 0, "changes": 6, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/e300e74f17fecbb6c2e81857e76ad73b90c4e0eb/libjava%2Fjava%2Fawt%2FMenuBar.java", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/e300e74f17fecbb6c2e81857e76ad73b90c4e0eb/libjava%2Fjava%2Fawt%2FMenuBar.java", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libjava%2Fjava%2Fawt%2FMenuBar.java?ref=e300e74f17fecbb6c2e81857e76ad73b90c4e0eb", "patch": "@@ -279,6 +279,12 @@ public class MenuBar extends MenuComponent\n public void\n removeNotify()\n {\n+  Enumeration e = menus.elements();\n+  while (e.hasMoreElements())\n+  {\n+    Menu mi = (Menu) e.nextElement();\n+    mi.removeNotify();\n+  }\n   super.removeNotify();\n }\n "}, {"sha": "c30ac29c9c00b9fa74a946153dd40449fa4b98cd", "filename": "libjava/jni/gtk-peer/gnu_java_awt_peer_gtk_GtkMenuComponentPeer.c", "status": "added", "additions": 56, "deletions": 0, "changes": 56, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/e300e74f17fecbb6c2e81857e76ad73b90c4e0eb/libjava%2Fjni%2Fgtk-peer%2Fgnu_java_awt_peer_gtk_GtkMenuComponentPeer.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/e300e74f17fecbb6c2e81857e76ad73b90c4e0eb/libjava%2Fjni%2Fgtk-peer%2Fgnu_java_awt_peer_gtk_GtkMenuComponentPeer.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libjava%2Fjni%2Fgtk-peer%2Fgnu_java_awt_peer_gtk_GtkMenuComponentPeer.c?ref=e300e74f17fecbb6c2e81857e76ad73b90c4e0eb", "patch": "@@ -0,0 +1,56 @@\n+/* gtkmenucomponentpeer.c -- Native implementation of GtkMenuComponentPeer\n+   Copyright (C) 2004 Free Software Foundation, Inc.\n+\n+This file is part of GNU Classpath.\n+\n+GNU Classpath is free software; you can redistribute it and/or modify\n+it under the terms of the GNU General Public License as published by\n+the Free Software Foundation; either version 2, or (at your option)\n+any later version.\n+\n+GNU Classpath is distributed in the hope that it will be useful, but\n+WITHOUT ANY WARRANTY; without even the implied warranty of\n+MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU\n+General Public License for more details.\n+\n+You should have received a copy of the GNU General Public License\n+along with GNU Classpath; see the file COPYING.  If not, write to the\n+Free Software Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA\n+02111-1307 USA.\n+\n+Linking this library statically or dynamically with other modules is\n+making a combined work based on this library.  Thus, the terms and\n+conditions of the GNU General Public License cover the whole\n+combination.\n+\n+As a special exception, the copyright holders of this library give you\n+permission to link this library with independent modules to produce an\n+executable, regardless of the license terms of these independent\n+modules, and to copy and distribute the resulting executable under\n+terms of your choice, provided that you also meet, for each linked\n+independent module, the terms and conditions of the license of that\n+module.  An independent module is a module which is not derived from\n+or based on this library.  If you modify this library, you may extend\n+this exception to your version of the library, but you are not\n+obligated to do so.  If you do not wish to do so, delete this\n+exception statement from your version. */\n+\n+\n+#include \"gtkpeer.h\"\n+#include \"gnu_java_awt_peer_gtk_GtkMenuComponentPeer.h\"\n+\n+JNIEXPORT void JNICALL Java_gnu_java_awt_peer_gtk_GtkMenuComponentPeer_dispose\n+  (JNIEnv *env, jobject obj)\n+{\n+  /* For MenuComponents and its subclasses, the widgets are\n+     automatically destroyed by Gtk when the parent MenuBar\n+     is removed from the Frame. So we avoid the widget\n+     destruction in GtkGenericPeer dispose() by overriding\n+     it here. */\n+     \n+  /* However, references to the Java objects still exist in the\n+     state tables, so we still have to remove those. */\n+     \n+  NSA_DEL_GLOBAL_REF (env, obj);\n+  NSA_DEL_PTR (env, obj);  \n+}"}, {"sha": "fb82aed82f560df72a4c37827780f0325ca24b01", "filename": "libjava/jni/gtk-peer/gnu_java_awt_peer_gtk_GtkWindowPeer.c", "status": "modified", "additions": 21, "deletions": 2, "changes": 23, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/e300e74f17fecbb6c2e81857e76ad73b90c4e0eb/libjava%2Fjni%2Fgtk-peer%2Fgnu_java_awt_peer_gtk_GtkWindowPeer.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/e300e74f17fecbb6c2e81857e76ad73b90c4e0eb/libjava%2Fjni%2Fgtk-peer%2Fgnu_java_awt_peer_gtk_GtkWindowPeer.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libjava%2Fjni%2Fgtk-peer%2Fgnu_java_awt_peer_gtk_GtkWindowPeer.c?ref=e300e74f17fecbb6c2e81857e76ad73b90c4e0eb", "patch": "@@ -376,18 +376,37 @@ Java_gnu_java_awt_peer_gtk_GtkWindowPeer_nativeSetBounds\n \n JNIEXPORT void JNICALL\n Java_gnu_java_awt_peer_gtk_GtkFramePeer_removeMenuBarPeer\n-  (JNIEnv *env, jobject obj, jobject menubar)\n+  (JNIEnv *env, jobject obj)\n {\n   void *wptr;\n   GtkWidget *box;\n   GtkWidget *mptr;\n+  GList* children;\n \n   wptr = NSA_GET_PTR (env, obj);\n-  mptr = NSA_GET_PTR (env, menubar);\n   \n   gdk_threads_enter ();\n \n   box = GTK_BIN (wptr)->child;\n+  \n+  children = gtk_container_get_children (GTK_CONTAINER (box));\n+  \n+  while (children != NULL && !GTK_IS_MENU_SHELL (children->data)) \n+  {\n+    children = children->next;\n+  }\n+  \n+  /* If there isn't a MenuBar in this Frame's list of children\n+     then we can just return. */\n+  if (!GTK_IS_MENU_SHELL (children->data))\n+    return;\n+  else\n+    mptr = children->data;\n+    \n+  /* This will actually destroy the MenuBar. By removing it from\n+     its parent, the reference count for the MenuBar widget will\n+     decrement to 0. The widget will be automatically destroyed \n+     by Gtk. */\n   gtk_container_remove (GTK_CONTAINER (box), GTK_WIDGET (mptr));  \n   \n   gdk_threads_leave();"}]}