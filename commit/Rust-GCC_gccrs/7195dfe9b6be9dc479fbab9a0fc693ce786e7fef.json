{"sha": "7195dfe9b6be9dc479fbab9a0fc693ce786e7fef", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6NzE5NWRmZTliNmJlOWRjNDc5ZmJhYjlhMGZjNjkzY2U3ODZlN2ZlZg==", "commit": {"author": {"name": "Jonathan Wakely", "email": "jwakely@redhat.com", "date": "2016-10-25T15:32:52Z"}, "committer": {"name": "Jonathan Wakely", "email": "redi@gcc.gnu.org", "date": "2016-10-25T15:32:52Z"}, "message": "Handle negative times in filesystem::last_write_time\n\n\t* src/filesystem/ops.cc\n\t(last_write_time(const path&, file_time_type, error_code&)): Handle\n\tnegative times correctly.\n\t* testsuite/experimental/filesystem/operations/last_write_time.cc:\n\tTest writing file times.\n\nFrom-SVN: r241522", "tree": {"sha": "e20fea44c107df23239db86f2a8a4f203b078b96", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/e20fea44c107df23239db86f2a8a4f203b078b96"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/7195dfe9b6be9dc479fbab9a0fc693ce786e7fef", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/7195dfe9b6be9dc479fbab9a0fc693ce786e7fef", "html_url": "https://github.com/Rust-GCC/gccrs/commit/7195dfe9b6be9dc479fbab9a0fc693ce786e7fef", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/7195dfe9b6be9dc479fbab9a0fc693ce786e7fef/comments", "author": {"login": "jwakely", "id": 1254480, "node_id": "MDQ6VXNlcjEyNTQ0ODA=", "avatar_url": "https://avatars.githubusercontent.com/u/1254480?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jwakely", "html_url": "https://github.com/jwakely", "followers_url": "https://api.github.com/users/jwakely/followers", "following_url": "https://api.github.com/users/jwakely/following{/other_user}", "gists_url": "https://api.github.com/users/jwakely/gists{/gist_id}", "starred_url": "https://api.github.com/users/jwakely/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jwakely/subscriptions", "organizations_url": "https://api.github.com/users/jwakely/orgs", "repos_url": "https://api.github.com/users/jwakely/repos", "events_url": "https://api.github.com/users/jwakely/events{/privacy}", "received_events_url": "https://api.github.com/users/jwakely/received_events", "type": "User", "site_admin": false}, "committer": {"login": "jwakely", "id": 1254480, "node_id": "MDQ6VXNlcjEyNTQ0ODA=", "avatar_url": "https://avatars.githubusercontent.com/u/1254480?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jwakely", "html_url": "https://github.com/jwakely", "followers_url": "https://api.github.com/users/jwakely/followers", "following_url": "https://api.github.com/users/jwakely/following{/other_user}", "gists_url": "https://api.github.com/users/jwakely/gists{/gist_id}", "starred_url": "https://api.github.com/users/jwakely/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jwakely/subscriptions", "organizations_url": "https://api.github.com/users/jwakely/orgs", "repos_url": "https://api.github.com/users/jwakely/repos", "events_url": "https://api.github.com/users/jwakely/events{/privacy}", "received_events_url": "https://api.github.com/users/jwakely/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "ec04aad76d5a4ac4759a78a04cbd950f4a1e9517", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/ec04aad76d5a4ac4759a78a04cbd950f4a1e9517", "html_url": "https://github.com/Rust-GCC/gccrs/commit/ec04aad76d5a4ac4759a78a04cbd950f4a1e9517"}], "stats": {"total": 51, "additions": 51, "deletions": 0}, "files": [{"sha": "11ac1062d094d86a28ae9bd44dcc6e6b0544b2d4", "filename": "libstdc++-v3/ChangeLog", "status": "modified", "additions": 6, "deletions": 0, "changes": 6, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/7195dfe9b6be9dc479fbab9a0fc693ce786e7fef/libstdc%2B%2B-v3%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/7195dfe9b6be9dc479fbab9a0fc693ce786e7fef/libstdc%2B%2B-v3%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libstdc%2B%2B-v3%2FChangeLog?ref=7195dfe9b6be9dc479fbab9a0fc693ce786e7fef", "patch": "@@ -1,5 +1,11 @@\n 2016-10-25  Jonathan Wakely  <jwakely@redhat.com>\n \n+\t* src/filesystem/ops.cc\n+\t(last_write_time(const path&, file_time_type, error_code&)): Handle\n+\tnegative times correctly.\n+\t* testsuite/experimental/filesystem/operations/last_write_time.cc:\n+\tTest writing file times.\n+\n \t* src/filesystem/ops.cc (do_copy_file): Report an error if source or\n \tdestination is not a regular file (LWG 2712).\n \t(equivalent): Fix error handling and result when only one file exists."}, {"sha": "32c9c5e850de20833f96729d161fb0be9b940f81", "filename": "libstdc++-v3/src/filesystem/ops.cc", "status": "modified", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/7195dfe9b6be9dc479fbab9a0fc693ce786e7fef/libstdc%2B%2B-v3%2Fsrc%2Ffilesystem%2Fops.cc", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/7195dfe9b6be9dc479fbab9a0fc693ce786e7fef/libstdc%2B%2B-v3%2Fsrc%2Ffilesystem%2Fops.cc", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libstdc%2B%2B-v3%2Fsrc%2Ffilesystem%2Fops.cc?ref=7195dfe9b6be9dc479fbab9a0fc693ce786e7fef", "patch": "@@ -1100,6 +1100,11 @@ fs::last_write_time(const path& p __attribute__((__unused__)),\n   auto s = chrono::duration_cast<chrono::seconds>(d);\n #if _GLIBCXX_USE_UTIMENSAT\n   auto ns = chrono::duration_cast<chrono::nanoseconds>(d - s);\n+  if (ns < ns.zero()) // tv_nsec must be non-negative and less than 10e9.\n+    {\n+      --s;\n+      ns += chrono::seconds(1);\n+    }\n   struct ::timespec ts[2];\n   ts[0].tv_sec = 0;\n   ts[0].tv_nsec = UTIME_OMIT;"}, {"sha": "74be4f94dda42cc3dbad734bd79eff68953c0ff6", "filename": "libstdc++-v3/testsuite/experimental/filesystem/operations/last_write_time.cc", "status": "modified", "additions": 40, "deletions": 0, "changes": 40, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/7195dfe9b6be9dc479fbab9a0fc693ce786e7fef/libstdc%2B%2B-v3%2Ftestsuite%2Fexperimental%2Ffilesystem%2Foperations%2Flast_write_time.cc", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/7195dfe9b6be9dc479fbab9a0fc693ce786e7fef/libstdc%2B%2B-v3%2Ftestsuite%2Fexperimental%2Ffilesystem%2Foperations%2Flast_write_time.cc", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libstdc%2B%2B-v3%2Ftestsuite%2Fexperimental%2Ffilesystem%2Foperations%2Flast_write_time.cc?ref=7195dfe9b6be9dc479fbab9a0fc693ce786e7fef", "patch": "@@ -35,6 +35,8 @@\n void\n test01()\n {\n+  // read times\n+\n   using time_type = std::experimental::filesystem::file_time_type;\n \n   auto p = __gnu_test::nonexistent_path();\n@@ -103,8 +105,46 @@ test01()\n #endif\n }\n \n+void\n+test02()\n+{\n+  // write times\n+\n+  using time_type = std::experimental::filesystem::file_time_type;\n+\n+  __gnu_test::scoped_file f;\n+  std::error_code ec;\n+  time_type time;\n+\n+  time = last_write_time(f.path);\n+  last_write_time(f.path, time, ec);\n+  VERIFY( !ec );\n+  VERIFY( last_write_time(f.path) == time );\n+\n+  time -= std::chrono::milliseconds(1000 * 60 * 10 + 15);\n+  last_write_time(f.path, time, ec);\n+  VERIFY( !ec );\n+  VERIFY( last_write_time(f.path) == time );\n+\n+  time += std::chrono::milliseconds(1000 * 60 * 20 + 15);\n+  last_write_time(f.path, time, ec);\n+  VERIFY( !ec );\n+  VERIFY( last_write_time(f.path) == time );\n+\n+  time = time_type();\n+  last_write_time(f.path, time, ec);\n+  VERIFY( !ec );\n+  VERIFY( last_write_time(f.path) == time );\n+\n+  time -= std::chrono::milliseconds(1000 * 60 * 10 + 15);\n+  last_write_time(f.path, time, ec);\n+  VERIFY( !ec );\n+  VERIFY( last_write_time(f.path) == time );\n+}\n+\n int\n main()\n {\n   test01();\n+  test02();\n }"}]}