{"sha": "952e24fed662bec5e6076a1adb6b5642a926c86e", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6OTUyZTI0ZmVkNjYyYmVjNWU2MDc2YTFhZGI2YjU2NDJhOTI2Yzg2ZQ==", "commit": {"author": {"name": "Jason Merrill", "email": "jason@redhat.com", "date": "2009-02-11T05:23:02Z"}, "committer": {"name": "Jason Merrill", "email": "jason@gcc.gnu.org", "date": "2009-02-11T05:23:02Z"}, "message": "re PR c++/36744 ([C++0x] function modifying argument received by-value affects caller's variable when passed as rvalue)\n\n        PR c++/36744\n        * tree.c (lvalue_p_1): Condition rvalue ref handling on\n        treat_class_rvalues_as_lvalues, too.\n\nFrom-SVN: r144091", "tree": {"sha": "cd5dab2eab6b58e365a98497f181d91f83dc2e88", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/cd5dab2eab6b58e365a98497f181d91f83dc2e88"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/952e24fed662bec5e6076a1adb6b5642a926c86e", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/952e24fed662bec5e6076a1adb6b5642a926c86e", "html_url": "https://github.com/Rust-GCC/gccrs/commit/952e24fed662bec5e6076a1adb6b5642a926c86e", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/952e24fed662bec5e6076a1adb6b5642a926c86e/comments", "author": {"login": "jicama", "id": 266146, "node_id": "MDQ6VXNlcjI2NjE0Ng==", "avatar_url": "https://avatars.githubusercontent.com/u/266146?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jicama", "html_url": "https://github.com/jicama", "followers_url": "https://api.github.com/users/jicama/followers", "following_url": "https://api.github.com/users/jicama/following{/other_user}", "gists_url": "https://api.github.com/users/jicama/gists{/gist_id}", "starred_url": "https://api.github.com/users/jicama/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jicama/subscriptions", "organizations_url": "https://api.github.com/users/jicama/orgs", "repos_url": "https://api.github.com/users/jicama/repos", "events_url": "https://api.github.com/users/jicama/events{/privacy}", "received_events_url": "https://api.github.com/users/jicama/received_events", "type": "User", "site_admin": false}, "committer": null, "parents": [{"sha": "1d428010b4e72e25582ae6ba45901a6072f1bb94", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/1d428010b4e72e25582ae6ba45901a6072f1bb94", "html_url": "https://github.com/Rust-GCC/gccrs/commit/1d428010b4e72e25582ae6ba45901a6072f1bb94"}], "stats": {"total": 40, "additions": 39, "deletions": 1}, "files": [{"sha": "3c1975ff708f24fcbde5b4288645763fcad052bd", "filename": "gcc/cp/ChangeLog", "status": "modified", "additions": 6, "deletions": 0, "changes": 6, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/952e24fed662bec5e6076a1adb6b5642a926c86e/gcc%2Fcp%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/952e24fed662bec5e6076a1adb6b5642a926c86e/gcc%2Fcp%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fcp%2FChangeLog?ref=952e24fed662bec5e6076a1adb6b5642a926c86e", "patch": "@@ -1,3 +1,9 @@\n+2009-02-10  Jason Merrill  <jason@redhat.com>\n+\n+\tPR c++/36744\n+\t* tree.c (lvalue_p_1): Condition rvalue ref handling on\n+\ttreat_class_rvalues_as_lvalues, too.\n+\n 2009-02-10  Paolo Carlini  <paolo.carlini@oracle.com>\n \n \tPR c++/34397"}, {"sha": "456abfc9443db781c1ec21128996761361cf2f47", "filename": "gcc/cp/tree.c", "status": "modified", "additions": 6, "deletions": 1, "changes": 7, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/952e24fed662bec5e6076a1adb6b5642a926c86e/gcc%2Fcp%2Ftree.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/952e24fed662bec5e6076a1adb6b5642a926c86e/gcc%2Fcp%2Ftree.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fcp%2Ftree.c?ref=952e24fed662bec5e6076a1adb6b5642a926c86e", "patch": "@@ -82,7 +82,12 @@ lvalue_p_1 (tree ref,\n \t  && TREE_CODE (ref) != PARM_DECL\n \t  && TREE_CODE (ref) != VAR_DECL\n \t  && TREE_CODE (ref) != COMPONENT_REF)\n-\treturn clk_none;\n+\t{\n+\t  if (CLASS_TYPE_P (TREE_TYPE (TREE_TYPE (ref))))\n+\t    return treat_class_rvalues_as_lvalues ? clk_class : clk_none;\n+\t  else\n+\t    return clk_none;\n+\t}\n \n       /* lvalue references and named rvalue references are lvalues.  */\n       return clk_ordinary;"}, {"sha": "4cb62582130f65bc4d26d2afd15d66d2cd8d434e", "filename": "gcc/testsuite/ChangeLog", "status": "modified", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/952e24fed662bec5e6076a1adb6b5642a926c86e/gcc%2Ftestsuite%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/952e24fed662bec5e6076a1adb6b5642a926c86e/gcc%2Ftestsuite%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2FChangeLog?ref=952e24fed662bec5e6076a1adb6b5642a926c86e", "patch": "@@ -1,3 +1,8 @@\n+2009-02-11  Jason Merrill  <jason@redhat.com>\n+\n+\tPR c++/36744\n+\t* g++.dg/cpp0x/rv9p.C: New test.\n+\n 2009-02-10  Eric Botcazou  <ebotcazou@adacore.com>\n \n \t* gnat.dg/aliasing3.adb: New test."}, {"sha": "ec08a824865f89c999e50c4173f3393c45355668", "filename": "gcc/testsuite/g++.dg/cpp0x/rv9p.C", "status": "added", "additions": 22, "deletions": 0, "changes": 22, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/952e24fed662bec5e6076a1adb6b5642a926c86e/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Fcpp0x%2Frv9p.C", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/952e24fed662bec5e6076a1adb6b5642a926c86e/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Fcpp0x%2Frv9p.C", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Fcpp0x%2Frv9p.C?ref=952e24fed662bec5e6076a1adb6b5642a926c86e", "patch": "@@ -0,0 +1,22 @@\n+// PR c++/36744\n+// { dg-options \"-std=c++0x\" }\n+// { dg-do run }\n+\n+struct S\n+{\n+  S(): i(2) {}\n+  S(S const&s): i(s.i) {}\n+  int i;\n+};\n+\n+void f(S x) { x.i = 0; }\n+\n+extern \"C\" void abort (void);\n+int main()\n+{\n+  S y;\n+  f(static_cast<S&&>(y));\n+  if (y.i != 2)\n+    abort ();\n+  return 0;\n+}"}]}