{"sha": "3d6fc627f6cb78ecf280622c05eed59e9150a5c7", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6M2Q2ZmM2MjdmNmNiNzhlY2YyODA2MjJjMDVlZWQ1OWU5MTUwYTVjNw==", "commit": {"author": {"name": "Janus Weil", "email": "janus@gcc.gnu.org", "date": "2018-08-25T15:41:34Z"}, "committer": {"name": "Janus Weil", "email": "janus@gcc.gnu.org", "date": "2018-08-25T15:41:34Z"}, "message": "re PR fortran/86545 (ICE in transfer_expr on invalid WRITE statement)\n\nfix PR 86545\n\n2018-08-25  Janus Weil  <janus@gcc.gnu.org>\n\n\tPR fortran/86545\n\t* resolve.c (resolve_transfer): Correctly determine typespec for\n\tgeneric function calls, in order to throw a proper error.\n\n2018-08-25  Janus Weil  <janus@gcc.gnu.org>\n\n\tPR fortran/86545\n\t* gfortran.dg/generic_35.f90: New test case.\n\nFrom-SVN: r263854", "tree": {"sha": "06d8adf521a462ffce4c28e2e3c335cee13a6d1e", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/06d8adf521a462ffce4c28e2e3c335cee13a6d1e"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/3d6fc627f6cb78ecf280622c05eed59e9150a5c7", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/3d6fc627f6cb78ecf280622c05eed59e9150a5c7", "html_url": "https://github.com/Rust-GCC/gccrs/commit/3d6fc627f6cb78ecf280622c05eed59e9150a5c7", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/3d6fc627f6cb78ecf280622c05eed59e9150a5c7/comments", "author": {"login": "janusw", "id": 484108, "node_id": "MDQ6VXNlcjQ4NDEwOA==", "avatar_url": "https://avatars.githubusercontent.com/u/484108?v=4", "gravatar_id": "", "url": "https://api.github.com/users/janusw", "html_url": "https://github.com/janusw", "followers_url": "https://api.github.com/users/janusw/followers", "following_url": "https://api.github.com/users/janusw/following{/other_user}", "gists_url": "https://api.github.com/users/janusw/gists{/gist_id}", "starred_url": "https://api.github.com/users/janusw/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/janusw/subscriptions", "organizations_url": "https://api.github.com/users/janusw/orgs", "repos_url": "https://api.github.com/users/janusw/repos", "events_url": "https://api.github.com/users/janusw/events{/privacy}", "received_events_url": "https://api.github.com/users/janusw/received_events", "type": "User", "site_admin": false}, "committer": {"login": "janusw", "id": 484108, "node_id": "MDQ6VXNlcjQ4NDEwOA==", "avatar_url": "https://avatars.githubusercontent.com/u/484108?v=4", "gravatar_id": "", "url": "https://api.github.com/users/janusw", "html_url": "https://github.com/janusw", "followers_url": "https://api.github.com/users/janusw/followers", "following_url": "https://api.github.com/users/janusw/following{/other_user}", "gists_url": "https://api.github.com/users/janusw/gists{/gist_id}", "starred_url": "https://api.github.com/users/janusw/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/janusw/subscriptions", "organizations_url": "https://api.github.com/users/janusw/orgs", "repos_url": "https://api.github.com/users/janusw/repos", "events_url": "https://api.github.com/users/janusw/events{/privacy}", "received_events_url": "https://api.github.com/users/janusw/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "efa57feec8e47a9f6e4b62a21658f614b4aeb7d5", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/efa57feec8e47a9f6e4b62a21658f614b4aeb7d5", "html_url": "https://github.com/Rust-GCC/gccrs/commit/efa57feec8e47a9f6e4b62a21658f614b4aeb7d5"}], "stats": {"total": 47, "additions": 45, "deletions": 2}, "files": [{"sha": "22c40527bc69b4f4fef0bceb414a3a971f8a03ae", "filename": "gcc/fortran/ChangeLog", "status": "modified", "additions": 6, "deletions": 0, "changes": 6, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/3d6fc627f6cb78ecf280622c05eed59e9150a5c7/gcc%2Ffortran%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/3d6fc627f6cb78ecf280622c05eed59e9150a5c7/gcc%2Ffortran%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ffortran%2FChangeLog?ref=3d6fc627f6cb78ecf280622c05eed59e9150a5c7", "patch": "@@ -1,3 +1,9 @@\n+2018-08-25  Janus Weil  <janus@gcc.gnu.org>\n+\n+\tPR fortran/86545\n+\t* resolve.c (resolve_transfer): Correctly determine typespec for\n+\tgeneric function calls, in order to throw a proper error.\n+\n 2018-08-24  Thomas Koenig  <tkoenig@gcc.gnu.org>\n \n \tPR fortran/86837"}, {"sha": "ded276242833c54b75b917c61cb13db168ad7100", "filename": "gcc/fortran/resolve.c", "status": "modified", "additions": 3, "deletions": 2, "changes": 5, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/3d6fc627f6cb78ecf280622c05eed59e9150a5c7/gcc%2Ffortran%2Fresolve.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/3d6fc627f6cb78ecf280622c05eed59e9150a5c7/gcc%2Ffortran%2Fresolve.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ffortran%2Fresolve.c?ref=3d6fc627f6cb78ecf280622c05eed59e9150a5c7", "patch": "@@ -9280,7 +9280,6 @@ resolve_select_type (gfc_code *code, gfc_namespace *old_ns)\n static void\n resolve_transfer (gfc_code *code)\n {\n-  gfc_typespec *ts;\n   gfc_symbol *sym, *derived;\n   gfc_ref *ref;\n   gfc_expr *exp;\n@@ -9316,7 +9315,9 @@ resolve_transfer (gfc_code *code)\n \t\t\t\t    _(\"item in READ\")))\n     return;\n \n-  ts = exp->expr_type == EXPR_STRUCTURE ? &exp->ts : &exp->symtree->n.sym->ts;\n+  const gfc_typespec *ts = exp->expr_type == EXPR_STRUCTURE\n+\t\t\t|| exp->expr_type == EXPR_FUNCTION\n+\t\t\t ? &exp->ts : &exp->symtree->n.sym->ts;\n \n   /* Go to actual component transferred.  */\n   for (ref = exp->ref; ref; ref = ref->next)"}, {"sha": "13601d2de3bf2bec7366e82f4d3d8a27124d1aef", "filename": "gcc/testsuite/ChangeLog", "status": "modified", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/3d6fc627f6cb78ecf280622c05eed59e9150a5c7/gcc%2Ftestsuite%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/3d6fc627f6cb78ecf280622c05eed59e9150a5c7/gcc%2Ftestsuite%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2FChangeLog?ref=3d6fc627f6cb78ecf280622c05eed59e9150a5c7", "patch": "@@ -1,3 +1,8 @@\n+2018-08-25  Janus Weil  <janus@gcc.gnu.org>\n+\n+\tPR fortran/86545\n+\t* gfortran.dg/generic_35.f90: New test case.\n+\n 2018-08-24  David Malcolm  <dmalcolm@redhat.com>\n \n \tPR 87091"}, {"sha": "24ac270319fe11b1f6275973c401db5eb6894c12", "filename": "gcc/testsuite/gfortran.dg/generic_35.f90", "status": "added", "additions": 31, "deletions": 0, "changes": 31, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/3d6fc627f6cb78ecf280622c05eed59e9150a5c7/gcc%2Ftestsuite%2Fgfortran.dg%2Fgeneric_35.f90", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/3d6fc627f6cb78ecf280622c05eed59e9150a5c7/gcc%2Ftestsuite%2Fgfortran.dg%2Fgeneric_35.f90", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgfortran.dg%2Fgeneric_35.f90?ref=3d6fc627f6cb78ecf280622c05eed59e9150a5c7", "patch": "@@ -0,0 +1,31 @@\n+! { dg-do compile }\n+!\n+! PR 86545: ICE in transfer_expr on invalid WRITE statement\n+!\n+! Contributed by Janus Weil <janus@gcc.gnu.org>\n+\n+module m\n+\n+   type tString\n+      character(len=:), allocatable :: cs\n+   end type\n+\n+   interface my_trim\n+      module procedure trim_string\n+   end interface\n+\n+contains\n+\n+   elemental function trim_string(self) result(str)\n+      type(tString) :: str\n+      class(tString), intent(in) :: self\n+   end function\n+\n+end module\n+\n+\n+program p\n+   use m\n+   type(tString) :: s\n+   write(*,*) my_trim(s)   ! { dg-error \"cannot have ALLOCATABLE components\" }\n+end"}]}