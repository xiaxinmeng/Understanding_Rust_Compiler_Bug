{"sha": "232d1950fd1cc440b0d7673246614c360744984e", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6MjMyZDE5NTBmZDFjYzQ0MGIwZDc2NzMyNDY2MTRjMzYwNzQ0OTg0ZQ==", "commit": {"author": {"name": "Tobias Burnus", "email": "burnus@net-b.de", "date": "2012-03-08T19:36:43Z"}, "committer": {"name": "Tobias Burnus", "email": "burnus@gcc.gnu.org", "date": "2012-03-08T19:36:43Z"}, "message": "re PR fortran/52469 (-fwhole-file bug: Wrong backend_decl for result of PPC function)\n\n2012-03-08  Tobias Burnus  <burnus@net-b.de>\n\n        PR fortran/52469\n        * trans-types.c (gfc_get_function_type): Handle backend_decl\n        of a procedure pointer.\n\n2012-03-08  Tobias Burnus  <burnus@net-b.de>\n\n        PR fortran/52469\n        * gfortran.dg/proc_ptr_34.f90\n\nFrom-SVN: r185109", "tree": {"sha": "9443afab81e4ef90ee741cf6182f4589a68beb06", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/9443afab81e4ef90ee741cf6182f4589a68beb06"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/232d1950fd1cc440b0d7673246614c360744984e", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/232d1950fd1cc440b0d7673246614c360744984e", "html_url": "https://github.com/Rust-GCC/gccrs/commit/232d1950fd1cc440b0d7673246614c360744984e", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/232d1950fd1cc440b0d7673246614c360744984e/comments", "author": {"login": "tob2", "id": 264461, "node_id": "MDQ6VXNlcjI2NDQ2MQ==", "avatar_url": "https://avatars.githubusercontent.com/u/264461?v=4", "gravatar_id": "", "url": "https://api.github.com/users/tob2", "html_url": "https://github.com/tob2", "followers_url": "https://api.github.com/users/tob2/followers", "following_url": "https://api.github.com/users/tob2/following{/other_user}", "gists_url": "https://api.github.com/users/tob2/gists{/gist_id}", "starred_url": "https://api.github.com/users/tob2/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/tob2/subscriptions", "organizations_url": "https://api.github.com/users/tob2/orgs", "repos_url": "https://api.github.com/users/tob2/repos", "events_url": "https://api.github.com/users/tob2/events{/privacy}", "received_events_url": "https://api.github.com/users/tob2/received_events", "type": "User", "site_admin": false}, "committer": null, "parents": [{"sha": "a3299120f38a99b7e488ef54c1ef6fb5572d7f1d", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/a3299120f38a99b7e488ef54c1ef6fb5572d7f1d", "html_url": "https://github.com/Rust-GCC/gccrs/commit/a3299120f38a99b7e488ef54c1ef6fb5572d7f1d"}], "stats": {"total": 96, "additions": 95, "deletions": 1}, "files": [{"sha": "d3ef58d21ae715c1cd3a65b56201d70fd3ff0641", "filename": "gcc/fortran/ChangeLog", "status": "modified", "additions": 6, "deletions": 0, "changes": 6, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/232d1950fd1cc440b0d7673246614c360744984e/gcc%2Ffortran%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/232d1950fd1cc440b0d7673246614c360744984e/gcc%2Ffortran%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ffortran%2FChangeLog?ref=232d1950fd1cc440b0d7673246614c360744984e", "patch": "@@ -1,3 +1,9 @@\n+2012-03-08  Tobias Burnus  <burnus@net-b.de>\n+\n+\tPR fortran/52469\n+\t* trans-types.c (gfc_get_function_type): Handle backend_decl\n+\tof a procedure pointer.\n+\n 2012-03-06  Steven Bosscher  <steven@gcc.gnu.org>\n \n \t* f95-lang.c (yyerror, yylex): Remove."}, {"sha": "0f2912de1afbe78de9b7f8216174208239df71d1", "filename": "gcc/fortran/trans-types.c", "status": "modified", "additions": 5, "deletions": 1, "changes": 6, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/232d1950fd1cc440b0d7673246614c360744984e/gcc%2Ffortran%2Ftrans-types.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/232d1950fd1cc440b0d7673246614c360744984e/gcc%2Ffortran%2Ftrans-types.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ffortran%2Ftrans-types.c?ref=232d1950fd1cc440b0d7673246614c360744984e", "patch": "@@ -2678,7 +2678,11 @@ gfc_get_function_type (gfc_symbol * sym)\n \t      || sym->attr.flavor == FL_PROGRAM);\n \n   if (sym->backend_decl)\n-    return TREE_TYPE (sym->backend_decl);\n+    {\n+      if (sym->attr.proc_pointer)\n+\treturn TREE_TYPE (TREE_TYPE (sym->backend_decl));\n+      return TREE_TYPE (sym->backend_decl);\n+    }\n \n   alternate_return = 0;\n   typelist = NULL;"}, {"sha": "42ce3106dcf4a13abf5ac1b730d63b5415da6aa0", "filename": "gcc/testsuite/ChangeLog", "status": "modified", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/232d1950fd1cc440b0d7673246614c360744984e/gcc%2Ftestsuite%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/232d1950fd1cc440b0d7673246614c360744984e/gcc%2Ftestsuite%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2FChangeLog?ref=232d1950fd1cc440b0d7673246614c360744984e", "patch": "@@ -1,3 +1,8 @@\n+2012-03-08  Tobias Burnus  <burnus@net-b.de>\n+\n+\tPR fortran/52469\n+\t* gfortran.dg/proc_ptr_34.f90\n+\n 2012-03-07  Jason Merrill  <jason@redhat.com>\n \n \tPR c++/52521"}, {"sha": "6226414b819696e049382df5dd00254de3b7f411", "filename": "gcc/testsuite/gfortran.dg/proc_ptr_34.f90", "status": "added", "additions": 79, "deletions": 0, "changes": 79, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/232d1950fd1cc440b0d7673246614c360744984e/gcc%2Ftestsuite%2Fgfortran.dg%2Fproc_ptr_34.f90", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/232d1950fd1cc440b0d7673246614c360744984e/gcc%2Ftestsuite%2Fgfortran.dg%2Fproc_ptr_34.f90", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgfortran.dg%2Fproc_ptr_34.f90?ref=232d1950fd1cc440b0d7673246614c360744984e", "patch": "@@ -0,0 +1,79 @@\n+! { dg-do compile }\n+!\n+! PR fortran/52469\n+!\n+! This was failing as the DECL of the proc pointer \"func\"\n+! was used for the interface of the proc-pointer component \"my_f_ptr\"\n+! rather than the decl of the proc-pointer target\n+!\n+! Contributed by palott@gmail.com\n+!\n+\n+module ExampleFuncs\n+  implicit none\n+\n+  ! NOTE: \"func\" is a procedure pointer!\n+  pointer :: func\n+  interface\n+     function func (z)\n+        real :: func\n+        real, intent (in) :: z\n+     end function func\n+  end interface\n+\n+  type Contains_f_ptr\n+     procedure (func), pointer, nopass :: my_f_ptr\n+  end type Contains_f_ptr\n+contains\n+\n+function f1 (x)\n+  real :: f1\n+  real, intent (in) :: x\n+\n+  f1 = 2.0 * x\n+\n+  return\n+end function f1\n+\n+function f2 (x)\n+   real :: f2\n+   real, intent (in) :: x\n+\n+   f2 = 3.0 * x**2\n+\n+   return\n+end function f2\n+\n+function fancy (func, x)\n+   real :: fancy\n+   real, intent (in) :: x\n+\n+   interface AFunc\n+      function func (y)\n+         real :: func\n+         real, intent (in) ::y\n+      end function func\n+   end interface AFunc\n+\n+   fancy = func (x) + 3.3 * x\n+end function fancy\n+\n+end module  ExampleFuncs\n+\n+\n+program test_proc_ptr\n+  use ExampleFuncs\n+  implicit none\n+\n+  type (Contains_f_ptr), dimension (2) :: NewType\n+ \n+  !NewType(1) % my_f_ptr => f1\n+  NewType(2) % my_f_ptr => f2\n+\n+  !write (*, *) NewType(1) % my_f_ptr (3.0), NewType(2) % my_f_ptr (3.0)\n+  write (6, *)  NewType(2) % my_f_ptr (3.0) ! < Shall print '27.0'\n+\n+  stop\n+end program test_proc_ptr\n+\n+! { dg-final { cleanup-modules \"examplefuncs\" } }"}]}