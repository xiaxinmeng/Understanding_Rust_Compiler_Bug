{"sha": "1e00382978e2fa9b1575ea15f5068cfbb5f877dc", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6MWUwMDM4Mjk3OGUyZmE5YjE1NzVlYTE1ZjUwNjhjZmJiNWY4NzdkYw==", "commit": {"author": {"name": "Jason Merrill", "email": "jason@redhat.com", "date": "2010-06-02T19:19:05Z"}, "committer": {"name": "Jason Merrill", "email": "jason@gcc.gnu.org", "date": "2010-06-02T19:19:05Z"}, "message": "re PR c++/44333 (Ambiguity with typedef and using namespace)\n\n\tPR c++/44333\n\t* name-lookup.c (same_entity_p): New.\n\t(ambiguous_decl): Multiple declarations of the same entity\n\tare not ambiguous.\n\nFrom-SVN: r160183", "tree": {"sha": "b24cda1627e0891a6edcb0d288406810ab3fdbdb", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/b24cda1627e0891a6edcb0d288406810ab3fdbdb"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/1e00382978e2fa9b1575ea15f5068cfbb5f877dc", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/1e00382978e2fa9b1575ea15f5068cfbb5f877dc", "html_url": "https://github.com/Rust-GCC/gccrs/commit/1e00382978e2fa9b1575ea15f5068cfbb5f877dc", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/1e00382978e2fa9b1575ea15f5068cfbb5f877dc/comments", "author": {"login": "jicama", "id": 266146, "node_id": "MDQ6VXNlcjI2NjE0Ng==", "avatar_url": "https://avatars.githubusercontent.com/u/266146?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jicama", "html_url": "https://github.com/jicama", "followers_url": "https://api.github.com/users/jicama/followers", "following_url": "https://api.github.com/users/jicama/following{/other_user}", "gists_url": "https://api.github.com/users/jicama/gists{/gist_id}", "starred_url": "https://api.github.com/users/jicama/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jicama/subscriptions", "organizations_url": "https://api.github.com/users/jicama/orgs", "repos_url": "https://api.github.com/users/jicama/repos", "events_url": "https://api.github.com/users/jicama/events{/privacy}", "received_events_url": "https://api.github.com/users/jicama/received_events", "type": "User", "site_admin": false}, "committer": null, "parents": [{"sha": "c440459b92796c12b757a91dd8f53f8c027aaf8b", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/c440459b92796c12b757a91dd8f53f8c027aaf8b", "html_url": "https://github.com/Rust-GCC/gccrs/commit/c440459b92796c12b757a91dd8f53f8c027aaf8b"}], "stats": {"total": 50, "additions": 45, "deletions": 5}, "files": [{"sha": "8b883e7656e772fc92ac98abd154053bf6ff5c84", "filename": "gcc/cp/ChangeLog", "status": "modified", "additions": 9, "deletions": 0, "changes": 9, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/1e00382978e2fa9b1575ea15f5068cfbb5f877dc/gcc%2Fcp%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/1e00382978e2fa9b1575ea15f5068cfbb5f877dc/gcc%2Fcp%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fcp%2FChangeLog?ref=1e00382978e2fa9b1575ea15f5068cfbb5f877dc", "patch": "@@ -1,3 +1,12 @@\n+2010-06-02  Jason Merrill  <jason@redhat.com>\n+\n+\tPR c++/9726\n+\tPR c++/23594\n+\tPR c++/44333\n+\t* name-lookup.c (same_entity_p): New.\n+\t(ambiguous_decl): Multiple declarations of the same entity\n+\tare not ambiguous.\n+\n 2010-06-01  Jason Merrill  <jason@redhat.com>\n \n \tDR 990"}, {"sha": "936c25638e0bba3141d5adcb3d2cfe77611d8f18", "filename": "gcc/cp/name-lookup.c", "status": "modified", "additions": 26, "deletions": 1, "changes": 27, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/1e00382978e2fa9b1575ea15f5068cfbb5f877dc/gcc%2Fcp%2Fname-lookup.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/1e00382978e2fa9b1575ea15f5068cfbb5f877dc/gcc%2Fcp%2Fname-lookup.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fcp%2Fname-lookup.c?ref=1e00382978e2fa9b1575ea15f5068cfbb5f877dc", "patch": "@@ -3698,6 +3698,31 @@ merge_functions (tree s1, tree s2)\n   return s1;\n }\n \n+/* Returns TRUE iff OLD and NEW are the same entity.\n+\n+   3 [basic]/3: An entity is a value, object, reference, function,\n+   enumerator, type, class member, template, template specialization,\n+   namespace, parameter pack, or this.\n+\n+   7.3.4 [namespace.udir]/4: If name lookup finds a declaration for a name\n+   in two different namespaces, and the declarations do not declare the\n+   same entity and do not declare functions, the use of the name is\n+   ill-formed.  */\n+\n+static bool\n+same_entity_p (tree one, tree two)\n+{\n+  if (one == two)\n+    return true;\n+  if (!one || !two)\n+    return false;\n+  if (TREE_CODE (one) == TYPE_DECL\n+      && TREE_CODE (two) == TYPE_DECL\n+      && same_type_p (TREE_TYPE (one), TREE_TYPE (two)))\n+    return true;\n+  return false;\n+}\n+\n /* This should return an error not all definitions define functions.\n    It is not an error if we find two functions with exactly the\n    same signature, only if these are selected in overload resolution.\n@@ -3763,7 +3788,7 @@ ambiguous_decl (struct scope_binding *old, cxx_binding *new_binding, int flags)\n \n   if (!old->value)\n     old->value = val;\n-  else if (val && val != old->value)\n+  else if (val && !same_entity_p (val, old->value))\n     {\n       if (is_overloaded_fn (old->value) && is_overloaded_fn (val))\n \told->value = merge_functions (old->value, val);"}, {"sha": "dba6f87bb4a1c878f4fef0f6a05601b2d9a73da8", "filename": "gcc/testsuite/ChangeLog", "status": "modified", "additions": 7, "deletions": 0, "changes": 7, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/1e00382978e2fa9b1575ea15f5068cfbb5f877dc/gcc%2Ftestsuite%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/1e00382978e2fa9b1575ea15f5068cfbb5f877dc/gcc%2Ftestsuite%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2FChangeLog?ref=1e00382978e2fa9b1575ea15f5068cfbb5f877dc", "patch": "@@ -1,3 +1,10 @@\n+2010-06-02  Jason Merrill  <jason@redhat.com>\n+\n+\tPR c++/9726\n+\tPR c++/23594\n+\tPR c++/44333\n+\t* g++.dg/tc1/dr101.C: Remove xfails.\n+\n 2010-06-02  H.J. Lu  <hongjiu.lu@intel.com>\n \n \tPR middle-end/44372"}, {"sha": "0316aaaa77d30107d6d02e657660dcfb65f56ac1", "filename": "gcc/testsuite/g++.dg/tc1/dr101.C", "status": "modified", "additions": 3, "deletions": 4, "changes": 7, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/1e00382978e2fa9b1575ea15f5068cfbb5f877dc/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Ftc1%2Fdr101.C", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/1e00382978e2fa9b1575ea15f5068cfbb5f877dc/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Ftc1%2Fdr101.C", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Ftc1%2Fdr101.C?ref=1e00382978e2fa9b1575ea15f5068cfbb5f877dc", "patch": "@@ -17,15 +17,14 @@ namespace Test1 {\n \n namespace Test2 {\n \n-  typedef unsigned int X;   // { dg-bogus \"X\" \"\" { xfail *-*-* } }\n+  typedef unsigned int X;   // { dg-bogus \"X\" \"\" }\n   extern \"C\" int f2();\n   namespace N {\n-    typedef unsigned int X; // { dg-bogus \"X\" \"\" { xfail *-*-* } }\n+    typedef unsigned int X; // { dg-bogus \"X\" \"\" }\n     extern \"C\" int f2();\n   }\n   using namespace N;\n   int i = f2(); // { dg-bogus \"\" \"redeclaration through 'using' should not be ambiguous\" }\n-  X x;          // { dg-bogus \"\" \"redeclaration through 'using' should not be ambiguous\" { xfail *-*-* } }\n+  X x;          // { dg-bogus \"\" \"redeclaration through 'using' should not be ambiguous\" }\n \n }\n-"}]}