{"sha": "84401ce5fb4ecab55decb472b168100e7593e01f", "node_id": "C_kwDOANBUbNoAKDg0NDAxY2U1ZmI0ZWNhYjU1ZGVjYjQ3MmIxNjgxMDBlNzU5M2UwMWY", "commit": {"author": {"name": "Richard Purdie", "email": "richard.purdie@linuxfoundation.org", "date": "2021-10-28T14:41:25Z"}, "committer": {"name": "Jeff Law", "email": "jeffreyalaw@gmail.com", "date": "2021-10-28T14:42:49Z"}, "message": "[PATCH 1/5] Makefile.in: Ensure build CPP/CPPFLAGS is used for build targets\n\nDuring cross compiling, CPP is being set to the target compiler even for\nbuild targets. As an example, when building a cross compiler targetting\nmingw, the config.log for libiberty in\nbuild.x86_64-pokysdk-mingw32.i586-poky-linux/build-x86_64-linux/libiberty/config.log\nshows:\n\nconfigure:3786: checking how to run the C preprocessor\nconfigure:3856: result: x86_64-pokysdk-mingw32-gcc -E --sysroot=[sysroot]/x86_64-nativesdk-mingw32-pokysdk-mingw32\nconfigure:3876: x86_64-pokysdk-mingw32-gcc -E --sysroot=[sysroot]/x86_64-nativesdk-mingw32-pokysdk-mingw32 conftest.c\nconfigure:3876: $? = 0\n\nThis is libiberty being built for the build environment, not the target one\n(i.e. in build-x86_64-linux). As such it should be using the build environment's\ngcc and not the target one. In the mingw case the system headers are quite\ndifferent leading to build failures related to not being able to include a\nprocess.h file for pem-unix.c.\n\nFurther analysis shows the same issue occuring for CPPFLAGS too.\n\nFix this by adding support for CPP_FOR_BUILD and CPPFLAGS_FOR_BUILD which\nfor example, avoids mixing the mingw headers for host binaries on linux\nsystems.\n\n2021-10-27 Richard Purdie <richard.purdie@linuxfoundation.org>\n\nChangeLog:\n\n\t* Makefile.tpl: Add CPP_FOR_BUILD and CPPFLAGS_FOR_BUILD support\n\t* Makefile.in: Regenerate.\n\t* configure: Regenerate.\n\t* configure.ac: Add CPP_FOR_BUILD and CPPFLAGS_FOR_BUILD support\n\ngcc/ChangeLog:\n\n\t* configure: Regenerate.\n\t* configure.ac: Use CPPFLAGS_FOR_BUILD for GMPINC\n\nSigned-off-by: Richard Purdie <richard.purdie@linuxfoundation.org>", "tree": {"sha": "e250247f7e3d004806b2d233ac11bf31a62d4128", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/e250247f7e3d004806b2d233ac11bf31a62d4128"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/84401ce5fb4ecab55decb472b168100e7593e01f", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/84401ce5fb4ecab55decb472b168100e7593e01f", "html_url": "https://github.com/Rust-GCC/gccrs/commit/84401ce5fb4ecab55decb472b168100e7593e01f", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/84401ce5fb4ecab55decb472b168100e7593e01f/comments", "author": {"login": "rpurdie", "id": 1184070, "node_id": "MDQ6VXNlcjExODQwNzA=", "avatar_url": "https://avatars.githubusercontent.com/u/1184070?v=4", "gravatar_id": "", "url": "https://api.github.com/users/rpurdie", "html_url": "https://github.com/rpurdie", "followers_url": "https://api.github.com/users/rpurdie/followers", "following_url": "https://api.github.com/users/rpurdie/following{/other_user}", "gists_url": "https://api.github.com/users/rpurdie/gists{/gist_id}", "starred_url": "https://api.github.com/users/rpurdie/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/rpurdie/subscriptions", "organizations_url": "https://api.github.com/users/rpurdie/orgs", "repos_url": "https://api.github.com/users/rpurdie/repos", "events_url": "https://api.github.com/users/rpurdie/events{/privacy}", "received_events_url": "https://api.github.com/users/rpurdie/received_events", "type": "User", "site_admin": false}, "committer": {"login": "JeffreyALaw", "id": 14062506, "node_id": "MDQ6VXNlcjE0MDYyNTA2", "avatar_url": "https://avatars.githubusercontent.com/u/14062506?v=4", "gravatar_id": "", "url": "https://api.github.com/users/JeffreyALaw", "html_url": "https://github.com/JeffreyALaw", "followers_url": "https://api.github.com/users/JeffreyALaw/followers", "following_url": "https://api.github.com/users/JeffreyALaw/following{/other_user}", "gists_url": "https://api.github.com/users/JeffreyALaw/gists{/gist_id}", "starred_url": "https://api.github.com/users/JeffreyALaw/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/JeffreyALaw/subscriptions", "organizations_url": "https://api.github.com/users/JeffreyALaw/orgs", "repos_url": "https://api.github.com/users/JeffreyALaw/repos", "events_url": "https://api.github.com/users/JeffreyALaw/events{/privacy}", "received_events_url": "https://api.github.com/users/JeffreyALaw/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "9927ecbb42d5be48fa933adc26f8601fab5007ca", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/9927ecbb42d5be48fa933adc26f8601fab5007ca", "html_url": "https://github.com/Rust-GCC/gccrs/commit/9927ecbb42d5be48fa933adc26f8601fab5007ca"}], "stats": {"total": 24, "additions": 22, "deletions": 2}, "files": [{"sha": "d13f6c353ee2c86fff2cac44804ecdae2661f99c", "filename": "Makefile.in", "status": "modified", "additions": 6, "deletions": 0, "changes": 6, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/84401ce5fb4ecab55decb472b168100e7593e01f/Makefile.in", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/84401ce5fb4ecab55decb472b168100e7593e01f/Makefile.in", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/Makefile.in?ref=84401ce5fb4ecab55decb472b168100e7593e01f", "patch": "@@ -154,6 +154,8 @@ BUILD_EXPORTS = \\\n \tCC=\"$(CC_FOR_BUILD)\"; export CC; \\\n \tCFLAGS=\"$(CFLAGS_FOR_BUILD)\"; export CFLAGS; \\\n \tCONFIG_SHELL=\"$(SHELL)\"; export CONFIG_SHELL; \\\n+\tCPP=\"$(CPP_FOR_BUILD)\"; export CPP; \\\n+\tCPPFLAGS=\"$(CPPFLAGS_FOR_BUILD)\"; export CPPFLAGS; \\\n \tCXX=\"$(CXX_FOR_BUILD)\"; export CXX; \\\n \tCXXFLAGS=\"$(CXXFLAGS_FOR_BUILD)\"; export CXXFLAGS; \\\n \tGFORTRAN=\"$(GFORTRAN_FOR_BUILD)\"; export GFORTRAN; \\\n@@ -202,6 +204,8 @@ HOST_EXPORTS = \\\n \tAR=\"$(AR)\"; export AR; \\\n \tAS=\"$(AS)\"; export AS; \\\n \tCC_FOR_BUILD=\"$(CC_FOR_BUILD)\"; export CC_FOR_BUILD; \\\n+\tCPP_FOR_BUILD=\"$(CPP_FOR_BUILD)\"; export CPP_FOR_BUILD; \\\n+\tCPPFLAGS_FOR_BUILD=\"$(CPPFLAGS_FOR_BUILD)\"; export CPPFLAGS_FOR_BUILD; \\\n \tCXX_FOR_BUILD=\"$(CXX_FOR_BUILD)\"; export CXX_FOR_BUILD; \\\n \tDLLTOOL=\"$(DLLTOOL)\"; export DLLTOOL; \\\n \tDSYMUTIL=\"$(DSYMUTIL)\"; export DSYMUTIL; \\\n@@ -360,6 +364,8 @@ AR_FOR_BUILD = @AR_FOR_BUILD@\n AS_FOR_BUILD = @AS_FOR_BUILD@\n CC_FOR_BUILD = @CC_FOR_BUILD@\n CFLAGS_FOR_BUILD = @CFLAGS_FOR_BUILD@\n+CPP_FOR_BUILD = @CPP_FOR_BUILD@\n+CPPFLAGS_FOR_BUILD = @CPPFLAGS_FOR_BUILD@\n CXXFLAGS_FOR_BUILD = @CXXFLAGS_FOR_BUILD@\n CXX_FOR_BUILD = @CXX_FOR_BUILD@\n DLLTOOL_FOR_BUILD = @DLLTOOL_FOR_BUILD@"}, {"sha": "213052f82267b7d4d058b92b1d1992b88591aefe", "filename": "Makefile.tpl", "status": "modified", "additions": 6, "deletions": 0, "changes": 6, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/84401ce5fb4ecab55decb472b168100e7593e01f/Makefile.tpl", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/84401ce5fb4ecab55decb472b168100e7593e01f/Makefile.tpl", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/Makefile.tpl?ref=84401ce5fb4ecab55decb472b168100e7593e01f", "patch": "@@ -157,6 +157,8 @@ BUILD_EXPORTS = \\\n \tCC=\"$(CC_FOR_BUILD)\"; export CC; \\\n \tCFLAGS=\"$(CFLAGS_FOR_BUILD)\"; export CFLAGS; \\\n \tCONFIG_SHELL=\"$(SHELL)\"; export CONFIG_SHELL; \\\n+\tCPP=\"$(CPP_FOR_BUILD)\"; export CPP; \\\n+\tCPPFLAGS=\"$(CPPFLAGS_FOR_BUILD)\"; export CPPFLAGS; \\\n \tCXX=\"$(CXX_FOR_BUILD)\"; export CXX; \\\n \tCXXFLAGS=\"$(CXXFLAGS_FOR_BUILD)\"; export CXXFLAGS; \\\n \tGFORTRAN=\"$(GFORTRAN_FOR_BUILD)\"; export GFORTRAN; \\\n@@ -205,6 +207,8 @@ HOST_EXPORTS = \\\n \tAR=\"$(AR)\"; export AR; \\\n \tAS=\"$(AS)\"; export AS; \\\n \tCC_FOR_BUILD=\"$(CC_FOR_BUILD)\"; export CC_FOR_BUILD; \\\n+\tCPP_FOR_BUILD=\"$(CPP_FOR_BUILD)\"; export CPP_FOR_BUILD; \\\n+\tCPPFLAGS_FOR_BUILD=\"$(CPPFLAGS_FOR_BUILD)\"; export CPPFLAGS_FOR_BUILD; \\\n \tCXX_FOR_BUILD=\"$(CXX_FOR_BUILD)\"; export CXX_FOR_BUILD; \\\n \tDLLTOOL=\"$(DLLTOOL)\"; export DLLTOOL; \\\n \tDSYMUTIL=\"$(DSYMUTIL)\"; export DSYMUTIL; \\\n@@ -363,6 +367,8 @@ AR_FOR_BUILD = @AR_FOR_BUILD@\n AS_FOR_BUILD = @AS_FOR_BUILD@\n CC_FOR_BUILD = @CC_FOR_BUILD@\n CFLAGS_FOR_BUILD = @CFLAGS_FOR_BUILD@\n+CPP_FOR_BUILD = @CPP_FOR_BUILD@\n+CPPFLAGS_FOR_BUILD = @CPPFLAGS_FOR_BUILD@\n CXXFLAGS_FOR_BUILD = @CXXFLAGS_FOR_BUILD@\n CXX_FOR_BUILD = @CXX_FOR_BUILD@\n DLLTOOL_FOR_BUILD = @DLLTOOL_FOR_BUILD@"}, {"sha": "58979d6e3b119c426277139fca963f136440cef2", "filename": "configure", "status": "modified", "additions": 4, "deletions": 0, "changes": 4, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/84401ce5fb4ecab55decb472b168100e7593e01f/configure", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/84401ce5fb4ecab55decb472b168100e7593e01f/configure", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/configure?ref=84401ce5fb4ecab55decb472b168100e7593e01f", "patch": "@@ -655,6 +655,8 @@ DSYMUTIL_FOR_BUILD\n DLLTOOL_FOR_BUILD\n CXX_FOR_BUILD\n CXXFLAGS_FOR_BUILD\n+CPPFLAGS_FOR_BUILD\n+CPP_FOR_BUILD\n CFLAGS_FOR_BUILD\n CC_FOR_BUILD\n AS_FOR_BUILD\n@@ -4090,6 +4092,7 @@ if test \"${build}\" != \"${host}\" ; then\n   AR_FOR_BUILD=${AR_FOR_BUILD-ar}\n   AS_FOR_BUILD=${AS_FOR_BUILD-as}\n   CC_FOR_BUILD=${CC_FOR_BUILD-gcc}\n+  CPP_FOR_BUILD=\"${CPP_FOR_BUILD-\\$(CPP)}\"\n   CXX_FOR_BUILD=${CXX_FOR_BUILD-g++}\n   DSYMUTIL_FOR_BUILD=${DSYMUTIL_FOR_BUILD-dsymutil}\n   GFORTRAN_FOR_BUILD=${GFORTRAN_FOR_BUILD-gfortran}\n@@ -9999,6 +10002,7 @@ esac\n # our build compiler if desired.\n if test x\"${build}\" = x\"${host}\" ; then\n   CFLAGS_FOR_BUILD=${CFLAGS_FOR_BUILD-${CFLAGS}}\n+  CPPFLAGS_FOR_BUILD=${CPPFLAGS_FOR_BUILD-${CPPFLAGS}}\n   CXXFLAGS_FOR_BUILD=${CXXFLAGS_FOR_BUILD-${CXXFLAGS}}\n   LDFLAGS_FOR_BUILD=${LDFLAGS_FOR_BUILD-${LDFLAGS}}\n fi"}, {"sha": "550e6993b59869740392a701dc194b8e66c062ad", "filename": "configure.ac", "status": "modified", "additions": 4, "deletions": 0, "changes": 4, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/84401ce5fb4ecab55decb472b168100e7593e01f/configure.ac", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/84401ce5fb4ecab55decb472b168100e7593e01f/configure.ac", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/configure.ac?ref=84401ce5fb4ecab55decb472b168100e7593e01f", "patch": "@@ -1334,6 +1334,7 @@ if test \"${build}\" != \"${host}\" ; then\n   AR_FOR_BUILD=${AR_FOR_BUILD-ar}\n   AS_FOR_BUILD=${AS_FOR_BUILD-as}\n   CC_FOR_BUILD=${CC_FOR_BUILD-gcc}\n+  CPP_FOR_BUILD=\"${CPP_FOR_BUILD-\\$(CPP)}\"\n   CXX_FOR_BUILD=${CXX_FOR_BUILD-g++}\n   DSYMUTIL_FOR_BUILD=${DSYMUTIL_FOR_BUILD-dsymutil}\n   GFORTRAN_FOR_BUILD=${GFORTRAN_FOR_BUILD-gfortran}\n@@ -3323,6 +3324,7 @@ esac\n # our build compiler if desired.\n if test x\"${build}\" = x\"${host}\" ; then\n   CFLAGS_FOR_BUILD=${CFLAGS_FOR_BUILD-${CFLAGS}}\n+  CPPFLAGS_FOR_BUILD=${CPPFLAGS_FOR_BUILD-${CPPFLAGS}}\n   CXXFLAGS_FOR_BUILD=${CXXFLAGS_FOR_BUILD-${CXXFLAGS}}\n   LDFLAGS_FOR_BUILD=${LDFLAGS_FOR_BUILD-${LDFLAGS}}\n fi\n@@ -3389,6 +3391,8 @@ AC_SUBST(AR_FOR_BUILD)\n AC_SUBST(AS_FOR_BUILD)\n AC_SUBST(CC_FOR_BUILD)\n AC_SUBST(CFLAGS_FOR_BUILD)\n+AC_SUBST(CPP_FOR_BUILD)\n+AC_SUBST(CPPFLAGS_FOR_BUILD)\n AC_SUBST(CXXFLAGS_FOR_BUILD)\n AC_SUBST(CXX_FOR_BUILD)\n AC_SUBST(DLLTOOL_FOR_BUILD)"}, {"sha": "920868bcd33d59b1abf346c851a3f6e613638dd0", "filename": "gcc/configure", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/84401ce5fb4ecab55decb472b168100e7593e01f/gcc%2Fconfigure", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/84401ce5fb4ecab55decb472b168100e7593e01f/gcc%2Fconfigure", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fconfigure?ref=84401ce5fb4ecab55decb472b168100e7593e01f", "patch": "@@ -12769,7 +12769,7 @@ else\n \tCC=\"${CC_FOR_BUILD}\" CFLAGS=\"${CFLAGS_FOR_BUILD}\" \\\n \tCXX=\"${CXX_FOR_BUILD}\" CXXFLAGS=\"${CXXFLAGS_FOR_BUILD}\" \\\n \tLD=\"${LD_FOR_BUILD}\" LDFLAGS=\"${LDFLAGS_FOR_BUILD}\" \\\n-\tGMPINC=\"\" CPPFLAGS=\"${CPPFLAGS} -DGENERATOR_FILE\" \\\n+\tGMPINC=\"\" CPPFLAGS=\"${CPPFLAGS_FOR_BUILD} -DGENERATOR_FILE\" \\\n \t${realsrcdir}/configure \\\n \t\t--enable-languages=${enable_languages-all} \\\n \t\t${enable_obsolete+--enable-obsolete=\"$enable_obsolete\"} \\"}, {"sha": "065080a4b399a84b5e6d798a31cd10c7dc5ea61c", "filename": "gcc/configure.ac", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/84401ce5fb4ecab55decb472b168100e7593e01f/gcc%2Fconfigure.ac", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/84401ce5fb4ecab55decb472b168100e7593e01f/gcc%2Fconfigure.ac", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fconfigure.ac?ref=84401ce5fb4ecab55decb472b168100e7593e01f", "patch": "@@ -2065,7 +2065,7 @@ else\n \tCC=\"${CC_FOR_BUILD}\" CFLAGS=\"${CFLAGS_FOR_BUILD}\" \\\n \tCXX=\"${CXX_FOR_BUILD}\" CXXFLAGS=\"${CXXFLAGS_FOR_BUILD}\" \\\n \tLD=\"${LD_FOR_BUILD}\" LDFLAGS=\"${LDFLAGS_FOR_BUILD}\" \\\n-\tGMPINC=\"\" CPPFLAGS=\"${CPPFLAGS} -DGENERATOR_FILE\" \\\n+\tGMPINC=\"\" CPPFLAGS=\"${CPPFLAGS_FOR_BUILD} -DGENERATOR_FILE\" \\\n \t${realsrcdir}/configure \\\n \t\t--enable-languages=${enable_languages-all} \\\n \t\t${enable_obsolete+--enable-obsolete=\"$enable_obsolete\"} \\"}]}