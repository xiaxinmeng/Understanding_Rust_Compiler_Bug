{"sha": "acd1559a0e07edca7e130e5fbc2d230ac8ba841c", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6YWNkMTU1OWEwZTA3ZWRjYTdlMTMwZTVmYmMyZDIzMGFjOGJhODQxYw==", "commit": {"author": {"name": "Thomas Koenig", "email": "tkoenig@gcc.gnu.org", "date": "2018-04-14T13:38:41Z"}, "committer": {"name": "Thomas Koenig", "email": "tkoenig@gcc.gnu.org", "date": "2018-04-14T13:38:41Z"}, "message": "re PR fortran/85387 (incorrect output with optimization /= 0)\n\n2018-04-14  Thomas Koenig  <tkoenig@gcc.gnu.org>\n\n\tPR fortran/85387\n\t* frontend-passes.c (traverse_io_block): Check for start, end or\n\tstride being defined by an outer implied DO loop.\n\n2018-04-14  Thomas Koenig  <tkoenig@gcc.gnu.org>\n\n\tPR fortran/85387\n\t* gfortran.dg/implied_do_io_5.f90: New test.\n\nFrom-SVN: r259384", "tree": {"sha": "b09d0087989a89f838fae83355f4777bdf39ea57", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/b09d0087989a89f838fae83355f4777bdf39ea57"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/acd1559a0e07edca7e130e5fbc2d230ac8ba841c", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/acd1559a0e07edca7e130e5fbc2d230ac8ba841c", "html_url": "https://github.com/Rust-GCC/gccrs/commit/acd1559a0e07edca7e130e5fbc2d230ac8ba841c", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/acd1559a0e07edca7e130e5fbc2d230ac8ba841c/comments", "author": null, "committer": null, "parents": [{"sha": "4be91498e272b823f627097cdcb10c7f893e2942", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/4be91498e272b823f627097cdcb10c7f893e2942", "html_url": "https://github.com/Rust-GCC/gccrs/commit/4be91498e272b823f627097cdcb10c7f893e2942"}], "stats": {"total": 43, "additions": 43, "deletions": 0}, "files": [{"sha": "c6ec69e86c0c7f73daf799de09780592582c8327", "filename": "gcc/fortran/ChangeLog", "status": "modified", "additions": 6, "deletions": 0, "changes": 6, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/acd1559a0e07edca7e130e5fbc2d230ac8ba841c/gcc%2Ffortran%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/acd1559a0e07edca7e130e5fbc2d230ac8ba841c/gcc%2Ffortran%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ffortran%2FChangeLog?ref=acd1559a0e07edca7e130e5fbc2d230ac8ba841c", "patch": "@@ -1,3 +1,9 @@\n+2018-04-14  Thomas Koenig  <tkoenig@gcc.gnu.org>\n+\n+\tPR fortran/85387\n+\t* frontend-passes.c (traverse_io_block): Check for start, end or\n+\tstride being defined by an outer implied DO loop.\n+\n 2018-04-12  Thomas Koenig  <tkoenig@gcc.gnu.org>\n \n \tPR fortran/83064"}, {"sha": "40e88b1a7d4263415360049fb4d5705f865ef47c", "filename": "gcc/fortran/frontend-passes.c", "status": "modified", "additions": 17, "deletions": 0, "changes": 17, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/acd1559a0e07edca7e130e5fbc2d230ac8ba841c/gcc%2Ffortran%2Ffrontend-passes.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/acd1559a0e07edca7e130e5fbc2d230ac8ba841c/gcc%2Ffortran%2Ffrontend-passes.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ffortran%2Ffrontend-passes.c?ref=acd1559a0e07edca7e130e5fbc2d230ac8ba841c", "patch": "@@ -1237,6 +1237,23 @@ traverse_io_block (gfc_code *code, bool *has_reached, gfc_code *prev)\n \t}\n     }\n \n+  /* Check for cases like ((a(i, j), i=1, j), j=1, 2). */\n+  for (int i = 1; i < ref->u.ar.dimen; i++)\n+    {\n+      if (iters[i])\n+\t{\n+\t  gfc_expr *var = iters[i]->var;\n+\t  for (int j = i - 1; j < i; j++)\n+\t    {\n+\t      if (iters[j]\n+\t\t  && (gfc_check_dependency (var, iters[j]->start, true)\n+\t\t      || gfc_check_dependency (var, iters[j]->end, true)\n+\t\t      || gfc_check_dependency (var, iters[j]->step, true)))\n+\t\t  return false;\n+\t    }\t\t  \n+\t}\n+    }\n+\n   /* Create new expr.  */\n   new_e = gfc_copy_expr (curr->expr1);\n   new_e->expr_type = EXPR_VARIABLE;"}, {"sha": "4c9fdf7bac7f73e5c062ddf6a8d26492372061f3", "filename": "gcc/testsuite/ChangeLog", "status": "modified", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/acd1559a0e07edca7e130e5fbc2d230ac8ba841c/gcc%2Ftestsuite%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/acd1559a0e07edca7e130e5fbc2d230ac8ba841c/gcc%2Ftestsuite%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2FChangeLog?ref=acd1559a0e07edca7e130e5fbc2d230ac8ba841c", "patch": "@@ -1,3 +1,8 @@\n+2018-04-14  Thomas Koenig  <tkoenig@gcc.gnu.org>\n+\n+\tPR fortran/85387\n+\t* gfortran.dg/implied_do_io_5.f90: New test.\n+\n 2018-04-13  Paul A. Clarke  <pc@us.ibm.com>\n \n \tPR target/83402"}, {"sha": "988d0040e9184115526acc363340591cc9aa30e0", "filename": "gcc/testsuite/gfortran.dg/implied_do_io_5.f90", "status": "added", "additions": 15, "deletions": 0, "changes": 15, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/acd1559a0e07edca7e130e5fbc2d230ac8ba841c/gcc%2Ftestsuite%2Fgfortran.dg%2Fimplied_do_io_5.f90", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/acd1559a0e07edca7e130e5fbc2d230ac8ba841c/gcc%2Ftestsuite%2Fgfortran.dg%2Fimplied_do_io_5.f90", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgfortran.dg%2Fimplied_do_io_5.f90?ref=acd1559a0e07edca7e130e5fbc2d230ac8ba841c", "patch": "@@ -0,0 +1,15 @@\n+! { dg-do  run }\n+! { dg-additional-options \"-ffrontend-optimize\" }\n+! PR fortran/85387 - incorrect output\n+! Original test case by Vittorio Zecca\n+program main\n+  real :: efg_pw(2,2)\n+  character (len=80) :: c1, c2\n+  efg_pw(1,1)=1\n+  efg_pw(2,1)=2\n+  efg_pw(1,2)=3\n+  efg_pw(2,2)=4\n+  write (unit=c1,fmt='(3F12.5)') ((efg_pw(i, j), i=1, j), j=1, 2)\n+  write (unit=c2,fmt='(3F12.5)') 1.0, 3.0, 4.0\n+  if (c1 /= c2) stop 1\n+end"}]}