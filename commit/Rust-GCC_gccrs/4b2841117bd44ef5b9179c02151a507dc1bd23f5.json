{"sha": "4b2841117bd44ef5b9179c02151a507dc1bd23f5", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6NGIyODQxMTE3YmQ0NGVmNWI5MTc5YzAyMTUxYTUwN2RjMWJkMjNmNQ==", "commit": {"author": {"name": "Jakub Jelinek", "email": "jakub@redhat.com", "date": "2005-04-05T20:10:13Z"}, "committer": {"name": "Jakub Jelinek", "email": "jakub@gcc.gnu.org", "date": "2005-04-05T20:10:13Z"}, "message": "re PR tree-optimization/20076 (__builtin_return(__builtin_apply()) inlined incorrectly)\n\n\tPR tree-optimization/20076\n\t* tree-inline.c (inline_forbidden_p_1): Prevent inlining functions\n\tthat call __builtin_return or __builtin_apply_args.\n\n\t* gcc.dg/builtin-apply4.c: New test.\n\nFrom-SVN: r97653", "tree": {"sha": "d987044d0ed96299195ed52d4533e2376afd67de", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/d987044d0ed96299195ed52d4533e2376afd67de"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/4b2841117bd44ef5b9179c02151a507dc1bd23f5", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/4b2841117bd44ef5b9179c02151a507dc1bd23f5", "html_url": "https://github.com/Rust-GCC/gccrs/commit/4b2841117bd44ef5b9179c02151a507dc1bd23f5", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/4b2841117bd44ef5b9179c02151a507dc1bd23f5/comments", "author": {"login": "jakubjelinek", "id": 9370665, "node_id": "MDQ6VXNlcjkzNzA2NjU=", "avatar_url": "https://avatars.githubusercontent.com/u/9370665?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jakubjelinek", "html_url": "https://github.com/jakubjelinek", "followers_url": "https://api.github.com/users/jakubjelinek/followers", "following_url": "https://api.github.com/users/jakubjelinek/following{/other_user}", "gists_url": "https://api.github.com/users/jakubjelinek/gists{/gist_id}", "starred_url": "https://api.github.com/users/jakubjelinek/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jakubjelinek/subscriptions", "organizations_url": "https://api.github.com/users/jakubjelinek/orgs", "repos_url": "https://api.github.com/users/jakubjelinek/repos", "events_url": "https://api.github.com/users/jakubjelinek/events{/privacy}", "received_events_url": "https://api.github.com/users/jakubjelinek/received_events", "type": "User", "site_admin": false}, "committer": null, "parents": [{"sha": "cae064e7982fb1a9f7e2fd8208e83199786aa39c", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/cae064e7982fb1a9f7e2fd8208e83199786aa39c", "html_url": "https://github.com/Rust-GCC/gccrs/commit/cae064e7982fb1a9f7e2fd8208e83199786aa39c"}], "stats": {"total": 50, "additions": 50, "deletions": 0}, "files": [{"sha": "f9034674f747f6f952b9f99fc0fb0710700eb4a5", "filename": "gcc/ChangeLog", "status": "modified", "additions": 6, "deletions": 0, "changes": 6, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/4b2841117bd44ef5b9179c02151a507dc1bd23f5/gcc%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/4b2841117bd44ef5b9179c02151a507dc1bd23f5/gcc%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2FChangeLog?ref=4b2841117bd44ef5b9179c02151a507dc1bd23f5", "patch": "@@ -1,3 +1,9 @@\n+2005-04-05  Jakub Jelinek  <jakub@redhat.com>\n+\n+\tPR tree-optimization/20076\n+\t* tree-inline.c (inline_forbidden_p_1): Prevent inlining functions\n+\tthat call __builtin_return or __builtin_apply_args.\n+\n 2005-04-05  Andrew MacLeod  <amacleod@redhat.com>\n \n \t* lambda-code.c (lambda_loopnest_to_gcc_loopnest): Use update_stmt."}, {"sha": "79bfe2300b56e3811cd5b257d97b0df7dde64ad5", "filename": "gcc/testsuite/ChangeLog", "status": "modified", "additions": 3, "deletions": 0, "changes": 3, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/4b2841117bd44ef5b9179c02151a507dc1bd23f5/gcc%2Ftestsuite%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/4b2841117bd44ef5b9179c02151a507dc1bd23f5/gcc%2Ftestsuite%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2FChangeLog?ref=4b2841117bd44ef5b9179c02151a507dc1bd23f5", "patch": "@@ -1,5 +1,8 @@\n 2005-04-05  Jakub Jelinek  <jakub@redhat.com>\n \n+\tPR tree-optimization/20076\n+\t* gcc.dg/builtin-apply4.c: New test.\n+\n \tPR preprocessor/19475\n \t* gcc.dg/cpp/macspace1.c: New test.\n \t* gcc.dg/cpp/macspace2.c: New test."}, {"sha": "289694e3c1bb8a4dc7b2572c30563eb55adc505e", "filename": "gcc/testsuite/gcc.dg/builtin-apply4.c", "status": "added", "additions": 30, "deletions": 0, "changes": 30, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/4b2841117bd44ef5b9179c02151a507dc1bd23f5/gcc%2Ftestsuite%2Fgcc.dg%2Fbuiltin-apply4.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/4b2841117bd44ef5b9179c02151a507dc1bd23f5/gcc%2Ftestsuite%2Fgcc.dg%2Fbuiltin-apply4.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgcc.dg%2Fbuiltin-apply4.c?ref=4b2841117bd44ef5b9179c02151a507dc1bd23f5", "patch": "@@ -0,0 +1,30 @@\n+/* PR tree-optimization/20076 */\n+/* { dg-options \"-O2\" } */\n+/* { dg-do run } */\n+\n+extern void abort (void);\n+\n+double\n+foo (int arg)\n+{\n+  if (arg != 116)\n+    abort();\n+  return arg + 1;\n+}\n+\n+inline double\n+bar (int arg)\n+{\n+  foo (arg);\n+  __builtin_return (__builtin_apply ((void (*) ()) foo,\n+\t\t\t\t     __builtin_apply_args (), 16));\n+}\n+\n+int\n+main (int argc, char **argv)\n+{\n+  if (bar (116) != 117.0)\n+    abort ();\n+\n+  return 0;\n+}"}, {"sha": "efa6e310e98010bfd6411efac691da02ff8e6e47", "filename": "gcc/tree-inline.c", "status": "modified", "additions": 11, "deletions": 0, "changes": 11, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/4b2841117bd44ef5b9179c02151a507dc1bd23f5/gcc%2Ftree-inline.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/4b2841117bd44ef5b9179c02151a507dc1bd23f5/gcc%2Ftree-inline.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftree-inline.c?ref=4b2841117bd44ef5b9179c02151a507dc1bd23f5", "patch": "@@ -1017,6 +1017,17 @@ inline_forbidden_p_1 (tree *nodep, int *walk_subtrees ATTRIBUTE_UNUSED,\n \t\t   \"it uses non-local goto\");\n \t    return node;\n \n+\t  case BUILT_IN_RETURN:\n+\t  case BUILT_IN_APPLY_ARGS:\n+\t    /* If a __builtin_apply_args caller would be inlined,\n+\t       it would be saving arguments of the function it has\n+\t       been inlined into.  Similarly __builtin_return would\n+\t       return from the function the inline has been inlined into.  */\n+\t    inline_forbidden_reason\n+\t      = N_(\"%Jfunction %qF can never be inlined because \"\n+\t\t   \"it uses __builtin_return or __builtin_apply_args\");\n+\t    return node;\n+\n \t  default:\n \t    break;\n \t  }"}]}