{"sha": "c130ab6aad57e0309ec02f58f383aece584ac8cb", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6YzEzMGFiNmFhZDU3ZTAzMDllYzAyZjU4ZjM4M2FlY2U1ODRhYzhjYg==", "commit": {"author": {"name": "Ian Lance Taylor", "email": "ian@gcc.gnu.org", "date": "2019-05-11T01:12:37Z"}, "committer": {"name": "Ian Lance Taylor", "email": "ian@gcc.gnu.org", "date": "2019-05-11T01:12:37Z"}, "message": "runtime: set up g early\n    \n    runtime.throw needs a g to work properly. Set up g early, to\n    ensure that if something goes wrong in the runtime startup (e.g.\n    runtime.check fails), the program terminates in a reasonable way.\n    \n    Reviewed-on: https://go-review.googlesource.com/c/gofrontend/+/176657\n\nFrom-SVN: r271088", "tree": {"sha": "0a5fd2bf4f6ad9b59a03ff33d2758937064fc015", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/0a5fd2bf4f6ad9b59a03ff33d2758937064fc015"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/c130ab6aad57e0309ec02f58f383aece584ac8cb", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/c130ab6aad57e0309ec02f58f383aece584ac8cb", "html_url": "https://github.com/Rust-GCC/gccrs/commit/c130ab6aad57e0309ec02f58f383aece584ac8cb", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/c130ab6aad57e0309ec02f58f383aece584ac8cb/comments", "author": null, "committer": null, "parents": [{"sha": "d7b9b0805d5ab514c43e1fe57e43a10394d5d965", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/d7b9b0805d5ab514c43e1fe57e43a10394d5d965", "html_url": "https://github.com/Rust-GCC/gccrs/commit/d7b9b0805d5ab514c43e1fe57e43a10394d5d965"}], "stats": {"total": 24, "additions": 16, "deletions": 8}, "files": [{"sha": "a3acadd42595acfe244e8eaa6be319b5e8eb951a", "filename": "gcc/go/gofrontend/MERGE", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/c130ab6aad57e0309ec02f58f383aece584ac8cb/gcc%2Fgo%2Fgofrontend%2FMERGE", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/c130ab6aad57e0309ec02f58f383aece584ac8cb/gcc%2Fgo%2Fgofrontend%2FMERGE", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fgo%2Fgofrontend%2FMERGE?ref=c130ab6aad57e0309ec02f58f383aece584ac8cb", "patch": "@@ -1,4 +1,4 @@\n-76ab85364745e445498fe53f9ca8e37b49650779\n+5c2c4743980556c041561533ef31762f524737ca\n \n The first line of this file holds the git revision number of the last\n merge done from the gofrontend repository."}, {"sha": "b40198e9d3e07d4211d72271d37d802c16a76570", "filename": "libgo/go/runtime/proc.go", "status": "modified", "additions": 11, "deletions": 7, "changes": 18, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/c130ab6aad57e0309ec02f58f383aece584ac8cb/libgo%2Fgo%2Fruntime%2Fproc.go", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/c130ab6aad57e0309ec02f58f383aece584ac8cb/libgo%2Fgo%2Fruntime%2Fproc.go", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libgo%2Fgo%2Fruntime%2Fproc.go?ref=c130ab6aad57e0309ec02f58f383aece584ac8cb", "patch": "@@ -18,6 +18,7 @@ import (\n //go:linkname acquirep runtime.acquirep\n //go:linkname releasep runtime.releasep\n //go:linkname incidlelocked runtime.incidlelocked\n+//go:linkname ginit runtime.ginit\n //go:linkname schedinit runtime.schedinit\n //go:linkname ready runtime.ready\n //go:linkname stopm runtime.stopm\n@@ -515,6 +516,15 @@ func cpuinit() {\n \tcpu.Initialize(env)\n }\n \n+func ginit() {\n+\t_m_ := &m0\n+\t_g_ := &g0\n+\t_m_.g0 = _g_\n+\t_m_.curg = _g_\n+\t_g_.m = _m_\n+\tsetg(_g_)\n+}\n+\n // The bootstrap sequence is:\n //\n //\tcall osinit\n@@ -524,13 +534,7 @@ func cpuinit() {\n //\n // The new G calls runtime\u00b7main.\n func schedinit() {\n-\t_m_ := &m0\n-\t_g_ := &g0\n-\t_m_.g0 = _g_\n-\t_m_.curg = _g_\n-\t_g_.m = _m_\n-\tsetg(_g_)\n-\n+\t_g_ := getg()\n \tsched.maxmcount = 10000\n \n \tusestackmaps = probestackmaps()"}, {"sha": "8b5bab09ac7683a38284fb5c5455f5f5cb25a3c3", "filename": "libgo/runtime/go-libmain.c", "status": "modified", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/c130ab6aad57e0309ec02f58f383aece584ac8cb/libgo%2Fruntime%2Fgo-libmain.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/c130ab6aad57e0309ec02f58f383aece584ac8cb/libgo%2Fruntime%2Fgo-libmain.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libgo%2Fruntime%2Fgo-libmain.c?ref=c130ab6aad57e0309ec02f58f383aece584ac8cb", "patch": "@@ -225,6 +225,7 @@ gostart (void *arg)\n     return NULL;\n   runtime_isstarted = true;\n \n+  runtime_ginit ();\n   runtime_check ();\n   runtime_args (a->argc, (byte **) a->argv);\n   setncpu (getproccount ());"}, {"sha": "e9da8aca9cc0bab56a9442db7231a1d4dc5331f8", "filename": "libgo/runtime/go-main.c", "status": "modified", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/c130ab6aad57e0309ec02f58f383aece584ac8cb/libgo%2Fruntime%2Fgo-main.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/c130ab6aad57e0309ec02f58f383aece584ac8cb/libgo%2Fruntime%2Fgo-main.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libgo%2Fruntime%2Fgo-main.c?ref=c130ab6aad57e0309ec02f58f383aece584ac8cb", "patch": "@@ -48,6 +48,7 @@ main (int argc, char **argv)\n     setIsCgo ();\n \n   __go_end = (uintptr)_end;\n+  runtime_ginit ();\n   runtime_cpuinit ();\n   runtime_check ();\n   runtime_args (argc, (byte **) argv);"}, {"sha": "9506e3dec80dc1e63ccb6acbd44e0eeac9422eaf", "filename": "libgo/runtime/runtime.h", "status": "modified", "additions": 2, "deletions": 0, "changes": 2, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/c130ab6aad57e0309ec02f58f383aece584ac8cb/libgo%2Fruntime%2Fruntime.h", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/c130ab6aad57e0309ec02f58f383aece584ac8cb/libgo%2Fruntime%2Fruntime.h", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libgo%2Fruntime%2Fruntime.h?ref=c130ab6aad57e0309ec02f58f383aece584ac8cb", "patch": "@@ -240,6 +240,8 @@ int32\truntime_snprintf(byte*, int32, const char*, ...);\n #define runtime_memmove(a, b, s) __builtin_memmove((a), (b), (s))\n String\truntime_gostringnocopy(const byte*)\n   __asm__ (GOSYM_PREFIX \"runtime.gostringnocopy\");\n+void\truntime_ginit(void)\n+  __asm__ (GOSYM_PREFIX \"runtime.ginit\");\n void\truntime_schedinit(void)\n   __asm__ (GOSYM_PREFIX \"runtime.schedinit\");\n void\truntime_initsig(bool)"}]}