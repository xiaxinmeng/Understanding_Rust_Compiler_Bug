{"sha": "94d342534efdfcdbc6410c9247ec81a2c13217e9", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6OTRkMzQyNTM0ZWZkZmNkYmM2NDEwYzkyNDdlYzgxYTJjMTMyMTdlOQ==", "commit": {"author": {"name": "Bud Davis", "email": "bdavis9659@sbcglobal.net", "date": "2009-08-23T02:19:59Z"}, "committer": {"name": "Bud Davis", "email": "bdavis@gcc.gnu.org", "date": "2009-08-23T02:19:59Z"}, "message": "[multiple changes]\n\n2009-08-22\tBud Davis <bdavis9659@sbcglobal.net>\n\n\tPR fortran/28093\n\t* io.c : added variable to store original len of fmt\n\t* io.c (check_format): Consume H items using next_char\n\tin both modes to handle consecutive single quotes.\n\tTest for extra characters in fmt, issue warning.\n\n2009-08-22  Bud Davis  <bdavis9659@sbcglobal.net>\n\n\tPR fortran/28039\n\t* gfortran.dg/fmt_with_extra.f: new file.\n\nFrom-SVN: r151021", "tree": {"sha": "4032a03228b4ac5fe80f18a30191578d2628277d", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/4032a03228b4ac5fe80f18a30191578d2628277d"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/94d342534efdfcdbc6410c9247ec81a2c13217e9", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/94d342534efdfcdbc6410c9247ec81a2c13217e9", "html_url": "https://github.com/Rust-GCC/gccrs/commit/94d342534efdfcdbc6410c9247ec81a2c13217e9", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/94d342534efdfcdbc6410c9247ec81a2c13217e9/comments", "author": null, "committer": null, "parents": [{"sha": "c5e82c06a77afa7c8648b69772d7c17f02a9f27d", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/c5e82c06a77afa7c8648b69772d7c17f02a9f27d", "html_url": "https://github.com/Rust-GCC/gccrs/commit/c5e82c06a77afa7c8648b69772d7c17f02a9f27d"}], "stats": {"total": 49, "additions": 34, "deletions": 15}, "files": [{"sha": "635e68cb88bda39e7fca909ff057f66603b2cd6d", "filename": "gcc/fortran/ChangeLog", "status": "modified", "additions": 8, "deletions": 0, "changes": 8, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/94d342534efdfcdbc6410c9247ec81a2c13217e9/gcc%2Ffortran%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/94d342534efdfcdbc6410c9247ec81a2c13217e9/gcc%2Ffortran%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ffortran%2FChangeLog?ref=94d342534efdfcdbc6410c9247ec81a2c13217e9", "patch": "@@ -1,3 +1,11 @@\n+2009-08-22\tBud Davis <bdavis9659@sbcglobal.net>\n+\n+\tPR fortran/28093\n+\t* io.c : added variable to store original len of fmt\n+\t* io.c (check_format): Consume H items using next_char\n+\tin both modes to handle consecutive single quotes.\n+\tTest for extra characters in fmt, issue warning.\n+\n 2009-08-21  Janus Weil  <janus@gcc.gnu.org>\n \n \tPR fortran/41106"}, {"sha": "4f60b80db4052f8448945e4f3b6633d76be8ae4e", "filename": "gcc/fortran/io.c", "status": "modified", "additions": 14, "deletions": 15, "changes": 29, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/94d342534efdfcdbc6410c9247ec81a2c13217e9/gcc%2Ffortran%2Fio.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/94d342534efdfcdbc6410c9247ec81a2c13217e9/gcc%2Ffortran%2Fio.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ffortran%2Fio.c?ref=94d342534efdfcdbc6410c9247ec81a2c13217e9", "patch": "@@ -121,6 +121,7 @@ format_token;\n static gfc_char_t *format_string;\n static int format_string_pos;\n static int format_length, use_last_char;\n+static int starting_format_length;\n static char error_element;\n static locus format_locus;\n \n@@ -875,20 +876,11 @@ check_format (bool is_input)\n \t  gfc_warning (\"The H format specifier at %L is\"\n \t\t       \" a Fortran 95 deleted feature\", &format_locus);\n \t}\n-\n-      if (mode == MODE_STRING)\n-\t{\n-\t  format_string += value;\n-\t  format_length -= value;\n-\t}\n-      else\n-\t{\n-\t  while (repeat >0)\n-\t   {\n-\t     next_char (1);\n-\t     repeat -- ;\n-\t   }\n-\t}\n+      while (repeat >0)\n+       {\n+          next_char (1);\n+          repeat -- ;\n+       }\n      break;\n \n     case FMT_IBOZ:\n@@ -1039,6 +1031,13 @@ check_format (bool is_input)\n   rv = FAILURE;\n \n finished:\n+  /* check for extraneous characters at end of valid format string */\n+  if ( starting_format_length > format_length )\n+    {\n+       format_locus.nextc += format_length + 1; /* point to the extra */\n+       gfc_warning (\"Extraneous characters in format at %L\", &format_locus); \n+    }\n+    \n   return rv;\n }\n \n@@ -1054,7 +1053,7 @@ check_format_string (gfc_expr *e, bool is_input)\n \n   mode = MODE_STRING;\n   format_string = e->value.character.string;\n-\n+  starting_format_length = e->value.character.length;\n   /* More elaborate measures are needed to show where a problem is within a\n      format string that has been calculated, but that's probably not worth the\n      effort.  */"}, {"sha": "8e60e36d31758699e2c4abf4b894836a13abdd96", "filename": "gcc/testsuite/ChangeLog", "status": "modified", "additions": 4, "deletions": 0, "changes": 4, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/94d342534efdfcdbc6410c9247ec81a2c13217e9/gcc%2Ftestsuite%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/94d342534efdfcdbc6410c9247ec81a2c13217e9/gcc%2Ftestsuite%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2FChangeLog?ref=94d342534efdfcdbc6410c9247ec81a2c13217e9", "patch": "@@ -1,3 +1,7 @@\n+2009-08-22  Bud Davis  <bdavis9659@sbcglobal.net>\n+\n+\tPR fortran/28039\n+\t* gfortran.dg/fmt_with_extra.f: new file.\n 2009-08-21  Maciej W. Rozycki  <macro@codesourcery.com>\n \n \t* lib/target-supports.exp"}, {"sha": "45664be906f996d7831cc81ac7e66598a552543b", "filename": "gcc/testsuite/gfortran.dg/fmt_with_extra.f", "status": "added", "additions": 8, "deletions": 0, "changes": 8, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/94d342534efdfcdbc6410c9247ec81a2c13217e9/gcc%2Ftestsuite%2Fgfortran.dg%2Ffmt_with_extra.f", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/94d342534efdfcdbc6410c9247ec81a2c13217e9/gcc%2Ftestsuite%2Fgfortran.dg%2Ffmt_with_extra.f", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgfortran.dg%2Ffmt_with_extra.f?ref=94d342534efdfcdbc6410c9247ec81a2c13217e9", "patch": "@@ -0,0 +1,8 @@\n+! { dg-do compile }\n+! test case contributed by tobias.burnus@physik.fu-berlin.de\n+! PR28039 Warn when ignoring extra characters in the format specification\n+       implicit none\n+       real :: r\n+       r = 1.0\n+       write(*,'(a),f)') 'Hello', r   !{ dg-warning \"Extraneous characters in format at\" }\n+       end"}]}