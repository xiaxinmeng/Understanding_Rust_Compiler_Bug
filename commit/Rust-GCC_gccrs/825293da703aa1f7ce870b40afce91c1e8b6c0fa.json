{"sha": "825293da703aa1f7ce870b40afce91c1e8b6c0fa", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6ODI1MjkzZGE3MDNhYTFmN2NlODcwYjQwYWZjZTkxYzFlOGI2YzBmYQ==", "commit": {"author": {"name": "Martin Sebor", "email": "msebor@redhat.com", "date": "2021-09-19T23:18:48Z"}, "committer": {"name": "Martin Sebor", "email": "msebor@redhat.com", "date": "2021-09-19T23:23:19Z"}, "message": "Correct a function pre/postcondition [PR102403].\n\nResolves:\nPR middle-end/102403 - ICE in init_from_control_deps, at gimple-predicate-analysis.cc:2364\n\ngcc/ChangeLog:\n\tPR middle-end/102403\n\t* gimple-predicate-analysis.cc (predicate::init_from_control_deps):\n\tCorrect a function pre/postcondition.\n\ngcc/testsuite/ChangeLog:\n\tPR middle-end/102403\n\t* gcc.dg/uninit-pr102403.c: New test.\n\t* gcc.dg/uninit-pr102403-c2.c: New test.", "tree": {"sha": "419171fefd734ad0827c7dc6c45fe2e4fa111e57", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/419171fefd734ad0827c7dc6c45fe2e4fa111e57"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/825293da703aa1f7ce870b40afce91c1e8b6c0fa", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/825293da703aa1f7ce870b40afce91c1e8b6c0fa", "html_url": "https://github.com/Rust-GCC/gccrs/commit/825293da703aa1f7ce870b40afce91c1e8b6c0fa", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/825293da703aa1f7ce870b40afce91c1e8b6c0fa/comments", "author": {"login": "msebor", "id": 381149, "node_id": "MDQ6VXNlcjM4MTE0OQ==", "avatar_url": "https://avatars.githubusercontent.com/u/381149?v=4", "gravatar_id": "", "url": "https://api.github.com/users/msebor", "html_url": "https://github.com/msebor", "followers_url": "https://api.github.com/users/msebor/followers", "following_url": "https://api.github.com/users/msebor/following{/other_user}", "gists_url": "https://api.github.com/users/msebor/gists{/gist_id}", "starred_url": "https://api.github.com/users/msebor/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/msebor/subscriptions", "organizations_url": "https://api.github.com/users/msebor/orgs", "repos_url": "https://api.github.com/users/msebor/repos", "events_url": "https://api.github.com/users/msebor/events{/privacy}", "received_events_url": "https://api.github.com/users/msebor/received_events", "type": "User", "site_admin": false}, "committer": {"login": "msebor", "id": 381149, "node_id": "MDQ6VXNlcjM4MTE0OQ==", "avatar_url": "https://avatars.githubusercontent.com/u/381149?v=4", "gravatar_id": "", "url": "https://api.github.com/users/msebor", "html_url": "https://github.com/msebor", "followers_url": "https://api.github.com/users/msebor/followers", "following_url": "https://api.github.com/users/msebor/following{/other_user}", "gists_url": "https://api.github.com/users/msebor/gists{/gist_id}", "starred_url": "https://api.github.com/users/msebor/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/msebor/subscriptions", "organizations_url": "https://api.github.com/users/msebor/orgs", "repos_url": "https://api.github.com/users/msebor/repos", "events_url": "https://api.github.com/users/msebor/events{/privacy}", "received_events_url": "https://api.github.com/users/msebor/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "c3895ef466f3068cac6f5c18b55716f494484917", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/c3895ef466f3068cac6f5c18b55716f494484917", "html_url": "https://github.com/Rust-GCC/gccrs/commit/c3895ef466f3068cac6f5c18b55716f494484917"}], "stats": {"total": 89, "additions": 88, "deletions": 1}, "files": [{"sha": "f0c84446194199690be790c30f853b1d471f5ea4", "filename": "gcc/gimple-predicate-analysis.cc", "status": "modified", "additions": 5, "deletions": 1, "changes": 6, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/825293da703aa1f7ce870b40afce91c1e8b6c0fa/gcc%2Fgimple-predicate-analysis.cc", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/825293da703aa1f7ce870b40afce91c1e8b6c0fa/gcc%2Fgimple-predicate-analysis.cc", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fgimple-predicate-analysis.cc?ref=825293da703aa1f7ce870b40afce91c1e8b6c0fa", "patch": "@@ -2361,7 +2361,11 @@ predicate::init_from_control_deps (const vec<edge> *dep_chains,\n       dump (NULL, \"\");\n     }\n \n-  gcc_assert (has_valid_pred == (m_preds.length () > 0));\n+  if (has_valid_pred)\n+    gcc_assert (m_preds.length () != 0);\n+  else\n+    /* Clear M_PREDS to indicate failure.  */\n+    m_preds.release ();\n }\n \n /* Return the predicate expression guarding the definition of"}, {"sha": "81811432da577437e1c57804b3fb522ccb3a2c87", "filename": "gcc/testsuite/gcc.dg/uninit-pr102403-c2.c", "status": "added", "additions": 34, "deletions": 0, "changes": 34, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/825293da703aa1f7ce870b40afce91c1e8b6c0fa/gcc%2Ftestsuite%2Fgcc.dg%2Funinit-pr102403-c2.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/825293da703aa1f7ce870b40afce91c1e8b6c0fa/gcc%2Ftestsuite%2Fgcc.dg%2Funinit-pr102403-c2.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgcc.dg%2Funinit-pr102403-c2.c?ref=825293da703aa1f7ce870b40afce91c1e8b6c0fa", "patch": "@@ -0,0 +1,34 @@\n+/* PR middle-end/102403 - ICE in init_from_control_deps, at\n+   gimple-predicate-analysis.cc:2364\n+   { dg-do compile }\n+   { dg-options \"-O2 -Wall\" } */\n+\n+extern int a[], b, c, d, e, f, g, h;\n+\n+inline void foo (void) { b = 1 ^ a[b ^ (c & 1)]; }\n+\n+void bar (void);\n+\n+int main (void)\n+{\n+  if (!f && ~h)\n+    {\n+      if (g)\n+\tgoto L2;\n+    }\n+  else\n+    {\n+      int m = 0;              // { dg-message \"declared here\" }\n+    L1:\n+      e = m;\n+    L2:\n+      m ^= 1;                 // { dg-warning \"-Wmaybe-uninitialized\" }\n+      if (d)\n+\tbar ();\n+\n+      for (int j = 0; j < 10; j++)\n+\tfoo ();\n+\n+      goto L1;\n+    }\n+}"}, {"sha": "1e62e988fd64c2daf62c5a440ea846b69f1febb9", "filename": "gcc/testsuite/gcc.dg/uninit-pr102403.c", "status": "added", "additions": 49, "deletions": 0, "changes": 49, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/825293da703aa1f7ce870b40afce91c1e8b6c0fa/gcc%2Ftestsuite%2Fgcc.dg%2Funinit-pr102403.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/825293da703aa1f7ce870b40afce91c1e8b6c0fa/gcc%2Ftestsuite%2Fgcc.dg%2Funinit-pr102403.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgcc.dg%2Funinit-pr102403.c?ref=825293da703aa1f7ce870b40afce91c1e8b6c0fa", "patch": "@@ -0,0 +1,49 @@\n+/* PR middle-end/102403 - ICE in init_from_control_deps, at\n+   gimple-predicate-analysis.cc:2364\n+   { dg-do compile }\n+   { dg-options \"-O2 -Wall\" } */\n+\n+int __fmaf (void)\n+{\n+  int a = 0;\n+  int b, c, d, e, f;\n+\n+  int r = 0;\n+\n+  switch (b)        // { dg-warning \"-Wuninitialized\" }\n+    {\n+    default:\n+      c |= 1;\n+\n+    case 0:\n+      if (c == 0)\n+\ta = 1;\n+\n+      switch (d) {\n+      case 15:\n+\tf = c;\n+\tbreak;\n+\n+      case 11:\n+      case 6:\n+      case 4:\n+\tf = c;\n+      case 10:\n+\te = a;\n+      }\n+\n+      if (e == 0)   // { dg-warning \"-Wmaybe-uninitialized\" }\n+  \tf = 0;\n+\n+      r = f;\n+  }\n+\n+  // The return statement below gets the unhelpful warning:\n+  // 'f' may be used uninitialized in this function [-Wmaybe-uninitialized]\n+  return r;\n+}\n+\n+/* Prune out warnings issued on the wrong lines, such as:\n+   uninit-pr102403.c:9:13: warning: \u2018d\u2019 is used uninitialized [-Wuninitialized]\n+   { dg-prune-output \"-Wuninitialized\" }\n+   { dg-prune-output \"-Wmaybe-uninitialized\" } */"}]}