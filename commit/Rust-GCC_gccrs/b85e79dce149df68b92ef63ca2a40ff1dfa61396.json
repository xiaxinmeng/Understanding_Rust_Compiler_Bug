{"sha": "b85e79dce149df68b92ef63ca2a40ff1dfa61396", "node_id": "C_kwDOANBUbNoAKGI4NWU3OWRjZTE0OWRmNjhiOTJlZjYzY2EyYTQwZmYxZGZhNjEzOTY", "commit": {"author": {"name": "Jakub Jelinek", "email": "jakub@redhat.com", "date": "2022-04-28T13:45:33Z"}, "committer": {"name": "Jakub Jelinek", "email": "jakub@redhat.com", "date": "2022-04-28T13:45:33Z"}, "message": "cgraph: Don't verify semantic_interposition flag for aliases [PR105399]\n\nThe following testcase ICEs, because the ctors during cc1plus all have\n!opt_for_fn (decl, flag_semantic_interposition) - they have NULL\nDECL_FUNCTION_SPECIFIC_OPTIMIZATION (decl) and optimization_default_node\nis for -Ofast and so has flag_semantic_interposition cleared.\nDuring free lang data, we set DECL_FUNCTION_SPECIFIC_OPTIMIZATION (decl)\nfor the ctor which has body (or for thunks), but don't touch it for\naliases.\nDuring lto1 optimization_default_node reflects the lto1 flags which\nare -O2 rather than -Ofast and so has flag_semantic_interposition\nset, for the ctor which has body that makes no difference, but as the\nalias doesn't still have DECL_FUNCTION_SPECIFIC_OPTIMIZATION (decl) set,\nwe now trigger this verification check.\n\nThe following patch just doesn't verify it for aliases during lto1.\nAnother possibility would be to set DECL_FUNCTION_SPECIFIC_OPTIMIZATION (decl)\nduring free lang data even for aliases.\n\n2022-04-28  Jakub Jelinek  <jakub@redhat.com>\n\n\tPR lto/105399\n\t* cgraph.cc (cgraph_node::verify_node): Don't verify\n\tsemantic_interposition flag against\n\topt_for_fn (decl, flag_semantic_interposition) for aliases in lto1.\n\n\t* g++.dg/lto/pr105399_0.C: New test.", "tree": {"sha": "c7ea3350f2e4ee42c2024dd513537d65500cc32e", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/c7ea3350f2e4ee42c2024dd513537d65500cc32e"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/b85e79dce149df68b92ef63ca2a40ff1dfa61396", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/b85e79dce149df68b92ef63ca2a40ff1dfa61396", "html_url": "https://github.com/Rust-GCC/gccrs/commit/b85e79dce149df68b92ef63ca2a40ff1dfa61396", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/b85e79dce149df68b92ef63ca2a40ff1dfa61396/comments", "author": {"login": "jakubjelinek", "id": 9370665, "node_id": "MDQ6VXNlcjkzNzA2NjU=", "avatar_url": "https://avatars.githubusercontent.com/u/9370665?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jakubjelinek", "html_url": "https://github.com/jakubjelinek", "followers_url": "https://api.github.com/users/jakubjelinek/followers", "following_url": "https://api.github.com/users/jakubjelinek/following{/other_user}", "gists_url": "https://api.github.com/users/jakubjelinek/gists{/gist_id}", "starred_url": "https://api.github.com/users/jakubjelinek/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jakubjelinek/subscriptions", "organizations_url": "https://api.github.com/users/jakubjelinek/orgs", "repos_url": "https://api.github.com/users/jakubjelinek/repos", "events_url": "https://api.github.com/users/jakubjelinek/events{/privacy}", "received_events_url": "https://api.github.com/users/jakubjelinek/received_events", "type": "User", "site_admin": false}, "committer": {"login": "jakubjelinek", "id": 9370665, "node_id": "MDQ6VXNlcjkzNzA2NjU=", "avatar_url": "https://avatars.githubusercontent.com/u/9370665?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jakubjelinek", "html_url": "https://github.com/jakubjelinek", "followers_url": "https://api.github.com/users/jakubjelinek/followers", "following_url": "https://api.github.com/users/jakubjelinek/following{/other_user}", "gists_url": "https://api.github.com/users/jakubjelinek/gists{/gist_id}", "starred_url": "https://api.github.com/users/jakubjelinek/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jakubjelinek/subscriptions", "organizations_url": "https://api.github.com/users/jakubjelinek/orgs", "repos_url": "https://api.github.com/users/jakubjelinek/repos", "events_url": "https://api.github.com/users/jakubjelinek/events{/privacy}", "received_events_url": "https://api.github.com/users/jakubjelinek/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "2a570f11a2fecf23998d7fe1d5cabad62cfe5cec", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/2a570f11a2fecf23998d7fe1d5cabad62cfe5cec", "html_url": "https://github.com/Rust-GCC/gccrs/commit/2a570f11a2fecf23998d7fe1d5cabad62cfe5cec"}], "stats": {"total": 15, "additions": 14, "deletions": 1}, "files": [{"sha": "0159eaa768b5394e9d4fc2827a80d4f17777a8b6", "filename": "gcc/cgraph.cc", "status": "modified", "additions": 5, "deletions": 1, "changes": 6, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/b85e79dce149df68b92ef63ca2a40ff1dfa61396/gcc%2Fcgraph.cc", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/b85e79dce149df68b92ef63ca2a40ff1dfa61396/gcc%2Fcgraph.cc", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fcgraph.cc?ref=b85e79dce149df68b92ef63ca2a40ff1dfa61396", "patch": "@@ -3488,7 +3488,11 @@ cgraph_node::verify_node (void)\n \t     \"returns a pointer\");\n       error_found = true;\n     }\n-  if (definition && externally_visible\n+  if (definition\n+      && externally_visible\n+      /* For aliases in lto1 free_lang_data doesn't guarantee preservation\n+\t of opt_for_fn (decl, flag_semantic_interposition).  See PR105399.  */\n+      && (!alias || !in_lto_p)\n       && semantic_interposition\n \t != opt_for_fn (decl, flag_semantic_interposition))\n     {"}, {"sha": "fc9149a7aa2d6110207bdb71e7bbbd42c13a04bf", "filename": "gcc/testsuite/g++.dg/lto/pr105399_0.C", "status": "added", "additions": 9, "deletions": 0, "changes": 9, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/b85e79dce149df68b92ef63ca2a40ff1dfa61396/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Flto%2Fpr105399_0.C", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/b85e79dce149df68b92ef63ca2a40ff1dfa61396/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Flto%2Fpr105399_0.C", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Flto%2Fpr105399_0.C?ref=b85e79dce149df68b92ef63ca2a40ff1dfa61396", "patch": "@@ -0,0 +1,9 @@\n+// PR lto/105399\n+// { dg-lto-do link }\n+// { dg-lto-options { { -fPIC -flto -Ofast } } }\n+// { dg-require-effective-target shared }\n+// { dg-require-effective-target fpic }\n+// { dg-extra-ld-options \"-shared -O2\" }\n+\n+struct S { S (); };\n+S::S () {}"}]}