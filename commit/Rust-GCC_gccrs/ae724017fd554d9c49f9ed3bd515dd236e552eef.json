{"sha": "ae724017fd554d9c49f9ed3bd515dd236e552eef", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6YWU3MjQwMTdmZDU1NGQ5YzQ5ZjllZDNiZDUxNWRkMjM2ZTU1MmVlZg==", "commit": {"author": {"name": "Jeff Sturm", "email": "jsturm@one-point.com", "date": "2003-01-30T23:20:45Z"}, "committer": {"name": "Jeff Sturm", "email": "jsturm@gcc.gnu.org", "date": "2003-01-30T23:20:45Z"}, "message": "natClass.cc (initializeClass): Check tables when (state == JV_STATE_IN_PROGRESS).\n\n* java/lang/natClass.cc (initializeClass): Check tables when\n(state == JV_STATE_IN_PROGRESS).\n(_Jv_GetInterfaces): Use _Jv_WaitForState to link interface.\n* java/lang/natClassLoader.cc (_Jv_WaitForState): Handle\ninterpreted classes.\n(linkClass0): Use _Jv_WaitForState.\n\nFrom-SVN: r62161", "tree": {"sha": "68e1ce35ce8786bd229d9f2d6e91343074b4bcb2", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/68e1ce35ce8786bd229d9f2d6e91343074b4bcb2"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/ae724017fd554d9c49f9ed3bd515dd236e552eef", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/ae724017fd554d9c49f9ed3bd515dd236e552eef", "html_url": "https://github.com/Rust-GCC/gccrs/commit/ae724017fd554d9c49f9ed3bd515dd236e552eef", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/ae724017fd554d9c49f9ed3bd515dd236e552eef/comments", "author": null, "committer": null, "parents": [{"sha": "ccf9f10cc3b4e371c34a01b3210b9e3bed0a8868", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/ccf9f10cc3b4e371c34a01b3210b9e3bed0a8868", "html_url": "https://github.com/Rust-GCC/gccrs/commit/ccf9f10cc3b4e371c34a01b3210b9e3bed0a8868"}], "stats": {"total": 41, "additions": 31, "deletions": 10}, "files": [{"sha": "a746b4aa8602c958e3a53f185edaf20798848f25", "filename": "libjava/ChangeLog", "status": "modified", "additions": 9, "deletions": 0, "changes": 9, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/ae724017fd554d9c49f9ed3bd515dd236e552eef/libjava%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/ae724017fd554d9c49f9ed3bd515dd236e552eef/libjava%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libjava%2FChangeLog?ref=ae724017fd554d9c49f9ed3bd515dd236e552eef", "patch": "@@ -1,3 +1,12 @@\n+2003-01-30  Jeff Sturm  <jsturm@one-point.com>\n+\n+\t* java/lang/natClass.cc (initializeClass): Check tables when\n+\t(state == JV_STATE_IN_PROGRESS).\n+\t(_Jv_GetInterfaces): Use _Jv_WaitForState to link interface.\n+\t* java/lang/natClassLoader.cc (_Jv_WaitForState): Handle\n+\tinterpreted classes.\n+\t(linkClass0): Use _Jv_WaitForState.\n+\n 2003-01-28  Oscar Pearce  <oscar@pearceenterprises.com>\n \n \t* java/awt/Component.java (processPaintEvent): Dispose of Graphics"}, {"sha": "7fea278dbe5a3827f5fb77f956b61e5d896959ef", "filename": "libjava/java/lang/natClass.cc", "status": "modified", "additions": 17, "deletions": 1, "changes": 18, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/ae724017fd554d9c49f9ed3bd515dd236e552eef/libjava%2Fjava%2Flang%2FnatClass.cc", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/ae724017fd554d9c49f9ed3bd515dd236e552eef/libjava%2Fjava%2Flang%2FnatClass.cc", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libjava%2Fjava%2Flang%2FnatClass.cc?ref=ae724017fd554d9c49f9ed3bd515dd236e552eef", "patch": "@@ -766,11 +766,23 @@ java::lang::Class::initializeClass (void)\n     wait ();\n \n   // Steps 3 &  4.\n-  if (state == JV_STATE_DONE || state == JV_STATE_IN_PROGRESS)\n+  if (state == JV_STATE_DONE)\n     {\n       _Jv_MonitorExit (this);\n       return;\n     }\n+  if (state == JV_STATE_IN_PROGRESS)\n+    {\n+      _Jv_MonitorExit (this);\n+\n+      /* Initialization in progress.  The class is linked now,\n+         so ensure internal tables are built.  */\n+      _Jv_PrepareConstantTimeTables (this);\n+      _Jv_MakeVTable(this);\n+      _Jv_LinkOffsetTable(this);\n+\n+      return;\n+    }\n \n   // Step 5.\n   if (state == JV_STATE_ERROR)\n@@ -1213,6 +1225,10 @@ _Jv_GetInterfaces (jclass klass, _Jv_ifaces *ifaces)\n   for (int i=0; i < klass->interface_count; i++)\n     {\n       jclass iface = klass->interfaces[i];\n+\n+      /* Make sure interface is linked.  */\n+      _Jv_WaitForState(iface, JV_STATE_LINKED);\n+\n       if (_Jv_IndexOf (iface, (void **) ifaces->list, ifaces->count) == -1)\n         {\n \t  if (ifaces->count + 1 >= ifaces->len)"}, {"sha": "7ca537c365f5a0abf47b3ab80569cfbe9da8f09e", "filename": "libjava/java/lang/natClassLoader.cc", "status": "modified", "additions": 5, "deletions": 9, "changes": 14, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/ae724017fd554d9c49f9ed3bd515dd236e552eef/libjava%2Fjava%2Flang%2FnatClassLoader.cc", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/ae724017fd554d9c49f9ed3bd515dd236e552eef/libjava%2Fjava%2Flang%2FnatClassLoader.cc", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libjava%2Fjava%2Flang%2FnatClassLoader.cc?ref=ae724017fd554d9c49f9ed3bd515dd236e552eef", "patch": "@@ -117,6 +117,10 @@ _Jv_WaitForState (jclass klass, int state)\n     {\n       // Must call _Jv_PrepareCompiledClass while holding the class\n       // mutex.\n+#ifdef INTERPRETER\n+      if (_Jv_IsInterpretedClass (klass))\n+\t_Jv_PrepareClass (klass);\n+#endif\n       _Jv_PrepareCompiledClass (klass);\n       _Jv_MonitorExit (klass);\n       return;\n@@ -141,15 +145,7 @@ _Jv_WaitForState (jclass klass, int state)\n void\n java::lang::ClassLoader::linkClass0 (java::lang::Class *klass)\n {\n-  if (klass->state >= JV_STATE_LINKED)\n-    return;\n-\n-#ifdef INTERPRETER\n-  if (_Jv_IsInterpretedClass (klass))\n-    _Jv_PrepareClass (klass);\n-#endif\n-\n-  _Jv_PrepareCompiledClass (klass);\n+  _Jv_WaitForState (klass, JV_STATE_LINKED);\n }\n \n void"}]}