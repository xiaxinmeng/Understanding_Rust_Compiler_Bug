{"sha": "39e87bafc6df5d2405e7d2bedbe44018a5cd0269", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6MzllODdiYWZjNmRmNWQyNDA1ZTdkMmJlZGJlNDQwMThhNWNkMDI2OQ==", "commit": {"author": {"name": "Martin Jambor", "email": "mjambor@suse.cz", "date": "2013-09-10T13:01:47Z"}, "committer": {"name": "Martin Jambor", "email": "jamborm@gcc.gnu.org", "date": "2013-09-10T13:01:47Z"}, "message": "ipa-cp.c (propagate_constants_topo): Do not ignore SCC represented by a thunk.\n\n2013-09-10  Martin Jambor  <mjambor@suse.cz>\n\n\t* ipa-cp.c (propagate_constants_topo): Do not ignore SCC\n\trepresented by a thunk.\n\nFrom-SVN: r202444", "tree": {"sha": "41e384f72fd5b14f69eb85419144267203ddbee6", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/41e384f72fd5b14f69eb85419144267203ddbee6"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/39e87bafc6df5d2405e7d2bedbe44018a5cd0269", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/39e87bafc6df5d2405e7d2bedbe44018a5cd0269", "html_url": "https://github.com/Rust-GCC/gccrs/commit/39e87bafc6df5d2405e7d2bedbe44018a5cd0269", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/39e87bafc6df5d2405e7d2bedbe44018a5cd0269/comments", "author": {"login": "jamborm", "id": 2180070, "node_id": "MDQ6VXNlcjIxODAwNzA=", "avatar_url": "https://avatars.githubusercontent.com/u/2180070?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jamborm", "html_url": "https://github.com/jamborm", "followers_url": "https://api.github.com/users/jamborm/followers", "following_url": "https://api.github.com/users/jamborm/following{/other_user}", "gists_url": "https://api.github.com/users/jamborm/gists{/gist_id}", "starred_url": "https://api.github.com/users/jamborm/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jamborm/subscriptions", "organizations_url": "https://api.github.com/users/jamborm/orgs", "repos_url": "https://api.github.com/users/jamborm/repos", "events_url": "https://api.github.com/users/jamborm/events{/privacy}", "received_events_url": "https://api.github.com/users/jamborm/received_events", "type": "User", "site_admin": false}, "committer": null, "parents": [{"sha": "669ea36c4a1d0fe89905537ffc84ada23d2df3e4", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/669ea36c4a1d0fe89905537ffc84ada23d2df3e4", "html_url": "https://github.com/Rust-GCC/gccrs/commit/669ea36c4a1d0fe89905537ffc84ada23d2df3e4"}], "stats": {"total": 44, "additions": 21, "deletions": 23}, "files": [{"sha": "7a2bd31a8cb69abf12b97187184191caf74a35a3", "filename": "gcc/ChangeLog", "status": "modified", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/39e87bafc6df5d2405e7d2bedbe44018a5cd0269/gcc%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/39e87bafc6df5d2405e7d2bedbe44018a5cd0269/gcc%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2FChangeLog?ref=39e87bafc6df5d2405e7d2bedbe44018a5cd0269", "patch": "@@ -1,3 +1,8 @@\n+2013-09-10  Martin Jambor  <mjambor@suse.cz>\n+\n+\t* ipa-cp.c (propagate_constants_topo): Do not ignore SCC\n+\trepresented by a thunk.\n+\n 2013-09-10  Jeff Law  <law@redhat.com>\n \n \tPR tree-optimization/58343"}, {"sha": "ce38050536192985ff0965220744851a18f86e51", "filename": "gcc/ipa-cp.c", "status": "modified", "additions": 16, "deletions": 23, "changes": 39, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/39e87bafc6df5d2405e7d2bedbe44018a5cd0269/gcc%2Fipa-cp.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/39e87bafc6df5d2405e7d2bedbe44018a5cd0269/gcc%2Fipa-cp.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fipa-cp.c?ref=39e87bafc6df5d2405e7d2bedbe44018a5cd0269", "patch": "@@ -2113,23 +2113,17 @@ propagate_constants_topo (struct topo_info *topo)\n \n   for (i = topo->nnodes - 1; i >= 0; i--)\n     {\n+      unsigned j;\n       struct cgraph_node *v, *node = topo->order[i];\n-      struct ipa_dfs_info *node_dfs_info;\n+      vec<cgraph_node_ptr> cycle_nodes = ipa_get_nodes_in_cycle (node);\n \n-      if (!cgraph_function_with_gimple_body_p (node))\n-\tcontinue;\n-\n-      node_dfs_info = (struct ipa_dfs_info *) node->symbol.aux;\n       /* First, iteratively propagate within the strongly connected component\n \t until all lattices stabilize.  */\n-      v = node_dfs_info->next_cycle;\n-      while (v)\n-\t{\n+      FOR_EACH_VEC_ELT (cycle_nodes, j, v)\n+\tif (cgraph_function_with_gimple_body_p (v))\n \t  push_node_to_stack (topo, v);\n-\t  v = ((struct ipa_dfs_info *) v->symbol.aux)->next_cycle;\n-\t}\n \n-      v = node;\n+      v = pop_node_from_stack (topo);\n       while (v)\n \t{\n \t  struct cgraph_edge *cs;\n@@ -2144,19 +2138,18 @@ propagate_constants_topo (struct topo_info *topo)\n       /* Afterwards, propagate along edges leading out of the SCC, calculates\n \t the local effects of the discovered constants and all valid values to\n \t their topological sort.  */\n-      v = node;\n-      while (v)\n-\t{\n-\t  struct cgraph_edge *cs;\n-\n-\t  estimate_local_effects (v);\n-\t  add_all_node_vals_to_toposort (v);\n-\t  for (cs = v->callees; cs; cs = cs->next_callee)\n-\t    if (!edge_within_scc (cs))\n-\t      propagate_constants_accross_call (cs);\n+      FOR_EACH_VEC_ELT (cycle_nodes, j, v)\n+\tif (cgraph_function_with_gimple_body_p (v))\n+\t  {\n+\t    struct cgraph_edge *cs;\n \n-\t  v = ((struct ipa_dfs_info *) v->symbol.aux)->next_cycle;\n-\t}\n+\t    estimate_local_effects (v);\n+\t    add_all_node_vals_to_toposort (v);\n+\t    for (cs = v->callees; cs; cs = cs->next_callee)\n+\t      if (!edge_within_scc (cs))\n+\t\tpropagate_constants_accross_call (cs);\n+\t  }\n+      cycle_nodes.release ();\n     }\n }\n "}]}