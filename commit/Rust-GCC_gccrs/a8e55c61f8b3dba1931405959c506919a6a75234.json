{"sha": "a8e55c61f8b3dba1931405959c506919a6a75234", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6YThlNTVjNjFmOGIzZGJhMTkzMTQwNTk1OWM1MDY5MTlhNmE3NTIzNA==", "commit": {"author": {"name": "Iain Sandoe", "email": "iains@gcc.gnu.org", "date": "2019-06-25T20:11:11Z"}, "committer": {"name": "Iain Sandoe", "email": "iains@gcc.gnu.org", "date": "2019-06-25T20:11:11Z"}, "message": "[Darwin, PPC] Move the out of line register save/restore to an endfile.\n\nWe have been including this in libgcc, which means that we have to append\n-lgcc even when using shared libgcc. In preparation for revision of libgcc\nsplit this into an endfile.\n\ngcc/\n2019-06-25  Iain Sandoe  <iain@sandoe.co.uk>\n\n\t* config/rs6000/darwin.h (ENDFILE_SPEC): New.\n\nlibgcc/\n2019-06-25  Iain Sandoe  <iain@sandoe.co.uk>\n\n\t* config.host: Add libef_ppc.a to the extra files for powerpc-darwin.\n\t* config/rs6000/t-darwin: (PPC_ENDFILE_SRC, PPC_ENDFILE_OBJS): New.\n\tBuild objects for the out of line save/restore register functions\n\tso that they can be used for any supported Darwin version.\n\t* config/t-darwin: Default the build Darwin version to Darwin8\n\t(MacOS 10.4).\n\nFrom-SVN: r272659", "tree": {"sha": "b4fcc23a61599c949b013daff796639d4daf1694", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/b4fcc23a61599c949b013daff796639d4daf1694"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/a8e55c61f8b3dba1931405959c506919a6a75234", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/a8e55c61f8b3dba1931405959c506919a6a75234", "html_url": "https://github.com/Rust-GCC/gccrs/commit/a8e55c61f8b3dba1931405959c506919a6a75234", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/a8e55c61f8b3dba1931405959c506919a6a75234/comments", "author": {"login": "iains", "id": 4039407, "node_id": "MDQ6VXNlcjQwMzk0MDc=", "avatar_url": "https://avatars.githubusercontent.com/u/4039407?v=4", "gravatar_id": "", "url": "https://api.github.com/users/iains", "html_url": "https://github.com/iains", "followers_url": "https://api.github.com/users/iains/followers", "following_url": "https://api.github.com/users/iains/following{/other_user}", "gists_url": "https://api.github.com/users/iains/gists{/gist_id}", "starred_url": "https://api.github.com/users/iains/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/iains/subscriptions", "organizations_url": "https://api.github.com/users/iains/orgs", "repos_url": "https://api.github.com/users/iains/repos", "events_url": "https://api.github.com/users/iains/events{/privacy}", "received_events_url": "https://api.github.com/users/iains/received_events", "type": "User", "site_admin": false}, "committer": {"login": "iains", "id": 4039407, "node_id": "MDQ6VXNlcjQwMzk0MDc=", "avatar_url": "https://avatars.githubusercontent.com/u/4039407?v=4", "gravatar_id": "", "url": "https://api.github.com/users/iains", "html_url": "https://github.com/iains", "followers_url": "https://api.github.com/users/iains/followers", "following_url": "https://api.github.com/users/iains/following{/other_user}", "gists_url": "https://api.github.com/users/iains/gists{/gist_id}", "starred_url": "https://api.github.com/users/iains/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/iains/subscriptions", "organizations_url": "https://api.github.com/users/iains/orgs", "repos_url": "https://api.github.com/users/iains/repos", "events_url": "https://api.github.com/users/iains/events{/privacy}", "received_events_url": "https://api.github.com/users/iains/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "2c04f8476a8f00a3360bb468903c1343f126467f", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/2c04f8476a8f00a3360bb468903c1343f126467f", "html_url": "https://github.com/Rust-GCC/gccrs/commit/2c04f8476a8f00a3360bb468903c1343f126467f"}], "stats": {"total": 64, "additions": 54, "deletions": 10}, "files": [{"sha": "9d8d109ca0fed0219e657e824ceb667683d6a394", "filename": "gcc/ChangeLog", "status": "modified", "additions": 5, "deletions": 1, "changes": 6, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/a8e55c61f8b3dba1931405959c506919a6a75234/gcc%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/a8e55c61f8b3dba1931405959c506919a6a75234/gcc%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2FChangeLog?ref=a8e55c61f8b3dba1931405959c506919a6a75234", "patch": "@@ -1,4 +1,8 @@\n-2019-06-24  Bill Seurer  <seurer@linux.vnet.ibm.com>\n+2019-06-25  Iain Sandoe  <iain@sandoe.co.uk>\n+\n+\t* config/rs6000/darwin.h (ENDFILE_SPEC): New.\n+\n+2019-06-25  Bill Seurer  <seurer@linux.vnet.ibm.com>\n \n \t* config/rs6000/rs6000.c (stack_info, rs6000_pic_labelno,\n \tsavres_routine_syms, savres_routine_name, morestack_ref,"}, {"sha": "fcc4354b2d0b65d2739bf613ab86b3ab7273d64c", "filename": "gcc/config/rs6000/darwin.h", "status": "modified", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/a8e55c61f8b3dba1931405959c506919a6a75234/gcc%2Fconfig%2Frs6000%2Fdarwin.h", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/a8e55c61f8b3dba1931405959c506919a6a75234/gcc%2Fconfig%2Frs6000%2Fdarwin.h", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fconfig%2Frs6000%2Fdarwin.h?ref=a8e55c61f8b3dba1931405959c506919a6a75234", "patch": "@@ -132,6 +132,11 @@ extern int darwin_emit_picsym_stub;\n #define DARWIN_CRT2_SPEC \\\n   \"%{!m64:%:version-compare(!> 10.4 mmacosx-version-min= crt2.o%s)}\"\n \n+/* The PPC regs save/restore functions are leaves and could, conceivably\n+   be used by the tm destructor.  */\n+#undef ENDFILE_SPEC\n+#define ENDFILE_SPEC TM_DESTRUCTOR \"-lef_ppc\"\n+\n #undef SUBTARGET_EXTRA_SPECS\n #define SUBTARGET_EXTRA_SPECS\t\t\t\\\n   DARWIN_EXTRA_SPECS                            \\"}, {"sha": "a6e8c202b9d612f51396435554bfbf91b5175fd6", "filename": "libgcc/ChangeLog", "status": "modified", "additions": 9, "deletions": 0, "changes": 9, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/a8e55c61f8b3dba1931405959c506919a6a75234/libgcc%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/a8e55c61f8b3dba1931405959c506919a6a75234/libgcc%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libgcc%2FChangeLog?ref=a8e55c61f8b3dba1931405959c506919a6a75234", "patch": "@@ -1,3 +1,12 @@\n+2019-06-25  Iain Sandoe  <iain@sandoe.co.uk>\n+\n+\t* config.host: Add libef_ppc.a to the extra files for powerpc-darwin.\n+\t* config/rs6000/t-darwin: (PPC_ENDFILE_SRC, PPC_ENDFILE_OBJS): New.\n+\tBuild objects for the out of line save/restore register functions\n+\tso that they can be used for any supported Darwin version.\n+\t* config/t-darwin: Default the build Darwin version to Darwin8\n+\t(MacOS 10.4).\n+\n 2019-06-25  Martin Liska  <mliska@suse.cz>\n \n \t* libgcov-driver-system.c (replace_filename_variables): Do not"}, {"sha": "0c238b7a7e83c3c8291295e2139e6ea203f036e4", "filename": "libgcc/config/rs6000/t-darwin", "status": "modified", "additions": 34, "deletions": 8, "changes": 42, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/a8e55c61f8b3dba1931405959c506919a6a75234/libgcc%2Fconfig%2Frs6000%2Ft-darwin", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/a8e55c61f8b3dba1931405959c506919a6a75234/libgcc%2Fconfig%2Frs6000%2Ft-darwin", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libgcc%2Fconfig%2Frs6000%2Ft-darwin?ref=a8e55c61f8b3dba1931405959c506919a6a75234", "patch": "@@ -3,23 +3,49 @@ DARWIN_EXTRA_CRT_BUILD_CFLAGS = -mlongcall -mmacosx-version-min=10.4\n crt2.o: $(srcdir)/config/rs6000/darwin-crt2.c\n \t$(crt_compile) $(DARWIN_EXTRA_CRT_BUILD_CFLAGS) -c $<\n \n+# The outlined register save/restore functions need to run anywhere, and\n+# they must be leaf functions suitable for use in an endfile.\n+\n+PPC_ENDFILE_SRC = \\\n+  $(srcdir)/config/rs6000/darwin-gpsave.S \\\n+  $(srcdir)/config/rs6000/darwin-fpsave.S \\\n+  $(srcdir)/config/rs6000/darwin-vecsave.S\n+\n+PPC_ENDFILE_OBJS = \\\n+ darwin-gpsave.o \\\n+ darwin-fpsave.o \\\n+ darwin-vecsave.o\n+\n+darwin-gpsave.o: $(srcdir)/config/rs6000/darwin-gpsave.S\n+\t$(crt_compile) -mmacosx-version-min=10.1 -c $<\n+\n+darwin-fpsave.o: $(srcdir)/config/rs6000/darwin-fpsave.S\n+\t$(crt_compile) -mmacosx-version-min=10.1 -c $<\n+\n+darwin-vecsave.o: $(srcdir)/config/rs6000/darwin-vecsave.S\n+\t$(crt_compile) -mmacosx-version-min=10.1 -c $<\n+\n+# We build these into a library, so that they are only linked as needed and not\n+# forced into every object.\n+\n+libef_ppc.a: $(PPC_ENDFILE_OBJS)\n+\t$(AR_CREATE_FOR_TARGET) $@ $(PPC_ENDFILE_OBJS)\n+\t$(RANLIB_FOR_TARGET) $@\n+\n LIB2ADD = $(srcdir)/config/rs6000/darwin-tramp.S \\\n \t  $(srcdir)/config/darwin-64.c \\\n-\t  $(srcdir)/config/rs6000/darwin-fpsave.S  \\\n-\t  $(srcdir)/config/rs6000/darwin-gpsave.S  \\\n \t  $(srcdir)/config/rs6000/darwin-world.S \\\n \t  $(srcdir)/config/rs6000/ppc64-fp.c\n \n-LIB2ADD_ST = \\\n-\t  $(srcdir)/config/rs6000/darwin-vecsave.S\n-\n # The .S files above are designed to run on all processors, even though\n # they use AltiVec instructions.\n # -Wa is used because -force_cpusubtype_ALL doesn't work with -dynamiclib.\n-# -mmacosx-version-min=10.4 is used to provide compatibility for code from\n-# earlier OSX versions.\n-HOST_LIBGCC2_CFLAGS += -Wa,-force_cpusubtype_ALL -mmacosx-version-min=10.4\n \n+HOST_LIBGCC2_CFLAGS += -Wa,-force_cpusubtype_ALL\n+\n+# Although the default for 10.4 is G3, we need the unwinder to be built\n+# with vector support so that the \"save/rest_world\" outlined functions are\n+# correctly invoked.\n unwind-dw2_s.o: HOST_LIBGCC2_CFLAGS += -maltivec\n unwind-dw2.o: HOST_LIBGCC2_CFLAGS += -maltivec\n "}, {"sha": "2fcb712a060248cd218d2510367f8f73e2fb6872", "filename": "libgcc/config/t-darwin", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/a8e55c61f8b3dba1931405959c506919a6a75234/libgcc%2Fconfig%2Ft-darwin", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/a8e55c61f8b3dba1931405959c506919a6a75234/libgcc%2Fconfig%2Ft-darwin", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libgcc%2Fconfig%2Ft-darwin?ref=a8e55c61f8b3dba1931405959c506919a6a75234", "patch": "@@ -1,6 +1,6 @@\n # Set this as a minimum (unless overriden by arch t-files) since it's a\n # reasonable lowest common denominator that works for all our archs.\n-HOST_LIBGCC2_CFLAGS += -mmacosx-version-min=10.5\n+HOST_LIBGCC2_CFLAGS += -mmacosx-version-min=10.4\n \n crt3.o: $(srcdir)/config/darwin-crt3.c\n \t$(crt_compile) $(DARWIN_EXTRA_CRT_BUILD_CFLAGS) -c $<"}]}