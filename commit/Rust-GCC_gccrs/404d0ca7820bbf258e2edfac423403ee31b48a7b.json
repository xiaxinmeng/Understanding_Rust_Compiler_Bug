{"sha": "404d0ca7820bbf258e2edfac423403ee31b48a7b", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6NDA0ZDBjYTc4MjBiYmYyNThlMmVkZmFjNDIzNDAzZWUzMWI0OGE3Yg==", "commit": {"author": {"name": "Jakub Jelinek", "email": "jakub@redhat.com", "date": "2020-12-01T15:23:59Z"}, "committer": {"name": "Jakub Jelinek", "email": "jakub@redhat.com", "date": "2020-12-01T15:23:59Z"}, "message": "loop-invariant: JUMP_INSNs aren't loop invariant [PR97954]\n\nThe following testcase ICEs because loop invariant motion moves asm goto\nwith a single output as invariant.\nNormally, jumps aren't really moved, because if they are single set,\nthey have their SET_DEST (pc) and pc_rtx has VOIDmode on which one of the\nfunctions find_invariant_insn calls bails out.  The code already punts on\ninsns that can throw or trap.  And for asm goto without outputs, it isn't\nsingle set, or asm goto with two or more outputs it isn't single set either.\n\n2020-12-01  Jakub Jelinek  <jakub@redhat.com>\n\n\tPR rtl-optimization/97954\n\t* loop-invariant.c (find_invariant_insn): Punt on JUMP_P insns.\n\n\t* gcc.dg/pr97954.c: New test.", "tree": {"sha": "90e880c11190e9340ba71fe640cf175d4781819c", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/90e880c11190e9340ba71fe640cf175d4781819c"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/404d0ca7820bbf258e2edfac423403ee31b48a7b", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/404d0ca7820bbf258e2edfac423403ee31b48a7b", "html_url": "https://github.com/Rust-GCC/gccrs/commit/404d0ca7820bbf258e2edfac423403ee31b48a7b", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/404d0ca7820bbf258e2edfac423403ee31b48a7b/comments", "author": {"login": "jakubjelinek", "id": 9370665, "node_id": "MDQ6VXNlcjkzNzA2NjU=", "avatar_url": "https://avatars.githubusercontent.com/u/9370665?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jakubjelinek", "html_url": "https://github.com/jakubjelinek", "followers_url": "https://api.github.com/users/jakubjelinek/followers", "following_url": "https://api.github.com/users/jakubjelinek/following{/other_user}", "gists_url": "https://api.github.com/users/jakubjelinek/gists{/gist_id}", "starred_url": "https://api.github.com/users/jakubjelinek/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jakubjelinek/subscriptions", "organizations_url": "https://api.github.com/users/jakubjelinek/orgs", "repos_url": "https://api.github.com/users/jakubjelinek/repos", "events_url": "https://api.github.com/users/jakubjelinek/events{/privacy}", "received_events_url": "https://api.github.com/users/jakubjelinek/received_events", "type": "User", "site_admin": false}, "committer": {"login": "jakubjelinek", "id": 9370665, "node_id": "MDQ6VXNlcjkzNzA2NjU=", "avatar_url": "https://avatars.githubusercontent.com/u/9370665?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jakubjelinek", "html_url": "https://github.com/jakubjelinek", "followers_url": "https://api.github.com/users/jakubjelinek/followers", "following_url": "https://api.github.com/users/jakubjelinek/following{/other_user}", "gists_url": "https://api.github.com/users/jakubjelinek/gists{/gist_id}", "starred_url": "https://api.github.com/users/jakubjelinek/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jakubjelinek/subscriptions", "organizations_url": "https://api.github.com/users/jakubjelinek/orgs", "repos_url": "https://api.github.com/users/jakubjelinek/repos", "events_url": "https://api.github.com/users/jakubjelinek/events{/privacy}", "received_events_url": "https://api.github.com/users/jakubjelinek/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "2133e773ab855af036de5f6f29eae30d43f1422b", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/2133e773ab855af036de5f6f29eae30d43f1422b", "html_url": "https://github.com/Rust-GCC/gccrs/commit/2133e773ab855af036de5f6f29eae30d43f1422b"}], "stats": {"total": 16, "additions": 16, "deletions": 0}, "files": [{"sha": "653e3033271d82c5f69ec19cf8b553a332d9f617", "filename": "gcc/loop-invariant.c", "status": "modified", "additions": 4, "deletions": 0, "changes": 4, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/404d0ca7820bbf258e2edfac423403ee31b48a7b/gcc%2Floop-invariant.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/404d0ca7820bbf258e2edfac423403ee31b48a7b/gcc%2Floop-invariant.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Floop-invariant.c?ref=404d0ca7820bbf258e2edfac423403ee31b48a7b", "patch": "@@ -1099,6 +1099,10 @@ find_invariant_insn (rtx_insn *insn, bool always_reached, bool always_executed)\n   if (HAVE_cc0 && sets_cc0_p (insn))\n     return;\n \n+  /* Jumps have control flow side-effects.  */\n+  if (JUMP_P (insn))\n+    return;\n+\n   set = single_set (insn);\n   if (!set)\n     return;"}, {"sha": "178e1d2e965e8ae7d825b7498fa50354259744b2", "filename": "gcc/testsuite/gcc.dg/pr97954.c", "status": "added", "additions": 12, "deletions": 0, "changes": 12, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/404d0ca7820bbf258e2edfac423403ee31b48a7b/gcc%2Ftestsuite%2Fgcc.dg%2Fpr97954.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/404d0ca7820bbf258e2edfac423403ee31b48a7b/gcc%2Ftestsuite%2Fgcc.dg%2Fpr97954.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgcc.dg%2Fpr97954.c?ref=404d0ca7820bbf258e2edfac423403ee31b48a7b", "patch": "@@ -0,0 +1,12 @@\n+/* PR rtl-optimization/97954 */\n+/* { dg-do compile } */\n+/* { dg-options \"-O2\" } */\n+\n+int\n+foo (void)\n+{\n+  int x;\n+ lab:\n+  asm goto (\"\": \"=r\" (x) : : : lab);\n+  return x;\n+}"}]}