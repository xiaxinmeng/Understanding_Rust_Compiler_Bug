{"sha": "52b769437a4d1ca50f4ef5bdad65b12115ded845", "node_id": "C_kwDOANBUbNoAKDUyYjc2OTQzN2E0ZDFjYTUwZjRlZjViZGFkNjViMTIxMTVkZWQ4NDU", "commit": {"author": {"name": "Jonathan Wakely", "email": "jwakely@redhat.com", "date": "2021-11-26T22:53:02Z"}, "committer": {"name": "Jonathan Wakely", "email": "jwakely@redhat.com", "date": "2021-11-26T22:56:51Z"}, "message": "libstdc++: Fix test that fails in C++20 mode\n\nThis test was written to verify that the LWG 3265 changes work. But\nthose changes were superseded by LWG 3435, and the test is now incorrect\naccording to the current draft. The assignment operator is now\nconstrained to also require convertibility, which makes the test fail.\n\nChange the Iter type to be convertible from int*, but make it throw an\nexception if that conversion is used. Change the test from compile-only\nto run, so we verify that the exception isn't thrown.\n\nlibstdc++-v3/ChangeLog:\n\n\t* testsuite/24_iterators/move_iterator/dr3265.cc: Fix test to\n\taccount for LWG 3435 resolution.", "tree": {"sha": "7f87f82863ae8686837d9b06093e6bb0da66db5d", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/7f87f82863ae8686837d9b06093e6bb0da66db5d"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/52b769437a4d1ca50f4ef5bdad65b12115ded845", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/52b769437a4d1ca50f4ef5bdad65b12115ded845", "html_url": "https://github.com/Rust-GCC/gccrs/commit/52b769437a4d1ca50f4ef5bdad65b12115ded845", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/52b769437a4d1ca50f4ef5bdad65b12115ded845/comments", "author": {"login": "jwakely", "id": 1254480, "node_id": "MDQ6VXNlcjEyNTQ0ODA=", "avatar_url": "https://avatars.githubusercontent.com/u/1254480?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jwakely", "html_url": "https://github.com/jwakely", "followers_url": "https://api.github.com/users/jwakely/followers", "following_url": "https://api.github.com/users/jwakely/following{/other_user}", "gists_url": "https://api.github.com/users/jwakely/gists{/gist_id}", "starred_url": "https://api.github.com/users/jwakely/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jwakely/subscriptions", "organizations_url": "https://api.github.com/users/jwakely/orgs", "repos_url": "https://api.github.com/users/jwakely/repos", "events_url": "https://api.github.com/users/jwakely/events{/privacy}", "received_events_url": "https://api.github.com/users/jwakely/received_events", "type": "User", "site_admin": false}, "committer": {"login": "jwakely", "id": 1254480, "node_id": "MDQ6VXNlcjEyNTQ0ODA=", "avatar_url": "https://avatars.githubusercontent.com/u/1254480?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jwakely", "html_url": "https://github.com/jwakely", "followers_url": "https://api.github.com/users/jwakely/followers", "following_url": "https://api.github.com/users/jwakely/following{/other_user}", "gists_url": "https://api.github.com/users/jwakely/gists{/gist_id}", "starred_url": "https://api.github.com/users/jwakely/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jwakely/subscriptions", "organizations_url": "https://api.github.com/users/jwakely/orgs", "repos_url": "https://api.github.com/users/jwakely/repos", "events_url": "https://api.github.com/users/jwakely/events{/privacy}", "received_events_url": "https://api.github.com/users/jwakely/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "33adfd0d42e54c809b0c53212abe66e8c874b2f8", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/33adfd0d42e54c809b0c53212abe66e8c874b2f8", "html_url": "https://github.com/Rust-GCC/gccrs/commit/33adfd0d42e54c809b0c53212abe66e8c874b2f8"}], "stats": {"total": 25, "additions": 15, "deletions": 10}, "files": [{"sha": "3ce0df5d111eda94493b1284cdc43b61937e5ca9", "filename": "libstdc++-v3/testsuite/24_iterators/move_iterator/dr3265.cc", "status": "modified", "additions": 15, "deletions": 10, "changes": 25, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/52b769437a4d1ca50f4ef5bdad65b12115ded845/libstdc%2B%2B-v3%2Ftestsuite%2F24_iterators%2Fmove_iterator%2Fdr3265.cc", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/52b769437a4d1ca50f4ef5bdad65b12115ded845/libstdc%2B%2B-v3%2Ftestsuite%2F24_iterators%2Fmove_iterator%2Fdr3265.cc", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libstdc%2B%2B-v3%2Ftestsuite%2F24_iterators%2Fmove_iterator%2Fdr3265.cc?ref=52b769437a4d1ca50f4ef5bdad65b12115ded845", "patch": "@@ -15,7 +15,7 @@\n // with this library; see the file COPYING3.  If not see\n // <http://www.gnu.org/licenses/>.\n \n-// { dg-do compile { target c++11 } }\n+// { dg-do run { target c++11 } }\n \n #include <iterator>\n \n@@ -27,18 +27,18 @@ struct Iter\n   using reference = int&;\n   using difference_type = std::ptrdiff_t;\n \n-  Iter();\n+  Iter() { }\n \n-  // Construction from int* is not valid:\n-  Iter(int*) = delete;\n+  // Construction from int* should not be used:\n+  Iter(int*) { throw 1; }\n \n-  // Assignment from int* is valid:\n-  Iter& operator=(int*);\n+  // Assignment from int* is OK:\n+  Iter& operator=(int*) { return *this; }\n \n-  Iter& operator++();\n-  Iter operator++(int);\n-  int& operator*() const;\n-  int* operator->() const;\n+  Iter& operator++() { return *this; }\n+  Iter operator++(int) { return *this; }\n+  int& operator*() const { static int i; return i; }\n+  int* operator->() const { return &**this; }\n \n   template<int N> friend bool operator==(Iter, Iter);\n };\n@@ -49,3 +49,8 @@ void test01()\n   int i = 0;\n   m = std::make_move_iterator(&i); // Should use assignment not construction\n }\n+\n+int main()\n+{\n+  test01();\n+}"}]}