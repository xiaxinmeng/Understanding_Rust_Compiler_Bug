{"sha": "d444b5e897369d3e8de7e9e8d93daf75cef2d9a3", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6ZDQ0NGI1ZTg5NzM2OWQzZThkZTdlOWU4ZDkzZGFmNzVjZWYyZDlhMw==", "commit": {"author": {"name": "Richard Henderson", "email": "rth@redhat.com", "date": "2003-06-26T20:29:55Z"}, "committer": {"name": "Richard Henderson", "email": "rth@gcc.gnu.org", "date": "2003-06-26T20:29:55Z"}, "message": "flow.c (propagate_one_insn): Preserve live-at-end registers across tail calls.\n\n        * flow.c (propagate_one_insn): Preserve live-at-end registers\n        across tail calls.\n\nFrom-SVN: r68544", "tree": {"sha": "1d11b2360b2b29aca14ff5f4bcb0b30e7377ab5f", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/1d11b2360b2b29aca14ff5f4bcb0b30e7377ab5f"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/d444b5e897369d3e8de7e9e8d93daf75cef2d9a3", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/d444b5e897369d3e8de7e9e8d93daf75cef2d9a3", "html_url": "https://github.com/Rust-GCC/gccrs/commit/d444b5e897369d3e8de7e9e8d93daf75cef2d9a3", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/d444b5e897369d3e8de7e9e8d93daf75cef2d9a3/comments", "author": null, "committer": null, "parents": [{"sha": "4dbda6f04a92cb35b6ba2dd6b85481631ded68d0", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/4dbda6f04a92cb35b6ba2dd6b85481631ded68d0", "html_url": "https://github.com/Rust-GCC/gccrs/commit/4dbda6f04a92cb35b6ba2dd6b85481631ded68d0"}], "stats": {"total": 18, "additions": 15, "deletions": 3}, "files": [{"sha": "274e7a531ab9d515da9ff2a2c199c7f0b35abd1e", "filename": "gcc/ChangeLog", "status": "modified", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/d444b5e897369d3e8de7e9e8d93daf75cef2d9a3/gcc%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/d444b5e897369d3e8de7e9e8d93daf75cef2d9a3/gcc%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2FChangeLog?ref=d444b5e897369d3e8de7e9e8d93daf75cef2d9a3", "patch": "@@ -1,3 +1,8 @@\n+2003-06-26  Richard Henderson  <rth@redhat.com>\n+\n+\t* flow.c (propagate_one_insn): Preserve live-at-end registers\n+\tacross tail calls.\n+\n 2003-06-26  J\"orn Rennecke <joern.rennecke@superh.com>\n \n \t* reload.c (can_reload_into): New function."}, {"sha": "58859405aab3c2bb5ce8a9760d3ccb533ba0fece", "filename": "gcc/flow.c", "status": "modified", "additions": 10, "deletions": 3, "changes": 13, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/d444b5e897369d3e8de7e9e8d93daf75cef2d9a3/gcc%2Fflow.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/d444b5e897369d3e8de7e9e8d93daf75cef2d9a3/gcc%2Fflow.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fflow.c?ref=d444b5e897369d3e8de7e9e8d93daf75cef2d9a3", "patch": "@@ -1770,8 +1770,10 @@ propagate_one_insn (pbi, insn)\n \n       if (GET_CODE (insn) == CALL_INSN)\n \t{\n-\t  int i;\n+\t  regset live_at_end;\n+\t  bool sibcall_p;\n \t  rtx note, cond;\n+\t  int i;\n \n \t  cond = NULL_RTX;\n \t  if (GET_CODE (PATTERN (insn)) == COND_EXEC)\n@@ -1796,9 +1798,14 @@ propagate_one_insn (pbi, insn)\n \t      mark_set_1 (pbi, CLOBBER, XEXP (XEXP (note, 0), 0),\n \t\t\t  cond, insn, pbi->flags);\n \n-\t  /* Calls change all call-used and global registers.  */\n+\t  /* Calls change all call-used and global registers; sibcalls do not\n+\t     clobber anything that must be preserved at end-of-function.  */\n+\n+\t  sibcall_p = SIBLING_CALL_P (insn);\n+\t  live_at_end = EXIT_BLOCK_PTR->global_live_at_start;\n \t  for (i = 0; i < FIRST_PSEUDO_REGISTER; i++)\n-\t    if (TEST_HARD_REG_BIT (regs_invalidated_by_call, i))\n+\t    if (TEST_HARD_REG_BIT (regs_invalidated_by_call, i)\n+\t\t&& ! (sibcall_p && REGNO_REG_SET_P (live_at_end, i)))\n \t      {\n \t\t/* We do not want REG_UNUSED notes for these registers.  */\n \t\tmark_set_1 (pbi, CLOBBER, regno_reg_rtx[i], cond, insn,"}]}