{"sha": "7d790165457c7c6912ed98da4a64d9b020c6f483", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6N2Q3OTAxNjU0NTdjN2M2OTEyZWQ5OGRhNGE2NGQ5YjAyMGM2ZjQ4Mw==", "commit": {"author": {"name": "Jakub Jelinek", "email": "jakub@redhat.com", "date": "2017-03-31T06:38:35Z"}, "committer": {"name": "Jakub Jelinek", "email": "jakub@gcc.gnu.org", "date": "2017-03-31T06:38:35Z"}, "message": "re PR middle-end/80173 (ICE in store_bit_field_1, at expmed.c:787)\n\n\tPR middle-end/80173\n\t* expmed.c (store_bit_field_1): Don't attempt to create\n\ta word subreg out of hard registers wider than word if they\n\thave HARD_REGNO_NREGS of 1 for their mode.\n\n\t* gcc.target/i386/pr80173.c: New test.\n\nFrom-SVN: r246608", "tree": {"sha": "a2de62c5d9b9d71a0b6cd2125e29b6575d8fc3d4", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/a2de62c5d9b9d71a0b6cd2125e29b6575d8fc3d4"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/7d790165457c7c6912ed98da4a64d9b020c6f483", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/7d790165457c7c6912ed98da4a64d9b020c6f483", "html_url": "https://github.com/Rust-GCC/gccrs/commit/7d790165457c7c6912ed98da4a64d9b020c6f483", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/7d790165457c7c6912ed98da4a64d9b020c6f483/comments", "author": {"login": "jakubjelinek", "id": 9370665, "node_id": "MDQ6VXNlcjkzNzA2NjU=", "avatar_url": "https://avatars.githubusercontent.com/u/9370665?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jakubjelinek", "html_url": "https://github.com/jakubjelinek", "followers_url": "https://api.github.com/users/jakubjelinek/followers", "following_url": "https://api.github.com/users/jakubjelinek/following{/other_user}", "gists_url": "https://api.github.com/users/jakubjelinek/gists{/gist_id}", "starred_url": "https://api.github.com/users/jakubjelinek/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jakubjelinek/subscriptions", "organizations_url": "https://api.github.com/users/jakubjelinek/orgs", "repos_url": "https://api.github.com/users/jakubjelinek/repos", "events_url": "https://api.github.com/users/jakubjelinek/events{/privacy}", "received_events_url": "https://api.github.com/users/jakubjelinek/received_events", "type": "User", "site_admin": false}, "committer": null, "parents": [{"sha": "a7d551541989a53c964d5cc54359069bf4cf919a", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/a7d551541989a53c964d5cc54359069bf4cf919a", "html_url": "https://github.com/Rust-GCC/gccrs/commit/a7d551541989a53c964d5cc54359069bf4cf919a"}], "stats": {"total": 40, "additions": 38, "deletions": 2}, "files": [{"sha": "ba4f7fd0dbb937d2e117f628b40c3cbdd64515cb", "filename": "gcc/ChangeLog", "status": "modified", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/7d790165457c7c6912ed98da4a64d9b020c6f483/gcc%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/7d790165457c7c6912ed98da4a64d9b020c6f483/gcc%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2FChangeLog?ref=7d790165457c7c6912ed98da4a64d9b020c6f483", "patch": "@@ -1,5 +1,10 @@\n 2017-03-31  Jakub Jelinek  <jakub@redhat.com>\n \n+\tPR middle-end/80173\n+\t* expmed.c (store_bit_field_1): Don't attempt to create\n+\ta word subreg out of hard registers wider than word if they\n+\thave HARD_REGNO_NREGS of 1 for their mode.\n+\n \tPR middle-end/80163\n \t* varasm.c (initializer_constant_valid_p_1): Disallow sign-extending\n \tconversions to integer types wider than word and pointer."}, {"sha": "c0260c53853cda4deffca4ca4cdd9c825e023aef", "filename": "gcc/expmed.c", "status": "modified", "additions": 8, "deletions": 2, "changes": 10, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/7d790165457c7c6912ed98da4a64d9b020c6f483/gcc%2Fexpmed.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/7d790165457c7c6912ed98da4a64d9b020c6f483/gcc%2Fexpmed.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fexpmed.c?ref=7d790165457c7c6912ed98da4a64d9b020c6f483", "patch": "@@ -965,8 +965,14 @@ store_bit_field_1 (rtx str_rtx, unsigned HOST_WIDE_INT bitsize,\n     }\n \n   /* If OP0 is a multi-word register, narrow it to the affected word.\n-     If the region spans two words, defer to store_split_bit_field.  */\n-  if (!MEM_P (op0) && GET_MODE_SIZE (GET_MODE (op0)) > UNITS_PER_WORD)\n+     If the region spans two words, defer to store_split_bit_field.\n+     Don't do this if op0 is a single hard register wider than word\n+     such as a float or vector register.  */\n+  if (!MEM_P (op0)\n+      && GET_MODE_SIZE (GET_MODE (op0)) > UNITS_PER_WORD\n+      && (!REG_P (op0)\n+\t  || !HARD_REGISTER_P (op0)\n+\t  || HARD_REGNO_NREGS (REGNO (op0), GET_MODE (op0)) != 1))\n     {\n       if (bitnum % BITS_PER_WORD + bitsize > BITS_PER_WORD)\n \t{"}, {"sha": "9297d53356803227a084beb4e3077d32eb4c97d9", "filename": "gcc/testsuite/ChangeLog", "status": "modified", "additions": 3, "deletions": 0, "changes": 3, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/7d790165457c7c6912ed98da4a64d9b020c6f483/gcc%2Ftestsuite%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/7d790165457c7c6912ed98da4a64d9b020c6f483/gcc%2Ftestsuite%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2FChangeLog?ref=7d790165457c7c6912ed98da4a64d9b020c6f483", "patch": "@@ -1,5 +1,8 @@\n 2017-03-31  Jakub Jelinek  <jakub@redhat.com>\n \n+\tPR middle-end/80173\n+\t* gcc.target/i386/pr80173.c: New test.\n+\n \tPR middle-end/80163\n \t* gcc.dg/pr80163.c: New test.\n "}, {"sha": "7abd40498123814412abd581492b2563141f1e78", "filename": "gcc/testsuite/gcc.target/i386/pr80173.c", "status": "added", "additions": 22, "deletions": 0, "changes": 22, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/7d790165457c7c6912ed98da4a64d9b020c6f483/gcc%2Ftestsuite%2Fgcc.target%2Fi386%2Fpr80173.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/7d790165457c7c6912ed98da4a64d9b020c6f483/gcc%2Ftestsuite%2Fgcc.target%2Fi386%2Fpr80173.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgcc.target%2Fi386%2Fpr80173.c?ref=7d790165457c7c6912ed98da4a64d9b020c6f483", "patch": "@@ -0,0 +1,22 @@\n+/* PR middle-end/80173 */\n+/* { dg-do compile { target lp64 } } */\n+/* { dg-options \"-O2 -ffixed-xmm7\" } */\n+\n+typedef int V __attribute__ ((vector_size (2 * sizeof (int))));\n+\n+struct U { V a; V b; };\n+\n+int\n+foo (int i)\n+{\n+  register struct U u asm (\"xmm7\") = {{-1, 0}, {-1, 0}};\n+  return u.b[i];\n+}\n+\n+int\n+bar (int i)\n+{\n+  register struct U u asm (\"xmm7\");\n+  u = (struct U) {{-1, 0}, {-1, 0}};\n+  return u.b[i];\n+}"}]}