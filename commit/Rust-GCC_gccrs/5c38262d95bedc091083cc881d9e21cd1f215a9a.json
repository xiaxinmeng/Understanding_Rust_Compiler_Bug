{"sha": "5c38262d95bedc091083cc881d9e21cd1f215a9a", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6NWMzODI2MmQ5NWJlZGMwOTEwODNjYzg4MWQ5ZTIxY2QxZjIxNWE5YQ==", "commit": {"author": {"name": "Jakub Jelinek", "email": "jakub@redhat.com", "date": "2017-10-04T07:50:38Z"}, "committer": {"name": "Jakub Jelinek", "email": "jakub@gcc.gnu.org", "date": "2017-10-04T07:50:38Z"}, "message": "re PR tree-optimization/82374 (#pragma GCC optimize is not applied to openmp-generated functions)\n\n\tPR tree-optimization/82374\n\t* omp-low.c (create_omp_child_function): Copy DECL_ATTRIBUTES,\n\tDECL_FUNCTION_SPECIFIC_OPTIMIZATION,\n\tDECL_FUNCTION_SPECIFIC_TARGET and DECL_FUNCTION_VERSIONED from\n\tcurrent_function_decl to the new decl.\n\n\t* gcc.dg/gomp/pr82374.c: New test.\n\nFrom-SVN: r253395", "tree": {"sha": "e7a8605743c6aa3f81e39c7c50e404afff3dab36", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/e7a8605743c6aa3f81e39c7c50e404afff3dab36"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/5c38262d95bedc091083cc881d9e21cd1f215a9a", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/5c38262d95bedc091083cc881d9e21cd1f215a9a", "html_url": "https://github.com/Rust-GCC/gccrs/commit/5c38262d95bedc091083cc881d9e21cd1f215a9a", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/5c38262d95bedc091083cc881d9e21cd1f215a9a/comments", "author": {"login": "jakubjelinek", "id": 9370665, "node_id": "MDQ6VXNlcjkzNzA2NjU=", "avatar_url": "https://avatars.githubusercontent.com/u/9370665?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jakubjelinek", "html_url": "https://github.com/jakubjelinek", "followers_url": "https://api.github.com/users/jakubjelinek/followers", "following_url": "https://api.github.com/users/jakubjelinek/following{/other_user}", "gists_url": "https://api.github.com/users/jakubjelinek/gists{/gist_id}", "starred_url": "https://api.github.com/users/jakubjelinek/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jakubjelinek/subscriptions", "organizations_url": "https://api.github.com/users/jakubjelinek/orgs", "repos_url": "https://api.github.com/users/jakubjelinek/repos", "events_url": "https://api.github.com/users/jakubjelinek/events{/privacy}", "received_events_url": "https://api.github.com/users/jakubjelinek/received_events", "type": "User", "site_admin": false}, "committer": null, "parents": [{"sha": "21375f0ded2dbc4240bd9e3bfcb8f48451ce02b4", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/21375f0ded2dbc4240bd9e3bfcb8f48451ce02b4", "html_url": "https://github.com/Rust-GCC/gccrs/commit/21375f0ded2dbc4240bd9e3bfcb8f48451ce02b4"}], "stats": {"total": 52, "additions": 52, "deletions": 0}, "files": [{"sha": "3512f9e703ee17f83799f84e86e1af138c1103a5", "filename": "gcc/ChangeLog", "status": "modified", "additions": 8, "deletions": 0, "changes": 8, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/5c38262d95bedc091083cc881d9e21cd1f215a9a/gcc%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/5c38262d95bedc091083cc881d9e21cd1f215a9a/gcc%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2FChangeLog?ref=5c38262d95bedc091083cc881d9e21cd1f215a9a", "patch": "@@ -1,3 +1,11 @@\n+2017-10-04  Jakub Jelinek  <jakub@redhat.com>\n+\n+\tPR tree-optimization/82374\n+\t* omp-low.c (create_omp_child_function): Copy DECL_ATTRIBUTES,\n+\tDECL_FUNCTION_SPECIFIC_OPTIMIZATION,\n+\tDECL_FUNCTION_SPECIFIC_TARGET and DECL_FUNCTION_VERSIONED from\n+\tcurrent_function_decl to the new decl.\n+\n 2017-10-03  Michael Meissner  <meissner@linux.vnet.ibm.com>\n \n \t* config/rs6000/rs6000-builtin.def (BU_FLOAT128_2_HW): Define new"}, {"sha": "3645661038afe9aec2008a528d0dd9959b0bce15", "filename": "gcc/omp-low.c", "status": "modified", "additions": 8, "deletions": 0, "changes": 8, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/5c38262d95bedc091083cc881d9e21cd1f215a9a/gcc%2Fomp-low.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/5c38262d95bedc091083cc881d9e21cd1f215a9a/gcc%2Fomp-low.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fomp-low.c?ref=5c38262d95bedc091083cc881d9e21cd1f215a9a", "patch": "@@ -1626,6 +1626,14 @@ create_omp_child_function (omp_context *ctx, bool task_copy)\n   DECL_CONTEXT (decl) = NULL_TREE;\n   DECL_INITIAL (decl) = make_node (BLOCK);\n   BLOCK_SUPERCONTEXT (DECL_INITIAL (decl)) = decl;\n+  DECL_ATTRIBUTES (decl) = DECL_ATTRIBUTES (current_function_decl);\n+  DECL_FUNCTION_SPECIFIC_OPTIMIZATION (decl)\n+    = DECL_FUNCTION_SPECIFIC_OPTIMIZATION (current_function_decl);\n+  DECL_FUNCTION_SPECIFIC_TARGET (decl)\n+    = DECL_FUNCTION_SPECIFIC_TARGET (current_function_decl);\n+  DECL_FUNCTION_VERSIONED (decl)\n+    = DECL_FUNCTION_VERSIONED (current_function_decl);\n+\n   if (omp_maybe_offloaded_ctx (ctx))\n     {\n       cgraph_node::get_create (decl)->offloadable = 1;"}, {"sha": "816646517ac1ef145fc28ff6bd21f8610ec1082a", "filename": "gcc/testsuite/ChangeLog", "status": "modified", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/5c38262d95bedc091083cc881d9e21cd1f215a9a/gcc%2Ftestsuite%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/5c38262d95bedc091083cc881d9e21cd1f215a9a/gcc%2Ftestsuite%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2FChangeLog?ref=5c38262d95bedc091083cc881d9e21cd1f215a9a", "patch": "@@ -1,3 +1,8 @@\n+2017-10-04  Jakub Jelinek  <jakub@redhat.com>\n+\n+\tPR tree-optimization/82374\n+\t* gcc.dg/gomp/pr82374.c: New test.\n+\n 2017-10-04  Richard Biener  <rguenther@suse.de>\n \n \t* gfortran.dg/graphite/id-17.f: For ilp32 allow graphite codegen"}, {"sha": "0ac70aea836060648d139e1ddb37c6769ecea5b1", "filename": "gcc/testsuite/gcc.dg/gomp/pr82374.c", "status": "added", "additions": 31, "deletions": 0, "changes": 31, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/5c38262d95bedc091083cc881d9e21cd1f215a9a/gcc%2Ftestsuite%2Fgcc.dg%2Fgomp%2Fpr82374.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/5c38262d95bedc091083cc881d9e21cd1f215a9a/gcc%2Ftestsuite%2Fgcc.dg%2Fgomp%2Fpr82374.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgcc.dg%2Fgomp%2Fpr82374.c?ref=5c38262d95bedc091083cc881d9e21cd1f215a9a", "patch": "@@ -0,0 +1,31 @@\n+/* PR tree-optimization/82374 */\n+/* { dg-do compile } */\n+/* { dg-options \"-O2 -fno-tree-vectorize -fdump-tree-vect-details\" } */\n+/* { dg-additional-options \"-mavx -mno-avx2\" { target i?86-*-* x86_64-*-* } } */\n+/* { dg-additional-options \"-mvsx\" { target powerpc_vsx_ok } } */\n+\n+#define SIZE (1024 * 1024 * 1024)\n+\n+float a[SIZE];\n+float b[SIZE];\n+float c[SIZE];\n+float d[SIZE];\n+\n+__attribute__((optimize (\"O2\", \"tree-vectorize\"))) void\n+foo (void)\n+{\n+  int i;\n+#pragma omp parallel for\n+  for (i = 0; i < SIZE; i++)\n+    c[i] = a[i] + b[i];\n+}\n+\n+__attribute__((optimize (\"O2\", \"tree-vectorize\"))) void\n+bar (void)\n+{\n+  int i;\n+  for (i = 0; i < SIZE; i++)\n+    d[i] = a[i] + b[i];\n+}\n+\n+/* { dg-final { scan-tree-dump-times \"vectorized 1 loops\" 2 \"vect\" { target { { i?86-*-* x86_64-*-* } || { powerpc_vsx_ok } } } } } */"}]}