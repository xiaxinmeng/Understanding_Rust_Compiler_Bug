{"sha": "1916c916caf5b22b43ba62974586ffbd3b89b406", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6MTkxNmM5MTZjYWY1YjIyYjQzYmE2Mjk3NDU4NmZmYmQzYjg5YjQwNg==", "commit": {"author": {"name": "Volker Reichelt", "email": "reichelt@netcologne.de", "date": "2007-03-08T07:31:47Z"}, "committer": {"name": "Volker Reichelt", "email": "reichelt@gcc.gnu.org", "date": "2007-03-08T07:31:47Z"}, "message": "re PR c++/30852 (Trouble with __builtin_offsetof and volatile)\n\n\tPR c++/30852\n\t* c-common.c (fold_offsetof_1): Handle COMPOUND_EXPR.\n\n\t* semantics.c (finish_offsetof): Handle COMPOUND_EXPR.\n\n\t* g++.dg/ext/offsetof1.C: Add cases with volatile.\n\nFrom-SVN: r122686", "tree": {"sha": "383e9344ece683592f3f56bb28e93c5962c79459", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/383e9344ece683592f3f56bb28e93c5962c79459"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/1916c916caf5b22b43ba62974586ffbd3b89b406", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/1916c916caf5b22b43ba62974586ffbd3b89b406", "html_url": "https://github.com/Rust-GCC/gccrs/commit/1916c916caf5b22b43ba62974586ffbd3b89b406", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/1916c916caf5b22b43ba62974586ffbd3b89b406/comments", "author": null, "committer": null, "parents": [{"sha": "cc891727f0647d3123c9776250dc08edeec91e51", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/cc891727f0647d3123c9776250dc08edeec91e51", "html_url": "https://github.com/Rust-GCC/gccrs/commit/cc891727f0647d3123c9776250dc08edeec91e51"}], "stats": {"total": 22, "additions": 21, "deletions": 1}, "files": [{"sha": "76b69f5711852c68d4581533ebe196bd073e2c9b", "filename": "gcc/ChangeLog", "status": "modified", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/1916c916caf5b22b43ba62974586ffbd3b89b406/gcc%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/1916c916caf5b22b43ba62974586ffbd3b89b406/gcc%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2FChangeLog?ref=1916c916caf5b22b43ba62974586ffbd3b89b406", "patch": "@@ -1,3 +1,8 @@\n+2007-03-08  Volker Reichelt  <reichelt@netcologne.de>\n+\n+\tPR c++/30852\n+\t* c-common.c (fold_offsetof_1): Handle COMPOUND_EXPR.\n+\n 2007-03-08  Alexandre Oliva  <aoliva@redhat.com>\n \n \t* c-decl.c (grokdeclarator): Disable warnings for anonymous"}, {"sha": "0bcd462ddfc08466fcd3d5fccad0e946359f8c8c", "filename": "gcc/c-common.c", "status": "modified", "additions": 6, "deletions": 0, "changes": 6, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/1916c916caf5b22b43ba62974586ffbd3b89b406/gcc%2Fc-common.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/1916c916caf5b22b43ba62974586ffbd3b89b406/gcc%2Fc-common.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fc-common.c?ref=1916c916caf5b22b43ba62974586ffbd3b89b406", "patch": "@@ -6443,6 +6443,12 @@ fold_offsetof_1 (tree expr, tree stop_ref)\n       off = size_binop (MULT_EXPR, TYPE_SIZE_UNIT (TREE_TYPE (expr)), t);\n       break;\n \n+    case COMPOUND_EXPR:\n+      /* Handle static members of volatile structs.  */\n+      t = TREE_OPERAND (expr, 1);\n+      gcc_assert (TREE_CODE (t) == VAR_DECL);\n+      return fold_offsetof_1 (t, stop_ref);\n+\n     default:\n       gcc_unreachable ();\n     }"}, {"sha": "38722840a8a73d9642d9bf846686c4eb0409f602", "filename": "gcc/cp/ChangeLog", "status": "modified", "additions": 3, "deletions": 0, "changes": 3, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/1916c916caf5b22b43ba62974586ffbd3b89b406/gcc%2Fcp%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/1916c916caf5b22b43ba62974586ffbd3b89b406/gcc%2Fcp%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fcp%2FChangeLog?ref=1916c916caf5b22b43ba62974586ffbd3b89b406", "patch": "@@ -1,5 +1,8 @@\n 2007-03-08  Volker Reichelt  <reichelt@netcologne.de>\n \n+\tPR c++/30852\n+\t* semantics.c (finish_offsetof): Handle COMPOUND_EXPR.\n+\n \tPR c++/30534\n \t* pt.c (any_template_arguments_need_structural_equality_p):\n \tRobustify."}, {"sha": "30f4214e5dbd612c6ed38bdf5c3da5b85348f024", "filename": "gcc/cp/semantics.c", "status": "modified", "additions": 2, "deletions": 1, "changes": 3, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/1916c916caf5b22b43ba62974586ffbd3b89b406/gcc%2Fcp%2Fsemantics.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/1916c916caf5b22b43ba62974586ffbd3b89b406/gcc%2Fcp%2Fsemantics.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fcp%2Fsemantics.c?ref=1916c916caf5b22b43ba62974586ffbd3b89b406", "patch": "@@ -2933,7 +2933,8 @@ finish_offsetof (tree expr)\n       || TREE_CODE (TREE_TYPE (expr)) == METHOD_TYPE\n       || TREE_CODE (TREE_TYPE (expr)) == UNKNOWN_TYPE)\n     {\n-      if (TREE_CODE (expr) == COMPONENT_REF)\n+      if (TREE_CODE (expr) == COMPONENT_REF\n+\t  || TREE_CODE (expr) == COMPOUND_EXPR)\n \texpr = TREE_OPERAND (expr, 1);\n       error (\"cannot apply %<offsetof%> to member function %qD\", expr);\n       return error_mark_node;"}, {"sha": "81dd95db41bd9593d5e864be5a5d09544897ff45", "filename": "gcc/testsuite/ChangeLog", "status": "modified", "additions": 3, "deletions": 0, "changes": 3, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/1916c916caf5b22b43ba62974586ffbd3b89b406/gcc%2Ftestsuite%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/1916c916caf5b22b43ba62974586ffbd3b89b406/gcc%2Ftestsuite%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2FChangeLog?ref=1916c916caf5b22b43ba62974586ffbd3b89b406", "patch": "@@ -1,5 +1,8 @@\n 2007-03-08  Volker Reichelt  <reichelt@netcologne.de>\n \n+\tPR c++/30852\n+\t* g++.dg/ext/offsetof1.C: Add cases with volatile.\n+\n \tPR c++/30534\n \t* g++.dg/template/arg5.C: New test.\n "}, {"sha": "1468c0a7c06864ef7fb969f9b105313936c85692", "filename": "gcc/testsuite/g++.dg/ext/offsetof1.C", "status": "modified", "additions": 2, "deletions": 0, "changes": 2, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/1916c916caf5b22b43ba62974586ffbd3b89b406/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Fext%2Foffsetof1.C", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/1916c916caf5b22b43ba62974586ffbd3b89b406/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Fext%2Foffsetof1.C", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Fext%2Foffsetof1.C?ref=1916c916caf5b22b43ba62974586ffbd3b89b406", "patch": "@@ -8,8 +8,10 @@ struct bar {\n };\n \n int a = __builtin_offsetof(bar, foo);  // { dg-error \"static data member\" }\n+int av = __builtin_offsetof(volatile bar, foo);  // { dg-error \"static data member\" }\n int b = __builtin_offsetof(bar, baz);  // { dg-error \"member function\" }\n int b0 = __builtin_offsetof(bar, baz[0]);  // { dg-error \"function\" }\n+int bv0 = __builtin_offsetof(volatile bar, baz[0]);  // { dg-error \"function\" }\n int c = __builtin_offsetof(bar, ~bar);  // { dg-error \"member function\" }\n \n typedef int I;"}]}