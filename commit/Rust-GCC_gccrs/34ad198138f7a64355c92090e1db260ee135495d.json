{"sha": "34ad198138f7a64355c92090e1db260ee135495d", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6MzRhZDE5ODEzOGY3YTY0MzU1YzkyMDkwZTFkYjI2MGVlMTM1NDk1ZA==", "commit": {"author": {"name": "Bill Schmidt", "email": "wschmidt@linux.ibm.com", "date": "2021-07-27T18:43:57Z"}, "committer": {"name": "Bill Schmidt", "email": "wschmidt@linux.ibm.com", "date": "2021-08-23T21:00:32Z"}, "message": "rs6000: Incorporate new builtins code into the build machinery\n\n2021-07-27  Bill Schmidt  <wschmidt@linux.ibm.com>\n\ngcc/\n\t* config.gcc (powerpc*-*-*): Add rs6000-builtins.o to extra_objs.\n\t* config/rs6000/rs6000-gen-builtins.c (main): Close init_file\n\tlast.\n\t* config/rs6000/t-rs6000 (rs6000-gen-builtins.o): New target.\n\t(rbtree.o): Likewise.\n\t(rs6000-gen-builtins): Likewise.\n\t(rs6000-builtins.c): Likewise.\n\t(rs6000-builtins.h): Likewise.\n\t(rs6000.o): Add dependency.\n\t(EXTRA_HEADERS): Add rs6000-vecdefines.h.\n\t(rs6000-vecdefines.h): New target.\n\t(rs6000-builtins.o): Likewise.\n\t(rs6000-call.o): Add rs6000-builtins.h as a dependency.\n\t(rs6000-c.o): Likewise.", "tree": {"sha": "c1d52abd5aedd1b6f1c75c14cb4868c42d6dd07f", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/c1d52abd5aedd1b6f1c75c14cb4868c42d6dd07f"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/34ad198138f7a64355c92090e1db260ee135495d", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/34ad198138f7a64355c92090e1db260ee135495d", "html_url": "https://github.com/Rust-GCC/gccrs/commit/34ad198138f7a64355c92090e1db260ee135495d", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/34ad198138f7a64355c92090e1db260ee135495d/comments", "author": null, "committer": null, "parents": [{"sha": "30c335ac44ecb4f17645925360177618763d7c48", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/30c335ac44ecb4f17645925360177618763d7c48", "html_url": "https://github.com/Rust-GCC/gccrs/commit/30c335ac44ecb4f17645925360177618763d7c48"}], "stats": {"total": 51, "additions": 45, "deletions": 6}, "files": [{"sha": "a05c07e92b663430c066d9e0b6ef45a585cb2312", "filename": "gcc/config.gcc", "status": "modified", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/34ad198138f7a64355c92090e1db260ee135495d/gcc%2Fconfig.gcc", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/34ad198138f7a64355c92090e1db260ee135495d/gcc%2Fconfig.gcc", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fconfig.gcc?ref=34ad198138f7a64355c92090e1db260ee135495d", "patch": "@@ -476,6 +476,7 @@ powerpc*-*-*)\n \tcpu_type=rs6000\n \textra_objs=\"rs6000-string.o rs6000-p8swap.o rs6000-logue.o\"\n \textra_objs=\"${extra_objs} rs6000-call.o rs6000-pcrel-opt.o\"\n+\textra_objs=\"${extra_objs} rs6000-builtins.o\"\n \textra_headers=\"ppc-asm.h altivec.h htmintrin.h htmxlintrin.h\"\n \textra_headers=\"${extra_headers} bmi2intrin.h bmiintrin.h\"\n \textra_headers=\"${extra_headers} xmmintrin.h mm_malloc.h emmintrin.h\""}, {"sha": "8a7505b1b6fe36ddbce882d6b348ea80a544bb0d", "filename": "gcc/config/rs6000/rs6000-gen-builtins.c", "status": "modified", "additions": 3, "deletions": 1, "changes": 4, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/34ad198138f7a64355c92090e1db260ee135495d/gcc%2Fconfig%2Frs6000%2Frs6000-gen-builtins.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/34ad198138f7a64355c92090e1db260ee135495d/gcc%2Fconfig%2Frs6000%2Frs6000-gen-builtins.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fconfig%2Frs6000%2Frs6000-gen-builtins.c?ref=34ad198138f7a64355c92090e1db260ee135495d", "patch": "@@ -3005,9 +3005,11 @@ main (int argc, const char **argv)\n       exit (1);\n     }\n \n+  /* Always close init_file last.  This avoids race conditions in the\n+     build machinery.  See comments in t-rs6000.  */\n   fclose (header_file);\n-  fclose (init_file);\n   fclose (defines_file);\n+  fclose (init_file);\n \n   return 0;\n }"}, {"sha": "e0e8ab8d828e425d81aedbcc24440f2dfe217ef4", "filename": "gcc/config/rs6000/t-rs6000", "status": "modified", "additions": 41, "deletions": 5, "changes": 46, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/34ad198138f7a64355c92090e1db260ee135495d/gcc%2Fconfig%2Frs6000%2Ft-rs6000", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/34ad198138f7a64355c92090e1db260ee135495d/gcc%2Fconfig%2Frs6000%2Ft-rs6000", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fconfig%2Frs6000%2Ft-rs6000?ref=34ad198138f7a64355c92090e1db260ee135495d", "patch": "@@ -27,10 +27,6 @@ rs6000-pcrel-opt.o: $(srcdir)/config/rs6000/rs6000-pcrel-opt.c\n \t$(COMPILE) $<\n \t$(POSTCOMPILE)\n \n-rs6000-c.o: $(srcdir)/config/rs6000/rs6000-c.c\n-\t$(COMPILE) $<\n-\t$(POSTCOMPILE)\n-\n rs6000-string.o: $(srcdir)/config/rs6000/rs6000-string.c\n \t$(COMPILE) $<\n \t$(POSTCOMPILE)\n@@ -47,7 +43,47 @@ rs6000-logue.o: $(srcdir)/config/rs6000/rs6000-logue.c\n \t$(COMPILE) $<\n \t$(POSTCOMPILE)\n \n-rs6000-call.o: $(srcdir)/config/rs6000/rs6000-call.c\n+rs6000-gen-builtins.o: $(srcdir)/config/rs6000/rs6000-gen-builtins.c\n+\t$(COMPILE) $<\n+\t$(POSTCOMPILE)\n+\n+rbtree.o: $(srcdir)/config/rs6000/rbtree.c\n+\t$(COMPILE) $<\n+\t$(POSTCOMPILE)\n+\n+rs6000-gen-builtins: rs6000-gen-builtins.o rbtree.o\n+\t$(LINKER_FOR_BUILD) $(BUILD_LINKERFLAGS) $(BUILD_LDFLAGS) -o $@ \\\n+\t    $(filter-out $(BUILD_LIBDEPS), $^) $(BUILD_LIBS)\n+\n+# TODO: Whenever GNU make 4.3 is the minimum required, we should use\n+# grouped targets on this:\n+#    rs6000-builtins.c rs6000-builtins.h rs6000-vecdefines.h &: <deps>\n+#       <recipe>\n+# For now, the header files depend on rs6000-builtins.c, which avoids\n+# races because the .c file is closed last in rs6000-gen-builtins.c.\n+rs6000-builtins.c: rs6000-gen-builtins \\\n+\t\t   $(srcdir)/config/rs6000/rs6000-builtin-new.def \\\n+\t\t   $(srcdir)/config/rs6000/rs6000-overload.def\n+\t./rs6000-gen-builtins $(srcdir)/config/rs6000/rs6000-builtin-new.def \\\n+\t\t$(srcdir)/config/rs6000/rs6000-overload.def rs6000-builtins.h \\\n+\t\trs6000-builtins.c rs6000-vecdefines.h\n+\n+rs6000-builtins.h: rs6000-builtins.c\n+\n+rs6000.o: rs6000-builtins.h\n+\n+EXTRA_HEADERS += rs6000-vecdefines.h\n+rs6000-vecdefines.h: rs6000-builtins.c\n+\n+rs6000-builtins.o: rs6000-builtins.c\n+\t$(COMPILE) $<\n+\t$(POSTCOMPILE)\n+\n+rs6000-call.o: $(srcdir)/config/rs6000/rs6000-call.c rs6000-builtins.h\n+\t$(COMPILE) $<\n+\t$(POSTCOMPILE)\n+\n+rs6000-c.o: $(srcdir)/config/rs6000/rs6000-c.c rs6000-builtins.h\n \t$(COMPILE) $<\n \t$(POSTCOMPILE)\n "}]}