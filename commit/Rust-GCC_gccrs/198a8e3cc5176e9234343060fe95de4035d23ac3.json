{"sha": "198a8e3cc5176e9234343060fe95de4035d23ac3", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6MTk4YThlM2NjNTE3NmU5MjM0MzQzMDYwZmU5NWRlNDAzNWQyM2FjMw==", "commit": {"author": {"name": "Will Schmidt", "email": "will_schmidt@vnet.ibm.com", "date": "2017-10-30T14:10:17Z"}, "committer": {"name": "Will Schmidt", "email": "willschm@gcc.gnu.org", "date": "2017-10-30T14:10:17Z"}, "message": "rs6000.c (rs6000_gimple_fold_builtin): Add support for gimple folding of vec_madd() intrinsics.\n\n[gcc]\n\n2017-10-30  Will Schmidt <will_schmidt@vnet.ibm.com>\n\n\t* config/rs6000/rs6000.c (rs6000_gimple_fold_builtin): Add support for\n\tgimple folding of vec_madd() intrinsics.\n\t* config/rs6000/altivec.md (mulv8hi3): Rename altivec_vmladduhm to\n\tfmav8hi4.  (altivec_vmladduhm): Rename to fmav8hi4.\n\t* config/rs6000/rs6000-builtin.def: Rename vmladduhm to fmav8hi4\n\nFrom-SVN: r254221", "tree": {"sha": "b3e5abd767686c42ac205d27b8e1f14cc921393f", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/b3e5abd767686c42ac205d27b8e1f14cc921393f"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/198a8e3cc5176e9234343060fe95de4035d23ac3", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/198a8e3cc5176e9234343060fe95de4035d23ac3", "html_url": "https://github.com/Rust-GCC/gccrs/commit/198a8e3cc5176e9234343060fe95de4035d23ac3", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/198a8e3cc5176e9234343060fe95de4035d23ac3/comments", "author": {"login": "willschm", "id": 44359, "node_id": "MDQ6VXNlcjQ0MzU5", "avatar_url": "https://avatars.githubusercontent.com/u/44359?v=4", "gravatar_id": "", "url": "https://api.github.com/users/willschm", "html_url": "https://github.com/willschm", "followers_url": "https://api.github.com/users/willschm/followers", "following_url": "https://api.github.com/users/willschm/following{/other_user}", "gists_url": "https://api.github.com/users/willschm/gists{/gist_id}", "starred_url": "https://api.github.com/users/willschm/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/willschm/subscriptions", "organizations_url": "https://api.github.com/users/willschm/orgs", "repos_url": "https://api.github.com/users/willschm/repos", "events_url": "https://api.github.com/users/willschm/events{/privacy}", "received_events_url": "https://api.github.com/users/willschm/received_events", "type": "User", "site_admin": false}, "committer": null, "parents": [{"sha": "78effffca5f505fb8acb0632787b329247d82c79", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/78effffca5f505fb8acb0632787b329247d82c79", "html_url": "https://github.com/Rust-GCC/gccrs/commit/78effffca5f505fb8acb0632787b329247d82c79"}], "stats": {"total": 31, "additions": 28, "deletions": 3}, "files": [{"sha": "c690e338484a5086f705795c8ac2782a48eba51e", "filename": "gcc/ChangeLog", "status": "modified", "additions": 8, "deletions": 0, "changes": 8, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/198a8e3cc5176e9234343060fe95de4035d23ac3/gcc%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/198a8e3cc5176e9234343060fe95de4035d23ac3/gcc%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2FChangeLog?ref=198a8e3cc5176e9234343060fe95de4035d23ac3", "patch": "@@ -1,3 +1,11 @@\n+2017-10-30  Will Schmidt  <will_schmidt@vnet.ibm.com>\n+\n+\t* config/rs6000/rs6000.c (rs6000_gimple_fold_builtin): Add support for\n+\tgimple folding of vec_madd() intrinsics.\n+\t* config/rs6000/altivec.md (mulv8hi3): Rename altivec_vmladduhm to\n+\tfmav8hi4.  (altivec_vmladduhm): Rename to fmav8hi4.\n+\t* config/rs6000/rs6000-builtin.def: Rename vmladduhm to fmav8hi4\n+\n 2017-10-30  Richard Biener  <rguenther@suse.de>\n \n \tPR tree-optimization/82762"}, {"sha": "b2f173dd03be1a8954507a83b113daa523770f14", "filename": "gcc/config/rs6000/altivec.md", "status": "modified", "additions": 3, "deletions": 2, "changes": 5, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/198a8e3cc5176e9234343060fe95de4035d23ac3/gcc%2Fconfig%2Frs6000%2Faltivec.md", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/198a8e3cc5176e9234343060fe95de4035d23ac3/gcc%2Fconfig%2Frs6000%2Faltivec.md", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fconfig%2Frs6000%2Faltivec.md?ref=198a8e3cc5176e9234343060fe95de4035d23ac3", "patch": "@@ -795,11 +795,12 @@\n   rtx zero = gen_reg_rtx (V8HImode);\n \n   emit_insn (gen_altivec_vspltish (zero, const0_rtx));\n-  emit_insn (gen_altivec_vmladduhm(operands[0], operands[1], operands[2], zero));\n+  emit_insn (gen_fmav8hi4 (operands[0], operands[1], operands[2], zero));\n \n   DONE;\n })\n \n+\n ;; Fused multiply subtract \n (define_insn \"*altivec_vnmsubfp\"\n   [(set (match_operand:V4SF 0 \"register_operand\" \"=v\")\n@@ -936,7 +937,7 @@\n   \"vmhraddshs %0,%1,%2,%3\"\n   [(set_attr \"type\" \"veccomplex\")])\n \n-(define_insn \"altivec_vmladduhm\"\n+(define_insn \"fmav8hi4\"\n   [(set (match_operand:V8HI 0 \"register_operand\" \"=v\")\n         (plus:V8HI (mult:V8HI (match_operand:V8HI 1 \"register_operand\" \"v\")\n \t\t   \t      (match_operand:V8HI 2 \"register_operand\" \"v\"))"}, {"sha": "c8a425cba7ea6a7f78b8b20ba2b0d761cb13933b", "filename": "gcc/config/rs6000/rs6000-builtin.def", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/198a8e3cc5176e9234343060fe95de4035d23ac3/gcc%2Fconfig%2Frs6000%2Frs6000-builtin.def", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/198a8e3cc5176e9234343060fe95de4035d23ac3/gcc%2Fconfig%2Frs6000%2Frs6000-builtin.def", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fconfig%2Frs6000%2Frs6000-builtin.def?ref=198a8e3cc5176e9234343060fe95de4035d23ac3", "patch": "@@ -961,7 +961,7 @@ BU_SPECIAL_X (RS6000_BUILTIN_NONE, NULL, 0, RS6000_BTC_MISC)\n BU_ALTIVEC_3 (VMADDFP,        \"vmaddfp\",        FP,    \tfmav4sf4)\n BU_ALTIVEC_3 (VMHADDSHS,      \"vmhaddshs\",      SAT,   \taltivec_vmhaddshs)\n BU_ALTIVEC_3 (VMHRADDSHS,     \"vmhraddshs\",     SAT,   \taltivec_vmhraddshs)\n-BU_ALTIVEC_3 (VMLADDUHM,      \"vmladduhm\",      CONST, \taltivec_vmladduhm)\n+BU_ALTIVEC_3 (VMLADDUHM,      \"vmladduhm\",      CONST, \tfmav8hi4)\n BU_ALTIVEC_3 (VMSUMUBM,       \"vmsumubm\",       CONST, \taltivec_vmsumubm)\n BU_ALTIVEC_3 (VMSUMMBM,       \"vmsummbm\",       CONST, \taltivec_vmsummbm)\n BU_ALTIVEC_3 (VMSUMUHM,       \"vmsumuhm\",       CONST, \taltivec_vmsumuhm)"}, {"sha": "182dc30828764e18d55bc8b9677ff5dbc990b9d3", "filename": "gcc/config/rs6000/rs6000.c", "status": "modified", "additions": 16, "deletions": 0, "changes": 16, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/198a8e3cc5176e9234343060fe95de4035d23ac3/gcc%2Fconfig%2Frs6000%2Frs6000.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/198a8e3cc5176e9234343060fe95de4035d23ac3/gcc%2Fconfig%2Frs6000%2Frs6000.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fconfig%2Frs6000%2Frs6000.c?ref=198a8e3cc5176e9234343060fe95de4035d23ac3", "patch": "@@ -16647,6 +16647,22 @@ rs6000_gimple_fold_builtin (gimple_stmt_iterator *gsi)\n \t gsi_replace (gsi, g, true);\n \t return true;\n       }\n+\n+    /* Vector Fused multiply-add (fma).  */\n+    case ALTIVEC_BUILTIN_VMADDFP:\n+    case VSX_BUILTIN_XVMADDDP:\n+    case ALTIVEC_BUILTIN_VMLADDUHM:\n+      {\n+       arg0 = gimple_call_arg (stmt, 0);\n+       arg1 = gimple_call_arg (stmt, 1);\n+       tree arg2 = gimple_call_arg (stmt, 2);\n+       lhs = gimple_call_lhs (stmt);\n+       gimple *g = gimple_build_assign (lhs, FMA_EXPR , arg0, arg1, arg2);\n+       gimple_set_location (g, gimple_location (stmt));\n+       gsi_replace (gsi, g, true);\n+       return true;\n+      }\n+\n     default:\n \tif (TARGET_DEBUG_BUILTIN)\n \t   fprintf (stderr, \"gimple builtin intrinsic not matched:%d %s %s\\n\","}]}