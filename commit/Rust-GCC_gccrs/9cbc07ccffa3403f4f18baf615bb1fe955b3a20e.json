{"sha": "9cbc07ccffa3403f4f18baf615bb1fe955b3a20e", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6OWNiYzA3Y2NmZmEzNDAzZjRmMThiYWY2MTViYjFmZTk1NWIzYTIwZQ==", "commit": {"author": {"name": "Daniel Santos", "email": "daniel.santos@pobox.com", "date": "2017-07-24T21:59:57Z"}, "committer": {"name": "Daniel Santos", "email": "dansan@gcc.gnu.org", "date": "2017-07-24T21:59:57Z"}, "message": "PR testsuite/80759 Fix -mcall-ms2sysv-xlogues on Darwin and Solaris\n\n2017-07-24  Daniel Santos  <daniel.santos@pobox.com>\n\n\tPR testsuite/80759\n\t* config.host: include i386/t-msabi for darwin and solaris.\n\t* config/i386/i386-asm.h\n\t(ELFFN): Rename to FN_TYPE.\n\t(FN_SIZE): New macro.\n\t(FN_HIDDEN): Likewise.\n\t(ASMNAME): Likewise.\n\t(FUNC_START): Rename to FUNC_BEGIN, use ASMNAME, replace .global with\n\t.globl.\n\t(HIDDEN_FUNC): Use ASMNAME and .globl instead of .global.\n\t(SSE_SAVE): Convert to cpp macro, hard-code offset (always 0x60).\n\t* config/i386/resms64.S: Use SSE_SAVE as cpp macro instead of gas\n\t.macro.\n\t* config/i386/resms64f.S: Likewise.\n\t* config/i386/resms64fx.S: Likewise.\n\t* config/i386/resms64x.S: Likewise.\n\t* config/i386/savms64.S: Likewise.\n\t* config/i386/savms64f.S: Likewise.\n\nFrom-SVN: r250488", "tree": {"sha": "e297b5bb11ee15fc43734a7566a4d8f7dfa20944", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/e297b5bb11ee15fc43734a7566a4d8f7dfa20944"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/9cbc07ccffa3403f4f18baf615bb1fe955b3a20e", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/9cbc07ccffa3403f4f18baf615bb1fe955b3a20e", "html_url": "https://github.com/Rust-GCC/gccrs/commit/9cbc07ccffa3403f4f18baf615bb1fe955b3a20e", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/9cbc07ccffa3403f4f18baf615bb1fe955b3a20e/comments", "author": {"login": "daniel-santos", "id": 980562, "node_id": "MDQ6VXNlcjk4MDU2Mg==", "avatar_url": "https://avatars.githubusercontent.com/u/980562?v=4", "gravatar_id": "", "url": "https://api.github.com/users/daniel-santos", "html_url": "https://github.com/daniel-santos", "followers_url": "https://api.github.com/users/daniel-santos/followers", "following_url": "https://api.github.com/users/daniel-santos/following{/other_user}", "gists_url": "https://api.github.com/users/daniel-santos/gists{/gist_id}", "starred_url": "https://api.github.com/users/daniel-santos/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/daniel-santos/subscriptions", "organizations_url": "https://api.github.com/users/daniel-santos/orgs", "repos_url": "https://api.github.com/users/daniel-santos/repos", "events_url": "https://api.github.com/users/daniel-santos/events{/privacy}", "received_events_url": "https://api.github.com/users/daniel-santos/received_events", "type": "User", "site_admin": false}, "committer": null, "parents": [{"sha": "1993098939aa6033abb75961127c25e316864501", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/1993098939aa6033abb75961127c25e316864501", "html_url": "https://github.com/Rust-GCC/gccrs/commit/1993098939aa6033abb75961127c25e316864501"}], "stats": {"total": 128, "additions": 85, "deletions": 43}, "files": [{"sha": "cb25039b1a7f95c945f3e20fa0431e0461c03afc", "filename": "libgcc/ChangeLog", "status": "modified", "additions": 21, "deletions": 0, "changes": 21, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/9cbc07ccffa3403f4f18baf615bb1fe955b3a20e/libgcc%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/9cbc07ccffa3403f4f18baf615bb1fe955b3a20e/libgcc%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libgcc%2FChangeLog?ref=9cbc07ccffa3403f4f18baf615bb1fe955b3a20e", "patch": "@@ -1,3 +1,24 @@\n+2017-07-24  Daniel Santos  <daniel.santos@pobox.com>\n+\n+\tPR testsuite/80759\n+\t* config.host: include i386/t-msabi for darwin and solaris.\n+\t* config/i386/i386-asm.h\n+\t(ELFFN): Rename to FN_TYPE.\n+\t(FN_SIZE): New macro.\n+\t(FN_HIDDEN): Likewise.\n+\t(ASMNAME): Likewise.\n+\t(FUNC_START): Rename to FUNC_BEGIN, use ASMNAME, replace .global with\n+\t.globl.\n+\t(HIDDEN_FUNC): Use ASMNAME and .globl instead of .global.\n+\t(SSE_SAVE): Convert to cpp macro, hard-code offset (always 0x60).\n+\t* config/i386/resms64.S: Use SSE_SAVE as cpp macro instead of gas\n+\t.macro.\n+\t* config/i386/resms64f.S: Likewise.\n+\t* config/i386/resms64fx.S: Likewise.\n+\t* config/i386/resms64x.S: Likewise.\n+\t* config/i386/savms64.S: Likewise.\n+\t* config/i386/savms64f.S: Likewise.\n+\n 2017-07-19  John Marino  <gnugcc@marino.st>\n \n \t* config/i386/dragonfly-unwind.h: Handle sigtramp relocation."}, {"sha": "ae8836e88918ec63a3b3474fc2617fef56e48cfb", "filename": "libgcc/config.host", "status": "modified", "additions": 3, "deletions": 3, "changes": 6, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/9cbc07ccffa3403f4f18baf615bb1fe955b3a20e/libgcc%2Fconfig.host", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/9cbc07ccffa3403f4f18baf615bb1fe955b3a20e/libgcc%2Fconfig.host", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libgcc%2Fconfig.host?ref=9cbc07ccffa3403f4f18baf615bb1fe955b3a20e", "patch": "@@ -581,12 +581,12 @@ hppa*-*-openbsd*)\n \ttmake_file=\"$tmake_file pa/t-openbsd\"\n \t;;\n i[34567]86-*-darwin*)\n-\ttmake_file=\"$tmake_file i386/t-crtpc t-crtfm\"\n+\ttmake_file=\"$tmake_file i386/t-crtpc t-crtfm i386/t-msabi\"\n \ttm_file=\"$tm_file i386/darwin-lib.h\"\n \textra_parts=\"$extra_parts crtprec32.o crtprec64.o crtprec80.o crtfastmath.o\"\n \t;;\n x86_64-*-darwin*)\n-\ttmake_file=\"$tmake_file i386/t-crtpc t-crtfm\"\n+\ttmake_file=\"$tmake_file i386/t-crtpc t-crtfm i386/t-msabi\"\n \ttm_file=\"$tm_file i386/darwin-lib.h\"\n \textra_parts=\"$extra_parts crtprec32.o crtprec64.o crtprec80.o crtfastmath.o\"\n \t;;\n@@ -663,7 +663,7 @@ i[34567]86-*-rtems*)\n \textra_parts=\"$extra_parts crti.o crtn.o\"\n \t;;\n i[34567]86-*-solaris2* | x86_64-*-solaris2.1[0-9]*)\n-\ttmake_file=\"$tmake_file i386/t-crtpc t-crtfm\"\n+\ttmake_file=\"$tmake_file i386/t-crtpc t-crtfm i386/t-msabi\"\n \textra_parts=\"$extra_parts crtprec32.o crtprec64.o crtprec80.o crtfastmath.o\"\n \ttm_file=\"${tm_file} i386/elf-lib.h\"\n \tmd_unwind_header=i386/sol2-unwind.h"}, {"sha": "1387fd24b4f9c2128a18c25fc74d0fe172187d0d", "filename": "libgcc/config/i386/i386-asm.h", "status": "modified", "additions": 55, "deletions": 34, "changes": 89, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/9cbc07ccffa3403f4f18baf615bb1fe955b3a20e/libgcc%2Fconfig%2Fi386%2Fi386-asm.h", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/9cbc07ccffa3403f4f18baf615bb1fe955b3a20e/libgcc%2Fconfig%2Fi386%2Fi386-asm.h", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libgcc%2Fconfig%2Fi386%2Fi386-asm.h?ref=9cbc07ccffa3403f4f18baf615bb1fe955b3a20e", "patch": "@@ -26,22 +26,45 @@ see the files COPYING3 and COPYING.RUNTIME respectively.  If not, see\n #ifndef I386_ASM_H\n #define I386_ASM_H\n \n+#include \"auto-host.h\"\n+\n+/* These macros currently support GNU/Linux, Solaris and Darwin.  */\n+\n #ifdef __ELF__\n-# define ELFFN(fn) .type fn,@function\n+# define FN_TYPE(fn) .type fn,@function\n+# define FN_SIZE(fn) .size fn,.-fn\n+# ifdef HAVE_GAS_HIDDEN\n+#  define FN_HIDDEN(fn) .hidden fn\n+# endif\n+#else\n+# define FN_TYPE(fn)\n+# define FN_SIZE(fn)\n+#endif\n+\n+#ifndef FN_HIDDEN\n+# define FN_HIDDEN(fn)\n+#endif\n+\n+#ifdef __USER_LABEL_PREFIX__\n+# define ASMNAME2(prefix, name)\tprefix ## name\n+# define ASMNAME1(prefix, name)\tASMNAME2(prefix, name)\n+# define ASMNAME(name)\t\tASMNAME1(__USER_LABEL_PREFIX__, name)\n #else\n-# define ELFFN(fn)\n+# define ASMNAME(name)\t\tname\n #endif\n \n-#define FUNC_START(fn)\t\\\n-\t.global fn;\t\\\n-\tELFFN (fn);\t\\\n-fn:\n+#define FUNC_BEGIN(fn)\t\t\\\n+\t.globl ASMNAME(fn);\t\\\n+\tFN_TYPE (ASMNAME(fn));\t\\\n+ASMNAME(fn):\n \n-#define HIDDEN_FUNC(fn)\\\n-\tFUNC_START (fn)\t\\\n-\t.hidden fn;\t\\\n+#define HIDDEN_FUNC(fn)\t\t\\\n+\t.globl ASMNAME(fn);\t\\\n+\tFN_TYPE(ASMNAME(fn));\t\\\n+\tFN_HIDDEN(ASMNAME(fn));\t\\\n+ASMNAME(fn):\n \n-#define FUNC_END(fn) .size fn,.-fn\n+#define FUNC_END(fn) FN_SIZE(ASMNAME(fn))\n \n #ifdef __SSE2__\n # ifdef __AVX__\n@@ -51,32 +74,30 @@ see the files COPYING3 and COPYING.RUNTIME respectively.  If not, see\n # endif\n \n /* Save SSE registers 6-15. off is the offset of rax to get to xmm6.  */\n-.macro SSE_SAVE off=0\n-\tMOVAPS %xmm15,(\\off - 0x90)(%rax)\n-\tMOVAPS %xmm14,(\\off - 0x80)(%rax)\n-\tMOVAPS %xmm13,(\\off - 0x70)(%rax)\n-\tMOVAPS %xmm12,(\\off - 0x60)(%rax)\n-\tMOVAPS %xmm11,(\\off - 0x50)(%rax)\n-\tMOVAPS %xmm10,(\\off - 0x40)(%rax)\n-\tMOVAPS %xmm9, (\\off - 0x30)(%rax)\n-\tMOVAPS %xmm8, (\\off - 0x20)(%rax)\n-\tMOVAPS %xmm7, (\\off - 0x10)(%rax)\n-\tMOVAPS %xmm6, \\off(%rax)\n-.endm\n+#define SSE_SAVE\t\t   \\\n+\tMOVAPS %xmm15,-0x30(%rax); \\\n+\tMOVAPS %xmm14,-0x20(%rax); \\\n+\tMOVAPS %xmm13,-0x10(%rax); \\\n+\tMOVAPS %xmm12,     (%rax); \\\n+\tMOVAPS %xmm11, 0x10(%rax); \\\n+\tMOVAPS %xmm10, 0x20(%rax); \\\n+\tMOVAPS %xmm9,  0x30(%rax); \\\n+\tMOVAPS %xmm8,  0x40(%rax); \\\n+\tMOVAPS %xmm7,  0x50(%rax); \\\n+\tMOVAPS %xmm6,  0x60(%rax)\n \n /* Restore SSE registers 6-15. off is the offset of rsi to get to xmm6.  */\n-.macro SSE_RESTORE off=0\n-\tMOVAPS (\\off - 0x90)(%rsi), %xmm15\n-\tMOVAPS (\\off - 0x80)(%rsi), %xmm14\n-\tMOVAPS (\\off - 0x70)(%rsi), %xmm13\n-\tMOVAPS (\\off - 0x60)(%rsi), %xmm12\n-\tMOVAPS (\\off - 0x50)(%rsi), %xmm11\n-\tMOVAPS (\\off - 0x40)(%rsi), %xmm10\n-\tMOVAPS (\\off - 0x30)(%rsi), %xmm9\n-\tMOVAPS (\\off - 0x20)(%rsi), %xmm8\n-\tMOVAPS (\\off - 0x10)(%rsi), %xmm7\n-\tMOVAPS \\off(%rsi), %xmm6\n-.endm\n+#define SSE_RESTORE\t\t    \\\n+\tMOVAPS -0x30(%rsi), %xmm15; \\\n+\tMOVAPS -0x20(%rsi), %xmm14; \\\n+\tMOVAPS -0x10(%rsi), %xmm13; \\\n+\tMOVAPS      (%rsi), %xmm12; \\\n+\tMOVAPS  0x10(%rsi), %xmm11; \\\n+\tMOVAPS  0x20(%rsi), %xmm10; \\\n+\tMOVAPS  0x30(%rsi), %xmm9 ; \\\n+\tMOVAPS  0x40(%rsi), %xmm8 ; \\\n+\tMOVAPS  0x50(%rsi), %xmm7 ; \\\n+\tMOVAPS  0x60(%rsi), %xmm6\n \n #endif /* __SSE2__ */\n #endif /* I386_ASM_H */"}, {"sha": "f842c20a77ae670dd342ea4bec2b197e8cb11652", "filename": "libgcc/config/i386/resms64.S", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/9cbc07ccffa3403f4f18baf615bb1fe955b3a20e/libgcc%2Fconfig%2Fi386%2Fresms64.S", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/9cbc07ccffa3403f4f18baf615bb1fe955b3a20e/libgcc%2Fconfig%2Fi386%2Fresms64.S", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libgcc%2Fconfig%2Fi386%2Fresms64.S?ref=9cbc07ccffa3403f4f18baf615bb1fe955b3a20e", "patch": "@@ -43,7 +43,7 @@ HIDDEN_FUNC(__resms64_13)\n \tmov\t-0x48(%rsi),%rbx\n HIDDEN_FUNC(__resms64_12)\n \tmov\t-0x40(%rsi),%rdi\n-\tSSE_RESTORE off=0x60\n+\tSSE_RESTORE\n \tmov\t-0x38(%rsi),%rsi\n \tret\n FUNC_END(__resms64_12)"}, {"sha": "81946cda9449f67b064b2fbc3625fae30f14ac1f", "filename": "libgcc/config/i386/resms64f.S", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/9cbc07ccffa3403f4f18baf615bb1fe955b3a20e/libgcc%2Fconfig%2Fi386%2Fresms64f.S", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/9cbc07ccffa3403f4f18baf615bb1fe955b3a20e/libgcc%2Fconfig%2Fi386%2Fresms64f.S", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libgcc%2Fconfig%2Fi386%2Fresms64f.S?ref=9cbc07ccffa3403f4f18baf615bb1fe955b3a20e", "patch": "@@ -42,7 +42,7 @@ HIDDEN_FUNC(__resms64f_13)\n \tmov\t-0x48(%rsi),%rbx\n HIDDEN_FUNC(__resms64f_12)\n \tmov\t-0x40(%rsi),%rdi\n-\tSSE_RESTORE off=0x60\n+\tSSE_RESTORE\n \tmov\t-0x38(%rsi),%rsi\n \tret\n FUNC_END(__resms64f_12)"}, {"sha": "acf34fa08371cfb6d2d7de48ccf0aa71d6c1555b", "filename": "libgcc/config/i386/resms64fx.S", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/9cbc07ccffa3403f4f18baf615bb1fe955b3a20e/libgcc%2Fconfig%2Fi386%2Fresms64fx.S", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/9cbc07ccffa3403f4f18baf615bb1fe955b3a20e/libgcc%2Fconfig%2Fi386%2Fresms64fx.S", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libgcc%2Fconfig%2Fi386%2Fresms64fx.S?ref=9cbc07ccffa3403f4f18baf615bb1fe955b3a20e", "patch": "@@ -43,7 +43,7 @@ HIDDEN_FUNC(__resms64fx_13)\n \tmov\t-0x48(%rsi),%rbx\n HIDDEN_FUNC(__resms64fx_12)\n \tmov\t-0x40(%rsi),%rdi\n-\tSSE_RESTORE off=0x60\n+\tSSE_RESTORE\n \tmov\t-0x38(%rsi),%rsi\n \tleaveq\n \tret"}, {"sha": "e27aab7d88182add1dd09a523a013c138398ee50", "filename": "libgcc/config/i386/resms64x.S", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/9cbc07ccffa3403f4f18baf615bb1fe955b3a20e/libgcc%2Fconfig%2Fi386%2Fresms64x.S", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/9cbc07ccffa3403f4f18baf615bb1fe955b3a20e/libgcc%2Fconfig%2Fi386%2Fresms64x.S", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libgcc%2Fconfig%2Fi386%2Fresms64x.S?ref=9cbc07ccffa3403f4f18baf615bb1fe955b3a20e", "patch": "@@ -44,7 +44,7 @@ HIDDEN_FUNC(__resms64x_13)\n \tmov\t-0x48(%rsi),%rbx\n HIDDEN_FUNC(__resms64x_12)\n \tmov\t-0x40(%rsi),%rdi\n-\tSSE_RESTORE off=0x60\n+\tSSE_RESTORE\n \tmov\t-0x38(%rsi),%rsi\n \tmov\t%r10,%rsp\n \tret"}, {"sha": "44dda46ec5475c74a4e404d05e95882d8b42b67c", "filename": "libgcc/config/i386/savms64.S", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/9cbc07ccffa3403f4f18baf615bb1fe955b3a20e/libgcc%2Fconfig%2Fi386%2Fsavms64.S", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/9cbc07ccffa3403f4f18baf615bb1fe955b3a20e/libgcc%2Fconfig%2Fi386%2Fsavms64.S", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libgcc%2Fconfig%2Fi386%2Fsavms64.S?ref=9cbc07ccffa3403f4f18baf615bb1fe955b3a20e", "patch": "@@ -44,7 +44,7 @@ HIDDEN_FUNC(__savms64_13)\n HIDDEN_FUNC(__savms64_12)\n \tmov\t%rdi,-0x40(%rax)\n \tmov\t%rsi,-0x38(%rax)\n-\tSSE_SAVE off=0x60\n+\tSSE_SAVE\n \tret\n FUNC_END(__savms64_12)\n FUNC_END(__savms64_13)"}, {"sha": "64e91ac0394a4df5866f87b7cfe056425bd3ebca", "filename": "libgcc/config/i386/savms64f.S", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/9cbc07ccffa3403f4f18baf615bb1fe955b3a20e/libgcc%2Fconfig%2Fi386%2Fsavms64f.S", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/9cbc07ccffa3403f4f18baf615bb1fe955b3a20e/libgcc%2Fconfig%2Fi386%2Fsavms64f.S", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libgcc%2Fconfig%2Fi386%2Fsavms64f.S?ref=9cbc07ccffa3403f4f18baf615bb1fe955b3a20e", "patch": "@@ -43,7 +43,7 @@ HIDDEN_FUNC(__savms64f_13)\n HIDDEN_FUNC(__savms64f_12)\n \tmov\t%rdi,-0x40(%rax)\n \tmov\t%rsi,-0x38(%rax)\n-\tSSE_SAVE off=0x60\n+\tSSE_SAVE\n \tret\n FUNC_END(__savms64f_12)\n FUNC_END(__savms64f_13)"}]}