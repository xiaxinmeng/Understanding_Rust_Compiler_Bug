{"sha": "5aa62249ce9cad9a0897e801fcdff781cc335116", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6NWFhNjIyNDljZTljYWQ5YTA4OTdlODAxZmNkZmY3ODFjYzMzNTExNg==", "commit": {"author": {"name": "Richard Sandiford", "email": "rdsandiford@googlemail.com", "date": "2010-07-12T19:04:36Z"}, "committer": {"name": "Richard Sandiford", "email": "rsandifo@gcc.gnu.org", "date": "2010-07-12T19:04:36Z"}, "message": "mips.h (mips16_globals): Declare.\n\ngcc/\n\t* config/mips/mips.h (mips16_globals): Declare.\n\t(SWITCHABLE_TARGET): Define.\n\t* config/mips/mips.c: Include target-globals.h.\n\t(mips16_globals): New variable.\n\t(mips_set_mips16_mode): Use save_target_globals and\n\trestore_target_globals instead of target_reinit.\n\nFrom-SVN: r162111", "tree": {"sha": "6c43689f637c9b183fc04e1d15a2b5fb0ab552e8", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/6c43689f637c9b183fc04e1d15a2b5fb0ab552e8"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/5aa62249ce9cad9a0897e801fcdff781cc335116", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/5aa62249ce9cad9a0897e801fcdff781cc335116", "html_url": "https://github.com/Rust-GCC/gccrs/commit/5aa62249ce9cad9a0897e801fcdff781cc335116", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/5aa62249ce9cad9a0897e801fcdff781cc335116/comments", "author": {"login": "rsandifo", "id": 4235983, "node_id": "MDQ6VXNlcjQyMzU5ODM=", "avatar_url": "https://avatars.githubusercontent.com/u/4235983?v=4", "gravatar_id": "", "url": "https://api.github.com/users/rsandifo", "html_url": "https://github.com/rsandifo", "followers_url": "https://api.github.com/users/rsandifo/followers", "following_url": "https://api.github.com/users/rsandifo/following{/other_user}", "gists_url": "https://api.github.com/users/rsandifo/gists{/gist_id}", "starred_url": "https://api.github.com/users/rsandifo/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/rsandifo/subscriptions", "organizations_url": "https://api.github.com/users/rsandifo/orgs", "repos_url": "https://api.github.com/users/rsandifo/repos", "events_url": "https://api.github.com/users/rsandifo/events{/privacy}", "received_events_url": "https://api.github.com/users/rsandifo/received_events", "type": "User", "site_admin": false}, "committer": null, "parents": [{"sha": "77f558794e5ab9a012c7231c799603ba73cc41cd", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/77f558794e5ab9a012c7231c799603ba73cc41cd", "html_url": "https://github.com/Rust-GCC/gccrs/commit/77f558794e5ab9a012c7231c799603ba73cc41cd"}], "stats": {"total": 29, "additions": 26, "deletions": 3}, "files": [{"sha": "b8a77560014f2e14097d6fc3dab12604cf058f55", "filename": "gcc/ChangeLog", "status": "modified", "additions": 9, "deletions": 0, "changes": 9, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/5aa62249ce9cad9a0897e801fcdff781cc335116/gcc%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/5aa62249ce9cad9a0897e801fcdff781cc335116/gcc%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2FChangeLog?ref=5aa62249ce9cad9a0897e801fcdff781cc335116", "patch": "@@ -1,3 +1,12 @@\n+2010-07-12  Richard Sandiford  <rdsandiford@googlemail.com>\n+\n+\t* config/mips/mips.h (mips16_globals): Declare.\n+\t(SWITCHABLE_TARGET): Define.\n+\t* config/mips/mips.c: Include target-globals.h.\n+\t(mips16_globals): New variable.\n+\t(mips_set_mips16_mode): Use save_target_globals and\n+\trestore_target_globals instead of target_reinit.\n+\n 2010-07-12  Richard Sandiford  <rdsandiford@googlemail.com>\n \n \t* reginfo.c (init_reg_sets): Don't zero globals here.  Update comment"}, {"sha": "5fb2fc09dcd4c56af4140cb5c2b4c5b0bed6a5bb", "filename": "gcc/config/mips/mips.c", "status": "modified", "additions": 13, "deletions": 3, "changes": 16, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/5aa62249ce9cad9a0897e801fcdff781cc335116/gcc%2Fconfig%2Fmips%2Fmips.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/5aa62249ce9cad9a0897e801fcdff781cc335116/gcc%2Fconfig%2Fmips%2Fmips.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fconfig%2Fmips%2Fmips.c?ref=5aa62249ce9cad9a0897e801fcdff781cc335116", "patch": "@@ -58,6 +58,7 @@ along with GCC; see the file COPYING3.  If not see\n #include \"gimple.h\"\n #include \"bitmap.h\"\n #include \"diagnostic.h\"\n+#include \"target-globals.h\"\n \n /* True if X is an UNSPEC wrapper around a SYMBOL_REF or LABEL_REF.  */\n #define UNSPEC_ADDRESS_P(X)\t\t\t\t\t\\\n@@ -568,6 +569,9 @@ static const char *mips_lo_relocs[NUM_SYMBOL_TYPES];\n /* Likewise for HIGHs.  */\n static const char *mips_hi_relocs[NUM_SYMBOL_TYPES];\n \n+/* Target state for MIPS16.  */\n+struct target_globals *mips16_globals;\n+\n /* Index R is the smallest register class that contains register R.  */\n const enum reg_class mips_regno_to_class[FIRST_PSEUDO_REGISTER] = {\n   LEA_REGS,\tLEA_REGS,\tM16_REGS,\tV1_REG,\n@@ -15200,9 +15204,15 @@ mips_set_mips16_mode (int mips16_p)\n   /* (Re)initialize MIPS target internals for new ISA.  */\n   mips_init_relocs ();\n \n-  if (was_mips16_p >= 0 || was_mips16_pch_p >= 0)\n-    /* Reinitialize target-dependent state.  */\n-    target_reinit ();\n+  if (mips16_p)\n+    {\n+      if (!mips16_globals)\n+\tmips16_globals = save_target_globals ();\n+      else\n+\trestore_target_globals (mips16_globals);\n+    }\n+  else\n+    restore_target_globals (&default_target_globals);\n \n   was_mips16_p = mips16_p;\n   was_mips16_pch_p = mips16_p;"}, {"sha": "a75cd578c216fe92c1d836d3c226af8dfbe5156f", "filename": "gcc/config/mips/mips.h", "status": "modified", "additions": 4, "deletions": 0, "changes": 4, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/5aa62249ce9cad9a0897e801fcdff781cc335116/gcc%2Fconfig%2Fmips%2Fmips.h", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/5aa62249ce9cad9a0897e801fcdff781cc335116/gcc%2Fconfig%2Fmips%2Fmips.h", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fconfig%2Fmips%2Fmips.h?ref=5aa62249ce9cad9a0897e801fcdff781cc335116", "patch": "@@ -3025,6 +3025,7 @@ extern const struct mips_cpu_info *mips_tune_info;\n extern const struct mips_rtx_cost_data *mips_cost;\n extern bool mips_base_mips16;\n extern enum mips_code_readable_setting mips_code_readable;\n+extern GTY(()) struct target_globals *mips16_globals;\n #endif\n \n /* Enable querying of DFA units.  */\n@@ -3059,3 +3060,6 @@ extern enum mips_code_readable_setting mips_code_readable;\n    support this feature.  */\n #define ASM_PREFERRED_EH_DATA_FORMAT(CODE,GLOBAL) \\\n   (((GLOBAL) ? DW_EH_PE_indirect : 0) | DW_EH_PE_absptr)\n+\n+/* For switching between MIPS16 and non-MIPS16 modes.  */\n+#define SWITCHABLE_TARGET 1"}]}