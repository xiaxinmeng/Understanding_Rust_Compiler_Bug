{"sha": "9f269265215526a5ed88dc26531b5de72e234777", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6OWYyNjkyNjUyMTU1MjZhNWVkODhkYzI2NTMxYjVkZTcyZTIzNDc3Nw==", "commit": {"author": {"name": "Richard Kenner", "email": "kenner@gcc.gnu.org", "date": "1996-03-05T14:11:25Z"}, "committer": {"name": "Richard Kenner", "email": "kenner@gcc.gnu.org", "date": "1996-03-05T14:11:25Z"}, "message": "(union sversion): New.\n\n(struct sarray): Maintain multiple versions.\n(sarray_remove_garbage): Add prototype.\n\nFrom-SVN: r11446", "tree": {"sha": "282b4722ac3c42ce139b30d8b8ef5e8cf8dc9220", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/282b4722ac3c42ce139b30d8b8ef5e8cf8dc9220"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/9f269265215526a5ed88dc26531b5de72e234777", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/9f269265215526a5ed88dc26531b5de72e234777", "html_url": "https://github.com/Rust-GCC/gccrs/commit/9f269265215526a5ed88dc26531b5de72e234777", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/9f269265215526a5ed88dc26531b5de72e234777/comments", "author": null, "committer": null, "parents": [{"sha": "1ebb5fcc6471f5eb9003e615e1bb686b71a0b036", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/1ebb5fcc6471f5eb9003e615e1bb686b71a0b036", "html_url": "https://github.com/Rust-GCC/gccrs/commit/1ebb5fcc6471f5eb9003e615e1bb686b71a0b036"}], "stats": {"total": 19, "additions": 14, "deletions": 5}, "files": [{"sha": "7d1ba25290f445b5420e580aa46767bbb0d966cd", "filename": "gcc/objc/sarray.h", "status": "modified", "additions": 14, "deletions": 5, "changes": 19, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/9f269265215526a5ed88dc26531b5de72e234777/gcc%2Fobjc%2Fsarray.h", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/9f269265215526a5ed88dc26531b5de72e234777/gcc%2Fobjc%2Fsarray.h", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fobjc%2Fsarray.h?ref=9f269265215526a5ed88dc26531b5de72e234777", "patch": "@@ -1,5 +1,5 @@\n /* Sparse Arrays for Objective C dispatch tables\n-   Copyright (C) 1993, 1995 Free Software Foundation, Inc.\n+   Copyright (C) 1993, 1995, 1996 Free Software Foundation, Inc.\n \n Author: Kresten Krab Thorup\n \n@@ -42,6 +42,8 @@ extern const char* __objc_sparse3_id;\n \n #include <stddef.h>\n \n+#include \"objc/thread.h\"\n+\n extern int nbuckets;\t\t/* for stats */\n extern int nindices;\n extern int narrays;\n@@ -111,16 +113,21 @@ union sofftype {\n void * __objc_xrealloc (void *optr, size_t size);\n void * __objc_xmalloc (size_t size);\n \n+union sversion {\n+  int\tversion;\n+  void *next_free;\n+};\n+\n struct sbucket {\n   void* elems[BUCKET_SIZE];\t/* elements stored in array */\n-  short version;\t\t\t/* used for copy-on-write */\n+  union sversion\tversion;\t\t/* used for copy-on-write */\n };\n \n #ifdef OBJC_SPARSE3\n \n struct sindex {\n   struct sbucket* buckets[INDEX_SIZE];\n-  short version;\n+  union sversion\tversion;\t\t/* used for copy-on-write */\n };\n \n #endif /* OBJC_SPARSE3 */\n@@ -133,7 +140,7 @@ struct sarray {\n   struct sbucket** buckets;\n #endif  /* OBJC_SPARSE2 */\n   struct sbucket* empty_bucket;\n-  short version;\n+  union sversion\tversion;\t\t/* used for copy-on-write */\n   short ref_count;\n   struct sarray* is_copy_of;\n   size_t capacity;\n@@ -142,10 +149,12 @@ struct sarray {\n struct sarray* sarray_new(int, void* default_element);\n void sarray_free(struct sarray*);\n struct sarray* sarray_lazy_copy(struct sarray*);\n-struct sarray* sarray_hard_copy(struct sarray*); /* ... like the name? */\n void sarray_realloc(struct sarray*, int new_size);\n void sarray_at_put(struct sarray*, sidx index, void* elem);\n void sarray_at_put_safe(struct sarray*, sidx index, void* elem);\n+\n+struct sarray* sarray_hard_copy(struct sarray*); /* ... like the name? */\n+void sarray_remove_garbage(void);\n \f\n \n #ifdef PRECOMPUTE_SELECTORS"}]}