{"sha": "79e02673e97d1a359ca1fc2dc3f6d51d0debe7d8", "node_id": "C_kwDOANBUbNoAKDc5ZTAyNjczZTk3ZDFhMzU5Y2ExZmMyZGMzZjZkNTFkMGRlYmU3ZDg", "commit": {"author": {"name": "Piotr Trojanek", "email": "trojanek@adacore.com", "date": "2021-10-14T21:31:21Z"}, "committer": {"name": "Marc Poulhi\u00e8s", "email": "poulhies@adacore.com", "date": "2022-11-08T08:34:58Z"}, "message": "ada: Reject limited objects in array and record delta aggregates\n\nFor array delta aggregates the base expression cannot be limited; for\nrecord delta aggregates the base expression can only be limited if it is\na newly constructed object.\n\ngcc/ada/\n\n\t* sem_aggr.adb (Resolve_Delta_Aggregate): Implement rules related\n\tto limited objects appearing as the base expression.", "tree": {"sha": "5f334700e08cf5fa03f53a3b64ce9dd9436437e9", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/5f334700e08cf5fa03f53a3b64ce9dd9436437e9"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/79e02673e97d1a359ca1fc2dc3f6d51d0debe7d8", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/79e02673e97d1a359ca1fc2dc3f6d51d0debe7d8", "html_url": "https://github.com/Rust-GCC/gccrs/commit/79e02673e97d1a359ca1fc2dc3f6d51d0debe7d8", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/79e02673e97d1a359ca1fc2dc3f6d51d0debe7d8/comments", "author": {"login": "ptroja", "id": 161602, "node_id": "MDQ6VXNlcjE2MTYwMg==", "avatar_url": "https://avatars.githubusercontent.com/u/161602?v=4", "gravatar_id": "", "url": "https://api.github.com/users/ptroja", "html_url": "https://github.com/ptroja", "followers_url": "https://api.github.com/users/ptroja/followers", "following_url": "https://api.github.com/users/ptroja/following{/other_user}", "gists_url": "https://api.github.com/users/ptroja/gists{/gist_id}", "starred_url": "https://api.github.com/users/ptroja/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/ptroja/subscriptions", "organizations_url": "https://api.github.com/users/ptroja/orgs", "repos_url": "https://api.github.com/users/ptroja/repos", "events_url": "https://api.github.com/users/ptroja/events{/privacy}", "received_events_url": "https://api.github.com/users/ptroja/received_events", "type": "User", "site_admin": false}, "committer": {"login": "dkm", "id": 87603, "node_id": "MDQ6VXNlcjg3NjAz", "avatar_url": "https://avatars.githubusercontent.com/u/87603?v=4", "gravatar_id": "", "url": "https://api.github.com/users/dkm", "html_url": "https://github.com/dkm", "followers_url": "https://api.github.com/users/dkm/followers", "following_url": "https://api.github.com/users/dkm/following{/other_user}", "gists_url": "https://api.github.com/users/dkm/gists{/gist_id}", "starred_url": "https://api.github.com/users/dkm/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/dkm/subscriptions", "organizations_url": "https://api.github.com/users/dkm/orgs", "repos_url": "https://api.github.com/users/dkm/repos", "events_url": "https://api.github.com/users/dkm/events{/privacy}", "received_events_url": "https://api.github.com/users/dkm/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "2ff87e21c2053fe3a48ced3e2cc9ab1b900aceaa", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/2ff87e21c2053fe3a48ced3e2cc9ab1b900aceaa", "html_url": "https://github.com/Rust-GCC/gccrs/commit/2ff87e21c2053fe3a48ced3e2cc9ab1b900aceaa"}], "stats": {"total": 17, "additions": 17, "deletions": 0}, "files": [{"sha": "4da05dd731742e62796f6dfe4c587236f97eac85", "filename": "gcc/ada/sem_aggr.adb", "status": "modified", "additions": 17, "deletions": 0, "changes": 17, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/79e02673e97d1a359ca1fc2dc3f6d51d0debe7d8/gcc%2Fada%2Fsem_aggr.adb", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/79e02673e97d1a359ca1fc2dc3f6d51d0debe7d8/gcc%2Fada%2Fsem_aggr.adb", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fada%2Fsem_aggr.adb?ref=79e02673e97d1a359ca1fc2dc3f6d51d0debe7d8", "patch": "@@ -3421,6 +3421,18 @@ package body Sem_Aggr is\n       Analyze_And_Resolve (Base, Typ);\n \n       if Is_Array_Type (Typ) then\n+         --  For an array_delta_aggregate, the base_expression and each\n+         --  expression in every array_component_association shall be of a\n+         --  nonlimited type; RM 4.3.4(13/5). However, to prevent repeated\n+         --  errors we only check the base expression and not array component\n+         --  associations.\n+\n+         if Is_Limited_Type (Etype (Base)) then\n+            Error_Msg_N\n+              (\"array delta aggregate shall be of a nonlimited type\", Base);\n+            Explain_Limited_Type (Etype (Base), Base);\n+         end if;\n+\n          Resolve_Delta_Array_Aggregate (N, Typ);\n       else\n \n@@ -3432,6 +3444,11 @@ package body Sem_Aggr is\n               (\"delta aggregates for record types must use (), not '[']\", N);\n          end if;\n \n+         --  The base_expression of a record_delta_aggregate can be of a\n+         --  limited type only if it is newly constructed; RM 7.5(2.1/5).\n+\n+         Check_Expr_OK_In_Limited_Aggregate (Base);\n+\n          Resolve_Delta_Record_Aggregate (N, Typ);\n       end if;\n "}]}