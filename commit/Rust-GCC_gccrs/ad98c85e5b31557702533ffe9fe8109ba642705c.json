{"sha": "ad98c85e5b31557702533ffe9fe8109ba642705c", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6YWQ5OGM4NWU1YjMxNTU3NzAyNTMzZmZlOWZlODEwOWJhNjQyNzA1Yw==", "commit": {"author": {"name": "Thomas Quinot", "email": "quinot@adacore.com", "date": "2006-10-31T18:00:42Z"}, "committer": {"name": "Arnaud Charlet", "email": "charlet@gcc.gnu.org", "date": "2006-10-31T18:00:42Z"}, "message": "g-socket.ads, [...] (Close_Selector): Once the signalling sockets are closed...\n\n2006-10-31  Thomas Quinot  <quinot@adacore.com>\n\n\t* g-socket.ads, g-socket.adb (Close_Selector): Once the signalling\n\tsockets are closed, reset the R_Sig_Socket and W_Sig_Socket components\n\tto No_Socket.\n\t(Selector_Type): Add default value of No_Socket for R_Sig_Socket and\n\tW_Sig_Socket.\n\nFrom-SVN: r118280", "tree": {"sha": "f6767151ab9a798d0eddba4c931af96431abf232", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/f6767151ab9a798d0eddba4c931af96431abf232"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/ad98c85e5b31557702533ffe9fe8109ba642705c", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/ad98c85e5b31557702533ffe9fe8109ba642705c", "html_url": "https://github.com/Rust-GCC/gccrs/commit/ad98c85e5b31557702533ffe9fe8109ba642705c", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/ad98c85e5b31557702533ffe9fe8109ba642705c/comments", "author": null, "committer": null, "parents": [{"sha": "8967c38f74e68783fdbff9ad8759178d83eef637", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/8967c38f74e68783fdbff9ad8759178d83eef637", "html_url": "https://github.com/Rust-GCC/gccrs/commit/8967c38f74e68783fdbff9ad8759178d83eef637"}], "stats": {"total": 19, "additions": 14, "deletions": 5}, "files": [{"sha": "01765a70715f01fea9318db0e2267aa53a9bf1fb", "filename": "gcc/ada/g-socket.adb", "status": "modified", "additions": 7, "deletions": 1, "changes": 8, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/ad98c85e5b31557702533ffe9fe8109ba642705c/gcc%2Fada%2Fg-socket.adb", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/ad98c85e5b31557702533ffe9fe8109ba642705c/gcc%2Fada%2Fg-socket.adb", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fada%2Fg-socket.adb?ref=ad98c85e5b31557702533ffe9fe8109ba642705c", "patch": "@@ -6,7 +6,7 @@\n --                                                                          --\n --                                 B o d y                                  --\n --                                                                          --\n---                     Copyright (C) 2001-2005, AdaCore                     --\n+--                     Copyright (C) 2001-2006, AdaCore                     --\n --                                                                          --\n -- GNAT is free software;  you can  redistribute it  and/or modify it under --\n -- terms of the  GNU General Public License as published  by the Free Soft- --\n@@ -560,6 +560,12 @@ package body GNAT.Sockets is\n          when Socket_Error =>\n             null;\n       end;\n+\n+      --  Reset R_Sig_Socket and W_Sig_Socket to No_Socket to ensure that any\n+      --  (errneous) subsequent attempt to use this selector properly fails.\n+\n+      Selector.R_Sig_Socket := No_Socket;\n+      Selector.W_Sig_Socket := No_Socket;\n    end Close_Selector;\n \n    ------------------"}, {"sha": "3e974a213ab6b810b5f6a8c818c44bda7ea14b57", "filename": "gcc/ada/g-socket.ads", "status": "modified", "additions": 7, "deletions": 4, "changes": 11, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/ad98c85e5b31557702533ffe9fe8109ba642705c/gcc%2Fada%2Fg-socket.ads", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/ad98c85e5b31557702533ffe9fe8109ba642705c/gcc%2Fada%2Fg-socket.ads", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fada%2Fg-socket.ads?ref=ad98c85e5b31557702533ffe9fe8109ba642705c", "patch": "@@ -6,7 +6,7 @@\n --                                                                          --\n --                                 S p e c                                  --\n --                                                                          --\n---                     Copyright (C) 2001-2005, AdaCore                     --\n+--                     Copyright (C) 2001-2006, AdaCore                     --\n --                                                                          --\n -- GNAT is free software;  you can  redistribute it  and/or modify it under --\n -- terms of the  GNU General Public License as published  by the Free Soft- --\n@@ -961,7 +961,10 @@ package GNAT.Sockets is\n    --  Create a new selector\n \n    procedure Close_Selector (Selector : in out Selector_Type);\n-   --  Close Selector and all internal descriptors associated\n+   --  Close Selector and all internal descriptors associated; deallocate any\n+   --  associated resources. This subprogram may be called only when there is\n+   --  no other task still using Selector (i.e. still executing Check_Selector\n+   --  or Abort_Selector on this Selector).\n \n    type Selector_Status is (Completed, Expired, Aborted);\n \n@@ -1007,8 +1010,8 @@ private\n    No_Socket : constant Socket_Type := -1;\n \n    type Selector_Type is limited record\n-      R_Sig_Socket : Socket_Type;\n-      W_Sig_Socket : Socket_Type;\n+      R_Sig_Socket : Socket_Type := No_Socket;\n+      W_Sig_Socket : Socket_Type := No_Socket;\n    end record;\n \n    pragma Volatile (Selector_Type);"}]}