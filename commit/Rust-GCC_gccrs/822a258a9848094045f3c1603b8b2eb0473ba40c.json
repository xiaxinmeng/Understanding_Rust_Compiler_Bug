{"sha": "822a258a9848094045f3c1603b8b2eb0473ba40c", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6ODIyYTI1OGE5ODQ4MDk0MDQ1ZjNjMTYwM2I4YjJlYjA0NzNiYTQwYw==", "commit": {"author": {"name": "Teresa Johnson", "email": "tejohnson@google.com", "date": "2012-11-19T05:20:59Z"}, "committer": {"name": "Teresa Johnson", "email": "tejohnson@gcc.gnu.org", "date": "2012-11-19T05:20:59Z"}, "message": "This patch addresses the bogus \"Invocation mismatch\" messages seen in parallel profiledbootstrap builds of gcc.\n\nThis patch addresses the bogus \"Invocation mismatch\" messages seen in parallel\nprofiledbootstrap builds of gcc. See PR bootstrap/55051 for a discussion of\nwhy this is occurring and why this checking is inaccurate. Leave it in when\n!GCOV_LOCKED, to warn about concurrent update issues requiring locking.\n\n2012-11-18  Teresa Johnson  <tejohnson@google.com>\n\n\tPR bootstrap/55051\n\t* libgcov.c (gcov_exit): Remove merged program summary\n\tcomparison unless !GCOV_LOCKED.\n\nFrom-SVN: r193612", "tree": {"sha": "efa4b8c539082380ffc711a2186862e08d1a71a5", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/efa4b8c539082380ffc711a2186862e08d1a71a5"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/822a258a9848094045f3c1603b8b2eb0473ba40c", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/822a258a9848094045f3c1603b8b2eb0473ba40c", "html_url": "https://github.com/Rust-GCC/gccrs/commit/822a258a9848094045f3c1603b8b2eb0473ba40c", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/822a258a9848094045f3c1603b8b2eb0473ba40c/comments", "author": {"login": "teresajohnson", "id": 20446403, "node_id": "MDQ6VXNlcjIwNDQ2NDAz", "avatar_url": "https://avatars.githubusercontent.com/u/20446403?v=4", "gravatar_id": "", "url": "https://api.github.com/users/teresajohnson", "html_url": "https://github.com/teresajohnson", "followers_url": "https://api.github.com/users/teresajohnson/followers", "following_url": "https://api.github.com/users/teresajohnson/following{/other_user}", "gists_url": "https://api.github.com/users/teresajohnson/gists{/gist_id}", "starred_url": "https://api.github.com/users/teresajohnson/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/teresajohnson/subscriptions", "organizations_url": "https://api.github.com/users/teresajohnson/orgs", "repos_url": "https://api.github.com/users/teresajohnson/repos", "events_url": "https://api.github.com/users/teresajohnson/events{/privacy}", "received_events_url": "https://api.github.com/users/teresajohnson/received_events", "type": "User", "site_admin": false}, "committer": null, "parents": [{"sha": "c513ecbf359898cc6304aa506b35e27b1422b82d", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/c513ecbf359898cc6304aa506b35e27b1422b82d", "html_url": "https://github.com/Rust-GCC/gccrs/commit/c513ecbf359898cc6304aa506b35e27b1422b82d"}], "stats": {"total": 43, "additions": 33, "deletions": 10}, "files": [{"sha": "1a62fdf8949ccf6741dda88be3109b7bccf49ae2", "filename": "libgcc/ChangeLog", "status": "modified", "additions": 6, "deletions": 0, "changes": 6, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/822a258a9848094045f3c1603b8b2eb0473ba40c/libgcc%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/822a258a9848094045f3c1603b8b2eb0473ba40c/libgcc%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libgcc%2FChangeLog?ref=822a258a9848094045f3c1603b8b2eb0473ba40c", "patch": "@@ -1,3 +1,9 @@\n+2012-11-18  Teresa Johnson  <tejohnson@google.com>\n+\n+\tPR bootstrap/55051\n+\t* libgcov.c (gcov_exit): Remove merged program summary\n+\tcomparison unless !GCOV_LOCKED.\n+\n 2012-11-15  Marcus Shawcroft <marcus.shawcroft@arm.com>\n \n \t* soft-fp: Updated from glibc upstream."}, {"sha": "ba27c531dd73e9ffc2ae6b7d3f272922fb8cfbc6", "filename": "libgcc/libgcov.c", "status": "modified", "additions": 27, "deletions": 10, "changes": 37, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/822a258a9848094045f3c1603b8b2eb0473ba40c/libgcc%2Flibgcov.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/822a258a9848094045f3c1603b8b2eb0473ba40c/libgcc%2Flibgcov.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libgcc%2Flibgcov.c?ref=822a258a9848094045f3c1603b8b2eb0473ba40c", "patch": "@@ -365,7 +365,9 @@ gcov_exit (void)\n   struct gcov_info *gi_ptr;\n   const struct gcov_fn_info *gfi_ptr;\n   struct gcov_summary this_prg; /* summary for program.  */\n+#if !GCOV_LOCKED\n   struct gcov_summary all_prg;  /* summary for all instances of program.  */\n+#endif\n   struct gcov_ctr_summary *cs_ptr;\n   const struct gcov_ctr_info *ci_ptr;\n   unsigned t_ix;\n@@ -382,7 +384,9 @@ gcov_exit (void)\n   if (gcov_dump_complete)\n     return;\n \n+#if !GCOV_LOCKED\n   memset (&all_prg, 0, sizeof (all_prg));\n+#endif\n   /* Find the totals for this execution.  */\n   memset (&this_prg, 0, sizeof (this_prg));\n   for (gi_ptr = gcov_list; gi_ptr; gi_ptr = gi_ptr->next)\n@@ -469,7 +473,10 @@ gcov_exit (void)\n       unsigned n_counts;\n       struct gcov_summary prg; /* summary for this object over all\n \t\t\t\t  program.  */\n-      struct gcov_ctr_summary *cs_prg, *cs_tprg, *cs_all;\n+      struct gcov_ctr_summary *cs_prg, *cs_tprg;\n+#if !GCOV_LOCKED\n+      struct gcov_ctr_summary *cs_all;\n+#endif\n       int error = 0;\n       gcov_unsigned_t tag, length;\n       gcov_position_t summary_pos = 0;\n@@ -684,7 +691,6 @@ gcov_exit (void)\n \t{\n \t  cs_prg = &prg.ctrs[t_ix];\n \t  cs_tprg = &this_prg.ctrs[t_ix];\n-\t  cs_all = &all_prg.ctrs[t_ix];\n \n \t  if (gi_ptr->merge[t_ix])\n \t    {\n@@ -703,23 +709,34 @@ gcov_exit (void)\n \t  else if (cs_prg->runs)\n \t    goto read_mismatch;\n \n+#if !GCOV_LOCKED\n+\t  cs_all = &all_prg.ctrs[t_ix];\n \t  if (!cs_all->runs && cs_prg->runs)\n-\t    memcpy (cs_all, cs_prg, sizeof (*cs_all));\n+            {\n+              cs_all->num = cs_prg->num;\n+              cs_all->runs = cs_prg->runs;\n+              cs_all->sum_all = cs_prg->sum_all;\n+              cs_all->run_max = cs_prg->run_max;\n+              cs_all->sum_max = cs_prg->sum_max;\n+            }\n \t  else if (!all_prg.checksum\n-\t\t   && (!GCOV_LOCKED || cs_all->runs == cs_prg->runs)\n                    /* Don't compare the histograms, which may have slight\n                       variations depending on the order they were updated\n                       due to the truncating integer divides used in the\n                       merge.  */\n-                   && memcmp (cs_all, cs_prg,\n-                              sizeof (*cs_all) - (sizeof (gcov_bucket_type)\n-                                                  * GCOV_HISTOGRAM_SIZE)))\n+                   && (cs_all->num != cs_prg->num\n+                       || cs_all->runs != cs_prg->runs\n+                       || cs_all->sum_all != cs_prg->sum_all\n+                       || cs_all->run_max != cs_prg->run_max\n+                       || cs_all->sum_max != cs_prg->sum_max))\n \t    {\n-\t      fprintf (stderr, \"profiling:%s:Invocation mismatch - some data files may have been removed%s\\n\",\n-\t\t       gi_filename, GCOV_LOCKED\n-\t\t       ? \"\" : \" or concurrently updated without locking support\");\n+\t      fprintf (stderr,\n+                       \"profiling:%s:Data file mismatch - some data files may \"\n+                       \"have been concurrently updated without locking support\\n\",\n+\t\t       gi_filename);\n \t      all_prg.checksum = ~0u;\n \t    }\n+#endif\n \t}\n \n       prg.checksum = crc32;"}]}