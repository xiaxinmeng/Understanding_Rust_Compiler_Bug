{"sha": "a3c5267cab6b291e842de6626be76c3355e6b447", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6YTNjNTI2N2NhYjZiMjkxZTg0MmRlNjYyNmJlNzZjMzM1NWU2YjQ0Nw==", "commit": {"author": {"name": "Volker Reichelt", "email": "reichelt@igpm.rwth-aachen.de", "date": "2006-03-06T02:01:29Z"}, "committer": {"name": "Volker Reichelt", "email": "reichelt@gcc.gnu.org", "date": "2006-03-06T02:01:29Z"}, "message": "re PR c++/15759 (ICE with function pointers)\n\n\tPR c++/15759\n\t* tree.c (bot_manip): Don't call mark_used.\n\n\t* g++.dg/other/default4.C: New test.\n\nFrom-SVN: r111754", "tree": {"sha": "fef6f146464dcfcf6d6123a157e675a7ece31dc4", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/fef6f146464dcfcf6d6123a157e675a7ece31dc4"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/a3c5267cab6b291e842de6626be76c3355e6b447", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/a3c5267cab6b291e842de6626be76c3355e6b447", "html_url": "https://github.com/Rust-GCC/gccrs/commit/a3c5267cab6b291e842de6626be76c3355e6b447", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/a3c5267cab6b291e842de6626be76c3355e6b447/comments", "author": null, "committer": null, "parents": [{"sha": "c92f986f5f313715fa9ebcb1237b2cd52172e714", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/c92f986f5f313715fa9ebcb1237b2cd52172e714", "html_url": "https://github.com/Rust-GCC/gccrs/commit/c92f986f5f313715fa9ebcb1237b2cd52172e714"}], "stats": {"total": 54, "additions": 43, "deletions": 11}, "files": [{"sha": "4c735d74c0b6ab7117a05f47600bb60086f56823", "filename": "gcc/cp/ChangeLog", "status": "modified", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/a3c5267cab6b291e842de6626be76c3355e6b447/gcc%2Fcp%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/a3c5267cab6b291e842de6626be76c3355e6b447/gcc%2Fcp%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fcp%2FChangeLog?ref=a3c5267cab6b291e842de6626be76c3355e6b447", "patch": "@@ -1,3 +1,8 @@\n+2006-03-06  Volker Reichelt  <reichelt@igpm.rwth-aachen.de>\n+\n+\tPR c++/15759\n+\t* tree.c (bot_manip): Don't call mark_used.\n+\n 2006-03-02  Mike Stump  <mrs@apple.com>\n \n \t* decl2.c (import_export_decl): Remove redundant call to"}, {"sha": "d58b5b350dda768be502a5ee12c01604698740a5", "filename": "gcc/cp/tree.c", "status": "modified", "additions": 4, "deletions": 11, "changes": 15, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/a3c5267cab6b291e842de6626be76c3355e6b447/gcc%2Fcp%2Ftree.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/a3c5267cab6b291e842de6626be76c3355e6b447/gcc%2Fcp%2Ftree.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fcp%2Ftree.c?ref=a3c5267cab6b291e842de6626be76c3355e6b447", "patch": "@@ -1173,16 +1173,11 @@ bot_manip (tree* tp, int* walk_subtrees, void* data)\n       tree u;\n \n       if (TREE_CODE (TREE_OPERAND (t, 1)) == AGGR_INIT_EXPR)\n-\t{\n-\t  mark_used (TREE_OPERAND (TREE_OPERAND (TREE_OPERAND (t, 1), 0), 0));\n-\t  u = build_cplus_new\n-\t    (TREE_TYPE (t), break_out_target_exprs (TREE_OPERAND (t, 1)));\n-\t}\n+\tu = build_cplus_new\n+\t  (TREE_TYPE (t), break_out_target_exprs (TREE_OPERAND (t, 1)));\n       else\n-\t{\n-\t  u = build_target_expr_with_type\n-\t    (break_out_target_exprs (TREE_OPERAND (t, 1)), TREE_TYPE (t));\n-\t}\n+\tu = build_target_expr_with_type\n+\t  (break_out_target_exprs (TREE_OPERAND (t, 1)), TREE_TYPE (t));\n \n       /* Map the old variable to the new one.  */\n       splay_tree_insert (target_remap,\n@@ -1197,8 +1192,6 @@ bot_manip (tree* tp, int* walk_subtrees, void* data)\n       *walk_subtrees = 0;\n       return NULL_TREE;\n     }\n-  else if (TREE_CODE (t) == CALL_EXPR)\n-    mark_used (TREE_OPERAND (TREE_OPERAND (t, 0), 0));\n \n   /* Make a copy of this node.  */\n   return copy_tree_r (tp, walk_subtrees, NULL);"}, {"sha": "3d5f444ceeac8a346ffe7350d15a70ecd2df5cc6", "filename": "gcc/testsuite/ChangeLog", "status": "modified", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/a3c5267cab6b291e842de6626be76c3355e6b447/gcc%2Ftestsuite%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/a3c5267cab6b291e842de6626be76c3355e6b447/gcc%2Ftestsuite%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2FChangeLog?ref=a3c5267cab6b291e842de6626be76c3355e6b447", "patch": "@@ -1,3 +1,8 @@\n+2006-03-06  Volker Reichelt  <reichelt@igpm.rwth-aachen.de>\n+\n+\tPR c++/15759\n+\t* g++.dg/other/default4.C: New test.\n+\n 2005-03-05  Erik Edelmann  <eedelman@gcc.gnu.org>\n \n \tPR fortran/16136"}, {"sha": "5994809840248de9505eae8d019c66b697dce5d3", "filename": "gcc/testsuite/g++.dg/other/default4.C", "status": "added", "additions": 29, "deletions": 0, "changes": 29, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/a3c5267cab6b291e842de6626be76c3355e6b447/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Fother%2Fdefault4.C", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/a3c5267cab6b291e842de6626be76c3355e6b447/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Fother%2Fdefault4.C", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Fother%2Fdefault4.C?ref=a3c5267cab6b291e842de6626be76c3355e6b447", "patch": "@@ -0,0 +1,29 @@\n+// PR c++/15759\n+// Origin:   Lars Rune N\ufffdstdal  <larsnostdal@gmail.com>\n+// Testcase: Volker Reichelt    <reichelt@igpm.rwth-aachen.de>\n+\n+// { dg-do run }\n+\n+extern \"C\" void abort();\n+\n+int n = 0;\n+\n+int f() { return ++n; }\n+\n+int(&foo1)() = f;\n+int(*foo2)() = &f;\n+int(*foo3)() = f;\n+\n+int bar1(int i = foo1()) { return i; }\n+int bar2(int i = foo2()) { return i; }\n+int bar3(int i = foo3()) { return i; }\n+int bar4(int i = f())    { return i; }\n+\n+int main()\n+{\n+  if (bar1() != 1) abort();\n+  if (bar2() != 2) abort();\n+  if (bar3() != 3) abort();\n+  if (bar4() != 4) abort();\n+  return 0;\n+}"}]}