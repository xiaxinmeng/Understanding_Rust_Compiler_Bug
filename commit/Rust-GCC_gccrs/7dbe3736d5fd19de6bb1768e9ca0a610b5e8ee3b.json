{"sha": "7dbe3736d5fd19de6bb1768e9ca0a610b5e8ee3b", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6N2RiZTM3MzZkNWZkMTlkZTZiYjE3NjhlOWNhMGE2MTBiNWU4ZWUzYg==", "commit": {"author": {"name": "Nicolas Roche", "email": "roche@adacore.com", "date": "2017-09-13T13:18:46Z"}, "committer": {"name": "Pierre-Marie de Rodat", "email": "pmderodat@gcc.gnu.org", "date": "2017-09-13T13:18:46Z"}, "message": "Make-lang.in: In the fallback mechanim...\n\n2017-09-13  Nicolas Roche  <roche@adacore.com>\n\n\t* Make-lang.in: In the fallback mechanim, parse the associated .ali\n\tfile and try to guess the locations of dependencies.\n\nFrom-SVN: r252082", "tree": {"sha": "5708449fb3cc93a996e7129754776295471dd201", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/5708449fb3cc93a996e7129754776295471dd201"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/7dbe3736d5fd19de6bb1768e9ca0a610b5e8ee3b", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/7dbe3736d5fd19de6bb1768e9ca0a610b5e8ee3b", "html_url": "https://github.com/Rust-GCC/gccrs/commit/7dbe3736d5fd19de6bb1768e9ca0a610b5e8ee3b", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/7dbe3736d5fd19de6bb1768e9ca0a610b5e8ee3b/comments", "author": {"login": "Nikokrock", "id": 7796165, "node_id": "MDQ6VXNlcjc3OTYxNjU=", "avatar_url": "https://avatars.githubusercontent.com/u/7796165?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Nikokrock", "html_url": "https://github.com/Nikokrock", "followers_url": "https://api.github.com/users/Nikokrock/followers", "following_url": "https://api.github.com/users/Nikokrock/following{/other_user}", "gists_url": "https://api.github.com/users/Nikokrock/gists{/gist_id}", "starred_url": "https://api.github.com/users/Nikokrock/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Nikokrock/subscriptions", "organizations_url": "https://api.github.com/users/Nikokrock/orgs", "repos_url": "https://api.github.com/users/Nikokrock/repos", "events_url": "https://api.github.com/users/Nikokrock/events{/privacy}", "received_events_url": "https://api.github.com/users/Nikokrock/received_events", "type": "User", "site_admin": false}, "committer": null, "parents": [{"sha": "f216550dbbfa1263d5f8d8f3261a13226026f656", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/f216550dbbfa1263d5f8d8f3261a13226026f656", "html_url": "https://github.com/Rust-GCC/gccrs/commit/f216550dbbfa1263d5f8d8f3261a13226026f656"}], "stats": {"total": 29, "additions": 20, "deletions": 9}, "files": [{"sha": "468af0794c9bc55f86b967d51f7f0bf7ad981333", "filename": "gcc/ada/ChangeLog", "status": "modified", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/7dbe3736d5fd19de6bb1768e9ca0a610b5e8ee3b/gcc%2Fada%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/7dbe3736d5fd19de6bb1768e9ca0a610b5e8ee3b/gcc%2Fada%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fada%2FChangeLog?ref=7dbe3736d5fd19de6bb1768e9ca0a610b5e8ee3b", "patch": "@@ -1,3 +1,8 @@\n+2017-09-13  Nicolas Roche  <roche@adacore.com>\n+\n+\t* Make-lang.in: In the fallback mechanim, parse the associated .ali\n+\tfile and try to guess the locations of dependencies.\n+\n 2017-09-13  Eric Botcazou  <ebotcazou@adacore.com>\n \n \t* sem_ch13.adb (Register_Address_Clause_Check): New procedure to save"}, {"sha": "113c84f390bd97376346b96dbad948ca8648ad1e", "filename": "gcc/ada/gcc-interface/Make-lang.in", "status": "modified", "additions": 15, "deletions": 9, "changes": 24, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/7dbe3736d5fd19de6bb1768e9ca0a610b5e8ee3b/gcc%2Fada%2Fgcc-interface%2FMake-lang.in", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/7dbe3736d5fd19de6bb1768e9ca0a610b5e8ee3b/gcc%2Fada%2Fgcc-interface%2FMake-lang.in", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fada%2Fgcc-interface%2FMake-lang.in?ref=7dbe3736d5fd19de6bb1768e9ca0a610b5e8ee3b", "patch": "@@ -106,26 +106,30 @@ ada/%.o: ada/gcc-interface/%.c\n \n # Function that dumps the dependencies of an Ada object. Dependency only work\n # fully if the compiler support -gnatd.n. Otherwise a fallback mechanism is\n-# used. The fallback mechanism add dependency on all ada sources in the same\n-# directory as the original source.\n+# used. The fallback mechanism parse the ali files to get the list of\n+# dependencies and try to guess their location. If the location cannot be found\n+# then the dependency is ignored.\n ifeq ($(findstring -gnatd.n,$(ALL_ADAFLAGS)),)\n ADA_DEPS=\\\n    mkdir -p $(dir $@)/$(DEPDIR); \\\n    (o=\"$@: $<\"; \\\n-    for d in $(dir $<)/*.ad[sb]; do \\\n-       o=\"$$o $$d\"; \\\n+    a=\"`echo $@ | sed -e 's/.o$$/.ali/'`\"; \\\n+    for d in `cat $$a | sed -ne 's;^D \\([a-z0-9_\\.-]*\\).*;\\1;gp'`; do \\\n+       for l in ada $(srcdir)/ada ada/libgnat $(srcdir)/ada/libgnat; do \\\n+          if test -f $$l/$$d; then \\\n+             o=\"$$o $$l/$$d\"; \\\n+          fi; \\\n+       done; \\\n     done; \\\n     echo \"$$o\"; echo) \\\n     >$(dir $@)/$(DEPDIR)/$(patsubst %.o,%.Po,$(notdir $@))\n ADA_OUTPUT_OPTION = $(OUTPUT_OPTION)\n else\n ADA_DEPS=\\\n    mkdir -p $(dir $@)/$(DEPDIR); \\\n-   (o=\"$@: $<\"; \\\n-    for d in `cat $@.gnatd.n`; do \\\n-       o=\"$$o $$d\"; \\\n-    done; \\\n-    echo \"$$o\"; echo) \\\n+   (echo \"$@: $< \" | tr -d '\\015' | tr -d '\\n'; \\\n+    cat $@.gnatd.n | tr -d '\\015' | tr '\\n' ' '; \\\n+    echo; echo) \\\n    >$(dir $@)/$(DEPDIR)/$(patsubst %.o,%.Po,$(notdir $@))\n ADA_OUTPUT_OPTION = $(OUTPUT_OPTION) > $@.gnatd.n\n endif\n@@ -861,9 +865,11 @@ ada.uninstall:\n \n ada.mostlyclean:\n \t-$(RM) ada/*$(objext) ada/*.ali ada/b_gnat*.ads ada/b_gnat*.adb\n+\t-$(RM) ada/*$(objext).gnatd.n\n \t-$(RM) ada/*$(coverageexts)\n \t-$(RM) ada/sdefault.adb ada/stamp-sdefault ada/stamp-snames\n \t-$(RMDIR) ada/tools\n+\t-$(RMDIR) ada/libgnat\n \t-$(RM) gnatbind$(exeext) gnat1$(exeext)\n ada.clean:\n ada.distclean:"}]}