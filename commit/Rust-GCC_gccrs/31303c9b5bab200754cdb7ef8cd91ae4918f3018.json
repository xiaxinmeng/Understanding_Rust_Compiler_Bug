{"sha": "31303c9b5bab200754cdb7ef8cd91ae4918f3018", "node_id": "C_kwDOANBUbNoAKDMxMzAzYzliNWJhYjIwMDc1NGNkYjdlZjhjZDkxYWU0OTE4ZjMwMTg", "commit": {"author": {"name": "Harald Anlauf", "email": "anlauf@gmx.de", "date": "2023-02-21T21:06:33Z"}, "committer": {"name": "Harald Anlauf", "email": "anlauf@gmx.de", "date": "2023-02-22T17:41:20Z"}, "message": "Fortran: reject invalid CHARACTER length of derived type components [PR96024]\n\ngcc/fortran/ChangeLog:\n\n\tPR fortran/96024\n\t* resolve.cc (resolve_component): The type of a CHARACTER length\n\texpression must be INTEGER.\n\ngcc/testsuite/ChangeLog:\n\n\tPR fortran/96024\n\t* gfortran.dg/pr96024.f90: New test.", "tree": {"sha": "91a4662b54d0a70401dcfdb87e7b952ba1a0f623", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/91a4662b54d0a70401dcfdb87e7b952ba1a0f623"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/31303c9b5bab200754cdb7ef8cd91ae4918f3018", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/31303c9b5bab200754cdb7ef8cd91ae4918f3018", "html_url": "https://github.com/Rust-GCC/gccrs/commit/31303c9b5bab200754cdb7ef8cd91ae4918f3018", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/31303c9b5bab200754cdb7ef8cd91ae4918f3018/comments", "author": {"login": "harald-anlauf", "id": 90786862, "node_id": "MDQ6VXNlcjkwNzg2ODYy", "avatar_url": "https://avatars.githubusercontent.com/u/90786862?v=4", "gravatar_id": "", "url": "https://api.github.com/users/harald-anlauf", "html_url": "https://github.com/harald-anlauf", "followers_url": "https://api.github.com/users/harald-anlauf/followers", "following_url": "https://api.github.com/users/harald-anlauf/following{/other_user}", "gists_url": "https://api.github.com/users/harald-anlauf/gists{/gist_id}", "starred_url": "https://api.github.com/users/harald-anlauf/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/harald-anlauf/subscriptions", "organizations_url": "https://api.github.com/users/harald-anlauf/orgs", "repos_url": "https://api.github.com/users/harald-anlauf/repos", "events_url": "https://api.github.com/users/harald-anlauf/events{/privacy}", "received_events_url": "https://api.github.com/users/harald-anlauf/received_events", "type": "User", "site_admin": false}, "committer": {"login": "harald-anlauf", "id": 90786862, "node_id": "MDQ6VXNlcjkwNzg2ODYy", "avatar_url": "https://avatars.githubusercontent.com/u/90786862?v=4", "gravatar_id": "", "url": "https://api.github.com/users/harald-anlauf", "html_url": "https://github.com/harald-anlauf", "followers_url": "https://api.github.com/users/harald-anlauf/followers", "following_url": "https://api.github.com/users/harald-anlauf/following{/other_user}", "gists_url": "https://api.github.com/users/harald-anlauf/gists{/gist_id}", "starred_url": "https://api.github.com/users/harald-anlauf/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/harald-anlauf/subscriptions", "organizations_url": "https://api.github.com/users/harald-anlauf/orgs", "repos_url": "https://api.github.com/users/harald-anlauf/repos", "events_url": "https://api.github.com/users/harald-anlauf/events{/privacy}", "received_events_url": "https://api.github.com/users/harald-anlauf/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "5344482c4d3ae0618fa8f5ed38f8309db43fdb82", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/5344482c4d3ae0618fa8f5ed38f8309db43fdb82", "html_url": "https://github.com/Rust-GCC/gccrs/commit/5344482c4d3ae0618fa8f5ed38f8309db43fdb82"}], "stats": {"total": 24, "additions": 24, "deletions": 0}, "files": [{"sha": "2780c82c7983acce9a5c314ca6fa47e49df684f2", "filename": "gcc/fortran/resolve.cc", "status": "modified", "additions": 13, "deletions": 0, "changes": 13, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/31303c9b5bab200754cdb7ef8cd91ae4918f3018/gcc%2Ffortran%2Fresolve.cc", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/31303c9b5bab200754cdb7ef8cd91ae4918f3018/gcc%2Ffortran%2Fresolve.cc", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ffortran%2Fresolve.cc?ref=31303c9b5bab200754cdb7ef8cd91ae4918f3018", "patch": "@@ -14892,6 +14892,19 @@ resolve_component (gfc_component *c, gfc_symbol *sym)\n                     c->ts.u.cl->length ? &c->ts.u.cl->length->where : &c->loc);\n          return false;\n        }\n+\n+     if (c->ts.u.cl->length && c->ts.u.cl->length->ts.type != BT_INTEGER)\n+       {\n+\t if (!c->ts.u.cl->length->error)\n+\t   {\n+\t     gfc_error (\"Character length expression of component %qs at %L \"\n+\t\t\t\"must be of INTEGER type, found %s\",\n+\t\t\tc->name, &c->ts.u.cl->length->where,\n+\t\t\tgfc_basic_typename (c->ts.u.cl->length->ts.type));\n+\t     c->ts.u.cl->length->error = 1;\n+\t   }\n+\t return false;\n+       }\n     }\n \n   if (c->ts.type == BT_CHARACTER && c->ts.deferred"}, {"sha": "2c914a997f2d49e9fa6f8008b66d35ca12cbdbe3", "filename": "gcc/testsuite/gfortran.dg/pr96024.f90", "status": "added", "additions": 11, "deletions": 0, "changes": 11, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/31303c9b5bab200754cdb7ef8cd91ae4918f3018/gcc%2Ftestsuite%2Fgfortran.dg%2Fpr96024.f90", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/31303c9b5bab200754cdb7ef8cd91ae4918f3018/gcc%2Ftestsuite%2Fgfortran.dg%2Fpr96024.f90", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgfortran.dg%2Fpr96024.f90?ref=31303c9b5bab200754cdb7ef8cd91ae4918f3018", "patch": "@@ -0,0 +1,11 @@\n+! { dg-do compile }\n+! PR fortran/96024 - ICE in mio_name_expr_t\n+! Contributed by G.Steinmetz\n+\n+module m\n+  implicit none\n+  type t\n+     character(char(1)) :: a ! { dg-error \"must be of INTEGER type\" }\n+  end type\n+  type(t) :: z = t('a')\n+end"}]}