{"sha": "47370f050940a2e140e89fc0d46e808fab206f04", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6NDczNzBmMDUwOTQwYTJlMTQwZTg5ZmMwZDQ2ZTgwOGZhYjIwNmYwNA==", "commit": {"author": {"name": "Ian Lance Taylor", "email": "ian@gcc.gnu.org", "date": "2019-10-12T01:06:43Z"}, "committer": {"name": "Ian Lance Taylor", "email": "ian@gcc.gnu.org", "date": "2019-10-12T01:06:43Z"}, "message": "compiler: mangle dots in pkgpath\n    \n    We need to mangle dots to avoid problems with -fgo-pkgpath=a.0.\n    That will confuse the name mangling, which assumes that names\n    entering the mangling cannot contain arbitrary dot characters.\n    We don't need to mangle other characters; go_encode_id will handle them.\n    \n    Fixes golang/go#33871\n    \n    Reviewed-on: https://go-review.googlesource.com/c/gofrontend/+/200838\n\nFrom-SVN: r276913", "tree": {"sha": "db8d3f678ba5fd8a4c6bd397af5a5c4e0d55f4bd", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/db8d3f678ba5fd8a4c6bd397af5a5c4e0d55f4bd"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/47370f050940a2e140e89fc0d46e808fab206f04", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/47370f050940a2e140e89fc0d46e808fab206f04", "html_url": "https://github.com/Rust-GCC/gccrs/commit/47370f050940a2e140e89fc0d46e808fab206f04", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/47370f050940a2e140e89fc0d46e808fab206f04/comments", "author": null, "committer": null, "parents": [{"sha": "36cefd37da8b7819b10664f6c740e6a839b3ea08", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/36cefd37da8b7819b10664f6c740e6a839b3ea08", "html_url": "https://github.com/Rust-GCC/gccrs/commit/36cefd37da8b7819b10664f6c740e6a839b3ea08"}], "stats": {"total": 28, "additions": 25, "deletions": 3}, "files": [{"sha": "1c90e55e9b198d57da99d2307bd1c11bb585d379", "filename": "gcc/go/gofrontend/MERGE", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/47370f050940a2e140e89fc0d46e808fab206f04/gcc%2Fgo%2Fgofrontend%2FMERGE", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/47370f050940a2e140e89fc0d46e808fab206f04/gcc%2Fgo%2Fgofrontend%2FMERGE", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fgo%2Fgofrontend%2FMERGE?ref=47370f050940a2e140e89fc0d46e808fab206f04", "patch": "@@ -1,4 +1,4 @@\n-ddfb845fad1f2e8b84383f262ed5ea5be7b3e35a\n+f174fdad69cad42309984dfa108d80f2ae8a9f78\n \n The first line of this file holds the git revision number of the last\n merge done from the gofrontend repository."}, {"sha": "550da9759f637f46bdcbcd772f326340d587eebc", "filename": "gcc/go/gofrontend/go-encode-id.cc", "status": "modified", "additions": 13, "deletions": 0, "changes": 13, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/47370f050940a2e140e89fc0d46e808fab206f04/gcc%2Fgo%2Fgofrontend%2Fgo-encode-id.cc", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/47370f050940a2e140e89fc0d46e808fab206f04/gcc%2Fgo%2Fgofrontend%2Fgo-encode-id.cc", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fgo%2Fgofrontend%2Fgo-encode-id.cc?ref=47370f050940a2e140e89fc0d46e808fab206f04", "patch": "@@ -253,3 +253,16 @@ go_mangle_struct_tag(const std::string& tag)\n     }\n   return ret;\n }\n+\n+// Encode a package path.\n+\n+std::string\n+go_mangle_pkgpath(const std::string& pkgpath)\n+{\n+  std::string s = pkgpath;\n+  for (size_t i = s.find('.');\n+       i != std::string::npos;\n+       i = s.find('.', i + 1))\n+    s.replace(i, 1, \".x2e\"); // 0x2e is the ASCII encoding for '.'\n+  return s;\n+}"}, {"sha": "2d09b0c545d630b63b896cf7594e8d60c318c04e", "filename": "gcc/go/gofrontend/go-encode-id.h", "status": "modified", "additions": 8, "deletions": 0, "changes": 8, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/47370f050940a2e140e89fc0d46e808fab206f04/gcc%2Fgo%2Fgofrontend%2Fgo-encode-id.h", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/47370f050940a2e140e89fc0d46e808fab206f04/gcc%2Fgo%2Fgofrontend%2Fgo-encode-id.h", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fgo%2Fgofrontend%2Fgo-encode-id.h?ref=47370f050940a2e140e89fc0d46e808fab206f04", "patch": "@@ -34,4 +34,12 @@ go_selectively_encode_id(const std::string &id);\n extern std::string\n go_mangle_struct_tag(const std::string& tag);\n \n+// Encode a package path.  A package path can contain any arbitrary\n+// character, including '.'.  go_encode_id expects that any '.' will\n+// be inserted by name mangling in a controlled manner.  So first\n+// translate any '.' using the same .x encoding as used by\n+// go_mangle_struct_tag.\n+extern std::string\n+go_mangle_pkgpath(const std::string& pkgpath);\n+\n #endif // !defined(GO_ENCODE_ID_H)"}, {"sha": "1ee49dcfa9c47cd9f1b1cb21d1600881764ecd4b", "filename": "gcc/go/gofrontend/gogo.cc", "status": "modified", "additions": 3, "deletions": 2, "changes": 5, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/47370f050940a2e140e89fc0d46e808fab206f04/gcc%2Fgo%2Fgofrontend%2Fgogo.cc", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/47370f050940a2e140e89fc0d46e808fab206f04/gcc%2Fgo%2Fgofrontend%2Fgogo.cc", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fgo%2Fgofrontend%2Fgogo.cc?ref=47370f050940a2e140e89fc0d46e808fab206f04", "patch": "@@ -298,7 +298,7 @@ void\n Gogo::set_pkgpath(const std::string& arg)\n {\n   go_assert(!this->pkgpath_set_);\n-  this->pkgpath_ = arg;\n+  this->pkgpath_ = go_mangle_pkgpath(arg);\n   this->pkgpath_set_ = true;\n   this->pkgpath_from_option_ = true;\n }\n@@ -396,7 +396,8 @@ Gogo::set_package_name(const std::string& package_name,\n \t{\n \t  if (!this->prefix_from_option_)\n \t    this->prefix_ = \"go\";\n-\t  this->pkgpath_ = this->prefix_ + '.' + package_name;\n+\t  this->pkgpath_ = (go_mangle_pkgpath(this->prefix_) + '.'\n+\t\t\t    + package_name);\n \t  this->pkgpath_symbol_ = (Gogo::pkgpath_for_symbol(this->prefix_) + '.'\n \t\t\t\t   + Gogo::pkgpath_for_symbol(package_name));\n \t}"}]}