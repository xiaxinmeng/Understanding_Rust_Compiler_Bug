{"sha": "66c5c67baffb2fa9fd9085c01f2811b07f0f7f60", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6NjZjNWM2N2JhZmZiMmZhOWZkOTA4NWMwMWYyODExYjA3ZjBmN2Y2MA==", "commit": {"author": {"name": "Simon Dardis", "email": "simon.dardis@imgtec.com", "date": "2015-11-06T11:59:20Z"}, "committer": {"name": "Simon Dardis", "email": "dardiss@gcc.gnu.org", "date": "2015-11-06T11:59:20Z"}, "message": "Update loongson vector reductions.\n\n2015-11-06  Simon Dardis  <simon.dardis@imgtec.com>\n\n        * config/mips/loongson.md (vec_loongson_extract_lo_<mode>): New, extract\n        low part to scalar.\n        (reduc_uplus_<mode>): Remove.\n        (reduc_plus_scal_<mode>): Rename from reduc_splus_<mode>, Use vec\n        loongson_extract_lo_<mode>.\n        (reduc_smax_scal_<mode>, reduc_smin_scal_<mode>): Rename from\n        reduc_smax_<mode>, reduc_smax_<mode>, use vec\n        loongson_extract_lo_<mode>.\n        (reduc_umax_scal_<mode>, reduc_umin_scal_<mode>): Rename.\n\nFrom-SVN: r229844", "tree": {"sha": "d154d95f0a29b48b1ecad55cf2a0692668311549", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/d154d95f0a29b48b1ecad55cf2a0692668311549"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/66c5c67baffb2fa9fd9085c01f2811b07f0f7f60", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/66c5c67baffb2fa9fd9085c01f2811b07f0f7f60", "html_url": "https://github.com/Rust-GCC/gccrs/commit/66c5c67baffb2fa9fd9085c01f2811b07f0f7f60", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/66c5c67baffb2fa9fd9085c01f2811b07f0f7f60/comments", "author": null, "committer": null, "parents": [{"sha": "61d371eb413e6917f59bea804b3c167e31f88f98", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/61d371eb413e6917f59bea804b3c167e31f88f98", "html_url": "https://github.com/Rust-GCC/gccrs/commit/61d371eb413e6917f59bea804b3c167e31f88f98"}], "stats": {"total": 68, "additions": 44, "deletions": 24}, "files": [{"sha": "9adcd20d1450737f44cf1a7178074ded80dfa100", "filename": "gcc/ChangeLog", "status": "modified", "additions": 12, "deletions": 0, "changes": 12, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/66c5c67baffb2fa9fd9085c01f2811b07f0f7f60/gcc%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/66c5c67baffb2fa9fd9085c01f2811b07f0f7f60/gcc%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2FChangeLog?ref=66c5c67baffb2fa9fd9085c01f2811b07f0f7f60", "patch": "@@ -1,3 +1,15 @@\n+2015-11-06  Simon Dardis  <simon.dardis@imgtec.com>\n+\n+\t* config/mips/loongson.md (vec_loongson_extract_lo_<mode>): New, extract\n+\tlow part to scalar.\n+\t(reduc_uplus_<mode>): Remove.\n+\t(reduc_plus_scal_<mode>): Rename from reduc_splus_<mode>, Use vec\n+\tloongson_extract_lo_<mode>.\n+\t(reduc_smax_scal_<mode>, reduc_smin_scal_<mode>): Rename from\n+\treduc_smax_<mode>, reduc_smax_<mode>, use vec\n+\tloongson_extract_lo_<mode>.\n+\t(reduc_umax_scal_<mode>, reduc_umin_scal_<mode>): Rename.\n+\n 2015-11-06  Richard Biener  <rguenther@suse.de>\n \n \t* tree-vectorizer.h (struct _bb_vec_info): Add region_begin/end"}, {"sha": "b8489ab5ab9bbdb12aea64fa91de8271ba76a198", "filename": "gcc/config/mips/loongson.md", "status": "modified", "additions": 32, "deletions": 24, "changes": 56, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/66c5c67baffb2fa9fd9085c01f2811b07f0f7f60/gcc%2Fconfig%2Fmips%2Floongson.md", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/66c5c67baffb2fa9fd9085c01f2811b07f0f7f60/gcc%2Fconfig%2Fmips%2Floongson.md", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fconfig%2Fmips%2Floongson.md?ref=66c5c67baffb2fa9fd9085c01f2811b07f0f7f60", "patch": "@@ -852,58 +852,66 @@\n   \"dsrl\\t%0,%1,%2\"\n   [(set_attr \"type\" \"fcvt\")])\n \n-(define_expand \"reduc_uplus_<mode>\"\n-  [(match_operand:VWH 0 \"register_operand\" \"\")\n-   (match_operand:VWH 1 \"register_operand\" \"\")]\n+(define_insn \"vec_loongson_extract_lo_<mode>\"\n+  [(set (match_operand:<V_inner> 0 \"register_operand\" \"=r\")\n+        (vec_select:<V_inner>\n+          (match_operand:VWHB 1 \"register_operand\" \"f\")\n+          (parallel [(const_int 0)])))]\n   \"TARGET_HARD_FLOAT && TARGET_LOONGSON_VECTORS\"\n-{\n-  mips_expand_vec_reduc (operands[0], operands[1], gen_add<mode>3);\n-  DONE;\n-})\n+  \"mfc1\\t%0,%1\"\n+  [(set_attr \"type\" \"mfc\")])\n \n-; ??? Given that we're not describing a widening reduction, we should\n-; not have separate optabs for signed and unsigned.\n-(define_expand \"reduc_splus_<mode>\"\n-  [(match_operand:VWHB 0 \"register_operand\" \"\")\n+(define_expand \"reduc_plus_scal_<mode>\"\n+  [(match_operand:<V_inner> 0 \"register_operand\" \"\")\n    (match_operand:VWHB 1 \"register_operand\" \"\")]\n   \"TARGET_HARD_FLOAT && TARGET_LOONGSON_VECTORS\"\n {\n-  emit_insn (gen_reduc_uplus_<mode>(operands[0], operands[1]));\n+  rtx tmp = gen_reg_rtx (GET_MODE (operands[1]));\n+  mips_expand_vec_reduc (tmp, operands[1], gen_add<mode>3);\n+  emit_insn (gen_vec_loongson_extract_lo_<mode> (operands[0], tmp));\n   DONE;\n })\n \n-(define_expand \"reduc_smax_<mode>\"\n-  [(match_operand:VWHB 0 \"register_operand\" \"\")\n+(define_expand \"reduc_smax_scal_<mode>\"\n+  [(match_operand:<V_inner> 0 \"register_operand\" \"\")\n    (match_operand:VWHB 1 \"register_operand\" \"\")]\n   \"TARGET_HARD_FLOAT && TARGET_LOONGSON_VECTORS\"\n {\n-  mips_expand_vec_reduc (operands[0], operands[1], gen_smax<mode>3);\n+  rtx tmp = gen_reg_rtx (GET_MODE (operands[1]));\n+  mips_expand_vec_reduc (tmp, operands[1], gen_smax<mode>3);\n+  emit_insn (gen_vec_loongson_extract_lo_<mode> (operands[0], tmp));\n   DONE;\n })\n \n-(define_expand \"reduc_smin_<mode>\"\n-  [(match_operand:VWHB 0 \"register_operand\" \"\")\n+(define_expand \"reduc_smin_scal_<mode>\"\n+  [(match_operand:<V_inner> 0 \"register_operand\" \"\")\n    (match_operand:VWHB 1 \"register_operand\" \"\")]\n   \"TARGET_HARD_FLOAT && TARGET_LOONGSON_VECTORS\"\n {\n-  mips_expand_vec_reduc (operands[0], operands[1], gen_smin<mode>3);\n+  rtx tmp = gen_reg_rtx (GET_MODE (operands[1]));\n+  mips_expand_vec_reduc (tmp, operands[1], gen_smin<mode>3);\n+  emit_insn (gen_vec_loongson_extract_lo_<mode> (operands[0], tmp));\n   DONE;\n })\n \n-(define_expand \"reduc_umax_<mode>\"\n-  [(match_operand:VB 0 \"register_operand\" \"\")\n+(define_expand \"reduc_umax_scal_<mode>\"\n+  [(match_operand:<V_inner> 0 \"register_operand\" \"\")\n    (match_operand:VB 1 \"register_operand\" \"\")]\n   \"TARGET_HARD_FLOAT && TARGET_LOONGSON_VECTORS\"\n {\n-  mips_expand_vec_reduc (operands[0], operands[1], gen_umax<mode>3);\n+  rtx tmp = gen_reg_rtx (GET_MODE (operands[1]));\n+  mips_expand_vec_reduc (tmp, operands[1], gen_umax<mode>3);\n+  emit_insn (gen_vec_loongson_extract_lo_<mode> (operands[0], tmp));\n   DONE;\n })\n \n-(define_expand \"reduc_umin_<mode>\"\n-  [(match_operand:VB 0 \"register_operand\" \"\")\n+(define_expand \"reduc_umin_scal_<mode>\"\n+  [(match_operand:<V_inner> 0 \"register_operand\" \"\")\n    (match_operand:VB 1 \"register_operand\" \"\")]\n   \"TARGET_HARD_FLOAT && TARGET_LOONGSON_VECTORS\"\n {\n-  mips_expand_vec_reduc (operands[0], operands[1], gen_umin<mode>3);\n+  rtx tmp = gen_reg_rtx (GET_MODE (operands[1]));\n+  mips_expand_vec_reduc (tmp, operands[1], gen_umin<mode>3);\n+  emit_insn (gen_vec_loongson_extract_lo_<mode> (operands[0], tmp));\n   DONE;\n })"}]}