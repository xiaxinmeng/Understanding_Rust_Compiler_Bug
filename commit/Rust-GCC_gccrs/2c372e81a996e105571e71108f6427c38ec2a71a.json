{"sha": "2c372e81a996e105571e71108f6427c38ec2a71a", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6MmMzNzJlODFhOTk2ZTEwNTU3MWU3MTEwOGY2NDI3YzM4ZWMyYTcxYQ==", "commit": {"author": {"name": "Tom de Vries", "email": "tdevries@suse.de", "date": "2019-01-09T00:07:45Z"}, "committer": {"name": "Tom de Vries", "email": "vries@gcc.gnu.org", "date": "2019-01-09T00:07:45Z"}, "message": "[nvptx, libgomp] Don't launch with num_workers == 0\n\nWhen using a compiler build with:\n...\n+#define PTX_DEFAULT_VECTOR_LENGTH PTX_CTA_SIZE\n+#define PTX_MAX_VECTOR_LENGTH PTX_CTA_SIZE\n...\nand running the libgomp testsuite, we run into an execution failure in\nparallel-loop-1.c, due to a cuda launch failure:\n...\n  nvptx_exec: kernel f6_none_none$_omp_fn$0: launch gangs=480, workers=0, \\\n    vectors=1024\n\nlibgomp: cuLaunchKernel error: invalid argument\n...\nbecause workers == 0.\n\nThe workers variable is set to 0 here in nvptx_exec:\n...\n                workers = blocks / actual_vectors;\n...\nbecause actual_vectors is 1024, and blocks is 768:\n...\ncuOccupancyMaxPotentialBlockSize: grid = 10, block = 768\n...\n\nFix this by ensuring that workers is at least one.\n\n2019-01-09  Tom de Vries  <tdevries@suse.de>\n\n\t* plugin/plugin-nvptx.c (nvptx_exec): Make sure to launch with at least\n\tone worker.\n\nFrom-SVN: r267746", "tree": {"sha": "05b0f1581a5c4df9e429111e829aa160e0fab069", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/05b0f1581a5c4df9e429111e829aa160e0fab069"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/2c372e81a996e105571e71108f6427c38ec2a71a", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/2c372e81a996e105571e71108f6427c38ec2a71a", "html_url": "https://github.com/Rust-GCC/gccrs/commit/2c372e81a996e105571e71108f6427c38ec2a71a", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/2c372e81a996e105571e71108f6427c38ec2a71a/comments", "author": {"login": "vries", "id": 4057235, "node_id": "MDQ6VXNlcjQwNTcyMzU=", "avatar_url": "https://avatars.githubusercontent.com/u/4057235?v=4", "gravatar_id": "", "url": "https://api.github.com/users/vries", "html_url": "https://github.com/vries", "followers_url": "https://api.github.com/users/vries/followers", "following_url": "https://api.github.com/users/vries/following{/other_user}", "gists_url": "https://api.github.com/users/vries/gists{/gist_id}", "starred_url": "https://api.github.com/users/vries/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/vries/subscriptions", "organizations_url": "https://api.github.com/users/vries/orgs", "repos_url": "https://api.github.com/users/vries/repos", "events_url": "https://api.github.com/users/vries/events{/privacy}", "received_events_url": "https://api.github.com/users/vries/received_events", "type": "User", "site_admin": false}, "committer": null, "parents": [{"sha": "fc490e0478f67c12e9662c177fed87f47456cea5", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/fc490e0478f67c12e9662c177fed87f47456cea5", "html_url": "https://github.com/Rust-GCC/gccrs/commit/fc490e0478f67c12e9662c177fed87f47456cea5"}], "stats": {"total": 6, "additions": 6, "deletions": 0}, "files": [{"sha": "fba0ba0562ac4222605b28390fa8bbc2976fca3b", "filename": "libgomp/ChangeLog", "status": "modified", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/2c372e81a996e105571e71108f6427c38ec2a71a/libgomp%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/2c372e81a996e105571e71108f6427c38ec2a71a/libgomp%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libgomp%2FChangeLog?ref=2c372e81a996e105571e71108f6427c38ec2a71a", "patch": "@@ -1,3 +1,8 @@\n+2019-01-09  Tom de Vries  <tdevries@suse.de>\n+\n+\t* plugin/plugin-nvptx.c (nvptx_exec): Make sure to launch with at least\n+\tone worker.\n+\n 2019-01-07  Tom de Vries  <tdevries@suse.de>\n \n \t* testsuite/libgomp.oacc-c-c++-common/vector-length-128-3.c: Fix"}, {"sha": "60553bdf3bd58a31eaf72f3f793e63bae22121de", "filename": "libgomp/plugin/plugin-nvptx.c", "status": "modified", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/2c372e81a996e105571e71108f6427c38ec2a71a/libgomp%2Fplugin%2Fplugin-nvptx.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/2c372e81a996e105571e71108f6427c38ec2a71a/libgomp%2Fplugin%2Fplugin-nvptx.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libgomp%2Fplugin%2Fplugin-nvptx.c?ref=2c372e81a996e105571e71108f6427c38ec2a71a", "patch": "@@ -1272,6 +1272,7 @@ nvptx_exec (void (*fn), size_t mapnum, void **hostaddrs, void **devaddrs,\n \t\t\t\t      ? vectors\n \t\t\t\t      : dims[GOMP_DIM_VECTOR]);\n \t\tworkers = blocks / actual_vectors;\n+\t\tworkers = MAX (workers, 1);\n \t      }\n \n \t    for (i = 0; i != GOMP_DIM_MAX; i++)"}]}