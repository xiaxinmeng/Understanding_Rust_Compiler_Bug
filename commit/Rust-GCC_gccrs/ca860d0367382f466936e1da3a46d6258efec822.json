{"sha": "ca860d0367382f466936e1da3a46d6258efec822", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6Y2E4NjBkMDM2NzM4MmY0NjY5MzZlMWRhM2E0NmQ2MjU4ZWZlYzgyMg==", "commit": {"author": {"name": "Martin Jambor", "email": "mjambor@suse.cz", "date": "2014-04-16T09:20:43Z"}, "committer": {"name": "Martin Jambor", "email": "jamborm@gcc.gnu.org", "date": "2014-04-16T09:20:43Z"}, "message": "cgraphclones.c (cgraph_create_virtual_clone): Duplicate ipa_transforms_to_apply.\n\n2014-04-16  Martin Jambor  <mjambor@suse.cz>\n\n\t* cgraphclones.c (cgraph_create_virtual_clone): Duplicate\n\tipa_transforms_to_apply.\n\t(cgraph_function_versioning): Assert that old_node has empty\n\tipa_transforms_to_apply.\n\t* trans-mem.c (ipa_tm_create_version): Likewise.\n\t* tree-inline.c (tree_function_versioning): Do not duplicate\n\tipa_transforms_to_apply.\n\nFrom-SVN: r209441", "tree": {"sha": "dd571458b5f17429edbc1f60acb67d6fa5f2ecd4", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/dd571458b5f17429edbc1f60acb67d6fa5f2ecd4"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/ca860d0367382f466936e1da3a46d6258efec822", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/ca860d0367382f466936e1da3a46d6258efec822", "html_url": "https://github.com/Rust-GCC/gccrs/commit/ca860d0367382f466936e1da3a46d6258efec822", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/ca860d0367382f466936e1da3a46d6258efec822/comments", "author": {"login": "jamborm", "id": 2180070, "node_id": "MDQ6VXNlcjIxODAwNzA=", "avatar_url": "https://avatars.githubusercontent.com/u/2180070?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jamborm", "html_url": "https://github.com/jamborm", "followers_url": "https://api.github.com/users/jamborm/followers", "following_url": "https://api.github.com/users/jamborm/following{/other_user}", "gists_url": "https://api.github.com/users/jamborm/gists{/gist_id}", "starred_url": "https://api.github.com/users/jamborm/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jamborm/subscriptions", "organizations_url": "https://api.github.com/users/jamborm/orgs", "repos_url": "https://api.github.com/users/jamborm/repos", "events_url": "https://api.github.com/users/jamborm/events{/privacy}", "received_events_url": "https://api.github.com/users/jamborm/received_events", "type": "User", "site_admin": false}, "committer": null, "parents": [{"sha": "fe4e71e4d7e881ec3d08d385f16d9c77fee73bc9", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/fe4e71e4d7e881ec3d08d385f16d9c77fee73bc9", "html_url": "https://github.com/Rust-GCC/gccrs/commit/fe4e71e4d7e881ec3d08d385f16d9c77fee73bc9"}], "stats": {"total": 27, "additions": 15, "deletions": 12}, "files": [{"sha": "404ec3f131008eba99dd2b90e45cbad5c662c668", "filename": "gcc/ChangeLog", "status": "modified", "additions": 10, "deletions": 0, "changes": 10, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/ca860d0367382f466936e1da3a46d6258efec822/gcc%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/ca860d0367382f466936e1da3a46d6258efec822/gcc%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2FChangeLog?ref=ca860d0367382f466936e1da3a46d6258efec822", "patch": "@@ -1,3 +1,13 @@\n+2014-04-16  Martin Jambor  <mjambor@suse.cz>\n+\n+\t* cgraphclones.c (cgraph_create_virtual_clone): Duplicate\n+\tipa_transforms_to_apply.\n+\t(cgraph_function_versioning): Assert that old_node has empty\n+\tipa_transforms_to_apply.\n+\t* trans-mem.c (ipa_tm_create_version): Likewise.\n+\t* tree-inline.c (tree_function_versioning): Do not duplicate\n+\tipa_transforms_to_apply.\n+\n 2014-04-16  Rainer Orth  <ro@CeBiTec.Uni-Bielefeld.DE>\n \n \tPR target/60817"}, {"sha": "cd2d73d1c9449ec9c431f3c8566e7a3751f55e2c", "filename": "gcc/cgraphclones.c", "status": "modified", "additions": 4, "deletions": 0, "changes": 4, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/ca860d0367382f466936e1da3a46d6258efec822/gcc%2Fcgraphclones.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/ca860d0367382f466936e1da3a46d6258efec822/gcc%2Fcgraphclones.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fcgraphclones.c?ref=ca860d0367382f466936e1da3a46d6258efec822", "patch": "@@ -600,6 +600,9 @@ cgraph_create_virtual_clone (struct cgraph_node *old_node,\n     }\n   else\n     new_node->clone.combined_args_to_skip = args_to_skip;\n+  if (old_node->ipa_transforms_to_apply.exists ())\n+    new_node->ipa_transforms_to_apply\n+      = old_node->ipa_transforms_to_apply.copy ();\n \n   cgraph_call_node_duplication_hooks (old_node, new_node);\n \n@@ -971,6 +974,7 @@ cgraph_function_versioning (struct cgraph_node *old_version_node,\n     cgraph_copy_node_for_versioning (old_version_node, new_decl,\n \t\t\t\t     redirect_callers, bbs_to_copy);\n \n+  gcc_assert (!old_version_node->ipa_transforms_to_apply.exists ());\n   /* Copy the OLD_VERSION_NODE function tree to the new version.  */\n   tree_function_versioning (old_decl, new_decl, tree_map, false, args_to_skip,\n \t\t\t    skip_return, bbs_to_copy, new_entry_block);"}, {"sha": "87a8fd90e3e91ef59f8e5e0c22e812a824e9dde5", "filename": "gcc/trans-mem.c", "status": "modified", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/ca860d0367382f466936e1da3a46d6258efec822/gcc%2Ftrans-mem.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/ca860d0367382f466936e1da3a46d6258efec822/gcc%2Ftrans-mem.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftrans-mem.c?ref=ca860d0367382f466936e1da3a46d6258efec822", "patch": "@@ -4914,6 +4914,7 @@ ipa_tm_create_version (struct cgraph_node *old_node)\n   if (DECL_ONE_ONLY (new_decl))\n     DECL_COMDAT_GROUP (new_decl) = tm_mangle (DECL_COMDAT_GROUP (old_decl));\n \n+  gcc_assert (!old_node->ipa_transforms_to_apply.exists ());\n   new_node = cgraph_copy_node_for_versioning (old_node, new_decl, vNULL, NULL);\n   new_node->local.local = false;\n   new_node->externally_visible = old_node->externally_visible;"}, {"sha": "a0832b4e7d429c89c8454add8cfcdf3ec48b84ad", "filename": "gcc/tree-inline.c", "status": "modified", "additions": 0, "deletions": 12, "changes": 12, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/ca860d0367382f466936e1da3a46d6258efec822/gcc%2Ftree-inline.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/ca860d0367382f466936e1da3a46d6258efec822/gcc%2Ftree-inline.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftree-inline.c?ref=ca860d0367382f466936e1da3a46d6258efec822", "patch": "@@ -5324,18 +5324,6 @@ tree_function_versioning (tree old_decl, tree new_decl,\n   id.dst_node = new_version_node;\n   id.src_cfun = DECL_STRUCT_FUNCTION (old_decl);\n   id.blocks_to_copy = blocks_to_copy;\n-  if (id.src_node->ipa_transforms_to_apply.exists ())\n-    {\n-      vec<ipa_opt_pass> old_transforms_to_apply\n-\t    = id.dst_node->ipa_transforms_to_apply;\n-      unsigned int i;\n-\n-      id.dst_node->ipa_transforms_to_apply\n-\t    = id.src_node->ipa_transforms_to_apply.copy ();\n-      for (i = 0; i < old_transforms_to_apply.length (); i++)\n-        id.dst_node->ipa_transforms_to_apply.safe_push (old_transforms_to_apply[i]);\n-      old_transforms_to_apply.release ();\n-    }\n \n   id.copy_decl = copy_decl_no_change;\n   id.transform_call_graph_edges"}]}