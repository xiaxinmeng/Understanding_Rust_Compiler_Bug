{"sha": "c006df4eecdd0b1abbaca7728893d3729df10e65", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6YzAwNmRmNGVlY2RkMGIxYWJiYWNhNzcyODg5M2QzNzI5ZGYxMGU2NQ==", "commit": {"author": {"name": "Steven Bosscher", "email": "stevenb@suse.de", "date": "2005-01-27T00:58:11Z"}, "committer": {"name": "Steven Bosscher", "email": "steven@gcc.gnu.org", "date": "2005-01-27T00:58:11Z"}, "message": "trans-decl.c (gfc_build_label_decl): Set DECL_ARTIFICAL and TREE_USED for all labels.\n\n\t* trans-decl.c (gfc_build_label_decl): Set DECL_ARTIFICAL and\n\tTREE_USED for all labels.\n\t(gfc_trans_entry_master_switch): Use it instead of building a\n\tlabel by hand.\n\t* trans-io.c (add_case): Likewise.\n\t* trans-stmt.c (gfc_trans_integer_select): Likewise.\n\nFrom-SVN: r94299", "tree": {"sha": "4960857b959a431ea43e5af1b1a42bcea50d741c", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/4960857b959a431ea43e5af1b1a42bcea50d741c"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/c006df4eecdd0b1abbaca7728893d3729df10e65", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/c006df4eecdd0b1abbaca7728893d3729df10e65", "html_url": "https://github.com/Rust-GCC/gccrs/commit/c006df4eecdd0b1abbaca7728893d3729df10e65", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/c006df4eecdd0b1abbaca7728893d3729df10e65/comments", "author": null, "committer": null, "parents": [{"sha": "2f0a3aa2db103da5125827aad01c97359c62b81e", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/2f0a3aa2db103da5125827aad01c97359c62b81e", "html_url": "https://github.com/Rust-GCC/gccrs/commit/2f0a3aa2db103da5125827aad01c97359c62b81e"}], "stats": {"total": 44, "additions": 21, "deletions": 23}, "files": [{"sha": "18b7753f4bb06f4109c9783531b66bcacb0b2acc", "filename": "gcc/fortran/ChangeLog", "status": "modified", "additions": 9, "deletions": 0, "changes": 9, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/c006df4eecdd0b1abbaca7728893d3729df10e65/gcc%2Ffortran%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/c006df4eecdd0b1abbaca7728893d3729df10e65/gcc%2Ffortran%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ffortran%2FChangeLog?ref=c006df4eecdd0b1abbaca7728893d3729df10e65", "patch": "@@ -1,3 +1,12 @@\n+2004-01-27  Steven Bosscher  <stevenb@suse.de>\n+\n+\t* trans-decl.c (gfc_build_label_decl): Set DECL_ARTIFICAL and\n+\tTREE_USED for all labels.\n+\t(gfc_trans_entry_master_switch): Use it instead of building a\n+\tlabel by hand.\n+\t* trans-io.c (add_case): Likewise.\n+\t* trans-stmt.c (gfc_trans_integer_select): Likewise.\n+\n 2004-01-23  Paul Brook  <paul@codesourcery.com>\n \tSteven G. Kargl  <kargls@comcast.net>\n "}, {"sha": "6567695ad29b7d47457a46de2bcd3d5bd387349a", "filename": "gcc/fortran/trans-decl.c", "status": "modified", "additions": 10, "deletions": 19, "changes": 29, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/c006df4eecdd0b1abbaca7728893d3729df10e65/gcc%2Ffortran%2Ftrans-decl.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/c006df4eecdd0b1abbaca7728893d3729df10e65/gcc%2Ffortran%2Ftrans-decl.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ffortran%2Ftrans-decl.c?ref=c006df4eecdd0b1abbaca7728893d3729df10e65", "patch": "@@ -148,9 +148,9 @@ gfc_add_decl_to_function (tree decl)\n }\n \n \n-/* Build a  backend label declaration.\n-   Set TREE_USED for named lables.  For artificial labels it's up to the\n-   caller to mark the label as used.  */\n+/* Build a  backend label declaration.  Set TREE_USED for named labels.\n+   The context of the label is always the current_function_decl.  All\n+   labels are marked artificial.  */\n \n tree\n gfc_build_label_decl (tree label_id)\n@@ -174,19 +174,13 @@ gfc_build_label_decl (tree label_id)\n   DECL_CONTEXT (label_decl) = current_function_decl;\n   DECL_MODE (label_decl) = VOIDmode;\n \n-  if (label_name)\n-    {\n-      DECL_ARTIFICIAL (label_decl) = 1;\n-    }\n-  else\n-    {\n-      /* We always define the label as used, even if the original source\n-         file never references the label.  We don't want all kinds of\n-         spurious warnings for old-style Fortran code with too many\n-         labels.  */\n-      TREE_USED (label_decl) = 1;\n-    }\n+  /* We always define the label as used, even if the original source\n+     file never references the label.  We don't want all kinds of\n+     spurious warnings for old-style Fortran code with too many\n+     labels.  */\n+  TREE_USED (label_decl) = 1;\n \n+  DECL_ARTIFICIAL (label_decl) = 1;\n   return label_decl;\n }\n \n@@ -2122,16 +2116,13 @@ gfc_trans_entry_master_switch (gfc_entry_list * el)\n   for (; el; el = el->next)\n     {\n       /* Add the case label.  */\n-      label = build_decl (LABEL_DECL, NULL_TREE, NULL_TREE);\n-      DECL_CONTEXT (label) = current_function_decl;\n+      label = gfc_build_label_decl (NULL_TREE);\n       val = build_int_cst (gfc_array_index_type, el->id);\n       tmp = build3_v (CASE_LABEL_EXPR, val, NULL_TREE, label);\n       gfc_add_expr_to_block (&block, tmp);\n       \n       /* And jump to the actual entry point.  */\n       label = gfc_build_label_decl (NULL_TREE);\n-      TREE_USED (label) = 1;\n-      DECL_CONTEXT (label) = current_function_decl;\n       tmp = build1_v (GOTO_EXPR, label);\n       gfc_add_expr_to_block (&block, tmp);\n "}, {"sha": "b5ef13f5e1677d63a061b0c73dea41c74f074a1f", "filename": "gcc/fortran/trans-io.c", "status": "modified", "additions": 1, "deletions": 2, "changes": 3, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/c006df4eecdd0b1abbaca7728893d3729df10e65/gcc%2Ffortran%2Ftrans-io.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/c006df4eecdd0b1abbaca7728893d3729df10e65/gcc%2Ffortran%2Ftrans-io.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ffortran%2Ftrans-io.c?ref=c006df4eecdd0b1abbaca7728893d3729df10e65", "patch": "@@ -452,8 +452,7 @@ add_case (int label_value, gfc_st_label * label, stmtblock_t * body)\n   value = build_int_cst (NULL_TREE, label_value);\n \n   /* Make a backend label for this case.  */\n-  tmp = build_decl (LABEL_DECL, NULL_TREE, NULL_TREE);\n-  DECL_CONTEXT (tmp) = current_function_decl;\n+  tmp = gfc_build_label_decl (NULL_TREE);\n \n   /* And the case itself.  */\n   tmp = build3_v (CASE_LABEL_EXPR, value, NULL_TREE, tmp);"}, {"sha": "7a55cbc48c99d0ce7e2953429a2cc0903927743d", "filename": "gcc/fortran/trans-stmt.c", "status": "modified", "additions": 1, "deletions": 2, "changes": 3, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/c006df4eecdd0b1abbaca7728893d3729df10e65/gcc%2Ffortran%2Ftrans-stmt.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/c006df4eecdd0b1abbaca7728893d3729df10e65/gcc%2Ffortran%2Ftrans-stmt.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ffortran%2Ftrans-stmt.c?ref=c006df4eecdd0b1abbaca7728893d3729df10e65", "patch": "@@ -945,8 +945,7 @@ gfc_trans_integer_select (gfc_code * code)\n \t    }\n \n           /* Build a label.  */\n-          label = build_decl (LABEL_DECL, NULL_TREE, NULL_TREE);\n-          DECL_CONTEXT (label) = current_function_decl;\n+          label = gfc_build_label_decl (NULL_TREE);\n \n \t  /* Add this case label.\n              Add parameter 'label', make it match GCC backend.  */"}]}