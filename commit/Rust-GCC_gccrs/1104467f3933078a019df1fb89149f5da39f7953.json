{"sha": "1104467f3933078a019df1fb89149f5da39f7953", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6MTEwNDQ2N2YzOTMzMDc4YTAxOWRmMWZiODkxNDlmNWRhMzlmNzk1Mw==", "commit": {"author": {"name": "Jakub Jelinek", "email": "jakub@redhat.com", "date": "2019-07-31T09:22:48Z"}, "committer": {"name": "Jakub Jelinek", "email": "jakub@gcc.gnu.org", "date": "2019-07-31T09:22:48Z"}, "message": "re PR tree-optimization/91201 (SIMD not generated for horizontal sum of bytes in array)\n\n\tPR tree-optimization/91201\n\t* config/i386/sse.md (reduc_plus_scal_v16qi): New expander.\n\t(REDUC_PLUS_MODE): Add V32QImode for TARGET_AVX and V64QImode for\n\tTARGET_AVX512F.\n\t(reduc_plus_scal_<mode>): Improve formatting by introducing\n\ta temporary.\n\n\t* gcc.target/i386/sse2-pr91201.c: New test.\n\t* gcc.target/i386/avx2-pr91201.c: New test.\n\t* gcc.target/i386/avx512bw-pr91201.c: New test.\n\nFrom-SVN: r273927", "tree": {"sha": "45ba19a8b68b968ee8bf1d9e602a462501e1f814", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/45ba19a8b68b968ee8bf1d9e602a462501e1f814"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/1104467f3933078a019df1fb89149f5da39f7953", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/1104467f3933078a019df1fb89149f5da39f7953", "html_url": "https://github.com/Rust-GCC/gccrs/commit/1104467f3933078a019df1fb89149f5da39f7953", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/1104467f3933078a019df1fb89149f5da39f7953/comments", "author": {"login": "jakubjelinek", "id": 9370665, "node_id": "MDQ6VXNlcjkzNzA2NjU=", "avatar_url": "https://avatars.githubusercontent.com/u/9370665?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jakubjelinek", "html_url": "https://github.com/jakubjelinek", "followers_url": "https://api.github.com/users/jakubjelinek/followers", "following_url": "https://api.github.com/users/jakubjelinek/following{/other_user}", "gists_url": "https://api.github.com/users/jakubjelinek/gists{/gist_id}", "starred_url": "https://api.github.com/users/jakubjelinek/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jakubjelinek/subscriptions", "organizations_url": "https://api.github.com/users/jakubjelinek/orgs", "repos_url": "https://api.github.com/users/jakubjelinek/repos", "events_url": "https://api.github.com/users/jakubjelinek/events{/privacy}", "received_events_url": "https://api.github.com/users/jakubjelinek/received_events", "type": "User", "site_admin": false}, "committer": null, "parents": [{"sha": "89626179b6fe42cbd58c715808f7c6401879757f", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/89626179b6fe42cbd58c715808f7c6401879757f", "html_url": "https://github.com/Rust-GCC/gccrs/commit/89626179b6fe42cbd58c715808f7c6401879757f"}], "stats": {"total": 73, "additions": 70, "deletions": 3}, "files": [{"sha": "c0b86881f4afc49d6dab7837068687c3f7ab124c", "filename": "gcc/ChangeLog", "status": "modified", "additions": 9, "deletions": 0, "changes": 9, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/1104467f3933078a019df1fb89149f5da39f7953/gcc%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/1104467f3933078a019df1fb89149f5da39f7953/gcc%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2FChangeLog?ref=1104467f3933078a019df1fb89149f5da39f7953", "patch": "@@ -1,3 +1,12 @@\n+2019-07-31  Jakub Jelinek  <jakub@redhat.com>\n+\n+\tPR tree-optimization/91201\n+\t* config/i386/sse.md (reduc_plus_scal_v16qi): New expander.\n+\t(REDUC_PLUS_MODE): Add V32QImode for TARGET_AVX and V64QImode for\n+\tTARGET_AVX512F.\n+\t(reduc_plus_scal_<mode>): Improve formatting by introducing\n+\ta temporary.\n+\n 2019-07-31  Sudakshina Das  <sudi.das@arm.com>\n \n \t* config/aarch64/aarch64-builtins.c (enum aarch64_builtins): Add"}, {"sha": "56a89154e54e3a0643b73a1fb8789e08e504e839", "filename": "gcc/config/i386/sse.md", "status": "modified", "additions": 24, "deletions": 3, "changes": 27, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/1104467f3933078a019df1fb89149f5da39f7953/gcc%2Fconfig%2Fi386%2Fsse.md", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/1104467f3933078a019df1fb89149f5da39f7953/gcc%2Fconfig%2Fi386%2Fsse.md", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fconfig%2Fi386%2Fsse.md?ref=1104467f3933078a019df1fb89149f5da39f7953", "patch": "@@ -2728,9 +2728,30 @@\n   DONE;\n })\n \n+(define_expand \"reduc_plus_scal_v16qi\"\n+ [(plus:V16QI\n+    (match_operand:QI 0 \"register_operand\")\n+    (match_operand:V16QI 1 \"register_operand\"))]\n+ \"TARGET_SSE2\"\n+{\n+  rtx tmp = gen_reg_rtx (V1TImode);\n+  emit_insn (gen_sse2_lshrv1ti3 (tmp, gen_lowpart (V1TImode, operands[1]),\n+\t\t\t\t GEN_INT (64)));\n+  rtx tmp2 = gen_reg_rtx (V16QImode);\n+  emit_insn (gen_addv16qi3 (tmp2, operands[1], gen_lowpart (V16QImode, tmp)));\n+  rtx tmp3 = gen_reg_rtx (V16QImode);\n+  emit_move_insn (tmp3, CONST0_RTX (V16QImode));\n+  rtx tmp4 = gen_reg_rtx (V2DImode);\n+  emit_insn (gen_sse2_psadbw (tmp4, tmp2, tmp3));\n+  tmp4 = gen_lowpart (V16QImode, tmp4);\n+  emit_insn (gen_vec_extractv16qiqi (operands[0], tmp4, const0_rtx));\n+  DONE;\n+})\n+\n (define_mode_iterator REDUC_PLUS_MODE\n  [(V4DF \"TARGET_AVX\") (V8SF \"TARGET_AVX\")\n-  (V8DF \"TARGET_AVX512F\") (V16SF \"TARGET_AVX512F\")])\n+  (V8DF \"TARGET_AVX512F\") (V16SF \"TARGET_AVX512F\")\n+  (V32QI \"TARGET_AVX\") (V64QI \"TARGET_AVX512F\")])\n \n (define_expand \"reduc_plus_scal_<mode>\"\n  [(plus:REDUC_PLUS_MODE\n@@ -2741,8 +2762,8 @@\n   rtx tmp = gen_reg_rtx (<ssehalfvecmode>mode);\n   emit_insn (gen_vec_extract_hi_<mode> (tmp, operands[1]));\n   rtx tmp2 = gen_reg_rtx (<ssehalfvecmode>mode);\n-  emit_insn (gen_add<ssehalfvecmodelower>3\n-    (tmp2, tmp, gen_lowpart (<ssehalfvecmode>mode, operands[1])));\n+  rtx tmp3 = gen_lowpart (<ssehalfvecmode>mode, operands[1]);\n+  emit_insn (gen_add<ssehalfvecmodelower>3 (tmp2, tmp, tmp3));\n   emit_insn (gen_reduc_plus_scal_<ssehalfvecmodelower> (operands[0], tmp2));\n   DONE;\n })"}, {"sha": "e09f3bf4e50093fbf0c85abc30ac9f56ad64aef5", "filename": "gcc/testsuite/ChangeLog", "status": "modified", "additions": 7, "deletions": 0, "changes": 7, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/1104467f3933078a019df1fb89149f5da39f7953/gcc%2Ftestsuite%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/1104467f3933078a019df1fb89149f5da39f7953/gcc%2Ftestsuite%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2FChangeLog?ref=1104467f3933078a019df1fb89149f5da39f7953", "patch": "@@ -1,3 +1,10 @@\n+2019-07-31  Jakub Jelinek  <jakub@redhat.com>\n+\n+\tPR tree-optimization/91201\n+\t* gcc.target/i386/sse2-pr91201.c: New test.\n+\t* gcc.target/i386/avx2-pr91201.c: New test.\n+\t* gcc.target/i386/avx512bw-pr91201.c: New test.\n+\n 2019-07-31  Sudakshina Das  <sudi.das@arm.com>\n \n \t* gcc.target/aarch64/acle/tme.c: New test."}, {"sha": "4cf0a3a05c4b5aa7901cb28cfcfaa3d353cb82ce", "filename": "gcc/testsuite/gcc.target/i386/avx2-pr91201.c", "status": "added", "additions": 6, "deletions": 0, "changes": 6, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/1104467f3933078a019df1fb89149f5da39f7953/gcc%2Ftestsuite%2Fgcc.target%2Fi386%2Favx2-pr91201.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/1104467f3933078a019df1fb89149f5da39f7953/gcc%2Ftestsuite%2Fgcc.target%2Fi386%2Favx2-pr91201.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgcc.target%2Fi386%2Favx2-pr91201.c?ref=1104467f3933078a019df1fb89149f5da39f7953", "patch": "@@ -0,0 +1,6 @@\n+/* PR tree-optimization/91201 */\n+/* { dg-do compile } */\n+/* { dg-options \"-O3 -mavx2 -mno-avx512f\" } */\n+/* { dg-final { scan-assembler \"\\tvpsadbw\\t\" } } */\n+\n+#include \"sse2-pr91201.c\""}, {"sha": "9829a5c5a5ab1aa754c4eef695f42bfeea6cb20b", "filename": "gcc/testsuite/gcc.target/i386/avx512bw-pr91201.c", "status": "added", "additions": 6, "deletions": 0, "changes": 6, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/1104467f3933078a019df1fb89149f5da39f7953/gcc%2Ftestsuite%2Fgcc.target%2Fi386%2Favx512bw-pr91201.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/1104467f3933078a019df1fb89149f5da39f7953/gcc%2Ftestsuite%2Fgcc.target%2Fi386%2Favx512bw-pr91201.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgcc.target%2Fi386%2Favx512bw-pr91201.c?ref=1104467f3933078a019df1fb89149f5da39f7953", "patch": "@@ -0,0 +1,6 @@\n+/* PR tree-optimization/91201 */\n+/* { dg-do compile } */\n+/* { dg-options \"-O3 -mavx512bw -mprefer-vector-width=512\" } */\n+/* { dg-final { scan-assembler \"\\tvpsadbw\\t\" } } */\n+\n+#include \"sse2-pr91201.c\""}, {"sha": "016b187eb4613b29437d7e6cb9d5e243843d97f3", "filename": "gcc/testsuite/gcc.target/i386/sse2-pr91201.c", "status": "added", "additions": 18, "deletions": 0, "changes": 18, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/1104467f3933078a019df1fb89149f5da39f7953/gcc%2Ftestsuite%2Fgcc.target%2Fi386%2Fsse2-pr91201.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/1104467f3933078a019df1fb89149f5da39f7953/gcc%2Ftestsuite%2Fgcc.target%2Fi386%2Fsse2-pr91201.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgcc.target%2Fi386%2Fsse2-pr91201.c?ref=1104467f3933078a019df1fb89149f5da39f7953", "patch": "@@ -0,0 +1,18 @@\n+/* PR tree-optimization/91201 */\n+/* { dg-do compile } */\n+/* { dg-options \"-O3 -msse2 -mno-sse3\" } */\n+/* { dg-final { scan-assembler \"\\tpsadbw\\t\" } } */\n+\n+unsigned char bytes[1024];\n+\n+unsigned char\n+sum (void)\n+{\n+  unsigned char r = 0;\n+  unsigned char *p = (unsigned char *) bytes;\n+  int n;\n+\n+  for (n = 0; n < sizeof (bytes); ++n)\n+    r += p[n];\n+  return r;\n+}"}]}