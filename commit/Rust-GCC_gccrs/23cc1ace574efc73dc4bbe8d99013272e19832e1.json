{"sha": "23cc1ace574efc73dc4bbe8d99013272e19832e1", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6MjNjYzFhY2U1NzRlZmM3M2RjNGJiZThkOTkwMTMyNzJlMTk4MzJlMQ==", "commit": {"author": {"name": "Emmanuel Briot", "email": "briot@adacore.com", "date": "2011-08-04T13:00:35Z"}, "committer": {"name": "Arnaud Charlet", "email": "charlet@gcc.gnu.org", "date": "2011-08-04T13:00:35Z"}, "message": "makeutl.adb (Compute_Builder_Switches): no longer accept a unit name as an index for Builder'Switches.\n\n2011-08-04  Emmanuel Briot  <briot@adacore.com>\n\n\t* makeutl.adb (Compute_Builder_Switches): no longer accept a unit name\n\tas an index for Builder'Switches. This conforms to the documentation.\n\t* make.adb (Insert_Project_Sources): avoid duplicate code\n\nFrom-SVN: r177375", "tree": {"sha": "96fd65519a4e0289bd387135dbf3778b82117043", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/96fd65519a4e0289bd387135dbf3778b82117043"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/23cc1ace574efc73dc4bbe8d99013272e19832e1", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/23cc1ace574efc73dc4bbe8d99013272e19832e1", "html_url": "https://github.com/Rust-GCC/gccrs/commit/23cc1ace574efc73dc4bbe8d99013272e19832e1", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/23cc1ace574efc73dc4bbe8d99013272e19832e1/comments", "author": {"login": "briot", "id": 42402, "node_id": "MDQ6VXNlcjQyNDAy", "avatar_url": "https://avatars.githubusercontent.com/u/42402?v=4", "gravatar_id": "", "url": "https://api.github.com/users/briot", "html_url": "https://github.com/briot", "followers_url": "https://api.github.com/users/briot/followers", "following_url": "https://api.github.com/users/briot/following{/other_user}", "gists_url": "https://api.github.com/users/briot/gists{/gist_id}", "starred_url": "https://api.github.com/users/briot/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/briot/subscriptions", "organizations_url": "https://api.github.com/users/briot/orgs", "repos_url": "https://api.github.com/users/briot/repos", "events_url": "https://api.github.com/users/briot/events{/privacy}", "received_events_url": "https://api.github.com/users/briot/received_events", "type": "User", "site_admin": false}, "committer": null, "parents": [{"sha": "cef14201989157696946ecdf96159a5520821dd0", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/cef14201989157696946ecdf96159a5520821dd0", "html_url": "https://github.com/Rust-GCC/gccrs/commit/cef14201989157696946ecdf96159a5520821dd0"}], "stats": {"total": 72, "additions": 17, "deletions": 55}, "files": [{"sha": "aa81ae639005e40c04e534980cdc43fe2e15996e", "filename": "gcc/ada/ChangeLog", "status": "modified", "additions": 6, "deletions": 0, "changes": 6, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/23cc1ace574efc73dc4bbe8d99013272e19832e1/gcc%2Fada%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/23cc1ace574efc73dc4bbe8d99013272e19832e1/gcc%2Fada%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fada%2FChangeLog?ref=23cc1ace574efc73dc4bbe8d99013272e19832e1", "patch": "@@ -1,3 +1,9 @@\n+2011-08-04  Emmanuel Briot  <briot@adacore.com>\n+\n+\t* makeutl.adb (Compute_Builder_Switches): no longer accept a unit name\n+\tas an index for Builder'Switches. This conforms to the documentation.\n+\t* make.adb (Insert_Project_Sources): avoid duplicate code\n+\n 2011-08-04  Emmanuel Briot  <briot@adacore.com>\n \n \t* makeutl.adb (Complete_Mains): if the user has passed a relative file"}, {"sha": "6d1eaa5e54a164984e0563e5ad034f48159470a5", "filename": "gcc/ada/make.adb", "status": "modified", "additions": 9, "deletions": 38, "changes": 47, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/23cc1ace574efc73dc4bbe8d99013272e19832e1/gcc%2Fada%2Fmake.adb", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/23cc1ace574efc73dc4bbe8d99013272e19832e1/gcc%2Fada%2Fmake.adb", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fada%2Fmake.adb?ref=23cc1ace574efc73dc4bbe8d99013272e19832e1", "patch": "@@ -5831,7 +5831,7 @@ package body Make is\n \n       --  Get the first executable.\n       --  ??? This needs to be done early, because Osint.Next_Main_File also\n-      --  initializes the primary search directory, used below to initiliaze\n+      --  initializes the primary search directory, used below to initialize\n       --  the \"-I\" parameter\n \n       Main_Source_File := Next_Main_Source;  --  No directory information\n@@ -6610,41 +6610,6 @@ package body Make is\n       Index    : Int;\n       Project  : Project_Id;\n \n-      Extending : constant Boolean := The_Project.Extends /= No_Project;\n-\n-      function Check_Project (P : Project_Id) return Boolean;\n-      --  Returns True if P is The_Project or a project extended by The_Project\n-\n-      -------------------\n-      -- Check_Project --\n-      -------------------\n-\n-      function Check_Project (P : Project_Id) return Boolean is\n-      begin\n-         if All_Projects or else P = The_Project then\n-            return True;\n-\n-         elsif Extending then\n-            declare\n-               Proj : Project_Id;\n-\n-            begin\n-               Proj := The_Project;\n-               while Proj /= null loop\n-                  if P = Proj.Extends then\n-                     return True;\n-                  end if;\n-\n-                  Proj := Proj.Extends;\n-               end loop;\n-            end;\n-         end if;\n-\n-         return False;\n-      end Check_Project;\n-\n-   --  Start of processing for Insert_Project_Sources\n-\n    begin\n       --  Loop through all the sources in the project files\n \n@@ -6662,7 +6627,10 @@ package body Make is\n          then\n             --  And it is a source for the specified project\n \n-            if Check_Project (Unit.File_Names (Impl).Project) then\n+            if All_Projects\n+              or else\n+                Is_Extending (The_Project, Unit.File_Names (Impl).Project)\n+            then\n                Project := Unit.File_Names (Impl).Project;\n \n                --  If we don't have a spec, we cannot consider the source\n@@ -6707,7 +6675,10 @@ package body Make is\n \n          elsif Unit.File_Names (Spec) /= null\n            and then not Unit.File_Names (Spec).Locally_Removed\n-           and then Check_Project (Unit.File_Names (Spec).Project)\n+           and then\n+             (All_Projects\n+              or else\n+                Is_Extending (The_Project, Unit.File_Names (Spec).Project))\n          then\n             --  If there is no source for the body, but there is one for the\n             --  spec which has not been locally removed, then we take this one."}, {"sha": "87eeec8090c0c64901d8e5399cfdcb2ead508fea", "filename": "gcc/ada/makeutl.adb", "status": "modified", "additions": 2, "deletions": 17, "changes": 19, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/23cc1ace574efc73dc4bbe8d99013272e19832e1/gcc%2Fada%2Fmakeutl.adb", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/23cc1ace574efc73dc4bbe8d99013272e19832e1/gcc%2Fada%2Fmakeutl.adb", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fada%2Fmakeutl.adb?ref=23cc1ace574efc73dc4bbe8d99013272e19832e1", "patch": "@@ -2988,21 +2988,6 @@ package body Makeutl is\n                         Shared                  => Project_Tree.Shared,\n                         Force_Lower_Case_Index  => False,\n                         Allow_Wildcards         => True);\n-\n-                     --  If not found, try without extension ???\n-                     --  That's because gnatmake accepts unit names in Switches\n-\n-                     if Switches_For_Main = Nil_Variable_Value\n-                       and then Source.Unit /= null\n-                     then\n-                        Switches_For_Main := Value_Of\n-                          (Name                    => Source.Unit.Name,\n-                           Attribute_Or_Array_Name => Name_Switches,\n-                           In_Package              => Builder_Package,\n-                           Shared                  => Project_Tree.Shared,\n-                           Force_Lower_Case_Index  => False,\n-                           Allow_Wildcards         => True);\n-                     end if;\n                   end if;\n \n                   if Index = 1 then\n@@ -3084,8 +3069,8 @@ package body Makeutl is\n \n             if Switches_For_Lang /= Nil_Variable_Value then\n                Write_Line\n-                 (\"Warning: using Builder'Default_Switches\"\n-                  & \"(\"\"\" & Get_Name_String (Lang)\n+                 (\"Warning: using Builder'Switches(\"\"\"\n+                  & Get_Name_String (Lang)\n                   & \"\"\"), as there are several mains\");\n \n             elsif Other_Switches /= Nil_Variable_Value then"}]}