{"sha": "da9386f9a70ac494939650c0e0a0e4168a6f76d8", "node_id": "C_kwDOANBUbNoAKGRhOTM4NmY5YTcwYWM0OTQ5Mzk2NTBjMGUwYTBlNDE2OGE2Zjc2ZDg", "commit": {"author": {"name": "Siddhesh Poyarekar", "email": "siddhesh@gotplt.org", "date": "2021-12-01T07:28:12Z"}, "committer": {"name": "Siddhesh Poyarekar", "email": "siddhesh@gotplt.org", "date": "2021-12-01T08:27:50Z"}, "message": "tree-optimization/103456 - Record only successes from object_sizes_set\n\nAvoid overwriting osi->changed if object_sizes_set does not update the\nsize, so that a previous success in the same pass is not overwritten.\nThis fixes the bootstrap-ubsan build config, which was failing due to\nincorrect object size.\n\ngcc/ChangeLog:\n\n\tPR tree-optimization/103456\n\t* tree-object-size.c (merge_object_sizes): Update osi->changed\n\tonly if object_sizes_set succeeded.\n\ngcc/testsuite/ChangeLog:\n\n\tPR tree-optimization/103456\n\t* gcc.dg/ubsan/pr103456.c: New test.\n\nCo-authored-by: Martin Li\u0161ka <mliska@suse.cz>\nSigned-off-by: Siddhesh Poyarekar <siddhesh@gotplt.org>", "tree": {"sha": "ec05dc6498fe70ecd3ce0bcdac7b782564fad750", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/ec05dc6498fe70ecd3ce0bcdac7b782564fad750"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/da9386f9a70ac494939650c0e0a0e4168a6f76d8", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/da9386f9a70ac494939650c0e0a0e4168a6f76d8", "html_url": "https://github.com/Rust-GCC/gccrs/commit/da9386f9a70ac494939650c0e0a0e4168a6f76d8", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/da9386f9a70ac494939650c0e0a0e4168a6f76d8/comments", "author": {"login": "siddhesh", "id": 158582, "node_id": "MDQ6VXNlcjE1ODU4Mg==", "avatar_url": "https://avatars.githubusercontent.com/u/158582?v=4", "gravatar_id": "", "url": "https://api.github.com/users/siddhesh", "html_url": "https://github.com/siddhesh", "followers_url": "https://api.github.com/users/siddhesh/followers", "following_url": "https://api.github.com/users/siddhesh/following{/other_user}", "gists_url": "https://api.github.com/users/siddhesh/gists{/gist_id}", "starred_url": "https://api.github.com/users/siddhesh/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/siddhesh/subscriptions", "organizations_url": "https://api.github.com/users/siddhesh/orgs", "repos_url": "https://api.github.com/users/siddhesh/repos", "events_url": "https://api.github.com/users/siddhesh/events{/privacy}", "received_events_url": "https://api.github.com/users/siddhesh/received_events", "type": "User", "site_admin": false}, "committer": {"login": "siddhesh", "id": 158582, "node_id": "MDQ6VXNlcjE1ODU4Mg==", "avatar_url": "https://avatars.githubusercontent.com/u/158582?v=4", "gravatar_id": "", "url": "https://api.github.com/users/siddhesh", "html_url": "https://github.com/siddhesh", "followers_url": "https://api.github.com/users/siddhesh/followers", "following_url": "https://api.github.com/users/siddhesh/following{/other_user}", "gists_url": "https://api.github.com/users/siddhesh/gists{/gist_id}", "starred_url": "https://api.github.com/users/siddhesh/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/siddhesh/subscriptions", "organizations_url": "https://api.github.com/users/siddhesh/orgs", "repos_url": "https://api.github.com/users/siddhesh/repos", "events_url": "https://api.github.com/users/siddhesh/events{/privacy}", "received_events_url": "https://api.github.com/users/siddhesh/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "c177e80609287cd32c6096a4ddc4dbef56c74f77", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/c177e80609287cd32c6096a4ddc4dbef56c74f77", "html_url": "https://github.com/Rust-GCC/gccrs/commit/c177e80609287cd32c6096a4ddc4dbef56c74f77"}], "stats": {"total": 24, "additions": 23, "deletions": 1}, "files": [{"sha": "20322fbaab1e483c98f90e9e4b60c9d39f7adb93", "filename": "gcc/testsuite/gcc.dg/ubsan/pr103456.c", "status": "added", "additions": 21, "deletions": 0, "changes": 21, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/da9386f9a70ac494939650c0e0a0e4168a6f76d8/gcc%2Ftestsuite%2Fgcc.dg%2Fubsan%2Fpr103456.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/da9386f9a70ac494939650c0e0a0e4168a6f76d8/gcc%2Ftestsuite%2Fgcc.dg%2Fubsan%2Fpr103456.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgcc.dg%2Fubsan%2Fpr103456.c?ref=da9386f9a70ac494939650c0e0a0e4168a6f76d8", "patch": "@@ -0,0 +1,21 @@\n+/* PR tree-optimization/103456 */\n+/* { dg-do compile } */\n+/* { dg-options \"-fsanitize=undefined -O -fdump-tree-objsz\" } */\n+\n+static char *multilib_options = \"m64/m32\";\n+\n+void\n+used_arg_t (void)\n+{\n+  char *q = multilib_options;\n+  for (;;)\n+    {\n+      while (*q)\n+\tq++;\n+      while (__builtin_strchr (q, '_') == 0)\n+\twhile (*q)\n+\t  q++;\n+    }\n+}\n+\n+/* { dg-final { scan-tree-dump-not \"maximum object size 0\" \"objsz1\" } } */"}, {"sha": "b4881ef198f9f668fb8cf264f1d37a22edfc8df4", "filename": "gcc/tree-object-size.c", "status": "modified", "additions": 2, "deletions": 1, "changes": 3, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/da9386f9a70ac494939650c0e0a0e4168a6f76d8/gcc%2Ftree-object-size.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/da9386f9a70ac494939650c0e0a0e4168a6f76d8/gcc%2Ftree-object-size.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftree-object-size.c?ref=da9386f9a70ac494939650c0e0a0e4168a6f76d8", "patch": "@@ -854,7 +854,8 @@ merge_object_sizes (struct object_size_info *osi, tree dest, tree orig,\n     orig_bytes = (offset > orig_bytes)\n \t\t ? HOST_WIDE_INT_0U : orig_bytes - offset;\n \n-  osi->changed = object_sizes_set (osi, varno, orig_bytes);\n+  if (object_sizes_set (osi, varno, orig_bytes))\n+    osi->changed = true;\n \n   return bitmap_bit_p (osi->reexamine, SSA_NAME_VERSION (orig));\n }"}]}