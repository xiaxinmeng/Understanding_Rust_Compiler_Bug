{"sha": "5e6ae0ccbb98cbe8b17080f69b43be089acba2f5", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6NWU2YWUwY2NiYjk4Y2JlOGIxNzA4MGY2OWI0M2JlMDg5YWNiYTJmNQ==", "commit": {"author": {"name": "Chung-Ju Wu", "email": "jasonwucj@gmail.com", "date": "2018-03-17T13:06:12Z"}, "committer": {"name": "Chung-Ju Wu", "email": "jasonwucj@gcc.gnu.org", "date": "2018-03-17T13:06:12Z"}, "message": "[NDS32] Implment ADJUST_REG_ALLOC_ORDER for performance requirement.\n\ngcc/\n\t* config/nds32/nds32-protos.h (nds32_adjust_reg_alloc_order): Declare.\n\t* config/nds32/nds32.c (nds32_reg_alloc_order_for_speed): New array.\n\t(nds32_adjust_reg_alloc_order): New function.\n\t* config/nds32/nds32.h (ADJUST_REG_ALLOC_ORDER): Define.\n\nCo-Authored-By: Kito Cheng <kito.cheng@gmail.com>\n\nFrom-SVN: r258621", "tree": {"sha": "f282ead8e45d437452f0e40406072fd28fffd113", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/f282ead8e45d437452f0e40406072fd28fffd113"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/5e6ae0ccbb98cbe8b17080f69b43be089acba2f5", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/5e6ae0ccbb98cbe8b17080f69b43be089acba2f5", "html_url": "https://github.com/Rust-GCC/gccrs/commit/5e6ae0ccbb98cbe8b17080f69b43be089acba2f5", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/5e6ae0ccbb98cbe8b17080f69b43be089acba2f5/comments", "author": {"login": "jasonwucj", "id": 5520732, "node_id": "MDQ6VXNlcjU1MjA3MzI=", "avatar_url": "https://avatars.githubusercontent.com/u/5520732?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jasonwucj", "html_url": "https://github.com/jasonwucj", "followers_url": "https://api.github.com/users/jasonwucj/followers", "following_url": "https://api.github.com/users/jasonwucj/following{/other_user}", "gists_url": "https://api.github.com/users/jasonwucj/gists{/gist_id}", "starred_url": "https://api.github.com/users/jasonwucj/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jasonwucj/subscriptions", "organizations_url": "https://api.github.com/users/jasonwucj/orgs", "repos_url": "https://api.github.com/users/jasonwucj/repos", "events_url": "https://api.github.com/users/jasonwucj/events{/privacy}", "received_events_url": "https://api.github.com/users/jasonwucj/received_events", "type": "User", "site_admin": false}, "committer": null, "parents": [{"sha": "5af50159079d2f37118e4eaa6dd269be5d6e1506", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/5af50159079d2f37118e4eaa6dd269be5d6e1506", "html_url": "https://github.com/Rust-GCC/gccrs/commit/5af50159079d2f37118e4eaa6dd269be5d6e1506"}], "stats": {"total": 48, "additions": 48, "deletions": 0}, "files": [{"sha": "a1186fc2dfb5e13e9f03d214ca4e1ae44f15d652", "filename": "gcc/ChangeLog", "status": "modified", "additions": 8, "deletions": 0, "changes": 8, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/5e6ae0ccbb98cbe8b17080f69b43be089acba2f5/gcc%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/5e6ae0ccbb98cbe8b17080f69b43be089acba2f5/gcc%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2FChangeLog?ref=5e6ae0ccbb98cbe8b17080f69b43be089acba2f5", "patch": "@@ -1,3 +1,11 @@\n+2018-03-17  Chung-Ju Wu  <jasonwucj@gmail.com>\n+\t    Kito Cheng  <kito.cheng@gmail.com>\n+\n+\t* config/nds32/nds32-protos.h (nds32_adjust_reg_alloc_order): Declare.\n+\t* config/nds32/nds32.c (nds32_reg_alloc_order_for_speed): New array.\n+\t(nds32_adjust_reg_alloc_order): New function.\n+\t* config/nds32/nds32.h (ADJUST_REG_ALLOC_ORDER): Define.\n+\n 2018-03-17  Kito Cheng  <kito.cheng@gmail.com>\n \n \t* config/nds32/nds32.c (nds32_asm_output_mi_thunk,"}, {"sha": "61105001c72061d2d7224c026438c908d6c57fa8", "filename": "gcc/config/nds32/nds32-protos.h", "status": "modified", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/5e6ae0ccbb98cbe8b17080f69b43be089acba2f5/gcc%2Fconfig%2Fnds32%2Fnds32-protos.h", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/5e6ae0ccbb98cbe8b17080f69b43be089acba2f5/gcc%2Fconfig%2Fnds32%2Fnds32-protos.h", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fconfig%2Fnds32%2Fnds32-protos.h?ref=5e6ae0ccbb98cbe8b17080f69b43be089acba2f5", "patch": "@@ -26,6 +26,11 @@\n extern void nds32_init_expanders (void);\n \n \f\n+/* Register Usage.  */\n+\n+/* -- Order of Allocation of Registers.  */\n+extern void nds32_adjust_reg_alloc_order (void);\n+\n /* Register Classes.  */\n \n extern enum reg_class nds32_regno_reg_class (int);"}, {"sha": "f405ea13e9ea8921d5c46bd800028af51f29ce68", "filename": "gcc/config/nds32/nds32.c", "status": "modified", "additions": 31, "deletions": 0, "changes": 31, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/5e6ae0ccbb98cbe8b17080f69b43be089acba2f5/gcc%2Fconfig%2Fnds32%2Fnds32.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/5e6ae0ccbb98cbe8b17080f69b43be089acba2f5/gcc%2Fconfig%2Fnds32%2Fnds32.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fconfig%2Fnds32%2Fnds32.c?ref=5e6ae0ccbb98cbe8b17080f69b43be089acba2f5", "patch": "@@ -82,6 +82,18 @@ static const char * const nds32_intrinsic_register_names[] =\n   \"$PSW\", \"$IPSW\", \"$ITYPE\", \"$IPC\"\n };\n \n+\n+/* Defining register allocation order for performance.\n+   We want to allocate callee-saved registers after others.\n+   It may be used by nds32_adjust_reg_alloc_order().  */\n+static const int nds32_reg_alloc_order_for_speed[] =\n+{\n+   0,   1,   2,   3,   4,   5,  16,  17,\n+  18,  19,  20,  21,  22,  23,  24,  25,\n+  26,  27,   6,   7,   8,   9,  10,  11,\n+  12,  13,  14,  15\n+};\n+\n /* Defining target-specific uses of __attribute__.  */\n static const struct attribute_spec nds32_attribute_table[] =\n {\n@@ -2870,6 +2882,25 @@ nds32_init_expanders (void)\n \f\n /* Register Usage.  */\n \n+/* -- Order of Allocation of Registers.  */\n+\n+void\n+nds32_adjust_reg_alloc_order (void)\n+{\n+  const int nds32_reg_alloc_order[] = REG_ALLOC_ORDER;\n+\n+  /* Copy the default register allocation order, which is designed\n+     to optimize for code size.  */\n+  memcpy(reg_alloc_order, nds32_reg_alloc_order, sizeof (reg_alloc_order));\n+\n+  /* Adjust few register allocation order when optimizing for speed.  */\n+  if (!optimize_size)\n+    {\n+      memcpy (reg_alloc_order, nds32_reg_alloc_order_for_speed,\n+\t      sizeof (nds32_reg_alloc_order_for_speed));\n+    }\n+}\n+\n /* -- How Values Fit in Registers.  */\n \n /* Implement TARGET_HARD_REGNO_MODE_OK.  */"}, {"sha": "749a55208d40c55dcb1268a8744d71afa428ee5f", "filename": "gcc/config/nds32/nds32.h", "status": "modified", "additions": 4, "deletions": 0, "changes": 4, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/5e6ae0ccbb98cbe8b17080f69b43be089acba2f5/gcc%2Fconfig%2Fnds32%2Fnds32.h", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/5e6ae0ccbb98cbe8b17080f69b43be089acba2f5/gcc%2Fconfig%2Fnds32%2Fnds32.h", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fconfig%2Fnds32%2Fnds32.h?ref=5e6ae0ccbb98cbe8b17080f69b43be089acba2f5", "patch": "@@ -627,6 +627,10 @@ enum nds32_builtins\n    96,  97,  98,  99, 100,                \\\n }\n \n+/* ADJUST_REG_ALLOC_ORDER is a macro which permits reg_alloc_order\n+   to be rearranged based on optimizing for speed or size.  */\n+#define ADJUST_REG_ALLOC_ORDER nds32_adjust_reg_alloc_order ()\n+\n /* Tell IRA to use the order we define rather than messing it up with its\n    own cost calculations.  */\n #define HONOR_REG_ALLOC_ORDER optimize_size"}]}