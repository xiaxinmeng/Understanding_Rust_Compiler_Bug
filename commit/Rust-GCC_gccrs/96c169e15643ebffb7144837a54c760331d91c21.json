{"sha": "96c169e15643ebffb7144837a54c760331d91c21", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6OTZjMTY5ZTE1NjQzZWJmZmI3MTQ0ODM3YTU0Yzc2MDMzMWQ5MWMyMQ==", "commit": {"author": {"name": "Jakub Jelinek", "email": "jakub@redhat.com", "date": "2009-10-14T10:04:22Z"}, "committer": {"name": "Jakub Jelinek", "email": "jakub@gcc.gnu.org", "date": "2009-10-14T10:04:22Z"}, "message": "re PR preprocessor/41543 (BUILTINS_LOCATION wrong with -fpreprocessed)\n\n\tPR preprocessor/41543\n\t* input.h (BUILTINS_LOCATION): Change to 1 from 2.\n\tAssert BUILTINS_LOCATION < RESERVED_LOCATION_COUNT.\n\t* tree.c: Include intl.h.\n\t(expand_location): Handle BUILTINS_LOCATION.\n\t* Makefile.in (tree.o): Depend on intl.h.\n\n\t* include/line-map.h (RESERVED_LOCATION_COUNT): Define.\n\t* line-map.c (linemap_init): Initialize highest_location and\n\thighest_line to RESERVED_LOCATION_COUNT-1 instead of 0.\n\n\t* gcc.dg/debug/dwarf2/pr41543.c: New test.\n\nFrom-SVN: r152761", "tree": {"sha": "1d09c51355f1f205dbfff2b154b3beaa1ef84a15", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/1d09c51355f1f205dbfff2b154b3beaa1ef84a15"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/96c169e15643ebffb7144837a54c760331d91c21", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/96c169e15643ebffb7144837a54c760331d91c21", "html_url": "https://github.com/Rust-GCC/gccrs/commit/96c169e15643ebffb7144837a54c760331d91c21", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/96c169e15643ebffb7144837a54c760331d91c21/comments", "author": {"login": "jakubjelinek", "id": 9370665, "node_id": "MDQ6VXNlcjkzNzA2NjU=", "avatar_url": "https://avatars.githubusercontent.com/u/9370665?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jakubjelinek", "html_url": "https://github.com/jakubjelinek", "followers_url": "https://api.github.com/users/jakubjelinek/followers", "following_url": "https://api.github.com/users/jakubjelinek/following{/other_user}", "gists_url": "https://api.github.com/users/jakubjelinek/gists{/gist_id}", "starred_url": "https://api.github.com/users/jakubjelinek/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jakubjelinek/subscriptions", "organizations_url": "https://api.github.com/users/jakubjelinek/orgs", "repos_url": "https://api.github.com/users/jakubjelinek/repos", "events_url": "https://api.github.com/users/jakubjelinek/events{/privacy}", "received_events_url": "https://api.github.com/users/jakubjelinek/received_events", "type": "User", "site_admin": false}, "committer": null, "parents": [{"sha": "b29ee46cf2f0010084b621c1d2ec50bb5b6a8964", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/b29ee46cf2f0010084b621c1d2ec50bb5b6a8964", "html_url": "https://github.com/Rust-GCC/gccrs/commit/b29ee46cf2f0010084b621c1d2ec50bb5b6a8964"}], "stats": {"total": 56, "additions": 49, "deletions": 7}, "files": [{"sha": "1e0069e4259b944b07f6f980c45cd99a22916f3c", "filename": "gcc/ChangeLog", "status": "modified", "additions": 7, "deletions": 0, "changes": 7, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/96c169e15643ebffb7144837a54c760331d91c21/gcc%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/96c169e15643ebffb7144837a54c760331d91c21/gcc%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2FChangeLog?ref=96c169e15643ebffb7144837a54c760331d91c21", "patch": "@@ -1,5 +1,12 @@\n 2009-10-14  Jakub Jelinek  <jakub@redhat.com>\n \n+\tPR preprocessor/41543\n+\t* input.h (BUILTINS_LOCATION): Change to 1 from 2.\n+\tAssert BUILTINS_LOCATION < RESERVED_LOCATION_COUNT.\n+\t* tree.c: Include intl.h.\n+\t(expand_location): Handle BUILTINS_LOCATION.\n+\t* Makefile.in (tree.o): Depend on intl.h.\n+\n \tPR debug/41695\n \t* dwarf2out.c (dwarf2out_var_location): Always clear\n \tlast_postcall_label when changing last_label."}, {"sha": "34cba739a25eea065adf982cd625a5ef279d3c59", "filename": "gcc/Makefile.in", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/96c169e15643ebffb7144837a54c760331d91c21/gcc%2FMakefile.in", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/96c169e15643ebffb7144837a54c760331d91c21/gcc%2FMakefile.in", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2FMakefile.in?ref=96c169e15643ebffb7144837a54c760331d91c21", "patch": "@@ -2243,7 +2243,7 @@ tree.o : tree.c $(CONFIG_H) $(SYSTEM_H) coretypes.h $(TM_H) $(TREE_H) \\\n    langhooks.h $(REAL_H) gt-tree.h $(TREE_INLINE_H) tree-iterator.h \\\n    $(BASIC_BLOCK_H) $(TREE_FLOW_H) $(OBSTACK_H) pointer-set.h fixed-value.h \\\n    tree-pass.h $(LANGHOOKS_DEF_H) $(DIAGNOSTIC_H) $(CGRAPH_H) $(TIMEVAR_H) \\\n-   $(EXCEPT_H) debug.h\n+   $(EXCEPT_H) debug.h intl.h\n tree-dump.o: tree-dump.c $(CONFIG_H) $(SYSTEM_H) coretypes.h $(TM_H) \\\n    $(TREE_H) langhooks.h $(TOPLEV_H) $(SPLAY_TREE_H) $(TREE_DUMP_H) \\\n    tree-iterator.h $(TREE_PASS_H) $(DIAGNOSTIC_H) $(REAL_H) fixed-value.h"}, {"sha": "7f00dc7cd0a7c4a866e3896e405efefaf7bc250e", "filename": "gcc/input.h", "status": "modified", "additions": 7, "deletions": 2, "changes": 9, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/96c169e15643ebffb7144837a54c760331d91c21/gcc%2Finput.h", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/96c169e15643ebffb7144837a54c760331d91c21/gcc%2Finput.h", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Finput.h?ref=96c169e15643ebffb7144837a54c760331d91c21", "patch": "@@ -1,6 +1,6 @@\n /* Declarations for variables relating to reading the source file.\n    Used by parsers, lexical analyzers, and error message routines.\n-   Copyright (C) 1993, 1997, 1998, 2000, 2003, 2004, 2007, 2008\n+   Copyright (C) 1993, 1997, 1998, 2000, 2003, 2004, 2007, 2008, 2009\n    Free Software Foundation, Inc.\n \n This file is part of GCC.\n@@ -30,7 +30,12 @@ extern GTY(()) struct line_maps *line_table;\n #define UNKNOWN_LOCATION ((source_location) 0)\n \n /* The location for declarations in \"<built-in>\" */\n-#define BUILTINS_LOCATION ((source_location) 2)\n+#define BUILTINS_LOCATION ((source_location) 1)\n+\n+/* line-map.c reserves RESERVED_LOCATION_COUNT to the user.  Ensure\n+   both UNKNOWN_LOCATION and BUILTINS_LOCATION fit into that.  */\n+extern char builtins_location_check[(BUILTINS_LOCATION\n+\t\t\t\t     < RESERVED_LOCATION_COUNT) ? 1 : -1];\n \n typedef struct GTY (())\n {"}, {"sha": "3e8b069eaf2a5181d66369426f88cfb04634022e", "filename": "gcc/testsuite/ChangeLog", "status": "modified", "additions": 3, "deletions": 0, "changes": 3, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/96c169e15643ebffb7144837a54c760331d91c21/gcc%2Ftestsuite%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/96c169e15643ebffb7144837a54c760331d91c21/gcc%2Ftestsuite%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2FChangeLog?ref=96c169e15643ebffb7144837a54c760331d91c21", "patch": "@@ -1,5 +1,8 @@\n 2009-10-14  Jakub Jelinek  <jakub@redhat.com>\n \n+\tPR preprocessor/41543\n+\t* gcc.dg/debug/dwarf2/pr41543.c: New test.\n+\n \tPR debug/41695\n \t* gcc.dg/debug/dwarf2/pr41695.c: New test.\n "}, {"sha": "02683960bdbf656225146664465ad6cb76bd788e", "filename": "gcc/testsuite/gcc.dg/debug/dwarf2/pr41543.c", "status": "added", "additions": 14, "deletions": 0, "changes": 14, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/96c169e15643ebffb7144837a54c760331d91c21/gcc%2Ftestsuite%2Fgcc.dg%2Fdebug%2Fdwarf2%2Fpr41543.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/96c169e15643ebffb7144837a54c760331d91c21/gcc%2Ftestsuite%2Fgcc.dg%2Fdebug%2Fdwarf2%2Fpr41543.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgcc.dg%2Fdebug%2Fdwarf2%2Fpr41543.c?ref=96c169e15643ebffb7144837a54c760331d91c21", "patch": "@@ -0,0 +1,14 @@\n+/* PR preprocessor/41543 */\n+/* { dg-do compile } */\n+/* { dg-options \"-save-temps -g -O0 -dA -fno-merge-debug-strings\" } */\n+\n+#include <stdarg.h>\n+\n+int\n+foo (va_list ap)\n+{\n+  return va_arg (ap, int);\n+}\n+\n+/* { dg-final { scan-assembler-not \"DW_AT_decl_file\\[^\\\\r\\\\n\\]*\\(pr41543\\.i\\)\" } } */\n+/* { dg-final { cleanup-saved-temps } } */"}, {"sha": "b58767a159080971668b6ea8378dc599ab8cd0db", "filename": "gcc/tree.c", "status": "modified", "additions": 3, "deletions": 2, "changes": 5, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/96c169e15643ebffb7144837a54c760331d91c21/gcc%2Ftree.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/96c169e15643ebffb7144837a54c760331d91c21/gcc%2Ftree.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftree.c?ref=96c169e15643ebffb7144837a54c760331d91c21", "patch": "@@ -59,6 +59,7 @@ along with GCC; see the file COPYING3.  If not see\n #include \"timevar.h\"\n #include \"except.h\"\n #include \"debug.h\"\n+#include \"intl.h\"\n \n /* Tree code classes.  */\n \n@@ -3952,9 +3953,9 @@ expanded_location\n expand_location (source_location loc)\n {\n   expanded_location xloc;\n-  if (loc == 0)\n+  if (loc <= BUILTINS_LOCATION)\n     {\n-      xloc.file = NULL;\n+      xloc.file = loc == UNKNOWN_LOCATION ? NULL : _(\"<built-in>\");\n       xloc.line = 0;\n       xloc.column = 0;\n       xloc.sysp = 0;"}, {"sha": "3259c56f46e91ce874fbab414017bd46a9ea0a79", "filename": "libcpp/ChangeLog", "status": "modified", "additions": 7, "deletions": 0, "changes": 7, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/96c169e15643ebffb7144837a54c760331d91c21/libcpp%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/96c169e15643ebffb7144837a54c760331d91c21/libcpp%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libcpp%2FChangeLog?ref=96c169e15643ebffb7144837a54c760331d91c21", "patch": "@@ -1,3 +1,10 @@\n+2009-10-14  Jakub Jelinek  <jakub@redhat.com>\n+\n+\tPR preprocessor/41543\n+\t* include/line-map.h (RESERVED_LOCATION_COUNT): Define.\n+\t* line-map.c (linemap_init): Initialize highest_location and\n+\thighest_line to RESERVED_LOCATION_COUNT-1 instead of 0.\n+\n 2009-10-09  Jason Merrill  <jason@redhat.com>\n \n \t* charset.c (_cpp_valid_ucn): Update C++0x restrictions."}, {"sha": "9e31a6ae3b97303632935ab57a225a235d0a3214", "filename": "libcpp/include/line-map.h", "status": "modified", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/96c169e15643ebffb7144837a54c760331d91c21/libcpp%2Finclude%2Fline-map.h", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/96c169e15643ebffb7144837a54c760331d91c21/libcpp%2Finclude%2Fline-map.h", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libcpp%2Finclude%2Fline-map.h?ref=96c169e15643ebffb7144837a54c760331d91c21", "patch": "@@ -143,6 +143,11 @@ extern const struct line_map *linemap_add\n extern const struct line_map *linemap_lookup\n   (struct line_maps *, source_location);\n \n+/* source_location values from 0 to RESERVED_LOCATION_COUNT-1 will\n+   be reserved for libcpp user as special values, no token from libcpp\n+   will contain any of those locations.  */\n+#define RESERVED_LOCATION_COUNT\t2\n+\n /* Converts a map and a source_location to source line.  */\n #define SOURCE_LINE(MAP, LOC) \\\n   ((((LOC) - (MAP)->start_location) >> (MAP)->column_bits) + (MAP)->to_line)"}, {"sha": "a82c4286f07ba2d48bde4b2d5a9e7c4008651a24", "filename": "libcpp/line-map.c", "status": "modified", "additions": 2, "deletions": 2, "changes": 4, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/96c169e15643ebffb7144837a54c760331d91c21/libcpp%2Fline-map.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/96c169e15643ebffb7144837a54c760331d91c21/libcpp%2Fline-map.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libcpp%2Fline-map.c?ref=96c169e15643ebffb7144837a54c760331d91c21", "patch": "@@ -38,8 +38,8 @@ linemap_init (struct line_maps *set)\n   set->trace_includes = false;\n   set->depth = 0;\n   set->cache = 0;\n-  set->highest_location = 0;\n-  set->highest_line = 0;\n+  set->highest_location = RESERVED_LOCATION_COUNT - 1;\n+  set->highest_line = RESERVED_LOCATION_COUNT - 1;\n   set->max_column_hint = 0;\n   set->reallocator = 0;\n }"}]}