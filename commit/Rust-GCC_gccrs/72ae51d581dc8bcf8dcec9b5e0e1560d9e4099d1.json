{"sha": "72ae51d581dc8bcf8dcec9b5e0e1560d9e4099d1", "node_id": "C_kwDOANBUbNoAKDcyYWU1MWQ1ODFkYzhiY2Y4ZGNlYzliNWUwZTE1NjBkOWU0MDk5ZDE", "commit": {"author": {"name": "Piotr Trojanek", "email": "trojanek@adacore.com", "date": "2022-09-07T15:24:40Z"}, "committer": {"name": "Marc Poulhi\u00e8s", "email": "poulhies@adacore.com", "date": "2022-11-07T08:36:32Z"}, "message": "ada: Cleanup detection of code within generic instances\n\nTo check if a node is located in a generic instance we can either look\nat Instantiation_Location or at the Instantiation_Depth, but just\nlooking at the location is simpler and more efficient.\n\nCleanup related to improved detection of references to uninitialized\nobjects; semantics is unaffected.\n\ngcc/ada/\n\n\t* sem_ch13.adb (Add_Call): Just look at Instantiation_Depth.\n\t* sem_ch3.adb (Derive_Subprograms): Likewise.\n\t* sem_warn.adb (Check_References): Remove redundant filtering with\n\tInstantiation_Depth that follows filtering with\n\tInstantiation_Location.\n\t* sinput.adb (Instantiation_Depth): Reuse Instantiation_Location.", "tree": {"sha": "535590f474425e791455c4f7e515f9c66c8dcc5d", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/535590f474425e791455c4f7e515f9c66c8dcc5d"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/72ae51d581dc8bcf8dcec9b5e0e1560d9e4099d1", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/72ae51d581dc8bcf8dcec9b5e0e1560d9e4099d1", "html_url": "https://github.com/Rust-GCC/gccrs/commit/72ae51d581dc8bcf8dcec9b5e0e1560d9e4099d1", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/72ae51d581dc8bcf8dcec9b5e0e1560d9e4099d1/comments", "author": {"login": "ptroja", "id": 161602, "node_id": "MDQ6VXNlcjE2MTYwMg==", "avatar_url": "https://avatars.githubusercontent.com/u/161602?v=4", "gravatar_id": "", "url": "https://api.github.com/users/ptroja", "html_url": "https://github.com/ptroja", "followers_url": "https://api.github.com/users/ptroja/followers", "following_url": "https://api.github.com/users/ptroja/following{/other_user}", "gists_url": "https://api.github.com/users/ptroja/gists{/gist_id}", "starred_url": "https://api.github.com/users/ptroja/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/ptroja/subscriptions", "organizations_url": "https://api.github.com/users/ptroja/orgs", "repos_url": "https://api.github.com/users/ptroja/repos", "events_url": "https://api.github.com/users/ptroja/events{/privacy}", "received_events_url": "https://api.github.com/users/ptroja/received_events", "type": "User", "site_admin": false}, "committer": {"login": "dkm", "id": 87603, "node_id": "MDQ6VXNlcjg3NjAz", "avatar_url": "https://avatars.githubusercontent.com/u/87603?v=4", "gravatar_id": "", "url": "https://api.github.com/users/dkm", "html_url": "https://github.com/dkm", "followers_url": "https://api.github.com/users/dkm/followers", "following_url": "https://api.github.com/users/dkm/following{/other_user}", "gists_url": "https://api.github.com/users/dkm/gists{/gist_id}", "starred_url": "https://api.github.com/users/dkm/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/dkm/subscriptions", "organizations_url": "https://api.github.com/users/dkm/orgs", "repos_url": "https://api.github.com/users/dkm/repos", "events_url": "https://api.github.com/users/dkm/events{/privacy}", "received_events_url": "https://api.github.com/users/dkm/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "dcc02d3168b4457746f6ab1d8e73cf9d15c6d4e8", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/dcc02d3168b4457746f6ab1d8e73cf9d15c6d4e8", "html_url": "https://github.com/Rust-GCC/gccrs/commit/dcc02d3168b4457746f6ab1d8e73cf9d15c6d4e8"}], "stats": {"total": 13, "additions": 5, "deletions": 8}, "files": [{"sha": "5507353136b604488992c3102044dbb30182ac3f", "filename": "gcc/ada/sem_ch13.adb", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/72ae51d581dc8bcf8dcec9b5e0e1560d9e4099d1/gcc%2Fada%2Fsem_ch13.adb", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/72ae51d581dc8bcf8dcec9b5e0e1560d9e4099d1/gcc%2Fada%2Fsem_ch13.adb", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fada%2Fsem_ch13.adb?ref=72ae51d581dc8bcf8dcec9b5e0e1560d9e4099d1", "patch": "@@ -9930,7 +9930,7 @@ package body Sem_Ch13 is\n \n             if Opt.List_Inherited_Aspects\n               and then not Is_Generic_Actual_Type (Typ)\n-              and then Instantiation_Depth (Sloc (Typ)) = 0\n+              and then Instantiation_Location (Sloc (Typ)) = No_Location\n               and then not Is_Internal_Name (Chars (T))\n               and then not Is_Internal_Name (Chars (Typ))\n             then"}, {"sha": "76dc632506079d5d14594d25369b98429e4f87ec", "filename": "gcc/ada/sem_ch3.adb", "status": "modified", "additions": 3, "deletions": 3, "changes": 6, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/72ae51d581dc8bcf8dcec9b5e0e1560d9e4099d1/gcc%2Fada%2Fsem_ch3.adb", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/72ae51d581dc8bcf8dcec9b5e0e1560d9e4099d1/gcc%2Fada%2Fsem_ch3.adb", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fada%2Fsem_ch3.adb?ref=72ae51d581dc8bcf8dcec9b5e0e1560d9e4099d1", "patch": "@@ -16720,9 +16720,9 @@ package body Sem_Ch3 is\n                        (Is_Generic_Unit\n                           (Scope (Find_Dispatching_Type (Alias_Subp)))\n                          or else\n-                           Instantiation_Depth\n-                             (Sloc (Find_Dispatching_Type (Alias_Subp))) > 0);\n-\n+                           Instantiation_Location\n+                             (Sloc (Find_Dispatching_Type (Alias_Subp)))\n+                               /= No_Location);\n                      declare\n                         Iface_Prim_Loc : constant Source_Ptr :=\n                                          Original_Location (Sloc (Alias_Subp));"}, {"sha": "a1a59a8857b06f20610c6228861df7b71f9ea9d4", "filename": "gcc/ada/sem_warn.adb", "status": "modified", "additions": 0, "deletions": 1, "changes": 1, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/72ae51d581dc8bcf8dcec9b5e0e1560d9e4099d1/gcc%2Fada%2Fsem_warn.adb", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/72ae51d581dc8bcf8dcec9b5e0e1560d9e4099d1/gcc%2Fada%2Fsem_warn.adb", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fada%2Fsem_warn.adb?ref=72ae51d581dc8bcf8dcec9b5e0e1560d9e4099d1", "patch": "@@ -1720,7 +1720,6 @@ package body Sem_Warn is\n             elsif Is_Generic_Subprogram (E1)\n               and then not Is_Instantiated (E1)\n               and then not Publicly_Referenceable (E1)\n-              and then Instantiation_Depth (Sloc (E1)) = 0\n               and then Warn_On_Redundant_Constructs\n             then\n                if not Warnings_Off_E1 and then not Has_Junk_Name (E1) then"}, {"sha": "c96049b26782faecde6ec64ce4aa20e5cc89ef93", "filename": "gcc/ada/sinput.adb", "status": "modified", "additions": 1, "deletions": 3, "changes": 4, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/72ae51d581dc8bcf8dcec9b5e0e1560d9e4099d1/gcc%2Fada%2Fsinput.adb", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/72ae51d581dc8bcf8dcec9b5e0e1560d9e4099d1/gcc%2Fada%2Fsinput.adb", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fada%2Fsinput.adb?ref=72ae51d581dc8bcf8dcec9b5e0e1560d9e4099d1", "patch": "@@ -620,7 +620,6 @@ package body Sinput is\n    -------------------------\n \n    function Instantiation_Depth (S : Source_Ptr) return Nat is\n-      Sind  : Source_File_Index;\n       Sval  : Source_Ptr;\n       Depth : Nat;\n \n@@ -629,8 +628,7 @@ package body Sinput is\n       Depth := 0;\n \n       loop\n-         Sind := Get_Source_File_Index (Sval);\n-         Sval := Instantiation (Sind);\n+         Sval := Instantiation_Location (Sval);\n          exit when Sval = No_Location;\n          Depth := Depth + 1;\n       end loop;"}]}