{"sha": "692b872ea05eef4d95c608e485e681a3295a0cad", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6NjkyYjg3MmVhMDVlZWY0ZDk1YzYwOGU0ODVlNjgxYTMyOTVhMGNhZA==", "commit": {"author": {"name": "Zack Weinberg", "email": "zack@rabi.phys.columbia.edu", "date": "1998-12-16T13:23:47Z"}, "committer": {"name": "Dave Brolley", "email": "brolley@gcc.gnu.org", "date": "1998-12-16T13:23:47Z"}, "message": "cpplib.c (do_include): Treat #include_next in the primary source file as #include plus warning.\n\n1998-12-16  Zack Weinberg  <zack@rabi.phys.columbia.edu>\n\t* cpplib.c (do_include): Treat #include_next in the\n\tprimary source file as #include plus warning.  Treat\n\t#include_next in a file included by absolute path as an\n\terror.  fp == CPP_NULL_BUFFER is a fatal inconsistency.\n\nFrom-SVN: r24340", "tree": {"sha": "0b4f5e9a75ded165e3453ee3a5091359ad1bdbe7", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/0b4f5e9a75ded165e3453ee3a5091359ad1bdbe7"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/692b872ea05eef4d95c608e485e681a3295a0cad", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/692b872ea05eef4d95c608e485e681a3295a0cad", "html_url": "https://github.com/Rust-GCC/gccrs/commit/692b872ea05eef4d95c608e485e681a3295a0cad", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/692b872ea05eef4d95c608e485e681a3295a0cad/comments", "author": null, "committer": null, "parents": [{"sha": "36b8337d5c3d2a64a32883f1a372db98482828c7", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/36b8337d5c3d2a64a32883f1a372db98482828c7", "html_url": "https://github.com/Rust-GCC/gccrs/commit/36b8337d5c3d2a64a32883f1a372db98482828c7"}], "stats": {"total": 33, "additions": 26, "deletions": 7}, "files": [{"sha": "f1e873ab67a0c786c353e9440f80a490b7dc79a8", "filename": "gcc/ChangeLog", "status": "modified", "additions": 7, "deletions": 0, "changes": 7, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/692b872ea05eef4d95c608e485e681a3295a0cad/gcc%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/692b872ea05eef4d95c608e485e681a3295a0cad/gcc%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2FChangeLog?ref=692b872ea05eef4d95c608e485e681a3295a0cad", "patch": "@@ -1,3 +1,10 @@\n+1998-12-16  Zack Weinberg  <zack@rabi.phys.columbia.edu>\n+\n+\t* cpplib.c (do_include): Treat #include_next in the\n+\tprimary source file as #include plus warning.  Treat\n+\t#include_next in a file included by absolute path as an\n+\terror.  fp == CPP_NULL_BUFFER is a fatal inconsistency.\n+\n Wed Dec 16 12:28:54 1998  Kaveh R. Ghazi  <ghazi@caip.rutgers.edu>\n \n \t* cccp.c: Don't define MIN/MAX anymore."}, {"sha": "932f222d8bb84053c4af0cc38224ea5e78471954", "filename": "gcc/cpplib.c", "status": "modified", "additions": 19, "deletions": 7, "changes": 26, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/692b872ea05eef4d95c608e485e681a3295a0cad/gcc%2Fcpplib.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/692b872ea05eef4d95c608e485e681a3295a0cad/gcc%2Fcpplib.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fcpplib.c?ref=692b872ea05eef4d95c608e485e681a3295a0cad", "patch": "@@ -2969,17 +2969,25 @@ do_include (pfile, keyword)\n       break;\n \n   if (fp == CPP_NULL_BUFFER (pfile))\n-    fp = NULL;\n+    {\n+      cpp_fatal (pfile, \"cpp internal error: fp == NULL_BUFFER in do_include\");\n+      return 1;\n+    }\n   \n-  /* For #include_next, skip in the search path\n-     past the dir in which the containing file was found.  */\n-  if (skip_dirs)\n+  /* For #include_next, skip in the search path past the dir in which the\n+     containing file was found.  Treat files specified using an absolute path\n+     as if there are no more directories to search.  Treat the primary source\n+     file like any other included source, but generate a warning.  */\n+  if (skip_dirs && CPP_PREV_BUFFER(fp) != CPP_NULL_BUFFER (pfile))\n     {\n-      if (fp)\n+      if (fp->ihash->foundhere != ABSOLUTE_PATH)\n \tsearch_start = fp->ihash->foundhere->next;\n     }\n   else\n     {\n+      if (skip_dirs)\n+\tcpp_warning (pfile, \"#include_next in primary source file\");\n+      \n       if (angle_brackets)\n \tsearch_start = CPP_OPTIONS (pfile)->bracket_include;\n       else\n@@ -4730,8 +4738,12 @@ cpp_start_read (pfile, fname)\n   fp = cpp_push_buffer (pfile, NULL, 0);\n   if (!fp)\n     return 0;\n-  if (opts->in_fname == NULL)\n-    opts->in_fname = \"\";\n+  if (opts->in_fname == NULL || *opts->in_fname == 0)\n+    {\n+      opts->in_fname = fname;\n+      if (opts->in_fname == NULL)\n+\topts->in_fname = \"\";\n+    }\n   fp->nominal_fname = fp->fname = opts->in_fname;\n   fp->lineno = 0;\n "}]}