{"sha": "21db1c786740b7de9e375f0dd54f78eaa4aa2339", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6MjFkYjFjNzg2NzQwYjdkZTllMzc1ZjBkZDU0Zjc4ZWFhNGFhMjMzOQ==", "commit": {"author": {"name": "Ilya Verbin", "email": "ilya.verbin@intel.com", "date": "2016-06-21T14:32:38Z"}, "committer": {"name": "Ilya Verbin", "email": "iverbin@gcc.gnu.org", "date": "2016-06-21T14:32:38Z"}, "message": "[AVX-512ER] vrcp28ps auto generation\n\ngcc/\n\t* config/i386/i386.c (ix86_emit_swdivsf): Emit vrcp28ps.\ngcc/testsuite/\n\t* gcc.target/i386/avx512er-vrcp28ps-3.c: New test.\n\t* gcc.target/i386/avx512er-vrcp28ps-4.c: New test.\n\nFrom-SVN: r237648", "tree": {"sha": "b924121c2319170fff3ebaf0994fb98c6c11bdb2", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/b924121c2319170fff3ebaf0994fb98c6c11bdb2"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/21db1c786740b7de9e375f0dd54f78eaa4aa2339", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/21db1c786740b7de9e375f0dd54f78eaa4aa2339", "html_url": "https://github.com/Rust-GCC/gccrs/commit/21db1c786740b7de9e375f0dd54f78eaa4aa2339", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/21db1c786740b7de9e375f0dd54f78eaa4aa2339/comments", "author": null, "committer": null, "parents": [{"sha": "9d30e86f965cf7a7ca2405e9e35683b6dc3595e3", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/9d30e86f965cf7a7ca2405e9e35683b6dc3595e3", "html_url": "https://github.com/Rust-GCC/gccrs/commit/9d30e86f965cf7a7ca2405e9e35683b6dc3595e3"}], "stats": {"total": 80, "additions": 78, "deletions": 2}, "files": [{"sha": "dacf8c16fe989312b5f2ea585c62584222ef1731", "filename": "gcc/ChangeLog", "status": "modified", "additions": 4, "deletions": 0, "changes": 4, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/21db1c786740b7de9e375f0dd54f78eaa4aa2339/gcc%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/21db1c786740b7de9e375f0dd54f78eaa4aa2339/gcc%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2FChangeLog?ref=21db1c786740b7de9e375f0dd54f78eaa4aa2339", "patch": "@@ -1,3 +1,7 @@\n+2016-06-21  Ilya Verbin  <ilya.verbin@intel.com>\n+\n+\t* config/i386/i386.c (ix86_emit_swdivsf): Emit vrcp28ps.\n+\n 2016-06-21  H.J. Lu  <hongjiu.lu@intel.com>\n \t    Ilya Enkovich  <ilya.enkovich@intel.com>\n "}, {"sha": "8139807512b50932c3011fcb121e50c89e1c626c", "filename": "gcc/config/i386/i386.c", "status": "modified", "additions": 13, "deletions": 2, "changes": 15, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/21db1c786740b7de9e375f0dd54f78eaa4aa2339/gcc%2Fconfig%2Fi386%2Fi386.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/21db1c786740b7de9e375f0dd54f78eaa4aa2339/gcc%2Fconfig%2Fi386%2Fi386.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fconfig%2Fi386%2Fi386.c?ref=21db1c786740b7de9e375f0dd54f78eaa4aa2339", "patch": "@@ -48726,8 +48726,19 @@ void ix86_emit_swdivsf (rtx res, rtx a, rtx b, machine_mode mode)\n \n   /* x0 = rcp(b) estimate */\n   if (mode == V16SFmode || mode == V8DFmode)\n-    emit_insn (gen_rtx_SET (x0, gen_rtx_UNSPEC (mode, gen_rtvec (1, b),\n-\t\t\t\t\t\tUNSPEC_RCP14)));\n+    {\n+      if (TARGET_AVX512ER)\n+\t{\n+\t  emit_insn (gen_rtx_SET (x0, gen_rtx_UNSPEC (mode, gen_rtvec (1, b),\n+\t\t\t\t\t\t      UNSPEC_RCP28)));\n+\t  /* res = a * x0 */\n+\t  emit_insn (gen_rtx_SET (res, gen_rtx_MULT (mode, a, x0)));\n+\t  return;\n+\t}\n+      else\n+\temit_insn (gen_rtx_SET (x0, gen_rtx_UNSPEC (mode, gen_rtvec (1, b),\n+\t\t\t\t\t\t    UNSPEC_RCP14)));\n+    }\n   else\n     emit_insn (gen_rtx_SET (x0, gen_rtx_UNSPEC (mode, gen_rtvec (1, b),\n \t\t\t\t\t\tUNSPEC_RCP)));"}, {"sha": "cff25cc1979873d7970a96da4edb9d6beff2e1f0", "filename": "gcc/testsuite/ChangeLog", "status": "modified", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/21db1c786740b7de9e375f0dd54f78eaa4aa2339/gcc%2Ftestsuite%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/21db1c786740b7de9e375f0dd54f78eaa4aa2339/gcc%2Ftestsuite%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2FChangeLog?ref=21db1c786740b7de9e375f0dd54f78eaa4aa2339", "patch": "@@ -1,3 +1,8 @@\n+2016-06-21  Ilya Verbin  <ilya.verbin@intel.com>\n+\n+\t* gcc.target/i386/avx512er-vrcp28ps-3.c: New test.\n+\t* gcc.target/i386/avx512er-vrcp28ps-4.c: New test.\n+\n 2016-06-21  H.J. Lu  <hongjiu.lu@intel.com>\n \n \tPR target/71549"}, {"sha": "e08bea41c3e3f634df4cf109637a1190c041e3be", "filename": "gcc/testsuite/gcc.target/i386/avx512er-vrcp28ps-3.c", "status": "added", "additions": 50, "deletions": 0, "changes": 50, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/21db1c786740b7de9e375f0dd54f78eaa4aa2339/gcc%2Ftestsuite%2Fgcc.target%2Fi386%2Favx512er-vrcp28ps-3.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/21db1c786740b7de9e375f0dd54f78eaa4aa2339/gcc%2Ftestsuite%2Fgcc.target%2Fi386%2Favx512er-vrcp28ps-3.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgcc.target%2Fi386%2Favx512er-vrcp28ps-3.c?ref=21db1c786740b7de9e375f0dd54f78eaa4aa2339", "patch": "@@ -0,0 +1,50 @@\n+/* { dg-do run } */\n+/* { dg-require-effective-target avx512er } */\n+/* { dg-options \"-O2 -ffast-math -ftree-vectorize -mavx512er\" } */\n+\n+#include \"avx512er-check.h\"\n+\n+#define MAX 1000\n+#define EPS 0.00001\n+\n+__attribute__ ((noinline, optimize (0)))\n+void static\n+compute_rcp_ref (float *a, float *b, float *r)\n+{\n+  for (int i = 0; i < MAX; i++)\n+    r[i] = a[i] / b[i];\n+}\n+\n+__attribute__ ((noinline))\n+void static\n+compute_rcp_exp (float *a, float *b, float *r)\n+{\n+  for (int i = 0; i < MAX; i++)\n+    r[i] = a[i] / b[i];\n+}\n+\n+void static\n+avx512er_test (void)\n+{\n+  float a[MAX];\n+  float b[MAX];\n+  float ref[MAX];\n+  float exp[MAX];\n+\n+  for (int i = 0; i < MAX; i++)\n+    {\n+      a[i] = 179.345 - 6.5645 * i;\n+      b[i] = 8765.987 - 8.6756 * i;\n+    }\n+\n+  compute_rcp_ref (a, b, ref);\n+  compute_rcp_exp (a, b, exp);\n+\n+  for (int i = 0; i < MAX; i++)\n+    {\n+      float rel_err = (ref[i] - exp[i]) / ref[i];\n+      rel_err = rel_err > 0.0 ? rel_err : -rel_err;\n+      if (rel_err > EPS)\n+\tabort ();\n+    }\n+}"}, {"sha": "2c76d9671847cf95f9a3f49a904a864363ce92b8", "filename": "gcc/testsuite/gcc.target/i386/avx512er-vrcp28ps-4.c", "status": "added", "additions": 6, "deletions": 0, "changes": 6, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/21db1c786740b7de9e375f0dd54f78eaa4aa2339/gcc%2Ftestsuite%2Fgcc.target%2Fi386%2Favx512er-vrcp28ps-4.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/21db1c786740b7de9e375f0dd54f78eaa4aa2339/gcc%2Ftestsuite%2Fgcc.target%2Fi386%2Favx512er-vrcp28ps-4.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgcc.target%2Fi386%2Favx512er-vrcp28ps-4.c?ref=21db1c786740b7de9e375f0dd54f78eaa4aa2339", "patch": "@@ -0,0 +1,6 @@\n+/* { dg-do compile } */\n+/* { dg-options \"-O2 -ffast-math -ftree-vectorize -mavx512er\" } */\n+\n+#include \"avx512er-vrcp28ps-3.c\"\n+\n+/* { dg-final { scan-assembler-times \"vrcp28ps\\[^\\n\\r\\]*zmm\\[0-9\\]+(?:\\n|\\[ \\\\t\\]+#)\" 1 } } */"}]}