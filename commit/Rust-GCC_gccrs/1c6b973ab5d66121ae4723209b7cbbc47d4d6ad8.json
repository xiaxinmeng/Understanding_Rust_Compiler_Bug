{"sha": "1c6b973ab5d66121ae4723209b7cbbc47d4d6ad8", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6MWM2Yjk3M2FiNWQ2NjEyMWFlNDcyMzIwOWI3Y2JiYzQ3ZDRkNmFkOA==", "commit": {"author": {"name": "Arnaud Charlet", "email": "charlet@gcc.gnu.org", "date": "2009-09-17T10:50:49Z"}, "committer": {"name": "Arnaud Charlet", "email": "charlet@gcc.gnu.org", "date": "2009-09-17T10:50:49Z"}, "message": "[multiple changes]\n\n2009-09-17  Emmanuel Briot  <briot@adacore.com>\n\n\t* prj-conf.adb, prj-env.adb, prj-env.ads (Create_Temp_File): Moved to\n\tspec.\n\t(Do_Autoconf): If the object directory does not exists, create auto.cgpr\n\tin a temporary directory instead\n\n2009-09-17  Bob Duff  <duff@adacore.com>\n\n\t* a-dynpri.adb (Set_Priority): Don't do anything if the task is already\n\tterminated.\n\t(Get_Priority): Correct message for \"terminated\" case -- it said \"null\".\n\n2009-09-17  Robert Dewar  <dewar@adacore.com>\n\n\t* exp_ch6.adb: Minor reformatting\n\nFrom-SVN: r151795", "tree": {"sha": "19734f2f4262aa1fe1c05c9a55f71f6763d3eed7", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/19734f2f4262aa1fe1c05c9a55f71f6763d3eed7"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/1c6b973ab5d66121ae4723209b7cbbc47d4d6ad8", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/1c6b973ab5d66121ae4723209b7cbbc47d4d6ad8", "html_url": "https://github.com/Rust-GCC/gccrs/commit/1c6b973ab5d66121ae4723209b7cbbc47d4d6ad8", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/1c6b973ab5d66121ae4723209b7cbbc47d4d6ad8/comments", "author": null, "committer": null, "parents": [{"sha": "52545f22b45c674dcb66ad4df149beb253acd445", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/52545f22b45c674dcb66ad4df149beb253acd445", "html_url": "https://github.com/Rust-GCC/gccrs/commit/52545f22b45c674dcb66ad4df149beb253acd445"}], "stats": {"total": 84, "additions": 65, "deletions": 19}, "files": [{"sha": "d058d97e5a32cb2d203efb02dde4efc16394622b", "filename": "gcc/ada/ChangeLog", "status": "modified", "additions": 17, "deletions": 0, "changes": 17, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/1c6b973ab5d66121ae4723209b7cbbc47d4d6ad8/gcc%2Fada%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/1c6b973ab5d66121ae4723209b7cbbc47d4d6ad8/gcc%2Fada%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fada%2FChangeLog?ref=1c6b973ab5d66121ae4723209b7cbbc47d4d6ad8", "patch": "@@ -1,3 +1,20 @@\n+2009-09-17  Emmanuel Briot  <briot@adacore.com>\n+\n+\t* prj-conf.adb, prj-env.adb, prj-env.ads (Create_Temp_File): Moved to\n+\tspec.\n+\t(Do_Autoconf): If the object directory does not exists, create auto.cgpr\n+\tin a temporary directory instead\n+\n+2009-09-17  Bob Duff  <duff@adacore.com>\n+\n+\t* a-dynpri.adb (Set_Priority): Don't do anything if the task is already\n+\tterminated.\n+\t(Get_Priority): Correct message for \"terminated\" case -- it said \"null\".\n+\n+2009-09-17  Robert Dewar  <dewar@adacore.com>\n+\n+\t* exp_ch6.adb: Minor reformatting\n+\n 2009-09-17  Emmanuel Briot  <briot@adacore.com>\n \n \t* gnatcmd.adb, make.adb, prj-part.adb, prj-ext.adb, prj-ext.ads,"}, {"sha": "9116a573948ad7b2dbc08131a732c15d7cb3aeaa", "filename": "gcc/ada/a-dynpri.adb", "status": "modified", "additions": 6, "deletions": 2, "changes": 8, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/1c6b973ab5d66121ae4723209b7cbbc47d4d6ad8/gcc%2Fada%2Fa-dynpri.adb", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/1c6b973ab5d66121ae4723209b7cbbc47d4d6ad8/gcc%2Fada%2Fa-dynpri.adb", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fada%2Fa-dynpri.adb?ref=1c6b973ab5d66121ae4723209b7cbbc47d4d6ad8", "patch": "@@ -67,7 +67,7 @@ package body Ada.Dynamic_Priorities is\n       end if;\n \n       if Task_Identification.Is_Terminated (T) then\n-         raise Tasking_Error with Error_Message & \"null task\";\n+         raise Tasking_Error with Error_Message & \"terminated task\";\n       end if;\n \n       return Target.Common.Base_Priority;\n@@ -93,8 +93,12 @@ package body Ada.Dynamic_Priorities is\n          raise Program_Error with Error_Message & \"null task\";\n       end if;\n \n+      --  Setting the priority of an already-terminated task doesn't do\n+      --  anything (see RM-D.5.1(7)). Note that Get_Priority is different in\n+      --  this regard.\n+\n       if Task_Identification.Is_Terminated (T) then\n-         raise Tasking_Error with Error_Message & \"terminated task\";\n+         return;\n       end if;\n \n       SSL.Abort_Defer.all;"}, {"sha": "4a31187d9d14bc8c91f914ffd30aeb466a6ab518", "filename": "gcc/ada/exp_ch6.adb", "status": "modified", "additions": 7, "deletions": 7, "changes": 14, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/1c6b973ab5d66121ae4723209b7cbbc47d4d6ad8/gcc%2Fada%2Fexp_ch6.adb", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/1c6b973ab5d66121ae4723209b7cbbc47d4d6ad8/gcc%2Fada%2Fexp_ch6.adb", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fada%2Fexp_ch6.adb?ref=1c6b973ab5d66121ae4723209b7cbbc47d4d6ad8", "patch": "@@ -171,9 +171,9 @@ package body Exp_Ch6 is\n    --\n    --    A := TypeA (Temp);\n    --\n-   --  after the call. Here TypeA is the actual type of variable A.\n-   --  For out parameters, the initial declaration has no expression.\n-   --  If A is not an entity name, we generate instead:\n+   --  after the call. Here TypeA is the actual type of variable A. For out\n+   --  parameters, the initial declaration has no expression. If A is not an\n+   --  entity name, we generate instead:\n    --\n    --    Var  : TypeA renames A;\n    --    Temp : T := Var;       --  omitting expression for out parameter.\n@@ -183,8 +183,8 @@ package body Exp_Ch6 is\n    --  For other in-out parameters, we emit the required constraint checks\n    --  before and/or after the call.\n    --\n-   --  For all parameter modes, actuals that denote components and slices\n-   --  of packed arrays are expanded into suitable temporaries.\n+   --  For all parameter modes, actuals that denote components and slices of\n+   --  packed arrays are expanded into suitable temporaries.\n    --\n    --  For non-scalar objects that are possibly unaligned, add call by copy\n    --  code (copy in for IN and IN OUT, copy out for OUT and IN OUT).\n@@ -419,8 +419,8 @@ package body Exp_Ch6 is\n \n       --  Create the actual which is a pointer to the appropriate finalization\n       --  list. Acc_Type is present if and only if this call is the\n-      --  initialization of an allocator. Use the Current_Scope or the Acc_Type\n-      --  as appropriate.\n+      --  initialization of an allocator. Use the Current_Scope or the\n+      --  Acc_Type as appropriate.\n \n       if Present (Acc_Type)\n         and then (Ekind (Acc_Type) = E_Anonymous_Access_Type"}, {"sha": "e1b365e3453b0b0034057826fb3d6a6206861a39", "filename": "gcc/ada/prj-conf.adb", "status": "modified", "additions": 27, "deletions": 2, "changes": 29, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/1c6b973ab5d66121ae4723209b7cbbc47d4d6ad8/gcc%2Fada%2Fprj-conf.adb", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/1c6b973ab5d66121ae4723209b7cbbc47d4d6ad8/gcc%2Fada%2Fprj-conf.adb", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fada%2Fprj-conf.adb?ref=1c6b973ab5d66121ae4723209b7cbbc47d4d6ad8", "patch": "@@ -29,6 +29,7 @@ with Makeutl;          use Makeutl;\n with MLib.Tgt;\n with Opt;              use Opt;\n with Output;           use Output;\n+with Prj.Env;\n with Prj.Err;\n with Prj.Part;\n with Prj.PP;\n@@ -696,6 +697,7 @@ package body Prj.Conf is\n             Switches : Argument_List_Access := Get_Config_Switches;\n             Args     : Argument_List (1 .. 5);\n             Arg_Last : Positive;\n+            Obj_Dir_Exists : Boolean := True;\n \n          begin\n             --  Check if the object directory exists. If Setup_Projects is True\n@@ -731,6 +733,7 @@ package body Prj.Conf is\n                      Prj.Err.Error_Msg\n                        (Flags,\n                         \"?object directory \" & Obj_Dir & \" does not exist\");\n+                     Obj_Dir_Exists := False;\n                   when Silent =>\n                      null;\n                end case;\n@@ -744,8 +747,30 @@ package body Prj.Conf is\n             --  If no config file was specified, set the auto.cgpr one\n \n             if Config_File_Name = \"\" then\n-               Args (3) := new String'\n-                 (Obj_Dir & Directory_Separator & Auto_Cgpr);\n+               if Obj_Dir_Exists then\n+                  Args (3) := new String'\n+                    (Obj_Dir & Directory_Separator & Auto_Cgpr);\n+               else\n+                  declare\n+                     Path_FD : File_Descriptor;\n+                     Path_Name : Path_Name_Type;\n+                  begin\n+                     Prj.Env.Create_Temp_File\n+                       (In_Tree   => Project_Tree,\n+                        Path_FD   => Path_FD,\n+                        Path_Name => Path_Name,\n+                        File_Use  => \"configuration file\");\n+\n+                     if Path_FD /= Invalid_FD then\n+                        Args (3) := new String'(Get_Name_String (Path_Name));\n+                        GNAT.OS_Lib.Close (Path_FD);\n+                     else\n+                        --  We'll have an error message later on\n+                        Args (3) := new String'\n+                          (Obj_Dir & Directory_Separator & Auto_Cgpr);\n+                     end if;\n+                  end;\n+               end if;\n             else\n                Args (3) := new String'(Config_File_Name);\n             end if;"}, {"sha": "c5182abea09e00a65962c9d5b2ea3a7419f0366c", "filename": "gcc/ada/prj-env.adb", "status": "modified", "additions": 0, "deletions": 8, "changes": 8, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/1c6b973ab5d66121ae4723209b7cbbc47d4d6ad8/gcc%2Fada%2Fprj-env.adb", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/1c6b973ab5d66121ae4723209b7cbbc47d4d6ad8/gcc%2Fada%2Fprj-env.adb", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fada%2Fprj-env.adb?ref=1c6b973ab5d66121ae4723209b7cbbc47d4d6ad8", "patch": "@@ -97,14 +97,6 @@ package body Prj.Env is\n    --  Return a project that is either Project or an extended ancestor of\n    --  Project that itself is not extended.\n \n-   procedure Create_Temp_File\n-     (In_Tree   : Project_Tree_Ref;\n-      Path_FD   : out File_Descriptor;\n-      Path_Name : out Path_Name_Type;\n-      File_Use  : String);\n-   --  Create a temporary file, and fail with an error if it could not be\n-   --  created.\n-\n    ----------------------\n    -- Ada_Include_Path --\n    ----------------------"}, {"sha": "8cebad505243e0ee9337e75e9586f01d0e7d13d2", "filename": "gcc/ada/prj-env.ads", "status": "modified", "additions": 8, "deletions": 0, "changes": 8, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/1c6b973ab5d66121ae4723209b7cbbc47d4d6ad8/gcc%2Fada%2Fprj-env.ads", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/1c6b973ab5d66121ae4723209b7cbbc47d4d6ad8/gcc%2Fada%2Fprj-env.ads", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fada%2Fprj-env.ads?ref=1c6b973ab5d66121ae4723209b7cbbc47d4d6ad8", "patch": "@@ -39,6 +39,14 @@ package Prj.Env is\n    --  of package Fmap), so that Osint.Find_File will find the correct path\n    --  corresponding to a source.\n \n+   procedure Create_Temp_File\n+     (In_Tree   : Project_Tree_Ref;\n+      Path_FD   : out File_Descriptor;\n+      Path_Name : out Path_Name_Type;\n+      File_Use  : String);\n+   --  Create a temporary file, and fail with an error if it could not be\n+   --  created.\n+\n    procedure Create_Mapping_File\n      (Project  : Project_Id;\n       Language : Name_Id;"}]}