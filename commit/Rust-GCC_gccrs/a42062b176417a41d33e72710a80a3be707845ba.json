{"sha": "a42062b176417a41d33e72710a80a3be707845ba", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6YTQyMDYyYjE3NjQxN2E0MWQzM2U3MjcxMGE4MGEzYmU3MDc4NDViYQ==", "commit": {"author": {"name": "Igor Zamyatin", "email": "igor.zamyatin@intel.com", "date": "2015-11-09T10:12:34Z"}, "committer": {"name": "Ilya Enkovich", "email": "ienkovich@gcc.gnu.org", "date": "2015-11-09T10:12:34Z"}, "message": "re PR target/66326 (Floating point exception with -mfpmath=387 and -fcilkplus.)\n\nlibcilkrts/\n\n2015-11-09  Igor Zamyatin  <igor.zamyatin@intel.com>\n\n\tPR target/66326\n\t* runtime/config/x86/os-unix-sysdep.c (sysdep_save_fp_ctrl_state):\n\tUse fnstcw instead fnstsw.\n\n\ngcc/testsuite\n\n2015-11-09  Igor Zamyatin  <igor.zamyatin@intel.com>\n\n\tPR target/66326\n\t* g++.dg/cilk-plus/CK/pr66326.cc: New test.\n\nFrom-SVN: r230008", "tree": {"sha": "7d7578de51d582e5680aa37949c88dd36dc95224", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/7d7578de51d582e5680aa37949c88dd36dc95224"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/a42062b176417a41d33e72710a80a3be707845ba", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/a42062b176417a41d33e72710a80a3be707845ba", "html_url": "https://github.com/Rust-GCC/gccrs/commit/a42062b176417a41d33e72710a80a3be707845ba", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/a42062b176417a41d33e72710a80a3be707845ba/comments", "author": {"login": "Garra1980", "id": 25365940, "node_id": "MDQ6VXNlcjI1MzY1OTQw", "avatar_url": "https://avatars.githubusercontent.com/u/25365940?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Garra1980", "html_url": "https://github.com/Garra1980", "followers_url": "https://api.github.com/users/Garra1980/followers", "following_url": "https://api.github.com/users/Garra1980/following{/other_user}", "gists_url": "https://api.github.com/users/Garra1980/gists{/gist_id}", "starred_url": "https://api.github.com/users/Garra1980/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Garra1980/subscriptions", "organizations_url": "https://api.github.com/users/Garra1980/orgs", "repos_url": "https://api.github.com/users/Garra1980/repos", "events_url": "https://api.github.com/users/Garra1980/events{/privacy}", "received_events_url": "https://api.github.com/users/Garra1980/received_events", "type": "User", "site_admin": false}, "committer": null, "parents": [{"sha": "00402c9415a04840f2f1b08b001ff761fd2a40fc", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/00402c9415a04840f2f1b08b001ff761fd2a40fc", "html_url": "https://github.com/Rust-GCC/gccrs/commit/00402c9415a04840f2f1b08b001ff761fd2a40fc"}], "stats": {"total": 46, "additions": 45, "deletions": 1}, "files": [{"sha": "bcca4791eeb7522c8b246ca32551bfa4c7251fe6", "filename": "gcc/testsuite/ChangeLog", "status": "modified", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/a42062b176417a41d33e72710a80a3be707845ba/gcc%2Ftestsuite%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/a42062b176417a41d33e72710a80a3be707845ba/gcc%2Ftestsuite%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2FChangeLog?ref=a42062b176417a41d33e72710a80a3be707845ba", "patch": "@@ -1,3 +1,8 @@\n+2015-11-09  Igor Zamyatin  <igor.zamyatin@intel.com>\n+\n+\tPR target/66326\n+\t* g++.dg/cilk-plus/CK/pr66326.cc: New test.\n+\n 2015-11-09  Richard Henderson  <rth@redhat.com>\n \n \t* gcc.target/i386/addr-space-1.c: New test."}, {"sha": "1114ebdda8236b55602ed90207c022254f710763", "filename": "gcc/testsuite/g++.dg/cilk-plus/CK/pr66326.cc", "status": "added", "additions": 33, "deletions": 0, "changes": 33, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/a42062b176417a41d33e72710a80a3be707845ba/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Fcilk-plus%2FCK%2Fpr66326.cc", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/a42062b176417a41d33e72710a80a3be707845ba/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Fcilk-plus%2FCK%2Fpr66326.cc", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Fcilk-plus%2FCK%2Fpr66326.cc?ref=a42062b176417a41d33e72710a80a3be707845ba", "patch": "@@ -0,0 +1,33 @@\n+/* { dg-options \"-fcilkplus\" } */\n+/* { dg-do run { target i?86-*-* x86_64-*-* } } */\n+/* { dg-options \"-fcilkplus -lcilkrts\" { target { i?86-*-* x86_64-*-* } } } */\n+\n+#include <cilk/cilk.h>\n+#include <vector>\n+#include <random>\n+\n+template <class T>\n+void do_not_optimize_away(T&& x) {\n+  asm volatile(\"\" : \"+r\"(x));\n+}\n+\n+const int N = 1'000'000;\n+\n+auto compute() {\n+  std::vector<double> v(N);\n+  auto rng = std::mt19937{std::random_device{}()};\n+  std::uniform_real_distribution<double> dist(0, 1);\n+  for (int i = 0; i < N; ++i) v[i] = std::log(std::sqrt(dist(rng)));\n+  return v;\n+}\n+\n+int main() {\n+  std::vector<double> v1, v2, v3;\n+  cilk_spawn [&] { v1 = compute(); }();\n+  cilk_spawn [&] { v2 = compute(); }();\n+  v3 = compute();\n+  do_not_optimize_away(v1.data());\n+  do_not_optimize_away(v2.data());\n+  do_not_optimize_away(v3.data());\n+  return 0;\n+}"}, {"sha": "ed26a3a1e1b41552d02ca296b65f92b20ee7ab87", "filename": "libcilkrts/ChangeLog", "status": "modified", "additions": 6, "deletions": 0, "changes": 6, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/a42062b176417a41d33e72710a80a3be707845ba/libcilkrts%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/a42062b176417a41d33e72710a80a3be707845ba/libcilkrts%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libcilkrts%2FChangeLog?ref=a42062b176417a41d33e72710a80a3be707845ba", "patch": "@@ -1,3 +1,9 @@\n+2015-11-09  Igor Zamyatin  <igor.zamyatin@intel.com>\n+\n+\tPR target/66326\n+\t* runtime/config/x86/os-unix-sysdep.c (sysdep_save_fp_ctrl_state):\n+\tUse fnstcw instead fnstsw.\n+\n 2015-05-13  Michael Haubenwallner  <michael.haubenwallner@ssi-schaefer.com>\n \n \t* Makefile.in: Regenerated with automake-1.11.6."}, {"sha": "cbc773432158363396680a951634859c4cb9bd02", "filename": "libcilkrts/runtime/config/x86/os-unix-sysdep.c", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/a42062b176417a41d33e72710a80a3be707845ba/libcilkrts%2Fruntime%2Fconfig%2Fx86%2Fos-unix-sysdep.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/a42062b176417a41d33e72710a80a3be707845ba/libcilkrts%2Fruntime%2Fconfig%2Fx86%2Fos-unix-sysdep.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libcilkrts%2Fruntime%2Fconfig%2Fx86%2Fos-unix-sysdep.c?ref=a42062b176417a41d33e72710a80a3be707845ba", "patch": "@@ -135,7 +135,7 @@ void sysdep_save_fp_ctrl_state(__cilkrts_stack_frame *sf)\n         {\n             __asm__ (\"stmxcsr %0\" : \"=m\" (sf->mxcsr));\n         }\n-        __asm__ (\"fnstsw %0\" : \"=m\" (sf->fpcsr));\n+\t__asm__ (\"fnstcw %0\" : \"=m\" (sf->fpcsr));\n     }\n #endif\n }"}]}