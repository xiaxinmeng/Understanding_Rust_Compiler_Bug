{"sha": "2b11374cb8d864dff3792e7c84188ba7e8f136e7", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6MmIxMTM3NGNiOGQ4NjRkZmYzNzkyZTdjODQxODhiYTdlOGYxMzZlNw==", "commit": {"author": {"name": "Kito Cheng", "email": "kito.cheng@sifive.com", "date": "2020-06-02T16:17:12Z"}, "committer": {"name": "Kito Cheng", "email": "kito.cheng@sifive.com", "date": "2020-06-02T02:25:42Z"}, "message": "testsuite: Disable colorization for ubsan test\n\n - Run gcc testsuite with qemu will print out ascii color code for\n   ubsan related testcase, however several testcase didn't consider\n   that, so disable colorization prevent such problem and simplify the\n   process when adding testcase in future.\n\n - Verified on native X86 and RISC-V qemu full system mode and user mode.\n\ngcc/testsuite/ChangeLog:\n\n\t* lib/ubsan-dg.exp (orig_ubsan_options_saved): New\n\t(orig_ubsan_options): Ditto.\n\t(ubsan_init): Store UBSAN_OPTIONS and set UBSAN_OPTIONS.\n\t(ubsan_finish): Restore UBSAN_OPTIONS.", "tree": {"sha": "7089f3c028281aa426d1a3ee3eefbe51f56343bc", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/7089f3c028281aa426d1a3ee3eefbe51f56343bc"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/2b11374cb8d864dff3792e7c84188ba7e8f136e7", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/2b11374cb8d864dff3792e7c84188ba7e8f136e7", "html_url": "https://github.com/Rust-GCC/gccrs/commit/2b11374cb8d864dff3792e7c84188ba7e8f136e7", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/2b11374cb8d864dff3792e7c84188ba7e8f136e7/comments", "author": {"login": "kito-cheng", "id": 2723185, "node_id": "MDQ6VXNlcjI3MjMxODU=", "avatar_url": "https://avatars.githubusercontent.com/u/2723185?v=4", "gravatar_id": "", "url": "https://api.github.com/users/kito-cheng", "html_url": "https://github.com/kito-cheng", "followers_url": "https://api.github.com/users/kito-cheng/followers", "following_url": "https://api.github.com/users/kito-cheng/following{/other_user}", "gists_url": "https://api.github.com/users/kito-cheng/gists{/gist_id}", "starred_url": "https://api.github.com/users/kito-cheng/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/kito-cheng/subscriptions", "organizations_url": "https://api.github.com/users/kito-cheng/orgs", "repos_url": "https://api.github.com/users/kito-cheng/repos", "events_url": "https://api.github.com/users/kito-cheng/events{/privacy}", "received_events_url": "https://api.github.com/users/kito-cheng/received_events", "type": "User", "site_admin": false}, "committer": {"login": "kito-cheng", "id": 2723185, "node_id": "MDQ6VXNlcjI3MjMxODU=", "avatar_url": "https://avatars.githubusercontent.com/u/2723185?v=4", "gravatar_id": "", "url": "https://api.github.com/users/kito-cheng", "html_url": "https://github.com/kito-cheng", "followers_url": "https://api.github.com/users/kito-cheng/followers", "following_url": "https://api.github.com/users/kito-cheng/following{/other_user}", "gists_url": "https://api.github.com/users/kito-cheng/gists{/gist_id}", "starred_url": "https://api.github.com/users/kito-cheng/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/kito-cheng/subscriptions", "organizations_url": "https://api.github.com/users/kito-cheng/orgs", "repos_url": "https://api.github.com/users/kito-cheng/repos", "events_url": "https://api.github.com/users/kito-cheng/events{/privacy}", "received_events_url": "https://api.github.com/users/kito-cheng/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "c2449995ca36ea955e3c6d4ee7f0d401b512c897", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/c2449995ca36ea955e3c6d4ee7f0d401b512c897", "html_url": "https://github.com/Rust-GCC/gccrs/commit/c2449995ca36ea955e3c6d4ee7f0d401b512c897"}], "stats": {"total": 22, "additions": 22, "deletions": 0}, "files": [{"sha": "f4ab29e2add026c04030b47a43fabe58d68d4b0c", "filename": "gcc/testsuite/lib/ubsan-dg.exp", "status": "modified", "additions": 22, "deletions": 0, "changes": 22, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/2b11374cb8d864dff3792e7c84188ba7e8f136e7/gcc%2Ftestsuite%2Flib%2Fubsan-dg.exp", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/2b11374cb8d864dff3792e7c84188ba7e8f136e7/gcc%2Ftestsuite%2Flib%2Fubsan-dg.exp", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Flib%2Fubsan-dg.exp?ref=2b11374cb8d864dff3792e7c84188ba7e8f136e7", "patch": "@@ -17,6 +17,9 @@\n # Return 1 if compilation with -fsanitize=undefined is error-free for trivial\n # code, 0 otherwise.\n \n+set orig_ubsan_options_saved 0\n+set orig_ubsan_options 0\n+\n proc check_effective_target_fsanitize_undefined {} {\n     return [check_runtime fsanitize_undefined {\n \tint main (void) { return 0; }\n@@ -74,6 +77,17 @@ proc ubsan_init { args } {\n     global TOOL_OPTIONS\n     global ubsan_saved_TEST_ALWAYS_FLAGS\n     global ubsan_saved_ALWAYS_CXXFLAGS\n+    global orig_ubsan_options_saved\n+    global orig_ubsan_options\n+\n+    if { $orig_ubsan_options_saved == 0 } {\n+\t# Save the original environment.\n+\tif [info exists env(UBSAN_OPTIONS)] {\n+\t    set orig_ubsan_options \"$env(UBSAN_OPTIONS)\"\n+\t    set orig_ubsan_options_saved 1\n+\t}\n+    }\n+    setenv UBSAN_OPTIONS color=never\n \n     set link_flags \"\"\n     if ![is_remote host] {\n@@ -109,6 +123,14 @@ proc ubsan_finish { args } {\n     global ubsan_saved_ALWAYS_CXXFLAGS\n     global ubsan_saved_library_path\n     global ld_library_path\n+    global orig_ubsan_options_saved\n+    global orig_ubsan_options\n+\n+    if { $orig_ubsan_options_saved } {\n+\tsetenv UBSAN_OPTIONS \"$orig_ubsan_options\"\n+    } elseif [info exists env(UBSAN_OPTIONS)] {\n+\tunsetenv UBSAN_OPTIONS\n+    }\n \n     if [info exists ubsan_saved_ALWAYS_CXXFLAGS ] {\n \tset ALWAYS_CXXFLAGS $ubsan_saved_ALWAYS_CXXFLAGS"}]}