{"sha": "8dc998fb42ad043e3a0bfc8f36af07613121b3d4", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6OGRjOTk4ZmI0MmFkMDQzZTNhMGJmYzhmMzZhZjA3NjEzMTIxYjNkNA==", "commit": {"author": {"name": "Harald Anlauf", "email": "anlauf@gmx.de", "date": "2016-11-20T18:43:16Z"}, "committer": {"name": "Steven G. Kargl", "email": "kargl@gcc.gnu.org", "date": "2016-11-20T18:43:16Z"}, "message": "re PR fortran/69741 (Bad error in forall with array loop counters)\n\n2016-11-20  Harald Anlauf  <anlauf@gmx.de>\n\n\tPR fortran/69741\n\t* resolve.c (gfc_resolve_forall): Check for nonscalar index variables.\n\n2016-11-20  Harald Anlauf  <anlauf@gmx.de>\n \n\tPR fortran/69741\n\t* gfortran.dg/forall_18.f90: New testcase.\n\nFrom-SVN: r242641", "tree": {"sha": "5bc304c30af68b1953553c75e35f14a2b27d2a14", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/5bc304c30af68b1953553c75e35f14a2b27d2a14"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/8dc998fb42ad043e3a0bfc8f36af07613121b3d4", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/8dc998fb42ad043e3a0bfc8f36af07613121b3d4", "html_url": "https://github.com/Rust-GCC/gccrs/commit/8dc998fb42ad043e3a0bfc8f36af07613121b3d4", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/8dc998fb42ad043e3a0bfc8f36af07613121b3d4/comments", "author": {"login": "harald-anlauf", "id": 90786862, "node_id": "MDQ6VXNlcjkwNzg2ODYy", "avatar_url": "https://avatars.githubusercontent.com/u/90786862?v=4", "gravatar_id": "", "url": "https://api.github.com/users/harald-anlauf", "html_url": "https://github.com/harald-anlauf", "followers_url": "https://api.github.com/users/harald-anlauf/followers", "following_url": "https://api.github.com/users/harald-anlauf/following{/other_user}", "gists_url": "https://api.github.com/users/harald-anlauf/gists{/gist_id}", "starred_url": "https://api.github.com/users/harald-anlauf/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/harald-anlauf/subscriptions", "organizations_url": "https://api.github.com/users/harald-anlauf/orgs", "repos_url": "https://api.github.com/users/harald-anlauf/repos", "events_url": "https://api.github.com/users/harald-anlauf/events{/privacy}", "received_events_url": "https://api.github.com/users/harald-anlauf/received_events", "type": "User", "site_admin": false}, "committer": null, "parents": [{"sha": "9692308d305f083785c41596328a35e9fddded8f", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/9692308d305f083785c41596328a35e9fddded8f", "html_url": "https://github.com/Rust-GCC/gccrs/commit/9692308d305f083785c41596328a35e9fddded8f"}], "stats": {"total": 49, "additions": 40, "deletions": 9}, "files": [{"sha": "109aca33261198a5b799597c8d69fe8e35200ea2", "filename": "gcc/fortran/ChangeLog", "status": "modified", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/8dc998fb42ad043e3a0bfc8f36af07613121b3d4/gcc%2Ffortran%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/8dc998fb42ad043e3a0bfc8f36af07613121b3d4/gcc%2Ffortran%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ffortran%2FChangeLog?ref=8dc998fb42ad043e3a0bfc8f36af07613121b3d4", "patch": "@@ -1,3 +1,8 @@\n+2016-11-20  Harald Anlauf  <anlauf@gmx.de>\n+\n+\tPR fortran/69741\n+\t* resolve.c (gfc_resolve_forall): Check for nonscalar index variables.\n+\n 2016-11-20  Andre Vehreschild  <vehre@gcc.gnu.org>\n \n \tPR fortran/78395"}, {"sha": "9e628f18a11a2a545e94d9b7f47cdc93daa00a76", "filename": "gcc/fortran/resolve.c", "status": "modified", "additions": 14, "deletions": 9, "changes": 23, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/8dc998fb42ad043e3a0bfc8f36af07613121b3d4/gcc%2Ffortran%2Fresolve.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/8dc998fb42ad043e3a0bfc8f36af07613121b3d4/gcc%2Ffortran%2Fresolve.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ffortran%2Fresolve.c?ref=8dc998fb42ad043e3a0bfc8f36af07613121b3d4", "patch": "@@ -9647,36 +9647,41 @@ gfc_resolve_forall (gfc_code *code, gfc_namespace *ns, int forall_save)\n   static gfc_expr **var_expr;\n   static int total_var = 0;\n   static int nvar = 0;\n-  int old_nvar, tmp;\n+  int i, old_nvar, tmp;\n   gfc_forall_iterator *fa;\n-  int i;\n \n   old_nvar = nvar;\n \n   /* Start to resolve a FORALL construct   */\n   if (forall_save == 0)\n     {\n-      /* Count the total number of FORALL index in the nested FORALL\n+      /* Count the total number of FORALL indices in the nested FORALL\n          construct in order to allocate the VAR_EXPR with proper size.  */\n       total_var = gfc_count_forall_iterators (code);\n \n       /* Allocate VAR_EXPR with NUMBER_OF_FORALL_INDEX elements.  */\n       var_expr = XCNEWVEC (gfc_expr *, total_var);\n     }\n \n-  /* The information about FORALL iterator, including FORALL index start, end\n-     and stride. The FORALL index can not appear in start, end or stride.  */\n+  /* The information about FORALL iterator, including FORALL indices start, end\n+     and stride.  An outer FORALL indice cannot appear in start, end or stride.  */\n   for (fa = code->ext.forall_iterator; fa; fa = fa->next)\n     {\n+      /* Fortran 20008: C738 (R753).  */\n+      if (fa->var->ref && fa->var->ref->type == REF_ARRAY)\n+\t{\n+\t  gfc_error (\"FORALL index-name at %L must be a scalar variable \"\n+\t\t     \"of type integer\", &fa->var->where);\n+\t  continue;\n+\t}\n+\n       /* Check if any outer FORALL index name is the same as the current\n \t one.  */\n       for (i = 0; i < nvar; i++)\n \t{\n \t  if (fa->var->symtree->n.sym == var_expr[i]->symtree->n.sym)\n-\t    {\n-\t      gfc_error (\"An outer FORALL construct already has an index \"\n-\t\t\t \"with this name %L\", &fa->var->where);\n-\t    }\n+\t    gfc_error (\"An outer FORALL construct already has an index \"\n+\t\t\t\"with this name %L\", &fa->var->where);\n \t}\n \n       /* Record the current FORALL index.  */"}, {"sha": "6a23d9069195d4909005c024546ffd21cac3c447", "filename": "gcc/testsuite/ChangeLog", "status": "modified", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/8dc998fb42ad043e3a0bfc8f36af07613121b3d4/gcc%2Ftestsuite%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/8dc998fb42ad043e3a0bfc8f36af07613121b3d4/gcc%2Ftestsuite%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2FChangeLog?ref=8dc998fb42ad043e3a0bfc8f36af07613121b3d4", "patch": "@@ -1,3 +1,8 @@\n+2016-11-20  Harald Anlauf  <anlauf@gmx.de>\n+ \n+\tPR fortran/69741\n+\t* gfortran.dg/forall_18.f90: New testcase.\n+\n 2016-11-20  Marc Glisse  <marc.glisse@inria.fr>\n \n \t* gcc.dg/tree-ssa/cmpexactdiv.c: New file."}, {"sha": "3cfe54763bcdde40025a9fab8c98c8af5a0b0786", "filename": "gcc/testsuite/gfortran.dg/forall_18.f90", "status": "added", "additions": 16, "deletions": 0, "changes": 16, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/8dc998fb42ad043e3a0bfc8f36af07613121b3d4/gcc%2Ftestsuite%2Fgfortran.dg%2Fforall_18.f90", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/8dc998fb42ad043e3a0bfc8f36af07613121b3d4/gcc%2Ftestsuite%2Fgfortran.dg%2Fforall_18.f90", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgfortran.dg%2Fforall_18.f90?ref=8dc998fb42ad043e3a0bfc8f36af07613121b3d4", "patch": "@@ -0,0 +1,16 @@\n+! { dg-do compile }\n+! PR fortran/69741 - improve error message for nonscalar FORALL index variables\n+!\n+subroutine check\n+  integer :: ii(2), i\n+  real :: a(3,2)\n+\n+  forall (ii(1)=1:3, i=1:2) ! { dg-error \"scalar variable of type integer\" }\n+     a(ii(1),i) = ii(1) * i\n+  end forall\n+\n+  forall (j=1:3, ii(2)=1:2) ! { dg-error \"scalar variable of type integer\" }\n+     a(j,ii(2)) = j * ii(2)\n+  end forall\n+\n+end subroutine check"}]}