{"sha": "0ca2e7f77c6e82b3b8973c307cb22485df92728f", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6MGNhMmU3Zjc3YzZlODJiM2I4OTczYzMwN2NiMjI0ODVkZjkyNzI4Zg==", "commit": {"author": {"name": "Prathamesh Kulkarni", "email": "prathamesh.kulkarni@linaro.org", "date": "2017-05-10T13:26:09Z"}, "committer": {"name": "Prathamesh Kulkarni", "email": "prathamesh3492@gcc.gnu.org", "date": "2017-05-10T13:26:09Z"}, "message": "re PR tree-optimization/77644 (missed optimization with sqrt in comparison)\n\n2017-05-10  Prathamesh Kulkarni  <prathamesh.kulkarni@linaro.org>\n\n\tPR tree-optimization/77644\n\t* match.pd (sqrt(x) cmp sqrt(y) -> x cmp y): New pattern.\n\ntestsuite/\n\t* gcc.dg/tree-ssa/pr77644.c: New test-case.\n\nFrom-SVN: r247835", "tree": {"sha": "57d7287a72f79f8a55ab82e7faf62b60f96db702", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/57d7287a72f79f8a55ab82e7faf62b60f96db702"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/0ca2e7f77c6e82b3b8973c307cb22485df92728f", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/0ca2e7f77c6e82b3b8973c307cb22485df92728f", "html_url": "https://github.com/Rust-GCC/gccrs/commit/0ca2e7f77c6e82b3b8973c307cb22485df92728f", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/0ca2e7f77c6e82b3b8973c307cb22485df92728f/comments", "author": null, "committer": null, "parents": [{"sha": "d5a2f455e69040cec63269e12307c4c4699850d5", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/d5a2f455e69040cec63269e12307c4c4699850d5", "html_url": "https://github.com/Rust-GCC/gccrs/commit/d5a2f455e69040cec63269e12307c4c4699850d5"}], "stats": {"total": 45, "additions": 44, "deletions": 1}, "files": [{"sha": "428efbab44c58ffda78fe13c16597ce0a560f94e", "filename": "gcc/ChangeLog", "status": "modified", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/0ca2e7f77c6e82b3b8973c307cb22485df92728f/gcc%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/0ca2e7f77c6e82b3b8973c307cb22485df92728f/gcc%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2FChangeLog?ref=0ca2e7f77c6e82b3b8973c307cb22485df92728f", "patch": "@@ -1,3 +1,8 @@\n+2017-05-10  Prathamesh Kulkarni  <prathamesh.kulkarni@linaro.org>\n+\n+\tPR tree-optimization/77644\n+\t* match.pd (sqrt(x) cmp sqrt(y) -> x cmp y): New pattern.\n+\n 2017-05-10  Nathan Sidwell  <nathan@acm.org>\n \n \t* dumpfile.h (TDI_lang_all): New."}, {"sha": "80a17ba3d23ac9c4a679085640a52b287e6f1a3a", "filename": "gcc/match.pd", "status": "modified", "additions": 6, "deletions": 1, "changes": 7, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/0ca2e7f77c6e82b3b8973c307cb22485df92728f/gcc%2Fmatch.pd", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/0ca2e7f77c6e82b3b8973c307cb22485df92728f/gcc%2Fmatch.pd", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fmatch.pd?ref=0ca2e7f77c6e82b3b8973c307cb22485df92728f", "patch": "@@ -2633,7 +2633,12 @@ DEFINE_INT_AND_FLOAT_ROUND_FN (RINT)\n \t (if (GENERIC)\n \t  (truth_andif\n \t   (ge @0 { build_real (TREE_TYPE (@0), dconst0); })\n-\t   (cmp @0 { build_real (TREE_TYPE (@0), c2); }))))))))))))\n+\t   (cmp @0 { build_real (TREE_TYPE (@0), c2); })))))))))\n+   /* Transform sqrt(x) cmp sqrt(y) -> x cmp y.  */\n+   (simplify\n+    (cmp (sq @0) (sq @1))\n+      (if (! HONOR_NANS (@0))\n+\t(cmp @0 @1))))))\n \n /* Fold A /[ex] B CMP C to A CMP B * C.  */\n (for cmp (eq ne)"}, {"sha": "e300900952b6c4d523c38a700e0acb84774efc5d", "filename": "gcc/testsuite/ChangeLog", "status": "modified", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/0ca2e7f77c6e82b3b8973c307cb22485df92728f/gcc%2Ftestsuite%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/0ca2e7f77c6e82b3b8973c307cb22485df92728f/gcc%2Ftestsuite%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2FChangeLog?ref=0ca2e7f77c6e82b3b8973c307cb22485df92728f", "patch": "@@ -1,3 +1,8 @@\n+2017-05-10  Prathamesh Kulkarni  <prathamesh.kulkarni@linaro.org>\n+\n+\tPR tree-optimization/77644\n+\t* gcc.dg/tree-ssa/pr77644.c: New test-case.\n+\n 2017-05-10  Alexandre Oliva <aoliva@redhat.com>\n \n \t* gcc.dg/guality/inline-params-2.c: New."}, {"sha": "c73bb73afdb941d197c0cdb4c851c918c56f40a8", "filename": "gcc/testsuite/gcc.dg/tree-ssa/pr77644.c", "status": "added", "additions": 28, "deletions": 0, "changes": 28, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/0ca2e7f77c6e82b3b8973c307cb22485df92728f/gcc%2Ftestsuite%2Fgcc.dg%2Ftree-ssa%2Fpr77644.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/0ca2e7f77c6e82b3b8973c307cb22485df92728f/gcc%2Ftestsuite%2Fgcc.dg%2Ftree-ssa%2Fpr77644.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgcc.dg%2Ftree-ssa%2Fpr77644.c?ref=0ca2e7f77c6e82b3b8973c307cb22485df92728f", "patch": "@@ -0,0 +1,28 @@\n+/* { dg-do compile } */\n+/* { dg-require-effective-target c99_runtime } */\n+/* { dg-options \"-O2 -fdump-tree-optimized -funsafe-math-optimizations -fno-math-errno -ffinite-math-only\" } */\n+\n+#define FOO(type, cmp, suffix, no)  \\\n+int f_##no(type x, type y) \\\n+{ \\\n+  type gen_##no(); \\\n+  type xs = __builtin_sqrt##suffix((gen_##no())); \\\n+  type xy = __builtin_sqrt##suffix((gen_##no())); \\\n+  return (xs cmp xy); \\\n+}\n+\n+#define GEN_FOO(type, suffix) \\\n+FOO(type, <, suffix, suffix##1) \\\n+FOO(type, <=, suffix, suffix##2) \\\n+FOO(type, >, suffix, suffix##3) \\\n+FOO(type, >=, suffix, suffix##4) \\\n+FOO(type, ==, suffix, suffix##5) \\\n+FOO(type, !=, suffix, suffix##6)\n+\n+GEN_FOO(float, f)\n+GEN_FOO(double, )\n+GEN_FOO(long double, l)\n+\n+/* { dg-final { scan-tree-dump-not \"__builtin_sqrtf\" \"optimized\" } } */\n+/* { dg-final { scan-tree-dump-not \"__builtin_sqrt\" \"optimized\" } } */\n+/* { dg-final { scan-tree-dump-not \"__builtin_sqrtl\" \"optimized\" } } */"}]}