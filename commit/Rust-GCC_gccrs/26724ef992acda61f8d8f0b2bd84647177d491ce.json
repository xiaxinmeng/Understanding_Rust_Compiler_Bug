{"sha": "26724ef992acda61f8d8f0b2bd84647177d491ce", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6MjY3MjRlZjk5MmFjZGE2MWY4ZDhmMGIyYmQ4NDY0NzE3N2Q0OTFjZQ==", "commit": {"author": {"name": "Igor Tsimbalist", "email": "igor.v.tsimbalist@intel.com", "date": "2017-11-17T22:44:59Z"}, "committer": {"name": "Igor Tsimbalist", "email": "itsimbal@gcc.gnu.org", "date": "2017-11-17T22:44:59Z"}, "message": "Enable building libgfortran with Intel CET\n\nlibgfortran/\n\t* acinclude.m4: Add enable.m4, cet.m4.\n\t* Makefile.in: Regenerate.\n\t* configure: Likewise.\n\t* configure.ac: Set CET_FLAGS. Update AM_FCFLAGS,\n\tAM_CFLAGS, CFLAGS.\n\nFrom-SVN: r254902", "tree": {"sha": "81c3c0e07b0d7c694a6105f3d9008080bf50085f", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/81c3c0e07b0d7c694a6105f3d9008080bf50085f"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/26724ef992acda61f8d8f0b2bd84647177d491ce", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/26724ef992acda61f8d8f0b2bd84647177d491ce", "html_url": "https://github.com/Rust-GCC/gccrs/commit/26724ef992acda61f8d8f0b2bd84647177d491ce", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/26724ef992acda61f8d8f0b2bd84647177d491ce/comments", "author": {"login": "itsimbal", "id": 29258612, "node_id": "MDQ6VXNlcjI5MjU4NjEy", "avatar_url": "https://avatars.githubusercontent.com/u/29258612?v=4", "gravatar_id": "", "url": "https://api.github.com/users/itsimbal", "html_url": "https://github.com/itsimbal", "followers_url": "https://api.github.com/users/itsimbal/followers", "following_url": "https://api.github.com/users/itsimbal/following{/other_user}", "gists_url": "https://api.github.com/users/itsimbal/gists{/gist_id}", "starred_url": "https://api.github.com/users/itsimbal/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/itsimbal/subscriptions", "organizations_url": "https://api.github.com/users/itsimbal/orgs", "repos_url": "https://api.github.com/users/itsimbal/repos", "events_url": "https://api.github.com/users/itsimbal/events{/privacy}", "received_events_url": "https://api.github.com/users/itsimbal/received_events", "type": "User", "site_admin": false}, "committer": null, "parents": [{"sha": "0495940618abcd98af709ba462c20c89bfd04fab", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/0495940618abcd98af709ba462c20c89bfd04fab", "html_url": "https://github.com/Rust-GCC/gccrs/commit/0495940618abcd98af709ba462c20c89bfd04fab"}], "stats": {"total": 100, "additions": 97, "deletions": 3}, "files": [{"sha": "a486eed8a2c139f03e09d131c9befc938b249987", "filename": "libgfortran/ChangeLog", "status": "modified", "additions": 8, "deletions": 0, "changes": 8, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/26724ef992acda61f8d8f0b2bd84647177d491ce/libgfortran%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/26724ef992acda61f8d8f0b2bd84647177d491ce/libgfortran%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libgfortran%2FChangeLog?ref=26724ef992acda61f8d8f0b2bd84647177d491ce", "patch": "@@ -1,3 +1,11 @@\n+2017-11-17  Igor Tsimbalist  <igor.v.tsimbalist@intel.com>\n+\n+\t* acinclude.m4: Add enable.m4, cet.m4.\n+\t* Makefile.in: Regenerate.\n+\t* configure: Likewise.\n+\t* configure.ac: Set CET_FLAGS. Update AM_FCFLAGS,\n+\tAM_CFLAGS, CFLAGS.\n+\n 2017-10-27  Jerry DeLisle  <jvdelisle@gcc.gnu.org>\n \t    Rimvydas (RJ)\n "}, {"sha": "e97d1bc425581ba23ecd8ad8e730cde0e3c93431", "filename": "libgfortran/Makefile.in", "status": "modified", "additions": 3, "deletions": 1, "changes": 4, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/26724ef992acda61f8d8f0b2bd84647177d491ce/libgfortran%2FMakefile.in", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/26724ef992acda61f8d8f0b2bd84647177d491ce/libgfortran%2FMakefile.in", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libgfortran%2FMakefile.in?ref=26724ef992acda61f8d8f0b2bd84647177d491ce", "patch": "@@ -139,7 +139,9 @@ am__aclocal_m4_deps = $(top_srcdir)/../config/depstand.m4 \\\n \t$(top_srcdir)/../config/no-executables.m4 \\\n \t$(top_srcdir)/../config/math.m4 \\\n \t$(top_srcdir)/../config/ax_check_define.m4 \\\n-\t$(top_srcdir)/../libtool.m4 $(top_srcdir)/configure.ac\n+\t$(top_srcdir)/../config/enable.m4 \\\n+\t$(top_srcdir)/../config/cet.m4 $(top_srcdir)/../libtool.m4 \\\n+\t$(top_srcdir)/configure.ac\n am__configure_deps = $(am__aclocal_m4_deps) $(CONFIGURE_DEPENDENCIES) \\\n \t$(ACLOCAL_M4)\n am__CONFIG_DISTCLEAN_FILES = config.status config.cache config.log \\"}, {"sha": "dd5429ac0d28fb8fd64316dea56a4772dda113e3", "filename": "libgfortran/acinclude.m4", "status": "modified", "additions": 2, "deletions": 0, "changes": 2, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/26724ef992acda61f8d8f0b2bd84647177d491ce/libgfortran%2Facinclude.m4", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/26724ef992acda61f8d8f0b2bd84647177d491ce/libgfortran%2Facinclude.m4", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libgfortran%2Facinclude.m4?ref=26724ef992acda61f8d8f0b2bd84647177d491ce", "patch": "@@ -2,6 +2,8 @@ m4_include(../config/acx.m4)\n m4_include(../config/no-executables.m4)\n m4_include(../config/math.m4)\n m4_include(../config/ax_check_define.m4)\n+m4_include(../config/enable.m4)\n+m4_include(../config/cet.m4)\n \n dnl Check that we have a working GNU Fortran compiler\n AC_DEFUN([LIBGFOR_WORKING_GFORTRAN], ["}, {"sha": "60e18a7b3e808b6bdd9a399c135c45be5c12aacb", "filename": "libgfortran/configure", "status": "modified", "additions": 77, "deletions": 2, "changes": 79, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/26724ef992acda61f8d8f0b2bd84647177d491ce/libgfortran%2Fconfigure", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/26724ef992acda61f8d8f0b2bd84647177d491ce/libgfortran%2Fconfigure", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libgfortran%2Fconfigure?ref=26724ef992acda61f8d8f0b2bd84647177d491ce", "patch": "@@ -773,6 +773,7 @@ enable_intermodule\n enable_maintainer_mode\n enable_multilib\n enable_dependency_tracking\n+enable_cet\n enable_symvers\n with_gnu_ld\n enable_shared\n@@ -1424,6 +1425,8 @@ Optional Features:\n   --enable-multilib       build many library versions (default)\n   --disable-dependency-tracking  speeds up one-time build\n   --enable-dependency-tracking   do not reject slow dependency extractors\n+  --enable-cet            enable Intel CET in target libraries\n+                          [default=default]\n   --disable-symvers       disable symbol versioning for libgfortran\n   --enable-shared[=PKGS]  build shared libraries [default=yes]\n   --enable-static[=PKGS]  build static libraries [default=yes]\n@@ -5787,6 +5790,78 @@ if test \"x$GCC\" = \"xyes\"; then\n   CFLAGS=\"-std=gnu11 $CFLAGS\"\n fi\n \n+# Add CET specific flags if CET is enabled\n+ # Check whether --enable-cet was given.\n+if test \"${enable_cet+set}\" = set; then :\n+  enableval=$enable_cet;\n+      case \"$enableval\" in\n+       yes|no|default) ;;\n+       *) as_fn_error \"Unknown argument to enable/disable cet\" \"$LINENO\" 5 ;;\n+                          esac\n+\n+else\n+  enable_cet=default\n+fi\n+\n+\n+case \"$host\" in\n+  i[34567]86-*-linux* | x86_64-*-linux*)\n+    case \"$enable_cet\" in\n+      default)\n+\t# Check if assembler supports CET.\n+\tcat confdefs.h - <<_ACEOF >conftest.$ac_ext\n+/* end confdefs.h.  */\n+\n+int\n+main ()\n+{\n+asm (\"setssbsy\");\n+  ;\n+  return 0;\n+}\n+_ACEOF\n+if ac_fn_c_try_compile \"$LINENO\"; then :\n+  enable_cet=yes\n+else\n+  enable_cet=no\n+fi\n+rm -f core conftest.err conftest.$ac_objext conftest.$ac_ext\n+\t;;\n+      yes)\n+\t# Check if assembler supports CET.\n+\tcat confdefs.h - <<_ACEOF >conftest.$ac_ext\n+/* end confdefs.h.  */\n+\n+int\n+main ()\n+{\n+asm (\"setssbsy\");\n+  ;\n+  return 0;\n+}\n+_ACEOF\n+if ac_fn_c_try_compile \"$LINENO\"; then :\n+\n+else\n+  as_fn_error \"assembler with CET support is required for --enable-cet\" \"$LINENO\" 5\n+fi\n+rm -f core conftest.err conftest.$ac_objext conftest.$ac_ext\n+\t;;\n+    esac\n+    ;;\n+  *)\n+    enable_cet=no\n+    ;;\n+esac\n+if test x$enable_cet = xyes; then\n+  CET_FLAGS=\"-fcf-protection -mcet\"\n+fi\n+\n+AM_FCFLAGS=\"$AM_FCFLAGS $CET_FLAGS\"\n+AM_CFLAGS=\"$AM_CFLAGS $CET_FLAGS\"\n+CFLAGS=\"$CFLAGS $CET_FLAGS\"\n+\n+\n \n \n \n@@ -12423,7 +12498,7 @@ else\n   lt_dlunknown=0; lt_dlno_uscore=1; lt_dlneed_uscore=2\n   lt_status=$lt_dlunknown\n   cat > conftest.$ac_ext <<_LT_EOF\n-#line 12426 \"configure\"\n+#line 12501 \"configure\"\n #include \"confdefs.h\"\n \n #if HAVE_DLFCN_H\n@@ -12529,7 +12604,7 @@ else\n   lt_dlunknown=0; lt_dlno_uscore=1; lt_dlneed_uscore=2\n   lt_status=$lt_dlunknown\n   cat > conftest.$ac_ext <<_LT_EOF\n-#line 12532 \"configure\"\n+#line 12607 \"configure\"\n #include \"confdefs.h\"\n \n #if HAVE_DLFCN_H"}, {"sha": "bf6d3634dda3acbc1d03d8c7825e60289967b116", "filename": "libgfortran/configure.ac", "status": "modified", "additions": 7, "deletions": 0, "changes": 7, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/26724ef992acda61f8d8f0b2bd84647177d491ce/libgfortran%2Fconfigure.ac", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/26724ef992acda61f8d8f0b2bd84647177d491ce/libgfortran%2Fconfigure.ac", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libgfortran%2Fconfigure.ac?ref=26724ef992acda61f8d8f0b2bd84647177d491ce", "patch": "@@ -147,6 +147,13 @@ if test \"x$GCC\" = \"xyes\"; then\n   ## that we'll encounter when compiling our own source files.\n   CFLAGS=\"-std=gnu11 $CFLAGS\"\n fi\n+\n+# Add CET specific flags if CET is enabled\n+GCC_CET_FLAGS(CET_FLAGS)\n+AM_FCFLAGS=\"$AM_FCFLAGS $CET_FLAGS\"\n+AM_CFLAGS=\"$AM_CFLAGS $CET_FLAGS\"\n+CFLAGS=\"$CFLAGS $CET_FLAGS\"\n+\n AC_SUBST(AM_FCFLAGS)\n AC_SUBST(AM_CFLAGS)\n AC_SUBST(CFLAGS)"}]}