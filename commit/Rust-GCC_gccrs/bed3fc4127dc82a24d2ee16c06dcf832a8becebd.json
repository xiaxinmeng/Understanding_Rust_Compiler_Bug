{"sha": "bed3fc4127dc82a24d2ee16c06dcf832a8becebd", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6YmVkM2ZjNDEyN2RjODJhMjRkMmVlMTZjMDZkY2Y4MzJhOGJlY2ViZA==", "commit": {"author": {"name": "Kaz Kojima", "email": "kkojima@gcc.gnu.org", "date": "2012-06-14T22:58:05Z"}, "committer": {"name": "Kaz Kojima", "email": "kkojima@gcc.gnu.org", "date": "2012-06-14T22:58:05Z"}, "message": "Update sysdep/sh/locks.h with atomic builtins\n\nUpdate sysdep/sh/locks.h with atomic builtins\n\t* sysdep/sh/locks.h (__cas_lock): Remove.\n\t(__cas_start_atomic, __cas_end_atomic): Likewise.\n\t(compare_and_swap): Call __sync_bool_compare_and_swap.\n\nFrom-SVN: r188640", "tree": {"sha": "4be410e6e941f2304a98d993d14213775717d8ee", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/4be410e6e941f2304a98d993d14213775717d8ee"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/bed3fc4127dc82a24d2ee16c06dcf832a8becebd", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/bed3fc4127dc82a24d2ee16c06dcf832a8becebd", "html_url": "https://github.com/Rust-GCC/gccrs/commit/bed3fc4127dc82a24d2ee16c06dcf832a8becebd", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/bed3fc4127dc82a24d2ee16c06dcf832a8becebd/comments", "author": null, "committer": null, "parents": [{"sha": "2bcf3c5c3a8100e944ffe657dd6d1006c8188ccd", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/2bcf3c5c3a8100e944ffe657dd6d1006c8188ccd", "html_url": "https://github.com/Rust-GCC/gccrs/commit/2bcf3c5c3a8100e944ffe657dd6d1006c8188ccd"}], "stats": {"total": 42, "additions": 7, "deletions": 35}, "files": [{"sha": "9f7d38fa2109dbb7f4108ad680901811c355616a", "filename": "libjava/ChangeLog", "status": "modified", "additions": 6, "deletions": 0, "changes": 6, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/bed3fc4127dc82a24d2ee16c06dcf832a8becebd/libjava%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/bed3fc4127dc82a24d2ee16c06dcf832a8becebd/libjava%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libjava%2FChangeLog?ref=bed3fc4127dc82a24d2ee16c06dcf832a8becebd", "patch": "@@ -1,3 +1,9 @@\n+2012-06-14  Kaz Kojima  <kkojima@gcc.gnu.org>\n+\n+\t* sysdep/sh/locks.h (__cas_lock): Remove.\n+\t(__cas_start_atomic, __cas_end_atomic): Likewise.\n+\t(compare_and_swap): Call __sync_bool_compare_and_swap.\n+\n 2012-05-21  Benjamin Kosnik  <bkoz@redhat.com>\n \n \tPR libstdc++/52700"}, {"sha": "727c3aa879ccd4f83389346ec4e6ea005d74ce18", "filename": "libjava/sysdep/sh/locks.h", "status": "modified", "additions": 1, "deletions": 35, "changes": 36, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/bed3fc4127dc82a24d2ee16c06dcf832a8becebd/libjava%2Fsysdep%2Fsh%2Flocks.h", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/bed3fc4127dc82a24d2ee16c06dcf832a8becebd/libjava%2Fsysdep%2Fsh%2Flocks.h", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libjava%2Fsysdep%2Fsh%2Flocks.h?ref=bed3fc4127dc82a24d2ee16c06dcf832a8becebd", "patch": "@@ -14,45 +14,11 @@ details.  */\n typedef size_t obj_addr_t;\t/* Integer type big enough for object\t*/\n \t\t\t\t/* address.\t\t\t\t*/\n \n-static unsigned char __cas_lock = 0;\n-\n-inline static void\n-__cas_start_atomic (void)\n-{\n-  unsigned int val;\n-\n-  do\n-    __asm__ __volatile__ (\"tas.b @%1; movt %0\"\n-\t\t\t  : \"=r\" (val)\n-\t\t\t  : \"r\" (&__cas_lock)\n-\t\t\t  : \"memory\");\n-  while (val == 0);\n-}\n-\n-inline static void\n-__cas_end_atomic (void)\n-{\n-  __asm__ __volatile__ (\" \" : : : \"memory\");\n-  __cas_lock = 0;\n-}\n-\n inline static bool\n compare_and_swap (volatile obj_addr_t *addr, obj_addr_t old,\n \t\t  obj_addr_t new_val)\n {\n-  bool ret;\n-\n-  __cas_start_atomic ();\n-  if (*addr != old)\n-    ret = false;\n-  else\n-    {\n-      *addr = new_val;\n-      ret = true;\n-    }\n-  __cas_end_atomic ();\n-\n-  return ret;\n+  return __sync_bool_compare_and_swap (addr, old, new_val);\n }\n \n inline static void"}]}