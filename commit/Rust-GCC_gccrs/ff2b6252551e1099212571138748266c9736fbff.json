{"sha": "ff2b6252551e1099212571138748266c9736fbff", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6ZmYyYjYyNTI1NTFlMTA5OTIxMjU3MTEzODc0ODI2NmM5NzM2ZmJmZg==", "commit": {"author": {"name": "Timothy Moore", "email": "moore@gnu.org", "date": "1992-10-26T21:22:51Z"}, "committer": {"name": "Timothy Moore", "email": "moore@gnu.org", "date": "1992-10-26T21:22:51Z"}, "message": "(EXPORT_PARMS, ASM_DECLARE_FUNCTION): Blow away usage of EXPORT_PARMS.\n\n (EXPORT_PARMS, ASM_DECLARE_FUNCTION): Blow away usage of\n        EXPORT_PARMS.  BUGGY_GAS isn't a problem any more.\n        (TEXT_SPACE_P, FUNCTION_NAME_P): New macros.\n        (ENCODE_SECTION_INFO): Use TEXT_SPACE_P.\n        (STRIP_NAME_ENCODING): Strip a '*' which might preceed a '@'.\n        (ASM_OUTPUT_EXTERNAL): Give only function labels a CODE type.\n        (ASM_OUTPUT_LABELREF): Use FUNCTION_NAME_P.\n\nFrom-SVN: r2617", "tree": {"sha": "c610529ffe7e4d4096dd44e9600caaefa3200759", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/c610529ffe7e4d4096dd44e9600caaefa3200759"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/ff2b6252551e1099212571138748266c9736fbff", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/ff2b6252551e1099212571138748266c9736fbff", "html_url": "https://github.com/Rust-GCC/gccrs/commit/ff2b6252551e1099212571138748266c9736fbff", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/ff2b6252551e1099212571138748266c9736fbff/comments", "author": null, "committer": null, "parents": [{"sha": "6181e18d54333cdcd2bc2a7a20227b63aeb8fc89", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/6181e18d54333cdcd2bc2a7a20227b63aeb8fc89", "html_url": "https://github.com/Rust-GCC/gccrs/commit/6181e18d54333cdcd2bc2a7a20227b63aeb8fc89"}], "stats": {"total": 63, "additions": 33, "deletions": 30}, "files": [{"sha": "d6248efe9e263e06b0359676493dcfa812ed4499", "filename": "gcc/config/pa/pa.h", "status": "modified", "additions": 33, "deletions": 30, "changes": 63, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/ff2b6252551e1099212571138748266c9736fbff/gcc%2Fconfig%2Fpa%2Fpa.h", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/ff2b6252551e1099212571138748266c9736fbff/gcc%2Fconfig%2Fpa%2Fpa.h", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fconfig%2Fpa%2Fpa.h?ref=ff2b6252551e1099212571138748266c9736fbff", "patch": "@@ -818,12 +818,6 @@ extern enum cmp_type hppa_branch_type;\n        fprintf (FILE, \",ARGW%d=FR\", (ARG1));} while (0)\n #endif\n \n-#ifdef BUGGY_GAS\n-#define EXPORT_PARMS(FILE) fputs (\",PRIV_LEV=3\", FILE)\n-#else\n-#define EXPORT_PARMS(FILE) fputs (\",ENTRY,PRIV_LEV=3\", FILE)\n-#endif\n-\n #define ASM_DECLARE_FUNCTION_NAME(FILE, NAME, DECL) \\\n     do { tree fntype = DECL_RESULT (DECL);\t \t\t\t\\\n \t tree tree_type = TREE_TYPE (DECL);\t\t\t\t\\\n@@ -832,7 +826,7 @@ extern enum cmp_type hppa_branch_type;\n \t if (TREE_PUBLIC (DECL))\t\t\t\t\t\\\n \t   { extern int current_function_varargs;\t\t\t\\\n \t     fputs (\"\\t.EXPORT \", FILE); assemble_name (FILE, NAME);\t\\\n-\t     EXPORT_PARMS (FILE);\t\t\t\t\t\\\n+\t     fputs (\",ENTRY,PRIV_LEV=3\", FILE);\t\t\t\t\\\n \t     for (parm = DECL_ARGUMENTS (DECL), i = 0; parm && i < 4;\t\\\n \t\t  parm = TREE_CHAIN (parm))\t\t\t\t\\\n \t       {\t\t\t\t\t\t\t\\\n@@ -1270,33 +1264,42 @@ extern union tree_node *current_function_decl;\n    information).\n \n    On the HP-PA we use this to indicate if a symbol is in text or\n-   data space.  */\n+   data space.  Also, function labels need special treatment. */\n+\n+#define TEXT_SPACE_P(DECL)\\\n+  (TREE_CODE (DECL) == FUNCTION_DECL\t\t\t\t\t\\\n+   || (TREE_CODE (DECL) == VAR_DECL\t\t\t\t\t\\\n+       && TREE_READONLY (DECL) && ! TREE_SIDE_EFFECTS (DECL)\t\t\\\n+       && !flag_pic)\t\t\t\t\t\t\t\\\n+   || (*tree_code_type[(int) TREE_CODE (DECL)] == 'c'\t\t\t\\\n+       && !(TREE_CODE (DECL) == STRING_CST && flag_writable_strings)))\n+\n+#define FUNCTION_NAME_P(NAME) \\\n+(*(NAME) == '@' || (*(NAME) == '*' && *((NAME) + 1) == '@'))\n \n #define ENCODE_SECTION_INFO(DECL)\\\n-do\t\t\t\t\t\t\t\t\t\\\n-  {\t\t\t\t\t\t\t\t\t\\\n-    if (TREE_CODE (DECL) == FUNCTION_DECL)\t\t\t\t\\\n-      {\t\t\t\t\t\t\t\t\t\\\n-\thppa_encode_label (XEXP (DECL_RTL (DECL), 0));\t\t\t\\\n-\tSYMBOL_REF_FLAG (XEXP (DECL_RTL (DECL), 0)) = 1;\t\t\\\n-      }\t\t\t\t\t\t\t\t\t\\\n-    else\t\t\t\t\t\t\t\t\\\n-      {\t\t\t\t\t\t\t\t\t\\\n-\trtx rtl = (TREE_CODE_CLASS (TREE_CODE (DECL)) != 'd'\t\t\\\n-\t\t   ? TREE_CST_RTL (DECL) : DECL_RTL (DECL));\t\t\\\n-\tif (RTX_UNCHANGING_P (rtl) && !MEM_VOLATILE_P (rtl)\t\t\\\n-\t    && !flag_pic)\t\t\t\t\t\t\\\n-\t  SYMBOL_REF_FLAG (XEXP (rtl, 0)) = 1;\t\t\t\t\\\n-      }\t\t\t\t\t\t\t\t\t\\\n-  }\t\t\t\t\t\t\t\t\t\\\n+do\t\t\t\t\t\t\t\\\n+  { if (TEXT_SPACE_P (DECL))\t\t\t\t\\\n+      {\trtx _rtl;\t\t\t\t\t\\\n+\tif (TREE_CODE (DECL) == FUNCTION_DECL\t\t\\\n+\t    || TREE_CODE (DECL) == VAR_DECL)\t\t\\\n+\t  _rtl = DECL_RTL (DECL);\t\t\t\\\n+\telse\t\t\t\t\t\t\\\n+\t  _rtl = TREE_CST_RTL (DECL);\t\t\t\\\n+\tSYMBOL_REF_FLAG (XEXP (_rtl, 0)) = 1;\t\t\\\n+\tif (TREE_CODE (DECL) == FUNCTION_DECL)\t\t\\\n+\t  hppa_encode_label (XEXP (DECL_RTL (DECL), 0));\\\n+      }\t\t\t\t\t\t\t\\\n+  }\t\t\t\t\t\t\t\\\n while (0)\n   \n /* Store the user-specified part of SYMBOL_NAME in VAR.\n    This is sort of inverse to ENCODE_SECTION_INFO.  */\n \n #define STRIP_NAME_ENCODING(VAR,SYMBOL_NAME)\t\\\n-  (VAR) = ((SYMBOL_NAME)\t\t\t\\\n-\t   + ((SYMBOL_NAME)[0] == '*' || (SYMBOL_NAME)[0] == '@'))\n+  (VAR) = ((SYMBOL_NAME)  + ((SYMBOL_NAME)[0] == '*' ?\t\\\n+\t\t\t     1 + (SYMBOL_NAME)[1] == '@'\\\n+\t\t\t     : (SYMBOL_NAME)[0] == '@'))\n \n /* Specify the machine mode that this machine uses\n    for the index in the tablejump instruction.  */\n@@ -1520,10 +1523,10 @@ bss_section ()\t\t\t\t\t\t\t\t\\\n #define ASM_OUTPUT_EXTERNAL(FILE, DECL, NAME)\t\\\n   do { fputs (\"\\t.IMPORT \", FILE);\t\t\t\t\\\n \t assemble_name (FILE, NAME);\t\t\t\t\\\n-       if (TREE_CODE (DECL) == VAR_DECL && ! TREE_READONLY (DECL))     \t\\\n-\t fputs (\",DATA\\n\", FILE);\t\t\t\t\\\n-       else\t\t\t\t\t\t\t\\\n+       if (FUNCTION_NAME_P (NAME))     \t\t\t\t\\\n \t fputs (\",CODE\\n\", FILE);\t\t\t\t\\\n+       else\t\t\t\t\t\t\t\\\n+\t fputs (\",DATA\\n\", FILE);\t\t\t\t\\\n      } while (0)\n \n /* hpux ld doesn't output the object file name, or anything useful at\n@@ -1557,7 +1560,7 @@ bss_section ()\t\t\t\t\t\t\t\t\\\n    `assemble_name' uses this.  */\n \n #define ASM_OUTPUT_LABELREF(FILE,NAME)\t\\\n-  fprintf ((FILE), \"%s\", (NAME) + ((NAME)[0] == '@' ? 1 : 0))\n+  fprintf ((FILE), \"%s\", (NAME) + (FUNCTION_NAME_P (NAME) ? 1 : 0))\n \n /* This is how to output an internal numbered label where\n    PREFIX is the class of label and NUM is the number within the class.  */"}]}