{"sha": "9beeb4ee4c1bf42a2d3a66d75d250cf20c9c1f9f", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6OWJlZWI0ZWU0YzFiZjQyYTJkM2E2NmQ3NWQyNTBjZjIwYzljMWY5Zg==", "commit": {"author": {"name": "Zdenek Dvorak", "email": "dvorakz@suse.cz", "date": "2004-11-14T18:04:25Z"}, "committer": {"name": "Zdenek Dvorak", "email": "rakdver@gcc.gnu.org", "date": "2004-11-14T18:04:25Z"}, "message": "re PR tree-optimization/18431 (Code for arrays and pointers are not the same)\n\n\tPR tree-optimization/18431\n\t* tree-flow.h (stmt_references_memory_p): Declare.\n\t* tree-ssa-loop-im.c (stmt_cost): Use stmt_references_memory_p.\n\t* tree-ssa.c (stmt_references_memory_p): New function.\n\nFrom-SVN: r90624", "tree": {"sha": "4342616d30f20c349279f331a6f1ad5af6c0e53b", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/4342616d30f20c349279f331a6f1ad5af6c0e53b"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/9beeb4ee4c1bf42a2d3a66d75d250cf20c9c1f9f", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/9beeb4ee4c1bf42a2d3a66d75d250cf20c9c1f9f", "html_url": "https://github.com/Rust-GCC/gccrs/commit/9beeb4ee4c1bf42a2d3a66d75d250cf20c9c1f9f", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/9beeb4ee4c1bf42a2d3a66d75d250cf20c9c1f9f/comments", "author": null, "committer": null, "parents": [{"sha": "3021a627c59f88450a6c785d5b0d61f390762445", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/3021a627c59f88450a6c785d5b0d61f390762445", "html_url": "https://github.com/Rust-GCC/gccrs/commit/3021a627c59f88450a6c785d5b0d61f390762445"}], "stats": {"total": 29, "additions": 26, "deletions": 3}, "files": [{"sha": "285c1beff07472fc71e42f35828ae679c84c3946", "filename": "gcc/ChangeLog", "status": "modified", "additions": 7, "deletions": 0, "changes": 7, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/9beeb4ee4c1bf42a2d3a66d75d250cf20c9c1f9f/gcc%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/9beeb4ee4c1bf42a2d3a66d75d250cf20c9c1f9f/gcc%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2FChangeLog?ref=9beeb4ee4c1bf42a2d3a66d75d250cf20c9c1f9f", "patch": "@@ -1,3 +1,10 @@\n+2004-11-14  Zdenek Dvorak  <dvorakz@suse.cz>\n+\n+\tPR tree-optimization/18431\n+\t* tree-flow.h (stmt_references_memory_p): Declare.\n+\t* tree-ssa-loop-im.c (stmt_cost): Use stmt_references_memory_p.\n+\t* tree-ssa.c (stmt_references_memory_p): New function.\n+\n 2004-11-14  Andreas Schwab  <schwab@suse.de>\n \n \t* Makefile.in (lambda-code.o, tree-loop-linear.o): Depend on"}, {"sha": "08a73e4143e3824d7699741e09f2e46a5e32dec5", "filename": "gcc/tree-flow.h", "status": "modified", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/9beeb4ee4c1bf42a2d3a66d75d250cf20c9c1f9f/gcc%2Ftree-flow.h", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/9beeb4ee4c1bf42a2d3a66d75d250cf20c9c1f9f/gcc%2Ftree-flow.h", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftree-flow.h?ref=9beeb4ee4c1bf42a2d3a66d75d250cf20c9c1f9f", "patch": "@@ -583,6 +583,7 @@ extern void delete_tree_ssa (void);\n extern void register_new_def (tree, varray_type *);\n extern void walk_use_def_chains (tree, walk_use_def_chains_fn, void *, bool);\n extern void kill_redundant_phi_nodes (void);\n+extern bool stmt_references_memory_p (tree);\n \n /* In tree-into-ssa.c  */\n extern void rewrite_into_ssa (bool);"}, {"sha": "3c755537b5091b2592f5df35bff5a19ba5828b9a", "filename": "gcc/tree-ssa-loop-im.c", "status": "modified", "additions": 1, "deletions": 3, "changes": 4, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/9beeb4ee4c1bf42a2d3a66d75d250cf20c9c1f9f/gcc%2Ftree-ssa-loop-im.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/9beeb4ee4c1bf42a2d3a66d75d250cf20c9c1f9f/gcc%2Ftree-ssa-loop-im.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftree-ssa-loop-im.c?ref=9beeb4ee4c1bf42a2d3a66d75d250cf20c9c1f9f", "patch": "@@ -365,9 +365,7 @@ stmt_cost (tree stmt)\n   rhs = TREE_OPERAND (stmt, 1);\n \n   /* Hoisting memory references out should almost surely be a win.  */\n-  if (!is_gimple_variable (lhs))\n-    cost += 20;\n-  if (is_gimple_addressable (rhs) && !is_gimple_variable (rhs))\n+  if (stmt_references_memory_p (stmt))\n     cost += 20;\n \n   switch (TREE_CODE (rhs))"}, {"sha": "4cb8cc2bc8156cbf96e4157c5c6e1c6b88b03ea2", "filename": "gcc/tree-ssa.c", "status": "modified", "additions": 17, "deletions": 0, "changes": 17, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/9beeb4ee4c1bf42a2d3a66d75d250cf20c9c1f9f/gcc%2Ftree-ssa.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/9beeb4ee4c1bf42a2d3a66d75d250cf20c9c1f9f/gcc%2Ftree-ssa.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftree-ssa.c?ref=9beeb4ee4c1bf42a2d3a66d75d250cf20c9c1f9f", "patch": "@@ -902,6 +902,23 @@ tree_ssa_useless_type_conversion (tree expr)\n   return false;\n }\n \n+/* Returns true if statement STMT may read memory.  */\n+\n+bool\n+stmt_references_memory_p (tree stmt)\n+{\n+  stmt_ann_t ann;\n+\n+  get_stmt_operands (stmt);\n+  ann = stmt_ann (stmt);\n+\n+  if (ann->has_volatile_ops)\n+    return true;\n+\n+  return (NUM_VUSES (VUSE_OPS (ann)) > 0\n+\t  || NUM_V_MAY_DEFS (V_MAY_DEF_OPS (ann)) > 0\n+\t  || NUM_V_MUST_DEFS (V_MUST_DEF_OPS (ann)) > 0);\n+}\n \n /* Internal helper for walk_use_def_chains.  VAR, FN and DATA are as\n    described in walk_use_def_chains."}]}