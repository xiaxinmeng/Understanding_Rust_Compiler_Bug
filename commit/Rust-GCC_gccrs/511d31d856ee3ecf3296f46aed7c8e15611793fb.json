{"sha": "511d31d856ee3ecf3296f46aed7c8e15611793fb", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6NTExZDMxZDg1NmVlM2VjZjMyOTZmNDZhZWQ3YzhlMTU2MTE3OTNmYg==", "commit": {"author": {"name": "Andreas Schwab", "email": "schwab@linux-m68k.org", "date": "2012-11-05T21:11:04Z"}, "committer": {"name": "Andreas Schwab", "email": "schwab@gcc.gnu.org", "date": "2012-11-05T21:11:04Z"}, "message": "final.c (final_scan_insn): Handle all comparison codes in non-jump and cmove insn.\n\n* gcc/final.c (final_scan_insn) [HAVE_cc0]: Handle all comparison\ncodes in non-jump and cmove insn.\n\n* gcc/testsuite/gcc.dg/torture/fp-compare.c: New testcase.\n\nFrom-SVN: r193187", "tree": {"sha": "e83690f770534b0780f3bf05985da435f3861cd5", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/e83690f770534b0780f3bf05985da435f3861cd5"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/511d31d856ee3ecf3296f46aed7c8e15611793fb", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/511d31d856ee3ecf3296f46aed7c8e15611793fb", "html_url": "https://github.com/Rust-GCC/gccrs/commit/511d31d856ee3ecf3296f46aed7c8e15611793fb", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/511d31d856ee3ecf3296f46aed7c8e15611793fb/comments", "author": {"login": "andreas-schwab", "id": 2175493, "node_id": "MDQ6VXNlcjIxNzU0OTM=", "avatar_url": "https://avatars.githubusercontent.com/u/2175493?v=4", "gravatar_id": "", "url": "https://api.github.com/users/andreas-schwab", "html_url": "https://github.com/andreas-schwab", "followers_url": "https://api.github.com/users/andreas-schwab/followers", "following_url": "https://api.github.com/users/andreas-schwab/following{/other_user}", "gists_url": "https://api.github.com/users/andreas-schwab/gists{/gist_id}", "starred_url": "https://api.github.com/users/andreas-schwab/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/andreas-schwab/subscriptions", "organizations_url": "https://api.github.com/users/andreas-schwab/orgs", "repos_url": "https://api.github.com/users/andreas-schwab/repos", "events_url": "https://api.github.com/users/andreas-schwab/events{/privacy}", "received_events_url": "https://api.github.com/users/andreas-schwab/received_events", "type": "User", "site_admin": false}, "committer": null, "parents": [{"sha": "e77c9aedcda056161ff93b55c86789266c1895c9", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/e77c9aedcda056161ff93b55c86789266c1895c9", "html_url": "https://github.com/Rust-GCC/gccrs/commit/e77c9aedcda056161ff93b55c86789266c1895c9"}], "stats": {"total": 75, "additions": 45, "deletions": 30}, "files": [{"sha": "d0ba9426b2a80ecdc07719b01afdcca25e23e4fa", "filename": "gcc/ChangeLog", "status": "modified", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/511d31d856ee3ecf3296f46aed7c8e15611793fb/gcc%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/511d31d856ee3ecf3296f46aed7c8e15611793fb/gcc%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2FChangeLog?ref=511d31d856ee3ecf3296f46aed7c8e15611793fb", "patch": "@@ -1,3 +1,8 @@\n+2012-11-05  Andreas Schwab  <schwab@linux-m68k.org>\n+\n+\t* final.c (final_scan_insn) [HAVE_cc0]: Handle all comparison\n+\tcodes in non-jump and cmove insn.\n+\n 2012-11-05  Uros Bizjak  <ubizjak@gmail.com>\n \t    Vladimir Yakovlev  <vladimir.b.yakovlev@intel.com>\n "}, {"sha": "fc10dd6d5a69f155bc51be544a9106cc18988247", "filename": "gcc/final.c", "status": "modified", "additions": 13, "deletions": 30, "changes": 43, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/511d31d856ee3ecf3296f46aed7c8e15611793fb/gcc%2Ffinal.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/511d31d856ee3ecf3296f46aed7c8e15611793fb/gcc%2Ffinal.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ffinal.c?ref=511d31d856ee3ecf3296f46aed7c8e15611793fb", "patch": "@@ -1,7 +1,7 @@\n /* Convert RTL to assembler code and output it, for GNU compiler.\n    Copyright (C) 1987, 1988, 1989, 1992, 1993, 1994, 1995, 1996, 1997,\n    1998, 1999, 2000, 2001, 2002, 2003, 2004, 2005, 2006, 2007, 2008, 2009,\n-   2010, 2011\n+   2010, 2011, 2012\n    Free Software Foundation, Inc.\n \n This file is part of GCC.\n@@ -2689,36 +2689,19 @@ final_scan_insn (rtx insn, FILE *file, int optimize_p ATTRIBUTE_UNUSED,\n \t\telse_rtx = const0_rtx;\n \t      }\n \n-\t    switch (GET_CODE (cond_rtx))\n+\t    if (COMPARISON_P (cond_rtx)\n+\t\t&& XEXP (cond_rtx, 0) == cc0_rtx)\n \t      {\n-\t      case GTU:\n-\t      case GT:\n-\t      case LTU:\n-\t      case LT:\n-\t      case GEU:\n-\t      case GE:\n-\t      case LEU:\n-\t      case LE:\n-\t      case EQ:\n-\t      case NE:\n-\t\t{\n-\t\t  int result;\n-\t\t  if (XEXP (cond_rtx, 0) != cc0_rtx)\n-\t\t    break;\n-\t\t  result = alter_cond (cond_rtx);\n-\t\t  if (result == 1)\n-\t\t    validate_change (insn, &SET_SRC (set), then_rtx, 0);\n-\t\t  else if (result == -1)\n-\t\t    validate_change (insn, &SET_SRC (set), else_rtx, 0);\n-\t\t  else if (result == 2)\n-\t\t    INSN_CODE (insn) = -1;\n-\t\t  if (SET_DEST (set) == SET_SRC (set))\n-\t\t    delete_insn (insn);\n-\t\t}\n-\t\tbreak;\n-\n-\t      default:\n-\t\tbreak;\n+\t\tint result;\n+\t\tresult = alter_cond (cond_rtx);\n+\t\tif (result == 1)\n+\t\t  validate_change (insn, &SET_SRC (set), then_rtx, 0);\n+\t\telse if (result == -1)\n+\t\t  validate_change (insn, &SET_SRC (set), else_rtx, 0);\n+\t\telse if (result == 2)\n+\t\t  INSN_CODE (insn) = -1;\n+\t\tif (SET_DEST (set) == SET_SRC (set))\n+\t\t  delete_insn (insn);\n \t      }\n \t  }\n "}, {"sha": "af92ce4c7f58b689ff2c8b5d30be401346756429", "filename": "gcc/testsuite/ChangeLog", "status": "modified", "additions": 4, "deletions": 0, "changes": 4, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/511d31d856ee3ecf3296f46aed7c8e15611793fb/gcc%2Ftestsuite%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/511d31d856ee3ecf3296f46aed7c8e15611793fb/gcc%2Ftestsuite%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2FChangeLog?ref=511d31d856ee3ecf3296f46aed7c8e15611793fb", "patch": "@@ -1,3 +1,7 @@\n+2012-11-05  Andreas Schwab  <schwab@linux-m68k.org>\n+\n+\t* gcc.dg/torture/fp-compare.c: New testcase.\n+\n 2012-11-05  Jan Hubicka  <jh@suse.cz>\n \n \t* gcc.dg/const-1.c: Update."}, {"sha": "0d51dfd2478ed7837ab3aeb3bd1c1857a4e98598", "filename": "gcc/testsuite/gcc.dg/torture/fp-compare.c", "status": "added", "additions": 23, "deletions": 0, "changes": 23, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/511d31d856ee3ecf3296f46aed7c8e15611793fb/gcc%2Ftestsuite%2Fgcc.dg%2Ftorture%2Ffp-compare.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/511d31d856ee3ecf3296f46aed7c8e15611793fb/gcc%2Ftestsuite%2Fgcc.dg%2Ftorture%2Ffp-compare.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgcc.dg%2Ftorture%2Ffp-compare.c?ref=511d31d856ee3ecf3296f46aed7c8e15611793fb", "patch": "@@ -0,0 +1,23 @@\n+/* { dg-do run } */\n+/* Check that find_scan_insn properly handles swapped FP comparisons.  */\n+static double x;\n+static int exit_code;\n+\n+void __attribute__ ((noinline))\n+check_int (int a, int b)\n+{\n+  exit_code += (a != b);\n+}\n+\n+int\n+main (void)\n+{\n+  x = 0.0;\n+  asm (\"\" : \"+m\" (x));\n+  check_int (__builtin_isgreater (x, 1.0), 0);\n+  check_int (__builtin_isgreaterequal (x, 1.0), 0);\n+  check_int (__builtin_isless (x, 1.0), 1);\n+  check_int (__builtin_islessequal (x, 1.0), 1);\n+  check_int (__builtin_islessgreater (x, 1.0), 1);\n+  return exit_code;\n+}"}]}