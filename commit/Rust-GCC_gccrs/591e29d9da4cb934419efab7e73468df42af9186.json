{"sha": "591e29d9da4cb934419efab7e73468df42af9186", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6NTkxZTI5ZDlkYTRjYjkzNDQxOWVmYWI3ZTczNDY4ZGY0MmFmOTE4Ng==", "commit": {"author": {"name": "Jakub Jelinek", "email": "jakub@redhat.com", "date": "2011-01-28T19:36:44Z"}, "committer": {"name": "Jakub Jelinek", "email": "jakub@gcc.gnu.org", "date": "2011-01-28T19:36:44Z"}, "message": "re PR target/42894 (Invalid rtl sharing in Thumb1.)\n\n\tPR target/42894\n\t* varasm.c (force_const_mem): Store copy of x in desc->constant\n\tinstead of x itself.\n\t* expr.c (emit_move_insn): Add a copy of y_cst instead of y_cst\n\titself into REG_EQUAL note.\n\n\t* gcc.dg/tls/pr42894.c: New test.\n\nFrom-SVN: r169370", "tree": {"sha": "738974e0dfcd7dab87ec93691e86e2079883ce31", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/738974e0dfcd7dab87ec93691e86e2079883ce31"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/591e29d9da4cb934419efab7e73468df42af9186", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/591e29d9da4cb934419efab7e73468df42af9186", "html_url": "https://github.com/Rust-GCC/gccrs/commit/591e29d9da4cb934419efab7e73468df42af9186", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/591e29d9da4cb934419efab7e73468df42af9186/comments", "author": {"login": "jakubjelinek", "id": 9370665, "node_id": "MDQ6VXNlcjkzNzA2NjU=", "avatar_url": "https://avatars.githubusercontent.com/u/9370665?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jakubjelinek", "html_url": "https://github.com/jakubjelinek", "followers_url": "https://api.github.com/users/jakubjelinek/followers", "following_url": "https://api.github.com/users/jakubjelinek/following{/other_user}", "gists_url": "https://api.github.com/users/jakubjelinek/gists{/gist_id}", "starred_url": "https://api.github.com/users/jakubjelinek/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jakubjelinek/subscriptions", "organizations_url": "https://api.github.com/users/jakubjelinek/orgs", "repos_url": "https://api.github.com/users/jakubjelinek/repos", "events_url": "https://api.github.com/users/jakubjelinek/events{/privacy}", "received_events_url": "https://api.github.com/users/jakubjelinek/received_events", "type": "User", "site_admin": false}, "committer": null, "parents": [{"sha": "62dcc44a4bbe224aaac5d5dccb4703382b3a84e5", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/62dcc44a4bbe224aaac5d5dccb4703382b3a84e5", "html_url": "https://github.com/Rust-GCC/gccrs/commit/62dcc44a4bbe224aaac5d5dccb4703382b3a84e5"}], "stats": {"total": 31, "additions": 28, "deletions": 3}, "files": [{"sha": "714bc44e34a054c0012528fca87f1f6016754464", "filename": "gcc/ChangeLog", "status": "modified", "additions": 8, "deletions": 0, "changes": 8, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/591e29d9da4cb934419efab7e73468df42af9186/gcc%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/591e29d9da4cb934419efab7e73468df42af9186/gcc%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2FChangeLog?ref=591e29d9da4cb934419efab7e73468df42af9186", "patch": "@@ -1,3 +1,11 @@\n+2011-01-28  Jakub Jelinek  <jakub@redhat.com>\n+\n+\tPR target/42894\n+\t* varasm.c (force_const_mem): Store copy of x in desc->constant\n+\tinstead of x itself.\n+\t* expr.c (emit_move_insn): Add a copy of y_cst instead of y_cst\n+\titself into REG_EQUAL note.\n+\n 2011-01-28  Joseph Myers  <joseph@codesourcery.com>\n \n \t* config/freebsd.opt (posix, rdynamic): New Driver options."}, {"sha": "e6b42795b3a1b8c02733cfbd00e8f6867f4c6951", "filename": "gcc/expr.c", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/591e29d9da4cb934419efab7e73468df42af9186/gcc%2Fexpr.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/591e29d9da4cb934419efab7e73468df42af9186/gcc%2Fexpr.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fexpr.c?ref=591e29d9da4cb934419efab7e73468df42af9186", "patch": "@@ -3398,7 +3398,7 @@ emit_move_insn (rtx x, rtx y)\n       && (set = single_set (last_insn)) != NULL_RTX\n       && SET_DEST (set) == x\n       && ! rtx_equal_p (y_cst, SET_SRC (set)))\n-    set_unique_reg_note (last_insn, REG_EQUAL, y_cst);\n+    set_unique_reg_note (last_insn, REG_EQUAL, copy_rtx (y_cst));\n \n   return last_insn;\n }"}, {"sha": "4d6acf0176f070d2b03ccc1fa81bd7bc5f5b0de0", "filename": "gcc/testsuite/ChangeLog", "status": "modified", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/591e29d9da4cb934419efab7e73468df42af9186/gcc%2Ftestsuite%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/591e29d9da4cb934419efab7e73468df42af9186/gcc%2Ftestsuite%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2FChangeLog?ref=591e29d9da4cb934419efab7e73468df42af9186", "patch": "@@ -1,3 +1,8 @@\n+2011-01-28  Jakub Jelinek  <jakub@redhat.com>\n+\n+\tPR target/42894\n+\t* gcc.dg/tls/pr42894.c: New test.\n+\n 2011-01-28  Rainer Orth  <ro@CeBiTec.Uni-Bielefeld.DE>\n \n \t* gcc.dg/pr47276.c: Add dg-require-visibility."}, {"sha": "c3bd76c91c46229252d931910532469a8cb09f25", "filename": "gcc/testsuite/gcc.dg/tls/pr42894.c", "status": "added", "additions": 12, "deletions": 0, "changes": 12, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/591e29d9da4cb934419efab7e73468df42af9186/gcc%2Ftestsuite%2Fgcc.dg%2Ftls%2Fpr42894.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/591e29d9da4cb934419efab7e73468df42af9186/gcc%2Ftestsuite%2Fgcc.dg%2Ftls%2Fpr42894.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgcc.dg%2Ftls%2Fpr42894.c?ref=591e29d9da4cb934419efab7e73468df42af9186", "patch": "@@ -0,0 +1,12 @@\n+/* PR target/42894 */\n+/* { dg-do compile } */\n+/* { dg-options \"-march=armv5te -mthumb\" { target arm*-*-* } } */\n+/* { dg-require-effective-target tls } */\n+\n+extern __thread int t;\n+\n+void\n+foo (int a)\n+{\n+  t = a;\n+}"}, {"sha": "a1cddac16c1ebe1e2e4fe65c9f2e37aea9b9fe99", "filename": "gcc/varasm.c", "status": "modified", "additions": 2, "deletions": 2, "changes": 4, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/591e29d9da4cb934419efab7e73468df42af9186/gcc%2Fvarasm.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/591e29d9da4cb934419efab7e73468df42af9186/gcc%2Fvarasm.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fvarasm.c?ref=591e29d9da4cb934419efab7e73468df42af9186", "patch": "@@ -1,7 +1,7 @@\n /* Output variables, constants and external declarations, for GNU compiler.\n    Copyright (C) 1987, 1988, 1989, 1992, 1993, 1994, 1995, 1996, 1997,\n    1998, 1999, 2000, 2001, 2002, 2003, 2004, 2005, 2006, 2007, 2008, 2009,\n-   2010  Free Software Foundation, Inc.\n+   2010, 2011  Free Software Foundation, Inc.\n \n This file is part of GCC.\n \n@@ -3518,7 +3518,7 @@ force_const_mem (enum machine_mode mode, rtx x)\n   pool->offset &= ~ ((align / BITS_PER_UNIT) - 1);\n \n   desc->next = NULL;\n-  desc->constant = tmp.constant;\n+  desc->constant = copy_rtx (tmp.constant);\n   desc->offset = pool->offset;\n   desc->hash = hash;\n   desc->mode = mode;"}]}