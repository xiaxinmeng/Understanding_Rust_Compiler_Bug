{"sha": "ff9fccdcb5118d494bba801038a1c334bf2e38fd", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6ZmY5ZmNjZGNiNTExOGQ0OTRiYmE4MDEwMzhhMWMzMzRiZjJlMzhmZA==", "commit": {"author": {"name": "Jakub Jelinek", "email": "jakub@redhat.com", "date": "2018-02-26T14:37:45Z"}, "committer": {"name": "Jakub Jelinek", "email": "jakub@gcc.gnu.org", "date": "2018-02-26T14:37:45Z"}, "message": "re PR bootstrap/84405 (Fails to bootstrap with GCC 4.1.2, GCC 4.2.4)\n\n\tPR bootstrap/84405\n\t* vec.h (vec_default_construct): For BROKEN_VALUE_INITIALIZATION use\n\tmemset and value initialization afterwards.\n\nFrom-SVN: r257989", "tree": {"sha": "a3127c41450f5dbb9df32332493546c6bf2fa3f2", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/a3127c41450f5dbb9df32332493546c6bf2fa3f2"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/ff9fccdcb5118d494bba801038a1c334bf2e38fd", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/ff9fccdcb5118d494bba801038a1c334bf2e38fd", "html_url": "https://github.com/Rust-GCC/gccrs/commit/ff9fccdcb5118d494bba801038a1c334bf2e38fd", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/ff9fccdcb5118d494bba801038a1c334bf2e38fd/comments", "author": {"login": "jakubjelinek", "id": 9370665, "node_id": "MDQ6VXNlcjkzNzA2NjU=", "avatar_url": "https://avatars.githubusercontent.com/u/9370665?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jakubjelinek", "html_url": "https://github.com/jakubjelinek", "followers_url": "https://api.github.com/users/jakubjelinek/followers", "following_url": "https://api.github.com/users/jakubjelinek/following{/other_user}", "gists_url": "https://api.github.com/users/jakubjelinek/gists{/gist_id}", "starred_url": "https://api.github.com/users/jakubjelinek/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jakubjelinek/subscriptions", "organizations_url": "https://api.github.com/users/jakubjelinek/orgs", "repos_url": "https://api.github.com/users/jakubjelinek/repos", "events_url": "https://api.github.com/users/jakubjelinek/events{/privacy}", "received_events_url": "https://api.github.com/users/jakubjelinek/received_events", "type": "User", "site_admin": false}, "committer": null, "parents": [{"sha": "7518398dce1d913e01899d3aa52caec50e6efb4f", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/7518398dce1d913e01899d3aa52caec50e6efb4f", "html_url": "https://github.com/Rust-GCC/gccrs/commit/7518398dce1d913e01899d3aa52caec50e6efb4f"}], "stats": {"total": 25, "additions": 21, "deletions": 4}, "files": [{"sha": "ebbc25b6c1d1b5f903ba5de0cf8075ccc1efeff1", "filename": "gcc/ChangeLog", "status": "modified", "additions": 6, "deletions": 0, "changes": 6, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/ff9fccdcb5118d494bba801038a1c334bf2e38fd/gcc%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/ff9fccdcb5118d494bba801038a1c334bf2e38fd/gcc%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2FChangeLog?ref=ff9fccdcb5118d494bba801038a1c334bf2e38fd", "patch": "@@ -1,3 +1,9 @@\n+2018-02-26  Jakub Jelinek  <jakub@redhat.com>\n+\n+\tPR bootstrap/84405\n+\t* vec.h (vec_default_construct): For BROKEN_VALUE_INITIALIZATION use\n+\tmemset and value initialization afterwards.\n+\n 2018-02-26  Christophe Lyon  <christophe.lyon@linaro.org>\n \n \t* Makefile.in (lto-wrapper): Use ALL_LINKERFLAGS."}, {"sha": "4d2046c04af562b06b8a3dbc4d056d7c0dadd8bb", "filename": "gcc/vec.h", "status": "modified", "additions": 15, "deletions": 4, "changes": 19, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/ff9fccdcb5118d494bba801038a1c334bf2e38fd/gcc%2Fvec.h", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/ff9fccdcb5118d494bba801038a1c334bf2e38fd/gcc%2Fvec.h", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fvec.h?ref=ff9fccdcb5118d494bba801038a1c334bf2e38fd", "patch": "@@ -490,12 +490,23 @@ template <typename T>\n inline void\n vec_default_construct (T *dst, unsigned n)\n {\n-#ifndef BROKEN_VALUE_INITIALIZATION\n-  for ( ; n; ++dst, --n)\n-    ::new (static_cast<void*>(dst)) T ();\n-#else\n+#ifdef BROKEN_VALUE_INITIALIZATION\n+  /* Versions of GCC before 4.4 sometimes leave certain objects\n+     uninitialized when value initialized, though if the type has\n+     user defined default ctor, that ctor is invoked.  As a workaround\n+     perform clearing first and then the value initialization, which\n+     fixes the case when value initialization doesn't initialize due to\n+     the bugs and should initialize to all zeros, but still allows\n+     vectors for types with user defined default ctor that initializes\n+     some or all elements to non-zero.  If T has no user defined\n+     default ctor and some non-static data members have user defined\n+     default ctors that initialize to non-zero the workaround will\n+     still not work properly; in that case we just need to provide\n+     user defined default ctor.  */\n   memset (dst, '\\0', sizeof (T) * n);\n #endif\n+  for ( ; n; ++dst, --n)\n+    ::new (static_cast<void*>(dst)) T ();\n }\n \n /* Copy-construct N elements in DST from *SRC.  */"}]}