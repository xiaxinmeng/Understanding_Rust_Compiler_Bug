{"sha": "2f62294dec1f3af59dd7505c058b0af38c2d1524", "node_id": "C_kwDOANBUbNoAKDJmNjIyOTRkZWMxZjNhZjU5ZGQ3NTA1YzA1OGIwYWYzOGMyZDE1MjQ", "commit": {"author": {"name": "Richard Biener", "email": "rguenther@suse.de", "date": "2022-01-12T14:25:07Z"}, "committer": {"name": "Richard Biener", "email": "rguenther@suse.de", "date": "2022-01-12T15:18:20Z"}, "message": "tree-optimization/103990 - fix CFG cleanup regression from PRE change\n\nThis adjusts the CFG cleanup flow back to what it was before the\nlast change which fixes the observed regression of 541.leela_r with\nLTO and FDO.\n\n2022-01-12  Richard Biener  <rguenther@suse.de>\n\n\tPR tree-optimization/103990\n\t* tree-pass.h (tail_merge_optimize): Drop unused argument.\n\t* tree-ssa-tail-merge.c (tail_merge_optimize): Likewise.\n\t* tree-ssa-pre.c (pass_pre::execute): Retain TODO_cleanup_cfg\n\tand adjust call to tail_merge_optimize.", "tree": {"sha": "aab37aab5c09a20b6c7444090899ef3f13c171c8", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/aab37aab5c09a20b6c7444090899ef3f13c171c8"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/2f62294dec1f3af59dd7505c058b0af38c2d1524", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/2f62294dec1f3af59dd7505c058b0af38c2d1524", "html_url": "https://github.com/Rust-GCC/gccrs/commit/2f62294dec1f3af59dd7505c058b0af38c2d1524", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/2f62294dec1f3af59dd7505c058b0af38c2d1524/comments", "author": {"login": "rguenth", "id": 2046526, "node_id": "MDQ6VXNlcjIwNDY1MjY=", "avatar_url": "https://avatars.githubusercontent.com/u/2046526?v=4", "gravatar_id": "", "url": "https://api.github.com/users/rguenth", "html_url": "https://github.com/rguenth", "followers_url": "https://api.github.com/users/rguenth/followers", "following_url": "https://api.github.com/users/rguenth/following{/other_user}", "gists_url": "https://api.github.com/users/rguenth/gists{/gist_id}", "starred_url": "https://api.github.com/users/rguenth/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/rguenth/subscriptions", "organizations_url": "https://api.github.com/users/rguenth/orgs", "repos_url": "https://api.github.com/users/rguenth/repos", "events_url": "https://api.github.com/users/rguenth/events{/privacy}", "received_events_url": "https://api.github.com/users/rguenth/received_events", "type": "User", "site_admin": false}, "committer": {"login": "rguenth", "id": 2046526, "node_id": "MDQ6VXNlcjIwNDY1MjY=", "avatar_url": "https://avatars.githubusercontent.com/u/2046526?v=4", "gravatar_id": "", "url": "https://api.github.com/users/rguenth", "html_url": "https://github.com/rguenth", "followers_url": "https://api.github.com/users/rguenth/followers", "following_url": "https://api.github.com/users/rguenth/following{/other_user}", "gists_url": "https://api.github.com/users/rguenth/gists{/gist_id}", "starred_url": "https://api.github.com/users/rguenth/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/rguenth/subscriptions", "organizations_url": "https://api.github.com/users/rguenth/orgs", "repos_url": "https://api.github.com/users/rguenth/repos", "events_url": "https://api.github.com/users/rguenth/events{/privacy}", "received_events_url": "https://api.github.com/users/rguenth/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "2c16dfe6268eeeb4b7924ff423e274fa00894a4d", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/2c16dfe6268eeeb4b7924ff423e274fa00894a4d", "html_url": "https://github.com/Rust-GCC/gccrs/commit/2c16dfe6268eeeb4b7924ff423e274fa00894a4d"}], "stats": {"total": 12, "additions": 5, "deletions": 7}, "files": [{"sha": "606d1d60b856b9529e1052efc4a0c2989e7f01c7", "filename": "gcc/tree-pass.h", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/2f62294dec1f3af59dd7505c058b0af38c2d1524/gcc%2Ftree-pass.h", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/2f62294dec1f3af59dd7505c058b0af38c2d1524/gcc%2Ftree-pass.h", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftree-pass.h?ref=2f62294dec1f3af59dd7505c058b0af38c2d1524", "patch": "@@ -412,7 +412,7 @@ extern gimple_opt_pass *make_pass_early_thread_jumps (gcc::context *ctxt);\n extern gimple_opt_pass *make_pass_split_crit_edges (gcc::context *ctxt);\n extern gimple_opt_pass *make_pass_laddress (gcc::context *ctxt);\n extern gimple_opt_pass *make_pass_pre (gcc::context *ctxt);\n-extern unsigned int tail_merge_optimize (unsigned int, bool);\n+extern unsigned int tail_merge_optimize (bool);\n extern gimple_opt_pass *make_pass_profile (gcc::context *ctxt);\n extern gimple_opt_pass *make_pass_strip_predict_hints (gcc::context *ctxt);\n extern gimple_opt_pass *make_pass_lower_complex_O0 (gcc::context *ctxt);"}, {"sha": "5113256802eee8652abbb48b49c010b9ec65c723", "filename": "gcc/tree-ssa-pre.c", "status": "modified", "additions": 2, "deletions": 4, "changes": 6, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/2f62294dec1f3af59dd7505c058b0af38c2d1524/gcc%2Ftree-ssa-pre.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/2f62294dec1f3af59dd7505c058b0af38c2d1524/gcc%2Ftree-ssa-pre.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftree-ssa-pre.c?ref=2f62294dec1f3af59dd7505c058b0af38c2d1524", "patch": "@@ -4442,7 +4442,6 @@ pass_pre::execute (function *fun)\n   if (todo & TODO_cleanup_cfg)\n     {\n       cleanup_tree_cfg ();\n-      todo &= ~TODO_cleanup_cfg;\n       need_crit_edge_split = true;\n     }\n \n@@ -4458,9 +4457,8 @@ pass_pre::execute (function *fun)\n      It should either:\n      - call merge_blocks after each tail merge iteration\n      - call merge_blocks after all tail merge iterations\n-     - mark TODO_cleanup_cfg when necessary\n-     - share the cfg cleanup with fini_pre.  */\n-  todo |= tail_merge_optimize (todo, need_crit_edge_split);\n+     - mark TODO_cleanup_cfg when necessary.  */\n+  todo |= tail_merge_optimize (need_crit_edge_split);\n \n   free_rpo_vn ();\n "}, {"sha": "8e1ea1a982e3a201f96e7d355239c3a146400615", "filename": "gcc/tree-ssa-tail-merge.c", "status": "modified", "additions": 2, "deletions": 2, "changes": 4, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/2f62294dec1f3af59dd7505c058b0af38c2d1524/gcc%2Ftree-ssa-tail-merge.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/2f62294dec1f3af59dd7505c058b0af38c2d1524/gcc%2Ftree-ssa-tail-merge.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftree-ssa-tail-merge.c?ref=2f62294dec1f3af59dd7505c058b0af38c2d1524", "patch": "@@ -1724,7 +1724,7 @@ update_debug_stmts (void)\n /* Runs tail merge optimization.  */\n \n unsigned int\n-tail_merge_optimize (unsigned int todo, bool need_crit_edge_split)\n+tail_merge_optimize (bool need_crit_edge_split)\n {\n   int nr_bbs_removed_total = 0;\n   int nr_bbs_removed;\n@@ -1814,5 +1814,5 @@ tail_merge_optimize (unsigned int todo, bool need_crit_edge_split)\n \n   timevar_pop (TV_TREE_TAIL_MERGE);\n \n-  return todo;\n+  return 0;\n }"}]}