{"sha": "75cf42ccffa6a661cce421e0d9eb0e0689d75aae", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6NzVjZjQyY2NmZmE2YTY2MWNjZTQyMWUwZDllYjBlMDY4OWQ3NWFhZQ==", "commit": {"author": {"name": "Richard Guenther", "email": "rguenth@gcc.gnu.org", "date": "2005-04-23T21:34:40Z"}, "committer": {"name": "Richard Biener", "email": "rguenth@gcc.gnu.org", "date": "2005-04-23T21:34:40Z"}, "message": "re PR middle-end/21082 (&a[b] - &a[c] is not folded to b - c)\n\n2005-04-23  Richard Guenther  <rguenth@gcc.gnu.org>\n\n\tPR middle-end/21082\n\t* fold-const.c: Fold &a[i]-&a[j] to i-j.\n\n\t* g++.dg/tree-ssa/pr21082.C: New testcase.\n\nFrom-SVN: r98636", "tree": {"sha": "ad181a15c3fa2379b1bb6a0ffc0864bace316ee0", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/ad181a15c3fa2379b1bb6a0ffc0864bace316ee0"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/75cf42ccffa6a661cce421e0d9eb0e0689d75aae", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/75cf42ccffa6a661cce421e0d9eb0e0689d75aae", "html_url": "https://github.com/Rust-GCC/gccrs/commit/75cf42ccffa6a661cce421e0d9eb0e0689d75aae", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/75cf42ccffa6a661cce421e0d9eb0e0689d75aae/comments", "author": null, "committer": null, "parents": [{"sha": "be1b5cba3527dececdb66c6c356260500a040345", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/be1b5cba3527dececdb66c6c356260500a040345", "html_url": "https://github.com/Rust-GCC/gccrs/commit/be1b5cba3527dececdb66c6c356260500a040345"}], "stats": {"total": 46, "additions": 45, "deletions": 1}, "files": [{"sha": "e0a065b7695bf2db28a6aa517cbc258be4ab9ed0", "filename": "gcc/ChangeLog", "status": "modified", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/75cf42ccffa6a661cce421e0d9eb0e0689d75aae/gcc%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/75cf42ccffa6a661cce421e0d9eb0e0689d75aae/gcc%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2FChangeLog?ref=75cf42ccffa6a661cce421e0d9eb0e0689d75aae", "patch": "@@ -1,3 +1,8 @@\n+2005-04-23  Richard Guenther  <rguenth@gcc.gnu.org>\n+\n+\tPR middle-end/21082\n+\t* fold-const.c: Fold &a[i]-&a[j] to i-j.\n+\n 2005-04-23  Zdenek Dvorak  <dvorakz@suse.cz>\n \n \t* tree-ssa-loop-niter.c (tree_simplify_using_condition): Expand simple"}, {"sha": "a75d1a2506354ff0395d403dee77f6bf54d6cead", "filename": "gcc/fold-const.c", "status": "modified", "additions": 22, "deletions": 1, "changes": 23, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/75cf42ccffa6a661cce421e0d9eb0e0689d75aae/gcc%2Ffold-const.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/75cf42ccffa6a661cce421e0d9eb0e0689d75aae/gcc%2Ffold-const.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ffold-const.c?ref=75cf42ccffa6a661cce421e0d9eb0e0689d75aae", "patch": "@@ -7841,7 +7841,28 @@ fold_binary (enum tree_code code, tree type, tree op0, tree op1)\n \t    && ptr_difference_const (arg0, arg1, &diff))\n \t  return build_int_cst_type (type, diff);\n       }\n-\t  \n+\n+      /* Fold &a[i] - &a[j] to i-j.  */\n+      if (TREE_CODE (arg0) == ADDR_EXPR\n+\t  && TREE_CODE (TREE_OPERAND (arg0, 0)) == ARRAY_REF\n+\t  && TREE_CODE (arg1) == ADDR_EXPR\n+\t  && TREE_CODE (TREE_OPERAND (arg1, 0)) == ARRAY_REF)\n+        {\n+\t  tree aref0 = TREE_OPERAND (arg0, 0);\n+\t  tree aref1 = TREE_OPERAND (arg1, 0);\n+\t  if (operand_equal_p (TREE_OPERAND (aref0, 0),\n+\t\t\t       TREE_OPERAND (aref1, 0), 0))\n+\t    {\n+\t      tree op0 = fold_convert (type, TREE_OPERAND (aref0, 1));\n+\t      tree op1 = fold_convert (type, TREE_OPERAND (aref1, 1));\n+\t      tree esz = array_ref_element_size (aref0);\n+\t      tree diff = build2 (MINUS_EXPR, type, op0, op1);\n+\t      return fold_build2 (MULT_EXPR, type, diff,\n+\t\t\t          fold_convert (type, esz));\n+\t\t\t          \n+\t    }\n+\t}\n+\n       /* Try replacing &a[i1] - c * i2 with &a[i1 - i2], if c is step\n \t of the array.  Loop optimizer sometimes produce this type of\n \t expressions.  */"}, {"sha": "48e1d3078bd984f7063d3573dead5e319ee9c106", "filename": "gcc/testsuite/ChangeLog", "status": "modified", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/75cf42ccffa6a661cce421e0d9eb0e0689d75aae/gcc%2Ftestsuite%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/75cf42ccffa6a661cce421e0d9eb0e0689d75aae/gcc%2Ftestsuite%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2FChangeLog?ref=75cf42ccffa6a661cce421e0d9eb0e0689d75aae", "patch": "@@ -1,3 +1,8 @@\n+2005-04-23  Richard Guenther  <rguenth@gcc.gnu.org>\n+\n+\tPR middle-end/21082\n+\t* g++.dg/tree-ssa/pr21082.C: New testcase.\n+\n 2005-04-23  Zdenek Dvorak  <dvorakz@suse.cz>\n \n \t* gcc.dg/vect/vect-99.c: New test."}, {"sha": "dab630fa503c0d01e60f3392a1755d880ec0e2b3", "filename": "gcc/testsuite/g++.dg/tree-ssa/pr21082.C", "status": "added", "additions": 13, "deletions": 0, "changes": 13, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/75cf42ccffa6a661cce421e0d9eb0e0689d75aae/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Ftree-ssa%2Fpr21082.C", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/75cf42ccffa6a661cce421e0d9eb0e0689d75aae/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Ftree-ssa%2Fpr21082.C", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Ftree-ssa%2Fpr21082.C?ref=75cf42ccffa6a661cce421e0d9eb0e0689d75aae", "patch": "@@ -0,0 +1,13 @@\n+/* { dg-do link } */\n+\n+void link_error();\n+\n+int a[4];\n+long b, c;\n+\n+int main()\n+{\n+\tif (&a[b] - &a[c] != b - c)\n+\t\tlink_error();\n+\treturn 0;\n+}"}]}