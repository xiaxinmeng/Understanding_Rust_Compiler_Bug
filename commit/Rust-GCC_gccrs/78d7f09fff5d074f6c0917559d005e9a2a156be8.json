{"sha": "78d7f09fff5d074f6c0917559d005e9a2a156be8", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6NzhkN2YwOWZmZjVkMDc0ZjZjMDkxNzU1OWQwMDVlOWEyYTE1NmJlOA==", "commit": {"author": {"name": "Tom de Vries", "email": "tom@codesourcery.com", "date": "2014-11-14T12:09:45Z"}, "committer": {"name": "Tom de Vries", "email": "vries@gcc.gnu.org", "date": "2014-11-14T12:09:45Z"}, "message": "Fix patch mangling with --inline option\n\n2014-11-14  Tom de Vries  <tom@codesourcery.com>\n\n\t* mklog: Move reading of .diff file up and add comment.  Copy diff_lines\n\tto orig_diff_lines.  Use orig_diff_lines when appending patch.\n\nFrom-SVN: r217558", "tree": {"sha": "33066cc0dd504058a5e2faab1c35d94b9a4aa6b3", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/33066cc0dd504058a5e2faab1c35d94b9a4aa6b3"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/78d7f09fff5d074f6c0917559d005e9a2a156be8", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/78d7f09fff5d074f6c0917559d005e9a2a156be8", "html_url": "https://github.com/Rust-GCC/gccrs/commit/78d7f09fff5d074f6c0917559d005e9a2a156be8", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/78d7f09fff5d074f6c0917559d005e9a2a156be8/comments", "author": null, "committer": null, "parents": [{"sha": "cbe4c88c5ef99e9ff26f9aef92b3cd68707d4d9c", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/cbe4c88c5ef99e9ff26f9aef92b3cd68707d4d9c", "html_url": "https://github.com/Rust-GCC/gccrs/commit/cbe4c88c5ef99e9ff26f9aef92b3cd68707d4d9c"}], "stats": {"total": 21, "additions": 17, "deletions": 4}, "files": [{"sha": "60257c48e07156dcdd6f539408f1e4bb957c8d3f", "filename": "contrib/ChangeLog", "status": "modified", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/78d7f09fff5d074f6c0917559d005e9a2a156be8/contrib%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/78d7f09fff5d074f6c0917559d005e9a2a156be8/contrib%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/contrib%2FChangeLog?ref=78d7f09fff5d074f6c0917559d005e9a2a156be8", "patch": "@@ -1,3 +1,8 @@\n+2014-11-14  Tom de Vries  <tom@codesourcery.com>\n+\n+\t* mklog: Move reading of .diff file up and add comment.  Copy diff_lines\n+\tto orig_diff_lines.  Use orig_diff_lines when appending patch.\n+\n 2014-11-11  David Malcolm  <dmalcolm@redhat.com>\n \n \t* ChangeLog.jit: New."}, {"sha": "840f6f8c2663e912277b2341d8bcffe294177275", "filename": "contrib/mklog", "status": "modified", "additions": 12, "deletions": 4, "changes": 16, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/78d7f09fff5d074f6c0917559d005e9a2a156be8/contrib%2Fmklog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/78d7f09fff5d074f6c0917559d005e9a2a156be8/contrib%2Fmklog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/contrib%2Fmklog?ref=78d7f09fff5d074f6c0917559d005e9a2a156be8", "patch": "@@ -132,15 +132,23 @@ sub is_top_level {\n \treturn $function && $function !~ /^[\\s{]/;\n }\n \n+# Read contents of .diff file\n+open (DFILE, $diff) or die \"Could not open file $diff for reading\";\n+chomp (my @diff_lines = <DFILE>);\n+close (DFILE);\n+\n+# Array diff_lines is modified by the log generation, so save a copy in\n+# orig_diff_lines if needed.\n+if ($inline) {\n+    @orig_diff_lines = @diff_lines;\n+}\n+\n # For every file in the .diff print all the function names in ChangeLog\n # format.\n %cl_entries = ();\n $change_msg = undef;\n $look_for_funs = 0;\n $clname = get_clname('');\n-open (DFILE, $diff) or die \"Could not open file $diff for reading\";\n-chomp (my @diff_lines = <DFILE>);\n-close (DFILE);\n $line_idx = 0;\n foreach (@diff_lines) {\n     # Stop processing functions if we found a new file.\n@@ -313,7 +321,7 @@ foreach my $clname (keys %cl_entries) {\n \n if ($inline) {\n \t# Append the patch to the log\n-\tforeach (@diff_lines) {\n+\tforeach (@orig_diff_lines) {\n \t\tprint OUTPUTFILE \"$_\\n\";\n \t}\n }"}]}