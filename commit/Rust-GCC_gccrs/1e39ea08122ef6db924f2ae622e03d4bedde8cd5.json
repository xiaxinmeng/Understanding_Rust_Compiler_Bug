{"sha": "1e39ea08122ef6db924f2ae622e03d4bedde8cd5", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6MWUzOWVhMDgxMjJlZjZkYjkyNGYyYWU2MjJlMDNkNGJlZGRlOGNkNQ==", "commit": {"author": {"name": "Ian Lance Taylor", "email": "ian@gcc.gnu.org", "date": "2012-09-22T06:51:59Z"}, "committer": {"name": "Ian Lance Taylor", "email": "ian@gcc.gnu.org", "date": "2012-09-22T06:51:59Z"}, "message": "compiler, runtime: Reject surrogate pair converting int to string.\n\nFrom-SVN: r191636", "tree": {"sha": "598267383110c528398d177dec1365ee28ebfc71", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/598267383110c528398d177dec1365ee28ebfc71"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/1e39ea08122ef6db924f2ae622e03d4bedde8cd5", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/1e39ea08122ef6db924f2ae622e03d4bedde8cd5", "html_url": "https://github.com/Rust-GCC/gccrs/commit/1e39ea08122ef6db924f2ae622e03d4bedde8cd5", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/1e39ea08122ef6db924f2ae622e03d4bedde8cd5/comments", "author": null, "committer": null, "parents": [{"sha": "d47cbb6dd43e5cd02d107f336cbd9554c62acd80", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/d47cbb6dd43e5cd02d107f336cbd9554c62acd80", "html_url": "https://github.com/Rust-GCC/gccrs/commit/d47cbb6dd43e5cd02d107f336cbd9554c62acd80"}], "stats": {"total": 15, "additions": 15, "deletions": 0}, "files": [{"sha": "6add84ed1f7d7c6938c8de3a1138ffbfc9783a23", "filename": "gcc/go/gofrontend/lex.cc", "status": "modified", "additions": 6, "deletions": 0, "changes": 6, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/1e39ea08122ef6db924f2ae622e03d4bedde8cd5/gcc%2Fgo%2Fgofrontend%2Flex.cc", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/1e39ea08122ef6db924f2ae622e03d4bedde8cd5/gcc%2Fgo%2Fgofrontend%2Flex.cc", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fgo%2Fgofrontend%2Flex.cc?ref=1e39ea08122ef6db924f2ae622e03d4bedde8cd5", "patch": "@@ -1312,6 +1312,12 @@ Lex::append_char(unsigned int v, bool is_character, std::string* str,\n \t  // Turn it into the \"replacement character\".\n \t  v = 0xfffd;\n \t}\n+      if (v >= 0xd800 && v < 0xe000)\n+\t{\n+\t  warning_at(location, 0,\n+\t\t     \"unicode code point 0x%x is invalid surrogate pair\", v);\n+\t  v = 0xfffd;\n+\t}\n       if (v <= 0xffff)\n \t{\n \t  buf[0] = 0xe0 + (v >> 12);"}, {"sha": "17a5fcb04c011f14410a10ad543ad3769d4e53e4", "filename": "libgo/runtime/go-int-to-string.c", "status": "modified", "additions": 9, "deletions": 0, "changes": 9, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/1e39ea08122ef6db924f2ae622e03d4bedde8cd5/libgo%2Fruntime%2Fgo-int-to-string.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/1e39ea08122ef6db924f2ae622e03d4bedde8cd5/libgo%2Fruntime%2Fgo-int-to-string.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libgo%2Fruntime%2Fgo-int-to-string.c?ref=1e39ea08122ef6db924f2ae622e03d4bedde8cd5", "patch": "@@ -17,6 +17,11 @@ __go_int_to_string (int v)\n   unsigned char *retdata;\n   struct __go_string ret;\n \n+  /* A negative value is not valid UTF-8; turn it into the replacement\n+     character.  */\n+  if (v < 0)\n+    v = 0xfffd;\n+\n   if (v <= 0x7f)\n     {\n       buf[0] = v;\n@@ -34,6 +39,10 @@ __go_int_to_string (int v)\n \t \"replacement character\".  */\n       if (v > 0x10ffff)\n \tv = 0xfffd;\n+      /* If the value is a surrogate pair, which is invalid in UTF-8,\n+\t turn it into the replacement character.  */\n+      if (v >= 0xd800 && v < 0xe000)\n+\tv = 0xfffd;\n \n       if (v <= 0xffff)\n \t{"}]}