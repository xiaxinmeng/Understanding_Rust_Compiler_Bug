{"sha": "230fcd32c9b3c8ceb438dd61802c3d541ead032f", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6MjMwZmNkMzJjOWIzYzhjZWI0MzhkZDYxODAyYzNkNTQxZWFkMDMyZg==", "commit": {"author": {"name": "Phil Edwards", "email": "phil@codesourcery.com", "date": "2003-09-25T04:46:44Z"}, "committer": {"name": "Benjamin Kosnik", "email": "bkoz@gcc.gnu.org", "date": "2003-09-25T04:46:44Z"}, "message": "re PR pch/12112 (Putting PCH files in a directory completely broken)\n\n\n2003-09-24  Phil Edwards  <phil@codesourcery.com>\n\n\tPR pch/12112\n\t* gcc/cppfiles.c (pch_open_file): Return based on combined\n        result of all files.\n\t(validate_pch): Return validate flag for current file.\n\nFrom-SVN: r71751", "tree": {"sha": "7ff910a3d20817f9f6bc4c1bff79279b98d52685", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/7ff910a3d20817f9f6bc4c1bff79279b98d52685"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/230fcd32c9b3c8ceb438dd61802c3d541ead032f", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/230fcd32c9b3c8ceb438dd61802c3d541ead032f", "html_url": "https://github.com/Rust-GCC/gccrs/commit/230fcd32c9b3c8ceb438dd61802c3d541ead032f", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/230fcd32c9b3c8ceb438dd61802c3d541ead032f/comments", "author": null, "committer": null, "parents": [{"sha": "3d5cd6006271e869138edaa57f49c30770e7e825", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/3d5cd6006271e869138edaa57f49c30770e7e825", "html_url": "https://github.com/Rust-GCC/gccrs/commit/3d5cd6006271e869138edaa57f49c30770e7e825"}], "stats": {"total": 23, "additions": 16, "deletions": 7}, "files": [{"sha": "25b795ef6f03b03aa9ecb438b43fdfb055aff04c", "filename": "gcc/ChangeLog", "status": "modified", "additions": 7, "deletions": 0, "changes": 7, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/230fcd32c9b3c8ceb438dd61802c3d541ead032f/gcc%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/230fcd32c9b3c8ceb438dd61802c3d541ead032f/gcc%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2FChangeLog?ref=230fcd32c9b3c8ceb438dd61802c3d541ead032f", "patch": "@@ -1,3 +1,10 @@\n+2003-09-24  Phil Edwards  <phil@codesourcery.com>\n+\n+\tPR pch/12112\n+\t* gcc/cppfiles.c (pch_open_file): Return based on combined\n+        result of all files.\n+\t(validate_pch): Return validate flag for current file.\n+\t\n 2003-09-24  Roger Sayle  <roger@eyesopen.com>\n \n \tPR bootstrap/12358"}, {"sha": "10aee4f5bd7cb013ca97e8a60974646b7f156c3a", "filename": "gcc/cppfiles.c", "status": "modified", "additions": 9, "deletions": 7, "changes": 16, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/230fcd32c9b3c8ceb438dd61802c3d541ead032f/gcc%2Fcppfiles.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/230fcd32c9b3c8ceb438dd61802c3d541ead032f/gcc%2Fcppfiles.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fcppfiles.c?ref=230fcd32c9b3c8ceb438dd61802c3d541ead032f", "patch": "@@ -273,6 +273,9 @@ pch_open_file (cpp_reader *pfile, _cpp_file *file)\n \t  while ((d = readdir (pchdir)) != NULL)\n \t    {\n \t      dlen = strlen (d->d_name) + 1;\n+\t      if ((strcmp (d->d_name, \".\") == 0)\n+\t\t  || (strcmp (d->d_name, \"..\") == 0))\n+\t\tcontinue;\n \t      if (dlen + plen > len)\n \t\t{\n \t\t  len += dlen + 64;\n@@ -285,6 +288,7 @@ pch_open_file (cpp_reader *pfile, _cpp_file *file)\n \t    }\n \t  closedir (pchdir);\n \t}\n+      file->pch |= valid;\n     }\n \n   if (valid)\n@@ -1185,14 +1189,14 @@ static bool\n validate_pch (cpp_reader *pfile, _cpp_file *file, const char *pchname)\n {\n   const char *saved_path = file->path;\n+  bool valid = false;\n \n   file->path = pchname;\n   if (open_file (file))\n     {\n-      if ((file->pch & 2) == 0)\n-\tfile->pch = pfile->cb.valid_pch (pfile, pchname, file->fd);\n+      valid = 1 & pfile->cb.valid_pch (pfile, pchname, file->fd);\n \n-      if (!include_pch_p (file))\n+      if (!valid)\n \t{\n \t  close (file->fd);\n \t  file->fd = -1;\n@@ -1204,12 +1208,10 @@ validate_pch (cpp_reader *pfile, _cpp_file *file, const char *pchname)\n \t  for (i = 1; i < pfile->line_maps.depth; i++)\n \t    putc ('.', stderr);\n \t  fprintf (stderr, \"%c %s\\n\",\n-\t\t   include_pch_p (file) ? '!' : 'x', pchname);\n+\t\t   valid ? '!' : 'x', pchname);\n \t}\n     }\n-  else\n-    file->pch = 2;\n \n   file->path = saved_path;\n-  return include_pch_p (file);\n+  return valid;\n }"}]}