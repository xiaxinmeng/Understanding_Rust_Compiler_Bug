{"sha": "885e812159dcbf83f790eee9d839f91daa553eb3", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6ODg1ZTgxMjE1OWRjYmY4M2Y3OTBlZWU5ZDgzOWY5MWRhYTU1M2ViMw==", "commit": {"author": {"name": "Jonathan Wakely", "email": "jwakely.gcc@gmail.com", "date": "2012-09-09T17:56:51Z"}, "committer": {"name": "Jonathan Wakely", "email": "redi@gcc.gnu.org", "date": "2012-09-09T17:56:51Z"}, "message": "re PR libstdc++/54388 (std::array.at() const results in undefined behaviour)\n\n\tPR libstdc++/54388\n\t* include/std/array (array::at() const): Ensure lvalue result.\n\t* testsuite/23_containers/array/element_access/54388.cc: New.\n\t* testsuite/23_containers/array/tuple_interface/get_neg.cc: Adjust\n\tdg-error line numbers.\n\t* testsuite/23_containers/array/tuple_interface/tuple_element_neg.cc:\n\tLikewise.\n\nFrom-SVN: r191114", "tree": {"sha": "9a602af81e687d5ca4c3dd7a733930b7460808f1", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/9a602af81e687d5ca4c3dd7a733930b7460808f1"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/885e812159dcbf83f790eee9d839f91daa553eb3", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/885e812159dcbf83f790eee9d839f91daa553eb3", "html_url": "https://github.com/Rust-GCC/gccrs/commit/885e812159dcbf83f790eee9d839f91daa553eb3", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/885e812159dcbf83f790eee9d839f91daa553eb3/comments", "author": null, "committer": {"login": "jwakely", "id": 1254480, "node_id": "MDQ6VXNlcjEyNTQ0ODA=", "avatar_url": "https://avatars.githubusercontent.com/u/1254480?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jwakely", "html_url": "https://github.com/jwakely", "followers_url": "https://api.github.com/users/jwakely/followers", "following_url": "https://api.github.com/users/jwakely/following{/other_user}", "gists_url": "https://api.github.com/users/jwakely/gists{/gist_id}", "starred_url": "https://api.github.com/users/jwakely/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jwakely/subscriptions", "organizations_url": "https://api.github.com/users/jwakely/orgs", "repos_url": "https://api.github.com/users/jwakely/repos", "events_url": "https://api.github.com/users/jwakely/events{/privacy}", "received_events_url": "https://api.github.com/users/jwakely/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "b4661bfe214bf5ae119c511f994336ccc3fe144c", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/b4661bfe214bf5ae119c511f994336ccc3fe144c", "html_url": "https://github.com/Rust-GCC/gccrs/commit/b4661bfe214bf5ae119c511f994336ccc3fe144c"}], "stats": {"total": 72, "additions": 58, "deletions": 14}, "files": [{"sha": "fd47591c8bb6955264b7fc756ad7294fa39ebb2f", "filename": "libstdc++-v3/ChangeLog", "status": "modified", "additions": 10, "deletions": 0, "changes": 10, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/885e812159dcbf83f790eee9d839f91daa553eb3/libstdc%2B%2B-v3%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/885e812159dcbf83f790eee9d839f91daa553eb3/libstdc%2B%2B-v3%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libstdc%2B%2B-v3%2FChangeLog?ref=885e812159dcbf83f790eee9d839f91daa553eb3", "patch": "@@ -1,3 +1,13 @@\n+2012-09-08  Jonathan Wakely  <jwakely.gcc@gmail.com>\n+\n+\tPR libstdc++/54388\n+\t* include/std/array (array::at() const): Ensure lvalue result.\n+\t* testsuite/23_containers/array/element_access/54388.cc: New.\n+\t* testsuite/23_containers/array/tuple_interface/get_neg.cc: Adjust\n+\tdg-error line numbers.\n+\t* testsuite/23_containers/array/tuple_interface/tuple_element_neg.cc:\n+\tLikewise.\n+\n 2012-09-09  Ulrich Drepper  <drepper@gmail.com>\n \t    Dominique d'Humieres  <dominiq@lps.ens.fr>\n \t    Jack Howarth  <howarth@bromo.med.uc.edu>"}, {"sha": "4ee21998b01476fec4bc110815f9292ab3239225", "filename": "libstdc++-v3/include/std/array", "status": "modified", "additions": 4, "deletions": 12, "changes": 16, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/885e812159dcbf83f790eee9d839f91daa553eb3/libstdc%2B%2B-v3%2Finclude%2Fstd%2Farray", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/885e812159dcbf83f790eee9d839f91daa553eb3/libstdc%2B%2B-v3%2Finclude%2Fstd%2Farray", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libstdc%2B%2B-v3%2Finclude%2Fstd%2Farray?ref=885e812159dcbf83f790eee9d839f91daa553eb3", "patch": "@@ -164,22 +164,14 @@ _GLIBCXX_BEGIN_NAMESPACE_VERSION\n \treturn _M_instance[__n];\n       }\n \n-#ifdef __EXCEPTIONS\n       constexpr const_reference\n       at(size_type __n) const\n       {\n-\treturn __n < _Nm ? \n-\t       _M_instance[__n] : throw out_of_range(__N(\"array::at\"));\n+\t// Result of conditional expression must be an lvalue so use\n+\t// boolean ? lvalue : (throw-expr, lvalue)\n+\treturn __n < _Nm ? _M_instance[__n]\n+\t  : (std::__throw_out_of_range(__N(\"array::at\")), _M_instance[0]);\n       }\n-#else\n-      const_reference\n-      at(size_type __n) const\n-      {\n-\tif (__n >= _Nm)\n-\t  std::__throw_out_of_range(__N(\"array::at\"));\n-\treturn _M_instance[__n];\n-      }\n-#endif\n \n       reference \n       front()"}, {"sha": "a69a5edb6a054e725fe88af79b96bb3471b04aac", "filename": "libstdc++-v3/testsuite/23_containers/array/element_access/54388.cc", "status": "added", "additions": 42, "deletions": 0, "changes": 42, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/885e812159dcbf83f790eee9d839f91daa553eb3/libstdc%2B%2B-v3%2Ftestsuite%2F23_containers%2Farray%2Felement_access%2F54388.cc", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/885e812159dcbf83f790eee9d839f91daa553eb3/libstdc%2B%2B-v3%2Ftestsuite%2F23_containers%2Farray%2Felement_access%2F54388.cc", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libstdc%2B%2B-v3%2Ftestsuite%2F23_containers%2Farray%2Felement_access%2F54388.cc?ref=885e812159dcbf83f790eee9d839f91daa553eb3", "patch": "@@ -0,0 +1,42 @@\n+// { dg-options \"-std=gnu++0x\" }\n+//\n+// Copyright (C) 2012 Free Software Foundation, Inc.\n+//\n+// This file is part of the GNU ISO C++ Library.  This library is free\n+// software; you can redistribute it and/or modify it under the\n+// terms of the GNU General Public License as published by the\n+// Free Software Foundation; either version 3, or (at your option)\n+// any later version.\n+//\n+// This library is distributed in the hope that it will be useful,\n+// but WITHOUT ANY WARRANTY; without even the implied warranty of\n+// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n+// GNU General Public License for more details.\n+//\n+// You should have received a copy of the GNU General Public License along\n+// with this library; see the file COPYING3.  If not see\n+// <http://www.gnu.org/licenses/>.\n+\n+#include <array>\n+#include <testsuite_hooks.h>\n+\n+struct A\n+{\n+  bool valid = true;\n+  ~A() { valid = false; }\n+};\n+\n+void\n+test01()\n+{\n+  bool test __attribute__((unused)) = true;\n+\n+  const std::array<A, 1> a;\n+  const A& aa = a.at(0);\n+  VERIFY(aa.valid);\n+}\n+\n+int main()\n+{\n+  test01();\n+}"}, {"sha": "2fc443edad6b0321015c97d478d8902d7584073b", "filename": "libstdc++-v3/testsuite/23_containers/array/tuple_interface/get_neg.cc", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/885e812159dcbf83f790eee9d839f91daa553eb3/libstdc%2B%2B-v3%2Ftestsuite%2F23_containers%2Farray%2Ftuple_interface%2Fget_neg.cc", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/885e812159dcbf83f790eee9d839f91daa553eb3/libstdc%2B%2B-v3%2Ftestsuite%2F23_containers%2Farray%2Ftuple_interface%2Fget_neg.cc", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libstdc%2B%2B-v3%2Ftestsuite%2F23_containers%2Farray%2Ftuple_interface%2Fget_neg.cc?ref=885e812159dcbf83f790eee9d839f91daa553eb3", "patch": "@@ -29,4 +29,4 @@ int n3 = std::get<1>(ca);\n \n // { dg-error \"static assertion failed\" \"\" { target *-*-* } 275 }\n // { dg-error \"static assertion failed\" \"\" { target *-*-* } 283 }\n-// { dg-error \"static assertion failed\" \"\" { target *-*-* } 291 }\n+// { dg-error \"static assertion failed\" \"\" { target *-*-* } 267 }"}, {"sha": "97938ba669a742cc5d9c95988cb9696ade913cd0", "filename": "libstdc++-v3/testsuite/23_containers/array/tuple_interface/tuple_element_neg.cc", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/885e812159dcbf83f790eee9d839f91daa553eb3/libstdc%2B%2B-v3%2Ftestsuite%2F23_containers%2Farray%2Ftuple_interface%2Ftuple_element_neg.cc", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/885e812159dcbf83f790eee9d839f91daa553eb3/libstdc%2B%2B-v3%2Ftestsuite%2F23_containers%2Farray%2Ftuple_interface%2Ftuple_element_neg.cc", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libstdc%2B%2B-v3%2Ftestsuite%2F23_containers%2Farray%2Ftuple_interface%2Ftuple_element_neg.cc?ref=885e812159dcbf83f790eee9d839f91daa553eb3", "patch": "@@ -22,4 +22,4 @@\n \n typedef std::tuple_element<1, std::array<int, 1>>::type type;\n \n-// { dg-error \"static assertion failed\" \"\" { target *-*-* } 267 }\n+// { dg-error \"static assertion failed\" \"\" { target *-*-* } 259 }"}]}