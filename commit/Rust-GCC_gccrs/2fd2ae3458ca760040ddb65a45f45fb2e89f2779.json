{"sha": "2fd2ae3458ca760040ddb65a45f45fb2e89f2779", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6MmZkMmFlMzQ1OGNhNzYwMDQwZGRiNjVhNDVmNDVmYjJlODlmMjc3OQ==", "commit": {"author": {"name": "Richard Biener", "email": "rguenther@suse.de", "date": "2015-01-20T13:26:19Z"}, "committer": {"name": "Richard Biener", "email": "rguenth@gcc.gnu.org", "date": "2015-01-20T13:26:19Z"}, "message": "re PR lto/64684 (wrong code by LTO on x86_64-linux-gnu)\n\n2015-01-20  Richard Biener  <rguenther@suse.de>\n\n\tPR ipa/64684\n\t* ipa-reference.c (add_static_var): Inline ...\n\t(analyze_function): ... here after splitting out from ...\n\t(is_proper_for_analysis): ... this.\n\n\t* gcc.dg/lto/pr64684_0.c: New testcase.\n\t* gcc.dg/lto/pr64684_1.c: Likewise.\n\t* gcc.dg/lto/pr64684_2.c: Likewise.\n\t* gcc.dg/lto/pr64685_0.c: Likewise.\n\t* gcc.dg/lto/pr64685_1.c: Likewise.\n\nFrom-SVN: r219892", "tree": {"sha": "af742886d1ebe018b2c605867c7bda3ec915fc88", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/af742886d1ebe018b2c605867c7bda3ec915fc88"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/2fd2ae3458ca760040ddb65a45f45fb2e89f2779", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/2fd2ae3458ca760040ddb65a45f45fb2e89f2779", "html_url": "https://github.com/Rust-GCC/gccrs/commit/2fd2ae3458ca760040ddb65a45f45fb2e89f2779", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/2fd2ae3458ca760040ddb65a45f45fb2e89f2779/comments", "author": {"login": "rguenth", "id": 2046526, "node_id": "MDQ6VXNlcjIwNDY1MjY=", "avatar_url": "https://avatars.githubusercontent.com/u/2046526?v=4", "gravatar_id": "", "url": "https://api.github.com/users/rguenth", "html_url": "https://github.com/rguenth", "followers_url": "https://api.github.com/users/rguenth/followers", "following_url": "https://api.github.com/users/rguenth/following{/other_user}", "gists_url": "https://api.github.com/users/rguenth/gists{/gist_id}", "starred_url": "https://api.github.com/users/rguenth/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/rguenth/subscriptions", "organizations_url": "https://api.github.com/users/rguenth/orgs", "repos_url": "https://api.github.com/users/rguenth/repos", "events_url": "https://api.github.com/users/rguenth/events{/privacy}", "received_events_url": "https://api.github.com/users/rguenth/received_events", "type": "User", "site_admin": false}, "committer": null, "parents": [{"sha": "7d56e747e271356ccaecfa2adbf2516c0c316649", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/7d56e747e271356ccaecfa2adbf2516c0c316649", "html_url": "https://github.com/Rust-GCC/gccrs/commit/7d56e747e271356ccaecfa2adbf2516c0c316649"}], "stats": {"total": 121, "additions": 100, "deletions": 21}, "files": [{"sha": "763f105f6ba658a42d1bd280c167b744541d019a", "filename": "gcc/ChangeLog", "status": "modified", "additions": 7, "deletions": 0, "changes": 7, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/2fd2ae3458ca760040ddb65a45f45fb2e89f2779/gcc%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/2fd2ae3458ca760040ddb65a45f45fb2e89f2779/gcc%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2FChangeLog?ref=2fd2ae3458ca760040ddb65a45f45fb2e89f2779", "patch": "@@ -1,3 +1,10 @@\n+2015-01-20  Richard Biener  <rguenther@suse.de>\n+\n+\tPR ipa/64684\n+\t* ipa-reference.c (add_static_var): Inline ...\n+\t(analyze_function): ... here after splitting out from ...\n+\t(is_proper_for_analysis): ... this.\n+\n 2015-01-20  Matthew Wahab  <matthew.wahab@arm.com>\n \n \tPR target/64149"}, {"sha": "5f43a02a1e182b71f7c14befd11e0d4a6f4c127e", "filename": "gcc/ipa-reference.c", "status": "modified", "additions": 9, "deletions": 21, "changes": 30, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/2fd2ae3458ca760040ddb65a45f45fb2e89f2779/gcc%2Fipa-reference.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/2fd2ae3458ca760040ddb65a45f45fb2e89f2779/gcc%2Fipa-reference.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fipa-reference.c?ref=2fd2ae3458ca760040ddb65a45f45fb2e89f2779", "patch": "@@ -236,21 +236,6 @@ ipa_reference_get_not_written_global (struct cgraph_node *fn)\n }\n \n \f\n-\n-/* Add VAR to all_module_statics and the two\n-   reference_vars_to_consider* sets.  */\n-\n-static inline void\n-add_static_var (tree var)\n-{\n-  int uid = DECL_UID (var);\n-  gcc_assert (TREE_CODE (var) == VAR_DECL);\n-  if (dump_file)\n-    splay_tree_insert (reference_vars_to_consider,\n-\t\t       uid, (splay_tree_value)var);\n-  bitmap_set_bit (all_module_statics, uid);\n-}\n-\n /* Return true if the variable T is the right kind of static variable to\n    perform compilation unit scope escape analysis.  */\n \n@@ -285,12 +270,6 @@ is_proper_for_analysis (tree t)\n   if (bitmap_bit_p (ignore_module_statics, DECL_UID (t)))\n     return false;\n \n-  /* This is a variable we care about.  Check if we have seen it\n-     before, and if not add it the set of variables we care about.  */\n-  if (all_module_statics\n-      && !bitmap_bit_p (all_module_statics, DECL_UID (t)))\n-    add_static_var (t);\n-\n   return true;\n }\n \n@@ -497,6 +476,15 @@ analyze_function (struct cgraph_node *fn)\n       var = ref->referred->decl;\n       if (!is_proper_for_analysis (var))\n \tcontinue;\n+      /* This is a variable we care about.  Check if we have seen it\n+\t before, and if not add it the set of variables we care about.  */\n+      if (all_module_statics\n+\t  && bitmap_set_bit (all_module_statics, DECL_UID (var)))\n+\t{\n+\t  if (dump_file)\n+\t    splay_tree_insert (reference_vars_to_consider,\n+\t\t\t       DECL_UID (var), (splay_tree_value)var);\n+\t}\n       switch (ref->use)\n \t{\n \tcase IPA_REF_LOAD:"}, {"sha": "1049e672c0fa7ed8ca9179b43284068919cc45b2", "filename": "gcc/testsuite/ChangeLog", "status": "modified", "additions": 9, "deletions": 0, "changes": 9, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/2fd2ae3458ca760040ddb65a45f45fb2e89f2779/gcc%2Ftestsuite%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/2fd2ae3458ca760040ddb65a45f45fb2e89f2779/gcc%2Ftestsuite%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2FChangeLog?ref=2fd2ae3458ca760040ddb65a45f45fb2e89f2779", "patch": "@@ -1,3 +1,12 @@\n+2015-01-20  Richard Biener  <rguenther@suse.de>\n+\n+\tPR ipa/64684\n+\t* gcc.dg/lto/pr64684_0.c: New testcase.\n+\t* gcc.dg/lto/pr64684_1.c: Likewise.\n+\t* gcc.dg/lto/pr64684_2.c: Likewise.\n+\t* gcc.dg/lto/pr64685_0.c: Likewise.\n+\t* gcc.dg/lto/pr64685_1.c: Likewise.\n+\n 2015-01-20  Paolo Carlini  <paolo.carlini@oracle.com>\n \n \tPR c++/62241"}, {"sha": "89883504d20824b66d452a5d8aa81a8126862453", "filename": "gcc/testsuite/gcc.dg/lto/pr64684_0.c", "status": "added", "additions": 13, "deletions": 0, "changes": 13, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/2fd2ae3458ca760040ddb65a45f45fb2e89f2779/gcc%2Ftestsuite%2Fgcc.dg%2Flto%2Fpr64684_0.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/2fd2ae3458ca760040ddb65a45f45fb2e89f2779/gcc%2Ftestsuite%2Fgcc.dg%2Flto%2Fpr64684_0.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgcc.dg%2Flto%2Fpr64684_0.c?ref=2fd2ae3458ca760040ddb65a45f45fb2e89f2779", "patch": "@@ -0,0 +1,13 @@\n+/* { dg-lto-do run } */\n+/* { dg-lto-options { { -O1 -flto } } } */\n+\n+extern void fn2 (void);\n+extern int a;\n+\n+void\n+fn1 ()\n+{\n+  a = -1;\n+  fn2 ();\n+  a &= 1;\n+}"}, {"sha": "f65af2dcf8b51d6f8836c9c93be752e5351de602", "filename": "gcc/testsuite/gcc.dg/lto/pr64684_1.c", "status": "added", "additions": 9, "deletions": 0, "changes": 9, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/2fd2ae3458ca760040ddb65a45f45fb2e89f2779/gcc%2Ftestsuite%2Fgcc.dg%2Flto%2Fpr64684_1.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/2fd2ae3458ca760040ddb65a45f45fb2e89f2779/gcc%2Ftestsuite%2Fgcc.dg%2Flto%2Fpr64684_1.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgcc.dg%2Flto%2Fpr64684_1.c?ref=2fd2ae3458ca760040ddb65a45f45fb2e89f2779", "patch": "@@ -0,0 +1,9 @@\n+/* { dg-options \"-Os\" } */\n+\n+extern int a;\n+\n+void\n+fn2 (void)\n+{\n+  a = 0;\n+}"}, {"sha": "fe077c313ccdb0ca51735ce02bf4eb0f4b19498c", "filename": "gcc/testsuite/gcc.dg/lto/pr64684_2.c", "status": "added", "additions": 16, "deletions": 0, "changes": 16, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/2fd2ae3458ca760040ddb65a45f45fb2e89f2779/gcc%2Ftestsuite%2Fgcc.dg%2Flto%2Fpr64684_2.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/2fd2ae3458ca760040ddb65a45f45fb2e89f2779/gcc%2Ftestsuite%2Fgcc.dg%2Flto%2Fpr64684_2.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgcc.dg%2Flto%2Fpr64684_2.c?ref=2fd2ae3458ca760040ddb65a45f45fb2e89f2779", "patch": "@@ -0,0 +1,16 @@\n+/* { dg-options \"-O0\" } */\n+\n+extern void fn1 (void);\n+\n+int a;\n+\n+int\n+main ()\n+{\n+  fn1 ();\n+\n+  if (a != 0) \n+    __builtin_abort (); \n+\n+  return 0;\n+}"}, {"sha": "6ebc9eaa1632bef98ed0d241f79be8271a312eaa", "filename": "gcc/testsuite/gcc.dg/lto/pr64685_0.c", "status": "added", "additions": 10, "deletions": 0, "changes": 10, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/2fd2ae3458ca760040ddb65a45f45fb2e89f2779/gcc%2Ftestsuite%2Fgcc.dg%2Flto%2Fpr64685_0.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/2fd2ae3458ca760040ddb65a45f45fb2e89f2779/gcc%2Ftestsuite%2Fgcc.dg%2Flto%2Fpr64685_0.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgcc.dg%2Flto%2Fpr64685_0.c?ref=2fd2ae3458ca760040ddb65a45f45fb2e89f2779", "patch": "@@ -0,0 +1,10 @@\n+/* { dg-lto-do run } */\n+/* { dg-lto-options { { -flto } } } */\n+\n+extern int b;\n+\n+void\n+fn1 (void)\n+{\n+    b = 0;\n+}"}, {"sha": "38022d31d835c0ebbbba94314fb7b31243597cbe", "filename": "gcc/testsuite/gcc.dg/lto/pr64685_1.c", "status": "added", "additions": 27, "deletions": 0, "changes": 27, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/2fd2ae3458ca760040ddb65a45f45fb2e89f2779/gcc%2Ftestsuite%2Fgcc.dg%2Flto%2Fpr64685_1.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/2fd2ae3458ca760040ddb65a45f45fb2e89f2779/gcc%2Ftestsuite%2Fgcc.dg%2Flto%2Fpr64685_1.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgcc.dg%2Flto%2Fpr64685_1.c?ref=2fd2ae3458ca760040ddb65a45f45fb2e89f2779", "patch": "@@ -0,0 +1,27 @@\n+/* { dg-options \"-O1\" } */\n+\n+extern void fn1 (void); \n+\n+int a[2], b;\n+\n+static void\n+foo (int p)\n+{\n+  b = 1 ^ a[(b ^ 1) & 1];\n+  b = 1 ^ a[b & 1];\n+  if (p)\n+    __builtin_abort ();\n+}\n+\n+int\n+main ()\n+{\n+  foo (0);\n+  b = 0;\n+  foo (0);\n+\n+  if (b != 1)\n+    __builtin_abort ();\n+\n+  return 0;\n+}"}]}