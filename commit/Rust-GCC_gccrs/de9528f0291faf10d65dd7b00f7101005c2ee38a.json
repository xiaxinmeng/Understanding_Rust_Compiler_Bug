{"sha": "de9528f0291faf10d65dd7b00f7101005c2ee38a", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6ZGU5NTI4ZjAyOTFmYWYxMGQ2NWRkN2IwMGY3MTAxMDA1YzJlZTM4YQ==", "commit": {"author": {"name": "Eric Botcazou", "email": "ebotcazou@adacore.com", "date": "2011-04-02T09:20:38Z"}, "committer": {"name": "Eric Botcazou", "email": "ebotcazou@gcc.gnu.org", "date": "2011-04-02T09:20:38Z"}, "message": "utils.c (update_pointer_to): Finalize named pointer types.\n\n\t* gcc-interface/utils.c (update_pointer_to): Finalize named pointer\n\ttypes.\n\nFrom-SVN: r171887", "tree": {"sha": "fe3e25770758003527c12bdff72d889d7d5ccae0", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/fe3e25770758003527c12bdff72d889d7d5ccae0"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/de9528f0291faf10d65dd7b00f7101005c2ee38a", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/de9528f0291faf10d65dd7b00f7101005c2ee38a", "html_url": "https://github.com/Rust-GCC/gccrs/commit/de9528f0291faf10d65dd7b00f7101005c2ee38a", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/de9528f0291faf10d65dd7b00f7101005c2ee38a/comments", "author": null, "committer": null, "parents": [{"sha": "d9d7a26cf1ad153c2185a8d0d01f11ef60ce321b", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/d9d7a26cf1ad153c2185a8d0d01f11ef60ce321b", "html_url": "https://github.com/Rust-GCC/gccrs/commit/d9d7a26cf1ad153c2185a8d0d01f11ef60ce321b"}], "stats": {"total": 122, "additions": 120, "deletions": 2}, "files": [{"sha": "2a1eba4a9e0160ca73be71c903f0f282c59c08c5", "filename": "gcc/ada/ChangeLog", "status": "modified", "additions": 6, "deletions": 1, "changes": 7, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/de9528f0291faf10d65dd7b00f7101005c2ee38a/gcc%2Fada%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/de9528f0291faf10d65dd7b00f7101005c2ee38a/gcc%2Fada%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fada%2FChangeLog?ref=de9528f0291faf10d65dd7b00f7101005c2ee38a", "patch": "@@ -1,8 +1,13 @@\n+2011-04-02  Eric Botcazou  <ebotcazou@adacore.com>\n+\n+\t* gcc-interface/utils.c (update_pointer_to): Finalize named pointer\n+\ttypes.\n+\n 2011-04-02  Eric Botcazou  <ebotcazou@adacore.com>\n \n \t* gcc-interface/lang.opt (feliminate-unused-debug-types): Delete.\n \t* gcc-interface/misc.c (gnat_handle_option): Remove special handling\n-\tcode for -feliminate-unused-debug-types\n+\tcode for -feliminate-unused-debug-types.\n \t(gnat_post_options): Likewise.\n \n 2011-04-02  Eric Botcazou  <ebotcazou@adacore.com>"}, {"sha": "dc743740cfee8356ee2e311c9c06ca5a1bdc987c", "filename": "gcc/ada/gcc-interface/utils.c", "status": "modified", "additions": 8, "deletions": 1, "changes": 9, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/de9528f0291faf10d65dd7b00f7101005c2ee38a/gcc%2Fada%2Fgcc-interface%2Futils.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/de9528f0291faf10d65dd7b00f7101005c2ee38a/gcc%2Fada%2Fgcc-interface%2Futils.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fada%2Fgcc-interface%2Futils.c?ref=de9528f0291faf10d65dd7b00f7101005c2ee38a", "patch": "@@ -3559,7 +3559,12 @@ update_pointer_to (tree old_type, tree new_type)\n       for (; ptr; ptr = TYPE_NEXT_PTR_TO (ptr))\n \tfor (t = TYPE_MAIN_VARIANT (ptr); t; t = TYPE_NEXT_VARIANT (t))\n \t  TREE_TYPE (t) = new_type;\n-      TYPE_POINTER_TO (old_type) = NULL_TREE;\n+\n+      /* If we have adjusted named types, finalize them.  This is necessary\n+\t since we had forced a DWARF typedef for them in gnat_pushdecl.  */\n+      for (ptr = TYPE_POINTER_TO (old_type); ptr; ptr = TYPE_NEXT_PTR_TO (ptr))\n+\tif (TYPE_NAME (ptr) && TREE_CODE (TYPE_NAME (ptr)) == TYPE_DECL)\n+\t  rest_of_type_decl_compilation (TYPE_NAME (ptr));\n \n       /* Chain REF and its variants at the end.  */\n       new_ref = TYPE_REFERENCE_TO (new_type);\n@@ -3576,6 +3581,8 @@ update_pointer_to (tree old_type, tree new_type)\n       for (; ref; ref = TYPE_NEXT_REF_TO (ref))\n \tfor (t = TYPE_MAIN_VARIANT (ref); t; t = TYPE_NEXT_VARIANT (t))\n \t  TREE_TYPE (t) = new_type;\n+\n+      TYPE_POINTER_TO (old_type) = NULL_TREE;\n       TYPE_REFERENCE_TO (old_type) = NULL_TREE;\n     }\n "}, {"sha": "7f19c13ece114297cc09bc141e7b5b6af6249b1b", "filename": "gcc/testsuite/ChangeLog", "status": "modified", "additions": 6, "deletions": 0, "changes": 6, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/de9528f0291faf10d65dd7b00f7101005c2ee38a/gcc%2Ftestsuite%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/de9528f0291faf10d65dd7b00f7101005c2ee38a/gcc%2Ftestsuite%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2FChangeLog?ref=de9528f0291faf10d65dd7b00f7101005c2ee38a", "patch": "@@ -1,3 +1,9 @@\n+2011-04-02  Eric Botcazou  <ebotcazou@adacore.com>\n+\n+\t* gnat.dg/debug2.ad[sb]: New test.\n+\t* gnat.dg/debug2_pkg.ads: New helper.\n+\t* gnat.dg/debug3.ad[sb]: New test.\n+\n 2011-04-01  Uros Bizjak  <ubizjak@gmail.com>\n \n \t* go.test/go-test.exp (go-set-goarch): Recognize alpha*-*-*."}, {"sha": "f962243d6c3913554f85bf75535a93c97abf9cdc", "filename": "gcc/testsuite/gnat.dg/debug2.adb", "status": "added", "additions": 40, "deletions": 0, "changes": 40, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/de9528f0291faf10d65dd7b00f7101005c2ee38a/gcc%2Ftestsuite%2Fgnat.dg%2Fdebug2.adb", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/de9528f0291faf10d65dd7b00f7101005c2ee38a/gcc%2Ftestsuite%2Fgnat.dg%2Fdebug2.adb", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgnat.dg%2Fdebug2.adb?ref=de9528f0291faf10d65dd7b00f7101005c2ee38a", "patch": "@@ -0,0 +1,40 @@\n+-- { dg-do compile }\n+-- { dg-options \"-g\" }\n+\n+with Debug2_Pkg; use Debug2_Pkg;\n+\n+package body Debug2 is\n+\n+    procedure Proc is\n+\n+        function F return String_List_Ptr is\n+        begin\n+            return new String_List'(Singleton);\n+        end;\n+\n+        A : String_List_Ptr := F;\n+\n+    begin\n+        null;\n+    end;\n+\n+    function Get return Integer is\n+    begin\n+        return 0;\n+    end;\n+\n+    Failed : exception;\n+\n+    A: String_Ptr;\n+\n+begin\n+\n+    declare\n+        Server_Args : Integer;\n+    begin\n+        Server_Args := Get;\n+    exception\n+        when X : Failed => A := To_Heap;\n+    end;\n+\n+end Debug2;"}, {"sha": "dbdf5346dec4770e8591bdd68d970a133cbb902c", "filename": "gcc/testsuite/gnat.dg/debug2.ads", "status": "added", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/de9528f0291faf10d65dd7b00f7101005c2ee38a/gcc%2Ftestsuite%2Fgnat.dg%2Fdebug2.ads", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/de9528f0291faf10d65dd7b00f7101005c2ee38a/gcc%2Ftestsuite%2Fgnat.dg%2Fdebug2.ads", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgnat.dg%2Fdebug2.ads?ref=de9528f0291faf10d65dd7b00f7101005c2ee38a", "patch": "@@ -0,0 +1,5 @@\n+package Debug2 is\n+\n+    procedure Proc;\n+\n+end Debug2;"}, {"sha": "fc68249b8217ef310851f9f989a637d5a9d1896b", "filename": "gcc/testsuite/gnat.dg/debug2_pkg.ads", "status": "added", "additions": 19, "deletions": 0, "changes": 19, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/de9528f0291faf10d65dd7b00f7101005c2ee38a/gcc%2Ftestsuite%2Fgnat.dg%2Fdebug2_pkg.ads", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/de9528f0291faf10d65dd7b00f7101005c2ee38a/gcc%2Ftestsuite%2Fgnat.dg%2Fdebug2_pkg.ads", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgnat.dg%2Fdebug2_pkg.ads?ref=de9528f0291faf10d65dd7b00f7101005c2ee38a", "patch": "@@ -0,0 +1,19 @@\n+package Debug2_Pkg is\n+\n+    type String_Ptr is access all String;\n+\n+    function To_Heap return String_Ptr;\n+\n+    type String_List(Chars_Length: Positive) is private;\n+\n+    type String_List_Ptr is access constant String_List;\n+\n+    function Singleton return String_List;\n+\n+private\n+\n+    type String_List(Chars_Length: Positive) is record\n+        Chars: String(1..Chars_Length);\n+    end record;\n+\n+end Debug2_Pkg;"}, {"sha": "6ed6b1a3d5a9d4ffbce0c3e95c2b7bafe7f5a6d6", "filename": "gcc/testsuite/gnat.dg/debug3.adb", "status": "added", "additions": 31, "deletions": 0, "changes": 31, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/de9528f0291faf10d65dd7b00f7101005c2ee38a/gcc%2Ftestsuite%2Fgnat.dg%2Fdebug3.adb", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/de9528f0291faf10d65dd7b00f7101005c2ee38a/gcc%2Ftestsuite%2Fgnat.dg%2Fdebug3.adb", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgnat.dg%2Fdebug3.adb?ref=de9528f0291faf10d65dd7b00f7101005c2ee38a", "patch": "@@ -0,0 +1,31 @@\n+-- { dg-do compile }\n+-- { dg-options \"-g\" }\n+\n+with Ada.Unchecked_Conversion;\n+with System;\n+\n+package body Debug3 is\n+\n+  type Rec is record\n+     I : Integer;\n+  end record;\n+  for Rec'Alignment use 1;\n+\n+  type Ptr is access Rec;\n+\n+  function To_Ptr is new Ada.Unchecked_Conversion(System.Address, Ptr);\n+\n+  procedure Proc is\n+\n+    function Get (S1 : String) return Ptr is\n+    begin\n+       return To_Ptr (S1'Address);\n+    end;\n+\n+    M : Ptr;\n+\n+    begin\n+      M := Get (\"\");\n+    end;\n+\n+end Debug3;"}, {"sha": "89d57cb62f1c97ca5a2ab57ccc24f181cdec2270", "filename": "gcc/testsuite/gnat.dg/debug3.ads", "status": "added", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/de9528f0291faf10d65dd7b00f7101005c2ee38a/gcc%2Ftestsuite%2Fgnat.dg%2Fdebug3.ads", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/de9528f0291faf10d65dd7b00f7101005c2ee38a/gcc%2Ftestsuite%2Fgnat.dg%2Fdebug3.ads", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgnat.dg%2Fdebug3.ads?ref=de9528f0291faf10d65dd7b00f7101005c2ee38a", "patch": "@@ -0,0 +1,5 @@\n+package Debug3 is\n+\n+  procedure Proc;\n+\n+end Debug3;"}]}