{"sha": "31226750a1cdf4542f402adc097aaae0bb988c33", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6MzEyMjY3NTBhMWNkZjQ1NDJmNDAyYWRjMDk3YWFhZTBiYjk4OGMzMw==", "commit": {"author": {"name": "Caroline Tice", "email": "cmtice@google.com", "date": "2013-12-06T21:22:14Z"}, "committer": {"name": "Caroline Tice", "email": "ctice@gcc.gnu.org", "date": "2013-12-06T21:22:14Z"}, "message": "Fix two small problems...\n\nFix two small problems: Make the libvtv function\ndecls globally visible, and update all uses of the\nverified vtable poitner with the verification results,\nrather than just hte first use.\n\nFrom-SVN: r205764", "tree": {"sha": "61aeffc1a983c7f43bfe016b023a8fe91fe023ed", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/61aeffc1a983c7f43bfe016b023a8fe91fe023ed"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/31226750a1cdf4542f402adc097aaae0bb988c33", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/31226750a1cdf4542f402adc097aaae0bb988c33", "html_url": "https://github.com/Rust-GCC/gccrs/commit/31226750a1cdf4542f402adc097aaae0bb988c33", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/31226750a1cdf4542f402adc097aaae0bb988c33/comments", "author": {"login": "cmtice", "id": 5561162, "node_id": "MDQ6VXNlcjU1NjExNjI=", "avatar_url": "https://avatars.githubusercontent.com/u/5561162?v=4", "gravatar_id": "", "url": "https://api.github.com/users/cmtice", "html_url": "https://github.com/cmtice", "followers_url": "https://api.github.com/users/cmtice/followers", "following_url": "https://api.github.com/users/cmtice/following{/other_user}", "gists_url": "https://api.github.com/users/cmtice/gists{/gist_id}", "starred_url": "https://api.github.com/users/cmtice/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/cmtice/subscriptions", "organizations_url": "https://api.github.com/users/cmtice/orgs", "repos_url": "https://api.github.com/users/cmtice/repos", "events_url": "https://api.github.com/users/cmtice/events{/privacy}", "received_events_url": "https://api.github.com/users/cmtice/received_events", "type": "User", "site_admin": false}, "committer": null, "parents": [{"sha": "cd93c60e35410dad9df0f21b8e1d2825f49b9386", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/cd93c60e35410dad9df0f21b8e1d2825f49b9386", "html_url": "https://github.com/Rust-GCC/gccrs/commit/cd93c60e35410dad9df0f21b8e1d2825f49b9386"}], "stats": {"total": 52, "additions": 28, "deletions": 24}, "files": [{"sha": "5fddf41caf18d026dcc1aaf1f0c21f2587827fc3", "filename": "gcc/ChangeLog", "status": "modified", "additions": 7, "deletions": 0, "changes": 7, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/31226750a1cdf4542f402adc097aaae0bb988c33/gcc%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/31226750a1cdf4542f402adc097aaae0bb988c33/gcc%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2FChangeLog?ref=31226750a1cdf4542f402adc097aaae0bb988c33", "patch": "@@ -1,3 +1,10 @@\n+2013-12-06  Caroline Tice  <cmtice@google.com>\n+\n+\tSubmitting patch from Stephen Checkoway, s@cs.jhu.edu\n+\t* vtable-verify.c (verify_bb_vtables): Replace all uses of verified\n+\tvtable pointer with the results of the verification call, rather than\n+\tonly the uses in the next statement.\n+\n 2013-12-06  Andrew Pinski  <apinski@cavium.com>\n \n \tPR target/59092"}, {"sha": "dd33b05945f0b2c4e05dc5abb292062587185411", "filename": "gcc/cp/ChangeLog", "status": "modified", "additions": 6, "deletions": 0, "changes": 6, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/31226750a1cdf4542f402adc097aaae0bb988c33/gcc%2Fcp%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/31226750a1cdf4542f402adc097aaae0bb988c33/gcc%2Fcp%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fcp%2FChangeLog?ref=31226750a1cdf4542f402adc097aaae0bb988c33", "patch": "@@ -1,3 +1,9 @@\n+2013-12-06  Caroline Tice  <cmtice@google.com>\n+\n+\tSubmitting patch from Stephen Checkoway, s@cs.jhu.edu\n+\t* vtable-class-hierarchy.c (init_functions): Make the libvtv\n+\tfunction decls externally visible.\n+\n 2013-12-06  Oleg Endo  <olegendo@gcc.gnu.org>\n \n \t* decl2.c: Remove struct tags when referring to class varpool_node."}, {"sha": "4eb78eee4be733fa71fb786ebb9af8d1e30723c9", "filename": "gcc/cp/vtable-class-hierarchy.c", "status": "modified", "additions": 2, "deletions": 0, "changes": 2, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/31226750a1cdf4542f402adc097aaae0bb988c33/gcc%2Fcp%2Fvtable-class-hierarchy.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/31226750a1cdf4542f402adc097aaae0bb988c33/gcc%2Fcp%2Fvtable-class-hierarchy.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fcp%2Fvtable-class-hierarchy.c?ref=31226750a1cdf4542f402adc097aaae0bb988c33", "patch": "@@ -258,6 +258,7 @@ init_functions (void)\n   DECL_ATTRIBUTES (vlt_register_set_fndecl) =\n                     tree_cons (get_identifier (\"leaf\"), NULL,\n                                DECL_ATTRIBUTES (vlt_register_set_fndecl));\n+  DECL_EXTERNAL(vlt_register_set_fndecl) = 1;\n   TREE_PUBLIC (vlt_register_set_fndecl) = 1;\n   DECL_PRESERVE_P (vlt_register_set_fndecl) = 1;\n   SET_DECL_LANGUAGE (vlt_register_set_fndecl, lang_cplusplus);\n@@ -301,6 +302,7 @@ init_functions (void)\n   DECL_ATTRIBUTES (vlt_register_pairs_fndecl) =\n                     tree_cons (get_identifier (\"leaf\"), NULL,\n                                DECL_ATTRIBUTES (vlt_register_pairs_fndecl));\n+  DECL_EXTERNAL(vlt_register_pairs_fndecl) = 1;\n   TREE_PUBLIC (vlt_register_pairs_fndecl) = 1;\n   DECL_PRESERVE_P (vlt_register_pairs_fndecl) = 1;\n   SET_DECL_LANGUAGE (vlt_register_pairs_fndecl, lang_cplusplus);"}, {"sha": "b54469517cd29a48e8e3b39a52906b27e4c70b7f", "filename": "gcc/vtable-verify.c", "status": "modified", "additions": 13, "deletions": 24, "changes": 37, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/31226750a1cdf4542f402adc097aaae0bb988c33/gcc%2Fvtable-verify.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/31226750a1cdf4542f402adc097aaae0bb988c33/gcc%2Fvtable-verify.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fvtable-verify.c?ref=31226750a1cdf4542f402adc097aaae0bb988c33", "patch": "@@ -646,9 +646,6 @@ verify_bb_vtables (basic_block bb)\n \n               if (vtable_map_node && vtable_map_node->vtbl_map_decl)\n                 {\n-                  use_operand_p use_p;\n-                  ssa_op_iter iter;\n-\n                   vtable_map_node->is_used = true;\n                   vtbl_var_decl = vtable_map_node->vtbl_map_decl;\n \n@@ -695,35 +692,27 @@ verify_bb_vtables (basic_block bb)\n                   gimple_call_set_lhs (call_stmt, tmp0);\n                   update_stmt (call_stmt);\n \n-                  /* Find the next stmt, after the vptr assignment\n-                     statememt, which should use the result of the\n-                     vptr assignment statement value. */\n-                  gsi_next (&gsi_vtbl_assign);\n-                  gimple next_stmt = gsi_stmt (gsi_vtbl_assign);\n-\n-                  if (!next_stmt)\n-                    return;\n-\n-                  /* Find any/all uses of 'lhs' in next_stmt, and\n-                     replace them with 'tmp0'.  */\n+                  /* Replace all uses of lhs with tmp0. */\n                   found = false;\n-                  FOR_EACH_PHI_OR_STMT_USE (use_p, next_stmt, iter,\n-                                            SSA_OP_ALL_USES)\n+                  imm_use_iterator iterator;\n+                  gimple use_stmt;\n+                  FOR_EACH_IMM_USE_STMT (use_stmt, iterator, lhs)\n                     {\n-                      tree op = USE_FROM_PTR (use_p);\n-                      if (op == lhs)\n-                        {\n-                          SET_USE (use_p, tmp0);\n-                          found = true;\n-                        }\n+                      use_operand_p use_p;\n+                      if (use_stmt == call_stmt)\n+                        continue;\n+                      FOR_EACH_IMM_USE_ON_STMT (use_p, iterator)\n+                        SET_USE (use_p, tmp0);\n+                      update_stmt (use_stmt);\n+                      found = true;\n                     }\n-                  update_stmt (next_stmt);\n+\n                   gcc_assert (found);\n \n                   /* Insert the new verification call just after the\n                      statement that gets the vtable pointer out of the\n                      object.  */\n-                  gsi_vtbl_assign = gsi_for_stmt (stmt);\n+                  gcc_assert (gsi_stmt (gsi_vtbl_assign) == stmt);\n                   gsi_insert_after (&gsi_vtbl_assign, call_stmt,\n                                     GSI_NEW_STMT);\n "}]}