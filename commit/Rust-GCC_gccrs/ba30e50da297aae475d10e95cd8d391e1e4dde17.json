{"sha": "ba30e50da297aae475d10e95cd8d391e1e4dde17", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6YmEzMGU1MGRhMjk3YWFlNDc1ZDEwZTk1Y2Q4ZDM5MWUxZTRkZGUxNw==", "commit": {"author": {"name": "Tom de Vries", "email": "tom@codesourcery.com", "date": "2011-10-13T09:54:50Z"}, "committer": {"name": "Tom de Vries", "email": "vries@gcc.gnu.org", "date": "2011-10-13T09:54:50Z"}, "message": "emit-rtl.c (set_mem_attributes_minus_bitpos): Set MEM_READONLY_P for static const strings.\n\n2011-10-13  Tom de Vries  <tom@codesourcery.com>\n\n\t* emit-rtl.c (set_mem_attributes_minus_bitpos): Set MEM_READONLY_P\n\tfor static const strings.\n\t* varasm.c (build_constant_desc): Generate the memory location of the\n\tconstant using gen_const_mem.\n\nFrom-SVN: r179896", "tree": {"sha": "632f11e927fc77c78227669b4d1bc7c536ad109b", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/632f11e927fc77c78227669b4d1bc7c536ad109b"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/ba30e50da297aae475d10e95cd8d391e1e4dde17", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/ba30e50da297aae475d10e95cd8d391e1e4dde17", "html_url": "https://github.com/Rust-GCC/gccrs/commit/ba30e50da297aae475d10e95cd8d391e1e4dde17", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/ba30e50da297aae475d10e95cd8d391e1e4dde17/comments", "author": null, "committer": null, "parents": [{"sha": "6c9fbfa72eea6d4a8689831977bfde2072fc195a", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/6c9fbfa72eea6d4a8689831977bfde2072fc195a", "html_url": "https://github.com/Rust-GCC/gccrs/commit/6c9fbfa72eea6d4a8689831977bfde2072fc195a"}], "stats": {"total": 15, "additions": 14, "deletions": 1}, "files": [{"sha": "c8c7ef8df98d5b81eb5a5abcea5b085254b392f2", "filename": "gcc/ChangeLog", "status": "modified", "additions": 7, "deletions": 0, "changes": 7, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/ba30e50da297aae475d10e95cd8d391e1e4dde17/gcc%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/ba30e50da297aae475d10e95cd8d391e1e4dde17/gcc%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2FChangeLog?ref=ba30e50da297aae475d10e95cd8d391e1e4dde17", "patch": "@@ -1,3 +1,10 @@\n+2011-10-13  Tom de Vries  <tom@codesourcery.com>\n+\n+\t* emit-rtl.c (set_mem_attributes_minus_bitpos): Set MEM_READONLY_P\n+\tfor static const strings.\n+\t* varasm.c (build_constant_desc): Generate the memory location of the\n+\tconstant using gen_const_mem.\n+\n 2011-10-13  Richard Guenther  <rguenther@suse.de>\n \n \tPR tree-optimization/50698"}, {"sha": "8465237da60f7a81f7afecb027a040d1a0eb5436", "filename": "gcc/emit-rtl.c", "status": "modified", "additions": 6, "deletions": 0, "changes": 6, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/ba30e50da297aae475d10e95cd8d391e1e4dde17/gcc%2Femit-rtl.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/ba30e50da297aae475d10e95cd8d391e1e4dde17/gcc%2Femit-rtl.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Femit-rtl.c?ref=ba30e50da297aae475d10e95cd8d391e1e4dde17", "patch": "@@ -1696,6 +1696,12 @@ set_mem_attributes_minus_bitpos (rtx ref, tree t, int objectp,\n \t  && !TREE_THIS_VOLATILE (base))\n \tMEM_READONLY_P (ref) = 1;\n \n+      /* Mark static const strings readonly as well.  */\n+      if (base && TREE_CODE (base) == STRING_CST\n+\t  && TREE_READONLY (base)\n+\t  && TREE_STATIC (base))\n+\tMEM_READONLY_P (ref) = 1;\n+\n       /* If this expression uses it's parent's alias set, mark it such\n \t that we won't change it.  */\n       if (component_uses_parent_alias_set (t))"}, {"sha": "d0de2136bd83dfbb70658872283e8e8adb614080", "filename": "gcc/varasm.c", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/ba30e50da297aae475d10e95cd8d391e1e4dde17/gcc%2Fvarasm.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/ba30e50da297aae475d10e95cd8d391e1e4dde17/gcc%2Fvarasm.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fvarasm.c?ref=ba30e50da297aae475d10e95cd8d391e1e4dde17", "patch": "@@ -3119,7 +3119,7 @@ build_constant_desc (tree exp)\n   SET_SYMBOL_REF_DECL (symbol, decl);\n   TREE_CONSTANT_POOL_ADDRESS_P (symbol) = 1;\n \n-  rtl = gen_rtx_MEM (TYPE_MODE (TREE_TYPE (exp)), symbol);\n+  rtl = gen_const_mem (TYPE_MODE (TREE_TYPE (exp)), symbol);\n   set_mem_attributes (rtl, exp, 1);\n   set_mem_alias_set (rtl, 0);\n   set_mem_alias_set (rtl, const_alias_set);"}]}