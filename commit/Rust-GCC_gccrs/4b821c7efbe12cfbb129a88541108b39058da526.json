{"sha": "4b821c7efbe12cfbb129a88541108b39058da526", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6NGI4MjFjN2VmYmUxMmNmYmIxMjlhODg1NDExMDhiMzkwNThkYTUyNg==", "commit": {"author": {"name": "David Malcolm", "email": "dmalcolm@redhat.com", "date": "2021-08-23T18:09:44Z"}, "committer": {"name": "David Malcolm", "email": "dmalcolm@redhat.com", "date": "2021-08-23T18:09:44Z"}, "message": "analyzer: fix ICE when failing to reconstruct a fn ptr [PR101837]\n\ngcc/analyzer/ChangeLog:\n\tPR analyzer/101837\n\t* analyzer.cc (maybe_reconstruct_from_def_stmt): Bail if fn is\n\tNULL, and assert that it's non-NULL before passing it to\n\tbuild_call_array_loc.\n\ngcc/testsuite/ChangeLog:\n\tPR analyzer/101837\n\t* gcc.dg/analyzer/pr101837.c: New test.", "tree": {"sha": "1b3dd4dccc4e697896cabb6d0c3170e14c0b67fb", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/1b3dd4dccc4e697896cabb6d0c3170e14c0b67fb"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/4b821c7efbe12cfbb129a88541108b39058da526", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/4b821c7efbe12cfbb129a88541108b39058da526", "html_url": "https://github.com/Rust-GCC/gccrs/commit/4b821c7efbe12cfbb129a88541108b39058da526", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/4b821c7efbe12cfbb129a88541108b39058da526/comments", "author": {"login": "davidmalcolm", "id": 1553248, "node_id": "MDQ6VXNlcjE1NTMyNDg=", "avatar_url": "https://avatars.githubusercontent.com/u/1553248?v=4", "gravatar_id": "", "url": "https://api.github.com/users/davidmalcolm", "html_url": "https://github.com/davidmalcolm", "followers_url": "https://api.github.com/users/davidmalcolm/followers", "following_url": "https://api.github.com/users/davidmalcolm/following{/other_user}", "gists_url": "https://api.github.com/users/davidmalcolm/gists{/gist_id}", "starred_url": "https://api.github.com/users/davidmalcolm/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/davidmalcolm/subscriptions", "organizations_url": "https://api.github.com/users/davidmalcolm/orgs", "repos_url": "https://api.github.com/users/davidmalcolm/repos", "events_url": "https://api.github.com/users/davidmalcolm/events{/privacy}", "received_events_url": "https://api.github.com/users/davidmalcolm/received_events", "type": "User", "site_admin": false}, "committer": {"login": "davidmalcolm", "id": 1553248, "node_id": "MDQ6VXNlcjE1NTMyNDg=", "avatar_url": "https://avatars.githubusercontent.com/u/1553248?v=4", "gravatar_id": "", "url": "https://api.github.com/users/davidmalcolm", "html_url": "https://github.com/davidmalcolm", "followers_url": "https://api.github.com/users/davidmalcolm/followers", "following_url": "https://api.github.com/users/davidmalcolm/following{/other_user}", "gists_url": "https://api.github.com/users/davidmalcolm/gists{/gist_id}", "starred_url": "https://api.github.com/users/davidmalcolm/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/davidmalcolm/subscriptions", "organizations_url": "https://api.github.com/users/davidmalcolm/orgs", "repos_url": "https://api.github.com/users/davidmalcolm/repos", "events_url": "https://api.github.com/users/davidmalcolm/events{/privacy}", "received_events_url": "https://api.github.com/users/davidmalcolm/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "e82e0f149b0aba660896ea9aa12c442c07a16d12", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/e82e0f149b0aba660896ea9aa12c442c07a16d12", "html_url": "https://github.com/Rust-GCC/gccrs/commit/e82e0f149b0aba660896ea9aa12c442c07a16d12"}], "stats": {"total": 13, "additions": 13, "deletions": 0}, "files": [{"sha": "f6e9c9d66d2c5ec571e939558f7e22a329f2d757", "filename": "gcc/analyzer/analyzer.cc", "status": "modified", "additions": 3, "deletions": 0, "changes": 3, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/4b821c7efbe12cfbb129a88541108b39058da526/gcc%2Fanalyzer%2Fanalyzer.cc", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/4b821c7efbe12cfbb129a88541108b39058da526/gcc%2Fanalyzer%2Fanalyzer.cc", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fanalyzer%2Fanalyzer.cc?ref=4b821c7efbe12cfbb129a88541108b39058da526", "patch": "@@ -145,6 +145,8 @@ maybe_reconstruct_from_def_stmt (tree ssa_name,\n \ttree return_type = gimple_call_return_type (call_stmt);\n \ttree fn = fixup_tree_for_diagnostic_1 (gimple_call_fn (call_stmt),\n \t\t\t\t\t       visited);\n+\tif (fn == NULL_TREE)\n+\t  return NULL_TREE;\n \tunsigned num_args = gimple_call_num_args (call_stmt);\n \tauto_vec<tree> args (num_args);\n \tfor (unsigned i = 0; i < num_args; i++)\n@@ -155,6 +157,7 @@ maybe_reconstruct_from_def_stmt (tree ssa_name,\n \t      return NULL_TREE;\n \t    args.quick_push (arg);\n \t  }\n+\tgcc_assert (fn);\n \treturn build_call_array_loc (gimple_location (call_stmt),\n \t\t\t\t     return_type, fn,\n \t\t\t\t     num_args, args.address ());"}, {"sha": "f99374df6048056fa4bf3288126c883f66433760", "filename": "gcc/testsuite/gcc.dg/analyzer/pr101837.c", "status": "added", "additions": 10, "deletions": 0, "changes": 10, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/4b821c7efbe12cfbb129a88541108b39058da526/gcc%2Ftestsuite%2Fgcc.dg%2Fanalyzer%2Fpr101837.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/4b821c7efbe12cfbb129a88541108b39058da526/gcc%2Ftestsuite%2Fgcc.dg%2Fanalyzer%2Fpr101837.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgcc.dg%2Fanalyzer%2Fpr101837.c?ref=4b821c7efbe12cfbb129a88541108b39058da526", "patch": "@@ -0,0 +1,10 @@\n+/* { dg-additional-options \"-O3 -fsanitize=undefined\" } */\n+\n+void memory_exhausted();\n+void memcheck(void *ptr) {\n+  if (ptr) /* { dg-warning \"leak\" } */\n+    memory_exhausted();\n+}\n+\n+int emalloc(int size) { memcheck(__builtin_malloc(size)); } /* { dg-message \"allocated here\" } */\n+int main() { int max_envvar_len = emalloc(max_envvar_len + 1); } /* { dg-message \"use of uninitialized value 'max_envvar_len'\" } */"}]}