{"sha": "ff99d05f40fc573ee405f1278f2bc5ac55019bdb", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6ZmY5OWQwNWY0MGZjNTczZWU0MDVmMTI3OGYyYmM1YWM1NTAxOWJkYg==", "commit": {"author": {"name": "Jakub Jelinek", "email": "jakub@redhat.com", "date": "2021-01-12T10:02:16Z"}, "committer": {"name": "Jakub Jelinek", "email": "jakub@redhat.com", "date": "2021-01-12T10:02:16Z"}, "message": "configure, make: Fix up --enable-link-serialization\n\nAs reported by Matthias, --enable-link-serialization=1 can currently start\ntwo concurrent links first (e.g. gnat1 and cc1).\nThe problem is that make var = value values seem to work differently between\ndependencies and actual rules (where it was tested).\nAs the language make fragments can be in different order, we can have:\nada.prev = ... magic that will become $(c.serial) under --enable-link-serialization=1\ngnat1$(exe): ..... $(ada.prev)\n\t...\nc.serial = cc1$(exe)\nand while if I add echo $(ada.prev) in the gnat1 rule's command, it prints\ncc1, the dependencies are actually evaluated during reading of the goal or\nwhen.\nThe configure creates (and puts into Makefile) some serialization order of\nthe languages and in that order c always comes first, and the rest is\nactually sorted the way the all_lang_makefrags are already sorted,\nso just by forcing c/Make-lang.in first we achieve that X.serial variable\nis always defined before some other Y.prev will use it in its goal\ndependencies.\n\n2021-01-12  Jakub Jelinek  <jakub@redhat.com>\n\n\t* configure.ac: Ensure c/Make-lang.in comes first in @all_lang_makefrags@.\n\t* configure: Regenerated.", "tree": {"sha": "399eb04cf68767a35130ec414a1ddc82e24e301e", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/399eb04cf68767a35130ec414a1ddc82e24e301e"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/ff99d05f40fc573ee405f1278f2bc5ac55019bdb", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/ff99d05f40fc573ee405f1278f2bc5ac55019bdb", "html_url": "https://github.com/Rust-GCC/gccrs/commit/ff99d05f40fc573ee405f1278f2bc5ac55019bdb", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/ff99d05f40fc573ee405f1278f2bc5ac55019bdb/comments", "author": {"login": "jakubjelinek", "id": 9370665, "node_id": "MDQ6VXNlcjkzNzA2NjU=", "avatar_url": "https://avatars.githubusercontent.com/u/9370665?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jakubjelinek", "html_url": "https://github.com/jakubjelinek", "followers_url": "https://api.github.com/users/jakubjelinek/followers", "following_url": "https://api.github.com/users/jakubjelinek/following{/other_user}", "gists_url": "https://api.github.com/users/jakubjelinek/gists{/gist_id}", "starred_url": "https://api.github.com/users/jakubjelinek/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jakubjelinek/subscriptions", "organizations_url": "https://api.github.com/users/jakubjelinek/orgs", "repos_url": "https://api.github.com/users/jakubjelinek/repos", "events_url": "https://api.github.com/users/jakubjelinek/events{/privacy}", "received_events_url": "https://api.github.com/users/jakubjelinek/received_events", "type": "User", "site_admin": false}, "committer": {"login": "jakubjelinek", "id": 9370665, "node_id": "MDQ6VXNlcjkzNzA2NjU=", "avatar_url": "https://avatars.githubusercontent.com/u/9370665?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jakubjelinek", "html_url": "https://github.com/jakubjelinek", "followers_url": "https://api.github.com/users/jakubjelinek/followers", "following_url": "https://api.github.com/users/jakubjelinek/following{/other_user}", "gists_url": "https://api.github.com/users/jakubjelinek/gists{/gist_id}", "starred_url": "https://api.github.com/users/jakubjelinek/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jakubjelinek/subscriptions", "organizations_url": "https://api.github.com/users/jakubjelinek/orgs", "repos_url": "https://api.github.com/users/jakubjelinek/repos", "events_url": "https://api.github.com/users/jakubjelinek/events{/privacy}", "received_events_url": "https://api.github.com/users/jakubjelinek/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "ab96073df00159aa02860b4d128e54909cb75068", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/ab96073df00159aa02860b4d128e54909cb75068", "html_url": "https://github.com/Rust-GCC/gccrs/commit/ab96073df00159aa02860b4d128e54909cb75068"}], "stats": {"total": 14, "additions": 12, "deletions": 2}, "files": [{"sha": "41641c64395655f2741748e9e25adbc4fa301394", "filename": "gcc/configure", "status": "modified", "additions": 6, "deletions": 1, "changes": 7, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/ff99d05f40fc573ee405f1278f2bc5ac55019bdb/gcc%2Fconfigure", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/ff99d05f40fc573ee405f1278f2bc5ac55019bdb/gcc%2Fconfigure", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fconfigure?ref=ff99d05f40fc573ee405f1278f2bc5ac55019bdb", "patch": "@@ -31174,7 +31174,12 @@ do\n \t$ok || continue\n \n \tall_lang_configurefrags=\"$all_lang_configurefrags \\$(srcdir)/$gcc_subdir/config-lang.in\"\n-\tall_lang_makefrags=\"$all_lang_makefrags \\$(srcdir)/$gcc_subdir/Make-lang.in\"\n+\tif test \"x$language\" = xc && test -n \"$all_lang_makefrags\"; then\n+\t    # Put c/Make-lang.in fragment first to match serialization languages order.\n+\t    all_lang_makefrags=\"\\$(srcdir)/$gcc_subdir/Make-lang.in $all_lang_makefrags\"\n+\telse\n+\t    all_lang_makefrags=\"$all_lang_makefrags \\$(srcdir)/$gcc_subdir/Make-lang.in\"\n+\tfi\n \tif test -f $srcdir/$gcc_subdir/lang.opt; then\n \t    lang_opt_files=\"$lang_opt_files $srcdir/$gcc_subdir/lang.opt\"\n \t    all_opt_files=\"$all_opt_files $srcdir/$gcc_subdir/lang.opt\""}, {"sha": "ff4d3dc078bc85a805d9d2dad6ab649d4e8f9c25", "filename": "gcc/configure.ac", "status": "modified", "additions": 6, "deletions": 1, "changes": 7, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/ff99d05f40fc573ee405f1278f2bc5ac55019bdb/gcc%2Fconfigure.ac", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/ff99d05f40fc573ee405f1278f2bc5ac55019bdb/gcc%2Fconfigure.ac", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fconfigure.ac?ref=ff99d05f40fc573ee405f1278f2bc5ac55019bdb", "patch": "@@ -6975,7 +6975,12 @@ changequote([,])dnl\n \t$ok || continue\n \n \tall_lang_configurefrags=\"$all_lang_configurefrags \\$(srcdir)/$gcc_subdir/config-lang.in\"\n-\tall_lang_makefrags=\"$all_lang_makefrags \\$(srcdir)/$gcc_subdir/Make-lang.in\"\n+\tif test \"x$language\" = xc && test -n \"$all_lang_makefrags\"; then\n+\t    # Put c/Make-lang.in fragment first to match serialization languages order.\n+\t    all_lang_makefrags=\"\\$(srcdir)/$gcc_subdir/Make-lang.in $all_lang_makefrags\"\n+\telse\n+\t    all_lang_makefrags=\"$all_lang_makefrags \\$(srcdir)/$gcc_subdir/Make-lang.in\"\n+\tfi\n \tif test -f $srcdir/$gcc_subdir/lang.opt; then\n \t    lang_opt_files=\"$lang_opt_files $srcdir/$gcc_subdir/lang.opt\"\n \t    all_opt_files=\"$all_opt_files $srcdir/$gcc_subdir/lang.opt\""}]}