{"sha": "c84733360b2a78e24d2c59fb38c454010090769a", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6Yzg0NzMzMzYwYjJhNzhlMjRkMmM1OWZiMzhjNDU0MDEwMDkwNzY5YQ==", "commit": {"author": {"name": "David S. Miller", "email": "davem@davemloft.net", "date": "2014-10-14T21:20:46Z"}, "committer": {"name": "David S. Miller", "email": "davem@gcc.gnu.org", "date": "2014-10-14T21:20:46Z"}, "message": "Fix sanitizer build on sparc.\n\n\t* sanitizer_common/sanitizer_platform_limits_linux.cc (time_t):\n\tDefine at __kernel_time_t, as needed for sparc.\n\t(struct __old_kernel_stat): Don't check if __sparc__ is defined.\n\t* libsanitizer/sanitizer_common/sanitizer_platform_limits_posix.h\n\t(__sanitizer): Define struct___old_kernel_stat_sz,\n\tstruct_kernel_stat_sz, and struct_kernel_stat64_sz for sparc.\n\t(__sanitizer_ipc_perm): Adjust for sparc targets.\n\t(__sanitizer_shmid_ds): Likewsie.\n\t(__sanitizer_sigaction): Likewsie.\n\t(IOC_SIZE): Likewsie.\n\nFrom-SVN: r216224", "tree": {"sha": "516612d142828be065c207b85d0833724c68f6c1", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/516612d142828be065c207b85d0833724c68f6c1"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/c84733360b2a78e24d2c59fb38c454010090769a", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/c84733360b2a78e24d2c59fb38c454010090769a", "html_url": "https://github.com/Rust-GCC/gccrs/commit/c84733360b2a78e24d2c59fb38c454010090769a", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/c84733360b2a78e24d2c59fb38c454010090769a/comments", "author": {"login": "davem330", "id": 1053866, "node_id": "MDQ6VXNlcjEwNTM4NjY=", "avatar_url": "https://avatars.githubusercontent.com/u/1053866?v=4", "gravatar_id": "", "url": "https://api.github.com/users/davem330", "html_url": "https://github.com/davem330", "followers_url": "https://api.github.com/users/davem330/followers", "following_url": "https://api.github.com/users/davem330/following{/other_user}", "gists_url": "https://api.github.com/users/davem330/gists{/gist_id}", "starred_url": "https://api.github.com/users/davem330/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/davem330/subscriptions", "organizations_url": "https://api.github.com/users/davem330/orgs", "repos_url": "https://api.github.com/users/davem330/repos", "events_url": "https://api.github.com/users/davem330/events{/privacy}", "received_events_url": "https://api.github.com/users/davem330/received_events", "type": "User", "site_admin": false}, "committer": null, "parents": [{"sha": "5940e204bd31aacbdb3cbb2660483f18ce750593", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/5940e204bd31aacbdb3cbb2660483f18ce750593", "html_url": "https://github.com/Rust-GCC/gccrs/commit/5940e204bd31aacbdb3cbb2660483f18ce750593"}], "stats": {"total": 75, "additions": 72, "deletions": 3}, "files": [{"sha": "dc6c88d494b559b531defc74073abe29e1b7bf4e", "filename": "libsanitizer/ChangeLog", "status": "modified", "additions": 13, "deletions": 0, "changes": 13, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/c84733360b2a78e24d2c59fb38c454010090769a/libsanitizer%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/c84733360b2a78e24d2c59fb38c454010090769a/libsanitizer%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libsanitizer%2FChangeLog?ref=c84733360b2a78e24d2c59fb38c454010090769a", "patch": "@@ -1,3 +1,16 @@\n+2014-10-14  David S. Miller  <davem@davemloft.net>\n+\n+\t* sanitizer_common/sanitizer_platform_limits_linux.cc (time_t):\n+\tDefine at __kernel_time_t, as needed for sparc.\n+\t(struct __old_kernel_stat): Don't check if __sparc__ is defined.\n+\t* libsanitizer/sanitizer_common/sanitizer_platform_limits_posix.h\n+\t(__sanitizer): Define struct___old_kernel_stat_sz,\n+\tstruct_kernel_stat_sz, and struct_kernel_stat64_sz for sparc.\n+\t(__sanitizer_ipc_perm): Adjust for sparc targets.\n+\t(__sanitizer_shmid_ds): Likewsie.\n+\t(__sanitizer_sigaction): Likewsie.\n+\t(IOC_SIZE): Likewsie.\n+\n 2014-10-14  Jakub Jelinek  <jakub@redhat.com>\n \n \t* ubsan/Makefile.am (DEFS): Add -DPIC."}, {"sha": "a1f043250331ade7894e58fa3074b439e9361042", "filename": "libsanitizer/sanitizer_common/sanitizer_platform_limits_linux.cc", "status": "modified", "additions": 2, "deletions": 1, "changes": 3, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/c84733360b2a78e24d2c59fb38c454010090769a/libsanitizer%2Fsanitizer_common%2Fsanitizer_platform_limits_linux.cc", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/c84733360b2a78e24d2c59fb38c454010090769a/libsanitizer%2Fsanitizer_common%2Fsanitizer_platform_limits_linux.cc", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libsanitizer%2Fsanitizer_common%2Fsanitizer_platform_limits_linux.cc?ref=c84733360b2a78e24d2c59fb38c454010090769a", "patch": "@@ -36,6 +36,7 @@\n #define uid_t __kernel_uid_t\n #define gid_t __kernel_gid_t\n #define off_t __kernel_off_t\n+#define time_t __kernel_time_t\n // This header seems to contain the definitions of _kernel_ stat* structs.\n #include <asm/stat.h>\n #undef ino_t\n@@ -60,7 +61,7 @@ namespace __sanitizer {\n }  // namespace __sanitizer\n \n #if !defined(__powerpc64__) && !defined(__x86_64__) && !defined(__aarch64__)\\\n-                            && !defined(__mips__)\n+                            && !defined(__mips__) && !defined(__sparc__)\n COMPILER_CHECK(struct___old_kernel_stat_sz == sizeof(struct __old_kernel_stat));\n #endif\n "}, {"sha": "284be11cb5fb18fe3a83c8e509c1f24fec5e2031", "filename": "libsanitizer/sanitizer_common/sanitizer_platform_limits_posix.h", "status": "modified", "additions": 57, "deletions": 2, "changes": 59, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/c84733360b2a78e24d2c59fb38c454010090769a/libsanitizer%2Fsanitizer_common%2Fsanitizer_platform_limits_posix.h", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/c84733360b2a78e24d2c59fb38c454010090769a/libsanitizer%2Fsanitizer_common%2Fsanitizer_platform_limits_posix.h", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libsanitizer%2Fsanitizer_common%2Fsanitizer_platform_limits_posix.h?ref=c84733360b2a78e24d2c59fb38c454010090769a", "patch": "@@ -72,6 +72,14 @@ namespace __sanitizer {\n   const unsigned struct_kernel_stat_sz = 144;\n   #endif\n   const unsigned struct_kernel_stat64_sz = 104;\n+#elif defined(__sparc__) && defined(__arch64__)\n+  const unsigned struct___old_kernel_stat_sz = 0;\n+  const unsigned struct_kernel_stat_sz = 104;\n+  const unsigned struct_kernel_stat64_sz = 144;\n+#elif defined(__sparc__) && !defined(__arch64__)\n+  const unsigned struct___old_kernel_stat_sz = 0;\n+  const unsigned struct_kernel_stat_sz = 64;\n+  const unsigned struct_kernel_stat64_sz = 104;\n #endif\n   struct __sanitizer_perf_event_attr {\n     unsigned type;\n@@ -94,7 +102,7 @@ namespace __sanitizer {\n \n #if defined(__powerpc64__)\n   const unsigned struct___old_kernel_stat_sz = 0;\n-#else\n+#elif !defined(__sparc__)\n   const unsigned struct___old_kernel_stat_sz = 32;\n #endif\n \n@@ -173,6 +181,18 @@ namespace __sanitizer {\n     unsigned short __pad1;\n     unsigned long __unused1;\n     unsigned long __unused2;\n+#elif defined(__sparc__)\n+# if defined(__arch64__)\n+    unsigned mode;\n+    unsigned short __pad1;\n+# else\n+    unsigned short __pad1;\n+    unsigned short mode;\n+    unsigned short __pad2;\n+# endif\n+    unsigned short __seq;\n+    unsigned long long __unused1;\n+    unsigned long long __unused2;\n #else\n     unsigned short mode;\n     unsigned short __pad1;\n@@ -190,6 +210,26 @@ namespace __sanitizer {\n \n   struct __sanitizer_shmid_ds {\n     __sanitizer_ipc_perm shm_perm;\n+  #if defined(__sparc__)\n+  # if !defined(__arch64__)\n+    u32 __pad1;\n+  # endif\n+    long shm_atime;\n+  # if !defined(__arch64__)\n+    u32 __pad2;\n+  # endif\n+    long shm_dtime;\n+  # if !defined(__arch64__)\n+    u32 __pad3;\n+  # endif\n+    long shm_ctime;\n+    uptr shm_segsz;\n+    int shm_cpid;\n+    int shm_lpid;\n+    unsigned long shm_nattch;\n+    unsigned long __glibc_reserved1;\n+    unsigned long __glibc_reserved2;\n+  #else    \n   #ifndef __powerpc__\n     uptr shm_segsz;\n   #elif !defined(__powerpc64__)\n@@ -227,6 +267,7 @@ namespace __sanitizer {\n     uptr __unused4;\n     uptr __unused5;\n   #endif\n+#endif\n   };\n #elif SANITIZER_FREEBSD\n   struct __sanitizer_ipc_perm {\n@@ -523,9 +564,13 @@ namespace __sanitizer {\n #else\n     __sanitizer_sigset_t sa_mask;\n #ifndef __mips__\n+#if defined(__sparc__)\n+    unsigned long sa_flags;\n+#else\n     int sa_flags;\n #endif\n #endif\n+#endif\n #if SANITIZER_LINUX\n     void (*sa_restorer)();\n #endif\n@@ -745,7 +790,7 @@ struct __sanitizer_obstack {\n \n #define IOC_NRBITS 8\n #define IOC_TYPEBITS 8\n-#if defined(__powerpc__) || defined(__powerpc64__) || defined(__mips__)\n+#if defined(__powerpc__) || defined(__powerpc64__) || defined(__mips__) || defined(__sparc__)\n #define IOC_SIZEBITS 13\n #define IOC_DIRBITS 3\n #define IOC_NONE 1U\n@@ -775,7 +820,17 @@ struct __sanitizer_obstack {\n #define IOC_DIR(nr) (((nr) >> IOC_DIRSHIFT) & IOC_DIRMASK)\n #define IOC_TYPE(nr) (((nr) >> IOC_TYPESHIFT) & IOC_TYPEMASK)\n #define IOC_NR(nr) (((nr) >> IOC_NRSHIFT) & IOC_NRMASK)\n+\n+#if defined(__sparc__)\n+// In sparc the 14 bits SIZE field overlaps with the\n+// least significant bit of DIR, so either IOC_READ or\n+// IOC_WRITE shall be 1 in order to get a non-zero SIZE.\n+# define IOC_SIZE(nr)                       \\\n+  ((((((nr) >> 29) & 0x7) & (4U|2U)) == 0)? \\\n+   0 : (((nr) >> 16) & 0x3fff))\n+#else\n #define IOC_SIZE(nr) (((nr) >> IOC_SIZESHIFT) & IOC_SIZEMASK)\n+#endif\n \n   extern unsigned struct_arpreq_sz;\n   extern unsigned struct_ifreq_sz;"}]}