{"sha": "9f13879ee894334867240f087b699232395bc36c", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6OWYxMzg3OWVlODk0MzM0ODY3MjQwZjA4N2I2OTkyMzIzOTViYzM2Yw==", "commit": {"author": {"name": "H.J. Lu", "email": "hongjiu.lu@intel.com", "date": "2013-11-15T12:06:25Z"}, "committer": {"name": "H.J. Lu", "email": "hjl@gcc.gnu.org", "date": "2013-11-15T12:06:25Z"}, "message": "Add and use System.Linux.time_t for time_t\n\n\tPR ada/54040\n\t* s-linux-x32.ads: New file.\n\t* s-osprim-x32.adb: Likewise.\n\t* s-linux.ads (time_t): New type.\n\t* s-linux-alpha.ads (time_t):  Likewise.\n\t* s-linux-hppa.ads (time_t):  Likewise.\n\t* s-linux-mipsel.ads (time_t):  Likewise.\n\t* s-linux-sparc.ads (time_t):  Likewise.\n\t* s-osinte-linux.ads (time_t): Mark it private.  Replace long\n\twith System.Linux.time_t.\n\t(timespec): Replace long with time_t.\n\t* s-osinte-posix.adb (To_Timespec): Likewise.\n\t* s-taprop-linux.adb (timeval): Replace C.long with\n\tSystem.OS_Interface.time_t.\n\t* gcc-interface/Makefile.in (LIBGNAT_TARGET_PAIRS): Replace\n\ts-linux.ads with s-linux-x32.ads, s-osprim-posix.adb with\n\ts-osprim-x32.adb for x32.\n\nFrom-SVN: r204840", "tree": {"sha": "f6854d8417f71282546ff4e7157a6bdbe43baad5", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/f6854d8417f71282546ff4e7157a6bdbe43baad5"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/9f13879ee894334867240f087b699232395bc36c", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/9f13879ee894334867240f087b699232395bc36c", "html_url": "https://github.com/Rust-GCC/gccrs/commit/9f13879ee894334867240f087b699232395bc36c", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/9f13879ee894334867240f087b699232395bc36c/comments", "author": {"login": "hjl-tools", "id": 1072356, "node_id": "MDQ6VXNlcjEwNzIzNTY=", "avatar_url": "https://avatars.githubusercontent.com/u/1072356?v=4", "gravatar_id": "", "url": "https://api.github.com/users/hjl-tools", "html_url": "https://github.com/hjl-tools", "followers_url": "https://api.github.com/users/hjl-tools/followers", "following_url": "https://api.github.com/users/hjl-tools/following{/other_user}", "gists_url": "https://api.github.com/users/hjl-tools/gists{/gist_id}", "starred_url": "https://api.github.com/users/hjl-tools/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/hjl-tools/subscriptions", "organizations_url": "https://api.github.com/users/hjl-tools/orgs", "repos_url": "https://api.github.com/users/hjl-tools/repos", "events_url": "https://api.github.com/users/hjl-tools/events{/privacy}", "received_events_url": "https://api.github.com/users/hjl-tools/received_events", "type": "User", "site_admin": false}, "committer": null, "parents": [{"sha": "d877729c89a04e57f4acdff574120f7e1dd275d0", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/d877729c89a04e57f4acdff574120f7e1dd275d0", "html_url": "https://github.com/Rust-GCC/gccrs/commit/d877729c89a04e57f4acdff574120f7e1dd275d0"}], "stats": {"total": 346, "additions": 340, "deletions": 6}, "files": [{"sha": "4de8e32c897637710a443d3d7d188ff39bee222b", "filename": "gcc/ada/ChangeLog", "status": "modified", "additions": 20, "deletions": 0, "changes": 20, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/9f13879ee894334867240f087b699232395bc36c/gcc%2Fada%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/9f13879ee894334867240f087b699232395bc36c/gcc%2Fada%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fada%2FChangeLog?ref=9f13879ee894334867240f087b699232395bc36c", "patch": "@@ -1,3 +1,23 @@\n+2013-11-15  H.J. Lu  <hongjiu.lu@intel.com>\n+\n+\tPR ada/54040\n+\t* s-linux-x32.ads: New file.\n+\t* s-osprim-x32.adb: Likewise.\n+\t* s-linux.ads (time_t): New type.\n+\t* s-linux-alpha.ads (time_t):  Likewise.\n+\t* s-linux-hppa.ads (time_t):  Likewise.\n+\t* s-linux-mipsel.ads (time_t):  Likewise.\n+\t* s-linux-sparc.ads (time_t):  Likewise.\n+\t* s-osinte-linux.ads (time_t): Mark it private.  Replace long\n+\twith System.Linux.time_t.\n+\t(timespec): Replace long with time_t.\n+\t* s-osinte-posix.adb (To_Timespec): Likewise.\n+\t* s-taprop-linux.adb (timeval): Replace C.long with\n+\tSystem.OS_Interface.time_t.\n+\t* gcc-interface/Makefile.in (LIBGNAT_TARGET_PAIRS): Replace\n+\ts-linux.ads with s-linux-x32.ads, s-osprim-posix.adb with\n+\ts-osprim-x32.adb for x32.\n+\n 2013-11-14  H.J. Lu  <hongjiu.lu@intel.com>\n \n \t* gcc-interface/trans.c: Include gimple.h and pointer-set.h."}, {"sha": "885a5edce89f43c1fcd53498279041a6f55a5810", "filename": "gcc/ada/gcc-interface/Makefile.in", "status": "modified", "additions": 2, "deletions": 2, "changes": 4, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/9f13879ee894334867240f087b699232395bc36c/gcc%2Fada%2Fgcc-interface%2FMakefile.in", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/9f13879ee894334867240f087b699232395bc36c/gcc%2Fada%2Fgcc-interface%2FMakefile.in", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fada%2Fgcc-interface%2FMakefile.in?ref=9f13879ee894334867240f087b699232395bc36c", "patch": "@@ -2186,11 +2186,11 @@ ifeq ($(strip $(filter-out %x32 linux%,$(target_cpu) $(target_os))),)\n   a-synbar.ads<a-synbar-posix.ads \\\n   s-inmaop.adb<s-inmaop-posix.adb \\\n   s-intman.adb<s-intman-posix.adb \\\n-  s-linux.ads<s-linux.ads \\\n+  s-linux.ads<s-linux-x32.ads \\\n   s-mudido.adb<s-mudido-affinity.adb \\\n   s-osinte.ads<s-osinte-linux.ads \\\n   s-osinte.adb<s-osinte-posix.adb \\\n-  s-osprim.adb<s-osprim-posix.adb \\\n+  s-osprim.adb<s-osprim-x32.adb \\\n   s-taprop.adb<s-taprop-linux.adb \\\n   s-tasinf.ads<s-tasinf-linux.ads \\\n   s-tasinf.adb<s-tasinf-linux.adb \\"}, {"sha": "1a9f37acd7d48bd2de1cc98f32debee9a1cf2190", "filename": "gcc/ada/s-linux-alpha.ads", "status": "modified", "additions": 6, "deletions": 0, "changes": 6, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/9f13879ee894334867240f087b699232395bc36c/gcc%2Fada%2Fs-linux-alpha.ads", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/9f13879ee894334867240f087b699232395bc36c/gcc%2Fada%2Fs-linux-alpha.ads", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fada%2Fs-linux-alpha.ads?ref=9f13879ee894334867240f087b699232395bc36c", "patch": "@@ -38,6 +38,12 @@\n package System.Linux is\n    pragma Preelaborate;\n \n+   ------------\n+   -- time_t --\n+   ------------\n+\n+   type time_t is new Long_Integer;\n+\n    -----------\n    -- Errno --\n    -----------"}, {"sha": "904615049459615807d32b5cefde6df55b28fb64", "filename": "gcc/ada/s-linux-hppa.ads", "status": "modified", "additions": 6, "deletions": 0, "changes": 6, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/9f13879ee894334867240f087b699232395bc36c/gcc%2Fada%2Fs-linux-hppa.ads", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/9f13879ee894334867240f087b699232395bc36c/gcc%2Fada%2Fs-linux-hppa.ads", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fada%2Fs-linux-hppa.ads?ref=9f13879ee894334867240f087b699232395bc36c", "patch": "@@ -38,6 +38,12 @@\n package System.Linux is\n    pragma Preelaborate;\n \n+   ------------\n+   -- time_t --\n+   ------------\n+\n+   type time_t is new Long_Integer;\n+\n    -----------\n    -- Errno --\n    -----------"}, {"sha": "028ea7c0b60d3701e9ef29a67043855c8a6af22b", "filename": "gcc/ada/s-linux-mipsel.ads", "status": "modified", "additions": 6, "deletions": 0, "changes": 6, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/9f13879ee894334867240f087b699232395bc36c/gcc%2Fada%2Fs-linux-mipsel.ads", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/9f13879ee894334867240f087b699232395bc36c/gcc%2Fada%2Fs-linux-mipsel.ads", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fada%2Fs-linux-mipsel.ads?ref=9f13879ee894334867240f087b699232395bc36c", "patch": "@@ -37,6 +37,12 @@\n package System.Linux is\n    pragma Preelaborate;\n \n+   ------------\n+   -- time_t --\n+   ------------\n+\n+   type time_t is new Long_Integer;\n+\n    -----------\n    -- Errno --\n    -----------"}, {"sha": "db3b4ea794cef8dc3d432a2ddf63f9951d2b2ba5", "filename": "gcc/ada/s-linux-sparc.ads", "status": "modified", "additions": 6, "deletions": 0, "changes": 6, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/9f13879ee894334867240f087b699232395bc36c/gcc%2Fada%2Fs-linux-sparc.ads", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/9f13879ee894334867240f087b699232395bc36c/gcc%2Fada%2Fs-linux-sparc.ads", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fada%2Fs-linux-sparc.ads?ref=9f13879ee894334867240f087b699232395bc36c", "patch": "@@ -38,6 +38,12 @@\n package System.Linux is\n    pragma Preelaborate;\n \n+   ------------\n+   -- time_t --\n+   ------------\n+\n+   type time_t is new Long_Integer;\n+\n    -----------\n    -- Errno --\n    -----------"}, {"sha": "9dc0e830d946e464be5a172a19dfef0b84940c45", "filename": "gcc/ada/s-linux-x32.ads", "status": "added", "additions": 110, "deletions": 0, "changes": 110, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/9f13879ee894334867240f087b699232395bc36c/gcc%2Fada%2Fs-linux-x32.ads", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/9f13879ee894334867240f087b699232395bc36c/gcc%2Fada%2Fs-linux-x32.ads", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fada%2Fs-linux-x32.ads?ref=9f13879ee894334867240f087b699232395bc36c", "patch": "@@ -0,0 +1,110 @@\n+------------------------------------------------------------------------------\n+--                                                                          --\n+--                GNU ADA RUN-TIME LIBRARY (GNARL) COMPONENTS               --\n+--                                                                          --\n+--                          S Y S T E M .  L I N U X                        --\n+--                                                                          --\n+--                                  S p e c                                 --\n+--                                                                          --\n+--          Copyright (C) 2013, Free Software Foundation, Inc.              --\n+--                                                                          --\n+-- GNARL is free software; you can  redistribute it  and/or modify it under --\n+-- terms of the  GNU General Public License as published  by the Free Soft- --\n+-- ware  Foundation;  either version 3,  or (at your option) any later ver- --\n+-- sion.  GNAT is distributed in the hope that it will be useful, but WITH- --\n+-- OUT ANY WARRANTY;  without even the  implied warranty of MERCHANTABILITY --\n+-- or FITNESS FOR A PARTICULAR PURPOSE.                                     --\n+--                                                                          --\n+-- As a special exception under Section 7 of GPL version 3, you are granted --\n+-- additional permissions described in the GCC Runtime Library Exception,   --\n+-- version 3.1, as published by the Free Software Foundation.               --\n+--                                                                          --\n+-- You should have received a copy of the GNU General Public License and    --\n+-- a copy of the GCC Runtime Library Exception along with this program;     --\n+-- see the files COPYING3 and COPYING.RUNTIME respectively.  If not, see    --\n+-- <http://www.gnu.org/licenses/>.                                          --\n+--                                                                          --\n+--                                                                          --\n+------------------------------------------------------------------------------\n+\n+--  This is the x32 version of this package\n+\n+--  This package encapsulates cpu specific differences between implementations\n+--  of GNU/Linux, in order to share s-osinte-linux.ads.\n+\n+--  PLEASE DO NOT add any with-clauses to this package or remove the pragma\n+--  Preelaborate. This package is designed to be a bottom-level (leaf) package\n+\n+package System.Linux is\n+   pragma Preelaborate;\n+\n+   ------------\n+   -- time_t --\n+   ------------\n+\n+   type time_t is new Long_Long_Integer;\n+\n+   -----------\n+   -- Errno --\n+   -----------\n+\n+   EAGAIN    : constant := 11;\n+   EINTR     : constant := 4;\n+   EINVAL    : constant := 22;\n+   ENOMEM    : constant := 12;\n+   EPERM     : constant := 1;\n+   ETIMEDOUT : constant := 110;\n+\n+   -------------\n+   -- Signals --\n+   -------------\n+\n+   SIGHUP     : constant := 1; --  hangup\n+   SIGINT     : constant := 2; --  interrupt (rubout)\n+   SIGQUIT    : constant := 3; --  quit (ASCD FS)\n+   SIGILL     : constant := 4; --  illegal instruction (not reset)\n+   SIGTRAP    : constant := 5; --  trace trap (not reset)\n+   SIGIOT     : constant := 6; --  IOT instruction\n+   SIGABRT    : constant := 6; --  used by abort, replace SIGIOT in the  future\n+   SIGFPE     : constant := 8; --  floating point exception\n+   SIGKILL    : constant := 9; --  kill (cannot be caught or ignored)\n+   SIGBUS     : constant := 7; --  bus error\n+   SIGSEGV    : constant := 11; --  segmentation violation\n+   SIGPIPE    : constant := 13; --  write on a pipe with no one to read it\n+   SIGALRM    : constant := 14; --  alarm clock\n+   SIGTERM    : constant := 15; --  software termination signal from kill\n+   SIGUSR1    : constant := 10; --  user defined signal 1\n+   SIGUSR2    : constant := 12; --  user defined signal 2\n+   SIGCLD     : constant := 17; --  alias for SIGCHLD\n+   SIGCHLD    : constant := 17; --  child status change\n+   SIGPWR     : constant := 30; --  power-fail restart\n+   SIGWINCH   : constant := 28; --  window size change\n+   SIGURG     : constant := 23; --  urgent condition on IO channel\n+   SIGPOLL    : constant := 29; --  pollable event occurred\n+   SIGIO      : constant := 29; --  I/O now possible (4.2 BSD)\n+   SIGLOST    : constant := 29; --  File lock lost\n+   SIGSTOP    : constant := 19; --  stop (cannot be caught or ignored)\n+   SIGTSTP    : constant := 20; --  user stop requested from tty\n+   SIGCONT    : constant := 18; --  stopped process has been continued\n+   SIGTTIN    : constant := 21; --  background tty read attempted\n+   SIGTTOU    : constant := 22; --  background tty write attempted\n+   SIGVTALRM  : constant := 26; --  virtual timer expired\n+   SIGPROF    : constant := 27; --  profiling timer expired\n+   SIGXCPU    : constant := 24; --  CPU time limit exceeded\n+   SIGXFSZ    : constant := 25; --  filesize limit exceeded\n+   SIGUNUSED  : constant := 31; --  unused signal (GNU/Linux)\n+   SIGSTKFLT  : constant := 16; --  coprocessor stack fault (Linux)\n+   SIGLTHRRES : constant := 32; --  GNU/LinuxThreads restart signal\n+   SIGLTHRCAN : constant := 33; --  GNU/LinuxThreads cancel signal\n+   SIGLTHRDBG : constant := 34; --  GNU/LinuxThreads debugger signal\n+\n+   --  struct_sigaction offsets\n+\n+   sa_handler_pos : constant := 0;\n+   sa_mask_pos    : constant := Standard'Address_Size / 8;\n+   sa_flags_pos   : constant := 128 + sa_mask_pos;\n+\n+   SA_SIGINFO  : constant := 16#04#;\n+   SA_ONSTACK  : constant := 16#08000000#;\n+\n+end System.Linux;"}, {"sha": "2339e29e04b76be07c341346ef58788bee7d4f07", "filename": "gcc/ada/s-linux.ads", "status": "modified", "additions": 6, "deletions": 0, "changes": 6, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/9f13879ee894334867240f087b699232395bc36c/gcc%2Fada%2Fs-linux.ads", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/9f13879ee894334867240f087b699232395bc36c/gcc%2Fada%2Fs-linux.ads", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fada%2Fs-linux.ads?ref=9f13879ee894334867240f087b699232395bc36c", "patch": "@@ -38,6 +38,12 @@\n package System.Linux is\n    pragma Preelaborate;\n \n+   ------------\n+   -- time_t --\n+   ------------\n+\n+   type time_t is new Long_Integer;\n+\n    -----------\n    -- Errno --\n    -----------"}, {"sha": "6eb0b88f561da46b9d240f3af40e6b3516adf106", "filename": "gcc/ada/s-osinte-linux.ads", "status": "modified", "additions": 3, "deletions": 2, "changes": 5, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/9f13879ee894334867240f087b699232395bc36c/gcc%2Fada%2Fs-osinte-linux.ads", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/9f13879ee894334867240f087b699232395bc36c/gcc%2Fada%2Fs-osinte-linux.ads", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fada%2Fs-osinte-linux.ads?ref=9f13879ee894334867240f087b699232395bc36c", "patch": "@@ -218,6 +218,7 @@ package System.OS_Interface is\n    ----------\n \n    type timespec is private;\n+   type time_t is private;\n \n    function To_Duration (TS : timespec) return Duration;\n    pragma Inline (To_Duration);\n@@ -596,11 +597,11 @@ private\n \n    type pid_t is new int;\n \n-   type time_t is new long;\n+   type time_t is new System.Linux.time_t;\n \n    type timespec is record\n       tv_sec  : time_t;\n-      tv_nsec : long;\n+      tv_nsec : time_t;\n    end record;\n    pragma Convention (C, timespec);\n "}, {"sha": "402ddcb61908078d285279be7120e069321fa5da", "filename": "gcc/ada/s-osinte-posix.adb", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/9f13879ee894334867240f087b699232395bc36c/gcc%2Fada%2Fs-osinte-posix.adb", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/9f13879ee894334867240f087b699232395bc36c/gcc%2Fada%2Fs-osinte-posix.adb", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fada%2Fs-osinte-posix.adb?ref=9f13879ee894334867240f087b699232395bc36c", "patch": "@@ -104,7 +104,7 @@ package body System.OS_Interface is\n       end if;\n \n       return timespec'(tv_sec => S,\n-                       tv_nsec => long (Long_Long_Integer (F * 10#1#E9)));\n+                       tv_nsec => time_t (Long_Long_Integer (F * 10#1#E9)));\n    end To_Timespec;\n \n end System.OS_Interface;"}, {"sha": "5d4964a2776cdbd1c545ae9978e5da995698a057", "filename": "gcc/ada/s-osprim-x32.adb", "status": "added", "additions": 173, "deletions": 0, "changes": 173, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/9f13879ee894334867240f087b699232395bc36c/gcc%2Fada%2Fs-osprim-x32.adb", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/9f13879ee894334867240f087b699232395bc36c/gcc%2Fada%2Fs-osprim-x32.adb", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fada%2Fs-osprim-x32.adb?ref=9f13879ee894334867240f087b699232395bc36c", "patch": "@@ -0,0 +1,173 @@\n+------------------------------------------------------------------------------\n+--                                                                          --\n+--                 GNAT RUN-TIME LIBRARY (GNARL) COMPONENTS                 --\n+--                                                                          --\n+--                  S Y S T E M . O S _ P R I M I T I V E S                 --\n+--                                                                          --\n+--                                  B o d y                                 --\n+--                                                                          --\n+--          Copyright (C) 2013, Free Software Foundation, Inc.              --\n+--                                                                          --\n+-- GNARL is free software; you can  redistribute it  and/or modify it under --\n+-- terms of the  GNU General Public License as published  by the Free Soft- --\n+-- ware  Foundation;  either version 3,  or (at your option) any later ver- --\n+-- sion.  GNAT is distributed in the hope that it will be useful, but WITH- --\n+-- OUT ANY WARRANTY;  without even the  implied warranty of MERCHANTABILITY --\n+-- or FITNESS FOR A PARTICULAR PURPOSE.                                     --\n+--                                                                          --\n+-- As a special exception under Section 7 of GPL version 3, you are granted --\n+-- additional permissions described in the GCC Runtime Library Exception,   --\n+-- version 3.1, as published by the Free Software Foundation.               --\n+--                                                                          --\n+-- You should have received a copy of the GNU General Public License and    --\n+-- a copy of the GCC Runtime Library Exception along with this program;     --\n+-- see the files COPYING3 and COPYING.RUNTIME respectively.  If not, see    --\n+-- <http://www.gnu.org/licenses/>.                                          --\n+--                                                                          --\n+-- GNARL was developed by the GNARL team at Florida State University.       --\n+-- Extensive contributions were provided by Ada Core Technologies, Inc.     --\n+--                                                                          --\n+------------------------------------------------------------------------------\n+\n+--  This version is for Linux/x32\n+\n+package body System.OS_Primitives is\n+\n+   --  ??? These definitions are duplicated from System.OS_Interface\n+   --  because we don't want to depend on any package. Consider removing\n+   --  these declarations in System.OS_Interface and move these ones in\n+   --  the spec.\n+\n+   type time_t is new Long_Long_Integer;\n+\n+   type timespec is record\n+      tv_sec  : time_t;\n+      tv_nsec : time_t;\n+   end record;\n+   pragma Convention (C, timespec);\n+\n+   function nanosleep (rqtp, rmtp : not null access timespec) return Integer;\n+   pragma Import (C, nanosleep, \"nanosleep\");\n+\n+   -----------\n+   -- Clock --\n+   -----------\n+\n+   function Clock return Duration is\n+      type timeval is array (1 .. 2) of time_t;\n+\n+      procedure timeval_to_duration\n+        (T    : not null access timeval;\n+         sec  : not null access Long_Integer;\n+         usec : not null access Long_Integer);\n+      pragma Import (C, timeval_to_duration, \"__gnat_timeval_to_duration\");\n+\n+      Micro  : constant := 10**6;\n+      sec    : aliased Long_Integer;\n+      usec   : aliased Long_Integer;\n+      TV     : aliased timeval;\n+      Result : Integer;\n+      pragma Unreferenced (Result);\n+\n+      function gettimeofday\n+        (Tv : access timeval;\n+         Tz : System.Address := System.Null_Address) return Integer;\n+      pragma Import (C, gettimeofday, \"gettimeofday\");\n+\n+   begin\n+      --  The return codes for gettimeofday are as follows (from man pages):\n+      --    EPERM  settimeofday is called by someone other than the superuser\n+      --    EINVAL Timezone (or something else) is invalid\n+      --    EFAULT One of tv or tz pointed outside accessible address space\n+\n+      --  None of these codes signal a potential clock skew, hence the return\n+      --  value is never checked.\n+\n+      Result := gettimeofday (TV'Access, System.Null_Address);\n+      timeval_to_duration (TV'Access, sec'Access, usec'Access);\n+      return Duration (sec) + Duration (usec) / Micro;\n+   end Clock;\n+\n+   ---------------------\n+   -- Monotonic_Clock --\n+   ---------------------\n+\n+   function Monotonic_Clock return Duration renames Clock;\n+\n+   -----------------\n+   -- To_Timespec --\n+   -----------------\n+\n+   function To_Timespec (D : Duration) return timespec;\n+\n+   function To_Timespec (D : Duration) return timespec is\n+      S : time_t;\n+      F : Duration;\n+\n+   begin\n+      S := time_t (Long_Long_Integer (D));\n+      F := D - Duration (S);\n+\n+      --  If F has negative value due to a round-up, adjust for positive F\n+      --  value.\n+\n+      if F < 0.0 then\n+         S := S - 1;\n+         F := F + 1.0;\n+      end if;\n+\n+      return\n+        timespec'(tv_sec  => S,\n+                  tv_nsec => time_t (Long_Long_Integer (F * 10#1#E9)));\n+   end To_Timespec;\n+\n+   -----------------\n+   -- Timed_Delay --\n+   -----------------\n+\n+   procedure Timed_Delay\n+     (Time : Duration;\n+      Mode : Integer)\n+   is\n+      Request    : aliased timespec;\n+      Remaind    : aliased timespec;\n+      Rel_Time   : Duration;\n+      Abs_Time   : Duration;\n+      Base_Time  : constant Duration := Clock;\n+      Check_Time : Duration := Base_Time;\n+\n+      Result : Integer;\n+      pragma Unreferenced (Result);\n+\n+   begin\n+      if Mode = Relative then\n+         Rel_Time := Time;\n+         Abs_Time := Time + Check_Time;\n+      else\n+         Rel_Time := Time - Check_Time;\n+         Abs_Time := Time;\n+      end if;\n+\n+      if Rel_Time > 0.0 then\n+         loop\n+            Request := To_Timespec (Rel_Time);\n+            Result := nanosleep (Request'Access, Remaind'Access);\n+            Check_Time := Clock;\n+\n+            exit when Abs_Time <= Check_Time or else Check_Time < Base_Time;\n+\n+            Rel_Time := Abs_Time - Check_Time;\n+         end loop;\n+      end if;\n+   end Timed_Delay;\n+\n+   ----------------\n+   -- Initialize --\n+   ----------------\n+\n+   procedure Initialize is\n+   begin\n+      null;\n+   end Initialize;\n+\n+end System.OS_Primitives;"}, {"sha": "b8accbec02128f0022638a3f5f8aa89308899f0a", "filename": "gcc/ada/s-taprop-linux.adb", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/9f13879ee894334867240f087b699232395bc36c/gcc%2Fada%2Fs-taprop-linux.adb", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/9f13879ee894334867240f087b699232395bc36c/gcc%2Fada%2Fs-taprop-linux.adb", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fada%2Fs-taprop-linux.adb?ref=9f13879ee894334867240f087b699232395bc36c", "patch": "@@ -627,7 +627,7 @@ package body System.Task_Primitives.Operations is\n    function Monotonic_Clock return Duration is\n       use Interfaces;\n \n-      type timeval is array (1 .. 2) of C.long;\n+      type timeval is array (1 .. 2) of System.OS_Interface.time_t;\n \n       procedure timeval_to_duration\n         (T    : not null access timeval;"}]}