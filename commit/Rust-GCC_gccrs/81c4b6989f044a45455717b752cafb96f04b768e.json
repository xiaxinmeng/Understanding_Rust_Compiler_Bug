{"sha": "81c4b6989f044a45455717b752cafb96f04b768e", "node_id": "C_kwDOANBUbNoAKDgxYzRiNjk4OWYwNDRhNDU0NTU3MTdiNzUyY2FmYjk2ZjA0Yjc2OGU", "commit": {"author": {"name": "Philip Herron", "email": "philip.herron@embecosm.com", "date": "2022-07-08T13:54:37Z"}, "committer": {"name": "Philip Herron", "email": "philip.herron@embecosm.com", "date": "2022-07-15T10:58:23Z"}, "message": "Fix undefined behaviour using .get on unique_ptr\n\nAs the move semantics for AST and HIR crates are unsafe on older compilers\nwe are working around this by storing the pointer into the mappings class\nthis was using the get method to store the pointer. The issue for loading\nextern crates the unique_ptr goes out of scope and this the deletion code\nresulting in undefined behaviour. This changes it to call release to take\nfull ownership of the pointer as we expect.", "tree": {"sha": "84ef2eda81057f81cd87997d779d7209059e6fe4", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/84ef2eda81057f81cd87997d779d7209059e6fe4"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/81c4b6989f044a45455717b752cafb96f04b768e", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/81c4b6989f044a45455717b752cafb96f04b768e", "html_url": "https://github.com/Rust-GCC/gccrs/commit/81c4b6989f044a45455717b752cafb96f04b768e", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/81c4b6989f044a45455717b752cafb96f04b768e/comments", "author": {"login": "philberty", "id": 84585, "node_id": "MDQ6VXNlcjg0NTg1", "avatar_url": "https://avatars.githubusercontent.com/u/84585?v=4", "gravatar_id": "", "url": "https://api.github.com/users/philberty", "html_url": "https://github.com/philberty", "followers_url": "https://api.github.com/users/philberty/followers", "following_url": "https://api.github.com/users/philberty/following{/other_user}", "gists_url": "https://api.github.com/users/philberty/gists{/gist_id}", "starred_url": "https://api.github.com/users/philberty/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/philberty/subscriptions", "organizations_url": "https://api.github.com/users/philberty/orgs", "repos_url": "https://api.github.com/users/philberty/repos", "events_url": "https://api.github.com/users/philberty/events{/privacy}", "received_events_url": "https://api.github.com/users/philberty/received_events", "type": "User", "site_admin": false}, "committer": {"login": "philberty", "id": 84585, "node_id": "MDQ6VXNlcjg0NTg1", "avatar_url": "https://avatars.githubusercontent.com/u/84585?v=4", "gravatar_id": "", "url": "https://api.github.com/users/philberty", "html_url": "https://github.com/philberty", "followers_url": "https://api.github.com/users/philberty/followers", "following_url": "https://api.github.com/users/philberty/following{/other_user}", "gists_url": "https://api.github.com/users/philberty/gists{/gist_id}", "starred_url": "https://api.github.com/users/philberty/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/philberty/subscriptions", "organizations_url": "https://api.github.com/users/philberty/orgs", "repos_url": "https://api.github.com/users/philberty/repos", "events_url": "https://api.github.com/users/philberty/events{/privacy}", "received_events_url": "https://api.github.com/users/philberty/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "f51284b598863eb0cbeb2984fd1499a672f2191d", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/f51284b598863eb0cbeb2984fd1499a672f2191d", "html_url": "https://github.com/Rust-GCC/gccrs/commit/f51284b598863eb0cbeb2984fd1499a672f2191d"}], "stats": {"total": 4, "additions": 2, "deletions": 2}, "files": [{"sha": "360dabf912f052b3583205079f1e99375c9470c9", "filename": "gcc/rust/util/rust-hir-map.cc", "status": "modified", "additions": 2, "deletions": 2, "changes": 4, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/81c4b6989f044a45455717b752cafb96f04b768e/gcc%2Frust%2Futil%2Frust-hir-map.cc", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/81c4b6989f044a45455717b752cafb96f04b768e/gcc%2Frust%2Futil%2Frust-hir-map.cc", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Frust%2Futil%2Frust-hir-map.cc?ref=81c4b6989f044a45455717b752cafb96f04b768e", "patch": "@@ -199,7 +199,7 @@ Mappings::insert_ast_crate (std::unique_ptr<AST::Crate> &&crate,\n   rust_assert (it == ast_crate_mappings.end ());\n \n   // store it\n-  ast_crate_mappings.insert ({crate_num, crate.get ()});\n+  ast_crate_mappings.insert ({crate_num, crate.release ()});\n \n   // return the reference to it\n   it = ast_crate_mappings.find (crate_num);\n@@ -236,7 +236,7 @@ Mappings::insert_hir_crate (std::unique_ptr<HIR::Crate> &&crate)\n \n   insert_node_to_hir (crate->get_mappings ().get_nodeid (),\n \t\t      crate->get_mappings ().get_hirid ());\n-  hir_crate_mappings.insert ({crateNum, crate.get ()});\n+  hir_crate_mappings.insert ({crateNum, crate.release ()});\n \n   it = hir_crate_mappings.find (crateNum);\n   rust_assert (it != hir_crate_mappings.end ());"}]}