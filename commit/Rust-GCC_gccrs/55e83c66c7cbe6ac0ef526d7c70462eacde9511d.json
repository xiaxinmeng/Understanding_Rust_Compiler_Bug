{"sha": "55e83c66c7cbe6ac0ef526d7c70462eacde9511d", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6NTVlODNjNjZjN2NiZTZhYzBlZjUyNmQ3YzcwNDYyZWFjZGU5NTExZA==", "commit": {"author": {"name": "Paolo Carlini", "email": "paolo.carlini@oracle.com", "date": "2012-01-18T20:27:23Z"}, "committer": {"name": "Paolo Carlini", "email": "paolo@gcc.gnu.org", "date": "2012-01-18T20:27:23Z"}, "message": "re PR c++/51225 ([c++0x] [4.7 Regression] ICE with invalid template parameter)\n\n/cp\n2012-01-18  Paolo Carlini  <paolo.carlini@oracle.com>\n\n\tPR c++/51225\n\t* typeck2.c (store_init_value): Within a template guard\n\tcxx_constant_value with require_potential_constant_expression.\n\t* pt.c (convert_nontype_argument): Likewise.\n\n/testsuite\n2012-01-18  Paolo Carlini  <paolo.carlini@oracle.com>\n\n\tPR c++/51225\n\t* g++.dg/cpp0x/pr51225.C: New.\n\nFrom-SVN: r183286", "tree": {"sha": "3aae7cc44cafb04a147e67f1c2cb90571b26ebe3", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/3aae7cc44cafb04a147e67f1c2cb90571b26ebe3"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/55e83c66c7cbe6ac0ef526d7c70462eacde9511d", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/55e83c66c7cbe6ac0ef526d7c70462eacde9511d", "html_url": "https://github.com/Rust-GCC/gccrs/commit/55e83c66c7cbe6ac0ef526d7c70462eacde9511d", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/55e83c66c7cbe6ac0ef526d7c70462eacde9511d/comments", "author": null, "committer": null, "parents": [{"sha": "66b432fd29b9d3a58ccac007b89f0460906a74d3", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/66b432fd29b9d3a58ccac007b89f0460906a74d3", "html_url": "https://github.com/Rust-GCC/gccrs/commit/66b432fd29b9d3a58ccac007b89f0460906a74d3"}], "stats": {"total": 39, "additions": 37, "deletions": 2}, "files": [{"sha": "b0660ce57af3287eadeb9eb8f7f46632f52b5545", "filename": "gcc/cp/ChangeLog", "status": "modified", "additions": 7, "deletions": 0, "changes": 7, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/55e83c66c7cbe6ac0ef526d7c70462eacde9511d/gcc%2Fcp%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/55e83c66c7cbe6ac0ef526d7c70462eacde9511d/gcc%2Fcp%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fcp%2FChangeLog?ref=55e83c66c7cbe6ac0ef526d7c70462eacde9511d", "patch": "@@ -1,3 +1,10 @@\n+2012-01-18  Paolo Carlini  <paolo.carlini@oracle.com>\n+\n+\tPR c++/51225\n+\t* typeck2.c (store_init_value): Within a template guard\n+\tcxx_constant_value with require_potential_constant_expression.\n+\t* pt.c (convert_nontype_argument): Likewise.\n+\n 2012-01-16  Jakub Jelinek  <jakub@redhat.com>\n \n \tPR c++/51854"}, {"sha": "87ec5f5103efffd797eeedc7ca32a6637ab53166", "filename": "gcc/cp/pt.c", "status": "modified", "additions": 3, "deletions": 0, "changes": 3, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/55e83c66c7cbe6ac0ef526d7c70462eacde9511d/gcc%2Fcp%2Fpt.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/55e83c66c7cbe6ac0ef526d7c70462eacde9511d/gcc%2Fcp%2Fpt.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fcp%2Fpt.c?ref=55e83c66c7cbe6ac0ef526d7c70462eacde9511d", "patch": "@@ -5807,6 +5807,9 @@ convert_nontype_argument (tree type, tree expr, tsubst_flags_t complain)\n \t  if (complain & tf_error)\n \t    {\n \t      int errs = errorcount, warns = warningcount;\n+\t      if (processing_template_decl\n+\t\t  && !require_potential_constant_expression (expr))\n+\t\treturn NULL_TREE;\n \t      expr = cxx_constant_value (expr);\n \t      if (errorcount > errs || warningcount > warns)\n \t\tinform (EXPR_LOC_OR_HERE (expr),"}, {"sha": "7793744ae4fa031427c8ced845f13602516f8e47", "filename": "gcc/cp/typeck2.c", "status": "modified", "additions": 8, "deletions": 2, "changes": 10, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/55e83c66c7cbe6ac0ef526d7c70462eacde9511d/gcc%2Fcp%2Ftypeck2.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/55e83c66c7cbe6ac0ef526d7c70462eacde9511d/gcc%2Fcp%2Ftypeck2.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fcp%2Ftypeck2.c?ref=55e83c66c7cbe6ac0ef526d7c70462eacde9511d", "patch": "@@ -718,8 +718,14 @@ store_init_value (tree decl, tree init, VEC(tree,gc)** cleanups, int flags)\n       value = fold_non_dependent_expr (value);\n       value = maybe_constant_init (value);\n       if (DECL_DECLARED_CONSTEXPR_P (decl))\n-\t/* Diagnose a non-constant initializer for constexpr.  */\n-\tvalue = cxx_constant_value (value);\n+\t{\n+\t  /* Diagnose a non-constant initializer for constexpr.  */\n+\t  if (processing_template_decl\n+\t      && !require_potential_constant_expression (value))\n+\t    value = error_mark_node;\n+\t  else\n+\t    value = cxx_constant_value (value);\n+\t}\n       const_init = (reduced_constant_expression_p (value)\n \t\t    || error_operand_p (value));\n       DECL_INITIALIZED_BY_CONSTANT_EXPRESSION_P (decl) = const_init;"}, {"sha": "e79f00b58acaa020cdb4d8303c6a84f6149a0207", "filename": "gcc/testsuite/ChangeLog", "status": "modified", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/55e83c66c7cbe6ac0ef526d7c70462eacde9511d/gcc%2Ftestsuite%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/55e83c66c7cbe6ac0ef526d7c70462eacde9511d/gcc%2Ftestsuite%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2FChangeLog?ref=55e83c66c7cbe6ac0ef526d7c70462eacde9511d", "patch": "@@ -1,3 +1,8 @@\n+2012-01-18  Paolo Carlini  <paolo.carlini@oracle.com>\n+\n+\tPR c++/51225\n+\t* g++.dg/cpp0x/pr51225.C: New.\n+\n 2012-01-17  Ian Lance Taylor  <iant@google.com>\n \n \tPR go/50656"}, {"sha": "6fcf8611f9cb4976bde6138a623e91c2ed571c96", "filename": "gcc/testsuite/g++.dg/cpp0x/pr51225.C", "status": "added", "additions": 14, "deletions": 0, "changes": 14, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/55e83c66c7cbe6ac0ef526d7c70462eacde9511d/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Fcpp0x%2Fpr51225.C", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/55e83c66c7cbe6ac0ef526d7c70462eacde9511d/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Fcpp0x%2Fpr51225.C", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Fcpp0x%2Fpr51225.C?ref=55e83c66c7cbe6ac0ef526d7c70462eacde9511d", "patch": "@@ -0,0 +1,14 @@\n+// PR c++/51225\n+// { dg-options \"-std=c++0x\" }\n+\n+template<int> struct A {};\n+\n+template<typename> void foo()\n+{\n+  A<int(x)> a; // { dg-error \"not declared|invalid type\" }\n+}\n+\n+template<typename> struct bar\n+{\n+  static constexpr A<1> b = A<1>(x); // { dg-error \"not declared\" }\n+};"}]}