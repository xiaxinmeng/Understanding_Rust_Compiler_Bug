{"sha": "e2a2d49440c8f8253d15054b6147810a88a10242", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6ZTJhMmQ0OTQ0MGM4ZjgyNTNkMTUwNTRiNjE0NzgxMGE4OGExMDI0Mg==", "commit": {"author": {"name": "Thomas Quinot", "email": "quinot@adacore.com", "date": "2019-07-11T08:01:44Z"}, "committer": {"name": "Pierre-Marie de Rodat", "email": "pmderodat@gcc.gnu.org", "date": "2019-07-11T08:01:44Z"}, "message": "[Ada] Fix crash on dynamic predicate when generating SCOs\n\nA pragma Check for Dynamic_Predicate does not correspond to any source\nconstruct that has a provisionally-disabled SCO.\n\n2019-07-11  Thomas Quinot  <quinot@adacore.com>\n\ngcc/ada/\n\n\t* sem_prag.adb (Analyze_Pragma, case pragma Check): Do not call\n\tSet_SCO_Pragma_Enabled for the dynamic predicate case.\n\ngcc/testsuite/\n\n\t* gnat.dg/scos1.adb: New testcase.\n\nFrom-SVN: r273384", "tree": {"sha": "42b0e182aeae952f228472f9de296a94ee768acf", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/42b0e182aeae952f228472f9de296a94ee768acf"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/e2a2d49440c8f8253d15054b6147810a88a10242", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/e2a2d49440c8f8253d15054b6147810a88a10242", "html_url": "https://github.com/Rust-GCC/gccrs/commit/e2a2d49440c8f8253d15054b6147810a88a10242", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/e2a2d49440c8f8253d15054b6147810a88a10242/comments", "author": null, "committer": null, "parents": [{"sha": "a3d1ca0127cf4ca6bb8d0da5a525d17dfc58cbc9", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/a3d1ca0127cf4ca6bb8d0da5a525d17dfc58cbc9", "html_url": "https://github.com/Rust-GCC/gccrs/commit/a3d1ca0127cf4ca6bb8d0da5a525d17dfc58cbc9"}], "stats": {"total": 44, "additions": 42, "deletions": 2}, "files": [{"sha": "79ee0b11ed4e8efc5ed08f46374cc734a78b586c", "filename": "gcc/ada/ChangeLog", "status": "modified", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/e2a2d49440c8f8253d15054b6147810a88a10242/gcc%2Fada%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/e2a2d49440c8f8253d15054b6147810a88a10242/gcc%2Fada%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fada%2FChangeLog?ref=e2a2d49440c8f8253d15054b6147810a88a10242", "patch": "@@ -1,3 +1,8 @@\n+2019-07-11  Thomas Quinot  <quinot@adacore.com>\n+\n+\t* sem_prag.adb (Analyze_Pragma, case pragma Check): Do not call\n+\tSet_SCO_Pragma_Enabled for the dynamic predicate case.\n+\n 2019-07-11  Hristian Kirtchev  <kirtchev@adacore.com>\n \n \t* exp_util.ads, exp_util.adb (Needs_Finalization): Move to"}, {"sha": "1a2a759017c4739f87ba984b543548a228d6cdd9", "filename": "gcc/ada/sem_prag.adb", "status": "modified", "additions": 7, "deletions": 2, "changes": 9, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/e2a2d49440c8f8253d15054b6147810a88a10242/gcc%2Fada%2Fsem_prag.adb", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/e2a2d49440c8f8253d15054b6147810a88a10242/gcc%2Fada%2Fsem_prag.adb", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fada%2Fsem_prag.adb?ref=e2a2d49440c8f8253d15054b6147810a88a10242", "patch": "@@ -14113,9 +14113,14 @@ package body Sem_Prag is\n \n             Expr := Get_Pragma_Arg (Arg2);\n \n-            --  Deal with SCO generation\n+            --  Mark the pragma (or, if rewritten from an aspect, the original\n+            --  aspect) as enabled. Nothing to do for an internally generated\n+            --  check for a dynamic predicate.\n \n-            if Is_Checked (N) and then not Split_PPC (N) then\n+            if Is_Checked (N)\n+              and then not Split_PPC (N)\n+              and then Cname /= Name_Dynamic_Predicate\n+            then\n                Set_SCO_Pragma_Enabled (Loc);\n             end if;\n "}, {"sha": "66d1e3ed5bec8e722ee2bd7ba279cacf1bebca4d", "filename": "gcc/testsuite/ChangeLog", "status": "modified", "additions": 4, "deletions": 0, "changes": 4, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/e2a2d49440c8f8253d15054b6147810a88a10242/gcc%2Ftestsuite%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/e2a2d49440c8f8253d15054b6147810a88a10242/gcc%2Ftestsuite%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2FChangeLog?ref=e2a2d49440c8f8253d15054b6147810a88a10242", "patch": "@@ -1,3 +1,7 @@\n+2019-07-11  Thomas Quinot  <quinot@adacore.com>\n+\n+\t* gnat.dg/scos1.adb: New testcase.\n+\n 2019-07-11  Justin Squirek  <squirek@adacore.com>\n \n \t* gnat.dg/access7.adb: New testcase."}, {"sha": "778c0716f2578f7cde16915619fda1302b81dba4", "filename": "gcc/testsuite/gnat.dg/scos1.adb", "status": "added", "additions": 26, "deletions": 0, "changes": 26, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/e2a2d49440c8f8253d15054b6147810a88a10242/gcc%2Ftestsuite%2Fgnat.dg%2Fscos1.adb", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/e2a2d49440c8f8253d15054b6147810a88a10242/gcc%2Ftestsuite%2Fgnat.dg%2Fscos1.adb", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgnat.dg%2Fscos1.adb?ref=e2a2d49440c8f8253d15054b6147810a88a10242", "patch": "@@ -0,0 +1,26 @@\n+--  { dg-do compile }\n+--  { dg-options \"-gnata -gnateS\" }\n+\n+procedure SCOs1 with SPARK_Mode => On is\n+\n+   LEN_IN_BITS : constant := 20;\n+\n+   M_SIZE_BYTES : constant := 2 ** LEN_IN_BITS;\n+   ET_BYTES : constant := (M_SIZE_BYTES - 4);\n+\n+   type T_BYTES  is new Integer range 0 .. ET_BYTES  with Size => 32;\n+   subtype TYPE5_SCALAR is T_BYTES\n+     with Dynamic_Predicate => TYPE5_SCALAR mod 4 = 0;\n+\n+   type E_16_BYTES is new Integer;\n+   subtype RD_BYTES is E_16_BYTES\n+     with Dynamic_Predicate => RD_BYTES mod 4 = 0;\n+\n+   function \"-\" (left : TYPE5_SCALAR; right : RD_BYTES) return TYPE5_SCALAR\n+   is ( left - TYPE5_SCALAR(right) )\n+     with Pre => TYPE5_SCALAR(right) <= left and then\n+     left - TYPE5_SCALAR(right) <= T_BYTES'Last, Inline_Always;\n+\n+begin\n+   null;\n+end SCOs1;"}]}