{"sha": "f52c81dd6b355644a61421f736a6ba167fa93668", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6ZjUyYzgxZGQ2YjM1NTY0NGE2MTQyMWY3MzZhNmJhMTY3ZmE5MzY2OA==", "commit": {"author": {"name": "Adrian Straetling", "email": "straetling@de.ibm.com", "date": "2005-05-09T17:01:36Z"}, "committer": {"name": "Ulrich Weigand", "email": "uweigand@gcc.gnu.org", "date": "2005-05-09T17:01:36Z"}, "message": "s390.md: (\"HQI\"): New mode macro.\n\n2005-05-09  Adrian Straetling  <straetling@de.ibm.com>\n\n\t* config/s390/s390.md: (\"HQI\"): New mode macro.\n\t(\"icm_lo\", \"icm_hi\", \"max_uint\"): New mode attributes.\n\t(\"*tmhi_full\", \"*tmqi_full\"): Merge.\n\t(\"*tsthiCCT\", \"*tstqiCCT\"): Merge.\n\t(\"*tsthi\", \"*tstqi\"): Merge.\n\t(\"*tsthi_cconly\", \"tstqi_cconly\"): Merge.\n\t(\"*sethighhisi\", \"*sethighqisi\"): Merge.\n\nFrom-SVN: r99449", "tree": {"sha": "f91ca69aad8498ceddfb8ead369326dd97aae9a6", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/f91ca69aad8498ceddfb8ead369326dd97aae9a6"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/f52c81dd6b355644a61421f736a6ba167fa93668", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/f52c81dd6b355644a61421f736a6ba167fa93668", "html_url": "https://github.com/Rust-GCC/gccrs/commit/f52c81dd6b355644a61421f736a6ba167fa93668", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/f52c81dd6b355644a61421f736a6ba167fa93668/comments", "author": null, "committer": null, "parents": [{"sha": "1f4a355acbcb7123579f4d65ee524b939ceff4d0", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/1f4a355acbcb7123579f4d65ee524b939ceff4d0", "html_url": "https://github.com/Rust-GCC/gccrs/commit/1f4a355acbcb7123579f4d65ee524b939ceff4d0"}], "stats": {"total": 137, "additions": 57, "deletions": 80}, "files": [{"sha": "89f2adbd6c3f0d86bda3bb19525fa0d95ceabd13", "filename": "gcc/ChangeLog", "status": "modified", "additions": 10, "deletions": 0, "changes": 10, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/f52c81dd6b355644a61421f736a6ba167fa93668/gcc%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/f52c81dd6b355644a61421f736a6ba167fa93668/gcc%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2FChangeLog?ref=f52c81dd6b355644a61421f736a6ba167fa93668", "patch": "@@ -1,3 +1,13 @@\n+2005-05-09  Adrian Straetling  <straetling@de.ibm.com>\n+\n+\t* config/s390/s390.md: (\"HQI\"): New mode macro.\n+\t(\"icm_lo\", \"icm_hi\", \"max_uint\"): New mode attributes.\n+\t(\"*tmhi_full\", \"*tmqi_full\"): Merge.\n+\t(\"*tsthiCCT\", \"*tstqiCCT\"): Merge.\n+\t(\"*tsthi\", \"*tstqi\"): Merge.\n+\t(\"*tsthi_cconly\", \"tstqi_cconly\"): Merge.\n+\t(\"*sethighhisi\", \"*sethighqisi\"): Merge.\n+\t \n 2005-05-09  Kazu Hirata  <kazu@cs.umass.edu>\n \n \t* crtstuff.c, integrate.h, tree-scalar-evolution.h,"}, {"sha": "a74cf9e39bb488a7bbff75d9b526cb6639d823fc", "filename": "gcc/config/s390/s390.md", "status": "modified", "additions": 47, "deletions": 80, "changes": 127, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/f52c81dd6b355644a61421f736a6ba167fa93668/gcc%2Fconfig%2Fs390%2Fs390.md", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/f52c81dd6b355644a61421f736a6ba167fa93668/gcc%2Fconfig%2Fs390%2Fs390.md", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fconfig%2Fs390%2Fs390.md?ref=f52c81dd6b355644a61421f736a6ba167fa93668", "patch": "@@ -232,6 +232,26 @@\n ;; Predicates\n (include \"predicates.md\")\n \n+\n+;; Macros\n+\n+;; This mode macro allows the QI and HI patterns to be defined from\n+;; the same template.\n+(define_mode_macro HQI [HI QI])\n+\n+\n+;; ICM mask required to load MODE value into the highest subreg\n+;; of a SImode register.\n+(define_mode_attr icm_hi [(HI \"12\") (QI \"8\")])\n+\n+;; ICM mask required to load MODE value into the lowest subreg\n+;; of a SImode register.\n+(define_mode_attr icm_lo [(HI \"3\") (QI \"1\")])\n+\n+;; Maximum unsigned integer that fits in MODE.\n+(define_mode_attr max_uint [(HI \"65535\") (QI \"255\")])\n+\n+\n ;;\n ;;- Compare instructions.\n ;;\n@@ -322,20 +342,12 @@\n    tml\\t%0,%i1\"\n   [(set_attr \"op_type\" \"RI\")])\n \n-(define_insn \"*tmhi_full\"\n-  [(set (reg 33)\n-        (compare (match_operand:HI 0 \"register_operand\" \"d\")\n-                 (match_operand:HI 1 \"immediate_operand\" \"n\")))]\n-  \"s390_match_ccmode (insn, s390_tm_ccmode (constm1_rtx, operands[1], 1))\"\n-  \"tml\\t%0,65535\"\n-  [(set_attr \"op_type\" \"RI\")])\n-\n-(define_insn \"*tmqi_full\"\n+(define_insn \"*tm<mode>_full\"\n   [(set (reg 33)\n-        (compare (match_operand:QI 0 \"register_operand\" \"d\")\n-                 (match_operand:QI 1 \"immediate_operand\" \"n\")))]\n+        (compare (match_operand:HQI 0 \"register_operand\" \"d\")\n+                 (match_operand:HQI 1 \"immediate_operand\" \"n\")))]\n   \"s390_match_ccmode (insn, s390_tm_ccmode (constm1_rtx, operands[1], 1))\"\n-  \"tml\\t%0,255\"\n+  \"tml\\t%0,<max_uint>\"\n   [(set_attr \"op_type\" \"RI\")])\n \n \n@@ -413,17 +425,17 @@\n   \"ltr\\t%0,%0\"\n   [(set_attr \"op_type\" \"RR\")])\n \n-(define_insn \"*tsthiCCT\"\n+(define_insn \"*tst<mode>CCT\"\n   [(set (reg 33)\n-        (compare (match_operand:HI 0 \"nonimmediate_operand\" \"?Q,?S,d\")\n-                 (match_operand:HI 1 \"const0_operand\" \"\")))\n-   (set (match_operand:HI 2 \"register_operand\" \"=d,d,0\")\n+        (compare (match_operand:HQI 0 \"nonimmediate_operand\" \"?Q,?S,d\")\n+                 (match_operand:HQI 1 \"const0_operand\" \"\")))\n+   (set (match_operand:HQI 2 \"register_operand\" \"=d,d,0\")\n         (match_dup 0))]\n   \"s390_match_ccmode(insn, CCTmode)\"\n   \"@\n-   icm\\t%2,3,%S0\n-   icmy\\t%2,3,%S0\n-   tml\\t%0,65535\"\n+   icm\\t%2,<icm_lo>,%S0\n+   icmy\\t%2,<icm_lo>,%S0\n+   tml\\t%0,<max_uint>\"\n   [(set_attr \"op_type\" \"RS,RSY,RI\")])\n \n (define_insn \"*tsthiCCT_cconly\"\n@@ -438,42 +450,6 @@\n    tml\\t%0,65535\"\n   [(set_attr \"op_type\" \"RS,RSY,RI\")])\n \n-(define_insn \"*tsthi\"\n-  [(set (reg 33)\n-        (compare (match_operand:HI 0 \"s_operand\" \"Q,S\")\n-                 (match_operand:HI 1 \"const0_operand\" \"\")))\n-   (set (match_operand:HI 2 \"register_operand\" \"=d,d\")\n-        (match_dup 0))]\n-  \"s390_match_ccmode(insn, CCSmode)\"\n-  \"@\n-   icm\\t%2,3,%S0\n-   icmy\\t%2,3,%S0\"\n-  [(set_attr \"op_type\" \"RS,RSY\")])\n-\n-(define_insn \"*tsthi_cconly\"\n-  [(set (reg 33)\n-        (compare (match_operand:HI 0 \"s_operand\" \"Q,S\")\n-                 (match_operand:HI 1 \"const0_operand\" \"\")))\n-   (clobber (match_scratch:HI 2 \"=d,d\"))]\n-  \"s390_match_ccmode(insn, CCSmode)\"\n-  \"@\n-   icm\\t%2,3,%S0\n-   icmy\\t%2,3,%S0\"\n-  [(set_attr \"op_type\" \"RS,RSY\")])\n-\n-(define_insn \"*tstqiCCT\"\n-  [(set (reg 33)\n-        (compare (match_operand:QI 0 \"nonimmediate_operand\" \"?Q,?S,d\")\n-                 (match_operand:QI 1 \"const0_operand\" \"\")))\n-   (set (match_operand:QI 2 \"register_operand\" \"=d,d,0\")\n-        (match_dup 0))]\n-  \"s390_match_ccmode(insn, CCTmode)\"\n-  \"@\n-   icm\\t%2,1,%S0\n-   icmy\\t%2,1,%S0\n-   tml\\t%0,255\"\n-  [(set_attr \"op_type\" \"RS,RSY,RI\")])\n-\n (define_insn \"*tstqiCCT_cconly\"\n   [(set (reg 33)\n         (compare (match_operand:QI 0 \"nonimmediate_operand\" \"?Q,?S,d\")\n@@ -485,27 +461,27 @@\n    tml\\t%0,255\"\n   [(set_attr \"op_type\" \"SI,SIY,RI\")])\n \n-(define_insn \"*tstqi\"\n+(define_insn \"*tst<mode>\"\n   [(set (reg 33)\n-        (compare (match_operand:QI 0 \"s_operand\" \"Q,S\")\n-                 (match_operand:QI 1 \"const0_operand\" \"\")))\n-   (set (match_operand:QI 2 \"register_operand\" \"=d,d\")\n+        (compare (match_operand:HQI 0 \"s_operand\" \"Q,S\")\n+                 (match_operand:HQI 1 \"const0_operand\" \"\")))\n+   (set (match_operand:HQI 2 \"register_operand\" \"=d,d\")\n         (match_dup 0))]\n   \"s390_match_ccmode(insn, CCSmode)\"\n   \"@\n-   icm\\t%2,1,%S0\n-   icmy\\t%2,1,%S0\"\n+   icm\\t%2,<icm_lo>,%S0\n+   icmy\\t%2,<icm_lo>,%S0\"\n   [(set_attr \"op_type\" \"RS,RSY\")])\n \n-(define_insn \"*tstqi_cconly\"\n+(define_insn \"*tst<mode>_cconly\"\n   [(set (reg 33)\n-        (compare (match_operand:QI 0 \"s_operand\" \"Q,S\")\n-                 (match_operand:QI 1 \"const0_operand\" \"\")))\n-   (clobber (match_scratch:QI 2 \"=d,d\"))]\n+        (compare (match_operand:HQI 0 \"s_operand\" \"Q,S\")\n+                 (match_operand:HQI 1 \"const0_operand\" \"\")))\n+   (clobber (match_scratch:HQI 2 \"=d,d\"))]\n   \"s390_match_ccmode(insn, CCSmode)\"\n   \"@\n-   icm\\t%2,1,%S0\n-   icmy\\t%2,1,%S0\"\n+   icm\\t%2,<icm_lo>,%S0\n+   icmy\\t%2,<icm_lo>,%S0\"\n   [(set_attr \"op_type\" \"RS,RSY\")])\n \n \n@@ -2338,24 +2314,15 @@\n ;;- Conversion instructions.\n ;;\n \n-(define_insn \"*sethighqisi\"\n-  [(set (match_operand:SI 0 \"register_operand\" \"=d,d\")\n-        (unspec:SI [(match_operand:QI 1 \"s_operand\" \"Q,S\")] UNSPEC_SETHIGH))\n-   (clobber (reg:CC 33))]\n-  \"\"\n-  \"@\n-   icm\\t%0,8,%S1\n-   icmy\\t%0,8,%S1\"\n-  [(set_attr \"op_type\" \"RS,RSY\")])\n \n-(define_insn \"*sethighhisi\"\n+(define_insn \"*sethigh<mode>si\"\n   [(set (match_operand:SI 0 \"register_operand\" \"=d,d\")\n-        (unspec:SI [(match_operand:HI 1 \"s_operand\" \"Q,S\")] UNSPEC_SETHIGH))\n+        (unspec:SI [(match_operand:HQI 1 \"s_operand\" \"Q,S\")] UNSPEC_SETHIGH))\n    (clobber (reg:CC 33))]\n   \"\"\n   \"@\n-   icm\\t%0,12,%S1\n-   icmy\\t%0,12,%S1\"\n+   icm\\t%0,<icm_hi>,%S1\n+   icmy\\t%0,<icm_hi>,%S1\"\n   [(set_attr \"op_type\" \"RS,RSY\")])\n \n (define_insn \"*sethighqidi_64\""}]}