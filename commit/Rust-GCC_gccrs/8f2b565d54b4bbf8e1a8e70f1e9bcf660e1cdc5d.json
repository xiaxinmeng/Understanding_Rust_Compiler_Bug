{"sha": "8f2b565d54b4bbf8e1a8e70f1e9bcf660e1cdc5d", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6OGYyYjU2NWQ1NGI0YmJmOGUxYThlNzBmMWU5YmNmNjYwZTFjZGM1ZA==", "commit": {"author": {"name": "Daniel Franke", "email": "franke.daniel@gmail.com", "date": "2009-01-04T16:05:42Z"}, "committer": {"name": "Daniel Franke", "email": "dfranke@gcc.gnu.org", "date": "2009-01-04T16:05:42Z"}, "message": "re PR fortran/38718 (some simplifiers for elemental intrinsics missing; required for init expressions)\n\ngcc/fortran:\n2009-01-04  Daniel Franke  <franke.daniel@gmail.com>\n\n        PR fortran/38718\n        * simplify.c (gfc_simplify_merge): New.\n        * intrinsic.h (gfc_simplify_merge): New prototype.\n        * intrinsic.c (add_functions): Added simplification for MERGE.\n\ngcc/testsuite:\n2009-01-04  Daniel Franke  <franke.daniel@gmail.com>\n\n        PR fortran/38718\n        * gfortran.dg/merge_init_expr.f90: New.\n\nFrom-SVN: r143053", "tree": {"sha": "a37f556324cdc52a56eec35e04b25d6e91d8d39b", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/a37f556324cdc52a56eec35e04b25d6e91d8d39b"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/8f2b565d54b4bbf8e1a8e70f1e9bcf660e1cdc5d", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/8f2b565d54b4bbf8e1a8e70f1e9bcf660e1cdc5d", "html_url": "https://github.com/Rust-GCC/gccrs/commit/8f2b565d54b4bbf8e1a8e70f1e9bcf660e1cdc5d", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/8f2b565d54b4bbf8e1a8e70f1e9bcf660e1cdc5d/comments", "author": {"login": "dfranke76", "id": 15729164, "node_id": "MDQ6VXNlcjE1NzI5MTY0", "avatar_url": "https://avatars.githubusercontent.com/u/15729164?v=4", "gravatar_id": "", "url": "https://api.github.com/users/dfranke76", "html_url": "https://github.com/dfranke76", "followers_url": "https://api.github.com/users/dfranke76/followers", "following_url": "https://api.github.com/users/dfranke76/following{/other_user}", "gists_url": "https://api.github.com/users/dfranke76/gists{/gist_id}", "starred_url": "https://api.github.com/users/dfranke76/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/dfranke76/subscriptions", "organizations_url": "https://api.github.com/users/dfranke76/orgs", "repos_url": "https://api.github.com/users/dfranke76/repos", "events_url": "https://api.github.com/users/dfranke76/events{/privacy}", "received_events_url": "https://api.github.com/users/dfranke76/received_events", "type": "User", "site_admin": false}, "committer": null, "parents": [{"sha": "fea0568fd39fa2582802b29ae3f770cd1b1f70df", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/fea0568fd39fa2582802b29ae3f770cd1b1f70df", "html_url": "https://github.com/Rust-GCC/gccrs/commit/fea0568fd39fa2582802b29ae3f770cd1b1f70df"}], "stats": {"total": 55, "additions": 54, "deletions": 1}, "files": [{"sha": "c8b88c5a25b441eb565b16b3807628114a8305db", "filename": "gcc/fortran/ChangeLog", "status": "modified", "additions": 7, "deletions": 0, "changes": 7, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/8f2b565d54b4bbf8e1a8e70f1e9bcf660e1cdc5d/gcc%2Ffortran%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/8f2b565d54b4bbf8e1a8e70f1e9bcf660e1cdc5d/gcc%2Ffortran%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ffortran%2FChangeLog?ref=8f2b565d54b4bbf8e1a8e70f1e9bcf660e1cdc5d", "patch": "@@ -1,3 +1,10 @@\n+2009-01-04  Daniel Franke  <franke.daniel@gmail.com>\n+\n+\tPR fortran/38718\n+\t* simplify.c (gfc_simplify_merge): New.\n+\t* intrinsic.h (gfc_simplify_merge): New prototype.\n+\t* intrinsic.c (add_functions): Added simplification for MERGE.\n+\n 2009-01-04  Mikael Morin  <mikael.morin@tele2.fr>\n \n \tPR fortran/38536"}, {"sha": "489f95beb15cef087d4a0e74da52b9d4ce9f0a7b", "filename": "gcc/fortran/intrinsic.c", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/8f2b565d54b4bbf8e1a8e70f1e9bcf660e1cdc5d/gcc%2Ffortran%2Fintrinsic.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/8f2b565d54b4bbf8e1a8e70f1e9bcf660e1cdc5d/gcc%2Ffortran%2Fintrinsic.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ffortran%2Fintrinsic.c?ref=8f2b565d54b4bbf8e1a8e70f1e9bcf660e1cdc5d", "patch": "@@ -1974,7 +1974,7 @@ add_functions (void)\n   make_generic (\"mclock8\", GFC_ISYM_MCLOCK8, GFC_STD_GNU);\n \n   add_sym_3 (\"merge\", GFC_ISYM_MERGE, CLASS_ELEMENTAL, ACTUAL_NO, BT_REAL, dr, GFC_STD_F95,\n-\t     gfc_check_merge, NULL, gfc_resolve_merge,\n+\t     gfc_check_merge, gfc_simplify_merge, gfc_resolve_merge,\n \t     ts, BT_REAL, dr, REQUIRED, fs, BT_REAL, dr, REQUIRED,\n \t     msk, BT_LOGICAL, dl, REQUIRED);\n "}, {"sha": "69aadf62ada11b7d4660b9d1130ff54cf32e89b6", "filename": "gcc/fortran/intrinsic.h", "status": "modified", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/8f2b565d54b4bbf8e1a8e70f1e9bcf660e1cdc5d/gcc%2Ffortran%2Fintrinsic.h", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/8f2b565d54b4bbf8e1a8e70f1e9bcf660e1cdc5d/gcc%2Ffortran%2Fintrinsic.h", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ffortran%2Fintrinsic.h?ref=8f2b565d54b4bbf8e1a8e70f1e9bcf660e1cdc5d", "patch": "@@ -270,6 +270,7 @@ gfc_expr *gfc_simplify_llt (gfc_expr *, gfc_expr *);\n gfc_expr *gfc_simplify_log (gfc_expr *);\n gfc_expr *gfc_simplify_log10 (gfc_expr *);\n gfc_expr *gfc_simplify_logical (gfc_expr *, gfc_expr *);\n+gfc_expr *gfc_simplify_merge (gfc_expr *, gfc_expr *, gfc_expr *);\n gfc_expr *gfc_simplify_min (gfc_expr *);\n gfc_expr *gfc_simplify_minval (gfc_expr *, gfc_expr*, gfc_expr*);\n gfc_expr *gfc_simplify_max (gfc_expr *);"}, {"sha": "665d1e3d6f62e4d41956f7239316f049bca891d6", "filename": "gcc/fortran/simplify.c", "status": "modified", "additions": 12, "deletions": 0, "changes": 12, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/8f2b565d54b4bbf8e1a8e70f1e9bcf660e1cdc5d/gcc%2Ffortran%2Fsimplify.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/8f2b565d54b4bbf8e1a8e70f1e9bcf660e1cdc5d/gcc%2Ffortran%2Fsimplify.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ffortran%2Fsimplify.c?ref=8f2b565d54b4bbf8e1a8e70f1e9bcf660e1cdc5d", "patch": "@@ -2619,6 +2619,18 @@ gfc_simplify_logical (gfc_expr *e, gfc_expr *k)\n }\n \n \n+gfc_expr *\n+gfc_simplify_merge (gfc_expr *tsource, gfc_expr *fsource, gfc_expr *mask)\n+{\n+  if (tsource->expr_type != EXPR_CONSTANT\n+      || fsource->expr_type != EXPR_CONSTANT\n+      || mask->expr_type != EXPR_CONSTANT)\n+    return NULL;\n+\n+  return gfc_copy_expr (mask->value.logical ? tsource : fsource);\n+}\n+\n+\n /* Selects bewteen current value and extremum for simplify_min_max\n    and simplify_minval_maxval.  */\n static void"}, {"sha": "752b12ed9d4744787334e5a4aadc552f15cff091", "filename": "gcc/testsuite/ChangeLog", "status": "modified", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/8f2b565d54b4bbf8e1a8e70f1e9bcf660e1cdc5d/gcc%2Ftestsuite%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/8f2b565d54b4bbf8e1a8e70f1e9bcf660e1cdc5d/gcc%2Ftestsuite%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2FChangeLog?ref=8f2b565d54b4bbf8e1a8e70f1e9bcf660e1cdc5d", "patch": "@@ -1,3 +1,8 @@\n+2009-01-04  Daniel Franke  <franke.daniel@gmail.com>\n+\n+\tPR fortran/38718\n+\t* gfortran.dg/merge_init_expr.f90: New.\n+\n 2009-01-04  Mikael Morin  <mikael.morin@tele2.fr>\n \n \tPR fortran/38536"}, {"sha": "f40f49026cc94c380da933cf2cd79b7fc7249415", "filename": "gcc/testsuite/gfortran.dg/merge_init_expr.f90", "status": "added", "additions": 28, "deletions": 0, "changes": 28, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/8f2b565d54b4bbf8e1a8e70f1e9bcf660e1cdc5d/gcc%2Ftestsuite%2Fgfortran.dg%2Fmerge_init_expr.f90", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/8f2b565d54b4bbf8e1a8e70f1e9bcf660e1cdc5d/gcc%2Ftestsuite%2Fgfortran.dg%2Fmerge_init_expr.f90", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgfortran.dg%2Fmerge_init_expr.f90?ref=8f2b565d54b4bbf8e1a8e70f1e9bcf660e1cdc5d", "patch": "@@ -0,0 +1,28 @@\n+! { dg-do \"run\" }\n+!\n+! Check simplification of MERGE.\n+!\n+\n+  INTEGER, PARAMETER :: array(3) = [1, 2, 3]\n+  LOGICAL, PARAMETER :: mask(3)  = [ .TRUE., .FALSE., .TRUE. ]\n+\n+  INTEGER, PARAMETER :: scalar_1 = MERGE (1, 0, .TRUE.)\n+  INTEGER, PARAMETER :: scalar_2 = MERGE (0, 1, .FALSE.)\n+\n+  INTEGER, PARAMETER :: array_1(3) = MERGE (array, 0, .TRUE.)\n+  INTEGER, PARAMETER :: array_2(3) = MERGE (array, 0, .FALSE.)\n+  INTEGER, PARAMETER :: array_3(3) = MERGE (0, array, .TRUE.)\n+  INTEGER, PARAMETER :: array_4(3) = MERGE (0, array, .FALSE.)\n+  INTEGER, PARAMETER :: array_5(3) = MERGE (1, 0, mask)\n+  INTEGER, PARAMETER :: array_6(3) = MERGE (array, -array, mask)\n+\n+  INTEGER, PARAMETER :: array_7(3) = MERGE ([1,2,3], -array, mask)\n+\n+  IF (scalar_1 /= 1 .OR. scalar_2 /= 1) CALL abort\n+  IF (.NOT. ALL (array_1 == array)) CALL abort\n+  IF (.NOT. ALL (array_2 == [0, 0, 0])) CALL abort\n+  IF (.NOT. ALL (array_3 == [0, 0, 0])) CALL abort\n+  IF (.NOT. ALL (array_4 == array)) CALL abort\n+  IF (.NOT. ALL (array_5 == [1, 0, 1])) CALL abort\n+  IF (.NOT. ALL (array_6 == [1, -2, 3])) CALL abort\n+END"}]}