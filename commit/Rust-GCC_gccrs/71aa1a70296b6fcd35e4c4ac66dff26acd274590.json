{"sha": "71aa1a70296b6fcd35e4c4ac66dff26acd274590", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6NzFhYTFhNzAyOTZiNmZjZDM1ZTRjNGFjNjZkZmYyNmFjZDI3NDU5MA==", "commit": {"author": {"name": "Jakub Jelinek", "email": "jakub@redhat.com", "date": "2006-01-18T08:04:52Z"}, "committer": {"name": "Jakub Jelinek", "email": "jakub@gcc.gnu.org", "date": "2006-01-18T08:04:52Z"}, "message": "sysv.S (smst_two_register): Don't call __ashldi3, instead do the shifting inline.\n\n\t* src/powerpc/sysv.S (smst_two_register): Don't call __ashldi3,\n\tinstead do the shifting inline.\n\t* src/powerpc/ppc_closure.S (ffi_closure_SYSV): Don't compute %r5\n\tshift count unconditionally.  Simplify load sequences for 1, 2, 3, 4\n\tand 8 byte structs, for the remaining struct sizes don't call\n\t__lshrdi3, instead do the shifting inline.\n\nFrom-SVN: r109879", "tree": {"sha": "416e28c3fd82ee7afda8b60e3c1b9cb322ccff20", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/416e28c3fd82ee7afda8b60e3c1b9cb322ccff20"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/71aa1a70296b6fcd35e4c4ac66dff26acd274590", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/71aa1a70296b6fcd35e4c4ac66dff26acd274590", "html_url": "https://github.com/Rust-GCC/gccrs/commit/71aa1a70296b6fcd35e4c4ac66dff26acd274590", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/71aa1a70296b6fcd35e4c4ac66dff26acd274590/comments", "author": {"login": "jakubjelinek", "id": 9370665, "node_id": "MDQ6VXNlcjkzNzA2NjU=", "avatar_url": "https://avatars.githubusercontent.com/u/9370665?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jakubjelinek", "html_url": "https://github.com/jakubjelinek", "followers_url": "https://api.github.com/users/jakubjelinek/followers", "following_url": "https://api.github.com/users/jakubjelinek/following{/other_user}", "gists_url": "https://api.github.com/users/jakubjelinek/gists{/gist_id}", "starred_url": "https://api.github.com/users/jakubjelinek/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jakubjelinek/subscriptions", "organizations_url": "https://api.github.com/users/jakubjelinek/orgs", "repos_url": "https://api.github.com/users/jakubjelinek/repos", "events_url": "https://api.github.com/users/jakubjelinek/events{/privacy}", "received_events_url": "https://api.github.com/users/jakubjelinek/received_events", "type": "User", "site_admin": false}, "committer": null, "parents": [{"sha": "db2acc366eb6b76887c8cdde6a6c95a9db03dfce", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/db2acc366eb6b76887c8cdde6a6c95a9db03dfce", "html_url": "https://github.com/Rust-GCC/gccrs/commit/db2acc366eb6b76887c8cdde6a6c95a9db03dfce"}], "stats": {"total": 82, "additions": 46, "deletions": 36}, "files": [{"sha": "13c279d3329318f9e6e2e87208b5efde576ea998", "filename": "libffi/ChangeLog", "status": "modified", "additions": 9, "deletions": 0, "changes": 9, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/71aa1a70296b6fcd35e4c4ac66dff26acd274590/libffi%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/71aa1a70296b6fcd35e4c4ac66dff26acd274590/libffi%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libffi%2FChangeLog?ref=71aa1a70296b6fcd35e4c4ac66dff26acd274590", "patch": "@@ -1,3 +1,12 @@\n+2006-01-18  Jakub Jelinek  <jakub@redhat.com>\n+\n+\t* src/powerpc/sysv.S (smst_two_register): Don't call __ashldi3,\n+\tinstead do the shifting inline.\n+\t* src/powerpc/ppc_closure.S (ffi_closure_SYSV): Don't compute %r5\n+\tshift count unconditionally.  Simplify load sequences for 1, 2, 3, 4\n+\tand 8 byte structs, for the remaining struct sizes don't call\n+\t__lshrdi3, instead do the shifting inline.\n+\n 2005-12-07  Thiemo Seufer  <ths@networkno.de>\n \n \t* src/mips/ffitarget.h: Remove obsolete sgidefs.h include. Add"}, {"sha": "370381378f91dafb77175dda2d26207c24160c12", "filename": "libffi/src/powerpc/ppc_closure.S", "status": "modified", "additions": 29, "deletions": 34, "changes": 63, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/71aa1a70296b6fcd35e4c4ac66dff26acd274590/libffi%2Fsrc%2Fpowerpc%2Fppc_closure.S", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/71aa1a70296b6fcd35e4c4ac66dff26acd274590/libffi%2Fsrc%2Fpowerpc%2Fppc_closure.S", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libffi%2Fsrc%2Fpowerpc%2Fppc_closure.S?ref=71aa1a70296b6fcd35e4c4ac66dff26acd274590", "patch": "@@ -63,19 +63,6 @@ ENTRY(ffi_closure_SYSV)\n \t# so use it to look up in a table\n \t# so we know how to deal with each type\n \n-\t# Extract the size of the return type for small structures.\n-\t# Then calculate (4 - size) and multiply the result by 8.\n-\t# This gives the value needed for the shift operation below.\n-\t# This part is only needed for FFI_SYSV and small structures.\n-\taddi\t%r5,%r3,-(FFI_SYSV_TYPE_SMALL_STRUCT)\n-\tcmpwi\tcr0,%r5,4\n-\tble\tcr0,.Lnext\n-\taddi\t%r5,%r5,-4\n-.Lnext:\n-\taddi\t%r5,%r5,-4\n-\tneg\t%r5,%r5\n-\tslwi\t%r5,%r5,3\n-\n \t# look up the proper starting point in table\n \t# by using return type as offset\n \taddi %r6,%r1,112   # get pointer to results area\n@@ -207,66 +194,66 @@ ENTRY(ffi_closure_SYSV)\n # case FFI_SYSV_TYPE_SMALL_STRUCT + 1. One byte struct.\n .Lret_type15:\n # fall through.\n-\tnop\n-\tnop\n+\tlbz %r3,0(%r6)\n+\tb .Lfinish\n \tnop\n \tnop\n \n # case FFI_SYSV_TYPE_SMALL_STRUCT + 2. Two byte struct.\n .Lret_type16:\n # fall through.\n-\tnop\n-\tnop\n+\tlhz %r3,0(%r6)\n+\tb .Lfinish\n \tnop\n \tnop\n \n # case FFI_SYSV_TYPE_SMALL_STRUCT + 3. Three byte struct.\n .Lret_type17:\n # fall through.\n-\tnop\n-\tnop\n-\tnop\n+\tlwz %r3,0(%r6)\n+\tsrwi %r3,%r3,8\n+\tb .Lfinish\n \tnop\n \n # case FFI_SYSV_TYPE_SMALL_STRUCT + 4. Four byte struct.\n .Lret_type18:\n # this one handles the structs from above too.\n \tlwz %r3,0(%r6)\n-\tsrw %r3,%r3,%r5\n \tb .Lfinish\n \tnop\n+\tnop\n \n # case FFI_SYSV_TYPE_SMALL_STRUCT + 5. Five byte struct.\n .Lret_type19:\n # fall through.\n-\tnop\n-\tnop\n-\tnop\n-\tnop\n+\tlwz %r3,0(%r6)\n+\tlwz %r4,4(%r6)\n+\tli %r5,24\n+\tb .Lstruct567\n \n # case FFI_SYSV_TYPE_SMALL_STRUCT + 6. Six byte struct.\n .Lret_type20:\n # fall through.\n-\tnop\n-\tnop\n-\tnop\n-\tnop\n+\tlwz %r3,0(%r6)\n+\tlwz %r4,4(%r6)\n+\tli %r5,16\n+\tb .Lstruct567\n \n # case FFI_SYSV_TYPE_SMALL_STRUCT + 7. Seven byte struct.\n .Lret_type21:\n # fall through.\n-\tnop\n-\tnop\n-\tnop\n-\tnop\n+\tlwz %r3,0(%r6)\n+\tlwz %r4,4(%r6)\n+\tli %r5,8\n+\tb .Lstruct567\n \n # case FFI_SYSV_TYPE_SMALL_STRUCT + 8. Eight byte struct.\n .Lret_type22:\n # this one handles the above unhandled structs.\n \tlwz %r3,0(%r6)\n \tlwz %r4,4(%r6)\n-\tbl __lshrdi3\t# libgcc function to shift r3/r4, shift value in r5.\n \tb .Lfinish\n+\tnop\n \n # case done\n .Lfinish:\n@@ -275,6 +262,14 @@ ENTRY(ffi_closure_SYSV)\n \tmtlr %r0\n \taddi %r1,%r1,144\n \tblr\n+\n+.Lstruct567:\n+\tsubfic %r0,%r5,32\n+\tsrw %r4,%r4,%r5\n+\tslw %r0,%r3,%r0\n+\tsrw %r3,%r3,%r5\n+\tor %r4,%r0,%r4\n+\tb .Lfinish\n END(ffi_closure_SYSV)\n \n \t.section\t\".eh_frame\",EH_FRAME_FLAGS,@progbits"}, {"sha": "6d5a707ec03cb7a392089f301ea4d56b0a3799c1", "filename": "libffi/src/powerpc/sysv.S", "status": "modified", "additions": 8, "deletions": 2, "changes": 10, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/71aa1a70296b6fcd35e4c4ac66dff26acd274590/libffi%2Fsrc%2Fpowerpc%2Fsysv.S", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/71aa1a70296b6fcd35e4c4ac66dff26acd274590/libffi%2Fsrc%2Fpowerpc%2Fsysv.S", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libffi%2Fsrc%2Fpowerpc%2Fsysv.S?ref=71aa1a70296b6fcd35e4c4ac66dff26acd274590", "patch": "@@ -140,8 +140,14 @@ L(smst_one_register):\n \tb\tL(done_return_value)\n L(smst_two_register):\n \trlwinm  %r5,%r31,5+23,32-5,31 /* Extract the value to shift.  */\n-\tbl\t__ashldi3  /* libgcc function to shift r3/r4,\n-\t\t\t      shift value in r5.  */\n+\tcmpwi\t%r5,0\n+\tsubfic\t%r9,%r5,32\n+\tslw\t%r29,%r3,%r5\n+\tsrw\t%r9,%r4,%r9\n+\tbeq-\tL(smst_8byte)\n+\tor\t%r3,%r9,%r29\n+\tslw\t%r4,%r4,%r5\n+L(smst_8byte):\n \tstw\t%r3,0(%r30)\n \tstw\t%r4,4(%r30)\n \tb\tL(done_return_value)"}]}