{"sha": "573d8a243dd0493796ab9de876690b888c41b520", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6NTczZDhhMjQzZGQwNDkzNzk2YWI5ZGU4NzY2OTBiODg4YzQxYjUyMA==", "commit": {"author": {"name": "Jakub Jelinek", "email": "jakub@redhat.com", "date": "2018-05-10T07:38:24Z"}, "committer": {"name": "Jakub Jelinek", "email": "jakub@gcc.gnu.org", "date": "2018-05-10T07:38:24Z"}, "message": "re PR tree-optimization/85699 (gcc.dg/nextafter-2.c fail)\n\n\tPR tree-optimization/85699\n\t* gcc.dg/nextafter-1.c (NO_LONG_DOUBLE): Define if not defined.  Use\n\t!NO_LONG_DOUBLE instead of __LDBL_MANT_DIG__ != 106.\n\t* gcc.dg/nextafter-2.c: Include stdlib.h.  For glibc < 2.24 define\n\tNO_LONG_DOUBLE to 1 before including nextafter-1.c.\n\nFrom-SVN: r260107", "tree": {"sha": "8543a982dc794492df96a04fcd6d8c1cba6fa814", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/8543a982dc794492df96a04fcd6d8c1cba6fa814"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/573d8a243dd0493796ab9de876690b888c41b520", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/573d8a243dd0493796ab9de876690b888c41b520", "html_url": "https://github.com/Rust-GCC/gccrs/commit/573d8a243dd0493796ab9de876690b888c41b520", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/573d8a243dd0493796ab9de876690b888c41b520/comments", "author": {"login": "jakubjelinek", "id": 9370665, "node_id": "MDQ6VXNlcjkzNzA2NjU=", "avatar_url": "https://avatars.githubusercontent.com/u/9370665?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jakubjelinek", "html_url": "https://github.com/jakubjelinek", "followers_url": "https://api.github.com/users/jakubjelinek/followers", "following_url": "https://api.github.com/users/jakubjelinek/following{/other_user}", "gists_url": "https://api.github.com/users/jakubjelinek/gists{/gist_id}", "starred_url": "https://api.github.com/users/jakubjelinek/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jakubjelinek/subscriptions", "organizations_url": "https://api.github.com/users/jakubjelinek/orgs", "repos_url": "https://api.github.com/users/jakubjelinek/repos", "events_url": "https://api.github.com/users/jakubjelinek/events{/privacy}", "received_events_url": "https://api.github.com/users/jakubjelinek/received_events", "type": "User", "site_admin": false}, "committer": null, "parents": [{"sha": "86c12f7629b43cbc259d8bbcb1875fff1f8e6a4f", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/86c12f7629b43cbc259d8bbcb1875fff1f8e6a4f", "html_url": "https://github.com/Rust-GCC/gccrs/commit/86c12f7629b43cbc259d8bbcb1875fff1f8e6a4f"}], "stats": {"total": 24, "additions": 22, "deletions": 2}, "files": [{"sha": "b09ce3ede2de2ceb0c7292d13b93184dc88a6cb4", "filename": "gcc/testsuite/ChangeLog", "status": "modified", "additions": 8, "deletions": 0, "changes": 8, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/573d8a243dd0493796ab9de876690b888c41b520/gcc%2Ftestsuite%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/573d8a243dd0493796ab9de876690b888c41b520/gcc%2Ftestsuite%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2FChangeLog?ref=573d8a243dd0493796ab9de876690b888c41b520", "patch": "@@ -1,3 +1,11 @@\n+2018-05-10  Jakub Jelinek  <jakub@redhat.com>\n+\n+\tPR tree-optimization/85699\n+\t* gcc.dg/nextafter-1.c (NO_LONG_DOUBLE): Define if not defined.  Use\n+\t!NO_LONG_DOUBLE instead of __LDBL_MANT_DIG__ != 106.\n+\t* gcc.dg/nextafter-2.c: Include stdlib.h.  For glibc < 2.24 define\n+\tNO_LONG_DOUBLE to 1 before including nextafter-1.c.\n+\n 2018-05-10  Eric Botcazou  <ebotcazou@adacore.com>\n \n \t* g++.dg/tls/pr85400.C: New test."}, {"sha": "a768574b3422aeeb8c34dfca63fb1e8f9c22061f", "filename": "gcc/testsuite/gcc.dg/nextafter-1.c", "status": "modified", "additions": 5, "deletions": 2, "changes": 7, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/573d8a243dd0493796ab9de876690b888c41b520/gcc%2Ftestsuite%2Fgcc.dg%2Fnextafter-1.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/573d8a243dd0493796ab9de876690b888c41b520/gcc%2Ftestsuite%2Fgcc.dg%2Fnextafter-1.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgcc.dg%2Fnextafter-1.c?ref=573d8a243dd0493796ab9de876690b888c41b520", "patch": "@@ -20,6 +20,9 @@ long double nexttowardl (long double, long double);\n #ifndef NEED_EXC\n #define NEED_EXC 0\n #endif\n+#ifndef NO_LONG_DOUBLE\n+#define NO_LONG_DOUBLE (__LDBL_MANT_DIG__ == 106)\n+#endif\n \n #define TEST(name, fn, type, L1, L2, l1, l2, MIN1,\t\t\t     \\\n \t     MAX1, DENORM_MIN1, EPSILON1, MIN2, MAX2, DENORM_MIN2)\t     \\\n@@ -129,7 +132,7 @@ TEST (test1, nextafterf, float, F, F, f, f, __FLT_MIN__, __FLT_MAX__,\n TEST (test2, nextafter, double, , , , , __DBL_MIN__, __DBL_MAX__,\n       __DBL_DENORM_MIN__, __DBL_EPSILON__, __DBL_MIN__, __DBL_MAX__,\n       __DBL_DENORM_MIN__)\n-#if __LDBL_MANT_DIG__ != 106\n+#if !NO_LONG_DOUBLE\n TEST (test3, nextafterl, long double, L, L, l, l, __LDBL_MIN__, __LDBL_MAX__,\n       __LDBL_DENORM_MIN__, __LDBL_EPSILON__, __LDBL_MIN__, __LDBL_MAX__,\n       __LDBL_DENORM_MIN__)\n@@ -149,7 +152,7 @@ main ()\n {\n   test1 ();\n   test2 ();\n-#if __LDBL_MANT_DIG__ != 106\n+#if !NO_LONG_DOUBLE\n   test3 ();\n   test4 ();\n   test5 ();"}, {"sha": "0bde721b338a637101c87c0af012759100ac7a82", "filename": "gcc/testsuite/gcc.dg/nextafter-2.c", "status": "modified", "additions": 9, "deletions": 0, "changes": 9, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/573d8a243dd0493796ab9de876690b888c41b520/gcc%2Ftestsuite%2Fgcc.dg%2Fnextafter-2.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/573d8a243dd0493796ab9de876690b888c41b520/gcc%2Ftestsuite%2Fgcc.dg%2Fnextafter-2.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgcc.dg%2Fnextafter-2.c?ref=573d8a243dd0493796ab9de876690b888c41b520", "patch": "@@ -5,4 +5,13 @@\n /* { dg-add-options ieee } */\n /* { dg-add-options c99_runtime } */\n \n+#include <stdlib.h>\n+\n+#if defined(__GLIBC__) && defined(__GLIBC_PREREQ)\n+# if !__GLIBC_PREREQ (2, 24)\n+/* Workaround buggy nextafterl in glibc 2.23 and earlier,\n+   see https://sourceware.org/bugzilla/show_bug.cgi?id=20205  */\n+#  define NO_LONG_DOUBLE 1\n+# endif\n+#endif\n #include \"nextafter-1.c\""}]}