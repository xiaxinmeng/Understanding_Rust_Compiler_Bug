{"sha": "cd7484d05cd4b7a9d741fe8bf6c4525406ed7620", "node_id": "C_kwDOANBUbNoAKGNkNzQ4NGQwNWNkNGI3YTlkNzQxZmU4YmY2YzQ1MjU0MDZlZDc2MjA", "commit": {"author": {"name": "Chung-Lin Tang", "email": "cltang@codesourcery.com", "date": "2022-01-14T13:58:34Z"}, "committer": {"name": "Chung-Lin Tang", "email": "cltang@codesourcery.com", "date": "2022-01-14T13:58:34Z"}, "message": "openmp: Fix ICE in [PR103705]\n\nFix ICE for cases like:\n  #pragma omp target update from(s[0].a[0:1])\n\nwhere multiple ARRAY_REF nodes exist and require more than one peeling\nduring [c_]finish_omp_clauses.\n\n\tPR c++/103705\n\ngcc/c/ChangeLog:\n\n\t* c-typeck.c (c_finish_omp_clauses): Also continue peeling off of\n\touter node for ARRAY_REFs.\n\ngcc/cp/ChangeLog:\n\n\t* semantics.c (finish_omp_clauses): Also continue peeling off of\n\touter node for ARRAY_REFs.\n\ngcc/testsuite/ChangeLog:\n\n\t* c-c++-common/gomp/pr103705.c: New test.", "tree": {"sha": "8d96741268638619e714f5d62017838f0a77fc9d", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/8d96741268638619e714f5d62017838f0a77fc9d"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/cd7484d05cd4b7a9d741fe8bf6c4525406ed7620", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/cd7484d05cd4b7a9d741fe8bf6c4525406ed7620", "html_url": "https://github.com/Rust-GCC/gccrs/commit/cd7484d05cd4b7a9d741fe8bf6c4525406ed7620", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/cd7484d05cd4b7a9d741fe8bf6c4525406ed7620/comments", "author": {"login": "cltang", "id": 4055966, "node_id": "MDQ6VXNlcjQwNTU5NjY=", "avatar_url": "https://avatars.githubusercontent.com/u/4055966?v=4", "gravatar_id": "", "url": "https://api.github.com/users/cltang", "html_url": "https://github.com/cltang", "followers_url": "https://api.github.com/users/cltang/followers", "following_url": "https://api.github.com/users/cltang/following{/other_user}", "gists_url": "https://api.github.com/users/cltang/gists{/gist_id}", "starred_url": "https://api.github.com/users/cltang/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/cltang/subscriptions", "organizations_url": "https://api.github.com/users/cltang/orgs", "repos_url": "https://api.github.com/users/cltang/repos", "events_url": "https://api.github.com/users/cltang/events{/privacy}", "received_events_url": "https://api.github.com/users/cltang/received_events", "type": "User", "site_admin": false}, "committer": {"login": "cltang", "id": 4055966, "node_id": "MDQ6VXNlcjQwNTU5NjY=", "avatar_url": "https://avatars.githubusercontent.com/u/4055966?v=4", "gravatar_id": "", "url": "https://api.github.com/users/cltang", "html_url": "https://github.com/cltang", "followers_url": "https://api.github.com/users/cltang/followers", "following_url": "https://api.github.com/users/cltang/following{/other_user}", "gists_url": "https://api.github.com/users/cltang/gists{/gist_id}", "starred_url": "https://api.github.com/users/cltang/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/cltang/subscriptions", "organizations_url": "https://api.github.com/users/cltang/orgs", "repos_url": "https://api.github.com/users/cltang/repos", "events_url": "https://api.github.com/users/cltang/events{/privacy}", "received_events_url": "https://api.github.com/users/cltang/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "5d7de2bf3b7c5ed1c929098243832b59648bcc67", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/5d7de2bf3b7c5ed1c929098243832b59648bcc67", "html_url": "https://github.com/Rust-GCC/gccrs/commit/5d7de2bf3b7c5ed1c929098243832b59648bcc67"}], "stats": {"total": 20, "additions": 18, "deletions": 2}, "files": [{"sha": "ac6618eca5c30e2f8ddbc861a9e5fdc3da4928d7", "filename": "gcc/c/c-typeck.c", "status": "modified", "additions": 2, "deletions": 1, "changes": 3, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/cd7484d05cd4b7a9d741fe8bf6c4525406ed7620/gcc%2Fc%2Fc-typeck.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/cd7484d05cd4b7a9d741fe8bf6c4525406ed7620/gcc%2Fc%2Fc-typeck.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fc%2Fc-typeck.c?ref=cd7484d05cd4b7a9d741fe8bf6c4525406ed7620", "patch": "@@ -14929,7 +14929,8 @@ c_finish_omp_clauses (tree clauses, enum c_omp_region_type ort)\n \t\t\t\tt = TREE_OPERAND (t, 0);\n \t\t\t    }\n \t\t\t}\n-\t\t      while (TREE_CODE (t) == COMPONENT_REF);\n+\t\t      while (TREE_CODE (t) == COMPONENT_REF\n+\t\t\t     || TREE_CODE (t) == ARRAY_REF);\n \n \t\t      if (OMP_CLAUSE_CODE (c) == OMP_CLAUSE_MAP\n \t\t\t  && OMP_CLAUSE_MAP_IMPLICIT (c)"}, {"sha": "089ea5f49bb066e6f74ab8c49618e1230add9cb8", "filename": "gcc/cp/semantics.c", "status": "modified", "additions": 2, "deletions": 1, "changes": 3, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/cd7484d05cd4b7a9d741fe8bf6c4525406ed7620/gcc%2Fcp%2Fsemantics.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/cd7484d05cd4b7a9d741fe8bf6c4525406ed7620/gcc%2Fcp%2Fsemantics.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fcp%2Fsemantics.c?ref=cd7484d05cd4b7a9d741fe8bf6c4525406ed7620", "patch": "@@ -7942,7 +7942,8 @@ finish_omp_clauses (tree clauses, enum c_omp_region_type ort)\n \t\t\t\tt = TREE_OPERAND (t, 0);\n \t\t\t    }\n \t\t\t}\n-\t\t      while (TREE_CODE (t) == COMPONENT_REF);\n+\t\t      while (TREE_CODE (t) == COMPONENT_REF\n+\t\t\t     || TREE_CODE (t) == ARRAY_REF);\n \n \t\t      if (OMP_CLAUSE_CODE (c) == OMP_CLAUSE_MAP\n \t\t\t  && OMP_CLAUSE_MAP_IMPLICIT (c)"}, {"sha": "bf4c7066d28b592566745dad3ec30b1106062add", "filename": "gcc/testsuite/c-c++-common/gomp/pr103705.c", "status": "added", "additions": 14, "deletions": 0, "changes": 14, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/cd7484d05cd4b7a9d741fe8bf6c4525406ed7620/gcc%2Ftestsuite%2Fc-c%2B%2B-common%2Fgomp%2Fpr103705.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/cd7484d05cd4b7a9d741fe8bf6c4525406ed7620/gcc%2Ftestsuite%2Fc-c%2B%2B-common%2Fgomp%2Fpr103705.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fc-c%2B%2B-common%2Fgomp%2Fpr103705.c?ref=cd7484d05cd4b7a9d741fe8bf6c4525406ed7620", "patch": "@@ -0,0 +1,14 @@\n+/* PR c++/103705 */\n+/* { dg-do compile } */\n+\n+struct S\n+{\n+  int a[2];\n+};\n+\n+int main (void)\n+{\n+  struct S s[1];\n+  #pragma omp target update from(s[0].a[0:1])\n+  return 0;\n+}"}]}