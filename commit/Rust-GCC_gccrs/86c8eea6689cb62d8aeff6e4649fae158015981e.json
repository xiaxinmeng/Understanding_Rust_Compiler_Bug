{"sha": "86c8eea6689cb62d8aeff6e4649fae158015981e", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6ODZjOGVlYTY2ODljYjYyZDhhZWZmNmU0NjQ5ZmFlMTU4MDE1OTgxZQ==", "commit": {"author": {"name": "Richard Biener", "email": "rguenther@suse.de", "date": "2018-08-02T13:19:50Z"}, "committer": {"name": "Richard Biener", "email": "rguenth@gcc.gnu.org", "date": "2018-08-02T13:19:50Z"}, "message": "re PR tree-optimization/86816 (ICE: SIGSEGV in tree-ssa-pre / tail_merge_optimize)\n\n2018-08-02  Richard Biener  <rguenther@suse.de>\n\n\tPR tree-optimization/86816\n\t* tree-ssa-tail-merge.c (tail_merge_valueize): New function\n\twhich checks for value availability before querying it.\n\t(gvn_uses_equal): Use it.\n\t(same_succ_hash): Likewise.\n\t(gimple_equal_p): Likewise.\n\n\t* g++.dg/torture/pr86816.C: New testcase.\n\nFrom-SVN: r263257", "tree": {"sha": "83d66b30f4b86aa5c0f7281446896f8a4c8e532e", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/83d66b30f4b86aa5c0f7281446896f8a4c8e532e"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/86c8eea6689cb62d8aeff6e4649fae158015981e", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/86c8eea6689cb62d8aeff6e4649fae158015981e", "html_url": "https://github.com/Rust-GCC/gccrs/commit/86c8eea6689cb62d8aeff6e4649fae158015981e", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/86c8eea6689cb62d8aeff6e4649fae158015981e/comments", "author": {"login": "rguenth", "id": 2046526, "node_id": "MDQ6VXNlcjIwNDY1MjY=", "avatar_url": "https://avatars.githubusercontent.com/u/2046526?v=4", "gravatar_id": "", "url": "https://api.github.com/users/rguenth", "html_url": "https://github.com/rguenth", "followers_url": "https://api.github.com/users/rguenth/followers", "following_url": "https://api.github.com/users/rguenth/following{/other_user}", "gists_url": "https://api.github.com/users/rguenth/gists{/gist_id}", "starred_url": "https://api.github.com/users/rguenth/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/rguenth/subscriptions", "organizations_url": "https://api.github.com/users/rguenth/orgs", "repos_url": "https://api.github.com/users/rguenth/repos", "events_url": "https://api.github.com/users/rguenth/events{/privacy}", "received_events_url": "https://api.github.com/users/rguenth/received_events", "type": "User", "site_admin": false}, "committer": null, "parents": [{"sha": "593d93cb0aa00837906d5d1bebb018a42721a114", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/593d93cb0aa00837906d5d1bebb018a42721a114", "html_url": "https://github.com/Rust-GCC/gccrs/commit/593d93cb0aa00837906d5d1bebb018a42721a114"}], "stats": {"total": 77, "additions": 74, "deletions": 3}, "files": [{"sha": "e62b9efb2edd873c610257dafcaea726964e84e0", "filename": "gcc/ChangeLog", "status": "modified", "additions": 9, "deletions": 0, "changes": 9, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/86c8eea6689cb62d8aeff6e4649fae158015981e/gcc%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/86c8eea6689cb62d8aeff6e4649fae158015981e/gcc%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2FChangeLog?ref=86c8eea6689cb62d8aeff6e4649fae158015981e", "patch": "@@ -1,3 +1,12 @@\n+2018-08-02  Richard Biener  <rguenther@suse.de>\n+\n+\tPR tree-optimization/86816\n+\t* tree-ssa-tail-merge.c (tail_merge_valueize): New function\n+\twhich checks for value availability before querying it.\n+\t(gvn_uses_equal): Use it.\n+\t(same_succ_hash): Likewise.\n+\t(gimple_equal_p): Likewise.\n+\n 2018-08-02  Nick Clifton  <nickc@redhat.com>\n \n \tPR target/86789"}, {"sha": "b0e7505500d0527d1ae73c0c87e6f4f628981243", "filename": "gcc/testsuite/ChangeLog", "status": "modified", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/86c8eea6689cb62d8aeff6e4649fae158015981e/gcc%2Ftestsuite%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/86c8eea6689cb62d8aeff6e4649fae158015981e/gcc%2Ftestsuite%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2FChangeLog?ref=86c8eea6689cb62d8aeff6e4649fae158015981e", "patch": "@@ -1,3 +1,8 @@\n+2018-08-02  Richard Biener  <rguenther@suse.de>\n+\n+\tPR tree-optimization/86816\n+\t* g++.dg/torture/pr86816.C: New testcase.\n+\n 2018-08-02  Richard Sandiford  <richard.sandiford@arm.com>\n \n \t* gcc.target/aarch64/f16_mov_immediate_1.c: Expect fmov immediate"}, {"sha": "604a7d48cd13e0d9c4f894fa74a4b685e5376ce0", "filename": "gcc/testsuite/g++.dg/torture/pr86816.C", "status": "added", "additions": 42, "deletions": 0, "changes": 42, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/86c8eea6689cb62d8aeff6e4649fae158015981e/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Ftorture%2Fpr86816.C", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/86c8eea6689cb62d8aeff6e4649fae158015981e/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Ftorture%2Fpr86816.C", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Ftorture%2Fpr86816.C?ref=86c8eea6689cb62d8aeff6e4649fae158015981e", "patch": "@@ -0,0 +1,42 @@\n+// { dg-do compile }\n+\n+class Signal\n+{\n+public:\n+    int  m_Mode;\n+};\n+\n+class Ctx\n+{\n+public:\n+    bool  m_Invert;\n+\n+    void DoSomething();\n+};\n+\n+class Test\n+{\n+  void TestIce( Ctx& ctx, Signal* sig);\n+};\n+\n+void Test::TestIce( Ctx& ctx, Signal* sig)\n+{\n+  int invert = false;\n+\n+  if( ! ctx.m_Invert)\n+    invert = ! invert;\n+\n+  switch( sig->m_Mode)\n+    {\n+    case 1:\n+    invert = ! invert;\n+    break;\n+\n+    case 2:\n+    invert = true;\n+    break;\n+    }\n+\n+  if( invert)\n+    ctx.DoSomething();\n+}"}, {"sha": "837679a63700e4b1513c30785769a877314a9fbf", "filename": "gcc/tree-ssa-tail-merge.c", "status": "modified", "additions": 18, "deletions": 3, "changes": 21, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/86c8eea6689cb62d8aeff6e4649fae158015981e/gcc%2Ftree-ssa-tail-merge.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/86c8eea6689cb62d8aeff6e4649fae158015981e/gcc%2Ftree-ssa-tail-merge.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftree-ssa-tail-merge.c?ref=86c8eea6689cb62d8aeff6e4649fae158015981e", "patch": "@@ -286,6 +286,21 @@ struct aux_bb_info\n #define BB_VOP_AT_EXIT(bb) (((struct aux_bb_info *)bb->aux)->vop_at_exit)\n #define BB_DEP_BB(bb) (((struct aux_bb_info *)bb->aux)->dep_bb)\n \n+/* Valueization helper querying the VN lattice.  */\n+\n+static tree\n+tail_merge_valueize (tree name)\n+{\n+  if (TREE_CODE (name) == SSA_NAME\n+      && has_VN_INFO (name))\n+    {\n+      tree tem = VN_INFO (name)->valnum;\n+      if (tem != VN_TOP)\n+\treturn tem;\n+    }\n+  return name;\n+}\n+\n /* Returns true if the only effect a statement STMT has, is to define locally\n    used SSA_NAMEs.  */\n \n@@ -371,7 +386,7 @@ gvn_uses_equal (tree val1, tree val2)\n   if (val1 == val2)\n     return true;\n \n-  if (vn_valueize (val1) != vn_valueize (val2))\n+  if (tail_merge_valueize (val1) != tail_merge_valueize (val2))\n     return false;\n \n   return ((TREE_CODE (val1) == SSA_NAME || CONSTANT_CLASS_P (val1))\n@@ -481,7 +496,7 @@ same_succ_hash (const same_succ *e)\n       for (i = 0; i < gimple_call_num_args (stmt); i++)\n \t{\n \t  arg = gimple_call_arg (stmt, i);\n-\t  arg = vn_valueize (arg);\n+\t  arg = tail_merge_valueize (arg);\n \t  inchash::add_expr (arg, hstate);\n \t}\n     }\n@@ -1147,7 +1162,7 @@ gimple_equal_p (same_succ *same_succ, gimple *s1, gimple *s2)\n       if (lhs1 == NULL_TREE || lhs2 == NULL_TREE)\n \treturn false;\n       if (TREE_CODE (lhs1) == SSA_NAME && TREE_CODE (lhs2) == SSA_NAME)\n-\treturn vn_valueize (lhs1) == vn_valueize (lhs2);\n+\treturn tail_merge_valueize (lhs1) == tail_merge_valueize (lhs2);\n       return operand_equal_p (lhs1, lhs2, 0);\n \n     case GIMPLE_ASSIGN:"}]}