{"sha": "9f4edfc1fb80211f8663f978b7144e7e9d9df743", "node_id": "C_kwDOANBUbNoAKDlmNGVkZmMxZmI4MDIxMWY4NjYzZjk3OGI3MTQ0ZTdlOWQ5ZGY3NDM", "commit": {"author": {"name": "Aldy Hernandez", "email": "aldyh@redhat.com", "date": "2021-10-27T14:24:53Z"}, "committer": {"name": "Aldy Hernandez", "email": "aldyh@redhat.com", "date": "2021-10-27T18:14:15Z"}, "message": "Kill second order relations in the path solver.\n\nMy upcoming work replacing the VRP threaders with a fully resolving\nbackward threader has tripped over various corner cases in the path\nsensitive relation oracle.  This patch kills second order relations when\nwe kill a relation.\n\nTested on x86-64 and ppc64le Linux.\n\nCo-authored-by: Andrew MacLeod <amacleod@redhat.com>\n\ngcc/ChangeLog:\n\n\t* value-relation.cc (path_oracle::killing_def): Kill second\n\torder relations.", "tree": {"sha": "8bec933a210a7686220ac5530158ccb25000b26a", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/8bec933a210a7686220ac5530158ccb25000b26a"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/9f4edfc1fb80211f8663f978b7144e7e9d9df743", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/9f4edfc1fb80211f8663f978b7144e7e9d9df743", "html_url": "https://github.com/Rust-GCC/gccrs/commit/9f4edfc1fb80211f8663f978b7144e7e9d9df743", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/9f4edfc1fb80211f8663f978b7144e7e9d9df743/comments", "author": {"login": "aldyh", "id": 12937877, "node_id": "MDQ6VXNlcjEyOTM3ODc3", "avatar_url": "https://avatars.githubusercontent.com/u/12937877?v=4", "gravatar_id": "", "url": "https://api.github.com/users/aldyh", "html_url": "https://github.com/aldyh", "followers_url": "https://api.github.com/users/aldyh/followers", "following_url": "https://api.github.com/users/aldyh/following{/other_user}", "gists_url": "https://api.github.com/users/aldyh/gists{/gist_id}", "starred_url": "https://api.github.com/users/aldyh/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/aldyh/subscriptions", "organizations_url": "https://api.github.com/users/aldyh/orgs", "repos_url": "https://api.github.com/users/aldyh/repos", "events_url": "https://api.github.com/users/aldyh/events{/privacy}", "received_events_url": "https://api.github.com/users/aldyh/received_events", "type": "User", "site_admin": false}, "committer": {"login": "aldyh", "id": 12937877, "node_id": "MDQ6VXNlcjEyOTM3ODc3", "avatar_url": "https://avatars.githubusercontent.com/u/12937877?v=4", "gravatar_id": "", "url": "https://api.github.com/users/aldyh", "html_url": "https://github.com/aldyh", "followers_url": "https://api.github.com/users/aldyh/followers", "following_url": "https://api.github.com/users/aldyh/following{/other_user}", "gists_url": "https://api.github.com/users/aldyh/gists{/gist_id}", "starred_url": "https://api.github.com/users/aldyh/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/aldyh/subscriptions", "organizations_url": "https://api.github.com/users/aldyh/orgs", "repos_url": "https://api.github.com/users/aldyh/repos", "events_url": "https://api.github.com/users/aldyh/events{/privacy}", "received_events_url": "https://api.github.com/users/aldyh/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "a1957c9755418f0f45a0bac296f61f486952960e", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/a1957c9755418f0f45a0bac296f61f486952960e", "html_url": "https://github.com/Rust-GCC/gccrs/commit/a1957c9755418f0f45a0bac296f61f486952960e"}], "stats": {"total": 21, "additions": 20, "deletions": 1}, "files": [{"sha": "0ad4f7a9495315ab849efa6b44fd45c8e92b3afc", "filename": "gcc/value-relation.cc", "status": "modified", "additions": 20, "deletions": 1, "changes": 21, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/9f4edfc1fb80211f8663f978b7144e7e9d9df743/gcc%2Fvalue-relation.cc", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/9f4edfc1fb80211f8663f978b7144e7e9d9df743/gcc%2Fvalue-relation.cc", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fvalue-relation.cc?ref=9f4edfc1fb80211f8663f978b7144e7e9d9df743", "patch": "@@ -1297,15 +1297,34 @@ path_oracle::killing_def (tree ssa)\n       fprintf (dump_file, \"\\n\");\n     }\n \n+  unsigned v = SSA_NAME_VERSION (ssa);\n   bitmap b = BITMAP_ALLOC (&m_bitmaps);\n-  bitmap_set_bit (b, SSA_NAME_VERSION (ssa));\n+  bitmap_set_bit (b, v);\n   equiv_chain *ptr = (equiv_chain *) obstack_alloc (&m_chain_obstack,\n \t\t\t\t\t\t    sizeof (equiv_chain));\n   ptr->m_names = b;\n   ptr->m_bb = NULL;\n   ptr->m_next = m_equiv.m_next;\n   m_equiv.m_next = ptr;\n   bitmap_ior_into (m_equiv.m_names, b);\n+\n+  // Walk the relation list an remove SSA from any relations.\n+  if (!bitmap_bit_p (m_relations.m_names, v))\n+    return;\n+\n+  bitmap_clear_bit (m_relations.m_names, v);\n+  relation_chain **prev = &(m_relations.m_head);\n+  relation_chain *next = NULL;\n+  for (relation_chain *ptr = m_relations.m_head; ptr; ptr = next)\n+    {\n+      gcc_checking_assert (*prev == ptr);\n+      next = ptr->m_next;\n+      if (SSA_NAME_VERSION (ptr->op1 ()) == v\n+\t  || SSA_NAME_VERSION (ptr->op2 ()) == v)\n+\t*prev = ptr->m_next;\n+      else\n+\tprev = &(ptr->m_next);\n+    }\n }\n \n // Register relation K between SSA1 and SSA2, resolving unknowns by"}]}