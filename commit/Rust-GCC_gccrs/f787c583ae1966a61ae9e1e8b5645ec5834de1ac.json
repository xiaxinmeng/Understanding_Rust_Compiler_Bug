{"sha": "f787c583ae1966a61ae9e1e8b5645ec5834de1ac", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6Zjc4N2M1ODNhZTE5NjZhNjFhZTllMWU4YjU2NDVlYzU4MzRkZTFhYw==", "commit": {"author": {"name": "Zack Weinberg", "email": "zack@wolery.cumb.org", "date": "2000-04-07T21:09:51Z"}, "committer": {"name": "Zack Weinberg", "email": "zack@gcc.gnu.org", "date": "2000-04-07T21:09:51Z"}, "message": "cpplib.c (do_elif): Skip the rest of the line if we're not going to bother evaluating it.\n\n\t* cpplib.c (do_elif): Skip the rest of the line if we're\n\tnot going to bother evaluating it.\n\t(skip_if_group): Clear pfile->only_seen_white.  Reorder loop\n\tto avoid pointless calls to the lexer.\n\n\t* gcc.dg/cpp-mi2.c: New test.\n\t* gcc.dg/cpp-mi2[abc].h: New files.\n\nFrom-SVN: r33008", "tree": {"sha": "1cdc2119b4eff8f84b844f88f3a85efa4575cb1e", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/1cdc2119b4eff8f84b844f88f3a85efa4575cb1e"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/f787c583ae1966a61ae9e1e8b5645ec5834de1ac", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/f787c583ae1966a61ae9e1e8b5645ec5834de1ac", "html_url": "https://github.com/Rust-GCC/gccrs/commit/f787c583ae1966a61ae9e1e8b5645ec5834de1ac", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/f787c583ae1966a61ae9e1e8b5645ec5834de1ac/comments", "author": null, "committer": null, "parents": [{"sha": "fbc18d1984e7b4c919f7e5a3aa05e0287270785a", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/fbc18d1984e7b4c919f7e5a3aa05e0287270785a", "html_url": "https://github.com/Rust-GCC/gccrs/commit/fbc18d1984e7b4c919f7e5a3aa05e0287270785a"}], "stats": {"total": 78, "additions": 67, "deletions": 11}, "files": [{"sha": "be0f9982c84aa6643f27278cb4035f49774c81e1", "filename": "gcc/ChangeLog", "status": "modified", "additions": 7, "deletions": 0, "changes": 7, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/f787c583ae1966a61ae9e1e8b5645ec5834de1ac/gcc%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/f787c583ae1966a61ae9e1e8b5645ec5834de1ac/gcc%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2FChangeLog?ref=f787c583ae1966a61ae9e1e8b5645ec5834de1ac", "patch": "@@ -1,3 +1,10 @@\n+2000-04-07  Zack Weinberg  <zack@wolery.cumb.org>\n+\n+\t* cpplib.c (do_elif): Skip the rest of the line if we're\n+\tnot going to bother evaluating it.\n+\t(skip_if_group): Clear pfile->only_seen_white.  Reorder loop\n+\tto avoid pointless calls to the lexer.\n+\n Fri Apr  7 11:50:54 2000  Jim Wilson  <wilson@cygnus.com>\n \n \t* config/ia64/ia64.c: Delete stdio.h and ctype.h includes."}, {"sha": "babd20e8b4cb6ae8377cf53c6497fd95abb94a98", "filename": "gcc/cpplib.c", "status": "modified", "additions": 17, "deletions": 11, "changes": 28, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/f787c583ae1966a61ae9e1e8b5645ec5834de1ac/gcc%2Fcpplib.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/f787c583ae1966a61ae9e1e8b5645ec5834de1ac/gcc%2Fcpplib.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fcpplib.c?ref=f787c583ae1966a61ae9e1e8b5645ec5834de1ac", "patch": "@@ -1266,7 +1266,10 @@ do_elif (pfile)\n     }\n \n   if (pfile->if_stack->if_succeeded)\n-    return skip_if_group (pfile);\n+    {\n+      _cpp_skip_rest_of_line (pfile);\n+      return skip_if_group (pfile);\n+    }\n   if (_cpp_parse_expr (pfile) == 0)\n     return skip_if_group (pfile);\n \n@@ -1498,11 +1501,24 @@ skip_if_group (pfile)\n   long old_written;\n   int ret = 0;\n \n+  /* We are no longer at the start of the file.  */\n+  pfile->only_seen_white = 0;\n+\n   old_written = CPP_WRITTEN (pfile);\n   pfile->no_macro_expand++;\n   CPP_OPTION (pfile, no_line_commands)++;\n   for (;;)\n     {\n+      /* We are at the end of a line.  Only cpp_get_token knows how to\n+\t advance the line number correctly.  */\n+      token = cpp_get_token (pfile);\n+      if (token == CPP_POP)\n+\tbreak;  /* Caller will issue error.  */\n+      \n+      else if (token != CPP_VSPACE)\n+\tcpp_ice (pfile, \"cpp_get_token returned %d in skip_if_group\", token);\n+      CPP_SET_WRITTEN (pfile, old_written);\n+\n       token = _cpp_get_directive_token (pfile);\n \n       if (token == CPP_DIRECTIVE)\n@@ -1514,16 +1530,6 @@ skip_if_group (pfile)\n \n       if (token != CPP_VSPACE)\n \t_cpp_skip_rest_of_line (pfile);\n-\n-      /* Only cpp_get_token knows how to advance the line number\n-\t properly.  */\n-      token = cpp_get_token (pfile);\n-      if (token == CPP_POP)\n-\tbreak;  /* Caller will issue error.  */\n-      \n-      else if (token != CPP_VSPACE)\n-\tcpp_ice (pfile, \"cpp_get_token returned %d in skip_if_group\", token);\n-      CPP_SET_WRITTEN (pfile, old_written);\n     }\n   CPP_SET_WRITTEN (pfile, old_written);\n   pfile->no_macro_expand--;"}, {"sha": "afce1fbac9f8bed1aa8045a550db129a5f5cabff", "filename": "gcc/testsuite/ChangeLog", "status": "modified", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/f787c583ae1966a61ae9e1e8b5645ec5834de1ac/gcc%2Ftestsuite%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/f787c583ae1966a61ae9e1e8b5645ec5834de1ac/gcc%2Ftestsuite%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2FChangeLog?ref=f787c583ae1966a61ae9e1e8b5645ec5834de1ac", "patch": "@@ -1,3 +1,8 @@\n+2000-04-07  Zack Weinberg  <zack@wolery.cumb.org>\n+\n+\t* gcc.dg/cpp-mi2.c: New test.\n+\t* gcc.dg/cpp-mi2[abc].h: New files.\n+\n 2000-04-07  Nathan Sidwell  <nathan@codesourcery.com>\n \n \t* g++.old-deja/g++.abi/vmihint.C: Adjust __vmi_class_type_info"}, {"sha": "d5c814c61cc009744dc8a05ca6751cce610e5046", "filename": "gcc/testsuite/gcc.dg/cpp-mi2.c", "status": "added", "additions": 12, "deletions": 0, "changes": 12, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/f787c583ae1966a61ae9e1e8b5645ec5834de1ac/gcc%2Ftestsuite%2Fgcc.dg%2Fcpp-mi2.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/f787c583ae1966a61ae9e1e8b5645ec5834de1ac/gcc%2Ftestsuite%2Fgcc.dg%2Fcpp-mi2.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgcc.dg%2Fcpp-mi2.c?ref=f787c583ae1966a61ae9e1e8b5645ec5834de1ac", "patch": "@@ -0,0 +1,12 @@\n+/* Test for overly eager multiple include optimization.\n+   Problem distilled from glibc 2.0.7's time.h, sys/time.h, timebits.h.\n+   Problem noted by Tom Tromey <tromey@cygnus.com>.  */\n+/* { dg-do compile } */\n+\n+#include \"cpp-mi2a.h\"\n+#include \"cpp-mi2b.h\"\n+\n+int main (void)\n+{\n+  return x;\n+}"}, {"sha": "c86838cf2e0cd3e15e0c438a5e4baefca2797462", "filename": "gcc/testsuite/gcc.dg/cpp-mi2a.h", "status": "added", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/f787c583ae1966a61ae9e1e8b5645ec5834de1ac/gcc%2Ftestsuite%2Fgcc.dg%2Fcpp-mi2a.h", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/f787c583ae1966a61ae9e1e8b5645ec5834de1ac/gcc%2Ftestsuite%2Fgcc.dg%2Fcpp-mi2a.h", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgcc.dg%2Fcpp-mi2a.h?ref=f787c583ae1966a61ae9e1e8b5645ec5834de1ac", "patch": "@@ -0,0 +1,5 @@\n+/* Test for overly eager multiple include optimization.\n+   Problem distilled from glibc 2.0.7's time.h, sys/time.h, timebits.h. \n+   Problem noted by Tom Tromey <tromey@cygnus.com>.  */\n+\n+#include \"cpp-mi2c.h\""}, {"sha": "8d1970c5eab38b195282f5c22f4ab6c673da3863", "filename": "gcc/testsuite/gcc.dg/cpp-mi2b.h", "status": "added", "additions": 6, "deletions": 0, "changes": 6, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/f787c583ae1966a61ae9e1e8b5645ec5834de1ac/gcc%2Ftestsuite%2Fgcc.dg%2Fcpp-mi2b.h", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/f787c583ae1966a61ae9e1e8b5645ec5834de1ac/gcc%2Ftestsuite%2Fgcc.dg%2Fcpp-mi2b.h", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgcc.dg%2Fcpp-mi2b.h?ref=f787c583ae1966a61ae9e1e8b5645ec5834de1ac", "patch": "@@ -0,0 +1,6 @@\n+/* Test for overly eager multiple include optimization.\n+   Problem distilled from glibc 2.0.7's time.h, sys/time.h, timebits.h. \n+   Problem noted by Tom Tromey <tromey@cygnus.com>.  */\n+\n+#define need_x\n+#include \"cpp-mi2c.h\""}, {"sha": "521792bee2f2c8687bc2cc9aa0c93b5d7336eaee", "filename": "gcc/testsuite/gcc.dg/cpp-mi2c.h", "status": "added", "additions": 15, "deletions": 0, "changes": 15, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/f787c583ae1966a61ae9e1e8b5645ec5834de1ac/gcc%2Ftestsuite%2Fgcc.dg%2Fcpp-mi2c.h", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/f787c583ae1966a61ae9e1e8b5645ec5834de1ac/gcc%2Ftestsuite%2Fgcc.dg%2Fcpp-mi2c.h", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgcc.dg%2Fcpp-mi2c.h?ref=f787c583ae1966a61ae9e1e8b5645ec5834de1ac", "patch": "@@ -0,0 +1,15 @@\n+/* Test for overly eager multiple include optimization.\n+   Problem distilled from glibc 2.0.7's time.h, sys/time.h, timebits.h. \n+   Problem noted by Tom Tromey <tromey@cygnus.com>.  */\n+#ifdef need_x\n+#undef need_x\n+#ifndef have_x\n+#define have_x\n+extern int x;\n+#endif\n+#endif\n+\n+#ifndef t_h\n+#define t_h\n+extern int y;\n+#endif"}]}