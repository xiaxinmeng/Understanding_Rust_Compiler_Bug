{"sha": "64e6d5c44231696ec9212101d099427e9214203a", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6NjRlNmQ1YzQ0MjMxNjk2ZWM5MjEyMTAxZDA5OTQyN2U5MjE0MjAzYQ==", "commit": {"author": {"name": "Sergio Durigan Junior", "email": "sergiodj@redhat.com", "date": "2014-12-17T22:35:04Z"}, "committer": {"name": "Mike Stump", "email": "mrs@gcc.gnu.org", "date": "2014-12-17T22:35:04Z"}, "message": "dg-extract-results.sh: Use --text with grep to avoid issues with binary files.\n\n2014-12-17  Sergio Durigan Junior  <sergiodj@redhat.com>\n\n\t* dg-extract-results.sh: Use --text with grep to avoid issues with\n\t  binary files.  Fall back to cat -v, if that doesn't work.\n\nFrom-SVN: r218843", "tree": {"sha": "7e431604acafa5b3487e8c1b6c946de73df518fa", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/7e431604acafa5b3487e8c1b6c946de73df518fa"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/64e6d5c44231696ec9212101d099427e9214203a", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/64e6d5c44231696ec9212101d099427e9214203a", "html_url": "https://github.com/Rust-GCC/gccrs/commit/64e6d5c44231696ec9212101d099427e9214203a", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/64e6d5c44231696ec9212101d099427e9214203a/comments", "author": null, "committer": null, "parents": [{"sha": "113050e74b0e4eda5748d4d3008ac7ac5e73e13e", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/113050e74b0e4eda5748d4d3008ac7ac5e73e13e", "html_url": "https://github.com/Rust-GCC/gccrs/commit/113050e74b0e4eda5748d4d3008ac7ac5e73e13e"}], "stats": {"total": 30, "additions": 25, "deletions": 5}, "files": [{"sha": "f2d21db36e1293b5f3c94faf84616a2105c1c119", "filename": "contrib/ChangeLog", "status": "modified", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/64e6d5c44231696ec9212101d099427e9214203a/contrib%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/64e6d5c44231696ec9212101d099427e9214203a/contrib%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/contrib%2FChangeLog?ref=64e6d5c44231696ec9212101d099427e9214203a", "patch": "@@ -1,3 +1,8 @@\n+2014-12-17  Sergio Durigan Junior  <sergiodj@redhat.com>\n+\n+\t* dg-extract-results.sh: Use --text with grep to avoid issues with\n+\tbinary files.  Fall back to cat -v, if that doesn't work.\n+\n 2014-12-12  Chung-Ju Wu  <jasonwucj@gmail.com>\n \n \t* download_prerequisites: Modify the comment for GRAPHITE_LOOP_OPT."}, {"sha": "0ddf25b60a639cb90b21f038e8ad36e7a5c06390", "filename": "contrib/dg-extract-results.sh", "status": "modified", "additions": 20, "deletions": 5, "changes": 25, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/64e6d5c44231696ec9212101d099427e9214203a/contrib%2Fdg-extract-results.sh", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/64e6d5c44231696ec9212101d099427e9214203a/contrib%2Fdg-extract-results.sh", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/contrib%2Fdg-extract-results.sh?ref=64e6d5c44231696ec9212101d099427e9214203a", "patch": "@@ -127,13 +127,28 @@ do\n done\n test $ERROR -eq 0 || exit 1\n \n+# Test if grep supports the '--text' option\n+\n+GREP=grep\n+\n+if echo -e '\\x00foo\\x00' | $GREP --text foo > /dev/null 2>&1 ; then\n+  GREP=\"grep --text\"\n+else\n+  # Our grep does not recognize the '--text' option.  We have to\n+  # treat our files in order to remove any non-printable character.\n+  for file in $SUM_FILES ; do\n+    mv $file ${file}.orig\n+    cat -v ${file}.orig > $file\n+  done\n+fi\n+\n if [ -z \"$TOOL\" ]; then\n   # If no tool was specified, all specified summary files must be for\n   # the same tool.\n \n-  CNT=`grep '=== .* tests ===' $SUM_FILES | $AWK '{ print $3 }' | sort -u | wc -l`\n+  CNT=`$GREP '=== .* tests ===' $SUM_FILES | $AWK '{ print $3 }' | sort -u | wc -l`\n   if [ $CNT -eq 1 ]; then\n-    TOOL=`grep '=== .* tests ===' $FIRST_SUM | $AWK '{ print $2 }'`\n+    TOOL=`$GREP '=== .* tests ===' $FIRST_SUM | $AWK '{ print $2 }'`\n   else\n     msg \"${PROGNAME}: sum files are for multiple tools, specify a tool\"\n     msg \"\"\n@@ -144,7 +159,7 @@ else\n   # Ignore the specified summary files that are not for this tool.  This\n   # should keep the relevant files in the same order.\n \n-  SUM_FILES=`grep -l \"=== $TOOL\" $SUM_FILES`\n+  SUM_FILES=`$GREP -l \"=== $TOOL\" $SUM_FILES`\n   if test -z \"$SUM_FILES\" ; then\n     msg \"${PROGNAME}: none of the specified files are results for $TOOL\"\n     exit 1\n@@ -233,7 +248,7 @@ else\n   VARIANTS=\"\"\n   for VAR in $VARS\n   do\n-    grep \"Running target $VAR\" $SUM_FILES > /dev/null && VARIANTS=\"$VARIANTS $VAR\"\n+    $GREP \"Running target $VAR\" $SUM_FILES > /dev/null && VARIANTS=\"$VARIANTS $VAR\"\n   done\n fi\n \n@@ -435,6 +450,6 @@ cat ${TMP}/var-* | $AWK -f $TOTAL_AWK\n # This is ugly, but if there's version output from the compiler under test\n # at the end of the file, we want it.  The other thing that might be there\n # is the final summary counts.\n-tail -2 $FIRST_SUM | grep '^#' > /dev/null || tail -2 $FIRST_SUM\n+tail -2 $FIRST_SUM | $GREP '^#' > /dev/null || tail -2 $FIRST_SUM\n \n exit 0"}]}