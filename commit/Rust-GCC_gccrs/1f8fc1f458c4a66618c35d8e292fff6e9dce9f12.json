{"sha": "1f8fc1f458c4a66618c35d8e292fff6e9dce9f12", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6MWY4ZmMxZjQ1OGM0YTY2NjE4YzM1ZDhlMjkyZmZmNmU5ZGNlOWYxMg==", "commit": {"author": {"name": "Eric Botcazou", "email": "ebotcazou@adacore.com", "date": "2020-11-11T12:53:01Z"}, "committer": {"name": "Eric Botcazou", "email": "ebotcazou@adacore.com", "date": "2020-11-11T12:55:09Z"}, "message": "Fix internal error with Shift_Right operator on signed type\n\nThis is a regression present on the mainline and 10 branch in the form\nof an ICE with a shift operator applied to a variable of a signed type,\nand which is caused by a type mismatch.\n\ngcc/ada/ChangeLog:\n\t* gcc-interface/trans.c (gnat_to_gnu) <N_Op_Shift>: Also convert\n\tGNU_MAX_SHIFT if the type of the operation has been changed.\n\t* gcc-interface/utils.c (can_materialize_object_renaming_p): Add\n\tpair of missing parentheses.\n\ngcc/testsuite/ChangeLog:\n\t* gnat.dg/shift1.adb: New test.", "tree": {"sha": "540980b5d5baef54b3848408f3ba3ac8b6ede40f", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/540980b5d5baef54b3848408f3ba3ac8b6ede40f"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/1f8fc1f458c4a66618c35d8e292fff6e9dce9f12", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/1f8fc1f458c4a66618c35d8e292fff6e9dce9f12", "html_url": "https://github.com/Rust-GCC/gccrs/commit/1f8fc1f458c4a66618c35d8e292fff6e9dce9f12", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/1f8fc1f458c4a66618c35d8e292fff6e9dce9f12/comments", "author": null, "committer": null, "parents": [{"sha": "4ac93608d7e33a3e10bbd8d50259bc00a7d01237", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/4ac93608d7e33a3e10bbd8d50259bc00a7d01237", "html_url": "https://github.com/Rust-GCC/gccrs/commit/4ac93608d7e33a3e10bbd8d50259bc00a7d01237"}], "stats": {"total": 19, "additions": 18, "deletions": 1}, "files": [{"sha": "d0663a2d69b363ad27732a6781bcd6e654d72def", "filename": "gcc/ada/gcc-interface/trans.c", "status": "modified", "additions": 2, "deletions": 0, "changes": 2, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/1f8fc1f458c4a66618c35d8e292fff6e9dce9f12/gcc%2Fada%2Fgcc-interface%2Ftrans.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/1f8fc1f458c4a66618c35d8e292fff6e9dce9f12/gcc%2Fada%2Fgcc-interface%2Ftrans.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fada%2Fgcc-interface%2Ftrans.c?ref=1f8fc1f458c4a66618c35d8e292fff6e9dce9f12", "patch": "@@ -7085,6 +7085,8 @@ gnat_to_gnu (Node_Id gnat_node)\n \t    if (TREE_CODE (gnu_lhs) == INTEGER_CST && ignore_lhs_overflow)\n \t      TREE_OVERFLOW (gnu_lhs) = TREE_OVERFLOW (gnu_old_lhs);\n \t    gnu_rhs = convert (gnu_type, gnu_rhs);\n+\t    if (gnu_max_shift)\n+\t      gnu_max_shift = convert (gnu_type, gnu_max_shift);\n \t  }\n \n \t/* For signed integer addition, subtraction and multiplication, do an"}, {"sha": "dfde06e48c1ce18fe1a7091b58da21d0a077889d", "filename": "gcc/ada/gcc-interface/utils.c", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/1f8fc1f458c4a66618c35d8e292fff6e9dce9f12/gcc%2Fada%2Fgcc-interface%2Futils.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/1f8fc1f458c4a66618c35d8e292fff6e9dce9f12/gcc%2Fada%2Fgcc-interface%2Futils.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fada%2Fgcc-interface%2Futils.c?ref=1f8fc1f458c4a66618c35d8e292fff6e9dce9f12", "patch": "@@ -5837,7 +5837,7 @@ can_materialize_object_renaming_p (Node_Id expr)\n     {\n       expr = Original_Node (expr);\n \n-      switch Nkind (expr)\n+      switch (Nkind (expr))\n \t{\n \tcase N_Identifier:\n \tcase N_Expanded_Name:"}, {"sha": "85a0fecdae4cb96b94d1191d2a9e19037bdedef8", "filename": "gcc/testsuite/gnat.dg/shift1.adb", "status": "added", "additions": 15, "deletions": 0, "changes": 15, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/1f8fc1f458c4a66618c35d8e292fff6e9dce9f12/gcc%2Ftestsuite%2Fgnat.dg%2Fshift1.adb", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/1f8fc1f458c4a66618c35d8e292fff6e9dce9f12/gcc%2Ftestsuite%2Fgnat.dg%2Fshift1.adb", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgnat.dg%2Fshift1.adb?ref=1f8fc1f458c4a66618c35d8e292fff6e9dce9f12", "patch": "@@ -0,0 +1,15 @@\n+-- { dg-do compile }\n+-- { dg-options \"-gnatws\" }\n+\n+procedure Shift1 is\n+\n+  type T_Integer_8 is range -2 ** 7 .. 2 ** 7 - 1\n+    with Size => 8;\n+\n+  pragma Provide_Shift_Operators (T_Integer_8);\n+\n+  X : T_Integer_8;\n+\n+begin\n+  X := Shift_Right (X, 1);\n+end;"}]}