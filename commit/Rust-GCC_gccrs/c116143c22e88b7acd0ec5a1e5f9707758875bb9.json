{"sha": "c116143c22e88b7acd0ec5a1e5f9707758875bb9", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6YzExNjE0M2MyMmU4OGI3YWNkMGVjNWExZTVmOTcwNzc1ODg3NWJiOQ==", "commit": {"author": {"name": "Ed Schonberg", "email": "schonberg@adacore.com", "date": "2012-12-05T11:20:13Z"}, "committer": {"name": "Arnaud Charlet", "email": "charlet@gcc.gnu.org", "date": "2012-12-05T11:20:13Z"}, "message": "aspects.ads, [...]: Add aspect Relative_Deadline.\n\n2012-12-05  Ed Schonberg  <schonberg@adacore.com>\n\n\t* aspects.ads, aspects.adb: Add aspect Relative_Deadline.\n\t* sem_ch13.adb (Analyze_Aspect_Specifications): Process aspect\n\tRelative_Deadline, and introduce the corresponding pragma within\n\tthe task definition of the task type to which it applies.\n\t(Check_Aspect_At_Freeze_Point): Expression in a Relative_Deadline\n\taspect is of type Time_Span.\n\nFrom-SVN: r194214", "tree": {"sha": "9aa3071cfeff646a76e122cb6d05bc1dfdba3f5a", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/9aa3071cfeff646a76e122cb6d05bc1dfdba3f5a"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/c116143c22e88b7acd0ec5a1e5f9707758875bb9", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/c116143c22e88b7acd0ec5a1e5f9707758875bb9", "html_url": "https://github.com/Rust-GCC/gccrs/commit/c116143c22e88b7acd0ec5a1e5f9707758875bb9", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/c116143c22e88b7acd0ec5a1e5f9707758875bb9/comments", "author": {"login": "Edschonberg", "id": 6352375, "node_id": "MDQ6VXNlcjYzNTIzNzU=", "avatar_url": "https://avatars.githubusercontent.com/u/6352375?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Edschonberg", "html_url": "https://github.com/Edschonberg", "followers_url": "https://api.github.com/users/Edschonberg/followers", "following_url": "https://api.github.com/users/Edschonberg/following{/other_user}", "gists_url": "https://api.github.com/users/Edschonberg/gists{/gist_id}", "starred_url": "https://api.github.com/users/Edschonberg/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Edschonberg/subscriptions", "organizations_url": "https://api.github.com/users/Edschonberg/orgs", "repos_url": "https://api.github.com/users/Edschonberg/repos", "events_url": "https://api.github.com/users/Edschonberg/events{/privacy}", "received_events_url": "https://api.github.com/users/Edschonberg/received_events", "type": "User", "site_admin": false}, "committer": null, "parents": [{"sha": "5e0c742b7a22f7f26295b10de3a5392bf200d539", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/5e0c742b7a22f7f26295b10de3a5392bf200d539", "html_url": "https://github.com/Rust-GCC/gccrs/commit/5e0c742b7a22f7f26295b10de3a5392bf200d539"}], "stats": {"total": 64, "additions": 63, "deletions": 1}, "files": [{"sha": "7b4634c8b5d87bd7746690526f6f675ab8cfcf33", "filename": "gcc/ada/ChangeLog", "status": "modified", "additions": 9, "deletions": 0, "changes": 9, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/c116143c22e88b7acd0ec5a1e5f9707758875bb9/gcc%2Fada%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/c116143c22e88b7acd0ec5a1e5f9707758875bb9/gcc%2Fada%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fada%2FChangeLog?ref=c116143c22e88b7acd0ec5a1e5f9707758875bb9", "patch": "@@ -1,3 +1,12 @@\n+2012-12-05  Ed Schonberg  <schonberg@adacore.com>\n+\n+\t* aspects.ads, aspects.adb: Add aspect Relative_Deadline.\n+\t* sem_ch13.adb (Analyze_Aspect_Specifications): Process aspect\n+\tRelative_Deadline, and introduce the corresponding pragma within\n+\tthe task definition of the task type to which it applies.\n+\t(Check_Aspect_At_Freeze_Point): Expression in a Relative_Deadline\n+\taspect is of type Time_Span.\n+\n 2012-12-05  Hristian Kirtchev  <kirtchev@adacore.com>\n \n \t* sem_prag.adb (Check_Loop_Invariant_Variant_Placement): When pragma"}, {"sha": "dcc7314470909d5b8dd0127b819eb158d686aa24", "filename": "gcc/ada/aspects.adb", "status": "modified", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/c116143c22e88b7acd0ec5a1e5f9707758875bb9/gcc%2Fada%2Faspects.adb", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/c116143c22e88b7acd0ec5a1e5f9707758875bb9/gcc%2Fada%2Faspects.adb", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fada%2Faspects.adb?ref=c116143c22e88b7acd0ec5a1e5f9707758875bb9", "patch": "@@ -304,6 +304,7 @@ package body Aspects is\n     Aspect_Remote_Call_Interface        => Aspect_Remote_Call_Interface,\n     Aspect_Remote_Types                 => Aspect_Remote_Types,\n     Aspect_Read                         => Aspect_Read,\n+    Aspect_Relative_Deadline            => Aspect_Relative_Deadline,\n     Aspect_Scalar_Storage_Order         => Aspect_Scalar_Storage_Order,\n     Aspect_Shared                       => Aspect_Atomic,\n     Aspect_Shared_Passive               => Aspect_Shared_Passive,"}, {"sha": "7d64feee66a8bb6a0720f06a7a0f1953a4bd8605", "filename": "gcc/ada/aspects.ads", "status": "modified", "additions": 3, "deletions": 0, "changes": 3, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/c116143c22e88b7acd0ec5a1e5f9707758875bb9/gcc%2Fada%2Faspects.ads", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/c116143c22e88b7acd0ec5a1e5f9707758875bb9/gcc%2Fada%2Faspects.ads", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fada%2Faspects.ads?ref=c116143c22e88b7acd0ec5a1e5f9707758875bb9", "patch": "@@ -109,6 +109,7 @@ package Aspects is\n       Aspect_Predicate,                     -- GNAT\n       Aspect_Priority,\n       Aspect_Read,\n+      Aspect_Relative_Deadline,\n       Aspect_Scalar_Storage_Order,          -- GNAT\n       Aspect_Simple_Storage_Pool,           -- GNAT\n       Aspect_Size,\n@@ -339,6 +340,7 @@ package Aspects is\n                         Aspect_Predicate               => Expression,\n                         Aspect_Priority                => Expression,\n                         Aspect_Read                    => Name,\n+                        Aspect_Relative_Deadline       => Expression,\n                         Aspect_Scalar_Storage_Order    => Expression,\n                         Aspect_Simple_Storage_Pool     => Name,\n                         Aspect_Size                    => Expression,\n@@ -431,6 +433,7 @@ package Aspects is\n      Aspect_Pure_12                      => Name_Pure_12,\n      Aspect_Pure_Function                => Name_Pure_Function,\n      Aspect_Read                         => Name_Read,\n+     Aspect_Relative_Deadline            => Name_Relative_Deadline,\n      Aspect_Remote_Access_Type           => Name_Remote_Access_Type,\n      Aspect_Remote_Call_Interface        => Name_Remote_Call_Interface,\n      Aspect_Remote_Types                 => Name_Remote_Types,"}, {"sha": "eee75d52a1e2626b64122cdf9a2f62fc793b445e", "filename": "gcc/ada/sem_ch13.adb", "status": "modified", "additions": 50, "deletions": 1, "changes": 51, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/c116143c22e88b7acd0ec5a1e5f9707758875bb9/gcc%2Fada%2Fsem_ch13.adb", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/c116143c22e88b7acd0ec5a1e5f9707758875bb9/gcc%2Fada%2Fsem_ch13.adb", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fada%2Fsem_ch13.adb?ref=c116143c22e88b7acd0ec5a1e5f9707758875bb9", "patch": "@@ -1433,6 +1433,48 @@ package body Sem_Ch13 is\n \n                   Delay_Required := False;\n \n+               --  Case 2d : Aspects that correspond to a pragma with one\n+               --  argument.\n+\n+               when Aspect_Relative_Deadline     =>\n+                  Aitem :=\n+                    Make_Pragma (Loc,\n+                      Pragma_Argument_Associations =>\n+                        New_List (\n+                          Make_Pragma_Argument_Association (Loc,\n+                             Expression => Relocate_Node (Expr))),\n+                      Pragma_Identifier            =>\n+                        Make_Identifier (Sloc (Id), Name_Relative_Deadline));\n+\n+                  --  If the aspect applies to a task, the corresponding pragma\n+                  --  must appear within its declarations, not after.\n+\n+                  if Nkind (N) = N_Task_Type_Declaration then\n+                     declare\n+                        Def : Node_Id;\n+                        V   : List_Id;\n+\n+                     begin\n+                        if No (Task_Definition (N)) then\n+                           Set_Task_Definition (N,\n+                             Make_Task_Definition (Loc,\n+                                Visible_Declarations => New_List,\n+                                End_Label => Empty));\n+                        end if;\n+\n+                        Def := Task_Definition (N);\n+                        V  := Visible_Declarations (Def);\n+                        if not Is_Empty_List (V) then\n+                           Insert_Before (First (V), Aitem);\n+\n+                        else\n+                           Set_Visible_Declarations (Def, New_List (Aitem));\n+                        end if;\n+\n+                        goto Continue;\n+                     end;\n+                  end if;\n+\n                --  Case 3 : Aspects that don't correspond to pragma/attribute\n                --  definition clause.\n \n@@ -5186,7 +5228,11 @@ package body Sem_Ch13 is\n                end if;\n \n                Exp := New_Copy_Tree (Arg2);\n-               Loc := Sloc (Exp);\n+\n+               --  Preserve sloc of original pragma Invariant (this is required\n+               --  by Par_SCO).\n+\n+               Loc := Sloc (Ritem);\n \n                --  We need to replace any occurrences of the name of the type\n                --  with references to the object, converted to type'Class in\n@@ -6796,6 +6842,9 @@ package body Sem_Ch13 is\n          when Aspect_Priority | Aspect_Interrupt_Priority =>\n             T := Standard_Integer;\n \n+         when Aspect_Relative_Deadline =>\n+            T := RTE (RE_Time_Span);\n+\n          when Aspect_Small =>\n             T := Universal_Real;\n "}]}