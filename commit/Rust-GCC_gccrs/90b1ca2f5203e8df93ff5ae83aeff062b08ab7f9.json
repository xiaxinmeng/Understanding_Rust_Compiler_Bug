{"sha": "90b1ca2f5203e8df93ff5ae83aeff062b08ab7f9", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6OTBiMWNhMmY1MjAzZThkZjkzZmY1YWU4M2FlZmYwNjJiMDhhYjdmOQ==", "commit": {"author": {"name": "Nathan Sidwell", "email": "nathan@codesourcery.com", "date": "2001-07-25T08:52:32Z"}, "committer": {"name": "Nathan Sidwell", "email": "nathan@gcc.gnu.org", "date": "2001-07-25T08:52:32Z"}, "message": "class.c (build_vbase_offset_vbtl_entries): Look for non-primary base of which we are a sub vtable.\n\ncp:\n\t* class.c (build_vbase_offset_vbtl_entries): Look for\n\tnon-primary base of which we are a sub vtable.\ntestsuite:\n\t* g++.old-deja/g++.abi/vbase8-5.C: New test.\n\nFrom-SVN: r44336", "tree": {"sha": "506f3b416d130f1f45ee3008143a3a1bb2d2bded", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/506f3b416d130f1f45ee3008143a3a1bb2d2bded"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/90b1ca2f5203e8df93ff5ae83aeff062b08ab7f9", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/90b1ca2f5203e8df93ff5ae83aeff062b08ab7f9", "html_url": "https://github.com/Rust-GCC/gccrs/commit/90b1ca2f5203e8df93ff5ae83aeff062b08ab7f9", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/90b1ca2f5203e8df93ff5ae83aeff062b08ab7f9/comments", "author": null, "committer": null, "parents": [{"sha": "a368a2fabba4c10b491e03316dde72f41efea80b", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/a368a2fabba4c10b491e03316dde72f41efea80b", "html_url": "https://github.com/Rust-GCC/gccrs/commit/a368a2fabba4c10b491e03316dde72f41efea80b"}], "stats": {"total": 116, "additions": 115, "deletions": 1}, "files": [{"sha": "08e91be10b26bcc35ad7949cb76f71da1e9fa9e0", "filename": "gcc/cp/ChangeLog", "status": "modified", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/90b1ca2f5203e8df93ff5ae83aeff062b08ab7f9/gcc%2Fcp%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/90b1ca2f5203e8df93ff5ae83aeff062b08ab7f9/gcc%2Fcp%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fcp%2FChangeLog?ref=90b1ca2f5203e8df93ff5ae83aeff062b08ab7f9", "patch": "@@ -1,3 +1,8 @@\n+2001-07-25  Nathan Sidwell  <nathan@codesourcery.com>\n+\n+\t* class.c (build_vbase_offset_vbtl_entries): Look for\n+\tnon-primary base of which we are a sub vtable.\n+\n 2001-07-24  Phil Edwards  <pme@sources.redhat.com>\n \n \t* semantics.c (finish_this_expr):  Remove unused code."}, {"sha": "f6729541b49d63c6085b68a3b0b25803bbeb8945", "filename": "gcc/cp/class.c", "status": "modified", "additions": 27, "deletions": 1, "changes": 28, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/90b1ca2f5203e8df93ff5ae83aeff062b08ab7f9/gcc%2Fcp%2Fclass.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/90b1ca2f5203e8df93ff5ae83aeff062b08ab7f9/gcc%2Fcp%2Fclass.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fcp%2Fclass.c?ref=90b1ca2f5203e8df93ff5ae83aeff062b08ab7f9", "patch": "@@ -7671,13 +7671,38 @@ build_vbase_offset_vtbl_entries (binfo, vid)\n {\n   tree vbase;\n   tree t;\n+  tree non_primary_binfo;\n \n   /* If there are no virtual baseclasses, then there is nothing to\n      do.  */\n   if (!TYPE_USES_VIRTUAL_BASECLASSES (BINFO_TYPE (binfo)))\n     return;\n \n   t = vid->derived;\n+  \n+  /* We might be a primary base class.  Go up the inheritance hierarchy\n+     until we find the most derived class of which we are a primary base:\n+     it is the offset of that which we need to use.  */\n+  non_primary_binfo = binfo;\n+  while (BINFO_INHERITANCE_CHAIN (non_primary_binfo))\n+    {\n+      tree b;\n+\n+      /* If we have reached a virtual base, then it must be a primary\n+\t base (possibly multi-level) of vid->binfo, or we wouldn't\n+\t have called build_vcall_and_vbase_vtbl_entries for it.  But it\n+\t might be a lost primary, so just skip down to vid->binfo.  */\n+      if (TREE_VIA_VIRTUAL (non_primary_binfo))\n+\t{\n+\t  non_primary_binfo = vid->binfo;\n+\t  break;\n+\t}\n+\n+      b = BINFO_INHERITANCE_CHAIN (non_primary_binfo);\n+      if (get_primary_binfo (b) != non_primary_binfo)\n+\tbreak;\n+      non_primary_binfo = b;\n+    }\n \n   /* Go through the virtual bases, adding the offsets.  */\n   for (vbase = TYPE_BINFO (BINFO_TYPE (binfo));\n@@ -7729,7 +7754,8 @@ build_vbase_offset_vtbl_entries (binfo, vid)\n \t The vbase offsets go in reverse inheritance-graph order, and\n \t we are walking in inheritance graph order so these end up in\n \t the right order.  */\n-      delta = size_diffop (BINFO_OFFSET (b), BINFO_OFFSET (binfo));\n+      delta = size_diffop (BINFO_OFFSET (b), BINFO_OFFSET (non_primary_binfo));\n+      \n       *vid->last_init \n \t= build_tree_list (NULL_TREE,\n \t\t\t   fold (build1 (NOP_EXPR, "}, {"sha": "bf7fe1c542be38b7777b18180ad8f59ec10ae214", "filename": "gcc/testsuite/ChangeLog", "status": "modified", "additions": 4, "deletions": 0, "changes": 4, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/90b1ca2f5203e8df93ff5ae83aeff062b08ab7f9/gcc%2Ftestsuite%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/90b1ca2f5203e8df93ff5ae83aeff062b08ab7f9/gcc%2Ftestsuite%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2FChangeLog?ref=90b1ca2f5203e8df93ff5ae83aeff062b08ab7f9", "patch": "@@ -1,3 +1,7 @@\n+2001-07-25  Nathan Sidwell  <nathan@codesourcery.com>\n+\n+\t* g++.old-deja/g++.abi/vbase8-5.C: New test.\n+\n 2001-07-24  Jason Merrill  <jason_merrill@redhat.com>\n \n \t* lib/scanasm.exp (scan-assembler*): Don't take \"testcase\" argument."}, {"sha": "ea96e85c2dc7c997ab9985bfe3e8edae698bbb72", "filename": "gcc/testsuite/g++.old-deja/g++.abi/vbase8-5.C", "status": "added", "additions": 79, "deletions": 0, "changes": 79, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/90b1ca2f5203e8df93ff5ae83aeff062b08ab7f9/gcc%2Ftestsuite%2Fg%2B%2B.old-deja%2Fg%2B%2B.abi%2Fvbase8-5.C", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/90b1ca2f5203e8df93ff5ae83aeff062b08ab7f9/gcc%2Ftestsuite%2Fg%2B%2B.old-deja%2Fg%2B%2B.abi%2Fvbase8-5.C", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fg%2B%2B.old-deja%2Fg%2B%2B.abi%2Fvbase8-5.C?ref=90b1ca2f5203e8df93ff5ae83aeff062b08ab7f9", "patch": "@@ -0,0 +1,79 @@\n+// Special g++ Options: -w\n+\n+// Copyright (C) 2001 Free Software Foundation, Inc.\n+// Contributed by Nathan Sidwell 24 Jul 2001 <nathan@codesourcery.com>\n+\n+// Origin stefan@space.twc.de\n+// Bug 3145 case 5. Horribly complicated class hierarchy\n+\n+class C0\n+{};\n+class C1\n+ :  virtual public C0\n+{};\n+class C2\n+ :  public C0\n+ ,  virtual public C1\n+{};\n+class C3\n+ :  virtual public C0\n+ ,  virtual public C2\n+ ,  public C1\n+{};\n+class C4\n+ :  virtual public C0\n+ ,  virtual public C2\n+ ,  virtual public C1\n+ ,  virtual public C3\n+{};\n+class C5\n+ :  virtual public C3\n+ ,  virtual public C2\n+ ,  virtual public C0\n+ ,  public C4\n+ ,  virtual public C1\n+{};\n+class C6\n+ :  public C0\n+ ,  virtual public C3\n+ ,  public C4\n+ ,  virtual public C5\n+ ,  public C1\n+{};\n+class C7\n+ :  virtual public C3\n+ ,  public C5\n+ ,  public C2\n+ ,  virtual public C4\n+ ,  public C6\n+ ,  public C0\n+{};\n+class C8\n+ :  virtual public C2\n+ ,  public C5\n+ ,  public C7\n+ ,  public C1\n+ ,  public C0\n+ ,  public C4\n+ ,  public C3\n+{};\n+class C9\n+ :  public C3\n+ ,  public C2\n+ ,  virtual public C6\n+ ,  public C8\n+ ,  virtual public C7\n+ ,  public C5\n+{};\n+main() {\n+  C0 c0;\n+  C1 c1;\n+  C2 c2;\n+  C3 c3;\n+  C4 c4;\n+  C5 c5;\n+  C6 c6;\n+  C7 c7;\n+  C8 c8;\n+  C9 c9;\n+}"}]}