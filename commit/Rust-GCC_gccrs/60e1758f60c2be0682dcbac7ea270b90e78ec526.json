{"sha": "60e1758f60c2be0682dcbac7ea270b90e78ec526", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6NjBlMTc1OGY2MGMyYmUwNjgyZGNiYWM3ZWEyNzBiOTBlNzhlYzUyNg==", "commit": {"author": {"name": "Richard Henderson", "email": "rth@redhat.com", "date": "2006-04-25T20:58:25Z"}, "committer": {"name": "Richard Henderson", "email": "rth@gcc.gnu.org", "date": "2006-04-25T20:58:25Z"}, "message": "re PR libgomp/25865 (libgomp incorrectly detects support for TLS)\n\n        PR libgomp/25865\n        * configure.ac: Use GCC_CHECK_TLS.\n        * acinclude.m4 (LIBGOMP_CHECK_TLS): Remove.\n        * Makefile.in, aclocal.m4, configure: Regenerate.\n\nFrom-SVN: r113256", "tree": {"sha": "1c60995ec3ab114dfb5e5c1677f11326d343c170", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/1c60995ec3ab114dfb5e5c1677f11326d343c170"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/60e1758f60c2be0682dcbac7ea270b90e78ec526", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/60e1758f60c2be0682dcbac7ea270b90e78ec526", "html_url": "https://github.com/Rust-GCC/gccrs/commit/60e1758f60c2be0682dcbac7ea270b90e78ec526", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/60e1758f60c2be0682dcbac7ea270b90e78ec526/comments", "author": null, "committer": null, "parents": [{"sha": "d61772b25d07c437eca62171fb0ee55642abfe22", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/d61772b25d07c437eca62171fb0ee55642abfe22", "html_url": "https://github.com/Rust-GCC/gccrs/commit/d61772b25d07c437eca62171fb0ee55642abfe22"}], "stats": {"total": 121, "additions": 85, "deletions": 36}, "files": [{"sha": "41b3a09536fe9a4172d8e7ddcf53f99d99a539a0", "filename": "libgomp/ChangeLog", "status": "modified", "additions": 7, "deletions": 0, "changes": 7, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/60e1758f60c2be0682dcbac7ea270b90e78ec526/libgomp%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/60e1758f60c2be0682dcbac7ea270b90e78ec526/libgomp%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libgomp%2FChangeLog?ref=60e1758f60c2be0682dcbac7ea270b90e78ec526", "patch": "@@ -1,3 +1,10 @@\n+2006-04-25  Richard Henderson  <rth@redhat.com>\n+\n+\tPR libgomp/25865\n+\t* configure.ac: Use GCC_CHECK_TLS.\n+\t* acinclude.m4 (LIBGOMP_CHECK_TLS): Remove.\n+\t* Makefile.in, aclocal.m4, configure: Regenerate.\n+\n 2006-04-10  Matthias Klose  <doko@debian.org>\n \n \t* testsuite/lib/libgomp.exp (libgomp_init): Recognize multilib"}, {"sha": "31faff066e176823726a34ef6233dda9ac5d4dfb", "filename": "libgomp/Makefile.in", "status": "modified", "additions": 4, "deletions": 4, "changes": 8, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/60e1758f60c2be0682dcbac7ea270b90e78ec526/libgomp%2FMakefile.in", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/60e1758f60c2be0682dcbac7ea270b90e78ec526/libgomp%2FMakefile.in", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libgomp%2FMakefile.in?ref=60e1758f60c2be0682dcbac7ea270b90e78ec526", "patch": "@@ -1,4 +1,4 @@\n-# Makefile.in generated by automake 1.9.5 from Makefile.am.\n+# Makefile.in generated by automake 1.9.6 from Makefile.am.\n # @configure_input@\n \n # Copyright (C) 1994, 1995, 1996, 1997, 1998, 1999, 2000, 2001, 2002,\n@@ -15,8 +15,6 @@\n @SET_MAKE@\n \n \n-SOURCES = $(libgomp_la_SOURCES)\n-\n srcdir = @srcdir@\n top_srcdir = @top_srcdir@\n pkgdatadir = $(datadir)/@PACKAGE@\n@@ -51,8 +49,10 @@ DIST_COMMON = $(am__configure_deps) $(srcdir)/../config.guess \\\n subdir = .\n ACLOCAL_M4 = $(top_srcdir)/aclocal.m4\n am__aclocal_m4_deps = $(top_srcdir)/../config/depstand.m4 \\\n+\t$(top_srcdir)/../config/enable.m4 \\\n \t$(top_srcdir)/../config/lead-dot.m4 \\\n-\t$(top_srcdir)/../config/stdint.m4 $(top_srcdir)/acinclude.m4 \\\n+\t$(top_srcdir)/../config/stdint.m4 \\\n+\t$(top_srcdir)/../config/tls.m4 $(top_srcdir)/acinclude.m4 \\\n \t$(top_srcdir)/../libtool.m4 $(top_srcdir)/configure.ac\n am__configure_deps = $(am__aclocal_m4_deps) $(CONFIGURE_DEPENDENCIES) \\\n \t$(ACLOCAL_M4)"}, {"sha": "b7428cfe35dae6e3aaab330ef9ef69b5bd5f72ad", "filename": "libgomp/acinclude.m4", "status": "modified", "additions": 0, "deletions": 12, "changes": 12, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/60e1758f60c2be0682dcbac7ea270b90e78ec526/libgomp%2Facinclude.m4", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/60e1758f60c2be0682dcbac7ea270b90e78ec526/libgomp%2Facinclude.m4", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libgomp%2Facinclude.m4?ref=60e1758f60c2be0682dcbac7ea270b90e78ec526", "patch": "@@ -1,15 +1,3 @@\n-dnl Check whether the target supports TLS.\n-AC_DEFUN([LIBGOMP_CHECK_TLS], [\n-  LIBGOMP_ENABLE(tls, yes, [Use thread-local storage])\n-  AC_CACHE_CHECK([whether the target supports thread-local storage],\n-\t\t have_tls, [\n-    AC_TRY_COMPILE([__thread int foo;],\n-\t\t   [], have_tls=$enable_tls, have_tls=no)])\n-  if test $have_tls = yes; then\n-    AC_DEFINE(HAVE_TLS, 1,\n-\t      [Define to 1 if the target supports thread-local storage.])\n-  fi])\n-\n dnl ----------------------------------------------------------------------\n dnl This whole bit snagged from libgfortran.\n "}, {"sha": "fb9be461e87ba32f4b7b5145150f2d375b7e2a48", "filename": "libgomp/aclocal.m4", "status": "modified", "additions": 4, "deletions": 2, "changes": 6, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/60e1758f60c2be0682dcbac7ea270b90e78ec526/libgomp%2Faclocal.m4", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/60e1758f60c2be0682dcbac7ea270b90e78ec526/libgomp%2Faclocal.m4", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libgomp%2Faclocal.m4?ref=60e1758f60c2be0682dcbac7ea270b90e78ec526", "patch": "@@ -1,4 +1,4 @@\n-# generated automatically by aclocal 1.9.5 -*- Autoconf -*-\n+# generated automatically by aclocal 1.9.6 -*- Autoconf -*-\n \n # Copyright (C) 1996, 1997, 1998, 1999, 2000, 2001, 2002, 2003, 2004,\n # 2005  Free Software Foundation, Inc.\n@@ -28,7 +28,7 @@ AC_DEFUN([AM_AUTOMAKE_VERSION], [am__api_version=\"1.9\"])\n # Call AM_AUTOMAKE_VERSION so it can be traced.\n # This function is AC_REQUIREd by AC_INIT_AUTOMAKE.\n AC_DEFUN([AM_SET_CURRENT_AUTOMAKE_VERSION],\n-\t [AM_AUTOMAKE_VERSION([1.9.5])])\n+\t [AM_AUTOMAKE_VERSION([1.9.6])])\n \n # AM_AUX_DIR_EXPAND                                         -*- Autoconf -*-\n \n@@ -915,6 +915,8 @@ AC_SUBST([am__untar])\n ]) # _AM_PROG_TAR\n \n m4_include([../config/depstand.m4])\n+m4_include([../config/enable.m4])\n m4_include([../config/lead-dot.m4])\n m4_include([../config/stdint.m4])\n+m4_include([../config/tls.m4])\n m4_include([acinclude.m4])"}, {"sha": "5d906f651311236f78cd335b4ea31319efb33675", "filename": "libgomp/configure", "status": "modified", "additions": 65, "deletions": 15, "changes": 80, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/60e1758f60c2be0682dcbac7ea270b90e78ec526/libgomp%2Fconfigure", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/60e1758f60c2be0682dcbac7ea270b90e78ec526/libgomp%2Fconfigure", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libgomp%2Fconfigure?ref=60e1758f60c2be0682dcbac7ea270b90e78ec526", "patch": "@@ -8611,20 +8611,9 @@ if test \"${have_tls+set}\" = set; then\n   echo $ECHO_N \"(cached) $ECHO_C\" >&6\n else\n \n-    cat >conftest.$ac_ext <<_ACEOF\n-/* confdefs.h.  */\n-_ACEOF\n-cat confdefs.h >>conftest.$ac_ext\n-cat >>conftest.$ac_ext <<_ACEOF\n-/* end confdefs.h.  */\n+    if test \"$cross_compiling\" = yes; then\n+  cat >conftest.$ac_ext <<_ACEOF\n __thread int foo;\n-int\n-main ()\n-{\n-\n-  ;\n-  return 0;\n-}\n _ACEOF\n rm -f conftest.$ac_objext\n if { (eval echo \"$as_me:$LINENO: \\\"$ac_compile\\\"\") >&5\n@@ -8648,18 +8637,79 @@ if { (eval echo \"$as_me:$LINENO: \\\"$ac_compile\\\"\") >&5\n   ac_status=$?\n   echo \"$as_me:$LINENO: \\$? = $ac_status\" >&5\n   (exit $ac_status); }; }; then\n-  have_tls=$enable_tls\n+  have_tls=yes\n else\n   echo \"$as_me: failed program was:\" >&5\n sed 's/^/| /' conftest.$ac_ext >&5\n \n have_tls=no\n fi\n rm -f conftest.err conftest.$ac_objext conftest.$ac_ext\n+\n+else\n+  cat >conftest.$ac_ext <<_ACEOF\n+__thread int a; int b; int main() { return a = b; }\n+_ACEOF\n+rm -f conftest$ac_exeext\n+if { (eval echo \"$as_me:$LINENO: \\\"$ac_link\\\"\") >&5\n+  (eval $ac_link) 2>&5\n+  ac_status=$?\n+  echo \"$as_me:$LINENO: \\$? = $ac_status\" >&5\n+  (exit $ac_status); } && { ac_try='./conftest$ac_exeext'\n+  { (eval echo \"$as_me:$LINENO: \\\"$ac_try\\\"\") >&5\n+  (eval $ac_try) 2>&5\n+  ac_status=$?\n+  echo \"$as_me:$LINENO: \\$? = $ac_status\" >&5\n+  (exit $ac_status); }; }; then\n+                    save_LDFLAGS=\"$LDFLAGS\"\n+      LDFLAGS=\"-static $LDFLAGS\"\n+      if test \"$cross_compiling\" = yes; then\n+  { { echo \"$as_me:$LINENO: error: cannot run test program while cross compiling\n+See \\`config.log' for more details.\" >&5\n+echo \"$as_me: error: cannot run test program while cross compiling\n+See \\`config.log' for more details.\" >&2;}\n+   { (exit 1); exit 1; }; }\n+else\n+  cat >conftest.$ac_ext <<_ACEOF\n+__thread int a; int b; int main() { return a = b; }\n+_ACEOF\n+rm -f conftest$ac_exeext\n+if { (eval echo \"$as_me:$LINENO: \\\"$ac_link\\\"\") >&5\n+  (eval $ac_link) 2>&5\n+  ac_status=$?\n+  echo \"$as_me:$LINENO: \\$? = $ac_status\" >&5\n+  (exit $ac_status); } && { ac_try='./conftest$ac_exeext'\n+  { (eval echo \"$as_me:$LINENO: \\\"$ac_try\\\"\") >&5\n+  (eval $ac_try) 2>&5\n+  ac_status=$?\n+  echo \"$as_me:$LINENO: \\$? = $ac_status\" >&5\n+  (exit $ac_status); }; }; then\n+  have_tls=yes\n+else\n+  echo \"$as_me: program exited with status $ac_status\" >&5\n+echo \"$as_me: failed program was:\" >&5\n+sed 's/^/| /' conftest.$ac_ext >&5\n+\n+( exit $ac_status )\n+have_tls=no\n+fi\n+rm -f core *.core gmon.out bb.out conftest$ac_exeext conftest.$ac_objext conftest.$ac_ext\n+fi\n+      LDFLAGS=\"$save_LDFLAGS\"\n+else\n+  echo \"$as_me: program exited with status $ac_status\" >&5\n+echo \"$as_me: failed program was:\" >&5\n+sed 's/^/| /' conftest.$ac_ext >&5\n+\n+( exit $ac_status )\n+have_tls=no\n+fi\n+rm -f core *.core gmon.out bb.out conftest$ac_exeext conftest.$ac_objext conftest.$ac_ext\n+fi\n fi\n echo \"$as_me:$LINENO: result: $have_tls\" >&5\n echo \"${ECHO_T}$have_tls\" >&6\n-  if test $have_tls = yes; then\n+  if test \"$enable_tls $have_tls\" = \"yes yes\"; then\n \n cat >>confdefs.h <<\\_ACEOF\n #define HAVE_TLS 1"}, {"sha": "606a0fd6ba626a508bd18c3fc708b38c280f97da", "filename": "libgomp/configure.ac", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/60e1758f60c2be0682dcbac7ea270b90e78ec526/libgomp%2Fconfigure.ac", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/60e1758f60c2be0682dcbac7ea270b90e78ec526/libgomp%2Fconfigure.ac", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libgomp%2Fconfigure.ac?ref=60e1758f60c2be0682dcbac7ea270b90e78ec526", "patch": "@@ -183,7 +183,7 @@ if test $ac_cv_func_clock_gettime = no; then\n fi\n \n # See if we support thread-local storage.\n-LIBGOMP_CHECK_TLS\n+GCC_CHECK_TLS\n \n # See what sort of export controls are availible.\n LIBGOMP_CHECK_ATTRIBUTE_VISIBILITY"}, {"sha": "01227b605af6912931a17c51080b19baa8cb8820", "filename": "libgomp/testsuite/Makefile.in", "status": "modified", "additions": 4, "deletions": 2, "changes": 6, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/60e1758f60c2be0682dcbac7ea270b90e78ec526/libgomp%2Ftestsuite%2FMakefile.in", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/60e1758f60c2be0682dcbac7ea270b90e78ec526/libgomp%2Ftestsuite%2FMakefile.in", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libgomp%2Ftestsuite%2FMakefile.in?ref=60e1758f60c2be0682dcbac7ea270b90e78ec526", "patch": "@@ -1,4 +1,4 @@\n-# Makefile.in generated by automake 1.9.5 from Makefile.am.\n+# Makefile.in generated by automake 1.9.6 from Makefile.am.\n # @configure_input@\n \n # Copyright (C) 1994, 1995, 1996, 1997, 1998, 1999, 2000, 2001, 2002,\n@@ -40,8 +40,10 @@ subdir = testsuite\n DIST_COMMON = $(srcdir)/Makefile.am $(srcdir)/Makefile.in\n ACLOCAL_M4 = $(top_srcdir)/aclocal.m4\n am__aclocal_m4_deps = $(top_srcdir)/../config/depstand.m4 \\\n+\t$(top_srcdir)/../config/enable.m4 \\\n \t$(top_srcdir)/../config/lead-dot.m4 \\\n-\t$(top_srcdir)/../config/stdint.m4 $(top_srcdir)/acinclude.m4 \\\n+\t$(top_srcdir)/../config/stdint.m4 \\\n+\t$(top_srcdir)/../config/tls.m4 $(top_srcdir)/acinclude.m4 \\\n \t$(top_srcdir)/../libtool.m4 $(top_srcdir)/configure.ac\n am__configure_deps = $(am__aclocal_m4_deps) $(CONFIGURE_DEPENDENCIES) \\\n \t$(ACLOCAL_M4)"}]}