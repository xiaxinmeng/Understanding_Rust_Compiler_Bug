{"sha": "7814a308e422b29a671f65fefecd0adb466160c9", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6NzgxNGEzMDhlNDIyYjI5YTY3MWY2NWZlZmVjZDBhZGI0NjYxNjBjOQ==", "commit": {"author": {"name": "Nathan Myers", "email": "ncm@cantrip.org", "date": "2001-12-08T00:59:11Z"}, "committer": {"name": "Loren J. Rittle", "email": "ljrittle@gcc.gnu.org", "date": "2001-12-08T00:59:11Z"}, "message": "atomicity.h (struct __Atomicity_lock<__inst>): Add.\n\n        libstdc++/5037\n        * config/cpu/sparc/sparc32/bits/atomicity.h\n        (struct __Atomicity_lock<__inst>): Add.\n        (__Atomicity_lock<__inst>::_S_atomicity_lock): Add.\n        (__exchange_and_add): Use __Atomicity_lock<0>::_S_atomicity_lock\n        instead of lock local to static function.\n        (__atomic_add): Likewise.\n\nCo-Authored-By: Loren J. Rittle <ljrittle@acm.org>\n\nFrom-SVN: r47782", "tree": {"sha": "77def8cc82fa7c31270a0eeafbd13767d0fc0f20", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/77def8cc82fa7c31270a0eeafbd13767d0fc0f20"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/7814a308e422b29a671f65fefecd0adb466160c9", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/7814a308e422b29a671f65fefecd0adb466160c9", "html_url": "https://github.com/Rust-GCC/gccrs/commit/7814a308e422b29a671f65fefecd0adb466160c9", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/7814a308e422b29a671f65fefecd0adb466160c9/comments", "author": {"login": "ncm", "id": 215047, "node_id": "MDQ6VXNlcjIxNTA0Nw==", "avatar_url": "https://avatars.githubusercontent.com/u/215047?v=4", "gravatar_id": "", "url": "https://api.github.com/users/ncm", "html_url": "https://github.com/ncm", "followers_url": "https://api.github.com/users/ncm/followers", "following_url": "https://api.github.com/users/ncm/following{/other_user}", "gists_url": "https://api.github.com/users/ncm/gists{/gist_id}", "starred_url": "https://api.github.com/users/ncm/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/ncm/subscriptions", "organizations_url": "https://api.github.com/users/ncm/orgs", "repos_url": "https://api.github.com/users/ncm/repos", "events_url": "https://api.github.com/users/ncm/events{/privacy}", "received_events_url": "https://api.github.com/users/ncm/received_events", "type": "User", "site_admin": false}, "committer": null, "parents": [{"sha": "941a878b35217227b19bed82d16e285a9f845436", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/941a878b35217227b19bed82d16e285a9f845436", "html_url": "https://github.com/Rust-GCC/gccrs/commit/941a878b35217227b19bed82d16e285a9f845436"}], "stats": {"total": 30, "additions": 24, "deletions": 6}, "files": [{"sha": "71848d1041aeb44df9032d28a4c020a9b3f21773", "filename": "libstdc++-v3/ChangeLog", "status": "modified", "additions": 11, "deletions": 0, "changes": 11, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/7814a308e422b29a671f65fefecd0adb466160c9/libstdc%2B%2B-v3%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/7814a308e422b29a671f65fefecd0adb466160c9/libstdc%2B%2B-v3%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libstdc%2B%2B-v3%2FChangeLog?ref=7814a308e422b29a671f65fefecd0adb466160c9", "patch": "@@ -1,3 +1,14 @@\n+2001-12-07  Nathan Myers  <ncm@cantrip.org>\n+\t    Loren Rittle <ljrittle@acm.org>\n+\n+\tlibstdc++/5037\n+\t* config/cpu/sparc/sparc32/bits/atomicity.h\n+\t(struct __Atomicity_lock<__inst>): Add.\n+\t(__Atomicity_lock<__inst>::_S_atomicity_lock): Add.\n+\t(__exchange_and_add): Use __Atomicity_lock<0>::_S_atomicity_lock\n+\tinstead of lock local to static function.\n+\t(__atomic_add): Likewise.\n+\n 2001-12-07  Phil Edwards  <pme@gcc.gnu.org>\n \n \t* src/globals.cc:  Remove __GTHREADS guard."}, {"sha": "525491328adf842b93a109b3948677bba064bf57", "filename": "libstdc++-v3/config/cpu/sparc/sparc32/bits/atomicity.h", "status": "modified", "additions": 13, "deletions": 6, "changes": 19, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/7814a308e422b29a671f65fefecd0adb466160c9/libstdc%2B%2B-v3%2Fconfig%2Fcpu%2Fsparc%2Fsparc32%2Fbits%2Fatomicity.h", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/7814a308e422b29a671f65fefecd0adb466160c9/libstdc%2B%2B-v3%2Fconfig%2Fcpu%2Fsparc%2Fsparc32%2Fbits%2Fatomicity.h", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libstdc%2B%2B-v3%2Fconfig%2Fcpu%2Fsparc%2Fsparc32%2Fbits%2Fatomicity.h?ref=7814a308e422b29a671f65fefecd0adb466160c9", "patch": "@@ -32,25 +32,33 @@\n \n typedef int _Atomic_word;\n \n+template <int __inst>\n+struct __Atomicity_lock\n+{\n+  static unsigned char _S_atomicity_lock;\n+};\n+\n+template <int __inst>\n+unsigned char __Atomicity_lock<__inst>::_S_atomicity_lock = 0;\n+\n static int\n __attribute__ ((__unused__))\n __exchange_and_add (volatile _Atomic_word* __mem, int __val)\n {\n-  static unsigned char __lock;\n   _Atomic_word __result, __tmp;\n \n   __asm__ __volatile__(\"1:\tldstub\t[%1], %0\\n\\t\"\n \t\t       \"\tcmp\t%0, 0\\n\\t\"\n \t\t       \"\tbne\t1b\\n\\t\"\n \t\t       \"\t nop\"\n \t\t       : \"=&r\" (__tmp)\n-\t\t       : \"r\" (&__lock)\n+\t\t       : \"r\" (&__Atomicity_lock<0>::_S_atomicity_lock)\n \t\t       : \"memory\");\n   __result = *__mem;\n   *__mem += __val;\n   __asm__ __volatile__(\"stb\t%%g0, [%0]\"\n \t\t       : /* no outputs */\n-\t\t       : \"r\" (&__lock)\n+\t\t       : \"r\" (&__Atomicity_lock<0>::_S_atomicity_lock)\n \t\t       : \"memory\");\n   return __result;\n }\n@@ -59,20 +67,19 @@ static void\n __attribute__ ((__unused__))\n __atomic_add (volatile _Atomic_word* __mem, int __val)\n {\n-  static unsigned char __lock;\n   _Atomic_word __tmp;\n \n   __asm__ __volatile__(\"1:\tldstub\t[%1], %0\\n\\t\"\n \t\t       \"\tcmp\t%0, 0\\n\\t\"\n \t\t       \"\tbne\t1b\\n\\t\"\n \t\t       \"\t nop\"\n \t\t       : \"=&r\" (__tmp)\n-\t\t       : \"r\" (&__lock)\n+\t\t       : \"r\" (&__Atomicity_lock<0>::_S_atomicity_lock)\n \t\t       : \"memory\");\n   *__mem += __val;\n   __asm__ __volatile__(\"stb\t%%g0, [%0]\"\n \t\t       : /* no outputs */\n-\t\t       : \"r\" (&__lock)\n+\t\t       : \"r\" (&__Atomicity_lock<0>::_S_atomicity_lock)\n \t\t       : \"memory\");\n }\n "}]}