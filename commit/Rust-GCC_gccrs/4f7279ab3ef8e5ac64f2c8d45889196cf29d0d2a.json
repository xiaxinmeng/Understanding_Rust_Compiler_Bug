{"sha": "4f7279ab3ef8e5ac64f2c8d45889196cf29d0d2a", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6NGY3Mjc5YWIzZWY4ZTVhYzY0ZjJjOGQ0NTg4OTE5NmNmMjlkMGQyYQ==", "commit": {"author": {"name": "Bryce McKinlay", "email": "bryce@waitaki.otago.ac.nz", "date": "2001-09-24T04:51:50Z"}, "committer": {"name": "Bryce McKinlay", "email": "bryce@gcc.gnu.org", "date": "2001-09-24T04:51:50Z"}, "message": "PosixProcess.java (exitValue): Implement here.\n\n\t* java/lang/PosixProcess.java (exitValue): Implement here. Throw\n\tIllegalThreadStateException if process hasn't exited yet.\n\t* java/lang/natPosixProcess.cc (exitValue): Removed.\n\t(waitFor): Only check thread interrupted status if waitpid()\n\treturned an error. Use WIFEXITED and WEXITSTATUS to process process's\n\texit value.\n\nFrom-SVN: r45766", "tree": {"sha": "33c2555a1c6fe8aeecedad3f79917cb12aaf94e5", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/33c2555a1c6fe8aeecedad3f79917cb12aaf94e5"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/4f7279ab3ef8e5ac64f2c8d45889196cf29d0d2a", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/4f7279ab3ef8e5ac64f2c8d45889196cf29d0d2a", "html_url": "https://github.com/Rust-GCC/gccrs/commit/4f7279ab3ef8e5ac64f2c8d45889196cf29d0d2a", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/4f7279ab3ef8e5ac64f2c8d45889196cf29d0d2a/comments", "author": null, "committer": null, "parents": [{"sha": "749ced524c4a4bcb7e8374854cc380e33e69a1d8", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/749ced524c4a4bcb7e8374854cc380e33e69a1d8", "html_url": "https://github.com/Rust-GCC/gccrs/commit/749ced524c4a4bcb7e8374854cc380e33e69a1d8"}], "stats": {"total": 56, "additions": 28, "deletions": 28}, "files": [{"sha": "4cb62a87b67d8d54ae55580911606924b7a2bce6", "filename": "libjava/ChangeLog", "status": "modified", "additions": 9, "deletions": 0, "changes": 9, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/4f7279ab3ef8e5ac64f2c8d45889196cf29d0d2a/libjava%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/4f7279ab3ef8e5ac64f2c8d45889196cf29d0d2a/libjava%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libjava%2FChangeLog?ref=4f7279ab3ef8e5ac64f2c8d45889196cf29d0d2a", "patch": "@@ -1,3 +1,12 @@\n+2001-09-24  Bryce McKinlay  <bryce@waitaki.otago.ac.nz>\n+\n+\t* java/lang/PosixProcess.java (exitValue): Implement here. Throw \n+\tIllegalThreadStateException if process hasn't exited yet.\n+\t* java/lang/natPosixProcess.cc (exitValue): Removed.\n+\t(waitFor): Only check thread interrupted status if waitpid() returned\n+\tan error. Use WIFEXITED and WEXITSTATUS to process process's exit\n+\tvalue.\n+\n 2001-09-22  Anthony Green  <green@redhat.com>\n \n  \t* java/security/DummyKeyPairGenerator.java (initialize): New"}, {"sha": "459f76c3da7c89f67e1c3b4d0c6f6e49c8ab2b44", "filename": "libjava/java/lang/PosixProcess.java", "status": "modified", "additions": 7, "deletions": 1, "changes": 8, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/4f7279ab3ef8e5ac64f2c8d45889196cf29d0d2a/libjava%2Fjava%2Flang%2FPosixProcess.java", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/4f7279ab3ef8e5ac64f2c8d45889196cf29d0d2a/libjava%2Fjava%2Flang%2FPosixProcess.java", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libjava%2Fjava%2Flang%2FPosixProcess.java?ref=4f7279ab3ef8e5ac64f2c8d45889196cf29d0d2a", "patch": "@@ -26,7 +26,13 @@\n final class ConcreteProcess extends Process\n {\n   public native void destroy ();\n-  public native int exitValue ();\n+\n+  public int exitValue ()\n+  {\n+    if (! hasExited)\n+      throw new IllegalThreadStateException(\"Process has not exited\");\n+    return status;\n+  }\n \n   public InputStream getErrorStream ()\n   {"}, {"sha": "516fb045fd76619f19d62c06268a8fae59a1ed9a", "filename": "libjava/java/lang/natPosixProcess.cc", "status": "modified", "additions": 12, "deletions": 27, "changes": 39, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/4f7279ab3ef8e5ac64f2c8d45889196cf29d0d2a/libjava%2Fjava%2Flang%2FnatPosixProcess.cc", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/4f7279ab3ef8e5ac64f2c8d45889196cf29d0d2a/libjava%2Fjava%2Flang%2FnatPosixProcess.cc", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libjava%2Fjava%2Flang%2FnatPosixProcess.cc?ref=4f7279ab3ef8e5ac64f2c8d45889196cf29d0d2a", "patch": "@@ -48,27 +48,6 @@ java::lang::ConcreteProcess::destroy (void)\n     }\n }\n \n-jint\n-java::lang::ConcreteProcess::exitValue (void)\n-{\n-  if (! hasExited)\n-    {\n-      int wstat;\n-      pid_t r = waitpid ((pid_t) pid, &wstat, WNOHANG);\n-      if (r == -1)\n-\t{\n-\t  jstring x = JvNewStringLatin1 (strerror (errno));\n-\t  throw new IllegalThreadStateException (x);\n-\t}\n-\n-      hasExited = true;\n-      // Just use the raw status.  FIXME: what is right?\n-      status = wstat;\n-    }\n-\n-  return status;\n-}\n-\n jint\n java::lang::ConcreteProcess::waitFor (void)\n {\n@@ -77,15 +56,21 @@ java::lang::ConcreteProcess::waitFor (void)\n       int wstat;\n       int r = waitpid ((pid_t) pid, &wstat, 0);\n \n-      if (r != -1)\n+      if (r == -1)\n+        {\n+\t  if (java::lang::Thread::interrupted())\n+\t    throw new InterruptedException (JvNewStringLatin1 (strerror\n+\t      (errno)));\n+\t}\n+      else\n \t{\n \t  hasExited = true;\n-\t  // Just use the raw status.  FIXME: what is right?\n-\t  status = wstat;\n-\t}\n \n-      if (java::lang::Thread::interrupted())\n-\tthrow new InterruptedException (JvNewStringLatin1 (\"wait interrupted\"));\n+\t  if (WIFEXITED (wstat))\n+\t    status = WEXITSTATUS (wstat);\n+\t  else\n+\t    status = -1;\n+\t}\n     }\n \n   return status;"}]}