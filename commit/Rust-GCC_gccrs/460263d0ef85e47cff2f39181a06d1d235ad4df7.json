{"sha": "460263d0ef85e47cff2f39181a06d1d235ad4df7", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6NDYwMjYzZDBlZjg1ZTQ3Y2ZmMmYzOTE4MWEwNmQxZDIzNWFkNGRmNw==", "commit": {"author": {"name": "Tobias Burnus", "email": "burnus@net-b.de", "date": "2015-12-12T19:00:32Z"}, "committer": {"name": "Tobias Burnus", "email": "burnus@gcc.gnu.org", "date": "2015-12-12T19:00:32Z"}, "message": "re PR fortran/45859 ([Coarray, F2008, IR] Rejects valid actuals to coarray dummies)\n\n2014-12-12  Tobias Burnus  <burnus@net-b.de>\n\ngcc/fortran\n        PR fortran/45859\n        * expr.c (gfc_is_simply_contiguous): Optionally permit array\n        * elements.\n        (gfc_check_pointer_assign): Update call.\n        * interface.c (compare_parameter): Ditto.\n        * trans-array.c (gfc_conv_array_parameter): Ditto.\n        * trans-intrinsic.c (gfc_conv_intrinsic_transfer,\n        conv_isocbinding_function): Ditto.\n        * gfortran.h (gfc_is_simply_contiguous): Update prototype.\n\ngcc/testsuite/\n        PR fortran/45859\n        * gcc/testsuite/gfortran.dg/coarray_args_2.f90: Remove dg-error.\n\nFrom-SVN: r231585", "tree": {"sha": "b4b313cc1ea7b49c947ce78542b13088030fe79e", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/b4b313cc1ea7b49c947ce78542b13088030fe79e"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/460263d0ef85e47cff2f39181a06d1d235ad4df7", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/460263d0ef85e47cff2f39181a06d1d235ad4df7", "html_url": "https://github.com/Rust-GCC/gccrs/commit/460263d0ef85e47cff2f39181a06d1d235ad4df7", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/460263d0ef85e47cff2f39181a06d1d235ad4df7/comments", "author": {"login": "tob2", "id": 264461, "node_id": "MDQ6VXNlcjI2NDQ2MQ==", "avatar_url": "https://avatars.githubusercontent.com/u/264461?v=4", "gravatar_id": "", "url": "https://api.github.com/users/tob2", "html_url": "https://github.com/tob2", "followers_url": "https://api.github.com/users/tob2/followers", "following_url": "https://api.github.com/users/tob2/following{/other_user}", "gists_url": "https://api.github.com/users/tob2/gists{/gist_id}", "starred_url": "https://api.github.com/users/tob2/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/tob2/subscriptions", "organizations_url": "https://api.github.com/users/tob2/orgs", "repos_url": "https://api.github.com/users/tob2/repos", "events_url": "https://api.github.com/users/tob2/events{/privacy}", "received_events_url": "https://api.github.com/users/tob2/received_events", "type": "User", "site_admin": false}, "committer": null, "parents": [{"sha": "8d4227c89bd724cba6995aa50f7c566d95b9ce51", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/8d4227c89bd724cba6995aa50f7c566d95b9ce51", "html_url": "https://github.com/Rust-GCC/gccrs/commit/8d4227c89bd724cba6995aa50f7c566d95b9ce51"}], "stats": {"total": 48, "additions": 33, "deletions": 15}, "files": [{"sha": "9c768fbc08bdea58690c6f86b2a4bc480a60fd5e", "filename": "gcc/fortran/ChangeLog", "status": "modified", "additions": 11, "deletions": 0, "changes": 11, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/460263d0ef85e47cff2f39181a06d1d235ad4df7/gcc%2Ffortran%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/460263d0ef85e47cff2f39181a06d1d235ad4df7/gcc%2Ffortran%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ffortran%2FChangeLog?ref=460263d0ef85e47cff2f39181a06d1d235ad4df7", "patch": "@@ -1,3 +1,14 @@\n+2014-12-12  Tobias Burnus  <burnus@net-b.de>\n+\n+\tPR fortran/45859\n+\t* expr.c (gfc_is_simply_contiguous): Optionally permit array elements.\n+\t(gfc_check_pointer_assign): Update call.\n+\t* interface.c (compare_parameter): Ditto.\n+\t* trans-array.c (gfc_conv_array_parameter): Ditto.\n+\t* trans-intrinsic.c (gfc_conv_intrinsic_transfer,\n+\tconv_isocbinding_function): Ditto.\n+\t* gfortran.h (gfc_is_simply_contiguous): Update prototype.\n+\n 2014-12-12  Tobias Burnus  <burnus@net-b.de>\n \n \tPR fortran/68815"}, {"sha": "5dd90ef891cab4c62c1e1d80e43ede8400f3469e", "filename": "gcc/fortran/expr.c", "status": "modified", "additions": 3, "deletions": 3, "changes": 6, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/460263d0ef85e47cff2f39181a06d1d235ad4df7/gcc%2Ffortran%2Fexpr.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/460263d0ef85e47cff2f39181a06d1d235ad4df7/gcc%2Ffortran%2Fexpr.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ffortran%2Fexpr.c?ref=460263d0ef85e47cff2f39181a06d1d235ad4df7", "patch": "@@ -3683,7 +3683,7 @@ gfc_check_pointer_assign (gfc_expr *lvalue, gfc_expr *rvalue)\n \t and F2008 must be allowed.  */\n       if (rvalue->rank != 1)\n \t{\n-\t  if (!gfc_is_simply_contiguous (rvalue, true))\n+\t  if (!gfc_is_simply_contiguous (rvalue, true, false))\n \t    {\n \t      gfc_error (\"Rank remapping target must be rank 1 or\"\n \t\t\t \" simply contiguous at %L\", &rvalue->where);\n@@ -4601,7 +4601,7 @@ gfc_has_ultimate_pointer (gfc_expr *e)\n    a \"(::1)\" is accepted.  */\n \n bool\n-gfc_is_simply_contiguous (gfc_expr *expr, bool strict)\n+gfc_is_simply_contiguous (gfc_expr *expr, bool strict, bool permit_element)\n {\n   bool colon;\n   int i;\n@@ -4615,7 +4615,7 @@ gfc_is_simply_contiguous (gfc_expr *expr, bool strict)\n   else if (expr->expr_type != EXPR_VARIABLE)\n     return false;\n \n-  if (expr->rank == 0)\n+  if (!permit_element && expr->rank == 0)\n     return false;\n \n   for (ref = expr->ref; ref; ref = ref->next)"}, {"sha": "d203c3212325d63b66995edb17ddaf8a85f8b75e", "filename": "gcc/fortran/gfortran.h", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/460263d0ef85e47cff2f39181a06d1d235ad4df7/gcc%2Ffortran%2Fgfortran.h", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/460263d0ef85e47cff2f39181a06d1d235ad4df7/gcc%2Ffortran%2Fgfortran.h", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ffortran%2Fgfortran.h?ref=460263d0ef85e47cff2f39181a06d1d235ad4df7", "patch": "@@ -2982,7 +2982,7 @@ void gfc_free_actual_arglist (gfc_actual_arglist *);\n gfc_actual_arglist *gfc_copy_actual_arglist (gfc_actual_arglist *);\n const char *gfc_extract_int (gfc_expr *, int *);\n bool is_subref_array (gfc_expr *);\n-bool gfc_is_simply_contiguous (gfc_expr *, bool);\n+bool gfc_is_simply_contiguous (gfc_expr *, bool, bool);\n bool gfc_check_init_expr (gfc_expr *);\n \n gfc_expr *gfc_build_conversion (gfc_expr *);"}, {"sha": "bfd5d361e09f1442a827ded10d1013eadd8404ad", "filename": "gcc/fortran/interface.c", "status": "modified", "additions": 8, "deletions": 5, "changes": 13, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/460263d0ef85e47cff2f39181a06d1d235ad4df7/gcc%2Ffortran%2Finterface.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/460263d0ef85e47cff2f39181a06d1d235ad4df7/gcc%2Ffortran%2Finterface.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ffortran%2Finterface.c?ref=460263d0ef85e47cff2f39181a06d1d235ad4df7", "patch": "@@ -2020,7 +2020,7 @@ compare_parameter (gfc_symbol *formal, gfc_expr *actual,\n \n   /* F2008, C1241.  */\n   if (formal->attr.pointer && formal->attr.contiguous\n-      && !gfc_is_simply_contiguous (actual, true))\n+      && !gfc_is_simply_contiguous (actual, true, false))\n     {\n       if (where)\n \tgfc_error (\"Actual argument to contiguous pointer dummy %qs at %L \"\n@@ -2131,15 +2131,17 @@ compare_parameter (gfc_symbol *formal, gfc_expr *actual,\n \n   if (formal->attr.codimension)\n     {\n-      /* F2008, 12.5.2.8.  */\n+      /* F2008, 12.5.2.8 + Corrig 2 (IR F08/0048).  */\n+      /* F2015, 12.5.2.8.  */\n       if (formal->attr.dimension\n \t  && (formal->attr.contiguous || formal->as->type != AS_ASSUMED_SHAPE)\n \t  && gfc_expr_attr (actual).dimension\n-\t  && !gfc_is_simply_contiguous (actual, true))\n+\t  && !gfc_is_simply_contiguous (actual, true, true))\n \t{\n \t  if (where)\n \t    gfc_error (\"Actual argument to %qs at %L must be simply \"\n-\t\t       \"contiguous\", formal->name, &actual->where);\n+\t\t       \"contiguous or an element of such an array\",\n+\t\t       formal->name, &actual->where);\n \t  return 0;\n \t}\n \n@@ -2179,7 +2181,8 @@ compare_parameter (gfc_symbol *formal, gfc_expr *actual,\n       && (actual->symtree->n.sym->attr.asynchronous\n          || actual->symtree->n.sym->attr.volatile_)\n       &&  (formal->attr.asynchronous || formal->attr.volatile_)\n-      && actual->rank && formal->as && !gfc_is_simply_contiguous (actual, true)\n+      && actual->rank && formal->as\n+      && !gfc_is_simply_contiguous (actual, true, false)\n       && ((formal->as->type != AS_ASSUMED_SHAPE\n \t   && formal->as->type != AS_ASSUMED_RANK && !formal->attr.pointer)\n \t  || formal->attr.contiguous))"}, {"sha": "6e24e2e954cdd9bcbf9676223d63962ee49dbd3e", "filename": "gcc/fortran/trans-array.c", "status": "modified", "additions": 2, "deletions": 2, "changes": 4, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/460263d0ef85e47cff2f39181a06d1d235ad4df7/gcc%2Ffortran%2Ftrans-array.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/460263d0ef85e47cff2f39181a06d1d235ad4df7/gcc%2Ffortran%2Ftrans-array.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ffortran%2Ftrans-array.c?ref=460263d0ef85e47cff2f39181a06d1d235ad4df7", "patch": "@@ -7386,7 +7386,7 @@ gfc_conv_array_parameter (gfc_se * se, gfc_expr * expr, bool g77,\n \t\t  && ref->u.ar.as->type != AS_ASSUMED_RANK\n \t\t  && ref->u.ar.as->type != AS_ASSUMED_SHAPE)\n \t\t      ||\n-\t     gfc_is_simply_contiguous (expr, false));\n+\t     gfc_is_simply_contiguous (expr, false, true));\n \n   no_pack = contiguous && no_pack;\n \n@@ -7464,7 +7464,7 @@ gfc_conv_array_parameter (gfc_se * se, gfc_expr * expr, bool g77,\n     }\n \n   if (g77 || (fsym && fsym->attr.contiguous\n-\t      && !gfc_is_simply_contiguous (expr, false)))\n+\t      && !gfc_is_simply_contiguous (expr, false, true)))\n     {\n       tree origptr = NULL_TREE;\n "}, {"sha": "4e6560319a7b3df97c07e56fea4ecd723f09b307", "filename": "gcc/fortran/trans-intrinsic.c", "status": "modified", "additions": 2, "deletions": 2, "changes": 4, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/460263d0ef85e47cff2f39181a06d1d235ad4df7/gcc%2Ffortran%2Ftrans-intrinsic.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/460263d0ef85e47cff2f39181a06d1d235ad4df7/gcc%2Ffortran%2Ftrans-intrinsic.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ffortran%2Ftrans-intrinsic.c?ref=460263d0ef85e47cff2f39181a06d1d235ad4df7", "patch": "@@ -6269,7 +6269,7 @@ gfc_conv_intrinsic_transfer (gfc_se * se, gfc_expr * expr)\n       source_type = gfc_get_element_type (TREE_TYPE (argse.expr));\n \n       /* Repack the source if not simply contiguous.  */\n-      if (!gfc_is_simply_contiguous (arg->expr, false))\n+      if (!gfc_is_simply_contiguous (arg->expr, false, true))\n \t{\n \t  tmp = gfc_build_addr_expr (NULL_TREE, argse.expr);\n \n@@ -7167,7 +7167,7 @@ conv_isocbinding_function (gfc_se *se, gfc_expr *expr)\n     {\n       if (arg->expr->rank == 0)\n \tgfc_conv_expr_reference (se, arg->expr);\n-      else if (gfc_is_simply_contiguous (arg->expr, false))\n+      else if (gfc_is_simply_contiguous (arg->expr, false, false))\n \tgfc_conv_array_parameter (se, arg->expr, true, NULL, NULL, NULL);\n       else\n \t{"}, {"sha": "f29a74bb998c2cd6c1a4106ec7af5718a8a30af8", "filename": "gcc/testsuite/ChangeLog", "status": "modified", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/460263d0ef85e47cff2f39181a06d1d235ad4df7/gcc%2Ftestsuite%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/460263d0ef85e47cff2f39181a06d1d235ad4df7/gcc%2Ftestsuite%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2FChangeLog?ref=460263d0ef85e47cff2f39181a06d1d235ad4df7", "patch": "@@ -1,3 +1,8 @@\n+2014-12-12  Tobias Burnus  <burnus@net-b.de>\n+\n+\tPR fortran/45859\n+\t* gfortran.dg/coarray_args_2.f90: Remove dg-error.\n+\n 2015-12-12  David Edelsohn  <dje.gcc@gmail.com>\n \n \t* gcc.target/powerpc/pr67808.c: Add -mlong-double-128 option."}, {"sha": "869fa873e4dca95724b619f003146bd5e8e07698", "filename": "gcc/testsuite/gfortran.dg/coarray_args_2.f90", "status": "modified", "additions": 1, "deletions": 2, "changes": 3, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/460263d0ef85e47cff2f39181a06d1d235ad4df7/gcc%2Ftestsuite%2Fgfortran.dg%2Fcoarray_args_2.f90", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/460263d0ef85e47cff2f39181a06d1d235ad4df7/gcc%2Ftestsuite%2Fgfortran.dg%2Fcoarray_args_2.f90", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgfortran.dg%2Fcoarray_args_2.f90?ref=460263d0ef85e47cff2f39181a06d1d235ad4df7", "patch": "@@ -40,8 +40,7 @@ program rank_mismatch_02\n   sync all\n \n   call subr(ndim, a(1:1,2)) ! OK\n-  call subr(ndim, a(1,2)) ! { dg-error \"must be simply contiguous\" }\n-                          ! See also F08/0048 and PR 45859 about the validity\n+  call subr(ndim, a(1,2)) ! See also F08/0048 and PR 45859 about the validity\n   if (this_image() == 1) then\n      write(*, *) 'OK'\n   end if"}]}