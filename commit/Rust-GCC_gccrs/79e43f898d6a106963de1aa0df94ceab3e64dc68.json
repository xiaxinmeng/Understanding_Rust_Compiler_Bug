{"sha": "79e43f898d6a106963de1aa0df94ceab3e64dc68", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6NzllNDNmODk4ZDZhMTA2OTYzZGUxYWEwZGY5NGNlYWIzZTY0ZGM2OA==", "commit": {"author": {"name": "Andreas Tobler", "email": "a.tobler@schweiz.ch", "date": "2003-02-07T04:31:20Z"}, "committer": {"name": "Andreas Tobler", "email": "andreast@gcc.gnu.org", "date": "2003-02-07T04:31:20Z"}, "message": "darwin_closure.S: Fix alignement bug, allocate 8 bytes for the result.\n\n2003-02-06 Andreas Tobler <a.tobler@schweiz.ch>\n\n        * libffi/src/powerpc/darwin_closure.S:\n        Fix alignement bug, allocate 8 bytes for the result.\n        * libffi/src/powerpc/aix_closure.S:\n        Likewise.\n        * libffi/src/powerpc/ffi_darwin.c:\n        Update stackframe description for aix/darwin_closure.S.\n\nFrom-SVN: r62514", "tree": {"sha": "c7f2deadecfdd8f8fb0e29584ab31a84941b6293", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/c7f2deadecfdd8f8fb0e29584ab31a84941b6293"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/79e43f898d6a106963de1aa0df94ceab3e64dc68", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/79e43f898d6a106963de1aa0df94ceab3e64dc68", "html_url": "https://github.com/Rust-GCC/gccrs/commit/79e43f898d6a106963de1aa0df94ceab3e64dc68", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/79e43f898d6a106963de1aa0df94ceab3e64dc68/comments", "author": null, "committer": null, "parents": [{"sha": "f39a753b0930bad0d7a994a28bf1d688302bdc47", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/f39a753b0930bad0d7a994a28bf1d688302bdc47", "html_url": "https://github.com/Rust-GCC/gccrs/commit/f39a753b0930bad0d7a994a28bf1d688302bdc47"}], "stats": {"total": 141, "additions": 77, "deletions": 64}, "files": [{"sha": "319315e515920ac2163682d75d3e82a8c079e5dc", "filename": "libffi/ChangeLog", "status": "modified", "additions": 9, "deletions": 0, "changes": 9, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/79e43f898d6a106963de1aa0df94ceab3e64dc68/libffi%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/79e43f898d6a106963de1aa0df94ceab3e64dc68/libffi%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libffi%2FChangeLog?ref=79e43f898d6a106963de1aa0df94ceab3e64dc68", "patch": "@@ -1,3 +1,12 @@\n+2003-02-06  Andreas Tobler <a.tobler@schweiz.ch>\n+\n+\t* libffi/src/powerpc/darwin_closure.S:\n+\tFix alignement bug, allocate 8 bytes for the result.\n+\t* libffi/src/powerpc/aix_closure.S: \n+\tLikewise.\n+\t* libffi/src/powerpc/ffi_darwin.c:\n+\tUpdate stackframe description for aix/darwin_closure.S.\n+ \n 2003-02-06  Jakub Jelinek  <jakub@redhat.com>\n \n \t* src/s390/ffi.c (ffi_closure_helper_SYSV): Add hidden visibility"}, {"sha": "d0d50ca56bdecb80d4787ca554c6f4441475b21f", "filename": "libffi/src/powerpc/aix_closure.S", "status": "modified", "additions": 19, "deletions": 18, "changes": 37, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/79e43f898d6a106963de1aa0df94ceab3e64dc68/libffi%2Fsrc%2Fpowerpc%2Faix_closure.S", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/79e43f898d6a106963de1aa0df94ceab3e64dc68/libffi%2Fsrc%2Fpowerpc%2Faix_closure.S", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libffi%2Fsrc%2Fpowerpc%2Faix_closure.S?ref=79e43f898d6a106963de1aa0df94ceab3e64dc68", "patch": "@@ -1,6 +1,6 @@\n /* -----------------------------------------------------------------------\n-   aix_closures.S - Copyright (c) 2002 Free Software Foundation, Inc.\n-   based on darwin_closures.S \n+   aix_closure.S - Copyright (c) 2002 2003 Free Software Foundation, Inc.\n+   based on darwin_closure.S \n   \n    PowerPC Assembly glue.\n \n@@ -106,24 +106,25 @@ ffi_closure_ASM:\n \t/* 24 Bytes (Linkage Area) */\n \t/* 32 Bytes (params) */\n \t/* 104 Bytes (13*8 from FPR) */ \n-\t/* 4 Bytes (result)\n-\t/* 164 Bytes */\n+\t/* 8 Bytes (result)\n+\t/* 168 Bytes */\n \t\n-\tstwu r1,-164(r1)\t/* skip over caller save area */\n+\tstwu r1,-176(r1)\t/* skip over caller save area\n+\t\t\t\tkeep stack aligned to 16  */\n \n /* we want to build up an area for the parameters passed */\n /* in registers (both floating point and integer) */\n \t\n-\t/* we store gpr 3 to gpr 10 (aligned to 4) */\n-\t/* in the parents outgoing area\t\t   */\n-\tstw   r3, 188(r1)\n-\tstw   r4, 192(r1)\n-\tstw   r5, 196(r1) \n-\tstw   r6, 200(r1)\n-\tstw   r7, 204(r1)\n-\tstw   r8, 208(r1) \n-\tstw   r9, 212(r1)\n-\tstw   r10, 216(r1)\n+\t/* we store gpr 3 to gpr 10 (aligned to 4)\n+\tin the parents outgoing area  */\n+\tstw   r3, 200(r1)\n+\tstw   r4, 204(r1)\n+\tstw   r5, 208(r1) \n+\tstw   r6, 212(r1)\n+\tstw   r7, 216(r1)\n+\tstw   r8, 220(r1) \n+\tstw   r9, 224(r1)\n+\tstw   r10, 228(r1)\n \n \t/* next save fpr 1 to fpr 13 (aligned to 8) */\n \tstfd  f1, 56(r1)\n@@ -148,14 +149,14 @@ ffi_closure_ASM:\n \taddi r4,r1,160\n \t\n \t/* now load up the pointer to the saved gpr registers */\n-\taddi r5,r1,188\n+\taddi r5,r1,200\n \n \t/* now load up the pointer to the saved fpr registers */\n \taddi r6,r1,56\n \n \t/* now load up the pointer to the outgoing parameter  */\n \t/* stack in the previous frame */\n-\taddi r7,r1,220\n+\taddi r7,r1,232\n \t\n \t/* make the call */\n \tbl .ffi_closure_helper_DARWIN\n@@ -243,7 +244,7 @@ L..58:\n /* case void / done\t */\n L..44:\n \t\n-\taddi r1,r1,164\t\t/* restore stack pointer */\n+\taddi r1,r1,176\t\t/* restore stack pointer */\n \tlwz r0,8(r1)\t\t/* get return address */\n \tmtlr r0\t\t\t/* reset link register */\n \tblr"}, {"sha": "9ae17d8cce8445ace060eccd97b57890b32dbed7", "filename": "libffi/src/powerpc/darwin_closure.S", "status": "modified", "additions": 26, "deletions": 25, "changes": 51, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/79e43f898d6a106963de1aa0df94ceab3e64dc68/libffi%2Fsrc%2Fpowerpc%2Fdarwin_closure.S", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/79e43f898d6a106963de1aa0df94ceab3e64dc68/libffi%2Fsrc%2Fpowerpc%2Fdarwin_closure.S", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libffi%2Fsrc%2Fpowerpc%2Fdarwin_closure.S?ref=79e43f898d6a106963de1aa0df94ceab3e64dc68", "patch": "@@ -41,27 +41,28 @@ LFB1:\n \tmflr r0\t\t\t/* extract return address  */\n \tstw r0, 8(r1)\t\t/* save the return address  */\n LCFI0:\t\n-\t/* 24 Bytes (Linkage Area) */\n-\t/* 32 Bytes (outgoing parameter area, always reserved) */\n-\t/* 104 Bytes (13*8 from FPR) */ \n-\t/* 4 Bytes (result)\n-\t/* 164 Bytes */\n+\t/* 24 Bytes (Linkage Area)\n+\t   32 Bytes (outgoing parameter area, always reserved)\n+\t   104 Bytes (13*8 from FPR)\t\n+\t   8 Bytes (result)\n+\t   168 Bytes  */\n \t\n-\tstwu r1,-164(r1)\t/* skip over caller save area  */\n+\tstwu r1,-176(r1)\t/* skip over caller save area\n+\t\t\t\tkeep stack aligned to 16  */\n LCFI1:\t\t\n \t/* we want to build up an area for the parameters passed\n \tin registers (both floating point and integer)  */\n \t\n-\t/* we store gpr 3 to gpr 10 (aligned to 4) */\n-\t/* in the parents outgoing area\t\t   */\n-\tstw   r3, 188(r1)\n-\tstw   r4, 192(r1)\n-\tstw   r5, 196(r1) \n-\tstw   r6, 200(r1)\n-\tstw   r7, 204(r1)\n-\tstw   r8, 208(r1) \n-\tstw   r9, 212(r1)\n-\tstw   r10, 216(r1)\n+\t/* we store gpr 3 to gpr 10 (aligned to 4)\n+\tin the parents outgoing area  */\n+\tstw   r3, 200(r1)\n+\tstw   r4, 204(r1)\n+\tstw   r5, 208(r1) \n+\tstw   r6, 212(r1)\n+\tstw   r7, 216(r1)\n+\tstw   r8, 220(r1) \n+\tstw   r9, 224(r1)\n+\tstw   r10, 228(r1)\n \n \t/* we save fpr 1 to fpr 13 (aligned to 8) */\n \tstfd  f1, 56(r1)\n@@ -85,15 +86,15 @@ LCFI1:\n \t/* now load up the pointer to the result storage */\n \taddi r4,r1,160\n \t\n-\t/* now load up the pointer to the saved gpr registers */\n-\taddi r5,r1,188\n+\t/* now load up the pointer to the saved gpr registers  */\n+\taddi r5,r1,200\n \n \t/* now load up the pointer to the saved fpr registers */\n \taddi r6,r1,56\n \n-\t/* now load up the pointer to the outgoing parameter  */\n-\t/* stack in the previous frame */\n-\taddi r7,r1,220\n+\t/* now load up the pointer to the outgoing parameter\n+\tstack in the previous frame  */\n+\taddi r7,r1,232\n \t\n \t/* make the call */\n \tbl L(_ffi_closure_helper_DARWIN)\n@@ -182,9 +183,9 @@ LFE1:\n /* case void / done\t */\n .L44:\n \t\n-\taddi r1,r1,164\t\t/* restore stack pointer */\n-\tlwz r0,8(r1)\t\t/* get return address */\n-\tmtlr r0\t\t\t/* reset link register */\n+\taddi r1,r1,176\t\t/* restore stack pointer  */\n+\tlwz r0,8(r1)\t\t/* get return address  */\n+\tmtlr r0\t\t\t/* reset link register  */\n \tblr\n \t\n /* END(ffi_closure_ASM)  */\n@@ -223,7 +224,7 @@ LASFDE1:\n \t.set\tL$set$3,LCFI1-LCFI0\n \t.long\tL$set$3\n \t.byte\t0xe\t; DW_CFA_def_cfa_offset\n- \t.byte\t164,1\t; uleb128 164\n+ \t.byte\t176,1\t; uleb128 176\n \t.byte\t0x4\t; DW_CFA_advance_loc4\n \t.set\tL$set$4,LCFI0-LFB1\n \t.long\tL$set$4"}, {"sha": "3f705275c5f37207d7808f15b44c6918218dd600", "filename": "libffi/src/powerpc/ffi_darwin.c", "status": "modified", "additions": 23, "deletions": 21, "changes": 44, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/79e43f898d6a106963de1aa0df94ceab3e64dc68/libffi%2Fsrc%2Fpowerpc%2Fffi_darwin.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/79e43f898d6a106963de1aa0df94ceab3e64dc68/libffi%2Fsrc%2Fpowerpc%2Fffi_darwin.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libffi%2Fsrc%2Fpowerpc%2Fffi_darwin.c?ref=79e43f898d6a106963de1aa0df94ceab3e64dc68", "patch": "@@ -410,38 +410,40 @@ typedef struct aix_fd_struct {\n                   +---------------------------------------+ 20\n                   | saved TOC pointer 4                   | \n                   +---------------------------------------+ 24\n-                  | always reserved 8*4=32  (revious GPRs)| \n+                  | always reserved 8*4=32 (previous GPRs)| \n                   | according to the linkage convention   |\n-                  | from AIX\t\t\t          |\n+                  | from AIX                              |\n                   +---------------------------------------+ 56\n-                  | our FPR area 13*8=104   \t\t  |\n-                  | f1\t\t\t\t   \t  |\n-                  | .\t       \t\t\t\t  |\n-                  | f13    \t        \t\t  | \n+                  | our FPR area 13*8=104                 |\n+                  | f1                                    |\n+                  | .                                     |\n+                  | f13                                   | \n                   +---------------------------------------+ 160\n-                  | result area 4                         | \n-SP current -->    +---------------------------------------+ 164 <- parent frame\n-                  | back chain to caller 4                | \n+                  | result area 8                         |\n                   +---------------------------------------+ 168\n+                  | alignement to the next multiple of 16 |\n+SP current -->    +---------------------------------------+ 176 <- parent frame\n+                  | back chain to caller 4                | \n+                  +---------------------------------------+ 180\n                   | saved CR 4                            | \n-                  +---------------------------------------+ 172\n+                  +---------------------------------------+ 184\n                   | saved LR 4                            | \n-                  +---------------------------------------+ 176\n+                  +---------------------------------------+ 188\n                   | reserved for compilers 4              | \n-                  +---------------------------------------+ 180\n+                  +---------------------------------------+ 192\n                   | reserved for binders 4                | \n-                  +---------------------------------------+ 184\n+                  +---------------------------------------+ 196\n                   | saved TOC pointer 4                   | \n-                  +---------------------------------------+ 188\n+                  +---------------------------------------+ 200\n                   | always reserved 8*4=32  we store our  |\n-                  | GPRs here\t        \t\t  |\n-                  | r3\t\t       \t\t\t  |\n-                  | .\t        \t\t\t  |\n-                  | r10      \t\t\t\t  |\n-                  +---------------------------------------+ 220\n-                  | PST area, overflow part\t          | \n+                  | GPRs here                             |\n+                  | r3                                    |\n+                  | .                                     |\n+                  | r10                                   |\n+                  +---------------------------------------+ 232\n+                  | PST area, overflow part               | \n                   +---------------------------------------+ xxx\n-                  | ????\t\t\t\t  | \n+                  | ????                                  | \n                   +---------------------------------------+ xxx\n \n */"}]}