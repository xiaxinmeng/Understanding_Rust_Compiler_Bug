{"sha": "f48bffe70cba310461ec19ffcd07c573a6b86575", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6ZjQ4YmZmZTcwY2JhMzEwNDYxZWMxOWZmY2QwN2M1NzNhNmI4NjU3NQ==", "commit": {"author": {"name": "Tobias Burnus", "email": "tobias@codesourcery.com", "date": "2020-06-25T14:57:08Z"}, "committer": {"name": "Tobias Burnus", "email": "tobias@codesourcery.com", "date": "2020-06-25T14:57:08Z"}, "message": "Fortran: Fix character-kind=4 substring resolution (PR95837)\n\nTesting showed that it is always set and its value matches\nalways ts->kind (if available) or otherwise, if it is a variable,\nthe sym->ts.kind.\n\ngcc/fortran/ChangeLog:\n\n\tPR fortran/95837\n\t* resolve.c (gfc_resolve_substring_charlen): Remove\n\tbogus ts.kind setting for the expression.\n\ngcc/testsuite/ChangeLog:\n\n\tPR fortran/95837\n\t* gfortran.dg/char4-subscript.f90: New test.", "tree": {"sha": "55c737310793db38ac215616287c8d1f50a1f6cc", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/55c737310793db38ac215616287c8d1f50a1f6cc"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/f48bffe70cba310461ec19ffcd07c573a6b86575", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/f48bffe70cba310461ec19ffcd07c573a6b86575", "html_url": "https://github.com/Rust-GCC/gccrs/commit/f48bffe70cba310461ec19ffcd07c573a6b86575", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/f48bffe70cba310461ec19ffcd07c573a6b86575/comments", "author": {"login": "tob2", "id": 264461, "node_id": "MDQ6VXNlcjI2NDQ2MQ==", "avatar_url": "https://avatars.githubusercontent.com/u/264461?v=4", "gravatar_id": "", "url": "https://api.github.com/users/tob2", "html_url": "https://github.com/tob2", "followers_url": "https://api.github.com/users/tob2/followers", "following_url": "https://api.github.com/users/tob2/following{/other_user}", "gists_url": "https://api.github.com/users/tob2/gists{/gist_id}", "starred_url": "https://api.github.com/users/tob2/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/tob2/subscriptions", "organizations_url": "https://api.github.com/users/tob2/orgs", "repos_url": "https://api.github.com/users/tob2/repos", "events_url": "https://api.github.com/users/tob2/events{/privacy}", "received_events_url": "https://api.github.com/users/tob2/received_events", "type": "User", "site_admin": false}, "committer": {"login": "tob2", "id": 264461, "node_id": "MDQ6VXNlcjI2NDQ2MQ==", "avatar_url": "https://avatars.githubusercontent.com/u/264461?v=4", "gravatar_id": "", "url": "https://api.github.com/users/tob2", "html_url": "https://github.com/tob2", "followers_url": "https://api.github.com/users/tob2/followers", "following_url": "https://api.github.com/users/tob2/following{/other_user}", "gists_url": "https://api.github.com/users/tob2/gists{/gist_id}", "starred_url": "https://api.github.com/users/tob2/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/tob2/subscriptions", "organizations_url": "https://api.github.com/users/tob2/orgs", "repos_url": "https://api.github.com/users/tob2/repos", "events_url": "https://api.github.com/users/tob2/events{/privacy}", "received_events_url": "https://api.github.com/users/tob2/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "628b78f9794a2eefcbc578011806bfa8e09b9ef7", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/628b78f9794a2eefcbc578011806bfa8e09b9ef7", "html_url": "https://github.com/Rust-GCC/gccrs/commit/628b78f9794a2eefcbc578011806bfa8e09b9ef7"}], "stats": {"total": 33, "additions": 30, "deletions": 3}, "files": [{"sha": "8c602daf1cb45bd8dcc2eaf490982b9eda81ea67", "filename": "gcc/fortran/resolve.c", "status": "modified", "additions": 0, "deletions": 3, "changes": 3, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/f48bffe70cba310461ec19ffcd07c573a6b86575/gcc%2Ffortran%2Fresolve.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/f48bffe70cba310461ec19ffcd07c573a6b86575/gcc%2Ffortran%2Fresolve.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ffortran%2Fresolve.c?ref=f48bffe70cba310461ec19ffcd07c573a6b86575", "patch": "@@ -5140,9 +5140,6 @@ gfc_resolve_substring_charlen (gfc_expr *e)\n \treturn;\n     }\n \n-  e->ts.type = BT_CHARACTER;\n-  e->ts.kind = gfc_default_character_kind;\n-\n   if (!e->ts.u.cl)\n     e->ts.u.cl = gfc_new_charlen (gfc_current_ns, NULL);\n "}, {"sha": "f1f915c7af9b9dcc4e04a10d7ce5ef55f210a5c1", "filename": "gcc/testsuite/gfortran.dg/char4-subscript.f90", "status": "added", "additions": 30, "deletions": 0, "changes": 30, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/f48bffe70cba310461ec19ffcd07c573a6b86575/gcc%2Ftestsuite%2Fgfortran.dg%2Fchar4-subscript.f90", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/f48bffe70cba310461ec19ffcd07c573a6b86575/gcc%2Ftestsuite%2Fgfortran.dg%2Fchar4-subscript.f90", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgfortran.dg%2Fchar4-subscript.f90?ref=f48bffe70cba310461ec19ffcd07c573a6b86575", "patch": "@@ -0,0 +1,30 @@\n+! { dg-do run }\n+! { dg-additional-options \"-fdump-tree-original\" }\n+!\n+! PR fortran/95837\n+!\n+type t\n+  character(len=:, kind=4), pointer :: str2\n+end type t\n+type(t) :: var\n+\n+allocate(character(len=5, kind=4) :: var%str2)\n+\n+var%str2(1:1) = 4_\"d\"\n+var%str2(2:3) = 4_\"ef\"\n+var%str2(4:4) = achar(int(Z'1F600'), kind=4)\n+var%str2(5:5) = achar(int(Z'1F608'), kind=4)\n+\n+if (var%str2(1:3) /= 4_\"def\") stop 1\n+if (ichar(var%str2(4:4)) /= int(Z'1F600')) stop 2\n+if (ichar(var%str2(5:5)) /= int(Z'1F608')) stop 2\n+\n+deallocate(var%str2)\n+end\n+\n+! Note: the last '\\x00' is regarded as string terminator, hence, the tailing \\0 byte is not in the dump\n+\n+! { dg-final { scan-tree-dump \"  \\\\(\\\\*var\\\\.str2\\\\)\\\\\\[1\\\\\\]{lb: 1 sz: 4} = .d\\\\\\\\x00\\\\\\\\x00.\\\\\\[1\\\\\\]{lb: 1 sz: 4};\" \"original\" } }\n+! { dg-final { scan-tree-dump \"  __builtin_memmove \\\\(\\\\(void \\\\*\\\\) &\\\\(\\\\*var.str2\\\\)\\\\\\[2\\\\\\]{lb: 1 sz: 4}, \\\\(void \\\\*\\\\) &.e\\\\\\\\x00\\\\\\\\x00\\\\\\\\x00f\\\\\\\\x00\\\\\\\\x00.\\\\\\[1\\\\\\]{lb: 1 sz: 4}, 8\\\\);\" \"original\" } }\n+! { dg-final { scan-tree-dump \"  \\\\(\\\\*var.str2\\\\)\\\\\\[4\\\\\\]{lb: 1 sz: 4} = .\\\\\\\\x00\\\\\\\\xf6\\\\\\\\x01.\\\\\\[1\\\\\\]{lb: 1 sz: 4};\" \"original\" } }\n+! { dg-final { scan-tree-dump \"  \\\\(\\\\*var.str2\\\\)\\\\\\[5\\\\\\]{lb: 1 sz: 4} = .\\\\\\\\b\\\\\\\\xf6\\\\\\\\x01.\\\\\\[1\\\\\\]{lb: 1 sz: 4};\" \"original\" } }"}]}