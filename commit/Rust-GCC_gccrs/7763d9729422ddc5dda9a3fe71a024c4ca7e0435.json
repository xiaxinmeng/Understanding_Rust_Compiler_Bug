{"sha": "7763d9729422ddc5dda9a3fe71a024c4ca7e0435", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6Nzc2M2Q5NzI5NDIyZGRjNWRkYTlhM2ZlNzFhMDI0YzRjYTdlMDQzNQ==", "commit": {"author": {"name": "Dominik Vogt", "email": "vogt@linux.vnet.ibm.com", "date": "2015-12-04T14:33:01Z"}, "committer": {"name": "Andreas Krebbel", "email": "krebbel@gcc.gnu.org", "date": "2015-12-04T14:33:01Z"}, "message": "[PATCH 2/2] S/390: Implement \"target\" attribute.\n\ngcc/ChangeLog\n\n\t* config/s390/s390.c (s390_asm_file_start): Implement hook function to\n\temit .machine and .machinemode to the top of the assembler file.\n\t(TARGET_ASM_FILE_START): Provide target hook.\n\t(s390_asm_output_machine_for_arch): Protect with\n\tHAVE_AS_MACHINE_MACHINEMODE instead of S390_USE_TARGET_ATTRIBUTE.\n\ngcc/testsuite/ChangeLog\n\n\t* gcc.target/s390/asm-machine-1.c: Updated.\n\t* gcc.target/s390/asm-machine-2.c: Updated.\n\t* gcc.target/s390/asm-machine-3.c: Updated.\n\t* gcc.target/s390/asm-machine-4.c: Updated.\n\nFrom-SVN: r231272", "tree": {"sha": "7654d0a26e192edcaabf33543737706b1692596d", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/7654d0a26e192edcaabf33543737706b1692596d"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/7763d9729422ddc5dda9a3fe71a024c4ca7e0435", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/7763d9729422ddc5dda9a3fe71a024c4ca7e0435", "html_url": "https://github.com/Rust-GCC/gccrs/commit/7763d9729422ddc5dda9a3fe71a024c4ca7e0435", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/7763d9729422ddc5dda9a3fe71a024c4ca7e0435/comments", "author": {"login": "vogtd", "id": 9690100, "node_id": "MDQ6VXNlcjk2OTAxMDA=", "avatar_url": "https://avatars.githubusercontent.com/u/9690100?v=4", "gravatar_id": "", "url": "https://api.github.com/users/vogtd", "html_url": "https://github.com/vogtd", "followers_url": "https://api.github.com/users/vogtd/followers", "following_url": "https://api.github.com/users/vogtd/following{/other_user}", "gists_url": "https://api.github.com/users/vogtd/gists{/gist_id}", "starred_url": "https://api.github.com/users/vogtd/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/vogtd/subscriptions", "organizations_url": "https://api.github.com/users/vogtd/orgs", "repos_url": "https://api.github.com/users/vogtd/repos", "events_url": "https://api.github.com/users/vogtd/events{/privacy}", "received_events_url": "https://api.github.com/users/vogtd/received_events", "type": "User", "site_admin": false}, "committer": null, "parents": [{"sha": "ec47b0863aca86b7edd03ec9906d14556317d585", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/ec47b0863aca86b7edd03ec9906d14556317d585", "html_url": "https://github.com/Rust-GCC/gccrs/commit/ec47b0863aca86b7edd03ec9906d14556317d585"}], "stats": {"total": 65, "additions": 53, "deletions": 12}, "files": [{"sha": "59c50e081157edee2d3d7839a946f8190369b946", "filename": "gcc/ChangeLog", "status": "modified", "additions": 8, "deletions": 0, "changes": 8, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/7763d9729422ddc5dda9a3fe71a024c4ca7e0435/gcc%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/7763d9729422ddc5dda9a3fe71a024c4ca7e0435/gcc%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2FChangeLog?ref=7763d9729422ddc5dda9a3fe71a024c4ca7e0435", "patch": "@@ -1,3 +1,11 @@\n+2015-12-04  Dominik Vogt  <vogt@linux.vnet.ibm.com>\n+\n+\t* config/s390/s390.c (s390_asm_file_start): Implement hook function to\n+\temit .machine and .machinemode to the top of the assembler file.\n+\t(TARGET_ASM_FILE_START): Provide target hook.\n+\t(s390_asm_output_machine_for_arch): Protect with\n+\tHAVE_AS_MACHINE_MACHINEMODE instead of S390_USE_TARGET_ATTRIBUTE.\n+\n 2015-12-04  Dominik Vogt  <vogt@linux.vnet.ibm.com>\n \n \t* config/s390/s390.opt (s390_arch_string): Remove."}, {"sha": "f8928b9ac3eb3e982c4680f39adb6bf2faa40aba", "filename": "gcc/config/s390/s390.c", "status": "modified", "additions": 15, "deletions": 1, "changes": 16, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/7763d9729422ddc5dda9a3fe71a024c4ca7e0435/gcc%2Fconfig%2Fs390%2Fs390.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/7763d9729422ddc5dda9a3fe71a024c4ca7e0435/gcc%2Fconfig%2Fs390%2Fs390.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fconfig%2Fs390%2Fs390.c?ref=7763d9729422ddc5dda9a3fe71a024c4ca7e0435", "patch": "@@ -6738,7 +6738,7 @@ s390_function_num_hotpatch_hw (tree decl,\n /* Write the current .machine and .machinemode specification to the assembler\n    file.  */\n \n-#if S390_USE_TARGET_ATTRIBUTE\n+#ifdef HAVE_AS_MACHINE_MACHINEMODE\n static void\n s390_asm_output_machine_for_arch (FILE *asm_out_file)\n {\n@@ -14346,6 +14346,15 @@ s390_vector_alignment (const_tree type)\n   return MIN (64, tree_to_shwi (TYPE_SIZE (type)));\n }\n \n+#ifdef HAVE_AS_MACHINE_MACHINEMODE\n+/* Implement TARGET_ASM_FILE_START.  */\n+static void\n+s390_asm_file_start (void)\n+{\n+  s390_asm_output_machine_for_arch (asm_out_file);\n+}\n+#endif\n+\n /* Implement TARGET_ASM_FILE_END.  */\n static void\n s390_asm_file_end (void)\n@@ -14645,6 +14654,11 @@ s390_invalid_binary_op (int op ATTRIBUTE_UNUSED, const_tree type1, const_tree ty\n #undef TARGET_INVALID_BINARY_OP\n #define TARGET_INVALID_BINARY_OP s390_invalid_binary_op\n \n+#ifdef HAVE_AS_MACHINE_MACHINEMODE\n+#undef TARGET_ASM_FILE_START\n+#define TARGET_ASM_FILE_START s390_asm_file_start\n+#endif\n+\n #undef TARGET_ASM_FILE_END\n #define TARGET_ASM_FILE_END s390_asm_file_end\n "}, {"sha": "d0bd101608f26ac41ac883ea9a7e01e16a0bd20f", "filename": "gcc/testsuite/ChangeLog", "status": "modified", "additions": 7, "deletions": 0, "changes": 7, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/7763d9729422ddc5dda9a3fe71a024c4ca7e0435/gcc%2Ftestsuite%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/7763d9729422ddc5dda9a3fe71a024c4ca7e0435/gcc%2Ftestsuite%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2FChangeLog?ref=7763d9729422ddc5dda9a3fe71a024c4ca7e0435", "patch": "@@ -1,3 +1,10 @@\n+2015-12-04  Dominik Vogt  <vogt@linux.vnet.ibm.com>\n+\n+\t* gcc.target/s390/asm-machine-1.c: Updated.\n+\t* gcc.target/s390/asm-machine-2.c: Updated.\n+\t* gcc.target/s390/asm-machine-3.c: Updated.\n+\t* gcc.target/s390/asm-machine-4.c: Updated.\n+\n 2015-12-04  Dominik Vogt  <vogt@linux.vnet.ibm.com>\n \n \t* gcc.target/s390/asm-machine-1.c: New test."}, {"sha": "430d9234a89e7a4fd377825509a4af783adc4dc4", "filename": "gcc/testsuite/gcc.target/s390/asm-machine-1.c", "status": "modified", "additions": 5, "deletions": 2, "changes": 7, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/7763d9729422ddc5dda9a3fe71a024c4ca7e0435/gcc%2Ftestsuite%2Fgcc.target%2Fs390%2Fasm-machine-1.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/7763d9729422ddc5dda9a3fe71a024c4ca7e0435/gcc%2Ftestsuite%2Fgcc.target%2Fs390%2Fasm-machine-1.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgcc.target%2Fs390%2Fasm-machine-1.c?ref=7763d9729422ddc5dda9a3fe71a024c4ca7e0435", "patch": "@@ -3,7 +3,10 @@\n /* { dg-require-effective-target target_attribute } */\n /* { dg-options \"-march=z13 -mzarch\" } */\n \n+/* { dg-final { scan-assembler-times \"\\t\\.machine \\\"z13\\\"\" 1 } } */\n+/* { dg-final { scan-assembler-times \"\\t\\.machinemode zarch\" 1 } } */\n+\n void foo(void) { }\n \n-/* { dg-final { scan-assembler-not \"\\t\\.machine \" } } */\n-/* { dg-final { scan-assembler-not \"\\t\\.machinemode \" } } */\n+/* { dg-final { scan-assembler-times \"\\t\\.machine \" 1 } } */\n+/* { dg-final { scan-assembler-times \"\\t\\.machinemode \" 1 } } */"}, {"sha": "6817e2af38dc32e064f611f82e0347a1f0593d95", "filename": "gcc/testsuite/gcc.target/s390/asm-machine-2.c", "status": "modified", "additions": 6, "deletions": 3, "changes": 9, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/7763d9729422ddc5dda9a3fe71a024c4ca7e0435/gcc%2Ftestsuite%2Fgcc.target%2Fs390%2Fasm-machine-2.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/7763d9729422ddc5dda9a3fe71a024c4ca7e0435/gcc%2Ftestsuite%2Fgcc.target%2Fs390%2Fasm-machine-2.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgcc.target%2Fs390%2Fasm-machine-2.c?ref=7763d9729422ddc5dda9a3fe71a024c4ca7e0435", "patch": "@@ -3,6 +3,9 @@\n /* { dg-require-effective-target target_attribute } */\n /* { dg-options \"-march=z13 -mzarch\" } */\n \n+/* { dg-final { scan-assembler-times \"\\t\\.machine \\\"z13\\\"\" 1 } } */\n+/* { dg-final { scan-assembler-times \"\\t\\.machinemode zarch\" 2 } } */\n+\n void foo(void) { }\n \n __attribute__ ((target(\"arch=z10\")))\n@@ -12,8 +15,8 @@ void bar(void) { }\n /* { dg-final { scan-assembler-times \"\\t\\.machine pop\" 1 } } */\n /* { dg-final { scan-assembler-times \"\\t\\.machine \\\"z10\\\"\" 1 } } */\n /* { dg-final { scan-assembler-times \"\\t\\.machinemode push\" 1 } } */\n-/* { dg-final { scan-assembler-times \"\\t\\.machinemode zarch\" 1 } } */\n+/* { dg-final { scan-assembler-times \"\\t\\.machinemode zarch\" 2 } } */\n /* { dg-final { scan-assembler-times \"\\t\\.machinemode pop\" 1 } } */\n \n-/* { dg-final { scan-assembler-times \"\\t\\.machine \" 3 } } */\n-/* { dg-final { scan-assembler-times \"\\t\\.machinemode \" 3 } } */\n+/* { dg-final { scan-assembler-times \"\\t\\.machine \" 4 } } */\n+/* { dg-final { scan-assembler-times \"\\t\\.machinemode \" 4 } } */"}, {"sha": "3ae57a8a35715c5e35f27665c4429f3e32b11ac5", "filename": "gcc/testsuite/gcc.target/s390/asm-machine-3.c", "status": "modified", "additions": 6, "deletions": 3, "changes": 9, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/7763d9729422ddc5dda9a3fe71a024c4ca7e0435/gcc%2Ftestsuite%2Fgcc.target%2Fs390%2Fasm-machine-3.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/7763d9729422ddc5dda9a3fe71a024c4ca7e0435/gcc%2Ftestsuite%2Fgcc.target%2Fs390%2Fasm-machine-3.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgcc.target%2Fs390%2Fasm-machine-3.c?ref=7763d9729422ddc5dda9a3fe71a024c4ca7e0435", "patch": "@@ -3,6 +3,9 @@\n /* { dg-require-effective-target target_attribute } */\n /* { dg-options \"-march=z13 -mzarch\" } */\n \n+/* { dg-final { scan-assembler-times \"\\t\\.machine \\\"z13\\\"\" 1 } } */\n+/* { dg-final { scan-assembler-times \"\\t\\.machinemode zarch\" 2 } } */\n+\n void foo(void) { }\n \n #pragma GCC target(\"arch=z10\")\n@@ -12,8 +15,8 @@ void bar(void) { }\n /* { dg-final { scan-assembler-times \"\\t\\.machine pop\" 1 } } */\n /* { dg-final { scan-assembler-times \"\\t\\.machine \\\"z10\\\"\" 1 } } */\n /* { dg-final { scan-assembler-times \"\\t\\.machinemode push\" 1 } } */\n-/* { dg-final { scan-assembler-times \"\\t\\.machinemode zarch\" 1 } } */\n+/* { dg-final { scan-assembler-times \"\\t\\.machinemode zarch\" 2 } } */\n /* { dg-final { scan-assembler-times \"\\t\\.machinemode pop\" 1 } } */\n \n-/* { dg-final { scan-assembler-times \"\\t\\.machine \" 3 } } */\n-/* { dg-final { scan-assembler-times \"\\t\\.machinemode \" 3 } } */\n+/* { dg-final { scan-assembler-times \"\\t\\.machine \" 4 } } */\n+/* { dg-final { scan-assembler-times \"\\t\\.machinemode \" 4 } } */"}, {"sha": "932bfe68a94d1a929389756e2192d929ca7d0538", "filename": "gcc/testsuite/gcc.target/s390/asm-machine-4.c", "status": "modified", "additions": 6, "deletions": 3, "changes": 9, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/7763d9729422ddc5dda9a3fe71a024c4ca7e0435/gcc%2Ftestsuite%2Fgcc.target%2Fs390%2Fasm-machine-4.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/7763d9729422ddc5dda9a3fe71a024c4ca7e0435/gcc%2Ftestsuite%2Fgcc.target%2Fs390%2Fasm-machine-4.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgcc.target%2Fs390%2Fasm-machine-4.c?ref=7763d9729422ddc5dda9a3fe71a024c4ca7e0435", "patch": "@@ -3,6 +3,9 @@\n /* { dg-require-effective-target target_attribute } */\n /* { dg-options \"-march=z13 -mzarch\" } */\n \n+/* { dg-final { scan-assembler-times \"\\t\\.machine \\\"z13\\\"\" 1 } } */\n+/* { dg-final { scan-assembler-times \"\\t\\.machinemode zarch\" 2 } } */\n+\n void foo(void) { }\n \n #pragma GCC target(\"arch=z196\")\n@@ -13,8 +16,8 @@ void bar(void) { }\n /* { dg-final { scan-assembler-times \"\\t\\.machine pop\" 1 } } */\n /* { dg-final { scan-assembler-times \"\\t\\.machine \\\"z10\\\"\" 1 } } */\n /* { dg-final { scan-assembler-times \"\\t\\.machinemode push\" 1 } } */\n-/* { dg-final { scan-assembler-times \"\\t\\.machinemode zarch\" 1 } } */\n+/* { dg-final { scan-assembler-times \"\\t\\.machinemode zarch\" 2 } } */\n /* { dg-final { scan-assembler-times \"\\t\\.machinemode pop\" 1 } } */\n \n-/* { dg-final { scan-assembler-times \"\\t\\.machine \" 3 } } */\n-/* { dg-final { scan-assembler-times \"\\t\\.machinemode \" 3 } } */\n+/* { dg-final { scan-assembler-times \"\\t\\.machine \" 4 } } */\n+/* { dg-final { scan-assembler-times \"\\t\\.machinemode \" 4 } } */"}]}