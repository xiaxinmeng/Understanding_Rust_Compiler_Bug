{"sha": "72a4a8b0bc09f7600e05887f25de2cf9422e9d43", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6NzJhNGE4YjBiYzA5Zjc2MDBlMDU4ODdmMjVkZTJjZjk0MjJlOWQ0Mw==", "commit": {"author": {"name": "Jan Hubicka", "email": "hubicka@ucw.cz", "date": "2014-11-17T16:48:29Z"}, "committer": {"name": "Jan Hubicka", "email": "hubicka@gcc.gnu.org", "date": "2014-11-17T16:48:29Z"}, "message": "tree.c (free_lang_data_in_decl): Annotate all functio nbodies with DECL_FUNCTION_SPECIFIC_TARGET.\n\n\n\t* tree.c (free_lang_data_in_decl): Annotate all functio nbodies with\n\tDECL_FUNCTION_SPECIFIC_TARGET.\n\t* i386.c (ix86_set_current_function): Handle explicit default options.\n\n\t* lto.c (lto_read_decls): Do not rebuild DECL_FUNCTION_SPECIFIC_TARGET.\n\nFrom-SVN: r217659", "tree": {"sha": "6bf656e5818095c341835964b06853b101fed760", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/6bf656e5818095c341835964b06853b101fed760"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/72a4a8b0bc09f7600e05887f25de2cf9422e9d43", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/72a4a8b0bc09f7600e05887f25de2cf9422e9d43", "html_url": "https://github.com/Rust-GCC/gccrs/commit/72a4a8b0bc09f7600e05887f25de2cf9422e9d43", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/72a4a8b0bc09f7600e05887f25de2cf9422e9d43/comments", "author": null, "committer": null, "parents": [{"sha": "30975f633bf33625a0e89127ac509cac22ed4837", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/30975f633bf33625a0e89127ac509cac22ed4837", "html_url": "https://github.com/Rust-GCC/gccrs/commit/30975f633bf33625a0e89127ac509cac22ed4837"}], "stats": {"total": 26, "additions": 15, "deletions": 11}, "files": [{"sha": "2660d5222a7b6f96e33eff70c4d29c12cbb22a08", "filename": "gcc/ChangeLog", "status": "modified", "additions": 6, "deletions": 0, "changes": 6, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/72a4a8b0bc09f7600e05887f25de2cf9422e9d43/gcc%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/72a4a8b0bc09f7600e05887f25de2cf9422e9d43/gcc%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2FChangeLog?ref=72a4a8b0bc09f7600e05887f25de2cf9422e9d43", "patch": "@@ -1,3 +1,9 @@\n+2014-11-17  Jan Hubicka  <hubicka@ucw.cz>\n+\n+\t* tree.c (free_lang_data_in_decl): Annotate all functio nbodies with\n+\tDECL_FUNCTION_SPECIFIC_TARGET.\n+\t* i386.c (ix86_set_current_function): Handle explicit default options.\n+\n 2014-11-17  Ilya Enkovich  <ilya.enkovich@intel.com>\n \n \t* builtins.c (expand_builtin_memcpy_with_bounds): Use target hook"}, {"sha": "3166e0378a20e45d199d7fe53490535067515782", "filename": "gcc/config/i386/i386.c", "status": "modified", "additions": 2, "deletions": 2, "changes": 4, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/72a4a8b0bc09f7600e05887f25de2cf9422e9d43/gcc%2Fconfig%2Fi386%2Fi386.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/72a4a8b0bc09f7600e05887f25de2cf9422e9d43/gcc%2Fconfig%2Fi386%2Fi386.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fconfig%2Fi386%2Fi386.c?ref=72a4a8b0bc09f7600e05887f25de2cf9422e9d43", "patch": "@@ -5083,7 +5083,7 @@ ix86_set_current_function (tree fndecl)\n       if (old_tree == new_tree)\n \t;\n \n-      else if (new_tree)\n+      else if (new_tree && new_tree != target_option_default_node)\n \t{\n \t  cl_target_option_restore (&global_options,\n \t\t\t\t    TREE_TARGET_OPTION (new_tree));\n@@ -5094,7 +5094,7 @@ ix86_set_current_function (tree fndecl)\n \t      = save_target_globals_default_opts ();\n \t}\n \n-      else if (old_tree)\n+      else if (old_tree && old_tree != target_option_default_node)\n \tix86_reset_to_default_globals ();\n       ix86_previous_fndecl = fndecl;\n     }"}, {"sha": "50d32f5948b750629e5c34b611a08c188fef2175", "filename": "gcc/lto/ChangeLog", "status": "modified", "additions": 4, "deletions": 0, "changes": 4, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/72a4a8b0bc09f7600e05887f25de2cf9422e9d43/gcc%2Flto%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/72a4a8b0bc09f7600e05887f25de2cf9422e9d43/gcc%2Flto%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Flto%2FChangeLog?ref=72a4a8b0bc09f7600e05887f25de2cf9422e9d43", "patch": "@@ -1,3 +1,7 @@\n+2014-11-17  Jan Hubicka  <hubicka@ucw.cz>\n+\n+\t* lto.c (lto_read_decls): Do not rebuild DECL_FUNCTION_SPECIFIC_TARGET.\n+\n 2014-11-14  Jan Hubicka  <hubicka@ucw.cz>\n \n \t* lto.c (compare_tree_sccs_1): Compare cl_target_option_eq."}, {"sha": "a1f109cdea682fd2bb708eed7b9e7e86e44d7758", "filename": "gcc/lto/lto.c", "status": "modified", "additions": 0, "deletions": 9, "changes": 9, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/72a4a8b0bc09f7600e05887f25de2cf9422e9d43/gcc%2Flto%2Flto.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/72a4a8b0bc09f7600e05887f25de2cf9422e9d43/gcc%2Flto%2Flto.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Flto%2Flto.c?ref=72a4a8b0bc09f7600e05887f25de2cf9422e9d43", "patch": "@@ -1935,15 +1935,6 @@ lto_read_decls (struct lto_file_decl_data *decl_data, const void *data,\n \t      if (TREE_CODE (t) == INTEGER_CST\n \t\t  && !TREE_OVERFLOW (t))\n \t\tcache_integer_cst (t);\n-\t      /* Re-build DECL_FUNCTION_SPECIFIC_TARGET, we need that\n-\t         for both WPA and LTRANS stage.  */\n-\t      if (TREE_CODE (t) == FUNCTION_DECL)\n-\t\t{\n-\t\t  tree attr = lookup_attribute (\"target\", DECL_ATTRIBUTES (t));\n-\t\t  if (attr)\n-\t\t    targetm.target_option.valid_attribute_p\n-\t\t\t(t, NULL_TREE, TREE_VALUE (attr), 0);\n-\t\t}\n \t      /* Register TYPE_DECLs with the debuginfo machinery.  */\n \t      if (!flag_wpa\n \t\t  && TREE_CODE (t) == TYPE_DECL)"}, {"sha": "498d52e648c1966c12e28ff0e01e40a06436624d", "filename": "gcc/tree.c", "status": "modified", "additions": 3, "deletions": 0, "changes": 3, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/72a4a8b0bc09f7600e05887f25de2cf9422e9d43/gcc%2Ftree.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/72a4a8b0bc09f7600e05887f25de2cf9422e9d43/gcc%2Ftree.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftree.c?ref=72a4a8b0bc09f7600e05887f25de2cf9422e9d43", "patch": "@@ -5115,6 +5115,9 @@ free_lang_data_in_decl (tree decl)\n \t     the PARM_DECL will be used in the function's body).  */\n \t  for (t = DECL_ARGUMENTS (decl); t; t = TREE_CHAIN (t))\n \t    DECL_CONTEXT (t) = decl;\n+\t  if (!DECL_FUNCTION_SPECIFIC_TARGET (decl))\n+\t    DECL_FUNCTION_SPECIFIC_TARGET (decl)\n+\t      = target_option_default_node;\n \t}\n \n       /* DECL_SAVED_TREE holds the GENERIC representation for DECL."}]}