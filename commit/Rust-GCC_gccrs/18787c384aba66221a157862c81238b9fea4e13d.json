{"sha": "18787c384aba66221a157862c81238b9fea4e13d", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6MTg3ODdjMzg0YWJhNjYyMjFhMTU3ODYyYzgxMjM4YjlmZWE0ZTEzZA==", "commit": {"author": {"name": "Tom de Vries", "email": "tom@codesourcery.com", "date": "2017-06-10T06:59:49Z"}, "committer": {"name": "Tom de Vries", "email": "vries@gcc.gnu.org", "date": "2017-06-10T06:59:49Z"}, "message": "Add effective target signal\n\n2017-06-10  Tom de Vries  <tom@codesourcery.com>\n\n\t* lib/target-supports.exp (check_effective_target_signal): New proc.\n\t* lib/gcc.exp (gcc_target_compile): Remove appending of\n\t-DSIGNAL_SUPPRESS to additional_flags.\n\t* gcc.c-torture/execute/ieee/ieee.exp: Add -DSIGNAL_SUPPRESS to\n\tadditional_flags if effective target signal is not supported by the\n\ttarget.\n\t* gcc.c-torture/execute/20101011-1.c: Same.\n\t* gcc.dg/c99-stdint-1.c: Same.\n\t* gcc.dg/c99-stdint-2.c: Same.\n\t* gcc.dg/c99-stdint-5.c: Same.\n\t* gcc.dg/c99-stdint-6.c: Same.\n\t* gcc.dg/stdint-width-1.c: Same.\n\n\t* doc/sourcebuild.texi (Effective-Target Keywords, Environment\n\tattributes): Document signal effective target.\n\nFrom-SVN: r249091", "tree": {"sha": "a0b4f44878c6c1825b436f7a2a1d2891828cd657", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/a0b4f44878c6c1825b436f7a2a1d2891828cd657"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/18787c384aba66221a157862c81238b9fea4e13d", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/18787c384aba66221a157862c81238b9fea4e13d", "html_url": "https://github.com/Rust-GCC/gccrs/commit/18787c384aba66221a157862c81238b9fea4e13d", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/18787c384aba66221a157862c81238b9fea4e13d/comments", "author": null, "committer": null, "parents": [{"sha": "0069a009910c4d8d3d95db6a3760abd0580f4183", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/0069a009910c4d8d3d95db6a3760abd0580f4183", "html_url": "https://github.com/Rust-GCC/gccrs/commit/0069a009910c4d8d3d95db6a3760abd0580f4183"}], "stats": {"total": 47, "additions": 43, "deletions": 4}, "files": [{"sha": "d55bdf43bd09a903495334d43d92be004f2594b8", "filename": "gcc/ChangeLog", "status": "modified", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/18787c384aba66221a157862c81238b9fea4e13d/gcc%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/18787c384aba66221a157862c81238b9fea4e13d/gcc%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2FChangeLog?ref=18787c384aba66221a157862c81238b9fea4e13d", "patch": "@@ -1,3 +1,8 @@\n+2017-06-10  Tom de Vries  <tom@codesourcery.com>\n+\n+\t* doc/sourcebuild.texi (Effective-Target Keywords, Environment\n+\tattributes): Document signal effective target.\n+\n 2017-06-10  Tom de Vries  <tom@codesourcery.com>\n \n \t* doc/sourcebuild.texi (Effective-Target Keywords, Other attributes):"}, {"sha": "e5f0da6a49bd6395cfd00b5a86ebda06277d7a03", "filename": "gcc/doc/sourcebuild.texi", "status": "modified", "additions": 3, "deletions": 0, "changes": 3, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/18787c384aba66221a157862c81238b9fea4e13d/gcc%2Fdoc%2Fsourcebuild.texi", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/18787c384aba66221a157862c81238b9fea4e13d/gcc%2Fdoc%2Fsourcebuild.texi", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fdoc%2Fsourcebuild.texi?ref=18787c384aba66221a157862c81238b9fea4e13d", "patch": "@@ -1973,6 +1973,9 @@ time) should be run on this target.  This can be enabled by setting the\n Test system runs executables on a simulator (i.e. slowly) rather than\n hardware (i.e. fast).\n \n+@item signal\n+Target has @code{signal.h}.\n+\n @item stabs\n Target supports the stabs debugging format.\n "}, {"sha": "190054e53a95e323cfcdcac052228b8a74901fc6", "filename": "gcc/testsuite/ChangeLog", "status": "modified", "additions": 15, "deletions": 0, "changes": 15, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/18787c384aba66221a157862c81238b9fea4e13d/gcc%2Ftestsuite%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/18787c384aba66221a157862c81238b9fea4e13d/gcc%2Ftestsuite%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2FChangeLog?ref=18787c384aba66221a157862c81238b9fea4e13d", "patch": "@@ -1,3 +1,18 @@\n+2017-06-10  Tom de Vries  <tom@codesourcery.com>\n+\n+\t* lib/target-supports.exp (check_effective_target_signal): New proc.\n+\t* lib/gcc.exp (gcc_target_compile): Remove appending of\n+\t-DSIGNAL_SUPPRESS to additional_flags.\n+\t* gcc.c-torture/execute/ieee/ieee.exp: Add -DSIGNAL_SUPPRESS to\n+\tadditional_flags if effective target signal is not supported by the\n+\ttarget.\n+\t* gcc.c-torture/execute/20101011-1.c: Same.\n+\t* gcc.dg/c99-stdint-1.c: Same.\n+\t* gcc.dg/c99-stdint-2.c: Same.\n+\t* gcc.dg/c99-stdint-5.c: Same.\n+\t* gcc.dg/c99-stdint-6.c: Same.\n+\t* gcc.dg/stdint-width-1.c: Same.\n+\n 2017-06-10  Tom de Vries  <tom@codesourcery.com>\n \n \t* lib/target-supports.exp (check_effective_target_stack_size)"}, {"sha": "dda49a598529083971916857c494d25ea21ac997", "filename": "gcc/testsuite/gcc.c-torture/execute/20101011-1.c", "status": "modified", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/18787c384aba66221a157862c81238b9fea4e13d/gcc%2Ftestsuite%2Fgcc.c-torture%2Fexecute%2F20101011-1.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/18787c384aba66221a157862c81238b9fea4e13d/gcc%2Ftestsuite%2Fgcc.c-torture%2Fexecute%2F20101011-1.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgcc.c-torture%2Fexecute%2F20101011-1.c?ref=18787c384aba66221a157862c81238b9fea4e13d", "patch": "@@ -1,5 +1,6 @@\n /* { dg-options \"-fnon-call-exceptions\" } */\n /* With -fnon-call-exceptions 0 / 0 should not be eliminated.  */\n+/* { dg-additional-options \"-DSIGNAL_SUPPRESS\" { target { ! signal } } } */\n \n #ifdef SIGNAL_SUPPRESS\n # define DO_TEST 0"}, {"sha": "043e02ded1bdbfde8ccfa8bc6afd0c35fb6b4e05", "filename": "gcc/testsuite/gcc.c-torture/execute/ieee/ieee.exp", "status": "modified", "additions": 4, "deletions": 0, "changes": 4, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/18787c384aba66221a157862c81238b9fea4e13d/gcc%2Ftestsuite%2Fgcc.c-torture%2Fexecute%2Fieee%2Fieee.exp", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/18787c384aba66221a157862c81238b9fea4e13d/gcc%2Ftestsuite%2Fgcc.c-torture%2Fexecute%2Fieee%2Fieee.exp", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgcc.c-torture%2Fexecute%2Fieee%2Fieee.exp?ref=18787c384aba66221a157862c81238b9fea4e13d", "patch": "@@ -53,6 +53,10 @@ if { [istarget \"alpha*-*-*\"]\n   lappend additional_flags \"-mieee\"\n }\n \n+if { ![check_effective_target_signal] } {\n+    lappend additional_flags \"-DSIGNAL_SUPPRESS\"\n+}\n+\n # load support procs\n load_lib c-torture.exp\n "}, {"sha": "f5c2cda77c9c00247e03f148754bdc38ed765b38", "filename": "gcc/testsuite/gcc.dg/c99-stdint-1.c", "status": "modified", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/18787c384aba66221a157862c81238b9fea4e13d/gcc%2Ftestsuite%2Fgcc.dg%2Fc99-stdint-1.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/18787c384aba66221a157862c81238b9fea4e13d/gcc%2Ftestsuite%2Fgcc.dg%2Fc99-stdint-1.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgcc.dg%2Fc99-stdint-1.c?ref=18787c384aba66221a157862c81238b9fea4e13d", "patch": "@@ -10,6 +10,7 @@\n /* { dg-do compile } */\n /* { dg-options \"-std=iso9899:1999 -pedantic-errors -fhosted\" } */\n /* { dg-require-effective-target ptr32plus } */\n+/* { dg-additional-options \"-DSIGNAL_SUPPRESS\" { target { ! signal } } } */\n \n #include <limits.h>\n #include <stdint.h>"}, {"sha": "08d9f6023d9f93eea0ea5635c2ed228d7bea0f09", "filename": "gcc/testsuite/gcc.dg/c99-stdint-2.c", "status": "modified", "additions": 2, "deletions": 0, "changes": 2, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/18787c384aba66221a157862c81238b9fea4e13d/gcc%2Ftestsuite%2Fgcc.dg%2Fc99-stdint-2.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/18787c384aba66221a157862c81238b9fea4e13d/gcc%2Ftestsuite%2Fgcc.dg%2Fc99-stdint-2.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgcc.dg%2Fc99-stdint-2.c?ref=18787c384aba66221a157862c81238b9fea4e13d", "patch": "@@ -3,6 +3,8 @@\n /* { dg-do compile } */\n /* { dg-options \"-std=iso9899:1999 -pedantic-errors -ffreestanding\" } */\n /* { dg-require-effective-target ptr32plus } */\n+/* { dg-additional-options \"-DSIGNAL_SUPPRESS\" { target { ! signal } } } */\n+\n /* The test is that there are no diagnostics, so just include the\n    hosted version.  */\n #include \"c99-stdint-1.c\""}, {"sha": "60513233a43fc30bfa7b2671d228359679d56116", "filename": "gcc/testsuite/gcc.dg/c99-stdint-5.c", "status": "modified", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/18787c384aba66221a157862c81238b9fea4e13d/gcc%2Ftestsuite%2Fgcc.dg%2Fc99-stdint-5.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/18787c384aba66221a157862c81238b9fea4e13d/gcc%2Ftestsuite%2Fgcc.dg%2Fc99-stdint-5.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgcc.dg%2Fc99-stdint-5.c?ref=18787c384aba66221a157862c81238b9fea4e13d", "patch": "@@ -3,6 +3,7 @@\n    compilations).  */\n /* { dg-do compile } */\n /* { dg-options \"-std=iso9899:1999 -pedantic-errors\" } */\n+/* { dg-additional-options \"-DSIGNAL_SUPPRESS\" { target { ! signal } } } */\n \n #include <stdint.h>\n #ifndef SIGNAL_SUPPRESS"}, {"sha": "60ac31ff7dda60196b356ebc2812c09921501e9d", "filename": "gcc/testsuite/gcc.dg/c99-stdint-6.c", "status": "modified", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/18787c384aba66221a157862c81238b9fea4e13d/gcc%2Ftestsuite%2Fgcc.dg%2Fc99-stdint-6.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/18787c384aba66221a157862c81238b9fea4e13d/gcc%2Ftestsuite%2Fgcc.dg%2Fc99-stdint-6.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgcc.dg%2Fc99-stdint-6.c?ref=18787c384aba66221a157862c81238b9fea4e13d", "patch": "@@ -2,6 +2,7 @@\n    with any system <inttypes.h> header.  */\n /* { dg-do compile { target inttypes_types } } */\n /* { dg-options \"-std=iso9899:1999 -pedantic-errors\" } */\n+/* { dg-additional-options \"-DSIGNAL_SUPPRESS\" { target { ! signal } } } */\n \n #include <inttypes.h>\n #ifndef SIGNAL_SUPPRESS"}, {"sha": "3eba9f6cb15b816d161b29e220436094b64e8fb8", "filename": "gcc/testsuite/gcc.dg/stdint-width-1.c", "status": "modified", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/18787c384aba66221a157862c81238b9fea4e13d/gcc%2Ftestsuite%2Fgcc.dg%2Fstdint-width-1.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/18787c384aba66221a157862c81238b9fea4e13d/gcc%2Ftestsuite%2Fgcc.dg%2Fstdint-width-1.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgcc.dg%2Fstdint-width-1.c?ref=18787c384aba66221a157862c81238b9fea4e13d", "patch": "@@ -1,6 +1,7 @@\n /* Test TS 18661-1 width macros in <stdint.h>.  */\n /* { dg-do compile } */\n /* { dg-options \"-std=c11 -ffreestanding\" } */\n+/* { dg-additional-options \"-DSIGNAL_SUPPRESS\" { target { ! signal } } } */\n \n #include <stddef.h>\n #define __STDC_WANT_IEC_60559_BFP_EXT__"}, {"sha": "406ec4ac5703df7789871f1593a925159e5fb209", "filename": "gcc/testsuite/lib/gcc.exp", "status": "modified", "additions": 0, "deletions": 4, "changes": 4, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/18787c384aba66221a157862c81238b9fea4e13d/gcc%2Ftestsuite%2Flib%2Fgcc.exp", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/18787c384aba66221a157862c81238b9fea4e13d/gcc%2Ftestsuite%2Flib%2Fgcc.exp", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Flib%2Fgcc.exp?ref=18787c384aba66221a157862c81238b9fea4e13d", "patch": "@@ -141,10 +141,6 @@ proc gcc_target_compile { source dest type options } {\n \tlappend options \"ldflags=$TEST_EXTRA_LIBS\"\n     }\n \n-    if [target_info exists gcc,signal_suppress] {\n-\tlappend options \"additional_flags=-DSIGNAL_SUPPRESS\"\n-    }\n-\n     # TEST_ALWAYS_FLAGS are flags that should be passed to every\n     # compilation.  They are passed first to allow individual\n     # tests to override them."}, {"sha": "31701c23e8f9f88a29e96c56fa08cc9272525347", "filename": "gcc/testsuite/lib/target-supports.exp", "status": "modified", "additions": 9, "deletions": 0, "changes": 9, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/18787c384aba66221a157862c81238b9fea4e13d/gcc%2Ftestsuite%2Flib%2Ftarget-supports.exp", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/18787c384aba66221a157862c81238b9fea4e13d/gcc%2Ftestsuite%2Flib%2Ftarget-supports.exp", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Flib%2Ftarget-supports.exp?ref=18787c384aba66221a157862c81238b9fea4e13d", "patch": "@@ -525,6 +525,15 @@ proc dg-effective-target-value { effective_target } {\n     return 0\n }\n \n+# Return 1 if signal.h is supported.\n+\n+proc check_effective_target_signal { } {\n+    if [target_info exists gcc,signal_suppress] {\n+      return 0\n+    }\n+    return 1\n+}\n+\n # Return 1 if according to target_info struct and explicit target list\n # target disables -fdelete-null-pointer-checks.  Targets should return 0\n # if they simply default to -fno-delete-null-pointer-checks but obey"}]}