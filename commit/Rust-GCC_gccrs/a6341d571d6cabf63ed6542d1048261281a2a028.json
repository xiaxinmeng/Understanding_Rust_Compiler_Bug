{"sha": "a6341d571d6cabf63ed6542d1048261281a2a028", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6YTYzNDFkNTcxZDZjYWJmNjNlZDY1NDJkMTA0ODI2MTI4MWEyYTAyOA==", "commit": {"author": {"name": "Nicola Pero", "email": "nicola.pero@meta-innovation.com", "date": "2010-09-29T22:21:20Z"}, "committer": {"name": "Nicola Pero", "email": "nicola@gcc.gnu.org", "date": "2010-09-29T22:21:20Z"}, "message": "In gcc/: 2010-09-29 Nicola Pero <nicola.pero@meta-innovation.com>\n\nIn gcc/:\n2010-09-29  Nicola Pero  <nicola.pero@meta-innovation.com>\n\n        Merge from 'apple/trunk' branch on FSF servers.\n        * c-parser.c: Applied change originally in c-parse.in.\n\n        2005-10-04  Fariborz Jahanian <fjahanian@apple.com>\n\n        Radar 4281748\n        * c-decl.c (start_decl): Check for redeclaration of class name.\n        * c-parse.in (after_type_declarator): Recognize CLASSNAME.\n\nIn gcc/c-family/:\n2010-09-27  Nicola Pero  <nicola.pero@meta-innovation.com>\n\n        Merge from 'apple/trunk' branch on FSF servers.\n\n        2005-10-04  Fariborz Jahanian <fjahanian@apple.com>\n\n        Radar 4281748\n        * c-common.h (objc_check_global_decl): New declaration.\n        * stub-objc.c (objc_check_global_decl): New stub.\n\nIn gcc/objc/:\n2010-09-28  Nicola Pero  <nicola.pero@meta-innovation.com>\n\n        Merge from 'apple/trunk' branch on FSF servers.\n\n        2005-10-04  Fariborz Jahanian <fjahanian@apple.com>\n\n        Radar 4281748\n        * objc-act.c (objc_check_global_decl): New\n\nIn gcc/testsuite/:\n2010-09-28  Nicola Pero  <nicola.pero@meta-innovation.com>\n\n        Merge from 'apple/trunk' branch on FSF servers.\n\n        2005-10-04  Fariborz Jahanian <fjahanian@apple.com>\n\n        Radar 4281748\n        * objc.dg/naming-2.m: Update\n        * objc.dg/naming-3.m: New\n\nFrom-SVN: r164735", "tree": {"sha": "fb7bbb6d12ab02321562a9f6812dba274c2241c4", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/fb7bbb6d12ab02321562a9f6812dba274c2241c4"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/a6341d571d6cabf63ed6542d1048261281a2a028", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/a6341d571d6cabf63ed6542d1048261281a2a028", "html_url": "https://github.com/Rust-GCC/gccrs/commit/a6341d571d6cabf63ed6542d1048261281a2a028", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/a6341d571d6cabf63ed6542d1048261281a2a028/comments", "author": {"login": "Nico-31415", "id": 94470564, "node_id": "U_kgDOBaGBpA", "avatar_url": "https://avatars.githubusercontent.com/u/94470564?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Nico-31415", "html_url": "https://github.com/Nico-31415", "followers_url": "https://api.github.com/users/Nico-31415/followers", "following_url": "https://api.github.com/users/Nico-31415/following{/other_user}", "gists_url": "https://api.github.com/users/Nico-31415/gists{/gist_id}", "starred_url": "https://api.github.com/users/Nico-31415/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Nico-31415/subscriptions", "organizations_url": "https://api.github.com/users/Nico-31415/orgs", "repos_url": "https://api.github.com/users/Nico-31415/repos", "events_url": "https://api.github.com/users/Nico-31415/events{/privacy}", "received_events_url": "https://api.github.com/users/Nico-31415/received_events", "type": "User", "site_admin": false}, "committer": null, "parents": [{"sha": "b14446e2ff63e339f814681b8ec7c467de819b66", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/b14446e2ff63e339f814681b8ec7c467de819b66", "html_url": "https://github.com/Rust-GCC/gccrs/commit/b14446e2ff63e339f814681b8ec7c467de819b66"}], "stats": {"total": 81, "additions": 79, "deletions": 2}, "files": [{"sha": "962c617ea4f5a325c9b378cdbf158fde05d5fe14", "filename": "gcc/ChangeLog", "status": "modified", "additions": 11, "deletions": 0, "changes": 11, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/a6341d571d6cabf63ed6542d1048261281a2a028/gcc%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/a6341d571d6cabf63ed6542d1048261281a2a028/gcc%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2FChangeLog?ref=a6341d571d6cabf63ed6542d1048261281a2a028", "patch": "@@ -1,3 +1,14 @@\n+2010-09-29  Nicola Pero  <nicola.pero@meta-innovation.com>\n+\n+\tMerge from 'apple/trunk' branch on FSF servers.\n+\t* c-parser.c: Applied change originally in c-parse.in.\n+\t\n+\t2005-10-04  Fariborz Jahanian <fjahanian@apple.com>\n+\n+\tRadar 4281748\n+\t* c-decl.c (start_decl): Check for redeclaration of class name.\n+\t* c-parse.in (after_type_declarator): Recognize CLASSNAME.\n+\n 2010-09-29  Steve Ellcey  <sje@cup.hp.com>\n \n \t* config/ia64/ia64.c (ia64_builtin_decl): New."}, {"sha": "8272d33cd989807e54ffde9d0d2a9f1c07ca9ec3", "filename": "gcc/c-decl.c", "status": "modified", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/a6341d571d6cabf63ed6542d1048261281a2a028/gcc%2Fc-decl.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/a6341d571d6cabf63ed6542d1048261281a2a028/gcc%2Fc-decl.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fc-decl.c?ref=a6341d571d6cabf63ed6542d1048261281a2a028", "patch": "@@ -4072,6 +4072,11 @@ start_decl (struct c_declarator *declarator, struct c_declspecs *declspecs,\n     record_inline_static (input_location, current_function_decl,\n \t\t\t  decl, csi_modifiable);\n \n+  if (c_dialect_objc () \n+      && (TREE_CODE (decl) == VAR_DECL\n+          || TREE_CODE (decl) == FUNCTION_DECL))\n+      objc_check_global_decl (decl);\n+\n   /* Add this decl to the current scope.\n      TEM may equal DECL or it may be a previous decl of the same name.  */\n   tem = pushdecl (decl);"}, {"sha": "a0bcadf7cfe76abfcedad90188fef315fe283d31", "filename": "gcc/c-family/ChangeLog", "status": "modified", "additions": 10, "deletions": 0, "changes": 10, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/a6341d571d6cabf63ed6542d1048261281a2a028/gcc%2Fc-family%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/a6341d571d6cabf63ed6542d1048261281a2a028/gcc%2Fc-family%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fc-family%2FChangeLog?ref=a6341d571d6cabf63ed6542d1048261281a2a028", "patch": "@@ -1,3 +1,13 @@\n+2010-09-27  Nicola Pero  <nicola.pero@meta-innovation.com>\n+\n+\tMerge from 'apple/trunk' branch on FSF servers.\t\n+\t\n+\t2005-10-04  Fariborz Jahanian <fjahanian@apple.com>\n+\n+\tRadar 4281748\n+\t* c-common.h (objc_check_global_decl): New declaration.\n+\t* stub-objc.c (objc_check_global_decl): New stub.\n+\n 2010-09-29  Joseph Myers  <joseph@codesourcery.com>\n \n \t* c.opt: Don't use VarExists."}, {"sha": "27a051c62b7653382381bf6b2c1f29bab59b7f42", "filename": "gcc/c-family/c-common.h", "status": "modified", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/a6341d571d6cabf63ed6542d1048261281a2a028/gcc%2Fc-family%2Fc-common.h", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/a6341d571d6cabf63ed6542d1048261281a2a028/gcc%2Fc-family%2Fc-common.h", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fc-family%2Fc-common.h?ref=a6341d571d6cabf63ed6542d1048261281a2a028", "patch": "@@ -955,6 +955,7 @@ extern void c_parse_error (const char *, enum cpp_ttype, tree, unsigned char);\n extern tree objc_is_class_name (tree);\n extern tree objc_is_object_ptr (tree);\n extern void objc_check_decl (tree);\n+extern void objc_check_global_decl (tree);\n extern tree objc_common_type (tree, tree);\n extern bool objc_compare_types (tree, tree, int, tree);\n extern bool objc_have_common_type (tree, tree, int, tree);"}, {"sha": "51842eb29c80a5e995a81a3d1f0f2cf7e1502c3f", "filename": "gcc/c-family/stub-objc.c", "status": "modified", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/a6341d571d6cabf63ed6542d1048261281a2a028/gcc%2Fc-family%2Fstub-objc.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/a6341d571d6cabf63ed6542d1048261281a2a028/gcc%2Fc-family%2Fstub-objc.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fc-family%2Fstub-objc.c?ref=a6341d571d6cabf63ed6542d1048261281a2a028", "patch": "@@ -56,6 +56,11 @@ objc_check_decl (tree ARG_UNUSED (decl))\n {\n }\n \n+void\n+objc_check_global_decl (tree ARG_UNUSED (decl))\n+{\n+}\n+\n tree\n objc_common_type (tree ARG_UNUSED (type1), tree ARG_UNUSED (type2))\n {"}, {"sha": "cf61b938903ad28699cc6ea9894c84893a6c9a9c", "filename": "gcc/c-parser.c", "status": "modified", "additions": 2, "deletions": 1, "changes": 3, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/a6341d571d6cabf63ed6542d1048261281a2a028/gcc%2Fc-parser.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/a6341d571d6cabf63ed6542d1048261281a2a028/gcc%2Fc-parser.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fc-parser.c?ref=a6341d571d6cabf63ed6542d1048261281a2a028", "patch": "@@ -2560,7 +2560,8 @@ c_parser_direct_declarator (c_parser *parser, bool type_seen_p, c_dtr_syn kind,\n   if (kind != C_DTR_ABSTRACT\n       && c_parser_next_token_is (parser, CPP_NAME)\n       && ((type_seen_p\n-\t   && c_parser_peek_token (parser)->id_kind == C_ID_TYPENAME)\n+\t   && (c_parser_peek_token (parser)->id_kind == C_ID_TYPENAME\n+\t       || c_parser_peek_token (parser)->id_kind == C_ID_CLASSNAME))\n \t  || c_parser_peek_token (parser)->id_kind == C_ID_ID))\n     {\n       struct c_declarator *inner"}, {"sha": "1f5338a86f68cd05a4bfbbcc1995582391c420ba", "filename": "gcc/objc/ChangeLog", "status": "modified", "additions": 9, "deletions": 0, "changes": 9, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/a6341d571d6cabf63ed6542d1048261281a2a028/gcc%2Fobjc%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/a6341d571d6cabf63ed6542d1048261281a2a028/gcc%2Fobjc%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fobjc%2FChangeLog?ref=a6341d571d6cabf63ed6542d1048261281a2a028", "patch": "@@ -1,3 +1,12 @@\n+2010-09-28  Nicola Pero  <nicola.pero@meta-innovation.com>\n+\n+\tMerge from 'apple/trunk' branch on FSF servers.\n+\n+\t2005-10-04  Fariborz Jahanian <fjahanian@apple.com>\n+\n+\tRadar 4281748\n+\t* objc-act.c (objc_check_global_decl): New\n+\n 2010-09-29  Nicola Pero  <nicola.pero@meta-innovation.com>\n \n \t* objc-act.c (objc_is_reserved_word): Removed."}, {"sha": "f63cde085dfbd034caa48272ed8896fbcbc2bb40", "filename": "gcc/objc/objc-act.c", "status": "modified", "additions": 8, "deletions": 0, "changes": 8, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/a6341d571d6cabf63ed6542d1048261281a2a028/gcc%2Fobjc%2Fobjc-act.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/a6341d571d6cabf63ed6542d1048261281a2a028/gcc%2Fobjc%2Fobjc-act.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fobjc%2Fobjc-act.c?ref=a6341d571d6cabf63ed6542d1048261281a2a028", "patch": "@@ -1495,6 +1495,14 @@ objc_check_decl (tree decl)\n \t   type);\n }\n \n+void\n+objc_check_global_decl (tree decl)\n+{\n+  tree id = DECL_NAME (decl);\n+  if (objc_is_class_name (id) && global_bindings_p())\n+    error (\"redeclaration of Objective-C class %qs\", IDENTIFIER_POINTER (id));\n+}\n+\n /* Construct a PROTOCOLS-qualified variant of INTERFACE, where INTERFACE may\n    either name an Objective-C class, or refer to the special 'id' or 'Class'\n    types.  If INTERFACE is not a valid ObjC type, just return it unchanged.  */"}, {"sha": "132c9c2faa448395d2f81c282ec402a75f4daf47", "filename": "gcc/testsuite/ChangeLog", "status": "modified", "additions": 10, "deletions": 0, "changes": 10, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/a6341d571d6cabf63ed6542d1048261281a2a028/gcc%2Ftestsuite%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/a6341d571d6cabf63ed6542d1048261281a2a028/gcc%2Ftestsuite%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2FChangeLog?ref=a6341d571d6cabf63ed6542d1048261281a2a028", "patch": "@@ -1,3 +1,13 @@\n+2010-09-28  Nicola Pero  <nicola.pero@meta-innovation.com>\n+\n+\tMerge from 'apple/trunk' branch on FSF servers.\n+\n+\t2005-10-04  Fariborz Jahanian <fjahanian@apple.com>\n+\n+\tRadar 4281748\n+\t* objc.dg/naming-2.m: Update\n+\t* objc.dg/naming-3.m: New\n+\n 2010-09-29  Bernd Schmidt  <bernds@codesourcery.com>\n \n \tPR target/40457"}, {"sha": "6d087509ea2e8eaeb31eb37b26d9919c3abc2de9", "filename": "gcc/testsuite/objc.dg/naming-2.m", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/a6341d571d6cabf63ed6542d1048261281a2a028/gcc%2Ftestsuite%2Fobjc.dg%2Fnaming-2.m", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/a6341d571d6cabf63ed6542d1048261281a2a028/gcc%2Ftestsuite%2Fobjc.dg%2Fnaming-2.m", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fobjc.dg%2Fnaming-2.m?ref=a6341d571d6cabf63ed6542d1048261281a2a028", "patch": "@@ -4,7 +4,7 @@\n \n @interface Foo\n @end\n-float Foo;  /* { dg-error \"parse error|syntax error|expected\" } */\n+float Foo;  /* { dg-error \"parse error|syntax error|expected|redeclaration\" } */\n \n double Bar;\n @interface Bar"}, {"sha": "dea388c5bd7eb094718f3e2535838033e5bc7df1", "filename": "gcc/testsuite/objc.dg/naming-3.m", "status": "added", "additions": 17, "deletions": 0, "changes": 17, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/a6341d571d6cabf63ed6542d1048261281a2a028/gcc%2Ftestsuite%2Fobjc.dg%2Fnaming-3.m", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/a6341d571d6cabf63ed6542d1048261281a2a028/gcc%2Ftestsuite%2Fobjc.dg%2Fnaming-3.m", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fobjc.dg%2Fnaming-3.m?ref=a6341d571d6cabf63ed6542d1048261281a2a028", "patch": "@@ -0,0 +1,17 @@\n+/* Test for class name same as an unrelated struct field name. */\n+/* { dg-do compile } */\n+@interface PassThrough {\n+\n+}\n+@end\n+\n+struct S {\n+\tint (*PassThrough)();\n+};\n+\n+int main()\n+{\n+\tPassThrough* pt;\n+\tstruct S s;\n+\ts.PassThrough();\n+}"}]}