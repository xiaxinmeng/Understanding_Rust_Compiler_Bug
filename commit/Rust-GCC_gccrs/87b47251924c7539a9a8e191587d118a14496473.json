{"sha": "87b47251924c7539a9a8e191587d118a14496473", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6ODdiNDcyNTE5MjRjNzUzOWE5YThlMTkxNTg3ZDExOGExNDQ5NjQ3Mw==", "commit": {"author": {"name": "Andre Vieira", "email": "andre.simoesdiasvieira@arm.com", "date": "2019-11-11T12:07:04Z"}, "committer": {"name": "Andre Vieira", "email": "avieira@gcc.gnu.org", "date": "2019-11-11T12:07:04Z"}, "message": "[vect]Account for epilogue's peeling for gaps when checking if we have enough\nniters for epilogue\n\ngcc/ChangeLog:\n2019-11-11  Andre Vieira  <andre.simoesdiasvieira@arm.com>\n\n\t* tree-vect-loop-manip.c (vect_do_peeling): Take epilogue gaps into\n\taccount when checking if there are enough iterations to vectorize\n\tepilogue.\n\ngcc/testsuite/ChangeLog:\n2019-11-11  Andre Vieira  <andre.simoesdiasvieira@arm.com>\n\n\t* gcc.dg/vect/vect-reduc-epilogue-gaps.c: New test.\n\nFrom-SVN: r278049", "tree": {"sha": "a75f70ee7521d8e1409a7babf689fcb2838a5e59", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/a75f70ee7521d8e1409a7babf689fcb2838a5e59"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/87b47251924c7539a9a8e191587d118a14496473", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/87b47251924c7539a9a8e191587d118a14496473", "html_url": "https://github.com/Rust-GCC/gccrs/commit/87b47251924c7539a9a8e191587d118a14496473", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/87b47251924c7539a9a8e191587d118a14496473/comments", "author": {"login": "avieira-arm", "id": 68072104, "node_id": "MDQ6VXNlcjY4MDcyMTA0", "avatar_url": "https://avatars.githubusercontent.com/u/68072104?v=4", "gravatar_id": "", "url": "https://api.github.com/users/avieira-arm", "html_url": "https://github.com/avieira-arm", "followers_url": "https://api.github.com/users/avieira-arm/followers", "following_url": "https://api.github.com/users/avieira-arm/following{/other_user}", "gists_url": "https://api.github.com/users/avieira-arm/gists{/gist_id}", "starred_url": "https://api.github.com/users/avieira-arm/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/avieira-arm/subscriptions", "organizations_url": "https://api.github.com/users/avieira-arm/orgs", "repos_url": "https://api.github.com/users/avieira-arm/repos", "events_url": "https://api.github.com/users/avieira-arm/events{/privacy}", "received_events_url": "https://api.github.com/users/avieira-arm/received_events", "type": "User", "site_admin": false}, "committer": null, "parents": [{"sha": "3f246567a44ba034c0b48f929c4d4586a4b914ed", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/3f246567a44ba034c0b48f929c4d4586a4b914ed", "html_url": "https://github.com/Rust-GCC/gccrs/commit/3f246567a44ba034c0b48f929c4d4586a4b914ed"}], "stats": {"total": 60, "additions": 59, "deletions": 1}, "files": [{"sha": "852322bbbb1bc92316e0ec944eb6a0f9e590231b", "filename": "gcc/ChangeLog", "status": "modified", "additions": 6, "deletions": 0, "changes": 6, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/87b47251924c7539a9a8e191587d118a14496473/gcc%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/87b47251924c7539a9a8e191587d118a14496473/gcc%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2FChangeLog?ref=87b47251924c7539a9a8e191587d118a14496473", "patch": "@@ -1,3 +1,9 @@\n+2019-11-11  Andre Vieira  <andre.simoesdiasvieira@arm.com>\n+\n+\t* tree-vect-loop-manip.c (vect_do_peeling): Take epilogue gaps into\n+\taccount when checking if there are enough iterations to vectorize\n+\tepilogue.\n+\n 2019-11-11  Tobias Burnus  <tobias@codesourcery.com>\n \t    Kwok Cheung Yeung  <kcy@codesourcery.com>\n "}, {"sha": "66de94fc5820577a66362f46811173256bd37aea", "filename": "gcc/testsuite/ChangeLog", "status": "modified", "additions": 4, "deletions": 0, "changes": 4, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/87b47251924c7539a9a8e191587d118a14496473/gcc%2Ftestsuite%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/87b47251924c7539a9a8e191587d118a14496473/gcc%2Ftestsuite%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2FChangeLog?ref=87b47251924c7539a9a8e191587d118a14496473", "patch": "@@ -1,3 +1,7 @@\n+2019-11-11  Andre Vieira  <andre.simoesdiasvieira@arm.com>\n+\n+\t* gcc.dg/vect/vect-reduc-epilogue-gaps.c: New test.\n+\n 2019-11-11  Jos\u00e9 Rui Faustino de Sousa  <jrfsousa@gmail.com>\n \n \tPR fortran/92142"}, {"sha": "dc5704f5607fc94fd02036e5db4a9bd37ce5169b", "filename": "gcc/testsuite/gcc.dg/vect/vect-reduc-epilogue-gaps.c", "status": "added", "additions": 45, "deletions": 0, "changes": 45, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/87b47251924c7539a9a8e191587d118a14496473/gcc%2Ftestsuite%2Fgcc.dg%2Fvect%2Fvect-reduc-epilogue-gaps.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/87b47251924c7539a9a8e191587d118a14496473/gcc%2Ftestsuite%2Fgcc.dg%2Fvect%2Fvect-reduc-epilogue-gaps.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgcc.dg%2Fvect%2Fvect-reduc-epilogue-gaps.c?ref=87b47251924c7539a9a8e191587d118a14496473", "patch": "@@ -0,0 +1,45 @@\n+/* { dg-options \"-O3 -fno-vect-cost-model\" } */\n+struct {\n+    float real;\n+    float img;\n+} g[11];\n+\n+float __attribute__ ((noclone))\n+foo_11 (void)\n+{\n+  float sum = 0.0;\n+  for (int i = 0; i < 11; ++i)\n+    sum += g[i].real;\n+  return sum;\n+}\n+\n+float __attribute__ ((noclone))\n+foo_10 (void)\n+{\n+  float sum = 0.0;\n+  for (int i = 0; i < 10; ++i)\n+    sum += g[i].real;\n+  return sum;\n+}\n+\n+int main (void)\n+{\n+  float check_10 = 0.0;\n+  float check_11 = 0.0;\n+  for (int i = 0; i < 11; ++i)\n+    {\n+      asm volatile (\"\" : : : \"memory\");\n+      g[i].real = (float) i;\n+      g[i].img = (float) -i;\n+      if (i < 10)\n+\tcheck_10 += (float) i;\n+      check_11 += (float) i;\n+    }\n+\n+  if (foo_10 () != check_10)\n+    __builtin_abort ();\n+  if (foo_11 () != check_11)\n+    __builtin_abort ();\n+\n+  return 0;\n+}"}, {"sha": "559d59bbe78738e53e7e6c1d64e7f87eed255d76", "filename": "gcc/tree-vect-loop-manip.c", "status": "modified", "additions": 4, "deletions": 1, "changes": 5, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/87b47251924c7539a9a8e191587d118a14496473/gcc%2Ftree-vect-loop-manip.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/87b47251924c7539a9a8e191587d118a14496473/gcc%2Ftree-vect-loop-manip.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftree-vect-loop-manip.c?ref=87b47251924c7539a9a8e191587d118a14496473", "patch": "@@ -2530,9 +2530,11 @@ vect_do_peeling (loop_vec_info loop_vinfo, tree niters, tree nitersm1,\n \t= eiters % lowest_vf + LOOP_VINFO_PEELING_FOR_GAPS (loop_vinfo);\n \n       unsigned int ratio;\n+      unsigned int epilogue_gaps\n+\t= LOOP_VINFO_PEELING_FOR_GAPS (epilogue_vinfo);\n       while (!(constant_multiple_p (loop_vinfo->vector_size,\n \t\t\t\t    epilogue_vinfo->vector_size, &ratio)\n-\t       && eiters >= lowest_vf / ratio))\n+\t       && eiters >= lowest_vf / ratio + epilogue_gaps))\n \t{\n \t  delete epilogue_vinfo;\n \t  epilogue_vinfo = NULL;\n@@ -2543,6 +2545,7 @@ vect_do_peeling (loop_vec_info loop_vinfo, tree niters, tree nitersm1,\n \t    }\n \t  epilogue_vinfo = loop_vinfo->epilogue_vinfos[0];\n \t  loop_vinfo->epilogue_vinfos.ordered_remove (0);\n+\t  epilogue_gaps = LOOP_VINFO_PEELING_FOR_GAPS (epilogue_vinfo);\n \t}\n     }\n   /* Prolog loop may be skipped.  */"}]}