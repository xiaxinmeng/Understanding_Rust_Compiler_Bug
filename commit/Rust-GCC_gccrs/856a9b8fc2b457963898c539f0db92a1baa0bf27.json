{"sha": "856a9b8fc2b457963898c539f0db92a1baa0bf27", "node_id": "C_kwDOANBUbNoAKDg1NmE5YjhmYzJiNDU3OTYzODk4YzUzOWYwZGI5MmExYmFhMGJmMjc", "commit": {"author": {"name": "Harald Anlauf", "email": "anlauf@gmx.de", "date": "2022-06-15T20:20:09Z"}, "committer": {"name": "Harald Anlauf", "email": "anlauf@gmx.de", "date": "2022-06-18T16:42:17Z"}, "message": "Fortran: check POS and LEN arguments simplifying bit intrinsics [PR105986]\n\ngcc/fortran/ChangeLog:\n\n\tPR fortran/105986\n\t* simplify.cc (gfc_simplify_btest): Add check for POS argument.\n\t(gfc_simplify_ibclr): Add check for POS argument.\n\t(gfc_simplify_ibits): Add check for POS and LEN arguments.\n\t(gfc_simplify_ibset): Add check for POS argument.\n\ngcc/testsuite/ChangeLog:\n\n\tPR fortran/105986\n\t* gfortran.dg/check_bits_3.f90: New test.", "tree": {"sha": "496b64258b5beecb0939504cc85e1fc2f18789de", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/496b64258b5beecb0939504cc85e1fc2f18789de"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/856a9b8fc2b457963898c539f0db92a1baa0bf27", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/856a9b8fc2b457963898c539f0db92a1baa0bf27", "html_url": "https://github.com/Rust-GCC/gccrs/commit/856a9b8fc2b457963898c539f0db92a1baa0bf27", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/856a9b8fc2b457963898c539f0db92a1baa0bf27/comments", "author": {"login": "harald-anlauf", "id": 90786862, "node_id": "MDQ6VXNlcjkwNzg2ODYy", "avatar_url": "https://avatars.githubusercontent.com/u/90786862?v=4", "gravatar_id": "", "url": "https://api.github.com/users/harald-anlauf", "html_url": "https://github.com/harald-anlauf", "followers_url": "https://api.github.com/users/harald-anlauf/followers", "following_url": "https://api.github.com/users/harald-anlauf/following{/other_user}", "gists_url": "https://api.github.com/users/harald-anlauf/gists{/gist_id}", "starred_url": "https://api.github.com/users/harald-anlauf/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/harald-anlauf/subscriptions", "organizations_url": "https://api.github.com/users/harald-anlauf/orgs", "repos_url": "https://api.github.com/users/harald-anlauf/repos", "events_url": "https://api.github.com/users/harald-anlauf/events{/privacy}", "received_events_url": "https://api.github.com/users/harald-anlauf/received_events", "type": "User", "site_admin": false}, "committer": {"login": "harald-anlauf", "id": 90786862, "node_id": "MDQ6VXNlcjkwNzg2ODYy", "avatar_url": "https://avatars.githubusercontent.com/u/90786862?v=4", "gravatar_id": "", "url": "https://api.github.com/users/harald-anlauf", "html_url": "https://github.com/harald-anlauf", "followers_url": "https://api.github.com/users/harald-anlauf/followers", "following_url": "https://api.github.com/users/harald-anlauf/following{/other_user}", "gists_url": "https://api.github.com/users/harald-anlauf/gists{/gist_id}", "starred_url": "https://api.github.com/users/harald-anlauf/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/harald-anlauf/subscriptions", "organizations_url": "https://api.github.com/users/harald-anlauf/orgs", "repos_url": "https://api.github.com/users/harald-anlauf/repos", "events_url": "https://api.github.com/users/harald-anlauf/events{/privacy}", "received_events_url": "https://api.github.com/users/harald-anlauf/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "2c7cfc7b418564a2f1f0e7a5b38dec7013ba5e18", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/2c7cfc7b418564a2f1f0e7a5b38dec7013ba5e18", "html_url": "https://github.com/Rust-GCC/gccrs/commit/2c7cfc7b418564a2f1f0e7a5b38dec7013ba5e18"}], "stats": {"total": 28, "additions": 28, "deletions": 0}, "files": [{"sha": "c8f2ef9fbf43bb540493f9e9464b4d75483e918f", "filename": "gcc/fortran/simplify.cc", "status": "modified", "additions": 12, "deletions": 0, "changes": 12, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/856a9b8fc2b457963898c539f0db92a1baa0bf27/gcc%2Ffortran%2Fsimplify.cc", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/856a9b8fc2b457963898c539f0db92a1baa0bf27/gcc%2Ffortran%2Fsimplify.cc", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ffortran%2Fsimplify.cc?ref=856a9b8fc2b457963898c539f0db92a1baa0bf27", "patch": "@@ -1644,6 +1644,9 @@ gfc_simplify_btest (gfc_expr *e, gfc_expr *bit)\n   if (e->expr_type != EXPR_CONSTANT || bit->expr_type != EXPR_CONSTANT)\n     return NULL;\n \n+  if (!gfc_check_bitfcn (e, bit))\n+    return &gfc_bad_expr;\n+\n   if (gfc_extract_int (bit, &b) || b < 0)\n     return gfc_get_logical_expr (gfc_default_logical_kind, &e->where, false);\n \n@@ -3353,6 +3356,9 @@ gfc_simplify_ibclr (gfc_expr *x, gfc_expr *y)\n   if (x->expr_type != EXPR_CONSTANT || y->expr_type != EXPR_CONSTANT)\n     return NULL;\n \n+  if (!gfc_check_bitfcn (x, y))\n+    return &gfc_bad_expr;\n+\n   gfc_extract_int (y, &pos);\n \n   k = gfc_validate_kind (x->ts.type, x->ts.kind, false);\n@@ -3384,6 +3390,9 @@ gfc_simplify_ibits (gfc_expr *x, gfc_expr *y, gfc_expr *z)\n       || z->expr_type != EXPR_CONSTANT)\n     return NULL;\n \n+  if (!gfc_check_ibits (x, y, z))\n+    return &gfc_bad_expr;\n+\n   gfc_extract_int (y, &pos);\n   gfc_extract_int (z, &len);\n \n@@ -3438,6 +3447,9 @@ gfc_simplify_ibset (gfc_expr *x, gfc_expr *y)\n   if (x->expr_type != EXPR_CONSTANT || y->expr_type != EXPR_CONSTANT)\n     return NULL;\n \n+  if (!gfc_check_bitfcn (x, y))\n+    return &gfc_bad_expr;\n+\n   gfc_extract_int (y, &pos);\n \n   k = gfc_validate_kind (x->ts.type, x->ts.kind, false);"}, {"sha": "3018e6977ef7a574fb0a92f12c1e820a6edab26e", "filename": "gcc/testsuite/gfortran.dg/check_bits_3.f90", "status": "added", "additions": 16, "deletions": 0, "changes": 16, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/856a9b8fc2b457963898c539f0db92a1baa0bf27/gcc%2Ftestsuite%2Fgfortran.dg%2Fcheck_bits_3.f90", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/856a9b8fc2b457963898c539f0db92a1baa0bf27/gcc%2Ftestsuite%2Fgfortran.dg%2Fcheck_bits_3.f90", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgfortran.dg%2Fcheck_bits_3.f90?ref=856a9b8fc2b457963898c539f0db92a1baa0bf27", "patch": "@@ -0,0 +1,16 @@\n+! { dg-do compile }\n+! PR fortran/105986\n+! Contributed by G.Steinmetz\n+\n+program p\n+  integer :: i\n+  logical, parameter :: a(*) = [(btest(8_4,i), i=-1,-1)] ! { dg-error \"nonnegative\" }\n+  integer, parameter :: b(*) = [(ibclr(8_4,i), i=-1,-1)] ! { dg-error \"nonnegative\" }\n+  integer, parameter :: c(*) = [(ibset(8_4,i), i=-1,-1)] ! { dg-error \"nonnegative\" }\n+  logical, parameter :: d(*) = [(btest(8_1,i), i= 8, 8)] ! { dg-error \"must be less\" }\n+  integer, parameter :: e(*) = [(ibclr(8_2,i), i=16,16)] ! { dg-error \"must be less\" }\n+  integer, parameter :: f(*) = [(ibset(8_4,i), i=32,32)] ! { dg-error \"must be less\" }\n+  integer, parameter :: g(*) = [(ibits(8_4,i,1),i=-1,-1)] ! { dg-error \"nonnegative\" }\n+  integer, parameter :: h(*) = [(ibits(8_4,1,i),i=-1,-1)] ! { dg-error \"nonnegative\" }\n+  integer, parameter :: j(*) = [(ibits(8_4,i,i),i=32,32)] ! { dg-error \"must be less\" }\n+end"}]}