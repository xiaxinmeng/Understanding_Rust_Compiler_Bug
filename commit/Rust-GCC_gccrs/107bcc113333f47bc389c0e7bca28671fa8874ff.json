{"sha": "107bcc113333f47bc389c0e7bca28671fa8874ff", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6MTA3YmNjMTEzMzMzZjQ3YmMzODljMGU3YmNhMjg2NzFmYTg4NzRmZg==", "commit": {"author": {"name": "Paul Brook", "email": "paul@codesourcery.com", "date": "2005-09-28T22:12:55Z"}, "committer": {"name": "Paul Brook", "email": "pbrook@gcc.gnu.org", "date": "2005-09-28T22:12:55Z"}, "message": "fpgnulib.c (__extendsfdf2, [...]): Handle denormals.\n\n2005-09-28  Paul Brook  <paul@codesourcery.com>\n\n\t* config/m68k/fpgnulib.c (__extendsfdf2, __truncdfsf2): Handle\n\tdenormals.\n\nFrom-SVN: r104745", "tree": {"sha": "ac3fa726b8acb3d936603df656ceeab21b0498c3", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/ac3fa726b8acb3d936603df656ceeab21b0498c3"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/107bcc113333f47bc389c0e7bca28671fa8874ff", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/107bcc113333f47bc389c0e7bca28671fa8874ff", "html_url": "https://github.com/Rust-GCC/gccrs/commit/107bcc113333f47bc389c0e7bca28671fa8874ff", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/107bcc113333f47bc389c0e7bca28671fa8874ff/comments", "author": null, "committer": null, "parents": [{"sha": "e7d15badcc90ce5325021cd2db72a795255e1b59", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/e7d15badcc90ce5325021cd2db72a795255e1b59", "html_url": "https://github.com/Rust-GCC/gccrs/commit/e7d15badcc90ce5325021cd2db72a795255e1b59"}], "stats": {"total": 35, "additions": 32, "deletions": 3}, "files": [{"sha": "6cce8e834a51077e283a8d6d4d18f63e9ee9a4dd", "filename": "gcc/ChangeLog", "status": "modified", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/107bcc113333f47bc389c0e7bca28671fa8874ff/gcc%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/107bcc113333f47bc389c0e7bca28671fa8874ff/gcc%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2FChangeLog?ref=107bcc113333f47bc389c0e7bca28671fa8874ff", "patch": "@@ -1,3 +1,8 @@\n+2005-09-28  Paul Brook  <paul@codesourcery.com>\n+\n+\t* config/m68k/fpgnulib.c (__extendsfdf2, __truncdfsf2): Handle\n+\tdenormals.\n+\n 2005-09-28  Richard Guenther  <rguenther@suse.de>\n \n \tPR tree-optimization/23853"}, {"sha": "2e8dd5d14307af65a6717f7dbaaf2d7ca7b5130c", "filename": "gcc/config/m68k/fpgnulib.c", "status": "modified", "additions": 27, "deletions": 3, "changes": 30, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/107bcc113333f47bc389c0e7bca28671fa8874ff/gcc%2Fconfig%2Fm68k%2Ffpgnulib.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/107bcc113333f47bc389c0e7bca28671fa8874ff/gcc%2Fconfig%2Fm68k%2Ffpgnulib.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fconfig%2Fm68k%2Ffpgnulib.c?ref=107bcc113333f47bc389c0e7bca28671fa8874ff", "patch": "@@ -166,6 +166,7 @@ __extendsfdf2 (float a1)\n   register union float_long fl1;\n   register union double_long dl;\n   register long exp;\n+  register long mant;\n \n   fl1.f = a1;\n \n@@ -176,10 +177,23 @@ __extendsfdf2 (float a1)\n     }\n \n   dl.l.upper = SIGN (fl1.l);\n-  exp = EXP (fl1.l) - EXCESS + EXCESSD;\n+  exp = EXP(fl1.l);\n+  mant = MANT (fl1.l) & ~HIDDEN;\n+  if (exp == 0)\n+    {\n+      /* Denormal.  */\n+      exp = 1;\n+      while (!(mant & HIDDEN))\n+\t{\n+\t  mant <<= 1;\n+\t  exp--;\n+\t}\n+      mant &= ~HIDDEN;\n+    }\n+  exp = exp - EXCESS + EXCESSD;\n   dl.l.upper |= exp << 20;\n-  dl.l.upper |= (MANT (fl1.l) & ~HIDDEN) >> 3;\n-  dl.l.lower = MANT (fl1.l) << 29;\n+  dl.l.upper |= mant >> 3;\n+  dl.l.lower = mant << 29;\n \t\n   return dl.d;\n }\n@@ -203,6 +217,16 @@ __truncdfsf2 (double a1)\n   /* shift double mantissa 6 bits so we can round */\n   mant = MANTD (dl1) >> 6;\n \n+  /* Check for underflow and denormals.  */\n+  if (exp <= 0)\n+    {\n+      if (exp < -24)\n+\tmant = 0;\n+      else\n+\tmant >>= 1 - exp;\n+      exp = 0;\n+    }\n+  \n   /* now round and shift down */\n   mant += 1;\n   mant >>= 1;"}]}