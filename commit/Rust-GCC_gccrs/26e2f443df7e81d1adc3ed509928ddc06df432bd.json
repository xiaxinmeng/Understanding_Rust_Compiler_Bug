{"sha": "26e2f443df7e81d1adc3ed509928ddc06df432bd", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6MjZlMmY0NDNkZjdlODFkMWFkYzNlZDUwOTkyOGRkYzA2ZGY0MzJiZA==", "commit": {"author": {"name": "David S. Miller", "email": "davem@gcc.gnu.org", "date": "2011-10-07T17:23:47Z"}, "committer": {"name": "David S. Miller", "email": "davem@gcc.gnu.org", "date": "2011-10-07T17:23:47Z"}, "message": "Fix VIS3 assembler check and conditionalize testsuite on VIS3 support.\n\ngcc/\n\n\tPR 50655\n\t* configure.ac: Add .register directives to VIS3 test.\n\t* configure: Regenerate.\n\ngcc/testsuite/\n\n\tPR 50655\n\t* gcc.target/sparc/sparc.exp: Add vis3 target test.\n\t* gcc.target/sparc/cmask.c: Use it.\n\t* gcc.target/sparc/fhalve.c: Likewise.\n\t* gcc.target/sparc/fnegop.c: Likewise.\n\t* gcc.target/sparc/fpadds.c: Likewise.\n\t* gcc.target/sparc/fshift.c: Likewise.\n\t* gcc.target/sparc/fucmp.c: Likewise.\n\t* gcc.target/sparc/lzd.c: Likewise.\n\t* gcc.target/sparc/vis3misc.c: Likewise.\n\t* gcc.target/sparc/xmul.c: Likewise.\n\nFrom-SVN: r179667", "tree": {"sha": "a9ac03c60b44546a03e275007e09c3d9881947df", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/a9ac03c60b44546a03e275007e09c3d9881947df"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/26e2f443df7e81d1adc3ed509928ddc06df432bd", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/26e2f443df7e81d1adc3ed509928ddc06df432bd", "html_url": "https://github.com/Rust-GCC/gccrs/commit/26e2f443df7e81d1adc3ed509928ddc06df432bd", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/26e2f443df7e81d1adc3ed509928ddc06df432bd/comments", "author": null, "committer": null, "parents": [{"sha": "d792cd1e4ad7e24e9f8c13663f3d54399e151338", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/d792cd1e4ad7e24e9f8c13663f3d54399e151338", "html_url": "https://github.com/Rust-GCC/gccrs/commit/d792cd1e4ad7e24e9f8c13663f3d54399e151338"}], "stats": {"total": 55, "additions": 45, "deletions": 10}, "files": [{"sha": "573ce6ec2799ba847b3a8f868939542977027563", "filename": "gcc/ChangeLog", "status": "modified", "additions": 6, "deletions": 0, "changes": 6, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/26e2f443df7e81d1adc3ed509928ddc06df432bd/gcc%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/26e2f443df7e81d1adc3ed509928ddc06df432bd/gcc%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2FChangeLog?ref=26e2f443df7e81d1adc3ed509928ddc06df432bd", "patch": "@@ -1,3 +1,9 @@\n+2011-10-07  David S. Miller  <davem@davemloft.net>\n+\n+\tPR 50655\n+\t* configure.ac: Add .register directives to VIS3 test.\n+\t* configure: Regenerate.\n+\n 2011-10-07  Richard Henderson  <rth@redhat.com>\n \n \t* config.gcc (x86_64-*): Add core-avx-i, core-avx2 for with_cpu."}, {"sha": "cb55ddaa2a48373345b85fe534e34e81141f2dae", "filename": "gcc/configure", "status": "modified", "additions": 2, "deletions": 0, "changes": 2, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/26e2f443df7e81d1adc3ed509928ddc06df432bd/gcc%2Fconfigure", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/26e2f443df7e81d1adc3ed509928ddc06df432bd/gcc%2Fconfigure", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fconfigure?ref=26e2f443df7e81d1adc3ed509928ddc06df432bd", "patch": "@@ -24060,6 +24060,8 @@ else\n   gcc_cv_as_sparc_fmaf=no\n   if test x$gcc_cv_as != x; then\n     $as_echo '.text\n+       .register %g2, #scratch\n+       .register %g3, #scratch\n        .align 4\n        fmaddd %f0, %f2, %f4, %f6\n        addxccc %g1, %g2, %g3"}, {"sha": "a7b94e64451ba77f55d2e16d715ff31463e8de34", "filename": "gcc/configure.ac", "status": "modified", "additions": 2, "deletions": 0, "changes": 2, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/26e2f443df7e81d1adc3ed509928ddc06df432bd/gcc%2Fconfigure.ac", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/26e2f443df7e81d1adc3ed509928ddc06df432bd/gcc%2Fconfigure.ac", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fconfigure.ac?ref=26e2f443df7e81d1adc3ed509928ddc06df432bd", "patch": "@@ -3491,6 +3491,8 @@ foo:\n       gcc_cv_as_sparc_fmaf,,\n       [-xarch=v9d],\n       [.text\n+       .register %g2, #scratch\n+       .register %g3, #scratch\n        .align 4\n        fmaddd %f0, %f2, %f4, %f6\n        addxccc %g1, %g2, %g3"}, {"sha": "ea79b6075fb50c7de5ccbe895a3a503febcfe932", "filename": "gcc/testsuite/ChangeLog", "status": "modified", "additions": 15, "deletions": 1, "changes": 16, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/26e2f443df7e81d1adc3ed509928ddc06df432bd/gcc%2Ftestsuite%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/26e2f443df7e81d1adc3ed509928ddc06df432bd/gcc%2Ftestsuite%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2FChangeLog?ref=26e2f443df7e81d1adc3ed509928ddc06df432bd", "patch": "@@ -1,3 +1,17 @@\n+2011-10-07  David S. Miller  <davem@davemloft.net>\n+\n+\tPR 50655\n+\t* gcc.target/sparc/sparc.exp: Add vis3 target test.\n+\t* gcc.target/sparc/cmask.c: Use it.\n+\t* gcc.target/sparc/fhalve.c: Likewise.\n+\t* gcc.target/sparc/fnegop.c: Likewise.\n+\t* gcc.target/sparc/fpadds.c: Likewise.\n+\t* gcc.target/sparc/fshift.c: Likewise.\n+\t* gcc.target/sparc/fucmp.c: Likewise.\n+\t* gcc.target/sparc/lzd.c: Likewise.\n+\t* gcc.target/sparc/vis3misc.c: Likewise.\n+\t* gcc.target/sparc/xmul.c: Likewise.\n+\n 2011-10-07  Richard Henderson  <rth@redhat.com>\n \n \t* gcc.target/i386/avx256-unaligned-load-2.c: Tweek vinsert pattern\n@@ -17,7 +31,7 @@\n 2011-10-06  Joern Rennecke <joern.rennecke@embecosm.com>\n \n \t* gcc.dg/pr47276.c (ASMNAME, ASMNAME2, STRING): Define.\n-\t(__EI___vsyslog_chk, __EI_syslog, __EI_vsyslog): Use ASMNAME.  \n+\t(__EI___vsyslog_chk, __EI_syslog, __EI_vsyslog): Use ASMNAME.\n \t(syslog, vsyslog, __vsyslog_chk): Likewise.\n \n \t* gcc.dg/lto/20081222_1.c (ASMNAME, ASMNAME2, STRING): Define."}, {"sha": "989274c68584c66afd0d59d1c4c9409bd1314aab", "filename": "gcc/testsuite/gcc.target/sparc/cmask.c", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/26e2f443df7e81d1adc3ed509928ddc06df432bd/gcc%2Ftestsuite%2Fgcc.target%2Fsparc%2Fcmask.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/26e2f443df7e81d1adc3ed509928ddc06df432bd/gcc%2Ftestsuite%2Fgcc.target%2Fsparc%2Fcmask.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgcc.target%2Fsparc%2Fcmask.c?ref=26e2f443df7e81d1adc3ed509928ddc06df432bd", "patch": "@@ -1,4 +1,4 @@\n-/* { dg-do compile } */\n+/* { dg-do compile { target { vis3 } } } */\n /* { dg-options \"-mcpu=niagara3 -mvis\" } */\n \n void test_cm8 (long x)"}, {"sha": "737fc71bbcf64cbf7f8819bd92fddc236c477b59", "filename": "gcc/testsuite/gcc.target/sparc/fhalve.c", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/26e2f443df7e81d1adc3ed509928ddc06df432bd/gcc%2Ftestsuite%2Fgcc.target%2Fsparc%2Ffhalve.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/26e2f443df7e81d1adc3ed509928ddc06df432bd/gcc%2Ftestsuite%2Fgcc.target%2Fsparc%2Ffhalve.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgcc.target%2Fsparc%2Ffhalve.c?ref=26e2f443df7e81d1adc3ed509928ddc06df432bd", "patch": "@@ -1,4 +1,4 @@\n-/* { dg-do compile } */\n+/* { dg-do compile { target { vis3 } } } */\n /* { dg-options \"-mcpu=niagara3 -mvis\" } */\n \n float test_fhadds (float x, float y)"}, {"sha": "3e3e72c820cab695478345ebded37056f107351f", "filename": "gcc/testsuite/gcc.target/sparc/fnegop.c", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/26e2f443df7e81d1adc3ed509928ddc06df432bd/gcc%2Ftestsuite%2Fgcc.target%2Fsparc%2Ffnegop.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/26e2f443df7e81d1adc3ed509928ddc06df432bd/gcc%2Ftestsuite%2Fgcc.target%2Fsparc%2Ffnegop.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgcc.target%2Fsparc%2Ffnegop.c?ref=26e2f443df7e81d1adc3ed509928ddc06df432bd", "patch": "@@ -1,4 +1,4 @@\n-/* { dg-do compile } */\n+/* { dg-do compile { target { vis3 } } } */\n /* { dg-options \"-O2 -mcpu=niagara3 -mvis\" } */\n \n float test_fnadds(float x, float y)"}, {"sha": "f55cb057a2ad2f21881c53f1358613f5ee632594", "filename": "gcc/testsuite/gcc.target/sparc/fpadds.c", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/26e2f443df7e81d1adc3ed509928ddc06df432bd/gcc%2Ftestsuite%2Fgcc.target%2Fsparc%2Ffpadds.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/26e2f443df7e81d1adc3ed509928ddc06df432bd/gcc%2Ftestsuite%2Fgcc.target%2Fsparc%2Ffpadds.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgcc.target%2Fsparc%2Ffpadds.c?ref=26e2f443df7e81d1adc3ed509928ddc06df432bd", "patch": "@@ -1,4 +1,4 @@\n-/* { dg-do compile } */\n+/* { dg-do compile { target { vis3 } } } */\n /* { dg-options \"-mcpu=niagara3 -mvis\" } */\n typedef int __v2si __attribute__((vector_size(8)));\n typedef int __v1si __attribute__((vector_size(4)));"}, {"sha": "6adbed6917190fa79876855ea58d33176854b8ba", "filename": "gcc/testsuite/gcc.target/sparc/fshift.c", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/26e2f443df7e81d1adc3ed509928ddc06df432bd/gcc%2Ftestsuite%2Fgcc.target%2Fsparc%2Ffshift.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/26e2f443df7e81d1adc3ed509928ddc06df432bd/gcc%2Ftestsuite%2Fgcc.target%2Fsparc%2Ffshift.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgcc.target%2Fsparc%2Ffshift.c?ref=26e2f443df7e81d1adc3ed509928ddc06df432bd", "patch": "@@ -1,4 +1,4 @@\n-/* { dg-do compile } */\n+/* { dg-do compile { target { vis3 } } } */\n /* { dg-options \"-mcpu=niagara3 -mvis\" } */\n typedef int __v2si __attribute__((vector_size(8)));\n typedef short __v4hi __attribute__((vector_size(8)));"}, {"sha": "4e7ecadcd4aeaca1613911ba971d2c6bc57af07b", "filename": "gcc/testsuite/gcc.target/sparc/fucmp.c", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/26e2f443df7e81d1adc3ed509928ddc06df432bd/gcc%2Ftestsuite%2Fgcc.target%2Fsparc%2Ffucmp.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/26e2f443df7e81d1adc3ed509928ddc06df432bd/gcc%2Ftestsuite%2Fgcc.target%2Fsparc%2Ffucmp.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgcc.target%2Fsparc%2Ffucmp.c?ref=26e2f443df7e81d1adc3ed509928ddc06df432bd", "patch": "@@ -1,4 +1,4 @@\n-/* { dg-do compile } */\n+/* { dg-do compile { target { vis3 } } } */\n /* { dg-options \"-mcpu=niagara3 -mvis\" } */\n typedef unsigned char vec8 __attribute__((vector_size(8)));\n "}, {"sha": "5ffaf56e5584cac7da0d17e2e68d97a058573a5c", "filename": "gcc/testsuite/gcc.target/sparc/lzd.c", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/26e2f443df7e81d1adc3ed509928ddc06df432bd/gcc%2Ftestsuite%2Fgcc.target%2Fsparc%2Flzd.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/26e2f443df7e81d1adc3ed509928ddc06df432bd/gcc%2Ftestsuite%2Fgcc.target%2Fsparc%2Flzd.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgcc.target%2Fsparc%2Flzd.c?ref=26e2f443df7e81d1adc3ed509928ddc06df432bd", "patch": "@@ -1,4 +1,4 @@\n-/* { dg-do compile } */\n+/* { dg-do compile { target { vis3 } } } */\n /* { dg-options \"-mcpu=niagara3\" } */\n int test_clz(int a)\n {"}, {"sha": "51c9c16ecb77c912fa78c07170a4c7ab56ecf3d5", "filename": "gcc/testsuite/gcc.target/sparc/sparc.exp", "status": "modified", "additions": 11, "deletions": 0, "changes": 11, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/26e2f443df7e81d1adc3ed509928ddc06df432bd/gcc%2Ftestsuite%2Fgcc.target%2Fsparc%2Fsparc.exp", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/26e2f443df7e81d1adc3ed509928ddc06df432bd/gcc%2Ftestsuite%2Fgcc.target%2Fsparc%2Fsparc.exp", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgcc.target%2Fsparc%2Fsparc.exp?ref=26e2f443df7e81d1adc3ed509928ddc06df432bd", "patch": "@@ -24,6 +24,17 @@ if ![istarget sparc*-*-*] then {\n # Load support procs.\n load_lib gcc-dg.exp\n \n+# Return 1 if vis3 instructions can be compiled.\n+proc check_effective_target_vis3 { } {\n+    return [check_no_compiler_messages vis3 object {\n+\tlong long\n+\t_vis3_fpadd64 (long long __X, long long __Y)\n+\t{\n+\t    return __builtin_vis_fpadd64 (__X, __Y);\n+\t}\n+    } \"-mcpu=niagara3 -mvis\" ]\n+}\n+\n # If a testcase doesn't have special options, use these.\n global DEFAULT_CFLAGS\n if ![info exists DEFAULT_CFLAGS] then {"}, {"sha": "e3ef49e210d3d26d1fc76d182d24c5b0456bc06a", "filename": "gcc/testsuite/gcc.target/sparc/vis3misc.c", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/26e2f443df7e81d1adc3ed509928ddc06df432bd/gcc%2Ftestsuite%2Fgcc.target%2Fsparc%2Fvis3misc.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/26e2f443df7e81d1adc3ed509928ddc06df432bd/gcc%2Ftestsuite%2Fgcc.target%2Fsparc%2Fvis3misc.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgcc.target%2Fsparc%2Fvis3misc.c?ref=26e2f443df7e81d1adc3ed509928ddc06df432bd", "patch": "@@ -1,4 +1,4 @@\n-/* { dg-do compile } */\n+/* { dg-do compile { target { vis3 } } } */\n /* { dg-options \"-mcpu=niagara3 -mvis\" } */\n typedef int __v2si __attribute__((vector_size(8)));\n typedef short __v4hi __attribute__((vector_size(8)));"}, {"sha": "5d249d092dbc5b19de4733e44ec4bc258c06eabf", "filename": "gcc/testsuite/gcc.target/sparc/xmul.c", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/26e2f443df7e81d1adc3ed509928ddc06df432bd/gcc%2Ftestsuite%2Fgcc.target%2Fsparc%2Fxmul.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/26e2f443df7e81d1adc3ed509928ddc06df432bd/gcc%2Ftestsuite%2Fgcc.target%2Fsparc%2Fxmul.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgcc.target%2Fsparc%2Fxmul.c?ref=26e2f443df7e81d1adc3ed509928ddc06df432bd", "patch": "@@ -1,4 +1,4 @@\n-/* { dg-do compile } */\n+/* { dg-do compile { target { vis3 } } } */\n /* { dg-options \"-mcpu=niagara3 -mvis\" } */\n typedef long long int64_t;\n "}]}