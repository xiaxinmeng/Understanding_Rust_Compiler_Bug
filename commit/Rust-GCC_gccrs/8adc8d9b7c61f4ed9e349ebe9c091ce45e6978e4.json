{"sha": "8adc8d9b7c61f4ed9e349ebe9c091ce45e6978e4", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6OGFkYzhkOWI3YzYxZjRlZDllMzQ5ZWJlOWMwOTFjZTQ1ZTY5NzhlNA==", "commit": {"author": {"name": "Piotr Trojanek", "email": "trojanek@adacore.com", "date": "2021-01-14T20:14:06Z"}, "committer": {"name": "Pierre-Marie de Rodat", "email": "derodat@adacore.com", "date": "2021-05-05T08:19:06Z"}, "message": "[Ada] Reuse Has_Defaulted_Discriminants where possible\n\ngcc/ada/\n\n\t* exp_attr.adb, exp_ch9.adb, sem_ch3.adb: Reuse\n\tHas_Defaulted_Discriminants.\n\t* sem_ch4.adb (Analyze_Allocator): Reuse\n\tHas_Defaulted_Discriminants (after reordering conjuncts); remove\n\tredundant IF statement, whose condition is implied by\n\tHas_Defaulted_Discriminants.\n\t* sem_util.adb (Has_Defaulted_Discriminants): Has_Discriminants\n\timplies that the First_Discriminant is present.\n\t(Is_Fully_Initialized_Type): Reuse Has_Defaulted_Discriminants.", "tree": {"sha": "051a0348f4b8051d424cb87edfc26cc9d7e1b932", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/051a0348f4b8051d424cb87edfc26cc9d7e1b932"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/8adc8d9b7c61f4ed9e349ebe9c091ce45e6978e4", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/8adc8d9b7c61f4ed9e349ebe9c091ce45e6978e4", "html_url": "https://github.com/Rust-GCC/gccrs/commit/8adc8d9b7c61f4ed9e349ebe9c091ce45e6978e4", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/8adc8d9b7c61f4ed9e349ebe9c091ce45e6978e4/comments", "author": {"login": "ptroja", "id": 161602, "node_id": "MDQ6VXNlcjE2MTYwMg==", "avatar_url": "https://avatars.githubusercontent.com/u/161602?v=4", "gravatar_id": "", "url": "https://api.github.com/users/ptroja", "html_url": "https://github.com/ptroja", "followers_url": "https://api.github.com/users/ptroja/followers", "following_url": "https://api.github.com/users/ptroja/following{/other_user}", "gists_url": "https://api.github.com/users/ptroja/gists{/gist_id}", "starred_url": "https://api.github.com/users/ptroja/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/ptroja/subscriptions", "organizations_url": "https://api.github.com/users/ptroja/orgs", "repos_url": "https://api.github.com/users/ptroja/repos", "events_url": "https://api.github.com/users/ptroja/events{/privacy}", "received_events_url": "https://api.github.com/users/ptroja/received_events", "type": "User", "site_admin": false}, "committer": {"login": "pmderodat", "id": 758452, "node_id": "MDQ6VXNlcjc1ODQ1Mg==", "avatar_url": "https://avatars.githubusercontent.com/u/758452?v=4", "gravatar_id": "", "url": "https://api.github.com/users/pmderodat", "html_url": "https://github.com/pmderodat", "followers_url": "https://api.github.com/users/pmderodat/followers", "following_url": "https://api.github.com/users/pmderodat/following{/other_user}", "gists_url": "https://api.github.com/users/pmderodat/gists{/gist_id}", "starred_url": "https://api.github.com/users/pmderodat/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/pmderodat/subscriptions", "organizations_url": "https://api.github.com/users/pmderodat/orgs", "repos_url": "https://api.github.com/users/pmderodat/repos", "events_url": "https://api.github.com/users/pmderodat/events{/privacy}", "received_events_url": "https://api.github.com/users/pmderodat/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "0053d7291e9027c7455a2a402e9dbad6c99e7b8d", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/0053d7291e9027c7455a2a402e9dbad6c99e7b8d", "html_url": "https://github.com/Rust-GCC/gccrs/commit/0053d7291e9027c7455a2a402e9dbad6c99e7b8d"}], "stats": {"total": 55, "additions": 17, "deletions": 38}, "files": [{"sha": "6c8abed441136227234caec7fc6ac6441e814b98", "filename": "gcc/ada/exp_attr.adb", "status": "modified", "additions": 2, "deletions": 8, "changes": 10, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/8adc8d9b7c61f4ed9e349ebe9c091ce45e6978e4/gcc%2Fada%2Fexp_attr.adb", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/8adc8d9b7c61f4ed9e349ebe9c091ce45e6978e4/gcc%2Fada%2Fexp_attr.adb", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fada%2Fexp_attr.adb?ref=8adc8d9b7c61f4ed9e349ebe9c091ce45e6978e4", "patch": "@@ -6115,10 +6115,7 @@ package body Exp_Attr is\n                   return;\n                end if;\n \n-               if Has_Discriminants (U_Type)\n-                 and then Present\n-                   (Discriminant_Default_Value (First_Discriminant (U_Type)))\n-               then\n+               if Has_Defaulted_Discriminants (U_Type) then\n                   Build_Mutable_Record_Read_Procedure\n                     (Loc, Full_Base (U_Type), Decl, Pname);\n                else\n@@ -7750,10 +7747,7 @@ package body Exp_Attr is\n                   end if;\n                end if;\n \n-               if Has_Discriminants (U_Type)\n-                 and then Present\n-                   (Discriminant_Default_Value (First_Discriminant (U_Type)))\n-               then\n+               if Has_Defaulted_Discriminants (U_Type) then\n                   Build_Mutable_Record_Write_Procedure\n                     (Loc, Full_Base (U_Type), Decl, Pname);\n                else"}, {"sha": "825bf206639423e83a87fcb16ad1cb8681137e38", "filename": "gcc/ada/exp_ch9.adb", "status": "modified", "additions": 1, "deletions": 3, "changes": 4, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/8adc8d9b7c61f4ed9e349ebe9c091ce45e6978e4/gcc%2Fada%2Fexp_ch9.adb", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/8adc8d9b7c61f4ed9e349ebe9c091ce45e6978e4/gcc%2Fada%2Fexp_ch9.adb", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fada%2Fexp_ch9.adb?ref=8adc8d9b7c61f4ed9e349ebe9c091ce45e6978e4", "patch": "@@ -13972,9 +13972,7 @@ package body Exp_Ch9 is\n    begin\n       return Scope (Base_Index) = Standard_Standard\n         and then Base_Index = Base_Type (Standard_Integer)\n-        and then Has_Discriminants (Conctyp)\n-        and then\n-          Present (Discriminant_Default_Value (First_Discriminant (Conctyp)))\n+        and then Has_Defaulted_Discriminants (Conctyp)\n         and then\n           (Denotes_Discriminant (Lo, True)\n              or else"}, {"sha": "d4cd8d7e86a88b54d2f9205fa064bd979d8978b7", "filename": "gcc/ada/sem_ch3.adb", "status": "modified", "additions": 2, "deletions": 6, "changes": 8, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/8adc8d9b7c61f4ed9e349ebe9c091ce45e6978e4/gcc%2Fada%2Fsem_ch3.adb", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/8adc8d9b7c61f4ed9e349ebe9c091ce45e6978e4/gcc%2Fada%2Fsem_ch3.adb", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fada%2Fsem_ch3.adb?ref=8adc8d9b7c61f4ed9e349ebe9c091ce45e6978e4", "patch": "@@ -13971,9 +13971,7 @@ package body Sem_Ch3 is\n           (Has_Unknown_Discriminants (T)\n             or else\n               (not Has_Discriminants (T)\n-                and then Has_Discriminants (Full_View (T))\n-                and then Present (Discriminant_Default_Value\n-                           (First_Discriminant (Full_View (T))))))\n+                and then Has_Defaulted_Discriminants (Full_View (T))))\n       then\n          T := Full_View (T);\n          E := Full_View (E);\n@@ -20805,9 +20803,7 @@ package body Sem_Ch3 is\n \n       if not Has_Unknown_Discriminants (Priv_T)\n         and then not Has_Discriminants (Priv_T)\n-        and then Has_Discriminants (Full_T)\n-        and then\n-          Present (Discriminant_Default_Value (First_Discriminant (Full_T)))\n+        and then Has_Defaulted_Discriminants (Full_T)\n       then\n          Set_Has_Constrained_Partial_View (Full_T);\n          Set_Has_Constrained_Partial_View (Priv_T);"}, {"sha": "59ce28ea6d963e157f75210f0025c8f71edbd88b", "filename": "gcc/ada/sem_ch4.adb", "status": "modified", "additions": 11, "deletions": 17, "changes": 28, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/8adc8d9b7c61f4ed9e349ebe9c091ce45e6978e4/gcc%2Fada%2Fsem_ch4.adb", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/8adc8d9b7c61f4ed9e349ebe9c091ce45e6978e4/gcc%2Fada%2Fsem_ch4.adb", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fada%2Fsem_ch4.adb?ref=8adc8d9b7c61f4ed9e349ebe9c091ce45e6978e4", "patch": "@@ -599,32 +599,26 @@ package body Sem_Ch4 is\n                Type_Id := Entity (E);\n \n                if Is_Tagged_Type (Type_Id)\n-                 and then Has_Discriminants (Type_Id)\n+                 and then Has_Defaulted_Discriminants (Type_Id)\n                  and then not Is_Constrained (Type_Id)\n-                 and then\n-                   Present\n-                     (Discriminant_Default_Value\n-                       (First_Discriminant (Type_Id)))\n                then\n                   declare\n                      Constr : constant List_Id    := New_List;\n                      Loc    : constant Source_Ptr := Sloc (E);\n                      Discr  : Entity_Id := First_Discriminant (Type_Id);\n \n                   begin\n-                     if Present (Discriminant_Default_Value (Discr)) then\n-                        while Present (Discr) loop\n-                           Append (Discriminant_Default_Value (Discr), Constr);\n-                           Next_Discriminant (Discr);\n-                        end loop;\n+                     while Present (Discr) loop\n+                        Append (Discriminant_Default_Value (Discr), Constr);\n+                        Next_Discriminant (Discr);\n+                     end loop;\n \n-                        Rewrite (E,\n-                          Make_Subtype_Indication (Loc,\n-                            Subtype_Mark => New_Occurrence_Of (Type_Id, Loc),\n-                            Constraint   =>\n-                              Make_Index_Or_Discriminant_Constraint (Loc,\n-                                Constraints => Constr)));\n-                     end if;\n+                     Rewrite (E,\n+                       Make_Subtype_Indication (Loc,\n+                         Subtype_Mark => New_Occurrence_Of (Type_Id, Loc),\n+                         Constraint   =>\n+                           Make_Index_Or_Discriminant_Constraint (Loc,\n+                             Constraints => Constr)));\n                   end;\n                end if;\n             end if;"}, {"sha": "86dd95b7ec0114cbca2982c718846119f4e5d7aa", "filename": "gcc/ada/sem_util.adb", "status": "modified", "additions": 1, "deletions": 4, "changes": 5, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/8adc8d9b7c61f4ed9e349ebe9c091ce45e6978e4/gcc%2Fada%2Fsem_util.adb", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/8adc8d9b7c61f4ed9e349ebe9c091ce45e6978e4/gcc%2Fada%2Fsem_util.adb", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fada%2Fsem_util.adb?ref=8adc8d9b7c61f4ed9e349ebe9c091ce45e6978e4", "patch": "@@ -11818,7 +11818,6 @@ package body Sem_Util is\n    function Has_Defaulted_Discriminants (Typ : Entity_Id) return Boolean is\n    begin\n       return Has_Discriminants (Typ)\n-       and then Present (First_Discriminant (Typ))\n        and then Present (Discriminant_Default_Value\n                            (First_Discriminant (Typ)));\n    end Has_Defaulted_Discriminants;\n@@ -17141,9 +17140,7 @@ package body Sem_Util is\n       --  Record types\n \n       elsif Is_Record_Type (Typ) then\n-         if Has_Discriminants (Typ)\n-           and then\n-             Present (Discriminant_Default_Value (First_Discriminant (Typ)))\n+         if Has_Defaulted_Discriminants (Typ)\n            and then Is_Fully_Initialized_Variant (Typ)\n          then\n             return True;"}]}