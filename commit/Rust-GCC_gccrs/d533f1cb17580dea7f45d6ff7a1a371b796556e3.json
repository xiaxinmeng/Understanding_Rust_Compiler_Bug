{"sha": "d533f1cb17580dea7f45d6ff7a1a371b796556e3", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6ZDUzM2YxY2IxNzU4MGRlYTdmNDVkNmZmN2ExYTM3MWI3OTY1NTZlMw==", "commit": {"author": {"name": "Andrew Pinski", "email": "pinskia@physics.uc.edu", "date": "2004-10-28T23:38:47Z"}, "committer": {"name": "Andrew Pinski", "email": "pinskia@gcc.gnu.org", "date": "2004-10-28T23:38:47Z"}, "message": "visibility-[1-9a].c: Change to use scan-hidden instead of scan-assembler.\n\n2004-10-28  Andrew Pinski  <pinskia@physics.uc.edu>\n\n        * gcc.dg/visibility-[1-9a].c: Change to use scan-hidden instead of\n        scan-assembler.\n        * lib/scanasm.exp (hidden-scan-for): New proc.\n        (scan-hidden): Use hidden-scan-for instead of constructing the scan\n        string.\n        (scan-not-hidden): Likewise.\n        * lib/target-supports.exp (check_visibility_available): mach-o is\n        support too.\n\nFrom-SVN: r89793", "tree": {"sha": "f7bb9a830096e0eda4a125d40d0604355b033c4c", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/f7bb9a830096e0eda4a125d40d0604355b033c4c"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/d533f1cb17580dea7f45d6ff7a1a371b796556e3", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/d533f1cb17580dea7f45d6ff7a1a371b796556e3", "html_url": "https://github.com/Rust-GCC/gccrs/commit/d533f1cb17580dea7f45d6ff7a1a371b796556e3", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/d533f1cb17580dea7f45d6ff7a1a371b796556e3/comments", "author": null, "committer": null, "parents": [{"sha": "de66168d60454ab3cb39479bfe86a27254b679ea", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/de66168d60454ab3cb39479bfe86a27254b679ea", "html_url": "https://github.com/Rust-GCC/gccrs/commit/de66168d60454ab3cb39479bfe86a27254b679ea"}], "stats": {"total": 60, "additions": 47, "deletions": 13}, "files": [{"sha": "c781e8bb28ea5c3b5041705208fd93dd8e6facff", "filename": "gcc/testsuite/ChangeLog", "status": "modified", "additions": 11, "deletions": 0, "changes": 11, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/d533f1cb17580dea7f45d6ff7a1a371b796556e3/gcc%2Ftestsuite%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/d533f1cb17580dea7f45d6ff7a1a371b796556e3/gcc%2Ftestsuite%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2FChangeLog?ref=d533f1cb17580dea7f45d6ff7a1a371b796556e3", "patch": "@@ -1,3 +1,14 @@\n+2004-10-28  Andrew Pinski  <pinskia@physics.uc.edu>\n+\n+\t* gcc.dg/visibility-[1-9a].c: Change to use scan-hidden instead of\n+\tscan-assembler.\n+\t* lib/scanasm.exp (hidden-scan-for): New proc.\n+\t(scan-hidden): Use hidden-scan-for instead of constructing the scan\n+\tstring.\n+\t(scan-not-hidden): Likewise.\n+\t* lib/target-supports.exp (check_visibility_available): mach-o is\n+\tsupport too.\n+\n 2004-10-28  Mark Mitchell  <mark@codesourcery.com>\n \n \tPR c++/17132"}, {"sha": "864b971dd64c3ca9da11dcca317dc8891b1a77f6", "filename": "gcc/testsuite/gcc.dg/visibility-1.c", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/d533f1cb17580dea7f45d6ff7a1a371b796556e3/gcc%2Ftestsuite%2Fgcc.dg%2Fvisibility-1.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/d533f1cb17580dea7f45d6ff7a1a371b796556e3/gcc%2Ftestsuite%2Fgcc.dg%2Fvisibility-1.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgcc.dg%2Fvisibility-1.c?ref=d533f1cb17580dea7f45d6ff7a1a371b796556e3", "patch": "@@ -1,7 +1,7 @@\n /* Test visibility attribute on function definition. */\n /* { dg-do compile } */\n /* { dg-require-visibility \"\" } */\n-/* { dg-final { scan-assembler \"\\\\.hidden.*foo\" } } */\n+/* { dg-final { scan-hidden \"foo\" } } */\n \n void\n __attribute__((visibility (\"hidden\")))"}, {"sha": "0977abac2b8d47926bdd80f613a78eadd416ae2e", "filename": "gcc/testsuite/gcc.dg/visibility-2.c", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/d533f1cb17580dea7f45d6ff7a1a371b796556e3/gcc%2Ftestsuite%2Fgcc.dg%2Fvisibility-2.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/d533f1cb17580dea7f45d6ff7a1a371b796556e3/gcc%2Ftestsuite%2Fgcc.dg%2Fvisibility-2.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgcc.dg%2Fvisibility-2.c?ref=d533f1cb17580dea7f45d6ff7a1a371b796556e3", "patch": "@@ -1,7 +1,7 @@\n /* Test that visibility attribute on declaration extends to definition. */\n /* { dg-do compile } */\n /* { dg-require-visibility \"\" } */\n-/* { dg-final { scan-assembler \"\\\\.hidden.*foo\" } } */\n+/* { dg-final { scan-hidden \"foo\" } } */\n \n void \n __attribute__((visibility (\"hidden\")))"}, {"sha": "cb5a71524f6b5d88ca13dfc9fd7d9358246dbced", "filename": "gcc/testsuite/gcc.dg/visibility-3.c", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/d533f1cb17580dea7f45d6ff7a1a371b796556e3/gcc%2Ftestsuite%2Fgcc.dg%2Fvisibility-3.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/d533f1cb17580dea7f45d6ff7a1a371b796556e3/gcc%2Ftestsuite%2Fgcc.dg%2Fvisibility-3.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgcc.dg%2Fvisibility-3.c?ref=d533f1cb17580dea7f45d6ff7a1a371b796556e3", "patch": "@@ -1,7 +1,7 @@\n /* Test visibility attribute on forward declaration of global variable */\n /* { dg-do compile } */\n /* { dg-require-visibility \"\" } */\n-/* { dg-final { scan-assembler \"\\\\.hidden.*xyzzy\" } } */\n+/* { dg-final { scan-hidden \"xyzzy\" } } */\n \n int\n __attribute__((visibility (\"hidden\")))"}, {"sha": "af0d461c3d9eb0c5f694e6d8d54675c2defb9bc2", "filename": "gcc/testsuite/gcc.dg/visibility-4.c", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/d533f1cb17580dea7f45d6ff7a1a371b796556e3/gcc%2Ftestsuite%2Fgcc.dg%2Fvisibility-4.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/d533f1cb17580dea7f45d6ff7a1a371b796556e3/gcc%2Ftestsuite%2Fgcc.dg%2Fvisibility-4.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgcc.dg%2Fvisibility-4.c?ref=d533f1cb17580dea7f45d6ff7a1a371b796556e3", "patch": "@@ -1,7 +1,7 @@\n /* Test visibility attribute on forward declaration of global variable */\n /* { dg-do compile } */\n /* { dg-require-visibility \"\" } */\n-/* { dg-final { scan-assembler \"\\\\.hidden.*xyzzy\" } } */\n+/* { dg-final { scan-hidden \"xyzzy\" } } */\n \n extern int \n __attribute__((visibility (\"hidden\")))"}, {"sha": "0302768c91b4f2d9642bd5d5a30dedf2e0bccb55", "filename": "gcc/testsuite/gcc.dg/visibility-5.c", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/d533f1cb17580dea7f45d6ff7a1a371b796556e3/gcc%2Ftestsuite%2Fgcc.dg%2Fvisibility-5.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/d533f1cb17580dea7f45d6ff7a1a371b796556e3/gcc%2Ftestsuite%2Fgcc.dg%2Fvisibility-5.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgcc.dg%2Fvisibility-5.c?ref=d533f1cb17580dea7f45d6ff7a1a371b796556e3", "patch": "@@ -2,7 +2,7 @@\n    already had a forward declaration. */\n /* { dg-do compile } */\n /* { dg-require-visibility \"\" } */\n-/* { dg-final { scan-assembler \"\\\\.hidden.*foo\" } } */\n+/* { dg-final { scan-hidden \"foo\" } } */\n \n void foo();\n "}, {"sha": "4e9deebec373d5ae161871c920d24c89285f101f", "filename": "gcc/testsuite/gcc.dg/visibility-6.c", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/d533f1cb17580dea7f45d6ff7a1a371b796556e3/gcc%2Ftestsuite%2Fgcc.dg%2Fvisibility-6.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/d533f1cb17580dea7f45d6ff7a1a371b796556e3/gcc%2Ftestsuite%2Fgcc.dg%2Fvisibility-6.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgcc.dg%2Fvisibility-6.c?ref=d533f1cb17580dea7f45d6ff7a1a371b796556e3", "patch": "@@ -2,7 +2,7 @@\n    already had a forward declaration. */\n /* { dg-do compile } */\n /* { dg-require-visibility \"\" } */\n-/* { dg-final { scan-assembler \"\\\\.hidden.*xyzzy\" } } */\n+/* { dg-final { scan-hidden \"xyzzy\" } } */\n \n extern int xyzzy;\n "}, {"sha": "f5e6e9aae5cec5849e9297fb991f9108cd0a5ec2", "filename": "gcc/testsuite/gcc.dg/visibility-7.c", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/d533f1cb17580dea7f45d6ff7a1a371b796556e3/gcc%2Ftestsuite%2Fgcc.dg%2Fvisibility-7.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/d533f1cb17580dea7f45d6ff7a1a371b796556e3/gcc%2Ftestsuite%2Fgcc.dg%2Fvisibility-7.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgcc.dg%2Fvisibility-7.c?ref=d533f1cb17580dea7f45d6ff7a1a371b796556e3", "patch": "@@ -1,7 +1,7 @@\n /* Test warning from conflicting visibility specifications. */\n /* { dg-do compile } */\n /* { dg-require-visibility \"\" } */\n-/* { dg-final { scan-assembler \"\\\\.hidden.*xyzzy\" } } */\n+/* { dg-final { scan-hidden \"xyzzy\" } } */\n \n extern int \n __attribute__((visibility (\"hidden\")))"}, {"sha": "89f89c0822bd2d83cb7b75cb67b11128081b4901", "filename": "gcc/testsuite/gcc.dg/visibility-8.c", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/d533f1cb17580dea7f45d6ff7a1a371b796556e3/gcc%2Ftestsuite%2Fgcc.dg%2Fvisibility-8.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/d533f1cb17580dea7f45d6ff7a1a371b796556e3/gcc%2Ftestsuite%2Fgcc.dg%2Fvisibility-8.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgcc.dg%2Fvisibility-8.c?ref=d533f1cb17580dea7f45d6ff7a1a371b796556e3", "patch": "@@ -2,7 +2,7 @@\n /* { dg-do compile } */\n /* { dg-options \"-std=gnu99\" } */\n /* { dg-require-visibility \"\" } */\n-/* { dg-final { scan-assembler \"\\\\.hidden.*__GI_fputs_unlocked\" } } */\n+/* { dg-final { scan-hidden \"__GI_fputs_unlocked\" } } */\n \n int fputs_unlocked (const char *restrict, int *restrict)\n    __asm__ (\"__GI_fputs_unlocked\")"}, {"sha": "9d575168491ba4ad61cbbf42ce6a72076036f5ab", "filename": "gcc/testsuite/gcc.dg/visibility-9.c", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/d533f1cb17580dea7f45d6ff7a1a371b796556e3/gcc%2Ftestsuite%2Fgcc.dg%2Fvisibility-9.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/d533f1cb17580dea7f45d6ff7a1a371b796556e3/gcc%2Ftestsuite%2Fgcc.dg%2Fvisibility-9.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgcc.dg%2Fvisibility-9.c?ref=d533f1cb17580dea7f45d6ff7a1a371b796556e3", "patch": "@@ -2,7 +2,7 @@\n /* { dg-do compile } */\n /* { dg-require-visibility \"\" } */\n /* { dg-options \"-fvisibility=hidden\" } */\n-/* { dg-final { scan-assembler \"\\\\.hidden.*foo\" } } */\n+/* { dg-final { scan-hidden \"foo\" } } */\n \n void foo();\n "}, {"sha": "23a51d7e5a4ebea0e1c08111f6ad6b0a765eb2f4", "filename": "gcc/testsuite/gcc.dg/visibility-a.c", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/d533f1cb17580dea7f45d6ff7a1a371b796556e3/gcc%2Ftestsuite%2Fgcc.dg%2Fvisibility-a.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/d533f1cb17580dea7f45d6ff7a1a371b796556e3/gcc%2Ftestsuite%2Fgcc.dg%2Fvisibility-a.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgcc.dg%2Fvisibility-a.c?ref=d533f1cb17580dea7f45d6ff7a1a371b796556e3", "patch": "@@ -1,7 +1,7 @@\n /* Test that #pragma GCC visibility works. */\n /* { dg-do compile } */\n /* { dg-require-visibility \"\" } */\n-/* { dg-final { scan-assembler \"\\\\.hidden.*foo\" } } */\n+/* { dg-final { scan-hidden \"foo\" } } */\n \n #pragma GCC visibility push(hidden)\n void foo();"}, {"sha": "8b0c41dd59d782621f28799155dbc36a982d0f0f", "filename": "gcc/testsuite/gcc.dg/visibility-b.c", "status": "modified", "additions": 3, "deletions": 1, "changes": 4, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/d533f1cb17580dea7f45d6ff7a1a371b796556e3/gcc%2Ftestsuite%2Fgcc.dg%2Fvisibility-b.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/d533f1cb17580dea7f45d6ff7a1a371b796556e3/gcc%2Ftestsuite%2Fgcc.dg%2Fvisibility-b.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgcc.dg%2Fvisibility-b.c?ref=d533f1cb17580dea7f45d6ff7a1a371b796556e3", "patch": "@@ -1,4 +1,6 @@\n-/* { dg-do assemble { target *-*-darwin* } } */\n+/* { dg-do compile } */\n+/* { dg-require-visibility \"\" } */\n+/* { dg-final { scan-hidden \"n\" } } */\n \n #define __private_extern__ extern __attribute__((visibility (\"hidden\")))\n "}, {"sha": "33c574ac34c94156f23e0abaffc144696280604f", "filename": "gcc/testsuite/lib/scanasm.exp", "status": "modified", "additions": 22, "deletions": 2, "changes": 24, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/d533f1cb17580dea7f45d6ff7a1a371b796556e3/gcc%2Ftestsuite%2Flib%2Fscanasm.exp", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/d533f1cb17580dea7f45d6ff7a1a371b796556e3/gcc%2Ftestsuite%2Flib%2Fscanasm.exp", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Flib%2Fscanasm.exp?ref=d533f1cb17580dea7f45d6ff7a1a371b796556e3", "patch": "@@ -79,6 +79,21 @@ proc scan-assembler-not { args } {\n     dg-scan \"scan-assembler-not\" 0 $testcase $output_file $args\n }\n \n+# Return the scan for the assembly for hidden visibility. \n+\n+proc hidden-scan-for { symbol } {\n+\n+    set objformat [gcc_target_object_format]\n+\n+    switch $objformat {\n+        elf      { return \"hidden\\[ \\t_\\]*$symbol\" }\n+        mach-o   { return \"private_extern\\[ \\t_\\]*_?$symbol\" }\n+        default  { return \"\" }\n+    }\n+\n+}\n+\n+\n # Check that a symbol is defined as a hidden symbol in the .s file\n # produced by the compiler.\n \n@@ -87,7 +102,10 @@ proc scan-hidden { args } {\n     set output_file \"[file rootname [file tail $testcase]].s\"\n \n     set symbol [lindex $args 0]\n-    set args [lreplace $args 0 0 \"hidden\\[ \\t_\\]*$symbol\"]\n+\n+    set hidden_scan [hidden-scan-for $symbol]\n+\n+    set args [lreplace $args 0 0 \"$hidden_scan\"]\n \n     dg-scan \"scan-hidden\" 1 $testcase $output_file $args\n }\n@@ -100,7 +118,9 @@ proc scan-not-hidden { args } {\n     set output_file \"[file rootname [file tail $testcase]].s\"\n \n     set symbol [lindex $args 0]\n-    set args [lreplace $args 0 0 \"hidden\\[ \\t_\\]*$symbol\"]\n+    set hidden_scan [hidden-scan-for symbol]\n+\n+    set args [lreplace $args 0 0 \"$hidden_scan\"]\n \n     dg-scan \"scan-not-hidden\" 0 $testcase $output_file $args\n }"}, {"sha": "b968de275a168c2a002054daaeb40315ead32878", "filename": "gcc/testsuite/lib/target-supports.exp", "status": "modified", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/d533f1cb17580dea7f45d6ff7a1a371b796556e3/gcc%2Ftestsuite%2Flib%2Ftarget-supports.exp", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/d533f1cb17580dea7f45d6ff7a1a371b796556e3/gcc%2Ftestsuite%2Flib%2Ftarget-supports.exp", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Flib%2Ftarget-supports.exp?ref=d533f1cb17580dea7f45d6ff7a1a371b796556e3", "patch": "@@ -88,6 +88,7 @@ proc check_visibility_available { } {\n \n     switch $objformat {\n         elf      { return 1 }\n+        mach-o   { return 1 }\n         unknown  { return -1 }\n         default  { return 0 }\n     }"}]}