{"sha": "8189a222b1f12b0ba99c0579915977f9312a2fde", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6ODE4OWEyMjJiMWYxMmIwYmE5OWMwNTc5OTE1OTc3ZjkzMTJhMmZkZQ==", "commit": {"author": {"name": "Richard Kenner", "email": "kenner@gcc.gnu.org", "date": "1997-01-19T19:35:37Z"}, "committer": {"name": "Richard Kenner", "email": "kenner@gcc.gnu.org", "date": "1997-01-19T19:35:37Z"}, "message": "Fix problems with symlinks to \".\".\n\nFrom-SVN: r13516", "tree": {"sha": "cd11b967d4367192e14387caba942e2b51280423", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/cd11b967d4367192e14387caba942e2b51280423"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/8189a222b1f12b0ba99c0579915977f9312a2fde", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/8189a222b1f12b0ba99c0579915977f9312a2fde", "html_url": "https://github.com/Rust-GCC/gccrs/commit/8189a222b1f12b0ba99c0579915977f9312a2fde", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/8189a222b1f12b0ba99c0579915977f9312a2fde/comments", "author": null, "committer": null, "parents": [{"sha": "af3e86c2455792d3f4ac1134b0d0c3efdcca72e5", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/af3e86c2455792d3f4ac1134b0d0c3efdcca72e5", "html_url": "https://github.com/Rust-GCC/gccrs/commit/af3e86c2455792d3f4ac1134b0d0c3efdcca72e5"}], "stats": {"total": 22, "additions": 18, "deletions": 4}, "files": [{"sha": "c0418b69d59ae115d20b6600d2a0e2814e623526", "filename": "gcc/fixinc.svr4", "status": "modified", "additions": 18, "deletions": 4, "changes": 22, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/8189a222b1f12b0ba99c0579915977f9312a2fde/gcc%2Ffixinc.svr4", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/8189a222b1f12b0ba99c0579915977f9312a2fde/gcc%2Ffixinc.svr4", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ffixinc.svr4?ref=8189a222b1f12b0ba99c0579915977f9312a2fde", "patch": "@@ -1,7 +1,7 @@\n #! /bin/sh\n # Install modified versions of certain ANSI-incompatible\n # native System V Release 4 system include files.\n-# Copyright (C) 1994, 1996 Free Software Foundation, Inc.\n+# Copyright (C) 1994, 1996, 1997 Free Software Foundation, Inc.\n # Contributed by Ron Guilmette (rfg@monkeys.com).\n #\n # This file is part of GNU CC.\n@@ -73,7 +73,7 @@ fi\n echo 'Making directories:'\n cd ${INPUT}\n if $LINKS; then\n-  files=`ls -LR | sed -n s/:$//p`\n+  files=`find . -follow -type d -print 2>/dev/null | sed '/^.$/d'`\n else\n   files=`find . -type d -print | sed '/^.$/d'`\n fi\n@@ -98,6 +98,7 @@ if $LINKS; then\n       # In case $dest is relative, get to $file's dir first.\n       cd ${INPUT}\n       cd `echo ./$file | sed -n 's&[^/]*$&&p'`\n+      rwd=`pwd`\n       # Check that the target directory exists.\n       # Redirections changed to avoid bug in sh on Ultrix.\n       (cd $dest) > /dev/null 2>&1\n@@ -107,7 +108,11 @@ if $LINKS; then\n \tx=`pwd`\n \t# If link leads back into ${INPUT},\n \t# make a similar link here.\n-\tif expr $x : \"${INPUT}/.*\" > /dev/null; then\n+        if expr \"$dest\" : '[^/][^/]*' >/dev/null && [ ! -h $dest ]; then\n+          echo $file '->'  $dest': Making link'\n+          rm -fr ${LIB}/$file > /dev/null 2>&1\n+          ln -s $dest ${LIB}/$file > /dev/null 2>&1\n+\telif expr $x : \"${INPUT}/.*\" > /dev/null; then\n \t  # Y gets the actual target dir name, relative to ${INPUT}.\n \t  y=`echo $x | sed -n \"s&${INPUT}/&&p\"`\n \t  # DOTS is the relative path from ${LIB}/$file's dir back to ${LIB}.\n@@ -116,6 +121,15 @@ if $LINKS; then\n \t  echo $file '->' $dots$y ': Making link'\n \t  rm -fr ${LIB}/$file > /dev/null 2>&1\n \t  ln -s $dots$y ${LIB}/$file > /dev/null 2>&1\n+\telif expr $x : \"${rwd}/.*\" > /dev/null; then\n+\t  # Y gets the actual target dir name, relative to the directory where the link is.\n+\t  y=`echo $x | sed -n \"s&${rwd}/&&p\"`\n+\t  # DOTS is the relative path from ${LIB}/$file's dir back to ${LIB}.\n+\t  dots=`echo \"$file\" |\n+\t    sed -e 's@^./@@' -e 's@/./@/@g' -e 's@[^/][^/]*@..@g' -e 's@..$@@'`\n+\t  echo $file '->' $dots$y ': Making link'\n+\t  rm -fr ${LIB}/$file > /dev/null 2>&1\n+\t  ln -s $dots$y ${LIB}/$file > /dev/null 2>&1\n \telse\n \t  # If the link is to outside ${INPUT},\n \t  # treat this directory as if it actually contained the files.\n@@ -1526,7 +1540,7 @@ if $LINKS; then\n   for file in $files; do\n     dest=`ls -ld $file | sed -n 's/.*-> //p'`\n     if expr \"$dest\" : '[^/].*' > /dev/null; then    \n-      target=${LIB}/`echo file | sed \"s|[^/]*\\$|$dest|\"`\n+      target=${LIB}/`echo $file | sed \"s|[^/]*\\$|$dest|\"`\n       if [ -f $target ]; then\n         ln -s $dest ${LIB}/$file >/dev/null 2>&1\n       fi"}]}