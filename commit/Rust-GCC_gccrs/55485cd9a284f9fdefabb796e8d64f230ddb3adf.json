{"sha": "55485cd9a284f9fdefabb796e8d64f230ddb3adf", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6NTU0ODVjZDlhMjg0ZjlmZGVmYWJiNzk2ZThkNjRmMjMwZGRiM2FkZg==", "commit": {"author": {"name": "Zack Weinberg", "email": "zack@codesourcery.com", "date": "2001-12-06T16:41:18Z"}, "committer": {"name": "Zack Weinberg", "email": "zack@gcc.gnu.org", "date": "2001-12-06T16:41:18Z"}, "message": "cppfiles.c (open_file): If we've opened a directory by mistake, close it.\n\n\t* cppfiles.c (open_file): If we've opened a directory by\n\tmistake, close it.\n\t(find_include_file): Avoid turning / into // or // into ///.\n\nFrom-SVN: r47722", "tree": {"sha": "0d732847c41a7f64f41db7e360c701d3912d271a", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/0d732847c41a7f64f41db7e360c701d3912d271a"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/55485cd9a284f9fdefabb796e8d64f230ddb3adf", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/55485cd9a284f9fdefabb796e8d64f230ddb3adf", "html_url": "https://github.com/Rust-GCC/gccrs/commit/55485cd9a284f9fdefabb796e8d64f230ddb3adf", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/55485cd9a284f9fdefabb796e8d64f230ddb3adf/comments", "author": null, "committer": null, "parents": [{"sha": "e04546dce3e5e02671edf8c9cca039e60150532d", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/e04546dce3e5e02671edf8c9cca039e60150532d", "html_url": "https://github.com/Rust-GCC/gccrs/commit/e04546dce3e5e02671edf8c9cca039e60150532d"}], "stats": {"total": 20, "additions": 17, "deletions": 3}, "files": [{"sha": "5b22f74531662082ceced8541645736591c721e0", "filename": "gcc/ChangeLog", "status": "modified", "additions": 6, "deletions": 0, "changes": 6, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/55485cd9a284f9fdefabb796e8d64f230ddb3adf/gcc%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/55485cd9a284f9fdefabb796e8d64f230ddb3adf/gcc%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2FChangeLog?ref=55485cd9a284f9fdefabb796e8d64f230ddb3adf", "patch": "@@ -1,3 +1,9 @@\n+2001-12-06  Zack Weinberg  <zack@codesourcery.com>\n+\n+\t* cppfiles.c (open_file): If we've opened a directory by\n+\tmistake, close it.\n+\t(find_include_file): Avoid turning / into // or // into ///.\n+\n 2001-12-06  Nick Clifton  <nickc@cambridge.redhat.com>\n \n \t* config/arm/arm.h (STRUCT_VALUE): Suppress definition."}, {"sha": "33801d610a64463b7ad835440c03dac85b9c29af", "filename": "gcc/cppfiles.c", "status": "modified", "additions": 11, "deletions": 3, "changes": 14, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/55485cd9a284f9fdefabb796e8d64f230ddb3adf/gcc%2Fcppfiles.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/55485cd9a284f9fdefabb796e8d64f230ddb3adf/gcc%2Fcppfiles.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fcppfiles.c?ref=55485cd9a284f9fdefabb796e8d64f230ddb3adf", "patch": "@@ -259,10 +259,13 @@ open_file (pfile, filename)\n     {\n       if (!S_ISDIR (file->st.st_mode))\n \treturn file;\n+\n       /* If it's a directory, we return null and continue the search\n \t as the file we're looking for may appear elsewhere in the\n \t search path.  */\n       errno = ENOENT;\n+      close (file->fd);\n+      file->fd = -1;\n     }\n \n   file->err_no = errno;\n@@ -556,9 +559,14 @@ find_include_file (pfile, header, type)\n   name = (char *) alloca (strlen (fname) + pfile->max_include_len + 2);\n   for (; path; path = path->next)\n     {\n-      memcpy (name, path->name, path->len);\n-      name[path->len] = '/';\n-      strcpy (&name[path->len + 1], fname);\n+      int len = path->len;\n+      memcpy (name, path->name, len);\n+      /* Don't turn / into // or // into ///; // may be a namespace\n+\t escape.  */\n+      if (name[len-1] == '/')\n+\tlen--;\n+      name[len] = '/';\n+      strcpy (&name[len + 1], fname);\n       if (CPP_OPTION (pfile, remap))\n \tn = remap_filename (pfile, name, path);\n       else"}]}