{"sha": "179652df338a0dfe4e121cb6b88164a723d91528", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6MTc5NjUyZGYzMzhhMGRmZTRlMTIxY2I2Yjg4MTY0YTcyM2Q5MTUyOA==", "commit": {"author": {"name": "Jakub Jelinek", "email": "jakub@redhat.com", "date": "2014-02-19T06:05:55Z"}, "committer": {"name": "Jakub Jelinek", "email": "jakub@gcc.gnu.org", "date": "2014-02-19T06:05:55Z"}, "message": "re PR preprocessor/58844 (ICE with invalid use of ##)\n\n\tPR preprocessor/58844\n\t* macro.c (enter_macro_context): Only push\n\tmacro_real_token_count (macro) tokens rather than\n\tmacro->count tokens, regardless of\n\tCPP_OPTION (pfile, track-macro-expansion).\n\n\t* c-c++-common/cpp/pr58844-1.c: New test.\n\t* c-c++-common/cpp/pr58844-2.c: New test.\n\nFrom-SVN: r207871", "tree": {"sha": "f3fc813b3068ddef834ae78c747c34b6b87b8722", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/f3fc813b3068ddef834ae78c747c34b6b87b8722"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/179652df338a0dfe4e121cb6b88164a723d91528", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/179652df338a0dfe4e121cb6b88164a723d91528", "html_url": "https://github.com/Rust-GCC/gccrs/commit/179652df338a0dfe4e121cb6b88164a723d91528", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/179652df338a0dfe4e121cb6b88164a723d91528/comments", "author": {"login": "jakubjelinek", "id": 9370665, "node_id": "MDQ6VXNlcjkzNzA2NjU=", "avatar_url": "https://avatars.githubusercontent.com/u/9370665?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jakubjelinek", "html_url": "https://github.com/jakubjelinek", "followers_url": "https://api.github.com/users/jakubjelinek/followers", "following_url": "https://api.github.com/users/jakubjelinek/following{/other_user}", "gists_url": "https://api.github.com/users/jakubjelinek/gists{/gist_id}", "starred_url": "https://api.github.com/users/jakubjelinek/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jakubjelinek/subscriptions", "organizations_url": "https://api.github.com/users/jakubjelinek/orgs", "repos_url": "https://api.github.com/users/jakubjelinek/repos", "events_url": "https://api.github.com/users/jakubjelinek/events{/privacy}", "received_events_url": "https://api.github.com/users/jakubjelinek/received_events", "type": "User", "site_admin": false}, "committer": null, "parents": [{"sha": "0cfe1b4698da3b3ef6b75142f0daef9687e4d63a", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/0cfe1b4698da3b3ef6b75142f0daef9687e4d63a", "html_url": "https://github.com/Rust-GCC/gccrs/commit/0cfe1b4698da3b3ef6b75142f0daef9687e4d63a"}], "stats": {"total": 55, "additions": 41, "deletions": 14}, "files": [{"sha": "f64bb4f0170416053c8f57fa4591e93c5823ec6e", "filename": "gcc/testsuite/ChangeLog", "status": "modified", "additions": 6, "deletions": 0, "changes": 6, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/179652df338a0dfe4e121cb6b88164a723d91528/gcc%2Ftestsuite%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/179652df338a0dfe4e121cb6b88164a723d91528/gcc%2Ftestsuite%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2FChangeLog?ref=179652df338a0dfe4e121cb6b88164a723d91528", "patch": "@@ -1,3 +1,9 @@\n+2014-02-19  Jakub Jelinek  <jakub@redhat.com>\n+\n+\tPR preprocessor/58844\n+\t* c-c++-common/cpp/pr58844-1.c: New test.\n+\t* c-c++-common/cpp/pr58844-2.c: New test.\n+\n 2014-02-18  Paolo Carlini  <paolo.carlini@oracle.com>\n \n \tPR c++/60225"}, {"sha": "3abf8a768035ae4ee28333f155423918022826d6", "filename": "gcc/testsuite/c-c++-common/cpp/pr58844-1.c", "status": "added", "additions": 8, "deletions": 0, "changes": 8, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/179652df338a0dfe4e121cb6b88164a723d91528/gcc%2Ftestsuite%2Fc-c%2B%2B-common%2Fcpp%2Fpr58844-1.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/179652df338a0dfe4e121cb6b88164a723d91528/gcc%2Ftestsuite%2Fc-c%2B%2B-common%2Fcpp%2Fpr58844-1.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fc-c%2B%2B-common%2Fcpp%2Fpr58844-1.c?ref=179652df338a0dfe4e121cb6b88164a723d91528", "patch": "@@ -0,0 +1,8 @@\n+/* PR preprocessor/58844 */\n+/* { dg-do compile } */\n+/* { dg-options \"-ftrack-macro-expansion=0\" } */\n+\n+#define A x######x\n+int A = 1;\n+#define A x######x\t/* { dg-message \"previous definition\" } */\n+#define A x##x\t\t/* { dg-warning \"redefined\" } */"}, {"sha": "1e219152fc5d761b59508cee75a622b16d3f370d", "filename": "gcc/testsuite/c-c++-common/cpp/pr58844-2.c", "status": "added", "additions": 8, "deletions": 0, "changes": 8, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/179652df338a0dfe4e121cb6b88164a723d91528/gcc%2Ftestsuite%2Fc-c%2B%2B-common%2Fcpp%2Fpr58844-2.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/179652df338a0dfe4e121cb6b88164a723d91528/gcc%2Ftestsuite%2Fc-c%2B%2B-common%2Fcpp%2Fpr58844-2.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fc-c%2B%2B-common%2Fcpp%2Fpr58844-2.c?ref=179652df338a0dfe4e121cb6b88164a723d91528", "patch": "@@ -0,0 +1,8 @@\n+/* PR preprocessor/58844 */\n+/* { dg-do compile } */\n+/* { dg-options \"-ftrack-macro-expansion=2\" } */\n+\n+#define A x######x\n+int A = 1;\n+#define A x######x\t/* { dg-message \"previous definition\" } */\n+#define A x##x\t\t/* { dg-warning \"redefined\" } */"}, {"sha": "44736e0b9f10a174f638e3b4ddb5ef875d60e604", "filename": "libcpp/ChangeLog", "status": "modified", "additions": 8, "deletions": 0, "changes": 8, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/179652df338a0dfe4e121cb6b88164a723d91528/libcpp%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/179652df338a0dfe4e121cb6b88164a723d91528/libcpp%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libcpp%2FChangeLog?ref=179652df338a0dfe4e121cb6b88164a723d91528", "patch": "@@ -1,3 +1,11 @@\n+2014-02-19  Jakub Jelinek  <jakub@redhat.com>\n+\n+\tPR preprocessor/58844\n+\t* macro.c (enter_macro_context): Only push\n+\tmacro_real_token_count (macro) tokens rather than\n+\tmacro->count tokens, regardless of\n+\tCPP_OPTION (pfile, track-macro-expansion).\n+\n 2014-02-07  Jakub Jelinek  <jakub@redhat.com>\n \n \tPR preprocessor/56824"}, {"sha": "11e50f4849c1054ebfc071d610d6fd3e6e41930b", "filename": "libcpp/macro.c", "status": "modified", "additions": 11, "deletions": 14, "changes": 25, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/179652df338a0dfe4e121cb6b88164a723d91528/libcpp%2Fmacro.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/179652df338a0dfe4e121cb6b88164a723d91528/libcpp%2Fmacro.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libcpp%2Fmacro.c?ref=179652df338a0dfe4e121cb6b88164a723d91528", "patch": "@@ -1115,21 +1115,22 @@ enter_macro_context (cpp_reader *pfile, cpp_hashnode *node,\n \n       if (macro->paramc == 0)\n \t{\n+\t  unsigned tokens_count = macro_real_token_count (macro);\n \t  if (CPP_OPTION (pfile, track_macro_expansion))\n \t    {\n-\t      unsigned int i, count = macro->count;\n+\t      unsigned int i;\n \t      const cpp_token *src = macro->exp.tokens;\n \t      const struct line_map *map;\n \t      source_location *virt_locs = NULL;\n-\t      _cpp_buff *macro_tokens =\n-\t\ttokens_buff_new (pfile, count, &virt_locs);\n+\t      _cpp_buff *macro_tokens\n+\t\t= tokens_buff_new (pfile, tokens_count, &virt_locs);\n \n \t      /* Create a macro map to record the locations of the\n \t\t tokens that are involved in the expansion. LOCATION\n \t\t is the location of the macro expansion point.  */\n-\t      map  = linemap_enter_macro (pfile->line_table,\n-\t\t\t\t\t  node, location, count);\n-\t      for (i = 0; i < count; ++i)\n+\t      map = linemap_enter_macro (pfile->line_table,\n+\t\t\t\t\t node, location, tokens_count);\n+\t      for (i = 0; i < tokens_count; ++i)\n \t\t{\n \t\t  tokens_buff_add_token (macro_tokens, virt_locs,\n \t\t\t\t\t src, src->src_loc,\n@@ -1141,16 +1142,12 @@ enter_macro_context (cpp_reader *pfile, cpp_hashnode *node,\n \t\t\t\t\t    virt_locs,\n \t\t\t\t\t    (const cpp_token **)\n \t\t\t\t\t    macro_tokens->base,\n-\t\t\t\t\t    count);\n-\t      num_macro_tokens_counter += count;\n+\t\t\t\t\t    tokens_count);\n \t    }\n \t  else\n-\t    {\n-\t      unsigned tokens_count = macro_real_token_count (macro);\n-\t      _cpp_push_token_context (pfile, node, macro->exp.tokens,\n-\t\t\t\t       tokens_count);\n-\t      num_macro_tokens_counter += tokens_count;\n-\t    }\n+\t    _cpp_push_token_context (pfile, node, macro->exp.tokens,\n+\t\t\t\t     tokens_count);\n+\t  num_macro_tokens_counter += tokens_count;\n \t}\n \n       if (pragma_buff)"}]}