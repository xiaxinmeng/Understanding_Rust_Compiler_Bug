{"sha": "a01db3bf1a1430d7c4665364250ac63fab318a6a", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6YTAxZGIzYmYxYTE0MzBkN2M0NjY1MzY0MjUwYWM2M2ZhYjMxOGE2YQ==", "commit": {"author": {"name": "Erik Edelmann", "email": "eedelman@gcc.gnu.org", "date": "2005-11-09T11:27:56Z"}, "committer": {"name": "Erik Edelmann", "email": "eedelman@gcc.gnu.org", "date": "2005-11-09T11:27:56Z"}, "message": "re PR fortran/22607 (Elemental character functions don't work)\n\nfortran/\n2005-11-09  Erik Edelmann  <eedelman@gcc.gnu.org>\n\n        PR fortran/22607\n        * trans-decl.c(build_function_decl): Don't set\n        DECL_IS_PURE (fndecl) = 1 for return-by-reference\n        functions.\n\ntestsuite/\n2005-11-09  Erik Edelmann  <eedelman@gcc.gnu.org>\n\n        PR fortran/22607\n        * gfortran-dg/pure_byref_1.f90: New.\n        * gfortran-dg/pure_byref_2.f90: New.\n\nFrom-SVN: r106683", "tree": {"sha": "196138e4184c19886262aa678dad88c2bf9930a0", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/196138e4184c19886262aa678dad88c2bf9930a0"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/a01db3bf1a1430d7c4665364250ac63fab318a6a", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/a01db3bf1a1430d7c4665364250ac63fab318a6a", "html_url": "https://github.com/Rust-GCC/gccrs/commit/a01db3bf1a1430d7c4665364250ac63fab318a6a", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/a01db3bf1a1430d7c4665364250ac63fab318a6a/comments", "author": null, "committer": null, "parents": [{"sha": "1508cc4663c41afdcaf9df3499b24f6537afe818", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/1508cc4663c41afdcaf9df3499b24f6537afe818", "html_url": "https://github.com/Rust-GCC/gccrs/commit/1508cc4663c41afdcaf9df3499b24f6537afe818"}], "stats": {"total": 47, "additions": 46, "deletions": 1}, "files": [{"sha": "c60bdfd3187026950cede2dd44d1433babfcf32c", "filename": "gcc/fortran/ChangeLog", "status": "modified", "additions": 7, "deletions": 0, "changes": 7, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/a01db3bf1a1430d7c4665364250ac63fab318a6a/gcc%2Ffortran%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/a01db3bf1a1430d7c4665364250ac63fab318a6a/gcc%2Ffortran%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ffortran%2FChangeLog?ref=a01db3bf1a1430d7c4665364250ac63fab318a6a", "patch": "@@ -1,3 +1,10 @@\n+2005-11-09  Erik Edelmann  <eedelman@gcc.gnu.org>\n+\n+\tPR fortran/22607\n+\t* trans-decl.c(build_function_decl): Don't set\n+\tDECL_IS_PURE (fndecl) = 1 for return-by-reference\n+\tfunctions.\n+\n 2005-11-08  Tobias Schl\"uter  <tobias.schlueter@physik.uni-muenchen.de>\n \n \t* dump-parse-tree.c: Fix comment typo, add a few blank lines."}, {"sha": "04f037b53f67c5d4aed9be71392725b3f2bbba62", "filename": "gcc/fortran/trans-decl.c", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/a01db3bf1a1430d7c4665364250ac63fab318a6a/gcc%2Ffortran%2Ftrans-decl.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/a01db3bf1a1430d7c4665364250ac63fab318a6a/gcc%2Ffortran%2Ftrans-decl.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ffortran%2Ftrans-decl.c?ref=a01db3bf1a1430d7c4665364250ac63fab318a6a", "patch": "@@ -1203,7 +1203,7 @@ build_function_decl (gfc_symbol * sym)\n       /* TODO: check if a pure SUBROUTINE has no INTENT(OUT) arguments\n \t including a alternate return. In that case it can also be\n \t marked as PURE. See also in gfc_get_extern_function_decl().  */\n-      if (attr.function)\n+      if (attr.function && !gfc_return_by_reference (sym))\n \tDECL_IS_PURE (fndecl) = 1;\n       TREE_SIDE_EFFECTS (fndecl) = 0;\n     }"}, {"sha": "6725ae3623875268b7218e3b40c870603b3d6756", "filename": "gcc/testsuite/ChangeLog", "status": "modified", "additions": 6, "deletions": 0, "changes": 6, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/a01db3bf1a1430d7c4665364250ac63fab318a6a/gcc%2Ftestsuite%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/a01db3bf1a1430d7c4665364250ac63fab318a6a/gcc%2Ftestsuite%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2FChangeLog?ref=a01db3bf1a1430d7c4665364250ac63fab318a6a", "patch": "@@ -1,3 +1,9 @@\n+2005-11-09  Erik Edelmann  <eedelman@gcc.gnu.org>\n+\n+\tPR fortran/22607\n+\t* gfortran-dg/pure_byref_1.f90: New.\n+\t* gfortran-dg/pure_byref_2.f90: New.\n+\n 2005-11-09  Uros Bizjak  <uros@kss-loka.si>\n \n \tPR c/24101"}, {"sha": "5e080e5af101c5cf25cecdd527fd2b1172c02f95", "filename": "gcc/testsuite/gfortran.dg/pure_byref_1.f90", "status": "added", "additions": 15, "deletions": 0, "changes": 15, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/a01db3bf1a1430d7c4665364250ac63fab318a6a/gcc%2Ftestsuite%2Fgfortran.dg%2Fpure_byref_1.f90", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/a01db3bf1a1430d7c4665364250ac63fab318a6a/gcc%2Ftestsuite%2Fgfortran.dg%2Fpure_byref_1.f90", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgfortran.dg%2Fpure_byref_1.f90?ref=a01db3bf1a1430d7c4665364250ac63fab318a6a", "patch": "@@ -0,0 +1,15 @@\n+! { dg-do run }\n+! PR 22607: PURE/ELEMENTAL return-by-reference functions\n+program main\n+  implicit none\n+  character(2), dimension(2) :: a, b\n+  a = 'ok'\n+  b = fun(a)\n+  if (.not.all(b == 'ok')) call abort()\n+contains\n+  elemental function fun(a) \n+    character(*), intent(in) :: a\n+    character(len(a)) :: fun\n+    fun = a\n+  end function fun\n+end program main"}, {"sha": "805653e2ed3d6099c929a1dfce41693ba92ed304", "filename": "gcc/testsuite/gfortran.dg/pure_byref_2.f90", "status": "added", "additions": 17, "deletions": 0, "changes": 17, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/a01db3bf1a1430d7c4665364250ac63fab318a6a/gcc%2Ftestsuite%2Fgfortran.dg%2Fpure_byref_2.f90", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/a01db3bf1a1430d7c4665364250ac63fab318a6a/gcc%2Ftestsuite%2Fgfortran.dg%2Fpure_byref_2.f90", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgfortran.dg%2Fpure_byref_2.f90?ref=a01db3bf1a1430d7c4665364250ac63fab318a6a", "patch": "@@ -0,0 +1,17 @@\n+! { dg-do run }\n+! PR 22607: PURE return-by-reference functions\n+program main\n+  implicit none\n+  integer, dimension(2) :: b\n+  b = fun(size(b))\n+  if (b(1) /= 1 .or. b(2) /= 2) call abort()\n+contains\n+  pure function fun(n) \n+    integer, intent(in) :: n\n+    integer :: fun(n)\n+    integer :: i\n+    do i = 1, n\n+        fun(i) = i\n+    end do\n+  end function fun\n+end program main"}]}