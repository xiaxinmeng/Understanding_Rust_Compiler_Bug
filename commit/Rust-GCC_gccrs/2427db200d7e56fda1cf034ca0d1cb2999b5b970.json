{"sha": "2427db200d7e56fda1cf034ca0d1cb2999b5b970", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6MjQyN2RiMjAwZDdlNTZmZGExY2YwMzRjYTBkMWNiMjk5OWI1Yjk3MA==", "commit": {"author": {"name": "Paolo Carlini", "email": "paolo.carlini@oracle.com", "date": "2011-09-27T21:52:19Z"}, "committer": {"name": "Paolo Carlini", "email": "paolo@gcc.gnu.org", "date": "2011-09-27T21:52:19Z"}, "message": "re PR c++/31489 (error says struct when it should say class)\n\n/cp\n2011-09-27  Paolo Carlini  <paolo.carlini@oracle.com>\n\n\tPR c++/31489\n\t* parser.c (cp_parser_elaborated_type_specifier): For RECORD_TYPE,\n\tset CLASSTYPE_DECLARED_CLASS.\n\n/testsuite\n2011-09-27  Paolo Carlini  <paolo.carlini@oracle.com>\n\n\tPR c++/31489\n\t* g++.dg/parse/error40.C: New.\n\t* g++.dg/warn/incomplete1.C: Adjust.\n\nFrom-SVN: r179293", "tree": {"sha": "223b7775cf09fa658f31f839b5f3885bcee2cc6b", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/223b7775cf09fa658f31f839b5f3885bcee2cc6b"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/2427db200d7e56fda1cf034ca0d1cb2999b5b970", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/2427db200d7e56fda1cf034ca0d1cb2999b5b970", "html_url": "https://github.com/Rust-GCC/gccrs/commit/2427db200d7e56fda1cf034ca0d1cb2999b5b970", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/2427db200d7e56fda1cf034ca0d1cb2999b5b970/comments", "author": null, "committer": null, "parents": [{"sha": "82aa87223192a954c5bee4fc5d7dadae0d120b7e", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/82aa87223192a954c5bee4fc5d7dadae0d120b7e", "html_url": "https://github.com/Rust-GCC/gccrs/commit/82aa87223192a954c5bee4fc5d7dadae0d120b7e"}], "stats": {"total": 32, "additions": 30, "deletions": 2}, "files": [{"sha": "596d4a97f7070544a55d7ffd90e7d8c84470491f", "filename": "gcc/cp/ChangeLog", "status": "modified", "additions": 6, "deletions": 0, "changes": 6, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/2427db200d7e56fda1cf034ca0d1cb2999b5b970/gcc%2Fcp%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/2427db200d7e56fda1cf034ca0d1cb2999b5b970/gcc%2Fcp%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fcp%2FChangeLog?ref=2427db200d7e56fda1cf034ca0d1cb2999b5b970", "patch": "@@ -1,3 +1,9 @@\n+2011-09-27  Paolo Carlini  <paolo.carlini@oracle.com>\n+\n+\tPR c++/31489\n+\t* parser.c (cp_parser_elaborated_type_specifier): For RECORD_TYPE,\n+\tset CLASSTYPE_DECLARED_CLASS.\n+\n 2011-09-27  Jakub Jelinek  <jakub@redhat.com>\n \n \t* decl.c (duplicate_decls): If compatible stpcpy prototype"}, {"sha": "83d7b71c8c4c22ee6068eca2f74f868d38d56543", "filename": "gcc/cp/parser.c", "status": "modified", "additions": 7, "deletions": 1, "changes": 8, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/2427db200d7e56fda1cf034ca0d1cb2999b5b970/gcc%2Fcp%2Fparser.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/2427db200d7e56fda1cf034ca0d1cb2999b5b970/gcc%2Fcp%2Fparser.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fcp%2Fparser.c?ref=2427db200d7e56fda1cf034ca0d1cb2999b5b970", "patch": "@@ -13423,7 +13423,13 @@ cp_parser_elaborated_type_specifier (cp_parser* parser,\n     }\n \n   if (tag_type != enum_type)\n-    cp_parser_check_class_key (tag_type, type);\n+    {\n+      /* Indicate whether this class was declared as a `class' or as a\n+\t `struct'.  */\n+      if (TREE_CODE (type) == RECORD_TYPE)\n+\tCLASSTYPE_DECLARED_CLASS (type) = (tag_type == class_type);\n+      cp_parser_check_class_key (tag_type, type);\n+    }\n \n   /* A \"<\" cannot follow an elaborated type specifier.  If that\n      happens, the user was probably trying to form a template-id.  */"}, {"sha": "01eed5cca7ef506767711332860d8a7df5213956", "filename": "gcc/testsuite/ChangeLog", "status": "modified", "additions": 6, "deletions": 0, "changes": 6, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/2427db200d7e56fda1cf034ca0d1cb2999b5b970/gcc%2Ftestsuite%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/2427db200d7e56fda1cf034ca0d1cb2999b5b970/gcc%2Ftestsuite%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2FChangeLog?ref=2427db200d7e56fda1cf034ca0d1cb2999b5b970", "patch": "@@ -1,3 +1,9 @@\n+2011-09-27  Paolo Carlini  <paolo.carlini@oracle.com>\n+\n+\tPR c++/31489\n+\t* g++.dg/parse/error40.C: New.\n+\t* g++.dg/warn/incomplete1.C: Adjust.\n+\n 2011-09-27  Jan Hubicka  <jh@suse.cz>\n \n \tPR middle-end/49463"}, {"sha": "9ab7552ae8396aa885e361f4a65675551065759a", "filename": "gcc/testsuite/g++.dg/parse/error40.C", "status": "added", "additions": 10, "deletions": 0, "changes": 10, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/2427db200d7e56fda1cf034ca0d1cb2999b5b970/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Fparse%2Ferror40.C", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/2427db200d7e56fda1cf034ca0d1cb2999b5b970/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Fparse%2Ferror40.C", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Fparse%2Ferror40.C?ref=2427db200d7e56fda1cf034ca0d1cb2999b5b970", "patch": "@@ -0,0 +1,10 @@\n+// PR c++/31489\n+\n+class foo;   // { dg-error \"'class foo'\" }\n+struct bar;  // { dg-error \"'struct bar'\" }\n+\n+int main()\n+{\n+  foo* f = new foo; // { dg-error \"'class foo'\" }\n+  bar* b = new bar; // { dg-error \"'struct bar'\" }\n+}"}, {"sha": "9dc645d82f9d132c063a13dce15b70bef5c3564b", "filename": "gcc/testsuite/g++.dg/warn/incomplete1.C", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/2427db200d7e56fda1cf034ca0d1cb2999b5b970/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Fwarn%2Fincomplete1.C", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/2427db200d7e56fda1cf034ca0d1cb2999b5b970/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Fwarn%2Fincomplete1.C", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Fwarn%2Fincomplete1.C?ref=2427db200d7e56fda1cf034ca0d1cb2999b5b970", "patch": "@@ -9,7 +9,7 @@\n // (But the deletion does not constitute an ill-formed program. So the\n // program should nevertheless compile, but it should give a warning.)\n \n-class A;\t// { dg-warning \"forward declaration of 'struct A'\" \"\" }\n+class A;\t// { dg-warning \"forward declaration of 'class A'\" \"\" }\n \n A *a;\t\t// { dg-warning \"'a' has incomplete type\" \"\" }\n "}]}