{"sha": "eaaf77dd85c333b116111bb1ae6c080154a4e411", "node_id": "C_kwDOANBUbNoAKGVhYWY3N2RkODVjMzMzYjExNjExMWJiMWFlNmMwODAxNTRhNGU0MTE", "commit": {"author": {"name": "Richard Biener", "email": "rguenther@suse.de", "date": "2022-04-04T08:20:05Z"}, "committer": {"name": "Richard Biener", "email": "rguenther@suse.de", "date": "2022-04-04T09:34:25Z"}, "message": "middle-end/105140 - fix bogus recursion in fold_convertible_p\n\nfold_convertible_p expects an operand and a type to convert to\nbut recurses with two vector component types.  Fixed by allowing\ntypes instead of an operand as well.\n\n2022-04-04  Richard Biener  <rguenther@suse.de>\n\n\tPR middle-end/105140\n\t* fold-const.cc (fold_convertible_p): Allow a TYPE_P arg.\n\n\t* gcc.dg/pr105140.c: New testcase.", "tree": {"sha": "91951066c1414e71f93383f2adc88b286b2ed678", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/91951066c1414e71f93383f2adc88b286b2ed678"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/eaaf77dd85c333b116111bb1ae6c080154a4e411", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/eaaf77dd85c333b116111bb1ae6c080154a4e411", "html_url": "https://github.com/Rust-GCC/gccrs/commit/eaaf77dd85c333b116111bb1ae6c080154a4e411", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/eaaf77dd85c333b116111bb1ae6c080154a4e411/comments", "author": {"login": "rguenth", "id": 2046526, "node_id": "MDQ6VXNlcjIwNDY1MjY=", "avatar_url": "https://avatars.githubusercontent.com/u/2046526?v=4", "gravatar_id": "", "url": "https://api.github.com/users/rguenth", "html_url": "https://github.com/rguenth", "followers_url": "https://api.github.com/users/rguenth/followers", "following_url": "https://api.github.com/users/rguenth/following{/other_user}", "gists_url": "https://api.github.com/users/rguenth/gists{/gist_id}", "starred_url": "https://api.github.com/users/rguenth/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/rguenth/subscriptions", "organizations_url": "https://api.github.com/users/rguenth/orgs", "repos_url": "https://api.github.com/users/rguenth/repos", "events_url": "https://api.github.com/users/rguenth/events{/privacy}", "received_events_url": "https://api.github.com/users/rguenth/received_events", "type": "User", "site_admin": false}, "committer": {"login": "rguenth", "id": 2046526, "node_id": "MDQ6VXNlcjIwNDY1MjY=", "avatar_url": "https://avatars.githubusercontent.com/u/2046526?v=4", "gravatar_id": "", "url": "https://api.github.com/users/rguenth", "html_url": "https://github.com/rguenth", "followers_url": "https://api.github.com/users/rguenth/followers", "following_url": "https://api.github.com/users/rguenth/following{/other_user}", "gists_url": "https://api.github.com/users/rguenth/gists{/gist_id}", "starred_url": "https://api.github.com/users/rguenth/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/rguenth/subscriptions", "organizations_url": "https://api.github.com/users/rguenth/orgs", "repos_url": "https://api.github.com/users/rguenth/repos", "events_url": "https://api.github.com/users/rguenth/events{/privacy}", "received_events_url": "https://api.github.com/users/rguenth/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "f6b786d749812542dae90db1701a3cfdccfa1e4b", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/f6b786d749812542dae90db1701a3cfdccfa1e4b", "html_url": "https://github.com/Rust-GCC/gccrs/commit/f6b786d749812542dae90db1701a3cfdccfa1e4b"}], "stats": {"total": 22, "additions": 20, "deletions": 2}, "files": [{"sha": "fb08fa1dbc60851eee17daa7e890d951e7e89b81", "filename": "gcc/fold-const.cc", "status": "modified", "additions": 3, "deletions": 2, "changes": 5, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/eaaf77dd85c333b116111bb1ae6c080154a4e411/gcc%2Ffold-const.cc", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/eaaf77dd85c333b116111bb1ae6c080154a4e411/gcc%2Ffold-const.cc", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ffold-const.cc?ref=eaaf77dd85c333b116111bb1ae6c080154a4e411", "patch": "@@ -2379,12 +2379,13 @@ build_zero_vector (tree type)\n   return build_vector_from_val (type, t);\n }\n \n-/* Returns true, if ARG is convertible to TYPE using a NOP_EXPR.  */\n+/* Returns true, if ARG, an operand or a type, is convertible to TYPE\n+   using a NOP_EXPR.  */\n \n bool\n fold_convertible_p (const_tree type, const_tree arg)\n {\n-  tree orig = TREE_TYPE (arg);\n+  const_tree orig = TYPE_P (arg) ? arg : TREE_TYPE (arg);\n \n   if (type == orig)\n     return true;"}, {"sha": "14bff2f7f9c5d2e6f2d628cbcb797f04744a318d", "filename": "gcc/testsuite/gcc.dg/pr105140.c", "status": "added", "additions": 17, "deletions": 0, "changes": 17, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/eaaf77dd85c333b116111bb1ae6c080154a4e411/gcc%2Ftestsuite%2Fgcc.dg%2Fpr105140.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/eaaf77dd85c333b116111bb1ae6c080154a4e411/gcc%2Ftestsuite%2Fgcc.dg%2Fpr105140.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgcc.dg%2Fpr105140.c?ref=eaaf77dd85c333b116111bb1ae6c080154a4e411", "patch": "@@ -0,0 +1,17 @@\n+/* { dg-do compile } */\n+/* { dg-options \"-Os -w -Wno-psabi\" } */\n+\n+typedef char __attribute__((__vector_size__ (16 * sizeof (char)))) U;\n+typedef int __attribute__((__vector_size__ (16 * sizeof (int)))) V;\n+\n+void bar ();\n+\n+bar (int i, int j, int k, V v)\n+{\n+}\n+\n+void\n+foo (void)\n+{\n+  bar ((V){}, (V){}, (V){}, (U){});\n+}"}]}