{"sha": "4dd9e1c541e0eb921d62c8652c854b1259e56aac", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6NGRkOWUxYzU0MWUwZWI5MjFkNjJjODY1MmM4NTRiMTI1OWU1NmFhYw==", "commit": {"author": {"name": "Thomas Schwinge", "email": "thomas@codesourcery.com", "date": "2021-04-07T08:36:36Z"}, "committer": {"name": "Thomas Schwinge", "email": "thomas@codesourcery.com", "date": "2021-04-15T09:13:27Z"}, "message": "XFAIL OpenMP/nvptx execution-time hangs for simple nested OpenMP 'target'/'parallel'/'task' constructs [PR99555]\n\n... still awaiting proper resolution, of course.\n\n\tlibgomp/\n\tPR target/99555\n\t* testsuite/lib/libgomp.exp\n\t(check_effective_target_offload_device_nvptx): New.\n\t* testsuite/libgomp.c/pr99555-1.c <nvptx offload device>: Until\n\tresolved, make sure that we exit quickly, with error status,\n\tXFAILed.\n\t* testsuite/libgomp.c-c++-common/task-detach-6.c: Likewise.\n\t* testsuite/libgomp.fortran/task-detach-6.f90: Likewise.", "tree": {"sha": "757f5ea6dac106c87ec883ac2e0ab3aee6923c0d", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/757f5ea6dac106c87ec883ac2e0ab3aee6923c0d"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/4dd9e1c541e0eb921d62c8652c854b1259e56aac", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/4dd9e1c541e0eb921d62c8652c854b1259e56aac", "html_url": "https://github.com/Rust-GCC/gccrs/commit/4dd9e1c541e0eb921d62c8652c854b1259e56aac", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/4dd9e1c541e0eb921d62c8652c854b1259e56aac/comments", "author": {"login": "tschwinge", "id": 21753, "node_id": "MDQ6VXNlcjIxNzUz", "avatar_url": "https://avatars.githubusercontent.com/u/21753?v=4", "gravatar_id": "", "url": "https://api.github.com/users/tschwinge", "html_url": "https://github.com/tschwinge", "followers_url": "https://api.github.com/users/tschwinge/followers", "following_url": "https://api.github.com/users/tschwinge/following{/other_user}", "gists_url": "https://api.github.com/users/tschwinge/gists{/gist_id}", "starred_url": "https://api.github.com/users/tschwinge/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/tschwinge/subscriptions", "organizations_url": "https://api.github.com/users/tschwinge/orgs", "repos_url": "https://api.github.com/users/tschwinge/repos", "events_url": "https://api.github.com/users/tschwinge/events{/privacy}", "received_events_url": "https://api.github.com/users/tschwinge/received_events", "type": "User", "site_admin": false}, "committer": {"login": "tschwinge", "id": 21753, "node_id": "MDQ6VXNlcjIxNzUz", "avatar_url": "https://avatars.githubusercontent.com/u/21753?v=4", "gravatar_id": "", "url": "https://api.github.com/users/tschwinge", "html_url": "https://github.com/tschwinge", "followers_url": "https://api.github.com/users/tschwinge/followers", "following_url": "https://api.github.com/users/tschwinge/following{/other_user}", "gists_url": "https://api.github.com/users/tschwinge/gists{/gist_id}", "starred_url": "https://api.github.com/users/tschwinge/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/tschwinge/subscriptions", "organizations_url": "https://api.github.com/users/tschwinge/orgs", "repos_url": "https://api.github.com/users/tschwinge/repos", "events_url": "https://api.github.com/users/tschwinge/events{/privacy}", "received_events_url": "https://api.github.com/users/tschwinge/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "39d23b7960e4efb11bbe1eff056ae9da0884c539", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/39d23b7960e4efb11bbe1eff056ae9da0884c539", "html_url": "https://github.com/Rust-GCC/gccrs/commit/39d23b7960e4efb11bbe1eff056ae9da0884c539"}], "stats": {"total": 25, "additions": 22, "deletions": 3}, "files": [{"sha": "14dcfdfd00a94fc8bb2d467e98b868aae4f7bda5", "filename": "libgomp/testsuite/lib/libgomp.exp", "status": "modified", "additions": 12, "deletions": 0, "changes": 12, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/4dd9e1c541e0eb921d62c8652c854b1259e56aac/libgomp%2Ftestsuite%2Flib%2Flibgomp.exp", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/4dd9e1c541e0eb921d62c8652c854b1259e56aac/libgomp%2Ftestsuite%2Flib%2Flibgomp.exp", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libgomp%2Ftestsuite%2Flib%2Flibgomp.exp?ref=4dd9e1c541e0eb921d62c8652c854b1259e56aac", "patch": "@@ -401,6 +401,18 @@ proc check_effective_target_offload_device_shared_as { } {\n     } ]\n }\n \n+# Return 1 if using nvptx offload device.\n+proc check_effective_target_offload_device_nvptx { } {\n+    return [check_runtime_nocache offload_device_nvptx {\n+      #include <omp.h>\n+      #include \"testsuite/libgomp.c-c++-common/on_device_arch.h\"\n+      int main ()\n+\t{\n+\t  return !on_device_arch_nvptx ();\n+\t}\n+    } ]\n+}\n+\n # Return 1 if at least one Nvidia GPU is accessible.\n \n proc check_effective_target_openacc_nvidia_accel_present { } {"}, {"sha": "f18b57bf0477c0e35d7fb37d0fdb45de4b536895", "filename": "libgomp/testsuite/libgomp.c-c++-common/task-detach-6.c", "status": "modified", "additions": 4, "deletions": 1, "changes": 5, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/4dd9e1c541e0eb921d62c8652c854b1259e56aac/libgomp%2Ftestsuite%2Flibgomp.c-c%2B%2B-common%2Ftask-detach-6.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/4dd9e1c541e0eb921d62c8652c854b1259e56aac/libgomp%2Ftestsuite%2Flibgomp.c-c%2B%2B-common%2Ftask-detach-6.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libgomp%2Ftestsuite%2Flibgomp.c-c%2B%2B-common%2Ftask-detach-6.c?ref=4dd9e1c541e0eb921d62c8652c854b1259e56aac", "patch": "@@ -2,6 +2,8 @@\n \n #include <omp.h>\n #include <assert.h>\n+#include <unistd.h> // For 'alarm'.\n+\n #include \"on_device_arch.h\"\n \n /* Test tasks with detach clause on an offload device.  Each device\n@@ -12,7 +14,8 @@ int main (void)\n {\n   //TODO See '../libgomp.c/pr99555-1.c'.\n   if (on_device_arch_nvptx ())\n-    __builtin_abort (); //TODO Until resolved, skip, with error status.\n+    alarm (4); /*TODO Until resolved, make sure that we exit quickly, with error status.\n+\t\t { dg-xfail-run-if \"PR99555\" { offload_device_nvptx } } */\n \n   int x = 0, y = 0, z = 0;\n   int thread_count;"}, {"sha": "bd33b93716bf6c426c503a99970dc003b06e85e5", "filename": "libgomp/testsuite/libgomp.c/pr99555-1.c", "status": "modified", "additions": 4, "deletions": 1, "changes": 5, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/4dd9e1c541e0eb921d62c8652c854b1259e56aac/libgomp%2Ftestsuite%2Flibgomp.c%2Fpr99555-1.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/4dd9e1c541e0eb921d62c8652c854b1259e56aac/libgomp%2Ftestsuite%2Flibgomp.c%2Fpr99555-1.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libgomp%2Ftestsuite%2Flibgomp.c%2Fpr99555-1.c?ref=4dd9e1c541e0eb921d62c8652c854b1259e56aac", "patch": "@@ -2,12 +2,15 @@\n \n // { dg-additional-options \"-O0\" }\n \n+#include <unistd.h> // For 'alarm'.\n+\n #include \"../libgomp.c-c++-common/on_device_arch.h\"\n \n int main (void)\n {\n   if (on_device_arch_nvptx ())\n-    __builtin_abort (); //TODO Until resolved, skip, with error status.\n+    alarm (4); /*TODO Until resolved, make sure that we exit quickly, with error status.\n+\t\t { dg-xfail-run-if \"PR99555\" { offload_device_nvptx } } */\n \n #pragma omp target\n #pragma omp parallel // num_threads(1)"}, {"sha": "e4373b4c6f14e3d053b58b4caa221065f7084a49", "filename": "libgomp/testsuite/libgomp.fortran/task-detach-6.f90", "status": "modified", "additions": 2, "deletions": 1, "changes": 3, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/4dd9e1c541e0eb921d62c8652c854b1259e56aac/libgomp%2Ftestsuite%2Flibgomp.fortran%2Ftask-detach-6.f90", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/4dd9e1c541e0eb921d62c8652c854b1259e56aac/libgomp%2Ftestsuite%2Flibgomp.fortran%2Ftask-detach-6.f90", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libgomp%2Ftestsuite%2Flibgomp.fortran%2Ftask-detach-6.f90?ref=4dd9e1c541e0eb921d62c8652c854b1259e56aac", "patch": "@@ -21,7 +21,8 @@ end function on_device_arch_nvptx\n \n   !TODO See '../libgomp.c/pr99555-1.c'.\n   if (on_device_arch_nvptx () /= 0) then\n-     error stop !TODO Until resolved, skip, with error status.\n+     call alarm (4, 0); !TODO Until resolved, make sure that we exit quickly, with error status.\n+     ! { dg-xfail-run-if \"PR99555\" { offload_device_nvptx } }\n   end if\n \n   !$omp target map (tofrom: x, y, z) map (from: thread_count)"}]}