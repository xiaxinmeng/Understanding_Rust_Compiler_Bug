{"sha": "f0f67c96c3906c09d9a9e00cbdbbb959c9c6e539", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6ZjBmNjdjOTZjMzkwNmMwOWQ5YTllMDBjYmRiYmI5NTljOWM2ZTUzOQ==", "commit": {"author": {"name": "Janus Weil", "email": "janus@gcc.gnu.org", "date": "2012-12-20T18:15:13Z"}, "committer": {"name": "Janus Weil", "email": "janus@gcc.gnu.org", "date": "2012-12-20T18:15:13Z"}, "message": "re PR libfortran/36044 (user-requested backtrace)\n\n2012-12-20  Janus Weil  <janus@gcc.gnu.org>\n\n\tPR fortran/36044\n\t* gfortran.h (gfc_isym_id): Add GFC_ISYM_BACKTRACE.\n\t* intrinsic.c (add_subroutines): Add \"backtrace\".\n\t* intrinsic.texi (BACKTRACE): Document BACKTRACE intrinsic.\n\n\n2012-12-20  Janus Weil  <janus@gcc.gnu.org>\n\n\tPR fortran/36044\n\t* gfortran.map: Add _gfortran_backtrace.\n\t* libgfortran.h: Rename 'show_backtrace' and export.\n\t* runtime/backtrace.c (show_backtrace): Rename to 'backtrace'.\n\tDon't show message. Close file descriptor. Export.\n\t* runtime/compile_options.c (backtrace_handler): Renamed\n\t'show_backtrace'. Move message outside.\n\t* runtime/error.c (sys_abort): Ditto.\n\nFrom-SVN: r194648", "tree": {"sha": "e5d70c766699e82a05d85f8b91a5a37c1eee9520", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/e5d70c766699e82a05d85f8b91a5a37c1eee9520"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/f0f67c96c3906c09d9a9e00cbdbbb959c9c6e539", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/f0f67c96c3906c09d9a9e00cbdbbb959c9c6e539", "html_url": "https://github.com/Rust-GCC/gccrs/commit/f0f67c96c3906c09d9a9e00cbdbbb959c9c6e539", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/f0f67c96c3906c09d9a9e00cbdbbb959c9c6e539/comments", "author": {"login": "janusw", "id": 484108, "node_id": "MDQ6VXNlcjQ4NDEwOA==", "avatar_url": "https://avatars.githubusercontent.com/u/484108?v=4", "gravatar_id": "", "url": "https://api.github.com/users/janusw", "html_url": "https://github.com/janusw", "followers_url": "https://api.github.com/users/janusw/followers", "following_url": "https://api.github.com/users/janusw/following{/other_user}", "gists_url": "https://api.github.com/users/janusw/gists{/gist_id}", "starred_url": "https://api.github.com/users/janusw/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/janusw/subscriptions", "organizations_url": "https://api.github.com/users/janusw/orgs", "repos_url": "https://api.github.com/users/janusw/repos", "events_url": "https://api.github.com/users/janusw/events{/privacy}", "received_events_url": "https://api.github.com/users/janusw/received_events", "type": "User", "site_admin": false}, "committer": {"login": "janusw", "id": 484108, "node_id": "MDQ6VXNlcjQ4NDEwOA==", "avatar_url": "https://avatars.githubusercontent.com/u/484108?v=4", "gravatar_id": "", "url": "https://api.github.com/users/janusw", "html_url": "https://github.com/janusw", "followers_url": "https://api.github.com/users/janusw/followers", "following_url": "https://api.github.com/users/janusw/following{/other_user}", "gists_url": "https://api.github.com/users/janusw/gists{/gist_id}", "starred_url": "https://api.github.com/users/janusw/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/janusw/subscriptions", "organizations_url": "https://api.github.com/users/janusw/orgs", "repos_url": "https://api.github.com/users/janusw/repos", "events_url": "https://api.github.com/users/janusw/events{/privacy}", "received_events_url": "https://api.github.com/users/janusw/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "d97c9b2248a86fc8a2d3f65df0e0a63347c89e2a", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/d97c9b2248a86fc8a2d3f65df0e0a63347c89e2a", "html_url": "https://github.com/Rust-GCC/gccrs/commit/d97c9b2248a86fc8a2d3f65df0e0a63347c89e2a"}], "stats": {"total": 71, "additions": 63, "deletions": 8}, "files": [{"sha": "db7383c57f259aef309714ce242c6408b12ca43f", "filename": "gcc/fortran/ChangeLog", "status": "modified", "additions": 7, "deletions": 0, "changes": 7, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/f0f67c96c3906c09d9a9e00cbdbbb959c9c6e539/gcc%2Ffortran%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/f0f67c96c3906c09d9a9e00cbdbbb959c9c6e539/gcc%2Ffortran%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ffortran%2FChangeLog?ref=f0f67c96c3906c09d9a9e00cbdbbb959c9c6e539", "patch": "@@ -1,3 +1,10 @@\n+2012-12-20  Janus Weil  <janus@gcc.gnu.org>\n+\n+\tPR fortran/36044\n+\t* gfortran.h (gfc_isym_id): Add GFC_ISYM_BACKTRACE.\n+\t* intrinsic.c (add_subroutines): Add \"backtrace\".\n+\t* intrinsic.texi (BACKTRACE): Document BACKTRACE intrinsic.\n+\n 2012-12-20  Tobias Burnus  <burnus@net-b.de>\n \n \tPR fortran/54818"}, {"sha": "ec0c61f09c9950ba9fe9be80312a796ecbec3e09", "filename": "gcc/fortran/gfortran.h", "status": "modified", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/f0f67c96c3906c09d9a9e00cbdbbb959c9c6e539/gcc%2Ffortran%2Fgfortran.h", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/f0f67c96c3906c09d9a9e00cbdbbb959c9c6e539/gcc%2Ffortran%2Fgfortran.h", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ffortran%2Fgfortran.h?ref=f0f67c96c3906c09d9a9e00cbdbbb959c9c6e539", "patch": "@@ -505,6 +505,7 @@ enum gfc_isym_id\n   GFC_ISYM_SHIFTA,\n   GFC_ISYM_SHIFTL,\n   GFC_ISYM_SHIFTR,\n+  GFC_ISYM_BACKTRACE,\n   GFC_ISYM_SIGN,\n   GFC_ISYM_SIGNAL,\n   GFC_ISYM_SI_KIND,"}, {"sha": "274c921c8a8e8b570a195f9e1f37ba4e6f400361", "filename": "gcc/fortran/intrinsic.c", "status": "modified", "additions": 2, "deletions": 0, "changes": 2, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/f0f67c96c3906c09d9a9e00cbdbbb959c9c6e539/gcc%2Ffortran%2Fintrinsic.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/f0f67c96c3906c09d9a9e00cbdbbb959c9c6e539/gcc%2Ffortran%2Fintrinsic.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ffortran%2Fintrinsic.c?ref=f0f67c96c3906c09d9a9e00cbdbbb959c9c6e539", "patch": "@@ -2896,6 +2896,8 @@ add_subroutines (void)\n \t      \"value\", BT_INTEGER, di, REQUIRED, INTENT_OUT,\n \t      \"atom\", BT_INTEGER, di, REQUIRED, INTENT_IN);\n \n+  add_sym_0s (\"backtrace\", GFC_ISYM_BACKTRACE, GFC_STD_GNU, NULL);\n+\n   add_sym_1s (\"cpu_time\", GFC_ISYM_CPU_TIME, CLASS_IMPURE, BT_UNKNOWN, 0,\n \t      GFC_STD_F95, gfc_check_cpu_time, NULL, gfc_resolve_cpu_time,\n \t      tm, BT_REAL, dr, REQUIRED, INTENT_OUT);"}, {"sha": "fc256cb9e8be63b4ff11f1600bfa7edf5aacf42f", "filename": "gcc/fortran/intrinsic.texi", "status": "modified", "additions": 32, "deletions": 1, "changes": 33, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/f0f67c96c3906c09d9a9e00cbdbbb959c9c6e539/gcc%2Ffortran%2Fintrinsic.texi", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/f0f67c96c3906c09d9a9e00cbdbbb959c9c6e539/gcc%2Ffortran%2Fintrinsic.texi", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ffortran%2Fintrinsic.texi?ref=f0f67c96c3906c09d9a9e00cbdbbb959c9c6e539", "patch": "@@ -63,6 +63,7 @@ Some basic guidelines for editing this document:\n * @code{ATANH}:         ATANH,     Inverse hyperbolic tangent function\n * @code{ATOMIC_DEFINE}: ATOMIC_DEFINE, Setting a variable atomically\n * @code{ATOMIC_REF}:    ATOMIC_REF, Obtaining the value of a variable atomically\n+* @code{BACKTRACE}:     BACKTRACE, Show a backtrace\n * @code{BESSEL_J0}:     BESSEL_J0, Bessel function of the first kind of order 0\n * @code{BESSEL_J1}:     BESSEL_J1, Bessel function of the first kind of order 1\n * @code{BESSEL_JN}:     BESSEL_JN, Bessel function of the first kind\n@@ -349,6 +350,7 @@ the applicable standard for each intrinsic procedure is noted.\n @item @emph{Description}:\n @code{ABORT} causes immediate termination of the program.  On operating\n systems that support a core dump, @code{ABORT} will produce a core dump.\n+It will also print a backtrace, unless @code{-fno-backtrace} is given.\n \n @item @emph{Standard}:\n GNU extension\n@@ -371,7 +373,7 @@ end program test_abort\n @end smallexample\n \n @item @emph{See also}:\n-@ref{EXIT}, @ref{KILL}\n+@ref{EXIT}, @ref{KILL}, @ref{BACKTRACE}\n \n @end table\n \n@@ -1644,6 +1646,35 @@ end program atomic\n \n \n \n+@node BACKTRACE\n+@section @code{BACKTRACE} --- Show a backtrace\n+@fnindex BACKTRACE\n+@cindex backtrace\n+\n+@table @asis\n+@item @emph{Description}:\n+@code{BACKTRACE} shows a backtrace at an arbitrary place in user code. Program\n+execution continues normally afterwards. The backtrace information is printed\n+to the unit corresponding to @code{ERROR_UNIT} in @code{ISO_FORTRAN_ENV}.\n+\n+@item @emph{Standard}:\n+GNU Extension\n+\n+@item @emph{Class}:\n+Subroutine\n+\n+@item @emph{Syntax}:\n+@code{CALL BACKTRACE}\n+\n+@item @emph{Arguments}:\n+None\n+\n+@item @emph{See also}:\n+@ref{ABORT}\n+@end table\n+\n+\n+\n @node BESSEL_J0\n @section @code{BESSEL_J0} --- Bessel function of the first kind of order 0\n @fnindex BESSEL_J0"}, {"sha": "32f9bbe7fd9632c8e40131420543d2c95f639a1b", "filename": "libgfortran/ChangeLog", "status": "modified", "additions": 11, "deletions": 0, "changes": 11, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/f0f67c96c3906c09d9a9e00cbdbbb959c9c6e539/libgfortran%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/f0f67c96c3906c09d9a9e00cbdbbb959c9c6e539/libgfortran%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libgfortran%2FChangeLog?ref=f0f67c96c3906c09d9a9e00cbdbbb959c9c6e539", "patch": "@@ -1,3 +1,14 @@\n+2012-12-20  Janus Weil  <janus@gcc.gnu.org>\n+\n+\tPR fortran/36044\n+\t* gfortran.map: Add _gfortran_backtrace.\n+\t* libgfortran.h: Rename 'show_backtrace' and export.\n+\t* runtime/backtrace.c (show_backtrace): Rename to 'backtrace'.\n+\tDon't show message. Close file descriptor. Export.\n+\t* runtime/compile_options.c (backtrace_handler): Renamed\n+\t'show_backtrace'. Move message outside.\n+\t* runtime/error.c (sys_abort): Ditto.\n+\n 2012-12-19  Paul Thomas  <pault@gcc.gnu.org>\n \n \t* intrinsics/extends_type_of.c : Return correct results for"}, {"sha": "80a9a00071a69e159848059702fc6feedf5f7758", "filename": "libgfortran/gfortran.map", "status": "modified", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/f0f67c96c3906c09d9a9e00cbdbbb959c9c6e539/libgfortran%2Fgfortran.map", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/f0f67c96c3906c09d9a9e00cbdbbb959c9c6e539/libgfortran%2Fgfortran.map", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libgfortran%2Fgfortran.map?ref=f0f67c96c3906c09d9a9e00cbdbbb959c9c6e539", "patch": "@@ -1192,6 +1192,7 @@ GFORTRAN_1.4 {\n GFORTRAN_1.5 {\n   global:\n     _gfortran_ftell2;\n+    _gfortran_backtrace;\n } GFORTRAN_1.4; \n \n F2C_1.0 {"}, {"sha": "ae18752758122ad94c5697ffad278a508c6565b8", "filename": "libgfortran/libgfortran.h", "status": "modified", "additions": 2, "deletions": 2, "changes": 4, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/f0f67c96c3906c09d9a9e00cbdbbb959c9c6e539/libgfortran%2Flibgfortran.h", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/f0f67c96c3906c09d9a9e00cbdbbb959c9c6e539/libgfortran%2Flibgfortran.h", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libgfortran%2Flibgfortran.h?ref=f0f67c96c3906c09d9a9e00cbdbbb959c9c6e539", "patch": "@@ -667,8 +667,8 @@ internal_proto(find_addr2line);\n \n /* backtrace.c */\n \n-extern void show_backtrace (void);\n-internal_proto(show_backtrace);\n+extern void backtrace (void);\n+iexport_proto(backtrace);\n \n /* error.c */\n "}, {"sha": "3e3e8441ea1bf97dfeff4c6b7b1dc03257deba45", "filename": "libgfortran/runtime/backtrace.c", "status": "modified", "additions": 3, "deletions": 3, "changes": 6, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/f0f67c96c3906c09d9a9e00cbdbbb959c9c6e539/libgfortran%2Fruntime%2Fbacktrace.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/f0f67c96c3906c09d9a9e00cbdbbb959c9c6e539/libgfortran%2Fruntime%2Fbacktrace.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libgfortran%2Fruntime%2Fbacktrace.c?ref=f0f67c96c3906c09d9a9e00cbdbbb959c9c6e539", "patch": "@@ -190,14 +190,12 @@ trace_function (struct _Unwind_Context *context, void *state_ptr)\n /* Display the backtrace.  */\n \n void\n-show_backtrace (void)\n+backtrace (void)\n {\n   bt_state state;\n   state.frame_number = 0;\n   state.error = 0;\n \n-  estr_write (\"\\nBacktrace for this error:\\n\");\n-\n #if CAN_PIPE\n \n   if (addr2line_path == NULL)\n@@ -261,6 +259,7 @@ show_backtrace (void)\n     if (state.error)\n       goto fallback;\n     close (inp[1]);\n+    close (f[0]);\n     wait (NULL);\n     return;\n \n@@ -277,3 +276,4 @@ show_backtrace (void)\n   state.direct_output = 1;\n   _Unwind_Backtrace (trace_function, &state);\n }\n+iexport(backtrace);"}, {"sha": "1860edadf5c6cfd1b1b280c68ba1dd43fef10164", "filename": "libgfortran/runtime/compile_options.c", "status": "modified", "additions": 2, "deletions": 1, "changes": 3, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/f0f67c96c3906c09d9a9e00cbdbbb959c9c6e539/libgfortran%2Fruntime%2Fcompile_options.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/f0f67c96c3906c09d9a9e00cbdbbb959c9c6e539/libgfortran%2Fruntime%2Fcompile_options.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libgfortran%2Fruntime%2Fcompile_options.c?ref=f0f67c96c3906c09d9a9e00cbdbbb959c9c6e539", "patch": "@@ -126,7 +126,8 @@ backtrace_handler (int signum)\n   fatal_error_in_progress = 1;\n \n   show_signal (signum);\n-  show_backtrace();\n+  estr_write (\"\\nBacktrace for this error:\\n\");\n+  backtrace ();\n \n   /* Now reraise the signal.  We reactivate the signal's\n      default handling, which is to terminate the process."}, {"sha": "dfdfb4cbfe7c8e73a16916ae65fbb8bd792fc344", "filename": "libgfortran/runtime/error.c", "status": "modified", "additions": 2, "deletions": 1, "changes": 3, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/f0f67c96c3906c09d9a9e00cbdbbb959c9c6e539/libgfortran%2Fruntime%2Ferror.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/f0f67c96c3906c09d9a9e00cbdbbb959c9c6e539/libgfortran%2Fruntime%2Ferror.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libgfortran%2Fruntime%2Ferror.c?ref=f0f67c96c3906c09d9a9e00cbdbbb959c9c6e539", "patch": "@@ -166,7 +166,8 @@ sys_abort (void)\n   if (options.backtrace == 1\n       || (options.backtrace == -1 && compile_options.backtrace == 1))\n     {\n-      show_backtrace ();\n+      estr_write (\"\\nProgram aborted. Backtrace:\\n\");\n+      backtrace ();\n       signal (SIGABRT, SIG_DFL);\n     }\n "}]}