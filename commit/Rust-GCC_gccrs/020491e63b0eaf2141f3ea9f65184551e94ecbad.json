{"sha": "020491e63b0eaf2141f3ea9f65184551e94ecbad", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6MDIwNDkxZTYzYjBlYWYyMTQxZjNlYTlmNjUxODQ1NTFlOTRlY2JhZA==", "commit": {"author": {"name": "Jason Merrill", "email": "jason@redhat.com", "date": "2016-01-21T20:26:21Z"}, "committer": {"name": "Jason Merrill", "email": "jason@gcc.gnu.org", "date": "2016-01-21T20:26:21Z"}, "message": "re PR c++/65687 (Inconsistent behavior for __attribute__((__deprecated__)) between C and C++.)\n\n\tPR c++/65687\n\t* decl.c (type_is_deprecated): Don't look into a typedef.\n\nFrom-SVN: r232703", "tree": {"sha": "566359039e775fab5642c199dc190ba14acb985d", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/566359039e775fab5642c199dc190ba14acb985d"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/020491e63b0eaf2141f3ea9f65184551e94ecbad", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/020491e63b0eaf2141f3ea9f65184551e94ecbad", "html_url": "https://github.com/Rust-GCC/gccrs/commit/020491e63b0eaf2141f3ea9f65184551e94ecbad", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/020491e63b0eaf2141f3ea9f65184551e94ecbad/comments", "author": {"login": "jicama", "id": 266146, "node_id": "MDQ6VXNlcjI2NjE0Ng==", "avatar_url": "https://avatars.githubusercontent.com/u/266146?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jicama", "html_url": "https://github.com/jicama", "followers_url": "https://api.github.com/users/jicama/followers", "following_url": "https://api.github.com/users/jicama/following{/other_user}", "gists_url": "https://api.github.com/users/jicama/gists{/gist_id}", "starred_url": "https://api.github.com/users/jicama/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jicama/subscriptions", "organizations_url": "https://api.github.com/users/jicama/orgs", "repos_url": "https://api.github.com/users/jicama/repos", "events_url": "https://api.github.com/users/jicama/events{/privacy}", "received_events_url": "https://api.github.com/users/jicama/received_events", "type": "User", "site_admin": false}, "committer": null, "parents": [{"sha": "2f3932b910c7e450e0ac75e607dfb7229b9429cc", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/2f3932b910c7e450e0ac75e607dfb7229b9429cc", "html_url": "https://github.com/Rust-GCC/gccrs/commit/2f3932b910c7e450e0ac75e607dfb7229b9429cc"}], "stats": {"total": 27, "additions": 24, "deletions": 3}, "files": [{"sha": "af5c907713e7967f434b323fa4c7f51298fc2462", "filename": "gcc/cp/ChangeLog", "status": "modified", "additions": 3, "deletions": 0, "changes": 3, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/020491e63b0eaf2141f3ea9f65184551e94ecbad/gcc%2Fcp%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/020491e63b0eaf2141f3ea9f65184551e94ecbad/gcc%2Fcp%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fcp%2FChangeLog?ref=020491e63b0eaf2141f3ea9f65184551e94ecbad", "patch": "@@ -1,5 +1,8 @@\n 2016-01-21  Jason Merrill  <jason@redhat.com>\n \n+\tPR c++/65687\n+\t* decl.c (type_is_deprecated): Don't look into a typedef.\n+\n \tPR c++/40751\n \tPR c++/64987\n \t* decl.c (copy_type_enum): Respect TYPE_USER_ALIGN."}, {"sha": "f4604b61ee02a79c66f09e688c6a68a4d1597270", "filename": "gcc/cp/decl.c", "status": "modified", "additions": 7, "deletions": 3, "changes": 10, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/020491e63b0eaf2141f3ea9f65184551e94ecbad/gcc%2Fcp%2Fdecl.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/020491e63b0eaf2141f3ea9f65184551e94ecbad/gcc%2Fcp%2Fdecl.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fcp%2Fdecl.c?ref=020491e63b0eaf2141f3ea9f65184551e94ecbad", "patch": "@@ -11595,9 +11595,13 @@ type_is_deprecated (tree type)\n   enum tree_code code;\n   if (TREE_DEPRECATED (type))\n     return type;\n-  if (TYPE_NAME (type)\n-      && TREE_DEPRECATED (TYPE_NAME (type)))\n-    return type;\n+  if (TYPE_NAME (type))\n+    {\n+      if (TREE_DEPRECATED (TYPE_NAME (type)))\n+\treturn type;\n+      else\n+\treturn NULL_TREE;\n+    }\n \n   /* Do warn about using typedefs to a deprecated class.  */\n   if (OVERLOAD_TYPE_P (type) && type != TYPE_MAIN_VARIANT (type))"}, {"sha": "55cdf3dd7f60a50489b7636cc252ffc1b34eb291", "filename": "gcc/testsuite/g++.dg/warn/deprecated-10.C", "status": "added", "additions": 14, "deletions": 0, "changes": 14, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/020491e63b0eaf2141f3ea9f65184551e94ecbad/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Fwarn%2Fdeprecated-10.C", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/020491e63b0eaf2141f3ea9f65184551e94ecbad/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Fwarn%2Fdeprecated-10.C", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Fwarn%2Fdeprecated-10.C?ref=020491e63b0eaf2141f3ea9f65184551e94ecbad", "patch": "@@ -0,0 +1,14 @@\n+// PR c++/65687\n+\n+typedef struct old_visible_stuff *opaquePointer;\n+\n+struct old_visible_stuff {\n+  int things_we_no_longer;\n+  int wish_to_expose;\n+} __attribute__((__deprecated__(\"do not refer to this, the layout might change\")));\n+\n+typedef struct old_visible_stuff *another; // { dg-warning \"deprecated\" }\n+\n+opaquePointer runtime_function (opaquePointer someObject);\n+\n+opaquePointer bad_runtime_call (struct old_visible_stuff *otherObject); // { dg-warning \"deprecated\" }"}]}