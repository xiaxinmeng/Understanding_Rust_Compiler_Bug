{"sha": "a421fe9e610b5dbfce1913cd724c8ba193addd47", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6YTQyMWZlOWU2MTBiNWRiZmNlMTkxM2NkNzI0YzhiYTE5M2FkZGQ0Nw==", "commit": {"author": {"name": "Andre Vieira", "email": "andre.simoesdiasvieira@arm.com", "date": "2019-10-17T11:59:35Z"}, "committer": {"name": "Andre Vieira", "email": "avieira@gcc.gnu.org", "date": "2019-10-17T11:59:35Z"}, "message": "[vect] Refactor versioning threshold\n\ngcc/ChangeLog:\n2019-10-17  Andre Vieira  <andre.simoesdiasvieira@arm.com>\n\n\t* tree-vect-loop.c (vect_transform_loop): Move code from here...\n\t* tree-vect-loop-manip.c (vect_loop_versioning): ... to here.\n\t* tree-vectorizer.h (vect_loop_versioning): Remove unused parameters.\n\nFrom-SVN: r277101", "tree": {"sha": "6ae472730ccf006dd1bbaff4c76c87532546cdc4", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/6ae472730ccf006dd1bbaff4c76c87532546cdc4"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/a421fe9e610b5dbfce1913cd724c8ba193addd47", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/a421fe9e610b5dbfce1913cd724c8ba193addd47", "html_url": "https://github.com/Rust-GCC/gccrs/commit/a421fe9e610b5dbfce1913cd724c8ba193addd47", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/a421fe9e610b5dbfce1913cd724c8ba193addd47/comments", "author": {"login": "avieira-arm", "id": 68072104, "node_id": "MDQ6VXNlcjY4MDcyMTA0", "avatar_url": "https://avatars.githubusercontent.com/u/68072104?v=4", "gravatar_id": "", "url": "https://api.github.com/users/avieira-arm", "html_url": "https://github.com/avieira-arm", "followers_url": "https://api.github.com/users/avieira-arm/followers", "following_url": "https://api.github.com/users/avieira-arm/following{/other_user}", "gists_url": "https://api.github.com/users/avieira-arm/gists{/gist_id}", "starred_url": "https://api.github.com/users/avieira-arm/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/avieira-arm/subscriptions", "organizations_url": "https://api.github.com/users/avieira-arm/orgs", "repos_url": "https://api.github.com/users/avieira-arm/repos", "events_url": "https://api.github.com/users/avieira-arm/events{/privacy}", "received_events_url": "https://api.github.com/users/avieira-arm/received_events", "type": "User", "site_admin": false}, "committer": null, "parents": [{"sha": "aa9dffac731d0359a0e7a925ff8f4a1bef182eac", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/aa9dffac731d0359a0e7a925ff8f4a1bef182eac", "html_url": "https://github.com/Rust-GCC/gccrs/commit/aa9dffac731d0359a0e7a925ff8f4a1bef182eac"}], "stats": {"total": 32, "additions": 15, "deletions": 17}, "files": [{"sha": "4c90b48c9f388b1dff765bf74acdafbd7ade394f", "filename": "gcc/ChangeLog", "status": "modified", "additions": 6, "deletions": 0, "changes": 6, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/a421fe9e610b5dbfce1913cd724c8ba193addd47/gcc%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/a421fe9e610b5dbfce1913cd724c8ba193addd47/gcc%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2FChangeLog?ref=a421fe9e610b5dbfce1913cd724c8ba193addd47", "patch": "@@ -1,3 +1,9 @@\n+2019-10-17  Andre Vieira  <andre.simoesdiasvieira@arm.com>\n+\n+\t* tree-vect-loop.c (vect_transform_loop): Move code from here...\n+\t* tree-vect-loop-manip.c (vect_loop_versioning): ... to here.\n+\t* tree-vectorizer.h (vect_loop_versioning): Remove unused parameters.\n+\n 2019-10-17  Richard Biener  <rguenther@suse.de>\n \n \t* tree-vect-loop.c (needs_fold_left_reduction_p): Export."}, {"sha": "a2902267c62889a63af09d121a631e6d8c6f69d5", "filename": "gcc/tree-vect-loop-manip.c", "status": "modified", "additions": 7, "deletions": 4, "changes": 11, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/a421fe9e610b5dbfce1913cd724c8ba193addd47/gcc%2Ftree-vect-loop-manip.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/a421fe9e610b5dbfce1913cd724c8ba193addd47/gcc%2Ftree-vect-loop-manip.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftree-vect-loop-manip.c?ref=a421fe9e610b5dbfce1913cd724c8ba193addd47", "patch": "@@ -2966,9 +2966,7 @@ vect_create_cond_for_alias_checks (loop_vec_info loop_vinfo, tree * cond_expr)\n    *COND_EXPR_STMT_LIST.  */\n \n class loop *\n-vect_loop_versioning (loop_vec_info loop_vinfo,\n-\t\t      unsigned int th, bool check_profitability,\n-\t\t      poly_uint64 versioning_threshold)\n+vect_loop_versioning (loop_vec_info loop_vinfo)\n {\n   class loop *loop = LOOP_VINFO_LOOP (loop_vinfo), *nloop;\n   class loop *scalar_loop = LOOP_VINFO_SCALAR_LOOP (loop_vinfo);\n@@ -2988,10 +2986,15 @@ vect_loop_versioning (loop_vec_info loop_vinfo,\n   bool version_align = LOOP_REQUIRES_VERSIONING_FOR_ALIGNMENT (loop_vinfo);\n   bool version_alias = LOOP_REQUIRES_VERSIONING_FOR_ALIAS (loop_vinfo);\n   bool version_niter = LOOP_REQUIRES_VERSIONING_FOR_NITERS (loop_vinfo);\n+  poly_uint64 versioning_threshold\n+    = LOOP_VINFO_VERSIONING_THRESHOLD (loop_vinfo);\n   tree version_simd_if_cond\n     = LOOP_REQUIRES_VERSIONING_FOR_SIMD_IF_COND (loop_vinfo);\n+  unsigned th = LOOP_VINFO_COST_MODEL_THRESHOLD (loop_vinfo);\n \n-  if (check_profitability)\n+  if (th >= vect_vf_for_cost (loop_vinfo)\n+      && !LOOP_VINFO_NITERS_KNOWN_P (loop_vinfo)\n+      && !ordered_p (th, versioning_threshold))\n     cond_expr = fold_build2 (GE_EXPR, boolean_type_node, scalar_loop_iters,\n \t\t\t     build_int_cst (TREE_TYPE (scalar_loop_iters),\n \t\t\t\t\t    th - 1));"}, {"sha": "cdbf768390233ed8d31b06eeb99463d75793fb91", "filename": "gcc/tree-vect-loop.c", "status": "modified", "additions": 1, "deletions": 11, "changes": 12, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/a421fe9e610b5dbfce1913cd724c8ba193addd47/gcc%2Ftree-vect-loop.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/a421fe9e610b5dbfce1913cd724c8ba193addd47/gcc%2Ftree-vect-loop.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftree-vect-loop.c?ref=a421fe9e610b5dbfce1913cd724c8ba193addd47", "patch": "@@ -8083,18 +8083,8 @@ vect_transform_loop (loop_vec_info loop_vinfo)\n \n   if (LOOP_REQUIRES_VERSIONING (loop_vinfo))\n     {\n-      poly_uint64 versioning_threshold\n-\t= LOOP_VINFO_VERSIONING_THRESHOLD (loop_vinfo);\n-      if (check_profitability\n-\t  && ordered_p (poly_uint64 (th), versioning_threshold))\n-\t{\n-\t  versioning_threshold = ordered_max (poly_uint64 (th),\n-\t\t\t\t\t      versioning_threshold);\n-\t  check_profitability = false;\n-\t}\n       class loop *sloop\n-\t= vect_loop_versioning (loop_vinfo, th, check_profitability,\n-\t\t\t\tversioning_threshold);\n+\t= vect_loop_versioning (loop_vinfo);\n       sloop->force_vectorize = false;\n       check_profitability = false;\n     }"}, {"sha": "ad8be029d7c4c8a5b5d486bf82f7fcb7039337fe", "filename": "gcc/tree-vectorizer.h", "status": "modified", "additions": 1, "deletions": 2, "changes": 3, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/a421fe9e610b5dbfce1913cd724c8ba193addd47/gcc%2Ftree-vectorizer.h", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/a421fe9e610b5dbfce1913cd724c8ba193addd47/gcc%2Ftree-vectorizer.h", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftree-vectorizer.h?ref=a421fe9e610b5dbfce1913cd724c8ba193addd47", "patch": "@@ -1514,8 +1514,7 @@ extern void vect_set_loop_condition (class loop *, loop_vec_info,\n extern bool slpeel_can_duplicate_loop_p (const class loop *, const_edge);\n class loop *slpeel_tree_duplicate_loop_to_edge_cfg (class loop *,\n \t\t\t\t\t\t     class loop *, edge);\n-class loop *vect_loop_versioning (loop_vec_info, unsigned int, bool,\n-\t\t\t\t   poly_uint64);\n+class loop *vect_loop_versioning (loop_vec_info);\n extern class loop *vect_do_peeling (loop_vec_info, tree, tree,\n \t\t\t\t     tree *, tree *, tree *, int, bool, bool);\n extern void vect_prepare_for_masked_peels (loop_vec_info);"}]}