{"sha": "c7046906c3ae131726bd03f7841d4617425685d2", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6YzcwNDY5MDZjM2FlMTMxNzI2YmQwM2Y3ODQxZDQ2MTc0MjU2ODVkMg==", "commit": {"author": {"name": "H.J. Lu", "email": "hongjiu.lu@intel.com", "date": "2012-05-25T11:47:05Z"}, "committer": {"name": "H.J. Lu", "email": "hjl@gcc.gnu.org", "date": "2012-05-25T11:47:05Z"}, "message": "Remove any .comment sections if the first cmp failed\n\n\tPR bootstrap/53472\n\t* contrib/compare-debug (remove_comment): New function.\n\tRemove any .comment sections if the first cmp failed.\n\nFrom-SVN: r187879", "tree": {"sha": "4d4ee045f86eec61fd9efb0e98dc1a19147340df", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/4d4ee045f86eec61fd9efb0e98dc1a19147340df"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/c7046906c3ae131726bd03f7841d4617425685d2", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/c7046906c3ae131726bd03f7841d4617425685d2", "html_url": "https://github.com/Rust-GCC/gccrs/commit/c7046906c3ae131726bd03f7841d4617425685d2", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/c7046906c3ae131726bd03f7841d4617425685d2/comments", "author": {"login": "hjl-tools", "id": 1072356, "node_id": "MDQ6VXNlcjEwNzIzNTY=", "avatar_url": "https://avatars.githubusercontent.com/u/1072356?v=4", "gravatar_id": "", "url": "https://api.github.com/users/hjl-tools", "html_url": "https://github.com/hjl-tools", "followers_url": "https://api.github.com/users/hjl-tools/followers", "following_url": "https://api.github.com/users/hjl-tools/following{/other_user}", "gists_url": "https://api.github.com/users/hjl-tools/gists{/gist_id}", "starred_url": "https://api.github.com/users/hjl-tools/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/hjl-tools/subscriptions", "organizations_url": "https://api.github.com/users/hjl-tools/orgs", "repos_url": "https://api.github.com/users/hjl-tools/repos", "events_url": "https://api.github.com/users/hjl-tools/events{/privacy}", "received_events_url": "https://api.github.com/users/hjl-tools/received_events", "type": "User", "site_admin": false}, "committer": null, "parents": [{"sha": "619a69500d8ef2302cf6b8789ea2aa5553f54f34", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/619a69500d8ef2302cf6b8789ea2aa5553f54f34", "html_url": "https://github.com/Rust-GCC/gccrs/commit/619a69500d8ef2302cf6b8789ea2aa5553f54f34"}], "stats": {"total": 30, "additions": 30, "deletions": 0}, "files": [{"sha": "c1e3499984604d7db87ad94b22001c34fac88f08", "filename": "contrib/ChangeLog", "status": "modified", "additions": 6, "deletions": 0, "changes": 6, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/c7046906c3ae131726bd03f7841d4617425685d2/contrib%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/c7046906c3ae131726bd03f7841d4617425685d2/contrib%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/contrib%2FChangeLog?ref=c7046906c3ae131726bd03f7841d4617425685d2", "patch": "@@ -1,3 +1,9 @@\n+2012-05-25  H.J. Lu  <hongjiu.lu@intel.com>\n+\n+\tPR bootstrap/53472\n+\t* contrib/compare-debug (remove_comment): New function.\n+\tRemove any .comment sections if the first cmp failed.\n+\n 2012-05-09  David Edelsohn  <dje.gcc@gmail.com>\n \n \t* gcc_update: Use $GCC_SVN to retrieve branch and revision."}, {"sha": "fb8986dedfd09a3aec1c57aea81a9040d8e15a9e", "filename": "contrib/compare-debug", "status": "modified", "additions": 24, "deletions": 0, "changes": 24, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/c7046906c3ae131726bd03f7841d4617425685d2/contrib%2Fcompare-debug", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/c7046906c3ae131726bd03f7841d4617425685d2/contrib%2Fcompare-debug", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/contrib%2Fcompare-debug?ref=c7046906c3ae131726bd03f7841d4617425685d2", "patch": "@@ -73,11 +73,35 @@ Darwin)\n   ;;\n esac\n \n+remove_comment ()\n+{\n+  file=$1\n+  opts=\n+  for s in `objdump --section-headers \"$file\" | awk '{ print $2 }'`; do\n+    case \"$s\" in\n+    .comment*)\n+      opts=\"$opts --remove-section $s\"\n+      ;;\n+    esac\n+  done\n+  [ -n \"$opts\" ] && objcopy $opts $file\n+}\n+\n if cmp \"$1.$suf1\" \"$2.$suf2\"; then\n   status=0\n else\n   status=1\n \n+  # Remove any .comment sections.\n+  if (objcopy -v) 2>&1 | grep ' --remove-section' > /dev/null \\\n+     && (objdump --help) 2>&1 | grep ' --\\[*section-\\]*headers' > /dev/null; then\n+    remove_comment \"$1.$suf1\"\n+    remove_comment \"$2.$suf2\"\n+    if cmp \"$1.$suf1\" \"$2.$suf2\"; then\n+      status=0\n+    fi\n+  fi\n+\n   # Assembler-generated CFI will add an .eh_frame section for -g not\n   # present in -g0.  Try to cope with it by checking that an .eh_frame\n   # section is present in either object file, and then stripping it"}]}