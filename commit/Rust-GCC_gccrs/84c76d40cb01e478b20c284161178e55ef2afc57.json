{"sha": "84c76d40cb01e478b20c284161178e55ef2afc57", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6ODRjNzZkNDBjYjAxZTQ3OGIyMGMyODQxNjExNzhlNTVlZjJhZmM1Nw==", "commit": {"author": {"name": "Kazu Hirata", "email": "kazu@codesourcery.com", "date": "2005-06-02T20:21:54Z"}, "committer": {"name": "Kazu Hirata", "email": "kazu@gcc.gnu.org", "date": "2005-06-02T20:21:54Z"}, "message": "gimplify.c (gimplify_ctx): Change the type of case_labels to VEC from VARRAY.\n\n\t* gimplify.c (gimplify_ctx): Change the type of case_labels to\n\tVEC from VARRAY.\n\t(gimplify_switch_expr, gimplify_case_label_expr): Adjust uses\n\tof case_labels.\n\nFrom-SVN: r100513", "tree": {"sha": "38d4b53b1cc72915b75f7dc98649c0a3cb2894b1", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/38d4b53b1cc72915b75f7dc98649c0a3cb2894b1"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/84c76d40cb01e478b20c284161178e55ef2afc57", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/84c76d40cb01e478b20c284161178e55ef2afc57", "html_url": "https://github.com/Rust-GCC/gccrs/commit/84c76d40cb01e478b20c284161178e55ef2afc57", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/84c76d40cb01e478b20c284161178e55ef2afc57/comments", "author": null, "committer": null, "parents": [{"sha": "984dfd8c52a42e3e0ce4838ab77839c4abce4697", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/984dfd8c52a42e3e0ce4838ab77839c4abce4697", "html_url": "https://github.com/Rust-GCC/gccrs/commit/984dfd8c52a42e3e0ce4838ab77839c4abce4697"}], "stats": {"total": 25, "additions": 17, "deletions": 8}, "files": [{"sha": "bf6c5c1e06fbd5536e66bf36bb60048d2dbae056", "filename": "gcc/ChangeLog", "status": "modified", "additions": 7, "deletions": 0, "changes": 7, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/84c76d40cb01e478b20c284161178e55ef2afc57/gcc%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/84c76d40cb01e478b20c284161178e55ef2afc57/gcc%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2FChangeLog?ref=84c76d40cb01e478b20c284161178e55ef2afc57", "patch": "@@ -1,3 +1,10 @@\n+2005-06-02  Kazu Hirata  <kazu@codesourcery.com>\n+\n+\t* gimplify.c (gimplify_ctx): Change the type of case_labels to\n+\tVEC from VARRAY.\n+\t(gimplify_switch_expr, gimplify_case_label_expr): Adjust uses\n+\tof case_labels.\n+\n 2005-06-02  Richard Guenther  <rguenth@gcc.gnu.org>\n \n \t* c-typeck.c (build_indirect_ref): Build INDIRECT_REF"}, {"sha": "c86d9d00af48efc48303cdb77c44f8106276e605", "filename": "gcc/gimplify.c", "status": "modified", "additions": 10, "deletions": 8, "changes": 18, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/84c76d40cb01e478b20c284161178e55ef2afc57/gcc%2Fgimplify.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/84c76d40cb01e478b20c284161178e55ef2afc57/gcc%2Fgimplify.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fgimplify.c?ref=84c76d40cb01e478b20c284161178e55ef2afc57", "patch": "@@ -54,7 +54,7 @@ static struct gimplify_ctx\n   tree conditional_cleanups;\n   tree exit_label;\n   tree return_temp;\n-  varray_type case_labels;\n+  VEC(tree,heap) *case_labels;\n   /* The formal temporary table.  Should this be persistent?  */\n   htab_t temp_htab;\n   int conditions;\n@@ -1138,7 +1138,7 @@ gimplify_switch_expr (tree *expr_p, tree *pre_p)\n \n   if (SWITCH_BODY (switch_expr))\n     {\n-      varray_type labels, saved_labels;\n+      VEC(tree,heap) *labels, *saved_labels;\n       tree label_vec, default_case = NULL_TREE;\n       size_t i, len;\n \n@@ -1147,23 +1147,23 @@ gimplify_switch_expr (tree *expr_p, tree *pre_p)\n       gcc_assert (!SWITCH_LABELS (switch_expr));\n \n       saved_labels = gimplify_ctxp->case_labels;\n-      VARRAY_TREE_INIT (gimplify_ctxp->case_labels, 8, \"case_labels\");\n+      gimplify_ctxp->case_labels = VEC_alloc (tree, heap, 8);\n \n       gimplify_to_stmt_list (&SWITCH_BODY (switch_expr));\n \n       labels = gimplify_ctxp->case_labels;\n       gimplify_ctxp->case_labels = saved_labels;\n \n-      len = VARRAY_ACTIVE_SIZE (labels);\n+      len = VEC_length (tree, labels);\n \n       for (i = 0; i < len; ++i)\n \t{\n-\t  tree t = VARRAY_TREE (labels, i);\n+\t  tree t = VEC_index (tree, labels, i);\n \t  if (!CASE_LOW (t))\n \t    {\n \t      /* The default case must be the last label in the list.  */\n \t      default_case = t;\n-\t      VARRAY_TREE (labels, i) = VARRAY_TREE (labels, len - 1);\n+\t      VEC_replace (tree, labels, i, VEC_index (tree, labels, len - 1));\n \t      len--;\n \t      break;\n \t    }\n@@ -1187,9 +1187,11 @@ gimplify_switch_expr (tree *expr_p, tree *pre_p)\n \t*expr_p = SWITCH_BODY (switch_expr);\n \n       for (i = 0; i < len; ++i)\n-\tTREE_VEC_ELT (label_vec, i) = VARRAY_TREE (labels, i);\n+\tTREE_VEC_ELT (label_vec, i) = VEC_index (tree, labels, i);\n       TREE_VEC_ELT (label_vec, len) = default_case;\n \n+      VEC_free (tree, heap, labels);\n+\n       sort_case_labels (label_vec);\n \n       SWITCH_BODY (switch_expr) = NULL;\n@@ -1206,7 +1208,7 @@ gimplify_case_label_expr (tree *expr_p)\n   tree expr = *expr_p;\n \n   gcc_assert (gimplify_ctxp->case_labels);\n-  VARRAY_PUSH_TREE (gimplify_ctxp->case_labels, expr);\n+  VEC_safe_push (tree, heap, gimplify_ctxp->case_labels, expr);\n   *expr_p = build (LABEL_EXPR, void_type_node, CASE_LABEL (expr));\n   return GS_ALL_DONE;\n }"}]}