{"sha": "3eddc1c9718c6b8264d42cda6e76a3dd9ffc93f0", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6M2VkZGMxYzk3MThjNmI4MjY0ZDQyY2RhNmU3NmEzZGQ5ZmZjOTNmMA==", "commit": {"author": {"name": "Jakub Jelinek", "email": "jakub@redhat.com", "date": "2016-04-13T14:45:46Z"}, "committer": {"name": "Jakub Jelinek", "email": "jakub@gcc.gnu.org", "date": "2016-04-13T14:45:46Z"}, "message": "re PR c++/70594 (-fcompare-debug failure)\n\n\tPR c++/70594\n\t* decl.c (pop_labels_1): Removed.\n\t(note_label, sort_labels): New functions.\n\t(pop_labels): During named_labels traversal, just push the slot\n\tpointers into a vector, then qsort it by DECL_UID and only then\n\tcall pop_label and chain it into BLOCK_VARS.\n\nFrom-SVN: r234942", "tree": {"sha": "b802aeb1353a87fecdf39a536b7332d0ff55e3ff", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/b802aeb1353a87fecdf39a536b7332d0ff55e3ff"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/3eddc1c9718c6b8264d42cda6e76a3dd9ffc93f0", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/3eddc1c9718c6b8264d42cda6e76a3dd9ffc93f0", "html_url": "https://github.com/Rust-GCC/gccrs/commit/3eddc1c9718c6b8264d42cda6e76a3dd9ffc93f0", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/3eddc1c9718c6b8264d42cda6e76a3dd9ffc93f0/comments", "author": {"login": "jakubjelinek", "id": 9370665, "node_id": "MDQ6VXNlcjkzNzA2NjU=", "avatar_url": "https://avatars.githubusercontent.com/u/9370665?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jakubjelinek", "html_url": "https://github.com/jakubjelinek", "followers_url": "https://api.github.com/users/jakubjelinek/followers", "following_url": "https://api.github.com/users/jakubjelinek/following{/other_user}", "gists_url": "https://api.github.com/users/jakubjelinek/gists{/gist_id}", "starred_url": "https://api.github.com/users/jakubjelinek/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jakubjelinek/subscriptions", "organizations_url": "https://api.github.com/users/jakubjelinek/orgs", "repos_url": "https://api.github.com/users/jakubjelinek/repos", "events_url": "https://api.github.com/users/jakubjelinek/events{/privacy}", "received_events_url": "https://api.github.com/users/jakubjelinek/received_events", "type": "User", "site_admin": false}, "committer": null, "parents": [{"sha": "9d4099343ab2eec82ddb4faff48b6e04fed5519c", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/9d4099343ab2eec82ddb4faff48b6e04fed5519c", "html_url": "https://github.com/Rust-GCC/gccrs/commit/9d4099343ab2eec82ddb4faff48b6e04fed5519c"}], "stats": {"total": 67, "additions": 52, "deletions": 15}, "files": [{"sha": "4412994bd57178c22e1f953ad439fb71a78b8303", "filename": "gcc/cp/ChangeLog", "status": "modified", "additions": 9, "deletions": 0, "changes": 9, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/3eddc1c9718c6b8264d42cda6e76a3dd9ffc93f0/gcc%2Fcp%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/3eddc1c9718c6b8264d42cda6e76a3dd9ffc93f0/gcc%2Fcp%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fcp%2FChangeLog?ref=3eddc1c9718c6b8264d42cda6e76a3dd9ffc93f0", "patch": "@@ -1,3 +1,12 @@\n+2016-04-13  Jakub Jelinek  <jakub@redhat.com>\n+\n+\tPR c++/70594\n+\t* decl.c (pop_labels_1): Removed.\n+\t(note_label, sort_labels): New functions.\n+\t(pop_labels): During named_labels traversal, just push the slot\n+\tpointers into a vector, then qsort it by DECL_UID and only then\n+\tcall pop_label and chain it into BLOCK_VARS.\n+\n 2016-04-13  Jason Merrill  <jason@redhat.com>\n \n \tPR c++/70615"}, {"sha": "2ac5c4b1fbf722a1043cc3e048d6dc1432f5c7c9", "filename": "gcc/cp/decl.c", "status": "modified", "additions": 43, "deletions": 15, "changes": 58, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/3eddc1c9718c6b8264d42cda6e76a3dd9ffc93f0/gcc%2Fcp%2Fdecl.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/3eddc1c9718c6b8264d42cda6e76a3dd9ffc93f0/gcc%2Fcp%2Fdecl.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fcp%2Fdecl.c?ref=3eddc1c9718c6b8264d42cda6e76a3dd9ffc93f0", "patch": "@@ -368,33 +368,61 @@ pop_label (tree label, tree old_value)\n   SET_IDENTIFIER_LABEL_VALUE (DECL_NAME (label), old_value);\n }\n \n-/* At the end of a function, all labels declared within the function\n-   go out of scope.  BLOCK is the top-level block for the\n-   function.  */\n+/* Push all named labels into a vector, so that we can sort it on DECL_UID\n+   to avoid code generation differences.  */\n \n int\n-pop_labels_1 (named_label_entry **slot, tree block)\n+note_label (named_label_entry **slot, vec<named_label_entry **> &labels)\n {\n-  struct named_label_entry *ent = *slot;\n-\n-  pop_label (ent->label_decl, NULL_TREE);\n-\n-  /* Put the labels into the \"variables\" of the top-level block,\n-     so debugger can see them.  */\n-  DECL_CHAIN (ent->label_decl) = BLOCK_VARS (block);\n-  BLOCK_VARS (block) = ent->label_decl;\n+  labels.quick_push (slot);\n+  return 1;\n+}\n \n-  named_labels->clear_slot (slot);\n+/* Helper function to sort named label entries in a vector by DECL_UID.  */\n \n-  return 1;\n+static int\n+sort_labels (const void *a, const void *b)\n+{\n+  named_label_entry **slot1 = *(named_label_entry **const *) a;\n+  named_label_entry **slot2 = *(named_label_entry **const *) b;\n+  if (DECL_UID ((*slot1)->label_decl) < DECL_UID ((*slot2)->label_decl))\n+    return -1;\n+  if (DECL_UID ((*slot1)->label_decl) > DECL_UID ((*slot2)->label_decl))\n+    return 1;\n+  return 0;\n }\n \n+/* At the end of a function, all labels declared within the function\n+   go out of scope.  BLOCK is the top-level block for the\n+   function.  */\n+\n static void\n pop_labels (tree block)\n {\n   if (named_labels)\n     {\n-      named_labels->traverse<tree, pop_labels_1> (block);\n+      auto_vec<named_label_entry **, 32> labels;\n+      named_label_entry **slot;\n+      unsigned int i;\n+\n+      /* Push all the labels into a vector and sort them by DECL_UID,\n+\t so that gaps between DECL_UIDs don't affect code generation.  */\n+      labels.reserve_exact (named_labels->elements ());\n+      named_labels->traverse<vec<named_label_entry **> &, note_label> (labels);\n+      labels.qsort (sort_labels);\n+      FOR_EACH_VEC_ELT (labels, i, slot)\n+\t{\n+\t  struct named_label_entry *ent = *slot;\n+\n+\t  pop_label (ent->label_decl, NULL_TREE);\n+\n+\t  /* Put the labels into the \"variables\" of the top-level block,\n+\t     so debugger can see them.  */\n+\t  DECL_CHAIN (ent->label_decl) = BLOCK_VARS (block);\n+\t  BLOCK_VARS (block) = ent->label_decl;\n+\n+\t  named_labels->clear_slot (slot);\n+\t}\n       named_labels = NULL;\n     }\n }"}]}