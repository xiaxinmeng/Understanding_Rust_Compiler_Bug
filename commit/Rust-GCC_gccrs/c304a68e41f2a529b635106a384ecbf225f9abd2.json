{"sha": "c304a68e41f2a529b635106a384ecbf225f9abd2", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6YzMwNGE2OGU0MWYyYTUyOWI2MzUxMDZhMzg0ZWNiZjIyNWY5YWJkMg==", "commit": {"author": {"name": "Jan Hubicka", "email": "jh@suse.cz", "date": "2021-01-02T15:03:41Z"}, "committer": {"name": "Jan Hubicka", "email": "jh@suse.cz", "date": "2021-01-02T15:04:24Z"}, "message": "Free datastructures pointing to CFG after parsing\n\n\t* cp-tree.h (cp_tree_c_finish_parsing): Declare.\n\t* decl2.c (c_parse_final_cleanups): Call cp_tree_c_finish_parsing.\n\t* tree.c (cp_tree_c_finish_parsing): New function.", "tree": {"sha": "68a247480fc5d49c0639faf64698127bf34ff51a", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/68a247480fc5d49c0639faf64698127bf34ff51a"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/c304a68e41f2a529b635106a384ecbf225f9abd2", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/c304a68e41f2a529b635106a384ecbf225f9abd2", "html_url": "https://github.com/Rust-GCC/gccrs/commit/c304a68e41f2a529b635106a384ecbf225f9abd2", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/c304a68e41f2a529b635106a384ecbf225f9abd2/comments", "author": null, "committer": null, "parents": [{"sha": "b6dd195aac170b047fd9633443a448ae94ab14d0", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/b6dd195aac170b047fd9633443a448ae94ab14d0", "html_url": "https://github.com/Rust-GCC/gccrs/commit/b6dd195aac170b047fd9633443a448ae94ab14d0"}], "stats": {"total": 12, "additions": 12, "deletions": 0}, "files": [{"sha": "102f6e1464a6ebcbfec9da413ac9332de6108d50", "filename": "gcc/cp/cp-tree.h", "status": "modified", "additions": 2, "deletions": 0, "changes": 2, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/c304a68e41f2a529b635106a384ecbf225f9abd2/gcc%2Fcp%2Fcp-tree.h", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/c304a68e41f2a529b635106a384ecbf225f9abd2/gcc%2Fcp%2Fcp-tree.h", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fcp%2Fcp-tree.h?ref=c304a68e41f2a529b635106a384ecbf225f9abd2", "patch": "@@ -8238,6 +8238,8 @@ struct uid_sensitive_constexpr_evaluation_checker\n   bool evaluation_restricted_p () const;\n };\n \n+void cp_tree_c_finish_parsing ();\n+\n /* In cp-ubsan.c */\n extern void cp_ubsan_maybe_instrument_member_call (tree);\n extern void cp_ubsan_instrument_member_accesses (tree *);"}, {"sha": "8769ff51be9ebbe009779ab24cf4189b4b25efbd", "filename": "gcc/cp/decl2.c", "status": "modified", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/c304a68e41f2a529b635106a384ecbf225f9abd2/gcc%2Fcp%2Fdecl2.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/c304a68e41f2a529b635106a384ecbf225f9abd2/gcc%2Fcp%2Fdecl2.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fcp%2Fdecl2.c?ref=c304a68e41f2a529b635106a384ecbf225f9abd2", "patch": "@@ -5257,6 +5257,7 @@ c_parse_final_cleanups (void)\n   perform_deferred_noexcept_checks ();\n \n   fini_constexpr ();\n+  cp_tree_c_finish_parsing ();\n   clear_consteval_vfns (consteval_vtables);\n \n   /* The entire file is now complete.  If requested, dump everything"}, {"sha": "e1ad0acb1f97210d153b16aac2e5e11799b6ee48", "filename": "gcc/cp/tree.c", "status": "modified", "additions": 9, "deletions": 0, "changes": 9, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/c304a68e41f2a529b635106a384ecbf225f9abd2/gcc%2Fcp%2Ftree.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/c304a68e41f2a529b635106a384ecbf225f9abd2/gcc%2Fcp%2Ftree.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fcp%2Ftree.c?ref=c304a68e41f2a529b635106a384ecbf225f9abd2", "patch": "@@ -5926,6 +5926,15 @@ maybe_warn_zero_as_null_pointer_constant (tree expr, location_t loc)\n   return false;\n }\n \f\n+/* Release memory we no longer need after parsing.  */\n+void\n+cp_tree_c_finish_parsing ()\n+{\n+  if (previous_class_level)\n+    invalidate_class_lookup_cache ();\n+  deleted_copy_types = NULL;\n+}\n+\f\n #if defined ENABLE_TREE_CHECKING && (GCC_VERSION >= 2007)\n /* Complain that some language-specific thing hanging off a tree\n    node has been accessed improperly.  */"}]}