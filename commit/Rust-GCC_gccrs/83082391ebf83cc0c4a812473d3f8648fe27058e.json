{"sha": "83082391ebf83cc0c4a812473d3f8648fe27058e", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6ODMwODIzOTFlYmY4M2NjMGM0YTgxMjQ3M2QzZjg2NDhmZTI3MDU4ZQ==", "commit": {"author": {"name": "Catherine Moore", "email": "clm@codesourcery.com", "date": "2013-04-24T13:16:33Z"}, "committer": {"name": "Catherine Moore", "email": "clm@gcc.gnu.org", "date": "2013-04-24T13:16:33Z"}, "message": "micromips.md (jraddiusp): New pattern.\n\n2013-04-02  Catherine Moore  <clm@codesourcery.com>\n\t    Chao-ying Fu <fu@mips.com>\n\n        * config/mips/micromips.md (jraddiusp): New pattern.\n        * config/mips/mips.c (mips_expand_epilogue): Use the JRADDIUSP\n        instruction if possible.\n\n\nCo-Authored-By: Chao-ying Fu <fu@mips.com>\n\nFrom-SVN: r198228", "tree": {"sha": "dffb3dca090b1f4471bb458fc9b63efe14413258", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/dffb3dca090b1f4471bb458fc9b63efe14413258"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/83082391ebf83cc0c4a812473d3f8648fe27058e", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/83082391ebf83cc0c4a812473d3f8648fe27058e", "html_url": "https://github.com/Rust-GCC/gccrs/commit/83082391ebf83cc0c4a812473d3f8648fe27058e", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/83082391ebf83cc0c4a812473d3f8648fe27058e/comments", "author": {"login": "CatherineMoore", "id": 15636327, "node_id": "MDQ6VXNlcjE1NjM2MzI3", "avatar_url": "https://avatars.githubusercontent.com/u/15636327?v=4", "gravatar_id": "", "url": "https://api.github.com/users/CatherineMoore", "html_url": "https://github.com/CatherineMoore", "followers_url": "https://api.github.com/users/CatherineMoore/followers", "following_url": "https://api.github.com/users/CatherineMoore/following{/other_user}", "gists_url": "https://api.github.com/users/CatherineMoore/gists{/gist_id}", "starred_url": "https://api.github.com/users/CatherineMoore/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/CatherineMoore/subscriptions", "organizations_url": "https://api.github.com/users/CatherineMoore/orgs", "repos_url": "https://api.github.com/users/CatherineMoore/repos", "events_url": "https://api.github.com/users/CatherineMoore/events{/privacy}", "received_events_url": "https://api.github.com/users/CatherineMoore/received_events", "type": "User", "site_admin": false}, "committer": null, "parents": [{"sha": "5afe5d2d4485638a63fa23f456eb6942f2e5bd38", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/5afe5d2d4485638a63fa23f456eb6942f2e5bd38", "html_url": "https://github.com/Rust-GCC/gccrs/commit/5afe5d2d4485638a63fa23f456eb6942f2e5bd38"}], "stats": {"total": 34, "additions": 33, "deletions": 1}, "files": [{"sha": "8a153c9f761ea8d781be2cba6e463a74b55953dc", "filename": "gcc/ChangeLog", "status": "modified", "additions": 7, "deletions": 0, "changes": 7, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/83082391ebf83cc0c4a812473d3f8648fe27058e/gcc%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/83082391ebf83cc0c4a812473d3f8648fe27058e/gcc%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2FChangeLog?ref=83082391ebf83cc0c4a812473d3f8648fe27058e", "patch": "@@ -1,3 +1,10 @@\n+2013-04-02  Catherine Moore  <clm@codesourcery.com>\n+\t    Chao-ying Fu <fu@mips.com>\n+\n+        * config/mips/micromips.md (jraddiusp): New pattern.\n+        * config/mips/mips.c (mips_expand_epilogue): Use the JRADDIUSP\n+        instruction if possible.\n+\n 2013-04-24  Alan Modra  <amodra@gmail.com>\n \n \t* config/rs6000/driver-rs6000.c (elf_dcachebsize): Fix comment pasto."}, {"sha": "95af62718c08b7b37c1c07774d686aef3d510110", "filename": "gcc/config/mips/micromips.md", "status": "modified", "additions": 13, "deletions": 0, "changes": 13, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/83082391ebf83cc0c4a812473d3f8648fe27058e/gcc%2Fconfig%2Fmips%2Fmicromips.md", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/83082391ebf83cc0c4a812473d3f8648fe27058e/gcc%2Fconfig%2Fmips%2Fmicromips.md", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fconfig%2Fmips%2Fmicromips.md?ref=83082391ebf83cc0c4a812473d3f8648fe27058e", "patch": "@@ -95,6 +95,19 @@\n    (set_attr \"mode\" \"SI\")\n    (set_attr \"can_delay\" \"no\")])\n \n+;; For JRADDIUSP.\n+(define_insn \"jraddiusp\"\n+  [(parallel [(return)\n+\t      (use (reg:SI 31))\n+\t      (set (reg:SI 29)\n+\t\t   (plus:SI (reg:SI 29)\n+\t\t\t    (match_operand 0 \"uw5_operand\")))])]\n+  \"TARGET_MICROMIPS\"\n+  \"jraddiusp\\t%0\"\n+  [(set_attr \"type\"\t\"trap\")\n+   (set_attr \"can_delay\" \"no\")\n+   (set_attr \"mode\"\t\"SI\")])\n+\n ;; For MOVEP.\n (define_peephole2\n   [(set (match_operand:MOVEP1 0 \"register_operand\" \"\")"}, {"sha": "7545b6043f40f724cee5c805c2cb19e3e0d7f065", "filename": "gcc/config/mips/mips.c", "status": "modified", "additions": 13, "deletions": 1, "changes": 14, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/83082391ebf83cc0c4a812473d3f8648fe27058e/gcc%2Fconfig%2Fmips%2Fmips.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/83082391ebf83cc0c4a812473d3f8648fe27058e/gcc%2Fconfig%2Fmips%2Fmips.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fconfig%2Fmips%2Fmips.c?ref=83082391ebf83cc0c4a812473d3f8648fe27058e", "patch": "@@ -11414,6 +11414,7 @@ mips_expand_epilogue (bool sibcall_p)\n   const struct mips_frame_info *frame;\n   HOST_WIDE_INT step1, step2;\n   rtx base, adjust, insn;\n+  bool use_jraddiusp_p = false;\n \n   if (!sibcall_p && mips_can_use_return_insn ())\n     {\n@@ -11541,12 +11542,19 @@ mips_expand_epilogue (bool sibcall_p)\n \t  emit_insn (gen_cop0_move (gen_rtx_REG (SImode, COP0_STATUS_REG_NUM),\n \t\t\t\t    gen_rtx_REG (SImode, K0_REG_NUM)));\n \t}\n+      else if (TARGET_MICROMIPS\n+\t       && !crtl->calls_eh_return\n+\t       && !sibcall_p\n+\t       && step2 > 0\n+\t       && mips_unsigned_immediate_p (step2, 5, 2))\n+\tuse_jraddiusp_p = true;\n       else\n \t/* Deallocate the final bit of the frame.  */\n \tmips_deallocate_stack (stack_pointer_rtx, GEN_INT (step2), 0);\n     }\n \n-  gcc_assert (!mips_epilogue.cfa_restores);\n+  if (!use_jraddiusp_p)\n+    gcc_assert (!mips_epilogue.cfa_restores);\n \n   /* Add in the __builtin_eh_return stack adjustment.  We need to\n      use a temporary in MIPS16 code.  */\n@@ -11596,12 +11604,16 @@ mips_expand_epilogue (bool sibcall_p)\n \t      rtx reg = gen_rtx_REG (Pmode, GP_REG_FIRST + 7);\n \t      pat = gen_return_internal (reg);\n \t    }\n+\t  else if (use_jraddiusp_p)\n+\t    pat = gen_jraddiusp (GEN_INT (step2));\n \t  else\n \t    {\n \t      rtx reg = gen_rtx_REG (Pmode, RETURN_ADDR_REGNUM);\n \t      pat = gen_simple_return_internal (reg);\n \t    }\n \t  emit_jump_insn (pat);\n+\t  if (use_jraddiusp_p)\n+\t    mips_epilogue_set_cfa (stack_pointer_rtx, step2);\n \t}\n     }\n "}]}