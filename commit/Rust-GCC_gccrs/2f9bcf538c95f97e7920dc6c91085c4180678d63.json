{"sha": "2f9bcf538c95f97e7920dc6c91085c4180678d63", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6MmY5YmNmNTM4Yzk1Zjk3ZTc5MjBkYzZjOTEwODVjNDE4MDY3OGQ2Mw==", "commit": {"author": {"name": "Cesar Philippidis", "email": "cesar@codesourcery.com", "date": "2015-12-02T19:59:27Z"}, "committer": {"name": "Cesar Philippidis", "email": "cesar@gcc.gnu.org", "date": "2015-12-02T19:59:27Z"}, "message": "re PR fortran/63861 (OpenACC coarray ICE  (also with OpenMP?))\n\n\tgcc/fortran/\n\tPR fortran/63861\n\t* openmp.c (gfc_match_omp_clauses): Allow subarrays for acc reductions.\n\t(resolve_omp_clauses): Error on any acc reductions on arrays.\n\n\tgcc/testsuite/\n\t* gfortran.dg/goacc/array-reduction.f90: New test.\n\t* gfortran.dg/goacc/assumed.f95: Update expected diagnostics.\n\t* gfortran.dg/goacc/coarray.f95: Likewise.\n\t* gfortran.dg/goacc/coarray_2.f90: Likewise.\n\t* gfortran.dg/goacc/reduction-2.f95: Likewise.\n\t* gfortran.dg/goacc/reduction.f95: Likewise.\n\nFrom-SVN: r231204", "tree": {"sha": "36c3f7c349c45914575bc3fab67cd3e384765a5b", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/36c3f7c349c45914575bc3fab67cd3e384765a5b"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/2f9bcf538c95f97e7920dc6c91085c4180678d63", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/2f9bcf538c95f97e7920dc6c91085c4180678d63", "html_url": "https://github.com/Rust-GCC/gccrs/commit/2f9bcf538c95f97e7920dc6c91085c4180678d63", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/2f9bcf538c95f97e7920dc6c91085c4180678d63/comments", "author": {"login": "cesarjp", "id": 4576177, "node_id": "MDQ6VXNlcjQ1NzYxNzc=", "avatar_url": "https://avatars.githubusercontent.com/u/4576177?v=4", "gravatar_id": "", "url": "https://api.github.com/users/cesarjp", "html_url": "https://github.com/cesarjp", "followers_url": "https://api.github.com/users/cesarjp/followers", "following_url": "https://api.github.com/users/cesarjp/following{/other_user}", "gists_url": "https://api.github.com/users/cesarjp/gists{/gist_id}", "starred_url": "https://api.github.com/users/cesarjp/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/cesarjp/subscriptions", "organizations_url": "https://api.github.com/users/cesarjp/orgs", "repos_url": "https://api.github.com/users/cesarjp/repos", "events_url": "https://api.github.com/users/cesarjp/events{/privacy}", "received_events_url": "https://api.github.com/users/cesarjp/received_events", "type": "User", "site_admin": false}, "committer": null, "parents": [{"sha": "e7fc41a776a1e85fd052fc84184618768274a1af", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/e7fc41a776a1e85fd052fc84184618768274a1af", "html_url": "https://github.com/Rust-GCC/gccrs/commit/e7fc41a776a1e85fd052fc84184618768274a1af"}], "stats": {"total": 138, "additions": 128, "deletions": 10}, "files": [{"sha": "40c8de6bad0128d47e7221b82082ec4794250866", "filename": "gcc/fortran/ChangeLog", "status": "modified", "additions": 6, "deletions": 0, "changes": 6, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/2f9bcf538c95f97e7920dc6c91085c4180678d63/gcc%2Ffortran%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/2f9bcf538c95f97e7920dc6c91085c4180678d63/gcc%2Ffortran%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ffortran%2FChangeLog?ref=2f9bcf538c95f97e7920dc6c91085c4180678d63", "patch": "@@ -1,3 +1,9 @@\n+2015-12-02  Cesar Philippidis  <cesar@codesourcery.com>\n+\n+\tPR fortran/63861\n+\t* openmp.c (gfc_match_omp_clauses): Allow subarrays for acc reductions.\n+\t(resolve_omp_clauses): Error on any acc reductions on arrays.\n+\n 2015-12-01  Cesar Philippidis  <cesar@codesourcery.com>\n \n \t* dump-parse-tree.c (show_omp_clauses): Handle optional num and static"}, {"sha": "276f2f13fa1b8706824e04b8f8875ba7c86b5413", "filename": "gcc/fortran/openmp.c", "status": "modified", "additions": 7, "deletions": 1, "changes": 8, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/2f9bcf538c95f97e7920dc6c91085c4180678d63/gcc%2Ffortran%2Fopenmp.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/2f9bcf538c95f97e7920dc6c91085c4180678d63/gcc%2Ffortran%2Fopenmp.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ffortran%2Fopenmp.c?ref=2f9bcf538c95f97e7920dc6c91085c4180678d63", "patch": "@@ -978,7 +978,8 @@ gfc_match_omp_clauses (gfc_omp_clauses **cp, uint64_t mask,\n \n \t  if (gfc_match_omp_variable_list (\" :\",\n \t\t\t\t\t   &c->lists[OMP_LIST_REDUCTION],\n-\t\t\t\t\t   false, NULL, &head) == MATCH_YES)\n+\t\t\t\t\t   false, NULL, &head, openacc)\n+\t      == MATCH_YES)\n \t    {\n \t      gfc_omp_namelist *n;\n \t      if (rop == OMP_REDUCTION_NONE)\n@@ -3313,6 +3314,11 @@ resolve_omp_clauses (gfc_code *code, gfc_omp_clauses *omp_clauses,\n \t\t       n->sym->name, &n->where);\n \t  else\n \t    n->sym->mark = 1;\n+\n+\t  /* OpenACC does not support reductions on arrays.  */\n+\t  if (n->sym->as)\n+\t    gfc_error (\"Array %qs is not permitted in reduction at %L\",\n+\t\t       n->sym->name, &n->where);\n \t}\n     }\n   "}, {"sha": "3db74dc2d5da28894f8edb9f3759535be639437c", "filename": "gcc/testsuite/ChangeLog", "status": "modified", "additions": 10, "deletions": 0, "changes": 10, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/2f9bcf538c95f97e7920dc6c91085c4180678d63/gcc%2Ftestsuite%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/2f9bcf538c95f97e7920dc6c91085c4180678d63/gcc%2Ftestsuite%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2FChangeLog?ref=2f9bcf538c95f97e7920dc6c91085c4180678d63", "patch": "@@ -1,3 +1,13 @@\n+2015-12-02  Cesar Philippidis  <cesar@codesourcery.com>\n+\n+\tPR fortran/63861\n+\t* gfortran.dg/goacc/array-reduction.f90: New test.\n+\t* gfortran.dg/goacc/assumed.f95: Update expected diagnostics.\n+\t* gfortran.dg/goacc/coarray.f95: Likewise.\n+\t* gfortran.dg/goacc/coarray_2.f90: Likewise.\n+\t* gfortran.dg/goacc/reduction-2.f95: Likewise.\n+\t* gfortran.dg/goacc/reduction.f95: Likewise.\n+\n 2015-12-02  Jakub Jelinek  <jakub@redhat.com>\n \n \tPR target/68647"}, {"sha": "d71c400a5bf1d92de992f04b3844aa0f8daf4d97", "filename": "gcc/testsuite/gfortran.dg/goacc/array-reduction.f90", "status": "added", "additions": 74, "deletions": 0, "changes": 74, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/2f9bcf538c95f97e7920dc6c91085c4180678d63/gcc%2Ftestsuite%2Fgfortran.dg%2Fgoacc%2Farray-reduction.f90", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/2f9bcf538c95f97e7920dc6c91085c4180678d63/gcc%2Ftestsuite%2Fgfortran.dg%2Fgoacc%2Farray-reduction.f90", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgfortran.dg%2Fgoacc%2Farray-reduction.f90?ref=2f9bcf538c95f97e7920dc6c91085c4180678d63", "patch": "@@ -0,0 +1,74 @@\n+program test\n+  implicit none\n+  integer a(10), i\n+\n+  a(:) = 0\n+  \n+  ! Array reductions.\n+  \n+  !$acc parallel reduction (+:a) ! { dg-error \"Array 'a' is not permitted in reduction\" }\n+  do i = 1, 10\n+     a = a + 1\n+  end do\n+  !$acc end parallel\n+\n+  !$acc parallel\n+  !$acc loop reduction (+:a) ! { dg-error \"Array 'a' is not permitted in reduction\" }\n+  do i = 1, 10\n+     a = a + 1\n+  end do\n+  !$acc end parallel\n+\n+  !$acc kernels\n+  !$acc loop reduction (+:a) ! { dg-error \"Array 'a' is not permitted in reduction\" }\n+  do i = 1, 10\n+     a = a + 1\n+  end do\n+  !$acc end kernels\n+\n+  ! Subarray reductions.\n+  \n+  !$acc parallel reduction (+:a(1:5)) ! { dg-error \"Array 'a' is not permitted in reduction\" }\n+  do i = 1, 10\n+     a = a + 1\n+  end do\n+  !$acc end parallel\n+\n+  !$acc parallel\n+  !$acc loop reduction (+:a(1:5)) ! { dg-error \"Array 'a' is not permitted in reduction\" }\n+  do i = 1, 10\n+     a = a + 1\n+  end do\n+  !$acc end parallel\n+\n+  !$acc kernels\n+  !$acc loop reduction (+:a(1:5)) ! { dg-error \"Array 'a' is not permitted in reduction\" }\n+  do i = 1, 10\n+     a = a + 1\n+  end do\n+  !$acc end kernels\n+\n+  ! Reductions on array elements.\n+  \n+  !$acc parallel reduction (+:a(1)) ! { dg-error \"Array 'a' is not permitted in reduction\" }\n+  do i = 1, 10\n+     a(1) = a(1) + 1\n+  end do\n+  !$acc end parallel\n+\n+  !$acc parallel\n+  !$acc loop reduction (+:a(1)) ! { dg-error \"Array 'a' is not permitted in reduction\" }\n+  do i = 1, 10\n+     a(1) = a(1) + 1\n+  end do\n+  !$acc end parallel\n+\n+  !$acc kernels\n+  !$acc loop reduction (+:a(1)) ! { dg-error \"Array 'a' is not permitted in reduction\" }\n+  do i = 1, 10\n+     a(1) = a(1) + 1\n+  end do\n+  !$acc end kernels\n+  \n+  print *, a\n+end program test"}, {"sha": "4efe5a2b06ec3afcbab831a5cfce5bce6d4f5852", "filename": "gcc/testsuite/gfortran.dg/goacc/assumed.f95", "status": "modified", "additions": 3, "deletions": 0, "changes": 3, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/2f9bcf538c95f97e7920dc6c91085c4180678d63/gcc%2Ftestsuite%2Fgfortran.dg%2Fgoacc%2Fassumed.f95", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/2f9bcf538c95f97e7920dc6c91085c4180678d63/gcc%2Ftestsuite%2Fgfortran.dg%2Fgoacc%2Fassumed.f95", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgfortran.dg%2Fgoacc%2Fassumed.f95?ref=2f9bcf538c95f97e7920dc6c91085c4180678d63", "patch": "@@ -45,3 +45,6 @@ subroutine assumed_rank(a)\n     !$acc update self (a) ! { dg-error \"Assumed rank\" }\n   end subroutine assumed_rank\n end module test\n+\n+! { dg-error \"Array 'a' is not permitted in reduction\" \"\" { target \"*-*-*\" } 18 }\n+! { dg-error \"Array 'a' is not permitted in reduction\" \"\" { target \"*-*-*\" } 39 }"}, {"sha": "932e1f7fd0d324fef51934a5cf7180329c7733f3", "filename": "gcc/testsuite/gfortran.dg/goacc/coarray.f95", "status": "modified", "additions": 1, "deletions": 3, "changes": 4, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/2f9bcf538c95f97e7920dc6c91085c4180678d63/gcc%2Ftestsuite%2Fgfortran.dg%2Fgoacc%2Fcoarray.f95", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/2f9bcf538c95f97e7920dc6c91085c4180678d63/gcc%2Ftestsuite%2Fgfortran.dg%2Fgoacc%2Fcoarray.f95", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgfortran.dg%2Fgoacc%2Fcoarray.f95?ref=2f9bcf538c95f97e7920dc6c91085c4180678d63", "patch": "@@ -2,8 +2,6 @@\n ! { dg-additional-options \"-fcoarray=single\" }\n !\n ! PR fortran/63861\n-! { dg-xfail-if \"<http://gcc.gnu.org/PR63861>\" { *-*-* } }\n-! { dg-excess-errors \"TODO\" }\n \n module test\n contains\n@@ -20,7 +18,7 @@ subroutine oacc1(a)\n     !$acc end parallel\n     !$acc host_data use_device (a)\n     !$acc end host_data\n-    !$acc parallel loop reduction(+:a)\n+    !$acc parallel loop reduction(+:a) ! { dg-error \"Array 'a' is not permitted in reduction\" }\n     do i = 1,5\n     enddo\n     !$acc end parallel loop"}, {"sha": "05167a18af1eb26cf0f8ae082daa2da1215e3442", "filename": "gcc/testsuite/gfortran.dg/goacc/coarray_2.f90", "status": "modified", "additions": 3, "deletions": 5, "changes": 8, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/2f9bcf538c95f97e7920dc6c91085c4180678d63/gcc%2Ftestsuite%2Fgfortran.dg%2Fgoacc%2Fcoarray_2.f90", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/2f9bcf538c95f97e7920dc6c91085c4180678d63/gcc%2Ftestsuite%2Fgfortran.dg%2Fgoacc%2Fcoarray_2.f90", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgfortran.dg%2Fgoacc%2Fcoarray_2.f90?ref=2f9bcf538c95f97e7920dc6c91085c4180678d63", "patch": "@@ -2,8 +2,6 @@\n ! { dg-additional-options \"-fcoarray=lib\" }\n !\n ! PR fortran/63861\n-! { dg-xfail-if \"<http://gcc.gnu.org/PR63861>\" { *-*-* } }\n-! { dg-excess-errors \"TODO\" }\n \n module test\n contains\n@@ -20,7 +18,7 @@ subroutine oacc1(a)\n     !$acc end parallel\n     !$acc host_data use_device (a)\n     !$acc end host_data\n-    !$acc parallel loop reduction(+:a)\n+    !$acc parallel loop reduction(+:a) ! { dg-error \"Array 'a' is not permitted in reduction\" }\n     do i = 1,5\n     enddo\n     !$acc end parallel loop\n@@ -72,7 +70,7 @@ subroutine oacc3(a)\n     !$acc end parallel\n     !$acc host_data use_device (a)\n     !$acc end host_data\n-    !$acc parallel loop reduction(+:a)\n+    !$acc parallel loop reduction(+:a) ! { dg-error \"Array 'a' is not permitted in reduction\" }\n     do i = 1,5\n     enddo\n     !$acc end parallel loop\n@@ -94,7 +92,7 @@ subroutine oacc4(a)\n     !$acc end data\n     !$acc parallel private (a)\n     !$acc end parallel\n-    !$acc parallel loop reduction(+:a)\n+    !$acc parallel loop reduction(+:a) ! { dg-error \"Array 'a' is not permitted in reduction\" }\n     do i = 1,5\n     enddo\n     !$acc end parallel loop"}, {"sha": "929fb0e81e996f6e7fc8870d7d17646e8f5fcf23", "filename": "gcc/testsuite/gfortran.dg/goacc/reduction-2.f95", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/2f9bcf538c95f97e7920dc6c91085c4180678d63/gcc%2Ftestsuite%2Fgfortran.dg%2Fgoacc%2Freduction-2.f95", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/2f9bcf538c95f97e7920dc6c91085c4180678d63/gcc%2Ftestsuite%2Fgfortran.dg%2Fgoacc%2Freduction-2.f95", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgfortran.dg%2Fgoacc%2Freduction-2.f95?ref=2f9bcf538c95f97e7920dc6c91085c4180678d63", "patch": "@@ -17,6 +17,6 @@ subroutine foo ()\n \n ! { dg-final { scan-tree-dump-times \"target oacc_parallel firstprivate.a.\" 1 \"gimple\" } }\n ! { dg-final { scan-tree-dump-times \"acc loop private.p. reduction..:a.\" 1 \"gimple\" } }\n-! { dg-final { scan-tree-dump-times \"target oacc_kernels map.tofrom:a .len: 4..\" 1 \"gimple\" } }\n+! { dg-final { scan-tree-dump-times \"target oacc_kernels map.force_tofrom:a .len: 4..\" 1 \"gimple\" } }\n ! { dg-final { scan-tree-dump-times \"acc loop private.k. reduction..:a.\" 1 \"gimple\" } }\n "}, {"sha": "a13574b150c715f7c7b7cebebb7835b055a66b60", "filename": "gcc/testsuite/gfortran.dg/goacc/reduction.f95", "status": "modified", "additions": 23, "deletions": 0, "changes": 23, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/2f9bcf538c95f97e7920dc6c91085c4180678d63/gcc%2Ftestsuite%2Fgfortran.dg%2Fgoacc%2Freduction.f95", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/2f9bcf538c95f97e7920dc6c91085c4180678d63/gcc%2Ftestsuite%2Fgfortran.dg%2Fgoacc%2Freduction.f95", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgfortran.dg%2Fgoacc%2Freduction.f95?ref=2f9bcf538c95f97e7920dc6c91085c4180678d63", "patch": "@@ -136,3 +136,26 @@ subroutine foo (ia1)\n !$acc end parallel\n \n end subroutine\n+\n+! { dg-error \"Array 'ia2' is not permitted in reduction\" \"\" { target \"*-*-*\" } 27 }\n+! { dg-error \"Array 'ra1' is not permitted in reduction\" \"\" { target \"*-*-*\" } 29 }\n+! { dg-error \"Array 'ca1' is not permitted in reduction\" \"\" { target \"*-*-*\" } 31 }\n+! { dg-error \"Array 'da1' is not permitted in reduction\" \"\" { target \"*-*-*\" } 33 }\n+! { dg-error \"Array 'la1' is not permitted in reduction\" \"\" { target \"*-*-*\" } 35 }\n+! { dg-error \"Array 'aa1' is not permitted in reduction\" \"\" { target \"*-*-*\" } 65 }\n+! { dg-error \"Array 'ia1' is not permitted in reduction\" \"\" { target \"*-*-*\" } 67 }\n+! { dg-error \"Array 'la1' is not permitted in reduction\" \"\" { target \"*-*-*\" } 71 }\n+! { dg-error \"Array 'ta1' is not permitted in reduction\" \"\" { target \"*-*-*\" } 77 }\n+! { dg-error \"Array 'ia2' is not permitted in reduction\" \"\" { target \"*-*-*\" } 81 }\n+! { dg-error \"Array 'ra1' is not permitted in reduction\" \"\" { target \"*-*-*\" } 85 }\n+! { dg-error \"Array 'da1' is not permitted in reduction\" \"\" { target \"*-*-*\" } 89 }\n+! { dg-error \"Array 'ca1' is not permitted in reduction\" \"\" { target \"*-*-*\" } 93 }\n+! { dg-error \"Array 'ta1' is not permitted in reduction\" \"\" { target \"*-*-*\" } 99 }\n+! { dg-error \"Array 'ca1' is not permitted in reduction\" \"\" { target \"*-*-*\" } 103 }\n+! { dg-error \"Array 'la1' is not permitted in reduction\" \"\" { target \"*-*-*\" } 107 }\n+! { dg-error \"Array 'ta1' is not permitted in reduction\" \"\" { target \"*-*-*\" } 113 }\n+! { dg-error \"Array 'ra1' is not permitted in reduction\" \"\" { target \"*-*-*\" } 117 }\n+! { dg-error \"Array 'da1' is not permitted in reduction\" \"\" { target \"*-*-*\" } 121 }\n+! { dg-error \"Array 'ca1' is not permitted in reduction\" \"\" { target \"*-*-*\" } 125 }\n+! { dg-error \"Array 'la1' is not permitted in reduction\" \"\" { target \"*-*-*\" } 129 }\n+! { dg-error \"Array 'ta1' is not permitted in reduction\" \"\" { target \"*-*-*\" } 135 }"}]}