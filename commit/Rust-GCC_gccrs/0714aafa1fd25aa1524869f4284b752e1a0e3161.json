{"sha": "0714aafa1fd25aa1524869f4284b752e1a0e3161", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6MDcxNGFhZmExZmQyNWFhMTUyNDg2OWY0Mjg0Yjc1MmUxYTBlMzE2MQ==", "commit": {"author": {"name": "Bob Duff", "email": "duff@adacore.com", "date": "2009-09-17T10:58:39Z"}, "committer": {"name": "Arnaud Charlet", "email": "charlet@gcc.gnu.org", "date": "2009-09-17T10:58:39Z"}, "message": "g-socket.ads: Document the fact that Close_Selector has no effect on a closed selector.\n\n2009-09-17  Bob Duff  <duff@adacore.com>\n\n\t* g-socket.ads: Document the fact that Close_Selector has no effect on\n\ta closed selector.\n\t* g-socket.adb: Raise an exception when a Selector that should be open\n\tis closed.\n\t(Check_Selector): Declare RSig as a constant rather than a renames,\n\tless confusing.\n\nFrom-SVN: r151798", "tree": {"sha": "3d9d7c3ec8096deb2b799c9a49cf0de08d755268", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/3d9d7c3ec8096deb2b799c9a49cf0de08d755268"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/0714aafa1fd25aa1524869f4284b752e1a0e3161", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/0714aafa1fd25aa1524869f4284b752e1a0e3161", "html_url": "https://github.com/Rust-GCC/gccrs/commit/0714aafa1fd25aa1524869f4284b752e1a0e3161", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/0714aafa1fd25aa1524869f4284b752e1a0e3161/comments", "author": {"login": "bobduff", "id": 29099567, "node_id": "MDQ6VXNlcjI5MDk5NTY3", "avatar_url": "https://avatars.githubusercontent.com/u/29099567?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bobduff", "html_url": "https://github.com/bobduff", "followers_url": "https://api.github.com/users/bobduff/followers", "following_url": "https://api.github.com/users/bobduff/following{/other_user}", "gists_url": "https://api.github.com/users/bobduff/gists{/gist_id}", "starred_url": "https://api.github.com/users/bobduff/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bobduff/subscriptions", "organizations_url": "https://api.github.com/users/bobduff/orgs", "repos_url": "https://api.github.com/users/bobduff/repos", "events_url": "https://api.github.com/users/bobduff/events{/privacy}", "received_events_url": "https://api.github.com/users/bobduff/received_events", "type": "User", "site_admin": false}, "committer": null, "parents": [{"sha": "67efd80a55c73d61886faef705142de8f31bedae", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/67efd80a55c73d61886faef705142de8f31bedae", "html_url": "https://github.com/Rust-GCC/gccrs/commit/67efd80a55c73d61886faef705142de8f31bedae"}], "stats": {"total": 56, "additions": 53, "deletions": 3}, "files": [{"sha": "1e4d3db4f9530772025e5916f6edaa1ae52d1a85", "filename": "gcc/ada/ChangeLog", "status": "modified", "additions": 11, "deletions": 1, "changes": 12, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/0714aafa1fd25aa1524869f4284b752e1a0e3161/gcc%2Fada%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/0714aafa1fd25aa1524869f4284b752e1a0e3161/gcc%2Fada%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fada%2FChangeLog?ref=0714aafa1fd25aa1524869f4284b752e1a0e3161", "patch": "@@ -1,7 +1,17 @@\n+2009-09-17  Bob Duff  <duff@adacore.com>\n+\n+\t* g-socket.ads: Document the fact that Close_Selector has no effect on\n+\ta closed selector.\n+\t* g-socket.adb: Raise an exception when a Selector that should be open\n+\tis closed.\n+\t(Check_Selector): Declare RSig as a constant rather than a renames,\n+\tless confusing.\n+\n 2009-09-17  Robert Dewar  <dewar@adacore.com>\n \n \t* exp_ch9.adb, exp_ch5.adb, exp_ch4.adb, prj-conf.adb, prj-env.ads,\n-\tprj-ext.adb: Minor reformatting\n+\tprj-ext.adb, prj-ext.ads, prj-pars.adb, prj-part.adb, prj-proc.adb,\n+\tprj-tree.ads: Minor reformatting\n \n 2009-09-17  Emmanuel Briot  <briot@adacore.com>\n "}, {"sha": "8afde3beec3cb90a070d4851edbb4a853c56c253", "filename": "gcc/ada/g-socket.adb", "status": "modified", "additions": 40, "deletions": 1, "changes": 41, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/0714aafa1fd25aa1524869f4284b752e1a0e3161/gcc%2Fada%2Fg-socket.adb", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/0714aafa1fd25aa1524869f4284b752e1a0e3161/gcc%2Fada%2Fg-socket.adb", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fada%2Fg-socket.adb?ref=0714aafa1fd25aa1524869f4284b752e1a0e3161", "patch": "@@ -282,6 +282,12 @@ package body GNAT.Sockets is\n       Res : C.int;\n \n    begin\n+      if Selector.R_Sig_Socket = No_Socket\n+        or else Selector.W_Sig_Socket = No_Socket\n+      then\n+         raise Program_Error with \"closed selector\";\n+      end if;\n+\n       --  Send one byte to unblock select system call\n \n       Res := Signalling_Fds.Write (C.int (Selector.W_Sig_Socket));\n@@ -330,6 +336,14 @@ package body GNAT.Sockets is\n       Status   : out Selector_Status)\n    is\n    begin\n+      if Selector /= null\n+        and then (Selector.R_Sig_Socket = No_Socket\n+                    or else\n+                  Selector.W_Sig_Socket = No_Socket)\n+      then\n+         raise Program_Error with \"closed selector\";\n+      end if;\n+\n       --  Wait for socket to become available for reading\n \n       Wait_On_Socket\n@@ -473,11 +487,17 @@ package body GNAT.Sockets is\n    is\n       Res  : C.int;\n       Last : C.int;\n-      RSig : Socket_Type renames Selector.R_Sig_Socket;\n+      RSig : constant Socket_Type := Selector.R_Sig_Socket;\n       TVal : aliased Timeval;\n       TPtr : Timeval_Access;\n \n    begin\n+      if Selector.R_Sig_Socket = No_Socket\n+        or else Selector.W_Sig_Socket = No_Socket\n+      then\n+         raise Program_Error with \"closed selector\";\n+      end if;\n+\n       Status := Completed;\n \n       --  No timeout or Forever is indicated by a null timeval pointer\n@@ -563,6 +583,12 @@ package body GNAT.Sockets is\n \n    procedure Close_Selector (Selector : in out Selector_Type) is\n    begin\n+      if Selector.R_Sig_Socket = No_Socket\n+        or else Selector.W_Sig_Socket = No_Socket\n+      then\n+         return;\n+      end if;\n+\n       --  Close the signalling file descriptors used internally for the\n       --  implementation of Abort_Selector.\n \n@@ -636,6 +662,13 @@ package body GNAT.Sockets is\n       --  Used to set Socket to non-blocking I/O\n \n    begin\n+      if Selector /= null and then\n+        (Selector.R_Sig_Socket = No_Socket\n+           or else Selector.W_Sig_Socket = No_Socket)\n+      then\n+         raise Program_Error with \"closed selector\";\n+      end if;\n+\n       --  Set the socket to non-blocking I/O\n \n       Req := (Name => Non_Blocking_IO, Enabled => True);\n@@ -727,6 +760,12 @@ package body GNAT.Sockets is\n       Res     : C.int;\n \n    begin\n+      if Selector.R_Sig_Socket /= No_Socket\n+        or else Selector.W_Sig_Socket /= No_Socket\n+      then\n+         raise Program_Error with \"selector already open\";\n+      end if;\n+\n       --  We open two signalling file descriptors. One of them is used to send\n       --  data to the other, which is included in a C_Select socket set. The\n       --  communication is used to force a call to C_Select to complete, and"}, {"sha": "39a917a548025ca461214414bd8638b29715dcb5", "filename": "gcc/ada/g-socket.ads", "status": "modified", "additions": 2, "deletions": 1, "changes": 3, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/0714aafa1fd25aa1524869f4284b752e1a0e3161/gcc%2Fada%2Fg-socket.ads", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/0714aafa1fd25aa1524869f4284b752e1a0e3161/gcc%2Fada%2Fg-socket.ads", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fada%2Fg-socket.ads?ref=0714aafa1fd25aa1524869f4284b752e1a0e3161", "patch": "@@ -1072,7 +1072,8 @@ package GNAT.Sockets is\n    --  Close Selector and all internal descriptors associated; deallocate any\n    --  associated resources. This subprogram may be called only when there is\n    --  no other task still using Selector (i.e. still executing Check_Selector\n-   --  or Abort_Selector on this Selector).\n+   --  or Abort_Selector on this Selector). Has no effect if Selector is\n+   --  already closed.\n \n    procedure Check_Selector\n      (Selector     : in out Selector_Type;"}]}