{"sha": "f40475404235a392b16bb7db048fc18c56af3604", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6ZjQwNDc1NDA0MjM1YTM5MmIxNmJiN2RiMDQ4ZmMxOGM1NmFmMzYwNA==", "commit": {"author": {"name": "Bryce McKinlay", "email": "bryce@albatross.co.nz", "date": "2001-04-01T11:16:40Z"}, "committer": {"name": "Bryce McKinlay", "email": "bryce@gcc.gnu.org", "date": "2001-04-01T11:16:40Z"}, "message": "1.3-Compliant Implementation of java.io.File.\n\n\t* java/lang/natSystem.cc (init_properties): Get \"file.separator\",\n\t\"path.separator\", and \"java.io.tmpdir\" from the File class, instead\n\tof setting them explicitly.\n\t* java/io/File.java: Do not canonicalize paths for security manager\n\tchecks. Call init_native() from static initializer. Do not pass path\n\targument to native methods. New native method declarations. Some\n\tsecurity manager checks moved to checkWrite().\n\t(equals): Check file system case sensitivity and act appropriatly.\n\t(hashCode): Likewise.\n\t(isHidden): New method implemented.\n\t(performList): Changed prototype. Now takes a class argument specifying\n\tthe class of the returned array: Strings or File objects. Also added\n\tFileFilter argument.\n\t(listFiles): New variants with \"File\" return type implemented.\n\t(createTempFile): Use createNewFile(). Use maxPathLen.\n\t(setReadOnly): New method implemented.\n\t(listRoots): Likewise.\n\t(compareTo): Likewise.\n\t(setLastModified): Likewise.\n\t(checkWrite): New method.\n\t(setPath): Removed.\n\t* java/io/natFile.cc: Various functions no longer take canonical path\n\targument.\n\t(stat): Handle ISHIDDEN query.\n\t(isAbsolute): Remove WIN32 cruft.\n\t(performList): New arguments. Handle returning either File[] or\n\tString[] arrays. Check with FileFilter or FilenameFilter arguments as\n\tappropriate. Use an ArrayList, not a Vector, for the temporary list.\n\t(performSetReadOnly): New method implemented.\n\t(performListRoots): Likewise.\n\t(performSetLastModified): Likewise.\n\t(performCreate): Likewise.\n\t(init_native): New initialization function.\n\t* java/io/natFileWin32.cc: Various functions no longer take canonical\n\tpath argument.\n\t(stat): Add FIXME about ISHIDDEN query.\n\t(performList): New arguments. Handle returning either File[] or String[]\n\tarrays. Check with FileFilter or FilenameFilter arguments as\n\tappropriate. Use an ArrayList, not a Vector, for the temporary list.\n\t(performSetReadOnly): New. Stubbed.\n\t(performListRoots): Likewise.\n\t(performSetLastModified): Likewise.\n\t(performCreate): Likewise.\n\t(init_native) New initialization function.\n\t* configure.in: Check for utime() and chmod().\n\t* configure: Rebuilt.\n\t* include/config.h.in: Rebuilt.\n\n\tResolves PR libgcj/1759.\n\nFrom-SVN: r40985", "tree": {"sha": "64ffcb42dcabba681035f83df8bad41e16ad89de", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/64ffcb42dcabba681035f83df8bad41e16ad89de"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/f40475404235a392b16bb7db048fc18c56af3604", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/f40475404235a392b16bb7db048fc18c56af3604", "html_url": "https://github.com/Rust-GCC/gccrs/commit/f40475404235a392b16bb7db048fc18c56af3604", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/f40475404235a392b16bb7db048fc18c56af3604/comments", "author": null, "committer": null, "parents": [{"sha": "e74061a981cd8d62e366c6bc96454250e7da0450", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/e74061a981cd8d62e366c6bc96454250e7da0450", "html_url": "https://github.com/Rust-GCC/gccrs/commit/e74061a981cd8d62e366c6bc96454250e7da0450"}], "stats": {"total": 886, "additions": 583, "deletions": 303}, "files": [{"sha": "84aacc9e969a936b9cd55e1adc841af7f6ab380b", "filename": "libjava/ChangeLog", "status": "modified", "additions": 53, "deletions": 0, "changes": 53, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/f40475404235a392b16bb7db048fc18c56af3604/libjava%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/f40475404235a392b16bb7db048fc18c56af3604/libjava%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libjava%2FChangeLog?ref=f40475404235a392b16bb7db048fc18c56af3604", "patch": "@@ -1,3 +1,56 @@\n+2001-04-01  Bryce McKinlay  <bryce@albatross.co.nz>\n+\n+\t1.3-Compliant Implementation of java.io.File.\n+\t* java/lang/natSystem.cc (init_properties): Get \"file.separator\",\n+\t\"path.separator\", and \"java.io.tmpdir\" from the File class, instead\n+\tof setting them explicitly. \n+\t* java/io/File.java: Do not canonicalize paths for security manager\n+\tchecks. Call init_native() from static initializer. Do not pass path \n+\targument to native methods. New native method declarations. Some \n+\tsecurity manager checks moved to checkWrite().\n+\t(equals): Check file system case sensitivity and act appropriatly.\n+\t(hashCode): Likewise.\n+\t(isHidden): New method implemented.\n+\t(performList): Changed prototype. Now takes a class argument specifying\n+\tthe class of the returned array: Strings or File objects. Also added\n+\tFileFilter argument.\n+\t(listFiles): New variants with \"File\" return type implemented.\n+\t(createTempFile): Use createNewFile(). Use maxPathLen.\n+\t(setReadOnly): New method implemented.\n+\t(listRoots): Likewise.\n+\t(compareTo): Likewise.\n+\t(setLastModified): Likewise.\n+\t(checkWrite): New method.\n+\t(setPath): Removed.\n+\t* java/io/natFile.cc: Various functions no longer take canonical path\n+\targument.\n+\t(stat): Handle ISHIDDEN query.\n+\t(isAbsolute): Remove WIN32 cruft.\n+\t(performList): New arguments. Handle returning either File[] or String[]\n+\tarrays. Check with FileFilter or FilenameFilter arguments as \n+\tappropriate. Use an ArrayList, not a Vector, for the temporary list.\n+\t(performSetReadOnly): New method implemented.\n+\t(performListRoots): Likewise.\n+\t(performSetLastModified): Likewise.\n+\t(performCreate): Likewise.\n+\t(init_native): New initialization function.\n+\t* java/io/natFileWin32.cc: Various functions no longer take canonical \n+\tpath argument.\n+\t(stat): Add FIXME about ISHIDDEN query.\n+\t(performList): New arguments. Handle returning either File[] or String[]\n+\tarrays. Check with FileFilter or FilenameFilter arguments as \n+\tappropriate. Use an ArrayList, not a Vector, for the temporary list.\n+\t(performSetReadOnly): New. Stubbed.\n+\t(performListRoots): Likewise.\n+\t(performSetLastModified): Likewise.\n+\t(performCreate): Likewise.\n+\t(init_native) New initialization function.\t\n+\t* configure.in: Check for utime() and chmod().\n+\t* configure: Rebuilt.\n+\t* include/config.h.in: Rebuilt.\n+\n+\tResolves PR libgcj/1759.\n+\n 2001-03-28  Richard Henderson  <rth@redhat.com>\n \n \tIA-64 ABI Exception Handling:"}, {"sha": "749b29253ece5281117feb1e0be88193f5cc8d90", "filename": "libjava/configure", "status": "modified", "additions": 97, "deletions": 95, "changes": 192, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/f40475404235a392b16bb7db048fc18c56af3604/libjava%2Fconfigure", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/f40475404235a392b16bb7db048fc18c56af3604/libjava%2Fconfigure", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libjava%2Fconfigure?ref=f40475404235a392b16bb7db048fc18c56af3604", "patch": "@@ -3390,7 +3390,7 @@ else\n fi\n done\n \n-   for ac_func in access stat mkdir rename rmdir unlink realpath\n+   for ac_func in access stat mkdir rename rmdir unlink realpath utime chmod\n do\n echo $ac_n \"checking for $ac_func\"\"... $ac_c\" 1>&6\n echo \"configure:3397: checking for $ac_func\" >&5\n@@ -5158,19 +5158,20 @@ EOF\n \n \n \n+\n echo $ac_n \"checking for g++ -ffloat-store bug\"\"... $ac_c\" 1>&6\n-echo \"configure:5163: checking for g++ -ffloat-store bug\" >&5\n+echo \"configure:5164: checking for g++ -ffloat-store bug\" >&5\n save_CFLAGS=\"$CFLAGS\"\n CFLAGS=\"-x c++ -O2 -ffloat-store\"\n cat > conftest.$ac_ext <<EOF\n-#line 5167 \"configure\"\n+#line 5168 \"configure\"\n #include \"confdefs.h\"\n #include <math.h>\n int main() {\n \n ; return 0; }\n EOF\n-if { (eval echo configure:5174: \\\"$ac_compile\\\") 1>&5; (eval $ac_compile) 2>&5; }; then\n+if { (eval echo configure:5175: \\\"$ac_compile\\\") 1>&5; (eval $ac_compile) 2>&5; }; then\n   rm -rf conftest*\n   echo \"$ac_t\"\"no\" 1>&6\n else\n@@ -5190,17 +5191,17 @@ for ac_hdr in unistd.h bstring.h sys/time.h sys/types.h fcntl.h sys/ioctl.h sys/\n do\n ac_safe=`echo \"$ac_hdr\" | sed 'y%./+-%__p_%'`\n echo $ac_n \"checking for $ac_hdr\"\"... $ac_c\" 1>&6\n-echo \"configure:5194: checking for $ac_hdr\" >&5\n+echo \"configure:5195: checking for $ac_hdr\" >&5\n if eval \"test \\\"`echo '$''{'ac_cv_header_$ac_safe'+set}'`\\\" = set\"; then\n   echo $ac_n \"(cached) $ac_c\" 1>&6\n else\n   cat > conftest.$ac_ext <<EOF\n-#line 5199 \"configure\"\n+#line 5200 \"configure\"\n #include \"confdefs.h\"\n #include <$ac_hdr>\n EOF\n ac_try=\"$ac_cpp conftest.$ac_ext >/dev/null 2>conftest.out\"\n-{ (eval echo configure:5204: \\\"$ac_try\\\") 1>&5; (eval $ac_try) 2>&5; }\n+{ (eval echo configure:5205: \\\"$ac_try\\\") 1>&5; (eval $ac_try) 2>&5; }\n ac_err=`grep -v '^ *+' conftest.out | grep -v \"^conftest.${ac_ext}\\$\"`\n if test -z \"$ac_err\"; then\n   rm -rf conftest*\n@@ -5230,17 +5231,17 @@ for ac_hdr in dirent.h\n do\n ac_safe=`echo \"$ac_hdr\" | sed 'y%./+-%__p_%'`\n echo $ac_n \"checking for $ac_hdr\"\"... $ac_c\" 1>&6\n-echo \"configure:5234: checking for $ac_hdr\" >&5\n+echo \"configure:5235: checking for $ac_hdr\" >&5\n if eval \"test \\\"`echo '$''{'ac_cv_header_$ac_safe'+set}'`\\\" = set\"; then\n   echo $ac_n \"(cached) $ac_c\" 1>&6\n else\n   cat > conftest.$ac_ext <<EOF\n-#line 5239 \"configure\"\n+#line 5240 \"configure\"\n #include \"confdefs.h\"\n #include <$ac_hdr>\n EOF\n ac_try=\"$ac_cpp conftest.$ac_ext >/dev/null 2>conftest.out\"\n-{ (eval echo configure:5244: \\\"$ac_try\\\") 1>&5; (eval $ac_try) 2>&5; }\n+{ (eval echo configure:5245: \\\"$ac_try\\\") 1>&5; (eval $ac_try) 2>&5; }\n ac_err=`grep -v '^ *+' conftest.out | grep -v \"^conftest.${ac_ext}\\$\"`\n if test -z \"$ac_err\"; then\n   rm -rf conftest*\n@@ -5268,20 +5269,20 @@ done\n \n \n echo $ac_n \"checking for ANSI C header files\"\"... $ac_c\" 1>&6\n-echo \"configure:5272: checking for ANSI C header files\" >&5\n+echo \"configure:5273: checking for ANSI C header files\" >&5\n if eval \"test \\\"`echo '$''{'ac_cv_header_stdc'+set}'`\\\" = set\"; then\n   echo $ac_n \"(cached) $ac_c\" 1>&6\n else\n   cat > conftest.$ac_ext <<EOF\n-#line 5277 \"configure\"\n+#line 5278 \"configure\"\n #include \"confdefs.h\"\n #include <stdlib.h>\n #include <stdarg.h>\n #include <string.h>\n #include <float.h>\n EOF\n ac_try=\"$ac_cpp conftest.$ac_ext >/dev/null 2>conftest.out\"\n-{ (eval echo configure:5285: \\\"$ac_try\\\") 1>&5; (eval $ac_try) 2>&5; }\n+{ (eval echo configure:5286: \\\"$ac_try\\\") 1>&5; (eval $ac_try) 2>&5; }\n ac_err=`grep -v '^ *+' conftest.out | grep -v \"^conftest.${ac_ext}\\$\"`\n if test -z \"$ac_err\"; then\n   rm -rf conftest*\n@@ -5298,7 +5299,7 @@ rm -f conftest*\n if test $ac_cv_header_stdc = yes; then\n   # SunOS 4.x string.h does not declare mem*, contrary to ANSI.\n cat > conftest.$ac_ext <<EOF\n-#line 5302 \"configure\"\n+#line 5303 \"configure\"\n #include \"confdefs.h\"\n #include <string.h>\n EOF\n@@ -5316,7 +5317,7 @@ fi\n if test $ac_cv_header_stdc = yes; then\n   # ISC 2.0.2 stdlib.h does not declare free, contrary to ANSI.\n cat > conftest.$ac_ext <<EOF\n-#line 5320 \"configure\"\n+#line 5321 \"configure\"\n #include \"confdefs.h\"\n #include <stdlib.h>\n EOF\n@@ -5337,7 +5338,7 @@ if test \"$cross_compiling\" = yes; then\n   :\n else\n   cat > conftest.$ac_ext <<EOF\n-#line 5341 \"configure\"\n+#line 5342 \"configure\"\n #include \"confdefs.h\"\n #include <ctype.h>\n #define ISLOWER(c) ('a' <= (c) && (c) <= 'z')\n@@ -5348,7 +5349,7 @@ if (XOR (islower (i), ISLOWER (i)) || toupper (i) != TOUPPER (i)) exit(2);\n exit (0); }\n \n EOF\n-if { (eval echo configure:5352: \\\"$ac_link\\\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest${ac_exeext} && (./conftest; exit) 2>/dev/null\n+if { (eval echo configure:5353: \\\"$ac_link\\\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest${ac_exeext} && (./conftest; exit) 2>/dev/null\n then\n   :\n else\n@@ -5372,12 +5373,12 @@ EOF\n fi\n \n echo $ac_n \"checking for ssize_t\"\"... $ac_c\" 1>&6\n-echo \"configure:5376: checking for ssize_t\" >&5\n+echo \"configure:5377: checking for ssize_t\" >&5\n if eval \"test \\\"`echo '$''{'ac_cv_type_ssize_t'+set}'`\\\" = set\"; then\n   echo $ac_n \"(cached) $ac_c\" 1>&6\n else\n   cat > conftest.$ac_ext <<EOF\n-#line 5381 \"configure\"\n+#line 5382 \"configure\"\n #include \"confdefs.h\"\n #include <sys/types.h>\n #if STDC_HEADERS\n@@ -5406,9 +5407,9 @@ fi\n \n \n echo $ac_n \"checking for in_addr_t\"\"... $ac_c\" 1>&6\n-echo \"configure:5410: checking for in_addr_t\" >&5\n+echo \"configure:5411: checking for in_addr_t\" >&5\n cat > conftest.$ac_ext <<EOF\n-#line 5412 \"configure\"\n+#line 5413 \"configure\"\n #include \"confdefs.h\"\n #include <sys/types.h>\n #if STDC_HEADERS\n@@ -5422,7 +5423,7 @@ int main() {\n in_addr_t foo;\n ; return 0; }\n EOF\n-if { (eval echo configure:5426: \\\"$ac_compile\\\") 1>&5; (eval $ac_compile) 2>&5; }; then\n+if { (eval echo configure:5427: \\\"$ac_compile\\\") 1>&5; (eval $ac_compile) 2>&5; }; then\n   rm -rf conftest*\n   cat >> confdefs.h <<\\EOF\n #define HAVE_IN_ADDR_T 1\n@@ -5438,16 +5439,16 @@ fi\n rm -f conftest*\n \n echo $ac_n \"checking whether struct ip_mreq is in netinet/in.h\"\"... $ac_c\" 1>&6\n-echo \"configure:5442: checking whether struct ip_mreq is in netinet/in.h\" >&5\n+echo \"configure:5443: checking whether struct ip_mreq is in netinet/in.h\" >&5\n cat > conftest.$ac_ext <<EOF\n-#line 5444 \"configure\"\n+#line 5445 \"configure\"\n #include \"confdefs.h\"\n #include <netinet/in.h>\n int main() {\n struct ip_mreq mreq;\n ; return 0; }\n EOF\n-if { (eval echo configure:5451: \\\"$ac_compile\\\") 1>&5; (eval $ac_compile) 2>&5; }; then\n+if { (eval echo configure:5452: \\\"$ac_compile\\\") 1>&5; (eval $ac_compile) 2>&5; }; then\n   rm -rf conftest*\n   cat >> confdefs.h <<\\EOF\n #define HAVE_STRUCT_IP_MREQ 1\n@@ -5463,16 +5464,16 @@ fi\n rm -f conftest*\n \n echo $ac_n \"checking whether struct sockaddr_in6 is in netinet/in.h\"\"... $ac_c\" 1>&6\n-echo \"configure:5467: checking whether struct sockaddr_in6 is in netinet/in.h\" >&5\n+echo \"configure:5468: checking whether struct sockaddr_in6 is in netinet/in.h\" >&5\n cat > conftest.$ac_ext <<EOF\n-#line 5469 \"configure\"\n+#line 5470 \"configure\"\n #include \"confdefs.h\"\n #include <netinet/in.h>\n int main() {\n struct sockaddr_in6 addr6;\n ; return 0; }\n EOF\n-if { (eval echo configure:5476: \\\"$ac_compile\\\") 1>&5; (eval $ac_compile) 2>&5; }; then\n+if { (eval echo configure:5477: \\\"$ac_compile\\\") 1>&5; (eval $ac_compile) 2>&5; }; then\n   rm -rf conftest*\n   cat >> confdefs.h <<\\EOF\n #define HAVE_INET6 1\n@@ -5488,17 +5489,17 @@ fi\n rm -f conftest*\n \n echo $ac_n \"checking for socklen_t in sys/socket.h\"\"... $ac_c\" 1>&6\n-echo \"configure:5492: checking for socklen_t in sys/socket.h\" >&5\n+echo \"configure:5493: checking for socklen_t in sys/socket.h\" >&5\n cat > conftest.$ac_ext <<EOF\n-#line 5494 \"configure\"\n+#line 5495 \"configure\"\n #include \"confdefs.h\"\n #include <sys/types.h>\n #include <sys/socket.h>\n int main() {\n socklen_t x = 5;\n ; return 0; }\n EOF\n-if { (eval echo configure:5502: \\\"$ac_compile\\\") 1>&5; (eval $ac_compile) 2>&5; }; then\n+if { (eval echo configure:5503: \\\"$ac_compile\\\") 1>&5; (eval $ac_compile) 2>&5; }; then\n   rm -rf conftest*\n   cat >> confdefs.h <<\\EOF\n #define HAVE_SOCKLEN_T 1\n@@ -5514,16 +5515,16 @@ fi\n rm -f conftest*\n \n echo $ac_n \"checking for tm_gmtoff in struct tm\"\"... $ac_c\" 1>&6\n-echo \"configure:5518: checking for tm_gmtoff in struct tm\" >&5\n+echo \"configure:5519: checking for tm_gmtoff in struct tm\" >&5\n cat > conftest.$ac_ext <<EOF\n-#line 5520 \"configure\"\n+#line 5521 \"configure\"\n #include \"confdefs.h\"\n #include <time.h>\n int main() {\n struct tm tim; tim.tm_gmtoff = 0;\n ; return 0; }\n EOF\n-if { (eval echo configure:5527: \\\"$ac_compile\\\") 1>&5; (eval $ac_compile) 2>&5; }; then\n+if { (eval echo configure:5528: \\\"$ac_compile\\\") 1>&5; (eval $ac_compile) 2>&5; }; then\n   rm -rf conftest*\n   cat >> confdefs.h <<\\EOF\n #define STRUCT_TM_HAS_GMTOFF 1\n@@ -5536,16 +5537,16 @@ else\n   rm -rf conftest*\n   echo \"$ac_t\"\"no\" 1>&6\n    echo $ac_n \"checking for global timezone variable\"\"... $ac_c\" 1>&6\n-echo \"configure:5540: checking for global timezone variable\" >&5\n+echo \"configure:5541: checking for global timezone variable\" >&5\n             cat > conftest.$ac_ext <<EOF\n-#line 5542 \"configure\"\n+#line 5543 \"configure\"\n #include \"confdefs.h\"\n #include <time.h>\n int main() {\n long z2 = timezone;\n ; return 0; }\n EOF\n-if { (eval echo configure:5549: \\\"$ac_compile\\\") 1>&5; (eval $ac_compile) 2>&5; }; then\n+if { (eval echo configure:5550: \\\"$ac_compile\\\") 1>&5; (eval $ac_compile) 2>&5; }; then\n   rm -rf conftest*\n   cat >> confdefs.h <<\\EOF\n #define HAVE_TIMEZONE 1\n@@ -5565,19 +5566,19 @@ rm -f conftest*\n # The Ultrix 4.2 mips builtin alloca declared by alloca.h only works\n # for constant arguments.  Useless!\n echo $ac_n \"checking for working alloca.h\"\"... $ac_c\" 1>&6\n-echo \"configure:5569: checking for working alloca.h\" >&5\n+echo \"configure:5570: checking for working alloca.h\" >&5\n if eval \"test \\\"`echo '$''{'ac_cv_header_alloca_h'+set}'`\\\" = set\"; then\n   echo $ac_n \"(cached) $ac_c\" 1>&6\n else\n   cat > conftest.$ac_ext <<EOF\n-#line 5574 \"configure\"\n+#line 5575 \"configure\"\n #include \"confdefs.h\"\n #include <alloca.h>\n int main() {\n char *p = alloca(2 * sizeof(int));\n ; return 0; }\n EOF\n-if { (eval echo configure:5581: \\\"$ac_link\\\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest${ac_exeext}; then\n+if { (eval echo configure:5582: \\\"$ac_link\\\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest${ac_exeext}; then\n   rm -rf conftest*\n   ac_cv_header_alloca_h=yes\n else\n@@ -5598,12 +5599,12 @@ EOF\n fi\n \n echo $ac_n \"checking for alloca\"\"... $ac_c\" 1>&6\n-echo \"configure:5602: checking for alloca\" >&5\n+echo \"configure:5603: checking for alloca\" >&5\n if eval \"test \\\"`echo '$''{'ac_cv_func_alloca_works'+set}'`\\\" = set\"; then\n   echo $ac_n \"(cached) $ac_c\" 1>&6\n else\n   cat > conftest.$ac_ext <<EOF\n-#line 5607 \"configure\"\n+#line 5608 \"configure\"\n #include \"confdefs.h\"\n \n #ifdef __GNUC__\n@@ -5631,7 +5632,7 @@ int main() {\n char *p = (char *) alloca(1);\n ; return 0; }\n EOF\n-if { (eval echo configure:5635: \\\"$ac_link\\\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest${ac_exeext}; then\n+if { (eval echo configure:5636: \\\"$ac_link\\\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest${ac_exeext}; then\n   rm -rf conftest*\n   ac_cv_func_alloca_works=yes\n else\n@@ -5663,12 +5664,12 @@ EOF\n \n \n echo $ac_n \"checking whether alloca needs Cray hooks\"\"... $ac_c\" 1>&6\n-echo \"configure:5667: checking whether alloca needs Cray hooks\" >&5\n+echo \"configure:5668: checking whether alloca needs Cray hooks\" >&5\n if eval \"test \\\"`echo '$''{'ac_cv_os_cray'+set}'`\\\" = set\"; then\n   echo $ac_n \"(cached) $ac_c\" 1>&6\n else\n   cat > conftest.$ac_ext <<EOF\n-#line 5672 \"configure\"\n+#line 5673 \"configure\"\n #include \"confdefs.h\"\n #if defined(CRAY) && ! defined(CRAY2)\n webecray\n@@ -5693,12 +5694,12 @@ echo \"$ac_t\"\"$ac_cv_os_cray\" 1>&6\n if test $ac_cv_os_cray = yes; then\n for ac_func in _getb67 GETB67 getb67; do\n   echo $ac_n \"checking for $ac_func\"\"... $ac_c\" 1>&6\n-echo \"configure:5697: checking for $ac_func\" >&5\n+echo \"configure:5698: checking for $ac_func\" >&5\n if eval \"test \\\"`echo '$''{'ac_cv_func_$ac_func'+set}'`\\\" = set\"; then\n   echo $ac_n \"(cached) $ac_c\" 1>&6\n else\n   cat > conftest.$ac_ext <<EOF\n-#line 5702 \"configure\"\n+#line 5703 \"configure\"\n #include \"confdefs.h\"\n /* System header to define __stub macros and hopefully few prototypes,\n     which can conflict with char $ac_func(); below.  */\n@@ -5721,7 +5722,7 @@ $ac_func();\n \n ; return 0; }\n EOF\n-if { (eval echo configure:5725: \\\"$ac_link\\\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest${ac_exeext}; then\n+if { (eval echo configure:5726: \\\"$ac_link\\\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest${ac_exeext}; then\n   rm -rf conftest*\n   eval \"ac_cv_func_$ac_func=yes\"\n else\n@@ -5748,15 +5749,15 @@ done\n fi\n \n echo $ac_n \"checking stack direction for C alloca\"\"... $ac_c\" 1>&6\n-echo \"configure:5752: checking stack direction for C alloca\" >&5\n+echo \"configure:5753: checking stack direction for C alloca\" >&5\n if eval \"test \\\"`echo '$''{'ac_cv_c_stack_direction'+set}'`\\\" = set\"; then\n   echo $ac_n \"(cached) $ac_c\" 1>&6\n else\n   if test \"$cross_compiling\" = yes; then\n   ac_cv_c_stack_direction=0\n else\n   cat > conftest.$ac_ext <<EOF\n-#line 5760 \"configure\"\n+#line 5761 \"configure\"\n #include \"confdefs.h\"\n find_stack_direction ()\n {\n@@ -5775,7 +5776,7 @@ main ()\n   exit (find_stack_direction() < 0);\n }\n EOF\n-if { (eval echo configure:5779: \\\"$ac_link\\\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest${ac_exeext} && (./conftest; exit) 2>/dev/null\n+if { (eval echo configure:5780: \\\"$ac_link\\\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest${ac_exeext} && (./conftest; exit) 2>/dev/null\n then\n   ac_cv_c_stack_direction=1\n else\n@@ -5802,7 +5803,7 @@ do\n # Extract the first word of \"$ac_prog\", so it can be a program name with args.\n set dummy $ac_prog; ac_word=$2\n echo $ac_n \"checking for $ac_word\"\"... $ac_c\" 1>&6\n-echo \"configure:5806: checking for $ac_word\" >&5\n+echo \"configure:5807: checking for $ac_word\" >&5\n if eval \"test \\\"`echo '$''{'ac_cv_prog_PERL'+set}'`\\\" = set\"; then\n   echo $ac_n \"(cached) $ac_c\" 1>&6\n else\n@@ -5871,7 +5872,7 @@ fi\n # Uses ac_ vars as temps to allow command line to override cache and checks.\n # --without-x overrides everything else, but does not touch the cache.\n echo $ac_n \"checking for X\"\"... $ac_c\" 1>&6\n-echo \"configure:5875: checking for X\" >&5\n+echo \"configure:5876: checking for X\" >&5\n \n # Check whether --with-x or --without-x was given.\n if test \"${with_x+set}\" = set; then\n@@ -5933,12 +5934,12 @@ if test \"$ac_x_includes\" = NO; then\n \n   # First, try using that file with no special directory specified.\n cat > conftest.$ac_ext <<EOF\n-#line 5937 \"configure\"\n+#line 5938 \"configure\"\n #include \"confdefs.h\"\n #include <$x_direct_test_include>\n EOF\n ac_try=\"$ac_cpp conftest.$ac_ext >/dev/null 2>conftest.out\"\n-{ (eval echo configure:5942: \\\"$ac_try\\\") 1>&5; (eval $ac_try) 2>&5; }\n+{ (eval echo configure:5943: \\\"$ac_try\\\") 1>&5; (eval $ac_try) 2>&5; }\n ac_err=`grep -v '^ *+' conftest.out | grep -v \"^conftest.${ac_ext}\\$\"`\n if test -z \"$ac_err\"; then\n   rm -rf conftest*\n@@ -6007,14 +6008,14 @@ if test \"$ac_x_libraries\" = NO; then\n   ac_save_LIBS=\"$LIBS\"\n   LIBS=\"-l$x_direct_test_library $LIBS\"\n cat > conftest.$ac_ext <<EOF\n-#line 6011 \"configure\"\n+#line 6012 \"configure\"\n #include \"confdefs.h\"\n \n int main() {\n ${x_direct_test_function}()\n ; return 0; }\n EOF\n-if { (eval echo configure:6018: \\\"$ac_link\\\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest${ac_exeext}; then\n+if { (eval echo configure:6019: \\\"$ac_link\\\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest${ac_exeext}; then\n   rm -rf conftest*\n   LIBS=\"$ac_save_LIBS\"\n # We can link X programs with no special library path.\n@@ -6120,17 +6121,17 @@ else\n     case \"`(uname -sr) 2>/dev/null`\" in\n     \"SunOS 5\"*)\n       echo $ac_n \"checking whether -R must be followed by a space\"\"... $ac_c\" 1>&6\n-echo \"configure:6124: checking whether -R must be followed by a space\" >&5\n+echo \"configure:6125: checking whether -R must be followed by a space\" >&5\n       ac_xsave_LIBS=\"$LIBS\"; LIBS=\"$LIBS -R$x_libraries\"\n       cat > conftest.$ac_ext <<EOF\n-#line 6127 \"configure\"\n+#line 6128 \"configure\"\n #include \"confdefs.h\"\n \n int main() {\n \n ; return 0; }\n EOF\n-if { (eval echo configure:6134: \\\"$ac_link\\\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest${ac_exeext}; then\n+if { (eval echo configure:6135: \\\"$ac_link\\\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest${ac_exeext}; then\n   rm -rf conftest*\n   ac_R_nospace=yes\n else\n@@ -6146,14 +6147,14 @@ rm -f conftest*\n       else\n \tLIBS=\"$ac_xsave_LIBS -R $x_libraries\"\n \tcat > conftest.$ac_ext <<EOF\n-#line 6150 \"configure\"\n+#line 6151 \"configure\"\n #include \"confdefs.h\"\n \n int main() {\n \n ; return 0; }\n EOF\n-if { (eval echo configure:6157: \\\"$ac_link\\\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest${ac_exeext}; then\n+if { (eval echo configure:6158: \\\"$ac_link\\\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest${ac_exeext}; then\n   rm -rf conftest*\n   ac_R_space=yes\n else\n@@ -6185,15 +6186,15 @@ rm -f conftest*\n     # libraries were built with DECnet support.  And karl@cs.umb.edu says\n     # the Alpha needs dnet_stub (dnet does not exist).\n     echo $ac_n \"checking for dnet_ntoa in -ldnet\"\"... $ac_c\" 1>&6\n-echo \"configure:6189: checking for dnet_ntoa in -ldnet\" >&5\n+echo \"configure:6190: checking for dnet_ntoa in -ldnet\" >&5\n ac_lib_var=`echo dnet'_'dnet_ntoa | sed 'y%./+-%__p_%'`\n if eval \"test \\\"`echo '$''{'ac_cv_lib_$ac_lib_var'+set}'`\\\" = set\"; then\n   echo $ac_n \"(cached) $ac_c\" 1>&6\n else\n   ac_save_LIBS=\"$LIBS\"\n LIBS=\"-ldnet  $LIBS\"\n cat > conftest.$ac_ext <<EOF\n-#line 6197 \"configure\"\n+#line 6198 \"configure\"\n #include \"confdefs.h\"\n /* Override any gcc2 internal prototype to avoid an error.  */\n /* We use char because int might match the return type of a gcc2\n@@ -6204,7 +6205,7 @@ int main() {\n dnet_ntoa()\n ; return 0; }\n EOF\n-if { (eval echo configure:6208: \\\"$ac_link\\\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest${ac_exeext}; then\n+if { (eval echo configure:6209: \\\"$ac_link\\\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest${ac_exeext}; then\n   rm -rf conftest*\n   eval \"ac_cv_lib_$ac_lib_var=yes\"\n else\n@@ -6226,15 +6227,15 @@ fi\n \n     if test $ac_cv_lib_dnet_dnet_ntoa = no; then\n       echo $ac_n \"checking for dnet_ntoa in -ldnet_stub\"\"... $ac_c\" 1>&6\n-echo \"configure:6230: checking for dnet_ntoa in -ldnet_stub\" >&5\n+echo \"configure:6231: checking for dnet_ntoa in -ldnet_stub\" >&5\n ac_lib_var=`echo dnet_stub'_'dnet_ntoa | sed 'y%./+-%__p_%'`\n if eval \"test \\\"`echo '$''{'ac_cv_lib_$ac_lib_var'+set}'`\\\" = set\"; then\n   echo $ac_n \"(cached) $ac_c\" 1>&6\n else\n   ac_save_LIBS=\"$LIBS\"\n LIBS=\"-ldnet_stub  $LIBS\"\n cat > conftest.$ac_ext <<EOF\n-#line 6238 \"configure\"\n+#line 6239 \"configure\"\n #include \"confdefs.h\"\n /* Override any gcc2 internal prototype to avoid an error.  */\n /* We use char because int might match the return type of a gcc2\n@@ -6245,7 +6246,7 @@ int main() {\n dnet_ntoa()\n ; return 0; }\n EOF\n-if { (eval echo configure:6249: \\\"$ac_link\\\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest${ac_exeext}; then\n+if { (eval echo configure:6250: \\\"$ac_link\\\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest${ac_exeext}; then\n   rm -rf conftest*\n   eval \"ac_cv_lib_$ac_lib_var=yes\"\n else\n@@ -6274,12 +6275,12 @@ fi\n     # The nsl library prevents programs from opening the X display\n     # on Irix 5.2, according to dickey@clark.net.\n     echo $ac_n \"checking for gethostbyname\"\"... $ac_c\" 1>&6\n-echo \"configure:6278: checking for gethostbyname\" >&5\n+echo \"configure:6279: checking for gethostbyname\" >&5\n if eval \"test \\\"`echo '$''{'ac_cv_func_gethostbyname'+set}'`\\\" = set\"; then\n   echo $ac_n \"(cached) $ac_c\" 1>&6\n else\n   cat > conftest.$ac_ext <<EOF\n-#line 6283 \"configure\"\n+#line 6284 \"configure\"\n #include \"confdefs.h\"\n /* System header to define __stub macros and hopefully few prototypes,\n     which can conflict with char gethostbyname(); below.  */\n@@ -6302,7 +6303,7 @@ gethostbyname();\n \n ; return 0; }\n EOF\n-if { (eval echo configure:6306: \\\"$ac_link\\\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest${ac_exeext}; then\n+if { (eval echo configure:6307: \\\"$ac_link\\\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest${ac_exeext}; then\n   rm -rf conftest*\n   eval \"ac_cv_func_gethostbyname=yes\"\n else\n@@ -6323,15 +6324,15 @@ fi\n \n     if test $ac_cv_func_gethostbyname = no; then\n       echo $ac_n \"checking for gethostbyname in -lnsl\"\"... $ac_c\" 1>&6\n-echo \"configure:6327: checking for gethostbyname in -lnsl\" >&5\n+echo \"configure:6328: checking for gethostbyname in -lnsl\" >&5\n ac_lib_var=`echo nsl'_'gethostbyname | sed 'y%./+-%__p_%'`\n if eval \"test \\\"`echo '$''{'ac_cv_lib_$ac_lib_var'+set}'`\\\" = set\"; then\n   echo $ac_n \"(cached) $ac_c\" 1>&6\n else\n   ac_save_LIBS=\"$LIBS\"\n LIBS=\"-lnsl  $LIBS\"\n cat > conftest.$ac_ext <<EOF\n-#line 6335 \"configure\"\n+#line 6336 \"configure\"\n #include \"confdefs.h\"\n /* Override any gcc2 internal prototype to avoid an error.  */\n /* We use char because int might match the return type of a gcc2\n@@ -6342,7 +6343,7 @@ int main() {\n gethostbyname()\n ; return 0; }\n EOF\n-if { (eval echo configure:6346: \\\"$ac_link\\\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest${ac_exeext}; then\n+if { (eval echo configure:6347: \\\"$ac_link\\\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest${ac_exeext}; then\n   rm -rf conftest*\n   eval \"ac_cv_lib_$ac_lib_var=yes\"\n else\n@@ -6372,12 +6373,12 @@ fi\n     # -lsocket must be given before -lnsl if both are needed.\n     # We assume that if connect needs -lnsl, so does gethostbyname.\n     echo $ac_n \"checking for connect\"\"... $ac_c\" 1>&6\n-echo \"configure:6376: checking for connect\" >&5\n+echo \"configure:6377: checking for connect\" >&5\n if eval \"test \\\"`echo '$''{'ac_cv_func_connect'+set}'`\\\" = set\"; then\n   echo $ac_n \"(cached) $ac_c\" 1>&6\n else\n   cat > conftest.$ac_ext <<EOF\n-#line 6381 \"configure\"\n+#line 6382 \"configure\"\n #include \"confdefs.h\"\n /* System header to define __stub macros and hopefully few prototypes,\n     which can conflict with char connect(); below.  */\n@@ -6400,7 +6401,7 @@ connect();\n \n ; return 0; }\n EOF\n-if { (eval echo configure:6404: \\\"$ac_link\\\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest${ac_exeext}; then\n+if { (eval echo configure:6405: \\\"$ac_link\\\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest${ac_exeext}; then\n   rm -rf conftest*\n   eval \"ac_cv_func_connect=yes\"\n else\n@@ -6421,15 +6422,15 @@ fi\n \n     if test $ac_cv_func_connect = no; then\n       echo $ac_n \"checking for connect in -lsocket\"\"... $ac_c\" 1>&6\n-echo \"configure:6425: checking for connect in -lsocket\" >&5\n+echo \"configure:6426: checking for connect in -lsocket\" >&5\n ac_lib_var=`echo socket'_'connect | sed 'y%./+-%__p_%'`\n if eval \"test \\\"`echo '$''{'ac_cv_lib_$ac_lib_var'+set}'`\\\" = set\"; then\n   echo $ac_n \"(cached) $ac_c\" 1>&6\n else\n   ac_save_LIBS=\"$LIBS\"\n LIBS=\"-lsocket $X_EXTRA_LIBS $LIBS\"\n cat > conftest.$ac_ext <<EOF\n-#line 6433 \"configure\"\n+#line 6434 \"configure\"\n #include \"confdefs.h\"\n /* Override any gcc2 internal prototype to avoid an error.  */\n /* We use char because int might match the return type of a gcc2\n@@ -6440,7 +6441,7 @@ int main() {\n connect()\n ; return 0; }\n EOF\n-if { (eval echo configure:6444: \\\"$ac_link\\\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest${ac_exeext}; then\n+if { (eval echo configure:6445: \\\"$ac_link\\\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest${ac_exeext}; then\n   rm -rf conftest*\n   eval \"ac_cv_lib_$ac_lib_var=yes\"\n else\n@@ -6464,12 +6465,12 @@ fi\n \n     # gomez@mi.uni-erlangen.de says -lposix is necessary on A/UX.\n     echo $ac_n \"checking for remove\"\"... $ac_c\" 1>&6\n-echo \"configure:6468: checking for remove\" >&5\n+echo \"configure:6469: checking for remove\" >&5\n if eval \"test \\\"`echo '$''{'ac_cv_func_remove'+set}'`\\\" = set\"; then\n   echo $ac_n \"(cached) $ac_c\" 1>&6\n else\n   cat > conftest.$ac_ext <<EOF\n-#line 6473 \"configure\"\n+#line 6474 \"configure\"\n #include \"confdefs.h\"\n /* System header to define __stub macros and hopefully few prototypes,\n     which can conflict with char remove(); below.  */\n@@ -6492,7 +6493,7 @@ remove();\n \n ; return 0; }\n EOF\n-if { (eval echo configure:6496: \\\"$ac_link\\\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest${ac_exeext}; then\n+if { (eval echo configure:6497: \\\"$ac_link\\\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest${ac_exeext}; then\n   rm -rf conftest*\n   eval \"ac_cv_func_remove=yes\"\n else\n@@ -6513,15 +6514,15 @@ fi\n \n     if test $ac_cv_func_remove = no; then\n       echo $ac_n \"checking for remove in -lposix\"\"... $ac_c\" 1>&6\n-echo \"configure:6517: checking for remove in -lposix\" >&5\n+echo \"configure:6518: checking for remove in -lposix\" >&5\n ac_lib_var=`echo posix'_'remove | sed 'y%./+-%__p_%'`\n if eval \"test \\\"`echo '$''{'ac_cv_lib_$ac_lib_var'+set}'`\\\" = set\"; then\n   echo $ac_n \"(cached) $ac_c\" 1>&6\n else\n   ac_save_LIBS=\"$LIBS\"\n LIBS=\"-lposix  $LIBS\"\n cat > conftest.$ac_ext <<EOF\n-#line 6525 \"configure\"\n+#line 6526 \"configure\"\n #include \"confdefs.h\"\n /* Override any gcc2 internal prototype to avoid an error.  */\n /* We use char because int might match the return type of a gcc2\n@@ -6532,7 +6533,7 @@ int main() {\n remove()\n ; return 0; }\n EOF\n-if { (eval echo configure:6536: \\\"$ac_link\\\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest${ac_exeext}; then\n+if { (eval echo configure:6537: \\\"$ac_link\\\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest${ac_exeext}; then\n   rm -rf conftest*\n   eval \"ac_cv_lib_$ac_lib_var=yes\"\n else\n@@ -6556,12 +6557,12 @@ fi\n \n     # BSDI BSD/OS 2.1 needs -lipc for XOpenDisplay.\n     echo $ac_n \"checking for shmat\"\"... $ac_c\" 1>&6\n-echo \"configure:6560: checking for shmat\" >&5\n+echo \"configure:6561: checking for shmat\" >&5\n if eval \"test \\\"`echo '$''{'ac_cv_func_shmat'+set}'`\\\" = set\"; then\n   echo $ac_n \"(cached) $ac_c\" 1>&6\n else\n   cat > conftest.$ac_ext <<EOF\n-#line 6565 \"configure\"\n+#line 6566 \"configure\"\n #include \"confdefs.h\"\n /* System header to define __stub macros and hopefully few prototypes,\n     which can conflict with char shmat(); below.  */\n@@ -6584,7 +6585,7 @@ shmat();\n \n ; return 0; }\n EOF\n-if { (eval echo configure:6588: \\\"$ac_link\\\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest${ac_exeext}; then\n+if { (eval echo configure:6589: \\\"$ac_link\\\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest${ac_exeext}; then\n   rm -rf conftest*\n   eval \"ac_cv_func_shmat=yes\"\n else\n@@ -6605,15 +6606,15 @@ fi\n \n     if test $ac_cv_func_shmat = no; then\n       echo $ac_n \"checking for shmat in -lipc\"\"... $ac_c\" 1>&6\n-echo \"configure:6609: checking for shmat in -lipc\" >&5\n+echo \"configure:6610: checking for shmat in -lipc\" >&5\n ac_lib_var=`echo ipc'_'shmat | sed 'y%./+-%__p_%'`\n if eval \"test \\\"`echo '$''{'ac_cv_lib_$ac_lib_var'+set}'`\\\" = set\"; then\n   echo $ac_n \"(cached) $ac_c\" 1>&6\n else\n   ac_save_LIBS=\"$LIBS\"\n LIBS=\"-lipc  $LIBS\"\n cat > conftest.$ac_ext <<EOF\n-#line 6617 \"configure\"\n+#line 6618 \"configure\"\n #include \"confdefs.h\"\n /* Override any gcc2 internal prototype to avoid an error.  */\n /* We use char because int might match the return type of a gcc2\n@@ -6624,7 +6625,7 @@ int main() {\n shmat()\n ; return 0; }\n EOF\n-if { (eval echo configure:6628: \\\"$ac_link\\\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest${ac_exeext}; then\n+if { (eval echo configure:6629: \\\"$ac_link\\\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest${ac_exeext}; then\n   rm -rf conftest*\n   eval \"ac_cv_lib_$ac_lib_var=yes\"\n else\n@@ -6657,15 +6658,15 @@ fi\n   # libraries we check for below, so use a different variable.\n   #  --interran@uluru.Stanford.EDU, kb@cs.umb.edu.\n   echo $ac_n \"checking for IceConnectionNumber in -lICE\"\"... $ac_c\" 1>&6\n-echo \"configure:6661: checking for IceConnectionNumber in -lICE\" >&5\n+echo \"configure:6662: checking for IceConnectionNumber in -lICE\" >&5\n ac_lib_var=`echo ICE'_'IceConnectionNumber | sed 'y%./+-%__p_%'`\n if eval \"test \\\"`echo '$''{'ac_cv_lib_$ac_lib_var'+set}'`\\\" = set\"; then\n   echo $ac_n \"(cached) $ac_c\" 1>&6\n else\n   ac_save_LIBS=\"$LIBS\"\n LIBS=\"-lICE $X_EXTRA_LIBS $LIBS\"\n cat > conftest.$ac_ext <<EOF\n-#line 6669 \"configure\"\n+#line 6670 \"configure\"\n #include \"confdefs.h\"\n /* Override any gcc2 internal prototype to avoid an error.  */\n /* We use char because int might match the return type of a gcc2\n@@ -6676,7 +6677,7 @@ int main() {\n IceConnectionNumber()\n ; return 0; }\n EOF\n-if { (eval echo configure:6680: \\\"$ac_link\\\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest${ac_exeext}; then\n+if { (eval echo configure:6681: \\\"$ac_link\\\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest${ac_exeext}; then\n   rm -rf conftest*\n   eval \"ac_cv_lib_$ac_lib_var=yes\"\n else\n@@ -6979,6 +6980,7 @@ s%@USE_LIBDIR_FALSE@%$USE_LIBDIR_FALSE%g\n s%@NEEDS_DATA_START_TRUE@%$NEEDS_DATA_START_TRUE%g\n s%@NEEDS_DATA_START_FALSE@%$NEEDS_DATA_START_FALSE%g\n s%@GCC_UNWIND_INCLUDE@%$GCC_UNWIND_INCLUDE%g\n+s%@GCJVERSION@%$GCJVERSION%g\n s%@AM_RUNTESTFLAGS@%$AM_RUNTESTFLAGS%g\n s%@ALLOCA@%$ALLOCA%g\n s%@PERL@%$PERL%g"}, {"sha": "4e00fce4ac0ddbf50ab7ae4f184ca8afa16abcbc", "filename": "libjava/configure.in", "status": "modified", "additions": 2, "deletions": 1, "changes": 3, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/f40475404235a392b16bb7db048fc18c56af3604/libjava%2Fconfigure.in", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/f40475404235a392b16bb7db048fc18c56af3604/libjava%2Fconfigure.in", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libjava%2Fconfigure.in?ref=f40475404235a392b16bb7db048fc18c56af3604", "patch": "@@ -431,7 +431,7 @@ if test -n \"${with_cross_host}\"; then\n else\n    AC_CHECK_FUNCS(strerror ioctl select fstat open fsync sleep)\n    AC_CHECK_FUNCS(gmtime_r localtime_r readdir_r getpwuid_r getcwd)\n-   AC_CHECK_FUNCS(access stat mkdir rename rmdir unlink realpath)\n+   AC_CHECK_FUNCS(access stat mkdir rename rmdir unlink realpath utime chmod)\n    AC_CHECK_FUNCS(iconv nl_langinfo setlocale)\n    AC_CHECK_FUNCS(inet_aton inet_addr, break)\n    AC_CHECK_FUNCS(inet_pton uname inet_ntoa)\n@@ -669,6 +669,7 @@ changequote(<<,>>)\n gcjvers=\"`$GCJ -v 2>&1 | sed -n 's/^.*version \\([^ ]*\\).*$/\\1/p'`\"\n changequote([,])\n AC_DEFINE_UNQUOTED(GCJVERSION, \"$gcjvers\")\n+AC_SUBST(GCJVERSION)\n \n AC_SUBST(AM_RUNTESTFLAGS)\n "}, {"sha": "b4cdf2468ea9992b509a8a79919188f320189960", "filename": "libjava/include/config.h.in", "status": "modified", "additions": 9, "deletions": 3, "changes": 12, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/f40475404235a392b16bb7db048fc18c56af3604/libjava%2Finclude%2Fconfig.h.in", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/f40475404235a392b16bb7db048fc18c56af3604/libjava%2Finclude%2Fconfig.h.in", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libjava%2Finclude%2Fconfig.h.in?ref=f40475404235a392b16bb7db048fc18c56af3604", "patch": "@@ -135,9 +135,6 @@\n    getenv(\"GCJ_PROPERTIES\").  */\n #undef DISABLE_GETENV_PROPERTIES\n \n-/* Define if using setjmp/longjmp exceptions.  */\n-#undef SJLJ_EXCEPTIONS\n-\n /* Define if you have /proc/self/exe */\n #undef HAVE_PROC_SELF_EXE\n \n@@ -167,6 +164,9 @@\n /* Define if you have the backtrace function.  */\n #undef HAVE_BACKTRACE\n \n+/* Define if you have the chmod function.  */\n+#undef HAVE_CHMOD\n+\n /* Define if you have the execvp function.  */\n #undef HAVE_EXECVP\n \n@@ -287,6 +287,9 @@\n /* Define if you have the unlink function.  */\n #undef HAVE_UNLINK\n \n+/* Define if you have the utime function.  */\n+#undef HAVE_UTIME\n+\n /* Define if you have the <arpa/inet.h> header file.  */\n #undef HAVE_ARPA_INET_H\n \n@@ -359,6 +362,9 @@\n /* Version number of package */\n #undef VERSION\n \n+/* Define if the compiler is configured for setjmp/longjmp exceptions. */\n+#undef SJLJ_EXCEPTIONS\n+\n /* Required define if using POSIX threads */\n #undef _REENTRANT\n "}, {"sha": "8d987120161f203990bf1bb5f6c2b0424a26b654", "filename": "libjava/java/io/File.java", "status": "modified", "additions": 210, "deletions": 120, "changes": 330, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/f40475404235a392b16bb7db048fc18c56af3604/libjava%2Fjava%2Fio%2FFile.java", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/f40475404235a392b16bb7db048fc18c56af3604/libjava%2Fjava%2Fio%2FFile.java", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libjava%2Fjava%2Fio%2FFile.java?ref=f40475404235a392b16bb7db048fc18c56af3604", "patch": "@@ -1,6 +1,6 @@\n // File.java - File name\n \n-/* Copyright (C) 1998, 1999, 2000  Free Software Foundation\n+/* Copyright (C) 1998, 1999, 2000, 2001  Free Software Foundation\n \n    This file is part of libgcj.\n \n@@ -21,55 +21,57 @@\n \n /* Written using \"Java Class Libraries\", 2nd edition, ISBN 0-201-31002-3\n  * \"The Java Language Specification\", ISBN 0-201-63451-1\n- * Status:  Complete to version 1.1; 1.2 functionality missing.\n- * A known bug: most calls to the security manager can generate\n- * IOException since we use the canonical path.\n+ * Status:  Complete to version 1.3.\n  */\n \n-public class File implements Serializable\n+public class File implements Serializable, Comparable\n {\n   public boolean canRead ()\n   {\n-    return access (checkRead (), READ);\n+    checkRead();\n+    return access (READ);\n   }\n \n   public boolean canWrite ()\n   {\n-    SecurityManager s = System.getSecurityManager();\n-    String p = safeCanonicalPath ();\n-    // FIXME: it isn't entirely clear what to do if we can't find the\n-    // canonical path.\n-    if (p == null)\n-      return false;\n-    if (s != null)\n-      s.checkWrite(p);\n-    return access (p, WRITE);\n+    checkWrite();\n+    return access (WRITE);\n   }\n+  \n+  private native boolean performCreate() throws IOException;\n \n-  private final native static boolean performDelete (String canon);\n+  /** @since 1.2 */\n+  public boolean createNewFile() throws IOException\n+  {\n+    checkWrite();\n+    return performCreate();\n+  }\n+  \n+  private native boolean performDelete ();\n   public boolean delete ()\n   {\n     SecurityManager s = System.getSecurityManager();\n-    String p = safeCanonicalPath ();\n-    // FIXME: what is right?\n-    if (p == null)\n-      return false;\n+    String name = path;\n     if (s != null)\n-      s.checkDelete(p);\n-    return performDelete (p);\n+      s.checkDelete(path);\n+    return performDelete ();\n   }\n \n   public boolean equals (Object obj)\n   {\n     if (! (obj instanceof File))\n       return false;\n     File other = (File) obj;\n-    return path.compareTo(other.path) == 0;\n+    if (caseSensitive)\n+      return (path.equals(other.path));\n+    else\n+      return (path.equalsIgnoreCase(other.path));      \n   }\n \n   public boolean exists ()\n   {\n-    return access (checkRead (), EXISTS);\n+    checkRead();\n+    return access (EXISTS);\n   }\n \n   public File (String p)\n@@ -100,20 +102,23 @@ public File (File dir, String name)\n     this (dir == null ? null : dir.path, name);\n   }\n \n+  // FIXME  ???\n   public String getAbsolutePath ()\n   {\n     if (isAbsolute ())\n       return path;\n     return System.getProperty(\"user.dir\") + separatorChar + path;\n   }\n \n+  /** @since 1.2 */\n   public File getAbsoluteFile () throws IOException\n   {\n     return new File (getAbsolutePath());\n   }\n \n   public native String getCanonicalPath () throws IOException;\n \n+  /** @since 1.2 */\n   public File getCanonicalFile () throws IOException\n   {\n     return new File (getCanonicalPath());\n@@ -133,6 +138,7 @@ public String getParent ()\n     return path.substring(0, last);\n   }\n \n+  /** @since 1.2 */\n   public File getParentFile ()\n   {\n     String parent = getParent ();\n@@ -146,42 +152,85 @@ public String getPath ()\n \n   public int hashCode ()\n   {\n-    // FIXME: test.\n-    return path.hashCode();\n+    if (caseSensitive)\n+      return (path.hashCode() ^ 1234321);\n+    else\n+      return (path.toLowerCase().hashCode() ^ 1234321);\n   }\n \n   public native boolean isAbsolute ();\n \n   public boolean isDirectory ()\n   {\n-    return stat (checkRead (), DIRECTORY);\n+    checkRead();\n+    return stat (DIRECTORY);\n   }\n \n   public boolean isFile ()\n   {\n-    return stat (checkRead (), ISFILE);\n+    checkRead();\n+    return stat (ISFILE);\n+  }\n+\n+  /** @since 1.2 */\n+  public boolean isHidden()\n+  {\n+    checkRead();\n+    return stat (ISHIDDEN);\n   }\n \n   public long lastModified ()\n   {\n-    return attr (checkRead (), MODIFIED);\n+    checkRead();\n+    return attr (MODIFIED);\n   }\n \n   public long length ()\n   {\n-    return attr (checkRead (), LENGTH);\n+    checkRead();\n+    return attr (LENGTH);\n   }\n+    \n+  private final native Object[] performList (FilenameFilter filter,\n+\t\t\t\t\t     FileFilter fileFilter,\n+\t\t\t\t\t     Class result_type);\n+\n+  // Arguments for the performList function. Specifies whether we want\n+  // File objects or path strings in the returned object array.\n+  private final static int OBJECTS = 0;\n+  private final static int STRINGS = 1;\n \n-  private final native String[] performList (String canon,\n-\t\t\t\t\t     FilenameFilter filter);\n   public String[] list (FilenameFilter filter)\n   {\n-    return performList (checkRead (), filter);\n+    checkRead();\n+    return (String[]) performList (filter, null, String.class);\n   }\n \n   public String[] list ()\n   {\n-    return performList (checkRead (), null);\n+    checkRead();\n+    return (String[]) performList (null, null, String.class);\n+  }\n+\n+  /** @since 1.2 */\n+  public File[] listFiles()\n+  {\n+    checkRead();\n+    return (File[]) performList (null, null, File.class);\n+  }\n+  \n+  /** @since 1.2 */\n+  public File[] listFiles(FilenameFilter filter)\n+  {\n+    checkRead();\n+    return (File[]) performList (filter, null, File.class);\n+  }\n+  \n+  /** @since 1.2 */\n+  public File[] listFiles(FileFilter filter)\n+  {\n+    checkRead();\n+    return (File[]) performList (null, filter, File.class);\n   }\n \n   public String toString ()\n@@ -195,16 +244,10 @@ public URL toURL () throws MalformedURLException\n   }\n \n   private final native boolean performMkdir ();\n+\n   public boolean mkdir ()\n   {\n-    SecurityManager s = System.getSecurityManager();\n-    if (s != null)\n-      {\n-\t// NOTE: in theory we should use the canonical path.  In\n-\t// practice, we can't compute the canonical path until we've\n-\t// made this completely.  Lame.\n-\ts.checkWrite(path);\n-      }\n+    checkWrite();\n     return performMkdir ();\n   }\n \n@@ -216,25 +259,17 @@ private static boolean mkdirs (File x)\n     String parent = x.getParent();\n     if (parent != null)\n       {\n-\tx.setPath(parent);\n+\tx.path = parent;\n \tif (! mkdirs (x))\n \t  return false;\n-\tx.setPath(p);\n+\tx.path = p;\n       }\n     return x.mkdir();\n   }\n \n   public boolean mkdirs ()\n   {\n-    SecurityManager s = System.getSecurityManager();\n-    if (s != null)\n-      {\n-\t// NOTE: in theory we should use the canonical path.  In\n-\t// practice, we can't compute the canonical path until we've\n-\t// made this completely.  Lame.\n-\ts.checkWrite(path);\n-      }\n-\n+    checkWrite();\n     if (isDirectory ())\n       return false;\n     return mkdirs (new File (path));\n@@ -245,6 +280,7 @@ private static synchronized String nextValue ()\n     return Long.toString(counter++, Character.MAX_RADIX);\n   }\n \n+  /** @since 1.2 */\n   public static File createTempFile (String prefix, String suffix,\n \t\t\t\t     File directory)\n     throws IOException\n@@ -272,19 +308,16 @@ public static File createTempFile (String prefix, String suffix,\n     if (suffix == null)\n       suffix = \".tmp\";\n \n-    // FIXME: filename length varies by architecture and filesystem.\n-    int max_length = 255;\n-\n     // Truncation rules.\n     // `6' is the number of characters we generate.\n-    if (prefix.length () + 6 + suffix.length () > max_length)\n+    if (prefix.length () + 6 + suffix.length () > maxPathLen)\n       {\n \tint suf_len = 0;\n \tif (suffix.charAt(0) == '.')\n \t  suf_len = 4;\n \tsuffix = suffix.substring(0, suf_len);\n-\tif (prefix.length () + 6 + suf_len > max_length)\n-\t  prefix = prefix.substring(0, max_length - 6 - suf_len);\n+\tif (prefix.length () + 6 + suf_len > maxPathLen)\n+\t  prefix = prefix.substring(0, maxPathLen - 6 - suf_len);\n       }\n \n     File f;\n@@ -298,60 +331,130 @@ public static File createTempFile (String prefix, String suffix,\n \ttry\n \t  {\n \t    f = new File(directory, l);\n-\t    if (f.exists())\n-\t      continue;\n-\t    else\n-\t      {\n-\t\tString af = f.getAbsolutePath ();\n-\t\t\n-\t\t// Check to see if we're allowed to write to it.\n-\t\tSecurityManager s = System.getSecurityManager();\n-\t\tif (s != null)\n-\t\t  s.checkWrite (af);\n-\t\t\n-\t\t// Now create the file.\n-\t\tFileDescriptor fd = \n-\t\t  new FileDescriptor (af, \n-\t\t\t\t      FileDescriptor.WRITE\n-\t\t\t\t      | FileDescriptor.EXCL);\n-\t\tfd.close ();\n-\t\treturn f;\n-\t      }\n+\t    if (f.createNewFile())\n+\t      return f;\n \t  }\n-\tcatch (IOException _)\n+\tcatch (IOException ignored)\n \t  {\n \t  }\n       }\n \n     throw new IOException (\"cannot create temporary file\");\n   }\n \n+  private native boolean performSetReadOnly();\n+\n+  /** @since 1.2 */\n+  public boolean setReadOnly()\n+  {\n+    checkWrite();\n+    return performSetReadOnly();\n+  }\n+\n+  private static native File[] performListRoots();\n+\n+  /** @since 1.2 */\n+  public static File[] listRoots()\n+  {\n+    File[] roots = performListRoots();\n+    \n+    SecurityManager s = System.getSecurityManager();\n+    if (s != null)\n+      {\n+\t// Only return roots to which the security manager permits read access.\n+\tint count = roots.length;\n+\tfor (int i = 0; i < roots.length; i++)\n+\t  {\n+\t    try\n+\t      {\n+        \ts.checkRead(roots[i].path);\t\t\n+\t      }\n+\t    catch (SecurityException sx)\n+\t      {\n+\t        roots[i] = null;\n+\t\tcount--;\n+\t      }\n+\t  }\n+\tif (count != roots.length)\n+\t  {\n+\t    File[] newRoots = new File[count];\n+\t    int k = 0;\n+\t    for (int i=0; i < roots.length; i++)\n+\t      {\n+\t        if (roots[i] != null)\n+\t\t  newRoots[k++] = roots[i];\n+\t      }\n+\t    roots = newRoots;\n+\t  }\n+      }\n+    return roots;\n+  }\n+\n   public static File createTempFile (String prefix, String suffix)\n     throws IOException\n   {\n     return createTempFile (prefix, suffix, null);\n   }\n \n-  private final native boolean performRenameTo (File dest);\n+  /** @since 1.2 */\n+  public int compareTo(File other)\n+  {\n+    if (caseSensitive)\n+      return path.compareTo (other.path);\n+    else\n+      return path.compareToIgnoreCase (other.path);\n+  }\n+\n+  /** @since 1.2 */\n+  public int compareTo(Object o)\n+  {\n+    File other = (File) o;\n+    return compareTo (other);\n+  }\n+\n+  private native boolean performRenameTo (File dest);\n   public boolean renameTo (File dest)\n   {\n     SecurityManager s = System.getSecurityManager();\n+    String sname = getName();\n+    String dname = dest.getName();\n     if (s != null)\n       {\n-\t// FIXME: JCL doesn't specify which path to check.  We check the\n-\t// source since we can canonicalize it.\n-\ts.checkWrite(safeCanonicalPath());\n+\ts.checkWrite(sname);\n+\ts.checkWrite(dname);\n       }\n     return performRenameTo (dest);\n   }\n \n-  public static final String pathSeparator\n-    = System.getProperty(\"path.separator\");\n-  public static final char pathSeparatorChar = pathSeparator.charAt(0);\n-  public static final String separator = System.getProperty(\"file.separator\");\n-  public static final char separatorChar = separator.charAt(0);\n+  private native boolean performSetLastModified(long time);\n+  \n+  /** @since 1.2 */\n+  public boolean setLastModified(long time)\n+  {\n+    checkWrite();\n+    return performSetLastModified(time);\n+  }\n \n-  private static final String tmpdir = System.getProperty(\"java.io.tmpdir\");\n+  public static final String separator = null;\n+  public static final String pathSeparator = null;\n+  static final String tmpdir = null;\n+  static int maxPathLen;\n+  static boolean caseSensitive;\n+  \n+  public static final char separatorChar;\n+  public static final char pathSeparatorChar;\n+  \n+  static\n+  {\n+    init_native();\n+    pathSeparatorChar = pathSeparator.charAt(0);\n+    separatorChar = separator.charAt(0);\n+  }\n+  \n+  // Native function called at class initialization. This should should\n+  // set the separator, pathSeparator, tmpdir, maxPathLen, and caseSensitive\n+  // variables.\n+  private static native void init_native();\n \n   // The path.\n   private String path;\n@@ -360,41 +463,27 @@ public boolean renameTo (File dest)\n   // value randomly to try to avoid clashes with other VMs.\n   private static long counter = Double.doubleToLongBits (Math.random ());\n \n-  // mkdirs() uses this to avoid repeated allocations.\n-  private final void setPath (String n)\n-  {\n-    path = n;\n-  }\n-\n-\n-  private final String checkRead ()\n+  private void checkWrite ()\n   {\n     SecurityManager s = System.getSecurityManager();\n-    String p = safeCanonicalPath ();\n-    if (p == null)\n-      return null;\n     if (s != null)\n-      s.checkRead(p);\n-    return p;\n+      s.checkWrite(path);\n   }\n \n-  // Return canonical path, or null.\n-  private final String safeCanonicalPath ()\n+  private void checkRead ()\n   {\n-    String p = null;\n-    try\n-      {\n-\tp = getCanonicalPath ();\n-      }\n-    catch (IOException x)\n-      {\n-\t// Nothing.\n-      }\n-    return p;\n+    SecurityManager s = System.getSecurityManager();\n+    if (s != null)\n+      s.checkRead(path);\n   }\n \n-  // Add this File to the set of files to be deleted upon normal\n-  // termination.\n+  /** \n+    * Add this File to the set of files to be deleted upon normal\n+    * termination.\n+    *\n+    * @since 1.2 \n+    */\n+  // FIXME: This should use the ShutdownHook API once we implement that.\n   public void deleteOnExit ()\n   {\n     SecurityManager sm = System.getSecurityManager ();\n@@ -430,14 +519,15 @@ private void readObject (ObjectInputStream ois)\n   // QUERY arguments to stat function.\n   private final static int DIRECTORY = 0;\n   private final static int ISFILE = 1;\n+  private final static int ISHIDDEN = 2;\n \n   // QUERY arguments to attr function.\n   private final static int MODIFIED = 0;\n   private final static int LENGTH = 1;\n-\n-  private final native long attr (String p, int query);\n-  private final native boolean access (String p, int query);\n-  private final native boolean stat (String p, int query);\n+  \n+  private final native long attr (int query);\n+  private final native boolean access (int query);\n+  private final native boolean stat (int query);\n \n   private static final long serialVersionUID = 301077366599181567L;\n }"}, {"sha": "e0f27b9dccec62fe10bd666ea861f448ab7d883a", "filename": "libjava/java/io/natFile.cc", "status": "modified", "additions": 132, "deletions": 50, "changes": 182, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/f40475404235a392b16bb7db048fc18c56af3604/libjava%2Fjava%2Fio%2FnatFile.cc", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/f40475404235a392b16bb7db048fc18c56af3604/libjava%2Fjava%2Fio%2FnatFile.cc", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libjava%2Fjava%2Fio%2FnatFile.cc?ref=f40475404235a392b16bb7db048fc18c56af3604", "patch": "@@ -1,6 +1,6 @@\n-// natFile.cc - Native part of File class.\n+// natFile.cc - Native part of File class for POSIX.\n \n-/* Copyright (C) 1998, 1999, 2000  Free Software Foundation\n+/* Copyright (C) 1998, 1999, 2000, 2001  Free Software Foundation\n \n    This file is part of libgcj.\n \n@@ -24,23 +24,23 @@ details.  */\n #include <dirent.h>\n #endif\n #include <string.h>\n+#include <utime.h>\n \n #include <gcj/cni.h>\n #include <jvm.h>\n #include <java/io/File.h>\n #include <java/io/IOException.h>\n-#include <java/util/Vector.h>\n+#include <java/util/ArrayList.h>\n #include <java/lang/String.h>\n #include <java/io/FilenameFilter.h>\n+#include <java/io/FileFilter.h>\n #include <java/lang/System.h>\n \n jboolean\n-java::io::File::access (jstring canon, jint query)\n+java::io::File::access (jint query)\n {\n-  if (! canon)\n-    return false;\n   char buf[MAXPATHLEN];\n-  jsize total = JvGetStringUTFRegion (canon, 0, canon->length(), buf);\n+  jsize total = JvGetStringUTFRegion (path, 0, path->length(), buf);\n   // FIXME?\n   buf[total] = '\\0';\n   JvAssert (query == READ || query == WRITE || query == EXISTS);\n@@ -59,15 +59,16 @@ java::io::File::access (jstring canon, jint query)\n }\n \n jboolean\n-java::io::File::stat (jstring canon, jint query)\n+java::io::File::stat (jint query)\n {\n-  if (! canon)\n-    return false;\n   char buf[MAXPATHLEN];\n-  jsize total = JvGetStringUTFRegion (canon, 0, canon->length(), buf);\n+  jsize total = JvGetStringUTFRegion (path, 0, path->length(), buf);\n   // FIXME?\n   buf[total] = '\\0';\n \n+  if (query == ISHIDDEN)\n+    return (getName()->charAt(0) == '.');\n+\n #ifdef HAVE_STAT\n   struct stat sb;\n   if (::stat (buf, &sb))\n@@ -82,13 +83,10 @@ java::io::File::stat (jstring canon, jint query)\n }\n \n jlong\n-java::io::File::attr (jstring canon, jint query)\n+java::io::File::attr (jint query)\n {\n-  if (! canon)\n-    return false;\n-\n   char buf[MAXPATHLEN];\n-  jsize total = JvGetStringUTFRegion (canon, 0, canon->length(), buf);\n+  jsize total = JvGetStringUTFRegion (path, 0, path->length(), buf);\n   // FIXME?\n   buf[total] = '\\0';\n \n@@ -99,8 +97,6 @@ java::io::File::attr (jstring canon, jint query)\n     return 0;\n \n   JvAssert (query == MODIFIED || query == LENGTH);\n-  // FIXME: time computation is very POSIX-specific -- POSIX and Java\n-  // have the same Epoch.\n   return query == MODIFIED ? (jlong)sb.st_mtime * 1000 : sb.st_size;\n #else\n   // There's no good choice here.\n@@ -131,23 +127,7 @@ java::io::File::getCanonicalPath (void)\n jboolean\n java::io::File::isAbsolute (void)\n {\n-  // FIXME: cpp define name.\n-  // FIXME: cygwin.\n-#ifdef WIN32\n-  if (path->charAt(0) == '/' || path->charAt(0) == '\\\\')\n-    return true;\n-  if (path->length() < 3)\n-    return false;\n-  // Hard-code A-Za-z because Windows (I think) can't use non-ASCII\n-  // letters as drive names.\n-  if ((path->charAt(0) < 'a' || path->charAt(0) > 'z')\n-      && (path->charAt(0) < 'A' || path->charAt(0) > 'Z'))\n-    return false;\n-  return (path->charAt(1) == ':'\n-\t  && (path->charAt(2) == '/' || path->charAt(2) == '\\\\'));\n-#else\n   return path->charAt(0) == '/';\n-#endif\n }\n \n #ifdef HAVE_DIRENT_H\n@@ -173,42 +153,52 @@ get_entry (DIR *dir, struct dirent *)\n #endif /* defined(__JV_POSIX_THREADS__) && defined(HAVE_READDIR_R) */\n #endif /* HAVE_DIRENT_H */\n \n-jstringArray\n-java::io::File::performList (jstring canon, FilenameFilter *filter)\n+jobjectArray\n+java::io::File::performList (java::io::FilenameFilter *filter, \n+\t\t\t     java::io::FileFilter *fileFilter, \n+\t\t\t     java::lang::Class *result_type)\n {\n-  if (! canon)\n-    return NULL;\n-\n #ifdef HAVE_DIRENT_H\n   char buf[MAXPATHLEN];\n-  jsize total = JvGetStringUTFRegion (canon, 0, canon->length(), buf);\n+  jsize total = JvGetStringUTFRegion (path, 0, path->length(), buf);\n   // FIXME?\n   buf[total] = '\\0';\n \n   DIR *dir = opendir (buf);\n   if (! dir)\n     return NULL;\n \n-  java::util::Vector *vec = new java::util::Vector ();\n+  java::util::ArrayList *list = new java::util::ArrayList ();\n   struct dirent *d, d2;\n   while ((d = get_entry (dir, &d2)) != NULL)\n     {\n-      if (! strcmp (d->d_name, \".\") || ! strcmp (d->d_name, \"..\"))\n+      // Omit \".\" and \"..\".\n+      if (d->d_name[0] == '.'\n+\t  && (d->d_name[1] == '\\0'\n+\t      || (d->d_name[1] == '.' && d->d_name[2] == '\\0')))\n \tcontinue;\n \n       jstring name = JvNewStringUTF (d->d_name);\n       if (filter && ! filter->accept(this, name))\n \tcontinue;\n-\n-      vec->addElement(name);\n+      \n+      if (result_type == &java::io::File::class$)\n+        {\n+\t  java::io::File *file = new java::io::File (this, name);\n+\t  if (fileFilter && ! fileFilter->accept(file))\n+\t    continue;\n+\n+\t  list->add(file);\n+\t}\n+      else\n+\tlist->add(name);\n     }\n \n   closedir (dir);\n \n-  jobjectArray ret = JvNewObjectArray (vec->size(), canon->getClass(),\n-\t\t\t\t       NULL);\n-  vec->copyInto(ret);\n-  return reinterpret_cast<jstringArray> (ret);\n+  jobjectArray ret = JvNewObjectArray (list->size(), result_type, NULL);\n+  list->toArray(ret);\n+  return ret;\n #else /* HAVE_DIRENT_H */\n   return NULL;\n #endif /* HAVE_DIRENT_H */\n@@ -229,6 +219,42 @@ java::io::File::performMkdir (void)\n #endif\n }\n \n+jboolean\n+java::io::File::performSetReadOnly (void)\n+{\n+  char buf[MAXPATHLEN];\n+  jsize total = JvGetStringUTFRegion (path, 0, path->length(), buf);\n+  // FIXME?\n+  buf[total] = '\\0';\n+\n+#ifdef HAVE_STAT && HAVE_CHMOD\n+  struct stat sb;\n+  if (::stat (buf, &sb))\n+    return false;\n+\n+  if (::chmod(buf, sb.st_mode & 0555))\n+    return false;  \n+  return true;\n+#else\n+  return false;\n+#endif\n+}\n+\n+static JArray<java::io::File *> *unixroot;\n+\n+JArray< ::java::io::File *>*\n+java::io::File::performListRoots ()\n+{\n+  if (unixroot == NULL)\n+    {\n+      ::java::io::File *f = new ::java::io::File (JvNewStringLatin1 (\"/\"));\n+      unixroot = reinterpret_cast <JArray<java::io::File *>*> \n+\t\t   (JvNewObjectArray (1, &java::io::File::class$, f));\n+      elements (unixroot) [0] = f;\n+    }\n+  return unixroot;\n+}\n+\n jboolean\n java::io::File::performRenameTo (File *dest)\n {\n@@ -249,10 +275,52 @@ java::io::File::performRenameTo (File *dest)\n }\n \n jboolean\n-java::io::File::performDelete (jstring canon)\n+java::io::File::performSetLastModified (jlong time)\n+{\n+#ifdef HAVE_UTIME\n+  utimbuf tb;\n+\n+  char buf[MAXPATHLEN];\n+  jsize total = JvGetStringUTFRegion (path, 0, path->length(), buf);\n+  // FIXME?\n+  buf[total] = '\\0';\n+  \n+  tb.actime = time / 1000;\n+  tb.modtime = time / 1000;\n+  return ::utime (buf, &tb);\n+#else\n+  return false;\n+#endif\n+}\n+\n+jboolean\n+java::io::File::performCreate (void)\n+{\n+  char buf[MAXPATHLEN];\n+  jsize total = JvGetStringUTFRegion (path, 0, path->length(), buf);\n+  // FIXME?\n+  buf[total] = '\\0';\n+\n+  int fd = ::open (buf, O_CREAT | O_EXCL, 0644);\n+\n+  if (fd < 0)\n+    {\n+      if (errno == EEXIST)\n+        return false;\n+      throw new IOException (JvNewStringLatin1 (strerror (errno)));\n+    }\n+  else\n+    {\n+      ::close (fd);\n+      return true;\n+    }\n+}\n+\n+jboolean\n+java::io::File::performDelete (void)\n {\n   char buf[MAXPATHLEN];\n-  jsize total = JvGetStringUTFRegion (canon, 0, canon->length(), buf);\n+  jsize total = JvGetStringUTFRegion (path, 0, path->length(), buf);\n   // FIXME?\n   buf[total] = '\\0';\n \n@@ -266,3 +334,17 @@ java::io::File::performDelete (jstring canon)\n #endif // HAVE_UNLINK\n   return false;\n }\n+\n+void\n+java::io::File::init_native ()\n+{\n+  separator = JvNewStringLatin1 (\"/\");\n+  pathSeparator = JvNewStringLatin1 (\":\");\n+  \n+  char *tmp = ::getenv(\"TMPDIR\");\n+  if (! tmp)\n+    tmp = \"/tmp\";\n+  tmpdir = JvNewStringLatin1 (tmp);\n+  maxPathLen = MAXPATHLEN;\n+  caseSensitive = true;\n+}"}, {"sha": "2f0b8afcc75313097e610da90ff31af9d47303f5", "filename": "libjava/java/io/natFileWin32.cc", "status": "modified", "additions": 71, "deletions": 25, "changes": 96, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/f40475404235a392b16bb7db048fc18c56af3604/libjava%2Fjava%2Fio%2FnatFileWin32.cc", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/f40475404235a392b16bb7db048fc18c56af3604/libjava%2Fjava%2Fio%2FnatFileWin32.cc", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libjava%2Fjava%2Fio%2FnatFileWin32.cc?ref=f40475404235a392b16bb7db048fc18c56af3604", "patch": "@@ -1,6 +1,6 @@\n-// natFileWin32.cc - Native part of File class.\n+// natFileWin32.cc - Native part of File class for Win32.\n \n-/* Copyright (C) 1998, 1999  Red Hat, Inc.\n+/* Copyright (C) 1998, 1999, 2001  Red Hat, Inc.\n \n    This file is part of libgcj.\n \n@@ -25,12 +25,10 @@ details.  */\n #include <java/lang/System.h>\n \n jboolean\n-java::io::File::access (jstring canon, jint query)\n+java::io::File::access (jint query)\n {\n-  if (! canon)\n-    return false;\n   char buf[MAX_PATH];\n-  jsize total = JvGetStringUTFRegion (canon, 0, canon->length(), buf);\n+  jsize total = JvGetStringUTFRegion (path, 0, path->length(), buf);\n   // FIXME?\n   buf[total] = '\\0';\n \n@@ -48,15 +46,15 @@ java::io::File::access (jstring canon, jint query)\n }\n \n jboolean\n-java::io::File::stat (jstring canon, jint query)\n+java::io::File::stat (jint query)\n {\n-  if (! canon)\n-    return false;\n   char buf[MAX_PATH];\n-  jsize total = JvGetStringUTFRegion (canon, 0, canon->length(), buf);\n+  jsize total = JvGetStringUTFRegion (path, 0, path->length(), buf);\n   // FIXME?\n   buf[total] = '\\0';\n \n+  // FIXME: Need to handle ISHIDDEN query.\n+\n   JvAssert (query == DIRECTORY || query == ISFILE);\n \n   DWORD attributes = GetFileAttributes (buf);\n@@ -70,12 +68,10 @@ java::io::File::stat (jstring canon, jint query)\n }\n \n jlong\n-java::io::File::attr (jstring canon, jint query)\n+java::io::File::attr (jint query)\n {\n-  if (! canon)\n-    return false;\n   char buf[MAX_PATH];\n-  jsize total = JvGetStringUTFRegion (canon, 0, canon->length(), buf);\n+  jsize total = JvGetStringUTFRegion (path, 0, path->length(), buf);\n   // FIXME?\n   buf[total] = '\\0';\n \n@@ -128,12 +124,12 @@ java::io::File::isAbsolute (void)\n }\n \n jstringArray\n-java::io::File::performList (jstring canon, FilenameFilter *filter)\n+java::io::File::performList (java::io::FilenameFilter *filter, \n+\t\t\t     java::io::FileFilter *fileFilter, \n+\t\t\t     java::lang::Class *result_type)\n {\n-  if (! canon)\n-    return NULL;\n   char buf[MAX_PATH];\n-  jsize total = JvGetStringUTFRegion (canon, 0, canon->length(), buf);\n+  jsize total = JvGetStringUTFRegion (path, 0, path->length(), buf);\n   // FIXME?\n   strcpy(&buf[total], \"\\\\*.*\");\n \n@@ -142,16 +138,28 @@ java::io::File::performList (jstring canon, FilenameFilter *filter)\n   if (handle == INVALID_HANDLE_VALUE)\n     return NULL;\n \n-  java::util::Vector *vec = new java::util::Vector ();\n+  java::util::ArrayList *list = new java::util::ArrayList ();\n \n   do\n     {\n       if (strcmp (data.cFileName, \".\") && strcmp (data.cFileName, \"..\"))\n         {\n           jstring name = JvNewStringUTF (data.cFileName);\n-          if (! filter || (filter && filter->accept(this, name)))\n-            vec->addElement (name);\n-        }\n+\n+\t  if (filter && ! filter->accept(this, name))\n+\t    continue;\n+\n+\t  if (result_type == &java::io::File::class$)\n+            {\n+\t      java::io::File *file = new java::io::File (this, name);\n+\t      if (fileFilter && ! fileFilter->accept(file))\n+\t\tcontinue;\n+\n+\t      list->add(file);\n+\t    }\n+\t  else\n+\t    list->add(name);\n+\t}\n     }\n   while (FindNextFile (handle, &data));\n \n@@ -160,7 +168,7 @@ java::io::File::performList (jstring canon, FilenameFilter *filter)\n \n   FindClose (handle);\n \n-  jobjectArray ret = JvNewObjectArray (vec->size(), canon->getClass(), NULL);\n+  jobjectArray ret = JvNewObjectArray (vec->size(), path->getClass(), NULL);\n   vec->copyInto (ret);\n   return reinterpret_cast<jstringArray> (ret);\n }\n@@ -176,6 +184,20 @@ java::io::File::performMkdir (void)\n   return (CreateDirectory(buf, NULL)) ? true : false;\n }\n \n+jboolean\n+java::io::File::performSetReadOnly (void)\n+{\n+  // PLEASE IMPLEMENT ME\n+  return false;\n+}\n+\n+JArray< ::java::io::File *>*\n+java::io::File::performListRoots ()\n+{\n+  // PLEASE IMPLEMENT ME\n+  return NULL;\n+}\n+\n jboolean\n java::io::File::performRenameTo (File *dest)\n {\n@@ -192,10 +214,24 @@ java::io::File::performRenameTo (File *dest)\n }\n \n jboolean\n-java::io::File::performDelete (jstring canon)\n+java::io::File::performSetLastModified (jlong time)\n+{\n+  // PLEASE IMPLEMENT ME\n+  return false;\n+}\n+\n+jboolean\n+java::io::File::performCreate (void)\n+{\n+  // PLEASE IMPLEMENT ME\n+  return false;\n+}\n+\n+jboolean\n+java::io::File::performDelete ()\n {\n   char buf[MAX_PATH];\n-  jsize total = JvGetStringUTFRegion(canon, 0, canon->length(), buf);\n+  jsize total = JvGetStringUTFRegion(path, 0, path->length(), buf);\n   // FIXME?\n   buf[total] = '\\0';\n \n@@ -208,3 +244,13 @@ java::io::File::performDelete (jstring canon)\n   else\n     return (DeleteFile (buf)) ? true : false;\n }\n+\n+void\n+java::io::File::init_native ()\n+{\n+  separator = JvNewStringLatin1 (\"\\\\\");\n+  pathSeparator = JvNewStringLatin1 (\";\");\n+  tmpdir = JvNewStringLatin1 (\"C:\\\\temp\"); // FIXME?\n+  maxPathLen = MAX_PATH;\n+  caseSensitive = false;\n+}"}, {"sha": "ee1d9988ca704a823fd6089b9ad00a97c9685a3a", "filename": "libjava/java/lang/natSystem.cc", "status": "modified", "additions": 9, "deletions": 9, "changes": 18, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/f40475404235a392b16bb7db048fc18c56af3604/libjava%2Fjava%2Flang%2FnatSystem.cc", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/f40475404235a392b16bb7db048fc18c56af3604/libjava%2Fjava%2Flang%2FnatSystem.cc", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libjava%2Fjava%2Flang%2FnatSystem.cc?ref=f40475404235a392b16bb7db048fc18c56af3604", "patch": "@@ -55,6 +55,7 @@ details.  */\n #include <java/lang/StringBuffer.h>\n #include <java/util/Properties.h>\n #include <java/util/TimeZone.h>\n+#include <java/io/File.h>\n #include <java/io/PrintStream.h>\n #include <java/io/InputStream.h>\n \n@@ -323,20 +324,19 @@ java::lang::System::init_properties (void)\n   \n   SET (\"file.encoding\", default_file_encoding);\n \n+  JvInitClass (&java::io::File::class$);  \n+  newprops->put (JvNewStringLatin1 (\"file.separator\"), \n+\t\t java::io::File::separator);\n+  newprops->put (JvNewStringLatin1 (\"path.separator\"),\n+\t\t java::io::File::pathSeparator);\n+  newprops->put (JvNewStringLatin1 (\"java.io.tmpdir\"), \n+\t\t java::io::File::tmpdir);\n+\n #ifdef WIN32\n-  SET (\"file.separator\", \"\\\\\");\n-  SET (\"path.separator\", \";\");\n   SET (\"line.separator\", \"\\r\\n\");\n-  SET (\"java.io.tmpdir\", \"C:\\\\temp\");\n #else\n   // Unix.\n-  SET (\"file.separator\", \"/\");\n-  SET (\"path.separator\", \":\");\n   SET (\"line.separator\", \"\\n\");\n-  char *tmpdir = ::getenv(\"TMPDIR\");\n-  if (! tmpdir)\n-    tmpdir = \"/tmp\";\n-  SET (\"java.io.tmpdir\", tmpdir);\n #endif\n \n #ifdef HAVE_UNAME"}]}