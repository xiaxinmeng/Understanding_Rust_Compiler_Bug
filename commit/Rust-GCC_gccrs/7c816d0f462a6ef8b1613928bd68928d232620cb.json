{"sha": "7c816d0f462a6ef8b1613928bd68928d232620cb", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6N2M4MTZkMGY0NjJhNmVmOGIxNjEzOTI4YmQ2ODkyOGQyMzI2MjBjYg==", "commit": {"author": {"name": "Christian Bruel", "email": "christian.bruel@st.com", "date": "2016-01-22T14:16:47Z"}, "committer": {"name": "Christian Bruel", "email": "chrbr@gcc.gnu.org", "date": "2016-01-22T14:16:47Z"}, "message": "[multiple changes]\n\n2016-01-22  Christian Bruel  <christian.bruel@st.com>\n\n\tPR target/68674\n\t* expr.c (expand_expr_real_1): Reset DECL_MODE if VECTOR_TYPE_P changed.\n\n// testsuite\n2016-01-21  Christian Bruel  <christian.bruel@st.com>\n\n\tPR target/68674\n\t* gcc.target/i386/pr68674.c\n\t* gcc.target/aarch64/pr68674.c\n\t* gcc.target/arm/pr68674.c\n\nFrom-SVN: r232728", "tree": {"sha": "80a6e36f10b35eb5f573e1f07a79f7ef15a859ad", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/80a6e36f10b35eb5f573e1f07a79f7ef15a859ad"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/7c816d0f462a6ef8b1613928bd68928d232620cb", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/7c816d0f462a6ef8b1613928bd68928d232620cb", "html_url": "https://github.com/Rust-GCC/gccrs/commit/7c816d0f462a6ef8b1613928bd68928d232620cb", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/7c816d0f462a6ef8b1613928bd68928d232620cb/comments", "author": null, "committer": null, "parents": [{"sha": "fce661e8d5495d871e01b4bf6afd26203ed8fa7a", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/fce661e8d5495d871e01b4bf6afd26203ed8fa7a", "html_url": "https://github.com/Rust-GCC/gccrs/commit/fce661e8d5495d871e01b4bf6afd26203ed8fa7a"}], "stats": {"total": 86, "additions": 85, "deletions": 1}, "files": [{"sha": "a20f8606e628affb23901112a30098754ec29465", "filename": "gcc/ChangeLog", "status": "modified", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/7c816d0f462a6ef8b1613928bd68928d232620cb/gcc%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/7c816d0f462a6ef8b1613928bd68928d232620cb/gcc%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2FChangeLog?ref=7c816d0f462a6ef8b1613928bd68928d232620cb", "patch": "@@ -1,3 +1,8 @@\n+2016-01-22  Christian Bruel  <christian.bruel@st.com>\n+\n+\tPR target/68674\n+\t* expr.c (expand_expr_real_1): Reset DECL_MODE if VECTOR_TYPE_P changed.\n+\n 2016-01-22  Kyrylo Tkachov  <kyrylo.tkachov@arm.com>\n \n \tPR target/69403"}, {"sha": "3b7f1355eb3e7bfe41fe9cabf00d54a6ce609c02", "filename": "gcc/expr.c", "status": "modified", "additions": 10, "deletions": 1, "changes": 11, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/7c816d0f462a6ef8b1613928bd68928d232620cb/gcc%2Fexpr.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/7c816d0f462a6ef8b1613928bd68928d232620cb/gcc%2Fexpr.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fexpr.c?ref=7c816d0f462a6ef8b1613928bd68928d232620cb", "patch": "@@ -9597,7 +9597,16 @@ expand_expr_real_1 (tree exp, rtx target, machine_mode tmode,\n       decl_rtl = DECL_RTL (exp);\n     expand_decl_rtl:\n       gcc_assert (decl_rtl);\n-      decl_rtl = copy_rtx (decl_rtl);\n+\n+      /* DECL_MODE might change when TYPE_MODE depends on attribute target\n+\t settings for VECTOR_TYPE_P that might switch for the function.  */\n+      if (currently_expanding_to_rtl\n+\t  && code == VAR_DECL && MEM_P (decl_rtl)\n+\t  && VECTOR_TYPE_P (type) && exp && DECL_MODE (exp) != mode)\n+\tdecl_rtl = change_address (decl_rtl, TYPE_MODE (type), 0);\n+      else\n+\tdecl_rtl = copy_rtx (decl_rtl);\n+\n       /* Record writes to register variables.  */\n       if (modifier == EXPAND_WRITE\n \t  && REG_P (decl_rtl)"}, {"sha": "1cd3aab4e004b37439ce5ef8ea47be1980025253", "filename": "gcc/testsuite/ChangeLog", "status": "modified", "additions": 7, "deletions": 0, "changes": 7, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/7c816d0f462a6ef8b1613928bd68928d232620cb/gcc%2Ftestsuite%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/7c816d0f462a6ef8b1613928bd68928d232620cb/gcc%2Ftestsuite%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2FChangeLog?ref=7c816d0f462a6ef8b1613928bd68928d232620cb", "patch": "@@ -1,3 +1,10 @@\n+2016-01-21  Christian Bruel  <christian.bruel@st.com>\n+\n+\tPR target/68674\n+\t* gcc.target/i386/pr68674.c\n+\t* gcc.target/aarch64/pr68674.c\n+\t* gcc.target/arm/pr68674.c\n+\n 2016-01-22  Kyrylo Tkachov  <kyrylo.tkachov@arm.com>\n \n \tPR target/69403"}, {"sha": "c8acce3b46b7d8a4fc2c808fe0a080c939058f4f", "filename": "gcc/testsuite/gcc.target/aarch64/pr68674.c", "status": "added", "additions": 22, "deletions": 0, "changes": 22, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/7c816d0f462a6ef8b1613928bd68928d232620cb/gcc%2Ftestsuite%2Fgcc.target%2Faarch64%2Fpr68674.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/7c816d0f462a6ef8b1613928bd68928d232620cb/gcc%2Ftestsuite%2Fgcc.target%2Faarch64%2Fpr68674.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgcc.target%2Faarch64%2Fpr68674.c?ref=7c816d0f462a6ef8b1613928bd68928d232620cb", "patch": "@@ -0,0 +1,22 @@\n+/* PR target/68674 */\n+/* { dg-do compile } */\n+/* { dg-options \"-O2 -mcpu=generic+nosimd\" } */\n+\n+#include <arm_neon.h>\n+\n+int8x8_t a;\n+extern int8x8_t b;\n+int16x8_t e;\n+\n+void __attribute__((target(\"+simd\")))\n+foo1(void)\n+{\n+  e = (int16x8_t) vaddl_s8(a, b);\n+}\n+\n+int8x8_t __attribute__((target(\"+simd\")))\n+foo2(void)\n+{\n+  return a;\n+}\n+"}, {"sha": "a31a88a87b4c9d37b4a084220092a6a47295cead", "filename": "gcc/testsuite/gcc.target/arm/pr68674.c", "status": "added", "additions": 26, "deletions": 0, "changes": 26, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/7c816d0f462a6ef8b1613928bd68928d232620cb/gcc%2Ftestsuite%2Fgcc.target%2Farm%2Fpr68674.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/7c816d0f462a6ef8b1613928bd68928d232620cb/gcc%2Ftestsuite%2Fgcc.target%2Farm%2Fpr68674.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgcc.target%2Farm%2Fpr68674.c?ref=7c816d0f462a6ef8b1613928bd68928d232620cb", "patch": "@@ -0,0 +1,26 @@\n+/* PR target/68674 */\n+/* { dg-do compile } */\n+/* { dg-require-effective-target arm_neon_ok } */\n+/* { dg-options \"-O2 -mfloat-abi=softfp\" } */\n+\n+#pragma GCC target (\"fpu=vfp\")\n+\n+#include <arm_neon.h>\n+\n+int8x8_t a;\n+extern int8x8_t b;\n+int16x8_t e;\n+\n+void __attribute__((target(\"fpu=neon\")))\n+foo1(void)\n+{\n+  e = (int16x8_t) vaddl_s8(a, b);\n+}\n+\n+int8x8_t __attribute__((target(\"fpu=neon\")))\n+foo2(void)\n+{\n+  return b;\n+}\n+\n+"}, {"sha": "37c57592fec15930ef8c9124ee6a399b65489d00", "filename": "gcc/testsuite/gcc.target/i386/pr68674.c", "status": "added", "additions": 15, "deletions": 0, "changes": 15, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/7c816d0f462a6ef8b1613928bd68928d232620cb/gcc%2Ftestsuite%2Fgcc.target%2Fi386%2Fpr68674.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/7c816d0f462a6ef8b1613928bd68928d232620cb/gcc%2Ftestsuite%2Fgcc.target%2Fi386%2Fpr68674.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgcc.target%2Fi386%2Fpr68674.c?ref=7c816d0f462a6ef8b1613928bd68928d232620cb", "patch": "@@ -0,0 +1,15 @@\n+/* PR target/68674 */\n+/* { dg-do compile } */\n+/* { dg-require-effective-target avx } */\n+/* { dg-options \"-O2\" } */\n+\n+typedef int v8si __attribute__((vector_size(32)));\n+\n+v8si a;\n+\n+ __attribute__((target(\"avx\")))\n+v8si\n+foo()\n+{\n+    return a;\n+}"}]}