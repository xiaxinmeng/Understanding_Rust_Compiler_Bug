{"sha": "188e53bd7e191526f2c6804601c031f8f7c53e14", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6MTg4ZTUzYmQ3ZTE5MTUyNmYyYzY4MDQ2MDFjMDMxZjhmN2M1M2UxNA==", "commit": {"author": {"name": "Jason Merrill", "email": "jason@redhat.com", "date": "2016-03-04T22:08:22Z"}, "committer": {"name": "Jason Merrill", "email": "jason@gcc.gnu.org", "date": "2016-03-04T22:08:22Z"}, "message": "re PR c++/67364 (\"accessing uninitialized member\" error in constexpr context)\n\n\tPR c++/67364\n\n\t* constexpr.c (cxx_eval_component_reference): Further tweak.\n\nFrom-SVN: r233982", "tree": {"sha": "34d9aa533a0e01c79a0d2d716a8566d6fa1779c7", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/34d9aa533a0e01c79a0d2d716a8566d6fa1779c7"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/188e53bd7e191526f2c6804601c031f8f7c53e14", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/188e53bd7e191526f2c6804601c031f8f7c53e14", "html_url": "https://github.com/Rust-GCC/gccrs/commit/188e53bd7e191526f2c6804601c031f8f7c53e14", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/188e53bd7e191526f2c6804601c031f8f7c53e14/comments", "author": {"login": "jicama", "id": 266146, "node_id": "MDQ6VXNlcjI2NjE0Ng==", "avatar_url": "https://avatars.githubusercontent.com/u/266146?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jicama", "html_url": "https://github.com/jicama", "followers_url": "https://api.github.com/users/jicama/followers", "following_url": "https://api.github.com/users/jicama/following{/other_user}", "gists_url": "https://api.github.com/users/jicama/gists{/gist_id}", "starred_url": "https://api.github.com/users/jicama/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jicama/subscriptions", "organizations_url": "https://api.github.com/users/jicama/orgs", "repos_url": "https://api.github.com/users/jicama/repos", "events_url": "https://api.github.com/users/jicama/events{/privacy}", "received_events_url": "https://api.github.com/users/jicama/received_events", "type": "User", "site_admin": false}, "committer": null, "parents": [{"sha": "39dce2b7901008b0ba70387bb47a9a0d19bbe836", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/39dce2b7901008b0ba70387bb47a9a0d19bbe836", "html_url": "https://github.com/Rust-GCC/gccrs/commit/39dce2b7901008b0ba70387bb47a9a0d19bbe836"}], "stats": {"total": 41, "additions": 37, "deletions": 4}, "files": [{"sha": "4db438b8eab5526d040a67ded097e3371a127c3c", "filename": "gcc/cp/ChangeLog", "status": "modified", "additions": 3, "deletions": 0, "changes": 3, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/188e53bd7e191526f2c6804601c031f8f7c53e14/gcc%2Fcp%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/188e53bd7e191526f2c6804601c031f8f7c53e14/gcc%2Fcp%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fcp%2FChangeLog?ref=188e53bd7e191526f2c6804601c031f8f7c53e14", "patch": "@@ -1,5 +1,8 @@\n 2016-03-04  Jason Merrill  <jason@redhat.com>\n \n+\tPR c++/67364\n+\t* constexpr.c (cxx_eval_component_reference): Further tweak.\n+\n \t* constexpr.c (struct constexpr_ctx): Add save_exprs field.\n \t(cxx_eval_loop_expr): Discard SAVE_EXPR values before looping.\n \t(cxx_eval_constant_expression) [SAVE_EXPR]: Add it to the set."}, {"sha": "d308175cb5f0b78305790a51e02ed94e9284095f", "filename": "gcc/cp/constexpr.c", "status": "modified", "additions": 7, "deletions": 4, "changes": 11, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/188e53bd7e191526f2c6804601c031f8f7c53e14/gcc%2Fcp%2Fconstexpr.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/188e53bd7e191526f2c6804601c031f8f7c53e14/gcc%2Fcp%2Fconstexpr.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fcp%2Fconstexpr.c?ref=188e53bd7e191526f2c6804601c031f8f7c53e14", "patch": "@@ -1990,13 +1990,16 @@ cxx_eval_component_reference (const constexpr_ctx *ctx, tree t,\n       return t;\n     }\n \n-  if (CONSTRUCTOR_NO_IMPLICIT_ZERO (whole)\n-      && !is_really_empty_class (TREE_TYPE (t)))\n+  /* We only create a CONSTRUCTOR for a subobject when we modify it, so empty\n+     classes never get represented; throw together a value now.  */\n+  if (is_really_empty_class (TREE_TYPE (t)))\n+    return build_constructor (TREE_TYPE (t), NULL);\n+\n+  if (CONSTRUCTOR_NO_IMPLICIT_ZERO (whole))\n     {\n       /* 'whole' is part of the aggregate initializer we're currently\n \t building; if there's no initializer for this member yet, that's an\n-\t error.  But expand_aggr_init_1 doesn't bother to initialize really\n-\t empty classes, so ignore them here, too.  */\n+\t error.  */\n       if (!ctx->quiet)\n \terror (\"accessing uninitialized member %qD\", part);\n       *non_constant_p = true;"}, {"sha": "2acfa98364b495de85adb0374fdaaf14213acd53", "filename": "gcc/testsuite/g++.dg/cpp1y/constexpr-empty2.C", "status": "added", "additions": 27, "deletions": 0, "changes": 27, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/188e53bd7e191526f2c6804601c031f8f7c53e14/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Fcpp1y%2Fconstexpr-empty2.C", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/188e53bd7e191526f2c6804601c031f8f7c53e14/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Fcpp1y%2Fconstexpr-empty2.C", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Fcpp1y%2Fconstexpr-empty2.C?ref=188e53bd7e191526f2c6804601c031f8f7c53e14", "patch": "@@ -0,0 +1,27 @@\n+// { dg-do compile { target c++14 } }\n+\n+struct A\n+{\n+  constexpr A(int) { }\n+};\n+\n+struct B: A {\n+  constexpr B(int i): A(i) { }\n+  constexpr B(const B& b): A(b) { }\n+};\n+\n+struct C {\n+  B b;\n+  constexpr C(int i): b(i) { }\n+  constexpr C(const C&c): b(c.b) {}\n+};\n+\n+constexpr int f()\n+{\n+  C b1{42};\n+  C b2{b1};\n+  b2.b;\n+  return 42;\n+}\n+\n+constexpr int i = f();"}]}