{"sha": "11b967577483e51f97d540e9c2c9d1ea76da8122", "node_id": "C_kwDOANBUbNoAKDExYjk2NzU3NzQ4M2U1MWY5N2Q1NDBlOWMyYzlkMWVhNzZkYTgxMjI", "commit": {"author": {"name": "Saagar Jha", "email": "saagar@saagarjha.com", "date": "2021-06-15T11:08:23Z"}, "committer": {"name": "Iain Sandoe", "email": "iain@sandoe.co.uk", "date": "2021-10-27T18:27:25Z"}, "message": "Darwin, config: Amend for Darwin 21 / macOS 12.\n\nIt seems that the OS major version is now tracking the kernel\nmajor version - 9.  Minor version has been set to kerne\nmin - 1.\n\nSigned-off-by: Iain Sandoe <iain@sandoe.co.uk>\nSigned-off-by: Saagar Jha <saagar@saagarjha.com>\n\ngcc/ChangeLog:\n\n\t* config.gcc: Adjust for Darwin21.\n\t* config/darwin-c.c (macosx_version_as_macro): Likewise.\n\t* config/darwin-driver.c (validate_macosx_version_min):\n\tLikewise.\n\t(darwin_find_version_from_kernel): Likewise.", "tree": {"sha": "f3422ce6d1e96008aae53be9ebf387fe997b6c9b", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/f3422ce6d1e96008aae53be9ebf387fe997b6c9b"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/11b967577483e51f97d540e9c2c9d1ea76da8122", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/11b967577483e51f97d540e9c2c9d1ea76da8122", "html_url": "https://github.com/Rust-GCC/gccrs/commit/11b967577483e51f97d540e9c2c9d1ea76da8122", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/11b967577483e51f97d540e9c2c9d1ea76da8122/comments", "author": {"login": "saagarjha", "id": 13786931, "node_id": "MDQ6VXNlcjEzNzg2OTMx", "avatar_url": "https://avatars.githubusercontent.com/u/13786931?v=4", "gravatar_id": "", "url": "https://api.github.com/users/saagarjha", "html_url": "https://github.com/saagarjha", "followers_url": "https://api.github.com/users/saagarjha/followers", "following_url": "https://api.github.com/users/saagarjha/following{/other_user}", "gists_url": "https://api.github.com/users/saagarjha/gists{/gist_id}", "starred_url": "https://api.github.com/users/saagarjha/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/saagarjha/subscriptions", "organizations_url": "https://api.github.com/users/saagarjha/orgs", "repos_url": "https://api.github.com/users/saagarjha/repos", "events_url": "https://api.github.com/users/saagarjha/events{/privacy}", "received_events_url": "https://api.github.com/users/saagarjha/received_events", "type": "User", "site_admin": false}, "committer": {"login": "iains", "id": 4039407, "node_id": "MDQ6VXNlcjQwMzk0MDc=", "avatar_url": "https://avatars.githubusercontent.com/u/4039407?v=4", "gravatar_id": "", "url": "https://api.github.com/users/iains", "html_url": "https://github.com/iains", "followers_url": "https://api.github.com/users/iains/followers", "following_url": "https://api.github.com/users/iains/following{/other_user}", "gists_url": "https://api.github.com/users/iains/gists{/gist_id}", "starred_url": "https://api.github.com/users/iains/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/iains/subscriptions", "organizations_url": "https://api.github.com/users/iains/orgs", "repos_url": "https://api.github.com/users/iains/repos", "events_url": "https://api.github.com/users/iains/events{/privacy}", "received_events_url": "https://api.github.com/users/iains/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "aeb10f8d2a6e1267c981a62dc8163af3b7607797", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/aeb10f8d2a6e1267c981a62dc8163af3b7607797", "html_url": "https://github.com/Rust-GCC/gccrs/commit/aeb10f8d2a6e1267c981a62dc8163af3b7607797"}], "stats": {"total": 18, "additions": 9, "deletions": 9}, "files": [{"sha": "b1082cdbab1359fd66bc96dc5cd2b4bf38f0064e", "filename": "gcc/config.gcc", "status": "modified", "additions": 3, "deletions": 3, "changes": 6, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/11b967577483e51f97d540e9c2c9d1ea76da8122/gcc%2Fconfig.gcc", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/11b967577483e51f97d540e9c2c9d1ea76da8122/gcc%2Fconfig.gcc", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fconfig.gcc?ref=11b967577483e51f97d540e9c2c9d1ea76da8122", "patch": "@@ -681,9 +681,9 @@ case ${target} in\n       *-*-darwin[4-9]* | *-*-darwin1[0-9]*)\n         macos_min=`expr $darwin_maj - 4`\n         ;;\n-      *-*-darwin20*)\n-        # Darwin 20 corresponds to macOS 11.\n-        macos_maj=11\n+      *-*-darwin2*)\n+        # Darwin 20 corresponds to macOS 11, Darwin 21 to macOS 12.\n+        macos_maj=`expr $darwin_maj - 9`\n         def_ld64=609.0\n         ;;\n       *-*-darwin)"}, {"sha": "62d28fcea501bbcb9eb403c74793af45eb91ca7f", "filename": "gcc/config/darwin-c.c", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/11b967577483e51f97d540e9c2c9d1ea76da8122/gcc%2Fconfig%2Fdarwin-c.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/11b967577483e51f97d540e9c2c9d1ea76da8122/gcc%2Fconfig%2Fdarwin-c.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fconfig%2Fdarwin-c.c?ref=11b967577483e51f97d540e9c2c9d1ea76da8122", "patch": "@@ -691,7 +691,7 @@ macosx_version_as_macro (void)\n   if (!version_array)\n     goto fail;\n \n-  if (version_array[MAJOR] < 10 || version_array[MAJOR] > 11)\n+  if (version_array[MAJOR] < 10 || version_array[MAJOR] > 12)\n     goto fail;\n \n   if (version_array[MAJOR] == 10 && version_array[MINOR] < 10)"}, {"sha": "4f0c6bad61fdc739ff93ed967088ccee4b5290b5", "filename": "gcc/config/darwin-driver.c", "status": "modified", "additions": 5, "deletions": 5, "changes": 10, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/11b967577483e51f97d540e9c2c9d1ea76da8122/gcc%2Fconfig%2Fdarwin-driver.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/11b967577483e51f97d540e9c2c9d1ea76da8122/gcc%2Fconfig%2Fdarwin-driver.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fconfig%2Fdarwin-driver.c?ref=11b967577483e51f97d540e9c2c9d1ea76da8122", "patch": "@@ -64,17 +64,17 @@ validate_macosx_version_min (const char *version_str)\n \n   major = strtoul (version_str, &end, 10);\n \n-  if (major < 10 || major > 11 ) /* MacOS 10 and 11 are known. */\n+  if (major < 10 || major > 12 ) /* macOS 10, 11, and 12 are known. */\n     return NULL;\n \n   /* Skip a separating period, if there's one.  */\n   version_str = end + ((*end == '.') ? 1 : 0);\n \n-  if (major == 11 && *end != '\\0' && !ISDIGIT (version_str[0]))\n-     /* For MacOS 11, we allow just the major number, but if the minor is\n+  if (major > 10 && *end != '\\0' && !ISDIGIT (version_str[0]))\n+     /* For macOS 11+, we allow just the major number, but if the minor is\n \tthere it must be numeric.  */\n     return NULL;\n-  else if (major == 11 && *end == '\\0')\n+  else if (major > 10 && *end == '\\0')\n     /* We will rewrite 11 =>  11.0.0.  */\n     need_rewrite = true;\n   else if (major == 10 && (*end == '\\0' || !ISDIGIT (version_str[0])))\n@@ -172,7 +172,7 @@ darwin_find_version_from_kernel (void)\n       if (minor_vers > 0)\n \tminor_vers -= 1; /* Kernel 20.3 => macOS 11.2.  */\n       /* It's not yet clear whether patch level will be considered.  */\n-      asprintf (&new_flag, \"11.%02d.00\", minor_vers);\n+      asprintf (&new_flag, \"%d.%02d.00\", major_vers - 9, minor_vers);\n     }\n   else if (major_vers - 4 <= 4)\n     /* On 10.4 and earlier, the old linker is used which does not"}]}