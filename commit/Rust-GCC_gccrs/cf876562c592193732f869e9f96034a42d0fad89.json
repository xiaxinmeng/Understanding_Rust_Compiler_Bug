{"sha": "cf876562c592193732f869e9f96034a42d0fad89", "node_id": "C_kwDOANBUbNoAKGNmODc2NTYyYzU5MjE5MzczMmY4NjllOWY5NjAzNGE0MmQwZmFkODk", "commit": {"author": {"name": "Jonathan Wakely", "email": "jwakely@redhat.com", "date": "2021-10-01T20:27:24Z"}, "committer": {"name": "Jonathan Wakely", "email": "jwakely@redhat.com", "date": "2021-10-04T14:23:28Z"}, "message": "libstdc++: Disable std::string{,_view} construction from nullptr (P2166R1)\n\nImplement this C++23 feature. Because construction from a null pointer\nis undefined, we can implement it for C++11 and up, turning undefined\nbehaviour into a compilation error.\n\nlibstdc++-v3/ChangeLog:\n\n\t* include/bits/basic_string.h (basic_string(nullptr_t)): Define\n\tas deleted.\n\t(operator=(nullptr_t)): Likewise.\n\t* include/bits/cow_string.h (basic_string(nullptr_t)): Likewise.\n\t(operator=(nullptr_t)): Likewise.\n\t* include/std/string_view (basic_string_view(nullptr_t)):\n\tLikewise.\n\t* testsuite/21_strings/basic_string/cons/char/nullptr.cc: New test.\n\t* testsuite/21_strings/basic_string_view/cons/char/nonnull.cc:\n\tChange dg-warning to dg-error.\n\t* testsuite/21_strings/basic_string_view/cons/wchar_t/nonnull.cc:\n\tLikewise.", "tree": {"sha": "bea69f3de5d35fa5396f00ad388640f2b82748d2", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/bea69f3de5d35fa5396f00ad388640f2b82748d2"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/cf876562c592193732f869e9f96034a42d0fad89", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/cf876562c592193732f869e9f96034a42d0fad89", "html_url": "https://github.com/Rust-GCC/gccrs/commit/cf876562c592193732f869e9f96034a42d0fad89", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/cf876562c592193732f869e9f96034a42d0fad89/comments", "author": {"login": "jwakely", "id": 1254480, "node_id": "MDQ6VXNlcjEyNTQ0ODA=", "avatar_url": "https://avatars.githubusercontent.com/u/1254480?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jwakely", "html_url": "https://github.com/jwakely", "followers_url": "https://api.github.com/users/jwakely/followers", "following_url": "https://api.github.com/users/jwakely/following{/other_user}", "gists_url": "https://api.github.com/users/jwakely/gists{/gist_id}", "starred_url": "https://api.github.com/users/jwakely/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jwakely/subscriptions", "organizations_url": "https://api.github.com/users/jwakely/orgs", "repos_url": "https://api.github.com/users/jwakely/repos", "events_url": "https://api.github.com/users/jwakely/events{/privacy}", "received_events_url": "https://api.github.com/users/jwakely/received_events", "type": "User", "site_admin": false}, "committer": {"login": "jwakely", "id": 1254480, "node_id": "MDQ6VXNlcjEyNTQ0ODA=", "avatar_url": "https://avatars.githubusercontent.com/u/1254480?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jwakely", "html_url": "https://github.com/jwakely", "followers_url": "https://api.github.com/users/jwakely/followers", "following_url": "https://api.github.com/users/jwakely/following{/other_user}", "gists_url": "https://api.github.com/users/jwakely/gists{/gist_id}", "starred_url": "https://api.github.com/users/jwakely/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jwakely/subscriptions", "organizations_url": "https://api.github.com/users/jwakely/orgs", "repos_url": "https://api.github.com/users/jwakely/repos", "events_url": "https://api.github.com/users/jwakely/events{/privacy}", "received_events_url": "https://api.github.com/users/jwakely/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "fa3ccf8bfe9940b439d6cc2c38ee8da134b0ff2d", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/fa3ccf8bfe9940b439d6cc2c38ee8da134b0ff2d", "html_url": "https://github.com/Rust-GCC/gccrs/commit/fa3ccf8bfe9940b439d6cc2c38ee8da134b0ff2d"}], "stats": {"total": 15, "additions": 13, "deletions": 2}, "files": [{"sha": "68c388408f07de255d7fee3705bb76d9fc61619e", "filename": "libstdc++-v3/include/bits/basic_string.h", "status": "modified", "additions": 2, "deletions": 0, "changes": 2, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/cf876562c592193732f869e9f96034a42d0fad89/libstdc%2B%2B-v3%2Finclude%2Fbits%2Fbasic_string.h", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/cf876562c592193732f869e9f96034a42d0fad89/libstdc%2B%2B-v3%2Finclude%2Fbits%2Fbasic_string.h", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libstdc%2B%2B-v3%2Finclude%2Fbits%2Fbasic_string.h?ref=cf876562c592193732f869e9f96034a42d0fad89", "patch": "@@ -623,6 +623,8 @@ _GLIBCXX_BEGIN_NAMESPACE_CXX11\n \t  _M_construct(__str.begin(), __str.end());\n       }\n \n+      basic_string(nullptr_t) = delete;\n+      basic_string& operator=(nullptr_t) = delete;\n #endif // C++11\n \n       /**"}, {"sha": "f054012836400b7f9a7bd0fc47fa32d3695ef479", "filename": "libstdc++-v3/include/bits/cow_string.h", "status": "modified", "additions": 3, "deletions": 0, "changes": 3, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/cf876562c592193732f869e9f96034a42d0fad89/libstdc%2B%2B-v3%2Finclude%2Fbits%2Fcow_string.h", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/cf876562c592193732f869e9f96034a42d0fad89/libstdc%2B%2B-v3%2Finclude%2Fbits%2Fcow_string.h", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libstdc%2B%2B-v3%2Finclude%2Fbits%2Fcow_string.h?ref=cf876562c592193732f869e9f96034a42d0fad89", "patch": "@@ -667,6 +667,9 @@ _GLIBCXX_BEGIN_NAMESPACE_VERSION\n \telse\n \t  _M_dataplus._M_p = _S_construct(__str.begin(), __str.end(), __a);\n       }\n+\n+      basic_string(nullptr_t) = delete;\n+      basic_string& operator=(nullptr_t) = delete;\n #endif // C++11\n \n       /**"}, {"sha": "996b03f93466d67b27781864df6d56928d7ca08f", "filename": "libstdc++-v3/include/std/string_view", "status": "modified", "additions": 2, "deletions": 0, "changes": 2, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/cf876562c592193732f869e9f96034a42d0fad89/libstdc%2B%2B-v3%2Finclude%2Fstd%2Fstring_view", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/cf876562c592193732f869e9f96034a42d0fad89/libstdc%2B%2B-v3%2Finclude%2Fstd%2Fstring_view", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libstdc%2B%2B-v3%2Finclude%2Fstd%2Fstring_view?ref=cf876562c592193732f869e9f96034a42d0fad89", "patch": "@@ -168,6 +168,8 @@ _GLIBCXX_BEGIN_NAMESPACE_VERSION\n #endif // C++23\n #endif // C++20\n \n+      basic_string_view(nullptr_t) = delete;\n+\n       constexpr basic_string_view&\n       operator=(const basic_string_view&) noexcept = default;\n "}, {"sha": "fdb24aeeb8943475ec45997b4a910057ef88b98c", "filename": "libstdc++-v3/testsuite/21_strings/basic_string/cons/char/nullptr.cc", "status": "added", "additions": 4, "deletions": 0, "changes": 4, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/cf876562c592193732f869e9f96034a42d0fad89/libstdc%2B%2B-v3%2Ftestsuite%2F21_strings%2Fbasic_string%2Fcons%2Fchar%2Fnullptr.cc", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/cf876562c592193732f869e9f96034a42d0fad89/libstdc%2B%2B-v3%2Ftestsuite%2F21_strings%2Fbasic_string%2Fcons%2Fchar%2Fnullptr.cc", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libstdc%2B%2B-v3%2Ftestsuite%2F21_strings%2Fbasic_string%2Fcons%2Fchar%2Fnullptr.cc?ref=cf876562c592193732f869e9f96034a42d0fad89", "patch": "@@ -0,0 +1,4 @@\n+// { dg-do compile { target c++11 } }\n+#include <string>\n+\n+std::string s = nullptr; // { dg-error \"deleted\" \"P2166R1\" }"}, {"sha": "f42f95e2fddf9e38516916a85c80267f5523aeb5", "filename": "libstdc++-v3/testsuite/21_strings/basic_string_view/cons/char/nonnull.cc", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/cf876562c592193732f869e9f96034a42d0fad89/libstdc%2B%2B-v3%2Ftestsuite%2F21_strings%2Fbasic_string_view%2Fcons%2Fchar%2Fnonnull.cc", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/cf876562c592193732f869e9f96034a42d0fad89/libstdc%2B%2B-v3%2Ftestsuite%2F21_strings%2Fbasic_string_view%2Fcons%2Fchar%2Fnonnull.cc", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libstdc%2B%2B-v3%2Ftestsuite%2F21_strings%2Fbasic_string_view%2Fcons%2Fchar%2Fnonnull.cc?ref=cf876562c592193732f869e9f96034a42d0fad89", "patch": "@@ -25,5 +25,5 @@ test01()\n {\n   std::string_view s((const char*)nullptr); // { dg-warning \"\\\\\\[-Wnonnull\" }\n   std::string_view t((char*)nullptr);\t    // { dg-warning \"\\\\\\[-Wnonnull\" }\n-  std::string_view u(nullptr);\t\t    // { dg-warning \"\\\\\\[-Wnonnull\" }\n+  std::string_view u(nullptr);\t\t    // { dg-error \"deleted\" }\n }"}, {"sha": "e480f7c4923c51d7f77f5b5511815c034622b55e", "filename": "libstdc++-v3/testsuite/21_strings/basic_string_view/cons/wchar_t/nonnull.cc", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/cf876562c592193732f869e9f96034a42d0fad89/libstdc%2B%2B-v3%2Ftestsuite%2F21_strings%2Fbasic_string_view%2Fcons%2Fwchar_t%2Fnonnull.cc", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/cf876562c592193732f869e9f96034a42d0fad89/libstdc%2B%2B-v3%2Ftestsuite%2F21_strings%2Fbasic_string_view%2Fcons%2Fwchar_t%2Fnonnull.cc", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libstdc%2B%2B-v3%2Ftestsuite%2F21_strings%2Fbasic_string_view%2Fcons%2Fwchar_t%2Fnonnull.cc?ref=cf876562c592193732f869e9f96034a42d0fad89", "patch": "@@ -25,5 +25,5 @@ test01()\n {\n   std::wstring_view s((const wchar_t*)nullptr);\t// { dg-warning \"\\\\\\[-Wnonnull\" }\n   std::wstring_view t((wchar_t*)nullptr);\t// { dg-warning \"\\\\\\[-Wnonnull\" }\n-  std::wstring_view u(nullptr);\t\t\t// { dg-warning \"\\\\\\[-Wnonnull\" }\n+  std::wstring_view u(nullptr);\t\t\t// { dg-error \"deleted\" }\n }"}]}