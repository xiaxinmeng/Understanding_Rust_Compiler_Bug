{"sha": "1cef710256a340b7a13e00f8a088b5709569e0c6", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6MWNlZjcxMDI1NmEzNDBiN2ExM2UwMGY4YTA4OGI1NzA5NTY5ZTBjNg==", "commit": {"author": {"name": "Dodji Seketeli", "email": "dodji@redhat.com", "date": "2012-01-12T23:28:46Z"}, "committer": {"name": "Dodji Seketeli", "email": "dodji@gcc.gnu.org", "date": "2012-01-12T23:28:46Z"}, "message": "PR c++/51633 - ICEs with constexpr constructor\n\ngcc/cp/\n\n\tPR c++/51633\n\t* semantics.c (cp_parser_ctor_initializer_opt_and_function_body):\n\tSet the pointer to the last block of the constructor to the\n\tcurrent statement.\n\t(build_constexpr_constructor_member_initializers): Get\n\tbuild_data_member_initialization a chance to deal with more\n\tstatements before we choke.\n\ngcc/testsuite/\n\n\tPR c++/51633\n\t* g++.dg/cpp0x/constexpr-diag4.C: New test.\n\nFrom-SVN: r183144", "tree": {"sha": "20aed99bf958983ce825e6124ec717166396a71a", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/20aed99bf958983ce825e6124ec717166396a71a"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/1cef710256a340b7a13e00f8a088b5709569e0c6", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/1cef710256a340b7a13e00f8a088b5709569e0c6", "html_url": "https://github.com/Rust-GCC/gccrs/commit/1cef710256a340b7a13e00f8a088b5709569e0c6", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/1cef710256a340b7a13e00f8a088b5709569e0c6/comments", "author": null, "committer": null, "parents": [{"sha": "639d4bb87cd62a6b136ba653cc3e8fddec4f0fd6", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/639d4bb87cd62a6b136ba653cc3e8fddec4f0fd6", "html_url": "https://github.com/Rust-GCC/gccrs/commit/639d4bb87cd62a6b136ba653cc3e8fddec4f0fd6"}], "stats": {"total": 97, "additions": 92, "deletions": 5}, "files": [{"sha": "63d8f2f4d1aedc0f444797ae9ca075c67af9166f", "filename": "gcc/cp/ChangeLog", "status": "modified", "additions": 10, "deletions": 0, "changes": 10, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/1cef710256a340b7a13e00f8a088b5709569e0c6/gcc%2Fcp%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/1cef710256a340b7a13e00f8a088b5709569e0c6/gcc%2Fcp%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fcp%2FChangeLog?ref=1cef710256a340b7a13e00f8a088b5709569e0c6", "patch": "@@ -1,3 +1,13 @@\n+2012-01-13  Dodji Seketeli  <dodji@redhat.com>\n+\n+\tPR c++/51633\n+\t* semantics.c (cp_parser_ctor_initializer_opt_and_function_body):\n+\tSet the pointer to the last block of the constructor to the\n+\tcurrent statement.\n+\t(build_constexpr_constructor_member_initializers): Get\n+\tbuild_data_member_initialization a chance to deal with more\n+\tstatements before we choke.\n+\n 2012-01-12  Jason Merrill  <jason@redhat.com>\n \n \tPR c++/48051"}, {"sha": "c4c3ef44a0ced950139a9794fc5ab0a34de0c9fd", "filename": "gcc/cp/parser.c", "status": "modified", "additions": 2, "deletions": 5, "changes": 7, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/1cef710256a340b7a13e00f8a088b5709569e0c6/gcc%2Fcp%2Fparser.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/1cef710256a340b7a13e00f8a088b5709569e0c6/gcc%2Fcp%2Fparser.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fcp%2Fparser.c?ref=1cef710256a340b7a13e00f8a088b5709569e0c6", "patch": "@@ -17424,11 +17424,8 @@ cp_parser_ctor_initializer_opt_and_function_body (cp_parser *parser)\n      cp_parser_function_body changed its state.  */\n   if (check_body_p)\n     {\n-      list = body;\n-      if (TREE_CODE (list) == BIND_EXPR)\n-\tlist = BIND_EXPR_BODY (list);\n-      if (TREE_CODE (list) == STATEMENT_LIST\n-\t  && STATEMENT_LIST_TAIL (list) != NULL)\n+      list = cur_stmt_list;\n+      if (STATEMENT_LIST_TAIL (list))\n \tlast = STATEMENT_LIST_TAIL (list)->stmt;\n     }\n   /* Parse the function-body.  */"}, {"sha": "6f6f0aca4b10b291ada14760f3241d07be5a6315", "filename": "gcc/cp/semantics.c", "status": "modified", "additions": 2, "deletions": 0, "changes": 2, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/1cef710256a340b7a13e00f8a088b5709569e0c6/gcc%2Fcp%2Fsemantics.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/1cef710256a340b7a13e00f8a088b5709569e0c6/gcc%2Fcp%2Fsemantics.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fcp%2Fsemantics.c?ref=1cef710256a340b7a13e00f8a088b5709569e0c6", "patch": "@@ -5930,6 +5930,8 @@ build_constexpr_constructor_member_initializers (tree type, tree body)\n \t    break;\n \t}\n     }\n+  else if (EXPR_P (body))\n+    ok = build_data_member_initialization (body, &vec);\n   else\n     gcc_assert (errorcount > 0);\n   if (ok)"}, {"sha": "a4b09ea66027017134498107e37bf8166468d7e2", "filename": "gcc/testsuite/ChangeLog", "status": "modified", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/1cef710256a340b7a13e00f8a088b5709569e0c6/gcc%2Ftestsuite%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/1cef710256a340b7a13e00f8a088b5709569e0c6/gcc%2Ftestsuite%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2FChangeLog?ref=1cef710256a340b7a13e00f8a088b5709569e0c6", "patch": "@@ -1,3 +1,8 @@\n+2012-01-13  Dodji Seketeli  <dodji@redhat.com>\n+\n+\tPR c++/51633\n+\t* g++.dg/cpp0x/constexpr-diag4.C: New test.\n+\n 2012-01-12  Jason Merrill  <jason@redhat.com>\n \n \tPR c++/48051"}, {"sha": "371190e9789f8126bd9447a868e7e491b226f4d9", "filename": "gcc/testsuite/g++.dg/cpp0x/constexpr-diag4.C", "status": "added", "additions": 25, "deletions": 0, "changes": 25, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/1cef710256a340b7a13e00f8a088b5709569e0c6/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Fcpp0x%2Fconstexpr-diag4.C", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/1cef710256a340b7a13e00f8a088b5709569e0c6/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Fcpp0x%2Fconstexpr-diag4.C", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Fcpp0x%2Fconstexpr-diag4.C?ref=1cef710256a340b7a13e00f8a088b5709569e0c6", "patch": "@@ -0,0 +1,25 @@\n+// Origin: PR c++/51633\n+// { dg-options \"-std=c++11\" }\n+\n+struct A\n+{\n+    ~A();\n+};\n+\n+struct B\n+{\n+    A a;\n+    constexpr B() {}\n+};\n+\n+struct A1\n+{\n+    int a;\n+    ~A1();\n+};\n+\n+struct B1\n+{\n+    A1 a1;\n+    constexpr B1() {} // { dg-error \"uninitialized member\" }\n+};"}, {"sha": "c0cbfdd1c5107959e51f5af67c62e09247e8c2da", "filename": "gcc/testsuite/g++.dg/cpp0x/constexpr-diag5.C", "status": "added", "additions": 48, "deletions": 0, "changes": 48, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/1cef710256a340b7a13e00f8a088b5709569e0c6/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Fcpp0x%2Fconstexpr-diag5.C", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/1cef710256a340b7a13e00f8a088b5709569e0c6/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Fcpp0x%2Fconstexpr-diag5.C", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Fcpp0x%2Fconstexpr-diag5.C?ref=1cef710256a340b7a13e00f8a088b5709569e0c6", "patch": "@@ -0,0 +1,48 @@\n+// Origin: PR c++/51633\n+// { dg-options \"-std=c++11\" }\n+\n+struct A\n+{\n+    constexpr A() {}\n+    ~A();\n+};\n+\n+struct B\n+{\n+    A a;\n+    A b;\n+    A c;\n+    constexpr B() {}\n+};\n+\n+struct C\n+{\n+    A a;\n+    constexpr C() {}\n+};\n+\n+struct D\n+{\n+    constexpr D() { return;} // { dg-error \"does not have empty body\" }\n+};\n+\n+struct D1\n+{\n+    A a;\n+    constexpr D1() { return;} // { dg-error \"does not have empty body\" }\n+};\n+\n+struct D2\n+{\n+    A a;\n+    A b;\n+    constexpr D2() { return;} // { dg-error \"does not have empty body\" }\n+};\n+\n+struct D3\n+{\n+    A a;\n+    A b;\n+    A c;\n+    constexpr D3() { return;} // { dg-error \"does not have empty body\" }\n+};"}]}