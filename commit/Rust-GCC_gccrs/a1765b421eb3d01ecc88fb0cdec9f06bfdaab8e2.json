{"sha": "a1765b421eb3d01ecc88fb0cdec9f06bfdaab8e2", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6YTE3NjViNDIxZWIzZDAxZWNjODhmYjBjZGVjOWYwNmJmZGFhYjhlMg==", "commit": {"author": {"name": "Iain Sandoe", "email": "iain@sandoe.co.uk", "date": "2021-04-24T18:28:25Z"}, "committer": {"name": "Iain Sandoe", "email": "iain@sandoe.co.uk", "date": "2021-04-24T18:31:25Z"}, "message": "Revert \"Darwin : Adjust darwin_binds_local_p for PIC code [PR100152].\"\n\nUnfortunately, although this is required to fix the PR, and is\nnotionally correct, it regresses some of the sanitizer and IPA\ntests.  Reverting until this can be analysed.\n\nThis reverts commit b6600392bf71c4a9785f8f49948b611425896830.", "tree": {"sha": "047d005bf1d21dad304a7a22dd7799473e291565", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/047d005bf1d21dad304a7a22dd7799473e291565"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/a1765b421eb3d01ecc88fb0cdec9f06bfdaab8e2", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/a1765b421eb3d01ecc88fb0cdec9f06bfdaab8e2", "html_url": "https://github.com/Rust-GCC/gccrs/commit/a1765b421eb3d01ecc88fb0cdec9f06bfdaab8e2", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/a1765b421eb3d01ecc88fb0cdec9f06bfdaab8e2/comments", "author": {"login": "iains", "id": 4039407, "node_id": "MDQ6VXNlcjQwMzk0MDc=", "avatar_url": "https://avatars.githubusercontent.com/u/4039407?v=4", "gravatar_id": "", "url": "https://api.github.com/users/iains", "html_url": "https://github.com/iains", "followers_url": "https://api.github.com/users/iains/followers", "following_url": "https://api.github.com/users/iains/following{/other_user}", "gists_url": "https://api.github.com/users/iains/gists{/gist_id}", "starred_url": "https://api.github.com/users/iains/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/iains/subscriptions", "organizations_url": "https://api.github.com/users/iains/orgs", "repos_url": "https://api.github.com/users/iains/repos", "events_url": "https://api.github.com/users/iains/events{/privacy}", "received_events_url": "https://api.github.com/users/iains/received_events", "type": "User", "site_admin": false}, "committer": {"login": "iains", "id": 4039407, "node_id": "MDQ6VXNlcjQwMzk0MDc=", "avatar_url": "https://avatars.githubusercontent.com/u/4039407?v=4", "gravatar_id": "", "url": "https://api.github.com/users/iains", "html_url": "https://github.com/iains", "followers_url": "https://api.github.com/users/iains/followers", "following_url": "https://api.github.com/users/iains/following{/other_user}", "gists_url": "https://api.github.com/users/iains/gists{/gist_id}", "starred_url": "https://api.github.com/users/iains/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/iains/subscriptions", "organizations_url": "https://api.github.com/users/iains/orgs", "repos_url": "https://api.github.com/users/iains/repos", "events_url": "https://api.github.com/users/iains/events{/privacy}", "received_events_url": "https://api.github.com/users/iains/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "fb6b24c66ea5a2ccbf6fb9f299c20a69f962ac9b", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/fb6b24c66ea5a2ccbf6fb9f299c20a69f962ac9b", "html_url": "https://github.com/Rust-GCC/gccrs/commit/fb6b24c66ea5a2ccbf6fb9f299c20a69f962ac9b"}], "stats": {"total": 17, "additions": 4, "deletions": 13}, "files": [{"sha": "5d173919ee0505ad28dfd3315fc407dbc2d1708e", "filename": "gcc/config/darwin.c", "status": "modified", "additions": 4, "deletions": 13, "changes": 17, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/a1765b421eb3d01ecc88fb0cdec9f06bfdaab8e2/gcc%2Fconfig%2Fdarwin.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/a1765b421eb3d01ecc88fb0cdec9f06bfdaab8e2/gcc%2Fconfig%2Fdarwin.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fconfig%2Fdarwin.c?ref=a1765b421eb3d01ecc88fb0cdec9f06bfdaab8e2", "patch": "@@ -3134,25 +3134,16 @@ darwin_file_end (void)\n /* TODO: Add a language hook for identifying if a decl is a vtable.  */\n #define DARWIN_VTABLE_P(DECL) 0\n \n-/* Cross-module name binding.\n-   Darwin's dynamic linker supports interposition and lazy symbol binding.\n-   If we are generating PIC code and a symbol is public, then it could\n-   potentially be indirected via a lazy-resolver stub; we cannot tell at\n-   compile-time if this will be done (since the indirection can be the\n-   result of adding a -flat-namespace option at link-time).  Here we are\n-   conservative and assume that any such symbol cannot bind locally.\n-   The default implementation for binds_local_p handles undefined, weak and\n-   common symbols which are always indirected.  */\n+/* Cross-module name binding.  Darwin does not support overriding\n+   functions at dynamic-link time, except for vtables in kexts.  */\n \n bool\n darwin_binds_local_p (const_tree decl)\n {\n   /* We use the \"shlib\" input to indicate that a symbol should be\n-     considered overridable.  Older versions of the kernel also support\n-     interposition for extensions (although this code is a place-holder\n-     until there is an implementation for DARWIN_VTABLE_P).  */\n+     considered overridable; only relevant for vtables in kernel modules\n+     on earlier system versions, and with a TODO to complete.  */\n   bool force_overridable = TARGET_KEXTABI && DARWIN_VTABLE_P (decl);\n-  force_overridable |= MACHOPIC_PURE;\n   return default_binds_local_p_3 (decl, force_overridable /* shlib */,\n \t\t\t\t  false /* weak dominate */,\n \t\t\t\t  false /* extern_protected_data */,"}]}