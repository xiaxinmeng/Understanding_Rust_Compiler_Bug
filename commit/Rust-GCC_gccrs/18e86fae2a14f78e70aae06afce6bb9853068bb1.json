{"sha": "18e86fae2a14f78e70aae06afce6bb9853068bb1", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6MThlODZmYWUyYTE0Zjc4ZTcwYWFlMDZhZmNlNmJiOTg1MzA2OGJiMQ==", "commit": {"author": {"name": "Max Filippov", "email": "jcmvbkbc@gmail.com", "date": "2020-12-20T10:23:12Z"}, "committer": {"name": "Max Filippov", "email": "jcmvbkbc@gmail.com", "date": "2020-12-20T22:02:26Z"}, "message": "gcc: xtensa: implement bswapsi2, bswapdi2 and helpers\n\n2020-12-20  Max Filippov  <jcmvbkbc@gmail.com>\ngcc/\n\t* config/xtensa/xtensa.md (bswapsi2, bswapdi2): New patterns.\n\ngcc/testsuite/\n\t* gcc.target/xtensa/bswap.c: New test.\n\nlibgcc/\n\t* config/xtensa/lib1funcs.S (__bswapsi2, __bswapdi2): New\n\tfunctions.\n\t* config/xtensa/t-xtensa (LIB1ASMFUNCS): Add _bswapsi2 and\n\t_bswapdi2.", "tree": {"sha": "2d06b0068acea1f9ec4a2164a6b2a3b358eb045b", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/2d06b0068acea1f9ec4a2164a6b2a3b358eb045b"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/18e86fae2a14f78e70aae06afce6bb9853068bb1", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/18e86fae2a14f78e70aae06afce6bb9853068bb1", "html_url": "https://github.com/Rust-GCC/gccrs/commit/18e86fae2a14f78e70aae06afce6bb9853068bb1", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/18e86fae2a14f78e70aae06afce6bb9853068bb1/comments", "author": {"login": "jcmvbkbc", "id": 166731, "node_id": "MDQ6VXNlcjE2NjczMQ==", "avatar_url": "https://avatars.githubusercontent.com/u/166731?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jcmvbkbc", "html_url": "https://github.com/jcmvbkbc", "followers_url": "https://api.github.com/users/jcmvbkbc/followers", "following_url": "https://api.github.com/users/jcmvbkbc/following{/other_user}", "gists_url": "https://api.github.com/users/jcmvbkbc/gists{/gist_id}", "starred_url": "https://api.github.com/users/jcmvbkbc/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jcmvbkbc/subscriptions", "organizations_url": "https://api.github.com/users/jcmvbkbc/orgs", "repos_url": "https://api.github.com/users/jcmvbkbc/repos", "events_url": "https://api.github.com/users/jcmvbkbc/events{/privacy}", "received_events_url": "https://api.github.com/users/jcmvbkbc/received_events", "type": "User", "site_admin": false}, "committer": {"login": "jcmvbkbc", "id": 166731, "node_id": "MDQ6VXNlcjE2NjczMQ==", "avatar_url": "https://avatars.githubusercontent.com/u/166731?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jcmvbkbc", "html_url": "https://github.com/jcmvbkbc", "followers_url": "https://api.github.com/users/jcmvbkbc/followers", "following_url": "https://api.github.com/users/jcmvbkbc/following{/other_user}", "gists_url": "https://api.github.com/users/jcmvbkbc/gists{/gist_id}", "starred_url": "https://api.github.com/users/jcmvbkbc/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jcmvbkbc/subscriptions", "organizations_url": "https://api.github.com/users/jcmvbkbc/orgs", "repos_url": "https://api.github.com/users/jcmvbkbc/repos", "events_url": "https://api.github.com/users/jcmvbkbc/events{/privacy}", "received_events_url": "https://api.github.com/users/jcmvbkbc/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "3621a7bb5795ad4e47b30e1a8a06f1abe2b3b036", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/3621a7bb5795ad4e47b30e1a8a06f1abe2b3b036", "html_url": "https://github.com/Rust-GCC/gccrs/commit/3621a7bb5795ad4e47b30e1a8a06f1abe2b3b036"}], "stats": {"total": 75, "additions": 75, "deletions": 0}, "files": [{"sha": "cfb6a546d922dedc38e184390e0584b78a6e6c8e", "filename": "gcc/config/xtensa/xtensa.md", "status": "modified", "additions": 21, "deletions": 0, "changes": 21, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/18e86fae2a14f78e70aae06afce6bb9853068bb1/gcc%2Fconfig%2Fxtensa%2Fxtensa.md", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/18e86fae2a14f78e70aae06afce6bb9853068bb1/gcc%2Fconfig%2Fxtensa%2Fxtensa.md", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fconfig%2Fxtensa%2Fxtensa.md?ref=18e86fae2a14f78e70aae06afce6bb9853068bb1", "patch": "@@ -468,6 +468,27 @@\n   DONE;\n })\n \n+\f\n+;; Byte swap.\n+\n+(define_insn \"bswapsi2\"\n+  [(set (match_operand:SI 0 \"register_operand\" \"=&a\")\n+\t(bswap:SI (match_operand:SI 1 \"register_operand\" \"r\")))]\n+  \"!optimize_size\"\n+  \"ssai\\t8\\;srli\\t%0, %1, 16\\;src\\t%0, %0, %1\\;src\\t%0, %0, %0\\;src\\t%0, %1, %0\"\n+  [(set_attr \"type\"\t\"arith\")\n+   (set_attr \"mode\"\t\"SI\")\n+   (set_attr \"length\"\t\"15\")])\n+\n+(define_insn \"bswapdi2\"\n+  [(set (match_operand:DI 0 \"register_operand\" \"=&a\")\n+\t(bswap:DI (match_operand:DI 1 \"register_operand\" \"r\")))]\n+  \"!optimize_size\"\n+  \"ssai\\t8\\;srli\\t%0, %D1, 16\\;src\\t%0, %0, %D1\\;src\\t%0, %0, %0\\;src\\t%0, %D1, %0\\;srli\\t%D0, %1, 16\\;src\\t%D0, %D0, %1\\;src\\t%D0, %D0, %D0\\;src\\t%D0, %1, %D0\"\n+  [(set_attr \"type\"\t\"arith\")\n+   (set_attr \"mode\"\t\"DI\")\n+   (set_attr \"length\"\t\"27\")])\n+\n \f\n ;; Negation and one's complement.\n "}, {"sha": "057a3569703f045b31b7fd73a03768daf31537bb", "filename": "gcc/testsuite/gcc.target/xtensa/bswap.c", "status": "added", "additions": 14, "deletions": 0, "changes": 14, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/18e86fae2a14f78e70aae06afce6bb9853068bb1/gcc%2Ftestsuite%2Fgcc.target%2Fxtensa%2Fbswap.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/18e86fae2a14f78e70aae06afce6bb9853068bb1/gcc%2Ftestsuite%2Fgcc.target%2Fxtensa%2Fbswap.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgcc.target%2Fxtensa%2Fbswap.c?ref=18e86fae2a14f78e70aae06afce6bb9853068bb1", "patch": "@@ -0,0 +1,14 @@\n+/* { dg-do compile } */\n+/* { dg-options \"-O1\" } */\n+\n+unsigned long f32(unsigned long v)\n+{\n+  return __builtin_bswap32(v);\n+}\n+\n+unsigned long long f64(unsigned long long v)\n+{\n+  return __builtin_bswap64(v);\n+}\n+\n+/* { dg-final { scan-assembler-times \"ssai\" 2 } } */"}, {"sha": "b19deae1448353f488038765cb9c9bdbf9a05b32", "filename": "libgcc/config/xtensa/lib1funcs.S", "status": "modified", "additions": 39, "deletions": 0, "changes": 39, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/18e86fae2a14f78e70aae06afce6bb9853068bb1/libgcc%2Fconfig%2Fxtensa%2Flib1funcs.S", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/18e86fae2a14f78e70aae06afce6bb9853068bb1/libgcc%2Fconfig%2Fxtensa%2Flib1funcs.S", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libgcc%2Fconfig%2Fxtensa%2Flib1funcs.S?ref=18e86fae2a14f78e70aae06afce6bb9853068bb1", "patch": "@@ -840,5 +840,44 @@ __lshrdi3:\n #endif /* L_lshrdi3 */\n \n \n+#ifdef L_bswapsi2\n+\t.align\t4\n+\t.global\t__bswapsi2\n+\t.type\t__bswapsi2, @function\n+__bswapsi2:\n+\tleaf_entry sp, 16\n+\tssai\t8\n+\tsrli\ta3, a2, 16\n+\tsrc\ta3, a3, a2\n+\tsrc\ta3, a3, a3\n+\tsrc\ta2, a2, a3\n+\tleaf_return\n+\t.size\t__bswapsi2, . - __bswapsi2\n+\n+#endif /* L_bswapsi2 */\n+\n+\n+#ifdef L_bswapdi2\n+\t.align\t4\n+\t.global\t__bswapdi2\n+\t.type\t__bswapdi2, @function\n+__bswapdi2:\n+\tleaf_entry sp, 16\n+\tssai\t8\n+\tsrli\ta4, a2, 16\n+\tsrc\ta4, a4, a2\n+\tsrc\ta4, a4, a4\n+\tsrc\ta4, a2, a4\n+\tsrli\ta2, a3, 16\n+\tsrc\ta2, a2, a3\n+\tsrc\ta2, a2, a2\n+\tsrc\ta2, a3, a2\n+\tmov\ta3, a4\n+\tleaf_return\n+\t.size\t__bswapdi2, . - __bswapdi2\n+\n+#endif /* L_bswapdi2 */\n+\n+\n #include \"ieee754-df.S\"\n #include \"ieee754-sf.S\""}, {"sha": "9836c96aefc6bf241564b28f6efb51f9804f9ec8", "filename": "libgcc/config/xtensa/t-xtensa", "status": "modified", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/18e86fae2a14f78e70aae06afce6bb9853068bb1/libgcc%2Fconfig%2Fxtensa%2Ft-xtensa", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/18e86fae2a14f78e70aae06afce6bb9853068bb1/libgcc%2Fconfig%2Fxtensa%2Ft-xtensa", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libgcc%2Fconfig%2Fxtensa%2Ft-xtensa?ref=18e86fae2a14f78e70aae06afce6bb9853068bb1", "patch": "@@ -2,6 +2,7 @@ LIB1ASMSRC = xtensa/lib1funcs.S\n LIB1ASMFUNCS = _mulsi3 _divsi3 _modsi3 _udivsi3 _umodsi3 \\\n \t_umulsidi3 _clz _clzsi2 _ctzsi2 _ffssi2 \\\n \t_ashldi3 _ashrdi3 _lshrdi3 \\\n+\t_bswapsi2 _bswapdi2 \\\n \t_negsf2 _addsubsf3 _mulsf3 _divsf3 _cmpsf2 _fixsfsi _fixsfdi \\\n \t_fixunssfsi _fixunssfdi _floatsisf _floatunsisf \\\n \t_sqrtf _recipsf2 _rsqrtsf2 \\"}]}