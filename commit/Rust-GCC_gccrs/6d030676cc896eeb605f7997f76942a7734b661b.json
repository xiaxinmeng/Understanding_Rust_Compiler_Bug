{"sha": "6d030676cc896eeb605f7997f76942a7734b661b", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6NmQwMzA2NzZjYzg5NmVlYjYwNWY3OTk3Zjc2OTQyYTc3MzRiNjYxYg==", "commit": {"author": {"name": "Paolo Carlini", "email": "paolo@gcc.gnu.org", "date": "2002-05-04T21:33:19Z"}, "committer": {"name": "Paolo Carlini", "email": "paolo@gcc.gnu.org", "date": "2002-05-04T21:33:19Z"}, "message": "[multiple changes]\n\n2002-05-04  Benjamin Kosnik  <bkoz@redhat.com>\n\t    Paolo Carlini  <pcarlini@unitus.it>\n\n\t* testsuite/22_locale/num_put_members_char.cc: Add test04(),\n\ttesting for the locale_facets.tcc entry of the previous commit.\n\t* testsuite/22_locale/num_put_members_wchar_t.cc: Likewise.\n\n2002-05-04  Takeshi Kobayakawa  <tskoba@mte.biglobe.ne.jp>\n\n\t* config/locale/generic/c_locale.cc\n\t(__convert_to_v(float, double, long double)):\n\tFix the temporary switch to the \"C\" locale, saving and\n\trestoring in the proper way the current locale.\n\t* config/locale/generic/time_members.cc\n\t(__timepunct<char, wchar_t>::_M_put): Likewise.\n\t* config/locale/gnu/messages_members.cc\n\t(messages<char>::do_get): Likewise.\n\t* config/locale/gnu/messages_members.h\n\t(messages<_CharT>::do_get): Likewise.\n\t* config/locale/gnu/time_members.cc\n\t(__timepunct<char, wchar_t>::_M_put): Likewise.\n\t* include/bits/locale_facets.tcc (__convert_from_v): Likewise.\n\nFrom-SVN: r53167", "tree": {"sha": "2ef4c6b0b0f478842b00f63616c13f0a8e6a2dce", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/2ef4c6b0b0f478842b00f63616c13f0a8e6a2dce"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/6d030676cc896eeb605f7997f76942a7734b661b", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/6d030676cc896eeb605f7997f76942a7734b661b", "html_url": "https://github.com/Rust-GCC/gccrs/commit/6d030676cc896eeb605f7997f76942a7734b661b", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/6d030676cc896eeb605f7997f76942a7734b661b/comments", "author": null, "committer": null, "parents": [{"sha": "7e90efc40343d2aceb75acae7479dc5cf7d3d4fa", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/7e90efc40343d2aceb75acae7479dc5cf7d3d4fa", "html_url": "https://github.com/Rust-GCC/gccrs/commit/7e90efc40343d2aceb75acae7479dc5cf7d3d4fa"}], "stats": {"total": 91, "additions": 80, "deletions": 11}, "files": [{"sha": "03939a0b6b12352903b7dcb47891399953cc5fb6", "filename": "libstdc++-v3/ChangeLog", "status": "modified", "additions": 23, "deletions": 0, "changes": 23, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/6d030676cc896eeb605f7997f76942a7734b661b/libstdc%2B%2B-v3%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/6d030676cc896eeb605f7997f76942a7734b661b/libstdc%2B%2B-v3%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libstdc%2B%2B-v3%2FChangeLog?ref=6d030676cc896eeb605f7997f76942a7734b661b", "patch": "@@ -1,3 +1,26 @@\n+2002-05-04  Benjamin Kosnik  <bkoz@redhat.com>\n+\t    Paolo Carlini  <pcarlini@unitus.it>\n+\n+\t* testsuite/22_locale/num_put_members_char.cc: Add test04(),\n+\ttesting for the locale_facets.tcc entry of the previous commit.\n+\t* testsuite/22_locale/num_put_members_wchar_t.cc: Likewise.\n+\n+2002-05-04  Takeshi Kobayakawa  <tskoba@mte.biglobe.ne.jp>\n+\n+\t* config/locale/generic/c_locale.cc\n+\t(__convert_to_v(float, double, long double)):\n+\tFix the temporary switch to the \"C\" locale, saving and\n+\trestoring in the proper way the current locale.\n+\t* config/locale/generic/time_members.cc\n+\t(__timepunct<char, wchar_t>::_M_put): Likewise.\n+\t* config/locale/gnu/messages_members.cc\n+\t(messages<char>::do_get): Likewise.\n+\t* config/locale/gnu/messages_members.h\n+\t(messages<_CharT>::do_get): Likewise.\n+\t* config/locale/gnu/time_members.cc\n+\t(__timepunct<char, wchar_t>::_M_put): Likewise.\n+\t* include/bits/locale_facets.tcc (__convert_from_v): Likewise.\n+\n 2002-05-04  Kaveh R. Ghazi  <ghazi@caip.rutgers.edu>\n \n \t* configure.in (AC_CHECK_HEADERS): Check for string.h & stdlib.h."}, {"sha": "e274836fd901d39de172da81f3bcef09335705f2", "filename": "libstdc++-v3/config/locale/generic/c_locale.cc", "status": "modified", "additions": 9, "deletions": 3, "changes": 12, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/6d030676cc896eeb605f7997f76942a7734b661b/libstdc%2B%2B-v3%2Fconfig%2Flocale%2Fgeneric%2Fc_locale.cc", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/6d030676cc896eeb605f7997f76942a7734b661b/libstdc%2B%2B-v3%2Fconfig%2Flocale%2Fgeneric%2Fc_locale.cc", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libstdc%2B%2B-v3%2Fconfig%2Flocale%2Fgeneric%2Fc_locale.cc?ref=6d030676cc896eeb605f7997f76942a7734b661b", "patch": "@@ -120,7 +120,8 @@ namespace std\n       if (!(__err & ios_base::failbit))\n \t{\n \t  // Assumes __s formatted for \"C\" locale.\n-\t  const char* __old = setlocale(LC_ALL, \"C\");\n+\t  char* __old = strdup(setlocale(LC_ALL, NULL));\n+\t  setlocale(LC_ALL, \"C\");\n \t  char* __sanity;\n \t  errno = 0;\n #if defined(_GLIBCPP_USE_C99)\n@@ -147,6 +148,7 @@ namespace std\n \t  else\n \t    __err |= ios_base::failbit;\n \t  setlocale(LC_ALL, __old);\n+\t  free(__old);\n \t}\n     }\n \n@@ -158,7 +160,8 @@ namespace std\n       if (!(__err & ios_base::failbit))\n \t{\n \t  // Assumes __s formatted for \"C\" locale.\n-\t  const char* __old = setlocale(LC_ALL, \"C\");\n+\t  char* __old = strdup(setlocale(LC_ALL, NULL));\n+\t  setlocale(LC_ALL, \"C\");\n \t  char* __sanity;\n \t  errno = 0;\n \t  double __d = strtod(__s, &__sanity);\n@@ -167,6 +170,7 @@ namespace std\n \t  else\n \t    __err |= ios_base::failbit;\n \t  setlocale(LC_ALL, __old);\n+\t  free(__old);\n \t}\n     }\n \n@@ -178,7 +182,8 @@ namespace std\n       if (!(__err & ios_base::failbit))\n \t{\n \t  // Assumes __s formatted for \"C\" locale.\n-\t  const char* __old = setlocale(LC_ALL, \"C\");\n+\t  char* __old = strdup(setlocale(LC_ALL, NULL));\n+\t  setlocale(LC_ALL, \"C\");\n #if defined(_GLIBCPP_USE_C99)\n \t  char* __sanity;\n \t  errno = 0;\n@@ -202,6 +207,7 @@ namespace std\n \t  else\n \t    __err |= ios_base::failbit;\n \t  setlocale(LC_ALL, __old);\n+\t  free(__old);\n \t}\n     }\n "}, {"sha": "d02f0c3fa0eaf0e1a3dd30efc39703526064e04f", "filename": "libstdc++-v3/config/locale/generic/time_members.cc", "status": "modified", "additions": 6, "deletions": 2, "changes": 8, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/6d030676cc896eeb605f7997f76942a7734b661b/libstdc%2B%2B-v3%2Fconfig%2Flocale%2Fgeneric%2Ftime_members.cc", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/6d030676cc896eeb605f7997f76942a7734b661b/libstdc%2B%2B-v3%2Fconfig%2Flocale%2Fgeneric%2Ftime_members.cc", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libstdc%2B%2B-v3%2Fconfig%2Flocale%2Fgeneric%2Ftime_members.cc?ref=6d030676cc896eeb605f7997f76942a7734b661b", "patch": "@@ -51,9 +51,11 @@ namespace std\n     _M_put(char* __s, size_t __maxlen, const char* __format, \n \t   const tm* __tm) const\n     {\n-      const char* __old = setlocale(LC_ALL, _M_name_timepunct);\n+      char* __old = strdup(setlocale(LC_ALL, NULL));\n+      setlocale(LC_ALL, _M_name_timepunct);\n       strftime(__s, __maxlen, __format, __tm);\n       setlocale(LC_ALL, __old);\n+      free(__old);\n     }\n \n   template<> \n@@ -132,9 +134,11 @@ namespace std\n     _M_put(wchar_t* __s, size_t __maxlen, const wchar_t* __format, \n \t   const tm* __tm) const\n     {\n-      const char* __old = setlocale(LC_ALL, _M_name_timepunct);\n+      char* __old = strdup(setlocale(LC_ALL, NULL));\n+      setlocale(LC_ALL, _M_name_timepunct);\n       wcsftime(__s, __maxlen, __format, __tm);\n       setlocale(LC_ALL, __old);\n+      free(__old);\n     }\n \n   template<> "}, {"sha": "2717c6b55e1047541c77da7f15daf726b4c9475e", "filename": "libstdc++-v3/config/locale/gnu/messages_members.cc", "status": "modified", "additions": 3, "deletions": 1, "changes": 4, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/6d030676cc896eeb605f7997f76942a7734b661b/libstdc%2B%2B-v3%2Fconfig%2Flocale%2Fgnu%2Fmessages_members.cc", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/6d030676cc896eeb605f7997f76942a7734b661b/libstdc%2B%2B-v3%2Fconfig%2Flocale%2Fgnu%2Fmessages_members.cc", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libstdc%2B%2B-v3%2Fconfig%2Flocale%2Fgnu%2Fmessages_members.cc?ref=6d030676cc896eeb605f7997f76942a7734b661b", "patch": "@@ -48,9 +48,11 @@ namespace std\n       __uselocale(__old);\n       return string(__msg);\n #else\n-      const char* __old = setlocale(LC_ALL, _M_name_messages);\n+      char* __old = strdup(setlocale(LC_ALL, NULL));\n+      setlocale(LC_ALL, _M_name_messages);\n       const char* __msg = gettext(__dfault.c_str());\n       setlocale(LC_ALL, __old);\n+      free(__old);\n       return string(__msg);\n #endif\n     }"}, {"sha": "11bfcb5044076e444e37cda7f0c18171f936a3fb", "filename": "libstdc++-v3/config/locale/gnu/messages_members.h", "status": "modified", "additions": 3, "deletions": 1, "changes": 4, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/6d030676cc896eeb605f7997f76942a7734b661b/libstdc%2B%2B-v3%2Fconfig%2Flocale%2Fgnu%2Fmessages_members.h", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/6d030676cc896eeb605f7997f76942a7734b661b/libstdc%2B%2B-v3%2Fconfig%2Flocale%2Fgnu%2Fmessages_members.h", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libstdc%2B%2B-v3%2Fconfig%2Flocale%2Fgnu%2Fmessages_members.h?ref=6d030676cc896eeb605f7997f76942a7734b661b", "patch": "@@ -65,9 +65,11 @@\n       __uselocale(__old);\n       return _M_convert_from_char(__msg);\n #else\n-      const char* __old = setlocale(LC_ALL, _M_name_messages);\n+      char* __old = strdup(setlocale(LC_ALL, NULL));\n+      setlocale(LC_ALL, _M_name_messages);\n       char* __msg = gettext(_M_convert_to_char(__dfault));\n       setlocale(LC_ALL, __old);\n+      free(__old);\n       return _M_convert_from_char(__msg);\n #endif\n     }"}, {"sha": "ad71931056a423d2b8a0e8d2df2bf26a48a6a882", "filename": "libstdc++-v3/config/locale/gnu/time_members.cc", "status": "modified", "additions": 6, "deletions": 2, "changes": 8, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/6d030676cc896eeb605f7997f76942a7734b661b/libstdc%2B%2B-v3%2Fconfig%2Flocale%2Fgnu%2Ftime_members.cc", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/6d030676cc896eeb605f7997f76942a7734b661b/libstdc%2B%2B-v3%2Fconfig%2Flocale%2Fgnu%2Ftime_members.cc", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libstdc%2B%2B-v3%2Fconfig%2Flocale%2Fgnu%2Ftime_members.cc?ref=6d030676cc896eeb605f7997f76942a7734b661b", "patch": "@@ -54,9 +54,11 @@ namespace std\n #if __GLIBC__ > 2 || (__GLIBC__ == 2 && __GLIBC_MINOR__ > 2)\n       __strftime_l(__s, __maxlen, _M_c_locale_timepunct, __format, __tm);\n #else\n-      const char* __old = setlocale(LC_ALL, _M_name_timepunct);\n+      char* __old = strdup(setlocale(LC_ALL, NULL));\n+      setlocale(LC_ALL, _M_name_timepunct);\n       strftime(__s, __maxlen, __format, __tm);\n       setlocale(LC_ALL, __old);\n+      free(__old);\n #endif\n     }\n \n@@ -202,9 +204,11 @@ namespace std\n #if __GLIBC__ > 2 || (__GLIBC__ == 2 && __GLIBC_MINOR__ > 2)\n       __wcsftime_l(__s, __maxlen, _M_c_locale_timepunct, __format, __tm);\n #else\n-      const char* __old = setlocale(LC_ALL, _M_name_timepunct);\n+      char* __old = strdup(setlocale(LC_ALL, NULL));\n+      setlocale(LC_ALL, _M_name_timepunct);\n       wcsftime(__s, __maxlen, __format, __tm);\n       setlocale(LC_ALL, __old);\n+      free(__old);\n #endif\n     }\n "}, {"sha": "dea2fdfdac24b2f481dfe0b2cd8536c455e61b65", "filename": "libstdc++-v3/include/bits/locale_facets.tcc", "status": "modified", "additions": 6, "deletions": 2, "changes": 8, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/6d030676cc896eeb605f7997f76942a7734b661b/libstdc%2B%2B-v3%2Finclude%2Fbits%2Flocale_facets.tcc", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/6d030676cc896eeb605f7997f76942a7734b661b/libstdc%2B%2B-v3%2Finclude%2Fbits%2Flocale_facets.tcc", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libstdc%2B%2B-v3%2Finclude%2Fbits%2Flocale_facets.tcc?ref=6d030676cc896eeb605f7997f76942a7734b661b", "patch": "@@ -1959,12 +1959,14 @@ namespace std\n \t\t     _Tv __v, const __c_locale&, int __prec = -1)\n     {\n       int __ret;\n-      const char* __old = setlocale(LC_ALL, \"C\");\n+      char* __old = strdup(setlocale(LC_ALL, NULL));\n+      setlocale(LC_ALL, \"C\");\n       if (__prec >= 0)\n         __ret = snprintf(__out, __size, __fmt, __prec, __v);\n       else\n         __ret = snprintf(__out, __size, __fmt, __v);\n       setlocale(LC_ALL, __old);\n+      free(__old);\n       return __ret;\n     }\n #else\n@@ -1974,12 +1976,14 @@ namespace std\n \t\t     const __c_locale&, int __prec = -1)\n     {\n       int __ret;\n-      const char* __old = setlocale(LC_ALL, \"C\");\n+      char* __old = strdup(setlocale(LC_ALL, NULL));\n+      setlocale(LC_ALL, \"C\");\n       if (__prec >= 0)\n         __ret = sprintf(__out, __fmt, __prec, __v);\n       else\n         __ret = sprintf(__out, __fmt, __v);\n       setlocale(LC_ALL, __old);\n+      free(__old);\n       return __ret;\n     }\n #endif"}, {"sha": "09630833d225bf7e15b4860cf4789d53ccc65fbe", "filename": "libstdc++-v3/testsuite/22_locale/num_put_members_char.cc", "status": "modified", "additions": 12, "deletions": 0, "changes": 12, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/6d030676cc896eeb605f7997f76942a7734b661b/libstdc%2B%2B-v3%2Ftestsuite%2F22_locale%2Fnum_put_members_char.cc", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/6d030676cc896eeb605f7997f76942a7734b661b/libstdc%2B%2B-v3%2Ftestsuite%2F22_locale%2Fnum_put_members_char.cc", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libstdc%2B%2B-v3%2Ftestsuite%2F22_locale%2Fnum_put_members_char.cc?ref=6d030676cc896eeb605f7997f76942a7734b661b", "patch": "@@ -310,11 +310,23 @@ void test03()\n #endif\n }\n \n+void test04()\n+{\n+  bool test = true;\n+\n+  std::string loc1 = setlocale(LC_ALL, \"ja_JP.eucjp\");\n+  test01();\n+  test02();\n+  std::string loc2 = setlocale(LC_ALL, NULL);\n+  VERIFY( loc1 == loc2 );\n+}\n+\n int main()\n {\n   test01();\n   test02();\n   test03();\n+  test04();\n   return 0;\n }\n "}, {"sha": "f3ac69238bf18ce0e31c215799e3849ddabd7ef3", "filename": "libstdc++-v3/testsuite/22_locale/num_put_members_wchar_t.cc", "status": "modified", "additions": 12, "deletions": 0, "changes": 12, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/6d030676cc896eeb605f7997f76942a7734b661b/libstdc%2B%2B-v3%2Ftestsuite%2F22_locale%2Fnum_put_members_wchar_t.cc", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/6d030676cc896eeb605f7997f76942a7734b661b/libstdc%2B%2B-v3%2Ftestsuite%2F22_locale%2Fnum_put_members_wchar_t.cc", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libstdc%2B%2B-v3%2Ftestsuite%2F22_locale%2Fnum_put_members_wchar_t.cc?ref=6d030676cc896eeb605f7997f76942a7734b661b", "patch": "@@ -309,6 +309,17 @@ void test03()\n     }\n #endif\n }\n+\n+void test04()\n+{\n+  bool test = true;\n+\n+  std::string loc1 = setlocale(LC_ALL, \"ja_JP.eucjp\");\n+  test01();\n+  test02();\n+  std::string loc2 = setlocale(LC_ALL, NULL);\n+  VERIFY( loc1 == loc2 );\n+}\n #endif\n \n int main()\n@@ -317,6 +328,7 @@ int main()\n   test01();\n   test02();\n   test03();\n+  test04();\n #endif\n   return 0;\n }"}]}