{"sha": "2d38d80934cd2e8a60b212ed34ffc7b062d7960a", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6MmQzOGQ4MDkzNGNkMmU4YTYwYjIxMmVkMzRmZmM3YjA2MmQ3OTYwYQ==", "commit": {"author": {"name": "Dominik Vogt", "email": "vogt@linux.vnet.ibm.com", "date": "2015-03-31T12:07:06Z"}, "committer": {"name": "Andreas Krebbel", "email": "krebbel@gcc.gnu.org", "date": "2015-03-31T12:07:06Z"}, "message": "S/390: Hotpatch: Remove special handling of nested functions.\n\ngcc/\n2015-03-31  Dominik Vogt  <vogt@linux.vnet.ibm.com>\n\n\t    * config/s390/s390.c (s390_function_num_hotpatch_hw): Allow hotpatching\n\t    nested functions.\n\t    (s390_reorg): Adapt to new signature of s390_function_num_hotpatch_hw.\n\t    (s390_asm_output_function_label): Adapt to new signature of\n\t    s390_function_num_hotpatch_hw\n\t    Optimise the code generating assembler output.\n\t    Add comments to assembler file.\n\ngcc/testsuite/\n2015-03-31  Dominik Vogt  <vogt@linux.vnet.ibm.com>\n\n\t    * gcc.target/s390/hotpatch-25.c: New test.\n\t    * gcc.target/s390/hotpatch-1.c: Update test.\n\t    * gcc.target/s390/hotpatch-10.c: Update test.\n\t    * gcc.target/s390/hotpatch-11.c: Update test.\n\t    * gcc.target/s390/hotpatch-12.c: Update test.\n\t    * gcc.target/s390/hotpatch-13.c: Update test.\n\t    * gcc.target/s390/hotpatch-14.c: Update test.\n\t    * gcc.target/s390/hotpatch-15.c: Update test.\n\t    * gcc.target/s390/hotpatch-16.c: Update test.\n\t    * gcc.target/s390/hotpatch-17.c: Update test.\n\t    * gcc.target/s390/hotpatch-18.c: Update test.\n\t    * gcc.target/s390/hotpatch-19.c: Update test.\n\t    * gcc.target/s390/hotpatch-2.c: Update test.\n\t    * gcc.target/s390/hotpatch-21.c: Update test.\n\t    * gcc.target/s390/hotpatch-22.c: Update test.\n\t    * gcc.target/s390/hotpatch-23.c: Update test.\n\t    * gcc.target/s390/hotpatch-24.c: Update test.\n\t    * gcc.target/s390/hotpatch-3.c: Update test.\n\t    * gcc.target/s390/hotpatch-4.c: Update test.\n\t    * gcc.target/s390/hotpatch-5.c: Update test.\n\t    * gcc.target/s390/hotpatch-6.c: Update test.\n\t    * gcc.target/s390/hotpatch-7.c: Update test.\n\t    * gcc.target/s390/hotpatch-8.c: Update test.\n\t    * gcc.target/s390/hotpatch-9.c: Update test.\n\t    * gcc.target/s390/hotpatch-compile-16.c: Update test.\n\nFrom-SVN: r221794", "tree": {"sha": "6da7919cf44b50caa8b641623df5a8420f1649b7", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/6da7919cf44b50caa8b641623df5a8420f1649b7"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/2d38d80934cd2e8a60b212ed34ffc7b062d7960a", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/2d38d80934cd2e8a60b212ed34ffc7b062d7960a", "html_url": "https://github.com/Rust-GCC/gccrs/commit/2d38d80934cd2e8a60b212ed34ffc7b062d7960a", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/2d38d80934cd2e8a60b212ed34ffc7b062d7960a/comments", "author": {"login": "vogtd", "id": 9690100, "node_id": "MDQ6VXNlcjk2OTAxMDA=", "avatar_url": "https://avatars.githubusercontent.com/u/9690100?v=4", "gravatar_id": "", "url": "https://api.github.com/users/vogtd", "html_url": "https://github.com/vogtd", "followers_url": "https://api.github.com/users/vogtd/followers", "following_url": "https://api.github.com/users/vogtd/following{/other_user}", "gists_url": "https://api.github.com/users/vogtd/gists{/gist_id}", "starred_url": "https://api.github.com/users/vogtd/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/vogtd/subscriptions", "organizations_url": "https://api.github.com/users/vogtd/orgs", "repos_url": "https://api.github.com/users/vogtd/repos", "events_url": "https://api.github.com/users/vogtd/events{/privacy}", "received_events_url": "https://api.github.com/users/vogtd/received_events", "type": "User", "site_admin": false}, "committer": null, "parents": [{"sha": "bed18fbd09667cbaecc3b8a99e05801a24e5324b", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/bed18fbd09667cbaecc3b8a99e05801a24e5324b", "html_url": "https://github.com/Rust-GCC/gccrs/commit/bed18fbd09667cbaecc3b8a99e05801a24e5324b"}], "stats": {"total": 184, "additions": 148, "deletions": 36}, "files": [{"sha": "72389ee4e7a82f9ec5b6dfe5f21cb9c3632fb8fb", "filename": "gcc/ChangeLog", "status": "modified", "additions": 10, "deletions": 0, "changes": 10, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/2d38d80934cd2e8a60b212ed34ffc7b062d7960a/gcc%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/2d38d80934cd2e8a60b212ed34ffc7b062d7960a/gcc%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2FChangeLog?ref=2d38d80934cd2e8a60b212ed34ffc7b062d7960a", "patch": "@@ -1,3 +1,13 @@\n+2015-03-31  Dominik Vogt  <vogt@linux.vnet.ibm.com>\n+\n+\t* config/s390/s390.c (s390_function_num_hotpatch_hw): Allow hotpatching\n+\tnested functions.\n+\t(s390_reorg): Adapt to new signature of s390_function_num_hotpatch_hw.\n+\t(s390_asm_output_function_label): Adapt to new signature of\n+\ts390_function_num_hotpatch_hw\n+\tOptimise the code generating assembler output.\n+\tAdd comments to assembler file.\n+\n 2015-03-31  Richard Biener  <rguenther@suse.de>\n \n \tPR middle-end/65626"}, {"sha": "7d16048db8e206a7cf1bcc08c1e5275ba4d68c43", "filename": "gcc/config/s390/s390.c", "status": "modified", "additions": 24, "deletions": 29, "changes": 53, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/2d38d80934cd2e8a60b212ed34ffc7b062d7960a/gcc%2Fconfig%2Fs390%2Fs390.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/2d38d80934cd2e8a60b212ed34ffc7b062d7960a/gcc%2Fconfig%2Fs390%2Fs390.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fconfig%2Fs390%2Fs390.c?ref=2d38d80934cd2e8a60b212ed34ffc7b062d7960a", "patch": "@@ -5234,21 +5234,18 @@ print_shift_count_operand (FILE *file, rtx op)\n     fprintf (file, \"(%s)\", reg_names[REGNO (base)]);\n }\n \n-/* Returns false if the function should not be made hotpatchable.\n-   Otherwise it assigns the number of NOP halfwords to be emitted\n-   before and after the function label to hw_before and hw_after.\n-   Both must not be NULL.  */\n+/* Assigns the number of NOP halfwords to be emitted before and after the\n+   function label to *HW_BEFORE and *HW_AFTER.  Both pointers must not be NULL.\n+   If hotpatching is disabled for the function, the values are set to zero.\n+*/\n \n-static bool\n+static void\n s390_function_num_hotpatch_hw (tree decl,\n \t\t\t       int *hw_before,\n \t\t\t       int *hw_after)\n {\n   tree attr;\n \n-  *hw_before = 0;\n-  *hw_after = 0;\n-\n   attr = lookup_attribute (\"hotpatch\", DECL_ATTRIBUTES (decl));\n \n   /* Handle the arguments of the hotpatch attribute.  The values\n@@ -5267,18 +5264,6 @@ s390_function_num_hotpatch_hw (tree decl,\n       *hw_before = s390_hotpatch_hw_before_label;\n       *hw_after = s390_hotpatch_hw_after_label;\n     }\n-\n-  if (*hw_before == 0 && *hw_after == 0)\n-    return false;\n-\n-  if (decl_function_context (decl) != NULL_TREE)\n-    {\n-      warning_at (DECL_SOURCE_LOCATION (decl), OPT_mhotpatch_,\n-\t\t  \"hotpatching is not compatible with nested functions\");\n-      return false;\n-    }\n-\n-  return true;\n }\n \n /* Write the extra assembler code needed to declare a function properly.  */\n@@ -5288,35 +5273,45 @@ s390_asm_output_function_label (FILE *asm_out_file, const char *fname,\n \t\t\t\ttree decl)\n {\n   int hw_before, hw_after;\n-  bool hotpatch_p = (decl\n-\t\t     ? s390_function_num_hotpatch_hw (decl,\n-\t\t\t\t\t\t      &hw_before, &hw_after)\n-\t\t     : false);\n \n-  if (hotpatch_p)\n+  s390_function_num_hotpatch_hw (decl, &hw_before, &hw_after);\n+  if (hw_before > 0)\n     {\n       unsigned int function_alignment;\n       int i;\n \n       /* Add a trampoline code area before the function label and initialize it\n \t with two-byte nop instructions.  This area can be overwritten with code\n \t that jumps to a patched version of the function.  */\n-      for (i = 0; i < hw_before; i++)\n-\tasm_fprintf (asm_out_file, \"\\tnopr\\t%%r7\\n\");\n+      asm_fprintf (asm_out_file, \"\\tnopr\\t%%r7\"\n+\t\t   \"\\t# pre-label NOPs for hotpatch (%d halfwords)\\n\",\n+\t\t   hw_before);\n+      for (i = 1; i < hw_before; i++)\n+\tfputs (\"\\tnopr\\t%r7\\n\", asm_out_file);\n+\n       /* Note:  The function label must be aligned so that (a) the bytes of the\n \t following nop do not cross a cacheline boundary, and (b) a jump address\n \t (eight bytes for 64 bit targets, 4 bytes for 32 bit targets) can be\n \t stored directly before the label without crossing a cacheline\n \t boundary.  All this is necessary to make sure the trampoline code can\n-\t be changed atomically.  */\n+\t be changed atomically.\n+\t This alignment is done automatically using the FOUNCTION_BOUNDARY, but\n+\t if there are NOPs before the function label, the alignment is placed\n+\t before them.  So it is necessary to duplicate the alignment after the\n+\t NOPs.  */\n       function_alignment = MAX (8, DECL_ALIGN (decl) / BITS_PER_UNIT);\n       if (! DECL_USER_ALIGN (decl))\n \tfunction_alignment = MAX (function_alignment,\n \t\t\t\t  (unsigned int) align_functions);\n+      fputs (\"\\t# alignment for hotpatch\\n\", asm_out_file);\n       ASM_OUTPUT_ALIGN (asm_out_file, floor_log2 (function_alignment));\n     }\n \n   ASM_OUTPUT_LABEL (asm_out_file, fname);\n+  if (hw_after > 0)\n+    asm_fprintf (asm_out_file,\n+\t\t \"\\t# post-label NOPs for hotpatch (%d halfwords)\\n\",\n+\t\t hw_after);\n }\n \n /* Output machine-dependent UNSPECs occurring in address constant X\n@@ -11491,7 +11486,7 @@ s390_reorg (void)\n     {\n       rtx_insn *insn;\n \n-      /* Inject nops for hotpatching. */\n+      /* Insert NOPs for hotpatching. */\n       for (insn = get_insns (); insn; insn = NEXT_INSN (insn))\n \t{\n \t  if (NOTE_P (insn) && NOTE_KIND (insn) == NOTE_INSN_FUNCTION_BEG)"}, {"sha": "b6236369291e1819ad8558a4525e1e45340b1a05", "filename": "gcc/testsuite/ChangeLog", "status": "modified", "additions": 28, "deletions": 0, "changes": 28, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/2d38d80934cd2e8a60b212ed34ffc7b062d7960a/gcc%2Ftestsuite%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/2d38d80934cd2e8a60b212ed34ffc7b062d7960a/gcc%2Ftestsuite%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2FChangeLog?ref=2d38d80934cd2e8a60b212ed34ffc7b062d7960a", "patch": "@@ -1,3 +1,31 @@\n+2015-03-31  Dominik Vogt  <vogt@linux.vnet.ibm.com>\n+\n+\t* gcc.target/s390/hotpatch-25.c: New test.\n+\t* gcc.target/s390/hotpatch-1.c: Update test.\n+\t* gcc.target/s390/hotpatch-10.c: Update test.\n+\t* gcc.target/s390/hotpatch-11.c: Update test.\n+\t* gcc.target/s390/hotpatch-12.c: Update test.\n+\t* gcc.target/s390/hotpatch-13.c: Update test.\n+\t* gcc.target/s390/hotpatch-14.c: Update test.\n+\t* gcc.target/s390/hotpatch-15.c: Update test.\n+\t* gcc.target/s390/hotpatch-16.c: Update test.\n+\t* gcc.target/s390/hotpatch-17.c: Update test.\n+\t* gcc.target/s390/hotpatch-18.c: Update test.\n+\t* gcc.target/s390/hotpatch-19.c: Update test.\n+\t* gcc.target/s390/hotpatch-2.c: Update test.\n+\t* gcc.target/s390/hotpatch-21.c: Update test.\n+\t* gcc.target/s390/hotpatch-22.c: Update test.\n+\t* gcc.target/s390/hotpatch-23.c: Update test.\n+\t* gcc.target/s390/hotpatch-24.c: Update test.\n+\t* gcc.target/s390/hotpatch-3.c: Update test.\n+\t* gcc.target/s390/hotpatch-4.c: Update test.\n+\t* gcc.target/s390/hotpatch-5.c: Update test.\n+\t* gcc.target/s390/hotpatch-6.c: Update test.\n+\t* gcc.target/s390/hotpatch-7.c: Update test.\n+\t* gcc.target/s390/hotpatch-8.c: Update test.\n+\t* gcc.target/s390/hotpatch-9.c: Update test.\n+\t* gcc.target/s390/hotpatch-compile-16.c: Update test.\n+\n 2015-03-31  Richard Biener  <rguenther@suse.de>\n \n \tPR middle-end/65626"}, {"sha": "b14fa9010a8cce02218e3f41093c725948da1e73", "filename": "gcc/testsuite/gcc.target/s390/hotpatch-1.c", "status": "modified", "additions": 3, "deletions": 0, "changes": 3, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/2d38d80934cd2e8a60b212ed34ffc7b062d7960a/gcc%2Ftestsuite%2Fgcc.target%2Fs390%2Fhotpatch-1.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/2d38d80934cd2e8a60b212ed34ffc7b062d7960a/gcc%2Ftestsuite%2Fgcc.target%2Fs390%2Fhotpatch-1.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgcc.target%2Fs390%2Fhotpatch-1.c?ref=2d38d80934cd2e8a60b212ed34ffc7b062d7960a", "patch": "@@ -11,6 +11,9 @@ void hp1(void)\n }\n \n /* Check number of occurences of certain instructions.  */\n+/* { dg-final { scan-assembler-not \"pre-label NOPs\" } } */\n+/* { dg-final { scan-assembler-not \"post-label NOPs\" } } */\n /* { dg-final { scan-assembler-not \"nopr\\t%r7\" } } */\n /* { dg-final { scan-assembler-not \"nop\\t0\" } } */\n /* { dg-final { scan-assembler-not \"brcl\\t0, 0\" } } */\n+/* { dg-final { scan-assembler-not \"alignment for hotpatch\" } } */"}, {"sha": "a990c4cad6e3421b17dbf04dc9db66ea3ded61bf", "filename": "gcc/testsuite/gcc.target/s390/hotpatch-10.c", "status": "modified", "additions": 3, "deletions": 0, "changes": 3, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/2d38d80934cd2e8a60b212ed34ffc7b062d7960a/gcc%2Ftestsuite%2Fgcc.target%2Fs390%2Fhotpatch-10.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/2d38d80934cd2e8a60b212ed34ffc7b062d7960a/gcc%2Ftestsuite%2Fgcc.target%2Fs390%2Fhotpatch-10.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgcc.target%2Fs390%2Fhotpatch-10.c?ref=2d38d80934cd2e8a60b212ed34ffc7b062d7960a", "patch": "@@ -11,6 +11,9 @@ void hp1(void)\n }\n \n /* Check number of occurences of certain instructions.  */\n+/* { dg-final { scan-assembler-not \"pre-label NOPs\" } } */\n+/* { dg-final { scan-assembler-not \"post-label NOPs\" } } */\n /* { dg-final { scan-assembler-not \"nopr\\t%r7\" } } */\n /* { dg-final { scan-assembler-not \"nop\\t0\" } } */\n /* { dg-final { scan-assembler-not \"brcl\\t0, 0\" } } */\n+/* { dg-final { scan-assembler-not \"alignment for hotpatch\" } } */"}, {"sha": "6f8a52b26d341b1d817f4d8cb95ec7f0d5a24350", "filename": "gcc/testsuite/gcc.target/s390/hotpatch-11.c", "status": "modified", "additions": 2, "deletions": 0, "changes": 2, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/2d38d80934cd2e8a60b212ed34ffc7b062d7960a/gcc%2Ftestsuite%2Fgcc.target%2Fs390%2Fhotpatch-11.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/2d38d80934cd2e8a60b212ed34ffc7b062d7960a/gcc%2Ftestsuite%2Fgcc.target%2Fs390%2Fhotpatch-11.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgcc.target%2Fs390%2Fhotpatch-11.c?ref=2d38d80934cd2e8a60b212ed34ffc7b062d7960a", "patch": "@@ -11,6 +11,8 @@ void hp1(void)\n }\n \n /* Check number of occurences of certain instructions.  */\n+/* { dg-final { scan-assembler \"pre-label.*(1 halfwords)\" } } */\n+/* { dg-final { scan-assembler-not \"post-label NOPs\" } } */\n /* { dg-final { scan-assembler-times \"nopr\\t%r7\" 1 } } */\n /* { dg-final { scan-assembler-not \"nop\\t0\" } } */\n /* { dg-final { scan-assembler-not \"brcl\\t0, 0\" } } */"}, {"sha": "b73ca90fd3dd20de9e4d699eed7f0571a542820c", "filename": "gcc/testsuite/gcc.target/s390/hotpatch-12.c", "status": "modified", "additions": 2, "deletions": 0, "changes": 2, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/2d38d80934cd2e8a60b212ed34ffc7b062d7960a/gcc%2Ftestsuite%2Fgcc.target%2Fs390%2Fhotpatch-12.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/2d38d80934cd2e8a60b212ed34ffc7b062d7960a/gcc%2Ftestsuite%2Fgcc.target%2Fs390%2Fhotpatch-12.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgcc.target%2Fs390%2Fhotpatch-12.c?ref=2d38d80934cd2e8a60b212ed34ffc7b062d7960a", "patch": "@@ -11,6 +11,8 @@ void hp1(void)\n }\n \n /* Check number of occurences of certain instructions.  */\n+/* { dg-final { scan-assembler \"pre-label.*(999 halfwords)\" } } */\n+/* { dg-final { scan-assembler-not \"post-label NOPs\" } } */\n /* { dg-final { scan-assembler-times \"nopr\\t%r7\" 999 } } */\n /* { dg-final { scan-assembler-not \"nop\\t0\" } } */\n /* { dg-final { scan-assembler-not \"brcl\\t0, 0\" } } */"}, {"sha": "150667a1c66bf79a702dc70c57b56f80614116a0", "filename": "gcc/testsuite/gcc.target/s390/hotpatch-13.c", "status": "modified", "additions": 4, "deletions": 0, "changes": 4, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/2d38d80934cd2e8a60b212ed34ffc7b062d7960a/gcc%2Ftestsuite%2Fgcc.target%2Fs390%2Fhotpatch-13.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/2d38d80934cd2e8a60b212ed34ffc7b062d7960a/gcc%2Ftestsuite%2Fgcc.target%2Fs390%2Fhotpatch-13.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgcc.target%2Fs390%2Fhotpatch-13.c?ref=2d38d80934cd2e8a60b212ed34ffc7b062d7960a", "patch": "@@ -12,6 +12,10 @@ void hp1(void)\n }\n \n /* Check number of occurences of certain instructions.  */\n+/* { dg-final { scan-assembler \"pre-label.*(1 halfwords)\" } } */\n+/* { dg-final { scan-assembler-not \"post-label NOPs\" } } */\n /* { dg-final { scan-assembler-times \"nopr\\t%r7\" 1 } } */\n /* { dg-final { scan-assembler-not \"nop\\t0\" } } */\n /* { dg-final { scan-assembler-not \"brcl\\t0, 0\" } } */\n+/* { dg-final { scan-assembler \"alignment for hotpatch\" } } */\n+/* { dg-final { scan-assembler-times \"\\.align\\t8\" 2 } } */"}, {"sha": "c5f118c1cc6d79b1e8a457dbe2cb9d491519034f", "filename": "gcc/testsuite/gcc.target/s390/hotpatch-14.c", "status": "modified", "additions": 3, "deletions": 0, "changes": 3, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/2d38d80934cd2e8a60b212ed34ffc7b062d7960a/gcc%2Ftestsuite%2Fgcc.target%2Fs390%2Fhotpatch-14.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/2d38d80934cd2e8a60b212ed34ffc7b062d7960a/gcc%2Ftestsuite%2Fgcc.target%2Fs390%2Fhotpatch-14.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgcc.target%2Fs390%2Fhotpatch-14.c?ref=2d38d80934cd2e8a60b212ed34ffc7b062d7960a", "patch": "@@ -12,6 +12,9 @@ void hp1(void)\n }\n \n /* Check number of occurences of certain instructions.  */\n+/* { dg-final { scan-assembler-not \"pre-label NOPs\" } } */\n+/* { dg-final { scan-assembler \"post-label.*(2 halfwords)\" } } */\n /* { dg-final { scan-assembler-not \"nopr\\t%r7\" } } */\n /* { dg-final { scan-assembler-times \"nop\\t0\" 1 } } */\n /* { dg-final { scan-assembler-not \"brcl\\t0, 0\" } } */\n+/* { dg-final { scan-assembler-not \"alignment for hotpatch\" } } */"}, {"sha": "ef0fb746227e6ed4d684942815c80a925197f22b", "filename": "gcc/testsuite/gcc.target/s390/hotpatch-15.c", "status": "modified", "additions": 2, "deletions": 0, "changes": 2, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/2d38d80934cd2e8a60b212ed34ffc7b062d7960a/gcc%2Ftestsuite%2Fgcc.target%2Fs390%2Fhotpatch-15.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/2d38d80934cd2e8a60b212ed34ffc7b062d7960a/gcc%2Ftestsuite%2Fgcc.target%2Fs390%2Fhotpatch-15.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgcc.target%2Fs390%2Fhotpatch-15.c?ref=2d38d80934cd2e8a60b212ed34ffc7b062d7960a", "patch": "@@ -12,6 +12,8 @@ void hp1(void)\n }\n \n /* Check number of occurences of certain instructions.  */\n+/* { dg-final { scan-assembler \"pre-label.*(1 halfwords)\" } } */\n+/* { dg-final { scan-assembler \"post-label.*(2 halfwords)\" } } */\n /* { dg-final { scan-assembler-times \"nopr\\t%r7\" 1 } } */\n /* { dg-final { scan-assembler-times \"nop\\t0\" 1 } } */\n /* { dg-final { scan-assembler-not \"brcl\\t0, 0\" } } */"}, {"sha": "a34bf95c3cb539558e28d191c8c6c4daff388306", "filename": "gcc/testsuite/gcc.target/s390/hotpatch-16.c", "status": "modified", "additions": 2, "deletions": 0, "changes": 2, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/2d38d80934cd2e8a60b212ed34ffc7b062d7960a/gcc%2Ftestsuite%2Fgcc.target%2Fs390%2Fhotpatch-16.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/2d38d80934cd2e8a60b212ed34ffc7b062d7960a/gcc%2Ftestsuite%2Fgcc.target%2Fs390%2Fhotpatch-16.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgcc.target%2Fs390%2Fhotpatch-16.c?ref=2d38d80934cd2e8a60b212ed34ffc7b062d7960a", "patch": "@@ -12,6 +12,8 @@ void hp1(void)\n }\n \n /* Check number of occurences of certain instructions.  */\n+/* { dg-final { scan-assembler \"pre-label.*(1 halfwords)\" } } */\n+/* { dg-final { scan-assembler \"post-label.*(2 halfwords)\" } } */\n /* { dg-final { scan-assembler-times \"nopr\\t%r7\" 1 } } */\n /* { dg-final { scan-assembler-times \"nop\\t0\" 1 } } */\n /* { dg-final { scan-assembler-not \"brcl\\t0, 0\" } } */"}, {"sha": "66ac725d16a042f423a1fa3dac840455ba97542b", "filename": "gcc/testsuite/gcc.target/s390/hotpatch-17.c", "status": "modified", "additions": 3, "deletions": 0, "changes": 3, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/2d38d80934cd2e8a60b212ed34ffc7b062d7960a/gcc%2Ftestsuite%2Fgcc.target%2Fs390%2Fhotpatch-17.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/2d38d80934cd2e8a60b212ed34ffc7b062d7960a/gcc%2Ftestsuite%2Fgcc.target%2Fs390%2Fhotpatch-17.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgcc.target%2Fs390%2Fhotpatch-17.c?ref=2d38d80934cd2e8a60b212ed34ffc7b062d7960a", "patch": "@@ -12,6 +12,9 @@ void hp1(void)\n }\n \n /* Check number of occurences of certain instructions.  */\n+/* { dg-final { scan-assembler-not \"pre-label NOPs\" } } */\n+/* { dg-final { scan-assembler-not \"post-label NOPs\" } } */\n /* { dg-final { scan-assembler-not \"nopr\\t%r7\" } } */\n /* { dg-final { scan-assembler-not \"nop\\t0\" } } */\n /* { dg-final { scan-assembler-not \"brcl\\t0, 0\" } } */\n+/* { dg-final { scan-assembler-not \"alignment for hotpatch\" } } */"}, {"sha": "8b076a4e175fadc33876320aa29028d87a976750", "filename": "gcc/testsuite/gcc.target/s390/hotpatch-18.c", "status": "modified", "additions": 3, "deletions": 0, "changes": 3, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/2d38d80934cd2e8a60b212ed34ffc7b062d7960a/gcc%2Ftestsuite%2Fgcc.target%2Fs390%2Fhotpatch-18.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/2d38d80934cd2e8a60b212ed34ffc7b062d7960a/gcc%2Ftestsuite%2Fgcc.target%2Fs390%2Fhotpatch-18.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgcc.target%2Fs390%2Fhotpatch-18.c?ref=2d38d80934cd2e8a60b212ed34ffc7b062d7960a", "patch": "@@ -11,6 +11,9 @@ void hp1(void)\n }\n \n /* Check number of occurences of certain instructions.  */\n+/* { dg-final { scan-assembler-not \"pre-label NOPs\" } } */\n+/* { dg-final { scan-assembler-not \"post-label NOPs\" } } */\n /* { dg-final { scan-assembler-not \"nopr\\t%r7\" } } */\n /* { dg-final { scan-assembler-not \"nop\\t0\" } } */\n /* { dg-final { scan-assembler-not \"brcl\\t0, 0\" } } */\n+/* { dg-final { scan-assembler-not \"alignment for hotpatch\" } } */"}, {"sha": "6993c7e855ced3d0b9a1b7fd247db0bf85692950", "filename": "gcc/testsuite/gcc.target/s390/hotpatch-19.c", "status": "modified", "additions": 2, "deletions": 0, "changes": 2, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/2d38d80934cd2e8a60b212ed34ffc7b062d7960a/gcc%2Ftestsuite%2Fgcc.target%2Fs390%2Fhotpatch-19.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/2d38d80934cd2e8a60b212ed34ffc7b062d7960a/gcc%2Ftestsuite%2Fgcc.target%2Fs390%2Fhotpatch-19.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgcc.target%2Fs390%2Fhotpatch-19.c?ref=2d38d80934cd2e8a60b212ed34ffc7b062d7960a", "patch": "@@ -18,6 +18,8 @@ void hp1(void)\n }\n \n /* Check number of occurences of certain instructions.  */\n+/* { dg-final { scan-assembler \"pre-label.*(1 halfwords)\" } } */\n+/* { dg-final { scan-assembler \"post-label.*(2 halfwords)\" } } */\n /* { dg-final { scan-assembler-times \"nopr\\t%r7\" 1 } } */\n /* { dg-final { scan-assembler-times \"nop\\t0\" 1 } } */\n /* { dg-final { scan-assembler-not \"brcl\\t0, 0\" } } */"}, {"sha": "67189f8a28b1123f1c10fc5ac168721ea701759d", "filename": "gcc/testsuite/gcc.target/s390/hotpatch-2.c", "status": "modified", "additions": 3, "deletions": 1, "changes": 4, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/2d38d80934cd2e8a60b212ed34ffc7b062d7960a/gcc%2Ftestsuite%2Fgcc.target%2Fs390%2Fhotpatch-2.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/2d38d80934cd2e8a60b212ed34ffc7b062d7960a/gcc%2Ftestsuite%2Fgcc.target%2Fs390%2Fhotpatch-2.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgcc.target%2Fs390%2Fhotpatch-2.c?ref=2d38d80934cd2e8a60b212ed34ffc7b062d7960a", "patch": "@@ -11,7 +11,9 @@ void hp1(void)\n }\n \n /* Check number of occurences of certain instructions.  */\n+/* { dg-final { scan-assembler-not \"pre-label NOPs\" } } */\n+/* { dg-final { scan-assembler \"post-label.*(1 halfwords)\" } } */\n /* { dg-final { scan-assembler-times \"nopr\\t%r7\" 1 } } */\n /* { dg-final { scan-assembler-not \"nop\\t0\" } } */\n /* { dg-final { scan-assembler-not \"brcl\\t0, 0\" } } */\n-/* { dg-final { scan-assembler-times \"\\.align\\t8\" 2 } } */\n+/* { dg-final { scan-assembler-not \"alignment for hotpatch\" } } */"}, {"sha": "e90999008550ff2020be68580b0204e5802b6ba3", "filename": "gcc/testsuite/gcc.target/s390/hotpatch-21.c", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/2d38d80934cd2e8a60b212ed34ffc7b062d7960a/gcc%2Ftestsuite%2Fgcc.target%2Fs390%2Fhotpatch-21.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/2d38d80934cd2e8a60b212ed34ffc7b062d7960a/gcc%2Ftestsuite%2Fgcc.target%2Fs390%2Fhotpatch-21.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgcc.target%2Fs390%2Fhotpatch-21.c?ref=2d38d80934cd2e8a60b212ed34ffc7b062d7960a", "patch": "@@ -11,4 +11,4 @@ void __attribute__ ((aligned(512))) hp1(void)\n }\n \n /* Check number of occurences of certain instructions.  */\n-/* { dg-final { scan-assembler-times \"\\.align\\t512\" 2 } } */\n+/* { dg-final { scan-assembler-not \"alignment for hotpatch\" } } */"}, {"sha": "d89d7790426f680061a6955103790beeca7c9e84", "filename": "gcc/testsuite/gcc.target/s390/hotpatch-22.c", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/2d38d80934cd2e8a60b212ed34ffc7b062d7960a/gcc%2Ftestsuite%2Fgcc.target%2Fs390%2Fhotpatch-22.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/2d38d80934cd2e8a60b212ed34ffc7b062d7960a/gcc%2Ftestsuite%2Fgcc.target%2Fs390%2Fhotpatch-22.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgcc.target%2Fs390%2Fhotpatch-22.c?ref=2d38d80934cd2e8a60b212ed34ffc7b062d7960a", "patch": "@@ -11,4 +11,4 @@ void hp1(void)\n }\n \n /* Check number of occurences of certain instructions.  */\n-/* { dg-final { scan-assembler-times \"\\.align\\t1024\" 2 } } */\n+/* { dg-final { scan-assembler-not \"alignment for hotpatch\" } } */"}, {"sha": "1e05d123c22a64770099f6d295338cfbf8c9e16d", "filename": "gcc/testsuite/gcc.target/s390/hotpatch-23.c", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/2d38d80934cd2e8a60b212ed34ffc7b062d7960a/gcc%2Ftestsuite%2Fgcc.target%2Fs390%2Fhotpatch-23.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/2d38d80934cd2e8a60b212ed34ffc7b062d7960a/gcc%2Ftestsuite%2Fgcc.target%2Fs390%2Fhotpatch-23.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgcc.target%2Fs390%2Fhotpatch-23.c?ref=2d38d80934cd2e8a60b212ed34ffc7b062d7960a", "patch": "@@ -11,4 +11,4 @@ void __attribute__ ((aligned(2048))) hp1(void)\n }\n \n /* Check number of occurences of certain instructions.  */\n-/* { dg-final { scan-assembler-times \"\\.align\\t2048\" 2 } } */\n+/* { dg-final { scan-assembler-not \"alignment for hotpatch\" } } */"}, {"sha": "fc6427479d8edbcb6177156f42a337115a42f8a0", "filename": "gcc/testsuite/gcc.target/s390/hotpatch-24.c", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/2d38d80934cd2e8a60b212ed34ffc7b062d7960a/gcc%2Ftestsuite%2Fgcc.target%2Fs390%2Fhotpatch-24.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/2d38d80934cd2e8a60b212ed34ffc7b062d7960a/gcc%2Ftestsuite%2Fgcc.target%2Fs390%2Fhotpatch-24.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgcc.target%2Fs390%2Fhotpatch-24.c?ref=2d38d80934cd2e8a60b212ed34ffc7b062d7960a", "patch": "@@ -11,4 +11,4 @@ void __attribute__ ((aligned(4096))) hp1(void)\n }\n \n /* Check number of occurences of certain instructions.  */\n-/* { dg-final { scan-assembler-times \"\\.align\\t4096\" 2 } } */\n+/* { dg-final { scan-assembler-not \"alignment for hotpatch\" } } */"}, {"sha": "e9257e3744ee981fd51e23a902005b8e15c81263", "filename": "gcc/testsuite/gcc.target/s390/hotpatch-25.c", "status": "added", "additions": 33, "deletions": 0, "changes": 33, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/2d38d80934cd2e8a60b212ed34ffc7b062d7960a/gcc%2Ftestsuite%2Fgcc.target%2Fs390%2Fhotpatch-25.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/2d38d80934cd2e8a60b212ed34ffc7b062d7960a/gcc%2Ftestsuite%2Fgcc.target%2Fs390%2Fhotpatch-25.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgcc.target%2Fs390%2Fhotpatch-25.c?ref=2d38d80934cd2e8a60b212ed34ffc7b062d7960a", "patch": "@@ -0,0 +1,33 @@\n+/* Functional tests for the function hotpatching feature.  */\n+\n+/* { dg-do compile } */\n+/* { dg-options \"-O3 -mzarch\" } */\n+\n+typedef long (*fn_t)(void);\n+\n+__attribute__ ((hotpatch(1,2)))\n+fn_t outer(void)\n+{\n+  __attribute__ ((hotpatch(4,8)))\n+  long nested1(void)\n+  {\n+    __attribute__ ((hotpatch(16,32)))\n+    long nested2(void)\n+    {\n+      return 2;\n+    }\n+    return (long)(void *)nested2;\n+  }\n+\n+  return nested1;\n+}\n+\n+/* { dg-final { scan-assembler \"pre-label.*(1 halfwords)\" } } */\n+/* { dg-final { scan-assembler \"pre-label.*(4 halfwords)\" } } */\n+/* { dg-final { scan-assembler \"pre-label.*(16 halfwords)\" } } */\n+/* { dg-final { scan-assembler \"post-label.*(2 halfwords)\" } } */\n+/* { dg-final { scan-assembler \"post-label.*(8 halfwords)\" } } */\n+/* { dg-final { scan-assembler \"post-label.*(32 halfwords)\" } } */\n+/* { dg-final { scan-assembler-times \"alignment for hotpatch\" 3 } } */\n+/* { dg-final { scan-assembler-times \"\\.align\\t8\" 6 } } */\n+/* { dg-final { scan-assembler \"nopr.*\\n.*nopr.*\\n.*nopr.*\\n.*nopr.*\\n.*nopr.*\\n.*nopr.*\\n.*nopr.*\\n.*nopr.*\\n.*nopr.*\\n.*nopr.*\\n.*nopr.*\\n.*nopr.*\\n.*nopr.*\\n.*nopr.*\\n.*nopr.*\\n.*nopr\" } } */"}, {"sha": "ec4a978f72eaffe285eb2af2a1178cc69dad0d9c", "filename": "gcc/testsuite/gcc.target/s390/hotpatch-3.c", "status": "modified", "additions": 2, "deletions": 0, "changes": 2, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/2d38d80934cd2e8a60b212ed34ffc7b062d7960a/gcc%2Ftestsuite%2Fgcc.target%2Fs390%2Fhotpatch-3.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/2d38d80934cd2e8a60b212ed34ffc7b062d7960a/gcc%2Ftestsuite%2Fgcc.target%2Fs390%2Fhotpatch-3.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgcc.target%2Fs390%2Fhotpatch-3.c?ref=2d38d80934cd2e8a60b212ed34ffc7b062d7960a", "patch": "@@ -11,6 +11,8 @@ void hp1(void)\n }\n \n /* Check number of occurences of certain instructions.  */\n+/* { dg-final { scan-assembler-not \"pre-label NOPs\" } } */\n+/* { dg-final { scan-assembler \"post-label.*(2 halfwords)\" } } */\n /* { dg-final { scan-assembler-not \"nopr\\t%r7\" } } */\n /* { dg-final { scan-assembler-times \"nop\\t0\" 1 } } */\n /* { dg-final { scan-assembler-not \"brcl\\t0, 0\" } } */"}, {"sha": "d55e71d3d69c53faf7a6f872fd3dea01baf1dcc4", "filename": "gcc/testsuite/gcc.target/s390/hotpatch-4.c", "status": "modified", "additions": 2, "deletions": 0, "changes": 2, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/2d38d80934cd2e8a60b212ed34ffc7b062d7960a/gcc%2Ftestsuite%2Fgcc.target%2Fs390%2Fhotpatch-4.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/2d38d80934cd2e8a60b212ed34ffc7b062d7960a/gcc%2Ftestsuite%2Fgcc.target%2Fs390%2Fhotpatch-4.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgcc.target%2Fs390%2Fhotpatch-4.c?ref=2d38d80934cd2e8a60b212ed34ffc7b062d7960a", "patch": "@@ -11,6 +11,8 @@ void hp1(void)\n }\n \n /* Check number of occurences of certain instructions.  */\n+/* { dg-final { scan-assembler-not \"pre-label NOPs\" } } */\n+/* { dg-final { scan-assembler \"post-label.*(3 halfwords)\" } } */\n /* { dg-final { scan-assembler-not \"nopr\\t%r7\" } } */\n /* { dg-final { scan-assembler-not \"nop\\t0\" } } */\n /* { dg-final { scan-assembler-times \"brcl\\t0, 0\" 1 } } */"}, {"sha": "f77d83aea07132c3b0710dd504f37d417669ed10", "filename": "gcc/testsuite/gcc.target/s390/hotpatch-5.c", "status": "modified", "additions": 2, "deletions": 0, "changes": 2, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/2d38d80934cd2e8a60b212ed34ffc7b062d7960a/gcc%2Ftestsuite%2Fgcc.target%2Fs390%2Fhotpatch-5.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/2d38d80934cd2e8a60b212ed34ffc7b062d7960a/gcc%2Ftestsuite%2Fgcc.target%2Fs390%2Fhotpatch-5.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgcc.target%2Fs390%2Fhotpatch-5.c?ref=2d38d80934cd2e8a60b212ed34ffc7b062d7960a", "patch": "@@ -11,6 +11,8 @@ void hp1(void)\n }\n \n /* Check number of occurences of certain instructions.  */\n+/* { dg-final { scan-assembler-not \"pre-label NOPs\" } } */\n+/* { dg-final { scan-assembler \"post-label.*(4 halfwords)\" } } */\n /* { dg-final { scan-assembler-times \"nopr\\t%r7\" 1 } } */\n /* { dg-final { scan-assembler-not \"nop\\t0\" } } */\n /* { dg-final { scan-assembler-times \"brcl\\t0, 0\" 1 } } */"}, {"sha": "330cf5d011ff129661ddd0798aa927bebebb6bbf", "filename": "gcc/testsuite/gcc.target/s390/hotpatch-6.c", "status": "modified", "additions": 2, "deletions": 0, "changes": 2, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/2d38d80934cd2e8a60b212ed34ffc7b062d7960a/gcc%2Ftestsuite%2Fgcc.target%2Fs390%2Fhotpatch-6.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/2d38d80934cd2e8a60b212ed34ffc7b062d7960a/gcc%2Ftestsuite%2Fgcc.target%2Fs390%2Fhotpatch-6.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgcc.target%2Fs390%2Fhotpatch-6.c?ref=2d38d80934cd2e8a60b212ed34ffc7b062d7960a", "patch": "@@ -11,6 +11,8 @@ void hp1(void)\n }\n \n /* Check number of occurences of certain instructions.  */\n+/* { dg-final { scan-assembler-not \"pre-label NOPs\" } } */\n+/* { dg-final { scan-assembler \"post-label.*(5 halfwords)\" } } */\n /* { dg-final { scan-assembler-not \"nopr\\t%r7\" } } */\n /* { dg-final { scan-assembler-times \"nop\\t0\" 1 } } */\n /* { dg-final { scan-assembler-times \"brcl\\t0, 0\" 1 } } */"}, {"sha": "2f24e3cc15228b826f29044dd2ab0e68fff448b9", "filename": "gcc/testsuite/gcc.target/s390/hotpatch-7.c", "status": "modified", "additions": 2, "deletions": 0, "changes": 2, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/2d38d80934cd2e8a60b212ed34ffc7b062d7960a/gcc%2Ftestsuite%2Fgcc.target%2Fs390%2Fhotpatch-7.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/2d38d80934cd2e8a60b212ed34ffc7b062d7960a/gcc%2Ftestsuite%2Fgcc.target%2Fs390%2Fhotpatch-7.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgcc.target%2Fs390%2Fhotpatch-7.c?ref=2d38d80934cd2e8a60b212ed34ffc7b062d7960a", "patch": "@@ -11,6 +11,8 @@ void hp1(void)\n }\n \n /* Check number of occurences of certain instructions.  */\n+/* { dg-final { scan-assembler-not \"pre-label NOPs\" } } */\n+/* { dg-final { scan-assembler \"post-label.*(6 halfwords)\" } } */\n /* { dg-final { scan-assembler-not \"nopr\\t%r7\" } } */\n /* { dg-final { scan-assembler-not \"nop\\t0\" } } */\n /* { dg-final { scan-assembler-times \"brcl\\t0, 0\" 2 } } */"}, {"sha": "7b266bd463e18cac1bfc39014d9be8fa86e189d2", "filename": "gcc/testsuite/gcc.target/s390/hotpatch-8.c", "status": "modified", "additions": 3, "deletions": 0, "changes": 3, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/2d38d80934cd2e8a60b212ed34ffc7b062d7960a/gcc%2Ftestsuite%2Fgcc.target%2Fs390%2Fhotpatch-8.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/2d38d80934cd2e8a60b212ed34ffc7b062d7960a/gcc%2Ftestsuite%2Fgcc.target%2Fs390%2Fhotpatch-8.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgcc.target%2Fs390%2Fhotpatch-8.c?ref=2d38d80934cd2e8a60b212ed34ffc7b062d7960a", "patch": "@@ -11,6 +11,9 @@ void hp1(void)\n }\n \n /* Check number of occurences of certain instructions.  */\n+/* { dg-final { scan-assembler-not \"pre-label NOPs\" } } */\n+/* { dg-final { scan-assembler \"post-label.*(3 halfwords)\" } } */\n /* { dg-final { scan-assembler-times \"nopr\\t%r7\" 1 } } */\n /* { dg-final { scan-assembler-times \"nop\\t0\" 1 } } */\n /* { dg-final { scan-assembler-not \"brcl\\t0, 0\" } } */\n+/* { dg-final { scan-assembler-not \"alignment for hotpatch\" } } */"}, {"sha": "c0ad319c0bb758210c4d78d14826872f68247bf9", "filename": "gcc/testsuite/gcc.target/s390/hotpatch-9.c", "status": "modified", "additions": 2, "deletions": 0, "changes": 2, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/2d38d80934cd2e8a60b212ed34ffc7b062d7960a/gcc%2Ftestsuite%2Fgcc.target%2Fs390%2Fhotpatch-9.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/2d38d80934cd2e8a60b212ed34ffc7b062d7960a/gcc%2Ftestsuite%2Fgcc.target%2Fs390%2Fhotpatch-9.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgcc.target%2Fs390%2Fhotpatch-9.c?ref=2d38d80934cd2e8a60b212ed34ffc7b062d7960a", "patch": "@@ -11,6 +11,8 @@ void hp1(void)\n }\n \n /* Check number of occurences of certain instructions.  */\n+/* { dg-final { scan-assembler-not \"pre-label NOPs\" } } */\n+/* { dg-final { scan-assembler \"post-label.*(4 halfwords)\" } } */\n /* { dg-final { scan-assembler-not \"nopr\\t%r7\" } } */\n /* { dg-final { scan-assembler-times \"nop\\t0\" 2 } } */\n /* { dg-final { scan-assembler-not \"brcl\\t0, 0\" } } */"}, {"sha": "2e8291ede34540b59ef619141ec7245e3808ca11", "filename": "gcc/testsuite/gcc.target/s390/hotpatch-compile-16.c", "status": "modified", "additions": 2, "deletions": 2, "changes": 4, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/2d38d80934cd2e8a60b212ed34ffc7b062d7960a/gcc%2Ftestsuite%2Fgcc.target%2Fs390%2Fhotpatch-compile-16.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/2d38d80934cd2e8a60b212ed34ffc7b062d7960a/gcc%2Ftestsuite%2Fgcc.target%2Fs390%2Fhotpatch-compile-16.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgcc.target%2Fs390%2Fhotpatch-compile-16.c?ref=2d38d80934cd2e8a60b212ed34ffc7b062d7960a", "patch": "@@ -1,4 +1,4 @@\n-/* A warning will be issued when requesting hotpatching on a nested function.  */\n+/* Functional tests for the function hotpatching feature.  */\n \n /* { dg-do compile } */\n /* { dg-options \"-O3 -mzarch\" } */\n@@ -17,7 +17,7 @@ fn_t hp1(void)\n fn_t hp2(void)\n {\n   __attribute__ ((hotpatch(1,2)))\n-  int nested2(void) /* { dg-warning \"hotpatching is not compatible with nested functions\" } */\n+  int nested2(void)\n   { return 2; }\n \n   return nested2;"}]}