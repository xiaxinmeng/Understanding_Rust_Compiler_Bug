{"sha": "3b80566699a6474e82a630652bf85cf872128b6d", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6M2I4MDU2NjY5OWE2NDc0ZTgyYTYzMDY1MmJmODVjZjg3MjEyOGI2ZA==", "commit": {"author": {"name": "Bill Schmidt", "email": "wschmidt@linux.vnet.ibm.com", "date": "2017-07-14T18:06:45Z"}, "committer": {"name": "William Schmidt", "email": "wschmidt@gcc.gnu.org", "date": "2017-07-14T18:06:45Z"}, "message": "re PR tree-optimization/81162 (UBSAN switch triggers incorrect optimization in SLSR)\n\n[gcc]\n\n2016-07-14  Bill Schmidt  <wschmidt@linux.vnet.ibm.com>\n\n\tPR tree-optimization/81162\n\t* gimple-ssa-strength-reduction.c (replace_mult_candidate): Don't\n\treplace a negate with an add.\n\n[gcc/testsuite]\n\n2016-07-14  Bill Schmidt  <wschmidt@linux.vnet.ibm.com>\n\n\tPR tree-optimization/81162\n\t* gcc.dg/pr81162.c: New file.\n\nFrom-SVN: r250212", "tree": {"sha": "523e661ed49cf186942567f2ad03c150f63bea06", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/523e661ed49cf186942567f2ad03c150f63bea06"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/3b80566699a6474e82a630652bf85cf872128b6d", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/3b80566699a6474e82a630652bf85cf872128b6d", "html_url": "https://github.com/Rust-GCC/gccrs/commit/3b80566699a6474e82a630652bf85cf872128b6d", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/3b80566699a6474e82a630652bf85cf872128b6d/comments", "author": {"login": "wschmidt-ibm", "id": 5520937, "node_id": "MDQ6VXNlcjU1MjA5Mzc=", "avatar_url": "https://avatars.githubusercontent.com/u/5520937?v=4", "gravatar_id": "", "url": "https://api.github.com/users/wschmidt-ibm", "html_url": "https://github.com/wschmidt-ibm", "followers_url": "https://api.github.com/users/wschmidt-ibm/followers", "following_url": "https://api.github.com/users/wschmidt-ibm/following{/other_user}", "gists_url": "https://api.github.com/users/wschmidt-ibm/gists{/gist_id}", "starred_url": "https://api.github.com/users/wschmidt-ibm/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/wschmidt-ibm/subscriptions", "organizations_url": "https://api.github.com/users/wschmidt-ibm/orgs", "repos_url": "https://api.github.com/users/wschmidt-ibm/repos", "events_url": "https://api.github.com/users/wschmidt-ibm/events{/privacy}", "received_events_url": "https://api.github.com/users/wschmidt-ibm/received_events", "type": "User", "site_admin": false}, "committer": null, "parents": [{"sha": "bece580c0ce225b1adeca3afea8d834f7fd83277", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/bece580c0ce225b1adeca3afea8d834f7fd83277", "html_url": "https://github.com/Rust-GCC/gccrs/commit/bece580c0ce225b1adeca3afea8d834f7fd83277"}], "stats": {"total": 33, "additions": 31, "deletions": 2}, "files": [{"sha": "fe1d9e937550c120cd21df23b3dd92b4bf3bd152", "filename": "gcc/ChangeLog", "status": "modified", "additions": 6, "deletions": 0, "changes": 6, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/3b80566699a6474e82a630652bf85cf872128b6d/gcc%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/3b80566699a6474e82a630652bf85cf872128b6d/gcc%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2FChangeLog?ref=3b80566699a6474e82a630652bf85cf872128b6d", "patch": "@@ -1,3 +1,9 @@\n+2016-07-14  Bill Schmidt  <wschmidt@linux.vnet.ibm.com>\n+\n+\tPR tree-optimization/81162\n+\t* gimple-ssa-strength-reduction.c (replace_mult_candidate): Don't\n+\treplace a negate with an add.\n+\n 2017-07-14  James Greenhalgh  <james.greenhalgh@arm.com>\n \n \t* doc/invoke.texi (arm/-mcpu): Document +crypto."}, {"sha": "00c304447002321e6d399003a933f2a953e80ba1", "filename": "gcc/gimple-ssa-strength-reduction.c", "status": "modified", "additions": 3, "deletions": 2, "changes": 5, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/3b80566699a6474e82a630652bf85cf872128b6d/gcc%2Fgimple-ssa-strength-reduction.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/3b80566699a6474e82a630652bf85cf872128b6d/gcc%2Fgimple-ssa-strength-reduction.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fgimple-ssa-strength-reduction.c?ref=3b80566699a6474e82a630652bf85cf872128b6d", "patch": "@@ -2082,13 +2082,14 @@ replace_mult_candidate (slsr_cand_t c, tree basis_name, widest_int bump)\n      types but allows for safe negation without twisted logic.  */\n   if (wi::fits_shwi_p (bump)\n       && bump.to_shwi () != HOST_WIDE_INT_MIN\n-      /* It is not useful to replace casts, copies, or adds of\n+      /* It is not useful to replace casts, copies, negates, or adds of\n \t an SSA name and a constant.  */\n       && cand_code != SSA_NAME\n       && !CONVERT_EXPR_CODE_P (cand_code)\n       && cand_code != PLUS_EXPR\n       && cand_code != POINTER_PLUS_EXPR\n-      && cand_code != MINUS_EXPR)\n+      && cand_code != MINUS_EXPR\n+      && cand_code != NEGATE_EXPR)\n     {\n       enum tree_code code = PLUS_EXPR;\n       tree bump_tree;"}, {"sha": "073a8e5d62f06bb221eebfc3ca50b872073dc08d", "filename": "gcc/testsuite/ChangeLog", "status": "modified", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/3b80566699a6474e82a630652bf85cf872128b6d/gcc%2Ftestsuite%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/3b80566699a6474e82a630652bf85cf872128b6d/gcc%2Ftestsuite%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2FChangeLog?ref=3b80566699a6474e82a630652bf85cf872128b6d", "patch": "@@ -1,3 +1,8 @@\n+2016-07-14  Bill Schmidt  <wschmidt@linux.vnet.ibm.com>\n+\n+\tPR tree-optimization/81162\n+\t* gcc.dg/pr81162.c: New file.\n+\n 2017-07-14  Martin Sebor  <msebor@redhat.com>\n \n \t* gcc.dg/tree-ssa/ssa-dse-30.c: Correct test to look for memmove"}, {"sha": "9ce98afa367d84e96c7b9e941e0a5b0c13184458", "filename": "gcc/testsuite/gcc.dg/pr81162.c", "status": "added", "additions": 17, "deletions": 0, "changes": 17, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/3b80566699a6474e82a630652bf85cf872128b6d/gcc%2Ftestsuite%2Fgcc.dg%2Fpr81162.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/3b80566699a6474e82a630652bf85cf872128b6d/gcc%2Ftestsuite%2Fgcc.dg%2Fpr81162.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgcc.dg%2Fpr81162.c?ref=3b80566699a6474e82a630652bf85cf872128b6d", "patch": "@@ -0,0 +1,17 @@\n+/* PR tree-optimization/81162 */\n+/* { dg-do run } */\n+/* { dg-options \"-fsanitize=undefined -O2\" } */\n+\n+short s;\n+int i1 = 1;\n+int i2 = 1;\n+unsigned char uc = 147;\n+\n+int main() {\n+  s = (-uc + 2147483647) << 0;\n+  if (9031239389974324562ULL >= (-((i1 && i2) + uc) ^ -21096) ) {\n+    return 0;\n+  } else {\n+    return -1;\n+  }\n+}"}]}