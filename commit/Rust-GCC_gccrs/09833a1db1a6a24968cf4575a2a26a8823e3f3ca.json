{"sha": "09833a1db1a6a24968cf4575a2a26a8823e3f3ca", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6MDk4MzNhMWRiMWE2YTI0OTY4Y2Y0NTc1YTJhMjZhODgyM2UzZjNjYQ==", "commit": {"author": {"name": "Jason Merrill", "email": "jason@redhat.com", "date": "2015-10-31T16:19:50Z"}, "committer": {"name": "Jason Merrill", "email": "jason@gcc.gnu.org", "date": "2015-10-31T16:19:50Z"}, "message": "Improve deduction failure diagnostics.\n\n\t* pt.c (unify): Don't diagnose no common base if we already have\n\tthe same template.\n\t(do_auto_deduction): Explain deduction failure.\n\nFrom-SVN: r229627", "tree": {"sha": "7f600eb0fd5a0762ee42e25fac806f0005647212", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/7f600eb0fd5a0762ee42e25fac806f0005647212"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/09833a1db1a6a24968cf4575a2a26a8823e3f3ca", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/09833a1db1a6a24968cf4575a2a26a8823e3f3ca", "html_url": "https://github.com/Rust-GCC/gccrs/commit/09833a1db1a6a24968cf4575a2a26a8823e3f3ca", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/09833a1db1a6a24968cf4575a2a26a8823e3f3ca/comments", "author": {"login": "jicama", "id": 266146, "node_id": "MDQ6VXNlcjI2NjE0Ng==", "avatar_url": "https://avatars.githubusercontent.com/u/266146?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jicama", "html_url": "https://github.com/jicama", "followers_url": "https://api.github.com/users/jicama/followers", "following_url": "https://api.github.com/users/jicama/following{/other_user}", "gists_url": "https://api.github.com/users/jicama/gists{/gist_id}", "starred_url": "https://api.github.com/users/jicama/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jicama/subscriptions", "organizations_url": "https://api.github.com/users/jicama/orgs", "repos_url": "https://api.github.com/users/jicama/repos", "events_url": "https://api.github.com/users/jicama/events{/privacy}", "received_events_url": "https://api.github.com/users/jicama/received_events", "type": "User", "site_admin": false}, "committer": null, "parents": [{"sha": "79d9b2dea234d3e7c3fbc13ab1d0160ef08e9f59", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/79d9b2dea234d3e7c3fbc13ab1d0160ef08e9f59", "html_url": "https://github.com/Rust-GCC/gccrs/commit/79d9b2dea234d3e7c3fbc13ab1d0160ef08e9f59"}], "stats": {"total": 20, "additions": 18, "deletions": 2}, "files": [{"sha": "592eb5d13da5662cbf7de5e1038c81fbda8f2f5c", "filename": "gcc/cp/ChangeLog", "status": "modified", "additions": 4, "deletions": 0, "changes": 4, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/09833a1db1a6a24968cf4575a2a26a8823e3f3ca/gcc%2Fcp%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/09833a1db1a6a24968cf4575a2a26a8823e3f3ca/gcc%2Fcp%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fcp%2FChangeLog?ref=09833a1db1a6a24968cf4575a2a26a8823e3f3ca", "patch": "@@ -1,5 +1,9 @@\n 2015-10-31  Jason Merrill  <jason@redhat.com>\n \n+\t* pt.c (unify): Don't diagnose no common base if we already have\n+\tthe same template.\n+\t(do_auto_deduction): Explain deduction failure.\n+\n \t* pt.c (hash_tmpl_and_args): Use iterative_hash_object on template\n \tuid.\n "}, {"sha": "c6ef2f5906ed6d89ad3210d4bddc4fa57c9217ba", "filename": "gcc/cp/pt.c", "status": "modified", "additions": 13, "deletions": 1, "changes": 14, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/09833a1db1a6a24968cf4575a2a26a8823e3f3ca/gcc%2Fcp%2Fpt.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/09833a1db1a6a24968cf4575a2a26a8823e3f3ca/gcc%2Fcp%2Fpt.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fcp%2Fpt.c?ref=09833a1db1a6a24968cf4575a2a26a8823e3f3ca", "patch": "@@ -19633,7 +19633,16 @@ unify (tree tparms, tree targs, tree parm, tree arg, int strict,\n \t\t\t\t\t explain_p, &t);\n \n \t\t  if (!t)\n-\t\t    return unify_no_common_base (explain_p, r, parm, arg);\n+\t\t    {\n+\t\t      /* Don't give the derived diagnostic if we're\n+\t\t\t already dealing with the same template.  */\n+\t\t      bool same_template\n+\t\t\t= (CLASSTYPE_TEMPLATE_INFO (arg)\n+\t\t\t   && (CLASSTYPE_TI_TEMPLATE (parm)\n+\t\t\t       == CLASSTYPE_TI_TEMPLATE (arg)));\n+\t\t      return unify_no_common_base (explain_p && !same_template,\n+\t\t\t\t\t\t   r, parm, arg);\n+\t\t    }\n \t\t}\n \t    }\n \t  else if (CLASSTYPE_TEMPLATE_INFO (arg)\n@@ -23500,6 +23509,9 @@ do_auto_deduction (tree type, tree init, tree auto_node,\n \t\terror (\"unable to deduce lambda return type from %qE\", init);\n \t      else\n \t\terror (\"unable to deduce %qT from %qE\", type, init);\n+\t      type_unification_real (tparms, targs, parms, &init, 1, 0,\n+\t\t\t\t     DEDUCE_CALL, LOOKUP_NORMAL,\n+\t\t\t\t     NULL, /*explain_p=*/true);\n \t    }\n \t  return error_mark_node;\n \t}"}, {"sha": "d79ee7f05e5c6ea4c6766f10fb398e733a51a2dc", "filename": "gcc/testsuite/g++.old-deja/g++.pt/explicit77.C", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/09833a1db1a6a24968cf4575a2a26a8823e3f3ca/gcc%2Ftestsuite%2Fg%2B%2B.old-deja%2Fg%2B%2B.pt%2Fexplicit77.C", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/09833a1db1a6a24968cf4575a2a26a8823e3f3ca/gcc%2Ftestsuite%2Fg%2B%2B.old-deja%2Fg%2B%2B.pt%2Fexplicit77.C", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fg%2B%2B.old-deja%2Fg%2B%2B.pt%2Fexplicit77.C?ref=09833a1db1a6a24968cf4575a2a26a8823e3f3ca", "patch": "@@ -15,5 +15,5 @@ void g() {\n   \n   f<0>(s0, s2);\n   f(s0, s2); // { dg-error \"\" } no matching function\n-  // { dg-message \"(candidate|deduced conflicting types|ambiguous base class)\" \"candidate note\" { target *-*-* } 17 }\n+  // { dg-message \"(candidate|deduced conflicting|ambiguous base class)\" \"candidate note\" { target *-*-* } 17 }\n }"}]}