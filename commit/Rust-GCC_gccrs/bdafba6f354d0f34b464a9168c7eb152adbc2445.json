{"sha": "bdafba6f354d0f34b464a9168c7eb152adbc2445", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6YmRhZmJhNmYzNTRkMGYzNGI0NjRhOTE2OGM3ZWIxNTJhZGJjMjQ0NQ==", "commit": {"author": {"name": "Arnaud Charlet", "email": "charlet@gcc.gnu.org", "date": "2014-10-20T14:32:17Z"}, "committer": {"name": "Arnaud Charlet", "email": "charlet@gcc.gnu.org", "date": "2014-10-20T14:32:17Z"}, "message": "[multiple changes]\n\n2014-10-20  Vincent Celier  <celier@adacore.com>\n\n\t* prj-attr.adb: New project level attribute Runtime.\n\t* prj-conf.adb (Get_Project_Runtimes): New procedure to get\n\tthe attributes Runtime declared in the main project, to use\n\tin auto-configuration.\n\t(Get_Or_Create_Configuration_File): Call Get_Project_Runtimes.\n\t* prj-proc.adb (Runtime_Defaults): New table to store\n\tthe default values of attributes Runtime (<language>).\n\t(Set_Default_Runtime_For): New procedure to store the default\n\tvalue of a Runtime (<language>) in table Runtime_Defaults.\n\t(Expression): Use the value stored in table Runtime_Defaults as\n\tthe default for Runtime (<language>).\n\t* prj-proc.ads (Set_Default_Runtime_For): New procedure.\n\t* prj.ads (Attribute_Default_Value): New enumerated value\n\tRuntime_Value.\n\n2014-10-20  Ed Schonberg  <schonberg@adacore.com>\n\n\t* sem_ch3.adb (Analyze_Object_Declaration): If the type is\n\tan unconstrained unchecked_union type, rewrite declaration\n\tas a renaming to prevent attempt to retrieve non- existent\n\tdiscriminants from expression.\n\n2014-10-20  Ed Schonberg  <schonberg@adacore.com>\n\n\t* gnat_ugn.texi: Minor reformatting.\n\nFrom-SVN: r216479", "tree": {"sha": "ed65d762a493384828cef0fc9627602ebaf63cda", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/ed65d762a493384828cef0fc9627602ebaf63cda"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/bdafba6f354d0f34b464a9168c7eb152adbc2445", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/bdafba6f354d0f34b464a9168c7eb152adbc2445", "html_url": "https://github.com/Rust-GCC/gccrs/commit/bdafba6f354d0f34b464a9168c7eb152adbc2445", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/bdafba6f354d0f34b464a9168c7eb152adbc2445/comments", "author": null, "committer": null, "parents": [{"sha": "a905304c94475f67c263b5f0012e3cda8feb41ca", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/a905304c94475f67c263b5f0012e3cda8feb41ca", "html_url": "https://github.com/Rust-GCC/gccrs/commit/a905304c94475f67c263b5f0012e3cda8feb41ca"}], "stats": {"total": 133, "additions": 130, "deletions": 3}, "files": [{"sha": "a27cae15192a795efc9beb8809d89eaad0ca4a01", "filename": "gcc/ada/ChangeLog", "status": "modified", "additions": 28, "deletions": 0, "changes": 28, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/bdafba6f354d0f34b464a9168c7eb152adbc2445/gcc%2Fada%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/bdafba6f354d0f34b464a9168c7eb152adbc2445/gcc%2Fada%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fada%2FChangeLog?ref=bdafba6f354d0f34b464a9168c7eb152adbc2445", "patch": "@@ -1,3 +1,31 @@\n+2014-10-20  Vincent Celier  <celier@adacore.com>\n+\n+\t* prj-attr.adb: New project level attribute Runtime.\n+\t* prj-conf.adb (Get_Project_Runtimes): New procedure to get\n+\tthe attributes Runtime declared in the main project, to use\n+\tin auto-configuration.\n+\t(Get_Or_Create_Configuration_File): Call Get_Project_Runtimes.\n+\t* prj-proc.adb (Runtime_Defaults): New table to store\n+\tthe default values of attributes Runtime (<language>).\n+\t(Set_Default_Runtime_For): New procedure to store the default\n+\tvalue of a Runtime (<language>) in table Runtime_Defaults.\n+\t(Expression): Use the value stored in table Runtime_Defaults as\n+\tthe default for Runtime (<language>).\n+\t* prj-proc.ads (Set_Default_Runtime_For): New procedure.\n+\t* prj.ads (Attribute_Default_Value): New enumerated value\n+\tRuntime_Value.\n+\n+2014-10-20  Ed Schonberg  <schonberg@adacore.com>\n+\n+\t* sem_ch3.adb (Analyze_Object_Declaration): If the type is\n+\tan unconstrained unchecked_union type, rewrite declaration\n+\tas a renaming to prevent attempt to retrieve non- existent\n+\tdiscriminants from expression.\n+\n+2014-10-20  Ed Schonberg  <schonberg@adacore.com>\n+\n+\t* gnat_ugn.texi: Minor reformatting.\n+\n 2014-10-20  Tristan Gingold  <gingold@adacore.com>\n \n \t* init.c (__gnat_is_stack_guard): Don't use mach_vm_region_recurse on"}, {"sha": "d38f0d799fb41c4b42fba75e50c169a3706e0042", "filename": "gcc/ada/gnat_ugn.texi", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/bdafba6f354d0f34b464a9168c7eb152adbc2445/gcc%2Fada%2Fgnat_ugn.texi", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/bdafba6f354d0f34b464a9168c7eb152adbc2445/gcc%2Fada%2Fgnat_ugn.texi", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fada%2Fgnat_ugn.texi?ref=bdafba6f354d0f34b464a9168c7eb152adbc2445", "patch": "@@ -8127,7 +8127,7 @@ Generate binder file suitable for CodePeer.\n \n @item -R\n @cindex @option{-R} (@command{gnatbind})\n-Output closure source list, which includes all non-time-units that are\n+Output closure source list, which includes all non-runtime-units that are\n included in the bind.\n \n @item -Ra"}, {"sha": "06777bb9e7ac7975c63c4a619ae75d3e657bdbf0", "filename": "gcc/ada/prj-attr.adb", "status": "modified", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/bdafba6f354d0f34b464a9168c7eb152adbc2445/gcc%2Fada%2Fprj-attr.adb", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/bdafba6f354d0f34b464a9168c7eb152adbc2445/gcc%2Fada%2Fprj-attr.adb", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fada%2Fprj-attr.adb?ref=bdafba6f354d0f34b464a9168c7eb152adbc2445", "patch": "@@ -136,6 +136,7 @@ package body Prj.Attr is\n    \"Saobject_generated#\" &\n    \"Saobjects_linked#\" &\n    \"SVtargetDtarget_value#\" &\n+   \"SaruntimeDruntime_value#\" &\n \n    --  Configuration - Libraries\n "}, {"sha": "0be49a079fb729365b1d4432a338bd4ef2eb30bd", "filename": "gcc/ada/prj-conf.adb", "status": "modified", "additions": 37, "deletions": 0, "changes": 37, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/bdafba6f354d0f34b464a9168c7eb152adbc2445/gcc%2Fada%2Fprj-conf.adb", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/bdafba6f354d0f34b464a9168c7eb152adbc2445/gcc%2Fada%2Fprj-conf.adb", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fada%2Fprj-conf.adb?ref=bdafba6f354d0f34b464a9168c7eb152adbc2445", "patch": "@@ -660,6 +660,10 @@ package body Prj.Conf is\n       --  If Target_Name is empty, get the specified target in the project\n       --  file, if any.\n \n+      procedure Get_Project_Runtimes;\n+      --  Get the various Runtime (<lang>) in the project file or any project\n+      --  it extends, if any are specified.\n+\n       function Get_Config_Switches return Argument_List_Access;\n       --  Return the --config switches to use for gprconfig\n \n@@ -833,6 +837,38 @@ package body Prj.Conf is\n          end if;\n       end Get_Project_Target;\n \n+      --------------------------\n+      -- Get_Project_Runtimes --\n+      --------------------------\n+\n+      procedure Get_Project_Runtimes is\n+         Element : Array_Element;\n+         Id      : Array_Element_Id;\n+         Lang    : Name_Id;\n+         Proj    : Project_Id;\n+\n+      begin\n+         Proj := Project;\n+\n+         while Proj /= No_Project loop\n+            Id := Value_Of (Name_Runtime, Proj.Decl.Arrays, Shared);\n+\n+            while Id /= No_Array_Element loop\n+               Element := Shared.Array_Elements.Table (Id);\n+               Lang := Element.Index;\n+\n+               if not Runtime_Name_Set_For (Lang) then\n+                  Set_Runtime_For\n+                    (Lang, RTS_Name => Get_Name_String (Element.Value.Value));\n+               end if;\n+\n+               Id := Element.Next;\n+            end loop;\n+\n+            Proj := Proj.Extends;\n+         end loop;\n+      end Get_Project_Runtimes;\n+\n       -----------------------\n       -- Default_File_Name --\n       -----------------------\n@@ -1384,6 +1420,7 @@ package body Prj.Conf is\n       Config := No_Project;\n \n       Get_Project_Target;\n+      Get_Project_Runtimes;\n       Check_Builder_Switches;\n \n       --  Do not attempt to find a configuration project file when"}, {"sha": "dbb7714410498bc710635757780eb392f581153a", "filename": "gcc/ada/prj-proc.adb", "status": "modified", "additions": 32, "deletions": 1, "changes": 33, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/bdafba6f354d0f34b464a9168c7eb152adbc2445/gcc%2Fada%2Fprj-proc.adb", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/bdafba6f354d0f34b464a9168c7eb152adbc2445/gcc%2Fada%2Fprj-proc.adb", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fada%2Fprj-proc.adb?ref=bdafba6f354d0f34b464a9168c7eb152adbc2445", "patch": "@@ -63,6 +63,15 @@ package body Prj.Proc is\n       Equal      => \"=\");\n    --  This hash table contains all processed projects\n \n+   package Runtime_Defaults is new GNAT.HTable.Simple_HTable\n+     (Header_Num => Prj.Header_Num,\n+      Element    => Name_Id,\n+      No_Element => No_Name,\n+      Key        => Name_Id,\n+      Hash       => Prj.Hash,\n+      Equal      => \"=\");\n+   --  Stores the default values of 'Runtime names for the various languages\n+\n    procedure Add (To_Exp : in out Name_Id; Str : Name_Id);\n    --  Concatenate two strings and returns another string if both\n    --  arguments are not null string.\n@@ -943,6 +952,16 @@ package body Prj.Proc is\n                                          (Opt.Target_Value.all);\n                                        The_Variable.Value := Name_Find;\n                                     end if;\n+\n+                                 when Runtime_Value =>\n+                                    Get_Name_String (Index);\n+                                    To_Lower (Name_Buffer (1 .. Name_Len));\n+                                    The_Variable.Value :=\n+                                      Runtime_Defaults.Get (Name_Find);\n+                                    if The_Variable.Value = No_Name then\n+                                       The_Variable.Value := Empty_String;\n+                                    end if;\n+\n                               end case;\n \n                            when List =>\n@@ -957,7 +976,9 @@ package body Prj.Proc is\n                                     The_Variable.Values :=\n                                       Shared.Dot_String_List;\n \n-                                 when Object_Dir_Value | Target_Value =>\n+                                 when Object_Dir_Value |\n+                                      Target_Value |\n+                                      Runtime_Value =>\n                                     null;\n                               end case;\n                            end case;\n@@ -3126,4 +3147,14 @@ package body Prj.Proc is\n       end if;\n    end Recursive_Process;\n \n+   -----------------------------\n+   -- Set_Default_Runtime_For --\n+   -----------------------------\n+\n+   procedure Set_Default_Runtime_For (Language : Name_Id; Value : String) is\n+   begin\n+      Name_Len := Value'Length;\n+      Name_Buffer (1 .. Name_Len) := Value;\n+      Runtime_Defaults.Set (Language, Name_Find);\n+   end Set_Default_Runtime_For;\n end Prj.Proc;"}, {"sha": "0156df87f4496563df54112ac12c14b21904ab8b", "filename": "gcc/ada/prj-proc.ads", "status": "modified", "additions": 3, "deletions": 0, "changes": 3, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/bdafba6f354d0f34b464a9168c7eb152adbc2445/gcc%2Fada%2Fprj-proc.ads", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/bdafba6f354d0f34b464a9168c7eb152adbc2445/gcc%2Fada%2Fprj-proc.ads", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fada%2Fprj-proc.ads?ref=bdafba6f354d0f34b464a9168c7eb152adbc2445", "patch": "@@ -90,4 +90,7 @@ package Prj.Proc is\n       On_New_Tree_Loaded     : Tree_Loaded_Callback := null);\n    --  Performs the two phases of the processing\n \n+   procedure Set_Default_Runtime_For (Language : Name_Id; Value : String);\n+   --  Set the default value for the runtime of Language. To be used for the\n+   --  value of 'Runtime(<Language>) when Runtime (<language>) is not declared.\n end Prj.Proc;"}, {"sha": "804d88aa2100876e90b36b33c287053d16c70ab7", "filename": "gcc/ada/prj.ads", "status": "modified", "additions": 2, "deletions": 1, "changes": 3, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/bdafba6f354d0f34b464a9168c7eb152adbc2445/gcc%2Fada%2Fprj.ads", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/bdafba6f354d0f34b464a9168c7eb152adbc2445/gcc%2Fada%2Fprj.ads", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fada%2Fprj.ads?ref=bdafba6f354d0f34b464a9168c7eb152adbc2445", "patch": "@@ -77,7 +77,8 @@ package Prj is\n       Empty_Value,         --  Empty string or empty string list\n       Dot_Value,           --  \".\" or (\".\")\n       Object_Dir_Value,    --  'Object_Dir\n-      Target_Value);       --  'Target (special rules)\n+      Target_Value,        --  'Target (special rules)\n+      Runtime_Value);      --  'Runtime (special rules)\n    --  Describe the default values of attributes that are referenced but not\n    --  declared.\n "}, {"sha": "9294eb81fc750ac318524e473bf998fa4ed337cd", "filename": "gcc/ada/sem_ch3.adb", "status": "modified", "additions": 26, "deletions": 0, "changes": 26, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/bdafba6f354d0f34b464a9168c7eb152adbc2445/gcc%2Fada%2Fsem_ch3.adb", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/bdafba6f354d0f34b464a9168c7eb152adbc2445/gcc%2Fada%2Fsem_ch3.adb", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fada%2Fsem_ch3.adb?ref=bdafba6f354d0f34b464a9168c7eb152adbc2445", "patch": "@@ -3839,6 +3839,32 @@ package body Sem_Ch3 is\n             elsif GNATprove_Mode then\n                null;\n \n+            --  If the type is an unchecked union, no subtype can be built from\n+            --  the expression. Rewrite declaration as a renaming, which the\n+            --  back-end can handle properly. This is a rather unusual case,\n+            --  because most unchecked_union declarations have default values\n+            --  for discriminants and are thus unconstrained.\n+\n+            elsif Is_Unchecked_Union (T) then\n+               if Constant_Present (N)\n+                 or else Nkind (E) = N_Function_Call\n+               then\n+                  Set_Ekind (Id, E_Constant);\n+               else\n+                  Set_Ekind (Id, E_Variable);\n+               end if;\n+\n+               Rewrite (N,\n+                 Make_Object_Renaming_Declaration (Loc,\n+                    Defining_Identifier => Id,\n+                    Subtype_Mark => New_Occurrence_Of (T, Loc),\n+                    Name => E));\n+\n+               Set_Renamed_Object (Id, E);\n+               Freeze_Before (N, T);\n+               Set_Is_Frozen (Id);\n+               return;\n+\n             else\n                Expand_Subtype_From_Expr (N, T, Object_Definition (N), E);\n                Act_T := Find_Type_Of_Object (Object_Definition (N), N);"}]}