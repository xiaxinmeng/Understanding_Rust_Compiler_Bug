{"sha": "104c05c5284b7822d770ee51a7d91946c7e56d50", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6MTA0YzA1YzUyODRiNzgyMmQ3NzBlZTUxYTdkOTE5NDZjN2U1NmQ1MA==", "commit": {"author": {"name": "Harald Anlauf", "email": "anlauf@gmx.de", "date": "2021-09-13T17:28:10Z"}, "committer": {"name": "Harald Anlauf", "email": "anlauf@gmx.de", "date": "2021-09-13T17:28:10Z"}, "message": "Fortran - ensure simplification of bounds of array-valued named constants\n\ngcc/fortran/ChangeLog:\n\n\tPR fortran/82314\n\t* decl.c (add_init_expr_to_sym): For proper initialization of\n\tarray-valued named constants the array bounds need to be\n\tsimplified before adding the initializer.\n\ngcc/testsuite/ChangeLog:\n\n\tPR fortran/82314\n\t* gfortran.dg/pr82314.f90: New test.", "tree": {"sha": "e060f101cdc32bf5e520de8e5275db9d4236b74c", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/e060f101cdc32bf5e520de8e5275db9d4236b74c"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/104c05c5284b7822d770ee51a7d91946c7e56d50", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/104c05c5284b7822d770ee51a7d91946c7e56d50", "html_url": "https://github.com/Rust-GCC/gccrs/commit/104c05c5284b7822d770ee51a7d91946c7e56d50", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/104c05c5284b7822d770ee51a7d91946c7e56d50/comments", "author": {"login": "harald-anlauf", "id": 90786862, "node_id": "MDQ6VXNlcjkwNzg2ODYy", "avatar_url": "https://avatars.githubusercontent.com/u/90786862?v=4", "gravatar_id": "", "url": "https://api.github.com/users/harald-anlauf", "html_url": "https://github.com/harald-anlauf", "followers_url": "https://api.github.com/users/harald-anlauf/followers", "following_url": "https://api.github.com/users/harald-anlauf/following{/other_user}", "gists_url": "https://api.github.com/users/harald-anlauf/gists{/gist_id}", "starred_url": "https://api.github.com/users/harald-anlauf/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/harald-anlauf/subscriptions", "organizations_url": "https://api.github.com/users/harald-anlauf/orgs", "repos_url": "https://api.github.com/users/harald-anlauf/repos", "events_url": "https://api.github.com/users/harald-anlauf/events{/privacy}", "received_events_url": "https://api.github.com/users/harald-anlauf/received_events", "type": "User", "site_admin": false}, "committer": {"login": "harald-anlauf", "id": 90786862, "node_id": "MDQ6VXNlcjkwNzg2ODYy", "avatar_url": "https://avatars.githubusercontent.com/u/90786862?v=4", "gravatar_id": "", "url": "https://api.github.com/users/harald-anlauf", "html_url": "https://github.com/harald-anlauf", "followers_url": "https://api.github.com/users/harald-anlauf/followers", "following_url": "https://api.github.com/users/harald-anlauf/following{/other_user}", "gists_url": "https://api.github.com/users/harald-anlauf/gists{/gist_id}", "starred_url": "https://api.github.com/users/harald-anlauf/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/harald-anlauf/subscriptions", "organizations_url": "https://api.github.com/users/harald-anlauf/orgs", "repos_url": "https://api.github.com/users/harald-anlauf/repos", "events_url": "https://api.github.com/users/harald-anlauf/events{/privacy}", "received_events_url": "https://api.github.com/users/harald-anlauf/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "8d93ba93d3b13ac3d3c34404cad87732c809605b", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/8d93ba93d3b13ac3d3c34404cad87732c809605b", "html_url": "https://github.com/Rust-GCC/gccrs/commit/8d93ba93d3b13ac3d3c34404cad87732c809605b"}], "stats": {"total": 29, "additions": 29, "deletions": 0}, "files": [{"sha": "f2e8896b562765bb590775c94389ab43a3c70639", "filename": "gcc/fortran/decl.c", "status": "modified", "additions": 18, "deletions": 0, "changes": 18, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/104c05c5284b7822d770ee51a7d91946c7e56d50/gcc%2Ffortran%2Fdecl.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/104c05c5284b7822d770ee51a7d91946c7e56d50/gcc%2Ffortran%2Fdecl.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ffortran%2Fdecl.c?ref=104c05c5284b7822d770ee51a7d91946c7e56d50", "patch": "@@ -2169,6 +2169,24 @@ add_init_expr_to_sym (const char *name, gfc_expr **initp, locus *var_locus)\n \t  sym->as->type = AS_EXPLICIT;\n \t}\n \n+      /* Ensure that explicit bounds are simplified.  */\n+      if (sym->attr.flavor == FL_PARAMETER && sym->attr.dimension\n+\t  && sym->as->type == AS_EXPLICIT)\n+\t{\n+\t  for (int dim = 0; dim < sym->as->rank; ++dim)\n+\t    {\n+\t      gfc_expr *e;\n+\n+\t      e = sym->as->lower[dim];\n+\t      if (e->expr_type != EXPR_CONSTANT)\n+\t\tgfc_reduce_init_expr (e);\n+\n+\t      e = sym->as->upper[dim];\n+\t      if (e->expr_type != EXPR_CONSTANT)\n+\t\tgfc_reduce_init_expr (e);\n+\t    }\n+\t}\n+\n       /* Need to check if the expression we initialized this\n \t to was one of the iso_c_binding named constants.  If so,\n \t and we're a parameter (constant), let it be iso_c."}, {"sha": "3a147e2271124aa55e66407dfb7254a8c5784ed0", "filename": "gcc/testsuite/gfortran.dg/pr82314.f90", "status": "added", "additions": 11, "deletions": 0, "changes": 11, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/104c05c5284b7822d770ee51a7d91946c7e56d50/gcc%2Ftestsuite%2Fgfortran.dg%2Fpr82314.f90", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/104c05c5284b7822d770ee51a7d91946c7e56d50/gcc%2Ftestsuite%2Fgfortran.dg%2Fpr82314.f90", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgfortran.dg%2Fpr82314.f90?ref=104c05c5284b7822d770ee51a7d91946c7e56d50", "patch": "@@ -0,0 +1,11 @@\n+! { dg-do run }\n+! PR fortran/82314 - ICE in gfc_conv_expr_descriptor\n+\n+program p\n+  implicit none\n+  integer, parameter :: karray(merge(3,7,.true.):merge(3,7,.false.)) = 1\n+  integer, parameter :: i = size   (karray)\n+  integer, parameter :: l = lbound (karray,1)\n+  integer, parameter :: u = ubound (karray,1)\n+  if (l /= 3 .or. u /= 7 .or. i /= 5) stop 1\n+end"}]}