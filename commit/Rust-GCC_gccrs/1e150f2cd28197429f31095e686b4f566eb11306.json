{"sha": "1e150f2cd28197429f31095e686b4f566eb11306", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6MWUxNTBmMmNkMjgxOTc0MjlmMzEwOTVlNjg2YjRmNTY2ZWIxMTMwNg==", "commit": {"author": {"name": "Jan Hubicka", "email": "jh@suse.cz", "date": "2002-05-08T11:13:54Z"}, "committer": {"name": "Jan Hubicka", "email": "hubicka@gcc.gnu.org", "date": "2002-05-08T11:13:54Z"}, "message": "cse.c (dead_libcall_p): Update counts.\n\n\n\t* cse.c (dead_libcall_p): Update counts.\n\t(delete_trivially_dead_insns): Update call of dead_libcall_p.\n\nFrom-SVN: r53287", "tree": {"sha": "7f34b4810050d284a3cd94485d4ebef7a2fa0015", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/7f34b4810050d284a3cd94485d4ebef7a2fa0015"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/1e150f2cd28197429f31095e686b4f566eb11306", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/1e150f2cd28197429f31095e686b4f566eb11306", "html_url": "https://github.com/Rust-GCC/gccrs/commit/1e150f2cd28197429f31095e686b4f566eb11306", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/1e150f2cd28197429f31095e686b4f566eb11306/comments", "author": null, "committer": null, "parents": [{"sha": "969d70ca573bbd887b1ccfa21130c70b463ad1f9", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/969d70ca573bbd887b1ccfa21130c70b463ad1f9", "html_url": "https://github.com/Rust-GCC/gccrs/commit/969d70ca573bbd887b1ccfa21130c70b463ad1f9"}], "stats": {"total": 18, "additions": 15, "deletions": 3}, "files": [{"sha": "686cacebee1626242612dc4b6cfc741f405de95a", "filename": "gcc/ChangeLog", "status": "modified", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/1e150f2cd28197429f31095e686b4f566eb11306/gcc%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/1e150f2cd28197429f31095e686b4f566eb11306/gcc%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2FChangeLog?ref=1e150f2cd28197429f31095e686b4f566eb11306", "patch": "@@ -1,3 +1,8 @@\n+Wed May  8 13:12:11 CEST 2002  Jan Hubicka  <jh@suse.cz>\n+\n+\t* cse.c (dead_libcall_p): Update counts.\n+\t(delete_trivially_dead_insns): Update call of dead_libcall_p.\n+\n Wed May  8 11:08:50 CEST 2002  Jan Hubicka  <jh@suse.cz>\n \n \t* cfglayout.c (function_tail_eff_head): Rename to ..."}, {"sha": "c292c5202400a3b82de3454ed729d96ad3e2918d", "filename": "gcc/cse.c", "status": "modified", "additions": 10, "deletions": 3, "changes": 13, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/1e150f2cd28197429f31095e686b4f566eb11306/gcc%2Fcse.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/1e150f2cd28197429f31095e686b4f566eb11306/gcc%2Fcse.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fcse.c?ref=1e150f2cd28197429f31095e686b4f566eb11306", "patch": "@@ -691,7 +691,7 @@ static int check_dependence\tPARAMS ((rtx *, void *));\n static void flush_hash_table\tPARAMS ((void));\n static bool insn_live_p\t\tPARAMS ((rtx, int *));\n static bool set_live_p\t\tPARAMS ((rtx, rtx, int *));\n-static bool dead_libcall_p\tPARAMS ((rtx));\n+static bool dead_libcall_p\tPARAMS ((rtx, int *));\n \f\n /* Dump the expressions in the equivalence class indicated by CLASSP.\n    This function is used only for debugging.  */\n@@ -7571,8 +7571,9 @@ insn_live_p (insn, counts)\n /* Return true if libcall is dead as a whole.  */\n \n static bool\n-dead_libcall_p (insn)\n+dead_libcall_p (insn, counts)\n      rtx insn;\n+     int *counts;\n {\n   rtx note;\n   /* See if there's a REG_EQUAL note on this insn and try to\n@@ -7589,11 +7590,17 @@ dead_libcall_p (insn)\n       if (!new)\n \tnew = XEXP (note, 0);\n \n+      /* While changing insn, we must update the counts accordingly.  */\n+      count_reg_usage (insn, counts, NULL_RTX, -1);\n+\n       if (set && validate_change (insn, &SET_SRC (set), new, 0))\n \t{\n+          count_reg_usage (insn, counts, NULL_RTX, 1);\n \t  remove_note (insn, find_reg_note (insn, REG_RETVAL, NULL_RTX));\n+\t  remove_note (insn, note);\n \t  return true;\n \t}\n+       count_reg_usage (insn, counts, NULL_RTX, 1);\n     }\n   return false;\n }\n@@ -7652,7 +7659,7 @@ delete_trivially_dead_insns (insns, nreg)\n \t    {\n \t      in_libcall = 1;\n \t      live_insn = 1;\n-\t      dead_libcall = dead_libcall_p (insn);\n+\t      dead_libcall = dead_libcall_p (insn, counts);\n \t    }\n \t  else if (in_libcall)\n \t    live_insn = ! dead_libcall;"}]}