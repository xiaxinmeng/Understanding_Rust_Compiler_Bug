{"sha": "63e5f5679cf5daf7c27ca1c9a585cef733f857ce", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6NjNlNWY1Njc5Y2Y1ZGFmN2MyN2NhMWM5YTU4NWNlZjczM2Y4NTdjZQ==", "commit": {"author": {"name": "Mark Mitchell", "email": "mark@codesourcery.com", "date": "2003-01-07T01:33:54Z"}, "committer": {"name": "Mark Mitchell", "email": "mmitchel@gcc.gnu.org", "date": "2003-01-07T01:33:54Z"}, "message": "class.c (layout_class_type): Correct handling of unnamed bitfields wider than their types.\n\n\t* class.c (layout_class_type): Correct handling of unnamed\n\tbitfields wider than their types.\n\n\t* testsuite/g++.dg/abi/bitfield9.C: New test.\n\nFrom-SVN: r60966", "tree": {"sha": "bd8a925d8ba1a1525c5ec0f2f4495c72b4db643f", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/bd8a925d8ba1a1525c5ec0f2f4495c72b4db643f"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/63e5f5679cf5daf7c27ca1c9a585cef733f857ce", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/63e5f5679cf5daf7c27ca1c9a585cef733f857ce", "html_url": "https://github.com/Rust-GCC/gccrs/commit/63e5f5679cf5daf7c27ca1c9a585cef733f857ce", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/63e5f5679cf5daf7c27ca1c9a585cef733f857ce/comments", "author": null, "committer": null, "parents": [{"sha": "52fd80fb25a7c0791880543bd9a26c24ae454edf", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/52fd80fb25a7c0791880543bd9a26c24ae454edf", "html_url": "https://github.com/Rust-GCC/gccrs/commit/52fd80fb25a7c0791880543bd9a26c24ae454edf"}], "stats": {"total": 33, "additions": 32, "deletions": 1}, "files": [{"sha": "9522ae6f168b5c12ae59b04c29d36b08ab8f0203", "filename": "gcc/cp/ChangeLog", "status": "modified", "additions": 3, "deletions": 0, "changes": 3, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/63e5f5679cf5daf7c27ca1c9a585cef733f857ce/gcc%2Fcp%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/63e5f5679cf5daf7c27ca1c9a585cef733f857ce/gcc%2Fcp%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fcp%2FChangeLog?ref=63e5f5679cf5daf7c27ca1c9a585cef733f857ce", "patch": "@@ -1,5 +1,8 @@\n 2003-01-06  Mark Mitchell  <mark@codesourcery.com>\n \n+\t* class.c (layout_class_type): Correct handling of unnamed\n+\tbitfields wider than their types.\n+\n \tPR c++/9189\n \t* parser.c (cp_parser): Remove default_arg_types.  Update\n \tdocumentation for unparsed_functions_queues."}, {"sha": "9666975a09033542d1da4a664255731046d9d472", "filename": "gcc/cp/class.c", "status": "modified", "additions": 16, "deletions": 1, "changes": 17, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/63e5f5679cf5daf7c27ca1c9a585cef733f857ce/gcc%2Fcp%2Fclass.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/63e5f5679cf5daf7c27ca1c9a585cef733f857ce/gcc%2Fcp%2Fclass.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fcp%2Fclass.c?ref=63e5f5679cf5daf7c27ca1c9a585cef733f857ce", "patch": "@@ -4993,6 +4993,7 @@ layout_class_type (tree t, tree *virtuals_p)\n     {\n       tree type;\n       tree padding;\n+      bool was_unnamed_p = false;\n \n       /* We still pass things that aren't non-static data members to\n \t the back-end, in case it wants to do something with them.  */\n@@ -5024,7 +5025,6 @@ layout_class_type (tree t, tree *virtuals_p)\n \t{\n \t  integer_type_kind itk;\n \t  tree integer_type;\n-\n \t  /* We must allocate the bits as if suitably aligned for the\n \t     longest integer type that fits in this many bits.  type\n \t     of the field.  Then, we are supposed to use the left over\n@@ -5053,6 +5053,17 @@ layout_class_type (tree t, tree *virtuals_p)\n \t      padding = size_binop (MINUS_EXPR, DECL_SIZE (field),\n \t\t\t\t    TYPE_SIZE (integer_type));\n \t    }\n+\t  /* An unnamed bitfield does not normally affect the\n+\t     alignment of the containing class on a target where\n+\t     PCC_BITFIELD_TYPE_MATTERS.  But, the C++ ABI does not\n+\t     make any exceptions for unnamed bitfields when the\n+\t     bitfields are longer than their types.  Therefore, we\n+\t     temporarily give the field a name.  */\n+\t  if (PCC_BITFIELD_TYPE_MATTERS && !DECL_NAME (field))\n+\t    {\n+\t      was_unnamed_p = true;\n+\t      DECL_NAME (field) = make_anon_name ();\n+\t    }\n \t  DECL_SIZE (field) = TYPE_SIZE (integer_type);\n \t  DECL_ALIGN (field) = TYPE_ALIGN (integer_type);\n \t  DECL_USER_ALIGN (field) = TYPE_USER_ALIGN (integer_type);\n@@ -5062,6 +5073,10 @@ layout_class_type (tree t, tree *virtuals_p)\n \n       layout_nonempty_base_or_field (rli, field, NULL_TREE,\n \t\t\t\t     empty_base_offsets);\n+      /* If the bit-field had no name originally, remove the name\n+\t now.  */\n+      if (was_unnamed_p)\n+\tDECL_NAME (field) = NULL_TREE;\n \n       /* Remember the location of any empty classes in FIELD.  */\n       if (abi_version_at_least (2))"}, {"sha": "8b4fce3179c0da8aa8aa65de02fd9d05427aca65", "filename": "gcc/testsuite/ChangeLog", "status": "modified", "additions": 2, "deletions": 0, "changes": 2, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/63e5f5679cf5daf7c27ca1c9a585cef733f857ce/gcc%2Ftestsuite%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/63e5f5679cf5daf7c27ca1c9a585cef733f857ce/gcc%2Ftestsuite%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2FChangeLog?ref=63e5f5679cf5daf7c27ca1c9a585cef733f857ce", "patch": "@@ -1,5 +1,7 @@\n 2003-01-06  Mark Mitchell  <mark@codesourcery.com>\n \n+\t* testsuite/g++.dg/abi/bitfield9.C: New test.\n+\n \tPR c++/9189\n \t* g++.dg/parse/defarg3.C: New test.\n "}, {"sha": "0d744c7318f6b537bc8841a64a048b8a07e902c5", "filename": "gcc/testsuite/g++.dg/abi/bitfield9.C", "status": "added", "additions": 11, "deletions": 0, "changes": 11, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/63e5f5679cf5daf7c27ca1c9a585cef733f857ce/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Fabi%2Fbitfield9.C", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/63e5f5679cf5daf7c27ca1c9a585cef733f857ce/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Fabi%2Fbitfield9.C", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Fabi%2Fbitfield9.C?ref=63e5f5679cf5daf7c27ca1c9a585cef733f857ce", "patch": "@@ -0,0 +1,11 @@\n+// { dg-do run { target i?86-*-* } }\n+// { dg-options -w }\n+\n+struct X {\n+  char : 45;\n+};\n+\n+int main () {\n+  if (__alignof__ (X) != 4)\n+    return 1;\n+}"}]}