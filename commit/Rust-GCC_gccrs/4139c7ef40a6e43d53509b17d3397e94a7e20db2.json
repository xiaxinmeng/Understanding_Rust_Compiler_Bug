{"sha": "4139c7ef40a6e43d53509b17d3397e94a7e20db2", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6NDEzOWM3ZWY0MGE2ZTQzZDUzNTA5YjE3ZDMzOTdlOTRhN2UyMGRiMg==", "commit": {"author": {"name": "Jakub Jelinek", "email": "jakub@redhat.com", "date": "2010-01-07T15:10:26Z"}, "committer": {"name": "Jakub Jelinek", "email": "jakub@gcc.gnu.org", "date": "2010-01-07T15:10:26Z"}, "message": "re PR tree-optimization/42625 (-fipa-sra can generate different destructors in different object files, binary breaks after linking)\n\n\tPR tree-optimization/42625\n\t* cgraph.c (cgraph_make_node_local): Clear DECL_COMDAT*,\n\tTREE_PUBLIC, DECL_WEAK and DECL_EXTERNAL also for same_body\n\taliases.\n\n\t* g++.dg/opt/dtor4.C: New test.\n\t* g++.dg/opt/dtor4.h: New.\n\t* g++.dg/opt/dtor4-aux.cc: New.\n\nFrom-SVN: r155694", "tree": {"sha": "bd1b5a39ccc8b70f0e46666012120ec53853f4ad", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/bd1b5a39ccc8b70f0e46666012120ec53853f4ad"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/4139c7ef40a6e43d53509b17d3397e94a7e20db2", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/4139c7ef40a6e43d53509b17d3397e94a7e20db2", "html_url": "https://github.com/Rust-GCC/gccrs/commit/4139c7ef40a6e43d53509b17d3397e94a7e20db2", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/4139c7ef40a6e43d53509b17d3397e94a7e20db2/comments", "author": {"login": "jakubjelinek", "id": 9370665, "node_id": "MDQ6VXNlcjkzNzA2NjU=", "avatar_url": "https://avatars.githubusercontent.com/u/9370665?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jakubjelinek", "html_url": "https://github.com/jakubjelinek", "followers_url": "https://api.github.com/users/jakubjelinek/followers", "following_url": "https://api.github.com/users/jakubjelinek/following{/other_user}", "gists_url": "https://api.github.com/users/jakubjelinek/gists{/gist_id}", "starred_url": "https://api.github.com/users/jakubjelinek/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jakubjelinek/subscriptions", "organizations_url": "https://api.github.com/users/jakubjelinek/orgs", "repos_url": "https://api.github.com/users/jakubjelinek/repos", "events_url": "https://api.github.com/users/jakubjelinek/events{/privacy}", "received_events_url": "https://api.github.com/users/jakubjelinek/received_events", "type": "User", "site_admin": false}, "committer": null, "parents": [{"sha": "01094033c6b98cda7cbde9e78a2f949939435be5", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/01094033c6b98cda7cbde9e78a2f949939435be5", "html_url": "https://github.com/Rust-GCC/gccrs/commit/01094033c6b98cda7cbde9e78a2f949939435be5"}], "stats": {"total": 52, "additions": 51, "deletions": 1}, "files": [{"sha": "77620771597bf9d9c6c894c54a5172d104c808a1", "filename": "gcc/ChangeLog", "status": "modified", "additions": 7, "deletions": 0, "changes": 7, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/4139c7ef40a6e43d53509b17d3397e94a7e20db2/gcc%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/4139c7ef40a6e43d53509b17d3397e94a7e20db2/gcc%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2FChangeLog?ref=4139c7ef40a6e43d53509b17d3397e94a7e20db2", "patch": "@@ -1,3 +1,10 @@\n+2010-01-07  Jakub Jelinek  <jakub@redhat.com>\n+\n+\tPR tree-optimization/42625\n+\t* cgraph.c (cgraph_make_node_local): Clear DECL_COMDAT*,\n+\tTREE_PUBLIC, DECL_WEAK and DECL_EXTERNAL also for same_body\n+\taliases.\n+\n 2010-01-07  Duncan Sands  <baldrick@free.fr>\n \n \t* Makefile.in (PLUGIN_HEADERS): Add version.h."}, {"sha": "baaf601c9676bc0338dd74902ac22fad5ac41a53", "filename": "gcc/cgraph.c", "status": "modified", "additions": 10, "deletions": 1, "changes": 11, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/4139c7ef40a6e43d53509b17d3397e94a7e20db2/gcc%2Fcgraph.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/4139c7ef40a6e43d53509b17d3397e94a7e20db2/gcc%2Fcgraph.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fcgraph.c?ref=4139c7ef40a6e43d53509b17d3397e94a7e20db2", "patch": "@@ -1,5 +1,5 @@\n /* Callgraph handling code.\n-   Copyright (C) 2003, 2004, 2005, 2006, 2007, 2008, 2009\n+   Copyright (C) 2003, 2004, 2005, 2006, 2007, 2008, 2009, 2010\n    Free Software Foundation, Inc.\n    Contributed by Jan Hubicka\n \n@@ -2197,11 +2197,20 @@ cgraph_make_node_local (struct cgraph_node *node)\n   gcc_assert (cgraph_node_can_be_local_p (node));\n   if (DECL_COMDAT (node->decl) || DECL_EXTERNAL (node->decl))\n     {\n+      struct cgraph_node *alias;\n       DECL_COMDAT (node->decl) = 0;\n       DECL_COMDAT_GROUP (node->decl) = 0;\n       TREE_PUBLIC (node->decl) = 0;\n       DECL_WEAK (node->decl) = 0;\n       DECL_EXTERNAL (node->decl) = 0;\n+      for (alias = node->same_body; alias; alias = alias->next)\n+\t{\n+\t  DECL_COMDAT (alias->decl) = 0;\n+\t  DECL_COMDAT_GROUP (alias->decl) = 0;\n+\t  TREE_PUBLIC (alias->decl) = 0;\n+\t  DECL_WEAK (alias->decl) = 0;\n+\t  DECL_EXTERNAL (alias->decl) = 0;\n+\t}\n       node->local.externally_visible = false;\n       node->local.local = true;\n       gcc_assert (cgraph_function_body_availability (node) == AVAIL_LOCAL);"}, {"sha": "d68e6e9fb100242eeaf2edf7415e0c3708e4df1d", "filename": "gcc/testsuite/ChangeLog", "status": "modified", "additions": 7, "deletions": 0, "changes": 7, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/4139c7ef40a6e43d53509b17d3397e94a7e20db2/gcc%2Ftestsuite%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/4139c7ef40a6e43d53509b17d3397e94a7e20db2/gcc%2Ftestsuite%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2FChangeLog?ref=4139c7ef40a6e43d53509b17d3397e94a7e20db2", "patch": "@@ -1,3 +1,10 @@\n+2010-01-07  Jakub Jelinek  <jakub@redhat.com>\n+\n+\tPR tree-optimization/42625\n+\t* g++.dg/opt/dtor4.C: New test.\n+\t* g++.dg/opt/dtor4.h: New.\n+\t* g++.dg/opt/dtor4-aux.cc: New.\n+\n 2010-01-07  Tobias Burnus  <burnus@net-b.de>\n \n \tPR fortran/42597"}, {"sha": "e3ca43b74306df990df729fe01b71d8e14200ed3", "filename": "gcc/testsuite/g++.dg/opt/dtor4-aux.cc", "status": "added", "additions": 6, "deletions": 0, "changes": 6, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/4139c7ef40a6e43d53509b17d3397e94a7e20db2/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Fopt%2Fdtor4-aux.cc", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/4139c7ef40a6e43d53509b17d3397e94a7e20db2/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Fopt%2Fdtor4-aux.cc", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Fopt%2Fdtor4-aux.cc?ref=4139c7ef40a6e43d53509b17d3397e94a7e20db2", "patch": "@@ -0,0 +1,6 @@\n+// { dg-do compile }\n+// { dg-options \"\" }\n+\n+#include \"dtor4.h\"\n+\n+S s;"}, {"sha": "c58fadfa18d265d37a4ed51ed72fd97af84a232d", "filename": "gcc/testsuite/g++.dg/opt/dtor4.C", "status": "added", "additions": 13, "deletions": 0, "changes": 13, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/4139c7ef40a6e43d53509b17d3397e94a7e20db2/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Fopt%2Fdtor4.C", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/4139c7ef40a6e43d53509b17d3397e94a7e20db2/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Fopt%2Fdtor4.C", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Fopt%2Fdtor4.C?ref=4139c7ef40a6e43d53509b17d3397e94a7e20db2", "patch": "@@ -0,0 +1,13 @@\n+// PR tree-optimization/42625\n+// { dg-do run }\n+// { dg-options \"-O1 -fipa-sra\" }\n+// { dg-additional-sources \"dtor4-aux.cc\" }\n+\n+#include \"dtor4.h\"\n+\n+int\n+main ()\n+{\n+  S s;\n+  return 0;\n+}"}, {"sha": "d3b43beabd7f24969276ed190557a48d6a490472", "filename": "gcc/testsuite/g++.dg/opt/dtor4.h", "status": "added", "additions": 8, "deletions": 0, "changes": 8, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/4139c7ef40a6e43d53509b17d3397e94a7e20db2/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Fopt%2Fdtor4.h", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/4139c7ef40a6e43d53509b17d3397e94a7e20db2/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Fopt%2Fdtor4.h", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Fopt%2Fdtor4.h?ref=4139c7ef40a6e43d53509b17d3397e94a7e20db2", "patch": "@@ -0,0 +1,8 @@\n+#include <cassert>\n+\n+struct S\n+{\n+  int a, i;\n+  S () : i(1) {}\n+  __attribute__((noinline)) ~S () { assert (i == 1); }\n+};"}]}