{"sha": "37150080504338dc8288ac8eeb0cc2636031fd07", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6MzcxNTAwODA1MDQzMzhkYzgyODhhYzhlZWIwY2MyNjM2MDMxZmQwNw==", "commit": {"author": {"name": "Andreas Schwab", "email": "schwab@suse.de", "date": "2005-10-03T21:50:17Z"}, "committer": {"name": "Andreas Schwab", "email": "schwab@gcc.gnu.org", "date": "2005-10-03T21:50:17Z"}, "message": "backport: ltmain.sh: add support for installing into temporary staging area (e.g.\n\n\tBackport from libtool CVS:\n\t2002-11-03  Ossama Othman  <ossama@doc.ece.uci.edu>\n\n\t* ltmain.sh: add support for installing into temporary\n\tstaging area (e.g. 'make install DESTDIR=...')\n\nFrom-SVN: r104913", "tree": {"sha": "4a4ab0b951c6da14bfdc8b43bad65851f9769b44", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/4a4ab0b951c6da14bfdc8b43bad65851f9769b44"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/37150080504338dc8288ac8eeb0cc2636031fd07", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/37150080504338dc8288ac8eeb0cc2636031fd07", "html_url": "https://github.com/Rust-GCC/gccrs/commit/37150080504338dc8288ac8eeb0cc2636031fd07", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/37150080504338dc8288ac8eeb0cc2636031fd07/comments", "author": {"login": "andreas-schwab", "id": 2175493, "node_id": "MDQ6VXNlcjIxNzU0OTM=", "avatar_url": "https://avatars.githubusercontent.com/u/2175493?v=4", "gravatar_id": "", "url": "https://api.github.com/users/andreas-schwab", "html_url": "https://github.com/andreas-schwab", "followers_url": "https://api.github.com/users/andreas-schwab/followers", "following_url": "https://api.github.com/users/andreas-schwab/following{/other_user}", "gists_url": "https://api.github.com/users/andreas-schwab/gists{/gist_id}", "starred_url": "https://api.github.com/users/andreas-schwab/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/andreas-schwab/subscriptions", "organizations_url": "https://api.github.com/users/andreas-schwab/orgs", "repos_url": "https://api.github.com/users/andreas-schwab/repos", "events_url": "https://api.github.com/users/andreas-schwab/events{/privacy}", "received_events_url": "https://api.github.com/users/andreas-schwab/received_events", "type": "User", "site_admin": false}, "committer": null, "parents": [{"sha": "1718a2aa9b1715961e514331aea0f5aacc611580", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/1718a2aa9b1715961e514331aea0f5aacc611580", "html_url": "https://github.com/Rust-GCC/gccrs/commit/1718a2aa9b1715961e514331aea0f5aacc611580"}], "stats": {"total": 58, "additions": 57, "deletions": 1}, "files": [{"sha": "abea93891aa94c7f03add2166e9c8ac083502cee", "filename": "ChangeLog", "status": "modified", "additions": 8, "deletions": 0, "changes": 8, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/37150080504338dc8288ac8eeb0cc2636031fd07/ChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/37150080504338dc8288ac8eeb0cc2636031fd07/ChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/ChangeLog?ref=37150080504338dc8288ac8eeb0cc2636031fd07", "patch": "@@ -1,3 +1,11 @@\n+2005-10-03  Andreas Schwab  <schwab@suse.de>\n+\n+\tBackport from libtool CVS:\n+\t2002-11-03  Ossama Othman  <ossama@doc.ece.uci.edu>\n+\n+\t* ltmain.sh: add support for installing into temporary\n+\tstaging area (e.g. 'make install DESTDIR=...')\n+\n 2005-10-03  H.J. Lu  <hongjiu.lu@intel.com>\n \n \t* configure.in (*-*-darwin*): Build bfd, binutils and opcodes."}, {"sha": "9de8ae5ce5f11724fc861eab3ed7af6e136f9ec9", "filename": "ltmain.sh", "status": "modified", "additions": 49, "deletions": 1, "changes": 50, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/37150080504338dc8288ac8eeb0cc2636031fd07/ltmain.sh", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/37150080504338dc8288ac8eeb0cc2636031fd07/ltmain.sh", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/ltmain.sh?ref=37150080504338dc8288ac8eeb0cc2636031fd07", "patch": "@@ -829,6 +829,7 @@ EOF\n     linker_flags=\n     dllsearchpath=\n     lib_search_path=`pwd`\n+    inst_prefix_dir=\n \n     avoid_version=no\n     dlfiles=\n@@ -961,6 +962,11 @@ EOF\n \t  prev=\n \t  continue\n \t  ;;\n+\tinst_prefix)\n+\t  inst_prefix_dir=\"$arg\"\n+\t  prev=\n+\t  continue\n+\t  ;;\n \trelease)\n \t  release=\"-$arg\"\n \t  prev=\n@@ -1187,6 +1193,11 @@ EOF\n \tcontinue\n \t;;\n \n+      -inst-prefix-dir)\n+\tprev=inst_prefix\n+\tcontinue\n+\t;;\n+\n       # The native IRIX linker understands -LANG:*, -LIST:* and -LNO:*\n       # so, if we see these flags be careful not to treat them like -L\n       -L[A-Z][A-Z]*:*)\n@@ -2171,6 +2182,14 @@ EOF\n \t\tadd=\"$dir/$linklib\"\n \t      elif test \"$hardcode_minus_L\" = yes; then\n \t\tadd_dir=\"-L$dir\"\n+\t\t# Try looking first in the location we're being installed to.\n+\t\tif test -n \"$inst_prefix_dir\"; then\n+\t\t  case \"$libdir\" in\n+\t\t    [\\\\/]*)\n+\t\t      add_dir=\"$add_dir -L$inst_prefix_dir$libdir\"\n+\t\t      ;;\n+\t\t  esac\n+\t\tfi\n \t\tadd=\"-l$name\"\n \t      elif test \"$hardcode_shlibpath_var\" = yes; then\n \t\tadd_shlibpath=\"$dir\"\n@@ -2229,6 +2248,14 @@ EOF\n \t    else\n \t      # We cannot seem to hardcode it, guess we'll fake it.\n \t      add_dir=\"-L$libdir\"\n+\t      # Try looking first in the location we're being installed to.\n+\t      if test -n \"$inst_prefix_dir\"; then\n+\t\tcase \"$libdir\" in\n+\t\t  [\\\\/]*)\n+\t\t    add_dir=\"$add_dir -L$inst_prefix_dir$libdir\"\n+\t\t    ;;\n+\t\tesac\n+\t      fi\n \t      add=\"-l$name\"\n \t    fi\n \n@@ -4460,7 +4487,7 @@ fi\\\n       for tag in $taglist; do\n         tagopts=\"$tagopts --tag $tag\"\n       done\n-      relink_command=\"(cd `pwd`; $SHELL $0$tagopts --mode=relink $libtool_args)\"\n+      relink_command=\"(cd `pwd`; $SHELL $0$tagopts --mode=relink $libtool_args @inst_prefix_dir@)\"\n       relink_command=`$echo \"X$relink_command\" | $Xsed -e \"$sed_quote_subst\"`\n \n       # Only create the output if not a dry run.\n@@ -4761,6 +4788,27 @@ relink_command=\\\"$relink_command\\\"\"\n \tdir=\"$dir$objdir\"\n \n \tif test -n \"$relink_command\"; then\n+\t  # Determine the prefix the user has applied to our future dir.\n+\t  inst_prefix_dir=`$echo \"$destdir\" | sed \"s%$libdir\\$%%\"`\n+\n+\t  # Don't allow the user to place us outside of our expected\n+\t  # location b/c this prevents finding dependent libraries that\n+\t  # are installed to the same prefix.\n+\t  # At present, this check doesn't affect windows .dll's that\n+\t  # are installed into $libdir/../bin (currently, that works fine)\n+\t  # but it's something to keep an eye on.\n+\t  if test \"$inst_prefix_dir\" = \"$destdir\"; then\n+\t    $echo \"$modename: error: cannot install \\`$file' to a directory not ending in $libdir\" 1>&2\n+\t    exit $EXIT_FAILURE\n+\t  fi\n+\n+\t  if test -n \"$inst_prefix_dir\"; then\n+\t    # Stick the inst_prefix_dir data into the link command.\n+\t    relink_command=`$echo \"$relink_command\" | sed \"s%@inst_prefix_dir@%-inst-prefix-dir $inst_prefix_dir%\"`\n+\t  else\n+\t    relink_command=`$echo \"$relink_command\" | sed \"s%@inst_prefix_dir@%%\"`\n+\t  fi\n+\n \t  $echo \"$modename: warning: relinking \\`$file'\" 1>&2\n \t  $show \"$relink_command\"\n \t  if $run eval \"$relink_command\"; then :"}]}