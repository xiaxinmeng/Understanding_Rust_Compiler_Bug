{"sha": "981524428b21bf6935f8f9a3b8394d5504f4f0fc", "node_id": "C_kwDOANBUbNoAKDk4MTUyNDQyOGIyMWJmNjkzNWY4ZjlhM2I4Mzk0ZDU1MDRmNGYwZmM", "commit": {"author": {"name": "Arthur Cohen", "email": "arthur.cohen@embecosm.com", "date": "2022-03-19T18:25:51Z"}, "committer": {"name": "Jeff Law", "email": "jeffreyalaw@gmail.com", "date": "2022-03-19T18:29:43Z"}, "message": "selftest: Move C-specific tests to c_family\n\nWhen trying to make use of the selftest framework over on the rust\nfrontend, we ran into issues where rust1 was expected to produce errors\ncontaining C-like type names such as `int`.\n\nI had gotten in contact with David Malcolm on the gcc mailing list [1],\nwho advised moving some test functions to a better location. The\noffending functions have also been renamed in order to better fit the C\nfamily of tests, and are thus not called when performing general\nselftests anymore.\n\nKindly,\n\n[1]: https://gcc.gnu.org/pipermail/gcc/2021-November/237703.html\n\n2022-02-16 Arthur Cohen <arthur.cohen@embecosm.com>\n\ngcc/c-family/\n\n\t* c-common.cc (c_family_tests): Call the new tests.\n\t* c-common.h (c_diagnostic_tests): Declare.\n\t(c_opt_problem_cc_tests): Likewise.\n\ngcc/\n\t* diagnostic.cc (diagnostic_cc_tests): Rename to...\n\t(c_diagnostic_cc_tests): ...this.\n\t* opt-problem.cc (opt_problem_cc_tests): Rename to...\n\t(c_opt_problem_cc_tests): ...this.\n\t* selftest-run-tests.cc (selftest::run_tests): No longer run\n\topt_problem_cc_tests or diagnostic_cc_tests.\n\t* selftest.h (diagnostic_cc_tests): Remove declaration.\n\t(opt_problem_cc_tests): Likewise.", "tree": {"sha": "adcaf436c846d672e130cbedcd22e1c9668f7ffd", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/adcaf436c846d672e130cbedcd22e1c9668f7ffd"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/981524428b21bf6935f8f9a3b8394d5504f4f0fc", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/981524428b21bf6935f8f9a3b8394d5504f4f0fc", "html_url": "https://github.com/Rust-GCC/gccrs/commit/981524428b21bf6935f8f9a3b8394d5504f4f0fc", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/981524428b21bf6935f8f9a3b8394d5504f4f0fc/comments", "author": {"login": "CohenArthur", "id": 43524065, "node_id": "MDQ6VXNlcjQzNTI0MDY1", "avatar_url": "https://avatars.githubusercontent.com/u/43524065?v=4", "gravatar_id": "", "url": "https://api.github.com/users/CohenArthur", "html_url": "https://github.com/CohenArthur", "followers_url": "https://api.github.com/users/CohenArthur/followers", "following_url": "https://api.github.com/users/CohenArthur/following{/other_user}", "gists_url": "https://api.github.com/users/CohenArthur/gists{/gist_id}", "starred_url": "https://api.github.com/users/CohenArthur/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/CohenArthur/subscriptions", "organizations_url": "https://api.github.com/users/CohenArthur/orgs", "repos_url": "https://api.github.com/users/CohenArthur/repos", "events_url": "https://api.github.com/users/CohenArthur/events{/privacy}", "received_events_url": "https://api.github.com/users/CohenArthur/received_events", "type": "User", "site_admin": false}, "committer": {"login": "JeffreyALaw", "id": 14062506, "node_id": "MDQ6VXNlcjE0MDYyNTA2", "avatar_url": "https://avatars.githubusercontent.com/u/14062506?v=4", "gravatar_id": "", "url": "https://api.github.com/users/JeffreyALaw", "html_url": "https://github.com/JeffreyALaw", "followers_url": "https://api.github.com/users/JeffreyALaw/followers", "following_url": "https://api.github.com/users/JeffreyALaw/following{/other_user}", "gists_url": "https://api.github.com/users/JeffreyALaw/gists{/gist_id}", "starred_url": "https://api.github.com/users/JeffreyALaw/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/JeffreyALaw/subscriptions", "organizations_url": "https://api.github.com/users/JeffreyALaw/orgs", "repos_url": "https://api.github.com/users/JeffreyALaw/repos", "events_url": "https://api.github.com/users/JeffreyALaw/events{/privacy}", "received_events_url": "https://api.github.com/users/JeffreyALaw/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "bc84b61b00792ef38e1c2cd6b7280087e4fd2b57", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/bc84b61b00792ef38e1c2cd6b7280087e4fd2b57", "html_url": "https://github.com/Rust-GCC/gccrs/commit/bc84b61b00792ef38e1c2cd6b7280087e4fd2b57"}], "stats": {"total": 12, "additions": 6, "deletions": 6}, "files": [{"sha": "d034837bb5bb7ad82967c4f4751b3df73541323e", "filename": "gcc/c-family/c-common.cc", "status": "modified", "additions": 2, "deletions": 0, "changes": 2, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/981524428b21bf6935f8f9a3b8394d5504f4f0fc/gcc%2Fc-family%2Fc-common.cc", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/981524428b21bf6935f8f9a3b8394d5504f4f0fc/gcc%2Fc-family%2Fc-common.cc", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fc-family%2Fc-common.cc?ref=981524428b21bf6935f8f9a3b8394d5504f4f0fc", "patch": "@@ -9120,6 +9120,8 @@ c_family_tests (void)\n   c_indentation_cc_tests ();\n   c_pretty_print_cc_tests ();\n   c_spellcheck_cc_tests ();\n+  c_diagnostic_cc_tests ();\n+  c_opt_problem_cc_tests ();\n }\n \n } // namespace selftest"}, {"sha": "52a85bfb78308fa7d703bd7f1c03639197e331ce", "filename": "gcc/c-family/c-common.h", "status": "modified", "additions": 2, "deletions": 0, "changes": 2, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/981524428b21bf6935f8f9a3b8394d5504f4f0fc/gcc%2Fc-family%2Fc-common.h", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/981524428b21bf6935f8f9a3b8394d5504f4f0fc/gcc%2Fc-family%2Fc-common.h", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fc-family%2Fc-common.h?ref=981524428b21bf6935f8f9a3b8394d5504f4f0fc", "patch": "@@ -1512,8 +1512,10 @@ extern tree braced_lists_to_strings (tree, tree);\n namespace selftest {\n   /* Declarations for specific families of tests within c-family,\n      by source file, in alphabetical order.  */\n+  extern void c_diagnostic_cc_tests (void);\n   extern void c_format_cc_tests (void);\n   extern void c_indentation_cc_tests (void);\n+  extern void c_opt_problem_cc_tests (void);\n   extern void c_pretty_print_cc_tests (void);\n   extern void c_spellcheck_cc_tests (void);\n "}, {"sha": "73324a728fe550619c2345e3ecdb0fd40b6eb257", "filename": "gcc/diagnostic.cc", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/981524428b21bf6935f8f9a3b8394d5504f4f0fc/gcc%2Fdiagnostic.cc", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/981524428b21bf6935f8f9a3b8394d5504f4f0fc/gcc%2Fdiagnostic.cc", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fdiagnostic.cc?ref=981524428b21bf6935f8f9a3b8394d5504f4f0fc", "patch": "@@ -2472,7 +2472,7 @@ test_num_digits ()\n /* Run all of the selftests within this file.  */\n \n void\n-diagnostic_cc_tests ()\n+c_diagnostic_cc_tests ()\n {\n   test_print_escaped_string ();\n   test_print_parseable_fixits_none ();"}, {"sha": "11fec57d6791d25b58553e7b9e21bdf1a924c0ac", "filename": "gcc/opt-problem.cc", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/981524428b21bf6935f8f9a3b8394d5504f4f0fc/gcc%2Fopt-problem.cc", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/981524428b21bf6935f8f9a3b8394d5504f4f0fc/gcc%2Fopt-problem.cc", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fopt-problem.cc?ref=981524428b21bf6935f8f9a3b8394d5504f4f0fc", "patch": "@@ -324,7 +324,7 @@ test_opt_result_failure_at (const line_table_case &case_)\n /* Run all of the selftests within this file.  */\n \n void\n-opt_problem_cc_tests ()\n+c_opt_problem_cc_tests ()\n {\n   test_opt_result_success ();\n   for_each_line_table_case (test_opt_result_failure_at);"}, {"sha": "d59e0aeddee24d4c657d05fe26928f479b05aabe", "filename": "gcc/selftest-run-tests.cc", "status": "modified", "additions": 0, "deletions": 2, "changes": 2, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/981524428b21bf6935f8f9a3b8394d5504f4f0fc/gcc%2Fselftest-run-tests.cc", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/981524428b21bf6935f8f9a3b8394d5504f4f0fc/gcc%2Fselftest-run-tests.cc", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fselftest-run-tests.cc?ref=981524428b21bf6935f8f9a3b8394d5504f4f0fc", "patch": "@@ -76,7 +76,6 @@ selftest::run_tests ()\n   json_cc_tests ();\n   cgraph_cc_tests ();\n   optinfo_emit_json_cc_tests ();\n-  opt_problem_cc_tests ();\n   ordered_hash_map_tests_cc_tests ();\n   splay_tree_cc_tests ();\n \n@@ -95,7 +94,6 @@ selftest::run_tests ()\n   /* Higher-level tests, or for components that other selftests don't\n      rely on.  */\n   diagnostic_show_locus_cc_tests ();\n-  diagnostic_cc_tests ();\n   diagnostic_format_json_cc_tests ();\n   edit_context_cc_tests ();\n   fold_const_cc_tests ();"}, {"sha": "7568a6d24d499fdb474b8dc5ff46e8b0fc44d896", "filename": "gcc/selftest.h", "status": "modified", "additions": 0, "deletions": 2, "changes": 2, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/981524428b21bf6935f8f9a3b8394d5504f4f0fc/gcc%2Fselftest.h", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/981524428b21bf6935f8f9a3b8394d5504f4f0fc/gcc%2Fselftest.h", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fselftest.h?ref=981524428b21bf6935f8f9a3b8394d5504f4f0fc", "patch": "@@ -222,7 +222,6 @@ extern void attribs_cc_tests ();\n extern void bitmap_cc_tests ();\n extern void cgraph_cc_tests ();\n extern void convert_cc_tests ();\n-extern void diagnostic_cc_tests ();\n extern void diagnostic_format_json_cc_tests ();\n extern void diagnostic_show_locus_cc_tests ();\n extern void digraph_cc_tests ();\n@@ -238,7 +237,6 @@ extern void hash_map_tests_cc_tests ();\n extern void hash_set_tests_cc_tests ();\n extern void input_cc_tests ();\n extern void json_cc_tests ();\n-extern void opt_problem_cc_tests ();\n extern void optinfo_emit_json_cc_tests ();\n extern void opts_cc_tests ();\n extern void ordered_hash_map_tests_cc_tests ();"}]}