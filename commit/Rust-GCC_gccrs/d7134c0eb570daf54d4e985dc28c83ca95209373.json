{"sha": "d7134c0eb570daf54d4e985dc28c83ca95209373", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6ZDcxMzRjMGViNTcwZGFmNTRkNGU5ODVkYzI4YzgzY2E5NTIwOTM3Mw==", "commit": {"author": {"name": "Jan-Benedict Glaw", "email": "jbglaw@lug-owl.de", "date": "2014-11-16T14:07:13Z"}, "committer": {"name": "Jan-Benedict Glaw", "email": "jbglaw@gcc.gnu.org", "date": "2014-11-16T14:07:13Z"}, "message": "Update from upstream Automake files.\n\n2014-11-16  Jan-Benedict Glaw  <jbglaw@lug-owl.de>\n\n\t* compile: Sync with upstream Automake.\n\t* depcomp: Ditto.\n\t* install-sh: Ditto.\n\t* missing: Ditto.\n\t* mkinstalldirs: Ditto.\n\t* ylwrap: Ditto.\n\nFrom-SVN: r217627", "tree": {"sha": "c86c7202ec5a8b407c3bd7380270e6f5514179aa", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/c86c7202ec5a8b407c3bd7380270e6f5514179aa"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/d7134c0eb570daf54d4e985dc28c83ca95209373", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/d7134c0eb570daf54d4e985dc28c83ca95209373", "html_url": "https://github.com/Rust-GCC/gccrs/commit/d7134c0eb570daf54d4e985dc28c83ca95209373", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/d7134c0eb570daf54d4e985dc28c83ca95209373/comments", "author": {"login": "jbglaw", "id": 7965297, "node_id": "MDQ6VXNlcjc5NjUyOTc=", "avatar_url": "https://avatars.githubusercontent.com/u/7965297?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jbglaw", "html_url": "https://github.com/jbglaw", "followers_url": "https://api.github.com/users/jbglaw/followers", "following_url": "https://api.github.com/users/jbglaw/following{/other_user}", "gists_url": "https://api.github.com/users/jbglaw/gists{/gist_id}", "starred_url": "https://api.github.com/users/jbglaw/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jbglaw/subscriptions", "organizations_url": "https://api.github.com/users/jbglaw/orgs", "repos_url": "https://api.github.com/users/jbglaw/repos", "events_url": "https://api.github.com/users/jbglaw/events{/privacy}", "received_events_url": "https://api.github.com/users/jbglaw/received_events", "type": "User", "site_admin": false}, "committer": null, "parents": [{"sha": "6f23a2d08903c793134a3dedf18a34d36ce6c78d", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/6f23a2d08903c793134a3dedf18a34d36ce6c78d", "html_url": "https://github.com/Rust-GCC/gccrs/commit/6f23a2d08903c793134a3dedf18a34d36ce6c78d"}], "stats": {"total": 1841, "additions": 1005, "deletions": 836}, "files": [{"sha": "d5cbe4e17fe35b9eb84c2d37322859ed54710f58", "filename": "ChangeLog", "status": "modified", "additions": 9, "deletions": 0, "changes": 9, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/d7134c0eb570daf54d4e985dc28c83ca95209373/ChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/d7134c0eb570daf54d4e985dc28c83ca95209373/ChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/ChangeLog?ref=d7134c0eb570daf54d4e985dc28c83ca95209373", "patch": "@@ -1,3 +1,12 @@\n+2014-11-16  Jan-Benedict Glaw  <jbglaw@lug-owl.de>\n+\n+\t* compile: Sync with upstream Automake.\n+\t* depcomp: Ditto.\n+\t* install-sh: Ditto.\n+\t* missing: Ditto.\n+\t* mkinstalldirs: Ditto.\n+\t* ylwrap: Ditto.\n+\n 2014-11-16  Jan-Benedict Glaw  <jbglaw@lug-owl.de>\n \n \t* config.sub: Update from upstream config repo."}, {"sha": "a85b723c7e67d46316e85e7422bd5088e9136042", "filename": "compile", "status": "modified", "additions": 220, "deletions": 16, "changes": 236, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/d7134c0eb570daf54d4e985dc28c83ca95209373/compile", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/d7134c0eb570daf54d4e985dc28c83ca95209373/compile", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/compile?ref=d7134c0eb570daf54d4e985dc28c83ca95209373", "patch": "@@ -1,10 +1,9 @@\n #! /bin/sh\n-# Wrapper for compilers which do not understand `-c -o'.\n+# Wrapper for compilers which do not understand '-c -o'.\n \n-scriptversion=2009-04-28.21; # UTC\n+scriptversion=2012-10-14.11; # UTC\n \n-# Copyright (C) 1999, 2000, 2003, 2004, 2005, 2009  Free Software\n-# Foundation, Inc.\n+# Copyright (C) 1999-2014 Free Software Foundation, Inc.\n # Written by Tom Tromey <tromey@cygnus.com>.\n #\n # This program is free software; you can redistribute it and/or modify\n@@ -29,21 +28,224 @@ scriptversion=2009-04-28.21; # UTC\n # bugs to <bug-automake@gnu.org> or send patches to\n # <automake-patches@gnu.org>.\n \n+nl='\n+'\n+\n+# We need space, tab and new line, in precisely that order.  Quoting is\n+# there to prevent tools from complaining about whitespace usage.\n+IFS=\" \"\"\t$nl\"\n+\n+file_conv=\n+\n+# func_file_conv build_file lazy\n+# Convert a $build file to $host form and store it in $file\n+# Currently only supports Windows hosts. If the determined conversion\n+# type is listed in (the comma separated) LAZY, no conversion will\n+# take place.\n+func_file_conv ()\n+{\n+  file=$1\n+  case $file in\n+    / | /[!/]*) # absolute file, and not a UNC file\n+      if test -z \"$file_conv\"; then\n+\t# lazily determine how to convert abs files\n+\tcase `uname -s` in\n+\t  MINGW*)\n+\t    file_conv=mingw\n+\t    ;;\n+\t  CYGWIN*)\n+\t    file_conv=cygwin\n+\t    ;;\n+\t  *)\n+\t    file_conv=wine\n+\t    ;;\n+\tesac\n+      fi\n+      case $file_conv/,$2, in\n+\t*,$file_conv,*)\n+\t  ;;\n+\tmingw/*)\n+\t  file=`cmd //C echo \"$file \" | sed -e 's/\"\\(.*\\) \" *$/\\1/'`\n+\t  ;;\n+\tcygwin/*)\n+\t  file=`cygpath -m \"$file\" || echo \"$file\"`\n+\t  ;;\n+\twine/*)\n+\t  file=`winepath -w \"$file\" || echo \"$file\"`\n+\t  ;;\n+      esac\n+      ;;\n+  esac\n+}\n+\n+# func_cl_dashL linkdir\n+# Make cl look for libraries in LINKDIR\n+func_cl_dashL ()\n+{\n+  func_file_conv \"$1\"\n+  if test -z \"$lib_path\"; then\n+    lib_path=$file\n+  else\n+    lib_path=\"$lib_path;$file\"\n+  fi\n+  linker_opts=\"$linker_opts -LIBPATH:$file\"\n+}\n+\n+# func_cl_dashl library\n+# Do a library search-path lookup for cl\n+func_cl_dashl ()\n+{\n+  lib=$1\n+  found=no\n+  save_IFS=$IFS\n+  IFS=';'\n+  for dir in $lib_path $LIB\n+  do\n+    IFS=$save_IFS\n+    if $shared && test -f \"$dir/$lib.dll.lib\"; then\n+      found=yes\n+      lib=$dir/$lib.dll.lib\n+      break\n+    fi\n+    if test -f \"$dir/$lib.lib\"; then\n+      found=yes\n+      lib=$dir/$lib.lib\n+      break\n+    fi\n+    if test -f \"$dir/lib$lib.a\"; then\n+      found=yes\n+      lib=$dir/lib$lib.a\n+      break\n+    fi\n+  done\n+  IFS=$save_IFS\n+\n+  if test \"$found\" != yes; then\n+    lib=$lib.lib\n+  fi\n+}\n+\n+# func_cl_wrapper cl arg...\n+# Adjust compile command to suit cl\n+func_cl_wrapper ()\n+{\n+  # Assume a capable shell\n+  lib_path=\n+  shared=:\n+  linker_opts=\n+  for arg\n+  do\n+    if test -n \"$eat\"; then\n+      eat=\n+    else\n+      case $1 in\n+\t-o)\n+\t  # configure might choose to run compile as 'compile cc -o foo foo.c'.\n+\t  eat=1\n+\t  case $2 in\n+\t    *.o | *.[oO][bB][jJ])\n+\t      func_file_conv \"$2\"\n+\t      set x \"$@\" -Fo\"$file\"\n+\t      shift\n+\t      ;;\n+\t    *)\n+\t      func_file_conv \"$2\"\n+\t      set x \"$@\" -Fe\"$file\"\n+\t      shift\n+\t      ;;\n+\t  esac\n+\t  ;;\n+\t-I)\n+\t  eat=1\n+\t  func_file_conv \"$2\" mingw\n+\t  set x \"$@\" -I\"$file\"\n+\t  shift\n+\t  ;;\n+\t-I*)\n+\t  func_file_conv \"${1#-I}\" mingw\n+\t  set x \"$@\" -I\"$file\"\n+\t  shift\n+\t  ;;\n+\t-l)\n+\t  eat=1\n+\t  func_cl_dashl \"$2\"\n+\t  set x \"$@\" \"$lib\"\n+\t  shift\n+\t  ;;\n+\t-l*)\n+\t  func_cl_dashl \"${1#-l}\"\n+\t  set x \"$@\" \"$lib\"\n+\t  shift\n+\t  ;;\n+\t-L)\n+\t  eat=1\n+\t  func_cl_dashL \"$2\"\n+\t  ;;\n+\t-L*)\n+\t  func_cl_dashL \"${1#-L}\"\n+\t  ;;\n+\t-static)\n+\t  shared=false\n+\t  ;;\n+\t-Wl,*)\n+\t  arg=${1#-Wl,}\n+\t  save_ifs=\"$IFS\"; IFS=','\n+\t  for flag in $arg; do\n+\t    IFS=\"$save_ifs\"\n+\t    linker_opts=\"$linker_opts $flag\"\n+\t  done\n+\t  IFS=\"$save_ifs\"\n+\t  ;;\n+\t-Xlinker)\n+\t  eat=1\n+\t  linker_opts=\"$linker_opts $2\"\n+\t  ;;\n+\t-*)\n+\t  set x \"$@\" \"$1\"\n+\t  shift\n+\t  ;;\n+\t*.cc | *.CC | *.cxx | *.CXX | *.[cC]++)\n+\t  func_file_conv \"$1\"\n+\t  set x \"$@\" -Tp\"$file\"\n+\t  shift\n+\t  ;;\n+\t*.c | *.cpp | *.CPP | *.lib | *.LIB | *.Lib | *.OBJ | *.obj | *.[oO])\n+\t  func_file_conv \"$1\" mingw\n+\t  set x \"$@\" \"$file\"\n+\t  shift\n+\t  ;;\n+\t*)\n+\t  set x \"$@\" \"$1\"\n+\t  shift\n+\t  ;;\n+      esac\n+    fi\n+    shift\n+  done\n+  if test -n \"$linker_opts\"; then\n+    linker_opts=\"-link$linker_opts\"\n+  fi\n+  exec \"$@\" $linker_opts\n+  exit 1\n+}\n+\n+eat=\n+\n case $1 in\n   '')\n-     echo \"$0: No command.  Try \\`$0 --help' for more information.\" 1>&2\n+     echo \"$0: No command.  Try '$0 --help' for more information.\" 1>&2\n      exit 1;\n      ;;\n   -h | --h*)\n     cat <<\\EOF\n Usage: compile [--help] [--version] PROGRAM [ARGS]\n \n-Wrapper for compilers which do not understand `-c -o'.\n-Remove `-o dest.o' from ARGS, run PROGRAM with the remaining\n+Wrapper for compilers which do not understand '-c -o'.\n+Remove '-o dest.o' from ARGS, run PROGRAM with the remaining\n arguments, and rename the output as expected.\n \n If you are trying to build a whole package this is not the\n-right script to run: please start by reading the file `INSTALL'.\n+right script to run: please start by reading the file 'INSTALL'.\n \n Report bugs to <bug-automake@gnu.org>.\n EOF\n@@ -53,11 +255,13 @@ EOF\n     echo \"compile $scriptversion\"\n     exit $?\n     ;;\n+  cl | *[/\\\\]cl | cl.exe | *[/\\\\]cl.exe )\n+    func_cl_wrapper \"$@\"      # Doesn't return...\n+    ;;\n esac\n \n ofile=\n cfile=\n-eat=\n \n for arg\n do\n@@ -66,8 +270,8 @@ do\n   else\n     case $1 in\n       -o)\n-\t# configure might choose to run compile as `compile cc -o foo foo.c'.\n-\t# So we strip `-o arg' only if arg is an object.\n+\t# configure might choose to run compile as 'compile cc -o foo foo.c'.\n+\t# So we strip '-o arg' only if arg is an object.\n \teat=1\n \tcase $2 in\n \t  *.o | *.obj)\n@@ -94,10 +298,10 @@ do\n done\n \n if test -z \"$ofile\" || test -z \"$cfile\"; then\n-  # If no `-o' option was seen then we might have been invoked from a\n+  # If no '-o' option was seen then we might have been invoked from a\n   # pattern rule where we don't need one.  That is ok -- this is a\n   # normal compilation that the losing compiler can handle.  If no\n-  # `.c' file was seen then we are probably linking.  That is also\n+  # '.c' file was seen then we are probably linking.  That is also\n   # ok.\n   exec \"$@\"\n fi\n@@ -106,7 +310,7 @@ fi\n cofile=`echo \"$cfile\" | sed 's|^.*[\\\\/]||; s|^[a-zA-Z]:||; s/\\.c$/.o/'`\n \n # Create the lock directory.\n-# Note: use `[/\\\\:.-]' here to ensure that we don't use the same name\n+# Note: use '[/\\\\:.-]' here to ensure that we don't use the same name\n # that we are using for the .o file.  Also, base the name on the expected\n # object file name, since that is what matters with a parallel build.\n lockdir=`echo \"$cofile\" | sed -e 's|[/\\\\:.-]|_|g'`.d\n@@ -124,9 +328,9 @@ trap \"rmdir '$lockdir'; exit 1\" 1 2 15\n ret=$?\n \n if test -f \"$cofile\"; then\n-  mv \"$cofile\" \"$ofile\"\n+  test \"$cofile\" = \"$ofile\" || mv \"$cofile\" \"$ofile\"\n elif test -f \"${cofile}bj\"; then\n-  mv \"${cofile}bj\" \"$ofile\"\n+  test \"${cofile}bj\" = \"$ofile\" || mv \"${cofile}bj\" \"$ofile\"\n fi\n \n rmdir \"$lockdir\""}, {"sha": "4e70ff0bbcfa0af15376b94f83b72cdfd3ab3c02", "filename": "depcomp", "status": "modified", "additions": 335, "deletions": 209, "changes": 544, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/d7134c0eb570daf54d4e985dc28c83ca95209373/depcomp", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/d7134c0eb570daf54d4e985dc28c83ca95209373/depcomp", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/depcomp?ref=d7134c0eb570daf54d4e985dc28c83ca95209373", "patch": "@@ -1,10 +1,9 @@\n #! /bin/sh\n # depcomp - compile a program generating dependencies as side-effects\n \n-scriptversion=2009-04-28.21; # UTC\n+scriptversion=2013-05-30.07; # UTC\n \n-# Copyright (C) 1999, 2000, 2003, 2004, 2005, 2006, 2007, 2009 Free\n-# Software Foundation, Inc.\n+# Copyright (C) 1999-2014 Free Software Foundation, Inc.\n \n # This program is free software; you can redistribute it and/or modify\n # it under the terms of the GNU General Public License as published by\n@@ -28,9 +27,9 @@ scriptversion=2009-04-28.21; # UTC\n \n case $1 in\n   '')\n-     echo \"$0: No command.  Try \\`$0 --help' for more information.\" 1>&2\n-     exit 1;\n-     ;;\n+    echo \"$0: No command.  Try '$0 --help' for more information.\" 1>&2\n+    exit 1;\n+    ;;\n   -h | --h*)\n     cat <<\\EOF\n Usage: depcomp [--help] [--version] PROGRAM [ARGS]\n@@ -40,11 +39,11 @@ as side-effects.\n \n Environment variables:\n   depmode     Dependency tracking mode.\n-  source      Source file read by `PROGRAMS ARGS'.\n-  object      Object file output by `PROGRAMS ARGS'.\n+  source      Source file read by 'PROGRAMS ARGS'.\n+  object      Object file output by 'PROGRAMS ARGS'.\n   DEPDIR      directory where to store dependencies.\n   depfile     Dependency file to output.\n-  tmpdepfile  Temporary file to use when outputing dependencies.\n+  tmpdepfile  Temporary file to use when outputting dependencies.\n   libtool     Whether libtool is used (yes/no).\n \n Report bugs to <bug-automake@gnu.org>.\n@@ -57,6 +56,66 @@ EOF\n     ;;\n esac\n \n+# Get the directory component of the given path, and save it in the\n+# global variables '$dir'.  Note that this directory component will\n+# be either empty or ending with a '/' character.  This is deliberate.\n+set_dir_from ()\n+{\n+  case $1 in\n+    */*) dir=`echo \"$1\" | sed -e 's|/[^/]*$|/|'`;;\n+      *) dir=;;\n+  esac\n+}\n+\n+# Get the suffix-stripped basename of the given path, and save it the\n+# global variable '$base'.\n+set_base_from ()\n+{\n+  base=`echo \"$1\" | sed -e 's|^.*/||' -e 's/\\.[^.]*$//'`\n+}\n+\n+# If no dependency file was actually created by the compiler invocation,\n+# we still have to create a dummy depfile, to avoid errors with the\n+# Makefile \"include basename.Plo\" scheme.\n+make_dummy_depfile ()\n+{\n+  echo \"#dummy\" > \"$depfile\"\n+}\n+\n+# Factor out some common post-processing of the generated depfile.\n+# Requires the auxiliary global variable '$tmpdepfile' to be set.\n+aix_post_process_depfile ()\n+{\n+  # If the compiler actually managed to produce a dependency file,\n+  # post-process it.\n+  if test -f \"$tmpdepfile\"; then\n+    # Each line is of the form 'foo.o: dependency.h'.\n+    # Do two passes, one to just change these to\n+    #   $object: dependency.h\n+    # and one to simply output\n+    #   dependency.h:\n+    # which is needed to avoid the deleted-header problem.\n+    { sed -e \"s,^.*\\.[$lower]*:,$object:,\" < \"$tmpdepfile\"\n+      sed -e \"s,^.*\\.[$lower]*:[$tab ]*,,\" -e 's,$,:,' < \"$tmpdepfile\"\n+    } > \"$depfile\"\n+    rm -f \"$tmpdepfile\"\n+  else\n+    make_dummy_depfile\n+  fi\n+}\n+\n+# A tabulation character.\n+tab='\t'\n+# A newline character.\n+nl='\n+'\n+# Character ranges might be problematic outside the C locale.\n+# These definitions help.\n+upper=ABCDEFGHIJKLMNOPQRSTUVWXYZ\n+lower=abcdefghijklmnopqrstuvwxyz\n+digits=0123456789\n+alpha=${upper}${lower}\n+\n if test -z \"$depmode\" || test -z \"$source\" || test -z \"$object\"; then\n   echo \"depcomp: Variables source, object and depmode must be set\" 1>&2\n   exit 1\n@@ -69,6 +128,9 @@ tmpdepfile=${tmpdepfile-`echo \"$depfile\" | sed 's/\\.\\([^.]*\\)$/.T\\1/'`}\n \n rm -f \"$tmpdepfile\"\n \n+# Avoid interferences from the environment.\n+gccflag= dashmflag=\n+\n # Some modes work just like other modes, but use different flags.  We\n # parameterize here, but still list the modes in the big case below,\n # to make depend.m4 easier to write.  Note that we *cannot* use a case\n@@ -80,18 +142,32 @@ if test \"$depmode\" = hp; then\n fi\n \n if test \"$depmode\" = dashXmstdout; then\n-   # This is just like dashmstdout with a different argument.\n-   dashmflag=-xM\n-   depmode=dashmstdout\n+  # This is just like dashmstdout with a different argument.\n+  dashmflag=-xM\n+  depmode=dashmstdout\n fi\n \n cygpath_u=\"cygpath -u -f -\"\n if test \"$depmode\" = msvcmsys; then\n-   # This is just like msvisualcpp but w/o cygpath translation.\n-   # Just convert the backslash-escaped backslashes to single forward\n-   # slashes to satisfy depend.m4\n-   cygpath_u=\"sed s,\\\\\\\\\\\\\\\\,/,g\"\n-   depmode=msvisualcpp\n+  # This is just like msvisualcpp but w/o cygpath translation.\n+  # Just convert the backslash-escaped backslashes to single forward\n+  # slashes to satisfy depend.m4\n+  cygpath_u='sed s,\\\\\\\\,/,g'\n+  depmode=msvisualcpp\n+fi\n+\n+if test \"$depmode\" = msvc7msys; then\n+  # This is just like msvc7 but w/o cygpath translation.\n+  # Just convert the backslash-escaped backslashes to single forward\n+  # slashes to satisfy depend.m4\n+  cygpath_u='sed s,\\\\\\\\,/,g'\n+  depmode=msvc7\n+fi\n+\n+if test \"$depmode\" = xlc; then\n+  # IBM C/C++ Compilers xlc/xlC can output gcc-like dependency information.\n+  gccflag=-qmakedep=gcc,-MF\n+  depmode=gcc\n fi\n \n case \"$depmode\" in\n@@ -114,54 +190,57 @@ gcc3)\n   done\n   \"$@\"\n   stat=$?\n-  if test $stat -eq 0; then :\n-  else\n+  if test $stat -ne 0; then\n     rm -f \"$tmpdepfile\"\n     exit $stat\n   fi\n   mv \"$tmpdepfile\" \"$depfile\"\n   ;;\n \n gcc)\n+## Note that this doesn't just cater to obsosete pre-3.x GCC compilers.\n+## but also to in-use compilers like IMB xlc/xlC and the HP C compiler.\n+## (see the conditional assignment to $gccflag above).\n ## There are various ways to get dependency output from gcc.  Here's\n ## why we pick this rather obscure method:\n ## - Don't want to use -MD because we'd like the dependencies to end\n ##   up in a subdir.  Having to rename by hand is ugly.\n ##   (We might end up doing this anyway to support other compilers.)\n ## - The DEPENDENCIES_OUTPUT environment variable makes gcc act like\n-##   -MM, not -M (despite what the docs say).\n+##   -MM, not -M (despite what the docs say).  Also, it might not be\n+##   supported by the other compilers which use the 'gcc' depmode.\n ## - Using -M directly means running the compiler twice (even worse\n ##   than renaming).\n   if test -z \"$gccflag\"; then\n     gccflag=-MD,\n   fi\n   \"$@\" -Wp,\"$gccflag$tmpdepfile\"\n   stat=$?\n-  if test $stat -eq 0; then :\n-  else\n+  if test $stat -ne 0; then\n     rm -f \"$tmpdepfile\"\n     exit $stat\n   fi\n   rm -f \"$depfile\"\n   echo \"$object : \\\\\" > \"$depfile\"\n-  alpha=ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz\n-## The second -e expression handles DOS-style file names with drive letters.\n+  # The second -e expression handles DOS-style file names with drive\n+  # letters.\n   sed -e 's/^[^:]*: / /' \\\n       -e 's/^['$alpha']:\\/[^:]*: / /' < \"$tmpdepfile\" >> \"$depfile\"\n-## This next piece of magic avoids the `deleted header file' problem.\n+## This next piece of magic avoids the \"deleted header file\" problem.\n ## The problem is that when a header file which appears in a .P file\n ## is deleted, the dependency causes make to die (because there is\n ## typically no way to rebuild the header).  We avoid this by adding\n ## dummy dependencies for each header file.  Too bad gcc doesn't do\n ## this for us directly.\n-  tr ' ' '\n-' < \"$tmpdepfile\" |\n-## Some versions of gcc put a space before the `:'.  On the theory\n+## Some versions of gcc put a space before the ':'.  On the theory\n ## that the space means something, we add a space to the output as\n-## well.\n+## well.  hp depmode also adds that space, but also prefixes the VPATH\n+## to the object.  Take care to not repeat it in the output.\n ## Some versions of the HPUX 10.20 sed can't process this invocation\n ## correctly.  Breaking it into two sed invocations is a workaround.\n-    sed -e 's/^\\\\$//' -e '/^$/d' -e '/:$/d' | sed -e 's/$/ :/' >> \"$depfile\"\n+  tr ' ' \"$nl\" < \"$tmpdepfile\" \\\n+    | sed -e 's/^\\\\$//' -e '/^$/d' -e \"s|.*$object$||\" -e '/:$/d' \\\n+    | sed -e 's/$/ :/' >> \"$depfile\"\n   rm -f \"$tmpdepfile\"\n   ;;\n \n@@ -172,59 +251,21 @@ hp)\n   exit 1\n   ;;\n \n-sgi)\n-  if test \"$libtool\" = yes; then\n-    \"$@\" \"-Wp,-MDupdate,$tmpdepfile\"\n-  else\n-    \"$@\" -MDupdate \"$tmpdepfile\"\n-  fi\n-  stat=$?\n-  if test $stat -eq 0; then :\n-  else\n-    rm -f \"$tmpdepfile\"\n-    exit $stat\n-  fi\n-  rm -f \"$depfile\"\n-\n-  if test -f \"$tmpdepfile\"; then  # yes, the sourcefile depend on other files\n-    echo \"$object : \\\\\" > \"$depfile\"\n-\n-    # Clip off the initial element (the dependent).  Don't try to be\n-    # clever and replace this with sed code, as IRIX sed won't handle\n-    # lines with more than a fixed number of characters (4096 in\n-    # IRIX 6.2 sed, 8192 in IRIX 6.5).  We also remove comment lines;\n-    # the IRIX cc adds comments like `#:fec' to the end of the\n-    # dependency line.\n-    tr ' ' '\n-' < \"$tmpdepfile\" \\\n-    | sed -e 's/^.*\\.o://' -e 's/#.*$//' -e '/^$/ d' | \\\n-    tr '\n-' ' ' >> \"$depfile\"\n-    echo >> \"$depfile\"\n-\n-    # The second pass generates a dummy entry for each header file.\n-    tr ' ' '\n-' < \"$tmpdepfile\" \\\n-   | sed -e 's/^.*\\.o://' -e 's/#.*$//' -e '/^$/ d' -e 's/$/:/' \\\n-   >> \"$depfile\"\n-  else\n-    # The sourcefile does not contain any dependencies, so just\n-    # store a dummy comment line, to avoid errors with the Makefile\n-    # \"include basename.Plo\" scheme.\n-    echo \"#dummy\" > \"$depfile\"\n-  fi\n-  rm -f \"$tmpdepfile\"\n+xlc)\n+  # This case exists only to let depend.m4 do its work.  It works by\n+  # looking at the text of this script.  This case will never be run,\n+  # since it is checked for above.\n+  exit 1\n   ;;\n \n aix)\n   # The C for AIX Compiler uses -M and outputs the dependencies\n   # in a .u file.  In older versions, this file always lives in the\n-  # current directory.  Also, the AIX compiler puts `$object:' at the\n+  # current directory.  Also, the AIX compiler puts '$object:' at the\n   # start of each line; $object doesn't have directory information.\n   # Version 6 uses the directory in both cases.\n-  dir=`echo \"$object\" | sed -e 's|/[^/]*$|/|'`\n-  test \"x$dir\" = \"x$object\" && dir=\n-  base=`echo \"$object\" | sed -e 's|^.*/||' -e 's/\\.o$//' -e 's/\\.lo$//'`\n+  set_dir_from \"$object\"\n+  set_base_from \"$object\"\n   if test \"$libtool\" = yes; then\n     tmpdepfile1=$dir$base.u\n     tmpdepfile2=$base.u\n@@ -237,9 +278,7 @@ aix)\n     \"$@\" -M\n   fi\n   stat=$?\n-\n-  if test $stat -eq 0; then :\n-  else\n+  if test $stat -ne 0; then\n     rm -f \"$tmpdepfile1\" \"$tmpdepfile2\" \"$tmpdepfile3\"\n     exit $stat\n   fi\n@@ -248,44 +287,100 @@ aix)\n   do\n     test -f \"$tmpdepfile\" && break\n   done\n-  if test -f \"$tmpdepfile\"; then\n-    # Each line is of the form `foo.o: dependent.h'.\n-    # Do two passes, one to just change these to\n-    # `$object: dependent.h' and one to simply `dependent.h:'.\n-    sed -e \"s,^.*\\.[a-z]*:,$object:,\" < \"$tmpdepfile\" > \"$depfile\"\n-    # That's a tab and a space in the [].\n-    sed -e 's,^.*\\.[a-z]*:[\t ]*,,' -e 's,$,:,' < \"$tmpdepfile\" >> \"$depfile\"\n-  else\n-    # The sourcefile does not contain any dependencies, so just\n-    # store a dummy comment line, to avoid errors with the Makefile\n-    # \"include basename.Plo\" scheme.\n-    echo \"#dummy\" > \"$depfile\"\n+  aix_post_process_depfile\n+  ;;\n+\n+tcc)\n+  # tcc (Tiny C Compiler) understand '-MD -MF file' since version 0.9.26\n+  # FIXME: That version still under development at the moment of writing.\n+  #        Make that this statement remains true also for stable, released\n+  #        versions.\n+  # It will wrap lines (doesn't matter whether long or short) with a\n+  # trailing '\\', as in:\n+  #\n+  #   foo.o : \\\n+  #    foo.c \\\n+  #    foo.h \\\n+  #\n+  # It will put a trailing '\\' even on the last line, and will use leading\n+  # spaces rather than leading tabs (at least since its commit 0394caf7\n+  # \"Emit spaces for -MD\").\n+  \"$@\" -MD -MF \"$tmpdepfile\"\n+  stat=$?\n+  if test $stat -ne 0; then\n+    rm -f \"$tmpdepfile\"\n+    exit $stat\n   fi\n+  rm -f \"$depfile\"\n+  # Each non-empty line is of the form 'foo.o : \\' or ' dep.h \\'.\n+  # We have to change lines of the first kind to '$object: \\'.\n+  sed -e \"s|.*:|$object :|\" < \"$tmpdepfile\" > \"$depfile\"\n+  # And for each line of the second kind, we have to emit a 'dep.h:'\n+  # dummy dependency, to avoid the deleted-header problem.\n+  sed -n -e 's|^  *\\(.*\\) *\\\\$|\\1:|p' < \"$tmpdepfile\" >> \"$depfile\"\n   rm -f \"$tmpdepfile\"\n   ;;\n \n-icc)\n-  # Intel's C compiler understands `-MD -MF file'.  However on\n-  #    icc -MD -MF foo.d -c -o sub/foo.o sub/foo.c\n-  # ICC 7.0 will fill foo.d with something like\n-  #    foo.o: sub/foo.c\n-  #    foo.o: sub/foo.h\n-  # which is wrong.  We want:\n-  #    sub/foo.o: sub/foo.c\n-  #    sub/foo.o: sub/foo.h\n-  #    sub/foo.c:\n-  #    sub/foo.h:\n-  # ICC 7.1 will output\n+## The order of this option in the case statement is important, since the\n+## shell code in configure will try each of these formats in the order\n+## listed in this file.  A plain '-MD' option would be understood by many\n+## compilers, so we must ensure this comes after the gcc and icc options.\n+pgcc)\n+  # Portland's C compiler understands '-MD'.\n+  # Will always output deps to 'file.d' where file is the root name of the\n+  # source file under compilation, even if file resides in a subdirectory.\n+  # The object file name does not affect the name of the '.d' file.\n+  # pgcc 10.2 will output\n   #    foo.o: sub/foo.c sub/foo.h\n-  # and will wrap long lines using \\ :\n+  # and will wrap long lines using '\\' :\n   #    foo.o: sub/foo.c ... \\\n   #     sub/foo.h ... \\\n   #     ...\n+  set_dir_from \"$object\"\n+  # Use the source, not the object, to determine the base name, since\n+  # that's sadly what pgcc will do too.\n+  set_base_from \"$source\"\n+  tmpdepfile=$base.d\n+\n+  # For projects that build the same source file twice into different object\n+  # files, the pgcc approach of using the *source* file root name can cause\n+  # problems in parallel builds.  Use a locking strategy to avoid stomping on\n+  # the same $tmpdepfile.\n+  lockdir=$base.d-lock\n+  trap \"\n+    echo '$0: caught signal, cleaning up...' >&2\n+    rmdir '$lockdir'\n+    exit 1\n+  \" 1 2 13 15\n+  numtries=100\n+  i=$numtries\n+  while test $i -gt 0; do\n+    # mkdir is a portable test-and-set.\n+    if mkdir \"$lockdir\" 2>/dev/null; then\n+      # This process acquired the lock.\n+      \"$@\" -MD\n+      stat=$?\n+      # Release the lock.\n+      rmdir \"$lockdir\"\n+      break\n+    else\n+      # If the lock is being held by a different process, wait\n+      # until the winning process is done or we timeout.\n+      while test -d \"$lockdir\" && test $i -gt 0; do\n+        sleep 1\n+        i=`expr $i - 1`\n+      done\n+    fi\n+    i=`expr $i - 1`\n+  done\n+  trap - 1 2 13 15\n+  if test $i -le 0; then\n+    echo \"$0: failed to acquire lock after $numtries attempts\" >&2\n+    echo \"$0: check lockdir '$lockdir'\" >&2\n+    exit 1\n+  fi\n \n-  \"$@\" -MD -MF \"$tmpdepfile\"\n-  stat=$?\n-  if test $stat -eq 0; then :\n-  else\n+  if test $stat -ne 0; then\n     rm -f \"$tmpdepfile\"\n     exit $stat\n   fi\n@@ -297,8 +392,8 @@ icc)\n   sed \"s,^[^:]*:,$object :,\" < \"$tmpdepfile\" > \"$depfile\"\n   # Some versions of the HPUX 10.20 sed can't process this invocation\n   # correctly.  Breaking it into two sed invocations is a workaround.\n-  sed 's,^[^:]*: \\(.*\\)$,\\1,;s/^\\\\$//;/^$/d;/:$/d' < \"$tmpdepfile\" |\n-    sed -e 's/$/ :/' >> \"$depfile\"\n+  sed 's,^[^:]*: \\(.*\\)$,\\1,;s/^\\\\$//;/^$/d;/:$/d' < \"$tmpdepfile\" \\\n+    | sed -e 's/$/ :/' >> \"$depfile\"\n   rm -f \"$tmpdepfile\"\n   ;;\n \n@@ -309,9 +404,8 @@ hp2)\n   # 'foo.d', which lands next to the object file, wherever that\n   # happens to be.\n   # Much of this is similar to the tru64 case; see comments there.\n-  dir=`echo \"$object\" | sed -e 's|/[^/]*$|/|'`\n-  test \"x$dir\" = \"x$object\" && dir=\n-  base=`echo \"$object\" | sed -e 's|^.*/||' -e 's/\\.o$//' -e 's/\\.lo$//'`\n+  set_dir_from  \"$object\"\n+  set_base_from \"$object\"\n   if test \"$libtool\" = yes; then\n     tmpdepfile1=$dir$base.d\n     tmpdepfile2=$dir.libs/$base.d\n@@ -322,8 +416,7 @@ hp2)\n     \"$@\" +Maked\n   fi\n   stat=$?\n-  if test $stat -eq 0; then :\n-  else\n+  if test $stat -ne 0; then\n      rm -f \"$tmpdepfile1\" \"$tmpdepfile2\"\n      exit $stat\n   fi\n@@ -333,77 +426,107 @@ hp2)\n     test -f \"$tmpdepfile\" && break\n   done\n   if test -f \"$tmpdepfile\"; then\n-    sed -e \"s,^.*\\.[a-z]*:,$object:,\" \"$tmpdepfile\" > \"$depfile\"\n-    # Add `dependent.h:' lines.\n+    sed -e \"s,^.*\\.[$lower]*:,$object:,\" \"$tmpdepfile\" > \"$depfile\"\n+    # Add 'dependent.h:' lines.\n     sed -ne '2,${\n-\t       s/^ *//\n-\t       s/ \\\\*$//\n-\t       s/$/:/\n-\t       p\n-\t     }' \"$tmpdepfile\" >> \"$depfile\"\n+               s/^ *//\n+               s/ \\\\*$//\n+               s/$/:/\n+               p\n+             }' \"$tmpdepfile\" >> \"$depfile\"\n   else\n-    echo \"#dummy\" > \"$depfile\"\n+    make_dummy_depfile\n   fi\n   rm -f \"$tmpdepfile\" \"$tmpdepfile2\"\n   ;;\n \n tru64)\n-   # The Tru64 compiler uses -MD to generate dependencies as a side\n-   # effect.  `cc -MD -o foo.o ...' puts the dependencies into `foo.o.d'.\n-   # At least on Alpha/Redhat 6.1, Compaq CCC V6.2-504 seems to put\n-   # dependencies in `foo.d' instead, so we check for that too.\n-   # Subdirectories are respected.\n-   dir=`echo \"$object\" | sed -e 's|/[^/]*$|/|'`\n-   test \"x$dir\" = \"x$object\" && dir=\n-   base=`echo \"$object\" | sed -e 's|^.*/||' -e 's/\\.o$//' -e 's/\\.lo$//'`\n-\n-   if test \"$libtool\" = yes; then\n-      # With Tru64 cc, shared objects can also be used to make a\n-      # static library.  This mechanism is used in libtool 1.4 series to\n-      # handle both shared and static libraries in a single compilation.\n-      # With libtool 1.4, dependencies were output in $dir.libs/$base.lo.d.\n-      #\n-      # With libtool 1.5 this exception was removed, and libtool now\n-      # generates 2 separate objects for the 2 libraries.  These two\n-      # compilations output dependencies in $dir.libs/$base.o.d and\n-      # in $dir$base.o.d.  We have to check for both files, because\n-      # one of the two compilations can be disabled.  We should prefer\n-      # $dir$base.o.d over $dir.libs/$base.o.d because the latter is\n-      # automatically cleaned when .libs/ is deleted, while ignoring\n-      # the former would cause a distcleancheck panic.\n-      tmpdepfile1=$dir.libs/$base.lo.d   # libtool 1.4\n-      tmpdepfile2=$dir$base.o.d          # libtool 1.5\n-      tmpdepfile3=$dir.libs/$base.o.d    # libtool 1.5\n-      tmpdepfile4=$dir.libs/$base.d      # Compaq CCC V6.2-504\n-      \"$@\" -Wc,-MD\n-   else\n-      tmpdepfile1=$dir$base.o.d\n-      tmpdepfile2=$dir$base.d\n-      tmpdepfile3=$dir$base.d\n-      tmpdepfile4=$dir$base.d\n-      \"$@\" -MD\n-   fi\n-\n-   stat=$?\n-   if test $stat -eq 0; then :\n-   else\n-      rm -f \"$tmpdepfile1\" \"$tmpdepfile2\" \"$tmpdepfile3\" \"$tmpdepfile4\"\n-      exit $stat\n-   fi\n-\n-   for tmpdepfile in \"$tmpdepfile1\" \"$tmpdepfile2\" \"$tmpdepfile3\" \"$tmpdepfile4\"\n-   do\n-     test -f \"$tmpdepfile\" && break\n-   done\n-   if test -f \"$tmpdepfile\"; then\n-      sed -e \"s,^.*\\.[a-z]*:,$object:,\" < \"$tmpdepfile\" > \"$depfile\"\n-      # That's a tab and a space in the [].\n-      sed -e 's,^.*\\.[a-z]*:[\t ]*,,' -e 's,$,:,' < \"$tmpdepfile\" >> \"$depfile\"\n-   else\n-      echo \"#dummy\" > \"$depfile\"\n-   fi\n-   rm -f \"$tmpdepfile\"\n-   ;;\n+  # The Tru64 compiler uses -MD to generate dependencies as a side\n+  # effect.  'cc -MD -o foo.o ...' puts the dependencies into 'foo.o.d'.\n+  # At least on Alpha/Redhat 6.1, Compaq CCC V6.2-504 seems to put\n+  # dependencies in 'foo.d' instead, so we check for that too.\n+  # Subdirectories are respected.\n+  set_dir_from  \"$object\"\n+  set_base_from \"$object\"\n+\n+  if test \"$libtool\" = yes; then\n+    # Libtool generates 2 separate objects for the 2 libraries.  These\n+    # two compilations output dependencies in $dir.libs/$base.o.d and\n+    # in $dir$base.o.d.  We have to check for both files, because\n+    # one of the two compilations can be disabled.  We should prefer\n+    # $dir$base.o.d over $dir.libs/$base.o.d because the latter is\n+    # automatically cleaned when .libs/ is deleted, while ignoring\n+    # the former would cause a distcleancheck panic.\n+    tmpdepfile1=$dir$base.o.d          # libtool 1.5\n+    tmpdepfile2=$dir.libs/$base.o.d    # Likewise.\n+    tmpdepfile3=$dir.libs/$base.d      # Compaq CCC V6.2-504\n+    \"$@\" -Wc,-MD\n+  else\n+    tmpdepfile1=$dir$base.d\n+    tmpdepfile2=$dir$base.d\n+    tmpdepfile3=$dir$base.d\n+    \"$@\" -MD\n+  fi\n+\n+  stat=$?\n+  if test $stat -ne 0; then\n+    rm -f \"$tmpdepfile1\" \"$tmpdepfile2\" \"$tmpdepfile3\"\n+    exit $stat\n+  fi\n+\n+  for tmpdepfile in \"$tmpdepfile1\" \"$tmpdepfile2\" \"$tmpdepfile3\"\n+  do\n+    test -f \"$tmpdepfile\" && break\n+  done\n+  # Same post-processing that is required for AIX mode.\n+  aix_post_process_depfile\n+  ;;\n+\n+msvc7)\n+  if test \"$libtool\" = yes; then\n+    showIncludes=-Wc,-showIncludes\n+  else\n+    showIncludes=-showIncludes\n+  fi\n+  \"$@\" $showIncludes > \"$tmpdepfile\"\n+  stat=$?\n+  grep -v '^Note: including file: ' \"$tmpdepfile\"\n+  if test $stat -ne 0; then\n+    rm -f \"$tmpdepfile\"\n+    exit $stat\n+  fi\n+  rm -f \"$depfile\"\n+  echo \"$object : \\\\\" > \"$depfile\"\n+  # The first sed program below extracts the file names and escapes\n+  # backslashes for cygpath.  The second sed program outputs the file\n+  # name when reading, but also accumulates all include files in the\n+  # hold buffer in order to output them again at the end.  This only\n+  # works with sed implementations that can handle large buffers.\n+  sed < \"$tmpdepfile\" -n '\n+/^Note: including file:  *\\(.*\\)/ {\n+  s//\\1/\n+  s/\\\\/\\\\\\\\/g\n+  p\n+}' | $cygpath_u | sort -u | sed -n '\n+s/ /\\\\ /g\n+s/\\(.*\\)/'\"$tab\"'\\1 \\\\/p\n+s/.\\(.*\\) \\\\/\\1:/\n+H\n+$ {\n+  s/.*/'\"$tab\"'/\n+  G\n+  p\n+}' >> \"$depfile\"\n+  echo >> \"$depfile\" # make sure the fragment doesn't end with a backslash\n+  rm -f \"$tmpdepfile\"\n+  ;;\n+\n+msvc7msys)\n+  # This case exists only to let depend.m4 do its work.  It works by\n+  # looking at the text of this script.  This case will never be run,\n+  # since it is checked for above.\n+  exit 1\n+  ;;\n \n #nosideeffect)\n   # This comment above is used by automake to tell side-effect\n@@ -422,7 +545,7 @@ dashmstdout)\n     shift\n   fi\n \n-  # Remove `-o $object'.\n+  # Remove '-o $object'.\n   IFS=\" \"\n   for arg\n   do\n@@ -442,18 +565,18 @@ dashmstdout)\n   done\n \n   test -z \"$dashmflag\" && dashmflag=-M\n-  # Require at least two characters before searching for `:'\n+  # Require at least two characters before searching for ':'\n   # in the target name.  This is to cope with DOS-style filenames:\n-  # a dependency such as `c:/foo/bar' could be seen as target `c' otherwise.\n+  # a dependency such as 'c:/foo/bar' could be seen as target 'c' otherwise.\n   \"$@\" $dashmflag |\n-    sed 's:^[  ]*[^: ][^:][^:]*\\:[    ]*:'\"$object\"'\\: :' > \"$tmpdepfile\"\n+    sed \"s|^[$tab ]*[^:$tab ][^:][^:]*:[$tab ]*|$object: |\" > \"$tmpdepfile\"\n   rm -f \"$depfile\"\n   cat < \"$tmpdepfile\" > \"$depfile\"\n-  tr ' ' '\n-' < \"$tmpdepfile\" | \\\n-## Some versions of the HPUX 10.20 sed can't process this invocation\n-## correctly.  Breaking it into two sed invocations is a workaround.\n-    sed -e 's/^\\\\$//' -e '/^$/d' -e '/:$/d' | sed -e 's/$/ :/' >> \"$depfile\"\n+  # Some versions of the HPUX 10.20 sed can't process this sed invocation\n+  # correctly.  Breaking it into two sed invocations is a workaround.\n+  tr ' ' \"$nl\" < \"$tmpdepfile\" \\\n+    | sed -e 's/^\\\\$//' -e '/^$/d' -e '/:$/d' \\\n+    | sed -e 's/$/ :/' >> \"$depfile\"\n   rm -f \"$tmpdepfile\"\n   ;;\n \n@@ -503,12 +626,15 @@ makedepend)\n   touch \"$tmpdepfile\"\n   ${MAKEDEPEND-makedepend} -o\"$obj_suffix\" -f\"$tmpdepfile\" \"$@\"\n   rm -f \"$depfile\"\n-  cat < \"$tmpdepfile\" > \"$depfile\"\n-  sed '1,2d' \"$tmpdepfile\" | tr ' ' '\n-' | \\\n-## Some versions of the HPUX 10.20 sed can't process this invocation\n-## correctly.  Breaking it into two sed invocations is a workaround.\n-    sed -e 's/^\\\\$//' -e '/^$/d' -e '/:$/d' | sed -e 's/$/ :/' >> \"$depfile\"\n+  # makedepend may prepend the VPATH from the source file name to the object.\n+  # No need to regex-escape $object, excess matching of '.' is harmless.\n+  sed \"s|^.*\\($object *:\\)|\\1|\" \"$tmpdepfile\" > \"$depfile\"\n+  # Some versions of the HPUX 10.20 sed can't process the last invocation\n+  # correctly.  Breaking it into two sed invocations is a workaround.\n+  sed '1,2d' \"$tmpdepfile\" \\\n+    | tr ' ' \"$nl\" \\\n+    | sed -e 's/^\\\\$//' -e '/^$/d' -e '/:$/d' \\\n+    | sed -e 's/$/ :/' >> \"$depfile\"\n   rm -f \"$tmpdepfile\" \"$tmpdepfile\".bak\n   ;;\n \n@@ -525,7 +651,7 @@ cpp)\n     shift\n   fi\n \n-  # Remove `-o $object'.\n+  # Remove '-o $object'.\n   IFS=\" \"\n   for arg\n   do\n@@ -544,10 +670,10 @@ cpp)\n     esac\n   done\n \n-  \"$@\" -E |\n-    sed -n -e '/^# [0-9][0-9]* \"\\([^\"]*\\)\".*/ s:: \\1 \\\\:p' \\\n-       -e '/^#line [0-9][0-9]* \"\\([^\"]*\\)\".*/ s:: \\1 \\\\:p' |\n-    sed '$ s: \\\\$::' > \"$tmpdepfile\"\n+  \"$@\" -E \\\n+    | sed -n -e '/^# [0-9][0-9]* \"\\([^\"]*\\)\".*/ s:: \\1 \\\\:p' \\\n+             -e '/^#line [0-9][0-9]* \"\\([^\"]*\\)\".*/ s:: \\1 \\\\:p' \\\n+    | sed '$ s: \\\\$::' > \"$tmpdepfile\"\n   rm -f \"$depfile\"\n   echo \"$object : \\\\\" > \"$depfile\"\n   cat < \"$tmpdepfile\" >> \"$depfile\"\n@@ -579,23 +705,23 @@ msvisualcpp)\n       shift\n       ;;\n     \"-Gm\"|\"/Gm\"|\"-Gi\"|\"/Gi\"|\"-ZI\"|\"/ZI\")\n-\tset fnord \"$@\"\n-\tshift\n-\tshift\n-\t;;\n+        set fnord \"$@\"\n+        shift\n+        shift\n+        ;;\n     *)\n-\tset fnord \"$@\" \"$arg\"\n-\tshift\n-\tshift\n-\t;;\n+        set fnord \"$@\" \"$arg\"\n+        shift\n+        shift\n+        ;;\n     esac\n   done\n   \"$@\" -E 2>/dev/null |\n   sed -n '/^#line [0-9][0-9]* \"\\([^\"]*\\)\"/ s::\\1:p' | $cygpath_u | sort -u > \"$tmpdepfile\"\n   rm -f \"$depfile\"\n   echo \"$object : \\\\\" > \"$depfile\"\n-  sed < \"$tmpdepfile\" -n -e 's% %\\\\ %g' -e '/^\\(.*\\)$/ s::\t\\1 \\\\:p' >> \"$depfile\"\n-  echo \"\t\" >> \"$depfile\"\n+  sed < \"$tmpdepfile\" -n -e 's% %\\\\ %g' -e '/^\\(.*\\)$/ s::'\"$tab\"'\\1 \\\\:p' >> \"$depfile\"\n+  echo \"$tab\" >> \"$depfile\"\n   sed < \"$tmpdepfile\" -n -e 's% %\\\\ %g' -e '/^\\(.*\\)$/ s::\\1\\::p' >> \"$depfile\"\n   rm -f \"$tmpdepfile\"\n   ;;"}, {"sha": "0b0fdcbba69ab6dd05ca162a5328828d46ab1d54", "filename": "install-sh", "status": "modified", "additions": 183, "deletions": 202, "changes": 385, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/d7134c0eb570daf54d4e985dc28c83ca95209373/install-sh", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/d7134c0eb570daf54d4e985dc28c83ca95209373/install-sh", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/install-sh?ref=d7134c0eb570daf54d4e985dc28c83ca95209373", "patch": "@@ -1,7 +1,7 @@\n #!/bin/sh\n # install - install a program, script, or datafile\n \n-scriptversion=2009-04-28.21; # UTC\n+scriptversion=2013-12-25.23; # UTC\n \n # This originates from X11R5 (mit/util/scripts/install.sh), which was\n # later released in X11R6 (xc/config/util/install.sh) with the\n@@ -35,25 +35,21 @@ scriptversion=2009-04-28.21; # UTC\n # FSF changes to this file are in the public domain.\n #\n # Calling this script install-sh is preferred over install.sh, to prevent\n-# `make' implicit rules from creating a file called install from it\n+# 'make' implicit rules from creating a file called install from it\n # when there is no Makefile.\n #\n # This script is compatible with the BSD install script, but was written\n # from scratch.\n \n+tab='\t'\n nl='\n '\n-IFS=\" \"\"\t$nl\"\n+IFS=\" $tab$nl\"\n \n-# set DOITPROG to echo to test this script\n+# Set DOITPROG to \"echo\" to test this script.\n \n-# Don't use :- since 4.3BSD and earlier shells don't like it.\n doit=${DOITPROG-}\n-if test -z \"$doit\"; then\n-  doit_exec=exec\n-else\n-  doit_exec=$doit\n-fi\n+doit_exec=${doit:-exec}\n \n # Put in absolute file names if you don't have them in your path;\n # or use environment vars.\n@@ -68,17 +64,6 @@ mvprog=${MVPROG-mv}\n rmprog=${RMPROG-rm}\n stripprog=${STRIPPROG-strip}\n \n-posix_glob='?'\n-initialize_posix_glob='\n-  test \"$posix_glob\" != \"?\" || {\n-    if (set -f) 2>/dev/null; then\n-      posix_glob=\n-    else\n-      posix_glob=:\n-    fi\n-  }\n-'\n-\n posix_mkdir=\n \n # Desired mode of installed file.\n@@ -97,7 +82,7 @@ dir_arg=\n dst_arg=\n \n copy_on_change=false\n-no_target_directory=\n+is_target_a_directory=possibly\n \n usage=\"\\\n Usage: $0 [OPTION]... [-T] SRCFILE DSTFILE\n@@ -137,42 +122,57 @@ while test $# -ne 0; do\n     -d) dir_arg=true;;\n \n     -g) chgrpcmd=\"$chgrpprog $2\"\n-\tshift;;\n+        shift;;\n \n     --help) echo \"$usage\"; exit $?;;\n \n     -m) mode=$2\n-\tcase $mode in\n-\t  *' '* | *'\t'* | *'\n-'*\t  | *'*'* | *'?'* | *'['*)\n-\t    echo \"$0: invalid mode: $mode\" >&2\n-\t    exit 1;;\n-\tesac\n-\tshift;;\n+        case $mode in\n+          *' '* | *\"$tab\"* | *\"$nl\"* | *'*'* | *'?'* | *'['*)\n+            echo \"$0: invalid mode: $mode\" >&2\n+            exit 1;;\n+        esac\n+        shift;;\n \n     -o) chowncmd=\"$chownprog $2\"\n-\tshift;;\n+        shift;;\n \n     -s) stripcmd=$stripprog;;\n \n-    -t) dst_arg=$2\n-\tshift;;\n+    -t)\n+        is_target_a_directory=always\n+        dst_arg=$2\n+        # Protect names problematic for 'test' and other utilities.\n+        case $dst_arg in\n+          -* | [=\\(\\)!]) dst_arg=./$dst_arg;;\n+        esac\n+        shift;;\n \n-    -T) no_target_directory=true;;\n+    -T) is_target_a_directory=never;;\n \n     --version) echo \"$0 $scriptversion\"; exit $?;;\n \n-    --)\tshift\n-\tbreak;;\n+    --) shift\n+        break;;\n \n-    -*)\techo \"$0: invalid option: $1\" >&2\n-\texit 1;;\n+    -*) echo \"$0: invalid option: $1\" >&2\n+        exit 1;;\n \n     *)  break;;\n   esac\n   shift\n done\n \n+# We allow the use of options -d and -T together, by making -d\n+# take the precedence; this is for compatibility with GNU install.\n+\n+if test -n \"$dir_arg\"; then\n+  if test -n \"$dst_arg\"; then\n+    echo \"$0: target directory not allowed when installing a directory.\" >&2\n+    exit 1\n+  fi\n+fi\n+\n if test $# -ne 0 && test -z \"$dir_arg$dst_arg\"; then\n   # When -d is used, all remaining arguments are directories to create.\n   # When -t is used, the destination is already specified.\n@@ -186,6 +186,10 @@ if test $# -ne 0 && test -z \"$dir_arg$dst_arg\"; then\n     fi\n     shift # arg\n     dst_arg=$arg\n+    # Protect names problematic for 'test' and other utilities.\n+    case $dst_arg in\n+      -* | [=\\(\\)!]) dst_arg=./$dst_arg;;\n+    esac\n   done\n fi\n \n@@ -194,13 +198,26 @@ if test $# -eq 0; then\n     echo \"$0: no input file specified.\" >&2\n     exit 1\n   fi\n-  # It's OK to call `install-sh -d' without argument.\n+  # It's OK to call 'install-sh -d' without argument.\n   # This can happen when creating conditional directories.\n   exit 0\n fi\n \n if test -z \"$dir_arg\"; then\n-  trap '(exit $?); exit' 1 2 13 15\n+  if test $# -gt 1 || test \"$is_target_a_directory\" = always; then\n+    if test ! -d \"$dst_arg\"; then\n+      echo \"$0: $dst_arg: Is not a directory.\" >&2\n+      exit 1\n+    fi\n+  fi\n+fi\n+\n+if test -z \"$dir_arg\"; then\n+  do_exit='(exit $ret); exit $ret'\n+  trap \"ret=129; $do_exit\" 1\n+  trap \"ret=130; $do_exit\" 2\n+  trap \"ret=141; $do_exit\" 13\n+  trap \"ret=143; $do_exit\" 15\n \n   # Set umask so as not to create temps with too-generous modes.\n   # However, 'strip' requires both read and write access to temps.\n@@ -211,26 +228,26 @@ if test -z \"$dir_arg\"; then\n \n     *[0-7])\n       if test -z \"$stripcmd\"; then\n-\tu_plus_rw=\n+        u_plus_rw=\n       else\n-\tu_plus_rw='% 200'\n+        u_plus_rw='% 200'\n       fi\n       cp_umask=`expr '(' 777 - $mode % 1000 ')' $u_plus_rw`;;\n     *)\n       if test -z \"$stripcmd\"; then\n-\tu_plus_rw=\n+        u_plus_rw=\n       else\n-\tu_plus_rw=,u+rw\n+        u_plus_rw=,u+rw\n       fi\n       cp_umask=$mode$u_plus_rw;;\n   esac\n fi\n \n for src\n do\n-  # Protect names starting with `-'.\n+  # Protect names problematic for 'test' and other utilities.\n   case $src in\n-    -*) src=./$src;;\n+    -* | [=\\(\\)!]) src=./$src;;\n   esac\n \n   if test -n \"$dir_arg\"; then\n@@ -252,51 +269,20 @@ do\n       echo \"$0: no destination specified.\" >&2\n       exit 1\n     fi\n-\n     dst=$dst_arg\n-    # Protect names starting with `-'.\n-    case $dst in\n-      -*) dst=./$dst;;\n-    esac\n \n     # If destination is a directory, append the input filename; won't work\n     # if double slashes aren't ignored.\n     if test -d \"$dst\"; then\n-      if test -n \"$no_target_directory\"; then\n-\techo \"$0: $dst_arg: Is a directory\" >&2\n-\texit 1\n+      if test \"$is_target_a_directory\" = never; then\n+        echo \"$0: $dst_arg: Is a directory\" >&2\n+        exit 1\n       fi\n       dstdir=$dst\n       dst=$dstdir/`basename \"$src\"`\n       dstdir_status=0\n     else\n-      # Prefer dirname, but fall back on a substitute if dirname fails.\n-      dstdir=`\n-\t(dirname \"$dst\") 2>/dev/null ||\n-\texpr X\"$dst\" : 'X\\(.*[^/]\\)//*[^/][^/]*/*$' \\| \\\n-\t     X\"$dst\" : 'X\\(//\\)[^/]' \\| \\\n-\t     X\"$dst\" : 'X\\(//\\)$' \\| \\\n-\t     X\"$dst\" : 'X\\(/\\)' \\| . 2>/dev/null ||\n-\techo X\"$dst\" |\n-\t    sed '/^X\\(.*[^/]\\)\\/\\/*[^/][^/]*\\/*$/{\n-\t\t   s//\\1/\n-\t\t   q\n-\t\t }\n-\t\t /^X\\(\\/\\/\\)[^/].*/{\n-\t\t   s//\\1/\n-\t\t   q\n-\t\t }\n-\t\t /^X\\(\\/\\/\\)$/{\n-\t\t   s//\\1/\n-\t\t   q\n-\t\t }\n-\t\t /^X\\(\\/\\).*/{\n-\t\t   s//\\1/\n-\t\t   q\n-\t\t }\n-\t\t s/.*/./; q'\n-      `\n-\n+      dstdir=`dirname \"$dst\"`\n       test -d \"$dstdir\"\n       dstdir_status=$?\n     fi\n@@ -307,74 +293,74 @@ do\n   if test $dstdir_status != 0; then\n     case $posix_mkdir in\n       '')\n-\t# Create intermediate dirs using mode 755 as modified by the umask.\n-\t# This is like FreeBSD 'install' as of 1997-10-28.\n-\tumask=`umask`\n-\tcase $stripcmd.$umask in\n-\t  # Optimize common cases.\n-\t  *[2367][2367]) mkdir_umask=$umask;;\n-\t  .*0[02][02] | .[02][02] | .[02]) mkdir_umask=22;;\n-\n-\t  *[0-7])\n-\t    mkdir_umask=`expr $umask + 22 \\\n-\t      - $umask % 100 % 40 + $umask % 20 \\\n-\t      - $umask % 10 % 4 + $umask % 2\n-\t    `;;\n-\t  *) mkdir_umask=$umask,go-w;;\n-\tesac\n-\n-\t# With -d, create the new directory with the user-specified mode.\n-\t# Otherwise, rely on $mkdir_umask.\n-\tif test -n \"$dir_arg\"; then\n-\t  mkdir_mode=-m$mode\n-\telse\n-\t  mkdir_mode=\n-\tfi\n-\n-\tposix_mkdir=false\n-\tcase $umask in\n-\t  *[123567][0-7][0-7])\n-\t    # POSIX mkdir -p sets u+wx bits regardless of umask, which\n-\t    # is incompatible with FreeBSD 'install' when (umask & 300) != 0.\n-\t    ;;\n-\t  *)\n-\t    tmpdir=${TMPDIR-/tmp}/ins$RANDOM-$$\n-\t    trap 'ret=$?; rmdir \"$tmpdir/d\" \"$tmpdir\" 2>/dev/null; exit $ret' 0\n-\n-\t    if (umask $mkdir_umask &&\n-\t\texec $mkdirprog $mkdir_mode -p -- \"$tmpdir/d\") >/dev/null 2>&1\n-\t    then\n-\t      if test -z \"$dir_arg\" || {\n-\t\t   # Check for POSIX incompatibilities with -m.\n-\t\t   # HP-UX 11.23 and IRIX 6.5 mkdir -m -p sets group- or\n-\t\t   # other-writeable bit of parent directory when it shouldn't.\n-\t\t   # FreeBSD 6.1 mkdir -m -p sets mode of existing directory.\n-\t\t   ls_ld_tmpdir=`ls -ld \"$tmpdir\"`\n-\t\t   case $ls_ld_tmpdir in\n-\t\t     d????-?r-*) different_mode=700;;\n-\t\t     d????-?--*) different_mode=755;;\n-\t\t     *) false;;\n-\t\t   esac &&\n-\t\t   $mkdirprog -m$different_mode -p -- \"$tmpdir\" && {\n-\t\t     ls_ld_tmpdir_1=`ls -ld \"$tmpdir\"`\n-\t\t     test \"$ls_ld_tmpdir\" = \"$ls_ld_tmpdir_1\"\n-\t\t   }\n-\t\t }\n-\t      then posix_mkdir=:\n-\t      fi\n-\t      rmdir \"$tmpdir/d\" \"$tmpdir\"\n-\t    else\n-\t      # Remove any dirs left behind by ancient mkdir implementations.\n-\t      rmdir ./$mkdir_mode ./-p ./-- 2>/dev/null\n-\t    fi\n-\t    trap '' 0;;\n-\tesac;;\n+        # Create intermediate dirs using mode 755 as modified by the umask.\n+        # This is like FreeBSD 'install' as of 1997-10-28.\n+        umask=`umask`\n+        case $stripcmd.$umask in\n+          # Optimize common cases.\n+          *[2367][2367]) mkdir_umask=$umask;;\n+          .*0[02][02] | .[02][02] | .[02]) mkdir_umask=22;;\n+\n+          *[0-7])\n+            mkdir_umask=`expr $umask + 22 \\\n+              - $umask % 100 % 40 + $umask % 20 \\\n+              - $umask % 10 % 4 + $umask % 2\n+            `;;\n+          *) mkdir_umask=$umask,go-w;;\n+        esac\n+\n+        # With -d, create the new directory with the user-specified mode.\n+        # Otherwise, rely on $mkdir_umask.\n+        if test -n \"$dir_arg\"; then\n+          mkdir_mode=-m$mode\n+        else\n+          mkdir_mode=\n+        fi\n+\n+        posix_mkdir=false\n+        case $umask in\n+          *[123567][0-7][0-7])\n+            # POSIX mkdir -p sets u+wx bits regardless of umask, which\n+            # is incompatible with FreeBSD 'install' when (umask & 300) != 0.\n+            ;;\n+          *)\n+            tmpdir=${TMPDIR-/tmp}/ins$RANDOM-$$\n+            trap 'ret=$?; rmdir \"$tmpdir/d\" \"$tmpdir\" 2>/dev/null; exit $ret' 0\n+\n+            if (umask $mkdir_umask &&\n+                exec $mkdirprog $mkdir_mode -p -- \"$tmpdir/d\") >/dev/null 2>&1\n+            then\n+              if test -z \"$dir_arg\" || {\n+                   # Check for POSIX incompatibilities with -m.\n+                   # HP-UX 11.23 and IRIX 6.5 mkdir -m -p sets group- or\n+                   # other-writable bit of parent directory when it shouldn't.\n+                   # FreeBSD 6.1 mkdir -m -p sets mode of existing directory.\n+                   ls_ld_tmpdir=`ls -ld \"$tmpdir\"`\n+                   case $ls_ld_tmpdir in\n+                     d????-?r-*) different_mode=700;;\n+                     d????-?--*) different_mode=755;;\n+                     *) false;;\n+                   esac &&\n+                   $mkdirprog -m$different_mode -p -- \"$tmpdir\" && {\n+                     ls_ld_tmpdir_1=`ls -ld \"$tmpdir\"`\n+                     test \"$ls_ld_tmpdir\" = \"$ls_ld_tmpdir_1\"\n+                   }\n+                 }\n+              then posix_mkdir=:\n+              fi\n+              rmdir \"$tmpdir/d\" \"$tmpdir\"\n+            else\n+              # Remove any dirs left behind by ancient mkdir implementations.\n+              rmdir ./$mkdir_mode ./-p ./-- 2>/dev/null\n+            fi\n+            trap '' 0;;\n+        esac;;\n     esac\n \n     if\n       $posix_mkdir && (\n-\tumask $mkdir_umask &&\n-\t$doit_exec $mkdirprog $mkdir_mode -p -- \"$dstdir\"\n+        umask $mkdir_umask &&\n+        $doit_exec $mkdirprog $mkdir_mode -p -- \"$dstdir\"\n       )\n     then :\n     else\n@@ -384,53 +370,51 @@ do\n       # directory the slow way, step by step, checking for races as we go.\n \n       case $dstdir in\n-\t/*) prefix='/';;\n-\t-*) prefix='./';;\n-\t*)  prefix='';;\n+        /*) prefix='/';;\n+        [-=\\(\\)!]*) prefix='./';;\n+        *)  prefix='';;\n       esac\n \n-      eval \"$initialize_posix_glob\"\n-\n       oIFS=$IFS\n       IFS=/\n-      $posix_glob set -f\n+      set -f\n       set fnord $dstdir\n       shift\n-      $posix_glob set +f\n+      set +f\n       IFS=$oIFS\n \n       prefixes=\n \n       for d\n       do\n-\ttest -z \"$d\" && continue\n-\n-\tprefix=$prefix$d\n-\tif test -d \"$prefix\"; then\n-\t  prefixes=\n-\telse\n-\t  if $posix_mkdir; then\n-\t    (umask=$mkdir_umask &&\n-\t     $doit_exec $mkdirprog $mkdir_mode -p -- \"$dstdir\") && break\n-\t    # Don't fail if two instances are running concurrently.\n-\t    test -d \"$prefix\" || exit 1\n-\t  else\n-\t    case $prefix in\n-\t      *\\'*) qprefix=`echo \"$prefix\" | sed \"s/'/'\\\\\\\\\\\\\\\\''/g\"`;;\n-\t      *) qprefix=$prefix;;\n-\t    esac\n-\t    prefixes=\"$prefixes '$qprefix'\"\n-\t  fi\n-\tfi\n-\tprefix=$prefix/\n+        test X\"$d\" = X && continue\n+\n+        prefix=$prefix$d\n+        if test -d \"$prefix\"; then\n+          prefixes=\n+        else\n+          if $posix_mkdir; then\n+            (umask=$mkdir_umask &&\n+             $doit_exec $mkdirprog $mkdir_mode -p -- \"$dstdir\") && break\n+            # Don't fail if two instances are running concurrently.\n+            test -d \"$prefix\" || exit 1\n+          else\n+            case $prefix in\n+              *\\'*) qprefix=`echo \"$prefix\" | sed \"s/'/'\\\\\\\\\\\\\\\\''/g\"`;;\n+              *) qprefix=$prefix;;\n+            esac\n+            prefixes=\"$prefixes '$qprefix'\"\n+          fi\n+        fi\n+        prefix=$prefix/\n       done\n \n       if test -n \"$prefixes\"; then\n-\t# Don't fail if two instances are running concurrently.\n-\t(umask $mkdir_umask &&\n-\t eval \"\\$doit_exec \\$mkdirprog $prefixes\") ||\n-\t  test -d \"$dstdir\" || exit 1\n-\tobsolete_mkdir_used=true\n+        # Don't fail if two instances are running concurrently.\n+        (umask $mkdir_umask &&\n+         eval \"\\$doit_exec \\$mkdirprog $prefixes\") ||\n+          test -d \"$dstdir\" || exit 1\n+        obsolete_mkdir_used=true\n       fi\n     fi\n   fi\n@@ -465,15 +449,12 @@ do\n \n     # If -C, don't bother to copy if it wouldn't change the file.\n     if $copy_on_change &&\n-       old=`LC_ALL=C ls -dlL \"$dst\"\t2>/dev/null` &&\n-       new=`LC_ALL=C ls -dlL \"$dsttmp\"\t2>/dev/null` &&\n-\n-       eval \"$initialize_posix_glob\" &&\n-       $posix_glob set -f &&\n+       old=`LC_ALL=C ls -dlL \"$dst\"     2>/dev/null` &&\n+       new=`LC_ALL=C ls -dlL \"$dsttmp\"  2>/dev/null` &&\n+       set -f &&\n        set X $old && old=:$2:$4:$5:$6 &&\n        set X $new && new=:$2:$4:$5:$6 &&\n-       $posix_glob set +f &&\n-\n+       set +f &&\n        test \"$old\" = \"$new\" &&\n        $cmpprog \"$dst\" \"$dsttmp\" >/dev/null 2>&1\n     then\n@@ -486,24 +467,24 @@ do\n       # to itself, or perhaps because mv is so ancient that it does not\n       # support -f.\n       {\n-\t# Now remove or move aside any old file at destination location.\n-\t# We try this two ways since rm can't unlink itself on some\n-\t# systems and the destination file might be busy for other\n-\t# reasons.  In this case, the final cleanup might fail but the new\n-\t# file should still install successfully.\n-\t{\n-\t  test ! -f \"$dst\" ||\n-\t  $doit $rmcmd -f \"$dst\" 2>/dev/null ||\n-\t  { $doit $mvcmd -f \"$dst\" \"$rmtmp\" 2>/dev/null &&\n-\t    { $doit $rmcmd -f \"$rmtmp\" 2>/dev/null; :; }\n-\t  } ||\n-\t  { echo \"$0: cannot unlink or rename $dst\" >&2\n-\t    (exit 1); exit 1\n-\t  }\n-\t} &&\n-\n-\t# Now rename the file to the real destination.\n-\t$doit $mvcmd \"$dsttmp\" \"$dst\"\n+        # Now remove or move aside any old file at destination location.\n+        # We try this two ways since rm can't unlink itself on some\n+        # systems and the destination file might be busy for other\n+        # reasons.  In this case, the final cleanup might fail but the new\n+        # file should still install successfully.\n+        {\n+          test ! -f \"$dst\" ||\n+          $doit $rmcmd -f \"$dst\" 2>/dev/null ||\n+          { $doit $mvcmd -f \"$dst\" \"$rmtmp\" 2>/dev/null &&\n+            { $doit $rmcmd -f \"$rmtmp\" 2>/dev/null; :; }\n+          } ||\n+          { echo \"$0: cannot unlink or rename $dst\" >&2\n+            (exit 1); exit 1\n+          }\n+        } &&\n+\n+        # Now rename the file to the real destination.\n+        $doit $mvcmd \"$dsttmp\" \"$dst\"\n       }\n     fi || exit 1\n "}, {"sha": "f62bbae306c7e1bc28896aab8fe7bfb700a9a33e", "filename": "missing", "status": "modified", "additions": 150, "deletions": 311, "changes": 461, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/d7134c0eb570daf54d4e985dc28c83ca95209373/missing", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/d7134c0eb570daf54d4e985dc28c83ca95209373/missing", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/missing?ref=d7134c0eb570daf54d4e985dc28c83ca95209373", "patch": "@@ -1,11 +1,10 @@\n #! /bin/sh\n-# Common stub for a few missing GNU programs while installing.\n+# Common wrapper for a few potentially missing GNU programs.\n \n-scriptversion=2009-04-28.21; # UTC\n+scriptversion=2013-10-28.13; # UTC\n \n-# Copyright (C) 1996, 1997, 1999, 2000, 2002, 2003, 2004, 2005, 2006,\n-# 2008, 2009 Free Software Foundation, Inc.\n-# Originally by Fran,cois Pinard <pinard@iro.umontreal.ca>, 1996.\n+# Copyright (C) 1996-2014 Free Software Foundation, Inc.\n+# Originally written by Fran,cois Pinard <pinard@iro.umontreal.ca>, 1996.\n \n # This program is free software; you can redistribute it and/or modify\n # it under the terms of the GNU General Public License as published by\n@@ -26,69 +25,40 @@ scriptversion=2009-04-28.21; # UTC\n # the same distribution terms that you use for the rest of that program.\n \n if test $# -eq 0; then\n-  echo 1>&2 \"Try \\`$0 --help' for more information\"\n+  echo 1>&2 \"Try '$0 --help' for more information\"\n   exit 1\n fi\n \n-run=:\n-sed_output='s/.* --output[ =]\\([^ ]*\\).*/\\1/p'\n-sed_minuso='s/.* -o \\([^ ]*\\).*/\\1/p'\n-\n-# In the cases where this matters, `missing' is being run in the\n-# srcdir already.\n-if test -f configure.ac; then\n-  configure_ac=configure.ac\n-else\n-  configure_ac=configure.in\n-fi\n+case $1 in\n \n-msg=\"missing on your system\"\n+  --is-lightweight)\n+    # Used by our autoconf macros to check whether the available missing\n+    # script is modern enough.\n+    exit 0\n+    ;;\n \n-case $1 in\n---run)\n-  # Try to run requested program, and just exit if it succeeds.\n-  run=\n-  shift\n-  \"$@\" && exit 0\n-  # Exit code 63 means version mismatch.  This often happens\n-  # when the user try to use an ancient version of a tool on\n-  # a file that requires a minimum version.  In this case we\n-  # we should proceed has if the program had been absent, or\n-  # if --run hadn't been passed.\n-  if test $? = 63; then\n-    run=:\n-    msg=\"probably too old\"\n-  fi\n-  ;;\n+  --run)\n+    # Back-compat with the calling convention used by older automake.\n+    shift\n+    ;;\n \n   -h|--h|--he|--hel|--help)\n     echo \"\\\n $0 [OPTION]... PROGRAM [ARGUMENT]...\n \n-Handle \\`PROGRAM [ARGUMENT]...' for when PROGRAM is missing, or return an\n-error status if there is no known handling for PROGRAM.\n+Run 'PROGRAM [ARGUMENT]...', returning a proper advice when this fails due\n+to PROGRAM being missing or too old.\n \n Options:\n   -h, --help      display this help and exit\n   -v, --version   output version information and exit\n-  --run           try to run the given command, and emulate it if it fails\n \n Supported PROGRAM values:\n-  aclocal      touch file \\`aclocal.m4'\n-  autoconf     touch file \\`configure'\n-  autoheader   touch file \\`config.h.in'\n-  autom4te     touch the output file, or create a stub one\n-  automake     touch all \\`Makefile.in' files\n-  bison        create \\`y.tab.[ch]', if possible, from existing .[ch]\n-  flex         create \\`lex.yy.c', if possible, from existing .c\n-  help2man     touch the output file\n-  lex          create \\`lex.yy.c', if possible, from existing .c\n-  makeinfo     touch the output file\n-  tar          try tar, gnutar, gtar, then tar without non-portable flags\n-  yacc         create \\`y.tab.[ch]', if possible, from existing .[ch]\n+  aclocal   autoconf  autoheader   autom4te  automake  makeinfo\n+  bison     yacc      flex         lex       help2man\n \n-Version suffixes to PROGRAM as well as the prefixes \\`gnu-', \\`gnu', and\n-\\`g' are ignored when checking the name.\n+Version suffixes to PROGRAM as well as the prefixes 'gnu-', 'gnu', and\n+'g' are ignored when checking the name.\n \n Send bug reports to <bug-automake@gnu.org>.\"\n     exit $?\n@@ -100,272 +70,141 @@ Send bug reports to <bug-automake@gnu.org>.\"\n     ;;\n \n   -*)\n-    echo 1>&2 \"$0: Unknown \\`$1' option\"\n-    echo 1>&2 \"Try \\`$0 --help' for more information\"\n+    echo 1>&2 \"$0: unknown '$1' option\"\n+    echo 1>&2 \"Try '$0 --help' for more information\"\n     exit 1\n     ;;\n \n esac\n \n-# normalize program name to check for.\n-program=`echo \"$1\" | sed '\n-  s/^gnu-//; t\n-  s/^gnu//; t\n-  s/^g//; t'`\n-\n-# Now exit if we have it, but it failed.  Also exit now if we\n-# don't have it and --version was passed (most likely to detect\n-# the program).  This is about non-GNU programs, so use $1 not\n-# $program.\n-case $1 in\n-  lex*|yacc*)\n-    # Not GNU programs, they don't have --version.\n-    ;;\n-\n-  tar*)\n-    if test -n \"$run\"; then\n-       echo 1>&2 \"ERROR: \\`tar' requires --run\"\n-       exit 1\n-    elif test \"x$2\" = \"x--version\" || test \"x$2\" = \"x--help\"; then\n-       exit 1\n-    fi\n-    ;;\n-\n-  *)\n-    if test -z \"$run\" && ($1 --version) > /dev/null 2>&1; then\n-       # We have it, but it failed.\n-       exit 1\n-    elif test \"x$2\" = \"x--version\" || test \"x$2\" = \"x--help\"; then\n-       # Could not run --version or --help.  This is probably someone\n-       # running `$TOOL --version' or `$TOOL --help' to check whether\n-       # $TOOL exists and not knowing $TOOL uses missing.\n-       exit 1\n-    fi\n-    ;;\n-esac\n-\n-# If it does not exist, or fails to run (possibly an outdated version),\n-# try to emulate it.\n-case $program in\n-  aclocal*)\n-    echo 1>&2 \"\\\n-WARNING: \\`$1' is $msg.  You should only need it if\n-         you modified \\`acinclude.m4' or \\`${configure_ac}'.  You might want\n-         to install the \\`Automake' and \\`Perl' packages.  Grab them from\n-         any GNU archive site.\"\n-    touch aclocal.m4\n-    ;;\n-\n-  autoconf*)\n-    echo 1>&2 \"\\\n-WARNING: \\`$1' is $msg.  You should only need it if\n-         you modified \\`${configure_ac}'.  You might want to install the\n-         \\`Autoconf' and \\`GNU m4' packages.  Grab them from any GNU\n-         archive site.\"\n-    touch configure\n-    ;;\n-\n-  autoheader*)\n-    echo 1>&2 \"\\\n-WARNING: \\`$1' is $msg.  You should only need it if\n-         you modified \\`acconfig.h' or \\`${configure_ac}'.  You might want\n-         to install the \\`Autoconf' and \\`GNU m4' packages.  Grab them\n-         from any GNU archive site.\"\n-    files=`sed -n 's/^[ ]*A[CM]_CONFIG_HEADER(\\([^)]*\\)).*/\\1/p' ${configure_ac}`\n-    test -z \"$files\" && files=\"config.h\"\n-    touch_files=\n-    for f in $files; do\n-      case $f in\n-      *:*) touch_files=\"$touch_files \"`echo \"$f\" |\n-\t\t\t\t       sed -e 's/^[^:]*://' -e 's/:.*//'`;;\n-      *) touch_files=\"$touch_files $f.in\";;\n-      esac\n-    done\n-    touch $touch_files\n-    ;;\n-\n-  automake*)\n-    echo 1>&2 \"\\\n-WARNING: \\`$1' is $msg.  You should only need it if\n-         you modified \\`Makefile.am', \\`acinclude.m4' or \\`${configure_ac}'.\n-         You might want to install the \\`Automake' and \\`Perl' packages.\n-         Grab them from any GNU archive site.\"\n-    find . -type f -name Makefile.am -print |\n-\t   sed 's/\\.am$/.in/' |\n-\t   while read f; do touch \"$f\"; done\n-    ;;\n-\n-  autom4te*)\n-    echo 1>&2 \"\\\n-WARNING: \\`$1' is needed, but is $msg.\n-         You might have modified some files without having the\n-         proper tools for further handling them.\n-         You can get \\`$1' as part of \\`Autoconf' from any GNU\n-         archive site.\"\n-\n-    file=`echo \"$*\" | sed -n \"$sed_output\"`\n-    test -z \"$file\" && file=`echo \"$*\" | sed -n \"$sed_minuso\"`\n-    if test -f \"$file\"; then\n-\ttouch $file\n-    else\n-\ttest -z \"$file\" || exec >$file\n-\techo \"#! /bin/sh\"\n-\techo \"# Created by GNU Automake missing as a replacement of\"\n-\techo \"#  $ $@\"\n-\techo \"exit 0\"\n-\tchmod +x $file\n-\texit 1\n-    fi\n-    ;;\n-\n-  bison*|yacc*)\n-    echo 1>&2 \"\\\n-WARNING: \\`$1' $msg.  You should only need it if\n-         you modified a \\`.y' file.  You may need the \\`Bison' package\n-         in order for those modifications to take effect.  You can get\n-         \\`Bison' from any GNU archive site.\"\n-    rm -f y.tab.c y.tab.h\n-    if test $# -ne 1; then\n-        eval LASTARG=\"\\${$#}\"\n-\tcase $LASTARG in\n-\t*.y)\n-\t    SRCFILE=`echo \"$LASTARG\" | sed 's/y$/c/'`\n-\t    if test -f \"$SRCFILE\"; then\n-\t         cp \"$SRCFILE\" y.tab.c\n-\t    fi\n-\t    SRCFILE=`echo \"$LASTARG\" | sed 's/y$/h/'`\n-\t    if test -f \"$SRCFILE\"; then\n-\t         cp \"$SRCFILE\" y.tab.h\n-\t    fi\n-\t  ;;\n-\tesac\n-    fi\n-    if test ! -f y.tab.h; then\n-\techo >y.tab.h\n-    fi\n-    if test ! -f y.tab.c; then\n-\techo 'main() { return 0; }' >y.tab.c\n-    fi\n-    ;;\n-\n-  lex*|flex*)\n-    echo 1>&2 \"\\\n-WARNING: \\`$1' is $msg.  You should only need it if\n-         you modified a \\`.l' file.  You may need the \\`Flex' package\n-         in order for those modifications to take effect.  You can get\n-         \\`Flex' from any GNU archive site.\"\n-    rm -f lex.yy.c\n-    if test $# -ne 1; then\n-        eval LASTARG=\"\\${$#}\"\n-\tcase $LASTARG in\n-\t*.l)\n-\t    SRCFILE=`echo \"$LASTARG\" | sed 's/l$/c/'`\n-\t    if test -f \"$SRCFILE\"; then\n-\t         cp \"$SRCFILE\" lex.yy.c\n-\t    fi\n-\t  ;;\n-\tesac\n-    fi\n-    if test ! -f lex.yy.c; then\n-\techo 'main() { return 0; }' >lex.yy.c\n-    fi\n-    ;;\n-\n-  help2man*)\n-    echo 1>&2 \"\\\n-WARNING: \\`$1' is $msg.  You should only need it if\n-\t you modified a dependency of a manual page.  You may need the\n-\t \\`Help2man' package in order for those modifications to take\n-\t effect.  You can get \\`Help2man' from any GNU archive site.\"\n-\n-    file=`echo \"$*\" | sed -n \"$sed_output\"`\n-    test -z \"$file\" && file=`echo \"$*\" | sed -n \"$sed_minuso\"`\n-    if test -f \"$file\"; then\n-\ttouch $file\n-    else\n-\ttest -z \"$file\" || exec >$file\n-\techo \".ab help2man is required to generate this page\"\n-\texit $?\n-    fi\n-    ;;\n-\n-  makeinfo*)\n-    echo 1>&2 \"\\\n-WARNING: \\`$1' is $msg.  You should only need it if\n-         you modified a \\`.texi' or \\`.texinfo' file, or any other file\n-         indirectly affecting the aspect of the manual.  The spurious\n-         call might also be the consequence of using a buggy \\`make' (AIX,\n-         DU, IRIX).  You might want to install the \\`Texinfo' package or\n-         the \\`GNU make' package.  Grab either from any GNU archive site.\"\n-    # The file to touch is that specified with -o ...\n-    file=`echo \"$*\" | sed -n \"$sed_output\"`\n-    test -z \"$file\" && file=`echo \"$*\" | sed -n \"$sed_minuso\"`\n-    if test -z \"$file\"; then\n-      # ... or it is the one specified with @setfilename ...\n-      infile=`echo \"$*\" | sed 's/.* \\([^ ]*\\) *$/\\1/'`\n-      file=`sed -n '\n-\t/^@setfilename/{\n-\t  s/.* \\([^ ]*\\) *$/\\1/\n-\t  p\n-\t  q\n-\t}' $infile`\n-      # ... or it is derived from the source name (dir/f.texi becomes f.info)\n-      test -z \"$file\" && file=`echo \"$infile\" | sed 's,.*/,,;s,.[^.]*$,,'`.info\n-    fi\n-    # If the file does not exist, the user really needs makeinfo;\n-    # let's fail without touching anything.\n-    test -f $file || exit 1\n-    touch $file\n-    ;;\n-\n-  tar*)\n-    shift\n-\n-    # We have already tried tar in the generic part.\n-    # Look for gnutar/gtar before invocation to avoid ugly error\n-    # messages.\n-    if (gnutar --version > /dev/null 2>&1); then\n-       gnutar \"$@\" && exit 0\n-    fi\n-    if (gtar --version > /dev/null 2>&1); then\n-       gtar \"$@\" && exit 0\n-    fi\n-    firstarg=\"$1\"\n-    if shift; then\n-\tcase $firstarg in\n-\t*o*)\n-\t    firstarg=`echo \"$firstarg\" | sed s/o//`\n-\t    tar \"$firstarg\" \"$@\" && exit 0\n-\t    ;;\n-\tesac\n-\tcase $firstarg in\n-\t*h*)\n-\t    firstarg=`echo \"$firstarg\" | sed s/h//`\n-\t    tar \"$firstarg\" \"$@\" && exit 0\n-\t    ;;\n-\tesac\n-    fi\n-\n-    echo 1>&2 \"\\\n-WARNING: I can't seem to be able to run \\`tar' with the given arguments.\n-         You may want to install GNU tar or Free paxutils, or check the\n-         command line arguments.\"\n-    exit 1\n-    ;;\n-\n-  *)\n-    echo 1>&2 \"\\\n-WARNING: \\`$1' is needed, and is $msg.\n-         You might have modified some files without having the\n-         proper tools for further handling them.  Check the \\`README' file,\n-         it often tells you about the needed prerequisites for installing\n-         this package.  You may also peek at any GNU archive site, in case\n-         some other package would contain this missing \\`$1' program.\"\n-    exit 1\n-    ;;\n-esac\n+# Run the given program, remember its exit status.\n+\"$@\"; st=$?\n+\n+# If it succeeded, we are done.\n+test $st -eq 0 && exit 0\n+\n+# Also exit now if we it failed (or wasn't found), and '--version' was\n+# passed; such an option is passed most likely to detect whether the\n+# program is present and works.\n+case $2 in --version|--help) exit $st;; esac\n+\n+# Exit code 63 means version mismatch.  This often happens when the user\n+# tries to use an ancient version of a tool on a file that requires a\n+# minimum version.\n+if test $st -eq 63; then\n+  msg=\"probably too old\"\n+elif test $st -eq 127; then\n+  # Program was missing.\n+  msg=\"missing on your system\"\n+else\n+  # Program was found and executed, but failed.  Give up.\n+  exit $st\n+fi\n \n-exit 0\n+perl_URL=http://www.perl.org/\n+flex_URL=http://flex.sourceforge.net/\n+gnu_software_URL=http://www.gnu.org/software\n+\n+program_details ()\n+{\n+  case $1 in\n+    aclocal|automake)\n+      echo \"The '$1' program is part of the GNU Automake package:\"\n+      echo \"<$gnu_software_URL/automake>\"\n+      echo \"It also requires GNU Autoconf, GNU m4 and Perl in order to run:\"\n+      echo \"<$gnu_software_URL/autoconf>\"\n+      echo \"<$gnu_software_URL/m4/>\"\n+      echo \"<$perl_URL>\"\n+      ;;\n+    autoconf|autom4te|autoheader)\n+      echo \"The '$1' program is part of the GNU Autoconf package:\"\n+      echo \"<$gnu_software_URL/autoconf/>\"\n+      echo \"It also requires GNU m4 and Perl in order to run:\"\n+      echo \"<$gnu_software_URL/m4/>\"\n+      echo \"<$perl_URL>\"\n+      ;;\n+  esac\n+}\n+\n+give_advice ()\n+{\n+  # Normalize program name to check for.\n+  normalized_program=`echo \"$1\" | sed '\n+    s/^gnu-//; t\n+    s/^gnu//; t\n+    s/^g//; t'`\n+\n+  printf '%s\\n' \"'$1' is $msg.\"\n+\n+  configure_deps=\"'configure.ac' or m4 files included by 'configure.ac'\"\n+  case $normalized_program in\n+    autoconf*)\n+      echo \"You should only need it if you modified 'configure.ac',\"\n+      echo \"or m4 files included by it.\"\n+      program_details 'autoconf'\n+      ;;\n+    autoheader*)\n+      echo \"You should only need it if you modified 'acconfig.h' or\"\n+      echo \"$configure_deps.\"\n+      program_details 'autoheader'\n+      ;;\n+    automake*)\n+      echo \"You should only need it if you modified 'Makefile.am' or\"\n+      echo \"$configure_deps.\"\n+      program_details 'automake'\n+      ;;\n+    aclocal*)\n+      echo \"You should only need it if you modified 'acinclude.m4' or\"\n+      echo \"$configure_deps.\"\n+      program_details 'aclocal'\n+      ;;\n+   autom4te*)\n+      echo \"You might have modified some maintainer files that require\"\n+      echo \"the 'autom4te' program to be rebuilt.\"\n+      program_details 'autom4te'\n+      ;;\n+    bison*|yacc*)\n+      echo \"You should only need it if you modified a '.y' file.\"\n+      echo \"You may want to install the GNU Bison package:\"\n+      echo \"<$gnu_software_URL/bison/>\"\n+      ;;\n+    lex*|flex*)\n+      echo \"You should only need it if you modified a '.l' file.\"\n+      echo \"You may want to install the Fast Lexical Analyzer package:\"\n+      echo \"<$flex_URL>\"\n+      ;;\n+    help2man*)\n+      echo \"You should only need it if you modified a dependency\" \\\n+           \"of a man page.\"\n+      echo \"You may want to install the GNU Help2man package:\"\n+      echo \"<$gnu_software_URL/help2man/>\"\n+    ;;\n+    makeinfo*)\n+      echo \"You should only need it if you modified a '.texi' file, or\"\n+      echo \"any other file indirectly affecting the aspect of the manual.\"\n+      echo \"You might want to install the Texinfo package:\"\n+      echo \"<$gnu_software_URL/texinfo/>\"\n+      echo \"The spurious makeinfo call might also be the consequence of\"\n+      echo \"using a buggy 'make' (AIX, DU, IRIX), in which case you might\"\n+      echo \"want to install GNU make:\"\n+      echo \"<$gnu_software_URL/make/>\"\n+      ;;\n+    *)\n+      echo \"You might have modified some files without having the proper\"\n+      echo \"tools for further handling them.  Check the 'README' file, it\"\n+      echo \"often tells you about the needed prerequisites for installing\"\n+      echo \"this package.  You may also peek at any GNU archive site, in\"\n+      echo \"case some other package contains this missing '$1' program.\"\n+      ;;\n+  esac\n+}\n+\n+give_advice \"$1\" | sed -e '1s/^/WARNING: /' \\\n+                       -e '2,$s/^/         /' >&2\n+\n+# Propagate the correct exit status (expected to be 127 for a program\n+# not found, 63 for a program that failed due to version mismatch).\n+exit $st\n \n # Local variables:\n # eval: (add-hook 'write-file-hooks 'time-stamp)"}, {"sha": "55d537f872ccde377e96a1f34e37624a06834b26", "filename": "mkinstalldirs", "status": "modified", "additions": 2, "deletions": 2, "changes": 4, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/d7134c0eb570daf54d4e985dc28c83ca95209373/mkinstalldirs", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/d7134c0eb570daf54d4e985dc28c83ca95209373/mkinstalldirs", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/mkinstalldirs?ref=d7134c0eb570daf54d4e985dc28c83ca95209373", "patch": "@@ -81,9 +81,9 @@ case $dirmode in\n       echo \"mkdir -p -- $*\"\n       exec mkdir -p -- \"$@\"\n     else\n-      # On NextStep and OpenStep, the `mkdir' command does not\n+      # On NextStep and OpenStep, the 'mkdir' command does not\n       # recognize any option.  It will interpret all options as\n-      # directories to create, and then abort because `.' already\n+      # directories to create, and then abort because '.' already\n       # exists.\n       test -d ./-p && rmdir ./-p\n       test -d ./--version && rmdir ./--version"}, {"sha": "13fa706c3cf219eabbcfbd3e789b10943e3a3266", "filename": "ylwrap", "status": "modified", "additions": 106, "deletions": 96, "changes": 202, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/d7134c0eb570daf54d4e985dc28c83ca95209373/ylwrap", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/d7134c0eb570daf54d4e985dc28c83ca95209373/ylwrap", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/ylwrap?ref=d7134c0eb570daf54d4e985dc28c83ca95209373", "patch": "@@ -1,10 +1,9 @@\n #! /bin/sh\n # ylwrap - wrapper for lex/yacc invocations.\n \n-scriptversion=2009-04-28.21; # UTC\n+scriptversion=2013-01-12.17; # UTC\n \n-# Copyright (C) 1996, 1997, 1998, 1999, 2001, 2002, 2003, 2004, 2005,\n-# 2007, 2009 Free Software Foundation, Inc.\n+# Copyright (C) 1996-2014 Free Software Foundation, Inc.\n #\n # Written by Tom Tromey <tromey@cygnus.com>.\n #\n@@ -30,9 +29,41 @@ scriptversion=2009-04-28.21; # UTC\n # bugs to <bug-automake@gnu.org> or send patches to\n # <automake-patches@gnu.org>.\n \n+get_dirname ()\n+{\n+  case $1 in\n+    */*|*\\\\*) printf '%s\\n' \"$1\" | sed -e 's|\\([\\\\/]\\)[^\\\\/]*$|\\1|';;\n+    # Otherwise,  we want the empty string (not \".\").\n+  esac\n+}\n+\n+# guard FILE\n+# ----------\n+# The CPP macro used to guard inclusion of FILE.\n+guard ()\n+{\n+  printf '%s\\n' \"$1\"                                                    \\\n+    | sed                                                               \\\n+        -e 'y/abcdefghijklmnopqrstuvwxyz/ABCDEFGHIJKLMNOPQRSTUVWXYZ/'   \\\n+        -e 's/[^ABCDEFGHIJKLMNOPQRSTUVWXYZ]/_/g'                        \\\n+        -e 's/__*/_/g'\n+}\n+\n+# quote_for_sed [STRING]\n+# ----------------------\n+# Return STRING (or stdin) quoted to be used as a sed pattern.\n+quote_for_sed ()\n+{\n+  case $# in\n+    0) cat;;\n+    1) printf '%s\\n' \"$1\";;\n+  esac \\\n+    | sed -e 's|[][\\\\.*]|\\\\&|g'\n+}\n+\n case \"$1\" in\n   '')\n-    echo \"$0: No files given.  Try \\`$0 --help' for more information.\" 1>&2\n+    echo \"$0: No files given.  Try '$0 --help' for more information.\" 1>&2\n     exit 1\n     ;;\n   --basedir)\n@@ -65,41 +96,62 @@ esac\n \n \n # The input.\n-input=\"$1\"\n+input=$1\n shift\n-case \"$input\" in\n+# We'll later need for a correct munging of \"#line\" directives.\n+input_sub_rx=`get_dirname \"$input\" | quote_for_sed`\n+case $input in\n   [\\\\/]* | ?:[\\\\/]*)\n     # Absolute path; do nothing.\n     ;;\n   *)\n     # Relative path.  Make it absolute.\n-    input=\"`pwd`/$input\"\n+    input=`pwd`/$input\n     ;;\n esac\n+input_rx=`get_dirname \"$input\" | quote_for_sed`\n+\n+# The parser itself, the first file, is the destination of the .y.c\n+# rule in the Makefile.\n+parser=$1\n+\n+# A sed program to s/FROM/TO/g for all the FROM/TO so that, for\n+# instance, we rename #include \"y.tab.h\" into #include \"parse.h\"\n+# during the conversion from y.tab.c to parse.c.\n+sed_fix_filenames=\n+\n+# Also rename header guards, as Bison 2.7 for instance uses its header\n+# guard in its implementation file.\n+sed_fix_header_guards=\n \n-pairlist=\n-while test \"$#\" -ne 0; do\n-  if test \"$1\" = \"--\"; then\n+while test $# -ne 0; do\n+  if test x\"$1\" = x\"--\"; then\n     shift\n     break\n   fi\n-  pairlist=\"$pairlist $1\"\n+  from=$1\n   shift\n+  to=$1\n+  shift\n+  sed_fix_filenames=\"${sed_fix_filenames}s|\"`quote_for_sed \"$from\"`\"|$to|g;\"\n+  sed_fix_header_guards=\"${sed_fix_header_guards}s|\"`guard \"$from\"`\"|\"`guard \"$to\"`\"|g;\"\n done\n \n # The program to run.\n-prog=\"$1\"\n+prog=$1\n shift\n # Make any relative path in $prog absolute.\n-case \"$prog\" in\n+case $prog in\n   [\\\\/]* | ?:[\\\\/]*) ;;\n-  *[\\\\/]*) prog=\"`pwd`/$prog\" ;;\n+  *[\\\\/]*) prog=`pwd`/$prog ;;\n esac\n \n-# FIXME: add hostname here for parallel makes that run commands on\n-# other machines.  But that might take us over the 14-char limit.\n dirname=ylwrap$$\n-trap \"cd '`pwd`'; rm -rf $dirname > /dev/null 2>&1\" 1 2 3 15\n+do_exit=\"cd '`pwd`' && rm -rf $dirname > /dev/null 2>&1;\"' (exit $ret); exit $ret'\n+trap \"ret=129; $do_exit\" 1\n+trap \"ret=130; $do_exit\" 2\n+trap \"ret=141; $do_exit\" 13\n+trap \"ret=143; $do_exit\" 15\n mkdir $dirname || exit 1\n \n cd $dirname\n@@ -111,98 +163,56 @@ esac\n ret=$?\n \n if test $ret -eq 0; then\n-  set X $pairlist\n-  shift\n-  first=yes\n-  # Since DOS filename conventions don't allow two dots,\n-  # the DOS version of Bison writes out y_tab.c instead of y.tab.c\n-  # and y_tab.h instead of y.tab.h. Test to see if this is the case.\n-  y_tab_nodot=\"no\"\n-  if test -f y_tab.c || test -f y_tab.h; then\n-    y_tab_nodot=\"yes\"\n-  fi\n-\n-  # The directory holding the input.\n-  input_dir=`echo \"$input\" | sed -e 's,\\([\\\\/]\\)[^\\\\/]*$,\\1,'`\n-  # Quote $INPUT_DIR so we can use it in a regexp.\n-  # FIXME: really we should care about more than `.' and `\\'.\n-  input_rx=`echo \"$input_dir\" | sed 's,\\\\\\\\,\\\\\\\\\\\\\\\\,g;s,\\\\.,\\\\\\\\.,g'`\n-\n-  while test \"$#\" -ne 0; do\n-    from=\"$1\"\n-    # Handle y_tab.c and y_tab.h output by DOS\n-    if test $y_tab_nodot = \"yes\"; then\n-      if test $from = \"y.tab.c\"; then\n-    \tfrom=\"y_tab.c\"\n-      else\n-    \tif test $from = \"y.tab.h\"; then\n-    \t  from=\"y_tab.h\"\n-    \tfi\n-      fi\n-    fi\n+  for from in *\n+  do\n+    to=`printf '%s\\n' \"$from\" | sed \"$sed_fix_filenames\"`\n     if test -f \"$from\"; then\n       # If $2 is an absolute path name, then just use that,\n-      # otherwise prepend `../'.\n-      case \"$2\" in\n-    \t[\\\\/]* | ?:[\\\\/]*) target=\"$2\";;\n-    \t*) target=\"../$2\";;\n+      # otherwise prepend '../'.\n+      case $to in\n+        [\\\\/]* | ?:[\\\\/]*) target=$to;;\n+        *) target=../$to;;\n       esac\n \n-      # We do not want to overwrite a header file if it hasn't\n-      # changed.  This avoid useless recompilations.  However the\n-      # parser itself (the first file) should always be updated,\n-      # because it is the destination of the .y.c rule in the\n-      # Makefile.  Divert the output of all other files to a temporary\n-      # file so we can compare them to existing versions.\n-      if test $first = no; then\n-\trealtarget=\"$target\"\n-\ttarget=\"tmp-`echo $target | sed s/.*[\\\\/]//g`\"\n+      # Do not overwrite unchanged header files to avoid useless\n+      # recompilations.  Always update the parser itself: it is the\n+      # destination of the .y.c rule in the Makefile.  Divert the\n+      # output of all other files to a temporary file so we can\n+      # compare them to existing versions.\n+      if test $from != $parser; then\n+        realtarget=$target\n+        target=tmp-`printf '%s\\n' \"$target\" | sed 's|.*[\\\\/]||g'`\n       fi\n-      # Edit out `#line' or `#' directives.\n-      #\n-      # We don't want the resulting debug information to point at\n-      # an absolute srcdir; it is better for it to just mention the\n-      # .y file with no path.\n-      #\n-      # We want to use the real output file name, not yy.lex.c for\n-      # instance.\n-      #\n-      # We want the include guards to be adjusted too.\n-      FROM=`echo \"$from\" | sed \\\n-            -e 'y/abcdefghijklmnopqrstuvwxyz/ABCDEFGHIJKLMNOPQRSTUVWXYZ/'\\\n-            -e 's/[^ABCDEFGHIJKLMNOPQRSTUVWXYZ]/_/g'`\n-      TARGET=`echo \"$2\" | sed \\\n-            -e 'y/abcdefghijklmnopqrstuvwxyz/ABCDEFGHIJKLMNOPQRSTUVWXYZ/'\\\n-            -e 's/[^ABCDEFGHIJKLMNOPQRSTUVWXYZ]/_/g'`\n-\n-      sed -e \"/^#/!b\" -e \"s,$input_rx,,\" -e \"s,$from,$2,\" \\\n-          -e \"s,$FROM,$TARGET,\" \"$from\" >\"$target\" || ret=$?\n-\n-      # Check whether header files must be updated.\n-      if test $first = no; then\n-\tif test -f \"$realtarget\" && cmp -s \"$realtarget\" \"$target\"; then\n-\t  echo \"$2\" is unchanged\n-\t  rm -f \"$target\"\n-\telse\n-          echo updating \"$2\"\n+\n+      # Munge \"#line\" or \"#\" directives.  Don't let the resulting\n+      # debug information point at an absolute srcdir.  Use the real\n+      # output file name, not yy.lex.c for instance.  Adjust the\n+      # include guards too.\n+      sed -e \"/^#/!b\"                           \\\n+          -e \"s|$input_rx|$input_sub_rx|\"       \\\n+          -e \"$sed_fix_filenames\"               \\\n+          -e \"$sed_fix_header_guards\"           \\\n+        \"$from\" >\"$target\" || ret=$?\n+\n+      # Check whether files must be updated.\n+      if test \"$from\" != \"$parser\"; then\n+        if test -f \"$realtarget\" && cmp -s \"$realtarget\" \"$target\"; then\n+          echo \"$to is unchanged\"\n+          rm -f \"$target\"\n+        else\n+          echo \"updating $to\"\n           mv -f \"$target\" \"$realtarget\"\n         fi\n       fi\n     else\n-      # A missing file is only an error for the first file.  This\n-      # is a blatant hack to let us support using \"yacc -d\".  If -d\n-      # is not specified, we don't want an error when the header\n-      # file is \"missing\".\n-      if test $first = yes; then\n+      # A missing file is only an error for the parser.  This is a\n+      # blatant hack to let us support using \"yacc -d\".  If -d is not\n+      # specified, don't fail when the header file is \"missing\".\n+      if test \"$from\" = \"$parser\"; then\n         ret=1\n       fi\n     fi\n-    shift\n-    shift\n-    first=no\n   done\n-else\n-  ret=$?\n fi\n \n # Remove the directory."}]}