{"sha": "ee1658f34360cd994f12c0bc525b714b2efe7bb8", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6ZWUxNjU4ZjM0MzYwY2Q5OTRmMTJjMGJjNTI1YjcxNGIyZWZlN2JiOA==", "commit": {"author": {"name": "Marcin Koziej", "email": "creep@desk.pl", "date": "2005-08-14T02:01:52Z"}, "committer": {"name": "Andrew Pinski", "email": "pinskia@gcc.gnu.org", "date": "2005-08-14T02:01:52Z"}, "message": "re PR libobjc/22492 ([PATCH] Abort after @finally: libobjc passing exception value instead of exception.)\n\nlibobjc/ChangeLog:\n\n2005-08-13  Marcin Koziej  <creep@desk.pl>\n            Andrew Pinski  <pinskia@physics.uc.edu>\n\n\tPR libobjc/22492\n\t* exception.c (PERSONALITY_FUNCTION): Fix the PC with finally.\n\ntestsuite/ChangeLog:\n2005-08-13  Marcin Koziej  <creep@desk.pl>\n            Andrew Pinski  <pinskia@physics.uc.edu>\n\n\tPR libobjc/22492\n\t* execute/exceptions/finally-1.m: New test.\n\nCo-Authored-By: Andrew Pinski <pinskia@physics.uc.edu>\n\nFrom-SVN: r103073", "tree": {"sha": "3986954b339cf4c36b639fae792976b61051eda5", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/3986954b339cf4c36b639fae792976b61051eda5"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/ee1658f34360cd994f12c0bc525b714b2efe7bb8", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/ee1658f34360cd994f12c0bc525b714b2efe7bb8", "html_url": "https://github.com/Rust-GCC/gccrs/commit/ee1658f34360cd994f12c0bc525b714b2efe7bb8", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/ee1658f34360cd994f12c0bc525b714b2efe7bb8/comments", "author": null, "committer": null, "parents": [{"sha": "65045c09038446c48783fe7e30134d72c131a0b1", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/65045c09038446c48783fe7e30134d72c131a0b1", "html_url": "https://github.com/Rust-GCC/gccrs/commit/65045c09038446c48783fe7e30134d72c131a0b1"}], "stats": {"total": 69, "additions": 67, "deletions": 2}, "files": [{"sha": "dff225171e748e7ffd3e4a01294073487c786101", "filename": "gcc/testsuite/ChangeLog", "status": "modified", "additions": 6, "deletions": 0, "changes": 6, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/ee1658f34360cd994f12c0bc525b714b2efe7bb8/gcc%2Ftestsuite%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/ee1658f34360cd994f12c0bc525b714b2efe7bb8/gcc%2Ftestsuite%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2FChangeLog?ref=ee1658f34360cd994f12c0bc525b714b2efe7bb8", "patch": "@@ -1,3 +1,9 @@\n+2005-08-13  Marcin Koziej  <creep@desk.pl>\n+            Andrew Pinski  <pinskia@physics.uc.edu>\n+\n+\tPR libobjc/22492\n+\t* execute/exceptions/finally-1.m: New test.\n+\n 2005-08-13  Andrew Pinski  <pinskia@physics.uc.edu>\n \n \t* objc.dg/nested-func-1.m: Move to ..."}, {"sha": "9d4c396393e5efef162921103e193877c6159354", "filename": "gcc/testsuite/objc/execute/exceptions/finally-1.m", "status": "added", "additions": 45, "deletions": 0, "changes": 45, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/ee1658f34360cd994f12c0bc525b714b2efe7bb8/gcc%2Ftestsuite%2Fobjc%2Fexecute%2Fexceptions%2Ffinally-1.m", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/ee1658f34360cd994f12c0bc525b714b2efe7bb8/gcc%2Ftestsuite%2Fobjc%2Fexecute%2Fexceptions%2Ffinally-1.m", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fobjc%2Fexecute%2Fexceptions%2Ffinally-1.m?ref=ee1658f34360cd994f12c0bc525b714b2efe7bb8", "patch": "@@ -0,0 +1,45 @@\n+#include <objc/Object.h>\n+\n+int\n+thrower_try_body()\n+{\n+        printf(\"Thrower try body\\n\");\n+        return (0);\n+}\n+\n+int\n+finally_body()\n+{\n+        printf(\"Finally body\\n\");\n+        return (0);\n+}\n+\n+int\n+thrower()\n+{\n+        @try\n+        {\n+                thrower_try_body();\n+                @throw [Object new];\n+        }\n+        @finally\n+        {\n+                finally_body();\n+        }       // <----- program aborts here.\n+        return 0;\n+}\n+\n+\n+int \n+main(int ac, char *av[])\n+{\n+        @try\n+        {\n+                thrower();\n+        }\n+        @catch (id exc)\n+        {\n+                printf(\"Got exception of class %s\\n\", [[exc class] name]);\n+                [exc free];\n+        }\n+}"}, {"sha": "9f623b8208171ef6d589479c4171d53addedbe7c", "filename": "libobjc/ChangeLog", "status": "modified", "additions": 6, "deletions": 0, "changes": 6, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/ee1658f34360cd994f12c0bc525b714b2efe7bb8/libobjc%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/ee1658f34360cd994f12c0bc525b714b2efe7bb8/libobjc%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libobjc%2FChangeLog?ref=ee1658f34360cd994f12c0bc525b714b2efe7bb8", "patch": "@@ -1,3 +1,9 @@\n+2005-08-13  Marcin Koziej  <creep@desk.pl>\n+            Andrew Pinski  <pinskia@physics.uc.edu>\n+\n+\tPR libobjc/22492\n+\t* exception.c (PERSONALITY_FUNCTION): Fix the PC with finally.\n+\n 2005-08-13  Andrew Pinski  <pinskia@physics.uc.edu>\n \n \t* Makefile.in (extra_ldflags_libobjc): New."}, {"sha": "e34f34b4342c73265197ca2517c5f76bf9f40623", "filename": "libobjc/exception.c", "status": "modified", "additions": 10, "deletions": 2, "changes": 12, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/ee1658f34360cd994f12c0bc525b714b2efe7bb8/libobjc%2Fexception.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/ee1658f34360cd994f12c0bc525b714b2efe7bb8/libobjc%2Fexception.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libobjc%2Fexception.c?ref=ee1658f34360cd994f12c0bc525b714b2efe7bb8", "patch": "@@ -165,7 +165,8 @@ PERSONALITY_FUNCTION (int version,\n   const unsigned char *p;\n   _Unwind_Ptr landing_pad, ip;\n   int handler_switch_value;\n-  int saw_cleanup, saw_handler;\n+  int saw_cleanup = 0, saw_handler;\n+  void *return_object;\n \n   /* Interface version check.  */\n   if (version != 1)\n@@ -334,8 +335,15 @@ PERSONALITY_FUNCTION (int version,\n     }\n \n  install_context:\n+  if (saw_cleanup == 0)\n+    {\n+      return_object = xh->value;\n+      if (!(actions & _UA_SEARCH_PHASE))\n+\t_Unwind_DeleteException(&xh->base);\n+    }\n+  \n   _Unwind_SetGR (context, __builtin_eh_return_data_regno (0),\n-\t\t __builtin_extend_pointer (xh->value));\n+\t\t __builtin_extend_pointer (saw_cleanup ? xh : return_object));\n   _Unwind_SetGR (context, __builtin_eh_return_data_regno (1),\n \t\t handler_switch_value);\n   _Unwind_SetIP (context, landing_pad);"}]}