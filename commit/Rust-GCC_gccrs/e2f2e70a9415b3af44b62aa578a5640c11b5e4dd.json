{"sha": "e2f2e70a9415b3af44b62aa578a5640c11b5e4dd", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6ZTJmMmU3MGE5NDE1YjNhZjQ0YjYyYWE1NzhhNTY0MGMxMWI1ZTRkZA==", "commit": {"author": {"name": "Anthony Green", "email": "green@redhat.com", "date": "2002-01-31T22:25:31Z"}, "committer": {"name": "Anthony Green", "email": "green@gcc.gnu.org", "date": "2002-01-31T22:25:31Z"}, "message": "Configure changes to enable cross compiling.\n\nFrom-SVN: r49378", "tree": {"sha": "a85355fa34fcf0c5da3911b0f3fddb0aa26890d7", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/a85355fa34fcf0c5da3911b0f3fddb0aa26890d7"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/e2f2e70a9415b3af44b62aa578a5640c11b5e4dd", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/e2f2e70a9415b3af44b62aa578a5640c11b5e4dd", "html_url": "https://github.com/Rust-GCC/gccrs/commit/e2f2e70a9415b3af44b62aa578a5640c11b5e4dd", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/e2f2e70a9415b3af44b62aa578a5640c11b5e4dd/comments", "author": {"login": "atgreen", "id": 89993, "node_id": "MDQ6VXNlcjg5OTkz", "avatar_url": "https://avatars.githubusercontent.com/u/89993?v=4", "gravatar_id": "", "url": "https://api.github.com/users/atgreen", "html_url": "https://github.com/atgreen", "followers_url": "https://api.github.com/users/atgreen/followers", "following_url": "https://api.github.com/users/atgreen/following{/other_user}", "gists_url": "https://api.github.com/users/atgreen/gists{/gist_id}", "starred_url": "https://api.github.com/users/atgreen/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/atgreen/subscriptions", "organizations_url": "https://api.github.com/users/atgreen/orgs", "repos_url": "https://api.github.com/users/atgreen/repos", "events_url": "https://api.github.com/users/atgreen/events{/privacy}", "received_events_url": "https://api.github.com/users/atgreen/received_events", "type": "User", "site_admin": false}, "committer": null, "parents": [{"sha": "98884b267644fd8cc217c77d820e490fb7ce8625", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/98884b267644fd8cc217c77d820e490fb7ce8625", "html_url": "https://github.com/Rust-GCC/gccrs/commit/98884b267644fd8cc217c77d820e490fb7ce8625"}], "stats": {"total": 456, "additions": 301, "deletions": 155}, "files": [{"sha": "2c59c6a3e43d5c48718ba7f5797aa35a6ad6620c", "filename": "libffi/ChangeLog", "status": "modified", "additions": 8, "deletions": 0, "changes": 8, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/e2f2e70a9415b3af44b62aa578a5640c11b5e4dd/libffi%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/e2f2e70a9415b3af44b62aa578a5640c11b5e4dd/libffi%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libffi%2FChangeLog?ref=e2f2e70a9415b3af44b62aa578a5640c11b5e4dd", "patch": "@@ -1,3 +1,11 @@\n+2002-01-31  Anthony Green  <green@redhat.com>\n+\n+\t* configure: Rebuilt.\n+\t* configure.in: Replace CHECK_SIZEOF and endian tests with\n+\tcross-compiler friendly macros.\n+\t* aclocal.m4 (AC_COMPILE_CHECK_SIZEOF, AC_C_BIGENDIAN_CROSS): New\n+\tmacros.\n+\n 2002-01-18  David Edelsohn  <edelsohn@gnu.org>\n \n \t* src/powerpc/darwin.S (_ffi_call_AIX): New."}, {"sha": "6d59d179c02cea5c45a83e03147293549a843253", "filename": "libffi/aclocal.m4", "status": "modified", "additions": 96, "deletions": 0, "changes": 96, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/e2f2e70a9415b3af44b62aa578a5640c11b5e4dd/libffi%2Faclocal.m4", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/e2f2e70a9415b3af44b62aa578a5640c11b5e4dd/libffi%2Faclocal.m4", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libffi%2Faclocal.m4?ref=e2f2e70a9415b3af44b62aa578a5640c11b5e4dd", "patch": "@@ -19,6 +19,102 @@ AC_DEFUN([AC_PROG_LIBTOOL],)\n AC_SUBST(LIBTOOL)\n ])\n \n+AC_DEFUN([AC_COMPILE_CHECK_SIZEOF],\n+[changequote(<<, >>)dnl\n+dnl The name to #define.\n+define(<<AC_TYPE_NAME>>, translit(sizeof_$1, [a-z *], [A-Z_P]))dnl\n+dnl The cache variable name.\n+define(<<AC_CV_NAME>>, translit(ac_cv_sizeof_$1, [ *], [_p]))dnl\n+changequote([, ])dnl\n+AC_MSG_CHECKING(size of $1)\n+AC_CACHE_VAL(AC_CV_NAME,\n+[for ac_size in 4 8 1 2 16 12 $2 ; do # List sizes in rough order of prevalence.\n+  AC_TRY_COMPILE([#include \"confdefs.h\"\n+#include <sys/types.h>\n+$2\n+], [switch (0) case 0: case (sizeof ($1) == $ac_size):;], AC_CV_NAME=$ac_size)\n+  if test x$AC_CV_NAME != x ; then break; fi\n+done\n+])\n+if test x$AC_CV_NAME = x ; then\n+  AC_MSG_ERROR([cannot determine a size for $1])\n+fi\n+AC_MSG_RESULT($AC_CV_NAME)\n+AC_DEFINE_UNQUOTED(AC_TYPE_NAME, $AC_CV_NAME, [The number of bytes in type $1])\n+undefine([AC_TYPE_NAME])dnl\n+undefine([AC_CV_NAME])dnl\n+])\n+\n+AC_DEFUN([AC_C_BIGENDIAN_CROSS],\n+[AC_CACHE_CHECK(whether byte ordering is bigendian, ac_cv_c_bigendian,\n+[ac_cv_c_bigendian=unknown\n+# See if sys/param.h defines the BYTE_ORDER macro.\n+AC_TRY_COMPILE([#include <sys/types.h>\n+#include <sys/param.h>], [\n+#if !BYTE_ORDER || !BIG_ENDIAN || !LITTLE_ENDIAN\n+ bogus endian macros\n+#endif], [# It does; now see whether it defined to BIG_ENDIAN or not.\n+AC_TRY_COMPILE([#include <sys/types.h>\n+#include <sys/param.h>], [\n+#if BYTE_ORDER != BIG_ENDIAN\n+ not big endian\n+#endif], ac_cv_c_bigendian=yes, ac_cv_c_bigendian=no)])\n+if test $ac_cv_c_bigendian = unknown; then\n+AC_TRY_RUN([main () {\n+  /* Are we little or big endian?  From Harbison&Steele.  */\n+  union\n+  {\n+    long l;\n+    char c[sizeof (long)];\n+  } u;\n+  u.l = 1;\n+  exit (u.c[sizeof (long) - 1] == 1);\n+}], ac_cv_c_bigendian=no, ac_cv_c_bigendian=yes,\n+[ echo $ac_n \"cross-compiling... \" 2>&AC_FD_MSG ])\n+fi])\n+if test $ac_cv_c_bigendian = unknown; then\n+AC_MSG_CHECKING(to probe for byte ordering)\n+[\n+cat >conftest.c <<EOF\n+short ascii_mm[] = { 0x4249, 0x4765, 0x6E44, 0x6961, 0x6E53, 0x7953, 0 };\n+short ascii_ii[] = { 0x694C, 0x5454, 0x656C, 0x6E45, 0x6944, 0x6E61, 0 };\n+void _ascii() { char* s = (char*) ascii_mm; s = (char*) ascii_ii; }\n+short ebcdic_ii[] = { 0x89D3, 0xE3E3, 0x8593, 0x95C5, 0x89C4, 0x9581, 0 };\n+short ebcdic_mm[] = { 0xC2C9, 0xC785, 0x95C4, 0x8981, 0x95E2, 0xA8E2, 0 };\n+void _ebcdic() { char* s = (char*) ebcdic_mm; s = (char*) ebcdic_ii; }\n+int main() { _ascii (); _ebcdic (); return 0; }\n+EOF\n+] if test -f conftest.c ; then\n+     if ${CC-cc} ${CFLAGS} conftest.c -o conftest.o && test -f conftest.o ; then\n+        if test `grep -l BIGenDianSyS conftest.o` ; then\n+           echo $ac_n ' big endian probe OK, ' 1>&AC_FD_MSG\n+           ac_cv_c_bigendian=yes\n+        fi\n+        if test `grep -l LiTTleEnDian conftest.o` ; then\n+           echo $ac_n ' little endian probe OK, ' 1>&AC_FD_MSG\n+           if test $ac_cv_c_bigendian = yes ; then\n+            ac_cv_c_bigendian=unknown;\n+           else\n+            ac_cv_c_bigendian=no\n+           fi\n+        fi\n+        echo $ac_n 'guessing bigendian ...  ' >&AC_FD_MSG\n+     fi\n+  fi\n+AC_MSG_RESULT($ac_cv_c_bigendian)\n+fi\n+if test $ac_cv_c_bigendian = yes; then\n+  AC_DEFINE(WORDS_BIGENDIAN, 1, [whether byteorder is bigendian])\n+  BYTEORDER=4321\n+else\n+  BYTEORDER=1234\n+fi\n+AC_DEFINE_UNQUOTED(BYTEORDER, $BYTEORDER, [1234 = LIL_ENDIAN, 4321 = BIGENDIAN])\n+if test $ac_cv_c_bigendian = unknown; then\n+  AC_MSG_ERROR(unknown endianess - sorry, please pre-set ac_cv_c_bigendian)\n+fi\n+])\n+\n # Like AC_CONFIG_HEADER, but automatically create stamp file.\n \n AC_DEFUN(AM_CONFIG_HEADER,"}, {"sha": "4789f8568cd565474b5d5ab04ced92e40943b1d9", "filename": "libffi/configure", "status": "modified", "additions": 187, "deletions": 145, "changes": 332, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/e2f2e70a9415b3af44b62aa578a5640c11b5e4dd/libffi%2Fconfigure", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/e2f2e70a9415b3af44b62aa578a5640c11b5e4dd/libffi%2Fconfigure", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libffi%2Fconfigure?ref=e2f2e70a9415b3af44b62aa578a5640c11b5e4dd", "patch": "@@ -2979,33 +2979,33 @@ echo \"configure:2979: checking size of short\" >&5\n if eval \"test \\\"`echo '$''{'ac_cv_sizeof_short'+set}'`\\\" = set\"; then\n   echo $ac_n \"(cached) $ac_c\" 1>&6\n else\n-  if test \"$cross_compiling\" = yes; then\n-    { echo \"configure: error: can not run test program while cross compiling\" 1>&2; exit 1; }\n-else\n+  for ac_size in 4 8 1 2 16 12  ; do # List sizes in rough order of prevalence.\n   cat > conftest.$ac_ext <<EOF\n-#line 2987 \"configure\"\n+#line 2985 \"configure\"\n #include \"confdefs.h\"\n-#include <stdio.h>\n-main()\n-{\n-  FILE *f=fopen(\"conftestval\", \"w\");\n-  if (!f) exit(1);\n-  fprintf(f, \"%d\\n\", sizeof(short));\n-  exit(0);\n-}\n+#include \"confdefs.h\"\n+#include <sys/types.h>\n+\n+\n+int main() {\n+switch (0) case 0: case (sizeof (short) == $ac_size):;\n+; return 0; }\n EOF\n-if { (eval echo configure:2998: \\\"$ac_link\\\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest${ac_exeext} && (./conftest; exit) 2>/dev/null\n-then\n-  ac_cv_sizeof_short=`cat conftestval`\n+if { (eval echo configure:2995: \\\"$ac_compile\\\") 1>&5; (eval $ac_compile) 2>&5; }; then\n+  rm -rf conftest*\n+  ac_cv_sizeof_short=$ac_size\n else\n   echo \"configure: failed program was:\" >&5\n   cat conftest.$ac_ext >&5\n-  rm -fr conftest*\n-  ac_cv_sizeof_short=0\n fi\n-rm -fr conftest*\n+rm -f conftest*\n+  if test x$ac_cv_sizeof_short != x ; then break; fi\n+done\n+\n fi\n \n+if test x$ac_cv_sizeof_short = x ; then\n+  { echo \"configure: error: cannot determine a size for short\" 1>&2; exit 1; }\n fi\n echo \"$ac_t\"\"$ac_cv_sizeof_short\" 1>&6\n cat >> confdefs.h <<EOF\n@@ -3018,33 +3018,33 @@ echo \"configure:3018: checking size of int\" >&5\n if eval \"test \\\"`echo '$''{'ac_cv_sizeof_int'+set}'`\\\" = set\"; then\n   echo $ac_n \"(cached) $ac_c\" 1>&6\n else\n-  if test \"$cross_compiling\" = yes; then\n-    { echo \"configure: error: can not run test program while cross compiling\" 1>&2; exit 1; }\n-else\n+  for ac_size in 4 8 1 2 16 12  ; do # List sizes in rough order of prevalence.\n   cat > conftest.$ac_ext <<EOF\n-#line 3026 \"configure\"\n+#line 3024 \"configure\"\n #include \"confdefs.h\"\n-#include <stdio.h>\n-main()\n-{\n-  FILE *f=fopen(\"conftestval\", \"w\");\n-  if (!f) exit(1);\n-  fprintf(f, \"%d\\n\", sizeof(int));\n-  exit(0);\n-}\n+#include \"confdefs.h\"\n+#include <sys/types.h>\n+\n+\n+int main() {\n+switch (0) case 0: case (sizeof (int) == $ac_size):;\n+; return 0; }\n EOF\n-if { (eval echo configure:3037: \\\"$ac_link\\\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest${ac_exeext} && (./conftest; exit) 2>/dev/null\n-then\n-  ac_cv_sizeof_int=`cat conftestval`\n+if { (eval echo configure:3034: \\\"$ac_compile\\\") 1>&5; (eval $ac_compile) 2>&5; }; then\n+  rm -rf conftest*\n+  ac_cv_sizeof_int=$ac_size\n else\n   echo \"configure: failed program was:\" >&5\n   cat conftest.$ac_ext >&5\n-  rm -fr conftest*\n-  ac_cv_sizeof_int=0\n fi\n-rm -fr conftest*\n+rm -f conftest*\n+  if test x$ac_cv_sizeof_int != x ; then break; fi\n+done\n+\n fi\n \n+if test x$ac_cv_sizeof_int = x ; then\n+  { echo \"configure: error: cannot determine a size for int\" 1>&2; exit 1; }\n fi\n echo \"$ac_t\"\"$ac_cv_sizeof_int\" 1>&6\n cat >> confdefs.h <<EOF\n@@ -3057,33 +3057,33 @@ echo \"configure:3057: checking size of long\" >&5\n if eval \"test \\\"`echo '$''{'ac_cv_sizeof_long'+set}'`\\\" = set\"; then\n   echo $ac_n \"(cached) $ac_c\" 1>&6\n else\n-  if test \"$cross_compiling\" = yes; then\n-    { echo \"configure: error: can not run test program while cross compiling\" 1>&2; exit 1; }\n-else\n+  for ac_size in 4 8 1 2 16 12  ; do # List sizes in rough order of prevalence.\n   cat > conftest.$ac_ext <<EOF\n-#line 3065 \"configure\"\n+#line 3063 \"configure\"\n #include \"confdefs.h\"\n-#include <stdio.h>\n-main()\n-{\n-  FILE *f=fopen(\"conftestval\", \"w\");\n-  if (!f) exit(1);\n-  fprintf(f, \"%d\\n\", sizeof(long));\n-  exit(0);\n-}\n+#include \"confdefs.h\"\n+#include <sys/types.h>\n+\n+\n+int main() {\n+switch (0) case 0: case (sizeof (long) == $ac_size):;\n+; return 0; }\n EOF\n-if { (eval echo configure:3076: \\\"$ac_link\\\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest${ac_exeext} && (./conftest; exit) 2>/dev/null\n-then\n-  ac_cv_sizeof_long=`cat conftestval`\n+if { (eval echo configure:3073: \\\"$ac_compile\\\") 1>&5; (eval $ac_compile) 2>&5; }; then\n+  rm -rf conftest*\n+  ac_cv_sizeof_long=$ac_size\n else\n   echo \"configure: failed program was:\" >&5\n   cat conftest.$ac_ext >&5\n-  rm -fr conftest*\n-  ac_cv_sizeof_long=0\n fi\n-rm -fr conftest*\n+rm -f conftest*\n+  if test x$ac_cv_sizeof_long != x ; then break; fi\n+done\n+\n fi\n \n+if test x$ac_cv_sizeof_long = x ; then\n+  { echo \"configure: error: cannot determine a size for long\" 1>&2; exit 1; }\n fi\n echo \"$ac_t\"\"$ac_cv_sizeof_long\" 1>&6\n cat >> confdefs.h <<EOF\n@@ -3096,33 +3096,33 @@ echo \"configure:3096: checking size of long long\" >&5\n if eval \"test \\\"`echo '$''{'ac_cv_sizeof_long_long'+set}'`\\\" = set\"; then\n   echo $ac_n \"(cached) $ac_c\" 1>&6\n else\n-  if test \"$cross_compiling\" = yes; then\n-    { echo \"configure: error: can not run test program while cross compiling\" 1>&2; exit 1; }\n-else\n+  for ac_size in 4 8 1 2 16 12  ; do # List sizes in rough order of prevalence.\n   cat > conftest.$ac_ext <<EOF\n-#line 3104 \"configure\"\n+#line 3102 \"configure\"\n #include \"confdefs.h\"\n-#include <stdio.h>\n-main()\n-{\n-  FILE *f=fopen(\"conftestval\", \"w\");\n-  if (!f) exit(1);\n-  fprintf(f, \"%d\\n\", sizeof(long long));\n-  exit(0);\n-}\n+#include \"confdefs.h\"\n+#include <sys/types.h>\n+\n+\n+int main() {\n+switch (0) case 0: case (sizeof (long long) == $ac_size):;\n+; return 0; }\n EOF\n-if { (eval echo configure:3115: \\\"$ac_link\\\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest${ac_exeext} && (./conftest; exit) 2>/dev/null\n-then\n-  ac_cv_sizeof_long_long=`cat conftestval`\n+if { (eval echo configure:3112: \\\"$ac_compile\\\") 1>&5; (eval $ac_compile) 2>&5; }; then\n+  rm -rf conftest*\n+  ac_cv_sizeof_long_long=$ac_size\n else\n   echo \"configure: failed program was:\" >&5\n   cat conftest.$ac_ext >&5\n-  rm -fr conftest*\n-  ac_cv_sizeof_long_long=0\n fi\n-rm -fr conftest*\n+rm -f conftest*\n+  if test x$ac_cv_sizeof_long_long != x ; then break; fi\n+done\n+\n fi\n \n+if test x$ac_cv_sizeof_long_long = x ; then\n+  { echo \"configure: error: cannot determine a size for long long\" 1>&2; exit 1; }\n fi\n echo \"$ac_t\"\"$ac_cv_sizeof_long_long\" 1>&6\n cat >> confdefs.h <<EOF\n@@ -3135,33 +3135,33 @@ echo \"configure:3135: checking size of float\" >&5\n if eval \"test \\\"`echo '$''{'ac_cv_sizeof_float'+set}'`\\\" = set\"; then\n   echo $ac_n \"(cached) $ac_c\" 1>&6\n else\n-  if test \"$cross_compiling\" = yes; then\n-    { echo \"configure: error: can not run test program while cross compiling\" 1>&2; exit 1; }\n-else\n+  for ac_size in 4 8 1 2 16 12  ; do # List sizes in rough order of prevalence.\n   cat > conftest.$ac_ext <<EOF\n-#line 3143 \"configure\"\n+#line 3141 \"configure\"\n #include \"confdefs.h\"\n-#include <stdio.h>\n-main()\n-{\n-  FILE *f=fopen(\"conftestval\", \"w\");\n-  if (!f) exit(1);\n-  fprintf(f, \"%d\\n\", sizeof(float));\n-  exit(0);\n-}\n+#include \"confdefs.h\"\n+#include <sys/types.h>\n+\n+\n+int main() {\n+switch (0) case 0: case (sizeof (float) == $ac_size):;\n+; return 0; }\n EOF\n-if { (eval echo configure:3154: \\\"$ac_link\\\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest${ac_exeext} && (./conftest; exit) 2>/dev/null\n-then\n-  ac_cv_sizeof_float=`cat conftestval`\n+if { (eval echo configure:3151: \\\"$ac_compile\\\") 1>&5; (eval $ac_compile) 2>&5; }; then\n+  rm -rf conftest*\n+  ac_cv_sizeof_float=$ac_size\n else\n   echo \"configure: failed program was:\" >&5\n   cat conftest.$ac_ext >&5\n-  rm -fr conftest*\n-  ac_cv_sizeof_float=0\n fi\n-rm -fr conftest*\n+rm -f conftest*\n+  if test x$ac_cv_sizeof_float != x ; then break; fi\n+done\n+\n fi\n \n+if test x$ac_cv_sizeof_float = x ; then\n+  { echo \"configure: error: cannot determine a size for float\" 1>&2; exit 1; }\n fi\n echo \"$ac_t\"\"$ac_cv_sizeof_float\" 1>&6\n cat >> confdefs.h <<EOF\n@@ -3174,33 +3174,33 @@ echo \"configure:3174: checking size of double\" >&5\n if eval \"test \\\"`echo '$''{'ac_cv_sizeof_double'+set}'`\\\" = set\"; then\n   echo $ac_n \"(cached) $ac_c\" 1>&6\n else\n-  if test \"$cross_compiling\" = yes; then\n-    { echo \"configure: error: can not run test program while cross compiling\" 1>&2; exit 1; }\n-else\n+  for ac_size in 4 8 1 2 16 12  ; do # List sizes in rough order of prevalence.\n   cat > conftest.$ac_ext <<EOF\n-#line 3182 \"configure\"\n+#line 3180 \"configure\"\n #include \"confdefs.h\"\n-#include <stdio.h>\n-main()\n-{\n-  FILE *f=fopen(\"conftestval\", \"w\");\n-  if (!f) exit(1);\n-  fprintf(f, \"%d\\n\", sizeof(double));\n-  exit(0);\n-}\n+#include \"confdefs.h\"\n+#include <sys/types.h>\n+\n+\n+int main() {\n+switch (0) case 0: case (sizeof (double) == $ac_size):;\n+; return 0; }\n EOF\n-if { (eval echo configure:3193: \\\"$ac_link\\\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest${ac_exeext} && (./conftest; exit) 2>/dev/null\n-then\n-  ac_cv_sizeof_double=`cat conftestval`\n+if { (eval echo configure:3190: \\\"$ac_compile\\\") 1>&5; (eval $ac_compile) 2>&5; }; then\n+  rm -rf conftest*\n+  ac_cv_sizeof_double=$ac_size\n else\n   echo \"configure: failed program was:\" >&5\n   cat conftest.$ac_ext >&5\n-  rm -fr conftest*\n-  ac_cv_sizeof_double=0\n fi\n-rm -fr conftest*\n+rm -f conftest*\n+  if test x$ac_cv_sizeof_double != x ; then break; fi\n+done\n+\n fi\n \n+if test x$ac_cv_sizeof_double = x ; then\n+  { echo \"configure: error: cannot determine a size for double\" 1>&2; exit 1; }\n fi\n echo \"$ac_t\"\"$ac_cv_sizeof_double\" 1>&6\n cat >> confdefs.h <<EOF\n@@ -3213,33 +3213,33 @@ echo \"configure:3213: checking size of long double\" >&5\n if eval \"test \\\"`echo '$''{'ac_cv_sizeof_long_double'+set}'`\\\" = set\"; then\n   echo $ac_n \"(cached) $ac_c\" 1>&6\n else\n-  if test \"$cross_compiling\" = yes; then\n-    { echo \"configure: error: can not run test program while cross compiling\" 1>&2; exit 1; }\n-else\n+  for ac_size in 4 8 1 2 16 12  ; do # List sizes in rough order of prevalence.\n   cat > conftest.$ac_ext <<EOF\n-#line 3221 \"configure\"\n+#line 3219 \"configure\"\n #include \"confdefs.h\"\n-#include <stdio.h>\n-main()\n-{\n-  FILE *f=fopen(\"conftestval\", \"w\");\n-  if (!f) exit(1);\n-  fprintf(f, \"%d\\n\", sizeof(long double));\n-  exit(0);\n-}\n+#include \"confdefs.h\"\n+#include <sys/types.h>\n+\n+\n+int main() {\n+switch (0) case 0: case (sizeof (long double) == $ac_size):;\n+; return 0; }\n EOF\n-if { (eval echo configure:3232: \\\"$ac_link\\\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest${ac_exeext} && (./conftest; exit) 2>/dev/null\n-then\n-  ac_cv_sizeof_long_double=`cat conftestval`\n+if { (eval echo configure:3229: \\\"$ac_compile\\\") 1>&5; (eval $ac_compile) 2>&5; }; then\n+  rm -rf conftest*\n+  ac_cv_sizeof_long_double=$ac_size\n else\n   echo \"configure: failed program was:\" >&5\n   cat conftest.$ac_ext >&5\n-  rm -fr conftest*\n-  ac_cv_sizeof_long_double=0\n fi\n-rm -fr conftest*\n+rm -f conftest*\n+  if test x$ac_cv_sizeof_long_double != x ; then break; fi\n+done\n+\n fi\n \n+if test x$ac_cv_sizeof_long_double = x ; then\n+  { echo \"configure: error: cannot determine a size for long double\" 1>&2; exit 1; }\n fi\n echo \"$ac_t\"\"$ac_cv_sizeof_long_double\" 1>&6\n cat >> confdefs.h <<EOF\n@@ -3253,33 +3253,33 @@ echo \"configure:3253: checking size of void *\" >&5\n if eval \"test \\\"`echo '$''{'ac_cv_sizeof_void_p'+set}'`\\\" = set\"; then\n   echo $ac_n \"(cached) $ac_c\" 1>&6\n else\n-  if test \"$cross_compiling\" = yes; then\n-    { echo \"configure: error: can not run test program while cross compiling\" 1>&2; exit 1; }\n-else\n+  for ac_size in 4 8 1 2 16 12  ; do # List sizes in rough order of prevalence.\n   cat > conftest.$ac_ext <<EOF\n-#line 3261 \"configure\"\n+#line 3259 \"configure\"\n #include \"confdefs.h\"\n-#include <stdio.h>\n-main()\n-{\n-  FILE *f=fopen(\"conftestval\", \"w\");\n-  if (!f) exit(1);\n-  fprintf(f, \"%d\\n\", sizeof(void *));\n-  exit(0);\n-}\n+#include \"confdefs.h\"\n+#include <sys/types.h>\n+\n+\n+int main() {\n+switch (0) case 0: case (sizeof (void *) == $ac_size):;\n+; return 0; }\n EOF\n-if { (eval echo configure:3272: \\\"$ac_link\\\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest${ac_exeext} && (./conftest; exit) 2>/dev/null\n-then\n-  ac_cv_sizeof_void_p=`cat conftestval`\n+if { (eval echo configure:3269: \\\"$ac_compile\\\") 1>&5; (eval $ac_compile) 2>&5; }; then\n+  rm -rf conftest*\n+  ac_cv_sizeof_void_p=$ac_size\n else\n   echo \"configure: failed program was:\" >&5\n   cat conftest.$ac_ext >&5\n-  rm -fr conftest*\n-  ac_cv_sizeof_void_p=0\n fi\n-rm -fr conftest*\n+rm -f conftest*\n+  if test x$ac_cv_sizeof_void_p != x ; then break; fi\n+done\n+\n fi\n \n+if test x$ac_cv_sizeof_void_p = x ; then\n+  { echo \"configure: error: cannot determine a size for void *\" 1>&2; exit 1; }\n fi\n echo \"$ac_t\"\"$ac_cv_sizeof_void_p\" 1>&6\n cat >> confdefs.h <<EOF\n@@ -3338,7 +3338,7 @@ fi\n rm -f conftest*\n if test $ac_cv_c_bigendian = unknown; then\n if test \"$cross_compiling\" = yes; then\n-    { echo \"configure: error: can not run test program while cross compiling\" 1>&2; exit 1; }\n+   echo $ac_n \"cross-compiling... \" 2>&6 \n else\n   cat > conftest.$ac_ext <<EOF\n #line 3345 \"configure\"\n@@ -3370,11 +3370,53 @@ fi\n fi\n \n echo \"$ac_t\"\"$ac_cv_c_bigendian\" 1>&6\n+if test $ac_cv_c_bigendian = unknown; then\n+echo $ac_n \"checking to probe for byte ordering\"\"... $ac_c\" 1>&6\n+echo \"configure:3376: checking to probe for byte ordering\" >&5\n+\n+cat >conftest.c <<EOF\n+short ascii_mm[] = { 0x4249, 0x4765, 0x6E44, 0x6961, 0x6E53, 0x7953, 0 };\n+short ascii_ii[] = { 0x694C, 0x5454, 0x656C, 0x6E45, 0x6944, 0x6E61, 0 };\n+void _ascii() { char* s = (char*) ascii_mm; s = (char*) ascii_ii; }\n+short ebcdic_ii[] = { 0x89D3, 0xE3E3, 0x8593, 0x95C5, 0x89C4, 0x9581, 0 };\n+short ebcdic_mm[] = { 0xC2C9, 0xC785, 0x95C4, 0x8981, 0x95E2, 0xA8E2, 0 };\n+void _ebcdic() { char* s = (char*) ebcdic_mm; s = (char*) ebcdic_ii; }\n+int main() { _ascii (); _ebcdic (); return 0; }\n+EOF\n+ if test -f conftest.c ; then\n+     if ${CC-cc} ${CFLAGS} conftest.c -o conftest.o && test -f conftest.o ; then\n+        if test `grep -l BIGenDianSyS conftest.o` ; then\n+           echo $ac_n ' big endian probe OK, ' 1>&6\n+           ac_cv_c_bigendian=yes\n+        fi\n+        if test `grep -l LiTTleEnDian conftest.o` ; then\n+           echo $ac_n ' little endian probe OK, ' 1>&6\n+           if test $ac_cv_c_bigendian = yes ; then\n+            ac_cv_c_bigendian=unknown;\n+           else\n+            ac_cv_c_bigendian=no\n+           fi\n+        fi\n+        echo $ac_n 'guessing bigendian ...  ' >&6\n+     fi\n+  fi\n+echo \"$ac_t\"\"$ac_cv_c_bigendian\" 1>&6\n+fi\n if test $ac_cv_c_bigendian = yes; then\n   cat >> confdefs.h <<\\EOF\n #define WORDS_BIGENDIAN 1\n EOF\n \n+  BYTEORDER=4321\n+else\n+  BYTEORDER=1234\n+fi\n+cat >> confdefs.h <<EOF\n+#define BYTEORDER $BYTEORDER\n+EOF\n+\n+if test $ac_cv_c_bigendian = unknown; then\n+  { echo \"configure: error: unknown endianess - sorry\" 1>&2; exit 1; }\n fi\n \n "}, {"sha": "d0f26175afee095ff992deb035c2ab1deee70fdc", "filename": "libffi/configure.in", "status": "modified", "additions": 10, "deletions": 10, "changes": 20, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/e2f2e70a9415b3af44b62aa578a5640c11b5e4dd/libffi%2Fconfigure.in", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/e2f2e70a9415b3af44b62aa578a5640c11b5e4dd/libffi%2Fconfigure.in", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libffi%2Fconfigure.in?ref=e2f2e70a9415b3af44b62aa578a5640c11b5e4dd", "patch": "@@ -84,16 +84,16 @@ AC_CHECK_FUNCS(memcpy)\n AC_FUNC_ALLOCA\n \n dnl AC_CHECK_SIZEOF(char)\n-AC_CHECK_SIZEOF(short)\n-AC_CHECK_SIZEOF(int)\n-AC_CHECK_SIZEOF(long)\n-AC_CHECK_SIZEOF(long long)\n-AC_CHECK_SIZEOF(float)\n-AC_CHECK_SIZEOF(double)\n-AC_CHECK_SIZEOF(long double)\n-\n-AC_CHECK_SIZEOF(void *)\n-AC_C_BIGENDIAN\n+AC_COMPILE_CHECK_SIZEOF(short)\n+AC_COMPILE_CHECK_SIZEOF(int)\n+AC_COMPILE_CHECK_SIZEOF(long)\n+AC_COMPILE_CHECK_SIZEOF(long long)\n+AC_COMPILE_CHECK_SIZEOF(float)\n+AC_COMPILE_CHECK_SIZEOF(double)\n+AC_COMPILE_CHECK_SIZEOF(long double)\n+\n+AC_COMPILE_CHECK_SIZEOF(void *)\n+AC_C_BIGENDIAN_CROSS\n \n AC_SUBST(TARGET)\n AC_SUBST(TARGETDIR)"}]}