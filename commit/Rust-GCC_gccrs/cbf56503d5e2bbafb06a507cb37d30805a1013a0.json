{"sha": "cbf56503d5e2bbafb06a507cb37d30805a1013a0", "node_id": "C_kwDOANBUbNoAKGNiZjU2NTAzZDVlMmJiYWZiMDZhNTA3Y2IzN2QzMDgwNWExMDEzYTA", "commit": {"author": {"name": "Jakub Jelinek", "email": "jakub@redhat.com", "date": "2022-10-31T15:47:23Z"}, "committer": {"name": "Jakub Jelinek", "email": "jakub@redhat.com", "date": "2022-10-31T15:49:04Z"}, "message": "libstdc++: Small extended float support tweaks\n\nThe following patch\n1) enables the std::float128_t overloads for x86 with glibc 2.26+\n2) makes std::nextafter(std::float16_t, std::float16_t) and\n   std::nextafter(std::bfloat16_t, std::bfloat16_t) constexpr\n3) adds (small) testsuite coverage for that\n\n2022-10-21  Jakub Jelinek  <jakub@redhat.com>\n\n\t* config/os/gnu-linux/os_defines.h (_GLIBCXX_HAVE_FLOAT128_MATH):\n\tUncomment.\n\t* include/c_global/cmath (nextafter(_Float16, _Float16)): Make it constexpr.\n\tIf std::__is_constant_evaluated() call __builtin_nextafterf16.\n\t(nextafter(__gnu_cxx::__bfloat16_t, __gnu_cxx::__bfloat16_t)): Similarly\n\tbut call __builtin_nextafterf16b.\n\t* testsuite/26_numerics/headers/cmath/nextafter_c++23.cc (test): Add\n\tstatic assertions to test constexpr nextafter.", "tree": {"sha": "3d61e1c42c25c298261165a927f04cf713fe3191", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/3d61e1c42c25c298261165a927f04cf713fe3191"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/cbf56503d5e2bbafb06a507cb37d30805a1013a0", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/cbf56503d5e2bbafb06a507cb37d30805a1013a0", "html_url": "https://github.com/Rust-GCC/gccrs/commit/cbf56503d5e2bbafb06a507cb37d30805a1013a0", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/cbf56503d5e2bbafb06a507cb37d30805a1013a0/comments", "author": {"login": "jakubjelinek", "id": 9370665, "node_id": "MDQ6VXNlcjkzNzA2NjU=", "avatar_url": "https://avatars.githubusercontent.com/u/9370665?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jakubjelinek", "html_url": "https://github.com/jakubjelinek", "followers_url": "https://api.github.com/users/jakubjelinek/followers", "following_url": "https://api.github.com/users/jakubjelinek/following{/other_user}", "gists_url": "https://api.github.com/users/jakubjelinek/gists{/gist_id}", "starred_url": "https://api.github.com/users/jakubjelinek/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jakubjelinek/subscriptions", "organizations_url": "https://api.github.com/users/jakubjelinek/orgs", "repos_url": "https://api.github.com/users/jakubjelinek/repos", "events_url": "https://api.github.com/users/jakubjelinek/events{/privacy}", "received_events_url": "https://api.github.com/users/jakubjelinek/received_events", "type": "User", "site_admin": false}, "committer": {"login": "jakubjelinek", "id": 9370665, "node_id": "MDQ6VXNlcjkzNzA2NjU=", "avatar_url": "https://avatars.githubusercontent.com/u/9370665?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jakubjelinek", "html_url": "https://github.com/jakubjelinek", "followers_url": "https://api.github.com/users/jakubjelinek/followers", "following_url": "https://api.github.com/users/jakubjelinek/following{/other_user}", "gists_url": "https://api.github.com/users/jakubjelinek/gists{/gist_id}", "starred_url": "https://api.github.com/users/jakubjelinek/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jakubjelinek/subscriptions", "organizations_url": "https://api.github.com/users/jakubjelinek/orgs", "repos_url": "https://api.github.com/users/jakubjelinek/repos", "events_url": "https://api.github.com/users/jakubjelinek/events{/privacy}", "received_events_url": "https://api.github.com/users/jakubjelinek/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "1b07d374765dd811cbb8b3e05764aef3b1754ff2", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/1b07d374765dd811cbb8b3e05764aef3b1754ff2", "html_url": "https://github.com/Rust-GCC/gccrs/commit/1b07d374765dd811cbb8b3e05764aef3b1754ff2"}], "stats": {"total": 12, "additions": 9, "deletions": 3}, "files": [{"sha": "044b4fc91a9ea24aac9f723df20e39c94d6b9fce", "filename": "libstdc++-v3/config/os/gnu-linux/os_defines.h", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/cbf56503d5e2bbafb06a507cb37d30805a1013a0/libstdc%2B%2B-v3%2Fconfig%2Fos%2Fgnu-linux%2Fos_defines.h", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/cbf56503d5e2bbafb06a507cb37d30805a1013a0/libstdc%2B%2B-v3%2Fconfig%2Fos%2Fgnu-linux%2Fos_defines.h", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libstdc%2B%2B-v3%2Fconfig%2Fos%2Fgnu-linux%2Fos_defines.h?ref=cbf56503d5e2bbafb06a507cb37d30805a1013a0", "patch": "@@ -57,7 +57,7 @@\n \t|| (defined(__powerpc__) && defined(_ARCH_PWR8) \\\n \t    && defined(__LITTLE_ENDIAN__) && (_CALL_ELF == 2) \\\n \t    && defined(__FLOAT128__)))\n-//# define _GLIBCXX_HAVE_FLOAT128_MATH 1\n+# define _GLIBCXX_HAVE_FLOAT128_MATH 1\n #endif\n \n #if __GLIBC_PREREQ(2, 27)"}, {"sha": "e52055ac474eeacc85b6a0a0d23410c13538acaf", "filename": "libstdc++-v3/include/c_global/cmath", "status": "modified", "additions": 6, "deletions": 2, "changes": 8, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/cbf56503d5e2bbafb06a507cb37d30805a1013a0/libstdc%2B%2B-v3%2Finclude%2Fc_global%2Fcmath", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/cbf56503d5e2bbafb06a507cb37d30805a1013a0/libstdc%2B%2B-v3%2Finclude%2Fc_global%2Fcmath", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libstdc%2B%2B-v3%2Finclude%2Fc_global%2Fcmath?ref=cbf56503d5e2bbafb06a507cb37d30805a1013a0", "patch": "@@ -2755,9 +2755,11 @@ _GLIBCXX_BEGIN_NAMESPACE_VERSION\n   nearbyint(_Float16 __x)\n   { return _Float16(__builtin_nearbyintf(__x)); }\n \n-  inline _Float16\n+  constexpr _Float16\n   nextafter(_Float16 __x, _Float16 __y)\n   {\n+    if (std::__is_constant_evaluated())\n+      return __builtin_nextafterf16(__x, __y);\n #ifdef __INT16_TYPE__\n     using __float16_int_type = __INT16_TYPE__;\n #else\n@@ -3471,9 +3473,11 @@ _GLIBCXX_BEGIN_NAMESPACE_VERSION\n   nearbyint(__gnu_cxx::__bfloat16_t __x)\n   { return __gnu_cxx::__bfloat16_t(__builtin_nearbyintf(__x)); }\n \n-  inline __gnu_cxx::__bfloat16_t\n+  constexpr __gnu_cxx::__bfloat16_t\n   nextafter(__gnu_cxx::__bfloat16_t __x, __gnu_cxx::__bfloat16_t __y)\n   {\n+    if (std::__is_constant_evaluated())\n+      return __builtin_nextafterf16b(__x, __y);\n #ifdef __INT16_TYPE__\n     using __bfloat16_int_type = __INT16_TYPE__;\n #else"}, {"sha": "8d7daa9208dd392ed4229055e2ee32a82aafb649", "filename": "libstdc++-v3/testsuite/26_numerics/headers/cmath/nextafter_c++23.cc", "status": "modified", "additions": 2, "deletions": 0, "changes": 2, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/cbf56503d5e2bbafb06a507cb37d30805a1013a0/libstdc%2B%2B-v3%2Ftestsuite%2F26_numerics%2Fheaders%2Fcmath%2Fnextafter_c%2B%2B23.cc", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/cbf56503d5e2bbafb06a507cb37d30805a1013a0/libstdc%2B%2B-v3%2Ftestsuite%2F26_numerics%2Fheaders%2Fcmath%2Fnextafter_c%2B%2B23.cc", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libstdc%2B%2B-v3%2Ftestsuite%2F26_numerics%2Fheaders%2Fcmath%2Fnextafter_c%2B%2B23.cc?ref=cbf56503d5e2bbafb06a507cb37d30805a1013a0", "patch": "@@ -100,6 +100,8 @@ test ()\n   VERIFY(std::fpclassify(t36) == FP_NAN);\n   T t37 = std::nextafter(T(-0.0), T());\n   VERIFY(t37 == T() && !std::signbit(t37));\n+  static_assert(std::nextafter(T(1.0), T(2.0)) > T(1.0));\n+  static_assert(std::nextafter(std::nextafter(T(1.0), T(5.0)), T(0.0)) == T(1.0));\n }\n \n int"}]}