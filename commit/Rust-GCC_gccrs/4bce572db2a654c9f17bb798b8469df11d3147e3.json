{"sha": "4bce572db2a654c9f17bb798b8469df11d3147e3", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6NGJjZTU3MmRiMmE2NTRjOWYxN2JiNzk4Yjg0NjlkZjExZDMxNDdlMw==", "commit": {"author": {"name": "Ian Lance Taylor", "email": "ian@gcc.gnu.org", "date": "2011-03-31T22:36:10Z"}, "committer": {"name": "Ian Lance Taylor", "email": "ian@gcc.gnu.org", "date": "2011-03-31T22:36:10Z"}, "message": "re PR go/48242 (gotest needs timeout mechanism)\n\n\tPR go/48242\nlibgo: Add timeout for tests.\n\nFrom-SVN: r171803", "tree": {"sha": "7f9043433b2fefea2592a48ca03d456f776afc88", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/7f9043433b2fefea2592a48ca03d456f776afc88"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/4bce572db2a654c9f17bb798b8469df11d3147e3", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/4bce572db2a654c9f17bb798b8469df11d3147e3", "html_url": "https://github.com/Rust-GCC/gccrs/commit/4bce572db2a654c9f17bb798b8469df11d3147e3", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/4bce572db2a654c9f17bb798b8469df11d3147e3/comments", "author": null, "committer": null, "parents": [{"sha": "c9103dde9636989de0f34dd1656bd2cd477f6fdf", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/c9103dde9636989de0f34dd1656bd2cd477f6fdf", "html_url": "https://github.com/Rust-GCC/gccrs/commit/c9103dde9636989de0f34dd1656bd2cd477f6fdf"}], "stats": {"total": 36, "additions": 35, "deletions": 1}, "files": [{"sha": "6d303cc6f2cd86de8a6f2e45ad1ed8fed0da8c05", "filename": "libgo/go/testing/testing.go", "status": "modified", "additions": 24, "deletions": 0, "changes": 24, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/4bce572db2a654c9f17bb798b8469df11d3147e3/libgo%2Fgo%2Ftesting%2Ftesting.go", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/4bce572db2a654c9f17bb798b8469df11d3147e3/libgo%2Fgo%2Ftesting%2Ftesting.go", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libgo%2Fgo%2Ftesting%2Ftesting.go?ref=4bce572db2a654c9f17bb798b8469df11d3147e3", "patch": "@@ -61,6 +61,7 @@ var (\n \tmemProfile     = flag.String(\"test.memprofile\", \"\", \"write a memory profile to the named file after execution\")\n \tmemProfileRate = flag.Int(\"test.memprofilerate\", 0, \"if >=0, sets runtime.MemProfileRate\")\n \tcpuProfile     = flag.String(\"test.cpuprofile\", \"\", \"write a cpu profile to the named file during execution\")\n+\ttimeout        = flag.Int64(\"test.timeout\", 0, \"if > 0, sets time limit for tests in seconds\")\n )\n \n // Short reports whether the -test.short flag is set.\n@@ -158,7 +159,9 @@ func Main(matchString func(pat, str string) (bool, os.Error), tests []InternalTe\n \tflag.Parse()\n \n \tbefore()\n+\tstartAlarm()\n \tRunTests(matchString, tests)\n+\tstopAlarm()\n \tRunBenchmarks(matchString, benchmarks)\n \tafter()\n }\n@@ -241,3 +244,24 @@ func after() {\n \t\tf.Close()\n \t}\n }\n+\n+var timer *time.Timer\n+\n+// startAlarm starts an alarm if requested.\n+func startAlarm() {\n+\tif *timeout > 0 {\n+\t\ttimer = time.AfterFunc(*timeout*1e9, alarm)\n+\t}\n+}\n+\n+// stopAlarm turns off the alarm.\n+func stopAlarm() {\n+\tif *timeout > 0 {\n+\t\ttimer.Stop()\n+\t}\n+}\n+\n+// alarm is called if the timeout expires.\n+func alarm() {\n+\tpanic(\"test timed out\")\n+}"}, {"sha": "517c0e9f23e6d167293dedd6835a6b45c3b4a591", "filename": "libgo/testsuite/gotest", "status": "modified", "additions": 11, "deletions": 1, "changes": 12, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/4bce572db2a654c9f17bb798b8469df11d3147e3/libgo%2Ftestsuite%2Fgotest", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/4bce572db2a654c9f17bb798b8469df11d3147e3/libgo%2Ftestsuite%2Fgotest", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libgo%2Ftestsuite%2Fgotest?ref=4bce572db2a654c9f17bb798b8469df11d3147e3", "patch": "@@ -32,6 +32,7 @@ loop=true\n keep=false\n prefix=\n dejagnu=no\n+timeout=60\n while $loop; do\n \tcase \"x$1\" in\n         x--srcdir)\n@@ -83,6 +84,15 @@ while $loop; do\n \t\tdejagnu=`echo $1 | sed -e 's/^--dejagnu=//'`\n \t\tshift\n \t\t;;\n+\tx--timeout)\n+\t\ttimeout=$2\n+\t\tshift\n+\t\tshift\n+\t\t;;\n+\tx--timeout=*)\n+\t\ttimeout=`echo $1 | sed -e 's/^--timeout=//'`\n+\t\tshift\n+\t\t;;\n \tx-*)\n \t\tloop=false\n \t\t;;\n@@ -357,7 +367,7 @@ case \"x$dejagnu\" in\n xno)\n \t${GC} -g -c _testmain.go\n \t${GL} *.o ${GOLIBS}\n-\t./a.out -test.short \"$@\"\n+\t./a.out -test.short -test.timeout=$timeout \"$@\"\n \t;;\n xyes)\n \trm -rf ../testsuite/*.o"}]}