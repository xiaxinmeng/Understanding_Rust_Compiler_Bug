{"sha": "38a516638d2ea1fd4dade9bd68ec720ff6fe52f0", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6MzhhNTE2NjM4ZDJlYTFmZDRkYWRlOWJkNjhlYzcyMGZmNmZlNTJmMA==", "commit": {"author": {"name": "Jeff Law", "email": "law@gcc.gnu.org", "date": "2016-01-21T22:58:29Z"}, "committer": {"name": "Jeff Law", "email": "law@gcc.gnu.org", "date": "2016-01-21T22:58:29Z"}, "message": "re PR target/69252 (gcc.dg/vect/vect-iv-9.c FAILs with -Os -fmodulo-sched -fmodulo-sched-allow-regmoves -fsched-pressure)\n\n\tPR target/69252\n\t* modulo-sched.c (optimize_sc):\tAllow branch-scheduling to add a new\n\tfirst stage.\n\n\tPR target/69252\n\t* gcc.target/powerpc/pr69252.c: New test.\n\nFrom-SVN: r232712", "tree": {"sha": "42264c67bcd24264dc9f2bd7ffa1da30ddf7b370", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/42264c67bcd24264dc9f2bd7ffa1da30ddf7b370"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/38a516638d2ea1fd4dade9bd68ec720ff6fe52f0", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/38a516638d2ea1fd4dade9bd68ec720ff6fe52f0", "html_url": "https://github.com/Rust-GCC/gccrs/commit/38a516638d2ea1fd4dade9bd68ec720ff6fe52f0", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/38a516638d2ea1fd4dade9bd68ec720ff6fe52f0/comments", "author": null, "committer": null, "parents": [{"sha": "7f370a2b0c2e613f1dcd47909f82e32033ae2381", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/7f370a2b0c2e613f1dcd47909f82e32033ae2381", "html_url": "https://github.com/Rust-GCC/gccrs/commit/7f370a2b0c2e613f1dcd47909f82e32033ae2381"}], "stats": {"total": 46, "additions": 45, "deletions": 1}, "files": [{"sha": "113d8416768dbaa61c546dd11be36f6aafd57a57", "filename": "gcc/ChangeLog", "status": "modified", "additions": 6, "deletions": 0, "changes": 6, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/38a516638d2ea1fd4dade9bd68ec720ff6fe52f0/gcc%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/38a516638d2ea1fd4dade9bd68ec720ff6fe52f0/gcc%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2FChangeLog?ref=38a516638d2ea1fd4dade9bd68ec720ff6fe52f0", "patch": "@@ -1,3 +1,9 @@\n+2016-01-21  Roman Zhuykov  <zhroma@ispras.ru>\n+\n+\tPR target/69252\n+\t* modulo-sched.c (optimize_sc):\tAllow branch-scheduling to add a new\n+\tfirst stage.\n+\n 2016-01-21  Jeff Law  <law@redhat.com>\n \n \tPR middle-end/69347"}, {"sha": "5dde66c09d38fc14a2286dfe40bfc1b5c8af269c", "filename": "gcc/modulo-sched.c", "status": "modified", "additions": 6, "deletions": 1, "changes": 7, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/38a516638d2ea1fd4dade9bd68ec720ff6fe52f0/gcc%2Fmodulo-sched.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/38a516638d2ea1fd4dade9bd68ec720ff6fe52f0/gcc%2Fmodulo-sched.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fmodulo-sched.c?ref=38a516638d2ea1fd4dade9bd68ec720ff6fe52f0", "patch": "@@ -985,7 +985,7 @@ optimize_sc (partial_schedule_ptr ps, ddg_ptr g)\n       int row = SMODULO (branch_cycle, ps->ii);\n       int num_splits = 0;\n       sbitmap must_precede, must_follow, tmp_precede, tmp_follow;\n-      int c;\n+      int min_cycle, c;\n \n       if (dump_file)\n \tfprintf (dump_file, \"\\nTrying to schedule node %d \"\n@@ -1040,6 +1040,7 @@ optimize_sc (partial_schedule_ptr ps, ddg_ptr g)\n \tif (next_ps_i->id == g->closing_branch->cuid)\n \t  break;\n \n+      min_cycle = PS_MIN_CYCLE (ps) - SMODULO (PS_MIN_CYCLE (ps), ps->ii);\n       remove_node_from_ps (ps, next_ps_i);\n       success =\n \ttry_scheduling_node_in_cycle (ps, g->closing_branch->cuid, c,\n@@ -1079,6 +1080,10 @@ optimize_sc (partial_schedule_ptr ps, ddg_ptr g)\n \t  ok = true;\n \t}\n \n+      /* This might have been added to a new first stage.  */\n+      if (PS_MIN_CYCLE (ps) < min_cycle)\n+\treset_sched_times (ps, 0);\n+\n       free (must_precede);\n       free (must_follow);\n     }"}, {"sha": "540e28960ee1ee03df3314675f6644170b1cd1f1", "filename": "gcc/testsuite/ChangeLog", "status": "modified", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/38a516638d2ea1fd4dade9bd68ec720ff6fe52f0/gcc%2Ftestsuite%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/38a516638d2ea1fd4dade9bd68ec720ff6fe52f0/gcc%2Ftestsuite%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2FChangeLog?ref=38a516638d2ea1fd4dade9bd68ec720ff6fe52f0", "patch": "@@ -1,3 +1,8 @@\n+2016-01-21  Martin Sebor  <msebor@redhat.com>\n+\n+\tPR target/69252\n+\t* gcc.target/powerpc/pr69252.c: New test.\n+\n 2016-01-21  Jerry DeLisle  <jvdelisle@gcc.gnu.org>\n \n \tPR fortran/65996"}, {"sha": "23334a900cb5bad5ea6f9bd524586b157151b6f4", "filename": "gcc/testsuite/gcc.target/powerpc/pr69252.c", "status": "added", "additions": 28, "deletions": 0, "changes": 28, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/38a516638d2ea1fd4dade9bd68ec720ff6fe52f0/gcc%2Ftestsuite%2Fgcc.target%2Fpowerpc%2Fpr69252.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/38a516638d2ea1fd4dade9bd68ec720ff6fe52f0/gcc%2Ftestsuite%2Fgcc.target%2Fpowerpc%2Fpr69252.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgcc.target%2Fpowerpc%2Fpr69252.c?ref=38a516638d2ea1fd4dade9bd68ec720ff6fe52f0", "patch": "@@ -0,0 +1,28 @@\n+/* PR target/69252 - [4.9/5/6 Regression] gcc.dg/vect/vect-iv-9.c FAILs\n+   with -Os -fmodulo-sched -fmodulo-sched-allow-regmoves -fsched-pressure  */\n+/* { dg-do run } */\n+/* { dg-options \"-Os -fmodulo-sched -fmodulo-sched-allow-regmoves -fsched-pressure \" } */\n+#define N 26\n+int a[N];\n+__attribute__ ((noinline, noclone))\n+     int main1 (int X)\n+{\n+  int s = X;\n+  int i;\n+  for (i = 0; i < N; i++)\n+    s += (i + a[i]);\n+  return s;\n+}\n+\n+int\n+main (void)\n+{\n+  int s, i;\n+  for (i = 0; i < N; i++)\n+    a[i] = 2 * i;\n+  s = main1 (3);\n+  if (s != 978)\n+    __builtin_abort ();\n+  return 0;\n+}\n+"}]}