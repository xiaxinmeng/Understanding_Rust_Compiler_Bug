{"sha": "aef836828d33f32ac63d67d0e83180551b5a6fa8", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6YWVmODM2ODI4ZDMzZjMyYWM2M2Q2N2QwZTgzMTgwNTUxYjVhNmZhOA==", "commit": {"author": {"name": "Martin Jambor", "email": "mjambor@suse.cz", "date": "2014-01-17T19:05:52Z"}, "committer": {"name": "Martin Jambor", "email": "jamborm@gcc.gnu.org", "date": "2014-01-17T19:05:52Z"}, "message": "re PR ipa/59736 (ice with -O3 in cgraph_edge_brings_value_p)\n\n2014-01-17  Martin Jambor  <mjambor@suse.cz>\n\n\tPR ipa/59736\n\t* ipa-cp.c (prev_edge_clone): New variable.\n\t(grow_next_edge_clone_vector): Renamed to grow_edge_clone_vectors.\n\tAlso resize prev_edge_clone vector.\n\t(ipcp_edge_duplication_hook): Also update prev_edge_clone.\n\t(ipcp_edge_removal_hook): New function.\n\t(ipcp_driver): Register ipcp_edge_removal_hook.\n\nFrom-SVN: r206729", "tree": {"sha": "99d29bfe2635feedfde70f316326b6f7131e8e24", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/99d29bfe2635feedfde70f316326b6f7131e8e24"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/aef836828d33f32ac63d67d0e83180551b5a6fa8", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/aef836828d33f32ac63d67d0e83180551b5a6fa8", "html_url": "https://github.com/Rust-GCC/gccrs/commit/aef836828d33f32ac63d67d0e83180551b5a6fa8", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/aef836828d33f32ac63d67d0e83180551b5a6fa8/comments", "author": {"login": "jamborm", "id": 2180070, "node_id": "MDQ6VXNlcjIxODAwNzA=", "avatar_url": "https://avatars.githubusercontent.com/u/2180070?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jamborm", "html_url": "https://github.com/jamborm", "followers_url": "https://api.github.com/users/jamborm/followers", "following_url": "https://api.github.com/users/jamborm/following{/other_user}", "gists_url": "https://api.github.com/users/jamborm/gists{/gist_id}", "starred_url": "https://api.github.com/users/jamborm/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jamborm/subscriptions", "organizations_url": "https://api.github.com/users/jamborm/orgs", "repos_url": "https://api.github.com/users/jamborm/repos", "events_url": "https://api.github.com/users/jamborm/events{/privacy}", "received_events_url": "https://api.github.com/users/jamborm/received_events", "type": "User", "site_admin": false}, "committer": null, "parents": [{"sha": "3b9c787b5765717c5284543ef4140bd840b2bf36", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/3b9c787b5765717c5284543ef4140bd840b2bf36", "html_url": "https://github.com/Rust-GCC/gccrs/commit/3b9c787b5765717c5284543ef4140bd840b2bf36"}], "stats": {"total": 50, "additions": 45, "deletions": 5}, "files": [{"sha": "7bf573300077701aca83ca6b2795cfdc101908e9", "filename": "gcc/ChangeLog", "status": "modified", "additions": 10, "deletions": 0, "changes": 10, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/aef836828d33f32ac63d67d0e83180551b5a6fa8/gcc%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/aef836828d33f32ac63d67d0e83180551b5a6fa8/gcc%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2FChangeLog?ref=aef836828d33f32ac63d67d0e83180551b5a6fa8", "patch": "@@ -1,3 +1,13 @@\n+2014-01-17  Martin Jambor  <mjambor@suse.cz>\n+\n+\tPR ipa/59736\n+\t* ipa-cp.c (prev_edge_clone): New variable.\n+\t(grow_next_edge_clone_vector): Renamed to grow_edge_clone_vectors.\n+\tAlso resize prev_edge_clone vector.\n+\t(ipcp_edge_duplication_hook): Also update prev_edge_clone.\n+\t(ipcp_edge_removal_hook): New function.\n+\t(ipcp_driver): Register ipcp_edge_removal_hook.\n+\n 2014-01-17  Andrew Pinski <apinski@cavium.com>\n \t    Steve Ellcey  <sellcey@mips.com>\n "}, {"sha": "10fa4b6c23679973c9fbd2ffe6bbaa3452060c0d", "filename": "gcc/ipa-cp.c", "status": "modified", "additions": 35, "deletions": 5, "changes": 40, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/aef836828d33f32ac63d67d0e83180551b5a6fa8/gcc%2Fipa-cp.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/aef836828d33f32ac63d67d0e83180551b5a6fa8/gcc%2Fipa-cp.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fipa-cp.c?ref=aef836828d33f32ac63d67d0e83180551b5a6fa8", "patch": "@@ -2321,27 +2321,52 @@ ipcp_discover_new_direct_edges (struct cgraph_node *node,\n    edge. */\n \n static vec<cgraph_edge_p> next_edge_clone;\n+static vec<cgraph_edge_p> prev_edge_clone;\n \n static inline void\n-grow_next_edge_clone_vector (void)\n+grow_edge_clone_vectors (void)\n {\n   if (next_edge_clone.length ()\n       <=  (unsigned) cgraph_edge_max_uid)\n     next_edge_clone.safe_grow_cleared (cgraph_edge_max_uid + 1);\n+  if (prev_edge_clone.length ()\n+      <=  (unsigned) cgraph_edge_max_uid)\n+    prev_edge_clone.safe_grow_cleared (cgraph_edge_max_uid + 1);\n }\n \n /* Edge duplication hook to grow the appropriate linked list in\n    next_edge_clone. */\n \n static void\n ipcp_edge_duplication_hook (struct cgraph_edge *src, struct cgraph_edge *dst,\n-\t\t\t    __attribute__((unused)) void *data)\n+\t\t\t    void *)\n {\n-  grow_next_edge_clone_vector ();\n-  next_edge_clone[dst->uid] = next_edge_clone[src->uid];\n+  grow_edge_clone_vectors ();\n+\n+  struct cgraph_edge *old_next = next_edge_clone[src->uid];\n+  if (old_next)\n+    prev_edge_clone[old_next->uid] = dst;\n+  prev_edge_clone[dst->uid] = src;\n+\n+  next_edge_clone[dst->uid] = old_next;\n   next_edge_clone[src->uid] = dst;\n }\n \n+/* Hook that is called by cgraph.c when an edge is removed.  */\n+\n+static void\n+ipcp_edge_removal_hook (struct cgraph_edge *cs, void *)\n+{\n+  grow_edge_clone_vectors ();\n+\n+  struct cgraph_edge *prev = prev_edge_clone[cs->uid];\n+  struct cgraph_edge *next = next_edge_clone[cs->uid];\n+  if (prev)\n+    next_edge_clone[prev->uid] = next;\n+  if (next)\n+    prev_edge_clone[next->uid] = prev;\n+}\n+\n /* See if NODE is a clone with a known aggregate value at a given OFFSET of a\n    parameter with the given INDEX.  */\n \n@@ -3568,13 +3593,17 @@ static unsigned int\n ipcp_driver (void)\n {\n   struct cgraph_2edge_hook_list *edge_duplication_hook_holder;\n+  struct cgraph_edge_hook_list *edge_removal_hook_holder;\n   struct topo_info topo;\n \n   ipa_check_create_node_params ();\n   ipa_check_create_edge_args ();\n-  grow_next_edge_clone_vector ();\n+  grow_edge_clone_vectors ();\n   edge_duplication_hook_holder =\n     cgraph_add_edge_duplication_hook (&ipcp_edge_duplication_hook, NULL);\n+  edge_removal_hook_holder =\n+    cgraph_add_edge_removal_hook (&ipcp_edge_removal_hook, NULL);\n+\n   ipcp_values_pool = create_alloc_pool (\"IPA-CP values\",\n \t\t\t\t\tsizeof (struct ipcp_value), 32);\n   ipcp_sources_pool = create_alloc_pool (\"IPA-CP value sources\",\n@@ -3600,6 +3629,7 @@ ipcp_driver (void)\n   /* Free all IPCP structures.  */\n   free_toporder_info (&topo);\n   next_edge_clone.release ();\n+  cgraph_remove_edge_removal_hook (edge_removal_hook_holder);\n   cgraph_remove_edge_duplication_hook (edge_duplication_hook_holder);\n   ipa_free_all_structures_after_ipa_cp ();\n   if (dump_file)"}]}