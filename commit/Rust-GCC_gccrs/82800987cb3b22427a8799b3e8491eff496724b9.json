{"sha": "82800987cb3b22427a8799b3e8491eff496724b9", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6ODI4MDA5ODdjYjNiMjI0MjdhODc5OWIzZTg0OTFlZmY0OTY3MjRiOQ==", "commit": {"author": {"name": "Kewen Lin", "email": "linkw@linux.ibm.com", "date": "2020-12-02T07:55:34Z"}, "committer": {"name": "Kewen Lin", "email": "linkw@linux.ibm.com", "date": "2020-12-02T07:55:34Z"}, "message": "rs6000: Disable HTM for Power10 and later by default\n\nPower ISA 3.1 has dropped transactional memory support, this patch\nis to disable HTM feature for power10 and later by default.\n\nBootstrapped/regtested on powerpc64le-linux-gnu P8 and P10.\n\ngcc/ChangeLog:\n\n\t* config/rs6000/rs6000.c (rs6000_option_override_internal):\n\tUse OPTION_MASK_DIRECT_MOVE for Power8 target_enable instead\n\tof OPTION_MASK_HTM.\n\t* config/rs6000/rs6000-cpus.def (ISA_2_7_MASKS_SERVER):\n\tRemove OPTION_MASK_HTM.\n\t(RS6000_CPU): Add OPTION_MASK_HTM to power8, power9 and\n\tpowerpc64le entries.", "tree": {"sha": "54520e860d55b30126d5a2f5afb2f28461638b6a", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/54520e860d55b30126d5a2f5afb2f28461638b6a"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/82800987cb3b22427a8799b3e8491eff496724b9", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/82800987cb3b22427a8799b3e8491eff496724b9", "html_url": "https://github.com/Rust-GCC/gccrs/commit/82800987cb3b22427a8799b3e8491eff496724b9", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/82800987cb3b22427a8799b3e8491eff496724b9/comments", "author": {"login": "jedilyn", "id": 38515402, "node_id": "MDQ6VXNlcjM4NTE1NDAy", "avatar_url": "https://avatars.githubusercontent.com/u/38515402?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jedilyn", "html_url": "https://github.com/jedilyn", "followers_url": "https://api.github.com/users/jedilyn/followers", "following_url": "https://api.github.com/users/jedilyn/following{/other_user}", "gists_url": "https://api.github.com/users/jedilyn/gists{/gist_id}", "starred_url": "https://api.github.com/users/jedilyn/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jedilyn/subscriptions", "organizations_url": "https://api.github.com/users/jedilyn/orgs", "repos_url": "https://api.github.com/users/jedilyn/repos", "events_url": "https://api.github.com/users/jedilyn/events{/privacy}", "received_events_url": "https://api.github.com/users/jedilyn/received_events", "type": "User", "site_admin": false}, "committer": {"login": "jedilyn", "id": 38515402, "node_id": "MDQ6VXNlcjM4NTE1NDAy", "avatar_url": "https://avatars.githubusercontent.com/u/38515402?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jedilyn", "html_url": "https://github.com/jedilyn", "followers_url": "https://api.github.com/users/jedilyn/followers", "following_url": "https://api.github.com/users/jedilyn/following{/other_user}", "gists_url": "https://api.github.com/users/jedilyn/gists{/gist_id}", "starred_url": "https://api.github.com/users/jedilyn/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jedilyn/subscriptions", "organizations_url": "https://api.github.com/users/jedilyn/orgs", "repos_url": "https://api.github.com/users/jedilyn/repos", "events_url": "https://api.github.com/users/jedilyn/events{/privacy}", "received_events_url": "https://api.github.com/users/jedilyn/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "018248ef6d03ca0088d5928928f966df99af134c", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/018248ef6d03ca0088d5928928f966df99af134c", "html_url": "https://github.com/Rust-GCC/gccrs/commit/018248ef6d03ca0088d5928928f966df99af134c"}], "stats": {"total": 15, "additions": 9, "deletions": 6}, "files": [{"sha": "482e1b69ddec8fea18a0e4830d55af6d4ac7a0e2", "filename": "gcc/config/rs6000/rs6000-cpus.def", "status": "modified", "additions": 6, "deletions": 4, "changes": 10, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/82800987cb3b22427a8799b3e8491eff496724b9/gcc%2Fconfig%2Frs6000%2Frs6000-cpus.def", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/82800987cb3b22427a8799b3e8491eff496724b9/gcc%2Fconfig%2Frs6000%2Frs6000-cpus.def", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fconfig%2Frs6000%2Frs6000-cpus.def?ref=82800987cb3b22427a8799b3e8491eff496724b9", "patch": "@@ -51,7 +51,6 @@\n \t\t\t\t | OPTION_MASK_CRYPTO\t\t\t\\\n \t\t\t\t | OPTION_MASK_DIRECT_MOVE\t\t\\\n \t\t\t\t | OPTION_MASK_EFFICIENT_UNALIGNED_VSX\t\\\n-\t\t\t\t | OPTION_MASK_HTM\t\t\t\\\n \t\t\t\t | OPTION_MASK_QUAD_MEMORY\t\t\\\n \t\t\t\t | OPTION_MASK_QUAD_MEMORY_ATOMIC)\n \n@@ -240,10 +239,13 @@ RS6000_CPU (\"power6x\", PROCESSOR_POWER6, MASK_POWERPC64 | MASK_PPC_GPOPT\n \t    | MASK_PPC_GFXOPT | MASK_MFCRF | MASK_POPCNTB | MASK_FPRND\n \t    | MASK_CMPB | MASK_DFP | MASK_RECIP_PRECISION)\n RS6000_CPU (\"power7\", PROCESSOR_POWER7, MASK_POWERPC64 | ISA_2_6_MASKS_SERVER)\n-RS6000_CPU (\"power8\", PROCESSOR_POWER8, MASK_POWERPC64 | ISA_2_7_MASKS_SERVER)\n-RS6000_CPU (\"power9\", PROCESSOR_POWER9, MASK_POWERPC64 | ISA_3_0_MASKS_SERVER)\n+RS6000_CPU (\"power8\", PROCESSOR_POWER8, MASK_POWERPC64 | ISA_2_7_MASKS_SERVER\n+\t    | OPTION_MASK_HTM)\n+RS6000_CPU (\"power9\", PROCESSOR_POWER9, MASK_POWERPC64 | ISA_3_0_MASKS_SERVER\n+\t    | OPTION_MASK_HTM)\n RS6000_CPU (\"power10\", PROCESSOR_POWER10, MASK_POWERPC64 | ISA_3_1_MASKS_SERVER)\n RS6000_CPU (\"powerpc\", PROCESSOR_POWERPC, 0)\n RS6000_CPU (\"powerpc64\", PROCESSOR_POWERPC64, MASK_PPC_GFXOPT | MASK_POWERPC64)\n-RS6000_CPU (\"powerpc64le\", PROCESSOR_POWER8, MASK_POWERPC64 | ISA_2_7_MASKS_SERVER)\n+RS6000_CPU (\"powerpc64le\", PROCESSOR_POWER8, MASK_POWERPC64 | ISA_2_7_MASKS_SERVER\n+\t    | OPTION_MASK_HTM)\n RS6000_CPU (\"rs64\", PROCESSOR_RS64A, MASK_PPC_GFXOPT | MASK_POWERPC64)"}, {"sha": "c661f7a8a6c96e3072f5ef78102cfc2485ea9163", "filename": "gcc/config/rs6000/rs6000.c", "status": "modified", "additions": 3, "deletions": 2, "changes": 5, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/82800987cb3b22427a8799b3e8491eff496724b9/gcc%2Fconfig%2Frs6000%2Frs6000.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/82800987cb3b22427a8799b3e8491eff496724b9/gcc%2Fconfig%2Frs6000%2Frs6000.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fconfig%2Frs6000%2Frs6000.c?ref=82800987cb3b22427a8799b3e8491eff496724b9", "patch": "@@ -3808,9 +3808,10 @@ rs6000_option_override_internal (bool global_init_p)\n     }\n \n   /* If little-endian, default to -mstrict-align on older processors.\n-     Testing for htm matches power8 and later.  */\n+     Testing for direct_move matches power8 and later.  */\n   if (!BYTES_BIG_ENDIAN\n-      && !(processor_target_table[tune_index].target_enable & OPTION_MASK_HTM))\n+      && !(processor_target_table[tune_index].target_enable\n+\t   & OPTION_MASK_DIRECT_MOVE))\n     rs6000_isa_flags |= ~rs6000_isa_flags_explicit & OPTION_MASK_STRICT_ALIGN;\n \n   if (!rs6000_fold_gimple)"}]}