{"sha": "2512a443d6c09f42c24dca5dfd4173cdef39c3b1", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6MjUxMmE0NDNkNmMwOWY0MmMyNGRjYTVkZmQ0MTczY2RlZjM5YzNiMQ==", "commit": {"author": {"name": "Jan Hubicka", "email": "jh@suse.cz", "date": "2012-10-08T16:04:31Z"}, "committer": {"name": "Jan Hubicka", "email": "hubicka@gcc.gnu.org", "date": "2012-10-08T16:04:31Z"}, "message": "lto.c (remember_with_vars): Also fixup INTEGER_CST.\n\n\n\t* lto/lto.c (remember_with_vars): Also fixup INTEGER_CST.\n\t(fixup_integer_cst): New functoin.\n\t(lto_ft_type): Fixup BASETYPE of methods and offsets.\n\nFrom-SVN: r192214", "tree": {"sha": "88f8e127758fe18f6fb4dfd8a141d59f86238060", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/88f8e127758fe18f6fb4dfd8a141d59f86238060"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/2512a443d6c09f42c24dca5dfd4173cdef39c3b1", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/2512a443d6c09f42c24dca5dfd4173cdef39c3b1", "html_url": "https://github.com/Rust-GCC/gccrs/commit/2512a443d6c09f42c24dca5dfd4173cdef39c3b1", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/2512a443d6c09f42c24dca5dfd4173cdef39c3b1/comments", "author": null, "committer": null, "parents": [{"sha": "7b19209f2934c0ac28445ff2032747552a390f2f", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/7b19209f2934c0ac28445ff2032747552a390f2f", "html_url": "https://github.com/Rust-GCC/gccrs/commit/7b19209f2934c0ac28445ff2032747552a390f2f"}], "stats": {"total": 31, "additions": 31, "deletions": 0}, "files": [{"sha": "3fc713616ed2af5eafd459d3e74f32e62ee30e80", "filename": "gcc/lto/ChangeLog", "status": "modified", "additions": 6, "deletions": 0, "changes": 6, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/2512a443d6c09f42c24dca5dfd4173cdef39c3b1/gcc%2Flto%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/2512a443d6c09f42c24dca5dfd4173cdef39c3b1/gcc%2Flto%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Flto%2FChangeLog?ref=2512a443d6c09f42c24dca5dfd4173cdef39c3b1", "patch": "@@ -1,3 +1,9 @@\n+2012-10-08  Jan Hubicka  <jh@suse.cz>\n+\n+\t* lto/lto.c (remember_with_vars): Also fixup INTEGER_CST.\n+\t(fixup_integer_cst): New functoin.\n+\t(lto_ft_type): Fixup BASETYPE of methods and offsets.\n+\n 2012-10-07  Jan Hubicka  <jh@suse.cz>\n \n \t* lto.c (read_cgraph_and_symbols): Release type merging hash early;"}, {"sha": "81d7fb3d2e0367968368766ca067a8ffd2423b5e", "filename": "gcc/lto/lto.c", "status": "modified", "additions": 25, "deletions": 0, "changes": 25, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/2512a443d6c09f42c24dca5dfd4173cdef39c3b1/gcc%2Flto%2Flto.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/2512a443d6c09f42c24dca5dfd4173cdef39c3b1/gcc%2Flto%2Flto.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Flto%2Flto.c?ref=2512a443d6c09f42c24dca5dfd4173cdef39c3b1", "patch": "@@ -1408,11 +1408,36 @@ remember_with_vars (tree t)\n \t    (tt) = GIMPLE_REGISTER_TYPE (tt); \\\n \t  if (VAR_OR_FUNCTION_DECL_P (tt) && TREE_PUBLIC (tt)) \\\n \t    remember_with_vars (t); \\\n+\t  if (TREE_CODE (tt) == INTEGER_CST) \\\n+\t    (tt) = fixup_integer_cst (tt); \\\n \t} \\\n     } while (0)\n \n static void lto_fixup_types (tree);\n \n+/* Return integer_cst T with updated type.  */\n+\n+static tree\n+fixup_integer_cst (tree t)\n+{\n+  tree type = GIMPLE_REGISTER_TYPE (TREE_TYPE (t));\n+\n+  if (type == TREE_TYPE (t))\n+    return t;\n+\n+  /* If overflow was set, streamer_read_integer_cst\n+     produced local copy of T. */\n+  if (TREE_OVERFLOW (t))\n+    {\n+      TREE_TYPE (t) = type;\n+      return t;\n+    }\n+  else\n+  /* Otherwise produce new shared node for the new type.  */\n+    return build_int_cst_wide (type, TREE_INT_CST_LOW (t),\n+\t\t\t       TREE_INT_CST_HIGH (t));\n+}\n+\n /* Fix up fields of a tree_typed T.  */\n \n static void"}]}