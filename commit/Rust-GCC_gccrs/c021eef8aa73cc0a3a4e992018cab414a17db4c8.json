{"sha": "c021eef8aa73cc0a3a4e992018cab414a17db4c8", "node_id": "C_kwDOANBUbNoAKGMwMjFlZWY4YWE3M2NjMGEzYTRlOTkyMDE4Y2FiNDE0YTE3ZGI0Yzg", "commit": {"author": {"name": "Arthur Cohen", "email": "arthur.cohen@embecosm.com", "date": "2023-05-26T13:36:23Z"}, "committer": {"name": "CohenArthur", "email": "arthur.cohen@embecosm.com", "date": "2023-06-13T11:52:56Z"}, "message": "derive: Factor common fields inside the base visitor\n\ngcc/rust/ChangeLog:\n\n\t* expand/rust-derive.h: Store AstBuilder and location.\n\t* expand/rust-derive.cc (DeriveVisitor::DeriveVisitor): Update constructor.\n\t* expand/rust-derive-clone.h: Remove members now stored in `DeriveVisitor`.\n\t* expand/rust-derive-copy.h: Likewise.\n\t* expand/rust-derive-clone.cc (DeriveClone::DeriveClone): Update constructor.\n\t* expand/rust-derive-copy.cc (DeriveCopy::DeriveCopy): Likewise.", "tree": {"sha": "6d714a47ee281dadb76bde7f3fb20e0d96dd7cf6", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/6d714a47ee281dadb76bde7f3fb20e0d96dd7cf6"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/c021eef8aa73cc0a3a4e992018cab414a17db4c8", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/c021eef8aa73cc0a3a4e992018cab414a17db4c8", "html_url": "https://github.com/Rust-GCC/gccrs/commit/c021eef8aa73cc0a3a4e992018cab414a17db4c8", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/c021eef8aa73cc0a3a4e992018cab414a17db4c8/comments", "author": {"login": "CohenArthur", "id": 43524065, "node_id": "MDQ6VXNlcjQzNTI0MDY1", "avatar_url": "https://avatars.githubusercontent.com/u/43524065?v=4", "gravatar_id": "", "url": "https://api.github.com/users/CohenArthur", "html_url": "https://github.com/CohenArthur", "followers_url": "https://api.github.com/users/CohenArthur/followers", "following_url": "https://api.github.com/users/CohenArthur/following{/other_user}", "gists_url": "https://api.github.com/users/CohenArthur/gists{/gist_id}", "starred_url": "https://api.github.com/users/CohenArthur/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/CohenArthur/subscriptions", "organizations_url": "https://api.github.com/users/CohenArthur/orgs", "repos_url": "https://api.github.com/users/CohenArthur/repos", "events_url": "https://api.github.com/users/CohenArthur/events{/privacy}", "received_events_url": "https://api.github.com/users/CohenArthur/received_events", "type": "User", "site_admin": false}, "committer": {"login": "CohenArthur", "id": 43524065, "node_id": "MDQ6VXNlcjQzNTI0MDY1", "avatar_url": "https://avatars.githubusercontent.com/u/43524065?v=4", "gravatar_id": "", "url": "https://api.github.com/users/CohenArthur", "html_url": "https://github.com/CohenArthur", "followers_url": "https://api.github.com/users/CohenArthur/followers", "following_url": "https://api.github.com/users/CohenArthur/following{/other_user}", "gists_url": "https://api.github.com/users/CohenArthur/gists{/gist_id}", "starred_url": "https://api.github.com/users/CohenArthur/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/CohenArthur/subscriptions", "organizations_url": "https://api.github.com/users/CohenArthur/orgs", "repos_url": "https://api.github.com/users/CohenArthur/repos", "events_url": "https://api.github.com/users/CohenArthur/events{/privacy}", "received_events_url": "https://api.github.com/users/CohenArthur/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "e43261892fb74f30639302eaff3eee6f626cc384", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/e43261892fb74f30639302eaff3eee6f626cc384", "html_url": "https://github.com/Rust-GCC/gccrs/commit/e43261892fb74f30639302eaff3eee6f626cc384"}], "stats": {"total": 23, "additions": 14, "deletions": 9}, "files": [{"sha": "2ffcafc957b118d9f4871e2e7ace284a2a242a6e", "filename": "gcc/rust/expand/rust-derive-clone.cc", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/c021eef8aa73cc0a3a4e992018cab414a17db4c8/gcc%2Frust%2Fexpand%2Frust-derive-clone.cc", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/c021eef8aa73cc0a3a4e992018cab414a17db4c8/gcc%2Frust%2Fexpand%2Frust-derive-clone.cc", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Frust%2Fexpand%2Frust-derive-clone.cc?ref=c021eef8aa73cc0a3a4e992018cab414a17db4c8", "patch": "@@ -88,7 +88,7 @@ DeriveClone::clone_impl (std::unique_ptr<TraitImplItem> &&clone_fn,\n // TODO: Create new `make_qualified_call` helper function\n \n DeriveClone::DeriveClone (Location loc)\n-  : loc (loc), expanded (nullptr), builder (AstBuilder (loc))\n+  : DeriveVisitor (loc), expanded (nullptr)\n {}\n \n std::unique_ptr<AST::Item>"}, {"sha": "e1fadc7916343c40c136553c0d785d8bfd46af1a", "filename": "gcc/rust/expand/rust-derive-clone.h", "status": "modified", "additions": 1, "deletions": 4, "changes": 5, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/c021eef8aa73cc0a3a4e992018cab414a17db4c8/gcc%2Frust%2Fexpand%2Frust-derive-clone.h", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/c021eef8aa73cc0a3a4e992018cab414a17db4c8/gcc%2Frust%2Fexpand%2Frust-derive-clone.h", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Frust%2Fexpand%2Frust-derive-clone.h?ref=c021eef8aa73cc0a3a4e992018cab414a17db4c8", "patch": "@@ -20,7 +20,6 @@\n #define RUST_DERIVE_CLONE_H\n \n #include \"rust-derive.h\"\n-#include \"rust-ast-builder.h\"\n \n namespace Rust {\n namespace AST {\n@@ -33,9 +32,7 @@ class DeriveClone : DeriveVisitor\n   std::unique_ptr<AST::Item> go (Item &item);\n \n private:\n-  Location loc;\n-  std::unique_ptr<AST::Item> expanded;\n-  AstBuilder builder;\n+  std::unique_ptr<Item> expanded;\n \n   /**\n    * Create a call to \"clone\". For now, this creates a call to"}, {"sha": "bc5db626fbaeda9b8a00a25d5620d325d6049937", "filename": "gcc/rust/expand/rust-derive-copy.cc", "status": "modified", "additions": 1, "deletions": 2, "changes": 3, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/c021eef8aa73cc0a3a4e992018cab414a17db4c8/gcc%2Frust%2Fexpand%2Frust-derive-copy.cc", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/c021eef8aa73cc0a3a4e992018cab414a17db4c8/gcc%2Frust%2Fexpand%2Frust-derive-copy.cc", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Frust%2Fexpand%2Frust-derive-copy.cc?ref=c021eef8aa73cc0a3a4e992018cab414a17db4c8", "patch": "@@ -22,8 +22,7 @@\n namespace Rust {\n namespace AST {\n \n-DeriveCopy::DeriveCopy (Location loc)\n-  : loc (loc), builder (AstBuilder (loc)), expanded (nullptr)\n+DeriveCopy::DeriveCopy (Location loc) : DeriveVisitor (loc), expanded (nullptr)\n {}\n \n std::unique_ptr<AST::Item>"}, {"sha": "0e1e2076066d9a24b456d1e5ee529132ae0f4436", "filename": "gcc/rust/expand/rust-derive-copy.h", "status": "modified", "additions": 0, "deletions": 2, "changes": 2, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/c021eef8aa73cc0a3a4e992018cab414a17db4c8/gcc%2Frust%2Fexpand%2Frust-derive-copy.h", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/c021eef8aa73cc0a3a4e992018cab414a17db4c8/gcc%2Frust%2Fexpand%2Frust-derive-copy.h", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Frust%2Fexpand%2Frust-derive-copy.h?ref=c021eef8aa73cc0a3a4e992018cab414a17db4c8", "patch": "@@ -32,8 +32,6 @@ class DeriveCopy : DeriveVisitor\n   std::unique_ptr<Item> go (Item &);\n \n private:\n-  Location loc;\n-  AstBuilder builder;\n   std::unique_ptr<Item> expanded;\n \n   /**"}, {"sha": "1a7413b359b2e406acad47728db877c063cdf5c4", "filename": "gcc/rust/expand/rust-derive.cc", "status": "modified", "additions": 4, "deletions": 0, "changes": 4, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/c021eef8aa73cc0a3a4e992018cab414a17db4c8/gcc%2Frust%2Fexpand%2Frust-derive.cc", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/c021eef8aa73cc0a3a4e992018cab414a17db4c8/gcc%2Frust%2Fexpand%2Frust-derive.cc", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Frust%2Fexpand%2Frust-derive.cc?ref=c021eef8aa73cc0a3a4e992018cab414a17db4c8", "patch": "@@ -23,6 +23,10 @@\n namespace Rust {\n namespace AST {\n \n+DeriveVisitor::DeriveVisitor (Location loc)\n+  : loc (loc), builder (AstBuilder (loc))\n+{}\n+\n std::unique_ptr<Item>\n DeriveVisitor::derive (Item &item, const Attribute &attr,\n \t\t       BuiltinMacro to_derive)"}, {"sha": "01f3f024712ec9448c79522f2c8a58cac69ef504", "filename": "gcc/rust/expand/rust-derive.h", "status": "modified", "additions": 7, "deletions": 0, "changes": 7, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/c021eef8aa73cc0a3a4e992018cab414a17db4c8/gcc%2Frust%2Fexpand%2Frust-derive.h", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/c021eef8aa73cc0a3a4e992018cab414a17db4c8/gcc%2Frust%2Fexpand%2Frust-derive.h", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Frust%2Fexpand%2Frust-derive.h?ref=c021eef8aa73cc0a3a4e992018cab414a17db4c8", "patch": "@@ -21,6 +21,7 @@\n \n #include \"rust-ast-full.h\"\n #include \"rust-ast-visitor.h\"\n+#include \"rust-ast-builder.h\"\n #include \"rust-macro-builtins.h\"\n \n namespace Rust {\n@@ -36,6 +37,12 @@ class DeriveVisitor : public AST::ASTVisitor\n   static std::unique_ptr<Item> derive (Item &item, const Attribute &derive,\n \t\t\t\t       BuiltinMacro to_derive);\n \n+protected:\n+  DeriveVisitor (Location loc);\n+\n+  Location loc;\n+  AstBuilder builder;\n+\n private:\n   // the 4 \"allowed\" visitors, which a derive-visitor can specify and override\n   virtual void visit_struct (StructStruct &struct_item) = 0;"}]}