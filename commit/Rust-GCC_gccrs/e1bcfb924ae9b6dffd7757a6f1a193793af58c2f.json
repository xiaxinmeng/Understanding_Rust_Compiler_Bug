{"sha": "e1bcfb924ae9b6dffd7757a6f1a193793af58c2f", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6ZTFiY2ZiOTI0YWU5YjZkZmZkNzc1N2E2ZjFhMTkzNzkzYWY1OGMyZg==", "commit": {"author": {"name": "Jakub Jelinek", "email": "jakub@redhat.com", "date": "2017-01-16T21:34:35Z"}, "committer": {"name": "Jakub Jelinek", "email": "jakub@gcc.gnu.org", "date": "2017-01-16T21:34:35Z"}, "message": "re PR target/79080 (ICE: internal consistency failure (error: invalid rtl sharing found in the insn) (error: shared rtx))\n\n\tPR target/79080\n\t* loop-doloop.c (doloop_modify): Call unshare_all_rtl_in_chain on\n\tsequence.  Formatting fixes.\n\t(doloop_optimize): Formatting fixes.\n\n\t* gcc.dg/pr79080.c: New test.\n\nFrom-SVN: r244506", "tree": {"sha": "97c5bf3c97e4747ef5fc4e016464ce03bd36014b", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/97c5bf3c97e4747ef5fc4e016464ce03bd36014b"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/e1bcfb924ae9b6dffd7757a6f1a193793af58c2f", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/e1bcfb924ae9b6dffd7757a6f1a193793af58c2f", "html_url": "https://github.com/Rust-GCC/gccrs/commit/e1bcfb924ae9b6dffd7757a6f1a193793af58c2f", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/e1bcfb924ae9b6dffd7757a6f1a193793af58c2f/comments", "author": {"login": "jakubjelinek", "id": 9370665, "node_id": "MDQ6VXNlcjkzNzA2NjU=", "avatar_url": "https://avatars.githubusercontent.com/u/9370665?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jakubjelinek", "html_url": "https://github.com/jakubjelinek", "followers_url": "https://api.github.com/users/jakubjelinek/followers", "following_url": "https://api.github.com/users/jakubjelinek/following{/other_user}", "gists_url": "https://api.github.com/users/jakubjelinek/gists{/gist_id}", "starred_url": "https://api.github.com/users/jakubjelinek/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jakubjelinek/subscriptions", "organizations_url": "https://api.github.com/users/jakubjelinek/orgs", "repos_url": "https://api.github.com/users/jakubjelinek/repos", "events_url": "https://api.github.com/users/jakubjelinek/events{/privacy}", "received_events_url": "https://api.github.com/users/jakubjelinek/received_events", "type": "User", "site_admin": false}, "committer": null, "parents": [{"sha": "1c70261c9a4d7faedfb03a79753b9acf81195561", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/1c70261c9a4d7faedfb03a79753b9acf81195561", "html_url": "https://github.com/Rust-GCC/gccrs/commit/1c70261c9a4d7faedfb03a79753b9acf81195561"}], "stats": {"total": 42, "additions": 36, "deletions": 6}, "files": [{"sha": "cc2e1d0c9f08639c21a444ed567be7c90b6cd7c6", "filename": "gcc/ChangeLog", "status": "modified", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/e1bcfb924ae9b6dffd7757a6f1a193793af58c2f/gcc%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/e1bcfb924ae9b6dffd7757a6f1a193793af58c2f/gcc%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2FChangeLog?ref=e1bcfb924ae9b6dffd7757a6f1a193793af58c2f", "patch": "@@ -1,5 +1,10 @@\n 2017-01-16  Jakub Jelinek  <jakub@redhat.com>\n \n+\tPR target/79080\n+\t* loop-doloop.c (doloop_modify): Call unshare_all_rtl_in_chain on\n+\tsequence.  Formatting fixes.\n+\t(doloop_optimize): Formatting fixes.\n+\n \tPR driver/49726\n \t* gcc.c (debug_level_greater_than_spec_func): New function.\n \t(static_spec_functions): Add debug-level-gt spec function."}, {"sha": "3b9a96034abe9120710f7acb441407924ab9aa58", "filename": "gcc/loop-doloop.c", "status": "modified", "additions": 7, "deletions": 6, "changes": 13, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/e1bcfb924ae9b6dffd7757a6f1a193793af58c2f/gcc%2Floop-doloop.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/e1bcfb924ae9b6dffd7757a6f1a193793af58c2f/gcc%2Floop-doloop.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Floop-doloop.c?ref=e1bcfb924ae9b6dffd7757a6f1a193793af58c2f", "patch": "@@ -479,20 +479,22 @@ doloop_modify (struct loop *loop, struct niter_desc *desc,\n \n   /* Insert initialization of the count register into the loop header.  */\n   start_sequence ();\n+  /* count has been already copied through copy_rtx.  */\n+  reset_used_flags (count);\n+  set_used_flags (condition);\n   tmp = force_operand (count, counter_reg);\n   convert_move (counter_reg, tmp, 1);\n   sequence = get_insns ();\n+  unshare_all_rtl_in_chain (sequence);\n   end_sequence ();\n   emit_insn_after (sequence, BB_END (loop_preheader_edge (loop)->src));\n \n   if (desc->noloop_assumptions)\n     {\n       rtx ass = copy_rtx (desc->noloop_assumptions);\n       basic_block preheader = loop_preheader_edge (loop)->src;\n-      basic_block set_zero\n-\t      = split_edge (loop_preheader_edge (loop));\n-      basic_block new_preheader\n-\t      = split_edge (loop_preheader_edge (loop));\n+      basic_block set_zero = split_edge (loop_preheader_edge (loop));\n+      basic_block new_preheader = split_edge (loop_preheader_edge (loop));\n       edge te;\n \n       /* Expand the condition testing the assumptions and if it does not pass,\n@@ -688,8 +690,7 @@ doloop_optimize (struct loop *loop)\n   rtx_insn *doloop_seq = targetm.gen_doloop_end (doloop_reg, start_label);\n \n   word_mode_size = GET_MODE_PRECISION (word_mode);\n-  word_mode_max\n-\t  = (HOST_WIDE_INT_1U << (word_mode_size - 1) << 1) - 1;\n+  word_mode_max = (HOST_WIDE_INT_1U << (word_mode_size - 1) << 1) - 1;\n   if (! doloop_seq\n       && mode != word_mode\n       /* Before trying mode different from the one in that # of iterations is"}, {"sha": "2ac159733c47cb2c23afd586572dae8fc26bd548", "filename": "gcc/testsuite/ChangeLog", "status": "modified", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/e1bcfb924ae9b6dffd7757a6f1a193793af58c2f/gcc%2Ftestsuite%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/e1bcfb924ae9b6dffd7757a6f1a193793af58c2f/gcc%2Ftestsuite%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2FChangeLog?ref=e1bcfb924ae9b6dffd7757a6f1a193793af58c2f", "patch": "@@ -1,3 +1,8 @@\n+2017-01-16  Jakub Jelinek  <jakub@redhat.com>\n+\n+\tPR target/79080\n+\t* gcc.dg/pr79080.c: New test.\n+\n 2017-01-16  David Malcolm  <dmalcolm@redhat.com>\n \n \tPR c/78304"}, {"sha": "de0969d464795b2af39f3196b0643912cebe9c63", "filename": "gcc/testsuite/gcc.dg/pr79080.c", "status": "added", "additions": 19, "deletions": 0, "changes": 19, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/e1bcfb924ae9b6dffd7757a6f1a193793af58c2f/gcc%2Ftestsuite%2Fgcc.dg%2Fpr79080.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/e1bcfb924ae9b6dffd7757a6f1a193793af58c2f/gcc%2Ftestsuite%2Fgcc.dg%2Fpr79080.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgcc.dg%2Fpr79080.c?ref=e1bcfb924ae9b6dffd7757a6f1a193793af58c2f", "patch": "@@ -0,0 +1,19 @@\n+/* PR target/79080 */\n+/* { dg-do compile } */\n+/* { dg-options \"-O1\" } */\n+/* { dg-additional-options \"-mcpu=8548\" { target { powerpc*-*-* && ilp32 } } } */\n+\n+int\n+foo (char x)\n+{\n+  int a;\n+\n+  for (;;)\n+    {\n+      x += 59;\n+      if (x != 0)\n+        a = 0;\n+      else\n+        return 0;\n+    }\n+}"}]}