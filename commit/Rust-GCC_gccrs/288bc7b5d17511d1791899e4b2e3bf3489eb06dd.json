{"sha": "288bc7b5d17511d1791899e4b2e3bf3489eb06dd", "node_id": "C_kwDOANBUbNoAKDI4OGJjN2I1ZDE3NTExZDE3OTE4OTllNGIyZTNiZjM0ODllYjA2ZGQ", "commit": {"author": {"name": "Hongyu Wang", "email": "hongyu.wang@intel.com", "date": "2023-03-08T03:29:46Z"}, "committer": {"name": "Hongyu Wang", "email": "hongyu.wang@intel.com", "date": "2023-03-09T01:01:13Z"}, "message": "libgomp: Fix default value of GOMP_SPINCOUNT [PR 109062]\n\nWhen OMP_WAIT_POLICY is not specified, current implementation will cause\nicv flag GOMP_ICV_WAIT_POLICY unset, so global variable wait_policy\nwill remain its uninitialized value. Initialize it to -1 to make\nGOMP_SPINCOUNT behavior consistent with its description.\n\nlibgomp/ChangeLog:\n\n\tPR libgomp/109062\n\t* env.c (wait_policy): Initialize to -1.\n\t(initialize_icvs): Initialize icvs->wait_policy to -1.\n\t* testsuite/libgomp.c-c++-common/pr109062.c: New test.", "tree": {"sha": "11c219f312548cc73e7e2f212d573eb6bded0daf", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/11c219f312548cc73e7e2f212d573eb6bded0daf"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/288bc7b5d17511d1791899e4b2e3bf3489eb06dd", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/288bc7b5d17511d1791899e4b2e3bf3489eb06dd", "html_url": "https://github.com/Rust-GCC/gccrs/commit/288bc7b5d17511d1791899e4b2e3bf3489eb06dd", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/288bc7b5d17511d1791899e4b2e3bf3489eb06dd/comments", "author": {"login": "wwwhhhyyy", "id": 5366075, "node_id": "MDQ6VXNlcjUzNjYwNzU=", "avatar_url": "https://avatars.githubusercontent.com/u/5366075?v=4", "gravatar_id": "", "url": "https://api.github.com/users/wwwhhhyyy", "html_url": "https://github.com/wwwhhhyyy", "followers_url": "https://api.github.com/users/wwwhhhyyy/followers", "following_url": "https://api.github.com/users/wwwhhhyyy/following{/other_user}", "gists_url": "https://api.github.com/users/wwwhhhyyy/gists{/gist_id}", "starred_url": "https://api.github.com/users/wwwhhhyyy/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/wwwhhhyyy/subscriptions", "organizations_url": "https://api.github.com/users/wwwhhhyyy/orgs", "repos_url": "https://api.github.com/users/wwwhhhyyy/repos", "events_url": "https://api.github.com/users/wwwhhhyyy/events{/privacy}", "received_events_url": "https://api.github.com/users/wwwhhhyyy/received_events", "type": "User", "site_admin": false}, "committer": {"login": "wwwhhhyyy", "id": 5366075, "node_id": "MDQ6VXNlcjUzNjYwNzU=", "avatar_url": "https://avatars.githubusercontent.com/u/5366075?v=4", "gravatar_id": "", "url": "https://api.github.com/users/wwwhhhyyy", "html_url": "https://github.com/wwwhhhyyy", "followers_url": "https://api.github.com/users/wwwhhhyyy/followers", "following_url": "https://api.github.com/users/wwwhhhyyy/following{/other_user}", "gists_url": "https://api.github.com/users/wwwhhhyyy/gists{/gist_id}", "starred_url": "https://api.github.com/users/wwwhhhyyy/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/wwwhhhyyy/subscriptions", "organizations_url": "https://api.github.com/users/wwwhhhyyy/orgs", "repos_url": "https://api.github.com/users/wwwhhhyyy/repos", "events_url": "https://api.github.com/users/wwwhhhyyy/events{/privacy}", "received_events_url": "https://api.github.com/users/wwwhhhyyy/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "6a87fdd3ed6ef3511466f9cf41271726b643520b", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/6a87fdd3ed6ef3511466f9cf41271726b643520b", "html_url": "https://github.com/Rust-GCC/gccrs/commit/6a87fdd3ed6ef3511466f9cf41271726b643520b"}], "stats": {"total": 18, "additions": 16, "deletions": 2}, "files": [{"sha": "e7a035b593c7370fbcb181cc9d0b6ee624e16d0e", "filename": "libgomp/env.c", "status": "modified", "additions": 2, "deletions": 2, "changes": 4, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/288bc7b5d17511d1791899e4b2e3bf3489eb06dd/libgomp%2Fenv.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/288bc7b5d17511d1791899e4b2e3bf3489eb06dd/libgomp%2Fenv.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libgomp%2Fenv.c?ref=288bc7b5d17511d1791899e4b2e3bf3489eb06dd", "patch": "@@ -124,7 +124,7 @@ int goacc_default_dims[GOMP_DIM_MAX];\n \n #ifndef LIBGOMP_OFFLOADED_ONLY\n \n-static int wait_policy;\n+static int wait_policy = -1;\n static unsigned long stacksize = GOMP_DEFAULT_STACKSIZE;\n \n static void\n@@ -1981,7 +1981,7 @@ initialize_icvs (struct gomp_initial_icvs *icvs)\n   icvs->bind_var = gomp_default_icv_values.bind_var;\n   icvs->nteams_var = gomp_default_icv_values.nteams_var;\n   icvs->teams_thread_limit_var = gomp_default_icv_values.teams_thread_limit_var;\n-  icvs->wait_policy = 0;\n+  icvs->wait_policy = -1;\n }\n \n /* Helper function for initialize_env to add a device specific ICV value"}, {"sha": "5c7c287dafd776c58e2d6bcec059ac8e8140b70e", "filename": "libgomp/testsuite/libgomp.c-c++-common/pr109062.c", "status": "added", "additions": 14, "deletions": 0, "changes": 14, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/288bc7b5d17511d1791899e4b2e3bf3489eb06dd/libgomp%2Ftestsuite%2Flibgomp.c-c%2B%2B-common%2Fpr109062.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/288bc7b5d17511d1791899e4b2e3bf3489eb06dd/libgomp%2Ftestsuite%2Flibgomp.c-c%2B%2B-common%2Fpr109062.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libgomp%2Ftestsuite%2Flibgomp.c-c%2B%2B-common%2Fpr109062.c?ref=288bc7b5d17511d1791899e4b2e3bf3489eb06dd", "patch": "@@ -0,0 +1,14 @@\n+/* { dg-do run } */\n+\n+#include <omp.h>\n+#include <stdlib.h>\n+\n+int\n+main ()\n+{\n+  omp_display_env (1);\n+\n+  return 0;\n+}\n+\n+/* { dg-output \".*\\\\\\[host] GOMP_SPINCOUNT = '300000'.*\" { target native } } */"}]}