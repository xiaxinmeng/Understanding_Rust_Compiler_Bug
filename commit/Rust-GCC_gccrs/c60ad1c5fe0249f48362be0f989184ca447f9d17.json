{"sha": "c60ad1c5fe0249f48362be0f989184ca447f9d17", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6YzYwYWQxYzVmZTAyNDlmNDgzNjJiZTBmOTg5MTg0Y2E0NDdmOWQxNw==", "commit": {"author": {"name": "Segher Boessenkool", "email": "segher@kernel.crashing.org", "date": "2021-03-03T20:34:32Z"}, "committer": {"name": "Segher Boessenkool", "email": "segher@kernel.crashing.org", "date": "2021-03-09T17:10:33Z"}, "message": "rs6000: Fix check_effective_target_sqrt_insn (PR99352)\n\nThe previous version returned true for all PowerPC.  This is incorrect.\nWe only support floating point square root instructions if a) we support\nfloating point instructions at all, and b) we have _ARCH_PPCSQ defined.\n\n2020-03-09  Segher Boessenkool  <segher@kernel.crashing.org>\n\ngcc/testsuite/\n\t* lib/target-supports.exp (check_effective_target_powerpc_sqrt): New.\n\t(check_effective_target_sqrt_insn): Use it.", "tree": {"sha": "90abe9ab34b8bf6c08cca80cce360fb82be34f02", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/90abe9ab34b8bf6c08cca80cce360fb82be34f02"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/c60ad1c5fe0249f48362be0f989184ca447f9d17", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/c60ad1c5fe0249f48362be0f989184ca447f9d17", "html_url": "https://github.com/Rust-GCC/gccrs/commit/c60ad1c5fe0249f48362be0f989184ca447f9d17", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/c60ad1c5fe0249f48362be0f989184ca447f9d17/comments", "author": {"login": "segher", "id": 417629, "node_id": "MDQ6VXNlcjQxNzYyOQ==", "avatar_url": "https://avatars.githubusercontent.com/u/417629?v=4", "gravatar_id": "", "url": "https://api.github.com/users/segher", "html_url": "https://github.com/segher", "followers_url": "https://api.github.com/users/segher/followers", "following_url": "https://api.github.com/users/segher/following{/other_user}", "gists_url": "https://api.github.com/users/segher/gists{/gist_id}", "starred_url": "https://api.github.com/users/segher/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/segher/subscriptions", "organizations_url": "https://api.github.com/users/segher/orgs", "repos_url": "https://api.github.com/users/segher/repos", "events_url": "https://api.github.com/users/segher/events{/privacy}", "received_events_url": "https://api.github.com/users/segher/received_events", "type": "User", "site_admin": false}, "committer": {"login": "segher", "id": 417629, "node_id": "MDQ6VXNlcjQxNzYyOQ==", "avatar_url": "https://avatars.githubusercontent.com/u/417629?v=4", "gravatar_id": "", "url": "https://api.github.com/users/segher", "html_url": "https://github.com/segher", "followers_url": "https://api.github.com/users/segher/followers", "following_url": "https://api.github.com/users/segher/following{/other_user}", "gists_url": "https://api.github.com/users/segher/gists{/gist_id}", "starred_url": "https://api.github.com/users/segher/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/segher/subscriptions", "organizations_url": "https://api.github.com/users/segher/orgs", "repos_url": "https://api.github.com/users/segher/repos", "events_url": "https://api.github.com/users/segher/events{/privacy}", "received_events_url": "https://api.github.com/users/segher/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "a1e4fc19d99af3964588d3770cbf52e160d5b24b", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/a1e4fc19d99af3964588d3770cbf52e160d5b24b", "html_url": "https://github.com/Rust-GCC/gccrs/commit/a1e4fc19d99af3964588d3770cbf52e160d5b24b"}], "stats": {"total": 17, "additions": 16, "deletions": 1}, "files": [{"sha": "52d3d036d3c5c63b75b03d2025dea00ddc97a111", "filename": "gcc/testsuite/lib/target-supports.exp", "status": "modified", "additions": 16, "deletions": 1, "changes": 17, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/c60ad1c5fe0249f48362be0f989184ca447f9d17/gcc%2Ftestsuite%2Flib%2Ftarget-supports.exp", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/c60ad1c5fe0249f48362be0f989184ca447f9d17/gcc%2Ftestsuite%2Flib%2Ftarget-supports.exp", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Flib%2Ftarget-supports.exp?ref=c60ad1c5fe0249f48362be0f989184ca447f9d17", "patch": "@@ -5887,6 +5887,21 @@ proc check_effective_target_powerpc_hard_double { } {\n     }\n }\n \n+# Return 1 if this is a PowerPC target with hardware floating point sqrt.\n+\n+proc check_effective_target_powerpc_sqrt { } {\n+    # We need to be PowerPC, and we need to have hardware fp enabled.\n+    if {![check_effective_target_powerpc_fprs]} {\n+      return 0;\n+    }\n+\n+    return [check_no_compiler_messages powerpc_sqrt object {\n+\t#ifndef _ARCH_PPCSQ\n+\t#error _ARCH_PPCSQ is not defined\n+\t#endif\n+    } {}]\n+}\n+\n # Return 1 if this is a PowerPC target supporting -maltivec.\n \n proc check_effective_target_powerpc_altivec_ok { } {\n@@ -7581,7 +7596,7 @@ proc check_effective_target_vect_call_copysignf { } {\n proc check_effective_target_sqrt_insn { } {\n     return [check_cached_effective_target sqrt_insn {\n       expr { [istarget i?86-*-*] || [istarget x86_64-*-*]\n-\t     || [istarget powerpc*-*-*]\n+\t     || [check_effective_target_powerpc_sqrt]\n \t     || [istarget aarch64*-*-*]\n \t     || ([istarget arm*-*-*] && [check_effective_target_arm_vfp_ok])\n \t     || ([istarget s390*-*-*]"}]}