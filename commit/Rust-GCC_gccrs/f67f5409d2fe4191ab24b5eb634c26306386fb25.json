{"sha": "f67f5409d2fe4191ab24b5eb634c26306386fb25", "node_id": "C_kwDOANBUbNoAKGY2N2Y1NDA5ZDJmZTQxOTFhYjI0YjVlYjYzNGMyNjMwNjM4NmZiMjU", "commit": {"author": {"name": "Arthur Cohen", "email": "arthur.cohen@embecosm.com", "date": "2023-02-08T11:23:06Z"}, "committer": {"name": "Arthur Cohen", "email": "arthur.cohen@embecosm.com", "date": "2023-02-08T11:23:06Z"}, "message": "expander: Add documentation for `expand_eager_invocations`\n\ngcc/rust/ChangeLog:\n\n\t* expand/rust-macro-expand.cc (MacroExpander::expand_eager_invocations):\n\tAdd documentation explaining the algorithm.", "tree": {"sha": "3e2df11ce35f565964ef00675bea30b34ee12d95", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/3e2df11ce35f565964ef00675bea30b34ee12d95"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/f67f5409d2fe4191ab24b5eb634c26306386fb25", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/f67f5409d2fe4191ab24b5eb634c26306386fb25", "html_url": "https://github.com/Rust-GCC/gccrs/commit/f67f5409d2fe4191ab24b5eb634c26306386fb25", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/f67f5409d2fe4191ab24b5eb634c26306386fb25/comments", "author": {"login": "CohenArthur", "id": 43524065, "node_id": "MDQ6VXNlcjQzNTI0MDY1", "avatar_url": "https://avatars.githubusercontent.com/u/43524065?v=4", "gravatar_id": "", "url": "https://api.github.com/users/CohenArthur", "html_url": "https://github.com/CohenArthur", "followers_url": "https://api.github.com/users/CohenArthur/followers", "following_url": "https://api.github.com/users/CohenArthur/following{/other_user}", "gists_url": "https://api.github.com/users/CohenArthur/gists{/gist_id}", "starred_url": "https://api.github.com/users/CohenArthur/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/CohenArthur/subscriptions", "organizations_url": "https://api.github.com/users/CohenArthur/orgs", "repos_url": "https://api.github.com/users/CohenArthur/repos", "events_url": "https://api.github.com/users/CohenArthur/events{/privacy}", "received_events_url": "https://api.github.com/users/CohenArthur/received_events", "type": "User", "site_admin": false}, "committer": {"login": "CohenArthur", "id": 43524065, "node_id": "MDQ6VXNlcjQzNTI0MDY1", "avatar_url": "https://avatars.githubusercontent.com/u/43524065?v=4", "gravatar_id": "", "url": "https://api.github.com/users/CohenArthur", "html_url": "https://github.com/CohenArthur", "followers_url": "https://api.github.com/users/CohenArthur/followers", "following_url": "https://api.github.com/users/CohenArthur/following{/other_user}", "gists_url": "https://api.github.com/users/CohenArthur/gists{/gist_id}", "starred_url": "https://api.github.com/users/CohenArthur/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/CohenArthur/subscriptions", "organizations_url": "https://api.github.com/users/CohenArthur/orgs", "repos_url": "https://api.github.com/users/CohenArthur/repos", "events_url": "https://api.github.com/users/CohenArthur/events{/privacy}", "received_events_url": "https://api.github.com/users/CohenArthur/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "c6db68ee151234eb7fead8e6631273bbe5302277", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/c6db68ee151234eb7fead8e6631273bbe5302277", "html_url": "https://github.com/Rust-GCC/gccrs/commit/c6db68ee151234eb7fead8e6631273bbe5302277"}], "stats": {"total": 14, "additions": 11, "deletions": 3}, "files": [{"sha": "597cb6a48443e7e094752e68427a7fac6e759365", "filename": "gcc/rust/expand/rust-macro-expand.cc", "status": "modified", "additions": 11, "deletions": 3, "changes": 14, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/f67f5409d2fe4191ab24b5eb634c26306386fb25/gcc%2Frust%2Fexpand%2Frust-macro-expand.cc", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/f67f5409d2fe4191ab24b5eb634c26306386fb25/gcc%2Frust%2Fexpand%2Frust-macro-expand.cc", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Frust%2Fexpand%2Frust-macro-expand.cc?ref=f67f5409d2fe4191ab24b5eb634c26306386fb25", "patch": "@@ -197,17 +197,25 @@ MacroExpander::expand_eager_invocations (AST::MacroInvocation &invoc)\n       auto start = kv.first.first;\n       auto end = kv.first.second;\n \n-      // TODO: Add doc\n+      // We're now going to re-add the tokens to the invocation's token tree.\n+      // 1. Basically, what we want to do is insert all tokens up until the\n+      //    beginning of the macro invocation (start).\n+      // 2. Then, we'll insert all of the tokens resulting from the macro\n+      //    expansion: These are in `new_tokens`.\n+      // 3. Finally, we'll do that again from\n+      //    the end of macro and go back to 1.\n+\n       for (size_t i = current_idx; i < start; i++)\n \tnew_stream.emplace_back (stream[i]->clone_token ());\n \n-      // TODO: Add doc\n       for (auto &tok : new_tokens)\n \tnew_stream.emplace_back (tok->clone_token ());\n \n       current_idx = end;\n     }\n-  // TODO: Add doc\n+\n+  // Once all of that is done, we copy the last remaining tokens from the\n+  // original stream\n   for (size_t i = current_idx; i < stream.size (); i++)\n     new_stream.emplace_back (stream[i]->clone_token ());\n "}]}