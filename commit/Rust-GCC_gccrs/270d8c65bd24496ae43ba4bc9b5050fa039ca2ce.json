{"sha": "270d8c65bd24496ae43ba4bc9b5050fa039ca2ce", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6MjcwZDhjNjViZDI0NDk2YWU0M2JhNGJjOWI1MDUwZmEwMzljYTJjZQ==", "commit": {"author": {"name": "Nathan Sidwell", "email": "nathan@codesourcery.com", "date": "2001-12-11T20:11:34Z"}, "committer": {"name": "Nathan Sidwell", "email": "nathan@gcc.gnu.org", "date": "2001-12-11T20:11:34Z"}, "message": "re PR c++/51 (g++ reports error for ISO C++ example)\n\ncp:\n\tPR g++/51\n\t* parse.y (frob_specs): Indicate it is a language linkage which\n\tcontained the extern.\n\t* decl.c (grokdeclarator): Allow extern language linkage with\n\tother specifiers.\ntestsuite:\n\t* g++.dg/other/linkage1.C: New test.\n\t* g++.old-deja/g++.brendan/err-msg2.C: Alter to avoid two\n\tspecifiers.\n\nFrom-SVN: r47891", "tree": {"sha": "b72e75e6df8ea8e5735b8bb1b61a5f6d3a51eeea", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/b72e75e6df8ea8e5735b8bb1b61a5f6d3a51eeea"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/270d8c65bd24496ae43ba4bc9b5050fa039ca2ce", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/270d8c65bd24496ae43ba4bc9b5050fa039ca2ce", "html_url": "https://github.com/Rust-GCC/gccrs/commit/270d8c65bd24496ae43ba4bc9b5050fa039ca2ce", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/270d8c65bd24496ae43ba4bc9b5050fa039ca2ce/comments", "author": null, "committer": null, "parents": [{"sha": "9aa8a1df0506a9622fea14f7c28b73fdd5324f8e", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/9aa8a1df0506a9622fea14f7c28b73fdd5324f8e", "html_url": "https://github.com/Rust-GCC/gccrs/commit/9aa8a1df0506a9622fea14f7c28b73fdd5324f8e"}], "stats": {"total": 52, "additions": 49, "deletions": 3}, "files": [{"sha": "71186885f32dae9ddb90a6790d41e2486bc3855b", "filename": "gcc/cp/ChangeLog", "status": "modified", "additions": 8, "deletions": 0, "changes": 8, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/270d8c65bd24496ae43ba4bc9b5050fa039ca2ce/gcc%2Fcp%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/270d8c65bd24496ae43ba4bc9b5050fa039ca2ce/gcc%2Fcp%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fcp%2FChangeLog?ref=270d8c65bd24496ae43ba4bc9b5050fa039ca2ce", "patch": "@@ -1,3 +1,11 @@\n+2001-12-11  Nathan Sidwell  <nathan@codesourcery.com>\n+\n+\tPR g++/51\n+\t* parse.y (frob_specs): Indicate it is a language linkage which\n+\tcontained the extern.\n+\t* decl.c (grokdeclarator): Allow extern language linkage with\n+\tother specifiers.\n+\n 2001-12-10  Nathan Sidwell  <nathan@codesourcery.com>\n \n \tPR g++/72"}, {"sha": "690e34c7a8d596f5ded2f66d31cbfdfb5bb75793", "filename": "gcc/cp/decl.c", "status": "modified", "additions": 9, "deletions": 1, "changes": 10, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/270d8c65bd24496ae43ba4bc9b5050fa039ca2ce/gcc%2Fcp%2Fdecl.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/270d8c65bd24496ae43ba4bc9b5050fa039ca2ce/gcc%2Fcp%2Fdecl.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fcp%2Fdecl.c?ref=270d8c65bd24496ae43ba4bc9b5050fa039ca2ce", "patch": "@@ -9603,6 +9603,8 @@ grokdeclarator (declarator, declspecs, decl_context, initialized, attrlist)\n   int explicit_int = 0;\n   int explicit_char = 0;\n   int defaulted_int = 0;\n+  int extern_langp = 0;\n+  \n   tree typedef_decl = NULL_TREE;\n   const char *name;\n   tree typedef_type = NULL_TREE;\n@@ -10043,6 +10045,10 @@ grokdeclarator (declarator, declspecs, decl_context, initialized, attrlist)\n \t\t    }\n \t\t  else if (RIDBIT_SETP (i, specbits))\n \t\t    pedwarn (\"duplicate `%s'\", IDENTIFIER_POINTER (id));\n+\t\t  if (i == (int)RID_EXTERN\n+\t\t      && TREE_PURPOSE (spec) == error_mark_node)\n+\t\t    /* This extern was part of a language linkage.  */\n+\t\t    extern_langp = 1;\n \t\t  RIDBIT_SET (i, specbits);\n \t\t  goto found;\n \t\t}\n@@ -10318,7 +10324,7 @@ grokdeclarator (declarator, declspecs, decl_context, initialized, attrlist)\n   if (RIDBIT_ANY_SET (specbits))\n     {\n       if (RIDBIT_SETP (RID_STATIC, specbits)) nclasses++;\n-      if (RIDBIT_SETP (RID_EXTERN, specbits)) nclasses++;\n+      if (RIDBIT_SETP (RID_EXTERN, specbits) && !extern_langp) nclasses++;\n       if (decl_context == PARM && nclasses > 0)\n \terror (\"storage class specifiers invalid in parameter declarations\");\n       if (RIDBIT_SETP (RID_TYPEDEF, specbits))\n@@ -10329,6 +10335,8 @@ grokdeclarator (declarator, declspecs, decl_context, initialized, attrlist)\n \t}\n       if (RIDBIT_SETP (RID_AUTO, specbits)) nclasses++;\n       if (RIDBIT_SETP (RID_REGISTER, specbits)) nclasses++;\n+      if (!nclasses && !friendp && extern_langp)\n+\tnclasses++;\n     }\n \n   /* Give error if `virtual' is used outside of class declaration.  */"}, {"sha": "28a1456663fd00d155ceb351d567f82eb402fc39", "filename": "gcc/cp/parse.y", "status": "modified", "additions": 7, "deletions": 1, "changes": 8, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/270d8c65bd24496ae43ba4bc9b5050fa039ca2ce/gcc%2Fcp%2Fparse.y", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/270d8c65bd24496ae43ba4bc9b5050fa039ca2ce/gcc%2Fcp%2Fparse.y", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fcp%2Fparse.y?ref=270d8c65bd24496ae43ba4bc9b5050fa039ca2ce", "patch": "@@ -119,7 +119,13 @@ frob_specs (specs_attrs, lookups)\n     current_declspecs = build_tree_list (NULL_TREE, current_declspecs);\n   if (have_extern_spec && !used_extern_spec)\n     {\n-      current_declspecs = tree_cons (NULL_TREE, \n+      /* We have to indicate that there is an \"extern\", but that it\n+         was part of a language specifier.  For instance,\n+\t \n+    \t    extern \"C\" typedef int (*Ptr) ();\n+\n+         is well formed.  */\n+      current_declspecs = tree_cons (error_mark_node,\n \t\t\t\t     get_identifier (\"extern\"), \n \t\t\t\t     current_declspecs);\n       used_extern_spec = 1;"}, {"sha": "1ff35b297dd887e8b23b7f9a8ea193be6187c060", "filename": "gcc/testsuite/ChangeLog", "status": "modified", "additions": 6, "deletions": 0, "changes": 6, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/270d8c65bd24496ae43ba4bc9b5050fa039ca2ce/gcc%2Ftestsuite%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/270d8c65bd24496ae43ba4bc9b5050fa039ca2ce/gcc%2Ftestsuite%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2FChangeLog?ref=270d8c65bd24496ae43ba4bc9b5050fa039ca2ce", "patch": "@@ -1,3 +1,9 @@\n+2001-12-11  Nathan Sidwell  <nathan@codesourcery.com>\n+\n+\t* g++.dg/other/linkage1.C: New test.\n+\t* g++.old-deja/g++.brendan/err-msg2.C: Alter to avoid two\n+\tspecifiers.\n+\n 2001-12-11  Neil Booth  <neil@daikokuya.demon.co.uk>\n \n \t* gcc.dg/concat.c: New test."}, {"sha": "c2676bac1c284827c6afc0c45812453d5b9dd7da", "filename": "gcc/testsuite/g++.dg/other/linkage1.C", "status": "added", "additions": 14, "deletions": 0, "changes": 14, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/270d8c65bd24496ae43ba4bc9b5050fa039ca2ce/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Fother%2Flinkage1.C", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/270d8c65bd24496ae43ba4bc9b5050fa039ca2ce/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Fother%2Flinkage1.C", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Fother%2Flinkage1.C?ref=270d8c65bd24496ae43ba4bc9b5050fa039ca2ce", "patch": "@@ -0,0 +1,14 @@\n+// { dg-do compile }\n+\n+// Copyright (C) 2001 Free Software Foundation, Inc.\n+// Contributed by Nathan Sidwell 9 Dec 2001 <nathan@nathan@codesourcery.com>\n+\n+// PR 51\n+// This example snippet is from the ISO C++ standard, sect 7.5 para 4:\n+\n+extern \"C\" typedef void FUNC_c();\n+\n+class C {\n+  public:\n+  static FUNC_c* q;\n+};"}, {"sha": "a0cfd6a4b5defad1645691e9f2b9dacf04bcaff8", "filename": "gcc/testsuite/g++.old-deja/g++.brendan/err-msg2.C", "status": "modified", "additions": 5, "deletions": 1, "changes": 6, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/270d8c65bd24496ae43ba4bc9b5050fa039ca2ce/gcc%2Ftestsuite%2Fg%2B%2B.old-deja%2Fg%2B%2B.brendan%2Ferr-msg2.C", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/270d8c65bd24496ae43ba4bc9b5050fa039ca2ce/gcc%2Ftestsuite%2Fg%2B%2B.old-deja%2Fg%2B%2B.brendan%2Ferr-msg2.C", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fg%2B%2B.old-deja%2Fg%2B%2B.brendan%2Ferr-msg2.C?ref=270d8c65bd24496ae43ba4bc9b5050fa039ca2ce", "patch": "@@ -1,4 +1,8 @@\n // Build don't link: \n // GROUPS passed error-messages\n+\n typedef void (*pfv)(double, double);\n-extern \"C\" typedef void (*pfv)(double, double);// ERROR -  multiple.*\n+extern \"C\" {\n+  typedef void (*pfv)(double, double); // ERROR - conflicting linkage - XFAIL\n+}\n+"}]}