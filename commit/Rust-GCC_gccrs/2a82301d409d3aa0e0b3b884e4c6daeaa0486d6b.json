{"sha": "2a82301d409d3aa0e0b3b884e4c6daeaa0486d6b", "node_id": "C_kwDOANBUbNoAKDJhODIzMDFkNDA5ZDNhYTBlMGIzYjg4NGU0YzZkYWVhYTA0ODZkNmI", "commit": {"author": {"name": "Jakub Jelinek", "email": "jakub@redhat.com", "date": "2022-04-02T10:49:38Z"}, "committer": {"name": "Jakub Jelinek", "email": "jakub@redhat.com", "date": "2022-04-02T10:49:38Z"}, "message": "libstdc++: Tweak source_location for clang trunk [PR105128]\n\nApparently clang trunk implemented __builtin_source_location(), but the\nusing __builtin_ret_type = decltype(__builtin_source_location());\nwhich has been added for it isn't enough, they also need the\nstd::source_location::__impl class to be defined (but incomplete seems\nto be good enough) before the builtin is used.\n\nThe following has been tested on godbolt with clang trunk (old version\nfails with\nerror: 'std::source_location::__impl' was not found; it must be defined before '__builtin_source_location' is called\nand some follow-up errors), getting back to just void * instead of\n__builtin_ret_type and commenting out using doesn't work either and\njust struct __impl; before using __builtin_ret_type doesn't work too.\n\n2022-04-02  Jakub Jelinek  <jakub@redhat.com>\n\n\tPR libstdc++/105128\n\t* include/std/source_location (std::source_location::__impl): Move\n\tdefinition before using __builtin_ret_type.", "tree": {"sha": "43de7f092e1afc698a3272b4b65091a44cb0400b", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/43de7f092e1afc698a3272b4b65091a44cb0400b"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/2a82301d409d3aa0e0b3b884e4c6daeaa0486d6b", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/2a82301d409d3aa0e0b3b884e4c6daeaa0486d6b", "html_url": "https://github.com/Rust-GCC/gccrs/commit/2a82301d409d3aa0e0b3b884e4c6daeaa0486d6b", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/2a82301d409d3aa0e0b3b884e4c6daeaa0486d6b/comments", "author": {"login": "jakubjelinek", "id": 9370665, "node_id": "MDQ6VXNlcjkzNzA2NjU=", "avatar_url": "https://avatars.githubusercontent.com/u/9370665?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jakubjelinek", "html_url": "https://github.com/jakubjelinek", "followers_url": "https://api.github.com/users/jakubjelinek/followers", "following_url": "https://api.github.com/users/jakubjelinek/following{/other_user}", "gists_url": "https://api.github.com/users/jakubjelinek/gists{/gist_id}", "starred_url": "https://api.github.com/users/jakubjelinek/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jakubjelinek/subscriptions", "organizations_url": "https://api.github.com/users/jakubjelinek/orgs", "repos_url": "https://api.github.com/users/jakubjelinek/repos", "events_url": "https://api.github.com/users/jakubjelinek/events{/privacy}", "received_events_url": "https://api.github.com/users/jakubjelinek/received_events", "type": "User", "site_admin": false}, "committer": {"login": "jakubjelinek", "id": 9370665, "node_id": "MDQ6VXNlcjkzNzA2NjU=", "avatar_url": "https://avatars.githubusercontent.com/u/9370665?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jakubjelinek", "html_url": "https://github.com/jakubjelinek", "followers_url": "https://api.github.com/users/jakubjelinek/followers", "following_url": "https://api.github.com/users/jakubjelinek/following{/other_user}", "gists_url": "https://api.github.com/users/jakubjelinek/gists{/gist_id}", "starred_url": "https://api.github.com/users/jakubjelinek/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jakubjelinek/subscriptions", "organizations_url": "https://api.github.com/users/jakubjelinek/orgs", "repos_url": "https://api.github.com/users/jakubjelinek/repos", "events_url": "https://api.github.com/users/jakubjelinek/events{/privacy}", "received_events_url": "https://api.github.com/users/jakubjelinek/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "f0ccbe10f152b55fb809264d2ae11c724ab09ff6", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/f0ccbe10f152b55fb809264d2ae11c724ab09ff6", "html_url": "https://github.com/Rust-GCC/gccrs/commit/f0ccbe10f152b55fb809264d2ae11c724ab09ff6"}], "stats": {"total": 15, "additions": 7, "deletions": 8}, "files": [{"sha": "1e2614274574d46fe136a123db4653b7741d2aa9", "filename": "libstdc++-v3/include/std/source_location", "status": "modified", "additions": 7, "deletions": 8, "changes": 15, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/2a82301d409d3aa0e0b3b884e4c6daeaa0486d6b/libstdc%2B%2B-v3%2Finclude%2Fstd%2Fsource_location", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/2a82301d409d3aa0e0b3b884e4c6daeaa0486d6b/libstdc%2B%2B-v3%2Finclude%2Fstd%2Fsource_location", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libstdc%2B%2B-v3%2Finclude%2Fstd%2Fsource_location?ref=2a82301d409d3aa0e0b3b884e4c6daeaa0486d6b", "patch": "@@ -43,6 +43,13 @@ _GLIBCXX_BEGIN_NAMESPACE_VERSION\n   {\n   private:\n     using uint_least32_t = __UINT_LEAST32_TYPE__;\n+    struct __impl\n+    {\n+      const char* _M_file_name;\n+      const char* _M_function_name;\n+      unsigned _M_line;\n+      unsigned _M_column;\n+    };\n     using __builtin_ret_type = decltype(__builtin_source_location());\n \n   public:\n@@ -76,14 +83,6 @@ _GLIBCXX_BEGIN_NAMESPACE_VERSION\n     { return _M_impl ? _M_impl->_M_function_name : \"\"; }\n \n   private:\n-    struct __impl\n-    {\n-      const char* _M_file_name;\n-      const char* _M_function_name;\n-      unsigned _M_line;\n-      unsigned _M_column;\n-    };\n-\n     const __impl* _M_impl = nullptr;\n   };\n "}]}