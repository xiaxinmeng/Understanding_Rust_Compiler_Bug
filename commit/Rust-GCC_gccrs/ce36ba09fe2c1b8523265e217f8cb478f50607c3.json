{"sha": "ce36ba09fe2c1b8523265e217f8cb478f50607c3", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6Y2UzNmJhMDlmZTJjMWI4NTIzMjY1ZTIxN2Y4Y2I0NzhmNTA2MDdjMw==", "commit": {"author": {"name": "Jason Merrill", "email": "jason@redhat.com", "date": "2019-04-05T02:52:23Z"}, "committer": {"name": "Jason Merrill", "email": "jason@gcc.gnu.org", "date": "2019-04-05T02:52:23Z"}, "message": "PR c++/89948 - ICE with break in statement-expr.\n\n\t* constexpr.c (cxx_eval_statement_list): Jumping out of a\n\tstatement-expr is non-constant.\n\nFrom-SVN: r270161", "tree": {"sha": "de66712d85a783797871566058cfc25a93b551b7", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/de66712d85a783797871566058cfc25a93b551b7"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/ce36ba09fe2c1b8523265e217f8cb478f50607c3", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/ce36ba09fe2c1b8523265e217f8cb478f50607c3", "html_url": "https://github.com/Rust-GCC/gccrs/commit/ce36ba09fe2c1b8523265e217f8cb478f50607c3", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/ce36ba09fe2c1b8523265e217f8cb478f50607c3/comments", "author": {"login": "jicama", "id": 266146, "node_id": "MDQ6VXNlcjI2NjE0Ng==", "avatar_url": "https://avatars.githubusercontent.com/u/266146?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jicama", "html_url": "https://github.com/jicama", "followers_url": "https://api.github.com/users/jicama/followers", "following_url": "https://api.github.com/users/jicama/following{/other_user}", "gists_url": "https://api.github.com/users/jicama/gists{/gist_id}", "starred_url": "https://api.github.com/users/jicama/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jicama/subscriptions", "organizations_url": "https://api.github.com/users/jicama/orgs", "repos_url": "https://api.github.com/users/jicama/repos", "events_url": "https://api.github.com/users/jicama/events{/privacy}", "received_events_url": "https://api.github.com/users/jicama/received_events", "type": "User", "site_admin": false}, "committer": null, "parents": [{"sha": "950b198d4a3225cbec2d3408b947bf48057c5762", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/950b198d4a3225cbec2d3408b947bf48057c5762", "html_url": "https://github.com/Rust-GCC/gccrs/commit/950b198d4a3225cbec2d3408b947bf48057c5762"}], "stats": {"total": 25, "additions": 25, "deletions": 0}, "files": [{"sha": "6bfd26c6a2e061bd8c69c06d3e8552bbc429bcb3", "filename": "gcc/cp/ChangeLog", "status": "modified", "additions": 6, "deletions": 0, "changes": 6, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/ce36ba09fe2c1b8523265e217f8cb478f50607c3/gcc%2Fcp%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/ce36ba09fe2c1b8523265e217f8cb478f50607c3/gcc%2Fcp%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fcp%2FChangeLog?ref=ce36ba09fe2c1b8523265e217f8cb478f50607c3", "patch": "@@ -1,3 +1,9 @@\n+2019-04-04  Jason Merrill  <jason@redhat.com>\n+\n+\tPR c++/89948 - ICE with break in statement-expr.\n+\t* constexpr.c (cxx_eval_statement_list): Jumping out of a\n+\tstatement-expr is non-constant.\n+\n 2019-04-04  Jason Merrill  <jason@redhat.com>\n \n \tPR c++/89966 - error with non-type auto tparm."}, {"sha": "0ce5618a2fcb57750d1fdae687f75eccd64d0d38", "filename": "gcc/cp/constexpr.c", "status": "modified", "additions": 9, "deletions": 0, "changes": 9, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/ce36ba09fe2c1b8523265e217f8cb478f50607c3/gcc%2Fcp%2Fconstexpr.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/ce36ba09fe2c1b8523265e217f8cb478f50607c3/gcc%2Fcp%2Fconstexpr.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fcp%2Fconstexpr.c?ref=ce36ba09fe2c1b8523265e217f8cb478f50607c3", "patch": "@@ -4153,6 +4153,15 @@ cxx_eval_statement_list (const constexpr_ctx *ctx, tree t,\n       if (returns (jump_target) || breaks (jump_target))\n \tbreak;\n     }\n+  if (*jump_target && jump_target == &local_target)\n+    {\n+      /* We aren't communicating the jump to our caller, so give up.  We don't\n+\t need to support evaluation of jumps out of statement-exprs.  */\n+      if (!ctx->quiet)\n+\terror_at (cp_expr_loc_or_loc (r, input_location),\n+\t\t  \"statement is not a constant expression\");\n+      *non_constant_p = true;\n+    }\n   return r;\n }\n "}, {"sha": "c6aaea76f230a3b288f6436b9979706bab875716", "filename": "gcc/testsuite/g++.dg/ext/stmtexpr23.C", "status": "added", "additions": 10, "deletions": 0, "changes": 10, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/ce36ba09fe2c1b8523265e217f8cb478f50607c3/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Fext%2Fstmtexpr23.C", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/ce36ba09fe2c1b8523265e217f8cb478f50607c3/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Fext%2Fstmtexpr23.C", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Fext%2Fstmtexpr23.C?ref=ce36ba09fe2c1b8523265e217f8cb478f50607c3", "patch": "@@ -0,0 +1,10 @@\n+// PR c++/89948\n+// { dg-options \"\" }\n+\n+void f ()\n+{\n+  int a = 0;\n+  for (;;)\n+    for (;a=+({break;1;});)\n+      {}\n+}"}]}