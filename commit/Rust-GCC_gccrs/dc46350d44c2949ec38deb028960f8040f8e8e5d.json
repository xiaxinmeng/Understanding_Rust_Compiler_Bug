{"sha": "dc46350d44c2949ec38deb028960f8040f8e8e5d", "node_id": "C_kwDOANBUbNoAKGRjNDYzNTBkNDRjMjk0OWVjMzhkZWIwMjg5NjBmODA0MGY4ZThlNWQ", "commit": {"author": {"name": "Richard Biener", "email": "rguenther@suse.de", "date": "2022-03-08T07:42:58Z"}, "committer": {"name": "Richard Biener", "email": "rguenther@suse.de", "date": "2022-03-08T08:55:58Z"}, "message": "tree-optimization/104825 - guard modref query\n\nThe following makes sure to guard the modref query in VN on a\npointer typed argument.\n\n2022-03-08  Richard Biener  <rguenther@suse.de>\n\n\tPR tree-optimization/104825\n\t* tree-ssa-sccvn.cc (visit_reference_op_call): Properly\n\tguard modref get_ao_ref on a pointer typed argument.\n\n\t* gcc.dg/torture/pr104825.c: New testcase.", "tree": {"sha": "47eb4d40c94b2b72fbed41f8d582a3d3da7ec6bf", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/47eb4d40c94b2b72fbed41f8d582a3d3da7ec6bf"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/dc46350d44c2949ec38deb028960f8040f8e8e5d", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/dc46350d44c2949ec38deb028960f8040f8e8e5d", "html_url": "https://github.com/Rust-GCC/gccrs/commit/dc46350d44c2949ec38deb028960f8040f8e8e5d", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/dc46350d44c2949ec38deb028960f8040f8e8e5d/comments", "author": {"login": "rguenth", "id": 2046526, "node_id": "MDQ6VXNlcjIwNDY1MjY=", "avatar_url": "https://avatars.githubusercontent.com/u/2046526?v=4", "gravatar_id": "", "url": "https://api.github.com/users/rguenth", "html_url": "https://github.com/rguenth", "followers_url": "https://api.github.com/users/rguenth/followers", "following_url": "https://api.github.com/users/rguenth/following{/other_user}", "gists_url": "https://api.github.com/users/rguenth/gists{/gist_id}", "starred_url": "https://api.github.com/users/rguenth/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/rguenth/subscriptions", "organizations_url": "https://api.github.com/users/rguenth/orgs", "repos_url": "https://api.github.com/users/rguenth/repos", "events_url": "https://api.github.com/users/rguenth/events{/privacy}", "received_events_url": "https://api.github.com/users/rguenth/received_events", "type": "User", "site_admin": false}, "committer": {"login": "rguenth", "id": 2046526, "node_id": "MDQ6VXNlcjIwNDY1MjY=", "avatar_url": "https://avatars.githubusercontent.com/u/2046526?v=4", "gravatar_id": "", "url": "https://api.github.com/users/rguenth", "html_url": "https://github.com/rguenth", "followers_url": "https://api.github.com/users/rguenth/followers", "following_url": "https://api.github.com/users/rguenth/following{/other_user}", "gists_url": "https://api.github.com/users/rguenth/gists{/gist_id}", "starred_url": "https://api.github.com/users/rguenth/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/rguenth/subscriptions", "organizations_url": "https://api.github.com/users/rguenth/orgs", "repos_url": "https://api.github.com/users/rguenth/repos", "events_url": "https://api.github.com/users/rguenth/events{/privacy}", "received_events_url": "https://api.github.com/users/rguenth/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "b1a741a03041782b34effcb820fbe19ba41a3b8f", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/b1a741a03041782b34effcb820fbe19ba41a3b8f", "html_url": "https://github.com/Rust-GCC/gccrs/commit/b1a741a03041782b34effcb820fbe19ba41a3b8f"}], "stats": {"total": 19, "additions": 17, "deletions": 2}, "files": [{"sha": "7affacc2094274aaf068ea71c2f28dedf23e270b", "filename": "gcc/testsuite/gcc.dg/torture/pr104825.c", "status": "added", "additions": 14, "deletions": 0, "changes": 14, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/dc46350d44c2949ec38deb028960f8040f8e8e5d/gcc%2Ftestsuite%2Fgcc.dg%2Ftorture%2Fpr104825.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/dc46350d44c2949ec38deb028960f8040f8e8e5d/gcc%2Ftestsuite%2Fgcc.dg%2Ftorture%2Fpr104825.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgcc.dg%2Ftorture%2Fpr104825.c?ref=dc46350d44c2949ec38deb028960f8040f8e8e5d", "patch": "@@ -0,0 +1,14 @@\n+/* { dg-do compile } */\n+/* { dg-additional-options \"-Wno-stringop-overread\" } */\n+\n+int foo (fmt)\n+char* fmt;\n+{\n+  return (__builtin_strchr (fmt, '*') != 0\n+          || __builtin_strchr (fmt, 'n') != 0);\n+}\n+void bar ()\n+{\n+  if (foo (1))\n+    __builtin_abort ();\n+}"}, {"sha": "66b4fc21f5b32fcab8eac5647a6c0442591a5b25", "filename": "gcc/tree-ssa-sccvn.cc", "status": "modified", "additions": 3, "deletions": 2, "changes": 5, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/dc46350d44c2949ec38deb028960f8040f8e8e5d/gcc%2Ftree-ssa-sccvn.cc", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/dc46350d44c2949ec38deb028960f8040f8e8e5d/gcc%2Ftree-ssa-sccvn.cc", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftree-ssa-sccvn.cc?ref=dc46350d44c2949ec38deb028960f8040f8e8e5d", "patch": "@@ -5140,11 +5140,12 @@ visit_reference_op_call (tree lhs, gcall *stmt)\n \t\t{\n \t\t  accesses.quick_grow (accesses.length () + 1);\n \t\t  ao_ref *r = &accesses.last ();\n-\t\t  if (!access_node.get_ao_ref (stmt, r))\n+\t\t  tree arg = access_node.get_call_arg (stmt);\n+\t\t  if (!POINTER_TYPE_P (TREE_TYPE (arg))\n+\t\t      || !access_node.get_ao_ref (stmt, r))\n \t\t    {\n \t\t      /* Initialize a ref based on the argument and\n \t\t\t unknown offset if possible.  */\n-\t\t      tree arg = access_node.get_call_arg (stmt);\n \t\t      if (arg && TREE_CODE (arg) == SSA_NAME)\n \t\t\targ = SSA_VAL (arg);\n \t\t      if (arg"}]}