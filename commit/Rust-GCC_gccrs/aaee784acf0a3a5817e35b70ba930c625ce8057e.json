{"sha": "aaee784acf0a3a5817e35b70ba930c625ce8057e", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6YWFlZTc4NGFjZjBhM2E1ODE3ZTM1YjcwYmE5MzBjNjI1Y2U4MDU3ZQ==", "commit": {"author": {"name": "Ulrich Weigand", "email": "uweigand@de.ibm.com", "date": "2002-10-21T20:21:00Z"}, "committer": {"name": "Ulrich Weigand", "email": "uweigand@gcc.gnu.org", "date": "2002-10-21T20:21:00Z"}, "message": "profopt.exp (profopt-cleanup): New argument TESTCASE.\n\n\t* lib/profopt.exp (profopt-cleanup): New argument TESTCASE.\n\tRemove only files with the same base name as the test case.\n\t(profopt-perf-value): Pass TESTCASE to profopt-cleanup.\n\t(profopt-execute): Likewise.  Also, remove old profiling\n\tand performance data files before running the tests.\n\n\t* gcc.misc-tests/bprob.exp: Remove profopt-cleanup calls.\n\t* g++.dg/bprob/bprob.exp: Likewise.\n\t* g77.dg/bprob/bprob.exp: Likewise.  Also, relax regexp\n\tto allow more general test case names.\n\n\t* g++.dg/bprob/bprob-1.C: Rename to ...\n\t* g++.dg/bprob/g++-bprob-1.C: ... this.\n\n\t* g77.dg/bprob/bprob-1.f: Rename to ...\n\t* g77.dg/bprob/g77-bprob-1.f: ... this.\n\nFrom-SVN: r58380", "tree": {"sha": "6c6280fdb21a113e85f3e09360656e24f1c0531c", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/6c6280fdb21a113e85f3e09360656e24f1c0531c"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/aaee784acf0a3a5817e35b70ba930c625ce8057e", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/aaee784acf0a3a5817e35b70ba930c625ce8057e", "html_url": "https://github.com/Rust-GCC/gccrs/commit/aaee784acf0a3a5817e35b70ba930c625ce8057e", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/aaee784acf0a3a5817e35b70ba930c625ce8057e/comments", "author": null, "committer": null, "parents": [{"sha": "5d4d885ca6321901051b3374817ff46249f273f1", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/5d4d885ca6321901051b3374817ff46249f273f1", "html_url": "https://github.com/Rust-GCC/gccrs/commit/5d4d885ca6321901051b3374817ff46249f273f1"}], "stats": {"total": 51, "additions": 34, "deletions": 17}, "files": [{"sha": "fba76762f97a805b51ab02a1153ad319c1e54778", "filename": "gcc/testsuite/ChangeLog", "status": "modified", "additions": 19, "deletions": 0, "changes": 19, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/aaee784acf0a3a5817e35b70ba930c625ce8057e/gcc%2Ftestsuite%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/aaee784acf0a3a5817e35b70ba930c625ce8057e/gcc%2Ftestsuite%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2FChangeLog?ref=aaee784acf0a3a5817e35b70ba930c625ce8057e", "patch": "@@ -1,3 +1,22 @@\n+2002-10-21  Ulrich Weigand  <uweigand@de.ibm.com>\n+\n+\t* lib/profopt.exp (profopt-cleanup): New argument TESTCASE.\n+\tRemove only files with the same base name as the test case.\n+\t(profopt-perf-value): Pass TESTCASE to profopt-cleanup.\n+\t(profopt-execute): Likewise.  Also, remove old profiling\n+\tand performance data files before running the tests.\n+\n+\t* gcc.misc-tests/bprob.exp: Remove profopt-cleanup calls.\n+\t* g++.dg/bprob/bprob.exp: Likewise.\n+\t* g77.dg/bprob/bprob.exp: Likewise.  Also, relax regexp\n+\tto allow more general test case names.\n+\n+\t* g++.dg/bprob/bprob-1.C: Rename to ...\n+\t* g++.dg/bprob/g++-bprob-1.C: ... this.\n+\n+\t* g77.dg/bprob/bprob-1.f: Rename to ...\n+\t* g77.dg/bprob/g77-bprob-1.f: ... this.\n+\n 2002-10-21  Zack Weinberg  <zack@codesourcery.com>\n \n \t* gcc.dg/noncompile/920923-1.c: Prevent spurious regressions with"}, {"sha": "d19e341b1ea9f96bea58dbde3f0dadef2d57b360", "filename": "gcc/testsuite/g++.dg/bprob/bprob.exp", "status": "modified", "additions": 0, "deletions": 3, "changes": 3, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/aaee784acf0a3a5817e35b70ba930c625ce8057e/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Fbprob%2Fbprob.exp", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/aaee784acf0a3a5817e35b70ba930c625ce8057e/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Fbprob%2Fbprob.exp", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Fbprob%2Fbprob.exp?ref=aaee784acf0a3a5817e35b70ba930c625ce8057e", "patch": "@@ -51,9 +51,6 @@ if $tracelevel then {\n # Load support procs.\n load_lib profopt.exp\n \n-# Clean up existing .da files.\n-profopt-cleanup da\n-\n # Main loop.\n foreach src [lsort [glob -nocomplain $srcdir/$subdir/*.C]] {\n     # If we're only testing specific files and this isn't one of them, skip it."}, {"sha": "b1a1de77e98ec77c6402bb7458c02a199ae6ca17", "filename": "gcc/testsuite/g++.dg/bprob/g++-bprob-1.C", "status": "renamed", "additions": 0, "deletions": 0, "changes": 0, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/aaee784acf0a3a5817e35b70ba930c625ce8057e/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Fbprob%2Fg%2B%2B-bprob-1.C", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/aaee784acf0a3a5817e35b70ba930c625ce8057e/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Fbprob%2Fg%2B%2B-bprob-1.C", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Fbprob%2Fg%2B%2B-bprob-1.C?ref=aaee784acf0a3a5817e35b70ba930c625ce8057e", "previous_filename": "gcc/testsuite/g++.dg/bprob/bprob-1.C"}, {"sha": "8ca9e9ea95164d779c6f2fd3036e6c8c1e76eb19", "filename": "gcc/testsuite/g77.dg/bprob/bprob.exp", "status": "modified", "additions": 1, "deletions": 5, "changes": 6, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/aaee784acf0a3a5817e35b70ba930c625ce8057e/gcc%2Ftestsuite%2Fg77.dg%2Fbprob%2Fbprob.exp", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/aaee784acf0a3a5817e35b70ba930c625ce8057e/gcc%2Ftestsuite%2Fg77.dg%2Fbprob%2Fbprob.exp", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fg77.dg%2Fbprob%2Fbprob.exp?ref=aaee784acf0a3a5817e35b70ba930c625ce8057e", "patch": "@@ -48,11 +48,7 @@ if $tracelevel then {\n # Load support procs.\n load_lib profopt.exp\n \n-# Clean up existing .da and .tim files.\n-profopt-cleanup da\n-profopt-cleanup tim\n-\n-foreach src [lsort [glob -nocomplain $srcdir/$subdir/bprob-*.f]] {\n+foreach src [lsort [glob -nocomplain $srcdir/$subdir/*.f]] {\n     # If we're only testing specific files and this isn't one of them, skip it.\n     if ![runtest_file_p $runtests $src] then {\n \tcontinue"}, {"sha": "73f04405b9bcffcca4169fb0851db9ade53cc30e", "filename": "gcc/testsuite/g77.dg/bprob/g77-bprob-1.f", "status": "renamed", "additions": 0, "deletions": 0, "changes": 0, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/aaee784acf0a3a5817e35b70ba930c625ce8057e/gcc%2Ftestsuite%2Fg77.dg%2Fbprob%2Fg77-bprob-1.f", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/aaee784acf0a3a5817e35b70ba930c625ce8057e/gcc%2Ftestsuite%2Fg77.dg%2Fbprob%2Fg77-bprob-1.f", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fg77.dg%2Fbprob%2Fg77-bprob-1.f?ref=aaee784acf0a3a5817e35b70ba930c625ce8057e", "previous_filename": "gcc/testsuite/g77.dg/bprob/bprob-1.f"}, {"sha": "5f370682a539488c0b1e8bb25eea80f549a650f5", "filename": "gcc/testsuite/gcc.misc-tests/bprob.exp", "status": "modified", "additions": 0, "deletions": 4, "changes": 4, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/aaee784acf0a3a5817e35b70ba930c625ce8057e/gcc%2Ftestsuite%2Fgcc.misc-tests%2Fbprob.exp", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/aaee784acf0a3a5817e35b70ba930c625ce8057e/gcc%2Ftestsuite%2Fgcc.misc-tests%2Fbprob.exp", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgcc.misc-tests%2Fbprob.exp?ref=aaee784acf0a3a5817e35b70ba930c625ce8057e", "patch": "@@ -48,10 +48,6 @@ if $tracelevel then {\n # Load support procs.\n load_lib profopt.exp\n \n-# Clean up existing .da and .tim files.\n-profopt-cleanup da\n-profopt-cleanup tim\n-\n foreach src [lsort [glob -nocomplain $srcdir/$subdir/bprob-*.c]] {\n     # If we're only testing specific files and this isn't one of them, skip it.\n     if ![runtest_file_p $runtests $src] then {"}, {"sha": "5ecf314977f49ea23b326b007a1203c6e421ee0a", "filename": "gcc/testsuite/lib/profopt.exp", "status": "modified", "additions": 14, "deletions": 5, "changes": 19, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/aaee784acf0a3a5817e35b70ba930c625ce8057e/gcc%2Ftestsuite%2Flib%2Fprofopt.exp", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/aaee784acf0a3a5817e35b70ba930c625ce8057e/gcc%2Ftestsuite%2Flib%2Fprofopt.exp", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Flib%2Fprofopt.exp?ref=aaee784acf0a3a5817e35b70ba930c625ce8057e", "patch": "@@ -71,10 +71,13 @@ set option_list $PROFOPT_OPTIONS\n #\n # profopt-cleanup -- remove profiling or performance results files.\n #\n-# EXT is the extension of files to remove\n+# TESTCASE is the name of the test\n+# EXT is the extension of file to remove\n #\n-proc profopt-cleanup { ext } {\n-    set files [glob -nocomplain *.$ext]\n+proc profopt-cleanup { testcase ext } {\n+    set basename [file tail $testcase]\n+    set base [file rootname $basename]\n+    set files [glob -nocomplain $base.$ext]\n     if { $files != \"\" } {\n \teval \"remote_file build delete $files\"\n     }\n@@ -112,7 +115,7 @@ proc profopt-perf-value { testcase perf_ext optstr } {\n \tfail \"$testcase perf check: file $base.$perf_ext has wrong format, $optstr\"\n     }\n     close $fd\n-    profopt-cleanup $perf_ext\n+    profopt-cleanup $testcase $perf_ext\n     return $val\n }\n \n@@ -150,6 +153,12 @@ proc profopt-execute { src } {\n \tremote_file build delete $execname3\n \tverbose \"Testing $testcase, $option\" 1\n \n+\t# Remove old profiling and performance data files.\n+\tprofopt-cleanup $testcase $prof_ext\n+\tif [info exists perf_ext] {\n+\t    profopt-cleanup $testcase $perf_ext\n+\t}\n+\n \t# Compile for profiling.\n \n \tset options \"\"\n@@ -210,7 +219,7 @@ proc profopt-execute { src } {\n \t}\n \n \t# Remove the profiling data files.\n-\tprofopt-cleanup $prof_ext\n+\tprofopt-cleanup $testcase $prof_ext\n \n \t# If the test is not expected to produce performance data then\n \t# we're done now."}]}