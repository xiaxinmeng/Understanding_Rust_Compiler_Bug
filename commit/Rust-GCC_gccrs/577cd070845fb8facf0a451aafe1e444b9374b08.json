{"sha": "577cd070845fb8facf0a451aafe1e444b9374b08", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6NTc3Y2QwNzA4NDVmYjhmYWNmMGE0NTFhYWZlMWU0NDRiOTM3NGIwOA==", "commit": {"author": {"name": "Marek Polacek", "email": "polacek@redhat.com", "date": "2015-04-30T13:20:03Z"}, "committer": {"name": "Marek Polacek", "email": "mpolacek@gcc.gnu.org", "date": "2015-04-30T13:20:03Z"}, "message": "c-common.c (maybe_warn_bool_compare): When comparing with 0/1, require that the non-constant be of a boolean type.\n\n\t* c-common.c (maybe_warn_bool_compare): When comparing with 0/1,\n\trequire that the non-constant be of a boolean type.\n\n\t* c-c++-common/Wbool-compare-3.c: New test.\n\nFrom-SVN: r222622", "tree": {"sha": "542480c9b7ef2c43959ef8a34b1d4b686702590a", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/542480c9b7ef2c43959ef8a34b1d4b686702590a"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/577cd070845fb8facf0a451aafe1e444b9374b08", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/577cd070845fb8facf0a451aafe1e444b9374b08", "html_url": "https://github.com/Rust-GCC/gccrs/commit/577cd070845fb8facf0a451aafe1e444b9374b08", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/577cd070845fb8facf0a451aafe1e444b9374b08/comments", "author": {"login": "mpolacek", "id": 10496300, "node_id": "MDQ6VXNlcjEwNDk2MzAw", "avatar_url": "https://avatars.githubusercontent.com/u/10496300?v=4", "gravatar_id": "", "url": "https://api.github.com/users/mpolacek", "html_url": "https://github.com/mpolacek", "followers_url": "https://api.github.com/users/mpolacek/followers", "following_url": "https://api.github.com/users/mpolacek/following{/other_user}", "gists_url": "https://api.github.com/users/mpolacek/gists{/gist_id}", "starred_url": "https://api.github.com/users/mpolacek/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/mpolacek/subscriptions", "organizations_url": "https://api.github.com/users/mpolacek/orgs", "repos_url": "https://api.github.com/users/mpolacek/repos", "events_url": "https://api.github.com/users/mpolacek/events{/privacy}", "received_events_url": "https://api.github.com/users/mpolacek/received_events", "type": "User", "site_admin": false}, "committer": null, "parents": [{"sha": "bb83a43d6b768886ea4733ca6218f30d90ea0e15", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/bb83a43d6b768886ea4733ca6218f30d90ea0e15", "html_url": "https://github.com/Rust-GCC/gccrs/commit/bb83a43d6b768886ea4733ca6218f30d90ea0e15"}], "stats": {"total": 50, "additions": 50, "deletions": 0}, "files": [{"sha": "8c2e93345ac2e414ebba0307c5d3afe2caeeaef0", "filename": "gcc/c-family/ChangeLog", "status": "modified", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/577cd070845fb8facf0a451aafe1e444b9374b08/gcc%2Fc-family%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/577cd070845fb8facf0a451aafe1e444b9374b08/gcc%2Fc-family%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fc-family%2FChangeLog?ref=577cd070845fb8facf0a451aafe1e444b9374b08", "patch": "@@ -1,3 +1,8 @@\n+2015-04-30  Marek Polacek  <polacek@redhat.com>\n+\n+\t* c-common.c (maybe_warn_bool_compare): When comparing with 0/1,\n+\trequire that the non-constant be of a boolean type.\n+\n 2015-04-29  Josh Triplett  <josh@joshtriplett.org>\n \n         * c-common.c (handle_section_attribute): Refactor to reduce"}, {"sha": "ada8e8aa9016d0e93448f6befe97ef2560e3f016", "filename": "gcc/c-family/c-common.c", "status": "modified", "additions": 11, "deletions": 0, "changes": 11, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/577cd070845fb8facf0a451aafe1e444b9374b08/gcc%2Fc-family%2Fc-common.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/577cd070845fb8facf0a451aafe1e444b9374b08/gcc%2Fc-family%2Fc-common.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fc-family%2Fc-common.c?ref=577cd070845fb8facf0a451aafe1e444b9374b08", "patch": "@@ -11924,6 +11924,17 @@ maybe_warn_bool_compare (location_t loc, enum tree_code code, tree op0,\n     }\n   else if (integer_zerop (cst) || integer_onep (cst))\n     {\n+      /* If the non-constant operand isn't of a boolean type, we\n+\t don't want to warn here.  */\n+      tree noncst = TREE_CODE (op0) == INTEGER_CST ? op1 : op0;\n+      /* Handle booleans promoted to integers.  */\n+      if (CONVERT_EXPR_P (noncst)\n+\t  && TREE_TYPE (noncst) == integer_type_node\n+\t  && TREE_CODE (TREE_TYPE (TREE_OPERAND (noncst, 0))) == BOOLEAN_TYPE)\n+\t/* Warn.  */;\n+      else if (TREE_CODE (TREE_TYPE (noncst)) != BOOLEAN_TYPE\n+\t       && !truth_value_p (TREE_CODE (noncst)))\n+\treturn;\n       /* Do some magic to get the right diagnostics.  */\n       bool flag = TREE_CODE (op0) == INTEGER_CST;\n       flag = integer_zerop (cst) ? flag : !flag;"}, {"sha": "455776844e370d09063c01161d7db72dc7d64f31", "filename": "gcc/testsuite/ChangeLog", "status": "modified", "additions": 4, "deletions": 0, "changes": 4, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/577cd070845fb8facf0a451aafe1e444b9374b08/gcc%2Ftestsuite%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/577cd070845fb8facf0a451aafe1e444b9374b08/gcc%2Ftestsuite%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2FChangeLog?ref=577cd070845fb8facf0a451aafe1e444b9374b08", "patch": "@@ -1,3 +1,7 @@\n+2015-04-30  Marek Polacek  <polacek@redhat.com>\n+\n+\t* c-c++-common/Wbool-compare-3.c: New test.\n+\n 2015-04-30  Paolo Carlini  <paolo.carlini@oracle.com>\n \n \tPR c++/57610"}, {"sha": "bac4f47c2a050294afc344d42d7503409da5f100", "filename": "gcc/testsuite/c-c++-common/Wbool-compare-3.c", "status": "added", "additions": 30, "deletions": 0, "changes": 30, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/577cd070845fb8facf0a451aafe1e444b9374b08/gcc%2Ftestsuite%2Fc-c%2B%2B-common%2FWbool-compare-3.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/577cd070845fb8facf0a451aafe1e444b9374b08/gcc%2Ftestsuite%2Fc-c%2B%2B-common%2FWbool-compare-3.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fc-c%2B%2B-common%2FWbool-compare-3.c?ref=577cd070845fb8facf0a451aafe1e444b9374b08", "patch": "@@ -0,0 +1,30 @@\n+/* { dg-do compile } */\n+/* { dg-options \"-Wbool-compare\" } */\n+\n+#ifndef __cplusplus\n+# define bool _Bool\n+#endif\n+\n+#define A 0\n+#define B 1\n+\n+int\n+foo (int i, bool b)\n+{\n+  int r = 0;\n+\n+  r += i <= (A || B);\n+  r += i <= b;\n+  r += i <= A;\n+  r += i < (A || B);\n+  r += i < b;\n+  r += i < A;\n+  r += i > (A || B);\n+  r += i > b;\n+  r += i > A;\n+  r += i >= (A || B);\n+  r += i >= b;\n+  r += i >= A;\n+\n+  return r;\n+}"}]}