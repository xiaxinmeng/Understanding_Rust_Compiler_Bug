{"sha": "d2fb5329006990b3f6a6cf970d7df89071e58815", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6ZDJmYjUzMjkwMDY5OTBiM2Y2YTZjZjk3MGQ3ZGY4OTA3MWU1ODgxNQ==", "commit": {"author": {"name": "Tom Tromey", "email": "tromey@redhat.com", "date": "2002-02-23T00:42:13Z"}, "committer": {"name": "Tom Tromey", "email": "tromey@gcc.gnu.org", "date": "2002-02-23T00:42:13Z"}, "message": "re PR java/2369 (--main should check the following symbol)\n\n\tFix for PR java/2369:\n\t* jvspec.c (verify_class_name): New function.\n\t(lang_specific_driver): Call it.\n\t(JAVA_START_CHAR_P): New macro.\n\t(JAVA_PART_CHAR_P): Likewise.\n\nFrom-SVN: r49981", "tree": {"sha": "a9aa161b2a2ed17d5282aa7af46a3e9aebac3d51", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/a9aa161b2a2ed17d5282aa7af46a3e9aebac3d51"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/d2fb5329006990b3f6a6cf970d7df89071e58815", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/d2fb5329006990b3f6a6cf970d7df89071e58815", "html_url": "https://github.com/Rust-GCC/gccrs/commit/d2fb5329006990b3f6a6cf970d7df89071e58815", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/d2fb5329006990b3f6a6cf970d7df89071e58815/comments", "author": null, "committer": null, "parents": [{"sha": "9abe2e29b4cc5e50af73f2371acbb7a6fcf234e3", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/9abe2e29b4cc5e50af73f2371acbb7a6fcf234e3", "html_url": "https://github.com/Rust-GCC/gccrs/commit/9abe2e29b4cc5e50af73f2371acbb7a6fcf234e3"}], "stats": {"total": 51, "additions": 51, "deletions": 0}, "files": [{"sha": "ffd0b6ba9617781a48732c2dc29d348555126510", "filename": "gcc/java/ChangeLog", "status": "modified", "additions": 8, "deletions": 0, "changes": 8, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/d2fb5329006990b3f6a6cf970d7df89071e58815/gcc%2Fjava%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/d2fb5329006990b3f6a6cf970d7df89071e58815/gcc%2Fjava%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fjava%2FChangeLog?ref=d2fb5329006990b3f6a6cf970d7df89071e58815", "patch": "@@ -1,3 +1,11 @@\n+2002-02-22  Tom Tromey  <tromey@redhat.com>\n+\n+\tFix for PR java/2369:\n+\t* jvspec.c (verify_class_name): New function.\n+\t(lang_specific_driver): Call it.\n+\t(JAVA_START_CHAR_P): New macro.\n+\t(JAVA_PART_CHAR_P): Likewise.\n+\n 2002-02-22  Per Bothner  <per@bothner.com>\n \n \t*  class.c:  Change vtable to be more compatible with g++ v3 abi."}, {"sha": "5bb3e9d164b2a779cc0470f9ee9abbe5196fe697", "filename": "gcc/java/jvspec.c", "status": "modified", "additions": 43, "deletions": 0, "changes": 43, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/d2fb5329006990b3f6a6cf970d7df89071e58815/gcc%2Fjava%2Fjvspec.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/d2fb5329006990b3f6a6cf970d7df89071e58815/gcc%2Fjava%2Fjvspec.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fjava%2Fjvspec.c?ref=d2fb5329006990b3f6a6cf970d7df89071e58815", "patch": "@@ -46,6 +46,7 @@ The Free Software Foundation is independent of Sun Microsystems, Inc.  */\n #define RESOURCE_FILE_ARG (1<<7)\n \n static char *find_spec_file\tPARAMS ((const char *));\n+static int verify_class_name    PARAMS ((const char *));\n \n static const char *main_class_name = NULL;\n int lang_specific_extra_outfiles = 0;\n@@ -98,6 +99,45 @@ find_spec_file (dir)\n   return NULL;\n }\n \n+/* FIXME: these should come from lex.h.  */\n+#define JAVA_START_CHAR_P(c) (c < 128 && (ISIDST (c) || c == '$'))\n+#define JAVA_PART_CHAR_P(c) (c < 128\t\t\t\t\t      \\\n+\t\t\t     && (ISIDNUM (c)\t\t\t\t      \\\n+\t\t\t\t || c == '$'\t\t\t\t      \\\n+\t\t\t\t || (c >= 0x00 && c <= 0x08)\t\t      \\\n+\t\t\t\t || (c >= 0x0e && c <= 0x1b)\t\t      \\\n+\t\t\t\t || c == 0x7f))\n+\n+/* Verify that NAME is a valid Java class name that might contain\n+   `main'.  Return 0 on failure.  */\n+static int\n+verify_class_name (name)\n+     const char *name;\n+{\n+  /* FIXME: what encoding do we use for command-line arguments?  For\n+     now we assume plain ASCII, which of course is wrong.  */\n+  while (*name)\n+    {\n+      int ch = *name++;\n+      if (ch < 0 || ! JAVA_START_CHAR_P (ch))\n+\treturn 0;\n+      while (*name)\n+\t{\n+\t  ch = *name++;\n+\t  if (ch < 0)\n+\t    return 0;\n+\t  /* We found a break between class names.  Next character\n+\t     must be an identifier start again.  */\n+\t  if (ch == '.')\n+\t    break;\n+\t  if (! JAVA_PART_CHAR_P (ch))\n+\t    return 0;\n+\t}\n+    }\n+\n+  return 1;\n+}\n+\n void\n lang_specific_driver (in_argc, in_argv, in_added_libraries)\n      int *in_argc;\n@@ -383,6 +423,9 @@ lang_specific_driver (in_argc, in_argv, in_added_libraries)\n   if (saw_D && ! main_class_name)\n     fatal (\"can't specify `-D' without `--main'\\n\");\n \n+  if (main_class_name && ! verify_class_name (main_class_name))\n+    fatal (\"`%s' is not a valid class name\", main_class_name);\n+\n   num_args = argc + added;\n   if (saw_R)\n     {"}]}