{"sha": "5818c8e43667f9e256b2d730a9a7d7bf56cbce83", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6NTgxOGM4ZTQzNjY3ZjllMjU2YjJkNzMwYTlhN2Q3YmY1NmNiY2U4Mw==", "commit": {"author": {"name": "Jason Merrill", "email": "jason@redhat.com", "date": "2007-10-22T18:03:10Z"}, "committer": {"name": "Jason Merrill", "email": "jason@gcc.gnu.org", "date": "2007-10-22T18:03:10Z"}, "message": "re PR c++/33620 (internal compiler error: canonical types differ for identical types const QList<QStringList> and const QList<QStringList>)\n\n        PR c++/33620\n        * class.c (finish_struct_bits): Copy TYPE_ATTRIBUTES.\n        * pt.c (apply_late_template_attributes): Splice out dependent\n        attributes from DECL_ATTRIBUTES.\n\n        * decl.c (cxx_maybe_build_cleanup): Use build_address.\n\nFrom-SVN: r129553", "tree": {"sha": "2d278ce5c068769ddd0d3b21740338eeff8c9022", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/2d278ce5c068769ddd0d3b21740338eeff8c9022"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/5818c8e43667f9e256b2d730a9a7d7bf56cbce83", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/5818c8e43667f9e256b2d730a9a7d7bf56cbce83", "html_url": "https://github.com/Rust-GCC/gccrs/commit/5818c8e43667f9e256b2d730a9a7d7bf56cbce83", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/5818c8e43667f9e256b2d730a9a7d7bf56cbce83/comments", "author": {"login": "jicama", "id": 266146, "node_id": "MDQ6VXNlcjI2NjE0Ng==", "avatar_url": "https://avatars.githubusercontent.com/u/266146?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jicama", "html_url": "https://github.com/jicama", "followers_url": "https://api.github.com/users/jicama/followers", "following_url": "https://api.github.com/users/jicama/following{/other_user}", "gists_url": "https://api.github.com/users/jicama/gists{/gist_id}", "starred_url": "https://api.github.com/users/jicama/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jicama/subscriptions", "organizations_url": "https://api.github.com/users/jicama/orgs", "repos_url": "https://api.github.com/users/jicama/repos", "events_url": "https://api.github.com/users/jicama/events{/privacy}", "received_events_url": "https://api.github.com/users/jicama/received_events", "type": "User", "site_admin": false}, "committer": null, "parents": [{"sha": "22a5d0133dae10ca048e822f180e40cf9400a253", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/22a5d0133dae10ca048e822f180e40cf9400a253", "html_url": "https://github.com/Rust-GCC/gccrs/commit/22a5d0133dae10ca048e822f180e40cf9400a253"}], "stats": {"total": 74, "additions": 59, "deletions": 15}, "files": [{"sha": "903db53a3233714600247ad9112b02af3fc0b9d0", "filename": "gcc/cp/ChangeLog", "status": "modified", "additions": 9, "deletions": 0, "changes": 9, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/5818c8e43667f9e256b2d730a9a7d7bf56cbce83/gcc%2Fcp%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/5818c8e43667f9e256b2d730a9a7d7bf56cbce83/gcc%2Fcp%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fcp%2FChangeLog?ref=5818c8e43667f9e256b2d730a9a7d7bf56cbce83", "patch": "@@ -1,3 +1,12 @@\n+2007-10-22  Jason Merrill  <jason@redhat.com>\n+\n+\tPR c++/33620\n+\t* class.c (finish_struct_bits): Copy TYPE_ATTRIBUTES.\n+\t* pt.c (apply_late_template_attributes): Splice out dependent\n+\tattributes from DECL_ATTRIBUTES.\n+\n+\t* decl.c (cxx_maybe_build_cleanup): Use build_address.\n+\n 2007-10-17  Manuel Lopez-Ibanez  <manu@gcc.gnu.org>\n \n \t* typeck.c (build_binary_op) : Use appropriate warning option"}, {"sha": "54dc14c17ef53cd33c00f2784aa32581492e6e23", "filename": "gcc/cp/class.c", "status": "modified", "additions": 3, "deletions": 0, "changes": 3, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/5818c8e43667f9e256b2d730a9a7d7bf56cbce83/gcc%2Fcp%2Fclass.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/5818c8e43667f9e256b2d730a9a7d7bf56cbce83/gcc%2Fcp%2Fclass.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fcp%2Fclass.c?ref=5818c8e43667f9e256b2d730a9a7d7bf56cbce83", "patch": "@@ -1452,6 +1452,9 @@ finish_struct_bits (tree t)\n       TYPE_VFIELD (variants) = TYPE_VFIELD (t);\n       TYPE_METHODS (variants) = TYPE_METHODS (t);\n       TYPE_FIELDS (variants) = TYPE_FIELDS (t);\n+\n+      /* All variants of a class have the same attributes.  */\n+      TYPE_ATTRIBUTES (variants) = TYPE_ATTRIBUTES (t);\n     }\n \n   if (BINFO_N_BASE_BINFOS (TYPE_BINFO (t)) && TYPE_POLYMORPHIC_P (t))"}, {"sha": "136c8dfd1ac81d1e281e0430a21dd58e81128371", "filename": "gcc/cp/decl.c", "status": "modified", "additions": 1, "deletions": 4, "changes": 5, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/5818c8e43667f9e256b2d730a9a7d7bf56cbce83/gcc%2Fcp%2Fdecl.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/5818c8e43667f9e256b2d730a9a7d7bf56cbce83/gcc%2Fcp%2Fdecl.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fcp%2Fdecl.c?ref=5818c8e43667f9e256b2d730a9a7d7bf56cbce83", "patch": "@@ -12134,10 +12134,7 @@ cxx_maybe_build_cleanup (tree decl)\n       if (TREE_CODE (type) == ARRAY_TYPE)\n \taddr = decl;\n       else\n-\t{\n-\t  cxx_mark_addressable (decl);\n-\t  addr = build_unary_op (ADDR_EXPR, decl, 0);\n-\t}\n+\taddr = build_address (decl);\n \n       /* Optimize for space over speed here.  */\n       if (!has_vbases || flag_expensive_optimizations)"}, {"sha": "a54e90d6fa723bfb9ca9b8bf956146f3e6ce1717", "filename": "gcc/cp/pt.c", "status": "modified", "additions": 35, "deletions": 11, "changes": 46, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/5818c8e43667f9e256b2d730a9a7d7bf56cbce83/gcc%2Fcp%2Fpt.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/5818c8e43667f9e256b2d730a9a7d7bf56cbce83/gcc%2Fcp%2Fpt.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fcp%2Fpt.c?ref=5818c8e43667f9e256b2d730a9a7d7bf56cbce83", "patch": "@@ -6488,23 +6488,47 @@ static void\n apply_late_template_attributes (tree *decl_p, tree attributes, int attr_flags,\n \t\t\t\ttree args, tsubst_flags_t complain, tree in_decl)\n {\n-  tree late_attrs = NULL_TREE;\n+  tree last_dep = NULL_TREE;\n   tree t;\n+  tree *p;\n+\n+  for (t = attributes; t; t = TREE_CHAIN (t))\n+    if (ATTR_IS_DEPENDENT (t))\n+      {\n+\tlast_dep = t;\n+\tattributes = copy_list (attributes);\n+\tbreak;\n+      }\n \n   if (DECL_P (*decl_p))\n-    DECL_ATTRIBUTES (*decl_p) = attributes;\n+    p = &DECL_ATTRIBUTES (*decl_p);\n   else\n-    TYPE_ATTRIBUTES (*decl_p) = attributes;\n+    p = &TYPE_ATTRIBUTES (*decl_p);\n \n-  for (t = attributes; t; t = TREE_CHAIN (t))\n-    if (ATTR_IS_DEPENDENT (t))\n-      late_attrs = tree_cons\n-\t(TREE_PURPOSE (t),\n-\t tsubst_expr (TREE_VALUE (t), args, complain, in_decl,\n-\t\t      /*integral_constant_expression_p=*/false),\n-\t late_attrs);\n+  if (last_dep)\n+    {\n+      tree late_attrs = NULL_TREE;\n+      tree *q = &late_attrs;\n \n-  cplus_decl_attributes (decl_p, late_attrs, attr_flags);\n+      for (*p = attributes; *p; )\n+\t{\n+\t  t = *p;\n+\t  if (ATTR_IS_DEPENDENT (t))\n+\t    {\n+\t      *p = TREE_CHAIN (t);\n+\t      TREE_CHAIN (t) = NULL_TREE;\n+\t      TREE_VALUE (t)\n+\t\t= tsubst_expr (TREE_VALUE (t), args, complain, in_decl,\n+\t\t\t       /*integral_constant_expression_p=*/false);\n+\t      *q = t;\n+\t      q = &TREE_CHAIN (t);\n+\t    }\n+\t  else\n+\t    p = &TREE_CHAIN (t);\n+\t}\n+\n+      cplus_decl_attributes (decl_p, late_attrs, attr_flags);\n+    }\n }\n \n tree"}, {"sha": "ee6c41847683c7244467bdc5ea4be01406d7ba94", "filename": "gcc/testsuite/g++.dg/ext/tmplattr7.C", "status": "added", "additions": 11, "deletions": 0, "changes": 11, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/5818c8e43667f9e256b2d730a9a7d7bf56cbce83/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Fext%2Ftmplattr7.C", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/5818c8e43667f9e256b2d730a9a7d7bf56cbce83/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Fext%2Ftmplattr7.C", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Fext%2Ftmplattr7.C?ref=5818c8e43667f9e256b2d730a9a7d7bf56cbce83", "patch": "@@ -0,0 +1,11 @@\n+// PR c++/33620\n+\n+template <typename T>\n+struct __attribute__((visibility(\"default\"))) List {};\n+\n+int bar(List<int> args);\n+bool test(const List<int> &);\n+\n+int i = bar(List<int>());\n+\n+bool test(const List<int> &) {}"}]}