{"sha": "da6ce351069bda74d814b723934008d75bd4e8b0", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6ZGE2Y2UzNTEwNjliZGE3NGQ4MTRiNzIzOTM0MDA4ZDc1YmQ0ZThiMA==", "commit": {"author": {"name": "Jonathan Wakely", "email": "jwakely@redhat.com", "date": "2021-08-23T12:12:24Z"}, "committer": {"name": "Jonathan Wakely", "email": "jwakely@redhat.com", "date": "2021-08-23T13:45:00Z"}, "message": "libstdc++: Use __builtin_expect in __dynamic_cast\n\nThe null pointer check is never needed for correct code, only to\ngracefully handle undefined cases. Add __builtin_expect to be sure that\nwe don't pessimize the valid uses.\n\nlibstdc++-v3/ChangeLog:\n\n\t* libsupc++/dyncast.cc (__dynamic_cast): Add __builtin_expect to\n\tprecondition check.", "tree": {"sha": "2d9a2c128877375521ca94a0582099f9b6e18323", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/2d9a2c128877375521ca94a0582099f9b6e18323"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/da6ce351069bda74d814b723934008d75bd4e8b0", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/da6ce351069bda74d814b723934008d75bd4e8b0", "html_url": "https://github.com/Rust-GCC/gccrs/commit/da6ce351069bda74d814b723934008d75bd4e8b0", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/da6ce351069bda74d814b723934008d75bd4e8b0/comments", "author": {"login": "jwakely", "id": 1254480, "node_id": "MDQ6VXNlcjEyNTQ0ODA=", "avatar_url": "https://avatars.githubusercontent.com/u/1254480?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jwakely", "html_url": "https://github.com/jwakely", "followers_url": "https://api.github.com/users/jwakely/followers", "following_url": "https://api.github.com/users/jwakely/following{/other_user}", "gists_url": "https://api.github.com/users/jwakely/gists{/gist_id}", "starred_url": "https://api.github.com/users/jwakely/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jwakely/subscriptions", "organizations_url": "https://api.github.com/users/jwakely/orgs", "repos_url": "https://api.github.com/users/jwakely/repos", "events_url": "https://api.github.com/users/jwakely/events{/privacy}", "received_events_url": "https://api.github.com/users/jwakely/received_events", "type": "User", "site_admin": false}, "committer": {"login": "jwakely", "id": 1254480, "node_id": "MDQ6VXNlcjEyNTQ0ODA=", "avatar_url": "https://avatars.githubusercontent.com/u/1254480?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jwakely", "html_url": "https://github.com/jwakely", "followers_url": "https://api.github.com/users/jwakely/followers", "following_url": "https://api.github.com/users/jwakely/following{/other_user}", "gists_url": "https://api.github.com/users/jwakely/gists{/gist_id}", "starred_url": "https://api.github.com/users/jwakely/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jwakely/subscriptions", "organizations_url": "https://api.github.com/users/jwakely/orgs", "repos_url": "https://api.github.com/users/jwakely/repos", "events_url": "https://api.github.com/users/jwakely/events{/privacy}", "received_events_url": "https://api.github.com/users/jwakely/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "bc97e736a5597ac1545b7f9069472117b6caa867", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/bc97e736a5597ac1545b7f9069472117b6caa867", "html_url": "https://github.com/Rust-GCC/gccrs/commit/bc97e736a5597ac1545b7f9069472117b6caa867"}], "stats": {"total": 8, "additions": 4, "deletions": 4}, "files": [{"sha": "a1138d04f6d246abe6fafa9f76fb7d470817243b", "filename": "libstdc++-v3/libsupc++/dyncast.cc", "status": "modified", "additions": 4, "deletions": 4, "changes": 8, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/da6ce351069bda74d814b723934008d75bd4e8b0/libstdc%2B%2B-v3%2Flibsupc%2B%2B%2Fdyncast.cc", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/da6ce351069bda74d814b723934008d75bd4e8b0/libstdc%2B%2B-v3%2Flibsupc%2B%2B%2Fdyncast.cc", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libstdc%2B%2B-v3%2Flibsupc%2B%2B%2Fdyncast.cc?ref=da6ce351069bda74d814b723934008d75bd4e8b0", "patch": "@@ -47,9 +47,9 @@ __dynamic_cast (const void *src_ptr,    // object started from\n                 const __class_type_info *dst_type, // desired target type\n                 ptrdiff_t src2dst) // how src and dst are related\n   {\n-  if (!src_ptr)\n-    /* Handle precondition violations gracefully.  */\n-    return NULL;\n+  if (__builtin_expect(!src_ptr, 0))\n+    return NULL; // Handle precondition violations gracefully.\n+\n   const void *vtable = *static_cast <const void *const *> (src_ptr);\n   const vtable_prefix *prefix =\n     (adjust_pointer <vtable_prefix>\n@@ -70,7 +70,7 @@ __dynamic_cast (const void *src_ptr,    // object started from\n      (whole_vtable, -ptrdiff_t (offsetof (vtable_prefix, origin))));\n   if (whole_prefix->whole_type != whole_type)\n     return NULL;\n-  \n+\n   whole_type->__do_dyncast (src2dst, __class_type_info::__contained_public,\n                             dst_type, whole_ptr, src_type, src_ptr, result);\n   if (!result.dst_ptr)"}]}