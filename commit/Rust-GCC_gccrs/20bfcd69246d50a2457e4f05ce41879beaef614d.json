{"sha": "20bfcd69246d50a2457e4f05ce41879beaef614d", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6MjBiZmNkNjkyNDZkNTBhMjQ1N2U0ZjA1Y2U0MTg3OWJlYWVmNjE0ZA==", "commit": {"author": {"name": "Geoffrey Keating", "email": "geoffk@apple.com", "date": "2003-05-02T18:32:49Z"}, "committer": {"name": "Geoffrey Keating", "email": "geoffk@gcc.gnu.org", "date": "2003-05-02T18:32:49Z"}, "message": "sysv4.h (SYMBOL_FLAG_SMALL_V4): Delete.\n\n\t* config/rs6000/sysv4.h (SYMBOL_FLAG_SMALL_V4): Delete.\n\t(SYMBOL_FLAG_SMALL_V4): Delete.\n\t* config/rs6000/rs6000.c (small_data_operand): Use SYMBOL_REF_SMALL_P.\n\t(rs6000_elf_encode_section_info): Don't set SYMBOL_FLAG_SMALL_V4.\n\t(rs6000_elf_in_small_data_p): Add extra section names.  Add\n\tcomment about TREE_PUBLIC test.\n\nFrom-SVN: r66393", "tree": {"sha": "906721cefa276fb5d223aed3f169373c84013c64", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/906721cefa276fb5d223aed3f169373c84013c64"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/20bfcd69246d50a2457e4f05ce41879beaef614d", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/20bfcd69246d50a2457e4f05ce41879beaef614d", "html_url": "https://github.com/Rust-GCC/gccrs/commit/20bfcd69246d50a2457e4f05ce41879beaef614d", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/20bfcd69246d50a2457e4f05ce41879beaef614d/comments", "author": {"login": "geoffk01", "id": 31905243, "node_id": "MDQ6VXNlcjMxOTA1MjQz", "avatar_url": "https://avatars.githubusercontent.com/u/31905243?v=4", "gravatar_id": "", "url": "https://api.github.com/users/geoffk01", "html_url": "https://github.com/geoffk01", "followers_url": "https://api.github.com/users/geoffk01/followers", "following_url": "https://api.github.com/users/geoffk01/following{/other_user}", "gists_url": "https://api.github.com/users/geoffk01/gists{/gist_id}", "starred_url": "https://api.github.com/users/geoffk01/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/geoffk01/subscriptions", "organizations_url": "https://api.github.com/users/geoffk01/orgs", "repos_url": "https://api.github.com/users/geoffk01/repos", "events_url": "https://api.github.com/users/geoffk01/events{/privacy}", "received_events_url": "https://api.github.com/users/geoffk01/received_events", "type": "User", "site_admin": false}, "committer": null, "parents": [{"sha": "7454096f706828364fc50756a67df3a6269482ac", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/7454096f706828364fc50756a67df3a6269482ac", "html_url": "https://github.com/Rust-GCC/gccrs/commit/7454096f706828364fc50756a67df3a6269482ac"}], "stats": {"total": 52, "additions": 14, "deletions": 38}, "files": [{"sha": "6b8691347c10f07b9b33e4fff983e8d1ba0fd1ed", "filename": "gcc/ChangeLog", "status": "modified", "additions": 7, "deletions": 0, "changes": 7, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/20bfcd69246d50a2457e4f05ce41879beaef614d/gcc%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/20bfcd69246d50a2457e4f05ce41879beaef614d/gcc%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2FChangeLog?ref=20bfcd69246d50a2457e4f05ce41879beaef614d", "patch": "@@ -1,5 +1,12 @@\n 2003-05-02  Geoffrey Keating  <geoffk@apple.com>\n \n+\t* config/rs6000/sysv4.h (SYMBOL_FLAG_SMALL_V4): Delete.\n+\t(SYMBOL_FLAG_SMALL_V4): Delete.\n+\t* config/rs6000/rs6000.c (small_data_operand): Use SYMBOL_REF_SMALL_P.\n+\t(rs6000_elf_encode_section_info): Don't set SYMBOL_FLAG_SMALL_V4.\n+\t(rs6000_elf_in_small_data_p): Add extra section names.  Add\n+\tcomment about TREE_PUBLIC test.\n+\n \t* c-semantics.c (genrtl_switch_stmt, genrtl_if_stmt): Call\n \texpand_stmt on result of expand_unreachable_stmt.\n "}, {"sha": "c63e4062ebaf1918fcf0ab5eecf73a0733a8de85", "filename": "gcc/config/rs6000/rs6000.c", "status": "modified", "additions": 7, "deletions": 32, "changes": 39, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/20bfcd69246d50a2457e4f05ce41879beaef614d/gcc%2Fconfig%2Frs6000%2Frs6000.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/20bfcd69246d50a2457e4f05ce41879beaef614d/gcc%2Fconfig%2Frs6000%2Frs6000.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fconfig%2Frs6000%2Frs6000.c?ref=20bfcd69246d50a2457e4f05ce41879beaef614d", "patch": "@@ -2210,7 +2210,7 @@ small_data_operand (op, mode)\n       sym_ref = XEXP (sum, 0);\n     }\n \n-  return SYMBOL_REF_SMALL_V4_P (sym_ref);\n+  return SYMBOL_REF_SMALL_P (sym_ref);\n #else\n   return 0;\n #endif\n@@ -12926,9 +12926,6 @@ rs6000_elf_unique_section (decl, reloc)\n /* For a SYMBOL_REF, set generic flags and then perform some\n    target-specific processing.\n \n-   Set SYMBOL_FLAG_SMALL_V4 for an operand in small memory on V.4/eabi;\n-   this is different from the generic SYMBOL_FLAG_SMALL.\n-\n    When the AIX ABI is requested on a non-AIX system, replace the\n    function name with the real name (with a leading .) rather than the\n    function descriptor name.  This saves a lot of overriding code to\n@@ -12954,33 +12951,6 @@ rs6000_elf_encode_section_info (decl, rtl, first)\n       memcpy (str + 1, XSTR (sym_ref, 0), len + 1);\n       XSTR (sym_ref, 0) = ggc_alloc_string (str, len + 1);\n     }\n-  else if (rs6000_sdata != SDATA_NONE\n-\t   && DEFAULT_ABI == ABI_V4\n-\t   && TREE_CODE (decl) == VAR_DECL)\n-    {\n-      rtx sym_ref = XEXP (rtl, 0);\n-      int size = int_size_in_bytes (TREE_TYPE (decl));\n-      tree section_name = DECL_SECTION_NAME (decl);\n-      const char *name = (char *)0;\n-\n-      if (section_name)\n-\t{\n-\t  if (TREE_CODE (section_name) == STRING_CST)\n-\t    name = TREE_STRING_POINTER (section_name);\n-\t  else\n-\t    abort ();\n-\t}\n-\n-      if (name\n-\t  ? (strcmp (name, \".sdata\") == 0\n-\t     || strcmp (name, \".sdata2\") == 0\n-\t     || strcmp (name, \".sbss\") == 0\n-\t     || strcmp (name, \".sbss2\") == 0\n-\t     || strcmp (name, \".PPC.EMB.sdata0\") == 0\n-\t     || strcmp (name, \".PPC.EMB.sbss0\") == 0)\n-\t  : (size > 0 && size <= g_switch_value))\n-\tSYMBOL_REF_FLAGS (sym_ref) |= SYMBOL_FLAG_SMALL_V4;\n-    }\n }\n \n static bool\n@@ -12995,7 +12965,10 @@ rs6000_elf_in_small_data_p (decl)\n       const char *section = TREE_STRING_POINTER (DECL_SECTION_NAME (decl));\n       if (strcmp (section, \".sdata\") == 0\n \t  || strcmp (section, \".sdata2\") == 0\n-\t  || strcmp (section, \".sbss\") == 0)\n+\t  || strcmp (section, \".sbss\") == 0\n+\t  || strcmp (section, \".sbss2\") == 0\n+\t  || strcmp (section, \".PPC.EMB.sdata0\") == 0\n+\t  || strcmp (section, \".PPC.EMB.sbss0\") == 0)\n \treturn true;\n     }\n   else\n@@ -13004,6 +12977,8 @@ rs6000_elf_in_small_data_p (decl)\n \n       if (size > 0\n \t  && size <= g_switch_value\n+\t  /* If it's not public, and we're not going to reference it there,\n+\t     there's no need to put it in the small data section.  */\n \t  && (rs6000_sdata != SDATA_DATA || TREE_PUBLIC (decl)))\n \treturn true;\n     }"}, {"sha": "69c86ec007fcb6eb89a908e9c3513c1d079b7293", "filename": "gcc/config/rs6000/sysv4.h", "status": "modified", "additions": 0, "deletions": 6, "changes": 6, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/20bfcd69246d50a2457e4f05ce41879beaef614d/gcc%2Fconfig%2Frs6000%2Fsysv4.h", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/20bfcd69246d50a2457e4f05ce41879beaef614d/gcc%2Fconfig%2Frs6000%2Fsysv4.h", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fconfig%2Frs6000%2Fsysv4.h?ref=20bfcd69246d50a2457e4f05ce41879beaef614d", "patch": "@@ -1374,9 +1374,3 @@ ncrtn.o%s\"\n \n /* Generate entries in .fixup for relocatable addresses.  */\n #define RELOCATABLE_NEEDS_FIXUP\n-\n-/* Define target-specific symbol_ref flags, beginning with\n-   SYMBOL_REF_FLAG_DEP.  */\n-#define SYMBOL_FLAG_SMALL_V4  (SYMBOL_FLAG_MACH_DEP << 0)\n-#define SYMBOL_REF_SMALL_V4_P(RTX) \\\n-  ((SYMBOL_REF_FLAGS (RTX) & SYMBOL_FLAG_SMALL_V4) != 0)"}]}