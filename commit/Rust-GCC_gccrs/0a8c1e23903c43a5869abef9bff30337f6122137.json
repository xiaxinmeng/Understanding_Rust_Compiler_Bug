{"sha": "0a8c1e23903c43a5869abef9bff30337f6122137", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6MGE4YzFlMjM5MDNjNDNhNTg2OWFiZWY5YmZmMzAzMzdmNjEyMjEzNw==", "commit": {"author": {"name": "Jeff Law", "email": "law@redhat.com", "date": "2015-10-23T19:16:53Z"}, "committer": {"name": "Jeff Law", "email": "law@gcc.gnu.org", "date": "2015-10-23T19:16:53Z"}, "message": "[RFA] Fix pr67830, another type narrowing problem\n\n\tPR tree-optimization/67830\n\t* match.pd ((bit_and (plus/minus (convert @0) (convert @1)) mask)):\n\tExplicitly verify the mask has no bits outside the type of\n\tthe innermost operands.\n\n\tPR tree-optimization/67830\n\t* gcc.dg/pr67830.c: New test.\n\nFrom-SVN: r229267", "tree": {"sha": "de244e9c75eefeef6b1158112ed8ee8c63e19a8f", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/de244e9c75eefeef6b1158112ed8ee8c63e19a8f"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/0a8c1e23903c43a5869abef9bff30337f6122137", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/0a8c1e23903c43a5869abef9bff30337f6122137", "html_url": "https://github.com/Rust-GCC/gccrs/commit/0a8c1e23903c43a5869abef9bff30337f6122137", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/0a8c1e23903c43a5869abef9bff30337f6122137/comments", "author": null, "committer": null, "parents": [{"sha": "7e8efecbaf4fb902b5b092655640591d7531e4f7", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/7e8efecbaf4fb902b5b092655640591d7531e4f7", "html_url": "https://github.com/Rust-GCC/gccrs/commit/7e8efecbaf4fb902b5b092655640591d7531e4f7"}], "stats": {"total": 38, "additions": 36, "deletions": 2}, "files": [{"sha": "29d1ffab0fc370a24c57e276739fa22438f7875a", "filename": "gcc/ChangeLog", "status": "modified", "additions": 7, "deletions": 0, "changes": 7, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/0a8c1e23903c43a5869abef9bff30337f6122137/gcc%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/0a8c1e23903c43a5869abef9bff30337f6122137/gcc%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2FChangeLog?ref=0a8c1e23903c43a5869abef9bff30337f6122137", "patch": "@@ -1,3 +1,10 @@\n+2015-10-23  Jeff Law  <law@redhat.com>\n+\n+\tPR tree-optimization/67830\n+\t* match.pd ((bit_and (plus/minus (convert @0) (convert @1)) mask)):\n+\tExplicitly verify the mask has no bits outside the type of\n+\tthe innermost operands.\n+\n 2015-10-23  Gregor Richards  <gregor.richards@uwaterloo.ca>\n \t    Szabolcs Nagy  <szabolcs.nagy@arm.com>\n "}, {"sha": "d6ab94ecf6f0d73d6448028c12776dc5a650ac5b", "filename": "gcc/match.pd", "status": "modified", "additions": 2, "deletions": 2, "changes": 4, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/0a8c1e23903c43a5869abef9bff30337f6122137/gcc%2Fmatch.pd", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/0a8c1e23903c43a5869abef9bff30337f6122137/gcc%2Fmatch.pd", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fmatch.pd?ref=0a8c1e23903c43a5869abef9bff30337f6122137", "patch": "@@ -2719,8 +2719,8 @@ along with GCC; see the file COPYING3.  If not see\n        && types_match (@0, @1)\n        && (tree_int_cst_min_precision (@4, TYPE_SIGN (TREE_TYPE (@0)))\n \t   <= TYPE_PRECISION (TREE_TYPE (@0)))\n-       && (TYPE_OVERFLOW_WRAPS (TREE_TYPE (@0))\n-\t   || tree_int_cst_sgn (@4) >= 0))\n+       && (wi::bit_and (@4, wi::mask (TYPE_PRECISION (TREE_TYPE (@0)),\n+\t\t\ttrue, TYPE_PRECISION (type))) == 0))\n    (if (TYPE_OVERFLOW_WRAPS (TREE_TYPE (@0)))\n     (with { tree ntype = TREE_TYPE (@0); }\n      (convert (bit_and (op @0 @1) (convert:ntype @4))))"}, {"sha": "fed7d1018d893a0276460c4344f762853690c15c", "filename": "gcc/testsuite/ChangeLog", "status": "modified", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/0a8c1e23903c43a5869abef9bff30337f6122137/gcc%2Ftestsuite%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/0a8c1e23903c43a5869abef9bff30337f6122137/gcc%2Ftestsuite%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2FChangeLog?ref=0a8c1e23903c43a5869abef9bff30337f6122137", "patch": "@@ -1,3 +1,8 @@\n+2015-10-23  Jeff Law  <law@redhat.com>\n+\n+\tPR tree-optimization/67830\n+\t* gcc.dg/pr67830.c: New test.\n+\n 2015-10-23  Jan Hubicka  <hubicka@ucw.cz>\n \n \t* gcc.dg/tree-ssa/operand-equal-2.c: New testcase."}, {"sha": "9bfb0c0531ee41b888d17e0fe01b97a14ef0c33f", "filename": "gcc/testsuite/gcc.dg/pr67830.c", "status": "added", "additions": 22, "deletions": 0, "changes": 22, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/0a8c1e23903c43a5869abef9bff30337f6122137/gcc%2Ftestsuite%2Fgcc.dg%2Fpr67830.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/0a8c1e23903c43a5869abef9bff30337f6122137/gcc%2Ftestsuite%2Fgcc.dg%2Fpr67830.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgcc.dg%2Fpr67830.c?ref=0a8c1e23903c43a5869abef9bff30337f6122137", "patch": "@@ -0,0 +1,22 @@\n+/* PR tree-optimization/67830 */\n+/* { dg-do run } */\n+/* { dg-options \"-O2\" } */\n+\n+int a, b, *g, h;\n+unsigned char c, d;\n+\n+int\n+main ()\n+{\n+  int f, e = -2;\n+  b = e;\n+  g = &b;\n+  h = c = a + 1;\n+  f = d - h;\n+  *g &= f;\n+\n+  if (b != -2)\n+    __builtin_abort ();\n+\n+  return 0;\n+}"}]}