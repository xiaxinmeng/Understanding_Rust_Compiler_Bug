{"sha": "f98359ba9d3775319fb3181009be7d3dafe9ba15", "node_id": "C_kwDOANBUbNoAKGY5ODM1OWJhOWQzNzc1MzE5ZmIzMTgxMDA5YmU3ZDNkYWZlOWJhMTU", "commit": {"author": {"name": "Roger Sayle", "email": "roger@nextmovesoftware.com", "date": "2021-10-19T10:00:10Z"}, "committer": {"name": "Roger Sayle", "email": "roger@nextmovesoftware.com", "date": "2021-10-19T10:00:10Z"}, "message": "PR target/102785: Correct addsub/subadd patterns on bfin.\n\nThis patch resolves PR target/102785 where my recent patch to constant\nfold saturating addition/subtraction exposed a latent bug in the bfin\nbackend.  The patterns used for blackfin's V2HI ssaddsub and sssubadd\ninstructions had the indices/operations swapped.  This was harmless\nuntil we started evaluating these expressions at compile-time, when\nthe mismatch was caught by the testsuite.\n\n2021-10-19  Roger Sayle  <roger@nextmovesoftware.com>\n\ngcc/ChangeLog\n\tPR target/102785\n\t* config/bfin/bfin.md (addsubv2hi3, subaddv2hi3, ssaddsubv2hi3,\n\tsssubaddv2hi3):  Swap the order of operators in vec_concat.", "tree": {"sha": "d80fe0a6da83cd9815c1699c37c53dc6a75034a1", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/d80fe0a6da83cd9815c1699c37c53dc6a75034a1"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/f98359ba9d3775319fb3181009be7d3dafe9ba15", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/f98359ba9d3775319fb3181009be7d3dafe9ba15", "html_url": "https://github.com/Rust-GCC/gccrs/commit/f98359ba9d3775319fb3181009be7d3dafe9ba15", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/f98359ba9d3775319fb3181009be7d3dafe9ba15/comments", "author": {"login": "rogersayle", "id": 13512313, "node_id": "MDQ6VXNlcjEzNTEyMzEz", "avatar_url": "https://avatars.githubusercontent.com/u/13512313?v=4", "gravatar_id": "", "url": "https://api.github.com/users/rogersayle", "html_url": "https://github.com/rogersayle", "followers_url": "https://api.github.com/users/rogersayle/followers", "following_url": "https://api.github.com/users/rogersayle/following{/other_user}", "gists_url": "https://api.github.com/users/rogersayle/gists{/gist_id}", "starred_url": "https://api.github.com/users/rogersayle/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/rogersayle/subscriptions", "organizations_url": "https://api.github.com/users/rogersayle/orgs", "repos_url": "https://api.github.com/users/rogersayle/repos", "events_url": "https://api.github.com/users/rogersayle/events{/privacy}", "received_events_url": "https://api.github.com/users/rogersayle/received_events", "type": "User", "site_admin": false}, "committer": {"login": "rogersayle", "id": 13512313, "node_id": "MDQ6VXNlcjEzNTEyMzEz", "avatar_url": "https://avatars.githubusercontent.com/u/13512313?v=4", "gravatar_id": "", "url": "https://api.github.com/users/rogersayle", "html_url": "https://github.com/rogersayle", "followers_url": "https://api.github.com/users/rogersayle/followers", "following_url": "https://api.github.com/users/rogersayle/following{/other_user}", "gists_url": "https://api.github.com/users/rogersayle/gists{/gist_id}", "starred_url": "https://api.github.com/users/rogersayle/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/rogersayle/subscriptions", "organizations_url": "https://api.github.com/users/rogersayle/orgs", "repos_url": "https://api.github.com/users/rogersayle/repos", "events_url": "https://api.github.com/users/rogersayle/events{/privacy}", "received_events_url": "https://api.github.com/users/rogersayle/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "0910c516a3d72af048af27308349167f25c406c2", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/0910c516a3d72af048af27308349167f25c406c2", "html_url": "https://github.com/Rust-GCC/gccrs/commit/0910c516a3d72af048af27308349167f25c406c2"}], "stats": {"total": 46, "additions": 23, "deletions": 23}, "files": [{"sha": "fd65f4d9e63199c989f4722811a4aac97dacfc09", "filename": "gcc/config/bfin/bfin.md", "status": "modified", "additions": 23, "deletions": 23, "changes": 46, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/f98359ba9d3775319fb3181009be7d3dafe9ba15/gcc%2Fconfig%2Fbfin%2Fbfin.md", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/f98359ba9d3775319fb3181009be7d3dafe9ba15/gcc%2Fconfig%2Fbfin%2Fbfin.md", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fconfig%2Fbfin%2Fbfin.md?ref=f98359ba9d3775319fb3181009be7d3dafe9ba15", "patch": "@@ -3016,19 +3016,6 @@\n   [(set_attr \"type\" \"dsp32\")])\n \n (define_insn \"addsubv2hi3\"\n-  [(set (match_operand:V2HI 0 \"register_operand\" \"=d\")\n-\t(vec_concat:V2HI\n-\t (plus:HI (vec_select:HI (match_operand:V2HI 1 \"register_operand\" \"d\")\n-\t\t\t\t (parallel [(const_int 0)]))\n-\t\t  (vec_select:HI (match_operand:V2HI 2 \"register_operand\" \"d\")\n-\t\t\t\t (parallel [(const_int 0)])))\n-\t (minus:HI (vec_select:HI (match_dup 1) (parallel [(const_int 1)]))\n-\t\t   (vec_select:HI (match_dup 2) (parallel [(const_int 1)])))))]\n-  \"\"\n-  \"%0 = %1 +|- %2%!\"\n-  [(set_attr \"type\" \"dsp32\")])\n-\n-(define_insn \"subaddv2hi3\"\n   [(set (match_operand:V2HI 0 \"register_operand\" \"=d\")\n \t(vec_concat:V2HI\n \t (minus:HI (vec_select:HI (match_operand:V2HI 1 \"register_operand\" \"d\")\n@@ -3038,23 +3025,23 @@\n \t (plus:HI (vec_select:HI (match_dup 1) (parallel [(const_int 1)]))\n \t\t  (vec_select:HI (match_dup 2) (parallel [(const_int 1)])))))]\n   \"\"\n-  \"%0 = %1 -|+ %2%!\"\n+  \"%0 = %1 +|- %2%!\"\n   [(set_attr \"type\" \"dsp32\")])\n \n-(define_insn \"ssaddsubv2hi3\"\n+(define_insn \"subaddv2hi3\"\n   [(set (match_operand:V2HI 0 \"register_operand\" \"=d\")\n \t(vec_concat:V2HI\n-\t (ss_plus:HI (vec_select:HI (match_operand:V2HI 1 \"register_operand\" \"d\")\n-\t\t\t\t    (parallel [(const_int 0)]))\n-\t\t     (vec_select:HI (match_operand:V2HI 2 \"register_operand\" \"d\")\n-\t\t\t\t    (parallel [(const_int 0)])))\n-\t (ss_minus:HI (vec_select:HI (match_dup 1) (parallel [(const_int 1)]))\n-\t\t      (vec_select:HI (match_dup 2) (parallel [(const_int 1)])))))]\n+\t (plus:HI (vec_select:HI (match_operand:V2HI 1 \"register_operand\" \"d\")\n+\t\t\t\t (parallel [(const_int 0)]))\n+\t\t  (vec_select:HI (match_operand:V2HI 2 \"register_operand\" \"d\")\n+\t\t\t\t (parallel [(const_int 0)])))\n+\t (minus:HI (vec_select:HI (match_dup 1) (parallel [(const_int 1)]))\n+\t\t   (vec_select:HI (match_dup 2) (parallel [(const_int 1)])))))]\n   \"\"\n-  \"%0 = %1 +|- %2 (S)%!\"\n+  \"%0 = %1 -|+ %2%!\"\n   [(set_attr \"type\" \"dsp32\")])\n \n-(define_insn \"sssubaddv2hi3\"\n+(define_insn \"ssaddsubv2hi3\"\n   [(set (match_operand:V2HI 0 \"register_operand\" \"=d\")\n \t(vec_concat:V2HI\n \t (ss_minus:HI (vec_select:HI (match_operand:V2HI 1 \"register_operand\" \"d\")\n@@ -3064,6 +3051,19 @@\n \t (ss_plus:HI (vec_select:HI (match_dup 1) (parallel [(const_int 1)]))\n \t\t     (vec_select:HI (match_dup 2) (parallel [(const_int 1)])))))]\n   \"\"\n+  \"%0 = %1 +|- %2 (S)%!\"\n+  [(set_attr \"type\" \"dsp32\")])\n+\n+(define_insn \"sssubaddv2hi3\"\n+  [(set (match_operand:V2HI 0 \"register_operand\" \"=d\")\n+\t(vec_concat:V2HI\n+\t (ss_plus:HI (vec_select:HI (match_operand:V2HI 1 \"register_operand\" \"d\")\n+\t\t\t\t    (parallel [(const_int 0)]))\n+\t\t     (vec_select:HI (match_operand:V2HI 2 \"register_operand\" \"d\")\n+\t\t\t\t    (parallel [(const_int 0)])))\n+\t (ss_minus:HI (vec_select:HI (match_dup 1) (parallel [(const_int 1)]))\n+\t\t      (vec_select:HI (match_dup 2) (parallel [(const_int 1)])))))]\n+  \"\"\n   \"%0 = %1 -|+ %2 (S)%!\"\n   [(set_attr \"type\" \"dsp32\")])\n "}]}