{"sha": "4b13e27087a4c68824c281b2f980a7561dc39407", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6NGIxM2UyNzA4N2E0YzY4ODI0YzI4MWIyZjk4MGE3NTYxZGMzOTQwNw==", "commit": {"author": {"name": "bors[bot]", "email": "26634292+bors[bot]@users.noreply.github.com", "date": "2021-05-31T20:38:09Z"}, "committer": {"name": "GitHub", "email": "noreply@github.com", "date": "2021-05-31T20:38:09Z"}, "message": "Merge #458\n\n458: stdin: Allow compilation from standard input r=philberty a=CohenArthur\n\nFixes #457 \r\n\r\nI'm not really sure how to test it with `dejagnu` or if it is even possible.\r\n\r\nThis PR adds a check for the `-` filename in the `RAIIFile` class. In that case, the inner pointer should simply be `stdin`. We also have to be careful not to `fclose(stdin)` upon deallocation.\r\n\n\nCo-authored-by: CohenArthur <arthur.cohen@epita.fr>", "tree": {"sha": "6e488a2a3e61e34c4e1be217e2cb836adb9eed3b", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/6e488a2a3e61e34c4e1be217e2cb836adb9eed3b"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/4b13e27087a4c68824c281b2f980a7561dc39407", "comment_count": 0, "verification": {"verified": true, "reason": "valid", "signature": "-----BEGIN PGP SIGNATURE-----\n\nwsBcBAABCAAQBQJgtUkxCRBK7hj4Ov3rIwAA6PAIABDLOJKrsP6XJaLpVdjSRFGC\nnKuOAtYJOao6XA1q2KNYtZwtEzeelfouiKKGOX3hiLdaQE2uNZvxTm/7U6UWOk5m\nwGzW41ubudur5ee8cD/eZAWDgu1SypkbT4rFX1LtKl6+08PmHGKb6SnP4mFKkXIz\nQoYrGNJsmswaySFvgKzxTLhYAoYILz5PL1SPg1uGRb8yLTC7reoP0I54NWyehAbP\nvG/tmm/VkKjJWIbo245ZcJRoADmgQAsvBxWSJXbU25QNrlGrLpE4Wgd5uZTKtHY+\neGeERl+PSpJxGPhSm7E8JuxQBI+LlY8O5rURy1jP7bomCJpRLu4T6EzZ2qQzamE=\n=rXP7\n-----END PGP SIGNATURE-----\n", "payload": "tree 6e488a2a3e61e34c4e1be217e2cb836adb9eed3b\nparent 75de60e68b46c555a87822a78d20c7197bddffb5\nparent 5b0433b4beaee7adf59ad6ff79c83f4285a995b0\nauthor bors[bot] <26634292+bors[bot]@users.noreply.github.com> 1622493489 +0000\ncommitter GitHub <noreply@github.com> 1622493489 +0000\n\nMerge #458\n\n458: stdin: Allow compilation from standard input r=philberty a=CohenArthur\n\nFixes #457 \r\n\r\nI'm not really sure how to test it with `dejagnu` or if it is even possible.\r\n\r\nThis PR adds a check for the `-` filename in the `RAIIFile` class. In that case, the inner pointer should simply be `stdin`. We also have to be careful not to `fclose(stdin)` upon deallocation.\r\n\n\nCo-authored-by: CohenArthur <arthur.cohen@epita.fr>\n"}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/4b13e27087a4c68824c281b2f980a7561dc39407", "html_url": "https://github.com/Rust-GCC/gccrs/commit/4b13e27087a4c68824c281b2f980a7561dc39407", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/4b13e27087a4c68824c281b2f980a7561dc39407/comments", "author": {"login": "bors[bot]", "id": 26634292, "node_id": "MDM6Qm90MjY2MzQyOTI=", "avatar_url": "https://avatars.githubusercontent.com/in/1847?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors%5Bbot%5D", "html_url": "https://github.com/apps/bors", "followers_url": "https://api.github.com/users/bors%5Bbot%5D/followers", "following_url": "https://api.github.com/users/bors%5Bbot%5D/following{/other_user}", "gists_url": "https://api.github.com/users/bors%5Bbot%5D/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors%5Bbot%5D/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors%5Bbot%5D/subscriptions", "organizations_url": "https://api.github.com/users/bors%5Bbot%5D/orgs", "repos_url": "https://api.github.com/users/bors%5Bbot%5D/repos", "events_url": "https://api.github.com/users/bors%5Bbot%5D/events{/privacy}", "received_events_url": "https://api.github.com/users/bors%5Bbot%5D/received_events", "type": "Bot", "site_admin": false}, "committer": {"login": "web-flow", "id": 19864447, "node_id": "MDQ6VXNlcjE5ODY0NDQ3", "avatar_url": "https://avatars.githubusercontent.com/u/19864447?v=4", "gravatar_id": "", "url": "https://api.github.com/users/web-flow", "html_url": "https://github.com/web-flow", "followers_url": "https://api.github.com/users/web-flow/followers", "following_url": "https://api.github.com/users/web-flow/following{/other_user}", "gists_url": "https://api.github.com/users/web-flow/gists{/gist_id}", "starred_url": "https://api.github.com/users/web-flow/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/web-flow/subscriptions", "organizations_url": "https://api.github.com/users/web-flow/orgs", "repos_url": "https://api.github.com/users/web-flow/repos", "events_url": "https://api.github.com/users/web-flow/events{/privacy}", "received_events_url": "https://api.github.com/users/web-flow/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "75de60e68b46c555a87822a78d20c7197bddffb5", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/75de60e68b46c555a87822a78d20c7197bddffb5", "html_url": "https://github.com/Rust-GCC/gccrs/commit/75de60e68b46c555a87822a78d20c7197bddffb5"}, {"sha": "5b0433b4beaee7adf59ad6ff79c83f4285a995b0", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/5b0433b4beaee7adf59ad6ff79c83f4285a995b0", "html_url": "https://github.com/Rust-GCC/gccrs/commit/5b0433b4beaee7adf59ad6ff79c83f4285a995b0"}], "stats": {"total": 11, "additions": 9, "deletions": 2}, "files": [{"sha": "8a9640eaf7b25d4250c554c1b82331c64a1f0b4a", "filename": "gcc/rust/lex/rust-lex.h", "status": "modified", "additions": 9, "deletions": 2, "changes": 11, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/4b13e27087a4c68824c281b2f980a7561dc39407/gcc%2Frust%2Flex%2Frust-lex.h", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/4b13e27087a4c68824c281b2f980a7561dc39407/gcc%2Frust%2Flex%2Frust-lex.h", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Frust%2Flex%2Frust-lex.h?ref=4b13e27087a4c68824c281b2f980a7561dc39407", "patch": "@@ -16,7 +16,14 @@ struct RAIIFile\n   FILE *file;\n \n public:\n-  RAIIFile (const char *filename) : file (fopen (filename, \"r\")) {}\n+  RAIIFile (const char *filename)\n+  {\n+    if (strncmp (filename, \"-\", 1) == 0)\n+      file = stdin;\n+    else\n+      file = fopen (filename, \"r\");\n+  }\n+\n   RAIIFile (const RAIIFile &other) = delete;\n   RAIIFile &operator= (const RAIIFile &other) = delete;\n \n@@ -32,7 +39,7 @@ struct RAIIFile\n \n   ~RAIIFile ()\n   {\n-    if (file != nullptr)\n+    if (file != nullptr && file != stdin)\n       fclose (file);\n   }\n "}]}