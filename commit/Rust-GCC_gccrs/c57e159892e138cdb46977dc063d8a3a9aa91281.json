{"sha": "c57e159892e138cdb46977dc063d8a3a9aa91281", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6YzU3ZTE1OTg5MmUxMzhjZGI0Njk3N2RjMDYzZDhhM2E5YWE5MTI4MQ==", "commit": {"author": {"name": "Jan Hubicka", "email": "jh@suse.cz", "date": "2003-09-07T11:15:46Z"}, "committer": {"name": "Jan Hubicka", "email": "hubicka@gcc.gnu.org", "date": "2003-09-07T11:15:46Z"}, "message": "decl2.c (maybe_emit_vtables, [...]): Avoid re-emitting variables in unit-at-a-time mode.\n\n\t* decl2.c (maybe_emit_vtables, write_out_vars, finish_file):\n\tAvoid re-emitting variables in unit-at-a-time mode.\n\nFrom-SVN: r71167", "tree": {"sha": "fd15c7c5430310ec2b68a25e39b147312fd57c7b", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/fd15c7c5430310ec2b68a25e39b147312fd57c7b"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/c57e159892e138cdb46977dc063d8a3a9aa91281", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/c57e159892e138cdb46977dc063d8a3a9aa91281", "html_url": "https://github.com/Rust-GCC/gccrs/commit/c57e159892e138cdb46977dc063d8a3a9aa91281", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/c57e159892e138cdb46977dc063d8a3a9aa91281/comments", "author": null, "committer": null, "parents": [{"sha": "dba65e798f980af13231c931f418d6e35d61eedd", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/dba65e798f980af13231c931f418d6e35d61eedd", "html_url": "https://github.com/Rust-GCC/gccrs/commit/dba65e798f980af13231c931f418d6e35d61eedd"}], "stats": {"total": 17, "additions": 14, "deletions": 3}, "files": [{"sha": "dccc52680b2d31bbcb6622c8dc197da5e3c959c1", "filename": "gcc/cp/ChangeLog", "status": "modified", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/c57e159892e138cdb46977dc063d8a3a9aa91281/gcc%2Fcp%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/c57e159892e138cdb46977dc063d8a3a9aa91281/gcc%2Fcp%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fcp%2FChangeLog?ref=c57e159892e138cdb46977dc063d8a3a9aa91281", "patch": "@@ -1,3 +1,8 @@\n+Sun Sep  7 13:15:14 CEST 2003  Jan Hubicka  <jh@suse.cz>\n+\n+\t* decl2.c (maybe_emit_vtables, write_out_vars, finish_file):\n+\tAvoid re-emitting variables in unit-at-a-time mode.\n+\n 2003-09-06  Mark Mitchell  <mark@codesourcery.com>\n \n \tPR c++/11687"}, {"sha": "e1fe1209c97993a3219177e61af359250ae0109e", "filename": "gcc/cp/decl2.c", "status": "modified", "additions": 9, "deletions": 3, "changes": 12, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/c57e159892e138cdb46977dc063d8a3a9aa91281/gcc%2Fcp%2Fdecl2.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/c57e159892e138cdb46977dc063d8a3a9aa91281/gcc%2Fcp%2Fdecl2.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fcp%2Fdecl2.c?ref=c57e159892e138cdb46977dc063d8a3a9aa91281", "patch": "@@ -1634,7 +1634,9 @@ maybe_emit_vtables (tree ctype)\n   /* If the vtables for this class have already been emitted there is\n      nothing more to do.  */\n   primary_vtbl = CLASSTYPE_VTABLES (ctype);\n-  if (TREE_ASM_WRITTEN (primary_vtbl))\n+  if (TREE_ASM_WRITTEN (primary_vtbl)\n+      || (flag_unit_at_a_time\n+\t  && cgraph_varpool_node (primary_vtbl)->finalized))\n     return false;\n   /* Ignore dummy vtables made by get_vtable_decl.  */\n   if (TREE_TYPE (primary_vtbl) == void_type_node)\n@@ -2452,7 +2454,9 @@ write_out_vars (tree vars)\n   tree v;\n \n   for (v = vars; v; v = TREE_CHAIN (v))\n-    if (! TREE_ASM_WRITTEN (TREE_VALUE (v)))\n+    if (! TREE_ASM_WRITTEN (TREE_VALUE (v))\n+        && (!flag_unit_at_a_time\n+\t    || !cgraph_varpool_node (TREE_VALUE (v))->finalized))\n       rest_of_decl_compilation (TREE_VALUE (v), 0, 1, 1);\n }\n \n@@ -2875,7 +2879,9 @@ finish_file ()\n       for (i = 0; i < pending_statics_used; ++i) \n \t{\n \t  tree decl = VARRAY_TREE (pending_statics, i);\n-\t  if (TREE_ASM_WRITTEN (decl))\n+\t  if (TREE_ASM_WRITTEN (decl)\n+\t      || (flag_unit_at_a_time\n+\t\t  && cgraph_varpool_node (decl)->finalized))\n \t    continue;\n \t  import_export_decl (decl);\n \t  if (DECL_NOT_REALLY_EXTERN (decl) && ! DECL_IN_AGGR_P (decl))"}]}