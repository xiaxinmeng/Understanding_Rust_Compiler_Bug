{"sha": "2731cf24d22fbc55453b74a5498f72ce5c41a52b", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6MjczMWNmMjRkMjJmYmM1NTQ1M2I3NGE1NDk4ZjcyY2U1YzQxYTUyYg==", "commit": {"author": {"name": "Frank Ch. Eigler", "email": "fche@redhat.com", "date": "2004-09-16T20:42:00Z"}, "committer": {"name": "Frank Ch. Eigler", "email": "fche@gcc.gnu.org", "date": "2004-09-16T20:42:00Z"}, "message": "profile.c (branch_prob): Restore support for USE_MAPPED_LOCATION.\n\n2004-09-16  Frank Ch. Eigler  <fche@redhat.com>\n\n\t* profile.c (branch_prob): Restore support for USE_MAPPED_LOCATION.\n\nFrom-SVN: r87613", "tree": {"sha": "c9df05a359ae2a05d8d775982603cc2fdb3dbeb6", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/c9df05a359ae2a05d8d775982603cc2fdb3dbeb6"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/2731cf24d22fbc55453b74a5498f72ce5c41a52b", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/2731cf24d22fbc55453b74a5498f72ce5c41a52b", "html_url": "https://github.com/Rust-GCC/gccrs/commit/2731cf24d22fbc55453b74a5498f72ce5c41a52b", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/2731cf24d22fbc55453b74a5498f72ce5c41a52b/comments", "author": {"login": "fche", "id": 588885, "node_id": "MDQ6VXNlcjU4ODg4NQ==", "avatar_url": "https://avatars.githubusercontent.com/u/588885?v=4", "gravatar_id": "", "url": "https://api.github.com/users/fche", "html_url": "https://github.com/fche", "followers_url": "https://api.github.com/users/fche/followers", "following_url": "https://api.github.com/users/fche/following{/other_user}", "gists_url": "https://api.github.com/users/fche/gists{/gist_id}", "starred_url": "https://api.github.com/users/fche/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/fche/subscriptions", "organizations_url": "https://api.github.com/users/fche/orgs", "repos_url": "https://api.github.com/users/fche/repos", "events_url": "https://api.github.com/users/fche/events{/privacy}", "received_events_url": "https://api.github.com/users/fche/received_events", "type": "User", "site_admin": false}, "committer": null, "parents": [{"sha": "8304ad70b7cc364c1ac15601c88c569af8527929", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/8304ad70b7cc364c1ac15601c88c569af8527929", "html_url": "https://github.com/Rust-GCC/gccrs/commit/8304ad70b7cc364c1ac15601c88c569af8527929"}], "stats": {"total": 40, "additions": 25, "deletions": 15}, "files": [{"sha": "1c3e9dd5fbe1cc613cf3b99b8eb6e27f2ed74322", "filename": "gcc/ChangeLog", "status": "modified", "additions": 4, "deletions": 0, "changes": 4, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/2731cf24d22fbc55453b74a5498f72ce5c41a52b/gcc%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/2731cf24d22fbc55453b74a5498f72ce5c41a52b/gcc%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2FChangeLog?ref=2731cf24d22fbc55453b74a5498f72ce5c41a52b", "patch": "@@ -1,3 +1,7 @@\n+2004-09-16  Frank Ch. Eigler  <fche@redhat.com>\n+\n+\t* profile.c (branch_prob): Restore support for USE_MAPPED_LOCATION.\n+\n 2004-09-16 Jeff Law  <law@redhat.com>\n \n \t* tree-into-ssa.c (block_defs_stack): New toplevel varray."}, {"sha": "77c5d03b15ac03780ecafbadc1a3b0b7aef52a4c", "filename": "gcc/profile.c", "status": "modified", "additions": 21, "deletions": 15, "changes": 36, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/2731cf24d22fbc55453b74a5498f72ce5c41a52b/gcc%2Fprofile.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/2731cf24d22fbc55453b74a5498f72ce5c41a52b/gcc%2Fprofile.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fprofile.c?ref=2731cf24d22fbc55453b74a5498f72ce5c41a52b", "patch": "@@ -1001,7 +1001,6 @@ branch_prob (void)\n       else\n \t{\n \t  gcov_position_t offset;\n-\t  location_t *curr_location = NULL;\n \n \t  FOR_EACH_BB (bb)\n \t    {\n@@ -1011,31 +1010,38 @@ branch_prob (void)\n \n \t      if (bb == ENTRY_BLOCK_PTR->next_bb)\n \t\t{\n-\t\t  curr_location = &DECL_SOURCE_LOCATION (current_function_decl);\n-\t\t  output_location (curr_location->file, curr_location->line,\n+\t\t  expanded_location curr_location = \n+\t\t    expand_location (DECL_SOURCE_LOCATION\n+\t\t\t\t     (current_function_decl));\n+\t\t  output_location (curr_location.file, curr_location.line,\n \t\t\t\t   &offset, bb);\n \t\t}\n \n \t      for (bsi = bsi_start (bb); !bsi_end_p (bsi); bsi_next (&bsi))\n \t\t{\n \t\t  tree stmt = bsi_stmt (bsi);\n-#ifdef USE_MAPPED_LOCATION\n-\t\t  curr_location = EXPR_LOCATION (stmt);\n-#else\n-\t\t  curr_location = EXPR_LOCUS (stmt);\n-#endif\n-\t\t  if (curr_location)\n-\t\t    output_location (curr_location->file, curr_location->line,\n+\t\t  if (EXPR_HAS_LOCATION (stmt))\n+\t\t    output_location (EXPR_FILENAME (stmt), \n+\t\t\t\t     EXPR_LINENO (stmt),\n \t\t\t\t     &offset, bb);\n \t\t}\n \n \t      /* Notice GOTO expressions we eliminated while constructing the\n-\t         CFG.  */\n+\t\t CFG.  */\n \t      if (bb->succ && !bb->succ->succ_next && bb->succ->goto_locus)\n-\t        {\n-\t\t  curr_location = bb->succ->goto_locus;\n-\t          output_location (curr_location->file, curr_location->line, &offset, bb);\n-\t        }\n+\t\t{\n+\t\t  /* ??? source_locus type is marked deprecated in input.h.  */\n+\t\t  source_locus curr_location = bb->succ->goto_locus;\n+\t\t  /* ??? The FILE/LINE API is inconsistent for these cases.  */\n+#ifdef USE_MAPPED_LOCATION \n+\t\t  output_location (LOCATION_FILE (curr_location),\n+\t\t\t\t   LOCATION_LINE (curr_location),\n+\t\t\t\t   &offset, bb);\n+#else\n+\t\t  output_location (curr_location->file, curr_location->line,\n+\t\t\t\t   &offset, bb);\n+#endif\n+\t\t}\n \n \t      if (offset)\n \t\t{"}]}