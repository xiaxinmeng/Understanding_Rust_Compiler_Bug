{"sha": "901f29c8c9a5775af65f883701ed10a19084d818", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6OTAxZjI5YzhjOWE1Nzc1YWY2NWY4ODM3MDFlZDEwYTE5MDg0ZDgxOA==", "commit": {"author": {"name": "Rainer Orth", "email": "ro@CeBiTec.Uni-Bielefeld.DE", "date": "2016-04-26T10:10:33Z"}, "committer": {"name": "Rainer Orth", "email": "ro@gcc.gnu.org", "date": "2016-04-26T10:10:33Z"}, "message": "Support .largecomm with Solaris as (PR target/61821)\n\n\tPR target/61821\n\t* config/i386/i386.c (LARGECOMM_SECTION_ASM_OP): Define default.\n\t(x86_elf_aligned_common): Rename to ...\n\t(x86_elf_aligned_decl_common): ... this.\n\tAdd decl arg.  Switch to .lbss for largecomm object.  Use\n\tLARGECOMM_SECTION_ASM_OP.\n\t* config/i386/i386-protos.h (x86_elf_aligned_common): Reflect\n\trenaming.\n\t* config/i386/x86-64.h (ASM_OUTPUT_ALIGNED_COMMON): Rename to ...\n\t(ASM_OUTPUT_ALIGNED_DECL_COMMON): ... this.\n\tPass new decl arg.\n\t* config/i386/sol2.h (ASM_OUTPUT_ALIGNED_COMMON): Likewise.\n\t[!USE_GAS] (LARGECOMM_SECTION_ASM_OP): Define.\n\nFrom-SVN: r235435", "tree": {"sha": "bcdb13c91a5e6f0e0dd4519b74e8ac2d48f8c76b", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/bcdb13c91a5e6f0e0dd4519b74e8ac2d48f8c76b"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/901f29c8c9a5775af65f883701ed10a19084d818", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/901f29c8c9a5775af65f883701ed10a19084d818", "html_url": "https://github.com/Rust-GCC/gccrs/commit/901f29c8c9a5775af65f883701ed10a19084d818", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/901f29c8c9a5775af65f883701ed10a19084d818/comments", "author": {"login": "rorth", "id": 3930951, "node_id": "MDQ6VXNlcjM5MzA5NTE=", "avatar_url": "https://avatars.githubusercontent.com/u/3930951?v=4", "gravatar_id": "", "url": "https://api.github.com/users/rorth", "html_url": "https://github.com/rorth", "followers_url": "https://api.github.com/users/rorth/followers", "following_url": "https://api.github.com/users/rorth/following{/other_user}", "gists_url": "https://api.github.com/users/rorth/gists{/gist_id}", "starred_url": "https://api.github.com/users/rorth/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/rorth/subscriptions", "organizations_url": "https://api.github.com/users/rorth/orgs", "repos_url": "https://api.github.com/users/rorth/repos", "events_url": "https://api.github.com/users/rorth/events{/privacy}", "received_events_url": "https://api.github.com/users/rorth/received_events", "type": "User", "site_admin": false}, "committer": null, "parents": [{"sha": "b2eb4ed5aa837132cb46375a5facab6d0e7453c6", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/b2eb4ed5aa837132cb46375a5facab6d0e7453c6", "html_url": "https://github.com/Rust-GCC/gccrs/commit/b2eb4ed5aa837132cb46375a5facab6d0e7453c6"}], "stats": {"total": 50, "additions": 39, "deletions": 11}, "files": [{"sha": "1907d2b42e66c06661c203a5449cb677bb89be29", "filename": "gcc/ChangeLog", "status": "modified", "additions": 16, "deletions": 0, "changes": 16, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/901f29c8c9a5775af65f883701ed10a19084d818/gcc%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/901f29c8c9a5775af65f883701ed10a19084d818/gcc%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2FChangeLog?ref=901f29c8c9a5775af65f883701ed10a19084d818", "patch": "@@ -1,3 +1,19 @@\n+2016-04-26  Rainer Orth  <ro@CeBiTec.Uni-Bielefeld.DE>\n+\n+\tPR target/61821\n+\t* config/i386/i386.c (LARGECOMM_SECTION_ASM_OP): Define default.\n+\t(x86_elf_aligned_common): Rename to ...\n+\t(x86_elf_aligned_decl_common): ... this.\n+\tAdd decl arg.  Switch to .lbss for largecomm object.  Use\n+\tLARGECOMM_SECTION_ASM_OP.\n+\t* config/i386/i386-protos.h (x86_elf_aligned_common): Reflect\n+\trenaming.\n+\t* config/i386/x86-64.h (ASM_OUTPUT_ALIGNED_COMMON): Rename to ...\n+\t(ASM_OUTPUT_ALIGNED_DECL_COMMON): ... this.\n+\tPass new decl arg.\n+\t* config/i386/sol2.h (ASM_OUTPUT_ALIGNED_COMMON): Likewise.\n+\t[!USE_GAS] (LARGECOMM_SECTION_ASM_OP): Define.\n+\n 2016-04-26  Rainer Orth  <ro@CeBiTec.Uni-Bielefeld.DE>\n \n \tPR target/59407"}, {"sha": "4145ed566582e439d02b523f2df7c0153e2930d0", "filename": "gcc/config/i386/i386-protos.h", "status": "modified", "additions": 2, "deletions": 2, "changes": 4, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/901f29c8c9a5775af65f883701ed10a19084d818/gcc%2Fconfig%2Fi386%2Fi386-protos.h", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/901f29c8c9a5775af65f883701ed10a19084d818/gcc%2Fconfig%2Fi386%2Fi386-protos.h", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fconfig%2Fi386%2Fi386-protos.h?ref=901f29c8c9a5775af65f883701ed10a19084d818", "patch": "@@ -296,8 +296,8 @@ extern int ix86_decompose_address (rtx, struct ix86_address *);\n extern int memory_address_length (rtx, bool);\n extern void x86_output_aligned_bss (FILE *, tree, const char *,\n \t\t\t\t    unsigned HOST_WIDE_INT, int);\n-extern void x86_elf_aligned_common (FILE *, const char *,\n-\t\t\t\t    unsigned HOST_WIDE_INT, int);\n+extern void x86_elf_aligned_decl_common (FILE *, tree, const char *,\n+\t\t\t\t\t unsigned HOST_WIDE_INT, int);\n \n #ifdef RTX_CODE\n extern void ix86_fp_comparison_codes (enum rtx_code code, enum rtx_code *,"}, {"sha": "d8278fbc600c6b158dd727ee5b67768d6f0d4841", "filename": "gcc/config/i386/i386.c", "status": "modified", "additions": 11, "deletions": 3, "changes": 14, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/901f29c8c9a5775af65f883701ed10a19084d818/gcc%2Fconfig%2Fi386%2Fi386.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/901f29c8c9a5775af65f883701ed10a19084d818/gcc%2Fconfig%2Fi386%2Fi386.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fconfig%2Fi386%2Fi386.c?ref=901f29c8c9a5775af65f883701ed10a19084d818", "patch": "@@ -6648,19 +6648,27 @@ x86_64_elf_unique_section (tree decl, int reloc)\n }\n \n #ifdef COMMON_ASM_OP\n+\n+#ifndef LARGECOMM_SECTION_ASM_OP\n+#define LARGECOMM_SECTION_ASM_OP \"\\t.largecomm\\t\"\n+#endif\n+\n /* This says how to output assembler code to declare an\n    uninitialized external linkage data object.\n \n-   For medium model x86-64 we need to use .largecomm opcode for\n+   For medium model x86-64 we need to use LARGECOMM_SECTION_ASM_OP opcode for\n    large objects.  */\n void\n-x86_elf_aligned_common (FILE *file,\n+x86_elf_aligned_decl_common (FILE *file, tree decl,\n \t\t\tconst char *name, unsigned HOST_WIDE_INT size,\n \t\t\tint align)\n {\n   if ((ix86_cmodel == CM_MEDIUM || ix86_cmodel == CM_MEDIUM_PIC)\n       && size > (unsigned int)ix86_section_threshold)\n-    fputs (\"\\t.largecomm\\t\", file);\n+    {\n+      switch_to_section (get_named_section (decl, \".lbss\", 0));\n+      fputs (LARGECOMM_SECTION_ASM_OP, file);\n+    }\n   else\n     fputs (COMMON_ASM_OP, file);\n   assemble_name (file, name);"}, {"sha": "df23b1298b88547f004d387b526abba7cb72cdc1", "filename": "gcc/config/i386/sol2.h", "status": "modified", "additions": 7, "deletions": 3, "changes": 10, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/901f29c8c9a5775af65f883701ed10a19084d818/gcc%2Fconfig%2Fi386%2Fsol2.h", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/901f29c8c9a5775af65f883701ed10a19084d818/gcc%2Fconfig%2Fi386%2Fsol2.h", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fconfig%2Fi386%2Fsol2.h?ref=901f29c8c9a5775af65f883701ed10a19084d818", "patch": "@@ -184,15 +184,15 @@ along with GCC; see the file COPYING3.  If not see\n \n /* As in sparc/sol2.h, override the default from i386/x86-64.h to work\n    around Sun as TLS bug.  */\n-#undef  ASM_OUTPUT_ALIGNED_COMMON\n-#define ASM_OUTPUT_ALIGNED_COMMON(FILE, NAME, SIZE, ALIGN)\t\t\\\n+#undef  ASM_OUTPUT_ALIGNED_DECL_COMMON\n+#define ASM_OUTPUT_ALIGNED_DECL_COMMON(FILE, DECL, NAME, SIZE, ALIGN)\t\\\n   do\t\t\t\t\t\t\t\t\t\\\n     {\t\t\t\t\t\t\t\t\t\\\n       if (TARGET_SUN_TLS\t\t\t\t\t\t\\\n \t  && in_section\t\t\t\t\t\t\t\\\n \t  && ((in_section->common.flags & SECTION_TLS) == SECTION_TLS))\t\\\n \tswitch_to_section (bss_section);\t\t\t\t\\\n-      x86_elf_aligned_common (FILE, NAME, SIZE, ALIGN);\t\t\t\\\n+      x86_elf_aligned_decl_common (FILE, DECL, NAME, SIZE, ALIGN);\t\\\n     }\t\t\t\t\t\t\t\t\t\\\n   while  (0)\n \n@@ -230,6 +230,10 @@ along with GCC; see the file COPYING3.  If not see\n #define DTORS_SECTION_ASM_OP\t\"\\t.section\\t.dtors, \\\"aw\\\"\"\n #endif\n \n+#ifndef USE_GAS\n+#define LARGECOMM_SECTION_ASM_OP \"\\t.lbcomm\\t\"\n+#endif\n+\n #define USE_IX86_FRAME_POINTER 1\n #define USE_X86_64_FRAME_POINTER 1\n "}, {"sha": "b0bf83589d7b4a5ae34d7c5e4549c7876e81025f", "filename": "gcc/config/i386/x86-64.h", "status": "modified", "additions": 3, "deletions": 3, "changes": 6, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/901f29c8c9a5775af65f883701ed10a19084d818/gcc%2Fconfig%2Fi386%2Fx86-64.h", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/901f29c8c9a5775af65f883701ed10a19084d818/gcc%2Fconfig%2Fi386%2Fx86-64.h", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fconfig%2Fi386%2Fx86-64.h?ref=901f29c8c9a5775af65f883701ed10a19084d818", "patch": "@@ -55,9 +55,9 @@ see the files COPYING3 and COPYING.RUNTIME respectively.  If not, see\n #define ASM_OUTPUT_ALIGNED_BSS(FILE, DECL, NAME, SIZE, ALIGN) \\\n   x86_output_aligned_bss (FILE, DECL, NAME, SIZE, ALIGN)\n \n-#undef  ASM_OUTPUT_ALIGNED_COMMON\n-#define ASM_OUTPUT_ALIGNED_COMMON(FILE, NAME, SIZE, ALIGN)\t\t\\\n-  x86_elf_aligned_common (FILE, NAME, SIZE, ALIGN);\n+#undef  ASM_OUTPUT_ALIGNED_DECL_COMMON\n+#define ASM_OUTPUT_ALIGNED_DECL_COMMON(FILE, DECL, NAME, SIZE, ALIGN)\t\t\\\n+  x86_elf_aligned_decl_common (FILE, DECL, NAME, SIZE, ALIGN);\n \n /* This is used to align code labels according to Intel recommendations.  */\n "}]}