{"sha": "7590016ba956de8d036138e3b4dd2435ce625ba2", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6NzU5MDAxNmJhOTU2ZGU4ZDAzNjEzOGUzYjRkZDI0MzVjZTYyNWJhMg==", "commit": {"author": {"name": "Bill Schmidt", "email": "wschmidt@linux.ibm.com", "date": "2021-07-27T03:07:19Z"}, "committer": {"name": "Bill Schmidt", "email": "wschmidt@linux.ibm.com", "date": "2021-07-27T22:55:33Z"}, "message": "rs6000: Write static initializations for overload tables\n\n2021-06-07  Bill Schmidt  <wschmidt@linux.ibm.com>\n\ngcc/\n\t* config/rs6000/rs6000-gen-builtins.c (write_ovld_static_init): New\n\tfunction.\n\t(write_init_file): Call write_ovld_static_init.", "tree": {"sha": "ff84a36002100110dce1f2e0d7d728cf5f72fd75", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/ff84a36002100110dce1f2e0d7d728cf5f72fd75"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/7590016ba956de8d036138e3b4dd2435ce625ba2", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/7590016ba956de8d036138e3b4dd2435ce625ba2", "html_url": "https://github.com/Rust-GCC/gccrs/commit/7590016ba956de8d036138e3b4dd2435ce625ba2", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/7590016ba956de8d036138e3b4dd2435ce625ba2/comments", "author": null, "committer": null, "parents": [{"sha": "bb4d8febb3660965cc4617f2a91be0014236faf7", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/bb4d8febb3660965cc4617f2a91be0014236faf7", "html_url": "https://github.com/Rust-GCC/gccrs/commit/bb4d8febb3660965cc4617f2a91be0014236faf7"}], "stats": {"total": 53, "additions": 53, "deletions": 0}, "files": [{"sha": "e5d3b71b622bbaec907d141e4f7db6836263dade", "filename": "gcc/config/rs6000/rs6000-gen-builtins.c", "status": "modified", "additions": 53, "deletions": 0, "changes": 53, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/7590016ba956de8d036138e3b4dd2435ce625ba2/gcc%2Fconfig%2Frs6000%2Frs6000-gen-builtins.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/7590016ba956de8d036138e3b4dd2435ce625ba2/gcc%2Fconfig%2Frs6000%2Frs6000-gen-builtins.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fconfig%2Frs6000%2Frs6000-gen-builtins.c?ref=7590016ba956de8d036138e3b4dd2435ce625ba2", "patch": "@@ -2519,6 +2519,58 @@ write_bif_static_init (void)\n   fprintf (init_file, \"  };\\n\\n\");\n }\n \n+/* Write the decls and initializers for rs6000_overload_info[] and\n+   rs6000_instance_info[].  */\n+static void\n+write_ovld_static_init (void)\n+{\n+  fprintf (init_file,\n+\t   \"ovldrecord rs6000_overload_info[RS6000_OVLD_MAX \"\n+\t   \"- RS6000_OVLD_NONE] =\\n\");\n+  fprintf (init_file, \"  {\\n\");\n+  fprintf (init_file, \"    { /* RS6000_OVLD_NONE: */\\n\");\n+  fprintf (init_file, \"      \\\"\\\", NULL\\n\");\n+  fprintf (init_file, \"    },\\n\");\n+  for (int i = 0; i <= curr_ovld_stanza; i++)\n+    {\n+      fprintf (init_file, \"    { /* RS6000_OVLD_%s: */\\n\",\n+\t       ovld_stanzas[i].stanza_id);\n+      fprintf (init_file, \"      /* ovld_name */\\t\\\"%s\\\",\\n\",\n+\t       ovld_stanzas[i].intern_name);\n+      /* First-instance must currently be instantiated at run time.  */\n+      fprintf (init_file, \"      /* first_instance */\\tNULL\\n\");\n+      fprintf (init_file, \"    },\\n\");\n+    }\n+  fprintf (init_file, \"  };\\n\\n\");\n+\n+  fprintf (init_file, \"ovlddata rs6000_instance_info[RS6000_INST_MAX] =\\n\");\n+  fprintf (init_file, \"  {\\n\");\n+  fprintf (init_file, \"    { /* RS6000_INST_NONE: */\\n\");\n+  fprintf (init_file, \"      \\\"\\\", RS6000_BIF_NONE, NULL_TREE, NULL\\n\");\n+  fprintf (init_file, \"    },\\n\");\n+  for (int i = 0; i <= curr_ovld; i++)\n+    {\n+      fprintf (init_file, \"    { /* RS6000_INST_%s: */\\n\",\n+\t       ovlds[i].ovld_id_name);\n+      fprintf (init_file, \"      /* bifname */\\t\\\"%s\\\",\\n\",\n+\t       ovlds[i].proto.bifname);\n+      fprintf (init_file, \"      /* bifid */\\tRS6000_BIF_%s,\\n\",\n+\t       ovlds[i].bif_id_name);\n+      /* Type must be instantiated at run time.  */\n+      fprintf (init_file, \"      /* fntype */\\t0,\\n\");\n+      fprintf (init_file, \"      /* next */\\t\");\n+      if (i < curr_ovld\n+\t  && !strcmp (ovlds[i+1].proto.bifname, ovlds[i].proto.bifname))\n+\tfprintf (init_file,\n+\t\t \"&rs6000_instance_info[RS6000_INST_%s]\\n\",\n+\t\t ovlds[i+1].ovld_id_name);\n+      else\n+\tfprintf (init_file, \"NULL\\n\");\n+      fprintf (init_file, \"    },\\n\");\n+    }\n+  fprintf (init_file, \"  };\\n\\n\");\n+}\n+\n /* Write code to initialize the built-in function table.  */\n static void\n write_init_bif_table (void)\n@@ -2709,6 +2761,7 @@ write_init_file (void)\n   fprintf (init_file, \"tree rs6000_builtin_decls_x[RS6000_OVLD_MAX];\\n\\n\");\n \n   write_bif_static_init ();\n+  write_ovld_static_init ();\n \n   rbt_inorder_callback (&fntype_rbt, fntype_rbt.rbt_root, write_fntype);\n   fprintf (init_file, \"\\n\");"}]}