{"sha": "fd661a34e53dd2b20ae5309b78960c171ff9a720", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6ZmQ2NjFhMzRlNTNkZDJiMjBhZTUzMDliNzg5NjBjMTcxZmY5YTcyMA==", "commit": {"author": {"name": "Uros Bizjak", "email": "ubizjak@gmail.com", "date": "2019-05-06T14:58:57Z"}, "committer": {"name": "Uros Bizjak", "email": "uros@gcc.gnu.org", "date": "2019-05-06T14:58:57Z"}, "message": "re PR target/89221 (--enable-frame-pointer does not work as intended)\n\n\tPR target/89221\n\t* config.gcc (i[34567]86-*-*, x86_64-*-*): Move tests for enable_cld\n\tand enable_frame_pointer ...\n\t* configure.ac: ... here.  Update help strings for\n\t--enable-frame-pointer.\n\t* configure: Regenerate.\n\t* config/i386/i386-options.c (ix86_option_override_internal): Remove\n\tUSE_X86_64_FRAME_POINTER define, use USE_IX86_FRAME_POINTER instead.\n\t* config/i386/sol2.h (USE_IX86_FRAME_POINTER): Remove.\n\t(USE_X86_64_FRAME_POINTER): Ditto.\n\nFrom-SVN: r270914", "tree": {"sha": "5187e09f04b7c4287eccac337fd795fa56ccb05e", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/5187e09f04b7c4287eccac337fd795fa56ccb05e"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/fd661a34e53dd2b20ae5309b78960c171ff9a720", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/fd661a34e53dd2b20ae5309b78960c171ff9a720", "html_url": "https://github.com/Rust-GCC/gccrs/commit/fd661a34e53dd2b20ae5309b78960c171ff9a720", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/fd661a34e53dd2b20ae5309b78960c171ff9a720/comments", "author": {"login": "ubizjak", "id": 55479990, "node_id": "MDQ6VXNlcjU1NDc5OTkw", "avatar_url": "https://avatars.githubusercontent.com/u/55479990?v=4", "gravatar_id": "", "url": "https://api.github.com/users/ubizjak", "html_url": "https://github.com/ubizjak", "followers_url": "https://api.github.com/users/ubizjak/followers", "following_url": "https://api.github.com/users/ubizjak/following{/other_user}", "gists_url": "https://api.github.com/users/ubizjak/gists{/gist_id}", "starred_url": "https://api.github.com/users/ubizjak/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/ubizjak/subscriptions", "organizations_url": "https://api.github.com/users/ubizjak/orgs", "repos_url": "https://api.github.com/users/ubizjak/repos", "events_url": "https://api.github.com/users/ubizjak/events{/privacy}", "received_events_url": "https://api.github.com/users/ubizjak/received_events", "type": "User", "site_admin": false}, "committer": null, "parents": [{"sha": "7c0b7150ed94c09d2d9cb1b149f6e2e8baa85864", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/7c0b7150ed94c09d2d9cb1b149f6e2e8baa85864", "html_url": "https://github.com/Rust-GCC/gccrs/commit/7c0b7150ed94c09d2d9cb1b149f6e2e8baa85864"}], "stats": {"total": 71, "additions": 42, "deletions": 29}, "files": [{"sha": "493e843417d217f0714f87b5815ce6caa2806489", "filename": "gcc/ChangeLog", "status": "modified", "additions": 13, "deletions": 0, "changes": 13, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/fd661a34e53dd2b20ae5309b78960c171ff9a720/gcc%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/fd661a34e53dd2b20ae5309b78960c171ff9a720/gcc%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2FChangeLog?ref=fd661a34e53dd2b20ae5309b78960c171ff9a720", "patch": "@@ -1,3 +1,16 @@\n+2019-05-06  Uro\u0161 Bizjak  <ubizjak@gmail.com>\n+\n+\tPR target/89221\n+\t* config.gcc (i[34567]86-*-*, x86_64-*-*): Move tests for enable_cld\n+\tand enable_frame_pointer ...\n+\t* configure.ac: ... here.  Update help strings for\n+\t--enable-frame-pointer.\n+\t* configure: Regenerate.\n+\t* config/i386/i386-options.c (ix86_option_override_internal): Remove\n+\tUSE_X86_64_FRAME_POINTER define, use USE_IX86_FRAME_POINTER instead.\n+\t* config/i386/sol2.h (USE_IX86_FRAME_POINTER): Remove.\n+\t(USE_X86_64_FRAME_POINTER): Ditto.\n+\n 2019-05-06  Martin Liska  <mliska@suse.cz>\n \n \t* config.gcc: Append to target_gtfiles and fix indentation."}, {"sha": "baa156da4d2a1b103f7f928ba4192a4bc4d5da3e", "filename": "gcc/config.gcc", "status": "modified", "additions": 0, "deletions": 12, "changes": 12, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/fd661a34e53dd2b20ae5309b78960c171ff9a720/gcc%2Fconfig.gcc", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/fd661a34e53dd2b20ae5309b78960c171ff9a720/gcc%2Fconfig.gcc", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fconfig.gcc?ref=fd661a34e53dd2b20ae5309b78960c171ff9a720", "patch": "@@ -607,12 +607,6 @@ i[34567]86-*-*)\n \t\techo \"This target does not support --with-abi.\"\n \t\texit 1\n \tfi\n-\tif test \"x$enable_cld\" = xyes; then\n-\t\ttm_defines=\"${tm_defines} USE_IX86_CLD=1\"\n-\tfi\n-\tif test \"x$enable_frame_pointer\" = xyes; then\n-\t\ttm_defines=\"${tm_defines} USE_IX86_FRAME_POINTER=1\"\n-\tfi\n \t;;\n x86_64-*-*)\n \tcase ${with_abi} in\n@@ -633,12 +627,6 @@ x86_64-*-*)\n \t\techo \"Unknown ABI used in --with-abi=$with_abi\"\n \t\texit 1\n \tesac\n-\tif test \"x$enable_cld\" = xyes; then\n-\t\ttm_defines=\"${tm_defines} USE_IX86_CLD=1\"\n-\tfi\n-\tif test \"x$enable_frame_pointer\" = xyes; then\n-\t\ttm_defines=\"${tm_defines} USE_IX86_FRAME_POINTER=1\"\n-\tfi\n \t;;\n arm*-*-*)\n \ttm_p_file=\"arm/arm-flags.h ${tm_p_file} arm/aarch-common-protos.h\""}, {"sha": "95a9ae3f79f2542bac41bc28be75319f67d10d58", "filename": "gcc/config/i386/i386-options.c", "status": "modified", "additions": 1, "deletions": 5, "changes": 6, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/fd661a34e53dd2b20ae5309b78960c171ff9a720/gcc%2Fconfig%2Fi386%2Fi386-options.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/fd661a34e53dd2b20ae5309b78960c171ff9a720/gcc%2Fconfig%2Fi386%2Fi386-options.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fconfig%2Fi386%2Fi386-options.c?ref=fd661a34e53dd2b20ae5309b78960c171ff9a720", "patch": "@@ -2196,18 +2196,14 @@ ix86_option_override_internal (bool main_args_p,\n \n #ifndef USE_IX86_FRAME_POINTER\n #define USE_IX86_FRAME_POINTER 0\n-#endif\n-\n-#ifndef USE_X86_64_FRAME_POINTER\n-#define USE_X86_64_FRAME_POINTER 0\n #endif\n \n   /* Set the default values for switches whose default depends on TARGET_64BIT\n      in case they weren't overwritten by command line options.  */\n   if (TARGET_64BIT_P (opts->x_ix86_isa_flags))\n     {\n       if (opts->x_optimize >= 1 && !opts_set->x_flag_omit_frame_pointer)\n-\topts->x_flag_omit_frame_pointer = !USE_X86_64_FRAME_POINTER;\n+\topts->x_flag_omit_frame_pointer = !USE_IX86_FRAME_POINTER;\n       if (opts->x_flag_asynchronous_unwind_tables\n \t  && !opts_set->x_flag_unwind_tables\n \t  && TARGET_64BIT_MS_ABI)"}, {"sha": "5fc4cbcbb8c9aa2f28ce230474b0a815da8ccbf5", "filename": "gcc/config/i386/sol2.h", "status": "modified", "additions": 0, "deletions": 3, "changes": 3, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/fd661a34e53dd2b20ae5309b78960c171ff9a720/gcc%2Fconfig%2Fi386%2Fsol2.h", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/fd661a34e53dd2b20ae5309b78960c171ff9a720/gcc%2Fconfig%2Fi386%2Fsol2.h", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fconfig%2Fi386%2Fsol2.h?ref=fd661a34e53dd2b20ae5309b78960c171ff9a720", "patch": "@@ -248,9 +248,6 @@ along with GCC; see the file COPYING3.  If not see\n #define ASAN_REJECT_SPEC \\\n   DEF_ARCH64_SPEC(\"%e:-fsanitize=address is not supported in this configuration\")\n \n-#define USE_IX86_FRAME_POINTER 1\n-#define USE_X86_64_FRAME_POINTER 1\n-\n #undef NO_PROFILE_COUNTERS\n \n #undef MCOUNT_NAME"}, {"sha": "08cce6f1980cda3eeed0ba5914f159bff427fd2e", "filename": "gcc/configure", "status": "modified", "additions": 15, "deletions": 6, "changes": 21, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/fd661a34e53dd2b20ae5309b78960c171ff9a720/gcc%2Fconfigure", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/fd661a34e53dd2b20ae5309b78960c171ff9a720/gcc%2Fconfigure", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fconfigure?ref=fd661a34e53dd2b20ae5309b78960c171ff9a720", "patch": "@@ -1688,8 +1688,7 @@ Optional Features:\n   --enable-leading-mingw64-underscores\n                           enable leading underscores on 64 bit mingw targets\n   --enable-cld            enable -mcld by default for 32bit x86\n-  --enable-frame-pointer  enable -fno-omit-frame-pointer by default for 32bit\n-                          x86\n+  --enable-frame-pointer  enable -fno-omit-frame-pointer by default for x86\n   --disable-win32-registry\n                           disable lookup of installation paths in the Registry\n                           on Windows hosts\n@@ -12199,8 +12198,7 @@ else\n \n case $target_os in\n linux* | darwin[8912]*)\n-  # Enable -fomit-frame-pointer by default for Linux and Darwin with\n-  # DWARF2.\n+  # Enable -fomit-frame-pointer by default for Linux and Darwin with DWARF2.\n   enable_frame_pointer=no\n   ;;\n *)\n@@ -12211,6 +12209,17 @@ esac\n fi\n \n \n+case $target in\n+i[34567]86-*-* | x86_64-*-*)\n+\tif test \"x$enable_cld\" = xyes; then\n+\t\ttm_defines=\"${tm_defines} USE_IX86_CLD=1\"\n+\tfi\n+\tif test \"x$enable_frame_pointer\" = xyes; then\n+\t\ttm_defines=\"${tm_defines} USE_IX86_FRAME_POINTER=1\"\n+\tfi\n+\t;;\n+esac\n+\n # Windows32 Registry support for specifying GCC installation paths.\n # Check whether --enable-win32-registry was given.\n if test \"${enable_win32_registry+set}\" = set; then :\n@@ -18646,7 +18655,7 @@ else\n   lt_dlunknown=0; lt_dlno_uscore=1; lt_dlneed_uscore=2\n   lt_status=$lt_dlunknown\n   cat > conftest.$ac_ext <<_LT_EOF\n-#line 18649 \"configure\"\n+#line 18658 \"configure\"\n #include \"confdefs.h\"\n \n #if HAVE_DLFCN_H\n@@ -18752,7 +18761,7 @@ else\n   lt_dlunknown=0; lt_dlno_uscore=1; lt_dlneed_uscore=2\n   lt_status=$lt_dlunknown\n   cat > conftest.$ac_ext <<_LT_EOF\n-#line 18755 \"configure\"\n+#line 18764 \"configure\"\n #include \"confdefs.h\"\n \n #if HAVE_DLFCN_H"}, {"sha": "7c526b9ada40acdd65ecf7c238cb095613bd7292", "filename": "gcc/configure.ac", "status": "modified", "additions": 13, "deletions": 3, "changes": 16, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/fd661a34e53dd2b20ae5309b78960c171ff9a720/gcc%2Fconfigure.ac", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/fd661a34e53dd2b20ae5309b78960c171ff9a720/gcc%2Fconfigure.ac", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fconfigure.ac?ref=fd661a34e53dd2b20ae5309b78960c171ff9a720", "patch": "@@ -1881,12 +1881,11 @@ AC_ARG_ENABLE(cld,\n \n AC_ARG_ENABLE(frame-pointer,\n [AS_HELP_STRING([--enable-frame-pointer],\n-\t\t[enable -fno-omit-frame-pointer by default for 32bit x86])], [],\n+\t\t[enable -fno-omit-frame-pointer by default for x86])], [],\n [\n case $target_os in\n linux* | darwin[[8912]]*)\n-  # Enable -fomit-frame-pointer by default for Linux and Darwin with\n-  # DWARF2.\n+  # Enable -fomit-frame-pointer by default for Linux and Darwin with DWARF2.\n   enable_frame_pointer=no\n   ;;\n *)\n@@ -1895,6 +1894,17 @@ linux* | darwin[[8912]]*)\n esac\n ])\n \n+case $target in\n+i[[34567]]86-*-* | x86_64-*-*)\n+\tif test \"x$enable_cld\" = xyes; then\n+\t\ttm_defines=\"${tm_defines} USE_IX86_CLD=1\"\n+\tfi\n+\tif test \"x$enable_frame_pointer\" = xyes; then\n+\t\ttm_defines=\"${tm_defines} USE_IX86_FRAME_POINTER=1\"\n+\tfi\n+\t;;\n+esac\n+\n # Windows32 Registry support for specifying GCC installation paths.\n AC_ARG_ENABLE(win32-registry,\n [AS_HELP_STRING([--disable-win32-registry],"}]}