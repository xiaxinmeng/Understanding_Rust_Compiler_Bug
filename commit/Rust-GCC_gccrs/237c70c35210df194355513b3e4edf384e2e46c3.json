{"sha": "237c70c35210df194355513b3e4edf384e2e46c3", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6MjM3YzcwYzM1MjEwZGYxOTQzNTU1MTNiM2U0ZWRmMzg0ZTJlNDZjMw==", "commit": {"author": {"name": "Maxim Kuvyrkov", "email": "maxim.kuvyrkov@linaro.org", "date": "2015-01-20T13:37:02Z"}, "committer": {"name": "Maxim Kuvyrkov", "email": "mkuvyrkov@gcc.gnu.org", "date": "2015-01-20T13:37:02Z"}, "message": "Use enum for sched_autopref tune settings\n\n\t* config/arm/arm-protos.h (enum arm_sched_autopref): New constants.\n\t(struct tune_params): Use the enum.\n\t* arm.c (arm_*_tune): Update.\n\t(arm_option_override): Update.\n\nFrom-SVN: r219893", "tree": {"sha": "4c6d318d08a3781066cbfda90b38c81a9ca50808", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/4c6d318d08a3781066cbfda90b38c81a9ca50808"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/237c70c35210df194355513b3e4edf384e2e46c3", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/237c70c35210df194355513b3e4edf384e2e46c3", "html_url": "https://github.com/Rust-GCC/gccrs/commit/237c70c35210df194355513b3e4edf384e2e46c3", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/237c70c35210df194355513b3e4edf384e2e46c3/comments", "author": {"login": "maxim-kuvyrkov", "id": 12545699, "node_id": "MDQ6VXNlcjEyNTQ1Njk5", "avatar_url": "https://avatars.githubusercontent.com/u/12545699?v=4", "gravatar_id": "", "url": "https://api.github.com/users/maxim-kuvyrkov", "html_url": "https://github.com/maxim-kuvyrkov", "followers_url": "https://api.github.com/users/maxim-kuvyrkov/followers", "following_url": "https://api.github.com/users/maxim-kuvyrkov/following{/other_user}", "gists_url": "https://api.github.com/users/maxim-kuvyrkov/gists{/gist_id}", "starred_url": "https://api.github.com/users/maxim-kuvyrkov/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/maxim-kuvyrkov/subscriptions", "organizations_url": "https://api.github.com/users/maxim-kuvyrkov/orgs", "repos_url": "https://api.github.com/users/maxim-kuvyrkov/repos", "events_url": "https://api.github.com/users/maxim-kuvyrkov/events{/privacy}", "received_events_url": "https://api.github.com/users/maxim-kuvyrkov/received_events", "type": "User", "site_admin": false}, "committer": null, "parents": [{"sha": "2fd2ae3458ca760040ddb65a45f45fb2e89f2779", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/2fd2ae3458ca760040ddb65a45f45fb2e89f2779", "html_url": "https://github.com/Rust-GCC/gccrs/commit/2fd2ae3458ca760040ddb65a45f45fb2e89f2779"}], "stats": {"total": 67, "additions": 45, "deletions": 22}, "files": [{"sha": "995c2e2d22e71668d7889f14cfbb20976e8f470c", "filename": "gcc/ChangeLog", "status": "modified", "additions": 7, "deletions": 0, "changes": 7, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/237c70c35210df194355513b3e4edf384e2e46c3/gcc%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/237c70c35210df194355513b3e4edf384e2e46c3/gcc%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2FChangeLog?ref=237c70c35210df194355513b3e4edf384e2e46c3", "patch": "@@ -1,3 +1,10 @@\n+2015-01-20  Maxim Kuvyrkov  <maxim.kuvyrkov@linaro.org>\n+\n+\t* config/arm/arm-protos.h (enum arm_sched_autopref): New constants.\n+\t(struct tune_params): Use the enum.\n+\t* arm.c (arm_*_tune): Update.\n+\t(arm_option_override): Update.\n+\n 2015-01-20  Richard Biener  <rguenther@suse.de>\n \n \tPR ipa/64684"}, {"sha": "307babb70f01b706d540b5adfeaa9cb6aee606c4", "filename": "gcc/config/arm/arm-protos.h", "status": "modified", "additions": 8, "deletions": 1, "changes": 9, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/237c70c35210df194355513b3e4edf384e2e46c3/gcc%2Fconfig%2Farm%2Farm-protos.h", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/237c70c35210df194355513b3e4edf384e2e46c3/gcc%2Fconfig%2Farm%2Farm-protos.h", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fconfig%2Farm%2Farm-protos.h?ref=237c70c35210df194355513b3e4edf384e2e46c3", "patch": "@@ -257,6 +257,13 @@ struct cpu_vec_costs {\n \n struct cpu_cost_table;\n \n+enum arm_sched_autopref\n+  {\n+    ARM_SCHED_AUTOPREF_OFF,\n+    ARM_SCHED_AUTOPREF_RANK,\n+    ARM_SCHED_AUTOPREF_FULL\n+  };\n+\n struct tune_params\n {\n   bool (*rtx_costs) (rtx, RTX_CODE, RTX_CODE, int *, bool);\n@@ -292,7 +299,7 @@ struct tune_params\n   /* Bitfield encoding the fuseable pairs of instructions.  */\n   unsigned int fuseable_ops;\n   /* Depth of scheduling queue to check for L2 autoprefetcher.  */\n-  int sched_autopref_queue_depth;\n+  enum arm_sched_autopref sched_autopref;\n };\n \n extern const struct tune_params *current_tune;"}, {"sha": "fc21b33f45787e5b5b09a4ef59dc054d61b3be56", "filename": "gcc/config/arm/arm.c", "status": "modified", "additions": 30, "deletions": 21, "changes": 51, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/237c70c35210df194355513b3e4edf384e2e46c3/gcc%2Fconfig%2Farm%2Farm.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/237c70c35210df194355513b3e4edf384e2e46c3/gcc%2Fconfig%2Farm%2Farm.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fconfig%2Farm%2Farm.c?ref=237c70c35210df194355513b3e4edf384e2e46c3", "patch": "@@ -1696,7 +1696,7 @@ const struct tune_params arm_slowmul_tune =\n   false,\t\t\t\t\t/* Prefer Neon for stringops.  */\n   8,\t\t\t\t\t\t/* Maximum insns to inline memset.  */\n   ARM_FUSE_NOTHING,\t\t\t\t/* Fuseable pairs of instructions.  */\n-  -1\t\t\t\t\t\t/* Sched L2 autopref depth.  */\n+  ARM_SCHED_AUTOPREF_OFF\t\t\t/* Sched L2 autopref.  */\n };\n \n const struct tune_params arm_fastmul_tune =\n@@ -1717,7 +1717,7 @@ const struct tune_params arm_fastmul_tune =\n   false,\t\t\t\t\t/* Prefer Neon for stringops.  */\n   8,\t\t\t\t\t\t/* Maximum insns to inline memset.  */\n   ARM_FUSE_NOTHING,\t\t\t\t/* Fuseable pairs of instructions.  */\n-  -1\t\t\t\t\t\t/* Sched L2 autopref depth.  */\n+  ARM_SCHED_AUTOPREF_OFF\t\t\t/* Sched L2 autopref.  */\n };\n \n /* StrongARM has early execution of branches, so a sequence that is worth\n@@ -1741,7 +1741,7 @@ const struct tune_params arm_strongarm_tune =\n   false,\t\t\t\t\t/* Prefer Neon for stringops.  */\n   8,\t\t\t\t\t\t/* Maximum insns to inline memset.  */\n   ARM_FUSE_NOTHING,\t\t\t\t/* Fuseable pairs of instructions.  */\n-  -1\t\t\t\t\t\t/* Sched L2 autopref depth.  */\n+  ARM_SCHED_AUTOPREF_OFF\t\t\t/* Sched L2 autopref.  */\n };\n \n const struct tune_params arm_xscale_tune =\n@@ -1762,7 +1762,7 @@ const struct tune_params arm_xscale_tune =\n   false,\t\t\t\t\t/* Prefer Neon for stringops.  */\n   8,\t\t\t\t\t\t/* Maximum insns to inline memset.  */\n   ARM_FUSE_NOTHING,\t\t\t\t/* Fuseable pairs of instructions.  */\n-  -1\t\t\t\t\t\t/* Sched L2 autopref depth.  */\n+  ARM_SCHED_AUTOPREF_OFF\t\t\t/* Sched L2 autopref.  */\n };\n \n const struct tune_params arm_9e_tune =\n@@ -1783,7 +1783,7 @@ const struct tune_params arm_9e_tune =\n   false,\t\t\t\t\t/* Prefer Neon for stringops.  */\n   8,\t\t\t\t\t\t/* Maximum insns to inline memset.  */\n   ARM_FUSE_NOTHING,\t\t\t\t/* Fuseable pairs of instructions.  */\n-  -1\t\t\t\t\t\t/* Sched L2 autopref depth.  */\n+  ARM_SCHED_AUTOPREF_OFF\t\t\t/* Sched L2 autopref.  */\n };\n \n const struct tune_params arm_v6t2_tune =\n@@ -1804,7 +1804,7 @@ const struct tune_params arm_v6t2_tune =\n   false,\t\t\t\t\t/* Prefer Neon for stringops.  */\n   8,\t\t\t\t\t\t/* Maximum insns to inline memset.  */\n   ARM_FUSE_NOTHING,\t\t\t\t/* Fuseable pairs of instructions.  */\n-  -1\t\t\t\t\t\t/* Sched L2 autopref depth.  */\n+  ARM_SCHED_AUTOPREF_OFF\t\t\t/* Sched L2 autopref.  */\n };\n \n /* Generic Cortex tuning.  Use more specific tunings if appropriate.  */\n@@ -1826,7 +1826,7 @@ const struct tune_params arm_cortex_tune =\n   false,\t\t\t\t\t/* Prefer Neon for stringops.  */\n   8,\t\t\t\t\t\t/* Maximum insns to inline memset.  */\n   ARM_FUSE_NOTHING,\t\t\t\t/* Fuseable pairs of instructions.  */\n-  -1\t\t\t\t\t\t/* Sched L2 autopref depth.  */\n+  ARM_SCHED_AUTOPREF_OFF\t\t\t/* Sched L2 autopref.  */\n };\n \n const struct tune_params arm_cortex_a8_tune =\n@@ -1847,7 +1847,7 @@ const struct tune_params arm_cortex_a8_tune =\n   true,\t\t\t\t\t\t/* Prefer Neon for stringops.  */\n   8,\t\t\t\t\t\t/* Maximum insns to inline memset.  */\n   ARM_FUSE_NOTHING,\t\t\t\t/* Fuseable pairs of instructions.  */\n-  -1\t\t\t\t\t\t/* Sched L2 autopref depth.  */\n+  ARM_SCHED_AUTOPREF_OFF\t\t\t/* Sched L2 autopref.  */\n };\n \n const struct tune_params arm_cortex_a7_tune =\n@@ -1868,7 +1868,7 @@ const struct tune_params arm_cortex_a7_tune =\n   true,\t\t\t\t\t\t/* Prefer Neon for stringops.  */\n   8,\t\t\t\t\t\t/* Maximum insns to inline memset.  */\n   ARM_FUSE_NOTHING,\t\t\t\t/* Fuseable pairs of instructions.  */\n-  -1\t\t\t\t\t\t/* Sched L2 autopref depth.  */\n+  ARM_SCHED_AUTOPREF_OFF\t\t\t/* Sched L2 autopref.  */\n };\n \n const struct tune_params arm_cortex_a15_tune =\n@@ -1889,7 +1889,7 @@ const struct tune_params arm_cortex_a15_tune =\n   true,\t\t\t\t\t\t/* Prefer Neon for stringops.  */\n   8,\t\t\t\t\t\t/* Maximum insns to inline memset.  */\n   ARM_FUSE_NOTHING,\t\t\t\t/* Fuseable pairs of instructions.  */\n-  max_insn_queue_index + 1\t\t\t/* Sched L2 autopref depth.  */\n+  ARM_SCHED_AUTOPREF_FULL\t\t\t/* Sched L2 autopref.  */\n };\n \n const struct tune_params arm_cortex_a53_tune =\n@@ -1910,7 +1910,7 @@ const struct tune_params arm_cortex_a53_tune =\n   false,\t\t\t\t\t/* Prefer Neon for stringops.  */\n   8,\t\t\t\t\t\t/* Maximum insns to inline memset.  */\n   ARM_FUSE_MOVW_MOVT,\t\t\t\t/* Fuseable pairs of instructions.  */\n-  -1\t\t\t\t\t\t/* Sched L2 autopref depth.  */\n+  ARM_SCHED_AUTOPREF_OFF\t\t\t/* Sched L2 autopref.  */\n };\n \n const struct tune_params arm_cortex_a57_tune =\n@@ -1931,7 +1931,7 @@ const struct tune_params arm_cortex_a57_tune =\n   false,\t\t\t\t\t/* Prefer Neon for stringops.  */\n   8,\t\t\t\t\t\t/* Maximum insns to inline memset.  */\n   ARM_FUSE_MOVW_MOVT,\t\t\t\t/* Fuseable pairs of instructions.  */\n-  max_insn_queue_index + 1\t\t\t/* Sched L2 autopref depth.  */\n+  ARM_SCHED_AUTOPREF_FULL\t\t\t/* Sched L2 autopref.  */\n };\n \n const struct tune_params arm_xgene1_tune =\n@@ -1952,7 +1952,7 @@ const struct tune_params arm_xgene1_tune =\n   false,\t\t\t\t       /* Prefer Neon for stringops.  */\n   32,\t\t\t\t\t       /* Maximum insns to inline memset.  */\n   ARM_FUSE_NOTHING,\t\t\t\t/* Fuseable pairs of instructions.  */\n-  -1\t\t\t\t\t\t/* Sched L2 autopref depth.  */\n+  ARM_SCHED_AUTOPREF_OFF\t\t\t/* Sched L2 autopref.  */\n };\n \n /* Branches can be dual-issued on Cortex-A5, so conditional execution is\n@@ -1976,7 +1976,7 @@ const struct tune_params arm_cortex_a5_tune =\n   true,\t\t\t\t\t\t/* Prefer Neon for stringops.  */\n   8,\t\t\t\t\t\t/* Maximum insns to inline memset.  */\n   ARM_FUSE_NOTHING,\t\t\t\t/* Fuseable pairs of instructions.  */\n-  -1\t\t\t\t\t\t/* Sched L2 autopref depth.  */\n+  ARM_SCHED_AUTOPREF_OFF\t\t\t/* Sched L2 autopref.  */\n };\n \n const struct tune_params arm_cortex_a9_tune =\n@@ -1997,7 +1997,7 @@ const struct tune_params arm_cortex_a9_tune =\n   false,\t\t\t\t\t/* Prefer Neon for stringops.  */\n   8,\t\t\t\t\t\t/* Maximum insns to inline memset.  */\n   ARM_FUSE_NOTHING,\t\t\t\t/* Fuseable pairs of instructions.  */\n-  -1\t\t\t\t\t\t/* Sched L2 autopref depth.  */\n+  ARM_SCHED_AUTOPREF_OFF\t\t\t/* Sched L2 autopref.  */\n };\n \n const struct tune_params arm_cortex_a12_tune =\n@@ -2018,7 +2018,7 @@ const struct tune_params arm_cortex_a12_tune =\n   true,\t\t\t\t\t\t/* Prefer Neon for stringops.  */\n   8,\t\t\t\t\t\t/* Maximum insns to inline memset.  */\n   ARM_FUSE_MOVW_MOVT,\t\t\t\t/* Fuseable pairs of instructions.  */\n-  -1\t\t\t\t\t\t/* Sched L2 autopref depth.  */\n+  ARM_SCHED_AUTOPREF_OFF\t\t\t/* Sched L2 autopref.  */\n };\n \n /* armv7m tuning.  On Cortex-M4 cores for example, MOVW/MOVT take a single\n@@ -2046,7 +2046,7 @@ const struct tune_params arm_v7m_tune =\n   false,\t\t\t\t\t/* Prefer Neon for stringops.  */\n   8,\t\t\t\t\t\t/* Maximum insns to inline memset.  */\n   ARM_FUSE_NOTHING,\t\t\t\t/* Fuseable pairs of instructions.  */\n-  -1\t\t\t\t\t\t/* Sched L2 autopref depth.  */\n+  ARM_SCHED_AUTOPREF_OFF\t\t\t/* Sched L2 autopref.  */\n };\n \n /* Cortex-M7 tuning.  */\n@@ -2069,7 +2069,7 @@ const struct tune_params arm_cortex_m7_tune =\n   false,\t\t\t\t\t/* Prefer Neon for stringops.  */\n   8,\t\t\t\t\t\t/* Maximum insns to inline memset.  */\n   ARM_FUSE_NOTHING,\t\t\t\t/* Fuseable pairs of instructions.  */\n-  -1\t\t\t\t\t\t/* Sched L2 autopref depth.  */\n+  ARM_SCHED_AUTOPREF_OFF\t\t\t/* Sched L2 autopref.  */\n };\n \n /* The arm_v6m_tune is duplicated from arm_cortex_tune, rather than\n@@ -2092,7 +2092,7 @@ const struct tune_params arm_v6m_tune =\n   false,\t\t\t\t\t/* Prefer Neon for stringops.  */\n   8,\t\t\t\t\t\t/* Maximum insns to inline memset.  */\n   ARM_FUSE_NOTHING,\t\t\t\t/* Fuseable pairs of instructions.  */\n-  -1\t\t\t\t\t\t/* Sched L2 autopref depth.  */\n+  ARM_SCHED_AUTOPREF_OFF\t\t\t/* Sched L2 autopref.  */\n };\n \n const struct tune_params arm_fa726te_tune =\n@@ -2113,7 +2113,7 @@ const struct tune_params arm_fa726te_tune =\n   false,\t\t\t\t\t/* Prefer Neon for stringops.  */\n   8,\t\t\t\t\t\t/* Maximum insns to inline memset.  */\n   ARM_FUSE_NOTHING,\t\t\t\t/* Fuseable pairs of instructions.  */\n-  -1\t\t\t\t\t\t/* Sched L2 autopref depth.  */\n+  ARM_SCHED_AUTOPREF_OFF\t\t\t/* Sched L2 autopref.  */\n };\n \n \n@@ -3171,8 +3171,17 @@ arm_option_override (void)\n \n   /* Look through ready list and all of queue for instructions\n      relevant for L2 auto-prefetcher.  */\n+  int param_sched_autopref_queue_depth;\n+  if (current_tune->sched_autopref == ARM_SCHED_AUTOPREF_OFF)\n+    param_sched_autopref_queue_depth = -1;\n+  else if (current_tune->sched_autopref == ARM_SCHED_AUTOPREF_RANK)\n+    param_sched_autopref_queue_depth = 0;\n+  else if (current_tune->sched_autopref == ARM_SCHED_AUTOPREF_FULL)\n+    param_sched_autopref_queue_depth = max_insn_queue_index + 1;\n+  else\n+    gcc_unreachable ();\n   maybe_set_param_value (PARAM_SCHED_AUTOPREF_QUEUE_DEPTH,\n-\t\t\t current_tune->sched_autopref_queue_depth,\n+\t\t\t param_sched_autopref_queue_depth,\n                          global_options.x_param_values,\n                          global_options_set.x_param_values);\n "}]}