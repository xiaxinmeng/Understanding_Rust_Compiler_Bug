{"sha": "76642aabbd91c89cfae1c3ba2fa61785b6fbabd6", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6NzY2NDJhYWJiZDkxYzg5Y2ZhZTFjM2JhMmZhNjE3ODViNmZiYWJkNg==", "commit": {"author": {"name": "Carlos O'Donell", "email": "carlos@codesourcery.com", "date": "2006-11-20T17:15:27Z"}, "committer": {"name": "Carlos O'Donell", "email": "carlos@gcc.gnu.org", "date": "2006-11-20T17:15:27Z"}, "message": "cppdefault.c: Define cpp_PREFIX, cpp_PREFIX_len, and gcc_exec_prefix.\n\n\ngcc/\n\n2006-11-20  Carlos O'Donell  <carlos@codesourcery.com>\n\t    Mark Mitchell  <mark@codesourcery.com>\n\n\t* cppdefault.c: Define cpp_PREFIX, cpp_PREFIX_len, and \n\tgcc_exec_prefix.\n\t(cpp_relocated): New function.\n\t* cppdefault.h: Declare cpp_PREFIX, cpp_PREFIX_len, gcc_exec_prefix \n\tand cpp_relocated. \n\t* Makefile.in (PREPROCESSOR_DEFINES): Add -DPREFIX option.\n\t* c-incpath.c (add_standard_paths): Call cpp_relocated. If relocated,\n\treplace configured prefix with gcc_exec_prefix. \n\n\nCo-Authored-By: Mark Mitchell <mark@codesourcery.com>\n\nFrom-SVN: r119017", "tree": {"sha": "97ba2bb27388441e1c8a03a879e691c010485917", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/97ba2bb27388441e1c8a03a879e691c010485917"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/76642aabbd91c89cfae1c3ba2fa61785b6fbabd6", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/76642aabbd91c89cfae1c3ba2fa61785b6fbabd6", "html_url": "https://github.com/Rust-GCC/gccrs/commit/76642aabbd91c89cfae1c3ba2fa61785b6fbabd6", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/76642aabbd91c89cfae1c3ba2fa61785b6fbabd6/comments", "author": null, "committer": null, "parents": [{"sha": "9d691ba7501c741571edc1618c434316b1eb0170", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/9d691ba7501c741571edc1618c434316b1eb0170", "html_url": "https://github.com/Rust-GCC/gccrs/commit/9d691ba7501c741571edc1618c434316b1eb0170"}], "stats": {"total": 60, "additions": 60, "deletions": 0}, "files": [{"sha": "bdc6b36c96c6ecab49c187d1b71978b7eac2b52f", "filename": "gcc/ChangeLog", "status": "modified", "additions": 12, "deletions": 0, "changes": 12, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/76642aabbd91c89cfae1c3ba2fa61785b6fbabd6/gcc%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/76642aabbd91c89cfae1c3ba2fa61785b6fbabd6/gcc%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2FChangeLog?ref=76642aabbd91c89cfae1c3ba2fa61785b6fbabd6", "patch": "@@ -1,3 +1,15 @@\n+2006-11-20  Carlos O'Donell  <carlos@codesourcery.com>\n+\t    Mark Mitchell  <mark@codesourcery.com>\n+\n+\t* cppdefault.c: Define cpp_PREFIX, cpp_PREFIX_len, and \n+\tgcc_exec_prefix.\n+\t(cpp_relocated): New function.\n+\t* cppdefault.h: Declare cpp_PREFIX, cpp_PREFIX_len, gcc_exec_prefix \n+\tand cpp_relocated. \n+\t* Makefile.in (PREPROCESSOR_DEFINES): Add -DPREFIX option.\n+\t* c-incpath.c (add_standard_paths): Call cpp_relocated. If relocated,\n+\treplace configured prefix with gcc_exec_prefix. \n+\n 2006-11-20  Bernd Schmidt  <bernd.schmidt@analog.com>\n \n \t* config/bfin/bfin.h (LEGITIMATE_CONSTANT_P): Call"}, {"sha": "c6334d70ec9cd94e3dd522b3e7fb93ab2e0cb330", "filename": "gcc/Makefile.in", "status": "modified", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/76642aabbd91c89cfae1c3ba2fa61785b6fbabd6/gcc%2FMakefile.in", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/76642aabbd91c89cfae1c3ba2fa61785b6fbabd6/gcc%2FMakefile.in", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2FMakefile.in?ref=76642aabbd91c89cfae1c3ba2fa61785b6fbabd6", "patch": "@@ -3071,6 +3071,7 @@ PREPROCESSOR_DEFINES = \\\n   -DLOCAL_INCLUDE_DIR=\\\"$(local_includedir)\\\" \\\n   -DCROSS_INCLUDE_DIR=\\\"$(CROSS_SYSTEM_HEADER_DIR)\\\" \\\n   -DTOOL_INCLUDE_DIR=\\\"$(gcc_tooldir)/include\\\" \\\n+  -DPREFIX=\\\"$(prefix)\\\" \\\n   @TARGET_SYSTEM_ROOT_DEFINE@\n \n cppdefault.o: cppdefault.c $(CONFIG_H) $(SYSTEM_H) coretypes.h $(TM_H) \\"}, {"sha": "2c5ac6db89f464da4604fe630f5f2118a3a5a332", "filename": "gcc/c-incpath.c", "status": "modified", "additions": 12, "deletions": 0, "changes": 12, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/76642aabbd91c89cfae1c3ba2fa61785b6fbabd6/gcc%2Fc-incpath.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/76642aabbd91c89cfae1c3ba2fa61785b6fbabd6/gcc%2Fc-incpath.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fc-incpath.c?ref=76642aabbd91c89cfae1c3ba2fa61785b6fbabd6", "patch": "@@ -127,6 +127,7 @@ add_standard_paths (const char *sysroot, const char *iprefix,\n \t\t    const char *imultilib, int cxx_stdinc)\n {\n   const struct default_include *p;\n+  int relocated = cpp_relocated();\n   size_t len;\n \n   if (iprefix && (len = cpp_GCC_INCLUDE_DIR_len) != 0)\n@@ -163,6 +164,17 @@ add_standard_paths (const char *sysroot, const char *iprefix,\n \t  /* Should this directory start with the sysroot?  */\n \t  if (sysroot && p->add_sysroot)\n \t    str = concat (sysroot, p->fname, NULL);\n+\t  else if (!p->add_sysroot && relocated)\n+\t    {\n+\t      /* If the compiler is relocated, and this is a configured \n+\t\t prefix relative path, then we use gcc_exec_prefix instead \n+\t\t of the configured prefix.  */\n+\t      gcc_assert (strncmp (p->fname, cpp_PREFIX,\n+\t\t\t\t     cpp_PREFIX_len) == 0);\n+\t      str = concat (gcc_exec_prefix, p->fname\n+\t\t\t      + cpp_PREFIX_len, NULL);\n+\t      str = update_path (str, p->component);\n+\t    }\n \t  else\n \t    str = update_path (p->fname, p->component);\n "}, {"sha": "c72cb390aba8e84e202d0b9cecd5a37580eb310f", "filename": "gcc/cppdefault.c", "status": "modified", "additions": 28, "deletions": 0, "changes": 28, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/76642aabbd91c89cfae1c3ba2fa61785b6fbabd6/gcc%2Fcppdefault.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/76642aabbd91c89cfae1c3ba2fa61785b6fbabd6/gcc%2Fcppdefault.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fcppdefault.c?ref=76642aabbd91c89cfae1c3ba2fa61785b6fbabd6", "patch": "@@ -96,3 +96,31 @@ const size_t cpp_GCC_INCLUDE_DIR_len = sizeof GCC_INCLUDE_DIR - 8;\n const char cpp_GCC_INCLUDE_DIR[] = \"\";\n const size_t cpp_GCC_INCLUDE_DIR_len = 0;\n #endif\n+\n+/* The configured prefix.  */\n+const char cpp_PREFIX[] = PREFIX;\n+const size_t cpp_PREFIX_len = sizeof PREFIX - 1;\n+\n+/* This value is set by cpp_relocated at runtime */\n+const char *gcc_exec_prefix;\n+\n+/* Return true if the toolchain is relocated.  */\n+bool\n+cpp_relocated (void)\n+{\n+  static int relocated = -1;\n+\n+  /* A relocated toolchain ignores standard include directories.  */\n+  if (relocated == -1)\n+    {\n+      /* Check if the toolchain was relocated?  */\n+      GET_ENVIRONMENT (gcc_exec_prefix, \"GCC_EXEC_PREFIX\");\n+      if (gcc_exec_prefix)\n+       relocated = 1;\n+      else\n+       relocated = 0;\n+    }\n+\n+  return relocated;\n+}\n+"}, {"sha": "2da6d05f56427b4f277fa3698c0a046283374d16", "filename": "gcc/cppdefault.h", "status": "modified", "additions": 7, "deletions": 0, "changes": 7, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/76642aabbd91c89cfae1c3ba2fa61785b6fbabd6/gcc%2Fcppdefault.h", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/76642aabbd91c89cfae1c3ba2fa61785b6fbabd6/gcc%2Fcppdefault.h", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fcppdefault.h?ref=76642aabbd91c89cfae1c3ba2fa61785b6fbabd6", "patch": "@@ -52,4 +52,11 @@ extern const struct default_include cpp_include_defaults[];\n extern const char cpp_GCC_INCLUDE_DIR[];\n extern const size_t cpp_GCC_INCLUDE_DIR_len;\n \n+extern const char cpp_PREFIX[];\n+extern const size_t cpp_PREFIX_len;\n+extern const char *gcc_exec_prefix;\n+\n+/* Return true if the toolchain is relocated.  */\n+bool cpp_relocated (void);\n+\n #endif /* ! GCC_CPPDEFAULT_H */"}]}