{"sha": "1fa42d62140b56589771eb3d46f89c810bfc8e0a", "node_id": "C_kwDOANBUbNoAKDFmYTQyZDYyMTQwYjU2NTg5NzcxZWIzZDQ2Zjg5YzgxMGJmYzhlMGE", "commit": {"author": {"name": "Xi Ruoyao", "email": "xry111@xry111.site", "date": "2022-07-08T13:09:25Z"}, "committer": {"name": "Xi Ruoyao", "email": "xry111@xry111.site", "date": "2022-07-10T03:28:08Z"}, "message": "loongarch: fix mulsidi3_64bit instruction\n\n(mult (sign_extend:DI rj:SI) (sign_extend:DI rk:SI)) should be\n\"mulw.d.w\", not \"mul.d\".\n\ngcc/ChangeLog:\n\n\t* config/loongarch/loongarch.md (mulsidi3_64bit): Use mulw.d.w\n\tinstead of mul.d.\n\ngcc/testsuite/ChangeLog:\n\n\t* gcc.target/loongarch/mulw_d_w.c: New test.\n\t* gcc.c-torture/execute/mul-sext.c: New test.", "tree": {"sha": "951d8d8e9c1995b5e44ebb191378ca062e0b473c", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/951d8d8e9c1995b5e44ebb191378ca062e0b473c"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/1fa42d62140b56589771eb3d46f89c810bfc8e0a", "comment_count": 0, "verification": {"verified": true, "reason": "valid", "signature": "-----BEGIN PGP SIGNATURE-----\n\niHUEABYKAB0WIQSR0PV2MB+STX3t3OisqtIOGecQ4wUCYspHSAAKCRCsqtIOGecQ\n4/KJAP9xSHynAF+qqeJybdmhKBOG0XAKIP6vEzmVAkXE7C8LTwD+M2HR6JsxAPoR\nBaMg2gars/yagQovdEQzJMgm1TFI5AE=\n=h20H\n-----END PGP SIGNATURE-----", "payload": "tree 951d8d8e9c1995b5e44ebb191378ca062e0b473c\nparent aa2eb25c94cde4c147443a562eadc69de03b1556\nauthor Xi Ruoyao <xry111@xry111.site> 1657285765 +0800\ncommitter Xi Ruoyao <xry111@xry111.site> 1657423688 +0800\n\nloongarch: fix mulsidi3_64bit instruction\n\n(mult (sign_extend:DI rj:SI) (sign_extend:DI rk:SI)) should be\n\"mulw.d.w\", not \"mul.d\".\n\ngcc/ChangeLog:\n\n\t* config/loongarch/loongarch.md (mulsidi3_64bit): Use mulw.d.w\n\tinstead of mul.d.\n\ngcc/testsuite/ChangeLog:\n\n\t* gcc.target/loongarch/mulw_d_w.c: New test.\n\t* gcc.c-torture/execute/mul-sext.c: New test.\n"}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/1fa42d62140b56589771eb3d46f89c810bfc8e0a", "html_url": "https://github.com/Rust-GCC/gccrs/commit/1fa42d62140b56589771eb3d46f89c810bfc8e0a", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/1fa42d62140b56589771eb3d46f89c810bfc8e0a/comments", "author": {"login": "xry111", "id": 8733039, "node_id": "MDQ6VXNlcjg3MzMwMzk=", "avatar_url": "https://avatars.githubusercontent.com/u/8733039?v=4", "gravatar_id": "", "url": "https://api.github.com/users/xry111", "html_url": "https://github.com/xry111", "followers_url": "https://api.github.com/users/xry111/followers", "following_url": "https://api.github.com/users/xry111/following{/other_user}", "gists_url": "https://api.github.com/users/xry111/gists{/gist_id}", "starred_url": "https://api.github.com/users/xry111/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/xry111/subscriptions", "organizations_url": "https://api.github.com/users/xry111/orgs", "repos_url": "https://api.github.com/users/xry111/repos", "events_url": "https://api.github.com/users/xry111/events{/privacy}", "received_events_url": "https://api.github.com/users/xry111/received_events", "type": "User", "site_admin": false}, "committer": {"login": "xry111", "id": 8733039, "node_id": "MDQ6VXNlcjg3MzMwMzk=", "avatar_url": "https://avatars.githubusercontent.com/u/8733039?v=4", "gravatar_id": "", "url": "https://api.github.com/users/xry111", "html_url": "https://github.com/xry111", "followers_url": "https://api.github.com/users/xry111/followers", "following_url": "https://api.github.com/users/xry111/following{/other_user}", "gists_url": "https://api.github.com/users/xry111/gists{/gist_id}", "starred_url": "https://api.github.com/users/xry111/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/xry111/subscriptions", "organizations_url": "https://api.github.com/users/xry111/orgs", "repos_url": "https://api.github.com/users/xry111/repos", "events_url": "https://api.github.com/users/xry111/events{/privacy}", "received_events_url": "https://api.github.com/users/xry111/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "aa2eb25c94cde4c147443a562eadc69de03b1556", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/aa2eb25c94cde4c147443a562eadc69de03b1556", "html_url": "https://github.com/Rust-GCC/gccrs/commit/aa2eb25c94cde4c147443a562eadc69de03b1556"}], "stats": {"total": 32, "additions": 31, "deletions": 1}, "files": [{"sha": "8f8412fba84ee15ce7619f85cee443e4f1a6d1ea", "filename": "gcc/config/loongarch/loongarch.md", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/1fa42d62140b56589771eb3d46f89c810bfc8e0a/gcc%2Fconfig%2Floongarch%2Floongarch.md", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/1fa42d62140b56589771eb3d46f89c810bfc8e0a/gcc%2Fconfig%2Floongarch%2Floongarch.md", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fconfig%2Floongarch%2Floongarch.md?ref=1fa42d62140b56589771eb3d46f89c810bfc8e0a", "patch": "@@ -621,7 +621,7 @@\n \t(mult:DI (sign_extend:DI (match_operand:SI 1 \"register_operand\" \"r\"))\n \t\t (sign_extend:DI (match_operand:SI 2 \"register_operand\" \"r\"))))]\n   \"TARGET_64BIT\"\n-  \"mul.d\\t%0,%1,%2\"\n+  \"mulw.d.w\\t%0,%1,%2\"\n   [(set_attr \"type\" \"imul\")\n    (set_attr \"mode\" \"DI\")])\n "}, {"sha": "8b6800804fbb305d14f7e5abf03069fb4369af97", "filename": "gcc/testsuite/gcc.c-torture/execute/mul-sext.c", "status": "added", "additions": 20, "deletions": 0, "changes": 20, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/1fa42d62140b56589771eb3d46f89c810bfc8e0a/gcc%2Ftestsuite%2Fgcc.c-torture%2Fexecute%2Fmul-sext.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/1fa42d62140b56589771eb3d46f89c810bfc8e0a/gcc%2Ftestsuite%2Fgcc.c-torture%2Fexecute%2Fmul-sext.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgcc.c-torture%2Fexecute%2Fmul-sext.c?ref=1fa42d62140b56589771eb3d46f89c810bfc8e0a", "patch": "@@ -0,0 +1,20 @@\n+/* { dg-do run } */\n+\n+typedef __INT64_TYPE__ int64_t;\n+typedef __INT32_TYPE__ int32_t;\n+\n+/* f() was misoptimized to a single \"mul.d\" instruction on LA64.  */\n+__attribute__((noipa, noinline)) int64_t\n+f(int64_t a, int64_t b)\n+{\n+  return (int64_t)(int32_t)a * (int64_t)(int32_t)b;\n+}\n+\n+int\n+main()\n+{\n+  int64_t a = 0x1145140000000001;\n+  int64_t b = 0x1919810000000001;\n+  if (f(a, b) != 1)\n+    __builtin_abort();\n+}"}, {"sha": "4ab7df8836b48f9ba8d3c11456086c6d229a364d", "filename": "gcc/testsuite/gcc.target/loongarch/mulw_d_w.c", "status": "added", "additions": 10, "deletions": 0, "changes": 10, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/1fa42d62140b56589771eb3d46f89c810bfc8e0a/gcc%2Ftestsuite%2Fgcc.target%2Floongarch%2Fmulw_d_w.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/1fa42d62140b56589771eb3d46f89c810bfc8e0a/gcc%2Ftestsuite%2Fgcc.target%2Floongarch%2Fmulw_d_w.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgcc.target%2Floongarch%2Fmulw_d_w.c?ref=1fa42d62140b56589771eb3d46f89c810bfc8e0a", "patch": "@@ -0,0 +1,10 @@\n+/* { dg-do compile } */\n+/* { dg-options \"-O2 -mabi=lp64d\" } */\n+/* { dg-final { scan-assembler \"mulw.d.w\" } } */\n+\n+/* This should be optimized to mulw.d.w for LA64.  */\n+__attribute__((noipa, noinline)) long\n+f(long a, long b)\n+{\n+  return (long)(int)a * (long)(int)b;\n+}"}]}