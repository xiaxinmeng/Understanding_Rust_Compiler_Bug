{"sha": "1e7a269856fd67aff78ac874bec96d31a54b2fd9", "node_id": "C_kwDOANBUbNoAKDFlN2EyNjk4NTZmZDY3YWZmNzhhYzg3NGJlYzk2ZDMxYTU0YjJmZDk", "commit": {"author": {"name": "Jonathan Wakely", "email": "jwakely@redhat.com", "date": "2021-11-02T10:21:01Z"}, "committer": {"name": "Jonathan Wakely", "email": "jwakely@redhat.com", "date": "2021-11-03T15:15:27Z"}, "message": "libstdc++: Fix regression in std::list::sort [PR66742]\n\nThe standard does not require const-correct comparisons in list::sort.\n\nlibstdc++-v3/ChangeLog:\n\n\tPR libstdc++/66742\n\t* include/bits/list.tcc (list::sort): Use mutable iterators for\n\tcomparisons.\n\t* include/bits/stl_list.h (_Scratch_list::_Ptr_cmp): Likewise.\n\t* testsuite/23_containers/list/operations/66742.cc: Check\n\tnon-const comparisons.", "tree": {"sha": "e9cc14a9f05fd914b2710520d4574014b169ed55", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/e9cc14a9f05fd914b2710520d4574014b169ed55"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/1e7a269856fd67aff78ac874bec96d31a54b2fd9", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/1e7a269856fd67aff78ac874bec96d31a54b2fd9", "html_url": "https://github.com/Rust-GCC/gccrs/commit/1e7a269856fd67aff78ac874bec96d31a54b2fd9", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/1e7a269856fd67aff78ac874bec96d31a54b2fd9/comments", "author": {"login": "jwakely", "id": 1254480, "node_id": "MDQ6VXNlcjEyNTQ0ODA=", "avatar_url": "https://avatars.githubusercontent.com/u/1254480?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jwakely", "html_url": "https://github.com/jwakely", "followers_url": "https://api.github.com/users/jwakely/followers", "following_url": "https://api.github.com/users/jwakely/following{/other_user}", "gists_url": "https://api.github.com/users/jwakely/gists{/gist_id}", "starred_url": "https://api.github.com/users/jwakely/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jwakely/subscriptions", "organizations_url": "https://api.github.com/users/jwakely/orgs", "repos_url": "https://api.github.com/users/jwakely/repos", "events_url": "https://api.github.com/users/jwakely/events{/privacy}", "received_events_url": "https://api.github.com/users/jwakely/received_events", "type": "User", "site_admin": false}, "committer": {"login": "jwakely", "id": 1254480, "node_id": "MDQ6VXNlcjEyNTQ0ODA=", "avatar_url": "https://avatars.githubusercontent.com/u/1254480?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jwakely", "html_url": "https://github.com/jwakely", "followers_url": "https://api.github.com/users/jwakely/followers", "following_url": "https://api.github.com/users/jwakely/following{/other_user}", "gists_url": "https://api.github.com/users/jwakely/gists{/gist_id}", "starred_url": "https://api.github.com/users/jwakely/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jwakely/subscriptions", "organizations_url": "https://api.github.com/users/jwakely/orgs", "repos_url": "https://api.github.com/users/jwakely/repos", "events_url": "https://api.github.com/users/jwakely/events{/privacy}", "received_events_url": "https://api.github.com/users/jwakely/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "600dcd74b8e614c996b492d97878660faf484094", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/600dcd74b8e614c996b492d97878660faf484094", "html_url": "https://github.com/Rust-GCC/gccrs/commit/600dcd74b8e614c996b492d97878660faf484094"}], "stats": {"total": 35, "additions": 29, "deletions": 6}, "files": [{"sha": "cc750c98a2d81f85a648458ac6ee2625abc2b639", "filename": "libstdc++-v3/include/bits/list.tcc", "status": "modified", "additions": 2, "deletions": 2, "changes": 4, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/1e7a269856fd67aff78ac874bec96d31a54b2fd9/libstdc%2B%2B-v3%2Finclude%2Fbits%2Flist.tcc", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/1e7a269856fd67aff78ac874bec96d31a54b2fd9/libstdc%2B%2B-v3%2Finclude%2Fbits%2Flist.tcc", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libstdc%2B%2B-v3%2Finclude%2Fbits%2Flist.tcc?ref=1e7a269856fd67aff78ac874bec96d31a54b2fd9", "patch": "@@ -499,7 +499,7 @@ _GLIBCXX_BEGIN_NAMESPACE_CONTAINER\n \t_Scratch_list* __fill = __tmp;\n \t_Scratch_list* __counter;\n \n-\t_Scratch_list::_Ptr_cmp<const_iterator, void> __ptr_comp;\n+\t_Scratch_list::_Ptr_cmp<iterator, void> __ptr_comp;\n \n \t__try\n \t  {\n@@ -623,7 +623,7 @@ _GLIBCXX_BEGIN_NAMESPACE_CONTAINER\n \t  _Scratch_list* __fill = __tmp;\n \t  _Scratch_list* __counter;\n \n-\t_Scratch_list::_Ptr_cmp<const_iterator, _StrictWeakOrdering> __ptr_comp\n+\t_Scratch_list::_Ptr_cmp<iterator, _StrictWeakOrdering> __ptr_comp\n \t  = { __comp };\n \n \t  __try"}, {"sha": "ffaaa6dfd97d835383ac8651ccd0044258c51882", "filename": "libstdc++-v3/include/bits/stl_list.h", "status": "modified", "additions": 4, "deletions": 4, "changes": 8, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/1e7a269856fd67aff78ac874bec96d31a54b2fd9/libstdc%2B%2B-v3%2Finclude%2Fbits%2Fstl_list.h", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/1e7a269856fd67aff78ac874bec96d31a54b2fd9/libstdc%2B%2B-v3%2Finclude%2Fbits%2Fstl_list.h", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libstdc%2B%2B-v3%2Finclude%2Fbits%2Fstl_list.h?ref=1e7a269856fd67aff78ac874bec96d31a54b2fd9", "patch": "@@ -174,17 +174,17 @@ _GLIBCXX_BEGIN_NAMESPACE_VERSION\n \t  _Cmp _M_cmp;\n \n \t  bool\n-\t  operator()(const __detail::_List_node_base* __lhs,\n-\t\t     const __detail::_List_node_base* __rhs) /* not const */\n+\t  operator()(__detail::_List_node_base* __lhs,\n+\t\t     __detail::_List_node_base* __rhs) /* not const */\n \t  { return _M_cmp(*_Iter(__lhs), *_Iter(__rhs)); }\n \t};\n \n       template<typename _Iter>\n \tstruct _Ptr_cmp<_Iter, void>\n \t{\n \t  bool\n-\t  operator()(const __detail::_List_node_base* __lhs,\n-\t\t     const __detail::_List_node_base* __rhs) const\n+\t  operator()(__detail::_List_node_base* __lhs,\n+\t\t     __detail::_List_node_base* __rhs) const\n \t  { return *_Iter(__lhs) < *_Iter(__rhs); }\n \t};\n "}, {"sha": "94a37a31de7850f2bd1a0344176a367e4ab33d3d", "filename": "libstdc++-v3/testsuite/23_containers/list/operations/66742.cc", "status": "modified", "additions": 23, "deletions": 0, "changes": 23, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/1e7a269856fd67aff78ac874bec96d31a54b2fd9/libstdc%2B%2B-v3%2Ftestsuite%2F23_containers%2Flist%2Foperations%2F66742.cc", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/1e7a269856fd67aff78ac874bec96d31a54b2fd9/libstdc%2B%2B-v3%2Ftestsuite%2F23_containers%2Flist%2Foperations%2F66742.cc", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libstdc%2B%2B-v3%2Ftestsuite%2F23_containers%2Flist%2Foperations%2F66742.cc?ref=1e7a269856fd67aff78ac874bec96d31a54b2fd9", "patch": "@@ -48,8 +48,31 @@ test01()\n   VERIFY( is_sorted(l, std::greater<int>()) );\n }\n \n+void\n+test02()\n+{\n+  // The standard doesn't require comparisons to be const-correct.\n+  // The initial fix for PR 66742 caused a regression here.\n+\n+  struct X\n+  {\n+    bool operator<(X&) /* non-const */ { return false; }\n+  };\n+\n+  struct Cmp\n+  {\n+    bool operator()(X&, X&) /* non-const */ { return false; }\n+  };\n+\n+  std::list<X> l;\n+  l.sort();\n+  Cmp c;\n+  l.sort(c);\n+}\n+\n int\n main()\n {\n   test01();\n+  test02();\n }"}]}