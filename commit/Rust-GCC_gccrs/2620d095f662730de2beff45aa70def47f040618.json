{"sha": "2620d095f662730de2beff45aa70def47f040618", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6MjYyMGQwOTVmNjYyNzMwZGUyYmVmZjQ1YWE3MGRlZjQ3ZjA0MDYxOA==", "commit": {"author": {"name": "Kriang Lerdsuwanakij", "email": "lerdsuwa@users.sourceforge.net", "date": "2004-01-25T14:18:19Z"}, "committer": {"name": "Kriang Lerdsuwanakij", "email": "lerdsuwa@gcc.gnu.org", "date": "2004-01-25T14:18:19Z"}, "message": "re PR c++/13797 (ICE on invalid template parameter)\n\n\tPR c++/13797\n\t* pt.c (instantiate_class_template): Add an error_mark_node\n\tcheck.\n\t(tsubst_decl) <TEMPLATE_DECL case>: Likewise.\n\n\t* g++.dg/template/nontype4.C: New test.\n\t* g++.dg/template/nontype5.C: Likewise.\n\nFrom-SVN: r76556", "tree": {"sha": "398adcd2d521118bc33743e4e0cd721d12ff6b8a", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/398adcd2d521118bc33743e4e0cd721d12ff6b8a"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/2620d095f662730de2beff45aa70def47f040618", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/2620d095f662730de2beff45aa70def47f040618", "html_url": "https://github.com/Rust-GCC/gccrs/commit/2620d095f662730de2beff45aa70def47f040618", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/2620d095f662730de2beff45aa70def47f040618/comments", "author": null, "committer": null, "parents": [{"sha": "135f54eb848abc87511894692ee47866ebed247d", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/135f54eb848abc87511894692ee47866ebed247d", "html_url": "https://github.com/Rust-GCC/gccrs/commit/135f54eb848abc87511894692ee47866ebed247d"}], "stats": {"total": 48, "additions": 47, "deletions": 1}, "files": [{"sha": "fdb396f6b506b657ecb7ade254fa44ff4912f225", "filename": "gcc/cp/ChangeLog", "status": "modified", "additions": 7, "deletions": 0, "changes": 7, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/2620d095f662730de2beff45aa70def47f040618/gcc%2Fcp%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/2620d095f662730de2beff45aa70def47f040618/gcc%2Fcp%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fcp%2FChangeLog?ref=2620d095f662730de2beff45aa70def47f040618", "patch": "@@ -1,3 +1,10 @@\n+2003-01-25  Kriang Lerdsuwanakij  <lerdsuwa@users.sourceforge.net>\n+\n+\tPR c++/13797\n+\t* pt.c (instantiate_class_template): Add an error_mark_node\n+\tcheck.\n+\t(tsubst_decl) <TEMPLATE_DECL case>: Likewise.\n+\n 2004-01-23  Andrew Pinski  <pinskia@physics.uc.edu>\n \n \tPR c++/13701"}, {"sha": "2178e90e924bda2ed292d8430f30db37599f82c4", "filename": "gcc/cp/pt.c", "status": "modified", "additions": 6, "deletions": 1, "changes": 7, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/2620d095f662730de2beff45aa70def47f040618/gcc%2Fcp%2Fpt.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/2620d095f662730de2beff45aa70def47f040618/gcc%2Fcp%2Fpt.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fcp%2Fpt.c?ref=2620d095f662730de2beff45aa70def47f040618", "patch": "@@ -5370,7 +5370,9 @@ instantiate_class_template (tree type)\n \t      tree newtag;\n \n \t      newtag = tsubst (tag, args, tf_error, NULL_TREE);\n-\t      my_friendly_assert (newtag != error_mark_node, 20010206);\n+\t      if (newtag == error_mark_node)\n+\t\tcontinue;\n+\n \t      if (TREE_CODE (newtag) != ENUMERAL_TYPE)\n \t\t{\n \t\t  if (TYPE_LANG_SPECIFIC (tag) && CLASSTYPE_IS_TEMPLATE (tag))\n@@ -5902,6 +5904,9 @@ tsubst_decl (tree t, tree args, tree type, tsubst_flags_t complain)\n \tif (TREE_CODE (decl) == TYPE_DECL)\n \t  {\n \t    tree new_type = tsubst (TREE_TYPE (t), args, complain, in_decl);\n+\t    if (new_type == error_mark_node)\n+\t      return error_mark_node;\n+\n \t    TREE_TYPE (r) = new_type;\n \t    CLASSTYPE_TI_TEMPLATE (new_type) = r;\n \t    DECL_TEMPLATE_RESULT (r) = TYPE_MAIN_DECL (new_type);"}, {"sha": "0fd27b197fbf824349ea4b35e3d4fb3ed5e77cca", "filename": "gcc/testsuite/ChangeLog", "status": "modified", "additions": 6, "deletions": 0, "changes": 6, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/2620d095f662730de2beff45aa70def47f040618/gcc%2Ftestsuite%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/2620d095f662730de2beff45aa70def47f040618/gcc%2Ftestsuite%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2FChangeLog?ref=2620d095f662730de2beff45aa70def47f040618", "patch": "@@ -1,3 +1,9 @@\n+2003-01-25  Kriang Lerdsuwanakij  <lerdsuwa@users.sourceforge.net>\n+\n+\tPR c++/13797\n+\t* g++.dg/template/nontype4.C: New test.\n+\t* g++.dg/template/nontype5.C: Likewise.\n+\n 2004-01-25  Richard Sandiford  <rsandifo@redhat.com>\n \n \t* gcc.dg/torture/mips-clobber-at.c: New test."}, {"sha": "43ef2b0ce6b6fd3d96e64b26fce268d2446a5fa7", "filename": "gcc/testsuite/g++.dg/template/nontype4.C", "status": "added", "additions": 14, "deletions": 0, "changes": 14, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/2620d095f662730de2beff45aa70def47f040618/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Ftemplate%2Fnontype4.C", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/2620d095f662730de2beff45aa70def47f040618/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Ftemplate%2Fnontype4.C", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Ftemplate%2Fnontype4.C?ref=2620d095f662730de2beff45aa70def47f040618", "patch": "@@ -0,0 +1,14 @@\n+// { dg-do compile }\n+\n+// Origin: Ivan Godard <igodard@pacbell.net>\n+//\t   Volker Reichelt <reichelt@gcc.gnu.org>\n+\n+// PR c++/13797: ICE invalid nontype template parameter\n+\n+template <int> struct A\n+{\n+    typedef A<0> B;\t\t// { dg-error \"not a valid type|conflict\" }\n+    template <B> struct B {};\t// { dg-error \"not a valid type|declaration\" }\n+};\n+\n+A<0> a;\t\t\t\t// { dg-error \"instantiated\" }"}, {"sha": "e53b6c1a6548ac969ae77edd2ca0f05a9d107d6c", "filename": "gcc/testsuite/g++.dg/template/nontype5.C", "status": "added", "additions": 14, "deletions": 0, "changes": 14, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/2620d095f662730de2beff45aa70def47f040618/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Ftemplate%2Fnontype5.C", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/2620d095f662730de2beff45aa70def47f040618/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Ftemplate%2Fnontype5.C", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Ftemplate%2Fnontype5.C?ref=2620d095f662730de2beff45aa70def47f040618", "patch": "@@ -0,0 +1,14 @@\n+// { dg-do compile }\n+\n+// Origin: Ivan Godard <igodard@pacbell.net>\n+//\t   Volker Reichelt <reichelt@gcc.gnu.org>\n+\n+// PR c++/13797: ICE invalid nontype template parameter\n+\n+template <int> struct A\n+{\n+    typedef A<0> B;\n+    template <B> struct C {};\t// { dg-error \"not a valid type\" }\n+};\n+\n+A<0> a;\t\t\t\t// { dg-error \"instantiated\" }"}]}