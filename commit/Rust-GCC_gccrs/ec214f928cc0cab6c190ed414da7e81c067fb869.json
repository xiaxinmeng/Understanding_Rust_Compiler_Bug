{"sha": "ec214f928cc0cab6c190ed414da7e81c067fb869", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6ZWMyMTRmOTI4Y2MwY2FiNmMxOTBlZDQxNGRhN2U4MWMwNjdmYjg2OQ==", "commit": {"author": {"name": "Martin Liska", "email": "marxin@gcc.gnu.org", "date": "2018-04-17T05:41:40Z"}, "committer": {"name": "Martin Liska", "email": "marxin@gcc.gnu.org", "date": "2018-04-17T05:41:40Z"}, "message": "Support bitfields in Wodr machinery (PR lto/85405).\n\n2018-04-17  Jan Hubicka  <jh@suse.cz>\n\n\tPR lto/85405\n\t* ipa-devirt.c (odr_types_equivalent_p): Handle bit fields.\n2018-04-17  Martin Liska  <mliska@suse.cz>\n\n\tPR lto/85405\n\t* g++.dg/lto/pr85405_0.C: New test.\n\t* g++.dg/lto/pr85405_1.C: New test.\n\nFrom-SVN: r259429", "tree": {"sha": "b4b0f0f4ed99857559052fca2b08986438aafcf3", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/b4b0f0f4ed99857559052fca2b08986438aafcf3"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/ec214f928cc0cab6c190ed414da7e81c067fb869", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/ec214f928cc0cab6c190ed414da7e81c067fb869", "html_url": "https://github.com/Rust-GCC/gccrs/commit/ec214f928cc0cab6c190ed414da7e81c067fb869", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/ec214f928cc0cab6c190ed414da7e81c067fb869/comments", "author": null, "committer": null, "parents": [{"sha": "646cf2527541fb8928deee0d7eda9ca75a591328", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/646cf2527541fb8928deee0d7eda9ca75a591328", "html_url": "https://github.com/Rust-GCC/gccrs/commit/646cf2527541fb8928deee0d7eda9ca75a591328"}], "stats": {"total": 49, "additions": 47, "deletions": 2}, "files": [{"sha": "4ba0f0f57fa673b4d0b57ecb18485b2e7ed720f1", "filename": "gcc/ChangeLog", "status": "modified", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/ec214f928cc0cab6c190ed414da7e81c067fb869/gcc%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/ec214f928cc0cab6c190ed414da7e81c067fb869/gcc%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2FChangeLog?ref=ec214f928cc0cab6c190ed414da7e81c067fb869", "patch": "@@ -1,3 +1,8 @@\n+2018-04-17  Jan Hubicka  <jh@suse.cz>\n+\n+\tPR lto/85405\n+\t* ipa-devirt.c (odr_types_equivalent_p): Handle bit fields.\n+\n 2018-04-17  Martin Liska  <mliska@suse.cz>\n \n \tPR ipa/85329"}, {"sha": "5da0f72d14f3a65883c3a30d14c1bd3e39cf92b5", "filename": "gcc/ipa-devirt.c", "status": "modified", "additions": 9, "deletions": 2, "changes": 11, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/ec214f928cc0cab6c190ed414da7e81c067fb869/gcc%2Fipa-devirt.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/ec214f928cc0cab6c190ed414da7e81c067fb869/gcc%2Fipa-devirt.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fipa-devirt.c?ref=ec214f928cc0cab6c190ed414da7e81c067fb869", "patch": "@@ -1587,8 +1587,15 @@ odr_types_equivalent_p (tree t1, tree t2, bool warn, bool *warned,\n \t\t\t\t \"in another translation unit\"));\n \t\t    return false;\n \t\t  }\n-\t\tgcc_assert (DECL_NONADDRESSABLE_P (f1)\n-\t\t\t    == DECL_NONADDRESSABLE_P (f2));\n+\t\tif (DECL_BIT_FIELD (f1) != DECL_BIT_FIELD (f2))\n+\t\t  {\n+\t\t    warn_odr (t1, t2, f1, f2, warn, warned,\n+\t\t\t      G_ (\"one field is bitfield while other is not \"));\n+\t\t    return false;\n+\t\t  }\n+\t\telse\n+\t\t  gcc_assert (DECL_NONADDRESSABLE_P (f1)\n+\t\t\t      == DECL_NONADDRESSABLE_P (f2));\n \t      }\n \n \t    /* If one aggregate has more fields than the other, they"}, {"sha": "23c519efcf1cb4dd07f88056abb94e8b0c37db83", "filename": "gcc/testsuite/ChangeLog", "status": "modified", "additions": 6, "deletions": 0, "changes": 6, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/ec214f928cc0cab6c190ed414da7e81c067fb869/gcc%2Ftestsuite%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/ec214f928cc0cab6c190ed414da7e81c067fb869/gcc%2Ftestsuite%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2FChangeLog?ref=ec214f928cc0cab6c190ed414da7e81c067fb869", "patch": "@@ -1,3 +1,9 @@\n+2018-04-17  Martin Liska  <mliska@suse.cz>\n+\n+\tPR lto/85405\n+\t* g++.dg/lto/pr85405_0.C: New test.\n+\t* g++.dg/lto/pr85405_1.C: New test.\n+\n 2018-04-17  Martin Liska  <mliska@suse.cz>\n \n \tPR ipa/85329"}, {"sha": "1a41d81099c5aa964d00078f235ea2e2eeb12702", "filename": "gcc/testsuite/g++.dg/lto/pr85405_0.C", "status": "added", "additions": 18, "deletions": 0, "changes": 18, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/ec214f928cc0cab6c190ed414da7e81c067fb869/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Flto%2Fpr85405_0.C", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/ec214f928cc0cab6c190ed414da7e81c067fb869/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Flto%2Fpr85405_0.C", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Flto%2Fpr85405_0.C?ref=ec214f928cc0cab6c190ed414da7e81c067fb869", "patch": "@@ -0,0 +1,18 @@\n+// { dg-lto-do link }\n+// { dg-lto-options {{-fPIC -shared -flto}} }\n+\n+class VclReferenceBase { // { dg-lto-warning \"7: type 'struct VclReferenceBase' violates the C\\\\+\\\\+ One Definition Rule\" }\n+  int mnRefCnt;\n+  bool mbDisposed : 1;\n+  virtual ~VclReferenceBase();\n+};\n+class a;\n+class b {\n+  a &e;\n+  bool c();\n+};\n+class B {\n+  VclReferenceBase d;\n+};\n+class a : B {};\n+bool b::c() { return false; }"}, {"sha": "78606185624f1403442e43ece83076f6703ece30", "filename": "gcc/testsuite/g++.dg/lto/pr85405_1.C", "status": "added", "additions": 9, "deletions": 0, "changes": 9, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/ec214f928cc0cab6c190ed414da7e81c067fb869/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Flto%2Fpr85405_1.C", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/ec214f928cc0cab6c190ed414da7e81c067fb869/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Flto%2Fpr85405_1.C", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Flto%2Fpr85405_1.C?ref=ec214f928cc0cab6c190ed414da7e81c067fb869", "patch": "@@ -0,0 +1,9 @@\n+class VclReferenceBase {\n+  int mnRefCnt;\n+  bool mbDisposed;\n+\n+protected:\n+  virtual ~VclReferenceBase();\n+};\n+class : VclReferenceBase {\n+} a;"}]}