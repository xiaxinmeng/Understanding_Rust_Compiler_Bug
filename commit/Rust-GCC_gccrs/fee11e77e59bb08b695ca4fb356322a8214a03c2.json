{"sha": "fee11e77e59bb08b695ca4fb356322a8214a03c2", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6ZmVlMTFlNzdlNTliYjA4YjY5NWNhNGZiMzU2MzIyYTgyMTRhMDNjMg==", "commit": {"author": {"name": "Paolo Carlini", "email": "paolo.carlini@oracle.com", "date": "2018-12-07T17:48:39Z"}, "committer": {"name": "Paolo Carlini", "email": "paolo@gcc.gnu.org", "date": "2018-12-07T17:48:39Z"}, "message": "decl2.c (grokbitfield): Use DECL_SOURCE_LOCATION in error messages about bit-fields with function type...\n\n/cp\n2018-12-07  Paolo Carlini  <paolo.carlini@oracle.com>\n\n\t* decl2.c (grokbitfield): Use DECL_SOURCE_LOCATION in error messages\n\tabout bit-fields with function type, warn_if_not_aligned type, and\n\tstatic bit-fields; avoid DECL_NAME for unnamed declarations.\n\n/testsuite\n2018-12-07  Paolo Carlini  <paolo.carlini@oracle.com>\n\n\t* g++.dg/other/bitfield7.C: New.\n\t* g++.dg/parse/bitfield8.C: Likewise.\n\t* g++.dg/parse/bitfield9.C: Likewise.\n\t* g++.dg/pr53037-4.C: Test the locations too.\n\nFrom-SVN: r266900", "tree": {"sha": "f24d1372131fa2548e34bf3e90ac769722bf308a", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/f24d1372131fa2548e34bf3e90ac769722bf308a"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/fee11e77e59bb08b695ca4fb356322a8214a03c2", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/fee11e77e59bb08b695ca4fb356322a8214a03c2", "html_url": "https://github.com/Rust-GCC/gccrs/commit/fee11e77e59bb08b695ca4fb356322a8214a03c2", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/fee11e77e59bb08b695ca4fb356322a8214a03c2/comments", "author": null, "committer": null, "parents": [{"sha": "96e14fda0dca4d79479137844b4457305fad2c3f", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/96e14fda0dca4d79479137844b4457305fad2c3f", "html_url": "https://github.com/Rust-GCC/gccrs/commit/96e14fda0dca4d79479137844b4457305fad2c3f"}], "stats": {"total": 47, "additions": 39, "deletions": 8}, "files": [{"sha": "fc22f206606b97794afd54107b71a8f81d96bc2b", "filename": "gcc/cp/ChangeLog", "status": "modified", "additions": 6, "deletions": 0, "changes": 6, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/fee11e77e59bb08b695ca4fb356322a8214a03c2/gcc%2Fcp%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/fee11e77e59bb08b695ca4fb356322a8214a03c2/gcc%2Fcp%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fcp%2FChangeLog?ref=fee11e77e59bb08b695ca4fb356322a8214a03c2", "patch": "@@ -1,3 +1,9 @@\n+2018-12-07  Paolo Carlini  <paolo.carlini@oracle.com>\n+\n+\t* decl2.c (grokbitfield): Use DECL_SOURCE_LOCATION in error messages\n+\tabout bit-fields with function type, warn_if_not_aligned type, and\n+\tstatic bit-fields; avoid DECL_NAME for unnamed declarations.\n+\n 2018-12-07  Jakub Jelinek  <jakub@redhat.com>\n \n \tPR c++/86669"}, {"sha": "a8bf28a0cd954a9f2de0837546e43f4fcfb4e590", "filename": "gcc/cp/decl2.c", "status": "modified", "additions": 7, "deletions": 6, "changes": 13, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/fee11e77e59bb08b695ca4fb356322a8214a03c2/gcc%2Fcp%2Fdecl2.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/fee11e77e59bb08b695ca4fb356322a8214a03c2/gcc%2Fcp%2Fdecl2.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fcp%2Fdecl2.c?ref=fee11e77e59bb08b695ca4fb356322a8214a03c2", "patch": "@@ -1046,15 +1046,15 @@ grokbitfield (const cp_declarator *declarator,\n      check here.  */\n   if (TREE_CODE (value) == FUNCTION_DECL)\n     {\n-      error (\"cannot declare bit-field %qD with function type\",\n-\t     DECL_NAME (value));\n+      error_at (DECL_SOURCE_LOCATION (value),\n+\t\t\"cannot declare bit-field %qD with function type\", value);\n       return NULL_TREE;\n     }\n \n-  if (width && TYPE_WARN_IF_NOT_ALIGN (type))\n+  if (TYPE_WARN_IF_NOT_ALIGN (type))\n     {\n-      error (\"cannot declare bit-field %qD with %<warn_if_not_aligned%> type\",\n-\t     DECL_NAME (value));\n+      error_at (DECL_SOURCE_LOCATION (value), \"cannot declare bit-field \"\n+\t\t\"%qD with %<warn_if_not_aligned%> type\", value);\n       return NULL_TREE;\n     }\n \n@@ -1067,7 +1067,8 @@ grokbitfield (const cp_declarator *declarator,\n \n   if (TREE_STATIC (value))\n     {\n-      error (\"static member %qD cannot be a bit-field\", value);\n+      error_at (DECL_SOURCE_LOCATION (value),\n+\t\t\"static member %qD cannot be a bit-field\", value);\n       return NULL_TREE;\n     }\n "}, {"sha": "afa3d70534a84ce0d85e25e9838fd2918d2fe822", "filename": "gcc/testsuite/ChangeLog", "status": "modified", "additions": 7, "deletions": 0, "changes": 7, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/fee11e77e59bb08b695ca4fb356322a8214a03c2/gcc%2Ftestsuite%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/fee11e77e59bb08b695ca4fb356322a8214a03c2/gcc%2Ftestsuite%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2FChangeLog?ref=fee11e77e59bb08b695ca4fb356322a8214a03c2", "patch": "@@ -1,3 +1,10 @@\n+2018-12-07  Paolo Carlini  <paolo.carlini@oracle.com>\n+\n+\t* g++.dg/other/bitfield7.C: New.\n+\t* g++.dg/parse/bitfield8.C: Likewise.\n+\t* g++.dg/parse/bitfield9.C: Likewise.\n+\t* g++.dg/pr53037-4.C: Test the locations too.\n+\n 2018-12-07  Peter Bergner  <bergner@linux.ibm.com>\n \n \tPR target/87496"}, {"sha": "fa13662758c2b5cb4de622f8555ddccc4463a938", "filename": "gcc/testsuite/g++.dg/other/bitfield7.C", "status": "added", "additions": 7, "deletions": 0, "changes": 7, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/fee11e77e59bb08b695ca4fb356322a8214a03c2/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Fother%2Fbitfield7.C", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/fee11e77e59bb08b695ca4fb356322a8214a03c2/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Fother%2Fbitfield7.C", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Fother%2Fbitfield7.C?ref=fee11e77e59bb08b695ca4fb356322a8214a03c2", "patch": "@@ -0,0 +1,7 @@\n+typedef int __attribute__((warn_if_not_aligned(8))) intwna;\n+\n+struct S\n+{\n+  intwna : 2;  // { dg-error \"cannot declare bit-field\" }\n+  intwna i : 2;  // { dg-error \"10:cannot declare bit-field .i.\" }\n+};"}, {"sha": "19b862cc217c8b4d049eabbfa0a3b7f7abacad21", "filename": "gcc/testsuite/g++.dg/parse/bitfield8.C", "status": "added", "additions": 4, "deletions": 0, "changes": 4, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/fee11e77e59bb08b695ca4fb356322a8214a03c2/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Fparse%2Fbitfield8.C", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/fee11e77e59bb08b695ca4fb356322a8214a03c2/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Fparse%2Fbitfield8.C", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Fparse%2Fbitfield8.C?ref=fee11e77e59bb08b695ca4fb356322a8214a03c2", "patch": "@@ -0,0 +1,4 @@\n+struct A\n+{\n+  static int a : 1;  // { dg-error \"14:static member .a. cannot be a bit-field\" }\n+};"}, {"sha": "5256d2ca4ed4887e6946aaccf171310d4e08f530", "filename": "gcc/testsuite/g++.dg/parse/bitfield9.C", "status": "added", "additions": 6, "deletions": 0, "changes": 6, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/fee11e77e59bb08b695ca4fb356322a8214a03c2/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Fparse%2Fbitfield9.C", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/fee11e77e59bb08b695ca4fb356322a8214a03c2/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Fparse%2Fbitfield9.C", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Fparse%2Fbitfield9.C?ref=fee11e77e59bb08b695ca4fb356322a8214a03c2", "patch": "@@ -0,0 +1,6 @@\n+template<typename T>\n+struct A\n+{\n+  typedef T type();\n+  type i : 2;  // { dg-error \"8:cannot declare bit-field\" }\n+};"}, {"sha": "f73f35f82371ed54166076f141984321a4244e80", "filename": "gcc/testsuite/g++.dg/pr53037-4.C", "status": "modified", "additions": 2, "deletions": 2, "changes": 4, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/fee11e77e59bb08b695ca4fb356322a8214a03c2/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Fpr53037-4.C", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/fee11e77e59bb08b695ca4fb356322a8214a03c2/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Fpr53037-4.C", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Fpr53037-4.C?ref=fee11e77e59bb08b695ca4fb356322a8214a03c2", "patch": "@@ -12,13 +12,13 @@ foo2 (void) /* { dg-error \"'warn_if_not_aligned' may not be specified for 'void\n \n struct foo3\n {\n-  int i : 2 __attribute__((warn_if_not_aligned(8))); /* { dg-error \"'warn_if_not_aligned' may not be specified for 'i'\" } */\n+  int i : 2 __attribute__((warn_if_not_aligned(8))); /* { dg-error \"7:'warn_if_not_aligned' may not be specified for 'i'\" } */\n };\n \n typedef unsigned int __u32\n   __attribute__((aligned(4),warn_if_not_aligned(8)));\n \n struct foo4\n {\n-  __u32 i : 2; /* { dg-error \"cannot declare bit-field 'i' with 'warn_if_not_aligned' type\" } */\n+  __u32 i : 2; /* { dg-error \"9:cannot declare bit-field 'i' with 'warn_if_not_aligned' type\" } */\n };"}]}