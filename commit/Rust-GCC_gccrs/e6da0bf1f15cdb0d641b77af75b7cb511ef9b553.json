{"sha": "e6da0bf1f15cdb0d641b77af75b7cb511ef9b553", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6ZTZkYTBiZjFmMTVjZGIwZDY0MWI3N2FmNzViN2NiNTExZWY5YjU1Mw==", "commit": {"author": {"name": "Paolo Carlini", "email": "paolo@gcc.gnu.org", "date": "2019-03-18T09:38:27Z"}, "committer": {"name": "Paolo Carlini", "email": "paolo@gcc.gnu.org", "date": "2019-03-18T09:38:27Z"}, "message": "re PR c++/85014 (internal compiler error: in lookup_base, at cp/search.c:185)\n\n/cp\n2019-03-18  Paolo Carlini  <paolo.carlini@oracle.com>\n\n\tPR c++/85014\n\t* semantics.c (finish_non_static_data_member): Check return value\n\tof context_for_name_lookup and immediately return error_mark_node\n\tif isn't a type.\n\n/testsuite\n2019-03-18  Paolo Carlini  <paolo.carlini@oracle.com>\n\n\tPR c++/85014\n\t* g++.dg/cpp0x/pr85014.C: New.\n\nFrom-SVN: r269759", "tree": {"sha": "c1e1a5e5d1027ca35f0cbbb2b6b32c48d0d91f68", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/c1e1a5e5d1027ca35f0cbbb2b6b32c48d0d91f68"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/e6da0bf1f15cdb0d641b77af75b7cb511ef9b553", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/e6da0bf1f15cdb0d641b77af75b7cb511ef9b553", "html_url": "https://github.com/Rust-GCC/gccrs/commit/e6da0bf1f15cdb0d641b77af75b7cb511ef9b553", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/e6da0bf1f15cdb0d641b77af75b7cb511ef9b553/comments", "author": null, "committer": null, "parents": [{"sha": "f5d56cf957f9235d43f4dc4cec511b042e0b18de", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/f5d56cf957f9235d43f4dc4cec511b042e0b18de", "html_url": "https://github.com/Rust-GCC/gccrs/commit/f5d56cf957f9235d43f4dc4cec511b042e0b18de"}], "stats": {"total": 37, "additions": 34, "deletions": 3}, "files": [{"sha": "fa569bc1a611f41c04a3b8d8b04bd0b5d7e55173", "filename": "gcc/cp/ChangeLog", "status": "modified", "additions": 7, "deletions": 0, "changes": 7, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/e6da0bf1f15cdb0d641b77af75b7cb511ef9b553/gcc%2Fcp%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/e6da0bf1f15cdb0d641b77af75b7cb511ef9b553/gcc%2Fcp%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fcp%2FChangeLog?ref=e6da0bf1f15cdb0d641b77af75b7cb511ef9b553", "patch": "@@ -1,3 +1,10 @@\n+2019-03-18  Paolo Carlini  <paolo.carlini@oracle.com>\n+\n+\tPR c++/85014\n+\t* semantics.c (finish_non_static_data_member): Check return value\n+\tof context_for_name_lookup and immediately return error_mark_node\n+\tif isn't a type.\n+\n 2019-03-17  Jason Merrill  <jason@redhat.com>\n \n \tPR c++/89571 - ICE with ill-formed noexcept on constructor."}, {"sha": "599e0e39d4e9d6708d2ae2ddae7568ab51da2143", "filename": "gcc/cp/semantics.c", "status": "modified", "additions": 9, "deletions": 1, "changes": 10, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/e6da0bf1f15cdb0d641b77af75b7cb511ef9b553/gcc%2Fcp%2Fsemantics.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/e6da0bf1f15cdb0d641b77af75b7cb511ef9b553/gcc%2Fcp%2Fsemantics.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fcp%2Fsemantics.c?ref=e6da0bf1f15cdb0d641b77af75b7cb511ef9b553", "patch": "@@ -1828,7 +1828,15 @@ finish_non_static_data_member (tree decl, tree object, tree qualifying_scope)\n     {\n       tree scope = qualifying_scope;\n       if (scope == NULL_TREE)\n-\tscope = context_for_name_lookup (decl);\n+\t{\n+\t  scope = context_for_name_lookup (decl);\n+\t  if (!TYPE_P (scope))\n+\t    {\n+\t      /* Can happen during error recovery (c++/85014).  */\n+\t      gcc_assert (seen_error ());\n+\t      return error_mark_node;\n+\t    }\n+\t}\n       object = maybe_dummy_object (scope, NULL);\n     }\n "}, {"sha": "30014e6ed28d85f778a63a16cef66042a55fc9a4", "filename": "gcc/testsuite/ChangeLog", "status": "modified", "additions": 8, "deletions": 2, "changes": 10, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/e6da0bf1f15cdb0d641b77af75b7cb511ef9b553/gcc%2Ftestsuite%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/e6da0bf1f15cdb0d641b77af75b7cb511ef9b553/gcc%2Ftestsuite%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2FChangeLog?ref=e6da0bf1f15cdb0d641b77af75b7cb511ef9b553", "patch": "@@ -1,3 +1,8 @@\n+2019-03-18  Paolo Carlini  <paolo.carlini@oracle.com>\n+\n+\tPR c++/85014\n+\t* g++.dg/cpp0x/pr85014.C: New.\n+\n 2019-03-18  Jakub Jelinek  <jakub@redhat.com>\n \n \tPR middle-end/86979\n@@ -6,11 +11,12 @@\n 2019-03-17  Thomas Koenig  <tkoenig@gcc.gnu.org>\n \n \tPR fortran/88008\n-\t * gfortran.dg/typebound_call_31.f90: New test.\n+\t* gfortran.dg/typebound_call_31.f90: New test.\n \n 2019-03-03-17  John David Anglin  <danglin@gcc.gnu.org>\n \n-\t* gcc.dg/compat/pr83487-1_x.c: Use -fno-common option on hppa*-*-hpux*.\n+\t* gcc.dg/compat/pr83487-1_x.c: Use -fno-common option on\n+\thppa*-*-hpux*.\n \t* gcc.dg/compat/pr83487-1_y.c: Likewise.\n \n \t* gfortran.dg/pointer_init_10.f90: Require visibility support."}, {"sha": "0a3b241cebd902db746fc52d589c2296b25008af", "filename": "gcc/testsuite/g++.dg/cpp0x/pr85014.C", "status": "added", "additions": 10, "deletions": 0, "changes": 10, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/e6da0bf1f15cdb0d641b77af75b7cb511ef9b553/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Fcpp0x%2Fpr85014.C", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/e6da0bf1f15cdb0d641b77af75b7cb511ef9b553/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Fcpp0x%2Fpr85014.C", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Fcpp0x%2Fpr85014.C?ref=e6da0bf1f15cdb0d641b77af75b7cb511ef9b553", "patch": "@@ -0,0 +1,10 @@\n+// { dg-do compile { target c++11 } }\n+// { dg-options \"\" }\n+\n+struct {\n+  short a[__builtin_constant_p([] {\n+    struct {\n+      int b = b;\n+      };  // { dg-error \"abstract declarator\" }\n+  })];\n+};  // { dg-error \"abstract declarator\" }"}]}