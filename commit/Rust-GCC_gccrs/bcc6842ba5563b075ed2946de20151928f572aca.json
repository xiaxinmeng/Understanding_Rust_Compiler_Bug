{"sha": "bcc6842ba5563b075ed2946de20151928f572aca", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6YmNjNjg0MmJhNTU2M2IwNzVlZDI5NDZkZTIwMTUxOTI4ZjU3MmFjYQ==", "commit": {"author": {"name": "Jakub Jelinek", "email": "jakub@redhat.com", "date": "2017-09-05T21:31:39Z"}, "committer": {"name": "Jakub Jelinek", "email": "jakub@gcc.gnu.org", "date": "2017-09-05T21:31:39Z"}, "message": "re PR middle-end/81768 (error: control flow in the middle of basic block)\n\n\tPR middle-end/81768\n\t* omp-expand.c (expand_omp_simd): Force second operands of COND_EXPR\n\tinto gimple val before gimplification fo the COND_EXPR.\n\n\t* gcc.dg/gomp/pr81768-1.c: New test.\n\nFrom-SVN: r251741", "tree": {"sha": "ead300eac786b1112032ec3f8f02984e27c3cb62", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/ead300eac786b1112032ec3f8f02984e27c3cb62"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/bcc6842ba5563b075ed2946de20151928f572aca", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/bcc6842ba5563b075ed2946de20151928f572aca", "html_url": "https://github.com/Rust-GCC/gccrs/commit/bcc6842ba5563b075ed2946de20151928f572aca", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/bcc6842ba5563b075ed2946de20151928f572aca/comments", "author": {"login": "jakubjelinek", "id": 9370665, "node_id": "MDQ6VXNlcjkzNzA2NjU=", "avatar_url": "https://avatars.githubusercontent.com/u/9370665?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jakubjelinek", "html_url": "https://github.com/jakubjelinek", "followers_url": "https://api.github.com/users/jakubjelinek/followers", "following_url": "https://api.github.com/users/jakubjelinek/following{/other_user}", "gists_url": "https://api.github.com/users/jakubjelinek/gists{/gist_id}", "starred_url": "https://api.github.com/users/jakubjelinek/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jakubjelinek/subscriptions", "organizations_url": "https://api.github.com/users/jakubjelinek/orgs", "repos_url": "https://api.github.com/users/jakubjelinek/repos", "events_url": "https://api.github.com/users/jakubjelinek/events{/privacy}", "received_events_url": "https://api.github.com/users/jakubjelinek/received_events", "type": "User", "site_admin": false}, "committer": null, "parents": [{"sha": "3d178f0c0c800997a69d8e2824c9cc8148a89549", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/3d178f0c0c800997a69d8e2824c9cc8148a89549", "html_url": "https://github.com/Rust-GCC/gccrs/commit/3d178f0c0c800997a69d8e2824c9cc8148a89549"}], "stats": {"total": 38, "additions": 34, "deletions": 4}, "files": [{"sha": "95ecb3cd8544b24071ab0abc847d64554407a0a2", "filename": "gcc/ChangeLog", "status": "modified", "additions": 6, "deletions": 0, "changes": 6, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/bcc6842ba5563b075ed2946de20151928f572aca/gcc%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/bcc6842ba5563b075ed2946de20151928f572aca/gcc%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2FChangeLog?ref=bcc6842ba5563b075ed2946de20151928f572aca", "patch": "@@ -1,3 +1,9 @@\n+2017-09-05  Jakub Jelinek  <jakub@redhat.com>\n+\n+\tPR middle-end/81768\n+\t* omp-expand.c (expand_omp_simd): Force second operands of COND_EXPR\n+\tinto gimple val before gimplification fo the COND_EXPR.\n+\n 2017-09-05  Aldy Hernandez  <aldyh@redhat.com>\n \n \t* tree-ssa-threadupdate.c (duplicate_thread_path): Remove unused"}, {"sha": "4bdcf19ef64cd08b0cd492b00c111cf2705b0555", "filename": "gcc/omp-expand.c", "status": "modified", "additions": 8, "deletions": 4, "changes": 12, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/bcc6842ba5563b075ed2946de20151928f572aca/gcc%2Fomp-expand.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/bcc6842ba5563b075ed2946de20151928f572aca/gcc%2Fomp-expand.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fomp-expand.c?ref=bcc6842ba5563b075ed2946de20151928f572aca", "patch": "@@ -4730,24 +4730,28 @@ expand_omp_simd (struct omp_region *region, struct omp_for_data *fd)\n \t      tree itype2 = TREE_TYPE (fd->loops[i - 1].v);\n \t      if (POINTER_TYPE_P (itype2))\n \t\titype2 = signed_type_for (itype2);\n+\t      t = fold_convert (itype2, fd->loops[i - 1].step);\n+\t      t = force_gimple_operand_gsi (&gsi, t, true, NULL_TREE, true,\n+\t\t\t\t\t    GSI_SAME_STMT);\n \t      t = build3 (COND_EXPR, itype2,\n \t\t\t  build2 (fd->loops[i].cond_code, boolean_type_node,\n \t\t\t\t  fd->loops[i].v,\n \t\t\t\t  fold_convert (itype, fd->loops[i].n2)),\n-\t\t\t  build_int_cst (itype2, 0),\n-\t\t\t  fold_convert (itype2, fd->loops[i - 1].step));\n+\t\t\t  build_int_cst (itype2, 0), t);\n \t      if (POINTER_TYPE_P (TREE_TYPE (fd->loops[i - 1].v)))\n \t\tt = fold_build_pointer_plus (fd->loops[i - 1].v, t);\n \t      else\n \t\tt = fold_build2 (PLUS_EXPR, itype2, fd->loops[i - 1].v, t);\n \t      expand_omp_build_assign (&gsi, fd->loops[i - 1].v, t);\n \n+\t      t = fold_convert (itype, fd->loops[i].n1);\n+\t      t = force_gimple_operand_gsi (&gsi, t, true, NULL_TREE, true,\n+\t\t\t\t\t    GSI_SAME_STMT);\n \t      t = build3 (COND_EXPR, itype,\n \t\t\t  build2 (fd->loops[i].cond_code, boolean_type_node,\n \t\t\t\t  fd->loops[i].v,\n \t\t\t\t  fold_convert (itype, fd->loops[i].n2)),\n-\t\t\t  fd->loops[i].v,\n-\t\t\t  fold_convert (itype, fd->loops[i].n1));\n+\t\t\t  fd->loops[i].v, t);\n \t      expand_omp_build_assign (&gsi, fd->loops[i].v, t);\n \t    }\n \t}"}, {"sha": "e470ff150ae3cb3d0104ea78ad319c9653eb1e7f", "filename": "gcc/testsuite/ChangeLog", "status": "modified", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/bcc6842ba5563b075ed2946de20151928f572aca/gcc%2Ftestsuite%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/bcc6842ba5563b075ed2946de20151928f572aca/gcc%2Ftestsuite%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2FChangeLog?ref=bcc6842ba5563b075ed2946de20151928f572aca", "patch": "@@ -1,3 +1,8 @@\n+2017-09-05  Jakub Jelinek  <jakub@redhat.com>\n+\n+\tPR middle-end/81768\n+\t* gcc.dg/gomp/pr81768-1.c: New test.\n+\n 2017-09-05  Bill Schmidt  <wschmidt@linux.vnet.ibm.com>\n \n \tPR target/81833"}, {"sha": "3b8c26a23ec8ad7ff0ec2f5887763cf0dfe418aa", "filename": "gcc/testsuite/gcc.dg/gomp/pr81768-1.c", "status": "added", "additions": 15, "deletions": 0, "changes": 15, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/bcc6842ba5563b075ed2946de20151928f572aca/gcc%2Ftestsuite%2Fgcc.dg%2Fgomp%2Fpr81768-1.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/bcc6842ba5563b075ed2946de20151928f572aca/gcc%2Ftestsuite%2Fgcc.dg%2Fgomp%2Fpr81768-1.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgcc.dg%2Fgomp%2Fpr81768-1.c?ref=bcc6842ba5563b075ed2946de20151928f572aca", "patch": "@@ -0,0 +1,15 @@\n+/* PR middle-end/81768 */\n+/* { dg-do compile } */\n+\n+float b[10][15][10];\n+\n+void\n+foo (void)\n+{\n+  float *i;\n+#pragma omp target parallel for simd schedule(static, 32) collapse(3)\n+  for (i = &b[0][0][0]; i < &b[0][0][10]; i++)\n+    for (float *j = &b[0][15][0]; j > &b[0][0][0]; j -= 10)\n+      for (float *k = &b[0][0][10]; k > &b[0][0][0]; --k)\n+\tb[i - &b[0][0][0]][(j - &b[0][0][0]) / 10 - 1][(k - &b[0][0][0]) - 1] -= 3.5;\n+}"}]}