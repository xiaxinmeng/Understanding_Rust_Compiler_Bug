{"sha": "e5b1f5a1d11f73ff289ffebfeccbc0650531367b", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6ZTViMWY1YTFkMTFmNzNmZjI4OWZmZWJmZWNjYmMwNjUwNTMxMzY3Yg==", "commit": {"author": {"name": "Fritz Reese", "email": "fritzoreese@gmail.com", "date": "2017-05-17T15:13:58Z"}, "committer": {"name": "Fritz Reese", "email": "foreese@gcc.gnu.org", "date": "2017-05-17T15:13:58Z"}, "message": "re PR fortran/80668 (wrong error message with -finit-derived)\n\n2017-05-17  Fritz Reese <fritzoreese@gmail.com>\n\n    PR fortran/80668\n\n    gcc/fortran/ChangeLog:\n\n\tPR fortran/80668\n\t* expr.c (component_initializer): Don't generate initializers for\n\tpointer components.\n\t* invoke.texi (-finit-derived): Document.\n\n    gcc/testsuite/ChangeLog:\n\n\tPR fortran/80668\n\t* gfortran.dg/pr80668.f90: New.\n\nFrom-SVN: r248158", "tree": {"sha": "97f41faa2225a37fd33f60fa60b8950f5daa87c9", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/97f41faa2225a37fd33f60fa60b8950f5daa87c9"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/e5b1f5a1d11f73ff289ffebfeccbc0650531367b", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/e5b1f5a1d11f73ff289ffebfeccbc0650531367b", "html_url": "https://github.com/Rust-GCC/gccrs/commit/e5b1f5a1d11f73ff289ffebfeccbc0650531367b", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/e5b1f5a1d11f73ff289ffebfeccbc0650531367b/comments", "author": {"login": "fritzr", "id": 2230564, "node_id": "MDQ6VXNlcjIyMzA1NjQ=", "avatar_url": "https://avatars.githubusercontent.com/u/2230564?v=4", "gravatar_id": "", "url": "https://api.github.com/users/fritzr", "html_url": "https://github.com/fritzr", "followers_url": "https://api.github.com/users/fritzr/followers", "following_url": "https://api.github.com/users/fritzr/following{/other_user}", "gists_url": "https://api.github.com/users/fritzr/gists{/gist_id}", "starred_url": "https://api.github.com/users/fritzr/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/fritzr/subscriptions", "organizations_url": "https://api.github.com/users/fritzr/orgs", "repos_url": "https://api.github.com/users/fritzr/repos", "events_url": "https://api.github.com/users/fritzr/events{/privacy}", "received_events_url": "https://api.github.com/users/fritzr/received_events", "type": "User", "site_admin": false}, "committer": null, "parents": [{"sha": "3ca8120f640818a80ffdcb64f50c2091570e8657", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/3ca8120f640818a80ffdcb64f50c2091570e8657", "html_url": "https://github.com/Rust-GCC/gccrs/commit/3ca8120f640818a80ffdcb64f50c2091570e8657"}], "stats": {"total": 51, "additions": 49, "deletions": 2}, "files": [{"sha": "e978f32b8be7430e26436ea3c548be455321eff9", "filename": "gcc/fortran/ChangeLog", "status": "modified", "additions": 7, "deletions": 0, "changes": 7, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/e5b1f5a1d11f73ff289ffebfeccbc0650531367b/gcc%2Ffortran%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/e5b1f5a1d11f73ff289ffebfeccbc0650531367b/gcc%2Ffortran%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ffortran%2FChangeLog?ref=e5b1f5a1d11f73ff289ffebfeccbc0650531367b", "patch": "@@ -1,3 +1,10 @@\n+2017-05-17  Fritz Reese <fritzoreese@gmail.com>\n+\n+\tPR fortran/80668\n+\t* expr.c (component_initializer): Don't generate initializers for\n+\tpointer components.\n+\t* invoke.texi (-finit-derived): Document.\n+\n 2017-05-16  Paul Thomas  <pault@gcc.gnu.org>\n \n \tPR fortran/80554"}, {"sha": "9b2e5657a1a956203723d233e2fb6c573ae08c42", "filename": "gcc/fortran/expr.c", "status": "modified", "additions": 6, "deletions": 2, "changes": 8, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/e5b1f5a1d11f73ff289ffebfeccbc0650531367b/gcc%2Ffortran%2Fexpr.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/e5b1f5a1d11f73ff289ffebfeccbc0650531367b/gcc%2Ffortran%2Fexpr.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ffortran%2Fexpr.c?ref=e5b1f5a1d11f73ff289ffebfeccbc0650531367b", "patch": "@@ -4280,9 +4280,13 @@ component_initializer (gfc_typespec *ts, gfc_component *c, bool generate)\n {\n   gfc_expr *init = NULL;\n \n-  /* See if we can find the initializer immediately.  */\n+  /* See if we can find the initializer immediately.\n+     Some components should never get initializers.  */\n   if (c->initializer || !generate\n-      || (ts->type == BT_CLASS && !c->attr.allocatable))\n+      || (ts->type == BT_CLASS && !c->attr.allocatable)\n+      || c->attr.pointer\n+      || c->attr.class_pointer\n+      || c->attr.proc_pointer)\n     return c->initializer;\n \n   /* Recursively handle derived type components.  */"}, {"sha": "8a1d09dd5e524c394d7370405373d855daba3ad5", "filename": "gcc/fortran/invoke.texi", "status": "modified", "additions": 2, "deletions": 0, "changes": 2, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/e5b1f5a1d11f73ff289ffebfeccbc0650531367b/gcc%2Ffortran%2Finvoke.texi", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/e5b1f5a1d11f73ff289ffebfeccbc0650531367b/gcc%2Ffortran%2Finvoke.texi", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ffortran%2Finvoke.texi?ref=e5b1f5a1d11f73ff289ffebfeccbc0650531367b", "patch": "@@ -1665,6 +1665,8 @@ according to these flags only with @option{-finit-derived}.  These options do\n not initialize\n @itemize @bullet\n @item\n+objects with the POINTER attribute\n+@item\n allocatable arrays\n @item\n variables that appear in an @code{EQUIVALENCE} statement."}, {"sha": "d75f985c5d41b06a479957f772e26dc7d50d94da", "filename": "gcc/testsuite/ChangeLog", "status": "modified", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/e5b1f5a1d11f73ff289ffebfeccbc0650531367b/gcc%2Ftestsuite%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/e5b1f5a1d11f73ff289ffebfeccbc0650531367b/gcc%2Ftestsuite%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2FChangeLog?ref=e5b1f5a1d11f73ff289ffebfeccbc0650531367b", "patch": "@@ -1,3 +1,8 @@\n+2017-05-17  Fritz Reese <fritzoreese@gmail.com>\n+\n+\tPR fortran/80668\n+\t* gfortran.dg/pr80668.f90: New.\n+\n 2017-05-17  Peter Bergner  <bergner@vnet.ibm.com>\n \n \tPR middle-end/80775"}, {"sha": "63bd0d3d5cd5b8226212eaf341408abc2402877f", "filename": "gcc/testsuite/gfortran.dg/pr80668.f90", "status": "added", "additions": 29, "deletions": 0, "changes": 29, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/e5b1f5a1d11f73ff289ffebfeccbc0650531367b/gcc%2Ftestsuite%2Fgfortran.dg%2Fpr80668.f90", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/e5b1f5a1d11f73ff289ffebfeccbc0650531367b/gcc%2Ftestsuite%2Fgfortran.dg%2Fpr80668.f90", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgfortran.dg%2Fpr80668.f90?ref=e5b1f5a1d11f73ff289ffebfeccbc0650531367b", "patch": "@@ -0,0 +1,29 @@\n+! { dg-do compile }\n+! { dg-options \"-finit-derived -finit-integer=12345678\" }\n+!\n+! PR fortran/80668\n+!\n+! Test a regression where structure constructor expressions were created for\n+! POINTER components with -finit-derived.\n+!\n+\n+MODULE pr80668\n+  IMPLICIT NONE\n+  TYPE :: dist_t\n+     INTEGER :: TYPE,nblks_loc,nblks\n+     INTEGER,DIMENSION(:),POINTER :: dist\n+  END TYPE dist_t\n+\n+CONTAINS\n+\n+  SUBROUTINE hfx_new()\n+    TYPE(dist_t)                             :: dist\n+    integer,pointer :: bob\n+    CALL release_dist(dist, bob)\n+  END SUBROUTINE hfx_new\n+\n+  SUBROUTINE release_dist(dist,p)\n+    TYPE(dist_t)                             :: dist\n+    integer, pointer, intent(in) :: p\n+  END SUBROUTINE release_dist\n+END MODULE"}]}