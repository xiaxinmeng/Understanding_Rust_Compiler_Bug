{"sha": "e2cbee7fd1d126a404e33321057392c5777db950", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6ZTJjYmVlN2ZkMWQxMjZhNDA0ZTMzMzIxMDU3MzkyYzU3NzdkYjk1MA==", "commit": {"author": {"name": "Paolo Carlini", "email": "pcarlini@unitus.it", "date": "2002-09-05T21:13:07Z"}, "committer": {"name": "Paolo Carlini", "email": "paolo@gcc.gnu.org", "date": "2002-09-05T21:13:07Z"}, "message": "re PR libstdc++/7811 (default locale not taken from environment)\n\n2002-09-05  Paolo Carlini  <pcarlini@unitus.it>\n\t    Roland McGrath  <roland@redhat.com>\n\n\tPR libstdc++/7811\n\t* src/locale.cc (locale::locale(__s)): Use getenv instead\n\tof setenv for the environment locale.\n\t* testsuite/22_locale/ctor_copy_dtor.cc (test03): New.\n\nCo-Authored-By: Roland McGrath <roland@redhat.com>\n\nFrom-SVN: r56865", "tree": {"sha": "04d7512b4857d0931c9bdb1ce34ae5d6b7799f97", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/04d7512b4857d0931c9bdb1ce34ae5d6b7799f97"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/e2cbee7fd1d126a404e33321057392c5777db950", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/e2cbee7fd1d126a404e33321057392c5777db950", "html_url": "https://github.com/Rust-GCC/gccrs/commit/e2cbee7fd1d126a404e33321057392c5777db950", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/e2cbee7fd1d126a404e33321057392c5777db950/comments", "author": null, "committer": null, "parents": [{"sha": "b3fbfc0766b57cc52e1398e131161df6c7bb1ef7", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/b3fbfc0766b57cc52e1398e131161df6c7bb1ef7", "html_url": "https://github.com/Rust-GCC/gccrs/commit/b3fbfc0766b57cc52e1398e131161df6c7bb1ef7"}], "stats": {"total": 34, "additions": 33, "deletions": 1}, "files": [{"sha": "89804df52952fd53912968da100ff7e0b866d28b", "filename": "libstdc++-v3/ChangeLog", "status": "modified", "additions": 8, "deletions": 0, "changes": 8, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/e2cbee7fd1d126a404e33321057392c5777db950/libstdc%2B%2B-v3%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/e2cbee7fd1d126a404e33321057392c5777db950/libstdc%2B%2B-v3%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libstdc%2B%2B-v3%2FChangeLog?ref=e2cbee7fd1d126a404e33321057392c5777db950", "patch": "@@ -1,3 +1,11 @@\n+2002-09-05  Paolo Carlini  <pcarlini@unitus.it>\n+            Roland McGrath  <roland@redhat.com>\n+\n+\tPR libstdc++/7811\n+\t* src/locale.cc (locale::locale(__s)): Use getenv instead\n+\tof setenv for the environment locale.\n+\t* testsuite/22_locale/ctor_copy_dtor.cc (test03): New.\n+\n 2002-09-05  Jakub Jelinek  <jakub@redhat.com>\n \n \t* config/abi/ia64-unknown-linux-gnu: Add."}, {"sha": "99c8c67144b34a87d28f192fc86139f1dcfbf9e6", "filename": "libstdc++-v3/src/locale.cc", "status": "modified", "additions": 9, "deletions": 1, "changes": 10, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/e2cbee7fd1d126a404e33321057392c5777db950/libstdc%2B%2B-v3%2Fsrc%2Flocale.cc", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/e2cbee7fd1d126a404e33321057392c5777db950/libstdc%2B%2B-v3%2Fsrc%2Flocale.cc", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libstdc%2B%2B-v3%2Fsrc%2Flocale.cc?ref=e2cbee7fd1d126a404e33321057392c5777db950", "patch": "@@ -202,7 +202,15 @@ namespace std\n \tif (strcmp(__s, \"C\") == 0 || strcmp(__s, \"POSIX\") == 0)\n \t  (_M_impl = _S_classic)->_M_add_reference();\n \telse if (strcmp(__s, \"\") == 0)\n-\t  _M_impl = new _Impl(setlocale(LC_ALL, NULL), 1);\n+\t  {\n+\t    char* __env = getenv(\"LC_ALL\");\n+\t    if (__env)\n+\t      _M_impl = new _Impl(__env, 1);\n+\t    else if ((__env = getenv(\"LANG\")))\n+\t      _M_impl = new _Impl(__env, 1);\n+\t    else\n+\t      (_M_impl = _S_classic)->_M_add_reference();\n+\t  }\n \telse\n \t  _M_impl = new _Impl(__s, 1);\n       }"}, {"sha": "a27b2457e874245f042f81adf5597caae21af98c", "filename": "libstdc++-v3/testsuite/22_locale/ctor_copy_dtor.cc", "status": "modified", "additions": 16, "deletions": 0, "changes": 16, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/e2cbee7fd1d126a404e33321057392c5777db950/libstdc%2B%2B-v3%2Ftestsuite%2F22_locale%2Fctor_copy_dtor.cc", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/e2cbee7fd1d126a404e33321057392c5777db950/libstdc%2B%2B-v3%2Ftestsuite%2F22_locale%2Fctor_copy_dtor.cc", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libstdc%2B%2B-v3%2Ftestsuite%2F22_locale%2Fctor_copy_dtor.cc?ref=e2cbee7fd1d126a404e33321057392c5777db950", "patch": "@@ -310,6 +310,21 @@ void test02()\n   VERIFY( loc_1 == loc_2 );\n }\n \n+// libstdc++/7811\n+void test03()\n+{\n+  bool test = true;\n+#ifdef _GLIBCPP_HAVE_SETENV \n+  const char* oldLANG = getenv(\"LANG\");\n+  if (!setenv(\"LANG\", \"it_IT\", 1))\n+    {\n+      std::locale loc(\"\"); \n+      VERIFY( loc.name() == \"it_IT\" );\n+      setenv(\"LANG\", oldLANG ? oldLANG : \"\", 1);\n+    }\n+#endif\n+}\n+\n int main()\n {\n   test00();\n@@ -319,6 +334,7 @@ int main()\n #endif \n \n   test02();\n+  test03();\n \n   return 0;\n }"}]}