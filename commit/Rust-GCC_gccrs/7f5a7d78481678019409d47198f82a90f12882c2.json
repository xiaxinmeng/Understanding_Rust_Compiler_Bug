{"sha": "7f5a7d78481678019409d47198f82a90f12882c2", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6N2Y1YTdkNzg0ODE2NzgwMTk0MDlkNDcxOThmODJhOTBmMTI4ODJjMg==", "commit": {"author": {"name": "Marek Polacek", "email": "polacek@redhat.com", "date": "2017-03-03T22:19:24Z"}, "committer": {"name": "Marek Polacek", "email": "mpolacek@gcc.gnu.org", "date": "2017-03-03T22:19:24Z"}, "message": "re PR c/79758 (ICE: tree check: expected class 'type', have 'exceptional' (error_mark) in store_parm_decls_oldstyle, at c/c-decl.c:8973)\n\n\tPR c/79758\n\t* c-decl.c (store_parm_decls_oldstyle): Check if the element of\n\tcurrent_function_prototype_arg_types is error_mark_node.  Fix\n\tformatting.  Use TREE_VALUE instead of TREE_TYPE.\n\n\t* gcc.dg/noncompile/pr79758.c: New test.\n\nFrom-SVN: r245886", "tree": {"sha": "827531c703f0c2c38c647daaab22b648eed4cee0", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/827531c703f0c2c38c647daaab22b648eed4cee0"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/7f5a7d78481678019409d47198f82a90f12882c2", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/7f5a7d78481678019409d47198f82a90f12882c2", "html_url": "https://github.com/Rust-GCC/gccrs/commit/7f5a7d78481678019409d47198f82a90f12882c2", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/7f5a7d78481678019409d47198f82a90f12882c2/comments", "author": {"login": "mpolacek", "id": 10496300, "node_id": "MDQ6VXNlcjEwNDk2MzAw", "avatar_url": "https://avatars.githubusercontent.com/u/10496300?v=4", "gravatar_id": "", "url": "https://api.github.com/users/mpolacek", "html_url": "https://github.com/mpolacek", "followers_url": "https://api.github.com/users/mpolacek/followers", "following_url": "https://api.github.com/users/mpolacek/following{/other_user}", "gists_url": "https://api.github.com/users/mpolacek/gists{/gist_id}", "starred_url": "https://api.github.com/users/mpolacek/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/mpolacek/subscriptions", "organizations_url": "https://api.github.com/users/mpolacek/orgs", "repos_url": "https://api.github.com/users/mpolacek/repos", "events_url": "https://api.github.com/users/mpolacek/events{/privacy}", "received_events_url": "https://api.github.com/users/mpolacek/received_events", "type": "User", "site_admin": false}, "committer": null, "parents": [{"sha": "79c9b7a84f15938037fd209af24bbfa77ae02cbe", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/79c9b7a84f15938037fd209af24bbfa77ae02cbe", "html_url": "https://github.com/Rust-GCC/gccrs/commit/79c9b7a84f15938037fd209af24bbfa77ae02cbe"}], "stats": {"total": 35, "additions": 28, "deletions": 7}, "files": [{"sha": "8ff0ccc1b690b5448828de6e6786fdfe0486c358", "filename": "gcc/c/ChangeLog", "status": "modified", "additions": 7, "deletions": 0, "changes": 7, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/7f5a7d78481678019409d47198f82a90f12882c2/gcc%2Fc%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/7f5a7d78481678019409d47198f82a90f12882c2/gcc%2Fc%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fc%2FChangeLog?ref=7f5a7d78481678019409d47198f82a90f12882c2", "patch": "@@ -1,3 +1,10 @@\n+2017-03-03  Marek Polacek  <polacek@redhat.com>\n+\n+\tPR c/79758\n+\t* c-decl.c (store_parm_decls_oldstyle): Check if the element of\n+\tcurrent_function_prototype_arg_types is error_mark_node.  Fix\n+\tformatting.  Use TREE_VALUE instead of TREE_TYPE.\n+\n 2017-03-03  Jakub Jelinek  <jakub@redhat.com>\n \n \tPR c/79837"}, {"sha": "f46ca11b9ab165ffad7885377f8fb5fe5f715916", "filename": "gcc/c/c-decl.c", "status": "modified", "additions": 10, "deletions": 7, "changes": 17, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/7f5a7d78481678019409d47198f82a90f12882c2/gcc%2Fc%2Fc-decl.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/7f5a7d78481678019409d47198f82a90f12882c2/gcc%2Fc%2Fc-decl.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fc%2Fc-decl.c?ref=7f5a7d78481678019409d47198f82a90f12882c2", "patch": "@@ -8965,12 +8965,15 @@ store_parm_decls_oldstyle (tree fndecl, const struct c_arg_info *arg_info)\n       tree type;\n       for (parm = DECL_ARGUMENTS (fndecl),\n \t     type = current_function_prototype_arg_types;\n-\t   parm || (type && TREE_VALUE (type) != error_mark_node\n-                   && (TYPE_MAIN_VARIANT (TREE_VALUE (type)) != void_type_node));\n+\t   parm || (type != NULL_TREE\n+\t\t    && TREE_VALUE (type) != error_mark_node\n+\t\t    && TYPE_MAIN_VARIANT (TREE_VALUE (type)) != void_type_node);\n \t   parm = DECL_CHAIN (parm), type = TREE_CHAIN (type))\n \t{\n-\t  if (parm == 0 || type == 0\n-\t      || TYPE_MAIN_VARIANT (TREE_VALUE (type)) == void_type_node)\n+\t  if (parm == NULL_TREE\n+\t      || type == NULL_TREE\n+\t      || (TREE_VALUE (type) != error_mark_node\n+\t\t  && TYPE_MAIN_VARIANT (TREE_VALUE (type)) == void_type_node))\n \t    {\n \t      if (current_function_prototype_built_in)\n \t\twarning_at (DECL_SOURCE_LOCATION (fndecl),\n@@ -8996,7 +8999,7 @@ store_parm_decls_oldstyle (tree fndecl, const struct c_arg_info *arg_info)\n \t     declared for the arg.  ISO C says we take the unqualified\n \t     type for parameters declared with qualified type.  */\n \t  if (TREE_TYPE (parm) != error_mark_node\n-\t      && TREE_TYPE (type) != error_mark_node\n+\t      && TREE_VALUE (type) != error_mark_node\n \t      && ((TYPE_ATOMIC (DECL_ARG_TYPE (parm))\n \t\t   != TYPE_ATOMIC (TREE_VALUE (type)))\n \t\t  || !comptypes (TYPE_MAIN_VARIANT (DECL_ARG_TYPE (parm)),\n@@ -9016,8 +9019,8 @@ store_parm_decls_oldstyle (tree fndecl, const struct c_arg_info *arg_info)\n \n \t\t  if (targetm.calls.promote_prototypes (TREE_TYPE (current_function_decl))\n \t\t      && INTEGRAL_TYPE_P (TREE_TYPE (parm))\n-\t\t      && TYPE_PRECISION (TREE_TYPE (parm))\n-\t\t      < TYPE_PRECISION (integer_type_node))\n+\t\t      && (TYPE_PRECISION (TREE_TYPE (parm))\n+\t\t\t  < TYPE_PRECISION (integer_type_node)))\n \t\t    DECL_ARG_TYPE (parm)\n \t\t      = c_type_promotes_to (TREE_TYPE (parm));\n "}, {"sha": "adb9ebad369a23077a10ff84b68942351f69e7ec", "filename": "gcc/testsuite/ChangeLog", "status": "modified", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/7f5a7d78481678019409d47198f82a90f12882c2/gcc%2Ftestsuite%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/7f5a7d78481678019409d47198f82a90f12882c2/gcc%2Ftestsuite%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2FChangeLog?ref=7f5a7d78481678019409d47198f82a90f12882c2", "patch": "@@ -1,3 +1,8 @@\n+2017-03-03  Marek Polacek  <polacek@redhat.com>\n+\n+\tPR c/79758\n+\t* gcc.dg/noncompile/pr79758.c: New test.\n+\n 2017-03-03  Jakub Jelinek  <jakub@redhat.com>\n \n \tPR middle-end/79805"}, {"sha": "aeaf7c71decdd23086293f72fa8bd636f3387e98", "filename": "gcc/testsuite/gcc.dg/noncompile/pr79758.c", "status": "added", "additions": 6, "deletions": 0, "changes": 6, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/7f5a7d78481678019409d47198f82a90f12882c2/gcc%2Ftestsuite%2Fgcc.dg%2Fnoncompile%2Fpr79758.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/7f5a7d78481678019409d47198f82a90f12882c2/gcc%2Ftestsuite%2Fgcc.dg%2Fnoncompile%2Fpr79758.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgcc.dg%2Fnoncompile%2Fpr79758.c?ref=7f5a7d78481678019409d47198f82a90f12882c2", "patch": "@@ -0,0 +1,6 @@\n+/* PR c/79758 */\n+/* { dg-do compile } */\n+\n+void fn1 (int[a]) { }; /* { dg-error \"undeclared here|parameter name omitted\" } */\n+void fn1 (b) { }; /* { dg-error \"redefinition\" } */\n+/* { dg-warning \"defaults to 'int'\" \"\" { target *-*-* } .-1 } */"}]}