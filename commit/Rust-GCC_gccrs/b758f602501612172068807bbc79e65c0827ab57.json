{"sha": "b758f602501612172068807bbc79e65c0827ab57", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6Yjc1OGY2MDI1MDE2MTIxNzIwNjg4MDdiYmM3OWU2NWMwODI3YWI1Nw==", "commit": {"author": {"name": "Richard Guenther", "email": "rguenther@suse.de", "date": "2012-03-16T13:20:55Z"}, "committer": {"name": "Richard Biener", "email": "rguenth@gcc.gnu.org", "date": "2012-03-16T13:20:55Z"}, "message": "tree-vect-stmts.c (vect_get_vec_def_for_operand): Use VIEW_CONVERT_EXPR to convert constants.\n\n2012-03-16  Richard Guenther  <rguenther@suse.de>\n\n\t* tree-vect-stmts.c (vect_get_vec_def_for_operand): Use\n\tVIEW_CONVERT_EXPR to convert constants.\n\t(vect_is_simple_use): Treat all constants as vec_constant_def.\n\nFrom-SVN: r185466", "tree": {"sha": "42d98432fb00efdabe0ccbb26862361ee4e28f6a", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/42d98432fb00efdabe0ccbb26862361ee4e28f6a"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/b758f602501612172068807bbc79e65c0827ab57", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/b758f602501612172068807bbc79e65c0827ab57", "html_url": "https://github.com/Rust-GCC/gccrs/commit/b758f602501612172068807bbc79e65c0827ab57", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/b758f602501612172068807bbc79e65c0827ab57/comments", "author": {"login": "rguenth", "id": 2046526, "node_id": "MDQ6VXNlcjIwNDY1MjY=", "avatar_url": "https://avatars.githubusercontent.com/u/2046526?v=4", "gravatar_id": "", "url": "https://api.github.com/users/rguenth", "html_url": "https://github.com/rguenth", "followers_url": "https://api.github.com/users/rguenth/followers", "following_url": "https://api.github.com/users/rguenth/following{/other_user}", "gists_url": "https://api.github.com/users/rguenth/gists{/gist_id}", "starred_url": "https://api.github.com/users/rguenth/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/rguenth/subscriptions", "organizations_url": "https://api.github.com/users/rguenth/orgs", "repos_url": "https://api.github.com/users/rguenth/repos", "events_url": "https://api.github.com/users/rguenth/events{/privacy}", "received_events_url": "https://api.github.com/users/rguenth/received_events", "type": "User", "site_admin": false}, "committer": null, "parents": [{"sha": "cf1867a027259b46b63abed5f6e34b479d52f186", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/cf1867a027259b46b63abed5f6e34b479d52f186", "html_url": "https://github.com/Rust-GCC/gccrs/commit/cf1867a027259b46b63abed5f6e34b479d52f186"}], "stats": {"total": 18, "additions": 14, "deletions": 4}, "files": [{"sha": "d246b857a373ba3b11ab24519513b57e87c561b5", "filename": "gcc/ChangeLog", "status": "modified", "additions": 6, "deletions": 0, "changes": 6, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/b758f602501612172068807bbc79e65c0827ab57/gcc%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/b758f602501612172068807bbc79e65c0827ab57/gcc%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2FChangeLog?ref=b758f602501612172068807bbc79e65c0827ab57", "patch": "@@ -1,3 +1,9 @@\n+2012-03-16  Richard Guenther  <rguenther@suse.de>\n+\n+\t* tree-vect-stmts.c (vect_get_vec_def_for_operand): Use\n+\tVIEW_CONVERT_EXPR to convert constants.\n+\t(vect_is_simple_use): Treat all constants as vec_constant_def.\n+\n 2012-03-16  Richard Guenther  <rguenther@suse.de>\n \tKai Tietz  <ktietz@redhat.com>\n "}, {"sha": "c941e15033b69d9339e405ed92488b4bf18a9c12", "filename": "gcc/tree-vect-stmts.c", "status": "modified", "additions": 8, "deletions": 4, "changes": 12, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/b758f602501612172068807bbc79e65c0827ab57/gcc%2Ftree-vect-stmts.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/b758f602501612172068807bbc79e65c0827ab57/gcc%2Ftree-vect-stmts.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftree-vect-stmts.c?ref=b758f602501612172068807bbc79e65c0827ab57", "patch": "@@ -1271,9 +1271,13 @@ vect_get_vec_def_for_operand (tree op, gimple stmt, tree *scalar_def)\n         if (vect_print_dump_info (REPORT_DETAILS))\n           fprintf (vect_dump, \"Create vector_cst. nunits = %d\", nunits);\n \n-        vec_cst = build_vector_from_val (vector_type,\n-\t\t\t\t\t fold_convert (TREE_TYPE (vector_type),\n-\t\t\t\t\t\t       op));\n+\tif (!types_compatible_p (TREE_TYPE (vector_type), TREE_TYPE (op)))\n+\t  {\n+\t    op = fold_unary (VIEW_CONVERT_EXPR, TREE_TYPE (vector_type), op);\n+\t    gcc_assert (op && CONSTANT_CLASS_P (op));\n+\t  }\n+\n+        vec_cst = build_vector_from_val (vector_type, op);\n         return vect_init_vector (stmt, vec_cst, vector_type, NULL);\n       }\n \n@@ -5909,7 +5913,7 @@ vect_is_simple_use (tree operand, gimple stmt, loop_vec_info loop_vinfo,\n       print_generic_expr (vect_dump, operand, TDF_SLIM);\n     }\n \n-  if (TREE_CODE (operand) == INTEGER_CST || TREE_CODE (operand) == REAL_CST)\n+  if (CONSTANT_CLASS_P (operand))\n     {\n       *dt = vect_constant_def;\n       return true;"}]}