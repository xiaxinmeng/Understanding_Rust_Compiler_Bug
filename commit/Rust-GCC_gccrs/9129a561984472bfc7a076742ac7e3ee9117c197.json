{"sha": "9129a561984472bfc7a076742ac7e3ee9117c197", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6OTEyOWE1NjE5ODQ0NzJiZmM3YTA3Njc0MmFjN2UzZWU5MTE3YzE5Nw==", "commit": {"author": {"name": "Vladimir Makarov", "email": "vmakarov@redhat.com", "date": "2017-09-29T17:39:58Z"}, "committer": {"name": "Vladimir Makarov", "email": "vmakarov@gcc.gnu.org", "date": "2017-09-29T17:39:58Z"}, "message": "re PR target/81481 (Spills %xmm to stack in glibc strspn SSE 4.2 variant)\n\n2017-09-29  Vladimir Makarov  <vmakarov@redhat.com>\n\n\tPR target/81481\n\t* ira-costs.c (scan_one_insn): Don't take into account PIC equiv\n\twith a symbol for LRA.\n\n2017-09-29  Vladimir Makarov  <vmakarov@redhat.com>\n\n\tPR target/81481\n\t* gcc.target/i386/pr81481.c: New.\n\nFrom-SVN: r253300", "tree": {"sha": "7491ed745470e89604e0f2b86f3eb5a343382bc6", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/7491ed745470e89604e0f2b86f3eb5a343382bc6"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/9129a561984472bfc7a076742ac7e3ee9117c197", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/9129a561984472bfc7a076742ac7e3ee9117c197", "html_url": "https://github.com/Rust-GCC/gccrs/commit/9129a561984472bfc7a076742ac7e3ee9117c197", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/9129a561984472bfc7a076742ac7e3ee9117c197/comments", "author": {"login": "vnmakarov", "id": 9855671, "node_id": "MDQ6VXNlcjk4NTU2NzE=", "avatar_url": "https://avatars.githubusercontent.com/u/9855671?v=4", "gravatar_id": "", "url": "https://api.github.com/users/vnmakarov", "html_url": "https://github.com/vnmakarov", "followers_url": "https://api.github.com/users/vnmakarov/followers", "following_url": "https://api.github.com/users/vnmakarov/following{/other_user}", "gists_url": "https://api.github.com/users/vnmakarov/gists{/gist_id}", "starred_url": "https://api.github.com/users/vnmakarov/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/vnmakarov/subscriptions", "organizations_url": "https://api.github.com/users/vnmakarov/orgs", "repos_url": "https://api.github.com/users/vnmakarov/repos", "events_url": "https://api.github.com/users/vnmakarov/events{/privacy}", "received_events_url": "https://api.github.com/users/vnmakarov/received_events", "type": "User", "site_admin": false}, "committer": null, "parents": [{"sha": "851dac7c208cd6d5136480068ded0f70995a9c2e", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/851dac7c208cd6d5136480068ded0f70995a9c2e", "html_url": "https://github.com/Rust-GCC/gccrs/commit/851dac7c208cd6d5136480068ded0f70995a9c2e"}], "stats": {"total": 34, "additions": 33, "deletions": 1}, "files": [{"sha": "bdf728b6fff22f9d43c18a66460b7b7dc54050ae", "filename": "gcc/ChangeLog", "status": "modified", "additions": 6, "deletions": 0, "changes": 6, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/9129a561984472bfc7a076742ac7e3ee9117c197/gcc%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/9129a561984472bfc7a076742ac7e3ee9117c197/gcc%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2FChangeLog?ref=9129a561984472bfc7a076742ac7e3ee9117c197", "patch": "@@ -1,3 +1,9 @@\n+2017-09-29  Vladimir Makarov  <vmakarov@redhat.com>\n+\n+\tPR target/81481\n+\t* ira-costs.c (scan_one_insn): Don't take into account PIC equiv\n+\twith a symbol for LRA.\n+\n 2017-09-29  Vladimir Makarov  <vmakarov@redhat.com>\n \n \tPR rtl-optimization/82338"}, {"sha": "0bd077888339cd0fe77b87f5b4e1f44e88350a41", "filename": "gcc/ira-costs.c", "status": "modified", "additions": 4, "deletions": 1, "changes": 5, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/9129a561984472bfc7a076742ac7e3ee9117c197/gcc%2Fira-costs.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/9129a561984472bfc7a076742ac7e3ee9117c197/gcc%2Fira-costs.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fira-costs.c?ref=9129a561984472bfc7a076742ac7e3ee9117c197", "patch": "@@ -1471,7 +1471,10 @@ scan_one_insn (rtx_insn *insn)\n \t      && targetm.legitimate_constant_p (GET_MODE (SET_DEST (set)),\n \t\t\t\t\t\tXEXP (note, 0))\n \t      && REG_N_SETS (REGNO (SET_DEST (set))) == 1))\n-      && general_operand (SET_SRC (set), GET_MODE (SET_SRC (set))))\n+      && general_operand (SET_SRC (set), GET_MODE (SET_SRC (set)))\n+      /* LRA does not use equiv with a symbol for PIC code.  */\n+      && (! ira_use_lra_p || ! pic_offset_table_rtx\n+\t  || ! contains_symbol_ref_p (XEXP (note, 0))))\n     {\n       enum reg_class cl = GENERAL_REGS;\n       rtx reg = SET_DEST (set);"}, {"sha": "ac88fd3edf71289979fd0ff4476e2a5ebc5e7f28", "filename": "gcc/testsuite/ChangeLog", "status": "modified", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/9129a561984472bfc7a076742ac7e3ee9117c197/gcc%2Ftestsuite%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/9129a561984472bfc7a076742ac7e3ee9117c197/gcc%2Ftestsuite%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2FChangeLog?ref=9129a561984472bfc7a076742ac7e3ee9117c197", "patch": "@@ -1,3 +1,8 @@\n+2017-09-29  Vladimir Makarov  <vmakarov@redhat.com>\n+\n+\tPR target/81481\n+\t* gcc.target/i386/pr81481.c: New.\n+\n 2017-09-29  Kelvin Nilsen  <kelvin@gcc.gnu.org>\n \n \t* gcc.target/powerpc/swaps-p8-30.c: Exchange the order of dg-do"}, {"sha": "a5b936fdacc17a66610ad5edc09cbee8acb7d1f7", "filename": "gcc/testsuite/gcc.target/i386/pr81481.c", "status": "added", "additions": 18, "deletions": 0, "changes": 18, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/9129a561984472bfc7a076742ac7e3ee9117c197/gcc%2Ftestsuite%2Fgcc.target%2Fi386%2Fpr81481.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/9129a561984472bfc7a076742ac7e3ee9117c197/gcc%2Ftestsuite%2Fgcc.target%2Fi386%2Fpr81481.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgcc.target%2Fi386%2Fpr81481.c?ref=9129a561984472bfc7a076742ac7e3ee9117c197", "patch": "@@ -0,0 +1,18 @@\n+/* { dg-do compile } */\n+/* { dg-require-effective-target ssse3 } */\n+/* { dg-options \"-O2 -fpic -mssse3\" } */\n+/* { dg-final { scan-assembler-not \"pshufb\\[ \\t\\]\\\\(%esp\\\\)\" } } */\n+#include <immintrin.h>\n+\n+extern const signed char c[31] __attribute__((visibility(\"hidden\")));\n+\n+__m128i f(__m128i *x, void *v)\n+{\n+  int i;\n+  asm(\"# %0\" : \"=r\"(i));\n+  __m128i t = _mm_loadu_si128((void*)&c[i]);\n+  __m128i xx = *x;\n+  xx =  _mm_shuffle_epi8(xx, t);\n+  asm(\"# %0 %1 %2\" : \"+x\"(xx) : \"r\"(c), \"r\"(i));\n+  return xx;\n+}"}]}