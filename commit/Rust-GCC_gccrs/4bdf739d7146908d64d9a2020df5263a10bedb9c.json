{"sha": "4bdf739d7146908d64d9a2020df5263a10bedb9c", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6NGJkZjczOWQ3MTQ2OTA4ZDY0ZDlhMjAyMGRmNTI2M2ExMGJlZGI5Yw==", "commit": {"author": {"name": "Uros Bizjak", "email": "ubizjak@gmail.com", "date": "2016-06-01T13:44:37Z"}, "committer": {"name": "Uros Bizjak", "email": "uros@gcc.gnu.org", "date": "2016-06-01T13:44:37Z"}, "message": "re PR target/67310 ([PATCH] gcc 4.8.4 fails to compile with -march=native on VIA nano CPU)\n\n\tPR target/67310\n\t* config/i386/driver-i386.c (host_detect_local_cpu): Correctly\n\tdetect processor family for signature_CENTAUR_ebx.\n\t<case PROCESSOR_I486>: Pass c3, winchip2 or winchip-c6 for\n\tsignature_CENTAUR_ebx.\n\t<case PROCESSOR _PENTIUMPRO>: Pass c3-2 for signature_CENTAUR_ebx.\n\t<default>: Pass x86-64 for has_longmode.\n\n\nCo-Authored-By: Jocelyn Mayer <l_indien@magic.fr>\n\nFrom-SVN: r236991", "tree": {"sha": "258f5ad02ad56a070cebe407e8ca65c24dde09b1", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/258f5ad02ad56a070cebe407e8ca65c24dde09b1"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/4bdf739d7146908d64d9a2020df5263a10bedb9c", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/4bdf739d7146908d64d9a2020df5263a10bedb9c", "html_url": "https://github.com/Rust-GCC/gccrs/commit/4bdf739d7146908d64d9a2020df5263a10bedb9c", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/4bdf739d7146908d64d9a2020df5263a10bedb9c/comments", "author": {"login": "ubizjak", "id": 55479990, "node_id": "MDQ6VXNlcjU1NDc5OTkw", "avatar_url": "https://avatars.githubusercontent.com/u/55479990?v=4", "gravatar_id": "", "url": "https://api.github.com/users/ubizjak", "html_url": "https://github.com/ubizjak", "followers_url": "https://api.github.com/users/ubizjak/followers", "following_url": "https://api.github.com/users/ubizjak/following{/other_user}", "gists_url": "https://api.github.com/users/ubizjak/gists{/gist_id}", "starred_url": "https://api.github.com/users/ubizjak/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/ubizjak/subscriptions", "organizations_url": "https://api.github.com/users/ubizjak/orgs", "repos_url": "https://api.github.com/users/ubizjak/repos", "events_url": "https://api.github.com/users/ubizjak/events{/privacy}", "received_events_url": "https://api.github.com/users/ubizjak/received_events", "type": "User", "site_admin": false}, "committer": null, "parents": [{"sha": "721547cd0dd19a03a9e9405cfdbd6d0870eaaf68", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/721547cd0dd19a03a9e9405cfdbd6d0870eaaf68", "html_url": "https://github.com/Rust-GCC/gccrs/commit/721547cd0dd19a03a9e9405cfdbd6d0870eaaf68"}], "stats": {"total": 84, "additions": 55, "deletions": 29}, "files": [{"sha": "59dda4df2005c4d94beb5782bd857d4ab433f0dc", "filename": "gcc/ChangeLog", "status": "modified", "additions": 11, "deletions": 0, "changes": 11, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/4bdf739d7146908d64d9a2020df5263a10bedb9c/gcc%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/4bdf739d7146908d64d9a2020df5263a10bedb9c/gcc%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2FChangeLog?ref=4bdf739d7146908d64d9a2020df5263a10bedb9c", "patch": "@@ -1,3 +1,14 @@\n+2016-06-01  Uros Bizjak  <ubizjak@gmail.com>\n+\t    Jocelyn Mayer  <l_indien@magic.fr>\n+\n+\tPR target/67310\n+\t* config/i386/driver-i386.c (host_detect_local_cpu): Correctly\n+\tdetect processor family for signature_CENTAUR_ebx.\n+\t<case PROCESSOR_I486>: Pass c3, winchip2 or winchip-c6 for\n+\tsignature_CENTAUR_ebx.\n+\t<case PROCESSOR _PENTIUMPRO>: Pass c3-2 for signature_CENTAUR_ebx.\n+\t<default>: Pass x86-64 for has_longmode.\n+\n 2016-06-01  Nathan Sidwell  <nathan@acm.org>\n \n \t* config/nvptx/nvptx.c (nvptx_assemble_undefined_decl): Reject"}, {"sha": "a9d5135f678ef65a6f8f90cae25e270447f0deee", "filename": "gcc/config/i386/driver-i386.c", "status": "modified", "additions": 44, "deletions": 29, "changes": 73, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/4bdf739d7146908d64d9a2020df5263a10bedb9c/gcc%2Fconfig%2Fi386%2Fdriver-i386.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/4bdf739d7146908d64d9a2020df5263a10bedb9c/gcc%2Fconfig%2Fi386%2Fdriver-i386.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fconfig%2Fi386%2Fdriver-i386.c?ref=4bdf739d7146908d64d9a2020df5263a10bedb9c", "patch": "@@ -637,33 +637,27 @@ const char *host_detect_local_cpu (int argc, const char **argv)\n     }\n   else if (vendor == signature_CENTAUR_ebx)\n     {\n-      if (arch)\n+      processor = PROCESSOR_GENERIC;\n+\n+      switch (family)\n \t{\n-\t  switch (family)\n-\t    {\n-\t    case 6:\n-\t      if (model > 9)\n-\t\t/* Use the default detection procedure.  */\n-\t\tprocessor = PROCESSOR_GENERIC;\n-\t      else if (model == 9)\n-\t\tcpu = \"c3-2\";\n-\t      else if (model >= 6)\n-\t\tcpu = \"c3\";\n-\t      else\n-\t\tprocessor = PROCESSOR_GENERIC;\n-\t      break;\n-\t    case 5:\n-\t      if (has_3dnow)\n-\t\tcpu = \"winchip2\";\n-\t      else if (has_mmx)\n-\t\tcpu = \"winchip2-c6\";\n-\t      else\n-\t\tprocessor = PROCESSOR_GENERIC;\n-\t      break;\n-\t    default:\n-\t      /* We have no idea.  */\n-\t      processor = PROCESSOR_GENERIC;\n-\t    }\n+\tdefault:\n+\t  /* We have no idea.  */\n+\t  break;\n+\n+\tcase 5:\n+\t  if (has_3dnow || has_mmx)\n+\t    processor = PROCESSOR_I486;\n+\t  break;\n+\n+\tcase 6:\n+\t  if (model > 9 || has_longmode)\n+\t    /* Use the default detection procedure.  */\n+\t    ;\n+\t  else if (model == 9)\n+\t    processor = PROCESSOR_PENTIUMPRO;\n+\t  else if (model >= 6)\n+\t    processor = PROCESSOR_I486;\n \t}\n     }\n   else\n@@ -694,7 +688,18 @@ const char *host_detect_local_cpu (int argc, const char **argv)\n       /* Default.  */\n       break;\n     case PROCESSOR_I486:\n-      cpu = \"i486\";\n+      if (arch && vendor == signature_CENTAUR_ebx)\n+\t{\n+\t  if (model >= 6)\n+\t    cpu = \"c3\";\n+\t  else if (has_3dnow)\n+\t    cpu = \"winchip2\";\n+\t  else\n+\t    /* Assume WinChip C6.  */\n+\t    cpu = \"winchip-c6\";\n+\t}\n+      else\n+\tcpu = \"i486\";\n       break;\n     case PROCESSOR_PENTIUM:\n       if (arch && has_mmx)\n@@ -817,8 +822,13 @@ const char *host_detect_local_cpu (int argc, const char **argv)\n \t\t/* It is Pentium M.  */\n \t\tcpu = \"pentium-m\";\n \t      else if (has_sse)\n-\t\t/* It is Pentium III.  */\n-\t\tcpu = \"pentium3\";\n+\t\t{\n+\t\t  if (vendor == signature_CENTAUR_ebx)\n+\t\t    cpu = \"c3-2\";\n+\t\t  else\n+\t\t    /* It is Pentium III.  */\n+\t\t    cpu = \"pentium3\";\n+\t\t}\n \t      else if (has_mmx)\n \t\t/* It is Pentium II.  */\n \t\tcpu = \"pentium2\";\n@@ -902,6 +912,11 @@ const char *host_detect_local_cpu (int argc, const char **argv)\n \t      else\n \t\tcpu = \"prescott\";\n \t    }\n+\t  else if (has_longmode)\n+\t    /* Perhaps some emulator?  Assume x86-64, otherwise gcc\n+\t       -march=native would be unusable for 64-bit compilations,\n+\t       as all the CPUs below are 32-bit only.  */\n+\t    cpu = \"x86-64\";\n \t  else if (has_sse2)\n \t    cpu = \"pentium4\";\n \t  else if (has_cmov)"}]}