{"sha": "b6e22db8564827c82108e0b7fa1a84675379c12b", "node_id": "C_kwDOANBUbNoAKGI2ZTIyZGI4NTY0ODI3YzgyMTA4ZTBiN2ZhMWE4NDY3NTM3OWMxMmI", "commit": {"author": {"name": "Steve Kargl", "email": "kargl@gcc.gnu.org", "date": "2022-04-25T07:23:56Z"}, "committer": {"name": "Richard Biener", "email": "rguenther@suse.de", "date": "2022-04-25T07:25:33Z"}, "message": "target/89125 - BSD and math functions\n\nBack story: When GCC is configured and built on non-glibc platforms,\nit seems very little to no effort is made to enumerate the available\nC99 libm functions.  It is all or nothing for C99 libm.  The patch\nintroduces a new function, used on only FreeBSD, to inform gcc that\nit has C99 libm functions (minus a few which clearly GCC does not check\nnor test).\n\n2022-04-15  Steven G. Kargl  <kargl@gcc.gnu.org>\n\n\tPR target/89125\n\t* config/freebsd.h: Define TARGET_LIBC_HAS_FUNCTION to be\n\tbsd_libc_has_function.\n\t* targhooks.cc (bsd_libc_has_function): New function.\n\tExpand the supported math functions to inclue C99 libm.\n\t* targhooks.h (bsd_libc_has_function): New Prototype.", "tree": {"sha": "824fbab4d7dc1df7f6a6bd17c4e8dff74592467d", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/824fbab4d7dc1df7f6a6bd17c4e8dff74592467d"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/b6e22db8564827c82108e0b7fa1a84675379c12b", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/b6e22db8564827c82108e0b7fa1a84675379c12b", "html_url": "https://github.com/Rust-GCC/gccrs/commit/b6e22db8564827c82108e0b7fa1a84675379c12b", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/b6e22db8564827c82108e0b7fa1a84675379c12b/comments", "author": null, "committer": {"login": "rguenth", "id": 2046526, "node_id": "MDQ6VXNlcjIwNDY1MjY=", "avatar_url": "https://avatars.githubusercontent.com/u/2046526?v=4", "gravatar_id": "", "url": "https://api.github.com/users/rguenth", "html_url": "https://github.com/rguenth", "followers_url": "https://api.github.com/users/rguenth/followers", "following_url": "https://api.github.com/users/rguenth/following{/other_user}", "gists_url": "https://api.github.com/users/rguenth/gists{/gist_id}", "starred_url": "https://api.github.com/users/rguenth/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/rguenth/subscriptions", "organizations_url": "https://api.github.com/users/rguenth/orgs", "repos_url": "https://api.github.com/users/rguenth/repos", "events_url": "https://api.github.com/users/rguenth/events{/privacy}", "received_events_url": "https://api.github.com/users/rguenth/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "4f77738c3b44cb6b7bfe2a7ef823a5d9d75c0e79", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/4f77738c3b44cb6b7bfe2a7ef823a5d9d75c0e79", "html_url": "https://github.com/Rust-GCC/gccrs/commit/4f77738c3b44cb6b7bfe2a7ef823a5d9d75c0e79"}], "stats": {"total": 17, "additions": 16, "deletions": 1}, "files": [{"sha": "d89ee7dfc97ec67ba7d6b02715b5834cf5c3f03f", "filename": "gcc/config/freebsd.h", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/b6e22db8564827c82108e0b7fa1a84675379c12b/gcc%2Fconfig%2Ffreebsd.h", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/b6e22db8564827c82108e0b7fa1a84675379c12b/gcc%2Fconfig%2Ffreebsd.h", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fconfig%2Ffreebsd.h?ref=b6e22db8564827c82108e0b7fa1a84675379c12b", "patch": "@@ -55,7 +55,7 @@ along with GCC; see the file COPYING3.  If not see\n #endif\n \n #undef TARGET_LIBC_HAS_FUNCTION\n-#define TARGET_LIBC_HAS_FUNCTION no_c99_libc_has_function\n+#define TARGET_LIBC_HAS_FUNCTION bsd_libc_has_function\n \n /* Use --as-needed -lgcc_s for eh support.  */\n #ifdef HAVE_LD_AS_NEEDED"}, {"sha": "399d6f874dcc6adc88cffc4d9dceebce6b0af0d3", "filename": "gcc/targhooks.cc", "status": "modified", "additions": 14, "deletions": 0, "changes": 14, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/b6e22db8564827c82108e0b7fa1a84675379c12b/gcc%2Ftarghooks.cc", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/b6e22db8564827c82108e0b7fa1a84675379c12b/gcc%2Ftarghooks.cc", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftarghooks.cc?ref=b6e22db8564827c82108e0b7fa1a84675379c12b", "patch": "@@ -1843,6 +1843,20 @@ no_c99_libc_has_function (enum function_class fn_class ATTRIBUTE_UNUSED,\n   return false;\n }\n \n+/* Assume some c99 functions are present at the runtime including sincos.  */\n+bool\n+bsd_libc_has_function (enum function_class fn_class,\n+\t\t       tree type ATTRIBUTE_UNUSED)\n+{\n+  if (fn_class == function_c94\n+      || fn_class == function_c99_misc\n+      || fn_class == function_sincos)\n+    return true;\n+\n+  return false;\n+}\n+\n+\n tree\n default_builtin_tm_load_store (tree ARG_UNUSED (type))\n {"}, {"sha": "ecce55ebe797cedc940620e8d89816973a045d49", "filename": "gcc/targhooks.h", "status": "modified", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/b6e22db8564827c82108e0b7fa1a84675379c12b/gcc%2Ftarghooks.h", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/b6e22db8564827c82108e0b7fa1a84675379c12b/gcc%2Ftarghooks.h", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftarghooks.h?ref=b6e22db8564827c82108e0b7fa1a84675379c12b", "patch": "@@ -212,6 +212,7 @@ extern bool default_libc_has_function (enum function_class, tree);\n extern bool default_libc_has_fast_function (int fcode);\n extern bool no_c99_libc_has_function (enum function_class, tree);\n extern bool gnu_libc_has_function (enum function_class, tree);\n+extern bool bsd_libc_has_function (enum function_class, tree);\n \n extern tree default_builtin_tm_load_store (tree);\n "}]}