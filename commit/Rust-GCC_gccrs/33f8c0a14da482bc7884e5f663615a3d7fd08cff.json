{"sha": "33f8c0a14da482bc7884e5f663615a3d7fd08cff", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6MzNmOGMwYTE0ZGE0ODJiYzc4ODRlNWY2NjM2MTVhM2Q3ZmQwOGNmZg==", "commit": {"author": {"name": "Marek Polacek", "email": "polacek@redhat.com", "date": "2017-05-19T15:30:54Z"}, "committer": {"name": "Marek Polacek", "email": "mpolacek@gcc.gnu.org", "date": "2017-05-19T15:30:54Z"}, "message": "re PR sanitizer/80800 (UBSAN: yet another false positive)\n\n\tPR sanitizer/80800\n\t* fold-const.c (extract_muldiv_1) <case TRUNC_DIV_EXPR>: Add\n\tTYPE_OVERFLOW_WRAPS checks.\n\n\t* c-c++-common/ubsan/pr80800.c: New test.\n\t* c-c++-common/Wduplicated-branches-1.c: Adjust an expression.\n\nFrom-SVN: r248291", "tree": {"sha": "0c42b764c20d321089046e2fa134c11df25dbbdd", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/0c42b764c20d321089046e2fa134c11df25dbbdd"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/33f8c0a14da482bc7884e5f663615a3d7fd08cff", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/33f8c0a14da482bc7884e5f663615a3d7fd08cff", "html_url": "https://github.com/Rust-GCC/gccrs/commit/33f8c0a14da482bc7884e5f663615a3d7fd08cff", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/33f8c0a14da482bc7884e5f663615a3d7fd08cff/comments", "author": {"login": "mpolacek", "id": 10496300, "node_id": "MDQ6VXNlcjEwNDk2MzAw", "avatar_url": "https://avatars.githubusercontent.com/u/10496300?v=4", "gravatar_id": "", "url": "https://api.github.com/users/mpolacek", "html_url": "https://github.com/mpolacek", "followers_url": "https://api.github.com/users/mpolacek/followers", "following_url": "https://api.github.com/users/mpolacek/following{/other_user}", "gists_url": "https://api.github.com/users/mpolacek/gists{/gist_id}", "starred_url": "https://api.github.com/users/mpolacek/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/mpolacek/subscriptions", "organizations_url": "https://api.github.com/users/mpolacek/orgs", "repos_url": "https://api.github.com/users/mpolacek/repos", "events_url": "https://api.github.com/users/mpolacek/events{/privacy}", "received_events_url": "https://api.github.com/users/mpolacek/received_events", "type": "User", "site_admin": false}, "committer": null, "parents": [{"sha": "ff50231797977a56a0d256db645f1e004c6acf00", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/ff50231797977a56a0d256db645f1e004c6acf00", "html_url": "https://github.com/Rust-GCC/gccrs/commit/ff50231797977a56a0d256db645f1e004c6acf00"}], "stats": {"total": 41, "additions": 40, "deletions": 1}, "files": [{"sha": "00aa02c67b1bfb9df6de3a65de3b38104b756f36", "filename": "gcc/ChangeLog", "status": "modified", "additions": 6, "deletions": 0, "changes": 6, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/33f8c0a14da482bc7884e5f663615a3d7fd08cff/gcc%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/33f8c0a14da482bc7884e5f663615a3d7fd08cff/gcc%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2FChangeLog?ref=33f8c0a14da482bc7884e5f663615a3d7fd08cff", "patch": "@@ -1,3 +1,9 @@\n+2017-05-19  Marek Polacek  <polacek@redhat.com>\n+\n+\tPR sanitizer/80800\n+\t* fold-const.c (extract_muldiv_1) <case TRUNC_DIV_EXPR>: Add\n+\tTYPE_OVERFLOW_WRAPS checks.\n+\n 2017-05-19  Thomas Schwinge  <thomas@codesourcery.com>\n \n \t* tree-core.h (enum omp_clause_default_kind): Add"}, {"sha": "736552c33a9af3876bfd01f3cf47a078dec6558b", "filename": "gcc/fold-const.c", "status": "modified", "additions": 2, "deletions": 0, "changes": 2, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/33f8c0a14da482bc7884e5f663615a3d7fd08cff/gcc%2Ffold-const.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/33f8c0a14da482bc7884e5f663615a3d7fd08cff/gcc%2Ffold-const.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ffold-const.c?ref=33f8c0a14da482bc7884e5f663615a3d7fd08cff", "patch": "@@ -6281,11 +6281,13 @@ extract_muldiv_1 (tree t, tree c, enum tree_code code, tree wide_type,\n \t new operation.  Likewise for the RHS from a MULT_EXPR.  Otherwise,\n \t do something only if the second operand is a constant.  */\n       if (same_p\n+\t  && TYPE_OVERFLOW_WRAPS (ctype)\n \t  && (t1 = extract_muldiv (op0, c, code, wide_type,\n \t\t\t\t   strict_overflow_p)) != 0)\n \treturn fold_build2 (tcode, ctype, fold_convert (ctype, t1),\n \t\t\t    fold_convert (ctype, op1));\n       else if (tcode == MULT_EXPR && code == MULT_EXPR\n+\t       && TYPE_OVERFLOW_WRAPS (ctype)\n \t       && (t1 = extract_muldiv (op1, c, code, wide_type,\n \t\t\t\t\tstrict_overflow_p)) != 0)\n \treturn fold_build2 (tcode, ctype, fold_convert (ctype, op0),"}, {"sha": "dafa0343d1abc2b37dfe71d65382b52e63d32795", "filename": "gcc/testsuite/ChangeLog", "status": "modified", "additions": 6, "deletions": 0, "changes": 6, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/33f8c0a14da482bc7884e5f663615a3d7fd08cff/gcc%2Ftestsuite%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/33f8c0a14da482bc7884e5f663615a3d7fd08cff/gcc%2Ftestsuite%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2FChangeLog?ref=33f8c0a14da482bc7884e5f663615a3d7fd08cff", "patch": "@@ -1,3 +1,9 @@\n+2017-05-19  Marek Polacek  <polacek@redhat.com>\n+\n+\tPR sanitizer/80800\n+\t* c-c++-common/ubsan/pr80800.c: New test.\n+\t* c-c++-common/Wduplicated-branches-1.c: Adjust an expression.\n+\n 2017-05-19  Thomas Schwinge  <thomas@codesourcery.com>\n \n \t* c-c++-common/goacc/default-1.c: Update."}, {"sha": "7c5062d83d09a482e290cd6e6143120788c3a1d4", "filename": "gcc/testsuite/c-c++-common/Wduplicated-branches-1.c", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/33f8c0a14da482bc7884e5f663615a3d7fd08cff/gcc%2Ftestsuite%2Fc-c%2B%2B-common%2FWduplicated-branches-1.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/33f8c0a14da482bc7884e5f663615a3d7fd08cff/gcc%2Ftestsuite%2Fc-c%2B%2B-common%2FWduplicated-branches-1.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fc-c%2B%2B-common%2FWduplicated-branches-1.c?ref=33f8c0a14da482bc7884e5f663615a3d7fd08cff", "patch": "@@ -89,7 +89,7 @@ f (int i, int *p)\n   if (i == 8) /* { dg-warning \"this condition has identical branches\" } */\n     return i * 8 * i * 8;\n   else\n-    return 8 * i * 8 * i;\n+    return i * 8 * i * 8;\n \n \n   if (i == 9) /* { dg-warning \"this condition has identical branches\" } */"}, {"sha": "992c136de186de056e80d0b6de1870bc7850de71", "filename": "gcc/testsuite/c-c++-common/ubsan/pr80800.c", "status": "added", "additions": 25, "deletions": 0, "changes": 25, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/33f8c0a14da482bc7884e5f663615a3d7fd08cff/gcc%2Ftestsuite%2Fc-c%2B%2B-common%2Fubsan%2Fpr80800.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/33f8c0a14da482bc7884e5f663615a3d7fd08cff/gcc%2Ftestsuite%2Fc-c%2B%2B-common%2Fubsan%2Fpr80800.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fc-c%2B%2B-common%2Fubsan%2Fpr80800.c?ref=33f8c0a14da482bc7884e5f663615a3d7fd08cff", "patch": "@@ -0,0 +1,25 @@\n+/* PR sanitizer/80800 */\n+/* { dg-do run } */\n+/* { dg-options \"-fsanitize=undefined -fsanitize-undefined-trap-on-error\" } */\n+\n+int n = 20000;\n+int z = 0;\n+\n+int\n+fn1 (void)\n+{\n+  return (n * 10000 * z) * 50;\n+}\n+\n+int\n+fn2 (void)\n+{\n+  return (10000 * n * z) * 50;\n+}\n+\n+int\n+main ()\n+{\n+  fn1 ();\n+  fn2 ();\n+}"}]}