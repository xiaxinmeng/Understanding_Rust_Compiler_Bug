{"sha": "710ee218547fc4ecbcba7a0f1dff73ce51fffb7b", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6NzEwZWUyMTg1NDdmYzRlY2JjYmE3YTBmMWRmZjczY2U1MWZmZmI3Yg==", "commit": {"author": {"name": "Cesar Philippidis", "email": "cesar@codesourcery.com", "date": "2015-07-24T14:38:43Z"}, "committer": {"name": "Cesar Philippidis", "email": "cesar@gcc.gnu.org", "date": "2015-07-24T14:38:43Z"}, "message": "re PR libgomp/66714 (ICE in loc_list_from_tree with -g)\n\n\tPR 66714\n\n\tgcc/\n\t* tree-cfg.c (struct replace_decls_d): New struct.\n\t(replace_block_vars_by_duplicates_1): New function.\n\t(replace_block_vars_by_duplicates): Use it to replace the decls\n\tin the value exprs by duplicates.\n\n\tlibgomp/\n\t* testsuite/libgomp.c/pr66714.c: New test.\n\nFrom-SVN: r226160", "tree": {"sha": "4caf60c4272974485ca33f106b3ebe2e407dc7d9", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/4caf60c4272974485ca33f106b3ebe2e407dc7d9"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/710ee218547fc4ecbcba7a0f1dff73ce51fffb7b", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/710ee218547fc4ecbcba7a0f1dff73ce51fffb7b", "html_url": "https://github.com/Rust-GCC/gccrs/commit/710ee218547fc4ecbcba7a0f1dff73ce51fffb7b", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/710ee218547fc4ecbcba7a0f1dff73ce51fffb7b/comments", "author": {"login": "cesarjp", "id": 4576177, "node_id": "MDQ6VXNlcjQ1NzYxNzc=", "avatar_url": "https://avatars.githubusercontent.com/u/4576177?v=4", "gravatar_id": "", "url": "https://api.github.com/users/cesarjp", "html_url": "https://github.com/cesarjp", "followers_url": "https://api.github.com/users/cesarjp/followers", "following_url": "https://api.github.com/users/cesarjp/following{/other_user}", "gists_url": "https://api.github.com/users/cesarjp/gists{/gist_id}", "starred_url": "https://api.github.com/users/cesarjp/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/cesarjp/subscriptions", "organizations_url": "https://api.github.com/users/cesarjp/orgs", "repos_url": "https://api.github.com/users/cesarjp/repos", "events_url": "https://api.github.com/users/cesarjp/events{/privacy}", "received_events_url": "https://api.github.com/users/cesarjp/received_events", "type": "User", "site_admin": false}, "committer": null, "parents": [{"sha": "009cea8635f5266381322e0450dfa72758a89c4c", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/009cea8635f5266381322e0450dfa72758a89c4c", "html_url": "https://github.com/Rust-GCC/gccrs/commit/009cea8635f5266381322e0450dfa72758a89c4c"}], "stats": {"total": 68, "additions": 67, "deletions": 1}, "files": [{"sha": "87375082ca0d5d5076b7fe484d28337d4664e5e4", "filename": "gcc/ChangeLog", "status": "modified", "additions": 8, "deletions": 0, "changes": 8, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/710ee218547fc4ecbcba7a0f1dff73ce51fffb7b/gcc%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/710ee218547fc4ecbcba7a0f1dff73ce51fffb7b/gcc%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2FChangeLog?ref=710ee218547fc4ecbcba7a0f1dff73ce51fffb7b", "patch": "@@ -1,3 +1,11 @@\n+2015-07-24  Cesar Philippidis  <cesar@codesourcery.com>\n+\n+\tPR 66714\n+\t* tree-cfg.c (struct replace_decls_d): New struct.\n+\t(replace_block_vars_by_duplicates_1): New function.\n+\t(replace_block_vars_by_duplicates): Use it to replace the decls\n+\tin the value exprs by duplicates.\n+\n 2015-07-24  Szabolcs Nagy  <szabolcs.nagy@arm.com>\n \n \t* config/aarch64/aarch64-elf-raw.h (LINK_SPEC): Handle -h, -static,"}, {"sha": "e26454a617d878bae2955bf2fee3d503afe9e042", "filename": "gcc/tree-cfg.c", "status": "modified", "additions": 38, "deletions": 1, "changes": 39, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/710ee218547fc4ecbcba7a0f1dff73ce51fffb7b/gcc%2Ftree-cfg.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/710ee218547fc4ecbcba7a0f1dff73ce51fffb7b/gcc%2Ftree-cfg.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftree-cfg.c?ref=710ee218547fc4ecbcba7a0f1dff73ce51fffb7b", "patch": "@@ -71,6 +71,7 @@ along with GCC; see the file COPYING3.  If not see\n #include \"omp-low.h\"\n #include \"tree-cfgcleanup.h\"\n #include \"wide-int-print.h\"\n+#include \"gimplify.h\"\n \n /* This file contains functions for building the Control Flow Graph (CFG)\n    for a function tree.  */\n@@ -109,6 +110,13 @@ struct cfg_stats_d\n \n static struct cfg_stats_d cfg_stats;\n \n+/* Data to pass to replace_block_vars_by_duplicates_1.  */\n+struct replace_decls_d\n+{\n+  hash_map<tree, tree> *vars_map;\n+  tree to_context;\n+};\n+\n /* Hash table to store last discriminator assigned for each locus.  */\n struct locus_discrim_map\n {\n@@ -6853,6 +6861,31 @@ new_label_mapper (tree decl, void *data)\n   return m->to;\n }\n \n+/* Tree walker to replace the decls used inside value expressions by\n+   duplicates.  */\n+\n+static tree\n+replace_block_vars_by_duplicates_1 (tree *tp, int *walk_subtrees, void *data)\n+{\n+  struct replace_decls_d *rd = (struct replace_decls_d *)data;\n+\n+  switch (TREE_CODE (*tp))\n+    {\n+    case VAR_DECL:\n+    case PARM_DECL:\n+    case RESULT_DECL:\n+      replace_by_duplicate_decl (tp, rd->vars_map, rd->to_context);\n+      break;\n+    default:\n+      break;\n+    }\n+\n+  if (IS_TYPE_OR_DECL_P (*tp))\n+    *walk_subtrees = false;\n+\n+  return NULL;\n+}\n+\n /* Change DECL_CONTEXT of all BLOCK_VARS in block, including\n    subblocks.  */\n \n@@ -6872,7 +6905,11 @@ replace_block_vars_by_duplicates (tree block, hash_map<tree, tree> *vars_map,\n \t{\n \t  if (TREE_CODE (*tp) == VAR_DECL && DECL_HAS_VALUE_EXPR_P (*tp))\n \t    {\n-\t      SET_DECL_VALUE_EXPR (t, DECL_VALUE_EXPR (*tp));\n+\t      tree x = DECL_VALUE_EXPR (*tp);\n+\t      struct replace_decls_d rd = { vars_map, to_context };\n+\t      unshare_expr (x);\n+\t      walk_tree (&x, replace_block_vars_by_duplicates_1, &rd, NULL);\n+\t      SET_DECL_VALUE_EXPR (t, x);\n \t      DECL_HAS_VALUE_EXPR_P (t) = 1;\n \t    }\n \t  DECL_CHAIN (t) = DECL_CHAIN (*tp);"}, {"sha": "d2189928577b675bb3e3baf9572ff7c5d8cdd9a1", "filename": "libgomp/ChangeLog", "status": "modified", "additions": 4, "deletions": 0, "changes": 4, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/710ee218547fc4ecbcba7a0f1dff73ce51fffb7b/libgomp%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/710ee218547fc4ecbcba7a0f1dff73ce51fffb7b/libgomp%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libgomp%2FChangeLog?ref=710ee218547fc4ecbcba7a0f1dff73ce51fffb7b", "patch": "@@ -1,3 +1,7 @@\n+2015-07-24  Cesar Philippidis  <cesar@codesourcery.com>\n+\n+\t* testsuite/libgomp.c/pr66714.c: New test.\n+\n 2015-07-22  Maxim Blumenthal  <maxim.blumenthal@intel.com>\n \n \tPR libgomp/66950"}, {"sha": "c9af4a9b4a242b6209d5a08c9ccf65669929dba0", "filename": "libgomp/testsuite/libgomp.c/pr66714.c", "status": "added", "additions": 17, "deletions": 0, "changes": 17, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/710ee218547fc4ecbcba7a0f1dff73ce51fffb7b/libgomp%2Ftestsuite%2Flibgomp.c%2Fpr66714.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/710ee218547fc4ecbcba7a0f1dff73ce51fffb7b/libgomp%2Ftestsuite%2Flibgomp.c%2Fpr66714.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libgomp%2Ftestsuite%2Flibgomp.c%2Fpr66714.c?ref=710ee218547fc4ecbcba7a0f1dff73ce51fffb7b", "patch": "@@ -0,0 +1,17 @@\n+/* { dg-do \"compile\" } */\n+/* { dg-additional-options \"--param ggc-min-expand=0\" } */\n+/* { dg-additional-options \"--param ggc-min-heapsize=0\" } */\n+/* { dg-additional-options \"-g\" } */\n+\n+/* Minimized from on target-2.c.  */\n+\n+void\n+fn3 (int x)\n+{\n+  double b[3 * x];\n+  int i;\n+#pragma omp target\n+#pragma omp parallel for\n+  for (i = 0; i < x; i++)\n+    b[i] += 1;\n+}"}]}