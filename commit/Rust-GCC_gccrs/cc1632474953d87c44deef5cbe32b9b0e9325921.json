{"sha": "cc1632474953d87c44deef5cbe32b9b0e9325921", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6Y2MxNjMyNDc0OTUzZDg3YzQ0ZGVlZjVjYmUzMmI5YjBlOTMyNTkyMQ==", "commit": {"author": {"name": "Kaz Kojima", "email": "kkojima@gcc.gnu.org", "date": "2011-12-17T03:19:40Z"}, "committer": {"name": "Kaz Kojima", "email": "kkojima@gcc.gnu.org", "date": "2011-12-17T03:19:40Z"}, "message": "configure.tgt: Add sh* case.\n\n\t* configure.tgt: Add sh* case.\n\t* config/sh/target.h: New file.\n\t* config/sh/sjlj.S: New file.\n\t* config/linux/sh/futex_bits.h: New file.\n\nFrom-SVN: r182429", "tree": {"sha": "bfbefbc8546afc2741244528819f4c713ec0b4cc", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/bfbefbc8546afc2741244528819f4c713ec0b4cc"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/cc1632474953d87c44deef5cbe32b9b0e9325921", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/cc1632474953d87c44deef5cbe32b9b0e9325921", "html_url": "https://github.com/Rust-GCC/gccrs/commit/cc1632474953d87c44deef5cbe32b9b0e9325921", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/cc1632474953d87c44deef5cbe32b9b0e9325921/comments", "author": null, "committer": null, "parents": [{"sha": "9199539aef06d924600aeb86052ae078c611698c", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/9199539aef06d924600aeb86052ae078c611698c", "html_url": "https://github.com/Rust-GCC/gccrs/commit/9199539aef06d924600aeb86052ae078c611698c"}], "stats": {"total": 232, "additions": 232, "deletions": 0}, "files": [{"sha": "ff93a53ba9f02f0765b6a9f15cdddeefcd00e26d", "filename": "libitm/ChangeLog", "status": "modified", "additions": 7, "deletions": 0, "changes": 7, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/cc1632474953d87c44deef5cbe32b9b0e9325921/libitm%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/cc1632474953d87c44deef5cbe32b9b0e9325921/libitm%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libitm%2FChangeLog?ref=cc1632474953d87c44deef5cbe32b9b0e9325921", "patch": "@@ -1,3 +1,10 @@\n+2011-12-17  Kaz Kojima  <kkojima@gcc.gnu.org>\n+\n+\t* configure.tgt: Add sh* case.\n+\t* config/sh/target.h: New file.\n+\t* config/sh/sjlj.S: New file.\n+\t* config/linux/sh/futex_bits.h: New file.\n+\n 2011-12-14  Richard Henderson  <rth@redhat.com>\n \n \t* config/arm/hwcap.h, config/arm/hwcap.cc: New files."}, {"sha": "f9381ed6cda6990b85d8ce87b429ff4dbf9a517f", "filename": "libitm/config/linux/sh/futex_bits.h", "status": "added", "additions": 50, "deletions": 0, "changes": 50, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/cc1632474953d87c44deef5cbe32b9b0e9325921/libitm%2Fconfig%2Flinux%2Fsh%2Ffutex_bits.h", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/cc1632474953d87c44deef5cbe32b9b0e9325921/libitm%2Fconfig%2Flinux%2Fsh%2Ffutex_bits.h", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libitm%2Fconfig%2Flinux%2Fsh%2Ffutex_bits.h?ref=cc1632474953d87c44deef5cbe32b9b0e9325921", "patch": "@@ -0,0 +1,50 @@\n+/* Copyright (C) 2011 Free Software Foundation, Inc.\n+\n+   This file is part of the GNU Transactional Memory Library (libitm).\n+\n+   Libitm is free software; you can redistribute it and/or modify it\n+   under the terms of the GNU General Public License as published by\n+   the Free Software Foundation; either version 3 of the License, or\n+   (at your option) any later version.\n+\n+   Libitm is distributed in the hope that it will be useful, but WITHOUT ANY\n+   WARRANTY; without even the implied warranty of MERCHANTABILITY or FITNESS\n+   FOR A PARTICULAR PURPOSE.  See the GNU General Public License for\n+   more details.\n+\n+   Under Section 7 of GPL version 3, you are granted additional\n+   permissions described in the GCC Runtime Library Exception, version\n+   3.1, as published by the Free Software Foundation.\n+\n+   You should have received a copy of the GNU General Public License and\n+   a copy of the GCC Runtime Library Exception along with this program;\n+   see the files COPYING3 and COPYING.RUNTIME respectively.  If not, see\n+   <http://www.gnu.org/licenses/>.  */\n+\n+/* Provide target-specific access to the futex system call.  */\n+\n+#include <sys/syscall.h>\n+\n+/* 4 instruction cycles not accessing cache and TLB are needed after\n+   trapa instruction to avoid an SH-4 silicon bug.  */\n+\n+#define SYSCALL_WITH_INST_PAD \"\\\n+       trapa #0x14; or r0,r0; or r0,r0; or r0,r0; or r0,r0; or r0,r0\"\n+\n+static inline long\n+sys_futex0 (int *addr, long op, long val)\n+{\n+  int __status;\n+  register long __r3 asm (\"r3\") = SYS_futex;\n+  register long __r4 asm (\"r4\") = (long) addr;\n+  register long __r5 asm (\"r5\") = op;\n+  register long __r6 asm (\"r6\") = val;\n+  register long __r7 asm (\"r7\") = 0;\n+\n+  __asm __volatile (SYSCALL_WITH_INST_PAD\n+\t\t    : \"=z\" (__status)\n+\t\t    : \"r\" (__r3), \"r\" (__r4), \"r\" (__r5),\n+\t\t    \"r\" (__r6), \"r\" (__r7)\n+\t\t    : \"memory\", \"t\");\n+  return __status;\n+}"}, {"sha": "dfd5cc0d9927364f39af4e55e6bde66f9d8c09d2", "filename": "libitm/config/sh/sjlj.S", "status": "added", "additions": 122, "deletions": 0, "changes": 122, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/cc1632474953d87c44deef5cbe32b9b0e9325921/libitm%2Fconfig%2Fsh%2Fsjlj.S", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/cc1632474953d87c44deef5cbe32b9b0e9325921/libitm%2Fconfig%2Fsh%2Fsjlj.S", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libitm%2Fconfig%2Fsh%2Fsjlj.S?ref=cc1632474953d87c44deef5cbe32b9b0e9325921", "patch": "@@ -0,0 +1,122 @@\n+/* Copyright (C) 2011 Free Software Foundation, Inc.\n+\n+   This file is part of the GNU Transactional Memory Library (libitm).\n+\n+   Libitm is free software; you can redistribute it and/or modify it\n+   under the terms of the GNU General Public License as published by\n+   the Free Software Foundation; either version 3 of the License, or\n+   (at your option) any later version.\n+\n+   Libitm is distributed in the hope that it will be useful, but WITHOUT ANY\n+   WARRANTY; without even the implied warranty of MERCHANTABILITY or FITNESS\n+   FOR A PARTICULAR PURPOSE.  See the GNU General Public License for\n+   more details.\n+\n+   Under Section 7 of GPL version 3, you are granted additional\n+   permissions described in the GCC Runtime Library Exception, version\n+   3.1, as published by the Free Software Foundation.\n+\n+   You should have received a copy of the GNU General Public License and\n+   a copy of the GCC Runtime Library Exception along with this program;\n+   see the files COPYING3 and COPYING.RUNTIME respectively.  If not, see\n+   <http://www.gnu.org/licenses/>.  */\n+\n+#include \"asmcfi.h\"\n+\n+\t.text\n+\t.align\t2\n+\t.global\t_ITM_beginTransaction\n+\t.type\t_ITM_beginTransaction, %function\n+\n+_ITM_beginTransaction:\n+\tcfi_startproc\n+\tmov\tr15, r1\n+#ifdef __SH_FPU_ANY__\n+\tfmov.s\tfr15, @-r15\n+\tfmov.s\tfr14, @-r15\n+\tfmov.s\tfr13, @-r15\n+\tfmov.s\tfr12, @-r15\n+\tsts.l\tfpscr, @-r15\n+#endif /* __SH_FPU_ANY__ */\n+\tstc.l\tgbr, @-r15\n+\tsts.l\tpr, @-r15\n+\tmov.l\tr1, @-r15\n+\tmov.l\tr14, @-r15\n+\tmov.l\tr13, @-r15\n+\tmov.l\tr12, @-r15\n+\tmov.l\tr11, @-r15\n+\tmov.l\tr10, @-r15\n+\tmov.l\tr9, @-r15\n+\tmov.l\tr8, @-r15\n+#ifdef __SH_FPU_ANY__\n+\tcfi_def_cfa_offset (4*15)\n+#else\n+\tcfi_def_cfa_offset (4*10)\n+#endif\n+#if defined HAVE_ATTRIBUTE_VISIBILITY || !defined __PIC__\n+\tmov.l\t.Lbegin, r1\n+\tjsr\t@r1\n+\t mov\tr15, r5\n+#else\n+\tmova\t.Lgot, r0\n+\tmov.l\t.Lgot, r12\n+\tadd\tr0, r12\n+\tmov.l\t.Lbegin, r1\n+\tbsrf\tr1\n+\t mov\tr15, r5\n+.Lbegin0:\n+\tmov.l\t@(4*4,r15), r12\n+#endif\n+\tmov.l\t@(8*4,r15), r1\n+\tlds\tr1, pr\n+#ifdef __SH_FPU_ANY__\n+\tadd\t#(15*4), r15\n+#else\n+\tadd\t#(10*5), r15\n+#endif\n+\tcfi_def_cfa_offset (0)\n+\trts\n+\t nop\n+\tcfi_endproc\n+\n+        .align  2\n+.Lgot:\n+\t.long\t_GLOBAL_OFFSET_TABLE_\n+.Lbegin:\n+#if defined HAVE_ATTRIBUTE_VISIBILITY || !defined __PIC__\n+\t.long\tGTM_begin_transaction\n+#else\n+\t.long\tGTM_begin_transaction@PLT-(.Lbegin0-.)\n+#endif\n+\t.size\t_ITM_beginTransaction, . - _ITM_beginTransaction\n+\n+\t.global\tGTM_longjmp\n+\t.hidden\tGTM_longjmp\n+\t.type\tGTM_longjmp, %function\n+\n+GTM_longjmp:\n+\tmov.l\t@r5+, r8\n+\tmov.l\t@r5+, r9\n+\tmov.l\t@r5+, r10\n+\tmov.l\t@r5+, r11\n+\tmov.l\t@r5+, r12\n+\tmov.l\t@r5+, r13\n+\tmov.l\t@r5+, r14\n+\tmov.l\t@r5+, r15\n+\tlds.l\t@r5+, pr\n+\tldc.l\t@r5+, gbr\n+#ifdef __SH_FPU_ANY__\n+\tlds.l\t@r5+, fpscr\n+\tfmov.s\t@r5+, fr12\n+\tfmov.s\t@r5+, fr13\n+\tfmov.s\t@r5+, fr14\n+\tfmov.s\t@r5+, fr15\n+#endif\n+\trts\n+\t mov\tr4, r0\n+\n+\t.size\tGTM_longjmp, . - GTM_longjmp\n+\n+#ifdef __linux__\n+.section .note.GNU-stack, \"\", %progbits\n+#endif"}, {"sha": "2868ee3032aa04584e7e85e28c33da18c56e871b", "filename": "libitm/config/sh/target.h", "status": "added", "additions": 51, "deletions": 0, "changes": 51, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/cc1632474953d87c44deef5cbe32b9b0e9325921/libitm%2Fconfig%2Fsh%2Ftarget.h", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/cc1632474953d87c44deef5cbe32b9b0e9325921/libitm%2Fconfig%2Fsh%2Ftarget.h", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libitm%2Fconfig%2Fsh%2Ftarget.h?ref=cc1632474953d87c44deef5cbe32b9b0e9325921", "patch": "@@ -0,0 +1,51 @@\n+/* Copyright (C) 2011 Free Software Foundation, Inc.\n+\n+   This file is part of the GNU Transactional Memory Library (libitm).\n+\n+   Libitm is free software; you can redistribute it and/or modify it\n+   under the terms of the GNU General Public License as published by\n+   the Free Software Foundation; either version 3 of the License, or\n+   (at your option) any later version.\n+\n+   Libitm is distributed in the hope that it will be useful, but WITHOUT ANY\n+   WARRANTY; without even the implied warranty of MERCHANTABILITY or FITNESS\n+   FOR A PARTICULAR PURPOSE.  See the GNU General Public License for\n+   more details.\n+\n+   Under Section 7 of GPL version 3, you are granted additional\n+   permissions described in the GCC Runtime Library Exception, version\n+   3.1, as published by the Free Software Foundation.\n+\n+   You should have received a copy of the GNU General Public License and\n+   a copy of the GCC Runtime Library Exception along with this program;\n+   see the files COPYING3 and COPYING.RUNTIME respectively.  If not, see\n+   <http://www.gnu.org/licenses/>.  */\n+\n+namespace GTM HIDDEN {\n+\n+typedef struct gtm_jmpbuf\n+{\n+  unsigned long s[7];\t/* r8-r14 */\n+  void *cfa;\n+  unsigned long pc;\n+  unsigned long gbr;\n+#ifdef __SH_FPU_ANY__\n+  unsigned long fpscr;\n+  unsigned long f[4];\t/* fr12-fr15 */\n+#endif\n+} gtm_jmpbuf;\n+\n+/* SH generally uses a fixed page size of 4K.  */\n+#define PAGE_SIZE\t4096\n+#define FIXED_PAGE_SIZE\t1\n+\n+/* ??? The size of one line in hardware caches (in bytes). */\n+#define HW_CACHELINE_SIZE 32\n+\n+static inline void\n+cpu_relax (void)\n+{\n+  __asm volatile (\"\" : : : \"memory\");\n+}\n+\n+} // namespace GTM"}, {"sha": "8d43cd410d4342d00c8793bc8624aa6c20cc7e97", "filename": "libitm/configure.tgt", "status": "modified", "additions": 2, "deletions": 0, "changes": 2, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/cc1632474953d87c44deef5cbe32b9b0e9325921/libitm%2Fconfigure.tgt", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/cc1632474953d87c44deef5cbe32b9b0e9325921/libitm%2Fconfigure.tgt", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libitm%2Fconfigure.tgt?ref=cc1632474953d87c44deef5cbe32b9b0e9325921", "patch": "@@ -63,6 +63,8 @@ case \"${target_cpu}\" in\n \tARCH=x86\n \t;;\n \n+  sh*)\t\tARCH=sh ;;\n+\n   x86_64)\n \tcase \" ${CC} ${CFLAGS} \" in\n \t  *\" -m32 \"*)"}]}