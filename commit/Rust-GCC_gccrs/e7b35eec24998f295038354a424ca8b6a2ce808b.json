{"sha": "e7b35eec24998f295038354a424ca8b6a2ce808b", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6ZTdiMzVlZWMyNDk5OGYyOTUwMzgzNTRhNDI0Y2E4YjZhMmNlODA4Yg==", "commit": {"author": {"name": "Tom Tromey", "email": "tromey@redhat.com", "date": "2001-11-19T00:31:37Z"}, "committer": {"name": "Tom Tromey", "email": "tromey@gcc.gnu.org", "date": "2001-11-19T00:31:37Z"}, "message": "verify.cc (_Jv_BytecodeVerifier::pop_type): Put PC into error message.\n\n\t* verify.cc (_Jv_BytecodeVerifier::pop_type): Put PC into error\n\tmessage.\n\t(_Jv_BytecodeVerifier::pop64): Likewise.\n\t(_Jv_BytecodeVerifier::pop32): Likewise.\n\t(_Jv_BytecodeVerifier::pop_raw): Likewise.\n\t(_Jv_BytecodeVerifier::pop_type): Promote the match type.\n\t(type::set_initialized): Only modify uninitialized types.\n\t(type::set_uninitialized): Fix shadowing bug.  Simplify code.\n\nFrom-SVN: r47158", "tree": {"sha": "fca4c0afbe6be4db09f2e125e67db3f1fa699867", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/fca4c0afbe6be4db09f2e125e67db3f1fa699867"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/e7b35eec24998f295038354a424ca8b6a2ce808b", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/e7b35eec24998f295038354a424ca8b6a2ce808b", "html_url": "https://github.com/Rust-GCC/gccrs/commit/e7b35eec24998f295038354a424ca8b6a2ce808b", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/e7b35eec24998f295038354a424ca8b6a2ce808b/comments", "author": null, "committer": null, "parents": [{"sha": "392447923f91ba4ae478cf7e131eee21250e7f49", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/392447923f91ba4ae478cf7e131eee21250e7f49", "html_url": "https://github.com/Rust-GCC/gccrs/commit/392447923f91ba4ae478cf7e131eee21250e7f49"}], "stats": {"total": 37, "additions": 25, "deletions": 12}, "files": [{"sha": "0afaa103bbb85d18d33e122d7ba62aad864dc31f", "filename": "libjava/ChangeLog", "status": "modified", "additions": 9, "deletions": 0, "changes": 9, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/e7b35eec24998f295038354a424ca8b6a2ce808b/libjava%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/e7b35eec24998f295038354a424ca8b6a2ce808b/libjava%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libjava%2FChangeLog?ref=e7b35eec24998f295038354a424ca8b6a2ce808b", "patch": "@@ -1,5 +1,14 @@\n 2001-11-18  Tom Tromey  <tromey@redhat.com>\n \n+\t* verify.cc (_Jv_BytecodeVerifier::pop_type): Put PC into error\n+\tmessage.\n+\t(_Jv_BytecodeVerifier::pop64): Likewise.\n+\t(_Jv_BytecodeVerifier::pop32): Likewise.\n+\t(_Jv_BytecodeVerifier::pop_raw): Likewise.\n+\t(_Jv_BytecodeVerifier::pop_type): Promote the match type.\n+\t(type::set_initialized): Only modify uninitialized types.\n+\t(type::set_uninitialized): Fix shadowing bug.  Simplify code.\n+\n \t* verify.cc: Include StringBuffer.h.\n \t(verify_fail): Added pc argument.  Use StringBuffer to construct\n \texception message."}, {"sha": "5d8fd809de7dc177b17411b0516d3fdb39f8a0e3", "filename": "libjava/verify.cc", "status": "modified", "additions": 16, "deletions": 12, "changes": 28, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/e7b35eec24998f295038354a424ca8b6a2ce808b/libjava%2Fverify.cc", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/e7b35eec24998f295038354a424ca8b6a2ce808b/libjava%2Fverify.cc", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libjava%2Fverify.cc?ref=e7b35eec24998f295038354a424ca8b6a2ce808b", "patch": "@@ -353,20 +353,23 @@ class _Jv_BytecodeVerifier\n     }\n \n     // Mark this type as the uninitialized result of `new'.\n-    void set_uninitialized (int pc)\n+    void set_uninitialized (int npc)\n     {\n-      if (key != reference_type && key != unresolved_reference_type)\n+      if (key == reference_type)\n+\tkey = uninitialized_reference_type;\n+      else if (key == unresolved_reference_type)\n+\tkey = uninitialized_unresolved_reference_type;\n+      else\n \tverify_fail (\"internal error in type::uninitialized\");\n-      key = (key == reference_type\n-\t     ? uninitialized_reference_type\n-\t     : uninitialized_unresolved_reference_type);\n-      pc = pc;\n+      pc = npc;\n     }\n \n     // Mark this type as now initialized.\n     void set_initialized (int npc)\n     {\n-      if (pc == npc)\n+      if (npc != UNINIT && pc == npc\n+\t  && (key == uninitialized_reference_type\n+\t      || key == uninitialized_unresolved_reference_type))\n \t{\n \t  key = (key == uninitialized_reference_type\n \t\t ? reference_type\n@@ -834,35 +837,36 @@ class _Jv_BytecodeVerifier\n   type pop_raw ()\n   {\n     if (current_state->stacktop <= 0)\n-      verify_fail (\"stack empty\");\n+      verify_fail (\"stack empty\", start_PC);\n     type r = current_state->stack[--current_state->stacktop];\n     current_state->stackdepth -= r.depth ();\n     if (current_state->stackdepth < 0)\n-      verify_fail (\"stack empty\");\n+      verify_fail (\"stack empty\", start_PC);\n     return r;\n   }\n \n   type pop32 ()\n   {\n     type r = pop_raw ();\n     if (r.iswide ())\n-      verify_fail (\"narrow pop of wide type\");\n+      verify_fail (\"narrow pop of wide type\", start_PC);\n     return r;\n   }\n \n   type pop64 ()\n   {\n     type r = pop_raw ();\n     if (! r.iswide ())\n-      verify_fail (\"wide pop of narrow type\");\n+      verify_fail (\"wide pop of narrow type\", start_PC);\n     return r;\n   }\n \n   type pop_type (type match)\n   {\n+    match.promote ();\n     type t = pop_raw ();\n     if (! match.compatible (t))\n-      verify_fail (\"incompatible type on stack\");\n+      verify_fail (\"incompatible type on stack\", start_PC);\n     return t;\n   }\n "}]}