{"sha": "ac742ebc793e3e7a443cca4d9165686445ea81be", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6YWM3NDJlYmM3OTNlM2U3YTQ0M2NjYTRkOTE2NTY4NjQ0NWVhODFiZQ==", "commit": {"author": {"name": "Philip Herron", "email": "philip.herron@embecosm.com", "date": "2020-11-30T10:42:13Z"}, "committer": {"name": "Philip Herron", "email": "philip.herron@embecosm.com", "date": "2020-11-30T10:42:13Z"}, "message": "Linemap and Backend are both singletons\n\nWe can only create on linemap instance to avoid missing locations in error\ndiagnostics. We also only need one instance of the backend.", "tree": {"sha": "71c29414cf8a0ff0fd815cdc894ef7c5c5409944", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/71c29414cf8a0ff0fd815cdc894ef7c5c5409944"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/ac742ebc793e3e7a443cca4d9165686445ea81be", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/ac742ebc793e3e7a443cca4d9165686445ea81be", "html_url": "https://github.com/Rust-GCC/gccrs/commit/ac742ebc793e3e7a443cca4d9165686445ea81be", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/ac742ebc793e3e7a443cca4d9165686445ea81be/comments", "author": {"login": "philberty", "id": 84585, "node_id": "MDQ6VXNlcjg0NTg1", "avatar_url": "https://avatars.githubusercontent.com/u/84585?v=4", "gravatar_id": "", "url": "https://api.github.com/users/philberty", "html_url": "https://github.com/philberty", "followers_url": "https://api.github.com/users/philberty/followers", "following_url": "https://api.github.com/users/philberty/following{/other_user}", "gists_url": "https://api.github.com/users/philberty/gists{/gist_id}", "starred_url": "https://api.github.com/users/philberty/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/philberty/subscriptions", "organizations_url": "https://api.github.com/users/philberty/orgs", "repos_url": "https://api.github.com/users/philberty/repos", "events_url": "https://api.github.com/users/philberty/events{/privacy}", "received_events_url": "https://api.github.com/users/philberty/received_events", "type": "User", "site_admin": false}, "committer": {"login": "philberty", "id": 84585, "node_id": "MDQ6VXNlcjg0NTg1", "avatar_url": "https://avatars.githubusercontent.com/u/84585?v=4", "gravatar_id": "", "url": "https://api.github.com/users/philberty", "html_url": "https://github.com/philberty", "followers_url": "https://api.github.com/users/philberty/followers", "following_url": "https://api.github.com/users/philberty/following{/other_user}", "gists_url": "https://api.github.com/users/philberty/gists{/gist_id}", "starred_url": "https://api.github.com/users/philberty/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/philberty/subscriptions", "organizations_url": "https://api.github.com/users/philberty/orgs", "repos_url": "https://api.github.com/users/philberty/repos", "events_url": "https://api.github.com/users/philberty/events{/privacy}", "received_events_url": "https://api.github.com/users/philberty/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "4a9f0d53b81be96b5fe3731a5408bd981158b8e0", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/4a9f0d53b81be96b5fe3731a5408bd981158b8e0", "html_url": "https://github.com/Rust-GCC/gccrs/commit/4a9f0d53b81be96b5fe3731a5408bd981158b8e0"}], "stats": {"total": 10, "additions": 7, "deletions": 3}, "files": [{"sha": "dd9398b675ce81fed82ab78e9e428aff2837eb77", "filename": "gcc/rust/rust-session-manager.cc", "status": "modified", "additions": 7, "deletions": 3, "changes": 10, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/ac742ebc793e3e7a443cca4d9165686445ea81be/gcc%2Frust%2Frust-session-manager.cc", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/ac742ebc793e3e7a443cca4d9165686445ea81be/gcc%2Frust%2Frust-session-manager.cc", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Frust%2Frust-session-manager.cc?ref=ac742ebc793e3e7a443cca4d9165686445ea81be", "patch": "@@ -279,6 +279,12 @@ Session::init ()\n \n   // derived values from hook\n   options.target_data.init_derived_values ();\n+\n+  // setup singleton linemap\n+  linemap = rust_get_linemap ();\n+\n+  // setup backend to GCC GIMPLE\n+  backend = rust_get_backend ();\n }\n \n /* Initialise default options. Actually called before handle_option, unlike init\n@@ -416,12 +422,10 @@ Session::parse_file (const char *filename)\n       rust_fatal_error (Location (), \"cannot open filename %s: %m\", filename);\n     }\n \n-  Backend *backend = rust_get_backend ();\n-\n   // parse file here\n   /* create lexer and parser - these are file-specific and so aren't instance\n    * variables */\n-  Lexer lex (filename, std::move (file_wrap), rust_get_linemap ());\n+  Lexer lex (filename, std::move (file_wrap), linemap);\n   Parser<Lexer> parser (std::move (lex));\n \n   // generate crate from parser"}]}