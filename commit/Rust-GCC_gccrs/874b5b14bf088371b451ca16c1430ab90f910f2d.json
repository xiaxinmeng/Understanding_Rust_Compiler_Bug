{"sha": "874b5b14bf088371b451ca16c1430ab90f910f2d", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6ODc0YjViMTRiZjA4ODM3MWI0NTFjYTE2YzE0MzBhYjkwZjkxMGYyZA==", "commit": {"author": {"name": "Richard Henderson", "email": "rth@redhat.com", "date": "2002-01-31T07:10:49Z"}, "committer": {"name": "Richard Henderson", "email": "rth@gcc.gnu.org", "date": "2002-01-31T07:10:49Z"}, "message": "ifcvt.c (dead_or_predicable): Handling merging when other_bb and new_dest are the same.\n\n        * ifcvt.c (dead_or_predicable): Handling merging when other_bb\n        and new_dest are the same.\n\nFrom-SVN: r49366", "tree": {"sha": "e8ee41c165b7791dab1fa09eba719d4f6fe3d177", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/e8ee41c165b7791dab1fa09eba719d4f6fe3d177"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/874b5b14bf088371b451ca16c1430ab90f910f2d", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/874b5b14bf088371b451ca16c1430ab90f910f2d", "html_url": "https://github.com/Rust-GCC/gccrs/commit/874b5b14bf088371b451ca16c1430ab90f910f2d", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/874b5b14bf088371b451ca16c1430ab90f910f2d/comments", "author": null, "committer": null, "parents": [{"sha": "89cf7be58283b2720f38a5c8605969ba813e5f7b", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/89cf7be58283b2720f38a5c8605969ba813e5f7b", "html_url": "https://github.com/Rust-GCC/gccrs/commit/89cf7be58283b2720f38a5c8605969ba813e5f7b"}], "stats": {"total": 69, "additions": 45, "deletions": 24}, "files": [{"sha": "bfc1972bfeab6c85640a06417ec8436ff2d06fa4", "filename": "gcc/ChangeLog", "status": "modified", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/874b5b14bf088371b451ca16c1430ab90f910f2d/gcc%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/874b5b14bf088371b451ca16c1430ab90f910f2d/gcc%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2FChangeLog?ref=874b5b14bf088371b451ca16c1430ab90f910f2d", "patch": "@@ -1,3 +1,8 @@\n+2002-01-30  Richard Henderson  <rth@redhat.com>\n+\n+\t* ifcvt.c (dead_or_predicable): Handling merging when other_bb\n+\tand new_dest are the same.\n+\n 2002-01-30  Richard Henderson  <rth@redhat.com>\n \n \tPR opt/5076"}, {"sha": "5a9a85438f5366651058e2e12fc1159b0b768e80", "filename": "gcc/ifcvt.c", "status": "modified", "additions": 40, "deletions": 24, "changes": 64, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/874b5b14bf088371b451ca16c1430ab90f910f2d/gcc%2Fifcvt.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/874b5b14bf088371b451ca16c1430ab90f910f2d/gcc%2Fifcvt.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fifcvt.c?ref=874b5b14bf088371b451ca16c1430ab90f910f2d", "patch": "@@ -2629,35 +2629,41 @@ dead_or_predicable (test_bb, merge_bb, other_bb, new_dest, reversep)\n      change group management.  */\n \n   old_dest = JUMP_LABEL (jump);\n-  new_label = block_label (new_dest);\n-  if (reversep\n-      ? ! invert_jump_1 (jump, new_label)\n-      : ! redirect_jump_1 (jump, new_label))\n-    goto cancel;\n+  if (other_bb != new_dest)\n+    {\n+      new_label = block_label (new_dest);\n+      if (reversep\n+\t  ? ! invert_jump_1 (jump, new_label)\n+\t  : ! redirect_jump_1 (jump, new_label))\n+\tgoto cancel;\n+    }\n \n   if (! apply_change_group ())\n     return FALSE;\n \n-  if (old_dest)\n-    LABEL_NUSES (old_dest) -= 1;\n-  if (new_label)\n-    LABEL_NUSES (new_label) += 1;\n-  JUMP_LABEL (jump) = new_label;\n-\n-  if (reversep)\n-    invert_br_probabilities (jump);\n-\n-  redirect_edge_succ (BRANCH_EDGE (test_bb), new_dest);\n-  if (reversep)\n+  if (other_bb != new_dest)\n     {\n-      gcov_type count, probability;\n-      count = BRANCH_EDGE (test_bb)->count;\n-      BRANCH_EDGE (test_bb)->count = FALLTHRU_EDGE (test_bb)->count;\n-      FALLTHRU_EDGE (test_bb)->count = count;\n-      probability = BRANCH_EDGE (test_bb)->probability;\n-      BRANCH_EDGE (test_bb)->probability = FALLTHRU_EDGE (test_bb)->probability;\n-      FALLTHRU_EDGE (test_bb)->probability = probability;\n-      update_br_prob_note (test_bb);\n+      if (old_dest)\n+\tLABEL_NUSES (old_dest) -= 1;\n+      if (new_label)\n+\tLABEL_NUSES (new_label) += 1;\n+      JUMP_LABEL (jump) = new_label;\n+      if (reversep)\n+\tinvert_br_probabilities (jump);\n+\n+      redirect_edge_succ (BRANCH_EDGE (test_bb), new_dest);\n+      if (reversep)\n+\t{\n+\t  gcov_type count, probability;\n+\t  count = BRANCH_EDGE (test_bb)->count;\n+\t  BRANCH_EDGE (test_bb)->count = FALLTHRU_EDGE (test_bb)->count;\n+\t  FALLTHRU_EDGE (test_bb)->count = count;\n+\t  probability = BRANCH_EDGE (test_bb)->probability;\n+\t  BRANCH_EDGE (test_bb)->probability\n+\t    = FALLTHRU_EDGE (test_bb)->probability;\n+\t  FALLTHRU_EDGE (test_bb)->probability = probability;\n+\t  update_br_prob_note (test_bb);\n+\t}\n     }\n \n   /* Move the insns out of MERGE_BB to before the branch.  */\n@@ -2671,6 +2677,16 @@ dead_or_predicable (test_bb, merge_bb, other_bb, new_dest, reversep)\n \n       reorder_insns (head, end, PREV_INSN (earliest));\n     }\n+\n+  /* Remove the jump and edge if we can.  */\n+  if (other_bb == new_dest)\n+    {\n+      delete_insn (jump);\n+      remove_edge (BRANCH_EDGE (test_bb));\n+      /* ??? Can't merge blocks here, as then_bb is still in use.\n+\t At minimum, the merge will get done just before bb-reorder.  */\n+    }\n+\n   return TRUE;\n \n  cancel:"}]}