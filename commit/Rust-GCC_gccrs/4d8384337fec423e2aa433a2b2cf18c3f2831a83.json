{"sha": "4d8384337fec423e2aa433a2b2cf18c3f2831a83", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6NGQ4Mzg0MzM3ZmVjNDIzZTJhYTQzM2EyYjJjZjE4YzNmMjgzMWE4Mw==", "commit": {"author": {"name": "Tim Shen", "email": "timshen@google.com", "date": "2014-10-23T03:15:52Z"}, "committer": {"name": "Tim Shen", "email": "timshen@gcc.gnu.org", "date": "2014-10-23T03:15:52Z"}, "message": "re PR libstdc++/63497 (std::regex can't handle [^class] correctly and cause runtime crash)\n\n\tPR libstdc++/63497\n\tinclude/bits/regex_executor.h (_Executor::_M_word_boundary): Remove\n\tunused parameter.\n\tinclude/bits/regex_executor.tcc (_Executor::_M_dfs,\n\t_Executor::_M_word_boundary): Avoid dereferecing _M_current at _M_end\n\tor other invalid position.\n\nFrom-SVN: r216572", "tree": {"sha": "7e600eb384ed26afa726a1135f6e5d794e91a417", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/7e600eb384ed26afa726a1135f6e5d794e91a417"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/4d8384337fec423e2aa433a2b2cf18c3f2831a83", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/4d8384337fec423e2aa433a2b2cf18c3f2831a83", "html_url": "https://github.com/Rust-GCC/gccrs/commit/4d8384337fec423e2aa433a2b2cf18c3f2831a83", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/4d8384337fec423e2aa433a2b2cf18c3f2831a83/comments", "author": {"login": "timshen91", "id": 1157432, "node_id": "MDQ6VXNlcjExNTc0MzI=", "avatar_url": "https://avatars.githubusercontent.com/u/1157432?v=4", "gravatar_id": "", "url": "https://api.github.com/users/timshen91", "html_url": "https://github.com/timshen91", "followers_url": "https://api.github.com/users/timshen91/followers", "following_url": "https://api.github.com/users/timshen91/following{/other_user}", "gists_url": "https://api.github.com/users/timshen91/gists{/gist_id}", "starred_url": "https://api.github.com/users/timshen91/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/timshen91/subscriptions", "organizations_url": "https://api.github.com/users/timshen91/orgs", "repos_url": "https://api.github.com/users/timshen91/repos", "events_url": "https://api.github.com/users/timshen91/events{/privacy}", "received_events_url": "https://api.github.com/users/timshen91/received_events", "type": "User", "site_admin": false}, "committer": null, "parents": [{"sha": "a3317c924706aef535d0ef78f040ba46237a4131", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/a3317c924706aef535d0ef78f040ba46237a4131", "html_url": "https://github.com/Rust-GCC/gccrs/commit/a3317c924706aef535d0ef78f040ba46237a4131"}], "stats": {"total": 50, "additions": 31, "deletions": 19}, "files": [{"sha": "4b1240d7e1a4fc06fc87593967216e8828a591cc", "filename": "libstdc++-v3/ChangeLog", "status": "modified", "additions": 9, "deletions": 0, "changes": 9, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/4d8384337fec423e2aa433a2b2cf18c3f2831a83/libstdc%2B%2B-v3%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/4d8384337fec423e2aa433a2b2cf18c3f2831a83/libstdc%2B%2B-v3%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libstdc%2B%2B-v3%2FChangeLog?ref=4d8384337fec423e2aa433a2b2cf18c3f2831a83", "patch": "@@ -1,3 +1,12 @@\n+2014-10-23  Tim Shen  <timshen@google.com>\n+\n+\tPR libstdc++/63497\n+\tinclude/bits/regex_executor.h (_Executor::_M_word_boundary): Remove\n+\tunused parameter.\n+\tinclude/bits/regex_executor.tcc (_Executor::_M_dfs,\n+\t_Executor::_M_word_boundary): Avoid dereferecing _M_current at _M_end\n+\tor other invalid position.\n+\n 2014-10-21  Joern Rennecke  <joern.rennecke@embecosm.com>\n \n \t* testsuite/util/io/prog_bar.cc: Qualify size_t."}, {"sha": "b26992c9a4be2d6f1faa88388b9e7ca3c705f181", "filename": "libstdc++-v3/include/bits/regex_executor.h", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/4d8384337fec423e2aa433a2b2cf18c3f2831a83/libstdc%2B%2B-v3%2Finclude%2Fbits%2Fregex_executor.h", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/4d8384337fec423e2aa433a2b2cf18c3f2831a83/libstdc%2B%2B-v3%2Finclude%2Fbits%2Fregex_executor.h", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libstdc%2B%2B-v3%2Finclude%2Fbits%2Fregex_executor.h?ref=4d8384337fec423e2aa433a2b2cf18c3f2831a83", "patch": "@@ -145,7 +145,7 @@ _GLIBCXX_BEGIN_NAMESPACE_VERSION\n       }\n \n       bool\n-      _M_word_boundary(_State<_TraitsT> __state) const;\n+      _M_word_boundary() const;\n \n       bool\n       _M_lookahead(_State<_TraitsT> __state);"}, {"sha": "38d4781b0c53e09662728e997b2cbfa3104c8cdd", "filename": "libstdc++-v3/include/bits/regex_executor.tcc", "status": "modified", "additions": 21, "deletions": 18, "changes": 39, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/4d8384337fec423e2aa433a2b2cf18c3f2831a83/libstdc%2B%2B-v3%2Finclude%2Fbits%2Fregex_executor.tcc", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/4d8384337fec423e2aa433a2b2cf18c3f2831a83/libstdc%2B%2B-v3%2Finclude%2Fbits%2Fregex_executor.tcc", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libstdc%2B%2B-v3%2Finclude%2Fbits%2Fregex_executor.tcc?ref=4d8384337fec423e2aa433a2b2cf18c3f2831a83", "patch": "@@ -274,7 +274,7 @@ _GLIBCXX_BEGIN_NAMESPACE_VERSION\n \t    _M_dfs(__match_mode, __state._M_next);\n \t  break;\n \tcase _S_opcode_word_boundary:\n-\t  if (_M_word_boundary(__state) == !__state._M_neg)\n+\t  if (_M_word_boundary() == !__state._M_neg)\n \t    _M_dfs(__match_mode, __state._M_next);\n \t  break;\n \t// Here __state._M_alt offers a single start node for a sub-NFA.\n@@ -284,9 +284,11 @@ _GLIBCXX_BEGIN_NAMESPACE_VERSION\n \t    _M_dfs(__match_mode, __state._M_next);\n \t  break;\n \tcase _S_opcode_match:\n+\t  if (_M_current == _M_end)\n+\t    break;\n \t  if (__dfs_mode)\n \t    {\n-\t      if (_M_current != _M_end && __state._M_matches(*_M_current))\n+\t      if (__state._M_matches(*_M_current))\n \t\t{\n \t\t  ++_M_current;\n \t\t  _M_dfs(__match_mode, __state._M_next);\n@@ -407,25 +409,26 @@ _GLIBCXX_BEGIN_NAMESPACE_VERSION\n   template<typename _BiIter, typename _Alloc, typename _TraitsT,\n \t   bool __dfs_mode>\n     bool _Executor<_BiIter, _Alloc, _TraitsT, __dfs_mode>::\n-    _M_word_boundary(_State<_TraitsT>) const\n+    _M_word_boundary() const\n     {\n-      // By definition.\n-      bool __ans = false;\n-      auto __pre = _M_current;\n-      --__pre;\n-      if (!(_M_at_begin() && _M_at_end()))\n+      bool __left_is_word = false;\n+      if (_M_current != _M_begin\n+\t  || (_M_flags & regex_constants::match_prev_avail))\n \t{\n-\t  if (_M_at_begin())\n-\t    __ans = _M_is_word(*_M_current)\n-\t      && !(_M_flags & regex_constants::match_not_bow);\n-\t  else if (_M_at_end())\n-\t    __ans = _M_is_word(*__pre)\n-\t      && !(_M_flags & regex_constants::match_not_eow);\n-\t  else\n-\t    __ans = _M_is_word(*_M_current)\n-\t      != _M_is_word(*__pre);\n+\t  auto __prev = _M_current;\n+\t  if (_M_is_word(*std::prev(__prev)))\n+\t    __left_is_word = true;\n \t}\n-      return __ans;\n+      bool __right_is_word =\n+        _M_current != _M_end && _M_is_word(*_M_current);\n+\n+      if (__left_is_word == __right_is_word)\n+\treturn false;\n+      if (__left_is_word && !(_M_flags & regex_constants::match_not_eow))\n+\treturn true;\n+      if (__right_is_word && !(_M_flags & regex_constants::match_not_bow))\n+\treturn true;\n+      return false;\n     }\n \n _GLIBCXX_END_NAMESPACE_VERSION"}]}