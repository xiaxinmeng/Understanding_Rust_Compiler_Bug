{"sha": "da0747b9b5fc1a2cd1027d735ec848981f4c2a8b", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6ZGEwNzQ3YjliNWZjMWEyY2QxMDI3ZDczNWVjODQ4OTgxZjRjMmE4Yg==", "commit": {"author": {"name": "Jerry DeLisle", "email": "jvdelisle@gcc.gnu.org", "date": "2010-08-07T12:03:23Z"}, "committer": {"name": "Jerry DeLisle", "email": "jvdelisle@gcc.gnu.org", "date": "2010-08-07T12:03:23Z"}, "message": "re PR fortran/45143 ([F2008,corrig1] Endless loop with unlimited edit descriptor)\n\n2010-08-07  Jerry DeLisle  <jvdelisle@gcc.gnu.org>\n\n\tPR libfortran/45143\n\t* io/format.c: Remove fnode storage structure definitions, moving these\n\tto format.h. (parse_format_list): Add check for data descriptors,\n\ttaking care of nested formats. Adjust calling parameters to pass a\n\tcheck flag. (parse_format): Likewise.\n\t* io/format.h: Add structures moved from format.c.\n\nFrom-SVN: r162978", "tree": {"sha": "e361e077e38cbeb001aa5fd94b09e7ed63796741", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/e361e077e38cbeb001aa5fd94b09e7ed63796741"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/da0747b9b5fc1a2cd1027d735ec848981f4c2a8b", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/da0747b9b5fc1a2cd1027d735ec848981f4c2a8b", "html_url": "https://github.com/Rust-GCC/gccrs/commit/da0747b9b5fc1a2cd1027d735ec848981f4c2a8b", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/da0747b9b5fc1a2cd1027d735ec848981f4c2a8b/comments", "author": null, "committer": null, "parents": [{"sha": "17fec01dd404942b3c0656a56b45dfe7ea668da0", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/17fec01dd404942b3c0656a56b45dfe7ea668da0", "html_url": "https://github.com/Rust-GCC/gccrs/commit/17fec01dd404942b3c0656a56b45dfe7ea668da0"}], "stats": {"total": 81, "additions": 51, "deletions": 30}, "files": [{"sha": "6e0ec80714f4a97c9d8a0a43b9b521dc0374c46c", "filename": "libgfortran/ChangeLog", "status": "modified", "additions": 9, "deletions": 0, "changes": 9, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/da0747b9b5fc1a2cd1027d735ec848981f4c2a8b/libgfortran%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/da0747b9b5fc1a2cd1027d735ec848981f4c2a8b/libgfortran%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libgfortran%2FChangeLog?ref=da0747b9b5fc1a2cd1027d735ec848981f4c2a8b", "patch": "@@ -1,3 +1,12 @@\n+2010-08-07  Jerry DeLisle  <jvdelisle@gcc.gnu.org>\n+\n+\tPR libfortran/45143\n+\t* io/format.c: Remove fnode storage structure definitions, moving these\n+\tto format.h. (parse_format_list): Add check for data descriptors,\n+\ttaking care of nested formats. Adjust calling parameters to pass a\n+\tcheck flag. (parse_format): Likewise.\n+\t* io/format.h: Add structures moved from format.c.\n+\t\n 2010-08-02  Janne Blomqvist  <jb@gcc.gnu.org>\n \n \t* io/unit.c (update_position): Don't update the position flag for"}, {"sha": "d540fc47e3217cd372d7197bc8e0056c8bf02187", "filename": "libgfortran/io/format.c", "status": "modified", "additions": 16, "deletions": 30, "changes": 46, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/da0747b9b5fc1a2cd1027d735ec848981f4c2a8b/libgfortran%2Fio%2Fformat.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/da0747b9b5fc1a2cd1027d735ec848981f4c2a8b/libgfortran%2Fio%2Fformat.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libgfortran%2Fio%2Fformat.c?ref=da0747b9b5fc1a2cd1027d735ec848981f4c2a8b", "patch": "@@ -35,28 +35,6 @@ see the files COPYING3 and COPYING.RUNTIME respectively.  If not, see\n #include <stdbool.h>\n #include <stdlib.h>\n \n-#define FARRAY_SIZE 64\n-\n-typedef struct fnode_array\n-{\n-  struct fnode_array *next;\n-  fnode array[FARRAY_SIZE];\n-}\n-fnode_array;\n-\n-typedef struct format_data\n-{\n-  char *format_string, *string;\n-  const char *error;\n-  char error_element;\n-  format_token saved_token;\n-  int value, format_string_len, reversion_ok;\n-  fnode *avail;\n-  const fnode *saved_format;\n-  fnode_array *last;\n-  fnode_array array;\n-}\n-format_data;\n \n static const fnode colon_node = { FMT_COLON, 0, NULL, NULL, {{ 0, 0, 0 }}, 0,\n \t\t\t\t  NULL };\n@@ -612,13 +590,13 @@ format_lex (format_data *fmt)\n  * parenthesis node which contains the rest of the list. */\n \n static fnode *\n-parse_format_list (st_parameter_dt *dtp, bool *save_ok)\n+parse_format_list (st_parameter_dt *dtp, bool *save_ok, bool *seen_dd)\n {\n   fnode *head, *tail;\n   format_token t, u, t2;\n   int repeat;\n   format_data *fmt = dtp->u.p.fmt;\n-  bool saveit;\n+  bool saveit, seen_data_desc = false;\n \n   head = tail = NULL;\n   saveit = *save_ok;\n@@ -638,10 +616,14 @@ parse_format_list (st_parameter_dt *dtp, bool *save_ok)\n \t}\n       get_fnode (fmt, &head, &tail, FMT_LPAREN);\n       tail->repeat = -2;  /* Signifies unlimited format.  */\n-      tail->u.child = parse_format_list (dtp, &saveit);\n+      tail->u.child = parse_format_list (dtp, &saveit, &seen_data_desc);\n       if (fmt->error != NULL)\n \tgoto finished;\n-\n+      if (!seen_data_desc)\n+\t{\n+\t  fmt->error = \"'*' requires at least one associated data descriptor\";\n+\t  goto finished;\n+\t}\n       goto between_desc;\n \n     case FMT_POSINT:\n@@ -653,7 +635,8 @@ parse_format_list (st_parameter_dt *dtp, bool *save_ok)\n \tcase FMT_LPAREN:\n \t  get_fnode (fmt, &head, &tail, FMT_LPAREN);\n \t  tail->repeat = repeat;\n-\t  tail->u.child = parse_format_list (dtp, &saveit);\n+\t  tail->u.child = parse_format_list (dtp, &saveit, &seen_data_desc);\n+\t  *seen_dd = seen_data_desc;\n \t  if (fmt->error != NULL)\n \t    goto finished;\n \n@@ -680,7 +663,8 @@ parse_format_list (st_parameter_dt *dtp, bool *save_ok)\n     case FMT_LPAREN:\n       get_fnode (fmt, &head, &tail, FMT_LPAREN);\n       tail->repeat = 1;\n-      tail->u.child = parse_format_list (dtp, &saveit);\n+      tail->u.child = parse_format_list (dtp, &saveit, &seen_data_desc);\n+      *seen_dd = seen_data_desc;\n       if (fmt->error != NULL)\n \tgoto finished;\n \n@@ -821,6 +805,7 @@ parse_format_list (st_parameter_dt *dtp, bool *save_ok)\n     case FMT_F:\n     case FMT_G:\n       repeat = 1;\n+      *seen_dd = true;\n       goto data_desc;\n \n     case FMT_H:\n@@ -1217,7 +1202,7 @@ void\n parse_format (st_parameter_dt *dtp)\n {\n   format_data *fmt;\n-  bool format_cache_ok;\n+  bool format_cache_ok, seen_data_desc = false;\n \n   /* Don't cache for internal units and set an arbitrary limit on the size of\n      format strings we will cache.  (Avoids memory issues.)  */\n@@ -1266,7 +1251,8 @@ parse_format (st_parameter_dt *dtp)\n   fmt->avail++;\n \n   if (format_lex (fmt) == FMT_LPAREN)\n-    fmt->array.array[0].u.child = parse_format_list (dtp, &format_cache_ok);\n+    fmt->array.array[0].u.child = parse_format_list (dtp, &format_cache_ok,\n+\t\t\t\t\t\t     &seen_data_desc);\n   else\n     fmt->error = \"Missing initial left parenthesis in format\";\n "}, {"sha": "84af2e4f2ed2c74efd4205f6a6bc9f2b8c338846", "filename": "libgfortran/io/format.h", "status": "modified", "additions": 26, "deletions": 0, "changes": 26, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/da0747b9b5fc1a2cd1027d735ec848981f4c2a8b/libgfortran%2Fio%2Fformat.h", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/da0747b9b5fc1a2cd1027d735ec848981f4c2a8b/libgfortran%2Fio%2Fformat.h", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libgfortran%2Fio%2Fformat.h?ref=da0747b9b5fc1a2cd1027d735ec848981f4c2a8b", "patch": "@@ -92,6 +92,32 @@ struct fnode\n };\n \n \n+/* A storage structures for format node data.  */\n+\n+#define FARRAY_SIZE 64\n+\n+typedef struct fnode_array\n+{\n+  struct fnode_array *next;\n+  fnode array[FARRAY_SIZE];\n+}\n+fnode_array;\n+\n+\n+typedef struct format_data\n+{\n+  char *format_string, *string;\n+  const char *error;\n+  char error_element;\n+  format_token saved_token;\n+  int value, format_string_len, reversion_ok;\n+  fnode *avail;\n+  const fnode *saved_format;\n+  fnode_array *last;\n+  fnode_array array;\n+}\n+format_data;\n+\n extern void parse_format (st_parameter_dt *);\n internal_proto(parse_format);\n "}]}