{"sha": "cd64be5bcae8c6f0ccf50aac0e0a16f28e23d042", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6Y2Q2NGJlNWJjYWU4YzZmMGNjZjUwYWFjMGUwYTE2ZjI4ZTIzZDA0Mg==", "commit": {"author": {"name": "Eric Botcazou", "email": "ebotcazou@adacore.com", "date": "2016-06-23T15:04:25Z"}, "committer": {"name": "Eric Botcazou", "email": "ebotcazou@gcc.gnu.org", "date": "2016-06-23T15:04:25Z"}, "message": "* tree-inline.c (remap_decl): Preserve DECL_ORIGINAL_TYPE invariant.\n\nFrom-SVN: r237734", "tree": {"sha": "058a7da8b45dfb04128883b6293a77b100704381", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/058a7da8b45dfb04128883b6293a77b100704381"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/cd64be5bcae8c6f0ccf50aac0e0a16f28e23d042", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/cd64be5bcae8c6f0ccf50aac0e0a16f28e23d042", "html_url": "https://github.com/Rust-GCC/gccrs/commit/cd64be5bcae8c6f0ccf50aac0e0a16f28e23d042", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/cd64be5bcae8c6f0ccf50aac0e0a16f28e23d042/comments", "author": null, "committer": null, "parents": [{"sha": "277d7ee0c95456a21ef371aa025791cbef883169", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/277d7ee0c95456a21ef371aa025791cbef883169", "html_url": "https://github.com/Rust-GCC/gccrs/commit/277d7ee0c95456a21ef371aa025791cbef883169"}], "stats": {"total": 19, "additions": 18, "deletions": 1}, "files": [{"sha": "ffa702a73f644915004c2381287fd6d8f4603bf0", "filename": "gcc/ChangeLog", "status": "modified", "additions": 4, "deletions": 0, "changes": 4, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/cd64be5bcae8c6f0ccf50aac0e0a16f28e23d042/gcc%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/cd64be5bcae8c6f0ccf50aac0e0a16f28e23d042/gcc%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2FChangeLog?ref=cd64be5bcae8c6f0ccf50aac0e0a16f28e23d042", "patch": "@@ -1,3 +1,7 @@\n+2016-06-23  Eric Botcazou  <ebotcazou@adacore.com>\n+\n+\t* tree-inline.c (remap_decl): Preserve DECL_ORIGINAL_TYPE invariant.\n+\n 2016-06-23  Andi Kleen  <ak@linux.intel.com>\n \n \t* Makefile.in: Regenerate."}, {"sha": "a0d9e934e6d94271a0fd9f5cfb06935a9c48aa30", "filename": "gcc/tree-inline.c", "status": "modified", "additions": 14, "deletions": 1, "changes": 15, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/cd64be5bcae8c6f0ccf50aac0e0a16f28e23d042/gcc%2Ftree-inline.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/cd64be5bcae8c6f0ccf50aac0e0a16f28e23d042/gcc%2Ftree-inline.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftree-inline.c?ref=cd64be5bcae8c6f0ccf50aac0e0a16f28e23d042", "patch": "@@ -367,7 +367,20 @@ remap_decl (tree decl, copy_body_data *id)\n       /* Remap types, if necessary.  */\n       TREE_TYPE (t) = remap_type (TREE_TYPE (t), id);\n       if (TREE_CODE (t) == TYPE_DECL)\n-        DECL_ORIGINAL_TYPE (t) = remap_type (DECL_ORIGINAL_TYPE (t), id);\n+\t{\n+\t  DECL_ORIGINAL_TYPE (t) = remap_type (DECL_ORIGINAL_TYPE (t), id);\n+\n+\t  /* Preserve the invariant that DECL_ORIGINAL_TYPE != TREE_TYPE,\n+\t     which is enforced in gen_typedef_die when DECL_ABSTRACT_ORIGIN\n+\t     is not set on the TYPE_DECL, for example in LTO mode.  */\n+\t  if (DECL_ORIGINAL_TYPE (t) == TREE_TYPE (t))\n+\t    {\n+\t      tree x = build_variant_type_copy (TREE_TYPE (t));\n+\t      TYPE_STUB_DECL (x) = TYPE_STUB_DECL (TREE_TYPE (t));\n+\t      TYPE_NAME (x) = t;\n+\t      DECL_ORIGINAL_TYPE (t) = x;\n+\t    }\n+\t}\n \n       /* Remap sizes as necessary.  */\n       walk_tree (&DECL_SIZE (t), copy_tree_body_r, id, NULL);"}]}