{"sha": "3a3e1ea9c674e50e402d5410970411ea6590f630", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6M2EzZTFlYTljNjc0ZTUwZTQwMmQ1NDEwOTcwNDExZWE2NTkwZjYzMA==", "commit": {"author": {"name": "Jason Merrill", "email": "jason@redhat.com", "date": "2020-05-11T18:05:46Z"}, "committer": {"name": "Jason Merrill", "email": "jason@redhat.com", "date": "2020-05-11T18:50:13Z"}, "message": "c++: Avoid unnecessary deprecated warnings.\n\nThere's no need to warn that a deprecated function uses a deprecated type,\nthat just adds noise.  We were preventing that in start_decl, but that\ndidn't help member declarations that go through grokfield.  So handle it in\ngrokdeclarator instead, which is shared between them.\n\ngcc/cp/ChangeLog\n2020-05-11  Jason Merrill  <jason@redhat.com>\n\n\t* decl.c (grokdeclarator): Adjust deprecated_state here.\n\t(start_decl): Not here.", "tree": {"sha": "7f8b28a65a9016b5d7d15f38c30b4c1a46d78e91", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/7f8b28a65a9016b5d7d15f38c30b4c1a46d78e91"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/3a3e1ea9c674e50e402d5410970411ea6590f630", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/3a3e1ea9c674e50e402d5410970411ea6590f630", "html_url": "https://github.com/Rust-GCC/gccrs/commit/3a3e1ea9c674e50e402d5410970411ea6590f630", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/3a3e1ea9c674e50e402d5410970411ea6590f630/comments", "author": {"login": "jicama", "id": 266146, "node_id": "MDQ6VXNlcjI2NjE0Ng==", "avatar_url": "https://avatars.githubusercontent.com/u/266146?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jicama", "html_url": "https://github.com/jicama", "followers_url": "https://api.github.com/users/jicama/followers", "following_url": "https://api.github.com/users/jicama/following{/other_user}", "gists_url": "https://api.github.com/users/jicama/gists{/gist_id}", "starred_url": "https://api.github.com/users/jicama/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jicama/subscriptions", "organizations_url": "https://api.github.com/users/jicama/orgs", "repos_url": "https://api.github.com/users/jicama/repos", "events_url": "https://api.github.com/users/jicama/events{/privacy}", "received_events_url": "https://api.github.com/users/jicama/received_events", "type": "User", "site_admin": false}, "committer": {"login": "jicama", "id": 266146, "node_id": "MDQ6VXNlcjI2NjE0Ng==", "avatar_url": "https://avatars.githubusercontent.com/u/266146?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jicama", "html_url": "https://github.com/jicama", "followers_url": "https://api.github.com/users/jicama/followers", "following_url": "https://api.github.com/users/jicama/following{/other_user}", "gists_url": "https://api.github.com/users/jicama/gists{/gist_id}", "starred_url": "https://api.github.com/users/jicama/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jicama/subscriptions", "organizations_url": "https://api.github.com/users/jicama/orgs", "repos_url": "https://api.github.com/users/jicama/repos", "events_url": "https://api.github.com/users/jicama/events{/privacy}", "received_events_url": "https://api.github.com/users/jicama/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "2b2d298ff845ab7a07ffbd51da79473736da3324", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/2b2d298ff845ab7a07ffbd51da79473736da3324", "html_url": "https://github.com/Rust-GCC/gccrs/commit/2b2d298ff845ab7a07ffbd51da79473736da3324"}], "stats": {"total": 27, "additions": 18, "deletions": 9}, "files": [{"sha": "ab5e6abb8668cc2fd8ee8a4c40eb32fd34bf9390", "filename": "gcc/cp/ChangeLog", "status": "modified", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/3a3e1ea9c674e50e402d5410970411ea6590f630/gcc%2Fcp%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/3a3e1ea9c674e50e402d5410970411ea6590f630/gcc%2Fcp%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fcp%2FChangeLog?ref=3a3e1ea9c674e50e402d5410970411ea6590f630", "patch": "@@ -1,3 +1,8 @@\n+2020-05-11  Jason Merrill  <jason@redhat.com>\n+\n+\t* decl.c (grokdeclarator): Adjust deprecated_state here.\n+\t(start_decl): Not here.\n+\n 2020-05-08  Iain Sandoe  <iain@sandoe.co.uk>\n \n \tPR c++/95003"}, {"sha": "adf9465842081430008c0287a616508e4f6c70e8", "filename": "gcc/cp/decl.c", "status": "modified", "additions": 11, "deletions": 7, "changes": 18, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/3a3e1ea9c674e50e402d5410970411ea6590f630/gcc%2Fcp%2Fdecl.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/3a3e1ea9c674e50e402d5410970411ea6590f630/gcc%2Fcp%2Fdecl.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fcp%2Fdecl.c?ref=3a3e1ea9c674e50e402d5410970411ea6590f630", "patch": "@@ -5214,18 +5214,11 @@ start_decl (const cp_declarator *declarator,\n \n   *pushed_scope_p = NULL_TREE;\n \n-  /* An object declared as __attribute__((deprecated)) suppresses\n-     warnings of uses of other deprecated items.  */\n-  if (lookup_attribute (\"deprecated\", attributes))\n-    deprecated_state = DEPRECATED_SUPPRESS;\n-\n   attributes = chainon (attributes, prefix_attributes);\n \n   decl = grokdeclarator (declarator, declspecs, NORMAL, initialized,\n \t\t\t &attributes);\n \n-  deprecated_state = DEPRECATED_NORMAL;\n-\n   if (decl == NULL_TREE || VOID_TYPE_P (decl)\n       || decl == error_mark_node)\n     return error_mark_node;\n@@ -11318,6 +11311,17 @@ grokdeclarator (const cp_declarator *declarator,\n       type = NULL_TREE;\n       type_was_error_mark_node = true;\n     }\n+\n+  /* Ignore erroneous attributes.  */\n+  if (attrlist && *attrlist == error_mark_node)\n+    *attrlist = NULL_TREE;\n+\n+  /* An object declared as __attribute__((deprecated)) suppresses\n+     warnings of uses of other deprecated items.  */\n+  temp_override<deprecated_states> ds (deprecated_state);\n+  if (attrlist && lookup_attribute (\"deprecated\", *attrlist))\n+    deprecated_state = DEPRECATED_SUPPRESS;\n+\n   cp_warn_deprecated_use (type);\n   if (type && TREE_CODE (type) == TYPE_DECL)\n     {"}, {"sha": "605b507f534398e61693729b39a2bca5a766506a", "filename": "gcc/testsuite/g++.dg/warn/deprecated-6.C", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/3a3e1ea9c674e50e402d5410970411ea6590f630/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Fwarn%2Fdeprecated-6.C", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/3a3e1ea9c674e50e402d5410970411ea6590f630/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Fwarn%2Fdeprecated-6.C", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Fwarn%2Fdeprecated-6.C?ref=3a3e1ea9c674e50e402d5410970411ea6590f630", "patch": "@@ -89,7 +89,7 @@ struct SS2 *p2;\t\t\t\t/* { dg-warning \"'SS2' is deprecated: Please avoid SS2\" } */\n class T {\n   public:\n     void member1(int) __attribute__ ((deprecated(\"Please avoid member1\")));\n-    void member2(INT1) __attribute__ ((__deprecated__(\"Please avoid member2\"))); /* { dg-warning \"'INT1' is deprecated\" } */\n+    void member2(INT1) __attribute__ ((__deprecated__(\"Please avoid member2\")));\n     int member3(T *);\n     int x;\n } __attribute__ ((deprecated(\"Please avoid T\")));"}, {"sha": "3817e620250bfe4585707e09d391212304dc1c2d", "filename": "gcc/testsuite/g++.dg/warn/deprecated.C", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/3a3e1ea9c674e50e402d5410970411ea6590f630/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Fwarn%2Fdeprecated.C", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/3a3e1ea9c674e50e402d5410970411ea6590f630/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Fwarn%2Fdeprecated.C", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Fwarn%2Fdeprecated.C?ref=3a3e1ea9c674e50e402d5410970411ea6590f630", "patch": "@@ -93,7 +93,7 @@ struct SS2 *p2;\t\t\t\t/* { dg-warning \"'SS2' is deprecated\" } */\n class T {\n   public:\n     void member1(int) __attribute__ ((deprecated));\n-    void member2(INT1) __attribute__ ((__deprecated__)); /* { dg-warning \"'INT1' is deprecated\" } */\n+    void member2(INT1) __attribute__ ((__deprecated__));\n     int member3(T *);\n     int x;\n } __attribute__ ((deprecated));"}]}