{"sha": "009ed5cc5c6a9a79925f4cd0a554844f0c6bc6e3", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6MDA5ZWQ1Y2M1YzZhOWE3OTkyNWY0Y2QwYTU1NDg0NGYwYzZiYzZlMw==", "commit": {"author": {"name": "Thomas Fitzsimmons", "email": "fitzsim@redhat.com", "date": "2003-11-11T17:04:47Z"}, "committer": {"name": "Thomas Fitzsimmons", "email": "fitzsim@gcc.gnu.org", "date": "2003-11-11T17:04:47Z"}, "message": "GtkLabelPeer.java (create()): Call new create.\n\n2003-11-11  Thomas Fitzsimmons  <fitzsim@redhat.com>\n\n\t* gnu/java/awt/peer/gtk/GtkLabelPeer.java (create()): Call new create.\n\t(create(String, float)): New method.\n\t(setText): Make native.\n\t(nativeSetAlignment): New method.\n\t(setAlignment): Call nativeSetAlignment.\n\t(getArgs): Remove method.\n\t* jni/gtk-peer/gnu_java_awt_peer_gtk_GtkComponentPeer.c\n\t(find_fg_color_widget, find_bg_color_widget): New functions.\n\t(gtkWidgetSetForeground): Call find_fg_color_widget.\n\t(gtkWidgetSetBackground): Call find_bg_color_widget.  Modify active and\n\tprelight colors.\n\t* jni/gtk-peer/gnu_java_awt_peer_gtk_GtkLabelPeer.c (create): Wrap label\n\twidget in event box.\n\t(setText, setAlignment): Implement new native methods.\n\nFrom-SVN: r73453", "tree": {"sha": "82d5b8444072702a1116203427aa9591bd53130c", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/82d5b8444072702a1116203427aa9591bd53130c"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/009ed5cc5c6a9a79925f4cd0a554844f0c6bc6e3", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/009ed5cc5c6a9a79925f4cd0a554844f0c6bc6e3", "html_url": "https://github.com/Rust-GCC/gccrs/commit/009ed5cc5c6a9a79925f4cd0a554844f0c6bc6e3", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/009ed5cc5c6a9a79925f4cd0a554844f0c6bc6e3/comments", "author": null, "committer": null, "parents": [{"sha": "4d595e43423f86afa558ee8238d37c64ad6b475e", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/4d595e43423f86afa558ee8238d37c64ad6b475e", "html_url": "https://github.com/Rust-GCC/gccrs/commit/4d595e43423f86afa558ee8238d37c64ad6b475e"}], "stats": {"total": 150, "additions": 127, "deletions": 23}, "files": [{"sha": "0027b928281828cf032957997cc9c7e458fd11a4", "filename": "libjava/ChangeLog", "status": "modified", "additions": 17, "deletions": 0, "changes": 17, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/009ed5cc5c6a9a79925f4cd0a554844f0c6bc6e3/libjava%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/009ed5cc5c6a9a79925f4cd0a554844f0c6bc6e3/libjava%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libjava%2FChangeLog?ref=009ed5cc5c6a9a79925f4cd0a554844f0c6bc6e3", "patch": "@@ -1,3 +1,20 @@\n+2003-11-11  Thomas Fitzsimmons  <fitzsim@redhat.com>\n+\n+\t* gnu/java/awt/peer/gtk/GtkLabelPeer.java (create()): Call new create.\n+\t(create(String, float)): New method.\n+\t(setText): Make native.\n+\t(nativeSetAlignment): New method.\n+\t(setAlignment): Call nativeSetAlignment.\n+\t(getArgs): Remove method.\n+\t* jni/gtk-peer/gnu_java_awt_peer_gtk_GtkComponentPeer.c\n+\t(find_fg_color_widget, find_bg_color_widget): New functions.\n+\t(gtkWidgetSetForeground): Call find_fg_color_widget.\n+\t(gtkWidgetSetBackground): Call find_bg_color_widget.  Modify active and\n+\tprelight colors.\n+\t* jni/gtk-peer/gnu_java_awt_peer_gtk_GtkLabelPeer.c (create): Wrap label\n+\twidget in event box.\n+\t(setText, setAlignment): Implement new native methods.\n+\n 2003-11-11  Michael Koch  <konqueror@gmx.de>\n \n \t* java/awt/Font.java,"}, {"sha": "b0a9ff79952de9b4440382c3d2250a263aa5e2e8", "filename": "libjava/gnu/java/awt/peer/gtk/GtkLabelPeer.java", "status": "modified", "additions": 11, "deletions": 18, "changes": 29, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/009ed5cc5c6a9a79925f4cd0a554844f0c6bc6e3/libjava%2Fgnu%2Fjava%2Fawt%2Fpeer%2Fgtk%2FGtkLabelPeer.java", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/009ed5cc5c6a9a79925f4cd0a554844f0c6bc6e3/libjava%2Fgnu%2Fjava%2Fawt%2Fpeer%2Fgtk%2FGtkLabelPeer.java", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libjava%2Fgnu%2Fjava%2Fawt%2Fpeer%2Fgtk%2FGtkLabelPeer.java?ref=009ed5cc5c6a9a79925f4cd0a554844f0c6bc6e3", "patch": "@@ -45,21 +45,25 @@\n public class GtkLabelPeer extends GtkComponentPeer\n     implements LabelPeer\n {\n-  native void create ();\n+  void create ()\n+  {\n+    Label label = (Label) awtComponent;\n+    create (label.getText (), getGtkAlignment (label.getAlignment ()));\n+  }\n+\n+  native void create (String text, float alignment);\n \n   public GtkLabelPeer (Label l)\n   {\n     super (l);\n   }\n-    \n-  public void setText (String text)\n-  {\n-    set (\"label\", text);\n-  }\n \n+  native public void setText (String text);\n+\n+  native void nativeSetAlignment (float alignment);\n   public void setAlignment (int alignment)\n   {\n-    set (\"xalign\", getGtkAlignment (alignment));\n+    nativeSetAlignment (getGtkAlignment (alignment));\n   }\n \n   float getGtkAlignment (int alignment)\n@@ -76,15 +80,4 @@ float getGtkAlignment (int alignment)\n \n     return 0.0f;\n   }\n-\n-  public void getArgs (Component component, GtkArgList args)\n-  {\n-    super.getArgs (component, args);\n-\n-    Label label = (Label) component;\n-\n-    args.add (\"label\", label.getText ());\n-    args.add (\"xalign\", getGtkAlignment (label.getAlignment ()));\n-    args.add (\"yalign\", 0.5f);\n-  }\n }"}, {"sha": "70aabf0cad976397eff856487e38f795b7c4b8bf", "filename": "libjava/jni/gtk-peer/gnu_java_awt_peer_gtk_GtkComponentPeer.c", "status": "modified", "additions": 43, "deletions": 2, "changes": 45, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/009ed5cc5c6a9a79925f4cd0a554844f0c6bc6e3/libjava%2Fjni%2Fgtk-peer%2Fgnu_java_awt_peer_gtk_GtkComponentPeer.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/009ed5cc5c6a9a79925f4cd0a554844f0c6bc6e3/libjava%2Fjni%2Fgtk-peer%2Fgnu_java_awt_peer_gtk_GtkComponentPeer.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libjava%2Fjni%2Fgtk-peer%2Fgnu_java_awt_peer_gtk_GtkComponentPeer.c?ref=009ed5cc5c6a9a79925f4cd0a554844f0c6bc6e3", "patch": "@@ -40,6 +40,9 @@ exception statement from your version. */\n #include \"gnu_java_awt_peer_gtk_GtkComponentPeer.h\"\n #include <gtk/gtkprivate.h>\n \n+static GtkWidget *find_fg_color_widget (GtkWidget *widget);\n+static GtkWidget *find_bg_color_widget (GtkWidget *widget);\n+\n JNIEXPORT void JNICALL Java_gnu_java_awt_peer_gtk_GtkGenericPeer_dispose\n   (JNIEnv *env, jobject obj)\n {\n@@ -299,7 +302,7 @@ Java_gnu_java_awt_peer_gtk_GtkComponentPeer_gtkWidgetSetBackground\n \n   gdk_threads_enter ();\n \n-  widget = GTK_WIDGET (ptr);\n+  widget = find_bg_color_widget (GTK_WIDGET (ptr));\n \n   gtk_widget_modify_bg (widget, GTK_STATE_NORMAL, &normal_color);\n   gtk_widget_modify_bg (widget, GTK_STATE_ACTIVE, &active_color);\n@@ -324,9 +327,11 @@ Java_gnu_java_awt_peer_gtk_GtkComponentPeer_gtkWidgetSetForeground\n \n   gdk_threads_enter ();\n \n-  widget = GTK_WIDGET (ptr);\n+  widget = find_fg_color_widget (GTK_WIDGET (ptr));\n \n   gtk_widget_modify_fg (widget, GTK_STATE_NORMAL, &color);\n+  gtk_widget_modify_fg (widget, GTK_STATE_ACTIVE, &color);\n+  gtk_widget_modify_fg (widget, GTK_STATE_PRELIGHT, &color);\n \n   gdk_threads_leave ();\n }\n@@ -542,3 +547,39 @@ JNIEXPORT void JNICALL Java_gnu_java_awt_peer_gtk_GtkComponentPeer_connectHooks\n     connect_awt_hook (env, obj, 1, GTK_WIDGET (ptr)->window);\n   gdk_threads_leave ();\n }\n+\n+static GtkWidget *\n+find_fg_color_widget (GtkWidget *widget)\n+{\n+  GtkWidget *fg_color_widget;\n+\n+  if (GTK_IS_EVENT_BOX (widget))\n+    fg_color_widget = gtk_bin_get_child (GTK_BIN(widget));\n+  else\n+    fg_color_widget = widget;\n+\n+  return fg_color_widget;\n+}\n+\n+static GtkWidget *\n+find_bg_color_widget (GtkWidget *widget)\n+{\n+  GtkWidget *bg_color_widget;\n+\n+  if (GTK_IS_WINDOW (widget))\n+    {\n+      GtkWidget *vbox;\n+      GList* children;\n+\n+      children = gtk_container_get_children(GTK_CONTAINER(widget));\n+      vbox = children->data;\n+\n+      children = gtk_container_get_children(GTK_CONTAINER(vbox));\n+      bg_color_widget = children->data;\n+    }\n+  else\n+    bg_color_widget = widget;\n+\n+  return bg_color_widget;\n+}\n+"}, {"sha": "38a45d8e25069f4a3a70e21d68b8e04995912e9a", "filename": "libjava/jni/gtk-peer/gnu_java_awt_peer_gtk_GtkLabelPeer.c", "status": "modified", "additions": 56, "deletions": 3, "changes": 59, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/009ed5cc5c6a9a79925f4cd0a554844f0c6bc6e3/libjava%2Fjni%2Fgtk-peer%2Fgnu_java_awt_peer_gtk_GtkLabelPeer.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/009ed5cc5c6a9a79925f4cd0a554844f0c6bc6e3/libjava%2Fjni%2Fgtk-peer%2Fgnu_java_awt_peer_gtk_GtkLabelPeer.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libjava%2Fjni%2Fgtk-peer%2Fgnu_java_awt_peer_gtk_GtkLabelPeer.c?ref=009ed5cc5c6a9a79925f4cd0a554844f0c6bc6e3", "patch": "@@ -41,15 +41,68 @@ exception statement from your version. */\n \n JNIEXPORT void JNICALL\n Java_gnu_java_awt_peer_gtk_GtkLabelPeer_create\n-  (JNIEnv *env, jobject obj)\n+  (JNIEnv *env, jobject obj, jstring text, jfloat xalign)\n {\n   GtkWidget *label;\n+  GtkWidget *ebox;\n+  GtkContainer *ebox_container;\n+  const char *str;\n+\n+  str = (*env)->GetStringUTFChars (env, text, 0);\n+\n+  gdk_threads_enter ();\n+\n+  ebox = gtk_event_box_new ();\n+  ebox_container = GTK_CONTAINER (ebox);\n+  label = gtk_label_new (str);\n+  gtk_misc_set_alignment (GTK_MISC (label), xalign, 0.5);\n+  gtk_container_add (ebox_container, label);\n+  gtk_widget_show (label);\n+\n+  gdk_threads_leave ();\n+\n+  (*env)->ReleaseStringUTFChars (env, text, str);\n+\n+  NSA_SET_PTR (env, obj, ebox);\n+}\n+\n+JNIEXPORT void JNICALL\n+Java_gnu_java_awt_peer_gtk_GtkLabelPeer_setText\n+  (JNIEnv *env, jobject obj, jstring text)\n+{\n+  const char *str;\n+  void *ptr;\n+  GtkWidget *label;\n+\n+  ptr = NSA_GET_PTR (env, obj);\n+\n+  str = (*env)->GetStringUTFChars (env, text, 0);\n \n   gdk_threads_enter ();\n \n-  label = gtk_label_new (NULL);\n+  label = gtk_bin_get_child (GTK_BIN(ptr));\n+\n+  gtk_label_set_label (GTK_LABEL (label), str);\n \n   gdk_threads_leave ();\n \n-  NSA_SET_PTR (env, obj, label);\n+  (*env)->ReleaseStringUTFChars (env, text, str);\n+}\n+\n+JNIEXPORT void JNICALL\n+Java_gnu_java_awt_peer_gtk_GtkLabelPeer_setAlignment\n+  (JNIEnv *env, jobject obj, jfloat xalign)\n+{\n+  void *ptr;\n+  GtkWidget *label;\n+\n+  ptr = NSA_GET_PTR (env, obj);\n+\n+  gdk_threads_enter ();\n+\n+  label = gtk_bin_get_child (GTK_BIN(ptr));\n+\n+  gtk_misc_set_alignment (GTK_MISC (label), xalign, 0.5);\n+\n+  gdk_threads_leave ();\n }"}]}