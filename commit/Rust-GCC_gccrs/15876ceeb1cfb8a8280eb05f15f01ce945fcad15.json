{"sha": "15876ceeb1cfb8a8280eb05f15f01ce945fcad15", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6MTU4NzZjZWViMWNmYjhhODI4MGViMDVmMTVmMDFjZTk0NWZjYWQxNQ==", "commit": {"author": {"name": "Thomas Koenig", "email": "tkoenig@gcc.gnu.org", "date": "2016-10-22T14:04:46Z"}, "committer": {"name": "Thomas Koenig", "email": "tkoenig@gcc.gnu.org", "date": "2016-10-22T14:04:46Z"}, "message": "re PR fortran/78021 (Wrong result with optimization on character constant)\n\n2016-10-22  Thomas Koenig  <tkoenig@gcc.gnu.org>\n\n\tPR fortran/78021\n\t* gfc_compare_functions:  Strings with different lengths in\n\targument lists compare unequal.\n\n2016-10-22  Thomas Koenig  <tkoenig@gcc.gnu.org>\n\n\tPR fortran/78021\n\t* gfortran.dg/string_length_3.f90:  New test.\n\nFrom-SVN: r241440", "tree": {"sha": "c64a2201d2dffde8ad03b2abe42eb98b1b5735fb", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/c64a2201d2dffde8ad03b2abe42eb98b1b5735fb"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/15876ceeb1cfb8a8280eb05f15f01ce945fcad15", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/15876ceeb1cfb8a8280eb05f15f01ce945fcad15", "html_url": "https://github.com/Rust-GCC/gccrs/commit/15876ceeb1cfb8a8280eb05f15f01ce945fcad15", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/15876ceeb1cfb8a8280eb05f15f01ce945fcad15/comments", "author": null, "committer": null, "parents": [{"sha": "574284e9c49687d8bcc039165964602311decd2b", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/574284e9c49687d8bcc039165964602311decd2b", "html_url": "https://github.com/Rust-GCC/gccrs/commit/574284e9c49687d8bcc039165964602311decd2b"}], "stats": {"total": 53, "additions": 50, "deletions": 3}, "files": [{"sha": "f5843bf72585159b0ff37fbce398ebb12f3ad8c8", "filename": "gcc/fortran/ChangeLog", "status": "modified", "additions": 6, "deletions": 0, "changes": 6, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/15876ceeb1cfb8a8280eb05f15f01ce945fcad15/gcc%2Ffortran%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/15876ceeb1cfb8a8280eb05f15f01ce945fcad15/gcc%2Ffortran%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ffortran%2FChangeLog?ref=15876ceeb1cfb8a8280eb05f15f01ce945fcad15", "patch": "@@ -1,3 +1,9 @@\n+2016-10-22  Thomas Koenig  <tkoenig@gcc.gnu.org>\n+\n+\tPR fortran/78021\n+\t* gfc_compare_functions:  Strings with different lengths in\n+\targument lists compare unequal.\n+\n 2016-10-22  Andre Vehreschild  <vehre@gcc.gnu.org>\n \n \tPR fortran/43366"}, {"sha": "82c5e6b573325e4a2b110db1c2b8c7052501435e", "filename": "gcc/fortran/dependency.c", "status": "modified", "additions": 20, "deletions": 3, "changes": 23, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/15876ceeb1cfb8a8280eb05f15f01ce945fcad15/gcc%2Ffortran%2Fdependency.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/15876ceeb1cfb8a8280eb05f15f01ce945fcad15/gcc%2Ffortran%2Fdependency.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ffortran%2Fdependency.c?ref=15876ceeb1cfb8a8280eb05f15f01ce945fcad15", "patch": "@@ -226,9 +226,26 @@ gfc_dep_compare_functions (gfc_expr *e1, gfc_expr *e2, bool impure_ok)\n \t  if ((args1->expr == NULL) ^ (args2->expr == NULL))\n \t    return -2;\n \n-\t  if (args1->expr != NULL && args2->expr != NULL\n-\t      && gfc_dep_compare_expr (args1->expr, args2->expr) != 0)\n-\t    return -2;\n+\t  if (args1->expr != NULL && args2->expr != NULL)\n+\t    {\n+\t      gfc_expr *e1, *e2;\n+\t      e1 = args1->expr;\n+\t      e2 = args2->expr;\n+\n+\t      if (gfc_dep_compare_expr (e1, e2) != 0)\n+\t\treturn -2;\n+\n+\t      /* Special case: String arguments which compare equal can have\n+\t\t different lengths, which makes them different in calls to\n+\t\t procedures.  */\n+\t      \n+\t      if (e1->expr_type == EXPR_CONSTANT\n+\t\t  && e1->ts.type == BT_CHARACTER\n+\t\t  && e2->expr_type == EXPR_CONSTANT\n+\t\t  && e2->ts.type == BT_CHARACTER\n+\t\t  && e1->value.character.length != e2->value.character.length)\n+\t\treturn -2;\n+\t    }\n \n \t  args1 = args1->next;\n \t  args2 = args2->next;"}, {"sha": "8b091019af58be765fe2cc8b446e32f77e1304a1", "filename": "gcc/testsuite/ChangeLog", "status": "modified", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/15876ceeb1cfb8a8280eb05f15f01ce945fcad15/gcc%2Ftestsuite%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/15876ceeb1cfb8a8280eb05f15f01ce945fcad15/gcc%2Ftestsuite%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2FChangeLog?ref=15876ceeb1cfb8a8280eb05f15f01ce945fcad15", "patch": "@@ -1,3 +1,8 @@\n+2016-10-22  Thomas Koenig  <tkoenig@gcc.gnu.org>\n+\n+\tPR fortran/78021\n+\t* gfortran.dg/string_length_3.f90:  New test.\n+\n 2016-10-22  Andre Vehreschild  <vehre@gcc.gnu.org>\n \n \tForgot to add on original commit."}, {"sha": "e745eb9fdfac0a8795a4f3ffee853dcbbb0e584c", "filename": "gcc/testsuite/gfortran.dg/string_length_3.f90", "status": "added", "additions": 19, "deletions": 0, "changes": 19, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/15876ceeb1cfb8a8280eb05f15f01ce945fcad15/gcc%2Ftestsuite%2Fgfortran.dg%2Fstring_length_3.f90", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/15876ceeb1cfb8a8280eb05f15f01ce945fcad15/gcc%2Ftestsuite%2Fgfortran.dg%2Fstring_length_3.f90", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgfortran.dg%2Fstring_length_3.f90?ref=15876ceeb1cfb8a8280eb05f15f01ce945fcad15", "patch": "@@ -0,0 +1,19 @@\n+! { dg-do run }\n+! { dg-options \"-ffrontend-optimize -fdump-tree-original\" }\n+! PR 78021 - calls to mylen were folded after shortening the\n+! argument list.\n+\n+PROGRAM test_o_char\n+  implicit none\n+  integer :: n\n+  n = mylen('c') + mylen('c   ')\n+  if (n /= 5) call abort\n+CONTAINS\n+\n+  FUNCTION mylen(c)\n+    CHARACTER(len=*),INTENT(in) :: c\n+    INTEGER :: mylen\n+    mylen=LEN(c)\n+  END FUNCTION mylen\n+END PROGRAM test_o_char\n+! { dg-final { scan-tree-dump-times \"__var\" 0 \"original\" } }"}]}