{"sha": "b81ecf6fd65e63dc568167b3c71eabf53ba5ccca", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6YjgxZWNmNmZkNjVlNjNkYzU2ODE2N2IzYzcxZWFiZjUzYmE1Y2NjYQ==", "commit": {"author": {"name": "Richard Henderson", "email": "rth@redhat.com", "date": "2009-09-22T15:15:30Z"}, "committer": {"name": "Richard Henderson", "email": "rth@gcc.gnu.org", "date": "2009-09-22T15:15:30Z"}, "message": "s390.c (s390_asm_trampoline_template): Rename from s390_trampoline_template; make static.\n\n        * config/s390/s390.c (s390_asm_trampoline_template): Rename from\n        s390_trampoline_template; make static.\n        (s390_trampoline_init): Rename from s390_initialize_trampoline;\n        make static; adjust for target hook.\n        (TARGET_ASM_TRAMPOLINE_TEMPLATE, TARGET_TRAMPOLINE_INIT): New.\n        * config/s390/s390-protos.h: Remove trampoline decls.\n        * config/s390/s390.h (INITIALIZE_TRAMPOLINE): Remove.\n        (TRAMPOLINE_TEMPLATE): Remove.\n        (TRAMPOLINE_ALIGNMENT): New.\n\nFrom-SVN: r152009", "tree": {"sha": "9e6ead414b09967d555a6aa867c0669966088535", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/9e6ead414b09967d555a6aa867c0669966088535"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/b81ecf6fd65e63dc568167b3c71eabf53ba5ccca", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/b81ecf6fd65e63dc568167b3c71eabf53ba5ccca", "html_url": "https://github.com/Rust-GCC/gccrs/commit/b81ecf6fd65e63dc568167b3c71eabf53ba5ccca", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/b81ecf6fd65e63dc568167b3c71eabf53ba5ccca/comments", "author": null, "committer": null, "parents": [{"sha": "44d43e53777bdca63227ed10fff40c21a9fa3424", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/44d43e53777bdca63227ed10fff40c21a9fa3424", "html_url": "https://github.com/Rust-GCC/gccrs/commit/44d43e53777bdca63227ed10fff40c21a9fa3424"}], "stats": {"total": 51, "additions": 31, "deletions": 20}, "files": [{"sha": "41a70215509fe5fa6f732b9420c3b1ee2d0442fa", "filename": "gcc/ChangeLog", "status": "modified", "additions": 10, "deletions": 0, "changes": 10, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/b81ecf6fd65e63dc568167b3c71eabf53ba5ccca/gcc%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/b81ecf6fd65e63dc568167b3c71eabf53ba5ccca/gcc%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2FChangeLog?ref=b81ecf6fd65e63dc568167b3c71eabf53ba5ccca", "patch": "@@ -217,6 +217,16 @@\n \tmake static; adjust parameters for the hook.\n \t* config/rs6000/rs6000.h (INITIALIZE_TRAMPOLINE): Remove.\n \n+\t* config/s390/s390.c (s390_asm_trampoline_template): Rename from\n+\ts390_trampoline_template; make static.\n+\t(s390_trampoline_init): Rename from s390_initialize_trampoline;\n+\tmake static; adjust for target hook.\n+\t(TARGET_ASM_TRAMPOLINE_TEMPLATE, TARGET_TRAMPOLINE_INIT): New.\n+\t* config/s390/s390-protos.h: Remove trampoline decls.\n+\t* config/s390/s390.h (INITIALIZE_TRAMPOLINE): Remove.\n+\t(TRAMPOLINE_TEMPLATE): Remove.\n+\t(TRAMPOLINE_ALIGNMENT): New.\n+\n 2009-09-22  Jakub Jelinek  <jakub@redhat.com>\n \n \t* config/rs6000/rs6000.c (bdesc_2arg): Fix CODE_FOR_vector_gt* codes"}, {"sha": "8a2f1b7186ed433264edfb15fb6edfb5f9f2ba47", "filename": "gcc/config/s390/s390-protos.h", "status": "modified", "additions": 0, "deletions": 2, "changes": 2, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/b81ecf6fd65e63dc568167b3c71eabf53ba5ccca/gcc%2Fconfig%2Fs390%2Fs390-protos.h", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/b81ecf6fd65e63dc568167b3c71eabf53ba5ccca/gcc%2Fconfig%2Fs390%2Fs390-protos.h", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fconfig%2Fs390%2Fs390-protos.h?ref=b81ecf6fd65e63dc568167b3c71eabf53ba5ccca", "patch": "@@ -106,8 +106,6 @@ extern bool s390_output_addr_const_extra (FILE*, rtx);\n extern void print_operand_address (FILE *, rtx);\n extern void print_operand (FILE *, rtx, int);\n extern void s390_output_pool_entry (rtx, enum machine_mode, unsigned int);\n-extern void s390_trampoline_template (FILE *);\n-extern void s390_initialize_trampoline (rtx, rtx, rtx);\n extern int s390_agen_dep_p (rtx, rtx);\n extern rtx s390_load_got (void);\n extern rtx s390_get_thread_pointer (void);"}, {"sha": "7054e45fc7104469e90d7bba850b92e6f0f92fef", "filename": "gcc/config/s390/s390.c", "status": "modified", "additions": 19, "deletions": 10, "changes": 29, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/b81ecf6fd65e63dc568167b3c71eabf53ba5ccca/gcc%2Fconfig%2Fs390%2Fs390.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/b81ecf6fd65e63dc568167b3c71eabf53ba5ccca/gcc%2Fconfig%2Fs390%2Fs390.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fconfig%2Fs390%2Fs390.c?ref=b81ecf6fd65e63dc568167b3c71eabf53ba5ccca", "patch": "@@ -8863,8 +8863,8 @@ s390_expand_builtin (tree exp, rtx target, rtx subtarget ATTRIBUTE_UNUSED,\n    On S/390, we use gpr 1 internally in the trampoline code;\n    gpr 0 is used to hold the static chain.  */\n \n-void\n-s390_trampoline_template (FILE *file)\n+static void\n+s390_asm_trampoline_template (FILE *file)\n {\n   rtx op[2];\n   op[0] = gen_rtx_REG (Pmode, 0);\n@@ -8890,15 +8890,19 @@ s390_trampoline_template (FILE *file)\n    FNADDR is an RTX for the address of the function's pure code.\n    CXT is an RTX for the static chain value for the function.  */\n \n-void\n-s390_initialize_trampoline (rtx addr, rtx fnaddr, rtx cxt)\n+static void\n+s390_trampoline_init (rtx m_tramp, tree fndecl, rtx cxt)\n {\n-  emit_move_insn (gen_rtx_MEM (Pmode,\n-\t\t   memory_address (Pmode,\n-\t\t   plus_constant (addr, (TARGET_64BIT ? 16 : 8)))), cxt);\n-  emit_move_insn (gen_rtx_MEM (Pmode,\n-\t\t   memory_address (Pmode,\n-\t\t   plus_constant (addr, (TARGET_64BIT ? 24 : 12)))), fnaddr);\n+  rtx fnaddr = XEXP (DECL_RTL (fndecl), 0);\n+  rtx mem;\n+  \n+  emit_block_move (m_tramp, assemble_trampoline_template (),\n+\t\t   GEN_INT (2*UNITS_PER_WORD), BLOCK_OP_NORMAL);\n+\n+  mem = adjust_address (m_tramp, Pmode, 2*UNITS_PER_WORD);\n+  emit_move_insn (mem, cxt);\n+  mem = adjust_address (m_tramp, Pmode, 3*UNITS_PER_WORD);\n+  emit_move_insn (mem, fnaddr);\n }\n \n /* Output assembler code to FILE to increment profiler label # LABELNO\n@@ -10152,6 +10156,11 @@ s390_reorg (void)\n #undef TARGET_CAN_ELIMINATE\n #define TARGET_CAN_ELIMINATE s390_can_eliminate\n \n+#undef TARGET_ASM_TRAMPOLINE_TEMPLATE\n+#define TARGET_ASM_TRAMPOLINE_TEMPLATE s390_asm_trampoline_template\n+#undef TARGET_TRAMPOLINE_INIT\n+#define TARGET_TRAMPOLINE_INIT s390_trampoline_init\n+\n struct gcc_target targetm = TARGET_INITIALIZER;\n \n #include \"gt-s390.h\""}, {"sha": "ffb96cd0f340e4c1c35301d48a4e23a71c117622", "filename": "gcc/config/s390/s390.h", "status": "modified", "additions": 2, "deletions": 8, "changes": 10, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/b81ecf6fd65e63dc568167b3c71eabf53ba5ccca/gcc%2Fconfig%2Fs390%2Fs390.h", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/b81ecf6fd65e63dc568167b3c71eabf53ba5ccca/gcc%2Fconfig%2Fs390%2Fs390.h", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fconfig%2Fs390%2Fs390.h?ref=b81ecf6fd65e63dc568167b3c71eabf53ba5ccca", "patch": "@@ -712,14 +712,8 @@ CUMULATIVE_ARGS;\n \n /* Trampolines for nested functions.  */\n \n-#define TRAMPOLINE_SIZE (TARGET_64BIT ? 32 : 16)\n-\n-#define INITIALIZE_TRAMPOLINE(ADDR, FNADDR, CXT)                       \\\n-   s390_initialize_trampoline ((ADDR), (FNADDR), (CXT))\n-\n-#define TRAMPOLINE_TEMPLATE(FILE)                                       \\\n-   s390_trampoline_template (FILE)\n-\n+#define TRAMPOLINE_SIZE\t\t(TARGET_64BIT ? 32 : 16)\n+#define TRAMPOLINE_ALIGNMENT\tBITS_PER_WORD\n \n /* Addressing modes, and classification of registers for them.  */\n "}]}