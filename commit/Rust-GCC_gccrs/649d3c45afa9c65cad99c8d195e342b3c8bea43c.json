{"sha": "649d3c45afa9c65cad99c8d195e342b3c8bea43c", "node_id": "C_kwDOANBUbNoAKDY0OWQzYzQ1YWZhOWM2NWNhZDk5YzhkMTk1ZTM0MmIzYzhiZWE0M2M", "commit": {"author": {"name": "liushuyu", "email": "liushuyu011@gmail.com", "date": "2022-06-12T02:02:54Z"}, "committer": {"name": "liushuyu", "email": "liushuyu011@gmail.com", "date": "2022-06-28T23:54:18Z"}, "message": "rust/backend: scan for any deprecated function calls ...\n\n... and emit warnings using GCC's own deprecation warning system", "tree": {"sha": "6d341c9824ead55b0fa10d5920d66d7cadb3d860", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/6d341c9824ead55b0fa10d5920d66d7cadb3d860"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/649d3c45afa9c65cad99c8d195e342b3c8bea43c", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/649d3c45afa9c65cad99c8d195e342b3c8bea43c", "html_url": "https://github.com/Rust-GCC/gccrs/commit/649d3c45afa9c65cad99c8d195e342b3c8bea43c", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/649d3c45afa9c65cad99c8d195e342b3c8bea43c/comments", "author": {"login": "liushuyu", "id": 6829345, "node_id": "MDQ6VXNlcjY4MjkzNDU=", "avatar_url": "https://avatars.githubusercontent.com/u/6829345?v=4", "gravatar_id": "", "url": "https://api.github.com/users/liushuyu", "html_url": "https://github.com/liushuyu", "followers_url": "https://api.github.com/users/liushuyu/followers", "following_url": "https://api.github.com/users/liushuyu/following{/other_user}", "gists_url": "https://api.github.com/users/liushuyu/gists{/gist_id}", "starred_url": "https://api.github.com/users/liushuyu/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/liushuyu/subscriptions", "organizations_url": "https://api.github.com/users/liushuyu/orgs", "repos_url": "https://api.github.com/users/liushuyu/repos", "events_url": "https://api.github.com/users/liushuyu/events{/privacy}", "received_events_url": "https://api.github.com/users/liushuyu/received_events", "type": "User", "site_admin": false}, "committer": {"login": "liushuyu", "id": 6829345, "node_id": "MDQ6VXNlcjY4MjkzNDU=", "avatar_url": "https://avatars.githubusercontent.com/u/6829345?v=4", "gravatar_id": "", "url": "https://api.github.com/users/liushuyu", "html_url": "https://github.com/liushuyu", "followers_url": "https://api.github.com/users/liushuyu/followers", "following_url": "https://api.github.com/users/liushuyu/following{/other_user}", "gists_url": "https://api.github.com/users/liushuyu/gists{/gist_id}", "starred_url": "https://api.github.com/users/liushuyu/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/liushuyu/subscriptions", "organizations_url": "https://api.github.com/users/liushuyu/orgs", "repos_url": "https://api.github.com/users/liushuyu/repos", "events_url": "https://api.github.com/users/liushuyu/events{/privacy}", "received_events_url": "https://api.github.com/users/liushuyu/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "04cc46cfe8cad9736ccf2d5c884af50e57b67ce6", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/04cc46cfe8cad9736ccf2d5c884af50e57b67ce6", "html_url": "https://github.com/Rust-GCC/gccrs/commit/04cc46cfe8cad9736ccf2d5c884af50e57b67ce6"}], "stats": {"total": 19, "additions": 17, "deletions": 2}, "files": [{"sha": "066ef43ca2376787d354bfe9049feed3b95a02ca", "filename": "gcc/rust/backend/rust-compile-base.cc", "status": "modified", "additions": 7, "deletions": 2, "changes": 9, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/649d3c45afa9c65cad99c8d195e342b3c8bea43c/gcc%2Frust%2Fbackend%2Frust-compile-base.cc", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/649d3c45afa9c65cad99c8d195e342b3c8bea43c/gcc%2Frust%2Fbackend%2Frust-compile-base.cc", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Frust%2Fbackend%2Frust-compile-base.cc?ref=649d3c45afa9c65cad99c8d195e342b3c8bea43c", "patch": "@@ -209,8 +209,13 @@ HIRCompileBase::handle_deprecated_attribute_on_fndecl (\n \t}\n     }\n \n-  DECL_ATTRIBUTES (fndecl) = tree_cons (get_identifier (\"deprecated\"), value,\n-\t\t\t\t\tDECL_ATTRIBUTES (fndecl));\n+  if (value)\n+    {\n+      tree attr_list = build_tree_list (NULL_TREE, value);\n+      DECL_ATTRIBUTES (fndecl)\n+\t= tree_cons (get_identifier (\"deprecated\"), attr_list,\n+\t\t     DECL_ATTRIBUTES (fndecl));\n+    }\n }\n \n void"}, {"sha": "4fea6fbd7fca3f24561718418c510cf92ce2157e", "filename": "gcc/rust/rust-gcc.cc", "status": "modified", "additions": 10, "deletions": 0, "changes": 10, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/649d3c45afa9c65cad99c8d195e342b3c8bea43c/gcc%2Frust%2Frust-gcc.cc", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/649d3c45afa9c65cad99c8d195e342b3c8bea43c/gcc%2Frust%2Frust-gcc.cc", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Frust%2Frust-gcc.cc?ref=649d3c45afa9c65cad99c8d195e342b3c8bea43c", "patch": "@@ -51,6 +51,8 @@\n #include \"rust-backend.h\"\n #include \"rust-object-export.h\"\n \n+#include \"backend/rust-tree.h\"\n+\n // TODO: this will have to be significantly modified to work with Rust\n \n // Bvariable is a bit more complicated, because of zero-sized types.\n@@ -1852,6 +1854,14 @@ Gcc_backend::call_expression (tree fn, const std::vector<tree> &fn_args,\n \t\t\t    excess_type != NULL_TREE ? excess_type : rettype,\n \t\t\t    fn, nargs, args);\n \n+  // check for deprecated function usage\n+  if (fndecl && TREE_DEPRECATED (fndecl))\n+    {\n+      // set up the call-site information for `warn_deprecated_use`\n+      input_location = location.gcc_location ();\n+      warn_deprecated_use (fndecl, NULL_TREE);\n+    }\n+\n   if (chain_expr)\n     CALL_EXPR_STATIC_CHAIN (ret) = chain_expr;\n "}]}