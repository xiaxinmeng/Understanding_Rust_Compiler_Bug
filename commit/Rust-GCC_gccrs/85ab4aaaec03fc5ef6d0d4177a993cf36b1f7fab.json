{"sha": "85ab4aaaec03fc5ef6d0d4177a993cf36b1f7fab", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6ODVhYjRhYWFlYzAzZmM1ZWY2ZDBkNDE3N2E5OTNjZjM2YjFmN2ZhYg==", "commit": {"author": {"name": "Richard Kenner", "email": "kenner@gcc.gnu.org", "date": "1996-06-18T10:53:52Z"}, "committer": {"name": "Richard Kenner", "email": "kenner@gcc.gnu.org", "date": "1996-06-18T10:53:52Z"}, "message": "(expand_builtin, case BUILT_IN_{SET,LONG}JMP): Properly handle case\nwhen ptr_mode != Pmode.\n\nFrom-SVN: r12294", "tree": {"sha": "c5f3279053b00c1aa0aa694096bfba2552bde7f7", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/c5f3279053b00c1aa0aa694096bfba2552bde7f7"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/85ab4aaaec03fc5ef6d0d4177a993cf36b1f7fab", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/85ab4aaaec03fc5ef6d0d4177a993cf36b1f7fab", "html_url": "https://github.com/Rust-GCC/gccrs/commit/85ab4aaaec03fc5ef6d0d4177a993cf36b1f7fab", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/85ab4aaaec03fc5ef6d0d4177a993cf36b1f7fab/comments", "author": null, "committer": null, "parents": [{"sha": "9cc96794cc35d136c2b229c636c1495fac1d12ab", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/9cc96794cc35d136c2b229c636c1495fac1d12ab", "html_url": "https://github.com/Rust-GCC/gccrs/commit/9cc96794cc35d136c2b229c636c1495fac1d12ab"}], "stats": {"total": 31, "additions": 19, "deletions": 12}, "files": [{"sha": "1603b6283965ab868d8965502ed99c58cbd9457f", "filename": "gcc/expr.c", "status": "modified", "additions": 19, "deletions": 12, "changes": 31, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/85ab4aaaec03fc5ef6d0d4177a993cf36b1f7fab/gcc%2Fexpr.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/85ab4aaaec03fc5ef6d0d4177a993cf36b1f7fab/gcc%2Fexpr.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fexpr.c?ref=85ab4aaaec03fc5ef6d0d4177a993cf36b1f7fab", "patch": "@@ -8676,13 +8676,8 @@ expand_builtin (exp, target, subtarget, mode, ignore)\n \tbreak;\n \n       {\n-\trtx buf_addr\n-\t  = force_reg (Pmode,\n-\t\t       convert_modes (Pmode, ptr_mode,\n-\t\t\t\t      expand_expr (TREE_VALUE (arglist),\n-\t\t\t\t\t\t   subtarget,\n-\t\t\t\t\t\t   VOIDmode, 0),\n-\t\t\t\t      1));\n+\trtx buf_addr = expand_expr (TREE_VALUE (arglist), subtarget,\n+\t\t\t\t    VOIDmode, 0);\n \trtx lab1 = gen_label_rtx (), lab2 = gen_label_rtx ();\n \tenum machine_mode sa_mode = Pmode;\n \trtx stack_save;\n@@ -8693,6 +8688,12 @@ expand_builtin (exp, target, subtarget, mode, ignore)\n \tCUMULATIVE_ARGS args_so_far;\n \tint i;\n \n+#ifdef POINTERS_EXTEND_UNSIGNED\n+\tbuf_addr = convert_memory_address (Pmode, buf_addr);\n+#endif\n+\n+\tbuf_addr = force_reg (Pmode, buf_addr);\n+\n \tif (target == 0 || GET_CODE (target) != REG\n \t    || REGNO (target) < FIRST_PSEUDO_REGISTER)\n \t  target = gen_reg_rtx (value_mode);\n@@ -8827,13 +8828,19 @@ expand_builtin (exp, target, subtarget, mode, ignore)\n \ttree dummy_id = get_identifier (\"__dummy\");\n \ttree dummy_type = build_function_type (void_type_node, NULL_TREE);\n \ttree dummy_decl = build_decl (FUNCTION_DECL, dummy_id, dummy_type); \n+#ifdef POINTERS_EXTEND_UNSIGNED\n \trtx buf_addr\n \t  = force_reg (Pmode,\n-\t\t       convert_modes (Pmode, ptr_mode,\n-\t\t\t\t      expand_expr (TREE_VALUE (arglist),\n-\t\t\t\t\t\t   NULL_RTX,\n-\t\t\t\t\t\t   VOIDmode, 0),\n-\t\t\t\t      1));\n+\t\t       convert_memory_address\n+\t\t       (Pmode,\n+\t\t\texpand_expr (TREE_VALUE (arglist),\n+\t\t\t\t     NULL_RTX, VOIDmode, 0)));\n+#else\n+\trtx buf_addr\n+\t  = force_reg (Pmode, expand_expr (TREE_VALUE (arglist),\n+\t\t\t\t\t   NULL_RTX,\n+\t\t\t\t\t   VOIDmode, 0));\n+#endif\n \trtx fp = gen_rtx (MEM, Pmode, buf_addr);\n \trtx lab = gen_rtx (MEM, Pmode,\n \t\t\t   plus_constant (buf_addr, GET_MODE_SIZE (Pmode)));"}]}