{"sha": "593632051f48a20bdc685d00d168f064d808bd7b", "node_id": "C_kwDOANBUbNoAKDU5MzYzMjA1MWY0OGEyMGJkYzY4NWQwMGQxNjhmMDY0ZDgwOGJkN2I", "commit": {"author": {"name": "YunQiang Su", "email": "yunqiang.su@cipunited.com", "date": "2021-05-08T09:45:54Z"}, "committer": {"name": "YunQiang Su", "email": "yunqiang.su@cipunited.com", "date": "2022-10-25T08:44:12Z"}, "message": "MIPS: add builtime option for -mcompact-branches\n\nFor R6+ target, it allows to configure gcc to use compact branches only\nif avaiable.\n\ngcc/ChangeLog:\n\t* config.gcc: add -with-compact-branches=policy build option.\n\t* doc/install.texi: Likewise.\n\t* config/mips/mips.h: Likewise.", "tree": {"sha": "4aaffe625878597857fca7e1431aabd2a9457560", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/4aaffe625878597857fca7e1431aabd2a9457560"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/593632051f48a20bdc685d00d168f064d808bd7b", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/593632051f48a20bdc685d00d168f064d808bd7b", "html_url": "https://github.com/Rust-GCC/gccrs/commit/593632051f48a20bdc685d00d168f064d808bd7b", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/593632051f48a20bdc685d00d168f064d808bd7b/comments", "author": null, "committer": null, "parents": [{"sha": "4479f1dc79fc4f1b5e0fed209df35f405bc94589", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/4479f1dc79fc4f1b5e0fed209df35f405bc94589", "html_url": "https://github.com/Rust-GCC/gccrs/commit/4479f1dc79fc4f1b5e0fed209df35f405bc94589"}], "stats": {"total": 35, "additions": 32, "deletions": 3}, "files": [{"sha": "52f9e988bf6086b4b9c4b18e3edd2b3118be4b0a", "filename": "gcc/config.gcc", "status": "modified", "additions": 11, "deletions": 2, "changes": 13, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/593632051f48a20bdc685d00d168f064d808bd7b/gcc%2Fconfig.gcc", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/593632051f48a20bdc685d00d168f064d808bd7b/gcc%2Fconfig.gcc", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fconfig.gcc?ref=593632051f48a20bdc685d00d168f064d808bd7b", "patch": "@@ -4675,7 +4675,7 @@ case \"${target}\" in\n \t\t;;\n \n \tmips*-*-*)\n-\t\tsupported_defaults=\"abi arch arch_32 arch_64 float fpu nan fp_32 odd_spreg_32 tune tune_32 tune_64 divide llsc mips-plt synci lxc1-sxc1 madd4\"\n+\t\tsupported_defaults=\"abi arch arch_32 arch_64 float fpu nan fp_32 odd_spreg_32 tune tune_32 tune_64 divide llsc mips-plt synci lxc1-sxc1 madd4 compact-branches\"\n \n \t\tcase ${with_float} in\n \t\t\"\" | soft | hard)\n@@ -4828,6 +4828,15 @@ case \"${target}\" in\n \t\t\texit 1\n \t\t\t;;\n \t\tesac\n+\n+\t\tcase ${with_compact_branches} in\n+\t\t\"\" | never | always | optimal)\n+\t\t\t;;\n+\t\t*)\n+\t\t\techo \"Unknown compact-branches policy used in --with-compact-branches\" 1>&2\n+\t\t\texit 1\n+\t\t\t;;\n+\t\tesac\n \t\t;;\n \n \tloongarch*-*-*)\n@@ -5772,7 +5781,7 @@ case ${target} in\n esac\n \n t=\n-all_defaults=\"abi cpu cpu_32 cpu_64 arch arch_32 arch_64 tune tune_32 tune_64 schedule float mode fpu nan fp_32 odd_spreg_32 divide llsc mips-plt synci tls lxc1-sxc1 madd4 isa_spec\"\n+all_defaults=\"abi cpu cpu_32 cpu_64 arch arch_32 arch_64 tune tune_32 tune_64 schedule float mode fpu nan fp_32 odd_spreg_32 divide llsc mips-plt synci tls lxc1-sxc1 madd4 isa_spec compact-branches\"\n for option in $all_defaults\n do\n \teval \"val=\\$with_\"`echo $option | sed s/-/_/g`"}, {"sha": "69de74eb416a104bd5810eb965d86b63820c827a", "filename": "gcc/config/mips/mips.h", "status": "modified", "additions": 2, "deletions": 1, "changes": 3, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/593632051f48a20bdc685d00d168f064d808bd7b/gcc%2Fconfig%2Fmips%2Fmips.h", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/593632051f48a20bdc685d00d168f064d808bd7b/gcc%2Fconfig%2Fmips%2Fmips.h", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fconfig%2Fmips%2Fmips.h?ref=593632051f48a20bdc685d00d168f064d808bd7b", "patch": "@@ -915,7 +915,8 @@ struct mips_cpu_info {\n   {\"mips-plt\", \"%{!mplt:%{!mno-plt:-m%(VALUE)}}\" }, \\\n   {\"synci\", \"%{!msynci:%{!mno-synci:-m%(VALUE)}}\" },\t\t\t\\\n   {\"lxc1-sxc1\", \"%{!mlxc1-sxc1:%{!mno-lxc1-sxc1:-m%(VALUE)}}\" }, \\\n-  {\"madd4\", \"%{!mmadd4:%{!mno-madd4:-m%(VALUE)}}\" } \\\n+  {\"madd4\", \"%{!mmadd4:%{!mno-madd4:-m%(VALUE)}}\" }, \\\n+  {\"compact-branches\", \"%{!mcompact-branches=*:-mcompact-branches=%(VALUE)}\" } \\\n \n /* A spec that infers the:\n    -mnan=2008 setting from a -mips argument,"}, {"sha": "c1876f24a84c096d83cd66b896631f74810e408c", "filename": "gcc/doc/install.texi", "status": "modified", "additions": 19, "deletions": 0, "changes": 19, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/593632051f48a20bdc685d00d168f064d808bd7b/gcc%2Fdoc%2Finstall.texi", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/593632051f48a20bdc685d00d168f064d808bd7b/gcc%2Fdoc%2Finstall.texi", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fdoc%2Finstall.texi?ref=593632051f48a20bdc685d00d168f064d808bd7b", "patch": "@@ -1543,6 +1543,25 @@ systems that support conditional traps).\n Division by zero checks use the break instruction.\n @end table\n \n+@item --with-compact-branches=@var{policy}\n+Specify how the compiler should generate branch instructions.\n+This option is only supported on the MIPS target.\n+The possibilities for @var{type} are:\n+@table @code\n+@item optimal\n+Cause a delay slot branch to be used if one is available in the\n+current ISA and the delay slot is successfully filled. If the delay slot\n+is not filled, a compact branch will be chosen if one is available.\n+@item never\n+Ensures that compact branch instructions will never be generated.\n+@item always\n+Ensures that a compact branch instruction will be generated if available.\n+If a compact branch instruction is not available,\n+a delay slot form of the branch will be used instead.\n+This option is supported from MIPS Release 6 onwards.\n+For pre-R6/microMIPS/MIPS16, this option is just same as never/optimal.\n+@end table\n+\n @c If you make --with-llsc the default for additional targets,\n @c update the --with-llsc description in the MIPS section below.\n "}]}