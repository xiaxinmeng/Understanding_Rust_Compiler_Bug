{"sha": "dae4faf2e17c5c51954dd6f7e29229780371750c", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6ZGFlNGZhZjJlMTdjNWM1MTk1NGRkNmY3ZTI5MjI5NzgwMzcxNzUwYw==", "commit": {"author": {"name": "Thomas Quinot", "email": "quinot@adacore.com", "date": "2009-04-16T10:31:23Z"}, "committer": {"name": "Arnaud Charlet", "email": "charlet@gcc.gnu.org", "date": "2009-04-16T10:31:23Z"}, "message": "exp_dist.adb (Build_From_Any_Call): For a subtype that is a generic actual type...\n\n2009-04-16  Thomas Quinot  <quinot@adacore.com>\n\n\t* exp_dist.adb (Build_From_Any_Call): For a subtype that is a generic\n\tactual type, use the base type to build the To_Any function.\n\t(Build_From_Any_Function): Remove junk, useless subtype conversion.\n\n2009-04-16  Thomas Quinot  <quinot@adacore.com>\n\n\t* exp_ch9.adb, exp_code.adb, tbuild.adb, sem_case.adb,\n\trestrict.adb: Minor code reorganization (use\n\tAdd_{Char,Str}_To_Name_Buffer instead of inlining it by hand).\n\nFrom-SVN: r146166", "tree": {"sha": "0d8ff538d28b6c30c21077d81930181dcde2d797", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/0d8ff538d28b6c30c21077d81930181dcde2d797"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/dae4faf2e17c5c51954dd6f7e29229780371750c", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/dae4faf2e17c5c51954dd6f7e29229780371750c", "html_url": "https://github.com/Rust-GCC/gccrs/commit/dae4faf2e17c5c51954dd6f7e29229780371750c", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/dae4faf2e17c5c51954dd6f7e29229780371750c/comments", "author": null, "committer": null, "parents": [{"sha": "2794f02243b66df4e2ecbb042e26835f8b4a2a93", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/2794f02243b66df4e2ecbb042e26835f8b4a2a93", "html_url": "https://github.com/Rust-GCC/gccrs/commit/2794f02243b66df4e2ecbb042e26835f8b4a2a93"}], "stats": {"total": 88, "additions": 39, "deletions": 49}, "files": [{"sha": "8f657b5ef26164d7645d7b3974570cbaf6817cf0", "filename": "gcc/ada/ChangeLog", "status": "modified", "additions": 12, "deletions": 0, "changes": 12, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/dae4faf2e17c5c51954dd6f7e29229780371750c/gcc%2Fada%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/dae4faf2e17c5c51954dd6f7e29229780371750c/gcc%2Fada%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fada%2FChangeLog?ref=dae4faf2e17c5c51954dd6f7e29229780371750c", "patch": "@@ -1,3 +1,15 @@\n+2009-04-16  Thomas Quinot  <quinot@adacore.com>\n+\n+\t* exp_dist.adb (Build_From_Any_Call): For a subtype that is a generic\n+\tactual type, use the base type to build the To_Any function.\n+\t(Build_From_Any_Function): Remove junk, useless subtype conversion.\n+\n+2009-04-16  Thomas Quinot  <quinot@adacore.com>\n+\n+\t* exp_ch9.adb, exp_code.adb, tbuild.adb, sem_case.adb,\n+\trestrict.adb: Minor code reorganization (use\n+\tAdd_{Char,Str}_To_Name_Buffer instead of inlining it by hand).\n+\n 2009-04-16  Bob Duff  <duff@adacore.com>\n \n \t* exp_ch6.ads, exp_ch6.adb (Is_Build_In_Place_Function_Return): Remove,"}, {"sha": "d09911a680bcb00dd29c8918df62c0f3ca15f29b", "filename": "gcc/ada/exp_ch9.adb", "status": "modified", "additions": 5, "deletions": 13, "changes": 18, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/dae4faf2e17c5c51954dd6f7e29229780371750c/gcc%2Fada%2Fexp_ch9.adb", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/dae4faf2e17c5c51954dd6f7e29229780371750c/gcc%2Fada%2Fexp_ch9.adb", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fada%2Fexp_ch9.adb?ref=dae4faf2e17c5c51954dd6f7e29229780371750c", "patch": "@@ -1218,8 +1218,7 @@ package body Exp_Ch9 is\n \n          --  Add a leading '('\n \n-         Name_Len := Name_Len + 1;\n-         Name_Buffer (Name_Len) := '(';\n+         Add_Char_To_Name_Buffer ('(');\n \n          --  Generate:\n          --    new String'(\"<Entry name>(\" & Lnn'Img & \")\");\n@@ -3176,13 +3175,9 @@ package body Exp_Ch9 is\n          Name_Len := Name_Len - 1;\n       end if;\n \n-      Name_Buffer (Name_Len + 1) := '_';\n-      Name_Buffer (Name_Len + 2) := '_';\n-\n-      Name_Len := Name_Len + 2;\n+      Add_Str_To_Name_Buffer (\"__\");\n       for J in 1 .. Select_Len loop\n-         Name_Len := Name_Len + 1;\n-         Name_Buffer (Name_Len) := Select_Buffer (J);\n+         Add_Char_To_Name_Buffer (Select_Buffer (J));\n       end loop;\n \n       --  Now add the Append_Char if specified. The encoding to follow\n@@ -3195,13 +3190,10 @@ package body Exp_Ch9 is\n \n       if Append_Char /= ' ' then\n          if Append_Char = 'P' or Append_Char = 'N' then\n-            Name_Len := Name_Len + 1;\n-            Name_Buffer (Name_Len) := Append_Char;\n+            Add_Char_To_Name_Buffer (Append_Char);\n             return Name_Find;\n          else\n-            Name_Buffer (Name_Len + 1) := '_';\n-            Name_Buffer (Name_Len + 2) := Append_Char;\n-            Name_Len := Name_Len + 2;\n+            Add_Str_To_Name_Buffer ((1 => '_', 2 => Append_Char));\n             return New_External_Name (Name_Find, ' ', -1);\n          end if;\n       else"}, {"sha": "2b0275268cf807f682541c08d7db6d021012efd5", "filename": "gcc/ada/exp_code.adb", "status": "modified", "additions": 1, "deletions": 2, "changes": 3, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/dae4faf2e17c5c51954dd6f7e29229780371750c/gcc%2Fada%2Fexp_code.adb", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/dae4faf2e17c5c51954dd6f7e29229780371750c/gcc%2Fada%2Fexp_code.adb", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fada%2Fexp_code.adb?ref=dae4faf2e17c5c51954dd6f7e29229780371750c", "patch": "@@ -220,8 +220,7 @@ package body Exp_Code is\n \n       Name_Len := 0;\n       loop\n-         Name_Len := Name_Len + 1;\n-         Name_Buffer (Name_Len) := C;\n+         Add_Char_To_Name_Buffer (C);\n          Clobber_Ptr := Clobber_Ptr + 1;\n          exit when Clobber_Ptr > Len;\n          C := Get_Character (Get_String_Char (Str, Clobber_Ptr));"}, {"sha": "28916b02935d2325cb2e5d6fbaaafa6753f38e8e", "filename": "gcc/ada/exp_dist.adb", "status": "modified", "additions": 14, "deletions": 6, "changes": 20, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/dae4faf2e17c5c51954dd6f7e29229780371750c/gcc%2Fada%2Fexp_dist.adb", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/dae4faf2e17c5c51954dd6f7e29229780371750c/gcc%2Fada%2Fexp_dist.adb", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fada%2Fexp_dist.adb?ref=dae4faf2e17c5c51954dd6f7e29229780371750c", "patch": "@@ -8461,8 +8461,17 @@ package body Exp_Dist is\n             else\n                declare\n                   Decl : Entity_Id;\n+                  Typ  : Entity_Id := U_Type;\n+\n                begin\n-                  Build_From_Any_Function (Loc, U_Type, Decl, Fnam);\n+                  --  For the subtype representing a generic actual type, go\n+                  --  to the base type.\n+\n+                  if Is_Generic_Actual_Type (Typ) then\n+                     Typ := Base_Type (Typ);\n+                  end if;\n+\n+                  Build_From_Any_Function (Loc, Typ, Decl, Fnam);\n                   Append_To (Decls, Decl);\n                end;\n             end if;\n@@ -8565,11 +8574,10 @@ package body Exp_Dist is\n                   Append_To (Stms,\n                     Make_Simple_Return_Statement (Loc,\n                       Expression =>\n-                        OK_Convert_To (Typ,\n-                          Build_From_Any_Call\n-                            (Etype (Typ),\n-                             New_Occurrence_Of (Any_Parameter, Loc),\n-                             Decls))));\n+                        Build_From_Any_Call\n+                          (Etype (Typ),\n+                           New_Occurrence_Of (Any_Parameter, Loc),\n+                           Decls)));\n \n                else\n                   declare"}, {"sha": "c883e0a8963c411f0d2af69ea258b539a60cf57d", "filename": "gcc/ada/restrict.adb", "status": "modified", "additions": 1, "deletions": 4, "changes": 5, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/dae4faf2e17c5c51954dd6f7e29229780371750c/gcc%2Fada%2Frestrict.adb", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/dae4faf2e17c5c51954dd6f7e29229780371750c/gcc%2Fada%2Frestrict.adb", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fada%2Frestrict.adb?ref=dae4faf2e17c5c51954dd6f7e29229780371750c", "patch": "@@ -154,10 +154,7 @@ package body Restrict is\n             --  Strip extension and pad to eight characters\n \n             Name_Len := Name_Len - 4;\n-            while Name_Len < 8 loop\n-               Name_Len := Name_Len + 1;\n-               Name_Buffer (Name_Len) := ' ';\n-            end loop;\n+            Add_Str_To_Name_Buffer ((Name_Len + 1 .. 8 => ' '));\n \n             --  If predefined unit, check the list of restricted units\n "}, {"sha": "5de995d984b5f6a0c4b69e491f608056e793e5b1", "filename": "gcc/ada/sem_case.adb", "status": "modified", "additions": 3, "deletions": 18, "changes": 21, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/dae4faf2e17c5c51954dd6f7e29229780371750c/gcc%2Fada%2Fsem_case.adb", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/dae4faf2e17c5c51954dd6f7e29229780371750c/gcc%2Fada%2Fsem_case.adb", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fada%2Fsem_case.adb?ref=dae4faf2e17c5c51954dd6f7e29229780371750c", "patch": "@@ -313,26 +313,11 @@ package body Sem_Case is\n       --  the pos value passed as an argument to Choice_Image.\n \n       Get_Name_String (Chars (First_Subtype (Ctype)));\n-      Name_Len := Name_Len + 1;\n-      Name_Buffer (Name_Len) := ''';\n-      Name_Len := Name_Len + 1;\n-      Name_Buffer (Name_Len) := 'v';\n-      Name_Len := Name_Len + 1;\n-      Name_Buffer (Name_Len) := 'a';\n-      Name_Len := Name_Len + 1;\n-      Name_Buffer (Name_Len) := 'l';\n-      Name_Len := Name_Len + 1;\n-      Name_Buffer (Name_Len) := '(';\n \n+      Add_Str_To_Name_Buffer (\"'val(\");\n       UI_Image (Value);\n-\n-      for J in 1 .. UI_Image_Length loop\n-         Name_Len := Name_Len + 1;\n-         Name_Buffer (Name_Len) := UI_Image_Buffer (J);\n-      end loop;\n-\n-      Name_Len := Name_Len + 1;\n-      Name_Buffer (Name_Len) := ')';\n+      Add_Str_To_Name_Buffer (UI_Image_Buffer (1 .. UI_Image_Length));\n+      Add_Char_To_Name_Buffer (')');\n       return Name_Find;\n    end Choice_Image;\n "}, {"sha": "395a71376593e91345242f67e1ab72d15ee62d1f", "filename": "gcc/ada/tbuild.adb", "status": "modified", "additions": 3, "deletions": 6, "changes": 9, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/dae4faf2e17c5c51954dd6f7e29229780371750c/gcc%2Fada%2Ftbuild.adb", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/dae4faf2e17c5c51954dd6f7e29229780371750c/gcc%2Fada%2Ftbuild.adb", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fada%2Ftbuild.adb?ref=dae4faf2e17c5c51954dd6f7e29229780371750c", "patch": "@@ -511,8 +511,7 @@ package body Tbuild is\n \n       if Suffix /= ' ' then\n          pragma Assert (Is_OK_Internal_Letter (Suffix));\n-         Name_Len := Name_Len + 1;\n-         Name_Buffer (Name_Len) := Suffix;\n+         Add_Char_To_Name_Buffer (Suffix);\n       end if;\n \n       if Suffix_Index /= 0 then\n@@ -637,10 +636,8 @@ package body Tbuild is\n    is\n    begin\n       Get_Name_String (Related_Id);\n-      Name_Len := Name_Len + 1;\n-      Name_Buffer (Name_Len) := '_';\n-      Name_Buffer (Name_Len + 1 .. Name_Len + Suffix'Length) := Suffix;\n-      Name_Len := Name_Len + Suffix'Length;\n+      Add_Char_To_Name_Buffer ('_');\n+      Add_Str_To_Name_Buffer (Suffix);\n       return Name_Find;\n    end New_Suffixed_Name;\n "}]}