{"sha": "d1b0433b1aba81a6c3e87e867aaf24c6356e4f35", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6ZDFiMDQzM2IxYWJhODFhNmMzZTg3ZTg2N2FhZjI0YzYzNTZlNGYzNQ==", "commit": {"author": {"name": "Eric Botcazou", "email": "ebotcazou@adacore.com", "date": "2014-11-08T09:17:23Z"}, "committer": {"name": "Eric Botcazou", "email": "ebotcazou@gcc.gnu.org", "date": "2014-11-08T09:17:23Z"}, "message": "arm.c (arm_set_return_address): Mark the store as frame related, if any.\n\n\t* config/arm/arm.c (arm_set_return_address): Mark the store as frame\n\trelated, if any.\n\t(thumb_set_return_address): Likewise.\n\nFrom-SVN: r217251", "tree": {"sha": "0a7f69c453ba7a515495f989366889d4620975cc", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/0a7f69c453ba7a515495f989366889d4620975cc"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/d1b0433b1aba81a6c3e87e867aaf24c6356e4f35", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/d1b0433b1aba81a6c3e87e867aaf24c6356e4f35", "html_url": "https://github.com/Rust-GCC/gccrs/commit/d1b0433b1aba81a6c3e87e867aaf24c6356e4f35", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/d1b0433b1aba81a6c3e87e867aaf24c6356e4f35/comments", "author": null, "committer": null, "parents": [{"sha": "31cb2db0b28fe254d07194fb68bd95f8372a0457", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/31cb2db0b28fe254d07194fb68bd95f8372a0457", "html_url": "https://github.com/Rust-GCC/gccrs/commit/31cb2db0b28fe254d07194fb68bd95f8372a0457"}], "stats": {"total": 18, "additions": 16, "deletions": 2}, "files": [{"sha": "6bfc320d05c6568f1790985c8c1040b3cbff688c", "filename": "gcc/ChangeLog", "status": "modified", "additions": 6, "deletions": 0, "changes": 6, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/d1b0433b1aba81a6c3e87e867aaf24c6356e4f35/gcc%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/d1b0433b1aba81a6c3e87e867aaf24c6356e4f35/gcc%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2FChangeLog?ref=d1b0433b1aba81a6c3e87e867aaf24c6356e4f35", "patch": "@@ -1,3 +1,9 @@\n+2014-11-08  Eric Botcazou  <ebotcazou@adacore.com>\n+\n+\t* config/arm/arm.c (arm_set_return_address): Mark the store as frame\n+\trelated, if any.\n+\t(thumb_set_return_address): Likewise.\n+\n 2014-11-07  Jeff Law  <law@redhat.com>\n \n \tPR tree-optimization/61515"}, {"sha": "05529520648fed65d46724973698c5aa7d3d6229", "filename": "gcc/config/arm/arm.c", "status": "modified", "additions": 10, "deletions": 2, "changes": 12, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/d1b0433b1aba81a6c3e87e867aaf24c6356e4f35/gcc%2Fconfig%2Farm%2Farm.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/d1b0433b1aba81a6c3e87e867aaf24c6356e4f35/gcc%2Fconfig%2Farm%2Farm.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fconfig%2Farm%2Farm.c?ref=d1b0433b1aba81a6c3e87e867aaf24c6356e4f35", "patch": "@@ -29012,7 +29012,11 @@ arm_set_return_address (rtx source, rtx scratch)\n \n \t  addr = plus_constant (Pmode, addr, delta);\n \t}\n-      emit_move_insn (gen_frame_mem (Pmode, addr), source);\n+      /* The store needs to be marked as frame related in order to prevent\n+\t DSE from deleting it as dead if it is based on fp.  */\n+      rtx insn = emit_move_insn (gen_frame_mem (Pmode, addr), source);\n+      RTX_FRAME_RELATED_P (insn) = 1;\n+      add_reg_note (insn, REG_CFA_RESTORE, gen_rtx_REG (Pmode, LR_REGNUM));\n     }\n }\n \n@@ -29064,7 +29068,11 @@ thumb_set_return_address (rtx source, rtx scratch)\n       else\n \taddr = plus_constant (Pmode, addr, delta);\n \n-      emit_move_insn (gen_frame_mem (Pmode, addr), source);\n+      /* The store needs to be marked as frame related in order to prevent\n+\t DSE from deleting it as dead if it is based on fp.  */\n+      rtx insn = emit_move_insn (gen_frame_mem (Pmode, addr), source);\n+      RTX_FRAME_RELATED_P (insn) = 1;\n+      add_reg_note (insn, REG_CFA_RESTORE, gen_rtx_REG (Pmode, LR_REGNUM));\n     }\n   else\n     emit_move_insn (gen_rtx_REG (Pmode, LR_REGNUM), source);"}]}