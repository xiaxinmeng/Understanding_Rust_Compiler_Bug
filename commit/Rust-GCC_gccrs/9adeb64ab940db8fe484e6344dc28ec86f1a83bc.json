{"sha": "9adeb64ab940db8fe484e6344dc28ec86f1a83bc", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6OWFkZWI2NGFiOTQwZGI4ZmU0ODRlNjM0NGRjMjhlYzg2ZjFhODNiYw==", "commit": {"author": {"name": "Jakub Jelinek", "email": "jakub@redhat.com", "date": "2017-11-27T08:34:50Z"}, "committer": {"name": "Jakub Jelinek", "email": "jakub@gcc.gnu.org", "date": "2017-11-27T08:34:50Z"}, "message": "re PR target/83100 (powerpc: internal compiler error: in get_variable_section, at varasm.c:1150 with -fdata-sections)\n\n\tPR target/83100\n\t* varasm.c (bss_initializer_p): Return true for DECL_COMMON\n\tTREE_READONLY decls.\n\n\t* gcc.dg/pr83100-1.c: New test.\n\t* gcc.dg/pr83100-2.c: New test.\n\t* gcc.dg/pr83100-3.c: New test.\n\t* gcc.dg/pr83100-4.c: New test.\n\nFrom-SVN: r255160", "tree": {"sha": "6035717443e5050e05a17efca330ad5f79e07d48", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/6035717443e5050e05a17efca330ad5f79e07d48"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/9adeb64ab940db8fe484e6344dc28ec86f1a83bc", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/9adeb64ab940db8fe484e6344dc28ec86f1a83bc", "html_url": "https://github.com/Rust-GCC/gccrs/commit/9adeb64ab940db8fe484e6344dc28ec86f1a83bc", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/9adeb64ab940db8fe484e6344dc28ec86f1a83bc/comments", "author": {"login": "jakubjelinek", "id": 9370665, "node_id": "MDQ6VXNlcjkzNzA2NjU=", "avatar_url": "https://avatars.githubusercontent.com/u/9370665?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jakubjelinek", "html_url": "https://github.com/jakubjelinek", "followers_url": "https://api.github.com/users/jakubjelinek/followers", "following_url": "https://api.github.com/users/jakubjelinek/following{/other_user}", "gists_url": "https://api.github.com/users/jakubjelinek/gists{/gist_id}", "starred_url": "https://api.github.com/users/jakubjelinek/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jakubjelinek/subscriptions", "organizations_url": "https://api.github.com/users/jakubjelinek/orgs", "repos_url": "https://api.github.com/users/jakubjelinek/repos", "events_url": "https://api.github.com/users/jakubjelinek/events{/privacy}", "received_events_url": "https://api.github.com/users/jakubjelinek/received_events", "type": "User", "site_admin": false}, "committer": null, "parents": [{"sha": "99282f81a6bcb5873c2a3c4755f625b5a44a915d", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/99282f81a6bcb5873c2a3c4755f625b5a44a915d", "html_url": "https://github.com/Rust-GCC/gccrs/commit/99282f81a6bcb5873c2a3c4755f625b5a44a915d"}], "stats": {"total": 55, "additions": 52, "deletions": 3}, "files": [{"sha": "7189a66ed8395f29406c9356470eab244ff0d0d0", "filename": "gcc/ChangeLog", "status": "modified", "additions": 6, "deletions": 0, "changes": 6, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/9adeb64ab940db8fe484e6344dc28ec86f1a83bc/gcc%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/9adeb64ab940db8fe484e6344dc28ec86f1a83bc/gcc%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2FChangeLog?ref=9adeb64ab940db8fe484e6344dc28ec86f1a83bc", "patch": "@@ -1,3 +1,9 @@\n+2017-11-27  Jakub Jelinek  <jakub@redhat.com>\n+\n+\tPR target/83100\n+\t* varasm.c (bss_initializer_p): Return true for DECL_COMMON\n+\tTREE_READONLY decls.\n+\n 2017-11-27  Markus Trippelsdorf  <markus@trippelsdorf.de>\n \n \tPR rtl-optimization/82488"}, {"sha": "ff40f3657e34140b56f8307dda4ede4e9f4aa974", "filename": "gcc/testsuite/ChangeLog", "status": "modified", "additions": 8, "deletions": 0, "changes": 8, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/9adeb64ab940db8fe484e6344dc28ec86f1a83bc/gcc%2Ftestsuite%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/9adeb64ab940db8fe484e6344dc28ec86f1a83bc/gcc%2Ftestsuite%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2FChangeLog?ref=9adeb64ab940db8fe484e6344dc28ec86f1a83bc", "patch": "@@ -1,3 +1,11 @@\n+2017-11-27  Jakub Jelinek  <jakub@redhat.com>\n+\n+\tPR target/83100\n+\t* gcc.dg/pr83100-1.c: New test.\n+\t* gcc.dg/pr83100-2.c: New test.\n+\t* gcc.dg/pr83100-3.c: New test.\n+\t* gcc.dg/pr83100-4.c: New test.\n+\n 2017-11-26  Julia Koval  <julia.koval@intel.com>\n \n \t* gcc.target/i386/funcspec-56.inc: Handle new march."}, {"sha": "233c1f687b0bbce969e99a3a25e070991f4115aa", "filename": "gcc/testsuite/gcc.dg/pr83100-1.c", "status": "added", "additions": 7, "deletions": 0, "changes": 7, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/9adeb64ab940db8fe484e6344dc28ec86f1a83bc/gcc%2Ftestsuite%2Fgcc.dg%2Fpr83100-1.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/9adeb64ab940db8fe484e6344dc28ec86f1a83bc/gcc%2Ftestsuite%2Fgcc.dg%2Fpr83100-1.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgcc.dg%2Fpr83100-1.c?ref=9adeb64ab940db8fe484e6344dc28ec86f1a83bc", "patch": "@@ -0,0 +1,7 @@\n+/* PR target/83100 */\n+/* { dg-do compile { target *-*-linux* *-*-gnu* } } */\n+/* { dg-options \"-O2 -fcommon -fdata-sections\" } */\n+\n+const int a;\n+\n+/* { dg-final { scan-assembler \"comm\" } } */"}, {"sha": "6dbe93dcd16029abdef8d177e3d0bfd6b9de5272", "filename": "gcc/testsuite/gcc.dg/pr83100-2.c", "status": "added", "additions": 15, "deletions": 0, "changes": 15, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/9adeb64ab940db8fe484e6344dc28ec86f1a83bc/gcc%2Ftestsuite%2Fgcc.dg%2Fpr83100-2.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/9adeb64ab940db8fe484e6344dc28ec86f1a83bc/gcc%2Ftestsuite%2Fgcc.dg%2Fpr83100-2.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgcc.dg%2Fpr83100-2.c?ref=9adeb64ab940db8fe484e6344dc28ec86f1a83bc", "patch": "@@ -0,0 +1,15 @@\n+/* PR target/83100 */\n+/* { dg-do run } */\n+/* { dg-options \"-O2 -fcommon -fdata-sections\" } */\n+/* { dg-additional-sources pr83100-3.c } */\n+/* { dg-skip-if \"-fdata-sections not supported\" { hppa*-*-hpux* nvptx-*-* } } */\n+\n+const int a;\n+\n+int\n+main ()\n+{\n+  if (a != 7)\n+    __builtin_abort ();\n+  return 0;\n+}"}, {"sha": "a28e852695f4038cb0484636ee4abccce9a8a80d", "filename": "gcc/testsuite/gcc.dg/pr83100-3.c", "status": "added", "additions": 6, "deletions": 0, "changes": 6, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/9adeb64ab940db8fe484e6344dc28ec86f1a83bc/gcc%2Ftestsuite%2Fgcc.dg%2Fpr83100-3.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/9adeb64ab940db8fe484e6344dc28ec86f1a83bc/gcc%2Ftestsuite%2Fgcc.dg%2Fpr83100-3.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgcc.dg%2Fpr83100-3.c?ref=9adeb64ab940db8fe484e6344dc28ec86f1a83bc", "patch": "@@ -0,0 +1,6 @@\n+/* PR target/83100 */\n+/* { dg-do compile } */\n+/* { dg-options \"-O2 -fcommon -fdata-sections\" } */\n+/* { dg-skip-if \"-fdata-sections not supported\" { hppa*-*-hpux* nvptx-*-* } } */\n+\n+const int a = 7;"}, {"sha": "bb26735dd1b046975fee46fbfa1ea6813f217dbd", "filename": "gcc/testsuite/gcc.dg/pr83100-4.c", "status": "added", "additions": 7, "deletions": 0, "changes": 7, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/9adeb64ab940db8fe484e6344dc28ec86f1a83bc/gcc%2Ftestsuite%2Fgcc.dg%2Fpr83100-4.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/9adeb64ab940db8fe484e6344dc28ec86f1a83bc/gcc%2Ftestsuite%2Fgcc.dg%2Fpr83100-4.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgcc.dg%2Fpr83100-4.c?ref=9adeb64ab940db8fe484e6344dc28ec86f1a83bc", "patch": "@@ -0,0 +1,7 @@\n+/* PR target/83100 */\n+/* { dg-do compile { target *-*-linux* *-*-gnu* } } */\n+/* { dg-options \"-O2 -fno-common -fdata-sections\" } */\n+\n+const int a;\n+\n+/* { dg-final { scan-assembler \"rodata.a\" { target i?86-*-* x86_64-*-* } } } */"}, {"sha": "ff912b7fa578b023cb908ff2da06f71434e340aa", "filename": "gcc/varasm.c", "status": "modified", "additions": 3, "deletions": 3, "changes": 6, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/9adeb64ab940db8fe484e6344dc28ec86f1a83bc/gcc%2Fvarasm.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/9adeb64ab940db8fe484e6344dc28ec86f1a83bc/gcc%2Fvarasm.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fvarasm.c?ref=9adeb64ab940db8fe484e6344dc28ec86f1a83bc", "patch": "@@ -986,9 +986,9 @@ decode_reg_name (const char *name)\n bool\n bss_initializer_p (const_tree decl)\n {\n-  /* Do not put constants into the .bss section, they belong in a readonly\n-     section.  */\n-  return (!TREE_READONLY (decl)\n+  /* Do not put non-common constants into the .bss section, they belong in\n+     a readonly section.  */\n+  return ((!TREE_READONLY (decl) || DECL_COMMON (decl))\n \t  && (DECL_INITIAL (decl) == NULL\n \t      /* In LTO we have no errors in program; error_mark_node is used\n \t         to mark offlined constructors.  */"}]}