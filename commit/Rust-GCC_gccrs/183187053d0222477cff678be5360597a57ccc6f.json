{"sha": "183187053d0222477cff678be5360597a57ccc6f", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6MTgzMTg3MDUzZDAyMjI0NzdjZmY2NzhiZTUzNjA1OTdhNTdjY2M2Zg==", "commit": {"author": {"name": "Eric Botcazou", "email": "ebotcazou@adacore.com", "date": "2018-02-09T12:33:40Z"}, "committer": {"name": "Eric Botcazou", "email": "ebotcazou@gcc.gnu.org", "date": "2018-02-09T12:33:40Z"}, "message": "optabs.c (prepare_cmp_insn): Try harder to emit a direct comparison instead of a libcall for UNORDERED.\n\n\t* optabs.c (prepare_cmp_insn): Try harder to emit a direct comparison\n\tinstead of a libcall for UNORDERED.\n\nFrom-SVN: r257525", "tree": {"sha": "4fd39ca0dd3cc59e95aa3cd55828e2558faf6b6d", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/4fd39ca0dd3cc59e95aa3cd55828e2558faf6b6d"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/183187053d0222477cff678be5360597a57ccc6f", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/183187053d0222477cff678be5360597a57ccc6f", "html_url": "https://github.com/Rust-GCC/gccrs/commit/183187053d0222477cff678be5360597a57ccc6f", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/183187053d0222477cff678be5360597a57ccc6f/comments", "author": null, "committer": null, "parents": [{"sha": "0079ae8877dfb4be135ac26c21819f4a094f0289", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/0079ae8877dfb4be135ac26c21819f4a094f0289", "html_url": "https://github.com/Rust-GCC/gccrs/commit/0079ae8877dfb4be135ac26c21819f4a094f0289"}], "stats": {"total": 22, "additions": 19, "deletions": 3}, "files": [{"sha": "858ad9dd9db135b10ace442b45a12dfb9e8935e1", "filename": "gcc/ChangeLog", "status": "modified", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/183187053d0222477cff678be5360597a57ccc6f/gcc%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/183187053d0222477cff678be5360597a57ccc6f/gcc%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2FChangeLog?ref=183187053d0222477cff678be5360597a57ccc6f", "patch": "@@ -1,3 +1,8 @@\n+2018-02-09  Eric Botcazou  <ebotcazou@adacore.com>\n+\n+\t* optabs.c (prepare_cmp_insn): Try harder to emit a direct comparison\n+\tinstead of a libcall for UNORDERED.\n+\n 2018-02-09  Tamar Christina  <tamar.christina@arm.com>\n \n \tPR target/82641"}, {"sha": "5f61e4e9521b58b9cdb7f8207d69fa8e042feecf", "filename": "gcc/optabs.c", "status": "modified", "additions": 14, "deletions": 3, "changes": 17, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/183187053d0222477cff678be5360597a57ccc6f/gcc%2Foptabs.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/183187053d0222477cff678be5360597a57ccc6f/gcc%2Foptabs.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Foptabs.c?ref=183187053d0222477cff678be5360597a57ccc6f", "patch": "@@ -3935,7 +3935,20 @@ prepare_cmp_insn (rtx x, rtx y, enum rtx_code comparison, rtx size,\n   if (methods != OPTAB_LIB_WIDEN)\n     goto fail;\n \n-  if (!SCALAR_FLOAT_MODE_P (mode))\n+  if (SCALAR_FLOAT_MODE_P (mode))\n+    {\n+      /* Small trick if UNORDERED isn't implemented by the hardware.  */\n+      if (comparison == UNORDERED && rtx_equal_p (x, y))\n+\t{\n+\t  prepare_cmp_insn (x, y, UNLT, NULL_RTX, unsignedp, OPTAB_WIDEN,\n+\t\t\t    ptest, pmode);\n+\t  if (*ptest)\n+\t    return;\n+\t}\n+\n+      prepare_float_lib_cmp (x, y, comparison, ptest, pmode);\n+    }\n+  else\n     {\n       rtx result;\n       machine_mode ret_mode;\n@@ -3982,8 +3995,6 @@ prepare_cmp_insn (rtx x, rtx y, enum rtx_code comparison, rtx size,\n       prepare_cmp_insn (x, y, comparison, NULL_RTX, unsignedp, methods,\n \t\t\tptest, pmode);\n     }\n-  else\n-    prepare_float_lib_cmp (x, y, comparison, ptest, pmode);\n \n   return;\n "}]}