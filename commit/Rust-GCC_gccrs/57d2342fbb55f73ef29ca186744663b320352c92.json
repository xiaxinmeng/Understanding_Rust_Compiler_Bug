{"sha": "57d2342fbb55f73ef29ca186744663b320352c92", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6NTdkMjM0MmZiYjU1ZjczZWYyOWNhMTg2NzQ0NjYzYjMyMDM1MmM5Mg==", "commit": {"author": {"name": "Hans-Peter Nilsson", "email": "hp@axis.com", "date": "2021-05-14T23:26:17Z"}, "committer": {"name": "Hans-Peter Nilsson", "email": "hp@axis.com", "date": "2021-05-15T18:34:01Z"}, "message": "reorg.c (fill_slots_from_thread): Reinstate code typoed out in \"Remove CC0\".\n\nThe typo here, is obviously mistaken removal of lines next\nto a line that was validly removed.  Targets affected are\nthose with a delay-slot *and* defining TARGET_FLAGS_REGNUM.\nIn-tree, a git-grep says the only ones matching are CRIS,\nh8300 and visium.  The code removal has the effect of\nwrong-code, not reverting the effect of r11-2814.\n\nI'm \"guessing\" it was the effect of an incorrect conflict\nresolution in preparatory work for the r12-440 /\nbd1cd0d0e0fe / \"Remove CC0\" commit, when rebasing a related\nbranch, and not testing any of the affected targets.  Either\nway, the effect was a btest-gcc.sh state of \"regress-1152\"\nfor cris-elf.  FWIW, I wrote the removed code (sans the\nvalidly removed cc0 line), a part of what was committed at\n2020-08-24 as 0e6c51de8ec47 / r11-2814.\n\nThis commit gets cris-elf test-results back to a sane state\n(tested at 0ffdbc85d9a6 / r12-761).\n\ngcc:\n\t* reorg.c (fill_slots_from_thread): Reinstate code typoed out in\n\t\"Remove CC0\".", "tree": {"sha": "afbfad94624d7ffa8af4e7305700c7106b935f62", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/afbfad94624d7ffa8af4e7305700c7106b935f62"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/57d2342fbb55f73ef29ca186744663b320352c92", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/57d2342fbb55f73ef29ca186744663b320352c92", "html_url": "https://github.com/Rust-GCC/gccrs/commit/57d2342fbb55f73ef29ca186744663b320352c92", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/57d2342fbb55f73ef29ca186744663b320352c92/comments", "author": {"login": "hpataxisdotcom", "id": 80339731, "node_id": "MDQ6VXNlcjgwMzM5NzMx", "avatar_url": "https://avatars.githubusercontent.com/u/80339731?v=4", "gravatar_id": "", "url": "https://api.github.com/users/hpataxisdotcom", "html_url": "https://github.com/hpataxisdotcom", "followers_url": "https://api.github.com/users/hpataxisdotcom/followers", "following_url": "https://api.github.com/users/hpataxisdotcom/following{/other_user}", "gists_url": "https://api.github.com/users/hpataxisdotcom/gists{/gist_id}", "starred_url": "https://api.github.com/users/hpataxisdotcom/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/hpataxisdotcom/subscriptions", "organizations_url": "https://api.github.com/users/hpataxisdotcom/orgs", "repos_url": "https://api.github.com/users/hpataxisdotcom/repos", "events_url": "https://api.github.com/users/hpataxisdotcom/events{/privacy}", "received_events_url": "https://api.github.com/users/hpataxisdotcom/received_events", "type": "User", "site_admin": false}, "committer": {"login": "hpataxisdotcom", "id": 80339731, "node_id": "MDQ6VXNlcjgwMzM5NzMx", "avatar_url": "https://avatars.githubusercontent.com/u/80339731?v=4", "gravatar_id": "", "url": "https://api.github.com/users/hpataxisdotcom", "html_url": "https://github.com/hpataxisdotcom", "followers_url": "https://api.github.com/users/hpataxisdotcom/followers", "following_url": "https://api.github.com/users/hpataxisdotcom/following{/other_user}", "gists_url": "https://api.github.com/users/hpataxisdotcom/gists{/gist_id}", "starred_url": "https://api.github.com/users/hpataxisdotcom/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/hpataxisdotcom/subscriptions", "organizations_url": "https://api.github.com/users/hpataxisdotcom/orgs", "repos_url": "https://api.github.com/users/hpataxisdotcom/repos", "events_url": "https://api.github.com/users/hpataxisdotcom/events{/privacy}", "received_events_url": "https://api.github.com/users/hpataxisdotcom/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "af42043e6618e69187b47f37dac870763c01e20f", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/af42043e6618e69187b47f37dac870763c01e20f", "html_url": "https://github.com/Rust-GCC/gccrs/commit/af42043e6618e69187b47f37dac870763c01e20f"}], "stats": {"total": 10, "additions": 10, "deletions": 0}, "files": [{"sha": "7f06a6f6d092c4aa1f3aa165a038601cbcf8e49a", "filename": "gcc/reorg.c", "status": "modified", "additions": 10, "deletions": 0, "changes": 10, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/57d2342fbb55f73ef29ca186744663b320352c92/gcc%2Freorg.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/57d2342fbb55f73ef29ca186744663b320352c92/gcc%2Freorg.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Freorg.c?ref=57d2342fbb55f73ef29ca186744663b320352c92", "patch": "@@ -2375,6 +2375,16 @@ fill_slots_from_thread (rtx_jump_insn *insn, rtx condition,\n       if (! insn_references_resource_p (trial, &set, true)\n \t  && ! insn_sets_resource_p (trial, filter_flags ? &fset : &set, true)\n \t  && ! insn_sets_resource_p (trial, &needed, true)\n+\t  /* If we're handling sets to the flags register specially, we\n+\t     only allow an insn into a delay-slot, if it either:\n+\t     - doesn't set the flags register,\n+\t     - the \"set\" of the flags register isn't used (clobbered),\n+\t     - insns between the delay-slot insn and the trial-insn\n+\t     as accounted in \"set\", have not affected the flags register.  */\n+\t  && (! filter_flags\n+\t      || ! insn_sets_resource_p (trial, &flags_res, true)\n+\t      || find_regno_note (trial, REG_UNUSED, targetm.flags_regnum)\n+\t      || ! TEST_HARD_REG_BIT (set.regs, targetm.flags_regnum))\n \t  && ! can_throw_internal (trial))\n \t{\n \t  rtx_insn *prior_insn;"}]}