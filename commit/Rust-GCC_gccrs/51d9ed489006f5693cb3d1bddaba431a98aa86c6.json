{"sha": "51d9ed489006f5693cb3d1bddaba431a98aa86c6", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6NTFkOWVkNDg5MDA2ZjU2OTNjYjNkMWJkZGFiYTQzMWE5OGFhODZjNg==", "commit": {"author": {"name": "Martin Jambor", "email": "mjambor@suse.cz", "date": "2016-05-16T17:49:44Z"}, "committer": {"name": "Martin Jambor", "email": "jamborm@gcc.gnu.org", "date": "2016-05-16T17:49:44Z"}, "message": "[hsa] Increase hsa symbol alignment to natural one\n\n2016-05-16  Martin Jambor  <mjambor@suse.cz>\n\n\t* hsa-gen.c (fillup_for_decl): Increase alignment to natural one.\n\t(get_symbol_for_decl): Sorry if a global symbol in under-aligned.\n\nlibgomp/\n        * testsuite/libgomp.hsa.c/complex-align-2.c: New test.\n\nFrom-SVN: r236295", "tree": {"sha": "5ed5bcd7d4b7df31c135b193a9f9d59d92b00c1b", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/5ed5bcd7d4b7df31c135b193a9f9d59d92b00c1b"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/51d9ed489006f5693cb3d1bddaba431a98aa86c6", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/51d9ed489006f5693cb3d1bddaba431a98aa86c6", "html_url": "https://github.com/Rust-GCC/gccrs/commit/51d9ed489006f5693cb3d1bddaba431a98aa86c6", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/51d9ed489006f5693cb3d1bddaba431a98aa86c6/comments", "author": {"login": "jamborm", "id": 2180070, "node_id": "MDQ6VXNlcjIxODAwNzA=", "avatar_url": "https://avatars.githubusercontent.com/u/2180070?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jamborm", "html_url": "https://github.com/jamborm", "followers_url": "https://api.github.com/users/jamborm/followers", "following_url": "https://api.github.com/users/jamborm/following{/other_user}", "gists_url": "https://api.github.com/users/jamborm/gists{/gist_id}", "starred_url": "https://api.github.com/users/jamborm/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jamborm/subscriptions", "organizations_url": "https://api.github.com/users/jamborm/orgs", "repos_url": "https://api.github.com/users/jamborm/repos", "events_url": "https://api.github.com/users/jamborm/events{/privacy}", "received_events_url": "https://api.github.com/users/jamborm/received_events", "type": "User", "site_admin": false}, "committer": null, "parents": [{"sha": "538374e1396abe947817191a4da34ecc0ad3fb19", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/538374e1396abe947817191a4da34ecc0ad3fb19", "html_url": "https://github.com/Rust-GCC/gccrs/commit/538374e1396abe947817191a4da34ecc0ad3fb19"}], "stats": {"total": 55, "additions": 51, "deletions": 4}, "files": [{"sha": "5df3ec2da835dc99eb209459042750e3c6756330", "filename": "gcc/ChangeLog", "status": "modified", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/51d9ed489006f5693cb3d1bddaba431a98aa86c6/gcc%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/51d9ed489006f5693cb3d1bddaba431a98aa86c6/gcc%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2FChangeLog?ref=51d9ed489006f5693cb3d1bddaba431a98aa86c6", "patch": "@@ -1,3 +1,8 @@\n+2016-05-16  Martin Jambor  <mjambor@suse.cz>\n+\n+\t* hsa-gen.c (fillup_for_decl): Increase alignment to natural one.\n+\t(get_symbol_for_decl): Sorry if a global symbol in under-aligned.\n+\n 2016-05-16  Marek Polacek  <polacek@redhat.com>\n \n \t* gimple.c (maybe_remove_unused_call_args): Fix typos in the"}, {"sha": "697d5997519e17e5dd270e81701c11324e9865ca", "filename": "gcc/hsa-gen.c", "status": "modified", "additions": 15, "deletions": 4, "changes": 19, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/51d9ed489006f5693cb3d1bddaba431a98aa86c6/gcc%2Fhsa-gen.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/51d9ed489006f5693cb3d1bddaba431a98aa86c6/gcc%2Fhsa-gen.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fhsa-gen.c?ref=51d9ed489006f5693cb3d1bddaba431a98aa86c6", "patch": "@@ -203,9 +203,13 @@ hsa_symbol::fillup_for_decl (tree decl)\n {\n   m_decl = decl;\n   m_type = hsa_type_for_tree_type (TREE_TYPE (decl), &m_dim, false);\n-\n   if (hsa_seen_error ())\n-    m_seen_error = true;\n+    {\n+      m_seen_error = true;\n+      return;\n+    }\n+\n+  m_align = MAX (m_align, hsa_natural_alignment (m_type));\n }\n \n /* Constructor of class representing global HSA function/kernel information and\n@@ -929,6 +933,14 @@ get_symbol_for_decl (tree decl)\n \t\t\t\tBRIG_LINKAGE_PROGRAM, true,\n \t\t\t\tBRIG_ALLOCATION_PROGRAM, align);\n \t  hsa_cfun->m_global_symbols.safe_push (sym);\n+\t  sym->fillup_for_decl (decl);\n+\t  if (sym->m_align > align)\n+\t    {\n+\t      sym->m_seen_error = true;\n+\t      HSA_SORRY_ATV (EXPR_LOCATION (decl),\n+\t\t\t     \"HSA specification requires that %E is at least \"\n+\t\t\t     \"naturally aligned\", decl);\n+\t    }\n \t}\n       else\n \t{\n@@ -944,12 +956,11 @@ get_symbol_for_decl (tree decl)\n \t  sym = new hsa_symbol (BRIG_TYPE_NONE, BRIG_SEGMENT_PRIVATE,\n \t\t\t\tBRIG_LINKAGE_FUNCTION);\n \t  sym->m_align = align;\n+\t  sym->fillup_for_decl (decl);\n \t  hsa_cfun->m_private_variables.safe_push (sym);\n \t}\n \n-      sym->fillup_for_decl (decl);\n       sym->m_name = hsa_get_declaration_name (decl);\n-\n       *slot = sym;\n       return sym;\n     }"}, {"sha": "f509114a20cb592fb609e9bb787d219a5a3a8d20", "filename": "libgomp/ChangeLog", "status": "modified", "additions": 4, "deletions": 0, "changes": 4, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/51d9ed489006f5693cb3d1bddaba431a98aa86c6/libgomp%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/51d9ed489006f5693cb3d1bddaba431a98aa86c6/libgomp%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libgomp%2FChangeLog?ref=51d9ed489006f5693cb3d1bddaba431a98aa86c6", "patch": "@@ -1,3 +1,7 @@\n+2016-05-16  Martin Jambor  <mjambor@suse.cz>\n+\n+        * testsuite/libgomp.hsa.c/complex-align-2.c: New test.\n+\n 2016-05-02  Nathan Sidwell  <nathan@codesourcery.com>\n \n \t* testsuite/libgomp.oacc-c-c++-common/loop-auto-1.c: Adjust"}, {"sha": "b2d7acff443ca34c80f1a53a52f6a5d91278aa8d", "filename": "libgomp/testsuite/libgomp.hsa.c/complex-align-2.c", "status": "added", "additions": 27, "deletions": 0, "changes": 27, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/51d9ed489006f5693cb3d1bddaba431a98aa86c6/libgomp%2Ftestsuite%2Flibgomp.hsa.c%2Fcomplex-align-2.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/51d9ed489006f5693cb3d1bddaba431a98aa86c6/libgomp%2Ftestsuite%2Flibgomp.hsa.c%2Fcomplex-align-2.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libgomp%2Ftestsuite%2Flibgomp.hsa.c%2Fcomplex-align-2.c?ref=51d9ed489006f5693cb3d1bddaba431a98aa86c6", "patch": "@@ -0,0 +1,27 @@\n+#pragma omp declare target\n+    _Complex int *g;\n+#pragma omp end declare target\n+\n+\n+\n+_Complex float f(void);\n+\n+int\n+main ()\n+{\n+  _Complex int y;\n+#pragma omp target map(from:y)\n+  {\n+    _Complex int x;\n+    g = &x;\n+    __imag__ x = 1;\n+    __real__ x = 2;\n+    y = x;\n+  }\n+\n+  if ((__imag__ y != 1)\n+      || (__real__ y != 2))\n+    __builtin_abort ();\n+  return 0;\n+}\n+"}]}