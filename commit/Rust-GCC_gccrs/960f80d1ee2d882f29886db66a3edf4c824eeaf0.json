{"sha": "960f80d1ee2d882f29886db66a3edf4c824eeaf0", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6OTYwZjgwZDFlZTJkODgyZjI5ODg2ZGI2NmEzZWRmNGM4MjRlZWFmMA==", "commit": {"author": {"name": "Richard Guenther", "email": "rguenther@suse.de", "date": "2006-06-08T08:49:19Z"}, "committer": {"name": "Richard Biener", "email": "rguenth@gcc.gnu.org", "date": "2006-06-08T08:49:19Z"}, "message": "re PR middle-end/27116 (Incorrect integer division (wrong sign).)\n\n2006-06-08  Richard Guenther  <rguenther@suse.de>\n\n\tPR middle-end/27116\n\t* fold-const.c (negate_expr_p): We can negate BIT_NOT_EXPR\n\tonly, if overflow is defined and not trapping.\n\t(negate_expr): Likewise.\n\n\t* gcc.dg/torture/pr27116.c: New testcase.\n\t* gcc.dg/pr15785-1.c: Remove test for invalid transformation.\n\nFrom-SVN: r114483", "tree": {"sha": "4bf8760f5ecfc126786bc6da8fd99de0bb85f219", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/4bf8760f5ecfc126786bc6da8fd99de0bb85f219"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/960f80d1ee2d882f29886db66a3edf4c824eeaf0", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/960f80d1ee2d882f29886db66a3edf4c824eeaf0", "html_url": "https://github.com/Rust-GCC/gccrs/commit/960f80d1ee2d882f29886db66a3edf4c824eeaf0", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/960f80d1ee2d882f29886db66a3edf4c824eeaf0/comments", "author": {"login": "rguenth", "id": 2046526, "node_id": "MDQ6VXNlcjIwNDY1MjY=", "avatar_url": "https://avatars.githubusercontent.com/u/2046526?v=4", "gravatar_id": "", "url": "https://api.github.com/users/rguenth", "html_url": "https://github.com/rguenth", "followers_url": "https://api.github.com/users/rguenth/followers", "following_url": "https://api.github.com/users/rguenth/following{/other_user}", "gists_url": "https://api.github.com/users/rguenth/gists{/gist_id}", "starred_url": "https://api.github.com/users/rguenth/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/rguenth/subscriptions", "organizations_url": "https://api.github.com/users/rguenth/orgs", "repos_url": "https://api.github.com/users/rguenth/repos", "events_url": "https://api.github.com/users/rguenth/events{/privacy}", "received_events_url": "https://api.github.com/users/rguenth/received_events", "type": "User", "site_admin": false}, "committer": null, "parents": [{"sha": "8e08deebfccb960a2bdbd9c7e30a9e3c4633e12d", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/8e08deebfccb960a2bdbd9c7e30a9e3c4633e12d", "html_url": "https://github.com/Rust-GCC/gccrs/commit/8e08deebfccb960a2bdbd9c7e30a9e3c4633e12d"}], "stats": {"total": 42, "additions": 34, "deletions": 8}, "files": [{"sha": "12bd4194eb926a3956cf72653f2c469d1bf045f1", "filename": "gcc/ChangeLog", "status": "modified", "additions": 7, "deletions": 0, "changes": 7, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/960f80d1ee2d882f29886db66a3edf4c824eeaf0/gcc%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/960f80d1ee2d882f29886db66a3edf4c824eeaf0/gcc%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2FChangeLog?ref=960f80d1ee2d882f29886db66a3edf4c824eeaf0", "patch": "@@ -1,3 +1,10 @@\n+2006-06-08  Richard Guenther  <rguenther@suse.de>\n+\n+\tPR middle-end/27116\n+\t* fold-const.c (negate_expr_p): We can negate BIT_NOT_EXPR\n+\tonly, if overflow is defined and not trapping.\n+\t(negate_expr): Likewise.\n+\n 2006-06-07  Zdenek Dvorak <dvorakz@suse.cz>\n \n \tPR tree-optimization/27872"}, {"sha": "3e9ccbe4f66bc893699f63ecf9a260a5003c7647", "filename": "gcc/fold-const.c", "status": "modified", "additions": 6, "deletions": 2, "changes": 8, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/960f80d1ee2d882f29886db66a3edf4c824eeaf0/gcc%2Ffold-const.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/960f80d1ee2d882f29886db66a3edf4c824eeaf0/gcc%2Ffold-const.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ffold-const.c?ref=960f80d1ee2d882f29886db66a3edf4c824eeaf0", "patch": "@@ -945,7 +945,9 @@ negate_expr_p (tree t)\n       /* Check that -CST will not overflow type.  */\n       return may_negate_without_overflow_p (t);\n     case BIT_NOT_EXPR:\n-       return INTEGRAL_TYPE_P (type);\n+       return INTEGRAL_TYPE_P (type)\n+       \t      && (TYPE_UNSIGNED (type)\n+\t      \t  || (flag_wrapv && !flag_trapv));\n \n     case REAL_CST:\n     case NEGATE_EXPR:\n@@ -1047,7 +1049,9 @@ negate_expr (tree t)\n     {\n     /* Convert - (~A) to A + 1.  */\n     case BIT_NOT_EXPR:\n-      if (INTEGRAL_TYPE_P (type))\n+      if (INTEGRAL_TYPE_P (type)\n+      \t  && (TYPE_UNSIGNED (type)\n+\t      || (flag_wrapv && !flag_trapv)))\n         return fold_build2 (PLUS_EXPR, type, TREE_OPERAND (t, 0),\n                             build_int_cst (type, 1));\n       break;"}, {"sha": "cfeeaeb83e2e5f3e9ee3569b00ef0ae09cd861a7", "filename": "gcc/testsuite/ChangeLog", "status": "modified", "additions": 6, "deletions": 0, "changes": 6, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/960f80d1ee2d882f29886db66a3edf4c824eeaf0/gcc%2Ftestsuite%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/960f80d1ee2d882f29886db66a3edf4c824eeaf0/gcc%2Ftestsuite%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2FChangeLog?ref=960f80d1ee2d882f29886db66a3edf4c824eeaf0", "patch": "@@ -1,3 +1,9 @@\n+2006-06-08  Richard Guenther  <rguenther@suse.de>\n+\n+\tPR middle-end/27116\n+\t* gcc.dg/torture/pr27116.c: New testcase.\n+\t* gcc.dg/pr15785-1.c: Remove test for invalid transformation.\n+\n 2006-06-07  Zdenek Dvorak <dvorakz@suse.cz>\n \n \tPR rtl-optimization/26449"}, {"sha": "5e79ec50bbb95c03d2be1e434c91074d719bf624", "filename": "gcc/testsuite/gcc.dg/pr15785-1.c", "status": "modified", "additions": 0, "deletions": 6, "changes": 6, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/960f80d1ee2d882f29886db66a3edf4c824eeaf0/gcc%2Ftestsuite%2Fgcc.dg%2Fpr15785-1.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/960f80d1ee2d882f29886db66a3edf4c824eeaf0/gcc%2Ftestsuite%2Fgcc.dg%2Fpr15785-1.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgcc.dg%2Fpr15785-1.c?ref=960f80d1ee2d882f29886db66a3edf4c824eeaf0", "patch": "@@ -11,11 +11,6 @@ void b (int x) {\n \t\tlink_error ();\n }\n \n-void c (int x) {\n-\tif (!(- (~x) - x))\n-\t\tlink_error ();\n-}\n-\n void d (int x) {\n \tif (!(~ (-x) - x))\n \t\tlink_error ();\n@@ -34,7 +29,6 @@ void f (int x) {\n int main (int argc, char *argv[]) {\n \ta(argc);\n \tb(argc);\n-\tc(argc);\n \td(argc);\n \te(argc);\n \tf(argc);"}, {"sha": "70eeb1a8698e88a5680865fe775acb1c92952d0b", "filename": "gcc/testsuite/gcc.dg/torture/pr27116.c", "status": "added", "additions": 15, "deletions": 0, "changes": 15, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/960f80d1ee2d882f29886db66a3edf4c824eeaf0/gcc%2Ftestsuite%2Fgcc.dg%2Ftorture%2Fpr27116.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/960f80d1ee2d882f29886db66a3edf4c824eeaf0/gcc%2Ftestsuite%2Fgcc.dg%2Ftorture%2Fpr27116.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgcc.dg%2Ftorture%2Fpr27116.c?ref=960f80d1ee2d882f29886db66a3edf4c824eeaf0", "patch": "@@ -0,0 +1,15 @@\n+/* { dg-do run } */\n+\n+extern void abort(void);\n+\n+int f(int a, int b)\n+{\n+  return (-1 - a) / (-b);\n+}\n+\n+int main()\n+{\n+  if (f(__INT_MAX__, 2) != __INT_MAX__/2 + 1)\n+    abort ();\n+  return 0;\n+}"}]}