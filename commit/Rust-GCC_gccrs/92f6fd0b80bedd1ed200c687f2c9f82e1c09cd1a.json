{"sha": "92f6fd0b80bedd1ed200c687f2c9f82e1c09cd1a", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6OTJmNmZkMGI4MGJlZGQxZWQyMDBjNjg3ZjJjOWY4MmUxYzA5Y2QxYQ==", "commit": {"author": {"name": "Joseph Myers", "email": "joseph@codesourcery.com", "date": "2009-04-25T18:55:50Z"}, "committer": {"name": "Joseph Myers", "email": "jsm28@gcc.gnu.org", "date": "2009-04-25T18:55:50Z"}, "message": "re PR c/39564 (variably modified function return types not always diagnosed)\n\n\tPR c/39564\n\t* c-decl.c (grokdeclarator): Diagnose declarations of functions\n\twith variably modified return type and no storage class\n\tspecifiers, except for the case of nested functions.  Distinguish\n\textern declarations of functions with variably modified return\n\ttypes from those of objects with variably modified types.\n\ntestsuite:\n\t* gcc.dg/vla-19.c: New test.\n\nFrom-SVN: r146778", "tree": {"sha": "37e3ee9a7eeffd28c6d57a7ad6c934131c358b1b", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/37e3ee9a7eeffd28c6d57a7ad6c934131c358b1b"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/92f6fd0b80bedd1ed200c687f2c9f82e1c09cd1a", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/92f6fd0b80bedd1ed200c687f2c9f82e1c09cd1a", "html_url": "https://github.com/Rust-GCC/gccrs/commit/92f6fd0b80bedd1ed200c687f2c9f82e1c09cd1a", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/92f6fd0b80bedd1ed200c687f2c9f82e1c09cd1a/comments", "author": {"login": "jsm28", "id": 10537793, "node_id": "MDQ6VXNlcjEwNTM3Nzkz", "avatar_url": "https://avatars.githubusercontent.com/u/10537793?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jsm28", "html_url": "https://github.com/jsm28", "followers_url": "https://api.github.com/users/jsm28/followers", "following_url": "https://api.github.com/users/jsm28/following{/other_user}", "gists_url": "https://api.github.com/users/jsm28/gists{/gist_id}", "starred_url": "https://api.github.com/users/jsm28/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jsm28/subscriptions", "organizations_url": "https://api.github.com/users/jsm28/orgs", "repos_url": "https://api.github.com/users/jsm28/repos", "events_url": "https://api.github.com/users/jsm28/events{/privacy}", "received_events_url": "https://api.github.com/users/jsm28/received_events", "type": "User", "site_admin": false}, "committer": {"login": "jsm28", "id": 10537793, "node_id": "MDQ6VXNlcjEwNTM3Nzkz", "avatar_url": "https://avatars.githubusercontent.com/u/10537793?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jsm28", "html_url": "https://github.com/jsm28", "followers_url": "https://api.github.com/users/jsm28/followers", "following_url": "https://api.github.com/users/jsm28/following{/other_user}", "gists_url": "https://api.github.com/users/jsm28/gists{/gist_id}", "starred_url": "https://api.github.com/users/jsm28/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jsm28/subscriptions", "organizations_url": "https://api.github.com/users/jsm28/orgs", "repos_url": "https://api.github.com/users/jsm28/repos", "events_url": "https://api.github.com/users/jsm28/events{/privacy}", "received_events_url": "https://api.github.com/users/jsm28/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "f88d07724fad4b84d8e73ff30b6f3c16cd832ef3", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/f88d07724fad4b84d8e73ff30b6f3c16cd832ef3", "html_url": "https://github.com/Rust-GCC/gccrs/commit/f88d07724fad4b84d8e73ff30b6f3c16cd832ef3"}], "stats": {"total": 56, "additions": 54, "deletions": 2}, "files": [{"sha": "c3a2d00dab76e469d4e674fbe173cb9cfa8e430c", "filename": "gcc/ChangeLog", "status": "modified", "additions": 9, "deletions": 0, "changes": 9, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/92f6fd0b80bedd1ed200c687f2c9f82e1c09cd1a/gcc%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/92f6fd0b80bedd1ed200c687f2c9f82e1c09cd1a/gcc%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2FChangeLog?ref=92f6fd0b80bedd1ed200c687f2c9f82e1c09cd1a", "patch": "@@ -1,3 +1,12 @@\n+2009-04-25  Joseph Myers  <joseph@codesourcery.com>\n+\n+\tPR c/39564\n+\t* c-decl.c (grokdeclarator): Diagnose declarations of functions\n+\twith variably modified return type and no storage class\n+\tspecifiers, except for the case of nested functions.  Distinguish\n+\textern declarations of functions with variably modified return\n+\ttypes from those of objects with variably modified types.\n+\n 2009-04-25  Jan Hubicka  <jh@suse.cz>\n \n \t* tree.c (list_equal_p): New function."}, {"sha": "9693a342a8f6602c6f9da2a5d34cc8a2f1099514", "filename": "gcc/c-decl.c", "status": "modified", "additions": 8, "deletions": 2, "changes": 10, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/92f6fd0b80bedd1ed200c687f2c9f82e1c09cd1a/gcc%2Fc-decl.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/92f6fd0b80bedd1ed200c687f2c9f82e1c09cd1a/gcc%2Fc-decl.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fc-decl.c?ref=92f6fd0b80bedd1ed200c687f2c9f82e1c09cd1a", "patch": "@@ -5012,11 +5012,17 @@ grokdeclarator (const struct c_declarator *declarator,\n \t  DECL_TLS_MODEL (decl) = decl_default_tls_model (decl);\n       }\n \n-    if (storage_class == csc_extern\n+    if ((storage_class == csc_extern\n+\t || (storage_class == csc_none\n+\t     && TREE_CODE (type) == FUNCTION_TYPE\n+\t     && !funcdef_flag))\n \t&& variably_modified_type_p (type, NULL_TREE))\n       {\n \t/* C99 6.7.5.2p2 */\n-\terror (\"object with variably modified type must have no linkage\");\n+\tif (TREE_CODE (type) == FUNCTION_TYPE)\n+\t  error (\"non-nested function with variably modified type\");\n+\telse\n+\t  error (\"object with variably modified type must have no linkage\");\n       }\n \n     /* Record `register' declaration for warnings on &"}, {"sha": "c9cfd92fa3a1230a01f5259366c8f4c732291ec2", "filename": "gcc/testsuite/ChangeLog", "status": "modified", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/92f6fd0b80bedd1ed200c687f2c9f82e1c09cd1a/gcc%2Ftestsuite%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/92f6fd0b80bedd1ed200c687f2c9f82e1c09cd1a/gcc%2Ftestsuite%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2FChangeLog?ref=92f6fd0b80bedd1ed200c687f2c9f82e1c09cd1a", "patch": "@@ -1,3 +1,8 @@\n+2009-04-25  Joseph Myers  <joseph@codesourcery.com>\n+\n+\tPR c/39564\n+\t* gcc.dg/vla-19.c: New test.\n+\n 2009-04-25  Joseph Myers  <joseph@codesourcery.com>\n \n \tPR preprocessor/39559"}, {"sha": "83093c9291a400bc2250a598aa46e4ac56383fae", "filename": "gcc/testsuite/gcc.dg/vla-19.c", "status": "added", "additions": 32, "deletions": 0, "changes": 32, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/92f6fd0b80bedd1ed200c687f2c9f82e1c09cd1a/gcc%2Ftestsuite%2Fgcc.dg%2Fvla-19.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/92f6fd0b80bedd1ed200c687f2c9f82e1c09cd1a/gcc%2Ftestsuite%2Fgcc.dg%2Fvla-19.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgcc.dg%2Fvla-19.c?ref=92f6fd0b80bedd1ed200c687f2c9f82e1c09cd1a", "patch": "@@ -0,0 +1,32 @@\n+/* Test diagnostics for variably modified function return types.  PR\n+   39564.  */\n+/* { dg-do compile } */\n+/* { dg-options \"-std=c99\" } */\n+\n+int a;\n+\n+void\n+f1 (void)\n+{\n+  typedef int T[a];\n+  extern T *g1 (void); /* { dg-error \"non-nested function with variably modified type\" } */\n+}\n+\n+void\n+f2 (void)\n+{\n+  extern int (*g2 (void))[a]; /* { dg-error \"non-nested function with variably modified type\" } */\n+}\n+\n+void\n+f3 (void)\n+{\n+  typedef int T[a];\n+  T *g3 (void); /* { dg-error \"non-nested function with variably modified type\" } */\n+}\n+\n+void\n+f4 (void)\n+{\n+  int (*g4 (void))[a]; /* { dg-error \"non-nested function with variably modified type\" } */\n+}"}]}