{"sha": "ad117173a0d8a5412bc2b9fb99e2c9b1cb4036af", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6YWQxMTcxNzNhMGQ4YTU0MTJiYzJiOWZiOTllMmM5YjFjYjQwMzZhZg==", "commit": {"author": {"name": "Jim Wilson", "email": "jimw@sifive.com", "date": "2018-09-25T22:52:38Z"}, "committer": {"name": "Jim Wilson", "email": "wilson@gcc.gnu.org", "date": "2018-09-25T22:52:38Z"}, "message": "RISC-V: Fix weak symbols with medany and explicit relocs.\n\n\tgcc/\n\t* config/riscv/riscv.c (riscv_split_symbol): Mark auipc label as weak\n\twhen target symbol is weak.\n\n\tgcc/testsuite/\n\t* gcc.target/riscv/weak-1.c: New.\n\nFrom-SVN: r264586", "tree": {"sha": "dc6bd6677ec3a060c251232a8106b1431063ae65", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/dc6bd6677ec3a060c251232a8106b1431063ae65"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/ad117173a0d8a5412bc2b9fb99e2c9b1cb4036af", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/ad117173a0d8a5412bc2b9fb99e2c9b1cb4036af", "html_url": "https://github.com/Rust-GCC/gccrs/commit/ad117173a0d8a5412bc2b9fb99e2c9b1cb4036af", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/ad117173a0d8a5412bc2b9fb99e2c9b1cb4036af/comments", "author": null, "committer": null, "parents": [{"sha": "c7813484bc9fe2c578d7538d0a9e286bf2e64599", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/c7813484bc9fe2c578d7538d0a9e286bf2e64599", "html_url": "https://github.com/Rust-GCC/gccrs/commit/c7813484bc9fe2c578d7538d0a9e286bf2e64599"}], "stats": {"total": 28, "additions": 28, "deletions": 0}, "files": [{"sha": "d43e6d682ccef6e30ece8a83388791230882a771", "filename": "gcc/ChangeLog", "status": "modified", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/ad117173a0d8a5412bc2b9fb99e2c9b1cb4036af/gcc%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/ad117173a0d8a5412bc2b9fb99e2c9b1cb4036af/gcc%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2FChangeLog?ref=ad117173a0d8a5412bc2b9fb99e2c9b1cb4036af", "patch": "@@ -1,3 +1,8 @@\n+2018-09-25  Jim Wilson  <jimw@sifive.com>\n+\n+\t* config/riscv/riscv.c (riscv_split_symbol): Mark auipc label as weak\n+\twhen target symbol is weak.\n+\n 2018-09-25  Bernd Edlinger  <bernd.edlinger@hotmail.de>\n \n \tPR c/87387"}, {"sha": "381a203da9be390d25ef8738f556903d05251caa", "filename": "gcc/config/riscv/riscv.c", "status": "modified", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/ad117173a0d8a5412bc2b9fb99e2c9b1cb4036af/gcc%2Fconfig%2Friscv%2Friscv.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/ad117173a0d8a5412bc2b9fb99e2c9b1cb4036af/gcc%2Fconfig%2Friscv%2Friscv.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fconfig%2Friscv%2Friscv.c?ref=ad117173a0d8a5412bc2b9fb99e2c9b1cb4036af", "patch": "@@ -1103,6 +1103,11 @@ riscv_split_symbol (rtx temp, rtx addr, machine_mode mode, rtx *low_out)\n \n \t  label = gen_rtx_SYMBOL_REF (Pmode, ggc_strdup (buf));\n \t  SYMBOL_REF_FLAGS (label) |= SYMBOL_FLAG_LOCAL;\n+\t  /* ??? Ugly hack to make weak symbols work.  May need to change the\n+\t     RTL for the auipc and/or low patterns to get a better fix for\n+\t     this.  */\n+\t  if (! nonzero_address_p (addr))\n+\t    SYMBOL_REF_WEAK (label) = 1;\n \n \t  if (temp == NULL)\n \t    temp = gen_reg_rtx (Pmode);"}, {"sha": "f690e62a4456f9fe8577e78b6f2e04a95aa684c6", "filename": "gcc/testsuite/ChangeLog", "status": "modified", "additions": 4, "deletions": 0, "changes": 4, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/ad117173a0d8a5412bc2b9fb99e2c9b1cb4036af/gcc%2Ftestsuite%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/ad117173a0d8a5412bc2b9fb99e2c9b1cb4036af/gcc%2Ftestsuite%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2FChangeLog?ref=ad117173a0d8a5412bc2b9fb99e2c9b1cb4036af", "patch": "@@ -1,3 +1,7 @@\n+2018-09-25  Jim Wilson  <jimw@sifive.com>\n+\n+\t* gcc.target/riscv/weak-1.c: New.\n+\n 2018-09-25  Jeff Law  <law@redhat.com>\n \n \t* gcc.dg/warn-stpcpy-no-nul.c: Drop unnecessary xfails."}, {"sha": "0f20501f7c532172df1b12308e37ae341554ac61", "filename": "gcc/testsuite/gcc.target/riscv/weak-1.c", "status": "added", "additions": 14, "deletions": 0, "changes": 14, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/ad117173a0d8a5412bc2b9fb99e2c9b1cb4036af/gcc%2Ftestsuite%2Fgcc.target%2Friscv%2Fweak-1.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/ad117173a0d8a5412bc2b9fb99e2c9b1cb4036af/gcc%2Ftestsuite%2Fgcc.target%2Friscv%2Fweak-1.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgcc.target%2Friscv%2Fweak-1.c?ref=ad117173a0d8a5412bc2b9fb99e2c9b1cb4036af", "patch": "@@ -0,0 +1,14 @@\n+/* { dg-do compile } */\n+/* { dg-options \"-mcmodel=medany -mexplicit-relocs -O\" } */\n+\n+/* Verify that the branch doesn't get optimized away.  */\n+extern int weak_func(void) __attribute__ ((weak));\n+\n+int\n+sub (void)\n+{\n+  if (weak_func)\n+    return weak_func ();\n+  return 0;\n+}\n+/* { dg-final { scan-assembler \"b\\(ne|eq\\)\" } } */"}]}