{"sha": "47e15513c9e581ef04ad25fb0d561a45d345edd1", "node_id": "C_kwDOANBUbNoAKDQ3ZTE1NTEzYzllNTgxZWYwNGFkMjVmYjBkNTYxYTQ1ZDM0NWVkZDE", "commit": {"author": {"name": "Richard Biener", "email": "rguenther@suse.de", "date": "2022-09-01T11:28:08Z"}, "committer": {"name": "Richard Biener", "email": "rguenther@suse.de", "date": "2022-09-01T13:06:28Z"}, "message": "Remove cycle checking from compute_control_dep_chain\n\nNow that we have DFS_BACK_EDGE marks we can simply avoid walking\nthose instead of repeatedly looking for a cycle on the current chain.\n\n\t* gimple-predicate-analysis.cc (compute_control_dep_chain):\n\tRemove cycle detection, instead avoid walking backedges.", "tree": {"sha": "d8af15a8e1c5afdc3cf7fd873e1874fcfab42d57", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/d8af15a8e1c5afdc3cf7fd873e1874fcfab42d57"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/47e15513c9e581ef04ad25fb0d561a45d345edd1", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/47e15513c9e581ef04ad25fb0d561a45d345edd1", "html_url": "https://github.com/Rust-GCC/gccrs/commit/47e15513c9e581ef04ad25fb0d561a45d345edd1", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/47e15513c9e581ef04ad25fb0d561a45d345edd1/comments", "author": {"login": "rguenth", "id": 2046526, "node_id": "MDQ6VXNlcjIwNDY1MjY=", "avatar_url": "https://avatars.githubusercontent.com/u/2046526?v=4", "gravatar_id": "", "url": "https://api.github.com/users/rguenth", "html_url": "https://github.com/rguenth", "followers_url": "https://api.github.com/users/rguenth/followers", "following_url": "https://api.github.com/users/rguenth/following{/other_user}", "gists_url": "https://api.github.com/users/rguenth/gists{/gist_id}", "starred_url": "https://api.github.com/users/rguenth/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/rguenth/subscriptions", "organizations_url": "https://api.github.com/users/rguenth/orgs", "repos_url": "https://api.github.com/users/rguenth/repos", "events_url": "https://api.github.com/users/rguenth/events{/privacy}", "received_events_url": "https://api.github.com/users/rguenth/received_events", "type": "User", "site_admin": false}, "committer": {"login": "rguenth", "id": 2046526, "node_id": "MDQ6VXNlcjIwNDY1MjY=", "avatar_url": "https://avatars.githubusercontent.com/u/2046526?v=4", "gravatar_id": "", "url": "https://api.github.com/users/rguenth", "html_url": "https://github.com/rguenth", "followers_url": "https://api.github.com/users/rguenth/followers", "following_url": "https://api.github.com/users/rguenth/following{/other_user}", "gists_url": "https://api.github.com/users/rguenth/gists{/gist_id}", "starred_url": "https://api.github.com/users/rguenth/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/rguenth/subscriptions", "organizations_url": "https://api.github.com/users/rguenth/orgs", "repos_url": "https://api.github.com/users/rguenth/repos", "events_url": "https://api.github.com/users/rguenth/events{/privacy}", "received_events_url": "https://api.github.com/users/rguenth/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "e75398ac9f06d67cffe495a150e2b27064f3971d", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/e75398ac9f06d67cffe495a150e2b27064f3971d", "html_url": "https://github.com/Rust-GCC/gccrs/commit/e75398ac9f06d67cffe495a150e2b27064f3971d"}], "stats": {"total": 20, "additions": 7, "deletions": 13}, "files": [{"sha": "a754ff0a029dd0761e8dad8a8ce8add3fbfd338f", "filename": "gcc/gimple-predicate-analysis.cc", "status": "modified", "additions": 7, "deletions": 13, "changes": 20, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/47e15513c9e581ef04ad25fb0d561a45d345edd1/gcc%2Fgimple-predicate-analysis.cc", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/47e15513c9e581ef04ad25fb0d561a45d345edd1/gcc%2Fgimple-predicate-analysis.cc", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fgimple-predicate-analysis.cc?ref=47e15513c9e581ef04ad25fb0d561a45d345edd1", "patch": "@@ -1035,18 +1035,6 @@ compute_control_dep_chain (basic_block dom_bb, const_basic_block dep_bb,\n \tfprintf (dump_file, \"chain length exceeds 5: %u\\n\", cur_chain_len);\n     }\n \n-  for (unsigned i = 0; i < cur_chain_len; i++)\n-    {\n-      edge e = cur_cd_chain[i];\n-      /* Cycle detected.  */\n-      if (e->src == dom_bb)\n-\t{\n-\t  if (dump_file)\n-\t    fprintf (dump_file, \"cycle detected\\n\");\n-\t  return false;\n-\t}\n-    }\n-\n   if (DEBUG_PREDICATE_ANALYZER && dump_file)\n     fprintf (dump_file,\n \t     \"%*s%s (dom_bb = %u, dep_bb = %u, cd_chains = { %s }, ...)\\n\",\n@@ -1061,7 +1049,7 @@ compute_control_dep_chain (basic_block dom_bb, const_basic_block dep_bb,\n   FOR_EACH_EDGE (e, ei, dom_bb->succs)\n     {\n       int post_dom_check = 0;\n-      if (e->flags & (EDGE_FAKE | EDGE_ABNORMAL))\n+      if (e->flags & (EDGE_FAKE | EDGE_ABNORMAL | EDGE_DFS_BACK))\n \tcontinue;\n \n       basic_block cd_bb = e->dest;\n@@ -1110,6 +1098,12 @@ compute_control_dep_chain (basic_block dom_bb, const_basic_block dep_bb,\n \t      break;\n \t    }\n \n+\t  /* The post-dominator walk will reach a backedge only\n+\t     from a forwarder, otherwise it should choose to exit\n+\t     the SCC.  */\n+\t  if (single_succ_p (cd_bb)\n+\t      && single_succ_edge (cd_bb)->flags & EDGE_DFS_BACK)\n+\t    break;\n \t  cd_bb = get_immediate_dominator (CDI_POST_DOMINATORS, cd_bb);\n \t  post_dom_check++;\n \t  if (cd_bb == EXIT_BLOCK_PTR_FOR_FN (cfun)"}]}