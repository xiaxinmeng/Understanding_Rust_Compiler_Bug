{"sha": "0bf08bfe351ec29e2439180cbb1f587de9333623", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6MGJmMDhiZmUzNTFlYzI5ZTI0MzkxODBjYmIxZjU4N2RlOTMzMzYyMw==", "commit": {"author": {"name": "Joel Brobecker", "email": "brobecker@gnat.com", "date": "2001-10-26T16:09:47Z"}, "committer": {"name": "Geert Bosch", "email": "bosch@gcc.gnu.org", "date": "2001-10-26T16:09:47Z"}, "message": "5zosinte.ads (null_pthread): new constant.\n\n\t* 5zosinte.ads (null_pthread): new constant.\n\n\t* 5ztaprop.adb:\n\t(Initialize_TCB): Initialize thread ID to null, to be able to verify\n\t later that this field has been set.\n\t(Finalize_TCB): ditto.\n\t(Suspend_Task): Verify that the thread ID is not null before using it.\n\t(Resume_Task): ditto.\n\n\t* s-tasdeb.adb:\n\t(Resume_All_Tasks): Lock the tasks list before using it.\n\t(Suspend_All_Tasks): ditto.\n\nFrom-SVN: r46548", "tree": {"sha": "b294124ef4da82ad9b0a331f660f48f02e52d779", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/b294124ef4da82ad9b0a331f660f48f02e52d779"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/0bf08bfe351ec29e2439180cbb1f587de9333623", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/0bf08bfe351ec29e2439180cbb1f587de9333623", "html_url": "https://github.com/Rust-GCC/gccrs/commit/0bf08bfe351ec29e2439180cbb1f587de9333623", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/0bf08bfe351ec29e2439180cbb1f587de9333623/comments", "author": null, "committer": null, "parents": [{"sha": "7a3a8c068bfe942e28089b7a07a32690edad14ea", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/7a3a8c068bfe942e28089b7a07a32690edad14ea", "html_url": "https://github.com/Rust-GCC/gccrs/commit/7a3a8c068bfe942e28089b7a07a32690edad14ea"}], "stats": {"total": 43, "additions": 38, "deletions": 5}, "files": [{"sha": "5eddd7296fadd856803e6ca3cb31d6f925d40dde", "filename": "gcc/ada/5zosinte.ads", "status": "modified", "additions": 5, "deletions": 1, "changes": 6, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/0bf08bfe351ec29e2439180cbb1f587de9333623/gcc%2Fada%2F5zosinte.ads", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/0bf08bfe351ec29e2439180cbb1f587de9333623/gcc%2Fada%2F5zosinte.ads", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fada%2F5zosinte.ads?ref=0bf08bfe351ec29e2439180cbb1f587de9333623", "patch": "@@ -6,7 +6,7 @@\n --                                                                          --\n --                                   S p e c                                --\n --                                                                          --\n---                             $Revision: 1.16 $\n+--                             $Revision$\n --                                                                          --\n --           Copyright (C) 1997-2001 Free Software Foundation, Inc.         --\n --                                                                          --\n@@ -218,6 +218,8 @@ package System.OS_Interface is\n    type pthread_t           is private;\n    subtype Thread_Id        is pthread_t;\n \n+   null_pthread : constant pthread_t;\n+\n    type pthread_mutex_t     is limited private;\n    type pthread_cond_t      is limited private;\n    type pthread_attr_t      is limited private;\n@@ -542,6 +544,8 @@ private\n \n    type pthread_t is new long;\n \n+   null_pthread : constant pthread_t := 0;\n+\n    type pthread_key_t is new int;\n \n    --  These are to store the pthread_keys that are created with"}, {"sha": "0d9538c3b0fb2f6b388562f05cfafab53b814952", "filename": "gcc/ada/5ztaprop.adb", "status": "modified", "additions": 11, "deletions": 3, "changes": 14, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/0bf08bfe351ec29e2439180cbb1f587de9333623/gcc%2Fada%2F5ztaprop.adb", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/0bf08bfe351ec29e2439180cbb1f587de9333623/gcc%2Fada%2F5ztaprop.adb", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fada%2F5ztaprop.adb?ref=0bf08bfe351ec29e2439180cbb1f587de9333623", "patch": "@@ -6,7 +6,7 @@\n --                                                                          --\n --                                  B o d y                                 --\n --                                                                          --\n---                             $Revision: 1.41 $\n+--                             $Revision$\n --                                                                          --\n --             Copyright (C) 1991-2001 Florida State University             --\n --                                                                          --\n@@ -728,6 +728,8 @@ package body System.Task_Primitives.Operations is\n       Cond_Attr : aliased pthread_condattr_t;\n \n    begin\n+      Self_ID.Common.LL.Thread := null_pthread;\n+\n       Result := pthread_mutexattr_init (Mutex_Attr'Access);\n       pragma Assert (Result = 0 or else Result = ENOMEM);\n \n@@ -898,6 +900,8 @@ package body System.Task_Primitives.Operations is\n         Unchecked_Deallocation (Ada_Task_Control_Block, Task_ID);\n \n    begin\n+      T.Common.LL.Thread := null_pthread;\n+\n       Result := pthread_mutex_destroy (T.Common.LL.L'Access);\n       pragma Assert (Result = 0);\n \n@@ -989,7 +993,9 @@ package body System.Task_Primitives.Operations is\n      (T           : ST.Task_ID;\n       Thread_Self : Thread_Id) return Boolean is\n    begin\n-      if T.Common.LL.Thread /= Thread_Self then\n+      if T.Common.LL.Thread /= null_pthread\n+        and then T.Common.LL.Thread /= Thread_Self\n+      then\n          return taskSuspend (T.Common.LL.Thread) = 0;\n       else\n          return True;\n@@ -1004,7 +1010,9 @@ package body System.Task_Primitives.Operations is\n      (T           : ST.Task_ID;\n       Thread_Self : Thread_Id) return Boolean is\n    begin\n-      if T.Common.LL.Thread /= Thread_Self then\n+      if T.Common.LL.Thread /= null_pthread\n+        and then T.Common.LL.Thread /= Thread_Self\n+      then\n          return taskResume (T.Common.LL.Thread) = 0;\n       else\n          return True;"}, {"sha": "952e38d3abeaa7a19f96a61dbafa75c5fe45c3a1", "filename": "gcc/ada/ChangeLog", "status": "modified", "additions": 15, "deletions": 0, "changes": 15, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/0bf08bfe351ec29e2439180cbb1f587de9333623/gcc%2Fada%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/0bf08bfe351ec29e2439180cbb1f587de9333623/gcc%2Fada%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fada%2FChangeLog?ref=0bf08bfe351ec29e2439180cbb1f587de9333623", "patch": "@@ -1,3 +1,18 @@\n+2001-10-26  Joel Brobecker <brobecke@gnat.com>\n+\n+\t* 5zosinte.ads (null_pthread): new constant.\n+\t\n+\t* 5ztaprop.adb:\n+\t(Initialize_TCB): Initialize thread ID to null, to be able to verify\n+\t later that this field has been set.\n+\t(Finalize_TCB): ditto.\n+\t(Suspend_Task): Verify that the thread ID is not null before using it.\n+\t(Resume_Task): ditto.\n+\t\n+\t* s-tasdeb.adb:\n+\t(Resume_All_Tasks): Lock the tasks list before using it.\n+\t(Suspend_All_Tasks): ditto.\n+\n 2001-10-26  Richard Kenner <kenner@gnat.com>\n \n \t* decl.c (gnat_to_gnu_entity, case E_General_Access_Type): "}, {"sha": "4ee2fd45a801af4b7fc459c2c5afb04241347454", "filename": "gcc/ada/s-tasdeb.adb", "status": "modified", "additions": 7, "deletions": 1, "changes": 8, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/0bf08bfe351ec29e2439180cbb1f587de9333623/gcc%2Fada%2Fs-tasdeb.adb", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/0bf08bfe351ec29e2439180cbb1f587de9333623/gcc%2Fada%2Fs-tasdeb.adb", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fada%2Fs-tasdeb.adb?ref=0bf08bfe351ec29e2439180cbb1f587de9333623", "patch": "@@ -6,7 +6,7 @@\n --                                                                          --\n --                                  B o d y                                 --\n --                                                                          --\n---                             $Revision: 1.23 $\n+--                             $Revision$\n --                                                                          --\n --          Copyright (C) 1997-2001 Free Software Foundation, Inc.          --\n --                                                                          --\n@@ -499,12 +499,15 @@ package body System.Tasking.Debug is\n       R : Boolean;\n \n    begin\n+      STPO.Lock_All_Tasks_List;\n       C := All_Tasks_List;\n \n       while C /= null loop\n          R := STPO.Resume_Task (C, Thread_Self);\n          C := C.Common.All_Tasks_Link;\n       end loop;\n+\n+      STPO.Unlock_All_Tasks_List;\n    end Resume_All_Tasks;\n \n    ----------\n@@ -577,12 +580,15 @@ package body System.Tasking.Debug is\n       R : Boolean;\n \n    begin\n+      STPO.Lock_All_Tasks_List;\n       C := All_Tasks_List;\n \n       while C /= null loop\n          R := STPO.Suspend_Task (C, Thread_Self);\n          C := C.Common.All_Tasks_Link;\n       end loop;\n+\n+      STPO.Unlock_All_Tasks_List;\n    end Suspend_All_Tasks;\n \n    ------------------------"}]}