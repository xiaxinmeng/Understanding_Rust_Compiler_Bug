{"sha": "8c8952918b75f4fa6adbbe44cd641d5fd0bb55e3", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6OGM4OTUyOTE4Yjc1ZjRmYTZhZGJiZTQ0Y2Q2NDFkNWZkMGJiNTVlMw==", "commit": {"author": {"name": "Tejas Belagod", "email": "tejas.belagod@arm.com", "date": "2013-12-05T17:24:52Z"}, "committer": {"name": "Tejas Belagod", "email": "belagod@gcc.gnu.org", "date": "2013-12-05T17:24:52Z"}, "message": "Eliminate redundant vec_select moves.\n\ngcc/\n        * rtlanal.c (set_noop_p): Return nonzero in case of redundant vec_select for\n        overlapping register lanes.\n\ntestsuite/\n        * config/gcc.dg/vect/vect-nop-move.c: New.\n\nFrom-SVN: r205712", "tree": {"sha": "9724f5ffff7a15227f05b12519028d421225dfaf", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/9724f5ffff7a15227f05b12519028d421225dfaf"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/8c8952918b75f4fa6adbbe44cd641d5fd0bb55e3", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/8c8952918b75f4fa6adbbe44cd641d5fd0bb55e3", "html_url": "https://github.com/Rust-GCC/gccrs/commit/8c8952918b75f4fa6adbbe44cd641d5fd0bb55e3", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/8c8952918b75f4fa6adbbe44cd641d5fd0bb55e3/comments", "author": {"login": "tejas-belagod-arm", "id": 92718852, "node_id": "U_kgDOBYbHBA", "avatar_url": "https://avatars.githubusercontent.com/u/92718852?v=4", "gravatar_id": "", "url": "https://api.github.com/users/tejas-belagod-arm", "html_url": "https://github.com/tejas-belagod-arm", "followers_url": "https://api.github.com/users/tejas-belagod-arm/followers", "following_url": "https://api.github.com/users/tejas-belagod-arm/following{/other_user}", "gists_url": "https://api.github.com/users/tejas-belagod-arm/gists{/gist_id}", "starred_url": "https://api.github.com/users/tejas-belagod-arm/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/tejas-belagod-arm/subscriptions", "organizations_url": "https://api.github.com/users/tejas-belagod-arm/orgs", "repos_url": "https://api.github.com/users/tejas-belagod-arm/repos", "events_url": "https://api.github.com/users/tejas-belagod-arm/events{/privacy}", "received_events_url": "https://api.github.com/users/tejas-belagod-arm/received_events", "type": "User", "site_admin": false}, "committer": null, "parents": [{"sha": "601a5921eb0b56c647b3fa7136d11172495c0cb0", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/601a5921eb0b56c647b3fa7136d11172495c0cb0", "html_url": "https://github.com/Rust-GCC/gccrs/commit/601a5921eb0b56c647b3fa7136d11172495c0cb0"}], "stats": {"total": 94, "additions": 94, "deletions": 0}, "files": [{"sha": "49c0844ecd76e9c9940878e01679ce2c70c32694", "filename": "gcc/ChangeLog", "status": "modified", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/8c8952918b75f4fa6adbbe44cd641d5fd0bb55e3/gcc%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/8c8952918b75f4fa6adbbe44cd641d5fd0bb55e3/gcc%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2FChangeLog?ref=8c8952918b75f4fa6adbbe44cd641d5fd0bb55e3", "patch": "@@ -1,3 +1,8 @@\n+2013-12-05  Tejas Belagod  <tejas.belagod@arm.com>\n+\n+\t* rtlanal.c (set_noop_p): Return nonzero in case of redundant vec_select\n+\tfor overlapping register lanes.\n+\n 2013-12-05  Kirill Yukhin  <kirill.yukhin@intel.com>\n \n \t* config/i386/i386.c (ix86_expand_builtin): Generate"}, {"sha": "38f9e36593d1119ecd333cc7e531bfda34d6f450", "filename": "gcc/rtlanal.c", "status": "modified", "additions": 21, "deletions": 0, "changes": 21, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/8c8952918b75f4fa6adbbe44cd641d5fd0bb55e3/gcc%2Frtlanal.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/8c8952918b75f4fa6adbbe44cd641d5fd0bb55e3/gcc%2Frtlanal.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Frtlanal.c?ref=8c8952918b75f4fa6adbbe44cd641d5fd0bb55e3", "patch": "@@ -1180,6 +1180,27 @@ set_noop_p (const_rtx set)\n       dst = SUBREG_REG (dst);\n     }\n \n+  /* It is a NOOP if destination overlaps with selected src vector\n+     elements.  */\n+  if (GET_CODE (src) == VEC_SELECT\n+      && REG_P (XEXP (src, 0)) && REG_P (dst)\n+      && HARD_REGISTER_P (XEXP (src, 0))\n+      && HARD_REGISTER_P (dst))\n+    {\n+      int i;\n+      rtx par = XEXP (src, 1);\n+      rtx src0 = XEXP (src, 0);\n+      int c0 = INTVAL (XVECEXP (par, 0, 0));\n+      HOST_WIDE_INT offset = GET_MODE_UNIT_SIZE (GET_MODE (src0)) * c0;\n+\n+      for (i = 1; i < XVECLEN (par, 0); i++)\n+\tif (INTVAL (XVECEXP (par, 0, i)) != c0 + i)\n+\t  return 0;\n+      return\n+\tsimplify_subreg_regno (REGNO (src0), GET_MODE (src0),\n+\t\t\t       offset, GET_MODE (dst)) == (int) REGNO (dst);\n+    }\n+\n   return (REG_P (src) && REG_P (dst)\n \t  && REGNO (src) == REGNO (dst));\n }"}, {"sha": "d9f7de3a38df87d7dd432baac2099c248937fd03", "filename": "gcc/testsuite/ChangeLog", "status": "modified", "additions": 4, "deletions": 0, "changes": 4, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/8c8952918b75f4fa6adbbe44cd641d5fd0bb55e3/gcc%2Ftestsuite%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/8c8952918b75f4fa6adbbe44cd641d5fd0bb55e3/gcc%2Ftestsuite%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2FChangeLog?ref=8c8952918b75f4fa6adbbe44cd641d5fd0bb55e3", "patch": "@@ -1,3 +1,7 @@\n+2013-12-05  Tejas Belagod  <tejas.belagod@arm.com>\n+\n+\t* gcc.dg/vect/vect-nop-move.c: New test.\n+\n 2013-12-05  Max Ostapenko  <m.ostapenko@partner.samsung.com>\n \n \t* c-c++-common/tsan/atomic_stack.c: New test."}, {"sha": "19419335097d333fc591bc8791ef9b169c1d7ae8", "filename": "gcc/testsuite/gcc.dg/vect/vect-nop-move.c", "status": "added", "additions": 64, "deletions": 0, "changes": 64, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/8c8952918b75f4fa6adbbe44cd641d5fd0bb55e3/gcc%2Ftestsuite%2Fgcc.dg%2Fvect%2Fvect-nop-move.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/8c8952918b75f4fa6adbbe44cd641d5fd0bb55e3/gcc%2Ftestsuite%2Fgcc.dg%2Fvect%2Fvect-nop-move.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgcc.dg%2Fvect%2Fvect-nop-move.c?ref=8c8952918b75f4fa6adbbe44cd641d5fd0bb55e3", "patch": "@@ -0,0 +1,64 @@\n+/* { dg-do run } */ \n+/* { dg-require-effective-target vect_float } */\n+/* { dg-options \"-O3 -fdump-rtl-combine-details\" } */\n+\n+extern void abort (void);\n+\n+#define NOINLINE __attribute__((noinline))\n+\n+typedef float float32x4_t __attribute__ ((__vector_size__ (16)));\n+typedef float float32x2_t __attribute__ ((__vector_size__ (8)));\n+\n+NOINLINE float\n+foo32x4_be (float32x4_t x)\n+{\n+  return x[3];\n+}\n+\n+NOINLINE float\n+foo32x4_le (float32x4_t x)\n+{\n+  return x[0];\n+}\n+\n+NOINLINE float\n+bar (float a)\n+{\n+  return a;\n+}\n+\n+NOINLINE float\n+foo32x2_be (float32x2_t x)\n+{\n+  return bar (x[1]);\n+}\n+\n+NOINLINE float\n+foo32x2_le (float32x2_t x)\n+{\n+  return bar (x[0]);\n+}\n+\n+int\n+main()\n+{\n+  float32x4_t a = { 0.0f, 1.0f, 2.0f, 3.0f };\n+  float32x2_t b = { 0.0f, 1.0f };\n+\n+  if (foo32x4_be (a) != 3.0f)\n+    abort ();\n+\n+  if (foo32x4_le (a) != 0.0f)\n+    abort ();\n+\n+  if (foo32x2_be (b) != 1.0f)\n+    abort ();\n+\n+  if (foo32x2_le (b) != 0.0f)\n+    abort ();\n+\n+  return 0;\n+}\n+\n+/* { dg-final { scan-rtl-dump \"deleting noop move\" \"combine\" { target aarch64*-*-* } } } */\n+/* { dg-final { cleanup-rtl-dump \"combine\" } } */"}]}