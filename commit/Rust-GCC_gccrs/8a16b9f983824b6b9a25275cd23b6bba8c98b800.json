{"sha": "8a16b9f983824b6b9a25275cd23b6bba8c98b800", "node_id": "C_kwDOANBUbNoAKDhhMTZiOWY5ODM4MjRiNmI5YTI1Mjc1Y2QyM2I2YmJhOGM5OGI4MDA", "commit": {"author": {"name": "Tobias Burnus", "email": "tobias@codesourcery.com", "date": "2022-08-09T05:57:40Z"}, "committer": {"name": "Tobias Burnus", "email": "tobias@codesourcery.com", "date": "2022-08-09T05:57:40Z"}, "message": "OpenMP: Fix folding with simd's linear clause [PR106492]\n\ngcc/ChangeLog:\n\n\tPR middle-end/106492\n\t* omp-low.cc (lower_rec_input_clauses): Add missing folding\n\tto data type of linear-clause list item.\n\ngcc/testsuite/ChangeLog:\n\n\tPR middle-end/106492\n\t* g++.dg/gomp/pr106492.C: New test.", "tree": {"sha": "2cc829b55a533c2f350c0d986e47c6284a9d1370", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/2cc829b55a533c2f350c0d986e47c6284a9d1370"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/8a16b9f983824b6b9a25275cd23b6bba8c98b800", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/8a16b9f983824b6b9a25275cd23b6bba8c98b800", "html_url": "https://github.com/Rust-GCC/gccrs/commit/8a16b9f983824b6b9a25275cd23b6bba8c98b800", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/8a16b9f983824b6b9a25275cd23b6bba8c98b800/comments", "author": {"login": "tob2", "id": 264461, "node_id": "MDQ6VXNlcjI2NDQ2MQ==", "avatar_url": "https://avatars.githubusercontent.com/u/264461?v=4", "gravatar_id": "", "url": "https://api.github.com/users/tob2", "html_url": "https://github.com/tob2", "followers_url": "https://api.github.com/users/tob2/followers", "following_url": "https://api.github.com/users/tob2/following{/other_user}", "gists_url": "https://api.github.com/users/tob2/gists{/gist_id}", "starred_url": "https://api.github.com/users/tob2/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/tob2/subscriptions", "organizations_url": "https://api.github.com/users/tob2/orgs", "repos_url": "https://api.github.com/users/tob2/repos", "events_url": "https://api.github.com/users/tob2/events{/privacy}", "received_events_url": "https://api.github.com/users/tob2/received_events", "type": "User", "site_admin": false}, "committer": {"login": "tob2", "id": 264461, "node_id": "MDQ6VXNlcjI2NDQ2MQ==", "avatar_url": "https://avatars.githubusercontent.com/u/264461?v=4", "gravatar_id": "", "url": "https://api.github.com/users/tob2", "html_url": "https://github.com/tob2", "followers_url": "https://api.github.com/users/tob2/followers", "following_url": "https://api.github.com/users/tob2/following{/other_user}", "gists_url": "https://api.github.com/users/tob2/gists{/gist_id}", "starred_url": "https://api.github.com/users/tob2/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/tob2/subscriptions", "organizations_url": "https://api.github.com/users/tob2/orgs", "repos_url": "https://api.github.com/users/tob2/repos", "events_url": "https://api.github.com/users/tob2/events{/privacy}", "received_events_url": "https://api.github.com/users/tob2/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "5f17badb648980275ff4c86b0c207dbd751b00f2", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/5f17badb648980275ff4c86b0c207dbd751b00f2", "html_url": "https://github.com/Rust-GCC/gccrs/commit/5f17badb648980275ff4c86b0c207dbd751b00f2"}], "stats": {"total": 55, "additions": 52, "deletions": 3}, "files": [{"sha": "3c4b8593c8b9b2148049dffc5affacbbe62a13b7", "filename": "gcc/omp-low.cc", "status": "modified", "additions": 3, "deletions": 3, "changes": 6, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/8a16b9f983824b6b9a25275cd23b6bba8c98b800/gcc%2Fomp-low.cc", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/8a16b9f983824b6b9a25275cd23b6bba8c98b800/gcc%2Fomp-low.cc", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fomp-low.cc?ref=8a16b9f983824b6b9a25275cd23b6bba8c98b800", "patch": "@@ -6241,10 +6241,10 @@ lower_rec_input_clauses (tree clauses, gimple_seq *ilist, gimple_seq *dlist,\n \t\t\t}\n \n \t\t      if (POINTER_TYPE_P (TREE_TYPE (x)))\n-\t\t\tx = fold_build2 (POINTER_PLUS_EXPR,\n-\t\t\t\t\t TREE_TYPE (x), x, t);\n+\t\t\tx = fold_build_pointer_plus (x, t);\n \t\t      else\n-\t\t\tx = fold_build2 (PLUS_EXPR, TREE_TYPE (x), x, t);\n+\t\t\tx = fold_build2 (PLUS_EXPR, TREE_TYPE (x), x,\n+\t\t\t\t\t fold_convert (TREE_TYPE (x), t));\n \t\t    }\n \n \t\t  if ((OMP_CLAUSE_CODE (c) != OMP_CLAUSE_LINEAR"}, {"sha": "f263bb4271010653b56b1484e9c1e4fa26b01a26", "filename": "gcc/testsuite/g++.dg/gomp/pr106492.C", "status": "added", "additions": 49, "deletions": 0, "changes": 49, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/8a16b9f983824b6b9a25275cd23b6bba8c98b800/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Fgomp%2Fpr106492.C", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/8a16b9f983824b6b9a25275cd23b6bba8c98b800/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Fgomp%2Fpr106492.C", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Fgomp%2Fpr106492.C?ref=8a16b9f983824b6b9a25275cd23b6bba8c98b800", "patch": "@@ -0,0 +1,49 @@\n+/* PR middle-end/106492 */\n+\n+template <typename T>\n+struct S {\n+  T a : 12;\n+  S () : a(0)\n+  {\n+#pragma omp for simd linear(a)\n+    for (int k = 0; k < 64; ++k)\n+      a++;\n+  }\n+};\n+struct U {\n+  int a : 12;\n+  U () : a(0)\n+  {\n+#pragma omp for simd linear(a)\n+    for (int k = 0; k < 64; ++k)\n+      a++;\n+  }\n+};\n+\n+S<int> s;\n+U u;\n+\n+\n+template <typename T>\n+struct Sptr {\n+  T a;\n+  Sptr (T init) : a(init)\n+  {\n+#pragma omp for simd linear(a)\n+    for (int k = 0; k < 64; ++k)\n+      a++;\n+  }\n+};\n+struct Uptr {\n+  int *a;\n+  Uptr (int *init) : a(init)\n+  {\n+#pragma omp for simd linear(a)\n+    for (int k = 0; k < 64; ++k)\n+      a++;\n+  }\n+};\n+\n+int i[1024];\n+Sptr<int *> sptr(i);\n+Uptr uptr(&i[100]);"}]}