{"sha": "f67325e8386753732d594aa81e9fffecbaec24c4", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6ZjY3MzI1ZTgzODY3NTM3MzJkNTk0YWE4MWU5ZmZmZWNiYWVjMjRjNA==", "commit": {"author": {"name": "Ramana Radhakrishnan", "email": "ramana.radhakrishnan@arm.com", "date": "2010-07-22T08:30:36Z"}, "committer": {"name": "Ramana Radhakrishnan", "email": "ramana@gcc.gnu.org", "date": "2010-07-22T08:30:36Z"}, "message": "re PR target/43698 (Wrong use of ARMv6 REV instruction for endian bytewapping with -Os or -O2 optimizations)\n\nFix PR target/43698\n\n2010-07-22  Ramana Radhakrishnan  <ramana.radhakrishnan@arm.com>\n\n\tPR target/43698\n\t* config/arm/arm.md: Split arm_rev into *arm_rev\n\tand *thumb1_rev. Set *arm_rev to be predicable.\n\n2010-07-22  Ramana Radhakrishnan  <ramana.radhakrishnan@arm.com>\n\n\tPR target/43698\n\t* gcc.target/arm/pr43698.c: New test.\n\nFrom-SVN: r162404", "tree": {"sha": "d10bcca1342935245dbfb3621d1cbfe44f35cc04", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/d10bcca1342935245dbfb3621d1cbfe44f35cc04"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/f67325e8386753732d594aa81e9fffecbaec24c4", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/f67325e8386753732d594aa81e9fffecbaec24c4", "html_url": "https://github.com/Rust-GCC/gccrs/commit/f67325e8386753732d594aa81e9fffecbaec24c4", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/f67325e8386753732d594aa81e9fffecbaec24c4/comments", "author": null, "committer": null, "parents": [{"sha": "50eb566f049aed7b21a580d75abd197430538f1d", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/50eb566f049aed7b21a580d75abd197430538f1d", "html_url": "https://github.com/Rust-GCC/gccrs/commit/50eb566f049aed7b21a580d75abd197430538f1d"}], "stats": {"total": 69, "additions": 62, "deletions": 7}, "files": [{"sha": "2cb8a104e94a1c9f8c6e01e189a03d95b894988e", "filename": "gcc/ChangeLog", "status": "modified", "additions": 6, "deletions": 0, "changes": 6, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/f67325e8386753732d594aa81e9fffecbaec24c4/gcc%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/f67325e8386753732d594aa81e9fffecbaec24c4/gcc%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2FChangeLog?ref=f67325e8386753732d594aa81e9fffecbaec24c4", "patch": "@@ -1,3 +1,9 @@\n+2010-07-22  Ramana Radhakrishnan  <ramana.radhakrishnan@arm.com>\n+\n+ \tPR target/43698\n+\t* config/arm/arm.md: Split arm_rev into *arm_rev\n+\tand *thumb1_rev. Set *arm_rev to be predicable.\n+\n 2010-07-22  Iain Sandoe  <iains@gcc.gnu.org>\n \n \t* config/darwin.h (LINK_COMMAND_SPEC): Split into..."}, {"sha": "33b6931de14abb397efcf8c940f23a967969a1b8", "filename": "gcc/config/arm/arm.md", "status": "modified", "additions": 13, "deletions": 7, "changes": 20, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/f67325e8386753732d594aa81e9fffecbaec24c4/gcc%2Fconfig%2Farm%2Farm.md", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/f67325e8386753732d594aa81e9fffecbaec24c4/gcc%2Fconfig%2Farm%2Farm.md", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fconfig%2Farm%2Farm.md?ref=f67325e8386753732d594aa81e9fffecbaec24c4", "patch": "@@ -11305,15 +11305,21 @@\n    (set_attr \"length\" \"4\")]\n )\n \n-(define_insn \"arm_rev\"\n+(define_insn \"*arm_rev\"\n   [(set (match_operand:SI 0 \"s_register_operand\" \"=r\")\n \t(bswap:SI (match_operand:SI 1 \"s_register_operand\" \"r\")))]\n-  \"TARGET_EITHER && arm_arch6\"\n-  \"rev\\t%0, %1\"\n-  [(set (attr \"length\")\n-        (if_then_else (eq_attr \"is_thumb\" \"yes\")\n-\t\t      (const_int 2)\n-\t\t      (const_int 4)))]\n+  \"TARGET_32BIT && arm_arch6\"\n+  \"rev%?\\t%0, %1\"\n+  [(set_attr \"predicable\" \"yes\")\n+   (set_attr \"length\" \"4\")]\n+)\n+\n+(define_insn \"*thumb1_rev\"\n+  [(set (match_operand:SI 0 \"s_register_operand\" \"=l\")\n+\t(bswap:SI (match_operand:SI 1 \"s_register_operand\" \"l\")))]\n+  \"TARGET_THUMB1 && arm_arch6\"\n+   \"rev\\t%0, %1\"\n+  [(set_attr \"length\" \"2\")]\n )\n \n (define_expand \"arm_legacy_rev\""}, {"sha": "9c67b0a4e73c9674d25def8dd323023ab9f15382", "filename": "gcc/testsuite/ChangeLog", "status": "modified", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/f67325e8386753732d594aa81e9fffecbaec24c4/gcc%2Ftestsuite%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/f67325e8386753732d594aa81e9fffecbaec24c4/gcc%2Ftestsuite%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2FChangeLog?ref=f67325e8386753732d594aa81e9fffecbaec24c4", "patch": "@@ -1,3 +1,8 @@\n+2010-07-22  Ramana Radhakrishnan  <ramana.radhakrishnan@arm.com>\n+\n+\tPR target/43698\n+\t* gcc.target/arm/pr43698.c: New test.\n+\n 2010-07-21  Steven G. Kargl  <kargl@gcc.gnu.org>\n \n \tPR fortran/44929"}, {"sha": "407cf7eac2cb7510e0abb056c7375642ca32602a", "filename": "gcc/testsuite/gcc.target/arm/pr43698.c", "status": "added", "additions": 38, "deletions": 0, "changes": 38, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/f67325e8386753732d594aa81e9fffecbaec24c4/gcc%2Ftestsuite%2Fgcc.target%2Farm%2Fpr43698.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/f67325e8386753732d594aa81e9fffecbaec24c4/gcc%2Ftestsuite%2Fgcc.target%2Farm%2Fpr43698.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgcc.target%2Farm%2Fpr43698.c?ref=f67325e8386753732d594aa81e9fffecbaec24c4", "patch": "@@ -0,0 +1,38 @@\n+/* { dg-do run } */\n+/* { dg-options \"-Os -march=armv7-a\" } */\n+#include <stdint.h>\n+#include <stdlib.h>\n+\n+\n+char do_reverse_endian = 0;\n+\n+#  define bswap_32(x) \\\n+  ((((x) & 0xff000000) >> 24) | \\\n+   (((x) & 0x00ff0000) >>  8) | \\\n+   (((x) & 0x0000ff00) <<  8) | \\\n+   (((x) & 0x000000ff) << 24))\n+\n+#define EGET(X) \\\n+  (__extension__ ({ \\\n+      uint64_t __res; \\\n+      if (!do_reverse_endian) {    __res = (X); \\\n+      } else if (sizeof(X) == 4) { __res = bswap_32((X)); \\\n+      } \\\n+      __res; \\\n+    }))\n+\n+void __attribute__((noinline)) X(char **phdr, char **data, int *phoff)\n+{\n+  *phdr = *data + EGET(*phoff);\n+}\n+\n+int main()\n+{\n+  char *phdr;\n+  char *data = (char *)0x40164000;\n+  int phoff = 0x34;\n+  X(&phdr, &data, &phoff);\n+  if (phdr != (char *)0x40164034)\n+    abort ();\n+  exit (0);\n+}"}]}