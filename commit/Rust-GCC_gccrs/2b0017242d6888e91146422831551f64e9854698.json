{"sha": "2b0017242d6888e91146422831551f64e9854698", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6MmIwMDE3MjQyZDY4ODhlOTExNDY0MjI4MzE1NTFmNjRlOTg1NDY5OA==", "commit": {"author": {"name": "Manuel L\u00f3pez-Ib\u00e1\u00f1ez", "email": "manu@gcc.gnu.org", "date": "2006-12-22T15:54:05Z"}, "committer": {"name": "Manuel L\u00f3pez-Ib\u00e1\u00f1ez", "email": "manu@gcc.gnu.org", "date": "2006-12-22T15:54:05Z"}, "message": "re PR middle-end/7651 (Define -Wextra strictly in terms of other warning flags)\n\n2006-12-22  Manuel Lopez-Ibanez  <manu@gcc.gnu.org>\n\n\tPR middle-end/7651\n\t* c.opt (Wclobbered): New.\n\t* doc/invoke.texi (Wclobbered): Document it.\n\t(Wextra): Enabled by -Wextra.\n\t* c-opts.c (c_common_post_options): Enabled by -Wextra.\n\t* flow.c (rest_of_handle_life): Replace Wextra with Wclobbered.\n\t* function.c (setjmp_vars_warning): Only warn for Wclobbered.\n\t(setjmp_args_warning): Likewise.\n\ntestsuite/\n\n\t* gcc.dg/attr-returns_twice-1.c: Replace Wextra with Wclobbered.\n\t* gcc.dg/setjmp-1.c: Add explicit Wclobbered.\n\nFrom-SVN: r120151", "tree": {"sha": "b213317c3f34e3c03d9cc572db411c63b2179ffe", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/b213317c3f34e3c03d9cc572db411c63b2179ffe"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/2b0017242d6888e91146422831551f64e9854698", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/2b0017242d6888e91146422831551f64e9854698", "html_url": "https://github.com/Rust-GCC/gccrs/commit/2b0017242d6888e91146422831551f64e9854698", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/2b0017242d6888e91146422831551f64e9854698/comments", "author": null, "committer": null, "parents": [{"sha": "24fc18b98c30f23c5de5bce0fb6b90f5929fe453", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/24fc18b98c30f23c5de5bce0fb6b90f5929fe453", "html_url": "https://github.com/Rust-GCC/gccrs/commit/24fc18b98c30f23c5de5bce0fb6b90f5929fe453"}], "stats": {"total": 48, "additions": 39, "deletions": 9}, "files": [{"sha": "4ceb90faa399836ca895340e6afd5e295d4af9c6", "filename": "gcc/ChangeLog", "status": "modified", "additions": 11, "deletions": 0, "changes": 11, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/2b0017242d6888e91146422831551f64e9854698/gcc%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/2b0017242d6888e91146422831551f64e9854698/gcc%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2FChangeLog?ref=2b0017242d6888e91146422831551f64e9854698", "patch": "@@ -1,3 +1,14 @@\n+2006-12-22  Manuel Lopez-Ibanez  <manu@gcc.gnu.org>\n+\n+\tPR middle-end/7651\n+\t* c.opt (Wclobbered): New.\n+\t* doc/invoke.texi (Wclobbered): Document it.\n+\t(Wextra): Enabled by -Wextra.\n+\t* c-opts.c (c_common_post_options): Enabled by -Wextra.\n+\t* flow.c (rest_of_handle_life): Replace Wextra with Wclobbered.\n+\t* function.c (setjmp_vars_warning): Only warn for Wclobbered.\n+\t(setjmp_args_warning): Likewise.\n+\t\n 2006-12-22  Kazu Hirata  <kazu@codesourcery.com>\n \n \t* config/elfos.h, config/spu/spu.c, tree-ssa-operands.h,"}, {"sha": "12caf1bb949950f9a759fd26d807ac80a36b0fae", "filename": "gcc/c-opts.c", "status": "modified", "additions": 3, "deletions": 1, "changes": 4, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/2b0017242d6888e91146422831551f64e9854698/gcc%2Fc-opts.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/2b0017242d6888e91146422831551f64e9854698/gcc%2Fc-opts.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fc-opts.c?ref=2b0017242d6888e91146422831551f64e9854698", "patch": "@@ -1025,9 +1025,11 @@ c_common_post_options (const char **pfilename)\n   if (flag_objc_exceptions && !flag_objc_sjlj_exceptions)\n     flag_exceptions = 1;\n \n-  /* -Wextra implies -Wempty-body, -Wsign-compare, \n+  /* -Wextra implies -Wclobbered, -Wempty-body, -Wsign-compare, \n      -Wmissing-field-initializers and -Woverride-init, \n      but not if explicitly overridden.  */\n+  if (warn_clobbered == -1)\n+    warn_clobbered = extra_warnings;\n   if (warn_empty_body == -1)\n     warn_empty_body = extra_warnings;\n   if (warn_sign_compare == -1)"}, {"sha": "74aef8e0303b6cb09d08a6ea2dff33b0322f0797", "filename": "gcc/c.opt", "status": "modified", "additions": 4, "deletions": 0, "changes": 4, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/2b0017242d6888e91146422831551f64e9854698/gcc%2Fc.opt", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/2b0017242d6888e91146422831551f64e9854698/gcc%2Fc.opt", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fc.opt?ref=2b0017242d6888e91146422831551f64e9854698", "patch": "@@ -141,6 +141,10 @@ Wchar-subscripts\n C ObjC C++ ObjC++ Var(warn_char_subscripts)\n Warn about subscripts whose type is \\\"char\\\"\n \n+Wclobbered\n+C ObjC C++ ObjC++ Var(warn_clobbered) Init(-1)\n+Warn about variables that might be changed by \\\"longjmp\\\" or \\\"vfork\\\"\n+\n Wcomment\n C ObjC C++ ObjC++\n Warn about possibly nested block comments, and C++ comments spanning more than one physical line"}, {"sha": "b65280bfce0b465cd0c283b4dbdb3b22ec913faf", "filename": "gcc/doc/invoke.texi", "status": "modified", "additions": 8, "deletions": 1, "changes": 9, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/2b0017242d6888e91146422831551f64e9854698/gcc%2Fdoc%2Finvoke.texi", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/2b0017242d6888e91146422831551f64e9854698/gcc%2Fdoc%2Finvoke.texi", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fdoc%2Finvoke.texi?ref=2b0017242d6888e91146422831551f64e9854698", "patch": "@@ -222,7 +222,8 @@ Objective-C and Objective-C++ Dialects}.\n @xref{Warning Options,,Options to Request or Suppress Warnings}.\n @gccoptlist{-fsyntax-only  -pedantic  -pedantic-errors @gol\n -w  -Wextra  -Wall  -Waggregate-return -Walways-true -Wno-attributes @gol\n--Wc++-compat -Wcast-align  -Wcast-qual  -Wchar-subscripts  -Wcomment @gol\n+-Wc++-compat -Wcast-align  -Wcast-qual  -Wchar-subscripts @gol\n+-Wclobbered  -Wcomment @gol\n -Wconversion  -Wno-deprecated-declarations @gol\n -Wdisabled-optimization  -Wno-div-by-zero  @gol\n -Wempty-body  -Wno-endif-labels @gol\n@@ -2925,6 +2926,7 @@ A pointer is compared against integer zero with @samp{<}, @samp{<=},\n \n @item\n A variable might be changed by @samp{longjmp} or @samp{vfork}.\n+This warning can be independently controlled by @option{-Wclobbered}.\n \n @item\n Any of several floating-point events that often indicate errors, such as\n@@ -3157,6 +3159,11 @@ only if you have been very careful about using @code{const} in\n declarations and prototypes.  Otherwise, it will just be a nuisance;\n this is why we did not make @option{-Wall} request these warnings.\n \n+@item -Wclobbered\n+@opindex Wclobbered\n+Warn for variables that might be changed by @samp{longjmp} or\n+@samp{vfork}.  This warning is also enabled by @option{-Wextra}.\n+\n @item -Wconversion\n @opindex Wconversion\n Warn for implicit conversions that may alter a value. This includes"}, {"sha": "78c23281c6b25c4d4c5a8b9dea4ed274b11fd689", "filename": "gcc/flow.c", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/2b0017242d6888e91146422831551f64e9854698/gcc%2Fflow.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/2b0017242d6888e91146422831551f64e9854698/gcc%2Fflow.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fflow.c?ref=2b0017242d6888e91146422831551f64e9854698", "patch": "@@ -4695,7 +4695,7 @@ rest_of_handle_life (void)\n     cleanup_cfg (CLEANUP_EXPENSIVE | CLEANUP_UPDATE_LIFE | CLEANUP_LOG_LINKS\n                  | (flag_thread_jumps ? CLEANUP_THREADING : 0));\n \n-  if (extra_warnings)\n+  if (warn_clobbered)\n     {\n       setjmp_vars_warning (DECL_INITIAL (current_function_decl));\n       setjmp_args_warning ();"}, {"sha": "581c0834d44c5b0741166f7f2722a2d6c2e9a6b4", "filename": "gcc/function.c", "status": "modified", "additions": 4, "deletions": 4, "changes": 8, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/2b0017242d6888e91146422831551f64e9854698/gcc%2Ffunction.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/2b0017242d6888e91146422831551f64e9854698/gcc%2Ffunction.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ffunction.c?ref=2b0017242d6888e91146422831551f64e9854698", "patch": "@@ -3536,9 +3536,8 @@ setjmp_vars_warning (tree block)\n \t  && DECL_RTL_SET_P (decl)\n \t  && REG_P (DECL_RTL (decl))\n \t  && regno_clobbered_at_setjmp (REGNO (DECL_RTL (decl))))\n-\twarning (0, \"variable %q+D might be clobbered by %<longjmp%>\"\n-\t\t \" or %<vfork%>\",\n-\t\t decl);\n+\twarning (OPT_Wclobbered, \"variable %q+D might be clobbered by\" \n+                 \" %<longjmp%> or %<vfork%>\", decl);\n     }\n \n   for (sub = BLOCK_SUBBLOCKS (block); sub; sub = TREE_CHAIN (sub))\n@@ -3557,7 +3556,8 @@ setjmp_args_warning (void)\n     if (DECL_RTL (decl) != 0\n \t&& REG_P (DECL_RTL (decl))\n \t&& regno_clobbered_at_setjmp (REGNO (DECL_RTL (decl))))\n-      warning (0, \"argument %q+D might be clobbered by %<longjmp%> or %<vfork%>\",\n+      warning (OPT_Wclobbered, \n+               \"argument %q+D might be clobbered by %<longjmp%> or %<vfork%>\",\n \t       decl);\n }\n "}, {"sha": "5fc63cfc4357f98ac989011bc40a8d45adb13220", "filename": "gcc/testsuite/ChangeLog", "status": "modified", "additions": 6, "deletions": 0, "changes": 6, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/2b0017242d6888e91146422831551f64e9854698/gcc%2Ftestsuite%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/2b0017242d6888e91146422831551f64e9854698/gcc%2Ftestsuite%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2FChangeLog?ref=2b0017242d6888e91146422831551f64e9854698", "patch": "@@ -1,3 +1,9 @@\n+2006-12-22  Manuel Lopez-Ibanez  <manu@gcc.gnu.org>\n+\n+\tPR middle-end/7651\n+\t* gcc.dg/attr-returns_twice-1.c: Replace Wextra with Wclobbered.\n+\t* gcc.dg/setjmp-1.c: Add explicit Wclobbered.\n+\n 2006-12-21  Andrew Pinski  <pinskia@gmail.com>\n \n \tPR C++/30168"}, {"sha": "e2e725e36345801905055c7216a53456cb506f52", "filename": "gcc/testsuite/gcc.dg/attr-returns_twice-1.c", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/2b0017242d6888e91146422831551f64e9854698/gcc%2Ftestsuite%2Fgcc.dg%2Fattr-returns_twice-1.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/2b0017242d6888e91146422831551f64e9854698/gcc%2Ftestsuite%2Fgcc.dg%2Fattr-returns_twice-1.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgcc.dg%2Fattr-returns_twice-1.c?ref=2b0017242d6888e91146422831551f64e9854698", "patch": "@@ -1,5 +1,5 @@\n /* { dg-do compile { target i?86-*-* x86_64-*-* } } */\n-/* { dg-options \"-W\" } */\n+/* { dg-options \"-Wclobbered\" } */\n \n int newsetjmp(void) __attribute__((returns_twice));\n void g(int);"}, {"sha": "b5c84fc8792da3418bff517d5dc8aa7e112fc392", "filename": "gcc/testsuite/gcc.dg/setjmp-1.c", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/2b0017242d6888e91146422831551f64e9854698/gcc%2Ftestsuite%2Fgcc.dg%2Fsetjmp-1.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/2b0017242d6888e91146422831551f64e9854698/gcc%2Ftestsuite%2Fgcc.dg%2Fsetjmp-1.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgcc.dg%2Fsetjmp-1.c?ref=2b0017242d6888e91146422831551f64e9854698", "patch": "@@ -2,7 +2,7 @@\n    Inspired by cse.c:simplify_relational_operation. */\n \n /* { dg-do compile } */\n-/* { dg-options \"-O -W -Wall\" } */\n+/* { dg-options \"-O -Wclobbered -Wextra -Wall\" } */\n \n #include <setjmp.h>\n "}]}