{"sha": "dde76623dd2b3df7e471e9b8fe058b176569560d", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6ZGRlNzY2MjNkZDJiM2RmN2U0NzFlOWI4ZmUwNThiMTc2NTY5NTYwZA==", "commit": {"author": {"name": "Tom de Vries", "email": "tom@codesourcery.com", "date": "2017-11-14T09:12:14Z"}, "committer": {"name": "Tom de Vries", "email": "vries@gcc.gnu.org", "date": "2017-11-14T09:12:14Z"}, "message": "Allow asyncwait-1.c to run for non-nvidia devices\n\n2017-11-14  Tom de Vries  <tom@codesourcery.com>\n\n\t* testsuite/libgomp.oacc-c-c++-common/asyncwait-1.c: Allow to run for\n\tnon-nvidia devices.\n\nFrom-SVN: r254723", "tree": {"sha": "a0e5a8041396ba030a98f2367ae7be03612e53f2", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/a0e5a8041396ba030a98f2367ae7be03612e53f2"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/dde76623dd2b3df7e471e9b8fe058b176569560d", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/dde76623dd2b3df7e471e9b8fe058b176569560d", "html_url": "https://github.com/Rust-GCC/gccrs/commit/dde76623dd2b3df7e471e9b8fe058b176569560d", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/dde76623dd2b3df7e471e9b8fe058b176569560d/comments", "author": null, "committer": null, "parents": [{"sha": "3d8d3012c439ac5fbac45f96ba959b6d5c84cef4", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/3d8d3012c439ac5fbac45f96ba959b6d5c84cef4", "html_url": "https://github.com/Rust-GCC/gccrs/commit/3d8d3012c439ac5fbac45f96ba959b6d5c84cef4"}], "stats": {"total": 21, "additions": 19, "deletions": 2}, "files": [{"sha": "eaa50ddc66ba886ab0b24b66b183423702905343", "filename": "libgomp/ChangeLog", "status": "modified", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/dde76623dd2b3df7e471e9b8fe058b176569560d/libgomp%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/dde76623dd2b3df7e471e9b8fe058b176569560d/libgomp%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libgomp%2FChangeLog?ref=dde76623dd2b3df7e471e9b8fe058b176569560d", "patch": "@@ -1,3 +1,8 @@\n+2017-11-14  Tom de Vries  <tom@codesourcery.com>\n+\n+\t* testsuite/libgomp.oacc-c-c++-common/asyncwait-1.c: Allow to run for\n+\tnon-nvidia devices.\n+\n 2017-11-07  Jakub Jelinek  <jakub@redhat.com>\n \n \tPR c++/82835"}, {"sha": "e780845a79300087df689df0e84a5085baa3817f", "filename": "libgomp/testsuite/libgomp.oacc-c-c++-common/asyncwait-1.c", "status": "modified", "additions": 14, "deletions": 2, "changes": 16, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/dde76623dd2b3df7e471e9b8fe058b176569560d/libgomp%2Ftestsuite%2Flibgomp.oacc-c-c%2B%2B-common%2Fasyncwait-1.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/dde76623dd2b3df7e471e9b8fe058b176569560d/libgomp%2Ftestsuite%2Flibgomp.oacc-c-c%2B%2B-common%2Fasyncwait-1.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libgomp%2Ftestsuite%2Flibgomp.oacc-c-c%2B%2B-common%2Fasyncwait-1.c?ref=dde76623dd2b3df7e471e9b8fe058b176569560d", "patch": "@@ -1,24 +1,30 @@\n-/* { dg-do run { target openacc_nvidia_accel_selected } } */\n-/* { dg-additional-options \"-lcuda\" } */\n+/* { dg-do run } */\n+/* { dg-additional-options \"-lcuda\" { target openacc_nvidia_accel_selected } } */\n \n #include <openacc.h>\n #include <stdlib.h>\n+#if defined ACC_DEVICE_TYPE_nvidia\n #include \"cuda.h\"\n+#endif\n \n #include <stdio.h>\n #include <sys/time.h>\n \n int\n main (int argc, char **argv)\n {\n+#if defined ACC_DEVICE_TYPE_nvidia\n     CUresult r;\n     CUstream stream1;\n+#endif\n     int N = 128; //1024 * 1024;\n     float *a, *b, *c, *d, *e;\n     int i;\n     int nbytes;\n \n+#if defined ACC_DEVICE_TYPE_nvidia\n     acc_init (acc_device_nvidia);\n+#endif\n \n     nbytes = N * sizeof (float);\n \n@@ -210,6 +216,7 @@ main (int argc, char **argv)\n     }\n \n \n+#if defined ACC_DEVICE_TYPE_nvidia\n     r = cuStreamCreate (&stream1, CU_STREAM_NON_BLOCKING);\n     if (r != CUDA_SUCCESS)\n     {\n@@ -218,6 +225,7 @@ main (int argc, char **argv)\n     }\n \n     acc_set_cuda_stream (1, stream1);\n+#endif\n \n     for (i = 0; i < N; i++)\n     {\n@@ -642,6 +650,7 @@ main (int argc, char **argv)\n     }\n \n \n+#if defined ACC_DEVICE_TYPE_nvidia\n     r = cuStreamCreate (&stream1, CU_STREAM_NON_BLOCKING);\n     if (r != CUDA_SUCCESS)\n     {\n@@ -650,6 +659,7 @@ main (int argc, char **argv)\n     }\n \n     acc_set_cuda_stream (1, stream1);\n+#endif\n \n     for (i = 0; i < N; i++)\n     {\n@@ -892,7 +902,9 @@ main (int argc, char **argv)\n             abort ();\n     }\n \n+#if defined ACC_DEVICE_TYPE_nvidia\n     acc_shutdown (acc_device_nvidia);\n+#endif\n \n     return 0;\n }"}]}