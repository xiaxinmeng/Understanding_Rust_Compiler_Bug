{"sha": "130cd3e1df2476eda6e01c82ace326db4f85e24e", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6MTMwY2QzZTFkZjI0NzZlZGE2ZTAxYzgyYWNlMzI2ZGI0Zjg1ZTI0ZQ==", "commit": {"author": {"name": "Paolo Carlini", "email": "pcarlini@unitus.it", "date": "2003-02-17T19:05:01Z"}, "committer": {"name": "Paolo Carlini", "email": "paolo@gcc.gnu.org", "date": "2003-02-17T19:05:01Z"}, "message": "re PR libstdc++/9169 (filebuf output fails if codecvt<>::out returns noconv)\n\n2003-02-17  Paolo Carlini  <pcarlini@unitus.it>\n\n\tPR libstdc++/9169\n\t* include/bits/fstream.tcc (_M_convert_to_external):\n\tDeal correctly with noconv, as prescribed by 27.8.1.4,p8.\n\t* testsuite/27_io/filebuf_virtuals.cc (test10): Add.\n\nFrom-SVN: r63004", "tree": {"sha": "e139249222df1ec6aa5827e3d8938d3bf497f033", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/e139249222df1ec6aa5827e3d8938d3bf497f033"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/130cd3e1df2476eda6e01c82ace326db4f85e24e", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/130cd3e1df2476eda6e01c82ace326db4f85e24e", "html_url": "https://github.com/Rust-GCC/gccrs/commit/130cd3e1df2476eda6e01c82ace326db4f85e24e", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/130cd3e1df2476eda6e01c82ace326db4f85e24e/comments", "author": null, "committer": null, "parents": [{"sha": "ba5d2d3dc1184cedaa95a033572acedc3d1fdb5d", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/ba5d2d3dc1184cedaa95a033572acedc3d1fdb5d", "html_url": "https://github.com/Rust-GCC/gccrs/commit/ba5d2d3dc1184cedaa95a033572acedc3d1fdb5d"}], "stats": {"total": 58, "additions": 56, "deletions": 2}, "files": [{"sha": "75d729b482143b66bc00e1268f749719a77abc54", "filename": "libstdc++-v3/ChangeLog", "status": "modified", "additions": 7, "deletions": 0, "changes": 7, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/130cd3e1df2476eda6e01c82ace326db4f85e24e/libstdc%2B%2B-v3%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/130cd3e1df2476eda6e01c82ace326db4f85e24e/libstdc%2B%2B-v3%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libstdc%2B%2B-v3%2FChangeLog?ref=130cd3e1df2476eda6e01c82ace326db4f85e24e", "patch": "@@ -1,3 +1,10 @@\n+2003-02-17  Paolo Carlini  <pcarlini@unitus.it>\n+\n+\tPR libstdc++/9169\n+\t* include/bits/fstream.tcc (_M_convert_to_external):\n+\tDeal correctly with noconv, as prescribed by 27.8.1.4,p8.\n+\t* testsuite/27_io/filebuf_virtuals.cc (test10): Add.\n+\n 2003-02-13  Benjamin Kosnik  <bkoz@redhat.com>\n \n \t* include/bits/c++config (_GLIBCPP_EXTERN_TEMPLATE): Define."}, {"sha": "0c6e7b04b6bf16cbdca7fff4d2386a50f1a2df62", "filename": "libstdc++-v3/include/bits/fstream.tcc", "status": "modified", "additions": 8, "deletions": 2, "changes": 10, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/130cd3e1df2476eda6e01c82ace326db4f85e24e/libstdc%2B%2B-v3%2Finclude%2Fbits%2Ffstream.tcc", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/130cd3e1df2476eda6e01c82ace326db4f85e24e/libstdc%2B%2B-v3%2Finclude%2Fbits%2Ffstream.tcc", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libstdc%2B%2B-v3%2Finclude%2Fbits%2Ffstream.tcc?ref=130cd3e1df2476eda6e01c82ace326db4f85e24e", "patch": "@@ -291,9 +291,15 @@ namespace std\n \t  const char_type* __iend;\n \t  __res_type __r = __cvt.out(_M_state_cur, __ibuf, __ibuf + __ilen, \n \t\t \t\t     __iend, __buf, __buf + __blen, __bend);\n-\t  // Result == ok, partial, noconv\n-\t  if (__r != codecvt_base::error)\n+\n+\t  if (__r == codecvt_base::ok || __r == codecvt_base::partial)\n \t    __blen = __bend - __buf;\n+\t  // Similarly to the always_noconv case above.\n+\t  else if (__r == codecvt_base::noconv)\n+\t    {\n+\t      __buf = reinterpret_cast<char*>(__ibuf);\n+\t      __blen = __ilen;\n+\t    }\n \t  // Result == error\n \t  else \n \t    __blen = 0;"}, {"sha": "843038aab482381e7eec4cebb137139a985dc8bd", "filename": "libstdc++-v3/testsuite/27_io/filebuf_virtuals.cc", "status": "modified", "additions": 41, "deletions": 0, "changes": 41, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/130cd3e1df2476eda6e01c82ace326db4f85e24e/libstdc%2B%2B-v3%2Ftestsuite%2F27_io%2Ffilebuf_virtuals.cc", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/130cd3e1df2476eda6e01c82ace326db4f85e24e/libstdc%2B%2B-v3%2Ftestsuite%2F27_io%2Ffilebuf_virtuals.cc", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libstdc%2B%2B-v3%2Ftestsuite%2F27_io%2Ffilebuf_virtuals.cc?ref=130cd3e1df2476eda6e01c82ace326db4f85e24e", "patch": "@@ -584,6 +584,46 @@ void test09()\n   VERIFY( r == filebuf::traits_type::eof() );\n }\n \n+class Cvt_to_upper : public std::codecvt<char, char, mbstate_t>\n+{\n+  bool do_always_noconv() const throw()\n+  {\n+    return false;\n+  }\n+};\n+\n+// libstdc++/9169\n+void test10()\n+{\n+  using namespace std;\n+  bool test = true;\n+\n+  locale c_loc;\n+  locale loc(c_loc, new Cvt_to_upper);\n+\n+  string str(\"abcdefghijklmnopqrstuvwxyz\");\n+  string tmp;\n+\n+  {\n+    ofstream out;\n+    out.imbue(loc);\n+    out.open(\"filebuf_virtuals-4.txt\");\n+    copy(str.begin(), str.end(),\n+\t ostreambuf_iterator<char>(out));\n+  }\n+\n+  {\n+    ifstream in;\n+    in.open(\"filebuf_virtuals-4.txt\");\n+    copy(istreambuf_iterator<char>(in),\n+\t istreambuf_iterator<char>(),\n+\t back_inserter(tmp));\n+  }\n+\n+  VERIFY( tmp.size() == str.size() );\n+  VERIFY( tmp == str );\n+}\n+\n main() \n {\n   test01();\n@@ -597,5 +637,6 @@ main()\n   test07();\n   test08();\n   test09();\n+  test10();\n   return 0;\n }"}]}