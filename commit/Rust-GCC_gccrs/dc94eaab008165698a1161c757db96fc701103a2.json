{"sha": "dc94eaab008165698a1161c757db96fc701103a2", "node_id": "C_kwDOANBUbNoAKGRjOTRlYWFiMDA4MTY1Njk4YTExNjFjNzU3ZGI5NmZjNzAxMTAzYTI", "commit": {"author": {"name": "Jonathan Wakely", "email": "jwakely@redhat.com", "date": "2022-12-12T12:51:49Z"}, "committer": {"name": "Jonathan Wakely", "email": "jwakely@redhat.com", "date": "2022-12-12T14:00:09Z"}, "message": "libstdc++: Add a test checking for chrono::duration overflows\n\nThis test fails if chrono::days::rep or chrono::years::rep is a 32-bit\ntype, because a large days or years value silently overflows a 32-bit\ninteger when converted to seconds. It would be conforming to implement\nchrono::days as chrono::duration<int32_t, ratio<86400>>, but would make\nthis overflow case more likely. Similarly for chrono::years,\nchrono::months and chrono::weeks. This test is here to remind us not to\nmake that change lightly.\n\nlibstdc++-v3/ChangeLog:\n\n\t* testsuite/20_util/duration/arithmetic/overflow_c++20.cc: New\n\ttest.", "tree": {"sha": "3d1790f6c527846af0f7d932343eef4c467a50b6", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/3d1790f6c527846af0f7d932343eef4c467a50b6"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/dc94eaab008165698a1161c757db96fc701103a2", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/dc94eaab008165698a1161c757db96fc701103a2", "html_url": "https://github.com/Rust-GCC/gccrs/commit/dc94eaab008165698a1161c757db96fc701103a2", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/dc94eaab008165698a1161c757db96fc701103a2/comments", "author": {"login": "jwakely", "id": 1254480, "node_id": "MDQ6VXNlcjEyNTQ0ODA=", "avatar_url": "https://avatars.githubusercontent.com/u/1254480?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jwakely", "html_url": "https://github.com/jwakely", "followers_url": "https://api.github.com/users/jwakely/followers", "following_url": "https://api.github.com/users/jwakely/following{/other_user}", "gists_url": "https://api.github.com/users/jwakely/gists{/gist_id}", "starred_url": "https://api.github.com/users/jwakely/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jwakely/subscriptions", "organizations_url": "https://api.github.com/users/jwakely/orgs", "repos_url": "https://api.github.com/users/jwakely/repos", "events_url": "https://api.github.com/users/jwakely/events{/privacy}", "received_events_url": "https://api.github.com/users/jwakely/received_events", "type": "User", "site_admin": false}, "committer": {"login": "jwakely", "id": 1254480, "node_id": "MDQ6VXNlcjEyNTQ0ODA=", "avatar_url": "https://avatars.githubusercontent.com/u/1254480?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jwakely", "html_url": "https://github.com/jwakely", "followers_url": "https://api.github.com/users/jwakely/followers", "following_url": "https://api.github.com/users/jwakely/following{/other_user}", "gists_url": "https://api.github.com/users/jwakely/gists{/gist_id}", "starred_url": "https://api.github.com/users/jwakely/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jwakely/subscriptions", "organizations_url": "https://api.github.com/users/jwakely/orgs", "repos_url": "https://api.github.com/users/jwakely/repos", "events_url": "https://api.github.com/users/jwakely/events{/privacy}", "received_events_url": "https://api.github.com/users/jwakely/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "6c0f9584013dbedeacacb041d40ce9005b902df0", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/6c0f9584013dbedeacacb041d40ce9005b902df0", "html_url": "https://github.com/Rust-GCC/gccrs/commit/6c0f9584013dbedeacacb041d40ce9005b902df0"}], "stats": {"total": 29, "additions": 29, "deletions": 0}, "files": [{"sha": "42fa7ea55fbe0c9791fea79f2d0fc78cfc65efac", "filename": "libstdc++-v3/testsuite/20_util/duration/arithmetic/overflow_c++20.cc", "status": "added", "additions": 29, "deletions": 0, "changes": 29, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/dc94eaab008165698a1161c757db96fc701103a2/libstdc%2B%2B-v3%2Ftestsuite%2F20_util%2Fduration%2Farithmetic%2Foverflow_c%2B%2B20.cc", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/dc94eaab008165698a1161c757db96fc701103a2/libstdc%2B%2B-v3%2Ftestsuite%2F20_util%2Fduration%2Farithmetic%2Foverflow_c%2B%2B20.cc", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libstdc%2B%2B-v3%2Ftestsuite%2F20_util%2Fduration%2Farithmetic%2Foverflow_c%2B%2B20.cc?ref=dc94eaab008165698a1161c757db96fc701103a2", "patch": "@@ -0,0 +1,29 @@\n+// { dg-options \"-std=gnu++20\" }\n+// { dg-do run { target c++20 } }\n+\n+#include <chrono>\n+#include <cstdint>\n+#include <testsuite_hooks.h>\n+\n+void\n+test_overflow()\n+{\n+  using namespace std::chrono;\n+\n+  using seconds32_t = duration<std::int_least32_t>;\n+  seconds32_t t = 14h + 25min + 55s;\n+  auto snow = sys_days(1854y/December/11);\n+  auto snow_t = snow + t;\n+  // Fails if days::rep is 32-bit:\n+  VERIFY( snow_t.time_since_epoch() < seconds::zero() );\n+  auto y = floor<years>(snow);\n+  auto y_t = y + t;\n+  // Fails if years::rep is 32-bit:\n+  VERIFY( y_t.time_since_epoch() < seconds::zero() );\n+  VERIFY( y_t < snow_t );\n+}\n+\n+int main()\n+{\n+  test_overflow();\n+}"}]}