{"sha": "8e4ca4fcffbe6d3855f67cd02e0bb2a40d62fa10", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6OGU0Y2E0ZmNmZmJlNmQzODU1ZjY3Y2QwMmUwYmIyYTQwZDYyZmExMA==", "commit": {"author": {"name": "Ed Schonberg", "email": "schonberg@adacore.com", "date": "2019-08-12T09:01:43Z"}, "committer": {"name": "Pierre-Marie de Rodat", "email": "pmderodat@gcc.gnu.org", "date": "2019-08-12T09:01:43Z"}, "message": "[Ada] Crash on illegal left-hand side in assignment of renamed variable\n\nThis patch fixes a crash on an assignment where the left-hand side is a\nrenaming of a function call that does not involve ceiling priorities.\nThis avoids a compiler crash in some cases, and prevents a useless\nretrieval and compilation of run-time packages.\n\n2019-08-12  Ed Schonberg  <schonberg@adacore.com>\n\ngcc/ada/\n\n\t* sem_util.adb (Is_Expaned_Priority_Attribute): Check whether\n\tcall comes from a rewritten attribute before comparing name with\n\tGet_Ceiling run-time subprogram.\n\ngcc/testsuite/\n\n\t* gnat.dg/renaming15.adb: New testcase.\n\nFrom-SVN: r274305", "tree": {"sha": "27d718c27b20a3167293c49845c134957c325ed9", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/27d718c27b20a3167293c49845c134957c325ed9"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/8e4ca4fcffbe6d3855f67cd02e0bb2a40d62fa10", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/8e4ca4fcffbe6d3855f67cd02e0bb2a40d62fa10", "html_url": "https://github.com/Rust-GCC/gccrs/commit/8e4ca4fcffbe6d3855f67cd02e0bb2a40d62fa10", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/8e4ca4fcffbe6d3855f67cd02e0bb2a40d62fa10/comments", "author": {"login": "Edschonberg", "id": 6352375, "node_id": "MDQ6VXNlcjYzNTIzNzU=", "avatar_url": "https://avatars.githubusercontent.com/u/6352375?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Edschonberg", "html_url": "https://github.com/Edschonberg", "followers_url": "https://api.github.com/users/Edschonberg/followers", "following_url": "https://api.github.com/users/Edschonberg/following{/other_user}", "gists_url": "https://api.github.com/users/Edschonberg/gists{/gist_id}", "starred_url": "https://api.github.com/users/Edschonberg/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Edschonberg/subscriptions", "organizations_url": "https://api.github.com/users/Edschonberg/orgs", "repos_url": "https://api.github.com/users/Edschonberg/repos", "events_url": "https://api.github.com/users/Edschonberg/events{/privacy}", "received_events_url": "https://api.github.com/users/Edschonberg/received_events", "type": "User", "site_admin": false}, "committer": null, "parents": [{"sha": "fba9fcae321660fdc760fd293d92970e52489706", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/fba9fcae321660fdc760fd293d92970e52489706", "html_url": "https://github.com/Rust-GCC/gccrs/commit/fba9fcae321660fdc760fd293d92970e52489706"}], "stats": {"total": 43, "additions": 43, "deletions": 0}, "files": [{"sha": "74ceb50653c9ad6d8a066cc6b929484b46fab931", "filename": "gcc/ada/ChangeLog", "status": "modified", "additions": 6, "deletions": 0, "changes": 6, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/8e4ca4fcffbe6d3855f67cd02e0bb2a40d62fa10/gcc%2Fada%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/8e4ca4fcffbe6d3855f67cd02e0bb2a40d62fa10/gcc%2Fada%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fada%2FChangeLog?ref=8e4ca4fcffbe6d3855f67cd02e0bb2a40d62fa10", "patch": "@@ -1,3 +1,9 @@\n+2019-08-12  Ed Schonberg  <schonberg@adacore.com>\n+\n+\t* sem_util.adb (Is_Expaned_Priority_Attribute): Check whether\n+\tcall comes from a rewritten attribute before comparing name with\n+\tGet_Ceiling run-time subprogram.\n+\n 2019-08-12  Eric Botcazou  <ebotcazou@adacore.com>\n \n \t* exp_util.ads (Component_May_Be_Bit_Aligned): Small comment"}, {"sha": "54ac0a416152f487cc3e7b89003332ae0c028916", "filename": "gcc/ada/sem_util.adb", "status": "modified", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/8e4ca4fcffbe6d3855f67cd02e0bb2a40d62fa10/gcc%2Fada%2Fsem_util.adb", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/8e4ca4fcffbe6d3855f67cd02e0bb2a40d62fa10/gcc%2Fada%2Fsem_util.adb", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fada%2Fsem_util.adb?ref=8e4ca4fcffbe6d3855f67cd02e0bb2a40d62fa10", "patch": "@@ -14669,6 +14669,7 @@ package body Sem_Util is\n       return\n         Nkind (E) = N_Function_Call\n           and then not Configurable_Run_Time_Mode\n+          and then Nkind (Original_Node (E)) = N_Attribute_Reference\n           and then (Entity (Name (E)) = RTE (RE_Get_Ceiling)\n                      or else Entity (Name (E)) = RTE (RO_PE_Get_Ceiling));\n    end Is_Expanded_Priority_Attribute;"}, {"sha": "9c1bd07b3f9eb8aa657a4fd5d1f60a61782b082c", "filename": "gcc/testsuite/ChangeLog", "status": "modified", "additions": 4, "deletions": 0, "changes": 4, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/8e4ca4fcffbe6d3855f67cd02e0bb2a40d62fa10/gcc%2Ftestsuite%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/8e4ca4fcffbe6d3855f67cd02e0bb2a40d62fa10/gcc%2Ftestsuite%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2FChangeLog?ref=8e4ca4fcffbe6d3855f67cd02e0bb2a40d62fa10", "patch": "@@ -1,3 +1,7 @@\n+2019-08-12  Ed Schonberg  <schonberg@adacore.com>\n+\n+\t* gnat.dg/renaming15.adb: New testcase.\n+\n 2019-08-12  Eric Botcazou  <ebotcazou@adacore.com>\n \n \t* gnat.dg/slice10.adb: New testcase."}, {"sha": "a0b13cdea81054025a663b4bbaa1d86fe404742b", "filename": "gcc/testsuite/gnat.dg/renaming15.adb", "status": "added", "additions": 32, "deletions": 0, "changes": 32, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/8e4ca4fcffbe6d3855f67cd02e0bb2a40d62fa10/gcc%2Ftestsuite%2Fgnat.dg%2Frenaming15.adb", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/8e4ca4fcffbe6d3855f67cd02e0bb2a40d62fa10/gcc%2Ftestsuite%2Fgnat.dg%2Frenaming15.adb", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgnat.dg%2Frenaming15.adb?ref=8e4ca4fcffbe6d3855f67cd02e0bb2a40d62fa10", "patch": "@@ -0,0 +1,32 @@\n+--  { dg-do compile }\n+\n+with Ada.Containers.Hashed_Maps;\n+with Ada.Text_IO;\n+\n+procedure Renaming15 is\n+   use Ada.Containers;\n+\n+   subtype String_T is String (1 .. 3);\n+\n+   function Hash (Aircraft_Id : Integer) return Hash_Type is\n+       (Hash_Type (Aircraft_Id) * (2 ** 31 - 1));\n+   function Equal (Left, Right : Integer) return Boolean is (Left = Right);\n+   package Radar_Map is new Hashed_Maps (Integer, String_T, Hash, Equal);\n+\n+   Radars : Radar_Map.Map;\n+\n+   procedure Change_Elem_Value is\n+   begin\n+      for C in Radars.Iterate loop\n+         declare\n+            E : String_T renames Radar_Map.Element (C);\n+         begin\n+            E := \"Xyz\";  --  { dg-error \"left hand side of assignment must be a variable\" }\n+            Ada.Text_IO.Put_Line (E);\n+         end;\n+      end loop;\n+   end Change_Elem_Value;\n+begin\n+   Radars.Include (1, \"jjj\");\n+   Change_Elem_Value;\n+end Renaming15;"}]}