{"sha": "c190b0e65fe62e9fe58a8a04c6695a263da90161", "node_id": "C_kwDOANBUbNoAKGMxOTBiMGU2NWZlNjJlOWZlNThhOGEwNGM2Njk1YTI2M2RhOTAxNjE", "commit": {"author": {"name": "Sebastian Huber", "email": "sebastian.huber@embedded-brains.de", "date": "2022-03-30T19:59:43Z"}, "committer": {"name": "Sebastian Huber", "email": "sebastian.huber@embedded-brains.de", "date": "2022-04-28T18:46:49Z"}, "message": "gcov: Move gcov_open() to caller of read_gcda_file()\n\nThis allows to reuse read_gcda_file() to read multiple objects from a single\nfile.\n\nlibgcc/\n\n\t* libgcov-util.c (read_gcda_file): Do not open file.\n\t(ftw_read_file): Open file here.", "tree": {"sha": "789475d41faa3cdb8541770a7f1e90ae53a12574", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/789475d41faa3cdb8541770a7f1e90ae53a12574"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/c190b0e65fe62e9fe58a8a04c6695a263da90161", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/c190b0e65fe62e9fe58a8a04c6695a263da90161", "html_url": "https://github.com/Rust-GCC/gccrs/commit/c190b0e65fe62e9fe58a8a04c6695a263da90161", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/c190b0e65fe62e9fe58a8a04c6695a263da90161/comments", "author": {"login": "sebhub", "id": 932056, "node_id": "MDQ6VXNlcjkzMjA1Ng==", "avatar_url": "https://avatars.githubusercontent.com/u/932056?v=4", "gravatar_id": "", "url": "https://api.github.com/users/sebhub", "html_url": "https://github.com/sebhub", "followers_url": "https://api.github.com/users/sebhub/followers", "following_url": "https://api.github.com/users/sebhub/following{/other_user}", "gists_url": "https://api.github.com/users/sebhub/gists{/gist_id}", "starred_url": "https://api.github.com/users/sebhub/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/sebhub/subscriptions", "organizations_url": "https://api.github.com/users/sebhub/orgs", "repos_url": "https://api.github.com/users/sebhub/repos", "events_url": "https://api.github.com/users/sebhub/events{/privacy}", "received_events_url": "https://api.github.com/users/sebhub/received_events", "type": "User", "site_admin": false}, "committer": {"login": "sebhub", "id": 932056, "node_id": "MDQ6VXNlcjkzMjA1Ng==", "avatar_url": "https://avatars.githubusercontent.com/u/932056?v=4", "gravatar_id": "", "url": "https://api.github.com/users/sebhub", "html_url": "https://github.com/sebhub", "followers_url": "https://api.github.com/users/sebhub/followers", "following_url": "https://api.github.com/users/sebhub/following{/other_user}", "gists_url": "https://api.github.com/users/sebhub/gists{/gist_id}", "starred_url": "https://api.github.com/users/sebhub/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/sebhub/subscriptions", "organizations_url": "https://api.github.com/users/sebhub/orgs", "repos_url": "https://api.github.com/users/sebhub/repos", "events_url": "https://api.github.com/users/sebhub/events{/privacy}", "received_events_url": "https://api.github.com/users/sebhub/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "76cae6482e0e618d1f8709b3c5d14642378281c7", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/76cae6482e0e618d1f8709b3c5d14642378281c7", "html_url": "https://github.com/Rust-GCC/gccrs/commit/76cae6482e0e618d1f8709b3c5d14642378281c7"}], "stats": {"total": 16, "additions": 7, "deletions": 9}, "files": [{"sha": "6093a74531d974d9f3bfdfe591f61dd022a90f3b", "filename": "libgcc/libgcov-util.c", "status": "modified", "additions": 7, "deletions": 9, "changes": 16, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/c190b0e65fe62e9fe58a8a04c6695a263da90161/libgcc%2Flibgcov-util.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/c190b0e65fe62e9fe58a8a04c6695a263da90161/libgcc%2Flibgcov-util.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libgcc%2Flibgcov-util.c?ref=c190b0e65fe62e9fe58a8a04c6695a263da90161", "patch": "@@ -268,17 +268,10 @@ read_gcda_file (const char *filename)\n     k_ctrs_mask[i] = 0;\n   k_ctrs_types = 0;\n \n-  if (!gcov_open (filename, 1))\n-    {\n-      fnotice (stderr, \"%s:cannot open\\n\", filename);\n-      return NULL;\n-    }\n-\n   /* Read magic.  */\n   if (!gcov_magic (gcov_read_unsigned (), GCOV_DATA_MAGIC))\n     {\n       fnotice (stderr, \"%s:not a gcov data file\\n\", filename);\n-      gcov_close ();\n       return NULL;\n     }\n \n@@ -287,7 +280,6 @@ read_gcda_file (const char *filename)\n   if (version != GCOV_VERSION)\n     {\n       fnotice (stderr, \"%s:incorrect gcov version %d vs %d \\n\", filename, version, GCOV_VERSION);\n-      gcov_close ();\n       return NULL;\n     }\n \n@@ -379,7 +371,6 @@ read_gcda_file (const char *filename)\n     }\n \n   read_gcda_finalize (obj_info);\n-  gcov_close ();\n \n   return obj_info;\n }\n@@ -412,7 +403,14 @@ ftw_read_file (const char *filename,\n   if (verbose)\n     fnotice (stderr, \"reading file: %s\\n\", filename);\n \n+  if (!gcov_open (filename, 1))\n+    {\n+      fnotice (stderr, \"%s:cannot open\\n\", filename);\n+      return 0;\n+    }\n+\n   (void)read_gcda_file (xstrdup (filename));\n+  gcov_close ();\n \n   return 0;\n }"}]}