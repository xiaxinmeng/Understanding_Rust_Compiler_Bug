{"sha": "3e9a6d29ee9a531db04b65652274f073ad1f1f1e", "node_id": "C_kwDOANBUbNoAKDNlOWE2ZDI5ZWU5YTUzMWRiMDRiNjU2NTIyNzRmMDczYWQxZjFmMWU", "commit": {"author": {"name": "Yannick Moy", "email": "moy@adacore.com", "date": "2022-05-09T13:26:22Z"}, "committer": {"name": "Pierre-Marie de Rodat", "email": "derodat@adacore.com", "date": "2022-06-01T08:43:20Z"}, "message": "[Ada] Allow confirming volatile properties on No_Caching variables\n\nVolatile variables marked with the No_Caching aspect can now have\nconfirming aspects for other volatile properties, with a value of\nFalse.\n\ngcc/ada/\n\n\t* contracts.adb (Check_Type_Or_Object_External_Properties): Check\n\tthe validity of combinations only when No_Caching is not used.\n\t* sem_prag.adb (Analyze_External_Property_In_Decl_Part): Check\n\tvalid combinations with No_Caching.", "tree": {"sha": "0799fd7b43d0a726ab062c1c889dad47a4591ac7", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/0799fd7b43d0a726ab062c1c889dad47a4591ac7"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/3e9a6d29ee9a531db04b65652274f073ad1f1f1e", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/3e9a6d29ee9a531db04b65652274f073ad1f1f1e", "html_url": "https://github.com/Rust-GCC/gccrs/commit/3e9a6d29ee9a531db04b65652274f073ad1f1f1e", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/3e9a6d29ee9a531db04b65652274f073ad1f1f1e/comments", "author": {"login": "yannickmoy", "id": 859440, "node_id": "MDQ6VXNlcjg1OTQ0MA==", "avatar_url": "https://avatars.githubusercontent.com/u/859440?v=4", "gravatar_id": "", "url": "https://api.github.com/users/yannickmoy", "html_url": "https://github.com/yannickmoy", "followers_url": "https://api.github.com/users/yannickmoy/followers", "following_url": "https://api.github.com/users/yannickmoy/following{/other_user}", "gists_url": "https://api.github.com/users/yannickmoy/gists{/gist_id}", "starred_url": "https://api.github.com/users/yannickmoy/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/yannickmoy/subscriptions", "organizations_url": "https://api.github.com/users/yannickmoy/orgs", "repos_url": "https://api.github.com/users/yannickmoy/repos", "events_url": "https://api.github.com/users/yannickmoy/events{/privacy}", "received_events_url": "https://api.github.com/users/yannickmoy/received_events", "type": "User", "site_admin": false}, "committer": {"login": "pmderodat", "id": 758452, "node_id": "MDQ6VXNlcjc1ODQ1Mg==", "avatar_url": "https://avatars.githubusercontent.com/u/758452?v=4", "gravatar_id": "", "url": "https://api.github.com/users/pmderodat", "html_url": "https://github.com/pmderodat", "followers_url": "https://api.github.com/users/pmderodat/followers", "following_url": "https://api.github.com/users/pmderodat/following{/other_user}", "gists_url": "https://api.github.com/users/pmderodat/gists{/gist_id}", "starred_url": "https://api.github.com/users/pmderodat/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/pmderodat/subscriptions", "organizations_url": "https://api.github.com/users/pmderodat/orgs", "repos_url": "https://api.github.com/users/pmderodat/repos", "events_url": "https://api.github.com/users/pmderodat/events{/privacy}", "received_events_url": "https://api.github.com/users/pmderodat/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "6b4239f61bbd205643fc394f6bac7e7fc174aaea", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/6b4239f61bbd205643fc394f6bac7e7fc174aaea", "html_url": "https://github.com/Rust-GCC/gccrs/commit/6b4239f61bbd205643fc394f6bac7e7fc174aaea"}], "stats": {"total": 55, "additions": 30, "deletions": 25}, "files": [{"sha": "1081b981e4f10a95624058c1123e4112a1e5df2c", "filename": "gcc/ada/contracts.adb", "status": "modified", "additions": 9, "deletions": 3, "changes": 12, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/3e9a6d29ee9a531db04b65652274f073ad1f1f1e/gcc%2Fada%2Fcontracts.adb", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/3e9a6d29ee9a531db04b65652274f073ad1f1f1e/gcc%2Fada%2Fcontracts.adb", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fada%2Fcontracts.adb?ref=3e9a6d29ee9a531db04b65652274f073ad1f1f1e", "patch": "@@ -892,9 +892,15 @@ package body Contracts is\n          end;\n       end if;\n \n-      --  Verify the mutual interaction of the various external properties\n-\n-      if Seen then\n+      --  Verify the mutual interaction of the various external properties.\n+      --  For variables for which No_Caching is enabled, it has been checked\n+      --  already that only False values for other external properties are\n+      --  allowed.\n+\n+      if Seen\n+        and then (Ekind (Type_Or_Obj_Id) /= E_Variable\n+                   or else not No_Caching_Enabled (Type_Or_Obj_Id))\n+      then\n          Check_External_Properties\n            (Type_Or_Obj_Id, AR_Val, AW_Val, ER_Val, EW_Val);\n       end if;"}, {"sha": "20c90b1af17bfafe0367311e633930bf691adb2e", "filename": "gcc/ada/sem_prag.adb", "status": "modified", "additions": 21, "deletions": 22, "changes": 43, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/3e9a6d29ee9a531db04b65652274f073ad1f1f1e/gcc%2Fada%2Fsem_prag.adb", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/3e9a6d29ee9a531db04b65652274f073ad1f1f1e/gcc%2Fada%2Fsem_prag.adb", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fada%2Fsem_prag.adb?ref=3e9a6d29ee9a531db04b65652274f073ad1f1f1e", "patch": "@@ -2139,11 +2139,24 @@ package body Sem_Prag is\n       Expr     : Node_Id;\n \n    begin\n-      --  Do not analyze the pragma multiple times, but set the output\n-      --  parameter to the argument specified by the pragma.\n+      --  Ensure that the Boolean expression (if present) is static. A missing\n+      --  argument defaults the value to True (SPARK RM 7.1.2(5)).\n+\n+      Expr_Val := True;\n+\n+      if Present (Arg1) then\n+         Expr := Get_Pragma_Arg (Arg1);\n+\n+         if Is_OK_Static_Expression (Expr) then\n+            Expr_Val := Is_True (Expr_Value (Expr));\n+         end if;\n+      end if;\n+\n+      --  The output parameter was set to the argument specified by the pragma.\n+      --  Do not analyze the pragma multiple times.\n \n       if Is_Analyzed_Pragma (N) then\n-         goto Leave;\n+         return;\n       end if;\n \n       Error_Msg_Name_1 := Pragma_Name (N);\n@@ -2163,9 +2176,11 @@ package body Sem_Prag is\n          if Ekind (Obj_Id) = E_Variable\n            and then No_Caching_Enabled (Obj_Id)\n          then\n-            SPARK_Msg_N\n-              (\"illegal combination of external property % and property \"\n-               & \"\"\"No_Caching\"\" (SPARK RM 7.1.2(6))\", N);\n+            if Expr_Val then  --  Confirming value of False is allowed\n+               SPARK_Msg_N\n+                 (\"illegal combination of external property % and property \"\n+                  & \"\"\"No_Caching\"\" (SPARK RM 7.1.2(6))\", N);\n+            end if;\n          else\n             SPARK_Msg_N\n               (\"external property % must apply to a volatile type or object\",\n@@ -2185,22 +2200,6 @@ package body Sem_Prag is\n       end if;\n \n       Set_Is_Analyzed_Pragma (N);\n-\n-      <<Leave>>\n-\n-      --  Ensure that the Boolean expression (if present) is static. A missing\n-      --  argument defaults the value to True (SPARK RM 7.1.2(5)).\n-\n-      Expr_Val := True;\n-\n-      if Present (Arg1) then\n-         Expr := Get_Pragma_Arg (Arg1);\n-\n-         if Is_OK_Static_Expression (Expr) then\n-            Expr_Val := Is_True (Expr_Value (Expr));\n-         end if;\n-      end if;\n-\n    end Analyze_External_Property_In_Decl_Part;\n \n    ---------------------------------"}]}