{"sha": "a0e887be6147edcd14a5b95af17456d0a01575d4", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6YTBlODg3YmU2MTQ3ZWRjZDE0YTViOTVhZjE3NDU2ZDBhMDE1NzVkNA==", "commit": {"author": {"name": "Iain Sandoe", "email": "iain@sandoe.co.uk", "date": "2019-10-09T18:43:36Z"}, "committer": {"name": "Iain Sandoe", "email": "iains@gcc.gnu.org", "date": "2019-10-09T18:43:36Z"}, "message": "[Darwin, machopic 3/n] Set a SYMBOL flag for indirections.\n\nWe are able to treat these specially where needed in legitimate address\ntests (specifically, they are guaranteed to be pointer-aligned).\n\ngcc/ChangeLog:\n\n2019-10-09  Iain Sandoe  <iain@sandoe.co.uk>\n\n\t* config/darwin.c (machopic_indirect_data_reference): Set flag to\n\tindicate that the new symbol is an indirection.\n\t(machopic_indirect_call_target): Likewise.\n\t* config/darwin.h (MACHO_SYMBOL_FLAG_INDIRECTION): New.\n\t(MACHO_SYMBOL_INDIRECTION_P): New.\n\t(MACHO_SYMBOL_FLAG_STATIC): Adjust bit number.\n\nFrom-SVN: r276767", "tree": {"sha": "614da0f4385ce7194462750a99f97fb117b32032", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/614da0f4385ce7194462750a99f97fb117b32032"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/a0e887be6147edcd14a5b95af17456d0a01575d4", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/a0e887be6147edcd14a5b95af17456d0a01575d4", "html_url": "https://github.com/Rust-GCC/gccrs/commit/a0e887be6147edcd14a5b95af17456d0a01575d4", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/a0e887be6147edcd14a5b95af17456d0a01575d4/comments", "author": {"login": "iains", "id": 4039407, "node_id": "MDQ6VXNlcjQwMzk0MDc=", "avatar_url": "https://avatars.githubusercontent.com/u/4039407?v=4", "gravatar_id": "", "url": "https://api.github.com/users/iains", "html_url": "https://github.com/iains", "followers_url": "https://api.github.com/users/iains/followers", "following_url": "https://api.github.com/users/iains/following{/other_user}", "gists_url": "https://api.github.com/users/iains/gists{/gist_id}", "starred_url": "https://api.github.com/users/iains/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/iains/subscriptions", "organizations_url": "https://api.github.com/users/iains/orgs", "repos_url": "https://api.github.com/users/iains/repos", "events_url": "https://api.github.com/users/iains/events{/privacy}", "received_events_url": "https://api.github.com/users/iains/received_events", "type": "User", "site_admin": false}, "committer": {"login": "iains", "id": 4039407, "node_id": "MDQ6VXNlcjQwMzk0MDc=", "avatar_url": "https://avatars.githubusercontent.com/u/4039407?v=4", "gravatar_id": "", "url": "https://api.github.com/users/iains", "html_url": "https://github.com/iains", "followers_url": "https://api.github.com/users/iains/followers", "following_url": "https://api.github.com/users/iains/following{/other_user}", "gists_url": "https://api.github.com/users/iains/gists{/gist_id}", "starred_url": "https://api.github.com/users/iains/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/iains/subscriptions", "organizations_url": "https://api.github.com/users/iains/orgs", "repos_url": "https://api.github.com/users/iains/repos", "events_url": "https://api.github.com/users/iains/events{/privacy}", "received_events_url": "https://api.github.com/users/iains/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "e295e3d981355c61b72eca2ee58864958655cc31", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/e295e3d981355c61b72eca2ee58864958655cc31", "html_url": "https://github.com/Rust-GCC/gccrs/commit/e295e3d981355c61b72eca2ee58864958655cc31"}], "stats": {"total": 20, "additions": 19, "deletions": 1}, "files": [{"sha": "e66d06583913c4d87da7d16ddd1f0089cc0c2472", "filename": "gcc/ChangeLog", "status": "modified", "additions": 9, "deletions": 0, "changes": 9, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/a0e887be6147edcd14a5b95af17456d0a01575d4/gcc%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/a0e887be6147edcd14a5b95af17456d0a01575d4/gcc%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2FChangeLog?ref=a0e887be6147edcd14a5b95af17456d0a01575d4", "patch": "@@ -1,3 +1,12 @@\n+2019-10-09  Iain Sandoe  <iain@sandoe.co.uk>\n+\n+\t* config/darwin.c (machopic_indirect_data_reference): Set flag to\n+\tindicate that the new symbol is an indirection.\n+\t(machopic_indirect_call_target): Likewise.\n+\t* config/darwin.h (MACHO_SYMBOL_FLAG_INDIRECTION): New.\n+\t(MACHO_SYMBOL_INDIRECTION_P): New.\n+\t(MACHO_SYMBOL_FLAG_STATIC): Adjust bit number.\n+\n 2019-10-08  Jason Merrill  <jason@redhat.com>\n \n \t* doc/invoke.texi: Document -fconcepts-ts."}, {"sha": "35d0444b5cd5f5e6657decde2b3b979424cb6aa9", "filename": "gcc/config/darwin.c", "status": "modified", "additions": 2, "deletions": 0, "changes": 2, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/a0e887be6147edcd14a5b95af17456d0a01575d4/gcc%2Fconfig%2Fdarwin.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/a0e887be6147edcd14a5b95af17456d0a01575d4/gcc%2Fconfig%2Fdarwin.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fconfig%2Fdarwin.c?ref=a0e887be6147edcd14a5b95af17456d0a01575d4", "patch": "@@ -707,6 +707,7 @@ machopic_indirect_data_reference (rtx orig, rtx reg)\n \t\t  machopic_indirection_name (orig, /*stub_p=*/false)));\n \n       SYMBOL_REF_DATA (ptr_ref) = SYMBOL_REF_DATA (orig);\n+      SYMBOL_REF_FLAGS (ptr_ref) |= MACHO_SYMBOL_FLAG_INDIRECTION;\n \n       ptr_ref = gen_const_mem (Pmode, ptr_ref);\n       machopic_define_symbol (ptr_ref);\n@@ -806,6 +807,7 @@ machopic_indirect_call_target (rtx target)\n \n       XEXP (target, 0) = gen_rtx_SYMBOL_REF (mode, stub_name);\n       SYMBOL_REF_DATA (XEXP (target, 0)) = SYMBOL_REF_DATA (sym_ref);\n+      SYMBOL_REF_FLAGS (XEXP (target, 0)) |= MACHO_SYMBOL_FLAG_INDIRECTION;\n       MEM_READONLY_P (target) = 1;\n       MEM_NOTRAP_P (target) = 1;\n     }"}, {"sha": "f331fa1aa89f9742debee4d76678de7d82dead51", "filename": "gcc/config/darwin.h", "status": "modified", "additions": 8, "deletions": 1, "changes": 9, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/a0e887be6147edcd14a5b95af17456d0a01575d4/gcc%2Fconfig%2Fdarwin.h", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/a0e887be6147edcd14a5b95af17456d0a01575d4/gcc%2Fconfig%2Fdarwin.h", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fconfig%2Fdarwin.h?ref=a0e887be6147edcd14a5b95af17456d0a01575d4", "patch": "@@ -843,12 +843,19 @@ extern GTY(()) section * darwin_sections[NUM_DARWIN_SECTIONS];\n #define MACHO_SYMBOL_HIDDEN_VIS_P(RTX) \\\n   ((SYMBOL_REF_FLAGS (RTX) & MACHO_SYMBOL_FLAG_HIDDEN_VIS) != 0)\n \n+/* Set on a symbol that is a pic stub or symbol indirection (i.e. the\n+   L_xxxxx${stub,non_lazy_ptr,lazy_ptr}.  */\n+\n+#define MACHO_SYMBOL_FLAG_INDIRECTION ((SYMBOL_FLAG_SUBT_DEP) << 5)\n+#define MACHO_SYMBOL_INDIRECTION_P(RTX) \\\n+  ((SYMBOL_REF_FLAGS (RTX) & MACHO_SYMBOL_FLAG_INDIRECTION) != 0)\n+\n /* Set on a symbol to indicate when fix-and-continue style code\n    generation is being used and the symbol refers to a static symbol\n    that should be rebound from new instances of a translation unit to\n    the original instance of the data.  */\n \n-#define MACHO_SYMBOL_FLAG_STATIC ((SYMBOL_FLAG_SUBT_DEP) << 5)\n+#define MACHO_SYMBOL_FLAG_STATIC ((SYMBOL_FLAG_SUBT_DEP) << 6)\n #define MACHO_SYMBOL_STATIC_P(RTX) \\\n   ((SYMBOL_REF_FLAGS (RTX) & MACHO_SYMBOL_FLAG_STATIC) != 0)\n "}]}