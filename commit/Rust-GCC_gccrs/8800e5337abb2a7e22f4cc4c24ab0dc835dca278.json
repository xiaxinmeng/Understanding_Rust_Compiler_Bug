{"sha": "8800e5337abb2a7e22f4cc4c24ab0dc835dca278", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6ODgwMGU1MzM3YWJiMmE3ZTIyZjRjYzRjMjRhYjBkYzgzNWRjYTI3OA==", "commit": {"author": {"name": "Hans-Peter Nilsson", "email": "hp@bitrange.com", "date": "2004-09-13T21:20:12Z"}, "committer": {"name": "Hans-Peter Nilsson", "email": "hp@gcc.gnu.org", "date": "2004-09-13T21:20:12Z"}, "message": "gcc-defs.exp: Load wrapper.exp.\n\n\t* lib/gcc-defs.exp: Load wrapper.exp.\n\t* lib/g++.exp (g++_init): Call g++_maybe_build_wrapper instead of\n\tusing local code.\n\t* lib/gcc.exp (gcc_init): Similar.\n\t* lib/gfortran.exp (gfortran_init): Similar.\n\t* lib/objc.exp (objc_init): Similar.\n\t* lib/treelang.exp (treelang_init): Similar.\n\t* lib/wrapper.exp: New file with build_wrapper call machinery in\n\t${tool}_maybe_build_wrapper.\n\nFrom-SVN: r87451", "tree": {"sha": "de0d3ebc37f5abf6a2ac64bcb89f39d9586bc58e", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/de0d3ebc37f5abf6a2ac64bcb89f39d9586bc58e"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/8800e5337abb2a7e22f4cc4c24ab0dc835dca278", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/8800e5337abb2a7e22f4cc4c24ab0dc835dca278", "html_url": "https://github.com/Rust-GCC/gccrs/commit/8800e5337abb2a7e22f4cc4c24ab0dc835dca278", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/8800e5337abb2a7e22f4cc4c24ab0dc835dca278/comments", "author": null, "committer": null, "parents": [{"sha": "61f4f1cc3d363590bec97bc8fb035064d617bd73", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/61f4f1cc3d363590bec97bc8fb035064d617bd73", "html_url": "https://github.com/Rust-GCC/gccrs/commit/61f4f1cc3d363590bec97bc8fb035064d617bd73"}], "stats": {"total": 124, "additions": 68, "deletions": 56}, "files": [{"sha": "2fa43121cfc5929e1734508e7bbbfa478222cd9a", "filename": "gcc/testsuite/ChangeLog", "status": "modified", "additions": 12, "deletions": 0, "changes": 12, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/8800e5337abb2a7e22f4cc4c24ab0dc835dca278/gcc%2Ftestsuite%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/8800e5337abb2a7e22f4cc4c24ab0dc835dca278/gcc%2Ftestsuite%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2FChangeLog?ref=8800e5337abb2a7e22f4cc4c24ab0dc835dca278", "patch": "@@ -1,3 +1,15 @@\n+2004-09-13  Hans-Peter Nilsson  <hp@bitrange.com>\n+\n+\t* lib/gcc-defs.exp: Load wrapper.exp.\n+\t* lib/g++.exp (g++_init): Call g++_maybe_build_wrapper instead of\n+\tusing local code.\n+\t* lib/gcc.exp (gcc_init): Similar.\n+\t* lib/gfortran.exp (gfortran_init): Similar.\n+\t* lib/objc.exp (objc_init): Similar.\n+\t* lib/treelang.exp (treelang_init): Similar.\n+\t* lib/wrapper.exp: New file with build_wrapper call machinery in\n+\t${tool}_maybe_build_wrapper.\n+\n 2004-09-13  Joseph S. Myers  <jsm@polyomino.org.uk>\n \n \t* gcc.dg/declspec-7.c: Don't expect diagnostic for duplicate"}, {"sha": "b863785ee38effc1f3f424e4f4c4b543aac79951", "filename": "gcc/testsuite/lib/g++.exp", "status": "modified", "additions": 2, "deletions": 11, "changes": 13, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/8800e5337abb2a7e22f4cc4c24ab0dc835dca278/gcc%2Ftestsuite%2Flib%2Fg%2B%2B.exp", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/8800e5337abb2a7e22f4cc4c24ab0dc835dca278/gcc%2Ftestsuite%2Flib%2Fg%2B%2B.exp", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Flib%2Fg%2B%2B.exp?ref=8800e5337abb2a7e22f4cc4c24ab0dc835dca278", "patch": "@@ -1,4 +1,4 @@\n-# Copyright (C) 1992, 1993, 1994, 1995, 1996, 1997, 2000, 2001, 2002, 2003\n+# Copyright (C) 1992, 1993, 1994, 1995, 1996, 1997, 2000, 2001, 2002, 2003, 2004\n # Free Software Foundation, Inc.\n \n # This program is free software; you can redistribute it and/or modify\n@@ -249,16 +249,7 @@ proc g++_init { args } {\n \tunset gluefile\n     }\n \n-    if { [target_info needs_status_wrapper] != \"\" } {\n-\tset gluefile ${tmpdir}/g++-testglue.o;\n-\tset result [build_wrapper $gluefile];\n-\tif { $result != \"\" } {\n-\t    set gluefile [lindex $result 0];\n-\t    set wrap_flags [lindex $result 1];\n-\t} else {\n-\t    unset gluefile\n-\t}\n-    }\n+    g++_maybe_build_wrapper \"${tmpdir}/g++-testglue.o\"\n \n     set ALWAYS_CXXFLAGS \"\"\n "}, {"sha": "740073fb8c83b5b34e8dc136adc860fefd370f26", "filename": "gcc/testsuite/lib/gcc-defs.exp", "status": "modified", "additions": 3, "deletions": 1, "changes": 4, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/8800e5337abb2a7e22f4cc4c24ab0dc835dca278/gcc%2Ftestsuite%2Flib%2Fgcc-defs.exp", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/8800e5337abb2a7e22f4cc4c24ab0dc835dca278/gcc%2Ftestsuite%2Flib%2Fgcc-defs.exp", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Flib%2Fgcc-defs.exp?ref=8800e5337abb2a7e22f4cc4c24ab0dc835dca278", "patch": "@@ -1,4 +1,4 @@\n-# Copyright (C) 2001, 2003 Free Software Foundation, Inc.\n+# Copyright (C) 2001, 2003, 2004 Free Software Foundation, Inc.\n \n # This program is free software; you can redistribute it and/or modify\n # it under the terms of the GNU General Public License as published by\n@@ -14,6 +14,8 @@\n # along with this program; if not, write to the Free Software\n # Foundation, 59 Temple Place - Suite 330, Boston, MA 02111-1307, USA.\n \n+load_lib wrapper.exp\n+\n #\n # ${tool}_check_compile -- Reports and returns pass/fail for a compilation\n #"}, {"sha": "2f55338766689218dbec6bc53dd0bdb7f9e16af6", "filename": "gcc/testsuite/lib/gcc.exp", "status": "modified", "additions": 3, "deletions": 13, "changes": 16, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/8800e5337abb2a7e22f4cc4c24ab0dc835dca278/gcc%2Ftestsuite%2Flib%2Fgcc.exp", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/8800e5337abb2a7e22f4cc4c24ab0dc835dca278/gcc%2Ftestsuite%2Flib%2Fgcc.exp", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Flib%2Fgcc.exp?ref=8800e5337abb2a7e22f4cc4c24ab0dc835dca278", "patch": "@@ -1,4 +1,4 @@\n-# Copyright (C) 1992, 1993, 1994, 1996, 1997, 1999, 2000, 2001, 2003 Free Software Foundation, Inc.\n+# Copyright (C) 1992, 1993, 1994, 1996, 1997, 1999, 2000, 2001, 2003, 2004 Free Software Foundation, Inc.\n \n # This program is free software; you can redistribute it and/or modify\n # it under the terms of the GNU General Public License as published by\n@@ -106,18 +106,8 @@ proc gcc_init { args } {\n     if ![info exists tmpdir] then {\n \tset tmpdir /tmp\n     }\n-    if {[target_info needs_status_wrapper] != \"\" && \\\n-\t    [target_info needs_status_wrapper] != \"0\" && \\\n-\t    ![info exists gluefile]} {\n-\tset gluefile ${tmpdir}/gcc-testglue.o;\n-\tset result [build_wrapper $gluefile];\n-\tif { $result != \"\" } {\n-\t    set gluefile [lindex $result 0];\n-\t    set wrap_flags [lindex $result 1];\n-\t} else {\n-\t    unset gluefile\n-\t}\n-    }\n+\n+    gcc_maybe_build_wrapper \"${tmpdir}/gcc-testglue.o\"\n }\n \n #"}, {"sha": "07787cc5bcced7cf2fa4262eccabe8c8297d9c86", "filename": "gcc/testsuite/lib/gfortran.exp", "status": "modified", "additions": 1, "deletions": 10, "changes": 11, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/8800e5337abb2a7e22f4cc4c24ab0dc835dca278/gcc%2Ftestsuite%2Flib%2Fgfortran.exp", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/8800e5337abb2a7e22f4cc4c24ab0dc835dca278/gcc%2Ftestsuite%2Flib%2Fgfortran.exp", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Flib%2Fgfortran.exp?ref=8800e5337abb2a7e22f4cc4c24ab0dc835dca278", "patch": "@@ -187,16 +187,7 @@ proc gfortran_init { args } {\n \tunset gluefile\n     }\n \n-    if { [target_info needs_status_wrapper] != \"\" } {\n-\tset gluefile ${tmpdir}/gfortran-testglue.o;\n-\tset result [build_wrapper $gluefile];\n-\tif { $result != \"\" } {\n-\t    set gluefile [lindex $result 0];\n-\t    set wrap_flags [lindex $result 1];\n-\t} else {\n-\t    unset gluefile\n-\t}\n-    }\n+    gfortran_maybe_build_wrapper \"${tmpdir}/gfortran-testglue.o\"\n \n     set ALWAYS_GFORTRANFLAGS \"\"\n "}, {"sha": "d75cf1aaf8bbc63fe44e28d40f075df95583cb20", "filename": "gcc/testsuite/lib/objc.exp", "status": "modified", "additions": 3, "deletions": 11, "changes": 14, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/8800e5337abb2a7e22f4cc4c24ab0dc835dca278/gcc%2Ftestsuite%2Flib%2Fobjc.exp", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/8800e5337abb2a7e22f4cc4c24ab0dc835dca278/gcc%2Ftestsuite%2Flib%2Fobjc.exp", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Flib%2Fobjc.exp?ref=8800e5337abb2a7e22f4cc4c24ab0dc835dca278", "patch": "@@ -1,4 +1,4 @@\n-# Copyright (C) 1992, 1993, 1994, 1996, 1997, 2000, 2001, 2002\n+# Copyright (C) 1992, 1993, 1994, 1996, 1997, 2000, 2001, 2002, 2004\n # Free Software Foundation, Inc.\n \n # This program is free software; you can redistribute it and/or modify\n@@ -107,16 +107,8 @@ proc objc_init { args } {\n     if ![info exists tmpdir] then {\n \tset tmpdir /tmp\n     }\n-    if { [target_info needs_status_wrapper]!=\"\" && ![info exists gluefile] } {\n-\tset gluefile ${tmpdir}/objc-testglue.o;\n-\tset result [build_wrapper $gluefile];\n-\tif { $result != \"\" } {\n-\t    set gluefile [lindex $result 0];\n-\t    set wrap_flags [lindex $result 1];\n-\t} else {\n-\t    unset gluefile\n-\t}\n-    }\n+\n+    objc_maybe_build_wrapper \"${tmpdir}/objc-testglue.o\"\n \n     set objc_libgcc_s_path \"${rootme}\"\n     set compiler [lindex $OBJC_UNDER_TEST 0]"}, {"sha": "94bb8a0b115bbd0d1c6f7cbb68113bd9d93d32d0", "filename": "gcc/testsuite/lib/treelang.exp", "status": "modified", "additions": 2, "deletions": 10, "changes": 12, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/8800e5337abb2a7e22f4cc4c24ab0dc835dca278/gcc%2Ftestsuite%2Flib%2Ftreelang.exp", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/8800e5337abb2a7e22f4cc4c24ab0dc835dca278/gcc%2Ftestsuite%2Flib%2Ftreelang.exp", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Flib%2Ftreelang.exp?ref=8800e5337abb2a7e22f4cc4c24ab0dc835dca278", "patch": "@@ -104,16 +104,8 @@ proc treelang_init { args } {\n     if ![info exists tmpdir] then {\n \tset tmpdir /tmp\n     }\n-    if { [target_info needs_status_wrapper]!=\"\" && ![info exists gluefile] } {\n-\tset gluefile ${tmpdir}/treelang-testglue.o;\n-\tset result [build_wrapper $gluefile];\n-\tif { $result != \"\" } {\n-\t    set gluefile [lindex $result 0];\n-\t    set wrap_flags [lindex $result 1];\n-\t} else {\n-\t    unset gluefile\n-\t}\n-    }\n+\n+    treelang_maybe_build_wrapper \"${tmpdir}/treelang-testglue.o\"\n \n     set treelang_libgcc_s_path \"${rootme}\"\n     set compiler [lindex $TREELANG_UNDER_TEST 0]"}, {"sha": "6dd990ce8fcf3c658787f37b57c377e723fdc8e0", "filename": "gcc/testsuite/lib/wrapper.exp", "status": "added", "additions": 42, "deletions": 0, "changes": 42, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/8800e5337abb2a7e22f4cc4c24ab0dc835dca278/gcc%2Ftestsuite%2Flib%2Fwrapper.exp", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/8800e5337abb2a7e22f4cc4c24ab0dc835dca278/gcc%2Ftestsuite%2Flib%2Fwrapper.exp", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Flib%2Fwrapper.exp?ref=8800e5337abb2a7e22f4cc4c24ab0dc835dca278", "patch": "@@ -0,0 +1,42 @@\n+#   Copyright (C) 2004 Free Software Foundation, Inc.\n+\n+# This program is free software; you can redistribute it and/or modify\n+# it under the terms of the GNU General Public License as published by\n+# the Free Software Foundation; either version 2 of the License, or\n+# (at your option) any later version.\n+# \n+# This program is distributed in the hope that it will be useful,\n+# but WITHOUT ANY WARRANTY; without even the implied warranty of\n+# MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n+# GNU General Public License for more details.\n+# \n+# You should have received a copy of the GNU General Public License\n+# along with this program; if not, write to the Free Software\n+# Foundation, Inc., 59 Temple Place - Suite 330, Boston, MA 02111-1307, USA.  \n+\n+# This file contains GCC-specifics for status wrappers for test programs.\n+\n+# ${tool}_maybe_build_wrapper -- Build wrapper object if the target needs it.\n+\n+proc ${tool}_maybe_build_wrapper { filename } {\n+    global gluefile wrap_flags\n+\n+    if { [target_info needs_status_wrapper] != \"\" \\\n+ \t && [target_info needs_status_wrapper] != \"0\" \\\n+\t && ![info exists gluefile] } {\n+\tset saved_wrap_compile_flags [target_info wrap_compile_flags]\n+\t# The wrapper code may contain code that gcc objects on.  This\n+\t# became true for dejagnu-1.4.4.  The set of warnings and code\n+\t# that gcc objects on may change, so just make sure -w is always\n+\t# passed to turn off all warnings.\n+\tset_currtarget_info wrap_compile_flags \"$saved_wrap_compile_flags -w\"\n+\tset result [build_wrapper $filename];\n+\tset_currtarget_info wrap_compile_flags \"$saved_wrap_compile_flags\"\n+\tif { $result != \"\" } {\n+\t    set gluefile [lindex $result 0];\n+\t    set wrap_flags [lindex $result 1];\n+\t} else {\n+\t    unset gluefile\n+\t}\n+    }\n+}"}]}