{"sha": "12651dc6dcaafb3c8a5cdfc10b7bc25e6f62cb33", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6MTI2NTFkYzZkY2FhZmIzYzhhNWNkZmMxMGI3YmMyNWU2ZjYyY2IzMw==", "commit": {"author": {"name": "Jan Hubicka", "email": "hubicka@ucw.cz", "date": "2019-12-10T17:46:33Z"}, "committer": {"name": "Jan Hubicka", "email": "hubicka@gcc.gnu.org", "date": "2019-12-10T17:46:33Z"}, "message": "varasm.c (default_function_section): Fix confused tests for tp_first_run reordering.\n\n\t* varasm.c (default_function_section): Fix confused tests for\n\ttp_first_run reordering.\n\nFrom-SVN: r279176", "tree": {"sha": "bc81f13c4fcb1f14bd0321ba983a29e262dff723", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/bc81f13c4fcb1f14bd0321ba983a29e262dff723"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/12651dc6dcaafb3c8a5cdfc10b7bc25e6f62cb33", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/12651dc6dcaafb3c8a5cdfc10b7bc25e6f62cb33", "html_url": "https://github.com/Rust-GCC/gccrs/commit/12651dc6dcaafb3c8a5cdfc10b7bc25e6f62cb33", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/12651dc6dcaafb3c8a5cdfc10b7bc25e6f62cb33/comments", "author": null, "committer": null, "parents": [{"sha": "91fd16a7bddb7d0f63d7b4b4038b4a9eb8787678", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/91fd16a7bddb7d0f63d7b4b4038b4a9eb8787678", "html_url": "https://github.com/Rust-GCC/gccrs/commit/91fd16a7bddb7d0f63d7b4b4038b4a9eb8787678"}], "stats": {"total": 20, "additions": 13, "deletions": 7}, "files": [{"sha": "627d1bc0d718a685b3ca26fc374bf11b3715e39c", "filename": "gcc/ChangeLog", "status": "modified", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/12651dc6dcaafb3c8a5cdfc10b7bc25e6f62cb33/gcc%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/12651dc6dcaafb3c8a5cdfc10b7bc25e6f62cb33/gcc%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2FChangeLog?ref=12651dc6dcaafb3c8a5cdfc10b7bc25e6f62cb33", "patch": "@@ -1,3 +1,8 @@\n+2019-12-10  Jan Hubicka  <hubicka@ucw.cz>\n+\n+\t* varasm.c (default_function_section): Fix confused tests for\n+\ttp_first_run reordering.\n+\n 2019-12-10  Richard Sandiford  <richard.sandiford@arm.com>\n \n \t* config/aarch64/aarch64.c (aarch64_hard_regno_mode_ok): Don't"}, {"sha": "f6ed0eadf1f1b8348838c3cda6f91237815ad7f9", "filename": "gcc/varasm.c", "status": "modified", "additions": 8, "deletions": 7, "changes": 15, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/12651dc6dcaafb3c8a5cdfc10b7bc25e6f62cb33/gcc%2Fvarasm.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/12651dc6dcaafb3c8a5cdfc10b7bc25e6f62cb33/gcc%2Fvarasm.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fvarasm.c?ref=12651dc6dcaafb3c8a5cdfc10b7bc25e6f62cb33", "patch": "@@ -589,9 +589,13 @@ default_function_section (tree decl, enum node_frequency freq,\n      where we can split away unnecessary parts of static constructors.  */\n   if (startup && freq != NODE_FREQUENCY_UNLIKELY_EXECUTED)\n   {\n-    /* If we do have a profile or(and) LTO phase is executed, we do not need\n-       these ELF section.  */\n-    if (!in_lto_p || !flag_profile_values)\n+    /* During LTO the tp_first_run profiling will naturally place all\n+       initialization code first.  Using separate section is counter-productive\n+       because startup only code may call functions which are no longer\n+       startup only.  */\n+    if (!in_lto_p\n+        || !cgraph_node::get (decl)->tp_first_run\n+\t|| !opt_for_fn (decl, flag_profile_reorder_functions))\n       return get_named_text_section (decl, \".text.startup\", NULL);\n     else\n       return NULL;\n@@ -607,10 +611,7 @@ default_function_section (tree decl, enum node_frequency freq,\n       case NODE_FREQUENCY_UNLIKELY_EXECUTED:\n \treturn get_named_text_section (decl, \".text.unlikely\", NULL);\n       case NODE_FREQUENCY_HOT:\n-        /* If we do have a profile or(and) LTO phase is executed, we do not need\n-           these ELF section.  */\n-        if (!in_lto_p || !flag_profile_values)\n-          return get_named_text_section (decl, \".text.hot\", NULL);\n+        return get_named_text_section (decl, \".text.hot\", NULL);\n \t/* FALLTHRU */\n       default:\n \treturn NULL;"}]}