{"sha": "907cdc7fad039a88c619a92107186ef03b9a816f", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6OTA3Y2RjN2ZhZDAzOWE4OGM2MTlhOTIxMDcxODZlZjAzYjlhODE2Zg==", "commit": {"author": {"name": "Michael Koch", "email": "konqueror@gmx.de", "date": "2004-01-06T08:34:58Z"}, "committer": {"name": "Michael Koch", "email": "mkoch@gcc.gnu.org", "date": "2004-01-06T08:34:58Z"}, "message": "2004-01-06  Michael Koch  <konqueror@gmx.de>\n\n\t* java/lang/Package.java\n\t(getPackage): Get the current class loader directly.\n\t* java/lang/SecurityManager.java\n\t(currentLoadedClass): Dont iterate over class contexts.\n\t(classLoaderDepth): Don't check class loaders if everything is allowed.\n\nFrom-SVN: r75465", "tree": {"sha": "f3b23a77c72b7ec64fcadda0eeb7832c2f9626b5", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/f3b23a77c72b7ec64fcadda0eeb7832c2f9626b5"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/907cdc7fad039a88c619a92107186ef03b9a816f", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/907cdc7fad039a88c619a92107186ef03b9a816f", "html_url": "https://github.com/Rust-GCC/gccrs/commit/907cdc7fad039a88c619a92107186ef03b9a816f", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/907cdc7fad039a88c619a92107186ef03b9a816f/comments", "author": null, "committer": null, "parents": [{"sha": "24746a428d28ff8398075c9be46cef326db45740", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/24746a428d28ff8398075c9be46cef326db45740", "html_url": "https://github.com/Rust-GCC/gccrs/commit/24746a428d28ff8398075c9be46cef326db45740"}], "stats": {"total": 35, "additions": 24, "deletions": 11}, "files": [{"sha": "c97afbc4084f301357cc14330245a966e3e5b5ec", "filename": "libjava/ChangeLog", "status": "modified", "additions": 8, "deletions": 0, "changes": 8, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/907cdc7fad039a88c619a92107186ef03b9a816f/libjava%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/907cdc7fad039a88c619a92107186ef03b9a816f/libjava%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libjava%2FChangeLog?ref=907cdc7fad039a88c619a92107186ef03b9a816f", "patch": "@@ -1,3 +1,11 @@\n+2004-01-06  Michael Koch  <konqueror@gmx.de>\n+\n+\t* java/lang/Package.java\n+\t(getPackage): Get the current class loader directly.\n+\t* java/lang/SecurityManager.java\n+\t(currentLoadedClass): Dont iterate over class contexts.\n+\t(classLoaderDepth): Don't check class loaders if everything is allowed.\n+\n 2004-01-05  Thomas Fitzsimmons  <fitzsim@redhat.com>\n \n \t* jni/gtk-peer/gnu_java_awt_peer_gtk_GtkEvents.c"}, {"sha": "3045b50c2f16baa101f33752cdcc67b18745820c", "filename": "libjava/java/lang/Package.java", "status": "modified", "additions": 1, "deletions": 2, "changes": 3, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/907cdc7fad039a88c619a92107186ef03b9a816f/libjava%2Fjava%2Flang%2FPackage.java", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/907cdc7fad039a88c619a92107186ef03b9a816f/libjava%2Fjava%2Flang%2FPackage.java", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libjava%2Fjava%2Flang%2FPackage.java?ref=907cdc7fad039a88c619a92107186ef03b9a816f", "patch": "@@ -269,8 +269,7 @@ else if (spec > vers)\n   public static Package getPackage(String name)\n   {\n     // Get the caller's classloader\n-    Class c = VMSecurityManager.getClassContext()[1];\n-    ClassLoader cl = c.getClassLoader();\n+    ClassLoader cl = VMSecurityManager.currentClassLoader();\n     return cl != null ? cl.getPackage(name) : null;\n   }\n "}, {"sha": "bec39de1cd4d4a8f2cd473cbb64f51b990713dce", "filename": "libjava/java/lang/SecurityManager.java", "status": "modified", "additions": 15, "deletions": 9, "changes": 24, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/907cdc7fad039a88c619a92107186ef03b9a816f/libjava%2Fjava%2Flang%2FSecurityManager.java", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/907cdc7fad039a88c619a92107186ef03b9a816f/libjava%2Fjava%2Flang%2FSecurityManager.java", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libjava%2Fjava%2Flang%2FSecurityManager.java?ref=907cdc7fad039a88c619a92107186ef03b9a816f", "patch": "@@ -207,11 +207,8 @@ protected ClassLoader currentClassLoader()\n    */\n   protected Class currentLoadedClass()\n   {\n-    Class[] c = getClassContext();\n-    for (int i = 0; i < c.length; i++)\n-      if (c[i].getClassLoader() != null)\n-\treturn c[i];\n-    return null;\n+    int i = classLoaderDepth();\n+    return i >= 0 ? getClassContext()[i] : null;\n   }\n \n   /**\n@@ -247,10 +244,18 @@ protected int classDepth(String className)\n    */\n   protected int classLoaderDepth()\n   {\n-    Class[] c = getClassContext();\n-    for (int i = 0; i < c.length; i++)\n-      if (c[i].getClassLoader() != null)\n-\treturn i;\n+    try\n+      {\n+        checkPermission(new AllPermission());\n+      }\n+    catch (SecurityException e)\n+      {\n+        Class[] c = getClassContext();\n+        for (int i = 0; i < c.length; i++)\n+          if (c[i].getClassLoader() != null)\n+            // XXX Check if c[i] is AccessController, or a system class.\n+            return i;\n+      }\n     return -1;\n   }\n \n@@ -1016,6 +1021,7 @@ void checkPackageList(String packageName, String restriction,\n         for (int index = list.indexOf(packageName);\n              index != -1; index = list.indexOf(packageName, index + 1))\n           {\n+            // Exploit package visibility for speed.\n \t    int packageNameCount = packageName.length();\n             if (index + packageNameCount == list.length()\n                 || list.charAt(index + packageNameCount) == ',')"}]}