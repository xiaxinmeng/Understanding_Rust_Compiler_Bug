{"sha": "3c2a70cb1414b10ab3d52286087398cd03a70413", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6M2MyYTcwY2IxNDE0YjEwYWIzZDUyMjg2MDg3Mzk4Y2QwM2E3MDQxMw==", "commit": {"author": {"name": "Martin Sebor", "email": "msebor@redhat.com", "date": "2019-02-22T16:24:36Z"}, "committer": {"name": "Martin Sebor", "email": "msebor@gcc.gnu.org", "date": "2019-02-22T16:24:36Z"}, "message": "PR c/89425 - -Wabsolute-value warns in dead subexpressions\n\ngcc/c/ChangeLog:\n\n\tPR c/89425\n\t* c-parser.c (sizeof_ptr_memacc_comptypes): Avoid warning in\n\tunreachable subexpressions.\n\ngcc/testsuite/ChangeLog:\n\n\tPR c/89425\n\t* gcc.dg/Wabsolute-value.c: New test.\n\nFrom-SVN: r269121", "tree": {"sha": "34bd4615f175e082208c635ea524cf2c610a5199", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/34bd4615f175e082208c635ea524cf2c610a5199"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/3c2a70cb1414b10ab3d52286087398cd03a70413", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/3c2a70cb1414b10ab3d52286087398cd03a70413", "html_url": "https://github.com/Rust-GCC/gccrs/commit/3c2a70cb1414b10ab3d52286087398cd03a70413", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/3c2a70cb1414b10ab3d52286087398cd03a70413/comments", "author": {"login": "msebor", "id": 381149, "node_id": "MDQ6VXNlcjM4MTE0OQ==", "avatar_url": "https://avatars.githubusercontent.com/u/381149?v=4", "gravatar_id": "", "url": "https://api.github.com/users/msebor", "html_url": "https://github.com/msebor", "followers_url": "https://api.github.com/users/msebor/followers", "following_url": "https://api.github.com/users/msebor/following{/other_user}", "gists_url": "https://api.github.com/users/msebor/gists{/gist_id}", "starred_url": "https://api.github.com/users/msebor/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/msebor/subscriptions", "organizations_url": "https://api.github.com/users/msebor/orgs", "repos_url": "https://api.github.com/users/msebor/repos", "events_url": "https://api.github.com/users/msebor/events{/privacy}", "received_events_url": "https://api.github.com/users/msebor/received_events", "type": "User", "site_admin": false}, "committer": null, "parents": [{"sha": "d228ac9ae52cc33ea572da89f325f8aeebd9eb32", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/d228ac9ae52cc33ea572da89f325f8aeebd9eb32", "html_url": "https://github.com/Rust-GCC/gccrs/commit/d228ac9ae52cc33ea572da89f325f8aeebd9eb32"}], "stats": {"total": 70, "additions": 70, "deletions": 0}, "files": [{"sha": "42ed0dca5b00bba7748ec732bd2a864f3e14add1", "filename": "gcc/ChangeLog", "status": "modified", "additions": 6, "deletions": 0, "changes": 6, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/3c2a70cb1414b10ab3d52286087398cd03a70413/gcc%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/3c2a70cb1414b10ab3d52286087398cd03a70413/gcc%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2FChangeLog?ref=3c2a70cb1414b10ab3d52286087398cd03a70413", "patch": "@@ -1,3 +1,9 @@\n+2019-02-22  Martin Sebor  <msebor@redhat.com>\n+\n+\tPR c/89425\n+\t* c-parser.c (sizeof_ptr_memacc_comptypes): Avoid warning in\n+\tunreachable subexpressions.\n+\n 2019-02-22  H.J. Lu  <hongjiu.lu@intel.com>\n \t    Hongtao Liu  <hongtao.liu@intel.com>\n \t    Sunil K Pandey  <sunil.k.pandey@intel.com>"}, {"sha": "ee722cc9df90065b9edb25764e1699e322d12ba1", "filename": "gcc/c/c-parser.c", "status": "modified", "additions": 4, "deletions": 0, "changes": 4, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/3c2a70cb1414b10ab3d52286087398cd03a70413/gcc%2Fc%2Fc-parser.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/3c2a70cb1414b10ab3d52286087398cd03a70413/gcc%2Fc%2Fc-parser.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fc%2Fc-parser.c?ref=3c2a70cb1414b10ab3d52286087398cd03a70413", "patch": "@@ -9374,6 +9374,10 @@ sizeof_ptr_memacc_comptypes (tree type1, tree type2)\n static void\n warn_for_abs (location_t loc, tree fndecl, tree arg)\n {\n+  /* Avoid warning in unreachable subexpressions.  */\n+  if (c_inhibit_evaluation_warnings)\n+    return;\n+\n   tree atype = TREE_TYPE (arg);\n \n   /* Casts from pointers (and thus arrays and fndecls) will generate"}, {"sha": "8c8f4a5e3fdeb0b602590c12d6c56bb5c68e5537", "filename": "gcc/testsuite/ChangeLog", "status": "modified", "additions": 3, "deletions": 0, "changes": 3, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/3c2a70cb1414b10ab3d52286087398cd03a70413/gcc%2Ftestsuite%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/3c2a70cb1414b10ab3d52286087398cd03a70413/gcc%2Ftestsuite%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2FChangeLog?ref=3c2a70cb1414b10ab3d52286087398cd03a70413", "patch": "@@ -1,5 +1,8 @@\n 2019-02-22  Martin Sebor  <msebor@redhat.com>\n \n+\tPR c/89425\n+\t* gcc.dg/Wabsolute-value.c: New test.\n+\n \t* gcc.dg/Wbuiltin-declaration-mismatch-12.c: New test.\n \n 2019-02-22  H.J. Lu  <hongjiu.lu@intel.com>"}, {"sha": "e3717f9b94881decce1f23d5282e35920547662a", "filename": "gcc/testsuite/gcc.dg/Wabsolute-value.c", "status": "added", "additions": 57, "deletions": 0, "changes": 57, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/3c2a70cb1414b10ab3d52286087398cd03a70413/gcc%2Ftestsuite%2Fgcc.dg%2FWabsolute-value.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/3c2a70cb1414b10ab3d52286087398cd03a70413/gcc%2Ftestsuite%2Fgcc.dg%2FWabsolute-value.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgcc.dg%2FWabsolute-value.c?ref=3c2a70cb1414b10ab3d52286087398cd03a70413", "patch": "@@ -0,0 +1,57 @@\n+/* PR c/89425 - -Wabsolute-value warns in dead subexpressions\n+   { dg-do compile }\n+   { dg-options \"-Wabsolute-value -ftrack-macro-expansion=0\" } */\n+\n+struct Vals\n+{\n+  signed char sc;\n+  signed short ss;\n+  signed int si;\n+  signed long sl;\n+  signed long long sll;\n+\n+  unsigned char uc;\n+  unsigned short us;\n+  unsigned int ui;\n+  unsigned long ul;\n+  unsigned long long ull;\n+\n+  float f;\n+  double d;\n+  long double ld;\n+};\n+\n+#define abs(x)     __builtin_abs (x)\n+#define labs(x)    __builtin_labs (x)\n+#define llabs(x)   __builtin_llabs (x)\n+\n+#define fabsf(x)   __builtin_fabsf (x)\n+#define fabs(x)    __builtin_fabs (x)\n+\n+\n+void tst_warn (struct Vals *p)\n+{\n+  /* Verify that \"-Wabsolute-value is issued for subexpressions\n+     that are evaluated.  */\n+\n+  p->uc =  0 ? abs (p->sc) : abs (p->uc);         /* { dg-warning \"\\\\\\[-Wabsolute-value]\" } */\n+  p->us =  0 ? abs (p->ss) : abs (p->us);         /* { dg-warning \"\\\\\\[-Wabsolute-value]\" } */\n+  p->ui =  0 ? abs (p->si) : abs (p->ui);         /* { dg-warning \"\\\\\\[-Wabsolute-value]\" } */\n+  p->ul =  0 ? labs (p->sl) : labs (p->ul);       /* { dg-warning \"\\\\\\[-Wabsolute-value]\" } */\n+  p->ull = 0 ? llabs (p->sll) : llabs (p->ull);   /* { dg-warning \"\\\\\\[-Wabsolute-value]\" } */\n+\n+  p->d   = 0 ? fabs (p->d) : fabsf (p->d);        /* { dg-warning \"\\\\\\[-Wabsolute-value]\" } */\n+}\n+\n+void tst_no_warn (struct Vals *p)\n+{\n+  /* Verify that \"-Wabsolute-value is not issued for subexpressions\n+     that are not evaluated.  */\n+\n+  p->uc =  0 ? abs (p->uc) : abs (p->sc);\n+  p->us =  0 ? abs (p->us) : abs (p->ss);\n+  p->ui =  0 ? abs (p->ui) : abs (p->si);\n+  p->ul =  0 ? labs (p->ul) : labs (p->sl);\n+  p->ull = 0 ? llabs (p->ull) : llabs (p->sll);\n+  p->d   = 0 ? fabsf (p->d) : fabs (p->d);\n+}"}]}