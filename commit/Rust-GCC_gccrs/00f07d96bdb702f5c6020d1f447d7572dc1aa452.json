{"sha": "00f07d96bdb702f5c6020d1f447d7572dc1aa452", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6MDBmMDdkOTZiZGI3MDJmNWM2MDIwZDFmNDQ3ZDc1NzJkYzFhYTQ1Mg==", "commit": {"author": {"name": "Dale Ranta", "email": "dir@lanl.gov", "date": "2005-04-03T08:07:43Z"}, "committer": {"name": "Fran\u00e7ois-Xavier Coudert", "email": "fxcoudert@gcc.gnu.org", "date": "2005-04-03T08:07:43Z"}, "message": "re PR libfortran/20068 (Backspace problems)\n\n\tPR libfortran/20068\n\tPR libfortran/20125\n\tPR libfortran/20156\n\tPR libfortran/20471\n\n\t* io/backspace.c (unformatted_backspace): Fix error in arithmetic.\n\t(st_backspace): When in WRITING mode, we flush and falling back\n\tinto READING mode. In all cases, correctly position the stream.\n\n\t* gfortran.dg/backspace.f: New test.\n\nCo-Authored-By: Francois-Xavier Coudert <coudert@clipper.ens.fr>\n\nFrom-SVN: r97478", "tree": {"sha": "1d304b753d205a7b07e5e32e0562a965e1ae648b", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/1d304b753d205a7b07e5e32e0562a965e1ae648b"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/00f07d96bdb702f5c6020d1f447d7572dc1aa452", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/00f07d96bdb702f5c6020d1f447d7572dc1aa452", "html_url": "https://github.com/Rust-GCC/gccrs/commit/00f07d96bdb702f5c6020d1f447d7572dc1aa452", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/00f07d96bdb702f5c6020d1f447d7572dc1aa452/comments", "author": null, "committer": {"login": "fxcoudert", "id": 1980544, "node_id": "MDQ6VXNlcjE5ODA1NDQ=", "avatar_url": "https://avatars.githubusercontent.com/u/1980544?v=4", "gravatar_id": "", "url": "https://api.github.com/users/fxcoudert", "html_url": "https://github.com/fxcoudert", "followers_url": "https://api.github.com/users/fxcoudert/followers", "following_url": "https://api.github.com/users/fxcoudert/following{/other_user}", "gists_url": "https://api.github.com/users/fxcoudert/gists{/gist_id}", "starred_url": "https://api.github.com/users/fxcoudert/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/fxcoudert/subscriptions", "organizations_url": "https://api.github.com/users/fxcoudert/orgs", "repos_url": "https://api.github.com/users/fxcoudert/repos", "events_url": "https://api.github.com/users/fxcoudert/events{/privacy}", "received_events_url": "https://api.github.com/users/fxcoudert/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "25af5506aab83668a1d7c0e1efbe88f2b0de3dfb", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/25af5506aab83668a1d7c0e1efbe88f2b0de3dfb", "html_url": "https://github.com/Rust-GCC/gccrs/commit/25af5506aab83668a1d7c0e1efbe88f2b0de3dfb"}], "stats": {"total": 117, "additions": 113, "deletions": 4}, "files": [{"sha": "612dcab58956c5fa94904eb6e303a96a47e692a3", "filename": "gcc/testsuite/ChangeLog", "status": "modified", "additions": 9, "deletions": 0, "changes": 9, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/00f07d96bdb702f5c6020d1f447d7572dc1aa452/gcc%2Ftestsuite%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/00f07d96bdb702f5c6020d1f447d7572dc1aa452/gcc%2Ftestsuite%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2FChangeLog?ref=00f07d96bdb702f5c6020d1f447d7572dc1aa452", "patch": "@@ -1,3 +1,12 @@\n+2005-04-03  Dale Ranta  <dir@lanl.gov>\n+            Francois-Xavier Coudert  <coudert@clipper.ens.fr>\n+\n+\tPR libfortran/20068\n+\tPR libfortran/20125\n+\tPR libfortran/20156\n+\tPR libfortran/20471\n+\t* gfortran.dg/backspace.f: New test.\n+\n 2005-04-02  Daniel Berlin  <dberlin@dberlin.org>\n \n \t* gcc.dg/pr19345.c: New test."}, {"sha": "ebf43f59f0f7199ba339ea4e7e28f2788b7aa6f2", "filename": "gcc/testsuite/gfortran.dg/backspace.f", "status": "added", "additions": 82, "deletions": 0, "changes": 82, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/00f07d96bdb702f5c6020d1f447d7572dc1aa452/gcc%2Ftestsuite%2Fgfortran.dg%2Fbackspace.f", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/00f07d96bdb702f5c6020d1f447d7572dc1aa452/gcc%2Ftestsuite%2Fgfortran.dg%2Fbackspace.f", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgfortran.dg%2Fbackspace.f?ref=00f07d96bdb702f5c6020d1f447d7572dc1aa452", "patch": "@@ -0,0 +1,82 @@\n+! This file is all about BACKSPACE\n+! {dg-do run}\n+\n+      integer i, n, nr\n+      real x(10), y(10)\n+\n+! PR libfortran/20068\n+      open (20, status='scratch')\n+      write (20,*) 1\n+      write (20,*) 2\n+      write (20,*) 3\n+      rewind (20)\n+      read (20,*) i\n+      if (i .ne. 1) call abort\n+      write (*,*) ' '\n+      backspace (20)\n+      read (20,*) i\n+      if (i .ne. 1) call abort\n+      close (20)\n+\n+! PR libfortran/20125\n+      open (20, status='scratch')\n+      write (20,*) 7\n+      backspace (20)\n+      read (20,*) i\n+      if (i .ne. 7) call abort\n+      close (20)\n+\n+      open (20, status='scratch', form='unformatted')\n+      write (20) 8\n+      backspace (20)\n+      read (20) i\n+      if (i .ne. 8) call abort\n+      close (20)\n+\n+! PR libfortran/20471\n+      do n = 1, 10\n+        x(n) = sqrt(real(n))\n+      end do\n+      open (3, form='unformatted', status='scratch')\n+      write (3) (x(n),n=1,10)\n+      backspace (3)\n+      rewind (3)\n+      read (3) (y(n),n=1,10)\n+\n+      do n = 1, 10\n+        if (abs(x(n)-y(n)) > 0.00001) call abort\n+      end do\n+      close (3)\n+\n+! PR libfortran/20156\n+      open (3, form='unformatted', status='scratch')\n+      do i = 1, 5\n+        x(1) = i\n+        write (3) n, (x(n),n=1,10)\n+      end do\n+      nr = 0\n+      rewind (3)\n+  20  continue\n+      read (3,end=30,err=90) n, (x(n),n=1,10)\n+      nr = nr + 1\n+      goto 20\n+  30  continue\n+      if (nr .ne. 5) call abort\n+\n+      do i = 1, nr+1\n+        backspace (3)\n+      end do\n+\n+      do i = 1, nr\n+        read(3,end=70,err=90) n, (x(n),n=1,10)\n+        if (abs(x(1) - i) .gt. 0.001) call abort\n+      end do\n+      close (3)\n+      stop\n+\n+  70  continue\n+      call abort\n+  90  continue\n+      call abort\n+\n+      end"}, {"sha": "ebcac0bb919365da9f9812d724aa690a1437add1", "filename": "libgfortran/ChangeLog", "status": "modified", "additions": 11, "deletions": 0, "changes": 11, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/00f07d96bdb702f5c6020d1f447d7572dc1aa452/libgfortran%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/00f07d96bdb702f5c6020d1f447d7572dc1aa452/libgfortran%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libgfortran%2FChangeLog?ref=00f07d96bdb702f5c6020d1f447d7572dc1aa452", "patch": "@@ -1,3 +1,14 @@\n+2005-04-03  Dale Ranta  <dir@lanl.gov>\n+            Francois-Xavier Coudert  <coudert@clipper.ens.fr>\n+\n+\tPR libfortran/20068\n+\tPR libfortran/20125\n+\tPR libfortran/20156\n+\tPR libfortran/20471\n+\t* io/backspace.c (unformatted_backspace): Fix error in arithmetic.\n+\t(st_backspace): When in WRITING mode, we flush and falling back\n+\tinto READING mode. In all cases, correctly position the stream.\n+\n 2005-03-31  Francois-Xavier Coudert  <coudert@clipper.ens.fr>\n \n \tPR libfortran/20660"}, {"sha": "225f69cc45a17ec5c86a4c184d8a4b7f529b4457", "filename": "libgfortran/io/backspace.c", "status": "modified", "additions": 11, "deletions": 4, "changes": 15, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/00f07d96bdb702f5c6020d1f447d7572dc1aa452/libgfortran%2Fio%2Fbackspace.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/00f07d96bdb702f5c6020d1f447d7572dc1aa452/libgfortran%2Fio%2Fbackspace.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libgfortran%2Fio%2Fbackspace.c?ref=00f07d96bdb702f5c6020d1f447d7572dc1aa452", "patch": "@@ -111,7 +111,7 @@ unformatted_backspace (void)\n   if (p == NULL)\n     goto io_error;\n \n-  new = file_position (current_unit->s) - *p - length;\n+  new = file_position (current_unit->s) - *p - 2*length;\n   if (sseek (current_unit->s, new) == FAILURE)\n     goto io_error;\n \n@@ -155,16 +155,23 @@ st_backspace (void)\n     u->endfile = AT_ENDFILE;\n   else\n     {\n-      if (u->current_record)\n-\tnext_record (1);\n-\n       if (file_position (u->s) == 0)\n \tgoto done;\t\t/* Common special case */\n \n+      if (u->mode == WRITING)\n+      {\n+\tflush (u->s);\n+\tstruncate (u->s);\n+\tu->mode = READING;\n+      }\n+\n       if (u->flags.form == FORM_FORMATTED)\n \tformatted_backspace ();\n       else\n \tunformatted_backspace ();\n+\n+      u->endfile = NO_ENDFILE;\n+      u->current_record = 0;\n     }\n \n  done:"}]}