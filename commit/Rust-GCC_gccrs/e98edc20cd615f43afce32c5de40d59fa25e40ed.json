{"sha": "e98edc20cd615f43afce32c5de40d59fa25e40ed", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6ZTk4ZWRjMjBjZDYxNWY0M2FmY2UzMmM1ZGU0MGQ1OWZhMjVlNDBlZA==", "commit": {"author": {"name": "Marc Glisse", "email": "marc.glisse@inria.fr", "date": "2018-07-26T12:01:14Z"}, "committer": {"name": "Marc Glisse", "email": "glisse@gcc.gnu.org", "date": "2018-07-26T12:01:14Z"}, "message": "optimize std::vector move assignment\n\n2018-07-26  Marc Glisse  <marc.glisse@inria.fr>\n\n\t* include/bits/stl_vector.h (_Vector_impl_data::_M_copy_data): New.\n\t(_Vector_impl_data::_M_swap_data): Use _M_copy_data.\n\t(vector::_M_move_assign): Reorder the swaps.\n\nFrom-SVN: r262998", "tree": {"sha": "d4eca073a640be7741bd0f6c125e5ff0df6da5ec", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/d4eca073a640be7741bd0f6c125e5ff0df6da5ec"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/e98edc20cd615f43afce32c5de40d59fa25e40ed", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/e98edc20cd615f43afce32c5de40d59fa25e40ed", "html_url": "https://github.com/Rust-GCC/gccrs/commit/e98edc20cd615f43afce32c5de40d59fa25e40ed", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/e98edc20cd615f43afce32c5de40d59fa25e40ed/comments", "author": {"login": "mglisse", "id": 10097863, "node_id": "MDQ6VXNlcjEwMDk3ODYz", "avatar_url": "https://avatars.githubusercontent.com/u/10097863?v=4", "gravatar_id": "", "url": "https://api.github.com/users/mglisse", "html_url": "https://github.com/mglisse", "followers_url": "https://api.github.com/users/mglisse/followers", "following_url": "https://api.github.com/users/mglisse/following{/other_user}", "gists_url": "https://api.github.com/users/mglisse/gists{/gist_id}", "starred_url": "https://api.github.com/users/mglisse/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/mglisse/subscriptions", "organizations_url": "https://api.github.com/users/mglisse/orgs", "repos_url": "https://api.github.com/users/mglisse/repos", "events_url": "https://api.github.com/users/mglisse/events{/privacy}", "received_events_url": "https://api.github.com/users/mglisse/received_events", "type": "User", "site_admin": false}, "committer": null, "parents": [{"sha": "88a4654d03d0d05047aa168e45967ed2d94cb9ce", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/88a4654d03d0d05047aa168e45967ed2d94cb9ce", "html_url": "https://github.com/Rust-GCC/gccrs/commit/88a4654d03d0d05047aa168e45967ed2d94cb9ce"}], "stats": {"total": 25, "additions": 21, "deletions": 4}, "files": [{"sha": "9704fd601493bb9a52a3e20c21d03804782f428a", "filename": "libstdc++-v3/ChangeLog", "status": "modified", "additions": 6, "deletions": 0, "changes": 6, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/e98edc20cd615f43afce32c5de40d59fa25e40ed/libstdc%2B%2B-v3%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/e98edc20cd615f43afce32c5de40d59fa25e40ed/libstdc%2B%2B-v3%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libstdc%2B%2B-v3%2FChangeLog?ref=e98edc20cd615f43afce32c5de40d59fa25e40ed", "patch": "@@ -1,3 +1,9 @@\n+2018-07-26  Marc Glisse  <marc.glisse@inria.fr>\n+\n+\t* include/bits/stl_vector.h (_Vector_impl_data::_M_copy_data): New.\n+\t(_Vector_impl_data::_M_swap_data): Use _M_copy_data.\n+\t(vector::_M_move_assign): Reorder the swaps.\n+\n 2018-07-26  Jonathan Wakely  <jwakely@redhat.com>\n \n \tPR libstdc++/86676"}, {"sha": "424971a02f20f188dada12361b290ad674764262", "filename": "libstdc++-v3/include/bits/stl_vector.h", "status": "modified", "additions": 15, "deletions": 4, "changes": 19, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/e98edc20cd615f43afce32c5de40d59fa25e40ed/libstdc%2B%2B-v3%2Finclude%2Fbits%2Fstl_vector.h", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/e98edc20cd615f43afce32c5de40d59fa25e40ed/libstdc%2B%2B-v3%2Finclude%2Fbits%2Fstl_vector.h", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libstdc%2B%2B-v3%2Finclude%2Fbits%2Fstl_vector.h?ref=e98edc20cd615f43afce32c5de40d59fa25e40ed", "patch": "@@ -102,12 +102,23 @@ _GLIBCXX_BEGIN_NAMESPACE_CONTAINER\n \t{ __x._M_start = __x._M_finish = __x._M_end_of_storage = pointer(); }\n #endif\n \n+\tvoid\n+\t_M_copy_data(_Vector_impl_data const& __x) _GLIBCXX_NOEXCEPT\n+\t{\n+\t  _M_start = __x._M_start;\n+\t  _M_finish = __x._M_finish;\n+\t  _M_end_of_storage = __x._M_end_of_storage;\n+\t}\n+\n \tvoid\n \t_M_swap_data(_Vector_impl_data& __x) _GLIBCXX_NOEXCEPT\n \t{\n-\t  std::swap(_M_start, __x._M_start);\n-\t  std::swap(_M_finish, __x._M_finish);\n-\t  std::swap(_M_end_of_storage, __x._M_end_of_storage);\n+\t  // Do not use std::swap(_M_start, __x._M_start), etc as it loses\n+\t  // information used by TBAA.\n+\t  _Vector_impl_data __tmp;\n+\t  __tmp._M_copy_data(*this);\n+\t  _M_copy_data(__x);\n+\t  __x._M_copy_data(__tmp);\n \t}\n       };\n \n@@ -1731,8 +1742,8 @@ _GLIBCXX_BEGIN_NAMESPACE_CONTAINER\n       _M_move_assign(vector&& __x, true_type) noexcept\n       {\n \tvector __tmp(get_allocator());\n-\tthis->_M_impl._M_swap_data(__tmp._M_impl);\n \tthis->_M_impl._M_swap_data(__x._M_impl);\n+\t__tmp._M_impl._M_swap_data(__x._M_impl);\n \tstd::__alloc_on_move(_M_get_Tp_allocator(), __x._M_get_Tp_allocator());\n       }\n "}]}