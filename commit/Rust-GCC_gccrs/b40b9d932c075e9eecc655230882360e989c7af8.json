{"sha": "b40b9d932c075e9eecc655230882360e989c7af8", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6YjQwYjlkOTMyYzA3NWU5ZWVjYzY1NTIzMDg4MjM2MGU5ODljN2FmOA==", "commit": {"author": {"name": "Mike Stump", "email": "mrs@gcc.gnu.org", "date": "1996-10-24T01:23:43Z"}, "committer": {"name": "Mike Stump", "email": "mrs@gcc.gnu.org", "date": "1996-10-24T01:23:43Z"}, "message": "crtstuff.c (__do_global_dtors_aux): Allow finalization code to be run more than once.\n\n        * crtstuff.c (__do_global_dtors_aux): Allow finalization code to\n        be run more than once.\n        * libgcc2.c (__do_global_dtors): Ditto.\n\nFrom-SVN: r13023", "tree": {"sha": "765fea06aca0dd565a7fa30ba548abb4380d5198", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/765fea06aca0dd565a7fa30ba548abb4380d5198"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/b40b9d932c075e9eecc655230882360e989c7af8", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/b40b9d932c075e9eecc655230882360e989c7af8", "html_url": "https://github.com/Rust-GCC/gccrs/commit/b40b9d932c075e9eecc655230882360e989c7af8", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/b40b9d932c075e9eecc655230882360e989c7af8/comments", "author": null, "committer": null, "parents": [{"sha": "3e943b598427255b7501e41339f09ca52e3eae2c", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/3e943b598427255b7501e41339f09ca52e3eae2c", "html_url": "https://github.com/Rust-GCC/gccrs/commit/3e943b598427255b7501e41339f09ca52e3eae2c"}], "stats": {"total": 25, "additions": 18, "deletions": 7}, "files": [{"sha": "6cbb82b6f38ced0aa50b876486f9e2ce2d90849f", "filename": "gcc/crtstuff.c", "status": "modified", "additions": 12, "deletions": 4, "changes": 16, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/b40b9d932c075e9eecc655230882360e989c7af8/gcc%2Fcrtstuff.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/b40b9d932c075e9eecc655230882360e989c7af8/gcc%2Fcrtstuff.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fcrtstuff.c?ref=b40b9d932c075e9eecc655230882360e989c7af8", "patch": "@@ -111,15 +111,23 @@ typedef void (*func_ptr) (void);\n    functions in each root executable and one in each shared library, but\n    although they all have the same code, each one is unique in that it\n    refers to one particular associated `__DTOR_LIST__' which belongs to the\n-   same particular root executable or shared library file.  */\n+   same particular root executable or shared library file.\n+\n+   On some systems, this routine is run more than once from the .fini,\n+   when exit is called recursively, so we arrange to remember where in\n+   the list we left off processing, and we resume at that point,\n+   should we be re-invoked.  */\n \n static func_ptr __DTOR_LIST__[];\n static void\n __do_global_dtors_aux ()\n {\n-  func_ptr *p;\n-  for (p = __DTOR_LIST__ + 1; *p; p++)\n-    (*p) ();\n+  static func_ptr *p = __DTOR_LIST__ + 1;\n+  while (*p)\n+    {\n+      p++;\n+      (*(p-1)) ();\n+    }\n }\n \n /* Stick a call to __do_global_dtors_aux into the .fini section.  */"}, {"sha": "69cb7e47ad81e5da3f56ac5ec7137b843a46abaf", "filename": "gcc/libgcc2.c", "status": "modified", "additions": 6, "deletions": 3, "changes": 9, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/b40b9d932c075e9eecc655230882360e989c7af8/gcc%2Flibgcc2.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/b40b9d932c075e9eecc655230882360e989c7af8/gcc%2Flibgcc2.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Flibgcc2.c?ref=b40b9d932c075e9eecc655230882360e989c7af8", "patch": "@@ -2829,9 +2829,12 @@ __do_global_dtors ()\n #ifdef DO_GLOBAL_DTORS_BODY\n   DO_GLOBAL_DTORS_BODY;\n #else\n-  func_ptr *p;\n-  for (p = __DTOR_LIST__ + 1; *p; )\n-    (*p++) ();\n+  static func_ptr *p = __DTOR_LIST__ + 1;\n+  while (*p)\n+    {\n+      p++;\n+      (*(p-1)) ();\n+    }\n #endif\n }\n #endif"}]}