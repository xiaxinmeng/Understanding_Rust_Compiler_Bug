{"sha": "46eb4b398948ddef881e51b9c49d96e242d56002", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6NDZlYjRiMzk4OTQ4ZGRlZjg4MWU1MWI5YzQ5ZDk2ZTI0MmQ1NjAwMg==", "commit": {"author": {"name": "Jason Merrill", "email": "jason@redhat.com", "date": "2003-12-20T03:08:42Z"}, "committer": {"name": "Jason Merrill", "email": "jason@gcc.gnu.org", "date": "2003-12-20T03:08:42Z"}, "message": "atomicity.h: Remove memory clobbers.\n\n        * config/cpu/cris/atomicity.h: Remove memory clobbers.\n        * config/cpu/mips/atomicity.h: Likewise.\n        * config/cpu/i486/atomicity.h: Remove memory clobbers.\n        Split up read-write memory operand.\n        * config/cpu/m68k/atomicity.h: Likewise.\n        * config/cpu/powerpc/atomicity.h: Make memory I/O explicit.\n        * config/cpu/s390/atomicity.h: Likewise.\n        * config/cpu/sparc/atomicity.h: Likewise.\n\nFrom-SVN: r74870", "tree": {"sha": "536adb8ba0344092c4b99ba083903902491e9068", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/536adb8ba0344092c4b99ba083903902491e9068"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/46eb4b398948ddef881e51b9c49d96e242d56002", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/46eb4b398948ddef881e51b9c49d96e242d56002", "html_url": "https://github.com/Rust-GCC/gccrs/commit/46eb4b398948ddef881e51b9c49d96e242d56002", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/46eb4b398948ddef881e51b9c49d96e242d56002/comments", "author": {"login": "jicama", "id": 266146, "node_id": "MDQ6VXNlcjI2NjE0Ng==", "avatar_url": "https://avatars.githubusercontent.com/u/266146?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jicama", "html_url": "https://github.com/jicama", "followers_url": "https://api.github.com/users/jicama/followers", "following_url": "https://api.github.com/users/jicama/following{/other_user}", "gists_url": "https://api.github.com/users/jicama/gists{/gist_id}", "starred_url": "https://api.github.com/users/jicama/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jicama/subscriptions", "organizations_url": "https://api.github.com/users/jicama/orgs", "repos_url": "https://api.github.com/users/jicama/repos", "events_url": "https://api.github.com/users/jicama/events{/privacy}", "received_events_url": "https://api.github.com/users/jicama/received_events", "type": "User", "site_admin": false}, "committer": null, "parents": [{"sha": "a06f01ba1e9b964c14ed6c63b56102d34ec6c45f", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/a06f01ba1e9b964c14ed6c63b56102d34ec6c45f", "html_url": "https://github.com/Rust-GCC/gccrs/commit/a06f01ba1e9b964c14ed6c63b56102d34ec6c45f"}], "stats": {"total": 90, "additions": 47, "deletions": 43}, "files": [{"sha": "e2d1924c0f41061a582eb365959ba861258b4f58", "filename": "libstdc++-v3/ChangeLog", "status": "modified", "additions": 11, "deletions": 0, "changes": 11, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/46eb4b398948ddef881e51b9c49d96e242d56002/libstdc%2B%2B-v3%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/46eb4b398948ddef881e51b9c49d96e242d56002/libstdc%2B%2B-v3%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libstdc%2B%2B-v3%2FChangeLog?ref=46eb4b398948ddef881e51b9c49d96e242d56002", "patch": "@@ -1,3 +1,14 @@\n+2003-12-19  Jason Merrill  <jason@redhat.com>\n+\n+\t* config/cpu/cris/atomicity.h: Remove memory clobbers.\n+\t* config/cpu/mips/atomicity.h: Likewise.\n+\t* config/cpu/i486/atomicity.h: Remove memory clobbers.\n+\tSplit up read-write memory operand.\n+\t* config/cpu/m68k/atomicity.h: Likewise.\n+\t* config/cpu/powerpc/atomicity.h: Make memory I/O explicit.\n+\t* config/cpu/s390/atomicity.h: Likewise.\n+\t* config/cpu/sparc/atomicity.h: Likewise.\n+\n 2003-12-20  Carlo Wood  <carlo@alinoe.com>\n \n \t* bits/demangle.h"}, {"sha": "fecb9dc186f496085748a98659d042527772d10c", "filename": "libstdc++-v3/config/cpu/cris/atomicity.h", "status": "modified", "additions": 2, "deletions": 3, "changes": 5, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/46eb4b398948ddef881e51b9c49d96e242d56002/libstdc%2B%2B-v3%2Fconfig%2Fcpu%2Fcris%2Fatomicity.h", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/46eb4b398948ddef881e51b9c49d96e242d56002/libstdc%2B%2B-v3%2Fconfig%2Fcpu%2Fcris%2Fatomicity.h", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libstdc%2B%2B-v3%2Fconfig%2Fcpu%2Fcris%2Fatomicity.h?ref=46eb4b398948ddef881e51b9c49d96e242d56002", "patch": "@@ -51,8 +51,7 @@ __exchange_and_add(_Atomic_word* __mem, int __val)\n \t\t\t\" bwf 0b\t\t\\n\"\n \t\t\t\" clearf\t\t\\n\"\n \t\t\t:  \"=&r\" (__result), \"=m\" (*__mem), \"=&r\" (__tmp)\n-\t\t\t: \"r\" (__mem), \"g\" (__val), \"m\" (*__mem)\n-\t\t\t: \"memory\");\n+\t\t\t: \"r\" (__mem), \"g\" (__val), \"m\" (*__mem));\n #else\n   __asm__ __volatile__ (\" move $ccr,$r9\t\t\\n\"\n \t\t\t\" di\t\t\t\\n\"\n@@ -63,7 +62,7 @@ __exchange_and_add(_Atomic_word* __mem, int __val)\n \t\t\t\" move $r9,$ccr\t\t\\n\"\n \t\t\t:  \"=&r\" (__result), \"=m\" (*__mem), \"=&r\" (__tmp)\n \t\t\t: \"r\" (__mem), \"g\" (__val), \"m\" (*__mem)\n-\t\t\t: \"memory\", \"r9\");\n+\t\t\t: \"r9\");\n #endif\n \n   return __result;"}, {"sha": "06ab866bbe39a78d215587db20825a5ed5901bd3", "filename": "libstdc++-v3/config/cpu/i486/atomicity.h", "status": "modified", "additions": 3, "deletions": 4, "changes": 7, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/46eb4b398948ddef881e51b9c49d96e242d56002/libstdc%2B%2B-v3%2Fconfig%2Fcpu%2Fi486%2Fatomicity.h", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/46eb4b398948ddef881e51b9c49d96e242d56002/libstdc%2B%2B-v3%2Fconfig%2Fcpu%2Fi486%2Fatomicity.h", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libstdc%2B%2B-v3%2Fconfig%2Fcpu%2Fi486%2Fatomicity.h?ref=46eb4b398948ddef881e51b9c49d96e242d56002", "patch": "@@ -38,9 +38,8 @@ __exchange_and_add(volatile _Atomic_word* __mem, int __val)\n {\n   register _Atomic_word __result;\n   __asm__ __volatile__ (\"lock; xadd{l} {%0,%1|%1,%0}\"\n-\t\t\t: \"=r\" (__result), \"+m\" (*__mem) \n-                        : \"0\" (__val)\n-                        : \"memory\");\n+\t\t\t: \"=r\" (__result), \"=m\" (*__mem) \n+\t\t\t: \"0\" (__val), \"m\" (*__mem));\n   return __result;\n }\n \n@@ -49,7 +48,7 @@ __attribute__ ((__unused__))\n __atomic_add(volatile _Atomic_word* __mem, int __val)\n {\n   __asm__ __volatile__ (\"lock; add{l} {%1,%0|%0,%1}\"\n-\t\t\t: \"+m\" (*__mem) : \"ir\" (__val) : \"memory\");\n+\t\t\t: \"=m\" (*__mem) : \"ir\" (__val), \"m\" (*__mem));\n }\n \n #endif /* atomicity.h */"}, {"sha": "eb801dec50cf6e859fd1f3e84b71c0bea868ba0a", "filename": "libstdc++-v3/config/cpu/m68k/atomicity.h", "status": "modified", "additions": 2, "deletions": 3, "changes": 5, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/46eb4b398948ddef881e51b9c49d96e242d56002/libstdc%2B%2B-v3%2Fconfig%2Fcpu%2Fm68k%2Fatomicity.h", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/46eb4b398948ddef881e51b9c49d96e242d56002/libstdc%2B%2B-v3%2Fconfig%2Fcpu%2Fm68k%2Fatomicity.h", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libstdc%2B%2B-v3%2Fconfig%2Fcpu%2Fm68k%2Fatomicity.h?ref=46eb4b398948ddef881e51b9c49d96e242d56002", "patch": "@@ -47,9 +47,8 @@ __exchange_and_add(volatile _Atomic_word* __mem, int __val)\n \t\t\t\"add%.l %3,%1\\n\\t\"\n \t\t\t\"cas%.l %0,%1,%2\\n\\t\"\n \t\t\t\"jne 1b\"\n-\t\t\t: \"=d\" (__result), \"=&d\" (__temp), \"+m\" (*__mem)\n-\t\t\t: \"d\" (__val), \"0\" (__result)\n-\t\t\t: \"memory\");\n+\t\t\t: \"=d\" (__result), \"=&d\" (__temp), \"=m\" (*__mem)\n+\t\t\t: \"d\" (__val), \"0\" (__result), \"m\" (*__mem));\n   return __result;\n }\n "}, {"sha": "3d0c7a10e0926986c733968dbb0b045b60545f76", "filename": "libstdc++-v3/config/cpu/mips/atomicity.h", "status": "modified", "additions": 2, "deletions": 4, "changes": 6, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/46eb4b398948ddef881e51b9c49d96e242d56002/libstdc%2B%2B-v3%2Fconfig%2Fcpu%2Fmips%2Fatomicity.h", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/46eb4b398948ddef881e51b9c49d96e242d56002/libstdc%2B%2B-v3%2Fconfig%2Fcpu%2Fmips%2Fatomicity.h", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libstdc%2B%2B-v3%2Fconfig%2Fcpu%2Fmips%2Fatomicity.h?ref=46eb4b398948ddef881e51b9c49d96e242d56002", "patch": "@@ -52,8 +52,7 @@ __exchange_and_add(volatile _Atomic_word* __mem, int __val)\n      \"beqz\t%1,1b\\n\\t\"\n      \"/* End exchange & add */\"\n      : \"=&r\"(__result), \"=&r\"(__tmp), \"=m\"(*__mem)\n-     : \"m\" (*__mem), \"r\"(__val)\n-     : \"memory\");\n+     : \"m\" (*__mem), \"r\"(__val));\n \n   return __result;\n }\n@@ -78,8 +77,7 @@ __atomic_add(volatile _Atomic_word* __mem, int __val)\n      \"beqz\t%0,1b\\n\\t\"\n      \"/* End atomic add */\"\n      : \"=&r\"(__result), \"=m\"(*__mem)\n-     : \"m\" (*__mem), \"r\"(__val)\n-     : \"memory\");\n+     : \"m\" (*__mem), \"r\"(__val));\n }\n \n #endif /* atomicity.h */"}, {"sha": "6c474b48a894e0444e2683d2d53a335cfcf40be5", "filename": "libstdc++-v3/config/cpu/powerpc/atomicity.h", "status": "modified", "additions": 12, "deletions": 12, "changes": 24, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/46eb4b398948ddef881e51b9c49d96e242d56002/libstdc%2B%2B-v3%2Fconfig%2Fcpu%2Fpowerpc%2Fatomicity.h", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/46eb4b398948ddef881e51b9c49d96e242d56002/libstdc%2B%2B-v3%2Fconfig%2Fcpu%2Fpowerpc%2Fatomicity.h", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libstdc%2B%2B-v3%2Fconfig%2Fcpu%2Fpowerpc%2Fatomicity.h?ref=46eb4b398948ddef881e51b9c49d96e242d56002", "patch": "@@ -46,14 +46,14 @@ __exchange_and_add(volatile _Atomic_word* __mem, int __val)\n   __asm__ __volatile__ (\n \t\"/* Inline exchange & add */\\n\"\n \t\"0:\\t\"\n-\t\"lwarx    %0,0,%2 \\n\\t\"\n-\t\"add%I3   %1,%0,%3 \\n\\t\"\n-\t_STWCX \"  %1,0,%2 \\n\\t\"\n+\t\"lwarx    %0,0,%3 \\n\\t\"\n+\t\"add%I3   %1,%0,%4 \\n\\t\"\n+\t_STWCX \"  %1,0,%3 \\n\\t\"\n \t\"bne-     0b \\n\\t\"\n \t\"/* End exchange & add */\"\n-\t: \"=&b\"(__res), \"=&r\"(__tmp)\n-\t: \"r\" (__mem), \"Ir\"(__val)\n-\t: \"cr0\", \"memory\");\n+\t: \"=&b\"(__res), \"=&r\"(__tmp), \"=m\" (*__mem)\n+\t: \"r\" (__mem), \"Ir\"(__val), \"m\" (*__mem)\n+\t: \"cr0\");\n   return __res;\n }\n \n@@ -65,14 +65,14 @@ __atomic_add(volatile _Atomic_word* __mem, int __val)\n   __asm__ __volatile__ (\n \t\"/* Inline atomic add */\\n\"\n \t\"0:\\t\"\n-\t\"lwarx    %0,0,%1 \\n\\t\"\n-\t\"add%I2   %0,%0,%2 \\n\\t\"\n-\t_STWCX \"  %0,0,%1 \\n\\t\"\n+\t\"lwarx    %0,0,%2 \\n\\t\"\n+\t\"add%I2   %0,%0,%3 \\n\\t\"\n+\t_STWCX \"  %0,0,%2 \\n\\t\"\n \t\"bne-     0b \\n\\t\"\n \t\"/* End atomic add */\"\n-\t: \"=&b\"(__tmp)\n-\t: \"r\" (__mem), \"Ir\"(__val)\n-\t: \"cr0\", \"memory\");\n+\t: \"=&b\"(__tmp), \"=m\" (*__mem)\n+\t: \"r\" (__mem), \"Ir\"(__val), \"m\" (*__mem)\n+\t: \"cr0\");\n }\n \n #endif /* atomicity.h */"}, {"sha": "8647c7635eabacfd71a4bba005491b6b67fd95c9", "filename": "libstdc++-v3/config/cpu/s390/atomicity.h", "status": "modified", "additions": 5, "deletions": 5, "changes": 10, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/46eb4b398948ddef881e51b9c49d96e242d56002/libstdc%2B%2B-v3%2Fconfig%2Fcpu%2Fs390%2Fatomicity.h", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/46eb4b398948ddef881e51b9c49d96e242d56002/libstdc%2B%2B-v3%2Fconfig%2Fcpu%2Fs390%2Fatomicity.h", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libstdc%2B%2B-v3%2Fconfig%2Fcpu%2Fs390%2Fatomicity.h?ref=46eb4b398948ddef881e51b9c49d96e242d56002", "patch": "@@ -38,13 +38,13 @@ __exchange_and_add(volatile _Atomic_word* __mem, int __val)\n {\n   register _Atomic_word __old_val, __new_val;\n \n-  __asm__ __volatile__ (\"   l     %0,0(%2)\\n\"\n+  __asm__ __volatile__ (\"   l     %0,0(%3)\\n\"\n                         \"0: lr    %1,%0\\n\"\n-                        \"   ar    %1,%3\\n\"\n-                        \"   cs    %0,%1,0(%2)\\n\"\n+                        \"   ar    %1,%4\\n\"\n+                        \"   cs    %0,%1,0(%3)\\n\"\n                         \"   jl    0b\"\n-                        : \"=&d\" (__old_val), \"=&d\" (__new_val)\n-                        : \"a\" (__mem), \"d\" (__val) : \"cc\", \"memory\" );\n+                        : \"=&d\" (__old_val), \"=&d\" (__new_val), \"=m\" (*__mem)\n+                        : \"a\" (__mem), \"d\" (__val), \"m\" (*__mem) : \"cc\");\n   return __old_val;\n }\n "}, {"sha": "2db079c95ec0cd98338c2773f83dde857694e3b5", "filename": "libstdc++-v3/config/cpu/sparc/atomicity.h", "status": "modified", "additions": 10, "deletions": 12, "changes": 22, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/46eb4b398948ddef881e51b9c49d96e242d56002/libstdc%2B%2B-v3%2Fconfig%2Fcpu%2Fsparc%2Fatomicity.h", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/46eb4b398948ddef881e51b9c49d96e242d56002/libstdc%2B%2B-v3%2Fconfig%2Fcpu%2Fsparc%2Fatomicity.h", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libstdc%2B%2B-v3%2Fconfig%2Fcpu%2Fsparc%2Fatomicity.h?ref=46eb4b398948ddef881e51b9c49d96e242d56002", "patch": "@@ -41,15 +41,14 @@ __exchange_and_add(volatile _Atomic_word* __mem, int __val)\n   _Atomic_word __tmp1, __tmp2;\n   _Atomic_word __val_extended = __val;\n \n-  __asm__ __volatile__(\"1:\tldx\t[%2], %0\\n\\t\"\n-\t\t       \"\tadd\t%0, %3, %1\\n\\t\"\n-\t\t       \"\tcasx\t[%2], %0, %1\\n\\t\"\n+  __asm__ __volatile__(\"1:\tldx\t[%3], %0\\n\\t\"\n+\t\t       \"\tadd\t%0, %4, %1\\n\\t\"\n+\t\t       \"\tcasx\t[%3], %0, %1\\n\\t\"\n \t\t       \"\tsub\t%0, %1, %0\\n\\t\"\n \t\t       \"\tbrnz,pn\t%0, 1b\\n\\t\"\n \t\t       \"\t nop\"\n-\t\t       : \"=&r\" (__tmp1), \"=&r\" (__tmp2)\n-\t\t       : \"r\" (__mem), \"r\" (__val_extended)\n-\t\t       : \"memory\");\n+\t\t       : \"=&r\" (__tmp1), \"=&r\" (__tmp2), \"=m\" (*__mem)\n+\t\t       : \"r\" (__mem), \"r\" (__val_extended), \"m\" (*__mem));\n   return __tmp2;\n }\n \n@@ -60,15 +59,14 @@ __atomic_add(volatile _Atomic_word* __mem, int __val)\n   _Atomic_word __tmp1, __tmp2;\n   _Atomic_word __val_extended = __val;\n \n-  __asm__ __volatile__(\"1:\tldx\t[%2], %0\\n\\t\"\n-\t\t       \"\tadd\t%0, %3, %1\\n\\t\"\n-\t\t       \"\tcasx\t[%2], %0, %1\\n\\t\"\n+  __asm__ __volatile__(\"1:\tldx\t[%3], %0\\n\\t\"\n+\t\t       \"\tadd\t%0, %4, %1\\n\\t\"\n+\t\t       \"\tcasx\t[%3], %0, %1\\n\\t\"\n \t\t       \"\tsub\t%0, %1, %0\\n\\t\"\n \t\t       \"\tbrnz,pn\t%0, 1b\\n\\t\"\n \t\t       \"\t nop\"\n-\t\t       : \"=&r\" (__tmp1), \"=&r\" (__tmp2)\n-\t\t       : \"r\" (__mem), \"r\" (__val_extended)\n-\t\t       : \"memory\");\n+\t\t       : \"=&r\" (__tmp1), \"=&r\" (__tmp2), \"=m\" (*__mem)\n+\t\t       : \"r\" (__mem), \"r\" (__val_extended), \"m\" (*__mem));\n }\n \n #else /* __arch32__ */"}]}