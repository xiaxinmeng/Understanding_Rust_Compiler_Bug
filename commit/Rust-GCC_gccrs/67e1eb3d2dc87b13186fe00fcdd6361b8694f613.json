{"sha": "67e1eb3d2dc87b13186fe00fcdd6361b8694f613", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6NjdlMWViM2QyZGM4N2IxMzE4NmZlMDBmY2RkNjM2MWI4Njk0ZjYxMw==", "commit": {"author": {"name": "Shiva Chen", "email": "shiva0217@gmail.com", "date": "2018-04-05T03:35:28Z"}, "committer": {"name": "Chung-Ju Wu", "email": "jasonwucj@gcc.gnu.org", "date": "2018-04-05T03:35:28Z"}, "message": "[NDS32] Fine-tune memory address type.\n\ngcc/\n\t* config/nds32/constraints.md (U33): Fine-tune checking condition.\n\t* config/nds32/nds32-md-auxiliary.c (nds32_mem_format): Ditto.\n\t* config/nds32/nds32.h (nds32_16bit_address_type): Add\n\tADDRESS_POST_MODIFY_LO_REG_IMM3U.\n\nCo-Authored-By: Kito Cheng <kito.cheng@gmail.com>\n\nFrom-SVN: r259122", "tree": {"sha": "289f102fff71eb506ae6ac041059c9e2b8d75879", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/289f102fff71eb506ae6ac041059c9e2b8d75879"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/67e1eb3d2dc87b13186fe00fcdd6361b8694f613", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/67e1eb3d2dc87b13186fe00fcdd6361b8694f613", "html_url": "https://github.com/Rust-GCC/gccrs/commit/67e1eb3d2dc87b13186fe00fcdd6361b8694f613", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/67e1eb3d2dc87b13186fe00fcdd6361b8694f613/comments", "author": {"login": "ShivaChen", "id": 32083954, "node_id": "MDQ6VXNlcjMyMDgzOTU0", "avatar_url": "https://avatars.githubusercontent.com/u/32083954?v=4", "gravatar_id": "", "url": "https://api.github.com/users/ShivaChen", "html_url": "https://github.com/ShivaChen", "followers_url": "https://api.github.com/users/ShivaChen/followers", "following_url": "https://api.github.com/users/ShivaChen/following{/other_user}", "gists_url": "https://api.github.com/users/ShivaChen/gists{/gist_id}", "starred_url": "https://api.github.com/users/ShivaChen/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/ShivaChen/subscriptions", "organizations_url": "https://api.github.com/users/ShivaChen/orgs", "repos_url": "https://api.github.com/users/ShivaChen/repos", "events_url": "https://api.github.com/users/ShivaChen/events{/privacy}", "received_events_url": "https://api.github.com/users/ShivaChen/received_events", "type": "User", "site_admin": false}, "committer": null, "parents": [{"sha": "8656bbcff8f1b9cc80eed9be6f63170fa3ad7824", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/8656bbcff8f1b9cc80eed9be6f63170fa3ad7824", "html_url": "https://github.com/Rust-GCC/gccrs/commit/8656bbcff8f1b9cc80eed9be6f63170fa3ad7824"}], "stats": {"total": 32, "additions": 26, "deletions": 6}, "files": [{"sha": "6e299cb33a759654eff98b1ba40ad55f83ef853e", "filename": "gcc/ChangeLog", "status": "modified", "additions": 8, "deletions": 0, "changes": 8, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/67e1eb3d2dc87b13186fe00fcdd6361b8694f613/gcc%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/67e1eb3d2dc87b13186fe00fcdd6361b8694f613/gcc%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2FChangeLog?ref=67e1eb3d2dc87b13186fe00fcdd6361b8694f613", "patch": "@@ -1,3 +1,11 @@\n+2018-04-05  Shiva Chen  <shiva0217@gmail.com>\n+\t    Kito Cheng  <kito.cheng@gmail.com>\n+\n+\t* config/nds32/constraints.md (U33): Fine-tune checking condition.\n+\t* config/nds32/nds32-md-auxiliary.c (nds32_mem_format): Ditto.\n+\t* config/nds32/nds32.h (nds32_16bit_address_type): Add\n+\tADDRESS_POST_MODIFY_LO_REG_IMM3U.\n+\n 2018-04-05  Shiva Chen  <shiva0217@gmail.com>\n \t    Kito Cheng  <kito.cheng@gmail.com>\n "}, {"sha": "7cf18eb5533e38264e549273b73f6592a37f1147", "filename": "gcc/config/nds32/constraints.md", "status": "modified", "additions": 3, "deletions": 1, "changes": 4, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/67e1eb3d2dc87b13186fe00fcdd6361b8694f613/gcc%2Fconfig%2Fnds32%2Fconstraints.md", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/67e1eb3d2dc87b13186fe00fcdd6361b8694f613/gcc%2Fconfig%2Fnds32%2Fconstraints.md", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fconfig%2Fnds32%2Fconstraints.md?ref=67e1eb3d2dc87b13186fe00fcdd6361b8694f613", "patch": "@@ -288,7 +288,9 @@\n (define_memory_constraint \"U33\"\n   \"Memory constraint for 333 format\"\n   (and (match_code \"mem\")\n-       (match_test \"nds32_mem_format (op) == ADDRESS_LO_REG_IMM3U\")))\n+       (match_test \"nds32_mem_format (op) == ADDRESS_POST_INC_LO_REG_IMM3U\n+\t\t    || nds32_mem_format (op) == ADDRESS_POST_MODIFY_LO_REG_IMM3U\n+\t\t    || nds32_mem_format (op) == ADDRESS_LO_REG_IMM3U\")))\n \n (define_memory_constraint \"U45\"\n   \"Memory constraint for 45 format\""}, {"sha": "b3673ae72e619b21dee541928799594e97391a3e", "filename": "gcc/config/nds32/nds32-md-auxiliary.c", "status": "modified", "additions": 13, "deletions": 5, "changes": 18, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/67e1eb3d2dc87b13186fe00fcdd6361b8694f613/gcc%2Fconfig%2Fnds32%2Fnds32-md-auxiliary.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/67e1eb3d2dc87b13186fe00fcdd6361b8694f613/gcc%2Fconfig%2Fnds32%2Fnds32-md-auxiliary.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fconfig%2Fnds32%2Fnds32-md-auxiliary.c?ref=67e1eb3d2dc87b13186fe00fcdd6361b8694f613", "patch": "@@ -891,8 +891,8 @@ nds32_mem_format (rtx op)\n     {\n       regno = REGNO (XEXP (XEXP (op, 1), 0));\n       val = INTVAL (XEXP (XEXP (op, 1), 1));\n-      if (regno < 8 && val < 32)\n-\treturn ADDRESS_POST_INC_LO_REG_IMM3U;\n+      if (regno < 8 && val > 0 && val < 32)\n+\treturn ADDRESS_POST_MODIFY_LO_REG_IMM3U;\n     }\n \n   if ((GET_CODE (op) == PLUS)\n@@ -903,7 +903,7 @@ nds32_mem_format (rtx op)\n \n       regno = REGNO(XEXP (op, 0));\n \n-      if (regno > 7\n+      if (regno > 8\n \t  && regno != SP_REGNUM\n \t  && regno != FP_REGNUM)\n \treturn ADDRESS_NOT_16BIT_FORMAT;\n@@ -971,7 +971,11 @@ nds32_output_16bit_store (rtx *operands, int byte)\n       output_asm_insn (pattern, operands);\n       break;\n     case ADDRESS_POST_INC_LO_REG_IMM3U:\n-      snprintf (pattern, sizeof (pattern), \"s%ci333.bi\\t%%1, %%0\", size);\n+      snprintf (pattern, sizeof (pattern), \"swi333.bi\\t%%1, %%0, 4\");\n+      output_asm_insn (pattern, operands);\n+      break;\n+    case ADDRESS_POST_MODIFY_LO_REG_IMM3U:\n+      snprintf (pattern, sizeof (pattern), \"swi333.bi\\t%%1, %%0\");\n       output_asm_insn (pattern, operands);\n       break;\n     case ADDRESS_FP_IMM7U:\n@@ -1010,7 +1014,11 @@ nds32_output_16bit_load (rtx *operands, int byte)\n       output_asm_insn (pattern, operands);\n       break;\n     case ADDRESS_POST_INC_LO_REG_IMM3U:\n-      snprintf (pattern, sizeof (pattern), \"l%ci333.bi\\t%%0, %%1\", size);\n+      snprintf (pattern, sizeof (pattern), \"lwi333.bi\\t%%0, %%1, 4\");\n+      output_asm_insn (pattern, operands);\n+      break;\n+    case ADDRESS_POST_MODIFY_LO_REG_IMM3U:\n+      snprintf (pattern, sizeof (pattern), \"lwi333.bi\\t%%0, %%1\");\n       output_asm_insn (pattern, operands);\n       break;\n     case ADDRESS_R8_IMM7U:"}, {"sha": "02b99a17b955c57094032cf97df727ba305fdac8", "filename": "gcc/config/nds32/nds32.h", "status": "modified", "additions": 2, "deletions": 0, "changes": 2, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/67e1eb3d2dc87b13186fe00fcdd6361b8694f613/gcc%2Fconfig%2Fnds32%2Fnds32.h", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/67e1eb3d2dc87b13186fe00fcdd6361b8694f613/gcc%2Fconfig%2Fnds32%2Fnds32.h", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fconfig%2Fnds32%2Fnds32.h?ref=67e1eb3d2dc87b13186fe00fcdd6361b8694f613", "patch": "@@ -113,6 +113,8 @@ enum nds32_16bit_address_type\n   ADDRESS_LO_REG_IMM3U,\n   /* post_inc [lo_reg + imm3u]: 333 format address.  */\n   ADDRESS_POST_INC_LO_REG_IMM3U,\n+  /* post_modify [lo_reg + imm3u]: 333 format address.  */\n+  ADDRESS_POST_MODIFY_LO_REG_IMM3U,\n   /* [$r8 + imm7u]: r8 imply address.  */\n   ADDRESS_R8_IMM7U,\n   /* [$fp + imm7u]: fp imply address.  */"}]}