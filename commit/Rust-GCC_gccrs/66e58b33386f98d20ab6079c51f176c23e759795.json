{"sha": "66e58b33386f98d20ab6079c51f176c23e759795", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6NjZlNThiMzMzODZmOThkMjBhYjYwNzljNTFmMTc2YzIzZTc1OTc5NQ==", "commit": {"author": {"name": "Bob Wilson", "email": "bob.wilson@acm.org", "date": "2008-03-15T00:46:54Z"}, "committer": {"name": "Bob Wilson", "email": "bwilson@gcc.gnu.org", "date": "2008-03-15T00:46:54Z"}, "message": "invoke.texi (Option Summary, [...]): Document -mserialize-volatile and -mno-serialize-volatile Xtensa options.\n\n        * doc/invoke.texi (Option Summary, Xtensa Options): Document\n        -mserialize-volatile and -mno-serialize-volatile Xtensa options.\n        * config/xtensa/xtensa.c (print_operand): Do not emit MEMW instructions\n        unless TARGET_SERIALIZE_VOLATILE is enabled.\n        * config/xtensa/xtensa.md (*lsiu, *ssiu): Likewise.\n        * config/xtensa/xtensa.h (TARGET_DEFAULT): Add MASK_SERIALIZE_VOLATILE.\n        * config/xtensa/xtensa.opt (mserialize_volatile): New option.\n\nFrom-SVN: r133234", "tree": {"sha": "d03f1ea6b0c62cdf0638dd26e481a620f8ab05ee", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/d03f1ea6b0c62cdf0638dd26e481a620f8ab05ee"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/66e58b33386f98d20ab6079c51f176c23e759795", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/66e58b33386f98d20ab6079c51f176c23e759795", "html_url": "https://github.com/Rust-GCC/gccrs/commit/66e58b33386f98d20ab6079c51f176c23e759795", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/66e58b33386f98d20ab6079c51f176c23e759795/comments", "author": null, "committer": null, "parents": [{"sha": "45de3658e9b231f2e68e9240702ce274416ccae2", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/45de3658e9b231f2e68e9240702ce274416ccae2", "html_url": "https://github.com/Rust-GCC/gccrs/commit/45de3658e9b231f2e68e9240702ce274416ccae2"}], "stats": {"total": 43, "additions": 34, "deletions": 9}, "files": [{"sha": "79ef713121eeb4ea43bb666d8e44ce13e557a8c9", "filename": "gcc/ChangeLog", "status": "modified", "additions": 10, "deletions": 0, "changes": 10, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/66e58b33386f98d20ab6079c51f176c23e759795/gcc%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/66e58b33386f98d20ab6079c51f176c23e759795/gcc%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2FChangeLog?ref=66e58b33386f98d20ab6079c51f176c23e759795", "patch": "@@ -1,3 +1,13 @@\n+2008-03-14  Bob Wilson  <bob.wilson@acm.org>\n+\t\n+\t* doc/invoke.texi (Option Summary, Xtensa Options): Document\n+\t-mserialize-volatile and -mno-serialize-volatile Xtensa options.\n+\t* config/xtensa/xtensa.c (print_operand): Do not emit MEMW instructions\n+\tunless TARGET_SERIALIZE_VOLATILE is enabled.\n+\t* config/xtensa/xtensa.md (*lsiu, *ssiu): Likewise.\n+\t* config/xtensa/xtensa.h (TARGET_DEFAULT): Add MASK_SERIALIZE_VOLATILE.\n+\t* config/xtensa/xtensa.opt (mserialize_volatile): New option.\n+\n 2008-03-14  Richard Guenther  <rguenther@suse.de>\n \n \tPR tree-optimization/34172"}, {"sha": "2fb0d345651ba5f492f987fa627f366f13918c06", "filename": "gcc/config/xtensa/xtensa.c", "status": "modified", "additions": 2, "deletions": 2, "changes": 4, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/66e58b33386f98d20ab6079c51f176c23e759795/gcc%2Fconfig%2Fxtensa%2Fxtensa.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/66e58b33386f98d20ab6079c51f176c23e759795/gcc%2Fconfig%2Fxtensa%2Fxtensa.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fconfig%2Fxtensa%2Fxtensa.c?ref=66e58b33386f98d20ab6079c51f176c23e759795", "patch": "@@ -1,5 +1,5 @@\n /* Subroutines for insn-output.c for Tensilica's Xtensa architecture.\n-   Copyright 2001, 2002, 2003, 2004, 2005, 2006, 2007\n+   Copyright 2001, 2002, 2003, 2004, 2005, 2006, 2007, 2008\n    Free Software Foundation, Inc.\n    Contributed by Bob Wilson (bwilson@tensilica.com) at Tensilica.\n \n@@ -1991,7 +1991,7 @@ print_operand (FILE *file, rtx x, int letter)\n \t{\n \t  /* For a volatile memory reference, emit a MEMW before the\n \t     load or store.  */\n-\t  if (MEM_VOLATILE_P (x))\n+\t  if (MEM_VOLATILE_P (x) && TARGET_SERIALIZE_VOLATILE)\n \t    fprintf (file, \"memw\\n\\t\");\n \t}\n       else"}, {"sha": "60fc78515b7d67ddc5cd03290d5f150392dd24cd", "filename": "gcc/config/xtensa/xtensa.h", "status": "modified", "additions": 4, "deletions": 3, "changes": 7, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/66e58b33386f98d20ab6079c51f176c23e759795/gcc%2Fconfig%2Fxtensa%2Fxtensa.h", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/66e58b33386f98d20ab6079c51f176c23e759795/gcc%2Fconfig%2Fxtensa%2Fxtensa.h", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fconfig%2Fxtensa%2Fxtensa.h?ref=66e58b33386f98d20ab6079c51f176c23e759795", "patch": "@@ -1,5 +1,5 @@\n /* Definitions of Tensilica's Xtensa target machine for GNU compiler.\n-   Copyright 2001, 2002, 2003, 2004, 2005, 2006, 2007\n+   Copyright 2001, 2002, 2003, 2004, 2005, 2006, 2007, 2008\n    Free Software Foundation, Inc.\n    Contributed by Bob Wilson (bwilson@tensilica.com) at Tensilica.\n \n@@ -74,8 +74,9 @@ extern unsigned xtensa_current_frame_size;\n #define TARGET_S32C1I\t\tXCHAL_HAVE_S32C1I\n #define TARGET_ABSOLUTE_LITERALS XSHAL_USE_ABSOLUTE_LITERALS\n \n-#define TARGET_DEFAULT (\t\t\t\t\t\t\\\n-  (XCHAL_HAVE_L32R\t? 0 : MASK_CONST16))\n+#define TARGET_DEFAULT \\\n+  ((XCHAL_HAVE_L32R\t? 0 : MASK_CONST16) |\t\t\t\t\\\n+   MASK_SERIALIZE_VOLATILE)\n \n #define OVERRIDE_OPTIONS override_options ()\n "}, {"sha": "541eba30732288e8e3fbbcc1a4d1e15e134e3e7a", "filename": "gcc/config/xtensa/xtensa.md", "status": "modified", "additions": 3, "deletions": 3, "changes": 6, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/66e58b33386f98d20ab6079c51f176c23e759795/gcc%2Fconfig%2Fxtensa%2Fxtensa.md", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/66e58b33386f98d20ab6079c51f176c23e759795/gcc%2Fconfig%2Fxtensa%2Fxtensa.md", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fconfig%2Fxtensa%2Fxtensa.md?ref=66e58b33386f98d20ab6079c51f176c23e759795", "patch": "@@ -1,5 +1,5 @@\n ;; GCC machine description for Tensilica's Xtensa architecture.\n-;; Copyright (C) 2001, 2002, 2003, 2004, 2005, 2006, 2007\n+;; Copyright (C) 2001, 2002, 2003, 2004, 2005, 2006, 2007, 2008\n ;; Free Software Foundation, Inc.\n ;; Contributed by Bob Wilson (bwilson@tensilica.com) at Tensilica.\n \n@@ -928,7 +928,7 @@\n \t(plus:SI (match_dup 1) (match_dup 2)))]\n   \"TARGET_HARD_FLOAT\"\n {\n-  if (volatile_refs_p (PATTERN (insn)))\n+  if (TARGET_SERIALIZE_VOLATILE && volatile_refs_p (PATTERN (insn)))\n     output_asm_insn (\"memw\", operands);\n   return \"lsiu\\t%0, %1, %2\";\n }\n@@ -944,7 +944,7 @@\n \t(plus:SI (match_dup 0) (match_dup 1)))]\n   \"TARGET_HARD_FLOAT\"\n {\n-  if (volatile_refs_p (PATTERN (insn)))\n+  if (TARGET_SERIALIZE_VOLATILE && volatile_refs_p (PATTERN (insn)))\n     output_asm_insn (\"memw\", operands);\n   return \"ssiu\\t%2, %0, %1\";\n }"}, {"sha": "0be75c4b69a26bb53a9443df01788a4a173e96bc", "filename": "gcc/config/xtensa/xtensa.opt", "status": "modified", "additions": 5, "deletions": 1, "changes": 6, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/66e58b33386f98d20ab6079c51f176c23e759795/gcc%2Fconfig%2Fxtensa%2Fxtensa.opt", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/66e58b33386f98d20ab6079c51f176c23e759795/gcc%2Fconfig%2Fxtensa%2Fxtensa.opt", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fconfig%2Fxtensa%2Fxtensa.opt?ref=66e58b33386f98d20ab6079c51f176c23e759795", "patch": "@@ -1,6 +1,6 @@\n ; Options for the Tensilica Xtensa port of the compiler.\n \n-; Copyright (C) 2005, 2007 Free Software Foundation, Inc.\n+; Copyright (C) 2005, 2007, 2008 Free Software Foundation, Inc.\n ;\n ; This file is part of GCC.\n ;\n@@ -37,3 +37,7 @@ Automatically align branch targets to reduce branch penalties\n mtext-section-literals\n Target\n Intersperse literal pools with code in the text section\n+\n+mserialize-volatile\n+Target Report Mask(SERIALIZE_VOLATILE)\n+-mno-serialize-volatile\tDo not serialize volatile memory references with MEMW instructions"}, {"sha": "27bf020d813a824b975fd93f6735d45365097433", "filename": "gcc/doc/invoke.texi", "status": "modified", "additions": 10, "deletions": 0, "changes": 10, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/66e58b33386f98d20ab6079c51f176c23e759795/gcc%2Fdoc%2Finvoke.texi", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/66e58b33386f98d20ab6079c51f176c23e759795/gcc%2Fdoc%2Finvoke.texi", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fdoc%2Finvoke.texi?ref=66e58b33386f98d20ab6079c51f176c23e759795", "patch": "@@ -800,6 +800,7 @@ See i386 and x86-64 Options.\n @emph{Xtensa Options}\n @gccoptlist{-mconst16 -mno-const16 @gol\n -mfused-madd  -mno-fused-madd @gol\n+-mserialize-volatile  -mno-serialize-volatile @gol\n -mtext-section-literals  -mno-text-section-literals @gol\n -mtarget-align  -mno-target-align @gol\n -mlongcalls  -mno-longcalls}\n@@ -14694,6 +14695,15 @@ add/subtract instructions also ensures that the program output is not\n sensitive to the compiler's ability to combine multiply and add/subtract\n operations.\n \n+@item -mserialize-volatile\n+@itemx -mno-serialize-volatile\n+@opindex mserialize-volatile\n+@opindex mno-serialize-volatile\n+When this option is enabled, GCC inserts @code{MEMW} instructions before\n+@code{volatile} memory references to guarantee sequential consistency.\n+The default is @option{-mserialize-volatile}.  Use\n+@option{-mno-serialize-volatile} to omit the @code{MEMW} instructions.\n+\n @item -mtext-section-literals\n @itemx -mno-text-section-literals\n @opindex mtext-section-literals"}]}