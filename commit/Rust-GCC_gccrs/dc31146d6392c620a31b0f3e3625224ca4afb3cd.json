{"sha": "dc31146d6392c620a31b0f3e3625224ca4afb3cd", "node_id": "C_kwDOANBUbNoAKGRjMzExNDZkNjM5MmM2MjBhMzFiMGYzZTM2MjUyMjRjYTRhZmIzY2Q", "commit": {"author": {"name": "Owen Avery", "email": "powerboat9.gamer@gmail.com", "date": "2023-01-11T17:05:39Z"}, "committer": {"name": "Owen Avery", "email": "powerboat9.gamer@gmail.com", "date": "2023-01-13T02:36:11Z"}, "message": "Change how CompileVarDecl outputs Bvariable's\n\nThis allows patterns to declare multiple/no variables\n\nSigned-off-by: Owen Avery <powerboat9.gamer@gmail.com>", "tree": {"sha": "f1dbb070cd9325053af8b7350b62f31ce5580808", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/f1dbb070cd9325053af8b7350b62f31ce5580808"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/dc31146d6392c620a31b0f3e3625224ca4afb3cd", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/dc31146d6392c620a31b0f3e3625224ca4afb3cd", "html_url": "https://github.com/Rust-GCC/gccrs/commit/dc31146d6392c620a31b0f3e3625224ca4afb3cd", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/dc31146d6392c620a31b0f3e3625224ca4afb3cd/comments", "author": {"login": "powerboat9", "id": 7397652, "node_id": "MDQ6VXNlcjczOTc2NTI=", "avatar_url": "https://avatars.githubusercontent.com/u/7397652?v=4", "gravatar_id": "", "url": "https://api.github.com/users/powerboat9", "html_url": "https://github.com/powerboat9", "followers_url": "https://api.github.com/users/powerboat9/followers", "following_url": "https://api.github.com/users/powerboat9/following{/other_user}", "gists_url": "https://api.github.com/users/powerboat9/gists{/gist_id}", "starred_url": "https://api.github.com/users/powerboat9/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/powerboat9/subscriptions", "organizations_url": "https://api.github.com/users/powerboat9/orgs", "repos_url": "https://api.github.com/users/powerboat9/repos", "events_url": "https://api.github.com/users/powerboat9/events{/privacy}", "received_events_url": "https://api.github.com/users/powerboat9/received_events", "type": "User", "site_admin": false}, "committer": {"login": "powerboat9", "id": 7397652, "node_id": "MDQ6VXNlcjczOTc2NTI=", "avatar_url": "https://avatars.githubusercontent.com/u/7397652?v=4", "gravatar_id": "", "url": "https://api.github.com/users/powerboat9", "html_url": "https://github.com/powerboat9", "followers_url": "https://api.github.com/users/powerboat9/followers", "following_url": "https://api.github.com/users/powerboat9/following{/other_user}", "gists_url": "https://api.github.com/users/powerboat9/gists{/gist_id}", "starred_url": "https://api.github.com/users/powerboat9/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/powerboat9/subscriptions", "organizations_url": "https://api.github.com/users/powerboat9/orgs", "repos_url": "https://api.github.com/users/powerboat9/repos", "events_url": "https://api.github.com/users/powerboat9/events{/privacy}", "received_events_url": "https://api.github.com/users/powerboat9/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "59cbecb75d3fd270094c2008343bf86f0c3bf80d", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/59cbecb75d3fd270094c2008343bf86f0c3bf80d", "html_url": "https://github.com/Rust-GCC/gccrs/commit/59cbecb75d3fd270094c2008343bf86f0c3bf80d"}], "stats": {"total": 30, "additions": 16, "deletions": 14}, "files": [{"sha": "5e7ab3195c3747747cf1b953b7e37971151c87a3", "filename": "gcc/rust/backend/rust-compile-base.cc", "status": "modified", "additions": 1, "deletions": 3, "changes": 4, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/dc31146d6392c620a31b0f3e3625224ca4afb3cd/gcc%2Frust%2Fbackend%2Frust-compile-base.cc", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/dc31146d6392c620a31b0f3e3625224ca4afb3cd/gcc%2Frust%2Fbackend%2Frust-compile-base.cc", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Frust%2Fbackend%2Frust-compile-base.cc?ref=dc31146d6392c620a31b0f3e3625224ca4afb3cd", "patch": "@@ -457,9 +457,7 @@ HIRCompileBase::compile_locals_for_block (Context *ctx, Resolver::Rib &rib,\n \n       // compile the local\n       tree type = TyTyResolveCompile::compile (ctx, tyty);\n-      Bvariable *compiled\n-\t= CompileVarDecl::compile (fndecl, type, pattern, ctx);\n-      locals.push_back (compiled);\n+      CompileVarDecl::compile (fndecl, type, pattern, locals, ctx);\n     }\n   return locals;\n }"}, {"sha": "a1dee2d770b0853699b769ccba194adb095a686a", "filename": "gcc/rust/backend/rust-compile-var-decl.h", "status": "modified", "additions": 15, "deletions": 11, "changes": 26, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/dc31146d6392c620a31b0f3e3625224ca4afb3cd/gcc%2Frust%2Fbackend%2Frust-compile-var-decl.h", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/dc31146d6392c620a31b0f3e3625224ca4afb3cd/gcc%2Frust%2Fbackend%2Frust-compile-var-decl.h", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Frust%2Fbackend%2Frust-compile-var-decl.h?ref=dc31146d6392c620a31b0f3e3625224ca4afb3cd", "patch": "@@ -30,39 +30,42 @@ class CompileVarDecl : public HIRCompileBase, public HIR::HIRPatternVisitor\n   using HIR::HIRPatternVisitor::visit;\n \n public:\n-  static ::Bvariable *compile (tree fndecl, tree translated_type,\n-\t\t\t       HIR::Pattern *pattern, Context *ctx)\n+  static void compile (tree fndecl, tree translated_type, HIR::Pattern *pattern,\n+\t\t       std::vector<Bvariable *> &locals, Context *ctx)\n   {\n-    CompileVarDecl compiler (ctx, fndecl, translated_type);\n+    CompileVarDecl compiler (ctx, fndecl, translated_type, locals);\n     pattern->accept_vis (compiler);\n-    return compiler.compiled_variable;\n   }\n \n   void visit (HIR::IdentifierPattern &pattern) override\n   {\n     if (!pattern.is_mut ())\n       translated_type = ctx->get_backend ()->immutable_type (translated_type);\n \n-    compiled_variable\n+    Bvariable *var\n       = ctx->get_backend ()->local_variable (fndecl, pattern.get_identifier (),\n \t\t\t\t\t     translated_type, NULL /*decl_var*/,\n \t\t\t\t\t     pattern.get_locus ());\n \n     HirId stmt_id = pattern.get_pattern_mappings ().get_hirid ();\n-    ctx->insert_var_decl (stmt_id, compiled_variable);\n+    ctx->insert_var_decl (stmt_id, var);\n+\n+    locals.push_back (var);\n   }\n \n   void visit (HIR::WildcardPattern &pattern) override\n   {\n     translated_type = ctx->get_backend ()->immutable_type (translated_type);\n \n-    compiled_variable\n+    Bvariable *var\n       = ctx->get_backend ()->local_variable (fndecl, \"_\", translated_type,\n \t\t\t\t\t     NULL /*decl_var*/,\n \t\t\t\t\t     pattern.get_locus ());\n \n     HirId stmt_id = pattern.get_pattern_mappings ().get_hirid ();\n-    ctx->insert_var_decl (stmt_id, compiled_variable);\n+    ctx->insert_var_decl (stmt_id, var);\n+\n+    locals.push_back (var);\n   }\n \n   // Empty visit for unused Pattern HIR nodes.\n@@ -78,15 +81,16 @@ class CompileVarDecl : public HIRCompileBase, public HIR::HIRPatternVisitor\n   void visit (HIR::TupleStructPattern &) override {}\n \n private:\n-  CompileVarDecl (Context *ctx, tree fndecl, tree translated_type)\n+  CompileVarDecl (Context *ctx, tree fndecl, tree translated_type,\n+\t\t  std::vector<Bvariable *> &locals)\n     : HIRCompileBase (ctx), fndecl (fndecl), translated_type (translated_type),\n-      compiled_variable (ctx->get_backend ()->error_variable ())\n+      locals (locals)\n   {}\n \n   tree fndecl;\n   tree translated_type;\n \n-  Bvariable *compiled_variable;\n+  std::vector<Bvariable *> &locals;\n };\n \n } // namespace Compile"}]}