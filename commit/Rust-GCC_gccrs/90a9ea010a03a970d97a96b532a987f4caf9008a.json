{"sha": "90a9ea010a03a970d97a96b532a987f4caf9008a", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6OTBhOWVhMDEwYTAzYTk3MGQ5N2E5NmI1MzJhOTg3ZjRjYWY5MDA4YQ==", "commit": {"author": {"name": "Ian Lance Taylor", "email": "ian@gcc.gnu.org", "date": "2011-12-13T23:15:36Z"}, "committer": {"name": "Ian Lance Taylor", "email": "ian@gcc.gnu.org", "date": "2011-12-13T23:15:36Z"}, "message": "runtime: Change gc_test to test only newly allocated memory.\n\nFrom-SVN: r182315", "tree": {"sha": "f91783d65584efb8f8cd6823ca20d56da2458519", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/f91783d65584efb8f8cd6823ca20d56da2458519"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/90a9ea010a03a970d97a96b532a987f4caf9008a", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/90a9ea010a03a970d97a96b532a987f4caf9008a", "html_url": "https://github.com/Rust-GCC/gccrs/commit/90a9ea010a03a970d97a96b532a987f4caf9008a", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/90a9ea010a03a970d97a96b532a987f4caf9008a/comments", "author": null, "committer": null, "parents": [{"sha": "c915f63f7324de03f233803667d6401088fec783", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/c915f63f7324de03f233803667d6401088fec783", "html_url": "https://github.com/Rust-GCC/gccrs/commit/c915f63f7324de03f233803667d6401088fec783"}], "stats": {"total": 16, "additions": 12, "deletions": 4}, "files": [{"sha": "156d3bc7d30264675103696ef2c388be6fd3e74e", "filename": "libgo/go/runtime/gc_test.go", "status": "modified", "additions": 12, "deletions": 4, "changes": 16, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/90a9ea010a03a970d97a96b532a987f4caf9008a/libgo%2Fgo%2Fruntime%2Fgc_test.go", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/90a9ea010a03a970d97a96b532a987f4caf9008a/libgo%2Fgo%2Fruntime%2Fgc_test.go", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libgo%2Fgo%2Fruntime%2Fgc_test.go?ref=90a9ea010a03a970d97a96b532a987f4caf9008a", "patch": "@@ -6,16 +6,24 @@ import (\n )\n \n func TestGcSys(t *testing.T) {\n+\truntime.GC()\n+\truntime.UpdateMemStats()\n+\tsys := runtime.MemStats.Sys\n+\n \tfor i := 0; i < 1000000; i++ {\n \t\tworkthegc()\n \t}\n \n \t// Should only be using a few MB.\n \truntime.UpdateMemStats()\n-\tsys := runtime.MemStats.Sys\n-\tt.Logf(\"using %d MB\", sys>>20)\n-\tif sys > 10e6 {\n-\t\tt.Fatalf(\"using too much memory: %d MB\", sys>>20)\n+\tif sys > runtime.MemStats.Sys {\n+\t\tsys = 0\n+\t} else {\n+\t\tsys = runtime.MemStats.Sys - sys\n+\t}\n+\tt.Logf(\"used %d extra bytes\", sys)\n+\tif sys > 2<<20 {\n+\t\tt.Fatalf(\"using too much memory: %d bytes\", sys)\n \t}\n }\n "}]}