{"sha": "26f74aa3f74d5efd8cd37bfe3700f16f400189c1", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6MjZmNzRhYTNmNzRkNWVmZDhjZDM3YmZlMzcwMGYxNmY0MDAxODljMQ==", "commit": {"author": {"name": "Jan Hubicka", "email": "jh@suse.cz", "date": "2003-04-24T15:53:22Z"}, "committer": {"name": "Jan Hubicka", "email": "hubicka@gcc.gnu.org", "date": "2003-04-24T15:53:22Z"}, "message": "re PR c/10308 ([x86] ICE with -O -fgcse or -O2)\n\n\t* cfgbuild.c (make_edges):  Do not use next_nonnote_insn when\n\tlooking for fallthru edge.\n\n\t* athlon.md (athlon-agu, athlon-store, athlon-fany, athlon-faddmul):\n\tFix.\n\t(athlon-load2, athlon-store2, athlon-fpsched, athlon-fpload,\n\tathlon-fvector): New.\n\t(athlon_*): Revisit to match new optimization guide.\n\t* i386.c (ix86_adjust_cost):  Fix memory operand costs on Athlon/k8\n\t* i386.md (cvt??2?? patterns): Fix modes.\n\t(fistp patterns): Set modes.\n\n\tAccidentaly commited with my earlier reload patch:\n\tPR c/10308\n\t* reload.c (find_reloads_address_1): Reload plus at the place of\n\tindex register.\n\nFrom-SVN: r66037", "tree": {"sha": "42dda3f08919effac46e44408e208494d0509e12", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/42dda3f08919effac46e44408e208494d0509e12"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/26f74aa3f74d5efd8cd37bfe3700f16f400189c1", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/26f74aa3f74d5efd8cd37bfe3700f16f400189c1", "html_url": "https://github.com/Rust-GCC/gccrs/commit/26f74aa3f74d5efd8cd37bfe3700f16f400189c1", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/26f74aa3f74d5efd8cd37bfe3700f16f400189c1/comments", "author": null, "committer": null, "parents": [{"sha": "796621e8c274bfce5c7f3f1d23126267b91f102f", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/796621e8c274bfce5c7f3f1d23126267b91f102f", "html_url": "https://github.com/Rust-GCC/gccrs/commit/796621e8c274bfce5c7f3f1d23126267b91f102f"}], "stats": {"total": 668, "additions": 464, "deletions": 204}, "files": [{"sha": "9c916bb5a24bc11fd77ee094adf77d0ba71e4263", "filename": "gcc/ChangeLog", "status": "modified", "additions": 19, "deletions": 0, "changes": 19, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/26f74aa3f74d5efd8cd37bfe3700f16f400189c1/gcc%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/26f74aa3f74d5efd8cd37bfe3700f16f400189c1/gcc%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2FChangeLog?ref=26f74aa3f74d5efd8cd37bfe3700f16f400189c1", "patch": "@@ -1,3 +1,22 @@\n+Thu Apr 24 16:55:26 CEST 2003  Jan Hubicka  <jh@suse.cz>\n+\n+\t* cfgbuild.c (make_edges):  Do not use next_nonnote_insn when\n+\tlooking for fallthru edge.\n+\n+\t* athlon.md (athlon-agu, athlon-store, athlon-fany, athlon-faddmul):\n+\tFix.\n+\t(athlon-load2, athlon-store2, athlon-fpsched, athlon-fpload,\n+\tathlon-fvector): New.\n+\t(athlon_*): Revisit to match new optimization guide.\n+\t* i386.c (ix86_adjust_cost):  Fix memory operand costs on Athlon/k8\n+\t* i386.md (cvt??2?? patterns): Fix modes.\n+\t(fistp patterns): Set modes.\n+\n+\tAccidentaly commited with my earlier reload patch:\n+\tPR c/10308\n+\t* reload.c (find_reloads_address_1): Reload plus at the place of\n+\tindex register.\n+\t\n 2003-04-24  Nathan Sidwell  <nathan@codesourcery.com>\n \n \tNew GCOV_TAG_FUNCTION layout"}, {"sha": "69fcc15294b57598243a0cb216856865f2ec6047", "filename": "gcc/cfgbuild.c", "status": "modified", "additions": 7, "deletions": 5, "changes": 12, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/26f74aa3f74d5efd8cd37bfe3700f16f400189c1/gcc%2Fcfgbuild.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/26f74aa3f74d5efd8cd37bfe3700f16f400189c1/gcc%2Fcfgbuild.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fcfgbuild.c?ref=26f74aa3f74d5efd8cd37bfe3700f16f400189c1", "patch": "@@ -439,15 +439,17 @@ make_edges (label_value_list, min, max, update_p)\n \t}\n \n       /* Find out if we can drop through to the next block.  */\n-      insn = next_nonnote_insn (insn);\n+      insn = NEXT_INSN (insn);\n+      while (insn\n+\t     && GET_CODE (insn) == NOTE\n+\t     && NOTE_LINE_NUMBER (insn) != NOTE_INSN_BASIC_BLOCK)\n+\tinsn = NEXT_INSN (insn);\n+\n       if (!insn || (bb->next_bb == EXIT_BLOCK_PTR && force_fallthru))\n \tcached_make_edge (edge_cache, bb, EXIT_BLOCK_PTR, EDGE_FALLTHRU);\n       else if (bb->next_bb != EXIT_BLOCK_PTR)\n \t{\n-\t  rtx tmp = bb->next_bb->head;\n-\t  if (GET_CODE (tmp) == NOTE)\n-\t    tmp = next_nonnote_insn (tmp);\n-\t  if (force_fallthru || insn == tmp)\n+\t  if (force_fallthru || insn == bb->next_bb->head)\n \t    cached_make_edge (edge_cache, bb, bb->next_bb, EDGE_FALLTHRU);\n \t}\n     }"}, {"sha": "8f0abf493577ef7fea1ea4da9c0b2ac42a08e639", "filename": "gcc/config/i386/athlon.md", "status": "modified", "additions": 379, "deletions": 175, "changes": 554, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/26f74aa3f74d5efd8cd37bfe3700f16f400189c1/gcc%2Fconfig%2Fi386%2Fathlon.md", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/26f74aa3f74d5efd8cd37bfe3700f16f400189c1/gcc%2Fconfig%2Fi386%2Fathlon.md", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fconfig%2Fi386%2Fathlon.md?ref=26f74aa3f74d5efd8cd37bfe3700f16f400189c1", "patch": "@@ -89,62 +89,84 @@\n ;(define_cpu_unit \"athlon-agu1\" \"athlon_agu\")\n ;(define_cpu_unit \"athlon-agu2\" \"athlon_agu\")\n ;(define_reservation \"athlon-agu\" \"(athlon-agu0 | athlon-agu1 | athlon-agu2)\")\n-(define_reservation \"athlon-agu\" \"nothing,nothing\")\n+(define_reservation \"athlon-agu\" \"nothing\")\n \n (define_cpu_unit \"athlon-mult\" \"athlon_mult\")\n \n (define_cpu_unit \"athlon-load0\" \"athlon_load\")\n (define_cpu_unit \"athlon-load1\" \"athlon_load\")\n (define_reservation \"athlon-load\" \"athlon-agu,\n-\t\t\t\t   (athlon-load0 | athlon-load1)\")\n-(define_reservation \"athlon-store\" \"nothing\")\n+\t\t\t\t   (athlon-load0 | athlon-load1),nothing\")\n+;; 128bit SSE instructions issue two loads at once\n+(define_reservation \"athlon-load2\" \"athlon-agu,\n+\t\t\t\t   (athlon-load0 + athlon-load1),nothing\")\n+\n+(define_reservation \"athlon-store\" \"(athlon-load0 | athlon-load1)\")\n+;; 128bit SSE instructions issue two stores at once\n+(define_reservation \"athlon-store2\" \"(athlon-load0 + athlon-load1)\")\n+\n+\n+;; The FP operations start to execute at stage 12 in the pipeline, while\n+;; integer operations start to execute at stage 9 for Athlon and 11 for K8\n+;; Compensate the difference for Athlon because it results in significantly\n+;; smaller automata.\n+(define_reservation \"athlon-fpsched\" \"nothing,nothing,nothing\")\n+;; The floating point loads.\n+(define_reservation \"athlon-fpload\" \"(athlon-fpsched + athlon-load)\")\n+(define_reservation \"athlon-fpload2\" \"(athlon-fpsched + athlon-load2)\")\n+(define_reservation \"athlon-fploadk8\" \"(athlon-fpsched + athlon-load)\")\n+(define_reservation \"athlon-fpload2k8\" \"(athlon-fpsched + athlon-load2)\")\n+\n \n ;; The three fp units are fully pipelined with latency of 3\n (define_cpu_unit \"athlon-fadd\" \"athlon_fp\")\n (define_cpu_unit \"athlon-fmul\" \"athlon_fp\")\n (define_cpu_unit \"athlon-fstore\" \"athlon_fp\")\n-(define_reservation \"athlon-fany\" \"(athlon-fadd | athlon-fmul | athlon-fstore)\")\n-(define_reservation \"athlon-faddmul\" \"(athlon-fadd | athlon-fmul)\")\n+(define_reservation \"athlon-fany\" \"(athlon-fstore | athlon-fmul | athlon-fadd)\")\n+(define_reservation \"athlon-faddmul\" \"(athlon-fmul | athlon-fadd)\")\n+\n+;; Vector operations usually consume many of pipes.\n+(define_reservation \"athlon-fvector\" \"(athlon-fadd + athlon-fmul + athlon-fstore)\")\n \n \n ;; Jump instructions are executed in the branch unit completely transparent to us\n (define_insn_reservation \"athlon_branch\" 0\n \t\t\t (and (eq_attr \"cpu\" \"athlon,k8\")\n \t\t\t      (eq_attr \"type\" \"ibr\"))\n-\t\t\t \"athlon-direct\")\n+\t\t\t \"athlon-direct,athlon-ieu\")\n (define_insn_reservation \"athlon_call\" 0\n \t\t\t (and (eq_attr \"cpu\" \"athlon,k8\")\n \t\t\t      (eq_attr \"type\" \"call,callv\"))\n-\t\t\t \"athlon-vector\")\n+\t\t\t \"athlon-vector,athlon-ieu\")\n \n ;; Latency of push operation is 3 cycles, but ESP value is available\n ;; earlier\n (define_insn_reservation \"athlon_push\" 2\n \t\t\t (and (eq_attr \"cpu\" \"athlon,k8\")\n \t\t\t      (eq_attr \"type\" \"push\"))\n-\t\t\t \"athlon-direct,nothing,athlon-store\")\n+\t\t\t \"athlon-direct,athlon-agu,athlon-store\")\n (define_insn_reservation \"athlon_pop\" 4\n \t\t\t (and (eq_attr \"cpu\" \"athlon,k8\")\n \t\t\t      (eq_attr \"type\" \"pop\"))\n-\t\t\t \"athlon-vector,athlon-ieu,athlon-load\")\n+\t\t\t \"athlon-vector,athlon-load,athlon-ieu\")\n (define_insn_reservation \"athlon_pop_k8\" 3\n \t\t\t (and (eq_attr \"cpu\" \"k8\")\n \t\t\t      (eq_attr \"type\" \"pop\"))\n-\t\t\t \"athlon-double,athlon-ieu,athlon-load\")\n+\t\t\t \"athlon-double,(athlon-ieu+athlon-load)\")\n (define_insn_reservation \"athlon_leave\" 3\n \t\t\t (and (eq_attr \"cpu\" \"athlon\")\n \t\t\t      (eq_attr \"type\" \"leave\"))\n-\t\t\t \"athlon-vector,athlon-load\")\n+\t\t\t \"athlon-vector,(athlon-ieu+athlon-load)\")\n (define_insn_reservation \"athlon_leave_k8\" 3\n \t\t\t (and (eq_attr \"cpu\" \"k8\")\n \t\t\t      (eq_attr \"type\" \"leave\"))\n-\t\t\t \"athlon-double,athlon-load\")\n+\t\t\t \"athlon-double,(athlon-ieu+athlon-load)\")\n \n ;; Lea executes in AGU unit with 2 cycles latency.\n (define_insn_reservation \"athlon_lea\" 2\n \t\t\t (and (eq_attr \"cpu\" \"athlon,k8\")\n \t\t\t      (eq_attr \"type\" \"lea\"))\n-\t\t\t \"athlon-direct,athlon-agu\")\n+\t\t\t \"athlon-direct,athlon-agu,nothing\")\n \n ;; Mul executes in special multiplier unit attached to IEU0\n (define_insn_reservation \"athlon_imul\" 5\n@@ -180,21 +202,31 @@\n \t\t\t      (and (eq_attr \"type\" \"imul\")\n \t\t\t\t   (eq_attr \"memory\" \"load,both\")))\n \t\t\t \"athlon-vector,athlon-load,athlon-ieu,athlon-mult,athlon-ieu\")\n-(define_insn_reservation \"athlon_idiv\" 42\n+\n+;; Idiv can not execute in parallel with other instructions.  Dealing with it\n+;; as with short latency vector instruction is good approximation avoiding\n+;; scheduler from trying too hard to can hide it's latency by overlap with\n+;; other instructions.\n+;; ??? Experiments show that the idiv can overlap with roughly 6 cycles\n+;; of the other code\n+\n+(define_insn_reservation \"athlon_idiv\" 6\n \t\t\t (and (eq_attr \"cpu\" \"athlon,k8\")\n \t\t\t      (and (eq_attr \"type\" \"idiv\")\n \t\t\t\t   (eq_attr \"memory\" \"none,unknown\")))\n-\t\t\t \"athlon-vector,athlon-ieu*42\")\n-(define_insn_reservation \"athlon_idiv_mem\" 45\n+\t\t\t \"athlon-vector,(athlon-ieu0*6+(athlon-fpsched,athlon-fvector))\")\n+(define_insn_reservation \"athlon_idiv_mem\" 9\n \t\t\t (and (eq_attr \"cpu\" \"athlon,k8\")\n \t\t\t      (and (eq_attr \"type\" \"idiv\")\n \t\t\t\t   (eq_attr \"memory\" \"load,both\")))\n-\t\t\t \"athlon-vector,athlon-load,athlon-ieu*42\")\n-(define_insn_reservation \"athlon_str\" 15\n+\t\t\t \"athlon-vector,((athlon-load,athlon-ieu0*6)+(athlon-fpsched,athlon-fvector))\")\n+;; The paralelism of string instructions is not documented.  Model it same way\n+;; as idiv to create smaller automata.  This probably does not matter much.\n+(define_insn_reservation \"athlon_str\" 6\n \t\t\t (and (eq_attr \"cpu\" \"athlon,k8\")\n \t\t\t      (and (eq_attr \"type\" \"str\")\n \t\t\t\t   (eq_attr \"memory\" \"load,both,store\")))\n-\t\t\t \"athlon-vector,athlon-load,athlon-ieu*10\")\n+\t\t\t \"athlon-vector,athlon-load,athlon-ieu0*6\")\n \n (define_insn_reservation \"athlon_idirect\" 1\n \t\t\t (and (eq_attr \"cpu\" \"athlon,k8\")\n@@ -235,28 +267,31 @@\n \t\t\t      (and (eq_attr \"athlon_decode\" \"direct\")\n \t\t\t\t   (and (eq_attr \"unit\" \"integer,unknown\")\n \t\t\t\t\t(eq_attr \"memory\" \"both\"))))\n-\t\t\t \"athlon-direct,athlon-load,athlon-ieu,\n+\t\t\t \"athlon-direct,athlon-load,\n+\t\t\t  athlon-ieu,athlon-store,\n \t\t\t  athlon-store\")\n (define_insn_reservation \"athlon_ivector_both\" 6\n \t\t\t (and (eq_attr \"cpu\" \"athlon,k8\")\n \t\t\t      (and (eq_attr \"athlon_decode\" \"vector\")\n \t\t\t\t   (and (eq_attr \"unit\" \"integer,unknown\")\n \t\t\t\t\t(eq_attr \"memory\" \"both\"))))\n-\t\t\t \"athlon-vector,athlon-load,athlon-ieu,athlon-ieu,\n+\t\t\t \"athlon-vector,athlon-load,\n+\t\t\t  athlon-ieu,\n+\t\t\t  athlon-ieu,\n \t\t\t  athlon-store\")\n (define_insn_reservation \"athlon_idirect_store\" 1\n \t\t\t (and (eq_attr \"cpu\" \"athlon,k8\")\n \t\t\t      (and (eq_attr \"athlon_decode\" \"direct\")\n \t\t\t\t   (and (eq_attr \"unit\" \"integer,unknown\")\n \t\t\t\t\t(eq_attr \"memory\" \"store\"))))\n-\t\t\t \"athlon-direct,athlon-ieu,\n+\t\t\t \"athlon-direct,(athlon-ieu+athlon-agu),\n \t\t\t  athlon-store\")\n (define_insn_reservation \"athlon_ivector_store\" 2\n \t\t\t (and (eq_attr \"cpu\" \"athlon,k8\")\n \t\t\t      (and (eq_attr \"athlon_decode\" \"vector\")\n \t\t\t\t   (and (eq_attr \"unit\" \"integer,unknown\")\n \t\t\t\t\t(eq_attr \"memory\" \"store\"))))\n-\t\t\t \"athlon-vector,athlon-ieu,athlon-ieu,\n+\t\t\t \"athlon-vector,(athlon-ieu+athlon-agu),athlon-ieu,\n \t\t\t  athlon-store\")\n \n ;; Athlon floatin point unit\n@@ -265,401 +300,570 @@\n \t\t\t      (and (eq_attr \"type\" \"fmov\")\n \t\t\t\t   (and (eq_attr \"memory\" \"load\")\n \t\t\t\t\t(eq_attr \"mode\" \"XF\"))))\n-\t\t\t \"athlon-vector,athlon-fany\")\n+\t\t\t \"athlon-vector,athlon-fpload2,athlon-fvector*9\")\n (define_insn_reservation \"athlon_fldxf_k8\" 13\n \t\t\t (and (eq_attr \"cpu\" \"k8\")\n \t\t\t      (and (eq_attr \"type\" \"fmov\")\n \t\t\t\t   (and (eq_attr \"memory\" \"load\")\n \t\t\t\t\t(eq_attr \"mode\" \"XF\"))))\n-\t\t\t \"athlon-vector,athlon-fany\")\n-(define_insn_reservation \"athlon_fld\" 6\n+\t\t\t \"athlon-vector,athlon-fpload2k8,athlon-fvector*9\")\n+;; Assume superforwarding to take place so effective latency of fany op is 0.\n+(define_insn_reservation \"athlon_fld\" 0\n \t\t\t (and (eq_attr \"cpu\" \"athlon\")\n \t\t\t      (and (eq_attr \"type\" \"fmov\")\n \t\t\t\t   (eq_attr \"memory\" \"load\")))\n-\t\t\t \"athlon-direct,athlon-fany,nothing,athlon-load\")\n-(define_insn_reservation \"athlon_fld_k8\" 4\n+\t\t\t \"athlon-direct,athlon-fpload,athlon-fany\")\n+(define_insn_reservation \"athlon_fld_k8\" 2\n \t\t\t (and (eq_attr \"cpu\" \"k8\")\n \t\t\t      (and (eq_attr \"type\" \"fmov\")\n \t\t\t\t   (eq_attr \"memory\" \"load\")))\n-\t\t\t \"athlon-direct,athlon-fany,athlon-load\")\n+\t\t\t \"athlon-direct,athlon-fploadk8,athlon-fstore\")\n+\n (define_insn_reservation \"athlon_fstxf\" 10\n \t\t\t (and (eq_attr \"cpu\" \"athlon\")\n \t\t\t      (and (eq_attr \"type\" \"fmov\")\n \t\t\t\t   (and (eq_attr \"memory\" \"store,both\")\n \t\t\t\t\t(eq_attr \"mode\" \"XF\"))))\n-\t\t\t \"athlon-vector,athlon-fstore\")\n+\t\t\t \"athlon-vector,(athlon-fpsched+athlon-agu),(athlon-store2+(athlon-fvector*7))\")\n (define_insn_reservation \"athlon_fstxf_k8\" 8\n \t\t\t (and (eq_attr \"cpu\" \"k8\")\n \t\t\t      (and (eq_attr \"type\" \"fmov\")\n \t\t\t\t   (and (eq_attr \"memory\" \"store,both\")\n \t\t\t\t\t(eq_attr \"mode\" \"XF\"))))\n-\t\t\t \"athlon-vector,athlon-fstore\")\n+\t\t\t \"athlon-vector,(athlon-fpsched+athlon-agu),(athlon-store2+(athlon-fvector*6))\")\n (define_insn_reservation \"athlon_fst\" 4\n \t\t\t (and (eq_attr \"cpu\" \"athlon\")\n \t\t\t      (and (eq_attr \"type\" \"fmov\")\n \t\t\t\t   (eq_attr \"memory\" \"store,both\")))\n-\t\t\t \"athlon-direct,athlon-fstore,nothing,athlon-store\")\n+\t\t\t \"athlon-direct,(athlon-fpsched+athlon-agu),(athlon-fstore+athlon-store)\")\n (define_insn_reservation \"athlon_fst_k8\" 2\n \t\t\t (and (eq_attr \"cpu\" \"k8\")\n \t\t\t      (and (eq_attr \"type\" \"fmov\")\n \t\t\t\t   (eq_attr \"memory\" \"store,both\")))\n-\t\t\t \"athlon-direct,athlon-fstore,athlon-store\")\n+\t\t\t \"athlon-direct,(athlon-fpsched+athlon-agu),(athlon-fstore+athlon-store)\")\n (define_insn_reservation \"athlon_fist\" 4\n \t\t\t (and (eq_attr \"cpu\" \"athlon,k8\")\n \t\t\t      (eq_attr \"type\" \"fistp\"))\n-\t\t\t \"athlon-direct,athlon-fstore,nothing\")\n+\t\t\t \"athlon-direct,(athlon-fpsched+athlon-agu),(athlon-fstore+athlon-store)\")\n (define_insn_reservation \"athlon_fmov\" 2\n \t\t\t (and (eq_attr \"cpu\" \"athlon,k8\")\n \t\t\t      (eq_attr \"type\" \"fmov\"))\n-\t\t\t \"athlon-direct,athlon-faddmul\")\n-(define_insn_reservation \"athlon_fadd_load\" 7\n+\t\t\t \"athlon-direct,athlon-fpsched,athlon-faddmul\")\n+(define_insn_reservation \"athlon_fadd_load\" 4\n \t\t\t (and (eq_attr \"cpu\" \"athlon\")\n \t\t\t      (and (eq_attr \"type\" \"fop\")\n \t\t\t\t   (eq_attr \"memory\" \"load\")))\n-\t\t\t \"athlon-direct,athlon-load,athlon-fadd\")\n+\t\t\t \"athlon-direct,athlon-fpload,athlon-fadd\")\n (define_insn_reservation \"athlon_fadd_load_k8\" 6\n \t\t\t (and (eq_attr \"cpu\" \"k8\")\n \t\t\t      (and (eq_attr \"type\" \"fop\")\n \t\t\t\t   (eq_attr \"memory\" \"load\")))\n-\t\t\t \"athlon-direct,athlon-load,athlon-fadd\")\n+\t\t\t \"athlon-direct,athlon-fploadk8,athlon-fadd\")\n (define_insn_reservation \"athlon_fadd\" 4\n \t\t\t (and (eq_attr \"cpu\" \"athlon,k8\")\n \t\t\t      (eq_attr \"type\" \"fop\"))\n-\t\t\t \"athlon-direct,athlon-fadd\")\n-(define_insn_reservation \"athlon_fmul_load\" 7\n+\t\t\t \"athlon-direct,athlon-fpsched,athlon-fadd\")\n+(define_insn_reservation \"athlon_fmul_load\" 4\n \t\t\t (and (eq_attr \"cpu\" \"athlon\")\n \t\t\t      (and (eq_attr \"type\" \"fmul\")\n \t\t\t\t   (eq_attr \"memory\" \"load\")))\n-\t\t\t \"athlon-direct,athlon-load,athlon-fmul\")\n+\t\t\t \"athlon-direct,athlon-fpload,athlon-fmul\")\n (define_insn_reservation \"athlon_fmul_load_k8\" 6\n \t\t\t (and (eq_attr \"cpu\" \"k8\")\n \t\t\t      (and (eq_attr \"type\" \"fmul\")\n \t\t\t\t   (eq_attr \"memory\" \"load\")))\n-\t\t\t \"athlon-direct,athlon-load,athlon-fmul\")\n+\t\t\t \"athlon-direct,athlon-fploadk8,athlon-fmul\")\n (define_insn_reservation \"athlon_fmul\" 4\n \t\t\t (and (eq_attr \"cpu\" \"athlon,k8\")\n \t\t\t      (eq_attr \"type\" \"fmul\"))\n-\t\t\t \"athlon-direct,athlon-fmul\")\n+\t\t\t \"athlon-direct,athlon-fpsched,athlon-fmul\")\n (define_insn_reservation \"athlon_fsgn\" 2\n \t\t\t (and (eq_attr \"cpu\" \"athlon,k8\")\n \t\t\t      (eq_attr \"type\" \"fsgn\"))\n-\t\t\t \"athlon-direct,athlon-fmul\")\n+\t\t\t \"athlon-direct,athlon-fpsched,athlon-fmul\")\n (define_insn_reservation \"athlon_fdiv_load\" 24\n \t\t\t (and (eq_attr \"cpu\" \"athlon\")\n \t\t\t      (and (eq_attr \"type\" \"fdiv\")\n \t\t\t\t   (eq_attr \"memory\" \"load\")))\n-\t\t\t \"athlon-direct,athlon-load,athlon-fmul\")\n+\t\t\t \"athlon-direct,athlon-fpload,athlon-fmul\")\n (define_insn_reservation \"athlon_fdiv_load_k8\" 13\n \t\t\t (and (eq_attr \"cpu\" \"k8\")\n \t\t\t      (and (eq_attr \"type\" \"fdiv\")\n \t\t\t\t   (eq_attr \"memory\" \"load\")))\n-\t\t\t \"athlon-direct,athlon-load,athlon-fmul\")\n+\t\t\t \"athlon-direct,athlon-fploadk8,athlon-fmul\")\n (define_insn_reservation \"athlon_fdiv\" 24\n \t\t\t (and (eq_attr \"cpu\" \"athlon\")\n \t\t\t      (eq_attr \"type\" \"fdiv\"))\n-\t\t\t \"athlon-direct,athlon-fmul\")\n+\t\t\t \"athlon-direct,athlon-fpsched,athlon-fmul\")\n (define_insn_reservation \"athlon_fdiv_k8\" 11\n \t\t\t (and (eq_attr \"cpu\" \"k8\")\n \t\t\t      (eq_attr \"type\" \"fdiv\"))\n-\t\t\t \"athlon-direct,athlon-fmul\")\n+\t\t\t \"athlon-direct,athlon-fpsched,athlon-fmul\")\n (define_insn_reservation \"athlon_fpspc_load\" 103\n \t\t\t (and (eq_attr \"cpu\" \"athlon,k8\")\n \t\t\t      (and (eq_attr \"type\" \"fpspc\")\n \t\t\t\t   (eq_attr \"memory\" \"load\")))\n-\t\t\t \"athlon-vector,athlon-load,athlon-fmul\")\n+\t\t\t \"athlon-vector,athlon-fpload,athlon-fvector\")\n (define_insn_reservation \"athlon_fpspc\" 100\n \t\t\t (and (eq_attr \"cpu\" \"athlon,k8\")\n \t\t\t      (eq_attr \"type\" \"fpspc\"))\n-\t\t\t \"athlon-vector,athlon-fmul\")\n-(define_insn_reservation \"athlon_fcmov_load\" 10\n+\t\t\t \"athlon-vector,athlon-fpsched,athlon-fvector\")\n+(define_insn_reservation \"athlon_fcmov_load\" 7\n \t\t\t (and (eq_attr \"cpu\" \"athlon\")\n \t\t\t      (and (eq_attr \"type\" \"fcmov\")\n \t\t\t\t   (eq_attr \"memory\" \"load\")))\n-\t\t\t \"athlon-vector,athlon-load,athlon-fmul\")\n+\t\t\t \"athlon-vector,athlon-fpload,athlon-fvector\")\n (define_insn_reservation \"athlon_fcmov\" 7\n \t\t\t (and (eq_attr \"cpu\" \"athlon\")\n \t\t\t      (eq_attr \"type\" \"fcmov\"))\n-\t\t\t \"athlon-vector,athlon-fmul\")\n+\t\t\t \"athlon-vector,athlon-fpsched,athlon-fvector\")\n (define_insn_reservation \"athlon_fcmov_load_k8\" 17\n \t\t\t (and (eq_attr \"cpu\" \"k8\")\n \t\t\t      (and (eq_attr \"type\" \"fcmov\")\n \t\t\t\t   (eq_attr \"memory\" \"load\")))\n-\t\t\t \"athlon-vector,athlon-load,athlon-fmul\")\n+\t\t\t \"athlon-vector,athlon-fploadk8,athlon-fvector\")\n (define_insn_reservation \"athlon_fcmov_k8\" 15\n \t\t\t (and (eq_attr \"cpu\" \"k8\")\n \t\t\t      (eq_attr \"type\" \"fcmov\"))\n-\t\t\t \"athlon-vector,athlon-fmul\")\n-(define_insn_reservation \"athlon_fcomi_load\" 6\n+\t\t\t \"athlon-vector,athlon-fpsched,athlon-fvector\")\n+;; fcomi is vector decoded by uses only one pipe.\n+(define_insn_reservation \"athlon_fcomi_load\" 3\n \t\t\t (and (eq_attr \"cpu\" \"athlon\")\n \t\t\t      (and (eq_attr \"type\" \"fcmp\")\n \t\t\t\t   (and (eq_attr \"athlon_decode\" \"vector\")\n \t\t\t\t        (eq_attr \"memory\" \"load\"))))\n-\t\t\t \"athlon-vector,athlon-load,athlon-fadd\")\n+\t\t\t \"athlon-vector,athlon-fpload,athlon-fadd\")\n+(define_insn_reservation \"athlon_fcomi_load_k8\" 5\n+\t\t\t (and (eq_attr \"cpu\" \"k8\")\n+\t\t\t      (and (eq_attr \"type\" \"fcmp\")\n+\t\t\t\t   (and (eq_attr \"athlon_decode\" \"vector\")\n+\t\t\t\t        (eq_attr \"memory\" \"load\"))))\n+\t\t\t \"athlon-vector,athlon-fploadk8,athlon-fadd\")\n (define_insn_reservation \"athlon_fcomi\" 3\n \t\t\t (and (eq_attr \"cpu\" \"athlon,k8\")\n \t\t\t      (and (eq_attr \"athlon_decode\" \"vector\")\n \t\t\t\t   (eq_attr \"type\" \"fcmp\")))\n-\t\t\t \"athlon-vector,athlon-fadd\")\n-(define_insn_reservation \"athlon_fcom_load\" 5\n-\t\t\t (and (eq_attr \"cpu\" \"athlon,k8\")\n+\t\t\t \"athlon-vector,athlon-fpsched,athlon-fadd\")\n+(define_insn_reservation \"athlon_fcom_load\" 2\n+\t\t\t (and (eq_attr \"cpu\" \"athlon\")\n+\t\t\t      (and (eq_attr \"type\" \"fcmp\")\n+\t\t\t\t   (eq_attr \"memory\" \"load\")))\n+\t\t\t \"athlon-direct,athlon-fpload,athlon-fadd\")\n+(define_insn_reservation \"athlon_fcom_load_k8\" 4\n+\t\t\t (and (eq_attr \"cpu\" \"k8\")\n \t\t\t      (and (eq_attr \"type\" \"fcmp\")\n \t\t\t\t   (eq_attr \"memory\" \"load\")))\n-\t\t\t \"athlon-direct,athlon-load,athlon-fadd\")\n+\t\t\t \"athlon-direct,athlon-fploadk8,athlon-fadd\")\n (define_insn_reservation \"athlon_fcom\" 2\n \t\t\t (and (eq_attr \"cpu\" \"athlon,k8\")\n \t\t\t      (eq_attr \"type\" \"fcmp\"))\n-\t\t\t \"athlon-direct,athlon-fadd\")\n-(define_insn_reservation \"athlon_fxch\" 2\n-\t\t\t (and (eq_attr \"cpu\" \"athlon,k8\")\n-\t\t\t      (eq_attr \"type\" \"fxch\"))\n-\t\t\t \"athlon-direct,athlon-fany\")\n+\t\t\t \"athlon-direct,athlon-fpsched,athlon-fadd\")\n+;; Never seen by the scheduler because we still don't do post reg-stack\n+;; scheduling.\n+;(define_insn_reservation \"athlon_fxch\" 2\n+;\t\t\t (and (eq_attr \"cpu\" \"athlon,k8\")\n+;\t\t\t      (eq_attr \"type\" \"fxch\"))\n+;\t\t\t \"athlon-direct,athlon-fpsched,athlon-fany\")\n+\n ;; Athlon handle MMX operations in the FPU unit with shorter latencies\n-(define_insn_reservation \"athlon_movlpd_load\" 4\n-\t\t\t (and (eq_attr \"cpu\" \"athlon,k8\")\n+\n+(define_insn_reservation \"athlon_movlpd_load\" 0\n+\t\t\t (and (eq_attr \"cpu\" \"athlon\")\n \t\t\t      (and (eq_attr \"type\" \"ssemov\")\n \t\t\t\t   (match_operand:DF 1 \"memory_operand\" \"\")))\n-\t\t\t \"athlon-direct,athlon-load\")\n-(define_insn_reservation \"athlon_movaps_load\" 4\n-\t\t\t (and (eq_attr \"cpu\" \"athlon,k8\")\n+\t\t\t \"athlon-direct,athlon-fpload,athlon-fany\")\n+(define_insn_reservation \"athlon_movlpd_load_k8\" 2\n+\t\t\t (and (eq_attr \"cpu\" \"k8\")\n+\t\t\t      (and (eq_attr \"type\" \"ssemov\")\n+\t\t\t\t   (match_operand:DF 1 \"memory_operand\" \"\")))\n+\t\t\t \"athlon-direct,athlon-fploadk8,athlon-fstore\")\n+(define_insn_reservation \"athlon_movaps_load_k8\" 2\n+\t\t\t (and (eq_attr \"cpu\" \"k8\")\n \t\t\t      (and (eq_attr \"type\" \"ssemov\")\n \t\t\t\t   (and (eq_attr \"mode\" \"V4SF,V2DF,TI\")\n \t\t\t\t\t(eq_attr \"memory\" \"load\"))))\n-\t\t\t \"athlon-double,athlon-load\")\n-(define_insn_reservation \"athlon_movss_load\" 3\n-\t\t\t (and (eq_attr \"cpu\" \"athlon,k8\")\n+\t\t\t \"athlon-double,athlon-fpload2k8,athlon-fstore,athlon-fstore\")\n+(define_insn_reservation \"athlon_movaps_load\" 0\n+\t\t\t (and (eq_attr \"cpu\" \"athlon\")\n+\t\t\t      (and (eq_attr \"type\" \"ssemov\")\n+\t\t\t\t   (and (eq_attr \"mode\" \"V4SF,V2DF,TI\")\n+\t\t\t\t\t(eq_attr \"memory\" \"load\"))))\n+\t\t\t \"athlon-vector,athlon-fpload2,(athlon-fany+athlon-fany)\")\n+(define_insn_reservation \"athlon_movss_load\" 1\n+\t\t\t (and (eq_attr \"cpu\" \"athlon\")\n \t\t\t      (and (eq_attr \"type\" \"ssemov\")\n \t\t\t\t   (and (eq_attr \"mode\" \"SF,DI\")\n \t\t\t\t\t(eq_attr \"memory\" \"load\"))))\n-\t\t\t \"athlon-double,athlon-load\")\n-(define_insn_reservation \"athlon_mmxsseld\" 4\n-\t\t\t (and (eq_attr \"cpu\" \"athlon,k8\")\n+\t\t\t \"athlon-vector,athlon-fpload,(athlon-fany*2)\")\n+(define_insn_reservation \"athlon_movss_load_k8\" 1\n+\t\t\t (and (eq_attr \"cpu\" \"k8\")\n+\t\t\t      (and (eq_attr \"type\" \"ssemov\")\n+\t\t\t\t   (and (eq_attr \"mode\" \"SF,DI\")\n+\t\t\t\t\t(eq_attr \"memory\" \"load\"))))\n+\t\t\t \"athlon-double,athlon-fploadk8,(athlon-fstore+athlon-fany)\")\n+(define_insn_reservation \"athlon_mmxsseld\" 0\n+\t\t\t (and (eq_attr \"cpu\" \"athlon\")\n \t\t\t      (and (eq_attr \"type\" \"mmxmov,ssemov\")\n \t\t\t\t   (eq_attr \"memory\" \"load\")))\n-\t\t\t \"athlon-direct,athlon-fany,athlon-load\")\n+\t\t\t \"athlon-direct,athlon-fpload,athlon-fany\")\n+(define_insn_reservation \"athlon_mmxsseld_k8\" 2\n+\t\t\t (and (eq_attr \"cpu\" \"k8\")\n+\t\t\t      (and (eq_attr \"type\" \"mmxmov,ssemov\")\n+\t\t\t\t   (eq_attr \"memory\" \"load\")))\n+\t\t\t \"athlon-direct,athlon-fploadk8,athlon-fstore\")\n (define_insn_reservation \"athlon_mmxssest\" 3\n \t\t\t (and (eq_attr \"cpu\" \"k8\")\n \t\t\t      (and (eq_attr \"type\" \"mmxmov,ssemov\")\n \t\t\t\t   (and (eq_attr \"mode\" \"V4SF,V2DF,TI\")\n \t\t\t\t\t(eq_attr \"memory\" \"store,both\"))))\n-\t\t\t \"athlon-double,athlon-store\")\n-(define_insn_reservation \"athlon_mmxssest_k8\" 2\n+\t\t\t \"athlon-vector,(athlon-fpsched+athlon-agu),((athlon-fstore+athlon-store2)*2)\")\n+(define_insn_reservation \"athlon_mmxssest_k8\" 3\n+\t\t\t (and (eq_attr \"cpu\" \"k8\")\n+\t\t\t      (and (eq_attr \"type\" \"mmxmov,ssemov\")\n+\t\t\t\t   (and (eq_attr \"mode\" \"V4SF,V2DF,TI\")\n+\t\t\t\t\t(eq_attr \"memory\" \"store,both\"))))\n+\t\t\t \"athlon-double,(athlon-fpsched+athlon-agu),((athlon-fstore+athlon-store2)*2)\")\n+(define_insn_reservation \"athlon_mmxssest_short\" 2\n \t\t\t (and (eq_attr \"cpu\" \"athlon,k8\")\n \t\t\t      (and (eq_attr \"type\" \"mmxmov,ssemov\")\n \t\t\t\t   (eq_attr \"memory\" \"store,both\")))\n-\t\t\t \"athlon-direct,athlon-store\")\n+\t\t\t \"athlon-direct,(athlon-fpsched+athlon-agu),(athlon-fstore+athlon-store)\")\n (define_insn_reservation \"athlon_movaps\" 2\n \t\t\t (and (eq_attr \"cpu\" \"k8\")\n \t\t\t      (and (eq_attr \"type\" \"ssemov\")\n-\t\t\t\t   (eq_attr \"mode\" \"V4SF,V2DF\")))\n-\t\t\t \"athlon-double,athlon-faddmul,athlon-faddmul\")\n+\t\t\t\t   (eq_attr \"mode\" \"V4SF,V2DF,TI\")))\n+\t\t\t \"athlon-double,athlon-fpsched,(athlon-faddmul+athlon-faddmul)\")\n+(define_insn_reservation \"athlon_movaps_k8\" 2\n+\t\t\t (and (eq_attr \"cpu\" \"athlon\")\n+\t\t\t      (and (eq_attr \"type\" \"ssemov\")\n+\t\t\t\t   (eq_attr \"mode\" \"V4SF,V2DF,TI\")))\n+\t\t\t \"athlon-vector,athlon-fpsched,(athlon-faddmul+athlon-faddmul)\")\n (define_insn_reservation \"athlon_mmxssemov\" 2\n \t\t\t (and (eq_attr \"cpu\" \"athlon,k8\")\n \t\t\t      (eq_attr \"type\" \"mmxmov,ssemov\"))\n-\t\t\t \"athlon-direct,athlon-faddmul\")\n-(define_insn_reservation \"athlon_mmxmul_load\" 6\n+\t\t\t \"athlon-direct,athlon-fpsched,athlon-faddmul\")\n+(define_insn_reservation \"athlon_mmxmul_load\" 4\n \t\t\t (and (eq_attr \"cpu\" \"athlon,k8\")\n \t\t\t      (and (eq_attr \"type\" \"mmxmul\")\n \t\t\t\t   (eq_attr \"memory\" \"load\")))\n-\t\t\t \"athlon-direct,athlon-load,athlon-fmul\")\n+\t\t\t \"athlon-direct,athlon-fpload,athlon-fmul\")\n (define_insn_reservation \"athlon_mmxmul\" 3\n \t\t\t (and (eq_attr \"cpu\" \"athlon,k8\")\n \t\t\t      (eq_attr \"type\" \"mmxmul\"))\n-\t\t\t \"athlon-direct,athlon-fmul\")\n-(define_insn_reservation \"athlon_mmx_load\" 5\n+\t\t\t \"athlon-direct,athlon-fpsched,athlon-fmul\")\n+(define_insn_reservation \"athlon_mmx_load\" 3\n \t\t\t (and (eq_attr \"cpu\" \"athlon,k8\")\n \t\t\t      (and (eq_attr \"unit\" \"mmx\")\n \t\t\t\t   (eq_attr \"memory\" \"load\")))\n-\t\t\t \"athlon-direct,athlon-load,athlon-faddmul\")\n+\t\t\t \"athlon-direct,athlon-fpload,athlon-faddmul\")\n (define_insn_reservation \"athlon_mmx\" 2\n \t\t\t (and (eq_attr \"cpu\" \"athlon,k8\")\n \t\t\t      (eq_attr \"unit\" \"mmx\"))\n-\t\t\t \"athlon-direct,athlon-faddmul\")\n+\t\t\t \"athlon-direct,athlon-fpsched,athlon-faddmul\")\n ;; SSE operations are handled by the i387 unit as well.  The latency\n ;; is same as for i387 operations for scalar operations\n-(define_insn_reservation \"athlon_sselog_load\" 6\n+\n+(define_insn_reservation \"athlon_sselog_load\" 3\n \t\t\t (and (eq_attr \"cpu\" \"athlon\")\n \t\t\t      (and (eq_attr \"type\" \"sselog\")\n \t\t\t\t   (eq_attr \"memory\" \"load\")))\n-\t\t\t \"athlon-vector,athlon-load,athlon-fmul\")\n+\t\t\t \"athlon-vector,athlon-fpload2,(athlon-fmul*2)\")\n (define_insn_reservation \"athlon_sselog_load_k8\" 5\n \t\t\t (and (eq_attr \"cpu\" \"k8\")\n \t\t\t      (and (eq_attr \"type\" \"sselog\")\n \t\t\t\t   (eq_attr \"memory\" \"load\")))\n-\t\t\t \"athlon-double,athlon-load,athlon-fmul\")\n+\t\t\t \"athlon-double,athlon-fpload2k8,(athlon-fmul*2)\")\n (define_insn_reservation \"athlon_sselog\" 3\n \t\t\t (and (eq_attr \"cpu\" \"athlon\")\n \t\t\t      (eq_attr \"type\" \"sselog\"))\n-\t\t\t \"athlon-vector,athlon-fmul\")\n+\t\t\t \"athlon-vector,athlon-fpsched,athlon-fmul*2\")\n (define_insn_reservation \"athlon_sselog_k8\" 3\n \t\t\t (and (eq_attr \"cpu\" \"k8\")\n \t\t\t      (eq_attr \"type\" \"sselog\"))\n-\t\t\t \"athlon-double,athlon-fmul\")\n-(define_insn_reservation \"athlon_ssecmp_load\" 5\n-\t\t\t (and (eq_attr \"cpu\" \"athlon,k8\")\n-\t\t\t      (and (eq_attr \"type\" \"ssecmp,ssecomi\")\n-\t\t\t\t   (and (eq_attr \"mode\" \"SF,DF\")\n+\t\t\t \"athlon-double,athlon-fpsched,athlon-fmul\")\n+;; ??? pcmp executes in addmul, probably not wortwhile to brother about that.\n+(define_insn_reservation \"athlon_ssecmp_load\" 2\n+\t\t\t (and (eq_attr \"cpu\" \"athlon\")\n+\t\t\t      (and (eq_attr \"type\" \"ssecmp\")\n+\t\t\t\t   (and (eq_attr \"mode\" \"SF,DF,DI\")\n+\t\t\t\t\t(eq_attr \"memory\" \"load\"))))\n+\t\t\t \"athlon-direct,athlon-fpload,athlon-fadd\")\n+(define_insn_reservation \"athlon_ssecmp_load_k8\" 4\n+\t\t\t (and (eq_attr \"cpu\" \"k8\")\n+\t\t\t      (and (eq_attr \"type\" \"ssecmp\")\n+\t\t\t\t   (and (eq_attr \"mode\" \"SF,DF,DI,TI\")\n \t\t\t\t\t(eq_attr \"memory\" \"load\"))))\n-\t\t\t \"athlon-vector,athlon-load,athlon-fadd\")\n+\t\t\t \"athlon-direct,athlon-fploadk8,athlon-fadd\")\n (define_insn_reservation \"athlon_ssecmp\" 2\n \t\t\t (and (eq_attr \"cpu\" \"athlon,k8\")\n-\t\t\t      (and (eq_attr \"type\" \"ssecmp,ssecomi\")\n-\t\t\t\t   (eq_attr \"mode\" \"SF,DF\")))\n-\t\t\t \"athlon-direct,athlon-fadd\")\n-(define_insn_reservation \"athlon_ssecmpvector_load\" 6\n+\t\t\t      (and (eq_attr \"type\" \"ssecmp\")\n+\t\t\t\t   (eq_attr \"mode\" \"SF,DF,DI,TI\")))\n+\t\t\t \"athlon-direct,athlon-fpsched,athlon-fadd\")\n+(define_insn_reservation \"athlon_ssecmpvector_load\" 3\n \t\t\t (and (eq_attr \"cpu\" \"athlon\")\n-\t\t\t      (and (eq_attr \"type\" \"ssecmp,ssecomi\")\n+\t\t\t      (and (eq_attr \"type\" \"ssecmp\")\n \t\t\t\t   (eq_attr \"memory\" \"load\")))\n-\t\t\t \"athlon-vector,athlon-fadd\")\n+\t\t\t \"athlon-vector,athlon-fpload2,(athlon-fadd*2)\")\n (define_insn_reservation \"athlon_ssecmpvector_load_k8\" 5\n \t\t\t (and (eq_attr \"cpu\" \"k8\")\n-\t\t\t      (and (eq_attr \"type\" \"ssecmp,ssecomi\")\n+\t\t\t      (and (eq_attr \"type\" \"ssecmp\")\n \t\t\t\t   (eq_attr \"memory\" \"load\")))\n-\t\t\t \"athlon-double,athlon-fadd\")\n+\t\t\t \"athlon-double,athlon-fpload2k8,(athlon-fadd*2)\")\n (define_insn_reservation \"athlon_ssecmpvector\" 3\n \t\t\t (and (eq_attr \"cpu\" \"athlon\")\n-\t\t\t      (eq_attr \"type\" \"ssecmp,ssecomi\"))\n-\t\t\t \"athlon-vector,athlon-fadd\")\n+\t\t\t      (eq_attr \"type\" \"ssecmp\"))\n+\t\t\t \"athlon-vector,athlon-fpsched,(athlon-fadd*2)\")\n (define_insn_reservation \"athlon_ssecmpvector_k8\" 3\n \t\t\t (and (eq_attr \"cpu\" \"k8\")\n-\t\t\t      (eq_attr \"type\" \"ssecmp,ssecomi\"))\n-\t\t\t \"athlon-double,athlon-fadd\")\n-(define_insn_reservation \"athlon_sseadd_load\" 7\n+\t\t\t      (eq_attr \"type\" \"ssecmp\"))\n+\t\t\t \"athlon-double,athlon-fpsched,(athlon-fadd*2)\")\n+(define_insn_reservation \"athlon_ssecomi_load\" 4\n+\t\t\t (and (eq_attr \"cpu\" \"athlon\")\n+\t\t\t      (and (eq_attr \"type\" \"ssecomi\")\n+\t\t\t\t   (eq_attr \"memory\" \"load\")))\n+\t\t\t \"athlon-vector,athlon-fpload,athlon-fadd\")\n+(define_insn_reservation \"athlon_ssecomi_load_k8\" 6\n+\t\t\t (and (eq_attr \"cpu\" \"k8\")\n+\t\t\t      (and (eq_attr \"type\" \"ssecomi\")\n+\t\t\t\t   (eq_attr \"memory\" \"load\")))\n+\t\t\t \"athlon-vector,athlon-fploadk8,athlon-fadd\")\n+(define_insn_reservation \"athlon_ssecomi\" 4\n+\t\t\t (and (eq_attr \"cpu\" \"athlon,k8\")\n+\t\t\t      (eq_attr \"type\" \"ssecmp\"))\n+\t\t\t \"athlon-vector,athlon-fpsched,athlon-fadd\")\n+(define_insn_reservation \"athlon_sseadd_load\" 4\n \t\t\t (and (eq_attr \"cpu\" \"athlon\")\n \t\t\t      (and (eq_attr \"type\" \"sseadd\")\n-\t\t\t\t   (and (eq_attr \"mode\" \"SF,DF\")\n+\t\t\t\t   (and (eq_attr \"mode\" \"SF,DF,DI\")\n \t\t\t\t\t(eq_attr \"memory\" \"load\"))))\n-\t\t\t \"athlon-direct,athlon-load,athlon-fadd\")\n+\t\t\t \"athlon-direct,athlon-fpload,athlon-fadd\")\n (define_insn_reservation \"athlon_sseadd_load_k8\" 6\n \t\t\t (and (eq_attr \"cpu\" \"k8\")\n \t\t\t      (and (eq_attr \"type\" \"sseadd\")\n-\t\t\t\t   (and (eq_attr \"mode\" \"SF,DF\")\n+\t\t\t\t   (and (eq_attr \"mode\" \"SF,DF,DI\")\n \t\t\t\t\t(eq_attr \"memory\" \"load\"))))\n-\t\t\t \"athlon-direct,athlon-load,athlon-fadd\")\n+\t\t\t \"athlon-direct,athlon-fploadk8,athlon-fadd\")\n (define_insn_reservation \"athlon_sseadd\" 4\n \t\t\t (and (eq_attr \"cpu\" \"athlon,k8\")\n \t\t\t      (and (eq_attr \"type\" \"sseadd\")\n-\t\t\t\t   (eq_attr \"mode\" \"SF,DF\")))\n-\t\t\t \"athlon-direct,athlon-fadd\")\n-(define_insn_reservation \"athlon_sseaddvector_load\" 8\n+\t\t\t\t   (eq_attr \"mode\" \"SF,DF,DI\")))\n+\t\t\t \"athlon-direct,athlon-fpsched,athlon-fadd\")\n+(define_insn_reservation \"athlon_sseaddvector_load\" 5\n \t\t\t (and (eq_attr \"cpu\" \"athlon\")\n \t\t\t      (and (eq_attr \"type\" \"sseadd\")\n \t\t\t\t   (eq_attr \"memory\" \"load\")))\n-\t\t\t \"athlon-vector,athlon-load,athlon-fadd\")\n+\t\t\t \"athlon-vector,athlon-fpload2,(athlon-fadd*2)\")\n (define_insn_reservation \"athlon_sseaddvector_load_k8\" 7\n \t\t\t (and (eq_attr \"cpu\" \"k8\")\n \t\t\t      (and (eq_attr \"type\" \"sseadd\")\n \t\t\t\t   (eq_attr \"memory\" \"load\")))\n-\t\t\t \"athlon-vector,athlon-load,athlon-fadd\")\n+\t\t\t \"athlon-double,athlon-fpload2k8,(athlon-fadd*2)\")\n (define_insn_reservation \"athlon_sseaddvector\" 5\n \t\t\t (and (eq_attr \"cpu\" \"athlon\")\n \t\t\t      (eq_attr \"type\" \"sseadd\"))\n-\t\t\t \"athlon-vector,athlon-fadd\")\n-(define_insn_reservation \"athlon_sseaddvector_k8\" 4\n+\t\t\t \"athlon-vector,athlon-fpsched,(athlon-fadd*2)\")\n+(define_insn_reservation \"athlon_sseaddvector_k8\" 5\n \t\t\t (and (eq_attr \"cpu\" \"k8\")\n \t\t\t      (eq_attr \"type\" \"sseadd\"))\n-\t\t\t \"athlon-vector,athlon-fadd\")\n-(define_insn_reservation \"athlon_ssecvt_load\" 5\n-\t\t\t (and (eq_attr \"cpu\" \"athlon\")\n-\t\t\t      (and (eq_attr \"type\" \"ssecvt\")\n-\t\t\t\t   (and (eq_attr \"mode\" \"SF,DF\")\n-\t\t\t\t\t(eq_attr \"memory\" \"load\"))))\n-\t\t\t \"athlon-direct,athlon-load,athlon-fadd\")\n-(define_insn_reservation \"athlon_ssecvt_load_k8\" 4\n-\t\t\t (and (eq_attr \"cpu\" \"k8\")\n+\t\t\t \"athlon-double,athlon-fpsched,(athlon-fadd*2)\")\n+\n+;; Conversions behaves very irregulary and the scheduling is critical here.\n+;; Take each instruction separately.  Assume that the mode is always set to the\n+;; destination one and athlon_decode is set to the K8 versions.\n+\n+;; cvtss2sd\n+(define_insn_reservation \"athlon_ssecvt_cvtss2sd_load_k8\" 4\n+\t\t\t (and (eq_attr \"cpu\" \"k8,athlon\")\n \t\t\t      (and (eq_attr \"type\" \"ssecvt\")\n-\t\t\t\t   (and (eq_attr \"mode\" \"SF,DF\")\n-\t\t\t\t\t(eq_attr \"memory\" \"load\"))))\n-\t\t\t \"athlon-direct,athlon-load,athlon-fadd\")\n-(define_insn_reservation \"athlon_ssecvt\" 2\n+\t\t\t\t   (and (eq_attr \"athlon_decode\" \"direct\")\n+\t\t\t\t\t(and (eq_attr \"mode\" \"DF\")\n+\t\t\t\t\t     (eq_attr \"memory\" \"load\")))))\n+\t\t\t \"athlon-direct,athlon-fploadk8,athlon-fstore\")\n+(define_insn_reservation \"athlon_ssecvt_cvtss2sd\" 2\n \t\t\t (and (eq_attr \"cpu\" \"athlon,k8\")\n \t\t\t      (and (eq_attr \"type\" \"ssecvt\")\n-\t\t\t\t   (eq_attr \"mode\" \"SF,DF\")))\n-\t\t\t \"athlon-direct,athlon-fadd\")\n-(define_insn_reservation \"athlon_ssecvtvector_load\" 6\n+\t\t\t\t   (and (eq_attr \"athlon_decode\" \"direct\")\n+\t\t\t\t\t(eq_attr \"mode\" \"DF\"))))\n+\t\t\t \"athlon-direct,athlon-fpsched,athlon-fstore\")\n+;; cvtps2pd.  Model same way the other double decoded FP conversions.\n+(define_insn_reservation \"athlon_ssecvt_cvtps2pd_load_k8\" 5\n+\t\t\t (and (eq_attr \"cpu\" \"k8,athlon\")\n+\t\t\t      (and (eq_attr \"type\" \"ssecvt\")\n+\t\t\t\t   (and (eq_attr \"athlon_decode\" \"double\")\n+\t\t\t\t\t(and (eq_attr \"mode\" \"V2DF,V4SF,TI\")\n+\t\t\t\t\t     (eq_attr \"memory\" \"load\")))))\n+\t\t\t \"athlon-double,athlon-fpload2k8,(athlon-fstore*2)\")\n+(define_insn_reservation \"athlon_ssecvt_cvtps2pd_k8\" 3\n+\t\t\t (and (eq_attr \"cpu\" \"k8,athlon\")\n+\t\t\t      (and (eq_attr \"type\" \"ssecvt\")\n+\t\t\t\t   (and (eq_attr \"athlon_decode\" \"double\")\n+\t\t\t\t\t(eq_attr \"mode\" \"V2DF,V4SF,TI\"))))\n+\t\t\t \"athlon-double,athlon-fpsched,athlon-fstore,athlon-fstore\")\n+;; cvtsi2sd mem,reg is directpath path  (cvtsi2sd reg,reg is doublepath)\n+;; cvtsi2sd has troughput 1 and is executed in store unit with latency of 6\n+(define_insn_reservation \"athlon_sseicvt_cvtsi2sd_load\" 6\n+\t\t\t (and (eq_attr \"cpu\" \"athlon,k8\")\n+\t\t\t      (and (eq_attr \"type\" \"sseicvt\")\n+\t\t\t\t   (and (eq_attr \"athlon_decode\" \"direct\")\n+\t\t\t\t\t(and (eq_attr \"mode\" \"SF,DF\")\n+\t\t\t\t\t     (eq_attr \"memory\" \"load\")))))\n+\t\t\t \"athlon-direct,athlon-fploadk8,athlon-fstore\")\n+;; cvtsi2ss mem, reg is doublepath\n+(define_insn_reservation \"athlon_sseicvt_cvtsi2ss_load\" 9\n \t\t\t (and (eq_attr \"cpu\" \"athlon\")\n+\t\t\t      (and (eq_attr \"type\" \"sseicvt\")\n+\t\t\t\t   (and (eq_attr \"athlon_decode\" \"double\")\n+\t\t\t\t\t(and (eq_attr \"mode\" \"SF,DF\")\n+\t\t\t\t\t     (eq_attr \"memory\" \"load\")))))\n+\t\t\t \"athlon-vector,athlon-fpload,(athlon-fstore*2)\")\n+(define_insn_reservation \"athlon_sseicvt_cvtsi2ss_load_k8\" 9\n+\t\t\t (and (eq_attr \"cpu\" \"k8\")\n+\t\t\t      (and (eq_attr \"type\" \"sseicvt\")\n+\t\t\t\t   (and (eq_attr \"athlon_decode\" \"double\")\n+\t\t\t\t\t(and (eq_attr \"mode\" \"SF,DF\")\n+\t\t\t\t\t     (eq_attr \"memory\" \"load\")))))\n+\t\t\t \"athlon-double,athlon-fploadk8,(athlon-fstore*2)\")\n+;; cvtsi2sd reg,reg is double decoded (vector on Athlon)\n+(define_insn_reservation \"athlon_sseicvt_cvtsi2sd_k8\" 11\n+\t\t\t (and (eq_attr \"cpu\" \"k8,athlon\")\n+\t\t\t      (and (eq_attr \"type\" \"sseicvt\")\n+\t\t\t\t   (and (eq_attr \"athlon_decode\" \"double\")\n+\t\t\t\t\t(and (eq_attr \"mode\" \"SF,DF\")\n+\t\t\t\t\t     (eq_attr \"memory\" \"none\")))))\n+\t\t\t \"athlon-double,athlon-fploadk8,athlon-fstore\")\n+;; cvtsi2ss reg, reg is doublepath\n+(define_insn_reservation \"athlon_sseicvt_cvtsi2ss\" 14\n+\t\t\t (and (eq_attr \"cpu\" \"athlon,k8\")\n+\t\t\t      (and (eq_attr \"type\" \"sseicvt\")\n+\t\t\t\t   (and (eq_attr \"athlon_decode\" \"vector\")\n+\t\t\t\t\t(and (eq_attr \"mode\" \"SF,DF\")\n+\t\t\t\t\t     (eq_attr \"memory\" \"none\")))))\n+\t\t\t \"athlon-vector,athlon-fploadk8,(athlon-fvector*2)\")\n+;; cvtsd2ss mem,reg is doublepath, troughput unknown, latency 9\n+(define_insn_reservation \"athlon_ssecvt_cvtsd2ss_load_k8\" 9\n+\t\t\t (and (eq_attr \"cpu\" \"k8,athlon\")\n \t\t\t      (and (eq_attr \"type\" \"ssecvt\")\n-\t\t\t\t   (eq_attr \"memory\" \"load\")))\n-\t\t\t \"athlon-vector,athlon-load,athlon-fadd\")\n-(define_insn_reservation \"athlon_ssecvtvector_load_k8\" 5\n-\t\t\t (and (eq_attr \"cpu\" \"k8\")\n+\t\t\t\t   (and (eq_attr \"athlon_decode\" \"double\")\n+\t\t\t\t\t(and (eq_attr \"mode\" \"SF\")\n+\t\t\t\t\t     (eq_attr \"memory\" \"load\")))))\n+\t\t\t \"athlon-double,athlon-fploadk8,(athlon-fstore*3)\")\n+;; cvtsd2ss reg,reg is vectorpath, troughput unknown, latency 12\n+(define_insn_reservation \"athlon_ssecvt_cvtsd2ss\" 12\n+\t\t\t (and (eq_attr \"cpu\" \"athlon,k8\")\n \t\t\t      (and (eq_attr \"type\" \"ssecvt\")\n-\t\t\t\t   (eq_attr \"memory\" \"load\")))\n-\t\t\t \"athlon-vector,athlon-load,athlon-fadd\")\n-(define_insn_reservation \"athlon_ssecvtvector\" 5\n+\t\t\t\t   (and (eq_attr \"athlon_decode\" \"vector\")\n+\t\t\t\t\t(and (eq_attr \"mode\" \"SF\")\n+\t\t\t\t\t     (eq_attr \"memory\" \"none\")))))\n+\t\t\t \"athlon-vector,athlon-fpsched,(athlon-fvector*3)\")\n+(define_insn_reservation \"athlon_ssecvt_cvtpd2ps_load_k8\" 8\n+\t\t\t (and (eq_attr \"cpu\" \"athlon,k8\")\n+\t\t\t      (and (eq_attr \"type\" \"ssecvt\")\n+\t\t\t\t   (and (eq_attr \"athlon_decode\" \"vector\")\n+\t\t\t\t\t(and (eq_attr \"mode\" \"V4SF,V2DF,TI\")\n+\t\t\t\t\t     (eq_attr \"memory\" \"load\")))))\n+\t\t\t \"athlon-double,athlon-fpload2k8,(athlon-fstore*3)\")\n+;; cvtpd2ps mem,reg is vectorpath, troughput unknown, latency 10\n+;; ??? Why it is fater than cvtsd2ss?\n+(define_insn_reservation \"athlon_ssecvt_cvtpd2ps\" 8\n+\t\t\t (and (eq_attr \"cpu\" \"athlon,k8\")\n+\t\t\t      (and (eq_attr \"type\" \"ssecvt\")\n+\t\t\t\t   (and (eq_attr \"athlon_decode\" \"vector\")\n+\t\t\t\t\t(and (eq_attr \"mode\" \"V4SF,V2DF,TI\")\n+\t\t\t\t\t     (eq_attr \"memory\" \"none\")))))\n+\t\t\t \"athlon-vector,athlon-fpsched,athlon-fvector*2\")\n+;; cvtsd2si mem,reg is doublepath, troughput 1, latency 9\n+(define_insn_reservation \"athlon_secvt_cvtsX2si_load\" 9\n+\t\t\t (and (eq_attr \"cpu\" \"athlon,k8\")\n+\t\t\t      (and (eq_attr \"type\" \"sseicvt\")\n+\t\t\t\t   (and (eq_attr \"athlon_decode\" \"vector\")\n+\t\t\t\t\t(and (eq_attr \"mode\" \"SI,DI\")\n+\t\t\t\t\t     (eq_attr \"memory\" \"load\")))))\n+\t\t\t \"athlon-vector,athlon-fploadk8,athlon-fvector\")\n+;; cvtsd2si reg,reg is doublepath, troughput 1, latency 9\n+(define_insn_reservation \"athlon_ssecvt_cvtsX2si\" 9\n \t\t\t (and (eq_attr \"cpu\" \"athlon\")\n-\t\t\t      (eq_attr \"type\" \"ssecvt\"))\n-\t\t\t \"athlon-vector,athlon-fadd\")\n-(define_insn_reservation \"athlon_ssecvtvector_k8\" 3\n-\t\t\t (and (eq_attr \"cpu\" \"k8\")\n-\t\t\t      (eq_attr \"type\" \"ssecvt\"))\n-\t\t\t \"athlon-vector,athlon-fadd\")\n-(define_insn_reservation \"athlon_ssemul_load\" 7\n+\t\t\t      (and (eq_attr \"type\" \"sseicvt\")\n+\t\t\t\t   (and (eq_attr \"athlon_decode\" \"double\")\n+\t\t\t\t\t(and (eq_attr \"mode\" \"SI,DI\")\n+\t\t\t\t\t     (eq_attr \"memory\" \"none\")))))\n+\t\t\t \"athlon-vector,athlon-fpsched,athlon-fvector\")\n+(define_insn_reservation \"athlon_ssecvt_cvtsX2si_k8\" 9\n+\t\t\t (and (eq_attr \"cpu\" \"k8\")\n+\t\t\t      (and (eq_attr \"type\" \"sseicvt\")\n+\t\t\t\t   (and (eq_attr \"athlon_decode\" \"double\")\n+\t\t\t\t\t(and (eq_attr \"mode\" \"SI,DI\")\n+\t\t\t\t\t     (eq_attr \"memory\" \"none\")))))\n+\t\t\t \"athlon-double,athlon-fpsched,athlon-fstore\")\n+\n+\n+(define_insn_reservation \"athlon_ssemul_load\" 4\n \t\t\t (and (eq_attr \"cpu\" \"athlon\")\n \t\t\t      (and (eq_attr \"type\" \"ssemul\")\n \t\t\t\t   (and (eq_attr \"mode\" \"SF,DF\")\n \t\t\t\t\t(eq_attr \"memory\" \"load\"))))\n-\t\t\t \"athlon-direct,athlon-load,athlon-fmul\")\n+\t\t\t \"athlon-direct,athlon-fpload,athlon-fmul\")\n (define_insn_reservation \"athlon_ssemul_load_k8\" 6\n \t\t\t (and (eq_attr \"cpu\" \"k8\")\n \t\t\t      (and (eq_attr \"type\" \"ssemul\")\n \t\t\t\t   (and (eq_attr \"mode\" \"SF,DF\")\n \t\t\t\t\t(eq_attr \"memory\" \"load\"))))\n-\t\t\t \"athlon-direct,athlon-load,athlon-fmul\")\n+\t\t\t \"athlon-direct,athlon-fploadk8,athlon-fmul\")\n (define_insn_reservation \"athlon_ssemul\" 4\n \t\t\t (and (eq_attr \"cpu\" \"athlon,k8\")\n \t\t\t      (and (eq_attr \"type\" \"ssemul\")\n \t\t\t\t   (eq_attr \"mode\" \"SF,DF\")))\n-\t\t\t \"athlon-direct,athlon-fmul\")\n-(define_insn_reservation \"athlon_ssemulvector_load\" 8\n+\t\t\t \"athlon-direct,athlon-fpsched,athlon-fmul\")\n+(define_insn_reservation \"athlon_ssemulvector_load\" 5\n \t\t\t (and (eq_attr \"cpu\" \"athlon\")\n \t\t\t      (and (eq_attr \"type\" \"ssemul\")\n \t\t\t\t   (eq_attr \"memory\" \"load\")))\n-\t\t\t \"athlon-vector,athlon-load,athlon-fmul\")\n+\t\t\t \"athlon-vector,athlon-fpload2,(athlon-fmul*2)\")\n (define_insn_reservation \"athlon_ssemulvector_load_k8\" 7\n \t\t\t (and (eq_attr \"cpu\" \"k8\")\n \t\t\t      (and (eq_attr \"type\" \"ssemul\")\n \t\t\t\t   (eq_attr \"memory\" \"load\")))\n-\t\t\t \"athlon-double,athlon-load,athlon-fmul\")\n+\t\t\t \"athlon-double,athlon-fpload2k8,(athlon-fmul*2)\")\n (define_insn_reservation \"athlon_ssemulvector\" 5\n \t\t\t (and (eq_attr \"cpu\" \"athlon\")\n \t\t\t      (eq_attr \"type\" \"ssemul\"))\n-\t\t\t \"athlon-vector,athlon-fmul\")\n+\t\t\t \"athlon-vector,athlon-fpsched,(athlon-fmul*2)\")\n (define_insn_reservation \"athlon_ssemulvector_k8\" 5\n \t\t\t (and (eq_attr \"cpu\" \"k8\")\n \t\t\t      (eq_attr \"type\" \"ssemul\"))\n-\t\t\t \"athlon-double,athlon-fmul\")\n-(define_insn_reservation \"athlon_ssediv_load\" 19\n+\t\t\t \"athlon-double,athlon-fpsched,(athlon-fmul*2)\")\n+;; divsd timmings.  divss is faster\n+(define_insn_reservation \"athlon_ssediv_load\" 20\n \t\t\t (and (eq_attr \"cpu\" \"athlon\")\n \t\t\t      (and (eq_attr \"type\" \"ssediv\")\n \t\t\t\t   (and (eq_attr \"mode\" \"SF,DF\")\n \t\t\t\t\t(eq_attr \"memory\" \"load\"))))\n-\t\t\t \"athlon-direct,athlon-load,athlon-fmul\")\n-(define_insn_reservation \"athlon_ssediv_load_k8\" 18\n+\t\t\t \"athlon-direct,athlon-fpload,athlon-fmul*17\")\n+(define_insn_reservation \"athlon_ssediv_load_k8\" 22\n \t\t\t (and (eq_attr \"cpu\" \"k8\")\n \t\t\t      (and (eq_attr \"type\" \"ssediv\")\n \t\t\t\t   (and (eq_attr \"mode\" \"SF,DF\")\n \t\t\t\t\t(eq_attr \"memory\" \"load\"))))\n-\t\t\t \"athlon-direct,athlon-load,athlon-fmul\")\n-(define_insn_reservation \"athlon_ssediv\" 16\n+\t\t\t \"athlon-direct,athlon-fploadk8,athlon-fmul*17\")\n+(define_insn_reservation \"athlon_ssediv\" 20\n \t\t\t (and (eq_attr \"cpu\" \"athlon,k8\")\n \t\t\t      (and (eq_attr \"type\" \"ssediv\")\n \t\t\t\t   (eq_attr \"mode\" \"SF,DF\")))\n-\t\t\t \"athlon-direct,athlon-fmul\")\n-(define_insn_reservation \"athlon_ssedivvector_load\" 32\n+\t\t\t \"athlon-direct,athlon-fpsched,athlon-fmul*17\")\n+(define_insn_reservation \"athlon_ssedivvector_load\" 39\n \t\t\t (and (eq_attr \"cpu\" \"athlon\")\n \t\t\t      (and (eq_attr \"type\" \"ssediv\")\n \t\t\t\t   (eq_attr \"memory\" \"load\")))\n-\t\t\t \"athlon-vector,athlon-load,athlon-fmul\")\n+\t\t\t \"athlon-vector,athlon-fpload2,athlon-fmul*34\")\n (define_insn_reservation \"athlon_ssedivvector_load_k8\" 35\n \t\t\t (and (eq_attr \"cpu\" \"k8\")\n \t\t\t      (and (eq_attr \"type\" \"ssediv\")\n \t\t\t\t   (eq_attr \"memory\" \"load\")))\n-\t\t\t \"athlon-vector,athlon-load,athlon-fmul\")\n-(define_insn_reservation \"athlon_ssedivvector\" 29\n+\t\t\t \"athlon-double,athlon-fpload2k8,athlon-fmul*34\")\n+(define_insn_reservation \"athlon_ssedivvector\" 39\n \t\t\t (and (eq_attr \"cpu\" \"athlon\")\n \t\t\t      (eq_attr \"type\" \"ssediv\"))\n-\t\t\t \"athlon-vector,athlon-fmul\")\n-(define_insn_reservation \"athlon_ssedivvector_k8\" 33\n+\t\t\t \"athlon-vector,athlon-fmul*34\")\n+(define_insn_reservation \"athlon_ssedivvector_k8\" 39\n \t\t\t (and (eq_attr \"cpu\" \"k8\")\n \t\t\t      (eq_attr \"type\" \"ssediv\"))\n-\t\t\t \"athlon-vector,athlon-fmul\")\n+\t\t\t \"athlon-double,athlon-fmul*34\")"}, {"sha": "b7076239ad5cf864c3b9958b05d4c41980887a10", "filename": "gcc/config/i386/i386.c", "status": "modified", "additions": 15, "deletions": 7, "changes": 22, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/26f74aa3f74d5efd8cd37bfe3700f16f400189c1/gcc%2Fconfig%2Fi386%2Fi386.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/26f74aa3f74d5efd8cd37bfe3700f16f400189c1/gcc%2Fconfig%2Fi386%2Fi386.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fconfig%2Fi386%2Fi386.c?ref=26f74aa3f74d5efd8cd37bfe3700f16f400189c1", "patch": "@@ -12125,13 +12125,21 @@ ix86_adjust_cost (insn, link, dep_insn, cost)\n       if ((memory == MEMORY_LOAD || memory == MEMORY_BOTH)\n \t  && !ix86_agi_dependant (insn, dep_insn, insn_type))\n  \t{\n-\t  /* Claim moves to take one cycle, as core can issue one load\n-\t     at time and the next load can start cycle later.  */\n-\t  if (dep_insn_type == TYPE_IMOV\n-\t      || dep_insn_type == TYPE_FMOV)\n-\t    cost = 0;\n-\t  else if (cost >= 3)\n-\t    cost -= 3;\n+\t  enum attr_unit unit = get_attr_unit (insn);\n+\t  int loadcost = 3;\n+\n+\t  /* Because of the difference between the length of integer and\n+\t     floating unit pipeline preparation stages, the memory operands\n+\t     for floating point are cheaper. \n+\n+\t     ??? For Athlon it the difference is most propbably 2.  */\n+\t  if (unit == UNIT_INTEGER || unit == UNIT_UNKNOWN)\n+\t    loadcost = 3;\n+\t  else\n+\t    loadcost = TARGET_ATHLON ? 2 : 0;\n+\n+\t  if (cost >= loadcost)\n+\t    cost -= loadcost;\n \t  else\n \t    cost = 0;\n \t}"}, {"sha": "853e3c00d6a81aa96b0d3c68b9eb7fd24be0049f", "filename": "gcc/config/i386/i386.md", "status": "modified", "additions": 32, "deletions": 17, "changes": 49, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/26f74aa3f74d5efd8cd37bfe3700f16f400189c1/gcc%2Fconfig%2Fi386%2Fi386.md", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/26f74aa3f74d5efd8cd37bfe3700f16f400189c1/gcc%2Fconfig%2Fi386%2Fi386.md", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fconfig%2Fi386%2Fi386.md?ref=26f74aa3f74d5efd8cd37bfe3700f16f400189c1", "patch": "@@ -3990,7 +3990,7 @@\n }\n   [(set_attr \"type\" \"ssecvt,ssecvt,fmov\")\n    (set_attr \"athlon_decode\" \"vector,double,*\")\n-   (set_attr \"mode\" \"DF,DF,SF\")])\n+   (set_attr \"mode\" \"SF,SF,SF\")])\n \n (define_insn \"*truncdfsf2_2_nooverlap\"\n   [(set (match_operand:SF 0 \"nonimmediate_operand\" \"=&Y,!m\")\n@@ -4037,7 +4037,7 @@\n   \"cvtsd2ss\\t{%1, %0|%0, %1}\"\n   [(set_attr \"type\" \"ssecvt\")\n    (set_attr \"athlon_decode\" \"vector,double\")\n-   (set_attr \"mode\" \"DF\")])\n+   (set_attr \"mode\" \"SF\")])\n \n (define_insn \"*truncdfsf2_sse_only_nooverlap\"\n   [(set (match_operand:SF 0 \"register_operand\" \"=&Y\")\n@@ -4443,7 +4443,8 @@\n     }\n   DONE;\n }\n-  [(set_attr \"type\" \"fistp\")])\n+  [(set_attr \"type\" \"fistp\")\n+   (set_attr \"mode\" \"DI\")])\n \n (define_insn \"fix_truncdi_nomemory\"\n   [(set (match_operand:DI 0 \"nonimmediate_operand\" \"=m,?r\")\n@@ -4455,7 +4456,8 @@\n   \"TARGET_80387 && FLOAT_MODE_P (GET_MODE (operands[1]))\n    && (!SSE_FLOAT_MODE_P (GET_MODE (operands[1])) || !TARGET_64BIT)\"\n   \"#\"\n-  [(set_attr \"type\" \"fistp\")])\n+  [(set_attr \"type\" \"fistp\")\n+   (set_attr \"mode\" \"DI\")])\n \n (define_insn \"fix_truncdi_memory\"\n   [(set (match_operand:DI 0 \"memory_operand\" \"=m\")\n@@ -4466,7 +4468,8 @@\n   \"TARGET_80387 && FLOAT_MODE_P (GET_MODE (operands[1]))\n    && (!SSE_FLOAT_MODE_P (GET_MODE (operands[1])) || !TARGET_64BIT)\"\n   \"* operands[5] = operands[4]; return output_fix_trunc (insn, operands);\"\n-  [(set_attr \"type\" \"fistp\")])\n+  [(set_attr \"type\" \"fistp\")\n+   (set_attr \"mode\" \"DI\")])\n \n (define_split \n   [(set (match_operand:DI 0 \"register_operand\" \"\")\n@@ -4504,6 +4507,7 @@\n   \"TARGET_64BIT && TARGET_SSE\"\n   \"cvttss2si{q}\\t{%1, %0|%0, %1}\"\n   [(set_attr \"type\" \"sseicvt\")\n+   (set_attr \"mode\" \"SF\")\n    (set_attr \"athlon_decode\" \"double,vector\")])\n \n ;; Avoid vector decoded form of the instruction.\n@@ -4522,6 +4526,7 @@\n   \"TARGET_64BIT && TARGET_SSE2\"\n   \"cvttsd2si{q}\\t{%1, %0|%0, %1}\"\n   [(set_attr \"type\" \"sseicvt,sseicvt\")\n+   (set_attr \"mode\" \"DF\")\n    (set_attr \"athlon_decode\" \"double,vector\")])\n \n ;; Avoid vector decoded form of the instruction.\n@@ -4605,7 +4610,8 @@\n     }\n   DONE;\n }\n-  [(set_attr \"type\" \"fistp\")])\n+  [(set_attr \"type\" \"fistp\")\n+   (set_attr \"mode\" \"SI\")])\n \n (define_insn \"fix_truncsi_nomemory\"\n   [(set (match_operand:SI 0 \"nonimmediate_operand\" \"=m,?r\")\n@@ -4616,7 +4622,8 @@\n   \"TARGET_80387 && FLOAT_MODE_P (GET_MODE (operands[1]))\n    && !SSE_FLOAT_MODE_P (GET_MODE (operands[1]))\"\n   \"#\"\n-  [(set_attr \"type\" \"fistp\")])\n+  [(set_attr \"type\" \"fistp\")\n+   (set_attr \"mode\" \"SI\")])\n \n (define_insn \"fix_truncsi_memory\"\n   [(set (match_operand:SI 0 \"memory_operand\" \"=m\")\n@@ -4626,7 +4633,8 @@\n   \"TARGET_80387 && FLOAT_MODE_P (GET_MODE (operands[1]))\n    && !SSE_FLOAT_MODE_P (GET_MODE (operands[1]))\"\n   \"* return output_fix_trunc (insn, operands);\"\n-  [(set_attr \"type\" \"fistp\")])\n+  [(set_attr \"type\" \"fistp\")\n+   (set_attr \"mode\" \"SI\")])\n \n ;; When SSE available, it is always faster to use it!\n (define_insn \"fix_truncsfsi_sse\"\n@@ -4635,6 +4643,7 @@\n   \"TARGET_SSE\"\n   \"cvttss2si\\t{%1, %0|%0, %1}\"\n   [(set_attr \"type\" \"sseicvt\")\n+   (set_attr \"mode\" \"DF\")\n    (set_attr \"athlon_decode\" \"double,vector\")])\n \n ;; Avoid vector decoded form of the instruction.\n@@ -4653,6 +4662,7 @@\n   \"TARGET_SSE2\"\n   \"cvttsd2si\\t{%1, %0|%0, %1}\"\n   [(set_attr \"type\" \"sseicvt\")\n+   (set_attr \"mode\" \"DF\")\n    (set_attr \"athlon_decode\" \"double,vector\")])\n \n ;; Avoid vector decoded form of the instruction.\n@@ -4743,7 +4753,8 @@\n     }\n   DONE;\n }\n-  [(set_attr \"type\" \"fistp\")])\n+  [(set_attr \"type\" \"fistp\")\n+   (set_attr \"mode\" \"HI\")])\n \n (define_insn \"fix_trunchi_nomemory\"\n   [(set (match_operand:HI 0 \"nonimmediate_operand\" \"=m,?r\")\n@@ -4754,7 +4765,8 @@\n   \"TARGET_80387 && FLOAT_MODE_P (GET_MODE (operands[1]))\n    && !SSE_FLOAT_MODE_P (GET_MODE (operands[1]))\"\n   \"#\"\n-  [(set_attr \"type\" \"fistp\")])\n+  [(set_attr \"type\" \"fistp\")\n+   (set_attr \"mode\" \"HI\")])\n \n (define_insn \"fix_trunchi_memory\"\n   [(set (match_operand:HI 0 \"memory_operand\" \"=m\")\n@@ -4764,7 +4776,8 @@\n   \"TARGET_80387 && FLOAT_MODE_P (GET_MODE (operands[1]))\n    && !SSE_FLOAT_MODE_P (GET_MODE (operands[1]))\"\n   \"* return output_fix_trunc (insn, operands);\"\n-  [(set_attr \"type\" \"fistp\")])\n+  [(set_attr \"type\" \"fistp\")\n+   (set_attr \"mode\" \"HI\")])\n \n (define_split \n   [(set (match_operand:HI 0 \"memory_operand\" \"\")\n@@ -20262,7 +20275,7 @@\n   \"cvtss2si\\t{%1, %0|%0, %1}\"\n   [(set_attr \"type\" \"sseicvt\")\n    (set_attr \"athlon_decode\" \"double,vector\")\n-   (set_attr \"mode\" \"SF\")])\n+   (set_attr \"mode\" \"SI\")])\n \n (define_insn \"cvtss2siq\"\n   [(set (match_operand:DI 0 \"register_operand\" \"=r,r\")\n@@ -20273,7 +20286,7 @@\n   \"cvtss2siq\\t{%1, %0|%0, %1}\"\n   [(set_attr \"type\" \"sseicvt\")\n    (set_attr \"athlon_decode\" \"double,vector\")\n-   (set_attr \"mode\" \"SF\")])\n+   (set_attr \"mode\" \"DI\")])\n \n (define_insn \"cvttss2si\"\n   [(set (match_operand:SI 0 \"register_operand\" \"=r,r\")\n@@ -21891,22 +21904,24 @@\n ;; Conversions between SI and DF\n \n (define_insn \"cvtsd2si\"\n-  [(set (match_operand:SI 0 \"register_operand\" \"=r\")\n-\t(fix:SI (vec_select:DF (match_operand:V2DF 1 \"register_operand\" \"xm\")\n+  [(set (match_operand:SI 0 \"register_operand\" \"=r,r\")\n+\t(fix:SI (vec_select:DF (match_operand:V2DF 1 \"register_operand\" \"x,m\")\n \t\t\t       (parallel [(const_int 0)]))))]\n   \"TARGET_SSE2\"\n   \"cvtsd2si\\t{%1, %0|%0, %1}\"\n   [(set_attr \"type\" \"sseicvt\")\n+   (set_attr \"athlon_decode\" \"double,vector\")\n    (set_attr \"mode\" \"SI\")])\n \n (define_insn \"cvtsd2siq\"\n   [(set (match_operand:DI 0 \"register_operand\" \"=r\")\n-\t(fix:DI (vec_select:DF (match_operand:V2DF 1 \"register_operand\" \"xm\")\n+\t(fix:DI (vec_select:DF (match_operand:V2DF 1 \"register_operand\" \"x,m\")\n \t\t\t       (parallel [(const_int 0)]))))]\n   \"TARGET_SSE2 && TARGET_64BIT\"\n   \"cvtsd2siq\\t{%1, %0|%0, %1}\"\n   [(set_attr \"type\" \"sseicvt\")\n-   (set_attr \"mode\" \"SI\")])\n+   (set_attr \"athlon_decode\" \"double,vector\")\n+   (set_attr \"mode\" \"DI\")])\n \n (define_insn \"cvttsd2si\"\n   [(set (match_operand:SI 0 \"register_operand\" \"=r,r\")"}, {"sha": "c4bd18c1b9d89d84a281e9c2fcb9bcf4f47ba245", "filename": "gcc/doc/invoke.texi", "status": "modified", "additions": 12, "deletions": 0, "changes": 12, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/26f74aa3f74d5efd8cd37bfe3700f16f400189c1/gcc%2Fdoc%2Finvoke.texi", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/26f74aa3f74d5efd8cd37bfe3700f16f400189c1/gcc%2Fdoc%2Finvoke.texi", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fdoc%2Finvoke.texi?ref=26f74aa3f74d5efd8cd37bfe3700f16f400189c1", "patch": "@@ -4618,6 +4618,18 @@ parameter very large effectively disables garbage collection.  Setting\n this parameter and @option{ggc-min-expand} to zero causes a full\n collection to occur at every opportunity.\n \n+@item reorder-blocks-duplicate\n+@itemx reorder-blocks-duplicate-feedback\n+\n+Used by basic block reordering pass to decide whether to use uncondtional\n+branch or duplicate the code on it's destination.  Code is duplicated when it's\n+estimated size is smaller than this value multiplied by the estimated size of\n+unconditinal jump in the hot spots of the program.\n+\n+The @option{reorder-block-duplicate-feedback} is used only when profile\n+feedback is available and may be set to higher values than\n+@option{reorder-block-duplicate} since information about the hot spots is more\n+accurate.\n @end table\n @end table\n "}]}