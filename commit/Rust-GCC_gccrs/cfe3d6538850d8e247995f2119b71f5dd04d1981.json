{"sha": "cfe3d6538850d8e247995f2119b71f5dd04d1981", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6Y2ZlM2Q2NTM4ODUwZDhlMjQ3OTk1ZjIxMTliNzFmNWRkMDRkMTk4MQ==", "commit": {"author": {"name": "Prathamesh Kulkarni", "email": "prathamesh.kulkarni@linaro.org", "date": "2016-11-23T18:04:14Z"}, "committer": {"name": "Prathamesh Kulkarni", "email": "prathamesh3492@gcc.gnu.org", "date": "2016-11-23T18:04:14Z"}, "message": "re PR middle-end/78153 (strlen return value can be assumed to be less than PTRDIFF_MAX)\n\n2016-11-23  Prathamesh Kulkarni  <prathamesh.kulkarni@linaro.org>\n\n\tPR middle-end/78153\n\t* gimple-fold.c (fold_stmt_1): Handle case for GIMPLE_RETURN.\n\t* tree-vrp.c (extract_range_basic): Handle case for\n\tCFN_BUILT_IN_STRLEN.\n\ntestsuite/\n\t* gcc.dg/tree-ssa/pr78153-1.c: New test.\n\t* gcc.dg/tree-ssa/pr78153-2.c: Likewise.\n\nFrom-SVN: r242786", "tree": {"sha": "723df5e17588ca6e76d0d12d560b1154fc7c1f3a", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/723df5e17588ca6e76d0d12d560b1154fc7c1f3a"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/cfe3d6538850d8e247995f2119b71f5dd04d1981", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/cfe3d6538850d8e247995f2119b71f5dd04d1981", "html_url": "https://github.com/Rust-GCC/gccrs/commit/cfe3d6538850d8e247995f2119b71f5dd04d1981", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/cfe3d6538850d8e247995f2119b71f5dd04d1981/comments", "author": null, "committer": null, "parents": [{"sha": "017fdefeb3fda37d787818f006832ab98c9e8651", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/017fdefeb3fda37d787818f006832ab98c9e8651", "html_url": "https://github.com/Rust-GCC/gccrs/commit/017fdefeb3fda37d787818f006832ab98c9e8651"}], "stats": {"total": 61, "additions": 61, "deletions": 0}, "files": [{"sha": "db002f7ae0e396a066cb8ed0901f3511cd6abc18", "filename": "gcc/ChangeLog", "status": "modified", "additions": 7, "deletions": 0, "changes": 7, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/cfe3d6538850d8e247995f2119b71f5dd04d1981/gcc%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/cfe3d6538850d8e247995f2119b71f5dd04d1981/gcc%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2FChangeLog?ref=cfe3d6538850d8e247995f2119b71f5dd04d1981", "patch": "@@ -1,3 +1,10 @@\n+2016-11-23  Prathamesh Kulkarni  <prathamesh.kulkarni@linaro.org>\n+\n+\tPR middle-end/78153\n+\t* gimple-fold.c (fold_stmt_1): Handle case for GIMPLE_RETURN.\n+\t* tree-vrp.c (extract_range_basic): Handle case for\n+\tCFN_BUILT_IN_STRLEN.\n+\n 2016-11-23  Jeff Law  <law@redhat.com>\n \n \t* config/ia64/ia64.c (ia64_emit_insn_before): Fix prototype."}, {"sha": "684230161187dc3791f92878e900906b7eed47f3", "filename": "gcc/gimple-fold.c", "status": "modified", "additions": 17, "deletions": 0, "changes": 17, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/cfe3d6538850d8e247995f2119b71f5dd04d1981/gcc%2Fgimple-fold.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/cfe3d6538850d8e247995f2119b71f5dd04d1981/gcc%2Fgimple-fold.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fgimple-fold.c?ref=cfe3d6538850d8e247995f2119b71f5dd04d1981", "patch": "@@ -4406,6 +4406,23 @@ fold_stmt_1 (gimple_stmt_iterator *gsi, bool inplace, tree (*valueize) (tree))\n \t}\n       break;\n \n+    case GIMPLE_RETURN:\n+      {\n+\tgreturn *ret_stmt = as_a<greturn *> (stmt);\n+\ttree ret = gimple_return_retval(ret_stmt);\n+\n+\tif (ret && TREE_CODE (ret) == SSA_NAME && valueize)\n+\t  {\n+\t    tree val = valueize (ret);\n+\t    if (val && val != ret)\n+\t      {\n+\t\tgimple_return_set_retval (ret_stmt, val);\n+\t\tchanged = true;\n+\t      }\n+\t  }\n+      }\n+      break;\n+\n     default:;\n     }\n "}, {"sha": "084f3663562df471e60f678c3459a1229c51b084", "filename": "gcc/testsuite/ChangeLog", "status": "modified", "additions": 6, "deletions": 0, "changes": 6, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/cfe3d6538850d8e247995f2119b71f5dd04d1981/gcc%2Ftestsuite%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/cfe3d6538850d8e247995f2119b71f5dd04d1981/gcc%2Ftestsuite%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2FChangeLog?ref=cfe3d6538850d8e247995f2119b71f5dd04d1981", "patch": "@@ -1,3 +1,9 @@\n+2016-11-23  Prathamesh Kulkarni  <prathamesh.kulkarni@linaro.org>\n+\n+\tPR middle-end/78153\n+\t* gcc.dg/tree-ssa/pr78153-1.c: New test.\n+\t* gcc.dg/tree-ssa/pr78153-2.c: Likewise.\n+\n 2016-11-23  James Greenhalgh  <james.greenhalgh@arm.com>\n \n \tPR target/63250"}, {"sha": "2530ba08e1ca53fd7df7d467b2da5602f42f6fe0", "filename": "gcc/testsuite/gcc.dg/tree-ssa/pr78153-1.c", "status": "added", "additions": 10, "deletions": 0, "changes": 10, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/cfe3d6538850d8e247995f2119b71f5dd04d1981/gcc%2Ftestsuite%2Fgcc.dg%2Ftree-ssa%2Fpr78153-1.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/cfe3d6538850d8e247995f2119b71f5dd04d1981/gcc%2Ftestsuite%2Fgcc.dg%2Ftree-ssa%2Fpr78153-1.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgcc.dg%2Ftree-ssa%2Fpr78153-1.c?ref=cfe3d6538850d8e247995f2119b71f5dd04d1981", "patch": "@@ -0,0 +1,10 @@\n+/* { dg-do compile } */\n+/* { dg-options \"-O2 -fdump-tree-evrp-slim\" } */\n+\n+void f(const char *s)\n+{\n+  if (__PTRDIFF_MAX__ <= __builtin_strlen (s))\n+    __builtin_abort ();\n+}\n+\n+/* { dg-final { scan-tree-dump-not \"__builtin_abort\" \"evrp\" } } */"}, {"sha": "de70450f1c9f6715ca72e46823494eeeb2ad3a5d", "filename": "gcc/testsuite/gcc.dg/tree-ssa/pr78153-2.c", "status": "added", "additions": 11, "deletions": 0, "changes": 11, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/cfe3d6538850d8e247995f2119b71f5dd04d1981/gcc%2Ftestsuite%2Fgcc.dg%2Ftree-ssa%2Fpr78153-2.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/cfe3d6538850d8e247995f2119b71f5dd04d1981/gcc%2Ftestsuite%2Fgcc.dg%2Ftree-ssa%2Fpr78153-2.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgcc.dg%2Ftree-ssa%2Fpr78153-2.c?ref=cfe3d6538850d8e247995f2119b71f5dd04d1981", "patch": "@@ -0,0 +1,11 @@\n+/* { dg-do compile } */\n+/* { dg-options \"-O2 -fdump-tree-evrp-slim\" } */\n+\n+void f(const char *s)\n+{\n+  __PTRDIFF_TYPE__ n = __builtin_strlen (s);\n+  if (n < 0)\n+    __builtin_abort ();\n+}\n+\n+/* { dg-final { scan-tree-dump-not \"__builtin_abort\" \"evrp\" } } */"}, {"sha": "33e0a755cfee6fa929a7ae89dadba4ded4e44d33", "filename": "gcc/tree-vrp.c", "status": "modified", "additions": 10, "deletions": 0, "changes": 10, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/cfe3d6538850d8e247995f2119b71f5dd04d1981/gcc%2Ftree-vrp.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/cfe3d6538850d8e247995f2119b71f5dd04d1981/gcc%2Ftree-vrp.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftree-vrp.c?ref=cfe3d6538850d8e247995f2119b71f5dd04d1981", "patch": "@@ -4027,6 +4027,16 @@ extract_range_basic (value_range *vr, gimple *stmt)\n \t\t\t          : vrp_val_max (type), NULL);\n \t  }\n \t  return;\n+\tcase CFN_BUILT_IN_STRLEN:\n+\t  {\n+\t    tree type = TREE_TYPE (gimple_call_lhs (stmt));\n+\t    tree max = vrp_val_max (ptrdiff_type_node);\n+\t    wide_int wmax = wi::to_wide (max, TYPE_PRECISION (TREE_TYPE (max)));\n+\t    tree range_min = build_zero_cst (type); \n+\t    tree range_max = wide_int_to_tree (type, wmax - 1);\n+\t    set_value_range (vr, VR_RANGE, range_min, range_max, NULL);\n+\t  }\n+\t  return;\n \tdefault:\n \t  break;\n \t}"}]}