{"sha": "7b9d99e615212c24cecae4202d8def9aa5e71809", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6N2I5ZDk5ZTYxNTIxMmMyNGNlY2FlNDIwMmQ4ZGVmOWFhNWU3MTgwOQ==", "commit": {"author": {"name": "Thomas Schwinge", "email": "thomas@codesourcery.com", "date": "2021-08-11T20:31:55Z"}, "committer": {"name": "Thomas Schwinge", "email": "thomas@codesourcery.com", "date": "2021-08-16T10:09:14Z"}, "message": "Clarify memory management for 'prop_set' in 'gcc/omp-oacc-neuter-broadcast.cc'\n\nClean-up for recent commit e2a58ed6dc5293602d0d168475109caa81ad0f0d\n\"openacc: Middle-end worker-partitioning support\".\n\n\tgcc/\n\t* omp-oacc-neuter-broadcast.cc\n\t(execute_omp_oacc_neuter_broadcast): Clarify memory management for\n\t'prop_set'.", "tree": {"sha": "e02a394330940ebb4f3c22503960324b23b7dfde", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/e02a394330940ebb4f3c22503960324b23b7dfde"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/7b9d99e615212c24cecae4202d8def9aa5e71809", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/7b9d99e615212c24cecae4202d8def9aa5e71809", "html_url": "https://github.com/Rust-GCC/gccrs/commit/7b9d99e615212c24cecae4202d8def9aa5e71809", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/7b9d99e615212c24cecae4202d8def9aa5e71809/comments", "author": {"login": "tschwinge", "id": 21753, "node_id": "MDQ6VXNlcjIxNzUz", "avatar_url": "https://avatars.githubusercontent.com/u/21753?v=4", "gravatar_id": "", "url": "https://api.github.com/users/tschwinge", "html_url": "https://github.com/tschwinge", "followers_url": "https://api.github.com/users/tschwinge/followers", "following_url": "https://api.github.com/users/tschwinge/following{/other_user}", "gists_url": "https://api.github.com/users/tschwinge/gists{/gist_id}", "starred_url": "https://api.github.com/users/tschwinge/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/tschwinge/subscriptions", "organizations_url": "https://api.github.com/users/tschwinge/orgs", "repos_url": "https://api.github.com/users/tschwinge/repos", "events_url": "https://api.github.com/users/tschwinge/events{/privacy}", "received_events_url": "https://api.github.com/users/tschwinge/received_events", "type": "User", "site_admin": false}, "committer": {"login": "tschwinge", "id": 21753, "node_id": "MDQ6VXNlcjIxNzUz", "avatar_url": "https://avatars.githubusercontent.com/u/21753?v=4", "gravatar_id": "", "url": "https://api.github.com/users/tschwinge", "html_url": "https://github.com/tschwinge", "followers_url": "https://api.github.com/users/tschwinge/followers", "following_url": "https://api.github.com/users/tschwinge/following{/other_user}", "gists_url": "https://api.github.com/users/tschwinge/gists{/gist_id}", "starred_url": "https://api.github.com/users/tschwinge/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/tschwinge/subscriptions", "organizations_url": "https://api.github.com/users/tschwinge/orgs", "repos_url": "https://api.github.com/users/tschwinge/repos", "events_url": "https://api.github.com/users/tschwinge/events{/privacy}", "received_events_url": "https://api.github.com/users/tschwinge/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "049eda8274b7394523238b17ab12c3e2889f253e", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/049eda8274b7394523238b17ab12c3e2889f253e", "html_url": "https://github.com/Rust-GCC/gccrs/commit/049eda8274b7394523238b17ab12c3e2889f253e"}], "stats": {"total": 10, "additions": 5, "deletions": 5}, "files": [{"sha": "d30867085c3665208ac7759dc6e54e00808cf8e5", "filename": "gcc/omp-oacc-neuter-broadcast.cc", "status": "modified", "additions": 5, "deletions": 5, "changes": 10, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/7b9d99e615212c24cecae4202d8def9aa5e71809/gcc%2Fomp-oacc-neuter-broadcast.cc", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/7b9d99e615212c24cecae4202d8def9aa5e71809/gcc%2Fomp-oacc-neuter-broadcast.cc", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fomp-oacc-neuter-broadcast.cc?ref=7b9d99e615212c24cecae4202d8def9aa5e71809", "patch": "@@ -1398,11 +1398,8 @@ execute_omp_oacc_neuter_broadcast ()\n   FOR_ALL_BB_FN (bb, cfun)\n     bb->aux = NULL;\n \n-  vec<propagation_set *> prop_set;\n-  prop_set.create (last_basic_block_for_fn (cfun));\n-\n-  for (int i = 0; i < last_basic_block_for_fn (cfun); i++)\n-    prop_set.quick_push (0);\n+  vec<propagation_set *> prop_set (vNULL);\n+  prop_set.safe_grow_cleared (last_basic_block_for_fn (cfun), true);\n \n   find_ssa_names_to_propagate (par, mask, worker_single, vector_single,\n \t\t\t       &prop_set);\n@@ -1461,6 +1458,9 @@ execute_omp_oacc_neuter_broadcast ()\n     delete it.second;\n   record_field_map.empty ();\n \n+  /* These are supposed to have been 'delete'd by 'neuter_worker_single'.  */\n+  for (auto it : prop_set)\n+    gcc_checking_assert (!it);\n   prop_set.release ();\n \n   /* This doesn't seem to make a difference.  */"}]}