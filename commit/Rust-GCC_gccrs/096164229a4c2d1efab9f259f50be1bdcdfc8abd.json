{"sha": "096164229a4c2d1efab9f259f50be1bdcdfc8abd", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6MDk2MTY0MjI5YTRjMmQxZWZhYjlmMjU5ZjUwYmUxYmRjZGZjOGFiZA==", "commit": {"author": {"name": "Nathan Sidwell", "email": "nathan@acm.org", "date": "2020-12-17T13:57:13Z"}, "committer": {"name": "Nathan Sidwell", "email": "nathan@acm.org", "date": "2020-12-17T13:57:13Z"}, "message": "bootstrap: Fix some windows issues [PR 98300]\n\nWhen breaking out the sample server from the gcc/cp directory, it lost\nits check for mmap, and the sample resolver just assumed it was there.\nFixed thusly.  The non-mapping paths in module.cc weren't (recently)\nexcercised, and led to a signedness warning.  Finally I'd missed\nc++tools's config.h.in in the gcc_update script.  There I took the\nopportunity of adding a 'tools' segment of the dependency lists.\n\n\tPR bootstrap/98300\n\tcontrib/\n\t* gcc_update: Add c++tools/config.h.in.\n\tc++tools/\n\t* configure.ac: Check for sys/mman.h.\n\t* resolver.cc: Don't assume mmap, O_CLOEXEC are available.  Use\n\txmalloc.\n\t* config.h.in: Regenerated.\n\t* configure: Regenerated.\n\tgcc/cp/\n\t* module.cc: Fix ::read, ::write result signedness comparisons.", "tree": {"sha": "0b12ffe2253c9c39b900696978b1b86f09927d32", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/0b12ffe2253c9c39b900696978b1b86f09927d32"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/096164229a4c2d1efab9f259f50be1bdcdfc8abd", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/096164229a4c2d1efab9f259f50be1bdcdfc8abd", "html_url": "https://github.com/Rust-GCC/gccrs/commit/096164229a4c2d1efab9f259f50be1bdcdfc8abd", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/096164229a4c2d1efab9f259f50be1bdcdfc8abd/comments", "author": {"login": "urnathan", "id": 13103001, "node_id": "MDQ6VXNlcjEzMTAzMDAx", "avatar_url": "https://avatars.githubusercontent.com/u/13103001?v=4", "gravatar_id": "", "url": "https://api.github.com/users/urnathan", "html_url": "https://github.com/urnathan", "followers_url": "https://api.github.com/users/urnathan/followers", "following_url": "https://api.github.com/users/urnathan/following{/other_user}", "gists_url": "https://api.github.com/users/urnathan/gists{/gist_id}", "starred_url": "https://api.github.com/users/urnathan/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/urnathan/subscriptions", "organizations_url": "https://api.github.com/users/urnathan/orgs", "repos_url": "https://api.github.com/users/urnathan/repos", "events_url": "https://api.github.com/users/urnathan/events{/privacy}", "received_events_url": "https://api.github.com/users/urnathan/received_events", "type": "User", "site_admin": false}, "committer": {"login": "urnathan", "id": 13103001, "node_id": "MDQ6VXNlcjEzMTAzMDAx", "avatar_url": "https://avatars.githubusercontent.com/u/13103001?v=4", "gravatar_id": "", "url": "https://api.github.com/users/urnathan", "html_url": "https://github.com/urnathan", "followers_url": "https://api.github.com/users/urnathan/followers", "following_url": "https://api.github.com/users/urnathan/following{/other_user}", "gists_url": "https://api.github.com/users/urnathan/gists{/gist_id}", "starred_url": "https://api.github.com/users/urnathan/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/urnathan/subscriptions", "organizations_url": "https://api.github.com/users/urnathan/orgs", "repos_url": "https://api.github.com/users/urnathan/repos", "events_url": "https://api.github.com/users/urnathan/events{/privacy}", "received_events_url": "https://api.github.com/users/urnathan/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "5357b1620c547a6f2bd81e7868c800e2eee97e51", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/5357b1620c547a6f2bd81e7868c800e2eee97e51", "html_url": "https://github.com/Rust-GCC/gccrs/commit/5357b1620c547a6f2bd81e7868c800e2eee97e51"}], "stats": {"total": 748, "additions": 736, "deletions": 12}, "files": [{"sha": "bfb4958235702b0a17623fe3776abac7415ec9fe", "filename": "c++tools/config.h.in", "status": "modified", "additions": 33, "deletions": 0, "changes": 33, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/096164229a4c2d1efab9f259f50be1bdcdfc8abd/c%2B%2Btools%2Fconfig.h.in", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/096164229a4c2d1efab9f259f50be1bdcdfc8abd/c%2B%2Btools%2Fconfig.h.in", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/c%2B%2Btools%2Fconfig.h.in?ref=096164229a4c2d1efab9f259f50be1bdcdfc8abd", "patch": "@@ -15,12 +15,42 @@\n /* Define if inet_ntop provided. */\n #undef HAVE_INET_NTOP\n \n+/* Define to 1 if you have the <inttypes.h> header file. */\n+#undef HAVE_INTTYPES_H\n+\n+/* Define to 1 if you have the <memory.h> header file. */\n+#undef HAVE_MEMORY_H\n+\n /* Define if pselect provided. */\n #undef HAVE_PSELECT\n \n /* Define if select provided. */\n #undef HAVE_SELECT\n \n+/* Define to 1 if you have the <stdint.h> header file. */\n+#undef HAVE_STDINT_H\n+\n+/* Define to 1 if you have the <stdlib.h> header file. */\n+#undef HAVE_STDLIB_H\n+\n+/* Define to 1 if you have the <strings.h> header file. */\n+#undef HAVE_STRINGS_H\n+\n+/* Define to 1 if you have the <string.h> header file. */\n+#undef HAVE_STRING_H\n+\n+/* Define to 1 if you have the <sys/mman.h> header file. */\n+#undef HAVE_SYS_MMAN_H\n+\n+/* Define to 1 if you have the <sys/stat.h> header file. */\n+#undef HAVE_SYS_STAT_H\n+\n+/* Define to 1 if you have the <sys/types.h> header file. */\n+#undef HAVE_SYS_TYPES_H\n+\n+/* Define to 1 if you have the <unistd.h> header file. */\n+#undef HAVE_UNISTD_H\n+\n /* Define if O_CLOEXEC supported by fcntl. */\n #undef HOST_HAS_O_CLOEXEC\n \n@@ -41,3 +71,6 @@\n \n /* Define to the version of this package. */\n #undef PACKAGE_VERSION\n+\n+/* Define to 1 if you have the ANSI C header files. */\n+#undef STDC_HEADERS"}, {"sha": "e32558e936abd427be07717f223594f6f892a34c", "filename": "c++tools/configure", "status": "modified", "additions": 651, "deletions": 2, "changes": 653, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/096164229a4c2d1efab9f259f50be1bdcdfc8abd/c%2B%2Btools%2Fconfigure", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/096164229a4c2d1efab9f259f50be1bdcdfc8abd/c%2B%2Btools%2Fconfigure", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/c%2B%2Btools%2Fconfigure?ref=096164229a4c2d1efab9f259f50be1bdcdfc8abd", "patch": "@@ -195,7 +195,8 @@ test -x / || exit 1\"\n   as_suggested=\"  as_lineno_1=\";as_suggested=$as_suggested$LINENO;as_suggested=$as_suggested\" as_lineno_1a=\\$LINENO\n   as_lineno_2=\";as_suggested=$as_suggested$LINENO;as_suggested=$as_suggested\" as_lineno_2a=\\$LINENO\n   eval 'test \\\"x\\$as_lineno_1'\\$as_run'\\\" != \\\"x\\$as_lineno_2'\\$as_run'\\\" &&\n-  test \\\"x\\`expr \\$as_lineno_1'\\$as_run' + 1\\`\\\" = \\\"x\\$as_lineno_2'\\$as_run'\\\"' || exit 1\"\n+  test \\\"x\\`expr \\$as_lineno_1'\\$as_run' + 1\\`\\\" = \\\"x\\$as_lineno_2'\\$as_run'\\\"' || exit 1\n+test \\$(( 1 + 1 )) = 2 || exit 1\"\n   if (eval \"$as_required\") 2>/dev/null; then :\n   as_have_required=yes\n else\n@@ -583,9 +584,48 @@ PACKAGE_URL=\n \n ac_unique_file=\"c++tools\"\n ac_unique_file=\"server.cc\"\n+# Factoring default headers for most tests.\n+ac_includes_default=\"\\\n+#include <stdio.h>\n+#ifdef HAVE_SYS_TYPES_H\n+# include <sys/types.h>\n+#endif\n+#ifdef HAVE_SYS_STAT_H\n+# include <sys/stat.h>\n+#endif\n+#ifdef STDC_HEADERS\n+# include <stdlib.h>\n+# include <stddef.h>\n+#else\n+# ifdef HAVE_STDLIB_H\n+#  include <stdlib.h>\n+# endif\n+#endif\n+#ifdef HAVE_STRING_H\n+# if !defined STDC_HEADERS && defined HAVE_MEMORY_H\n+#  include <memory.h>\n+# endif\n+# include <string.h>\n+#endif\n+#ifdef HAVE_STRINGS_H\n+# include <strings.h>\n+#endif\n+#ifdef HAVE_INTTYPES_H\n+# include <inttypes.h>\n+#endif\n+#ifdef HAVE_STDINT_H\n+# include <stdint.h>\n+#endif\n+#ifdef HAVE_UNISTD_H\n+# include <unistd.h>\n+#endif\"\n+\n ac_subst_vars='LTLIBOBJS\n LIBOBJS\n get_gcc_base_ver\n+EGREP\n+GREP\n+CPP\n ac_ct_CC\n CFLAGS\n CC\n@@ -671,7 +711,8 @@ LIBS\n CPPFLAGS\n CCC\n CC\n-CFLAGS'\n+CFLAGS\n+CPP'\n \n \n # Initialize some variables set by options.\n@@ -1305,6 +1346,7 @@ Some influential environment variables:\n               you have headers in a nonstandard directory <include dir>\n   CC          C compiler command\n   CFLAGS      C compiler flags\n+  CPP         C preprocessor\n \n Use these variables to override the choices made by `configure' or to help\n it to find libraries and programs with nonstandard names/locations.\n@@ -1461,6 +1503,203 @@ fi\n   as_fn_set_status $ac_retval\n \n } # ac_fn_c_try_compile\n+\n+# ac_fn_c_try_cpp LINENO\n+# ----------------------\n+# Try to preprocess conftest.$ac_ext, and return whether this succeeded.\n+ac_fn_c_try_cpp ()\n+{\n+  as_lineno=${as_lineno-\"$1\"} as_lineno_stack=as_lineno_stack=$as_lineno_stack\n+  if { { ac_try=\"$ac_cpp conftest.$ac_ext\"\n+case \"(($ac_try\" in\n+  *\\\"* | *\\`* | *\\\\*) ac_try_echo=\\$ac_try;;\n+  *) ac_try_echo=$ac_try;;\n+esac\n+eval ac_try_echo=\"\\\"\\$as_me:${as_lineno-$LINENO}: $ac_try_echo\\\"\"\n+$as_echo \"$ac_try_echo\"; } >&5\n+  (eval \"$ac_cpp conftest.$ac_ext\") 2>conftest.err\n+  ac_status=$?\n+  if test -s conftest.err; then\n+    grep -v '^ *+' conftest.err >conftest.er1\n+    cat conftest.er1 >&5\n+    mv -f conftest.er1 conftest.err\n+  fi\n+  $as_echo \"$as_me:${as_lineno-$LINENO}: \\$? = $ac_status\" >&5\n+  test $ac_status = 0; } > conftest.i && {\n+\t test -z \"$ac_c_preproc_warn_flag$ac_c_werror_flag\" ||\n+\t test ! -s conftest.err\n+       }; then :\n+  ac_retval=0\n+else\n+  $as_echo \"$as_me: failed program was:\" >&5\n+sed 's/^/| /' conftest.$ac_ext >&5\n+\n+    ac_retval=1\n+fi\n+  eval $as_lineno_stack; ${as_lineno_stack:+:} unset as_lineno\n+  as_fn_set_status $ac_retval\n+\n+} # ac_fn_c_try_cpp\n+\n+# ac_fn_c_check_header_mongrel LINENO HEADER VAR INCLUDES\n+# -------------------------------------------------------\n+# Tests whether HEADER exists, giving a warning if it cannot be compiled using\n+# the include files in INCLUDES and setting the cache variable VAR\n+# accordingly.\n+ac_fn_c_check_header_mongrel ()\n+{\n+  as_lineno=${as_lineno-\"$1\"} as_lineno_stack=as_lineno_stack=$as_lineno_stack\n+  if eval \\${$3+:} false; then :\n+  { $as_echo \"$as_me:${as_lineno-$LINENO}: checking for $2\" >&5\n+$as_echo_n \"checking for $2... \" >&6; }\n+if eval \\${$3+:} false; then :\n+  $as_echo_n \"(cached) \" >&6\n+fi\n+eval ac_res=\\$$3\n+\t       { $as_echo \"$as_me:${as_lineno-$LINENO}: result: $ac_res\" >&5\n+$as_echo \"$ac_res\" >&6; }\n+else\n+  # Is the header compilable?\n+{ $as_echo \"$as_me:${as_lineno-$LINENO}: checking $2 usability\" >&5\n+$as_echo_n \"checking $2 usability... \" >&6; }\n+cat confdefs.h - <<_ACEOF >conftest.$ac_ext\n+/* end confdefs.h.  */\n+$4\n+#include <$2>\n+_ACEOF\n+if ac_fn_c_try_compile \"$LINENO\"; then :\n+  ac_header_compiler=yes\n+else\n+  ac_header_compiler=no\n+fi\n+rm -f core conftest.err conftest.$ac_objext conftest.$ac_ext\n+{ $as_echo \"$as_me:${as_lineno-$LINENO}: result: $ac_header_compiler\" >&5\n+$as_echo \"$ac_header_compiler\" >&6; }\n+\n+# Is the header present?\n+{ $as_echo \"$as_me:${as_lineno-$LINENO}: checking $2 presence\" >&5\n+$as_echo_n \"checking $2 presence... \" >&6; }\n+cat confdefs.h - <<_ACEOF >conftest.$ac_ext\n+/* end confdefs.h.  */\n+#include <$2>\n+_ACEOF\n+if ac_fn_c_try_cpp \"$LINENO\"; then :\n+  ac_header_preproc=yes\n+else\n+  ac_header_preproc=no\n+fi\n+rm -f conftest.err conftest.i conftest.$ac_ext\n+{ $as_echo \"$as_me:${as_lineno-$LINENO}: result: $ac_header_preproc\" >&5\n+$as_echo \"$ac_header_preproc\" >&6; }\n+\n+# So?  What about this header?\n+case $ac_header_compiler:$ac_header_preproc:$ac_c_preproc_warn_flag in #((\n+  yes:no: )\n+    { $as_echo \"$as_me:${as_lineno-$LINENO}: WARNING: $2: accepted by the compiler, rejected by the preprocessor!\" >&5\n+$as_echo \"$as_me: WARNING: $2: accepted by the compiler, rejected by the preprocessor!\" >&2;}\n+    { $as_echo \"$as_me:${as_lineno-$LINENO}: WARNING: $2: proceeding with the compiler's result\" >&5\n+$as_echo \"$as_me: WARNING: $2: proceeding with the compiler's result\" >&2;}\n+    ;;\n+  no:yes:* )\n+    { $as_echo \"$as_me:${as_lineno-$LINENO}: WARNING: $2: present but cannot be compiled\" >&5\n+$as_echo \"$as_me: WARNING: $2: present but cannot be compiled\" >&2;}\n+    { $as_echo \"$as_me:${as_lineno-$LINENO}: WARNING: $2:     check for missing prerequisite headers?\" >&5\n+$as_echo \"$as_me: WARNING: $2:     check for missing prerequisite headers?\" >&2;}\n+    { $as_echo \"$as_me:${as_lineno-$LINENO}: WARNING: $2: see the Autoconf documentation\" >&5\n+$as_echo \"$as_me: WARNING: $2: see the Autoconf documentation\" >&2;}\n+    { $as_echo \"$as_me:${as_lineno-$LINENO}: WARNING: $2:     section \\\"Present But Cannot Be Compiled\\\"\" >&5\n+$as_echo \"$as_me: WARNING: $2:     section \\\"Present But Cannot Be Compiled\\\"\" >&2;}\n+    { $as_echo \"$as_me:${as_lineno-$LINENO}: WARNING: $2: proceeding with the compiler's result\" >&5\n+$as_echo \"$as_me: WARNING: $2: proceeding with the compiler's result\" >&2;}\n+    ;;\n+esac\n+  { $as_echo \"$as_me:${as_lineno-$LINENO}: checking for $2\" >&5\n+$as_echo_n \"checking for $2... \" >&6; }\n+if eval \\${$3+:} false; then :\n+  $as_echo_n \"(cached) \" >&6\n+else\n+  eval \"$3=\\$ac_header_compiler\"\n+fi\n+eval ac_res=\\$$3\n+\t       { $as_echo \"$as_me:${as_lineno-$LINENO}: result: $ac_res\" >&5\n+$as_echo \"$ac_res\" >&6; }\n+fi\n+  eval $as_lineno_stack; ${as_lineno_stack:+:} unset as_lineno\n+\n+} # ac_fn_c_check_header_mongrel\n+\n+# ac_fn_c_try_run LINENO\n+# ----------------------\n+# Try to link conftest.$ac_ext, and return whether this succeeded. Assumes\n+# that executables *can* be run.\n+ac_fn_c_try_run ()\n+{\n+  as_lineno=${as_lineno-\"$1\"} as_lineno_stack=as_lineno_stack=$as_lineno_stack\n+  if { { ac_try=\"$ac_link\"\n+case \"(($ac_try\" in\n+  *\\\"* | *\\`* | *\\\\*) ac_try_echo=\\$ac_try;;\n+  *) ac_try_echo=$ac_try;;\n+esac\n+eval ac_try_echo=\"\\\"\\$as_me:${as_lineno-$LINENO}: $ac_try_echo\\\"\"\n+$as_echo \"$ac_try_echo\"; } >&5\n+  (eval \"$ac_link\") 2>&5\n+  ac_status=$?\n+  $as_echo \"$as_me:${as_lineno-$LINENO}: \\$? = $ac_status\" >&5\n+  test $ac_status = 0; } && { ac_try='./conftest$ac_exeext'\n+  { { case \"(($ac_try\" in\n+  *\\\"* | *\\`* | *\\\\*) ac_try_echo=\\$ac_try;;\n+  *) ac_try_echo=$ac_try;;\n+esac\n+eval ac_try_echo=\"\\\"\\$as_me:${as_lineno-$LINENO}: $ac_try_echo\\\"\"\n+$as_echo \"$ac_try_echo\"; } >&5\n+  (eval \"$ac_try\") 2>&5\n+  ac_status=$?\n+  $as_echo \"$as_me:${as_lineno-$LINENO}: \\$? = $ac_status\" >&5\n+  test $ac_status = 0; }; }; then :\n+  ac_retval=0\n+else\n+  $as_echo \"$as_me: program exited with status $ac_status\" >&5\n+       $as_echo \"$as_me: failed program was:\" >&5\n+sed 's/^/| /' conftest.$ac_ext >&5\n+\n+       ac_retval=$ac_status\n+fi\n+  rm -rf conftest.dSYM conftest_ipa8_conftest.oo\n+  eval $as_lineno_stack; ${as_lineno_stack:+:} unset as_lineno\n+  as_fn_set_status $ac_retval\n+\n+} # ac_fn_c_try_run\n+\n+# ac_fn_c_check_header_compile LINENO HEADER VAR INCLUDES\n+# -------------------------------------------------------\n+# Tests whether HEADER exists and can be compiled using the include files in\n+# INCLUDES, setting the cache variable VAR accordingly.\n+ac_fn_c_check_header_compile ()\n+{\n+  as_lineno=${as_lineno-\"$1\"} as_lineno_stack=as_lineno_stack=$as_lineno_stack\n+  { $as_echo \"$as_me:${as_lineno-$LINENO}: checking for $2\" >&5\n+$as_echo_n \"checking for $2... \" >&6; }\n+if eval \\${$3+:} false; then :\n+  $as_echo_n \"(cached) \" >&6\n+else\n+  cat confdefs.h - <<_ACEOF >conftest.$ac_ext\n+/* end confdefs.h.  */\n+$4\n+#include <$2>\n+_ACEOF\n+if ac_fn_c_try_compile \"$LINENO\"; then :\n+  eval \"$3=yes\"\n+else\n+  eval \"$3=no\"\n+fi\n+rm -f core conftest.err conftest.$ac_objext conftest.$ac_ext\n+fi\n+eval ac_res=\\$$3\n+\t       { $as_echo \"$as_me:${as_lineno-$LINENO}: result: $ac_res\" >&5\n+$as_echo \"$ac_res\" >&6; }\n+  eval $as_lineno_stack; ${as_lineno_stack:+:} unset as_lineno\n+\n+} # ac_fn_c_check_header_compile\n cat >config.log <<_ACEOF\n This file contains any messages produced by compilers while\n running configure, to aid debugging if configure makes a mistake.\n@@ -3275,6 +3514,416 @@ $as_echo \"#define HOST_HAS_O_CLOEXEC 1\" >>confdefs.h\n \n fi\n \n+ac_ext=c\n+ac_cpp='$CPP $CPPFLAGS'\n+ac_compile='$CC -c $CFLAGS $CPPFLAGS conftest.$ac_ext >&5'\n+ac_link='$CC -o conftest$ac_exeext $CFLAGS $CPPFLAGS $LDFLAGS conftest.$ac_ext $LIBS >&5'\n+ac_compiler_gnu=$ac_cv_c_compiler_gnu\n+{ $as_echo \"$as_me:${as_lineno-$LINENO}: checking how to run the C preprocessor\" >&5\n+$as_echo_n \"checking how to run the C preprocessor... \" >&6; }\n+# On Suns, sometimes $CPP names a directory.\n+if test -n \"$CPP\" && test -d \"$CPP\"; then\n+  CPP=\n+fi\n+if test -z \"$CPP\"; then\n+  if ${ac_cv_prog_CPP+:} false; then :\n+  $as_echo_n \"(cached) \" >&6\n+else\n+      # Double quotes because CPP needs to be expanded\n+    for CPP in \"$CC -E\" \"$CC -E -traditional-cpp\" \"/lib/cpp\"\n+    do\n+      ac_preproc_ok=false\n+for ac_c_preproc_warn_flag in '' yes\n+do\n+  # Use a header file that comes with gcc, so configuring glibc\n+  # with a fresh cross-compiler works.\n+  # Prefer <limits.h> to <assert.h> if __STDC__ is defined, since\n+  # <limits.h> exists even on freestanding compilers.\n+  # On the NeXT, cc -E runs the code through the compiler's parser,\n+  # not just through cpp. \"Syntax error\" is here to catch this case.\n+  cat confdefs.h - <<_ACEOF >conftest.$ac_ext\n+/* end confdefs.h.  */\n+#ifdef __STDC__\n+# include <limits.h>\n+#else\n+# include <assert.h>\n+#endif\n+\t\t     Syntax error\n+_ACEOF\n+if ac_fn_c_try_cpp \"$LINENO\"; then :\n+\n+else\n+  # Broken: fails on valid input.\n+continue\n+fi\n+rm -f conftest.err conftest.i conftest.$ac_ext\n+\n+  # OK, works on sane cases.  Now check whether nonexistent headers\n+  # can be detected and how.\n+  cat confdefs.h - <<_ACEOF >conftest.$ac_ext\n+/* end confdefs.h.  */\n+#include <ac_nonexistent.h>\n+_ACEOF\n+if ac_fn_c_try_cpp \"$LINENO\"; then :\n+  # Broken: success on invalid input.\n+continue\n+else\n+  # Passes both tests.\n+ac_preproc_ok=:\n+break\n+fi\n+rm -f conftest.err conftest.i conftest.$ac_ext\n+\n+done\n+# Because of `break', _AC_PREPROC_IFELSE's cleaning code was skipped.\n+rm -f conftest.i conftest.err conftest.$ac_ext\n+if $ac_preproc_ok; then :\n+  break\n+fi\n+\n+    done\n+    ac_cv_prog_CPP=$CPP\n+\n+fi\n+  CPP=$ac_cv_prog_CPP\n+else\n+  ac_cv_prog_CPP=$CPP\n+fi\n+{ $as_echo \"$as_me:${as_lineno-$LINENO}: result: $CPP\" >&5\n+$as_echo \"$CPP\" >&6; }\n+ac_preproc_ok=false\n+for ac_c_preproc_warn_flag in '' yes\n+do\n+  # Use a header file that comes with gcc, so configuring glibc\n+  # with a fresh cross-compiler works.\n+  # Prefer <limits.h> to <assert.h> if __STDC__ is defined, since\n+  # <limits.h> exists even on freestanding compilers.\n+  # On the NeXT, cc -E runs the code through the compiler's parser,\n+  # not just through cpp. \"Syntax error\" is here to catch this case.\n+  cat confdefs.h - <<_ACEOF >conftest.$ac_ext\n+/* end confdefs.h.  */\n+#ifdef __STDC__\n+# include <limits.h>\n+#else\n+# include <assert.h>\n+#endif\n+\t\t     Syntax error\n+_ACEOF\n+if ac_fn_c_try_cpp \"$LINENO\"; then :\n+\n+else\n+  # Broken: fails on valid input.\n+continue\n+fi\n+rm -f conftest.err conftest.i conftest.$ac_ext\n+\n+  # OK, works on sane cases.  Now check whether nonexistent headers\n+  # can be detected and how.\n+  cat confdefs.h - <<_ACEOF >conftest.$ac_ext\n+/* end confdefs.h.  */\n+#include <ac_nonexistent.h>\n+_ACEOF\n+if ac_fn_c_try_cpp \"$LINENO\"; then :\n+  # Broken: success on invalid input.\n+continue\n+else\n+  # Passes both tests.\n+ac_preproc_ok=:\n+break\n+fi\n+rm -f conftest.err conftest.i conftest.$ac_ext\n+\n+done\n+# Because of `break', _AC_PREPROC_IFELSE's cleaning code was skipped.\n+rm -f conftest.i conftest.err conftest.$ac_ext\n+if $ac_preproc_ok; then :\n+\n+else\n+  { { $as_echo \"$as_me:${as_lineno-$LINENO}: error: in \\`$ac_pwd':\" >&5\n+$as_echo \"$as_me: error: in \\`$ac_pwd':\" >&2;}\n+as_fn_error $? \"C preprocessor \\\"$CPP\\\" fails sanity check\n+See \\`config.log' for more details\" \"$LINENO\" 5; }\n+fi\n+\n+ac_ext=c\n+ac_cpp='$CPP $CPPFLAGS'\n+ac_compile='$CC -c $CFLAGS $CPPFLAGS conftest.$ac_ext >&5'\n+ac_link='$CC -o conftest$ac_exeext $CFLAGS $CPPFLAGS $LDFLAGS conftest.$ac_ext $LIBS >&5'\n+ac_compiler_gnu=$ac_cv_c_compiler_gnu\n+\n+\n+{ $as_echo \"$as_me:${as_lineno-$LINENO}: checking for grep that handles long lines and -e\" >&5\n+$as_echo_n \"checking for grep that handles long lines and -e... \" >&6; }\n+if ${ac_cv_path_GREP+:} false; then :\n+  $as_echo_n \"(cached) \" >&6\n+else\n+  if test -z \"$GREP\"; then\n+  ac_path_GREP_found=false\n+  # Loop through the user's path and test for each of PROGNAME-LIST\n+  as_save_IFS=$IFS; IFS=$PATH_SEPARATOR\n+for as_dir in $PATH$PATH_SEPARATOR/usr/xpg4/bin\n+do\n+  IFS=$as_save_IFS\n+  test -z \"$as_dir\" && as_dir=.\n+    for ac_prog in grep ggrep; do\n+    for ac_exec_ext in '' $ac_executable_extensions; do\n+      ac_path_GREP=\"$as_dir/$ac_prog$ac_exec_ext\"\n+      as_fn_executable_p \"$ac_path_GREP\" || continue\n+# Check for GNU ac_path_GREP and select it if it is found.\n+  # Check for GNU $ac_path_GREP\n+case `\"$ac_path_GREP\" --version 2>&1` in\n+*GNU*)\n+  ac_cv_path_GREP=\"$ac_path_GREP\" ac_path_GREP_found=:;;\n+*)\n+  ac_count=0\n+  $as_echo_n 0123456789 >\"conftest.in\"\n+  while :\n+  do\n+    cat \"conftest.in\" \"conftest.in\" >\"conftest.tmp\"\n+    mv \"conftest.tmp\" \"conftest.in\"\n+    cp \"conftest.in\" \"conftest.nl\"\n+    $as_echo 'GREP' >> \"conftest.nl\"\n+    \"$ac_path_GREP\" -e 'GREP$' -e '-(cannot match)-' < \"conftest.nl\" >\"conftest.out\" 2>/dev/null || break\n+    diff \"conftest.out\" \"conftest.nl\" >/dev/null 2>&1 || break\n+    as_fn_arith $ac_count + 1 && ac_count=$as_val\n+    if test $ac_count -gt ${ac_path_GREP_max-0}; then\n+      # Best one so far, save it but keep looking for a better one\n+      ac_cv_path_GREP=\"$ac_path_GREP\"\n+      ac_path_GREP_max=$ac_count\n+    fi\n+    # 10*(2^10) chars as input seems more than enough\n+    test $ac_count -gt 10 && break\n+  done\n+  rm -f conftest.in conftest.tmp conftest.nl conftest.out;;\n+esac\n+\n+      $ac_path_GREP_found && break 3\n+    done\n+  done\n+  done\n+IFS=$as_save_IFS\n+  if test -z \"$ac_cv_path_GREP\"; then\n+    as_fn_error $? \"no acceptable grep could be found in $PATH$PATH_SEPARATOR/usr/xpg4/bin\" \"$LINENO\" 5\n+  fi\n+else\n+  ac_cv_path_GREP=$GREP\n+fi\n+\n+fi\n+{ $as_echo \"$as_me:${as_lineno-$LINENO}: result: $ac_cv_path_GREP\" >&5\n+$as_echo \"$ac_cv_path_GREP\" >&6; }\n+ GREP=\"$ac_cv_path_GREP\"\n+\n+\n+{ $as_echo \"$as_me:${as_lineno-$LINENO}: checking for egrep\" >&5\n+$as_echo_n \"checking for egrep... \" >&6; }\n+if ${ac_cv_path_EGREP+:} false; then :\n+  $as_echo_n \"(cached) \" >&6\n+else\n+  if echo a | $GREP -E '(a|b)' >/dev/null 2>&1\n+   then ac_cv_path_EGREP=\"$GREP -E\"\n+   else\n+     if test -z \"$EGREP\"; then\n+  ac_path_EGREP_found=false\n+  # Loop through the user's path and test for each of PROGNAME-LIST\n+  as_save_IFS=$IFS; IFS=$PATH_SEPARATOR\n+for as_dir in $PATH$PATH_SEPARATOR/usr/xpg4/bin\n+do\n+  IFS=$as_save_IFS\n+  test -z \"$as_dir\" && as_dir=.\n+    for ac_prog in egrep; do\n+    for ac_exec_ext in '' $ac_executable_extensions; do\n+      ac_path_EGREP=\"$as_dir/$ac_prog$ac_exec_ext\"\n+      as_fn_executable_p \"$ac_path_EGREP\" || continue\n+# Check for GNU ac_path_EGREP and select it if it is found.\n+  # Check for GNU $ac_path_EGREP\n+case `\"$ac_path_EGREP\" --version 2>&1` in\n+*GNU*)\n+  ac_cv_path_EGREP=\"$ac_path_EGREP\" ac_path_EGREP_found=:;;\n+*)\n+  ac_count=0\n+  $as_echo_n 0123456789 >\"conftest.in\"\n+  while :\n+  do\n+    cat \"conftest.in\" \"conftest.in\" >\"conftest.tmp\"\n+    mv \"conftest.tmp\" \"conftest.in\"\n+    cp \"conftest.in\" \"conftest.nl\"\n+    $as_echo 'EGREP' >> \"conftest.nl\"\n+    \"$ac_path_EGREP\" 'EGREP$' < \"conftest.nl\" >\"conftest.out\" 2>/dev/null || break\n+    diff \"conftest.out\" \"conftest.nl\" >/dev/null 2>&1 || break\n+    as_fn_arith $ac_count + 1 && ac_count=$as_val\n+    if test $ac_count -gt ${ac_path_EGREP_max-0}; then\n+      # Best one so far, save it but keep looking for a better one\n+      ac_cv_path_EGREP=\"$ac_path_EGREP\"\n+      ac_path_EGREP_max=$ac_count\n+    fi\n+    # 10*(2^10) chars as input seems more than enough\n+    test $ac_count -gt 10 && break\n+  done\n+  rm -f conftest.in conftest.tmp conftest.nl conftest.out;;\n+esac\n+\n+      $ac_path_EGREP_found && break 3\n+    done\n+  done\n+  done\n+IFS=$as_save_IFS\n+  if test -z \"$ac_cv_path_EGREP\"; then\n+    as_fn_error $? \"no acceptable egrep could be found in $PATH$PATH_SEPARATOR/usr/xpg4/bin\" \"$LINENO\" 5\n+  fi\n+else\n+  ac_cv_path_EGREP=$EGREP\n+fi\n+\n+   fi\n+fi\n+{ $as_echo \"$as_me:${as_lineno-$LINENO}: result: $ac_cv_path_EGREP\" >&5\n+$as_echo \"$ac_cv_path_EGREP\" >&6; }\n+ EGREP=\"$ac_cv_path_EGREP\"\n+\n+\n+{ $as_echo \"$as_me:${as_lineno-$LINENO}: checking for ANSI C header files\" >&5\n+$as_echo_n \"checking for ANSI C header files... \" >&6; }\n+if ${ac_cv_header_stdc+:} false; then :\n+  $as_echo_n \"(cached) \" >&6\n+else\n+  cat confdefs.h - <<_ACEOF >conftest.$ac_ext\n+/* end confdefs.h.  */\n+#include <stdlib.h>\n+#include <stdarg.h>\n+#include <string.h>\n+#include <float.h>\n+\n+int\n+main ()\n+{\n+\n+  ;\n+  return 0;\n+}\n+_ACEOF\n+if ac_fn_c_try_compile \"$LINENO\"; then :\n+  ac_cv_header_stdc=yes\n+else\n+  ac_cv_header_stdc=no\n+fi\n+rm -f core conftest.err conftest.$ac_objext conftest.$ac_ext\n+\n+if test $ac_cv_header_stdc = yes; then\n+  # SunOS 4.x string.h does not declare mem*, contrary to ANSI.\n+  cat confdefs.h - <<_ACEOF >conftest.$ac_ext\n+/* end confdefs.h.  */\n+#include <string.h>\n+\n+_ACEOF\n+if (eval \"$ac_cpp conftest.$ac_ext\") 2>&5 |\n+  $EGREP \"memchr\" >/dev/null 2>&1; then :\n+\n+else\n+  ac_cv_header_stdc=no\n+fi\n+rm -f conftest*\n+\n+fi\n+\n+if test $ac_cv_header_stdc = yes; then\n+  # ISC 2.0.2 stdlib.h does not declare free, contrary to ANSI.\n+  cat confdefs.h - <<_ACEOF >conftest.$ac_ext\n+/* end confdefs.h.  */\n+#include <stdlib.h>\n+\n+_ACEOF\n+if (eval \"$ac_cpp conftest.$ac_ext\") 2>&5 |\n+  $EGREP \"free\" >/dev/null 2>&1; then :\n+\n+else\n+  ac_cv_header_stdc=no\n+fi\n+rm -f conftest*\n+\n+fi\n+\n+if test $ac_cv_header_stdc = yes; then\n+  # /bin/cc in Irix-4.0.5 gets non-ANSI ctype macros unless using -ansi.\n+  if test \"$cross_compiling\" = yes; then :\n+  :\n+else\n+  cat confdefs.h - <<_ACEOF >conftest.$ac_ext\n+/* end confdefs.h.  */\n+#include <ctype.h>\n+#include <stdlib.h>\n+#if ((' ' & 0x0FF) == 0x020)\n+# define ISLOWER(c) ('a' <= (c) && (c) <= 'z')\n+# define TOUPPER(c) (ISLOWER(c) ? 'A' + ((c) - 'a') : (c))\n+#else\n+# define ISLOWER(c) \\\n+\t\t   (('a' <= (c) && (c) <= 'i') \\\n+\t\t     || ('j' <= (c) && (c) <= 'r') \\\n+\t\t     || ('s' <= (c) && (c) <= 'z'))\n+# define TOUPPER(c) (ISLOWER(c) ? ((c) | 0x40) : (c))\n+#endif\n+\n+#define XOR(e, f) (((e) && !(f)) || (!(e) && (f)))\n+int\n+main ()\n+{\n+  int i;\n+  for (i = 0; i < 256; i++)\n+    if (XOR (islower (i), ISLOWER (i))\n+\t|| toupper (i) != TOUPPER (i))\n+      return 2;\n+  return 0;\n+}\n+_ACEOF\n+if ac_fn_c_try_run \"$LINENO\"; then :\n+\n+else\n+  ac_cv_header_stdc=no\n+fi\n+rm -f core *.core core.conftest.* gmon.out bb.out conftest$ac_exeext \\\n+  conftest.$ac_objext conftest.beam conftest.$ac_ext\n+fi\n+\n+fi\n+fi\n+{ $as_echo \"$as_me:${as_lineno-$LINENO}: result: $ac_cv_header_stdc\" >&5\n+$as_echo \"$ac_cv_header_stdc\" >&6; }\n+if test $ac_cv_header_stdc = yes; then\n+\n+$as_echo \"#define STDC_HEADERS 1\" >>confdefs.h\n+\n+fi\n+\n+# On IRIX 5.3, sys/types and inttypes.h are conflicting.\n+for ac_header in sys/types.h sys/stat.h stdlib.h string.h memory.h strings.h \\\n+\t\t  inttypes.h stdint.h unistd.h\n+do :\n+  as_ac_Header=`$as_echo \"ac_cv_header_$ac_header\" | $as_tr_sh`\n+ac_fn_c_check_header_compile \"$LINENO\" \"$ac_header\" \"$as_ac_Header\" \"$ac_includes_default\n+\"\n+if eval test \\\"x\\$\"$as_ac_Header\"\\\" = x\"yes\"; then :\n+  cat >>confdefs.h <<_ACEOF\n+#define `$as_echo \"HAVE_$ac_header\" | $as_tr_cpp` 1\n+_ACEOF\n+\n+fi\n+\n+done\n+\n+\n+for ac_header in sys/mman.h\n+do :\n+  ac_fn_c_check_header_mongrel \"$LINENO\" \"sys/mman.h\" \"ac_cv_header_sys_mman_h\" \"$ac_includes_default\"\n+if test \"x$ac_cv_header_sys_mman_h\" = xyes; then :\n+  cat >>confdefs.h <<_ACEOF\n+#define HAVE_SYS_MMAN_H 1\n+_ACEOF\n+\n+fi\n+\n+done\n+\n+\n # C++ Modules would like some networking features to provide the mapping\n # server.  You can still use modules without them though.\n # The following network-related checks could probably do with some"}, {"sha": "21b3a0668e609e227fc53700589609f6a59f8703", "filename": "c++tools/configure.ac", "status": "modified", "additions": 2, "deletions": 0, "changes": 2, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/096164229a4c2d1efab9f259f50be1bdcdfc8abd/c%2B%2Btools%2Fconfigure.ac", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/096164229a4c2d1efab9f259f50be1bdcdfc8abd/c%2B%2Btools%2Fconfigure.ac", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/c%2B%2Btools%2Fconfigure.ac?ref=096164229a4c2d1efab9f259f50be1bdcdfc8abd", "patch": "@@ -77,6 +77,8 @@ if test $ac_cv_o_cloexec = yes; then\n   [Define if O_CLOEXEC supported by fcntl.])\n fi\n \n+AC_CHECK_HEADERS(sys/mman.h)\n+\n # C++ Modules would like some networking features to provide the mapping\n # server.  You can still use modules without them though.\n # The following network-related checks could probably do with some"}, {"sha": "c8d3115357428d9d2815ae690377f7c7e5128a2e", "filename": "c++tools/resolver.cc", "status": "modified", "additions": 40, "deletions": 1, "changes": 41, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/096164229a4c2d1efab9f259f50be1bdcdfc8abd/c%2B%2Btools%2Fresolver.cc", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/096164229a4c2d1efab9f259f50be1bdcdfc8abd/c%2B%2Btools%2Fresolver.cc", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/c%2B%2Btools%2Fresolver.cc?ref=096164229a4c2d1efab9f259f50be1bdcdfc8abd", "patch": "@@ -28,10 +28,36 @@ along with GCC; see the file COPYING3.  If not see\n // OS\n #include <fcntl.h>\n #include <unistd.h>\n+#if 0 // 1 for testing no mmap\n+#define MAPPED_READING 0\n+#else\n+#ifdef IN_GCC\n+#if HAVE_MMAP_FILE && _POSIX_MAPPED_FILES > 0\n+#define MAPPED_READING 1\n+#else\n+#define MAPPED_READING 0\n+#endif\n+#else\n+#ifdef HAVE_SYS_MMAN_H\n #include <sys/mman.h>\n+#define MAPPED_READING 1\n+#else\n+#define MAPPED_READING 0\n+#endif\n+#endif\n+#endif\n+\n #include <sys/types.h>\n #include <sys/stat.h>\n \n+#if !defined (IN_GCC) && !MAPPED_READING\n+#define xmalloc(X) malloc(X)\n+#endif\n+\n+#if !HOST_HAS_O_CLOEXEC\n+#define O_CLOEXEC 0\n+#endif\n+\n #ifndef DIR_SEPARATOR\n #define DIR_SEPARATOR '/'\n #endif\n@@ -81,11 +107,20 @@ module_resolver::read_tuple_file (int fd, char const *prefix, bool force)\n   if (!stat.st_size)\n     return 0;\n \n+  void *buffer = nullptr;\n+#if MAPPED_READING\n   // Just map the file, we're gonna read all of it, so no need for\n   // line buffering\n-  void *buffer = mmap (nullptr, stat.st_size, PROT_READ, MAP_PRIVATE, fd, 0);\n+  buffer = mmap (nullptr, stat.st_size, PROT_READ, MAP_PRIVATE, fd, 0);\n   if (buffer == MAP_FAILED)\n     return -errno;\n+#else\n+  buffer = xmalloc (stat.st_size);\n+  if (!buffer)\n+    return -errno;\n+  if (read (fd, buffer, stat.st_size) != stat.st_size)\n+    return -errno;\n+#endif\n \n   size_t prefix_len = prefix ? strlen (prefix) : 0;\n   unsigned lineno = 0;\n@@ -144,7 +179,11 @@ module_resolver::read_tuple_file (int fd, char const *prefix, bool force)\n \t}\n     }\n \n+#if MAPPED_READING\n   munmap (buffer, stat.st_size);\n+#else\n+  free (buffer);\n+#endif\n \n   return 0;\n }"}, {"sha": "43d284d81257ac6253e5fc086c74bebfd710dba2", "filename": "contrib/gcc_update", "status": "modified", "additions": 3, "deletions": 1, "changes": 4, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/096164229a4c2d1efab9f259f50be1bdcdfc8abd/contrib%2Fgcc_update", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/096164229a4c2d1efab9f259f50be1bdcdfc8abd/contrib%2Fgcc_update", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/contrib%2Fgcc_update?ref=096164229a4c2d1efab9f259f50be1bdcdfc8abd", "patch": "@@ -76,7 +76,6 @@ intl/plural-config.h: intl/plural.y\n intl/configure: intl/configure.ac intl/aclocal.m4\n intl/config.h.in: intl/configure.ac intl/aclocal.m4\n # Now, proceed to gcc automatically generated files\n-c++tools/configure: c++tools/configure.ac\n gcc/configure: gcc/configure.ac\n gcc/cstamp-h.in: gcc/configure.ac\n gcc/config.in: gcc/cstamp-h.in\n@@ -103,6 +102,9 @@ gcc/testsuite/gcc.dg/cpp/direct2s.c: gcc/testsuite/gcc.dg/cpp/direct2.c\n # lto-plugin\n lto-plugin/configure: lto-plugin/configure.ac lto-plugin/aclocal.m4\n lto-plugin/Makefile.in: lto-plugin/Makefile.am lto-plugin/aclocal.m4\n+# tools\n+c++tools/configure: c++tools/configure.ac\n+c++tools/config.h.in: c++tools/configure.ac\n # And libraries, at last\n libbanshee/configure: libbanshee/configure.ac\n libmudflap/configure: libmudflap/configure.ac"}, {"sha": "21d04ccec19bd9cea1fa0773e050d3f7f8e5ddcf", "filename": "gcc/cp/module.cc", "status": "modified", "additions": 7, "deletions": 8, "changes": 15, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/096164229a4c2d1efab9f259f50be1bdcdfc8abd/gcc%2Fcp%2Fmodule.cc", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/096164229a4c2d1efab9f259f50be1bdcdfc8abd/gcc%2Fcp%2Fmodule.cc", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fcp%2Fmodule.cc?ref=096164229a4c2d1efab9f259f50be1bdcdfc8abd", "patch": "@@ -232,6 +232,10 @@ Classes used:\n #define CODY_NETWORKING 0\n #include \"mapper-client.h\"\n \n+#if 0 // 1 for testing no mmap\n+#define MAPPED_READING 0\n+#define MAPPED_WRITING 0\n+#else\n #if HAVE_MMAP_FILE && _POSIX_MAPPED_FILES > 0\n /* mmap, munmap.  */\n #define MAPPED_READING 1\n@@ -246,11 +250,6 @@ Classes used:\n #define MAPPED_READING 0\n #define MAPPED_WRITING 0\n #endif\n-#if 0 // for testing\n-#undef MAPPED_READING\n-#undef MAPPED_WRITING\n-#define MAPPED_READING 0\n-#define MAPPED_WRITING 0\n #endif\n \n #if !HOST_HAS_O_CLOEXEC\n@@ -1657,7 +1656,7 @@ elf_in::read (data *data, unsigned pos, unsigned length)\n #if MAPPED_READING  \n   data->buffer = hdr.buffer + pos;\n #else\n-  if (::read (fd, data->buffer, data->size) != length)\n+  if (::read (fd, data->buffer, data->size) != ssize_t (length))\n     {\n       set_error (errno);\n       shrink (*data);\n@@ -2049,7 +2048,7 @@ elf_out::write (const data &buffer)\n     /* We should have been aligned during the first allocation.  */\n     gcc_checking_assert (!(pos & (SECTION_ALIGN - 1)));\n #else\n-  if (::write (fd, buffer.buffer, buffer.pos) != buffer.pos)\n+  if (::write (fd, buffer.buffer, buffer.pos) != ssize_t (buffer.pos))\n     {\n       set_error (errno);\n       return 0;\n@@ -2064,7 +2063,7 @@ elf_out::write (const data &buffer)\n       /* Align the section on disk, should help the necessary copies.\n \t fseeking to extend is non-portable.  */\n       static char zero[SECTION_ALIGN];\n-      if (::write (fd, &zero, padding) != padding)\n+      if (::write (fd, &zero, padding) != ssize_t (padding))\n \tset_error (errno);\n #endif\n       pos += padding;"}]}