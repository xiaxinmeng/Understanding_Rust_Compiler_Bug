{"sha": "8ccaace8355c45a0b4602c2a666d4d5318fdc707", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6OGNjYWFjZTgzNTVjNDVhMGI0NjAyYzJhNjY2ZDRkNTMxOGZkYzcwNw==", "commit": {"author": {"name": "Jakub Jelinek", "email": "jakub@redhat.com", "date": "2016-12-17T19:10:39Z"}, "committer": {"name": "Jakub Jelinek", "email": "jakub@gcc.gnu.org", "date": "2016-12-17T19:10:39Z"}, "message": "re PR sanitizer/78832 (-fcompare-debug failure (length) with -fsanitize=address)\n\n\tPR sanitizer/78832\n\t* sanopt.c (sanitize_asan_mark_unpoison): Remove next variable, use\n\tcontinue if gsi_next should be skipped.\n\t(sanitize_asan_mark_poison): Remove prev variable, use continue if\n\tgsi_prev should be skipped.  When removing ASAN_MARK, do gsi_prev\n\tfirst and gsi_remove on a previously made copy of the iterator.\n\n\t* gcc.dg/asan/pr78832.c: New test.\n\nFrom-SVN: r243777", "tree": {"sha": "407a3a12d4ecccfc9625b2c66a274b6e86f30f6a", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/407a3a12d4ecccfc9625b2c66a274b6e86f30f6a"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/8ccaace8355c45a0b4602c2a666d4d5318fdc707", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/8ccaace8355c45a0b4602c2a666d4d5318fdc707", "html_url": "https://github.com/Rust-GCC/gccrs/commit/8ccaace8355c45a0b4602c2a666d4d5318fdc707", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/8ccaace8355c45a0b4602c2a666d4d5318fdc707/comments", "author": {"login": "jakubjelinek", "id": 9370665, "node_id": "MDQ6VXNlcjkzNzA2NjU=", "avatar_url": "https://avatars.githubusercontent.com/u/9370665?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jakubjelinek", "html_url": "https://github.com/jakubjelinek", "followers_url": "https://api.github.com/users/jakubjelinek/followers", "following_url": "https://api.github.com/users/jakubjelinek/following{/other_user}", "gists_url": "https://api.github.com/users/jakubjelinek/gists{/gist_id}", "starred_url": "https://api.github.com/users/jakubjelinek/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jakubjelinek/subscriptions", "organizations_url": "https://api.github.com/users/jakubjelinek/orgs", "repos_url": "https://api.github.com/users/jakubjelinek/repos", "events_url": "https://api.github.com/users/jakubjelinek/events{/privacy}", "received_events_url": "https://api.github.com/users/jakubjelinek/received_events", "type": "User", "site_admin": false}, "committer": null, "parents": [{"sha": "63ac625170fb144df1c58c0475a5ac8c60005ea1", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/63ac625170fb144df1c58c0475a5ac8c60005ea1", "html_url": "https://github.com/Rust-GCC/gccrs/commit/63ac625170fb144df1c58c0475a5ac8c60005ea1"}], "stats": {"total": 52, "additions": 43, "deletions": 9}, "files": [{"sha": "5452c91df72f4fbc4b0d5ed06dcd648fd3510a07", "filename": "gcc/ChangeLog", "status": "modified", "additions": 9, "deletions": 0, "changes": 9, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/8ccaace8355c45a0b4602c2a666d4d5318fdc707/gcc%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/8ccaace8355c45a0b4602c2a666d4d5318fdc707/gcc%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2FChangeLog?ref=8ccaace8355c45a0b4602c2a666d4d5318fdc707", "patch": "@@ -1,3 +1,12 @@\n+2016-12-17  Jakub Jelinek  <jakub@redhat.com>\n+\n+\tPR sanitizer/78832\n+\t* sanopt.c (sanitize_asan_mark_unpoison): Remove next variable, use\n+\tcontinue if gsi_next should be skipped.\n+\t(sanitize_asan_mark_poison): Remove prev variable, use continue if\n+\tgsi_prev should be skipped.  When removing ASAN_MARK, do gsi_prev\n+\tfirst and gsi_remove on a previously made copy of the iterator.\n+\n 2016-12-17  Andrew Senkevich  <andrew.senkevich@intel.com>\n \n \t* config/i386/avx512bwintrin.h: Add new k-mask intrinsics."}, {"sha": "ae716cffcf4b19ae8a555f2304acdf24094cbebe", "filename": "gcc/sanopt.c", "status": "modified", "additions": 7, "deletions": 9, "changes": 16, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/8ccaace8355c45a0b4602c2a666d4d5318fdc707/gcc%2Fsanopt.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/8ccaace8355c45a0b4602c2a666d4d5318fdc707/gcc%2Fsanopt.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fsanopt.c?ref=8ccaace8355c45a0b4602c2a666d4d5318fdc707", "patch": "@@ -740,7 +740,6 @@ sanitize_asan_mark_unpoison (void)\n       gimple_stmt_iterator gsi;\n       for (gsi = gsi_start_bb (bb); !gsi_end_p (gsi);)\n \t{\n-\t  bool next = true;\n \t  gimple *stmt = gsi_stmt (gsi);\n \t  if (gimple_call_internal_p (stmt, IFN_ASAN_MARK))\n \t    {\n@@ -753,12 +752,11 @@ sanitize_asan_mark_unpoison (void)\n \t\t  unlink_stmt_vdef (stmt);\n \t\t  release_defs (stmt);\n \t\t  gsi_remove (&gsi, true);\n-\t\t  next = false;\n+\t\t  continue;\n \t\t}\n \t    }\n \n-\t  if (next)\n-\t    gsi_next (&gsi);\n+\t  gsi_next (&gsi);\n \t}\n     }\n }\n@@ -840,7 +838,6 @@ sanitize_asan_mark_poison (void)\n       gimple_stmt_iterator gsi;\n       for (gsi = gsi_last_bb (bb); !gsi_end_p (gsi);)\n \t{\n-\t  bool prev = true;\n \t  gimple *stmt = gsi_stmt (gsi);\n \t  if (maybe_contains_asan_check (stmt))\n \t    break;\n@@ -850,12 +847,13 @@ sanitize_asan_mark_poison (void)\n \t\tfprintf (dump_file, \"Removing ASAN_MARK poison\\n\");\n \t      unlink_stmt_vdef (stmt);\n \t      release_defs (stmt);\n-\t      gsi_remove (&gsi, true);\n-\t      prev = false;\n+\t      gimple_stmt_iterator gsi2 = gsi;\n+\t      gsi_prev (&gsi);\n+\t      gsi_remove (&gsi2, true);\n+\t      continue;\n \t    }\n \n-\t  if (prev)\n-\t    gsi_prev (&gsi);\n+\t  gsi_prev (&gsi);\n \t}\n     }\n }"}, {"sha": "8315852aee21adc9daecf12ba9f67fc11f78e4e9", "filename": "gcc/testsuite/ChangeLog", "status": "modified", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/8ccaace8355c45a0b4602c2a666d4d5318fdc707/gcc%2Ftestsuite%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/8ccaace8355c45a0b4602c2a666d4d5318fdc707/gcc%2Ftestsuite%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2FChangeLog?ref=8ccaace8355c45a0b4602c2a666d4d5318fdc707", "patch": "@@ -1,3 +1,8 @@\n+2016-12-17  Jakub Jelinek  <jakub@redhat.com>\n+\n+\tPR sanitizer/78832\n+\t* gcc.dg/asan/pr78832.c: New test.\n+\n 2016-12-17  Andrew Senkevich  <andrew.senkevich@intel.com>\n \n \t* gcc.target/i386/avx512bw-kaddd-1.c: New test."}, {"sha": "deed8f17da64c49e5839953315c7dfcd18953a9d", "filename": "gcc/testsuite/gcc.dg/asan/pr78832.c", "status": "added", "additions": 22, "deletions": 0, "changes": 22, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/8ccaace8355c45a0b4602c2a666d4d5318fdc707/gcc%2Ftestsuite%2Fgcc.dg%2Fasan%2Fpr78832.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/8ccaace8355c45a0b4602c2a666d4d5318fdc707/gcc%2Ftestsuite%2Fgcc.dg%2Fasan%2Fpr78832.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgcc.dg%2Fasan%2Fpr78832.c?ref=8ccaace8355c45a0b4602c2a666d4d5318fdc707", "patch": "@@ -0,0 +1,22 @@\n+/* PR sanitizer/78832 */\n+/* { dg-do compile } */\n+/* { dg-additional-options \"-fcompare-debug\" } */\n+\n+void bar (int *);\n+\n+int\n+foo (int x)\n+{\n+  int *f = 0;\n+  if (x)\n+    goto lab;\n+  {\n+    int y, z;\n+    bar (&y);\n+    int *d = &y;\n+    bar (&z);\n+    int *e = &z;\n+  }\n+  f = &x;\n+  lab: return 6;\n+}"}]}