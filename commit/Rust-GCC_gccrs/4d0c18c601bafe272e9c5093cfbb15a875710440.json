{"sha": "4d0c18c601bafe272e9c5093cfbb15a875710440", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6NGQwYzE4YzYwMWJhZmUyNzJlOWM1MDkzY2ZiYjE1YTg3NTcxMDQ0MA==", "commit": {"author": {"name": "Jason Merrill", "email": "jason@redhat.com", "date": "2019-01-23T13:54:23Z"}, "committer": {"name": "Jason Merrill", "email": "jason@gcc.gnu.org", "date": "2019-01-23T13:54:23Z"}, "message": "PR c++/87893 - constexpr ctor ICE on ARM.\n\n\tPR c++/88293 - ICE with comma expression.\n\t* constexpr.c (initialized_type): Don't shortcut non-void type.\n\tHandle COMPOUND_EXPR.\n\t(cxx_eval_outermost_constant_expr): Return early for void type.\n\nFrom-SVN: r268185", "tree": {"sha": "b2c4f66e110254f441660524593bb55d883fddf0", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/b2c4f66e110254f441660524593bb55d883fddf0"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/4d0c18c601bafe272e9c5093cfbb15a875710440", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/4d0c18c601bafe272e9c5093cfbb15a875710440", "html_url": "https://github.com/Rust-GCC/gccrs/commit/4d0c18c601bafe272e9c5093cfbb15a875710440", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/4d0c18c601bafe272e9c5093cfbb15a875710440/comments", "author": {"login": "jicama", "id": 266146, "node_id": "MDQ6VXNlcjI2NjE0Ng==", "avatar_url": "https://avatars.githubusercontent.com/u/266146?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jicama", "html_url": "https://github.com/jicama", "followers_url": "https://api.github.com/users/jicama/followers", "following_url": "https://api.github.com/users/jicama/following{/other_user}", "gists_url": "https://api.github.com/users/jicama/gists{/gist_id}", "starred_url": "https://api.github.com/users/jicama/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jicama/subscriptions", "organizations_url": "https://api.github.com/users/jicama/orgs", "repos_url": "https://api.github.com/users/jicama/repos", "events_url": "https://api.github.com/users/jicama/events{/privacy}", "received_events_url": "https://api.github.com/users/jicama/received_events", "type": "User", "site_admin": false}, "committer": null, "parents": [{"sha": "561fd08128381a5b37569b465f55cb4cac1f3b14", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/561fd08128381a5b37569b465f55cb4cac1f3b14", "html_url": "https://github.com/Rust-GCC/gccrs/commit/561fd08128381a5b37569b465f55cb4cac1f3b14"}], "stats": {"total": 25, "additions": 22, "deletions": 3}, "files": [{"sha": "20a54719578151e6aa4b665e05f01faf023b1fc8", "filename": "gcc/cp/ChangeLog", "status": "modified", "additions": 8, "deletions": 0, "changes": 8, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/4d0c18c601bafe272e9c5093cfbb15a875710440/gcc%2Fcp%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/4d0c18c601bafe272e9c5093cfbb15a875710440/gcc%2Fcp%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fcp%2FChangeLog?ref=4d0c18c601bafe272e9c5093cfbb15a875710440", "patch": "@@ -1,3 +1,11 @@\n+2019-01-21  Jason Merrill  <jason@redhat.com>\n+\n+\tPR c++/87893 - constexpr ctor ICE on ARM.\n+\tPR c++/88293 - ICE with comma expression.\n+\t* constexpr.c (initialized_type): Don't shortcut non-void type.\n+\tHandle COMPOUND_EXPR.\n+\t(cxx_eval_outermost_constant_expr): Return early for void type.\n+\n 2019-01-21  Jakub Jelinek  <jakub@redhat.com>\n \n \tPR c++/88949"}, {"sha": "426814167600c67640a765eb26dc51934ae91a52", "filename": "gcc/cp/constexpr.c", "status": "modified", "additions": 5, "deletions": 3, "changes": 8, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/4d0c18c601bafe272e9c5093cfbb15a875710440/gcc%2Fcp%2Fconstexpr.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/4d0c18c601bafe272e9c5093cfbb15a875710440/gcc%2Fcp%2Fconstexpr.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fcp%2Fconstexpr.c?ref=4d0c18c601bafe272e9c5093cfbb15a875710440", "patch": "@@ -2848,16 +2848,16 @@ initialized_type (tree t)\n   if (TYPE_P (t))\n     return t;\n   tree type = TREE_TYPE (t);\n-  if (!VOID_TYPE_P (type))\n-    /* No need to look deeper.  */;\n-  else if (TREE_CODE (t) == CALL_EXPR)\n+  if (TREE_CODE (t) == CALL_EXPR)\n     {\n       /* A constructor call has void type, so we need to look deeper.  */\n       tree fn = get_function_named_in_call (t);\n       if (fn && TREE_CODE (fn) == FUNCTION_DECL\n \t  && DECL_CXX_CONSTRUCTOR_P (fn))\n \ttype = DECL_CONTEXT (fn);\n     }\n+  else if (TREE_CODE (t) == COMPOUND_EXPR)\n+    return initialized_type (TREE_OPERAND (t, 1));\n   else if (TREE_CODE (t) == AGGR_INIT_EXPR)\n     type = TREE_TYPE (AGGR_INIT_EXPR_SLOT (t));\n   return cv_unqualified (type);\n@@ -5061,6 +5061,8 @@ cxx_eval_outermost_constant_expr (tree t, bool allow_non_constant,\n \n   tree type = initialized_type (t);\n   tree r = t;\n+  if (VOID_TYPE_P (type))\n+    return t;\n   if (AGGREGATE_TYPE_P (type) || VECTOR_TYPE_P (type))\n     {\n       /* In C++14 an NSDMI can participate in aggregate initialization,"}, {"sha": "9dd1299ddf4277242d038f825506d4a4623350cd", "filename": "gcc/testsuite/g++.dg/cpp0x/constexpr-comma1.C", "status": "added", "additions": 9, "deletions": 0, "changes": 9, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/4d0c18c601bafe272e9c5093cfbb15a875710440/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Fcpp0x%2Fconstexpr-comma1.C", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/4d0c18c601bafe272e9c5093cfbb15a875710440/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Fcpp0x%2Fconstexpr-comma1.C", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Fcpp0x%2Fconstexpr-comma1.C?ref=4d0c18c601bafe272e9c5093cfbb15a875710440", "patch": "@@ -0,0 +1,9 @@\n+// PR c++/88293\n+// { dg-do compile { target c++11 } }\n+\n+struct A\n+{ \n+  constexpr A () { }\n+};\n+\n+const A &a = (A (), A ());"}]}