{"sha": "a83452e99b8a902287eaf065f98bf40c76771502", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6YTgzNDUyZTk5YjhhOTAyMjg3ZWFmMDY1Zjk4YmY0MGM3Njc3MTUwMg==", "commit": {"author": {"name": "Alexandre Oliva", "email": "aoliva@redhat.com", "date": "2009-11-18T06:02:58Z"}, "committer": {"name": "Alexandre Oliva", "email": "aoliva@gcc.gnu.org", "date": "2009-11-18T06:02:58Z"}, "message": "re PR debug/41926 ([VTA] internal compiler error: verify_ssa failed)\n\ngcc/ChangeLog:\nPR debug/41926\n* tree-vect-loop.c (vect_loop_kill_debug_uses): New.\n(vect_transform_loop): Call it.\ngcc/testsuite/ChangeLog:\nPR debug/41926\n* gcc.dg/vect/vect-debug-pr41926.c: New.\n\nFrom-SVN: r154281", "tree": {"sha": "a6b88362e8d78afe576037d96a3eb40ad1eca386", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/a6b88362e8d78afe576037d96a3eb40ad1eca386"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/a83452e99b8a902287eaf065f98bf40c76771502", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/a83452e99b8a902287eaf065f98bf40c76771502", "html_url": "https://github.com/Rust-GCC/gccrs/commit/a83452e99b8a902287eaf065f98bf40c76771502", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/a83452e99b8a902287eaf065f98bf40c76771502/comments", "author": null, "committer": null, "parents": [{"sha": "462b701b20f1d303c27bff97e9ab7ac5729959ca", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/462b701b20f1d303c27bff97e9ab7ac5729959ca", "html_url": "https://github.com/Rust-GCC/gccrs/commit/462b701b20f1d303c27bff97e9ab7ac5729959ca"}], "stats": {"total": 77, "additions": 76, "deletions": 1}, "files": [{"sha": "256721ff68a06e432fb782daebd588049ed302db", "filename": "gcc/ChangeLog", "status": "modified", "additions": 6, "deletions": 0, "changes": 6, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/a83452e99b8a902287eaf065f98bf40c76771502/gcc%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/a83452e99b8a902287eaf065f98bf40c76771502/gcc%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2FChangeLog?ref=a83452e99b8a902287eaf065f98bf40c76771502", "patch": "@@ -1,3 +1,9 @@\n+2009-11-18  Alexandre Oliva  <aoliva@redhat.com>\n+\n+\tPR debug/41926\n+\t* tree-vect-loop.c (vect_loop_kill_debug_uses): New.\n+\t(vect_transform_loop): Call it.\n+\n 2009-11-18  Alexandre Oliva  <aoliva@redhat.com>\n \n \t* tree-ssa.c (insert_debug_temp_for_var_def): Fix handling of"}, {"sha": "3ebf59bbc6aa86fb12ca6f3af12bcc29a9997bf9", "filename": "gcc/testsuite/ChangeLog", "status": "modified", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/a83452e99b8a902287eaf065f98bf40c76771502/gcc%2Ftestsuite%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/a83452e99b8a902287eaf065f98bf40c76771502/gcc%2Ftestsuite%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2FChangeLog?ref=a83452e99b8a902287eaf065f98bf40c76771502", "patch": "@@ -1,3 +1,8 @@\n+2009-11-18  Alexandre Oliva  <aoliva@redhat.com>\n+\n+\tPR debug/41926\n+\t* gcc.dg/vect/vect-debug-pr41926.c: New.\n+\n 2009-11-17  Paolo Carlini  <paolo.carlini@oracle.com>\n \n \tPR c++/42058"}, {"sha": "6eea84ae129ec3eae166f341a5f1a86550ae75cf", "filename": "gcc/testsuite/gcc.dg/vect/vect-debug-pr41926.c", "status": "added", "additions": 20, "deletions": 0, "changes": 20, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/a83452e99b8a902287eaf065f98bf40c76771502/gcc%2Ftestsuite%2Fgcc.dg%2Fvect%2Fvect-debug-pr41926.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/a83452e99b8a902287eaf065f98bf40c76771502/gcc%2Ftestsuite%2Fgcc.dg%2Fvect%2Fvect-debug-pr41926.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgcc.dg%2Fvect%2Fvect-debug-pr41926.c?ref=a83452e99b8a902287eaf065f98bf40c76771502", "patch": "@@ -0,0 +1,20 @@\n+/* PR debug/41926 */\n+/* { dg-do compile } */\n+/* { dg-options \"-O2 -g -ffast-math -funroll-loops -ftree-vectorize -msse2\" { target { i?86-*-* x86_64-*-* } } } */\n+\n+void\n+foo (double (*__restrict p)[4], double (*__restrict q)[4],\n+     double *__restrict prim, double scale, double pp, double pq)\n+{\n+  int md, mc, mb, ma, p_index = 0;\n+\n+  for (md = 0; md < 1; md++)\n+    for (mc = 0; mc < 1; mc++)\n+      for (mb = 0; mb < 1; mb++)\n+\tfor (ma = 0; ma < 4; ma++)\n+\t  {\n+\t    double tmp = scale * prim[p_index++];\n+\t    p[md][ma] = p[md][ma] - tmp * pp;\n+\t    q[mc][ma] = q[mc][ma] - tmp * pq;\n+\t  }\n+}"}, {"sha": "55b9fb2bf99a5a3e6df2d130832ed03e9323b84e", "filename": "gcc/tree-vect-loop.c", "status": "modified", "additions": 45, "deletions": 1, "changes": 46, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/a83452e99b8a902287eaf065f98bf40c76771502/gcc%2Ftree-vect-loop.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/a83452e99b8a902287eaf065f98bf40c76771502/gcc%2Ftree-vect-loop.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftree-vect-loop.c?ref=a83452e99b8a902287eaf065f98bf40c76771502", "patch": "@@ -4112,6 +4112,44 @@ vectorizable_live_operation (gimple stmt,\n   return true;\n }\n \n+/* Kill any debug uses outside LOOP of SSA names defined in STMT.  */\n+\n+static void\n+vect_loop_kill_debug_uses (struct loop *loop, gimple stmt)\n+{\n+  ssa_op_iter op_iter;\n+  imm_use_iterator imm_iter;\n+  def_operand_p def_p;\n+  gimple ustmt;\n+\n+  FOR_EACH_PHI_OR_STMT_DEF (def_p, stmt, op_iter, SSA_OP_DEF)\n+    {\n+      FOR_EACH_IMM_USE_STMT (ustmt, imm_iter, DEF_FROM_PTR (def_p))\n+\t{\n+\t  basic_block bb;\n+\n+\t  if (!is_gimple_debug (ustmt))\n+\t    continue;\n+\n+\t  bb = gimple_bb (ustmt);\n+\n+\t  if (!flow_bb_inside_loop_p (loop, bb))\n+\t    {\n+\t      if (gimple_debug_bind_p (ustmt))\n+\t\t{\n+\t\t  if (vect_print_dump_info (REPORT_DETAILS))\n+\t\t    fprintf (vect_dump, \"killing debug use\");\n+\n+\t\t  gimple_debug_bind_reset_value (ustmt);\n+\t\t  update_stmt (ustmt);\n+\t\t}\n+\t      else\n+\t\tgcc_unreachable ();\n+\t    }\n+\t}\n+    }\n+}\n+\n /* Function vect_transform_loop.\n \n    The analysis phase has determined that the loop is vectorizable.\n@@ -4202,7 +4240,11 @@ vect_transform_loop (loop_vec_info loop_vinfo)\n \n \t  if (!STMT_VINFO_RELEVANT_P (stmt_info)\n \t      && !STMT_VINFO_LIVE_P (stmt_info))\n-\t    continue;\n+\t    {\n+\t      if (MAY_HAVE_DEBUG_STMTS)\n+\t\tvect_loop_kill_debug_uses (loop, phi);\n+\t      continue;\n+\t    }\n \n \t  if ((TYPE_VECTOR_SUBPARTS (STMT_VINFO_VECTYPE (stmt_info))\n \t        != (unsigned HOST_WIDE_INT) vectorization_factor)\n@@ -4242,6 +4284,8 @@ vect_transform_loop (loop_vec_info loop_vinfo)\n \t  if (!STMT_VINFO_RELEVANT_P (stmt_info)\n \t      && !STMT_VINFO_LIVE_P (stmt_info))\n \t    {\n+\t      if (MAY_HAVE_DEBUG_STMTS)\n+\t\tvect_loop_kill_debug_uses (loop, stmt);\n \t      gsi_next (&si);\n \t      continue;\n \t    }"}]}