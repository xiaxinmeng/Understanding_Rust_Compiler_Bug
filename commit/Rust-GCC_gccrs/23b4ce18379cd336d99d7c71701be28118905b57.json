{"sha": "23b4ce18379cd336d99d7c71701be28118905b57", "node_id": "C_kwDOANBUbNoAKDIzYjRjZTE4Mzc5Y2QzMzZkOTlkN2M3MTcwMWJlMjgxMTg5MDViNTc", "commit": {"author": {"name": "Jakub Jelinek", "email": "jakub@redhat.com", "date": "2023-01-11T21:18:42Z"}, "committer": {"name": "Jakub Jelinek", "email": "jakub@redhat.com", "date": "2023-01-11T21:18:42Z"}, "message": "c: Don't emit DEBUG_BEGIN_STMTs for K&R function argument declarations [PR105972]\n\nK&R function parameter declarations are handled by calling\nrecursively c_parser_declaration_or_fndef in a loop, where each such\ncall will add_debug_begin_stmt at the start.\nNow, if the K&R function definition is not a nested function,\nbuilding_stmt_list_p () is false and so we don't emit the DEBUG_BEGIN_STMTs\nanywhere, but if it is a nested function, we emit it in the containing\nfunction at the point of the nested function definition.\nAs the following testcase shows, it can cause ICEs if the containing\nfunction has var-tracking disabled but nested function has them enabled,\nas the DEBUG_BEGIN_STMTs are added to the containing function which\nshouldn't have them but MAY_HAVE_DEBUG_MARKER_STMTS is checked already\nfor the nested function, or just wrong experience in the debugger.\n\nThe following patch ensures we don't emit any such DEBUG_BEGIN_STMTs for the\nK&R function parameter declarations even in nested functions.\n\n2023-01-11  Jakub Jelinek  <jakub@redhat.com>\n\n\tPR c/105972\n\t* c-parser.cc (c_parser_declaration_or_fndef): Disable debug non-bind\n\tmarkers for K&R function parameter declarations of nested functions.\n\n\t* gcc.dg/pr105972.c: New test.", "tree": {"sha": "ed6bba0fa0d63032b43e412e930457f7c5ee69be", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/ed6bba0fa0d63032b43e412e930457f7c5ee69be"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/23b4ce18379cd336d99d7c71701be28118905b57", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/23b4ce18379cd336d99d7c71701be28118905b57", "html_url": "https://github.com/Rust-GCC/gccrs/commit/23b4ce18379cd336d99d7c71701be28118905b57", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/23b4ce18379cd336d99d7c71701be28118905b57/comments", "author": {"login": "jakubjelinek", "id": 9370665, "node_id": "MDQ6VXNlcjkzNzA2NjU=", "avatar_url": "https://avatars.githubusercontent.com/u/9370665?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jakubjelinek", "html_url": "https://github.com/jakubjelinek", "followers_url": "https://api.github.com/users/jakubjelinek/followers", "following_url": "https://api.github.com/users/jakubjelinek/following{/other_user}", "gists_url": "https://api.github.com/users/jakubjelinek/gists{/gist_id}", "starred_url": "https://api.github.com/users/jakubjelinek/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jakubjelinek/subscriptions", "organizations_url": "https://api.github.com/users/jakubjelinek/orgs", "repos_url": "https://api.github.com/users/jakubjelinek/repos", "events_url": "https://api.github.com/users/jakubjelinek/events{/privacy}", "received_events_url": "https://api.github.com/users/jakubjelinek/received_events", "type": "User", "site_admin": false}, "committer": {"login": "jakubjelinek", "id": 9370665, "node_id": "MDQ6VXNlcjkzNzA2NjU=", "avatar_url": "https://avatars.githubusercontent.com/u/9370665?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jakubjelinek", "html_url": "https://github.com/jakubjelinek", "followers_url": "https://api.github.com/users/jakubjelinek/followers", "following_url": "https://api.github.com/users/jakubjelinek/following{/other_user}", "gists_url": "https://api.github.com/users/jakubjelinek/gists{/gist_id}", "starred_url": "https://api.github.com/users/jakubjelinek/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jakubjelinek/subscriptions", "organizations_url": "https://api.github.com/users/jakubjelinek/orgs", "repos_url": "https://api.github.com/users/jakubjelinek/repos", "events_url": "https://api.github.com/users/jakubjelinek/events{/privacy}", "received_events_url": "https://api.github.com/users/jakubjelinek/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "98837d6e79dd27c15f5218f3f1ddf838cda4796c", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/98837d6e79dd27c15f5218f3f1ddf838cda4796c", "html_url": "https://github.com/Rust-GCC/gccrs/commit/98837d6e79dd27c15f5218f3f1ddf838cda4796c"}], "stats": {"total": 18, "additions": 18, "deletions": 0}, "files": [{"sha": "3e2109bfd4f87c9f3339ee74c875241d4fed2904", "filename": "gcc/c/c-parser.cc", "status": "modified", "additions": 3, "deletions": 0, "changes": 3, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/23b4ce18379cd336d99d7c71701be28118905b57/gcc%2Fc%2Fc-parser.cc", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/23b4ce18379cd336d99d7c71701be28118905b57/gcc%2Fc%2Fc-parser.cc", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fc%2Fc-parser.cc?ref=23b4ce18379cd336d99d7c71701be28118905b57", "patch": "@@ -2804,10 +2804,13 @@ c_parser_declaration_or_fndef (c_parser *parser, bool fndef_ok,\n \t declarator with a nonempty identifier list in a definition;\n \t and postfix attributes have never been accepted here in\n \t function definitions either.  */\n+      int save_debug_nonbind_markers_p = debug_nonbind_markers_p;\n+      debug_nonbind_markers_p = 0;\n       while (c_parser_next_token_is_not (parser, CPP_EOF)\n \t     && c_parser_next_token_is_not (parser, CPP_OPEN_BRACE))\n \tc_parser_declaration_or_fndef (parser, false, false, false,\n \t\t\t\t       true, false);\n+      debug_nonbind_markers_p = save_debug_nonbind_markers_p;\n       store_parm_decls ();\n       if (omp_declare_simd_clauses)\n \tc_finish_omp_declare_simd (parser, current_function_decl, NULL_TREE,"}, {"sha": "73f3385f7eba856ba58995343c07b63c84100889", "filename": "gcc/testsuite/gcc.dg/pr105972.c", "status": "added", "additions": 15, "deletions": 0, "changes": 15, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/23b4ce18379cd336d99d7c71701be28118905b57/gcc%2Ftestsuite%2Fgcc.dg%2Fpr105972.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/23b4ce18379cd336d99d7c71701be28118905b57/gcc%2Ftestsuite%2Fgcc.dg%2Fpr105972.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgcc.dg%2Fpr105972.c?ref=23b4ce18379cd336d99d7c71701be28118905b57", "patch": "@@ -0,0 +1,15 @@\n+/* PR c/105972 */\n+/* { dg-do compile } */\n+/* { dg-options \"-O2 -g\" } */\n+\n+__attribute__((optimize (0))) int\n+foo (void)\n+{\n+  int\n+  bar (x)\n+    int x;\n+  {\n+    return x;\n+  }\n+  return bar (0);\n+}"}]}