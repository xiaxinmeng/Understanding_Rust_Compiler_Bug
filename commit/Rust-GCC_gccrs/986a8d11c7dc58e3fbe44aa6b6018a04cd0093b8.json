{"sha": "986a8d11c7dc58e3fbe44aa6b6018a04cd0093b8", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6OTg2YThkMTFjN2RjNThlM2ZiZTQ0YWE2YjYwMThhMDRjZDAwOTNiOA==", "commit": {"author": {"name": "Thomas Koenig", "email": "tkoenig@gcc.gnu.org", "date": "2008-06-29T19:06:06Z"}, "committer": {"name": "Thomas Koenig", "email": "tkoenig@gcc.gnu.org", "date": "2008-06-29T19:06:06Z"}, "message": "re PR fortran/36341 (MATMUL: Bounds check missing)\n\n2008-06-29  Thomas Koenig  <tkoenig@gcc.gnu.org>\n\n\tPR fortran/36341\n\t* iresolve.c (gfc_resolve_matmul): Copy shapes\n\tfrom arguments.\n\n2008-06-29  Thomas Koenig  <tkoenig@gcc.gnu.org>\n\n\tPR fortran/36341\n\t* gfortran.dg/matmul_bounds_1.f90:  New test.\n\nFrom-SVN: r137255", "tree": {"sha": "9416e6dafab840d6567e990de213db8bceb34a6d", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/9416e6dafab840d6567e990de213db8bceb34a6d"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/986a8d11c7dc58e3fbe44aa6b6018a04cd0093b8", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/986a8d11c7dc58e3fbe44aa6b6018a04cd0093b8", "html_url": "https://github.com/Rust-GCC/gccrs/commit/986a8d11c7dc58e3fbe44aa6b6018a04cd0093b8", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/986a8d11c7dc58e3fbe44aa6b6018a04cd0093b8/comments", "author": null, "committer": null, "parents": [{"sha": "082b0571b5243222c59703a96c2c4cb6e438bad8", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/082b0571b5243222c59703a96c2c4cb6e438bad8", "html_url": "https://github.com/Rust-GCC/gccrs/commit/082b0571b5243222c59703a96c2c4cb6e438bad8"}], "stats": {"total": 64, "additions": 64, "deletions": 0}, "files": [{"sha": "a54a0b14909bc4fb13c7cf00880c66f1f9fc961d", "filename": "gcc/fortran/ChangeLog", "status": "modified", "additions": 6, "deletions": 0, "changes": 6, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/986a8d11c7dc58e3fbe44aa6b6018a04cd0093b8/gcc%2Ffortran%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/986a8d11c7dc58e3fbe44aa6b6018a04cd0093b8/gcc%2Ffortran%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ffortran%2FChangeLog?ref=986a8d11c7dc58e3fbe44aa6b6018a04cd0093b8", "patch": "@@ -1,3 +1,9 @@\n+2008-06-29  Thomas Koenig  <tkoenig@gcc.gnu.org>\n+\n+\tPR fortran/36341\n+\t* iresolve.c (gfc_resolve_matmul): Copy shapes\n+\tfrom arguments.\n+\n 2008-06-29  Jerry DeLisle  <jvdelisle@gcc.gnu.org>\n \n \t* invoke.texi: Add documentation for runtime behavior of"}, {"sha": "a1e7622a866fe67837de985b9ae4c87e3668bb94", "filename": "gcc/fortran/iresolve.c", "status": "modified", "additions": 28, "deletions": 0, "changes": 28, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/986a8d11c7dc58e3fbe44aa6b6018a04cd0093b8/gcc%2Ffortran%2Firesolve.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/986a8d11c7dc58e3fbe44aa6b6018a04cd0093b8/gcc%2Ffortran%2Firesolve.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ffortran%2Firesolve.c?ref=986a8d11c7dc58e3fbe44aa6b6018a04cd0093b8", "patch": "@@ -1341,6 +1341,34 @@ gfc_resolve_matmul (gfc_expr *f, gfc_expr *a, gfc_expr *b)\n \n   f->rank = (a->rank == 2 && b->rank == 2) ? 2 : 1;\n \n+  if (a->rank == 2 && b->rank == 2)\n+    {\n+      if (a->shape && b->shape)\n+\t{\n+\t  f->shape = gfc_get_shape (f->rank);\n+\t  mpz_init_set (f->shape[0], a->shape[0]);\n+\t  mpz_init_set (f->shape[1], b->shape[1]);\n+\t}\n+    }\n+  else if (a->rank == 1)\n+    {\n+      if (b->shape)\n+\t{\n+\t  f->shape = gfc_get_shape (f->rank);\n+\t  mpz_init_set (f->shape[0], b->shape[1]);\n+\t}\n+    }\n+  else \n+    {\n+      /* b->rank == 1 and a->rank == 2 here, all other cases have\n+\t been caught in check.c.   */\n+      if (a->shape)\n+\t{\n+\t  f->shape = gfc_get_shape (f->rank);\n+\t  mpz_init_set (f->shape[0], a->shape[0]);\n+\t}\n+    }\n+\n   f->value.function.name\n     = gfc_get_string (PREFIX (\"matmul_%c%d\"), gfc_type_letter (f->ts.type),\n \t\t      f->ts.kind);"}, {"sha": "f2fbbb0f95c87034518a6f7acb0c322bfa35e7db", "filename": "gcc/testsuite/ChangeLog", "status": "modified", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/986a8d11c7dc58e3fbe44aa6b6018a04cd0093b8/gcc%2Ftestsuite%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/986a8d11c7dc58e3fbe44aa6b6018a04cd0093b8/gcc%2Ftestsuite%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2FChangeLog?ref=986a8d11c7dc58e3fbe44aa6b6018a04cd0093b8", "patch": "@@ -1,3 +1,8 @@\n+2008-06-29  Thomas Koenig  <tkoenig@gcc.gnu.org>\n+\n+\tPR fortran/36341\n+\t* gfortran.dg/matmul_bounds_1.f90:  New test.\n+\n 2008-06-29  Jakub Jelinek  <jakub@redhat.com>\n \n \tPR testsuite/36620"}, {"sha": "1d180a0d45863b4ad195068b8a6a9382a295c25e", "filename": "gcc/testsuite/gfortran.dg/matmul_bounds_1.f90", "status": "added", "additions": 25, "deletions": 0, "changes": 25, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/986a8d11c7dc58e3fbe44aa6b6018a04cd0093b8/gcc%2Ftestsuite%2Fgfortran.dg%2Fmatmul_bounds_1.f90", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/986a8d11c7dc58e3fbe44aa6b6018a04cd0093b8/gcc%2Ftestsuite%2Fgfortran.dg%2Fmatmul_bounds_1.f90", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgfortran.dg%2Fmatmul_bounds_1.f90?ref=986a8d11c7dc58e3fbe44aa6b6018a04cd0093b8", "patch": "@@ -0,0 +1,25 @@\n+! { dg-do compile }\n+program matmul_bounds_1\n+  implicit none\n+  real, dimension(3,2) :: a\n+  real, dimension(2,3) :: b\n+  real, dimension(3,2) :: rab\n+  real, dimension(2,2) :: rok\n+  real, dimension(2) :: rv\n+  real, dimension(3) :: rw\n+  real, dimension(3) :: x\n+  real, dimension(2) :: y\n+  a = 1\n+  b = 2\n+  x = 3\n+  y = 4\n+  ! These tests should throw an error\n+  rab = matmul(a,b) ! { dg-error \"Different shape\" }\n+  rv = matmul(a,y) ! { dg-error \"Different shape\" }\n+  rv = matmul(x,b) ! { dg-error \"Different shape\" }\n+  ! These are ok.\n+  rw = matmul(a,y)\n+  rv = matmul(x,a)\n+  rok = matmul(b,a)\n+end program matmul_bounds_1\n+"}]}