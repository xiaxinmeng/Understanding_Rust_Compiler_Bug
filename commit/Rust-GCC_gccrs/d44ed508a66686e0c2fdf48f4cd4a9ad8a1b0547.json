{"sha": "d44ed508a66686e0c2fdf48f4cd4a9ad8a1b0547", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6ZDQ0ZWQ1MDhhNjY2ODZlMGMyZmRmNDhmNGNkNGE5YWQ4YTFiMDU0Nw==", "commit": {"author": {"name": "Jakub Jelinek", "email": "jakub@redhat.com", "date": "2017-11-21T08:06:28Z"}, "committer": {"name": "Jakub Jelinek", "email": "jakub@gcc.gnu.org", "date": "2017-11-21T08:06:28Z"}, "message": "re PR c++/83059 (ICE on invalid C++ code: in tree_to_uhwi, at tree.c:6633)\n\n\tPR c++/83059\n\t* c-common.c (get_atomic_generic_size): Use TREE_INT_CST_LOW\n\tinstead of tree_to_uhwi, formatting fix.\n\t* config/i386/i386.c (ix86_memmodel_check): Start\n\t-Winvalid-memory-model diagnostics with lowercase letter.\n\n\t* c-c++-common/pr83059.c: New test.\n\nFrom-SVN: r254990", "tree": {"sha": "389dea12b4c4014e0f61fc4db8838b2ac5e6afd7", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/389dea12b4c4014e0f61fc4db8838b2ac5e6afd7"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/d44ed508a66686e0c2fdf48f4cd4a9ad8a1b0547", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/d44ed508a66686e0c2fdf48f4cd4a9ad8a1b0547", "html_url": "https://github.com/Rust-GCC/gccrs/commit/d44ed508a66686e0c2fdf48f4cd4a9ad8a1b0547", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/d44ed508a66686e0c2fdf48f4cd4a9ad8a1b0547/comments", "author": {"login": "jakubjelinek", "id": 9370665, "node_id": "MDQ6VXNlcjkzNzA2NjU=", "avatar_url": "https://avatars.githubusercontent.com/u/9370665?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jakubjelinek", "html_url": "https://github.com/jakubjelinek", "followers_url": "https://api.github.com/users/jakubjelinek/followers", "following_url": "https://api.github.com/users/jakubjelinek/following{/other_user}", "gists_url": "https://api.github.com/users/jakubjelinek/gists{/gist_id}", "starred_url": "https://api.github.com/users/jakubjelinek/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jakubjelinek/subscriptions", "organizations_url": "https://api.github.com/users/jakubjelinek/orgs", "repos_url": "https://api.github.com/users/jakubjelinek/repos", "events_url": "https://api.github.com/users/jakubjelinek/events{/privacy}", "received_events_url": "https://api.github.com/users/jakubjelinek/received_events", "type": "User", "site_admin": false}, "committer": null, "parents": [{"sha": "8b87e0d12576318e2ae02284e767b4d083cc4149", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/8b87e0d12576318e2ae02284e767b4d083cc4149", "html_url": "https://github.com/Rust-GCC/gccrs/commit/8b87e0d12576318e2ae02284e767b4d083cc4149"}], "stats": {"total": 40, "additions": 32, "deletions": 8}, "files": [{"sha": "a7bbd9c0a99bcc8358c0b725857d106dacb22a8d", "filename": "gcc/ChangeLog", "status": "modified", "additions": 4, "deletions": 0, "changes": 4, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/d44ed508a66686e0c2fdf48f4cd4a9ad8a1b0547/gcc%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/d44ed508a66686e0c2fdf48f4cd4a9ad8a1b0547/gcc%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2FChangeLog?ref=d44ed508a66686e0c2fdf48f4cd4a9ad8a1b0547", "patch": "@@ -1,5 +1,9 @@\n 2017-11-21  Jakub Jelinek  <jakub@redhat.com>\n \n+\tPR c++/83059\n+\t* config/i386/i386.c (ix86_memmodel_check): Start\n+\t-Winvalid-memory-model diagnostics with lowercase letter.\n+\n \tPR debug/82718\n \t* dwarf2out.c (dw_loc_list): If crtl->has_bb_partition, temporarily\n \tset in_cold_section_p to the partition containing loc_list->first."}, {"sha": "7258f865fb9dc3592982c00dc726e5efed509116", "filename": "gcc/c-family/ChangeLog", "status": "modified", "additions": 6, "deletions": 0, "changes": 6, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/d44ed508a66686e0c2fdf48f4cd4a9ad8a1b0547/gcc%2Fc-family%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/d44ed508a66686e0c2fdf48f4cd4a9ad8a1b0547/gcc%2Fc-family%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fc-family%2FChangeLog?ref=d44ed508a66686e0c2fdf48f4cd4a9ad8a1b0547", "patch": "@@ -1,3 +1,9 @@\n+2017-11-21  Jakub Jelinek  <jakub@redhat.com>\n+\n+\tPR c++/83059\n+\t* c-common.c (get_atomic_generic_size): Use TREE_INT_CST_LOW\n+\tinstead of tree_to_uhwi, formatting fix.\n+\n 2017-11-20  David Malcolm  <dmalcolm@redhat.com>\n \n \tPR c/81404"}, {"sha": "969f41bdd8cabc406b432c36efba7af73f857311", "filename": "gcc/c-family/c-common.c", "status": "modified", "additions": 8, "deletions": 7, "changes": 15, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/d44ed508a66686e0c2fdf48f4cd4a9ad8a1b0547/gcc%2Fc-family%2Fc-common.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/d44ed508a66686e0c2fdf48f4cd4a9ad8a1b0547/gcc%2Fc-family%2Fc-common.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fc-family%2Fc-common.c?ref=d44ed508a66686e0c2fdf48f4cd4a9ad8a1b0547", "patch": "@@ -6671,13 +6671,14 @@ get_atomic_generic_size (location_t loc, tree function,\n       tree p = (*params)[x];\n       if (TREE_CODE (p) == INTEGER_CST)\n         {\n-\t  int i = tree_to_uhwi (p);\n-\t  if (i < 0 || (memmodel_base (i) >= MEMMODEL_LAST))\n-\t    {\n-\t      warning_at (loc, OPT_Winvalid_memory_model,\n-\t\t\t  \"invalid memory model argument %d of %qE\", x + 1,\n-\t\t\t  function);\n-\t    }\n+\t  /* memmodel_base masks the low 16 bits, thus ignore any bits above\n+\t     it by using TREE_INT_CST_LOW instead of tree_to_*hwi.  Those high\n+\t     bits will be checked later during expansion in target specific\n+\t     way.  */\n+\t  if (memmodel_base (TREE_INT_CST_LOW (p)) >= MEMMODEL_LAST)\n+\t    warning_at (loc, OPT_Winvalid_memory_model,\n+\t\t\t\"invalid memory model argument %d of %qE\", x + 1,\n+\t\t\tfunction);\n \t}\n       else\n \tif (!INTEGRAL_TYPE_P (TREE_TYPE (p)))"}, {"sha": "b32288608d98867a712510d222fa57f278ee7a15", "filename": "gcc/config/i386/i386.c", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/d44ed508a66686e0c2fdf48f4cd4a9ad8a1b0547/gcc%2Fconfig%2Fi386%2Fi386.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/d44ed508a66686e0c2fdf48f4cd4a9ad8a1b0547/gcc%2Fconfig%2Fi386%2Fi386.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fconfig%2Fi386%2Fi386.c?ref=d44ed508a66686e0c2fdf48f4cd4a9ad8a1b0547", "patch": "@@ -49066,7 +49066,7 @@ ix86_memmodel_check (unsigned HOST_WIDE_INT val)\n       || ((val & IX86_HLE_ACQUIRE) && (val & IX86_HLE_RELEASE)))\n     {\n       warning (OPT_Winvalid_memory_model,\n-\t       \"Unknown architecture specific memory model\");\n+\t       \"unknown architecture specific memory model\");\n       return MEMMODEL_SEQ_CST;\n     }\n   strong = (is_mm_acq_rel (model) || is_mm_seq_cst (model));"}, {"sha": "05638e790dcf329378ab4ce1720055a0dbd39e88", "filename": "gcc/testsuite/ChangeLog", "status": "modified", "additions": 3, "deletions": 0, "changes": 3, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/d44ed508a66686e0c2fdf48f4cd4a9ad8a1b0547/gcc%2Ftestsuite%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/d44ed508a66686e0c2fdf48f4cd4a9ad8a1b0547/gcc%2Ftestsuite%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2FChangeLog?ref=d44ed508a66686e0c2fdf48f4cd4a9ad8a1b0547", "patch": "@@ -1,5 +1,8 @@\n 2017-11-21  Jakub Jelinek  <jakub@redhat.com>\n \n+\tPR c++/83059\n+\t* c-c++-common/pr83059.c: New test.\n+\n \tPR debug/82718\n \t* gcc.dg/debug/dwarf2/pr82718-1.c: New test.\n \t* gcc.dg/debug/dwarf2/pr82718-2.c: New test."}, {"sha": "44ff67c879d7d371f7d4590478ac4fbb8516e5dd", "filename": "gcc/testsuite/c-c++-common/pr83059.c", "status": "added", "additions": 10, "deletions": 0, "changes": 10, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/d44ed508a66686e0c2fdf48f4cd4a9ad8a1b0547/gcc%2Ftestsuite%2Fc-c%2B%2B-common%2Fpr83059.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/d44ed508a66686e0c2fdf48f4cd4a9ad8a1b0547/gcc%2Ftestsuite%2Fc-c%2B%2B-common%2Fpr83059.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fc-c%2B%2B-common%2Fpr83059.c?ref=d44ed508a66686e0c2fdf48f4cd4a9ad8a1b0547", "patch": "@@ -0,0 +1,10 @@\n+/* PR c++/83059 */\n+/* { dg-do compile } */\n+\n+void\n+foo (int *p, int *q, int *r)\n+{\n+  __atomic_compare_exchange (p, q, r, 0, 0, -1);\t/* { dg-warning \"invalid memory model argument 6\" } */\n+  /* { dg-warning \"unknown architecture specifi\" \"\" { target *-*-* } .-1 } */\n+  /* { dg-warning \"failure memory model cannot be stronger than success memory model\" \"\" { target *-*-* } .-2 } */\n+}"}]}