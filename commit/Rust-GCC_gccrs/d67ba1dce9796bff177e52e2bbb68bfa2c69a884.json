{"sha": "d67ba1dce9796bff177e52e2bbb68bfa2c69a884", "node_id": "C_kwDOANBUbNoAKGQ2N2JhMWRjZTk3OTZiZmYxNzdlNTJlMmJiYjY4YmZhMmM2OWE4ODQ", "commit": {"author": {"name": "Jonathan Wakely", "email": "jwakely@redhat.com", "date": "2022-01-12T16:58:18Z"}, "committer": {"name": "Jonathan Wakely", "email": "jwakely@redhat.com", "date": "2022-01-14T10:14:24Z"}, "message": "libstdc++: Use std::construct_at in std::common_iterator [PR103992]\n\nThis should have been done as part of the LWG 3574 changes.\n\nlibstdc++-v3/ChangeLog:\n\n\tPR libstdc++/103992\n\t* include/bits/stl_iterator.h (common_iterator): Use\n\tstd::construct_at instead of placement new.\n\t* testsuite/24_iterators/common_iterator/1.cc: Check copy\n\tconstruction is usable in constant expressions.", "tree": {"sha": "257d361f53e83031def01bf565ca139d957da1dc", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/257d361f53e83031def01bf565ca139d957da1dc"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/d67ba1dce9796bff177e52e2bbb68bfa2c69a884", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/d67ba1dce9796bff177e52e2bbb68bfa2c69a884", "html_url": "https://github.com/Rust-GCC/gccrs/commit/d67ba1dce9796bff177e52e2bbb68bfa2c69a884", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/d67ba1dce9796bff177e52e2bbb68bfa2c69a884/comments", "author": {"login": "jwakely", "id": 1254480, "node_id": "MDQ6VXNlcjEyNTQ0ODA=", "avatar_url": "https://avatars.githubusercontent.com/u/1254480?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jwakely", "html_url": "https://github.com/jwakely", "followers_url": "https://api.github.com/users/jwakely/followers", "following_url": "https://api.github.com/users/jwakely/following{/other_user}", "gists_url": "https://api.github.com/users/jwakely/gists{/gist_id}", "starred_url": "https://api.github.com/users/jwakely/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jwakely/subscriptions", "organizations_url": "https://api.github.com/users/jwakely/orgs", "repos_url": "https://api.github.com/users/jwakely/repos", "events_url": "https://api.github.com/users/jwakely/events{/privacy}", "received_events_url": "https://api.github.com/users/jwakely/received_events", "type": "User", "site_admin": false}, "committer": {"login": "jwakely", "id": 1254480, "node_id": "MDQ6VXNlcjEyNTQ0ODA=", "avatar_url": "https://avatars.githubusercontent.com/u/1254480?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jwakely", "html_url": "https://github.com/jwakely", "followers_url": "https://api.github.com/users/jwakely/followers", "following_url": "https://api.github.com/users/jwakely/following{/other_user}", "gists_url": "https://api.github.com/users/jwakely/gists{/gist_id}", "starred_url": "https://api.github.com/users/jwakely/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jwakely/subscriptions", "organizations_url": "https://api.github.com/users/jwakely/orgs", "repos_url": "https://api.github.com/users/jwakely/repos", "events_url": "https://api.github.com/users/jwakely/events{/privacy}", "received_events_url": "https://api.github.com/users/jwakely/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "7f390f11b445ee36cce5c5f1d5779baee817f0af", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/7f390f11b445ee36cce5c5f1d5779baee817f0af", "html_url": "https://github.com/Rust-GCC/gccrs/commit/7f390f11b445ee36cce5c5f1d5779baee817f0af"}], "stats": {"total": 24, "additions": 20, "deletions": 4}, "files": [{"sha": "24c106e0f70486c667dc3414c94d7acc5e80ef43", "filename": "libstdc++-v3/include/bits/stl_iterator.h", "status": "modified", "additions": 4, "deletions": 4, "changes": 8, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/d67ba1dce9796bff177e52e2bbb68bfa2c69a884/libstdc%2B%2B-v3%2Finclude%2Fbits%2Fstl_iterator.h", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/d67ba1dce9796bff177e52e2bbb68bfa2c69a884/libstdc%2B%2B-v3%2Finclude%2Fbits%2Fstl_iterator.h", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libstdc%2B%2B-v3%2Finclude%2Fbits%2Fstl_iterator.h?ref=d67ba1dce9796bff177e52e2bbb68bfa2c69a884", "patch": "@@ -1907,14 +1907,14 @@ _GLIBCXX_BEGIN_NAMESPACE_VERSION\n \t    if constexpr (is_trivially_default_constructible_v<_It>)\n \t      _M_it = std::move(__x._M_it);\n \t    else\n-\t      ::new((void*)std::__addressof(_M_it)) _It(__x._M_it);\n+\t      std::construct_at(std::__addressof(_M_it), __x._M_it);\n \t  }\n \telse if (_M_index == 1)\n \t  {\n \t    if constexpr (is_trivially_default_constructible_v<_Sent>)\n \t      _M_sent = std::move(__x._M_sent);\n \t    else\n-\t      ::new((void*)std::__addressof(_M_sent)) _Sent(__x._M_sent);\n+\t      std::construct_at(std::__addressof(_M_sent), __x._M_sent);\n \t  }\n       }\n \n@@ -1928,14 +1928,14 @@ _GLIBCXX_BEGIN_NAMESPACE_VERSION\n \t  if constexpr (is_trivially_default_constructible_v<_It>)\n \t    _M_it = std::move(__x._M_it);\n \t  else\n-\t    ::new((void*)std::__addressof(_M_it)) _It(__x._M_it);\n+\t    std::construct_at(std::__addressof(_M_it), __x._M_it);\n \t}\n       else if (_M_index == 1)\n \t{\n \t  if constexpr (is_trivially_default_constructible_v<_Sent>)\n \t    _M_sent = std::move(__x._M_sent);\n \t  else\n-\t    ::new((void*)std::__addressof(_M_sent)) _Sent(__x._M_sent);\n+\t    std::construct_at(std::__addressof(_M_sent), __x._M_sent);\n \t}\n     }\n "}, {"sha": "365ee89c02e81ed0107ca35373697474f3d48e3d", "filename": "libstdc++-v3/testsuite/24_iterators/common_iterator/1.cc", "status": "modified", "additions": 16, "deletions": 0, "changes": 16, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/d67ba1dce9796bff177e52e2bbb68bfa2c69a884/libstdc%2B%2B-v3%2Ftestsuite%2F24_iterators%2Fcommon_iterator%2F1.cc", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/d67ba1dce9796bff177e52e2bbb68bfa2c69a884/libstdc%2B%2B-v3%2Ftestsuite%2F24_iterators%2Fcommon_iterator%2F1.cc", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libstdc%2B%2B-v3%2Ftestsuite%2F24_iterators%2Fcommon_iterator%2F1.cc?ref=d67ba1dce9796bff177e52e2bbb68bfa2c69a884", "patch": "@@ -157,6 +157,22 @@ test04()\n   VERIFY( x.i == 2 );\n }\n \n+constexpr bool\n+test_pr103992()\n+{\n+  using C1 = std::common_iterator<std::reverse_iterator<int*>,\n+\t\t\t\t  std::unreachable_sentinel_t>;\n+  using C2 = std::common_iterator<std::reverse_iterator<const int*>,\n+\t\t\t\t  std::unreachable_sentinel_t>;\n+  C1 c1;\n+  C2 c2 = c1;\n+  C1 c3 = c1;\n+\n+  return true;\n+}\n+\n+static_assert( test_pr103992() );\n+\n int\n main()\n {"}]}