{"sha": "ee5c0d8af979891b6b215587979b96d7b12b5880", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6ZWU1YzBkOGFmOTc5ODkxYjZiMjE1NTg3OTc5Yjk2ZDdiMTJiNTg4MA==", "commit": {"author": {"name": "Segher Boessenkool", "email": "segher@kernel.crashing.org", "date": "2015-10-31T19:50:09Z"}, "committer": {"name": "Segher Boessenkool", "email": "segher@gcc.gnu.org", "date": "2015-10-31T19:50:09Z"}, "message": "rs6000: Rewrite rs6000_reg_live_or_pic_offset_p\n\nThis function is quite a puzzle; untangle it.  No functional change.\n\n\n2015-10-31  Segher Boessenkool  <segher@kernel.crashing.org>\n\n\t* config/rs6000/rs6000.c (rs6000_reg_live_or_pic_offset_p): Rewrite.\n\nFrom-SVN: r229634", "tree": {"sha": "ae09709c3fec07bae05c1fd40e6764d99048dbc9", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/ae09709c3fec07bae05c1fd40e6764d99048dbc9"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/ee5c0d8af979891b6b215587979b96d7b12b5880", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/ee5c0d8af979891b6b215587979b96d7b12b5880", "html_url": "https://github.com/Rust-GCC/gccrs/commit/ee5c0d8af979891b6b215587979b96d7b12b5880", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/ee5c0d8af979891b6b215587979b96d7b12b5880/comments", "author": {"login": "segher", "id": 417629, "node_id": "MDQ6VXNlcjQxNzYyOQ==", "avatar_url": "https://avatars.githubusercontent.com/u/417629?v=4", "gravatar_id": "", "url": "https://api.github.com/users/segher", "html_url": "https://github.com/segher", "followers_url": "https://api.github.com/users/segher/followers", "following_url": "https://api.github.com/users/segher/following{/other_user}", "gists_url": "https://api.github.com/users/segher/gists{/gist_id}", "starred_url": "https://api.github.com/users/segher/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/segher/subscriptions", "organizations_url": "https://api.github.com/users/segher/orgs", "repos_url": "https://api.github.com/users/segher/repos", "events_url": "https://api.github.com/users/segher/events{/privacy}", "received_events_url": "https://api.github.com/users/segher/received_events", "type": "User", "site_admin": false}, "committer": null, "parents": [{"sha": "f44c1eb7e1c5645fb4e6cfad7a3291ee7a31706a", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/f44c1eb7e1c5645fb4e6cfad7a3291ee7a31706a", "html_url": "https://github.com/Rust-GCC/gccrs/commit/f44c1eb7e1c5645fb4e6cfad7a3291ee7a31706a"}], "stats": {"total": 39, "additions": 24, "deletions": 15}, "files": [{"sha": "ff4a7ff7ee414875abc818420286ec36cd7c6c13", "filename": "gcc/ChangeLog", "status": "modified", "additions": 4, "deletions": 0, "changes": 4, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/ee5c0d8af979891b6b215587979b96d7b12b5880/gcc%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/ee5c0d8af979891b6b215587979b96d7b12b5880/gcc%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2FChangeLog?ref=ee5c0d8af979891b6b215587979b96d7b12b5880", "patch": "@@ -1,3 +1,7 @@\n+2015-10-31  Segher Boessenkool  <segher@kernel.crashing.org>\n+\n+\t* config/rs6000/rs6000.c (rs6000_reg_live_or_pic_offset_p): Rewrite.\n+\n 2015-10-31  Segher Boessenkool  <segher@kernel.crashing.org>\n \n \t* config/rs6000/rs6000.c (rs6000_reg_live_or_pic_offset_p): Use the"}, {"sha": "271c3f91b4a72a406f1b1adbbdd8bc4772bf75df", "filename": "gcc/config/rs6000/rs6000.c", "status": "modified", "additions": 20, "deletions": 15, "changes": 35, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/ee5c0d8af979891b6b215587979b96d7b12b5880/gcc%2Fconfig%2Frs6000%2Frs6000.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/ee5c0d8af979891b6b215587979b96d7b12b5880/gcc%2Fconfig%2Frs6000%2Frs6000.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fconfig%2Frs6000%2Frs6000.c?ref=ee5c0d8af979891b6b215587979b96d7b12b5880", "patch": "@@ -22021,22 +22021,27 @@ save_reg_p (int r)\n static bool\n rs6000_reg_live_or_pic_offset_p (int reg)\n {\n+  /* We need to mark the PIC offset register live for the same conditions\n+     as it is set up, or otherwise it won't be saved before we clobber it.  */\n+\n+  if (reg == RS6000_PIC_OFFSET_TABLE_REGNUM && !TARGET_SINGLE_PIC_BASE)\n+    {\n+      if (TARGET_TOC && TARGET_MINIMAL_TOC\n+\t  && (crtl->calls_eh_return\n+\t      || df_regs_ever_live_p (reg)\n+\t      || get_pool_size ()))\n+\treturn true;\n+\n+      if ((DEFAULT_ABI == ABI_V4 || DEFAULT_ABI == ABI_DARWIN)\n+\t  && flag_pic)\n+\treturn true;\n+    }\n+\n   /* If the function calls eh_return, claim used all the registers that would\n-     be checked for liveness otherwise.  This is required for the PIC offset\n-     register with -mminimal-toc on AIX, as it is advertised as \"fixed\" for\n-     register allocation purposes in this case.  */\n-\n-  return (((crtl->calls_eh_return || df_regs_ever_live_p (reg))\n-           && (!call_used_regs[reg]\n-               || (reg == RS6000_PIC_OFFSET_TABLE_REGNUM\n-\t\t   && !TARGET_SINGLE_PIC_BASE\n-                   && TARGET_TOC && TARGET_MINIMAL_TOC)))\n-          || (reg == RS6000_PIC_OFFSET_TABLE_REGNUM\n-\t      && !TARGET_SINGLE_PIC_BASE\n-              && ((DEFAULT_ABI == ABI_V4 && flag_pic != 0)\n-                  || (DEFAULT_ABI == ABI_DARWIN && flag_pic)\n-\t\t  || (TARGET_TOC && TARGET_MINIMAL_TOC\n-\t\t      && get_pool_size () != 0))));\n+     be checked for liveness otherwise.  */\n+\n+  return ((crtl->calls_eh_return || df_regs_ever_live_p (reg))\n+\t  && !call_used_regs[reg]);\n }\n \n /* Return the first fixed-point register that is required to be"}]}