{"sha": "ec543c9833c2d9283c035cd8430849eb4ec04406", "node_id": "C_kwDOANBUbNoAKGVjNTQzYzk4MzNjMmQ5MjgzYzAzNWNkODQzMDg0OWViNGVjMDQ0MDY", "commit": {"author": {"name": "Harald Anlauf", "email": "anlauf@gmx.de", "date": "2022-01-25T20:56:39Z"}, "committer": {"name": "Harald Anlauf", "email": "anlauf@gmx.de", "date": "2022-01-25T20:56:39Z"}, "message": "Fortran: MOLD argument to TRANSFER intrinsic having storage size zero\n\ngcc/fortran/ChangeLog:\n\n\tPR fortran/104227\n\t* check.cc (gfc_calculate_transfer_sizes): Fix checking of arrays\n\tpassed as MOLD argument to the TRANSFER intrinsic for having\n\tstorage size zero.\n\ngcc/testsuite/ChangeLog:\n\n\tPR fortran/104227\n\t* gfortran.dg/transfer_check_6.f90: New test.", "tree": {"sha": "29c2e6f32f9b3bca33ee7cedba7bdfe7d6058a24", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/29c2e6f32f9b3bca33ee7cedba7bdfe7d6058a24"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/ec543c9833c2d9283c035cd8430849eb4ec04406", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/ec543c9833c2d9283c035cd8430849eb4ec04406", "html_url": "https://github.com/Rust-GCC/gccrs/commit/ec543c9833c2d9283c035cd8430849eb4ec04406", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/ec543c9833c2d9283c035cd8430849eb4ec04406/comments", "author": {"login": "harald-anlauf", "id": 90786862, "node_id": "MDQ6VXNlcjkwNzg2ODYy", "avatar_url": "https://avatars.githubusercontent.com/u/90786862?v=4", "gravatar_id": "", "url": "https://api.github.com/users/harald-anlauf", "html_url": "https://github.com/harald-anlauf", "followers_url": "https://api.github.com/users/harald-anlauf/followers", "following_url": "https://api.github.com/users/harald-anlauf/following{/other_user}", "gists_url": "https://api.github.com/users/harald-anlauf/gists{/gist_id}", "starred_url": "https://api.github.com/users/harald-anlauf/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/harald-anlauf/subscriptions", "organizations_url": "https://api.github.com/users/harald-anlauf/orgs", "repos_url": "https://api.github.com/users/harald-anlauf/repos", "events_url": "https://api.github.com/users/harald-anlauf/events{/privacy}", "received_events_url": "https://api.github.com/users/harald-anlauf/received_events", "type": "User", "site_admin": false}, "committer": {"login": "harald-anlauf", "id": 90786862, "node_id": "MDQ6VXNlcjkwNzg2ODYy", "avatar_url": "https://avatars.githubusercontent.com/u/90786862?v=4", "gravatar_id": "", "url": "https://api.github.com/users/harald-anlauf", "html_url": "https://github.com/harald-anlauf", "followers_url": "https://api.github.com/users/harald-anlauf/followers", "following_url": "https://api.github.com/users/harald-anlauf/following{/other_user}", "gists_url": "https://api.github.com/users/harald-anlauf/gists{/gist_id}", "starred_url": "https://api.github.com/users/harald-anlauf/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/harald-anlauf/subscriptions", "organizations_url": "https://api.github.com/users/harald-anlauf/orgs", "repos_url": "https://api.github.com/users/harald-anlauf/repos", "events_url": "https://api.github.com/users/harald-anlauf/events{/privacy}", "received_events_url": "https://api.github.com/users/harald-anlauf/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "34e8dafb76240f69c729c11cfc8c8fc4f717bc17", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/34e8dafb76240f69c729c11cfc8c8fc4f717bc17", "html_url": "https://github.com/Rust-GCC/gccrs/commit/34e8dafb76240f69c729c11cfc8c8fc4f717bc17"}], "stats": {"total": 13, "additions": 12, "deletions": 1}, "files": [{"sha": "d6c6767ae9e3c0a798782cc51639aac3280e6d49", "filename": "gcc/fortran/check.cc", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/ec543c9833c2d9283c035cd8430849eb4ec04406/gcc%2Ffortran%2Fcheck.cc", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/ec543c9833c2d9283c035cd8430849eb4ec04406/gcc%2Ffortran%2Fcheck.cc", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ffortran%2Fcheck.cc?ref=ec543c9833c2d9283c035cd8430849eb4ec04406", "patch": "@@ -6151,7 +6151,7 @@ gfc_calculate_transfer_sizes (gfc_expr *source, gfc_expr *mold, gfc_expr *size,\n    * If SIZE is present, the result is an array of rank one and size SIZE.\n    */\n   if (result_elt_size == 0 && *source_size > 0 && !size\n-      && mold->expr_type == EXPR_ARRAY)\n+      && (mold->expr_type == EXPR_ARRAY || mold->rank))\n     {\n       gfc_error (\"%<MOLD%> argument of %<TRANSFER%> intrinsic at %L is an \"\n \t\t \"array and shall not have storage size 0 when %<SOURCE%> \""}, {"sha": "dffd0913f0dce86d2ad296b7a613e458f1c1b06b", "filename": "gcc/testsuite/gfortran.dg/transfer_check_6.f90", "status": "added", "additions": 11, "deletions": 0, "changes": 11, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/ec543c9833c2d9283c035cd8430849eb4ec04406/gcc%2Ftestsuite%2Fgfortran.dg%2Ftransfer_check_6.f90", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/ec543c9833c2d9283c035cd8430849eb4ec04406/gcc%2Ftestsuite%2Fgfortran.dg%2Ftransfer_check_6.f90", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgfortran.dg%2Ftransfer_check_6.f90?ref=ec543c9833c2d9283c035cd8430849eb4ec04406", "patch": "@@ -0,0 +1,11 @@\n+! { dg-do compile }\n+! PR fortran/104227 - ICE virtual memory exhausted\n+! Contributed by G.Steinmetz\n+\n+program p\n+  type t\n+  end type\n+  type(t) :: x(2)\n+  print *, transfer(1, x) ! { dg-error \"shall not have storage size 0\" }\n+  x = transfer(1, x)      ! { dg-error \"shall not have storage size 0\" }\n+end"}]}