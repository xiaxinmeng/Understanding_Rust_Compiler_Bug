{"sha": "56b4aa48df965191558e58dede5631e10faab2d5", "node_id": "C_kwDOANBUbNoAKDU2YjRhYTQ4ZGY5NjUxOTE1NThlNThkZWRlNTYzMWUxMGZhYWIyZDU", "commit": {"author": {"name": "Arthur Cohen", "email": "arthur.cohen@embecosm.com", "date": "2022-05-12T10:10:31Z"}, "committer": {"name": "Arthur Cohen", "email": "arthur.cohen@embecosm.com", "date": "2022-05-12T10:10:31Z"}, "message": "mappings: Add module->children mappings", "tree": {"sha": "73c89d7a683d4fd995abb86296474d2b4a769bd9", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/73c89d7a683d4fd995abb86296474d2b4a769bd9"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/56b4aa48df965191558e58dede5631e10faab2d5", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/56b4aa48df965191558e58dede5631e10faab2d5", "html_url": "https://github.com/Rust-GCC/gccrs/commit/56b4aa48df965191558e58dede5631e10faab2d5", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/56b4aa48df965191558e58dede5631e10faab2d5/comments", "author": {"login": "CohenArthur", "id": 43524065, "node_id": "MDQ6VXNlcjQzNTI0MDY1", "avatar_url": "https://avatars.githubusercontent.com/u/43524065?v=4", "gravatar_id": "", "url": "https://api.github.com/users/CohenArthur", "html_url": "https://github.com/CohenArthur", "followers_url": "https://api.github.com/users/CohenArthur/followers", "following_url": "https://api.github.com/users/CohenArthur/following{/other_user}", "gists_url": "https://api.github.com/users/CohenArthur/gists{/gist_id}", "starred_url": "https://api.github.com/users/CohenArthur/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/CohenArthur/subscriptions", "organizations_url": "https://api.github.com/users/CohenArthur/orgs", "repos_url": "https://api.github.com/users/CohenArthur/repos", "events_url": "https://api.github.com/users/CohenArthur/events{/privacy}", "received_events_url": "https://api.github.com/users/CohenArthur/received_events", "type": "User", "site_admin": false}, "committer": {"login": "CohenArthur", "id": 43524065, "node_id": "MDQ6VXNlcjQzNTI0MDY1", "avatar_url": "https://avatars.githubusercontent.com/u/43524065?v=4", "gravatar_id": "", "url": "https://api.github.com/users/CohenArthur", "html_url": "https://github.com/CohenArthur", "followers_url": "https://api.github.com/users/CohenArthur/followers", "following_url": "https://api.github.com/users/CohenArthur/following{/other_user}", "gists_url": "https://api.github.com/users/CohenArthur/gists{/gist_id}", "starred_url": "https://api.github.com/users/CohenArthur/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/CohenArthur/subscriptions", "organizations_url": "https://api.github.com/users/CohenArthur/orgs", "repos_url": "https://api.github.com/users/CohenArthur/repos", "events_url": "https://api.github.com/users/CohenArthur/events{/privacy}", "received_events_url": "https://api.github.com/users/CohenArthur/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "effc63b892b42c5645638b7b1f1002dac14d3794", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/effc63b892b42c5645638b7b1f1002dac14d3794", "html_url": "https://github.com/Rust-GCC/gccrs/commit/effc63b892b42c5645638b7b1f1002dac14d3794"}], "stats": {"total": 29, "additions": 29, "deletions": 0}, "files": [{"sha": "a287589e1dcdad5e33c1ed0cba715acfbe895eab", "filename": "gcc/rust/util/rust-hir-map.cc", "status": "modified", "additions": 20, "deletions": 0, "changes": 20, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/56b4aa48df965191558e58dede5631e10faab2d5/gcc%2Frust%2Futil%2Frust-hir-map.cc", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/56b4aa48df965191558e58dede5631e10faab2d5/gcc%2Frust%2Futil%2Frust-hir-map.cc", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Frust%2Futil%2Frust-hir-map.cc?ref=56b4aa48df965191558e58dede5631e10faab2d5", "patch": "@@ -848,5 +848,25 @@ Mappings::lookup_visibility (DefId id, Privacy::ModuleVisibility *def)\n   return true;\n }\n \n+void\n+Mappings::insert_module_child (NodeId module, NodeId child)\n+{\n+  auto it = module_child_map.find (module);\n+  if (it == module_child_map.end ())\n+    module_child_map.insert ({module, {child}});\n+  else\n+    it->second.emplace_back (child);\n+}\n+\n+Optional<std::vector<NodeId> &>\n+Mappings::lookup_module_children (NodeId module)\n+{\n+  auto it = module_child_map.find (module);\n+  if (it == module_child_map.end ())\n+    return Optional<std::vector<NodeId> &>::none ();\n+\n+  return Optional<std::vector<NodeId> &>::some (it->second);\n+}\n+\n } // namespace Analysis\n } // namespace Rust"}, {"sha": "88cb6823fba39941cb22e5546882fda8c959e06d", "filename": "gcc/rust/util/rust-hir-map.h", "status": "modified", "additions": 9, "deletions": 0, "changes": 9, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/56b4aa48df965191558e58dede5631e10faab2d5/gcc%2Frust%2Futil%2Frust-hir-map.h", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/56b4aa48df965191558e58dede5631e10faab2d5/gcc%2Frust%2Futil%2Frust-hir-map.h", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Frust%2Futil%2Frust-hir-map.h?ref=56b4aa48df965191558e58dede5631e10faab2d5", "patch": "@@ -19,6 +19,7 @@\n #ifndef RUST_HIR_MAP_H\n #define RUST_HIR_MAP_H\n \n+#include \"rust-optional.h\"\n #include \"rust-system.h\"\n #include \"rust-location.h\"\n #include \"rust-mapping-common.h\"\n@@ -321,6 +322,9 @@ class Mappings\n   void insert_visibility (DefId id, Privacy::ModuleVisibility visibility);\n   bool lookup_visibility (DefId id, Privacy::ModuleVisibility *def);\n \n+  void insert_module_child (NodeId module, NodeId child);\n+  Optional<std::vector<NodeId> &> lookup_module_children (NodeId module);\n+\n private:\n   Mappings ();\n \n@@ -386,6 +390,11 @@ class Mappings\n \n   // Low level visibility map for each DefId\n   std::map<DefId, Privacy::ModuleVisibility> visibility_map;\n+\n+  // Module tree maps\n+\n+  // Maps each module's node id to a list of its children\n+  std::map<NodeId, std::vector<NodeId>> module_child_map;\n };\n \n } // namespace Analysis"}]}