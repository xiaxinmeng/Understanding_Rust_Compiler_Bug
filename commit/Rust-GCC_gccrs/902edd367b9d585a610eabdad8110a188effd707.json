{"sha": "902edd367b9d585a610eabdad8110a188effd707", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6OTAyZWRkMzY3YjlkNTg1YTYxMGVhYmRhZDgxMTBhMTg4ZWZmZDcwNw==", "commit": {"author": {"name": "Jan Hubicka", "email": "jh@suse.cz", "date": "2004-04-28T20:40:55Z"}, "committer": {"name": "Jan Hubicka", "email": "hubicka@gcc.gnu.org", "date": "2004-04-28T20:40:55Z"}, "message": "re PR c/15004 ([unit-at-a-time] no warning for unused paramater in static function)\n\n\n\t* gcc.dg/unused-6.c: New test.\n\n\tPR c/15004\n\t* function.c (do_warn_unused_parameter): Break out form ...\n\t(expand_function_end): ... here; warn only when not using cgraphunit.\n\t* function.h (do_warn_unused_parameter): Declare.\n\t* cgraphunit.c: Include function.h.\n\t(cgraph_finalize_function): Do unused parameter warning.\n\t* Makefile.in (cgraphunit.o): Depend on function.h\n\nFrom-SVN: r81260", "tree": {"sha": "d5b0b3986f7580e9e8e84df766ad4bfe9caaa82e", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/d5b0b3986f7580e9e8e84df766ad4bfe9caaa82e"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/902edd367b9d585a610eabdad8110a188effd707", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/902edd367b9d585a610eabdad8110a188effd707", "html_url": "https://github.com/Rust-GCC/gccrs/commit/902edd367b9d585a610eabdad8110a188effd707", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/902edd367b9d585a610eabdad8110a188effd707/comments", "author": null, "committer": null, "parents": [{"sha": "a89f5df3d9325c1d5d9ed7f92abd6c61f9df8631", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/a89f5df3d9325c1d5d9ed7f92abd6c61f9df8631", "html_url": "https://github.com/Rust-GCC/gccrs/commit/a89f5df3d9325c1d5d9ed7f92abd6c61f9df8631"}], "stats": {"total": 65, "additions": 53, "deletions": 12}, "files": [{"sha": "cc665a4d1d67c60471391d435a6afe55afc7e4c7", "filename": "gcc/ChangeLog", "status": "modified", "additions": 10, "deletions": 0, "changes": 10, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/902edd367b9d585a610eabdad8110a188effd707/gcc%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/902edd367b9d585a610eabdad8110a188effd707/gcc%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2FChangeLog?ref=902edd367b9d585a610eabdad8110a188effd707", "patch": "@@ -1,3 +1,13 @@\n+2004-04-28  Jan Hubicka  <jh@suse.cz>\n+\n+\tPR c/15004\n+\t* function.c (do_warn_unused_parameter): Break out form ...\n+\t(expand_function_end): ... here; warn only when not using cgraphunit.\n+\t* function.h (do_warn_unused_parameter): Declare.\n+\t* cgraphunit.c: Include function.h.\n+\t(cgraph_finalize_function): Do unused parameter warning.\n+\t* Makefile.in (cgraphunit.o): Depend on function.h\n+\n 2004-04-28  Joseph S. Myers  <jsm@polyomino.org.uk>\n \n \t* Makefile.in ($(DESTDIR)$(infodir)/%.info): Don't condition"}, {"sha": "b35159b0be671ca637e297fa9372a5e8702b74c4", "filename": "gcc/Makefile.in", "status": "modified", "additions": 2, "deletions": 1, "changes": 3, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/902edd367b9d585a610eabdad8110a188effd707/gcc%2FMakefile.in", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/902edd367b9d585a610eabdad8110a188effd707/gcc%2FMakefile.in", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2FMakefile.in?ref=902edd367b9d585a610eabdad8110a188effd707", "patch": "@@ -1660,7 +1660,8 @@ cgraph.o : cgraph.c $(CONFIG_H) $(SYSTEM_H) coretypes.h $(TM_H) $(TREE_H) \\\n    langhooks.h toplev.h flags.h $(GGC_H)  $(TARGET_H) cgraph.h gt-cgraph.h \\\n    output.h intl.h\n cgraphunit.o : cgraphunit.c $(CONFIG_H) $(SYSTEM_H) coretypes.h $(TM_H) $(TREE_H) \\\n-   langhooks.h tree-inline.h toplev.h flags.h $(GGC_H)  $(TARGET_H) cgraph.h intl.h\n+   langhooks.h tree-inline.h toplev.h flags.h $(GGC_H)  $(TARGET_H) cgraph.h intl.h \\\n+   function.h\n coverage.o : coverage.c gcov-io.c $(CONFIG_H) $(SYSTEM_H) coretypes.h \\\n    $(TM_H) $(RTL_H) $(TREE_H) flags.h output.h $(REGS_H) $(EXPR_H) function.h \\\n    toplev.h $(GGC_H) $(TARGET_H) langhooks.h $(COVERAGE_H) libfuncs.h \\"}, {"sha": "4bdd41a5aa97f6e948a4a85d7aeab9feee15f420", "filename": "gcc/cgraphunit.c", "status": "modified", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/902edd367b9d585a610eabdad8110a188effd707/gcc%2Fcgraphunit.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/902edd367b9d585a610eabdad8110a188effd707/gcc%2Fcgraphunit.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fcgraphunit.c?ref=902edd367b9d585a610eabdad8110a188effd707", "patch": "@@ -183,6 +183,7 @@ Software Foundation, 59 Temple Place - Suite 330, Boston, MA\n #include \"fibheap.h\"\n #include \"c-common.h\"\n #include \"intl.h\"\n+#include \"function.h\"\n \n #define INSNS_PER_CALL 10\n \n@@ -377,6 +378,10 @@ cgraph_finalize_function (tree decl, bool nested)\n      early then.  */\n   if (DECL_EXTERNAL (decl))\n     DECL_STRUCT_FUNCTION (decl) = NULL;\n+\n+  /* Possibly warn about unused parameters.  */\n+  if (warn_unused_parameter)\n+    do_warn_unused_parameter (decl);\n }\n \n /* Walk tree and record all calls.  Called via walk_tree.  */"}, {"sha": "b1f888f141f9e28641454a9c99f92a9f199cfa01", "filename": "gcc/function.c", "status": "modified", "additions": 19, "deletions": 11, "changes": 30, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/902edd367b9d585a610eabdad8110a188effd707/gcc%2Ffunction.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/902edd367b9d585a610eabdad8110a188effd707/gcc%2Ffunction.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ffunction.c?ref=902edd367b9d585a610eabdad8110a188effd707", "patch": "@@ -6919,6 +6919,19 @@ use_return_register (void)\n   diddle_return_value (do_use_return_reg, NULL);\n }\n \n+/* Possibly warn about unused parameters.  */\n+void\n+do_warn_unused_parameter (tree fn)\n+{\n+  tree decl;\n+\n+  for (decl = DECL_ARGUMENTS (fn);\n+       decl; decl = TREE_CHAIN (decl))\n+    if (!TREE_USED (decl) && TREE_CODE (decl) == PARM_DECL\n+\t&& DECL_NAME (decl) && !DECL_ARTIFICIAL (decl))\n+      warning (\"%Junused parameter '%D'\", decl, decl);\n+}\n+\n static GTY(()) rtx initial_trampoline;\n \n /* Generate RTL for the end of the current function.  */\n@@ -7007,17 +7020,12 @@ expand_function_end (void)\n \t  }\n     }\n \n-  /* Possibly warn about unused parameters.  */\n-  if (warn_unused_parameter)\n-    {\n-      tree decl;\n-\n-      for (decl = DECL_ARGUMENTS (current_function_decl);\n-\t   decl; decl = TREE_CHAIN (decl))\n-\tif (! TREE_USED (decl) && TREE_CODE (decl) == PARM_DECL\n-\t    && DECL_NAME (decl) && ! DECL_ARTIFICIAL (decl))\n-          warning (\"%Junused parameter '%D'\", decl, decl);\n-    }\n+  /* Possibly warn about unused parameters.\n+     When frontend does unit-at-a-time, the warning is already\n+     issued at finalization time.  */\n+  if (warn_unused_parameter\n+      && !lang_hooks.callgraph.expand_function)\n+    do_warn_unused_parameter (current_function_decl);\n \n   /* Delete handlers for nonlocal gotos if nothing uses them.  */\n   if (nonlocal_goto_handler_slots != 0"}, {"sha": "7e34633d848badb49280a9f96cd3c356329ebb6c", "filename": "gcc/function.h", "status": "modified", "additions": 2, "deletions": 0, "changes": 2, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/902edd367b9d585a610eabdad8110a188effd707/gcc%2Ffunction.h", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/902edd367b9d585a610eabdad8110a188effd707/gcc%2Ffunction.h", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ffunction.h?ref=902edd367b9d585a610eabdad8110a188effd707", "patch": "@@ -648,4 +648,6 @@ extern const char *current_function_name (void);\n /* Called once, at initialization, to initialize function.c.  */\n extern void init_function_once (void);\n \n+extern void do_warn_unused_parameter (tree);\n+\n #endif  /* GCC_FUNCTION_H */"}, {"sha": "1de727de43ebb356128cee72f3628e37dcf88a98", "filename": "gcc/testsuite/ChangeLog", "status": "modified", "additions": 4, "deletions": 0, "changes": 4, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/902edd367b9d585a610eabdad8110a188effd707/gcc%2Ftestsuite%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/902edd367b9d585a610eabdad8110a188effd707/gcc%2Ftestsuite%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2FChangeLog?ref=902edd367b9d585a610eabdad8110a188effd707", "patch": "@@ -1,3 +1,7 @@\n+2004-04-28  Jan Hubicka  <jh@suse.cz>\n+\n+\t* gcc.dg/unused-6.c: New test.\n+\n 2004-04-24  Laurent GUERBY  <laurent@guerby.net>\n             Ulrich Weigand  <uweigand@de.ibm.com>\n "}, {"sha": "7651ecb28c9a7e67e76ab95cd121422960ebceb6", "filename": "gcc/testsuite/gcc.dg/unused-6.c", "status": "added", "additions": 11, "deletions": 0, "changes": 11, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/902edd367b9d585a610eabdad8110a188effd707/gcc%2Ftestsuite%2Fgcc.dg%2Funused-6.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/902edd367b9d585a610eabdad8110a188effd707/gcc%2Ftestsuite%2Fgcc.dg%2Funused-6.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgcc.dg%2Funused-6.c?ref=902edd367b9d585a610eabdad8110a188effd707", "patch": "@@ -0,0 +1,11 @@\n+\n+/* { dg-do compile } */\n+/* { dg-options \"-O3 -Wunused-parameter\" } */\n+static int t(int i) /* { dg-warning \"unused parameter\" \"unused parameter warning\" } */\n+{\n+  return 0;\n+}\n+int tt()\n+{\n+  return t(0);\n+}"}]}