{"sha": "b61ebe4ff8d7cba1182e23591ef53a421fea8509", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6YjYxZWJlNGZmOGQ3Y2JhMTE4MmUyMzU5MWVmNTNhNDIxZmVhODUwOQ==", "commit": {"author": {"name": "Arnaud Charlet", "email": "charlet@gcc.gnu.org", "date": "2009-04-16T12:29:14Z"}, "committer": {"name": "Arnaud Charlet", "email": "charlet@gcc.gnu.org", "date": "2009-04-16T12:29:14Z"}, "message": "[multiple changes]\n\n2009-04-16  Ed Schonberg  <schonberg@adacore.com>\n\n\t* sprint.adb (Write_Itype): If the itype is an array subtype, preserve\n\tthe original location of the index expressions and the index subtypes,\n\tto prevent spurious out-of-scope references in gigi.\n\n2009-04-16  Tristan Gingold  <gingold@adacore.com>\n\n\t* init.c, s-osinte-darwin.ads, system-darwin-x86_64.ads:\n\tAdd support for stack checking on darwin.\n\n2009-04-16  Vincent Celier  <celier@adacore.com>\n\n\t* prj-attr.adb: New attribute Runtime_Source_Dir\n\n\t* prj-nmsc.adb (Process_Project_Level_Array_Attributes): Process\n\tattribute Runtime_Source_Dir.\n\t(Check_Naming_Schemes): Give default values to out parameters to avoid\n\tinvalid data.\n\n\t* prj.ads (Language_Config): New component Runtime_Source_Dir\n\n\t* snames.ads-tmpl: New standard name Runtime_Source_Dir\n\nFrom-SVN: r146177", "tree": {"sha": "36eca1fbafa5d71c98adccf5a4a896b086d8474d", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/36eca1fbafa5d71c98adccf5a4a896b086d8474d"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/b61ebe4ff8d7cba1182e23591ef53a421fea8509", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/b61ebe4ff8d7cba1182e23591ef53a421fea8509", "html_url": "https://github.com/Rust-GCC/gccrs/commit/b61ebe4ff8d7cba1182e23591ef53a421fea8509", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/b61ebe4ff8d7cba1182e23591ef53a421fea8509/comments", "author": null, "committer": null, "parents": [{"sha": "468ee33782f620eee72571ee61df0e3e83eb80fb", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/468ee33782f620eee72571ee61df0e3e83eb80fb", "html_url": "https://github.com/Rust-GCC/gccrs/commit/468ee33782f620eee72571ee61df0e3e83eb80fb"}], "stats": {"total": 104, "additions": 87, "deletions": 17}, "files": [{"sha": "154974ac1a3e1506149a9e5c9b850f9ce9b2ae19", "filename": "gcc/ada/ChangeLog", "status": "modified", "additions": 24, "deletions": 0, "changes": 24, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/b61ebe4ff8d7cba1182e23591ef53a421fea8509/gcc%2Fada%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/b61ebe4ff8d7cba1182e23591ef53a421fea8509/gcc%2Fada%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fada%2FChangeLog?ref=b61ebe4ff8d7cba1182e23591ef53a421fea8509", "patch": "@@ -1,3 +1,27 @@\n+2009-04-16  Ed Schonberg  <schonberg@adacore.com>\n+\n+\t* sprint.adb (Write_Itype): If the itype is an array subtype, preserve\n+\tthe original location of the index expressions and the index subtypes,\n+\tto prevent spurious out-of-scope references in gigi.\n+\n+2009-04-16  Tristan Gingold  <gingold@adacore.com>\n+\n+\t* init.c, s-osinte-darwin.ads, system-darwin-x86_64.ads:\n+\tAdd support for stack checking on darwin.\n+\n+2009-04-16  Vincent Celier  <celier@adacore.com>\n+\n+\t* prj-attr.adb: New attribute Runtime_Source_Dir\n+\n+\t* prj-nmsc.adb (Process_Project_Level_Array_Attributes): Process\n+\tattribute Runtime_Source_Dir.\n+\t(Check_Naming_Schemes): Give default values to out parameters to avoid\n+\tinvalid data.\n+\n+\t* prj.ads (Language_Config): New component Runtime_Source_Dir\n+\n+\t* snames.ads-tmpl: New standard name Runtime_Source_Dir\n+\n 2009-04-16  Pascal Obry  <obry@adacore.com>\n \n \t* adaint.h, adaint.c (__gnat_rmdir): New routine."}, {"sha": "af9ae61d397c3a67e4846101e8d6203b621a78bb", "filename": "gcc/ada/init.c", "status": "modified", "additions": 24, "deletions": 3, "changes": 27, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/b61ebe4ff8d7cba1182e23591ef53a421fea8509/gcc%2Fada%2Finit.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/b61ebe4ff8d7cba1182e23591ef53a421fea8509/gcc%2Fada%2Finit.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fada%2Finit.c?ref=b61ebe4ff8d7cba1182e23591ef53a421fea8509", "patch": "@@ -2099,8 +2099,15 @@ __gnat_install_handler(void)\n \n #include <signal.h>\n \n+/* This must be in keeping with System.OS_Interface.Alternate_Stack_Size.  */\n+char __gnat_alternate_stack[64 * 1024]; /* 2 * MINSIGSTKSZ */\n+\n static void __gnat_error_handler (int sig, siginfo_t * si, void * uc);\n \n+/* Defined in xnu unix_signal.c  */\n+#define\tUC_RESET_ALT_STACK\t0x80000000\n+extern int sigreturn (void *uc, int flavour);\n+\n static void\n __gnat_error_handler (int sig, siginfo_t * si, void * uc)\n {\n@@ -2113,6 +2120,9 @@ __gnat_error_handler (int sig, siginfo_t * si, void * uc)\n       /* FIXME: we need to detect the case of a *real* SIGSEGV.  */\n       exception = &storage_error;\n       msg = \"stack overflow or erroneous memory access\";\n+      /* Reset the use of alt stack, so that the alt stack will be used\n+\t for the next signal delivery.  */\n+      sigreturn (NULL, UC_RESET_ALT_STACK);\n       break;\n \n     case SIGBUS:\n@@ -2140,7 +2150,16 @@ __gnat_install_handler (void)\n \n   /* Set up signal handler to map synchronous signals to appropriate\n      exceptions.  Make sure that the handler isn't interrupted by another\n-     signal that might cause a scheduling event!  */\n+     signal that might cause a scheduling event!  Also setup an alternate\n+     stack region for the handler execution so that stack overflows can be\n+     handled properly, avoiding a SEGV generation from stack usage by the\n+     handler itself (and it is required by Darwin).  */\n+\n+  stack_t stack;\n+  stack.ss_sp = __gnat_alternate_stack;\n+  stack.ss_size = sizeof (__gnat_alternate_stack);\n+  stack.ss_flags = 0;\n+  sigaltstack (&stack, NULL);\n \n   act.sa_flags = SA_NODEFER | SA_RESTART | SA_SIGINFO;\n   act.sa_sigaction = __gnat_error_handler;\n@@ -2153,11 +2172,13 @@ __gnat_install_handler (void)\n     sigaction (SIGFPE,  &act, NULL);\n   if (__gnat_get_interrupt_state (SIGILL) != 's')\n     sigaction (SIGILL,  &act, NULL);\n-  if (__gnat_get_interrupt_state (SIGSEGV) != 's')\n-    sigaction (SIGSEGV, &act, NULL);\n   if (__gnat_get_interrupt_state (SIGBUS) != 's')\n     sigaction (SIGBUS,  &act, NULL);\n \n+  act.sa_flags |= SA_ONSTACK;\n+  if (__gnat_get_interrupt_state (SIGSEGV) != 's')\n+    sigaction (SIGSEGV, &act, NULL);\n+\n   __gnat_handler_installed = 1;\n }\n "}, {"sha": "6818737673ecd489a4a64d62e326df18e4075b45", "filename": "gcc/ada/prj-attr.adb", "status": "modified", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/b61ebe4ff8d7cba1182e23591ef53a421fea8509/gcc%2Fada%2Fprj-attr.adb", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/b61ebe4ff8d7cba1182e23591ef53a421fea8509/gcc%2Fada%2Fprj-attr.adb", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fada%2Fprj-attr.adb?ref=b61ebe4ff8d7cba1182e23591ef53a421fea8509", "patch": "@@ -140,6 +140,7 @@ package body Prj.Attr is\n    \"LVshared_library_minimum_switches#\" &\n    \"LVlibrary_version_switches#\" &\n    \"Saruntime_library_dir#\" &\n+   \"Saruntime_source_dir#\" &\n \n    --  package Naming\n "}, {"sha": "4b377eee788cf68a36f4be5cbe35cafca6eaf1c8", "filename": "gcc/ada/prj-nmsc.adb", "status": "modified", "additions": 18, "deletions": 3, "changes": 21, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/b61ebe4ff8d7cba1182e23591ef53a421fea8509/gcc%2Fada%2Fprj-nmsc.adb", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/b61ebe4ff8d7cba1182e23591ef53a421fea8509/gcc%2Fada%2Fprj-nmsc.adb", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fada%2Fprj-nmsc.adb?ref=b61ebe4ff8d7cba1182e23591ef53a421fea8509", "patch": "@@ -2290,6 +2290,14 @@ package body Prj.Nmsc is\n                           (Lang_Index).Config.Runtime_Library_Dir :=\n                           Element.Value.Value;\n \n+                     when Name_Runtime_Source_Dir =>\n+\n+                        --  Attribute Runtime_Library_Dir (<language>)\n+\n+                        In_Tree.Languages_Data.Table\n+                          (Lang_Index).Config.Runtime_Source_Dir :=\n+                          Element.Value.Value;\n+\n                      when Name_Object_Generated =>\n                         declare\n                            pragma Unsuppress (All_Checks);\n@@ -7724,16 +7732,23 @@ package body Prj.Nmsc is\n       Config         : Language_Config;\n       Lang           : Name_List_Index := Data.Languages;\n       Header_File    : Boolean := False;\n-      First_Language : Language_Index;\n+      First_Language : Language_Index := No_Language_Index;\n       OK             : Boolean;\n \n       Last_Spec : Natural;\n       Last_Body : Natural;\n       Last_Sep  : Natural;\n \n    begin\n-      Unit := No_Name;\n-      Alternate_Languages := No_Alternate_Language;\n+      --  Default values\n+\n+      Alternate_Languages   := No_Alternate_Language;\n+      Language              := No_Language_Index;\n+      Language_Name         := No_Name;\n+      Display_Language_Name := No_Name;\n+      Unit                  := No_Name;\n+      Lang_Kind             := File_Based;\n+      Kind                  := Spec;\n \n       while Lang /= No_Name_List loop\n          Language_Name := In_Tree.Name_Lists.Table (Lang).Name;"}, {"sha": "ca09a9d8c445c5b0e2a267e7acfb5607aceb991d", "filename": "gcc/ada/prj.ads", "status": "modified", "additions": 4, "deletions": 0, "changes": 4, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/b61ebe4ff8d7cba1182e23591ef53a421fea8509/gcc%2Fada%2Fprj.ads", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/b61ebe4ff8d7cba1182e23591ef53a421fea8509/gcc%2Fada%2Fprj.ads", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fada%2Fprj.ads?ref=b61ebe4ff8d7cba1182e23591ef53a421fea8509", "patch": "@@ -456,6 +456,9 @@ package Prj is\n       Runtime_Library_Dir        : Name_Id := No_Name;\n       --  Path name of the runtime library directory, if any\n \n+      Runtime_Source_Dir        : Name_Id := No_Name;\n+      --  Path name of the runtime source directory, if any\n+\n       Mapping_File_Switches  : Name_List_Index := No_Name_List;\n       --  The option(s) to provide a mapping file to the compiler. Specified in\n       --  the configuration. When value is No_Name_List, there is no mapping\n@@ -558,6 +561,7 @@ package Prj is\n                            Object_Generated             => True,\n                            Objects_Linked               => True,\n                            Runtime_Library_Dir          => No_Name,\n+                           Runtime_Source_Dir           => No_Name,\n                            Mapping_File_Switches        => No_Name_List,\n                            Mapping_Spec_Suffix          => No_File,\n                            Mapping_Body_Suffix          => No_File,"}, {"sha": "c880c0087c37d2679aca186c4b46a5c07197ba55", "filename": "gcc/ada/s-osinte-darwin.ads", "status": "modified", "additions": 4, "deletions": 3, "changes": 7, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/b61ebe4ff8d7cba1182e23591ef53a421fea8509/gcc%2Fada%2Fs-osinte-darwin.ads", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/b61ebe4ff8d7cba1182e23591ef53a421fea8509/gcc%2Fada%2Fs-osinte-darwin.ads", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fada%2Fs-osinte-darwin.ads?ref=b61ebe4ff8d7cba1182e23591ef53a421fea8509", "patch": "@@ -279,10 +279,11 @@ package System.OS_Interface is\n    pragma Import (C, sigaltstack, \"sigaltstack\");\n \n    Alternate_Stack : aliased System.Address;\n-   --  This is a dummy definition, never used (Alternate_Stack_Size is null)\n+   pragma Import (C, Alternate_Stack, \"__gnat_alternate_stack\");\n+   --  The alternate signal stack for stack overflows\n \n-   Alternate_Stack_Size : constant := 0;\n-   --  No alternate signal stack is used on this platform\n+   Alternate_Stack_Size : constant := 64 * 1024;\n+   --  This must be in keeping with init.c:__gnat_alternate_stack\n \n    Stack_Base_Available : constant Boolean := False;\n    --  Indicates whether the stack base is available on this target. This"}, {"sha": "285f92e105fdcdd3e4e7e4715a6a5be8edab7b72", "filename": "gcc/ada/snames.ads-tmpl", "status": "modified", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/b61ebe4ff8d7cba1182e23591ef53a421fea8509/gcc%2Fada%2Fsnames.ads-tmpl", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/b61ebe4ff8d7cba1182e23591ef53a421fea8509/gcc%2Fada%2Fsnames.ads-tmpl", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fada%2Fsnames.ads-tmpl?ref=b61ebe4ff8d7cba1182e23591ef53a421fea8509", "patch": "@@ -1134,6 +1134,7 @@ package Snames is\n    Name_Toolchain_Description            : constant Name_Id := N + $;\n    Name_Toolchain_Version                : constant Name_Id := N + $;\n    Name_Runtime_Library_Dir              : constant Name_Id := N + $;\n+   Name_Runtime_Source_Dir               : constant Name_Id := N + $;\n \n    --  Other miscellaneous names used in front end\n "}, {"sha": "4d6041dc20069db6ad60b0aa4fe381b30cc559b3", "filename": "gcc/ada/sprint.adb", "status": "modified", "additions": 10, "deletions": 7, "changes": 17, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/b61ebe4ff8d7cba1182e23591ef53a421fea8509/gcc%2Fada%2Fsprint.adb", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/b61ebe4ff8d7cba1182e23591ef53a421fea8509/gcc%2Fada%2Fsprint.adb", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fada%2Fsprint.adb?ref=b61ebe4ff8d7cba1182e23591ef53a421fea8509", "patch": "@@ -3719,7 +3719,7 @@ package body Sprint is\n \n                      Write_Id (Directly_Designated_Type (Typ));\n \n-                     --  Array types and string types\n+                  --  Array types and string types\n \n                   when E_Array_Type | E_String_Type =>\n                      Write_Header;\n@@ -3748,7 +3748,8 @@ package body Sprint is\n                      Sprint_Node (X);\n                      Set_Sloc (X, Old_Sloc);\n \n-                     --  Array subtypes and string subtypes\n+                     --  Array subtypes and string subtypes.\n+                     --  Preserve Sloc of index subtypes, as above.\n \n                   when E_Array_Subtype | E_String_Subtype =>\n                      Write_Header (False);\n@@ -3757,15 +3758,17 @@ package body Sprint is\n \n                      X := First_Index (Typ);\n                      loop\n+                        Old_Sloc := Sloc (X);\n                         Sprint_Node (X);\n+                        Set_Sloc (X, Old_Sloc);\n                         Next_Index (X);\n                         exit when No (X);\n                         Write_Str (\", \");\n                      end loop;\n \n                      Write_Char (')');\n \n-                     --  Signed integer types, and modular integer subtypes\n+                  --  Signed integer types, and modular integer subtypes\n \n                   when E_Signed_Integer_Type     |\n                        E_Signed_Integer_Subtype  |\n@@ -3821,14 +3824,14 @@ package body Sprint is\n                         end if;\n                      end;\n \n-                     --  Modular integer types\n+                  --  Modular integer types\n \n                   when E_Modular_Integer_Type =>\n                      Write_Header;\n                      Write_Str (\" mod \");\n                      Write_Uint_With_Col_Check (Modulus (Typ), Auto);\n \n-                     --  Floating point types and subtypes\n+                  --  Floating point types and subtypes\n \n                   when E_Floating_Point_Type    |\n                        E_Floating_Point_Subtype =>\n@@ -4104,8 +4107,8 @@ package body Sprint is\n             exit when Spec = Empty;\n \n             --  Add semicolon, unless we are printing original tree and the\n-            --  next specification is part of a list (but not the first\n-            --  element of that list)\n+            --  next specification is part of a list (but not the first element\n+            --  of that list).\n \n             if not Dump_Original_Only or else not Prev_Ids (Spec) then\n                Write_Str (\"; \");"}, {"sha": "4211f347c8efad65d81e3c907969220520511fff", "filename": "gcc/ada/system-darwin-x86_64.ads", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/b61ebe4ff8d7cba1182e23591ef53a421fea8509/gcc%2Fada%2Fsystem-darwin-x86_64.ads", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/b61ebe4ff8d7cba1182e23591ef53a421fea8509/gcc%2Fada%2Fsystem-darwin-x86_64.ads", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fada%2Fsystem-darwin-x86_64.ads?ref=b61ebe4ff8d7cba1182e23591ef53a421fea8509", "patch": "@@ -155,7 +155,7 @@ private\n    Preallocated_Stacks       : constant Boolean := False;\n    Signed_Zeros              : constant Boolean := True;\n    Stack_Check_Default       : constant Boolean := False;\n-   Stack_Check_Probes        : constant Boolean := False;\n+   Stack_Check_Probes        : constant Boolean := True;\n    Stack_Check_Limits        : constant Boolean := False;\n    Support_64_Bit_Divides    : constant Boolean := True;\n    Support_Aggregates        : constant Boolean := True;"}]}