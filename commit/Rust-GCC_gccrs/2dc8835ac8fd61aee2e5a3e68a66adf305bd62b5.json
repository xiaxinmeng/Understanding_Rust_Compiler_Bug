{"sha": "2dc8835ac8fd61aee2e5a3e68a66adf305bd62b5", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6MmRjODgzNWFjOGZkNjFhZWUyZTVhM2U2OGE2NmFkZjMwNWJkNjJiNQ==", "commit": {"author": {"name": "Paolo Carlini", "email": "pcarlini@unitus.it", "date": "2001-11-02T03:48:09Z"}, "committer": {"name": "Benjamin Kosnik", "email": "bkoz@gcc.gnu.org", "date": "2001-11-02T03:48:09Z"}, "message": "ios_manip_fmtflags.cc: Fix for non-interactive output.\n\n\n2001-11-01  Paolo Carlini  <pcarlini@unitus.it>\n\t    Benjamin Kosnik  <bkoz@redhat.com>\n\n\t* testsuite/27_io/ios_manip_fmtflags.cc: Fix for non-interactive\n\toutput.\n\t* include/bits/locale_facets.tcc (num_put::do_put(bool)): Fix.\n\nCo-Authored-By: Benjamin Kosnik <bkoz@redhat.com>\n\nFrom-SVN: r46709", "tree": {"sha": "7a4c2f7f2c91db37f7fbfdbae56101129be185e4", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/7a4c2f7f2c91db37f7fbfdbae56101129be185e4"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/2dc8835ac8fd61aee2e5a3e68a66adf305bd62b5", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/2dc8835ac8fd61aee2e5a3e68a66adf305bd62b5", "html_url": "https://github.com/Rust-GCC/gccrs/commit/2dc8835ac8fd61aee2e5a3e68a66adf305bd62b5", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/2dc8835ac8fd61aee2e5a3e68a66adf305bd62b5/comments", "author": null, "committer": null, "parents": [{"sha": "b8a2a84bbe495a4f255fb5f973a8703339c33059", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/b8a2a84bbe495a4f255fb5f973a8703339c33059", "html_url": "https://github.com/Rust-GCC/gccrs/commit/b8a2a84bbe495a4f255fb5f973a8703339c33059"}], "stats": {"total": 101, "additions": 66, "deletions": 35}, "files": [{"sha": "988bfbf201c9d3998568ac33e2263cf83f2e2a77", "filename": "libstdc++-v3/ChangeLog", "status": "modified", "additions": 7, "deletions": 0, "changes": 7, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/2dc8835ac8fd61aee2e5a3e68a66adf305bd62b5/libstdc%2B%2B-v3%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/2dc8835ac8fd61aee2e5a3e68a66adf305bd62b5/libstdc%2B%2B-v3%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libstdc%2B%2B-v3%2FChangeLog?ref=2dc8835ac8fd61aee2e5a3e68a66adf305bd62b5", "patch": "@@ -1,3 +1,10 @@\n+2001-11-01  Paolo Carlini  <pcarlini@unitus.it>\n+\t    Benjamin Kosnik  <bkoz@redhat.com>\n+\t\n+\t* testsuite/27_io/ios_manip_fmtflags.cc: Fix for non-interactive\n+\toutput.\n+\t* include/bits/locale_facets.tcc (num_put::do_put(bool)): Fix.\n+\t\n 2001-11-01  Egor Duda  <deo@logos-m.ru>\n \n \t* config/os/newlib/bits/ctype_noninline.h"}, {"sha": "0fe180b348699532a3de7ec84a01f3a89344c313", "filename": "libstdc++-v3/include/bits/locale_facets.tcc", "status": "modified", "additions": 19, "deletions": 3, "changes": 22, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/2dc8835ac8fd61aee2e5a3e68a66adf305bd62b5/libstdc%2B%2B-v3%2Finclude%2Fbits%2Flocale_facets.tcc", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/2dc8835ac8fd61aee2e5a3e68a66adf305bd62b5/libstdc%2B%2B-v3%2Finclude%2Fbits%2Flocale_facets.tcc", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libstdc%2B%2B-v3%2Finclude%2Fbits%2Flocale_facets.tcc?ref=2dc8835ac8fd61aee2e5a3e68a66adf305bd62b5", "patch": "@@ -662,9 +662,25 @@ namespace std\n               __first = __fmt->_M_falsename.data();\n               __last = __first + __fmt->_M_falsename.size();\n             }\n-          copy(__first, __last, __s);\n-        }\n-      return __s;\n+        streamsize __width = __io.width(0);\n+        if (__last - __first >= __width)\n+          return copy(__first, __last, __s);\n+        else\n+          {\n+            int __padding = __width - (__last - __first);\n+            ios_base::fmtflags __aflags = __flags & ios_base::adjustfield;\n+            if (__aflags != ios_base::left)\n+              {\n+                __pad(__s, __fill, __padding);\n+                return copy(__first, __last, __s);\n+              }\n+            else\n+              {\n+                copy(__first, __last, __s);\n+                return __pad(__s, __fill, __padding);\n+              }\n+          }\n+      }\n     }\n \n   template<typename _CharT, typename _OutIter, typename _ValueT>"}, {"sha": "a8391d2f54330a2653a24641e5f4abd07c176889", "filename": "libstdc++-v3/testsuite/27_io/ios_manip_fmtflags.cc", "status": "modified", "additions": 40, "deletions": 32, "changes": 72, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/2dc8835ac8fd61aee2e5a3e68a66adf305bd62b5/libstdc%2B%2B-v3%2Ftestsuite%2F27_io%2Fios_manip_fmtflags.cc", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/2dc8835ac8fd61aee2e5a3e68a66adf305bd62b5/libstdc%2B%2B-v3%2Ftestsuite%2F27_io%2Fios_manip_fmtflags.cc", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libstdc%2B%2B-v3%2Ftestsuite%2F27_io%2Fios_manip_fmtflags.cc?ref=2dc8835ac8fd61aee2e5a3e68a66adf305bd62b5", "patch": "@@ -1,6 +1,6 @@\n // 981027 ncm work with libstdc++v3\n \n-// Copyright (C) 1997-1999, 2000 Free Software Foundation, Inc.\n+// Copyright (C) 1997-2001 Free Software Foundation, Inc.\n //\n // This file is part of the GNU ISO C++ Library.  This library is free\n // software; you can redistribute it and/or modify it under the\n@@ -27,7 +27,6 @@\n // invalidate any other reasons why the executable file might be covered by\n // the GNU General Public License.\n \n-#include <iostream>\n #include <sstream>\n #include <locale>\n #include <iomanip>\n@@ -39,41 +38,52 @@ struct MyNP : std::numpunct<char>\n   std::string do_falsename() const;\n };\n \n-std::string MyNP::do_truename()  const { static std::string s(\"yea\"); return s; }\n-std::string MyNP::do_falsename() const { static std::string s(\"nay\"); return s; }\n+std::string MyNP::do_truename()  const \n+{ \n+  static std::string s(\"yea\"); \n+  return s; \n+}\n+\n+std::string MyNP::do_falsename() const \n+{ \n+  static std::string s(\"nay\"); \n+  return s; \n+}\n \n-int\n+void\n test01()\n {\n-  std::cout << true << \" \" << false << std::endl;\n-  std::cout << std::boolalpha;\n-  std::cout << true << \" \" << false << std::endl;\n-\n-  std::cout << \":\" << std::setw(6) << std::internal << true << \":\" << std::endl;\n-  std::cout << \":\" << std::setw(6) << std::left << true << \":\" << std::endl;\n-  std::cout << \":\" << std::setw(6) << std::right << false << \":\" << std::endl;\n-  std::cout << std::noboolalpha;\n-  std::cout << \":\" << std::setw(3) << std::internal << true << \":\" << std::endl;\n-  std::cout << \":\" << std::setw(3) << std::left << true << \":\" << std::endl;\n-  std::cout << \":\" << std::setw(3) << std::right << false << \":\" << std::endl;\n+  bool test = true;\n+  const char lit[] = \"1 0\\ntrue false\\n:  true:\\n:true  :\\n: false:\\n:  1:\"\n+    \t\t     \"\\n:1  :\\n:  0:\\nyea nay\\n:   yea:\\n:yea   :\\n:   nay:\\n\";\n+  std::ostringstream oss;\n+  oss << true << \" \" << false << std::endl;\n+  oss << std::boolalpha;\n+  oss << true << \" \" << false << std::endl;\n+\n+  oss << \":\" << std::setw(6) << std::internal << true << \":\" << std::endl;\n+  oss << \":\" << std::setw(6) << std::left << true << \":\" << std::endl;\n+  oss << \":\" << std::setw(6) << std::right << false << \":\" << std::endl;\n+  oss << std::noboolalpha;\n+  oss << \":\" << std::setw(3) << std::internal << true << \":\" << std::endl;\n+  oss << \":\" << std::setw(3) << std::left << true << \":\" << std::endl;\n+  oss << \":\" << std::setw(3) << std::right << false << \":\" << std::endl;\n \n   std::locale loc = std::locale (std::locale(), new MyNP);\n-  std::cout.imbue(loc);\n+  oss.imbue(loc);\n \n-  std::cout << std::boolalpha;\n-  std::cout << true << \" \" << false << std::endl;\n+  oss << std::boolalpha;\n+  oss << true << \" \" << false << std::endl;\n \n-  std::cout << \":\" << std::setw(6) << std::internal << true << \":\" << std::endl;\n-  std::cout << \":\" << std::setw(6) << std::left << true << \":\" << std::endl;\n-  std::cout << \":\" << std::setw(6) << std::right << false << \":\" << std::endl;\n+  oss << \":\" << std::setw(6) << std::internal << true << \":\" << std::endl;\n+  oss << \":\" << std::setw(6) << std::left << true << \":\" << std::endl;\n+  oss << \":\" << std::setw(6) << std::right << false << \":\" << std::endl;\n \n-#ifdef DEBUG_ASSERT\n-  assert (std::cout.good());\n-#endif\n-  return 0;\n+  VERIFY( oss.good() );\n+  VERIFY( oss.str() == lit );\n }\n \n-int\n+void\n test02()\n {\n   bool test = true;\n@@ -96,14 +106,12 @@ test02()\n   str02 = ostr01.str();\n   VERIFY( str02 == sfalse );\n \n-#ifdef DEBUG_ASSERT\n-  assert(test);\n-#endif\n-  return 0;\n+  VERIFY( test );\n }\n \n int \n-main() {\n+main() \n+{\n   test01();\n   test02();\n   return 0;"}]}