{"sha": "e76a3fde81380ce422994e1a0fb21322d2268341", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6ZTc2YTNmZGU4MTM4MGNlNDIyOTk0ZTFhMGZiMjEzMjJkMjI2ODM0MQ==", "commit": {"author": {"name": "Janne Blomqvist", "email": "jb@gcc.gnu.org", "date": "2010-04-01T16:22:57Z"}, "committer": {"name": "Janne Blomqvist", "email": "jb@gcc.gnu.org", "date": "2010-04-01T16:22:57Z"}, "message": "PR libfortran/43605 Fix FTELL for formatted files\n\nCo-Authored-By: Manfred Schwarb <manfred99@gmx.ch>\n\nFrom-SVN: r157914", "tree": {"sha": "e8d9448ab70a3f19bbb9217f201b291d412f9203", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/e8d9448ab70a3f19bbb9217f201b291d412f9203"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/e76a3fde81380ce422994e1a0fb21322d2268341", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/e76a3fde81380ce422994e1a0fb21322d2268341", "html_url": "https://github.com/Rust-GCC/gccrs/commit/e76a3fde81380ce422994e1a0fb21322d2268341", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/e76a3fde81380ce422994e1a0fb21322d2268341/comments", "author": null, "committer": null, "parents": [{"sha": "5e9fb3dbde748212ff0b025dcf196da9b086b1c4", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/5e9fb3dbde748212ff0b025dcf196da9b086b1c4", "html_url": "https://github.com/Rust-GCC/gccrs/commit/5e9fb3dbde748212ff0b025dcf196da9b086b1c4"}], "stats": {"total": 41, "additions": 36, "deletions": 5}, "files": [{"sha": "8c48a0b90400c39f495672173e08a4db105d92f3", "filename": "gcc/testsuite/ChangeLog", "status": "modified", "additions": 6, "deletions": 0, "changes": 6, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/e76a3fde81380ce422994e1a0fb21322d2268341/gcc%2Ftestsuite%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/e76a3fde81380ce422994e1a0fb21322d2268341/gcc%2Ftestsuite%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2FChangeLog?ref=e76a3fde81380ce422994e1a0fb21322d2268341", "patch": "@@ -1,3 +1,9 @@\n+2010-04-01  Janne Blomqvist  <jb@gcc.gnu.org>\n+\t    Manfred Schwarb  <manfred99@gmx.ch>\n+\n+\tPR libfortran/43605\n+\t* gfortran.dg/ftell_3.f90: New test.\n+\n 2010-04-01  Richard Guenther  <rguenther@suse.de>\n \n \tPR middle-end/43614"}, {"sha": "1981678d41c700753eda7d784f1794d56c2b70c2", "filename": "gcc/testsuite/gfortran.dg/ftell_3.f90", "status": "added", "additions": 19, "deletions": 0, "changes": 19, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/e76a3fde81380ce422994e1a0fb21322d2268341/gcc%2Ftestsuite%2Fgfortran.dg%2Fftell_3.f90", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/e76a3fde81380ce422994e1a0fb21322d2268341/gcc%2Ftestsuite%2Fgfortran.dg%2Fftell_3.f90", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgfortran.dg%2Fftell_3.f90?ref=e76a3fde81380ce422994e1a0fb21322d2268341", "patch": "@@ -0,0 +1,19 @@\n+! { dg-do run }\n+! PR43605 FTELL intrinsic returns incorrect position\n+! Contributed by Janne Blomqvist and Manfred Schwarb\n+program ftell_3\n+  integer :: i\n+  character(len=99) :: buffer\n+  open(10, form='formatted', status='scratch', position='rewind')\n+  write(10, '(a)') '123456'\n+  write(10, '(a)') '789'\n+  write(10, '(a)') 'CCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCC'\n+  write(10, '(a)') 'DDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDD'\n+  rewind(10)\n+  read(10, '(a)') buffer\n+  call ftell(10, i)\n+  if(i /= 7) then\n+     call abort()\n+  end if\n+  close(10)\n+end program ftell_3"}, {"sha": "495683c5b22820d40c4c28554b59eed7f8687e0d", "filename": "libgfortran/ChangeLog", "status": "modified", "additions": 6, "deletions": 0, "changes": 6, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/e76a3fde81380ce422994e1a0fb21322d2268341/libgfortran%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/e76a3fde81380ce422994e1a0fb21322d2268341/libgfortran%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libgfortran%2FChangeLog?ref=e76a3fde81380ce422994e1a0fb21322d2268341", "patch": "@@ -1,3 +1,9 @@\n+2010-04-01  Janne Blomqvist  <jb@gcc.gnu.org>\n+\n+\tPR libfortran/43605\n+\t* io/intrinsics.c (ftell): Reset fbuf, correct offset.\n+\t(FTELL_SUB): Likewise.\n+\n 2010-03-29  Jerry DeLisle  <jvdelisle@gcc.gnu.org>\n \n \tPR libfortran/43265"}, {"sha": "4beb0135c86eeace87f1b7ec0439d377c28e76ae", "filename": "libgfortran/io/intrinsics.c", "status": "modified", "additions": 5, "deletions": 5, "changes": 10, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/e76a3fde81380ce422994e1a0fb21322d2268341/libgfortran%2Fio%2Fintrinsics.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/e76a3fde81380ce422994e1a0fb21322d2268341/libgfortran%2Fio%2Fintrinsics.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libgfortran%2Fio%2Fintrinsics.c?ref=e76a3fde81380ce422994e1a0fb21322d2268341", "patch": "@@ -1,8 +1,8 @@\n /* Implementation of the FGET, FGETC, FPUT, FPUTC, FLUSH \n    FTELL, TTYNAM and ISATTY intrinsics.\n-   Copyright (C) 2005, 2007, 2009 Free Software Foundation, Inc.\n+   Copyright (C) 2005, 2007, 2009, 2010 Free Software Foundation, Inc.\n \n-This file is part of the GNU Fortran 95 runtime library (libgfortran).\n+This file is part of the GNU Fortran runtime library (libgfortran).\n \n Libgfortran is free software; you can redistribute it and/or\n modify it under the terms of the GNU General Public\n@@ -267,10 +267,10 @@ size_t\n PREFIX(ftell) (int * unit)\n {\n   gfc_unit * u = find_unit (*unit);\n-  size_t ret;\n+  gfc_offset ret;\n   if (u == NULL)\n     return ((size_t) -1);\n-  ret = (size_t) stell (u->s);\n+  ret = stell (u->s) + fbuf_reset (u);\n   unlock_unit (u);\n   return ret;\n }\n@@ -286,7 +286,7 @@ PREFIX(ftell) (int * unit)\n       *offset = -1; \\\n     else \\\n       { \\\n-\t*offset = stell (u->s); \\\n+\t*offset = stell (u->s) + fbuf_reset (u);\t\\\n \tunlock_unit (u); \\\n       } \\\n   }"}]}