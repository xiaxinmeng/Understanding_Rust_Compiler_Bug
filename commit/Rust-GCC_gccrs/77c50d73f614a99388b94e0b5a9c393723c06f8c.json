{"sha": "77c50d73f614a99388b94e0b5a9c393723c06f8c", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6NzdjNTBkNzNmNjE0YTk5Mzg4Yjk0ZTBiNWE5YzM5MzcyM2MwNmY4Yw==", "commit": {"author": {"name": "Sandra Loosemore", "email": "sandra@codesourcery.com", "date": "2015-07-14T22:22:45Z"}, "committer": {"name": "Sandra Loosemore", "email": "sandra@gcc.gnu.org", "date": "2015-07-14T22:22:45Z"}, "message": "nios2.opt (march, mbmx, mcdx): New options.\n\n2015-07-14  Sandra Loosemore  <sandra@codesourcery.com>\n\t    Cesar Philippidis  <cesar@codesourcery.com>\n\t    Chung-Lin Tang  <cltang@codesourcery.com>\n\n\tgcc/\n\t* config/nios2/nios2.opt (march, mbmx, mcdx): New options.\n\t* config/nios2/nios2-opts.h (enum nios2_arch_type): New enum for\n\tNios II architecture level.\n\t* config/nios2/nios2.h (TARGET_ARCH_R2): New define.\n\t(TARGET_CPU_CPP_BUILTINS): Add definition of __nios2_arch__ symbol.\n\t(OPTION_DEFAULT_SPECS): Define.\n\t(ASM_SPEC): Add -march= spec strings.\n\t* config/nios2/nios2.c (nios2_option_override): Check for\n\tconflicts involving new options.\n\t* config.gcc (nios2*-*-*): Support --with-arch=.\n\t* doc/invoke.texi (Option Summary, Nios II Options): Document\n\t-march=, -mbmx,\tand -mcdx.\n\n\nCo-Authored-By: Cesar Philippidis <cesar@codesourcery.com>\nCo-Authored-By: Chung-Lin Tang <cltang@codesourcery.com>\n\nFrom-SVN: r225791", "tree": {"sha": "7998bb20c4283cbb5406e4acc7cb94abd44e886f", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/7998bb20c4283cbb5406e4acc7cb94abd44e886f"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/77c50d73f614a99388b94e0b5a9c393723c06f8c", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/77c50d73f614a99388b94e0b5a9c393723c06f8c", "html_url": "https://github.com/Rust-GCC/gccrs/commit/77c50d73f614a99388b94e0b5a9c393723c06f8c", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/77c50d73f614a99388b94e0b5a9c393723c06f8c/comments", "author": {"login": "SandraLoosemore", "id": 104087111, "node_id": "U_kgDOBjQ-Rw", "avatar_url": "https://avatars.githubusercontent.com/u/104087111?v=4", "gravatar_id": "", "url": "https://api.github.com/users/SandraLoosemore", "html_url": "https://github.com/SandraLoosemore", "followers_url": "https://api.github.com/users/SandraLoosemore/followers", "following_url": "https://api.github.com/users/SandraLoosemore/following{/other_user}", "gists_url": "https://api.github.com/users/SandraLoosemore/gists{/gist_id}", "starred_url": "https://api.github.com/users/SandraLoosemore/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/SandraLoosemore/subscriptions", "organizations_url": "https://api.github.com/users/SandraLoosemore/orgs", "repos_url": "https://api.github.com/users/SandraLoosemore/repos", "events_url": "https://api.github.com/users/SandraLoosemore/events{/privacy}", "received_events_url": "https://api.github.com/users/SandraLoosemore/received_events", "type": "User", "site_admin": false}, "committer": null, "parents": [{"sha": "ff7097f21e538fc38bf22e30acfbea74433fb2b4", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/ff7097f21e538fc38bf22e30acfbea74433fb2b4", "html_url": "https://github.com/Rust-GCC/gccrs/commit/ff7097f21e538fc38bf22e30acfbea74433fb2b4"}], "stats": {"total": 105, "additions": 101, "deletions": 4}, "files": [{"sha": "b6026ba64ec35b7b863048ae788916327d9d7e6b", "filename": "gcc/ChangeLog", "status": "modified", "additions": 17, "deletions": 0, "changes": 17, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/77c50d73f614a99388b94e0b5a9c393723c06f8c/gcc%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/77c50d73f614a99388b94e0b5a9c393723c06f8c/gcc%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2FChangeLog?ref=77c50d73f614a99388b94e0b5a9c393723c06f8c", "patch": "@@ -1,3 +1,20 @@\n+2015-07-14  Sandra Loosemore  <sandra@codesourcery.com>\n+\t    Cesar Philippidis  <cesar@codesourcery.com>\n+\t    Chung-Lin Tang  <cltang@codesourcery.com>\n+\n+\t* config/nios2/nios2.opt (march, mbmx, mcdx): New options.\n+\t* config/nios2/nios2-opts.h (enum nios2_arch_type): New enum for\n+\tNios II architecture level.\n+\t* config/nios2/nios2.h (TARGET_ARCH_R2): New define.\n+\t(TARGET_CPU_CPP_BUILTINS): Add definition of __nios2_arch__ symbol.\n+\t(OPTION_DEFAULT_SPECS): Define.\n+\t(ASM_SPEC): Add -march= spec strings.\n+\t* config/nios2/nios2.c (nios2_option_override): Check for\n+\tconflicts involving new options.\n+\t* config.gcc (nios2*-*-*): Support --with-arch=.\n+\t* doc/invoke.texi (Option Summary, Nios II Options): Document\n+\t-march=, -mbmx,\tand -mcdx.\n+\n 2015-07-14  Vladimir Makarov  <vmakarov@redhat.com>\n \n \tPR rtl-optimization/66626"}, {"sha": "d6b928d40fd0acf271483d81cdf61d113f04ef95", "filename": "gcc/config.gcc", "status": "modified", "additions": 13, "deletions": 0, "changes": 13, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/77c50d73f614a99388b94e0b5a9c393723c06f8c/gcc%2Fconfig.gcc", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/77c50d73f614a99388b94e0b5a9c393723c06f8c/gcc%2Fconfig.gcc", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fconfig.gcc?ref=77c50d73f614a99388b94e0b5a9c393723c06f8c", "patch": "@@ -4052,6 +4052,19 @@ case \"${target}\" in\n \t\tesac\n \t\t;;\n \n+\tnios2*-*-*)\n+\t\tsupported_defaults=\"arch\"\n+\t\t\tcase \"$with_arch\" in\n+\t\t\t\"\" | r1 | r2)\n+\t\t\t\t# OK\n+\t\t\t\t;;\n+\t\t\t*)\n+\t\t\t\techo \"Unknown arch used in --with-arch=$with_arch\" 1>&2\n+\t\t\t\texit 1\n+\t\t\t\t;;\n+\t\t\tesac\n+\t\t;;\n+\n \tpowerpc*-*-* | rs6000-*-*)\n \t\tsupported_defaults=\"abi cpu cpu_32 cpu_64 float tune tune_32 tune_64 advance_toolchain\"\n "}, {"sha": "062642438aa564d96dfeb91cc1e215eeebba0004", "filename": "gcc/config/nios2/nios2-opts.h", "status": "modified", "additions": 7, "deletions": 0, "changes": 7, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/77c50d73f614a99388b94e0b5a9c393723c06f8c/gcc%2Fconfig%2Fnios2%2Fnios2-opts.h", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/77c50d73f614a99388b94e0b5a9c393723c06f8c/gcc%2Fconfig%2Fnios2%2Fnios2-opts.h", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fconfig%2Fnios2%2Fnios2-opts.h?ref=77c50d73f614a99388b94e0b5a9c393723c06f8c", "patch": "@@ -77,5 +77,12 @@ enum nios2_ccs_code\n   CCS_BUILTIN_CALL\n };\n \n+/* Supported Nios II Architectures.  */\n+enum nios2_arch_type\n+{\n+  ARCH_R1=1,\n+  ARCH_R2\n+};\n+\n #endif\n "}, {"sha": "7c97a02b521094a2f748e760b69045e27ed8a5af", "filename": "gcc/config/nios2/nios2.c", "status": "modified", "additions": 13, "deletions": 0, "changes": 13, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/77c50d73f614a99388b94e0b5a9c393723c06f8c/gcc%2Fconfig%2Fnios2%2Fnios2.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/77c50d73f614a99388b94e0b5a9c393723c06f8c/gcc%2Fconfig%2Fnios2%2Fnios2.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fconfig%2Fnios2%2Fnios2.c?ref=77c50d73f614a99388b94e0b5a9c393723c06f8c", "patch": "@@ -1078,6 +1078,19 @@ nios2_option_override (void)\n   if (!TARGET_HAS_MUL && TARGET_HAS_MULX)\n     target_flags &= ~MASK_HAS_MULX;\n \n+  /* Optional BMX and CDX instructions only make sense for R2.  */\n+  if (!TARGET_ARCH_R2)\n+    {\n+      if (TARGET_HAS_BMX)\n+\terror (\"BMX instructions are only supported with R2 architecture\");\n+      if (TARGET_HAS_CDX)\n+\terror (\"CDX instructions are only supported with R2 architecture\");\n+    }\n+\n+  /* R2 is little-endian only.  */\n+  if (TARGET_ARCH_R2 && TARGET_BIG_ENDIAN)\n+    error (\"R2 architecture is little-endian only\");\n+\n   /* Initialize default FPU configurations.  */\n   nios2_init_fpu_configs ();\n "}, {"sha": "c3c958a083d8e0fe91814a1cca028f38892808d8", "filename": "gcc/config/nios2/nios2.h", "status": "modified", "additions": 11, "deletions": 3, "changes": 14, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/77c50d73f614a99388b94e0b5a9c393723c06f8c/gcc%2Fconfig%2Fnios2%2Fnios2.h", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/77c50d73f614a99388b94e0b5a9c393723c06f8c/gcc%2Fconfig%2Fnios2%2Fnios2.h", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fconfig%2Fnios2%2Fnios2.h?ref=77c50d73f614a99388b94e0b5a9c393723c06f8c", "patch": "@@ -23,6 +23,9 @@\n #ifndef GCC_NIOS2_H\n #define GCC_NIOS2_H\n \n+/* Indicate R2 ISA level support.  */\n+#define TARGET_ARCH_R2 (nios2_arch_option == ARCH_R2)\n+\n /* FPU insn codes declared here.  */\n #include \"config/nios2/nios2-opts.h\"\n \n@@ -36,7 +39,9 @@\n         builtin_define_std (\"nios2_big_endian\");    \\\n       else                                          \\\n         builtin_define_std (\"nios2_little_endian\"); \\\n-    }                                               \\\n+      builtin_define_with_int_value (\t\t    \\\n+        \"__nios2_arch__\", (int) nios2_arch_option); \\\n+    }\t\t\t\t\t\t    \\\n   while (0)\n \n /* We're little endian, unless otherwise specified by defining\n@@ -50,14 +55,17 @@\n # define TARGET_DEFAULT (MASK_HAS_MUL | TARGET_ENDIAN_DEFAULT)\n #endif\n \n+#define OPTION_DEFAULT_SPECS \\\n+  {\"arch\", \"%{!march=*:%{!mcpu=*:-march=%(VALUE)}}\" }\n+\n #define CC1_SPEC \"%{G*}\"\n \n #if TARGET_ENDIAN_DEFAULT == 0\n-# define ASM_SPEC \"%{!meb:-EL} %{meb:-EB}\"\n+# define ASM_SPEC \"%{!meb:-EL} %{meb:-EB} %{march=*:-march=%*}\"\n # define LINK_SPEC_ENDIAN \"%{!meb:-EL} %{meb:-EB}\"\n # define MULTILIB_DEFAULTS { \"EL\" }\n #else\n-# define ASM_SPEC \"%{!mel:-EB} %{mel:-EL}\"\n+# define ASM_SPEC \"%{!mel:-EB} %{mel:-EL} %{march=*:-march=%*}\"\n # define LINK_SPEC_ENDIAN \"%{!mel:-EB} %{mel:-EL}\"\n # define MULTILIB_DEFAULTS { \"EB\" }\n #endif"}, {"sha": "1e151f7b7962f7e5ba7f0f915479db8ab38096d7", "filename": "gcc/config/nios2/nios2.opt", "status": "modified", "additions": 20, "deletions": 0, "changes": 20, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/77c50d73f614a99388b94e0b5a9c393723c06f8c/gcc%2Fconfig%2Fnios2%2Fnios2.opt", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/77c50d73f614a99388b94e0b5a9c393723c06f8c/gcc%2Fconfig%2Fnios2%2Fnios2.opt", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fconfig%2Fnios2%2Fnios2.opt?ref=77c50d73f614a99388b94e0b5a9c393723c06f8c", "patch": "@@ -565,4 +565,24 @@ mcustom-round=\n Target Report RejectNegative Joined UInteger Var(nios2_custom_round) Init(-1)\n Integer id (N) of round custom instruction\n \n+march=\n+Target RejectNegative Joined Enum(nios2_arch_type) Var(nios2_arch_option) Init(ARCH_R1)\n+Specify the name of the target architecture.\n \n+Enum\n+Name(nios2_arch_type) Type(enum nios2_arch_type)\n+Valid Nios II ISA levels (for -march):\n+\n+EnumValue\n+Enum(nios2_arch_type) String(r1) Value(ARCH_R1)\n+\n+EnumValue\n+Enum(nios2_arch_type) String(r2) Value(ARCH_R2)\n+\n+mbmx\n+Target Report Mask(HAS_BMX)\n+Enable generation of R2 BMX instructions\n+\n+mcdx\n+Target Report Mask(HAS_CDX)\n+Enable generation of R2 CDX instructions"}, {"sha": "522e924f03b1298de475e186a546a2f364cecaaa", "filename": "gcc/doc/invoke.texi", "status": "modified", "additions": 20, "deletions": 1, "changes": 21, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/77c50d73f614a99388b94e0b5a9c393723c06f8c/gcc%2Fdoc%2Finvoke.texi", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/77c50d73f614a99388b94e0b5a9c393723c06f8c/gcc%2Fdoc%2Finvoke.texi", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fdoc%2Finvoke.texi?ref=77c50d73f614a99388b94e0b5a9c393723c06f8c", "patch": "@@ -857,7 +857,8 @@ Objective-C and Objective-C++ Dialects}.\n -mhw-mul -mno-hw-mul -mhw-mulx -mno-hw-mulx -mno-hw-div -mhw-div @gol\n -mcustom-@var{insn}=@var{N} -mno-custom-@var{insn} @gol\n -mcustom-fpu-cfg=@var{name} @gol\n--mhal -msmallc -msys-crt0=@var{name} -msys-lib=@var{name}}\n+-mhal -msmallc -msys-crt0=@var{name} -msys-lib=@var{name} @gol\n+-march=@var{arch} -mbmx -mno-bmx -mcdx -mno-cdx}\n \n @emph{Nvidia PTX Options}\n @gccoptlist{-m32 -m64 -mmainkernel}\n@@ -18500,6 +18501,15 @@ small data section.\n Generate little-endian (default) or big-endian (experimental) code,\n respectively.\n \n+@item -march=@var{arch}\n+@opindex march\n+This specifies the name of the target Nios II architecture.  GCC uses this\n+name to determine what kind of instructions it can emit when generating\n+assembly code.  Permissible names are: @samp{r1}, @samp{r2}.\n+\n+The preprocessor macro @code{__nios2_arch__} is available to programs,\n+with value 1 or 2, indicating the targeted ISA level.\n+\n @item -mbypass-cache\n @itemx -mno-bypass-cache\n @opindex mno-bypass-cache\n@@ -18538,6 +18548,15 @@ Enable or disable emitting @code{mul}, @code{mulx} and @code{div} family of\n instructions by the compiler. The default is to emit @code{mul}\n and not emit @code{div} and @code{mulx}.\n \n+@item -mbmx\n+@itemx -mno-bmx\n+@itemx -mcdx\n+@itemx -mno-cdx\n+Enable or disable generation of Nios II R2 BMX (bit manipulation) and\n+CDX (code density) instructions.  Enabling these instructions also\n+requires @option{-march=r2}.  Since these instructions are optional\n+extensions to the R2 architecture, the default is not to emit them.\n+\n @item -mcustom-@var{insn}=@var{N}\n @itemx -mno-custom-@var{insn}\n @opindex mcustom-@var{insn}"}]}