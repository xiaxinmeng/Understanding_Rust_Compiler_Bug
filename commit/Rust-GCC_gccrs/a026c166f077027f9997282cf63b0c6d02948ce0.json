{"sha": "a026c166f077027f9997282cf63b0c6d02948ce0", "node_id": "C_kwDOANBUbNoAKGEwMjZjMTY2ZjA3NzAyN2Y5OTk3MjgyY2Y2M2IwYzZkMDI5NDhjZTA", "commit": {"author": {"name": "Philip Herron", "email": "philip.herron@embecosm.com", "date": "2022-02-16T17:53:55Z"}, "committer": {"name": "Philip Herron", "email": "philip.herron@embecosm.com", "date": "2022-02-17T13:28:24Z"}, "message": "Add mappings helpers for looking up macros definitions", "tree": {"sha": "db381fcf0a856f5aad3f91e44cfaecda12709f7b", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/db381fcf0a856f5aad3f91e44cfaecda12709f7b"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/a026c166f077027f9997282cf63b0c6d02948ce0", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/a026c166f077027f9997282cf63b0c6d02948ce0", "html_url": "https://github.com/Rust-GCC/gccrs/commit/a026c166f077027f9997282cf63b0c6d02948ce0", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/a026c166f077027f9997282cf63b0c6d02948ce0/comments", "author": {"login": "philberty", "id": 84585, "node_id": "MDQ6VXNlcjg0NTg1", "avatar_url": "https://avatars.githubusercontent.com/u/84585?v=4", "gravatar_id": "", "url": "https://api.github.com/users/philberty", "html_url": "https://github.com/philberty", "followers_url": "https://api.github.com/users/philberty/followers", "following_url": "https://api.github.com/users/philberty/following{/other_user}", "gists_url": "https://api.github.com/users/philberty/gists{/gist_id}", "starred_url": "https://api.github.com/users/philberty/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/philberty/subscriptions", "organizations_url": "https://api.github.com/users/philberty/orgs", "repos_url": "https://api.github.com/users/philberty/repos", "events_url": "https://api.github.com/users/philberty/events{/privacy}", "received_events_url": "https://api.github.com/users/philberty/received_events", "type": "User", "site_admin": false}, "committer": {"login": "philberty", "id": 84585, "node_id": "MDQ6VXNlcjg0NTg1", "avatar_url": "https://avatars.githubusercontent.com/u/84585?v=4", "gravatar_id": "", "url": "https://api.github.com/users/philberty", "html_url": "https://github.com/philberty", "followers_url": "https://api.github.com/users/philberty/followers", "following_url": "https://api.github.com/users/philberty/following{/other_user}", "gists_url": "https://api.github.com/users/philberty/gists{/gist_id}", "starred_url": "https://api.github.com/users/philberty/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/philberty/subscriptions", "organizations_url": "https://api.github.com/users/philberty/orgs", "repos_url": "https://api.github.com/users/philberty/repos", "events_url": "https://api.github.com/users/philberty/events{/privacy}", "received_events_url": "https://api.github.com/users/philberty/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "864df7901cfb2581b226939bec85d75c2f301aa3", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/864df7901cfb2581b226939bec85d75c2f301aa3", "html_url": "https://github.com/Rust-GCC/gccrs/commit/864df7901cfb2581b226939bec85d75c2f301aa3"}], "stats": {"total": 27, "additions": 27, "deletions": 0}, "files": [{"sha": "1348e29e5f558702ab1280b53ac961da20fe7465", "filename": "gcc/rust/util/rust-hir-map.cc", "status": "modified", "additions": 20, "deletions": 0, "changes": 20, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/a026c166f077027f9997282cf63b0c6d02948ce0/gcc%2Frust%2Futil%2Frust-hir-map.cc", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/a026c166f077027f9997282cf63b0c6d02948ce0/gcc%2Frust%2Futil%2Frust-hir-map.cc", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Frust%2Futil%2Frust-hir-map.cc?ref=a026c166f077027f9997282cf63b0c6d02948ce0", "patch": "@@ -738,5 +738,25 @@ Mappings::iterate_trait_items (\n     }\n }\n \n+void\n+Mappings::insert_macro_def (AST::MacroRulesDefinition *macro)\n+{\n+  auto it = macroMappings.find (macro->get_node_id ());\n+  rust_assert (it == macroMappings.end ());\n+\n+  macroMappings[macro->get_node_id ()] = macro;\n+}\n+\n+bool\n+Mappings::lookup_macro_def (NodeId id, AST::MacroRulesDefinition **def)\n+{\n+  auto it = macroMappings.find (id);\n+  if (it == macroMappings.end ())\n+    return false;\n+\n+  *def = it->second;\n+  return true;\n+}\n+\n } // namespace Analysis\n } // namespace Rust"}, {"sha": "799351b41fdc7b987629b96f2d707c83d9f304e2", "filename": "gcc/rust/util/rust-hir-map.h", "status": "modified", "additions": 7, "deletions": 0, "changes": 7, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/a026c166f077027f9997282cf63b0c6d02948ce0/gcc%2Frust%2Futil%2Frust-hir-map.h", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/a026c166f077027f9997282cf63b0c6d02948ce0/gcc%2Frust%2Futil%2Frust-hir-map.h", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Frust%2Futil%2Frust-hir-map.h?ref=a026c166f077027f9997282cf63b0c6d02948ce0", "patch": "@@ -559,6 +559,10 @@ class Mappings\n     return true;\n   }\n \n+  void insert_macro_def (AST::MacroRulesDefinition *macro);\n+\n+  bool lookup_macro_def (NodeId id, AST::MacroRulesDefinition **def);\n+\n private:\n   Mappings ();\n \n@@ -612,6 +616,9 @@ class Mappings\n   // all hirid nodes\n   std::map<CrateNum, std::set<HirId>> hirNodesWithinCrate;\n \n+  // macros\n+  std::map<NodeId, AST::MacroRulesDefinition *> macroMappings;\n+\n   // crate names\n   std::map<CrateNum, std::string> crate_names;\n };"}]}