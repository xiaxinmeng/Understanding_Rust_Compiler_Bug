{"sha": "41c3cddc6b5d279f56f02709a92f55d61e4675c7", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6NDFjM2NkZGM2YjVkMjc5ZjU2ZjAyNzA5YTkyZjU1ZDYxZTQ2NzVjNw==", "commit": {"author": {"name": "Jerry DeLisle", "email": "jvdelisle@gcc.gnu.org", "date": "2010-03-20T14:39:00Z"}, "committer": {"name": "Jerry DeLisle", "email": "jvdelisle@gcc.gnu.org", "date": "2010-03-20T14:39:00Z"}, "message": "re PR fortran/43409 (I/O: INQUIRE for SIZE does not work.)\n\n2010-03-20  Jerry DeLisle  <jvdelisle@gcc.gnu.org>\n\n\tPR fortran/43409\n\t* ioparm.def: Change inquire size variable to type pointer to\n\tGFC_IO_INT type.\n\n2010-03-20  Jerry DeLisle  <jvdelisle@gcc.gnu.org>\n\n\tPR fortran/43409\n\t* io/unix.h: Add prototype for new function to return file size.\n\t* io/unix.c (file_size): New function.\n\t* io/inquire.c (inquire_via_unit): Use new function.\n\t(inquire_via_filename): Use new function.\n\nFrom-SVN: r157593", "tree": {"sha": "1f0dd89e327efd48666fe5142e7c12087383968d", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/1f0dd89e327efd48666fe5142e7c12087383968d"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/41c3cddc6b5d279f56f02709a92f55d61e4675c7", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/41c3cddc6b5d279f56f02709a92f55d61e4675c7", "html_url": "https://github.com/Rust-GCC/gccrs/commit/41c3cddc6b5d279f56f02709a92f55d61e4675c7", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/41c3cddc6b5d279f56f02709a92f55d61e4675c7/comments", "author": null, "committer": null, "parents": [{"sha": "d491d2af314a455227666dd245dc27ea0dfdea8e", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/d491d2af314a455227666dd245dc27ea0dfdea8e", "html_url": "https://github.com/Rust-GCC/gccrs/commit/d491d2af314a455227666dd245dc27ea0dfdea8e"}], "stats": {"total": 48, "additions": 46, "deletions": 2}, "files": [{"sha": "d8a2d3ee7909a24c667b661d7d35fb5b95d2c663", "filename": "gcc/fortran/ChangeLog", "status": "modified", "additions": 6, "deletions": 0, "changes": 6, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/41c3cddc6b5d279f56f02709a92f55d61e4675c7/gcc%2Ffortran%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/41c3cddc6b5d279f56f02709a92f55d61e4675c7/gcc%2Ffortran%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ffortran%2FChangeLog?ref=41c3cddc6b5d279f56f02709a92f55d61e4675c7", "patch": "@@ -1,3 +1,9 @@\n+2010-03-20  Jerry DeLisle  <jvdelisle@gcc.gnu.org>\n+\n+\tPR fortran/43409\n+\t* ioparm.def: Change inquire size variable to type pointer to\n+\tGFC_IO_INT type.\n+\n 2010-03-18  Paul Thomas  <pault@gcc.gnu.org>\n \n         PR fortran/43039"}, {"sha": "ba1ba232b449a857a18d3febb1e8d5c642d30df4", "filename": "gcc/fortran/ioparm.def", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/41c3cddc6b5d279f56f02709a92f55d61e4675c7/gcc%2Ffortran%2Fioparm.def", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/41c3cddc6b5d279f56f02709a92f55d61e4675c7/gcc%2Ffortran%2Fioparm.def", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ffortran%2Fioparm.def?ref=41c3cddc6b5d279f56f02709a92f55d61e4675c7", "patch": "@@ -85,7 +85,7 @@ IOPARM (inquire, encoding,\t1 << 2,  char1)\n IOPARM (inquire, round,\t\t1 << 3,  char2)\n IOPARM (inquire, sign,\t\t1 << 4,  char1)\n IOPARM (inquire, pending,\t1 << 5,  pint4)\n-IOPARM (inquire, size,\t\t1 << 6,  pint4)\n+IOPARM (inquire, size,\t\t1 << 6,  pintio)\n IOPARM (inquire, id,\t\t1 << 7,  pint4)\n IOPARM (wait,    common,\t0,\t common)\n IOPARM (wait,    id,\t\t1 << 7,  pint4)"}, {"sha": "7a80556532cd055b2ab32281246e17b1fc0bef57", "filename": "libgfortran/ChangeLog", "status": "modified", "additions": 9, "deletions": 1, "changes": 10, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/41c3cddc6b5d279f56f02709a92f55d61e4675c7/libgfortran%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/41c3cddc6b5d279f56f02709a92f55d61e4675c7/libgfortran%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libgfortran%2FChangeLog?ref=41c3cddc6b5d279f56f02709a92f55d61e4675c7", "patch": "@@ -1,7 +1,15 @@\n+2010-03-20  Jerry DeLisle  <jvdelisle@gcc.gnu.org>\n+\n+\tPR fortran/43409\n+\t* io/unix.h: Add prototype for new function to return file size.\n+\t* io/unix.c (file_size): New function.\n+\t* io/inquire.c (inquire_via_unit): Use new function.\n+\t(inquire_via_filename): Use new function.\n+\n 2010-03-17  Jerry DeLisle  <jvdelisle@gcc.gnu.org>\n \n \t* io/transfer.c (read_sf_internal): Remove stray function declaration\n-\tused during debigging.\n+\tused during debugging.\n \n 2010-03-17  Jerry DeLisle  <jvdelisle@gcc.gnu.org>\n "}, {"sha": "cd44c04251e4d99aa433bb7649d930f052868291", "filename": "libgfortran/io/inquire.c", "status": "modified", "additions": 11, "deletions": 0, "changes": 11, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/41c3cddc6b5d279f56f02709a92f55d61e4675c7/libgfortran%2Fio%2Finquire.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/41c3cddc6b5d279f56f02709a92f55d61e4675c7/libgfortran%2Fio%2Finquire.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libgfortran%2Fio%2Finquire.c?ref=41c3cddc6b5d279f56f02709a92f55d61e4675c7", "patch": "@@ -371,6 +371,14 @@ inquire_via_unit (st_parameter_inquire *iqp, gfc_unit * u)\n \n \t  cf_strcpy (iqp->round, iqp->round_len, p);\n \t}\n+\n+      if ((cf2 & IOPARM_INQUIRE_HAS_SIZE) != 0)\n+\t{\n+\t  if (u == NULL)\n+\t    *iqp->size = -1;\n+\t  else\n+\t    *iqp->size = file_size (u->file, (gfc_charlen_type) u->file_len);\n+\t}\n     }\n \n   if ((cf & IOPARM_INQUIRE_HAS_POSITION) != 0)\n@@ -601,6 +609,9 @@ inquire_via_filename (st_parameter_inquire *iqp)\n   \n       if ((cf2 & IOPARM_INQUIRE_HAS_ENCODING) != 0)\n \tcf_strcpy (iqp->encoding, iqp->encoding_len, undefined);\n+\n+      if ((cf2 & IOPARM_INQUIRE_HAS_SIZE) != 0)\n+\t*iqp->size = file_size (iqp->file, iqp->file_len);\n     }\n \n   if ((cf & IOPARM_INQUIRE_HAS_POSITION) != 0)"}, {"sha": "4435674b46d76499e63b102414ce64c71c2d8dbb", "filename": "libgfortran/io/unix.c", "status": "modified", "additions": 16, "deletions": 0, "changes": 16, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/41c3cddc6b5d279f56f02709a92f55d61e4675c7/libgfortran%2Fio%2Funix.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/41c3cddc6b5d279f56f02709a92f55d61e4675c7/libgfortran%2Fio%2Funix.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libgfortran%2Fio%2Funix.c?ref=41c3cddc6b5d279f56f02709a92f55d61e4675c7", "patch": "@@ -1475,6 +1475,22 @@ file_exists (const char *file, gfc_charlen_type file_len)\n }\n \n \n+/* file_size()-- Returns the size of the file.  */\n+\n+GFC_IO_INT\n+file_size (const char *file, gfc_charlen_type file_len)\n+{\n+  char path[PATH_MAX + 1];\n+  gfstat_t statbuf;\n+\n+  if (unpack_filename (path, file, file_len))\n+    return -1;\n+\n+  if (stat (path, &statbuf) < 0)\n+    return -1;\n+\n+  return (GFC_IO_INT) statbuf.st_size;\n+}\n \n static const char yes[] = \"YES\", no[] = \"NO\", unknown[] = \"UNKNOWN\";\n "}, {"sha": "e567fdfe205241d7c33695293585bf6ba9711ea1", "filename": "libgfortran/io/unix.h", "status": "modified", "additions": 3, "deletions": 0, "changes": 3, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/41c3cddc6b5d279f56f02709a92f55d61e4675c7/libgfortran%2Fio%2Funix.h", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/41c3cddc6b5d279f56f02709a92f55d61e4675c7/libgfortran%2Fio%2Funix.h", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libgfortran%2Fio%2Funix.h?ref=41c3cddc6b5d279f56f02709a92f55d61e4675c7", "patch": "@@ -121,6 +121,9 @@ internal_proto(delete_file);\n extern int file_exists (const char *file, gfc_charlen_type file_len);\n internal_proto(file_exists);\n \n+extern GFC_IO_INT file_size (const char *file, gfc_charlen_type file_len);\n+internal_proto(file_size);\n+\n extern const char *inquire_sequential (const char *, int);\n internal_proto(inquire_sequential);\n "}]}