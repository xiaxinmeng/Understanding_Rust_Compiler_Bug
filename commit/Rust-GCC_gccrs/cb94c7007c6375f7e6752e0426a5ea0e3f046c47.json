{"sha": "cb94c7007c6375f7e6752e0426a5ea0e3f046c47", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6Y2I5NGM3MDA3YzYzNzVmN2U2NzUyZTA0MjZhNWVhMGUzZjA0NmM0Nw==", "commit": {"author": {"name": "Jason Merrill", "email": "jason@redhat.com", "date": "2017-02-17T22:05:18Z"}, "committer": {"name": "Jason Merrill", "email": "jason@gcc.gnu.org", "date": "2017-02-17T22:05:18Z"}, "message": "PR c++/79508 - lookup error with member template\n\n\t* parser.c (cp_parser_template_name): Clear\n\tparser->context->object_type if we aren't doing lookup.\n\nFrom-SVN: r245553", "tree": {"sha": "48e0bf87fd08ee4a5757de2c8610fa634410975a", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/48e0bf87fd08ee4a5757de2c8610fa634410975a"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/cb94c7007c6375f7e6752e0426a5ea0e3f046c47", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/cb94c7007c6375f7e6752e0426a5ea0e3f046c47", "html_url": "https://github.com/Rust-GCC/gccrs/commit/cb94c7007c6375f7e6752e0426a5ea0e3f046c47", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/cb94c7007c6375f7e6752e0426a5ea0e3f046c47/comments", "author": {"login": "jicama", "id": 266146, "node_id": "MDQ6VXNlcjI2NjE0Ng==", "avatar_url": "https://avatars.githubusercontent.com/u/266146?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jicama", "html_url": "https://github.com/jicama", "followers_url": "https://api.github.com/users/jicama/followers", "following_url": "https://api.github.com/users/jicama/following{/other_user}", "gists_url": "https://api.github.com/users/jicama/gists{/gist_id}", "starred_url": "https://api.github.com/users/jicama/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jicama/subscriptions", "organizations_url": "https://api.github.com/users/jicama/orgs", "repos_url": "https://api.github.com/users/jicama/repos", "events_url": "https://api.github.com/users/jicama/events{/privacy}", "received_events_url": "https://api.github.com/users/jicama/received_events", "type": "User", "site_admin": false}, "committer": null, "parents": [{"sha": "7c5867495bbfce161cd0461b002f626f9339b78f", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/7c5867495bbfce161cd0461b002f626f9339b78f", "html_url": "https://github.com/Rust-GCC/gccrs/commit/7c5867495bbfce161cd0461b002f626f9339b78f"}], "stats": {"total": 34, "additions": 33, "deletions": 1}, "files": [{"sha": "8dce6d18feaab08688d87279b770795f64b98d4b", "filename": "gcc/cp/ChangeLog", "status": "modified", "additions": 4, "deletions": 0, "changes": 4, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/cb94c7007c6375f7e6752e0426a5ea0e3f046c47/gcc%2Fcp%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/cb94c7007c6375f7e6752e0426a5ea0e3f046c47/gcc%2Fcp%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fcp%2FChangeLog?ref=cb94c7007c6375f7e6752e0426a5ea0e3f046c47", "patch": "@@ -1,5 +1,9 @@\n 2017-02-17  Jason Merrill  <jason@redhat.com>\n \n+\tPR c++/79508 - lookup error with member template\n+\t* parser.c (cp_parser_template_name): Clear\n+\tparser->context->object_type if we aren't doing lookup.\n+\n \tPR c++/78690 - ICE with using and global type with same name\n \t* pt.c (type_dependent_object_expression_p): True for\n \tIDENTIFIER_NODE."}, {"sha": "92d8ccea95bbf46aaf1bab037f661905c117f1cd", "filename": "gcc/cp/parser.c", "status": "modified", "additions": 7, "deletions": 1, "changes": 8, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/cb94c7007c6375f7e6752e0426a5ea0e3f046c47/gcc%2Fcp%2Fparser.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/cb94c7007c6375f7e6752e0426a5ea0e3f046c47/gcc%2Fcp%2Fparser.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fcp%2Fparser.c?ref=cb94c7007c6375f7e6752e0426a5ea0e3f046c47", "patch": "@@ -15719,6 +15719,7 @@ cp_parser_template_name (cp_parser* parser,\n \t    cp_lexer_purge_tokens_after (parser->lexer, start);\n \t  if (is_identifier)\n \t    *is_identifier = true;\n+\t  parser->context->object_type = NULL_TREE;\n \t  return identifier;\n \t}\n \n@@ -15730,7 +15731,12 @@ cp_parser_template_name (cp_parser* parser,\n \t  && (!parser->scope\n \t      || (TYPE_P (parser->scope)\n \t\t  && dependent_type_p (parser->scope))))\n-\treturn identifier;\n+\t{\n+\t  /* We're optimizing away the call to cp_parser_lookup_name, but we\n+\t     still need to do this.  */\n+\t  parser->context->object_type = NULL_TREE;\n+\t  return identifier;\n+\t}\n     }\n \n   /* Look up the name.  */"}, {"sha": "c5c3634ff382513035efd28f46886d17529a5c76", "filename": "gcc/testsuite/g++.dg/template/memtmpl5.C", "status": "added", "additions": 22, "deletions": 0, "changes": 22, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/cb94c7007c6375f7e6752e0426a5ea0e3f046c47/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Ftemplate%2Fmemtmpl5.C", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/cb94c7007c6375f7e6752e0426a5ea0e3f046c47/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Ftemplate%2Fmemtmpl5.C", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Ftemplate%2Fmemtmpl5.C?ref=cb94c7007c6375f7e6752e0426a5ea0e3f046c47", "patch": "@@ -0,0 +1,22 @@\n+// PR c++/79508\n+\n+struct C\n+{\n+  template< void(*F)()> void set_default() { \t}\t\n+};\n+\n+\n+template <class T> void random_positive()\n+{\n+}\n+\n+template<class T> void initialize(T& x)\n+{\n+  x.template set_default<random_positive<T> >();\n+}\n+\n+int main ()\n+{\n+  C x;\n+  initialize<C>(x);\n+}"}]}