{"sha": "2fbea4190e76a59c4880727cf84706fe083c00ae", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6MmZiZWE0MTkwZTc2YTU5YzQ4ODA3MjdjZjg0NzA2ZmUwODNjMDBhZQ==", "commit": {"author": {"name": "David Malcolm", "email": "dmalcolm@redhat.com", "date": "2020-01-23T23:28:54Z"}, "committer": {"name": "David Malcolm", "email": "dmalcolm@redhat.com", "date": "2020-01-27T16:42:20Z"}, "message": "analyzer: restore input_location (PR 93349)\n\nPR analyzer/93349 reports an ICE in IPA pass: simdclone for\nsome input files when -fanalyzer is supplied, with:\n  error: location references block not in block tree\n\nThe root cause is that the analyzer touches input_location in some\nplaces (to make it easier to track down which source construct the\nanalyzer can't handle in the case of an analyzer ICE) and fails to reset\nit.  For the ICE in question, this sets input_location to a location_t\nthat references some arbitrary block (specifically, that of the last\nstatement to be analyzed, within the original CFG of whichever is the\nlast such function to be analyzed).\n\nLater, within omp-simd-clone.c, input_location is used by gimplify_expr\n(called via gimplify_and_add), which has:\n\n14492\t      if (!gimple_seq_empty_p (*pre_p))\n14493\t\tannotate_all_with_location_after (*pre_p, pre_last_gsi, input_location);\n\nthus using whatever the value of input_location is, leading\nto statements that reference some arbitrary block in the original CFG.\nFor the reproducer, this happens to be a block in the CFG for the\noriginal function, rather than that of the clone, but in general it\ncould be some arbitrary other function in the TU.\n\nThis code appears to assume that input_location has some arbitrary\nvalue *not* in the block tree, which is potentially violated by the\nanalyzer's changes to input_location.\n\nThis patch adds a save and restore of input_location at the top-level\nfunction of the analyzer, fixing the ICE.\n\ngcc/analyzer/ChangeLog:\n\tPR analyzer/93349\n\t* engine.cc (run_checkers): Save and restore input_location.\n\ngcc/testsuite/ChangeLog:\n\tPR analyzer/93349\n\t* gcc.dg/analyzer/torture/pr93349.c: New test.", "tree": {"sha": "fe0fe8d25ca5b1fcb6128a1b1d98b809e9d4796f", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/fe0fe8d25ca5b1fcb6128a1b1d98b809e9d4796f"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/2fbea4190e76a59c4880727cf84706fe083c00ae", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/2fbea4190e76a59c4880727cf84706fe083c00ae", "html_url": "https://github.com/Rust-GCC/gccrs/commit/2fbea4190e76a59c4880727cf84706fe083c00ae", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/2fbea4190e76a59c4880727cf84706fe083c00ae/comments", "author": {"login": "davidmalcolm", "id": 1553248, "node_id": "MDQ6VXNlcjE1NTMyNDg=", "avatar_url": "https://avatars.githubusercontent.com/u/1553248?v=4", "gravatar_id": "", "url": "https://api.github.com/users/davidmalcolm", "html_url": "https://github.com/davidmalcolm", "followers_url": "https://api.github.com/users/davidmalcolm/followers", "following_url": "https://api.github.com/users/davidmalcolm/following{/other_user}", "gists_url": "https://api.github.com/users/davidmalcolm/gists{/gist_id}", "starred_url": "https://api.github.com/users/davidmalcolm/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/davidmalcolm/subscriptions", "organizations_url": "https://api.github.com/users/davidmalcolm/orgs", "repos_url": "https://api.github.com/users/davidmalcolm/repos", "events_url": "https://api.github.com/users/davidmalcolm/events{/privacy}", "received_events_url": "https://api.github.com/users/davidmalcolm/received_events", "type": "User", "site_admin": false}, "committer": {"login": "davidmalcolm", "id": 1553248, "node_id": "MDQ6VXNlcjE1NTMyNDg=", "avatar_url": "https://avatars.githubusercontent.com/u/1553248?v=4", "gravatar_id": "", "url": "https://api.github.com/users/davidmalcolm", "html_url": "https://github.com/davidmalcolm", "followers_url": "https://api.github.com/users/davidmalcolm/followers", "following_url": "https://api.github.com/users/davidmalcolm/following{/other_user}", "gists_url": "https://api.github.com/users/davidmalcolm/gists{/gist_id}", "starred_url": "https://api.github.com/users/davidmalcolm/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/davidmalcolm/subscriptions", "organizations_url": "https://api.github.com/users/davidmalcolm/orgs", "repos_url": "https://api.github.com/users/davidmalcolm/repos", "events_url": "https://api.github.com/users/davidmalcolm/events{/privacy}", "received_events_url": "https://api.github.com/users/davidmalcolm/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "f89e844f9c589d1717248597641d25d81a4acb41", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/f89e844f9c589d1717248597641d25d81a4acb41", "html_url": "https://github.com/Rust-GCC/gccrs/commit/f89e844f9c589d1717248597641d25d81a4acb41"}], "stats": {"total": 22, "additions": 22, "deletions": 0}, "files": [{"sha": "3a2d179c766809aeff20309e161892f338dfef0e", "filename": "gcc/analyzer/ChangeLog", "status": "modified", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/2fbea4190e76a59c4880727cf84706fe083c00ae/gcc%2Fanalyzer%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/2fbea4190e76a59c4880727cf84706fe083c00ae/gcc%2Fanalyzer%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fanalyzer%2FChangeLog?ref=2fbea4190e76a59c4880727cf84706fe083c00ae", "patch": "@@ -1,3 +1,8 @@\n+2020-01-27  David Malcolm  <dmalcolm@redhat.com>\n+\n+\tPR analyzer/93349\n+\t* engine.cc (run_checkers): Save and restore input_location.\n+\n 2020-01-27  David Malcolm  <dmalcolm@redhat.com>\n \n \t* call-string.cc (call_string::cmp_1): Delete, moving body to..."}, {"sha": "2bc0aff6a6e4323ea959dfda00ff8a1af0ddc679", "filename": "gcc/analyzer/engine.cc", "status": "modified", "additions": 8, "deletions": 0, "changes": 8, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/2fbea4190e76a59c4880727cf84706fe083c00ae/gcc%2Fanalyzer%2Fengine.cc", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/2fbea4190e76a59c4880727cf84706fe083c00ae/gcc%2Fanalyzer%2Fengine.cc", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fanalyzer%2Fengine.cc?ref=2fbea4190e76a59c4880727cf84706fe083c00ae", "patch": "@@ -3589,6 +3589,9 @@ impl_run_checkers (logger *logger)\n void\n run_checkers ()\n {\n+  /* Save input_location.  */\n+  location_t saved_input_location = input_location;\n+\n   /* Handle -fdump-analyzer and -fdump-analyzer-stderr.  */\n   FILE *dump_fout = NULL;\n   /* Track if we're responsible for closing dump_fout.  */\n@@ -3619,6 +3622,11 @@ run_checkers ()\n \n   if (owns_dump_fout)\n     fclose (dump_fout);\n+\n+  /* Restore input_location.  Subsequent passes may assume that input_location\n+     is some arbitrary value *not* in the block tree, which might be violated\n+     if we didn't restore it.  */\n+  input_location = saved_input_location;\n }\n \n } // namespace ana"}, {"sha": "b4f298a7ea098aeb29138d238c9b6b83439701f7", "filename": "gcc/testsuite/ChangeLog", "status": "modified", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/2fbea4190e76a59c4880727cf84706fe083c00ae/gcc%2Ftestsuite%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/2fbea4190e76a59c4880727cf84706fe083c00ae/gcc%2Ftestsuite%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2FChangeLog?ref=2fbea4190e76a59c4880727cf84706fe083c00ae", "patch": "@@ -1,3 +1,8 @@\n+2020-01-27  David Malcolm  <dmalcolm@redhat.com>\n+\n+\tPR analyzer/93349\n+\t* gcc.dg/analyzer/torture/pr93349.c: New test.\n+\n 2020-01-27  David Malcolm  <dmalcolm@redhat.com>\n \n \tPR analyzer/93291"}, {"sha": "a9d0636772229d2df404bea2137eb2b8324c7c22", "filename": "gcc/testsuite/gcc.dg/analyzer/torture/pr93349.c", "status": "added", "additions": 4, "deletions": 0, "changes": 4, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/2fbea4190e76a59c4880727cf84706fe083c00ae/gcc%2Ftestsuite%2Fgcc.dg%2Fanalyzer%2Ftorture%2Fpr93349.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/2fbea4190e76a59c4880727cf84706fe083c00ae/gcc%2Ftestsuite%2Fgcc.dg%2Fanalyzer%2Ftorture%2Fpr93349.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgcc.dg%2Fanalyzer%2Ftorture%2Fpr93349.c?ref=2fbea4190e76a59c4880727cf84706fe083c00ae", "patch": "@@ -0,0 +1,4 @@\n+__attribute__ ((simd)) void\n+test (void)\n+{\n+}"}]}