{"sha": "f7d594d251bfc8adc3fff439fd67d343bd7f1981", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6ZjdkNTk0ZDI1MWJmYzhhZGMzZmZmNDM5ZmQ2N2QzNDNiZDdmMTk4MQ==", "commit": {"author": {"name": "Jakub Jelinek", "email": "jakub@redhat.com", "date": "2014-01-17T14:42:58Z"}, "committer": {"name": "Jakub Jelinek", "email": "jakub@gcc.gnu.org", "date": "2014-01-17T14:42:58Z"}, "message": "re PR fortran/59440 (ICE in force_decl_die, at dwarf2out.c:20111 with -g)\n\n\tPR fortran/59440\n\t* tree-nested.c (convert_nonlocal_reference_stmt,\n\tconvert_local_reference_stmt): For NAMELIST_DECLs in gimple_bind_vars\n\tof GIMPLE_BIND stmts, adjust associated decls.\n\n\t* gfortran.dg/pr59440-1.f90: New test.\n\t* gfortran.dg/pr59440-2.f90: New test.\n\t* gfortran.dg/pr59440-3.f90: New test.\n\nFrom-SVN: r206711", "tree": {"sha": "ea2e9512771f68f8e5de0cc651b70f1871f1e0f8", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/ea2e9512771f68f8e5de0cc651b70f1871f1e0f8"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/f7d594d251bfc8adc3fff439fd67d343bd7f1981", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/f7d594d251bfc8adc3fff439fd67d343bd7f1981", "html_url": "https://github.com/Rust-GCC/gccrs/commit/f7d594d251bfc8adc3fff439fd67d343bd7f1981", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/f7d594d251bfc8adc3fff439fd67d343bd7f1981/comments", "author": {"login": "jakubjelinek", "id": 9370665, "node_id": "MDQ6VXNlcjkzNzA2NjU=", "avatar_url": "https://avatars.githubusercontent.com/u/9370665?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jakubjelinek", "html_url": "https://github.com/jakubjelinek", "followers_url": "https://api.github.com/users/jakubjelinek/followers", "following_url": "https://api.github.com/users/jakubjelinek/following{/other_user}", "gists_url": "https://api.github.com/users/jakubjelinek/gists{/gist_id}", "starred_url": "https://api.github.com/users/jakubjelinek/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jakubjelinek/subscriptions", "organizations_url": "https://api.github.com/users/jakubjelinek/orgs", "repos_url": "https://api.github.com/users/jakubjelinek/repos", "events_url": "https://api.github.com/users/jakubjelinek/events{/privacy}", "received_events_url": "https://api.github.com/users/jakubjelinek/received_events", "type": "User", "site_admin": false}, "committer": null, "parents": [{"sha": "dfc7b927f3bb5ed8cc8c9dbeba3405ff4e89f543", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/dfc7b927f3bb5ed8cc8c9dbeba3405ff4e89f543", "html_url": "https://github.com/Rust-GCC/gccrs/commit/dfc7b927f3bb5ed8cc8c9dbeba3405ff4e89f543"}], "stats": {"total": 116, "additions": 116, "deletions": 0}, "files": [{"sha": "d583762712a5dafab113ba75a55b7e665d1e0498", "filename": "gcc/ChangeLog", "status": "modified", "additions": 7, "deletions": 0, "changes": 7, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/f7d594d251bfc8adc3fff439fd67d343bd7f1981/gcc%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/f7d594d251bfc8adc3fff439fd67d343bd7f1981/gcc%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2FChangeLog?ref=f7d594d251bfc8adc3fff439fd67d343bd7f1981", "patch": "@@ -1,3 +1,10 @@\n+2014-01-17  Jakub Jelinek  <jakub@redhat.com>\n+\n+\tPR fortran/59440\n+\t* tree-nested.c (convert_nonlocal_reference_stmt,\n+\tconvert_local_reference_stmt): For NAMELIST_DECLs in gimple_bind_vars\n+\tof GIMPLE_BIND stmts, adjust associated decls.\n+\n 2014-01-17  Richard Biener  <rguenther@suse.de>\n \n \tPR tree-optimization/46590"}, {"sha": "1d7dcf7c313f50968b210a9d41d21f87558c25d6", "filename": "gcc/testsuite/ChangeLog", "status": "modified", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/f7d594d251bfc8adc3fff439fd67d343bd7f1981/gcc%2Ftestsuite%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/f7d594d251bfc8adc3fff439fd67d343bd7f1981/gcc%2Ftestsuite%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2FChangeLog?ref=f7d594d251bfc8adc3fff439fd67d343bd7f1981", "patch": "@@ -1,5 +1,10 @@\n 2014-01-17  Jakub Jelinek  <jakub@redhat.com>\n \n+\tPR fortran/59440\n+\t* gfortran.dg/pr59440-1.f90: New test.\n+\t* gfortran.dg/pr59440-2.f90: New test.\n+\t* gfortran.dg/pr59440-3.f90: New test.\n+\n \tPR testsuite/59064\n \t* gcc.dg/vect/vect-ivdep-1.c: Replace two dg-bogus lines separately\n \ttesting for \" version\" and \" alias\" with one testing for"}, {"sha": "d874c6dcec53f02bee687a1288e9b21811659b3a", "filename": "gcc/testsuite/gfortran.dg/pr59440-1.f90", "status": "added", "additions": 23, "deletions": 0, "changes": 23, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/f7d594d251bfc8adc3fff439fd67d343bd7f1981/gcc%2Ftestsuite%2Fgfortran.dg%2Fpr59440-1.f90", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/f7d594d251bfc8adc3fff439fd67d343bd7f1981/gcc%2Ftestsuite%2Fgfortran.dg%2Fpr59440-1.f90", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgfortran.dg%2Fpr59440-1.f90?ref=f7d594d251bfc8adc3fff439fd67d343bd7f1981", "patch": "@@ -0,0 +1,23 @@\n+! PR fortran/59440\n+! { dg-do compile }\n+! { dg-options \"-O2 -g\" }\n+\n+module pr59440\n+  implicit none\n+  type t\n+     integer :: grid = 0\n+  end type t\n+contains\n+  subroutine read_nml (nnml, s)\n+    integer, intent(in)  :: nnml\n+    type(t), intent(out) :: s\n+    integer              :: grid\n+    namelist /N/ grid\n+    call read_nml_type_2\n+    s%grid = grid\n+  contains\n+    subroutine read_nml_type_2\n+      read (nnml, nml=N)\n+    end subroutine read_nml_type_2\n+  end subroutine read_nml\n+end module pr59440"}, {"sha": "a9f027c47b8b515542306a7cb8f7cb70e47493c5", "filename": "gcc/testsuite/gfortran.dg/pr59440-2.f90", "status": "added", "additions": 16, "deletions": 0, "changes": 16, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/f7d594d251bfc8adc3fff439fd67d343bd7f1981/gcc%2Ftestsuite%2Fgfortran.dg%2Fpr59440-2.f90", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/f7d594d251bfc8adc3fff439fd67d343bd7f1981/gcc%2Ftestsuite%2Fgfortran.dg%2Fpr59440-2.f90", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgfortran.dg%2Fpr59440-2.f90?ref=f7d594d251bfc8adc3fff439fd67d343bd7f1981", "patch": "@@ -0,0 +1,16 @@\n+! PR fortran/59440\n+! { dg-do compile }\n+! { dg-options \"-O2 -g\" }\n+\n+subroutine foo (nnml, outv)\n+  integer, intent(in) :: nnml\n+  integer, intent(out) :: outv\n+  integer :: grid\n+  namelist /N/ grid\n+  read (nnml, nml=N)\n+  call bar\n+contains\n+  subroutine bar\n+    outv = grid\n+  end subroutine bar\n+end subroutine foo"}, {"sha": "70fe6a5c5c3d6f19be268f7aa40f502dce24ca44", "filename": "gcc/testsuite/gfortran.dg/pr59440-3.f90", "status": "added", "additions": 16, "deletions": 0, "changes": 16, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/f7d594d251bfc8adc3fff439fd67d343bd7f1981/gcc%2Ftestsuite%2Fgfortran.dg%2Fpr59440-3.f90", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/f7d594d251bfc8adc3fff439fd67d343bd7f1981/gcc%2Ftestsuite%2Fgfortran.dg%2Fpr59440-3.f90", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgfortran.dg%2Fpr59440-3.f90?ref=f7d594d251bfc8adc3fff439fd67d343bd7f1981", "patch": "@@ -0,0 +1,16 @@\n+! PR fortran/59440\n+! { dg-do compile }\n+! { dg-options \"-O2 -g\" }\n+\n+subroutine foo (nnml, outv)\n+  integer, intent(in) :: nnml\n+  integer, intent(out) :: outv\n+  integer :: grid\n+  call bar\n+  outv = grid\n+contains\n+  subroutine bar\n+    namelist /N/ grid\n+    read (nnml, nml=N)\n+  end subroutine bar\n+end subroutine foo"}, {"sha": "df6923f76ef3317bd67cc8c8acade1d1a03ea656", "filename": "gcc/tree-nested.c", "status": "modified", "additions": 49, "deletions": 0, "changes": 49, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/f7d594d251bfc8adc3fff439fd67d343bd7f1981/gcc%2Ftree-nested.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/f7d594d251bfc8adc3fff439fd67d343bd7f1981/gcc%2Ftree-nested.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftree-nested.c?ref=f7d594d251bfc8adc3fff439fd67d343bd7f1981", "patch": "@@ -1331,6 +1331,25 @@ convert_nonlocal_reference_stmt (gimple_stmt_iterator *gsi, bool *handled_ops_p,\n       if (!optimize && gimple_bind_block (stmt))\n \tnote_nonlocal_block_vlas (info, gimple_bind_block (stmt));\n \n+      for (tree var = gimple_bind_vars (stmt); var; var = DECL_CHAIN (var))\n+\tif (TREE_CODE (var) == NAMELIST_DECL)\n+\t  {\n+\t    /* Adjust decls mentioned in NAMELIST_DECL.  */\n+\t    tree decls = NAMELIST_DECL_ASSOCIATED_DECL (var);\n+\t    tree decl;\n+\t    unsigned int i;\n+\n+\t    FOR_EACH_CONSTRUCTOR_VALUE (CONSTRUCTOR_ELTS (decls), i, decl)\n+\t      {\n+\t\tif (TREE_CODE (decl) == VAR_DECL\n+\t\t    && (TREE_STATIC (decl) || DECL_EXTERNAL (decl)))\n+\t\t  continue;\n+\t\tif (decl_function_context (decl) != info->context)\n+\t\t  CONSTRUCTOR_ELT (decls, i)->value\n+\t\t    = get_nonlocal_debug_decl (info, decl);\n+\t      }\n+\t  }\n+\n       *handled_ops_p = false;\n       return NULL_TREE;\n \n@@ -1787,6 +1806,36 @@ convert_local_reference_stmt (gimple_stmt_iterator *gsi, bool *handled_ops_p,\n       *handled_ops_p = false;\n       return NULL_TREE;\n \n+    case GIMPLE_BIND:\n+      for (tree var = gimple_bind_vars (stmt); var; var = DECL_CHAIN (var))\n+\tif (TREE_CODE (var) == NAMELIST_DECL)\n+\t  {\n+\t    /* Adjust decls mentioned in NAMELIST_DECL.  */\n+\t    tree decls = NAMELIST_DECL_ASSOCIATED_DECL (var);\n+\t    tree decl;\n+\t    unsigned int i;\n+\n+\t    FOR_EACH_CONSTRUCTOR_VALUE (CONSTRUCTOR_ELTS (decls), i, decl)\n+\t      {\n+\t\tif (TREE_CODE (decl) == VAR_DECL\n+\t\t    && (TREE_STATIC (decl) || DECL_EXTERNAL (decl)))\n+\t\t  continue;\n+\t\tif (decl_function_context (decl) == info->context\n+\t\t    && !use_pointer_in_frame (decl))\n+\t\t  {\n+\t\t    tree field = lookup_field_for_decl (info, decl, NO_INSERT);\n+\t\t    if (field)\n+\t\t      {\n+\t\t\tCONSTRUCTOR_ELT (decls, i)->value\n+\t\t\t  = get_local_debug_decl (info, decl, field);\n+\t\t      }\n+\t\t  }\n+\t      }\n+\t  }\n+\n+      *handled_ops_p = false;\n+      return NULL_TREE;\n+\n     default:\n       /* For every other statement that we are not interested in\n \t handling here, let the walker traverse the operands.  */"}]}