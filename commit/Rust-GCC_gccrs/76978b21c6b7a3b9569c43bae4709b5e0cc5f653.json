{"sha": "76978b21c6b7a3b9569c43bae4709b5e0cc5f653", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6NzY5NzhiMjFjNmI3YTNiOTU2OWM0M2JhZTQ3MDliNWUwY2M1ZjY1Mw==", "commit": {"author": {"name": "Renlin Li", "email": "renlin.li@arm.com", "date": "2015-04-16T08:36:21Z"}, "committer": {"name": "Renlin Li", "email": "renlin@gcc.gnu.org", "date": "2015-04-16T08:36:21Z"}, "message": "[PATCH]Enable two UNSIGNED_FLOAT simplifications in simplify_unary_operation_1.\n\ngcc/\n\n2015-04-16  Renlin Li  <renlin.li@arm.com>\n\n\t* simplify-rtx.c (simplify_unary_operation_1): Fix a typo. Enable two\n\tsimplifications for UNSIGNEDED_FLOAT.\n\ngcc/testsuite/\n\n2015-04-16  Renlin Li  <renlin.li@arm.com>\n\n\t* gcc.target/aarch64/unsigned-float.c: New.\n\t* gcc.target/arm/unsigned-float.c: New.\n\nFrom-SVN: r222143", "tree": {"sha": "debf7a214288565fe0e545f930bf1ce2b7acbee0", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/debf7a214288565fe0e545f930bf1ce2b7acbee0"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/76978b21c6b7a3b9569c43bae4709b5e0cc5f653", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/76978b21c6b7a3b9569c43bae4709b5e0cc5f653", "html_url": "https://github.com/Rust-GCC/gccrs/commit/76978b21c6b7a3b9569c43bae4709b5e0cc5f653", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/76978b21c6b7a3b9569c43bae4709b5e0cc5f653/comments", "author": null, "committer": null, "parents": [{"sha": "72ed1126861875a4fae0d75f994e35f1b79509bd", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/72ed1126861875a4fae0d75f994e35f1b79509bd", "html_url": "https://github.com/Rust-GCC/gccrs/commit/72ed1126861875a4fae0d75f994e35f1b79509bd"}], "stats": {"total": 56, "additions": 52, "deletions": 4}, "files": [{"sha": "392f679614c3706eada5731f4986ebda17961efe", "filename": "gcc/ChangeLog", "status": "modified", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/76978b21c6b7a3b9569c43bae4709b5e0cc5f653/gcc%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/76978b21c6b7a3b9569c43bae4709b5e0cc5f653/gcc%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2FChangeLog?ref=76978b21c6b7a3b9569c43bae4709b5e0cc5f653", "patch": "@@ -1,3 +1,8 @@\n+2015-04-16  Renlin Li  <renlin.li@arm.com>\n+\n+\t* simplify-rtx.c (simplify_unary_operation_1): Fix a typo. Enable two\n+\tsimplifications for UNSIGNED_FLOAT.\n+\n 2015-04-16  Nick Clifton  <nickc@redhat.com>\n \n \t* config/rl78/rl78-opts.h (enum rl78_mul_types): Add MUL_G14 and"}, {"sha": "4b18d3c18c2ee9f965902b43ea58288b6f31d77d", "filename": "gcc/simplify-rtx.c", "status": "modified", "additions": 4, "deletions": 4, "changes": 8, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/76978b21c6b7a3b9569c43bae4709b5e0cc5f653/gcc%2Fsimplify-rtx.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/76978b21c6b7a3b9569c43bae4709b5e0cc5f653/gcc%2Fsimplify-rtx.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fsimplify-rtx.c?ref=76978b21c6b7a3b9569c43bae4709b5e0cc5f653", "patch": "@@ -1171,7 +1171,7 @@ simplify_unary_operation_1 (enum rtx_code code, machine_mode mode, rtx op)\n          = (float_truncate:SF foo:DF).\n \n          (float_truncate:DF (float_extend:XF foo:SF))\n-         = (float_extend:SF foo:DF).  */\n+         = (float_extend:DF foo:SF).  */\n       if ((GET_CODE (op) == FLOAT_TRUNCATE\n \t   && flag_unsafe_math_optimizations)\n \t  || GET_CODE (op) == FLOAT_EXTEND)\n@@ -1183,14 +1183,14 @@ simplify_unary_operation_1 (enum rtx_code code, machine_mode mode, rtx op)\n \t\t\t\t   XEXP (op, 0), mode);\n \n       /*  (float_truncate (float x)) is (float x)  */\n-      if (GET_CODE (op) == FLOAT\n+      if ((GET_CODE (op) == FLOAT || GET_CODE (op) == UNSIGNED_FLOAT)\n \t  && (flag_unsafe_math_optimizations\n \t      || (SCALAR_FLOAT_MODE_P (GET_MODE (op))\n \t\t  && ((unsigned)significand_size (GET_MODE (op))\n \t\t      >= (GET_MODE_PRECISION (GET_MODE (XEXP (op, 0)))\n \t\t\t  - num_sign_bit_copies (XEXP (op, 0),\n \t\t\t\t\t\t GET_MODE (XEXP (op, 0))))))))\n-\treturn simplify_gen_unary (FLOAT, mode,\n+\treturn simplify_gen_unary (GET_CODE (op), mode,\n \t\t\t\t   XEXP (op, 0),\n \t\t\t\t   GET_MODE (XEXP (op, 0)));\n \n@@ -1221,7 +1221,7 @@ simplify_unary_operation_1 (enum rtx_code code, machine_mode mode, rtx op)\n \t  rounding can't happen.\n           */\n       if (GET_CODE (op) == FLOAT_EXTEND\n-\t  || (GET_CODE (op) == FLOAT\n+\t  || ((GET_CODE (op) == FLOAT || GET_CODE (op) == UNSIGNED_FLOAT)\n \t      && SCALAR_FLOAT_MODE_P (GET_MODE (op))\n \t      && ((unsigned)significand_size (GET_MODE (op))\n \t\t  >= (GET_MODE_PRECISION (GET_MODE (XEXP (op, 0)))"}, {"sha": "f8e227965ebd544faf037142d9e2a5f820388dd8", "filename": "gcc/testsuite/ChangeLog", "status": "modified", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/76978b21c6b7a3b9569c43bae4709b5e0cc5f653/gcc%2Ftestsuite%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/76978b21c6b7a3b9569c43bae4709b5e0cc5f653/gcc%2Ftestsuite%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2FChangeLog?ref=76978b21c6b7a3b9569c43bae4709b5e0cc5f653", "patch": "@@ -1,3 +1,8 @@\n+2015-04-16  Renlin Li  <renlin.li@arm.com>\n+\n+\t* gcc.target/aarch64/unsigned-unsignedfloat.c: New.\n+\t* gcc.target/arm/unsigned-float.c: New.\n+\n 2015-04-16  Richard Biener  <rguenther@suse.de>\n \n \t* gcc.dg/tree-ssa/ssa-ccp-36.c: New testcase."}, {"sha": "c5ad6805d94cf079be437979e8171a7f01594e6a", "filename": "gcc/testsuite/gcc.target/aarch64/unsigned-float.c", "status": "added", "additions": 18, "deletions": 0, "changes": 18, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/76978b21c6b7a3b9569c43bae4709b5e0cc5f653/gcc%2Ftestsuite%2Fgcc.target%2Faarch64%2Funsigned-float.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/76978b21c6b7a3b9569c43bae4709b5e0cc5f653/gcc%2Ftestsuite%2Fgcc.target%2Faarch64%2Funsigned-float.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgcc.target%2Faarch64%2Funsigned-float.c?ref=76978b21c6b7a3b9569c43bae4709b5e0cc5f653", "patch": "@@ -0,0 +1,18 @@\n+/* { dg-do compile } */\n+/* { dg-options \"-O1\" } */\n+\n+#include <stdint.h>\n+\n+double\n+f1 (uint16_t x)\n+{\n+  return (double)(float)x;\n+}\n+\n+float\n+f2 (uint16_t x)\n+{\n+  return (float)(double)x;\n+}\n+\n+/* { dg-final { scan-assembler-not \"fcvt\" } } */"}, {"sha": "bb05c85c63cf9672585ce272f629e49f533a7014", "filename": "gcc/testsuite/gcc.target/arm/unsigned-float.c", "status": "added", "additions": 20, "deletions": 0, "changes": 20, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/76978b21c6b7a3b9569c43bae4709b5e0cc5f653/gcc%2Ftestsuite%2Fgcc.target%2Farm%2Funsigned-float.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/76978b21c6b7a3b9569c43bae4709b5e0cc5f653/gcc%2Ftestsuite%2Fgcc.target%2Farm%2Funsigned-float.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgcc.target%2Farm%2Funsigned-float.c?ref=76978b21c6b7a3b9569c43bae4709b5e0cc5f653", "patch": "@@ -0,0 +1,20 @@\n+/* { dg-do compile } */\n+/* { dg-require-effective-target arm_vfp_ok } */\n+/* { dg-options \"-march=armv7-a -O1 -mfloat-abi=softfp\" } */\n+/* { dg-skip-if \"need fp instructions\" { *-*-* } { \"-mfloat-abi=soft\" } { \"\" } } */\n+\n+#include <stdint.h>\n+\n+double\n+f1 (uint16_t x)\n+{\n+  return (double)(float)x;\n+}\n+\n+float\n+f2 (uint16_t x)\n+{\n+  return (float)(double)x;\n+}\n+\n+/* { dg-final { scan-assembler-not \"vcvt.(f32.f64|f64.f32)\" } } */"}]}