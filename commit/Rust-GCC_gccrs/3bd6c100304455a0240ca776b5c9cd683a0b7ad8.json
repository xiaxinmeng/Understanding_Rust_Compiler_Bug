{"sha": "3bd6c100304455a0240ca776b5c9cd683a0b7ad8", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6M2JkNmMxMDAzMDQ0NTVhMDI0MGNhNzc2YjVjOWNkNjgzYTBiN2FkOA==", "commit": {"author": {"name": "Ed Schonberg", "email": "schonber@gnat.com", "date": "2001-12-03T18:56:11Z"}, "committer": {"name": "Geert Bosch", "email": "bosch@gcc.gnu.org", "date": "2001-12-03T18:56:11Z"}, "message": "* sem_ch12.adb:\n\n\t(Analyze_generic_subprogram_Declaration): Set outer_generic_scope,\n\tto prevent freezing within formal packages.\n\t(Freeze_Subprogram_Body): If body comes from another instance that\n\tappeared before its own body, place freeze node at end of current\n\tdeclarative part, to prevent a back-end crash.\n\t(Inline_Instance_Body): Handle properly a package instance within\n\ta subprogram instance that is a child unit.\n\nFrom-SVN: r47555", "tree": {"sha": "817c077e4fc55a97321d2b68eb17c09381b5affd", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/817c077e4fc55a97321d2b68eb17c09381b5affd"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/3bd6c100304455a0240ca776b5c9cd683a0b7ad8", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/3bd6c100304455a0240ca776b5c9cd683a0b7ad8", "html_url": "https://github.com/Rust-GCC/gccrs/commit/3bd6c100304455a0240ca776b5c9cd683a0b7ad8", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/3bd6c100304455a0240ca776b5c9cd683a0b7ad8/comments", "author": null, "committer": null, "parents": [{"sha": "52acbdcba982a18a35bb5309e6812b324f04da79", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/52acbdcba982a18a35bb5309e6812b324f04da79", "html_url": "https://github.com/Rust-GCC/gccrs/commit/52acbdcba982a18a35bb5309e6812b324f04da79"}], "stats": {"total": 30, "additions": 27, "deletions": 3}, "files": [{"sha": "d3acabecc2939910cc9b08c4e13682dcb934aeac", "filename": "gcc/ada/ChangeLog", "status": "modified", "additions": 11, "deletions": 0, "changes": 11, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/3bd6c100304455a0240ca776b5c9cd683a0b7ad8/gcc%2Fada%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/3bd6c100304455a0240ca776b5c9cd683a0b7ad8/gcc%2Fada%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fada%2FChangeLog?ref=3bd6c100304455a0240ca776b5c9cd683a0b7ad8", "patch": "@@ -1,3 +1,14 @@\n+2001-12-03  Ed Schonberg <schonber@gnat.com>\n+\n+\t* sem_ch12.adb:\n+\t(Analyze_generic_subprogram_Declaration): Set outer_generic_scope,\n+\tto prevent freezing within formal packages.\n+\t(Freeze_Subprogram_Body): If body comes from another instance that\n+\tappeared before its own body, place freeze node at end of current\n+\tdeclarative part, to prevent a back-end crash.\n+\t(Inline_Instance_Body): Handle properly a package instance within\n+\ta subprogram instance that is a child unit.\n+\n 2001-12-01  Graham Stott  <grahams@redhat.com>\n \n \t* Makefile.in (misc.o): Add missing $(srcdir) prefix"}, {"sha": "20af910b814c4842802e2dae42523e64f0bdf7bc", "filename": "gcc/ada/sem_ch12.adb", "status": "modified", "additions": 16, "deletions": 3, "changes": 19, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/3bd6c100304455a0240ca776b5c9cd683a0b7ad8/gcc%2Fada%2Fsem_ch12.adb", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/3bd6c100304455a0240ca776b5c9cd683a0b7ad8/gcc%2Fada%2Fsem_ch12.adb", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fada%2Fsem_ch12.adb?ref=3bd6c100304455a0240ca776b5c9cd683a0b7ad8", "patch": "@@ -2061,7 +2061,9 @@ package body Sem_Ch12 is\n \n       Enter_Name (Id);\n \n+      Set_Scope_Depth_Value (Id, Scope_Depth (Current_Scope) + 1);\n       New_Scope (Id);\n+      Enter_Generic_Scope (Id);\n       Set_Inner_Instances (Id, New_Elmt_List);\n       Set_Is_Pure (Id, Is_Pure (Current_Scope));\n \n@@ -2099,6 +2101,7 @@ package body Sem_Ch12 is\n \n       End_Generic;\n       End_Scope;\n+      Exit_Generic_Scope (Id);\n \n    end Analyze_Generic_Subprogram_Declaration;\n \n@@ -2715,7 +2718,9 @@ package body Sem_Ch12 is\n            and then S /= Standard_Standard\n          loop\n             exit when Is_Generic_Instance (S)\n-                 and then In_Package_Body (S);\n+                 and then (In_Package_Body (S)\n+                            or else Ekind (S) = E_Procedure\n+                            or else Ekind (S) = E_Function);\n \n             if S = Curr_Unit\n               or else (Ekind (Curr_Unit) = E_Package_Body\n@@ -2725,7 +2730,7 @@ package body Sem_Ch12 is\n \n                if Is_Child_Unit (S) then\n                   --  Remove child unit from stack, as well as inner scopes.\n-                  --  Removing its context of child unit will remove parent\n+                  --  Removing the context of a child unit removes parent\n                   --  units as well.\n \n                   while Current_Scope /= S loop\n@@ -5020,7 +5025,15 @@ package body Sem_Ch12 is\n         and then\n           In_Same_Declarative_Part (Freeze_Node (Par), Inst_Node)\n       then\n-         Insert_After (Freeze_Node (Par), F_Node);\n+         if ABE_Is_Certain (Get_Package_Instantiation_Node (Par)) then\n+            --  The parent was a premature instantiation. Insert freeze\n+            --  node at the end the current declarative part.\n+\n+            Insert_After_Last_Decl (Inst_Node, F_Node);\n+\n+         else\n+            Insert_After (Freeze_Node (Par), F_Node);\n+         end if;\n \n       --  The body enclosing the instance should be frozen after the body\n       --  that includes the generic, because the body of the instance may"}]}