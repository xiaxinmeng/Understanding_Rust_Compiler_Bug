{"sha": "f05816a5eedc0f19dc2f601918e7858d8182d504", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6ZjA1ODE2YTVlZWRjMGYxOWRjMmY2MDE5MThlNzg1OGQ4MTgyZDUwNA==", "commit": {"author": {"name": "Loren J. Rittle", "email": "ljrittle@acm.org", "date": "2009-09-01T18:13:18Z"}, "committer": {"name": "Loren J. Rittle", "email": "ljrittle@gcc.gnu.org", "date": "2009-09-01T18:13:18Z"}, "message": "mf-runtime.c (__mf_init): Support FreeBSD.\n\n2009-09-01  Loren J. Rittle  <ljrittle@acm.org>\n\n\t* mf-runtime.c (__mf_init): Support FreeBSD.\n\tPrime mutex which calls calloc upon first lock to avoid deadlock.\n\t* mf-hooks1.c (__mf_0fn_mmap): Support FreeBSD.\n\tIgnore red zone allocation request for initial thread's stack.\n\nFrom-SVN: r151278", "tree": {"sha": "8209ef794f609d9633cb0454279034f2a39a2e45", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/8209ef794f609d9633cb0454279034f2a39a2e45"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/f05816a5eedc0f19dc2f601918e7858d8182d504", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/f05816a5eedc0f19dc2f601918e7858d8182d504", "html_url": "https://github.com/Rust-GCC/gccrs/commit/f05816a5eedc0f19dc2f601918e7858d8182d504", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/f05816a5eedc0f19dc2f601918e7858d8182d504/comments", "author": null, "committer": null, "parents": [{"sha": "ab4daaf234846814efda577812e8e42be5a40995", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/ab4daaf234846814efda577812e8e42be5a40995", "html_url": "https://github.com/Rust-GCC/gccrs/commit/ab4daaf234846814efda577812e8e42be5a40995"}], "stats": {"total": 18, "additions": 18, "deletions": 0}, "files": [{"sha": "e51c109bbac6800baec62371370229eff559a585", "filename": "libmudflap/ChangeLog", "status": "modified", "additions": 7, "deletions": 0, "changes": 7, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/f05816a5eedc0f19dc2f601918e7858d8182d504/libmudflap%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/f05816a5eedc0f19dc2f601918e7858d8182d504/libmudflap%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libmudflap%2FChangeLog?ref=f05816a5eedc0f19dc2f601918e7858d8182d504", "patch": "@@ -1,3 +1,10 @@\n+2009-09-01  Loren J. Rittle  <ljrittle@acm.org>\n+\n+\t* mf-runtime.c (__mf_init): Support FreeBSD.\n+\tPrime mutex which calls calloc upon first lock to avoid deadlock.\n+\t* mf-hooks1.c (__mf_0fn_mmap): Support FreeBSD.\n+\tIgnore red zone allocation request for initial thread's stack.\n+\n 2009-09-01  Loren J. Rittle  <ljrittle@acm.org>\n \t    Andreas Schwab  <schwab@linux-m68k.org>\n "}, {"sha": "1e46a650947f759c7e16ebec64c587c750afae65", "filename": "libmudflap/mf-hooks1.c", "status": "modified", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/f05816a5eedc0f19dc2f601918e7858d8182d504/libmudflap%2Fmf-hooks1.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/f05816a5eedc0f19dc2f601918e7858d8182d504/libmudflap%2Fmf-hooks1.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libmudflap%2Fmf-hooks1.c?ref=f05816a5eedc0f19dc2f601918e7858d8182d504", "patch": "@@ -321,6 +321,11 @@ WRAPPER(void, free, void *buf)\n void *\n __mf_0fn_mmap (void *start, size_t l, int prot, int f, int fd, off_t off)\n {\n+#if defined(__FreeBSD__)\n+  if (f == 0x1000 && fd == -1 && prot == 0 && off == 0)\n+    return 0;\n+#endif /* Ignore red zone allocation request for initial thread's stack. */\n+\n   return (void *) -1;\n }\n #endif"}, {"sha": "3bfaf02b6a0870b52aea48fb15606015b6255228", "filename": "libmudflap/mf-runtime.c", "status": "modified", "additions": 6, "deletions": 0, "changes": 6, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/f05816a5eedc0f19dc2f601918e7858d8182d504/libmudflap%2Fmf-runtime.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/f05816a5eedc0f19dc2f601918e7858d8182d504/libmudflap%2Fmf-runtime.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libmudflap%2Fmf-runtime.c?ref=f05816a5eedc0f19dc2f601918e7858d8182d504", "patch": "@@ -695,6 +695,12 @@ __mf_init ()\n   if (LIKELY (__mf_starting_p == 0))\n     return;\n \n+#if defined(__FreeBSD__) && defined(LIBMUDFLAPTH)\n+  pthread_self();\n+  LOCKTH ();\n+  UNLOCKTH ();\n+#endif /* Prime mutex which calls calloc upon first lock to avoid deadlock. */\n+\n   /* This initial bootstrap phase requires that __mf_starting_p = 1. */\n #ifdef PIC\n   __mf_resolve_dynamics ();"}]}