{"sha": "474e0129ac2e906caa667eb7a9a7682afeec41aa", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6NDc0ZTAxMjlhYzJlOTA2Y2FhNjY3ZWI3YTlhNzY4MmFmZWVjNDFhYQ==", "commit": {"author": {"name": "David Malcolm", "email": "dmalcolm@redhat.com", "date": "2016-05-02T18:36:40Z"}, "committer": {"name": "David Malcolm", "email": "dmalcolm@gcc.gnu.org", "date": "2016-05-02T18:36:40Z"}, "message": "PR c++/62314: add fixit hint for missing \"template <> \" in explicit specialization\n\ngcc/cp/ChangeLog:\n\tPR c++/62314\n\t* parser.c (cp_parser_class_head): Capture the start location;\n\tuse it to emit a fix-it insertion hint when complaining\n\tabout missing \"template <> \" in explicit specializations.\n\ngcc/testsuite/ChangeLog:\n\tPR c++/62314\n\t* g++.dg/pr62314.C: New test case.\n\nFrom-SVN: r235777", "tree": {"sha": "8d26fa504b2e7220ab6773ed0be0b990af6b247d", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/8d26fa504b2e7220ab6773ed0be0b990af6b247d"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/474e0129ac2e906caa667eb7a9a7682afeec41aa", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/474e0129ac2e906caa667eb7a9a7682afeec41aa", "html_url": "https://github.com/Rust-GCC/gccrs/commit/474e0129ac2e906caa667eb7a9a7682afeec41aa", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/474e0129ac2e906caa667eb7a9a7682afeec41aa/comments", "author": {"login": "davidmalcolm", "id": 1553248, "node_id": "MDQ6VXNlcjE1NTMyNDg=", "avatar_url": "https://avatars.githubusercontent.com/u/1553248?v=4", "gravatar_id": "", "url": "https://api.github.com/users/davidmalcolm", "html_url": "https://github.com/davidmalcolm", "followers_url": "https://api.github.com/users/davidmalcolm/followers", "following_url": "https://api.github.com/users/davidmalcolm/following{/other_user}", "gists_url": "https://api.github.com/users/davidmalcolm/gists{/gist_id}", "starred_url": "https://api.github.com/users/davidmalcolm/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/davidmalcolm/subscriptions", "organizations_url": "https://api.github.com/users/davidmalcolm/orgs", "repos_url": "https://api.github.com/users/davidmalcolm/repos", "events_url": "https://api.github.com/users/davidmalcolm/events{/privacy}", "received_events_url": "https://api.github.com/users/davidmalcolm/received_events", "type": "User", "site_admin": false}, "committer": null, "parents": [{"sha": "4877b5a4ac000f13c9e167710d1b060eff5764f4", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/4877b5a4ac000f13c9e167710d1b060eff5764f4", "html_url": "https://github.com/Rust-GCC/gccrs/commit/4877b5a4ac000f13c9e167710d1b060eff5764f4"}], "stats": {"total": 47, "additions": 45, "deletions": 2}, "files": [{"sha": "18292e2a7929254f87c0f3fcf54a286ae3135ca2", "filename": "gcc/cp/ChangeLog", "status": "modified", "additions": 7, "deletions": 0, "changes": 7, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/474e0129ac2e906caa667eb7a9a7682afeec41aa/gcc%2Fcp%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/474e0129ac2e906caa667eb7a9a7682afeec41aa/gcc%2Fcp%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fcp%2FChangeLog?ref=474e0129ac2e906caa667eb7a9a7682afeec41aa", "patch": "@@ -1,3 +1,10 @@\n+2016-05-02  David Malcolm  <dmalcolm@redhat.com>\n+\n+\tPR c++/62314\n+\t* parser.c (cp_parser_class_head): Capture the start location;\n+\tuse it to emit a fix-it insertion hint when complaining\n+\tabout missing \"template <> \" in explicit specializations.\n+\n 2016-05-02  Richard Sandiford  <richard.sandiford@arm.com>\n \n \t* init.c (build_new_1): Use shift operators instead of wi:: shifts."}, {"sha": "667ed97cbec657e62f82af277f058fe59dad3c7a", "filename": "gcc/cp/parser.c", "status": "modified", "additions": 16, "deletions": 2, "changes": 18, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/474e0129ac2e906caa667eb7a9a7682afeec41aa/gcc%2Fcp%2Fparser.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/474e0129ac2e906caa667eb7a9a7682afeec41aa/gcc%2Fcp%2Fparser.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fcp%2Fparser.c?ref=474e0129ac2e906caa667eb7a9a7682afeec41aa", "patch": "@@ -21656,6 +21656,8 @@ cp_parser_class_head (cp_parser* parser,\n   if (class_key == none_type)\n     return error_mark_node;\n \n+  location_t class_head_start_location = input_location;\n+\n   /* Parse the attributes.  */\n   attributes = cp_parser_attributes_opt (parser);\n \n@@ -21872,8 +21874,20 @@ cp_parser_class_head (cp_parser* parser,\n       && parser->num_template_parameter_lists == 0\n       && template_id_p)\n     {\n-      error_at (type_start_token->location,\n-\t\t\"an explicit specialization must be preceded by %<template <>%>\");\n+      /* Build a location of this form:\n+           struct typename <ARGS>\n+           ^~~~~~~~~~~~~~~~~~~~~~\n+         with caret==start at the start token, and\n+         finishing at the end of the type.  */\n+      location_t reported_loc\n+        = make_location (class_head_start_location,\n+                         class_head_start_location,\n+                         get_finish (type_start_token->location));\n+      rich_location richloc (line_table, reported_loc);\n+      richloc.add_fixit_insert (class_head_start_location, \"template <> \");\n+      error_at_rich_loc\n+        (&richloc,\n+         \"an explicit specialization must be preceded by %<template <>%>\");\n       invalid_explicit_specialization_p = true;\n       /* Take the same action that would have been taken by\n \t cp_parser_explicit_specialization.  */"}, {"sha": "f8baf2285a13e1f0f311dd149a800eed293d4fc4", "filename": "gcc/testsuite/ChangeLog", "status": "modified", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/474e0129ac2e906caa667eb7a9a7682afeec41aa/gcc%2Ftestsuite%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/474e0129ac2e906caa667eb7a9a7682afeec41aa/gcc%2Ftestsuite%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2FChangeLog?ref=474e0129ac2e906caa667eb7a9a7682afeec41aa", "patch": "@@ -1,3 +1,8 @@\n+2016-05-02  David Malcolm  <dmalcolm@redhat.com>\n+\n+\tPR c++/62314\n+\t* g++.dg/pr62314.C: New test case.\n+\n 2016-05-02  Jan Hubicka  <hubicka@ucw.cz>\n \n \t* gcc.dg/ipa/inline-8.c: New testcase."}, {"sha": "ebe75ecd705d77a1e29129ea65946734d72f28fd", "filename": "gcc/testsuite/g++.dg/pr62314.C", "status": "added", "additions": 17, "deletions": 0, "changes": 17, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/474e0129ac2e906caa667eb7a9a7682afeec41aa/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Fpr62314.C", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/474e0129ac2e906caa667eb7a9a7682afeec41aa/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Fpr62314.C", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Fpr62314.C?ref=474e0129ac2e906caa667eb7a9a7682afeec41aa", "patch": "@@ -0,0 +1,17 @@\n+// { dg-options \"-fdiagnostics-show-caret\" }\n+\n+template <typename T>\n+struct iterator_traits {};\n+\n+struct file_iterator;\n+\n+struct iterator_traits<file_iterator> { // { dg-error \"explicit specialization must be preceded by .template\" }\n+};\n+\n+/* Verify that we emit a fixit hint for this case.  */\n+\n+/* { dg-begin-multiline-output \"\" }\n+ struct iterator_traits<file_iterator>\n+ ^~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~\n+ template <> \n+   { dg-end-multiline-output \"\" } */"}]}