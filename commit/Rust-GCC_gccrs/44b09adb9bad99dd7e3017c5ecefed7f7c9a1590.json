{"sha": "44b09adb9bad99dd7e3017c5ecefed7f7c9a1590", "node_id": "C_kwDOANBUbNoAKDQ0YjA5YWRiOWJhZDk5ZGQ3ZTMwMTdjNWVjZWZlZDdmN2M5YTE1OTA", "commit": {"author": {"name": "Richard Biener", "email": "rguenther@suse.de", "date": "2022-04-29T06:45:48Z"}, "committer": {"name": "Richard Biener", "email": "rguenther@suse.de", "date": "2022-04-29T09:10:24Z"}, "message": "tree-optimization/105431 - another overflow in powi handling\n\nThis avoids undefined signed overflow when calling powi_as_mults_1.\n\n2022-04-29  Richard Biener  <rguenther@suse.de>\n\n\tPR tree-optimization/105431\n\t* tree-ssa-math-opts.cc (powi_as_mults_1): Make n unsigned.\n\t(powi_as_mults): Use absu_hwi.\n\t(gimple_expand_builtin_powi): Remove now pointless n != -n\n\tcheck.", "tree": {"sha": "9f49abe44279c9265b38ccabaa433bb93fe96702", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/9f49abe44279c9265b38ccabaa433bb93fe96702"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/44b09adb9bad99dd7e3017c5ecefed7f7c9a1590", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/44b09adb9bad99dd7e3017c5ecefed7f7c9a1590", "html_url": "https://github.com/Rust-GCC/gccrs/commit/44b09adb9bad99dd7e3017c5ecefed7f7c9a1590", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/44b09adb9bad99dd7e3017c5ecefed7f7c9a1590/comments", "author": {"login": "rguenth", "id": 2046526, "node_id": "MDQ6VXNlcjIwNDY1MjY=", "avatar_url": "https://avatars.githubusercontent.com/u/2046526?v=4", "gravatar_id": "", "url": "https://api.github.com/users/rguenth", "html_url": "https://github.com/rguenth", "followers_url": "https://api.github.com/users/rguenth/followers", "following_url": "https://api.github.com/users/rguenth/following{/other_user}", "gists_url": "https://api.github.com/users/rguenth/gists{/gist_id}", "starred_url": "https://api.github.com/users/rguenth/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/rguenth/subscriptions", "organizations_url": "https://api.github.com/users/rguenth/orgs", "repos_url": "https://api.github.com/users/rguenth/repos", "events_url": "https://api.github.com/users/rguenth/events{/privacy}", "received_events_url": "https://api.github.com/users/rguenth/received_events", "type": "User", "site_admin": false}, "committer": {"login": "rguenth", "id": 2046526, "node_id": "MDQ6VXNlcjIwNDY1MjY=", "avatar_url": "https://avatars.githubusercontent.com/u/2046526?v=4", "gravatar_id": "", "url": "https://api.github.com/users/rguenth", "html_url": "https://github.com/rguenth", "followers_url": "https://api.github.com/users/rguenth/followers", "following_url": "https://api.github.com/users/rguenth/following{/other_user}", "gists_url": "https://api.github.com/users/rguenth/gists{/gist_id}", "starred_url": "https://api.github.com/users/rguenth/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/rguenth/subscriptions", "organizations_url": "https://api.github.com/users/rguenth/orgs", "repos_url": "https://api.github.com/users/rguenth/repos", "events_url": "https://api.github.com/users/rguenth/events{/privacy}", "received_events_url": "https://api.github.com/users/rguenth/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "9eb38e88ce8003c0b852144da3c265b6785ede3c", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/9eb38e88ce8003c0b852144da3c265b6785ede3c", "html_url": "https://github.com/Rust-GCC/gccrs/commit/9eb38e88ce8003c0b852144da3c265b6785ede3c"}], "stats": {"total": 12, "additions": 5, "deletions": 7}, "files": [{"sha": "2085597447ef9956491feb5376ebeb3c0369898b", "filename": "gcc/tree-ssa-math-opts.cc", "status": "modified", "additions": 5, "deletions": 7, "changes": 12, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/44b09adb9bad99dd7e3017c5ecefed7f7c9a1590/gcc%2Ftree-ssa-math-opts.cc", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/44b09adb9bad99dd7e3017c5ecefed7f7c9a1590/gcc%2Ftree-ssa-math-opts.cc", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftree-ssa-math-opts.cc?ref=44b09adb9bad99dd7e3017c5ecefed7f7c9a1590", "patch": "@@ -1495,7 +1495,7 @@ powi_cost (HOST_WIDE_INT n)\n \n static tree\n powi_as_mults_1 (gimple_stmt_iterator *gsi, location_t loc, tree type,\n-\t\t HOST_WIDE_INT n, tree *cache)\n+\t\t unsigned HOST_WIDE_INT n, tree *cache)\n {\n   tree op0, op1, ssa_target;\n   unsigned HOST_WIDE_INT digit;\n@@ -1548,7 +1548,7 @@ powi_as_mults (gimple_stmt_iterator *gsi, location_t loc,\n   memset (cache, 0, sizeof (cache));\n   cache[1] = arg0;\n \n-  result = powi_as_mults_1 (gsi, loc, type, (n < 0) ? -n : n, cache);\n+  result = powi_as_mults_1 (gsi, loc, type, absu_hwi (n), cache);\n   if (n >= 0)\n     return result;\n \n@@ -1572,11 +1572,9 @@ static tree\n gimple_expand_builtin_powi (gimple_stmt_iterator *gsi, location_t loc, \n \t\t\t    tree arg0, HOST_WIDE_INT n)\n {\n-  /* Avoid largest negative number.  */\n-  if (n != -n\n-      && ((n >= -1 && n <= 2)\n-\t  || (optimize_function_for_speed_p (cfun)\n-\t      && powi_cost (n) <= POWI_MAX_MULTS)))\n+  if ((n >= -1 && n <= 2)\n+      || (optimize_function_for_speed_p (cfun)\n+\t  && powi_cost (n) <= POWI_MAX_MULTS))\n     return powi_as_mults (gsi, loc, arg0, n);\n \n   return NULL_TREE;"}]}