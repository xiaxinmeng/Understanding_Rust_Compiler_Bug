{"sha": "2c4389d869152d94510dd52de9382c22d196d4ed", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6MmM0Mzg5ZDg2OTE1MmQ5NDUxMGRkNTJkZTkzODJjMjJkMTk2ZDRlZA==", "commit": {"author": {"name": "Uros Bizjak", "email": "ubizjak@gmail.com", "date": "2009-08-05T14:41:54Z"}, "committer": {"name": "Uros Bizjak", "email": "uros@gcc.gnu.org", "date": "2009-08-05T14:41:54Z"}, "message": "re PR target/40906 (Wrong code generated for push of long double)\n\n\tPR target/40906\n\t* config/i386/i386.c (ix86_split_long_move): Fix push of multi-part\n\tsource operand.\n\ntestsuite/ChangeLog:\n\n\tPR target/40906\n\t* gcc.target/i386/pr40906-1.c: New test.\n\t* gcc.target/i386/pr40906-2.c: Ditto.\n\t* gcc.target/i386/pr40906-3.c: Ditto.\n\n\nCo-Authored-By: Mikulas Patocka <mikulas@artax.karlin.mff.cuni.cz>\n\nFrom-SVN: r150486", "tree": {"sha": "a9533d423017e5d47fab676ef1ee7b0a66b1ecbb", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/a9533d423017e5d47fab676ef1ee7b0a66b1ecbb"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/2c4389d869152d94510dd52de9382c22d196d4ed", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/2c4389d869152d94510dd52de9382c22d196d4ed", "html_url": "https://github.com/Rust-GCC/gccrs/commit/2c4389d869152d94510dd52de9382c22d196d4ed", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/2c4389d869152d94510dd52de9382c22d196d4ed/comments", "author": {"login": "ubizjak", "id": 55479990, "node_id": "MDQ6VXNlcjU1NDc5OTkw", "avatar_url": "https://avatars.githubusercontent.com/u/55479990?v=4", "gravatar_id": "", "url": "https://api.github.com/users/ubizjak", "html_url": "https://github.com/ubizjak", "followers_url": "https://api.github.com/users/ubizjak/followers", "following_url": "https://api.github.com/users/ubizjak/following{/other_user}", "gists_url": "https://api.github.com/users/ubizjak/gists{/gist_id}", "starred_url": "https://api.github.com/users/ubizjak/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/ubizjak/subscriptions", "organizations_url": "https://api.github.com/users/ubizjak/orgs", "repos_url": "https://api.github.com/users/ubizjak/repos", "events_url": "https://api.github.com/users/ubizjak/events{/privacy}", "received_events_url": "https://api.github.com/users/ubizjak/received_events", "type": "User", "site_admin": false}, "committer": null, "parents": [{"sha": "403c752036db9af05c6d40804df668d3f3cbaf52", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/403c752036db9af05c6d40804df668d3f3cbaf52", "html_url": "https://github.com/Rust-GCC/gccrs/commit/403c752036db9af05c6d40804df668d3f3cbaf52"}], "stats": {"total": 113, "additions": 108, "deletions": 5}, "files": [{"sha": "42dc4316b4b246d828d16483c2e288a3f15a5ab8", "filename": "gcc/ChangeLog", "status": "modified", "additions": 7, "deletions": 0, "changes": 7, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/2c4389d869152d94510dd52de9382c22d196d4ed/gcc%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/2c4389d869152d94510dd52de9382c22d196d4ed/gcc%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2FChangeLog?ref=2c4389d869152d94510dd52de9382c22d196d4ed", "patch": "@@ -1,3 +1,10 @@\n+2009-08-05  Uros Bizjak  <ubizjak@gmail.com>\n+\t    Mikulas Patocka  <mikulas@artax.karlin.mff.cuni.cz>\n+\n+\tPR target/40906\n+\t* config/i386/i386.c (ix86_split_long_move): Fix push of multi-part\n+\tsource operand.\n+\n 2009-08-05  Jakub Jelinek  <jakub@redhat.com>\n \n \tPR rtl-optimization/40924"}, {"sha": "d0a8ba65f760b0746215f6f570d84af84c0eb8ae", "filename": "gcc/config/i386/i386.c", "status": "modified", "additions": 16, "deletions": 5, "changes": 21, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/2c4389d869152d94510dd52de9382c22d196d4ed/gcc%2Fconfig%2Fi386%2Fi386.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/2c4389d869152d94510dd52de9382c22d196d4ed/gcc%2Fconfig%2Fi386%2Fi386.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fconfig%2Fi386%2Fi386.c?ref=2c4389d869152d94510dd52de9382c22d196d4ed", "patch": "@@ -16764,10 +16764,20 @@ ix86_split_long_move (rtx operands[])\n   /* When emitting push, take care for source operands on the stack.  */\n   if (push && MEM_P (operands[1])\n       && reg_overlap_mentioned_p (stack_pointer_rtx, operands[1]))\n-    for (i = 0; i < nparts - 1; i++)\n-      part[1][i] = change_address (part[1][i],\n-\t\t\t\t   GET_MODE (part[1][i]),\n-\t\t\t\t   XEXP (part[1][i + 1], 0));\n+    {\n+      rtx src_base = XEXP (part[1][nparts - 1], 0);\n+\n+      /* Compensate for the stack decrement by 4.  */\n+      if (!TARGET_64BIT && nparts == 3\n+\t  && mode == XFmode && TARGET_128BIT_LONG_DOUBLE)\n+\tsrc_base = plus_constant (src_base, 4);\n+\n+      /* src_base refers to the stack pointer and is\n+\t automatically decreased by emitted push.  */\n+      for (i = 0; i < nparts; i++)\n+\tpart[1][i] = change_address (part[1][i],\n+\t\t\t\t     GET_MODE (part[1][i]), src_base);\n+    }\n \n   /* We need to do copy in the right order in case an address register\n      of the source overlaps the destination.  */\n@@ -16837,7 +16847,8 @@ ix86_split_long_move (rtx operands[])\n \t  if (nparts == 3)\n \t    {\n \t      if (TARGET_128BIT_LONG_DOUBLE && mode == XFmode)\n-                emit_insn (gen_addsi3 (stack_pointer_rtx, stack_pointer_rtx, GEN_INT (-4)));\n+                emit_insn (gen_addsi3 (stack_pointer_rtx,\n+\t\t\t\t       stack_pointer_rtx, GEN_INT (-4)));\n \t      emit_move_insn (part[0][2], part[1][2]);\n \t    }\n \t  else if (nparts == 4)"}, {"sha": "050d1dfda48913f6a288797fd1419bd0f61a8ba4", "filename": "gcc/testsuite/ChangeLog", "status": "modified", "additions": 8, "deletions": 0, "changes": 8, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/2c4389d869152d94510dd52de9382c22d196d4ed/gcc%2Ftestsuite%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/2c4389d869152d94510dd52de9382c22d196d4ed/gcc%2Ftestsuite%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2FChangeLog?ref=2c4389d869152d94510dd52de9382c22d196d4ed", "patch": "@@ -1,3 +1,11 @@\n+2009-08-05  Uros Bizjak  <ubizjak@gmail.com>\n+\t    Mikulas Patocka  <mikulas@artax.karlin.mff.cuni.cz>\n+\n+\tPR target/40906\n+\t* gcc.target/i386/pr40906-1.c: New test.\n+\t* gcc.target/i386/pr40906-2.c: Ditto.\n+\t* gcc.target/i386/pr40906-3.c: Ditto.\n+\n 2009-08-05  Jakub Jelinek  <jakub@redhat.com>\n \n \tPR rtl-optimization/40924"}, {"sha": "c14bbfa3a4fa3ff937d66a605992fd5d89215c56", "filename": "gcc/testsuite/gcc.target/i386/pr40906-1.c", "status": "added", "additions": 26, "deletions": 0, "changes": 26, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/2c4389d869152d94510dd52de9382c22d196d4ed/gcc%2Ftestsuite%2Fgcc.target%2Fi386%2Fpr40906-1.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/2c4389d869152d94510dd52de9382c22d196d4ed/gcc%2Ftestsuite%2Fgcc.target%2Fi386%2Fpr40906-1.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgcc.target%2Fi386%2Fpr40906-1.c?ref=2c4389d869152d94510dd52de9382c22d196d4ed", "patch": "@@ -0,0 +1,26 @@\n+/* { dg-do run } */\n+/* { dg-require-effective-target ilp32 } */\n+/* { dg-options \"-O2 -fomit-frame-pointer -mpush-args -mno-accumulate-outgoing-args\" } */\n+\n+void abort (void);\n+\n+void __attribute__((noinline))\n+f (long double a)\n+{\n+  if (a != 1.23L)\n+    abort ();\n+}\n+\n+int __attribute__((noinline))\n+g (long double b)\n+{\n+  f (b);\n+  return 0;\n+}\n+\n+int\n+main (void)\n+{\n+  g (1.23L);\n+  return 0;\n+}"}, {"sha": "66e146b0ca015077546f79ad05551510d018f88b", "filename": "gcc/testsuite/gcc.target/i386/pr40906-2.c", "status": "added", "additions": 26, "deletions": 0, "changes": 26, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/2c4389d869152d94510dd52de9382c22d196d4ed/gcc%2Ftestsuite%2Fgcc.target%2Fi386%2Fpr40906-2.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/2c4389d869152d94510dd52de9382c22d196d4ed/gcc%2Ftestsuite%2Fgcc.target%2Fi386%2Fpr40906-2.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgcc.target%2Fi386%2Fpr40906-2.c?ref=2c4389d869152d94510dd52de9382c22d196d4ed", "patch": "@@ -0,0 +1,26 @@\n+/* { dg-do run } */\n+/* { dg-require-effective-target ilp32 } */\n+/* { dg-options \"-O2 -fomit-frame-pointer -mpush-args -mno-accumulate-outgoing-args -m128bit-long-double\" } */\n+\n+void abort (void);\n+\n+void __attribute__((noinline))\n+f (long double a)\n+{\n+  if (a != 1.23L)\n+    abort ();\n+}\n+\n+int __attribute__((noinline))\n+g (long double b)\n+{\n+  f (b);\n+  return 0;\n+}\n+\n+int\n+main (void)\n+{\n+  g (1.23L);\n+  return 0;\n+}"}, {"sha": "f95308d108dc4fbb625f0b0eac1ef3522b7a826d", "filename": "gcc/testsuite/gcc.target/i386/pr40906-3.c", "status": "added", "additions": 25, "deletions": 0, "changes": 25, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/2c4389d869152d94510dd52de9382c22d196d4ed/gcc%2Ftestsuite%2Fgcc.target%2Fi386%2Fpr40906-3.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/2c4389d869152d94510dd52de9382c22d196d4ed/gcc%2Ftestsuite%2Fgcc.target%2Fi386%2Fpr40906-3.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgcc.target%2Fi386%2Fpr40906-3.c?ref=2c4389d869152d94510dd52de9382c22d196d4ed", "patch": "@@ -0,0 +1,25 @@\n+/* { dg-do run } */\n+/* { dg-require-effective-target ilp32 } */\n+/* { dg-options \"-O2 -fomit-frame-pointer -msse2 -mpush-args -mno-accumulate-outgoing-args\" } */\n+\n+#include \"sse2-check.h\"\n+\n+void __attribute__((noinline))\n+f (__float128 a)\n+{\n+  if (a != 1.23Q)\n+    abort ();\n+}\n+\n+int __attribute__((noinline))\n+g (__float128 b)\n+{\n+  f (b);\n+  return 0;\n+}\n+\n+static void\n+sse2_test (void)\n+{\n+  g (1.23Q);\n+}"}]}