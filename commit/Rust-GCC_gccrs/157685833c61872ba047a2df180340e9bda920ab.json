{"sha": "157685833c61872ba047a2df180340e9bda920ab", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6MTU3Njg1ODMzYzYxODcyYmEwNDdhMmRmMTgwMzQwZTliZGE5MjBhYg==", "commit": {"author": {"name": "John David Anglin", "email": "dave.anglin@nrc-cnrc.gc.ca", "date": "2011-09-03T16:21:27Z"}, "committer": {"name": "John David Anglin", "email": "danglin@gcc.gnu.org", "date": "2011-09-03T16:21:27Z"}, "message": "PR Bug middle-end/50232\n\n\tPR Bug middle-end/50232\n\t* config/pa/pa.md (return): Define \"return\" insn pattern.\n\t(epilogue): Use it when no epilogue is needed.\n\t* config/pa/pa.c (pa_can_use_return_insn): New function.\n\t* config/pa/pa-protos.h (pa_can_use_return_insn): Declare.\n\nFrom-SVN: r178500", "tree": {"sha": "3a6e1bbeb1e00c61eb841f9ceab6123262fced82", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/3a6e1bbeb1e00c61eb841f9ceab6123262fced82"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/157685833c61872ba047a2df180340e9bda920ab", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/157685833c61872ba047a2df180340e9bda920ab", "html_url": "https://github.com/Rust-GCC/gccrs/commit/157685833c61872ba047a2df180340e9bda920ab", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/157685833c61872ba047a2df180340e9bda920ab/comments", "author": null, "committer": null, "parents": [{"sha": "13868f4049616f5ac73bb89ce38474ada50ff28c", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/13868f4049616f5ac73bb89ce38474ada50ff28c", "html_url": "https://github.com/Rust-GCC/gccrs/commit/13868f4049616f5ac73bb89ce38474ada50ff28c"}], "stats": {"total": 48, "additions": 43, "deletions": 5}, "files": [{"sha": "a6d6f3bc3d47d17a05a56d076a860ed0ae3d58e6", "filename": "gcc/ChangeLog", "status": "modified", "additions": 8, "deletions": 0, "changes": 8, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/157685833c61872ba047a2df180340e9bda920ab/gcc%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/157685833c61872ba047a2df180340e9bda920ab/gcc%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2FChangeLog?ref=157685833c61872ba047a2df180340e9bda920ab", "patch": "@@ -1,3 +1,11 @@\n+2011-09-03  John David Anglin  <dave.anglin@nrc-cnrc.gc.ca>\n+\n+\tPR Bug middle-end/50232\n+\t* config/pa/pa.md (return): Define \"return\" insn pattern.\n+\t(epilogue): Use it when no epilogue is needed.\n+\t* config/pa/pa.c (pa_can_use_return_insn): New function.\n+\t* config/pa/pa-protos.h (pa_can_use_return_insn): Declare.\n+\n 2011-09-03  Eric Botcazou  <ebotcazou@adacore.com>\n \n \t* cfgexpand.c (add_stack_var): Assert that the alignment is not zero."}, {"sha": "8c733e4f6f4f126f633f56eecf6f8dd946670449", "filename": "gcc/config/pa/pa-protos.h", "status": "modified", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/157685833c61872ba047a2df180340e9bda920ab/gcc%2Fconfig%2Fpa%2Fpa-protos.h", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/157685833c61872ba047a2df180340e9bda920ab/gcc%2Fconfig%2Fpa%2Fpa-protos.h", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fconfig%2Fpa%2Fpa-protos.h?ref=157685833c61872ba047a2df180340e9bda920ab", "patch": "@@ -93,6 +93,7 @@ extern int and_mask_p (unsigned HOST_WIDE_INT);\n extern int cint_ok_for_move (HOST_WIDE_INT);\n extern void hppa_expand_prologue (void);\n extern void hppa_expand_epilogue (void);\n+extern bool pa_can_use_return_insn (void);\n extern int ior_mask_p (unsigned HOST_WIDE_INT);\n extern void compute_zdepdi_operands (unsigned HOST_WIDE_INT,\n \t\t\t\t     unsigned *);"}, {"sha": "e3ad4c80d89118942989bdc16d0e2a1756237b75", "filename": "gcc/config/pa/pa.c", "status": "modified", "additions": 18, "deletions": 0, "changes": 18, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/157685833c61872ba047a2df180340e9bda920ab/gcc%2Fconfig%2Fpa%2Fpa.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/157685833c61872ba047a2df180340e9bda920ab/gcc%2Fconfig%2Fpa%2Fpa.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fconfig%2Fpa%2Fpa.c?ref=157685833c61872ba047a2df180340e9bda920ab", "patch": "@@ -4329,6 +4329,24 @@ hppa_expand_epilogue (void)\n     }\n }\n \n+bool\n+pa_can_use_return_insn (void)\n+{\n+  if (!reload_completed)\n+    return false;\n+\n+  if (frame_pointer_needed)\n+    return false;\n+\n+  if (df_regs_ever_live_p (2))\n+    return false;\n+\n+  if (crtl->profile)\n+    return false;\n+\n+  return compute_frame_size (get_frame_size (), 0) == 0;\n+}\n+\n rtx\n hppa_pic_save_rtx (void)\n {"}, {"sha": "62369a5e2b5004f0d2c8ce7d4ba06e95c66208ef", "filename": "gcc/config/pa/pa.md", "status": "modified", "additions": 16, "deletions": 5, "changes": 21, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/157685833c61872ba047a2df180340e9bda920ab/gcc%2Fconfig%2Fpa%2Fpa.md", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/157685833c61872ba047a2df180340e9bda920ab/gcc%2Fconfig%2Fpa%2Fpa.md", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fconfig%2Fpa%2Fpa.md?ref=157685833c61872ba047a2df180340e9bda920ab", "patch": "@@ -6671,6 +6671,20 @@\n \f\n ;; Unconditional and other jump instructions.\n \n+;; Trivial return used when no epilogue is needed.\n+(define_insn \"return\"\n+  [(return)\n+   (use (reg:SI 2))]\n+  \"pa_can_use_return_insn ()\"\n+  \"*\n+{\n+  if (TARGET_PA_20)\n+    return \\\"bve%* (%%r2)\\\";\n+  return \\\"bv%* %%r0(%%r2)\\\";\n+}\"\n+  [(set_attr \"type\" \"branch\")\n+   (set_attr \"length\" \"4\")])\n+\n ;; This is used for most returns.\n (define_insn \"return_internal\"\n   [(return)\n@@ -6719,11 +6733,8 @@\n   rtx x;\n \n   /* Try to use the trivial return first.  Else use the full epilogue.  */\n-  if (reload_completed\n-      && !frame_pointer_needed\n-      && !df_regs_ever_live_p (2)\n-      && (compute_frame_size (get_frame_size (), 0) ? 0 : 1))\n-    x = gen_return_internal ();\n+  if (pa_can_use_return_insn ())\n+    x = gen_return ();\n   else\n     {\n       hppa_expand_epilogue ();"}]}