{"sha": "54674a35bd0a8d231ad314064d5f7bb8a60ef5df", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6NTQ2NzRhMzViZDBhOGQyMzFhZDMxNDA2NGQ1ZjdiYjhhNjBlZjVkZg==", "commit": {"author": {"name": "Paolo Carlini", "email": "paolo.carlini@oracle.com", "date": "2014-05-16T17:42:23Z"}, "committer": {"name": "Paolo Carlini", "email": "paolo@gcc.gnu.org", "date": "2014-05-16T17:42:23Z"}, "message": "re PR c++/51640 (Misleading error if the type in the catch() is ambiguous)\n\n/cp\n2014-05-16  Paolo Carlini  <paolo.carlini@oracle.com>\n\n\tPR c++/51640\n\t* parser.c (cp_parser_diagnose_invalid_type_name): Early return\n\twhen cp_parser_lookup_name sets ambiguous_decls.\n\n/testsuite\n2014-05-16  Paolo Carlini  <paolo.carlini@oracle.com>\n\n\tPR c++/51640\n\t* g++.dg/parse/error54.C: New.\n\nFrom-SVN: r210521", "tree": {"sha": "6613a62722d8d1cf1c1310d7824ae8798f773352", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/6613a62722d8d1cf1c1310d7824ae8798f773352"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/54674a35bd0a8d231ad314064d5f7bb8a60ef5df", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/54674a35bd0a8d231ad314064d5f7bb8a60ef5df", "html_url": "https://github.com/Rust-GCC/gccrs/commit/54674a35bd0a8d231ad314064d5f7bb8a60ef5df", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/54674a35bd0a8d231ad314064d5f7bb8a60ef5df/comments", "author": null, "committer": null, "parents": [{"sha": "f4e075e7d9b707fcc5cc53a0e3149ac41172e20b", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/f4e075e7d9b707fcc5cc53a0e3149ac41172e20b", "html_url": "https://github.com/Rust-GCC/gccrs/commit/f4e075e7d9b707fcc5cc53a0e3149ac41172e20b"}], "stats": {"total": 42, "additions": 40, "deletions": 2}, "files": [{"sha": "2714cd3e9bb897ba98d603b76a9702d354cb9cfd", "filename": "gcc/cp/ChangeLog", "status": "modified", "additions": 6, "deletions": 0, "changes": 6, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/54674a35bd0a8d231ad314064d5f7bb8a60ef5df/gcc%2Fcp%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/54674a35bd0a8d231ad314064d5f7bb8a60ef5df/gcc%2Fcp%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fcp%2FChangeLog?ref=54674a35bd0a8d231ad314064d5f7bb8a60ef5df", "patch": "@@ -1,3 +1,9 @@\n+2014-05-16  Paolo Carlini  <paolo.carlini@oracle.com>\n+\n+\tPR c++/51640\n+\t* parser.c (cp_parser_diagnose_invalid_type_name): Early return\n+\twhen cp_parser_lookup_name sets ambiguous_decls.\n+\n 2014-05-15  Jason Merrill  <jason@redhat.com>\n \n \t* call.c (print_conversion_rejection): Use loc consistently."}, {"sha": "7d9f81d314f9eb4c75962d04a5177f9de7083962", "filename": "gcc/cp/parser.c", "status": "modified", "additions": 10, "deletions": 2, "changes": 12, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/54674a35bd0a8d231ad314064d5f7bb8a60ef5df/gcc%2Fcp%2Fparser.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/54674a35bd0a8d231ad314064d5f7bb8a60ef5df/gcc%2Fcp%2Fparser.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fcp%2Fparser.c?ref=54674a35bd0a8d231ad314064d5f7bb8a60ef5df", "patch": "@@ -2880,13 +2880,21 @@ cp_parser_diagnose_invalid_type_name (cp_parser *parser,\n \t\t\t\t      tree scope, tree id,\n \t\t\t\t      location_t location)\n {\n-  tree decl, old_scope;\n+  tree decl, old_scope, ambiguous_decls;\n   cp_parser_commit_to_tentative_parse (parser);\n   /* Try to lookup the identifier.  */\n   old_scope = parser->scope;\n   parser->scope = scope;\n-  decl = cp_parser_lookup_name_simple (parser, id, location);\n+  decl = cp_parser_lookup_name (parser, id, none_type,\n+\t\t\t\t/*is_template=*/false,\n+\t\t\t\t/*is_namespace=*/false,\n+\t\t\t\t/*check_dependency=*/true,\n+\t\t\t\t&ambiguous_decls, location);\n   parser->scope = old_scope;\n+  if (ambiguous_decls)\n+    /* If the lookup was ambiguous, an error will already have\n+       been issued.  */\n+    return;\n   /* If the lookup found a template-name, it means that the user forgot\n   to specify an argument list. Emit a useful error message.  */\n   if (TREE_CODE (decl) == TEMPLATE_DECL)"}, {"sha": "0b1d9050532841d4822c83e77cd769cf4b23313f", "filename": "gcc/testsuite/ChangeLog", "status": "modified", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/54674a35bd0a8d231ad314064d5f7bb8a60ef5df/gcc%2Ftestsuite%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/54674a35bd0a8d231ad314064d5f7bb8a60ef5df/gcc%2Ftestsuite%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2FChangeLog?ref=54674a35bd0a8d231ad314064d5f7bb8a60ef5df", "patch": "@@ -1,3 +1,8 @@\n+2014-05-16  Paolo Carlini  <paolo.carlini@oracle.com>\n+\n+\tPR c++/51640\n+\t* g++.dg/parse/error54.C: New.\n+\n 2014-05-16  Vladimir Makarov  <vmakarov@redhat.com>\n \n \tPR rtl-optimization/60969"}, {"sha": "b49c76b005720049fc5e183bf3018f01bde48cef", "filename": "gcc/testsuite/g++.dg/parse/error54.C", "status": "added", "additions": 19, "deletions": 0, "changes": 19, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/54674a35bd0a8d231ad314064d5f7bb8a60ef5df/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Fparse%2Ferror54.C", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/54674a35bd0a8d231ad314064d5f7bb8a60ef5df/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Fparse%2Ferror54.C", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Fparse%2Ferror54.C?ref=54674a35bd0a8d231ad314064d5f7bb8a60ef5df", "patch": "@@ -0,0 +1,19 @@\n+// PR c++/51640\n+\n+class ex {};\n+\n+namespace t\n+{\n+  class ex2 : public ex {};\n+}\n+\n+class ex2 : public ex {};\n+\n+void bar()\n+{\n+  using namespace t;\n+\n+  try {\n+  } catch (ex2&) { // { dg-error \"reference to 'ex2' is ambiguous\" }\n+  }\n+}"}]}