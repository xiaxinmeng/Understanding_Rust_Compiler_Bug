{"sha": "68d67107efcdee3f5ad0364e2e4717e3cb02600b", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6NjhkNjcxMDdlZmNkZWUzZjVhZDAzNjRlMmU0NzE3ZTNjYjAyNjAwYg==", "commit": {"author": {"name": "Janis Johnson", "email": "janis187@us.ibm.com", "date": "2005-11-22T20:35:51Z"}, "committer": {"name": "Janis Johnson", "email": "janis@gcc.gnu.org", "date": "2005-11-22T20:35:51Z"}, "message": "libmudflap.exp (libmudflap-init): Remove -static from MUDFLAP_FLAGS if static library not supported.\n\n\t* testsuite/lib/libmudflap.exp (libmudflap-init): Remove -static from\n\tMUDFLAP_FLAGS if static library not supported.\n\t* testsuite/libmudflap.c/cfrags.exp (MUDFLAP_FLAGS): new.\n\t* testsuite/libmudflap.c/externs.exp: Ditto.\n\t* testsuite/libmudflap.c++/ctors.exp: Ditto.\n\t* testsuite/libmudflap.c++/c++frags.exp: Ditto.\n\t* testsuite/libmudflap.cth/cthfrags.exp: Ditto.\n\nFrom-SVN: r107371", "tree": {"sha": "d5c4c88db432b79ac6a1569295a4c72df2098e33", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/d5c4c88db432b79ac6a1569295a4c72df2098e33"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/68d67107efcdee3f5ad0364e2e4717e3cb02600b", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/68d67107efcdee3f5ad0364e2e4717e3cb02600b", "html_url": "https://github.com/Rust-GCC/gccrs/commit/68d67107efcdee3f5ad0364e2e4717e3cb02600b", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/68d67107efcdee3f5ad0364e2e4717e3cb02600b/comments", "author": null, "committer": null, "parents": [{"sha": "d998dd65ec93baa138c10fe1bd11da1ba19b439e", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/d998dd65ec93baa138c10fe1bd11da1ba19b439e", "html_url": "https://github.com/Rust-GCC/gccrs/commit/d998dd65ec93baa138c10fe1bd11da1ba19b439e"}], "stats": {"total": 53, "additions": 48, "deletions": 5}, "files": [{"sha": "d7819e932b81c350c9d5155187f1f9268804d3f9", "filename": "libmudflap/ChangeLog", "status": "modified", "additions": 10, "deletions": 0, "changes": 10, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/68d67107efcdee3f5ad0364e2e4717e3cb02600b/libmudflap%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/68d67107efcdee3f5ad0364e2e4717e3cb02600b/libmudflap%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libmudflap%2FChangeLog?ref=68d67107efcdee3f5ad0364e2e4717e3cb02600b", "patch": "@@ -1,3 +1,13 @@\n+2005-11-22  Janis Johnson  <janis187@us.ibm.com>\n+\n+\t* testsuite/lib/libmudflap.exp (libmudflap-init): Remove -static from\n+\tMUDFLAP_FLAGS if static library not supported.\n+\t* testsuite/libmudflap.c/cfrags.exp (MUDFLAP_FLAGS): new.\n+\t* testsuite/libmudflap.c/externs.exp: Ditto.\n+\t* testsuite/libmudflap.c++/ctors.exp: Ditto.\n+\t* testsuite/libmudflap.c++/c++frags.exp: Ditto.\n+\t* testsuite/libmudflap.cth/cthfrags.exp: Ditto.\n+\n 2005-10-04  James E Wilson  <wilson@specifix.com>\n \n \t* configure.ac (mudflap_cv_entry_point): Use quadrigraphs to declare"}, {"sha": "e08f13d25ef17b85f413d7c3be38973adbb8c3f3", "filename": "libmudflap/testsuite/lib/libmudflap.exp", "status": "modified", "additions": 22, "deletions": 0, "changes": 22, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/68d67107efcdee3f5ad0364e2e4717e3cb02600b/libmudflap%2Ftestsuite%2Flib%2Flibmudflap.exp", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/68d67107efcdee3f5ad0364e2e4717e3cb02600b/libmudflap%2Ftestsuite%2Flib%2Flibmudflap.exp", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libmudflap%2Ftestsuite%2Flib%2Flibmudflap.exp?ref=68d67107efcdee3f5ad0364e2e4717e3cb02600b", "patch": "@@ -117,6 +117,28 @@ proc libmudflap-init { language } {\n           unset gluefile\n       }\n     }\n+\n+    # If there is no static library then don't run tests with -static.\n+    global tool\n+    set opts \"additional_flags=-static\"\n+    lappend opts \"additional_flags=-fmudflap\"\n+    lappend opts \"additional_flags=-lmudflap\"\n+    set src stlm[pid].c\n+    set exe stlm[pid].x\n+\n+    set f [open $src \"w\"]\n+    puts $f \"int main () { }\"\n+    close $f\n+    set lines [${tool}_target_compile $src $exe executable \"$opts\"]\n+    file delete $src\n+    remote_file build delete $exe\n+\n+    if { ![string match \"\" $lines] } {\n+\t# Compilation failed; assume static library is not available.\n+\tglobal MUDFLAP_FLAGS\n+\tset i [lsearch $MUDFLAP_FLAGS \"*static*\"]\n+\tset MUDFLAP_FLAGS [lreplace $MUDFLAP_FLAGS $i $i]\n+    }\n }\n \n proc libmudflap-dg-test { prog do_what extra_tool_flags } {"}, {"sha": "eb900d7991133b1aea1fe7502e27fcaa8054db2b", "filename": "libmudflap/testsuite/libmudflap.c++/c++frags.exp", "status": "modified", "additions": 3, "deletions": 1, "changes": 4, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/68d67107efcdee3f5ad0364e2e4717e3cb02600b/libmudflap%2Ftestsuite%2Flibmudflap.c%2B%2B%2Fc%2B%2Bfrags.exp", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/68d67107efcdee3f5ad0364e2e4717e3cb02600b/libmudflap%2Ftestsuite%2Flibmudflap.c%2B%2B%2Fc%2B%2Bfrags.exp", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libmudflap%2Ftestsuite%2Flibmudflap.c%2B%2B%2Fc%2B%2Bfrags.exp?ref=68d67107efcdee3f5ad0364e2e4717e3cb02600b", "patch": "@@ -1,3 +1,5 @@\n+global MUDFLAP_FLAGS\n+set MUDFLAP_FLAGS [list {} {-static} { -O} {-O2} {-O3}]\n \n libmudflap-init c++\n if {$cxx == \"g++\"} then {\n@@ -9,7 +11,7 @@ dg-init\n \n global srcdir\n \n-foreach flags [list {} {-static} {-O} {-O2} {-O3}] {\n+foreach flags $MUDFLAP_FLAGS {\n     foreach srcfile [lsort [glob -nocomplain ${srcdir}/libmudflap.c++/*frag.cxx]] {\n \tset bsrc [file tail $srcfile]\n \tsetenv MUDFLAP_OPTIONS \"-viol-segv\""}, {"sha": "b3dda8fd6ec94f745456e19e20cd3db33e1817c8", "filename": "libmudflap/testsuite/libmudflap.c++/ctors.exp", "status": "modified", "additions": 3, "deletions": 1, "changes": 4, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/68d67107efcdee3f5ad0364e2e4717e3cb02600b/libmudflap%2Ftestsuite%2Flibmudflap.c%2B%2B%2Fctors.exp", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/68d67107efcdee3f5ad0364e2e4717e3cb02600b/libmudflap%2Ftestsuite%2Flibmudflap.c%2B%2B%2Fctors.exp", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libmudflap%2Ftestsuite%2Flibmudflap.c%2B%2B%2Fctors.exp?ref=68d67107efcdee3f5ad0364e2e4717e3cb02600b", "patch": "@@ -1,3 +1,5 @@\n+global MUDFLAP_FLAGS\n+set MUDFLAP_FLAGS [list {} {-static} {-O2} {-O3}]\n \n libmudflap-init c++\n if {$cxx == \"g++\"} then {\n@@ -9,7 +11,7 @@ dg-init\n \n global srcdir subdir\n \n-foreach flags [list {} {-static} {-O2} {-O3}] {\n+foreach flags $MUDFLAP_FLAGS {\n     set l1 [libmudflap_target_compile \"$srcdir/$subdir/ctors-1.cxx\" \"ctors-1.o\" object {additional_flags=-fmudflap}]\n     set test \"ctors-1 compilation ${flags}\"\n     if [string match \"*mudflap cannot track unknown size extern *k*\" $l1] { pass $test } { fail $test }"}, {"sha": "bdaf2196cb7fa7971cb620480d73942b5e47a85f", "filename": "libmudflap/testsuite/libmudflap.c/cfrags.exp", "status": "modified", "additions": 3, "deletions": 1, "changes": 4, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/68d67107efcdee3f5ad0364e2e4717e3cb02600b/libmudflap%2Ftestsuite%2Flibmudflap.c%2Fcfrags.exp", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/68d67107efcdee3f5ad0364e2e4717e3cb02600b/libmudflap%2Ftestsuite%2Flibmudflap.c%2Fcfrags.exp", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libmudflap%2Ftestsuite%2Flibmudflap.c%2Fcfrags.exp?ref=68d67107efcdee3f5ad0364e2e4717e3cb02600b", "patch": "@@ -1,10 +1,12 @@\n+global MUDFLAP_FLAGS\n+set MUDFLAP_FLAGS [list {} {-static} {-O2} {-O3}]\n \n libmudflap-init c\n \n dg-init\n \n global srcdir\n-foreach flags [list {} {-static} {-O2} {-O3}] {\n+foreach flags $MUDFLAP_FLAGS {\n     foreach srcfile [lsort [glob -nocomplain \\\n                             ${srcdir}/libmudflap.c/*frag.c \\\n                             ${srcdir}/libmudflap.c/heap*.c \\"}, {"sha": "773f80cc12a5ed92bf21b0fb89ba2cb77c7b3525", "filename": "libmudflap/testsuite/libmudflap.c/externs.exp", "status": "modified", "additions": 4, "deletions": 1, "changes": 5, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/68d67107efcdee3f5ad0364e2e4717e3cb02600b/libmudflap%2Ftestsuite%2Flibmudflap.c%2Fexterns.exp", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/68d67107efcdee3f5ad0364e2e4717e3cb02600b/libmudflap%2Ftestsuite%2Flibmudflap.c%2Fexterns.exp", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libmudflap%2Ftestsuite%2Flibmudflap.c%2Fexterns.exp?ref=68d67107efcdee3f5ad0364e2e4717e3cb02600b", "patch": "@@ -1,9 +1,12 @@\n+global MUDFLAP_FLAGS\n+set MUDFLAP_FLAGS [list {} {-static} {-O2} {-O3}]\n+\n libmudflap-init c\n dg-init\n \n global srcdir subdir\n \n-foreach flags [list {} {-static} {-O2} {-O3}] {\n+foreach flags $MUDFLAP_FLAGS {\n     set l1 [libmudflap_target_compile \"$srcdir/$subdir/externs-1.c\" \"externs-1.o\" object {additional_flags=-fmudflap}]\n     set test \"externs-1 compilation ${flags}\"\n     if [string match \"*mudflap cannot track unknown size extern *d*\" $l1] { pass $test } { fail $test }"}, {"sha": "e5a7de843542f1845a008b713ff1bbf066abc7ef", "filename": "libmudflap/testsuite/libmudflap.cth/cthfrags.exp", "status": "modified", "additions": 3, "deletions": 1, "changes": 4, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/68d67107efcdee3f5ad0364e2e4717e3cb02600b/libmudflap%2Ftestsuite%2Flibmudflap.cth%2Fcthfrags.exp", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/68d67107efcdee3f5ad0364e2e4717e3cb02600b/libmudflap%2Ftestsuite%2Flibmudflap.cth%2Fcthfrags.exp", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libmudflap%2Ftestsuite%2Flibmudflap.cth%2Fcthfrags.exp?ref=68d67107efcdee3f5ad0364e2e4717e3cb02600b", "patch": "@@ -1,10 +1,12 @@\n+global MUDFLAP_FLAGS\n+set MUDFLAP_FLAGS [list {} {-static -DSTATIC} {-O2} {-O3}]\n \n libmudflap-init c\n \n dg-init\n \n global srcdir\n-foreach flags [list {} {-static -DSTATIC} {-O2} {-O3}] {\n+foreach flags $MUDFLAP_FLAGS {\n     foreach srcfile [lsort [glob -nocomplain ${srcdir}/libmudflap.cth/*.c]] {\n \tset bsrc [file tail $srcfile]\n \tsetenv MUDFLAP_OPTIONS \"-viol-segv\""}]}