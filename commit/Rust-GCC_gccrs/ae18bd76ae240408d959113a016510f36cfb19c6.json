{"sha": "ae18bd76ae240408d959113a016510f36cfb19c6", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6YWUxOGJkNzZhZTI0MDQwOGQ5NTkxMTNhMDE2NTEwZjM2Y2ZiMTljNg==", "commit": {"author": {"name": "Paul Thomas", "email": "pault@gcc.gnu.org", "date": "2008-01-24T08:40:38Z"}, "committer": {"name": "Paul Thomas", "email": "pault@gcc.gnu.org", "date": "2008-01-24T08:40:38Z"}, "message": "re PR fortran/34872 (Spurious error in snapshot of 01/18/08: Statement at (1) is not a valid branch target statement for the branch statement at (2))\n\n2008-01-24  Paul Thomas  <pault@gcc.gnu.org>\n\n\tPR fortran/34872\n\t* parse.c (next_statement) : If ST_GET_FCN_CHARACTERISTICS  is\n\tseen, check for a statement label and, if present, delete it\n\tand set the locus to the start of the statement.\n\n2008-01-24  Paul Thomas  <pault@gcc.gnu.org>\n\n\tPR fortran/34872\n\t* gfortran.dg/function_charlen_3.f: New test.\n\nFrom-SVN: r131777", "tree": {"sha": "72588c3c651570f75fb640cbec283fef41a30f79", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/72588c3c651570f75fb640cbec283fef41a30f79"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/ae18bd76ae240408d959113a016510f36cfb19c6", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/ae18bd76ae240408d959113a016510f36cfb19c6", "html_url": "https://github.com/Rust-GCC/gccrs/commit/ae18bd76ae240408d959113a016510f36cfb19c6", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/ae18bd76ae240408d959113a016510f36cfb19c6/comments", "author": null, "committer": null, "parents": [{"sha": "d82b58c2ac67d1affc0218dc9141e7a99af882cc", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/d82b58c2ac67d1affc0218dc9141e7a99af882cc", "html_url": "https://github.com/Rust-GCC/gccrs/commit/d82b58c2ac67d1affc0218dc9141e7a99af882cc"}], "stats": {"total": 41, "additions": 40, "deletions": 1}, "files": [{"sha": "0a984c3f7a577e07a0536ee95e211a6240134f3d", "filename": "gcc/fortran/ChangeLog", "status": "modified", "additions": 7, "deletions": 0, "changes": 7, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/ae18bd76ae240408d959113a016510f36cfb19c6/gcc%2Ffortran%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/ae18bd76ae240408d959113a016510f36cfb19c6/gcc%2Ffortran%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ffortran%2FChangeLog?ref=ae18bd76ae240408d959113a016510f36cfb19c6", "patch": "@@ -1,3 +1,10 @@\n+2008-01-24  Paul Thomas  <pault@gcc.gnu.org>\r\n+\r\n+\tPR fortran/34872\r\n+\t* parse.c (next_statement) : If ST_GET_FCN_CHARACTERISTICS  is\r\n+\tseen, check for a statement label and, if present, delete it\r\n+\tand set the locus to the start of the statement.\r\n+\r\n 2008-01-22  Paul Thomas  <pault@gcc.gnu.org>\n \n \tPR fortran/34875"}, {"sha": "20777fdc2c4d40b7d92b1cae509c89cefad7a458", "filename": "gcc/fortran/parse.c", "status": "modified", "additions": 10, "deletions": 1, "changes": 11, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/ae18bd76ae240408d959113a016510f36cfb19c6/gcc%2Ffortran%2Fparse.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/ae18bd76ae240408d959113a016510f36cfb19c6/gcc%2Ffortran%2Fparse.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ffortran%2Fparse.c?ref=ae18bd76ae240408d959113a016510f36cfb19c6", "patch": "@@ -795,7 +795,7 @@ static gfc_statement\n next_statement (void)\n {\n   gfc_statement st;\n-\n+  locus old_locus;\n   gfc_new_block = NULL;\n \n   for (;;)\n@@ -824,6 +824,8 @@ next_statement (void)\n       if (gfc_define_undef_line ())\n \tcontinue;\n \n+      old_locus = gfc_current_locus;\n+\n       st = (gfc_current_form == FORM_FIXED) ? next_fixed () : next_free ();\n \n       if (st != ST_NONE)\n@@ -832,6 +834,13 @@ next_statement (void)\n \n   gfc_buffer_error (0);\n \n+  if (st == ST_GET_FCN_CHARACTERISTICS && gfc_statement_label != NULL)\n+    {\n+      gfc_free_st_label (gfc_statement_label);\n+      gfc_statement_label = NULL;\n+      gfc_current_locus = old_locus;\n+    }\n+\n   if (st != ST_NONE)\n     check_statement_label (st);\n "}, {"sha": "ce0ce9a0412a9686ab17e1f98915a837186b1d0b", "filename": "gcc/testsuite/ChangeLog", "status": "modified", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/ae18bd76ae240408d959113a016510f36cfb19c6/gcc%2Ftestsuite%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/ae18bd76ae240408d959113a016510f36cfb19c6/gcc%2Ftestsuite%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2FChangeLog?ref=ae18bd76ae240408d959113a016510f36cfb19c6", "patch": "@@ -1,3 +1,8 @@\n+2008-01-24  Paul Thomas  <pault@gcc.gnu.org>\r\n+\r\n+\tPR fortran/34872\r\n+\t* gfortran.dg/function_charlen_3.f: New test.\r\n+\n 2008-01-23  Michael Matz  <matz@suse.de>\n \n \tPR debug/34895"}, {"sha": "dd4417abade0a6c5c9f5519b062ea145b6342e14", "filename": "gcc/testsuite/gfortran.dg/function_charlen_3.f", "status": "added", "additions": 18, "deletions": 0, "changes": 18, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/ae18bd76ae240408d959113a016510f36cfb19c6/gcc%2Ftestsuite%2Fgfortran.dg%2Ffunction_charlen_3.f", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/ae18bd76ae240408d959113a016510f36cfb19c6/gcc%2Ftestsuite%2Fgfortran.dg%2Ffunction_charlen_3.f", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgfortran.dg%2Ffunction_charlen_3.f?ref=ae18bd76ae240408d959113a016510f36cfb19c6", "patch": "@@ -0,0 +1,18 @@\n+C { dg-do compile }\n+C Tests the fix for the regression PR34872, in which the re-matching of\n+C the function declaration made a mess if the first executable statement\n+C had a label.\n+      CHARACTER FUNCTION s()\n+   10 CONTINUE\n+      GOTO 10\n+      s = ' '\n+      END FUNCTION s\n+\n+      CHARACTER FUNCTION t()\n+   10 format (\"q\")\n+      write (t, 10)\n+      END FUNCTION t\n+\n+      character t\n+      if (t() .ne. \"q\") call abort ()\n+      end"}]}