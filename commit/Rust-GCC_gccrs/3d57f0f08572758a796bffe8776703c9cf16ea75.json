{"sha": "3d57f0f08572758a796bffe8776703c9cf16ea75", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6M2Q1N2YwZjA4NTcyNzU4YTc5NmJmZmU4Nzc2NzAzYzljZjE2ZWE3NQ==", "commit": {"author": {"name": "Manuel L\u00f3pez-Ib\u00e1\u00f1ez", "email": "manu@gcc.gnu.org", "date": "2007-12-04T21:10:09Z"}, "committer": {"name": "Manuel L\u00f3pez-Ib\u00e1\u00f1ez", "email": "manu@gcc.gnu.org", "date": "2007-12-04T21:10:09Z"}, "message": "c-parser (c_parser_statement_after_labels): Move error from here...\n\n2007-12-04  Manuel Lopez-Ibanez  <manu@gcc.gnu.org>\n\n\t* c-parser (c_parser_statement_after_labels): Move error from here...\n\t(c_parser_label): ... to here. Check that the declaration is not\n\tactually just another label.\ntestsuite/\n\t* gcc.dg/parse-decl-after-if.c: New.\n\t* gcc.dg/20031223-1.c: Adjust.\n\nFrom-SVN: r130606", "tree": {"sha": "313749fb7158038f9f43d8e9be00ac5f9872e858", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/313749fb7158038f9f43d8e9be00ac5f9872e858"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/3d57f0f08572758a796bffe8776703c9cf16ea75", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/3d57f0f08572758a796bffe8776703c9cf16ea75", "html_url": "https://github.com/Rust-GCC/gccrs/commit/3d57f0f08572758a796bffe8776703c9cf16ea75", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/3d57f0f08572758a796bffe8776703c9cf16ea75/comments", "author": null, "committer": null, "parents": [{"sha": "2f93f02ca356a40d90f3df0eac1adf1239572d27", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/2f93f02ca356a40d90f3df0eac1adf1239572d27", "html_url": "https://github.com/Rust-GCC/gccrs/commit/2f93f02ca356a40d90f3df0eac1adf1239572d27"}], "stats": {"total": 48, "additions": 37, "deletions": 11}, "files": [{"sha": "a7eb6a2847bcca67b7728459d308a9a83bbbfdfa", "filename": "gcc/ChangeLog", "status": "modified", "additions": 6, "deletions": 0, "changes": 6, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/3d57f0f08572758a796bffe8776703c9cf16ea75/gcc%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/3d57f0f08572758a796bffe8776703c9cf16ea75/gcc%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2FChangeLog?ref=3d57f0f08572758a796bffe8776703c9cf16ea75", "patch": "@@ -1,3 +1,9 @@\n+2007-12-04  Manuel Lopez-Ibanez  <manu@gcc.gnu.org>\n+\n+\t* c-parser (c_parser_statement_after_labels): Move error from here...\n+\t(c_parser_label): ... to here. Check that the declaration is not\n+\tactually just another label.\n+\n 2007-12-04  Richard Guenther  <rguenther@suse.de>\n \n \tPR middle-end/34334"}, {"sha": "c2e5435af2627ec78e1277084524da04de4919ad", "filename": "gcc/c-parser.c", "status": "modified", "additions": 14, "deletions": 11, "changes": 25, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/3d57f0f08572758a796bffe8776703c9cf16ea75/gcc%2Fc-parser.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/3d57f0f08572758a796bffe8776703c9cf16ea75/gcc%2Fc-parser.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fc-parser.c?ref=3d57f0f08572758a796bffe8776703c9cf16ea75", "patch": "@@ -3638,7 +3638,20 @@ c_parser_label (c_parser *parser)\n \t}\n     }\n   if (label)\n-    SET_EXPR_LOCATION (label, loc1);\n+    {\n+      SET_EXPR_LOCATION (label, loc1);\n+      if (c_parser_next_token_starts_declspecs (parser)\n+\t  && !(c_parser_next_token_is (parser, CPP_NAME)\n+\t       && c_parser_peek_2nd_token (parser)->type == CPP_COLON))\n+\t{\n+\t  error (\"%Ha label can only be part of a statement and \"\n+\t\t \"a declaration is not a statement\",\n+\t\t &c_parser_peek_token (parser)->location);\n+\t  c_parser_declaration_or_fndef (parser, /*fndef_ok*/ false, \n+\t\t\t\t\t /*nested*/ true, /*empty_ok*/ false,\n+\t\t\t\t\t /*start_attr_ok*/ true);\n+\t}\n+    }\n }\n \n /* Parse a statement (C90 6.6, C99 6.8).\n@@ -3864,16 +3877,6 @@ c_parser_statement_after_labels (c_parser *parser)\n       break;\n     default:\n     expr_stmt:\n-      if (c_parser_next_token_starts_declspecs (parser)) \n-\t{\n-\t  error (\"%Ha label can only be part of a statement and \"\n-\t\t \"a declaration is not a statement\",\n-\t\t &c_parser_peek_token (parser)->location);\n-\t  c_parser_declaration_or_fndef (parser, /*fndef_ok*/ false, \n-\t\t\t\t\t /*nested*/ true, /*empty_ok*/ false,\n-\t\t\t\t\t /*start_attr_ok*/ true);\n-\t  return;\n-\t}\n       stmt = c_finish_expr_stmt (c_parser_expression_conv (parser).value);\n     expect_semicolon:\n       c_parser_skip_until_found (parser, CPP_SEMICOLON, \"expected %<;%>\");"}, {"sha": "a4fc563cbb62fd924c75d728d090f8ccb0f6673b", "filename": "gcc/testsuite/ChangeLog", "status": "modified", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/3d57f0f08572758a796bffe8776703c9cf16ea75/gcc%2Ftestsuite%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/3d57f0f08572758a796bffe8776703c9cf16ea75/gcc%2Ftestsuite%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2FChangeLog?ref=3d57f0f08572758a796bffe8776703c9cf16ea75", "patch": "@@ -1,3 +1,8 @@\n+2007-12-04  Manuel Lopez-Ibanez  <manu@gcc.gnu.org>\n+\t\n+\t* gcc.dg/parse-decl-after-if.c: New.\n+\t* gcc.dg/20031223-1.c: Adjust.\n+\t\n 2007-12-04  Douglas Gregor  <doug.gregor@gmail.com>\n \n        PR c++/33509"}, {"sha": "c2f35fcfe7fd6014b4af7db047270c2bbf44fd29", "filename": "gcc/testsuite/gcc.dg/20031223-1.c", "status": "modified", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/3d57f0f08572758a796bffe8776703c9cf16ea75/gcc%2Ftestsuite%2Fgcc.dg%2F20031223-1.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/3d57f0f08572758a796bffe8776703c9cf16ea75/gcc%2Ftestsuite%2Fgcc.dg%2F20031223-1.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgcc.dg%2F20031223-1.c?ref=3d57f0f08572758a796bffe8776703c9cf16ea75", "patch": "@@ -9,4 +9,5 @@ void f ()\n {\n  l: int; /* { dg-error \"a label can only be part of a statement and a declaration is not a statement\" } */\n  /* { dg-warning \"useless type name in empty declaration\" \"\" { target *-*-* } 10 } */\n+ /* { dg-error \"label at end of compound statement\" \"\" { target *-*-* } 10 } */\n }"}, {"sha": "f48e6dfc26b2c94a3aec9e3dd6ae3cfebb61589e", "filename": "gcc/testsuite/gcc.dg/parse-decl-after-if.c", "status": "added", "additions": 11, "deletions": 0, "changes": 11, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/3d57f0f08572758a796bffe8776703c9cf16ea75/gcc%2Ftestsuite%2Fgcc.dg%2Fparse-decl-after-if.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/3d57f0f08572758a796bffe8776703c9cf16ea75/gcc%2Ftestsuite%2Fgcc.dg%2Fparse-decl-after-if.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgcc.dg%2Fparse-decl-after-if.c?ref=3d57f0f08572758a796bffe8776703c9cf16ea75", "patch": "@@ -0,0 +1,11 @@\n+/* Parse error recovery\n+{ dg-do compile }\n+{ dg-options \"-fsyntax-only\" }\n+*/\n+\n+void f(x)\n+{\n+  if (x > 1)\n+    int ret = 1; /* { dg-error \"expected expression before 'int'\" } */\n+\n+}"}]}