{"sha": "4cdccf26659e2463f0c1e06da20cb21ea612b391", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6NGNkY2NmMjY2NTllMjQ2M2YwYzFlMDZkYTIwY2IyMWVhNjEyYjM5MQ==", "commit": {"author": {"name": "Paolo Carlini", "email": "paolo.carlini@oracle.com", "date": "2011-09-06T10:22:21Z"}, "committer": {"name": "Paolo Carlini", "email": "paolo@gcc.gnu.org", "date": "2011-09-06T10:22:21Z"}, "message": "re PR libstdc++/50257 ([C++0x] unordered_map slow initialization due to huge __prime_list)\n\n2011-09-06  Paolo Carlini  <paolo.carlini@oracle.com>\n\n\tPR libstdc++/50257\n\t* include/bits/hashtable_policy.h (_Prime_rehash_policy::\n   \t_M_next_bkt): Optimize for small argument.\n\nFrom-SVN: r178581", "tree": {"sha": "2a1a28ed2b59409e72c202f970d6a7391742f27a", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/2a1a28ed2b59409e72c202f970d6a7391742f27a"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/4cdccf26659e2463f0c1e06da20cb21ea612b391", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/4cdccf26659e2463f0c1e06da20cb21ea612b391", "html_url": "https://github.com/Rust-GCC/gccrs/commit/4cdccf26659e2463f0c1e06da20cb21ea612b391", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/4cdccf26659e2463f0c1e06da20cb21ea612b391/comments", "author": null, "committer": null, "parents": [{"sha": "1255c03ad53e732fb5abe39878429c30e758e701", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/1255c03ad53e732fb5abe39878429c30e758e701", "html_url": "https://github.com/Rust-GCC/gccrs/commit/1255c03ad53e732fb5abe39878429c30e758e701"}], "stats": {"total": 17, "additions": 15, "deletions": 2}, "files": [{"sha": "d0c1b11c4eb87453f6c64f2222cd24aea9577651", "filename": "libstdc++-v3/ChangeLog", "status": "modified", "additions": 6, "deletions": 0, "changes": 6, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/4cdccf26659e2463f0c1e06da20cb21ea612b391/libstdc%2B%2B-v3%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/4cdccf26659e2463f0c1e06da20cb21ea612b391/libstdc%2B%2B-v3%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libstdc%2B%2B-v3%2FChangeLog?ref=4cdccf26659e2463f0c1e06da20cb21ea612b391", "patch": "@@ -1,3 +1,9 @@\n+2011-09-06  Paolo Carlini  <paolo.carlini@oracle.com>\n+\n+\tPR libstdc++/50257\n+\t* include/bits/hashtable_policy.h (_Prime_rehash_policy::\n+   \t_M_next_bkt): Optimize for small argument.\n+\n 2011-09-02  Fran\u00e7ois Dumont  <fdumont@gcc.gnu.org>\n \n \t* testsuite/util/testsuite_allocator.h (tracker_allocator_counter::"}, {"sha": "08a6dcd39a26f6eb1fbe40340d869cf5baa728ff", "filename": "libstdc++-v3/include/bits/hashtable_policy.h", "status": "modified", "additions": 9, "deletions": 2, "changes": 11, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/4cdccf26659e2463f0c1e06da20cb21ea612b391/libstdc%2B%2B-v3%2Finclude%2Fbits%2Fhashtable_policy.h", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/4cdccf26659e2463f0c1e06da20cb21ea612b391/libstdc%2B%2B-v3%2Finclude%2Fbits%2Fhashtable_policy.h", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libstdc%2B%2B-v3%2Finclude%2Fbits%2Fhashtable_policy.h?ref=4cdccf26659e2463f0c1e06da20cb21ea612b391", "patch": "@@ -427,8 +427,15 @@ _GLIBCXX_BEGIN_NAMESPACE_VERSION\n   _Prime_rehash_policy::\n   _M_next_bkt(std::size_t __n) const\n   {\n-    const unsigned long __p = *std::lower_bound(__prime_list, __prime_list\n-\t\t\t\t\t\t+ _S_n_primes, __n);\n+    // Optimize lookups involving the first elements of __prime_list.\n+    // (useful to speed-up, eg, constructors)\n+    static const unsigned char __fastbkt[12]\n+      = { 2, 2, 2, 3, 5, 5, 7, 7, 11, 11, 11, 11 };\n+\n+    const unsigned long __p\n+      = __n <= 11 ? __fastbkt[__n]\n+                  : *std::lower_bound(__prime_list + 5,\n+\t\t\t\t      __prime_list + _S_n_primes, __n);\n     _M_next_resize =\n       static_cast<std::size_t>(__builtin_floor(__p * _M_max_load_factor));\n     return __p;"}]}