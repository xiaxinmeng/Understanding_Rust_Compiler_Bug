{"sha": "26cfb9ab3d91892d6f6bfde59b6b6010fe467707", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6MjZjZmI5YWIzZDkxODkyZDZmNmJmZGU1OWI2YjYwMTBmZTQ2NzcwNw==", "commit": {"author": {"name": "Kai Tietz", "email": "ktietz@redhat.com", "date": "2012-02-07T10:45:59Z"}, "committer": {"name": "Kai Tietz", "email": "ktietz@gcc.gnu.org", "date": "2012-02-07T10:45:59Z"}, "message": "re PR target/40068 (GCC fails to apply dllexport attribute to typeinfo.)\n\n2012-02-07  Kai Tietz  <ktietz@redhat.com>\n            Dave Korn  <dave.korn.cygwin@gmail.com>\n\n        PR target/40068\n        * config/i386/winnt-cxx.c (i386_pe_adjust_class_at_definition):\n        Take care that typinfo gets dllexport-attribute.\n\nCo-Authored-By: Dave Korn <dave.korn.cygwin@gmail.com>\n\nFrom-SVN: r183962", "tree": {"sha": "8011b88174088067bc88a2f7f3d560cbcfba997c", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/8011b88174088067bc88a2f7f3d560cbcfba997c"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/26cfb9ab3d91892d6f6bfde59b6b6010fe467707", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/26cfb9ab3d91892d6f6bfde59b6b6010fe467707", "html_url": "https://github.com/Rust-GCC/gccrs/commit/26cfb9ab3d91892d6f6bfde59b6b6010fe467707", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/26cfb9ab3d91892d6f6bfde59b6b6010fe467707/comments", "author": null, "committer": null, "parents": [{"sha": "b1b95093addde97a78ec59fef4c6930847f84566", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/b1b95093addde97a78ec59fef4c6930847f84566", "html_url": "https://github.com/Rust-GCC/gccrs/commit/b1b95093addde97a78ec59fef4c6930847f84566"}], "stats": {"total": 21, "additions": 21, "deletions": 0}, "files": [{"sha": "a35ee2c43002ed1bdd23c846409d114423318cd5", "filename": "gcc/ChangeLog", "status": "modified", "additions": 7, "deletions": 0, "changes": 7, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/26cfb9ab3d91892d6f6bfde59b6b6010fe467707/gcc%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/26cfb9ab3d91892d6f6bfde59b6b6010fe467707/gcc%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2FChangeLog?ref=26cfb9ab3d91892d6f6bfde59b6b6010fe467707", "patch": "@@ -1,3 +1,10 @@\n+2012-02-07  Kai Tietz  <ktietz@redhat.com>\n+            Dave Korn  <dave.korn.cygwin@gmail.com>\n+\n+\tPR target/40068\n+\t* config/i386/winnt-cxx.c (i386_pe_adjust_class_at_definition):\n+\tTake care that typinfo gets dllexport-attribute.\n+\n 2012-02-07  Jakub Jelinek  <jakub@redhat.com>\n \n \tPR middle-end/52074"}, {"sha": "0c47e3a8b58b835cc91f93cf88c9d0f35fa967ea", "filename": "gcc/config/i386/winnt-cxx.c", "status": "modified", "additions": 14, "deletions": 0, "changes": 14, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/26cfb9ab3d91892d6f6bfde59b6b6010fe467707/gcc%2Fconfig%2Fi386%2Fwinnt-cxx.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/26cfb9ab3d91892d6f6bfde59b6b6010fe467707/gcc%2Fconfig%2Fi386%2Fwinnt-cxx.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fconfig%2Fi386%2Fwinnt-cxx.c?ref=26cfb9ab3d91892d6f6bfde59b6b6010fe467707", "patch": "@@ -97,6 +97,20 @@ i386_pe_adjust_class_at_definition (tree t)\n  \n   if (lookup_attribute (\"dllexport\", TYPE_ATTRIBUTES (t)) != NULL_TREE)\n     {\n+      tree tmv = TYPE_MAIN_VARIANT (t);\n+\n+      /* Make sure that we set dllexport attribute to typeinfo's\n+\t base declaration, as otherwise it would fail to be exported as\n+\t it isn't a class-member.  */\n+      if (tmv != NULL_TREE\n+\t  && CLASSTYPE_TYPEINFO_VAR (tmv) != NULL_TREE)\n+\t{\n+\t  tree na, ti_decl = CLASSTYPE_TYPEINFO_VAR (tmv);\n+\t  na = tree_cons (get_identifier (\"dllexport\"), NULL_TREE,\n+\t\t\t  NULL_TREE);\n+\t  decl_attributes (&ti_decl, na, 0);\n+\t}\n+\n       /* Check static VAR_DECL's.  */\n       for (member = TYPE_FIELDS (t); member; member = DECL_CHAIN (member))\n \tif (TREE_CODE (member) == VAR_DECL)     "}]}