{"sha": "5eb10f25aca8dda496f6b77e3b54e99113f10268", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6NWViMTBmMjVhY2E4ZGRhNDk2ZjZiNzdlM2I1NGU5OTExM2YxMDI2OA==", "commit": {"author": {"name": "Ed Schonberg", "email": "schonberg@adacore.com", "date": "2005-03-15T16:18:01Z"}, "committer": {"name": "Arnaud Charlet", "email": "charlet@gcc.gnu.org", "date": "2005-03-15T16:18:01Z"}, "message": "sem_ch8.adb (Analyze_Subprogram_Renaming): In a generic...\n\n2005-03-08  Ed Schonberg  <schonberg@adacore.com>\n\n\t* sem_ch8.adb (Analyze_Subprogram_Renaming): In a generic, if this is\n\ta renaming a body, check that the renamed subprogram in not intrinsic.\n\t(Find_Direct_Name): If several use_visible entities hide\n\teach other, and the context is a predefined file compiled through\n\trtsfind, keep only the entity that comes from a predefined file.\n\nFrom-SVN: r96507", "tree": {"sha": "890c293eca47d9f3f0c849dc8413ea4f9ca38387", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/890c293eca47d9f3f0c849dc8413ea4f9ca38387"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/5eb10f25aca8dda496f6b77e3b54e99113f10268", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/5eb10f25aca8dda496f6b77e3b54e99113f10268", "html_url": "https://github.com/Rust-GCC/gccrs/commit/5eb10f25aca8dda496f6b77e3b54e99113f10268", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/5eb10f25aca8dda496f6b77e3b54e99113f10268/comments", "author": {"login": "Edschonberg", "id": 6352375, "node_id": "MDQ6VXNlcjYzNTIzNzU=", "avatar_url": "https://avatars.githubusercontent.com/u/6352375?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Edschonberg", "html_url": "https://github.com/Edschonberg", "followers_url": "https://api.github.com/users/Edschonberg/followers", "following_url": "https://api.github.com/users/Edschonberg/following{/other_user}", "gists_url": "https://api.github.com/users/Edschonberg/gists{/gist_id}", "starred_url": "https://api.github.com/users/Edschonberg/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Edschonberg/subscriptions", "organizations_url": "https://api.github.com/users/Edschonberg/orgs", "repos_url": "https://api.github.com/users/Edschonberg/repos", "events_url": "https://api.github.com/users/Edschonberg/events{/privacy}", "received_events_url": "https://api.github.com/users/Edschonberg/received_events", "type": "User", "site_admin": false}, "committer": null, "parents": [{"sha": "9865d858f18593270af8b98cf469b9fec76383f5", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/9865d858f18593270af8b98cf469b9fec76383f5", "html_url": "https://github.com/Rust-GCC/gccrs/commit/9865d858f18593270af8b98cf469b9fec76383f5"}], "stats": {"total": 51, "additions": 44, "deletions": 7}, "files": [{"sha": "d8900263ba5d26feebc63fcd61268d47018cd8ab", "filename": "gcc/ada/sem_ch8.adb", "status": "modified", "additions": 44, "deletions": 7, "changes": 51, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/5eb10f25aca8dda496f6b77e3b54e99113f10268/gcc%2Fada%2Fsem_ch8.adb", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/5eb10f25aca8dda496f6b77e3b54e99113f10268/gcc%2Fada%2Fsem_ch8.adb", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fada%2Fsem_ch8.adb?ref=5eb10f25aca8dda496f6b77e3b54e99113f10268", "patch": "@@ -1271,12 +1271,6 @@ package body Sem_Ch8 is\n          Set_Corresponding_Spec (N, Rename_Spec);\n          Set_Corresponding_Body (Unit_Declaration_Node (Rename_Spec), New_S);\n \n-         --  The body is created when the entity is frozen. If the context\n-         --  is generic, freeze_all is not invoked, so we need to indicate\n-         --  that the entity has a completion.\n-\n-         Set_Has_Completion (Rename_Spec, Inside_A_Generic);\n-\n          if Ada_Version = Ada_83 and then Comes_From_Source (N) then\n             Error_Msg_N (\"(Ada 83) renaming cannot serve as a body\", N);\n          end if;\n@@ -1286,10 +1280,13 @@ package body Sem_Ch8 is\n          Set_Public_Status (New_S);\n \n          --  Indicate that the entity in the declaration functions like\n-         --  the corresponding body, and is not a new entity.\n+         --  the corresponding body, and is not a new entity. The body will\n+         --  be constructed later at the freeze point, so indicate that\n+         --  the completion has not been seen yet.\n \n          Set_Ekind (New_S, E_Subprogram_Body);\n          New_S := Rename_Spec;\n+         Set_Has_Completion (Rename_Spec, False);\n \n       else\n          Generate_Definition (New_S);\n@@ -1407,6 +1404,22 @@ package body Sem_Ch8 is\n \n             Check_Frozen_Renaming (N, Rename_Spec);\n \n+            --  Check explicitly that renamed entity is not intrinsic, because\n+            --  in in a generic the renamed body is not built. In this case,\n+            --  the renaming_as_body is a completion.\n+\n+            if Inside_A_Generic then\n+               if Is_Frozen (Rename_Spec)\n+                 and then Is_Intrinsic_Subprogram (Old_S)\n+               then\n+                  Error_Msg_N\n+                    (\"subprogram in renaming_as_body cannot be intrinsic\",\n+                       Name (N));\n+               end if;\n+\n+               Set_Has_Completion (Rename_Spec);\n+            end if;\n+\n          elsif Ekind (Old_S) /= E_Operator then\n             Check_Mode_Conformant (New_S, Old_S);\n \n@@ -3134,6 +3147,30 @@ package body Sem_Ch8 is\n                Nvis_Messages;\n                return;\n \n+            elsif\n+              Is_Predefined_File_Name (Unit_File_Name (Current_Sem_Unit))\n+            then\n+               --  A use-clause in the body of a system file creates a\n+               --  conflict with some entity in a user scope, while rtsfind\n+               --  is active. Keep only the entity that comes from another\n+               --  predefined unit.\n+\n+               E2 := E;\n+               while Present (E2) loop\n+                  if Is_Predefined_File_Name\n+                    (Unit_File_Name (Get_Source_Unit (Sloc (E2))))\n+                  then\n+                     E := E2;\n+                     goto Found;\n+                  end if;\n+\n+                  E2 := Homonym (E2);\n+               end loop;\n+\n+               --  Entity must exist because predefined unit is correct.\n+\n+               raise Program_Error;\n+\n             else\n                Nvis_Messages;\n                return;"}]}