{"sha": "65371a7eddd37f9d5d15790486296cb441cabb40", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6NjUzNzFhN2VkZGQzN2Y5ZDVkMTU3OTA0ODYyOTZjYjQ0MWNhYmI0MA==", "commit": {"author": {"name": "Paolo Carlini", "email": "paolo.carlini@oracle.com", "date": "2017-11-06T17:45:55Z"}, "committer": {"name": "Paolo Carlini", "email": "paolo@gcc.gnu.org", "date": "2017-11-06T17:45:55Z"}, "message": "re PR c++/65579 ([C++11] gcc requires definition of a static constexpr member even though it is not odr-used)\n\n/cp\n2017-11-06  Paolo Carlini  <paolo.carlini@oracle.com>\n\n\tPR c++/65579\n\t* decl2.c (finish_static_data_member_decl): If there's an initializer,\n\tcomplete the type and re-apply the quals.\n\n/testsuite\n2017-11-06  Paolo Carlini  <paolo.carlini@oracle.com>\n\n\tPR c++/65579\n\t* g++.dg/cpp0x/constexpr-template11.C: New.\n\nFrom-SVN: r254461", "tree": {"sha": "5ddd98710b5dd3186f8f660b2a84f275c1ab389d", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/5ddd98710b5dd3186f8f660b2a84f275c1ab389d"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/65371a7eddd37f9d5d15790486296cb441cabb40", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/65371a7eddd37f9d5d15790486296cb441cabb40", "html_url": "https://github.com/Rust-GCC/gccrs/commit/65371a7eddd37f9d5d15790486296cb441cabb40", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/65371a7eddd37f9d5d15790486296cb441cabb40/comments", "author": null, "committer": null, "parents": [{"sha": "d3722bf7325e1cf63215d69fda8d0667e4bb0321", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/d3722bf7325e1cf63215d69fda8d0667e4bb0321", "html_url": "https://github.com/Rust-GCC/gccrs/commit/d3722bf7325e1cf63215d69fda8d0667e4bb0321"}], "stats": {"total": 36, "additions": 36, "deletions": 0}, "files": [{"sha": "2a6143a2f472af2ac9e0aae237da6350f5828089", "filename": "gcc/cp/ChangeLog", "status": "modified", "additions": 6, "deletions": 0, "changes": 6, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/65371a7eddd37f9d5d15790486296cb441cabb40/gcc%2Fcp%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/65371a7eddd37f9d5d15790486296cb441cabb40/gcc%2Fcp%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fcp%2FChangeLog?ref=65371a7eddd37f9d5d15790486296cb441cabb40", "patch": "@@ -1,3 +1,9 @@\n+2017-11-06  Paolo Carlini  <paolo.carlini@oracle.com>\n+\n+\tPR c++/65579\n+\t* decl2.c (finish_static_data_member_decl): If there's an initializer,\n+\tcomplete the type and re-apply the quals.\n+\n 2017-11-06  Martin Liska  <mliska@suse.cz>\n \n \tPR middle-end/82404"}, {"sha": "0b183085e0e3b605df8aa5ee88402d22792c8fbb", "filename": "gcc/cp/decl2.c", "status": "modified", "additions": 9, "deletions": 0, "changes": 9, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/65371a7eddd37f9d5d15790486296cb441cabb40/gcc%2Fcp%2Fdecl2.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/65371a7eddd37f9d5d15790486296cb441cabb40/gcc%2Fcp%2Fdecl2.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fcp%2Fdecl2.c?ref=65371a7eddd37f9d5d15790486296cb441cabb40", "patch": "@@ -787,6 +787,15 @@ finish_static_data_member_decl (tree decl,\n       && TYPE_DOMAIN (TREE_TYPE (decl)) == NULL_TREE)\n     SET_VAR_HAD_UNKNOWN_BOUND (decl);\n \n+  if (init)\n+    {\n+      /* Similarly to start_decl_1, we want to complete the type in order\n+\t to do the right thing in cp_apply_type_quals_to_decl, possibly\n+\t clear TYPE_QUAL_CONST (c++/65579).  */\n+      tree type = TREE_TYPE (decl) = complete_type (TREE_TYPE (decl));\n+      cp_apply_type_quals_to_decl (cp_type_quals (type), decl);\n+    }\n+\n   cp_finish_decl (decl, init, init_const_expr_p, asmspec_tree, flags);\n }\n "}, {"sha": "b8f7d931ef3e1425249d79d9673618650cd82979", "filename": "gcc/testsuite/ChangeLog", "status": "modified", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/65371a7eddd37f9d5d15790486296cb441cabb40/gcc%2Ftestsuite%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/65371a7eddd37f9d5d15790486296cb441cabb40/gcc%2Ftestsuite%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2FChangeLog?ref=65371a7eddd37f9d5d15790486296cb441cabb40", "patch": "@@ -1,3 +1,8 @@\n+2017-11-06  Paolo Carlini  <paolo.carlini@oracle.com>\n+\n+\tPR c++/65579\n+\t* g++.dg/cpp0x/constexpr-template11.C: New.\n+\n 2017-11-06  Jakub Jelinek  <jakub@redhat.com>\n \n \tPR tree-optimization/82838"}, {"sha": "0ad49088ad15c7fccd4a75f334aba26c75e7b17d", "filename": "gcc/testsuite/g++.dg/cpp0x/constexpr-template11.C", "status": "added", "additions": 16, "deletions": 0, "changes": 16, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/65371a7eddd37f9d5d15790486296cb441cabb40/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Fcpp0x%2Fconstexpr-template11.C", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/65371a7eddd37f9d5d15790486296cb441cabb40/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Fcpp0x%2Fconstexpr-template11.C", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Fcpp0x%2Fconstexpr-template11.C?ref=65371a7eddd37f9d5d15790486296cb441cabb40", "patch": "@@ -0,0 +1,16 @@\n+// PR c++/65579\n+// { dg-do link { target c++11 } }\n+\n+template <typename>\n+struct S {\n+    int i;\n+};\n+\n+struct T {\n+  static constexpr S<int> s = { 1 };\n+};\n+\n+int main()\n+{\n+  return T::s.i;\n+}"}]}