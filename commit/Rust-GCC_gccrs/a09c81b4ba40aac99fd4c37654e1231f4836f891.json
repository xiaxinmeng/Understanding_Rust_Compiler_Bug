{"sha": "a09c81b4ba40aac99fd4c37654e1231f4836f891", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6YTA5YzgxYjRiYTQwYWFjOTlmZDRjMzc2NTRlMTIzMWY0ODM2Zjg5MQ==", "commit": {"author": {"name": "Jakub Jelinek", "email": "jakub@redhat.com", "date": "2016-06-14T19:55:08Z"}, "committer": {"name": "Jakub Jelinek", "email": "jakub@gcc.gnu.org", "date": "2016-06-14T19:55:08Z"}, "message": "re PR c++/71528 (multiple extern reference declarations produce uninitialized access)\n\n\tPR c++/71528\n\t* decl.c (duplicate_decls): For DECL_INITIALIZED_P non-external\n\tolddecl vars, preserve their TREE_READONLY bit.\n\n\t* g++.dg/opt/pr71528.C: New test.\n\nFrom-SVN: r237458", "tree": {"sha": "c8460492a50fc58991906faba6ea819144b06b7d", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/c8460492a50fc58991906faba6ea819144b06b7d"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/a09c81b4ba40aac99fd4c37654e1231f4836f891", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/a09c81b4ba40aac99fd4c37654e1231f4836f891", "html_url": "https://github.com/Rust-GCC/gccrs/commit/a09c81b4ba40aac99fd4c37654e1231f4836f891", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/a09c81b4ba40aac99fd4c37654e1231f4836f891/comments", "author": {"login": "jakubjelinek", "id": 9370665, "node_id": "MDQ6VXNlcjkzNzA2NjU=", "avatar_url": "https://avatars.githubusercontent.com/u/9370665?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jakubjelinek", "html_url": "https://github.com/jakubjelinek", "followers_url": "https://api.github.com/users/jakubjelinek/followers", "following_url": "https://api.github.com/users/jakubjelinek/following{/other_user}", "gists_url": "https://api.github.com/users/jakubjelinek/gists{/gist_id}", "starred_url": "https://api.github.com/users/jakubjelinek/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jakubjelinek/subscriptions", "organizations_url": "https://api.github.com/users/jakubjelinek/orgs", "repos_url": "https://api.github.com/users/jakubjelinek/repos", "events_url": "https://api.github.com/users/jakubjelinek/events{/privacy}", "received_events_url": "https://api.github.com/users/jakubjelinek/received_events", "type": "User", "site_admin": false}, "committer": null, "parents": [{"sha": "5618c53ff334bff75cad40cf9ac03cbaf32da218", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/5618c53ff334bff75cad40cf9ac03cbaf32da218", "html_url": "https://github.com/Rust-GCC/gccrs/commit/5618c53ff334bff75cad40cf9ac03cbaf32da218"}], "stats": {"total": 38, "additions": 38, "deletions": 0}, "files": [{"sha": "cd5996bdd1d4a01f04b004a085a7c5ecd37fcb8b", "filename": "gcc/cp/ChangeLog", "status": "modified", "additions": 4, "deletions": 0, "changes": 4, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/a09c81b4ba40aac99fd4c37654e1231f4836f891/gcc%2Fcp%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/a09c81b4ba40aac99fd4c37654e1231f4836f891/gcc%2Fcp%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fcp%2FChangeLog?ref=a09c81b4ba40aac99fd4c37654e1231f4836f891", "patch": "@@ -1,5 +1,9 @@\n 2016-06-14  Jakub Jelinek  <jakub@redhat.com>\n \n+\tPR c++/71528\n+\t* decl.c (duplicate_decls): For DECL_INITIALIZED_P non-external\n+\tolddecl vars, preserve their TREE_READONLY bit.\n+\n \tPR c++/71516\n \t* decl.c (complete_vars): Handle gracefully type == error_mark_node.\n "}, {"sha": "a03e48ff6182410e75cd4df0f0ec8c4fafc29dca", "filename": "gcc/cp/decl.c", "status": "modified", "additions": 8, "deletions": 0, "changes": 8, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/a09c81b4ba40aac99fd4c37654e1231f4836f891/gcc%2Fcp%2Fdecl.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/a09c81b4ba40aac99fd4c37654e1231f4836f891/gcc%2Fcp%2Fdecl.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fcp%2Fdecl.c?ref=a09c81b4ba40aac99fd4c37654e1231f4836f891", "patch": "@@ -2066,6 +2066,14 @@ duplicate_decls (tree newdecl, tree olddecl, bool newdecl_is_friend)\n       if (VAR_P (newdecl))\n \t{\n \t  DECL_THIS_EXTERN (newdecl) |= DECL_THIS_EXTERN (olddecl);\n+\t  /* For already initialized vars, TREE_READONLY could have been\n+\t     cleared in cp_finish_decl, because the var needs runtime\n+\t     initialization or destruction.  Make sure not to set\n+\t     TREE_READONLY on it again.  */\n+\t  if (DECL_INITIALIZED_P (olddecl)\n+\t      && !DECL_EXTERNAL (olddecl)\n+\t      && !TREE_READONLY (olddecl))\n+\t    TREE_READONLY (newdecl) = 0;\n \t  DECL_INITIALIZED_P (newdecl) |= DECL_INITIALIZED_P (olddecl);\n \t  DECL_NONTRIVIALLY_INITIALIZED_P (newdecl)\n \t    |= DECL_NONTRIVIALLY_INITIALIZED_P (olddecl);"}, {"sha": "4a55801352e1262b1956c7691221a459512a298e", "filename": "gcc/testsuite/ChangeLog", "status": "modified", "additions": 3, "deletions": 0, "changes": 3, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/a09c81b4ba40aac99fd4c37654e1231f4836f891/gcc%2Ftestsuite%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/a09c81b4ba40aac99fd4c37654e1231f4836f891/gcc%2Ftestsuite%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2FChangeLog?ref=a09c81b4ba40aac99fd4c37654e1231f4836f891", "patch": "@@ -1,5 +1,8 @@\n 2016-06-14  Jakub Jelinek  <jakub@redhat.com>\n \n+\tPR c++/71528\n+\t* g++.dg/opt/pr71528.C: New test.\n+\n \tPR c++/71516\n \t* g++.dg/init/pr71516.C: New test.\n "}, {"sha": "bfe062204726b1afa9a3736f9a0061573ebd67b1", "filename": "gcc/testsuite/g++.dg/opt/pr71528.C", "status": "added", "additions": 23, "deletions": 0, "changes": 23, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/a09c81b4ba40aac99fd4c37654e1231f4836f891/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Fopt%2Fpr71528.C", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/a09c81b4ba40aac99fd4c37654e1231f4836f891/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Fopt%2Fpr71528.C", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Fopt%2Fpr71528.C?ref=a09c81b4ba40aac99fd4c37654e1231f4836f891", "patch": "@@ -0,0 +1,23 @@\n+// PR c++/71528\n+// { dg-do run }\n+// { dg-options \"-O2\" }\n+\n+extern int &x;\n+int y;\n+\n+int &\n+foo ()\n+{\n+  return y;\n+}\n+\n+int &x = foo ();\n+\n+int\n+main ()\n+{\n+  if (&x != &y)\n+    __builtin_abort ();\n+}\n+\n+extern int &x;"}]}