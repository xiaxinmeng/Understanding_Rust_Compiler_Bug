{"sha": "e657564359c300bde7bcbba12e30b5e3f80f8c6c", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6ZTY1NzU2NDM1OWMzMDBiZGU3YmNiYmExMmUzMGI1ZTNmODBmOGM2Yw==", "commit": {"author": {"name": "Renlin Li", "email": "renlin.li@arm.com", "date": "2018-11-12T16:47:24Z"}, "committer": {"name": "Renlin Li", "email": "renlin@gcc.gnu.org", "date": "2018-11-12T16:47:24Z"}, "message": "[PR87815]Don't generate shift sequence for load replacement in DSE when the mode size is not compile-time constant\n\nThe patch adds a check if the gap is compile-time constant.\n\nThis happens when dse decides to replace the load with previous store value.\nThe problem is that, shift sequence could not accept compile-time non-constant\nmode operand.\n\ngcc/\n\n2018-11-12  Renlin Li  <renlin.li@arm.com>\n\n\tPR target/87815\n\t* dse.c (get_stored_val): Add check for compile-time\n\tconstantness of gap.\n\ngcc/testsuite/\n\n2018-11-12  Renlin Li  <renlin.li@arm.com>\n\n\tPR target/87815\n\t* gcc.target/aarch64/sve/pr87815.c: New.\n\nFrom-SVN: r266033", "tree": {"sha": "4062e8bcf6db37a7a42f85411b47c89b727a2129", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/4062e8bcf6db37a7a42f85411b47c89b727a2129"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/e657564359c300bde7bcbba12e30b5e3f80f8c6c", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/e657564359c300bde7bcbba12e30b5e3f80f8c6c", "html_url": "https://github.com/Rust-GCC/gccrs/commit/e657564359c300bde7bcbba12e30b5e3f80f8c6c", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/e657564359c300bde7bcbba12e30b5e3f80f8c6c/comments", "author": null, "committer": null, "parents": [{"sha": "d5cc6de1be9d8fed0b810596efd467d6bee6aa03", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/d5cc6de1be9d8fed0b810596efd467d6bee6aa03", "html_url": "https://github.com/Rust-GCC/gccrs/commit/d5cc6de1be9d8fed0b810596efd467d6bee6aa03"}], "stats": {"total": 26, "additions": 25, "deletions": 1}, "files": [{"sha": "6b4a14b946b779f191bfdffcd0cc16eee6487730", "filename": "gcc/ChangeLog", "status": "modified", "additions": 6, "deletions": 0, "changes": 6, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/e657564359c300bde7bcbba12e30b5e3f80f8c6c/gcc%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/e657564359c300bde7bcbba12e30b5e3f80f8c6c/gcc%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2FChangeLog?ref=e657564359c300bde7bcbba12e30b5e3f80f8c6c", "patch": "@@ -1,3 +1,9 @@\n+2018-11-12  Renlin Li  <renlin.li@arm.com>\n+\n+\tPR target/87815\n+\t* dse.c (get_stored_val): Add check for compile-time constantness\n+\tof gap.\n+\n 2018-11-12  Sudakshina Das  <sudi.das@arm.com>\n \n \t* config/arm/arm-cpus.in (armv8_5, sb, predres): New features."}, {"sha": "21d166d92fcc2c2a4dd6d04bb7a7247b79b81a62", "filename": "gcc/dse.c", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/e657564359c300bde7bcbba12e30b5e3f80f8c6c/gcc%2Fdse.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/e657564359c300bde7bcbba12e30b5e3f80f8c6c/gcc%2Fdse.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fdse.c?ref=e657564359c300bde7bcbba12e30b5e3f80f8c6c", "patch": "@@ -1841,7 +1841,7 @@ get_stored_val (store_info *store_info, machine_mode read_mode,\n   else\n     gap = read_offset - store_info->offset;\n \n-  if (maybe_ne (gap, 0))\n+  if (gap.is_constant () && maybe_ne (gap, 0))\n     {\n       poly_int64 shift = gap * BITS_PER_UNIT;\n       poly_int64 access_size = GET_MODE_SIZE (read_mode) + gap;"}, {"sha": "64b072f2293a5b27db9794c1ce4f1e5048a165eb", "filename": "gcc/testsuite/ChangeLog", "status": "modified", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/e657564359c300bde7bcbba12e30b5e3f80f8c6c/gcc%2Ftestsuite%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/e657564359c300bde7bcbba12e30b5e3f80f8c6c/gcc%2Ftestsuite%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2FChangeLog?ref=e657564359c300bde7bcbba12e30b5e3f80f8c6c", "patch": "@@ -1,3 +1,8 @@\n+2018-11-12  Renlin Li  <renlin.li@arm.com>\n+\n+\tPR target/87815\n+\t* gcc.target/aarch64/sve/pr87815.c: New.\n+\n 2018-11-12  Sudakshina Das  <sudi.das@arm.com>\n \n \t* gcc.target/arm/multilib.exp: Add some -march=armv8.5-a"}, {"sha": "628cedb2acce82a86b61944eb6184d7fdbb2d656", "filename": "gcc/testsuite/gcc.target/aarch64/sve/pr87815.c", "status": "added", "additions": 13, "deletions": 0, "changes": 13, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/e657564359c300bde7bcbba12e30b5e3f80f8c6c/gcc%2Ftestsuite%2Fgcc.target%2Faarch64%2Fsve%2Fpr87815.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/e657564359c300bde7bcbba12e30b5e3f80f8c6c/gcc%2Ftestsuite%2Fgcc.target%2Faarch64%2Fsve%2Fpr87815.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgcc.target%2Faarch64%2Fsve%2Fpr87815.c?ref=e657564359c300bde7bcbba12e30b5e3f80f8c6c", "patch": "@@ -0,0 +1,13 @@\n+/* { dg-do compile { target aarch64_asm_sve_ok } } */\n+/* { dg-options \"-O3\" } */\n+int a, b, d;\n+short e;\n+\n+void f ()\n+{\n+  for (int i = 0; i < 8; i++)\n+    {\n+      e = b >= 2 ?: a >> b;\n+      d = e && b;\n+    }\n+}"}]}