{"sha": "42b40eff8019d80a429d26616e80db96f1cb882c", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6NDJiNDBlZmY4MDE5ZDgwYTQyOWQyNjYxNmU4MGRiOTZmMWNiODgyYw==", "commit": {"author": {"name": "Paolo Carlini", "email": "paolo.carlini@oracle.com", "date": "2012-10-25T16:14:59Z"}, "committer": {"name": "Paolo Carlini", "email": "paolo@gcc.gnu.org", "date": "2012-10-25T16:14:59Z"}, "message": "re PR c++/53761 (ICE on incorrect transparent union (first field has floating point type))\n\n/cp\n2012-10-25  Paolo Carlini  <paolo.carlini@oracle.com>\n\n\tPR c++/53761\n\t* class.c (finish_struct_1): Reject aggregates decorated with\n\t__transparent_union__ which cannot be made transparent because\n\tthe type of the first field has a different ABI from the class\n\toverall.\n\n/testsuite\n2012-10-25  Paolo Carlini  <paolo.carlini@oracle.com>\n\n\tPR c++/53761\n\t* g++.dg/ext/transparent-union.C: New.\n\nFrom-SVN: r192814", "tree": {"sha": "64f3e00ee1e86736bdb2e4f38aaf2db7d77e5611", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/64f3e00ee1e86736bdb2e4f38aaf2db7d77e5611"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/42b40eff8019d80a429d26616e80db96f1cb882c", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/42b40eff8019d80a429d26616e80db96f1cb882c", "html_url": "https://github.com/Rust-GCC/gccrs/commit/42b40eff8019d80a429d26616e80db96f1cb882c", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/42b40eff8019d80a429d26616e80db96f1cb882c/comments", "author": null, "committer": null, "parents": [{"sha": "f14edc1af5f9149d913221f39dc96980d7ac73a2", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/f14edc1af5f9149d913221f39dc96980d7ac73a2", "html_url": "https://github.com/Rust-GCC/gccrs/commit/f14edc1af5f9149d913221f39dc96980d7ac73a2"}], "stats": {"total": 27, "additions": 26, "deletions": 1}, "files": [{"sha": "3cd3b27bc17b9176009f8697113daffc4033ceb4", "filename": "gcc/cp/ChangeLog", "status": "modified", "additions": 8, "deletions": 0, "changes": 8, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/42b40eff8019d80a429d26616e80db96f1cb882c/gcc%2Fcp%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/42b40eff8019d80a429d26616e80db96f1cb882c/gcc%2Fcp%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fcp%2FChangeLog?ref=42b40eff8019d80a429d26616e80db96f1cb882c", "patch": "@@ -1,3 +1,11 @@\n+2012-10-25  Paolo Carlini  <paolo.carlini@oracle.com>\n+\n+\tPR c++/53761\n+\t* class.c (finish_struct_1): Reject aggregates decorated with\n+\t__transparent_union__ which cannot be made transparent because\n+\tthe type of the first field has a different ABI from the class\n+\toverall.\n+\n 2012-10-25  Jason Merrill  <jason@redhat.com>\n \n \tCore 1402"}, {"sha": "e55f1f9c2b78f8cdfb100db2ae5a9ba9101c7023", "filename": "gcc/cp/class.c", "status": "modified", "additions": 8, "deletions": 1, "changes": 9, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/42b40eff8019d80a429d26616e80db96f1cb882c/gcc%2Fcp%2Fclass.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/42b40eff8019d80a429d26616e80db96f1cb882c/gcc%2Fcp%2Fclass.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fcp%2Fclass.c?ref=42b40eff8019d80a429d26616e80db96f1cb882c", "patch": "@@ -6267,7 +6267,7 @@ finish_struct_1 (tree t)\n       tree field = first_field (t);\n       if (field == NULL_TREE || error_operand_p (field))\n \t{\n-\t  error (\"type transparent class %qT does not have any fields\", t);\n+\t  error (\"type transparent %q#T does not have any fields\", t);\n \t  TYPE_TRANSPARENT_AGGR (t) = 0;\n \t}\n       else if (DECL_ARTIFICIAL (field))\n@@ -6281,6 +6281,13 @@ finish_struct_1 (tree t)\n \t    }\n \t  TYPE_TRANSPARENT_AGGR (t) = 0;\n \t}\n+      else if (TYPE_MODE (t) != DECL_MODE (field))\n+\t{\n+\t  error (\"type transparent %q#T cannot be made transparent because \"\n+\t\t \"the type of the first field has a different ABI from the \"\n+\t\t \"class overall\", t);\n+\t  TYPE_TRANSPARENT_AGGR (t) = 0;\n+\t}\n     }\n }\n "}, {"sha": "16c0ce6c1b9f07df26e2275a35b3f911b6f70ad6", "filename": "gcc/testsuite/ChangeLog", "status": "modified", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/42b40eff8019d80a429d26616e80db96f1cb882c/gcc%2Ftestsuite%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/42b40eff8019d80a429d26616e80db96f1cb882c/gcc%2Ftestsuite%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2FChangeLog?ref=42b40eff8019d80a429d26616e80db96f1cb882c", "patch": "@@ -1,3 +1,8 @@\n+2012-10-25  Paolo Carlini  <paolo.carlini@oracle.com>\n+\n+\tPR c++/53761\n+\t* g++.dg/ext/transparent-union.C: New.\n+\n 2012-10-25  Marc Glisse  <marc.glisse@inria.fr>\n \n \tPR c++/54427"}, {"sha": "12315636100c1c329e3d8374b8cba296e79f6926", "filename": "gcc/testsuite/g++.dg/ext/transparent-union.C", "status": "added", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/42b40eff8019d80a429d26616e80db96f1cb882c/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Fext%2Ftransparent-union.C", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/42b40eff8019d80a429d26616e80db96f1cb882c/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Fext%2Ftransparent-union.C", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Fext%2Ftransparent-union.C?ref=42b40eff8019d80a429d26616e80db96f1cb882c", "patch": "@@ -0,0 +1,5 @@\n+// PR c++/53761\n+\n+typedef union {    // { dg-error \"type transparent\" }\n+   double x;\n+} __attribute__(( __transparent_union__ )) example_t;"}]}