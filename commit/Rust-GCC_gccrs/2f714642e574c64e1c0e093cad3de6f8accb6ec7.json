{"sha": "2f714642e574c64e1c0e093cad3de6f8accb6ec7", "node_id": "C_kwDOANBUbNoAKDJmNzE0NjQyZTU3NGM2NGUxYzBlMDkzY2FkM2RlNmY4YWNjYjZlYzc", "commit": {"author": {"name": "Martin Sebor", "email": "msebor@redhat.com", "date": "2022-01-19T00:52:01Z"}, "committer": {"name": "Martin Sebor", "email": "msebor@redhat.com", "date": "2022-01-19T01:04:08Z"}, "message": "Handle failure to determine pointer provenance conservatively [PR104069].\n\nPartly resolves:\nPR middle-end/104069 - -Werror=use-after-free false positive on elfutils-0.186\n\ngcc/ChangeLog:\n\tPR middle-end/104069\n\t* gimple-ssa-warn-access.cc (pointers_related_p): Return false for\n\tan unknown result as documented.\n\ngcc/testsuite/ChangeLog:\n\tPR middle-end/104069\n\t* gcc.dg/Wuse-after-free.c: New test.", "tree": {"sha": "3b58a833770c73a30999f0e5ab924a54ae2703bb", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/3b58a833770c73a30999f0e5ab924a54ae2703bb"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/2f714642e574c64e1c0e093cad3de6f8accb6ec7", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/2f714642e574c64e1c0e093cad3de6f8accb6ec7", "html_url": "https://github.com/Rust-GCC/gccrs/commit/2f714642e574c64e1c0e093cad3de6f8accb6ec7", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/2f714642e574c64e1c0e093cad3de6f8accb6ec7/comments", "author": {"login": "msebor", "id": 381149, "node_id": "MDQ6VXNlcjM4MTE0OQ==", "avatar_url": "https://avatars.githubusercontent.com/u/381149?v=4", "gravatar_id": "", "url": "https://api.github.com/users/msebor", "html_url": "https://github.com/msebor", "followers_url": "https://api.github.com/users/msebor/followers", "following_url": "https://api.github.com/users/msebor/following{/other_user}", "gists_url": "https://api.github.com/users/msebor/gists{/gist_id}", "starred_url": "https://api.github.com/users/msebor/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/msebor/subscriptions", "organizations_url": "https://api.github.com/users/msebor/orgs", "repos_url": "https://api.github.com/users/msebor/repos", "events_url": "https://api.github.com/users/msebor/events{/privacy}", "received_events_url": "https://api.github.com/users/msebor/received_events", "type": "User", "site_admin": false}, "committer": {"login": "msebor", "id": 381149, "node_id": "MDQ6VXNlcjM4MTE0OQ==", "avatar_url": "https://avatars.githubusercontent.com/u/381149?v=4", "gravatar_id": "", "url": "https://api.github.com/users/msebor", "html_url": "https://github.com/msebor", "followers_url": "https://api.github.com/users/msebor/followers", "following_url": "https://api.github.com/users/msebor/following{/other_user}", "gists_url": "https://api.github.com/users/msebor/gists{/gist_id}", "starred_url": "https://api.github.com/users/msebor/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/msebor/subscriptions", "organizations_url": "https://api.github.com/users/msebor/orgs", "repos_url": "https://api.github.com/users/msebor/repos", "events_url": "https://api.github.com/users/msebor/events{/privacy}", "received_events_url": "https://api.github.com/users/msebor/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "9c186493a7cc1c911910b9c37220334f9529912d", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/9c186493a7cc1c911910b9c37220334f9529912d", "html_url": "https://github.com/Rust-GCC/gccrs/commit/9c186493a7cc1c911910b9c37220334f9529912d"}], "stats": {"total": 45, "additions": 44, "deletions": 1}, "files": [{"sha": "f9508a1d211988734fc5be183f9fe0c4e78eca73", "filename": "gcc/gimple-ssa-warn-access.cc", "status": "modified", "additions": 3, "deletions": 1, "changes": 4, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/2f714642e574c64e1c0e093cad3de6f8accb6ec7/gcc%2Fgimple-ssa-warn-access.cc", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/2f714642e574c64e1c0e093cad3de6f8accb6ec7/gcc%2Fgimple-ssa-warn-access.cc", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fgimple-ssa-warn-access.cc?ref=2f714642e574c64e1c0e093cad3de6f8accb6ec7", "patch": "@@ -4082,7 +4082,9 @@ pointers_related_p (gimple *stmt, tree p, tree q, pointer_query &qry)\n   access_ref pref, qref;\n   if (!qry.get_ref (p, stmt, &pref, 0)\n       || !qry.get_ref (q, stmt, &qref, 0))\n-    return true;\n+    /* GET_REF() only rarely fails.  When it does, it's likely because\n+       it involves a self-referential PHI.  Return a conservative result.  */\n+    return false;\n \n   return pref.ref == qref.ref;\n }"}, {"sha": "9862de5c0a9c179040e2be692bf2f25b02294733", "filename": "gcc/testsuite/gcc.dg/Wuse-after-free.c", "status": "added", "additions": 41, "deletions": 0, "changes": 41, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/2f714642e574c64e1c0e093cad3de6f8accb6ec7/gcc%2Ftestsuite%2Fgcc.dg%2FWuse-after-free.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/2f714642e574c64e1c0e093cad3de6f8accb6ec7/gcc%2Ftestsuite%2Fgcc.dg%2FWuse-after-free.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgcc.dg%2FWuse-after-free.c?ref=2f714642e574c64e1c0e093cad3de6f8accb6ec7", "patch": "@@ -0,0 +1,41 @@\n+/* PR middle-end/104069 - -Werror=use-after-free false positive on\n+   elfutils-0.186\n+   { dg-do compile }\n+   { dg-options \"-Wall\" } */\n+\n+typedef __SIZE_TYPE__ size_t;\n+\n+extern void* realloc (void *, size_t);\n+\n+void* __libdw_unzstd (size_t todo)\n+{\n+  void *sb = 0;\n+\n+  for ( ; ; )\n+    {\n+      // Ran only once.\n+      if (!sb)\n+\t{\n+\t  char *b = realloc (sb, todo);\n+\t  if (!b)\n+\t    break;\n+\n+\t  sb = b;\n+\t}\n+\n+      todo -= 1;\n+      if (todo == 0)\n+\tbreak;\n+    }\n+\n+  // Shrink buffer: leave only one byte for simplicity.\n+  char *b = realloc (sb, 1);\n+  if (b)\n+    sb = b;\n+  else\n+    {\n+      // Realloc failed mysteriously, leave 'sb' untouched.\n+    }\n+\n+  return sb;        // { dg-bogus \"-Wuse-after-free\" }\n+}"}]}