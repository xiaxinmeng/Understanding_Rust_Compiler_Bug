{"sha": "e08a896b96792d73293db82d0dc3541c17e545ad", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6ZTA4YTg5NmI5Njc5MmQ3MzI5M2RiODJkMGRjMzU0MWMxN2U1NDVhZA==", "commit": {"author": {"name": "Bob Duff", "email": "duff@adacore.com", "date": "2019-07-03T08:15:28Z"}, "committer": {"name": "Pierre-Marie de Rodat", "email": "pmderodat@gcc.gnu.org", "date": "2019-07-03T08:15:28Z"}, "message": "[Ada] Improve warnings about infinite loops\n\nThe compiler now has fewer false alarms when warning about infinite\nloops. For example, a loop of the form \"for X of A ...\", where A is an\narray, cannot be infinite.  The compiler no longer warns in this case.\n\n2019-07-03  Bob Duff  <duff@adacore.com>\n\ngcc/ada/\n\n\t* sem_warn.adb (Check_Infinite_Loop_Warning): Avoid the warning\n\tif an Iterator_Specification is present.\n\ngcc/testsuite/\n\n\t* gnat.dg/warn20.adb, gnat.dg/warn20_pkg.adb,\n\tgnat.dg/warn20_pkg.ads: New testcase.\n\nFrom-SVN: r272978", "tree": {"sha": "873033257e40845a247e50b2c395a10f182c897b", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/873033257e40845a247e50b2c395a10f182c897b"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/e08a896b96792d73293db82d0dc3541c17e545ad", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/e08a896b96792d73293db82d0dc3541c17e545ad", "html_url": "https://github.com/Rust-GCC/gccrs/commit/e08a896b96792d73293db82d0dc3541c17e545ad", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/e08a896b96792d73293db82d0dc3541c17e545ad/comments", "author": {"login": "bobduff", "id": 29099567, "node_id": "MDQ6VXNlcjI5MDk5NTY3", "avatar_url": "https://avatars.githubusercontent.com/u/29099567?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bobduff", "html_url": "https://github.com/bobduff", "followers_url": "https://api.github.com/users/bobduff/followers", "following_url": "https://api.github.com/users/bobduff/following{/other_user}", "gists_url": "https://api.github.com/users/bobduff/gists{/gist_id}", "starred_url": "https://api.github.com/users/bobduff/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bobduff/subscriptions", "organizations_url": "https://api.github.com/users/bobduff/orgs", "repos_url": "https://api.github.com/users/bobduff/repos", "events_url": "https://api.github.com/users/bobduff/events{/privacy}", "received_events_url": "https://api.github.com/users/bobduff/received_events", "type": "User", "site_admin": false}, "committer": null, "parents": [{"sha": "07fb741a3672a677a48a2672345d2dd67f944fad", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/07fb741a3672a677a48a2672345d2dd67f944fad", "html_url": "https://github.com/Rust-GCC/gccrs/commit/07fb741a3672a677a48a2672345d2dd67f944fad"}], "stats": {"total": 52, "additions": 49, "deletions": 3}, "files": [{"sha": "02f35d5f2333504f91a99342dc0aec8301509ad2", "filename": "gcc/ada/ChangeLog", "status": "modified", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/e08a896b96792d73293db82d0dc3541c17e545ad/gcc%2Fada%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/e08a896b96792d73293db82d0dc3541c17e545ad/gcc%2Fada%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fada%2FChangeLog?ref=e08a896b96792d73293db82d0dc3541c17e545ad", "patch": "@@ -1,3 +1,8 @@\n+2019-07-03  Bob Duff  <duff@adacore.com>\n+\n+\t* sem_warn.adb (Check_Infinite_Loop_Warning): Avoid the warning\n+\tif an Iterator_Specification is present.\n+\n 2019-07-03  Bob Duff  <duff@adacore.com>\n \n \t* doc/gnat_ugn/gnat_utility_programs.rst: Document default"}, {"sha": "7e13aa51afebf75bb4c14386133b9d5c797a92a7", "filename": "gcc/ada/sem_warn.adb", "status": "modified", "additions": 10, "deletions": 3, "changes": 13, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/e08a896b96792d73293db82d0dc3541c17e545ad/gcc%2Fada%2Fsem_warn.adb", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/e08a896b96792d73293db82d0dc3541c17e545ad/gcc%2Fada%2Fsem_warn.adb", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fada%2Fsem_warn.adb?ref=e08a896b96792d73293db82d0dc3541c17e545ad", "patch": "@@ -632,9 +632,16 @@ package body Sem_Warn is\n \n                Expression := Condition (Iter);\n \n-            --  For iteration, do not process, since loop will always terminate\n-\n-            elsif Present (Loop_Parameter_Specification (Iter)) then\n+            --  For Loop_Parameter_Specification, do not process, since loop\n+            --  will always terminate. For Iterator_Specification, also do not\n+            --  process. Either it will always terminate (e.g. \"for X of\n+            --  Some_Array ...\"), or we can't tell if it's going to terminate\n+            --  without looking at the iterator, so any warning here would be\n+            --  noise.\n+\n+            elsif Present (Loop_Parameter_Specification (Iter))\n+              or else Present (Iterator_Specification (Iter))\n+            then\n                return;\n             end if;\n          end if;"}, {"sha": "c9f0bc6a0bb865e1984e61916571c46f536b5b55", "filename": "gcc/testsuite/ChangeLog", "status": "modified", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/e08a896b96792d73293db82d0dc3541c17e545ad/gcc%2Ftestsuite%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/e08a896b96792d73293db82d0dc3541c17e545ad/gcc%2Ftestsuite%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2FChangeLog?ref=e08a896b96792d73293db82d0dc3541c17e545ad", "patch": "@@ -1,3 +1,8 @@\n+2019-07-03  Bob Duff  <duff@adacore.com>\n+\n+\t* gnat.dg/warn20.adb, gnat.dg/warn20_pkg.adb,\n+\tgnat.dg/warn20_pkg.ads: New testcase.\n+\n 2019-07-03  Ed Schonberg  <schonberg@adacore.com>\n \n \t* gnat.dg/predicate6.adb, gnat.dg/predicate6.ads: New testcase."}, {"sha": "90fbf3200af0c9a20bbc20279863bc839404137f", "filename": "gcc/testsuite/gnat.dg/warn20.adb", "status": "added", "additions": 11, "deletions": 0, "changes": 11, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/e08a896b96792d73293db82d0dc3541c17e545ad/gcc%2Ftestsuite%2Fgnat.dg%2Fwarn20.adb", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/e08a896b96792d73293db82d0dc3541c17e545ad/gcc%2Ftestsuite%2Fgnat.dg%2Fwarn20.adb", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgnat.dg%2Fwarn20.adb?ref=e08a896b96792d73293db82d0dc3541c17e545ad", "patch": "@@ -0,0 +1,11 @@\n+--  { dg-do compile }\n+--  { dg-options \"-gnatwa\" }\n+\n+with Warn20_Pkg;\n+\n+procedure Warn20 is\n+   package P is new Warn20_Pkg (Integer, 0);\n+   pragma Unreferenced (P);\n+begin\n+   null;\n+end Warn20;"}, {"sha": "7ee7ab735dda44b4e2747b2bcb94438b65ebd964", "filename": "gcc/testsuite/gnat.dg/warn20_pkg.adb", "status": "added", "additions": 10, "deletions": 0, "changes": 10, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/e08a896b96792d73293db82d0dc3541c17e545ad/gcc%2Ftestsuite%2Fgnat.dg%2Fwarn20_pkg.adb", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/e08a896b96792d73293db82d0dc3541c17e545ad/gcc%2Ftestsuite%2Fgnat.dg%2Fwarn20_pkg.adb", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgnat.dg%2Fwarn20_pkg.adb?ref=e08a896b96792d73293db82d0dc3541c17e545ad", "patch": "@@ -0,0 +1,10 @@\n+package body Warn20_Pkg is\n+   L : array (1 .. 10) of T := (1 .. 10 => None);\n+   procedure Foo is\n+   begin\n+      for A of L loop\n+         exit when A = None;\n+         Dispatch (A);\n+      end loop;\n+   end;\n+end;"}, {"sha": "861484b9acb130bffc26b1a1e42da2f530fa9a65", "filename": "gcc/testsuite/gnat.dg/warn20_pkg.ads", "status": "added", "additions": 8, "deletions": 0, "changes": 8, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/e08a896b96792d73293db82d0dc3541c17e545ad/gcc%2Ftestsuite%2Fgnat.dg%2Fwarn20_pkg.ads", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/e08a896b96792d73293db82d0dc3541c17e545ad/gcc%2Ftestsuite%2Fgnat.dg%2Fwarn20_pkg.ads", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgnat.dg%2Fwarn20_pkg.ads?ref=e08a896b96792d73293db82d0dc3541c17e545ad", "patch": "@@ -0,0 +1,8 @@\n+generic\n+   type T is private;\n+   None : T;\n+package Warn20_Pkg is\n+   generic\n+      with procedure Dispatch (X : T) is null;\n+   procedure Foo;\n+end;"}]}