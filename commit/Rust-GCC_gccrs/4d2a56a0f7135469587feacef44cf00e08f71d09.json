{"sha": "4d2a56a0f7135469587feacef44cf00e08f71d09", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6NGQyYTU2YTBmNzEzNTQ2OTU4N2ZlYWNlZjQ0Y2YwMGUwOGY3MWQwOQ==", "commit": {"author": {"name": "Mark Eggleston", "email": "markeggleston@gcc.gnu.org", "date": "2020-06-11T13:33:51Z"}, "committer": {"name": "Mark Eggleston", "email": "markeggleston@gcc.gnu.org", "date": "2020-10-14T10:08:09Z"}, "message": "Fortran  :  ICE in build_field PR95614\n\nLocal identifiers can not be the same as a module name.  Original\npatch by Steve Kargl resulted in name clashes between common block\nnames and local identifiers.  A local identifier can be the same as\na global identier if that identifier is not a module or a program.\nThe original patch was modified to reject global identifiers that\nrepresent a module or a program.\n\n2020-10-14  Steven G. Kargl  <kargl@gcc.gnu.org>\n\t    Mark Eggleston  <markeggleston@gcc.gnu.org>\n\ngcc/fortran/ChangeLog:\n\n\tPR fortran/95614\n\t* decl.c (gfc_get_common): Use gfc_match_common_name instead\n\tof match_common_name.\n\t* decl.c (gfc_bind_idents): Use gfc_match_common_name instead\n\tof match_common_name.\n\t* match.c : Rename match_common_name to gfc_match_common_name.\n\t* match.c (gfc_match_common): Use gfc_match_common_name instead\n\tof match_common_name.\n\t* match.h : Rename match_common_name to gfc_match_common_name.\n\t* resolve.c (resolve_common_vars): Check each symbol in a\n\tcommon block has a global symbol.  If there is a global symbol\n\tissue an error if the symbol type is a module or a program.\n\n2020-10-14  Mark Eggleston  <markeggleston@gcc.gnu.org>\n\ngcc/testsuite/ChangeLog:\n\n\tPR fortran/95614\n\t* gfortran.dg/pr95614_1.f90: New test.\n\t* gfortran.dg/pr95614_2.f90: New test.\n\t* gfortran.dg/pr95614_3.f90: New test.\n\t* gfortran.dg/pr95614_4.f90: New test.", "tree": {"sha": "263a94b0f2e2c30cacd701b05cbd7e11bf9ebf69", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/263a94b0f2e2c30cacd701b05cbd7e11bf9ebf69"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/4d2a56a0f7135469587feacef44cf00e08f71d09", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/4d2a56a0f7135469587feacef44cf00e08f71d09", "html_url": "https://github.com/Rust-GCC/gccrs/commit/4d2a56a0f7135469587feacef44cf00e08f71d09", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/4d2a56a0f7135469587feacef44cf00e08f71d09/comments", "author": null, "committer": null, "parents": [{"sha": "c7b6a7587f215e913cec9ed523bf32bb0405fd3f", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/c7b6a7587f215e913cec9ed523bf32bb0405fd3f", "html_url": "https://github.com/Rust-GCC/gccrs/commit/c7b6a7587f215e913cec9ed523bf32bb0405fd3f"}], "stats": {"total": 52, "additions": 44, "deletions": 8}, "files": [{"sha": "6df32068777b04f52219e86380d4037965b15397", "filename": "gcc/fortran/decl.c", "status": "modified", "additions": 2, "deletions": 2, "changes": 4, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/4d2a56a0f7135469587feacef44cf00e08f71d09/gcc%2Ffortran%2Fdecl.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/4d2a56a0f7135469587feacef44cf00e08f71d09/gcc%2Ffortran%2Fdecl.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ffortran%2Fdecl.c?ref=4d2a56a0f7135469587feacef44cf00e08f71d09", "patch": "@@ -6007,7 +6007,7 @@ get_bind_c_idents (void)\n       found_id = MATCH_YES;\n       gfc_get_ha_symbol (name, &tmp_sym);\n     }\n-  else if (match_common_name (name) == MATCH_YES)\n+  else if (gfc_match_common_name (name) == MATCH_YES)\n     {\n       found_id = MATCH_YES;\n       com_block = gfc_get_common (name, 0);\n@@ -6052,7 +6052,7 @@ get_bind_c_idents (void)\n \t      found_id = MATCH_YES;\n \t      gfc_get_ha_symbol (name, &tmp_sym);\n \t    }\n-\t  else if (match_common_name (name) == MATCH_YES)\n+\t  else if (gfc_match_common_name (name) == MATCH_YES)\n \t    {\n \t      found_id = MATCH_YES;\n \t      com_block = gfc_get_common (name, 0);"}, {"sha": "bee73e7b00800e7e1e816d953a68d1e51b522e2d", "filename": "gcc/fortran/match.c", "status": "modified", "additions": 3, "deletions": 2, "changes": 5, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/4d2a56a0f7135469587feacef44cf00e08f71d09/gcc%2Ffortran%2Fmatch.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/4d2a56a0f7135469587feacef44cf00e08f71d09/gcc%2Ffortran%2Fmatch.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ffortran%2Fmatch.c?ref=4d2a56a0f7135469587feacef44cf00e08f71d09", "patch": "@@ -5166,7 +5166,8 @@ gfc_get_common (const char *name, int from_module)\n \n /* Match a common block name.  */\n \n-match match_common_name (char *name)\n+match\n+gfc_match_common_name (char *name)\n {\n   match m;\n \n@@ -5218,7 +5219,7 @@ gfc_match_common (void)\n \n   for (;;)\n     {\n-      m = match_common_name (name);\n+      m = gfc_match_common_name (name);\n       if (m == MATCH_ERROR)\n \tgoto cleanup;\n "}, {"sha": "4ccb5961d2b1d8d8c18cf29232e5ad09ed1834fb", "filename": "gcc/fortran/match.h", "status": "modified", "additions": 2, "deletions": 4, "changes": 6, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/4d2a56a0f7135469587feacef44cf00e08f71d09/gcc%2Ffortran%2Fmatch.h", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/4d2a56a0f7135469587feacef44cf00e08f71d09/gcc%2Ffortran%2Fmatch.h", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ffortran%2Fmatch.h?ref=4d2a56a0f7135469587feacef44cf00e08f71d09", "patch": "@@ -103,11 +103,9 @@ match gfc_match_call (void);\n \n /* We want to use this function to check for a common-block-name\n    that can exist in a bind statement, so removed the \"static\"\n-   declaration of the function in match.c.\n+   declaration of the function in match.c. */\n  \n-   TODO: should probably rename this now that it'll be globally seen to\n-   gfc_match_common_name.  */\n-match match_common_name (char *name);\n+match gfc_match_common_name (char *name);\n \n match gfc_match_common (void);\n match gfc_match_block_data (void);"}, {"sha": "a210f9aad43e8245f3bb8348bba29e2bf82b5428", "filename": "gcc/fortran/resolve.c", "status": "modified", "additions": 7, "deletions": 0, "changes": 7, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/4d2a56a0f7135469587feacef44cf00e08f71d09/gcc%2Ffortran%2Fresolve.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/4d2a56a0f7135469587feacef44cf00e08f71d09/gcc%2Ffortran%2Fresolve.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ffortran%2Fresolve.c?ref=4d2a56a0f7135469587feacef44cf00e08f71d09", "patch": "@@ -936,9 +936,16 @@ static void\n resolve_common_vars (gfc_common_head *common_block, bool named_common)\n {\n   gfc_symbol *csym = common_block->head;\n+  gfc_gsymbol *gsym;\n \n   for (; csym; csym = csym->common_next)\n     {\n+      gsym = gfc_find_gsymbol (gfc_gsym_root, csym->name);\n+      if (gsym && (gsym->type == GSYM_MODULE || gsym->type == GSYM_PROGRAM))\n+\tgfc_error_now (\"Global entity %qs at %L cannot appear in a \"\n+\t\t\t\"COMMON block at %L\", gsym->name,\n+\t\t\t&gsym->where, &csym->common_block->where);\n+\n       /* gfc_add_in_common may have been called before, but the reported errors\n \t have been ignored to continue parsing.\n \t We do the checks again here.  */"}, {"sha": "f835143365a2c7a2a830919a1922fe328c0b21fe", "filename": "gcc/testsuite/gfortran.dg/pr95614_1.f90", "status": "added", "additions": 6, "deletions": 0, "changes": 6, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/4d2a56a0f7135469587feacef44cf00e08f71d09/gcc%2Ftestsuite%2Fgfortran.dg%2Fpr95614_1.f90", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/4d2a56a0f7135469587feacef44cf00e08f71d09/gcc%2Ftestsuite%2Fgfortran.dg%2Fpr95614_1.f90", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgfortran.dg%2Fpr95614_1.f90?ref=4d2a56a0f7135469587feacef44cf00e08f71d09", "patch": "@@ -0,0 +1,6 @@\n+! { dg-do compile }\n+\n+module m   ! { dg-error \".1.\" }\n+  common m ! { dg-error \"cannot appear in a COMMON\" }\n+end\n+"}, {"sha": "9d69a5063846e9c1212cb9e376f3ea8704eef798", "filename": "gcc/testsuite/gfortran.dg/pr95614_2.f90", "status": "added", "additions": 6, "deletions": 0, "changes": 6, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/4d2a56a0f7135469587feacef44cf00e08f71d09/gcc%2Ftestsuite%2Fgfortran.dg%2Fpr95614_2.f90", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/4d2a56a0f7135469587feacef44cf00e08f71d09/gcc%2Ftestsuite%2Fgfortran.dg%2Fpr95614_2.f90", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgfortran.dg%2Fpr95614_2.f90?ref=4d2a56a0f7135469587feacef44cf00e08f71d09", "patch": "@@ -0,0 +1,6 @@\n+! { dg-do compile }\n+\n+module m        ! { dg-error \".1.\" }\n+  common /xc/ m ! { dg-error \"cannot appear in a COMMON\" }\n+end\n+"}, {"sha": "7a66bec46fb3485e87b87ce630ece8e1dbdb08e5", "filename": "gcc/testsuite/gfortran.dg/pr95614_3.f90", "status": "added", "additions": 9, "deletions": 0, "changes": 9, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/4d2a56a0f7135469587feacef44cf00e08f71d09/gcc%2Ftestsuite%2Fgfortran.dg%2Fpr95614_3.f90", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/4d2a56a0f7135469587feacef44cf00e08f71d09/gcc%2Ftestsuite%2Fgfortran.dg%2Fpr95614_3.f90", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgfortran.dg%2Fpr95614_3.f90?ref=4d2a56a0f7135469587feacef44cf00e08f71d09", "patch": "@@ -0,0 +1,9 @@\n+! { dg-do compile }\n+\n+subroutine s\n+end subroutine\n+\n+program pr95614\n+  common /c1/ s\n+  s = 9.0\n+end program"}, {"sha": "48f9b9b6825ddb8af5b80b6245c08222e0326b36", "filename": "gcc/testsuite/gfortran.dg/pr95614_4.f90", "status": "added", "additions": 9, "deletions": 0, "changes": 9, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/4d2a56a0f7135469587feacef44cf00e08f71d09/gcc%2Ftestsuite%2Fgfortran.dg%2Fpr95614_4.f90", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/4d2a56a0f7135469587feacef44cf00e08f71d09/gcc%2Ftestsuite%2Fgfortran.dg%2Fpr95614_4.f90", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgfortran.dg%2Fpr95614_4.f90?ref=4d2a56a0f7135469587feacef44cf00e08f71d09", "patch": "@@ -0,0 +1,9 @@\n+! { dg-do compile }\n+\n+function f()\n+  f = 1.0\n+end function\n+\n+program pr95614\n+  common /c1/ f\n+end program"}]}