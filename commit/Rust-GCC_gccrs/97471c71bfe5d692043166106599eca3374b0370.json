{"sha": "97471c71bfe5d692043166106599eca3374b0370", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6OTc0NzFjNzFiZmU1ZDY5MjA0MzE2NjEwNjU5OWVjYTMzNzRiMDM3MA==", "commit": {"author": {"name": "Paolo Carlini", "email": "paolo.carlini@oracle.com", "date": "2009-11-17T20:03:03Z"}, "committer": {"name": "Paolo Carlini", "email": "paolo@gcc.gnu.org", "date": "2009-11-17T20:03:03Z"}, "message": "re PR c++/42058 (Trouble with invalid array initialization)\n\ncp/\n2009-11-17  Paolo Carlini  <paolo.carlini@oracle.com>\n\n\tPR c++/42058\n\t* typeck2.c (digest_init_r): Check init for error_operand_p.\n\t* decl.c (reshape_init_class): Check return value of reshape_init_r\n\tfor error_mark_node.\n\ntestsuite/\n2009-11-17  Paolo Carlini  <paolo.carlini@oracle.com>\n\n\tPR c++/42058\n\t* testsuite/g++.dg/init/array26.C: New.\n\t* testsuite/g++.dg/init/array27.C: Likewise.\n\t* testsuite/g++.old-deja/g++.benjamin/13478.C: Adjust dg-errors.\n\nFrom-SVN: r154267", "tree": {"sha": "8de8dcf4633037e738ce07ab5674df1a38e63f98", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/8de8dcf4633037e738ce07ab5674df1a38e63f98"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/97471c71bfe5d692043166106599eca3374b0370", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/97471c71bfe5d692043166106599eca3374b0370", "html_url": "https://github.com/Rust-GCC/gccrs/commit/97471c71bfe5d692043166106599eca3374b0370", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/97471c71bfe5d692043166106599eca3374b0370/comments", "author": null, "committer": null, "parents": [{"sha": "6bab0284947ba4c0e4028ea7703d90a8fba932b2", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/6bab0284947ba4c0e4028ea7703d90a8fba932b2", "html_url": "https://github.com/Rust-GCC/gccrs/commit/6bab0284947ba4c0e4028ea7703d90a8fba932b2"}], "stats": {"total": 49, "additions": 41, "deletions": 8}, "files": [{"sha": "17968f50860988e50e80d868cd621468212db989", "filename": "gcc/cp/ChangeLog", "status": "modified", "additions": 7, "deletions": 0, "changes": 7, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/97471c71bfe5d692043166106599eca3374b0370/gcc%2Fcp%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/97471c71bfe5d692043166106599eca3374b0370/gcc%2Fcp%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fcp%2FChangeLog?ref=97471c71bfe5d692043166106599eca3374b0370", "patch": "@@ -1,3 +1,10 @@\n+2009-11-17  Paolo Carlini  <paolo.carlini@oracle.com>\n+\n+\tPR c++/42058\n+\t* typeck2.c (digest_init_r): Check init for error_operand_p.\n+\t* decl.c (reshape_init_class): Check return value of reshape_init_r\n+\tfor error_mark_node.\n+\n 2009-11-17  Jakub Jelinek  <jakub@redhat.com>\n \n \tPR c++/42061"}, {"sha": "f57efb70d2d2fcdba19a2f61d105971413bc5cb3", "filename": "gcc/cp/decl.c", "status": "modified", "additions": 3, "deletions": 0, "changes": 3, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/97471c71bfe5d692043166106599eca3374b0370/gcc%2Fcp%2Fdecl.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/97471c71bfe5d692043166106599eca3374b0370/gcc%2Fcp%2Fdecl.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fcp%2Fdecl.c?ref=97471c71bfe5d692043166106599eca3374b0370", "patch": "@@ -4878,6 +4878,9 @@ reshape_init_class (tree type, reshape_iter *d, bool first_initializer_p)\n \n       field_init = reshape_init_r (TREE_TYPE (field), d,\n \t\t\t\t   /*first_initializer_p=*/false);\n+      if (field_init == error_mark_node)\n+\treturn error_mark_node;\n+\n       CONSTRUCTOR_APPEND_ELT (CONSTRUCTOR_ELTS (new_init), field, field_init);\n \n       /* [dcl.init.aggr]"}, {"sha": "6cb115202b291e81f051edc5e58a892fcaac0295", "filename": "gcc/cp/typeck2.c", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/97471c71bfe5d692043166106599eca3374b0370/gcc%2Fcp%2Ftypeck2.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/97471c71bfe5d692043166106599eca3374b0370/gcc%2Fcp%2Ftypeck2.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fcp%2Ftypeck2.c?ref=97471c71bfe5d692043166106599eca3374b0370", "patch": "@@ -723,7 +723,7 @@ digest_init_r (tree type, tree init, bool nested, int flags)\n {\n   enum tree_code code = TREE_CODE (type);\n \n-  if (init == error_mark_node)\n+  if (error_operand_p (init))\n     return error_mark_node;\n \n   gcc_assert (init);"}, {"sha": "0cbfda256254c989ec5dc9e5dc1c5db75c4a750a", "filename": "gcc/testsuite/ChangeLog", "status": "modified", "additions": 7, "deletions": 0, "changes": 7, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/97471c71bfe5d692043166106599eca3374b0370/gcc%2Ftestsuite%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/97471c71bfe5d692043166106599eca3374b0370/gcc%2Ftestsuite%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2FChangeLog?ref=97471c71bfe5d692043166106599eca3374b0370", "patch": "@@ -1,3 +1,10 @@\n+2009-11-17  Paolo Carlini  <paolo.carlini@oracle.com>\n+\n+\tPR c++/42058\n+\t* testsuite/g++.dg/init/array26.C: New.\n+\t* testsuite/g++.dg/init/array27.C: Likewise.\n+\t* testsuite/g++.old-deja/g++.benjamin/13478.C: Adjust dg-errors.\n+\n 2009-11-17  Jakub Jelinek  <jakub@redhat.com>\n \n \tPR c++/42061"}, {"sha": "83c4e0c4a4d77533c1aeba9aee44235eb45bf9d0", "filename": "gcc/testsuite/g++.dg/init/array26.C", "status": "added", "additions": 11, "deletions": 0, "changes": 11, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/97471c71bfe5d692043166106599eca3374b0370/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Finit%2Farray26.C", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/97471c71bfe5d692043166106599eca3374b0370/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Finit%2Farray26.C", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Finit%2Farray26.C?ref=97471c71bfe5d692043166106599eca3374b0370", "patch": "@@ -0,0 +1,11 @@\n+// PR c++/42058\n+// { dg-options \"\" }\n+\n+struct A;\n+\n+struct B\n+{\n+  A a; // { dg-error \"incomplete type\" }\n+};\n+\n+B b[1] = (B[]) { 0 }; // { dg-error \"initializer\" }"}, {"sha": "988501545f0d184f55b351acecc42a11e2b0e904", "filename": "gcc/testsuite/g++.dg/init/array27.C", "status": "added", "additions": 11, "deletions": 0, "changes": 11, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/97471c71bfe5d692043166106599eca3374b0370/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Finit%2Farray27.C", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/97471c71bfe5d692043166106599eca3374b0370/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Finit%2Farray27.C", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Finit%2Farray27.C?ref=97471c71bfe5d692043166106599eca3374b0370", "patch": "@@ -0,0 +1,11 @@\n+// PR c++/42058\n+// { dg-options \"\" }\n+\n+struct A {};\n+\n+struct B\n+{\n+  A a;\n+};\n+\n+B b[1] = (B[]) { 0 }; // { dg-error \"initializer\" }"}, {"sha": "e1d52e14b06580a420dae69b2c6e986c9a7716e1", "filename": "gcc/testsuite/g++.old-deja/g++.benjamin/13478.C", "status": "modified", "additions": 1, "deletions": 7, "changes": 8, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/97471c71bfe5d692043166106599eca3374b0370/gcc%2Ftestsuite%2Fg%2B%2B.old-deja%2Fg%2B%2B.benjamin%2F13478.C", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/97471c71bfe5d692043166106599eca3374b0370/gcc%2Ftestsuite%2Fg%2B%2B.old-deja%2Fg%2B%2B.benjamin%2F13478.C", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fg%2B%2B.old-deja%2Fg%2B%2B.benjamin%2F13478.C?ref=97471c71bfe5d692043166106599eca3374b0370", "patch": "@@ -27,10 +27,4 @@ const hand_table Agent::table_1[] =\n    {0,     &Agent::table_2},\n    {first, &Agent::foo},\n    {last,  &(hand)Agent::foo} // { dg-error \"\" } no match\n-}; // { dg-error \"\" } cannot convert\n-\n-\n-\n-\n-\n-\n+};"}]}