{"sha": "ac4983563d9b1ae724334d4228b93facea4bb515", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6YWM0OTgzNTYzZDliMWFlNzI0MzM0ZDQyMjhiOTNmYWNlYTRiYjUxNQ==", "commit": {"author": {"name": "Jonathan Wakely", "email": "jwakely.gcc@gmail.com", "date": "2010-03-02T23:00:21Z"}, "committer": {"name": "Jonathan Wakely", "email": "redi@gcc.gnu.org", "date": "2010-03-02T23:00:21Z"}, "message": "mutex (lock_guard::lock_guard): Do not lock mutex when adopt_lock_t constructor is used.\n\n2010-03-02  Jonathan Wakely  <jwakely.gcc@gmail.com>\n\n\t* include/std/mutex (lock_guard::lock_guard): Do not lock mutex when\n\tadopt_lock_t constructor is used.\n\t* testsuite/30_threads/lock_guard/cons/1.cc: New.\n\nFrom-SVN: r157180", "tree": {"sha": "dffb06e21aa318360062ec7e7b918d4c53a0638a", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/dffb06e21aa318360062ec7e7b918d4c53a0638a"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/ac4983563d9b1ae724334d4228b93facea4bb515", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/ac4983563d9b1ae724334d4228b93facea4bb515", "html_url": "https://github.com/Rust-GCC/gccrs/commit/ac4983563d9b1ae724334d4228b93facea4bb515", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/ac4983563d9b1ae724334d4228b93facea4bb515/comments", "author": null, "committer": {"login": "jwakely", "id": 1254480, "node_id": "MDQ6VXNlcjEyNTQ0ODA=", "avatar_url": "https://avatars.githubusercontent.com/u/1254480?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jwakely", "html_url": "https://github.com/jwakely", "followers_url": "https://api.github.com/users/jwakely/followers", "following_url": "https://api.github.com/users/jwakely/following{/other_user}", "gists_url": "https://api.github.com/users/jwakely/gists{/gist_id}", "starred_url": "https://api.github.com/users/jwakely/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jwakely/subscriptions", "organizations_url": "https://api.github.com/users/jwakely/orgs", "repos_url": "https://api.github.com/users/jwakely/repos", "events_url": "https://api.github.com/users/jwakely/events{/privacy}", "received_events_url": "https://api.github.com/users/jwakely/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "63ad150294cab86d1b9518fd46cff25c1a9abb3f", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/63ad150294cab86d1b9518fd46cff25c1a9abb3f", "html_url": "https://github.com/Rust-GCC/gccrs/commit/63ad150294cab86d1b9518fd46cff25c1a9abb3f"}], "stats": {"total": 89, "additions": 87, "deletions": 2}, "files": [{"sha": "86e26475f51d200d4ce31e909743678da95915ec", "filename": "libstdc++-v3/ChangeLog", "status": "modified", "additions": 6, "deletions": 0, "changes": 6, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/ac4983563d9b1ae724334d4228b93facea4bb515/libstdc%2B%2B-v3%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/ac4983563d9b1ae724334d4228b93facea4bb515/libstdc%2B%2B-v3%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libstdc%2B%2B-v3%2FChangeLog?ref=ac4983563d9b1ae724334d4228b93facea4bb515", "patch": "@@ -1,3 +1,9 @@\n+2010-03-02  Jonathan Wakely  <jwakely.gcc@gmail.com>\n+\n+\t* include/std/mutex (lock_guard::lock_guard): Do not lock mutex when\n+\tadopt_lock_t constructor is used.\n+\t* testsuite/30_threads/lock_guard/cons/1.cc: New.\n+\n 2010-03-02  Paolo Carlini  <paolo.carlini@oracle.com>\n \n \t* include/bits/stl_bvector.h (hash<vector<bool, _Alloc>>::"}, {"sha": "be435cd38e53af8a01b4b488dd3606adb5b1ed4a", "filename": "libstdc++-v3/include/std/mutex", "status": "modified", "additions": 2, "deletions": 2, "changes": 4, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/ac4983563d9b1ae724334d4228b93facea4bb515/libstdc%2B%2B-v3%2Finclude%2Fstd%2Fmutex", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/ac4983563d9b1ae724334d4228b93facea4bb515/libstdc%2B%2B-v3%2Finclude%2Fstd%2Fmutex", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libstdc%2B%2B-v3%2Finclude%2Fstd%2Fmutex?ref=ac4983563d9b1ae724334d4228b93facea4bb515", "patch": "@@ -398,8 +398,8 @@ namespace std\n       explicit lock_guard(mutex_type& __m) : _M_device(__m)\n       { _M_device.lock(); }\n \n-      lock_guard(mutex_type& __m, adopt_lock_t __a) : _M_device(__m)\n-      { _M_device.lock(); }\n+      lock_guard(mutex_type& __m, adopt_lock_t) : _M_device(__m)\n+      { } // calling thread owns mutex\n \n       ~lock_guard()\n       { _M_device.unlock(); }"}, {"sha": "f450d51b80b52ced427f0cad0e3ec4c6fcb96813", "filename": "libstdc++-v3/testsuite/30_threads/lock_guard/cons/1.cc", "status": "added", "additions": 79, "deletions": 0, "changes": 79, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/ac4983563d9b1ae724334d4228b93facea4bb515/libstdc%2B%2B-v3%2Ftestsuite%2F30_threads%2Flock_guard%2Fcons%2F1.cc", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/ac4983563d9b1ae724334d4228b93facea4bb515/libstdc%2B%2B-v3%2Ftestsuite%2F30_threads%2Flock_guard%2Fcons%2F1.cc", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libstdc%2B%2B-v3%2Ftestsuite%2F30_threads%2Flock_guard%2Fcons%2F1.cc?ref=ac4983563d9b1ae724334d4228b93facea4bb515", "patch": "@@ -0,0 +1,79 @@\n+// { dg-do run { target *-*-freebsd* *-*-netbsd* *-*-linux* *-*-solaris* *-*-cygwin *-*-darwin* alpha*-*-osf* mips-sgi-irix6* } }\n+// { dg-options \" -std=gnu++0x -pthread\" { target *-*-freebsd* *-*-netbsd* *-*-linux* alpha*-*-osf* mips-sgi-irix6* } }\n+// { dg-options \" -std=gnu++0x -pthreads\" { target *-*-solaris* } }\n+// { dg-options \" -std=gnu++0x \" { target *-*-cygwin *-*-darwin* } }\n+// { dg-require-cstdint \"\" }\n+// { dg-require-gthreads \"\" }\n+\n+// Copyright (C) 2010 Free Software Foundation, Inc.\n+//\n+// This file is part of the GNU ISO C++ Library.  This library is free\n+// software; you can redistribute it and/or modify it under the\n+// terms of the GNU General Public License as published by the\n+// Free Software Foundation; either version 3, or (at your option)\n+// any later version.\n+\n+// This library is distributed in the hope that it will be useful,\n+// but WITHOUT ANY WARRANTY; without even the implied warranty of\n+// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n+// GNU General Public License for more details.\n+\n+// You should have received a copy of the GNU General Public License along\n+// with this library; see the file COPYING3.  If not see\n+// <http://www.gnu.org/licenses/>.\n+\n+\n+#include <mutex>\n+#include <testsuite_hooks.h>\n+\n+struct Mutex\n+{\n+  Mutex() : locked(false) { }\n+\n+  ~Mutex()\n+  {\n+    if (locked)\n+      throw 0;\n+  }\n+\n+  void lock()\n+  {\n+    if (locked)\n+      throw 0;\n+    locked = true;\n+  }\n+\n+  void unlock()\n+  {\n+    if (!locked)\n+      throw 0;\n+    locked = false;\n+  }\n+\n+  bool locked;\n+};\n+\n+void test01()\n+{\n+  bool test __attribute__((unused)) = true;\n+\n+  Mutex m;\n+  m.lock();\n+\n+  try \n+    {\n+      std::lock_guard<Mutex> l(m, std::adopt_lock);\n+    }\n+  catch (...)\n+    {\n+      VERIFY( false );\n+    }\n+\n+  VERIFY( !m.locked );\n+}\n+\n+int main()\n+{\n+  test01();\n+  return 0;\n+}"}]}