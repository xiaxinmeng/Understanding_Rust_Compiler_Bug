{"sha": "51149a05b8cc8e4fc5a77a65857894daa371de89", "node_id": "C_kwDOANBUbNoAKDUxMTQ5YTA1YjhjYzhlNGZjNWE3N2E2NTg1Nzg5NGRhYTM3MWRlODk", "commit": {"author": {"name": "Martin Sebor", "email": "msebor@redhat.com", "date": "2022-03-03T20:58:00Z"}, "committer": {"name": "Martin Sebor", "email": "msebor@redhat.com", "date": "2022-03-03T20:58:31Z"}, "message": "Call mark_dfs_back_edges before testing EDGE_DFS_BACK [PR104761].\n\nResolves:\nPR middle-end/104761 - bogus -Wdangling-pointer with cleanup and infinite loop\n\ngcc/ChangeLog:\n\n\tPR middle-end/104761\n\t* gimple-ssa-warn-access.cc (pass_waccess::execute): Call\n\tmark_dfs_back_edges.\n\ngcc/testsuite/ChangeLog:\n\n\tPR middle-end/104761\n\t* g++.dg/warn/Wdangling-pointer-4.C: New test.\n\t* gcc.dg/Wdangling-pointer-4.c: New test.", "tree": {"sha": "3eee341fdde22b1263f7d97c368a513f16855717", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/3eee341fdde22b1263f7d97c368a513f16855717"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/51149a05b8cc8e4fc5a77a65857894daa371de89", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/51149a05b8cc8e4fc5a77a65857894daa371de89", "html_url": "https://github.com/Rust-GCC/gccrs/commit/51149a05b8cc8e4fc5a77a65857894daa371de89", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/51149a05b8cc8e4fc5a77a65857894daa371de89/comments", "author": {"login": "msebor", "id": 381149, "node_id": "MDQ6VXNlcjM4MTE0OQ==", "avatar_url": "https://avatars.githubusercontent.com/u/381149?v=4", "gravatar_id": "", "url": "https://api.github.com/users/msebor", "html_url": "https://github.com/msebor", "followers_url": "https://api.github.com/users/msebor/followers", "following_url": "https://api.github.com/users/msebor/following{/other_user}", "gists_url": "https://api.github.com/users/msebor/gists{/gist_id}", "starred_url": "https://api.github.com/users/msebor/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/msebor/subscriptions", "organizations_url": "https://api.github.com/users/msebor/orgs", "repos_url": "https://api.github.com/users/msebor/repos", "events_url": "https://api.github.com/users/msebor/events{/privacy}", "received_events_url": "https://api.github.com/users/msebor/received_events", "type": "User", "site_admin": false}, "committer": {"login": "msebor", "id": 381149, "node_id": "MDQ6VXNlcjM4MTE0OQ==", "avatar_url": "https://avatars.githubusercontent.com/u/381149?v=4", "gravatar_id": "", "url": "https://api.github.com/users/msebor", "html_url": "https://github.com/msebor", "followers_url": "https://api.github.com/users/msebor/followers", "following_url": "https://api.github.com/users/msebor/following{/other_user}", "gists_url": "https://api.github.com/users/msebor/gists{/gist_id}", "starred_url": "https://api.github.com/users/msebor/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/msebor/subscriptions", "organizations_url": "https://api.github.com/users/msebor/orgs", "repos_url": "https://api.github.com/users/msebor/repos", "events_url": "https://api.github.com/users/msebor/events{/privacy}", "received_events_url": "https://api.github.com/users/msebor/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "c083e654bd0f29a365ec957c4c0d4e713fb0b010", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/c083e654bd0f29a365ec957c4c0d4e713fb0b010", "html_url": "https://github.com/Rust-GCC/gccrs/commit/c083e654bd0f29a365ec957c4c0d4e713fb0b010"}], "stats": {"total": 49, "additions": 48, "deletions": 1}, "files": [{"sha": "b519712d76e3ada58abbdaf79c786fbd94f41454", "filename": "gcc/gimple-ssa-warn-access.cc", "status": "modified", "additions": 4, "deletions": 1, "changes": 5, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/51149a05b8cc8e4fc5a77a65857894daa371de89/gcc%2Fgimple-ssa-warn-access.cc", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/51149a05b8cc8e4fc5a77a65857894daa371de89/gcc%2Fgimple-ssa-warn-access.cc", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fgimple-ssa-warn-access.cc?ref=51149a05b8cc8e4fc5a77a65857894daa371de89", "patch": "@@ -47,7 +47,7 @@\n #include \"tree-object-size.h\"\n #include \"tree-ssa-strlen.h\"\n #include \"calls.h\"\n-#include \"cfgloop.h\"\n+#include \"cfganal.h\"\n #include \"intl.h\"\n #include \"gimple-range.h\"\n #include \"stringpool.h\"\n@@ -4710,6 +4710,9 @@ pass_waccess::execute (function *fun)\n   calculate_dominance_info (CDI_DOMINATORS);\n   calculate_dominance_info (CDI_POST_DOMINATORS);\n \n+  /* Set or clear EDGE_DFS_BACK bits on back edges.  */\n+  mark_dfs_back_edges (fun);\n+\n   /* Create a new ranger instance and associate it with FUN.  */\n   m_ptr_qry.rvals = enable_ranger (fun);\n   m_func = fun;"}, {"sha": "7177a545970c4be2a76dca362c3bfd03c777d1b2", "filename": "gcc/testsuite/g++.dg/warn/Wdangling-pointer-4.C", "status": "added", "additions": 22, "deletions": 0, "changes": 22, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/51149a05b8cc8e4fc5a77a65857894daa371de89/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Fwarn%2FWdangling-pointer-4.C", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/51149a05b8cc8e4fc5a77a65857894daa371de89/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Fwarn%2FWdangling-pointer-4.C", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Fwarn%2FWdangling-pointer-4.C?ref=51149a05b8cc8e4fc5a77a65857894daa371de89", "patch": "@@ -0,0 +1,22 @@\n+/* PR middle-end/104761 - bogus -Wdangling-pointer with cleanup and infinite loop\n+   { dg-do compile }\n+   { dg-options \"-O -Wall -fno-exceptions\" } */\n+\n+struct S { int i; };\n+\n+struct X { ~X (); };\n+\n+void g (int);\n+\n+void test (int i)\n+{\n+  S s = { 0 };\n+\n+  X x;\n+\n+  if (i)\n+    {\n+      g (s.i);                // { dg-bogus \"-Wdangling-pointer\" }\n+      for ( ; ; );\n+    }\n+}"}, {"sha": "36c8da5113a8338affd94d6b06cd5845daed20c3", "filename": "gcc/testsuite/gcc.dg/Wdangling-pointer-4.c", "status": "added", "additions": 22, "deletions": 0, "changes": 22, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/51149a05b8cc8e4fc5a77a65857894daa371de89/gcc%2Ftestsuite%2Fgcc.dg%2FWdangling-pointer-4.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/51149a05b8cc8e4fc5a77a65857894daa371de89/gcc%2Ftestsuite%2Fgcc.dg%2FWdangling-pointer-4.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgcc.dg%2FWdangling-pointer-4.c?ref=51149a05b8cc8e4fc5a77a65857894daa371de89", "patch": "@@ -0,0 +1,22 @@\n+/* PR middle-end/104761 - bogus -Wdangling-pointer with cleanup and infinite loop\n+   { dg-do compile }\n+   { dg-options \"-O -Wall\" } */\n+\n+typedef struct { int i; } S;\n+\n+void f (S **);\n+\n+int g (int);\n+\n+void nowarn (int x)\n+{\n+  S s = { 0 };\n+\n+  __attribute__((__cleanup__ (f))) S *p = 0;\n+\n+  if (x)\n+    {\n+      g (s.i);                // { dg-bogus \"-Wdangling-pointer\" }\n+      for ( ; ; );\n+    }\n+}"}]}