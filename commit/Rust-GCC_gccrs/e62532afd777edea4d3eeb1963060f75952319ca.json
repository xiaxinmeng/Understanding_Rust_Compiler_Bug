{"sha": "e62532afd777edea4d3eeb1963060f75952319ca", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6ZTYyNTMyYWZkNzc3ZWRlYTRkM2VlYjE5NjMwNjBmNzU5NTIzMTljYQ==", "commit": {"author": {"name": "Janus Weil", "email": "janus@gcc.gnu.org", "date": "2008-06-02T21:50:23Z"}, "committer": {"name": "Janus Weil", "email": "janus@gcc.gnu.org", "date": "2008-06-02T21:50:23Z"}, "message": "re PR fortran/36361 (attribute declaration outside of INTERFACE body)\n\n2008-06-02  Janus Weil  <janus@gcc.gnu.org>\n\n\tPR fortran/36361\n\t* symbol.c (gfc_add_allocatable,gfc_add_dimension,\n\tgfc_add_explicit_interface): Added checks.\n\t* decl.c (attr_decl1): Added missing \"var_locus\".\n\t* parse.c (parse_interface): Checking for errors.\n\n\n2008-06-02  Janus Weil  <janus@gcc.gnu.org>\n\n\tPR fortran/36361\n\t* gfortran.dg/interface_24.f90: New.\n\nFrom-SVN: r136296", "tree": {"sha": "9408c03560055917d4f9cd80a0cb49ed50dc1761", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/9408c03560055917d4f9cd80a0cb49ed50dc1761"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/e62532afd777edea4d3eeb1963060f75952319ca", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/e62532afd777edea4d3eeb1963060f75952319ca", "html_url": "https://github.com/Rust-GCC/gccrs/commit/e62532afd777edea4d3eeb1963060f75952319ca", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/e62532afd777edea4d3eeb1963060f75952319ca/comments", "author": {"login": "janusw", "id": 484108, "node_id": "MDQ6VXNlcjQ4NDEwOA==", "avatar_url": "https://avatars.githubusercontent.com/u/484108?v=4", "gravatar_id": "", "url": "https://api.github.com/users/janusw", "html_url": "https://github.com/janusw", "followers_url": "https://api.github.com/users/janusw/followers", "following_url": "https://api.github.com/users/janusw/following{/other_user}", "gists_url": "https://api.github.com/users/janusw/gists{/gist_id}", "starred_url": "https://api.github.com/users/janusw/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/janusw/subscriptions", "organizations_url": "https://api.github.com/users/janusw/orgs", "repos_url": "https://api.github.com/users/janusw/repos", "events_url": "https://api.github.com/users/janusw/events{/privacy}", "received_events_url": "https://api.github.com/users/janusw/received_events", "type": "User", "site_admin": false}, "committer": {"login": "janusw", "id": 484108, "node_id": "MDQ6VXNlcjQ4NDEwOA==", "avatar_url": "https://avatars.githubusercontent.com/u/484108?v=4", "gravatar_id": "", "url": "https://api.github.com/users/janusw", "html_url": "https://github.com/janusw", "followers_url": "https://api.github.com/users/janusw/followers", "following_url": "https://api.github.com/users/janusw/following{/other_user}", "gists_url": "https://api.github.com/users/janusw/gists{/gist_id}", "starred_url": "https://api.github.com/users/janusw/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/janusw/subscriptions", "organizations_url": "https://api.github.com/users/janusw/orgs", "repos_url": "https://api.github.com/users/janusw/repos", "events_url": "https://api.github.com/users/janusw/events{/privacy}", "received_events_url": "https://api.github.com/users/janusw/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "80d7287f402d124caef566cbcbe023ebfab62f28", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/80d7287f402d124caef566cbcbe023ebfab62f28", "html_url": "https://github.com/Rust-GCC/gccrs/commit/80d7287f402d124caef566cbcbe023ebfab62f28"}], "stats": {"total": 123, "additions": 110, "deletions": 13}, "files": [{"sha": "fd0817becbd3af40be3714d0734658674826f25e", "filename": "gcc/fortran/ChangeLog", "status": "modified", "additions": 8, "deletions": 0, "changes": 8, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/e62532afd777edea4d3eeb1963060f75952319ca/gcc%2Ffortran%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/e62532afd777edea4d3eeb1963060f75952319ca/gcc%2Ffortran%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ffortran%2FChangeLog?ref=e62532afd777edea4d3eeb1963060f75952319ca", "patch": "@@ -1,3 +1,11 @@\n+2008-06-02  Janus Weil  <janus@gcc.gnu.org>\n+\n+\tPR fortran/36361\n+\t* symbol.c (gfc_add_allocatable,gfc_add_dimension,\n+\tgfc_add_explicit_interface): Added checks.\n+\t* decl.c (attr_decl1): Added missing \"var_locus\".\n+\t* parse.c (parse_interface): Checking for errors.\n+\n 2008-06-02  Daniel Kraft  <d@domob.eu>\n \n \t* gfortran.h:  New statement-type ST_FINAL for FINAL declarations."}, {"sha": "ea87c211d4938677847e9ddc4e2773e7a65ff51b", "filename": "gcc/fortran/decl.c", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/e62532afd777edea4d3eeb1963060f75952319ca/gcc%2Ffortran%2Fdecl.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/e62532afd777edea4d3eeb1963060f75952319ca/gcc%2Ffortran%2Fdecl.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ffortran%2Fdecl.c?ref=e62532afd777edea4d3eeb1963060f75952319ca", "patch": "@@ -5216,7 +5216,7 @@ attr_decl1 (void)\n   /* Update symbol table.  DIMENSION attribute is set\n      in gfc_set_array_spec().  */\n   if (current_attr.dimension == 0\n-      && gfc_copy_attr (&sym->attr, &current_attr, NULL) == FAILURE)\n+      && gfc_copy_attr (&sym->attr, &current_attr, &var_locus) == FAILURE)\n     {\n       m = MATCH_ERROR;\n       goto cleanup;"}, {"sha": "33f13c92200734062929b67e12b63d0165f6d258", "filename": "gcc/fortran/parse.c", "status": "modified", "additions": 7, "deletions": 12, "changes": 19, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/e62532afd777edea4d3eeb1963060f75952319ca/gcc%2Ffortran%2Fparse.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/e62532afd777edea4d3eeb1963060f75952319ca/gcc%2Ffortran%2Fparse.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ffortran%2Fparse.c?ref=e62532afd777edea4d3eeb1963060f75952319ca", "patch": "@@ -1974,23 +1974,18 @@ parse_interface (void)\n       unexpected_eof ();\n \n     case ST_SUBROUTINE:\n-      new_state = COMP_SUBROUTINE;\n-      gfc_add_explicit_interface (gfc_new_block, IFSRC_IFBODY,\n-\t\t\t\t  gfc_new_block->formal, NULL);\n-      if (current_interface.type != INTERFACE_ABSTRACT &&\n-\t !gfc_new_block->attr.dummy &&\n-\t gfc_add_external (&gfc_new_block->attr, &gfc_current_locus) == FAILURE)\n+    case ST_FUNCTION:\n+      if (st == ST_SUBROUTINE)\n+\tnew_state = COMP_SUBROUTINE;\n+      else if (st == ST_FUNCTION)\n+\tnew_state = COMP_FUNCTION;\n+      if (gfc_add_explicit_interface (gfc_new_block, IFSRC_IFBODY,\n+\t\t\t\t  gfc_new_block->formal, NULL) == FAILURE)\n \t{\n \t  reject_statement ();\n \t  gfc_free_namespace (gfc_current_ns);\n \t  goto loop;\n \t}\n-      break;\n-\n-    case ST_FUNCTION:\n-      new_state = COMP_FUNCTION;\n-      gfc_add_explicit_interface (gfc_new_block, IFSRC_IFBODY,\n-\t\t\t\t  gfc_new_block->formal, NULL);\n       if (current_interface.type != INTERFACE_ABSTRACT &&\n \t !gfc_new_block->attr.dummy &&\n \t gfc_add_external (&gfc_new_block->attr, &gfc_current_locus) == FAILURE)"}, {"sha": "e4e43244d59ec4e4a8fddb9abd29de9037b42c95", "filename": "gcc/fortran/symbol.c", "status": "modified", "additions": 23, "deletions": 0, "changes": 23, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/e62532afd777edea4d3eeb1963060f75952319ca/gcc%2Ffortran%2Fsymbol.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/e62532afd777edea4d3eeb1963060f75952319ca/gcc%2Ffortran%2Fsymbol.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ffortran%2Fsymbol.c?ref=e62532afd777edea4d3eeb1963060f75952319ca", "patch": "@@ -814,6 +814,14 @@ gfc_add_allocatable (symbol_attribute *attr, locus *where)\n       return FAILURE;\n     }\n \n+  if (attr->flavor == FL_PROCEDURE && attr->if_source == IFSRC_IFBODY\n+      && gfc_find_state (COMP_INTERFACE) == FAILURE)\n+    {\n+      gfc_error (\"ALLOCATABLE specified outside of INTERFACE body at %L\",\n+\t\t where);\n+      return FAILURE;\n+    }\n+\n   attr->allocatable = 1;\n   return check_conflict (attr, NULL, where);\n }\n@@ -832,6 +840,14 @@ gfc_add_dimension (symbol_attribute *attr, const char *name, locus *where)\n       return FAILURE;\n     }\n \n+  if (attr->flavor == FL_PROCEDURE && attr->if_source == IFSRC_IFBODY\n+      && gfc_find_state (COMP_INTERFACE) == FAILURE)\n+    {\n+      gfc_error (\"DIMENSION specified for '%s' outside its INTERFACE body \"\n+\t\t \"at %L\", name, where);\n+      return FAILURE;\n+    }\n+\n   attr->dimension = 1;\n   return check_conflict (attr, name, where);\n }\n@@ -1453,6 +1469,13 @@ gfc_add_explicit_interface (gfc_symbol *sym, ifsrc source,\n       return FAILURE;\n     }\n \n+  if (source == IFSRC_IFBODY && (sym->attr.dimension || sym->attr.allocatable))\n+    {\n+      gfc_error (\"'%s' at %L has attributes specified outside its INTERFACE \"\n+\t\t \"body\", sym->name, where);\n+      return FAILURE;\n+    }\n+\n   sym->formal = formal;\n   sym->attr.if_source = source;\n "}, {"sha": "efb1b2ac6432a1a815c7e7d0bc47c3eff45c071d", "filename": "gcc/testsuite/ChangeLog", "status": "modified", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/e62532afd777edea4d3eeb1963060f75952319ca/gcc%2Ftestsuite%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/e62532afd777edea4d3eeb1963060f75952319ca/gcc%2Ftestsuite%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2FChangeLog?ref=e62532afd777edea4d3eeb1963060f75952319ca", "patch": "@@ -1,3 +1,8 @@\n+2008-06-02  Janus Weil  <janus@gcc.gnu.org>\n+\n+\tPR fortran/36361\n+\t* gfortran.dg/interface_24.f90: New.\n+\n 2008-06-02  Paolo Carlini  <paolo.carlini@oracle.com>\n \n         PR c++/36404"}, {"sha": "1afc5ef2fbac06b77923ee7277d46eba866df5ab", "filename": "gcc/testsuite/gfortran.dg/interface_24.f90", "status": "added", "additions": 66, "deletions": 0, "changes": 66, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/e62532afd777edea4d3eeb1963060f75952319ca/gcc%2Ftestsuite%2Fgfortran.dg%2Finterface_24.f90", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/e62532afd777edea4d3eeb1963060f75952319ca/gcc%2Ftestsuite%2Fgfortran.dg%2Finterface_24.f90", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgfortran.dg%2Finterface_24.f90?ref=e62532afd777edea4d3eeb1963060f75952319ca", "patch": "@@ -0,0 +1,66 @@\n+! { dg-do compile }\n+!\n+! This tests the fix for PR36361: If a function was declared in an INTERFACE\n+! statement, no attributes may be declared outside of the INTERFACE body.\n+!\n+! Contributed by Janus Weil <janus@gcc.gnu.org>\n+\n+module m1\n+  interface\n+    real function f1()\n+    end function\n+  end interface\n+  dimension :: f1(4)  ! { dg-error \"outside its INTERFACE body\" }\n+end module\n+\n+\n+module m2\n+  dimension :: f2(4)\n+  interface\n+    real function f2()  ! { dg-error \"outside its INTERFACE body\" }\n+    !end function\n+  end interface\n+end module\n+\n+\n+! valid\n+module m3\n+  interface\n+    real function f3()\n+      dimension :: f3(4)\n+    end function\n+  end interface\n+end module\n+\n+\n+module m4\n+  interface\n+    function f4()  ! { dg-error \"cannot have a deferred shape\" }\n+      real :: f4(:)\n+    end function\n+  end interface\n+  allocatable :: f4  ! { dg-error \"outside of INTERFACE body\" }\n+end module\n+\n+\n+module m5\n+  allocatable :: f5(:)\n+  interface\n+    function f5()  ! { dg-error \"outside its INTERFACE body\" }\n+      !real f5(:)\n+    !end function\n+  end interface\n+end module\n+\n+\n+!valid\n+module m6\n+  interface\n+    function f6()\n+      real f6(:)\n+      allocatable :: f6\n+    end function\n+  end interface\n+end module\n+\n+! { dg-final { cleanup-modules \"m1 m2 m3 m4 m5 m6\" } }"}]}