{"sha": "5857042a2b3dd635fc6cae214abd60d3a8336060", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6NTg1NzA0MmEyYjNkZDYzNWZjNmNhZTIxNGFiZDYwZDNhODMzNjA2MA==", "commit": {"author": {"name": "Marek Polacek", "email": "polacek@redhat.com", "date": "2019-08-23T22:04:32Z"}, "committer": {"name": "Marek Polacek", "email": "mpolacek@gcc.gnu.org", "date": "2019-08-23T22:04:32Z"}, "message": "PR c++/79817 - attribute deprecated on namespace.\n\n\t* cp-tree.h (cp_warn_deprecated_use_scopes): Declare.\n\t* decl.c (grokdeclarator): Call cp_warn_deprecated_use_scopes.\n\t(type_is_deprecated): Likewise.\n\t* decl2.c (cp_warn_deprecated_use_scopes): New function.\n\t* name-lookup.c (handle_namespace_attrs): Handle attribute deprecated.\n\t* parser.c (cp_parser_namespace_alias_definition): Call\n\tcp_warn_deprecated_use_scopes.\n\t(cp_parser_using_declaration): Likewise.\n\t(cp_parser_using_directive): Likewise.\n\t* semantics.c (finish_id_expression_1): Likewise.\n\n\t* g++.dg/cpp0x/attributes-namespace1.C: New test.\n\t* g++.dg/cpp0x/attributes-namespace2.C: New test.\n\t* g++.dg/cpp0x/attributes-namespace3.C: New test.\n\t* g++.dg/cpp0x/attributes-namespace4.C: New test.\n\t* g++.dg/cpp0x/attributes-namespace5.C: New test.\n\t* g++.dg/cpp1z/namespace-attribs.C: Adjust.\n\t* g++.dg/cpp1z/namespace-attribs2.C: Adjust.\n\nFrom-SVN: r274888", "tree": {"sha": "4d3f8bb0abb57d1a94a4245e00b078312eb47513", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/4d3f8bb0abb57d1a94a4245e00b078312eb47513"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/5857042a2b3dd635fc6cae214abd60d3a8336060", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/5857042a2b3dd635fc6cae214abd60d3a8336060", "html_url": "https://github.com/Rust-GCC/gccrs/commit/5857042a2b3dd635fc6cae214abd60d3a8336060", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/5857042a2b3dd635fc6cae214abd60d3a8336060/comments", "author": {"login": "mpolacek", "id": 10496300, "node_id": "MDQ6VXNlcjEwNDk2MzAw", "avatar_url": "https://avatars.githubusercontent.com/u/10496300?v=4", "gravatar_id": "", "url": "https://api.github.com/users/mpolacek", "html_url": "https://github.com/mpolacek", "followers_url": "https://api.github.com/users/mpolacek/followers", "following_url": "https://api.github.com/users/mpolacek/following{/other_user}", "gists_url": "https://api.github.com/users/mpolacek/gists{/gist_id}", "starred_url": "https://api.github.com/users/mpolacek/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/mpolacek/subscriptions", "organizations_url": "https://api.github.com/users/mpolacek/orgs", "repos_url": "https://api.github.com/users/mpolacek/repos", "events_url": "https://api.github.com/users/mpolacek/events{/privacy}", "received_events_url": "https://api.github.com/users/mpolacek/received_events", "type": "User", "site_admin": false}, "committer": null, "parents": [{"sha": "d0fc6e9f69b27fa93438c306fd9b25404982c2ea", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/d0fc6e9f69b27fa93438c306fd9b25404982c2ea", "html_url": "https://github.com/Rust-GCC/gccrs/commit/d0fc6e9f69b27fa93438c306fd9b25404982c2ea"}], "stats": {"total": 259, "additions": 252, "deletions": 7}, "files": [{"sha": "5a59f984af0355b90048f9ac57bddd4d17f0d3c9", "filename": "gcc/cp/ChangeLog", "status": "modified", "additions": 14, "deletions": 0, "changes": 14, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/5857042a2b3dd635fc6cae214abd60d3a8336060/gcc%2Fcp%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/5857042a2b3dd635fc6cae214abd60d3a8336060/gcc%2Fcp%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fcp%2FChangeLog?ref=5857042a2b3dd635fc6cae214abd60d3a8336060", "patch": "@@ -1,3 +1,17 @@\n+2019-08-23  Marek Polacek  <polacek@redhat.com>\n+\n+\tPR c++/79817 - attribute deprecated on namespace.\n+\t* cp-tree.h (cp_warn_deprecated_use_scopes): Declare.\n+\t* decl.c (grokdeclarator): Call cp_warn_deprecated_use_scopes.\n+\t(type_is_deprecated): Likewise.\n+\t* decl2.c (cp_warn_deprecated_use_scopes): New function.\n+\t* name-lookup.c (handle_namespace_attrs): Handle attribute deprecated.\n+\t* parser.c (cp_parser_namespace_alias_definition): Call\n+\tcp_warn_deprecated_use_scopes.\n+\t(cp_parser_using_declaration): Likewise.\n+\t(cp_parser_using_directive): Likewise.\n+\t* semantics.c (finish_id_expression_1): Likewise.\n+\n 2019-08-23  Nathan Sidwell  <nathan@acm.org>\n \n \t* class.c (check_for_override): Checking IDENTIFIER_VIRTUAL_P is"}, {"sha": "42f180d1dd3669d23f69d62a4fb541967b7f5314", "filename": "gcc/cp/cp-tree.h", "status": "modified", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/5857042a2b3dd635fc6cae214abd60d3a8336060/gcc%2Fcp%2Fcp-tree.h", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/5857042a2b3dd635fc6cae214abd60d3a8336060/gcc%2Fcp%2Fcp-tree.h", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fcp%2Fcp-tree.h?ref=5857042a2b3dd635fc6cae214abd60d3a8336060", "patch": "@@ -6264,6 +6264,7 @@ extern bool is_list_ctor\t\t\t(tree);\n extern void validate_conversion_obstack\t\t(void);\n extern void mark_versions_used\t\t\t(tree);\n extern bool cp_warn_deprecated_use\t\t(tree, tsubst_flags_t = tf_warning_or_error);\n+extern void cp_warn_deprecated_use_scopes\t(tree);\n extern tree get_function_version_dispatcher\t(tree);\n \n /* in class.c */"}, {"sha": "cb5571e4f24465c34717d2a9c3f8bc684bce49e2", "filename": "gcc/cp/decl.c", "status": "modified", "additions": 5, "deletions": 1, "changes": 6, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/5857042a2b3dd635fc6cae214abd60d3a8336060/gcc%2Fcp%2Fdecl.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/5857042a2b3dd635fc6cae214abd60d3a8336060/gcc%2Fcp%2Fdecl.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fcp%2Fdecl.c?ref=5857042a2b3dd635fc6cae214abd60d3a8336060", "patch": "@@ -10791,6 +10791,7 @@ grokdeclarator (const cp_declarator *declarator,\n   cp_warn_deprecated_use (type);\n   if (type && TREE_CODE (type) == TYPE_DECL)\n     {\n+      cp_warn_deprecated_use_scopes (CP_DECL_CONTEXT (type));\n       typedef_decl = type;\n       type = TREE_TYPE (typedef_decl);\n       if (DECL_ARTIFICIAL (typedef_decl))\n@@ -13230,7 +13231,10 @@ type_is_deprecated (tree type)\n       if (TREE_DEPRECATED (TYPE_NAME (type)))\n \treturn type;\n       else\n-\treturn NULL_TREE;\n+\t{\n+\t  cp_warn_deprecated_use_scopes (CP_DECL_CONTEXT (TYPE_NAME (type)));\n+\t  return NULL_TREE;\n+\t}\n     }\n \n   /* Do warn about using typedefs to a deprecated class.  */"}, {"sha": "aca37a28f494e8b6ac6188084ac6ef8189e9fcf3", "filename": "gcc/cp/decl2.c", "status": "modified", "additions": 18, "deletions": 0, "changes": 18, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/5857042a2b3dd635fc6cae214abd60d3a8336060/gcc%2Fcp%2Fdecl2.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/5857042a2b3dd635fc6cae214abd60d3a8336060/gcc%2Fcp%2Fdecl2.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fcp%2Fdecl2.c?ref=5857042a2b3dd635fc6cae214abd60d3a8336060", "patch": "@@ -5407,6 +5407,24 @@ cp_warn_deprecated_use (tree decl, tsubst_flags_t complain)\n   return warned;\n }\n \n+/* Like above, but takes into account outer scopes.  */\n+\n+void\n+cp_warn_deprecated_use_scopes (tree scope)\n+{\n+  while (scope\n+\t && scope != error_mark_node\n+\t && scope != global_namespace)\n+    {\n+      if (cp_warn_deprecated_use (scope))\n+\treturn;\n+      if (TYPE_P (scope))\n+\tscope = CP_TYPE_CONTEXT (scope);\n+      else\n+\tscope = CP_DECL_CONTEXT (scope);\n+    }\n+}\n+\n /* Mark DECL (either a _DECL or a BASELINK) as \"used\" in the program.\n    If DECL is a specialization or implicitly declared class member,\n    generate the actual definition.  Return false if something goes"}, {"sha": "a8ab4db4d0d91612e557026bacc5600b0b12644b", "filename": "gcc/cp/name-lookup.c", "status": "modified", "additions": 18, "deletions": 0, "changes": 18, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/5857042a2b3dd635fc6cae214abd60d3a8336060/gcc%2Fcp%2Fname-lookup.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/5857042a2b3dd635fc6cae214abd60d3a8336060/gcc%2Fcp%2Fname-lookup.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fcp%2Fname-lookup.c?ref=5857042a2b3dd635fc6cae214abd60d3a8336060", "patch": "@@ -4905,6 +4905,24 @@ handle_namespace_attrs (tree ns, tree attributes)\n \t    DECL_ATTRIBUTES (ns) = tree_cons (name, args,\n \t\t\t\t\t      DECL_ATTRIBUTES (ns));\n \t}\n+      else if (is_attribute_p (\"deprecated\", name))\n+\t{\n+\t  if (!DECL_NAME (ns))\n+\t    {\n+\t      warning (OPT_Wattributes, \"ignoring %qD attribute on anonymous \"\n+\t\t       \"namespace\", name);\n+\t      continue;\n+\t    }\n+\t  if (args && TREE_CODE (TREE_VALUE (args)) != STRING_CST)\n+\t    {\n+\t      error (\"deprecated message is not a string\");\n+\t      continue;\n+\t    }\n+\t  TREE_DEPRECATED (ns) = 1;\n+\t  if (args)\n+\t    DECL_ATTRIBUTES (ns) = tree_cons (name, args,\n+\t\t\t\t\t      DECL_ATTRIBUTES (ns));\n+\t}\n       else\n \t{\n \t  warning (OPT_Wattributes, \"%qD attribute directive ignored\","}, {"sha": "535147875548baa52f1c08838cfa43ce118254f0", "filename": "gcc/cp/parser.c", "status": "modified", "additions": 4, "deletions": 0, "changes": 4, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/5857042a2b3dd635fc6cae214abd60d3a8336060/gcc%2Fcp%2Fparser.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/5857042a2b3dd635fc6cae214abd60d3a8336060/gcc%2Fcp%2Fparser.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fcp%2Fparser.c?ref=5857042a2b3dd635fc6cae214abd60d3a8336060", "patch": "@@ -19378,6 +19378,7 @@ cp_parser_namespace_alias_definition (cp_parser* parser)\n   /* Look for the qualified-namespace-specifier.  */\n   namespace_specifier\n     = cp_parser_qualified_namespace_specifier (parser);\n+  cp_warn_deprecated_use_scopes (namespace_specifier);\n   /* Look for the `;' token.  */\n   cp_parser_require (parser, CPP_SEMICOLON, RT_SEMICOLON);\n \n@@ -19492,6 +19493,8 @@ cp_parser_using_declaration (cp_parser* parser,\n \t   && !TYPE_FUNCTION_SCOPE_P (qscope))\n     qscope = CP_TYPE_CONTEXT (qscope);\n \n+  cp_warn_deprecated_use_scopes (qscope);\n+\n   if (access_declaration_p && cp_parser_error_occurred (parser))\n     /* Something has already gone wrong; there's no need to parse\n        further.  Since an error has occurred, the return value of\n@@ -19752,6 +19755,7 @@ cp_parser_using_directive (cp_parser* parser)\n \t\t\t\t       /*is_declaration=*/true);\n   /* Get the namespace being used.  */\n   namespace_decl = cp_parser_namespace_name (parser);\n+  cp_warn_deprecated_use_scopes (namespace_decl);\n   /* And any specified attributes.  */\n   attribs = cp_parser_attributes_opt (parser);\n "}, {"sha": "8aec4eff9b3bc17a018158f69b7b17d5ad493433", "filename": "gcc/cp/semantics.c", "status": "modified", "additions": 2, "deletions": 0, "changes": 2, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/5857042a2b3dd635fc6cae214abd60d3a8336060/gcc%2Fcp%2Fsemantics.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/5857042a2b3dd635fc6cae214abd60d3a8336060/gcc%2Fcp%2Fsemantics.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fcp%2Fsemantics.c?ref=5857042a2b3dd635fc6cae214abd60d3a8336060", "patch": "@@ -3811,6 +3811,8 @@ finish_id_expression_1 (tree id_expression,\n \t  if (TREE_CODE (decl) == FUNCTION_DECL)\n \t    mark_used (decl);\n \n+\t  cp_warn_deprecated_use_scopes (scope);\n+\n \t  if (TYPE_P (scope))\n \t    decl = finish_qualified_id_expr (scope,\n \t\t\t\t\t     decl,"}, {"sha": "8e9071371647255fe61c59cfc393aa9ea777d593", "filename": "gcc/testsuite/ChangeLog", "status": "modified", "additions": 11, "deletions": 0, "changes": 11, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/5857042a2b3dd635fc6cae214abd60d3a8336060/gcc%2Ftestsuite%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/5857042a2b3dd635fc6cae214abd60d3a8336060/gcc%2Ftestsuite%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2FChangeLog?ref=5857042a2b3dd635fc6cae214abd60d3a8336060", "patch": "@@ -1,3 +1,14 @@\n+2019-08-23  Marek Polacek  <polacek@redhat.com>\n+\n+\tPR c++/79817 - attribute deprecated on namespace.\n+\t* g++.dg/cpp0x/attributes-namespace1.C: New test.\n+\t* g++.dg/cpp0x/attributes-namespace2.C: New test.\n+\t* g++.dg/cpp0x/attributes-namespace3.C: New test.\n+\t* g++.dg/cpp0x/attributes-namespace4.C: New test.\n+\t* g++.dg/cpp0x/attributes-namespace5.C: New test.\n+\t* g++.dg/cpp1z/namespace-attribs.C: Adjust.\n+\t* g++.dg/cpp1z/namespace-attribs2.C: Adjust.\n+\n 2019-08-23  Mihailo Stojanovic  <mistojanovic@wavecomp.com>\n \n \t* gcc.target/mips/get-fcsr-3.c: New test."}, {"sha": "d49ebb0b7210d03c0d6d01695688dc22ff7df2bf", "filename": "gcc/testsuite/g++.dg/cpp0x/attributes-namespace1.C", "status": "added", "additions": 50, "deletions": 0, "changes": 50, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/5857042a2b3dd635fc6cae214abd60d3a8336060/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Fcpp0x%2Fattributes-namespace1.C", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/5857042a2b3dd635fc6cae214abd60d3a8336060/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Fcpp0x%2Fattributes-namespace1.C", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Fcpp0x%2Fattributes-namespace1.C?ref=5857042a2b3dd635fc6cae214abd60d3a8336060", "patch": "@@ -0,0 +1,50 @@\n+// PR c++/79817 - attribute deprecated on namespace.\n+// { dg-do compile { target c++11 } }\n+\n+namespace [[deprecated]] ns1 { int i; }\n+namespace [[deprecated(\"foo\")]] ns2 { int i; }\n+namespace __attribute__((deprecated)) ns3 { int i; }\n+namespace __attribute__((deprecated(\"foo\"))) ns4 { int i; }\n+\n+namespace [[deprecated]] ns6\n+{\n+  enum E { X };\n+  void fn();\n+}\n+\n+namespace [[deprecated]] ns7\n+{\n+  namespace ns8 {\n+    int x;\n+    struct Z { };\n+  }\n+  struct S { };\n+}\n+\n+namespace N1\n+{\n+  namespace N2\n+  {\n+    namespace [[deprecated]] N3\n+    {\n+      namespace N4 { int x; }\n+    }\n+  }\n+}\n+\n+void\n+f ()\n+{\n+  ns1::i = 0; // { dg-warning \".ns1. is deprecated\" }\n+  ns2::i = 0; // { dg-warning \".ns2. is deprecated: foo\" }\n+  ns3::i = 0; // { dg-warning \".ns3. is deprecated\" }\n+  ns4::i = 0; // { dg-warning \".ns4. is deprecated\" }\n+  int i = ns1::i; // { dg-warning \".ns1. is deprecated\" }\n+  int k = ns6::E::X;  // { dg-warning \".ns6. is deprecated\" }\n+  ns7::ns8::x = 42; // { dg-warning \".ns7. is deprecated\" }\n+  N1::N2::N3::N4::x = 42; // { dg-warning \".N1::N2::N3. is deprecated\" }\n+  ns6::fn(); // { dg-warning \".ns6. is deprecated\" }\n+  ns7::S s; // { dg-warning \".ns7. is deprecated\" }\n+  ns7::S sfn(int); // { dg-warning \".ns7. is deprecated\" }\n+  ns7::ns8::Z sfn2(int); // { dg-warning \".ns7. is deprecated\" }\n+}"}, {"sha": "08a043a24e329b39130ab2e1780a5643ecd987f7", "filename": "gcc/testsuite/g++.dg/cpp0x/attributes-namespace2.C", "status": "added", "additions": 27, "deletions": 0, "changes": 27, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/5857042a2b3dd635fc6cae214abd60d3a8336060/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Fcpp0x%2Fattributes-namespace2.C", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/5857042a2b3dd635fc6cae214abd60d3a8336060/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Fcpp0x%2Fattributes-namespace2.C", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Fcpp0x%2Fattributes-namespace2.C?ref=5857042a2b3dd635fc6cae214abd60d3a8336060", "patch": "@@ -0,0 +1,27 @@\n+// PR c++/79817 - attribute deprecated on namespace.\n+// { dg-do compile { target c++11 } }\n+\n+namespace [[deprecated]] { // { dg-warning \"ignoring .deprecated. attribute on anonymous namespace\" }\n+  int nn;\n+}\n+\n+inline namespace [[deprecated]] I { \n+  int x;\n+}\n+\n+namespace M {\n+  int y;\n+  inline namespace [[deprecated]] N {\n+    int x;\n+  }\n+}\n+\n+void\n+g ()\n+{\n+  nn = 42;\n+  I::x = 42; // { dg-warning \".I. is deprecated\" }\n+  M::x = 42;\n+  M::y = 42;\n+  M::N::x = 42; // { dg-warning \".M::N. is deprecated\" }\n+}"}, {"sha": "81355ab56773a5d0d6e23acd6c615c4c7de897f2", "filename": "gcc/testsuite/g++.dg/cpp0x/attributes-namespace3.C", "status": "added", "additions": 33, "deletions": 0, "changes": 33, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/5857042a2b3dd635fc6cae214abd60d3a8336060/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Fcpp0x%2Fattributes-namespace3.C", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/5857042a2b3dd635fc6cae214abd60d3a8336060/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Fcpp0x%2Fattributes-namespace3.C", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Fcpp0x%2Fattributes-namespace3.C?ref=5857042a2b3dd635fc6cae214abd60d3a8336060", "patch": "@@ -0,0 +1,33 @@\n+// PR c++/79817 - attribute deprecated on namespace.\n+// { dg-do compile { target c++11 } }\n+\n+namespace [[deprecated]] N\n+{\n+  typedef decltype(sizeof(int)) T;\n+  int x;\n+\n+  namespace N2 {\n+    typedef decltype(sizeof(int)) T;\n+    int y;\n+  }\n+}\n+\n+namespace M {\n+  namespace [[deprecated]] M2 {\n+    typedef decltype(sizeof(int)) T;\n+    int z;\n+  }\n+}\n+\n+void\n+fn2 ()\n+{\n+  using N::x; // { dg-warning \".N. is deprecated\" }\n+  N::T j; // { dg-warning \".N. is deprecated\" }\n+\n+  using M::M2::z; // { dg-warning \".M::M2. is deprecated\" }\n+  M::M2::T l; // { dg-warning \".M::M2. is deprecated\" }\n+\n+  using N::N2::y; // { dg-warning \".N. is deprecated\" }\n+  N::N2::T k; // { dg-warning \".N. is deprecated\" }\n+}"}, {"sha": "de0c6df8d9d0dad701afe70c4b4c67d58cd5308c", "filename": "gcc/testsuite/g++.dg/cpp0x/attributes-namespace4.C", "status": "added", "additions": 45, "deletions": 0, "changes": 45, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/5857042a2b3dd635fc6cae214abd60d3a8336060/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Fcpp0x%2Fattributes-namespace4.C", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/5857042a2b3dd635fc6cae214abd60d3a8336060/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Fcpp0x%2Fattributes-namespace4.C", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Fcpp0x%2Fattributes-namespace4.C?ref=5857042a2b3dd635fc6cae214abd60d3a8336060", "patch": "@@ -0,0 +1,45 @@\n+// PR c++/79817 - attribute deprecated on namespace.\n+// { dg-do compile { target c++11 } }\n+\n+namespace [[deprecated]] N {\n+  struct S { };\n+  using T = int;\n+  const int value = 42;\n+  int arr[10];\n+}\n+\n+namespace [[deprecated]] Y {\n+  int x;\n+  int i = x;\n+}\n+\n+namespace [[deprecated]] M {\n+  namespace M2 {\n+  }\n+}\n+\n+enum E { F =  N::value }; // { dg-warning \".N. is deprecated\" }\n+\n+template<N::T> // { dg-warning \".N. is deprecated\" }\n+struct X { };\n+\n+N::T foo(); // { dg-warning \".N. is deprecated\" }\n+\n+void\n+g(N::T p) // { dg-warning \".N. is deprecated\" }\n+{\n+  N::S s; // { dg-warning \".N. is deprecated\" }\n+  N::arr[0] = 42; // { dg-warning \".N. is deprecated\" }\n+}\n+\n+namespace Z = Y; // { dg-warning \".Y. is deprecated\" }\n+namespace Z2 = M::M2; // { dg-warning \".M. is deprecated\" }\n+\n+void\n+g2 ()\n+{\n+  using namespace Y; // { dg-warning \".Y. is deprecated\" }\n+  using namespace M::M2; // { dg-warning \".M. is deprecated\" }\n+  using TT = N::T; // { dg-warning \".N. is deprecated\" }\n+  using N::T; // { dg-warning \".N. is deprecated\" }\n+}"}, {"sha": "6dbcf326061a2c459bfe3075cd8a6d2f7bf1bfa8", "filename": "gcc/testsuite/g++.dg/cpp0x/attributes-namespace5.C", "status": "added", "additions": 20, "deletions": 0, "changes": 20, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/5857042a2b3dd635fc6cae214abd60d3a8336060/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Fcpp0x%2Fattributes-namespace5.C", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/5857042a2b3dd635fc6cae214abd60d3a8336060/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Fcpp0x%2Fattributes-namespace5.C", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Fcpp0x%2Fattributes-namespace5.C?ref=5857042a2b3dd635fc6cae214abd60d3a8336060", "patch": "@@ -0,0 +1,20 @@\n+// PR c++/79817 - attribute deprecated on namespace.\n+// { dg-do compile { target c++11 } }\n+\n+namespace [[deprecated]] Y {\n+  void f();\n+  void f2(int);\n+\n+  template<typename>\n+  struct S {\n+    void f3 ();\n+  };\n+}\n+\n+void Y::f();\n+void Y::f() { }\n+void Y::f2(int);\n+void Y::f2([[maybe_unused]] int);\n+void Y::f2(int) { }\n+template <> void Y::S<int>::f3();\n+template <> void Y::S<int>::f3() { }"}, {"sha": "29f8ce472be180c9a6847d72c006d4a2e6305625", "filename": "gcc/testsuite/g++.dg/cpp1z/namespace-attribs.C", "status": "modified", "additions": 2, "deletions": 3, "changes": 5, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/5857042a2b3dd635fc6cae214abd60d3a8336060/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Fcpp1z%2Fnamespace-attribs.C", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/5857042a2b3dd635fc6cae214abd60d3a8336060/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Fcpp1z%2Fnamespace-attribs.C", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Fcpp1z%2Fnamespace-attribs.C?ref=5857042a2b3dd635fc6cae214abd60d3a8336060", "patch": "@@ -3,9 +3,8 @@\n \n namespace A __attribute ((visibility (\"default\"))) {}\n \n-namespace B [[deprecated]] {} // { dg-warning \"ignored\" }\n+namespace B [[deprecated]] {}\n \n namespace __attribute ((visibility (\"default\"))) C {}\n \n-namespace [[deprecated]] D {} // { dg-warning \"ignored\" }\n-\n+namespace [[deprecated]] D {}"}, {"sha": "7996b4b680c55b6729e3acfac35dff360dde5867", "filename": "gcc/testsuite/g++.dg/cpp1z/namespace-attribs2.C", "status": "modified", "additions": 2, "deletions": 3, "changes": 5, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/5857042a2b3dd635fc6cae214abd60d3a8336060/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Fcpp1z%2Fnamespace-attribs2.C", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/5857042a2b3dd635fc6cae214abd60d3a8336060/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Fcpp1z%2Fnamespace-attribs2.C", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Fcpp1z%2Fnamespace-attribs2.C?ref=5857042a2b3dd635fc6cae214abd60d3a8336060", "patch": "@@ -1,7 +1,6 @@\n // { dg-do compile { target c++17 } }\n // { dg-additional-options \"-pedantic\" }\n \n-namespace B [[deprecated]] {} // { dg-warning \"ignored|must precede\" }\n-\n-namespace [[deprecated]] D {} // { dg-warning \"ignored\" }\n+namespace B [[deprecated]] {} // { dg-error \"must precede\" }\n \n+namespace [[deprecated]] D {}"}]}