{"sha": "aaf31e160cbe50a70b0dfa71436e3ab1d9b75afd", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6YWFmMzFlMTYwY2JlNTBhNzBiMGRmYTcxNDM2ZTNhYjFkOWI3NWFmZA==", "commit": {"author": {"name": "Arnaud Charlet", "email": "charlet@gcc.gnu.org", "date": "2010-06-18T13:01:07Z"}, "committer": {"name": "Arnaud Charlet", "email": "charlet@gcc.gnu.org", "date": "2010-06-18T13:01:07Z"}, "message": "[multiple changes]\n\n2010-06-18  Pascal Obry  <obry@adacore.com>\n\n\t* make.adb, prj-nmsc.adb: Fix source filenames casing in debug output.\n\n2010-06-18  Vincent Celier  <celier@adacore.com>\n\n\t* gnatcmd.adb: For gnatcheck, add -gnatec= switch for a global\n\tconfiguration pragmas file and, if -U is not used, for a local one.\n\n2010-06-18  Ed Schonberg  <schonberg@adacore.com>\n\n\t* sem_elim.adb (Check_Eliminated): Use full information on entity name\n\twhen it is given in the pragma by a selected component.\n\t(Check_For_Eliminated_Subprogram): Do no emit error if within a\n\tinstance body that is itself within a generic unit.\n\t* sem_ch12.adb (Analyze_Subprogram_Instance): If the subprogram is\n\teliminated, mark as well the anonymous subprogram that is its alias\n\tand appears within the wrapper package.\n\nFrom-SVN: r160986", "tree": {"sha": "96454f5efbaef73201d0218ecd6d79b444fffe51", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/96454f5efbaef73201d0218ecd6d79b444fffe51"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/aaf31e160cbe50a70b0dfa71436e3ab1d9b75afd", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/aaf31e160cbe50a70b0dfa71436e3ab1d9b75afd", "html_url": "https://github.com/Rust-GCC/gccrs/commit/aaf31e160cbe50a70b0dfa71436e3ab1d9b75afd", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/aaf31e160cbe50a70b0dfa71436e3ab1d9b75afd/comments", "author": null, "committer": null, "parents": [{"sha": "175d65591b3e774494dd909909f721aae9d444c2", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/175d65591b3e774494dd909909f721aae9d444c2", "html_url": "https://github.com/Rust-GCC/gccrs/commit/175d65591b3e774494dd909909f721aae9d444c2"}], "stats": {"total": 202, "additions": 184, "deletions": 18}, "files": [{"sha": "27f345aeaaf9508afe479c2a34bb8e86d639eb36", "filename": "gcc/ada/ChangeLog", "status": "modified", "additions": 19, "deletions": 0, "changes": 19, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/aaf31e160cbe50a70b0dfa71436e3ab1d9b75afd/gcc%2Fada%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/aaf31e160cbe50a70b0dfa71436e3ab1d9b75afd/gcc%2Fada%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fada%2FChangeLog?ref=aaf31e160cbe50a70b0dfa71436e3ab1d9b75afd", "patch": "@@ -1,3 +1,22 @@\n+2010-06-18  Pascal Obry  <obry@adacore.com>\n+\n+\t* make.adb, prj-nmsc.adb: Fix source filenames casing in debug output.\n+\n+2010-06-18  Vincent Celier  <celier@adacore.com>\n+\n+\t* gnatcmd.adb: For gnatcheck, add -gnatec= switch for a global\n+\tconfiguration pragmas file and, if -U is not used, for a local one.\n+\n+2010-06-18  Ed Schonberg  <schonberg@adacore.com>\n+\n+\t* sem_elim.adb (Check_Eliminated): Use full information on entity name\n+\twhen it is given in the pragma by a selected component.\n+\t(Check_For_Eliminated_Subprogram): Do no emit error if within a\n+\tinstance body that is itself within a generic unit.\n+\t* sem_ch12.adb (Analyze_Subprogram_Instance): If the subprogram is\n+\teliminated, mark as well the anonymous subprogram that is its alias\n+\tand appears within the wrapper package.\n+\n 2010-06-18  Bob Duff  <duff@adacore.com>\n \n \t* g-pehage.ads, g-pehage.adb (Produce): Clean up some of the code."}, {"sha": "793c6c9c92ca98a709f2f7ab8d4586ece4e3c65e", "filename": "gcc/ada/gnatcmd.adb", "status": "modified", "additions": 86, "deletions": 3, "changes": 89, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/aaf31e160cbe50a70b0dfa71436e3ab1d9b75afd/gcc%2Fada%2Fgnatcmd.adb", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/aaf31e160cbe50a70b0dfa71436e3ab1d9b75afd/gcc%2Fada%2Fgnatcmd.adb", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fada%2Fgnatcmd.adb?ref=aaf31e160cbe50a70b0dfa71436e3ab1d9b75afd", "patch": "@@ -6,7 +6,7 @@\n --                                                                          --\n --                                 B o d y                                  --\n --                                                                          --\n---          Copyright (C) 1996-2009, Free Software Foundation, Inc.         --\n+--          Copyright (C) 1996-2010, Free Software Foundation, Inc.         --\n --                                                                          --\n -- GNAT is free software;  you can  redistribute it  and/or modify it under --\n -- terms of the  GNU General Public License as published  by the Free Soft- --\n@@ -122,6 +122,7 @@ procedure GNATCmd is\n \n    Naming_String      : constant SA := new String'(\"naming\");\n    Binder_String      : constant SA := new String'(\"binder\");\n+   Builder_String     : constant SA := new String'(\"builder\");\n    Compiler_String    : constant SA := new String'(\"compiler\");\n    Check_String       : constant SA := new String'(\"check\");\n    Synchronize_String : constant SA := new String'(\"synchronize\");\n@@ -139,7 +140,8 @@ procedure GNATCmd is\n      new String_List'((Naming_String, Binder_String));\n \n    Packages_To_Check_By_Check : constant String_List_Access :=\n-     new String_List'((Naming_String, Check_String, Compiler_String));\n+     new String_List'\n+       ((Naming_String, Builder_String, Check_String, Compiler_String));\n \n    Packages_To_Check_By_Sync : constant String_List_Access :=\n      new String_List'((Naming_String, Synchronize_String, Compiler_String));\n@@ -363,7 +365,7 @@ procedure GNATCmd is\n \n       if Add_Sources then\n \n-         --  For gnatcheck, gnatpp and gnatmetric , create a temporary file\n+         --  For gnatcheck, gnatpp and gnatmetric, create a temporary file\n          --  and put the list of sources in it.\n \n          if The_Command = Check  or else\n@@ -2198,6 +2200,87 @@ begin\n                   Add_To_Carg_Switches\n                     (new String'(\"-gnatem=\" & Get_Name_String (M_File)));\n                end if;\n+\n+               --  For gnatcheck, also indicate a global configuration pragmas\n+               --  file and, if -U is not used, a local one.\n+\n+               if The_Command = Check then\n+                  declare\n+                     Pkg  : constant Prj.Package_Id :=\n+                       Prj.Util.Value_Of\n+                         (Name        => Name_Builder,\n+                          In_Packages => Project.Decl.Packages,\n+                          In_Tree     => Project_Tree);\n+                     Variable : Variable_Value :=\n+                       Prj.Util.Value_Of\n+                         (Name                    => No_Name,\n+                          Attribute_Or_Array_Name =>\n+                            Name_Global_Configuration_Pragmas,\n+                          In_Package              => Pkg,\n+                          In_Tree                 => Project_Tree);\n+\n+                  begin\n+                     if (Variable = Nil_Variable_Value or else\n+                         Length_Of_Name (Variable.Value) = 0)\n+                         and then Pkg /= No_Package\n+                     then\n+                        Variable :=\n+                          Prj.Util.Value_Of\n+                         (Name                    => Name_Ada,\n+                          Attribute_Or_Array_Name => Name_Global_Config_File,\n+                          In_Package              => Pkg,\n+                          In_Tree                 => Project_Tree);\n+                     end if;\n+\n+                     if Variable /= Nil_Variable_Value and then\n+                       Length_Of_Name (Variable.Value) /= 0\n+                     then\n+                        Add_To_Carg_Switches\n+                          (new String'\n+                             (\"-gnatec=\" & Get_Name_String (Variable.Value)));\n+                     end if;\n+                  end;\n+\n+                  if not All_Projects then\n+                     declare\n+                        Pkg      : constant Prj.Package_Id :=\n+                          Prj.Util.Value_Of\n+                            (Name        => Name_Compiler,\n+                             In_Packages => Project.Decl.Packages,\n+                             In_Tree     => Project_Tree);\n+                        Variable : Variable_Value :=\n+                          Prj.Util.Value_Of\n+                            (Name                    => No_Name,\n+                             Attribute_Or_Array_Name =>\n+                               Name_Local_Configuration_Pragmas,\n+                             In_Package              => Pkg,\n+                             In_Tree                 => Project_Tree);\n+\n+                     begin\n+                        if (Variable = Nil_Variable_Value or else\n+                              Length_Of_Name (Variable.Value) = 0)\n+                          and then Pkg /= No_Package\n+                        then\n+                           Variable :=\n+                             Prj.Util.Value_Of\n+                               (Name                    => Name_Ada,\n+                                Attribute_Or_Array_Name =>\n+                                  Name_Local_Config_File,\n+                                In_Package              => Pkg,\n+                                In_Tree                 => Project_Tree);\n+                        end if;\n+\n+                        if Variable /= Nil_Variable_Value and then\n+                          Length_Of_Name (Variable.Value) /= 0\n+                        then\n+                           Add_To_Carg_Switches\n+                             (new String'\n+                                (\"-gnatec=\" &\n+                                 Get_Name_String (Variable.Value)));\n+                        end if;\n+                     end;\n+                  end if;\n+               end if;\n             end;\n          end if;\n "}, {"sha": "bd67136acf0cfde44ec8256fd3d69f4afd3dce1e", "filename": "gcc/ada/make.adb", "status": "modified", "additions": 2, "deletions": 2, "changes": 4, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/aaf31e160cbe50a70b0dfa71436e3ab1d9b75afd/gcc%2Fada%2Fmake.adb", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/aaf31e160cbe50a70b0dfa71436e3ab1d9b75afd/gcc%2Fada%2Fmake.adb", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fada%2Fmake.adb?ref=aaf31e160cbe50a70b0dfa71436e3ab1d9b75afd", "patch": "@@ -1395,7 +1395,7 @@ package body Make is\n \n       if Project_Of_Current_Object_Directory /= Project then\n          Project_Of_Current_Object_Directory := Project;\n-         Object_Directory := Project.Object_Directory.Name;\n+         Object_Directory := Project.Object_Directory.Display_Name;\n \n          --  Set the working directory to the object directory of the actual\n          --  project.\n@@ -6078,7 +6078,7 @@ package body Make is\n                exception\n                   when others =>\n \n-                     --  Delete the temporary mapping file, if one was created.\n+                     --  Delete the temporary mapping file, if one was created\n \n                      if Mapping_Path /= No_Path then\n                         Delete_Temporary_File (Project_Tree, Mapping_Path);"}, {"sha": "df0cf822615ee412781729bb39f1ceff3b61891c", "filename": "gcc/ada/prj-nmsc.adb", "status": "modified", "additions": 8, "deletions": 6, "changes": 14, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/aaf31e160cbe50a70b0dfa71436e3ab1d9b75afd/gcc%2Fada%2Fprj-nmsc.adb", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/aaf31e160cbe50a70b0dfa71436e3ab1d9b75afd/gcc%2Fada%2Fprj-nmsc.adb", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fada%2Fprj-nmsc.adb?ref=aaf31e160cbe50a70b0dfa71436e3ab1d9b75afd", "patch": "@@ -703,7 +703,7 @@ package body Prj.Nmsc is\n \n       if Current_Verbosity = High then\n          Write_Str (\"Adding source File: \");\n-         Write_Str (Get_Name_String (File_Name));\n+         Write_Str (Get_Name_String (Display_File));\n \n          if Index /= 0 then\n             Write_Str (\" at\" & Index'Img);\n@@ -813,8 +813,8 @@ package body Prj.Nmsc is\n    -----------\n \n    procedure Check\n-     (Project     : Project_Id;\n-      Data        : in out Tree_Processing_Data)\n+     (Project : Project_Id;\n+      Data    : in out Tree_Processing_Data)\n    is\n       Specs     : Array_Element_Id;\n       Bodies    : Array_Element_Id;\n@@ -4883,7 +4883,7 @@ package body Prj.Nmsc is\n          if not Removed and then List = Nil_String then\n             if Current_Verbosity = High then\n                Write_Str  (\"   Adding Source Dir=\");\n-               Write_Line (Get_Name_String (Path_Id));\n+               Write_Line (Get_Name_String (Display_Path_Id));\n             end if;\n \n             String_Element_Table.Increment_Last (Data.Tree.String_Elements);\n@@ -6845,7 +6845,9 @@ package body Prj.Nmsc is\n \n                begin\n                   if Current_Verbosity = High then\n-                     Write_Attr (\"Source_Dir\", Source_Directory);\n+                     Write_Attr\n+                       (\"Source_Dir\",\n+                        Source_Directory (Source_Directory'First .. Dir_Last));\n                      Write_Line (Num_Nod.Number'Img);\n                   end if;\n \n@@ -7382,7 +7384,7 @@ package body Prj.Nmsc is\n       while Current /= Nil_String loop\n          Element := In_Tree.String_Elements.Table (Current);\n          Write_Str  (\"   \");\n-         Write_Line (Get_Name_String (Element.Value));\n+         Write_Line (Get_Name_String (Element.Display_Value));\n          Current := Element.Next;\n       end loop;\n "}, {"sha": "cfb08c8f0ef7032363b3299960384c524fd04645", "filename": "gcc/ada/sem_ch12.adb", "status": "modified", "additions": 3, "deletions": 0, "changes": 3, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/aaf31e160cbe50a70b0dfa71436e3ab1d9b75afd/gcc%2Fada%2Fsem_ch12.adb", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/aaf31e160cbe50a70b0dfa71436e3ab1d9b75afd/gcc%2Fada%2Fsem_ch12.adb", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fada%2Fsem_ch12.adb?ref=aaf31e160cbe50a70b0dfa71436e3ab1d9b75afd", "patch": "@@ -4005,11 +4005,14 @@ package body Sem_Ch12 is\n          --  If the instance is a child unit, mark the Id accordingly. Mark\n          --  the anonymous entity as well, which is the real subprogram and\n          --  which is used when the instance appears in a context clause.\n+         --  Similarly, propagate the Is_Eliminated flag to handle properly\n+         --  nested eliminated subprograms.\n \n          Set_Is_Child_Unit (Act_Decl_Id, Is_Child_Unit (Defining_Entity (N)));\n          Set_Is_Child_Unit (Anon_Id, Is_Child_Unit (Defining_Entity (N)));\n          New_Overloaded_Entity (Act_Decl_Id);\n          Check_Eliminated  (Act_Decl_Id);\n+         Set_Is_Eliminated (Anon_Id, Is_Eliminated (Act_Decl_Id));\n \n          --  In compilation unit case, kill elaboration checks on the\n          --  instantiation, since they are never needed -- the body is"}, {"sha": "9917b1f35118915d55cc361ffeb1a528f750ec56", "filename": "gcc/ada/sem_elim.adb", "status": "modified", "additions": 66, "deletions": 7, "changes": 73, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/aaf31e160cbe50a70b0dfa71436e3ab1d9b75afd/gcc%2Fada%2Fsem_elim.adb", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/aaf31e160cbe50a70b0dfa71436e3ab1d9b75afd/gcc%2Fada%2Fsem_elim.adb", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fada%2Fsem_elim.adb?ref=aaf31e160cbe50a70b0dfa71436e3ab1d9b75afd", "patch": "@@ -29,6 +29,7 @@ with Errout;   use Errout;\n with Lib;      use Lib;\n with Namet;    use Namet;\n with Nlists;   use Nlists;\n+with Opt;      use Opt;\n with Sem;      use Sem;\n with Sem_Prag; use Sem_Prag;\n with Sem_Util; use Sem_Util;\n@@ -287,7 +288,8 @@ package body Sem_Elim is\n                goto Continue;\n             end if;\n \n-            --  Find enclosing unit\n+            --  Find enclosing unit, and verify that its name and those of its\n+            --  parents match.\n \n             Scop := Cunit_Entity (Current_Sem_Unit);\n \n@@ -329,9 +331,6 @@ package body Sem_Elim is\n                end if;\n \n                Scop := Scope (Scop);\n-               while Ekind (Scop) = E_Block loop\n-                  Scop := Scope (Scop);\n-               end loop;\n \n                if Scop /= Standard_Standard and then J = 1 then\n                   goto Continue;\n@@ -342,8 +341,60 @@ package body Sem_Elim is\n                goto Continue;\n             end if;\n \n-            --  Check for case of given entity is a library level subprogram\n-            --  and we have the single parameter Eliminate case, a match!\n+            if Present (Elmt.Entity_Node)\n+              and then Elmt.Entity_Scope /= null\n+            then\n+\n+               --  Check that names of enclosing scopes match.\n+               --  Skip blocks and wrapper package of subprogram instances,\n+               --  which do not appear in the pragma.\n+\n+               Scop := Scope (E);\n+\n+               for J in reverse  Elmt.Entity_Scope'Range loop\n+                  while Ekind (Scop) = E_Block\n+                    or else\n+                     (Ekind (Scop) = E_Package\n+                       and then Is_Wrapper_Package (Scop))\n+                  loop\n+                     Scop := Scope (Scop);\n+                  end loop;\n+\n+                  if Elmt.Entity_Scope (J) /= Chars (Scop) then\n+                     if Ekind (Scop) /= E_Protected_Type\n+                       or else Comes_From_Source (Scop)\n+                     then\n+                        goto Continue;\n+\n+                     --  For simple protected declarations, retrieve the source\n+                     --  name of the object, which appeared in the Eliminate\n+                     --  pragma.\n+\n+                     else\n+                        declare\n+                           Decl : constant Node_Id :=\n+                             Original_Node (Parent (Scop));\n+\n+                        begin\n+                           if Elmt.Entity_Scope (J) /=\n+                             Chars (Defining_Identifier (Decl))\n+                           then\n+                              if J > 0 then\n+                                 null;\n+                              end if;\n+                              goto Continue;\n+                           end if;\n+                        end;\n+                     end if;\n+\n+                  end if;\n+\n+                  Scop := Scope (Scop);\n+               end loop;\n+            end if;\n+\n+            --  If given entity is a library level subprogram and pragma had a\n+            --  single parameter, a match!\n \n             if Is_Compilation_Unit (E)\n               and then Is_Subprogram (E)\n@@ -672,7 +723,15 @@ package body Sem_Elim is\n             Enclosing_Subp := Enclosing_Subprogram (Enclosing_Subp);\n          end loop;\n \n-         Eliminate_Error_Msg (N, Ultimate_Subp);\n+         --  Emit error, unless we are within an instance body and\n+         --  the expander is disabled, which indicates an instance\n+         --  within an enclosing generic.\n+\n+         if In_Instance_Body and then not Expander_Active then\n+            null;\n+         else\n+            Eliminate_Error_Msg (N, Ultimate_Subp);\n+         end if;\n       end if;\n    end Check_For_Eliminated_Subprogram;\n "}]}