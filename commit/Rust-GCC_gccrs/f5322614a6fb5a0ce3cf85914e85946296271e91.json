{"sha": "f5322614a6fb5a0ce3cf85914e85946296271e91", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6ZjUzMjI2MTRhNmZiNWEwY2UzY2Y4NTkxNGU4NTk0NjI5NjI3MWU5MQ==", "commit": {"author": {"name": "Paolo Carlini", "email": "paolo.carlini@oracle.com", "date": "2015-05-04T20:58:33Z"}, "committer": {"name": "Paolo Carlini", "email": "paolo@gcc.gnu.org", "date": "2015-05-04T20:58:33Z"}, "message": "re PR c++/66007 (Narrowing conversion inside { } results in all zero elements in C++11 mode with -Wno-error=narrowing)\n\n/cp\n2015-05-04  Paolo Carlini  <paolo.carlini@oracle.com>\n\t    Jakub Jelinek  <jakub@redhat.com>\n\n\tPR c++/66007\n\t* typeck2.c (check_narrowing): Check by-hand that the pedwarn didn't\n\tresult in an actual error.\n\n/testsuite\n2015-05-04  Paolo Carlini  <paolo.carlini@oracle.com>\n\t    Jakub Jelinek  <jakub@redhat.com>\n\n\tPR c++/66007\n\t* g++.dg/cpp0x/Wnarrowing4.C: New.\n\nCo-Authored-By: Jakub Jelinek <jakub@redhat.com>\n\nFrom-SVN: r222778", "tree": {"sha": "2e6c675a3efb74c7972b72a21781fdc4533e8487", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/2e6c675a3efb74c7972b72a21781fdc4533e8487"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/f5322614a6fb5a0ce3cf85914e85946296271e91", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/f5322614a6fb5a0ce3cf85914e85946296271e91", "html_url": "https://github.com/Rust-GCC/gccrs/commit/f5322614a6fb5a0ce3cf85914e85946296271e91", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/f5322614a6fb5a0ce3cf85914e85946296271e91/comments", "author": null, "committer": null, "parents": [{"sha": "467d8d51f1304b955136060db0a34e1f80f098bb", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/467d8d51f1304b955136060db0a34e1f80f098bb", "html_url": "https://github.com/Rust-GCC/gccrs/commit/467d8d51f1304b955136060db0a34e1f80f098bb"}], "stats": {"total": 35, "additions": 32, "deletions": 3}, "files": [{"sha": "bd9f2f32776c13021ee0711331490b000e2fe01a", "filename": "gcc/cp/ChangeLog", "status": "modified", "additions": 7, "deletions": 0, "changes": 7, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/f5322614a6fb5a0ce3cf85914e85946296271e91/gcc%2Fcp%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/f5322614a6fb5a0ce3cf85914e85946296271e91/gcc%2Fcp%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fcp%2FChangeLog?ref=f5322614a6fb5a0ce3cf85914e85946296271e91", "patch": "@@ -1,3 +1,10 @@\n+2015-05-04  Paolo Carlini  <paolo.carlini@oracle.com>\n+\t    Jakub Jelinek  <jakub@redhat.com>\n+\n+\tPR c++/66007\n+\t* typeck2.c (check_narrowing): Check by-hand that the pedwarn didn't\n+\tresult in an actual error.\n+\n 2015-05-01  Paolo Carlini  <paolo.carlini@oracle.com>\n \t    Prathamesh Kulharni  <prathamesh.kulkarni@linaro.org>\n "}, {"sha": "c0df8237a1264692cc3f93703e89b6a33e9f0aca", "filename": "gcc/cp/typeck2.c", "status": "modified", "additions": 5, "deletions": 3, "changes": 8, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/f5322614a6fb5a0ce3cf85914e85946296271e91/gcc%2Fcp%2Ftypeck2.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/f5322614a6fb5a0ce3cf85914e85946296271e91/gcc%2Fcp%2Ftypeck2.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fcp%2Ftypeck2.c?ref=f5322614a6fb5a0ce3cf85914e85946296271e91", "patch": "@@ -958,10 +958,12 @@ check_narrowing (tree type, tree init, tsubst_flags_t complain)\n \t}\n       else if (complain & tf_error)\n \t{\n+\t  int savederrorcount = errorcount;\n \t  global_dc->pedantic_errors = 1;\n-\t  if (!pedwarn (EXPR_LOC_OR_LOC (init, input_location), OPT_Wnarrowing,\n-\t\t\t\"narrowing conversion of %qE from %qT to %qT \"\n-\t\t\t\"inside { }\", init, ftype, type))\n+\t  pedwarn (EXPR_LOC_OR_LOC (init, input_location), OPT_Wnarrowing,\n+\t\t   \"narrowing conversion of %qE from %qT to %qT \"\n+\t\t   \"inside { }\", init, ftype, type);\n+\t  if (errorcount == savederrorcount)\n \t    ok = true;\n \t  global_dc->pedantic_errors = flag_pedantic_errors;\n \t}"}, {"sha": "a73ad283490d6fb71aabcce1a55ad00874573549", "filename": "gcc/testsuite/ChangeLog", "status": "modified", "additions": 6, "deletions": 0, "changes": 6, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/f5322614a6fb5a0ce3cf85914e85946296271e91/gcc%2Ftestsuite%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/f5322614a6fb5a0ce3cf85914e85946296271e91/gcc%2Ftestsuite%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2FChangeLog?ref=f5322614a6fb5a0ce3cf85914e85946296271e91", "patch": "@@ -1,3 +1,9 @@\n+2015-05-04  Paolo Carlini  <paolo.carlini@oracle.com>\n+\t    Jakub Jelinek  <jakub@redhat.com>\n+\n+\tPR c++/66007\n+\t* g++.dg/cpp0x/Wnarrowing4.C: New.\n+\n 2015-05-04  Sandra Loosemore  <sandra@codesourcery.com>\n \n \t* lib/target-supports.exp"}, {"sha": "7defce3ce8969cb367dcc2ebc814124eab5db429", "filename": "gcc/testsuite/g++.dg/cpp0x/Wnarrowing4.C", "status": "added", "additions": 14, "deletions": 0, "changes": 14, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/f5322614a6fb5a0ce3cf85914e85946296271e91/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Fcpp0x%2FWnarrowing4.C", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/f5322614a6fb5a0ce3cf85914e85946296271e91/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Fcpp0x%2FWnarrowing4.C", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Fcpp0x%2FWnarrowing4.C?ref=f5322614a6fb5a0ce3cf85914e85946296271e91", "patch": "@@ -0,0 +1,14 @@\n+// PR c++/66007\n+// { dg-do run { target c++11 } }\n+// { dg-options \"-Wno-error=narrowing\" }\n+\n+extern \"C\" void abort();\n+\n+int main()\n+{\n+  unsigned foo[] = { 1, -1, 3 };\n+  if (foo[0] != 1 || foo[1] != __INT_MAX__ * 2U + 1 || foo[2] != 3)\n+    abort();\n+}\n+\n+// { dg-prune-output \"narrowing conversion\" }"}]}