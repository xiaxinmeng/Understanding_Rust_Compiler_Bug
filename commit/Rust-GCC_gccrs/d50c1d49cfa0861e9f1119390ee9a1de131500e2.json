{"sha": "d50c1d49cfa0861e9f1119390ee9a1de131500e2", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6ZDUwYzFkNDljZmEwODYxZTlmMTExOTM5MGVlOWExZGUxMzE1MDBlMg==", "commit": {"author": {"name": "Richard Stallman", "email": "rms@gnu.org", "date": "1993-03-16T02:44:04Z"}, "committer": {"name": "Richard Stallman", "email": "rms@gnu.org", "date": "1993-03-16T02:44:04Z"}, "message": "(write_output): Test value of `write'; report errors.\n\n(out_fname): Var now file-scope.\n\nFrom-SVN: r3752", "tree": {"sha": "73ff2aa147663a353236ae1764e157e91a2f7dca", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/73ff2aa147663a353236ae1764e157e91a2f7dca"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/d50c1d49cfa0861e9f1119390ee9a1de131500e2", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/d50c1d49cfa0861e9f1119390ee9a1de131500e2", "html_url": "https://github.com/Rust-GCC/gccrs/commit/d50c1d49cfa0861e9f1119390ee9a1de131500e2", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/d50c1d49cfa0861e9f1119390ee9a1de131500e2/comments", "author": null, "committer": null, "parents": [{"sha": "ec241c19a4c26c936bb2c4f812d476b5d3b2d8e0", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/ec241c19a4c26c936bb2c4f812d476b5d3b2d8e0", "html_url": "https://github.com/Rust-GCC/gccrs/commit/ec241c19a4c26c936bb2c4f812d476b5d3b2d8e0"}], "stats": {"total": 16, "additions": 10, "deletions": 6}, "files": [{"sha": "a1b25f868050f1a9dfdf933631190b34170d903c", "filename": "gcc/cccp.c", "status": "modified", "additions": 10, "deletions": 6, "changes": 16, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/d50c1d49cfa0861e9f1119390ee9a1de131500e2/gcc%2Fcccp.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/d50c1d49cfa0861e9f1119390ee9a1de131500e2/gcc%2Fcccp.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fcccp.c?ref=d50c1d49cfa0861e9f1119390ee9a1de131500e2", "patch": "@@ -917,6 +917,9 @@ static U_CHAR is_space[256];\n   \n static int errors = 0;\t\t\t/* Error counter for exit code */\n \n+/* Name of output file, for error messages.  */\n+static char *out_fname;\n+\n /* Zero means dollar signs are punctuation.\n    -$ stores 0; -traditional may store 1.  Default is 1 for VMS, 0 otherwise.\n    This must be 0 for correct processing of this ANSI C program:\n@@ -972,7 +975,7 @@ main (argc, argv)\n {\n   int st_mode;\n   long st_size;\n-  char *in_fname, *out_fname;\n+  char *in_fname;\n   char *p;\n   int f, i;\n   FILE_BUF *fp;\n@@ -4683,10 +4686,10 @@ write_output ()\n \t\t\t\t   line_command_len *= 2);\n \tsprintf (line_command, \"\\n# %d \\\"%s\\\"\\n\",\n \t\t next_string->lineno, next_string->filename);\n-\twrite (fileno (stdout), line_command, \n-\t       strlen (line_command));\n-\twrite (fileno (stdout),\n-\t       next_string->contents, next_string->len);\n+\tif (write (fileno (stdout), line_command, strlen (line_command)) < 0)\n+\t  perror_with_name (out_fname);\n+\tif (write (fileno (stdout), next_string->contents, next_string->len) < 0)\n+\t  perror_with_name (out_fname);\n       }\t      \n       next_string = next_string->chain;\n     }\n@@ -4696,7 +4699,8 @@ write_output ()\n \t\t- (cur_buf_loc - outbuf.buf))\n \t     : outbuf.bufp - cur_buf_loc);\n       \n-      write (fileno (stdout), cur_buf_loc, len);\n+      if (write (fileno (stdout), cur_buf_loc, len) < len)\n+\tperror_with_name (out_fname);\n       cur_buf_loc += len;\n     }\n   }"}]}