{"sha": "479d0ed5900b8e87634cd92383c11a5571cc43d9", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6NDc5ZDBlZDU5MDBiOGU4NzYzNGNkOTIzODNjMTFhNTU3MWNjNDNkOQ==", "commit": {"author": {"name": "Jonathan Wakely", "email": "jwakely@redhat.com", "date": "2016-07-15T18:51:51Z"}, "committer": {"name": "Jonathan Wakely", "email": "redi@gcc.gnu.org", "date": "2016-07-15T18:51:51Z"}, "message": "c++/58796 Make nullptr match exception handlers of pointer type\n\nlibstdc++-v3:\n\n\tPR c++/58796\n\t* libsupc++/pbase_type_info.cc (__pbase_type_info::__do_catch): Make\n\tnullptr match handlers of pointer type.\n\ngcc/testsuite:\n\n\tPR c++/58796\n\t* g++.dg/cpp0x/nullptr21.C: Remove void* handlers.\n\t* g++.dg/cpp0x/nullptr35.C: New test.\n\nFrom-SVN: r238396", "tree": {"sha": "84b1ce031651f5ab9047b20512bc2cacadc0912f", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/84b1ce031651f5ab9047b20512bc2cacadc0912f"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/479d0ed5900b8e87634cd92383c11a5571cc43d9", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/479d0ed5900b8e87634cd92383c11a5571cc43d9", "html_url": "https://github.com/Rust-GCC/gccrs/commit/479d0ed5900b8e87634cd92383c11a5571cc43d9", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/479d0ed5900b8e87634cd92383c11a5571cc43d9/comments", "author": {"login": "jwakely", "id": 1254480, "node_id": "MDQ6VXNlcjEyNTQ0ODA=", "avatar_url": "https://avatars.githubusercontent.com/u/1254480?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jwakely", "html_url": "https://github.com/jwakely", "followers_url": "https://api.github.com/users/jwakely/followers", "following_url": "https://api.github.com/users/jwakely/following{/other_user}", "gists_url": "https://api.github.com/users/jwakely/gists{/gist_id}", "starred_url": "https://api.github.com/users/jwakely/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jwakely/subscriptions", "organizations_url": "https://api.github.com/users/jwakely/orgs", "repos_url": "https://api.github.com/users/jwakely/repos", "events_url": "https://api.github.com/users/jwakely/events{/privacy}", "received_events_url": "https://api.github.com/users/jwakely/received_events", "type": "User", "site_admin": false}, "committer": {"login": "jwakely", "id": 1254480, "node_id": "MDQ6VXNlcjEyNTQ0ODA=", "avatar_url": "https://avatars.githubusercontent.com/u/1254480?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jwakely", "html_url": "https://github.com/jwakely", "followers_url": "https://api.github.com/users/jwakely/followers", "following_url": "https://api.github.com/users/jwakely/following{/other_user}", "gists_url": "https://api.github.com/users/jwakely/gists{/gist_id}", "starred_url": "https://api.github.com/users/jwakely/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jwakely/subscriptions", "organizations_url": "https://api.github.com/users/jwakely/orgs", "repos_url": "https://api.github.com/users/jwakely/repos", "events_url": "https://api.github.com/users/jwakely/events{/privacy}", "received_events_url": "https://api.github.com/users/jwakely/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "de54de93fa4bf4740638e58f9aaab1e50026bacb", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/de54de93fa4bf4740638e58f9aaab1e50026bacb", "html_url": "https://github.com/Rust-GCC/gccrs/commit/de54de93fa4bf4740638e58f9aaab1e50026bacb"}], "stats": {"total": 93, "additions": 89, "deletions": 4}, "files": [{"sha": "305f96a4ab6ad64ad3e284df7d512a6145866c98", "filename": "gcc/testsuite/ChangeLog", "status": "modified", "additions": 6, "deletions": 0, "changes": 6, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/479d0ed5900b8e87634cd92383c11a5571cc43d9/gcc%2Ftestsuite%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/479d0ed5900b8e87634cd92383c11a5571cc43d9/gcc%2Ftestsuite%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2FChangeLog?ref=479d0ed5900b8e87634cd92383c11a5571cc43d9", "patch": "@@ -1,3 +1,9 @@\n+2016-07-15  Jonathan Wakely  <jwakely@redhat.com>\n+\n+\tPR c++/58796\n+\t* g++.dg/cpp0x/nullptr21.C: Remove void* handlers.\n+\t* g++.dg/cpp0x/nullptr35.C: New test.\n+\n 2016-07-15  Bin Cheng  <bin.cheng@arm.com>\n \n \t* gcc.dg/tree-ssa/scev-8.c: Update test string."}, {"sha": "c6f560e296b6943a14975ade5a1dabcdf63d263c", "filename": "gcc/testsuite/g++.dg/cpp0x/nullptr21.C", "status": "modified", "additions": 0, "deletions": 4, "changes": 4, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/479d0ed5900b8e87634cd92383c11a5571cc43d9/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Fcpp0x%2Fnullptr21.C", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/479d0ed5900b8e87634cd92383c11a5571cc43d9/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Fcpp0x%2Fnullptr21.C", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Fcpp0x%2Fnullptr21.C?ref=479d0ed5900b8e87634cd92383c11a5571cc43d9", "patch": "@@ -18,8 +18,6 @@ int main()\n {\n   try {\n     throw nullptr;\n-  } catch (void*) {\n-    foo (0, 1);\n   } catch (bool) {\n     foo (0, 2);\n   } catch (int) {\n@@ -35,8 +33,6 @@ int main()\n   nullptr_t mynull = 0;\n   try {\n     throw mynull;\n-  } catch (void*) {\n-    foo (1, 1);\n   } catch (bool) {\n     foo (1, 2);\n   } catch (int) {"}, {"sha": "2f93ce1573121e5dbb6b7d0e45fae90935171c59", "filename": "gcc/testsuite/g++.dg/cpp0x/nullptr35.C", "status": "added", "additions": 52, "deletions": 0, "changes": 52, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/479d0ed5900b8e87634cd92383c11a5571cc43d9/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Fcpp0x%2Fnullptr35.C", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/479d0ed5900b8e87634cd92383c11a5571cc43d9/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Fcpp0x%2Fnullptr35.C", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Fcpp0x%2Fnullptr35.C?ref=479d0ed5900b8e87634cd92383c11a5571cc43d9", "patch": "@@ -0,0 +1,52 @@\n+// { dg-do run { target c++11 } }\n+\n+// Test catching as pointer and pointer to member types, [except.handle] p3.\n+\n+extern \"C\" void abort (void);\n+\n+typedef decltype(nullptr) nullptr_t;\n+\n+int result = 0;\n+\n+void __attribute__((noinline))\n+caught(int bit)\n+{\n+  result &= bit;\n+}\n+\n+struct A { };\n+\n+int main()\n+{\n+  try {\n+    try {\n+      try {\n+        try {\n+          try {\n+            throw nullptr;\n+          } catch (void* p) {\n+            if (p == nullptr)\n+              caught(1);\n+            throw;\n+          }\n+        } catch (void(*pf)()) {\n+          if (pf == nullptr)\n+            caught(2);\n+          throw;\n+        }\n+      } catch (int A::*pm) {\n+        if (pm == nullptr)\n+          caught(4);\n+        throw;\n+      }\n+    } catch (int (A::*pmf)()) {  // FIXME: currently unsupported\n+      if (pmf == nullptr)\n+        caught(8);\n+      throw;\n+    }\n+  } catch (nullptr_t) {\n+  }\n+\n+  if (result != 7) // should be 15\n+    abort ();\n+}"}, {"sha": "3e4a0f5b8502b5a32d4a15d83c25699f966af964", "filename": "libstdc++-v3/ChangeLog", "status": "modified", "additions": 6, "deletions": 0, "changes": 6, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/479d0ed5900b8e87634cd92383c11a5571cc43d9/libstdc%2B%2B-v3%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/479d0ed5900b8e87634cd92383c11a5571cc43d9/libstdc%2B%2B-v3%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libstdc%2B%2B-v3%2FChangeLog?ref=479d0ed5900b8e87634cd92383c11a5571cc43d9", "patch": "@@ -1,3 +1,9 @@\n+2016-07-15  Jonathan Wakely  <jwakely@redhat.com>\n+\n+\tPR c++/58796\n+\t* libsupc++/pbase_type_info.cc (__pbase_type_info::__do_catch): Make\n+\tnullptr match handlers of pointer type.\n+\n 2016-07-15  Edward Smith-Rowland  <3dw4rd@verizon.net>\n \n \tImplement C++17 P0025 clamp."}, {"sha": "a2993e431fe7826526940fb96de9266066514bee", "filename": "libstdc++-v3/libsupc++/pbase_type_info.cc", "status": "modified", "additions": 25, "deletions": 0, "changes": 25, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/479d0ed5900b8e87634cd92383c11a5571cc43d9/libstdc%2B%2B-v3%2Flibsupc%2B%2B%2Fpbase_type_info.cc", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/479d0ed5900b8e87634cd92383c11a5571cc43d9/libstdc%2B%2B-v3%2Flibsupc%2B%2B%2Fpbase_type_info.cc", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libstdc%2B%2B-v3%2Flibsupc%2B%2B%2Fpbase_type_info.cc?ref=479d0ed5900b8e87634cd92383c11a5571cc43d9", "patch": "@@ -38,6 +38,31 @@ __do_catch (const type_info *thr_type,\n     return true;      // same type\n \n #if __cpp_rtti\n+  if (*thr_type == typeid (nullptr))\n+    {\n+      // A catch handler for any pointer type matches nullptr_t.\n+      if (typeid (*this) == typeid(__pointer_type_info))\n+        {\n+          *thr_obj = nullptr;\n+          return true;\n+        }\n+      else if (typeid (*this) == typeid(__pointer_to_member_type_info))\n+        {\n+          if (__pointee->__is_function_p ())\n+            {\n+              // A pointer-to-member-function is two words <ptr,adj> but the\n+              // nullptr_t exception object at *(nullptr_t*)*thr_obj is only\n+              // one word, so we can't safely return it as a PMF. FIXME.\n+              return false;\n+            }\n+          else\n+            {\n+              *(ptrdiff_t*)*thr_obj = -1; // null pointer to data member\n+              return true;\n+            }\n+        }\n+    }\n+\n   if (typeid (*this) != typeid (*thr_type))\n     return false;     // not both same kind of pointers\n #endif"}]}