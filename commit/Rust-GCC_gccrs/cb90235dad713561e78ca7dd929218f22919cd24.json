{"sha": "cb90235dad713561e78ca7dd929218f22919cd24", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6Y2I5MDIzNWRhZDcxMzU2MWU3OGNhN2RkOTI5MjE4ZjIyOTE5Y2QyNA==", "commit": {"author": {"name": "Jan Hubicka", "email": "hubicka@ucw.cz", "date": "2014-04-14T17:18:54Z"}, "committer": {"name": "Jan Hubicka", "email": "hubicka@gcc.gnu.org", "date": "2014-04-14T17:18:54Z"}, "message": "ipa-utils.c (ipa_merge_profiles): Merge profile_id.\n\n\n\t* ipa-utils.c (ipa_merge_profiles): Merge profile_id.\n\t* coverage.c (coverage_compute_profile_id): Handle externally visible\n\tsymbols.\n\n\t* lto/lto-symtab.c (lto_cgraph_replace_node): Don't re-merge\n\ttp_first_run.\n\nFrom-SVN: r209387", "tree": {"sha": "194491cc20ba14600662056b4a34f745b09db2e6", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/194491cc20ba14600662056b4a34f745b09db2e6"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/cb90235dad713561e78ca7dd929218f22919cd24", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/cb90235dad713561e78ca7dd929218f22919cd24", "html_url": "https://github.com/Rust-GCC/gccrs/commit/cb90235dad713561e78ca7dd929218f22919cd24", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/cb90235dad713561e78ca7dd929218f22919cd24/comments", "author": null, "committer": null, "parents": [{"sha": "7b3b340eafc59df1e79b9cb231722ea2507f04c7", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/7b3b340eafc59df1e79b9cb231722ea2507f04c7", "html_url": "https://github.com/Rust-GCC/gccrs/commit/7b3b340eafc59df1e79b9cb231722ea2507f04c7"}], "stats": {"total": 58, "additions": 41, "deletions": 17}, "files": [{"sha": "26d8d33f10864b8be7f76cabac4f0c304ed80466", "filename": "gcc/ChangeLog", "status": "modified", "additions": 6, "deletions": 0, "changes": 6, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/cb90235dad713561e78ca7dd929218f22919cd24/gcc%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/cb90235dad713561e78ca7dd929218f22919cd24/gcc%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2FChangeLog?ref=cb90235dad713561e78ca7dd929218f22919cd24", "patch": "@@ -1,3 +1,9 @@\n+2014-04-14  Jan Hubicka  <hubicka@ucw.cz>\n+\n+\t* ipa-utils.c (ipa_merge_profiles): Merge profile_id.\n+\t* coverage.c (coverage_compute_profile_id): Handle externally visible\n+\tsymbols.\n+\n 2014-04-14  Martin Jambor  <mjambor@suse.cz>\n \n \t* tree-sra.c (ipa_sra_preliminary_function_checks): Skip"}, {"sha": "ff1e67d0a0360a209c7c8838037a978967477964", "filename": "gcc/coverage.c", "status": "modified", "additions": 22, "deletions": 11, "changes": 33, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/cb90235dad713561e78ca7dd929218f22919cd24/gcc%2Fcoverage.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/cb90235dad713561e78ca7dd929218f22919cd24/gcc%2Fcoverage.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fcoverage.c?ref=cb90235dad713561e78ca7dd929218f22919cd24", "patch": "@@ -555,18 +555,29 @@ coverage_compute_lineno_checksum (void)\n unsigned\n coverage_compute_profile_id (struct cgraph_node *n)\n {\n-  expanded_location xloc\n-    = expand_location (DECL_SOURCE_LOCATION (n->decl));\n-  unsigned chksum = xloc.line;\n+  unsigned chksum;\n \n-  chksum = coverage_checksum_string (chksum, xloc.file);\n-  chksum = coverage_checksum_string\n-    (chksum, IDENTIFIER_POINTER (DECL_ASSEMBLER_NAME (n->decl)));\n-  if (first_global_object_name)\n-    chksum = coverage_checksum_string\n-      (chksum, first_global_object_name);\n-  chksum = coverage_checksum_string\n-    (chksum, aux_base_name);\n+  /* Externally visible symbols have unique name.  */\n+  if (TREE_PUBLIC (n->decl) || DECL_EXTERNAL (n->decl))\n+    {\n+      chksum = coverage_checksum_string\n+\t(0, IDENTIFIER_POINTER (DECL_ASSEMBLER_NAME (n->decl)));\n+    }\n+  else\n+    {\n+      expanded_location xloc\n+\t= expand_location (DECL_SOURCE_LOCATION (n->decl));\n+\n+      chksum = xloc.line;\n+      chksum = coverage_checksum_string (chksum, xloc.file);\n+      chksum = coverage_checksum_string\n+\t(chksum, IDENTIFIER_POINTER (DECL_ASSEMBLER_NAME (n->decl)));\n+      if (first_global_object_name)\n+\tchksum = coverage_checksum_string\n+\t  (chksum, first_global_object_name);\n+      chksum = coverage_checksum_string\n+\t(chksum, aux_base_name);\n+    }\n \n   /* Non-negative integers are hopefully small enough to fit in all targets.  */\n   return chksum & 0x7fffffff;"}, {"sha": "8e7c7cb5ebe21789cdc431705532954330facb91", "filename": "gcc/ipa-utils.c", "status": "modified", "additions": 8, "deletions": 0, "changes": 8, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/cb90235dad713561e78ca7dd929218f22919cd24/gcc%2Fipa-utils.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/cb90235dad713561e78ca7dd929218f22919cd24/gcc%2Fipa-utils.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fipa-utils.c?ref=cb90235dad713561e78ca7dd929218f22919cd24", "patch": "@@ -660,6 +660,14 @@ ipa_merge_profiles (struct cgraph_node *dst,\n   if (dst->tp_first_run > src->tp_first_run && src->tp_first_run)\n     dst->tp_first_run = src->tp_first_run;\n \n+  if (src->profile_id)\n+    {\n+      if (!dst->profile_id)\n+\tdst->profile_id = src->profile_id;\n+      else\n+\tgcc_assert (src->profile_id == dst->profile_id);\n+    }\n+\n   if (!dst->count)\n     return;\n   if (cgraph_dump_file)"}, {"sha": "4200a471ba8912ccb090aea579042744f2eb6ffd", "filename": "gcc/lto/ChangeLog", "status": "modified", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/cb90235dad713561e78ca7dd929218f22919cd24/gcc%2Flto%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/cb90235dad713561e78ca7dd929218f22919cd24/gcc%2Flto%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Flto%2FChangeLog?ref=cb90235dad713561e78ca7dd929218f22919cd24", "patch": "@@ -1,3 +1,8 @@\n+2014-04-14  Jan Hubicka  <hubicka@ucw.cz>\n+\n+\t* lto/lto-symtab.c (lto_cgraph_replace_node): Don't re-merge\n+\ttp_first_run.\n+\n 2014-03-19  Jan Hubicka  <hubicka@ucw.cz>\n \n \t* lto.c: Include ipa-inline.h"}, {"sha": "8c83d3cf3e4ced7c95237be2f089317b5d81f7b1", "filename": "gcc/lto/lto-symtab.c", "status": "modified", "additions": 0, "deletions": 6, "changes": 6, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/cb90235dad713561e78ca7dd929218f22919cd24/gcc%2Flto%2Flto-symtab.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/cb90235dad713561e78ca7dd929218f22919cd24/gcc%2Flto%2Flto-symtab.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Flto%2Flto-symtab.c?ref=cb90235dad713561e78ca7dd929218f22919cd24", "patch": "@@ -91,12 +91,6 @@ lto_cgraph_replace_node (struct cgraph_node *node,\n   if (node->decl != prevailing_node->decl)\n     cgraph_release_function_body (node);\n \n-  /* Time profile merging */\n-  if (node->tp_first_run)\n-    prevailing_node->tp_first_run = prevailing_node->tp_first_run ?\n-      MIN (prevailing_node->tp_first_run, node->tp_first_run) :\n-      node->tp_first_run;\n-\n   /* Finally remove the replaced node.  */\n   cgraph_remove_node (node);\n }"}]}