{"sha": "7ddf4d5acea6123be6f3040e7306b5ea2cb2d651", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6N2RkZjRkNWFjZWE2MTIzYmU2ZjMwNDBlNzMwNmI1ZWEyY2IyZDY1MQ==", "commit": {"author": {"name": "Marek Polacek", "email": "polacek@redhat.com", "date": "2013-12-14T12:19:56Z"}, "committer": {"name": "Marek Polacek", "email": "mpolacek@gcc.gnu.org", "date": "2013-12-14T12:19:56Z"}, "message": "re PR sanitizer/59503 (Bogus integer-overflow error with long long with -m32)\n\n\tPR sanitizer/59503\n\t* internal-fn.c (ubsan_expand_si_overflow_addsub_check): Call\n\texpand_binop with correct optab depending on code.\ntestsuite/\n\t* c-c++-common/ubsan/pr59503.c: New test.\n\nFrom-SVN: r205984", "tree": {"sha": "2e844b93e3888be3ca8df3f929abcce9323dcde9", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/2e844b93e3888be3ca8df3f929abcce9323dcde9"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/7ddf4d5acea6123be6f3040e7306b5ea2cb2d651", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/7ddf4d5acea6123be6f3040e7306b5ea2cb2d651", "html_url": "https://github.com/Rust-GCC/gccrs/commit/7ddf4d5acea6123be6f3040e7306b5ea2cb2d651", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/7ddf4d5acea6123be6f3040e7306b5ea2cb2d651/comments", "author": {"login": "mpolacek", "id": 10496300, "node_id": "MDQ6VXNlcjEwNDk2MzAw", "avatar_url": "https://avatars.githubusercontent.com/u/10496300?v=4", "gravatar_id": "", "url": "https://api.github.com/users/mpolacek", "html_url": "https://github.com/mpolacek", "followers_url": "https://api.github.com/users/mpolacek/followers", "following_url": "https://api.github.com/users/mpolacek/following{/other_user}", "gists_url": "https://api.github.com/users/mpolacek/gists{/gist_id}", "starred_url": "https://api.github.com/users/mpolacek/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/mpolacek/subscriptions", "organizations_url": "https://api.github.com/users/mpolacek/orgs", "repos_url": "https://api.github.com/users/mpolacek/repos", "events_url": "https://api.github.com/users/mpolacek/events{/privacy}", "received_events_url": "https://api.github.com/users/mpolacek/received_events", "type": "User", "site_admin": false}, "committer": null, "parents": [{"sha": "e575540bb45f3cf9f82e557d6459fa59c998013b", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/e575540bb45f3cf9f82e557d6459fa59c998013b", "html_url": "https://github.com/Rust-GCC/gccrs/commit/e575540bb45f3cf9f82e557d6459fa59c998013b"}], "stats": {"total": 31, "additions": 28, "deletions": 3}, "files": [{"sha": "cd64b59bf08fd40fcc1369d0595754c6bbfa847e", "filename": "gcc/ChangeLog", "status": "modified", "additions": 6, "deletions": 0, "changes": 6, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/7ddf4d5acea6123be6f3040e7306b5ea2cb2d651/gcc%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/7ddf4d5acea6123be6f3040e7306b5ea2cb2d651/gcc%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2FChangeLog?ref=7ddf4d5acea6123be6f3040e7306b5ea2cb2d651", "patch": "@@ -1,3 +1,9 @@\n+2013-12-14  Marek Polacek  <polacek@redhat.com>\n+\n+\tPR sanitizer/59503\n+\t* internal-fn.c (ubsan_expand_si_overflow_addsub_check): Call\n+\texpand_binop with correct optab depending on code.\n+\n 2013-12-14  Tom de Vries  <tom@codesourcery.com>\n \n \t* calls.c (expand_call): Fix REG_PARM_STACK_SPACE comparison."}, {"sha": "a0874d467b45290f0fc61006b15db7fd7a5e44f1", "filename": "gcc/internal-fn.c", "status": "modified", "additions": 3, "deletions": 3, "changes": 6, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/7ddf4d5acea6123be6f3040e7306b5ea2cb2d651/gcc%2Finternal-fn.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/7ddf4d5acea6123be6f3040e7306b5ea2cb2d651/gcc%2Finternal-fn.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Finternal-fn.c?ref=7ddf4d5acea6123be6f3040e7306b5ea2cb2d651", "patch": "@@ -214,14 +214,14 @@ ubsan_expand_si_overflow_addsub_check (tree_code code, gimple stmt)\n \n       /* Compute the operation.  On RTL level, the addition is always\n \t unsigned.  */\n-      res = expand_binop (mode, add_optab, op0, op1,\n-\t\t\t  NULL_RTX, false, OPTAB_LIB_WIDEN);\n+      res = expand_binop (mode, code == PLUS_EXPR ? add_optab : sub_optab,\n+\t\t\t  op0, op1, NULL_RTX, false, OPTAB_LIB_WIDEN);\n \n       /* If the op1 is negative, we have to use a different check.  */\n       emit_cmp_and_jump_insns (op1, const0_rtx, LT, NULL_RTX, mode,\n \t\t\t       false, sub_check, PROB_EVEN);\n \n-      /* Compare the result of the addition with one of the operands.  */\n+      /* Compare the result of the operation with one of the operands.  */\n       emit_cmp_and_jump_insns (res, op0, code == PLUS_EXPR ? GE : LE,\n \t\t\t       NULL_RTX, mode, false, done_label,\n \t\t\t       PROB_VERY_LIKELY);"}, {"sha": "b5fabb2baf1d6deaa6eb3ae032fdb98376d9b76a", "filename": "gcc/testsuite/ChangeLog", "status": "modified", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/7ddf4d5acea6123be6f3040e7306b5ea2cb2d651/gcc%2Ftestsuite%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/7ddf4d5acea6123be6f3040e7306b5ea2cb2d651/gcc%2Ftestsuite%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2FChangeLog?ref=7ddf4d5acea6123be6f3040e7306b5ea2cb2d651", "patch": "@@ -1,3 +1,8 @@\n+2013-12-14  Marek Polacek  <polacek@redhat.com>\n+\n+\tPR sanitizer/59503\n+\t* c-c++-common/ubsan/pr59503.c: New test.\n+\n 2013-12-14  Janus Weil  <janus@gcc.gnu.org>\n \n \tPR fortran/59450"}, {"sha": "eb921c4ff188a54ff9ea64d5c9a557fc09775522", "filename": "gcc/testsuite/c-c++-common/ubsan/pr59503.c", "status": "added", "additions": 14, "deletions": 0, "changes": 14, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/7ddf4d5acea6123be6f3040e7306b5ea2cb2d651/gcc%2Ftestsuite%2Fc-c%2B%2B-common%2Fubsan%2Fpr59503.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/7ddf4d5acea6123be6f3040e7306b5ea2cb2d651/gcc%2Ftestsuite%2Fc-c%2B%2B-common%2Fubsan%2Fpr59503.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fc-c%2B%2B-common%2Fubsan%2Fpr59503.c?ref=7ddf4d5acea6123be6f3040e7306b5ea2cb2d651", "patch": "@@ -0,0 +1,14 @@\n+/* { dg-do run } */\n+/* { dg-options \"-fsanitize=signed-integer-overflow\" } */\n+/* { dg-skip-if \"\" { *-*-* } { \"-flto\" } { \"\" } } */\n+\n+int\n+main (void)\n+{\n+  long long int a = 14;\n+  long int b = 9;\n+  asm volatile (\"\" : \"+r\" (a), \"+r\" (b));\n+  if ((a - b) != 5)\n+    __builtin_abort ();\n+  return 0;\n+}"}]}