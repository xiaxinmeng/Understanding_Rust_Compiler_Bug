{"sha": "72ca20f9cb4755c8f1eacedcf229a5d6827039d3", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6NzJjYTIwZjljYjQ3NTVjOGYxZWFjZWRjZjIyOWE1ZDY4MjcwMzlkMw==", "commit": {"author": {"name": "Jeff Law", "email": "law@redhat.com", "date": "2015-12-17T23:33:44Z"}, "committer": {"name": "Jeff Law", "email": "law@gcc.gnu.org", "date": "2015-12-17T23:33:44Z"}, "message": "[PATCH] Limit path splitting to loops we optimize for speed\n\n\t* doc/invoke.texi (-O2 options): Remove -fsplit-paths.\n\t(-O3 options): Add -fsplit-paths.\n\t* gimple-ssa-split-paths.c: Include predict.h\n\t(split_paths): Only split paths in a loop that should be\n\toptimized for speed.\n\t* opts.c (default_options_table): Move -fsplit-paths from -O2 to\n\t-O3.\n\n\t* gcc.dg/tree-ssa/split-path-1.c: Explicitly ask for path\n\tsplitting optimizations.\n\nFrom-SVN: r231790", "tree": {"sha": "56a61439f85b853a276516f7416b8845a06d3886", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/56a61439f85b853a276516f7416b8845a06d3886"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/72ca20f9cb4755c8f1eacedcf229a5d6827039d3", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/72ca20f9cb4755c8f1eacedcf229a5d6827039d3", "html_url": "https://github.com/Rust-GCC/gccrs/commit/72ca20f9cb4755c8f1eacedcf229a5d6827039d3", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/72ca20f9cb4755c8f1eacedcf229a5d6827039d3/comments", "author": null, "committer": null, "parents": [{"sha": "aa3987819a5ab392bcb125efe84008e75f99bbfc", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/aa3987819a5ab392bcb125efe84008e75f99bbfc", "html_url": "https://github.com/Rust-GCC/gccrs/commit/aa3987819a5ab392bcb125efe84008e75f99bbfc"}], "stats": {"total": 30, "additions": 25, "deletions": 5}, "files": [{"sha": "070b2dd5c0b938b79403db5dde3e20124f51b10b", "filename": "gcc/ChangeLog", "status": "modified", "additions": 10, "deletions": 0, "changes": 10, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/72ca20f9cb4755c8f1eacedcf229a5d6827039d3/gcc%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/72ca20f9cb4755c8f1eacedcf229a5d6827039d3/gcc%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2FChangeLog?ref=72ca20f9cb4755c8f1eacedcf229a5d6827039d3", "patch": "@@ -1,3 +1,13 @@\n+2015-12-17  Jeff Law  <law@redhat.com>\n+\n+\t* doc/invoke.texi (-O2 options): Remove -fsplit-paths.\n+\t(-O3 options): Add -fsplit-paths.\n+\t* gimple-ssa-split-paths.c: Include predict.h\n+\t(split_paths): Only split paths in a loop that should be\n+\toptimized for speed.\n+\t* opts.c (default_options_table): Move -fsplit-paths from -O2 to\n+\t-O3.\n+\n 2015-12-17  Nathan Sidwell  <nathan@acm.org>\n \n \t* ipa-icf.c (sem_item_optimizer::merge): Don't pick 'main' as the"}, {"sha": "60530c0464a0832a93be14418554a1485cab7cb6", "filename": "gcc/doc/invoke.texi", "status": "modified", "additions": 1, "deletions": 2, "changes": 3, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/72ca20f9cb4755c8f1eacedcf229a5d6827039d3/gcc%2Fdoc%2Finvoke.texi", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/72ca20f9cb4755c8f1eacedcf229a5d6827039d3/gcc%2Fdoc%2Finvoke.texi", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fdoc%2Finvoke.texi?ref=72ca20f9cb4755c8f1eacedcf229a5d6827039d3", "patch": "@@ -7836,7 +7836,6 @@ also turns on the following optimization flags:\n -frerun-cse-after-loop  @gol\n -fsched-interblock  -fsched-spec @gol\n -fschedule-insns  -fschedule-insns2 @gol\n--fsplit-paths @gol\n -fstrict-aliasing -fstrict-overflow @gol\n -ftree-builtin-call-dce @gol\n -ftree-switch-conversion -ftree-tail-merge @gol\n@@ -7853,7 +7852,7 @@ Optimize yet more.  @option{-O3} turns on all optimizations specified\n by @option{-O2} and also turns on the @option{-finline-functions},\n @option{-funswitch-loops}, @option{-fpredictive-commoning},\n @option{-fgcse-after-reload}, @option{-ftree-loop-vectorize},\n-@option{-ftree-loop-distribute-patterns},\n+@option{-ftree-loop-distribute-patterns}, @option{-fsplit-paths}\n @option{-ftree-slp-vectorize}, @option{-fvect-cost-model},\n @option{-ftree-partial-pre} and @option{-fipa-cp-clone} options.\n "}, {"sha": "540fdf3c33aae43da20e0ac9d398a47937e0b028", "filename": "gcc/gimple-ssa-split-paths.c", "status": "modified", "additions": 7, "deletions": 1, "changes": 8, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/72ca20f9cb4755c8f1eacedcf229a5d6827039d3/gcc%2Fgimple-ssa-split-paths.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/72ca20f9cb4755c8f1eacedcf229a5d6827039d3/gcc%2Fgimple-ssa-split-paths.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fgimple-ssa-split-paths.c?ref=72ca20f9cb4755c8f1eacedcf229a5d6827039d3", "patch": "@@ -29,6 +29,7 @@ along with GCC; see the file COPYING3.  If not see\n #include \"cfgloop.h\"\n #include \"gimple-iterator.h\"\n #include \"tracer.h\"\n+#include \"predict.h\"\n \n /* Given LATCH, the latch block in a loop, see if the shape of the\n    path reaching LATCH is suitable for being split by duplication.\n@@ -180,9 +181,14 @@ split_paths ()\n \n   FOR_EACH_LOOP (loop, LI_FROM_INNERMOST)\n     {\n+      /* Only split paths if we are optimizing this loop for speed.  */\n+      if (!optimize_loop_for_speed_p (loop))\n+\tcontinue;\n+\n       /* See if there is a block that we can duplicate to split the\n \t path to the loop latch.  */\n-      basic_block bb = find_block_to_duplicate_for_splitting_paths (loop->latch);\n+      basic_block bb\n+\t= find_block_to_duplicate_for_splitting_paths (loop->latch);\n \n       /* BB is the merge point for an IF-THEN-ELSE we want to transform.\n "}, {"sha": "7ab585f1e5385cc68603aaac015cc2d531b4df31", "filename": "gcc/opts.c", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/72ca20f9cb4755c8f1eacedcf229a5d6827039d3/gcc%2Fopts.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/72ca20f9cb4755c8f1eacedcf229a5d6827039d3/gcc%2Fopts.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fopts.c?ref=72ca20f9cb4755c8f1eacedcf229a5d6827039d3", "patch": "@@ -523,11 +523,11 @@ static const struct default_options default_options_table[] =\n     { OPT_LEVELS_2_PLUS, OPT_fisolate_erroneous_paths_dereference, NULL, 1 },\n     { OPT_LEVELS_2_PLUS, OPT_fipa_ra, NULL, 1 },\n     { OPT_LEVELS_2_PLUS, OPT_flra_remat, NULL, 1 },\n-    { OPT_LEVELS_2_PLUS, OPT_fsplit_paths, NULL, 1 },\n \n     /* -O3 optimizations.  */\n     { OPT_LEVELS_3_PLUS, OPT_ftree_loop_distribute_patterns, NULL, 1 },\n     { OPT_LEVELS_3_PLUS, OPT_fpredictive_commoning, NULL, 1 },\n+    { OPT_LEVELS_3_PLUS, OPT_fsplit_paths, NULL, 1 },\n     /* Inlining of functions reducing size is a good idea with -Os\n        regardless of them being declared inline.  */\n     { OPT_LEVELS_3_PLUS_AND_SIZE, OPT_finline_functions, NULL, 1 },"}, {"sha": "baa159d381104eaf5a38bb0f910bb26f3f3a9c85", "filename": "gcc/testsuite/ChangeLog", "status": "modified", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/72ca20f9cb4755c8f1eacedcf229a5d6827039d3/gcc%2Ftestsuite%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/72ca20f9cb4755c8f1eacedcf229a5d6827039d3/gcc%2Ftestsuite%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2FChangeLog?ref=72ca20f9cb4755c8f1eacedcf229a5d6827039d3", "patch": "@@ -1,3 +1,8 @@\n+2015-12-17  Jeff Law  <law@redhat.com>\n+\n+\t* gcc.dg/tree-ssa/split-path-1.c: Explicitly ask for path\n+\tsplitting optimizations.\n+\n 2015-12-17  Nathan Sidwell  <nathan@acm.org>\n \n \t* gcc.dg/ipa/ipa-icf-merge-1.c: New."}, {"sha": "b24f6a9f79e790590a6295ab9389e8153863e8ab", "filename": "gcc/testsuite/gcc.dg/tree-ssa/split-path-1.c", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/72ca20f9cb4755c8f1eacedcf229a5d6827039d3/gcc%2Ftestsuite%2Fgcc.dg%2Ftree-ssa%2Fsplit-path-1.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/72ca20f9cb4755c8f1eacedcf229a5d6827039d3/gcc%2Ftestsuite%2Fgcc.dg%2Ftree-ssa%2Fsplit-path-1.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgcc.dg%2Ftree-ssa%2Fsplit-path-1.c?ref=72ca20f9cb4755c8f1eacedcf229a5d6827039d3", "patch": "@@ -1,5 +1,5 @@\n /* { dg-do run } */\n-/* { dg-options \"-O2 -fdump-tree-split-paths-details \" } */\n+/* { dg-options \"-O2 -fsplit-paths -fdump-tree-split-paths-details \" } */\n \n #include <stdio.h>\n #include <stdlib.h>"}]}