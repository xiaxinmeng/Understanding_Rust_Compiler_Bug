{"sha": "0684c8d3effab2c9c1b29938f5e56c77106af564", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6MDY4NGM4ZDNlZmZhYjJjOWMxYjI5OTM4ZjVlNTZjNzcxMDZhZjU2NA==", "commit": {"author": {"name": "Martin Liska", "email": "mliska@suse.cz", "date": "2021-08-17T12:57:40Z"}, "committer": {"name": "Martin Liska", "email": "mliska@suse.cz", "date": "2021-08-18T08:36:35Z"}, "message": "commit-mklog: Add --co argument.\n\nThe argument can be used for addition of Co-Authored-By lines\nwith --trailer='Co-Authored-By=Mona Lisa Octocat <mona@github.com>'.\n\ncontrib/ChangeLog:\n\n\t* gcc-git-customization.sh: Wrap $@ in quotes.\n\t* git-commit-mklog.py: Add new argument --co.\n\t* mklog.py: Skip the Co-Authored-By lines.", "tree": {"sha": "abf1088f6a04e30c0d637a3eecccf019871fc1ca", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/abf1088f6a04e30c0d637a3eecccf019871fc1ca"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/0684c8d3effab2c9c1b29938f5e56c77106af564", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/0684c8d3effab2c9c1b29938f5e56c77106af564", "html_url": "https://github.com/Rust-GCC/gccrs/commit/0684c8d3effab2c9c1b29938f5e56c77106af564", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/0684c8d3effab2c9c1b29938f5e56c77106af564/comments", "author": {"login": "marxin", "id": 2658545, "node_id": "MDQ6VXNlcjI2NTg1NDU=", "avatar_url": "https://avatars.githubusercontent.com/u/2658545?v=4", "gravatar_id": "", "url": "https://api.github.com/users/marxin", "html_url": "https://github.com/marxin", "followers_url": "https://api.github.com/users/marxin/followers", "following_url": "https://api.github.com/users/marxin/following{/other_user}", "gists_url": "https://api.github.com/users/marxin/gists{/gist_id}", "starred_url": "https://api.github.com/users/marxin/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/marxin/subscriptions", "organizations_url": "https://api.github.com/users/marxin/orgs", "repos_url": "https://api.github.com/users/marxin/repos", "events_url": "https://api.github.com/users/marxin/events{/privacy}", "received_events_url": "https://api.github.com/users/marxin/received_events", "type": "User", "site_admin": false}, "committer": {"login": "marxin", "id": 2658545, "node_id": "MDQ6VXNlcjI2NTg1NDU=", "avatar_url": "https://avatars.githubusercontent.com/u/2658545?v=4", "gravatar_id": "", "url": "https://api.github.com/users/marxin", "html_url": "https://github.com/marxin", "followers_url": "https://api.github.com/users/marxin/followers", "following_url": "https://api.github.com/users/marxin/following{/other_user}", "gists_url": "https://api.github.com/users/marxin/gists{/gist_id}", "starred_url": "https://api.github.com/users/marxin/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/marxin/subscriptions", "organizations_url": "https://api.github.com/users/marxin/orgs", "repos_url": "https://api.github.com/users/marxin/repos", "events_url": "https://api.github.com/users/marxin/events{/privacy}", "received_events_url": "https://api.github.com/users/marxin/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "1bf976a5de69ecd9b1e10eb7515357b98e78faf7", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/1bf976a5de69ecd9b1e10eb7515357b98e78faf7", "html_url": "https://github.com/Rust-GCC/gccrs/commit/1bf976a5de69ecd9b1e10eb7515357b98e78faf7"}], "stats": {"total": 17, "additions": 15, "deletions": 2}, "files": [{"sha": "aca61b781ff202bdfc77586bc46ec034dba3b7b7", "filename": "contrib/gcc-git-customization.sh", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/0684c8d3effab2c9c1b29938f5e56c77106af564/contrib%2Fgcc-git-customization.sh", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/0684c8d3effab2c9c1b29938f5e56c77106af564/contrib%2Fgcc-git-customization.sh", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/contrib%2Fgcc-git-customization.sh?ref=0684c8d3effab2c9c1b29938f5e56c77106af564", "patch": "@@ -28,7 +28,7 @@ git config alias.gcc-undescr \\!\"f() { o=\\$(git config --get gcc-config.upstream)\n git config alias.gcc-verify '!f() { \"`git rev-parse --show-toplevel`/contrib/gcc-changelog/git_check_commit.py\" $@; } ; f'\n git config alias.gcc-backport '!f() { \"`git rev-parse --show-toplevel`/contrib/git-backport.py\" $@; } ; f'\n git config alias.gcc-mklog '!f() { \"`git rev-parse --show-toplevel`/contrib/mklog.py\" $@; } ; f'\n-git config alias.gcc-commit-mklog '!f() { \"`git rev-parse --show-toplevel`/contrib/git-commit-mklog.py\" $@; }; f'\n+git config alias.gcc-commit-mklog '!f() { \"`git rev-parse --show-toplevel`/contrib/git-commit-mklog.py\" \"$@\"; }; f'\n \n # Make diff on MD files use \"(define\" as a function marker.\n # Use this in conjunction with a .gitattributes file containing"}, {"sha": "eda3fc4a8923ebf215620cf80ee1fe88fed0a06f", "filename": "contrib/git-commit-mklog.py", "status": "modified", "additions": 6, "deletions": 0, "changes": 6, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/0684c8d3effab2c9c1b29938f5e56c77106af564/contrib%2Fgit-commit-mklog.py", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/0684c8d3effab2c9c1b29938f5e56c77106af564/contrib%2Fgit-commit-mklog.py", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/contrib%2Fgit-commit-mklog.py?ref=0684c8d3effab2c9c1b29938f5e56c77106af564", "patch": "@@ -37,6 +37,8 @@\n                         help='Add the specified PRs (comma separated)')\n     parser.add_argument('-p', '--fill-up-bug-titles', action='store_true',\n                         help='Download title of mentioned PRs')\n+    parser.add_argument('--co',\n+                        help='Add Co-Authored-By trailer (comma separated)')\n     args, unknown_args = parser.parse_known_args()\n \n     myenv['GCC_FORCE_MKLOG'] = '1'\n@@ -49,5 +51,9 @@\n     if mklog_args:\n         myenv['GCC_MKLOG_ARGS'] = ' '.join(mklog_args)\n \n+    if args.co:\n+        for author in args.co.split(','):\n+            unknown_args.append(f'--trailer \"Co-Authored-By: {author}\"')\n+\n     commit_args = ' '.join(unknown_args)\n     subprocess.run(f'git commit {commit_args}', shell=True, env=myenv)"}, {"sha": "d362be5ab10810852c38c6362f0d9faa98bd188d", "filename": "contrib/mklog.py", "status": "modified", "additions": 8, "deletions": 1, "changes": 9, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/0684c8d3effab2c9c1b29938f5e56c77106af564/contrib%2Fmklog.py", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/0684c8d3effab2c9c1b29938f5e56c77106af564/contrib%2Fmklog.py", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/contrib%2Fmklog.py?ref=0684c8d3effab2c9c1b29938f5e56c77106af564", "patch": "@@ -40,6 +40,7 @@\n \n LINE_LIMIT = 100\n TAB_WIDTH = 8\n+CO_AUTHORED_BY_PREFIX = 'co-authored-by: '\n \n pr_regex = re.compile(r'(\\/(\\/|\\*)|[Cc*!])\\s+(?P<pr>PR [a-z+-]+\\/[0-9]+)')\n prnum_regex = re.compile(r'PR (?P<comp>[a-z+-]+)/(?P<num>[0-9]+)')\n@@ -317,6 +318,12 @@ def update_copyright(data):\n                 f.write(content)\n \n \n+def skip_line_in_changelog(line):\n+    if line.lower().startswith(CO_AUTHORED_BY_PREFIX) or line.startswith('#'):\n+        return False\n+    return True\n+\n+\n if __name__ == '__main__':\n     parser = argparse.ArgumentParser(description=help_message)\n     parser.add_argument('input', nargs='?',\n@@ -350,7 +357,7 @@ def update_copyright(data):\n                                     args.fill_up_bug_titles, args.pr_numbers)\n         if args.changelog:\n             lines = open(args.changelog).read().split('\\n')\n-            start = list(takewhile(lambda l: not l.startswith('#'), lines))\n+            start = list(takewhile(skip_line_in_changelog, lines))\n             end = lines[len(start):]\n             with open(args.changelog, 'w') as f:\n                 if not start or not start[0]:"}]}