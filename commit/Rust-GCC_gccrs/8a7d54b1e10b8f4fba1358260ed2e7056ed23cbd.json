{"sha": "8a7d54b1e10b8f4fba1358260ed2e7056ed23cbd", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6OGE3ZDU0YjFlMTBiOGY0ZmJhMTM1ODI2MGVkMmU3MDU2ZWQyM2NiZA==", "commit": {"author": {"name": "Jeff Law", "email": "jeffreyalaw@gmail.com", "date": "2021-06-13T15:09:38Z"}, "committer": {"name": "Jeff Law", "email": "jeffreyalaw@gmail.com", "date": "2021-06-13T15:18:14Z"}, "message": "[committed] More improvements to H8 logicals for test/compare elimination\n\ngcc/\n\t* config/h8300/logical.md (<code>qi3_1<cczn>): New pattern.\n\t(andqi3_1<cczn>): Removed.\n\t(<ors>qi3_1): Do not split for IOR/XOR a single bit.\n\t(H8/SX bit logicals): Split out from other patterns.\n\t* config/h8300/multiply.md (mulqihi3_const<cczn>): Renamed from\n\tmulqihi3_const_clobber_flags.\n\t(mulqihi3<cczn>, mulhisi3_const<cczn>, mulhisi3<cczn>): Similarly", "tree": {"sha": "a4a61247b738275125373d92ff302efd9fe0945d", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/a4a61247b738275125373d92ff302efd9fe0945d"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/8a7d54b1e10b8f4fba1358260ed2e7056ed23cbd", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/8a7d54b1e10b8f4fba1358260ed2e7056ed23cbd", "html_url": "https://github.com/Rust-GCC/gccrs/commit/8a7d54b1e10b8f4fba1358260ed2e7056ed23cbd", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/8a7d54b1e10b8f4fba1358260ed2e7056ed23cbd/comments", "author": {"login": "JeffreyALaw", "id": 14062506, "node_id": "MDQ6VXNlcjE0MDYyNTA2", "avatar_url": "https://avatars.githubusercontent.com/u/14062506?v=4", "gravatar_id": "", "url": "https://api.github.com/users/JeffreyALaw", "html_url": "https://github.com/JeffreyALaw", "followers_url": "https://api.github.com/users/JeffreyALaw/followers", "following_url": "https://api.github.com/users/JeffreyALaw/following{/other_user}", "gists_url": "https://api.github.com/users/JeffreyALaw/gists{/gist_id}", "starred_url": "https://api.github.com/users/JeffreyALaw/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/JeffreyALaw/subscriptions", "organizations_url": "https://api.github.com/users/JeffreyALaw/orgs", "repos_url": "https://api.github.com/users/JeffreyALaw/repos", "events_url": "https://api.github.com/users/JeffreyALaw/events{/privacy}", "received_events_url": "https://api.github.com/users/JeffreyALaw/received_events", "type": "User", "site_admin": false}, "committer": {"login": "JeffreyALaw", "id": 14062506, "node_id": "MDQ6VXNlcjE0MDYyNTA2", "avatar_url": "https://avatars.githubusercontent.com/u/14062506?v=4", "gravatar_id": "", "url": "https://api.github.com/users/JeffreyALaw", "html_url": "https://github.com/JeffreyALaw", "followers_url": "https://api.github.com/users/JeffreyALaw/followers", "following_url": "https://api.github.com/users/JeffreyALaw/following{/other_user}", "gists_url": "https://api.github.com/users/JeffreyALaw/gists{/gist_id}", "starred_url": "https://api.github.com/users/JeffreyALaw/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/JeffreyALaw/subscriptions", "organizations_url": "https://api.github.com/users/JeffreyALaw/orgs", "repos_url": "https://api.github.com/users/JeffreyALaw/repos", "events_url": "https://api.github.com/users/JeffreyALaw/events{/privacy}", "received_events_url": "https://api.github.com/users/JeffreyALaw/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "3f04e3782536ad2f9cfbb8cfe6630e9f9dd8af4c", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/3f04e3782536ad2f9cfbb8cfe6630e9f9dd8af4c", "html_url": "https://github.com/Rust-GCC/gccrs/commit/3f04e3782536ad2f9cfbb8cfe6630e9f9dd8af4c"}], "stats": {"total": 72, "additions": 43, "deletions": 29}, "files": [{"sha": "cb4c6384bdfa5e51b115237decbaa337270a75e2", "filename": "gcc/config/h8300/logical.md", "status": "modified", "additions": 39, "deletions": 25, "changes": 64, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/8a7d54b1e10b8f4fba1358260ed2e7056ed23cbd/gcc%2Fconfig%2Fh8300%2Flogical.md", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/8a7d54b1e10b8f4fba1358260ed2e7056ed23cbd/gcc%2Fconfig%2Fh8300%2Flogical.md", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fconfig%2Fh8300%2Flogical.md?ref=8a7d54b1e10b8f4fba1358260ed2e7056ed23cbd", "patch": "@@ -69,14 +69,6 @@\n   \"\"\n   [(set_attr \"length\" \"8,2\")])\n \n-(define_insn \"*andqi3_1<cczn>\"\n-  [(set (match_operand:QI 0 \"register_operand\" \"=r\")\n-\t(and:QI (match_operand:QI 1 \"register_operand\" \"%0\")\n-\t\t(match_operand:QI 2 \"h8300_src_operand\" \"rn\")))\n-   (clobber (reg:CC CC_REG))]\n-  \"\"\n-  \"and  %X2,%X0\"\n-  [(set_attr \"length\" \"2\")])\n \n (define_insn_and_split \"*andor<mode>3\"\n   [(set (match_operand:QHSI 0 \"register_operand\" \"=r\")\n@@ -179,27 +171,49 @@\n \t\t(match_operand:QI 2 \"h8300_src_operand\" \"Y2,rQi\")))]\n   \"TARGET_H8300SX || register_operand (operands[0], QImode)\n    || single_one_operand (operands[2], QImode)\"\n-  \"#\"\n-  \"&& reload_completed\"\n+  { return <CODE> == IOR ? \"bset\\\\t%V2,%R0\" : \"bnot\\\\t%V2,%R0\"; }\n+  \"&& reload_completed && !single_one_operand (operands[2], QImode)\"\n   [(parallel [(set (match_dup 0) (ors:QI (match_dup 1) (match_dup 2)))\n-\t      (clobber (reg:CC CC_REG))])])\n+\t      (clobber (reg:CC CC_REG))])]\n+  \"\"\n+  [(set_attr \"length\" \"8\")])\n \n-(define_insn \"<code>qi3_1_clobber_flags\"\n-  [(set (match_operand:QI 0 \"bit_operand\" \"=U,rQ\")\n-\t(ors:QI (match_operand:QI 1 \"bit_operand\" \"%0,0\")\n-\t\t(match_operand:QI 2 \"h8300_src_operand\" \"Y2,rQi\")))\n+(define_insn \"*<code>qi3_1<cczn>\"\n+  [(set (match_operand:QI 0 \"bit_operand\" \"=rQ\")\n+\t(ors:QI (match_operand:QI 1 \"bit_operand\" \"%0\")\n+\t\t(match_operand:QI 2 \"h8300_src_operand\" \"rQi\")))\n    (clobber (reg:CC CC_REG))]\n-  \"TARGET_H8300SX || register_operand (operands[0], QImode)\n-   || single_one_operand (operands[2], QImode)\"\n-  {\n-    if (which_alternative == 0)\n-      return <CODE> == IOR ? \"bset\\\\t%V2,%R0\" : \"bnot\\\\t%V2,%R0\";\n-    else if (which_alternative == 1)\n-      return <CODE> == IOR ? \"or\\\\t%X2,%X0\" : \"xor\\\\t%X2,%X0\";\n-    gcc_unreachable ();\n+  \"TARGET_H8300SX\"\n+  { return <CODE> == IOR ? \"or\\\\t%X2,%X0\" : \"xor\\\\t%X2,%X0\"; }\n+  [(set_attr \"length\" \"*\")\n+   (set_attr \"length_table\" \"logicb\")])\n+\n+(define_insn \"*<code>qi3_1<cczn>\"\n+  [(set (match_operand:QI 0 \"register_operand\" \"=r\")\n+\t(ors:QI (match_operand:QI 1 \"register_operand\" \"%0\")\n+\t\t(match_operand:QI 2 \"h8300_src_operand\" \"ri\")))\n+   (clobber (reg:CC CC_REG))]\n+  \"TARGET_H8300SX\"\n+  { return <CODE> == IOR ? \"or\\\\t%X2,%X0\" : \"xor\\\\t%X2,%X0\"; }\n+  [(set_attr \"length\" \"*\")\n+   (set_attr \"length_table\" \"logicb\")])\n+\n+(define_insn \"*<code>qi3_1<cczn>\"\n+  [(set (match_operand:QI 0 \"register_operand\" \"=r\")\n+\t(logicals:QI (match_operand:QI 1 \"register_operand\" \"%0\")\n+\t\t     (match_operand:QI 2 \"h8300_src_operand\" \"rn\")))\n+   (clobber (reg:CC CC_REG))]\n+  \"\"\n+  { \n+    if (<CODE> == IOR)\n+      return \"or\\\\t%X2,%X0\";\n+    else if (<CODE> == XOR)\n+      return \"xor\\\\t%X2,%X0\";\n+    else if (<CODE> == AND)\n+      return \"and\\\\t%X2,%X0\";\n+   gcc_unreachable ();\n   }\n-  [(set_attr \"length\" \"8,*\")\n-   (set_attr \"length_table\" \"*,logicb\")])\n+  [(set_attr \"length\" \"2\")])\n \n ;; ----------------------------------------------------------------------\n ;; {AND,IOR,XOR}{HI3,SI3} PATTERNS"}, {"sha": "8b9328c1282d55f658b9e9a41b6d5af80e5eb4a2", "filename": "gcc/config/h8300/multiply.md", "status": "modified", "additions": 4, "deletions": 4, "changes": 8, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/8a7d54b1e10b8f4fba1358260ed2e7056ed23cbd/gcc%2Fconfig%2Fh8300%2Fmultiply.md", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/8a7d54b1e10b8f4fba1358260ed2e7056ed23cbd/gcc%2Fconfig%2Fh8300%2Fmultiply.md", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fconfig%2Fh8300%2Fmultiply.md?ref=8a7d54b1e10b8f4fba1358260ed2e7056ed23cbd", "patch": "@@ -26,7 +26,7 @@\n \t\t   (mult:HI (sign_extend:HI (match_dup 1)) (match_dup 2)))\n \t      (clobber (reg:CC CC_REG))])])\n \n-(define_insn \"*mulqihi3_const_clobber_flags\"\n+(define_insn \"*mulqihi3_const<cczn>\"\n   [(set (match_operand:HI 0 \"register_operand\" \"=r\")\n \t(mult:HI (sign_extend:HI (match_operand:QI 1 \"register_operand\" \"%0\"))\n \t\t (match_operand:QI 2 \"nibble_operand\" \"IP4>X\")))\n@@ -47,7 +47,7 @@\n \t\t\t    (sign_extend:HI (match_dup 2))))\n \t      (clobber (reg:CC CC_REG))])])\n \n-(define_insn \"*mulqihi3_clobber_flags\"\n+(define_insn \"*mulqihi3<cczn>\"\n   [(set (match_operand:HI 0 \"register_operand\" \"=r\")\n \t(mult:HI (sign_extend:HI (match_operand:QI 1 \"register_operand\" \"%0\"))\n \t\t (sign_extend:HI (match_operand:QI 2 \"register_operand\" \"r\"))))\n@@ -78,7 +78,7 @@\n \t\t   (mult:SI (sign_extend:SI (match_dup 1)) (match_dup 2)))\n \t      (clobber (reg:CC CC_REG))])])\n \n-(define_insn \"*mulhisi3_const_clobber_flags\"\n+(define_insn \"*mulhisi3_const<cczn>\"\n   [(set (match_operand:SI 0 \"register_operand\" \"=r\")\n \t(mult:SI (sign_extend:SI (match_operand:HI 1 \"register_operand\" \"%0\"))\n \t\t (match_operand:SI 2 \"nibble_operand\" \"IP4>X\")))\n@@ -99,7 +99,7 @@\n \t\t\t    (sign_extend:SI (match_dup 2))))\n \t      (clobber (reg:CC CC_REG))])])\n \n-(define_insn \"*mulhisi3_clobber_flags\"\n+(define_insn \"*mulhisi3<cczn>\"\n   [(set (match_operand:SI 0 \"register_operand\" \"=r\")\n \t(mult:SI (sign_extend:SI (match_operand:HI 1 \"register_operand\" \"%0\"))\n \t\t (sign_extend:SI (match_operand:HI 2 \"register_operand\" \"r\"))))"}]}