{"sha": "098a4f50db43e6b8895f5ace49cbb1dc0be18c88", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6MDk4YTRmNTBkYjQzZTZiODg5NWY1YWNlNDljYmIxZGMwYmUxOGM4OA==", "commit": {"author": {"name": "Jan Hubicka", "email": "jh@suse.cz", "date": "2010-09-09T00:09:07Z"}, "committer": {"name": "Jan Hubicka", "email": "hubicka@gcc.gnu.org", "date": "2010-09-09T00:09:07Z"}, "message": "lto.c (real_file_count, [...]): New static vars.\n\n\n\t* lto.c (real_file_count, real_file_decl_data): New static vars.\n\t(read_cgraph_and_symbols): Use it.\n\nFrom-SVN: r164037", "tree": {"sha": "fa9bbf79f02320f36bb4373308277991e963b1fa", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/fa9bbf79f02320f36bb4373308277991e963b1fa"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/098a4f50db43e6b8895f5ace49cbb1dc0be18c88", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/098a4f50db43e6b8895f5ace49cbb1dc0be18c88", "html_url": "https://github.com/Rust-GCC/gccrs/commit/098a4f50db43e6b8895f5ace49cbb1dc0be18c88", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/098a4f50db43e6b8895f5ace49cbb1dc0be18c88/comments", "author": null, "committer": null, "parents": [{"sha": "bc707992399b622a1ebcc2ca7ccac49da250fbc0", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/bc707992399b622a1ebcc2ca7ccac49da250fbc0", "html_url": "https://github.com/Rust-GCC/gccrs/commit/bc707992399b622a1ebcc2ca7ccac49da250fbc0"}], "stats": {"total": 17, "additions": 15, "deletions": 2}, "files": [{"sha": "d719217ed022eba13f7840459c770bc6aba444bc", "filename": "gcc/lto/ChangeLog", "status": "modified", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/098a4f50db43e6b8895f5ace49cbb1dc0be18c88/gcc%2Flto%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/098a4f50db43e6b8895f5ace49cbb1dc0be18c88/gcc%2Flto%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Flto%2FChangeLog?ref=098a4f50db43e6b8895f5ace49cbb1dc0be18c88", "patch": "@@ -1,3 +1,8 @@\n+2010-09-08  Jan Hubicka  <jh@suse.cz>\n+\n+\t* lto.c (real_file_count, real_file_decl_data): New static vars.\n+\t(read_cgraph_and_symbols): Use it.\n+\n 2010-09-08  Richard Guenther  <rguenther@suse.de>\n \n \t* lto.c (read_cgraph_and_symbols): Collect again after each"}, {"sha": "747821334402974b4a5ad4472f06d27f535bdb91", "filename": "gcc/lto/lto.c", "status": "modified", "additions": 10, "deletions": 2, "changes": 12, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/098a4f50db43e6b8895f5ace49cbb1dc0be18c88/gcc%2Flto%2Flto.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/098a4f50db43e6b8895f5ace49cbb1dc0be18c88/gcc%2Flto%2Flto.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Flto%2Flto.c?ref=098a4f50db43e6b8895f5ace49cbb1dc0be18c88", "patch": "@@ -1726,6 +1726,11 @@ lto_flatten_files (struct lto_file_decl_data **orig, int count, int last_file_ix\n   gcc_assert (k == count);\n }\n \n+/* Input file data before flattening (i.e. splitting them to subfiles to support\n+   incremental linking.  */\n+static int real_file_count;\n+static GTY((length (\"real_file_count + 1\"))) struct lto_file_decl_data **real_file_decl_data;\n+\n /* Read all the symbols from the input files FNAMES.  NFILES is the\n    number of files requested in the command line.  Instantiate a\n    global call graph by aggregating all the sub-graphs found in each\n@@ -1744,7 +1749,9 @@ read_cgraph_and_symbols (unsigned nfiles, const char **fnames)\n \n   timevar_push (TV_IPA_LTO_DECL_IN);\n \n-  decl_data = (struct lto_file_decl_data **)xmalloc (sizeof(*decl_data) * (nfiles+1));\n+  real_file_decl_data\n+    = decl_data = ggc_alloc_cleared_vec_lto_file_decl_data_ptr (nfiles + 1);\n+  real_file_count = nfiles;\n \n   /* Read the resolution file.  */\n   resolution = NULL;\n@@ -1794,7 +1801,8 @@ read_cgraph_and_symbols (unsigned nfiles, const char **fnames)\n \n   lto_flatten_files (decl_data, count, last_file_ix);\n   lto_stats.num_input_files = count;\n-  free(decl_data);\n+  ggc_free(decl_data);\n+  real_file_decl_data = NULL;\n \n   if (resolution_file_name)\n     fclose (resolution);"}]}