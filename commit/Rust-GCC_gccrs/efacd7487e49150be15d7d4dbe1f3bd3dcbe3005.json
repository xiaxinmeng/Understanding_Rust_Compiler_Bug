{"sha": "efacd7487e49150be15d7d4dbe1f3bd3dcbe3005", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6ZWZhY2Q3NDg3ZTQ5MTUwYmUxNWQ3ZDRkYmUxZjNiZDNkY2JlMzAwNQ==", "commit": {"author": {"name": "Ralf Wildenhues", "email": "Ralf.Wildenhues@gmx.de", "date": "2008-04-17T22:30:18Z"}, "committer": {"name": "Ralf Wildenhues", "email": "rwild@gcc.gnu.org", "date": "2008-04-17T22:30:18Z"}, "message": "gen-classlist.sh.in: Avoid grepping each omission...\n\nlibjava/classpath/\n\n\t* lib/gen-classlist.sh.in: Avoid grepping each omission, by\n\tbuilding an awk script with a hash for literal files, and\n\tawk regular expressions for the rest.\n\t* configure.ac: Call AC_PROG_AWK.\n\t* configure: Regenerate.\n\nFrom-SVN: r134414", "tree": {"sha": "7c1e6dda7d67b020d26682ab9eb0d49d12fe5e13", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/7c1e6dda7d67b020d26682ab9eb0d49d12fe5e13"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/efacd7487e49150be15d7d4dbe1f3bd3dcbe3005", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/efacd7487e49150be15d7d4dbe1f3bd3dcbe3005", "html_url": "https://github.com/Rust-GCC/gccrs/commit/efacd7487e49150be15d7d4dbe1f3bd3dcbe3005", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/efacd7487e49150be15d7d4dbe1f3bd3dcbe3005/comments", "author": null, "committer": null, "parents": [{"sha": "015cd9b1182b87eab57b92353a7b124d1b3958df", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/015cd9b1182b87eab57b92353a7b124d1b3958df", "html_url": "https://github.com/Rust-GCC/gccrs/commit/015cd9b1182b87eab57b92353a7b124d1b3958df"}], "stats": {"total": 108, "additions": 88, "deletions": 20}, "files": [{"sha": "c3f3af24b11668714f738a4f1175a6fbfdc0e224", "filename": "libjava/classpath/ChangeLog", "status": "modified", "additions": 6, "deletions": 0, "changes": 6, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/efacd7487e49150be15d7d4dbe1f3bd3dcbe3005/libjava%2Fclasspath%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/efacd7487e49150be15d7d4dbe1f3bd3dcbe3005/libjava%2Fclasspath%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libjava%2Fclasspath%2FChangeLog?ref=efacd7487e49150be15d7d4dbe1f3bd3dcbe3005", "patch": "@@ -1,5 +1,11 @@\n 2008-04-18  Ralf Wildenhues  <Ralf.Wildenhues@gmx.de>\n \n+\t* lib/gen-classlist.sh.in: Avoid grepping each omission, by\n+\tbuilding an awk script with a hash for literal files, and\n+\tawk regular expressions for the rest.\n+\t* configure.ac: Call AC_PROG_AWK.\n+\t* configure: Regenerate.\n+\n \t* m4/gcc_attribute.m4 (GCC_ATTRIBUTE): Fix cache variable name.\n \t* tools/Makefile.am (gappletviewer, gjarsigner, gkeytool, gjar)\n \t(gnative2ascii, gserialver, gjavah, grmiregistry, gtnameserv)"}, {"sha": "c4031cf28de9cb30c6c756316dec29bb625a324c", "filename": "libjava/classpath/configure", "status": "modified", "additions": 46, "deletions": 6, "changes": 52, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/efacd7487e49150be15d7d4dbe1f3bd3dcbe3005/libjava%2Fclasspath%2Fconfigure", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/efacd7487e49150be15d7d4dbe1f3bd3dcbe3005/libjava%2Fclasspath%2Fconfigure", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libjava%2Fclasspath%2Fconfigure?ref=efacd7487e49150be15d7d4dbe1f3bd3dcbe3005", "patch": "@@ -11073,6 +11073,46 @@ CC=\"$lt_save_CC\"\n # Only expand once:\n \n \n+for ac_prog in gawk mawk nawk awk\n+do\n+  # Extract the first word of \"$ac_prog\", so it can be a program name with args.\n+set dummy $ac_prog; ac_word=$2\n+echo \"$as_me:$LINENO: checking for $ac_word\" >&5\n+echo $ECHO_N \"checking for $ac_word... $ECHO_C\" >&6\n+if test \"${ac_cv_prog_AWK+set}\" = set; then\n+  echo $ECHO_N \"(cached) $ECHO_C\" >&6\n+else\n+  if test -n \"$AWK\"; then\n+  ac_cv_prog_AWK=\"$AWK\" # Let the user override the test.\n+else\n+as_save_IFS=$IFS; IFS=$PATH_SEPARATOR\n+for as_dir in $PATH\n+do\n+  IFS=$as_save_IFS\n+  test -z \"$as_dir\" && as_dir=.\n+  for ac_exec_ext in '' $ac_executable_extensions; do\n+  if $as_executable_p \"$as_dir/$ac_word$ac_exec_ext\"; then\n+    ac_cv_prog_AWK=\"$ac_prog\"\n+    echo \"$as_me:$LINENO: found $as_dir/$ac_word$ac_exec_ext\" >&5\n+    break 2\n+  fi\n+done\n+done\n+\n+fi\n+fi\n+AWK=$ac_cv_prog_AWK\n+if test -n \"$AWK\"; then\n+  echo \"$as_me:$LINENO: result: $AWK\" >&5\n+echo \"${ECHO_T}$AWK\" >&6\n+else\n+  echo \"$as_me:$LINENO: result: no\" >&5\n+echo \"${ECHO_T}no\" >&6\n+fi\n+\n+  test -n \"$AWK\" && break\n+done\n+\n ac_ext=c\n ac_cpp='$CPP $CPPFLAGS'\n ac_compile='$CC -c $CFLAGS $CPPFLAGS conftest.$ac_ext >&5'\n@@ -15239,11 +15279,11 @@ else\n    -e 's:.*FLAGS}\\{0,1\\} :&$lt_compiler_flag :; t' \\\n    -e 's: [^ ]*conftest\\.: $lt_compiler_flag&:; t' \\\n    -e 's:$: $lt_compiler_flag:'`\n-   (eval echo \"\\\"\\$as_me:15242: $lt_compile\\\"\" >&5)\n+   (eval echo \"\\\"\\$as_me:15282: $lt_compile\\\"\" >&5)\n    (eval \"$lt_compile\" 2>conftest.err)\n    ac_status=$?\n    cat conftest.err >&5\n-   echo \"$as_me:15246: \\$? = $ac_status\" >&5\n+   echo \"$as_me:15286: \\$? = $ac_status\" >&5\n    if (exit $ac_status) && test -s \"$ac_outfile\"; then\n      # The compiler can only warn and ignore the option if not recognized\n      # So say no if there are warnings other than the usual output.\n@@ -15338,11 +15378,11 @@ else\n    -e 's:.*FLAGS}\\{0,1\\} :&$lt_compiler_flag :; t' \\\n    -e 's: [^ ]*conftest\\.: $lt_compiler_flag&:; t' \\\n    -e 's:$: $lt_compiler_flag:'`\n-   (eval echo \"\\\"\\$as_me:15341: $lt_compile\\\"\" >&5)\n+   (eval echo \"\\\"\\$as_me:15381: $lt_compile\\\"\" >&5)\n    (eval \"$lt_compile\" 2>out/conftest.err)\n    ac_status=$?\n    cat out/conftest.err >&5\n-   echo \"$as_me:15345: \\$? = $ac_status\" >&5\n+   echo \"$as_me:15385: \\$? = $ac_status\" >&5\n    if (exit $ac_status) && test -s out/conftest2.$ac_objext\n    then\n      # The compiler can only warn and ignore the option if not recognized\n@@ -15390,11 +15430,11 @@ else\n    -e 's:.*FLAGS}\\{0,1\\} :&$lt_compiler_flag :; t' \\\n    -e 's: [^ ]*conftest\\.: $lt_compiler_flag&:; t' \\\n    -e 's:$: $lt_compiler_flag:'`\n-   (eval echo \"\\\"\\$as_me:15393: $lt_compile\\\"\" >&5)\n+   (eval echo \"\\\"\\$as_me:15433: $lt_compile\\\"\" >&5)\n    (eval \"$lt_compile\" 2>out/conftest.err)\n    ac_status=$?\n    cat out/conftest.err >&5\n-   echo \"$as_me:15397: \\$? = $ac_status\" >&5\n+   echo \"$as_me:15437: \\$? = $ac_status\" >&5\n    if (exit $ac_status) && test -s out/conftest2.$ac_objext\n    then\n      # The compiler can only warn and ignore the option if not recognized"}, {"sha": "d1f34ca28b389253d5c419b0c98e0512ddf589db", "filename": "libjava/classpath/configure.ac", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/efacd7487e49150be15d7d4dbe1f3bd3dcbe3005/libjava%2Fclasspath%2Fconfigure.ac", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/efacd7487e49150be15d7d4dbe1f3bd3dcbe3005/libjava%2Fclasspath%2Fconfigure.ac", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libjava%2Fclasspath%2Fconfigure.ac?ref=efacd7487e49150be15d7d4dbe1f3bd3dcbe3005", "patch": "@@ -375,7 +375,7 @@ dnl -----------------------------------------------------------\n dnl Initialize libtool\n AC_DISABLE_STATIC\n AC_PROG_LIBTOOL\n-dnl AC_PROG_AWK\n+AC_PROG_AWK\n AC_PROG_CC\n AM_PROG_CC_C_O\n AC_PROG_CPP"}, {"sha": "1768c15c7fba6034c1eb6998572a0ea391e76bfd", "filename": "libjava/classpath/lib/gen-classlist.sh.in", "status": "modified", "additions": 35, "deletions": 13, "changes": 48, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/efacd7487e49150be15d7d4dbe1f3bd3dcbe3005/libjava%2Fclasspath%2Flib%2Fgen-classlist.sh.in", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/efacd7487e49150be15d7d4dbe1f3bd3dcbe3005/libjava%2Fclasspath%2Flib%2Fgen-classlist.sh.in", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libjava%2Fclasspath%2Flib%2Fgen-classlist.sh.in?ref=efacd7487e49150be15d7d4dbe1f3bd3dcbe3005", "patch": "@@ -82,26 +82,48 @@ for dir in $vm_dirlist; do\n    fi\n done\n \n-# FIXME: could be more efficient by constructing a series of greps.\n-for filexp in `cat tmp.omit`; do\n-   grep -v ${filexp} < ${top_builddir}/lib/classes.1 > ${top_builddir}/lib/classes.tmp\n-   mv ${top_builddir}/lib/classes.tmp ${top_builddir}/lib/classes.1\n-done\n+# Mangle the omit expressions into a script suitable for old awk.\n+# Exploit the fact that many omissions are not regular expressions:\n+# assume a single file is listed if it does not contain '*', '$',\n+# and ends in '.java'.\n+sed_omit_hash='\n+1i\\\n+  BEGIN {\\\n+    omit[\"\"] = 1\n+$a\\\n+  }\n+/[*$]/d\n+/\\.java$/!d\n+s|^|    omit[\"|\n+s|$|\"] = 1|'\n+sed_omit_main_loop='\n+1i\\\n+  {\\\n+    if (omit[$3]) next\n+$a\\\n+    print\\\n+  }\n+/^[^*$]*\\.java$/d\n+s|/|\\\\/|g\n+s|^|  if ($3 ~ /|\n+s|$|/) next|'\n \n+sed \"$sed_omit_hash\" <tmp.omit >tmp.awk\n+sed \"$sed_omit_main_loop\" <tmp.omit >>tmp.awk\n+@AWK@ -f tmp.awk < ${top_builddir}/lib/classes.1 > ${top_builddir}/lib/classes.tmp\n+mv ${top_builddir}/lib/classes.tmp ${top_builddir}/lib/classes.1\n \n+vm_omitlist=\n for dir in $vm_dirlist; do\n    if test -f $dir/$1.omit; then\n-      for filexp in `cat $dir/$1.omit`; do\n-\t grep -v $filexp < vm.add > vm.add.1\n-\t mv vm.add.1 vm.add\n-      done\n+      vm_omitlist=\"$vm_omitlist $dir/$1.omit\"\n    fi\n done\n-cat vm.add >> classes.1\n+cat $vm_omitlist | sed \"$sed_omit_hash\" > tmp.awk\n+cat $vm_omitlist | sed \"$sed_omit_main_loop\" >> tmp.awk\n+@AWK@ -f tmp.awk < vm.add >>${top_builddir}/lib/classes.1\n \n-rm vm.omit\n-rm vm.add\n-rm tmp.omit\n+rm -f vm.omit vm.add tmp.omit tmp.awk\n \n new=\n if test -f ${top_builddir}/lib/classes.2; then"}]}