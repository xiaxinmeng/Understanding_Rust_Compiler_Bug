{"sha": "9d8646d7b098cd131bd9263ec98d3c03bdf4f66b", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6OWQ4NjQ2ZDdiMDk4Y2QxMzFiZDkyNjNlYzk4ZDNjMDNiZGY0ZjY2Yg==", "commit": {"author": {"name": "Paul Brook", "email": "paul@codesourcery.com", "date": "2004-08-09T20:31:41Z"}, "committer": {"name": "Paul Brook", "email": "pbrook@gcc.gnu.org", "date": "2004-08-09T20:31:41Z"}, "message": "unwind-dw2.c (uw_install_context_1): Update target saved stack pointer.\n\n\t* unwind-dw2.c (uw_install_context_1): Update target saved stack\n\tpointer.\n\nCo-Authored-By: Richard Henderson <rth@redhat.com>\n\nFrom-SVN: r85723", "tree": {"sha": "b22213fcc797d974ef0d6a219a5158d5efb1523f", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/b22213fcc797d974ef0d6a219a5158d5efb1523f"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/9d8646d7b098cd131bd9263ec98d3c03bdf4f66b", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/9d8646d7b098cd131bd9263ec98d3c03bdf4f66b", "html_url": "https://github.com/Rust-GCC/gccrs/commit/9d8646d7b098cd131bd9263ec98d3c03bdf4f66b", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/9d8646d7b098cd131bd9263ec98d3c03bdf4f66b/comments", "author": null, "committer": null, "parents": [{"sha": "d37e6b50362c82ee6bcb630a949e7e38830901ba", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/d37e6b50362c82ee6bcb630a949e7e38830901ba", "html_url": "https://github.com/Rust-GCC/gccrs/commit/d37e6b50362c82ee6bcb630a949e7e38830901ba"}], "stats": {"total": 41, "additions": 25, "deletions": 16}, "files": [{"sha": "ee1cbd78caca8b935f0acc4b0174f89c6ca19582", "filename": "gcc/ChangeLog", "status": "modified", "additions": 6, "deletions": 0, "changes": 6, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/9d8646d7b098cd131bd9263ec98d3c03bdf4f66b/gcc%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/9d8646d7b098cd131bd9263ec98d3c03bdf4f66b/gcc%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2FChangeLog?ref=9d8646d7b098cd131bd9263ec98d3c03bdf4f66b", "patch": "@@ -1,3 +1,9 @@\n+2004-08-09  Paul Brook  <paul@codesourcery.com>\n+\tRichard Henderson  <rth@redhat.com>\n+\n+\t* unwind-dw2.c (uw_install_context_1): Update target saved stack\n+\tpointer.\n+\n 2004-08-09  Geoffrey Keating  <geoffk@apple.com>\n \n \t* ggc-common.c (ggc_rlimit_bound): Don't check RSS limit."}, {"sha": "8b60b0c78d43fbb043d13544842b4e39ff55f30f", "filename": "gcc/unwind-dw2.c", "status": "modified", "additions": 19, "deletions": 16, "changes": 35, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/9d8646d7b098cd131bd9263ec98d3c03bdf4f66b/gcc%2Funwind-dw2.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/9d8646d7b098cd131bd9263ec98d3c03bdf4f66b/gcc%2Funwind-dw2.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Funwind-dw2.c?ref=9d8646d7b098cd131bd9263ec98d3c03bdf4f66b", "patch": "@@ -1274,6 +1274,12 @@ uw_install_context_1 (struct _Unwind_Context *current,\n \t\t      struct _Unwind_Context *target)\n {\n   long i;\n+  _Unwind_SpTmp sp_slot;\n+\n+  /* If the target frame does not have a saved stack pointer,\n+     then set up the target's CFA.  */\n+  if (!_Unwind_GetGRPtr (target, __builtin_dwarf_sp_column ()))\n+\t_Unwind_SetSpColumn (target, target->cfa, &sp_slot);\n \n   for (i = 0; i < DWARF_FRAME_REGISTERS; ++i)\n     {\n@@ -1284,25 +1290,22 @@ uw_install_context_1 (struct _Unwind_Context *current,\n \tmemcpy (c, t, dwarf_reg_size_table[i]);\n     }\n \n-#ifdef EH_RETURN_STACKADJ_RTX\n-  {\n-    void *target_cfa;\n+  /* If the current frame doesn't have a saved stack pointer, then we\n+     need to rely on EH_RETURN_STACKADJ_RTX to get our target stack\n+     pointer value reloaded.  */\n+  if (!_Unwind_GetGRPtr (current, __builtin_dwarf_sp_column ()))\n+    {\n+      void *target_cfa;\n \n-    /* If the last frame records a saved stack pointer, use it.  */\n-    if (_Unwind_GetGRPtr (target, __builtin_dwarf_sp_column ()))\n       target_cfa = _Unwind_GetPtr (target, __builtin_dwarf_sp_column ());\n-    else\n-      target_cfa = target->cfa;\n-\n-    /* We adjust SP by the difference between CURRENT and TARGET's CFA.  */\n-    if (STACK_GROWS_DOWNWARD)\n-      return target_cfa - current->cfa + target->args_size;\n-    else\n-      return current->cfa - target_cfa - target->args_size;\n-  }\n-#else\n+\n+      /* We adjust SP by the difference between CURRENT and TARGET's CFA.  */\n+      if (STACK_GROWS_DOWNWARD)\n+\treturn target_cfa - current->cfa + target->args_size;\n+      else\n+\treturn current->cfa - target_cfa - target->args_size;\n+    }\n   return 0;\n-#endif\n }\n \n static inline _Unwind_Ptr"}]}