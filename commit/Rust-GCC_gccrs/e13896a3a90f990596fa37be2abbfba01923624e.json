{"sha": "e13896a3a90f990596fa37be2abbfba01923624e", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6ZTEzODk2YTNhOTBmOTkwNTk2ZmEzN2JlMmFiYmZiYTAxOTIzNjI0ZQ==", "commit": {"author": {"name": "John David Anglin", "email": "danglin@gcc.gnu.org", "date": "2019-06-07T23:13:08Z"}, "committer": {"name": "John David Anglin", "email": "danglin@gcc.gnu.org", "date": "2019-06-07T23:13:08Z"}, "message": "re PR target/90751 (-fpatchtable-function-entry  broken on hppa-linux-gnu-gcc/hppa64-linux-gnu-gcc)\n\n\tPR target/90751\n\t* config/pa/pa-linux.h (ASM_DECLARE_FUNCTION_NAME): Update comment.\n\tCall pa_output_function_label>\n\t(TARGET_ASM_FUNCTION_PROLOGUE): define.\n\t* config/pa/pa-protos.h (pa_output_function_label): Declare.\n\t* config/pa/pa.c (pa_output_function_prologue): Add ATTRIBUTE_UNUSED\n\tto declaration.\n\t(pa_linux_output_function_prologue): Declare.\n\t(TARGET_ASM_FUNCTION_PROLOGUE): Delete define.\n\t(pa_output_function_label): New.\n\t(pa_output_function_prologue): Revise to use pa_output_function_label.\n\t(pa_linux_output_function_prologue): New.\n\t* config/pa/pa.h (TARGET_ASM_FUNCTION_PROLOGUE): Define.\n\nFrom-SVN: r272059", "tree": {"sha": "f02bb6180c72de26f0a3940e8d32ffa53b21fb28", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/f02bb6180c72de26f0a3940e8d32ffa53b21fb28"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/e13896a3a90f990596fa37be2abbfba01923624e", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/e13896a3a90f990596fa37be2abbfba01923624e", "html_url": "https://github.com/Rust-GCC/gccrs/commit/e13896a3a90f990596fa37be2abbfba01923624e", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/e13896a3a90f990596fa37be2abbfba01923624e/comments", "author": null, "committer": null, "parents": [{"sha": "1ef8f50e4f37e251aaf8d3c258d8c7ae9f1f7a38", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/1ef8f50e4f37e251aaf8d3c258d8c7ae9f1f7a38", "html_url": "https://github.com/Rust-GCC/gccrs/commit/1ef8f50e4f37e251aaf8d3c258d8c7ae9f1f7a38"}], "stats": {"total": 59, "additions": 46, "deletions": 13}, "files": [{"sha": "3721c87caebc3a860e532ab7a270fd385ec219a4", "filename": "gcc/ChangeLog", "status": "modified", "additions": 16, "deletions": 0, "changes": 16, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/e13896a3a90f990596fa37be2abbfba01923624e/gcc%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/e13896a3a90f990596fa37be2abbfba01923624e/gcc%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2FChangeLog?ref=e13896a3a90f990596fa37be2abbfba01923624e", "patch": "@@ -1,3 +1,19 @@\n+2019-06-07  John David Anglin  <danglin@gcc.gnu.orig>\n+\n+\tPR target/90751\n+\t* config/pa/pa-linux.h (ASM_DECLARE_FUNCTION_NAME): Update comment.\n+\tCall pa_output_function_label.\n+\t(TARGET_ASM_FUNCTION_PROLOGUE): define.\n+\t* config/pa/pa-protos.h (pa_output_function_label): Declare.\n+\t* config/pa/pa.c (pa_output_function_prologue): Add ATTRIBUTE_UNUSED\n+\tto declaration.\n+\t(pa_linux_output_function_prologue): Declare.\n+\t(TARGET_ASM_FUNCTION_PROLOGUE): Delete define.\n+\t(pa_output_function_label): New.\n+\t(pa_output_function_prologue): Revise to use pa_output_function_label.\n+\t(pa_linux_output_function_prologue): New.\n+\t* config/pa/pa.h (TARGET_ASM_FUNCTION_PROLOGUE): Define.\n+\n 2019-06-07  Aldy Hernandez  <aldyh@redhat.com>\n \n \t* tree-vrp.h (value_range_base::intersect): New."}, {"sha": "23812e4aded72c51eb4425d1193b07f80c6d7f76", "filename": "gcc/config/pa/pa-linux.h", "status": "modified", "additions": 6, "deletions": 1, "changes": 7, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/e13896a3a90f990596fa37be2abbfba01923624e/gcc%2Fconfig%2Fpa%2Fpa-linux.h", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/e13896a3a90f990596fa37be2abbfba01923624e/gcc%2Fconfig%2Fpa%2Fpa-linux.h", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fconfig%2Fpa%2Fpa-linux.h?ref=e13896a3a90f990596fa37be2abbfba01923624e", "patch": "@@ -101,17 +101,22 @@ along with GCC; see the file COPYING3.  If not see\n \n /* FIXME: Hacked from the <elfos.h> one so that we avoid multiple\n    labels in a function declaration (since pa.c seems determined to do\n-   it differently)  */\n+   it differently).  */\n \n #undef ASM_DECLARE_FUNCTION_NAME\n #define ASM_DECLARE_FUNCTION_NAME(FILE, NAME, DECL)\t\t\\\n   do\t\t\t\t\t\t\t\t\\\n     {\t\t\t\t\t\t\t\t\\\n       ASM_OUTPUT_TYPE_DIRECTIVE (FILE, NAME, \"function\");\t\\\n       ASM_DECLARE_RESULT (FILE, DECL_RESULT (DECL));\t\t\\\n+      pa_output_function_label (FILE);\t\t\t\t\\\n     }\t\t\t\t\t\t\t\t\\\n   while (0)\n \n+/* Output function prologue for linux.  */\n+#undef TARGET_ASM_FUNCTION_PROLOGUE\n+#define TARGET_ASM_FUNCTION_PROLOGUE pa_linux_output_function_prologue\n+\n /* As well as globalizing the label, we need to encode the label\n    to ensure a plabel is generated in an indirect call.  */\n "}, {"sha": "a62eeb732dcbea872c96a6f09a024b06e43ab06a", "filename": "gcc/config/pa/pa-protos.h", "status": "modified", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/e13896a3a90f990596fa37be2abbfba01923624e/gcc%2Fconfig%2Fpa%2Fpa-protos.h", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/e13896a3a90f990596fa37be2abbfba01923624e/gcc%2Fconfig%2Fpa%2Fpa-protos.h", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fconfig%2Fpa%2Fpa-protos.h?ref=e13896a3a90f990596fa37be2abbfba01923624e", "patch": "@@ -108,6 +108,7 @@ extern void pa_asm_output_aligned_local (FILE *, const char *,\n extern void pa_hpux_asm_output_external (FILE *, tree, const char *);\n extern HOST_WIDE_INT pa_initial_elimination_offset (int, int);\n extern HOST_WIDE_INT pa_function_arg_size (machine_mode, const_tree);\n+extern void pa_output_function_label (FILE *);\n \n extern const int pa_magic_milli[];\n "}, {"sha": "deb2d439b09afc2f7ba0622c3bf65239c63e82d5", "filename": "gcc/config/pa/pa.c", "status": "modified", "additions": 20, "deletions": 12, "changes": 32, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/e13896a3a90f990596fa37be2abbfba01923624e/gcc%2Fconfig%2Fpa%2Fpa.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/e13896a3a90f990596fa37be2abbfba01923624e/gcc%2Fconfig%2Fpa%2Fpa.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fconfig%2Fpa%2Fpa.c?ref=e13896a3a90f990596fa37be2abbfba01923624e", "patch": "@@ -118,7 +118,8 @@ static void set_reg_plus_d (int, int, HOST_WIDE_INT, int);\n static rtx pa_function_value (const_tree, const_tree, bool);\n static rtx pa_libcall_value (machine_mode, const_rtx);\n static bool pa_function_value_regno_p (const unsigned int);\n-static void pa_output_function_prologue (FILE *);\n+static void pa_output_function_prologue (FILE *) ATTRIBUTE_UNUSED;\n+static void pa_linux_output_function_prologue (FILE *) ATTRIBUTE_UNUSED;\n static void update_total_code_bytes (unsigned int);\n static void pa_output_function_epilogue (FILE *);\n static int pa_adjust_cost (rtx_insn *, int, rtx_insn *, int, unsigned int);\n@@ -262,8 +263,6 @@ static size_t n_deferred_plabels = 0;\n #undef TARGET_ASM_INTEGER\n #define TARGET_ASM_INTEGER pa_assemble_integer\n \n-#undef TARGET_ASM_FUNCTION_PROLOGUE\n-#define TARGET_ASM_FUNCTION_PROLOGUE pa_output_function_prologue\n #undef TARGET_ASM_FUNCTION_EPILOGUE\n #define TARGET_ASM_FUNCTION_EPILOGUE pa_output_function_epilogue\n \n@@ -3842,16 +3841,10 @@ pa_compute_frame_size (poly_int64 size, int *fregs_live)\n \t  & ~(PREFERRED_STACK_BOUNDARY / BITS_PER_UNIT - 1));\n }\n \n-/* On HP-PA, move-double insns between fpu and cpu need an 8-byte block\n-   of memory.  If any fpu reg is used in the function, we allocate\n-   such a block here, at the bottom of the frame, just in case it's needed.\n+/* Output function label, and associated .PROC and .CALLINFO statements.  */\n \n-   If this function is a leaf procedure, then we may choose not\n-   to do a \"save\" insn.  The decision about whether or not\n-   to do this is made in regclass.c.  */\n-\n-static void\n-pa_output_function_prologue (FILE *file)\n+void\n+pa_output_function_label (FILE *file)\n {\n   /* The function's label and associated .PROC must never be\n      separated and must be output *after* any profiling declarations\n@@ -3897,7 +3890,22 @@ pa_output_function_prologue (FILE *file)\n     fprintf (file, \",ENTRY_FR=%d\", fr_saved + 11);\n \n   fputs (\"\\n\\t.ENTRY\\n\", file);\n+}\n+\n+/* Output function prologue.  */\n \n+static void\n+pa_output_function_prologue (FILE *file)\n+{\n+  pa_output_function_label (file);\n+  remove_useless_addtr_insns (0);\n+}\n+\n+/* The label is output by ASM_DECLARE_FUNCTION_NAME on linux.  */\n+\n+static void\n+pa_linux_output_function_prologue (FILE *file ATTRIBUTE_UNUSED)\n+{\n   remove_useless_addtr_insns (0);\n }\n "}, {"sha": "561efa518829b381b1c7f28412cee8286f575b1d", "filename": "gcc/config/pa/pa.h", "status": "modified", "additions": 3, "deletions": 0, "changes": 3, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/e13896a3a90f990596fa37be2abbfba01923624e/gcc%2Fconfig%2Fpa%2Fpa.h", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/e13896a3a90f990596fa37be2abbfba01923624e/gcc%2Fconfig%2Fpa%2Fpa.h", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fconfig%2Fpa%2Fpa.h?ref=e13896a3a90f990596fa37be2abbfba01923624e", "patch": "@@ -1305,3 +1305,6 @@ do {\t\t\t\t\t\t\t\t\t     \\\n \n /* Target CPU versions for D.  */\n #define TARGET_D_CPU_VERSIONS pa_d_target_versions\n+\n+/* Output default function prologue for hpux.  */\n+#define TARGET_ASM_FUNCTION_PROLOGUE pa_output_function_prologue"}]}