{"sha": "5d5cb4d4c12b658375e64c9854b87fb3c3870d36", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6NWQ1Y2I0ZDRjMTJiNjU4Mzc1ZTY0Yzk4NTRiODdmYjNjMzg3MGQzNg==", "commit": {"author": {"name": "Richard Biener", "email": "rguenth@gcc.gnu.org", "date": "2014-06-16T08:16:01Z"}, "committer": {"name": "Richard Biener", "email": "rguenth@gcc.gnu.org", "date": "2014-06-16T08:16:01Z"}, "message": "tree-ssa-pre.c (eliminate_dom_walker::before_dom_children): Make all defs available at the end.\n\n2014-06-16  Richard Biener  <rguenther@suse.de>\n\n\t* tree-ssa-pre.c (eliminate_dom_walker::before_dom_children):\n\tMake all defs available at the end.\n\t(eliminate): If we remove a PHI node schedule cfg-cleanup.\n\nFrom-SVN: r211698", "tree": {"sha": "6ee693ff5d78441c403995132d5b06ba13fe74aa", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/6ee693ff5d78441c403995132d5b06ba13fe74aa"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/5d5cb4d4c12b658375e64c9854b87fb3c3870d36", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/5d5cb4d4c12b658375e64c9854b87fb3c3870d36", "html_url": "https://github.com/Rust-GCC/gccrs/commit/5d5cb4d4c12b658375e64c9854b87fb3c3870d36", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/5d5cb4d4c12b658375e64c9854b87fb3c3870d36/comments", "author": null, "committer": null, "parents": [{"sha": "4e4fa3c522cea950b30b119a9efdbc10476cce64", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/4e4fa3c522cea950b30b119a9efdbc10476cce64", "html_url": "https://github.com/Rust-GCC/gccrs/commit/4e4fa3c522cea950b30b119a9efdbc10476cce64"}], "stats": {"total": 25, "additions": 18, "deletions": 7}, "files": [{"sha": "2394901247f307b2a1060f41e8fdf68c4fdd2262", "filename": "gcc/ChangeLog", "status": "modified", "additions": 8, "deletions": 1, "changes": 9, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/5d5cb4d4c12b658375e64c9854b87fb3c3870d36/gcc%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/5d5cb4d4c12b658375e64c9854b87fb3c3870d36/gcc%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2FChangeLog?ref=5d5cb4d4c12b658375e64c9854b87fb3c3870d36", "patch": "@@ -1,3 +1,9 @@\n+2014-06-16  Richard Biener  <rguenther@suse.de>\n+\n+\t* tree-ssa-pre.c (eliminate_dom_walker::before_dom_children):\n+\tMake all defs available at the end.\n+\t(eliminate): If we remove a PHI node schedule cfg-cleanup.\n+\n 2014-06-18  Jakub Jelinek  <jakub@redhat.com>\n \n \tPR plugins/45078\n@@ -11,7 +17,8 @@\n \n 2014-06-15  Jan Hubicka  <hubicka@ucw.cz>\n \n-\t* c-family/c-common.c (handle_tls_model_attribute): Use set_decl_tls_model.\n+\t* c-family/c-common.c (handle_tls_model_attribute): Use\n+\tset_decl_tls_model.\n \t* cgraph.h (struct varpool_node): Add tls_model.\n \t* tree.c (decl_tls_model, set_decl_tls_model): New functions.\n \t* tree.h (DECL_TLS_MODEL): Update."}, {"sha": "bca95ddb9bf43eb6cc98941c15f305f0560bce1f", "filename": "gcc/tree-ssa-pre.c", "status": "modified", "additions": 10, "deletions": 6, "changes": 16, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/5d5cb4d4c12b658375e64c9854b87fb3c3870d36/gcc%2Ftree-ssa-pre.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/5d5cb4d4c12b658375e64c9854b87fb3c3870d36/gcc%2Ftree-ssa-pre.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftree-ssa-pre.c?ref=5d5cb4d4c12b658375e64c9854b87fb3c3870d36", "patch": "@@ -4188,7 +4188,6 @@ eliminate_dom_walker::before_dom_children (basic_block b)\n \t\t\t\t   b->loop_father->num);\n \t\t\t}\n \t\t      /* Don't keep sprime available.  */\n-\t\t      eliminate_push_avail (lhs);\n \t\t      sprime = NULL_TREE;\n \t\t    }\n \t\t}\n@@ -4433,10 +4432,11 @@ eliminate_dom_walker::before_dom_children (basic_block b)\n \t    VN_INFO (vdef)->valnum = vuse;\n \t}\n \n-      /* Make the new value available - for fully redundant LHS we\n-         continue with the next stmt above.  */\n-      if (lhs && TREE_CODE (lhs) == SSA_NAME)\n-\teliminate_push_avail (lhs);\n+      /* Make new values available - for fully redundant LHS we\n+         continue with the next stmt above and skip this.  */\n+      def_operand_p defp;\n+      FOR_EACH_SSA_DEF_OPERAND (defp, stmt, iter, SSA_OP_DEF)\n+\teliminate_push_avail (DEF_FROM_PTR (defp));\n     }\n \n   /* Replace destination PHI arguments.  */\n@@ -4521,7 +4521,11 @@ eliminate (bool do_pre)\n \n       gsi = gsi_for_stmt (stmt);\n       if (gimple_code (stmt) == GIMPLE_PHI)\n-\tremove_phi_node (&gsi, true);\n+\t{\n+\t  remove_phi_node (&gsi, true);\n+\t  /* Removing a PHI node in a block may expose a forwarder block.  */\n+\t  el_todo |= TODO_cleanup_cfg;\n+\t}\n       else\n \t{\n \t  basic_block bb = gimple_bb (stmt);"}]}