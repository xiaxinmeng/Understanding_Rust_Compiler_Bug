{"sha": "475b5d2a3b7e68b4b46eb1a43aa21316b8675b60", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6NDc1YjVkMmEzYjdlNjhiNGI0NmViMWE0M2FhMjEzMTZiODY3NWI2MA==", "commit": {"author": {"name": "Nicola Pero", "email": "nicola.pero@meta-innovation.com", "date": "2011-02-19T00:12:45Z"}, "committer": {"name": "Nicola Pero", "email": "nicola@gcc.gnu.org", "date": "2011-02-19T00:12:45Z"}, "message": "Do no emit GNU metadata if there is nothing to put into it\n\nFrom-SVN: r170292", "tree": {"sha": "070fd0f998fe2d7dacc6fe264489f4acf1f11b82", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/070fd0f998fe2d7dacc6fe264489f4acf1f11b82"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/475b5d2a3b7e68b4b46eb1a43aa21316b8675b60", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/475b5d2a3b7e68b4b46eb1a43aa21316b8675b60", "html_url": "https://github.com/Rust-GCC/gccrs/commit/475b5d2a3b7e68b4b46eb1a43aa21316b8675b60", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/475b5d2a3b7e68b4b46eb1a43aa21316b8675b60/comments", "author": {"login": "Nico-31415", "id": 94470564, "node_id": "U_kgDOBaGBpA", "avatar_url": "https://avatars.githubusercontent.com/u/94470564?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Nico-31415", "html_url": "https://github.com/Nico-31415", "followers_url": "https://api.github.com/users/Nico-31415/followers", "following_url": "https://api.github.com/users/Nico-31415/following{/other_user}", "gists_url": "https://api.github.com/users/Nico-31415/gists{/gist_id}", "starred_url": "https://api.github.com/users/Nico-31415/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Nico-31415/subscriptions", "organizations_url": "https://api.github.com/users/Nico-31415/orgs", "repos_url": "https://api.github.com/users/Nico-31415/repos", "events_url": "https://api.github.com/users/Nico-31415/events{/privacy}", "received_events_url": "https://api.github.com/users/Nico-31415/received_events", "type": "User", "site_admin": false}, "committer": null, "parents": [{"sha": "34c10b3bbde4bb401d78c8230bfce893e08f6dce", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/34c10b3bbde4bb401d78c8230bfce893e08f6dce", "html_url": "https://github.com/Rust-GCC/gccrs/commit/34c10b3bbde4bb401d78c8230bfce893e08f6dce"}], "stats": {"total": 27, "additions": 22, "deletions": 5}, "files": [{"sha": "81fff66fd4569cd8bebdd8fc6ad72b90871812be", "filename": "gcc/objc/ChangeLog", "status": "modified", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/475b5d2a3b7e68b4b46eb1a43aa21316b8675b60/gcc%2Fobjc%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/475b5d2a3b7e68b4b46eb1a43aa21316b8675b60/gcc%2Fobjc%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fobjc%2FChangeLog?ref=475b5d2a3b7e68b4b46eb1a43aa21316b8675b60", "patch": "@@ -1,3 +1,8 @@\n+2011-01-19  Nicola Pero  <nicola.pero@meta-innovation.com>\n+\n+\t* objc-gnu-runtime-abi-01.c (objc_generate_v1_gnu_metadata): Do\n+\tnot generate metadata if there is nothing to put into it.\n+\n 2011-02-17  Iain Sandoe  <iains@gcc.gnu.org>\n \n \t* config-lang.in (gtfiles): Updated."}, {"sha": "fdf04802321e72e6b174c9e16ea33aa5e3feca58", "filename": "gcc/objc/objc-gnu-runtime-abi-01.c", "status": "modified", "additions": 17, "deletions": 5, "changes": 22, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/475b5d2a3b7e68b4b46eb1a43aa21316b8675b60/gcc%2Fobjc%2Fobjc-gnu-runtime-abi-01.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/475b5d2a3b7e68b4b46eb1a43aa21316b8675b60/gcc%2Fobjc%2Fobjc-gnu-runtime-abi-01.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fobjc%2Fobjc-gnu-runtime-abi-01.c?ref=475b5d2a3b7e68b4b46eb1a43aa21316b8675b60", "patch": "@@ -2105,11 +2105,23 @@ objc_generate_v1_gnu_metadata (void)\n     generate_protocols ();\n \n   /* Arrange for ObjC data structures to be initialized at run time.  */\n-  generate_objc_symtab_decl ();\n-  /* Make sure that the meta-data are identified as being GNU-runtime.  */\n-  build_module_descriptor (OBJC_VERSION, \n-\t\t\t   build_tree_list (objc_meta, meta_base));\n-  build_module_initializer_routine ();\n+  /* FIXME: Have some more elegant way to determine if we need to\n+     generate objc_symtab_decl or not, instead of checking these\n+     global symbols.  */\n+  if (imp_list || class_names_chain\n+      || meth_var_names_chain || meth_var_types_chain || sel_ref_chain\n+      || prop_names_attr_chain)\n+    generate_objc_symtab_decl ();\n+\n+  if (imp_list || class_names_chain || objc_static_instances\n+      || meth_var_names_chain || meth_var_types_chain || sel_ref_chain)\n+    {\n+      /* Make sure that the meta-data are identified as being\n+\t GNU-runtime.  */\n+      build_module_descriptor (OBJC_VERSION, \n+\t\t\t       build_tree_list (objc_meta, meta_base));\n+      build_module_initializer_routine ();\n+    }\n \n   /* Dump the class references.  This forces the appropriate classes\n      to be linked into the executable image, preserving unix archive"}]}