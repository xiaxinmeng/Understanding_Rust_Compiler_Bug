{"sha": "de35aa66b07a62a1c27f4b104577848fa8f7ec17", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6ZGUzNWFhNjZiMDdhNjJhMWMyN2Y0YjEwNDU3Nzg0OGZhOGY3ZWMxNw==", "commit": {"author": {"name": "Mike Stump", "email": "mikestump@comcast.net", "date": "2015-01-08T18:56:11Z"}, "committer": {"name": "Mike Stump", "email": "mrs@gcc.gnu.org", "date": "2015-01-08T18:56:11Z"}, "message": "tsan.c (pass_tsan::gate): Add no_sanitize_thread support.\n\n\t* tsan.c (pass_tsan::gate): Add no_sanitize_thread support.\n\t  (pass_tsan_O0::gate): Likewise.\n\t* extend.texi (Function Attributes): Add no_sanitize_thread\n\t  documentation.\n\n\t* c-common.c (c_common_attribute_table): Add no_sanitize_thread.\n\nFrom-SVN: r219355", "tree": {"sha": "ddb97d86010300366e6418abfcc44345a87e4179", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/ddb97d86010300366e6418abfcc44345a87e4179"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/de35aa66b07a62a1c27f4b104577848fa8f7ec17", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/de35aa66b07a62a1c27f4b104577848fa8f7ec17", "html_url": "https://github.com/Rust-GCC/gccrs/commit/de35aa66b07a62a1c27f4b104577848fa8f7ec17", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/de35aa66b07a62a1c27f4b104577848fa8f7ec17/comments", "author": null, "committer": null, "parents": [{"sha": "de1184c0def2fe0bafc8dd4988f7b80df7a96147", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/de1184c0def2fe0bafc8dd4988f7b80df7a96147", "html_url": "https://github.com/Rust-GCC/gccrs/commit/de1184c0def2fe0bafc8dd4988f7b80df7a96147"}], "stats": {"total": 29, "additions": 27, "deletions": 2}, "files": [{"sha": "f9b3c559a959c5244bdc1283a6489b39feea96c7", "filename": "gcc/ChangeLog", "status": "modified", "additions": 7, "deletions": 0, "changes": 7, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/de35aa66b07a62a1c27f4b104577848fa8f7ec17/gcc%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/de35aa66b07a62a1c27f4b104577848fa8f7ec17/gcc%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2FChangeLog?ref=de35aa66b07a62a1c27f4b104577848fa8f7ec17", "patch": "@@ -1,3 +1,10 @@\n+2015-01-08  Mike Stump  <mikestump@comcast.net>\n+\n+\t* tsan.c (pass_tsan::gate): Add no_sanitize_thread support.\n+\t(pass_tsan_O0::gate): Likewise.\n+\t* extend.texi (Function Attributes): Add no_sanitize_thread\n+\tdocumentation.\n+\n 2015-01-08  Thomas Schwinge  <thomas@codesourcery.com>\n \n \t* builtins.def (DEF_GOMP_BUILTIN): Also consider flag_offload_abi"}, {"sha": "d6f09dcf0441ec8c3418497b7eab6462a95f6635", "filename": "gcc/c-family/ChangeLog", "status": "modified", "additions": 4, "deletions": 0, "changes": 4, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/de35aa66b07a62a1c27f4b104577848fa8f7ec17/gcc%2Fc-family%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/de35aa66b07a62a1c27f4b104577848fa8f7ec17/gcc%2Fc-family%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fc-family%2FChangeLog?ref=de35aa66b07a62a1c27f4b104577848fa8f7ec17", "patch": "@@ -1,3 +1,7 @@\n+2015-01-08  Mike Stump  <mikestump@comcast.net>\n+\n+\t* c-common.c (c_common_attribute_table): Add no_sanitize_thread.\n+\n 2015-01-07  Marek Polacek  <polacek@redhat.com>\n \n \tPR c/64440"}, {"sha": "713dca9fa9662bbe3b4b43111cd1eab95e51a2c9", "filename": "gcc/c-family/c-common.c", "status": "modified", "additions": 3, "deletions": 0, "changes": 3, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/de35aa66b07a62a1c27f4b104577848fa8f7ec17/gcc%2Fc-family%2Fc-common.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/de35aa66b07a62a1c27f4b104577848fa8f7ec17/gcc%2Fc-family%2Fc-common.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fc-family%2Fc-common.c?ref=de35aa66b07a62a1c27f4b104577848fa8f7ec17", "patch": "@@ -764,6 +764,9 @@ const struct attribute_spec c_common_attribute_table[] =\n   { \"no_sanitize_address\",    0, 0, true, false, false,\n \t\t\t      handle_no_sanitize_address_attribute,\n \t\t\t      false },\n+  { \"no_sanitize_thread\",     0, 0, true, false, false,\n+\t\t\t      handle_no_sanitize_address_attribute,\n+\t\t\t      false },\n   { \"no_sanitize_undefined\",  0, 0, true, false, false,\n \t\t\t      handle_no_sanitize_undefined_attribute,\n \t\t\t      false },"}, {"sha": "942a6bc8715ceddf577c9f25f40b5649e519cb2d", "filename": "gcc/doc/extend.texi", "status": "modified", "additions": 7, "deletions": 0, "changes": 7, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/de35aa66b07a62a1c27f4b104577848fa8f7ec17/gcc%2Fdoc%2Fextend.texi", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/de35aa66b07a62a1c27f4b104577848fa8f7ec17/gcc%2Fdoc%2Fextend.texi", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fdoc%2Fextend.texi?ref=de35aa66b07a62a1c27f4b104577848fa8f7ec17", "patch": "@@ -2205,6 +2205,7 @@ attributes are currently defined for functions on all targets:\n @code{returns_nonnull}, @code{gnu_inline},\n @code{externally_visible}, @code{hot}, @code{cold}, @code{artificial},\n @code{no_sanitize_address}, @code{no_address_safety_analysis},\n+@code{no_sanitize_thread},\n @code{no_sanitize_undefined}, @code{no_reorder}, @code{bnd_legacy},\n @code{bnd_instrument},\n @code{error} and @code{warning}.\n@@ -3721,6 +3722,12 @@ The @code{no_address_safety_analysis} is a deprecated alias of the\n @code{no_sanitize_address} attribute, new code should use\n @code{no_sanitize_address}.\n \n+@item no_sanitize_thread\n+@cindex @code{no_sanitize_thread} function attribute\n+The @code{no_sanitize_thread} attribute on functions is used\n+to inform the compiler that it should not instrument memory accesses\n+in the function when compiling with the @option{-fsanitize=thread} option.\n+\n @item no_sanitize_undefined\n @cindex @code{no_sanitize_undefined} function attribute\n The @code{no_sanitize_undefined} attribute on functions is used"}, {"sha": "2dfbab0c777b979a340d39eaa896d9fd6a8eda6f", "filename": "gcc/tsan.c", "status": "modified", "additions": 6, "deletions": 2, "changes": 8, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/de35aa66b07a62a1c27f4b104577848fa8f7ec17/gcc%2Ftsan.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/de35aa66b07a62a1c27f4b104577848fa8f7ec17/gcc%2Ftsan.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftsan.c?ref=de35aa66b07a62a1c27f4b104577848fa8f7ec17", "patch": "@@ -868,7 +868,9 @@ class pass_tsan : public gimple_opt_pass\n   opt_pass * clone () { return new pass_tsan (m_ctxt); }\n   virtual bool gate (function *)\n {\n-  return (flag_sanitize & SANITIZE_THREAD) != 0;\n+  return ((flag_sanitize & SANITIZE_THREAD) != 0\n+\t  && !lookup_attribute (\"no_sanitize_thread\",\n+                                DECL_ATTRIBUTES (current_function_decl)));\n }\n \n   virtual unsigned int execute (function *) { return tsan_pass (); }\n@@ -908,7 +910,9 @@ class pass_tsan_O0 : public gimple_opt_pass\n   /* opt_pass methods: */\n   virtual bool gate (function *)\n     {\n-      return (flag_sanitize & SANITIZE_THREAD) != 0 && !optimize;\n+      return ((flag_sanitize & SANITIZE_THREAD) != 0 && !optimize\n+\t      && !lookup_attribute (\"no_sanitize_thread\",\n+\t\t\t\t    DECL_ATTRIBUTES (current_function_decl)));\n     }\n \n   virtual unsigned int execute (function *) { return tsan_pass (); }"}]}