{"sha": "f2410266a00a3ebd6db07007aa82333b4f6ee6c2", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6ZjI0MTAyNjZhMDBhM2ViZDZkYjA3MDA3YWE4MjMzM2I0ZjZlZTZjMg==", "commit": {"author": {"name": "Jim Wilson", "email": "jimw@sifive.com", "date": "2018-05-09T21:17:14Z"}, "committer": {"name": "Jim Wilson", "email": "wilson@gcc.gnu.org", "date": "2018-05-09T21:17:14Z"}, "message": "RISC-V: Add with-multilib-list support.\n\n\tgcc/\n\tPR target/84797\n\t* config.gcc (riscv*-*-*): Handle --with-multilib-list.\n\t* config/riscv/t-withmultilib: New.\n\t* config/riscv/withmultilib.h: New.\n\t* doc/install.texi: Document RISC-V --with-multilib-list support.\n\nFrom-SVN: r260096", "tree": {"sha": "5ff29e8acb0cd9f7604784957394e2304cb62ec5", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/5ff29e8acb0cd9f7604784957394e2304cb62ec5"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/f2410266a00a3ebd6db07007aa82333b4f6ee6c2", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/f2410266a00a3ebd6db07007aa82333b4f6ee6c2", "html_url": "https://github.com/Rust-GCC/gccrs/commit/f2410266a00a3ebd6db07007aa82333b4f6ee6c2", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/f2410266a00a3ebd6db07007aa82333b4f6ee6c2/comments", "author": null, "committer": null, "parents": [{"sha": "6c882d0fdc2b2d4147419f12cad96bfa082622f0", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/6c882d0fdc2b2d4147419f12cad96bfa082622f0", "html_url": "https://github.com/Rust-GCC/gccrs/commit/6c882d0fdc2b2d4147419f12cad96bfa082622f0"}], "stats": {"total": 128, "additions": 126, "deletions": 2}, "files": [{"sha": "02d66d8b33eaba28630f0fe6f9ec05d637eaa384", "filename": "gcc/ChangeLog", "status": "modified", "additions": 8, "deletions": 0, "changes": 8, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/f2410266a00a3ebd6db07007aa82333b4f6ee6c2/gcc%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/f2410266a00a3ebd6db07007aa82333b4f6ee6c2/gcc%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2FChangeLog?ref=f2410266a00a3ebd6db07007aa82333b4f6ee6c2", "patch": "@@ -1,3 +1,11 @@\n+2018-05-09  Jim Wilson  <jimw@sifive.com>\n+\n+\tPR target/84797\n+\t* config.gcc (riscv*-*-*): Handle --with-multilib-list.\n+\t* config/riscv/t-withmultilib: New.\n+\t* config/riscv/withmultilib.h: New.\n+\t* doc/install.texi: Document RISC-V --with-multilib-list support.\n+\n 2018-05-09  Richard Biener  <rguenther@suse.de>\n \n \t* tree-vect-slp.c (vect_bb_slp_scalar_cost): Fill a cost"}, {"sha": "96bdd5c542779f84f131299922b985a8246299b5", "filename": "gcc/config.gcc", "status": "modified", "additions": 52, "deletions": 0, "changes": 52, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/f2410266a00a3ebd6db07007aa82333b4f6ee6c2/gcc%2Fconfig.gcc", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/f2410266a00a3ebd6db07007aa82333b4f6ee6c2/gcc%2Fconfig.gcc", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fconfig.gcc?ref=f2410266a00a3ebd6db07007aa82333b4f6ee6c2", "patch": "@@ -4121,6 +4121,58 @@ case \"${target}\" in\n \t\t\texit 1\n \t\t\t;;\n \t\tesac\n+\n+\t\t# Handle --with-multilib-list.\n+\t\tif test \"x${with_multilib_list}\" != xdefault; then\n+\t\t\ttm_file=\"${tm_file} riscv/withmultilib.h\"\n+\t\t\ttmake_file=\"${tmake_file} riscv/t-withmultilib\"\n+\n+\t\t\tcase ${with_multilib_list} in\n+\t\t\tilp32 | ilp32f | ilp32d \\\n+\t\t\t| lp64 | lp64f | lp64d )\n+\t\t\t\tTM_MULTILIB_CONFIG=\"${with_arch},${with_multilib_list}\"\n+\t\t\t\t;;\n+\t\t\t*)\n+\t\t\t\techo \"--with-multilib-list=${with_multilib_list} not supported.\"\n+\t\t\t\texit 1\n+\t\t\tesac\n+\n+\t\t\t# Define macros to select the default multilib.\n+\t\t\tcase ${with_arch} in\n+\t\t\trv32gc)\n+\t\t\t\ttm_defines=\"${tm_defines} TARGET_MLIB_ARCH=1\"\n+\t\t\t\t;;\n+\t\t\trv64gc)\n+\t\t\t\ttm_defines=\"${tm_defines} TARGET_MLIB_ARCH=2\"\n+\t\t\t\t;;\n+\t\t\t*)\n+\t\t\t\techo \"unsupported --with-arch for --with-multilib-list\"\n+\t\t\t\texit 1\n+\t\t\tesac\n+\t\t\tcase ${with_abi} in\n+\t\t\tilp32)\n+\t\t\t\ttm_defines=\"${tm_defines} TARGET_MLIB_ABI=1\"\n+\t\t\t\t;;\n+\t\t\tilp32f)\n+\t\t\t\ttm_defines=\"${tm_defines} TARGET_MLIB_ABI=2\"\n+\t\t\t\t;;\n+\t\t\tilp32d)\n+\t\t\t\ttm_defines=\"${tm_defines} TARGET_MLIB_ABI=3\"\n+\t\t\t\t;;\n+\t\t\tlp64)\n+\t\t\t\ttm_defines=\"${tm_defines} TARGET_MLIB_ABI=4\"\n+\t\t\t\t;;\n+\t\t\tlp64f)\n+\t\t\t\ttm_defines=\"${tm_defines} TARGET_MLIB_ABI=5\"\n+\t\t\t\t;;\n+\t\t\tlp64d)\n+\t\t\t\ttm_defines=\"${tm_defines} TARGET_MLIB_ABI=6\"\n+\t\t\t\t;;\n+\t\t\t*)\n+\t\t\t\techo \"unsupported --with-abi for --with-multilib\"\n+\t\t\t\texit 1\n+\t\t\tesac\n+\t\tfi\n \t\t;;\n \n \tmips*-*-*)"}, {"sha": "bcd0845b4482ea36633bc9d48ab04d3ef639c218", "filename": "gcc/config/riscv/t-withmultilib", "status": "added", "additions": 6, "deletions": 0, "changes": 6, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/f2410266a00a3ebd6db07007aa82333b4f6ee6c2/gcc%2Fconfig%2Friscv%2Ft-withmultilib", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/f2410266a00a3ebd6db07007aa82333b4f6ee6c2/gcc%2Fconfig%2Friscv%2Ft-withmultilib", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fconfig%2Friscv%2Ft-withmultilib?ref=f2410266a00a3ebd6db07007aa82333b4f6ee6c2", "patch": "@@ -0,0 +1,6 @@\n+comma=,\n+MULTILIB_OPTIONS = $(subst lp64,mabi=lp64,$(subst ilp32,mabi=ilp32,$(subst rv,march=rv,$(subst $(comma), ,$(TM_MULTILIB_CONFIG)))))\n+MULTILIB_DIRNAMES = $(patsubst rv32%,lib32,$(patsubst rv64%,lib64,$(subst $(comma), ,$(TM_MULTILIB_CONFIG))))\n+MULTILIB_OSDIRNAMES = $(subst lib,../lib,$(MULTILIB_DIRNAMES))\n+MULTILIB_REQUIRED   = $(subst lp64,mabi=lp64,$(subst ilp32,mabi=ilp32,$(subst rv,march=rv,$(subst $(comma),/,$(TM_MULTILIB_CONFIG)))))\n+MULTILIB_REUSE ="}, {"sha": "d703147fa646295ac25403b35adbca23800ef121", "filename": "gcc/config/riscv/withmultilib.h", "status": "added", "additions": 51, "deletions": 0, "changes": 51, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/f2410266a00a3ebd6db07007aa82333b4f6ee6c2/gcc%2Fconfig%2Friscv%2Fwithmultilib.h", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/f2410266a00a3ebd6db07007aa82333b4f6ee6c2/gcc%2Fconfig%2Friscv%2Fwithmultilib.h", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fconfig%2Friscv%2Fwithmultilib.h?ref=f2410266a00a3ebd6db07007aa82333b4f6ee6c2", "patch": "@@ -0,0 +1,51 @@\n+/* MULTILIB_DEFAULTS definitions for --with-multilib-list.\n+   Copyright (C) 2018 Free Software Foundation, Inc.\n+\n+   This file is part of GCC.\n+\n+   GCC is free software; you can redistribute it and/or modify it\n+   under the terms of the GNU General Public License as published\n+   by the Free Software Foundation; either version 3, or (at your\n+   option) any later version.\n+\n+   GCC is distributed in the hope that it will be useful, but WITHOUT\n+   ANY WARRANTY; without even the implied warranty of MERCHANTABILITY\n+   or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public\n+   License for more details.\n+\n+   Under Section 7 of GPL version 3, you are granted additional\n+   permissions described in the GCC Runtime Library Exception, version\n+   3.1, as published by the Free Software Foundation.\n+\n+   You should have received a copy of the GNU General Public License and\n+   a copy of the GCC Runtime Library Exception along with this program;\n+   see the files COPYING3 and COPYING.RUNTIME respectively.  If not, see\n+   <http://www.gnu.org/licenses/>.  */\n+\n+#if TARGET_MLIB_ARCH == 1\n+\n+# if TARGET_MLIB_ABI == 1\n+#  define MULTILIB_DEFAULTS {\"march=rv32gc\", \"mabi=ilp32\" }\n+# elif TARGET_MLIB_ABI == 2\n+#  define MULTILIB_DEFAULTS {\"march=rv32gc\", \"mabi=ilp32f\" }\n+# elif TARGET_MLIB_ABI == 3\n+#  define MULTILIB_DEFAULTS {\"march=rv32gc\", \"mabi=ilp32d\" }\n+# else\n+#  error \"unsupported TARGET_MLIB_ABI value for rv32gc\"\n+# endif\n+\n+#elif TARGET_MLIB_ARCH == 2\n+\n+# if TARGET_MLIB_ABI == 4\n+#  define MULTILIB_DEFAULTS {\"march=rv64gc\", \"mabi=lp64\" }\n+# elif TARGET_MLIB_ABI == 5\n+#  define MULTILIB_DEFAULTS {\"march=rv64gc\", \"mabi=lp64f\" }\n+# elif TARGET_MLIB_ABI == 6\n+#  define MULTILIB_DEFAULTS {\"march=rv64gc\", \"mabi=lp64d\" }\n+# else\n+#  error \"unsupported TARGET_MLIB_ABI value for rv64gc\"\n+# endif\n+\n+#else\n+# error \"unsupported TARGET_MLIB_ARCH value\"\n+#endif"}, {"sha": "7c5cdc762d3ecca2b37c1ebc8caf99d22ff351b9", "filename": "gcc/doc/install.texi", "status": "modified", "additions": 9, "deletions": 2, "changes": 11, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/f2410266a00a3ebd6db07007aa82333b4f6ee6c2/gcc%2Fdoc%2Finstall.texi", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/f2410266a00a3ebd6db07007aa82333b4f6ee6c2/gcc%2Fdoc%2Finstall.texi", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fdoc%2Finstall.texi?ref=f2410266a00a3ebd6db07007aa82333b4f6ee6c2", "patch": "@@ -1072,8 +1072,8 @@ sysv, aix.\n @itemx --without-multilib-list\n Specify what multilibs to build.  @var{list} is a comma separated list of\n values, possibly consisting of a single value.  Currently only implemented\n-for arm*-*-*, sh*-*-* and x86-64-*-linux*.  The accepted values and meaning\n-for each target is given below.\n+for arm*-*-*, riscv*-*-*, sh*-*-* and x86-64-*-linux*.  The accepted\n+values and meaning for each target is given below.\n \n @table @code\n @item arm*-*-*\n@@ -1128,6 +1128,13 @@ and @code{rmprofile}.\n @code{-mfloat-abi=hard}\n @end multitable\n \n+@item riscv*-*-*\n+@var{list} is a single ABI name.  The target architecture must be either\n+@code{rv32gc} or @code{rv64gc}.  This will build a single multilib for the\n+specified architecture and ABI pair.  If @code{--with-multilib-list} is not\n+given, then a default set of multilibs is selected based on the value of\n+@option{--target}.  This is usually a large set of multilibs.\n+\n @item sh*-*-*\n @var{list} is a comma separated list of CPU names.  These must be of the\n form @code{sh*} or @code{m*} (in which case they match the compiler option"}]}