{"sha": "80f414e6d73f9f1683f93d83ce63a6a482e54bee", "node_id": "C_kwDOANBUbNoAKDgwZjQxNGU2ZDczZjlmMTY4M2Y5M2Q4M2NlNjNhNmE0ODJlNTRiZWU", "commit": {"author": {"name": "Eugene Rozenfeld", "email": "erozen@microsoft.com", "date": "2022-10-10T21:10:31Z"}, "committer": {"name": "Eugene Rozenfeld", "email": "erozen@microsoft.com", "date": "2022-10-11T06:34:51Z"}, "message": "Fix PR107193.\n\nThe bug was introduced in f30e9fd33e56a5a721346ea6140722e1b193db42.\nA variable (cur_locus_e) was incorrectly declared inside a loop.\nI also moved two other declarations (last and locus) down to make\nthe code more clear.\n\nTested on x86_64-pc-linux-gnu.\n\ngcc/ChangeLog:\n\tPR debug/107193\n\t* tree-cfg.cc (assign_discriminators): Move declaration of cur_locus_e\n\tout of the loop.", "tree": {"sha": "cad454f885dfabd5a26ac729ccce7cd643a0cbc1", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/cad454f885dfabd5a26ac729ccce7cd643a0cbc1"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/80f414e6d73f9f1683f93d83ce63a6a482e54bee", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/80f414e6d73f9f1683f93d83ce63a6a482e54bee", "html_url": "https://github.com/Rust-GCC/gccrs/commit/80f414e6d73f9f1683f93d83ce63a6a482e54bee", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/80f414e6d73f9f1683f93d83ce63a6a482e54bee/comments", "author": {"login": "erozenfeld", "id": 10624223, "node_id": "MDQ6VXNlcjEwNjI0MjIz", "avatar_url": "https://avatars.githubusercontent.com/u/10624223?v=4", "gravatar_id": "", "url": "https://api.github.com/users/erozenfeld", "html_url": "https://github.com/erozenfeld", "followers_url": "https://api.github.com/users/erozenfeld/followers", "following_url": "https://api.github.com/users/erozenfeld/following{/other_user}", "gists_url": "https://api.github.com/users/erozenfeld/gists{/gist_id}", "starred_url": "https://api.github.com/users/erozenfeld/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/erozenfeld/subscriptions", "organizations_url": "https://api.github.com/users/erozenfeld/orgs", "repos_url": "https://api.github.com/users/erozenfeld/repos", "events_url": "https://api.github.com/users/erozenfeld/events{/privacy}", "received_events_url": "https://api.github.com/users/erozenfeld/received_events", "type": "User", "site_admin": false}, "committer": {"login": "erozenfeld", "id": 10624223, "node_id": "MDQ6VXNlcjEwNjI0MjIz", "avatar_url": "https://avatars.githubusercontent.com/u/10624223?v=4", "gravatar_id": "", "url": "https://api.github.com/users/erozenfeld", "html_url": "https://github.com/erozenfeld", "followers_url": "https://api.github.com/users/erozenfeld/followers", "following_url": "https://api.github.com/users/erozenfeld/following{/other_user}", "gists_url": "https://api.github.com/users/erozenfeld/gists{/gist_id}", "starred_url": "https://api.github.com/users/erozenfeld/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/erozenfeld/subscriptions", "organizations_url": "https://api.github.com/users/erozenfeld/orgs", "repos_url": "https://api.github.com/users/erozenfeld/repos", "events_url": "https://api.github.com/users/erozenfeld/events{/privacy}", "received_events_url": "https://api.github.com/users/erozenfeld/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "b88adba751da635c6f0c353c5bc51bbe2ecf4c89", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/b88adba751da635c6f0c353c5bc51bbe2ecf4c89", "html_url": "https://github.com/Rust-GCC/gccrs/commit/b88adba751da635c6f0c353c5bc51bbe2ecf4c89"}], "stats": {"total": 7, "additions": 4, "deletions": 3}, "files": [{"sha": "ae781871a19dcd3e43364562712aa4aac6ab6392", "filename": "gcc/tree-cfg.cc", "status": "modified", "additions": 4, "deletions": 3, "changes": 7, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/80f414e6d73f9f1683f93d83ce63a6a482e54bee/gcc%2Ftree-cfg.cc", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/80f414e6d73f9f1683f93d83ce63a6a482e54bee/gcc%2Ftree-cfg.cc", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftree-cfg.cc?ref=80f414e6d73f9f1683f93d83ce63a6a482e54bee", "patch": "@@ -1204,9 +1204,8 @@ assign_discriminators (void)\n       edge e;\n       edge_iterator ei;\n       gimple_stmt_iterator gsi;\n-      gimple *last = last_stmt (bb);\n-      location_t locus = last ? gimple_location (last) : UNKNOWN_LOCATION;\n       location_t curr_locus = UNKNOWN_LOCATION;\n+      expanded_location curr_locus_e = {};\n       int curr_discr = 0;\n \n       /* Traverse the basic block, if two function calls within a basic block\n@@ -1215,7 +1214,7 @@ assign_discriminators (void)\n       for (gsi = gsi_start_bb (bb); !gsi_end_p (gsi); gsi_next (&gsi))\n \t{\n \t  gimple *stmt = gsi_stmt (gsi);\n-\t  expanded_location curr_locus_e;\n+\n \t  if (curr_locus == UNKNOWN_LOCATION)\n \t    {\n \t      curr_locus = gimple_location (stmt);\n@@ -1238,6 +1237,8 @@ assign_discriminators (void)\n \t    curr_discr = next_discriminator_for_locus (curr_locus);\n \t}\n \n+      gimple *last = last_stmt (bb);\n+      location_t locus = last ? gimple_location (last) : UNKNOWN_LOCATION;\n       if (locus == UNKNOWN_LOCATION)\n \tcontinue;\n "}]}