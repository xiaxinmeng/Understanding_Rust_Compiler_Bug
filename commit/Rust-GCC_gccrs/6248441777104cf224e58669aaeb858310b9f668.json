{"sha": "6248441777104cf224e58669aaeb858310b9f668", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6NjI0ODQ0MTc3NzEwNGNmMjI0ZTU4NjY5YWFlYjg1ODMxMGI5ZjY2OA==", "commit": {"author": {"name": "Jan Hubicka", "email": "hubicka@ucw.cz", "date": "2015-02-09T21:06:35Z"}, "committer": {"name": "Jan Hubicka", "email": "hubicka@gcc.gnu.org", "date": "2015-02-09T21:06:35Z"}, "message": "re PR ipa/61548 (FAIL: gcc.dg/tls/alias-1.c)\n\n\tPR ipa/61548\n\t* tree-emutls.c (ipa_lower_emutls): Avoid duplicates in TLS_VARS.\n\nFrom-SVN: r220549", "tree": {"sha": "0e603acc6dfe85375a6f585b86a993cc49626d12", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/0e603acc6dfe85375a6f585b86a993cc49626d12"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/6248441777104cf224e58669aaeb858310b9f668", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/6248441777104cf224e58669aaeb858310b9f668", "html_url": "https://github.com/Rust-GCC/gccrs/commit/6248441777104cf224e58669aaeb858310b9f668", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/6248441777104cf224e58669aaeb858310b9f668/comments", "author": null, "committer": null, "parents": [{"sha": "106b54666459294e68b176e2f2e811e488158880", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/106b54666459294e68b176e2f2e811e488158880", "html_url": "https://github.com/Rust-GCC/gccrs/commit/106b54666459294e68b176e2f2e811e488158880"}], "stats": {"total": 13, "additions": 10, "deletions": 3}, "files": [{"sha": "2791de6c4f86919ec512e12431b5c7b5c8b64ebd", "filename": "gcc/ChangeLog", "status": "modified", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/6248441777104cf224e58669aaeb858310b9f668/gcc%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/6248441777104cf224e58669aaeb858310b9f668/gcc%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2FChangeLog?ref=6248441777104cf224e58669aaeb858310b9f668", "patch": "@@ -1,3 +1,8 @@\n+2015-02-08  Jan Hubicka  <hubicka@ucw.cz>\n+\n+\tPR ipa/61548\n+\t* tree-emutls.c (ipa_lower_emutls): Avoid duplicates in TLS_VARS.\n+\n 2015-02-08  Jan Hubicka  <hubicka@ucw.cz>\n \n \tPR ipa/63566 "}, {"sha": "b4711a59c6b01bb300488698a150139508fe3196", "filename": "gcc/tree-emutls.c", "status": "modified", "additions": 5, "deletions": 3, "changes": 8, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/6248441777104cf224e58669aaeb858310b9f668/gcc%2Ftree-emutls.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/6248441777104cf224e58669aaeb858310b9f668/gcc%2Ftree-emutls.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftree-emutls.c?ref=6248441777104cf224e58669aaeb858310b9f668", "patch": "@@ -753,17 +753,19 @@ ipa_lower_emutls (void)\n   cgraph_node *func;\n   bool any_aliases = false;\n   tree ctor_body = NULL;\n-\n+  hash_set <varpool_node *> visited;\n   auto_vec <varpool_node *> tls_vars;\n \n   /* Examine all global variables for TLS variables.  */\n   FOR_EACH_VARIABLE (var)\n-    if (DECL_THREAD_LOCAL_P (var->decl))\n+    if (DECL_THREAD_LOCAL_P (var->decl)\n+\t&& !visited.add (var))\n       {\n \tgcc_checking_assert (TREE_STATIC (var->decl)\n \t\t\t     || DECL_EXTERNAL (var->decl));\n \ttls_vars.safe_push (var);\n-\tif (var->alias && var->definition)\n+\tif (var->alias && var->definition\n+\t    && !visited.add (var->ultimate_alias_target ()))\n \t  tls_vars.safe_push (var->ultimate_alias_target ());\n       }\n "}]}