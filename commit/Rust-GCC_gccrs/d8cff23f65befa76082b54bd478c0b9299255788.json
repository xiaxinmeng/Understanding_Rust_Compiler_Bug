{"sha": "d8cff23f65befa76082b54bd478c0b9299255788", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6ZDhjZmYyM2Y2NWJlZmE3NjA4MmI1NGJkNDc4YzBiOTI5OTI1NTc4OA==", "commit": {"author": {"name": "Marek Polacek", "email": "polacek@redhat.com", "date": "2018-03-01T17:08:35Z"}, "committer": {"name": "Marek Polacek", "email": "mpolacek@gcc.gnu.org", "date": "2018-03-01T17:08:35Z"}, "message": "re PR c++/84596 (internal compiler error: unexpected expression '(bool)c' of kind implicit_conv_expr (cxx_eval_constant_expression))\n\n\tPR c++/84596\n\t* constexpr.c (require_rvalue_constant_expression): New function.\n\t* cp-tree.h: Declare it.\n\t* semantics.c (finish_static_assert): Use it instead of\n\trequire_potential_rvalue_constant_expression.\n\n\t* g++.dg/cpp0x/static_assert14.C: New test.\n\nFrom-SVN: r258107", "tree": {"sha": "2282e0c590013134b8aab0590d2d4d9ef06c97b7", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/2282e0c590013134b8aab0590d2d4d9ef06c97b7"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/d8cff23f65befa76082b54bd478c0b9299255788", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/d8cff23f65befa76082b54bd478c0b9299255788", "html_url": "https://github.com/Rust-GCC/gccrs/commit/d8cff23f65befa76082b54bd478c0b9299255788", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/d8cff23f65befa76082b54bd478c0b9299255788/comments", "author": {"login": "mpolacek", "id": 10496300, "node_id": "MDQ6VXNlcjEwNDk2MzAw", "avatar_url": "https://avatars.githubusercontent.com/u/10496300?v=4", "gravatar_id": "", "url": "https://api.github.com/users/mpolacek", "html_url": "https://github.com/mpolacek", "followers_url": "https://api.github.com/users/mpolacek/followers", "following_url": "https://api.github.com/users/mpolacek/following{/other_user}", "gists_url": "https://api.github.com/users/mpolacek/gists{/gist_id}", "starred_url": "https://api.github.com/users/mpolacek/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/mpolacek/subscriptions", "organizations_url": "https://api.github.com/users/mpolacek/orgs", "repos_url": "https://api.github.com/users/mpolacek/repos", "events_url": "https://api.github.com/users/mpolacek/events{/privacy}", "received_events_url": "https://api.github.com/users/mpolacek/received_events", "type": "User", "site_admin": false}, "committer": null, "parents": [{"sha": "26a0cc94f32ed95616d1618857d35d2ef1506118", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/26a0cc94f32ed95616d1618857d35d2ef1506118", "html_url": "https://github.com/Rust-GCC/gccrs/commit/26a0cc94f32ed95616d1618857d35d2ef1506118"}], "stats": {"total": 38, "additions": 35, "deletions": 3}, "files": [{"sha": "acaabd0e19740612dc01c94594693f21088dac18", "filename": "gcc/cp/ChangeLog", "status": "modified", "additions": 8, "deletions": 0, "changes": 8, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/d8cff23f65befa76082b54bd478c0b9299255788/gcc%2Fcp%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/d8cff23f65befa76082b54bd478c0b9299255788/gcc%2Fcp%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fcp%2FChangeLog?ref=d8cff23f65befa76082b54bd478c0b9299255788", "patch": "@@ -1,3 +1,11 @@\n+2018-03-01  Marek Polacek  <polacek@redhat.com>\n+\n+\tPR c++/84596\n+\t* constexpr.c (require_rvalue_constant_expression): New function.\n+\t* cp-tree.h: Declare it.\n+\t* semantics.c (finish_static_assert): Use it instead of\n+\trequire_potential_rvalue_constant_expression.\n+\n 2018-03-01  Jason Merrill  <jason@redhat.com>\n \t    Alexandre Oliva <aoliva@redhat.com>\n "}, {"sha": "39e6cdfb33d2c3432a2d4bd22d73863bed8d3e1a", "filename": "gcc/cp/constexpr.c", "status": "modified", "additions": 13, "deletions": 2, "changes": 15, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/d8cff23f65befa76082b54bd478c0b9299255788/gcc%2Fcp%2Fconstexpr.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/d8cff23f65befa76082b54bd478c0b9299255788/gcc%2Fcp%2Fconstexpr.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fcp%2Fconstexpr.c?ref=d8cff23f65befa76082b54bd478c0b9299255788", "patch": "@@ -6047,15 +6047,26 @@ potential_rvalue_constant_expression (tree t)\n bool\n require_potential_constant_expression (tree t)\n {\n-  return potential_constant_expression_1 (t, false, true, false, tf_warning_or_error);\n+  return potential_constant_expression_1 (t, false, true, false,\n+\t\t\t\t\t  tf_warning_or_error);\n }\n \n /* Cross product of the above.  */\n \n bool\n require_potential_rvalue_constant_expression (tree t)\n {\n-  return potential_constant_expression_1 (t, true, true, false, tf_warning_or_error);\n+  return potential_constant_expression_1 (t, true, true, false,\n+\t\t\t\t\t  tf_warning_or_error);\n+}\n+\n+/* Like above, but don't consider PARM_DECL a potential_constant_expression.  */\n+\n+bool\n+require_rvalue_constant_expression (tree t)\n+{\n+  return potential_constant_expression_1 (t, true, true, true,\n+\t\t\t\t\t  tf_warning_or_error);\n }\n \n /* Like potential_constant_expression, but don't consider possible constexpr"}, {"sha": "17d8c6d2650a18c7fa4e98a0df105507f3461c9a", "filename": "gcc/cp/cp-tree.h", "status": "modified", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/d8cff23f65befa76082b54bd478c0b9299255788/gcc%2Fcp%2Fcp-tree.h", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/d8cff23f65befa76082b54bd478c0b9299255788/gcc%2Fcp%2Fcp-tree.h", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fcp%2Fcp-tree.h?ref=d8cff23f65befa76082b54bd478c0b9299255788", "patch": "@@ -7409,6 +7409,7 @@ extern bool is_static_init_expression    (tree);\n extern bool potential_rvalue_constant_expression (tree);\n extern bool require_potential_constant_expression (tree);\n extern bool require_constant_expression (tree);\n+extern bool require_rvalue_constant_expression (tree);\n extern bool require_potential_rvalue_constant_expression (tree);\n extern tree cxx_constant_value\t\t\t(tree, tree = NULL_TREE);\n extern tree cxx_constant_init\t\t\t(tree, tree = NULL_TREE);"}, {"sha": "87c5c669a55a71db93488c9a3baaeab6b89e22f0", "filename": "gcc/cp/semantics.c", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/d8cff23f65befa76082b54bd478c0b9299255788/gcc%2Fcp%2Fsemantics.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/d8cff23f65befa76082b54bd478c0b9299255788/gcc%2Fcp%2Fsemantics.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fcp%2Fsemantics.c?ref=d8cff23f65befa76082b54bd478c0b9299255788", "patch": "@@ -8671,7 +8671,7 @@ finish_static_assert (tree condition, tree message, location_t location,\n       else if (condition && condition != error_mark_node)\n \t{\n \t  error (\"non-constant condition for static assertion\");\n-\t  if (require_potential_rvalue_constant_expression (condition))\n+\t  if (require_rvalue_constant_expression (condition))\n \t    cxx_constant_value (condition);\n \t}\n       input_location = saved_loc;"}, {"sha": "bcb40bad7933cfa4f63f102c0466e97f58e59fab", "filename": "gcc/testsuite/ChangeLog", "status": "modified", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/d8cff23f65befa76082b54bd478c0b9299255788/gcc%2Ftestsuite%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/d8cff23f65befa76082b54bd478c0b9299255788/gcc%2Ftestsuite%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2FChangeLog?ref=d8cff23f65befa76082b54bd478c0b9299255788", "patch": "@@ -1,3 +1,8 @@\n+2018-03-01  Marek Polacek  <polacek@redhat.com>\n+\n+\tPR c++/84596\n+\t* g++.dg/cpp0x/static_assert14.C: New test.\n+\n 2018-03-01  Paolo Carlini  <paolo.carlini@oracle.com>\n \n \tPR c++/79410"}, {"sha": "ee709f4200fe1cd761db5c6a11ae5c6ee2430068", "filename": "gcc/testsuite/g++.dg/cpp0x/static_assert14.C", "status": "added", "additions": 7, "deletions": 0, "changes": 7, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/d8cff23f65befa76082b54bd478c0b9299255788/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Fcpp0x%2Fstatic_assert14.C", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/d8cff23f65befa76082b54bd478c0b9299255788/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Fcpp0x%2Fstatic_assert14.C", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Fcpp0x%2Fstatic_assert14.C?ref=d8cff23f65befa76082b54bd478c0b9299255788", "patch": "@@ -0,0 +1,7 @@\n+// PR c++/84596\n+// { dg-do compile { target c++11 } }\n+\n+template<int x>\n+void b(int c) {\n+  static_assert (c, \"c\"); // { dg-error \"non-constant|not a constant\" }\n+}"}]}