{"sha": "4e65a47055ed1e7fb0068125bd95708ed86ab9af", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6NGU2NWE0NzA1NWVkMWU3ZmIwMDY4MTI1YmQ5NTcwOGVkODZhYjlhZg==", "commit": {"author": {"name": "Dodji Seketeli", "email": "dodji@redhat.com", "date": "2012-04-30T11:41:08Z"}, "committer": {"name": "Dodji Seketeli", "email": "dodji@gcc.gnu.org", "date": "2012-04-30T11:41:08Z"}, "message": "Fix cpp_sys_macro_p with -ftrack-macro-expansion\n\ncpp_sys_macro_p crashes when -ftrack-macro-expansion is on.  The issue\ncan be reproduced by running the tests:\n\n    runtest --tool gcc --tool_opts=\"-ftrack-macro-expansion\" cpp.exp=sysmac1.c\n    runtest --tool gcc --tool_opts=\"-ftrack-macro-expansion\" cpp.exp=sysmac2.c\n\nThis is because it just doesn't support that mode.  Fixed thus.\nTested and bootstrapped on x86_64-unknown-linux-gnu against trunk.\n\nNote that the bootstrap with -ftrack-macro-expansion turned on\nexhibits other separate issues that are addressed in subsequent\npatches.  This patch just fixes one class of problems.\n\nThe patch does pass bootstrap with -ftrack-macro-expansion turned off,\nthough.\n\nlibcpp/\n\n\t* macro.c (cpp_sys_macro_p):  Support -ftrack-macro-expansion.\n\nFrom-SVN: r186965", "tree": {"sha": "cb06d4cddefb62836bf30b0c556b2a4a8ff20057", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/cb06d4cddefb62836bf30b0c556b2a4a8ff20057"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/4e65a47055ed1e7fb0068125bd95708ed86ab9af", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/4e65a47055ed1e7fb0068125bd95708ed86ab9af", "html_url": "https://github.com/Rust-GCC/gccrs/commit/4e65a47055ed1e7fb0068125bd95708ed86ab9af", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/4e65a47055ed1e7fb0068125bd95708ed86ab9af/comments", "author": null, "committer": null, "parents": [{"sha": "b38086f06abab6f679bc6e63d833b8d853a5e04f", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/b38086f06abab6f679bc6e63d833b8d853a5e04f", "html_url": "https://github.com/Rust-GCC/gccrs/commit/b38086f06abab6f679bc6e63d833b8d853a5e04f"}], "stats": {"total": 12, "additions": 11, "deletions": 1}, "files": [{"sha": "c4f7c5af01a69eaaf344fccf9b79d78a27e272fa", "filename": "libcpp/ChangeLog", "status": "modified", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/4e65a47055ed1e7fb0068125bd95708ed86ab9af/libcpp%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/4e65a47055ed1e7fb0068125bd95708ed86ab9af/libcpp%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libcpp%2FChangeLog?ref=4e65a47055ed1e7fb0068125bd95708ed86ab9af", "patch": "@@ -1,3 +1,8 @@\n+2012-04-30  Dodji Seketeli  <dodji@redhat.com>\n+\n+\tFix cpp_sys_macro_p with -ftrack-macro-expansion\n+\t* macro.c (cpp_sys_macro_p):  Support -ftrack-macro-expansion.\n+\n 2012-04-29  Dodji Seketeli  <dodji@redhat.com>\n \n \t* lex.c (lex_raw_string): Change C++ style comments into C style"}, {"sha": "4f8e52f22cfbb12856acf25c78b749b5f909fe9c", "filename": "libcpp/macro.c", "status": "modified", "additions": 6, "deletions": 1, "changes": 7, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/4e65a47055ed1e7fb0068125bd95708ed86ab9af/libcpp%2Fmacro.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/4e65a47055ed1e7fb0068125bd95708ed86ab9af/libcpp%2Fmacro.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libcpp%2Fmacro.c?ref=4e65a47055ed1e7fb0068125bd95708ed86ab9af", "patch": "@@ -2436,7 +2436,12 @@ cpp_get_token_with_location (cpp_reader *pfile, source_location *loc)\n int\n cpp_sys_macro_p (cpp_reader *pfile)\n {\n-  cpp_hashnode *node = pfile->context->c.macro;\n+  cpp_hashnode *node = NULL;\n+\n+  if (pfile->context->tokens_kind == TOKENS_KIND_EXTENDED)\n+    node = pfile->context->c.mc->macro_node;\n+  else\n+    node = pfile->context->c.macro;\n \n   return node && node->value.macro && node->value.macro->syshdr;\n }"}]}