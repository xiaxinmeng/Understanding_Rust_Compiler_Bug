{"sha": "17a8a7aa55e5846ee14132dfd4773d183c6a3f42", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6MTdhOGE3YWE1NWU1ODQ2ZWUxNDEzMmRmZDQ3NzNkMTgzYzZhM2Y0Mg==", "commit": {"author": {"name": "Maxim Kuvyrkov", "email": "maxim.kuvyrkov@linaro.org", "date": "2014-10-19T21:07:29Z"}, "committer": {"name": "Maxim Kuvyrkov", "email": "mkuvyrkov@gcc.gnu.org", "date": "2014-10-19T21:07:29Z"}, "message": "Fix race in libstdc++ testsuite\n\n\t* testsuite/lib/libstdc++.exp (v3-copy-file): New proc split from ...\n\t(v3-copy-files): ... this.  Update.\n\t(check_v3_target_fileio): Fix race on cin_unget-1.txt file.\n\nFrom-SVN: r216444", "tree": {"sha": "771e4818348b069acfda14a8d50dac0039c0fcf0", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/771e4818348b069acfda14a8d50dac0039c0fcf0"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/17a8a7aa55e5846ee14132dfd4773d183c6a3f42", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/17a8a7aa55e5846ee14132dfd4773d183c6a3f42", "html_url": "https://github.com/Rust-GCC/gccrs/commit/17a8a7aa55e5846ee14132dfd4773d183c6a3f42", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/17a8a7aa55e5846ee14132dfd4773d183c6a3f42/comments", "author": {"login": "maxim-kuvyrkov", "id": 12545699, "node_id": "MDQ6VXNlcjEyNTQ1Njk5", "avatar_url": "https://avatars.githubusercontent.com/u/12545699?v=4", "gravatar_id": "", "url": "https://api.github.com/users/maxim-kuvyrkov", "html_url": "https://github.com/maxim-kuvyrkov", "followers_url": "https://api.github.com/users/maxim-kuvyrkov/followers", "following_url": "https://api.github.com/users/maxim-kuvyrkov/following{/other_user}", "gists_url": "https://api.github.com/users/maxim-kuvyrkov/gists{/gist_id}", "starred_url": "https://api.github.com/users/maxim-kuvyrkov/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/maxim-kuvyrkov/subscriptions", "organizations_url": "https://api.github.com/users/maxim-kuvyrkov/orgs", "repos_url": "https://api.github.com/users/maxim-kuvyrkov/repos", "events_url": "https://api.github.com/users/maxim-kuvyrkov/events{/privacy}", "received_events_url": "https://api.github.com/users/maxim-kuvyrkov/received_events", "type": "User", "site_admin": false}, "committer": null, "parents": [{"sha": "565fad70aa35e354b628c5f94639e543a631e8e8", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/565fad70aa35e354b628c5f94639e543a631e8e8", "html_url": "https://github.com/Rust-GCC/gccrs/commit/565fad70aa35e354b628c5f94639e543a631e8e8"}], "stats": {"total": 35, "additions": 23, "deletions": 12}, "files": [{"sha": "fcaaea010cef4c3f0506b23b9e08c41ed09c7d04", "filename": "libstdc++-v3/ChangeLog", "status": "modified", "additions": 6, "deletions": 0, "changes": 6, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/17a8a7aa55e5846ee14132dfd4773d183c6a3f42/libstdc%2B%2B-v3%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/17a8a7aa55e5846ee14132dfd4773d183c6a3f42/libstdc%2B%2B-v3%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libstdc%2B%2B-v3%2FChangeLog?ref=17a8a7aa55e5846ee14132dfd4773d183c6a3f42", "patch": "@@ -1,3 +1,9 @@\n+2014-10-19  Maxim Kuvyrkov  <maxim.kuvyrkov@linaro.org>\n+\n+\t* testsuite/lib/libstdc++.exp (v3-copy-file): New proc split from ...\n+\t(v3-copy-files): ... this.  Update.\n+\t(check_v3_target_fileio): Fix race on cin_unget-1.txt file.\n+\n 2014-10-17  Jonathan Wakely  <jwakely@redhat.com>\n \n \t* testsuite/27_io/basic_ostream/inserters_arithmetic/char/hexfloat.cc:"}, {"sha": "3d9913b1a053aac84230c01051070e40dcf3cc6c", "filename": "libstdc++-v3/testsuite/lib/libstdc++.exp", "status": "modified", "additions": 17, "deletions": 12, "changes": 29, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/17a8a7aa55e5846ee14132dfd4773d183c6a3f42/libstdc%2B%2B-v3%2Ftestsuite%2Flib%2Flibstdc%2B%2B.exp", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/17a8a7aa55e5846ee14132dfd4773d183c6a3f42/libstdc%2B%2B-v3%2Ftestsuite%2Flib%2Flibstdc%2B%2B.exp", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libstdc%2B%2B-v3%2Ftestsuite%2Flib%2Flibstdc%2B%2B.exp?ref=17a8a7aa55e5846ee14132dfd4773d183c6a3f42", "patch": "@@ -65,19 +65,24 @@ proc v3track { var n } {\n     verbose \"++ $var is $val\" $n\n }\n \n+# Copy file to the target.\n+proc v3-copy-file {src dst} {\n+    if { [catch { set symlink [file readlink $src] } x] } then {\n+\tremote_download target $src $dst\n+    } else {\n+\tif { [regexp \"^/\" \"$symlink\"] } then {\n+\t    remote_download target $symlink $dst\n+\t} else {\n+\t    set dirname [file dirname $f]\n+\t    remote_download target $dirname/$symlink $dst\n+\t}\n+    }\n+}\n+\n # Called by v3-init below.  \"Static\" to this file.\n proc v3-copy-files {srcfiles} {\n     foreach f $srcfiles {\n-        if { [catch { set symlink [file readlink $f] } x] } then {\n-\t    remote_download target $f\n-        } else {\n-            if { [regexp \"^/\" \"$symlink\"] } then {\n-\t\tremote_download target $symlink\n-            } else {\n-                set dirname [file dirname $f]\n-\t\tremote_download target $dirname/$symlink\n-            }\n-        }\n+\tv3-copy-file $f [file tail $f]\n     }\n }\n \n@@ -690,8 +695,8 @@ proc check_v3_target_fileio { } {\n \t# the file functions\n \tset src fileio[pid].cc\n \tset exe fileio[pid].x\n-\tset testfile \"cin_unget-1.txt\"\n-\tv3-copy-files \"$srcdir/data/$testfile\"\n+\tset testfile \"cin_unget-1.[pid].txt\"\n+\tv3-copy-file \"$srcdir/data/cin_unget-1.txt\" \"$testfile\"\n \n \tset f [open $src \"w\"]\n \tputs $f \"#include <sys/types.h>\""}]}