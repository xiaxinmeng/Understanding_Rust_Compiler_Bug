{"sha": "68fbd81bf093b2c14f94666153ca6428ac237880", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6NjhmYmQ4MWJmMDkzYjJjMTRmOTQ2NjYxNTNjYTY0MjhhYzIzNzg4MA==", "commit": {"author": {"name": "Steven Bosscher", "email": "steven@gcc.gnu.org", "date": "2012-12-05T09:34:06Z"}, "committer": {"name": "Steven Bosscher", "email": "steven@gcc.gnu.org", "date": "2012-12-05T09:34:06Z"}, "message": "passes.c (pass_init_dump_file): Only open a clean graph dump file if the dump was not already initialized.\n\n\t* passes.c (pass_init_dump_file): Only open a clean graph dump file if\n\tthe dump was not already initialized.\n\n\tRevert:\n\t2012-12-03  Steven Bosscher  <steven@gcc.gnu.org>\n\t* passes.c (finish_optimization_passes): Don't finish graph dumps here.\n\t(pass_fini_dump_file): Wrap in TV_DUMP.  Finish graph dumps.\n\t(execute_one_pass): Don't set up graph dumps here.\n\nFrom-SVN: r194186", "tree": {"sha": "9c39d5d8b0db4235403b46001e26f3ccf5695b33", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/9c39d5d8b0db4235403b46001e26f3ccf5695b33"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/68fbd81bf093b2c14f94666153ca6428ac237880", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/68fbd81bf093b2c14f94666153ca6428ac237880", "html_url": "https://github.com/Rust-GCC/gccrs/commit/68fbd81bf093b2c14f94666153ca6428ac237880", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/68fbd81bf093b2c14f94666153ca6428ac237880/comments", "author": null, "committer": null, "parents": [{"sha": "03a6c305d3003e6aafbf014bf2c6651839fa7400", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/03a6c305d3003e6aafbf014bf2c6651839fa7400", "html_url": "https://github.com/Rust-GCC/gccrs/commit/03a6c305d3003e6aafbf014bf2c6651839fa7400"}], "stats": {"total": 34, "additions": 29, "deletions": 5}, "files": [{"sha": "5bbe08b6c7b8b37b8ab88fb7081a9072a28a9074", "filename": "gcc/ChangeLog", "status": "modified", "additions": 11, "deletions": 0, "changes": 11, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/68fbd81bf093b2c14f94666153ca6428ac237880/gcc%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/68fbd81bf093b2c14f94666153ca6428ac237880/gcc%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2FChangeLog?ref=68fbd81bf093b2c14f94666153ca6428ac237880", "patch": "@@ -1,3 +1,14 @@\n+2012-12-05  Steven Bosscher  <steven@gcc.gnu.org>\n+\n+\t* passes.c (pass_init_dump_file): Only open a clean graph dump file if\n+\tthe dump was not already initialized.\n+\n+\tRevert:\n+\t2012-12-03  Steven Bosscher  <steven@gcc.gnu.org>\n+\t* passes.c (finish_optimization_passes): Don't finish graph dumps here.\n+\t(pass_fini_dump_file): Wrap in TV_DUMP.  Finish graph dumps.\n+\t(execute_one_pass): Don't set up graph dumps here.\n+\n 2012-12-05  Richard Biener  <rguenther@suse.de>\n \n \tPR lto/55525"}, {"sha": "92b78b690ce317f24676877e0ccd113ce8b0eb33", "filename": "gcc/passes.c", "status": "modified", "additions": 18, "deletions": 5, "changes": 23, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/68fbd81bf093b2c14f94666153ca6428ac237880/gcc%2Fpasses.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/68fbd81bf093b2c14f94666153ca6428ac237880/gcc%2Fpasses.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fpasses.c?ref=68fbd81bf093b2c14f94666153ca6428ac237880", "patch": "@@ -223,19 +223,35 @@ rest_of_type_compilation (tree type, int toplev)\n void\n finish_optimization_passes (void)\n {\n+  int i;\n+  struct dump_file_info *dfi;\n+  char *name;\n+\n   timevar_push (TV_DUMP);\n   if (profile_arc_flag || flag_test_coverage || flag_branch_probabilities)\n     {\n       dump_start (pass_profile.pass.static_pass_number, NULL);\n       end_branch_prob ();\n       dump_finish (pass_profile.pass.static_pass_number);\n     }\n+\n   if (optimize > 0)\n     {\n       dump_start (pass_profile.pass.static_pass_number, NULL);\n       print_combine_total_stats ();\n       dump_finish (pass_profile.pass.static_pass_number);\n     }\n+\n+  /* Do whatever is necessary to finish printing the graphs.  */\n+  for (i = TDI_end; (dfi = get_dump_file_info (i)) != NULL; ++i)\n+    if (dump_initialized_p (i)\n+\t&& (dfi->pflags & TDF_GRAPH) != 0\n+\t&& (name = get_dump_file_name (i)) != NULL)\n+      {\n+\tfinish_graph_dump_file (name);\n+\tfree (name);\n+      }\n+\n   timevar_pop (TV_DUMP);\n }\n \n@@ -2058,7 +2074,8 @@ pass_init_dump_file (struct opt_pass *pass)\n       dump_start (pass->static_pass_number, &dump_flags);\n       if (dump_file && current_function_decl)\n         dump_function_header (dump_file, current_function_decl, dump_flags);\n-      if (dump_file && (dump_flags & TDF_GRAPH)\n+      if (initializing_dump\n+\t  && dump_file && (dump_flags & TDF_GRAPH)\n \t  && cfun && (cfun->curr_properties & PROP_cfg))\n \tclean_graph_dump_file (dump_file_name);\n       timevar_pop (TV_DUMP);\n@@ -2079,10 +2096,6 @@ pass_fini_dump_file (struct opt_pass *pass)\n   /* Flush and close dump file.  */\n   if (dump_file_name)\n     {\n-      gcc_assert (dump_file);\n-      if (dump_flags & TDF_GRAPH\n-\t  && cfun && (cfun->curr_properties & PROP_cfg))\n-\tfinish_graph_dump_file (dump_file_name);\n       free (CONST_CAST (char *, dump_file_name));\n       dump_file_name = NULL;\n     }"}]}