{"sha": "8c8df06e46493f6cb55333db72fa1802279b48b4", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6OGM4ZGYwNmU0NjQ5M2Y2Y2I1NTMzM2RiNzJmYTE4MDIyNzliNDhiNA==", "commit": {"author": {"name": "Uros Bizjak", "email": "ubizjak@gmail.com", "date": "2021-08-12T19:18:46Z"}, "committer": {"name": "Uros Bizjak", "email": "ubizjak@gmail.com", "date": "2021-08-12T19:19:46Z"}, "message": "[i386] Introduce scalar version of avx512f_vmscalef.\n\n2021-08-12  Uro\u0161 Bizjak  <ubizjak@gmail.com>\n\ngcc/\n\tPR target/98309\n\t* config/i386/i386.md (avx512f_scalef<mode>2): New insn pattern.\n\t(ldexp<mode>3): Use avx512f_scalef<mode>2.\n\t(UNSPEC_SCALEF): Move from ...\n\t* config/i386/sse.md (UNSPEC_SCALEF): ... here.", "tree": {"sha": "873faeb5c94024cef50dcd6443d56b3d40ef8017", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/873faeb5c94024cef50dcd6443d56b3d40ef8017"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/8c8df06e46493f6cb55333db72fa1802279b48b4", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/8c8df06e46493f6cb55333db72fa1802279b48b4", "html_url": "https://github.com/Rust-GCC/gccrs/commit/8c8df06e46493f6cb55333db72fa1802279b48b4", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/8c8df06e46493f6cb55333db72fa1802279b48b4/comments", "author": {"login": "ubizjak", "id": 55479990, "node_id": "MDQ6VXNlcjU1NDc5OTkw", "avatar_url": "https://avatars.githubusercontent.com/u/55479990?v=4", "gravatar_id": "", "url": "https://api.github.com/users/ubizjak", "html_url": "https://github.com/ubizjak", "followers_url": "https://api.github.com/users/ubizjak/followers", "following_url": "https://api.github.com/users/ubizjak/following{/other_user}", "gists_url": "https://api.github.com/users/ubizjak/gists{/gist_id}", "starred_url": "https://api.github.com/users/ubizjak/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/ubizjak/subscriptions", "organizations_url": "https://api.github.com/users/ubizjak/orgs", "repos_url": "https://api.github.com/users/ubizjak/repos", "events_url": "https://api.github.com/users/ubizjak/events{/privacy}", "received_events_url": "https://api.github.com/users/ubizjak/received_events", "type": "User", "site_admin": false}, "committer": {"login": "ubizjak", "id": 55479990, "node_id": "MDQ6VXNlcjU1NDc5OTkw", "avatar_url": "https://avatars.githubusercontent.com/u/55479990?v=4", "gravatar_id": "", "url": "https://api.github.com/users/ubizjak", "html_url": "https://github.com/ubizjak", "followers_url": "https://api.github.com/users/ubizjak/followers", "following_url": "https://api.github.com/users/ubizjak/following{/other_user}", "gists_url": "https://api.github.com/users/ubizjak/gists{/gist_id}", "starred_url": "https://api.github.com/users/ubizjak/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/ubizjak/subscriptions", "organizations_url": "https://api.github.com/users/ubizjak/orgs", "repos_url": "https://api.github.com/users/ubizjak/repos", "events_url": "https://api.github.com/users/ubizjak/events{/privacy}", "received_events_url": "https://api.github.com/users/ubizjak/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "a6da2cddcf0e959de6666d4d74411af23507f9f9", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/a6da2cddcf0e959de6666d4d74411af23507f9f9", "html_url": "https://github.com/Rust-GCC/gccrs/commit/a6da2cddcf0e959de6666d4d74411af23507f9f9"}], "stats": {"total": 28, "additions": 19, "deletions": 9}, "files": [{"sha": "4a8e8fea290cd144096ae7dfe9ebf51cc7ac56fd", "filename": "gcc/config/i386/i386.md", "status": "modified", "additions": 19, "deletions": 8, "changes": 27, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/8c8df06e46493f6cb55333db72fa1802279b48b4/gcc%2Fconfig%2Fi386%2Fi386.md", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/8c8df06e46493f6cb55333db72fa1802279b48b4/gcc%2Fconfig%2Fi386%2Fi386.md", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fconfig%2Fi386%2Fi386.md?ref=8c8df06e46493f6cb55333db72fa1802279b48b4", "patch": "@@ -125,6 +125,9 @@\n   UNSPEC_RSQRT\n   UNSPEC_PSADBW\n \n+  ;; For AVX512F support\n+  UNSPEC_SCALEF\n+\n   ;; Generic math support\n   UNSPEC_COPYSIGN\n   UNSPEC_XORSIGN\n@@ -17894,6 +17897,17 @@\n   DONE;\n })\n \n+(define_insn \"avx512f_scalef<mode>2\"\n+  [(set (match_operand:MODEF 0 \"register_operand\" \"=v\")\n+\t(unspec:MODEF\n+\t  [(match_operand:MODEF 1 \"register_operand\" \"v\")\n+\t   (match_operand:MODEF 2 \"nonimmediate_operand\" \"vm\")]\n+\t  UNSPEC_SCALEF))]\n+  \"TARGET_AVX512F\"\n+  \"vscalef<ssemodesuffix>\\t{%2, %1, %0|%0, %1, %2}\"\n+  [(set_attr \"prefix\" \"evex\")\n+   (set_attr \"mode\"  \"<MODE>\")])\n+\n (define_expand \"ldexpxf3\"\n   [(match_operand:XF 0 \"register_operand\")\n    (match_operand:XF 1 \"register_operand\")\n@@ -17924,15 +17938,12 @@\n   if (TARGET_AVX512F && TARGET_SSE_MATH)\n    {\n      rtx op2 = gen_reg_rtx (<MODE>mode);\n-     emit_insn (gen_floatsi<mode>2 (op2, operands[2]));\n-     operands[0] = lowpart_subreg (<ssevecmodef>mode, operands[0], <MODE>mode);\n-     if (MEM_P (operands[1]))\n+\n+     if (!nonimmediate_operand (operands[1], <MODE>mode))\n        operands[1] = force_reg (<MODE>mode, operands[1]);\n-     operands[1] = lowpart_subreg (<ssevecmodef>mode, operands[1], <MODE>mode);\n-     op2 = lowpart_subreg (<ssevecmodef>mode, op2, <MODE>mode);\n-     emit_insn (gen_avx512f_vmscalef<ssevecmodelower> (operands[0],\n-\t\t\t\t\t\t       operands[1],\n-\t\t\t\t\t\t       op2));\n+\n+     emit_insn (gen_floatsi<mode>2 (op2, operands[2]));\n+     emit_insn (gen_avx512f_scalef<mode>2 (operands[0], operands[1], op2));\n    }\n   else\n     {"}, {"sha": "60e69a470e7626bafe5cfc46a56d8f4fd70bc4e8", "filename": "gcc/config/i386/sse.md", "status": "modified", "additions": 0, "deletions": 1, "changes": 1, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/8c8df06e46493f6cb55333db72fa1802279b48b4/gcc%2Fconfig%2Fi386%2Fsse.md", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/8c8df06e46493f6cb55333db72fa1802279b48b4/gcc%2Fconfig%2Fi386%2Fsse.md", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fconfig%2Fi386%2Fsse.md?ref=8c8df06e46493f6cb55333db72fa1802279b48b4", "patch": "@@ -92,7 +92,6 @@\n   UNSPEC_RCP14\n   UNSPEC_RSQRT14\n   UNSPEC_FIXUPIMM\n-  UNSPEC_SCALEF\n   UNSPEC_VTERNLOG\n   UNSPEC_GETEXP\n   UNSPEC_GETMANT"}]}