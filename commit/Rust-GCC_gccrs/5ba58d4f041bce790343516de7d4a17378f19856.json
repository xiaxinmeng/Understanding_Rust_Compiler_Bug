{"sha": "5ba58d4f041bce790343516de7d4a17378f19856", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6NWJhNThkNGYwNDFiY2U3OTAzNDM1MTZkZTdkNGExNzM3OGYxOTg1Ng==", "commit": {"author": {"name": "Jan Hubicka", "email": "jh@suse.cz", "date": "2010-12-14T23:22:23Z"}, "committer": {"name": "Jan Hubicka", "email": "hubicka@gcc.gnu.org", "date": "2010-12-14T23:22:23Z"}, "message": "re PR lto/46940 (asm aliases with linker plugin segfaults)\n\n\tPR lto/46940\n\tPR lto/44463\n\t* lto-symtab.c (lto_symtab_merge_cgraph_nodes_1): Construct nodes\n\tfor aliases when they are used.\n\n\t* gcc.dg/lto/pr46940_0.c: New testcase.\n\t* gcc.dg/lto/pr46940_1.c: New testcase.\n\nFrom-SVN: r167822", "tree": {"sha": "658d27be9a44303ba3ea4bbda914b7bb68be102b", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/658d27be9a44303ba3ea4bbda914b7bb68be102b"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/5ba58d4f041bce790343516de7d4a17378f19856", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/5ba58d4f041bce790343516de7d4a17378f19856", "html_url": "https://github.com/Rust-GCC/gccrs/commit/5ba58d4f041bce790343516de7d4a17378f19856", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/5ba58d4f041bce790343516de7d4a17378f19856/comments", "author": null, "committer": null, "parents": [{"sha": "42cbb8c17846290b82fd09ea79cab3e91454ba8d", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/42cbb8c17846290b82fd09ea79cab3e91454ba8d", "html_url": "https://github.com/Rust-GCC/gccrs/commit/42cbb8c17846290b82fd09ea79cab3e91454ba8d"}], "stats": {"total": 50, "additions": 48, "deletions": 2}, "files": [{"sha": "f2c7b5c4a744f1934b11a6017e9a5c9396d8a9bb", "filename": "gcc/ChangeLog", "status": "modified", "additions": 7, "deletions": 0, "changes": 7, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/5ba58d4f041bce790343516de7d4a17378f19856/gcc%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/5ba58d4f041bce790343516de7d4a17378f19856/gcc%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2FChangeLog?ref=5ba58d4f041bce790343516de7d4a17378f19856", "patch": "@@ -1,3 +1,10 @@\n+2010-12-14  Jan Hubicka  <jh@suse.cz>\n+\n+\tPR lto/46940\n+\tPR lto/44463\n+\t* lto-symtab.c (lto_symtab_merge_cgraph_nodes_1): Construct nodes\n+\tfor aliases when they are used.\n+\n 2010-12-14  Joseph Myers  <joseph@codesourcery.com>\n \n \t* config.gcc (sparc-*-elf*, sparc-*-rtems*, sparc-*-linux*,"}, {"sha": "b331d5cee61bd44b97f2f7ab67bbd447a884bfb4", "filename": "gcc/lto-symtab.c", "status": "modified", "additions": 19, "deletions": 2, "changes": 21, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/5ba58d4f041bce790343516de7d4a17378f19856/gcc%2Flto-symtab.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/5ba58d4f041bce790343516de7d4a17378f19856/gcc%2Flto-symtab.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Flto-symtab.c?ref=5ba58d4f041bce790343516de7d4a17378f19856", "patch": "@@ -795,9 +795,26 @@ lto_symtab_merge_cgraph_nodes_1 (void **slot, void *data ATTRIBUTE_UNUSED)\n   for (e = prevailing->next; e; e = e->next)\n     {\n       if (e->node != NULL)\n-\tlto_cgraph_replace_node (e->node, prevailing->node);\n+\t{\n+\t  /* In case we prevail funcion by an alias, we can run into case\n+\t     that the alias has no cgraph node attached, since it was\n+\t     previously unused.  Create the node.  */\n+\t  if (!prevailing->node)\n+\t    {\n+\t      prevailing->node = cgraph_node (prevailing->decl);\n+\t      prevailing->node->alias = true;\n+\t    }\n+\t  lto_cgraph_replace_node (e->node, prevailing->node);\n+\t}\n       if (e->vnode != NULL)\n-\tlto_varpool_replace_node (e->vnode, prevailing->vnode);\n+\t{\n+\t  if (!prevailing->vnode)\n+\t    {\n+\t      prevailing->vnode = varpool_node (prevailing->decl);\n+\t      prevailing->vnode->alias = true;\n+\t    }\n+\t  lto_varpool_replace_node (e->vnode, prevailing->vnode);\n+\t}\n     }\n \n   /* Drop all but the prevailing decl from the symtab.  */"}, {"sha": "f3210512f89d3e40f2ae36490e89fddf7f81a10f", "filename": "gcc/testsuite/ChangeLog", "status": "modified", "additions": 7, "deletions": 0, "changes": 7, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/5ba58d4f041bce790343516de7d4a17378f19856/gcc%2Ftestsuite%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/5ba58d4f041bce790343516de7d4a17378f19856/gcc%2Ftestsuite%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2FChangeLog?ref=5ba58d4f041bce790343516de7d4a17378f19856", "patch": "@@ -1,3 +1,10 @@\n+2010-12-14  Jan Hubicka  <jh@suse.cz>\n+\n+\tPR lto/46940\n+\tPR lto/44463\n+\t* gcc.dg/lto/pr46940_0.c: New testcase.\n+\t* gcc.dg/lto/pr46940_1.c: New testcase.\n+\n 2010-12-14  Nathan Froyd  <froydnj@codesourcery.com>\n \n \tPR c++/45330"}, {"sha": "e9f6dc87f5efe247f09245b0be972a1faead1a41", "filename": "gcc/testsuite/gcc.dg/lto/pr46940_0.c", "status": "added", "additions": 10, "deletions": 0, "changes": 10, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/5ba58d4f041bce790343516de7d4a17378f19856/gcc%2Ftestsuite%2Fgcc.dg%2Flto%2Fpr46940_0.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/5ba58d4f041bce790343516de7d4a17378f19856/gcc%2Ftestsuite%2Fgcc.dg%2Flto%2Fpr46940_0.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgcc.dg%2Flto%2Fpr46940_0.c?ref=5ba58d4f041bce790343516de7d4a17378f19856", "patch": "@@ -0,0 +1,10 @@\n+* { dg-require-linker-plugin \"\" } */\n+* { dg-extra-ld-options \"-fuse-linker-plugin\" } */\n+\n+extern __attribute__((visibility(\"hidden\"))) void _moz_foo (void);\n+extern __typeof (_moz_foo) _moz_foo __asm__ (\"\" \"INT__foo\") __attribute__((__visibility__(\"hidden\"))) ;\n+void _moz_foo(void)\n+{\n+  printf (\"blah\\n\");\n+}\n+extern __typeof (_moz_foo) EXT__foo __asm__(\"\" \"_moz_foo\") __attribute__((__alias__(\"\" \"INT__foo\")));"}, {"sha": "0a8dab54b5b4d8fa191633517244f2c827c25c6f", "filename": "gcc/testsuite/gcc.dg/lto/pr46940_1.c", "status": "added", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/5ba58d4f041bce790343516de7d4a17378f19856/gcc%2Ftestsuite%2Fgcc.dg%2Flto%2Fpr46940_1.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/5ba58d4f041bce790343516de7d4a17378f19856/gcc%2Ftestsuite%2Fgcc.dg%2Flto%2Fpr46940_1.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgcc.dg%2Flto%2Fpr46940_1.c?ref=5ba58d4f041bce790343516de7d4a17378f19856", "patch": "@@ -0,0 +1,5 @@\n+extern void _moz_foo (void);\n+main()\n+{\n+  _moz_foo ();\n+}"}]}