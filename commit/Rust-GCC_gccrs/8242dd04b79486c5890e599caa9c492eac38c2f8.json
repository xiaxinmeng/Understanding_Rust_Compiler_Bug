{"sha": "8242dd04b79486c5890e599caa9c492eac38c2f8", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6ODI0MmRkMDRiNzk0ODZjNTg5MGU1OTljYWE5YzQ5MmVhYzM4YzJmOA==", "commit": {"author": {"name": "Nathan Froyd", "email": "froydnj@codesourcery.com", "date": "2011-05-10T16:56:19Z"}, "committer": {"name": "Nathan Froyd", "email": "froydnj@gcc.gnu.org", "date": "2011-05-10T16:56:19Z"}, "message": "use build_function_type less in c-family and LTO\n\nuse build_function_type less in c-family and LTO\ngcc/c-family/\n\t* c-common.c (def_fn_type): Don't call build_function_type, call\n\tbuild_function_type_array or build_varargs_function_type_array\n\tinstead.\n\t(c_common_nodes_and_builtins): Likewise.\n\ngcc/lto/\n\t* lto-lang.c (def_fn_type): Don't call build_function_type, call\n\tbuild_function_type_array or build_varargs_function_type_array\n\tinstead.\n\nFrom-SVN: r173623", "tree": {"sha": "21c9e334acd6ce8a0705b286bd6ae197901ec1a1", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/21c9e334acd6ce8a0705b286bd6ae197901ec1a1"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/8242dd04b79486c5890e599caa9c492eac38c2f8", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/8242dd04b79486c5890e599caa9c492eac38c2f8", "html_url": "https://github.com/Rust-GCC/gccrs/commit/8242dd04b79486c5890e599caa9c492eac38c2f8", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/8242dd04b79486c5890e599caa9c492eac38c2f8/comments", "author": null, "committer": null, "parents": [{"sha": "4a68b4ca4e0169389c97cd58a0b4eab9c3810c3f", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/4a68b4ca4e0169389c97cd58a0b4eab9c3810c3f", "html_url": "https://github.com/Rust-GCC/gccrs/commit/4a68b4ca4e0169389c97cd58a0b4eab9c3810c3f"}], "stats": {"total": 44, "additions": 29, "deletions": 15}, "files": [{"sha": "01b6ba7eb2acdbad29c64082c9bab2a90a50a898", "filename": "gcc/c-family/ChangeLog", "status": "modified", "additions": 7, "deletions": 0, "changes": 7, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/8242dd04b79486c5890e599caa9c492eac38c2f8/gcc%2Fc-family%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/8242dd04b79486c5890e599caa9c492eac38c2f8/gcc%2Fc-family%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fc-family%2FChangeLog?ref=8242dd04b79486c5890e599caa9c492eac38c2f8", "patch": "@@ -1,3 +1,10 @@\n+2011-05-10  Nathan Froyd  <froydnj@codesourcery.com>\n+\n+\t* c-common.c (def_fn_type): Don't call build_function_type, call\n+\tbuild_function_type_array or build_varargs_function_type_array\n+\tinstead.\n+\t(c_common_nodes_and_builtins): Likewise.\n+\n 2011-05-05  Nathan Froyd  <froydnj@codesourcery.com>\n \n \t* c-common.c (c_add_case_label): Omit the loc argument to"}, {"sha": "a04801ef90d3aebc9b556c93373f2b84a6d94768", "filename": "gcc/c-family/c-common.c", "status": "modified", "additions": 9, "deletions": 8, "changes": 17, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/8242dd04b79486c5890e599caa9c492eac38c2f8/gcc%2Fc-family%2Fc-common.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/8242dd04b79486c5890e599caa9c492eac38c2f8/gcc%2Fc-family%2Fc-common.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fc-family%2Fc-common.c?ref=8242dd04b79486c5890e599caa9c492eac38c2f8", "patch": "@@ -4414,7 +4414,8 @@ static tree builtin_types[(int) BT_LAST + 1];\n static void\n def_fn_type (builtin_type def, builtin_type ret, bool var, int n, ...)\n {\n-  tree args = NULL, t;\n+  tree t;\n+  tree *args = XALLOCAVEC (tree, n);\n   va_list list;\n   int i;\n \n@@ -4425,18 +4426,17 @@ def_fn_type (builtin_type def, builtin_type ret, bool var, int n, ...)\n       t = builtin_types[a];\n       if (t == error_mark_node)\n \tgoto egress;\n-      args = tree_cons (NULL_TREE, t, args);\n+      args[i] = t;\n     }\n   va_end (list);\n \n-  args = nreverse (args);\n-  if (!var)\n-    args = chainon (args, void_list_node);\n-\n   t = builtin_types[ret];\n   if (t == error_mark_node)\n     goto egress;\n-  t = build_function_type (t, args);\n+  if (var)\n+    t = build_varargs_function_type_array (t, n, args);\n+  else\n+    t = build_function_type_array (t, n, args);\n \n  egress:\n   builtin_types[def] = t;\n@@ -4931,7 +4931,8 @@ c_common_nodes_and_builtins (void)\n     uintptr_type_node =\n       TREE_TYPE (identifier_global_value (c_get_ident (UINTPTR_TYPE)));\n \n-  default_function_type = build_function_type (integer_type_node, NULL_TREE);\n+  default_function_type\n+    = build_varargs_function_type_list (integer_type_node, NULL_TREE);\n   ptrdiff_type_node\n     = TREE_TYPE (identifier_global_value (get_identifier (PTRDIFF_TYPE)));\n   unsigned_ptrdiff_type_node = c_common_unsigned_type (ptrdiff_type_node);"}, {"sha": "3bc57c954f1a4d58aa5c2b3fd9c1055c0d133b9e", "filename": "gcc/lto/ChangeLog", "status": "modified", "additions": 6, "deletions": 0, "changes": 6, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/8242dd04b79486c5890e599caa9c492eac38c2f8/gcc%2Flto%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/8242dd04b79486c5890e599caa9c492eac38c2f8/gcc%2Flto%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Flto%2FChangeLog?ref=8242dd04b79486c5890e599caa9c492eac38c2f8", "patch": "@@ -1,3 +1,9 @@\n+2011-05-10  Nathan Froyd  <froydnj@codesourcery.com>\n+\n+\t* lto-lang.c (def_fn_type): Don't call build_function_type, call\n+\tbuild_function_type_array or build_varargs_function_type_array\n+\tinstead.\n+\n 2011-05-07  Eric Botcazou  <ebotcazou@adacore.com>\n \n \t* lto-lang.c (global_bindings_p): Return bool."}, {"sha": "5fe89b87d1e9f819a5743ef7c4ab2f89752ddacd", "filename": "gcc/lto/lto-lang.c", "status": "modified", "additions": 7, "deletions": 7, "changes": 14, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/8242dd04b79486c5890e599caa9c492eac38c2f8/gcc%2Flto%2Flto-lang.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/8242dd04b79486c5890e599caa9c492eac38c2f8/gcc%2Flto%2Flto-lang.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Flto%2Flto-lang.c?ref=8242dd04b79486c5890e599caa9c492eac38c2f8", "patch": "@@ -433,7 +433,8 @@ handle_format_arg_attribute (tree * ARG_UNUSED (node), tree ARG_UNUSED (name),\n static void\n def_fn_type (builtin_type def, builtin_type ret, bool var, int n, ...)\n {\n-  tree args = NULL, t;\n+  tree t;\n+  tree *args = XALLOCAVEC (tree, n);\n   va_list list;\n   int i;\n \n@@ -444,18 +445,17 @@ def_fn_type (builtin_type def, builtin_type ret, bool var, int n, ...)\n       t = builtin_types[a];\n       if (t == error_mark_node)\n \tgoto egress;\n-      args = tree_cons (NULL_TREE, t, args);\n+      args[i] = t;\n     }\n   va_end (list);\n \n-  args = nreverse (args);\n-  if (!var)\n-    args = chainon (args, void_list_node);\n-\n   t = builtin_types[ret];\n   if (t == error_mark_node)\n     goto egress;\n-  t = build_function_type (t, args);\n+  if (var)\n+    t = build_varargs_function_type_array (t, n, args);\n+  else\n+    t = build_function_type_array (t, n, args);\n \n  egress:\n   builtin_types[def] = t;"}]}