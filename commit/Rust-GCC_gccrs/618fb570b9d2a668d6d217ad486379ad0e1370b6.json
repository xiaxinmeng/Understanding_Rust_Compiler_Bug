{"sha": "618fb570b9d2a668d6d217ad486379ad0e1370b6", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6NjE4ZmI1NzBiOWQyYTY2OGQ2ZDIxN2FkNDg2Mzc5YWQwZTEzNzBiNg==", "commit": {"author": {"name": "Arnaud Charlet", "email": "charlet@gcc.gnu.org", "date": "2009-04-17T09:30:39Z"}, "committer": {"name": "Arnaud Charlet", "email": "charlet@gcc.gnu.org", "date": "2009-04-17T09:30:39Z"}, "message": "[multiple changes]\n\n2009-04-17  Gary Dismukes  <dismukes@adacore.com>\n\n\t* par-ch6.adb (P_Subprogram): Overriding indicators should be allowed\n\ton protected subprogram bodies, so exclude the case where Pf_Flags is\n\tPf_Decl_Pbod from the error check.\n\n\t* par-ch9.adb (P_Protected_Operation_Items): Permit overriding\n\tindicators on subprograms in protected bodies, and proceed with parsing\n\tthe subprogram.\n\n\t* sem_ch6.adb (Verify_Overriding_Indicator): Exclude protected\n\tsubprograms from the check for primitiveness on subprograms with\n\toverriding indicators.\n\t(Check_Overriding_Indicator): Include protected subprograms in the\n\tstyle check for missing overriding indicators.\n\n2009-04-17  Tristan Gingold  <gingold@adacore.com>\n\n\t* init.c: Fix stack checking for x86 Darwin.\n\n2009-04-17  Vincent Celier  <celier@adacore.com>\n\n\t* prj-attr.adb: New project level attribute Object_File_Suffix\n\t(<language>).\n\t\n\t* prj-nmsc.adb (Add_Source): Use the object file suffix to get the\n\tobject file name\n\t(Process_Compiler): Process attribute Object_File_Suffix\n\n\t* prj.adb (Object_Name): Use suffix Object_File_Suffix instead of\n\tplatform suffix, when specified.\n\n\t* prj.ads (Language_Config): New component Object_File_Suffix,\n\tdefaulted to No_Name.\n\t(Object_Name): New parameter Object_File_Suffix, defaulted to No_Name\n\n\t* snames.ads-tmpl: New standard name Object_File_Suffix\n\nFrom-SVN: r146228", "tree": {"sha": "dc9767c938b339ff6ffccf318357c7538dcffd5f", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/dc9767c938b339ff6ffccf318357c7538dcffd5f"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/618fb570b9d2a668d6d217ad486379ad0e1370b6", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/618fb570b9d2a668d6d217ad486379ad0e1370b6", "html_url": "https://github.com/Rust-GCC/gccrs/commit/618fb570b9d2a668d6d217ad486379ad0e1370b6", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/618fb570b9d2a668d6d217ad486379ad0e1370b6/comments", "author": null, "committer": null, "parents": [{"sha": "93bcda233f11648dbf583a9f0e50af387594d78a", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/93bcda233f11648dbf583a9f0e50af387594d78a", "html_url": "https://github.com/Rust-GCC/gccrs/commit/93bcda233f11648dbf583a9f0e50af387594d78a"}], "stats": {"total": 124, "additions": 105, "deletions": 19}, "files": [{"sha": "eaa602b0ec1d85755ab4407b55ff56a2e0ad6093", "filename": "gcc/ada/ChangeLog", "status": "modified", "additions": 38, "deletions": 0, "changes": 38, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/618fb570b9d2a668d6d217ad486379ad0e1370b6/gcc%2Fada%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/618fb570b9d2a668d6d217ad486379ad0e1370b6/gcc%2Fada%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fada%2FChangeLog?ref=618fb570b9d2a668d6d217ad486379ad0e1370b6", "patch": "@@ -1,3 +1,41 @@\n+2009-04-17  Gary Dismukes  <dismukes@adacore.com>\n+\n+\t* par-ch6.adb (P_Subprogram): Overriding indicators should be allowed\n+\ton protected subprogram bodies, so exclude the case where Pf_Flags is\n+\tPf_Decl_Pbod from the error check.\n+\n+\t* par-ch9.adb (P_Protected_Operation_Items): Permit overriding\n+\tindicators on subprograms in protected bodies, and proceed with parsing\n+\tthe subprogram.\n+\n+\t* sem_ch6.adb (Verify_Overriding_Indicator): Exclude protected\n+\tsubprograms from the check for primitiveness on subprograms with\n+\toverriding indicators.\n+\t(Check_Overriding_Indicator): Include protected subprograms in the\n+\tstyle check for missing overriding indicators.\n+\n+2009-04-17  Tristan Gingold  <gingold@adacore.com>\n+\n+\t* init.c: Fix stack checking for x86 Darwin.\n+\n+2009-04-17  Vincent Celier  <celier@adacore.com>\n+\n+\t* prj-attr.adb: New project level attribute Object_File_Suffix\n+\t(<language>).\n+\t\n+\t* prj-nmsc.adb (Add_Source): Use the object file suffix to get the\n+\tobject file name\n+\t(Process_Compiler): Process attribute Object_File_Suffix\n+\n+\t* prj.adb (Object_Name): Use suffix Object_File_Suffix instead of\n+\tplatform suffix, when specified.\n+\n+\t* prj.ads (Language_Config): New component Object_File_Suffix,\n+\tdefaulted to No_Name.\n+\t(Object_Name): New parameter Object_File_Suffix, defaulted to No_Name\n+\n+\t* snames.ads-tmpl: New standard name Object_File_Suffix\n+\n 2009-04-17  Robert Dewar  <dewar@adacore.com>\n \n \t* gnat_rm.texi: Add documentation about No_Streams restriction"}, {"sha": "59aabf2466c7c09c0ce4e83fe2ad21ffb1a6ddff", "filename": "gcc/ada/init.c", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/618fb570b9d2a668d6d217ad486379ad0e1370b6/gcc%2Fada%2Finit.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/618fb570b9d2a668d6d217ad486379ad0e1370b6/gcc%2Fada%2Finit.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fada%2Finit.c?ref=618fb570b9d2a668d6d217ad486379ad0e1370b6", "patch": "@@ -2144,7 +2144,7 @@ __gnat_error_handler (int sig, siginfo_t * si, void * uc)\n     {\n     case SIGSEGV:\n     case SIGBUS:\n-      if (__gnat_is_stack_guard ((mach_vm_address_t)si->si_addr))\n+      if (__gnat_is_stack_guard ((unsigned long)si->si_addr))\n \t{\n \t  exception = &storage_error;\n \t  msg = \"stack overflow\";"}, {"sha": "263efe1e5a3c6b1e12032762f40b5ea7855f28b0", "filename": "gcc/ada/par-ch6.adb", "status": "modified", "additions": 7, "deletions": 2, "changes": 9, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/618fb570b9d2a668d6d217ad486379ad0e1370b6/gcc%2Fada%2Fpar-ch6.adb", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/618fb570b9d2a668d6d217ad486379ad0e1370b6/gcc%2Fada%2Fpar-ch6.adb", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fada%2Fpar-ch6.adb?ref=618fb570b9d2a668d6d217ad486379ad0e1370b6", "patch": "@@ -215,9 +215,14 @@ package body Ch6 is\n          --  already been given, so no need to give another message here.\n \n          --  An overriding indicator is allowed for subprogram declarations,\n-         --  bodies, renamings, stubs, and instantiations.\n+         --  bodies, renamings, stubs, and instantiations. The test against\n+         --  Pf_Decl_Pbod is added to account for the case of subprograms\n+         --  declared in a protected type, where only subprogram declarations\n+         --  and bodies can occur.\n \n-         if Pf_Flags /= Pf_Decl_Gins_Pbod_Rnam_Stub then\n+         if Pf_Flags /= Pf_Decl_Gins_Pbod_Rnam_Stub\n+           and then Pf_Flags /= Pf_Decl_Pbod\n+         then\n             Error_Msg_SC (\"overriding indicator not allowed here!\");\n \n          elsif Token /= Tok_Function"}, {"sha": "d5c3549f23de5a23c3519cd53f55e86add11c536", "filename": "gcc/ada/par-ch9.adb", "status": "modified", "additions": 7, "deletions": 0, "changes": 7, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/618fb570b9d2a668d6d217ad486379ad0e1370b6/gcc%2Fada%2Fpar-ch9.adb", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/618fb570b9d2a668d6d217ad486379ad0e1370b6/gcc%2Fada%2Fpar-ch9.adb", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fada%2Fpar-ch9.adb?ref=618fb570b9d2a668d6d217ad486379ad0e1370b6", "patch": "@@ -736,9 +736,16 @@ package body Ch9 is\n          if Token = Tok_Entry or else Bad_Spelling_Of (Tok_Entry) then\n             Append (P_Entry_Body, Item_List);\n \n+         --  If the operation starts with procedure, function, or an overriding\n+         --  indicator (\"overriding\" or \"not overriding\"), parse a subprogram.\n+\n          elsif Token = Tok_Function or else Bad_Spelling_Of (Tok_Function)\n                  or else\n                Token = Tok_Procedure or else Bad_Spelling_Of (Tok_Procedure)\n+                 or else\n+               Token = Tok_Overriding or else Bad_Spelling_Of (Tok_Overriding)\n+                 or else\n+               Token = Tok_Not or else Bad_Spelling_Of (Tok_Not)\n          then\n             Append (P_Subprogram (Pf_Decl_Pbod), Item_List);\n "}, {"sha": "4aaecaa740a8cf4b63a956b7d09e7e43c362489d", "filename": "gcc/ada/prj-attr.adb", "status": "modified", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/618fb570b9d2a668d6d217ad486379ad0e1370b6/gcc%2Fada%2Fprj-attr.adb", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/618fb570b9d2a668d6d217ad486379ad0e1370b6/gcc%2Fada%2Fprj-attr.adb", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fada%2Fprj-attr.adb?ref=618fb570b9d2a668d6d217ad486379ad0e1370b6", "patch": "@@ -173,6 +173,7 @@ package body Prj.Attr is\n    \"Larequired_switches#\" &\n    \"Lapic_option#\" &\n    \"Sapath_syntax#\" &\n+   \"Saobject_file_suffix#\" &\n \n    --  Configuration - Mapping files\n "}, {"sha": "9b173bccc5251d3dd77d0c35a1c670e982d8734b", "filename": "gcc/ada/prj-nmsc.adb", "status": "modified", "additions": 17, "deletions": 3, "changes": 20, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/618fb570b9d2a668d6d217ad486379ad0e1370b6/gcc%2Fada%2Fprj-nmsc.adb", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/618fb570b9d2a668d6d217ad486379ad0e1370b6/gcc%2Fada%2Fprj-nmsc.adb", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fada%2Fprj-nmsc.adb?ref=618fb570b9d2a668d6d217ad486379ad0e1370b6", "patch": "@@ -646,7 +646,8 @@ package body Prj.Nmsc is\n       Src_Data.Naming_Exception    := Naming_Exception;\n \n       if Src_Data.Compiled and then Src_Data.Object_Exists then\n-         Src_Data.Object   := Object_Name (File_Name);\n+         Src_Data.Object   :=\n+           Object_Name (File_Name, Config.Object_File_Suffix);\n          Src_Data.Dep_Name :=\n            Dependency_Name (File_Name, Src_Data.Dependency);\n          Src_Data.Switches := Switches_Name (File_Name);\n@@ -1541,6 +1542,19 @@ package body Prj.Nmsc is\n                                     Element.Value.Location);\n                            end;\n \n+                        when Name_Object_File_Suffix =>\n+                           if Get_Name_String (Element.Value.Value) = \"\" then\n+                              Error_Msg\n+                                (Project, In_Tree,\n+                                 \"object file suffix cannot be empty\",\n+                                 Element.Value.Location);\n+\n+                           else\n+                              In_Tree.Languages_Data.Table\n+                                (Lang_Index).Config.Object_File_Suffix :=\n+                                Element.Value.Value;\n+                           end if;\n+\n                         when Name_Pic_Option =>\n \n                            --  Attribute Compiler_Pic_Option (<language>)\n@@ -5796,12 +5810,12 @@ package body Prj.Nmsc is\n                       Util.Value_Of\n                         (Name_Source_Files, Data.Decl.Attributes, In_Tree);\n \n+      Last_Source_Dir : String_List_Id  := Nil_String;\n+\n       Languages : constant Variable_Value :=\n                       Prj.Util.Value_Of\n                         (Name_Languages, Data.Decl.Attributes, In_Tree);\n \n-      Last_Source_Dir : String_List_Id  := Nil_String;\n-\n       procedure Find_Source_Dirs\n         (From     : File_Name_Type;\n          Location : Source_Ptr;"}, {"sha": "73e1f40109dc9e1fee9347b9cec007b2d731b011", "filename": "gcc/ada/prj.adb", "status": "modified", "additions": 9, "deletions": 2, "changes": 11, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/618fb570b9d2a668d6d217ad486379ad0e1370b6/gcc%2Fada%2Fprj.adb", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/618fb570b9d2a668d6d217ad486379ad0e1370b6/gcc%2Fada%2Fprj.adb", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fada%2Fprj.adb?ref=618fb570b9d2a668d6d217ad486379ad0e1370b6", "patch": "@@ -709,11 +709,18 @@ package body Prj is\n    -----------------\n \n    function Object_Name\n-     (Source_File_Name : File_Name_Type)\n+     (Source_File_Name   : File_Name_Type;\n+      Object_File_Suffix : Name_Id := No_Name)\n       return File_Name_Type\n    is\n    begin\n-      return Extend_Name (Source_File_Name, Object_Suffix);\n+      if Object_File_Suffix = No_Name then\n+         return Extend_Name (Source_File_Name, Object_Suffix);\n+\n+      else\n+         return Extend_Name\n+           (Source_File_Name, Get_Name_String (Object_File_Suffix));\n+      end if;\n    end Object_Name;\n \n    ----------------------"}, {"sha": "db348b7a039106f3fa91cee459098a4336238be9", "filename": "gcc/ada/prj.ads", "status": "modified", "additions": 5, "deletions": 1, "changes": 6, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/618fb570b9d2a668d6d217ad486379ad0e1370b6/gcc%2Fada%2Fprj.ads", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/618fb570b9d2a668d6d217ad486379ad0e1370b6/gcc%2Fada%2Fprj.ads", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fada%2Fprj.ads?ref=618fb570b9d2a668d6d217ad486379ad0e1370b6", "patch": "@@ -441,6 +441,8 @@ package Prj is\n       --  Value may be Canonical (Unix style) or Host (host syntax, for example\n       --  on VMS for DEC C).\n \n+      Object_File_Suffix : Name_Id := No_Name;\n+\n       Compilation_PIC_Option : Name_List_Index := No_Name_List;\n       --  The option(s) to compile a source in Position Independent Code for\n       --  shared libraries. Specified in the configuration. When not specified,\n@@ -557,6 +559,7 @@ package Prj is\n                            Compiler_Driver_Path         => null,\n                            Compiler_Required_Switches   => No_Name_List,\n                            Path_Syntax                  => Canonical,\n+                           Object_File_Suffix           => No_Name,\n                            Compilation_PIC_Option       => No_Name_List,\n                            Object_Generated             => True,\n                            Objects_Linked               => True,\n@@ -1564,7 +1567,8 @@ package Prj is\n    --  Replace the extension of File with With_Suffix\n \n    function Object_Name\n-     (Source_File_Name : File_Name_Type) return File_Name_Type;\n+     (Source_File_Name   : File_Name_Type;\n+      Object_File_Suffix : Name_Id := No_Name) return File_Name_Type;\n    --  Returns the object file name corresponding to a source file name\n \n    function Dependency_Name"}, {"sha": "17e3d25d6d894caf301f39cabafacaf5f53247a6", "filename": "gcc/ada/sem_ch6.adb", "status": "modified", "additions": 19, "deletions": 10, "changes": 29, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/618fb570b9d2a668d6d217ad486379ad0e1370b6/gcc%2Fada%2Fsem_ch6.adb", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/618fb570b9d2a668d6d217ad486379ad0e1370b6/gcc%2Fada%2Fsem_ch6.adb", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fada%2Fsem_ch6.adb?ref=618fb570b9d2a668d6d217ad486379ad0e1370b6", "patch": "@@ -1766,10 +1766,12 @@ package body Sem_Ch6 is\n                  (\"subprogram & overrides predefined operator \",\n                     Body_Spec, Spec_Id);\n \n-            --  If this is not a primitive operation the overriding indicator\n-            --  is altogether illegal.\n+            --  If this is not a primitive operation or protected subprogram,\n+            --  then the overriding indicator is altogether illegal.\n \n-            elsif not Is_Primitive (Spec_Id) then\n+            elsif not Is_Primitive (Spec_Id)\n+              and then Ekind (Scope (Spec_Id)) /= E_Protected_Type\n+            then\n                Error_Msg_N (\"overriding indicator only allowed \" &\n                 \"if subprogram is primitive\",\n                 Body_Spec);\n@@ -4281,14 +4283,15 @@ package body Sem_Ch6 is\n             Set_Is_Overriding_Operation (Subp);\n          end if;\n \n-         --  If primitive flag is set, operation is overriding at the\n-         --  point of its declaration, so warn if necessary. Otherwise\n-         --  it may have been declared before the operation it overrides\n-         --  and no check is required.\n+         --  If primitive flag is set or this is a protected operation, then\n+         --  the operation is overriding at the point of its declaration, so\n+         --  warn if necessary. Otherwise it may have been declared before the\n+         --  operation it overrides and no check is required.\n \n          if Style_Check\n-            and then not Must_Override (Spec)\n-            and then Is_Primitive\n+           and then not Must_Override (Spec)\n+           and then (Is_Primitive\n+                      or else Ekind (Scope (Subp)) = E_Protected_Type)\n          then\n             Style.Missing_Overriding (Decl, Subp);\n          end if;\n@@ -4306,7 +4309,13 @@ package body Sem_Ch6 is\n       elsif Nkind (Subp) = N_Defining_Operator_Symbol then\n \n          if Must_Not_Override (Spec) then\n-            if not Is_Primitive then\n+\n+            --  If this is not a primitive operation or protected subprogram,\n+            --  then \"not overriding\" is illegal.\n+\n+            if not Is_Primitive\n+              and then Ekind (Scope (Subp)) /= E_Protected_Type\n+            then\n                Error_Msg_N\n                  (\"overriding indicator only allowed \"\n                     & \"if subprogram is primitive\", Subp);"}, {"sha": "2f4c6cc3b0889e2567cde4e2af8161f0c16aeb66", "filename": "gcc/ada/snames.ads-tmpl", "status": "modified", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/618fb570b9d2a668d6d217ad486379ad0e1370b6/gcc%2Fada%2Fsnames.ads-tmpl", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/618fb570b9d2a668d6d217ad486379ad0e1370b6/gcc%2Fada%2Fsnames.ads-tmpl", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fada%2Fsnames.ads-tmpl?ref=618fb570b9d2a668d6d217ad486379ad0e1370b6", "patch": "@@ -1097,6 +1097,7 @@ package Snames is\n    Name_Metrics                          : constant Name_Id := N + $;\n    Name_Naming                           : constant Name_Id := N + $;\n    Name_None                             : constant Name_Id := N + $;\n+   Name_Object_File_Suffix               : constant Name_Id := N + $;\n    Name_Object_Generated                 : constant Name_Id := N + $;\n    Name_Object_List                      : constant Name_Id := N + $;\n    Name_Objects_Linked                   : constant Name_Id := N + $;"}]}