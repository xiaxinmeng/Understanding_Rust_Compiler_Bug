{"sha": "e2ab8a0f88198a43c90cef65f1701beaaa98f525", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6ZTJhYjhhMGY4ODE5OGE0M2M5MGNlZjY1ZjE3MDFiZWFhYTk4ZjUyNQ==", "commit": {"author": {"name": "Jonathan Wakely", "email": "jwakely.gcc@gmail.com", "date": "2011-07-01T22:24:42Z"}, "committer": {"name": "Jonathan Wakely", "email": "redi@gcc.gnu.org", "date": "2011-07-01T22:24:42Z"}, "message": "re PR c++/49605 (-Wdelete-non-virtual-dtor is not picky enough)\n\n2011-07-01  Jonathan Wakely  <jwakely.gcc@gmail.com>\n\n\tPR c++/49605\n\t* init.c (build_delete): Only warn for sfk_deleting_destructor.\n\nFrom-SVN: r175771", "tree": {"sha": "c3f4f9dfba06a6b896621c34a9ba015466d79032", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/c3f4f9dfba06a6b896621c34a9ba015466d79032"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/e2ab8a0f88198a43c90cef65f1701beaaa98f525", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/e2ab8a0f88198a43c90cef65f1701beaaa98f525", "html_url": "https://github.com/Rust-GCC/gccrs/commit/e2ab8a0f88198a43c90cef65f1701beaaa98f525", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/e2ab8a0f88198a43c90cef65f1701beaaa98f525/comments", "author": null, "committer": {"login": "jwakely", "id": 1254480, "node_id": "MDQ6VXNlcjEyNTQ0ODA=", "avatar_url": "https://avatars.githubusercontent.com/u/1254480?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jwakely", "html_url": "https://github.com/jwakely", "followers_url": "https://api.github.com/users/jwakely/followers", "following_url": "https://api.github.com/users/jwakely/following{/other_user}", "gists_url": "https://api.github.com/users/jwakely/gists{/gist_id}", "starred_url": "https://api.github.com/users/jwakely/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jwakely/subscriptions", "organizations_url": "https://api.github.com/users/jwakely/orgs", "repos_url": "https://api.github.com/users/jwakely/repos", "events_url": "https://api.github.com/users/jwakely/events{/privacy}", "received_events_url": "https://api.github.com/users/jwakely/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "2eb223898126713d0077e44eb78a66f2553557bb", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/2eb223898126713d0077e44eb78a66f2553557bb", "html_url": "https://github.com/Rust-GCC/gccrs/commit/2eb223898126713d0077e44eb78a66f2553557bb"}], "stats": {"total": 37, "additions": 35, "deletions": 2}, "files": [{"sha": "6ffebf1b0fea402e74902e066cbd893796114b1f", "filename": "gcc/cp/ChangeLog", "status": "modified", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/e2ab8a0f88198a43c90cef65f1701beaaa98f525/gcc%2Fcp%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/e2ab8a0f88198a43c90cef65f1701beaaa98f525/gcc%2Fcp%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fcp%2FChangeLog?ref=e2ab8a0f88198a43c90cef65f1701beaaa98f525", "patch": "@@ -1,3 +1,8 @@\n+2011-07-01  Jonathan Wakely  <jwakely.gcc@gmail.com>\n+\n+\tPR c++/49605\n+\t* init.c (build_delete): Only warn for sfk_deleting_destructor.\n+\n 2011-07-01  Jakub Jelinek  <jakub@redhat.com>\n \n \t* Make-lang.in (cp/decl.o): Depend on pointer-set.h."}, {"sha": "7970b9ac476099bb80d5809117c3e15de3eb117c", "filename": "gcc/cp/init.c", "status": "modified", "additions": 3, "deletions": 2, "changes": 5, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/e2ab8a0f88198a43c90cef65f1701beaaa98f525/gcc%2Fcp%2Finit.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/e2ab8a0f88198a43c90cef65f1701beaaa98f525/gcc%2Fcp%2Finit.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fcp%2Finit.c?ref=e2ab8a0f88198a43c90cef65f1701beaaa98f525", "patch": "@@ -3467,8 +3467,9 @@ build_delete (tree type, tree addr, special_function_kind auto_delete,\n \t\t}\n \t      complete_p = false;\n \t    }\n-\t  else if (warn_delnonvdtor && MAYBE_CLASS_TYPE_P (type)\n-\t\t   && !CLASSTYPE_FINAL (type) && TYPE_POLYMORPHIC_P (type))\n+\t  else if (auto_delete == sfk_deleting_destructor && warn_delnonvdtor\n+\t           && MAYBE_CLASS_TYPE_P (type) && !CLASSTYPE_FINAL (type)\n+\t\t   && TYPE_POLYMORPHIC_P (type))\n \t    {\n \t      tree dtor;\n \t      dtor = CLASSTYPE_DESTRUCTORS (type);"}, {"sha": "5d44545dd845b3e9b01924ec5715bcc0b07bd9e7", "filename": "gcc/testsuite/ChangeLog", "status": "modified", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/e2ab8a0f88198a43c90cef65f1701beaaa98f525/gcc%2Ftestsuite%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/e2ab8a0f88198a43c90cef65f1701beaaa98f525/gcc%2Ftestsuite%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2FChangeLog?ref=e2ab8a0f88198a43c90cef65f1701beaaa98f525", "patch": "@@ -1,3 +1,8 @@\n+2011-07-01  Jonathan Wakely  <jwakely.gcc@gmail.com>\n+\n+\tPR c++/49605\n+\t* g++.dg/warn/delete-non-virtual-dtor.C: Adjust.\n+\n 2011-07-01  Jason Merrill  <jason@redhat.com>\n \n \tPR c++/48261"}, {"sha": "c4acbde26a1cd07a740216988b19163d1bd038d2", "filename": "gcc/testsuite/g++.dg/warn/delete-non-virtual-dtor.C", "status": "modified", "additions": 22, "deletions": 0, "changes": 22, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/e2ab8a0f88198a43c90cef65f1701beaaa98f525/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Fwarn%2Fdelete-non-virtual-dtor.C", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/e2ab8a0f88198a43c90cef65f1701beaaa98f525/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Fwarn%2Fdelete-non-virtual-dtor.C", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Fwarn%2Fdelete-non-virtual-dtor.C?ref=e2ab8a0f88198a43c90cef65f1701beaaa98f525", "patch": "@@ -5,6 +5,7 @@ struct polyBase { virtual void f(); };\n \n void f(polyBase* p, polyBase* arr)\n {\n+  polyBase pb;\n   delete p;      // { dg-warning \"non-virtual destructor might\" }\n   delete [] arr;\n }\n@@ -13,6 +14,7 @@ struct polyDerived : polyBase { };\n \n void f(polyDerived* p, polyDerived* arr)\n {\n+  polyDerived pd;\n   delete p;      // { dg-warning \"non-virtual destructor might\" }\n   delete [] arr;\n }\n@@ -29,6 +31,7 @@ struct finalDerived final : polyBase { };\n \n void f(finalDerived* p, finalDerived* arr)\n {\n+  finalDerived fd;\n   delete p;      // no error for final classes\n   delete [] arr;\n }\n@@ -38,7 +41,26 @@ struct safeDerived : safeBase { virtual void f(); };\n \n void f(safeDerived* p, safeDerived* arr)\n {\n+  safeDerived sd;\n   delete p;      // no error because base has virtual dtor\n   delete [] arr;\n }\n \n+struct polyBaseNonTrivial { ~polyBaseNonTrivial(); virtual void f(); };\n+\n+void f(polyBaseNonTrivial* p, polyBaseNonTrivial* arr)\n+{\n+  polyBaseNonTrivial pbnt;\n+  delete p;      // { dg-warning \"non-virtual destructor might\" }\n+  delete [] arr;\n+}\n+\n+struct polyDerivedNT : polyBaseNonTrivial { ~polyDerivedNT(); };\n+\n+void f(polyDerivedNT* p, polyDerivedNT* arr)\n+{\n+  polyDerivedNT pdnt;\n+  delete p;      // { dg-warning \"non-virtual destructor might\" }\n+  delete [] arr;\n+}\n+"}]}