{"sha": "90908af3f8648567f1027260d38e5979e45066a3", "node_id": "C_kwDOANBUbNoAKDkwOTA4YWYzZjg2NDg1NjdmMTAyNzI2MGQzOGU1OTc5ZTQ1MDY2YTM", "commit": {"author": {"name": "Piotr Trojanek", "email": "trojanek@adacore.com", "date": "2022-10-14T10:17:30Z"}, "committer": {"name": "Marc Poulhi\u00e8s", "email": "poulhies@adacore.com", "date": "2022-11-07T08:36:33Z"}, "message": "ada: Clean up unnecessary nesting in code for DLL libraries\n\nCode cleanup; issue spotted while examining routines with No_ prefix.\n\ngcc/ada/\n\n\t* mdll.ads (Build_Import_Library): Fix grammar in comment.\n\t* mdll.adb (Build_Import_Library): Directly execute code of a\n\tnested routine; rename No_Lib_Prefix to Strip_Lib_Prefix.", "tree": {"sha": "f6db4604689e626deee493d63b3a7e6bce215300", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/f6db4604689e626deee493d63b3a7e6bce215300"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/90908af3f8648567f1027260d38e5979e45066a3", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/90908af3f8648567f1027260d38e5979e45066a3", "html_url": "https://github.com/Rust-GCC/gccrs/commit/90908af3f8648567f1027260d38e5979e45066a3", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/90908af3f8648567f1027260d38e5979e45066a3/comments", "author": {"login": "ptroja", "id": 161602, "node_id": "MDQ6VXNlcjE2MTYwMg==", "avatar_url": "https://avatars.githubusercontent.com/u/161602?v=4", "gravatar_id": "", "url": "https://api.github.com/users/ptroja", "html_url": "https://github.com/ptroja", "followers_url": "https://api.github.com/users/ptroja/followers", "following_url": "https://api.github.com/users/ptroja/following{/other_user}", "gists_url": "https://api.github.com/users/ptroja/gists{/gist_id}", "starred_url": "https://api.github.com/users/ptroja/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/ptroja/subscriptions", "organizations_url": "https://api.github.com/users/ptroja/orgs", "repos_url": "https://api.github.com/users/ptroja/repos", "events_url": "https://api.github.com/users/ptroja/events{/privacy}", "received_events_url": "https://api.github.com/users/ptroja/received_events", "type": "User", "site_admin": false}, "committer": {"login": "dkm", "id": 87603, "node_id": "MDQ6VXNlcjg3NjAz", "avatar_url": "https://avatars.githubusercontent.com/u/87603?v=4", "gravatar_id": "", "url": "https://api.github.com/users/dkm", "html_url": "https://github.com/dkm", "followers_url": "https://api.github.com/users/dkm/followers", "following_url": "https://api.github.com/users/dkm/following{/other_user}", "gists_url": "https://api.github.com/users/dkm/gists{/gist_id}", "starred_url": "https://api.github.com/users/dkm/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/dkm/subscriptions", "organizations_url": "https://api.github.com/users/dkm/orgs", "repos_url": "https://api.github.com/users/dkm/repos", "events_url": "https://api.github.com/users/dkm/events{/privacy}", "received_events_url": "https://api.github.com/users/dkm/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "981848b598c8a35a76c7fc226ac07852d9061f43", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/981848b598c8a35a76c7fc226ac07852d9061f43", "html_url": "https://github.com/Rust-GCC/gccrs/commit/981848b598c8a35a76c7fc226ac07852d9061f43"}], "stats": {"total": 72, "additions": 28, "deletions": 44}, "files": [{"sha": "88f8f96927c116664c1d296e315c65afe0908ede", "filename": "gcc/ada/mdll.adb", "status": "modified", "additions": 26, "deletions": 42, "changes": 68, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/90908af3f8648567f1027260d38e5979e45066a3/gcc%2Fada%2Fmdll.adb", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/90908af3f8648567f1027260d38e5979e45066a3/gcc%2Fada%2Fmdll.adb", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fada%2Fmdll.adb?ref=90908af3f8648567f1027260d38e5979e45066a3", "patch": "@@ -448,57 +448,41 @@ package body MDLL is\n      (Lib_Filename : String;\n       Def_Filename : String)\n    is\n-      procedure Build_Import_Library (Lib_Filename : String);\n-      --  Build an import library. This is to build only a .a library to link\n-      --  against a DLL.\n+      function Strip_Lib_Prefix (Filename : String) return String;\n+      --  Return Filename without the lib prefix if present\n \n-      --------------------------\n-      -- Build_Import_Library --\n-      --------------------------\n-\n-      procedure Build_Import_Library (Lib_Filename : String) is\n-\n-         function No_Lib_Prefix (Filename : String) return String;\n-         --  Return Filename without the lib prefix if present\n-\n-         -------------------\n-         -- No_Lib_Prefix --\n-         -------------------\n-\n-         function No_Lib_Prefix (Filename : String) return String is\n-         begin\n-            if Filename (Filename'First .. Filename'First + 2) = \"lib\" then\n-               return Filename (Filename'First + 3 .. Filename'Last);\n-            else\n-               return Filename;\n-            end if;\n-         end No_Lib_Prefix;\n-\n-         --  Local variables\n-\n-         Def_File      : String renames Def_Filename;\n-         Dll_File      : constant String := Get_Dll_Name (Lib_Filename);\n-         Base_Filename : constant String :=\n-                           MDLL.Fil.Ext_To (No_Lib_Prefix (Lib_Filename));\n-         Lib_File      : constant String := \"lib\" & Base_Filename & \".dll.a\";\n-\n-      --  Start of processing for Build_Import_Library\n+      ----------------------\n+      -- Strip_Lib_Prefix --\n+      ----------------------\n \n+      function Strip_Lib_Prefix (Filename : String) return String is\n       begin\n-         if not Quiet then\n-            Text_IO.Put_Line (\"Building import library...\");\n-            Text_IO.Put_Line\n-              (\"make \" & Lib_File & \" to use dynamic library \" & Dll_File);\n+         if Filename (Filename'First .. Filename'First + 2) = \"lib\" then\n+            return Filename (Filename'First + 3 .. Filename'Last);\n+         else\n+            return Filename;\n          end if;\n+      end Strip_Lib_Prefix;\n \n-         Utl.Dlltool\n-           (Def_File, Dll_File, Lib_File, Build_Import => True);\n-      end Build_Import_Library;\n+      --  Local variables\n+\n+      Def_File      : String renames Def_Filename;\n+      Dll_File      : constant String := Get_Dll_Name (Lib_Filename);\n+      Base_Filename : constant String :=\n+                        MDLL.Fil.Ext_To (Strip_Lib_Prefix (Lib_Filename));\n+      Lib_File      : constant String := \"lib\" & Base_Filename & \".dll.a\";\n \n    --  Start of processing for Build_Import_Library\n \n    begin\n-      Build_Import_Library (Lib_Filename);\n+      if not Quiet then\n+         Text_IO.Put_Line (\"Building import library...\");\n+         Text_IO.Put_Line\n+           (\"make \" & Lib_File & \" to use dynamic library \" & Dll_File);\n+      end if;\n+\n+      Utl.Dlltool\n+        (Def_File, Dll_File, Lib_File, Build_Import => True);\n    end Build_Import_Library;\n \n    ------------------"}, {"sha": "9f080c0cafe6268eaa3dcbbc905ad84a3b47669b", "filename": "gcc/ada/mdll.ads", "status": "modified", "additions": 2, "deletions": 2, "changes": 4, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/90908af3f8648567f1027260d38e5979e45066a3/gcc%2Fada%2Fmdll.ads", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/90908af3f8648567f1027260d38e5979e45066a3/gcc%2Fada%2Fmdll.ads", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fada%2Fmdll.ads?ref=90908af3f8648567f1027260d38e5979e45066a3", "patch": "@@ -74,7 +74,7 @@ package MDLL is\n    procedure Build_Import_Library\n      (Lib_Filename : String;\n       Def_Filename : String);\n-   --  Build an import library (.a) from a definition files. An import library\n-   --  is needed to link against a DLL.\n+   --  Build an import library (.a) from definition files. An import library is\n+   --  needed to link against a DLL.\n \n end MDLL;"}]}