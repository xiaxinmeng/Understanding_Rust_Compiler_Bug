{"sha": "931c8e9a04bd7cb7c8f372a77e8061c46b19a742", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6OTMxYzhlOWEwNGJkN2NiN2M4ZjM3MmE3N2U4MDYxYzQ2YjE5YTc0Mg==", "commit": {"author": {"name": "Jan Hubicka", "email": "hubicka@ucw.cz", "date": "2015-03-27T15:13:54Z"}, "committer": {"name": "Jan Hubicka", "email": "hubicka@gcc.gnu.org", "date": "2015-03-27T15:13:54Z"}, "message": "re PR ipa/65600 (bost testsuite failure: ICE: Segmentation fault)\n\n\n\tPR ipa/65600\n\t* cgraph.c (cgraph_update_edges_for_call_stmt_node): Fix the case\n\tof optimized out indirect call.\n\t(redirect_to_unreachable): Always build symbol table node for\n\tBUILT_IN_UNREACHABLE\n\t* g++.dg/torture/pr65600.C: New testcase.\n\nFrom-SVN: r221735", "tree": {"sha": "4730bf114427a89a09662f96bb28dfa1992ea3bf", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/4730bf114427a89a09662f96bb28dfa1992ea3bf"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/931c8e9a04bd7cb7c8f372a77e8061c46b19a742", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/931c8e9a04bd7cb7c8f372a77e8061c46b19a742", "html_url": "https://github.com/Rust-GCC/gccrs/commit/931c8e9a04bd7cb7c8f372a77e8061c46b19a742", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/931c8e9a04bd7cb7c8f372a77e8061c46b19a742/comments", "author": null, "committer": null, "parents": [{"sha": "d81c5030d1ca9920bc41de91819cef17c83a8805", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/d81c5030d1ca9920bc41de91819cef17c83a8805", "html_url": "https://github.com/Rust-GCC/gccrs/commit/d81c5030d1ca9920bc41de91819cef17c83a8805"}], "stats": {"total": 53, "additions": 47, "deletions": 6}, "files": [{"sha": "0f0a6f5a83e725510c4833f177b66eb74df907f9", "filename": "gcc/ChangeLog", "status": "modified", "additions": 8, "deletions": 0, "changes": 8, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/931c8e9a04bd7cb7c8f372a77e8061c46b19a742/gcc%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/931c8e9a04bd7cb7c8f372a77e8061c46b19a742/gcc%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2FChangeLog?ref=931c8e9a04bd7cb7c8f372a77e8061c46b19a742", "patch": "@@ -1,3 +1,11 @@\n+2015-03-27  Jan Hubicka  <hubicka@ucw.cz>\n+\n+\tPR ipa/65600\n+\t* cgraph.c (cgraph_update_edges_for_call_stmt_node): Fix the case\n+\tof optimized out indirect call.\n+\t(redirect_to_unreachable): Always build symbol table node for\n+\tBUILT_IN_UNREACHABLE\n+\n 2015-03-27  Vladimir Makarov  <vmakarov@redhat.com>\n \n \tPR target/65407"}, {"sha": "85531c8d0b6d4fa3c3f8abe016e09bb3ff8cec3f", "filename": "gcc/cgraph.c", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/931c8e9a04bd7cb7c8f372a77e8061c46b19a742/gcc%2Fcgraph.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/931c8e9a04bd7cb7c8f372a77e8061c46b19a742/gcc%2Fcgraph.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fcgraph.c?ref=931c8e9a04bd7cb7c8f372a77e8061c46b19a742", "patch": "@@ -1516,7 +1516,7 @@ cgraph_update_edges_for_call_stmt_node (cgraph_node *node,\n       if (e)\n \t{\n \t  /* Keep calls marked as dead dead.  */\n-\t  if (new_call && e->callee\n+\t  if (new_stmt && is_gimple_call (new_stmt) && e->callee\n \t      && DECL_BUILT_IN_CLASS (e->callee->decl) == BUILT_IN_NORMAL\n \t      && DECL_FUNCTION_CODE (e->callee->decl) == BUILT_IN_UNREACHABLE)\n \t    {"}, {"sha": "2f4eb9fd6f2337815265ab4b1988346f4a0eac01", "filename": "gcc/ipa-inline-analysis.c", "status": "modified", "additions": 5, "deletions": 5, "changes": 10, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/931c8e9a04bd7cb7c8f372a77e8061c46b19a742/gcc%2Fipa-inline-analysis.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/931c8e9a04bd7cb7c8f372a77e8061c46b19a742/gcc%2Fipa-inline-analysis.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fipa-inline-analysis.c?ref=931c8e9a04bd7cb7c8f372a77e8061c46b19a742", "patch": "@@ -766,15 +766,15 @@ static struct cgraph_edge *\n redirect_to_unreachable (struct cgraph_edge *e)\n {\n   struct cgraph_node *callee = !e->inline_failed ? e->callee : NULL;\n+  struct cgraph_node *target = cgraph_node::get_create\n+\t\t      (builtin_decl_implicit (BUILT_IN_UNREACHABLE));\n \n   if (e->speculative)\n-    e = e->resolve_speculation (builtin_decl_implicit (BUILT_IN_UNREACHABLE));\n+    e = e->resolve_speculation (target->decl);\n   else if (!e->callee)\n-    e->make_direct (cgraph_node::get_create\n-\t\t      (builtin_decl_implicit (BUILT_IN_UNREACHABLE)));\n+    e->make_direct (target);\n   else\n-    e->redirect_callee (cgraph_node::get_create\n-\t\t\t(builtin_decl_implicit (BUILT_IN_UNREACHABLE)));\n+    e->redirect_callee (target);\n   struct inline_edge_summary *es = inline_edge_summary (e);\n   e->inline_failed = CIF_UNREACHABLE;\n   e->frequency = 0;"}, {"sha": "c1adea5ff192cce0fc8c34fac86ff9ba826e5ff0", "filename": "gcc/testsuite/ChangeLog", "status": "modified", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/931c8e9a04bd7cb7c8f372a77e8061c46b19a742/gcc%2Ftestsuite%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/931c8e9a04bd7cb7c8f372a77e8061c46b19a742/gcc%2Ftestsuite%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2FChangeLog?ref=931c8e9a04bd7cb7c8f372a77e8061c46b19a742", "patch": "@@ -1,3 +1,8 @@\n+2015-03-27  Jan Hubicka  <hubicka@ucw.cz>\n+\n+\tPR ipa/65600\n+\t* g++.dg/torture/pr65600.C: New testcase.\n+\n 2015-03-27  Vladimir Makarov  <vmakarov@redhat.com>\n \n \tPR target/65407"}, {"sha": "2ee5a4bf551bf435ca7cedfa20e2fbcbafed1991", "filename": "gcc/testsuite/g++.dg/torture/pr65600.C", "status": "added", "additions": 28, "deletions": 0, "changes": 28, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/931c8e9a04bd7cb7c8f372a77e8061c46b19a742/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Ftorture%2Fpr65600.C", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/931c8e9a04bd7cb7c8f372a77e8061c46b19a742/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Ftorture%2Fpr65600.C", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Ftorture%2Fpr65600.C?ref=931c8e9a04bd7cb7c8f372a77e8061c46b19a742", "patch": "@@ -0,0 +1,28 @@\n+// { dg-do compile }\n+// { dg-options \"-std=c++11\" }\n+class A {\n+public:\n+  virtual void m_fn1() {}\n+  int weak_release___trans_tmp_1;\n+  void m_fn2() {\n+    __asm__(\"\\n\\n\\n\\n\");\n+    if (weak_release___trans_tmp_1)\n+      m_fn1();\n+  }\n+};\n+class weak_count {\n+  A *pi_;\n+\n+public:\n+  weak_count() : pi_() {}\n+  ~weak_count() {\n+    if (pi_)\n+      pi_->m_fn2();\n+  }\n+};\n+class B {\n+  weak_count pn;\n+};\n+int\n+main() { B a; }\n+"}]}