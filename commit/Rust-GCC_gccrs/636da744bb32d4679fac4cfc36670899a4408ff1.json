{"sha": "636da744bb32d4679fac4cfc36670899a4408ff1", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6NjM2ZGE3NDRiYjMyZDQ2NzlmYWM0Y2ZjMzY2NzA4OTlhNDQwOGZmMQ==", "commit": {"author": {"name": "Paul Thomas", "email": "pault@gcc.gnu.org", "date": "2006-05-07T05:46:26Z"}, "committer": {"name": "Paul Thomas", "email": "pault@gcc.gnu.org", "date": "2006-05-07T05:46:26Z"}, "message": "re PR fortran/24813 (ICE with scalarization LEN of character types)\n\n2006-05-07  Paul Thomas  <pault@gcc.gnu.org>\n\n\tPR fortran/24813\n\t* trans-array.c (get_array_ctor_strlen): Remove static attribute.\n\t* trans.h: Add prototype for get_array_ctor_strlen.\n\t* trans-intrinsic.c (gfc_conv_intrinsic_len): Switch on EXPR_ARRAY\n\tand call get_array_ctor_strlen.\n\n2006-05-07  Paul Thomas  <pault@gcc.gnu.org>\n\n\tPR fortran/24813\n\t* gfortran.dg/char_cons_len_1.f90: New test.\n\nFrom-SVN: r113594", "tree": {"sha": "bf7e4cc8a301ceceaa53277106c44b7e8f95534e", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/bf7e4cc8a301ceceaa53277106c44b7e8f95534e"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/636da744bb32d4679fac4cfc36670899a4408ff1", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/636da744bb32d4679fac4cfc36670899a4408ff1", "html_url": "https://github.com/Rust-GCC/gccrs/commit/636da744bb32d4679fac4cfc36670899a4408ff1", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/636da744bb32d4679fac4cfc36670899a4408ff1/comments", "author": null, "committer": null, "parents": [{"sha": "8f9886536fb02c6711e4cc8be068e3938f3a4775", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/8f9886536fb02c6711e4cc8be068e3938f3a4775", "html_url": "https://github.com/Rust-GCC/gccrs/commit/8f9886536fb02c6711e4cc8be068e3938f3a4775"}], "stats": {"total": 42, "additions": 41, "deletions": 1}, "files": [{"sha": "cd09edaf69615bf52f6986ca9f710ed34205b4b7", "filename": "gcc/fortran/ChangeLog", "status": "modified", "additions": 8, "deletions": 0, "changes": 8, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/636da744bb32d4679fac4cfc36670899a4408ff1/gcc%2Ffortran%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/636da744bb32d4679fac4cfc36670899a4408ff1/gcc%2Ffortran%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ffortran%2FChangeLog?ref=636da744bb32d4679fac4cfc36670899a4408ff1", "patch": "@@ -1,3 +1,11 @@\n+2006-05-07  Paul Thomas  <pault@gcc.gnu.org>\n+\n+\tPR fortran/24813\n+\t* trans-array.c (get_array_ctor_strlen): Remove static attribute.\n+\t* trans.h: Add prototype for get_array_ctor_strlen.\n+\t* trans-intrinsic.c (gfc_conv_intrinsic_len): Switch on EXPR_ARRAY\n+\tand call get_array_ctor_strlen.\n+\n 2006-05-05  Steven G. Kargl  <kargls@comcast.net>\n \n \t* invoke.texi: Update description of -fall-intrinsics"}, {"sha": "a620bff67f063937cd381db44b93898c5fb4a240", "filename": "gcc/fortran/trans-array.c", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/636da744bb32d4679fac4cfc36670899a4408ff1/gcc%2Ffortran%2Ftrans-array.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/636da744bb32d4679fac4cfc36670899a4408ff1/gcc%2Ffortran%2Ftrans-array.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ffortran%2Ftrans-array.c?ref=636da744bb32d4679fac4cfc36670899a4408ff1", "patch": "@@ -1328,7 +1328,7 @@ get_array_ctor_var_strlen (gfc_expr * expr, tree * len)\n /* Figure out the string length of a character array constructor.\n    Returns TRUE if all elements are character constants.  */\n \n-static bool\n+bool\n get_array_ctor_strlen (gfc_constructor * c, tree * len)\n {\n   bool is_const;"}, {"sha": "eb5286e7a6ae78834d81a96fe77db31f719829ab", "filename": "gcc/fortran/trans-intrinsic.c", "status": "modified", "additions": 7, "deletions": 0, "changes": 7, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/636da744bb32d4679fac4cfc36670899a4408ff1/gcc%2Ffortran%2Ftrans-intrinsic.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/636da744bb32d4679fac4cfc36670899a4408ff1/gcc%2Ffortran%2Ftrans-intrinsic.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ffortran%2Ftrans-intrinsic.c?ref=636da744bb32d4679fac4cfc36670899a4408ff1", "patch": "@@ -2258,6 +2258,13 @@ gfc_conv_intrinsic_len (gfc_se * se, gfc_expr * expr)\n       len = build_int_cst (NULL_TREE, arg->value.character.length);\n       break;\n \n+    case EXPR_ARRAY:\n+      /* Obtain the string length from the function used by\n+         trans-array.c(gfc_trans_array_constructor).  */\n+      len = NULL_TREE;\n+      get_array_ctor_strlen (arg->value.constructor, &len);\n+      break;\n+\n     default:\n \tif (arg->expr_type == EXPR_VARIABLE\n \t    && (arg->ref == NULL || (arg->ref->next == NULL"}, {"sha": "78a5d156103b0f10b8aa770d3a9aa808ede781cc", "filename": "gcc/fortran/trans.h", "status": "modified", "additions": 3, "deletions": 0, "changes": 3, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/636da744bb32d4679fac4cfc36670899a4408ff1/gcc%2Ffortran%2Ftrans.h", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/636da744bb32d4679fac4cfc36670899a4408ff1/gcc%2Ffortran%2Ftrans.h", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ffortran%2Ftrans.h?ref=636da744bb32d4679fac4cfc36670899a4408ff1", "patch": "@@ -419,6 +419,9 @@ void gfc_get_backend_locus (locus *);\n extern GTY(()) tree gfc_static_ctors;\n void gfc_generate_constructors (void);\n \n+/* Get the string length of an array constructor.  */\n+bool get_array_ctor_strlen (gfc_constructor *, tree *);\n+\n /* Generate a runtime error check.  */\n void gfc_trans_runtime_check (tree, tree, stmtblock_t *);\n "}, {"sha": "d289aee418a61b0557d29ceb32668bcc95e299a7", "filename": "gcc/testsuite/ChangeLog", "status": "modified", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/636da744bb32d4679fac4cfc36670899a4408ff1/gcc%2Ftestsuite%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/636da744bb32d4679fac4cfc36670899a4408ff1/gcc%2Ftestsuite%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2FChangeLog?ref=636da744bb32d4679fac4cfc36670899a4408ff1", "patch": "@@ -1,3 +1,8 @@\n+2006-05-07  Paul Thomas  <pault@gcc.gnu.org>\n+\n+\tPR fortran/24813\n+\t* gfortran.dg/char_cons_len_1.f90: New test.\n+\n 2006-05-06  Volker Reichelt  <reichelt@igpm.rwth-aachen.de>\n \n \tPR c++/27427"}, {"sha": "e50d7532d93441330a3ed6ad5e8a3f1f5f97ef49", "filename": "gcc/testsuite/gfortran.dg/char_cons_len.f90", "status": "added", "additions": 17, "deletions": 0, "changes": 17, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/636da744bb32d4679fac4cfc36670899a4408ff1/gcc%2Ftestsuite%2Fgfortran.dg%2Fchar_cons_len.f90", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/636da744bb32d4679fac4cfc36670899a4408ff1/gcc%2Ftestsuite%2Fgfortran.dg%2Fchar_cons_len.f90", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgfortran.dg%2Fchar_cons_len.f90?ref=636da744bb32d4679fac4cfc36670899a4408ff1", "patch": "@@ -0,0 +1,17 @@\n+! { dg-do compile }\n+! Tests the fix for PR24813 in which a character array\n+! constructor, as an argument for LEN, would cause an ICE.\n+!\n+  character(11) :: chr1, chr2\n+  i = len ((/chr1, chr2, \"ggg\"/))\n+  j = len ((/\"abcdefghijk\", chr1, chr2/))\n+  k = len ((/'hello  ','goodbye'/))\n+  l = foo (\"yes siree, Bob\")\n+  if (any ((/11,11,7,14/) /= (/i,j,k,l/))) call abort ()\n+contains\n+  integer function foo (arg)\n+    character(*) :: arg\n+    character(len(arg)) :: ctor\n+    foo = len ((/ctor/))\n+  end function foo\n+end"}]}