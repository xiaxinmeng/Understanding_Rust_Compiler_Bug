{"sha": "641da50a0c73f734e672f8e6b9e7d2c86bde840d", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6NjQxZGE1MGEwYzczZjczNGU2NzJmOGU2YjllN2QyYzg2YmRlODQwZA==", "commit": {"author": {"name": "Nathan Sidwell", "email": "nathan@acm.org", "date": "2017-05-09T11:17:45Z"}, "committer": {"name": "Nathan Sidwell", "email": "nathan@gcc.gnu.org", "date": "2017-05-09T11:17:45Z"}, "message": "c-tree.h (pushdecl): Declare.\n\n\tgcc/c/\n\t* c-tree.h (pushdecl): Declare.\n\tgcc/cp/\n\t* cp-lang.c (get_global_decls, cxx_pushdecl): New.\n\t(LANG_HOOKS_GETDECLS, LANG_HOOKS_PUSHDECL): Override.\n\t* name-lookup.h (pushdecl_top_level): Declare.\n\tgcc/c-family/\n\t* c-common.c (c_register_builtin_type): Use pushdecl lang_hook.\n\t* c-common.h (pushdecl_top_level, pushdecl): Don't declare here.\n\tgcc/objc/\n\t* objc-gnu-runtime-abi-01.c (objc_add_static_instance): Use\n\tpushdecl lang_hook.\n\nFrom-SVN: r247785", "tree": {"sha": "50f0386875fa98e4952321dcf3a16862b140cb74", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/50f0386875fa98e4952321dcf3a16862b140cb74"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/641da50a0c73f734e672f8e6b9e7d2c86bde840d", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/641da50a0c73f734e672f8e6b9e7d2c86bde840d", "html_url": "https://github.com/Rust-GCC/gccrs/commit/641da50a0c73f734e672f8e6b9e7d2c86bde840d", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/641da50a0c73f734e672f8e6b9e7d2c86bde840d/comments", "author": {"login": "urnathan", "id": 13103001, "node_id": "MDQ6VXNlcjEzMTAzMDAx", "avatar_url": "https://avatars.githubusercontent.com/u/13103001?v=4", "gravatar_id": "", "url": "https://api.github.com/users/urnathan", "html_url": "https://github.com/urnathan", "followers_url": "https://api.github.com/users/urnathan/followers", "following_url": "https://api.github.com/users/urnathan/following{/other_user}", "gists_url": "https://api.github.com/users/urnathan/gists{/gist_id}", "starred_url": "https://api.github.com/users/urnathan/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/urnathan/subscriptions", "organizations_url": "https://api.github.com/users/urnathan/orgs", "repos_url": "https://api.github.com/users/urnathan/repos", "events_url": "https://api.github.com/users/urnathan/events{/privacy}", "received_events_url": "https://api.github.com/users/urnathan/received_events", "type": "User", "site_admin": false}, "committer": null, "parents": [{"sha": "40abbbea6659b07309e39355d06792dd7db13884", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/40abbbea6659b07309e39355d06792dd7db13884", "html_url": "https://github.com/Rust-GCC/gccrs/commit/40abbbea6659b07309e39355d06792dd7db13884"}], "stats": {"total": 54, "additions": 49, "deletions": 5}, "files": [{"sha": "6409442060b530bd86ba5efd90bdb2c216edeea3", "filename": "gcc/c-family/ChangeLog", "status": "modified", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/641da50a0c73f734e672f8e6b9e7d2c86bde840d/gcc%2Fc-family%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/641da50a0c73f734e672f8e6b9e7d2c86bde840d/gcc%2Fc-family%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fc-family%2FChangeLog?ref=641da50a0c73f734e672f8e6b9e7d2c86bde840d", "patch": "@@ -1,3 +1,8 @@\n+2017-05-09  Nathan Sidwell  <nathan@acm.org>\n+\n+\t* c-common.c (c_register_builtin_type): Use pushdecl lang_hook.\n+\t* c-common.h (pushdecl_top_level, pushdecl): Don't declare here.\n+\n 2017-05-08  Martin Sebor  <msebor@redhat.com>\n \n \tPR translation/80280"}, {"sha": "ad686d2d6bab2960d57f002eaf3af689c8908a3b", "filename": "gcc/c-family/c-common.c", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/641da50a0c73f734e672f8e6b9e7d2c86bde840d/gcc%2Fc-family%2Fc-common.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/641da50a0c73f734e672f8e6b9e7d2c86bde840d/gcc%2Fc-family%2Fc-common.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fc-family%2Fc-common.c?ref=641da50a0c73f734e672f8e6b9e7d2c86bde840d", "patch": "@@ -2589,7 +2589,7 @@ c_register_builtin_type (tree type, const char* name)\n   DECL_ARTIFICIAL (decl) = 1;\n   if (!TYPE_NAME (type))\n     TYPE_NAME (type) = decl;\n-  pushdecl (decl);\n+  lang_hooks.decls.pushdecl (decl);\n \n   registered_builtin_types = tree_cons (0, type, registered_builtin_types);\n }"}, {"sha": "9e3982d1ce8feafb230c4c23b381e8bd940e710c", "filename": "gcc/c-family/c-common.h", "status": "modified", "additions": 1, "deletions": 2, "changes": 3, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/641da50a0c73f734e672f8e6b9e7d2c86bde840d/gcc%2Fc-family%2Fc-common.h", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/641da50a0c73f734e672f8e6b9e7d2c86bde840d/gcc%2Fc-family%2Fc-common.h", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fc-family%2Fc-common.h?ref=641da50a0c73f734e672f8e6b9e7d2c86bde840d", "patch": "@@ -588,8 +588,7 @@ extern tree push_stmt_list (void);\n extern tree pop_stmt_list (tree);\n extern tree add_stmt (tree);\n extern void push_cleanup (tree, tree, bool);\n-extern tree pushdecl_top_level (tree);\n-extern tree pushdecl (tree);\n+\n extern tree build_modify_expr (location_t, tree, tree, enum tree_code,\n \t\t\t       location_t, tree, tree);\n extern tree build_array_notation_expr (location_t, tree, tree, enum tree_code,"}, {"sha": "5d6c6ef2ff2c375eeecb1cef2db262b8ddd2ffdd", "filename": "gcc/c/ChangeLog", "status": "modified", "additions": 4, "deletions": 0, "changes": 4, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/641da50a0c73f734e672f8e6b9e7d2c86bde840d/gcc%2Fc%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/641da50a0c73f734e672f8e6b9e7d2c86bde840d/gcc%2Fc%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fc%2FChangeLog?ref=641da50a0c73f734e672f8e6b9e7d2c86bde840d", "patch": "@@ -1,3 +1,7 @@\n+2017-05-09  Nathan Sidwell  <nathan@acm.org>\n+\n+\t* c-tree.h (pushdecl): Declare.\n+\n 2017-05-05  David Malcolm  <dmalcolm@redhat.com>\n \n \t* c-decl.c (warn_defaults_to): Replace report_diagnostic"}, {"sha": "8d232a4b84c9ec87d16bf644f3b083f5d6d8112c", "filename": "gcc/c/c-tree.h", "status": "modified", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/641da50a0c73f734e672f8e6b9e7d2c86bde840d/gcc%2Fc%2Fc-tree.h", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/641da50a0c73f734e672f8e6b9e7d2c86bde840d/gcc%2Fc%2Fc-tree.h", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fc%2Fc-tree.h?ref=641da50a0c73f734e672f8e6b9e7d2c86bde840d", "patch": "@@ -506,6 +506,7 @@ extern tree c_break_label;\n extern tree c_cont_label;\n \n extern bool global_bindings_p (void);\n+extern tree pushdecl (tree);\n extern void push_scope (void);\n extern tree pop_scope (void);\n extern void c_bindings_start_stmt_expr (struct c_spot_bindings *);"}, {"sha": "c4b850f5186002cab8073c6688fdc5e1ae100b40", "filename": "gcc/cp/ChangeLog", "status": "modified", "additions": 7, "deletions": 1, "changes": 8, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/641da50a0c73f734e672f8e6b9e7d2c86bde840d/gcc%2Fcp%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/641da50a0c73f734e672f8e6b9e7d2c86bde840d/gcc%2Fcp%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fcp%2FChangeLog?ref=641da50a0c73f734e672f8e6b9e7d2c86bde840d", "patch": "@@ -1,3 +1,9 @@\n+2017-05-09  Nathan Sidwell  <nathan@acm.org>\n+\n+\t* cp-lang.c (get_global_decls, cxx_pushdecl): New.\n+\t(LANG_HOOKS_GETDECLS, LANG_HOOKS_PUSHDECL): Override.\n+\t* name-lookup.h (pushdecl_top_level): Declare.\n+\n 2017-05-08  Jason Merrill  <jason@redhat.com>\n \n \tPR c++/80178 - parameter passing for uncopyable classes\n@@ -10,7 +16,7 @@\n \n 2017-05-08  Nathan Sidwell  <nathan@acm.org>\n \n-\t* decl.c (builtin_function_1): Set DCL_ANTICIPATED before pushing.\n+\t* decl.c (builtin_function_1): Set DECL_ANTICIPATED before pushing.\n \t(start_preparsed_function): Do decl pushing before setting\n \tcurrent_funciton_decl and announcing it.\n "}, {"sha": "b5f11e390fbe6915cffc6469427f4e2738b9fa31", "filename": "gcc/cp/cp-lang.c", "status": "modified", "additions": 22, "deletions": 0, "changes": 22, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/641da50a0c73f734e672f8e6b9e7d2c86bde840d/gcc%2Fcp%2Fcp-lang.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/641da50a0c73f734e672f8e6b9e7d2c86bde840d/gcc%2Fcp%2Fcp-lang.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fcp%2Fcp-lang.c?ref=641da50a0c73f734e672f8e6b9e7d2c86bde840d", "patch": "@@ -35,6 +35,8 @@ static tree cp_eh_personality (void);\n static tree get_template_innermost_arguments_folded (const_tree);\n static tree get_template_argument_pack_elems_folded (const_tree);\n static tree cxx_enum_underlying_base_type (const_tree);\n+static tree get_global_decls ();\n+static tree cxx_pushdecl (tree);\n \n /* Lang hooks common to C++ and ObjC++ are declared in cp/cp-objcp-common.h;\n    consequently, there should be very few hooks below.  */\n@@ -78,6 +80,10 @@ static tree cxx_enum_underlying_base_type (const_tree);\n #define LANG_HOOKS_EH_RUNTIME_TYPE build_eh_type_type\n #undef LANG_HOOKS_ENUM_UNDERLYING_BASE_TYPE\n #define LANG_HOOKS_ENUM_UNDERLYING_BASE_TYPE cxx_enum_underlying_base_type\n+#undef LANG_HOOKS_GETDECLS\n+#define LANG_HOOKS_GETDECLS get_global_decls\n+#undef LANG_HOOKS_PUSHDECL\n+#define LANG_HOOKS_PUSHDECL cxx_pushdecl\n \n /* Each front end provides its own lang hook initializer.  */\n struct lang_hooks lang_hooks = LANG_HOOKS_INITIALIZER;\n@@ -229,5 +235,21 @@ tree cxx_enum_underlying_base_type (const_tree type)\n   return underlying_type;\n }\n \n+/* Return the list of decls in the global namespace.  */\n+\n+static tree\n+get_global_decls ()\n+{\n+  return NAMESPACE_LEVEL (global_namespace)->names;\n+}\n+\n+/* Push DECL into the current scope.  */\n+\n+static tree\n+cxx_pushdecl (tree decl)\n+{\n+  return pushdecl (decl);\n+}\n+\n #include \"gt-cp-cp-lang.h\"\n #include \"gtype-cp.h\""}, {"sha": "02e37d7f5af280666852137434a8983832f014c1", "filename": "gcc/cp/name-lookup.h", "status": "modified", "additions": 2, "deletions": 0, "changes": 2, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/641da50a0c73f734e672f8e6b9e7d2c86bde840d/gcc%2Fcp%2Fname-lookup.h", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/641da50a0c73f734e672f8e6b9e7d2c86bde840d/gcc%2Fcp%2Fname-lookup.h", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fcp%2Fname-lookup.h?ref=641da50a0c73f734e672f8e6b9e7d2c86bde840d", "patch": "@@ -342,4 +342,6 @@ extern tree innermost_non_namespace_value (tree);\n extern cxx_binding *outer_binding (tree, cxx_binding *, bool);\n extern void cp_emit_debug_info_for_using (tree, tree);\n \n+extern tree pushdecl_top_level\t\t\t(tree);\n+\n #endif /* GCC_CP_NAME_LOOKUP_H */"}, {"sha": "88ec3b3cd695907c7d4f453c64573caff5a6ac89", "filename": "gcc/objc/ChangeLog", "status": "modified", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/641da50a0c73f734e672f8e6b9e7d2c86bde840d/gcc%2Fobjc%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/641da50a0c73f734e672f8e6b9e7d2c86bde840d/gcc%2Fobjc%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fobjc%2FChangeLog?ref=641da50a0c73f734e672f8e6b9e7d2c86bde840d", "patch": "@@ -1,3 +1,8 @@\n+2017-05-09  Nathan Sidwell  <nathan@acm.org>\n+\n+\t* objc-gnu-runtime-abi-01.c (objc_add_static_instance): Use\n+\tpushdecl lang_hook.\n+\n 2017-05-04  Martin Sebor  <msebor@redhat.com>\n \n \tPR translation/80280"}, {"sha": "d1686e659bdb4f8b12b1796f080b58bcb18a90b6", "filename": "gcc/objc/objc-gnu-runtime-abi-01.c", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/641da50a0c73f734e672f8e6b9e7d2c86bde840d/gcc%2Fobjc%2Fobjc-gnu-runtime-abi-01.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/641da50a0c73f734e672f8e6b9e7d2c86bde840d/gcc%2Fobjc%2Fobjc-gnu-runtime-abi-01.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fobjc%2Fobjc-gnu-runtime-abi-01.c?ref=641da50a0c73f734e672f8e6b9e7d2c86bde840d", "patch": "@@ -888,7 +888,7 @@ objc_add_static_instance (tree constructor, tree class_decl)\n   /* We may be writing something else just now.\n      Postpone till end of input. */\n   DECL_DEFER_OUTPUT (decl) = 1;\n-  pushdecl_top_level (decl);\n+  lang_hooks.decls.pushdecl (decl);\n   rest_of_decl_compilation (decl, 1, 0);\n \n   /* Add the DECL to the head of this CLASS' list.  */"}]}