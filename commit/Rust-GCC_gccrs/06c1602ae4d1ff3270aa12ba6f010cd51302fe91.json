{"sha": "06c1602ae4d1ff3270aa12ba6f010cd51302fe91", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6MDZjMTYwMmFlNGQxZmYzMjcwYWExMmJhNmYwMTBjZDUxMzAyZmU5MQ==", "commit": {"author": {"name": "Segher Boessenkool", "email": "segher@gcc.gnu.org", "date": "2019-03-24T20:26:53Z"}, "committer": {"name": "Segher Boessenkool", "email": "segher@gcc.gnu.org", "date": "2019-03-24T20:26:53Z"}, "message": "rs6000: Make CSE'ing __tls_get_addr calls possible\n\nCSE does not consider calls, not even const calls.  This patch puts a\nREG_EQUAL note on the pseudo we assign the __tls_get_addr result to,\nso that those pseudos can be CSE'd and the extra calls deleted as dead\ncode.\n\nCSE should really handle const calls directly, but it is stage 4.\n\n\n\t* config/rs6000/rs6000.c (rs6000_legitimize_tls_address): Add REG_EQUAL\n\tnotes for the result of the __tls_get_addr calls.\n\t* config/rs6000/rs6000.md (unspec UNSPEC_TLS_GET_ADDR): New.\n\nFrom-SVN: r269902", "tree": {"sha": "f9ec455a6faac629af01a9bab47c4cbf8836633f", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/f9ec455a6faac629af01a9bab47c4cbf8836633f"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/06c1602ae4d1ff3270aa12ba6f010cd51302fe91", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/06c1602ae4d1ff3270aa12ba6f010cd51302fe91", "html_url": "https://github.com/Rust-GCC/gccrs/commit/06c1602ae4d1ff3270aa12ba6f010cd51302fe91", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/06c1602ae4d1ff3270aa12ba6f010cd51302fe91/comments", "author": null, "committer": null, "parents": [{"sha": "38a47a0fc6defeaf3f49ab63aff262ae42dffd89", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/38a47a0fc6defeaf3f49ab63aff262ae42dffd89", "html_url": "https://github.com/Rust-GCC/gccrs/commit/38a47a0fc6defeaf3f49ab63aff262ae42dffd89"}], "stats": {"total": 19, "additions": 18, "deletions": 1}, "files": [{"sha": "8ce3d7cd337b0e82a95a64c2f9c4456e01b66158", "filename": "gcc/ChangeLog", "status": "modified", "additions": 7, "deletions": 1, "changes": 8, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/06c1602ae4d1ff3270aa12ba6f010cd51302fe91/gcc%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/06c1602ae4d1ff3270aa12ba6f010cd51302fe91/gcc%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2FChangeLog?ref=06c1602ae4d1ff3270aa12ba6f010cd51302fe91", "patch": "@@ -1,4 +1,10 @@\n-2019-03-26  Jeff Law  <law@redhat.com>\n+2019-03-24  Segher Boessenkool  <segher@kernel.crashing.org>\n+\n+\t* config/rs6000/rs6000.c (rs6000_legitimize_tls_address): Add REG_EQUAL\n+\tnotes for the result of the __tls_get_addr calls.\n+\t* config/rs6000/rs6000.md (unspec UNSPEC_TLS_GET_ADDR): New.\n+\n+2019-03-24  Jeff Law  <law@redhat.com>\n \n \t* config/bfin/bfin.md (movpdi): Fix length for alternative 1.\n "}, {"sha": "06ce2892bf9a86a7c9e89e07612bbce8018ad38f", "filename": "gcc/config/rs6000/rs6000.c", "status": "modified", "additions": 10, "deletions": 0, "changes": 10, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/06c1602ae4d1ff3270aa12ba6f010cd51302fe91/gcc%2Fconfig%2Frs6000%2Frs6000.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/06c1602ae4d1ff3270aa12ba6f010cd51302fe91/gcc%2Fconfig%2Frs6000%2Frs6000.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fconfig%2Frs6000%2Frs6000.c?ref=06c1602ae4d1ff3270aa12ba6f010cd51302fe91", "patch": "@@ -8785,6 +8785,11 @@ rs6000_legitimize_tls_address (rtx addr, enum tls_model model)\n \t  else\n \t    emit_library_call_value (tga, dest, LCT_CONST, Pmode);\n \t  global_tlsarg = NULL_RTX;\n+\n+\t  /* Make a note so that the result of this call can be CSEd.  */\n+\t  rtvec vec = gen_rtvec (1, copy_rtx (arg));\n+\t  rtx uns = gen_rtx_UNSPEC (Pmode, vec, UNSPEC_TLS_GET_ADDR);\n+\t  set_unique_reg_note (get_last_insn (), REG_EQUAL, uns);\n \t}\n       else if (model == TLS_MODEL_LOCAL_DYNAMIC)\n \t{\n@@ -8803,6 +8808,11 @@ rs6000_legitimize_tls_address (rtx addr, enum tls_model model)\n \t    emit_library_call_value (tga, tmp1, LCT_CONST, Pmode);\n \t  global_tlsarg = NULL_RTX;\n \n+\t  /* Make a note so that the result of this call can be CSEd.  */\n+\t  rtvec vec = gen_rtvec (1, copy_rtx (arg));\n+\t  rtx uns = gen_rtx_UNSPEC (Pmode, vec, UNSPEC_TLS_GET_ADDR);\n+\t  set_unique_reg_note (get_last_insn (), REG_EQUAL, uns);\n+\n \t  if (rs6000_tls_size == 16)\n \t    {\n \t      if (TARGET_64BIT)"}, {"sha": "b8dd85905f36dab2fcb62eed08fe3854c5590919", "filename": "gcc/config/rs6000/rs6000.md", "status": "modified", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/06c1602ae4d1ff3270aa12ba6f010cd51302fe91/gcc%2Fconfig%2Frs6000%2Frs6000.md", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/06c1602ae4d1ff3270aa12ba6f010cd51302fe91/gcc%2Fconfig%2Frs6000%2Frs6000.md", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fconfig%2Frs6000%2Frs6000.md?ref=06c1602ae4d1ff3270aa12ba6f010cd51302fe91", "patch": "@@ -79,6 +79,7 @@\n    UNSPEC_MPIC_CORRECT\t\t; macho_correct_pic\n    UNSPEC_TLSGD\n    UNSPEC_TLSLD\n+   UNSPEC_TLS_GET_ADDR\n    UNSPEC_MOVESI_FROM_CR\n    UNSPEC_MOVESI_TO_CR\n    UNSPEC_TLSDTPREL"}]}