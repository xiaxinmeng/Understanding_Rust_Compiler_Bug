{"sha": "f28c46cdb85172eb0e267b97e7a9d3befac30a2e", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6ZjI4YzQ2Y2RiODUxNzJlYjBlMjY3Yjk3ZTdhOWQzYmVmYWMzMGEyZQ==", "commit": {"author": {"name": "Steven G. Kargl", "email": "kargl@gcc.gnu.org", "date": "2019-01-25T17:55:25Z"}, "committer": {"name": "Steven G. Kargl", "email": "kargl@gcc.gnu.org", "date": "2019-01-25T17:55:25Z"}, "message": "re PR fortran/85780 (ICE in resolve_fl_procedure, at fortran/resolve.c:12504)\n\n2019-01-25  Steven G. Kargl  <kargl@gcc.gnu.org>\n\n\tPR fortran/85780\n\t* decl.c (gfc_match_subroutine): Check for conflict between BIND(C)\n\tand alternative return.\n\n2019-01-25  Steven G. Kargl  <kargl@gcc.gnu.org>\n\n\tPR fortran/85780\n\t* gfortran.dg/pr85780.f90: Update testcase for error message.\n\nFrom-SVN: r268277", "tree": {"sha": "2242dbbebcc8ad8d6a1410458a54359107bf39f0", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/2242dbbebcc8ad8d6a1410458a54359107bf39f0"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/f28c46cdb85172eb0e267b97e7a9d3befac30a2e", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/f28c46cdb85172eb0e267b97e7a9d3befac30a2e", "html_url": "https://github.com/Rust-GCC/gccrs/commit/f28c46cdb85172eb0e267b97e7a9d3befac30a2e", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/f28c46cdb85172eb0e267b97e7a9d3befac30a2e/comments", "author": null, "committer": null, "parents": [{"sha": "1009e9a2e43a42546cb0bc98fa56199663895b88", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/1009e9a2e43a42546cb0bc98fa56199663895b88", "html_url": "https://github.com/Rust-GCC/gccrs/commit/1009e9a2e43a42546cb0bc98fa56199663895b88"}], "stats": {"total": 34, "additions": 30, "deletions": 4}, "files": [{"sha": "5ee82a6936596aa4394a536c4d975162d551ccc7", "filename": "gcc/fortran/ChangeLog", "status": "modified", "additions": 6, "deletions": 0, "changes": 6, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/f28c46cdb85172eb0e267b97e7a9d3befac30a2e/gcc%2Ffortran%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/f28c46cdb85172eb0e267b97e7a9d3befac30a2e/gcc%2Ffortran%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ffortran%2FChangeLog?ref=f28c46cdb85172eb0e267b97e7a9d3befac30a2e", "patch": "@@ -1,3 +1,9 @@\n+2019-01-25  Steven G. Kargl  <kargl@gcc.gnu.org>\n+\n+\tPR fortran/85780\n+\t* decl.c (gfc_match_subroutine): Check for conflict between BIND(C)\n+\tand alternative return.\n+\n 2019-01-24  Paul Thomas  <pault@gcc.gnu.org>\n \n \tPR fortran/88929"}, {"sha": "e798381467ddb01e985d8eef30f0b48ab419e2fe", "filename": "gcc/fortran/decl.c", "status": "modified", "additions": 16, "deletions": 2, "changes": 18, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/f28c46cdb85172eb0e267b97e7a9d3befac30a2e/gcc%2Ffortran%2Fdecl.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/f28c46cdb85172eb0e267b97e7a9d3befac30a2e/gcc%2Ffortran%2Fdecl.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ffortran%2Fdecl.c?ref=f28c46cdb85172eb0e267b97e7a9d3befac30a2e", "patch": "@@ -7558,6 +7558,7 @@ gfc_match_subroutine (void)\n   match is_bind_c;\n   char peek_char;\n   bool allow_binding_name;\n+  locus loc;\n \n   if (gfc_current_state () != COMP_NONE\n       && gfc_current_state () != COMP_INTERFACE\n@@ -7623,6 +7624,8 @@ gfc_match_subroutine (void)\n   /* Here, we are just checking if it has the bind(c) attribute, and if\n      so, then we need to make sure it's all correct.  If it doesn't,\n      we still need to continue matching the rest of the subroutine line.  */\n+  gfc_gobble_whitespace ();\n+  loc = gfc_current_locus;\n   is_bind_c = gfc_match_bind_c (sym, allow_binding_name);\n   if (is_bind_c == MATCH_ERROR)\n     {\n@@ -7634,6 +7637,8 @@ gfc_match_subroutine (void)\n \n   if (is_bind_c == MATCH_YES)\n     {\n+      gfc_formal_arglist *arg;\n+\n       /* The following is allowed in the Fortran 2008 draft.  */\n       if (gfc_current_state () == COMP_CONTAINS\n \t  && sym->ns->proc_name->attr.flavor != FL_MODULE\n@@ -7647,8 +7652,17 @@ gfc_match_subroutine (void)\n           gfc_error (\"Missing required parentheses before BIND(C) at %C\");\n           return MATCH_ERROR;\n         }\n-      if (!gfc_add_is_bind_c (&(sym->attr), sym->name,\n-\t\t\t      &(sym->declared_at), 1))\n+\n+      /* Scan the dummy arguments for an alternate return.  */\n+      for (arg = sym->formal; arg; arg = arg->next)\n+\tif (!arg->sym)\n+\t  {\n+\t    gfc_error (\"Alternate return dummy argument cannot appear in a \"\n+\t\t       \"SUBROUTINE with the BIND(C) attribute at %L\", &loc);\n+\t    return MATCH_ERROR;\n+\t  }\n+\n+      if (!gfc_add_is_bind_c (&(sym->attr), sym->name, &(sym->declared_at), 1))\n         return MATCH_ERROR;\n     }\n "}, {"sha": "75ce51ad837e0e777c5242001796245e7881e115", "filename": "gcc/testsuite/ChangeLog", "status": "modified", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/f28c46cdb85172eb0e267b97e7a9d3befac30a2e/gcc%2Ftestsuite%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/f28c46cdb85172eb0e267b97e7a9d3befac30a2e/gcc%2Ftestsuite%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2FChangeLog?ref=f28c46cdb85172eb0e267b97e7a9d3befac30a2e", "patch": "@@ -1,3 +1,8 @@\n+2019-01-25  Steven G. Kargl  <kargl@gcc.gnu.org>\n+\n+\tPR fortran/85780\n+\t* gfortran.dg/pr85780.f90: Update testcase for error message.\n+\n 2019-01-25  Richard Earnshaw  <rearnsha@arm.com>\n \n \tPR target/88469"}, {"sha": "b9432e8814edcda738f76a8e083398c1b4d5f51d", "filename": "gcc/testsuite/gfortran.dg/pr85780.f90", "status": "modified", "additions": 3, "deletions": 2, "changes": 5, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/f28c46cdb85172eb0e267b97e7a9d3befac30a2e/gcc%2Ftestsuite%2Fgfortran.dg%2Fpr85780.f90", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/f28c46cdb85172eb0e267b97e7a9d3befac30a2e/gcc%2Ftestsuite%2Fgfortran.dg%2Fpr85780.f90", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgfortran.dg%2Fpr85780.f90?ref=f28c46cdb85172eb0e267b97e7a9d3befac30a2e", "patch": "@@ -1,5 +1,6 @@\n ! { dg-do compile }\n-! { dg-options \"-std=legacy\" }\n+! { dg-options \"-fmax-errors=1\" }\n ! PR fortran/85780\n-subroutine s(*) bind(c)\n+subroutine s(*) bind(c)    ! { dg-error \"Alternate return dummy argument\" }\n end\n+! { dg-prune-output \"compilation terminated\" } "}]}