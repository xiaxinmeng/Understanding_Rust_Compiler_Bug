{"sha": "27ed665fd6bcaaef0593532a0519d167a6f8c8e4", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6MjdlZDY2NWZkNmJjYWFlZjA1OTM1MzJhMDUxOWQxNjdhNmY4YzhlNA==", "commit": {"author": {"name": "Jakub Jelinek", "email": "jakub@redhat.com", "date": "2013-08-14T09:09:58Z"}, "committer": {"name": "Jakub Jelinek", "email": "jakub@gcc.gnu.org", "date": "2013-08-14T09:09:58Z"}, "message": "re PR target/58067 (ICE in GFortran recog.c:2158)\n\n\tPR target/58067\n\t* config/i386/i386.c (ix86_delegitimize_address): For CM_MEDIUM_PIC\n\tand CM_LARGE_PIC ix86_cmodel fall thru into the -m32 code, handle\n\tthere also UNSPEC_PLTOFF.\n\nCo-Authored-By: Alexandre Oliva <aoliva@redhat.com>\n\nFrom-SVN: r201720", "tree": {"sha": "a61232b9f497bbf182d22353f056ee019d3d9d7a", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/a61232b9f497bbf182d22353f056ee019d3d9d7a"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/27ed665fd6bcaaef0593532a0519d167a6f8c8e4", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/27ed665fd6bcaaef0593532a0519d167a6f8c8e4", "html_url": "https://github.com/Rust-GCC/gccrs/commit/27ed665fd6bcaaef0593532a0519d167a6f8c8e4", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/27ed665fd6bcaaef0593532a0519d167a6f8c8e4/comments", "author": {"login": "jakubjelinek", "id": 9370665, "node_id": "MDQ6VXNlcjkzNzA2NjU=", "avatar_url": "https://avatars.githubusercontent.com/u/9370665?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jakubjelinek", "html_url": "https://github.com/jakubjelinek", "followers_url": "https://api.github.com/users/jakubjelinek/followers", "following_url": "https://api.github.com/users/jakubjelinek/following{/other_user}", "gists_url": "https://api.github.com/users/jakubjelinek/gists{/gist_id}", "starred_url": "https://api.github.com/users/jakubjelinek/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jakubjelinek/subscriptions", "organizations_url": "https://api.github.com/users/jakubjelinek/orgs", "repos_url": "https://api.github.com/users/jakubjelinek/repos", "events_url": "https://api.github.com/users/jakubjelinek/events{/privacy}", "received_events_url": "https://api.github.com/users/jakubjelinek/received_events", "type": "User", "site_admin": false}, "committer": null, "parents": [{"sha": "61c1a609ee0019524d94b384eaf8159eadb9a555", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/61c1a609ee0019524d94b384eaf8159eadb9a555", "html_url": "https://github.com/Rust-GCC/gccrs/commit/61c1a609ee0019524d94b384eaf8159eadb9a555"}], "stats": {"total": 48, "additions": 33, "deletions": 15}, "files": [{"sha": "0715f74e684888ce4d52da0ca98fd5f4d6ed14d9", "filename": "gcc/ChangeLog", "status": "modified", "additions": 8, "deletions": 0, "changes": 8, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/27ed665fd6bcaaef0593532a0519d167a6f8c8e4/gcc%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/27ed665fd6bcaaef0593532a0519d167a6f8c8e4/gcc%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2FChangeLog?ref=27ed665fd6bcaaef0593532a0519d167a6f8c8e4", "patch": "@@ -1,3 +1,11 @@\n+2013-08-14  Jakub Jelinek  <jakub@redhat.com>\n+\t    Alexandre Oliva  <aoliva@redhat.com>\n+\n+\tPR target/58067\n+\t* config/i386/i386.c (ix86_delegitimize_address): For CM_MEDIUM_PIC\n+\tand CM_LARGE_PIC ix86_cmodel fall thru into the -m32 code, handle\n+\tthere also UNSPEC_PLTOFF.\n+\n 2013-08-14  Marek Polacek  <polacek@redhat.com>\n \n \t* ipa-inline-analysis.c (add_clause): Avoid shifting integer"}, {"sha": "dd1a6a8196f1d28c977b4df069045c61efd7ad1e", "filename": "gcc/config/i386/i386.c", "status": "modified", "additions": 25, "deletions": 15, "changes": 40, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/27ed665fd6bcaaef0593532a0519d167a6f8c8e4/gcc%2Fconfig%2Fi386%2Fi386.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/27ed665fd6bcaaef0593532a0519d167a6f8c8e4/gcc%2Fconfig%2Fi386%2Fi386.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fconfig%2Fi386%2Fi386.c?ref=27ed665fd6bcaaef0593532a0519d167a6f8c8e4", "patch": "@@ -14124,21 +14124,29 @@ ix86_delegitimize_address (rtx x)\n \t    x = replace_equiv_address_nv (orig_x, x);\n \t  return x;\n \t}\n-      if (GET_CODE (x) != CONST\n-\t  || GET_CODE (XEXP (x, 0)) != UNSPEC\n-\t  || (XINT (XEXP (x, 0), 1) != UNSPEC_GOTPCREL\n-\t      && XINT (XEXP (x, 0), 1) != UNSPEC_PCREL)\n-\t  || (!MEM_P (orig_x) && XINT (XEXP (x, 0), 1) != UNSPEC_PCREL))\n-\treturn ix86_delegitimize_tls_address (orig_x);\n-      x = XVECEXP (XEXP (x, 0), 0, 0);\n-      if (GET_MODE (orig_x) != GET_MODE (x) && MEM_P (orig_x))\n+\n+      if (GET_CODE (x) == CONST\n+\t  && GET_CODE (XEXP (x, 0)) == UNSPEC\n+\t  && (XINT (XEXP (x, 0), 1) == UNSPEC_GOTPCREL\n+\t      || XINT (XEXP (x, 0), 1) == UNSPEC_PCREL)\n+\t  && (MEM_P (orig_x) || XINT (XEXP (x, 0), 1) == UNSPEC_PCREL))\n \t{\n-\t  x = simplify_gen_subreg (GET_MODE (orig_x), x,\n-\t\t\t\t   GET_MODE (x), 0);\n-\t  if (x == NULL_RTX)\n-\t    return orig_x;\n+\t  x = XVECEXP (XEXP (x, 0), 0, 0);\n+\t  if (GET_MODE (orig_x) != GET_MODE (x) && MEM_P (orig_x))\n+\t    {\n+\t      x = simplify_gen_subreg (GET_MODE (orig_x), x,\n+\t\t\t\t       GET_MODE (x), 0);\n+\t      if (x == NULL_RTX)\n+\t\treturn orig_x;\n+\t    }\n+\t  return x;\n \t}\n-      return x;\n+\n+      if (ix86_cmodel != CM_MEDIUM_PIC && ix86_cmodel != CM_LARGE_PIC)\n+\treturn ix86_delegitimize_tls_address (orig_x);\n+\n+      /* Fall thru into the code shared with -m32 for -mcmodel=large -fpic\n+\t and -mcmodel=medium -fpic.  */\n     }\n \n   if (GET_CODE (x) != PLUS\n@@ -14175,10 +14183,12 @@ ix86_delegitimize_address (rtx x)\n \n   if (GET_CODE (x) == UNSPEC\n       && ((XINT (x, 1) == UNSPEC_GOT && MEM_P (orig_x) && !addend)\n-\t  || (XINT (x, 1) == UNSPEC_GOTOFF && !MEM_P (orig_x))))\n+\t  || (XINT (x, 1) == UNSPEC_GOTOFF && !MEM_P (orig_x))\n+\t  || (XINT (x, 1) == UNSPEC_PLTOFF && ix86_cmodel == CM_LARGE_PIC\n+\t      && !MEM_P (orig_x) && !addend)))\n     result = XVECEXP (x, 0, 0);\n \n-  if (TARGET_MACHO && darwin_local_data_pic (x)\n+  if (!TARGET_64BIT && TARGET_MACHO && darwin_local_data_pic (x)\n       && !MEM_P (orig_x))\n     result = XVECEXP (x, 0, 0);\n "}]}