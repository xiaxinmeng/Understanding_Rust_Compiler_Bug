{"sha": "a4cd9ac5f05bd0a6f73b1ec70fce841990ada959", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6YTRjZDlhYzVmMDViZDBhNmY3M2IxZWM3MGZjZTg0MTk5MGFkYTk1OQ==", "commit": {"author": {"name": "Paolo Carlini", "email": "paolo.carlini@oracle.com", "date": "2019-09-25T08:50:29Z"}, "committer": {"name": "Paolo Carlini", "email": "paolo@gcc.gnu.org", "date": "2019-09-25T08:50:29Z"}, "message": "name-lookup.c (check_extern_c_conflict): Use DECL_SOURCE_LOCATION.\n\n/cp\n2019-09-25  Paolo Carlini  <paolo.carlini@oracle.com>\n\n\t* name-lookup.c (check_extern_c_conflict): Use DECL_SOURCE_LOCATION.\n\t(check_local_shadow): Use it in three additional places.\n\n/testsuite\n2019-09-25  Paolo Carlini  <paolo.carlini@oracle.com>\n\n\t* g++.dg/diagnostic/redeclaration-1.C: New.\n\t* g++.dg/lookup/extern-c-hidden.C: Test location(s) too.\n\t* g++.dg/lookup/extern-c-redecl.C: Likewise.\n\t* g++.dg/lookup/extern-c-redecl6.C: Likewise.\n\t* g++.old-deja/g++.other/using9.C: Likewise.\n\nFrom-SVN: r276119", "tree": {"sha": "6dbc3c7d2cca70f1ad84e10d2c248125c4894256", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/6dbc3c7d2cca70f1ad84e10d2c248125c4894256"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/a4cd9ac5f05bd0a6f73b1ec70fce841990ada959", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/a4cd9ac5f05bd0a6f73b1ec70fce841990ada959", "html_url": "https://github.com/Rust-GCC/gccrs/commit/a4cd9ac5f05bd0a6f73b1ec70fce841990ada959", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/a4cd9ac5f05bd0a6f73b1ec70fce841990ada959/comments", "author": null, "committer": null, "parents": [{"sha": "1ed0d9f8ded4cfcff1c0409b183c5b64f69200be", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/1ed0d9f8ded4cfcff1c0409b183c5b64f69200be", "html_url": "https://github.com/Rust-GCC/gccrs/commit/1ed0d9f8ded4cfcff1c0409b183c5b64f69200be"}], "stats": {"total": 62, "additions": 49, "deletions": 13}, "files": [{"sha": "ca317e7730bea1ac9fca4d68f8594d53f22790db", "filename": "gcc/cp/ChangeLog", "status": "modified", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/a4cd9ac5f05bd0a6f73b1ec70fce841990ada959/gcc%2Fcp%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/a4cd9ac5f05bd0a6f73b1ec70fce841990ada959/gcc%2Fcp%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fcp%2FChangeLog?ref=a4cd9ac5f05bd0a6f73b1ec70fce841990ada959", "patch": "@@ -1,3 +1,8 @@\n+2019-09-25  Paolo Carlini  <paolo.carlini@oracle.com>\n+\n+\t* name-lookup.c (check_extern_c_conflict): Use DECL_SOURCE_LOCATION.\n+\t(check_local_shadow): Use it in three additional places.\n+\n 2019-09-24  Jason Merrill  <jason@redhat.com>\n \n \t* parser.c (cp_parser_postfix_expression): Do set location of"}, {"sha": "4d01a54055e4ac54c58780155ad760c56e520942", "filename": "gcc/cp/name-lookup.c", "status": "modified", "additions": 8, "deletions": 5, "changes": 13, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/a4cd9ac5f05bd0a6f73b1ec70fce841990ada959/gcc%2Fcp%2Fname-lookup.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/a4cd9ac5f05bd0a6f73b1ec70fce841990ada959/gcc%2Fcp%2Fname-lookup.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fcp%2Fname-lookup.c?ref=a4cd9ac5f05bd0a6f73b1ec70fce841990ada959", "patch": "@@ -2549,12 +2549,12 @@ check_extern_c_conflict (tree decl)\n       if (mismatch)\n \t{\n \t  auto_diagnostic_group d;\n-\t  pedwarn (input_location, 0,\n+\t  pedwarn (DECL_SOURCE_LOCATION (decl), 0,\n \t\t   \"conflicting C language linkage declaration %q#D\", decl);\n \t  inform (DECL_SOURCE_LOCATION (old),\n \t\t  \"previous declaration %q#D\", old);\n \t  if (mismatch < 0)\n-\t    inform (input_location,\n+\t    inform (DECL_SOURCE_LOCATION (decl),\n \t\t    \"due to different exception specifications\");\n \t}\n       else\n@@ -2674,7 +2674,8 @@ check_local_shadow (tree decl)\n \t  /* ARM $8.3 */\n \t  if (b->kind == sk_function_parms)\n \t    {\n-\t      error (\"declaration of %q#D shadows a parameter\", decl);\n+\t      error_at (DECL_SOURCE_LOCATION (decl),\n+\t\t\t\"declaration of %q#D shadows a parameter\", decl);\n \t      return;\n \t    }\n \t}\n@@ -2700,7 +2701,8 @@ check_local_shadow (tree decl)\n \t       && (old_scope->kind == sk_cond || old_scope->kind == sk_for))\n \t{\n \t  auto_diagnostic_group d;\n-\t  error (\"redeclaration of %q#D\", decl);\n+\t  error_at (DECL_SOURCE_LOCATION (decl),\n+\t\t    \"redeclaration of %q#D\", decl);\n \t  inform (DECL_SOURCE_LOCATION (old),\n \t\t  \"%q#D previously declared here\", old);\n \t  return;\n@@ -2723,7 +2725,8 @@ check_local_shadow (tree decl)\n \t\t   && in_function_try_handler))\n \t{\n \t  auto_diagnostic_group d;\n-\t  if (permerror (input_location, \"redeclaration of %q#D\", decl))\n+\t  if (permerror (DECL_SOURCE_LOCATION (decl),\n+\t\t\t \"redeclaration of %q#D\", decl))\n \t    inform (DECL_SOURCE_LOCATION (old),\n \t\t    \"%q#D previously declared here\", old);\n \t  return;"}, {"sha": "44fc3e382c620037739232fb344756fc193c8d5f", "filename": "gcc/testsuite/ChangeLog", "status": "modified", "additions": 8, "deletions": 0, "changes": 8, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/a4cd9ac5f05bd0a6f73b1ec70fce841990ada959/gcc%2Ftestsuite%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/a4cd9ac5f05bd0a6f73b1ec70fce841990ada959/gcc%2Ftestsuite%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2FChangeLog?ref=a4cd9ac5f05bd0a6f73b1ec70fce841990ada959", "patch": "@@ -1,3 +1,11 @@\n+2019-09-25  Paolo Carlini  <paolo.carlini@oracle.com>\n+\n+\t* g++.dg/diagnostic/redeclaration-1.C: New.\n+\t* g++.dg/lookup/extern-c-hidden.C: Test location(s) too.\n+\t* g++.dg/lookup/extern-c-redecl.C: Likewise.\n+\t* g++.dg/lookup/extern-c-redecl6.C: Likewise.\n+\t* g++.old-deja/g++.other/using9.C: Likewise.\n+\n 2019-09-23  Martin Sebor  <msebor@redhat.com>\n \n \tPR tree-optimization/91570"}, {"sha": "a41a2b8f1c4b5c90bfc1f56e426e8c996c60d063", "filename": "gcc/testsuite/g++.dg/diagnostic/redeclaration-1.C", "status": "added", "additions": 20, "deletions": 0, "changes": 20, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/a4cd9ac5f05bd0a6f73b1ec70fce841990ada959/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Fdiagnostic%2Fredeclaration-1.C", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/a4cd9ac5f05bd0a6f73b1ec70fce841990ada959/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Fdiagnostic%2Fredeclaration-1.C", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Fdiagnostic%2Fredeclaration-1.C?ref=a4cd9ac5f05bd0a6f73b1ec70fce841990ada959", "patch": "@@ -0,0 +1,20 @@\n+void\n+foo (int i)\n+{\n+  int i  // { dg-error \"7:declaration of .int i. shadows a parameter\" }\n+    (0);\n+  \n+  for (int j ;;)  // { dg-message \"12:.int j. previously declared here\" }\n+    int j  // { dg-error \"9:redeclaration of .int j.\" }\n+      (0);\n+}\n+\n+void\n+bar (int i)  // { dg-message \"10:.int i. previously declared here\" }\n+  try\n+    { }\n+  catch (...)\n+    {\n+      int i  // { dg-error \"11:redeclaration of .int i.\" }\n+\t(0);\n+    }"}, {"sha": "2b4a46222c37084b024e8db8bf526bc3e9c6f92b", "filename": "gcc/testsuite/g++.dg/lookup/extern-c-hidden.C", "status": "modified", "additions": 2, "deletions": 2, "changes": 4, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/a4cd9ac5f05bd0a6f73b1ec70fce841990ada959/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Flookup%2Fextern-c-hidden.C", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/a4cd9ac5f05bd0a6f73b1ec70fce841990ada959/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Flookup%2Fextern-c-hidden.C", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Flookup%2Fextern-c-hidden.C?ref=a4cd9ac5f05bd0a6f73b1ec70fce841990ada959", "patch": "@@ -4,8 +4,8 @@ extern \"C\" float fabsf (float);  // { dg-message \"previous declaration\" }\n \n namespace Bob \n {\n-  extern \"C\" float fabsf (float, float); // { dg-error \"C language\" }\n+  extern \"C\" float fabsf (float, float); // { dg-error \"20:conflicting C language\" }\n   extern \"C\" double fabs (double, double); // { dg-message \"previous declaration\" }\n }\n \n-extern \"C\" double fabs (double); // { dg-error \"C language\" }\n+extern \"C\" double fabs (double); // { dg-error \"19:conflicting C language\" }"}, {"sha": "4ffb8226154307e71af971d411282c22ece272a2", "filename": "gcc/testsuite/g++.dg/lookup/extern-c-redecl.C", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/a4cd9ac5f05bd0a6f73b1ec70fce841990ada959/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Flookup%2Fextern-c-redecl.C", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/a4cd9ac5f05bd0a6f73b1ec70fce841990ada959/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Flookup%2Fextern-c-redecl.C", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Flookup%2Fextern-c-redecl.C?ref=a4cd9ac5f05bd0a6f73b1ec70fce841990ada959", "patch": "@@ -8,4 +8,4 @@ namespace A {\n // next line should trigger an error because\n // it conflicts with previous declaration of foo_func (), due to\n // different exception specifications.\n-extern \"C\" void foo_func (); // { dg-error \"C language linkage|exception specifications\" }\n+extern \"C\" void foo_func (); // { dg-error \"17:conflicting C language linkage|exception specifications\" }"}, {"sha": "1d6c57197761a1abe5b91452f5773217e0b5e250", "filename": "gcc/testsuite/g++.dg/lookup/extern-c-redecl6.C", "status": "modified", "additions": 4, "deletions": 4, "changes": 8, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/a4cd9ac5f05bd0a6f73b1ec70fce841990ada959/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Flookup%2Fextern-c-redecl6.C", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/a4cd9ac5f05bd0a6f73b1ec70fce841990ada959/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Flookup%2Fextern-c-redecl6.C", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Flookup%2Fextern-c-redecl6.C?ref=a4cd9ac5f05bd0a6f73b1ec70fce841990ada959", "patch": "@@ -16,10 +16,10 @@ extern \"C\" {\n \n   namespace BAD\n   {\n-    long i; // { dg-error \"C language linkage\" }\n-    double f; // { dg-error \"C language linkage\" }\n-    int fn (); // { dg-error \"C language linkage\" }\n-    int ai1[2]; // { dg-error \"C language linkage\" }\n+    long i; // { dg-error \"10:conflicting C language linkage\" }\n+    double f; // { dg-error \"12:conflicting C language linkage\" }\n+    int fn (); // { dg-error \"9:conflicting C language linkage\" }\n+    int ai1[2]; // { dg-error \"9:conflicting C language linkage\" }\n   }\n }\n "}, {"sha": "e1b5aa7861179997f6aabece98b27b656770629b", "filename": "gcc/testsuite/g++.old-deja/g++.other/using9.C", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/a4cd9ac5f05bd0a6f73b1ec70fce841990ada959/gcc%2Ftestsuite%2Fg%2B%2B.old-deja%2Fg%2B%2B.other%2Fusing9.C", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/a4cd9ac5f05bd0a6f73b1ec70fce841990ada959/gcc%2Ftestsuite%2Fg%2B%2B.old-deja%2Fg%2B%2B.other%2Fusing9.C", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fg%2B%2B.old-deja%2Fg%2B%2B.other%2Fusing9.C?ref=a4cd9ac5f05bd0a6f73b1ec70fce841990ada959", "patch": "@@ -16,6 +16,6 @@ using ::a;\n extern \"C\" void foo ();\t\t// { dg-message \"previous declaration\" }\n \n namespace {\n-  extern \"C\" int foo ();\t// { dg-error \"C.*linkage\" }\n+  extern \"C\" int foo ();\t// { dg-error \"18:conflicting C.*linkage\" }\n   using ::foo; // { dg-error \"\" } already in use\n }"}]}