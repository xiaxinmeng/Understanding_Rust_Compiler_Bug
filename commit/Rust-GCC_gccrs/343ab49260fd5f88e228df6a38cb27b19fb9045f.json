{"sha": "343ab49260fd5f88e228df6a38cb27b19fb9045f", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6MzQzYWI0OTI2MGZkNWY4OGUyMjhkZjZhMzhjYjI3YjE5ZmI5MDQ1Zg==", "commit": {"author": {"name": "Paul Thomas", "email": "pault@gcc.gnu.org", "date": "2013-12-01T11:50:20Z"}, "committer": {"name": "Paul Thomas", "email": "pault@gcc.gnu.org", "date": "2013-12-01T11:50:20Z"}, "message": "re PR fortran/57354 (Wrong run-time assignment of allocatable array of derived type with allocatable component)\n\n2013-12-01  Paul Thomas  <pault@gcc.gnu.org>\n\n\tPR fortran/57354\n\t* trans-array.c (gfc_conv_resolve_dependencies): For other than\n\tSS_SECTION, do a dependency check if the lhs is liable to be\n\treallocated.\n\n2013-12-01  Paul Thomas  <pault@gcc.gnu.org>\n\n\tPR fortran/57354\n\t* gfortran.dg/realloc_on_assign_23.f90 : New test\n\nFrom-SVN: r205567", "tree": {"sha": "43dd63f5ad4eb021cfcdbb850eef24d026c9f314", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/43dd63f5ad4eb021cfcdbb850eef24d026c9f314"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/343ab49260fd5f88e228df6a38cb27b19fb9045f", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/343ab49260fd5f88e228df6a38cb27b19fb9045f", "html_url": "https://github.com/Rust-GCC/gccrs/commit/343ab49260fd5f88e228df6a38cb27b19fb9045f", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/343ab49260fd5f88e228df6a38cb27b19fb9045f/comments", "author": null, "committer": null, "parents": [{"sha": "d700518bbd5ae9a77509d8ef052f31a8c09f0438", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/d700518bbd5ae9a77509d8ef052f31a8c09f0438", "html_url": "https://github.com/Rust-GCC/gccrs/commit/d700518bbd5ae9a77509d8ef052f31a8c09f0438"}], "stats": {"total": 54, "additions": 52, "deletions": 2}, "files": [{"sha": "a92561cf5653447c9fc3ba347beaa1617e99ba0d", "filename": "gcc/fortran/ChangeLog", "status": "modified", "additions": 7, "deletions": 0, "changes": 7, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/343ab49260fd5f88e228df6a38cb27b19fb9045f/gcc%2Ffortran%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/343ab49260fd5f88e228df6a38cb27b19fb9045f/gcc%2Ffortran%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ffortran%2FChangeLog?ref=343ab49260fd5f88e228df6a38cb27b19fb9045f", "patch": "@@ -1,3 +1,10 @@\n+2013-12-01  Paul Thomas  <pault@gcc.gnu.org>\n+\n+\tPR fortran/57354\n+\t* trans-array.c (gfc_conv_resolve_dependencies): For other than\n+\tSS_SECTION, do a dependency check if the lhs is liable to be\n+\treallocated.\n+\n 2013-12-01  Paul Thomas  <pault@gcc.gnu.org>\n \n \tPR fortran/58410"}, {"sha": "78b08d70951e34f34952d3c33ff873ff260711e0", "filename": "gcc/fortran/trans-array.c", "status": "modified", "additions": 10, "deletions": 2, "changes": 12, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/343ab49260fd5f88e228df6a38cb27b19fb9045f/gcc%2Ffortran%2Ftrans-array.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/343ab49260fd5f88e228df6a38cb27b19fb9045f/gcc%2Ffortran%2Ftrans-array.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ffortran%2Ftrans-array.c?ref=343ab49260fd5f88e228df6a38cb27b19fb9045f", "patch": "@@ -4335,10 +4335,18 @@ gfc_conv_resolve_dependencies (gfc_loopinfo * loop, gfc_ss * dest,\n \n   for (ss = rss; ss != gfc_ss_terminator; ss = ss->next)\n     {\n+      ss_expr = ss->info->expr;\n+\n       if (ss->info->type != GFC_SS_SECTION)\n-\tcontinue;\n+\t{\n+\t  if (gfc_option.flag_realloc_lhs\n+\t      && dest_expr != ss_expr\n+\t      && gfc_is_reallocatable_lhs (dest_expr)\n+\t      && ss_expr->rank)\n+\t    nDepend = gfc_check_dependency (dest_expr, ss_expr, true);\n \n-      ss_expr = ss->info->expr;\n+\t  continue;\n+\t}\n \n       if (dest_expr->symtree->n.sym != ss_expr->symtree->n.sym)\n \t{"}, {"sha": "01a160e9dcf7b382985c9a74df78ec7313e23f7c", "filename": "gcc/testsuite/ChangeLog", "status": "modified", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/343ab49260fd5f88e228df6a38cb27b19fb9045f/gcc%2Ftestsuite%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/343ab49260fd5f88e228df6a38cb27b19fb9045f/gcc%2Ftestsuite%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2FChangeLog?ref=343ab49260fd5f88e228df6a38cb27b19fb9045f", "patch": "@@ -1,3 +1,8 @@\n+2013-12-01  Paul Thomas  <pault@gcc.gnu.org>\n+\n+\tPR fortran/57354\n+\t* gfortran.dg/realloc_on_assign_23.f90 : New test\n+\n 2013-12-01  Paul Thomas  <pault@gcc.gnu.org>\n \n \tPR fortran/34547"}, {"sha": "f9897f17401ee45c2f639fa02a4d90faf7f29c7f", "filename": "gcc/testsuite/gfortran.dg/realloc_on_assign_23.f90", "status": "added", "additions": 30, "deletions": 0, "changes": 30, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/343ab49260fd5f88e228df6a38cb27b19fb9045f/gcc%2Ftestsuite%2Fgfortran.dg%2Frealloc_on_assign_23.f90", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/343ab49260fd5f88e228df6a38cb27b19fb9045f/gcc%2Ftestsuite%2Fgfortran.dg%2Frealloc_on_assign_23.f90", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgfortran.dg%2Frealloc_on_assign_23.f90?ref=343ab49260fd5f88e228df6a38cb27b19fb9045f", "patch": "@@ -0,0 +1,30 @@\n+! { dg-do run }\n+!\n+! PR fortran/57354\n+!\n+! Contributed by Vladimir Fuka  <vladimir.fuka@gmail.com>\n+!\n+  type t\n+    integer,allocatable :: i\n+  end type\n+\n+  type(t) :: e\n+  type(t), allocatable :: a(:)\n+  integer :: chksum = 0\n+\n+  do i=1,3   ! Was 100 in original\n+    e%i = i\n+    chksum = chksum + i\n+    if (.not.allocated(a)) then\n+      a = [e]\n+    else\n+      call foo\n+    end if\n+  end do\n+\n+  if (sum ([(a(i)%i, i=1,size(a))]) .ne. chksum) call abort\n+contains\n+  subroutine foo\n+    a = [a, e]\n+  end subroutine\n+end"}]}