{"sha": "476b301a0c62213400f5208c55a2a0f1120790ce", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6NDc2YjMwMWEwYzYyMjEzNDAwZjUyMDhjNTVhMmEwZjExMjA3OTBjZQ==", "commit": {"author": {"name": "Arnaud Charlet", "email": "charlet@gcc.gnu.org", "date": "2014-02-19T11:18:32Z"}, "committer": {"name": "Arnaud Charlet", "email": "charlet@gcc.gnu.org", "date": "2014-02-19T11:18:32Z"}, "message": "[multiple changes]\n\n2014-02-19  Hristian Kirtchev  <kirtchev@adacore.com>\n\n\t* sem_ch3.adb (Analyze_Declarations): Analyze\n\ta package contract at the end of the private declarations (if\n\tapplicable), otherwise analyze it and the end of the visible\n\tdeclarations.\n\n2014-02-19  Ed Schonberg  <schonberg@adacore.com>\n\n\t* style.adb (Missing_Overriding): If subprogram is an\n\tinstantiation, place warning on the instance node itself,\n\twithout mention of the original generic. Do not emit message\n\tif explicit Ada version is older than the introduction of the\n\toverriding indicator.\n\nFrom-SVN: r207895", "tree": {"sha": "2f3a0269b92213205395bf264a85a6a357457944", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/2f3a0269b92213205395bf264a85a6a357457944"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/476b301a0c62213400f5208c55a2a0f1120790ce", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/476b301a0c62213400f5208c55a2a0f1120790ce", "html_url": "https://github.com/Rust-GCC/gccrs/commit/476b301a0c62213400f5208c55a2a0f1120790ce", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/476b301a0c62213400f5208c55a2a0f1120790ce/comments", "author": null, "committer": null, "parents": [{"sha": "a6ce7e76cc9c6ce12081f2002e3e8e528a74144d", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/a6ce7e76cc9c6ce12081f2002e3e8e528a74144d", "html_url": "https://github.com/Rust-GCC/gccrs/commit/a6ce7e76cc9c6ce12081f2002e3e8e528a74144d"}], "stats": {"total": 56, "additions": 50, "deletions": 6}, "files": [{"sha": "567aa0d9d3048a43428ab9f971845f975f1b5539", "filename": "gcc/ada/ChangeLog", "status": "modified", "additions": 15, "deletions": 0, "changes": 15, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/476b301a0c62213400f5208c55a2a0f1120790ce/gcc%2Fada%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/476b301a0c62213400f5208c55a2a0f1120790ce/gcc%2Fada%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fada%2FChangeLog?ref=476b301a0c62213400f5208c55a2a0f1120790ce", "patch": "@@ -1,3 +1,18 @@\n+2014-02-19  Hristian Kirtchev  <kirtchev@adacore.com>\n+\n+\t* sem_ch3.adb (Analyze_Declarations): Analyze\n+\ta package contract at the end of the private declarations (if\n+\tapplicable), otherwise analyze it and the end of the visible\n+\tdeclarations.\n+\n+2014-02-19  Ed Schonberg  <schonberg@adacore.com>\n+\n+\t* style.adb (Missing_Overriding): If subprogram is an\n+\tinstantiation, place warning on the instance node itself,\n+\twithout mention of the original generic. Do not emit message\n+\tif explicit Ada version is older than the introduction of the\n+\toverriding indicator.\n+\n 2014-02-19  Yannick Moy  <moy@adacore.com>\n \n \t* gnat_rm.texi: Doc clarifications."}, {"sha": "98991e2bbc7f5221d833ca576dd25a577c242b7e", "filename": "gcc/ada/sem_ch3.adb", "status": "modified", "additions": 18, "deletions": 4, "changes": 22, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/476b301a0c62213400f5208c55a2a0f1120790ce/gcc%2Fada%2Fsem_ch3.adb", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/476b301a0c62213400f5208c55a2a0f1120790ce/gcc%2Fada%2Fsem_ch3.adb", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fada%2Fsem_ch3.adb?ref=476b301a0c62213400f5208c55a2a0f1120790ce", "patch": "@@ -2342,10 +2342,24 @@ package body Sem_Ch3 is\n       if Present (L) then\n          Context := Parent (L);\n \n-         if Nkind (Context) = N_Package_Specification\n-           and then L = Visible_Declarations (Context)\n-         then\n-            Analyze_Package_Contract (Defining_Entity (Context));\n+         if Nkind (Context) = N_Package_Specification then\n+\n+            --  When a package has private declarations, its contract must be\n+            --  analyzed at the end of the said declarations. This way both the\n+            --  analysis and freeze actions are properly synchronized in case\n+            --  of private type use within the contract.\n+\n+            if L = Private_Declarations (Context) then\n+               Analyze_Package_Contract (Defining_Entity (Context));\n+\n+            --  Otherwise the contract is analyzed at the end of the visible\n+            --  declarations.\n+\n+            elsif L = Visible_Declarations (Context)\n+              and then No (Private_Declarations (Context))\n+            then\n+               Analyze_Package_Contract (Defining_Entity (Context));\n+            end if;\n \n          elsif Nkind (Context) = N_Package_Body then\n             In_Package_Body := True;"}, {"sha": "fffcf360cb4ffdc1f58f41e69ed2f6a246c27b53", "filename": "gcc/ada/style.adb", "status": "modified", "additions": 17, "deletions": 2, "changes": 19, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/476b301a0c62213400f5208c55a2a0f1120790ce/gcc%2Fada%2Fstyle.adb", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/476b301a0c62213400f5208c55a2a0f1120790ce/gcc%2Fada%2Fstyle.adb", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fada%2Fstyle.adb?ref=476b301a0c62213400f5208c55a2a0f1120790ce", "patch": "@@ -29,6 +29,7 @@ with Csets;    use Csets;\n with Einfo;    use Einfo;\n with Errout;   use Errout;\n with Namet;    use Namet;\n+with Nlists;   use Nlists;\n with Opt;      use Opt;\n with Sinfo;    use Sinfo;\n with Sinput;   use Sinput;\n@@ -258,6 +259,7 @@ package body Style is\n    ------------------------\n \n    procedure Missing_Overriding (N : Node_Id; E : Entity_Id) is\n+      Nod : Node_Id;\n    begin\n \n       --  Perform the check on source subprograms and on subprogram instances,\n@@ -266,15 +268,28 @@ package body Style is\n \n       if Style_Check_Missing_Overriding\n         and then (Comes_From_Source (N) or else Is_Generic_Instance (E))\n-        and then Ada_Version >= Ada_2005\n+        and then Ada_Version_Explicit >= Ada_2005\n       then\n+         --  If the subprogram is an instantiation,  its declaration appears\n+         --  within a wrapper package that precedes the instance node. Place\n+         --  warning on the node to avoid references to the original generic.\n+\n+         if Nkind (N) = N_Subprogram_Declaration\n+           and then Is_Generic_Instance (E)\n+         then\n+            Nod := Next (Parent (Parent (List_Containing (N))));\n+\n+         else\n+            Nod := N;\n+         end if;\n+\n          if Nkind (N) = N_Subprogram_Body then\n             Error_Msg_NE -- CODEFIX\n               (\"(style) missing OVERRIDING indicator in body of&\", N, E);\n          else\n             Error_Msg_NE -- CODEFIX\n               (\"(style) missing OVERRIDING indicator in declaration of&\",\n-               N, E);\n+               Nod, E);\n          end if;\n       end if;\n    end Missing_Overriding;"}]}