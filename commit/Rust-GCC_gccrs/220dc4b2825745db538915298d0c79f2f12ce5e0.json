{"sha": "220dc4b2825745db538915298d0c79f2f12ce5e0", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6MjIwZGM0YjI4MjU3NDVkYjUzODkxNTI5OGQwYzc5ZjJmMTJjZTVlMA==", "commit": {"author": {"name": "Hristian Kirtchev", "email": "kirtchev@adacore.com", "date": "2019-07-11T08:02:30Z"}, "committer": {"name": "Pierre-Marie de Rodat", "email": "pmderodat@gcc.gnu.org", "date": "2019-07-11T08:02:30Z"}, "message": "[Ada] Elaboration order v4.0 and output of dependencies\n\nThis patch adds a missing case to the mechanism that outputs the\nelaboration order dependencies of units.\n\n------------\n-- Source --\n------------\n\n--  pack.ads\n\npackage Pack is\n   procedure Force_Body;\nend Pack;\n\n--  pack.adb\n\npackage body Pack is\n   procedure Force_Body is null;\nend Pack;\n\n--  main.adb\n\nwith Pack;\n\nprocedure Main is begin null; end Main;\n\n----------------------------\n-- Compilation and output --\n----------------------------\n\n$ gnatmake -q main.adb -bargs -e\n\nELABORATION ORDER DEPENDENCIES\n\n   unit \"pack (spec)\" must be elaborated before unit \"main (body)\"\n     reason: unit \"main (body)\" has with clause for unit \"pack (spec)\"\n   unit \"pack (spec)\" must be elaborated before unit \"pack (body)\"\n     reason: spec must be elaborated before body\n\n2019-07-11  Hristian Kirtchev  <kirtchev@adacore.com>\n\ngcc/ada/\n\n\t* bindo.adb: Remove the documentation of switch -d_N because it\n\tis no longer in use.\n\t* bindo-graphs.ads, bindo-graphs.adb (Is_Spec_Before_Body_Edge):\n\tNew routine.\n\t* bindo-writers.adb (Write_Dependency_Edge): Add the missing\n\tcase of a spec-before-body edge.\n\nFrom-SVN: r273394", "tree": {"sha": "e2b01a2e4288ab54e6cb89087a28bd2691dc393f", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/e2b01a2e4288ab54e6cb89087a28bd2691dc393f"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/220dc4b2825745db538915298d0c79f2f12ce5e0", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/220dc4b2825745db538915298d0c79f2f12ce5e0", "html_url": "https://github.com/Rust-GCC/gccrs/commit/220dc4b2825745db538915298d0c79f2f12ce5e0", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/220dc4b2825745db538915298d0c79f2f12ce5e0/comments", "author": {"login": "kirtchev-adacore", "id": 60669983, "node_id": "MDQ6VXNlcjYwNjY5OTgz", "avatar_url": "https://avatars.githubusercontent.com/u/60669983?v=4", "gravatar_id": "", "url": "https://api.github.com/users/kirtchev-adacore", "html_url": "https://github.com/kirtchev-adacore", "followers_url": "https://api.github.com/users/kirtchev-adacore/followers", "following_url": "https://api.github.com/users/kirtchev-adacore/following{/other_user}", "gists_url": "https://api.github.com/users/kirtchev-adacore/gists{/gist_id}", "starred_url": "https://api.github.com/users/kirtchev-adacore/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/kirtchev-adacore/subscriptions", "organizations_url": "https://api.github.com/users/kirtchev-adacore/orgs", "repos_url": "https://api.github.com/users/kirtchev-adacore/repos", "events_url": "https://api.github.com/users/kirtchev-adacore/events{/privacy}", "received_events_url": "https://api.github.com/users/kirtchev-adacore/received_events", "type": "User", "site_admin": false}, "committer": null, "parents": [{"sha": "d4ba738c67e5579d5a0dff07f20b36f3df9529d5", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/d4ba738c67e5579d5a0dff07f20b36f3df9529d5", "html_url": "https://github.com/Rust-GCC/gccrs/commit/d4ba738c67e5579d5a0dff07f20b36f3df9529d5"}], "stats": {"total": 42, "additions": 37, "deletions": 5}, "files": [{"sha": "accc3eea9592db5c84c828cfba87bda4e58eabd0", "filename": "gcc/ada/ChangeLog", "status": "modified", "additions": 9, "deletions": 0, "changes": 9, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/220dc4b2825745db538915298d0c79f2f12ce5e0/gcc%2Fada%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/220dc4b2825745db538915298d0c79f2f12ce5e0/gcc%2Fada%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fada%2FChangeLog?ref=220dc4b2825745db538915298d0c79f2f12ce5e0", "patch": "@@ -1,3 +1,12 @@\n+2019-07-11  Hristian Kirtchev  <kirtchev@adacore.com>\n+\n+\t* bindo.adb: Remove the documentation of switch -d_N because it\n+\tis no longer in use.\n+\t* bindo-graphs.ads, bindo-graphs.adb (Is_Spec_Before_Body_Edge):\n+\tNew routine.\n+\t* bindo-writers.adb (Write_Dependency_Edge): Add the missing\n+\tcase of a spec-before-body edge.\n+\n 2019-07-11  Dmitriy Anisimkov  <anisimko@adacore.com>\n \n \t* libgnat/g-socket.ads (Mode_Type): Add a Socket_Raw enumerator."}, {"sha": "c2f9d6cac5cee978ded83e2cf63d73bc44ff6596", "filename": "gcc/ada/bindo-graphs.adb", "status": "modified", "additions": 15, "deletions": 0, "changes": 15, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/220dc4b2825745db538915298d0c79f2f12ce5e0/gcc%2Fada%2Fbindo-graphs.adb", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/220dc4b2825745db538915298d0c79f2f12ce5e0/gcc%2Fada%2Fbindo-graphs.adb", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fada%2Fbindo-graphs.adb?ref=220dc4b2825745db538915298d0c79f2f12ce5e0", "patch": "@@ -4183,6 +4183,21 @@ package body Bindo.Graphs is\n          return U_Rec.Utype = Is_Spec or else U_Rec.Utype = Is_Spec_Only;\n       end Is_Spec;\n \n+      ------------------------------\n+      -- Is_Spec_Before_Body_Edge --\n+      ------------------------------\n+\n+      function Is_Spec_Before_Body_Edge\n+        (G    : Library_Graph;\n+         Edge : Library_Graph_Edge_Id) return Boolean\n+      is\n+      begin\n+         pragma Assert (Present (G));\n+         pragma Assert (Present (Edge));\n+\n+         return Kind (G, Edge) = Spec_Before_Body_Edge;\n+      end Is_Spec_Before_Body_Edge;\n+\n       -----------------------\n       -- Is_Spec_With_Body --\n       -----------------------"}, {"sha": "f376801cb3c0f0c5b4cd90ee08517539722df71f", "filename": "gcc/ada/bindo-graphs.ads", "status": "modified", "additions": 7, "deletions": 0, "changes": 7, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/220dc4b2825745db538915298d0c79f2f12ce5e0/gcc%2Fada%2Fbindo-graphs.ads", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/220dc4b2825745db538915298d0c79f2f12ce5e0/gcc%2Fada%2Fbindo-graphs.ads", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fada%2Fbindo-graphs.ads?ref=220dc4b2825745db538915298d0c79f2f12ce5e0", "patch": "@@ -1166,6 +1166,13 @@ package Bindo.Graphs is\n       pragma Inline (Is_Spec);\n       --  Determine whether vertex Vertex of library graph G denotes a spec\n \n+      function Is_Spec_Before_Body_Edge\n+        (G    : Library_Graph;\n+         Edge : Library_Graph_Edge_Id) return Boolean;\n+      pragma Inline (Is_Spec_Before_Body_Edge);\n+      --  Determine whether edge Edge of library graph G links a predecessor\n+      --  spec and a successor body belonging to the same unit.\n+\n       function Is_Spec_With_Body\n         (G      : Library_Graph;\n          Vertex : Library_Graph_Vertex_Id) return Boolean;"}, {"sha": "1fcfb11becb0dca502460864e34f3f160fa23221", "filename": "gcc/ada/bindo-writers.adb", "status": "modified", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/220dc4b2825745db538915298d0c79f2f12ce5e0/gcc%2Fada%2Fbindo-writers.adb", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/220dc4b2825745db538915298d0c79f2f12ce5e0/gcc%2Fada%2Fbindo-writers.adb", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fada%2Fbindo-writers.adb?ref=220dc4b2825745db538915298d0c79f2f12ce5e0", "patch": "@@ -610,6 +610,11 @@ package body Bindo.Writers is\n                  & \"elaboration time\",\n                Info => True);\n \n+         elsif Is_Spec_Before_Body_Edge (G, Edge) then\n+            Error_Msg_Output\n+              (Msg  => \"     reason: spec must be elaborated before body\",\n+               Info => True);\n+\n          else\n             pragma Assert (Is_With_Edge (G, Edge));\n "}, {"sha": "249ce972f075467389a87f7fc65765ebfeaf03dc", "filename": "gcc/ada/bindo.adb", "status": "modified", "additions": 1, "deletions": 5, "changes": 6, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/220dc4b2825745db538915298d0c79f2f12ce5e0/gcc%2Fada%2Fbindo.adb", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/220dc4b2825745db538915298d0c79f2f12ce5e0/gcc%2Fada%2Fbindo.adb", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fada%2Fbindo.adb?ref=220dc4b2825745db538915298d0c79f2f12ce5e0", "patch": "@@ -347,13 +347,9 @@ package body Bindo is\n    --        GNATbind outputs the library graph in textual format to standard\n    --        output.\n    --\n-   --  -d_N  New bindo order\n-   --\n-   --        GNATbind utilizes the new bindo elaboration order\n-   --\n    --  -d_P  Output cycle paths\n    --\n-   --        GNATbind output the cycle paths in text format to standard output\n+   --        GNATbind outputs the cycle paths in text format to standard output\n    --\n    --  -d_S  Output elaboration-order status information\n    --"}]}