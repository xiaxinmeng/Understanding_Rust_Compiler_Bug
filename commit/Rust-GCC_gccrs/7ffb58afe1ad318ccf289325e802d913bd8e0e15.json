{"sha": "7ffb58afe1ad318ccf289325e802d913bd8e0e15", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6N2ZmYjU4YWZlMWFkMzE4Y2NmMjg5MzI1ZTgwMmQ5MTNiZDhlMGUxNQ==", "commit": {"author": {"name": "Hristian Kirtchev", "email": "kirtchev@adacore.com", "date": "2018-07-17T08:11:32Z"}, "committer": {"name": "Pierre-Marie de Rodat", "email": "pmderodat@gcc.gnu.org", "date": "2018-07-17T08:11:32Z"}, "message": "[Ada] Faulty ignored Ghost code removal\n\nThis patch ensures that removal of ignored Ghost code is the absolute last\noperation performed on the tree. Previously the removal was performed prior to\nissuing delayed warnings, however the warning mechanism may see a heavily\nmodified tree and fail.\n\nNo small reproducer available.\n\n2018-07-17  Hristian Kirtchev  <kirtchev@adacore.com>\n\ngcc/ada/\n\n\t* frontend.adb (Frontend): The removal of ignored Ghost code must be\n\tthe last semantic operation performed on the tree.\n\nFrom-SVN: r262795", "tree": {"sha": "751691ac5b6406a18f27526c39b6a184f754e838", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/751691ac5b6406a18f27526c39b6a184f754e838"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/7ffb58afe1ad318ccf289325e802d913bd8e0e15", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/7ffb58afe1ad318ccf289325e802d913bd8e0e15", "html_url": "https://github.com/Rust-GCC/gccrs/commit/7ffb58afe1ad318ccf289325e802d913bd8e0e15", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/7ffb58afe1ad318ccf289325e802d913bd8e0e15/comments", "author": {"login": "kirtchev-adacore", "id": 60669983, "node_id": "MDQ6VXNlcjYwNjY5OTgz", "avatar_url": "https://avatars.githubusercontent.com/u/60669983?v=4", "gravatar_id": "", "url": "https://api.github.com/users/kirtchev-adacore", "html_url": "https://github.com/kirtchev-adacore", "followers_url": "https://api.github.com/users/kirtchev-adacore/followers", "following_url": "https://api.github.com/users/kirtchev-adacore/following{/other_user}", "gists_url": "https://api.github.com/users/kirtchev-adacore/gists{/gist_id}", "starred_url": "https://api.github.com/users/kirtchev-adacore/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/kirtchev-adacore/subscriptions", "organizations_url": "https://api.github.com/users/kirtchev-adacore/orgs", "repos_url": "https://api.github.com/users/kirtchev-adacore/repos", "events_url": "https://api.github.com/users/kirtchev-adacore/events{/privacy}", "received_events_url": "https://api.github.com/users/kirtchev-adacore/received_events", "type": "User", "site_admin": false}, "committer": null, "parents": [{"sha": "9cc97ad523d17ce6ae643030e5f99fe5acb68bea", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/9cc97ad523d17ce6ae643030e5f99fe5acb68bea", "html_url": "https://github.com/Rust-GCC/gccrs/commit/9cc97ad523d17ce6ae643030e5f99fe5acb68bea"}], "stats": {"total": 18, "additions": 13, "deletions": 5}, "files": [{"sha": "1b8da215beaf2c5b23e3f24d57ad42f2ab3c94b8", "filename": "gcc/ada/ChangeLog", "status": "modified", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/7ffb58afe1ad318ccf289325e802d913bd8e0e15/gcc%2Fada%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/7ffb58afe1ad318ccf289325e802d913bd8e0e15/gcc%2Fada%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fada%2FChangeLog?ref=7ffb58afe1ad318ccf289325e802d913bd8e0e15", "patch": "@@ -1,3 +1,8 @@\n+2018-07-17  Hristian Kirtchev  <kirtchev@adacore.com>\n+\n+\t* frontend.adb (Frontend): The removal of ignored Ghost code must be\n+\tthe last semantic operation performed on the tree.\n+\n 2018-07-17  Hristian Kirtchev  <kirtchev@adacore.com>\n \n \t* frontend.adb (Frontend): Update the call to Register_Config_Switches."}, {"sha": "1da6f9aa502ead44ffddb04323ecec281b0890fd", "filename": "gcc/ada/frontend.adb", "status": "modified", "additions": 8, "deletions": 5, "changes": 13, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/7ffb58afe1ad318ccf289325e802d913bd8e0e15/gcc%2Fada%2Ffrontend.adb", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/7ffb58afe1ad318ccf289325e802d913bd8e0e15/gcc%2Fada%2Ffrontend.adb", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fada%2Ffrontend.adb?ref=7ffb58afe1ad318ccf289325e802d913bd8e0e15", "patch": "@@ -451,11 +451,6 @@ begin\n \n                Check_Elaboration_Scenarios;\n \n-               --  Remove any ignored Ghost code as it must not appear in the\n-               --  executable.\n-\n-               Remove_Ignored_Ghost_Code;\n-\n             --  Examine all top level scenarios collected during analysis and\n             --  resolution in order to diagnose conditional ABEs, even in the\n             --  presence of serious errors.\n@@ -483,6 +478,14 @@ begin\n             Sem_Warn.Output_Unreferenced_Messages;\n             Sem_Warn.Check_Unused_Withs;\n             Sem_Warn.Output_Unused_Warnings_Off_Warnings;\n+\n+            --  Remove any ignored Ghost code as it must not appear in the\n+            --  executable. This action must be performed last because it\n+            --  heavily alters the tree.\n+\n+            if Operating_Mode = Generate_Code or else GNATprove_Mode then\n+               Remove_Ignored_Ghost_Code;\n+            end if;\n          end if;\n       end if;\n    end;"}]}