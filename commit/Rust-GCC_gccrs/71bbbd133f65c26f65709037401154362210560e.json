{"sha": "71bbbd133f65c26f65709037401154362210560e", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6NzFiYmJkMTMzZjY1YzI2ZjY1NzA5MDM3NDAxMTU0MzYyMjEwNTYwZQ==", "commit": {"author": {"name": "Nathan Sidwell", "email": "nathan@acm.org", "date": "2017-06-20T12:53:11Z"}, "committer": {"name": "Nathan Sidwell", "email": "nathan@gcc.gnu.org", "date": "2017-06-20T12:53:11Z"}, "message": "PR c++/67074 - namespace aliases\n\n\tPR c++/67074 - namespace aliases\n\t* decl.c (duplicate_decls): Don't error here on mismatched\n\tnamespace alias.\n\t* name-lookup.c (name_lookup::add_value): Matching namespaces are\n\tnot ambiguous.\n\t(diagnose_name_conflict): Namespaces are never redeclarations.\n\t(update_binding): An alias can match a real namespace.\n\n\tPR c++/67074\n\t* g++.dg/lookup/pr67074.C: New.\n\t* g++.dg/parse/namespace-alias-1.C: Adjust.\n\nFrom-SVN: r249408", "tree": {"sha": "4d79c576c152bbe5c57dca0fa48467a3aec04c20", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/4d79c576c152bbe5c57dca0fa48467a3aec04c20"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/71bbbd133f65c26f65709037401154362210560e", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/71bbbd133f65c26f65709037401154362210560e", "html_url": "https://github.com/Rust-GCC/gccrs/commit/71bbbd133f65c26f65709037401154362210560e", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/71bbbd133f65c26f65709037401154362210560e/comments", "author": {"login": "urnathan", "id": 13103001, "node_id": "MDQ6VXNlcjEzMTAzMDAx", "avatar_url": "https://avatars.githubusercontent.com/u/13103001?v=4", "gravatar_id": "", "url": "https://api.github.com/users/urnathan", "html_url": "https://github.com/urnathan", "followers_url": "https://api.github.com/users/urnathan/followers", "following_url": "https://api.github.com/users/urnathan/following{/other_user}", "gists_url": "https://api.github.com/users/urnathan/gists{/gist_id}", "starred_url": "https://api.github.com/users/urnathan/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/urnathan/subscriptions", "organizations_url": "https://api.github.com/users/urnathan/orgs", "repos_url": "https://api.github.com/users/urnathan/repos", "events_url": "https://api.github.com/users/urnathan/events{/privacy}", "received_events_url": "https://api.github.com/users/urnathan/received_events", "type": "User", "site_admin": false}, "committer": null, "parents": [{"sha": "531f0b3879b09b53d738b5bf84790c49bdd60977", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/531f0b3879b09b53d738b5bf84790c49bdd60977", "html_url": "https://github.com/Rust-GCC/gccrs/commit/531f0b3879b09b53d738b5bf84790c49bdd60977"}], "stats": {"total": 79, "additions": 55, "deletions": 24}, "files": [{"sha": "3ed58b260d29f9226fafef8af4ddb940b8b76de2", "filename": "gcc/cp/ChangeLog", "status": "modified", "additions": 10, "deletions": 0, "changes": 10, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/71bbbd133f65c26f65709037401154362210560e/gcc%2Fcp%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/71bbbd133f65c26f65709037401154362210560e/gcc%2Fcp%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fcp%2FChangeLog?ref=71bbbd133f65c26f65709037401154362210560e", "patch": "@@ -1,3 +1,13 @@\n+2017-06-20  Nathan Sidwell  <nathan@acm.org>\n+\n+\tPR c++/67074 - namespace aliases\n+\t* decl.c (duplicate_decls): Don't error here on mismatched\n+\tnamespace alias.\n+\t* name-lookup.c (name_lookup::add_value): Matching namespaces are\n+\tnot ambiguous.\n+\t(diagnose_name_conflict): Namespaces are never redeclarations.\n+\t(update_binding): An alias can match a real namespace.\n+\n 2017-06-19  Jason Merrill  <jason@redhat.com>\n \n \tPR c++/80562 - ICE with constexpr if."}, {"sha": "bb7c56f6a8d6003fd5b8a7327ecab68e1261b792", "filename": "gcc/cp/decl.c", "status": "modified", "additions": 3, "deletions": 11, "changes": 14, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/71bbbd133f65c26f65709037401154362210560e/gcc%2Fcp%2Fdecl.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/71bbbd133f65c26f65709037401154362210560e/gcc%2Fcp%2Fdecl.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fcp%2Fdecl.c?ref=71bbbd133f65c26f65709037401154362210560e", "patch": "@@ -1751,17 +1751,9 @@ duplicate_decls (tree newdecl, tree olddecl, bool newdecl_is_friend)\n \t  && (DECL_NAMESPACE_ALIAS (newdecl)\n \t      == DECL_NAMESPACE_ALIAS (olddecl)))\n \treturn olddecl;\n-      /* [namespace.alias]\n-\n-\t A namespace-name or namespace-alias shall not be declared as\n-\t the name of any other entity in the same declarative region.\n-\t A namespace-name defined at global scope shall not be\n-\t declared as the name of any other entity in any global scope\n-\t of the program.  */\n-      error (\"conflicting declaration of namespace %q+D\", newdecl);\n-      inform (DECL_SOURCE_LOCATION (olddecl),\n-\t      \"previous declaration of namespace %qD here\", olddecl);\n-      return error_mark_node;\n+\n+      /* Leave it to update_binding to merge or report error.  */\n+      return NULL_TREE;\n     }\n   else\n     {"}, {"sha": "54c9d7b6341d3278f25619ebeeb41fd4a2bb05c1", "filename": "gcc/cp/name-lookup.c", "status": "modified", "additions": 17, "deletions": 12, "changes": 29, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/71bbbd133f65c26f65709037401154362210560e/gcc%2Fcp%2Fname-lookup.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/71bbbd133f65c26f65709037401154362210560e/gcc%2Fcp%2Fname-lookup.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fcp%2Fname-lookup.c?ref=71bbbd133f65c26f65709037401154362210560e", "patch": "@@ -450,7 +450,13 @@ name_lookup::add_value (tree new_val)\n   else if ((TREE_CODE (value) == TYPE_DECL\n \t    && TREE_CODE (new_val) == TYPE_DECL\n \t    && same_type_p (TREE_TYPE (value), TREE_TYPE (new_val))))\n-    ;\n+    /* Typedefs to the same type. */;\n+  else if (TREE_CODE (value) == NAMESPACE_DECL\n+\t   && TREE_CODE (new_val) == NAMESPACE_DECL\n+\t   && ORIGINAL_NAMESPACE (value) == ORIGINAL_NAMESPACE (new_val))\n+    /* Namespace (possibly aliased) to the same namespace.  Locate\n+       the namespace*/\n+    value = ORIGINAL_NAMESPACE (value);\n   else\n     {\n       if (deduping)\n@@ -1630,10 +1636,10 @@ static void\n diagnose_name_conflict (tree decl, tree bval)\n {\n   if (TREE_CODE (decl) == TREE_CODE (bval)\n-      && (TREE_CODE (decl) != TYPE_DECL\n-\t  || (DECL_ARTIFICIAL (decl) && DECL_ARTIFICIAL (bval))\n-\t  || (!DECL_ARTIFICIAL (decl) && !DECL_ARTIFICIAL (bval)))\n+      && TREE_CODE (decl) != NAMESPACE_DECL\n       && !DECL_DECLARES_FUNCTION_P (decl)\n+      && (TREE_CODE (decl) != TYPE_DECL\n+\t  || DECL_ARTIFICIAL (decl) == DECL_ARTIFICIAL (bval))\n       && CP_DECL_CONTEXT (decl) == CP_DECL_CONTEXT (bval))\n     error (\"redeclaration of %q#D\", decl);\n   else\n@@ -1809,15 +1815,14 @@ update_binding (cp_binding_level *level, cxx_binding *binding, tree *slot,\n     }\n   else if (TREE_CODE (old) == NAMESPACE_DECL)\n     {\n-      if (DECL_NAMESPACE_ALIAS (old) && DECL_NAMESPACE_ALIAS (decl)\n-\t  && ORIGINAL_NAMESPACE (old) == ORIGINAL_NAMESPACE (decl))\n-\t/* In a declarative region, a namespace-alias-definition can be\n-\t   used to redefine a namespace-alias declared in that declarative\n-\t   region to refer only to the namespace to which it already\n-\t   refers.  [namespace.alias] */\n-\treturn old;\n-      else\n+      /* Two maybe-aliased namespaces.  If they're to the same target\n+\t namespace, that's ok.  */\n+      if (ORIGINAL_NAMESPACE (old) != ORIGINAL_NAMESPACE (decl))\n \tgoto conflict;\n+\n+      /* The new one must be an alias at this point.  */\n+      gcc_assert (DECL_NAMESPACE_ALIAS (decl));\n+      return old;\n     }\n   else if (TREE_CODE (old) == VAR_DECL)\n     {"}, {"sha": "ee1a4e265b16196bd120b8bdcbc93dad6be1cada", "filename": "gcc/testsuite/ChangeLog", "status": "modified", "additions": 6, "deletions": 0, "changes": 6, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/71bbbd133f65c26f65709037401154362210560e/gcc%2Ftestsuite%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/71bbbd133f65c26f65709037401154362210560e/gcc%2Ftestsuite%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2FChangeLog?ref=71bbbd133f65c26f65709037401154362210560e", "patch": "@@ -1,3 +1,9 @@\n+2017-06-20  Nathan Sidwell  <nathan@acm.org>\n+\n+\tPR c++/67074\n+\t* g++.dg/lookup/pr67074.C: New.\n+\t* g++.dg/parse/namespace-alias-1.C: Adjust.\n+\n 2017-06-20  Richard Biener  <rguenther@suse.de>\n \n \tPR middle-end/81097"}, {"sha": "ce31ede15887237ba3ec5c4d1b3d38bdcb61e975", "filename": "gcc/testsuite/g++.dg/lookup/pr67074.C", "status": "added", "additions": 18, "deletions": 0, "changes": 18, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/71bbbd133f65c26f65709037401154362210560e/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Flookup%2Fpr67074.C", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/71bbbd133f65c26f65709037401154362210560e/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Flookup%2Fpr67074.C", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Flookup%2Fpr67074.C?ref=71bbbd133f65c26f65709037401154362210560e", "patch": "@@ -0,0 +1,18 @@\n+// PR c++/67074 namespace aliases to the same place.\n+\n+namespace P {\n+  namespace X {\n+    static int i = 1;\n+  }\n+}\n+namespace Q {\n+  namespace X = P::X;\n+}\n+\n+using namespace P;\n+using namespace Q;\n+\n+void Frob () { X::i; }\n+\n+namespace N {}\n+namespace N = N;"}, {"sha": "220d5f9decd12ae44a80b35a6299583775ba7c76", "filename": "gcc/testsuite/g++.dg/parse/namespace-alias-1.C", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/71bbbd133f65c26f65709037401154362210560e/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Fparse%2Fnamespace-alias-1.C", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/71bbbd133f65c26f65709037401154362210560e/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Fparse%2Fnamespace-alias-1.C", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Fparse%2Fnamespace-alias-1.C?ref=71bbbd133f65c26f65709037401154362210560e", "patch": "@@ -3,7 +3,7 @@\n namespace N\n {\n   namespace M = N;  // { dg-message \"previous declaration\" }\n-  namespace M {}    // { dg-error \"declaration of namespace\" }\n+  namespace M {}    // { dg-error \"conflicts with a previous declaration\" }\n }\n \n namespace A"}]}