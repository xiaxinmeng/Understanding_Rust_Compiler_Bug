{"sha": "f3f6029db2e5f960c10062d8c8c74d766fcad6d2", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6ZjNmNjAyOWRiMmU1Zjk2MGMxMDA2MmQ4YzhjNzRkNzY2ZmNhZDZkMg==", "commit": {"author": {"name": "Nathan Sidwell", "email": "nathan@acm.org", "date": "2018-10-31T15:26:28Z"}, "committer": {"name": "Nathan Sidwell", "email": "nathan@gcc.gnu.org", "date": "2018-10-31T15:26:28Z"}, "message": "[6/6] Preprocessor forced macro location\n\nhttps://gcc.gnu.org/ml/gcc-patches/2018-10/msg02044.html\n\tlibcpp/\n\t* internal.h (struct cpp_reader): Rename forced_token_location_p\n\tto forced_token_location and drop its pointerness.\n\t* include/cpplib.h (cpp_force_token_locations): Take location, not\n\tpointer to one.\n\t* init.c (cpp_create_reader): Adjust.\n\t* lex.c (cpp_read_main_file): \n\n\tgcc/c-family/\n\t* c-opts.c (c_finish_options): Adjust cpp_force_token_locations call.\n\n\tgcc/fortran/\n\t* cpp.c (gfc_cpp_init): Adjust cpp_force_token_locations call.\n\nFrom-SVN: r265692", "tree": {"sha": "65fe76f5ca430fb5055b03a24045e1d61e3668be", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/65fe76f5ca430fb5055b03a24045e1d61e3668be"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/f3f6029db2e5f960c10062d8c8c74d766fcad6d2", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/f3f6029db2e5f960c10062d8c8c74d766fcad6d2", "html_url": "https://github.com/Rust-GCC/gccrs/commit/f3f6029db2e5f960c10062d8c8c74d766fcad6d2", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/f3f6029db2e5f960c10062d8c8c74d766fcad6d2/comments", "author": {"login": "urnathan", "id": 13103001, "node_id": "MDQ6VXNlcjEzMTAzMDAx", "avatar_url": "https://avatars.githubusercontent.com/u/13103001?v=4", "gravatar_id": "", "url": "https://api.github.com/users/urnathan", "html_url": "https://github.com/urnathan", "followers_url": "https://api.github.com/users/urnathan/followers", "following_url": "https://api.github.com/users/urnathan/following{/other_user}", "gists_url": "https://api.github.com/users/urnathan/gists{/gist_id}", "starred_url": "https://api.github.com/users/urnathan/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/urnathan/subscriptions", "organizations_url": "https://api.github.com/users/urnathan/orgs", "repos_url": "https://api.github.com/users/urnathan/repos", "events_url": "https://api.github.com/users/urnathan/events{/privacy}", "received_events_url": "https://api.github.com/users/urnathan/received_events", "type": "User", "site_admin": false}, "committer": null, "parents": [{"sha": "82a14443dbad05cdf1bd09c7ebc98c406c81e384", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/82a14443dbad05cdf1bd09c7ebc98c406c81e384", "html_url": "https://github.com/Rust-GCC/gccrs/commit/82a14443dbad05cdf1bd09c7ebc98c406c81e384"}], "stats": {"total": 43, "additions": 28, "deletions": 15}, "files": [{"sha": "290e3fac8017fa3a36241c7980b8e0e5f964d34a", "filename": "gcc/c-family/ChangeLog", "status": "modified", "additions": 4, "deletions": 0, "changes": 4, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/f3f6029db2e5f960c10062d8c8c74d766fcad6d2/gcc%2Fc-family%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/f3f6029db2e5f960c10062d8c8c74d766fcad6d2/gcc%2Fc-family%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fc-family%2FChangeLog?ref=f3f6029db2e5f960c10062d8c8c74d766fcad6d2", "patch": "@@ -1,3 +1,7 @@\n+2018-10-31  Nathan Sidwell  <nathan@acm.org>\n+\n+\t* c-opts.c (c_finish_options): Adjust cpp_force_token_locations call.\n+\n 2018-10-30  Martin Sebor  <msebor@redhat.com>\n \n \tPR middle-end/87041"}, {"sha": "4592682d58725260c0668d119451c61d0b2bef17", "filename": "gcc/c-family/c-opts.c", "status": "modified", "additions": 1, "deletions": 2, "changes": 3, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/f3f6029db2e5f960c10062d8c8c74d766fcad6d2/gcc%2Fc-family%2Fc-opts.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/f3f6029db2e5f960c10062d8c8c74d766fcad6d2/gcc%2Fc-family%2Fc-opts.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fc-family%2Fc-opts.c?ref=f3f6029db2e5f960c10062d8c8c74d766fcad6d2", "patch": "@@ -1396,8 +1396,7 @@ c_finish_options (void)\n \t\t\t\t\t\t\t   0)));\n       /* Make sure all of the builtins about to be declared have\n \t BUILTINS_LOCATION has their source_location.  */\n-      source_location builtins_loc = BUILTINS_LOCATION;\n-      cpp_force_token_locations (parse_in, &builtins_loc);\n+      cpp_force_token_locations (parse_in, BUILTINS_LOCATION);\n \n       cpp_init_builtins (parse_in, flag_hosted);\n       c_cpp_builtins (parse_in);"}, {"sha": "a773bbd21fec2fdecfffe5505bde7223d1770190", "filename": "gcc/fortran/ChangeLog", "status": "modified", "additions": 4, "deletions": 0, "changes": 4, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/f3f6029db2e5f960c10062d8c8c74d766fcad6d2/gcc%2Ffortran%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/f3f6029db2e5f960c10062d8c8c74d766fcad6d2/gcc%2Ffortran%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ffortran%2FChangeLog?ref=f3f6029db2e5f960c10062d8c8c74d766fcad6d2", "patch": "@@ -1,3 +1,7 @@\n+2018-10-31  Nathan Sidwell  <nathan@acm.org>\n+\n+\t* cpp.c (gfc_cpp_init): Adjust cpp_force_token_locations call.\n+\n 2018-10-31  Martin Liska  <mliska@suse.cz>\n \n \t* trans-decl.c (struct module_hasher): Call htab_hash_string"}, {"sha": "a28421f81614315e669ca8554f10dd7ba125133d", "filename": "gcc/fortran/cpp.c", "status": "modified", "additions": 1, "deletions": 2, "changes": 3, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/f3f6029db2e5f960c10062d8c8c74d766fcad6d2/gcc%2Ffortran%2Fcpp.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/f3f6029db2e5f960c10062d8c8c74d766fcad6d2/gcc%2Ffortran%2Fcpp.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ffortran%2Fcpp.c?ref=f3f6029db2e5f960c10062d8c8c74d766fcad6d2", "patch": "@@ -579,8 +579,7 @@ gfc_cpp_init (void)\n     {\n       /* Make sure all of the builtins about to be declared have\n \tBUILTINS_LOCATION has their source_location.  */\n-      source_location builtins_loc = BUILTINS_LOCATION;\n-      cpp_force_token_locations (cpp_in, &builtins_loc);\n+      cpp_force_token_locations (cpp_in, BUILTINS_LOCATION);\n \n       cpp_define_builtins (cpp_in);\n "}, {"sha": "3e98732ceb189e3fe495ce53b7f194bc9b5500ea", "filename": "libcpp/ChangeLog", "status": "modified", "additions": 7, "deletions": 0, "changes": 7, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/f3f6029db2e5f960c10062d8c8c74d766fcad6d2/libcpp%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/f3f6029db2e5f960c10062d8c8c74d766fcad6d2/libcpp%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libcpp%2FChangeLog?ref=f3f6029db2e5f960c10062d8c8c74d766fcad6d2", "patch": "@@ -1,5 +1,12 @@\n 2018-10-31  Nathan Sidwell  <nathan@acm.org>\n \n+\t* internal.h (struct cpp_reader): Rename forced_token_location_p\n+\tto forced_token_location and drop its pointerness.\n+\t* include/cpplib.h (cpp_force_token_locations): Take location, not\n+\tpointer to one.\n+\t* init.c (cpp_create_reader): Adjust.\n+\t* lex.c (cpp_read_main_file): \n+\n \t* directives.c (do_include_common): Commonize cleanup path.\n \t(_cpp_pop_buffer): Fix leak.\n "}, {"sha": "aad836d2192ddb464680e7565322619e89b48da6", "filename": "libcpp/include/cpplib.h", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/f3f6029db2e5f960c10062d8c8c74d766fcad6d2/libcpp%2Finclude%2Fcpplib.h", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/f3f6029db2e5f960c10062d8c8c74d766fcad6d2/libcpp%2Finclude%2Fcpplib.h", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libcpp%2Finclude%2Fcpplib.h?ref=f3f6029db2e5f960c10062d8c8c74d766fcad6d2", "patch": "@@ -1281,7 +1281,7 @@ extern int cpp_read_state (cpp_reader *, const char *, FILE *,\n \t\t\t   struct save_macro_data *);\n \n /* In lex.c */\n-extern void cpp_force_token_locations (cpp_reader *, source_location *);\n+extern void cpp_force_token_locations (cpp_reader *, source_location);\n extern void cpp_stop_forcing_token_locations (cpp_reader *);\n \n /* In expr.c */"}, {"sha": "43c07fc850bcbf05fc30d30948eeed148a95e30f", "filename": "libcpp/init.c", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/f3f6029db2e5f960c10062d8c8c74d766fcad6d2/libcpp%2Finit.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/f3f6029db2e5f960c10062d8c8c74d766fcad6d2/libcpp%2Finit.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libcpp%2Finit.c?ref=f3f6029db2e5f960c10062d8c8c74d766fcad6d2", "patch": "@@ -264,7 +264,7 @@ cpp_create_reader (enum c_lang lang, cpp_hash_table *table,\n   pfile->pushed_macros = 0;\n \n   /* Do not force token locations by default.  */\n-  pfile->forced_token_location_p = NULL;\n+  pfile->forced_token_location = 0;\n \n   /* Initialize source_date_epoch to -2 (not yet set).  */\n   pfile->source_date_epoch = (time_t) -2;"}, {"sha": "98fefeb9e83abbc5906fb24abdda1f58d126fd35", "filename": "libcpp/internal.h", "status": "modified", "additions": 2, "deletions": 2, "changes": 4, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/f3f6029db2e5f960c10062d8c8c74d766fcad6d2/libcpp%2Finternal.h", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/f3f6029db2e5f960c10062d8c8c74d766fcad6d2/libcpp%2Finternal.h", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libcpp%2Finternal.h?ref=f3f6029db2e5f960c10062d8c8c74d766fcad6d2", "patch": "@@ -570,9 +570,9 @@ struct cpp_reader\n   /* List of saved macros by push_macro.  */\n   struct def_pragma_macro *pushed_macros;\n \n-  /* If non-null, the lexer will use this location for the next token\n+  /* If non-zero, the lexer will use this location for the next token\n      instead of getting a location from the linemap.  */\n-  source_location *forced_token_location_p;\n+  source_location forced_token_location;\n };\n \n /* Character classes.  Based on the more primitive macros in safe-ctype.h."}, {"sha": "c6e34b33343f9666ec5526797a44096de4324ab4", "filename": "libcpp/lex.c", "status": "modified", "additions": 7, "deletions": 7, "changes": 14, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/f3f6029db2e5f960c10062d8c8c74d766fcad6d2/libcpp%2Flex.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/f3f6029db2e5f960c10062d8c8c74d766fcad6d2/libcpp%2Flex.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libcpp%2Flex.c?ref=f3f6029db2e5f960c10062d8c8c74d766fcad6d2", "patch": "@@ -2757,8 +2757,8 @@ _cpp_lex_direct (cpp_reader *pfile)\n     }\n   c = *buffer->cur++;\n \n-  if (pfile->forced_token_location_p)\n-    result->src_loc = *pfile->forced_token_location_p;\n+  if (pfile->forced_token_location)\n+    result->src_loc = pfile->forced_token_location;\n   else\n     result->src_loc = linemap_position_for_column (pfile->line_table,\n \t\t\t\t\t  CPP_BUF_COLUMN (buffer, buffer->cur));\n@@ -3773,20 +3773,20 @@ cpp_token_val_index (const cpp_token *tok)\n     }\n }\n \n-/* All tokens lexed in R after calling this function will be forced to have\n-   their source_location the same as the location referenced by P, until\n+/* All tokens lexed in R after calling this function will be forced to\n+   have their source_location to be P, until\n    cpp_stop_forcing_token_locations is called for R.  */\n \n void\n-cpp_force_token_locations (cpp_reader *r, source_location *p)\n+cpp_force_token_locations (cpp_reader *r, source_location loc)\n {\n-  r->forced_token_location_p = p;\n+  r->forced_token_location = loc;\n }\n \n /* Go back to assigning locations naturally for lexed tokens.  */\n \n void\n cpp_stop_forcing_token_locations (cpp_reader *r)\n {\n-  r->forced_token_location_p = NULL;\n+  r->forced_token_location = 0;\n }"}]}