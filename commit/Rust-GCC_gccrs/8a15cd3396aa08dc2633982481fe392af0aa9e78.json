{"sha": "8a15cd3396aa08dc2633982481fe392af0aa9e78", "node_id": "C_kwDOANBUbNoAKDhhMTVjZDMzOTZhYTA4ZGMyNjMzOTgyNDgxZmUzOTJhZjBhYTllNzg", "commit": {"author": {"name": "Martin Liska", "email": "mliska@suse.cz", "date": "2022-06-23T12:43:50Z"}, "committer": {"name": "Martin Liska", "email": "mliska@suse.cz", "date": "2022-06-23T13:28:27Z"}, "message": "c++: properly initialize UBSAN built-ins\n\n\tPR c++/106062\n\ngcc/ChangeLog:\n\n\t* ubsan.cc (sanitize_unreachable_fn): Change order of calls\n\tin order to initialize UBSAN built-ins.\n\ngcc/testsuite/ChangeLog:\n\n\t* gfortran.dg/ubsan/pr106062.f90: New test.", "tree": {"sha": "978d49983c8244b8cc480b48955f8f549574d2dd", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/978d49983c8244b8cc480b48955f8f549574d2dd"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/8a15cd3396aa08dc2633982481fe392af0aa9e78", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/8a15cd3396aa08dc2633982481fe392af0aa9e78", "html_url": "https://github.com/Rust-GCC/gccrs/commit/8a15cd3396aa08dc2633982481fe392af0aa9e78", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/8a15cd3396aa08dc2633982481fe392af0aa9e78/comments", "author": {"login": "marxin", "id": 2658545, "node_id": "MDQ6VXNlcjI2NTg1NDU=", "avatar_url": "https://avatars.githubusercontent.com/u/2658545?v=4", "gravatar_id": "", "url": "https://api.github.com/users/marxin", "html_url": "https://github.com/marxin", "followers_url": "https://api.github.com/users/marxin/followers", "following_url": "https://api.github.com/users/marxin/following{/other_user}", "gists_url": "https://api.github.com/users/marxin/gists{/gist_id}", "starred_url": "https://api.github.com/users/marxin/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/marxin/subscriptions", "organizations_url": "https://api.github.com/users/marxin/orgs", "repos_url": "https://api.github.com/users/marxin/repos", "events_url": "https://api.github.com/users/marxin/events{/privacy}", "received_events_url": "https://api.github.com/users/marxin/received_events", "type": "User", "site_admin": false}, "committer": {"login": "marxin", "id": 2658545, "node_id": "MDQ6VXNlcjI2NTg1NDU=", "avatar_url": "https://avatars.githubusercontent.com/u/2658545?v=4", "gravatar_id": "", "url": "https://api.github.com/users/marxin", "html_url": "https://github.com/marxin", "followers_url": "https://api.github.com/users/marxin/followers", "following_url": "https://api.github.com/users/marxin/following{/other_user}", "gists_url": "https://api.github.com/users/marxin/gists{/gist_id}", "starred_url": "https://api.github.com/users/marxin/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/marxin/subscriptions", "organizations_url": "https://api.github.com/users/marxin/orgs", "repos_url": "https://api.github.com/users/marxin/repos", "events_url": "https://api.github.com/users/marxin/events{/privacy}", "received_events_url": "https://api.github.com/users/marxin/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "c01fe6729e607fd064eb27db2a9420aedb75ffd4", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/c01fe6729e607fd064eb27db2a9420aedb75ffd4", "html_url": "https://github.com/Rust-GCC/gccrs/commit/c01fe6729e607fd064eb27db2a9420aedb75ffd4"}], "stats": {"total": 14, "additions": 13, "deletions": 1}, "files": [{"sha": "879a67eb7494c575899b943a5bab6edf6b9f7c5c", "filename": "gcc/testsuite/gfortran.dg/ubsan/pr106062.f90", "status": "added", "additions": 11, "deletions": 0, "changes": 11, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/8a15cd3396aa08dc2633982481fe392af0aa9e78/gcc%2Ftestsuite%2Fgfortran.dg%2Fubsan%2Fpr106062.f90", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/8a15cd3396aa08dc2633982481fe392af0aa9e78/gcc%2Ftestsuite%2Fgfortran.dg%2Fubsan%2Fpr106062.f90", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgfortran.dg%2Fubsan%2Fpr106062.f90?ref=8a15cd3396aa08dc2633982481fe392af0aa9e78", "patch": "@@ -0,0 +1,11 @@\n+! PR c++/106062\n+! { dg-do compile }\n+! { dg-options \"-O2 -fsanitize=undefined\" }\n+\n+call test (reshape ((/ 'a', 'b', 'c', 'd' /), (/ 2, 2 /)))\n+contains\n+  subroutine test (a)\n+    character (*), dimension (:, :) :: a\n+    if (len (a) .ne. 1) STOP \n+  end  \n+end"}, {"sha": "b6c4301dfaf036f6f4a03a8df198c76a3c702b2d", "filename": "gcc/ubsan.cc", "status": "modified", "additions": 2, "deletions": 1, "changes": 3, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/8a15cd3396aa08dc2633982481fe392af0aa9e78/gcc%2Fubsan.cc", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/8a15cd3396aa08dc2633982481fe392af0aa9e78/gcc%2Fubsan.cc", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fubsan.cc?ref=8a15cd3396aa08dc2633982481fe392af0aa9e78", "patch": "@@ -654,9 +654,10 @@ sanitize_unreachable_fn (tree *data, location_t loc)\n     }\n   else if (san)\n     {\n-      fn = builtin_decl_explicit (BUILT_IN_UBSAN_HANDLE_BUILTIN_UNREACHABLE);\n+      /* Call ubsan_create_data first as it initializes SANITIZER built-ins.  */\n       *data = ubsan_create_data (\"__ubsan_unreachable_data\", 1, &loc,\n \t\t\t\t NULL_TREE, NULL_TREE);\n+      fn = builtin_decl_explicit (BUILT_IN_UBSAN_HANDLE_BUILTIN_UNREACHABLE);\n       *data = build_fold_addr_expr_loc (loc, *data);\n     }\n   else"}]}