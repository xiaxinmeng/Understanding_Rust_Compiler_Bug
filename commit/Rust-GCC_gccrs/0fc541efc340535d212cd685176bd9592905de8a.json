{"sha": "0fc541efc340535d212cd685176bd9592905de8a", "node_id": "C_kwDOANBUbNoAKDBmYzU0MWVmYzM0MDUzNWQyMTJjZDY4NTE3NmJkOTU5MjkwNWRlOGE", "commit": {"author": {"name": "Richard Biener", "email": "rguenther@suse.de", "date": "2023-03-15T08:47:18Z"}, "committer": {"name": "Richard Biener", "email": "rguenther@suse.de", "date": "2023-03-15T09:29:27Z"}, "message": "tree-optimization/109139 - fix .DEFERRED_INIT removal\n\nThe following make sure to strip MEMs when looking for unused\ndecls on the LHS of .DEFERRED_INIT.\n\n\tPR tree-optimization/109139\n\t* tree-ssa-live.cc (remove_unused_locals): Look at the\n\tbase address for unused decls on the LHS of .DEFERRED_INIT.\n\n\t* gcc.dg/torture/pr109139.c: New testcase.", "tree": {"sha": "619b7831dc0b4a08f9e65167b956210964c44786", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/619b7831dc0b4a08f9e65167b956210964c44786"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/0fc541efc340535d212cd685176bd9592905de8a", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/0fc541efc340535d212cd685176bd9592905de8a", "html_url": "https://github.com/Rust-GCC/gccrs/commit/0fc541efc340535d212cd685176bd9592905de8a", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/0fc541efc340535d212cd685176bd9592905de8a/comments", "author": {"login": "rguenth", "id": 2046526, "node_id": "MDQ6VXNlcjIwNDY1MjY=", "avatar_url": "https://avatars.githubusercontent.com/u/2046526?v=4", "gravatar_id": "", "url": "https://api.github.com/users/rguenth", "html_url": "https://github.com/rguenth", "followers_url": "https://api.github.com/users/rguenth/followers", "following_url": "https://api.github.com/users/rguenth/following{/other_user}", "gists_url": "https://api.github.com/users/rguenth/gists{/gist_id}", "starred_url": "https://api.github.com/users/rguenth/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/rguenth/subscriptions", "organizations_url": "https://api.github.com/users/rguenth/orgs", "repos_url": "https://api.github.com/users/rguenth/repos", "events_url": "https://api.github.com/users/rguenth/events{/privacy}", "received_events_url": "https://api.github.com/users/rguenth/received_events", "type": "User", "site_admin": false}, "committer": {"login": "rguenth", "id": 2046526, "node_id": "MDQ6VXNlcjIwNDY1MjY=", "avatar_url": "https://avatars.githubusercontent.com/u/2046526?v=4", "gravatar_id": "", "url": "https://api.github.com/users/rguenth", "html_url": "https://github.com/rguenth", "followers_url": "https://api.github.com/users/rguenth/followers", "following_url": "https://api.github.com/users/rguenth/following{/other_user}", "gists_url": "https://api.github.com/users/rguenth/gists{/gist_id}", "starred_url": "https://api.github.com/users/rguenth/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/rguenth/subscriptions", "organizations_url": "https://api.github.com/users/rguenth/orgs", "repos_url": "https://api.github.com/users/rguenth/repos", "events_url": "https://api.github.com/users/rguenth/events{/privacy}", "received_events_url": "https://api.github.com/users/rguenth/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "45641f3a99281bb0a429649741a29c2aace4c63e", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/45641f3a99281bb0a429649741a29c2aace4c63e", "html_url": "https://github.com/Rust-GCC/gccrs/commit/45641f3a99281bb0a429649741a29c2aace4c63e"}], "stats": {"total": 15, "additions": 14, "deletions": 1}, "files": [{"sha": "9fa97ebc66559c318a6ffaac835994492c15d12f", "filename": "gcc/testsuite/gcc.dg/torture/pr109139.c", "status": "added", "additions": 12, "deletions": 0, "changes": 12, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/0fc541efc340535d212cd685176bd9592905de8a/gcc%2Ftestsuite%2Fgcc.dg%2Ftorture%2Fpr109139.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/0fc541efc340535d212cd685176bd9592905de8a/gcc%2Ftestsuite%2Fgcc.dg%2Ftorture%2Fpr109139.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgcc.dg%2Ftorture%2Fpr109139.c?ref=0fc541efc340535d212cd685176bd9592905de8a", "patch": "@@ -0,0 +1,12 @@\n+/* { dg-do compile } */\n+/* { dg-additional-options \"-ftrivial-auto-var-init=zero\" } */\n+\n+const int COMPARE_CANDIDATE;\n+char ipmi_ek_compare_link_record1_0, ipmi_ek_compare_link_record2_0;\n+void ipmi_ek_compare_link()\n+{\n+  for (; ipmi_ek_compare_link_record1_0;)\n+    for (; ipmi_ek_compare_link_record2_0;) {\n+\tint link[COMPARE_CANDIDATE];\n+    }\n+}"}, {"sha": "1be92956cc5476c9120b38e9b520d19c90ee9405", "filename": "gcc/tree-ssa-live.cc", "status": "modified", "additions": 2, "deletions": 1, "changes": 3, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/0fc541efc340535d212cd685176bd9592905de8a/gcc%2Ftree-ssa-live.cc", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/0fc541efc340535d212cd685176bd9592905de8a/gcc%2Ftree-ssa-live.cc", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftree-ssa-live.cc?ref=0fc541efc340535d212cd685176bd9592905de8a", "patch": "@@ -897,7 +897,8 @@ remove_unused_locals (void)\n \t    else if (gimple_call_internal_p (stmt, IFN_DEFERRED_INIT))\n \t      {\n \t\ttree lhs = gimple_call_lhs (stmt);\n-\t\tif (DECL_P (lhs) && !is_used_p (lhs))\n+\t\ttree base = get_base_address (lhs);\n+\t\tif (DECL_P (base) && !is_used_p (base))\n \t\t  {\n \t\t    unlink_stmt_vdef (stmt);\n \t\t    gsi_remove (&gsi, true);"}]}