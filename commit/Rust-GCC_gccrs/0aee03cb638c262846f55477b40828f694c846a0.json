{"sha": "0aee03cb638c262846f55477b40828f694c846a0", "node_id": "C_kwDOANBUbNoAKDBhZWUwM2NiNjM4YzI2Mjg0NmY1NTQ3N2I0MDgyOGY2OTRjODQ2YTA", "commit": {"author": {"name": "Joel Brobecker", "email": "brobecker@adacore.com", "date": "2022-05-24T19:51:42Z"}, "committer": {"name": "Joel Brobecker", "email": "brobecker@adacore.com", "date": "2022-05-24T19:51:42Z"}, "message": "gcc.misc-tests/outputs.exp: Use link test to check for -gsplit-dwarf support\n\nWe have noticed that, when running the GCC testsuite on AArch64\nRTEMS 6, we have about 150 tests failing due to a link failure.\nWhen investigating, we found that all the tests were failing\ndue to the use of -gsplit-dwarf.\n\nOn this platform, using -gsplit-dwarf currently causes an error\nduring the link:\n\n    | /[...]/ld: a.out section `.unexpected_sections' will not fit\n    |    in region `UNEXPECTED_SECTIONS'\n    | /[...]/ld: region `UNEXPECTED_SECTIONS' overflowed by 56 bytes\n\nThe error is a bit cryptic, but the source of the issue is that\nthe linker does not currently support the sections generated\nby -gsplit-dwarf (.debug_gnu_pubnames, .debug_gnu_pubtypes).\nThis means that the -gsplit-dwarf feature itself really isn't\nsupported on this platform, at least for the moment.\n\nThis commit enhances the -gsplit-dwarf support check to be\na compile-and-link check, rather than just a compile check.\nThis allows it to properly detect that this feature isn't\nsupported on platforms such as AArch64 RTEMS where the compilation\nworks, but not the link.\n\nTested on aarch64-rtems, where a little over 150 tests are now\npassing, instead of failing, as well as on x86_64-linux, where\nthe results are identical, and where the .log file was also manually\ninspected to make sure that the use of the -gsplit-dwarf option\nwas preserved.\n\ngcc/testsuite/ChangeLog:\n\n\t* gcc.misc-tests/outputs.exp: Make the -gsplit-dwarf test\n\ta compile-and-link test rather than a compile-only test.", "tree": {"sha": "d24daf5716ef7ff0769dcbc83912a4606e9b3da8", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/d24daf5716ef7ff0769dcbc83912a4606e9b3da8"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/0aee03cb638c262846f55477b40828f694c846a0", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/0aee03cb638c262846f55477b40828f694c846a0", "html_url": "https://github.com/Rust-GCC/gccrs/commit/0aee03cb638c262846f55477b40828f694c846a0", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/0aee03cb638c262846f55477b40828f694c846a0/comments", "author": {"login": "brobecke", "id": 11981700, "node_id": "MDQ6VXNlcjExOTgxNzAw", "avatar_url": "https://avatars.githubusercontent.com/u/11981700?v=4", "gravatar_id": "", "url": "https://api.github.com/users/brobecke", "html_url": "https://github.com/brobecke", "followers_url": "https://api.github.com/users/brobecke/followers", "following_url": "https://api.github.com/users/brobecke/following{/other_user}", "gists_url": "https://api.github.com/users/brobecke/gists{/gist_id}", "starred_url": "https://api.github.com/users/brobecke/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/brobecke/subscriptions", "organizations_url": "https://api.github.com/users/brobecke/orgs", "repos_url": "https://api.github.com/users/brobecke/repos", "events_url": "https://api.github.com/users/brobecke/events{/privacy}", "received_events_url": "https://api.github.com/users/brobecke/received_events", "type": "User", "site_admin": false}, "committer": {"login": "brobecke", "id": 11981700, "node_id": "MDQ6VXNlcjExOTgxNzAw", "avatar_url": "https://avatars.githubusercontent.com/u/11981700?v=4", "gravatar_id": "", "url": "https://api.github.com/users/brobecke", "html_url": "https://github.com/brobecke", "followers_url": "https://api.github.com/users/brobecke/followers", "following_url": "https://api.github.com/users/brobecke/following{/other_user}", "gists_url": "https://api.github.com/users/brobecke/gists{/gist_id}", "starred_url": "https://api.github.com/users/brobecke/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/brobecke/subscriptions", "organizations_url": "https://api.github.com/users/brobecke/orgs", "repos_url": "https://api.github.com/users/brobecke/repos", "events_url": "https://api.github.com/users/brobecke/events{/privacy}", "received_events_url": "https://api.github.com/users/brobecke/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "72f76540ad0e7185d4f516e781e8bead13ebc170", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/72f76540ad0e7185d4f516e781e8bead13ebc170", "html_url": "https://github.com/Rust-GCC/gccrs/commit/72f76540ad0e7185d4f516e781e8bead13ebc170"}], "stats": {"total": 4, "additions": 2, "deletions": 2}, "files": [{"sha": "afae735e92d76fe86f984609a6bb1e973dbe9e5e", "filename": "gcc/testsuite/gcc.misc-tests/outputs.exp", "status": "modified", "additions": 2, "deletions": 2, "changes": 4, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/0aee03cb638c262846f55477b40828f694c846a0/gcc%2Ftestsuite%2Fgcc.misc-tests%2Foutputs.exp", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/0aee03cb638c262846f55477b40828f694c846a0/gcc%2Ftestsuite%2Fgcc.misc-tests%2Foutputs.exp", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgcc.misc-tests%2Foutputs.exp?ref=0aee03cb638c262846f55477b40828f694c846a0", "patch": "@@ -36,8 +36,8 @@ gcc_parallel_test_enable 0\n # having to deal with .dSYM directories, as long as -gsplit-dwarf is\n # not supported on platforms that use .dSYM directories.\n set gsplit_dwarf \"-g -gsplit-dwarf\"\n-if ![check_no_compiler_messages gsplitdwarf object {\n-    void foo (void) { }\n+if ![check_no_compiler_messages gsplitdwarf executable {\n+    int main (void) { return 0; }\n } \"$gsplit_dwarf\"] {\n     set gsplit_dwarf \"\"\n }"}]}