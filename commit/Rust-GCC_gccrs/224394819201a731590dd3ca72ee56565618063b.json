{"sha": "224394819201a731590dd3ca72ee56565618063b", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6MjI0Mzk0ODE5MjAxYTczMTU5MGRkM2NhNzJlZTU2NTY1NjE4MDYzYg==", "commit": {"author": {"name": "Jakub Jelinek", "email": "jakub@redhat.com", "date": "2012-02-04T16:51:31Z"}, "committer": {"name": "Jakub Jelinek", "email": "jakub@gcc.gnu.org", "date": "2012-02-04T16:51:31Z"}, "message": "re PR rtl-optimization/52095 (ICE compiling gcc.dg/sms-7.c: SEGV in fprintf)\n\n\tPR rtl-optimization/52095\n\t* modulo-sched.c (dump_insn_locator): New function.\n\t(loop_canon_p, sms_schedule): Use it.\n\nFrom-SVN: r183895", "tree": {"sha": "c1ddc4eafc802a109e3102c8c4937f75196f0bbb", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/c1ddc4eafc802a109e3102c8c4937f75196f0bbb"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/224394819201a731590dd3ca72ee56565618063b", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/224394819201a731590dd3ca72ee56565618063b", "html_url": "https://github.com/Rust-GCC/gccrs/commit/224394819201a731590dd3ca72ee56565618063b", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/224394819201a731590dd3ca72ee56565618063b/comments", "author": {"login": "jakubjelinek", "id": 9370665, "node_id": "MDQ6VXNlcjkzNzA2NjU=", "avatar_url": "https://avatars.githubusercontent.com/u/9370665?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jakubjelinek", "html_url": "https://github.com/jakubjelinek", "followers_url": "https://api.github.com/users/jakubjelinek/followers", "following_url": "https://api.github.com/users/jakubjelinek/following{/other_user}", "gists_url": "https://api.github.com/users/jakubjelinek/gists{/gist_id}", "starred_url": "https://api.github.com/users/jakubjelinek/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jakubjelinek/subscriptions", "organizations_url": "https://api.github.com/users/jakubjelinek/orgs", "repos_url": "https://api.github.com/users/jakubjelinek/repos", "events_url": "https://api.github.com/users/jakubjelinek/events{/privacy}", "received_events_url": "https://api.github.com/users/jakubjelinek/received_events", "type": "User", "site_admin": false}, "committer": null, "parents": [{"sha": "d5785e7634e1269fdb5c710c93d9bc05d5c6130f", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/d5785e7634e1269fdb5c710c93d9bc05d5c6130f", "html_url": "https://github.com/Rust-GCC/gccrs/commit/d5785e7634e1269fdb5c710c93d9bc05d5c6130f"}], "stats": {"total": 72, "additions": 44, "deletions": 28}, "files": [{"sha": "997ee5fa18eb22ca2c003d6ee8c0a0d57d298b07", "filename": "gcc/ChangeLog", "status": "modified", "additions": 4, "deletions": 0, "changes": 4, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/224394819201a731590dd3ca72ee56565618063b/gcc%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/224394819201a731590dd3ca72ee56565618063b/gcc%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2FChangeLog?ref=224394819201a731590dd3ca72ee56565618063b", "patch": "@@ -1,5 +1,9 @@\n 2012-02-04  Jakub Jelinek  <jakub@redhat.com>\n \n+\tPR rtl-optimization/52095\n+\t* modulo-sched.c (dump_insn_locator): New function.\n+\t(loop_canon_p, sms_schedule): Use it.\n+\n \tPR rtl-optimization/52113\n \t* lower-subreg.c (decompose_multiword_subregs): Call recog_memoized\n \teven for decomposable shift/zext insns."}, {"sha": "b1b1af33b268720f59e0e7f66dd7b4aee05c5d4f", "filename": "gcc/modulo-sched.c", "status": "modified", "additions": 40, "deletions": 28, "changes": 68, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/224394819201a731590dd3ca72ee56565618063b/gcc%2Fmodulo-sched.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/224394819201a731590dd3ca72ee56565618063b/gcc%2Fmodulo-sched.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fmodulo-sched.c?ref=224394819201a731590dd3ca72ee56565618063b", "patch": "@@ -1,5 +1,5 @@\n /* Swing Modulo Scheduling implementation.\n-   Copyright (C) 2004, 2005, 2006, 2007, 2008, 2009, 2010, 2011\n+   Copyright (C) 2004, 2005, 2006, 2007, 2008, 2009, 2010, 2011, 2012\n    Free Software Foundation, Inc.\n    Contributed by Ayal Zaks and Mustafa Hagog <zaks,mustafa@il.ibm.com>\n \n@@ -1246,6 +1246,19 @@ loop_single_full_bb_p (struct loop *loop)\n   return true;\n }\n \n+/* Dump file:line from INSN's location info to dump_file.  */\n+\n+static void\n+dump_insn_locator (rtx insn)\n+{\n+  if (dump_file && INSN_LOCATOR (insn))\n+    {\n+      const char *file = insn_file (insn);\n+      if (file)\n+\tfprintf (dump_file, \" %s:%i\", file, insn_line (insn));\n+    }\n+}\n+\n /* A simple loop from SMS point of view; it is a loop that is composed of\n    either a single basic block or two BBs - a header and a latch.  */\n #define SIMPLE_SMS_LOOP_P(loop) ((loop->num_nodes < 3 ) \t\t    \\\n@@ -1271,9 +1284,9 @@ loop_canon_p (struct loop *loop)\n \t{\n \t  rtx insn = BB_END (loop->header);\n \n-\t  fprintf (dump_file, \"SMS loop many exits \");\n-\t  \t  fprintf (dump_file, \" %s %d (file, line)\\n\",\n-\t\t\t   insn_file (insn), insn_line (insn));\n+\t  fprintf (dump_file, \"SMS loop many exits\");\n+\t  dump_insn_locator (insn);\n+\t  fprintf (dump_file, \"\\n\");\n \t}\n       return false;\n     }\n@@ -1284,9 +1297,9 @@ loop_canon_p (struct loop *loop)\n \t{\n \t  rtx insn = BB_END (loop->header);\n \n-\t  fprintf (dump_file, \"SMS loop many BBs. \");\n-\t  fprintf (dump_file, \" %s %d (file, line)\\n\",\n-\t\t   insn_file (insn), insn_line (insn));\n+\t  fprintf (dump_file, \"SMS loop many BBs.\");\n+\t  dump_insn_locator (insn);\n+\t  fprintf (dump_file, \"\\n\");\n \t}\n       return false;\n     }\n@@ -1407,13 +1420,13 @@ sms_schedule (void)\n         }\n \n       if (dump_file)\n-      {\n-         rtx insn = BB_END (loop->header);\n-\n-         fprintf (dump_file, \"SMS loop num: %d, file: %s, line: %d\\n\",\n-                  loop->num, insn_file (insn), insn_line (insn));\n+\t{\n+\t  rtx insn = BB_END (loop->header);\n \n-      }\n+\t  fprintf (dump_file, \"SMS loop num: %d\", loop->num);\n+\t  dump_insn_locator (insn);\n+\t  fprintf (dump_file, \"\\n\");\n+\t}\n \n       if (! loop_canon_p (loop))\n         continue;\n@@ -1440,9 +1453,8 @@ sms_schedule (void)\n \t{\n \t  if (dump_file)\n \t    {\n-\t      fprintf (dump_file, \" %s %d (file, line)\\n\",\n-\t\t       insn_file (tail), insn_line (tail));\n-\t      fprintf (dump_file, \"SMS single-bb-loop\\n\");\n+\t      dump_insn_locator (tail);\n+\t      fprintf (dump_file, \"\\nSMS single-bb-loop\\n\");\n \t      if (profile_info && flag_branch_probabilities)\n \t    \t{\n \t      \t  fprintf (dump_file, \"SMS loop-count \");\n@@ -1543,14 +1555,15 @@ sms_schedule (void)\n         continue;\n \n       if (dump_file)\n-      {\n-         rtx insn = BB_END (loop->header);\n+\t{\n+\t  rtx insn = BB_END (loop->header);\n \n-         fprintf (dump_file, \"SMS loop num: %d, file: %s, line: %d\\n\",\n-                  loop->num, insn_file (insn), insn_line (insn));\n+\t  fprintf (dump_file, \"SMS loop num: %d\", loop->num);\n+\t  dump_insn_locator (insn);\n+\t  fprintf (dump_file, \"\\n\");\n \n-         print_ddg (dump_file, g);\n-      }\n+\t  print_ddg (dump_file, g);\n+\t}\n \n       get_ebb_head_tail (loop->header, loop->header, &head, &tail);\n \n@@ -1561,9 +1574,8 @@ sms_schedule (void)\n \n       if (dump_file)\n \t{\n-\t  fprintf (dump_file, \" %s %d (file, line)\\n\",\n-\t\t   insn_file (tail), insn_line (tail));\n-\t  fprintf (dump_file, \"SMS single-bb-loop\\n\");\n+\t  dump_insn_locator (tail);\n+\t  fprintf (dump_file, \"\\nSMS single-bb-loop\\n\");\n \t  if (profile_info && flag_branch_probabilities)\n \t    {\n \t      fprintf (dump_file, \"SMS loop-count \");\n@@ -1705,9 +1717,9 @@ sms_schedule (void)\n \n           if (dump_file)\n             {\n-\t      fprintf (dump_file,\n-\t\t       \"%s:%d SMS succeeded %d %d (with ii, sc)\\n\",\n-\t\t       insn_file (tail), insn_line (tail), ps->ii, stage_count);\n+\t      dump_insn_locator (tail);\n+\t      fprintf (dump_file, \" SMS succeeded %d %d (with ii, sc)\\n\",\n+\t\t       ps->ii, stage_count);\n \t      print_partial_schedule (ps, dump_file);\n \t    }\n  "}]}