{"sha": "2e6e0d86a06389056d0e7fecc99c547420ad787a", "node_id": "C_kwDOANBUbNoAKDJlNmUwZDg2YTA2Mzg5MDU2ZDBlN2ZlY2M5OWM1NDc0MjBhZDc4N2E", "commit": {"author": {"name": "Patrick Palka", "email": "ppalka@redhat.com", "date": "2021-10-07T14:02:54Z"}, "committer": {"name": "Patrick Palka", "email": "ppalka@redhat.com", "date": "2021-10-07T14:02:54Z"}, "message": "c++: variadic ttp constraint subsumption [PR99904]\n\nHere we're crashing when level-lowering the variadic constraint C<Ts...>\non the template template parameter TT because tsubst_pack_expansion expects\nprocessing_template_decl to be set during a partial substitution.\n\n\tPR c++/99904\n\ngcc/cp/ChangeLog:\n\n\t* pt.c (is_compatible_template_arg): Set processing_template_decl\n\taround tsubst_constraint_info.\n\ngcc/testsuite/ChangeLog:\n\n\t* g++.dg/cpp2a/concepts-ttp4.C: New test.", "tree": {"sha": "135d1870a5006339b21054e2fcec4ed1d5d3a0c1", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/135d1870a5006339b21054e2fcec4ed1d5d3a0c1"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/2e6e0d86a06389056d0e7fecc99c547420ad787a", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/2e6e0d86a06389056d0e7fecc99c547420ad787a", "html_url": "https://github.com/Rust-GCC/gccrs/commit/2e6e0d86a06389056d0e7fecc99c547420ad787a", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/2e6e0d86a06389056d0e7fecc99c547420ad787a/comments", "author": null, "committer": null, "parents": [{"sha": "9b239d05ffd5a17ede44abd55bc6622c6e279868", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/9b239d05ffd5a17ede44abd55bc6622c6e279868", "html_url": "https://github.com/Rust-GCC/gccrs/commit/9b239d05ffd5a17ede44abd55bc6622c6e279868"}], "stats": {"total": 11, "additions": 11, "deletions": 0}, "files": [{"sha": "1e52aa757e1b7165197758b17a5d24375251ac9c", "filename": "gcc/cp/pt.c", "status": "modified", "additions": 2, "deletions": 0, "changes": 2, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/2e6e0d86a06389056d0e7fecc99c547420ad787a/gcc%2Fcp%2Fpt.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/2e6e0d86a06389056d0e7fecc99c547420ad787a/gcc%2Fcp%2Fpt.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fcp%2Fpt.c?ref=2e6e0d86a06389056d0e7fecc99c547420ad787a", "patch": "@@ -8230,8 +8230,10 @@ is_compatible_template_arg (tree parm, tree arg)\n     {\n       tree aparms = DECL_INNERMOST_TEMPLATE_PARMS (arg);\n       new_args = template_parms_level_to_args (aparms);\n+      ++processing_template_decl;\n       parm_cons = tsubst_constraint_info (parm_cons, new_args,\n \t\t\t\t\t  tf_none, NULL_TREE);\n+      --processing_template_decl;\n       if (parm_cons == error_mark_node)\n         return false;\n     }"}, {"sha": "cf3e71ea974b8f2bee058666c4406fe48df4045f", "filename": "gcc/testsuite/g++.dg/cpp2a/concepts-ttp4.C", "status": "added", "additions": 9, "deletions": 0, "changes": 9, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/2e6e0d86a06389056d0e7fecc99c547420ad787a/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Fcpp2a%2Fconcepts-ttp4.C", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/2e6e0d86a06389056d0e7fecc99c547420ad787a/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Fcpp2a%2Fconcepts-ttp4.C", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Fcpp2a%2Fconcepts-ttp4.C?ref=2e6e0d86a06389056d0e7fecc99c547420ad787a", "patch": "@@ -0,0 +1,9 @@\n+// PR c++/99904\n+// { dg-do compile { target c++20 } }\n+\n+template<class... Ts> concept C = (Ts::value && ...);\n+template<class... Ts> requires C<Ts...> struct A;\n+template<class T> requires true struct B;\n+template<template<class... Ts> requires C<Ts...> class TT> struct S;\n+using ty1 = S<A>;\n+using ty2 = S<B>; // { dg-error \"constraint\" } TT's constraints don't subsume B's"}]}