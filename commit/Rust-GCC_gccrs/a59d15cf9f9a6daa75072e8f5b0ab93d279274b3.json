{"sha": "a59d15cf9f9a6daa75072e8f5b0ab93d279274b3", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6YTU5ZDE1Y2Y5ZjlhNmRhYTc1MDcyZThmNWIwYWI5M2QyNzkyNzRiMw==", "commit": {"author": {"name": "Alexandre Oliva", "email": "aoliva@redhat.com", "date": "2011-02-02T04:31:35Z"}, "committer": {"name": "Alexandre Oliva", "email": "aoliva@gcc.gnu.org", "date": "2011-02-02T04:31:35Z"}, "message": "re PR debug/47498 (-fcompare-debug failure with -fsched2-use-superblocks)\n\ngcc/ChangeLog:\nPR debug/47498\nPR debug/47501\nPR debug/45136\nPR debug/45130\n* haifa-sched.c (get_ebb_head_tail): Move notes across boundary\ndebug insns.\n(no_real_insns_p, schedule_block, set_priorities): Drop special\ntreatment of boundary debug insns.\n* sched-deps.c (sd_init_insn, sd_finish_insn): Don't mark debug\ninsns.\n* sched-ebb.c (schedule_ebbs): Adjust skipping of debug insns.\n* sched-int.h (DEBUG_INSN_SCHED_P): Remove.\n(BOUNDARY_DEBUG_INSN_P): Likewise.\n(SCHEDULE_DEBUG_INSN_P): Likewise.\n* sched-rgn.c (init_ready_list): Drop special treatment of\nboundary debug insns.\n* final.c (rest_of_clean_state): Clear notes' BB.\ngcc/testsuite/ChangeLog:\nPR debug/47498\nPR debug/47501\nPR debug/45136\nPR debug/45130\n* debug/pr47498.c: New.\n* debug/pr47501.c: New.\n\nFrom-SVN: r169513", "tree": {"sha": "45c11f92ea932c870f55bc85a553c33839b01d65", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/45c11f92ea932c870f55bc85a553c33839b01d65"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/a59d15cf9f9a6daa75072e8f5b0ab93d279274b3", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/a59d15cf9f9a6daa75072e8f5b0ab93d279274b3", "html_url": "https://github.com/Rust-GCC/gccrs/commit/a59d15cf9f9a6daa75072e8f5b0ab93d279274b3", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/a59d15cf9f9a6daa75072e8f5b0ab93d279274b3/comments", "author": null, "committer": null, "parents": [{"sha": "6fc2f091e7e70574c17d229bb6b9e6db1e0d385a", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/6fc2f091e7e70574c17d229bb6b9e6db1e0d385a", "html_url": "https://github.com/Rust-GCC/gccrs/commit/6fc2f091e7e70574c17d229bb6b9e6db1e0d385a"}], "stats": {"total": 154, "additions": 117, "deletions": 37}, "files": [{"sha": "9ee08dfca07d2d130906babd8454517030df80af", "filename": "gcc/ChangeLog", "status": "modified", "additions": 20, "deletions": 0, "changes": 20, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/a59d15cf9f9a6daa75072e8f5b0ab93d279274b3/gcc%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/a59d15cf9f9a6daa75072e8f5b0ab93d279274b3/gcc%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2FChangeLog?ref=a59d15cf9f9a6daa75072e8f5b0ab93d279274b3", "patch": "@@ -1,3 +1,23 @@\n+2011-02-02  Alexandre Oliva  <aoliva@redhat.com>\n+\n+\tPR debug/47498\n+\tPR debug/47501\n+\tPR debug/45136\n+\tPR debug/45130\n+\t* haifa-sched.c (get_ebb_head_tail): Move notes across boundary\n+\tdebug insns.\n+\t(no_real_insns_p, schedule_block, set_priorities): Drop special\n+\ttreatment of boundary debug insns.\n+\t* sched-deps.c (sd_init_insn, sd_finish_insn): Don't mark debug\n+\tinsns.\n+\t* sched-ebb.c (schedule_ebbs): Adjust skipping of debug insns.\n+\t* sched-int.h (DEBUG_INSN_SCHED_P): Remove.\n+\t(BOUNDARY_DEBUG_INSN_P): Likewise.\n+\t(SCHEDULE_DEBUG_INSN_P): Likewise.\n+\t* sched-rgn.c (init_ready_list): Drop special treatment of\n+\tboundary debug insns.\n+\t* final.c (rest_of_clean_state): Clear notes' BB.\n+\n 2011-02-01  Joseph Myers  <joseph@codesourcery.com>\n \n \t* config/openbsd.opt (assert=): New Driver option."}, {"sha": "ceb79744c414f8f4ed58d3774c5ba2c9e7609b6a", "filename": "gcc/final.c", "status": "modified", "additions": 5, "deletions": 2, "changes": 7, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/a59d15cf9f9a6daa75072e8f5b0ab93d279274b3/gcc%2Ffinal.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/a59d15cf9f9a6daa75072e8f5b0ab93d279274b3/gcc%2Ffinal.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ffinal.c?ref=a59d15cf9f9a6daa75072e8f5b0ab93d279274b3", "patch": "@@ -4402,7 +4402,11 @@ rest_of_clean_state (void)\n \t    if (LABEL_P (insn))\n \t      INSN_UID (insn) = CODE_LABEL_NUMBER (insn);\n \t    else\n-\t      INSN_UID (insn) = 0;\n+\t      {\n+\t\tif (NOTE_P (insn))\n+\t\t  set_block_for_insn (insn, NULL);\n+\t\tINSN_UID (insn) = 0;\n+\t      }\n \t}\n     }\n \n@@ -4423,7 +4427,6 @@ rest_of_clean_state (void)\n \t       && NOTE_KIND (insn) != NOTE_INSN_BLOCK_END\n \t       && NOTE_KIND (insn) != NOTE_INSN_CFA_RESTORE_STATE)))\n \tprint_rtl_single (final_output, insn);\n-\n     }\n \n   if (final_output)"}, {"sha": "9f7d06af6d54c001b06a9ea35fdadf46547a038a", "filename": "gcc/haifa-sched.c", "status": "modified", "additions": 58, "deletions": 6, "changes": 64, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/a59d15cf9f9a6daa75072e8f5b0ab93d279274b3/gcc%2Fhaifa-sched.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/a59d15cf9f9a6daa75072e8f5b0ab93d279274b3/gcc%2Fhaifa-sched.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fhaifa-sched.c?ref=a59d15cf9f9a6daa75072e8f5b0ab93d279274b3", "patch": "@@ -1900,8 +1900,33 @@ get_ebb_head_tail (basic_block beg, basic_block end, rtx *headp, rtx *tailp)\n     beg_head = NEXT_INSN (beg_head);\n \n   while (beg_head != beg_tail)\n-    if (NOTE_P (beg_head) || BOUNDARY_DEBUG_INSN_P (beg_head))\n+    if (NOTE_P (beg_head))\n       beg_head = NEXT_INSN (beg_head);\n+    else if (DEBUG_INSN_P (beg_head))\n+      {\n+\trtx note, next;\n+\n+\tfor (note = NEXT_INSN (beg_head);\n+\t     note != beg_tail;\n+\t     note = next)\n+\t  {\n+\t    next = NEXT_INSN (note);\n+\t    if (NOTE_P (note))\n+\t      {\n+\t\tif (sched_verbose >= 9)\n+\t\t  fprintf (sched_dump, \"reorder %i\\n\", INSN_UID (note));\n+\n+\t\treorder_insns_nobb (note, note, PREV_INSN (beg_head));\n+\n+\t\tif (BLOCK_FOR_INSN (note) != beg)\n+\t\t  df_insn_change_bb (note, beg);\n+\t      }\n+\t    else if (!DEBUG_INSN_P (note))\n+\t      break;\n+\t  }\n+\n+\tbreak;\n+      }\n     else\n       break;\n \n@@ -1913,8 +1938,36 @@ get_ebb_head_tail (basic_block beg, basic_block end, rtx *headp, rtx *tailp)\n     end_head = NEXT_INSN (end_head);\n \n   while (end_head != end_tail)\n-    if (NOTE_P (end_tail) || BOUNDARY_DEBUG_INSN_P (end_tail))\n+    if (NOTE_P (end_tail))\n       end_tail = PREV_INSN (end_tail);\n+    else if (DEBUG_INSN_P (end_tail))\n+      {\n+\trtx note, prev;\n+\n+\tfor (note = PREV_INSN (end_tail);\n+\t     note != end_head;\n+\t     note = prev)\n+\t  {\n+\t    prev = PREV_INSN (note);\n+\t    if (NOTE_P (note))\n+\t      {\n+\t\tif (sched_verbose >= 9)\n+\t\t  fprintf (sched_dump, \"reorder %i\\n\", INSN_UID (note));\n+\n+\t\treorder_insns_nobb (note, note, end_tail);\n+\n+\t\tif (end_tail == BB_END (end))\n+\t\t  BB_END (end) = note;\n+\n+\t\tif (BLOCK_FOR_INSN (note) != end)\n+\t\t  df_insn_change_bb (note, end);\n+\t      }\n+\t    else if (!DEBUG_INSN_P (note))\n+\t      break;\n+\t  }\n+\n+\tbreak;\n+      }\n     else\n       break;\n \n@@ -1928,8 +1981,7 @@ no_real_insns_p (const_rtx head, const_rtx tail)\n {\n   while (head != NEXT_INSN (tail))\n     {\n-      if (!NOTE_P (head) && !LABEL_P (head)\n-\t  && !BOUNDARY_DEBUG_INSN_P (head))\n+      if (!NOTE_P (head) && !LABEL_P (head))\n \treturn 0;\n       head = NEXT_INSN (head);\n     }\n@@ -2812,7 +2864,7 @@ schedule_block (basic_block *target_bb)\n   last_scheduled_insn = prev_head;\n \n   gcc_assert ((NOTE_P (last_scheduled_insn)\n-\t       || BOUNDARY_DEBUG_INSN_P (last_scheduled_insn))\n+\t       || DEBUG_INSN_P (last_scheduled_insn))\n \t      && BLOCK_FOR_INSN (last_scheduled_insn) == *target_bb);\n \n   /* Initialize INSN_QUEUE.  Q_SIZE is the total number of insns in the\n@@ -3319,7 +3371,7 @@ set_priorities (rtx head, rtx tail)\n \tcurrent_sched_info->sched_max_insns_priority;\n   rtx prev_head;\n \n-  if (head == tail && (! INSN_P (head) || BOUNDARY_DEBUG_INSN_P (head)))\n+  if (head == tail && ! INSN_P (head))\n     gcc_unreachable ();\n \n   n_insn = 0;"}, {"sha": "590f4deb4838b157b377e619353033587f2d60fc", "filename": "gcc/sched-deps.c", "status": "modified", "additions": 0, "deletions": 9, "changes": 9, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/a59d15cf9f9a6daa75072e8f5b0ab93d279274b3/gcc%2Fsched-deps.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/a59d15cf9f9a6daa75072e8f5b0ab93d279274b3/gcc%2Fsched-deps.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fsched-deps.c?ref=a59d15cf9f9a6daa75072e8f5b0ab93d279274b3", "patch": "@@ -715,9 +715,6 @@ sd_init_insn (rtx insn)\n   INSN_FORW_DEPS (insn) = create_deps_list ();\n   INSN_RESOLVED_FORW_DEPS (insn) = create_deps_list ();\n \n-  if (DEBUG_INSN_P (insn))\n-    DEBUG_INSN_SCHED_P (insn) = TRUE;\n-\n   /* ??? It would be nice to allocate dependency caches here.  */\n }\n \n@@ -727,12 +724,6 @@ sd_finish_insn (rtx insn)\n {\n   /* ??? It would be nice to deallocate dependency caches here.  */\n \n-  if (DEBUG_INSN_P (insn))\n-    {\n-      gcc_assert (DEBUG_INSN_SCHED_P (insn));\n-      DEBUG_INSN_SCHED_P (insn) = FALSE;\n-    }\n-\n   free_deps_list (INSN_HARD_BACK_DEPS (insn));\n   INSN_HARD_BACK_DEPS (insn) = NULL;\n "}, {"sha": "9fbb9b96f63c21a2302165080d6adb3e2de96ded", "filename": "gcc/sched-ebb.c", "status": "modified", "additions": 2, "deletions": 2, "changes": 4, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/a59d15cf9f9a6daa75072e8f5b0ab93d279274b3/gcc%2Fsched-ebb.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/a59d15cf9f9a6daa75072e8f5b0ab93d279274b3/gcc%2Fsched-ebb.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fsched-ebb.c?ref=a59d15cf9f9a6daa75072e8f5b0ab93d279274b3", "patch": "@@ -598,9 +598,9 @@ schedule_ebbs (void)\n \t a note or two.  */\n       while (head != tail)\n \t{\n-\t  if (NOTE_P (head) || BOUNDARY_DEBUG_INSN_P (head))\n+\t  if (NOTE_P (head) || DEBUG_INSN_P (head))\n \t    head = NEXT_INSN (head);\n-\t  else if (NOTE_P (tail) || BOUNDARY_DEBUG_INSN_P (tail))\n+\t  else if (NOTE_P (tail) || DEBUG_INSN_P (tail))\n \t    tail = PREV_INSN (tail);\n \t  else if (LABEL_P (head))\n \t    head = NEXT_INSN (head);"}, {"sha": "9077c881ce69a73c673286af9c40dab1c053b5ea", "filename": "gcc/sched-int.h", "status": "modified", "additions": 0, "deletions": 17, "changes": 17, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/a59d15cf9f9a6daa75072e8f5b0ab93d279274b3/gcc%2Fsched-int.h", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/a59d15cf9f9a6daa75072e8f5b0ab93d279274b3/gcc%2Fsched-int.h", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fsched-int.h?ref=a59d15cf9f9a6daa75072e8f5b0ab93d279274b3", "patch": "@@ -887,23 +887,6 @@ extern VEC(haifa_deps_insn_data_def, heap) *h_d_i_d;\n #define IS_SPECULATION_BRANCHY_CHECK_P(INSN) \\\n   (RECOVERY_BLOCK (INSN) != NULL && RECOVERY_BLOCK (INSN) != EXIT_BLOCK_PTR)\n \n-/* The unchanging bit tracks whether a debug insn is to be handled\n-   like an insn (i.e., schedule it) or like a note (e.g., it is next\n-   to a basic block boundary.  */\n-#define DEBUG_INSN_SCHED_P(insn) \\\n-  (RTL_FLAG_CHECK1(\"DEBUG_INSN_SCHED_P\", (insn), DEBUG_INSN)->unchanging)\n-\n-/* True if INSN is a debug insn that is next to a basic block\n-   boundary, i.e., it is to be handled by the scheduler like a\n-   note.  */\n-#define BOUNDARY_DEBUG_INSN_P(insn) \\\n-  (DEBUG_INSN_P (insn) && !DEBUG_INSN_SCHED_P (insn))\n-/* True if INSN is a debug insn that is not next to a basic block\n-   boundary, i.e., it is to be handled by the scheduler like an\n-   insn.  */\n-#define SCHEDULE_DEBUG_INSN_P(insn) \\\n-  (DEBUG_INSN_P (insn) && DEBUG_INSN_SCHED_P (insn))\n-\n /* Dep status (aka ds_t) of the link encapsulates information, that is needed\n    for speculative scheduling.  Namely, it is 4 integers in the range\n    [0, MAX_DEP_WEAK] and 3 bits."}, {"sha": "6c4fd46a50f0e2d11d679d32609b5cc24200411f", "filename": "gcc/sched-rgn.c", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/a59d15cf9f9a6daa75072e8f5b0ab93d279274b3/gcc%2Fsched-rgn.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/a59d15cf9f9a6daa75072e8f5b0ab93d279274b3/gcc%2Fsched-rgn.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fsched-rgn.c?ref=a59d15cf9f9a6daa75072e8f5b0ab93d279274b3", "patch": "@@ -2138,7 +2138,7 @@ init_ready_list (void)\n \tsrc_head = head;\n \n \tfor (insn = src_head; insn != src_next_tail; insn = NEXT_INSN (insn))\n-\t  if (INSN_P (insn) && !BOUNDARY_DEBUG_INSN_P (insn))\n+\t  if (INSN_P (insn))\n \t    try_ready (insn);\n       }\n }"}, {"sha": "c2d6ef4fed690c5ac8d86160d1c960dfe607f046", "filename": "gcc/testsuite/ChangeLog", "status": "modified", "additions": 9, "deletions": 0, "changes": 9, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/a59d15cf9f9a6daa75072e8f5b0ab93d279274b3/gcc%2Ftestsuite%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/a59d15cf9f9a6daa75072e8f5b0ab93d279274b3/gcc%2Ftestsuite%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2FChangeLog?ref=a59d15cf9f9a6daa75072e8f5b0ab93d279274b3", "patch": "@@ -1,3 +1,12 @@\n+2011-02-02  Alexandre Oliva  <aoliva@redhat.com>\n+\n+\tPR debug/47498\n+\tPR debug/47501\n+\tPR debug/45136\n+\tPR debug/45130\n+\t* debug/pr47498.c: New.\n+\t* debug/pr47501.c: New.\n+\n 2011-02-01  Richard Guenther  <rguenther@suse.de>\n \n \tPR tree-optimization/47559"}, {"sha": "6bf1484cfaf72663a284c34320508b0d315f061b", "filename": "gcc/testsuite/gcc.dg/debug/pr47498.c", "status": "added", "additions": 11, "deletions": 0, "changes": 11, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/a59d15cf9f9a6daa75072e8f5b0ab93d279274b3/gcc%2Ftestsuite%2Fgcc.dg%2Fdebug%2Fpr47498.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/a59d15cf9f9a6daa75072e8f5b0ab93d279274b3/gcc%2Ftestsuite%2Fgcc.dg%2Fdebug%2Fpr47498.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgcc.dg%2Fdebug%2Fpr47498.c?ref=a59d15cf9f9a6daa75072e8f5b0ab93d279274b3", "patch": "@@ -0,0 +1,11 @@\n+/* { dg-do compile } */\n+/* { dg-options \"-O2 -fsched2-use-superblocks -fcompare-debug\" } */\n+\n+int bar(void *);\n+\n+void foo (void *p)\n+{\n+  int i = 1;\n+  while (i)\n+    i = bar (p);\n+}"}, {"sha": "3bfb5acc7e297f340efd06a812744bd80507c9b8", "filename": "gcc/testsuite/gcc.dg/debug/pr47501.c", "status": "added", "additions": 11, "deletions": 0, "changes": 11, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/a59d15cf9f9a6daa75072e8f5b0ab93d279274b3/gcc%2Ftestsuite%2Fgcc.dg%2Fdebug%2Fpr47501.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/a59d15cf9f9a6daa75072e8f5b0ab93d279274b3/gcc%2Ftestsuite%2Fgcc.dg%2Fdebug%2Fpr47501.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgcc.dg%2Fdebug%2Fpr47501.c?ref=a59d15cf9f9a6daa75072e8f5b0ab93d279274b3", "patch": "@@ -0,0 +1,11 @@\n+/* { dg-do compile } */\n+/* { dg-options \"-Os -fmodulo-sched -fcompare-debug\" } */\n+\n+void\n+foo (void)\n+{\n+  unsigned numlen;\n+  unsigned foldlen;\n+  for (; foldlen; foldlen -= numlen)\n+    foo ();\n+}"}]}