{"sha": "14aca63216fd725e37987ca89d9c485a507d4cd8", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6MTRhY2E2MzIxNmZkNzI1ZTM3OTg3Y2E4OWQ5YzQ4NWE1MDdkNGNkOA==", "commit": {"author": {"name": "Richard Kenner", "email": "kenner@gcc.gnu.org", "date": "1995-05-19T10:58:50Z"}, "committer": {"name": "Richard Kenner", "email": "kenner@gcc.gnu.org", "date": "1995-05-19T10:58:50Z"}, "message": "(process_objc_lib, configure_makefile): New routines.\n\n(bc_all.list, ./vax.md, objc-objs.opt, objc-hdrs.list): New files created\nat config time.\n\nFrom-SVN: r9742", "tree": {"sha": "4abd8479e5f87ff4c71a176117ddfa0cb6b47bf2", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/4abd8479e5f87ff4c71a176117ddfa0cb6b47bf2"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/14aca63216fd725e37987ca89d9c485a507d4cd8", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/14aca63216fd725e37987ca89d9c485a507d4cd8", "html_url": "https://github.com/Rust-GCC/gccrs/commit/14aca63216fd725e37987ca89d9c485a507d4cd8", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/14aca63216fd725e37987ca89d9c485a507d4cd8/comments", "author": null, "committer": null, "parents": [{"sha": "34a28d1ca4cca4db348bcd78141eac6a2109f592", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/34a28d1ca4cca4db348bcd78141eac6a2109f592", "html_url": "https://github.com/Rust-GCC/gccrs/commit/34a28d1ca4cca4db348bcd78141eac6a2109f592"}], "stats": {"total": 62, "additions": 52, "deletions": 10}, "files": [{"sha": "fa08bedb5e74e278d8501349b9f0451015de6f59", "filename": "gcc/vmsconfig.com", "status": "modified", "additions": 52, "deletions": 10, "changes": 62, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/14aca63216fd725e37987ca89d9c485a507d4cd8/gcc%2Fvmsconfig.com", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/14aca63216fd725e37987ca89d9c485a507d4cd8/gcc%2Fvmsconfig.com", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fvmsconfig.com?ref=14aca63216fd725e37987ca89d9c485a507d4cd8", "patch": "@@ -66,9 +66,9 @@ $ call make_lang_incl \"options.h\"\n $ !\n $ call make_lang_incl \"specs.h\"\n $ !\n-$ if f$search(\"md.\") .nes. \"\" then delete md..*\n-$ copy [.config.vax]vax.md []md.\n-$ echo \"Linked `md' to `[.config.vax]vax.md'.\n+$ if f$search(\"vax.md\") .nes. \"\" then delete vax.md;*\n+$ copy [.config.vax]vax.md []vax.md\n+$ echo \"Copied `vax.md' from `[.config.vax]vax.md'.\"\n $ !\n $ if f$search(\"aux-output.c\") .nes. \"\" then delete aux-output.c.*\n $ copy [.config.vax]vax.c []aux-output.c\n@@ -145,6 +145,10 @@ PROCEDURE process_makefile( )\n   SET (NO_WRITE, makefile_buf, ON);\t! Used as workspace; don't save it.\n   SET (OUTPUT_FILE, complist_buf, \"compilers.list\");\n   !\n+  ! Make some textual substitutions.\n+  !\n+  configure_makefile ();\n+  !\n   ! Collect a list of supported compilers (``COMPILERS=xxx'' macro).\n   !\n   identify_compilers ();\n@@ -163,7 +167,7 @@ PROCEDURE process_makefile( )\n   !\n   generate_option_file (\"OBJS\",      \"=\", \"independent.opt\");\n   generate_option_file (\"LIB2FUNCS\", \"=\", \"libgcc2.list\");\n-  generate_option_file (\"BC_ALL\",    \"=\", \"bc_all.opt\");\n+  generate_option_file (\"BC_ALL\",    \"=\", \"bc_all.list\");\n   generate_option_file (\"BI_OBJ\",    \"=\", \"bi_all.opt\");\n   !\n   ! Now change OBJS in the Makefile, so each language specific options file\n@@ -188,6 +192,43 @@ PROCEDURE process_makefile( )\n ENDPROCEDURE; !process_makefile\n !!\n \n+PROCEDURE process_objc_lib( )\n+  !\n+  ! Intrepret objc/Makefile, after finishing the top makefile.\n+  !\n+  ON_ERROR\n+    [TPU$_OPENIN]:\n+      MESSAGE (\"Cannot load objc/Makefile for \"\"ObjClib\"\"; skipping it.\");\n+      RETURN;\n+  ENDON_ERROR;\n+\n+  ERASE (makefile_buf);\t\t\t!discard top Makefile\n+  POSITION (END_OF (makefile_buf));\n+  READ_FILE (\"[.objc]Makefile\");\t!load objc one\n+  MESSAGE (\"objclib\");\n+  pat_replace (ASCII(9), \" \");\t\t!change any <tab> to <space>\n+  generate_option_file (\"OBJC_O\", \"=\", \"objc-objs.opt\");\n+  POSITION (BEGINNING_OF (makefile_buf));\n+  ! Join any continuation lines; we want the header list to be one line.\n+  pat_replace (\"\\\" & LINE_END, );\n+  generate_option_file (\"OBJC_H\", \"=\", \"objc-hdrs.list\");\n+ENDPROCEDURE; !process_objc_lib\n+!!\n+\n+PROCEDURE configure_makefile( )\n+  !\n+  ! Plug in some values normally handled by `configure'.  Rather than\n+  ! replacing the dummy entries, insert the real entries before them.\n+  !\n+  POSITION (BEGINNING_OF (makefile_buf));\n+  COPY_TEXT (\"target=vax-vms\");\t\t\tSPLIT_LINE;\n+  COPY_TEXT (\"out_file=aux-output.c\");\t\tSPLIT_LINE;\t! vax/vax.c\n+  COPY_TEXT (\"out_object_file=aux-output.o\");\tSPLIT_LINE;\t! aux-output.obj\n+  COPY_TEXT (\"md_file=vax.md\");\t\t\tSPLIT_LINE;\t! vax/vax.md\n+  COPY_TEXT (\"tm_file=tm.h\");\t\t\tSPLIT_LINE;\t! vax/tm-vms.h\n+ENDPROCEDURE; !configure_makefile\n+!!\n+\n PROCEDURE identify_compilers( )\n   !\n   ! Retrieve the list of supported compilers from Makefile.in, and put them\n@@ -259,10 +300,11 @@ PROCEDURE generate_option_file( tag_name, punct, outfile_name )\n   ! Now fix up a few things in the output buffer.\n   pat_replace ((\"bytecode\"|\"Makefile\") & (SPAN(\" \")|LINE_END), \" \");\n !#  FILL (CURRENT_BUFFER, \" \", 1, 80, 0);\t! Condense things a bit.\n-  pat_replace (\".\" & (\"o\"|\"c\"|\"h\"|\"y\") & ((SPAN(\" \")&LINE_END)|LINE_END), LINE_END);\n-  pat_replace (\".\" & (\"o\"|\"c\"|\"h\"|\"y\") & SPAN(\" \"), \",\");\n-!#  ! Remove trailing commas, if present.  {Above patterns preclude any such.}\n-!#  pat_replace (\",\" & ((SPAN(\" \")&LINE_END)|LINE_END), LINE_END);\n+  pat_replace (\".\" & (\"o\"|\"c\"|\"y\") & ((SPAN(\" \")&LINE_END)|LINE_END), LINE_END);\n+  pat_replace (\".\" & (\"o\"|\"c\"|\"y\") & SPAN(\" \"), \",\");\n+  pat_replace (\".h\" & (SPAN(\" \")|LINE_END), \".h,\");\n+  ! Remove trailing commas, if present.\n+  pat_replace (\",\" & ((SPAN(\" \")&LINE_END)|LINE_END), LINE_END);\n   ! Get rid of spaces and blank lines.\n   pat_replace (SPAN(\" \"), LINE_END);\n   pat_replace (LINE_BEGIN & LINE_END, );\n@@ -389,14 +431,14 @@ ENDPROCEDURE; !pat_replace\n ! This is the main routine.\n !\n process_makefile ();\n+process_objc_lib ();\t!this uses a different makefile\n QUIT;\t! All done; don't write any modified buffers.\n !!\n $ echo \"\"\n $!\n $! Remove excessive versions of the option files...\n $!\n-$ purge *.opt\n-$ purge compilers.list,libgcc2.list\n+$ purge *.opt,*.list\n $!\n $!\n $!"}]}