{"sha": "ef132d593eb8b2423687ea820f01c4539c9f7151", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6ZWYxMzJkNTkzZWI4YjI0MjM2ODdlYTgyMGYwMWM0NTM5YzlmNzE1MQ==", "commit": {"author": {"name": "Balaji V. Iyer", "email": "balaji.v.iyer@intel.com", "date": "2014-01-20T17:49:22Z"}, "committer": {"name": "Balaji V. Iyer", "email": "bviyer@gcc.gnu.org", "date": "2014-01-20T17:49:22Z"}, "message": "re PR other/58996 (build failure in libcilkrts)\n\nFix for PR other/58996.\n+2014-01-20  Balaji V. Iyer  <balaji.v.iyer@intel.com>\n+\n+       PR other/58996\n+       * configure.ac: Added a check for pthread affinity support.\n+       * runtime/os-unix.c: Likewise.\n+       * configure: Regenerate.\n+\n\nFrom-SVN: r206846", "tree": {"sha": "eb5a127638b9e145246c0b66ed3d8260ff8064dd", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/eb5a127638b9e145246c0b66ed3d8260ff8064dd"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/ef132d593eb8b2423687ea820f01c4539c9f7151", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/ef132d593eb8b2423687ea820f01c4539c9f7151", "html_url": "https://github.com/Rust-GCC/gccrs/commit/ef132d593eb8b2423687ea820f01c4539c9f7151", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/ef132d593eb8b2423687ea820f01c4539c9f7151/comments", "author": null, "committer": null, "parents": [{"sha": "eee0e4879f81a53293079c3398656ebc03758431", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/eee0e4879f81a53293079c3398656ebc03758431", "html_url": "https://github.com/Rust-GCC/gccrs/commit/eee0e4879f81a53293079c3398656ebc03758431"}], "stats": {"total": 64, "additions": 64, "deletions": 0}, "files": [{"sha": "b564ef07d6c09739b779ce04d35140e9e625a8dc", "filename": "libcilkrts/ChangeLog", "status": "modified", "additions": 7, "deletions": 0, "changes": 7, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/ef132d593eb8b2423687ea820f01c4539c9f7151/libcilkrts%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/ef132d593eb8b2423687ea820f01c4539c9f7151/libcilkrts%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libcilkrts%2FChangeLog?ref=ef132d593eb8b2423687ea820f01c4539c9f7151", "patch": "@@ -1,3 +1,10 @@\n+2014-01-20  Balaji V. Iyer  <balaji.v.iyer@intel.com>\n+\n+\tPR other/58996\n+\t* configure.ac: Added a check for pthread affinity support.\n+\t* runtime/os-unix.c: Likewise.\n+\t* configure: Regenerate.\n+\n 2014-01-09  Balaji V. Iyer  <balaji.v.iyer@intel.com>\n \n \tbootstrap/59094"}, {"sha": "63181d78ba588da6ae88b7605566f8a7b5316580", "filename": "libcilkrts/configure", "status": "modified", "additions": 32, "deletions": 0, "changes": 32, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/ef132d593eb8b2423687ea820f01c4539c9f7151/libcilkrts%2Fconfigure", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/ef132d593eb8b2423687ea820f01c4539c9f7151/libcilkrts%2Fconfigure", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libcilkrts%2Fconfigure?ref=ef132d593eb8b2423687ea820f01c4539c9f7151", "patch": "@@ -14420,6 +14420,38 @@ ac_compiler_gnu=$ac_cv_c_compiler_gnu\n \n \n \n+# Check for pthread_{,attr_}[sg]etaffinity_np.\n+cat confdefs.h - <<_ACEOF >conftest.$ac_ext\n+/* end confdefs.h.  */\n+#define _GNU_SOURCE\n+   #include <pthread.h>\n+int\n+main ()\n+{\n+cpu_set_t cpuset;\n+   pthread_attr_t attr;\n+   pthread_getaffinity_np (pthread_self (), sizeof (cpu_set_t), &cpuset);\n+   if (CPU_ISSET (0, &cpuset))\n+     CPU_SET (1, &cpuset);\n+   else\n+     CPU_ZERO (&cpuset);\n+   pthread_setaffinity_np (pthread_self (), sizeof (cpu_set_t), &cpuset);\n+   pthread_attr_init (&attr);\n+   pthread_attr_getaffinity_np (&attr, sizeof (cpu_set_t), &cpuset);\n+   pthread_attr_setaffinity_np (&attr, sizeof (cpu_set_t), &cpuset);\n+  ;\n+  return 0;\n+}\n+_ACEOF\n+if ac_fn_c_try_link \"$LINENO\"; then :\n+\n+$as_echo \"#define HAVE_PTHREAD_AFFINITY_NP 1\" >>confdefs.h\n+\n+fi\n+rm -f core conftest.err conftest.$ac_objext \\\n+    conftest$ac_exeext conftest.$ac_ext\n+\n+\n # Must be last\n cat >confcache <<\\_ACEOF\n # This file is a shell script that caches the results of configure"}, {"sha": "61b45b007230497ff1c6bc67387fb44d3b483aa9", "filename": "libcilkrts/configure.ac", "status": "modified", "additions": 20, "deletions": 0, "changes": 20, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/ef132d593eb8b2423687ea820f01c4539c9f7151/libcilkrts%2Fconfigure.ac", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/ef132d593eb8b2423687ea820f01c4539c9f7151/libcilkrts%2Fconfigure.ac", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libcilkrts%2Fconfigure.ac?ref=ef132d593eb8b2423687ea820f01c4539c9f7151", "patch": "@@ -164,5 +164,25 @@ AC_SUBST(toolexeclibdir)\n \n AC_SUBST(lt_cv_dlopen_libs)\n \n+# Check for pthread_{,attr_}[sg]etaffinity_np.\n+AC_LINK_IFELSE(\n+ [AC_LANG_PROGRAM(\n+  [#define _GNU_SOURCE\n+   #include <pthread.h>],\n+  [cpu_set_t cpuset;\n+   pthread_attr_t attr;\n+   pthread_getaffinity_np (pthread_self (), sizeof (cpu_set_t), &cpuset);\n+   if (CPU_ISSET (0, &cpuset))\n+     CPU_SET (1, &cpuset);\n+   else\n+     CPU_ZERO (&cpuset);\n+   pthread_setaffinity_np (pthread_self (), sizeof (cpu_set_t), &cpuset);\n+   pthread_attr_init (&attr);\n+   pthread_attr_getaffinity_np (&attr, sizeof (cpu_set_t), &cpuset);\n+   pthread_attr_setaffinity_np (&attr, sizeof (cpu_set_t), &cpuset);])],\n+  AC_DEFINE(HAVE_PTHREAD_AFFINITY_NP, 1,\n+[       Define if pthread_{,attr_}{g,s}etaffinity_np is supported.]))\n+\n+\n # Must be last\n AC_OUTPUT"}, {"sha": "fafb91d91a15554fc9b858c21789e3bb3907925c", "filename": "libcilkrts/runtime/os-unix.c", "status": "modified", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/ef132d593eb8b2423687ea820f01c4539c9f7151/libcilkrts%2Fruntime%2Fos-unix.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/ef132d593eb8b2423687ea820f01c4539c9f7151/libcilkrts%2Fruntime%2Fos-unix.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libcilkrts%2Fruntime%2Fos-unix.c?ref=ef132d593eb8b2423687ea820f01c4539c9f7151", "patch": "@@ -311,6 +311,10 @@ static pid_t linux_gettid(void)\n  */\n static int linux_get_affinity_count (int tid) \n {\n+#if !defined HAVE_PTHREAD_AFFINITY_NP\n+  return 0;\n+#else\n+\n     cpu_set_t process_mask;\n \n     // Extract the thread affinity mask\n@@ -337,6 +341,7 @@ static int linux_get_affinity_count (int tid)\n     }\n \n     return available_procs;\n+#endif\n }\n #endif\n "}]}