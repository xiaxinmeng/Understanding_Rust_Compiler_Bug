{"sha": "86e95f35c522136ee6ec8b648b2fd415360774bc", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6ODZlOTVmMzVjNTIyMTM2ZWU2ZWM4YjY0OGIyZmQ0MTUzNjA3NzRiYw==", "commit": {"author": {"name": "P\u00e1draig Brady", "email": "p@draigbrady.com", "date": "2018-09-05T09:59:08Z"}, "committer": {"name": "Nathan Sidwell", "email": "nathan@gcc.gnu.org", "date": "2018-09-05T09:59:08Z"}, "message": "[PR c++/87185] ICE in prune-lambdas\n\nhttps://gcc.gnu.org/ml/gcc-patches/2018-09/msg00249.html\n\tcp/\n\tPR c++/87185\n\t* lambda.c (prune_lambda_captures): Protect against const_vars.get\n\treturning NULL.\n\ttestsuite/\n\tPR c++/87185\n\t* g++.dg/pr87185.C: New.\n\nFrom-SVN: r264118", "tree": {"sha": "6893b66a5908995889c2f03cabce24a941166eb6", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/6893b66a5908995889c2f03cabce24a941166eb6"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/86e95f35c522136ee6ec8b648b2fd415360774bc", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/86e95f35c522136ee6ec8b648b2fd415360774bc", "html_url": "https://github.com/Rust-GCC/gccrs/commit/86e95f35c522136ee6ec8b648b2fd415360774bc", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/86e95f35c522136ee6ec8b648b2fd415360774bc/comments", "author": {"login": "pixelb", "id": 316894, "node_id": "MDQ6VXNlcjMxNjg5NA==", "avatar_url": "https://avatars.githubusercontent.com/u/316894?v=4", "gravatar_id": "", "url": "https://api.github.com/users/pixelb", "html_url": "https://github.com/pixelb", "followers_url": "https://api.github.com/users/pixelb/followers", "following_url": "https://api.github.com/users/pixelb/following{/other_user}", "gists_url": "https://api.github.com/users/pixelb/gists{/gist_id}", "starred_url": "https://api.github.com/users/pixelb/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/pixelb/subscriptions", "organizations_url": "https://api.github.com/users/pixelb/orgs", "repos_url": "https://api.github.com/users/pixelb/repos", "events_url": "https://api.github.com/users/pixelb/events{/privacy}", "received_events_url": "https://api.github.com/users/pixelb/received_events", "type": "User", "site_admin": false}, "committer": null, "parents": [{"sha": "888157af3ef730e1e66c5e84ade11036a09d2205", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/888157af3ef730e1e66c5e84ade11036a09d2205", "html_url": "https://github.com/Rust-GCC/gccrs/commit/888157af3ef730e1e66c5e84ade11036a09d2205"}], "stats": {"total": 21, "additions": 18, "deletions": 3}, "files": [{"sha": "498b1fa9252b5bb982d80885da0107816412caea", "filename": "gcc/cp/ChangeLog", "status": "modified", "additions": 6, "deletions": 0, "changes": 6, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/86e95f35c522136ee6ec8b648b2fd415360774bc/gcc%2Fcp%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/86e95f35c522136ee6ec8b648b2fd415360774bc/gcc%2Fcp%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fcp%2FChangeLog?ref=86e95f35c522136ee6ec8b648b2fd415360774bc", "patch": "@@ -1,3 +1,9 @@\n+2018-09-05   P\u00e1draig Brady p@draigbrady.com\n+\n+\tPR c++/87185\n+\t* lambda.c (prune_lambda_captures): Protect against const_vars.get\n+\treturning NULL.\n+\n 2018-09-04  Marek Polacek  <polacek@redhat.com>\n \n \t* cp-tree.h (treat_lvalue_as_rvalue_p): Declare."}, {"sha": "297327f1ab6bc159fa6e683b4d3a2e9cc44f19f1", "filename": "gcc/cp/lambda.c", "status": "modified", "additions": 3, "deletions": 3, "changes": 6, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/86e95f35c522136ee6ec8b648b2fd415360774bc/gcc%2Fcp%2Flambda.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/86e95f35c522136ee6ec8b648b2fd415360774bc/gcc%2Fcp%2Flambda.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fcp%2Flambda.c?ref=86e95f35c522136ee6ec8b648b2fd415360774bc", "patch": "@@ -1519,8 +1519,8 @@ prune_lambda_captures (tree body)\n       tree cap = *capp;\n       if (tree var = var_to_maybe_prune (cap))\n \t{\n-\t  tree *use = *const_vars.get (var);\n-\t  if (TREE_CODE (*use) == DECL_EXPR)\n+\t  tree **use = const_vars.get (var);\n+\t  if (use && TREE_CODE (**use) == DECL_EXPR)\n \t    {\n \t      /* All uses of this capture were folded away, leaving only the\n \t\t proxy declaration.  */\n@@ -1535,7 +1535,7 @@ prune_lambda_captures (tree body)\n \t      *fieldp = DECL_CHAIN (*fieldp);\n \n \t      /* And remove the capture proxy declaration.  */\n-\t      *use = void_node;\n+\t      **use = void_node;\n \t      continue;\n \t    }\n \t}"}, {"sha": "2b22784192917d75ce930e182b4641442133504f", "filename": "gcc/testsuite/ChangeLog", "status": "modified", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/86e95f35c522136ee6ec8b648b2fd415360774bc/gcc%2Ftestsuite%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/86e95f35c522136ee6ec8b648b2fd415360774bc/gcc%2Ftestsuite%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2FChangeLog?ref=86e95f35c522136ee6ec8b648b2fd415360774bc", "patch": "@@ -1,3 +1,8 @@\n+2018-09-05   P\u00e1draig Brady p@draigbrady.com\n+\n+\tPR c++/87185\n+\t* g++.dg/pr87185.C: New.\n+\n 2018-09-05  Martin Liska  <mliska@suse.cz>\n \n \tPR testsuite/87216"}, {"sha": "46dae0eec0ff00cbf61d8bb0711671cf73306d7e", "filename": "gcc/testsuite/g++.dg/pr87185.C", "status": "added", "additions": 4, "deletions": 0, "changes": 4, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/86e95f35c522136ee6ec8b648b2fd415360774bc/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Fpr87185.C", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/86e95f35c522136ee6ec8b648b2fd415360774bc/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Fpr87185.C", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Fpr87185.C?ref=86e95f35c522136ee6ec8b648b2fd415360774bc", "patch": "@@ -0,0 +1,4 @@\n+// PR c++/87185\n+// { dg-do compile { target c++11 } }\n+\n+void f() { const int i=0; [&]() noexcept {i;}; }"}]}