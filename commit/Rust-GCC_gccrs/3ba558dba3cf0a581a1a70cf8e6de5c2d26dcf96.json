{"sha": "3ba558dba3cf0a581a1a70cf8e6de5c2d26dcf96", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6M2JhNTU4ZGJhM2NmMGE1ODFhMWE3MGNmOGU2ZGU1YzJkMjZkY2Y5Ng==", "commit": {"author": {"name": "Tobias Burnus", "email": "burnus@net-b.de", "date": "2009-06-16T06:57:09Z"}, "committer": {"name": "Tobias Burnus", "email": "burnus@gcc.gnu.org", "date": "2009-06-16T06:57:09Z"}, "message": "re PR fortran/40383 (incorrect bounds checking with optional character arguments)\n\n2009-06-16  Tobias Burnus  <burnus@net-b.de>\n\n        PR fortran/40383\n        * trans-decl.c (create_function_arglist): Copy formal charlist\n        * to\n        have a proper passed_length for -fcheck=bounds.\n\n2009-06-16  Tobias Burnus  <burnus@net-b.de>\n\n        PR fortran/40383\n        * gfortran.dg/bounds_check_strlen_8.f90: New test.\n\nFrom-SVN: r148517", "tree": {"sha": "205736e3cbd655e275ab02652e0d08fb6bf61999", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/205736e3cbd655e275ab02652e0d08fb6bf61999"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/3ba558dba3cf0a581a1a70cf8e6de5c2d26dcf96", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/3ba558dba3cf0a581a1a70cf8e6de5c2d26dcf96", "html_url": "https://github.com/Rust-GCC/gccrs/commit/3ba558dba3cf0a581a1a70cf8e6de5c2d26dcf96", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/3ba558dba3cf0a581a1a70cf8e6de5c2d26dcf96/comments", "author": {"login": "tob2", "id": 264461, "node_id": "MDQ6VXNlcjI2NDQ2MQ==", "avatar_url": "https://avatars.githubusercontent.com/u/264461?v=4", "gravatar_id": "", "url": "https://api.github.com/users/tob2", "html_url": "https://github.com/tob2", "followers_url": "https://api.github.com/users/tob2/followers", "following_url": "https://api.github.com/users/tob2/following{/other_user}", "gists_url": "https://api.github.com/users/tob2/gists{/gist_id}", "starred_url": "https://api.github.com/users/tob2/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/tob2/subscriptions", "organizations_url": "https://api.github.com/users/tob2/orgs", "repos_url": "https://api.github.com/users/tob2/repos", "events_url": "https://api.github.com/users/tob2/events{/privacy}", "received_events_url": "https://api.github.com/users/tob2/received_events", "type": "User", "site_admin": false}, "committer": null, "parents": [{"sha": "d376d545761090780438ccc15792c23fac1762d7", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/d376d545761090780438ccc15792c23fac1762d7", "html_url": "https://github.com/Rust-GCC/gccrs/commit/d376d545761090780438ccc15792c23fac1762d7"}], "stats": {"total": 67, "additions": 67, "deletions": 0}, "files": [{"sha": "0616247424c5a8a1e0f59747b026ad1fdb7ef9b8", "filename": "gcc/fortran/ChangeLog", "status": "modified", "additions": 6, "deletions": 0, "changes": 6, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/3ba558dba3cf0a581a1a70cf8e6de5c2d26dcf96/gcc%2Ffortran%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/3ba558dba3cf0a581a1a70cf8e6de5c2d26dcf96/gcc%2Ffortran%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ffortran%2FChangeLog?ref=3ba558dba3cf0a581a1a70cf8e6de5c2d26dcf96", "patch": "@@ -1,3 +1,9 @@\n+2009-06-16  Tobias Burnus  <burnus@net-b.de>\n+\n+\tPR fortran/40383\n+\t* trans-decl.c (create_function_arglist): Copy formal charlist to\n+\thave a proper passed_length for -fcheck=bounds.\n+\n 2009-06-12  Steven G. Kargl  <kargls@comcast.net>\n \n \t* arith.c (gfc_enum_initializer): Move function ..."}, {"sha": "5af00a91a0357bd015c212981f7076ed6f1901f9", "filename": "gcc/fortran/trans-decl.c", "status": "modified", "additions": 16, "deletions": 0, "changes": 16, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/3ba558dba3cf0a581a1a70cf8e6de5c2d26dcf96/gcc%2Ffortran%2Ftrans-decl.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/3ba558dba3cf0a581a1a70cf8e6de5c2d26dcf96/gcc%2Ffortran%2Ftrans-decl.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ffortran%2Ftrans-decl.c?ref=3ba558dba3cf0a581a1a70cf8e6de5c2d26dcf96", "patch": "@@ -1709,6 +1709,22 @@ create_function_arglist (gfc_symbol * sym)\n \t  gfc_finish_decl (length);\n \n \t  /* Remember the passed value.  */\n+          if (f->sym->ts.cl->passed_length != NULL)\n+            {\n+\t      /* This can happen if the same type is used for multiple\n+\t\t arguments. We need to copy cl as otherwise\n+\t\t cl->passed_length gets overwritten.  */\n+\t      gfc_charlen *cl, *cl2;\n+\t      cl = f->sym->ts.cl;\n+\t      f->sym->ts.cl = gfc_get_charlen();\n+\t      f->sym->ts.cl->length = cl->length;\n+\t      f->sym->ts.cl->backend_decl = cl->backend_decl;\n+\t      f->sym->ts.cl->length_from_typespec = cl->length_from_typespec;\n+\t      f->sym->ts.cl->resolved = cl->resolved;\n+\t      cl2 = f->sym->ts.cl->next;\n+\t      f->sym->ts.cl->next = cl;\n+              cl->next = cl2;\n+            }\n \t  f->sym->ts.cl->passed_length = length;\n \n \t  /* Use the passed value for assumed length variables.  */"}, {"sha": "fdfc5a661704eabc5378029bedd1f62b5982cc01", "filename": "gcc/testsuite/ChangeLog", "status": "modified", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/3ba558dba3cf0a581a1a70cf8e6de5c2d26dcf96/gcc%2Ftestsuite%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/3ba558dba3cf0a581a1a70cf8e6de5c2d26dcf96/gcc%2Ftestsuite%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2FChangeLog?ref=3ba558dba3cf0a581a1a70cf8e6de5c2d26dcf96", "patch": "@@ -1,3 +1,8 @@\n+2009-06-16  Tobias Burnus  <burnus@net-b.de>\n+\n+\tPR fortran/40383\n+\t* gfortran.dg/bounds_check_strlen_8.f90: New test.\n+\n 2009-06-15  Ian Lance Taylor  <iant@google.com>\n \n \t* gcc.dg/Wjump-misses-init-1.c: New testcase."}, {"sha": "c54f14144f83dbaa0e333e203b9cd508046c566e", "filename": "gcc/testsuite/gfortran.dg/bounds_check_strlen_8.f90", "status": "added", "additions": 40, "deletions": 0, "changes": 40, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/3ba558dba3cf0a581a1a70cf8e6de5c2d26dcf96/gcc%2Ftestsuite%2Fgfortran.dg%2Fbounds_check_strlen_8.f90", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/3ba558dba3cf0a581a1a70cf8e6de5c2d26dcf96/gcc%2Ftestsuite%2Fgfortran.dg%2Fbounds_check_strlen_8.f90", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgfortran.dg%2Fbounds_check_strlen_8.f90?ref=3ba558dba3cf0a581a1a70cf8e6de5c2d26dcf96", "patch": "@@ -0,0 +1,40 @@\n+! { dg-do run }\n+! { dg-options \"-fbounds-check\" }\n+!\n+! PR fortran/40383\n+! Gave before a bogus out of bounds.\n+! Contributed by Joost VandeVondele.\n+!\n+MODULE M1\n+  INTEGER, PARAMETER :: default_string_length=80\n+END MODULE M1\n+MODULE M2\n+ USE M1\n+ IMPLICIT NONE\n+CONTAINS\n+ FUNCTION F1(a,b,c,d) RESULT(RES)\n+   CHARACTER(LEN=default_string_length), OPTIONAL :: a,b,c,d\n+   LOGICAL :: res\n+ END FUNCTION F1\n+END MODULE M2\n+\n+MODULE M3\n+ USE M1\n+ USE M2\n+ IMPLICIT NONE\n+CONTAINS\n+ SUBROUTINE S1\n+   CHARACTER(LEN=default_string_length) :: a,b\n+   LOGICAL :: L1\n+   INTEGER :: i\n+   DO I=1,10\n+      L1=F1(a,b)\n+   ENDDO\n+ END SUBROUTINE\n+END MODULE M3\n+\n+USE M3\n+CALL S1\n+END\n+\n+! { dg-final { cleanup-modules \"m1 m2 m3\" } }"}]}