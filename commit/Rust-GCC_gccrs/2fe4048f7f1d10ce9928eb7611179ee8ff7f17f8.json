{"sha": "2fe4048f7f1d10ce9928eb7611179ee8ff7f17f8", "node_id": "C_kwDOANBUbNoAKDJmZTQwNDhmN2YxZDEwY2U5OTI4ZWI3NjExMTc5ZWU4ZmY3ZjE3Zjg", "commit": {"author": {"name": "liushuyu", "email": "liushuyu011@gmail.com", "date": "2022-04-11T21:20:41Z"}, "committer": {"name": "liushuyu", "email": "liushuyu011@gmail.com", "date": "2022-04-12T08:18:56Z"}, "message": "macros: fix an infinite loop ...\n\n... introduced in fed5a41fb1c2c91b77297fdd6d3731078f480441, should fix #1102\n\nSigned-off-by: Zixing Liu <liushuyu011@gmail.com>", "tree": {"sha": "c244b5d6b3b38f5a4423825cadc0f09686f3def2", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/c244b5d6b3b38f5a4423825cadc0f09686f3def2"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/2fe4048f7f1d10ce9928eb7611179ee8ff7f17f8", "comment_count": 0, "verification": {"verified": true, "reason": "valid", "signature": "-----BEGIN PGP SIGNATURE-----\n\niQIzBAABCAAdFiEE6x/rcKrl3aOwzUVJI9HORTRBlDcFAmJVNfMACgkQI9HORTRB\nlDcEkhAAls62a8YR5W2LUVG3gDEpw1apDE0/y7y8U25S8BkJGTPgXS7I/TurP7iR\nM1+G7UPrHmeXWTZO6H+Wzi0sPM+rxwkWAfcUmDi+YKj798wMh92FxMl0y/5JUks5\nbX7HVuLeySbCC+P0HiEqZRKr98drZk+2IoskdiJqriWmNkimREdw3ZU/l71VKaMp\n9HTNE2VHqnUkFMqY+iH2m6nDFEmQM0qOZFomqdSpArGxuUCryLhhDm4dD37lisYo\nsm1AsIai374SepKr/JXzPVppPIVkCR8ieI7irYc58Lv7oLtNC2KX3MDSsIJjOcYm\neAMQewGddsX0rnz2luwaqlMu5PmPtlpb4KSHS5TEHx9RnWZwRyRM4DKUdqoOQ37c\ntEXRxN4i38ZqOrneQItg9eGswf4CnTZz7DIJbbfrJnLkFdxceyWyLKI6Vob0Att5\nNhoonpF62SXhaH0cH0cdKUgbf3pXkXAWlGRZ2nKox66vOgo8rKfbIkc3TqL4bmr/\n2BB2RRXNdWOSNFOwmY/amrl3Hxl8o+72KywfU+U15eABpcIme0zTbinNBadKtWvc\nm+5Tyf3AgSQBaLE0CDCW6GcXD6XZi1gxuvyNqigMzq7dNsULHYD0Htnl1onasScS\nfQkh7AFqarlt01cOk0KI7hg83Sy5xC4zJkWl2jLr8ubCnc2l7f0=\n=Yeho\n-----END PGP SIGNATURE-----", "payload": "tree c244b5d6b3b38f5a4423825cadc0f09686f3def2\nparent 68458036c81d141a3899ac4e6ec6ddf0fdfde174\nauthor liushuyu <liushuyu011@gmail.com> 1649712041 -0600\ncommitter liushuyu <liushuyu011@gmail.com> 1649751536 -0600\n\nmacros: fix an infinite loop ...\n\n... introduced in fed5a41fb1c2c91b77297fdd6d3731078f480441, should fix #1102\n\nSigned-off-by: Zixing Liu <liushuyu011@gmail.com>\n"}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/2fe4048f7f1d10ce9928eb7611179ee8ff7f17f8", "html_url": "https://github.com/Rust-GCC/gccrs/commit/2fe4048f7f1d10ce9928eb7611179ee8ff7f17f8", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/2fe4048f7f1d10ce9928eb7611179ee8ff7f17f8/comments", "author": {"login": "liushuyu", "id": 6829345, "node_id": "MDQ6VXNlcjY4MjkzNDU=", "avatar_url": "https://avatars.githubusercontent.com/u/6829345?v=4", "gravatar_id": "", "url": "https://api.github.com/users/liushuyu", "html_url": "https://github.com/liushuyu", "followers_url": "https://api.github.com/users/liushuyu/followers", "following_url": "https://api.github.com/users/liushuyu/following{/other_user}", "gists_url": "https://api.github.com/users/liushuyu/gists{/gist_id}", "starred_url": "https://api.github.com/users/liushuyu/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/liushuyu/subscriptions", "organizations_url": "https://api.github.com/users/liushuyu/orgs", "repos_url": "https://api.github.com/users/liushuyu/repos", "events_url": "https://api.github.com/users/liushuyu/events{/privacy}", "received_events_url": "https://api.github.com/users/liushuyu/received_events", "type": "User", "site_admin": false}, "committer": {"login": "liushuyu", "id": 6829345, "node_id": "MDQ6VXNlcjY4MjkzNDU=", "avatar_url": "https://avatars.githubusercontent.com/u/6829345?v=4", "gravatar_id": "", "url": "https://api.github.com/users/liushuyu", "html_url": "https://github.com/liushuyu", "followers_url": "https://api.github.com/users/liushuyu/followers", "following_url": "https://api.github.com/users/liushuyu/following{/other_user}", "gists_url": "https://api.github.com/users/liushuyu/gists{/gist_id}", "starred_url": "https://api.github.com/users/liushuyu/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/liushuyu/subscriptions", "organizations_url": "https://api.github.com/users/liushuyu/orgs", "repos_url": "https://api.github.com/users/liushuyu/repos", "events_url": "https://api.github.com/users/liushuyu/events{/privacy}", "received_events_url": "https://api.github.com/users/liushuyu/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "68458036c81d141a3899ac4e6ec6ddf0fdfde174", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/68458036c81d141a3899ac4e6ec6ddf0fdfde174", "html_url": "https://github.com/Rust-GCC/gccrs/commit/68458036c81d141a3899ac4e6ec6ddf0fdfde174"}], "stats": {"total": 14, "additions": 9, "deletions": 5}, "files": [{"sha": "1f41545ba38be8bc76880d5059690472136f26e0", "filename": "gcc/rust/expand/rust-macro-builtins.cc", "status": "modified", "additions": 4, "deletions": 1, "changes": 5, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/2fe4048f7f1d10ce9928eb7611179ee8ff7f17f8/gcc%2Frust%2Fexpand%2Frust-macro-builtins.cc", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/2fe4048f7f1d10ce9928eb7611179ee8ff7f17f8/gcc%2Frust%2Fexpand%2Frust-macro-builtins.cc", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Frust%2Fexpand%2Frust-macro-builtins.cc?ref=2fe4048f7f1d10ce9928eb7611179ee8ff7f17f8", "patch": "@@ -287,9 +287,12 @@ MacroBuiltin::concat (Location invoc_locus, AST::MacroInvocData &invoc)\n \t}\n       else\n \t{\n-\t  rust_error_at (parser.peek_current_token ()->get_locus (),\n+\t  auto current_token = parser.peek_current_token ();\n+\t  rust_error_at (current_token->get_locus (),\n \t\t\t \"argument must be a constant literal\");\n \t  has_error = true;\n+\t  // Just crash if the current token can't be skipped\n+\t  rust_assert (parser.skip_token (current_token->get_id ()));\n \t}\n       parser.maybe_skip_token (COMMA);\n     }"}, {"sha": "b37f80fc29912ccb21f626259d844c797a05585a", "filename": "gcc/testsuite/rust/compile/builtin_macro_concat.rs", "status": "modified", "additions": 5, "deletions": 4, "changes": 9, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/2fe4048f7f1d10ce9928eb7611179ee8ff7f17f8/gcc%2Ftestsuite%2Frust%2Fcompile%2Fbuiltin_macro_concat.rs", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/2fe4048f7f1d10ce9928eb7611179ee8ff7f17f8/gcc%2Ftestsuite%2Frust%2Fcompile%2Fbuiltin_macro_concat.rs", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Frust%2Fcompile%2Fbuiltin_macro_concat.rs?ref=2fe4048f7f1d10ce9928eb7611179ee8ff7f17f8", "patch": "@@ -3,13 +3,14 @@ macro_rules! concat {\n }\n \n fn main() {\n-    // let not_literal = \"identifier\";\n+    let not_literal = \"identifier\";\n     concat!();\n-    // concat! (,); // { error \"argument must be a constant literal\" }\n-    // concat!(not_literal); // { error \"argument must be a constant literal\" }\n+    concat! (,); // { dg-error \"argument must be a constant literal\" }\n+    concat!(not_literal); // { dg-error \"argument must be a constant literal\" }\n     concat!(\"message\");\n     concat!(\"message\",);\n     concat!(\"message\", 1, true, false, 1.0, 10usize, 2000u64);\n     concat!(\"message\", 1, true, false, 1.0, 10usize, 2000u64,);\n-    // concat! (\"m\", not_literal); // { error \"argument must be a constant literal\" }\n+    concat! (\"m\", not_literal); // { dg-error \"argument must be a constant literal\" }\n+    concat!(not_literal invalid 'm' !!,); // { dg-error \"argument must be a constant literal\" }\n }"}]}