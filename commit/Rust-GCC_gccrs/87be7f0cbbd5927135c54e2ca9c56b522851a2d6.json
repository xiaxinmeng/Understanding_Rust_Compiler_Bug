{"sha": "87be7f0cbbd5927135c54e2ca9c56b522851a2d6", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6ODdiZTdmMGNiYmQ1OTI3MTM1YzU0ZTJjYTljNTZiNTIyODUxYTJkNg==", "commit": {"author": {"name": "Jan Hubicka", "email": "hubicka@ucw.cz", "date": "2015-02-17T08:58:37Z"}, "committer": {"name": "Jan Hubicka", "email": "hubicka@gcc.gnu.org", "date": "2015-02-17T08:58:37Z"}, "message": "symtab.c (symtab_node::verify_base): Verify body_removed->!definiton\n\n\t* symtab.c (symtab_node::verify_base): Verify body_removed->!definiton\n\t* lto-cgraph.c (lto_output_varpool_node): Do not keep definition of\n\tvariables in boundary that have no inlitalizer encoded and are\n\tnot aliases.\n\t* varasm.c (default_binds_local_p_2): External definitions do not\n\tcount as definitions here.\n\nFrom-SVN: r220749", "tree": {"sha": "9264313f245864186f9fda4ff8b7a195578c0634", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/9264313f245864186f9fda4ff8b7a195578c0634"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/87be7f0cbbd5927135c54e2ca9c56b522851a2d6", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/87be7f0cbbd5927135c54e2ca9c56b522851a2d6", "html_url": "https://github.com/Rust-GCC/gccrs/commit/87be7f0cbbd5927135c54e2ca9c56b522851a2d6", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/87be7f0cbbd5927135c54e2ca9c56b522851a2d6/comments", "author": null, "committer": null, "parents": [{"sha": "4414e22eeeaaf9dbd41f182173aa0a23ee792d1a", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/4414e22eeeaaf9dbd41f182173aa0a23ee792d1a", "html_url": "https://github.com/Rust-GCC/gccrs/commit/4414e22eeeaaf9dbd41f182173aa0a23ee792d1a"}], "stats": {"total": 32, "additions": 28, "deletions": 4}, "files": [{"sha": "d7fc1f4b06ac1a7e1a835fb563fc18ebcda18dbb", "filename": "gcc/ChangeLog", "status": "modified", "additions": 9, "deletions": 0, "changes": 9, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/87be7f0cbbd5927135c54e2ca9c56b522851a2d6/gcc%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/87be7f0cbbd5927135c54e2ca9c56b522851a2d6/gcc%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2FChangeLog?ref=87be7f0cbbd5927135c54e2ca9c56b522851a2d6", "patch": "@@ -1,3 +1,12 @@\n+2015-02-16  Jan Hubicka  <hubicka@ucw.cz>\n+\n+\t* symtab.c (symtab_node::verify_base): Verify body_removed->!definiton\n+\t* lto-cgraph.c (lto_output_varpool_node): Do not keep definition of\n+\tvariables in boundary that have no inlitalizer encoded and are\n+\tnot aliases.\n+\t* varasm.c (default_binds_local_p_2): External definitions do not\n+\tcount as definitions here.\n+\n 2015-02-16  Jeff Law  <law@redhat.com>\n \n \tPR tree-optimization/64823"}, {"sha": "6add7fdf3d8f1e171edf5d14edcc9f3c5f75d2ae", "filename": "gcc/lto-cgraph.c", "status": "modified", "additions": 12, "deletions": 3, "changes": 15, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/87be7f0cbbd5927135c54e2ca9c56b522851a2d6/gcc%2Flto-cgraph.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/87be7f0cbbd5927135c54e2ca9c56b522851a2d6/gcc%2Flto-cgraph.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Flto-cgraph.c?ref=87be7f0cbbd5927135c54e2ca9c56b522851a2d6", "patch": "@@ -608,12 +608,18 @@ lto_output_varpool_node (struct lto_simple_output_block *ob, varpool_node *node,\n \t\t\t lto_symtab_encoder_t encoder)\n {\n   bool boundary_p = !lto_symtab_encoder_in_partition_p (encoder, node);\n+  bool encode_initializer_p\n+\t = (node->definition\n+\t    && lto_symtab_encoder_encode_initializer_p (encoder, node));\n   struct bitpack_d bp;\n   int ref;\n   const char *comdat;\n   const char *section;\n   tree group;\n \n+  gcc_assert (!encode_initializer_p || node->definition);\n+  gcc_assert (boundary_p || encode_initializer_p);\n+\n   streamer_write_enum (ob->main_stream, LTO_symtab_tags, LTO_symtab_last_tag,\n \t\t       LTO_symtab_variable);\n   streamer_write_hwi_stream (ob->main_stream, node->order);\n@@ -624,11 +630,14 @@ lto_output_varpool_node (struct lto_simple_output_block *ob, varpool_node *node,\n   bp_pack_value (&bp, node->force_output, 1);\n   bp_pack_value (&bp, node->forced_by_abi, 1);\n   bp_pack_value (&bp, node->unique_name, 1);\n-  bp_pack_value (&bp, node->body_removed\n-\t\t || !lto_symtab_encoder_encode_initializer_p (encoder, node), 1);\n+  bp_pack_value (&bp,\n+\t\t node->body_removed\n+\t\t || (!encode_initializer_p && !node->alias && node->definition),\n+\t\t 1);\n   bp_pack_value (&bp, node->implicit_section, 1);\n   bp_pack_value (&bp, node->writeonly, 1);\n-  bp_pack_value (&bp, node->definition, 1);\n+  bp_pack_value (&bp, node->definition && (encode_initializer_p || node->alias),\n+\t\t 1);\n   bp_pack_value (&bp, node->alias, 1);\n   bp_pack_value (&bp, node->weakref, 1);\n   bp_pack_value (&bp, node->analyzed && !boundary_p, 1);"}, {"sha": "7a70b100da172f3aabd8db323390af986f4b73d4", "filename": "gcc/symtab.c", "status": "modified", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/87be7f0cbbd5927135c54e2ca9c56b522851a2d6/gcc%2Fsymtab.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/87be7f0cbbd5927135c54e2ca9c56b522851a2d6/gcc%2Fsymtab.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fsymtab.c?ref=87be7f0cbbd5927135c54e2ca9c56b522851a2d6", "patch": "@@ -978,6 +978,11 @@ symtab_node::verify_base (void)\n       error (\"double linked list of assembler names corrupted\");\n       error_found = true;\n     }\n+  if (body_removed && definition)\n+    {\n+      error (\"node has body_removed but is definition\");\n+      error_found = true;\n+    }\n   if (analyzed && !definition)\n     {\n       error (\"node is analyzed byt it is not a definition\");"}, {"sha": "dc7cfd7acdeeb74bd83afc841af510f896ee158c", "filename": "gcc/varasm.c", "status": "modified", "additions": 2, "deletions": 1, "changes": 3, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/87be7f0cbbd5927135c54e2ca9c56b522851a2d6/gcc%2Fvarasm.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/87be7f0cbbd5927135c54e2ca9c56b522851a2d6/gcc%2Fvarasm.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fvarasm.c?ref=87be7f0cbbd5927135c54e2ca9c56b522851a2d6", "patch": "@@ -6831,7 +6831,8 @@ default_binds_local_p_2 (const_tree exp, bool shlib, bool weak_dominate)\n   bool defined_locally = false;\n   if (symtab_node *node = symtab_node::get (exp))\n     {\n-      if (node->definition || node->in_other_partition)\n+      if ((node->definition && !DECL_EXTERNAL (node->decl))\n+\t  || node->in_other_partition)\n \t{\n \t  defined_locally = true;\n \t  resolved_locally = (weak_dominate && !shlib);"}]}