{"sha": "5408ac6cf3797292f5f86cb7abb6b1103487f20a", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6NTQwOGFjNmNmMzc5NzI5MmY1Zjg2Y2I3YWJiNmIxMTAzNDg3ZjIwYQ==", "commit": {"author": {"name": "Hans-Peter Nilsson", "email": "hp@bitrange.com", "date": "2003-06-23T01:13:35Z"}, "committer": {"name": "Hans-Peter Nilsson", "email": "hp@gcc.gnu.org", "date": "2003-06-23T01:13:35Z"}, "message": "configure.in (in_tree_gas): Find out here whether GAS is ELF, set in_tree_gas_is_elf accordingly.\n\n\t* configure.in (in_tree_gas): Find out here whether GAS is ELF,\n\tset in_tree_gas_is_elf accordingly.\n\t(in_tree_ld): Find out whether LD emulation is ELF, set\n\tin_tree_ld_is_elf accordingly.\n\t(gcc_cv_as_subsections, gcc_cv_as_hidden, gcc_cv_as_leb128)\n\t(gcc_cv_as_eh_frame, gcc_cv_as_shf_merge)\n\t(gcc_cv_as_dwarf2_debug_line, gcc_cv_as_gdwarf2_flag)\n\t(gcc_cv_as_gstabs_flag): Use $in_tree_gas_is_elf instead of\n\tgrepping gas/Makefile.\n\t(gcc_cv_ld_ro_rw_mix, gcc_cv_ld_eh_frame_hdr, gcc_cv_ld_pie): Use\n\t$in_tree_ld_is_elf instead of grepping ld/Makefile.\n\t* configure: Regenerate.\n\nFrom-SVN: r68356", "tree": {"sha": "10b933029c25d19d8e66cae8d767897ce16b1cde", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/10b933029c25d19d8e66cae8d767897ce16b1cde"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/5408ac6cf3797292f5f86cb7abb6b1103487f20a", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/5408ac6cf3797292f5f86cb7abb6b1103487f20a", "html_url": "https://github.com/Rust-GCC/gccrs/commit/5408ac6cf3797292f5f86cb7abb6b1103487f20a", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/5408ac6cf3797292f5f86cb7abb6b1103487f20a/comments", "author": null, "committer": null, "parents": [{"sha": "8e0952f07501034235d2e961e828178279b260a2", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/8e0952f07501034235d2e961e828178279b260a2", "html_url": "https://github.com/Rust-GCC/gccrs/commit/8e0952f07501034235d2e961e828178279b260a2"}], "stats": {"total": 187, "additions": 101, "deletions": 86}, "files": [{"sha": "d26584afce82b949a0824582af963831007e8376", "filename": "gcc/ChangeLog", "status": "modified", "additions": 15, "deletions": 0, "changes": 15, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/5408ac6cf3797292f5f86cb7abb6b1103487f20a/gcc%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/5408ac6cf3797292f5f86cb7abb6b1103487f20a/gcc%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2FChangeLog?ref=5408ac6cf3797292f5f86cb7abb6b1103487f20a", "patch": "@@ -1,3 +1,18 @@\n+2003-06-23  Hans-Peter Nilsson  <hp@bitrange.com>\n+\n+\t* configure.in (in_tree_gas): Find out here whether GAS is ELF,\n+\tset in_tree_gas_is_elf accordingly.\n+\t(in_tree_ld): Find out whether LD emulation is ELF, set\n+\tin_tree_ld_is_elf accordingly.\n+\t(gcc_cv_as_subsections, gcc_cv_as_hidden, gcc_cv_as_leb128)\n+\t(gcc_cv_as_eh_frame, gcc_cv_as_shf_merge)\n+\t(gcc_cv_as_dwarf2_debug_line, gcc_cv_as_gdwarf2_flag)\n+\t(gcc_cv_as_gstabs_flag): Use $in_tree_gas_is_elf instead of\n+\tgrepping gas/Makefile.\n+\t(gcc_cv_ld_ro_rw_mix, gcc_cv_ld_eh_frame_hdr, gcc_cv_ld_pie): Use\n+\t$in_tree_ld_is_elf instead of grepping ld/Makefile.\n+\t* configure: Regenerate.\n+\n 2003-06-22  Roger Sayle  <roger@eyesopen.com>\n \n \t* builtins.c (expand_builtin_mathfn_2): Use tree_cons to build"}, {"sha": "3c5fd6ebdd9aceb25ae503d33cf696e4456ba90c", "filename": "gcc/configure", "status": "modified", "additions": 56, "deletions": 56, "changes": 112, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/5408ac6cf3797292f5f86cb7abb6b1103487f20a/gcc%2Fconfigure", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/5408ac6cf3797292f5f86cb7abb6b1103487f20a/gcc%2Fconfigure", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fconfigure?ref=5408ac6cf3797292f5f86cb7abb6b1103487f20a", "patch": "@@ -6998,6 +6998,13 @@ gcc_cv_gas_patch_version=`expr \"$gcc_cv_gas_version\" : \"VERSION=[0-9]*\\.[0-9]*\\.\n \n   rm -f as$host_exeext\n   $symbolic_link ../gas/as-new$host_exeext as$host_exeext 2>/dev/null\n+  in_tree_gas_is_elf=no\n+  if grep 'obj_format = elf' ../gas/Makefile > /dev/null \\\n+     || (grep 'obj_format = multi' ../gas/Makefile \\\n+         && grep 'extra_objects =.* obj-elf' ../gas/Makefile) > /dev/null\n+  then\n+    in_tree_gas_is_elf=yes\n+  fi\n fi\n \n if test \"x$gcc_cv_as\" = x; then\n@@ -7076,7 +7083,7 @@ esac\n # build->target linker and hope that it will have the same features\n # as the host->target linker we'll be using.\n echo $ac_n \"checking what linker to use\"\"... $ac_c\" 1>&6\n-echo \"configure:7080: checking what linker to use\" >&5\n+echo \"configure:7087: checking what linker to use\" >&5\n in_tree_ld=no\n gcc_cv_ld=\n gcc_cv_gld_major_version=\n@@ -7094,6 +7101,11 @@ elif test -f $gcc_cv_ld_gld_srcdir/configure.in \\\n      && test -f ../ld/Makefile; then\n \t# Single tree build which includes ld.\n \tin_tree_ld=yes\n+\tin_tree_ld_is_elf=no\n+\tif (grep 'EMUL = .*elf' ../ld/Makefile \\\n+\t    || grep 'EMUL = .*linux' ../ld/Makefile) > /dev/null; then\n+\t  in_tree_ld_is_elf=yes\n+\tfi\n \tfor f in $gcc_cv_ld_bfd_srcdir/configure $gcc_cv_ld_gld_srcdir/configure $gcc_cv_ld_gld_srcdir/configure.in $gcc_cv_ld_gld_srcdir/Makefile.in\n \tdo\n \t\tgcc_cv_gld_version=`grep '^VERSION=[0-9]*\\.[0-9]*' $f`\n@@ -7179,7 +7191,7 @@ esac\n # Figure out what nm we will be using.\n gcc_cv_binutils_srcdir=`echo $srcdir | sed -e 's,/gcc$,,'`/binutils\n echo $ac_n \"checking what nm to use\"\"... $ac_c\" 1>&6\n-echo \"configure:7183: checking what nm to use\" >&5\n+echo \"configure:7195: checking what nm to use\" >&5\n in_tree_nm=no\n if test -x nm$host_exeext; then\n \tgcc_cv_nm=./nm$host_exeext\n@@ -7202,7 +7214,7 @@ esac\n \n # Figure out what objdump we will be using.\n echo $ac_n \"checking what objdump to use\"\"... $ac_c\" 1>&6\n-echo \"configure:7206: checking what objdump to use\" >&5\n+echo \"configure:7218: checking what objdump to use\" >&5\n in_tree_objdump=no\n if test -x objdump$host_exeext; then\n \tgcc_cv_objdump=./objdump$host_exeext\n@@ -7227,7 +7239,7 @@ esac\n \n # Figure out what assembler alignment features are present.\n echo $ac_n \"checking assembler alignment features\"\"... $ac_c\" 1>&6\n-echo \"configure:7231: checking assembler alignment features\" >&5\n+echo \"configure:7243: checking assembler alignment features\" >&5\n gcc_cv_as_alignment_features=none\n if test $in_tree_gas = yes; then\n   # Gas version 2.6 and later support for .balign and .p2align.\n@@ -7288,17 +7300,16 @@ fi\n echo \"$ac_t\"\"$gcc_cv_as_alignment_features\" 1>&6\n \n echo $ac_n \"checking assembler subsection support\"\"... $ac_c\" 1>&6\n-echo \"configure:7292: checking assembler subsection support\" >&5\n+echo \"configure:7304: checking assembler subsection support\" >&5\n gcc_cv_as_subsections=no\n if test $in_tree_gas = yes ; then\n    if test $gcc_cv_gas_major_version -eq 2 \\\n && test $gcc_cv_gas_minor_version -ge 9 \\\n || test $gcc_cv_gas_major_version -gt 2 ; then\n \n \n-    if grep 'obj_format = elf' ../gas/Makefile > /dev/null; then\n-      gcc_cv_as_subsections=\"working .subsection -1\"\n-    fi\n+    test $in_tree_gas_is_elf = yes \\\n+\t&& gcc_cv_as_subsections=\"working .subsection -1\"\n   \n \n fi\n@@ -7337,7 +7348,7 @@ fi\n echo \"$ac_t\"\"$gcc_cv_as_subsections\" 1>&6\n \n echo $ac_n \"checking assembler weak support\"\"... $ac_c\" 1>&6\n-echo \"configure:7341: checking assembler weak support\" >&5\n+echo \"configure:7352: checking assembler weak support\" >&5\n gcc_cv_as_weak=no\n if test $in_tree_gas = yes ; then\n    if test $gcc_cv_gas_major_version -eq 2 \\\n@@ -7367,7 +7378,7 @@ fi\n echo \"$ac_t\"\"$gcc_cv_as_weak\" 1>&6\n \n echo $ac_n \"checking assembler hidden support\"\"... $ac_c\" 1>&6\n-echo \"configure:7371: checking assembler hidden support\" >&5\n+echo \"configure:7382: checking assembler hidden support\" >&5\n gcc_cv_as_hidden=no\n if test $in_tree_gas = yes ; then\n    if test $gcc_cv_gas_major_version -eq 2 \\\n@@ -7377,9 +7388,7 @@ if test $in_tree_gas = yes ; then\n || test $gcc_cv_gas_major_version -gt 2 ; then\n \n \n-    if grep 'obj_format = elf' ../gas/Makefile > /dev/null; then\n-      gcc_cv_as_hidden=\"yes\"\n-    fi\n+    test $in_tree_gas_is_elf = yes && gcc_cv_as_hidden=\"yes\"\n   \n \n fi\n@@ -7448,17 +7457,15 @@ libgcc_visibility=$gcc_cv_as_hidden\n \n \n echo $ac_n \"checking assembler leb128 support\"\"... $ac_c\" 1>&6\n-echo \"configure:7452: checking assembler leb128 support\" >&5\n+echo \"configure:7461: checking assembler leb128 support\" >&5\n gcc_cv_as_leb128=no\n if test $in_tree_gas = yes ; then\n    if test $gcc_cv_gas_major_version -eq 2 \\\n && test $gcc_cv_gas_minor_version -ge 11 \\\n || test $gcc_cv_gas_major_version -gt 2 ; then\n \n \n-    if grep 'obj_format = elf' ../gas/Makefile > /dev/null; then\n-      gcc_cv_as_leb128=\"yes\"\n-    fi\n+    test $in_tree_gas_is_elf = yes && gcc_cv_as_leb128=\"yes\"\n   \n \n fi\n@@ -7502,17 +7509,15 @@ fi\n echo \"$ac_t\"\"$gcc_cv_as_leb128\" 1>&6\n \n echo $ac_n \"checking assembler eh_frame optimization\"\"... $ac_c\" 1>&6\n-echo \"configure:7506: checking assembler eh_frame optimization\" >&5\n+echo \"configure:7513: checking assembler eh_frame optimization\" >&5\n gcc_cv_as_eh_frame=no\n if test $in_tree_gas = yes ; then\n    if test $gcc_cv_gas_major_version -eq 2 \\\n && test $gcc_cv_gas_minor_version -ge 12 \\\n || test $gcc_cv_gas_major_version -gt 2 ; then\n \n \n-    if grep 'obj_format = elf' ../gas/Makefile > /dev/null; then\n-      gcc_cv_as_eh_frame=\"yes\"\n-    fi\n+    test $in_tree_gas_is_elf = yes && gcc_cv_as_eh_frame=\"yes\"\n   \n \n fi\n@@ -7592,17 +7597,15 @@ fi\n echo \"$ac_t\"\"$gcc_cv_as_eh_frame\" 1>&6\n \n echo $ac_n \"checking assembler section merging support\"\"... $ac_c\" 1>&6\n-echo \"configure:7596: checking assembler section merging support\" >&5\n+echo \"configure:7601: checking assembler section merging support\" >&5\n gcc_cv_as_shf_merge=no\n if test $in_tree_gas = yes ; then\n    if test $gcc_cv_gas_major_version -eq 2 \\\n && test $gcc_cv_gas_minor_version -ge 12 \\\n || test $gcc_cv_gas_major_version -gt 2 ; then\n \n \n-    if grep 'obj_format = elf' ../gas/Makefile > /dev/null; then\n-      gcc_cv_as_shf_merge=yes\n-    fi\n+    test $in_tree_gas_is_elf = yes && gcc_cv_as_shf_merge=\"yes\"\n   \n \n fi\n@@ -7624,7 +7627,7 @@ fi\n echo \"$ac_t\"\"$gcc_cv_as_shf_merge\" 1>&6\n \n echo $ac_n \"checking assembler thread-local storage support\"\"... $ac_c\" 1>&6\n-echo \"configure:7628: checking assembler thread-local storage support\" >&5\n+echo \"configure:7631: checking assembler thread-local storage support\" >&5\n gcc_cv_as_tls=no\n conftest_s=\n tls_first_major=\n@@ -7834,7 +7837,7 @@ case \"$target\" in\n   # All TARGET_ABI_OSF targets.\n   alpha*-*-osf* | alpha*-*-linux* | alpha*-*-*bsd*)\n     echo $ac_n \"checking assembler supports explicit relocations\"\"... $ac_c\" 1>&6\n-echo \"configure:7838: checking assembler supports explicit relocations\" >&5\n+echo \"configure:7841: checking assembler supports explicit relocations\" >&5\n if eval \"test \\\"`echo '$''{'gcc_cv_as_explicit_relocs'+set}'`\\\" = set\"; then\n   echo $ac_n \"(cached) $ac_c\" 1>&6\n else\n@@ -7887,7 +7890,7 @@ EOF\n     ;;\n   sparc*-*-*)\n     echo $ac_n \"checking assembler .register pseudo-op support\"\"... $ac_c\" 1>&6\n-echo \"configure:7891: checking assembler .register pseudo-op support\" >&5\n+echo \"configure:7894: checking assembler .register pseudo-op support\" >&5\n if eval \"test \\\"`echo '$''{'gcc_cv_as_register_pseudo_op'+set}'`\\\" = set\"; then\n   echo $ac_n \"(cached) $ac_c\" 1>&6\n else\n@@ -7915,7 +7918,7 @@ EOF\n     fi\n \n     echo $ac_n \"checking assembler supports -relax\"\"... $ac_c\" 1>&6\n-echo \"configure:7919: checking assembler supports -relax\" >&5\n+echo \"configure:7922: checking assembler supports -relax\" >&5\n if eval \"test \\\"`echo '$''{'gcc_cv_as_relax_opt'+set}'`\\\" = set\"; then\n   echo $ac_n \"(cached) $ac_c\" 1>&6\n else\n@@ -7943,7 +7946,7 @@ EOF\n     fi\n \n     echo $ac_n \"checking assembler and linker support unaligned pc related relocs\"\"... $ac_c\" 1>&6\n-echo \"configure:7947: checking assembler and linker support unaligned pc related relocs\" >&5\n+echo \"configure:7950: checking assembler and linker support unaligned pc related relocs\" >&5\n if eval \"test \\\"`echo '$''{'gcc_cv_as_sparc_ua_pcrel'+set}'`\\\" = set\"; then\n   echo $ac_n \"(cached) $ac_c\" 1>&6\n else\n@@ -7970,7 +7973,7 @@ EOF\n     fi\n \n     echo $ac_n \"checking assembler and linker support unaligned pc related relocs against hidden symbols\"\"... $ac_c\" 1>&6\n-echo \"configure:7974: checking assembler and linker support unaligned pc related relocs against hidden symbols\" >&5\n+echo \"configure:7977: checking assembler and linker support unaligned pc related relocs against hidden symbols\" >&5\n if eval \"test \\\"`echo '$''{'gcc_cv_as_sparc_ua_pcrel_hidden'+set}'`\\\" = set\"; then\n   echo $ac_n \"(cached) $ac_c\" 1>&6\n else\n@@ -8010,7 +8013,7 @@ EOF\n     fi\n \n     echo $ac_n \"checking for assembler offsetable %lo() support\"\"... $ac_c\" 1>&6\n-echo \"configure:8014: checking for assembler offsetable %lo() support\" >&5\n+echo \"configure:8017: checking for assembler offsetable %lo() support\" >&5\n if eval \"test \\\"`echo '$''{'gcc_cv_as_offsetable_lo10'+set}'`\\\" = set\"; then\n   echo $ac_n \"(cached) $ac_c\" 1>&6\n else\n@@ -8049,7 +8052,7 @@ EOF\n \n   i[34567]86-*-* | x86_64-*-*)\n     echo $ac_n \"checking assembler instructions\"\"... $ac_c\" 1>&6\n-echo \"configure:8053: checking assembler instructions\" >&5\n+echo \"configure:8056: checking assembler instructions\" >&5\n     gcc_cv_as_instructions=\n     if test $in_tree_gas = yes ; then \n        if test $gcc_cv_gas_major_version -eq 2 \\\n@@ -8083,7 +8086,7 @@ EOF\n     echo \"$ac_t\"\"$gcc_cv_as_instructions\" 1>&6\n \n     echo $ac_n \"checking assembler GOTOFF in data directives\"\"... $ac_c\" 1>&6\n-echo \"configure:8087: checking assembler GOTOFF in data directives\" >&5\n+echo \"configure:8090: checking assembler GOTOFF in data directives\" >&5\n     gcc_cv_as_gotoff_in_data=no\n     if test $in_tree_gas = yes ; then\n        if test $gcc_cv_gas_major_version -eq 2 \\\n@@ -8117,7 +8120,7 @@ EOF\n \n   ia64*-*-*)\n     echo $ac_n \"checking assembler supports ltoffx and ldxmov\"\"... $ac_c\" 1>&6\n-echo \"configure:8121: checking assembler supports ltoffx and ldxmov\" >&5\n+echo \"configure:8124: checking assembler supports ltoffx and ldxmov\" >&5\n if eval \"test \\\"`echo '$''{'gcc_cv_as_ltoffx_ldxmov_relocs'+set}'`\\\" = set\"; then\n   echo $ac_n \"(cached) $ac_c\" 1>&6\n else\n@@ -8162,7 +8165,7 @@ EOF\n esac\n \n echo $ac_n \"checking assembler dwarf2 debug_line support\"\"... $ac_c\" 1>&6\n-echo \"configure:8166: checking assembler dwarf2 debug_line support\" >&5\n+echo \"configure:8169: checking assembler dwarf2 debug_line support\" >&5\n gcc_cv_as_dwarf2_debug_line=no\n # ??? Not all targets support dwarf2 debug_line, even within a version\n # of gas.  Moreover, we need to emit a valid instruction to trigger any\n@@ -8189,10 +8192,8 @@ if test $in_tree_gas = yes ; then\n || test $gcc_cv_gas_major_version -gt 2 ; then\n \n \n-    if grep 'obj_format = elf' ../gas/Makefile > /dev/null \\\n-        && test x\"$insn\" != x ; then\n-      gcc_cv_as_dwarf2_debug_line=\"yes\"\n-    fi\n+    test $in_tree_gas_is_elf = yes && test x\"$insn\" != x \\\n+\t&& gcc_cv_as_dwarf2_debug_line=\"yes\"\n   \n \n fi\n@@ -8228,18 +8229,16 @@ fi\n echo \"$ac_t\"\"$gcc_cv_as_dwarf2_debug_line\" 1>&6\n \n echo $ac_n \"checking assembler --gdwarf2 support\"\"... $ac_c\" 1>&6\n-echo \"configure:8232: checking assembler --gdwarf2 support\" >&5\n+echo \"configure:8233: checking assembler --gdwarf2 support\" >&5\n gcc_cv_as_gdwarf2_flag=no\n if test $in_tree_gas = yes ; then\n    if test $gcc_cv_gas_major_version -eq 2 \\\n && test $gcc_cv_gas_minor_version -ge 11 \\\n || test $gcc_cv_gas_major_version -gt 2 ; then\n \n \n-    if grep 'obj_format = elf' ../gas/Makefile > /dev/null \\\n-        && test x\"$insn\" != x ; then\n-      gcc_cv_as_gdwarf2_flag=\"yes\"\n-    fi\n+    test $in_tree_gas_is_elf = yes && test x\"$insn\" != x \\\n+\t&& gcc_cv_as_gdwarf2_flag=\"yes\"\n   \n \n fi\n@@ -8262,18 +8261,16 @@ fi\n echo \"$ac_t\"\"$gcc_cv_as_gdwarf2_flag\" 1>&6\n \n echo $ac_n \"checking assembler --gstabs support\"\"... $ac_c\" 1>&6\n-echo \"configure:8266: checking assembler --gstabs support\" >&5\n+echo \"configure:8265: checking assembler --gstabs support\" >&5\n gcc_cv_as_gstabs_flag=no\n if test $in_tree_gas = yes ; then\n    if test $gcc_cv_gas_major_version -eq 2 \\\n && test $gcc_cv_gas_minor_version -ge 11 \\\n || test $gcc_cv_gas_major_version -gt 2 ; then\n \n \n-    if grep 'obj_format = elf' ../gas/Makefile > /dev/null \\\n-        && test x\"$insn\" != x ; then\n-      gcc_cv_as_gstabs_flag=\"yes\"\n-    fi\n+    test $in_tree_gas_is_elf = yes && test x\"$insn\" != x \\\n+\t&& gcc_cv_as_gstabs_flag=\"yes\"\n   \n \n fi\n@@ -8302,10 +8299,11 @@ fi\n echo \"$ac_t\"\"$gcc_cv_as_gstabs_flag\" 1>&6\n \n echo $ac_n \"checking linker read-only and read-write section mixing\"\"... $ac_c\" 1>&6\n-echo \"configure:8306: checking linker read-only and read-write section mixing\" >&5\n+echo \"configure:8303: checking linker read-only and read-write section mixing\" >&5\n gcc_cv_ld_ro_rw_mix=unknown\n if test $in_tree_ld = yes ; then\n-  if test \"$gcc_cv_gld_major_version\" -eq 2 -a \"$gcc_cv_gld_minor_version\" -ge 10 -o \"$gcc_cv_gld_major_version\" -gt 2 && grep 'EMUL = elf' ../ld/Makefile > /dev/null; then\n+  if test \"$gcc_cv_gld_major_version\" -eq 2 -a \"$gcc_cv_gld_minor_version\" -ge 10 -o \"$gcc_cv_gld_major_version\" -gt 2 \\\n+     && test $in_tree_ld_is_elf = yes; then\n     gcc_cv_ld_ro_rw_mix=read-write\n   fi\n elif test x$gcc_cv_as != x -a x$gcc_cv_ld != x -a x$gcc_cv_objdump != x ; then\n@@ -8340,10 +8338,11 @@ fi\n echo \"$ac_t\"\"$gcc_cv_ld_ro_rw_mix\" 1>&6\n \n echo $ac_n \"checking linker PT_GNU_EH_FRAME support\"\"... $ac_c\" 1>&6\n-echo \"configure:8344: checking linker PT_GNU_EH_FRAME support\" >&5\n+echo \"configure:8342: checking linker PT_GNU_EH_FRAME support\" >&5\n gcc_cv_ld_eh_frame_hdr=no\n if test $in_tree_ld = yes ; then\n-  if test \"$gcc_cv_gld_major_version\" -eq 2 -a \"$gcc_cv_gld_minor_version\" -ge 12 -o \"$gcc_cv_gld_major_version\" -gt 2 && grep 'EMUL = elf' ../ld/Makefile > /dev/null; then\n+  if test \"$gcc_cv_gld_major_version\" -eq 2 -a \"$gcc_cv_gld_minor_version\" -ge 12 -o \"$gcc_cv_gld_major_version\" -gt 2 \\\n+     && test $in_tree_ld_is_elf = yes; then\n     gcc_cv_ld_eh_frame_hdr=yes\n   fi\n elif test x$gcc_cv_ld != x; then\n@@ -8361,10 +8360,11 @@ fi\n echo \"$ac_t\"\"$gcc_cv_ld_eh_frame_hdr\" 1>&6\n \n echo $ac_n \"checking linker position independent executable support\"\"... $ac_c\" 1>&6\n-echo \"configure:8365: checking linker position independent executable support\" >&5\n+echo \"configure:8364: checking linker position independent executable support\" >&5\n gcc_cv_ld_pie=no\n if test $in_tree_ld = yes ; then\n-  if test \"$gcc_cv_gld_major_version\" -eq 2 -a \"$gcc_cv_gld_minor_version\" -ge 15 -o \"$gcc_cv_gld_major_version\" -gt 2 && grep 'EMUL = elf' ../ld/Makefile > /dev/null; then\n+  if test \"$gcc_cv_gld_major_version\" -eq 2 -a \"$gcc_cv_gld_minor_version\" -ge 15 -o \"$gcc_cv_gld_major_version\" -gt 2 \\\n+     && test $in_tree_ld_is_elf = yes; then\n     gcc_cv_ld_pie=yes\n   fi\n elif test x$gcc_cv_ld != x; then"}, {"sha": "b9dd700b568066dfe6101f7d00468b8316a9a227", "filename": "gcc/configure.in", "status": "modified", "additions": 30, "deletions": 30, "changes": 60, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/5408ac6cf3797292f5f86cb7abb6b1103487f20a/gcc%2Fconfigure.in", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/5408ac6cf3797292f5f86cb7abb6b1103487f20a/gcc%2Fconfigure.in", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fconfigure.in?ref=5408ac6cf3797292f5f86cb7abb6b1103487f20a", "patch": "@@ -1485,6 +1485,13 @@ elif test -f $gcc_cv_as_gas_srcdir/configure.in \\\n   _gcc_COMPUTE_GAS_VERSION\n   rm -f as$host_exeext\n   $symbolic_link ../gas/as-new$host_exeext as$host_exeext 2>/dev/null\n+  in_tree_gas_is_elf=no\n+  if grep 'obj_format = elf' ../gas/Makefile > /dev/null \\\n+     || (grep 'obj_format = multi' ../gas/Makefile \\\n+         && grep 'extra_objects =.* obj-elf' ../gas/Makefile) > /dev/null\n+  then\n+    in_tree_gas_is_elf=yes\n+  fi\n fi\n \n if test \"x$gcc_cv_as\" = x; then\n@@ -1580,6 +1587,11 @@ elif test -f $gcc_cv_ld_gld_srcdir/configure.in \\\n      && test -f ../ld/Makefile; then\n \t# Single tree build which includes ld.\n \tin_tree_ld=yes\n+\tin_tree_ld_is_elf=no\n+\tif (grep 'EMUL = .*elf' ../ld/Makefile \\\n+\t    || grep 'EMUL = .*linux' ../ld/Makefile) > /dev/null; then\n+\t  in_tree_ld_is_elf=yes\n+\tfi\n \tfor f in $gcc_cv_ld_bfd_srcdir/configure $gcc_cv_ld_gld_srcdir/configure $gcc_cv_ld_gld_srcdir/configure.in $gcc_cv_ld_gld_srcdir/Makefile.in\n \tdo\n changequote(,)dnl\n@@ -1752,9 +1764,8 @@ AC_MSG_CHECKING(assembler subsection support)\n gcc_cv_as_subsections=no\n if test $in_tree_gas = yes ; then\n   gcc_GAS_VERSION_GTE_IFELSE(2,9,0,[\n-    if grep 'obj_format = elf' ../gas/Makefile > /dev/null; then\n-      gcc_cv_as_subsections=\"working .subsection -1\"\n-    fi\n+    test $in_tree_gas_is_elf = yes \\\n+\t&& gcc_cv_as_subsections=\"working .subsection -1\"\n   ])\n elif test x$gcc_cv_as != x; then\n \t# Check if we have .subsection\n@@ -1811,9 +1822,7 @@ AC_MSG_CHECKING(assembler hidden support)\n gcc_cv_as_hidden=no\n if test $in_tree_gas = yes ; then\n   gcc_GAS_VERSION_GTE_IFELSE(2,12,1,[\n-    if grep 'obj_format = elf' ../gas/Makefile > /dev/null; then\n-      gcc_cv_as_hidden=\"yes\"\n-    fi\n+    test $in_tree_gas_is_elf = yes && gcc_cv_as_hidden=\"yes\"\n   ])\n elif test x$gcc_cv_as != x; then\n \t# Check if we have .hidden\n@@ -1882,9 +1891,7 @@ AC_MSG_CHECKING(assembler leb128 support)\n gcc_cv_as_leb128=no\n if test $in_tree_gas = yes ; then\n   gcc_GAS_VERSION_GTE_IFELSE(2,11,0,[\n-    if grep 'obj_format = elf' ../gas/Makefile > /dev/null; then\n-      gcc_cv_as_leb128=\"yes\"\n-    fi\n+    test $in_tree_gas_is_elf = yes && gcc_cv_as_leb128=\"yes\"\n   ])\n elif test x$gcc_cv_as != x; then\n \t# Check if we have .[us]leb128, and support symbol arithmetic with it.\n@@ -1928,9 +1935,7 @@ AC_MSG_CHECKING(assembler eh_frame optimization)\n gcc_cv_as_eh_frame=no\n if test $in_tree_gas = yes ; then\n   gcc_GAS_VERSION_GTE_IFELSE(2,12,0,[\n-    if grep 'obj_format = elf' ../gas/Makefile > /dev/null; then\n-      gcc_cv_as_eh_frame=\"yes\"\n-    fi\n+    test $in_tree_gas_is_elf = yes && gcc_cv_as_eh_frame=\"yes\"\n   ])\n elif test x$gcc_cv_as != x; then\n \t# Check if this is GAS.\n@@ -2008,9 +2013,7 @@ AC_MSG_CHECKING(assembler section merging support)\n gcc_cv_as_shf_merge=no\n if test $in_tree_gas = yes ; then\n   gcc_GAS_VERSION_GTE_IFELSE(2,12,0,[\n-    if grep 'obj_format = elf' ../gas/Makefile > /dev/null; then\n-      gcc_cv_as_shf_merge=yes\n-    fi\n+    test $in_tree_gas_is_elf = yes && gcc_cv_as_shf_merge=\"yes\"\n   ])\n elif test x$gcc_cv_as != x; then\n \t# Check if we support SHF_MERGE sections\n@@ -2486,10 +2489,8 @@ case \"$target\" in\n   esac\n if test $in_tree_gas = yes ; then\n   gcc_GAS_VERSION_GTE_IFELSE(2,11,0,[\n-    if grep 'obj_format = elf' ../gas/Makefile > /dev/null \\\n-        && test x\"$insn\" != x ; then\n-      gcc_cv_as_dwarf2_debug_line=\"yes\"\n-    fi\n+    test $in_tree_gas_is_elf = yes && test x\"$insn\" != x \\\n+\t&& gcc_cv_as_dwarf2_debug_line=\"yes\"\n   ])\n elif test x$gcc_cv_as != x -a x\"$insn\" != x ; then\n \techo '\t.file 1 \"conftest.s\"' > conftest.s\n@@ -2524,10 +2525,8 @@ AC_MSG_CHECKING(assembler --gdwarf2 support)\n gcc_cv_as_gdwarf2_flag=no\n if test $in_tree_gas = yes ; then\n   gcc_GAS_VERSION_GTE_IFELSE(2,11,0,[\n-    if grep 'obj_format = elf' ../gas/Makefile > /dev/null \\\n-        && test x\"$insn\" != x ; then\n-      gcc_cv_as_gdwarf2_flag=\"yes\"\n-    fi\n+    test $in_tree_gas_is_elf = yes && test x\"$insn\" != x \\\n+\t&& gcc_cv_as_gdwarf2_flag=\"yes\"\n   ])\n elif test x$gcc_cv_as != x -a x\"$insn\" != x ; then\n \techo '' > conftest.s\n@@ -2548,10 +2547,8 @@ AC_MSG_CHECKING(assembler --gstabs support)\n gcc_cv_as_gstabs_flag=no\n if test $in_tree_gas = yes ; then\n   gcc_GAS_VERSION_GTE_IFELSE(2,11,0,[\n-    if grep 'obj_format = elf' ../gas/Makefile > /dev/null \\\n-        && test x\"$insn\" != x ; then\n-      gcc_cv_as_gstabs_flag=\"yes\"\n-    fi\n+    test $in_tree_gas_is_elf = yes && test x\"$insn\" != x \\\n+\t&& gcc_cv_as_gstabs_flag=\"yes\"\n   ])\n elif test x$gcc_cv_as != x -a x\"$insn\" != x ; then\n \techo '' > conftest.s\n@@ -2577,7 +2574,8 @@ AC_MSG_RESULT($gcc_cv_as_gstabs_flag)\n AC_MSG_CHECKING(linker read-only and read-write section mixing)\n gcc_cv_ld_ro_rw_mix=unknown\n if test $in_tree_ld = yes ; then\n-  if test \"$gcc_cv_gld_major_version\" -eq 2 -a \"$gcc_cv_gld_minor_version\" -ge 10 -o \"$gcc_cv_gld_major_version\" -gt 2 && grep 'EMUL = elf' ../ld/Makefile > /dev/null; then\n+  if test \"$gcc_cv_gld_major_version\" -eq 2 -a \"$gcc_cv_gld_minor_version\" -ge 10 -o \"$gcc_cv_gld_major_version\" -gt 2 \\\n+     && test $in_tree_ld_is_elf = yes; then\n     gcc_cv_ld_ro_rw_mix=read-write\n   fi\n elif test x$gcc_cv_as != x -a x$gcc_cv_ld != x -a x$gcc_cv_objdump != x ; then\n@@ -2615,7 +2613,8 @@ AC_MSG_RESULT($gcc_cv_ld_ro_rw_mix)\n AC_MSG_CHECKING(linker PT_GNU_EH_FRAME support)\n gcc_cv_ld_eh_frame_hdr=no\n if test $in_tree_ld = yes ; then\n-  if test \"$gcc_cv_gld_major_version\" -eq 2 -a \"$gcc_cv_gld_minor_version\" -ge 12 -o \"$gcc_cv_gld_major_version\" -gt 2 && grep 'EMUL = elf' ../ld/Makefile > /dev/null; then\n+  if test \"$gcc_cv_gld_major_version\" -eq 2 -a \"$gcc_cv_gld_minor_version\" -ge 12 -o \"$gcc_cv_gld_major_version\" -gt 2 \\\n+     && test $in_tree_ld_is_elf = yes; then\n     gcc_cv_ld_eh_frame_hdr=yes\n   fi\n elif test x$gcc_cv_ld != x; then\n@@ -2633,7 +2632,8 @@ AC_MSG_RESULT($gcc_cv_ld_eh_frame_hdr)\n AC_MSG_CHECKING(linker position independent executable support)\n gcc_cv_ld_pie=no\n if test $in_tree_ld = yes ; then\n-  if test \"$gcc_cv_gld_major_version\" -eq 2 -a \"$gcc_cv_gld_minor_version\" -ge 15 -o \"$gcc_cv_gld_major_version\" -gt 2 && grep 'EMUL = elf' ../ld/Makefile > /dev/null; then\n+  if test \"$gcc_cv_gld_major_version\" -eq 2 -a \"$gcc_cv_gld_minor_version\" -ge 15 -o \"$gcc_cv_gld_major_version\" -gt 2 \\\n+     && test $in_tree_ld_is_elf = yes; then\n     gcc_cv_ld_pie=yes\n   fi\n elif test x$gcc_cv_ld != x; then"}]}