{"sha": "b237c4cbd3da7a266863ed049cbb2ef60b0aaa81", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6YjIzN2M0Y2JkM2RhN2EyNjY4NjNlZDA0OWNiYjJlZjYwYjBhYWE4MQ==", "commit": {"author": {"name": "Jason Merrill", "email": "jason@redhat.com", "date": "2015-05-18T18:08:48Z"}, "committer": {"name": "Jason Merrill", "email": "jason@gcc.gnu.org", "date": "2015-05-18T18:08:48Z"}, "message": "pt.c (tsubst_decl): Call coerce_innermost_template_parms.\n\n\t* pt.c (tsubst_decl) [VAR_DECL]: Call coerce_innermost_template_parms.\n\t(determine_specialization): Call coerce_template_parms.\n\nFrom-SVN: r223304", "tree": {"sha": "f8cc39069865bbd56cc5a7ab86315512180da9fb", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/f8cc39069865bbd56cc5a7ab86315512180da9fb"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/b237c4cbd3da7a266863ed049cbb2ef60b0aaa81", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/b237c4cbd3da7a266863ed049cbb2ef60b0aaa81", "html_url": "https://github.com/Rust-GCC/gccrs/commit/b237c4cbd3da7a266863ed049cbb2ef60b0aaa81", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/b237c4cbd3da7a266863ed049cbb2ef60b0aaa81/comments", "author": {"login": "jicama", "id": 266146, "node_id": "MDQ6VXNlcjI2NjE0Ng==", "avatar_url": "https://avatars.githubusercontent.com/u/266146?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jicama", "html_url": "https://github.com/jicama", "followers_url": "https://api.github.com/users/jicama/followers", "following_url": "https://api.github.com/users/jicama/following{/other_user}", "gists_url": "https://api.github.com/users/jicama/gists{/gist_id}", "starred_url": "https://api.github.com/users/jicama/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jicama/subscriptions", "organizations_url": "https://api.github.com/users/jicama/orgs", "repos_url": "https://api.github.com/users/jicama/repos", "events_url": "https://api.github.com/users/jicama/events{/privacy}", "received_events_url": "https://api.github.com/users/jicama/received_events", "type": "User", "site_admin": false}, "committer": null, "parents": [{"sha": "c4d6d7bc4630cabd415388ddc37fe1cd94522463", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/c4d6d7bc4630cabd415388ddc37fe1cd94522463", "html_url": "https://github.com/Rust-GCC/gccrs/commit/c4d6d7bc4630cabd415388ddc37fe1cd94522463"}], "stats": {"total": 43, "additions": 42, "deletions": 1}, "files": [{"sha": "04576e5a8a0b88d156f380e4f1ac4173ea18debe", "filename": "gcc/cp/ChangeLog", "status": "modified", "additions": 3, "deletions": 0, "changes": 3, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/b237c4cbd3da7a266863ed049cbb2ef60b0aaa81/gcc%2Fcp%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/b237c4cbd3da7a266863ed049cbb2ef60b0aaa81/gcc%2Fcp%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fcp%2FChangeLog?ref=b237c4cbd3da7a266863ed049cbb2ef60b0aaa81", "patch": "@@ -1,5 +1,8 @@\n 2015-05-18  Jason Merrill  <jason@redhat.com>\n \n+\t* pt.c (tsubst_decl) [VAR_DECL]: Call coerce_innermost_template_parms.\n+\t(determine_specialization): Call coerce_template_parms.\n+\n \tDR 1391\n \t* pt.c (type_unification_real): Check convertibility here.\n \t(unify_one_argument): Not here."}, {"sha": "2166f5fb65ea99a2585f6fa74cf2a64cfd6853c9", "filename": "gcc/cp/pt.c", "status": "modified", "additions": 12, "deletions": 1, "changes": 13, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/b237c4cbd3da7a266863ed049cbb2ef60b0aaa81/gcc%2Fcp%2Fpt.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/b237c4cbd3da7a266863ed049cbb2ef60b0aaa81/gcc%2Fcp%2Fpt.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fcp%2Fpt.c?ref=b237c4cbd3da7a266863ed049cbb2ef60b0aaa81", "patch": "@@ -1919,7 +1919,13 @@ determine_specialization (tree template_id,\n     ++header_count;\n \n   if (variable_template_p (fns))\n-    templates = tree_cons (explicit_targs, fns, templates);\n+    {\n+      tree parms = INNERMOST_TEMPLATE_PARMS (DECL_TEMPLATE_PARMS (fns));\n+      targs = coerce_template_parms (parms, explicit_targs, fns,\n+\t\t\t\t     tf_warning_or_error,\n+\t\t\t\t     /*req_all*/true, /*use_defarg*/true);\n+      templates = tree_cons (targs, fns, templates);\n+    }\n   else for (; fns; fns = OVL_NEXT (fns))\n     {\n       tree fn = OVL_CURRENT (fns);\n@@ -11265,6 +11271,11 @@ tsubst_decl (tree t, tree args, tsubst_flags_t complain)\n \t\ttmpl = DECL_TI_TEMPLATE (t);\n \t\tgen_tmpl = most_general_template (tmpl);\n \t\targvec = tsubst (DECL_TI_ARGS (t), args, complain, in_decl);\n+\t\tif (argvec != error_mark_node)\n+\t\t  argvec = (coerce_innermost_template_parms\n+\t\t\t    (DECL_TEMPLATE_PARMS (gen_tmpl),\n+\t\t\t     argvec, t, complain,\n+\t\t\t     /*all*/true, /*defarg*/true));\n \t\tif (argvec == error_mark_node)\n \t\t  RETURN (error_mark_node);\n \t\thash = hash_tmpl_and_args (gen_tmpl, argvec);"}, {"sha": "8253eac5cde83c406d05fedb1512c423d5205932", "filename": "gcc/testsuite/g++.dg/cpp1y/var-templ25.C", "status": "added", "additions": 8, "deletions": 0, "changes": 8, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/b237c4cbd3da7a266863ed049cbb2ef60b0aaa81/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Fcpp1y%2Fvar-templ25.C", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/b237c4cbd3da7a266863ed049cbb2ef60b0aaa81/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Fcpp1y%2Fvar-templ25.C", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Fcpp1y%2Fvar-templ25.C?ref=b237c4cbd3da7a266863ed049cbb2ef60b0aaa81", "patch": "@@ -0,0 +1,8 @@\n+// { dg-do compile { target c++14 } }\n+\n+using fl = float;\n+\n+template<class T> const int V = 0;\n+template<> const int V<fl> = 42;\n+\n+static_assert(V<float> == 42, \"\");"}, {"sha": "9ac077773a8f931d749256848892e6417b5f6bf5", "filename": "gcc/testsuite/g++.dg/cpp1y/var-templ26.C", "status": "added", "additions": 19, "deletions": 0, "changes": 19, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/b237c4cbd3da7a266863ed049cbb2ef60b0aaa81/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Fcpp1y%2Fvar-templ26.C", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/b237c4cbd3da7a266863ed049cbb2ef60b0aaa81/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Fcpp1y%2Fvar-templ26.C", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Fcpp1y%2Fvar-templ26.C?ref=b237c4cbd3da7a266863ed049cbb2ef60b0aaa81", "patch": "@@ -0,0 +1,19 @@\n+// { dg-do compile { target c++14 } }\n+\n+template <class T> const int V = 0;\n+template <> const int V<char> = 42;\n+\n+template <class T>\n+struct A\n+{\n+  using N = T;\n+};\n+\n+#define SA(X) static_assert((X),#X)\n+template <class T>\n+struct B\n+{\n+  SA(V<typename A<T>::N> == 42);\n+};\n+\n+B<char> b;"}]}