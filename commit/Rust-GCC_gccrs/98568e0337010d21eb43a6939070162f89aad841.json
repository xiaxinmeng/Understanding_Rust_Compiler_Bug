{"sha": "98568e0337010d21eb43a6939070162f89aad841", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6OTg1NjhlMDMzNzAxMGQyMWViNDNhNjkzOTA3MDE2MmY4OWFhZDg0MQ==", "commit": {"author": {"name": "Jakub Jelinek", "email": "jakub@redhat.com", "date": "2017-04-05T19:10:17Z"}, "committer": {"name": "Jakub Jelinek", "email": "jakub@gcc.gnu.org", "date": "2017-04-05T19:10:17Z"}, "message": "re PR c++/80309 (ICE: canonical types differ for identical types _Args2 and _Args2)\n\n\tPR c++/80309\n\t* pt.c (canonical_type_parameter): Use vec_safe_grow_cleared instead\n\tof a loop doing vec_safe_push of NULL.  Formatting fixes.\n\t(rewrite_template_parm): Copy TEMPLATE_PARM_PARAMETER_PACK from oldidx\n\tto newidx before calling canonical_type_parameter on newtype.\n\nFrom-SVN: r246717", "tree": {"sha": "a88f0920e818d5625e3a88928da6fe6af397f5f0", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/a88f0920e818d5625e3a88928da6fe6af397f5f0"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/98568e0337010d21eb43a6939070162f89aad841", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/98568e0337010d21eb43a6939070162f89aad841", "html_url": "https://github.com/Rust-GCC/gccrs/commit/98568e0337010d21eb43a6939070162f89aad841", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/98568e0337010d21eb43a6939070162f89aad841/comments", "author": {"login": "jakubjelinek", "id": 9370665, "node_id": "MDQ6VXNlcjkzNzA2NjU=", "avatar_url": "https://avatars.githubusercontent.com/u/9370665?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jakubjelinek", "html_url": "https://github.com/jakubjelinek", "followers_url": "https://api.github.com/users/jakubjelinek/followers", "following_url": "https://api.github.com/users/jakubjelinek/following{/other_user}", "gists_url": "https://api.github.com/users/jakubjelinek/gists{/gist_id}", "starred_url": "https://api.github.com/users/jakubjelinek/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jakubjelinek/subscriptions", "organizations_url": "https://api.github.com/users/jakubjelinek/orgs", "repos_url": "https://api.github.com/users/jakubjelinek/repos", "events_url": "https://api.github.com/users/jakubjelinek/events{/privacy}", "received_events_url": "https://api.github.com/users/jakubjelinek/received_events", "type": "User", "site_admin": false}, "committer": null, "parents": [{"sha": "37d6671d0727e6773e1cd713f3b3589974270357", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/37d6671d0727e6773e1cd713f3b3589974270357", "html_url": "https://github.com/Rust-GCC/gccrs/commit/37d6671d0727e6773e1cd713f3b3589974270357"}], "stats": {"total": 23, "additions": 16, "deletions": 7}, "files": [{"sha": "9b1f89d8ccda3e1f66bcc8e72c30afe91f522180", "filename": "gcc/cp/ChangeLog", "status": "modified", "additions": 8, "deletions": 0, "changes": 8, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/98568e0337010d21eb43a6939070162f89aad841/gcc%2Fcp%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/98568e0337010d21eb43a6939070162f89aad841/gcc%2Fcp%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fcp%2FChangeLog?ref=98568e0337010d21eb43a6939070162f89aad841", "patch": "@@ -1,3 +1,11 @@\n+2017-04-05  Jakub Jelinek  <jakub@redhat.com>\n+\n+\tPR c++/80309\n+\t* pt.c (canonical_type_parameter): Use vec_safe_grow_cleared instead\n+\tof a loop doing vec_safe_push of NULL.  Formatting fixes.\n+\t(rewrite_template_parm): Copy TEMPLATE_PARM_PARAMETER_PACK from oldidx\n+\tto newidx before calling canonical_type_parameter on newtype.\n+\n 2017-04-04  Volker Reichelt  <v.reichelt@netcologne.de>\n \n \tPR c++/80296"}, {"sha": "f9f4921a11a9959ee6c39511d88472877178e28d", "filename": "gcc/cp/pt.c", "status": "modified", "additions": 8, "deletions": 7, "changes": 15, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/98568e0337010d21eb43a6939070162f89aad841/gcc%2Fcp%2Fpt.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/98568e0337010d21eb43a6939070162f89aad841/gcc%2Fcp%2Fpt.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fcp%2Fpt.c?ref=98568e0337010d21eb43a6939070162f89aad841", "patch": "@@ -3997,10 +3997,10 @@ canonical_type_parameter (tree type)\n   tree list;\n   int idx = TEMPLATE_TYPE_IDX (type);\n   if (!canonical_template_parms)\n-    vec_alloc (canonical_template_parms, idx+1);\n+    vec_alloc (canonical_template_parms, idx + 1);\n \n-  while (canonical_template_parms->length () <= (unsigned)idx)\n-    vec_safe_push (canonical_template_parms, NULL_TREE);\n+  if (canonical_template_parms->length () <= (unsigned) idx)\n+    vec_safe_grow_cleared (canonical_template_parms, idx + 1);\n \n   list = (*canonical_template_parms)[idx];\n   while (list && !comptypes (type, TREE_VALUE (list), COMPARE_STRUCTURAL))\n@@ -4011,8 +4011,7 @@ canonical_type_parameter (tree type)\n   else\n     {\n       (*canonical_template_parms)[idx]\n-\t\t= tree_cons (NULL_TREE, type,\n-\t\t\t     (*canonical_template_parms)[idx]);\n+\t= tree_cons (NULL_TREE, type, (*canonical_template_parms)[idx]);\n       return type;\n     }\n }\n@@ -24955,6 +24954,8 @@ rewrite_template_parm (tree olddecl, unsigned index, unsigned level,\n       newidx = TEMPLATE_TYPE_PARM_INDEX (newtype)\n \t= build_template_parm_index (index, level, level,\n \t\t\t\t     newdecl, newtype);\n+      TEMPLATE_PARM_PARAMETER_PACK (newidx)\n+\t= TEMPLATE_PARM_PARAMETER_PACK (oldidx);\n       TYPE_STUB_DECL (newtype) = TYPE_NAME (newtype) = newdecl;\n       TYPE_CANONICAL (newtype) = canonical_type_parameter (newtype);\n \n@@ -25002,11 +25003,11 @@ rewrite_template_parm (tree olddecl, unsigned index, unsigned level,\n       SET_DECL_TEMPLATE_PARM_P (newconst);\n       newidx = build_template_parm_index (index, level, level,\n \t\t\t\t\t  newconst, newtype);\n+      TEMPLATE_PARM_PARAMETER_PACK (newidx)\n+\t= TEMPLATE_PARM_PARAMETER_PACK (oldidx);\n       DECL_INITIAL (newdecl) = DECL_INITIAL (newconst) = newidx;\n     }\n \n-  TEMPLATE_PARM_PARAMETER_PACK (newidx)\n-    = TEMPLATE_PARM_PARAMETER_PACK (oldidx);\n   return newdecl;\n }\n "}]}