{"sha": "b76a529c095f076c4780df0c913cf6d2391bcbc9", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6Yjc2YTUyOWMwOTVmMDc2YzQ3ODBkZjBjOTEzY2Y2ZDIzOTFiY2JjOQ==", "commit": {"author": {"name": "Jonathan Wakely", "email": "jwakely@redhat.com", "date": "2021-06-14T11:30:52Z"}, "committer": {"name": "Jonathan Wakely", "email": "jwakely@redhat.com", "date": "2021-06-14T13:04:45Z"}, "message": "libstdc++: Implement LWG 3465 for std::compare_partial_order_fallback [PR101056]\n\nlibstdc++-v3/ChangeLog:\n\n\tPR libstdc++/101056\n\t* libsupc++/compare (compare_partial_order_fallback): Add\n\tconstraint using reversed parameter order, as per LWG 3465.\n\t* testsuite/18_support/comparisons/algorithms/fallback.cc:\n\tAdjust expected result.", "tree": {"sha": "41e756b31f8630c27d74059a49559d41ce32c154", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/41e756b31f8630c27d74059a49559d41ce32c154"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/b76a529c095f076c4780df0c913cf6d2391bcbc9", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/b76a529c095f076c4780df0c913cf6d2391bcbc9", "html_url": "https://github.com/Rust-GCC/gccrs/commit/b76a529c095f076c4780df0c913cf6d2391bcbc9", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/b76a529c095f076c4780df0c913cf6d2391bcbc9/comments", "author": {"login": "jwakely", "id": 1254480, "node_id": "MDQ6VXNlcjEyNTQ0ODA=", "avatar_url": "https://avatars.githubusercontent.com/u/1254480?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jwakely", "html_url": "https://github.com/jwakely", "followers_url": "https://api.github.com/users/jwakely/followers", "following_url": "https://api.github.com/users/jwakely/following{/other_user}", "gists_url": "https://api.github.com/users/jwakely/gists{/gist_id}", "starred_url": "https://api.github.com/users/jwakely/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jwakely/subscriptions", "organizations_url": "https://api.github.com/users/jwakely/orgs", "repos_url": "https://api.github.com/users/jwakely/repos", "events_url": "https://api.github.com/users/jwakely/events{/privacy}", "received_events_url": "https://api.github.com/users/jwakely/received_events", "type": "User", "site_admin": false}, "committer": {"login": "jwakely", "id": 1254480, "node_id": "MDQ6VXNlcjEyNTQ0ODA=", "avatar_url": "https://avatars.githubusercontent.com/u/1254480?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jwakely", "html_url": "https://github.com/jwakely", "followers_url": "https://api.github.com/users/jwakely/followers", "following_url": "https://api.github.com/users/jwakely/following{/other_user}", "gists_url": "https://api.github.com/users/jwakely/gists{/gist_id}", "starred_url": "https://api.github.com/users/jwakely/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jwakely/subscriptions", "organizations_url": "https://api.github.com/users/jwakely/orgs", "repos_url": "https://api.github.com/users/jwakely/repos", "events_url": "https://api.github.com/users/jwakely/events{/privacy}", "received_events_url": "https://api.github.com/users/jwakely/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "e2c79b968ff95421c31a5a9a1b80b11321fe70d2", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/e2c79b968ff95421c31a5a9a1b80b11321fe70d2", "html_url": "https://github.com/Rust-GCC/gccrs/commit/e2c79b968ff95421c31a5a9a1b80b11321fe70d2"}], "stats": {"total": 16, "additions": 13, "deletions": 3}, "files": [{"sha": "dd0ec5fa36db501ad9ac64fbdffeb2cd83f34816", "filename": "libstdc++-v3/libsupc++/compare", "status": "modified", "additions": 12, "deletions": 2, "changes": 14, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/b76a529c095f076c4780df0c913cf6d2391bcbc9/libstdc%2B%2B-v3%2Flibsupc%2B%2B%2Fcompare", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/b76a529c095f076c4780df0c913cf6d2391bcbc9/libstdc%2B%2B-v3%2Flibsupc%2B%2B%2Fcompare", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libstdc%2B%2B-v3%2Flibsupc%2B%2B%2Fcompare?ref=b76a529c095f076c4780df0c913cf6d2391bcbc9", "patch": "@@ -806,6 +806,16 @@ namespace std\n \t}\n     };\n \n+    // _GLIBCXX_RESOLVE_LIB_DEFECTS\n+    // 3465. compare_partial_order_fallback requires F < E\n+    template<typename _Tp, typename _Up>\n+      concept __op_eq_lt_lt = __op_eq_lt<_Tp, _Up>\n+\t&& requires(_Tp&& __t, _Up&& __u)\n+\t{\n+\t  { static_cast<_Up&&>(__u) < static_cast<_Tp&&>(__t) }\n+\t    -> convertible_to<bool>;\n+\t};\n+\n     class _Partial_fallback\n     {\n       template<typename _Tp, typename _Up>\n@@ -821,15 +831,15 @@ namespace std\n \n     public:\n       template<typename _Tp, __decayed_same_as<_Tp> _Up>\n-\trequires __partially_ordered<_Tp, _Up> || __op_eq_lt<_Tp, _Up>\n+\trequires __partially_ordered<_Tp, _Up> || __op_eq_lt_lt<_Tp, _Up>\n \tconstexpr partial_ordering\n \toperator()(_Tp&& __e, _Up&& __f) const\n \tnoexcept(_S_noexcept<_Tp, _Up>())\n \t{\n \t  if constexpr (__partially_ordered<_Tp, _Up>)\n \t    return _Partial_order{}(static_cast<_Tp&&>(__e),\n \t\t\t\t    static_cast<_Up&&>(__f));\n-\t  else // __op_eq_lt<_Tp, _Up>\n+\t  else // __op_eq_lt_lt<_Tp, _Up>\n \t    return static_cast<_Tp&&>(__e) == static_cast<_Up&&>(__f)\n \t      ? partial_ordering::equivalent\n \t      : static_cast<_Tp&&>(__e) < static_cast<_Up&&>(__f)"}, {"sha": "05e1bf7775e6634838a370b99705cc96fbe6870a", "filename": "libstdc++-v3/testsuite/18_support/comparisons/algorithms/fallback.cc", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/b76a529c095f076c4780df0c913cf6d2391bcbc9/libstdc%2B%2B-v3%2Ftestsuite%2F18_support%2Fcomparisons%2Falgorithms%2Ffallback.cc", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/b76a529c095f076c4780df0c913cf6d2391bcbc9/libstdc%2B%2B-v3%2Ftestsuite%2F18_support%2Fcomparisons%2Falgorithms%2Ffallback.cc", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libstdc%2B%2B-v3%2Ftestsuite%2F18_support%2Fcomparisons%2Falgorithms%2Ffallback.cc?ref=b76a529c095f076c4780df0c913cf6d2391bcbc9", "patch": "@@ -38,5 +38,5 @@ static_assert( has_weak_order_fallback<S, S> );\n static_assert( has_weak_order_fallback<const S, S> );\n static_assert( ! has_weak_order_fallback<const S, const S> );\n static_assert( has_partial_order_fallback<S, S> );\n-static_assert( has_partial_order_fallback<const S, S> );\n+static_assert( ! has_partial_order_fallback<const S, S> ); // LWG 3465\n static_assert( ! has_partial_order_fallback<const S, const S> );"}]}