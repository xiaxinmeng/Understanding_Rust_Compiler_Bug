{"sha": "4f517dce47bb98269a4954438b2295dc93510d86", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6NGY1MTdkY2U0N2JiOTgyNjlhNDk1NDQzOGIyMjk1ZGM5MzUxMGQ4Ng==", "commit": {"author": {"name": "Jakub Jelinek", "email": "jakub@redhat.com", "date": "2009-11-18T09:57:47Z"}, "committer": {"name": "Jakub Jelinek", "email": "jakub@gcc.gnu.org", "date": "2009-11-18T09:57:47Z"}, "message": "dwarf2out.c (loc_list_from_tree): Don't call rtl_for_decl_location unnecessarily.\n\n\t* dwarf2out.c (loc_list_from_tree): Don't call rtl_for_decl_location\n\tunnecessarily.\n\t(rtl_for_decl_location): Try harder to get a rtl for TREE_STATIC vars.\n\nFrom-SVN: r154285", "tree": {"sha": "eefe8ef212ec14999e70ff657eec5182204cd34f", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/eefe8ef212ec14999e70ff657eec5182204cd34f"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/4f517dce47bb98269a4954438b2295dc93510d86", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/4f517dce47bb98269a4954438b2295dc93510d86", "html_url": "https://github.com/Rust-GCC/gccrs/commit/4f517dce47bb98269a4954438b2295dc93510d86", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/4f517dce47bb98269a4954438b2295dc93510d86/comments", "author": {"login": "jakubjelinek", "id": 9370665, "node_id": "MDQ6VXNlcjkzNzA2NjU=", "avatar_url": "https://avatars.githubusercontent.com/u/9370665?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jakubjelinek", "html_url": "https://github.com/jakubjelinek", "followers_url": "https://api.github.com/users/jakubjelinek/followers", "following_url": "https://api.github.com/users/jakubjelinek/following{/other_user}", "gists_url": "https://api.github.com/users/jakubjelinek/gists{/gist_id}", "starred_url": "https://api.github.com/users/jakubjelinek/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jakubjelinek/subscriptions", "organizations_url": "https://api.github.com/users/jakubjelinek/orgs", "repos_url": "https://api.github.com/users/jakubjelinek/repos", "events_url": "https://api.github.com/users/jakubjelinek/events{/privacy}", "received_events_url": "https://api.github.com/users/jakubjelinek/received_events", "type": "User", "site_admin": false}, "committer": null, "parents": [{"sha": "b25833451bbe9b8a2194598b026cea071f4e9e65", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/b25833451bbe9b8a2194598b026cea071f4e9e65", "html_url": "https://github.com/Rust-GCC/gccrs/commit/b25833451bbe9b8a2194598b026cea071f4e9e65"}], "stats": {"total": 35, "additions": 32, "deletions": 3}, "files": [{"sha": "c14d3c392fcdb011dd0f3f33f589edc1abc8f0fc", "filename": "gcc/ChangeLog", "status": "modified", "additions": 4, "deletions": 0, "changes": 4, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/4f517dce47bb98269a4954438b2295dc93510d86/gcc%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/4f517dce47bb98269a4954438b2295dc93510d86/gcc%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2FChangeLog?ref=4f517dce47bb98269a4954438b2295dc93510d86", "patch": "@@ -1,5 +1,9 @@\n 2009-11-18  Jakub Jelinek  <jakub@redhat.com>\n \n+\t* dwarf2out.c (loc_list_from_tree): Don't call rtl_for_decl_location\n+\tunnecessarily.\n+\t(rtl_for_decl_location): Try harder to get a rtl for TREE_STATIC vars.\n+\n \tPR c++/3187\n \t* cgraph.h (struct cgraph_node): Add same_body and same_body_alias\n \tfields."}, {"sha": "3db2092b4ee6b87815742e6aba0d61cd7f632c8e", "filename": "gcc/dwarf2out.c", "status": "modified", "additions": 28, "deletions": 3, "changes": 31, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/4f517dce47bb98269a4954438b2295dc93510d86/gcc%2Fdwarf2out.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/4f517dce47bb98269a4954438b2295dc93510d86/gcc%2Fdwarf2out.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fdwarf2out.c?ref=4f517dce47bb98269a4954438b2295dc93510d86", "patch": "@@ -14309,13 +14309,17 @@ loc_list_from_tree (tree loc, int want_address)\n     case RESULT_DECL:\n     case FUNCTION_DECL:\n       {\n-\trtx rtl = rtl_for_decl_location (loc);\n+\trtx rtl;\n \tvar_loc_list *loc_list = lookup_decl_loc (loc);\n \n \tif (loc_list && loc_list->first\n \t    && (list_ret = dw_loc_list (loc_list, loc, want_address)))\n-\t  have_address = want_address != 0;\n-\telse if (rtl == NULL_RTX)\n+\t  {\n+\t    have_address = want_address != 0;\n+\t    break;\n+\t  }\n+\trtl = rtl_for_decl_location (loc);\n+\tif (rtl == NULL_RTX)\n \t  {\n \t    expansion_failed (loc, NULL_RTX, \"DECL has no RTL\");\n \t    return 0;\n@@ -15605,6 +15609,27 @@ rtl_for_decl_location (tree decl)\n   if (rtl)\n     rtl = avoid_constant_pool_reference (rtl);\n \n+  /* Try harder to get a rtl.  If this symbol ends up not being emitted\n+     in the current CU, resolve_addr will remove the expression referencing\n+     it.  */\n+  if (rtl == NULL_RTX\n+      && TREE_CODE (decl) == VAR_DECL\n+      && !DECL_EXTERNAL (decl)\n+      && TREE_STATIC (decl)\n+      && DECL_NAME (decl)\n+      && !DECL_HARD_REGISTER (decl)\n+      && DECL_MODE (decl) != VOIDmode)\n+    {\n+      rtl = DECL_RTL (decl);\n+      /* Reset DECL_RTL back, as various parts of the compiler expects\n+\t DECL_RTL set meaning it is actually going to be output.  */\n+      SET_DECL_RTL (decl, NULL);\n+      if (!MEM_P (rtl)\n+\t  || GET_CODE (XEXP (rtl, 0)) != SYMBOL_REF\n+\t  || SYMBOL_REF_DECL (XEXP (rtl, 0)) != decl)\n+\trtl = NULL_RTX;\n+    }\n+\n   return rtl;\n }\n "}]}