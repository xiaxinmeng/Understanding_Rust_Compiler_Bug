{"sha": "8b08ef255bd6e37c4f29e99d45a156bd5c007aa6", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6OGIwOGVmMjU1YmQ2ZTM3YzRmMjllOTlkNDVhMTU2YmQ1YzAwN2FhNg==", "commit": {"author": {"name": "Jakub Jelinek", "email": "jakub@redhat.com", "date": "2015-01-21T21:21:27Z"}, "committer": {"name": "Jakub Jelinek", "email": "jakub@gcc.gnu.org", "date": "2015-01-21T21:21:27Z"}, "message": "re PR sanitizer/64435 (Bootstrap failure in libsanitizer on AArch64 with Linux kernel <= 3.15)\n\n\tPR sanitizer/64435\n\t* sanitizer_common/sanitizer_platform_limits_posix.h: Cherry pick\n\tupstream r226637.\n\t* sanitizer_common/sanitizer_platform_limits_posix.cc: Likewise.\n\t* sanitizer_common/sanitizer_posix.cc: Cherry pick upstream r226639.\n\nFrom-SVN: r219968", "tree": {"sha": "427536f9380e1647b1aaf6178db3c701d1932f19", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/427536f9380e1647b1aaf6178db3c701d1932f19"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/8b08ef255bd6e37c4f29e99d45a156bd5c007aa6", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/8b08ef255bd6e37c4f29e99d45a156bd5c007aa6", "html_url": "https://github.com/Rust-GCC/gccrs/commit/8b08ef255bd6e37c4f29e99d45a156bd5c007aa6", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/8b08ef255bd6e37c4f29e99d45a156bd5c007aa6/comments", "author": {"login": "jakubjelinek", "id": 9370665, "node_id": "MDQ6VXNlcjkzNzA2NjU=", "avatar_url": "https://avatars.githubusercontent.com/u/9370665?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jakubjelinek", "html_url": "https://github.com/jakubjelinek", "followers_url": "https://api.github.com/users/jakubjelinek/followers", "following_url": "https://api.github.com/users/jakubjelinek/following{/other_user}", "gists_url": "https://api.github.com/users/jakubjelinek/gists{/gist_id}", "starred_url": "https://api.github.com/users/jakubjelinek/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jakubjelinek/subscriptions", "organizations_url": "https://api.github.com/users/jakubjelinek/orgs", "repos_url": "https://api.github.com/users/jakubjelinek/repos", "events_url": "https://api.github.com/users/jakubjelinek/events{/privacy}", "received_events_url": "https://api.github.com/users/jakubjelinek/received_events", "type": "User", "site_admin": false}, "committer": null, "parents": [{"sha": "f1eac182405b9540c9ddecc9d72459fe82aa3f61", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/f1eac182405b9540c9ddecc9d72459fe82aa3f61", "html_url": "https://github.com/Rust-GCC/gccrs/commit/f1eac182405b9540c9ddecc9d72459fe82aa3f61"}], "stats": {"total": 21, "additions": 17, "deletions": 4}, "files": [{"sha": "de7c633c6d7dbff458ebd1d417a72e7b1301c481", "filename": "libsanitizer/ChangeLog", "status": "modified", "additions": 8, "deletions": 0, "changes": 8, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/8b08ef255bd6e37c4f29e99d45a156bd5c007aa6/libsanitizer%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/8b08ef255bd6e37c4f29e99d45a156bd5c007aa6/libsanitizer%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libsanitizer%2FChangeLog?ref=8b08ef255bd6e37c4f29e99d45a156bd5c007aa6", "patch": "@@ -1,3 +1,11 @@\n+2015-01-21  Jakub Jelinek  <jakub@redhat.com>\n+\n+\tPR sanitizer/64435\n+\t* sanitizer_common/sanitizer_platform_limits_posix.h: Cherry pick\n+\tupstream r226637.\n+\t* sanitizer_common/sanitizer_platform_limits_posix.cc: Likewise.\n+\t* sanitizer_common/sanitizer_posix.cc: Cherry pick upstream r226639.\n+\n 2015-01-20  Jakub Jelinek  <jakub@redhat.com>\n \n \tPR sanitizer/64632"}, {"sha": "199a842447a52a7365886894c23ea1e4dd5091f6", "filename": "libsanitizer/sanitizer_common/sanitizer_platform_limits_posix.cc", "status": "modified", "additions": 6, "deletions": 0, "changes": 6, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/8b08ef255bd6e37c4f29e99d45a156bd5c007aa6/libsanitizer%2Fsanitizer_common%2Fsanitizer_platform_limits_posix.cc", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/8b08ef255bd6e37c4f29e99d45a156bd5c007aa6/libsanitizer%2Fsanitizer_common%2Fsanitizer_platform_limits_posix.cc", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libsanitizer%2Fsanitizer_common%2Fsanitizer_platform_limits_posix.cc?ref=8b08ef255bd6e37c4f29e99d45a156bd5c007aa6", "patch": "@@ -1059,7 +1059,13 @@ CHECK_SIZE_AND_OFFSET(ipc_perm, uid);\n CHECK_SIZE_AND_OFFSET(ipc_perm, gid);\n CHECK_SIZE_AND_OFFSET(ipc_perm, cuid);\n CHECK_SIZE_AND_OFFSET(ipc_perm, cgid);\n+#ifndef __GLIBC_PREREQ\n+#define __GLIBC_PREREQ(x, y) 0\n+#endif\n+#if !defined(__aarch64__) || !SANITIZER_LINUX || __GLIBC_PREREQ (2, 21)\n+/* On aarch64 glibc 2.20 and earlier provided incorrect mode field.  */\n CHECK_SIZE_AND_OFFSET(ipc_perm, mode);\n+#endif\n \n CHECK_TYPE_SIZE(shmid_ds);\n CHECK_SIZE_AND_OFFSET(shmid_ds, shm_perm);"}, {"sha": "631983a5fdb1963a2bc1d5dfe549ce27569de1c0", "filename": "libsanitizer/sanitizer_common/sanitizer_platform_limits_posix.h", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/8b08ef255bd6e37c4f29e99d45a156bd5c007aa6/libsanitizer%2Fsanitizer_common%2Fsanitizer_platform_limits_posix.h", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/8b08ef255bd6e37c4f29e99d45a156bd5c007aa6/libsanitizer%2Fsanitizer_common%2Fsanitizer_platform_limits_posix.h", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libsanitizer%2Fsanitizer_common%2Fsanitizer_platform_limits_posix.h?ref=8b08ef255bd6e37c4f29e99d45a156bd5c007aa6", "patch": "@@ -167,7 +167,7 @@ namespace __sanitizer {\n     unsigned __seq;\n     u64 __unused1;\n     u64 __unused2;\n-#elif defined(__mips__)\n+#elif defined(__mips__) || defined(__aarch64__)\n     unsigned int mode;\n     unsigned short __seq;\n     unsigned short __pad1;"}, {"sha": "adb1b2a9d6801ac326f9ba139bf99d8b1c86e598", "filename": "libsanitizer/sanitizer_common/sanitizer_posix.cc", "status": "modified", "additions": 2, "deletions": 3, "changes": 5, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/8b08ef255bd6e37c4f29e99d45a156bd5c007aa6/libsanitizer%2Fsanitizer_common%2Fsanitizer_posix.cc", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/8b08ef255bd6e37c4f29e99d45a156bd5c007aa6/libsanitizer%2Fsanitizer_common%2Fsanitizer_posix.cc", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libsanitizer%2Fsanitizer_common%2Fsanitizer_posix.cc?ref=8b08ef255bd6e37c4f29e99d45a156bd5c007aa6", "patch": "@@ -76,16 +76,15 @@ static uptr GetKernelAreaSize() {\n \n uptr GetMaxVirtualAddress() {\n #if SANITIZER_WORDSIZE == 64\n-# if defined(__powerpc64__)\n+# if defined(__powerpc64__) || defined(__aarch64__)\n   // On PowerPC64 we have two different address space layouts: 44- and 46-bit.\n   // We somehow need to figure out which one we are using now and choose\n   // one of 0x00000fffffffffffUL and 0x00003fffffffffffUL.\n   // Note that with 'ulimit -s unlimited' the stack is moved away from the top\n   // of the address space, so simply checking the stack address is not enough.\n   // This should (does) work for both PowerPC64 Endian modes.\n+  // Similarly, aarch64 has multiple address space layouts: 39, 42 and 47-bit.\n   return (1ULL << (MostSignificantSetBitIndex(GET_CURRENT_FRAME()) + 1)) - 1;\n-# elif defined(__aarch64__)\n-  return (1ULL << 39) - 1;\n # elif defined(__mips64)\n   return (1ULL << 40) - 1;\n # else"}]}