{"sha": "03989f55955ddb1f82ce79a7c2251039d0ba5d0e", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6MDM5ODlmNTU5NTVkZGIxZjgyY2U3OWE3YzIyNTEwMzlkMGJhNWQwZQ==", "commit": {"author": {"name": "Jakub Jelinek", "email": "jakub@redhat.com", "date": "2011-11-10T15:36:48Z"}, "committer": {"name": "Jakub Jelinek", "email": "jakub@gcc.gnu.org", "date": "2011-11-10T15:36:48Z"}, "message": "re PR rtl-optimization/51023 (likely integer wrong code bug)\n\n\tPR rtl-optimization/51023\n\t* combine.c (simplify_comparison) <case SIGN_EXTEND>: Don't use\n\tval_signbit_known_clear_p for signed comparison narrowing\n\toptimization.  Don't check for non-VOIDmode, use\n\tHWI_COMPUTABLE_MODE_P macro.\n\t<case ZERO_EXTEND>: Don't check for non-VOIDmode.\n\tOptimize even when const_op is equal to GET_MODE_MASK (mode),\n\tdon't optimize if const_op is negative.\n\n\t* gcc.c-torture/execute/pr51023.c: New test.\n\nFrom-SVN: r181257", "tree": {"sha": "3c906560b2c9e0caabf7c866135d739cfc9868d4", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/3c906560b2c9e0caabf7c866135d739cfc9868d4"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/03989f55955ddb1f82ce79a7c2251039d0ba5d0e", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/03989f55955ddb1f82ce79a7c2251039d0ba5d0e", "html_url": "https://github.com/Rust-GCC/gccrs/commit/03989f55955ddb1f82ce79a7c2251039d0ba5d0e", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/03989f55955ddb1f82ce79a7c2251039d0ba5d0e/comments", "author": {"login": "jakubjelinek", "id": 9370665, "node_id": "MDQ6VXNlcjkzNzA2NjU=", "avatar_url": "https://avatars.githubusercontent.com/u/9370665?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jakubjelinek", "html_url": "https://github.com/jakubjelinek", "followers_url": "https://api.github.com/users/jakubjelinek/followers", "following_url": "https://api.github.com/users/jakubjelinek/following{/other_user}", "gists_url": "https://api.github.com/users/jakubjelinek/gists{/gist_id}", "starred_url": "https://api.github.com/users/jakubjelinek/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jakubjelinek/subscriptions", "organizations_url": "https://api.github.com/users/jakubjelinek/orgs", "repos_url": "https://api.github.com/users/jakubjelinek/repos", "events_url": "https://api.github.com/users/jakubjelinek/events{/privacy}", "received_events_url": "https://api.github.com/users/jakubjelinek/received_events", "type": "User", "site_admin": false}, "committer": null, "parents": [{"sha": "4da80bfb5d2e188674abdf5461876108e77ab881", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/4da80bfb5d2e188674abdf5461876108e77ab881", "html_url": "https://github.com/Rust-GCC/gccrs/commit/4da80bfb5d2e188674abdf5461876108e77ab881"}], "stats": {"total": 44, "additions": 40, "deletions": 4}, "files": [{"sha": "faea63af24d56887866e1d8900cbfeccc411c1dc", "filename": "gcc/ChangeLog", "status": "modified", "additions": 11, "deletions": 0, "changes": 11, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/03989f55955ddb1f82ce79a7c2251039d0ba5d0e/gcc%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/03989f55955ddb1f82ce79a7c2251039d0ba5d0e/gcc%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2FChangeLog?ref=03989f55955ddb1f82ce79a7c2251039d0ba5d0e", "patch": "@@ -1,3 +1,14 @@\n+2011-11-10  Jakub Jelinek  <jakub@redhat.com>\n+\n+\tPR rtl-optimization/51023\n+\t* combine.c (simplify_comparison) <case SIGN_EXTEND>: Don't use\n+\tval_signbit_known_clear_p for signed comparison narrowing\n+\toptimization.  Don't check for non-VOIDmode, use\n+\tHWI_COMPUTABLE_MODE_P macro.\n+\t<case ZERO_EXTEND>: Don't check for non-VOIDmode.\n+\tOptimize even when const_op is equal to GET_MODE_MASK (mode),\n+\tdon't optimize if const_op is negative.\n+\n 2011-11-10  Richard Guenther  <rguenther@suse.de>\n \n \tPR tree-optimization/51042"}, {"sha": "1714c749e16c5e0b9b19ac2bd274c12b67d81552", "filename": "gcc/combine.c", "status": "modified", "additions": 6, "deletions": 4, "changes": 10, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/03989f55955ddb1f82ce79a7c2251039d0ba5d0e/gcc%2Fcombine.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/03989f55955ddb1f82ce79a7c2251039d0ba5d0e/gcc%2Fcombine.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fcombine.c?ref=03989f55955ddb1f82ce79a7c2251039d0ba5d0e", "patch": "@@ -11397,9 +11397,10 @@ simplify_comparison (enum rtx_code code, rtx *pop0, rtx *pop1)\n \t     later on, and then we wouldn't know whether to sign- or\n \t     zero-extend.  */\n \t  mode = GET_MODE (XEXP (op0, 0));\n-\t  if (mode != VOIDmode && GET_MODE_CLASS (mode) == MODE_INT\n+\t  if (GET_MODE_CLASS (mode) == MODE_INT\n \t      && ! unsigned_comparison_p\n-\t      && val_signbit_known_clear_p (mode, const_op)\n+\t      && HWI_COMPUTABLE_MODE_P (mode)\n+\t      && trunc_int_for_mode (const_op, mode) == const_op\n \t      && have_insn_for (COMPARE, mode))\n \t    {\n \t      op0 = XEXP (op0, 0);\n@@ -11477,10 +11478,11 @@ simplify_comparison (enum rtx_code code, rtx *pop0, rtx *pop1)\n \n \tcase ZERO_EXTEND:\n \t  mode = GET_MODE (XEXP (op0, 0));\n-\t  if (mode != VOIDmode && GET_MODE_CLASS (mode) == MODE_INT\n+\t  if (GET_MODE_CLASS (mode) == MODE_INT\n \t      && (unsigned_comparison_p || equality_comparison_p)\n \t      && HWI_COMPUTABLE_MODE_P (mode)\n-\t      && ((unsigned HOST_WIDE_INT) const_op < GET_MODE_MASK (mode))\n+\t      && (unsigned HOST_WIDE_INT) const_op <= GET_MODE_MASK (mode)\n+\t      && const_op >= 0\n \t      && have_insn_for (COMPARE, mode))\n \t    {\n \t      op0 = XEXP (op0, 0);"}, {"sha": "ffa8b57d8fa3b9043021adffe529542c0c5593fb", "filename": "gcc/testsuite/ChangeLog", "status": "modified", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/03989f55955ddb1f82ce79a7c2251039d0ba5d0e/gcc%2Ftestsuite%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/03989f55955ddb1f82ce79a7c2251039d0ba5d0e/gcc%2Ftestsuite%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2FChangeLog?ref=03989f55955ddb1f82ce79a7c2251039d0ba5d0e", "patch": "@@ -1,3 +1,8 @@\n+2011-11-10  Jakub Jelinek  <jakub@redhat.com>\n+\n+\tPR rtl-optimization/51023\n+\t* gcc.c-torture/execute/pr51023.c: New test.\n+\n 2011-11-10  Richard Guenther  <rguenther@suse.de>\n \n \tPR tree-optimization/51042"}, {"sha": "34252ea0ae03b3cbdc2025fd74b44dd6898d7c4f", "filename": "gcc/testsuite/gcc.c-torture/execute/pr51023.c", "status": "added", "additions": 18, "deletions": 0, "changes": 18, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/03989f55955ddb1f82ce79a7c2251039d0ba5d0e/gcc%2Ftestsuite%2Fgcc.c-torture%2Fexecute%2Fpr51023.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/03989f55955ddb1f82ce79a7c2251039d0ba5d0e/gcc%2Ftestsuite%2Fgcc.c-torture%2Fexecute%2Fpr51023.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgcc.c-torture%2Fexecute%2Fpr51023.c?ref=03989f55955ddb1f82ce79a7c2251039d0ba5d0e", "patch": "@@ -0,0 +1,18 @@\n+/* PR rtl-optimization/51023 */\n+\n+extern void abort (void);\n+\n+short int\n+foo (long int x)\n+{\n+  return x;\n+}\n+\n+int\n+main ()\n+{\n+  long int a = 0x4272AL;\n+  if (foo (a) == a)\n+    abort ();\n+  return 0;\n+}"}]}