{"sha": "493e760dda4dac45eefac4185a7b04a1b8fc6c18", "node_id": "C_kwDOANBUbNoAKDQ5M2U3NjBkZGE0ZGFjNDVlZWZhYzQxODVhN2IwNGExYjhmYzZjMTg", "commit": {"author": {"name": "Marc Poulhi\u00e8s", "email": "poulhies@adacore.com", "date": "2022-11-07T13:34:54Z"}, "committer": {"name": "Marc Poulhi\u00e8s", "email": "poulhies@adacore.com", "date": "2022-11-21T10:10:31Z"}, "message": "ada: Reject nonconfirming Size attribute value for aliased object\n\nOnly confirming Size must be supported for aliased object of elementary\ntype (see RM 13.1 in the \"Implementation Advice\").\n\n   -- size is 1-byte\n   type Y is range 0 .. 20;\n   type Ay is access all Y;\n\n   -- Var size is 8-bytes\n   Var : aliased Y := 5 with Size => 64;\n\n   --  JP.all is a 1-byte reference to an 8-bytes objects.\n   JP : Ay := Var'Access;\n\nThe above JP.all references the first byte of the 8-byte Var object,\nwhich is, for example, not correct on little-endian systems.\n\nThis change rejects nonconfirming Size attribute on such objects\ninstead of miscompiling it.\n\ngcc/ada/\n\n\t* sem_ch13.adb (Check_One_Attr): produce error when Size attribute\n\tused on aliased object of elementary types with nonconfirming\n\tvalue.", "tree": {"sha": "a3425805f144661ec631250980e69844009767a6", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/a3425805f144661ec631250980e69844009767a6"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/493e760dda4dac45eefac4185a7b04a1b8fc6c18", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/493e760dda4dac45eefac4185a7b04a1b8fc6c18", "html_url": "https://github.com/Rust-GCC/gccrs/commit/493e760dda4dac45eefac4185a7b04a1b8fc6c18", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/493e760dda4dac45eefac4185a7b04a1b8fc6c18/comments", "author": {"login": "dkm", "id": 87603, "node_id": "MDQ6VXNlcjg3NjAz", "avatar_url": "https://avatars.githubusercontent.com/u/87603?v=4", "gravatar_id": "", "url": "https://api.github.com/users/dkm", "html_url": "https://github.com/dkm", "followers_url": "https://api.github.com/users/dkm/followers", "following_url": "https://api.github.com/users/dkm/following{/other_user}", "gists_url": "https://api.github.com/users/dkm/gists{/gist_id}", "starred_url": "https://api.github.com/users/dkm/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/dkm/subscriptions", "organizations_url": "https://api.github.com/users/dkm/orgs", "repos_url": "https://api.github.com/users/dkm/repos", "events_url": "https://api.github.com/users/dkm/events{/privacy}", "received_events_url": "https://api.github.com/users/dkm/received_events", "type": "User", "site_admin": false}, "committer": {"login": "dkm", "id": 87603, "node_id": "MDQ6VXNlcjg3NjAz", "avatar_url": "https://avatars.githubusercontent.com/u/87603?v=4", "gravatar_id": "", "url": "https://api.github.com/users/dkm", "html_url": "https://github.com/dkm", "followers_url": "https://api.github.com/users/dkm/followers", "following_url": "https://api.github.com/users/dkm/following{/other_user}", "gists_url": "https://api.github.com/users/dkm/gists{/gist_id}", "starred_url": "https://api.github.com/users/dkm/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/dkm/subscriptions", "organizations_url": "https://api.github.com/users/dkm/orgs", "repos_url": "https://api.github.com/users/dkm/repos", "events_url": "https://api.github.com/users/dkm/events{/privacy}", "received_events_url": "https://api.github.com/users/dkm/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "6d0d71ea1c685df245f3c11a5daf52843823cd58", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/6d0d71ea1c685df245f3c11a5daf52843823cd58", "html_url": "https://github.com/Rust-GCC/gccrs/commit/6d0d71ea1c685df245f3c11a5daf52843823cd58"}], "stats": {"total": 15, "additions": 15, "deletions": 0}, "files": [{"sha": "bf84a10ded6c343dfc8c3dd83025f37541d6c664", "filename": "gcc/ada/sem_ch13.adb", "status": "modified", "additions": 15, "deletions": 0, "changes": 15, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/493e760dda4dac45eefac4185a7b04a1b8fc6c18/gcc%2Fada%2Fsem_ch13.adb", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/493e760dda4dac45eefac4185a7b04a1b8fc6c18/gcc%2Fada%2Fsem_ch13.adb", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fada%2Fsem_ch13.adb?ref=493e760dda4dac45eefac4185a7b04a1b8fc6c18", "patch": "@@ -7310,6 +7310,21 @@ package body Sem_Ch13 is\n                      Set_Esize (U_Ent, Size);\n                   end if;\n \n+                  --  As of RM 13.1, only confirming size\n+                  --  (i.e. (Size = Esize (Etyp))) for aliased object of\n+                  --  elementary type must be supported.\n+                  --  GNAT rejects nonconfirming size for such object.\n+\n+                  if Is_Aliased (U_Ent)\n+                    and then Is_Elementary_Type (Etyp)\n+                    and then Known_Esize (U_Ent)\n+                    and then Size /= Esize (Etyp)\n+                  then\n+                     Error_Msg_N\n+                       (\"nonconfirming Size for aliased object is not \"\n+                        & \"supported\", N);\n+                  end if;\n+\n                   Set_Has_Size_Clause (U_Ent);\n                end;\n             end if;"}]}