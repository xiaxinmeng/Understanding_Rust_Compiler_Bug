{"sha": "39f5b724844a28bea3dbb2a5c0b88bdce89ec4cb", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6MzlmNWI3MjQ4NDRhMjhiZWEzZGJiMmE1YzBiODhiZGNlODllYzRjYg==", "commit": {"author": {"name": "Jakub Jelinek", "email": "jakub@redhat.com", "date": "2020-08-31T08:51:02Z"}, "committer": {"name": "Jakub Jelinek", "email": "jakub@redhat.com", "date": "2020-08-31T08:51:02Z"}, "message": "tree-cfg: Improve gimple switch verification\n\nWhen looking at the verification, I have noticed a bug in it.\n\nThe verification that CASE_HIGH (if present) has the same type as CASE_LOW\nis only performed for the case label 2 and higher, case label 1 (the first\none after the default label) isn't checked.\n\nThe following patch fixes that, it will uselessly also compare\nTREE_TYPE (CASE_LOW (elt)) != elt_type for the case label 1, but I think\nthat isn't that expensive and helps readability of the code.\n\n2020-08-31  Jakub Jelinek  <jakub@redhat.com>\n\n\t* tree-cfg.c (verify_gimple_switch): If the first non-default case\n\tlabel has CASE_HIGH, verify it has the same type as CASE_LOW.", "tree": {"sha": "1a75c66b8d5f03337b1d66c958ee7409a6d0df78", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/1a75c66b8d5f03337b1d66c958ee7409a6d0df78"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/39f5b724844a28bea3dbb2a5c0b88bdce89ec4cb", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/39f5b724844a28bea3dbb2a5c0b88bdce89ec4cb", "html_url": "https://github.com/Rust-GCC/gccrs/commit/39f5b724844a28bea3dbb2a5c0b88bdce89ec4cb", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/39f5b724844a28bea3dbb2a5c0b88bdce89ec4cb/comments", "author": {"login": "jakubjelinek", "id": 9370665, "node_id": "MDQ6VXNlcjkzNzA2NjU=", "avatar_url": "https://avatars.githubusercontent.com/u/9370665?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jakubjelinek", "html_url": "https://github.com/jakubjelinek", "followers_url": "https://api.github.com/users/jakubjelinek/followers", "following_url": "https://api.github.com/users/jakubjelinek/following{/other_user}", "gists_url": "https://api.github.com/users/jakubjelinek/gists{/gist_id}", "starred_url": "https://api.github.com/users/jakubjelinek/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jakubjelinek/subscriptions", "organizations_url": "https://api.github.com/users/jakubjelinek/orgs", "repos_url": "https://api.github.com/users/jakubjelinek/repos", "events_url": "https://api.github.com/users/jakubjelinek/events{/privacy}", "received_events_url": "https://api.github.com/users/jakubjelinek/received_events", "type": "User", "site_admin": false}, "committer": {"login": "jakubjelinek", "id": 9370665, "node_id": "MDQ6VXNlcjkzNzA2NjU=", "avatar_url": "https://avatars.githubusercontent.com/u/9370665?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jakubjelinek", "html_url": "https://github.com/jakubjelinek", "followers_url": "https://api.github.com/users/jakubjelinek/followers", "following_url": "https://api.github.com/users/jakubjelinek/following{/other_user}", "gists_url": "https://api.github.com/users/jakubjelinek/gists{/gist_id}", "starred_url": "https://api.github.com/users/jakubjelinek/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jakubjelinek/subscriptions", "organizations_url": "https://api.github.com/users/jakubjelinek/orgs", "repos_url": "https://api.github.com/users/jakubjelinek/repos", "events_url": "https://api.github.com/users/jakubjelinek/events{/privacy}", "received_events_url": "https://api.github.com/users/jakubjelinek/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "e11c4b7f837bc6b4c22b1f5bf41a9d0608d256be", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/e11c4b7f837bc6b4c22b1f5bf41a9d0608d256be", "html_url": "https://github.com/Rust-GCC/gccrs/commit/e11c4b7f837bc6b4c22b1f5bf41a9d0608d256be"}], "stats": {"total": 19, "additions": 8, "deletions": 11}, "files": [{"sha": "2964209ccff629fff767297807a6e58c73e21f5b", "filename": "gcc/tree-cfg.c", "status": "modified", "additions": 8, "deletions": 11, "changes": 19, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/39f5b724844a28bea3dbb2a5c0b88bdce89ec4cb/gcc%2Ftree-cfg.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/39f5b724844a28bea3dbb2a5c0b88bdce89ec4cb/gcc%2Ftree-cfg.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftree-cfg.c?ref=39f5b724844a28bea3dbb2a5c0b88bdce89ec4cb", "patch": "@@ -4809,17 +4809,7 @@ verify_gimple_switch (gswitch *stmt)\n \t  return true;\n \t}\n \n-      if (elt_type)\n-\t{\n-\t  if (TREE_TYPE (CASE_LOW (elt)) != elt_type\n-\t      || (CASE_HIGH (elt) && TREE_TYPE (CASE_HIGH (elt)) != elt_type))\n-\t    {\n-\t      error (\"type mismatch for case label in switch statement\");\n-\t      debug_generic_expr (elt);\n-\t      return true;\n-\t    }\n-\t}\n-      else\n+      if (! elt_type)\n \t{\n \t  elt_type = TREE_TYPE (CASE_LOW (elt));\n \t  if (TYPE_PRECISION (index_type) < TYPE_PRECISION (elt_type))\n@@ -4828,6 +4818,13 @@ verify_gimple_switch (gswitch *stmt)\n \t      return true;\n \t    }\n \t}\n+      if (TREE_TYPE (CASE_LOW (elt)) != elt_type\n+          || (CASE_HIGH (elt) && TREE_TYPE (CASE_HIGH (elt)) != elt_type))\n+\t{\n+\t  error (\"type mismatch for case label in switch statement\");\n+\t  debug_generic_expr (elt);\n+\t  return true;\n+\t}\n \n       if (prev_upper_bound)\n \t{"}]}