{"sha": "e0633768a1a2efe689e5505b3a95aa949d704b06", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6ZTA2MzM3NjhhMWEyZWZlNjg5ZTU1MDViM2E5NWFhOTQ5ZDcwNGIwNg==", "commit": {"author": {"name": "Martin Sebor", "email": "msebor@redhat.com", "date": "2020-07-25T20:21:47Z"}, "committer": {"name": "Martin Sebor", "email": "msebor@redhat.com", "date": "2020-07-25T20:24:24Z"}, "message": "Fix PR c++/96310 - Ignoring -Wnonnull via pragma gcc diagnostics still produces an unwanted note.\n\ngcc/c-family/ChangeLog:\n\tPR c++/96310\n\t* c-common.c (check_nonnull_arg): Print note only when warning was\n\tissued.", "tree": {"sha": "a9e31ce6ccb77f15b15ef50a3db7a32180034f14", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/a9e31ce6ccb77f15b15ef50a3db7a32180034f14"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/e0633768a1a2efe689e5505b3a95aa949d704b06", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/e0633768a1a2efe689e5505b3a95aa949d704b06", "html_url": "https://github.com/Rust-GCC/gccrs/commit/e0633768a1a2efe689e5505b3a95aa949d704b06", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/e0633768a1a2efe689e5505b3a95aa949d704b06/comments", "author": {"login": "msebor", "id": 381149, "node_id": "MDQ6VXNlcjM4MTE0OQ==", "avatar_url": "https://avatars.githubusercontent.com/u/381149?v=4", "gravatar_id": "", "url": "https://api.github.com/users/msebor", "html_url": "https://github.com/msebor", "followers_url": "https://api.github.com/users/msebor/followers", "following_url": "https://api.github.com/users/msebor/following{/other_user}", "gists_url": "https://api.github.com/users/msebor/gists{/gist_id}", "starred_url": "https://api.github.com/users/msebor/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/msebor/subscriptions", "organizations_url": "https://api.github.com/users/msebor/orgs", "repos_url": "https://api.github.com/users/msebor/repos", "events_url": "https://api.github.com/users/msebor/events{/privacy}", "received_events_url": "https://api.github.com/users/msebor/received_events", "type": "User", "site_admin": false}, "committer": {"login": "msebor", "id": 381149, "node_id": "MDQ6VXNlcjM4MTE0OQ==", "avatar_url": "https://avatars.githubusercontent.com/u/381149?v=4", "gravatar_id": "", "url": "https://api.github.com/users/msebor", "html_url": "https://github.com/msebor", "followers_url": "https://api.github.com/users/msebor/followers", "following_url": "https://api.github.com/users/msebor/following{/other_user}", "gists_url": "https://api.github.com/users/msebor/gists{/gist_id}", "starred_url": "https://api.github.com/users/msebor/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/msebor/subscriptions", "organizations_url": "https://api.github.com/users/msebor/orgs", "repos_url": "https://api.github.com/users/msebor/repos", "events_url": "https://api.github.com/users/msebor/events{/privacy}", "received_events_url": "https://api.github.com/users/msebor/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "8d0b2b33748014ee57973c1d7bc9fd7706bb3da9", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/8d0b2b33748014ee57973c1d7bc9fd7706bb3da9", "html_url": "https://github.com/Rust-GCC/gccrs/commit/8d0b2b33748014ee57973c1d7bc9fd7706bb3da9"}], "stats": {"total": 24, "additions": 22, "deletions": 2}, "files": [{"sha": "e2569c65827587d4d8a847bab71e35f8701f42dc", "filename": "gcc/c-family/c-common.c", "status": "modified", "additions": 2, "deletions": 2, "changes": 4, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/e0633768a1a2efe689e5505b3a95aa949d704b06/gcc%2Fc-family%2Fc-common.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/e0633768a1a2efe689e5505b3a95aa949d704b06/gcc%2Fc-family%2Fc-common.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fc-family%2Fc-common.c?ref=e0633768a1a2efe689e5505b3a95aa949d704b06", "patch": "@@ -5538,7 +5538,7 @@ check_nonnull_arg (void *ctx, tree param, unsigned HOST_WIDE_INT param_num)\n     {\n       warned = warning_at (loc, OPT_Wnonnull,\n \t\t\t   \"%qs pointer null\", \"this\");\n-      if (pctx->fndecl)\n+      if (warned && pctx->fndecl)\n \tinform (DECL_SOURCE_LOCATION (pctx->fndecl),\n \t\t\"in a call to non-static member function %qD\",\n \t\tpctx->fndecl);\n@@ -5548,7 +5548,7 @@ check_nonnull_arg (void *ctx, tree param, unsigned HOST_WIDE_INT param_num)\n       warned = warning_at (loc, OPT_Wnonnull,\n \t\t\t   \"argument %u null where non-null expected\",\n \t\t\t   (unsigned) param_num);\n-      if (pctx->fndecl)\n+      if (warned && pctx->fndecl)\n \tinform (DECL_SOURCE_LOCATION (pctx->fndecl),\n \t\t\"in a call to function %qD declared %qs\",\n \t\tpctx->fndecl, \"nonnull\");"}, {"sha": "7820b2e3b793e73a70c4de38cd461110645c4989", "filename": "gcc/testsuite/g++.dg/warn/Wnonnull8.C", "status": "added", "additions": 20, "deletions": 0, "changes": 20, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/e0633768a1a2efe689e5505b3a95aa949d704b06/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Fwarn%2FWnonnull8.C", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/e0633768a1a2efe689e5505b3a95aa949d704b06/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Fwarn%2FWnonnull8.C", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Fwarn%2FWnonnull8.C?ref=e0633768a1a2efe689e5505b3a95aa949d704b06", "patch": "@@ -0,0 +1,20 @@\n+/* PR c++/96310 - Ignoring -Wnonnull via pragma gcc diagnostics still produces\n+   an unwanted note\n+   { dg-do compile }\n+   { dg-options \"-Wall\" } */\n+\n+struct C {\n+  void f ();                  // { dg-message \"in a call\" }\n+  void g ();                  // { dg-bogus \"in a call\" }\n+};\n+\n+void f ()\n+{\n+  static_cast<C*>(0)->f ();   // { dg-warning \"\\\\\\[-Wnonnull\" }\n+}\n+\n+void g ()\n+{\n+#pragma GCC diagnostic ignored \"-Wnonnull\"\n+  static_cast<C*>(0)->g ();\n+}"}]}