{"sha": "a49c064e407df3d39776241f2c08b14e6affde1e", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6YTQ5YzA2NGU0MDdkZjNkMzk3NzYyNDFmMmMwOGIxNGU2YWZmZGUxZQ==", "commit": {"author": {"name": "Iain Sandoe", "email": "iain@sandoe.co.uk", "date": "2018-08-22T11:58:43Z"}, "committer": {"name": "Iain Sandoe", "email": "iains@gcc.gnu.org", "date": "2018-08-22T11:58:43Z"}, "message": "Move Darwin10 unwinder fix to a crt shim.\n\ngcc/\n\t* config/darwin10.h (LINK_GCC_C_SEQUENCE_SPEC): Adjust to use the\n\tDarwin10-specific unwinder-shim.\n\t* config/darwin12.h (LINK_GCC_C_SEQUENCE_SPEC): Remove.\n\t* config/rs6000/darwin.h (DARWIN_CRT1_SPEC, DARWIN_DYLIB1_SPEC): \n\tNew to cater for Darwin10 Rosetta.\n\nlibgcc/\n\t* config/unwind-dw2-fde-darwin.c\n\t(_darwin10_Unwind_FindEnclosingFunction): move from here ...\n\t* config/darwin10-unwind-find-enc-func.c: \u2026 to here.\n\t* config/t-darwin: Build Darwin10 unwinder shim crt.\n\t* libgcc/config.host: Add the Darwin10 unwinder shim.\n\nFrom-SVN: r263765", "tree": {"sha": "46b0d7e2ac835e54b397263c266ab174ab46aeeb", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/46b0d7e2ac835e54b397263c266ab174ab46aeeb"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/a49c064e407df3d39776241f2c08b14e6affde1e", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/a49c064e407df3d39776241f2c08b14e6affde1e", "html_url": "https://github.com/Rust-GCC/gccrs/commit/a49c064e407df3d39776241f2c08b14e6affde1e", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/a49c064e407df3d39776241f2c08b14e6affde1e/comments", "author": {"login": "iains", "id": 4039407, "node_id": "MDQ6VXNlcjQwMzk0MDc=", "avatar_url": "https://avatars.githubusercontent.com/u/4039407?v=4", "gravatar_id": "", "url": "https://api.github.com/users/iains", "html_url": "https://github.com/iains", "followers_url": "https://api.github.com/users/iains/followers", "following_url": "https://api.github.com/users/iains/following{/other_user}", "gists_url": "https://api.github.com/users/iains/gists{/gist_id}", "starred_url": "https://api.github.com/users/iains/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/iains/subscriptions", "organizations_url": "https://api.github.com/users/iains/orgs", "repos_url": "https://api.github.com/users/iains/repos", "events_url": "https://api.github.com/users/iains/events{/privacy}", "received_events_url": "https://api.github.com/users/iains/received_events", "type": "User", "site_admin": false}, "committer": {"login": "iains", "id": 4039407, "node_id": "MDQ6VXNlcjQwMzk0MDc=", "avatar_url": "https://avatars.githubusercontent.com/u/4039407?v=4", "gravatar_id": "", "url": "https://api.github.com/users/iains", "html_url": "https://github.com/iains", "followers_url": "https://api.github.com/users/iains/followers", "following_url": "https://api.github.com/users/iains/following{/other_user}", "gists_url": "https://api.github.com/users/iains/gists{/gist_id}", "starred_url": "https://api.github.com/users/iains/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/iains/subscriptions", "organizations_url": "https://api.github.com/users/iains/orgs", "repos_url": "https://api.github.com/users/iains/repos", "events_url": "https://api.github.com/users/iains/events{/privacy}", "received_events_url": "https://api.github.com/users/iains/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "36bd86fa510ec16c32d7d7134b5897787a3f54b2", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/36bd86fa510ec16c32d7d7134b5897787a3f54b2", "html_url": "https://github.com/Rust-GCC/gccrs/commit/36bd86fa510ec16c32d7d7134b5897787a3f54b2"}], "stats": {"total": 86, "additions": 57, "deletions": 29}, "files": [{"sha": "0b8adf559a510c26eb9bb6c3bd4794dbe3d2dcb2", "filename": "gcc/ChangeLog", "status": "modified", "additions": 13, "deletions": 4, "changes": 17, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/a49c064e407df3d39776241f2c08b14e6affde1e/gcc%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/a49c064e407df3d39776241f2c08b14e6affde1e/gcc%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2FChangeLog?ref=a49c064e407df3d39776241f2c08b14e6affde1e", "patch": "@@ -1,3 +1,11 @@\n+2018-08-22  Iain Sandoe  <iain@sandoe.co.uk>\n+\n+\t* config/darwin10.h (LINK_GCC_C_SEQUENCE_SPEC): Adjust to use the\n+\tDarwin10-specific unwinder-shim.\n+\t* config/darwin12.h (LINK_GCC_C_SEQUENCE_SPEC): Remove.\n+\t* config/rs6000/darwin.h (DARWIN_CRT1_SPEC, DARWIN_DYLIB1_SPEC): \n+\tNew to cater for Darwin10 Rosetta.\n+\n 2018-08-22  Iain Sandoe  <iain@sandoe.co.uk>\n \n \t* config/i386/i386.c (ix86_output_addr_diff_elt): Move the MACH-O\n@@ -9,10 +17,11 @@\n \tPR target/81733\n \tPR target/52795\n \t* gcc/dwarf2out.c (FUNC_SECOND_SECT_LABEL): New.\n-\t(dwarf2out_switch_text_section): Generate a local label for the second\n-\tfunction sub-section and apply it as the second FDE start label.\n-\t* gcc/final.c (final_scan_insn_1): Emit second FDE label after the second\n-\tsub-section start.\n+\t(dwarf2out_switch_text_section): Generate a local label for the\n+\tsecond function sub-section and apply it as the second FDE start\n+\tlabel.\n+\t* gcc/final.c (final_scan_insn_1): Emit second FDE label after the\n+\tsecond sub-section start.\n \n 2018-08-22  Richard Biener  <rguenther@suse.de>\n "}, {"sha": "df694299adae2c9a592add1b9a119d474c9a9663", "filename": "gcc/config/darwin10.h", "status": "modified", "additions": 6, "deletions": 4, "changes": 10, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/a49c064e407df3d39776241f2c08b14e6affde1e/gcc%2Fconfig%2Fdarwin10.h", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/a49c064e407df3d39776241f2c08b14e6affde1e/gcc%2Fconfig%2Fdarwin10.h", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fconfig%2Fdarwin10.h?ref=a49c064e407df3d39776241f2c08b14e6affde1e", "patch": "@@ -25,10 +25,12 @@ along with GCC; see the file COPYING3.  If not see\n #undef  LINK_GCC_C_SEQUENCE_SPEC\n #define LINK_GCC_C_SEQUENCE_SPEC \\\n \"%:version-compare(>= 10.6 mmacosx-version-min= -no_compact_unwind) \\\n-   %{!static:%{!static-libgcc: \\\n-      %:version-compare(>= 10.6 mmacosx-version-min= -lSystem) } } \\\n-   %{fno-pic|fno-PIC|fno-pie|fno-PIE|fapple-kext|mkernel|static|mdynamic-no-pic: \\\n-      %:version-compare(>= 10.7 mmacosx-version-min= -no_pie) } %G %{!nolibc:%L}\"\n+ %{!static:%{!static-libgcc: \\\n+    %:version-compare(>= 10.6 mmacosx-version-min= -lSystem) } } \\\n+ %{fno-pic|fno-PIC|fno-pie|fno-PIE|fapple-kext|mkernel|static|mdynamic-no-pic: \\\n+   %:version-compare(>= 10.7 mmacosx-version-min= -no_pie) } \\\n+ %{!nostdlib:%:version-compare(>< 10.6 10.7 mmacosx-version-min= -ld10-uwfef.o)} \\\n+  %G %{!nolibc:%L}\"\n \n #undef DEF_MIN_OSX_VERSION\n #define DEF_MIN_OSX_VERSION \"10.6\""}, {"sha": "adc9a78d3767cb9fea289817ae515721a317fb1b", "filename": "gcc/config/darwin12.h", "status": "modified", "additions": 0, "deletions": 8, "changes": 8, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/a49c064e407df3d39776241f2c08b14e6affde1e/gcc%2Fconfig%2Fdarwin12.h", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/a49c064e407df3d39776241f2c08b14e6affde1e/gcc%2Fconfig%2Fdarwin12.h", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fconfig%2Fdarwin12.h?ref=a49c064e407df3d39776241f2c08b14e6affde1e", "patch": "@@ -18,14 +18,6 @@ You should have received a copy of the GNU General Public License\n along with GCC; see the file COPYING3.  If not see\n <http://www.gnu.org/licenses/>.  */\n \n-#undef  LINK_GCC_C_SEQUENCE_SPEC\n-#define LINK_GCC_C_SEQUENCE_SPEC \\\n-\"%:version-compare(>= 10.6 mmacosx-version-min= -no_compact_unwind) \\\n-   %{!static:%{!static-libgcc: \\\n-      %:version-compare(>= 10.6 mmacosx-version-min= -lSystem) } } \\\n-   %{fno-pic|fno-PIC|fno-pie|fno-PIE|fapple-kext|mkernel|static|mdynamic-no-pic: \\\n-      %:version-compare(>= 10.7 mmacosx-version-min= -no_pie) } %G %{!nolibc:%L}\"\n-\n #undef DEF_MIN_OSX_VERSION\n #define DEF_MIN_OSX_VERSION \"10.8\"\n "}, {"sha": "6b0f18e1189cdc042bcfcf19ff1d15a2c13a13c3", "filename": "gcc/config/rs6000/darwin.h", "status": "modified", "additions": 13, "deletions": 0, "changes": 13, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/a49c064e407df3d39776241f2c08b14e6affde1e/gcc%2Fconfig%2Frs6000%2Fdarwin.h", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/a49c064e407df3d39776241f2c08b14e6affde1e/gcc%2Fconfig%2Frs6000%2Fdarwin.h", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fconfig%2Frs6000%2Fdarwin.h?ref=a49c064e407df3d39776241f2c08b14e6affde1e", "patch": "@@ -119,6 +119,13 @@ extern int darwin_emit_branch_islands;\n    mcpu=G5:ppc970;\t\t\t\t\\\n    :ppc}}\"\n \n+/* We need to jam the crt to 10.5 for 10.6 (Rosetta) use.  */\n+#undef DARWIN_CRT1_SPEC\n+#define DARWIN_CRT1_SPEC\t\t\t\t\t\t\\\n+  \"%:version-compare(!> 10.5 mmacosx-version-min= -lcrt1.o)\t\t\\\n+   %:version-compare(>< 10.5 10.7 mmacosx-version-min= -lcrt1.10.5.o)\t\\\n+   %{fgnu-tm: -lcrttms.o}\"\n+\n /* crt2.o is at least partially required for 10.3.x and earlier.  */\n #define DARWIN_CRT2_SPEC \\\n   \"%{!m64:%:version-compare(!> 10.4 mmacosx-version-min= crt2.o%s)}\"\n@@ -130,6 +137,12 @@ extern int darwin_emit_branch_islands;\n   { \"darwin_crt2\", DARWIN_CRT2_SPEC },\t\t\\\n   { \"darwin_subarch\", DARWIN_SUBARCH_SPEC },\n \n+/* We need to jam the dylib crt to 10.5 for 10.6 (Rosetta) use.  */\n+#undef DARWIN_DYLIB1_SPEC\n+#define DARWIN_DYLIB1_SPEC\t\t\t\t\t\t\\\n+  \"%:version-compare(!> 10.5 mmacosx-version-min= -ldylib1.o)\t\t\\\n+   %:version-compare(>< 10.5 10.7 mmacosx-version-min= -ldylib1.10.5.o)\"\n+\n /* Output a .machine directive.  */\n #undef TARGET_ASM_FILE_START\n #define TARGET_ASM_FILE_START rs6000_darwin_file_start"}, {"sha": "d003fd54c6e979c20f30644ef1120fdd878bbf67", "filename": "libgcc/ChangeLog", "status": "modified", "additions": 8, "deletions": 0, "changes": 8, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/a49c064e407df3d39776241f2c08b14e6affde1e/libgcc%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/a49c064e407df3d39776241f2c08b14e6affde1e/libgcc%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libgcc%2FChangeLog?ref=a49c064e407df3d39776241f2c08b14e6affde1e", "patch": "@@ -1,3 +1,11 @@\n+2018-08-22  Iain Sandoe  <iain@sandoe.co.uk>\n+\n+\t* config/unwind-dw2-fde-darwin.c \n+\t(_darwin10_Unwind_FindEnclosingFunction): move from here ...\n+\t* config/darwin10-unwind-find-enc-func.c: \u2026 to here.\n+\t* config/t-darwin: Build Darwin10 unwinder shim crt.\n+\t* libgcc/config.host: Add the Darwin10 unwinder shim.\n+\n 2018-08-21  Rasmus Villemoes  <rv@rasmusvillemoes.dk>\n \n \t* config.host: Add crtbegin.o and crtend.o for"}, {"sha": "67c43757e50bff75622d65e06617c43e59e11db9", "filename": "libgcc/config/darwin10-unwind-find-enc-func.c", "status": "added", "additions": 13, "deletions": 0, "changes": 13, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/a49c064e407df3d39776241f2c08b14e6affde1e/libgcc%2Fconfig%2Fdarwin10-unwind-find-enc-func.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/a49c064e407df3d39776241f2c08b14e6affde1e/libgcc%2Fconfig%2Fdarwin10-unwind-find-enc-func.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libgcc%2Fconfig%2Fdarwin10-unwind-find-enc-func.c?ref=a49c064e407df3d39776241f2c08b14e6affde1e", "patch": "@@ -0,0 +1,13 @@\n+#include \"tconfig.h\"\n+#include \"tsystem.h\"\n+#include \"unwind-dw2-fde.h\"\n+\n+void *\n+_darwin10_Unwind_FindEnclosingFunction (void *pc)\n+{\n+  struct dwarf_eh_bases bases;\n+  const struct dwarf_fde *fde = _Unwind_Find_FDE (pc-1, &bases);\n+  if (fde)\n+    return bases.func;\n+  return NULL;\n+}"}, {"sha": "8340ea2bfe4b894a9a00e5885ef851cbe842fba1", "filename": "libgcc/config/t-darwin", "status": "modified", "additions": 4, "deletions": 0, "changes": 4, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/a49c064e407df3d39776241f2c08b14e6affde1e/libgcc%2Fconfig%2Ft-darwin", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/a49c064e407df3d39776241f2c08b14e6affde1e/libgcc%2Fconfig%2Ft-darwin", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libgcc%2Fconfig%2Ft-darwin?ref=a49c064e407df3d39776241f2c08b14e6affde1e", "patch": "@@ -20,3 +20,7 @@ HOST_LIBGCC2_CFLAGS += -pipe\n # Use unwind-dw2-fde-darwin\n LIB2ADDEH = $(srcdir)/unwind-dw2.c $(srcdir)/config/unwind-dw2-fde-darwin.c \\\n   $(srcdir)/unwind-sjlj.c $(srcdir)/unwind-c.c\n+\n+# Patch to __Unwind_Find_Enclosing_Function for Darwin10.\n+d10-uwfef.o: $(srcdir)/config/darwin10-unwind-find-enc-func.c\n+\t$(crt_compile) $(DARWIN_EXTRA_CRT_BUILD_CFLAGS) -mmacosx-version-min=10.6 -c $<"}, {"sha": "c919de9abebd28ff97aedd98cfe715cb3f7dbd51", "filename": "libgcc/config/unwind-dw2-fde-darwin.c", "status": "modified", "additions": 0, "deletions": 13, "changes": 13, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/a49c064e407df3d39776241f2c08b14e6affde1e/libgcc%2Fconfig%2Funwind-dw2-fde-darwin.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/a49c064e407df3d39776241f2c08b14e6affde1e/libgcc%2Fconfig%2Funwind-dw2-fde-darwin.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libgcc%2Fconfig%2Funwind-dw2-fde-darwin.c?ref=a49c064e407df3d39776241f2c08b14e6affde1e", "patch": "@@ -273,16 +273,3 @@ _Unwind_Find_FDE (void *pc, struct dwarf_eh_bases *bases)\n \t\t\t\t\t  the_obj_info);\n   return ret;\n }\n-\n-void *\n-_darwin10_Unwind_FindEnclosingFunction (void *pc ATTRIBUTE_UNUSED)\n-{\n-#if __MACH__ && (__ENVIRONMENT_MAC_OS_X_VERSION_MIN_REQUIRED__ >= 1060)\n-  struct dwarf_eh_bases bases;\n-  const struct dwarf_fde *fde = _Unwind_Find_FDE (pc-1, &bases);\n-  if (fde)\n-    return bases.func;\n-#endif\n-  return NULL;\n-}\n-"}]}