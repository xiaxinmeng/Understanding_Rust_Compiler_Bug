{"sha": "ee9ef10338020843b9df3c21297bd1c61bbd45b4", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6ZWU5ZWYxMDMzODAyMDg0M2I5ZGYzYzIxMjk3YmQxYzYxYmJkNDViNA==", "commit": {"author": {"name": "Paul Thomas", "email": "pault@gcc.gnu.org", "date": "2008-10-05T05:50:00Z"}, "committer": {"name": "Paul Thomas", "email": "pault@gcc.gnu.org", "date": "2008-10-05T05:50:00Z"}, "message": "re PR fortran/37706 (ICE with use only and equivalent)\n\n2008-10-04  Paul Thomas  <pault@gcc.gnu.org>\n\n\tPR fortran/37706\n\t* module.c (load_equiv): Check the module before negating the\n\tunused flag.\n\n2008-10-04  Paul Thomas  <pault@gcc.gnu.org>\n\n\tPR fortran/37706\n\t* gfortran.dg/module_equivalence_4.f90: New test.\n\nFrom-SVN: r140879", "tree": {"sha": "c7a1d5d6f65455a78af957007fe5a13885133b75", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/c7a1d5d6f65455a78af957007fe5a13885133b75"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/ee9ef10338020843b9df3c21297bd1c61bbd45b4", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/ee9ef10338020843b9df3c21297bd1c61bbd45b4", "html_url": "https://github.com/Rust-GCC/gccrs/commit/ee9ef10338020843b9df3c21297bd1c61bbd45b4", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/ee9ef10338020843b9df3c21297bd1c61bbd45b4/comments", "author": null, "committer": null, "parents": [{"sha": "7f23df4ebbb5d8e0f585501b2a702bd59d7bc16e", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/7f23df4ebbb5d8e0f585501b2a702bd59d7bc16e", "html_url": "https://github.com/Rust-GCC/gccrs/commit/7f23df4ebbb5d8e0f585501b2a702bd59d7bc16e"}], "stats": {"total": 47, "additions": 45, "deletions": 2}, "files": [{"sha": "d462da0f174183e205928e21dab5b53327a3bf40", "filename": "gcc/fortran/ChangeLog", "status": "modified", "additions": 6, "deletions": 0, "changes": 6, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/ee9ef10338020843b9df3c21297bd1c61bbd45b4/gcc%2Ffortran%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/ee9ef10338020843b9df3c21297bd1c61bbd45b4/gcc%2Ffortran%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ffortran%2FChangeLog?ref=ee9ef10338020843b9df3c21297bd1c61bbd45b4", "patch": "@@ -1,3 +1,9 @@\n+2008-10-04  Paul Thomas  <pault@gcc.gnu.org>\n+\n+\tPR fortran/37706\n+\t* module.c (load_equiv): Check the module before negating the\n+\tunused flag.\n+\n 2008-10-02  Steven Bosscher  <steven@gcc.gnu.org>\n \n \tPR fortran/37635"}, {"sha": "3846d953e6b1603ddc406a7b973d69fecff0edbb", "filename": "gcc/fortran/module.c", "status": "modified", "additions": 5, "deletions": 2, "changes": 7, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/ee9ef10338020843b9df3c21297bd1c61bbd45b4/gcc%2Ffortran%2Fmodule.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/ee9ef10338020843b9df3c21297bd1c61bbd45b4/gcc%2Ffortran%2Fmodule.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ffortran%2Fmodule.c?ref=ee9ef10338020843b9df3c21297bd1c61bbd45b4", "patch": "@@ -3806,11 +3806,14 @@ load_equiv (void)\n \tmio_expr (&tail->expr);\n       }\n \n-    /* Unused equivalence members have a unique name.  */\n+    /* Unused equivalence members have a unique name.  In addition, it\n+       must be checked that the symbol is that from the module.  */\n     unused = true;\n     for (eq = head; eq; eq = eq->eq)\n       {\n-\tif (!check_unique_name (eq->expr->symtree->name))\n+\tif (eq->expr->symtree->n.sym->module\n+\t      && strcmp (module_name, eq->expr->symtree->n.sym->module) == 0\n+\t      && !check_unique_name (eq->expr->symtree->name))\n \t  {\n \t    unused = false;\n \t    break;"}, {"sha": "c0b275c11f8b410eeed3b3112780e1a39414b6c2", "filename": "gcc/testsuite/ChangeLog", "status": "modified", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/ee9ef10338020843b9df3c21297bd1c61bbd45b4/gcc%2Ftestsuite%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/ee9ef10338020843b9df3c21297bd1c61bbd45b4/gcc%2Ftestsuite%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2FChangeLog?ref=ee9ef10338020843b9df3c21297bd1c61bbd45b4", "patch": "@@ -1,3 +1,8 @@\n+2008-10-04  Paul Thomas  <pault@gcc.gnu.org>\n+\n+\tPR fortran/37706\n+\t* gfortran.dg/module_equivalence_4.f90: New test.\n+\n 2008-10-04  Richard Guenther  <rguenther@suse.de>\n \n \t* gcc.dg/tree-ssa/ssa-pre-21.c: New testcase."}, {"sha": "7a8ef9c7cdfd4728cceb0a50436d6e73e7499477", "filename": "gcc/testsuite/gfortran.dg/module_equivalence_4.f90", "status": "added", "additions": 29, "deletions": 0, "changes": 29, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/ee9ef10338020843b9df3c21297bd1c61bbd45b4/gcc%2Ftestsuite%2Fgfortran.dg%2Fmodule_equivalence_4.f90", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/ee9ef10338020843b9df3c21297bd1c61bbd45b4/gcc%2Ftestsuite%2Fgfortran.dg%2Fmodule_equivalence_4.f90", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgfortran.dg%2Fmodule_equivalence_4.f90?ref=ee9ef10338020843b9df3c21297bd1c61bbd45b4", "patch": "@@ -0,0 +1,29 @@\n+! { dg-do compile }\n+! This checks the fix for PR37706 in which the equivalence would be\n+! inserted into the 'nudata' namespace with the inevitable consequences.\n+!\n+! Contributed by Lester Petrie <petrielmjr@ornl.gov>\n+!\n+module data_C \n+    integer, dimension(200) :: l  = (/(201-i, i = 1,200)/)\n+    integer :: l0\n+    integer :: l24, l27, l28, l29\n+    equivalence ( l(1), l0 )\n+  end module data_C \n+\n+subroutine nudata(nlibe, a, l) \n+  USE data_C, only:  l24, l27, l28, l29\n+  implicit none\n+  integer  :: nlibe \n+  integer  :: l(*) \n+  real :: a(*)\n+  print *, l(1), l(2)\n+  return  \n+end subroutine nudata\n+      \n+  integer  :: l_(2) = (/1,2/), nlibe_ = 42\n+  real :: a_(2) = (/1.,2./)  \n+  call nudata (nlibe_, a_, l_)\n+end\n+\n+! { dg-final { cleanup-modules \"data_C\" } }"}]}