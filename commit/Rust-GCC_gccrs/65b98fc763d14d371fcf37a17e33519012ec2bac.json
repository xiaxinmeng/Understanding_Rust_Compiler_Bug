{"sha": "65b98fc763d14d371fcf37a17e33519012ec2bac", "node_id": "C_kwDOANBUbNoAKDY1Yjk4ZmM3NjNkMTRkMzcxZmNmMzdhMTdlMzM1MTkwMTJlYzJiYWM", "commit": {"author": {"name": "Jakub Jelinek", "email": "jakub@redhat.com", "date": "2022-10-19T09:29:44Z"}, "committer": {"name": "Jakub Jelinek", "email": "jakub@redhat.com", "date": "2022-10-19T09:29:44Z"}, "message": "expr: Fix ICE on BFmode -> SFmode conversion of constant [PR107262]\n\nI forgot to handle the case where lowpart_subreg returns a VOIDmode\nCONST_INT, in that case convert_mode_scalar obviously doesn't work.\n\nThe following patch fixes that.\n\n2022-10-19  Jakub Jelinek  <jakub@redhat.com>\n\n\tPR middle-end/107262\n\t* expr.cc (convert_mode_scalar): For BFmode -> SFmode conversions\n\tof constants, use simplify_unary_operation if fromi has VOIDmode\n\tinstead of recursive convert_mode_scalar.\n\n\t* gcc.dg/pr107262.c: New test.", "tree": {"sha": "e9961f79899f56a602bb92e27a76505844b96aba", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/e9961f79899f56a602bb92e27a76505844b96aba"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/65b98fc763d14d371fcf37a17e33519012ec2bac", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/65b98fc763d14d371fcf37a17e33519012ec2bac", "html_url": "https://github.com/Rust-GCC/gccrs/commit/65b98fc763d14d371fcf37a17e33519012ec2bac", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/65b98fc763d14d371fcf37a17e33519012ec2bac/comments", "author": {"login": "jakubjelinek", "id": 9370665, "node_id": "MDQ6VXNlcjkzNzA2NjU=", "avatar_url": "https://avatars.githubusercontent.com/u/9370665?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jakubjelinek", "html_url": "https://github.com/jakubjelinek", "followers_url": "https://api.github.com/users/jakubjelinek/followers", "following_url": "https://api.github.com/users/jakubjelinek/following{/other_user}", "gists_url": "https://api.github.com/users/jakubjelinek/gists{/gist_id}", "starred_url": "https://api.github.com/users/jakubjelinek/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jakubjelinek/subscriptions", "organizations_url": "https://api.github.com/users/jakubjelinek/orgs", "repos_url": "https://api.github.com/users/jakubjelinek/repos", "events_url": "https://api.github.com/users/jakubjelinek/events{/privacy}", "received_events_url": "https://api.github.com/users/jakubjelinek/received_events", "type": "User", "site_admin": false}, "committer": {"login": "jakubjelinek", "id": 9370665, "node_id": "MDQ6VXNlcjkzNzA2NjU=", "avatar_url": "https://avatars.githubusercontent.com/u/9370665?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jakubjelinek", "html_url": "https://github.com/jakubjelinek", "followers_url": "https://api.github.com/users/jakubjelinek/followers", "following_url": "https://api.github.com/users/jakubjelinek/following{/other_user}", "gists_url": "https://api.github.com/users/jakubjelinek/gists{/gist_id}", "starred_url": "https://api.github.com/users/jakubjelinek/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jakubjelinek/subscriptions", "organizations_url": "https://api.github.com/users/jakubjelinek/orgs", "repos_url": "https://api.github.com/users/jakubjelinek/repos", "events_url": "https://api.github.com/users/jakubjelinek/events{/privacy}", "received_events_url": "https://api.github.com/users/jakubjelinek/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "07cc4c1da1046f0ffda241d59df796417c122ff5", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/07cc4c1da1046f0ffda241d59df796417c122ff5", "html_url": "https://github.com/Rust-GCC/gccrs/commit/07cc4c1da1046f0ffda241d59df796417c122ff5"}], "stats": {"total": 24, "additions": 22, "deletions": 2}, "files": [{"sha": "efe387e617371d2cac87582615e4c9e25ca74a28", "filename": "gcc/expr.cc", "status": "modified", "additions": 9, "deletions": 2, "changes": 11, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/65b98fc763d14d371fcf37a17e33519012ec2bac/gcc%2Fexpr.cc", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/65b98fc763d14d371fcf37a17e33519012ec2bac/gcc%2Fexpr.cc", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fexpr.cc?ref=65b98fc763d14d371fcf37a17e33519012ec2bac", "patch": "@@ -416,8 +416,15 @@ convert_mode_scalar (rtx to, rtx from, int unsignedp)\n \t\t  rtx tof = NULL_RTX;\n \t\t  if (fromi)\n \t\t    {\n-\t\t      rtx toi = gen_reg_rtx (toi_mode);\n-\t\t      convert_mode_scalar (toi, fromi, 1);\n+\t\t      rtx toi;\n+\t\t      if (GET_MODE (fromi) == VOIDmode)\n+\t\t\ttoi = simplify_unary_operation (ZERO_EXTEND, toi_mode,\n+\t\t\t\t\t\t\tfromi, fromi_mode);\n+\t\t      else\n+\t\t\t{\n+\t\t\t  toi = gen_reg_rtx (toi_mode);\n+\t\t\t  convert_mode_scalar (toi, fromi, 1);\n+\t\t\t}\n \t\t      toi\n \t\t\t= maybe_expand_shift (LSHIFT_EXPR, toi_mode, toi,\n \t\t\t\t\t      GET_MODE_PRECISION (to_mode)"}, {"sha": "2ced0474645fb968eb90516aa7da412c139e58e8", "filename": "gcc/testsuite/gcc.dg/pr107262.c", "status": "added", "additions": 13, "deletions": 0, "changes": 13, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/65b98fc763d14d371fcf37a17e33519012ec2bac/gcc%2Ftestsuite%2Fgcc.dg%2Fpr107262.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/65b98fc763d14d371fcf37a17e33519012ec2bac/gcc%2Ftestsuite%2Fgcc.dg%2Fpr107262.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgcc.dg%2Fpr107262.c?ref=65b98fc763d14d371fcf37a17e33519012ec2bac", "patch": "@@ -0,0 +1,13 @@\n+/* PR middle-end/107262 */\n+/* { dg-do compile } */\n+/* { dg-options \"-O2 -ffast-math\" } */\n+/* { dg-add-options bfloat16 } */\n+/* { dg-require-effective-target bfloat16_runtime } */\n+\n+__bf16\n+foo (__bf16 a)\n+{\n+  __bf16 b = 0;\n+  b /= a;\n+  return b;\n+}"}]}