{"sha": "c420be8b3c5fd9e9d80dd583e790f0c2a7c4954b", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6YzQyMGJlOGIzYzVmZDllOWQ4MGRkNTgzZTc5MGYwYzJhN2M0OTU0Yg==", "commit": {"author": {"name": "Roman Zhuykov", "email": "zhroma@ispras.ru", "date": "2019-12-13T17:17:31Z"}, "committer": {"name": "Roman Zhuykov", "email": "zhroma@gcc.gnu.org", "date": "2019-12-13T17:17:31Z"}, "message": "modulo-sched: fix parameters usage and their ranges\n\n\t* modulo-sched.c (sms_schedule): Use param_sms_max_ii_factor\n\tvalue instead of macro.  Adjust comment.\n\t(sms_schedule_by_order): Use parameter value without macro.\n\t* params.opt: Add ranges for modulo scheduler parameters,\n\tset param_sms_max_ii_factor = 2 by default.\n\nFrom-SVN: r279376", "tree": {"sha": "7eef17af9c7fdbe98af1f44ebe576eb45d3b3c61", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/7eef17af9c7fdbe98af1f44ebe576eb45d3b3c61"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/c420be8b3c5fd9e9d80dd583e790f0c2a7c4954b", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/c420be8b3c5fd9e9d80dd583e790f0c2a7c4954b", "html_url": "https://github.com/Rust-GCC/gccrs/commit/c420be8b3c5fd9e9d80dd583e790f0c2a7c4954b", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/c420be8b3c5fd9e9d80dd583e790f0c2a7c4954b/comments", "author": {"login": "zhroma", "id": 23097573, "node_id": "MDQ6VXNlcjIzMDk3NTcz", "avatar_url": "https://avatars.githubusercontent.com/u/23097573?v=4", "gravatar_id": "", "url": "https://api.github.com/users/zhroma", "html_url": "https://github.com/zhroma", "followers_url": "https://api.github.com/users/zhroma/followers", "following_url": "https://api.github.com/users/zhroma/following{/other_user}", "gists_url": "https://api.github.com/users/zhroma/gists{/gist_id}", "starred_url": "https://api.github.com/users/zhroma/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/zhroma/subscriptions", "organizations_url": "https://api.github.com/users/zhroma/orgs", "repos_url": "https://api.github.com/users/zhroma/repos", "events_url": "https://api.github.com/users/zhroma/events{/privacy}", "received_events_url": "https://api.github.com/users/zhroma/received_events", "type": "User", "site_admin": false}, "committer": null, "parents": [{"sha": "728c2e5eeaa91cf708f2b1b1f996653a7eebae59", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/728c2e5eeaa91cf708f2b1b1f996653a7eebae59", "html_url": "https://github.com/Rust-GCC/gccrs/commit/728c2e5eeaa91cf708f2b1b1f996653a7eebae59"}], "stats": {"total": 33, "additions": 19, "deletions": 14}, "files": [{"sha": "56d05cc498615249c955568eed8b99341b21a0db", "filename": "gcc/ChangeLog", "status": "modified", "additions": 8, "deletions": 0, "changes": 8, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/c420be8b3c5fd9e9d80dd583e790f0c2a7c4954b/gcc%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/c420be8b3c5fd9e9d80dd583e790f0c2a7c4954b/gcc%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2FChangeLog?ref=c420be8b3c5fd9e9d80dd583e790f0c2a7c4954b", "patch": "@@ -1,3 +1,11 @@\n+2019-12-13  Roman Zhuykov  <zhroma@ispras.ru>\n+\n+\t* modulo-sched.c (sms_schedule): Use param_sms_max_ii_factor\n+\tvalue instead of macro.  Adjust comment.\n+\t(sms_schedule_by_order): Use parameter value without macro.\n+\t* params.opt: Add ranges for modulo scheduler parameters,\n+\tset param_sms_max_ii_factor = 2 by default.\n+\n 2019-12-13  Roman Zhuykov  <zhroma@ispras.ru>\n \n \t* ddg.c (create_ddg): Init max_dist array for each node."}, {"sha": "2dc9af70930f40154adafaf59a2d5dc8d4313409", "filename": "gcc/modulo-sched.c", "status": "modified", "additions": 8, "deletions": 11, "changes": 19, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/c420be8b3c5fd9e9d80dd583e790f0c2a7c4954b/gcc%2Fmodulo-sched.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/c420be8b3c5fd9e9d80dd583e790f0c2a7c4954b/gcc%2Fmodulo-sched.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fmodulo-sched.c?ref=c420be8b3c5fd9e9d80dd583e790f0c2a7c4954b", "patch": "@@ -1331,9 +1331,6 @@ setup_sched_infos (void)\n    version may be entered.  Just a guess.  */\n #define PROB_SMS_ENOUGH_ITERATIONS 80\n \n-/* Used to calculate the upper bound of ii.  */\n-#define MAXII_FACTOR 2\n-\n /* Main entry point, perform SMS scheduling on the loops of the function\n    that consist of single basic blocks.  */\n static void\n@@ -1597,7 +1594,7 @@ sms_schedule (void)\n       rec_mii = sms_order_nodes (g, mii, node_order, &max_asap);\n       mii = MAX (res_MII (g), rec_mii);\n       mii = MAX (mii, 1);\n-      maxii = MAX (max_asap, MAXII_FACTOR * mii);\n+      maxii = MAX (max_asap, param_sms_max_ii_factor * mii);\n \n       if (dump_file)\n \tfprintf (dump_file, \"SMS iis %d %d %d (rec_mii, mii, maxii)\\n\",\n@@ -1636,7 +1633,7 @@ sms_schedule (void)\n \t      gcc_assert (stage_count >= 1);\n \t    }\n \n-\t  /* The default value of PARAM_SMS_MIN_SC is 2 as stage count of\n+\t  /* The default value of param_sms_min_sc is 2 as stage count of\n \t     1 means that there is no interleaving between iterations thus\n \t     we let the scheduling passes do the job in this case.  */\n \t  if (stage_count < param_sms_min_sc\n@@ -1828,11 +1825,6 @@ sms_schedule (void)\n    The window would then start and end on the same row, but with\n    different \"must precede\" and \"must follow\" requirements.  */\n \n-/* A limit on the number of cycles that resource conflicts can span.  ??? Should\n-   be provided by DFA, and be dependent on the type of insn scheduled.  Currently\n-   set to 0 to save compile time.  */\n-#define DFA_HISTORY param_sms_dfa_history\n-\n /* A threshold for the number of repeated unsuccessful attempts to insert\n    an empty row, before we flush the partial schedule and start over.  */\n #define MAX_SPLIT_NUM 10\n@@ -2136,7 +2128,12 @@ sms_schedule_by_order (ddg_ptr g, int mii, int maxii, int *nodes_order)\n   auto_sbitmap must_follow (num_nodes);\n   auto_sbitmap tobe_scheduled (num_nodes);\n \n-  partial_schedule_ptr ps = create_partial_schedule (ii, g, DFA_HISTORY);\n+  /* Value of param_sms_dfa_history is a limit on the number of cycles that\n+     resource conflicts can span.  ??? Should be provided by DFA, and be\n+     dependent on the type of insn scheduled.  Set to 0 by default to save\n+     compile time.  */\n+  partial_schedule_ptr ps = create_partial_schedule (ii, g,\n+\t\t\t\t\t\t     param_sms_dfa_history);\n \n   bitmap_ones (tobe_scheduled);\n   bitmap_clear (sched_nodes);"}, {"sha": "06d8b0e040054e4361bef61d0a40ca419cb1f9d2", "filename": "gcc/params.opt", "status": "modified", "additions": 3, "deletions": 3, "changes": 6, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/c420be8b3c5fd9e9d80dd583e790f0c2a7c4954b/gcc%2Fparams.opt", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/c420be8b3c5fd9e9d80dd583e790f0c2a7c4954b/gcc%2Fparams.opt", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fparams.opt?ref=c420be8b3c5fd9e9d80dd583e790f0c2a7c4954b", "patch": "@@ -817,19 +817,19 @@ Common Joined UInteger Var(param_slp_max_insns_in_bb) Init(1000) Param\n Maximum number of instructions in basic block to be considered for SLP vectorization.\n \n -param=sms-dfa-history=\n-Common Joined UInteger Var(param_sms_dfa_history) Param\n+Common Joined UInteger Var(param_sms_dfa_history) IntegerRange(0, 16) Param\n The number of cycles the swing modulo scheduler considers when checking conflicts using DFA.\n \n -param=sms-loop-average-count-threshold=\n Common Joined UInteger Var(param_sms_loop_average_count_threshold) Param\n A threshold on the average loop count considered by the swing modulo scheduler.\n \n -param=sms-max-ii-factor=\n-Common Joined UInteger Var(param_sms_max_ii_factor) Init(100) Param\n+Common Joined UInteger Var(param_sms_max_ii_factor) Init(2) IntegerRange(1, 16) Param\n A factor for tuning the upper bound that swing modulo scheduler uses for scheduling a loop.\n \n -param=sms-min-sc=\n-Common Joined UInteger Var(param_sms_min_sc) Init(2) IntegerRange(1, 65536) Param\n+Common Joined UInteger Var(param_sms_min_sc) Init(2) IntegerRange(1, 2) Param\n The minimum value of stage count that swing modulo scheduler will generate.\n \n -param=sra-max-scalarization-size-Osize="}]}