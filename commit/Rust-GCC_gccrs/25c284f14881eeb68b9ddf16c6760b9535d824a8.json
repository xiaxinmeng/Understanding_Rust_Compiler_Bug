{"sha": "25c284f14881eeb68b9ddf16c6760b9535d824a8", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6MjVjMjg0ZjE0ODgxZWViNjhiOWRkZjE2YzY3NjBiOTUzNWQ4MjRhOA==", "commit": {"author": {"name": "Martin Liska", "email": "mliska@suse.cz", "date": "2020-05-19T19:16:27Z"}, "committer": {"name": "Martin Liska", "email": "mliska@suse.cz", "date": "2020-05-19T19:17:09Z"}, "message": "Use REST API for bug titles in mklog.\n\n\t* mklog.py: Use REST API for bug title downloading.", "tree": {"sha": "74cf4812dec2210ae6d03d8dbfbf80514bfb4e1a", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/74cf4812dec2210ae6d03d8dbfbf80514bfb4e1a"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/25c284f14881eeb68b9ddf16c6760b9535d824a8", "comment_count": 0, "verification": {"verified": false, "reason": "unknown_key", "signature": "-----BEGIN PGP SIGNATURE-----\n\niQEzBAABCAAdFiEE6I4wzqqylQBfXaRhTcGC3A+nN4UFAl7EMLUACgkQTcGC3A+n\nN4Vpjwf/WEZosDAel8SR7ueXiq3cD9YOpUkEU8w8MaWJYMXBPdchR5V+nLtKlxSi\no3scJicLi8aOyOtxHlJ3HzyzO7a08gkOeStleKwvwTd5yhzbXlrljTXzJhnFvyFN\npi0VOgMTBUqI2CUsAD67ddB0frIBm0Bnx6odbIlca74KvKDlCTeBMKhpcVAP2aUF\nClIOoprZYLYgOHnaN9D0QlcCMID/jWpT89nFpXseXyMrx06VoYeqebvZTIEZOdF8\n7WmMek7fzQ4q/E5IcqCVbHQQnO8Btj7k+RBskCVZ773uk92uiUWRzWQn4+LeewML\n0jiyvKvxK444YD+t3oXRX1cDvntMlw==\n=2bfq\n-----END PGP SIGNATURE-----", "payload": "tree 74cf4812dec2210ae6d03d8dbfbf80514bfb4e1a\nparent 4a5d072ad97d7d4fd003efff953a6202afd176a0\nauthor Martin Liska <mliska@suse.cz> 1589915787 +0200\ncommitter Martin Liska <mliska@suse.cz> 1589915829 +0200\n\nUse REST API for bug titles in mklog.\n\n\t* mklog.py: Use REST API for bug title downloading.\n"}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/25c284f14881eeb68b9ddf16c6760b9535d824a8", "html_url": "https://github.com/Rust-GCC/gccrs/commit/25c284f14881eeb68b9ddf16c6760b9535d824a8", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/25c284f14881eeb68b9ddf16c6760b9535d824a8/comments", "author": {"login": "marxin", "id": 2658545, "node_id": "MDQ6VXNlcjI2NTg1NDU=", "avatar_url": "https://avatars.githubusercontent.com/u/2658545?v=4", "gravatar_id": "", "url": "https://api.github.com/users/marxin", "html_url": "https://github.com/marxin", "followers_url": "https://api.github.com/users/marxin/followers", "following_url": "https://api.github.com/users/marxin/following{/other_user}", "gists_url": "https://api.github.com/users/marxin/gists{/gist_id}", "starred_url": "https://api.github.com/users/marxin/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/marxin/subscriptions", "organizations_url": "https://api.github.com/users/marxin/orgs", "repos_url": "https://api.github.com/users/marxin/repos", "events_url": "https://api.github.com/users/marxin/events{/privacy}", "received_events_url": "https://api.github.com/users/marxin/received_events", "type": "User", "site_admin": false}, "committer": {"login": "marxin", "id": 2658545, "node_id": "MDQ6VXNlcjI2NTg1NDU=", "avatar_url": "https://avatars.githubusercontent.com/u/2658545?v=4", "gravatar_id": "", "url": "https://api.github.com/users/marxin", "html_url": "https://github.com/marxin", "followers_url": "https://api.github.com/users/marxin/followers", "following_url": "https://api.github.com/users/marxin/following{/other_user}", "gists_url": "https://api.github.com/users/marxin/gists{/gist_id}", "starred_url": "https://api.github.com/users/marxin/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/marxin/subscriptions", "organizations_url": "https://api.github.com/users/marxin/orgs", "repos_url": "https://api.github.com/users/marxin/repos", "events_url": "https://api.github.com/users/marxin/events{/privacy}", "received_events_url": "https://api.github.com/users/marxin/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "4a5d072ad97d7d4fd003efff953a6202afd176a0", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/4a5d072ad97d7d4fd003efff953a6202afd176a0", "html_url": "https://github.com/Rust-GCC/gccrs/commit/4a5d072ad97d7d4fd003efff953a6202afd176a0"}], "stats": {"total": 24, "additions": 13, "deletions": 11}, "files": [{"sha": "d9632fb30dc2a75b4c310eca72fa4acd401e48a8", "filename": "contrib/ChangeLog", "status": "modified", "additions": 4, "deletions": 0, "changes": 4, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/25c284f14881eeb68b9ddf16c6760b9535d824a8/contrib%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/25c284f14881eeb68b9ddf16c6760b9535d824a8/contrib%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/contrib%2FChangeLog?ref=25c284f14881eeb68b9ddf16c6760b9535d824a8", "patch": "@@ -1,3 +1,7 @@\n+2020-05-19  Martin Liska  <mliska@suse.cz>\n+\n+\t* mklog.py: Use REST API for bug title downloading.\n+\n 2020-05-19  Martin Liska  <mliska@suse.cz>\n \n \t* gcc-changelog/git_commit.py: Add param use_commit_ts"}, {"sha": "b27fad0ca2e05eb4ec507f8337c928e2d2772ec7", "filename": "contrib/mklog.py", "status": "modified", "additions": 9, "deletions": 11, "changes": 20, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/25c284f14881eeb68b9ddf16c6760b9535d824a8/contrib%2Fmklog.py", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/25c284f14881eeb68b9ddf16c6760b9535d824a8/contrib%2Fmklog.py", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/contrib%2Fmklog.py?ref=25c284f14881eeb68b9ddf16c6760b9535d824a8", "patch": "@@ -31,8 +31,6 @@\n import re\n import sys\n \n-import bs4\n-\n import requests\n \n from unidiff import PatchSet\n@@ -46,6 +44,8 @@\n super_macro_regex = re.compile(r'^DEF[A-Z0-9_]+\\s*\\(([a-zA-Z0-9_]+)')\n fn_regex = re.compile(r'([a-zA-Z_][^()\\s]*)\\s*\\([^*]')\n template_and_param_regex = re.compile(r'<[^<>]*>')\n+bugzilla_url = 'https://gcc.gnu.org/bugzilla/rest.cgi/bug?id=%s&' \\\n+               'include_fields=summary'\n \n function_extensions = set(['.c', '.cpp', '.C', '.cc', '.h', '.inc', '.def'])\n \n@@ -106,18 +106,16 @@ def sort_changelog_files(changed_file):\n \n \n def get_pr_titles(prs):\n-    if not prs:\n-        return ''\n-\n     output = ''\n     for pr in prs:\n         id = pr.split('/')[-1]\n-        r = requests.get('https://gcc.gnu.org/PR%s' % id)\n-        html = bs4.BeautifulSoup(r.text, features='lxml')\n-        title = html.title.text\n-        title = title[title.find('\u2013') + 1:].strip()\n-        output += '%s - %s\\n' % (pr, title)\n-    output += '\\n'\n+        r = requests.get(bugzilla_url % id)\n+        bugs = r.json()['bugs']\n+        if len(bugs) == 1:\n+            output += '%s - %s\\n' % (pr, bugs[0]['summary'])\n+            print(output)\n+    if output:\n+        output += '\\n'\n     return output\n \n "}]}