{"sha": "47deb1ef874c078ac51bc1970a3324f5c8002815", "node_id": "C_kwDOANBUbNoAKDQ3ZGViMWVmODc0YzA3OGFjNTFiYzE5NzBhMzMyNGY1YzgwMDI4MTU", "commit": {"author": {"name": "Jonathan Wakely", "email": "jwakely@redhat.com", "date": "2022-09-16T16:50:21Z"}, "committer": {"name": "Jonathan Wakely", "email": "jwakely@redhat.com", "date": "2022-09-16T20:19:09Z"}, "message": "libstdc++: Fix compare_exchange_padding.cc test for std::atomic_ref\n\nThis test was written assuming that std::atomic_ref clears its target's\npadding on construction, but that could introduce data races. Change the\ntest to store a value after construction and check that its padding is\ncleared by the store.\n\nlibstdc++-v3/ChangeLog:\n\n\t* testsuite/29_atomics/atomic_ref/compare_exchange_padding.cc:\n\tStore value with non-zero padding bits after construction.", "tree": {"sha": "482f8d9f56a6fcfcc882b49b02336609e387670d", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/482f8d9f56a6fcfcc882b49b02336609e387670d"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/47deb1ef874c078ac51bc1970a3324f5c8002815", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/47deb1ef874c078ac51bc1970a3324f5c8002815", "html_url": "https://github.com/Rust-GCC/gccrs/commit/47deb1ef874c078ac51bc1970a3324f5c8002815", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/47deb1ef874c078ac51bc1970a3324f5c8002815/comments", "author": {"login": "jwakely", "id": 1254480, "node_id": "MDQ6VXNlcjEyNTQ0ODA=", "avatar_url": "https://avatars.githubusercontent.com/u/1254480?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jwakely", "html_url": "https://github.com/jwakely", "followers_url": "https://api.github.com/users/jwakely/followers", "following_url": "https://api.github.com/users/jwakely/following{/other_user}", "gists_url": "https://api.github.com/users/jwakely/gists{/gist_id}", "starred_url": "https://api.github.com/users/jwakely/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jwakely/subscriptions", "organizations_url": "https://api.github.com/users/jwakely/orgs", "repos_url": "https://api.github.com/users/jwakely/repos", "events_url": "https://api.github.com/users/jwakely/events{/privacy}", "received_events_url": "https://api.github.com/users/jwakely/received_events", "type": "User", "site_admin": false}, "committer": {"login": "jwakely", "id": 1254480, "node_id": "MDQ6VXNlcjEyNTQ0ODA=", "avatar_url": "https://avatars.githubusercontent.com/u/1254480?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jwakely", "html_url": "https://github.com/jwakely", "followers_url": "https://api.github.com/users/jwakely/followers", "following_url": "https://api.github.com/users/jwakely/following{/other_user}", "gists_url": "https://api.github.com/users/jwakely/gists{/gist_id}", "starred_url": "https://api.github.com/users/jwakely/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jwakely/subscriptions", "organizations_url": "https://api.github.com/users/jwakely/orgs", "repos_url": "https://api.github.com/users/jwakely/repos", "events_url": "https://api.github.com/users/jwakely/events{/privacy}", "received_events_url": "https://api.github.com/users/jwakely/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "7107ea6fb933f1e928593c7e92edfd64ccf0df63", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/7107ea6fb933f1e928593c7e92edfd64ccf0df63", "html_url": "https://github.com/Rust-GCC/gccrs/commit/7107ea6fb933f1e928593c7e92edfd64ccf0df63"}], "stats": {"total": 11, "additions": 6, "deletions": 5}, "files": [{"sha": "e9f8a4bdf2ac66d54f8540fccd2efa6c4719e717", "filename": "libstdc++-v3/testsuite/29_atomics/atomic_ref/compare_exchange_padding.cc", "status": "modified", "additions": 6, "deletions": 5, "changes": 11, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/47deb1ef874c078ac51bc1970a3324f5c8002815/libstdc%2B%2B-v3%2Ftestsuite%2F29_atomics%2Fatomic_ref%2Fcompare_exchange_padding.cc", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/47deb1ef874c078ac51bc1970a3324f5c8002815/libstdc%2B%2B-v3%2Ftestsuite%2F29_atomics%2Fatomic_ref%2Fcompare_exchange_padding.cc", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libstdc%2B%2B-v3%2Ftestsuite%2F29_atomics%2Fatomic_ref%2Fcompare_exchange_padding.cc?ref=47deb1ef874c078ac51bc1970a3324f5c8002815", "patch": "@@ -20,14 +20,15 @@ int\n main ()\n {\n   S s;\n-  fill_struct(s);\n-  s.c = 'a';\n-  s.s = 42;\n-\n   S ss{ s };\n+  fill_struct(ss);\n+  ss.c = 'a';\n+  ss.s = 42;\n+\n   std::atomic_ref<S> as{ s };\n+  as.store(ss);\n   auto ts = as.load();\n-  VERIFY( !compare_struct(ss, ts) ); // padding cleared on construction\n+  VERIFY( !compare_struct(ss, ts) ); // padding cleared on store\n   as.exchange(ss);\n   auto es = as.load();\n   VERIFY( compare_struct(ts, es) ); // padding cleared on exchange"}]}