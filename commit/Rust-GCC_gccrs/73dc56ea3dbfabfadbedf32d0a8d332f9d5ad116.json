{"sha": "73dc56ea3dbfabfadbedf32d0a8d332f9d5ad116", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6NzNkYzU2ZWEzZGJmYWJmYWRiZWRmMzJkMGE4ZDMzMmY5ZDVhZDExNg==", "commit": {"author": {"name": "Ed Schonberg", "email": "schonberg@adacore.com", "date": "2018-06-11T09:16:43Z"}, "committer": {"name": "Pierre-Marie de Rodat", "email": "pmderodat@gcc.gnu.org", "date": "2018-06-11T09:16:43Z"}, "message": "[Ada] Crash on instantiation of nested generic in private part\n\nThis patch fixes a compiler abort on an instantiation of a generic nested\nwithin another instance, when the outer instance is declared in the visible\npart of a package and the inner intance is in the private part of the same\npackage.\n\n2018-06-11  Ed Schonberg  <schonberg@adacore.com>\n\ngcc/ada/\n\n\t* sem_ch12.adb (Install_Body): In order to determine the placement of\n\tthe freeze node for an instance of a generic nested within another\n\tinstance, take into account that the outer instance may be declared in\n\tthe visible part of a package and the inner intance may be in the\n\tprivate part of the same package.\n\ngcc/testsuite/\n\n\t* gnat.dg/nested_generic2.adb, gnat.dg/nested_generic2.ads,\n\tgnat.dg/nested_generic2_g1.adb, gnat.dg/nested_generic2_g1.ads,\n\tgnat.dg/nested_generic2_g2.ads: New testcase.\n\nFrom-SVN: r261398", "tree": {"sha": "94ad40094e5f727f935673d28ac3c58196b9b9ba", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/94ad40094e5f727f935673d28ac3c58196b9b9ba"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/73dc56ea3dbfabfadbedf32d0a8d332f9d5ad116", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/73dc56ea3dbfabfadbedf32d0a8d332f9d5ad116", "html_url": "https://github.com/Rust-GCC/gccrs/commit/73dc56ea3dbfabfadbedf32d0a8d332f9d5ad116", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/73dc56ea3dbfabfadbedf32d0a8d332f9d5ad116/comments", "author": {"login": "Edschonberg", "id": 6352375, "node_id": "MDQ6VXNlcjYzNTIzNzU=", "avatar_url": "https://avatars.githubusercontent.com/u/6352375?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Edschonberg", "html_url": "https://github.com/Edschonberg", "followers_url": "https://api.github.com/users/Edschonberg/followers", "following_url": "https://api.github.com/users/Edschonberg/following{/other_user}", "gists_url": "https://api.github.com/users/Edschonberg/gists{/gist_id}", "starred_url": "https://api.github.com/users/Edschonberg/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Edschonberg/subscriptions", "organizations_url": "https://api.github.com/users/Edschonberg/orgs", "repos_url": "https://api.github.com/users/Edschonberg/repos", "events_url": "https://api.github.com/users/Edschonberg/events{/privacy}", "received_events_url": "https://api.github.com/users/Edschonberg/received_events", "type": "User", "site_admin": false}, "committer": null, "parents": [{"sha": "4847a76bd2fedb7966b77e595cf27296275c43ba", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/4847a76bd2fedb7966b77e595cf27296275c43ba", "html_url": "https://github.com/Rust-GCC/gccrs/commit/4847a76bd2fedb7966b77e595cf27296275c43ba"}], "stats": {"total": 75, "additions": 73, "deletions": 2}, "files": [{"sha": "a2620cfabb2afccbf0dacc3d638ff89c709f5ac6", "filename": "gcc/ada/ChangeLog", "status": "modified", "additions": 8, "deletions": 0, "changes": 8, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/73dc56ea3dbfabfadbedf32d0a8d332f9d5ad116/gcc%2Fada%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/73dc56ea3dbfabfadbedf32d0a8d332f9d5ad116/gcc%2Fada%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fada%2FChangeLog?ref=73dc56ea3dbfabfadbedf32d0a8d332f9d5ad116", "patch": "@@ -1,3 +1,11 @@\n+2018-06-11  Ed Schonberg  <schonberg@adacore.com>\n+\n+\t* sem_ch12.adb (Install_Body): In order to determine the placement of\n+\tthe freeze node for an instance of a generic nested within another\n+\tinstance, take into account that the outer instance may be declared in\n+\tthe visible part of a package and the inner intance may be in the\n+\tprivate part of the same package.\n+\n 2018-06-11  Eric Botcazou  <ebotcazou@adacore.com>\n \n \t* errout.adb (Special_Msg_Delete): Remove handling of Atomic and VFA."}, {"sha": "5cc30154abc329f0bd699281fcedd0b3bc5a0e69", "filename": "gcc/ada/sem_ch12.adb", "status": "modified", "additions": 6, "deletions": 2, "changes": 8, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/73dc56ea3dbfabfadbedf32d0a8d332f9d5ad116/gcc%2Fada%2Fsem_ch12.adb", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/73dc56ea3dbfabfadbedf32d0a8d332f9d5ad116/gcc%2Fada%2Fsem_ch12.adb", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fada%2Fsem_ch12.adb?ref=73dc56ea3dbfabfadbedf32d0a8d332f9d5ad116", "patch": "@@ -9527,9 +9527,13 @@ package body Sem_Ch12 is\n                --  the freeze node for Inst must be inserted after that of\n                --  Parent_Inst. This relation is established by comparing\n                --  the Slocs of Parent_Inst freeze node and Inst.\n+               --  We examine the parents of the enclosing lists to handle\n+               --  the case where the parent instance is in the visible part\n+               --  of a package declaration, and the inner instance is in\n+               --  the corresponding private part.\n \n-               if List_Containing (Get_Unit_Instantiation_Node (Par)) =\n-                  List_Containing (N)\n+               if Parent (List_Containing (Get_Unit_Instantiation_Node (Par)))\n+                  = Parent (List_Containing (N))\n                  and then Sloc (Freeze_Node (Par)) < Sloc (N)\n                then\n                   Insert_Freeze_Node_For_Instance (N, F_Node);"}, {"sha": "579cc617c4d89ca2c2d516b969bc7c982a14e4c0", "filename": "gcc/testsuite/ChangeLog", "status": "modified", "additions": 6, "deletions": 0, "changes": 6, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/73dc56ea3dbfabfadbedf32d0a8d332f9d5ad116/gcc%2Ftestsuite%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/73dc56ea3dbfabfadbedf32d0a8d332f9d5ad116/gcc%2Ftestsuite%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2FChangeLog?ref=73dc56ea3dbfabfadbedf32d0a8d332f9d5ad116", "patch": "@@ -1,3 +1,9 @@\n+2018-06-11  Ed Schonberg  <schonberg@adacore.com>\n+\n+\t* gnat.dg/nested_generic2.adb, gnat.dg/nested_generic2.ads,\n+\tgnat.dg/nested_generic2_g1.adb, gnat.dg/nested_generic2_g1.ads,\n+\tgnat.dg/nested_generic2_g2.ads: New testcase.\n+\n 2018-06-10  Paolo Carlini  <paolo.carlini@oracle.com>\n \n \t* g++.dg/template/friend64.C: New."}, {"sha": "b454254deb408ea88c15d527adcd0b0a2ccc66b2", "filename": "gcc/testsuite/gnat.dg/nested_generic2.adb", "status": "added", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/73dc56ea3dbfabfadbedf32d0a8d332f9d5ad116/gcc%2Ftestsuite%2Fgnat.dg%2Fnested_generic2.adb", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/73dc56ea3dbfabfadbedf32d0a8d332f9d5ad116/gcc%2Ftestsuite%2Fgnat.dg%2Fnested_generic2.adb", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgnat.dg%2Fnested_generic2.adb?ref=73dc56ea3dbfabfadbedf32d0a8d332f9d5ad116", "patch": "@@ -0,0 +1,5 @@\n+--  { dg-do compile }\n+\n+package body Nested_Generic2 is\n+   procedure Dummy is null;\n+end Nested_Generic2;"}, {"sha": "6cf2a416ad828b0073d02d1ca4ffb0142a549515", "filename": "gcc/testsuite/gnat.dg/nested_generic2.ads", "status": "added", "additions": 13, "deletions": 0, "changes": 13, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/73dc56ea3dbfabfadbedf32d0a8d332f9d5ad116/gcc%2Ftestsuite%2Fgnat.dg%2Fnested_generic2.ads", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/73dc56ea3dbfabfadbedf32d0a8d332f9d5ad116/gcc%2Ftestsuite%2Fgnat.dg%2Fnested_generic2.ads", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgnat.dg%2Fnested_generic2.ads?ref=73dc56ea3dbfabfadbedf32d0a8d332f9d5ad116", "patch": "@@ -0,0 +1,13 @@\n+with Nested_Generic2_G1;\n+with Nested_Generic2_G2;\n+\n+package Nested_Generic2 is\n+\n+   package My_G1 is new Nested_Generic2_G1 (\"Lewis\");\n+   package My_G2 is new Nested_Generic2_G2 (T => Integer, P => My_G1);\n+\n+   procedure Dummy;\n+\n+private\n+   package My_Nested is new My_G1.Nested (\"Clark\");\n+end Nested_Generic2;"}, {"sha": "446b4954f5fd13389ce19fcc9ea1046f672de5aa", "filename": "gcc/testsuite/gnat.dg/nested_generic2_g1.adb", "status": "added", "additions": 15, "deletions": 0, "changes": 15, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/73dc56ea3dbfabfadbedf32d0a8d332f9d5ad116/gcc%2Ftestsuite%2Fgnat.dg%2Fnested_generic2_g1.adb", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/73dc56ea3dbfabfadbedf32d0a8d332f9d5ad116/gcc%2Ftestsuite%2Fgnat.dg%2Fnested_generic2_g1.adb", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgnat.dg%2Fnested_generic2_g1.adb?ref=73dc56ea3dbfabfadbedf32d0a8d332f9d5ad116", "patch": "@@ -0,0 +1,15 @@\n+package body Nested_Generic2_G1 is\n+\n+   procedure Debug (Msg : String; Prefix : String) is\n+   begin\n+      null;\n+   end;\n+\n+   package body Nested is\n+      procedure Debug (Msg : String) is\n+      begin\n+         Debug (Msg, Prefix);\n+      end;\n+   end Nested;\n+\n+end Nested_Generic2_G1;"}, {"sha": "a7a48d6a2c21ad80f3e0baf6d0c887530e996d42", "filename": "gcc/testsuite/gnat.dg/nested_generic2_g1.ads", "status": "added", "additions": 13, "deletions": 0, "changes": 13, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/73dc56ea3dbfabfadbedf32d0a8d332f9d5ad116/gcc%2Ftestsuite%2Fgnat.dg%2Fnested_generic2_g1.ads", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/73dc56ea3dbfabfadbedf32d0a8d332f9d5ad116/gcc%2Ftestsuite%2Fgnat.dg%2Fnested_generic2_g1.ads", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgnat.dg%2Fnested_generic2_g1.ads?ref=73dc56ea3dbfabfadbedf32d0a8d332f9d5ad116", "patch": "@@ -0,0 +1,13 @@\n+generic\n+   S : String;\n+package Nested_Generic2_G1 is\n+\n+   procedure Debug (Msg : String; Prefix : String);\n+\n+   generic\n+      Prefix : String;\n+   package Nested is\n+      procedure Debug (Msg : String);\n+   end Nested;\n+\n+end Nested_Generic2_G1;"}, {"sha": "2b021676cfe80780281607fe3f9effbfe433d357", "filename": "gcc/testsuite/gnat.dg/nested_generic2_g2.ads", "status": "added", "additions": 7, "deletions": 0, "changes": 7, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/73dc56ea3dbfabfadbedf32d0a8d332f9d5ad116/gcc%2Ftestsuite%2Fgnat.dg%2Fnested_generic2_g2.ads", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/73dc56ea3dbfabfadbedf32d0a8d332f9d5ad116/gcc%2Ftestsuite%2Fgnat.dg%2Fnested_generic2_g2.ads", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgnat.dg%2Fnested_generic2_g2.ads?ref=73dc56ea3dbfabfadbedf32d0a8d332f9d5ad116", "patch": "@@ -0,0 +1,7 @@\n+with Nested_Generic2_G1;\n+\n+generic\n+  type T is private;\n+  with package P is new Nested_Generic2_G1 (<>);\n+package Nested_Generic2_G2 is\n+end Nested_Generic2_G2;"}]}