{"sha": "bcd93c00abf72a5e820a32db5d9dd97603b407ea", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6YmNkOTNjMDBhYmY3MmE1ZTgyMGEzMmRiNWQ5ZGQ5NzYwM2I0MDdlYQ==", "commit": {"author": {"name": "Fran\u00e7ois Dumont", "email": "francois.cppdevs@free.fr", "date": "2010-11-26T20:29:01Z"}, "committer": {"name": "Fran\u00e7ois Dumont", "email": "fdumont@gcc.gnu.org", "date": "2010-11-26T20:29:01Z"}, "message": "libstdc++.exp [...]: Use remote_file delete for generated exe.\n\n2010-11-26  Fran\u00e7ois Dumont  <francois.cppdevs@free.fr>\n\n        * testsuite/lib/libstdc++.exp [check_v3_target_debug_mode]: Use\n        remote_file delete for generated exe. [check_v3_target_profile_mode]\n        Add.\n        * testsuite/lib/dg-options.exp [dg-require-profile-mode]: Add\n        * testsuite/ext/profile/mh.cc, profiler_algos.cc, all.cc: Use\n        dg-require-profile-mode, remove explicit _GLIBCXX_PROFILE definition.\n\nFrom-SVN: r167188", "tree": {"sha": "c2c18e2d66792407c4ffaf4014b81dc35d76f798", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/c2c18e2d66792407c4ffaf4014b81dc35d76f798"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/bcd93c00abf72a5e820a32db5d9dd97603b407ea", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/bcd93c00abf72a5e820a32db5d9dd97603b407ea", "html_url": "https://github.com/Rust-GCC/gccrs/commit/bcd93c00abf72a5e820a32db5d9dd97603b407ea", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/bcd93c00abf72a5e820a32db5d9dd97603b407ea/comments", "author": null, "committer": null, "parents": [{"sha": "556618c1b3931eeee3f9da0c1c4217b4f67d470a", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/556618c1b3931eeee3f9da0c1c4217b4f67d470a", "html_url": "https://github.com/Rust-GCC/gccrs/commit/556618c1b3931eeee3f9da0c1c4217b4f67d470a"}], "stats": {"total": 79, "additions": 74, "deletions": 5}, "files": [{"sha": "e61b7885b2651a9cec93962a3343bf5a23ae2791", "filename": "libstdc++-v3/ChangeLog", "status": "modified", "additions": 9, "deletions": 0, "changes": 9, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/bcd93c00abf72a5e820a32db5d9dd97603b407ea/libstdc%2B%2B-v3%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/bcd93c00abf72a5e820a32db5d9dd97603b407ea/libstdc%2B%2B-v3%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libstdc%2B%2B-v3%2FChangeLog?ref=bcd93c00abf72a5e820a32db5d9dd97603b407ea", "patch": "@@ -1,3 +1,12 @@\n+2010-11-26  Fran\u00e7ois Dumont  <francois.cppdevs@free.fr>\n+\n+\t* testsuite/lib/libstdc++.exp [check_v3_target_debug_mode]: Use\n+\tremote_file delete for generated exe. [check_v3_target_profile_mode]\n+\tAdd.\n+\t* testsuite/lib/dg-options.exp [dg-require-profile-mode]: Add\n+\t* testsuite/ext/profile/mh.cc, profiler_algos.cc, all.cc: Use\n+\tdg-require-profile-mode, remove explicit _GLIBCXX_PROFILE definition.\n+\n 2010-11-25  Fran\u00e7ois Dumont  <francois.cppdevs@free.fr>\n \n \t* src/debug.cc: Introduce a mutex pool in get_safe_base_mutex."}, {"sha": "152901e01bb0421a37c7541cb4b9e02895498264", "filename": "libstdc++-v3/testsuite/ext/profile/all.cc", "status": "modified", "additions": 3, "deletions": 2, "changes": 5, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/bcd93c00abf72a5e820a32db5d9dd97603b407ea/libstdc%2B%2B-v3%2Ftestsuite%2Fext%2Fprofile%2Fall.cc", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/bcd93c00abf72a5e820a32db5d9dd97603b407ea/libstdc%2B%2B-v3%2Ftestsuite%2Fext%2Fprofile%2Fall.cc", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libstdc%2B%2B-v3%2Ftestsuite%2Fext%2Fprofile%2Fall.cc?ref=bcd93c00abf72a5e820a32db5d9dd97603b407ea", "patch": "@@ -1,5 +1,6 @@\n-// { dg-options \"-std=gnu++0x -O0 -D_GLIBCXX_PROFILE\" }\n-// { dg-options \"-std=gnu++0x -O0 -D_GLIBCXX_PROFILE -D_GLIBCXX_PROFILE_NO_THREADS\" { target { ! tls_native } } }\n+// { dg-require-profile-mode \"\" }\n+// { dg-options \"-std=gnu++0x -O0\" }\n+// { dg-options \"-std=gnu++0x -O0 -D_GLIBCXX_PROFILE_NO_THREADS\" { target { ! tls_native } } }\n // { dg-do compile }\n \n // -*- C++ -*-"}, {"sha": "0de83edea85a75fb2ffac17f475f19690aa9e2df", "filename": "libstdc++-v3/testsuite/ext/profile/mh.cc", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/bcd93c00abf72a5e820a32db5d9dd97603b407ea/libstdc%2B%2B-v3%2Ftestsuite%2Fext%2Fprofile%2Fmh.cc", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/bcd93c00abf72a5e820a32db5d9dd97603b407ea/libstdc%2B%2B-v3%2Ftestsuite%2Fext%2Fprofile%2Fmh.cc", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libstdc%2B%2B-v3%2Ftestsuite%2Fext%2Fprofile%2Fmh.cc?ref=bcd93c00abf72a5e820a32db5d9dd97603b407ea", "patch": "@@ -1,4 +1,4 @@\n-// { dg-options \"-D_GLIBCXX_PROFILE\" }\n+// { dg-require-profile-mode \"\" }\n // { dg-do compile { target *-*-linux* } }\n // { dg-xfail-if \"\" { uclibc } { \"*\" } { \"\" } }\n "}, {"sha": "37dfbfee27c7a960ed6b0c549ba600939aba93d8", "filename": "libstdc++-v3/testsuite/ext/profile/profiler_algos.cc", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/bcd93c00abf72a5e820a32db5d9dd97603b407ea/libstdc%2B%2B-v3%2Ftestsuite%2Fext%2Fprofile%2Fprofiler_algos.cc", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/bcd93c00abf72a5e820a32db5d9dd97603b407ea/libstdc%2B%2B-v3%2Ftestsuite%2Fext%2Fprofile%2Fprofiler_algos.cc", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libstdc%2B%2B-v3%2Ftestsuite%2Fext%2Fprofile%2Fprofiler_algos.cc?ref=bcd93c00abf72a5e820a32db5d9dd97603b407ea", "patch": "@@ -1,4 +1,4 @@\n-// { dg-options \"-D_GLIBCXX_PROFILE\" }\n+// { dg-require-profile-mode \"\" }\n \n // -*- C++ -*-\n "}, {"sha": "b75f516c41fcb44aa126cdd58164f294c8507c8e", "filename": "libstdc++-v3/testsuite/lib/dg-options.exp", "status": "modified", "additions": 9, "deletions": 0, "changes": 9, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/bcd93c00abf72a5e820a32db5d9dd97603b407ea/libstdc%2B%2B-v3%2Ftestsuite%2Flib%2Fdg-options.exp", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/bcd93c00abf72a5e820a32db5d9dd97603b407ea/libstdc%2B%2B-v3%2Ftestsuite%2Flib%2Fdg-options.exp", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libstdc%2B%2B-v3%2Ftestsuite%2Flib%2Fdg-options.exp?ref=bcd93c00abf72a5e820a32db5d9dd97603b407ea", "patch": "@@ -35,6 +35,15 @@ proc dg-require-debug-mode { args } {\n     return\n }\n \n+proc dg-require-profile-mode { args } {\n+    if { ![ check_v3_target_profile_mode ] } {\n+\tupvar dg-do-what dg-do-what\n+\tset dg-do-what [list [lindex ${dg-do-what} 0] \"N\" \"P\"]\n+\treturn\n+    }\n+    return\n+}\n+\n proc dg-require-normal-mode { args } {\n     if { ![ check_v3_target_normal_mode ] } {\n \tupvar dg-do-what dg-do-what"}, {"sha": "d94abfd8b6013e2c48e761ced7f5e0c9701e9c07", "filename": "libstdc++-v3/testsuite/lib/libstdc++.exp", "status": "modified", "additions": 51, "deletions": 1, "changes": 52, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/bcd93c00abf72a5e820a32db5d9dd97603b407ea/libstdc%2B%2B-v3%2Ftestsuite%2Flib%2Flibstdc%2B%2B.exp", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/bcd93c00abf72a5e820a32db5d9dd97603b407ea/libstdc%2B%2B-v3%2Ftestsuite%2Flib%2Flibstdc%2B%2B.exp", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libstdc%2B%2B-v3%2Ftestsuite%2Flib%2Flibstdc%2B%2B.exp?ref=bcd93c00abf72a5e820a32db5d9dd97603b407ea", "patch": "@@ -935,14 +935,64 @@ proc check_v3_target_debug_mode { } {\n \n \tif [string match \"\" $lines] {\n \t    # No error message, compilation succeeded.\n-\t    file delete $exe\n+\t    remote_file build delete $exe\n \t    set et_debug_mode 1\n \t}\n     }\n     verbose \"check_v3_target_debug_mode: $et_debug_mode\" 2\n     return $et_debug_mode\n }\n \n+proc check_v3_target_profile_mode { } {\n+    global et_profile_mode\n+    global tool\t\n+\n+    if { ![info exists et_profile_mode_target_name] } {\n+\tset et_profile_mode_target_name \"\"\n+    }\n+\n+    # If the target has changed since we set the cached value, clear it.\n+    set current_target [current_target_name]\n+    if { $current_target != $et_profile_mode_target_name } {\n+\tverbose \"check_v3_target_profile_mode: `$et_profile_mode_target_name'\" 2\n+\tset et_profile_mode_target_name $current_target\n+\tif [info exists et_profile_mode] {\n+\t    verbose \"check_v3_target_profile_mode: removing cached result\" 2\n+\t    unset et_profile_mode\n+\t}\n+    }\n+\n+    if [info exists et_profile_mode] {\n+\tverbose \"check_v3_target_profile_mode: using cached result\" 2\n+    } else {\n+\tset et_profile_mode 0\n+\n+\t# Set up and compile a C++ test program that depends\n+\t# on profile mode activated.\n+\tset src profile_mode[pid].cc\n+\tset exe profile_mode[pid].exe\n+\n+\tset f [open $src \"w\"]\n+\tputs $f \"#ifndef _GLIBCXX_PROFILE\"\n+\tputs $f \"#  error No profile mode\"\n+\tputs $f \"#endif\"\n+\tputs $f \"int main()\"\n+\tputs $f \"{ return 0; }\"\n+\tclose $f\n+\n+\tset lines [v3_target_compile $src $exe executable \"\"]\n+\tfile delete $src\n+\n+\tif [string match \"\" $lines] {\n+\t    # No error message, compilation succeeded.\n+\t    remote_file build delete $exe\n+\t    set et_profile_mode 1\n+\t}\n+    }\n+    verbose \"check_v3_target_profile_mode: $et_profile_mode\" 2\n+    return $et_profile_mode\n+}\n+\n proc check_v3_target_normal_mode { } {\n     global et_normal_mode\n     global tool\t"}]}