{"sha": "902692c1cbdb5c0ce7ea865fa5677aaeb78802f4", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6OTAyNjkyYzFjYmRiNWMwY2U3ZWE4NjVmYTU2NzdhYWViNzg4MDJmNA==", "commit": {"author": {"name": "Christophe Lyon", "email": "christophe.lyon@linaro.org", "date": "2021-05-10T12:52:11Z"}, "committer": {"name": "Christophe Lyon", "email": "christophe.lyon@linaro.org", "date": "2021-05-10T12:56:17Z"}, "message": "arm: MVE: Factorize vcmp_*f*\n\nLike in the previous, we factorize the vcmp_*f* patterns to make\nmaintenance easier.\n\n2021-05-10  Christophe Lyon  <christophe.lyon@linaro.org>\n\n\tgcc/\n\t* config/arm/iterators.md (MVE_FP_COMPARISONS): New.\n\t* config/arm/mve.md (mve_vcmp<mve_cmp_op>q_f<mode>)\n\t(mve_vcmp<mve_cmp_op>q_n_f<mode>): New, merge all vcmp_*f*\n\tpatterns.\n\t(mve_vcmpeqq_f<mode>, mve_vcmpeqq_n_f<mode>, mve_vcmpgeq_f<mode>)\n\t(mve_vcmpgeq_n_f<mode>, mve_vcmpgtq_f<mode>)\n\t(mve_vcmpgtq_n_f<mode>, mve_vcmpleq_f<mode>)\n\t(mve_vcmpleq_n_f<mode>, mve_vcmpltq_f<mode>)\n\t(mve_vcmpltq_n_f<mode>, mve_vcmpneq_f<mode>)\n\t(mve_vcmpneq_n_f<mode>): Remove.\n\t* config/arm/unspecs.md (VCMPEQQ_F, VCMPEQQ_N_F, VCMPGEQ_F)\n\t(VCMPGEQ_N_F, VCMPGTQ_F, VCMPGTQ_N_F, VCMPLEQ_F, VCMPLEQ_N_F)\n\t(VCMPLTQ_F, VCMPLTQ_N_F, VCMPNEQ_F, VCMPNEQ_N_F): Remove.", "tree": {"sha": "aa3bcc8b80dcb45ef117d3535065806b144d2e48", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/aa3bcc8b80dcb45ef117d3535065806b144d2e48"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/902692c1cbdb5c0ce7ea865fa5677aaeb78802f4", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/902692c1cbdb5c0ce7ea865fa5677aaeb78802f4", "html_url": "https://github.com/Rust-GCC/gccrs/commit/902692c1cbdb5c0ce7ea865fa5677aaeb78802f4", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/902692c1cbdb5c0ce7ea865fa5677aaeb78802f4/comments", "author": null, "committer": null, "parents": [{"sha": "d083fbf72d4533d2009c725524983e1184981e74", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/d083fbf72d4533d2009c725524983e1184981e74", "html_url": "https://github.com/Rust-GCC/gccrs/commit/d083fbf72d4533d2009c725524983e1184981e74"}], "stats": {"total": 185, "additions": 11, "deletions": 174}, "files": [{"sha": "95df8bdf77d1deefa6f181f87cae475bc3c841bf", "filename": "gcc/config/arm/iterators.md", "status": "modified", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/902692c1cbdb5c0ce7ea865fa5677aaeb78802f4/gcc%2Fconfig%2Farm%2Fiterators.md", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/902692c1cbdb5c0ce7ea865fa5677aaeb78802f4/gcc%2Fconfig%2Farm%2Fiterators.md", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fconfig%2Farm%2Fiterators.md?ref=902692c1cbdb5c0ce7ea865fa5677aaeb78802f4", "patch": "@@ -287,6 +287,7 @@\n (define_code_iterator COMPARISONS [eq gt ge le lt])\n ;; Comparisons for MVE\n (define_code_iterator MVE_COMPARISONS [eq ge geu gt gtu le lt ne])\n+(define_code_iterator MVE_FP_COMPARISONS [eq ge gt le lt ne])\n \n ;; A list of ...\n (define_code_iterator IOR_XOR [ior xor])"}, {"sha": "45df2110ae9b8cbc858605940723a369afd0f622", "filename": "gcc/config/arm/mve.md", "status": "modified", "additions": 10, "deletions": 162, "changes": 172, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/902692c1cbdb5c0ce7ea865fa5677aaeb78802f4/gcc%2Fconfig%2Farm%2Fmve.md", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/902692c1cbdb5c0ce7ea865fa5677aaeb78802f4/gcc%2Fconfig%2Farm%2Fmve.md", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fconfig%2Farm%2Fmve.md?ref=902692c1cbdb5c0ce7ea865fa5677aaeb78802f4", "patch": "@@ -1901,182 +1901,30 @@\n ])\n \n ;;\n-;; [vcmpeqq_f])\n+;; [vcmpeqq_f, vcmpgeq_f, vcmpgtq_f, vcmpleq_f, vcmpltq_f, vcmpneq_f])\n ;;\n-(define_insn \"mve_vcmpeqq_f<mode>\"\n+(define_insn \"mve_vcmp<mve_cmp_op>q_f<mode>\"\n   [\n    (set (match_operand:HI 0 \"vpr_register_operand\" \"=Up\")\n-\t(unspec:HI [(match_operand:MVE_0 1 \"s_register_operand\" \"w\")\n-\t\t    (match_operand:MVE_0 2 \"s_register_operand\" \"w\")]\n-\t VCMPEQQ_F))\n-  ]\n-  \"TARGET_HAVE_MVE && TARGET_HAVE_MVE_FLOAT\"\n-  \"vcmp.f%#<V_sz_elem>\teq, %q1, %q2\"\n-  [(set_attr \"type\" \"mve_move\")\n-])\n-\n-;;\n-;; [vcmpeqq_n_f])\n-;;\n-(define_insn \"mve_vcmpeqq_n_f<mode>\"\n-  [\n-   (set (match_operand:HI 0 \"vpr_register_operand\" \"=Up\")\n-\t(unspec:HI [(match_operand:MVE_0 1 \"s_register_operand\" \"w\")\n-\t\t    (match_operand:<V_elem> 2 \"s_register_operand\" \"r\")]\n-\t VCMPEQQ_N_F))\n-  ]\n-  \"TARGET_HAVE_MVE && TARGET_HAVE_MVE_FLOAT\"\n-  \"vcmp.f%#<V_sz_elem>\teq, %q1, %2\"\n-  [(set_attr \"type\" \"mve_move\")\n-])\n-\n-;;\n-;; [vcmpgeq_f])\n-;;\n-(define_insn \"mve_vcmpgeq_f<mode>\"\n-  [\n-   (set (match_operand:HI 0 \"vpr_register_operand\" \"=Up\")\n-\t(unspec:HI [(match_operand:MVE_0 1 \"s_register_operand\" \"w\")\n-\t\t    (match_operand:MVE_0 2 \"s_register_operand\" \"w\")]\n-\t VCMPGEQ_F))\n-  ]\n-  \"TARGET_HAVE_MVE && TARGET_HAVE_MVE_FLOAT\"\n-  \"vcmp.f%#<V_sz_elem>\tge, %q1, %q2\"\n-  [(set_attr \"type\" \"mve_move\")\n-])\n-\n-;;\n-;; [vcmpgeq_n_f])\n-;;\n-(define_insn \"mve_vcmpgeq_n_f<mode>\"\n-  [\n-   (set (match_operand:HI 0 \"vpr_register_operand\" \"=Up\")\n-\t(unspec:HI [(match_operand:MVE_0 1 \"s_register_operand\" \"w\")\n-\t\t    (match_operand:<V_elem> 2 \"s_register_operand\" \"r\")]\n-\t VCMPGEQ_N_F))\n-  ]\n-  \"TARGET_HAVE_MVE && TARGET_HAVE_MVE_FLOAT\"\n-  \"vcmp.f%#<V_sz_elem>\tge, %q1, %2\"\n-  [(set_attr \"type\" \"mve_move\")\n-])\n-\n-;;\n-;; [vcmpgtq_f])\n-;;\n-(define_insn \"mve_vcmpgtq_f<mode>\"\n-  [\n-   (set (match_operand:HI 0 \"vpr_register_operand\" \"=Up\")\n-\t(unspec:HI [(match_operand:MVE_0 1 \"s_register_operand\" \"w\")\n-\t\t    (match_operand:MVE_0 2 \"s_register_operand\" \"w\")]\n-\t VCMPGTQ_F))\n-  ]\n-  \"TARGET_HAVE_MVE && TARGET_HAVE_MVE_FLOAT\"\n-  \"vcmp.f%#<V_sz_elem>\tgt, %q1, %q2\"\n-  [(set_attr \"type\" \"mve_move\")\n-])\n-\n-;;\n-;; [vcmpgtq_n_f])\n-;;\n-(define_insn \"mve_vcmpgtq_n_f<mode>\"\n-  [\n-   (set (match_operand:HI 0 \"vpr_register_operand\" \"=Up\")\n-\t(unspec:HI [(match_operand:MVE_0 1 \"s_register_operand\" \"w\")\n-\t\t    (match_operand:<V_elem> 2 \"s_register_operand\" \"r\")]\n-\t VCMPGTQ_N_F))\n+\t(MVE_FP_COMPARISONS:HI (match_operand:MVE_0 1 \"s_register_operand\" \"w\")\n+\t\t\t       (match_operand:MVE_0 2 \"s_register_operand\" \"w\")))\n   ]\n   \"TARGET_HAVE_MVE && TARGET_HAVE_MVE_FLOAT\"\n-  \"vcmp.f%#<V_sz_elem>\tgt, %q1, %2\"\n+  \"vcmp.f%#<V_sz_elem>\t<mve_cmp_op>, %q1, %q2\"\n   [(set_attr \"type\" \"mve_move\")\n ])\n \n ;;\n-;; [vcmpleq_f])\n+;; [vcmpeqq_n_f, vcmpgeq_n_f, vcmpgtq_n_f, vcmpleq_n_f, vcmpltq_n_f, vcmpneq_n_f])\n ;;\n-(define_insn \"mve_vcmpleq_f<mode>\"\n+(define_insn \"mve_vcmp<mve_cmp_op>q_n_f<mode>\"\n   [\n    (set (match_operand:HI 0 \"vpr_register_operand\" \"=Up\")\n-\t(unspec:HI [(match_operand:MVE_0 1 \"s_register_operand\" \"w\")\n-\t\t    (match_operand:MVE_0 2 \"s_register_operand\" \"w\")]\n-\t VCMPLEQ_F))\n-  ]\n-  \"TARGET_HAVE_MVE && TARGET_HAVE_MVE_FLOAT\"\n-  \"vcmp.f%#<V_sz_elem>\tle, %q1, %q2\"\n-  [(set_attr \"type\" \"mve_move\")\n-])\n-\n-;;\n-;; [vcmpleq_n_f])\n-;;\n-(define_insn \"mve_vcmpleq_n_f<mode>\"\n-  [\n-   (set (match_operand:HI 0 \"vpr_register_operand\" \"=Up\")\n-\t(unspec:HI [(match_operand:MVE_0 1 \"s_register_operand\" \"w\")\n-\t\t    (match_operand:<V_elem> 2 \"s_register_operand\" \"r\")]\n-\t VCMPLEQ_N_F))\n-  ]\n-  \"TARGET_HAVE_MVE && TARGET_HAVE_MVE_FLOAT\"\n-  \"vcmp.f%#<V_sz_elem>\tle, %q1, %2\"\n-  [(set_attr \"type\" \"mve_move\")\n-])\n-\n-;;\n-;; [vcmpltq_f])\n-;;\n-(define_insn \"mve_vcmpltq_f<mode>\"\n-  [\n-   (set (match_operand:HI 0 \"vpr_register_operand\" \"=Up\")\n-\t(unspec:HI [(match_operand:MVE_0 1 \"s_register_operand\" \"w\")\n-\t\t    (match_operand:MVE_0 2 \"s_register_operand\" \"w\")]\n-\t VCMPLTQ_F))\n-  ]\n-  \"TARGET_HAVE_MVE && TARGET_HAVE_MVE_FLOAT\"\n-  \"vcmp.f%#<V_sz_elem>\tlt, %q1, %q2\"\n-  [(set_attr \"type\" \"mve_move\")\n-])\n-\n-;;\n-;; [vcmpltq_n_f])\n-;;\n-(define_insn \"mve_vcmpltq_n_f<mode>\"\n-  [\n-   (set (match_operand:HI 0 \"vpr_register_operand\" \"=Up\")\n-\t(unspec:HI [(match_operand:MVE_0 1 \"s_register_operand\" \"w\")\n-\t\t    (match_operand:<V_elem> 2 \"s_register_operand\" \"r\")]\n-\t VCMPLTQ_N_F))\n-  ]\n-  \"TARGET_HAVE_MVE && TARGET_HAVE_MVE_FLOAT\"\n-  \"vcmp.f%#<V_sz_elem>\tlt, %q1, %2\"\n-  [(set_attr \"type\" \"mve_move\")\n-])\n-\n-;;\n-;; [vcmpneq_f])\n-;;\n-(define_insn \"mve_vcmpneq_f<mode>\"\n-  [\n-   (set (match_operand:HI 0 \"vpr_register_operand\" \"=Up\")\n-\t(unspec:HI [(match_operand:MVE_0 1 \"s_register_operand\" \"w\")\n-\t\t    (match_operand:MVE_0 2 \"s_register_operand\" \"w\")]\n-\t VCMPNEQ_F))\n-  ]\n-  \"TARGET_HAVE_MVE && TARGET_HAVE_MVE_FLOAT\"\n-  \"vcmp.f%#<V_sz_elem>\tne, %q1, %q2\"\n-  [(set_attr \"type\" \"mve_move\")\n-])\n-\n-;;\n-;; [vcmpneq_n_f])\n-;;\n-(define_insn \"mve_vcmpneq_n_f<mode>\"\n-  [\n-   (set (match_operand:HI 0 \"vpr_register_operand\" \"=Up\")\n-\t(unspec:HI [(match_operand:MVE_0 1 \"s_register_operand\" \"w\")\n-\t\t    (match_operand:<V_elem> 2 \"s_register_operand\" \"r\")]\n-\t VCMPNEQ_N_F))\n+\t(MVE_FP_COMPARISONS:HI (match_operand:MVE_0 1 \"s_register_operand\" \"w\")\n+\t\t\t       (match_operand:<V_elem> 2 \"s_register_operand\" \"r\")))\n   ]\n   \"TARGET_HAVE_MVE && TARGET_HAVE_MVE_FLOAT\"\n-  \"vcmp.f%#<V_sz_elem>\tne, %q1, %2\"\n+  \"vcmp.f%#<V_sz_elem>\t<mve_cmp_op>, %q1, %2\"\n   [(set_attr \"type\" \"mve_move\")\n ])\n "}, {"sha": "07ca53b8b0bf54807dadf81b610c8bb59e00bf35", "filename": "gcc/config/arm/unspecs.md", "status": "modified", "additions": 0, "deletions": 12, "changes": 12, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/902692c1cbdb5c0ce7ea865fa5677aaeb78802f4/gcc%2Fconfig%2Farm%2Funspecs.md", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/902692c1cbdb5c0ce7ea865fa5677aaeb78802f4/gcc%2Fconfig%2Farm%2Funspecs.md", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fconfig%2Farm%2Funspecs.md?ref=902692c1cbdb5c0ce7ea865fa5677aaeb78802f4", "patch": "@@ -710,18 +710,6 @@\n   VABDQ_M_U\n   VABDQ_F\n   VADDQ_N_F\n-  VCMPEQQ_F\n-  VCMPEQQ_N_F\n-  VCMPGEQ_F\n-  VCMPGEQ_N_F\n-  VCMPGTQ_F\n-  VCMPGTQ_N_F\n-  VCMPLEQ_F\n-  VCMPLEQ_N_F\n-  VCMPLTQ_F\n-  VCMPLTQ_N_F\n-  VCMPNEQ_F\n-  VCMPNEQ_N_F\n   VMAXNMAQ_F\n   VMAXNMAVQ_F\n   VMAXNMQ_F"}]}