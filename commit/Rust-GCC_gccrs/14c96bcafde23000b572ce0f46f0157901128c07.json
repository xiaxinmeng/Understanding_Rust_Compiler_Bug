{"sha": "14c96bcafde23000b572ce0f46f0157901128c07", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6MTRjOTZiY2FmZGUyMzAwMGI1NzJjZTBmNDZmMDE1NzkwMTEyOGMwNw==", "commit": {"author": {"name": "Tobias Burnus", "email": "burnus@net-b.de", "date": "2013-04-12T17:55:48Z"}, "committer": {"name": "Tobias Burnus", "email": "burnus@gcc.gnu.org", "date": "2013-04-12T17:55:48Z"}, "message": "re PR fortran/56929 ([OOP] [F08] ICE on dummy argument child class with coarray inside parent)\n\n2013-04-12  Tobias Burnus  <burnus@net-b.de>\n\n        PR fortran/56929\n        * trans-array.c (duplicate_allocatable): Fix handling\n        of scalar coarrays.\n\n2013-04-12  Tobias Burnus  <burnus@net-b.de>\n\n        PR fortran/56929\n        * gfortran.dg/coarray/alloc_comp_2.f90: New.\n\nFrom-SVN: r197930", "tree": {"sha": "bb36dcfe9306bd493c170e1b146e9a35c0a7283e", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/bb36dcfe9306bd493c170e1b146e9a35c0a7283e"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/14c96bcafde23000b572ce0f46f0157901128c07", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/14c96bcafde23000b572ce0f46f0157901128c07", "html_url": "https://github.com/Rust-GCC/gccrs/commit/14c96bcafde23000b572ce0f46f0157901128c07", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/14c96bcafde23000b572ce0f46f0157901128c07/comments", "author": {"login": "tob2", "id": 264461, "node_id": "MDQ6VXNlcjI2NDQ2MQ==", "avatar_url": "https://avatars.githubusercontent.com/u/264461?v=4", "gravatar_id": "", "url": "https://api.github.com/users/tob2", "html_url": "https://github.com/tob2", "followers_url": "https://api.github.com/users/tob2/followers", "following_url": "https://api.github.com/users/tob2/following{/other_user}", "gists_url": "https://api.github.com/users/tob2/gists{/gist_id}", "starred_url": "https://api.github.com/users/tob2/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/tob2/subscriptions", "organizations_url": "https://api.github.com/users/tob2/orgs", "repos_url": "https://api.github.com/users/tob2/repos", "events_url": "https://api.github.com/users/tob2/events{/privacy}", "received_events_url": "https://api.github.com/users/tob2/received_events", "type": "User", "site_admin": false}, "committer": null, "parents": [{"sha": "226e378f4d94cf604547dd4d1c1de624beab5fb0", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/226e378f4d94cf604547dd4d1c1de624beab5fb0", "html_url": "https://github.com/Rust-GCC/gccrs/commit/226e378f4d94cf604547dd4d1c1de624beab5fb0"}], "stats": {"total": 40, "additions": 37, "deletions": 3}, "files": [{"sha": "c2b8a5d70bec4448e375f8179a55b71e08de4511", "filename": "gcc/fortran/ChangeLog", "status": "modified", "additions": 6, "deletions": 0, "changes": 6, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/14c96bcafde23000b572ce0f46f0157901128c07/gcc%2Ffortran%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/14c96bcafde23000b572ce0f46f0157901128c07/gcc%2Ffortran%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ffortran%2FChangeLog?ref=14c96bcafde23000b572ce0f46f0157901128c07", "patch": "@@ -1,3 +1,9 @@\n+2013-04-12  Tobias Burnus  <burnus@net-b.de>\n+\n+\tPR fortran/56929\n+\t* trans-array.c (duplicate_allocatable): Fix handling\n+\tof scalar coarrays.\n+\n 2013-04-12  Janus Weil  <janus@gcc.gnu.org>\n \n \tPR fortran/56261"}, {"sha": "6cb85d483119d09ec0484799322610efb6cd80a1", "filename": "gcc/fortran/trans-array.c", "status": "modified", "additions": 7, "deletions": 3, "changes": 10, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/14c96bcafde23000b572ce0f46f0157901128c07/gcc%2Ffortran%2Ftrans-array.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/14c96bcafde23000b572ce0f46f0157901128c07/gcc%2Ffortran%2Ftrans-array.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ffortran%2Ftrans-array.c?ref=14c96bcafde23000b572ce0f46f0157901128c07", "patch": "@@ -7321,7 +7321,7 @@ duplicate_allocatable (tree dest, tree src, tree type, int rank,\n      allocate memory to the destination.  */\n   gfc_init_block (&block);\n \n-  if (rank == 0)\n+  if (!GFC_DESCRIPTOR_TYPE_P (TREE_TYPE (dest)))\n     {\n       tmp = null_pointer_node;\n       tmp = fold_build2_loc (input_location, MODIFY_EXPR, type, dest, tmp);\n@@ -7348,7 +7348,11 @@ duplicate_allocatable (tree dest, tree src, tree type, int rank,\n       null_data = gfc_finish_block (&block);\n \n       gfc_init_block (&block);\n-      nelems = get_full_array_size (&block, src, rank);\n+      if (rank)\n+\tnelems = get_full_array_size (&block, src, rank);\n+      else\n+\tnelems = gfc_index_one_node;\n+\n       tmp = fold_convert (gfc_array_index_type,\n \t\t\t  TYPE_SIZE_UNIT (gfc_get_element_type (type)));\n       size = fold_build2_loc (input_location, MULT_EXPR, gfc_array_index_type,\n@@ -7374,7 +7378,7 @@ duplicate_allocatable (tree dest, tree src, tree type, int rank,\n \n   /* Null the destination if the source is null; otherwise do\n      the allocate and copy.  */\n-  if (rank == 0)\n+  if (!GFC_DESCRIPTOR_TYPE_P (TREE_TYPE (src)))\n     null_cond = src;\n   else\n     null_cond = gfc_conv_descriptor_data_get (src);"}, {"sha": "2f505a44d22aa6acca5b2589f1ce170345648aab", "filename": "gcc/testsuite/ChangeLog", "status": "modified", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/14c96bcafde23000b572ce0f46f0157901128c07/gcc%2Ftestsuite%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/14c96bcafde23000b572ce0f46f0157901128c07/gcc%2Ftestsuite%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2FChangeLog?ref=14c96bcafde23000b572ce0f46f0157901128c07", "patch": "@@ -1,3 +1,8 @@\n+2013-04-12  Tobias Burnus  <burnus@net-b.de>\n+\n+\tPR fortran/56929\n+\t* gfortran.dg/coarray/alloc_comp_2.f90: New.\n+\n 2013-04-12  Vladimir Makarov  <vmakarov@redhat.com>\n \n \tPR target/56903"}, {"sha": "13c823e7474955313719d069970ff13acea09091", "filename": "gcc/testsuite/gfortran.dg/coarray/alloc_comp_2.f90", "status": "added", "additions": 19, "deletions": 0, "changes": 19, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/14c96bcafde23000b572ce0f46f0157901128c07/gcc%2Ftestsuite%2Fgfortran.dg%2Fcoarray%2Falloc_comp_2.f90", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/14c96bcafde23000b572ce0f46f0157901128c07/gcc%2Ftestsuite%2Fgfortran.dg%2Fcoarray%2Falloc_comp_2.f90", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgfortran.dg%2Fcoarray%2Falloc_comp_2.f90?ref=14c96bcafde23000b572ce0f46f0157901128c07", "patch": "@@ -0,0 +1,19 @@\n+! { dg-do compile }\n+!\n+! PR fortran/56929\n+!\n+! Contributed by Damian Rouson\n+!\n+! Allocatable scalar corrays were mishandled (ICE)\n+!\n+module parent_coarray_component\n+  type parent\n+    real, allocatable :: dummy[:]\n+  end type\n+  type, extends(parent) :: child\n+  end type\n+contains\n+  subroutine do_something(this)\n+    class(child) this\n+  end \n+end"}]}