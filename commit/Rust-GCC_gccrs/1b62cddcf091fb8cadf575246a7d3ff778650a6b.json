{"sha": "1b62cddcf091fb8cadf575246a7d3ff778650a6b", "node_id": "C_kwDOANBUbNoAKDFiNjJjZGRjZjA5MWZiOGNhZGY1NzUyNDZhN2QzZmY3Nzg2NTBhNmI", "commit": {"author": {"name": "Jan Hubicka", "email": "jh@suse.cz", "date": "2021-11-12T13:00:47Z"}, "committer": {"name": "Jan Hubicka", "email": "jh@suse.cz", "date": "2021-11-12T13:01:17Z"}, "message": "Fix ipa-modref pure/const discovery\n\n\tPR ipa/103200\n\t* ipa-modref.c (analyze_function, modref_propagate_in_scc): Do\n\tnot mark pure/const function if there are side-effects.", "tree": {"sha": "4208f349a01faf476692f9ab3cde7b6edec1bc70", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/4208f349a01faf476692f9ab3cde7b6edec1bc70"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/1b62cddcf091fb8cadf575246a7d3ff778650a6b", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/1b62cddcf091fb8cadf575246a7d3ff778650a6b", "html_url": "https://github.com/Rust-GCC/gccrs/commit/1b62cddcf091fb8cadf575246a7d3ff778650a6b", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/1b62cddcf091fb8cadf575246a7d3ff778650a6b/comments", "author": null, "committer": null, "parents": [{"sha": "b7e20480630e3eeb9eed8b3941da3b3f0c22c969", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/b7e20480630e3eeb9eed8b3941da3b3f0c22c969", "html_url": "https://github.com/Rust-GCC/gccrs/commit/b7e20480630e3eeb9eed8b3941da3b3f0c22c969"}], "stats": {"total": 8, "additions": 5, "deletions": 3}, "files": [{"sha": "44b3427a2023d7f54647aa16d7b5045f60c81768", "filename": "gcc/ipa-modref.c", "status": "modified", "additions": 5, "deletions": 3, "changes": 8, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/1b62cddcf091fb8cadf575246a7d3ff778650a6b/gcc%2Fipa-modref.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/1b62cddcf091fb8cadf575246a7d3ff778650a6b/gcc%2Fipa-modref.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fipa-modref.c?ref=1b62cddcf091fb8cadf575246a7d3ff778650a6b", "patch": "@@ -2790,7 +2790,8 @@ analyze_function (function *f, bool ipa)\n \n   if (!ipa && flag_ipa_pure_const)\n     {\n-      if (!summary->stores->every_base && !summary->stores->bases)\n+      if (!summary->stores->every_base && !summary->stores->bases\n+\t  && !summary->side_effects)\n \t{\n \t  if (!summary->loads->every_base && !summary->loads->bases)\n \t    fixup_cfg = ipa_make_function_const\n@@ -4380,7 +4381,8 @@ modref_propagate_in_scc (cgraph_node *component_node)\n \tmodref_summary_lto *summary_lto = summaries_lto\n \t\t\t\t\t  ? summaries_lto->get (cur)\n \t\t\t\t\t  : NULL;\n-\tif (summary && !summary->stores->every_base && !summary->stores->bases)\n+\tif (summary && !summary->stores->every_base && !summary->stores->bases\n+\t    && !summary->side_effects)\n \t  {\n \t    if (!summary->loads->every_base && !summary->loads->bases)\n \t      pureconst |= ipa_make_function_const\n@@ -4390,7 +4392,7 @@ modref_propagate_in_scc (cgraph_node *component_node)\n \t\t     (cur, summary->side_effects, false);\n \t  }\n \tif (summary_lto && !summary_lto->stores->every_base\n-\t    && !summary_lto->stores->bases)\n+\t    && !summary_lto->stores->bases && !summary_lto->side_effects)\n \t  {\n \t    if (!summary_lto->loads->every_base && !summary_lto->loads->bases)\n \t      pureconst |= ipa_make_function_const"}]}