{"sha": "fae2b46b091f4feb984ac9c51dd543f257d9dc94", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6ZmFlMmI0NmIwOTFmNGZlYjk4NGFjOWM1MWRkNTQzZjI1N2Q5ZGM5NA==", "commit": {"author": {"name": "Jakub Jelinek", "email": "jakub@redhat.com", "date": "2006-03-21T16:21:24Z"}, "committer": {"name": "Jakub Jelinek", "email": "jakub@gcc.gnu.org", "date": "2006-03-21T16:21:24Z"}, "message": "re PR c++/26691 (Wrong code for constructor with default value)\n\n\tPR c++/26691\n\t* cp-gimplify.c (cxx_omp_clause_apply_fn): Handle default arguments.\n\n\t* testsuite/libgomp.c++/pr26691.C: New test.\n\nFrom-SVN: r112251", "tree": {"sha": "d017f51f43b8ed4de93b45a1a613096f63eb1d5e", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/d017f51f43b8ed4de93b45a1a613096f63eb1d5e"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/fae2b46b091f4feb984ac9c51dd543f257d9dc94", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/fae2b46b091f4feb984ac9c51dd543f257d9dc94", "html_url": "https://github.com/Rust-GCC/gccrs/commit/fae2b46b091f4feb984ac9c51dd543f257d9dc94", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/fae2b46b091f4feb984ac9c51dd543f257d9dc94/comments", "author": {"login": "jakubjelinek", "id": 9370665, "node_id": "MDQ6VXNlcjkzNzA2NjU=", "avatar_url": "https://avatars.githubusercontent.com/u/9370665?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jakubjelinek", "html_url": "https://github.com/jakubjelinek", "followers_url": "https://api.github.com/users/jakubjelinek/followers", "following_url": "https://api.github.com/users/jakubjelinek/following{/other_user}", "gists_url": "https://api.github.com/users/jakubjelinek/gists{/gist_id}", "starred_url": "https://api.github.com/users/jakubjelinek/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jakubjelinek/subscriptions", "organizations_url": "https://api.github.com/users/jakubjelinek/orgs", "repos_url": "https://api.github.com/users/jakubjelinek/repos", "events_url": "https://api.github.com/users/jakubjelinek/events{/privacy}", "received_events_url": "https://api.github.com/users/jakubjelinek/received_events", "type": "User", "site_admin": false}, "committer": null, "parents": [{"sha": "aa09f986bc1d3934932225d64ebca03a7eed65b3", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/aa09f986bc1d3934932225d64ebca03a7eed65b3", "html_url": "https://github.com/Rust-GCC/gccrs/commit/aa09f986bc1d3934932225d64ebca03a7eed65b3"}], "stats": {"total": 59, "additions": 53, "deletions": 6}, "files": [{"sha": "6a8c8461fdc838ddd9bfcc5de2c2c524e71f1fe6", "filename": "gcc/cp/ChangeLog", "status": "modified", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/fae2b46b091f4feb984ac9c51dd543f257d9dc94/gcc%2Fcp%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/fae2b46b091f4feb984ac9c51dd543f257d9dc94/gcc%2Fcp%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fcp%2FChangeLog?ref=fae2b46b091f4feb984ac9c51dd543f257d9dc94", "patch": "@@ -1,3 +1,8 @@\n+2006-03-21  Jakub Jelinek  <jakub@redhat.com>\n+\n+\tPR c++/26691\n+\t* cp-gimplify.c (cxx_omp_clause_apply_fn): Handle default arguments.\n+\n 2006-03-21  Jason Merrill  <jason@redhat.com>\n \n \tPR c++/21581"}, {"sha": "be85ebb56f1d57a8d418580d2e26da9340df5041", "filename": "gcc/cp/cp-gimplify.c", "status": "modified", "additions": 23, "deletions": 6, "changes": 29, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/fae2b46b091f4feb984ac9c51dd543f257d9dc94/gcc%2Fcp%2Fcp-gimplify.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/fae2b46b091f4feb984ac9c51dd543f257d9dc94/gcc%2Fcp%2Fcp-gimplify.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fcp%2Fcp-gimplify.c?ref=fae2b46b091f4feb984ac9c51dd543f257d9dc94", "patch": "@@ -712,9 +712,16 @@ cp_genericize (tree fndecl)\n static tree\n cxx_omp_clause_apply_fn (tree fn, tree arg1, tree arg2)\n {\n+  tree defparm, parm;\n+  int i;\n+\n   if (fn == NULL)\n     return NULL;\n \n+  defparm = TREE_CHAIN (TYPE_ARG_TYPES (TREE_TYPE (fn)));\n+  if (arg2)\n+    defparm = TREE_CHAIN (defparm);\n+\n   if (TREE_CODE (TREE_TYPE (arg1)) == ARRAY_TYPE)\n     {\n       tree inner_type = TREE_TYPE (arg1);\n@@ -757,11 +764,16 @@ cxx_omp_clause_apply_fn (tree fn, tree arg1, tree arg2)\n       t = build1 (LABEL_EXPR, void_type_node, lab);\n       append_to_statement_list (t, &ret);\n \n-      t = NULL;\n+      t = tree_cons (NULL, p1, NULL);\n       if (arg2)\n \tt = tree_cons (NULL, p2, t);\n-      t = tree_cons (NULL, p1, t);\n-      t = build_call (fn, t);\n+      /* Handle default arguments.  */\n+      i = 1 + (arg2 != NULL);\n+      for (parm = defparm; parm != void_list_node; parm = TREE_CHAIN (parm))\n+\tt = tree_cons (NULL, convert_default_arg (TREE_VALUE (parm),\n+\t\t\t\t\t\t  TREE_PURPOSE (parm),\n+\t\t\t\t\t\t  fn, i++), t);\n+      t = build_call (fn, nreverse (t));\n       append_to_statement_list (t, &ret);\n \n       t = fold_convert (TREE_TYPE (p1), TYPE_SIZE_UNIT (inner_type));\n@@ -785,11 +797,16 @@ cxx_omp_clause_apply_fn (tree fn, tree arg1, tree arg2)\n     }\n   else\n     {\n-      tree t = NULL;\n+      tree t = tree_cons (NULL, build_fold_addr_expr (arg1), NULL);\n       if (arg2)\n \tt = tree_cons (NULL, build_fold_addr_expr (arg2), t);\n-      t = tree_cons (NULL, build_fold_addr_expr (arg1), t);\n-      return build_call (fn, t);\n+      /* Handle default arguments.  */\n+      i = 1 + (arg2 != NULL);\n+      for (parm = defparm; parm != void_list_node; parm = TREE_CHAIN (parm))\n+\tt = tree_cons (NULL, convert_default_arg (TREE_VALUE (parm),\n+\t\t\t\t\t\t  TREE_PURPOSE (parm),\n+\t\t\t\t\t\t  fn, i++), t);\n+      return build_call (fn, nreverse (t));\n     }\n }\n "}, {"sha": "33d1e78da2ee371ff0a9864f5c01065cd945a913", "filename": "libgomp/ChangeLog", "status": "modified", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/fae2b46b091f4feb984ac9c51dd543f257d9dc94/libgomp%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/fae2b46b091f4feb984ac9c51dd543f257d9dc94/libgomp%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libgomp%2FChangeLog?ref=fae2b46b091f4feb984ac9c51dd543f257d9dc94", "patch": "@@ -1,3 +1,8 @@\n+2006-03-21  Jakub Jelinek  <jakub@redhat.com>\n+\n+\tPR c++/26691\n+\t* testsuite/libgomp.c++/pr26691.C: New test.\n+\n 2006-03-13  Jakub Jelinek  <jakub@redhat.com>\n \n \t* testsuite/libgomp.fortran/retval2.f90: New test."}, {"sha": "776b31e24fb10c71aa00e3ff39d6a044dd672bbe", "filename": "libgomp/testsuite/libgomp.c++/pr26691.C", "status": "added", "additions": 20, "deletions": 0, "changes": 20, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/fae2b46b091f4feb984ac9c51dd543f257d9dc94/libgomp%2Ftestsuite%2Flibgomp.c%2B%2B%2Fpr26691.C", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/fae2b46b091f4feb984ac9c51dd543f257d9dc94/libgomp%2Ftestsuite%2Flibgomp.c%2B%2B%2Fpr26691.C", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libgomp%2Ftestsuite%2Flibgomp.c%2B%2B%2Fpr26691.C?ref=fae2b46b091f4feb984ac9c51dd543f257d9dc94", "patch": "@@ -0,0 +1,20 @@\n+// PR c++/26691\n+\n+struct A\n+{\n+  int n;\n+  A (int i = 3) : n (i) {}\n+};\n+\n+int\n+main ()\n+{\n+  A a;\n+  int err = 0;\n+#pragma omp parallel private (a) reduction (+:err)\n+  if (a.n != 3)\n+    err++;\n+\n+  return err;\n+ }\n+"}]}