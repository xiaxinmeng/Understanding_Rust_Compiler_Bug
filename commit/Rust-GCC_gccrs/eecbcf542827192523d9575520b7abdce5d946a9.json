{"sha": "eecbcf542827192523d9575520b7abdce5d946a9", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6ZWVjYmNmNTQyODI3MTkyNTIzZDk1NzU1MjBiN2FiZGNlNWQ5NDZhOQ==", "commit": {"author": {"name": "Bryce McKinlay", "email": "mckinlay@redhat.com", "date": "2004-07-22T01:33:11Z"}, "committer": {"name": "Bryce McKinlay", "email": "bryce@gcc.gnu.org", "date": "2004-07-22T01:33:11Z"}, "message": "URLConnection.java (position): New field.\n\n2004-07-21  Bryce McKinlay  <mckinlay@redhat.com>\n\n\t* java/net/URLConnection.java (position): New field.\n\t(dateFormat1, dateFormat2, dateFormat3): Removed.\n\t(dateFormats): New field.\n\t(getHeaderFieldDate): Use new dateFormats array. Re-use\n\tparsePosition each time instead of re-allocating.\n\t(initializeDateFormats): Initialize 'dateFormats'.\n\nFrom-SVN: r85033", "tree": {"sha": "1a0a199fd7f987eaa9b486b3e315675dc3166189", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/1a0a199fd7f987eaa9b486b3e315675dc3166189"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/eecbcf542827192523d9575520b7abdce5d946a9", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/eecbcf542827192523d9575520b7abdce5d946a9", "html_url": "https://github.com/Rust-GCC/gccrs/commit/eecbcf542827192523d9575520b7abdce5d946a9", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/eecbcf542827192523d9575520b7abdce5d946a9/comments", "author": null, "committer": null, "parents": [{"sha": "c9092111fd29bb8e26c7dedb96a854d45c442977", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/c9092111fd29bb8e26c7dedb96a854d45c442977", "html_url": "https://github.com/Rust-GCC/gccrs/commit/c9092111fd29bb8e26c7dedb96a854d45c442977"}], "stats": {"total": 44, "additions": 30, "deletions": 14}, "files": [{"sha": "45bc5ca61ea447852954937f6f3a1b72652c693c", "filename": "libjava/ChangeLog", "status": "modified", "additions": 9, "deletions": 0, "changes": 9, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/eecbcf542827192523d9575520b7abdce5d946a9/libjava%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/eecbcf542827192523d9575520b7abdce5d946a9/libjava%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libjava%2FChangeLog?ref=eecbcf542827192523d9575520b7abdce5d946a9", "patch": "@@ -1,3 +1,12 @@\n+2004-07-21  Bryce McKinlay  <mckinlay@redhat.com>\n+\n+\t* java/net/URLConnection.java (position): New field.\n+\t(dateFormat1, dateFormat2, dateFormat3): Removed.\n+\t(dateFormats): New field.\n+\t(getHeaderFieldDate): Use new dateFormats array. Re-use parsePosition\n+\teach time instead of re-allocating.\n+\t(initializeDateFormats): Initialize 'dateFormats'.\n+\n 2004-07-20  Bryce McKinlay  <mckinlay@redhat.com>\n \n \tPR libgcj/16591"}, {"sha": "7b5f6a5dd187c38caa38a7a65e2055d029ae7c84", "filename": "libjava/java/net/URLConnection.java", "status": "modified", "additions": 21, "deletions": 14, "changes": 35, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/eecbcf542827192523d9575520b7abdce5d946a9/libjava%2Fjava%2Fnet%2FURLConnection.java", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/eecbcf542827192523d9575520b7abdce5d946a9/libjava%2Fjava%2Fnet%2FURLConnection.java", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libjava%2Fjava%2Fnet%2FURLConnection.java?ref=eecbcf542827192523d9575520b7abdce5d946a9", "patch": "@@ -165,11 +165,12 @@\n   protected URL url;\n \n   private static Hashtable handlers = new Hashtable();\n-  private static SimpleDateFormat dateFormat1;\n-  private static SimpleDateFormat dateFormat2;\n-  private static SimpleDateFormat dateFormat3;\n+  private static SimpleDateFormat[] dateFormats;\n   private static boolean dateformats_initialized;\n \n+  /* Cached ParsePosition, used when parsing dates. */\n+  private ParsePosition position;\n+\n   /**\n    * Creates a URL connection to a given URL. A real connection is not made.\n    * Use #connect to do this.\n@@ -366,19 +367,24 @@ public long getHeaderFieldDate(String name, long defaultValue)\n   {\n     if (! dateformats_initialized)\n       initializeDateFormats();\n+    \n+    if (position == null)\n+      position = new ParsePosition(0);\n \n     long result = defaultValue;\n     String str = getHeaderField(name);\n \n     if (str != null)\n       {\n-\tDate date;\n-\tif ((date = dateFormat1.parse(str, new ParsePosition(0))) != null)\n-\t  result = date.getTime();\n-\telse if ((date = dateFormat2.parse(str, new ParsePosition(0))) != null)\n-\t  result = date.getTime();\n-\telse if ((date = dateFormat3.parse(str, new ParsePosition(0))) != null)\n-\t  result = date.getTime();\n+\tfor (int i = 0; i < dateFormats.length; i++)\n+\t  {\n+\t    SimpleDateFormat df = dateFormats[i];\n+\t    position.setIndex(0);\n+\t    position.setErrorIndex(0);\n+\t    Date date = df.parse(str, position);\n+\t    if (date != null)\n+\t      return date.getTime();\n+\t  }\n       }\n \n     return result;\n@@ -1040,17 +1046,18 @@ else if (! ((cArray[i] >= 'A' && cArray[i] <= 'Z') ||\n   // We don't put these in a static initializer, because it creates problems\n   // with initializer co-dependency: SimpleDateFormat's constructors eventually \n   // depend on URLConnection (via the java.text.*Symbols classes).\n-  private synchronized void initializeDateFormats()\n+  private static synchronized void initializeDateFormats()\n   {\n     if (dateformats_initialized)\n       return;\n \n     Locale locale = new Locale(\"En\", \"Us\", \"Unix\");\n-    dateFormat1 =\n+    dateFormats = new SimpleDateFormat[3];\n+    dateFormats[0] =\n       new SimpleDateFormat(\"EEE, dd MMM yyyy hh:mm:ss 'GMT'\", locale);\n-    dateFormat2 =\n+    dateFormats[1] =\n       new SimpleDateFormat(\"EEEE, dd-MMM-yy hh:mm:ss 'GMT'\", locale);\n-    dateFormat3 = new SimpleDateFormat(\"EEE MMM d hh:mm:ss yyyy\", locale);\n+    dateFormats[2] = new SimpleDateFormat(\"EEE MMM d hh:mm:ss yyyy\", locale);\n     dateformats_initialized = true;\n   }\n }"}]}