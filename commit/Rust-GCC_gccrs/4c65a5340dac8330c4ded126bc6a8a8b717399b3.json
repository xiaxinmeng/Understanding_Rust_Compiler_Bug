{"sha": "4c65a5340dac8330c4ded126bc6a8a8b717399b3", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6NGM2NWE1MzQwZGFjODMzMGM0ZGVkMTI2YmM2YThhOGI3MTczOTliMw==", "commit": {"author": {"name": "Volker Reichelt", "email": "reichelt@igpm.rwth-aachen.de", "date": "2006-06-12T22:56:07Z"}, "committer": {"name": "Volker Reichelt", "email": "reichelt@gcc.gnu.org", "date": "2006-06-12T22:56:07Z"}, "message": "re PR c++/27601 (ICE (in fold_offsetof_1, at c-common.c:5998) on strange offsetof)\n\n\tPR c++/27601\n\t* semantics.c (finish_offsetof): Handle pseudo-destructors.\n\n\t* g++.dg/ext/offsetof1.C: Add test for pseudo-destructors.\n\nFrom-SVN: r114588", "tree": {"sha": "1712a3d650ee1cb20144d6c58a7740745f149774", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/1712a3d650ee1cb20144d6c58a7740745f149774"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/4c65a5340dac8330c4ded126bc6a8a8b717399b3", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/4c65a5340dac8330c4ded126bc6a8a8b717399b3", "html_url": "https://github.com/Rust-GCC/gccrs/commit/4c65a5340dac8330c4ded126bc6a8a8b717399b3", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/4c65a5340dac8330c4ded126bc6a8a8b717399b3/comments", "author": null, "committer": null, "parents": [{"sha": "dfa9dde4e03150d4df95bbcfc8121b52cac401c6", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/dfa9dde4e03150d4df95bbcfc8121b52cac401c6", "html_url": "https://github.com/Rust-GCC/gccrs/commit/dfa9dde4e03150d4df95bbcfc8121b52cac401c6"}], "stats": {"total": 20, "additions": 20, "deletions": 0}, "files": [{"sha": "f64c233c4e7e6ec7f53ba2e19148a3812ca1519c", "filename": "gcc/cp/ChangeLog", "status": "modified", "additions": 3, "deletions": 0, "changes": 3, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/4c65a5340dac8330c4ded126bc6a8a8b717399b3/gcc%2Fcp%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/4c65a5340dac8330c4ded126bc6a8a8b717399b3/gcc%2Fcp%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fcp%2FChangeLog?ref=4c65a5340dac8330c4ded126bc6a8a8b717399b3", "patch": "@@ -1,5 +1,8 @@\n 2006-06-12  Volker Reichelt  <reichelt@igpm.rwth-aachen.de>\n \n+\tPR c++/27601\n+\t* semantics.c (finish_offsetof): Handle pseudo-destructors.\n+\n \tPR c++/27933\n \t* name-lookup.c (lookup_qualified_name): Always return error_mark_node\n \tif lookup fails."}, {"sha": "85881c0c3100f157bf6b253b1b8f01d2d21c5046", "filename": "gcc/cp/semantics.c", "status": "modified", "additions": 6, "deletions": 0, "changes": 6, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/4c65a5340dac8330c4ded126bc6a8a8b717399b3/gcc%2Fcp%2Fsemantics.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/4c65a5340dac8330c4ded126bc6a8a8b717399b3/gcc%2Fcp%2Fsemantics.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fcp%2Fsemantics.c?ref=4c65a5340dac8330c4ded126bc6a8a8b717399b3", "patch": "@@ -2887,6 +2887,12 @@ finish_typeof (tree expr)\n tree\n finish_offsetof (tree expr)\n {\n+  if (TREE_CODE (expr) == PSEUDO_DTOR_EXPR)\n+    {\n+      error (\"cannot apply %<offsetof%> to destructor %<~%T%>\",\n+\t      TREE_OPERAND (expr, 2));\n+      return error_mark_node;\n+    }\n   if (TREE_CODE (TREE_TYPE (expr)) == FUNCTION_TYPE\n       || TREE_CODE (TREE_TYPE (expr)) == METHOD_TYPE\n       || TREE_CODE (TREE_TYPE (expr)) == UNKNOWN_TYPE)"}, {"sha": "bb887b3cd89ddc677bbb376c144499b4ae3bd91f", "filename": "gcc/testsuite/ChangeLog", "status": "modified", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/4c65a5340dac8330c4ded126bc6a8a8b717399b3/gcc%2Ftestsuite%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/4c65a5340dac8330c4ded126bc6a8a8b717399b3/gcc%2Ftestsuite%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2FChangeLog?ref=4c65a5340dac8330c4ded126bc6a8a8b717399b3", "patch": "@@ -1,3 +1,8 @@\n+2006-06-12  Volker Reichelt  <reichelt@igpm.rwth-aachen.de>\n+\n+\tPR c++/27601\n+\t* g++.dg/ext/offsetof1.C: Add test for pseudo-destructors.\n+\n 2006-06-12  Mark Mitchell  <mark@codesourcery.com>\n \t    Kazu Hirata  <kazu@codesourcery.com>\n "}, {"sha": "e59442de4edd6a738f9e005bc39ec3bffa1ace50", "filename": "gcc/testsuite/g++.dg/ext/offsetof1.C", "status": "modified", "additions": 6, "deletions": 0, "changes": 6, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/4c65a5340dac8330c4ded126bc6a8a8b717399b3/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Fext%2Foffsetof1.C", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/4c65a5340dac8330c4ded126bc6a8a8b717399b3/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Fext%2Foffsetof1.C", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Fext%2Foffsetof1.C?ref=4c65a5340dac8330c4ded126bc6a8a8b717399b3", "patch": "@@ -10,3 +10,9 @@ struct bar {\n int a = __builtin_offsetof(bar, foo);  // { dg-error \"static data member\" }\n int b = __builtin_offsetof(bar, baz);  // { dg-error \"member function\" }\n int c = __builtin_offsetof(bar, ~bar);  // { dg-error \"member function\" }\n+\n+typedef int I;\n+enum E { };\n+\n+int d = __builtin_offsetof(I, ~I);  // { dg-error \"destructor\" }\n+int e = __builtin_offsetof(E, ~E);  // { dg-error \"destructor\" }"}]}