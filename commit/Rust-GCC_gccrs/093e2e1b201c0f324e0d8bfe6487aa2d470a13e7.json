{"sha": "093e2e1b201c0f324e0d8bfe6487aa2d470a13e7", "node_id": "C_kwDOANBUbNoAKDA5M2UyZTFiMjAxYzBmMzI0ZTBkOGJmZTY0ODdhYTJkNDcwYTEzZTc", "commit": {"author": {"name": "Andrew MacLeod", "email": "amacleod@redhat.com", "date": "2023-02-01T16:46:18Z"}, "committer": {"name": "Andrew MacLeod", "email": "amacleod@redhat.com", "date": "2023-02-03T19:42:46Z"}, "message": "Reset SCEV before removing unreachable globals.\n\nSCEV should be reset in VRP before trying to remove unreachable globals\nto avoid triggering issues with it's cache.\n\n\tPR tree-optimization/107570\n\tgcc/\n\t* tree-vrp.cc (remove_and_update_globals): Reset SCEV.\n\n\tgcc/testsuite/\n\t* gcc.dg/pr107570.c: New.", "tree": {"sha": "59daf97769e66402dfe7cbf4467c3e545cbf0864", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/59daf97769e66402dfe7cbf4467c3e545cbf0864"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/093e2e1b201c0f324e0d8bfe6487aa2d470a13e7", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/093e2e1b201c0f324e0d8bfe6487aa2d470a13e7", "html_url": "https://github.com/Rust-GCC/gccrs/commit/093e2e1b201c0f324e0d8bfe6487aa2d470a13e7", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/093e2e1b201c0f324e0d8bfe6487aa2d470a13e7/comments", "author": null, "committer": null, "parents": [{"sha": "27ac6a707e7438c3cec79c24f5d53de79493e2f8", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/27ac6a707e7438c3cec79c24f5d53de79493e2f8", "html_url": "https://github.com/Rust-GCC/gccrs/commit/27ac6a707e7438c3cec79c24f5d53de79493e2f8"}], "stats": {"total": 29, "additions": 29, "deletions": 0}, "files": [{"sha": "ba5b535a867201b979270257078232e2b103b270", "filename": "gcc/testsuite/gcc.dg/pr107570.c", "status": "added", "additions": 25, "deletions": 0, "changes": 25, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/093e2e1b201c0f324e0d8bfe6487aa2d470a13e7/gcc%2Ftestsuite%2Fgcc.dg%2Fpr107570.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/093e2e1b201c0f324e0d8bfe6487aa2d470a13e7/gcc%2Ftestsuite%2Fgcc.dg%2Fpr107570.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgcc.dg%2Fpr107570.c?ref=093e2e1b201c0f324e0d8bfe6487aa2d470a13e7", "patch": "@@ -0,0 +1,25 @@\n+/* { dg-do compile } */\n+/* { dg-options \"-Os\" } */\n+\n+long int n;\n+\n+void\n+foo (int *p, int x)\n+{\n+  for (;;)\n+    {\n+      for (*p = 0; *p < 1; ++*p)\n+        {\n+          n += *p < 0;\n+          if (n < x)\n+            {\n+              while (x < 1)\n+                ++x;\n+\n+              __builtin_unreachable ();\n+            }\n+        }\n+\n+      p = &x;\n+    }\n+}"}, {"sha": "95547e5419b670e0492b34365db5b906d37a87ef", "filename": "gcc/tree-vrp.cc", "status": "modified", "additions": 4, "deletions": 0, "changes": 4, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/093e2e1b201c0f324e0d8bfe6487aa2d470a13e7/gcc%2Ftree-vrp.cc", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/093e2e1b201c0f324e0d8bfe6487aa2d470a13e7/gcc%2Ftree-vrp.cc", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftree-vrp.cc?ref=093e2e1b201c0f324e0d8bfe6487aa2d470a13e7", "patch": "@@ -121,6 +121,10 @@ remove_unreachable::remove_and_update_globals (bool final_p)\n   if (m_list.length () == 0)\n     return false;\n \n+  // Ensure the cache in SCEV has been cleared before processing\n+  // globals to be removed.\n+  scev_reset ();\n+\n   bool change = false;\n   tree name;\n   unsigned i;"}]}