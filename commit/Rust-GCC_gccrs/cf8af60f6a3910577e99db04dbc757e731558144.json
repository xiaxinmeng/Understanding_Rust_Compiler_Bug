{"sha": "cf8af60f6a3910577e99db04dbc757e731558144", "node_id": "C_kwDOANBUbNoAKGNmOGFmNjBmNmEzOTEwNTc3ZTk5ZGIwNGRiYzc1N2U3MzE1NTgxNDQ", "commit": {"author": {"name": "Piotr Trojanek", "email": "trojanek@adacore.com", "date": "2022-08-08T14:10:36Z"}, "committer": {"name": "Marc Poulhi\u00e8s", "email": "poulhies@adacore.com", "date": "2022-09-12T08:16:51Z"}, "message": "[Ada] Fix validity checking on renamed Old attribute prefix\n\nPrefix of attribute Old is captured either as an object renaming or as\nan object declaration. This is now taken into account when applying\nvalidity checks.\n\ngcc/ada/\n\n\t* exp_attr.adb (Expand_N_Attribute_Reference [Attribute_Old]):\n\tAdapt to object declaration being rewritten into object renaming.", "tree": {"sha": "eabf52aeb0870f1b5867b8d92dd1959e9b9197db", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/eabf52aeb0870f1b5867b8d92dd1959e9b9197db"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/cf8af60f6a3910577e99db04dbc757e731558144", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/cf8af60f6a3910577e99db04dbc757e731558144", "html_url": "https://github.com/Rust-GCC/gccrs/commit/cf8af60f6a3910577e99db04dbc757e731558144", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/cf8af60f6a3910577e99db04dbc757e731558144/comments", "author": {"login": "ptroja", "id": 161602, "node_id": "MDQ6VXNlcjE2MTYwMg==", "avatar_url": "https://avatars.githubusercontent.com/u/161602?v=4", "gravatar_id": "", "url": "https://api.github.com/users/ptroja", "html_url": "https://github.com/ptroja", "followers_url": "https://api.github.com/users/ptroja/followers", "following_url": "https://api.github.com/users/ptroja/following{/other_user}", "gists_url": "https://api.github.com/users/ptroja/gists{/gist_id}", "starred_url": "https://api.github.com/users/ptroja/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/ptroja/subscriptions", "organizations_url": "https://api.github.com/users/ptroja/orgs", "repos_url": "https://api.github.com/users/ptroja/repos", "events_url": "https://api.github.com/users/ptroja/events{/privacy}", "received_events_url": "https://api.github.com/users/ptroja/received_events", "type": "User", "site_admin": false}, "committer": {"login": "dkm", "id": 87603, "node_id": "MDQ6VXNlcjg3NjAz", "avatar_url": "https://avatars.githubusercontent.com/u/87603?v=4", "gravatar_id": "", "url": "https://api.github.com/users/dkm", "html_url": "https://github.com/dkm", "followers_url": "https://api.github.com/users/dkm/followers", "following_url": "https://api.github.com/users/dkm/following{/other_user}", "gists_url": "https://api.github.com/users/dkm/gists{/gist_id}", "starred_url": "https://api.github.com/users/dkm/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/dkm/subscriptions", "organizations_url": "https://api.github.com/users/dkm/orgs", "repos_url": "https://api.github.com/users/dkm/repos", "events_url": "https://api.github.com/users/dkm/events{/privacy}", "received_events_url": "https://api.github.com/users/dkm/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "a968d80d0e89e847a1928842b7de166a6d42c92e", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/a968d80d0e89e847a1928842b7de166a6d42c92e", "html_url": "https://github.com/Rust-GCC/gccrs/commit/a968d80d0e89e847a1928842b7de166a6d42c92e"}], "stats": {"total": 12, "additions": 11, "deletions": 1}, "files": [{"sha": "0e79b5d10cd7a1ea9de7428c207b8fc3b1f9d602", "filename": "gcc/ada/exp_attr.adb", "status": "modified", "additions": 11, "deletions": 1, "changes": 12, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/cf8af60f6a3910577e99db04dbc757e731558144/gcc%2Fada%2Fexp_attr.adb", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/cf8af60f6a3910577e99db04dbc757e731558144/gcc%2Fada%2Fexp_attr.adb", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fada%2Fexp_attr.adb?ref=cf8af60f6a3910577e99db04dbc757e731558144", "patch": "@@ -5088,7 +5088,17 @@ package body Exp_Attr is\n          --  to reflect the new placement of the prefix.\n \n          if Validity_Checks_On and then Validity_Check_Operands then\n-            Ensure_Valid (Expression (Decl));\n+\n+            --  Object declaration that captures the attribute prefix might\n+            --  be rewritten into object renaming declaration.\n+\n+            if Nkind (Decl) = N_Object_Declaration then\n+               Ensure_Valid (Expression (Decl));\n+            else\n+               pragma Assert (Nkind (Decl) = N_Object_Renaming_Declaration\n+                              and then Is_Rewrite_Substitution (Decl));\n+               Ensure_Valid (Name (Decl));\n+            end if;\n          end if;\n \n          Rewrite (N, New_Occurrence_Of (Temp, Loc));"}]}