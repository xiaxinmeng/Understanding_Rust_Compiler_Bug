{"sha": "28541488914f27ad9763a02c2cc786cf786399d2", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6Mjg1NDE0ODg5MTRmMjdhZDk3NjNhMDJjMmNjNzg2Y2Y3ODYzOTlkMg==", "commit": {"author": {"name": "Javier Miranda", "email": "miranda@adacore.com", "date": "2009-05-06T08:28:40Z"}, "committer": {"name": "Arnaud Charlet", "email": "charlet@gcc.gnu.org", "date": "2009-05-06T08:28:40Z"}, "message": "exp_aggr.adb (Build_Record_Aggr_Code): Add implicit call to the C++ constructor in case of aggregates whose type is a...\n\n2009-05-06  Javier Miranda  <miranda@adacore.com>\n\n\t* exp_aggr.adb (Build_Record_Aggr_Code): Add implicit call to the C++\n\tconstructor in case of aggregates whose type is a CPP_Class type.\n\nFrom-SVN: r147151", "tree": {"sha": "fbbb37ac3dfe0f7306941ecae6e7e8b1b112430c", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/fbbb37ac3dfe0f7306941ecae6e7e8b1b112430c"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/28541488914f27ad9763a02c2cc786cf786399d2", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/28541488914f27ad9763a02c2cc786cf786399d2", "html_url": "https://github.com/Rust-GCC/gccrs/commit/28541488914f27ad9763a02c2cc786cf786399d2", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/28541488914f27ad9763a02c2cc786cf786399d2/comments", "author": {"login": "miranda-adacore", "id": 54413934, "node_id": "MDQ6VXNlcjU0NDEzOTM0", "avatar_url": "https://avatars.githubusercontent.com/u/54413934?v=4", "gravatar_id": "", "url": "https://api.github.com/users/miranda-adacore", "html_url": "https://github.com/miranda-adacore", "followers_url": "https://api.github.com/users/miranda-adacore/followers", "following_url": "https://api.github.com/users/miranda-adacore/following{/other_user}", "gists_url": "https://api.github.com/users/miranda-adacore/gists{/gist_id}", "starred_url": "https://api.github.com/users/miranda-adacore/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/miranda-adacore/subscriptions", "organizations_url": "https://api.github.com/users/miranda-adacore/orgs", "repos_url": "https://api.github.com/users/miranda-adacore/repos", "events_url": "https://api.github.com/users/miranda-adacore/events{/privacy}", "received_events_url": "https://api.github.com/users/miranda-adacore/received_events", "type": "User", "site_admin": false}, "committer": null, "parents": [{"sha": "55c078acd90197b56835f0a16ec13c278b73c78e", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/55c078acd90197b56835f0a16ec13c278b73c78e", "html_url": "https://github.com/Rust-GCC/gccrs/commit/55c078acd90197b56835f0a16ec13c278b73c78e"}], "stats": {"total": 24, "additions": 24, "deletions": 0}, "files": [{"sha": "4d7bb5659114496d98d5dde84c46f55374d56786", "filename": "gcc/ada/ChangeLog", "status": "modified", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/28541488914f27ad9763a02c2cc786cf786399d2/gcc%2Fada%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/28541488914f27ad9763a02c2cc786cf786399d2/gcc%2Fada%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fada%2FChangeLog?ref=28541488914f27ad9763a02c2cc786cf786399d2", "patch": "@@ -1,3 +1,8 @@\n+2009-05-06  Javier Miranda  <miranda@adacore.com>\n+\n+\t* exp_aggr.adb (Build_Record_Aggr_Code): Add implicit call to the C++\n+\tconstructor in case of aggregates whose type is a CPP_Class type.\n+\n 2009-05-06  Robert Dewar  <dewar@adacore.com>\n \n \t* sem_ch13.adb: Minor comment additions"}, {"sha": "6645bea388d92b949f1fb50c180a4955970d919a", "filename": "gcc/ada/exp_aggr.adb", "status": "modified", "additions": 19, "deletions": 0, "changes": 19, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/28541488914f27ad9763a02c2cc786cf786399d2/gcc%2Fada%2Fexp_aggr.adb", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/28541488914f27ad9763a02c2cc786cf786399d2/gcc%2Fada%2Fexp_aggr.adb", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fada%2Fexp_aggr.adb?ref=28541488914f27ad9763a02c2cc786cf786399d2", "patch": "@@ -2765,6 +2765,18 @@ package body Exp_Aggr is\n          end if;\n       end if;\n \n+      --  For CPP types we generate an implicit call to the C++ default\n+      --  constructor to ensure the proper initialization of the _Tag\n+      --  component.\n+\n+      if Is_CPP_Class (Typ) then\n+         pragma Assert (Present (Base_Init_Proc (Typ)));\n+         Append_List_To (L,\n+           Build_Initialization_Call (Loc,\n+             Id_Ref => Lhs,\n+             Typ    => Typ));\n+      end if;\n+\n       --  Generate the assignments, component by component\n \n       --    tmp.comp1 := Expr1_From_Aggr;\n@@ -3129,6 +3141,13 @@ package body Exp_Aggr is\n       if Ancestor_Is_Expression then\n          null;\n \n+      --  For CPP types we generated a call to the C++ default constructor\n+      --  before the components have been initialized to ensure the proper\n+      --  initialization of the _Tag component (see above).\n+\n+      elsif Is_CPP_Class (Typ) then\n+         null;\n+\n       elsif Is_Tagged_Type (Typ) and then VM_Target = No_VM then\n          Instr :=\n            Make_OK_Assignment_Statement (Loc,"}]}