{"sha": "07d3b5c8c0d446ffb57d73d821dcf8156b12bf5d", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6MDdkM2I1YzhjMGQ0NDZmZmI1N2Q3M2Q4MjFkY2Y4MTU2YjEyYmY1ZA==", "commit": {"author": {"name": "Richard Henderson", "email": "rth@redhat.com", "date": "2012-10-31T04:46:20Z"}, "committer": {"name": "Richard Henderson", "email": "rth@gcc.gnu.org", "date": "2012-10-31T04:46:20Z"}, "message": "Detect assembler support for RTM\n\n\t* acinclude.m4 (LIBITM_CHECK_AS_RTM): New.\n\t* configure.ac: Use it.\n\t* config.h.in, configure: Rebuild.\n\t* testsuite/Makefile.in: Rebuild.\n\nFrom-SVN: r193017", "tree": {"sha": "d14c657f9fcd9e62f20fcf5786a4d5d2d485b224", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/d14c657f9fcd9e62f20fcf5786a4d5d2d485b224"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/07d3b5c8c0d446ffb57d73d821dcf8156b12bf5d", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/07d3b5c8c0d446ffb57d73d821dcf8156b12bf5d", "html_url": "https://github.com/Rust-GCC/gccrs/commit/07d3b5c8c0d446ffb57d73d821dcf8156b12bf5d", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/07d3b5c8c0d446ffb57d73d821dcf8156b12bf5d/comments", "author": null, "committer": null, "parents": [{"sha": "d0a54439c14c34e38ab13d6ba1e4de8b35d1fbb9", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/d0a54439c14c34e38ab13d6ba1e4de8b35d1fbb9", "html_url": "https://github.com/Rust-GCC/gccrs/commit/d0a54439c14c34e38ab13d6ba1e4de8b35d1fbb9"}], "stats": {"total": 124, "additions": 79, "deletions": 45}, "files": [{"sha": "d98ce0715861604711758200533bfda1aef9cf64", "filename": "libitm/ChangeLog", "status": "modified", "additions": 7, "deletions": 0, "changes": 7, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/07d3b5c8c0d446ffb57d73d821dcf8156b12bf5d/libitm%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/07d3b5c8c0d446ffb57d73d821dcf8156b12bf5d/libitm%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libitm%2FChangeLog?ref=07d3b5c8c0d446ffb57d73d821dcf8156b12bf5d", "patch": "@@ -1,3 +1,10 @@\n+2012-10-31  Richard Henderson  <rth@redhat.com>\n+\n+\t* acinclude.m4 (LIBITM_CHECK_AS_RTM): New.\n+\t* configure.ac: Use it.\n+\t* config.h.in, configure: Rebuild.\n+\t* testsuite/Makefile.in: Rebuild.\n+\n 2012-10-24  Torvald Riegel  <triegel@redhat.com>\n \n \t* libitm.texi: Clarify ABI requirements for data-logging functions."}, {"sha": "fe32fe3e4a032b52fe3b01bb1d93adfb7a037702", "filename": "libitm/acinclude.m4", "status": "modified", "additions": 14, "deletions": 0, "changes": 14, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/07d3b5c8c0d446ffb57d73d821dcf8156b12bf5d/libitm%2Facinclude.m4", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/07d3b5c8c0d446ffb57d73d821dcf8156b12bf5d/libitm%2Facinclude.m4", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libitm%2Facinclude.m4?ref=07d3b5c8c0d446ffb57d73d821dcf8156b12bf5d", "patch": "@@ -109,6 +109,20 @@ i[[34567]]86 | x86_64)\n   ;;\n esac])\n \n+dnl Check if as supports RTM instructions.\n+AC_DEFUN([LIBITM_CHECK_AS_RTM], [\n+case \"${target_cpu}\" in\n+i[[34567]]86 | x86_64)\n+  AC_CACHE_CHECK([if the assembler supports RTM], libitm_cv_as_rtm, [\n+    AC_TRY_COMPILE([], [asm(\"1: xbegin 1b; xend\");],\n+\t\t   [libitm_cv_as_rtm=yes], [libitm_cv_as_rtm=no])\n+  ])\n+  if test x$libitm_cv_as_rtm = xyes; then\n+    AC_DEFINE(HAVE_AS_RTM, 1, [Define to 1 if the assembler supports RTM.])\n+  fi\n+  ;;\n+esac])\n+\n sinclude(../libtool.m4)\n dnl The lines below arrange for aclocal not to bring an installed\n dnl libtool.m4 into aclocal.m4, while still arranging for automake to"}, {"sha": "10de95ba02a3cef3d2d27e7e9f567a423a6fbde9", "filename": "libitm/config.h.in", "status": "modified", "additions": 3, "deletions": 0, "changes": 3, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/07d3b5c8c0d446ffb57d73d821dcf8156b12bf5d/libitm%2Fconfig.h.in", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/07d3b5c8c0d446ffb57d73d821dcf8156b12bf5d/libitm%2Fconfig.h.in", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libitm%2Fconfig.h.in?ref=07d3b5c8c0d446ffb57d73d821dcf8156b12bf5d", "patch": "@@ -12,6 +12,9 @@\n /* Define if your assembler supports .cfi_* directives. */\n #undef HAVE_AS_CFI_PSEUDO_OP\n \n+/* Define to 1 if the assembler supports RTM. */\n+#undef HAVE_AS_RTM\n+\n /* Define to 1 if the target supports __attribute__((alias(...))). */\n #undef HAVE_ATTRIBUTE_ALIAS\n "}, {"sha": "d985cf7b918da1c55dc83b615ad983e1bbe31390", "filename": "libitm/configure", "status": "modified", "additions": 51, "deletions": 9, "changes": 60, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/07d3b5c8c0d446ffb57d73d821dcf8156b12bf5d/libitm%2Fconfigure", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/07d3b5c8c0d446ffb57d73d821dcf8156b12bf5d/libitm%2Fconfigure", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libitm%2Fconfigure?ref=07d3b5c8c0d446ffb57d73d821dcf8156b12bf5d", "patch": "@@ -667,6 +667,7 @@ CXX\n am__fastdepCC_FALSE\n am__fastdepCC_TRUE\n CCDEPMODE\n+am__nodep\n AMDEPBACKSLASH\n AMDEP_FALSE\n AMDEP_TRUE\n@@ -3318,11 +3319,11 @@ MAKEINFO=${MAKEINFO-\"${am_missing_run}makeinfo\"}\n \n # We need awk for the \"check\" target.  The system \"awk\" is bad on\n # some platforms.\n-# Always define AMTAR for backward compatibility.\n+# Always define AMTAR for backward compatibility.  Yes, it's still used\n+# in the wild :-(  We should find a proper way to deprecate it ...\n+AMTAR='$${TAR-tar}'\n \n-AMTAR=${AMTAR-\"${am_missing_run}tar\"}\n-\n-am__tar='${AMTAR} chof - \"$$tardir\"'; am__untar='${AMTAR} xf -'\n+am__tar='$${TAR-tar} chof - \"$$tardir\"' am__untar='$${TAR-tar} xf -'\n \n \n \n@@ -4220,6 +4221,7 @@ fi\n if test \"x$enable_dependency_tracking\" != xno; then\n   am_depcomp=\"$ac_aux_dir/depcomp\"\n   AMDEPBACKSLASH='\\'\n+  am__nodep='_no'\n fi\n  if test \"x$enable_dependency_tracking\" != xno; then\n   AMDEP_TRUE=\n@@ -4244,6 +4246,7 @@ else\n   # instance it was reported that on HP-UX the gcc test will end up\n   # making a dummy file named `D' -- because `-MD' means `put the output\n   # in D'.\n+  rm -rf conftest.dir\n   mkdir conftest.dir\n   # Copy depcomp to subdir because otherwise we won't find it if we're\n   # using a relative directory.\n@@ -4303,7 +4306,7 @@ else\n \tbreak\n       fi\n       ;;\n-    msvisualcpp | msvcmsys)\n+    msvc7 | msvc7msys | msvisualcpp | msvcmsys)\n       # This compiler won't grok `-c -o', but also, the minuso test has\n       # not run yet.  These depmodes are late enough in the game, and\n       # so weak that their functioning should not be impacted.\n@@ -4628,6 +4631,7 @@ else\n   # instance it was reported that on HP-UX the gcc test will end up\n   # making a dummy file named `D' -- because `-MD' means `put the output\n   # in D'.\n+  rm -rf conftest.dir\n   mkdir conftest.dir\n   # Copy depcomp to subdir because otherwise we won't find it if we're\n   # using a relative directory.\n@@ -4687,7 +4691,7 @@ else\n \tbreak\n       fi\n       ;;\n-    msvisualcpp | msvcmsys)\n+    msvc7 | msvc7msys | msvisualcpp | msvcmsys)\n       # This compiler won't grok `-c -o', but also, the minuso test has\n       # not run yet.  These depmodes are late enough in the game, and\n       # so weak that their functioning should not be impacted.\n@@ -4762,6 +4766,7 @@ else\n   # instance it was reported that on HP-UX the gcc test will end up\n   # making a dummy file named `D' -- because `-MD' means `put the output\n   # in D'.\n+  rm -rf conftest.dir\n   mkdir conftest.dir\n   # Copy depcomp to subdir because otherwise we won't find it if we're\n   # using a relative directory.\n@@ -4819,7 +4824,7 @@ else\n \tbreak\n       fi\n       ;;\n-    msvisualcpp | msvcmsys)\n+    msvc7 | msvc7msys | msvisualcpp | msvcmsys)\n       # This compiler won't grok `-c -o', but also, the minuso test has\n       # not run yet.  These depmodes are late enough in the game, and\n       # so weak that their functioning should not be impacted.\n@@ -11779,7 +11784,7 @@ else\n   lt_dlunknown=0; lt_dlno_uscore=1; lt_dlneed_uscore=2\n   lt_status=$lt_dlunknown\n   cat > conftest.$ac_ext <<_LT_EOF\n-#line 11782 \"configure\"\n+#line 11787 \"configure\"\n #include \"confdefs.h\"\n \n #if HAVE_DLFCN_H\n@@ -11885,7 +11890,7 @@ else\n   lt_dlunknown=0; lt_dlno_uscore=1; lt_dlneed_uscore=2\n   lt_status=$lt_dlunknown\n   cat > conftest.$ac_ext <<_LT_EOF\n-#line 11888 \"configure\"\n+#line 11893 \"configure\"\n #include \"confdefs.h\"\n \n #if HAVE_DLFCN_H\n@@ -17327,6 +17332,43 @@ $as_echo \"#define HAVE_AS_AVX 1\" >>confdefs.h\n   ;;\n esac\n \n+case \"${target_cpu}\" in\n+i[34567]86 | x86_64)\n+  { $as_echo \"$as_me:${as_lineno-$LINENO}: checking if the assembler supports RTM\" >&5\n+$as_echo_n \"checking if the assembler supports RTM... \" >&6; }\n+if test \"${libitm_cv_as_rtm+set}\" = set; then :\n+  $as_echo_n \"(cached) \" >&6\n+else\n+\n+    cat confdefs.h - <<_ACEOF >conftest.$ac_ext\n+/* end confdefs.h.  */\n+\n+int\n+main ()\n+{\n+asm(\"1: xbegin 1b; xend\");\n+  ;\n+  return 0;\n+}\n+_ACEOF\n+if ac_fn_c_try_compile \"$LINENO\"; then :\n+  libitm_cv_as_rtm=yes\n+else\n+  libitm_cv_as_rtm=no\n+fi\n+rm -f core conftest.err conftest.$ac_objext conftest.$ac_ext\n+\n+fi\n+{ $as_echo \"$as_me:${as_lineno-$LINENO}: result: $libitm_cv_as_rtm\" >&5\n+$as_echo \"$libitm_cv_as_rtm\" >&6; }\n+  if test x$libitm_cv_as_rtm = xyes; then\n+\n+$as_echo \"#define HAVE_AS_RTM 1\" >>confdefs.h\n+\n+  fi\n+  ;;\n+esac\n+\n \n   { $as_echo \"$as_me:${as_lineno-$LINENO}: checking whether weak refs work like ELF\" >&5\n $as_echo_n \"checking whether weak refs work like ELF... \" >&6; }"}, {"sha": "8544686d8a2e01bb9deb8d03bbf5888dc647a950", "filename": "libitm/configure.ac", "status": "modified", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/07d3b5c8c0d446ffb57d73d821dcf8156b12bf5d/libitm%2Fconfigure.ac", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/07d3b5c8c0d446ffb57d73d821dcf8156b12bf5d/libitm%2Fconfigure.ac", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libitm%2Fconfigure.ac?ref=07d3b5c8c0d446ffb57d73d821dcf8156b12bf5d", "patch": "@@ -244,6 +244,7 @@ CFLAGS=\"$save_CFLAGS $XCFLAGS\"\n LIBITM_CHECK_SYNC_BUILTINS\n LIBITM_CHECK_64BIT_SYNC_BUILTINS\n LIBITM_CHECK_AS_AVX\n+LIBITM_CHECK_AS_RTM\n \n GCC_CHECK_ELF_STYLE_WEAKREF\n "}, {"sha": "a6db6aa9027613294b80febd3455122439ca7563", "filename": "libitm/testsuite/Makefile.in", "status": "modified", "additions": 3, "deletions": 36, "changes": 39, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/07d3b5c8c0d446ffb57d73d821dcf8156b12bf5d/libitm%2Ftestsuite%2FMakefile.in", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/07d3b5c8c0d446ffb57d73d821dcf8156b12bf5d/libitm%2Ftestsuite%2FMakefile.in", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libitm%2Ftestsuite%2FMakefile.in?ref=07d3b5c8c0d446ffb57d73d821dcf8156b12bf5d", "patch": "@@ -35,7 +35,7 @@ build_triplet = @build@\n host_triplet = @host@\n target_triplet = @target@\n subdir = testsuite\n-DIST_COMMON = $(srcdir)/Makefile.am $(srcdir)/Makefile.in\n+DIST_COMMON = $(srcdir)/Makefile.in $(srcdir)/Makefile.am\n ACLOCAL_M4 = $(top_srcdir)/aclocal.m4\n am__aclocal_m4_deps = $(top_srcdir)/../config/acx.m4 \\\n \t$(top_srcdir)/../config/asmcfi.m4 \\\n@@ -60,10 +60,8 @@ CONFIG_HEADER = $(top_builddir)/config.h\n CONFIG_CLEAN_FILES =\n CONFIG_CLEAN_VPATH_FILES =\n SOURCES =\n-DIST_SOURCES =\n DEJATOOL = $(PACKAGE)\n RUNTESTDEFAULTFLAGS = --tool $$tool --srcdir $$srcdir\n-DISTFILES = $(DIST_COMMON) $(DIST_SOURCES) $(TEXINFOS) $(EXTRA_DIST)\n ACLOCAL = @ACLOCAL@\n AMTAR = @AMTAR@\n AR = @AR@\n@@ -295,37 +293,6 @@ distclean-DEJAGNU:\n \t-l='$(DEJATOOL)'; for tool in $$l; do \\\n \t  rm -f $$tool.sum $$tool.log; \\\n \tdone\n-\n-distdir: $(DISTFILES)\n-\t@srcdirstrip=`echo \"$(srcdir)\" | sed 's/[].[^$$\\\\*]/\\\\\\\\&/g'`; \\\n-\ttopsrcdirstrip=`echo \"$(top_srcdir)\" | sed 's/[].[^$$\\\\*]/\\\\\\\\&/g'`; \\\n-\tlist='$(DISTFILES)'; \\\n-\t  dist_files=`for file in $$list; do echo $$file; done | \\\n-\t  sed -e \"s|^$$srcdirstrip/||;t\" \\\n-\t      -e \"s|^$$topsrcdirstrip/|$(top_builddir)/|;t\"`; \\\n-\tcase $$dist_files in \\\n-\t  */*) $(MKDIR_P) `echo \"$$dist_files\" | \\\n-\t\t\t   sed '/\\//!d;s|^|$(distdir)/|;s,/[^/]*$$,,' | \\\n-\t\t\t   sort -u` ;; \\\n-\tesac; \\\n-\tfor file in $$dist_files; do \\\n-\t  if test -f $$file || test -d $$file; then d=.; else d=$(srcdir); fi; \\\n-\t  if test -d $$d/$$file; then \\\n-\t    dir=`echo \"/$$file\" | sed -e 's,/[^/]*$$,,'`; \\\n-\t    if test -d \"$(distdir)/$$file\"; then \\\n-\t      find \"$(distdir)/$$file\" -type d ! -perm -700 -exec chmod u+rwx {} \\;; \\\n-\t    fi; \\\n-\t    if test -d $(srcdir)/$$file && test $$d != $(srcdir); then \\\n-\t      cp -fpR $(srcdir)/$$file \"$(distdir)$$dir\" || exit 1; \\\n-\t      find \"$(distdir)/$$file\" -type d ! -perm -700 -exec chmod u+rwx {} \\;; \\\n-\t    fi; \\\n-\t    cp -fpR $$d/$$file \"$(distdir)$$dir\" || exit 1; \\\n-\t  else \\\n-\t    test -f \"$(distdir)/$$file\" \\\n-\t    || cp -p $$d/$$file \"$(distdir)/$$file\" \\\n-\t    || exit 1; \\\n-\t  fi; \\\n-\tdone\n check-am: all-am\n \t$(MAKE) $(AM_MAKEFLAGS) check-DEJAGNU\n check: check-am\n@@ -426,8 +393,8 @@ uninstall-am:\n \n .PHONY: all all-am check check-DEJAGNU check-am clean clean-generic \\\n \tclean-libtool distclean distclean-DEJAGNU distclean-generic \\\n-\tdistclean-libtool distdir dvi dvi-am html html-am info info-am \\\n-\tinstall install-am install-data install-data-am install-dvi \\\n+\tdistclean-libtool dvi dvi-am html html-am info info-am install \\\n+\tinstall-am install-data install-data-am install-dvi \\\n \tinstall-dvi-am install-exec install-exec-am install-html \\\n \tinstall-html-am install-info install-info-am install-man \\\n \tinstall-pdf install-pdf-am install-ps install-ps-am \\"}]}