{"sha": "c740732f62c3784700fa3d819af4f408f768dd48", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6Yzc0MDczMmY2MmMzNzg0NzAwZmEzZDgxOWFmNGY0MDhmNzY4ZGQ0OA==", "commit": {"author": {"name": "Mark Mitchell", "email": "mark@codesourcery.com", "date": "2002-04-13T01:25:27Z"}, "committer": {"name": "Mark Mitchell", "email": "mmitchel@gcc.gnu.org", "date": "2002-04-13T01:25:27Z"}, "message": "Revert these changes:\n\n\t2002-04-06  Mark Mitchell  <mark@codesourcery.com>\n\n\tPR c++/5571\n\t* stor-layout.c (layout_decl): Reset the RTL for the decl.\n\n\t* decl.c (duplicate_decls): Do not copy the RTL for a variable\n\tdeclaration if the old variable had an incomplete type and the new\n\tvariable does not.\n\t(complete_vars): Do not call layout_decl for completed variables.\n\nFrom-SVN: r52258", "tree": {"sha": "de6cd1c98fbd33ee4be0c84964ac99948d1aa96f", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/de6cd1c98fbd33ee4be0c84964ac99948d1aa96f"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/c740732f62c3784700fa3d819af4f408f768dd48", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/c740732f62c3784700fa3d819af4f408f768dd48", "html_url": "https://github.com/Rust-GCC/gccrs/commit/c740732f62c3784700fa3d819af4f408f768dd48", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/c740732f62c3784700fa3d819af4f408f768dd48/comments", "author": null, "committer": null, "parents": [{"sha": "21b1475254f8b4511bdd9f4ffcff9c07a141c77d", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/21b1475254f8b4511bdd9f4ffcff9c07a141c77d", "html_url": "https://github.com/Rust-GCC/gccrs/commit/21b1475254f8b4511bdd9f4ffcff9c07a141c77d"}], "stats": {"total": 43, "additions": 30, "deletions": 13}, "files": [{"sha": "86df46da773346bd3f457335be438ca634194bf1", "filename": "gcc/ChangeLog", "status": "modified", "additions": 9, "deletions": 0, "changes": 9, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/c740732f62c3784700fa3d819af4f408f768dd48/gcc%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/c740732f62c3784700fa3d819af4f408f768dd48/gcc%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2FChangeLog?ref=c740732f62c3784700fa3d819af4f408f768dd48", "patch": "@@ -1,3 +1,12 @@\n+2002-04-12  Mark Mitchell  <mark@codesourcery.com>\n+\n+\tRevert these changes:\n+\n+\t2002-04-06  Mark Mitchell  <mark@codesourcery.com>\n+\n+\tPR c++/5571\n+\t* stor-layout.c (layout_decl): Reset the RTL for the decl.\n+\n 2002-04-12  Richard Henderson  <rth@redhat.com>\n \n \t* config.gcc (sparcv9-*-solaris2): Default to 32-bit code."}, {"sha": "c075ed0f1b103dad31e022687c3c1e801bb60eeb", "filename": "gcc/cp/ChangeLog", "status": "modified", "additions": 7, "deletions": 0, "changes": 7, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/c740732f62c3784700fa3d819af4f408f768dd48/gcc%2Fcp%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/c740732f62c3784700fa3d819af4f408f768dd48/gcc%2Fcp%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fcp%2FChangeLog?ref=c740732f62c3784700fa3d819af4f408f768dd48", "patch": "@@ -1,3 +1,10 @@\n+2002-04-12  Mark Mitchell  <mark@codesourcery.com>\n+\n+\t* decl.c (duplicate_decls): Do not copy the RTL for a variable\n+\tdeclaration if the old variable had an incomplete type and the new\n+\tvariable does not.\n+\t(complete_vars): Do not call layout_decl for completed variables.\n+\n 2002-04-12  Richard Sandiford  <rsandifo@redhat.com>\n \n \t* decl.c (duplicate_decls): Don't try to unify an implicit typedef"}, {"sha": "721cd63d414a365289444341c8a401721066c0ee", "filename": "gcc/cp/decl.c", "status": "modified", "additions": 14, "deletions": 8, "changes": 22, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/c740732f62c3784700fa3d819af4f408f768dd48/gcc%2Fcp%2Fdecl.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/c740732f62c3784700fa3d819af4f408f768dd48/gcc%2Fcp%2Fdecl.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fcp%2Fdecl.c?ref=c740732f62c3784700fa3d819af4f408f768dd48", "patch": "@@ -3610,15 +3610,23 @@ duplicate_decls (newdecl, olddecl)\n       if (DECL_SECTION_NAME (newdecl) == NULL_TREE)\n \tDECL_SECTION_NAME (newdecl) = DECL_SECTION_NAME (olddecl);\n \n-      /* Keep the old rtl since we can safely use it.  */\n-      COPY_DECL_RTL (olddecl, newdecl);\n-\n       if (TREE_CODE (newdecl) == FUNCTION_DECL)\n \t{\n \t  DECL_NO_INSTRUMENT_FUNCTION_ENTRY_EXIT (newdecl)\n \t    |= DECL_NO_INSTRUMENT_FUNCTION_ENTRY_EXIT (olddecl);\n \t  DECL_NO_LIMIT_STACK (newdecl)\n \t    |= DECL_NO_LIMIT_STACK (olddecl);\n+\t  /* Keep the old RTL.  */\n+\t  COPY_DECL_RTL (olddecl, newdecl);\n+\t}\n+      else if (TREE_CODE (newdecl) == VAR_DECL \n+\t       && (DECL_SIZE (olddecl) || !DECL_SIZE (newdecl)))\n+\t{\n+\t  /* Keep the old RTL.  We cannot keep the old RTL if the old\n+\t     declaration was for an incomplete object and the new\n+\t     declaration is not since many attributes of the RTL will\n+\t     change.  */\n+\t  COPY_DECL_RTL (olddecl, newdecl);\n \t}\n     }\n   /* If cannot merge, then use the new type and qualifiers,\n@@ -14529,11 +14537,9 @@ complete_vars (type)\n       if (same_type_p (type, TREE_PURPOSE (*list)))\n \t{\n \t  tree var = TREE_VALUE (*list);\n-\t  /* Make sure that the type of the VAR has been laid out.  It\n-\t     might not have been if the type of VAR is an array.  */\n-\t  layout_type (TREE_TYPE (var));\n-\t  /* Lay out the variable itself.  */\n-\t  layout_decl (var, 0);\n+\t  /* Complete the type of the variable.  The VAR_DECL itself\n+\t     will be laid out in expand_expr.  */\n+\t  complete_type (TREE_TYPE (var));\n \t  /* Remove this entry from the list.  */\n \t  *list = TREE_CHAIN (*list);\n \t}"}, {"sha": "baf26dddba1ac6ffae37f0ff14621490f1499a09", "filename": "gcc/stor-layout.c", "status": "modified", "additions": 0, "deletions": 5, "changes": 5, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/c740732f62c3784700fa3d819af4f408f768dd48/gcc%2Fstor-layout.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/c740732f62c3784700fa3d819af4f408f768dd48/gcc%2Fstor-layout.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fstor-layout.c?ref=c740732f62c3784700fa3d819af4f408f768dd48", "patch": "@@ -461,11 +461,6 @@ layout_decl (decl, known_align)\n \t\t\t       larger_than_size);\n \t}\n     }\n-\n-  /* If there was already RTL for this DECL, as for a variable with an\n-     incomplete type whose type is completed later, update the RTL.  */\n-  if (DECL_RTL_SET_P (decl))\n-    make_decl_rtl (decl, NULL);\n }\n \f\n /* Hook for a front-end function that can modify the record layout as needed"}]}