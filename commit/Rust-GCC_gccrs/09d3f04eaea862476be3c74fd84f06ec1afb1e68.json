{"sha": "09d3f04eaea862476be3c74fd84f06ec1afb1e68", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6MDlkM2YwNGVhZWE4NjI0NzZiZTNjNzRmZDg0ZjA2ZWMxYWZiMWU2OA==", "commit": {"author": {"name": "Jan Hubicka", "email": "jh@suse.cz", "date": "2018-10-25T12:18:28Z"}, "committer": {"name": "Jan Hubicka", "email": "hubicka@gcc.gnu.org", "date": "2018-10-25T12:18:28Z"}, "message": "ipa-devirt.c (odr_types_equivalent_p): Do not ICE if one of types is anonymous.\n\n\n\t* ipa-devirt.c (odr_types_equivalent_p): Do not ICE if one of types\n\tis anonymous.\n\t* g++.dg/lto/odr-1_0.C: New test.\n\t* g++.dg/lto/odr-1_1.C: New test.\n\nFrom-SVN: r265484", "tree": {"sha": "237bd6c29959d29d83c737b92ba8bf346e4adb03", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/237bd6c29959d29d83c737b92ba8bf346e4adb03"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/09d3f04eaea862476be3c74fd84f06ec1afb1e68", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/09d3f04eaea862476be3c74fd84f06ec1afb1e68", "html_url": "https://github.com/Rust-GCC/gccrs/commit/09d3f04eaea862476be3c74fd84f06ec1afb1e68", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/09d3f04eaea862476be3c74fd84f06ec1afb1e68/comments", "author": null, "committer": null, "parents": [{"sha": "46ec9261008a118470c43d6b7eeb95e4c4b12e67", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/46ec9261008a118470c43d6b7eeb95e4c4b12e67", "html_url": "https://github.com/Rust-GCC/gccrs/commit/46ec9261008a118470c43d6b7eeb95e4c4b12e67"}], "stats": {"total": 38, "additions": 38, "deletions": 0}, "files": [{"sha": "2490eef47a540566329311041fe8e7c48fdddb9f", "filename": "gcc/ChangeLog", "status": "modified", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/09d3f04eaea862476be3c74fd84f06ec1afb1e68/gcc%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/09d3f04eaea862476be3c74fd84f06ec1afb1e68/gcc%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2FChangeLog?ref=09d3f04eaea862476be3c74fd84f06ec1afb1e68", "patch": "@@ -1,3 +1,8 @@\n+2018-10-25  Jan Hubicka  <jh@suse.cz>\n+\n+\t* ipa-devirt.c (odr_types_equivalent_p): Do not ICE if one of types\n+\tis anonymous.\n+\n 2018-10-25  Richard Biener  <rguenther@suse.de>\n \n \tPR tree-optimization/87665"}, {"sha": "466b61e5513c9e9970276a7b2f2603d4bd7fcb91", "filename": "gcc/ipa-devirt.c", "status": "modified", "additions": 7, "deletions": 0, "changes": 7, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/09d3f04eaea862476be3c74fd84f06ec1afb1e68/gcc%2Fipa-devirt.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/09d3f04eaea862476be3c74fd84f06ec1afb1e68/gcc%2Fipa-devirt.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fipa-devirt.c?ref=09d3f04eaea862476be3c74fd84f06ec1afb1e68", "patch": "@@ -1265,6 +1265,13 @@ odr_types_equivalent_p (tree t1, tree t2, bool warn, bool *warned,\n   /* Check first for the obvious case of pointer identity.  */\n   if (t1 == t2)\n     return true;\n+  if ((type_with_linkage_p (t1) && type_in_anonymous_namespace_p (t1))\n+      != (type_with_linkage_p (t2) && type_in_anonymous_namespace_p (t2)))\n+    {\n+      warn_odr (t1, t2, NULL, NULL, warn, warned,\n+\t        G_(\"one of types is in anonymous namespace while other is not\"));\n+      return false;\n+    }\n   gcc_assert (!type_with_linkage_p (t1) || !type_in_anonymous_namespace_p (t1));\n   gcc_assert (!type_with_linkage_p (t2) || !type_in_anonymous_namespace_p (t2));\n "}, {"sha": "cdda13204d3ed649cbd3b38a1e560a1841c94866", "filename": "gcc/testsuite/ChangeLog", "status": "modified", "additions": 6, "deletions": 0, "changes": 6, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/09d3f04eaea862476be3c74fd84f06ec1afb1e68/gcc%2Ftestsuite%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/09d3f04eaea862476be3c74fd84f06ec1afb1e68/gcc%2Ftestsuite%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2FChangeLog?ref=09d3f04eaea862476be3c74fd84f06ec1afb1e68", "patch": "@@ -1,5 +1,11 @@\n+2018-10-25  Jan Hubicka  <jh@suse.cz>\n+\n+\t* g++.dg/lto/odr-1_0.C: New test.\n+\t* g++.dg/lto/odr-1_1.C: New test.\n+\n 2018-10-25  Thomas Preud'homme  <thomas.preudhomme@linaro.org>\n \n+\n \t* gcc.dg/sibcall-9.c: Make v static.\n \t* gcc.dg/sibcall-10.c: Likewise.\n "}, {"sha": "c59f169e4dc5f40a2255548d8ed16a967b3c0f0a", "filename": "gcc/testsuite/g++.dg/lto/odr-1_0.C", "status": "added", "additions": 8, "deletions": 0, "changes": 8, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/09d3f04eaea862476be3c74fd84f06ec1afb1e68/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Flto%2Fodr-1_0.C", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/09d3f04eaea862476be3c74fd84f06ec1afb1e68/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Flto%2Fodr-1_0.C", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Flto%2Fodr-1_0.C?ref=09d3f04eaea862476be3c74fd84f06ec1afb1e68", "patch": "@@ -0,0 +1,8 @@\n+// PR c++/82414\n+// { dg-lto-do link }\n+struct a { // { dg-lto-warning \"8: type 'struct a' violates the C\\\\+\\\\+ One Definition Rule\" }\n+  struct b *ptr; // { dg-lto-message \"13: the first difference of corresponding definitions is field 'ptr'\" }\n+};\n+void test(struct a *) // { dg-lto-warning \"6: warning: 'test' violates the C++ One Definition Rule\" }\n+{\n+}"}, {"sha": "5cd6f6c0ebc3cb79fd042d21d07bdd91d5928e57", "filename": "gcc/testsuite/g++.dg/lto/odr-1_1.C", "status": "added", "additions": 12, "deletions": 0, "changes": 12, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/09d3f04eaea862476be3c74fd84f06ec1afb1e68/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Flto%2Fodr-1_1.C", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/09d3f04eaea862476be3c74fd84f06ec1afb1e68/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Flto%2Fodr-1_1.C", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Flto%2Fodr-1_1.C?ref=09d3f04eaea862476be3c74fd84f06ec1afb1e68", "patch": "@@ -0,0 +1,12 @@\n+namespace {\n+  struct b;\n+ }\n+struct a {\n+  struct b *ptr;\n+};\n+void test(struct a *);\n+int\n+main(void)\n+{\n+  test (0);\n+}"}]}