{"sha": "436a956a80a5b083348ce9c336b59ae04f883f2e", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6NDM2YTk1NmE4MGE1YjA4MzM0OGNlOWMzMzZiNTlhZTA0Zjg4M2YyZQ==", "commit": {"author": {"name": "Andrey Belevantsev", "email": "abel@ispras.ru", "date": "2013-02-27T08:56:08Z"}, "committer": {"name": "Andrey Belevantsev", "email": "abel@gcc.gnu.org", "date": "2013-02-27T08:56:08Z"}, "message": "re PR middle-end/45472 ([Middle-end volatile semantics] ICE: in move_op_ascend, at sel-sched.c:6124 with -fselective-scheduling2)\n\n        PR middle-end/45472\n\n\tgcc/\n        * sel-sched-ir.c (merge_expr): Also change vinsn of merged expr\n        when the may_trap_p bit of the exprs being merged differs.\n\n        Reorder tests for speculativeness in the logical and operator.\n\n\ttestsuite/\n\t* gcc.dg/45472.c: New test.\n\nFrom-SVN: r196308", "tree": {"sha": "9ce85787bc76ebf33091259846b485916408196d", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/9ce85787bc76ebf33091259846b485916408196d"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/436a956a80a5b083348ce9c336b59ae04f883f2e", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/436a956a80a5b083348ce9c336b59ae04f883f2e", "html_url": "https://github.com/Rust-GCC/gccrs/commit/436a956a80a5b083348ce9c336b59ae04f883f2e", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/436a956a80a5b083348ce9c336b59ae04f883f2e/comments", "author": {"login": "abonzo", "id": 20396542, "node_id": "MDQ6VXNlcjIwMzk2NTQy", "avatar_url": "https://avatars.githubusercontent.com/u/20396542?v=4", "gravatar_id": "", "url": "https://api.github.com/users/abonzo", "html_url": "https://github.com/abonzo", "followers_url": "https://api.github.com/users/abonzo/followers", "following_url": "https://api.github.com/users/abonzo/following{/other_user}", "gists_url": "https://api.github.com/users/abonzo/gists{/gist_id}", "starred_url": "https://api.github.com/users/abonzo/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/abonzo/subscriptions", "organizations_url": "https://api.github.com/users/abonzo/orgs", "repos_url": "https://api.github.com/users/abonzo/repos", "events_url": "https://api.github.com/users/abonzo/events{/privacy}", "received_events_url": "https://api.github.com/users/abonzo/received_events", "type": "User", "site_admin": false}, "committer": null, "parents": [{"sha": "0fcb564b72f58f8d3fa3351fbad33d32b63697ca", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/0fcb564b72f58f8d3fa3351fbad33d32b63697ca", "html_url": "https://github.com/Rust-GCC/gccrs/commit/0fcb564b72f58f8d3fa3351fbad33d32b63697ca"}], "stats": {"total": 43, "additions": 41, "deletions": 2}, "files": [{"sha": "61ea5212119f5692da4eded339414e6951ee2f61", "filename": "gcc/ChangeLog", "status": "modified", "additions": 9, "deletions": 0, "changes": 9, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/436a956a80a5b083348ce9c336b59ae04f883f2e/gcc%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/436a956a80a5b083348ce9c336b59ae04f883f2e/gcc%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2FChangeLog?ref=436a956a80a5b083348ce9c336b59ae04f883f2e", "patch": "@@ -1,3 +1,12 @@\n+2013-02-27  Andrey Belevantsev  <abel@ispras.ru>\n+\n+\tPR middle-end/45472\n+\t\n+\t* sel-sched-ir.c (merge_expr): Also change vinsn of merged expr\n+\twhen the may_trap_p bit of the exprs being merged differs.\n+\n+\tReorder tests for speculativeness in the logical and operator.\n+\n 2013-02-27  Jakub Jelinek  <jakub@redhat.com>\n \n \t* incpath.c (add_standard_paths): Use reconcat instead of concat"}, {"sha": "ae17351b5956b03e23aa2be384ca7e1af6a545cf", "filename": "gcc/sel-sched-ir.c", "status": "modified", "additions": 6, "deletions": 2, "changes": 8, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/436a956a80a5b083348ce9c336b59ae04f883f2e/gcc%2Fsel-sched-ir.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/436a956a80a5b083348ce9c336b59ae04f883f2e/gcc%2Fsel-sched-ir.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fsel-sched-ir.c?ref=436a956a80a5b083348ce9c336b59ae04f883f2e", "patch": "@@ -1866,8 +1866,12 @@ merge_expr (expr_t to, expr_t from, insn_t split_point)\n   /* Make sure that speculative pattern is propagated into exprs that\n      have non-speculative one.  This will provide us with consistent\n      speculative bits and speculative patterns inside expr.  */\n-  if (EXPR_SPEC_DONE_DS (to) == 0\n-      && EXPR_SPEC_DONE_DS (from) != 0)\n+  if ((EXPR_SPEC_DONE_DS (from) != 0\n+       && EXPR_SPEC_DONE_DS (to) == 0)\n+      /* Do likewise for volatile insns, so that we always retain\n+\t the may_trap_p bit on the resulting expression.  */\n+      || (VINSN_MAY_TRAP_P (EXPR_VINSN (from))\n+\t  && !VINSN_MAY_TRAP_P (EXPR_VINSN (to))))\n     change_vinsn_in_expr (to, EXPR_VINSN (from));\n \n   merge_expr_data (to, from, split_point);"}, {"sha": "20e9673121fb75812141312b5d6a1f9b77cf1229", "filename": "gcc/testsuite/ChangeLog", "status": "modified", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/436a956a80a5b083348ce9c336b59ae04f883f2e/gcc%2Ftestsuite%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/436a956a80a5b083348ce9c336b59ae04f883f2e/gcc%2Ftestsuite%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2FChangeLog?ref=436a956a80a5b083348ce9c336b59ae04f883f2e", "patch": "@@ -1,3 +1,8 @@\n+2013-02-27  Andrey Belevantsev  <abel@ispras.ru>\n+\n+\tPR middle-end/45472\n+\t* gcc.dg/pr45472.c: New test.\n+\n 2013-02-26  Marek Polacek  <polacek@redhat.com>\n \n \tPR tree-optimization/56426"}, {"sha": "573e83d700c02ab2a346f88f94beab2b06d14100", "filename": "gcc/testsuite/gcc.dg/pr45472.c", "status": "added", "additions": 21, "deletions": 0, "changes": 21, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/436a956a80a5b083348ce9c336b59ae04f883f2e/gcc%2Ftestsuite%2Fgcc.dg%2Fpr45472.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/436a956a80a5b083348ce9c336b59ae04f883f2e/gcc%2Ftestsuite%2Fgcc.dg%2Fpr45472.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgcc.dg%2Fpr45472.c?ref=436a956a80a5b083348ce9c336b59ae04f883f2e", "patch": "@@ -0,0 +1,21 @@\n+/* { dg-do compile { target powerpc*-*-* ia64-*-* x86_64-*-* } } */\n+/* { dg-options \"-O -fschedule-insns2 -fselective-scheduling2\" } */\n+\n+struct S\n+{\n+  volatile long vl;\n+  int i;\n+};\n+struct S s1, s2;\n+\n+void\n+foo (int j, int c)\n+{\n+  int i;\n+  for (i = 0; i <= j; i++)\n+    {\n+      if (c)\n+\ts2.vl += s1.vl;\n+      s1 = s2;\n+    }\n+}"}]}