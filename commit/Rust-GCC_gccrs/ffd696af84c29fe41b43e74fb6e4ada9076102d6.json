{"sha": "ffd696af84c29fe41b43e74fb6e4ada9076102d6", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6ZmZkNjk2YWY4NGMyOWZlNDFiNDNlNzRmYjZlNGFkYTkwNzYxMDJkNg==", "commit": {"author": {"name": "Jason Merrill", "email": "jason@redhat.com", "date": "2002-03-18T11:24:24Z"}, "committer": {"name": "Jason Merrill", "email": "jason@gcc.gnu.org", "date": "2002-03-18T11:24:24Z"}, "message": "PR c++/3948 -- C++ ABI change, followup to 2001-12-18 patch.\n\n        * class.c (finish_struct_bits): Also set TREE_ADDRESSABLE for a\n        type with a nontrivial destructor.\n\nFrom-SVN: r50959", "tree": {"sha": "acc35e62bb34fcb06c3819084139135516383189", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/acc35e62bb34fcb06c3819084139135516383189"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/ffd696af84c29fe41b43e74fb6e4ada9076102d6", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/ffd696af84c29fe41b43e74fb6e4ada9076102d6", "html_url": "https://github.com/Rust-GCC/gccrs/commit/ffd696af84c29fe41b43e74fb6e4ada9076102d6", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/ffd696af84c29fe41b43e74fb6e4ada9076102d6/comments", "author": {"login": "jicama", "id": 266146, "node_id": "MDQ6VXNlcjI2NjE0Ng==", "avatar_url": "https://avatars.githubusercontent.com/u/266146?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jicama", "html_url": "https://github.com/jicama", "followers_url": "https://api.github.com/users/jicama/followers", "following_url": "https://api.github.com/users/jicama/following{/other_user}", "gists_url": "https://api.github.com/users/jicama/gists{/gist_id}", "starred_url": "https://api.github.com/users/jicama/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jicama/subscriptions", "organizations_url": "https://api.github.com/users/jicama/orgs", "repos_url": "https://api.github.com/users/jicama/repos", "events_url": "https://api.github.com/users/jicama/events{/privacy}", "received_events_url": "https://api.github.com/users/jicama/received_events", "type": "User", "site_admin": false}, "committer": null, "parents": [{"sha": "38cb4e84073fecc93460df13daf98f3ad3f72b98", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/38cb4e84073fecc93460df13daf98f3ad3f72b98", "html_url": "https://github.com/Rust-GCC/gccrs/commit/38cb4e84073fecc93460df13daf98f3ad3f72b98"}], "stats": {"total": 46, "additions": 42, "deletions": 4}, "files": [{"sha": "8fc4c80c3e7b275b4805564f9ae9dc6a8a6ecb1e", "filename": "gcc/cp/ChangeLog", "status": "modified", "additions": 6, "deletions": 0, "changes": 6, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/ffd696af84c29fe41b43e74fb6e4ada9076102d6/gcc%2Fcp%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/ffd696af84c29fe41b43e74fb6e4ada9076102d6/gcc%2Fcp%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fcp%2FChangeLog?ref=ffd696af84c29fe41b43e74fb6e4ada9076102d6", "patch": "@@ -1,3 +1,9 @@\n+2002-03-18  Jason Merrill  <jason@redhat.com>\n+\n+\tPR c++/3948 -- C++ ABI change, followup to 2001-12-18 patch.\n+\t* class.c (finish_struct_bits): Also set TREE_ADDRESSABLE for a\n+\ttype with a nontrivial destructor.\n+\n 2002-03-17  Jason Merrill  <jason@redhat.com>\n \n \tPR c++/4460"}, {"sha": "1c0c526ecb82df46705e153fb141472d69561696", "filename": "gcc/cp/class.c", "status": "modified", "additions": 5, "deletions": 4, "changes": 9, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/ffd696af84c29fe41b43e74fb6e4ada9076102d6/gcc%2Fcp%2Fclass.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/ffd696af84c29fe41b43e74fb6e4ada9076102d6/gcc%2Fcp%2Fclass.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fcp%2Fclass.c?ref=ffd696af84c29fe41b43e74fb6e4ada9076102d6", "patch": "@@ -1879,15 +1879,16 @@ finish_struct_bits (t)\n \t}\n     }\n \n-  /* If this type has a copy constructor, force its mode to be BLKmode, and\n-     force its TREE_ADDRESSABLE bit to be nonzero.  This will cause it to\n-     be passed by invisible reference and prevent it from being returned in\n-     a register.\n+  /* If this type has a copy constructor or a destructor, force its mode to\n+     be BLKmode, and force its TREE_ADDRESSABLE bit to be nonzero.  This\n+     will cause it to be passed by invisible reference and prevent it from\n+     being returned in a register.\n \n      Also do this if the class has BLKmode but can still be returned in\n      registers, since function_cannot_inline_p won't let us inline\n      functions returning such a type.  This affects the HP-PA.  */\n   if (! TYPE_HAS_TRIVIAL_INIT_REF (t)\n+      || TYPE_HAS_NONTRIVIAL_DESTRUCTOR (t)\n       || (TYPE_MODE (t) == BLKmode && ! aggregate_value_p (t)\n \t  && CLASSTYPE_NON_AGGREGATE (t)))\n     {"}, {"sha": "86c6e46830d3d6938266f5eae9a634d4b0886315", "filename": "gcc/testsuite/g++.dg/init/byval1.C", "status": "added", "additions": 31, "deletions": 0, "changes": 31, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/ffd696af84c29fe41b43e74fb6e4ada9076102d6/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Finit%2Fbyval1.C", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/ffd696af84c29fe41b43e74fb6e4ada9076102d6/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Finit%2Fbyval1.C", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Finit%2Fbyval1.C?ref=ffd696af84c29fe41b43e74fb6e4ada9076102d6", "patch": "@@ -0,0 +1,31 @@\n+// PR c++/3948\n+// Test that the destructor call for a value parameter gets the\n+// right address.\n+\n+// { dg-do run }\n+\n+void *p[2];\n+int i;\n+int r;\n+\n+struct C\n+{\n+  int m;\n+  \n+  C() { p[i++] = this; }\n+  ~C() { if (p[--i] != this) r = 1; }\n+};\n+\n+\n+void Foo (C c)\n+{\n+  p[i++] = &c;\n+}\n+\n+int main ()\n+{       \n+  C c;\n+\n+  Foo (c);\n+  return r;\n+}"}]}