{"sha": "3b2288059d786fc6994debbaffeff898746a6921", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6M2IyMjg4MDU5ZDc4NmZjNjk5NGRlYmJhZmZlZmY4OTg3NDZhNjkyMQ==", "commit": {"author": {"name": "Scott Gilbertson", "email": "scottg@mantatest.com", "date": "2003-04-19T17:52:15Z"}, "committer": {"name": "Tom Tromey", "email": "tromey@gcc.gnu.org", "date": "2003-04-19T17:52:15Z"}, "message": "natFont.cc (getStringWidth): Support 16-bit characters.\n\n2003-04-19  Scott Gilbertson  <scottg@mantatest.com>\n\n\t* libjava/gnu/gcj/xlib/natFont.cc (getStringWidth): Support 16-bit\n\tcharacters.\n\t* libjava/gnu/gcj/xlib/natGC.cc (drawString): Support 16-bit\n\tcharacters.\n\nFrom-SVN: r65820", "tree": {"sha": "88edbc8c34db0ddffa450851b60525991825b273", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/88edbc8c34db0ddffa450851b60525991825b273"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/3b2288059d786fc6994debbaffeff898746a6921", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/3b2288059d786fc6994debbaffeff898746a6921", "html_url": "https://github.com/Rust-GCC/gccrs/commit/3b2288059d786fc6994debbaffeff898746a6921", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/3b2288059d786fc6994debbaffeff898746a6921/comments", "author": null, "committer": null, "parents": [{"sha": "6f572ac2297814f19a9889bf5797a67b12d2f353", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/6f572ac2297814f19a9889bf5797a67b12d2f353", "html_url": "https://github.com/Rust-GCC/gccrs/commit/6f572ac2297814f19a9889bf5797a67b12d2f353"}], "stats": {"total": 67, "additions": 40, "deletions": 27}, "files": [{"sha": "d91604be9c0b5128deada1bbe84a40f2cc5f6456", "filename": "libjava/ChangeLog", "status": "modified", "additions": 7, "deletions": 0, "changes": 7, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/3b2288059d786fc6994debbaffeff898746a6921/libjava%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/3b2288059d786fc6994debbaffeff898746a6921/libjava%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libjava%2FChangeLog?ref=3b2288059d786fc6994debbaffeff898746a6921", "patch": "@@ -1,3 +1,10 @@\n+2003-04-19  Scott Gilbertson  <scottg@mantatest.com>\n+\n+\t* libjava/gnu/gcj/xlib/natFont.cc (getStringWidth): Support 16-bit\n+\tcharacters.\n+\t* libjava/gnu/gcj/xlib/natGC.cc (drawString): Support 16-bit\n+\tcharacters.\n+\n 2003-04-16  Richard Earnshaw  <rearnsha@arm.com>\n \n \t* java/lang/ieeefp.h: Handle ARM platforms that have pure-endian"}, {"sha": "0f8f43dc509a77ffc6af94caec16e4637e356932", "filename": "libjava/gnu/gcj/xlib/natFont.cc", "status": "modified", "additions": 16, "deletions": 8, "changes": 24, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/3b2288059d786fc6994debbaffeff898746a6921/libjava%2Fgnu%2Fgcj%2Fxlib%2FnatFont.cc", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/3b2288059d786fc6994debbaffeff898746a6921/libjava%2Fgnu%2Fgcj%2Fxlib%2FnatFont.cc", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libjava%2Fgnu%2Fgcj%2Fxlib%2FnatFont.cc?ref=3b2288059d786fc6994debbaffeff898746a6921", "patch": "@@ -1,4 +1,4 @@\n-/* Copyright (C) 2000  Free Software Foundation\n+/* Copyright (C) 2000, 2003  Free Software Foundation\n \n    This file is part of libgcj.\n \n@@ -69,13 +69,21 @@ jint gnu::gcj::xlib::Font::getStringWidth(java::lang::String* text)\n {\n   XFontStruct* fontStruct = (XFontStruct*) structure;\n   \n-  // FIXME: make proper unicode conversion\n-  int len = JvGetStringUTFLength(text);\n-  char ctxt[len+1];\n-  JvGetStringUTFRegion(text, 0, text->length(), ctxt);\n-  ctxt[len] = '\\0';\n-  int width = XTextWidth(fontStruct, ctxt, len);\n-  return width;\n+  // FIXME: Convert to the character set used in the font, which may\n+  // or may not be unicode. For now, treat everything as 16-bit and\n+  // use character codes directly, which should be OK for unicode or\n+  // 8-bit ascii fonts.\n+  jint length = text->length();\n+  jchar* txt = JvGetStringChars(text);\n+  XChar2b xwchars[length];\n+  for (int i=0; i<length; i++)\n+    {\n+      XChar2b* xc = &(xwchars[i]);\n+      jchar jc = txt[i];\n+      xc->byte1 = (jc >> 8) & 0xff;\n+      xc->byte2 = jc & 0xff;\n+    }\n+  return XTextWidth16(fontStruct, xwchars, length);\n }\n \n void gnu::gcj::xlib::Font::finalize()"}, {"sha": "11f4b28f22bef62dc58d37f9f0bf2fb8d3a9f654", "filename": "libjava/gnu/gcj/xlib/natGC.cc", "status": "modified", "additions": 17, "deletions": 19, "changes": 36, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/3b2288059d786fc6994debbaffeff898746a6921/libjava%2Fgnu%2Fgcj%2Fxlib%2FnatGC.cc", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/3b2288059d786fc6994debbaffeff898746a6921/libjava%2Fgnu%2Fgcj%2Fxlib%2FnatGC.cc", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libjava%2Fgnu%2Fgcj%2Fxlib%2FnatGC.cc?ref=3b2288059d786fc6994debbaffeff898746a6921", "patch": "@@ -95,27 +95,25 @@ void gnu::gcj::xlib::GC::drawString(jstring text, jint x, jint y)\n   ::Drawable drawableXID = target->getXID();\n   ::GC gc = (::GC) structure;\n   \n-  /*\n-    FIXME: do something along the lines of the following instead:\n+  jint length = text->length();\n+  jchar* txt = JvGetStringChars(text);\n \n-    jint length = text->length();\n-    jchar* txt = JvGetStringChars(text);\n-\n-    XChar2b xwchars[length];\n+  XChar2b xwchars[length];\n     \n-    // FIXME: Add convertion and caching\n-\n-    for (int i=0; i<length; i++)\n-      {\n-\tXChar2b* xc = &(xwchars[i]);\n-\tjchar jc = txt[i];\n-\txc->byte1 = jc & 0xff;\n-\txc->byte2 = jc >> 8;\n-      }\n-\n-     XDrawString16(dpy, drawableXID, gc, x, y, xwchars, length);\n-    */\n-  \n+  // FIXME: Convert to the character set used in the font, which may\n+  // or may not be unicode. For now, treat everything as 16-bit and\n+  // use character codes directly, which should be OK for unicode or\n+  // 8-bit ascii fonts.\n+\n+  for (int i=0; i<length; i++)\n+    {\n+      XChar2b* xc = &(xwchars[i]);\n+      jchar jc = txt[i];\n+      xc->byte1 = (jc >> 8) & 0xff;\n+      xc->byte2 = jc & 0xff;\n+    }\n+  XDrawString16(dpy, drawableXID, gc, x, y, xwchars, length);\n+\n   // FIXME, temporary code:\n   int len = JvGetStringUTFLength(text);\n   char ctxt[len+1];"}]}