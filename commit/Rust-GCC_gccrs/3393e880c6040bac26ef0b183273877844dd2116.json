{"sha": "3393e880c6040bac26ef0b183273877844dd2116", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6MzM5M2U4ODBjNjA0MGJhYzI2ZWYwYjE4MzI3Mzg3Nzg0NGRkMjExNg==", "commit": {"author": {"name": "Maxim Kuvyrkov", "email": "maxim@codesourcery.com", "date": "2010-07-27T19:42:15Z"}, "committer": {"name": "Maxim Kuvyrkov", "email": "mkuvyrkov@gcc.gnu.org", "date": "2010-07-27T19:42:15Z"}, "message": "re PR target/42495 (redundant memory load)\n\n\tPR target/42495\n\tPR middle-end/42574\n\t* config/arm/arm.c (thumb1_size_rtx_costs): Add cost for \"J\" constants.\n\t* config/arm/arm.md (define_split \"J\", define_split \"K\"): Make\n\tIRA/reload friendly.\n\nFrom-SVN: r162594", "tree": {"sha": "dee58e9ff2060acd68d5e7305d5cb5da959a4079", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/dee58e9ff2060acd68d5e7305d5cb5da959a4079"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/3393e880c6040bac26ef0b183273877844dd2116", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/3393e880c6040bac26ef0b183273877844dd2116", "html_url": "https://github.com/Rust-GCC/gccrs/commit/3393e880c6040bac26ef0b183273877844dd2116", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/3393e880c6040bac26ef0b183273877844dd2116/comments", "author": null, "committer": null, "parents": [{"sha": "eae7938e451f9ec64ca8c1d8781ce4201560b314", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/eae7938e451f9ec64ca8c1d8781ce4201560b314", "html_url": "https://github.com/Rust-GCC/gccrs/commit/eae7938e451f9ec64ca8c1d8781ce4201560b314"}], "stats": {"total": 31, "additions": 24, "deletions": 7}, "files": [{"sha": "c06e7d585f2905c37ba10661ab806526bc9c0223", "filename": "gcc/ChangeLog", "status": "modified", "additions": 8, "deletions": 0, "changes": 8, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/3393e880c6040bac26ef0b183273877844dd2116/gcc%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/3393e880c6040bac26ef0b183273877844dd2116/gcc%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2FChangeLog?ref=3393e880c6040bac26ef0b183273877844dd2116", "patch": "@@ -1,3 +1,11 @@\n+2010-07-27  Maxim Kuvyrkov  <maxim@codesourcery.com>\n+\n+\tPR target/42495\n+\tPR middle-end/42574\n+\t* config/arm/arm.c (thumb1_size_rtx_costs): Add cost for \"J\" constants.\n+\t* config/arm/arm.md (define_split \"J\", define_split \"K\"): Make\n+\tIRA/reload friendly.\n+\n 2010-07-27  Maxim Kuvyrkov  <maxim@codesourcery.com>\n \n \t* gcse.c (insert_insn_end_basic_block): Update signature, remove"}, {"sha": "03c1506bd95d4367d488d6f6602dad649af7c684", "filename": "gcc/config/arm/arm.c", "status": "modified", "additions": 4, "deletions": 0, "changes": 4, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/3393e880c6040bac26ef0b183273877844dd2116/gcc%2Fconfig%2Farm%2Farm.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/3393e880c6040bac26ef0b183273877844dd2116/gcc%2Fconfig%2Farm%2Farm.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fconfig%2Farm%2Farm.c?ref=3393e880c6040bac26ef0b183273877844dd2116", "patch": "@@ -7003,6 +7003,10 @@ thumb1_size_rtx_costs (rtx x, enum rtx_code code, enum rtx_code outer)\n         {\n           if ((unsigned HOST_WIDE_INT) INTVAL (x) < 256)\n             return 0;\n+\t  /* See split \"TARGET_THUMB1 && satisfies_constraint_J\".  */\n+\t  if (INTVAL (x) >= -255 && INTVAL (x) <= -1)\n+            return COSTS_N_INSNS (2);\n+\t  /* See split \"TARGET_THUMB1 && satisfies_constraint_K\".  */\n           if (thumb_shiftable_const (INTVAL (x)))\n             return COSTS_N_INSNS (2);\n           return COSTS_N_INSNS (3);"}, {"sha": "5438b3c611a1eba46a1364502f44d0f0742e22f8", "filename": "gcc/config/arm/arm.md", "status": "modified", "additions": 12, "deletions": 7, "changes": 19, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/3393e880c6040bac26ef0b183273877844dd2116/gcc%2Fconfig%2Farm%2Farm.md", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/3393e880c6040bac26ef0b183273877844dd2116/gcc%2Fconfig%2Farm%2Farm.md", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fconfig%2Farm%2Farm.md?ref=3393e880c6040bac26ef0b183273877844dd2116", "patch": "@@ -5093,17 +5093,21 @@\n   [(set (match_operand:SI 0 \"register_operand\" \"\")\n \t(match_operand:SI 1 \"const_int_operand\" \"\"))]\n   \"TARGET_THUMB1 && satisfies_constraint_J (operands[1])\"\n-  [(set (match_dup 0) (match_dup 1))\n-   (set (match_dup 0) (neg:SI (match_dup 0)))]\n-  \"operands[1] = GEN_INT (- INTVAL (operands[1]));\"\n+  [(set (match_dup 2) (match_dup 1))\n+   (set (match_dup 0) (neg:SI (match_dup 2)))]\n+  \"\n+  {\n+    operands[1] = GEN_INT (- INTVAL (operands[1]));\n+    operands[2] = can_create_pseudo_p () ? gen_reg_rtx (SImode) : operands[0];\n+  }\"\n )\n \n (define_split \n   [(set (match_operand:SI 0 \"register_operand\" \"\")\n \t(match_operand:SI 1 \"const_int_operand\" \"\"))]\n   \"TARGET_THUMB1 && satisfies_constraint_K (operands[1])\"\n-  [(set (match_dup 0) (match_dup 1))\n-   (set (match_dup 0) (ashift:SI (match_dup 0) (match_dup 2)))]\n+  [(set (match_dup 2) (match_dup 1))\n+   (set (match_dup 0) (ashift:SI (match_dup 2) (match_dup 3)))]\n   \"\n   {\n     unsigned HOST_WIDE_INT val = INTVAL (operands[1]) & 0xffffffffu;\n@@ -5114,12 +5118,13 @@\n       if ((val & (mask << i)) == val)\n         break;\n \n-    /* Shouldn't happen, but we don't want to split if the shift is zero.  */\n+    /* Don't split if the shift is zero.  */\n     if (i == 0)\n       FAIL;\n \n     operands[1] = GEN_INT (val >> i);\n-    operands[2] = GEN_INT (i);\n+    operands[2] = can_create_pseudo_p () ? gen_reg_rtx (SImode) : operands[0];\n+    operands[3] = GEN_INT (i);\n   }\"\n )\n "}]}