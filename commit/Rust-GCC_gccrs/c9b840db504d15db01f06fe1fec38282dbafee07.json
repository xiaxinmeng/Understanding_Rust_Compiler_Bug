{"sha": "c9b840db504d15db01f06fe1fec38282dbafee07", "node_id": "C_kwDOANBUbNoAKGM5Yjg0MGRiNTA0ZDE1ZGIwMWYwNmZlMWZlYzM4MjgyZGJhZmVlMDc", "commit": {"author": {"name": "Aldy Hernandez", "email": "aldyh@redhat.com", "date": "2022-10-17T16:56:24Z"}, "committer": {"name": "Aldy Hernandez", "email": "aldyh@redhat.com", "date": "2022-10-17T18:55:27Z"}, "message": "Make sure exported range for SSA post-dominates the DEF in set_global_ranges_from_unreachable_edges.\n\nThe problem here is that we're exporting a range for an SSA range that\nhappens on the other side of a __builtin_unreachable, but the SSA does\nnot post-dominate the definition point.  This is causing ivcanon to\nunroll things incorrectly.\n\nThis was a snafu when converting the code from evrp.\n\n\tPR tree-optimization/107293\n\ngcc/ChangeLog:\n\n\t* tree-ssa-dom.cc\n\t(dom_opt_dom_walker::set_global_ranges_from_unreachable_edges):\n\tCheck that condition post-dominates the definition point.\n\ngcc/testsuite/ChangeLog:\n\n\t* gcc.dg/tree-ssa/pr107293.c: New test.", "tree": {"sha": "eca2aeb73939c25899b7d8ca8f6e8726c52eaca0", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/eca2aeb73939c25899b7d8ca8f6e8726c52eaca0"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/c9b840db504d15db01f06fe1fec38282dbafee07", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/c9b840db504d15db01f06fe1fec38282dbafee07", "html_url": "https://github.com/Rust-GCC/gccrs/commit/c9b840db504d15db01f06fe1fec38282dbafee07", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/c9b840db504d15db01f06fe1fec38282dbafee07/comments", "author": {"login": "aldyh", "id": 12937877, "node_id": "MDQ6VXNlcjEyOTM3ODc3", "avatar_url": "https://avatars.githubusercontent.com/u/12937877?v=4", "gravatar_id": "", "url": "https://api.github.com/users/aldyh", "html_url": "https://github.com/aldyh", "followers_url": "https://api.github.com/users/aldyh/followers", "following_url": "https://api.github.com/users/aldyh/following{/other_user}", "gists_url": "https://api.github.com/users/aldyh/gists{/gist_id}", "starred_url": "https://api.github.com/users/aldyh/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/aldyh/subscriptions", "organizations_url": "https://api.github.com/users/aldyh/orgs", "repos_url": "https://api.github.com/users/aldyh/repos", "events_url": "https://api.github.com/users/aldyh/events{/privacy}", "received_events_url": "https://api.github.com/users/aldyh/received_events", "type": "User", "site_admin": false}, "committer": {"login": "aldyh", "id": 12937877, "node_id": "MDQ6VXNlcjEyOTM3ODc3", "avatar_url": "https://avatars.githubusercontent.com/u/12937877?v=4", "gravatar_id": "", "url": "https://api.github.com/users/aldyh", "html_url": "https://github.com/aldyh", "followers_url": "https://api.github.com/users/aldyh/followers", "following_url": "https://api.github.com/users/aldyh/following{/other_user}", "gists_url": "https://api.github.com/users/aldyh/gists{/gist_id}", "starred_url": "https://api.github.com/users/aldyh/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/aldyh/subscriptions", "organizations_url": "https://api.github.com/users/aldyh/orgs", "repos_url": "https://api.github.com/users/aldyh/repos", "events_url": "https://api.github.com/users/aldyh/events{/privacy}", "received_events_url": "https://api.github.com/users/aldyh/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "d45af5c2eb1ba1e48449d8f3c5b4e3994a956f92", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/d45af5c2eb1ba1e48449d8f3c5b4e3994a956f92", "html_url": "https://github.com/Rust-GCC/gccrs/commit/d45af5c2eb1ba1e48449d8f3c5b4e3994a956f92"}], "stats": {"total": 38, "additions": 37, "deletions": 1}, "files": [{"sha": "724c31a11e6572817f9de1970ea61270c8f696d5", "filename": "gcc/testsuite/gcc.dg/tree-ssa/pr107293.c", "status": "added", "additions": 32, "deletions": 0, "changes": 32, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/c9b840db504d15db01f06fe1fec38282dbafee07/gcc%2Ftestsuite%2Fgcc.dg%2Ftree-ssa%2Fpr107293.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/c9b840db504d15db01f06fe1fec38282dbafee07/gcc%2Ftestsuite%2Fgcc.dg%2Ftree-ssa%2Fpr107293.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgcc.dg%2Ftree-ssa%2Fpr107293.c?ref=c9b840db504d15db01f06fe1fec38282dbafee07", "patch": "@@ -0,0 +1,32 @@\n+// { dg-do run }\n+// { dg-options \"-w -Os\" }\n+\n+short a;\n+int b[1];\n+\n+int c(int p) {\n+  return (p < 0) ? 0 : 10 + ((p / 100 - 16) / 4);\n+}\n+\n+void f(int n) {\n+  while (1) {\n+    int m = n;\n+    while ((m ) )\n+      m /= 2;\n+    break;\n+  }\n+}\n+\n+void g() {\n+  int h = a = 0;\n+  for (; h + a <= 0; a++) {\n+    if (b[c(a - 6)])\n+      break;\n+    f(a);\n+  }\n+}\n+int main() {\n+  g();\n+  if (a != 1)\n+    __builtin_abort ();\n+}"}, {"sha": "c7f095d79fcaa69f0a9326b096ed8cc06cae14af", "filename": "gcc/tree-ssa-dom.cc", "status": "modified", "additions": 5, "deletions": 1, "changes": 6, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/c9b840db504d15db01f06fe1fec38282dbafee07/gcc%2Ftree-ssa-dom.cc", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/c9b840db504d15db01f06fe1fec38282dbafee07/gcc%2Ftree-ssa-dom.cc", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftree-ssa-dom.cc?ref=c9b840db504d15db01f06fe1fec38282dbafee07", "patch": "@@ -1367,7 +1367,11 @@ dom_opt_dom_walker::set_global_ranges_from_unreachable_edges (basic_block bb)\n   tree name;\n   gori_compute &gori = m_ranger->gori ();\n   FOR_EACH_GORI_EXPORT_NAME (gori, pred_e->src, name)\n-    if (all_uses_feed_or_dominated_by_stmt (name, stmt))\n+    if (all_uses_feed_or_dominated_by_stmt (name, stmt)\n+\t// The condition must post-dominate the definition point.\n+\t&& (SSA_NAME_IS_DEFAULT_DEF (name)\n+\t    || (gimple_bb (SSA_NAME_DEF_STMT (name))\n+\t\t== pred_e->src)))\n       {\n \tValue_Range r (TREE_TYPE (name));\n "}]}