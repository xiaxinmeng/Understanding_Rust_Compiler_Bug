{"sha": "2a35a4ca1429dca015b8c635dc607e8fb7963808", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6MmEzNWE0Y2ExNDI5ZGNhMDE1YjhjNjM1ZGM2MDdlOGZiNzk2MzgwOA==", "commit": {"author": {"name": "Ed Schonberg", "email": "schonberg@adacore.com", "date": "2018-05-31T10:47:29Z"}, "committer": {"name": "Pierre-Marie de Rodat", "email": "pmderodat@gcc.gnu.org", "date": "2018-05-31T10:47:29Z"}, "message": "[Ada] Static predicate check on characters of a string literal\n\nThis patch implements the rule given in R< 4.2 (11): if the component type of\na string literal is a character type with a static predicate, that predicate\nmust be applied to each character in the string.\n\nCompiling the example below must yield:\n\n   gcc -c -gnata main.adb\n\n  main.adb:4:23: warning: static expression fails static predicate check on \"C\"\n  main.adb:4:23: warning: expression is no longer considered static\n  main.adb:4:24: warning: static expression fails static predicate check on \"C\"\n  main.adb:4:24: warning: expression is no longer considered static\n  main.adb:4:25: warning: static expression fails static predicate check on \"C\"\n  main.adb:4:25: warning: expression is no longer considered static\n\nExecution must yield:\n\n  raised SYSTEM.ASSERTIONS.ASSERT_FAILURE :\n                                        Static_Predicate failed at main.adb:4\n----\n\nprocedure Main is\n   subtype C is Character with Static_Predicate => C in 'A' | 'B' | 'C';\n   type S is array (Positive range <>) of C;\n   X : constant S := \"abc\";\nbegin\n   null;\nend;\n\n2018-05-31  Ed Schonberg  <schonberg@adacore.com>\n\ngcc/ada/\n\n\t* sem_res.adb (Resolve_String_Literal): If the type is a string type\n\twhose component subtype has a static predicate, ensure that the\n\tpredicate is applied to each character by expanding the string into the\n\tequivalent aggregate. This is also done if the component subtype is\n\tconstrained.\n\nFrom-SVN: r261014", "tree": {"sha": "1c11e3873c2bb91aa4ad11eeeb9622fb5974e14a", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/1c11e3873c2bb91aa4ad11eeeb9622fb5974e14a"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/2a35a4ca1429dca015b8c635dc607e8fb7963808", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/2a35a4ca1429dca015b8c635dc607e8fb7963808", "html_url": "https://github.com/Rust-GCC/gccrs/commit/2a35a4ca1429dca015b8c635dc607e8fb7963808", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/2a35a4ca1429dca015b8c635dc607e8fb7963808/comments", "author": {"login": "Edschonberg", "id": 6352375, "node_id": "MDQ6VXNlcjYzNTIzNzU=", "avatar_url": "https://avatars.githubusercontent.com/u/6352375?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Edschonberg", "html_url": "https://github.com/Edschonberg", "followers_url": "https://api.github.com/users/Edschonberg/followers", "following_url": "https://api.github.com/users/Edschonberg/following{/other_user}", "gists_url": "https://api.github.com/users/Edschonberg/gists{/gist_id}", "starred_url": "https://api.github.com/users/Edschonberg/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Edschonberg/subscriptions", "organizations_url": "https://api.github.com/users/Edschonberg/orgs", "repos_url": "https://api.github.com/users/Edschonberg/repos", "events_url": "https://api.github.com/users/Edschonberg/events{/privacy}", "received_events_url": "https://api.github.com/users/Edschonberg/received_events", "type": "User", "site_admin": false}, "committer": null, "parents": [{"sha": "d9898483059a497f1f632ab688bcef729e6cb6e0", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/d9898483059a497f1f632ab688bcef729e6cb6e0", "html_url": "https://github.com/Rust-GCC/gccrs/commit/d9898483059a497f1f632ab688bcef729e6cb6e0"}], "stats": {"total": 16, "additions": 14, "deletions": 2}, "files": [{"sha": "f3dce1be165981d9e1fb69430ac1e161f5999db1", "filename": "gcc/ada/ChangeLog", "status": "modified", "additions": 8, "deletions": 0, "changes": 8, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/2a35a4ca1429dca015b8c635dc607e8fb7963808/gcc%2Fada%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/2a35a4ca1429dca015b8c635dc607e8fb7963808/gcc%2Fada%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fada%2FChangeLog?ref=2a35a4ca1429dca015b8c635dc607e8fb7963808", "patch": "@@ -1,3 +1,11 @@\n+2018-05-31  Ed Schonberg  <schonberg@adacore.com>\n+\n+\t* sem_res.adb (Resolve_String_Literal): If the type is a string type\n+\twhose component subtype has a static predicate, ensure that the\n+\tpredicate is applied to each character by expanding the string into the\n+\tequivalent aggregate. This is also done if the component subtype is\n+\tconstrained.\n+\n 2018-05-31  Eric Botcazou  <ebotcazou@adacore.com>\n \n \t* gcc-interface/trans.c (Call_to_gnu): Remove obsolete code."}, {"sha": "e569cc884850656c90af889908078a4d1ba73073", "filename": "gcc/ada/sem_res.adb", "status": "modified", "additions": 6, "deletions": 2, "changes": 8, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/2a35a4ca1429dca015b8c635dc607e8fb7963808/gcc%2Fada%2Fsem_res.adb", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/2a35a4ca1429dca015b8c635dc607e8fb7963808/gcc%2Fada%2Fsem_res.adb", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fada%2Fsem_res.adb?ref=2a35a4ca1429dca015b8c635dc607e8fb7963808", "patch": "@@ -10774,7 +10774,9 @@ package body Sem_Res is\n          --  whether the evaluation of the string will raise constraint error.\n          --  Otherwise we need to transform the string literal into the\n          --  corresponding character aggregate and let the aggregate code do\n-         --  the checking.\n+         --  the checking. We use the same transformation if the component\n+         --  type has a static predicate, which will be applied to each\n+         --  character when the aggregate is resolved.\n \n          if Is_Standard_Character_Type (R_Typ) then\n \n@@ -10811,7 +10813,9 @@ package body Sem_Res is\n                      end if;\n                   end loop;\n \n-                  return;\n+                  if not Has_Static_Predicate (C_Typ) then\n+                     return;\n+                  end if;\n                end if;\n             end;\n          end if;"}]}