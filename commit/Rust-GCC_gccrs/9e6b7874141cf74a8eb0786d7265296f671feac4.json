{"sha": "9e6b7874141cf74a8eb0786d7265296f671feac4", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6OWU2Yjc4NzQxNDFjZjc0YThlYjA3ODZkNzI2NTI5NmY2NzFmZWFjNA==", "commit": {"author": {"name": "Richard Sandiford", "email": "rdsandiford@googlemail.com", "date": "2014-06-11T16:58:25Z"}, "committer": {"name": "Richard Sandiford", "email": "rsandifo@gcc.gnu.org", "date": "2014-06-11T16:58:25Z"}, "message": "genpreds.c (write_constraint_satisfied_p_1): Replace with...\n\ngcc/\n\t* genpreds.c (write_constraint_satisfied_p_1): Replace with...\n\t(write_constraint_satisfied_p_array): ...this new function.\n\t(write_tm_preds_h): Replace write_constraint_satisfied_p_1 with\n\tan array.\n\t(write_insn_preds_c): Update accordingly.\n\nFrom-SVN: r211470", "tree": {"sha": "b562e6d821aa93c3b271699d3affa97e50a6417c", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/b562e6d821aa93c3b271699d3affa97e50a6417c"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/9e6b7874141cf74a8eb0786d7265296f671feac4", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/9e6b7874141cf74a8eb0786d7265296f671feac4", "html_url": "https://github.com/Rust-GCC/gccrs/commit/9e6b7874141cf74a8eb0786d7265296f671feac4", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/9e6b7874141cf74a8eb0786d7265296f671feac4/comments", "author": {"login": "rsandifo", "id": 4235983, "node_id": "MDQ6VXNlcjQyMzU5ODM=", "avatar_url": "https://avatars.githubusercontent.com/u/4235983?v=4", "gravatar_id": "", "url": "https://api.github.com/users/rsandifo", "html_url": "https://github.com/rsandifo", "followers_url": "https://api.github.com/users/rsandifo/followers", "following_url": "https://api.github.com/users/rsandifo/following{/other_user}", "gists_url": "https://api.github.com/users/rsandifo/gists{/gist_id}", "starred_url": "https://api.github.com/users/rsandifo/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/rsandifo/subscriptions", "organizations_url": "https://api.github.com/users/rsandifo/orgs", "repos_url": "https://api.github.com/users/rsandifo/repos", "events_url": "https://api.github.com/users/rsandifo/events{/privacy}", "received_events_url": "https://api.github.com/users/rsandifo/received_events", "type": "User", "site_admin": false}, "committer": null, "parents": [{"sha": "16a26e426bf720dcc95a89b6657fd7b09dda8d6c", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/16a26e426bf720dcc95a89b6657fd7b09dda8d6c", "html_url": "https://github.com/Rust-GCC/gccrs/commit/16a26e426bf720dcc95a89b6657fd7b09dda8d6c"}], "stats": {"total": 45, "additions": 21, "deletions": 24}, "files": [{"sha": "b8c5b38ce73f3fcde5cee1d0bda91bf49c31ce22", "filename": "gcc/ChangeLog", "status": "modified", "additions": 8, "deletions": 0, "changes": 8, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/9e6b7874141cf74a8eb0786d7265296f671feac4/gcc%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/9e6b7874141cf74a8eb0786d7265296f671feac4/gcc%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2FChangeLog?ref=9e6b7874141cf74a8eb0786d7265296f671feac4", "patch": "@@ -1,3 +1,11 @@\n+2014-06-11  Richard Sandiford  <rdsandiford@googlemail.com>\n+\n+\t* genpreds.c (write_constraint_satisfied_p_1): Replace with...\n+\t(write_constraint_satisfied_p_array): ...this new function.\n+\t(write_tm_preds_h): Replace write_constraint_satisfied_p_1 with\n+\tan array.\n+\t(write_insn_preds_c): Update accordingly.\n+\n 2014-06-11  Richard Sandiford  <rdsandiford@googlemail.com>\n \n \t* genpreds.c (write_lookup_constraint): Rename to..."}, {"sha": "e5ffb386bde6eabaf9333fc09be4eebffb05857c", "filename": "gcc/genpreds.c", "status": "modified", "additions": 13, "deletions": 24, "changes": 37, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/9e6b7874141cf74a8eb0786d7265296f671feac4/gcc%2Fgenpreds.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/9e6b7874141cf74a8eb0786d7265296f671feac4/gcc%2Fgenpreds.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fgenpreds.c?ref=9e6b7874141cf74a8eb0786d7265296f671feac4", "patch": "@@ -1166,29 +1166,19 @@ write_tm_constrs_h (void)\n    a CONSTRAINT_xxx constant to one of the predicate functions generated\n    above.  */\n static void\n-write_constraint_satisfied_p_1 (void)\n+write_constraint_satisfied_p_array (void)\n {\n-  struct constraint_data *c;\n-\n   if (satisfied_start == num_constraints)\n     return;\n \n-  puts (\"bool\\n\"\n-\t\"constraint_satisfied_p_1 (rtx op, enum constraint_num c)\\n\"\n-\t\"{\\n\"\n-\t\"  switch (c)\\n\"\n-\t\"    {\");\n-\n-  FOR_ALL_CONSTRAINTS (c)\n-    if (!c->is_register)\n-      printf (\"    case CONSTRAINT_%s: \"\n-\t      \"return satisfies_constraint_%s (op);\\n\",\n-\t      c->c_name, c->c_name);\n-\n-  puts (\"    default: break;\\n\"\n-\t\"    }\\n\"\n-\t\"  return false;\\n\"\n-\t\"}\\n\");\n+  printf (\"bool (*constraint_satisfied_p_array[]) (rtx) = {\\n  \");\n+  for (unsigned int i = satisfied_start; i < num_constraints; ++i)\n+    {\n+      if (i != satisfied_start)\n+\tprintf (\",\\n  \");\n+      printf (\"satisfies_constraint_%s\", enum_order[i]->c_name);\n+    }\n+  printf (\"\\n};\\n\\n\");\n }\n \n /* Write out the function which computes whether a given value matches\n@@ -1293,16 +1283,15 @@ write_tm_preds_h (void)\n \t      \"  return false;\\n\"\n \t      \"}\\n\");\n       else\n-\tprintf (\"extern bool constraint_satisfied_p_1 (rtx,\"\n-\t\t\" enum constraint_num);\\n\"\n+\tprintf (\"extern bool (*constraint_satisfied_p_array[]) (rtx);\\n\"\n \t\t\"\\n\"\n \t\t\"/* Return true if X satisfies constraint C.  */\\n\"\n \t\t\"\\n\"\n \t\t\"static inline bool\\n\"\n \t\t\"constraint_satisfied_p (rtx x, enum constraint_num c)\\n\"\n \t\t\"{\\n\"\n-\t\t\"  return c >= CONSTRAINT_%s\"\n-\t\t\" && constraint_satisfied_p_1 (x, c);\\n\"\n+\t\t\"  int i = (int) c - (int) CONSTRAINT_%s;\\n\"\n+\t\t\"  return i >= 0 && constraint_satisfied_p_array[i] (x);\\n\"\n \t\t\"}\\n\"\n \t\t\"\\n\",\n \t\tenum_order[satisfied_start]->name);\n@@ -1425,7 +1414,7 @@ write_insn_preds_c (void)\n       write_lookup_constraint_array ();\n       if (have_register_constraints)\n \twrite_reg_class_for_constraint_1 ();\n-      write_constraint_satisfied_p_1 ();\n+      write_constraint_satisfied_p_array ();\n \n       if (have_const_int_constraints)\n \twrite_insn_const_int_ok_for_constraint ();"}]}