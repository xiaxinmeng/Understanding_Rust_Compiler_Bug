{"sha": "f96bc213541a8a468935acd64e1170717a455cd7", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6Zjk2YmMyMTM1NDFhOGE0Njg5MzVhY2Q2NGUxMTcwNzE3YTQ1NWNkNw==", "commit": {"author": {"name": "Nathan Sidwell", "email": "nathan@codesourcery.com", "date": "2004-11-22T14:56:06Z"}, "committer": {"name": "Nathan Sidwell", "email": "nathan@gcc.gnu.org", "date": "2004-11-22T14:56:06Z"}, "message": "altivec.md (VI_char): New mode attribute.\n\n\t* config/rs6000/altivec.md (VI_char): New mode attribute.\n\t(addv16qi3, addv8hi3, addv4ai3): Replace with ...\n\t(add<mode>3): ... this.\n\t(subv16qi3, subv8hi3, subv4ai3): Replace with ...\n\t(sub<mode>3): ... this.\n\t(smaxv16qi3, smaxv8hi3, smaxv4ai3): Replace with ...\n\t(smax<mode>3): ... this.\n\t(sminv16qi3, sminv8hi3, sminv4ai3): Replace with ...\n\t(smin<mode>3): ... this.\n\t(umaxv16qi3, umaxv8hi3, umaxv4ai3): Replace with ...\n\t(umax<mode>3): ... this.\n\t(uminv16qi3, uminv8hi3, uminv4ai3): Replace with ...\n\t(umin<mode>3): ... this.\n\t(andv16qi3, andv8hi3, andv4ai3): Replace with ...\n\t(and<mode>3): ... this.\n\t(iorv16qi3, iorv8hi3, iorv4ai3): Replace with ...\n\t(ior<mode>3): ... this.\n\t(xorv16qi3, xorv8hi3, xorv4ai3): Replace with ...\n\t(xor<mode>3): ... this.\n\t(andv16qi3, andv8hi3, andv4ai3): Replace with ...\n\t(and<mode>3): ... this.\n\t(iorv16qi3, iorv8hi3, iorv4ai3): Replace with ...\n\t(ior<mode>3): ... this.\n\t(altivec_vnor): Replace with ...\n\t(altivec_nor<mode>): ... this.\n\t(one_cmplv16qi2, one_cmplv8hi2, one_complv4ai2): Replace with ...\n\t(one_cmpl<mode>2): ... this.\n\t(altivec_vandc): New expander.\n\t(*andc<mode>3): New insn.\n\t* config/rs6000/rs6000.c (bdesc_2arg): Adjust for new insn names.\n\nFrom-SVN: r91015", "tree": {"sha": "1d7fae03f07ee7e96381fe5fca5a62ed509d5f01", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/1d7fae03f07ee7e96381fe5fca5a62ed509d5f01"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/f96bc213541a8a468935acd64e1170717a455cd7", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/f96bc213541a8a468935acd64e1170717a455cd7", "html_url": "https://github.com/Rust-GCC/gccrs/commit/f96bc213541a8a468935acd64e1170717a455cd7", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/f96bc213541a8a468935acd64e1170717a455cd7/comments", "author": null, "committer": null, "parents": [{"sha": "618bb89c87cd2056b8f9d7e660d5315fa04fcf06", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/618bb89c87cd2056b8f9d7e660d5315fa04fcf06", "html_url": "https://github.com/Rust-GCC/gccrs/commit/618bb89c87cd2056b8f9d7e660d5315fa04fcf06"}], "stats": {"total": 465, "additions": 178, "deletions": 287}, "files": [{"sha": "0d6d39918d598e76967c420a330540f4190fcd50", "filename": "gcc/ChangeLog", "status": "modified", "additions": 33, "deletions": 0, "changes": 33, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/f96bc213541a8a468935acd64e1170717a455cd7/gcc%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/f96bc213541a8a468935acd64e1170717a455cd7/gcc%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2FChangeLog?ref=f96bc213541a8a468935acd64e1170717a455cd7", "patch": "@@ -1,3 +1,36 @@\n+2004-11-22  Nathan Sidwell  <nathan@codesourcery.com>\n+\n+\t* config/rs6000/altivec.md (VI_char): New mode attribute.\n+\t(addv16qi3, addv8hi3, addv4ai3): Replace with ...\n+\t(add<mode>3): ... this.\n+\t(subv16qi3, subv8hi3, subv4ai3): Replace with ...\n+\t(sub<mode>3): ... this.\n+\t(smaxv16qi3, smaxv8hi3, smaxv4ai3): Replace with ...\n+\t(smax<mode>3): ... this.\n+\t(sminv16qi3, sminv8hi3, sminv4ai3): Replace with ...\n+\t(smin<mode>3): ... this.\n+\t(umaxv16qi3, umaxv8hi3, umaxv4ai3): Replace with ...\n+\t(umax<mode>3): ... this.\n+\t(uminv16qi3, uminv8hi3, uminv4ai3): Replace with ...\n+\t(umin<mode>3): ... this.\n+\t(andv16qi3, andv8hi3, andv4ai3): Replace with ...\n+\t(and<mode>3): ... this.\n+\t(iorv16qi3, iorv8hi3, iorv4ai3): Replace with ...\n+\t(ior<mode>3): ... this.\n+\t(xorv16qi3, xorv8hi3, xorv4ai3): Replace with ...\n+\t(xor<mode>3): ... this.\n+\t(andv16qi3, andv8hi3, andv4ai3): Replace with ...\n+\t(and<mode>3): ... this.\n+\t(iorv16qi3, iorv8hi3, iorv4ai3): Replace with ...\n+\t(ior<mode>3): ... this.\n+\t(altivec_vnor): Replace with ...\n+\t(altivec_nor<mode>): ... this.\n+\t(one_cmplv16qi2, one_cmplv8hi2, one_complv4ai2): Replace with ...\n+\t(one_cmpl<mode>2): ... this.\n+\t(altivec_vandc): New expander.\n+\t(*andc<mode>3): New insn.\n+\t* config/rs6000/rs6000.c (bdesc_2arg): Adjust for new insn names.\n+\n 2004-11-22  Dorit Naishlos  <dorit@il.ibm.com>\n \n \tPR tree-opt/18536"}, {"sha": "4fa47d5b69320e9293cc305aa0618ccec6be1886", "filename": "gcc/config/rs6000/altivec.md", "status": "modified", "additions": 144, "deletions": 286, "changes": 430, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/f96bc213541a8a468935acd64e1170717a455cd7/gcc%2Fconfig%2Frs6000%2Faltivec.md", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/f96bc213541a8a468935acd64e1170717a455cd7/gcc%2Fconfig%2Frs6000%2Faltivec.md", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fconfig%2Frs6000%2Faltivec.md?ref=f96bc213541a8a468935acd64e1170717a455cd7", "patch": "@@ -53,6 +53,8 @@\n ;; Vec modes, pity mode macros are not composable\n (define_mode_macro V [V4SI V8HI V16QI V4SF])\n \n+(define_mode_attr VI_char [(V4SI \"w\") (V8HI \"h\") (V16QI \"b\")])\n+\n ;; Generic LVX load instruction.\n (define_insn \"altivec_lvx_<mode>\"\n   [(set (match_operand:V 0 \"altivec_register_operand\" \"=v\")\n@@ -218,28 +220,13 @@\n \n ;; Simple binary operations.\n \n-(define_insn \"addv16qi3\"\n-  [(set (match_operand:V16QI 0 \"register_operand\" \"=v\")\n-        (plus:V16QI (match_operand:V16QI 1 \"register_operand\" \"v\")\n-                    (match_operand:V16QI 2 \"register_operand\" \"v\")))]\n-  \"TARGET_ALTIVEC\"\n-  \"vaddubm %0,%1,%2\"\n-  [(set_attr \"type\" \"vecsimple\")])\n-\n-(define_insn \"addv8hi3\"\n-  [(set (match_operand:V8HI 0 \"register_operand\" \"=v\")\n-        (plus:V8HI (match_operand:V8HI 1 \"register_operand\" \"v\")\n-                   (match_operand:V8HI 2 \"register_operand\" \"v\")))]\n-  \"TARGET_ALTIVEC\"\n-  \"vadduhm %0,%1,%2\"\n-  [(set_attr \"type\" \"vecsimple\")])\n-\n-(define_insn \"addv4si3\"\n-  [(set (match_operand:V4SI 0 \"register_operand\" \"=v\")\n-        (plus:V4SI (match_operand:V4SI 1 \"register_operand\" \"v\")\n-                   (match_operand:V4SI 2 \"register_operand\" \"v\")))]\n+;; add\n+(define_insn \"add<mode>3\"\n+  [(set (match_operand:VI 0 \"register_operand\" \"=v\")\n+        (plus:VI (match_operand:VI 1 \"register_operand\" \"v\")\n+                 (match_operand:VI 2 \"register_operand\" \"v\")))]\n   \"TARGET_ALTIVEC\"\n-  \"vadduwm %0,%1,%2\"\n+  \"vaddu<VI_char>m %0,%1,%2\"\n   [(set_attr \"type\" \"vecsimple\")])\n \n (define_insn \"addv4sf3\"\n@@ -312,38 +299,86 @@\n   \"vaddsws %0,%1,%2\"\n   [(set_attr \"type\" \"vecsimple\")])\n \n-(define_insn \"andv16qi3\"\n+;; sub\n+(define_insn \"sub<mode>3\"\n+  [(set (match_operand:VI 0 \"register_operand\" \"=v\")\n+        (minus:VI (match_operand:VI 1 \"register_operand\" \"v\")\n+                  (match_operand:VI 2 \"register_operand\" \"v\")))]\n+  \"TARGET_ALTIVEC\"\n+  \"vsubu<VI_char>m %0,%1,%2\"\n+  [(set_attr \"type\" \"vecsimple\")])\n+\n+(define_insn \"subv4sf3\"\n+  [(set (match_operand:V4SF 0 \"register_operand\" \"=v\")\n+        (minus:V4SF (match_operand:V4SF 1 \"register_operand\" \"v\")\n+                    (match_operand:V4SF 2 \"register_operand\" \"v\")))]\n+  \"TARGET_ALTIVEC\"\n+  \"vsubfp %0,%1,%2\"\n+  [(set_attr \"type\" \"vecfloat\")])\n+\n+(define_insn \"altivec_vsubcuw\"\n+  [(set (match_operand:V4SI 0 \"register_operand\" \"=v\")\n+        (unspec:V4SI [(match_operand:V4SI 1 \"register_operand\" \"v\")\n+                      (match_operand:V4SI 2 \"register_operand\" \"v\")] 124))]\n+  \"TARGET_ALTIVEC\"\n+  \"vsubcuw %0,%1,%2\"\n+  [(set_attr \"type\" \"vecsimple\")])\n+\n+(define_insn \"altivec_vsububs\"\n   [(set (match_operand:V16QI 0 \"register_operand\" \"=v\")\n-        (and:V16QI (match_operand:V16QI 1 \"register_operand\" \"v\")\n-                  (match_operand:V16QI 2 \"register_operand\" \"v\")))]\n+        (unspec:V16QI [(match_operand:V16QI 1 \"register_operand\" \"v\")\n+                       (match_operand:V16QI 2 \"register_operand\" \"v\")] 125))\n+   (set (reg:SI 110) (unspec:SI [(const_int 0)] 213))]\n   \"TARGET_ALTIVEC\"\n-  \"vand %0,%1,%2\"\n+  \"vsububs %0,%1,%2\"\n+  [(set_attr \"type\" \"vecsimple\")])\n+\n+(define_insn \"altivec_vsubsbs\"\n+  [(set (match_operand:V16QI 0 \"register_operand\" \"=v\")\n+        (unspec:V16QI [(match_operand:V16QI 1 \"register_operand\" \"v\")\n+                       (match_operand:V16QI 2 \"register_operand\" \"v\")] 126))\n+   (set (reg:SI 110) (unspec:SI [(const_int 0)] 213))]\n+  \"TARGET_ALTIVEC\"\n+  \"vsubsbs %0,%1,%2\"\n   [(set_attr \"type\" \"vecsimple\")])\n \n-(define_insn \"andv8hi3\"\n+(define_insn \"altivec_vsubuhs\"\n   [(set (match_operand:V8HI 0 \"register_operand\" \"=v\")\n-        (and:V8HI (match_operand:V8HI 1 \"register_operand\" \"v\")\n-                  (match_operand:V8HI 2 \"register_operand\" \"v\")))]\n+        (unspec:V8HI [(match_operand:V8HI 1 \"register_operand\" \"v\")\n+                      (match_operand:V8HI 2 \"register_operand\" \"v\")] 127))\n+   (set (reg:SI 110) (unspec:SI [(const_int 0)] 213))]\n   \"TARGET_ALTIVEC\"\n-  \"vand %0,%1,%2\"\n+  \"vsubuhs %0,%1,%2\"\n   [(set_attr \"type\" \"vecsimple\")])\n \n-(define_insn \"andv4si3\"\n+(define_insn \"altivec_vsubshs\"\n+  [(set (match_operand:V8HI 0 \"register_operand\" \"=v\")\n+        (unspec:V8HI [(match_operand:V8HI 1 \"register_operand\" \"v\")\n+                      (match_operand:V8HI 2 \"register_operand\" \"v\")] 128))\n+   (set (reg:SI 110) (unspec:SI [(const_int 0)] 213))]\n+  \"TARGET_ALTIVEC\"\n+  \"vsubshs %0,%1,%2\"\n+  [(set_attr \"type\" \"vecsimple\")])\n+\n+(define_insn \"altivec_vsubuws\"\n   [(set (match_operand:V4SI 0 \"register_operand\" \"=v\")\n-        (and:V4SI (match_operand:V4SI 1 \"register_operand\" \"v\")\n-                  (match_operand:V4SI 2 \"register_operand\" \"v\")))]\n+        (unspec:V4SI [(match_operand:V4SI 1 \"register_operand\" \"v\")\n+                      (match_operand:V4SI 2 \"register_operand\" \"v\")] 129))\n+   (set (reg:SI 110) (unspec:SI [(const_int 0)] 213))]\n   \"TARGET_ALTIVEC\"\n-  \"vand %0,%1,%2\"\n+  \"vsubuws %0,%1,%2\"\n   [(set_attr \"type\" \"vecsimple\")])\n \n-(define_insn \"altivec_vandc\"\n+(define_insn \"altivec_vsubsws\"\n   [(set (match_operand:V4SI 0 \"register_operand\" \"=v\")\n-        (and:V4SI (not:V4SI (match_operand:V4SI 1 \"register_operand\" \"v\"))\n-                  (match_operand:V4SI 2 \"register_operand\" \"v\")))]\n+        (unspec:V4SI [(match_operand:V4SI 1 \"register_operand\" \"v\")\n+                      (match_operand:V4SI 2 \"register_operand\" \"v\")] 130))\n+   (set (reg:SI 110) (unspec:SI [(const_int 0)] 213))]\n   \"TARGET_ALTIVEC\"\n-  \"vandc %0,%2,%1\"\n+  \"vsubsws %0,%1,%2\"\n   [(set_attr \"type\" \"vecsimple\")])\n \n+;;\n (define_insn \"altivec_vavgub\"\n   [(set (match_operand:V16QI 0 \"register_operand\" \"=v\")\n         (unspec:V16QI [(match_operand:V16QI 1 \"register_operand\" \"v\")\n@@ -608,60 +643,54 @@\n   \"vmsumshs %0,%1,%2,%3\"\n   [(set_attr \"type\" \"veccomplex\")])\n \n-(define_insn \"umaxv16qi3\"\n-  [(set (match_operand:V16QI 0 \"register_operand\" \"=v\")\n-        (umax:V16QI (match_operand:V16QI 1 \"register_operand\" \"v\")\n-                    (match_operand:V16QI 2 \"register_operand\" \"v\")))]\n-  \"TARGET_ALTIVEC\"\n-  \"vmaxub %0,%1,%2\"\n-  [(set_attr \"type\" \"vecsimple\")])\n+;; max\n \n-(define_insn \"smaxv16qi3\"\n-  [(set (match_operand:V16QI 0 \"register_operand\" \"=v\")\n-        (smax:V16QI (match_operand:V16QI 1 \"register_operand\" \"v\")\n-                    (match_operand:V16QI 2 \"register_operand\" \"v\")))]\n+(define_insn \"umax<mode>3\"\n+  [(set (match_operand:VI 0 \"register_operand\" \"=v\")\n+        (umax:VI (match_operand:VI 1 \"register_operand\" \"v\")\n+                 (match_operand:VI 2 \"register_operand\" \"v\")))]\n   \"TARGET_ALTIVEC\"\n-  \"vmaxsb %0,%1,%2\"\n+  \"vmaxu<VI_char> %0,%1,%2\"\n   [(set_attr \"type\" \"vecsimple\")])\n \n-(define_insn \"umaxv8hi3\"\n-  [(set (match_operand:V8HI 0 \"register_operand\" \"=v\")\n-        (umax:V8HI (match_operand:V8HI 1 \"register_operand\" \"v\")\n-                   (match_operand:V8HI 2 \"register_operand\" \"v\")))]\n+(define_insn \"smax<mode>3\"\n+  [(set (match_operand:VI 0 \"register_operand\" \"=v\")\n+        (smax:VI (match_operand:VI 1 \"register_operand\" \"v\")\n+                 (match_operand:VI 2 \"register_operand\" \"v\")))]\n   \"TARGET_ALTIVEC\"\n-  \"vmaxuh %0,%1,%2\"\n+  \"vmaxs<VI_char> %0,%1,%2\"\n   [(set_attr \"type\" \"vecsimple\")])\n \n-(define_insn \"smaxv8hi3\"\n-  [(set (match_operand:V8HI 0 \"register_operand\" \"=v\")\n-        (smax:V8HI (match_operand:V8HI 1 \"register_operand\" \"v\")\n-                   (match_operand:V8HI 2 \"register_operand\" \"v\")))]\n+(define_insn \"smaxv4sf3\"\n+  [(set (match_operand:V4SF 0 \"register_operand\" \"=v\")\n+        (smax:V4SF (match_operand:V4SF 1 \"register_operand\" \"v\")\n+                   (match_operand:V4SF 2 \"register_operand\" \"v\")))]\n   \"TARGET_ALTIVEC\"\n-  \"vmaxsh %0,%1,%2\"\n-  [(set_attr \"type\" \"vecsimple\")])\n+  \"vmaxfp %0,%1,%2\"\n+  [(set_attr \"type\" \"veccmp\")])\n \n-(define_insn \"umaxv4si3\"\n-  [(set (match_operand:V4SI 0 \"register_operand\" \"=v\")\n-        (umax:V4SI (match_operand:V4SI 1 \"register_operand\" \"v\")\n-                   (match_operand:V4SI 2 \"register_operand\" \"v\")))]\n+(define_insn \"umin<mode>3\"\n+  [(set (match_operand:VI 0 \"register_operand\" \"=v\")\n+        (umin:VI (match_operand:VI 1 \"register_operand\" \"v\")\n+                 (match_operand:VI 2 \"register_operand\" \"v\")))]\n   \"TARGET_ALTIVEC\"\n-  \"vmaxuw %0,%1,%2\"\n+  \"vminu<VI_char> %0,%1,%2\"\n   [(set_attr \"type\" \"vecsimple\")])\n \n-(define_insn \"smaxv4si3\"\n-  [(set (match_operand:V4SI 0 \"register_operand\" \"=v\")\n-        (smax:V4SI (match_operand:V4SI 1 \"register_operand\" \"v\")\n-                   (match_operand:V4SI 2 \"register_operand\" \"v\")))]\n+(define_insn \"smin<mode>3\"\n+  [(set (match_operand:VI 0 \"register_operand\" \"=v\")\n+        (smin:VI (match_operand:VI 1 \"register_operand\" \"v\")\n+                 (match_operand:VI 2 \"register_operand\" \"v\")))]\n   \"TARGET_ALTIVEC\"\n-  \"vmaxsw %0,%1,%2\"\n+  \"vmins<VI_char> %0,%1,%2\"\n   [(set_attr \"type\" \"vecsimple\")])\n \n-(define_insn \"smaxv4sf3\"\n+(define_insn \"sminv4sf3\"\n   [(set (match_operand:V4SF 0 \"register_operand\" \"=v\")\n-        (smax:V4SF (match_operand:V4SF 1 \"register_operand\" \"v\")\n+        (smin:V4SF (match_operand:V4SF 1 \"register_operand\" \"v\")\n                    (match_operand:V4SF 2 \"register_operand\" \"v\")))]\n   \"TARGET_ALTIVEC\"\n-  \"vmaxfp %0,%1,%2\"\n+  \"vminfp %0,%1,%2\"\n   [(set_attr \"type\" \"veccmp\")])\n \n (define_insn \"altivec_vmhaddshs\"\n@@ -801,62 +830,6 @@\n   \"vmrglw %0,%1,%2\"\n   [(set_attr \"type\" \"vecperm\")])\n \n-(define_insn \"uminv16qi3\"\n-  [(set (match_operand:V16QI 0 \"register_operand\" \"=v\")\n-        (umin:V16QI (match_operand:V16QI 1 \"register_operand\" \"v\")\n-                    (match_operand:V16QI 2 \"register_operand\" \"v\")))]\n-  \"TARGET_ALTIVEC\"\n-  \"vminub %0,%1,%2\"\n-  [(set_attr \"type\" \"vecsimple\")])\n-\n-(define_insn \"sminv16qi3\"\n-  [(set (match_operand:V16QI 0 \"register_operand\" \"=v\")\n-        (smin:V16QI (match_operand:V16QI 1 \"register_operand\" \"v\")\n-                    (match_operand:V16QI 2 \"register_operand\" \"v\")))]\n-  \"TARGET_ALTIVEC\"\n-  \"vminsb %0,%1,%2\"\n-  [(set_attr \"type\" \"vecsimple\")])\n-\n-(define_insn \"uminv8hi3\"\n-  [(set (match_operand:V8HI 0 \"register_operand\" \"=v\")\n-        (umin:V8HI (match_operand:V8HI 1 \"register_operand\" \"v\")\n-                   (match_operand:V8HI 2 \"register_operand\" \"v\")))]\n-  \"TARGET_ALTIVEC\"\n-  \"vminuh %0,%1,%2\"\n-  [(set_attr \"type\" \"vecsimple\")])\n-\n-(define_insn \"sminv8hi3\"\n-  [(set (match_operand:V8HI 0 \"register_operand\" \"=v\")\n-        (smin:V8HI (match_operand:V8HI 1 \"register_operand\" \"v\")\n-                   (match_operand:V8HI 2 \"register_operand\" \"v\")))]\n-  \"TARGET_ALTIVEC\"\n-  \"vminsh %0,%1,%2\"\n-  [(set_attr \"type\" \"vecsimple\")])\n-\n-(define_insn \"uminv4si3\"\n-  [(set (match_operand:V4SI 0 \"register_operand\" \"=v\")\n-        (umin:V4SI (match_operand:V4SI 1 \"register_operand\" \"v\")\n-                   (match_operand:V4SI 2 \"register_operand\" \"v\")))]\n-  \"TARGET_ALTIVEC\"\n-  \"vminuw %0,%1,%2\"\n-  [(set_attr \"type\" \"vecsimple\")])\n-\n-(define_insn \"sminv4si3\"\n-  [(set (match_operand:V4SI 0 \"register_operand\" \"=v\")\n-        (smin:V4SI (match_operand:V4SI 1 \"register_operand\" \"v\")\n-                   (match_operand:V4SI 2 \"register_operand\" \"v\")))]\n-  \"TARGET_ALTIVEC\"\n-  \"vminsw %0,%1,%2\"\n-  [(set_attr \"type\" \"vecsimple\")])\n-\n-(define_insn \"sminv4sf3\"\n-  [(set (match_operand:V4SF 0 \"register_operand\" \"=v\")\n-        (smin:V4SF (match_operand:V4SF 1 \"register_operand\" \"v\")\n-                   (match_operand:V4SF 2 \"register_operand\" \"v\")))]\n-  \"TARGET_ALTIVEC\"\n-  \"vminfp %0,%1,%2\"\n-  [(set_attr \"type\" \"veccmp\")])\n-\n (define_insn \"altivec_vmuleub\"\n   [(set (match_operand:V8HI 0 \"register_operand\" \"=v\")\n         (unspec:V8HI [(match_operand:V16QI 1 \"register_operand\" \"v\")\n@@ -921,57 +894,62 @@\n   \"vmulosh %0,%1,%2\"\n   [(set_attr \"type\" \"veccomplex\")])\n \n-(define_insn \"altivec_vnor\"\n-  [(set (match_operand:V4SI 0 \"register_operand\" \"=v\")\n-        (not:V4SI (ior:V4SI (match_operand:V4SI 1 \"register_operand\" \"v\")\n-                            (match_operand:V4SI 2 \"register_operand\" \"v\"))))]\n-  \"TARGET_ALTIVEC\"\n-  \"vnor %0,%1,%2\"\n-  [(set_attr \"type\" \"vecsimple\")])\n-  \n-(define_insn \"one_cmplv16qi2\"\n-  [(set (match_operand:V16QI 0 \"register_operand\" \"=v\")\n-        (not:V16QI (match_operand:V16QI 1 \"register_operand\" \"v\")))]\n+\n+;; logical ops\n+\n+(define_insn \"and<mode>3\"\n+  [(set (match_operand:VI 0 \"register_operand\" \"=v\")\n+        (and:VI (match_operand:VI 1 \"register_operand\" \"v\")\n+                (match_operand:VI 2 \"register_operand\" \"v\")))]\n   \"TARGET_ALTIVEC\"\n-  \"vnor %0,%1,%1\"\n+  \"vand %0,%1,%2\"\n   [(set_attr \"type\" \"vecsimple\")])\n-  \n-(define_insn \"one_cmplv8hi2\"\n-  [(set (match_operand:V8HI 0 \"register_operand\" \"=v\")\n-        (not:V8HI (match_operand:V8HI 1 \"register_operand\" \"v\")))]\n+\n+(define_insn \"ior<mode>3\"\n+  [(set (match_operand:VI 0 \"register_operand\" \"=v\")\n+        (ior:VI (match_operand:VI 1 \"register_operand\" \"v\")\n+                (match_operand:VI 2 \"register_operand\" \"v\")))]\n   \"TARGET_ALTIVEC\"\n-  \"vnor %0,%1,%1\"\n+  \"vor %0,%1,%2\"\n   [(set_attr \"type\" \"vecsimple\")])\n-  \n-(define_insn \"one_cmplv4si2\"\n-  [(set (match_operand:V4SI 0 \"register_operand\" \"=v\")\n-        (not:V4SI (match_operand:V4SI 1 \"register_operand\" \"v\")))]\n+\n+(define_insn \"xor<mode>3\"\n+  [(set (match_operand:VI 0 \"register_operand\" \"=v\")\n+        (xor:VI (match_operand:VI 1 \"register_operand\" \"v\")\n+                (match_operand:VI 2 \"register_operand\" \"v\")))]\n   \"TARGET_ALTIVEC\"\n-  \"vnor %0,%1,%1\"\n+  \"vxor %0,%1,%2\"\n   [(set_attr \"type\" \"vecsimple\")])\n \n-(define_insn \"iorv16qi3\"\n-  [(set (match_operand:V16QI 0 \"register_operand\" \"=v\")\n-        (ior:V16QI (match_operand:V16QI 1 \"register_operand\" \"v\")\n-                  (match_operand:V16QI 2 \"register_operand\" \"v\")))]\n+(define_insn \"one_cmpl<mode>2\"\n+  [(set (match_operand:VI 0 \"register_operand\" \"=v\")\n+        (not:VI (match_operand:VI 1 \"register_operand\" \"v\")))]\n   \"TARGET_ALTIVEC\"\n-  \"vor %0,%1,%2\"\n+  \"vnor %0,%1,%1\"\n   [(set_attr \"type\" \"vecsimple\")])\n-\n-(define_insn \"iorv8hi3\"\n-  [(set (match_operand:V8HI 0 \"register_operand\" \"=v\")\n-        (ior:V8HI (match_operand:V8HI 1 \"register_operand\" \"v\")\n-                  (match_operand:V8HI 2 \"register_operand\" \"v\")))]\n+  \n+(define_insn \"altivec_nor<mode>3\"\n+  [(set (match_operand:VI 0 \"register_operand\" \"=v\")\n+        (not:VI (ior:VI (match_operand:VI 1 \"register_operand\" \"v\")\n+                        (match_operand:VI 2 \"register_operand\" \"v\"))))]\n   \"TARGET_ALTIVEC\"\n-  \"vor %0,%1,%2\"\n+  \"vnor %0,%1,%2\"\n   [(set_attr \"type\" \"vecsimple\")])\n \n-(define_insn \"iorv4si3\"\n+;; builtin_altivec_vandc (a, b) computes a & ~b, gcc's\n+;; canonicalization of that has the operands the other way round\n+(define_expand \"altivec_vandc\"\n   [(set (match_operand:V4SI 0 \"register_operand\" \"=v\")\n-        (ior:V4SI (match_operand:V4SI 1 \"register_operand\" \"v\")\n-                  (match_operand:V4SI 2 \"register_operand\" \"v\")))]\n+        (and:V4SI (not:V4SI (match_operand:V4SI 2 \"register_operand\" \"v\"))\n+                  (match_operand:V4SI 1 \"register_operand\" \"v\")))]\n+  \"TARGET_ALTIVEC\")\n+\n+(define_insn \"*andc<mode>3\"\n+  [(set (match_operand:VI 0 \"register_operand\" \"=v\")\n+        (and:VI (not:VI (match_operand:VI 1 \"register_operand\" \"v\"))\n+                (match_operand:VI 2 \"register_operand\" \"v\")))]\n   \"TARGET_ALTIVEC\"\n-  \"vor %0,%1,%2\"\n+  \"vandc %0,%2,%1\"\n   [(set_attr \"type\" \"vecsimple\")])\n \n (define_insn \"altivec_vpkuhum\"\n@@ -1206,100 +1184,6 @@\n   \"vsro %0,%1,%2\"\n   [(set_attr \"type\" \"vecperm\")])\n \n-(define_insn \"subv16qi3\"\n-  [(set (match_operand:V16QI 0 \"register_operand\" \"=v\")\n-        (minus:V16QI (match_operand:V16QI 1 \"register_operand\" \"v\")\n-                     (match_operand:V16QI 2 \"register_operand\" \"v\")))]\n-  \"TARGET_ALTIVEC\"\n-  \"vsububm %0,%1,%2\"\n-  [(set_attr \"type\" \"vecsimple\")])\n-\n-(define_insn \"subv8hi3\"\n-  [(set (match_operand:V8HI 0 \"register_operand\" \"=v\")\n-        (minus:V8HI (match_operand:V8HI 1 \"register_operand\" \"v\")\n-                    (match_operand:V8HI 2 \"register_operand\" \"v\")))]\n-  \"TARGET_ALTIVEC\"\n-  \"vsubuhm %0,%1,%2\"\n-  [(set_attr \"type\" \"vecsimple\")])\n-\n-(define_insn \"subv4si3\"\n-  [(set (match_operand:V4SI 0 \"register_operand\" \"=v\")\n-        (minus:V4SI (match_operand:V4SI 1 \"register_operand\" \"v\")\n-                    (match_operand:V4SI 2 \"register_operand\" \"v\")))]\n-  \"TARGET_ALTIVEC\"\n-  \"vsubuwm %0,%1,%2\"\n-  [(set_attr \"type\" \"vecsimple\")])\n-\n-(define_insn \"subv4sf3\"\n-  [(set (match_operand:V4SF 0 \"register_operand\" \"=v\")\n-        (minus:V4SF (match_operand:V4SF 1 \"register_operand\" \"v\")\n-                    (match_operand:V4SF 2 \"register_operand\" \"v\")))]\n-  \"TARGET_ALTIVEC\"\n-  \"vsubfp %0,%1,%2\"\n-  [(set_attr \"type\" \"vecfloat\")])\n-\n-(define_insn \"altivec_vsubcuw\"\n-  [(set (match_operand:V4SI 0 \"register_operand\" \"=v\")\n-        (unspec:V4SI [(match_operand:V4SI 1 \"register_operand\" \"v\")\n-                      (match_operand:V4SI 2 \"register_operand\" \"v\")] 124))]\n-  \"TARGET_ALTIVEC\"\n-  \"vsubcuw %0,%1,%2\"\n-  [(set_attr \"type\" \"vecsimple\")])\n-\n-(define_insn \"altivec_vsububs\"\n-  [(set (match_operand:V16QI 0 \"register_operand\" \"=v\")\n-        (unspec:V16QI [(match_operand:V16QI 1 \"register_operand\" \"v\")\n-                       (match_operand:V16QI 2 \"register_operand\" \"v\")] 125))\n-   (set (reg:SI 110) (unspec:SI [(const_int 0)] 213))]\n-  \"TARGET_ALTIVEC\"\n-  \"vsububs %0,%1,%2\"\n-  [(set_attr \"type\" \"vecsimple\")])\n-\n-(define_insn \"altivec_vsubsbs\"\n-  [(set (match_operand:V16QI 0 \"register_operand\" \"=v\")\n-        (unspec:V16QI [(match_operand:V16QI 1 \"register_operand\" \"v\")\n-                       (match_operand:V16QI 2 \"register_operand\" \"v\")] 126))\n-   (set (reg:SI 110) (unspec:SI [(const_int 0)] 213))]\n-  \"TARGET_ALTIVEC\"\n-  \"vsubsbs %0,%1,%2\"\n-  [(set_attr \"type\" \"vecsimple\")])\n-\n-(define_insn \"altivec_vsubuhs\"\n-  [(set (match_operand:V8HI 0 \"register_operand\" \"=v\")\n-        (unspec:V8HI [(match_operand:V8HI 1 \"register_operand\" \"v\")\n-                      (match_operand:V8HI 2 \"register_operand\" \"v\")] 127))\n-   (set (reg:SI 110) (unspec:SI [(const_int 0)] 213))]\n-  \"TARGET_ALTIVEC\"\n-  \"vsubuhs %0,%1,%2\"\n-  [(set_attr \"type\" \"vecsimple\")])\n-\n-(define_insn \"altivec_vsubshs\"\n-  [(set (match_operand:V8HI 0 \"register_operand\" \"=v\")\n-        (unspec:V8HI [(match_operand:V8HI 1 \"register_operand\" \"v\")\n-                      (match_operand:V8HI 2 \"register_operand\" \"v\")] 128))\n-   (set (reg:SI 110) (unspec:SI [(const_int 0)] 213))]\n-  \"TARGET_ALTIVEC\"\n-  \"vsubshs %0,%1,%2\"\n-  [(set_attr \"type\" \"vecsimple\")])\n-\n-(define_insn \"altivec_vsubuws\"\n-  [(set (match_operand:V4SI 0 \"register_operand\" \"=v\")\n-        (unspec:V4SI [(match_operand:V4SI 1 \"register_operand\" \"v\")\n-                      (match_operand:V4SI 2 \"register_operand\" \"v\")] 129))\n-   (set (reg:SI 110) (unspec:SI [(const_int 0)] 213))]\n-  \"TARGET_ALTIVEC\"\n-  \"vsubuws %0,%1,%2\"\n-  [(set_attr \"type\" \"vecsimple\")])\n-\n-(define_insn \"altivec_vsubsws\"\n-  [(set (match_operand:V4SI 0 \"register_operand\" \"=v\")\n-        (unspec:V4SI [(match_operand:V4SI 1 \"register_operand\" \"v\")\n-                      (match_operand:V4SI 2 \"register_operand\" \"v\")] 130))\n-   (set (reg:SI 110) (unspec:SI [(const_int 0)] 213))]\n-  \"TARGET_ALTIVEC\"\n-  \"vsubsws %0,%1,%2\"\n-  [(set_attr \"type\" \"vecsimple\")])\n-\n (define_insn \"altivec_vsum4ubs\"\n   [(set (match_operand:V4SI 0 \"register_operand\" \"=v\")\n         (unspec:V4SI [(match_operand:V16QI 1 \"register_operand\" \"v\")\n@@ -1345,32 +1229,6 @@\n   \"vsumsws %0,%1,%2\"\n   [(set_attr \"type\" \"veccomplex\")])\n \n-;; Vector xor's\n-(define_insn \"xorv4si3\"\n-  [(set (match_operand:V4SI 0 \"register_operand\" \"=v\")\n-        (xor:V4SI (match_operand:V4SI 1 \"register_operand\" \"v\")\n-                  (match_operand:V4SI 2 \"register_operand\" \"v\")))]\n-  \"TARGET_ALTIVEC\"\n-  \"vxor %0,%1,%2\"\n-  [(set_attr \"type\" \"vecsimple\")])\n-\n-(define_insn \"xorv8hi3\"\n-  [(set (match_operand:V8HI 0 \"register_operand\" \"=v\")\n-        (xor:V8HI (match_operand:V8HI 1 \"register_operand\" \"v\")\n-                  (match_operand:V8HI 2 \"register_operand\" \"v\")))]\n-  \"TARGET_ALTIVEC\"\n-  \"vxor %0,%1,%2\"\n-  [(set_attr \"type\" \"vecsimple\")])\n-\n-(define_insn \"xorv16qi3\"\n-  [(set (match_operand:V16QI 0 \"register_operand\" \"=v\")\n-        (xor:V16QI (match_operand:V16QI 1 \"register_operand\" \"v\")\n-\t\t   (match_operand:V16QI 2 \"register_operand\" \"v\")))]\n-  \"TARGET_ALTIVEC\"\n-  \"vxor %0,%1,%2\"\n-  [(set_attr \"type\" \"vecsimple\")])\n-;; End of vector xor's\n-\n (define_insn \"altivec_vspltb\"\n   [(set (match_operand:V16QI 0 \"register_operand\" \"=v\")\n         (vec_duplicate:V16QI"}, {"sha": "7e30f925dee4f0b3d0030abd7275a000b72ec94f", "filename": "gcc/config/rs6000/rs6000.c", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/f96bc213541a8a468935acd64e1170717a455cd7/gcc%2Fconfig%2Frs6000%2Frs6000.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/f96bc213541a8a468935acd64e1170717a455cd7/gcc%2Fconfig%2Frs6000%2Frs6000.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fconfig%2Frs6000%2Frs6000.c?ref=f96bc213541a8a468935acd64e1170717a455cd7", "patch": "@@ -6206,7 +6206,7 @@ static struct builtin_description bdesc_2arg[] =\n   { MASK_ALTIVEC, CODE_FOR_altivec_vmulosb, \"__builtin_altivec_vmulosb\", ALTIVEC_BUILTIN_VMULOSB },\n   { MASK_ALTIVEC, CODE_FOR_altivec_vmulouh, \"__builtin_altivec_vmulouh\", ALTIVEC_BUILTIN_VMULOUH },\n   { MASK_ALTIVEC, CODE_FOR_altivec_vmulosh, \"__builtin_altivec_vmulosh\", ALTIVEC_BUILTIN_VMULOSH },\n-  { MASK_ALTIVEC, CODE_FOR_altivec_vnor, \"__builtin_altivec_vnor\", ALTIVEC_BUILTIN_VNOR },\n+  { MASK_ALTIVEC, CODE_FOR_altivec_norv4si3, \"__builtin_altivec_vnor\", ALTIVEC_BUILTIN_VNOR },\n   { MASK_ALTIVEC, CODE_FOR_iorv4si3, \"__builtin_altivec_vor\", ALTIVEC_BUILTIN_VOR },\n   { MASK_ALTIVEC, CODE_FOR_altivec_vpkuhum, \"__builtin_altivec_vpkuhum\", ALTIVEC_BUILTIN_VPKUHUM },\n   { MASK_ALTIVEC, CODE_FOR_altivec_vpkuwum, \"__builtin_altivec_vpkuwum\", ALTIVEC_BUILTIN_VPKUWUM },"}]}