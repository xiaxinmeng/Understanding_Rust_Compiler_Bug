{"sha": "95b7c2e0c5439e4e9904c5bc4d78e553a4e802c7", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6OTViN2MyZTBjNTQzOWU0ZTk5MDRjNWJjNGQ3OGU1NTNhNGU4MDJjNw==", "commit": {"author": {"name": "Pierre-Marie de Rodat", "email": "derodat@adacore.com", "date": "2017-09-09T13:05:40Z"}, "committer": {"name": "Eric Botcazou", "email": "ebotcazou@gcc.gnu.org", "date": "2017-09-09T13:05:40Z"}, "message": "decl.c (gnat_to_gnu_entity): Don't generate debug info for inner record types if -fgnat-encodings=minimal.\n\n\t* gcc-interface/decl.c (gnat_to_gnu_entity) <E_Record_Type>: Don't\n\tgenerate debug info for inner record types if -fgnat-encodings=minimal.\n\t(gnat_to_gnu_entity) <E_Record_Subtype>: Use the ultimate base record\n\ttype as the debug type.\n\nFrom-SVN: r251937", "tree": {"sha": "88b17edddeafc6a440d4364ca02b928d737f82fe", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/88b17edddeafc6a440d4364ca02b928d737f82fe"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/95b7c2e0c5439e4e9904c5bc4d78e553a4e802c7", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/95b7c2e0c5439e4e9904c5bc4d78e553a4e802c7", "html_url": "https://github.com/Rust-GCC/gccrs/commit/95b7c2e0c5439e4e9904c5bc4d78e553a4e802c7", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/95b7c2e0c5439e4e9904c5bc4d78e553a4e802c7/comments", "author": {"login": "pmderodat", "id": 758452, "node_id": "MDQ6VXNlcjc1ODQ1Mg==", "avatar_url": "https://avatars.githubusercontent.com/u/758452?v=4", "gravatar_id": "", "url": "https://api.github.com/users/pmderodat", "html_url": "https://github.com/pmderodat", "followers_url": "https://api.github.com/users/pmderodat/followers", "following_url": "https://api.github.com/users/pmderodat/following{/other_user}", "gists_url": "https://api.github.com/users/pmderodat/gists{/gist_id}", "starred_url": "https://api.github.com/users/pmderodat/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/pmderodat/subscriptions", "organizations_url": "https://api.github.com/users/pmderodat/orgs", "repos_url": "https://api.github.com/users/pmderodat/repos", "events_url": "https://api.github.com/users/pmderodat/events{/privacy}", "received_events_url": "https://api.github.com/users/pmderodat/received_events", "type": "User", "site_admin": false}, "committer": null, "parents": [{"sha": "a713e7bb72617e88e9b2b64cecaffae7499146fb", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/a713e7bb72617e88e9b2b64cecaffae7499146fb", "html_url": "https://github.com/Rust-GCC/gccrs/commit/a713e7bb72617e88e9b2b64cecaffae7499146fb"}], "stats": {"total": 80, "additions": 73, "deletions": 7}, "files": [{"sha": "dee1897e7b7f91507d917a0c3493b0196b2faa13", "filename": "gcc/ada/ChangeLog", "status": "modified", "additions": 7, "deletions": 0, "changes": 7, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/95b7c2e0c5439e4e9904c5bc4d78e553a4e802c7/gcc%2Fada%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/95b7c2e0c5439e4e9904c5bc4d78e553a4e802c7/gcc%2Fada%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fada%2FChangeLog?ref=95b7c2e0c5439e4e9904c5bc4d78e553a4e802c7", "patch": "@@ -1,3 +1,10 @@\n+2017-09-09  Pierre-Marie de Rodat  <derodat@adacore.com>\n+\n+\t* gcc-interface/decl.c (gnat_to_gnu_entity) <E_Record_Type>: Don't\n+\tgenerate debug info for inner record types if -fgnat-encodings=minimal.\n+\t(gnat_to_gnu_entity) <E_Record_Subtype>: Use the ultimate base record\n+\ttype as the debug type.\n+\n 2017-09-09  Eric Botcazou  <ebotcazou@adacore.com>\n \n \t* gcc-interface/decl.c (components_to_record): Do not reorder in non-"}, {"sha": "7b30497587497841f87332de23cfa29dc2e808d3", "filename": "gcc/ada/gcc-interface/decl.c", "status": "modified", "additions": 19, "deletions": 5, "changes": 24, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/95b7c2e0c5439e4e9904c5bc4d78e553a4e802c7/gcc%2Fada%2Fgcc-interface%2Fdecl.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/95b7c2e0c5439e4e9904c5bc4d78e553a4e802c7/gcc%2Fada%2Fgcc-interface%2Fdecl.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fada%2Fgcc-interface%2Fdecl.c?ref=95b7c2e0c5439e4e9904c5bc4d78e553a4e802c7", "patch": "@@ -3308,10 +3308,14 @@ gnat_to_gnu_entity (Entity_Id gnat_entity, tree gnu_expr, bool definition)\n \t      = build_subst_list (gnat_entity, gnat_parent_type, definition);\n \n \t    /* Set the layout of the type to match that of the parent type,\n-\t       doing required substitutions.  */\n-\t    copy_and_substitute_in_layout (gnat_entity, gnat_parent_type,\n-\t\t\t\t\t   gnu_type, gnu_parent_type,\n-\t\t\t\t\t   gnu_subst_list, debug_info_p);\n+\t       doing required substitutions.  If we are in minimal GNAT\n+\t       encodings mode, we don't need debug info for the inner record\n+\t       types, as they will be part of the embedding variant record's\n+\t       debug info.  */\n+\t    copy_and_substitute_in_layout\n+\t      (gnat_entity, gnat_parent_type, gnu_type, gnu_parent_type,\n+\t       gnu_subst_list,\n+\t       debug_info_p && gnat_encodings != DWARF_GNAT_ENCODINGS_MINIMAL);\n \t  }\n \telse\n \t  {\n@@ -3439,7 +3443,17 @@ gnat_to_gnu_entity (Entity_Id gnat_entity, tree gnu_expr, bool definition)\n \t      gnu_type = make_node (RECORD_TYPE);\n \t      TYPE_NAME (gnu_type) = gnu_entity_name;\n \t      if (gnat_encodings == DWARF_GNAT_ENCODINGS_MINIMAL)\n-\t\tSET_TYPE_DEBUG_TYPE (gnu_type, gnu_base_type);\n+\t\t{\n+\t\t  /* Use the ultimate base record type as the debug type.\n+\t\t     Subtypes and derived types bring no useful\n+\t\t     information.  */\n+\t\t  Entity_Id gnat_debug_type = gnat_entity;\n+\t\t  while (Etype (gnat_debug_type) != gnat_debug_type)\n+\t\t    gnat_debug_type = Etype (gnat_debug_type);\n+\t\t  tree gnu_debug_type\n+\t\t    = TYPE_MAIN_VARIANT (gnat_to_gnu_type (gnat_debug_type));\n+\t\t  SET_TYPE_DEBUG_TYPE (gnu_type, gnu_debug_type);\n+\t\t}\n \t      TYPE_PACKED (gnu_type) = TYPE_PACKED (gnu_base_type);\n \t      TYPE_REVERSE_STORAGE_ORDER (gnu_type)\n \t\t= Reverse_Storage_Order (gnat_entity);"}, {"sha": "6f109c731469cd6b8270d1bbf93ac3f2412eaf30", "filename": "gcc/ada/gcc-interface/utils2.c", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/95b7c2e0c5439e4e9904c5bc4d78e553a4e802c7/gcc%2Fada%2Fgcc-interface%2Futils2.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/95b7c2e0c5439e4e9904c5bc4d78e553a4e802c7/gcc%2Fada%2Fgcc-interface%2Futils2.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fada%2Fgcc-interface%2Futils2.c?ref=95b7c2e0c5439e4e9904c5bc4d78e553a4e802c7", "patch": "@@ -6,7 +6,7 @@\n  *                                                                          *\n  *                          C Implementation File                           *\n  *                                                                          *\n- *          Copyright (C) 1992-2016, Free Software Foundation, Inc.         *\n+ *          Copyright (C) 1992-2017, Free Software Foundation, Inc.         *\n  *                                                                          *\n  * GNAT is free software;  you can  redistribute it  and/or modify it under *\n  * terms of the  GNU General Public License as published  by the Free Soft- *"}, {"sha": "35aadc7952de4bab6a13bec72f4992284845e359", "filename": "gcc/testsuite/ChangeLog", "status": "modified", "additions": 4, "deletions": 0, "changes": 4, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/95b7c2e0c5439e4e9904c5bc4d78e553a4e802c7/gcc%2Ftestsuite%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/95b7c2e0c5439e4e9904c5bc4d78e553a4e802c7/gcc%2Ftestsuite%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2FChangeLog?ref=95b7c2e0c5439e4e9904c5bc4d78e553a4e802c7", "patch": "@@ -1,3 +1,7 @@\n+2017-09-09  Pierre-Marie de Rodat  <derodat@adacore.com>\n+\n+\t* gnat.dg/debug14.adb: New test.\n+\n 2017-09-09  Eric Botcazou  <ebotcazou@adacore.com>\n \n \t* gnat.dg/specs/atomic3.ads: New test."}, {"sha": "19c1c43486da9e7f0e8622deb9abb0781eacd0a7", "filename": "gcc/testsuite/gnat.dg/debug11.adb", "status": "modified", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/95b7c2e0c5439e4e9904c5bc4d78e553a4e802c7/gcc%2Ftestsuite%2Fgnat.dg%2Fdebug11.adb", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/95b7c2e0c5439e4e9904c5bc4d78e553a4e802c7/gcc%2Ftestsuite%2Fgnat.dg%2Fdebug11.adb", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgnat.dg%2Fdebug11.adb?ref=95b7c2e0c5439e4e9904c5bc4d78e553a4e802c7", "patch": "@@ -1,3 +1,4 @@\n+--  { dg-do compile }\n --  { dg-options \"-cargs -O0 -g -dA -fgnat-encodings=minimal -margs\" }\n --\n --  This testcase checks that in the DWARF description of the variant type"}, {"sha": "c236dc474d98e2c9330eba758a1cb0e657beb141", "filename": "gcc/testsuite/gnat.dg/debug12.adb", "status": "modified", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/95b7c2e0c5439e4e9904c5bc4d78e553a4e802c7/gcc%2Ftestsuite%2Fgnat.dg%2Fdebug12.adb", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/95b7c2e0c5439e4e9904c5bc4d78e553a4e802c7/gcc%2Ftestsuite%2Fgnat.dg%2Fdebug12.adb", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgnat.dg%2Fdebug12.adb?ref=95b7c2e0c5439e4e9904c5bc4d78e553a4e802c7", "patch": "@@ -1,3 +1,4 @@\n+--  { dg-do compile }\n --  { dg-options \"-cargs -gdwarf-4 -fdebug-types-section -dA -margs\" }\n --  { dg-final { scan-assembler-times \"DW_AT_location\" 4 } }\n "}, {"sha": "f54a4e09770241f1b834d69c6424c9e6ee942c70", "filename": "gcc/testsuite/gnat.dg/debug13.adb", "status": "modified", "additions": 2, "deletions": 1, "changes": 3, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/95b7c2e0c5439e4e9904c5bc4d78e553a4e802c7/gcc%2Ftestsuite%2Fgnat.dg%2Fdebug13.adb", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/95b7c2e0c5439e4e9904c5bc4d78e553a4e802c7/gcc%2Ftestsuite%2Fgnat.dg%2Fdebug13.adb", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgnat.dg%2Fdebug13.adb?ref=95b7c2e0c5439e4e9904c5bc4d78e553a4e802c7", "patch": "@@ -1,4 +1,5 @@\n---  { dg-options \"-cargs -O2 -g -margs\" }\n+-- { dg-do compile }\n+-- { dg-options \"-O2 -g\" }\n \n package body Debug13 is\n "}, {"sha": "2cb91072740875071a1572dec2668c7622f7b8df", "filename": "gcc/testsuite/gnat.dg/debug14.adb", "status": "added", "additions": 38, "deletions": 0, "changes": 38, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/95b7c2e0c5439e4e9904c5bc4d78e553a4e802c7/gcc%2Ftestsuite%2Fgnat.dg%2Fdebug14.adb", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/95b7c2e0c5439e4e9904c5bc4d78e553a4e802c7/gcc%2Ftestsuite%2Fgnat.dg%2Fdebug14.adb", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgnat.dg%2Fdebug14.adb?ref=95b7c2e0c5439e4e9904c5bc4d78e553a4e802c7", "patch": "@@ -0,0 +1,38 @@\n+-- { dg-do compile }\n+-- { dg-options \"-g -fgnat-encodings=minimal\" }\n+\n+procedure Debug14 is\n+\n+  type Db_Kind_T is (Raw, Relational, Object);\n+\n+  type Db_Model_T (Kind : Db_Kind_T) is\n+    record\n+\n+      case Kind is\n+\n+        when Raw =>\n+          Fs_Type : Integer;\n+\n+        when Relational | Object =>\n+          Vendor_Id : Integer;\n+\n+          case Kind is\n+            when Relational =>\n+              N_Tables : Integer;\n+\n+            when others =>\n+              null;\n+          end case;\n+\n+      end case;\n+\n+    end record;\n+\n+  type Raw_Db_T is new Db_Model_T (Kind => Raw);\n+  type Raw_Db_P is access Raw_Db_T;\n+\n+  Db : Raw_Db_P := new Raw_Db_T;\n+\n+begin\n+  null;\n+end;"}]}