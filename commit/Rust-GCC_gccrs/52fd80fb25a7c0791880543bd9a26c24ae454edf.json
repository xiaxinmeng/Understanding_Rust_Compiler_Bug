{"sha": "52fd80fb25a7c0791880543bd9a26c24ae454edf", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6NTJmZDgwZmIyNWE3YzA3OTE4ODA1NDNiZDlhMjZjMjRhZTQ1NGVkZg==", "commit": {"author": {"name": "Richard Henderson", "email": "rth@redhat.com", "date": "2003-01-06T22:59:25Z"}, "committer": {"name": "Richard Henderson", "email": "rth@gcc.gnu.org", "date": "2003-01-06T22:59:25Z"}, "message": "alpha.c (alpha_encode_section_info): Adjust symbol_str properly when changing \"local-ness\".\n\n        * config/alpha/alpha.c (alpha_encode_section_info): Adjust symbol_str\n        properly when changing \"local-ness\".\n        * config/alpha/alpha.md (movdi_er_high_g): Allow all symbols.\n\n\t* gcc.dg/tls/alias-1.c: New.\n\nFrom-SVN: r60961", "tree": {"sha": "6ae43adb7de0ddcd2b1a1f5d7773a8c88c6f9029", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/6ae43adb7de0ddcd2b1a1f5d7773a8c88c6f9029"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/52fd80fb25a7c0791880543bd9a26c24ae454edf", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/52fd80fb25a7c0791880543bd9a26c24ae454edf", "html_url": "https://github.com/Rust-GCC/gccrs/commit/52fd80fb25a7c0791880543bd9a26c24ae454edf", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/52fd80fb25a7c0791880543bd9a26c24ae454edf/comments", "author": null, "committer": null, "parents": [{"sha": "a16b43c5c5fbdfce6c8b890af7c287e4f56e1106", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/a16b43c5c5fbdfce6c8b890af7c287e4f56e1106", "html_url": "https://github.com/Rust-GCC/gccrs/commit/a16b43c5c5fbdfce6c8b890af7c287e4f56e1106"}], "stats": {"total": 43, "additions": 38, "deletions": 5}, "files": [{"sha": "90ac3867982fcd839e2989918851d807ad35e8af", "filename": "gcc/ChangeLog", "status": "modified", "additions": 6, "deletions": 0, "changes": 6, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/52fd80fb25a7c0791880543bd9a26c24ae454edf/gcc%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/52fd80fb25a7c0791880543bd9a26c24ae454edf/gcc%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2FChangeLog?ref=52fd80fb25a7c0791880543bd9a26c24ae454edf", "patch": "@@ -1,3 +1,9 @@\n+2003-01-06  Richard Henderson  <rth@redhat.com>\n+\n+\t* config/alpha/alpha.c (alpha_encode_section_info): Adjust symbol_str\n+\tproperly when changing \"local-ness\".\n+\t* config/alpha/alpha.md (movdi_er_high_g): Allow all symbols.\n+\n 2003-01-06  Dale Johannesen  <dalej@apple.com>\n \n \t* config/darwin-protos.h:  Add prototypes for new section functions."}, {"sha": "ce0810d0d262cff4b890b2a62a690843a28b1c02", "filename": "gcc/config/alpha/alpha.c", "status": "modified", "additions": 7, "deletions": 3, "changes": 10, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/52fd80fb25a7c0791880543bd9a26c24ae454edf/gcc%2Fconfig%2Falpha%2Falpha.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/52fd80fb25a7c0791880543bd9a26c24ae454edf/gcc%2Fconfig%2Falpha%2Falpha.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fconfig%2Falpha%2Falpha.c?ref=52fd80fb25a7c0791880543bd9a26c24ae454edf", "patch": "@@ -1,6 +1,6 @@\n /* Subroutines used for code generation on the DEC Alpha.\n    Copyright (C) 1992, 1993, 1994, 1995, 1996, 1997, 1998, 1999,\n-   2000, 2001, 2002 Free Software Foundation, Inc. \n+   2000, 2001, 2002, 2003 Free Software Foundation, Inc. \n    Contributed by Richard Kenner (kenner@vlsi1.ultra.nyu.edu)\n \n This file is part of GNU CC.\n@@ -1974,18 +1974,22 @@ alpha_encode_section_info (decl, first)\n     {\n       char *newstr;\n       size_t len;\n+      char want_prefix = (is_local ? '@' : '%');\n+      char other_prefix = (is_local ? '%' : '@');\n \n-      if (symbol_str[0] == (is_local ? '@' : '%'))\n+      if (symbol_str[0] == want_prefix)\n \t{\n \t  if (symbol_str[1] == encoding)\n \t    return;\n \t  symbol_str += 2;\n \t}\n+      else if (symbol_str[0] == other_prefix)\n+\tsymbol_str += 2;\n \n       len = strlen (symbol_str) + 1;\n       newstr = alloca (len + 2);\n \n-      newstr[0] = (is_local ? '@' : '%');\n+      newstr[0] = want_prefix;\n       newstr[1] = encoding;\n       memcpy (newstr + 2, symbol_str, len);\n \t  "}, {"sha": "ed93441b8f65bfb12cff246a03ed37f1c3caec48", "filename": "gcc/config/alpha/alpha.md", "status": "modified", "additions": 4, "deletions": 2, "changes": 6, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/52fd80fb25a7c0791880543bd9a26c24ae454edf/gcc%2Fconfig%2Falpha%2Falpha.md", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/52fd80fb25a7c0791880543bd9a26c24ae454edf/gcc%2Fconfig%2Falpha%2Falpha.md", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fconfig%2Falpha%2Falpha.md?ref=52fd80fb25a7c0791880543bd9a26c24ae454edf", "patch": "@@ -1,6 +1,6 @@\n ;; Machine description for DEC Alpha for GNU C compiler\n ;; Copyright (C) 1992, 1993, 1994, 1995, 1996, 1997, 1998, 1999,\n-;; 2000, 2001, 2002 Free Software Foundation, Inc.\n+;; 2000, 2001, 2002, 2003 Free Software Foundation, Inc.\n ;; Contributed by Richard Kenner (kenner@vlsi1.ultra.nyu.edu)\n ;;\n ;; This file is part of GNU CC.\n@@ -5330,10 +5330,12 @@ fadd,fmul,fcpys,fdiv,fsqrt,misc,mvi,ftoi,itof,multi,none\"\n   [(match_dup 0)]\n   \"operands[0] = split_small_symbolic_operand (operands[0]);\")\n \n+;; Accepts any symbolic, not just global, since function calls that\n+;; don't go via bsr still use !literal in hopes of linker relaxation.\n (define_insn \"movdi_er_high_g\"\n   [(set (match_operand:DI 0 \"register_operand\" \"=r\")\n \t(unspec:DI [(match_operand:DI 1 \"register_operand\" \"r\")\n-\t\t    (match_operand:DI 2 \"global_symbolic_operand\" \"\")\n+\t\t    (match_operand:DI 2 \"symbolic_operand\" \"\")\n \t\t    (match_operand 3 \"const_int_operand\" \"\")]\n \t\t   UNSPEC_LITERAL))]\n   \"TARGET_EXPLICIT_RELOCS\""}, {"sha": "3372da3d10cbfb37ecf9957edcc38492ad1a30eb", "filename": "gcc/testsuite/gcc.dg/tls/alias-1.c", "status": "added", "additions": 21, "deletions": 0, "changes": 21, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/52fd80fb25a7c0791880543bd9a26c24ae454edf/gcc%2Ftestsuite%2Fgcc.dg%2Ftls%2Falias-1.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/52fd80fb25a7c0791880543bd9a26c24ae454edf/gcc%2Ftestsuite%2Fgcc.dg%2Ftls%2Falias-1.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgcc.dg%2Ftls%2Falias-1.c?ref=52fd80fb25a7c0791880543bd9a26c24ae454edf", "patch": "@@ -0,0 +1,21 @@\n+/* { dg-do link } */\n+/* Test that encode_section_info handles the change from externally\n+   defined to locally defined (via hidden).   Extracted from glibc.  */\n+\n+struct __res_state {\n+\tchar x[123];\n+};\n+\n+extern __thread struct __res_state bar\n+  __attribute__ ((tls_model (\"initial-exec\")));\n+\n+int main()\n+{\n+  bar.x[0] = 0;\n+  return 0;\n+}\n+\n+__thread struct __res_state foo;\n+extern __thread struct __res_state bar\n+  __attribute__ ((alias (\"foo\")))\n+  __attribute__ ((visibility (\"hidden\")));"}]}