{"sha": "3f3d6a6fa343d0c2af623559122a29cb21b7aa6c", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6M2YzZDZhNmZhMzQzZDBjMmFmNjIzNTU5MTIyYTI5Y2IyMWI3YWE2Yw==", "commit": {"author": {"name": "Marek Polacek", "email": "polacek@redhat.com", "date": "2019-06-21T14:41:22Z"}, "committer": {"name": "Marek Polacek", "email": "mpolacek@gcc.gnu.org", "date": "2019-06-21T14:41:22Z"}, "message": "PR c++/90953 - ICE with -Wmissing-format-attribute.\n\n\t* c-common.c (check_function_arguments_recurse): Use\n\tget_attribute_name.\n\t(check_missing_format_attribute): Likewise.\n\n\t* g++.dg/warn/miss-format-7.C: New test.\n\nFrom-SVN: r272552", "tree": {"sha": "bab20b776fc903db8c55da2dd4b134e683a92277", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/bab20b776fc903db8c55da2dd4b134e683a92277"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/3f3d6a6fa343d0c2af623559122a29cb21b7aa6c", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/3f3d6a6fa343d0c2af623559122a29cb21b7aa6c", "html_url": "https://github.com/Rust-GCC/gccrs/commit/3f3d6a6fa343d0c2af623559122a29cb21b7aa6c", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/3f3d6a6fa343d0c2af623559122a29cb21b7aa6c/comments", "author": {"login": "mpolacek", "id": 10496300, "node_id": "MDQ6VXNlcjEwNDk2MzAw", "avatar_url": "https://avatars.githubusercontent.com/u/10496300?v=4", "gravatar_id": "", "url": "https://api.github.com/users/mpolacek", "html_url": "https://github.com/mpolacek", "followers_url": "https://api.github.com/users/mpolacek/followers", "following_url": "https://api.github.com/users/mpolacek/following{/other_user}", "gists_url": "https://api.github.com/users/mpolacek/gists{/gist_id}", "starred_url": "https://api.github.com/users/mpolacek/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/mpolacek/subscriptions", "organizations_url": "https://api.github.com/users/mpolacek/orgs", "repos_url": "https://api.github.com/users/mpolacek/repos", "events_url": "https://api.github.com/users/mpolacek/events{/privacy}", "received_events_url": "https://api.github.com/users/mpolacek/received_events", "type": "User", "site_admin": false}, "committer": null, "parents": [{"sha": "390549c8a15f6527ae92697f1eb084576cafd561", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/390549c8a15f6527ae92697f1eb084576cafd561", "html_url": "https://github.com/Rust-GCC/gccrs/commit/390549c8a15f6527ae92697f1eb084576cafd561"}], "stats": {"total": 47, "additions": 44, "deletions": 3}, "files": [{"sha": "c1522b249b547829de2ba3e1a932d953e1693eca", "filename": "gcc/c-family/ChangeLog", "status": "modified", "additions": 7, "deletions": 0, "changes": 7, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/3f3d6a6fa343d0c2af623559122a29cb21b7aa6c/gcc%2Fc-family%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/3f3d6a6fa343d0c2af623559122a29cb21b7aa6c/gcc%2Fc-family%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fc-family%2FChangeLog?ref=3f3d6a6fa343d0c2af623559122a29cb21b7aa6c", "patch": "@@ -1,3 +1,10 @@\n+2019-06-21  Marek Polacek  <polacek@redhat.com>\n+\n+\tPR c++/90953 - ICE with -Wmissing-format-attribute.\n+\t* c-common.c (check_function_arguments_recurse): Use\n+\tget_attribute_name.\n+\t(check_missing_format_attribute): Likewise.\n+\n 2019-06-19  Marek Polacek  <polacek@redhat.com>\n \n \tPR c++/60364 - noreturn after first decl not diagnosed."}, {"sha": "f562704006734a261e5d6137780916ebed06265e", "filename": "gcc/c-family/c-common.c", "status": "modified", "additions": 3, "deletions": 3, "changes": 6, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/3f3d6a6fa343d0c2af623559122a29cb21b7aa6c/gcc%2Fc-family%2Fc-common.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/3f3d6a6fa343d0c2af623559122a29cb21b7aa6c/gcc%2Fc-family%2Fc-common.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fc-family%2Fc-common.c?ref=3f3d6a6fa343d0c2af623559122a29cb21b7aa6c", "patch": "@@ -5753,7 +5753,7 @@ check_function_arguments_recurse (void (*callback)\n       for (attrs = TYPE_ATTRIBUTES (type);\n \t   attrs;\n \t   attrs = TREE_CHAIN (attrs))\n-\tif (is_attribute_p (\"format_arg\", TREE_PURPOSE (attrs)))\n+\tif (is_attribute_p (\"format_arg\", get_attribute_name (attrs)))\n \t  {\n \t    tree inner_arg;\n \t    tree format_num_expr;\n@@ -7601,13 +7601,13 @@ check_missing_format_attribute (tree ltype, tree rtype)\n   tree ra;\n \n   for (ra = TYPE_ATTRIBUTES (ttr); ra; ra = TREE_CHAIN (ra))\n-    if (is_attribute_p (\"format\", TREE_PURPOSE (ra)))\n+    if (is_attribute_p (\"format\", get_attribute_name (ra)))\n       break;\n   if (ra)\n     {\n       tree la;\n       for (la = TYPE_ATTRIBUTES (ttl); la; la = TREE_CHAIN (la))\n-\tif (is_attribute_p (\"format\", TREE_PURPOSE (la)))\n+\tif (is_attribute_p (\"format\", get_attribute_name (la)))\n \t  break;\n       return !la;\n     }"}, {"sha": "55ca5abef42e5925b0047fa1985832b36069f7c8", "filename": "gcc/testsuite/ChangeLog", "status": "modified", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/3f3d6a6fa343d0c2af623559122a29cb21b7aa6c/gcc%2Ftestsuite%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/3f3d6a6fa343d0c2af623559122a29cb21b7aa6c/gcc%2Ftestsuite%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2FChangeLog?ref=3f3d6a6fa343d0c2af623559122a29cb21b7aa6c", "patch": "@@ -1,3 +1,8 @@\n+2019-06-21  Marek Polacek  <polacek@redhat.com>\n+\n+\tPR c++/90953 - ICE with -Wmissing-format-attribute.\n+\t* g++.dg/warn/miss-format-7.C: New test.\n+\n 2019-06-21  Richard Biener  <rguenther@suse.de>\n \n \tPR debug/90914"}, {"sha": "ac892dcec6dadb70f70313d51f85d372334dff76", "filename": "gcc/testsuite/g++.dg/warn/miss-format-7.C", "status": "added", "additions": 29, "deletions": 0, "changes": 29, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/3f3d6a6fa343d0c2af623559122a29cb21b7aa6c/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Fwarn%2Fmiss-format-7.C", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/3f3d6a6fa343d0c2af623559122a29cb21b7aa6c/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Fwarn%2Fmiss-format-7.C", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Fwarn%2Fmiss-format-7.C?ref=3f3d6a6fa343d0c2af623559122a29cb21b7aa6c", "patch": "@@ -0,0 +1,29 @@\n+// PR c++/90953 - ICE with -Wmissing-format-attribute.\n+// { dg-do compile { target c++11 } }\n+// { dg-options \"-Wmissing-format-attribute\" }\n+\n+namespace std {\n+union [[gnu::may_alias]] _Any_data{};\n+enum _Manager_operation { __get_type_info };\n+template <typename> class A;\n+class B {\n+  typedef bool (*_Manager_type)(_Any_data, const _Any_data &,\n+                                _Manager_operation);\n+public:\n+  _Any_data _M_functor;\n+  _Manager_type _M_manager;\n+};\n+\n+struct type_info { } t;\n+\n+template <typename _Res, typename... _ArgTypes>\n+class A<_Res(_ArgTypes...)> : B {\n+  const type_info &target_type() const noexcept;\n+};\n+template <typename _Res, typename... _ArgTypes>\n+const type_info &A<_Res(_ArgTypes...)>::target_type() const noexcept {\n+  _Any_data __typeinfo_result;\n+  _M_manager(__typeinfo_result, _M_functor, __get_type_info);\n+  return t;\n+}\n+} // namespace std"}]}