{"sha": "28cb76675ea1383deb22651d8f3459bb76d8b2bf", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6MjhjYjc2Njc1ZWExMzgzZGViMjI2NTFkOGYzNDU5YmI3NmQ4YjJiZg==", "commit": {"author": {"name": "Richard Henderson", "email": "rth@redhat.com", "date": "2004-07-08T23:53:14Z"}, "committer": {"name": "Richard Henderson", "email": "rth@gcc.gnu.org", "date": "2004-07-08T23:53:14Z"}, "message": "frv-protos.h (frv_expand_builtin_va_arg): Remove.\n\n        * config/frv/frv-protos.h (frv_expand_builtin_va_arg): Remove.\n        * config/frv/frv.c (TARGET_GIMPLIFY_VA_ARG_EXPR): New.\n        (frv_gimplify_va_arg_expr): Rewrite from frv_expand_builtin_va_arg.\n        * config/frv/frv.h (EXPAND_BUILTIN_VA_ARG): Remove.\n\nFrom-SVN: r84329", "tree": {"sha": "49f92788482633684c87e0866bdaaf28129ab233", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/49f92788482633684c87e0866bdaaf28129ab233"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/28cb76675ea1383deb22651d8f3459bb76d8b2bf", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/28cb76675ea1383deb22651d8f3459bb76d8b2bf", "html_url": "https://github.com/Rust-GCC/gccrs/commit/28cb76675ea1383deb22651d8f3459bb76d8b2bf", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/28cb76675ea1383deb22651d8f3459bb76d8b2bf/comments", "author": null, "committer": null, "parents": [{"sha": "c6db08cd564e877e192e1c499ab51cf04102eaa9", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/c6db08cd564e877e192e1c499ab51cf04102eaa9", "html_url": "https://github.com/Rust-GCC/gccrs/commit/c6db08cd564e877e192e1c499ab51cf04102eaa9"}], "stats": {"total": 44, "additions": 14, "deletions": 30}, "files": [{"sha": "63a702bc2e700c0e8c21404c167ade1a6b0a2a71", "filename": "gcc/ChangeLog", "status": "modified", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/28cb76675ea1383deb22651d8f3459bb76d8b2bf/gcc%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/28cb76675ea1383deb22651d8f3459bb76d8b2bf/gcc%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2FChangeLog?ref=28cb76675ea1383deb22651d8f3459bb76d8b2bf", "patch": "@@ -1,5 +1,10 @@\n 2004-07-08  Richard Henderson  <rth@redhat.com>\n \n+\t* config/frv/frv-protos.h (frv_expand_builtin_va_arg): Remove.\n+\t* config/frv/frv.c (TARGET_GIMPLIFY_VA_ARG_EXPR): New.\n+\t(frv_gimplify_va_arg_expr): Rewrite from frv_expand_builtin_va_arg.\n+\t* config/frv/frv.h (EXPAND_BUILTIN_VA_ARG): Remove.\n+\n \t* config/i860/i860-protos.h (i860_va_arg): Remove.\n \t* config/i860/i860.c (TARGET_GIMPLIFY_VA_ARG_EXPR): New.\n \t(i860_gimplify_va_arg_expr): Rewrite from i860_va_arg."}, {"sha": "a7a8ee667f65173e26d2c8371ef6667a50fca660", "filename": "gcc/config/frv/frv-protos.h", "status": "modified", "additions": 0, "deletions": 1, "changes": 1, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/28cb76675ea1383deb22651d8f3459bb76d8b2bf/gcc%2Fconfig%2Ffrv%2Ffrv-protos.h", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/28cb76675ea1383deb22651d8f3459bb76d8b2bf/gcc%2Fconfig%2Ffrv%2Ffrv-protos.h", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fconfig%2Ffrv%2Ffrv-protos.h?ref=28cb76675ea1383deb22651d8f3459bb76d8b2bf", "patch": "@@ -93,7 +93,6 @@ extern int frv_function_arg_callee_copies\t(CUMULATIVE_ARGS *,\n \t\t\t\t\t\t tree, int);\n \n extern void frv_expand_builtin_va_start\t\t(tree, rtx);\n-extern rtx frv_expand_builtin_va_arg\t\t(tree, tree);\n #endif /* TREE_CODE */\n \n extern int frv_expand_block_move\t\t(rtx *);"}, {"sha": "98663202297ceeab4fbbd27a6f1bd0c3755be0f6", "filename": "gcc/config/frv/frv.c", "status": "modified", "additions": 9, "deletions": 23, "changes": 32, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/28cb76675ea1383deb22651d8f3459bb76d8b2bf/gcc%2Fconfig%2Ffrv%2Ffrv.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/28cb76675ea1383deb22651d8f3459bb76d8b2bf/gcc%2Fconfig%2Ffrv%2Ffrv.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fconfig%2Ffrv%2Ffrv.c?ref=28cb76675ea1383deb22651d8f3459bb76d8b2bf", "patch": "@@ -286,6 +286,7 @@ static void frv_output_const_unspec\t\t(FILE *,\n \t\t\t\t\t\t const struct frv_unspec *);\n static bool frv_function_ok_for_sibcall\t\t(tree, tree);\n static rtx frv_struct_value_rtx\t\t\t(tree, int);\n+static tree frv_gimplify_va_arg_expr\t\t(tree, tree, tree *, tree *);\n \f\n /* Initialize the GCC target structure.  */\n #undef  TARGET_ASM_FUNCTION_PROLOGUE\n@@ -331,6 +332,8 @@ static rtx frv_struct_value_rtx\t\t\t(tree, int);\n #define TARGET_EXPAND_BUILTIN_SAVEREGS frv_expand_builtin_saveregs\n #undef TARGET_SETUP_INCOMING_VARARGS\n #define TARGET_SETUP_INCOMING_VARARGS frv_setup_incoming_varargs\n+#undef TARGET_GIMPLIFY_VA_ARG_EXPR\n+#define TARGET_GIMPLIFY_VA_ARG_EXPR frv_gimplify_va_arg_expr\n \n struct gcc_target targetm = TARGET_INITIALIZER;\n \f\n@@ -2081,30 +2084,13 @@ frv_expand_builtin_va_start (tree valist, rtx nextarg)\n \f\n /* Expand __builtin_va_arg to do the va_arg macro.  */\n \n-rtx\n-frv_expand_builtin_va_arg (tree valist, tree type)\n+static tree\n+frv_gimplify_va_arg_expr (tree valist, tree type, tree *pre_p, tree *post_p)\n {\n-  rtx addr;\n-  rtx mem;\n-  rtx reg;\n-\n-  if (TARGET_DEBUG_ARG)\n-    {\n-      fprintf (stderr, \"va_arg:\\n\");\n-      debug_tree (type);\n-    }\n-\n-  if (! AGGREGATE_TYPE_P (type))\n-    return std_expand_builtin_va_arg (valist, type);\n-\n-  addr = std_expand_builtin_va_arg (valist, ptr_type_node);\n-  mem  = gen_rtx_MEM (Pmode, addr);\n-  reg  = gen_reg_rtx (Pmode);\n-\n-  set_mem_alias_set (mem, get_varargs_alias_set ());\n-  emit_move_insn (reg, mem);\n-\n-  return reg;\n+  if (AGGREGATE_TYPE_P (type))\n+    return ind_gimplify_va_arg_expr (valist, type, pre_p, post_p);\n+  else\n+    return std_gimplify_va_arg_expr (valist, type, pre_p, post_p);\n }\n \n \f"}, {"sha": "29d22e44fb9ccbe80547c1efb984906028ebe4bd", "filename": "gcc/config/frv/frv.h", "status": "modified", "additions": 0, "deletions": 6, "changes": 6, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/28cb76675ea1383deb22651d8f3459bb76d8b2bf/gcc%2Fconfig%2Ffrv%2Ffrv.h", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/28cb76675ea1383deb22651d8f3459bb76d8b2bf/gcc%2Fconfig%2Ffrv%2Ffrv.h", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fconfig%2Ffrv%2Ffrv.h?ref=28cb76675ea1383deb22651d8f3459bb76d8b2bf", "patch": "@@ -2147,12 +2147,6 @@ struct machine_function GTY(())\n #define EXPAND_BUILTIN_VA_START(VALIST, NEXTARG)\t\t\\\n   (frv_expand_builtin_va_start(VALIST, NEXTARG))\n \n-/* Implement the stdarg/varargs va_arg macro.  VALIST is the variable of type\n-   va_list as a tree, TYPE is the type passed to va_arg.  */\n-\n-#define EXPAND_BUILTIN_VA_ARG(VALIST, TYPE)\t\t\t\t\\\n-  (frv_expand_builtin_va_arg (VALIST, TYPE))\n-\n \f\n /* Trampolines for Nested Functions.  */\n "}]}