{"sha": "90f11cf950130d1aa6030a3c0df2e400ca14df7b", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6OTBmMTFjZjk1MDEzMGQxYWE2MDMwYTNjMGRmMmU0MDBjYTE0ZGY3Yg==", "commit": {"author": {"name": "Jason Merrill", "email": "jason@redhat.com", "date": "2015-05-08T04:42:06Z"}, "committer": {"name": "Jason Merrill", "email": "jason@gcc.gnu.org", "date": "2015-05-08T04:42:06Z"}, "message": "re PR c++/59012 (alignas does not support parameter pack expansions)\n\n\tPR c++/59012\n\t* parser.c (cp_parser_std_attribute_list): Handle attribute expansion.\n\t(cp_parser_std_attribute_spec): Handle alignas pack expansion.\n\t* decl2.c (is_late_template_attribute): An attribute exp is dependent.\n\t* pt.c (make_pack_expansion): Allow TREE_LIST for attribute expansion.\n\t(apply_late_template_attributes): Handle attribute pack expansion.\n\nFrom-SVN: r222902", "tree": {"sha": "b2591e49fe79dd3800adbf26cc69f460692ac9a4", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/b2591e49fe79dd3800adbf26cc69f460692ac9a4"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/90f11cf950130d1aa6030a3c0df2e400ca14df7b", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/90f11cf950130d1aa6030a3c0df2e400ca14df7b", "html_url": "https://github.com/Rust-GCC/gccrs/commit/90f11cf950130d1aa6030a3c0df2e400ca14df7b", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/90f11cf950130d1aa6030a3c0df2e400ca14df7b/comments", "author": {"login": "jicama", "id": 266146, "node_id": "MDQ6VXNlcjI2NjE0Ng==", "avatar_url": "https://avatars.githubusercontent.com/u/266146?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jicama", "html_url": "https://github.com/jicama", "followers_url": "https://api.github.com/users/jicama/followers", "following_url": "https://api.github.com/users/jicama/following{/other_user}", "gists_url": "https://api.github.com/users/jicama/gists{/gist_id}", "starred_url": "https://api.github.com/users/jicama/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jicama/subscriptions", "organizations_url": "https://api.github.com/users/jicama/orgs", "repos_url": "https://api.github.com/users/jicama/repos", "events_url": "https://api.github.com/users/jicama/events{/privacy}", "received_events_url": "https://api.github.com/users/jicama/received_events", "type": "User", "site_admin": false}, "committer": null, "parents": [{"sha": "d87333bcc8e322d0469e184e8a195018536e77df", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/d87333bcc8e322d0469e184e8a195018536e77df", "html_url": "https://github.com/Rust-GCC/gccrs/commit/d87333bcc8e322d0469e184e8a195018536e77df"}], "stats": {"total": 71, "additions": 66, "deletions": 5}, "files": [{"sha": "8427e9d2782a29d0023d5c1a1e59583a4ee4432a", "filename": "gcc/cp/ChangeLog", "status": "modified", "additions": 9, "deletions": 0, "changes": 9, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/90f11cf950130d1aa6030a3c0df2e400ca14df7b/gcc%2Fcp%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/90f11cf950130d1aa6030a3c0df2e400ca14df7b/gcc%2Fcp%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fcp%2FChangeLog?ref=90f11cf950130d1aa6030a3c0df2e400ca14df7b", "patch": "@@ -1,3 +1,12 @@\n+2015-05-07  Jason Merrill  <jason@redhat.com>\n+\n+\tPR c++/59012\n+\t* parser.c (cp_parser_std_attribute_list): Handle attribute expansion.\n+\t(cp_parser_std_attribute_spec): Handle alignas pack expansion.\n+\t* decl2.c (is_late_template_attribute): An attribute exp is dependent.\n+\t* pt.c (make_pack_expansion): Allow TREE_LIST for attribute expansion.\n+\t(apply_late_template_attributes): Handle attribute pack expansion.\n+\n 2015-05-07  Marek Polacek  <polacek@redhat.com>\n \n \tPR c/65179"}, {"sha": "2276bd67acea877ab928202faf6a32fb1d209437", "filename": "gcc/cp/decl2.c", "status": "modified", "additions": 4, "deletions": 0, "changes": 4, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/90f11cf950130d1aa6030a3c0df2e400ca14df7b/gcc%2Fcp%2Fdecl2.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/90f11cf950130d1aa6030a3c0df2e400ca14df7b/gcc%2Fcp%2Fdecl2.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fcp%2Fdecl2.c?ref=90f11cf950130d1aa6030a3c0df2e400ca14df7b", "patch": "@@ -1175,6 +1175,10 @@ is_late_template_attribute (tree attr, tree decl)\n       && is_attribute_p (\"omp declare simd\", name))\n     return true;\n \n+  /* An attribute pack is clearly dependent.  */\n+  if (args && PACK_EXPANSION_P (args))\n+    return true;\n+\n   /* If any of the arguments are dependent expressions, we can't evaluate\n      the attribute until instantiation time.  */\n   for (arg = args; arg; arg = TREE_CHAIN (arg))"}, {"sha": "3d165da708fe36e0533560b686670dcbff233f68", "filename": "gcc/cp/parser.c", "status": "modified", "additions": 17, "deletions": 3, "changes": 20, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/90f11cf950130d1aa6030a3c0df2e400ca14df7b/gcc%2Fcp%2Fparser.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/90f11cf950130d1aa6030a3c0df2e400ca14df7b/gcc%2Fcp%2Fparser.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fcp%2Fparser.c?ref=90f11cf950130d1aa6030a3c0df2e400ca14df7b", "patch": "@@ -22486,6 +22486,13 @@ cp_parser_std_attribute_list (cp_parser *parser)\n \t  attributes = attribute;\n \t}\n       token = cp_lexer_peek_token (parser->lexer);\n+      if (token->type == CPP_ELLIPSIS)\n+\t{\n+\t  cp_lexer_consume_token (parser->lexer);\n+\t  TREE_VALUE (attribute)\n+\t    = make_pack_expansion (TREE_VALUE (attribute));\n+\t  token = cp_lexer_peek_token (parser->lexer);\n+\t}\n       if (token->type != CPP_COMMA)\n \tbreak;\n       cp_lexer_consume_token (parser->lexer);\n@@ -22564,20 +22571,27 @@ cp_parser_std_attribute_spec (cp_parser *parser)\n \t    return alignas_expr;\n \t}\n \n+      alignas_expr = cxx_alignas_expr (alignas_expr);\n+      alignas_expr = build_tree_list (NULL_TREE, alignas_expr);\n+\n+      if (cp_lexer_next_token_is (parser->lexer, CPP_ELLIPSIS))\n+\t{\n+\t  cp_lexer_consume_token (parser->lexer);\n+\t  alignas_expr = make_pack_expansion (alignas_expr);\n+\t}\n+\n       if (cp_parser_require (parser, CPP_CLOSE_PAREN, RT_CLOSE_PAREN) == NULL)\n \t{\n \t  cp_parser_error (parser, \"expected %<)%>\");\n \t  return error_mark_node;\n \t}\n \n-      alignas_expr = cxx_alignas_expr (alignas_expr);\n-\n       /* Build the C++-11 representation of an 'aligned'\n \t attribute.  */\n       attributes =\n \tbuild_tree_list (build_tree_list (get_identifier (\"gnu\"),\n \t\t\t\t\t  get_identifier (\"aligned\")),\n-\t\t\t build_tree_list (NULL_TREE, alignas_expr));\n+\t\t\t alignas_expr);\n     }\n \n   return attributes;"}, {"sha": "78714745452c079f46db03e11e6dbad382aabd60", "filename": "gcc/cp/pt.c", "status": "modified", "additions": 17, "deletions": 2, "changes": 19, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/90f11cf950130d1aa6030a3c0df2e400ca14df7b/gcc%2Fcp%2Fpt.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/90f11cf950130d1aa6030a3c0df2e400ca14df7b/gcc%2Fcp%2Fpt.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fcp%2Fpt.c?ref=90f11cf950130d1aa6030a3c0df2e400ca14df7b", "patch": "@@ -3338,9 +3338,9 @@ make_pack_expansion (tree arg)\n   if (!arg || arg == error_mark_node)\n     return arg;\n \n-  if (TREE_CODE (arg) == TREE_LIST)\n+  if (TREE_CODE (arg) == TREE_LIST && TREE_PURPOSE (arg))\n     {\n-      /* The only time we will see a TREE_LIST here is for a base\n+      /* A TREE_LIST with a non-null TREE_PURPOSE is for a base\n          class initializer.  In this case, the TREE_PURPOSE will be a\n          _TYPE node (representing the base class expansion we're\n          initializing) and the TREE_VALUE will be a TREE_LIST\n@@ -9012,6 +9012,21 @@ apply_late_template_attributes (tree *decl_p, tree attributes, int attr_flags,\n \t\t      = tree_cons (NULL_TREE, TREE_VALUE (TREE_VALUE (t)),\n \t\t\t\t   chain);\n \t\t}\n+\t      else if (TREE_VALUE (t) && PACK_EXPANSION_P (TREE_VALUE (t)))\n+\t\t{\n+\t\t  /* An attribute pack expansion.  */\n+\t\t  tree purp = TREE_PURPOSE (t);\n+\t\t  tree pack = (tsubst_pack_expansion\n+\t\t\t       (TREE_VALUE (t), args, complain, in_decl));\n+\t\t  int len = TREE_VEC_LENGTH (pack);\n+\t\t  for (int i = 0; i < len; ++i)\n+\t\t    {\n+\t\t      tree elt = TREE_VEC_ELT (pack, i);\n+\t\t      *q = build_tree_list (purp, elt);\n+\t\t      q = &TREE_CHAIN (*q);\n+\t\t    }\n+\t\t  continue;\n+\t\t}\n \t      else\n \t\tTREE_VALUE (t)\n \t\t  = tsubst_expr (TREE_VALUE (t), args, complain, in_decl,"}, {"sha": "871aaefed1ff9a679bcdd449a5cf37480ae1a84c", "filename": "gcc/testsuite/g++.dg/cpp0x/alignas4.C", "status": "added", "additions": 19, "deletions": 0, "changes": 19, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/90f11cf950130d1aa6030a3c0df2e400ca14df7b/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Fcpp0x%2Falignas4.C", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/90f11cf950130d1aa6030a3c0df2e400ca14df7b/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Fcpp0x%2Falignas4.C", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Fcpp0x%2Falignas4.C?ref=90f11cf950130d1aa6030a3c0df2e400ca14df7b", "patch": "@@ -0,0 +1,19 @@\n+// PR c++/59012\n+// { dg-do compile { target c++11 } }\n+// { dg-final { scan-assembler \"align 8\" { target x86_64-*-*-gnu } } }\n+\n+template <class... T>\n+struct A\n+{\n+  alignas(T...) char t;\n+};\n+\n+A<int,double> a;\n+\n+template <class... T>\n+struct A2\n+{\n+  [[gnu::aligned (alignof (T))...]] char t;\n+};\n+\n+A2<int,double> a2;"}]}