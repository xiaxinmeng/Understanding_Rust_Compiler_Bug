{"sha": "e2e1fa50d933574f7711d9b4f6493381d68ae3fd", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6ZTJlMWZhNTBkOTMzNTc0Zjc3MTFkOWI0ZjY0OTMzODFkNjhhZTNmZA==", "commit": {"author": {"name": "Alexandre Oliva", "email": "aoliva@redhat.com", "date": "2003-09-24T23:53:07Z"}, "committer": {"name": "Alexandre Oliva", "email": "aoliva@gcc.gnu.org", "date": "2003-09-24T23:53:07Z"}, "message": "cpplib.c (do_pragma): Reintroduce cb_line_change call in the code path that calls a handler.\n\n* cpplib.c (do_pragma): Reintroduce cb_line_change call in the\ncode path that calls a handler.\n\nFrom-SVN: r71744", "tree": {"sha": "2f6029276812610822ac864fb806ed128477ad78", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/2f6029276812610822ac864fb806ed128477ad78"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/e2e1fa50d933574f7711d9b4f6493381d68ae3fd", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/e2e1fa50d933574f7711d9b4f6493381d68ae3fd", "html_url": "https://github.com/Rust-GCC/gccrs/commit/e2e1fa50d933574f7711d9b4f6493381d68ae3fd", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/e2e1fa50d933574f7711d9b4f6493381d68ae3fd/comments", "author": null, "committer": null, "parents": [{"sha": "d395df2636a4f74afbaa3b2d218b377326962d63", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/d395df2636a4f74afbaa3b2d218b377326962d63", "html_url": "https://github.com/Rust-GCC/gccrs/commit/d395df2636a4f74afbaa3b2d218b377326962d63"}], "stats": {"total": 19, "additions": 17, "deletions": 2}, "files": [{"sha": "3e2d5703a65bce496a35d63db96a2ced9a185472", "filename": "gcc/ChangeLog", "status": "modified", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/e2e1fa50d933574f7711d9b4f6493381d68ae3fd/gcc%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/e2e1fa50d933574f7711d9b4f6493381d68ae3fd/gcc%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2FChangeLog?ref=e2e1fa50d933574f7711d9b4f6493381d68ae3fd", "patch": "@@ -1,3 +1,8 @@\n+2003-09-24  Alexandre Oliva  <aoliva@redhat.com>\n+\n+\t* cpplib.c (do_pragma): Reintroduce cb_line_change call in the\n+\tcode path that calls a handler.\n+\n 2003-09-24  Nathanael Nerode  <neroden@gcc.gnu.org>\n \n \t* config.gcc (c4x-*, tic4x-*, d30v-*, mmix-knuth-mmixware):"}, {"sha": "5a927555468cb757746c8994b0660b086a21511a", "filename": "gcc/cpplib.c", "status": "modified", "additions": 12, "deletions": 2, "changes": 14, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/e2e1fa50d933574f7711d9b4f6493381d68ae3fd/gcc%2Fcpplib.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/e2e1fa50d933574f7711d9b4f6493381d68ae3fd/gcc%2Fcpplib.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fcpplib.c?ref=e2e1fa50d933574f7711d9b4f6493381d68ae3fd", "patch": "@@ -1120,7 +1120,7 @@ static void\n do_pragma (cpp_reader *pfile)\n {\n   const struct pragma_entry *p = NULL;\n-  const cpp_token *token;\n+  const cpp_token *token, *pragma_token = pfile->cur_token;\n   unsigned int count = 1;\n \n   pfile->state.prevent_expansion++;\n@@ -1141,7 +1141,17 @@ do_pragma (cpp_reader *pfile)\n     }\n \n   if (p)\n-    p->u.handler (pfile);\n+    {\n+      /* Since the handler below doesn't get the line number, that it\n+\t might need for diagnostics, make sure it has the right\n+\t numbers in place.  */\n+      if (pfile->cb.line_change)\n+\t(*pfile->cb.line_change) (pfile, pragma_token, false);\n+      (*p->u.handler) (pfile);\n+      if (pfile->cb.line_change)\n+\t(*pfile->cb.line_change) (pfile, pfile->cur_token, false);\n+      \n+    }\n   else if (pfile->cb.def_pragma)\n     {\n       _cpp_backup_tokens (pfile, count);"}]}