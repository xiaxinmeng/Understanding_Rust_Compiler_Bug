{"sha": "d9d9dbc0d0d3a1f419115367cfe23992a92f822b", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6ZDlkOWRiYzBkMGQzYTFmNDE5MTE1MzY3Y2ZlMjM5OTJhOTJmODIyYg==", "commit": {"author": {"name": "Jason Merrill", "email": "jason@redhat.com", "date": "2007-09-28T18:07:57Z"}, "committer": {"name": "Jason Merrill", "email": "jason@gcc.gnu.org", "date": "2007-09-28T18:07:57Z"}, "message": "re PR c++/10179 (alignment attributes are not inherited correctly with empty classes)\n\n        PR c++/10179\n        * class.c (layout_empty_base): Take rli parameter, update\n        rli->record_align if empty base has user-specified alignment.\n        (build_base_field): Pass rli to it.\n\nFrom-SVN: r128871", "tree": {"sha": "c0601f8dd3b95792f0db5c5bd35d56980a712650", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/c0601f8dd3b95792f0db5c5bd35d56980a712650"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/d9d9dbc0d0d3a1f419115367cfe23992a92f822b", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/d9d9dbc0d0d3a1f419115367cfe23992a92f822b", "html_url": "https://github.com/Rust-GCC/gccrs/commit/d9d9dbc0d0d3a1f419115367cfe23992a92f822b", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/d9d9dbc0d0d3a1f419115367cfe23992a92f822b/comments", "author": {"login": "jicama", "id": 266146, "node_id": "MDQ6VXNlcjI2NjE0Ng==", "avatar_url": "https://avatars.githubusercontent.com/u/266146?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jicama", "html_url": "https://github.com/jicama", "followers_url": "https://api.github.com/users/jicama/followers", "following_url": "https://api.github.com/users/jicama/following{/other_user}", "gists_url": "https://api.github.com/users/jicama/gists{/gist_id}", "starred_url": "https://api.github.com/users/jicama/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jicama/subscriptions", "organizations_url": "https://api.github.com/users/jicama/orgs", "repos_url": "https://api.github.com/users/jicama/repos", "events_url": "https://api.github.com/users/jicama/events{/privacy}", "received_events_url": "https://api.github.com/users/jicama/received_events", "type": "User", "site_admin": false}, "committer": null, "parents": [{"sha": "930a1e6372869fa553130c5e7fa22c27485b7ec5", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/930a1e6372869fa553130c5e7fa22c27485b7ec5", "html_url": "https://github.com/Rust-GCC/gccrs/commit/930a1e6372869fa553130c5e7fa22c27485b7ec5"}], "stats": {"total": 38, "additions": 35, "deletions": 3}, "files": [{"sha": "44a4d901aa79a0b6e297585e431ac73618674f39", "filename": "gcc/cp/ChangeLog", "status": "modified", "additions": 8, "deletions": 0, "changes": 8, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/d9d9dbc0d0d3a1f419115367cfe23992a92f822b/gcc%2Fcp%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/d9d9dbc0d0d3a1f419115367cfe23992a92f822b/gcc%2Fcp%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fcp%2FChangeLog?ref=d9d9dbc0d0d3a1f419115367cfe23992a92f822b", "patch": "@@ -1,3 +1,10 @@\n+2007-09-28  Jason Merrill  <jason@redhat.com>\n+\n+\tPR c++/10179\n+\t* class.c (layout_empty_base): Take rli parameter, update\n+\trli->record_align if empty base has user-specified alignment.\n+\t(build_base_field): Pass rli to it.\n+\n 2007-09-28  Paolo Carlini  <pcarlini@suse.de>\n \n \tPR c++/33213\n@@ -26,6 +33,7 @@\n \n 2007-09-27  Jason Merrill  <jason@redhat.com>\n \n+\tPR c++/33571\n \t* decl2.c (is_late_template_attribute): Don't crash on unknown\n \tattribute.\n "}, {"sha": "4419813b6b6847c170124f9a7b9455fa32851ffa", "filename": "gcc/cp/class.c", "status": "modified", "additions": 13, "deletions": 3, "changes": 16, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/d9d9dbc0d0d3a1f419115367cfe23992a92f822b/gcc%2Fcp%2Fclass.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/d9d9dbc0d0d3a1f419115367cfe23992a92f822b/gcc%2Fcp%2Fclass.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fcp%2Fclass.c?ref=d9d9dbc0d0d3a1f419115367cfe23992a92f822b", "patch": "@@ -179,7 +179,7 @@ static void initialize_vtable (tree, tree);\n static void layout_nonempty_base_or_field (record_layout_info,\n \t\t\t\t\t   tree, tree, splay_tree);\n static tree end_of_class (tree, int);\n-static bool layout_empty_base (tree, tree, splay_tree);\n+static bool layout_empty_base (record_layout_info, tree, tree, splay_tree);\n static void accumulate_vtbl_inits (tree, tree, tree, tree, tree);\n static tree dfs_accumulate_vtbl_inits (tree, tree, tree, tree,\n \t\t\t\t\t       tree);\n@@ -3517,7 +3517,8 @@ empty_base_at_nonzero_offset_p (tree type,\n    type.  Return nonzero iff we added it at the end.  */\n \n static bool\n-layout_empty_base (tree binfo, tree eoc, splay_tree offsets)\n+layout_empty_base (record_layout_info rli, tree binfo,\n+\t\t   tree eoc, splay_tree offsets)\n {\n   tree alignment;\n   tree basetype = BINFO_TYPE (binfo);\n@@ -3563,6 +3564,15 @@ layout_empty_base (tree binfo, tree eoc, splay_tree offsets)\n \t  propagate_binfo_offsets (binfo, alignment);\n \t}\n     }\n+\n+  if (CLASSTYPE_USER_ALIGN (basetype))\n+    {\n+      rli->record_align = MAX (rli->record_align, CLASSTYPE_ALIGN (basetype));\n+      if (warn_packed)\n+\trli->unpacked_align = MAX (rli->unpacked_align, CLASSTYPE_ALIGN (basetype));\n+      TYPE_USER_ALIGN (rli->t) = 1;\n+    }\n+\n   return atend;\n }\n \n@@ -3626,7 +3636,7 @@ build_base_field (record_layout_info rli, tree binfo,\n \t byte-aligned.  */\n       eoc = round_up (rli_size_unit_so_far (rli),\n \t\t      CLASSTYPE_ALIGN_UNIT (basetype));\n-      atend = layout_empty_base (binfo, eoc, offsets);\n+      atend = layout_empty_base (rli, binfo, eoc, offsets);\n       /* A nearly-empty class \"has no proper base class that is empty,\n \t not morally virtual, and at an offset other than zero.\"  */\n       if (!BINFO_VIRTUAL_P (binfo) && CLASSTYPE_NEARLY_EMPTY_P (t))"}, {"sha": "da54bd9386b34148c522bd3afc117f2ef0329715", "filename": "gcc/testsuite/g++.dg/ext/align2.C", "status": "added", "additions": 14, "deletions": 0, "changes": 14, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/d9d9dbc0d0d3a1f419115367cfe23992a92f822b/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Fext%2Falign2.C", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/d9d9dbc0d0d3a1f419115367cfe23992a92f822b/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Fext%2Falign2.C", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Fext%2Falign2.C?ref=d9d9dbc0d0d3a1f419115367cfe23992a92f822b", "patch": "@@ -0,0 +1,14 @@\n+// PR c++/10179\n+\n+struct __attribute((aligned(__alignof(double)))) A\n+{ /* empty */ };\n+\n+struct T : public A\n+{\n+  char c;\n+};\n+\n+template<bool> struct StaticAssert;\n+template<> struct StaticAssert<true> {};\n+\n+StaticAssert<__alignof(T) == __alignof(double)> d;"}]}