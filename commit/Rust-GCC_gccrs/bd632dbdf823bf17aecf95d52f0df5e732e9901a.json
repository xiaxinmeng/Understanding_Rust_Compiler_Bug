{"sha": "bd632dbdf823bf17aecf95d52f0df5e732e9901a", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6YmQ2MzJkYmRmODIzYmYxN2FlY2Y5NWQ1MmYwZGY1ZTczMmU5OTAxYQ==", "commit": {"author": {"name": "Jie Zhang", "email": "jie@codesourcery.com", "date": "2010-12-02T04:09:58Z"}, "committer": {"name": "Jie Zhang", "email": "jiez@gcc.gnu.org", "date": "2010-12-02T04:09:58Z"}, "message": "re PR middle-end/46674 (Weak alias is mistakenly optimized away)\n\n\tPR middle-end/46674\n\t* varasm.c (compute_visible_aliases): Handle user set\n\tassembler name.\n\n\ttestsuite/\n\tPR middle-end/46674\n\t* gcc.dg/pr46674.c: New test.\n\nFrom-SVN: r167365", "tree": {"sha": "0d324330ed956478e577c015886740f35584d137", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/0d324330ed956478e577c015886740f35584d137"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/bd632dbdf823bf17aecf95d52f0df5e732e9901a", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/bd632dbdf823bf17aecf95d52f0df5e732e9901a", "html_url": "https://github.com/Rust-GCC/gccrs/commit/bd632dbdf823bf17aecf95d52f0df5e732e9901a", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/bd632dbdf823bf17aecf95d52f0df5e732e9901a/comments", "author": null, "committer": null, "parents": [{"sha": "d0f7899abb4d765cfe9da433cb17b38a425d55e8", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/d0f7899abb4d765cfe9da433cb17b38a425d55e8", "html_url": "https://github.com/Rust-GCC/gccrs/commit/d0f7899abb4d765cfe9da433cb17b38a425d55e8"}], "stats": {"total": 33, "additions": 32, "deletions": 1}, "files": [{"sha": "f4302dc8b7501e0ccf3d9c916796713c51e69d4a", "filename": "gcc/ChangeLog", "status": "modified", "additions": 6, "deletions": 0, "changes": 6, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/bd632dbdf823bf17aecf95d52f0df5e732e9901a/gcc%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/bd632dbdf823bf17aecf95d52f0df5e732e9901a/gcc%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2FChangeLog?ref=bd632dbdf823bf17aecf95d52f0df5e732e9901a", "patch": "@@ -1,3 +1,9 @@\n+2010-12-02  Jie Zhang  <jie@codesourcery.com>\n+\n+\tPR middle-end/46674\n+\t* varasm.c (compute_visible_aliases): Handle user set\n+\tassembler name.\n+\n 2010-12-01  Michael Meissner  <meissner@linux.vnet.ibm.com>\n \n \t* config/rs6000/rs6000.c (rs6000_option_override_internal): Fix"}, {"sha": "d70e0b199538e800afb3e193f59aca6808b56722", "filename": "gcc/testsuite/ChangeLog", "status": "modified", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/bd632dbdf823bf17aecf95d52f0df5e732e9901a/gcc%2Ftestsuite%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/bd632dbdf823bf17aecf95d52f0df5e732e9901a/gcc%2Ftestsuite%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2FChangeLog?ref=bd632dbdf823bf17aecf95d52f0df5e732e9901a", "patch": "@@ -1,3 +1,8 @@\n+2010-12-02  Jie Zhang  <jie@codesourcery.com>\n+\n+\tPR middle-end/46674\n+\t* gcc.dg/pr46674.c: New test.\n+\n 2010-12-02  Nicola Pero  <nicola.pero@meta-innovation.com>\n \n \t* objc.dg/exceptions-6.m: New."}, {"sha": "cf6dfc77fb5668d87bc9266ec56a278f3a7488df", "filename": "gcc/testsuite/gcc.dg/pr46674.c", "status": "added", "additions": 11, "deletions": 0, "changes": 11, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/bd632dbdf823bf17aecf95d52f0df5e732e9901a/gcc%2Ftestsuite%2Fgcc.dg%2Fpr46674.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/bd632dbdf823bf17aecf95d52f0df5e732e9901a/gcc%2Ftestsuite%2Fgcc.dg%2Fpr46674.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgcc.dg%2Fpr46674.c?ref=bd632dbdf823bf17aecf95d52f0df5e732e9901a", "patch": "@@ -0,0 +1,11 @@\n+/* { dg-do compile } */\n+/* { dg-require-alias \"\" } */\n+/* { dg-options \"-O2\" } */\n+\n+int yum;\n+void dessert (void) { ++yum; }\n+extern void jelly (void) __asm__ (\"jelly2\") __attribute__ ((alias (\"dessert\"), weak));\n+extern void wobbly (void) __attribute__ ((alias (\"jelly2\"), weak));\n+\n+/* { dg-final { scan-assembler \"wobbly\" } } */\n+/* { dg-final { scan-assembler \"jelly2\" } } */"}, {"sha": "921ee2e1d2903749ef2a9c396dbd07eac53949ca", "filename": "gcc/varasm.c", "status": "modified", "additions": 10, "deletions": 1, "changes": 11, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/bd632dbdf823bf17aecf95d52f0df5e732e9901a/gcc%2Fvarasm.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/bd632dbdf823bf17aecf95d52f0df5e732e9901a/gcc%2Fvarasm.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fvarasm.c?ref=bd632dbdf823bf17aecf95d52f0df5e732e9901a", "patch": "@@ -5525,12 +5525,21 @@ compute_visible_aliases (void)\n \t{\n \t  struct cgraph_node *fnode = NULL;\n \t  struct varpool_node *vnode = NULL;\n+\t  tree asmname = DECL_ASSEMBLER_NAME (p->decl);\n+\t  const char *str = IDENTIFIER_POINTER (asmname);\n+\n+\t  if (str[0] == '*')\n+\t    {\n+\t      str ++;\n+\t      asmname = get_identifier (str);\n+\t    }\n+\n \t  fnode = cgraph_node_for_asm (p->target);\n \t  vnode = (fnode == NULL) ? varpool_node_for_asm (p->target) : NULL;\n \t  if ((fnode\n \t       || vnode\n \t       || pointer_set_contains (visible, p->target))\n-\t      && !pointer_set_insert (visible, DECL_ASSEMBLER_NAME (p->decl)))\n+\t      && !pointer_set_insert (visible, asmname))\n \t    changed = true;\n \t}\n     }"}]}