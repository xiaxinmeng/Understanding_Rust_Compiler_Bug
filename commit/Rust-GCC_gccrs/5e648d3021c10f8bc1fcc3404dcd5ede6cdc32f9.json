{"sha": "5e648d3021c10f8bc1fcc3404dcd5ede6cdc32f9", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6NWU2NDhkMzAyMWMxMGY4YmMxZmNjMzQwNGRjZDVlZGU2Y2RjMzJmOQ==", "commit": {"author": {"name": "Olivier Hainque", "email": "hainque@adacore.com", "date": "2018-05-30T08:57:50Z"}, "committer": {"name": "Pierre-Marie de Rodat", "email": "pmderodat@gcc.gnu.org", "date": "2018-05-30T08:57:50Z"}, "message": "[Ada] Craft .ctors/.dtors sections manually for VxWorks EH registration\n\nTemporary change for experimental purposes. Further cleanups will\nbe needed if this sheme works as we hope.\n\n2018-05-30  Olivier Hainque  <hainque@adacore.com>\n\ngcc/ada/\n\n\t* vx_crtbegin_attr.c (CTOR_ATTRIBUTE, DTOR_ATTRIBUTE): Empty.\n\t(eh_registration_ctors, eh_registration_tors): New static variables,\n\tforced in a .ctors/.dtors section, respectively, with priority.\n\nFrom-SVN: r260938", "tree": {"sha": "d88c603d13e454f7b08e2976b8c9767ff5f92fa0", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/d88c603d13e454f7b08e2976b8c9767ff5f92fa0"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/5e648d3021c10f8bc1fcc3404dcd5ede6cdc32f9", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/5e648d3021c10f8bc1fcc3404dcd5ede6cdc32f9", "html_url": "https://github.com/Rust-GCC/gccrs/commit/5e648d3021c10f8bc1fcc3404dcd5ede6cdc32f9", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/5e648d3021c10f8bc1fcc3404dcd5ede6cdc32f9/comments", "author": {"login": "hainque", "id": 18735142, "node_id": "MDQ6VXNlcjE4NzM1MTQy", "avatar_url": "https://avatars.githubusercontent.com/u/18735142?v=4", "gravatar_id": "", "url": "https://api.github.com/users/hainque", "html_url": "https://github.com/hainque", "followers_url": "https://api.github.com/users/hainque/followers", "following_url": "https://api.github.com/users/hainque/following{/other_user}", "gists_url": "https://api.github.com/users/hainque/gists{/gist_id}", "starred_url": "https://api.github.com/users/hainque/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/hainque/subscriptions", "organizations_url": "https://api.github.com/users/hainque/orgs", "repos_url": "https://api.github.com/users/hainque/repos", "events_url": "https://api.github.com/users/hainque/events{/privacy}", "received_events_url": "https://api.github.com/users/hainque/received_events", "type": "User", "site_admin": false}, "committer": null, "parents": [{"sha": "812e6118dcab9e0b0e717c44a987ce65ec7c13ec", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/812e6118dcab9e0b0e717c44a987ce65ec7c13ec", "html_url": "https://github.com/Rust-GCC/gccrs/commit/812e6118dcab9e0b0e717c44a987ce65ec7c13ec"}], "stats": {"total": 23, "additions": 18, "deletions": 5}, "files": [{"sha": "7d70d82fd6e54d8b7227ea5a38e38b640420e432", "filename": "gcc/ada/ChangeLog", "status": "modified", "additions": 6, "deletions": 0, "changes": 6, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/5e648d3021c10f8bc1fcc3404dcd5ede6cdc32f9/gcc%2Fada%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/5e648d3021c10f8bc1fcc3404dcd5ede6cdc32f9/gcc%2Fada%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fada%2FChangeLog?ref=5e648d3021c10f8bc1fcc3404dcd5ede6cdc32f9", "patch": "@@ -1,3 +1,9 @@\n+2018-05-30  Olivier Hainque  <hainque@adacore.com>\n+\n+\t* vx_crtbegin_attr.c (CTOR_ATTRIBUTE, DTOR_ATTRIBUTE): Empty.\n+\t(eh_registration_ctors, eh_registration_tors): New static variables,\n+\tforced in a .ctors/.dtors section, respectively, with priority.\n+\n 2018-05-30  Bob Duff  <duff@adacore.com>\n \n \t* aspects.ads, contracts.adb, exp_util.adb, expander.adb, expander.ads,"}, {"sha": "f10555d21a5d3e857395da1d87b360f8981bc628", "filename": "gcc/ada/vx_crtbegin_attr.c", "status": "modified", "additions": 12, "deletions": 5, "changes": 17, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/5e648d3021c10f8bc1fcc3404dcd5ede6cdc32f9/gcc%2Fada%2Fvx_crtbegin_attr.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/5e648d3021c10f8bc1fcc3404dcd5ede6cdc32f9/gcc%2Fada%2Fvx_crtbegin_attr.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fada%2Fvx_crtbegin_attr.c?ref=5e648d3021c10f8bc1fcc3404dcd5ede6cdc32f9", "patch": "@@ -31,12 +31,19 @@\n \n /* crtbegin kind of file for ehframe registration/deregistration\n    purposes on VxWorks.  This variant exposes the ctor/dtor functions\n-   as explicit constructors, expected to be placed in a .ctors/.dtors\n-   section.  */\n+   as explicit constructors referenced from a .ctors/.dtors section.  */\n+\n+#define CTOR_ATTRIBUTE\n+#define DTOR_ATTRIBUTE\n+\n+#include \"vx_crtbegin.inc\"\n \n /* 101 is the highest user level priority allowed by VxWorks.  */\n \n-#define CTOR_ATTRIBUTE __attribute__((constructor(101)))\n-#define DTOR_ATTRIBUTE __attribute__((destructor(101)))\n+static void (* volatile eh_registration_ctors[])()\n+  __attribute__((section (\".ctors.65424\")))\n+= { &CTOR_NAME };\n \n-#include \"vx_crtbegin.inc\"\n+static void (* volatile eh_registration_dtors[])()\n+  __attribute__((section (\".dtors.65424\")))\n+= { &DTOR_NAME };"}]}