{"sha": "cfed37a03b7a495b25e63d335e9f00e2dc9583f0", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6Y2ZlZDM3YTAzYjdhNDk1YjI1ZTYzZDMzNWU5ZjAwZTJkYzk1ODNmMA==", "commit": {"author": {"name": "Richard Sandiford", "email": "richard.sandiford@arm.com", "date": "2015-10-22T08:32:01Z"}, "committer": {"name": "Richard Sandiford", "email": "rsandifo@gcc.gnu.org", "date": "2015-10-22T08:32:01Z"}, "message": "Move tan simplifications to match.pd\n\nTested on x86_64-linux-gnu, aarch64-linux-gnu and arm-linux-gnueabi.\n\ngcc/\n\t* builtins.c (fold_builtin_tan): Delete.\n\t(fold_builtin_1): Handle constant tan arguments here.\n\t* match.pd: Simplify (tan (atan x)) to x.\n\nFrom-SVN: r229166", "tree": {"sha": "80022a09c55f138c2131bfb05b749ba87d72d72c", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/80022a09c55f138c2131bfb05b749ba87d72d72c"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/cfed37a03b7a495b25e63d335e9f00e2dc9583f0", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/cfed37a03b7a495b25e63d335e9f00e2dc9583f0", "html_url": "https://github.com/Rust-GCC/gccrs/commit/cfed37a03b7a495b25e63d335e9f00e2dc9583f0", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/cfed37a03b7a495b25e63d335e9f00e2dc9583f0/comments", "author": {"login": "rsandifo-arm", "id": 28043039, "node_id": "MDQ6VXNlcjI4MDQzMDM5", "avatar_url": "https://avatars.githubusercontent.com/u/28043039?v=4", "gravatar_id": "", "url": "https://api.github.com/users/rsandifo-arm", "html_url": "https://github.com/rsandifo-arm", "followers_url": "https://api.github.com/users/rsandifo-arm/followers", "following_url": "https://api.github.com/users/rsandifo-arm/following{/other_user}", "gists_url": "https://api.github.com/users/rsandifo-arm/gists{/gist_id}", "starred_url": "https://api.github.com/users/rsandifo-arm/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/rsandifo-arm/subscriptions", "organizations_url": "https://api.github.com/users/rsandifo-arm/orgs", "repos_url": "https://api.github.com/users/rsandifo-arm/repos", "events_url": "https://api.github.com/users/rsandifo-arm/events{/privacy}", "received_events_url": "https://api.github.com/users/rsandifo-arm/received_events", "type": "User", "site_admin": false}, "committer": null, "parents": [{"sha": "92c52eab974ce9e1c81d770724adb56846bcaa4b", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/92c52eab974ce9e1c81d770724adb56846bcaa4b", "html_url": "https://github.com/Rust-GCC/gccrs/commit/92c52eab974ce9e1c81d770724adb56846bcaa4b"}], "stats": {"total": 48, "additions": 18, "deletions": 30}, "files": [{"sha": "2ec877a92566c8393fda139f815504cc96f092fb", "filename": "gcc/ChangeLog", "status": "modified", "additions": 6, "deletions": 0, "changes": 6, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/cfed37a03b7a495b25e63d335e9f00e2dc9583f0/gcc%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/cfed37a03b7a495b25e63d335e9f00e2dc9583f0/gcc%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2FChangeLog?ref=cfed37a03b7a495b25e63d335e9f00e2dc9583f0", "patch": "@@ -1,3 +1,9 @@\n+2015-10-22  Richard Sandiford  <richard.sandiford@arm.com>\n+\n+\t* builtins.c (fold_builtin_tan): Delete.\n+\t(fold_builtin_1): Handle constant tan arguments here.\n+\t* match.pd: Simplify (tan (atan x)) to x.\n+\n 2015-10-22  Richard Sandiford  <richard.sandiford@arm.com>\n \n \t* builtins.c (fold_builtin_cproj): Delete."}, {"sha": "02bf9f65a33907fdcfc77e5621f6acff22fa55cf", "filename": "gcc/builtins.c", "status": "modified", "additions": 3, "deletions": 29, "changes": 32, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/cfed37a03b7a495b25e63d335e9f00e2dc9583f0/gcc%2Fbuiltins.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/cfed37a03b7a495b25e63d335e9f00e2dc9583f0/gcc%2Fbuiltins.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fbuiltins.c?ref=cfed37a03b7a495b25e63d335e9f00e2dc9583f0", "patch": "@@ -160,7 +160,6 @@ static rtx expand_builtin_fabs (tree, rtx, rtx);\n static rtx expand_builtin_signbit (tree, rtx);\n static tree fold_builtin_pow (location_t, tree, tree, tree, tree);\n static tree fold_builtin_powi (location_t, tree, tree, tree, tree);\n-static tree fold_builtin_tan (tree, tree);\n static tree fold_builtin_trunc (location_t, tree, tree);\n static tree fold_builtin_floor (location_t, tree, tree);\n static tree fold_builtin_ceil (location_t, tree, tree);\n@@ -7538,33 +7537,6 @@ fold_fixed_mathfn (location_t loc, tree fndecl, tree arg)\n   return NULL_TREE;\n }\n \n-/* Fold function call to builtin tan, tanf, or tanl with argument ARG.\n-   Return NULL_TREE if no simplification can be made.  */\n-\n-static tree\n-fold_builtin_tan (tree arg, tree type)\n-{\n-  enum built_in_function fcode;\n-  tree res;\n-\n-  if (!validate_arg (arg, REAL_TYPE))\n-    return NULL_TREE;\n-\n-  /* Calculate the result when the argument is a constant.  */\n-  if ((res = do_mpfr_arg1 (arg, type, mpfr_tan, NULL, NULL, 0)))\n-    return res;\n-\n-  /* Optimize tan(atan(x)) = x.  */\n-  fcode = builtin_mathfn_code (arg);\n-  if (flag_unsafe_math_optimizations\n-      && (fcode == BUILT_IN_ATAN\n-\t  || fcode == BUILT_IN_ATANF\n-\t  || fcode == BUILT_IN_ATANL))\n-    return CALL_EXPR_ARG (arg, 0);\n-\n-  return NULL_TREE;\n-}\n-\n /* Fold function call to builtin sincos, sincosf, or sincosl.  Return\n    NULL_TREE if no simplification can be made.  */\n \n@@ -9612,7 +9584,9 @@ fold_builtin_1 (location_t loc, tree fndecl, tree arg0)\n       break;\n \n     CASE_FLT_FN (BUILT_IN_TAN):\n-      return fold_builtin_tan (arg0, type);\n+      if (validate_arg (arg0, REAL_TYPE))\n+\treturn do_mpfr_arg1 (arg0, type, mpfr_tan, NULL, NULL, 0);\n+      break;\n \n     CASE_FLT_FN (BUILT_IN_CEXP):\n       return fold_builtin_cexp (loc, arg0, type);"}, {"sha": "1ba43c44c16851d5ad4cfc2a3d5c86995c763c60", "filename": "gcc/match.pd", "status": "modified", "additions": 9, "deletions": 1, "changes": 10, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/cfed37a03b7a495b25e63d335e9f00e2dc9583f0/gcc%2Fmatch.pd", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/cfed37a03b7a495b25e63d335e9f00e2dc9583f0/gcc%2Fmatch.pd", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fmatch.pd?ref=cfed37a03b7a495b25e63d335e9f00e2dc9583f0", "patch": "@@ -59,6 +59,7 @@ along with GCC; see the file COPYING3.  If not see\n (define_operator_list SIN BUILT_IN_SINF BUILT_IN_SIN BUILT_IN_SINL)\n (define_operator_list COS BUILT_IN_COSF BUILT_IN_COS BUILT_IN_COSL)\n (define_operator_list TAN BUILT_IN_TANF BUILT_IN_TAN BUILT_IN_TANL)\n+(define_operator_list ATAN BUILT_IN_ATANF BUILT_IN_ATAN BUILT_IN_ATANL)\n (define_operator_list COSH BUILT_IN_COSHF BUILT_IN_COSH BUILT_IN_COSHL)\n (define_operator_list CEXPI BUILT_IN_CEXPIF BUILT_IN_CEXPI BUILT_IN_CEXPIL)\n (define_operator_list CPROJ BUILT_IN_CPROJF BUILT_IN_CPROJ BUILT_IN_CPROJL)\n@@ -2374,7 +2375,14 @@ along with GCC; see the file COPYING3.  If not see\n   /* cbrt(expN(x)) -> expN(x/3).  */\n   (simplify\n    (cbrts (exps @0))\n-   (exps (mult @0 { build_real_truncate (type, dconst_third ()); })))))\n+   (exps (mult @0 { build_real_truncate (type, dconst_third ()); }))))\n+\n+ /* tan(atan(x)) -> x.  */\n+ (for tans (TAN)\n+      atans (ATAN)\n+  (simplify\n+   (tans (atans @0))\n+   @0)))\n \n /* cabs(x+0i) or cabs(0+xi) -> abs(x).  */\n (simplify"}]}