{"sha": "db3267c60664bcfa8d7b0683a5567b24432b5a48", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6ZGIzMjY3YzYwNjY0YmNmYThkN2IwNjgzYTU1NjdiMjQ0MzJiNWE0OA==", "commit": {"author": {"name": "Bernd Schmidt", "email": "bernds@codesourcery.com", "date": "2015-02-20T10:01:17Z"}, "committer": {"name": "Jakub Jelinek", "email": "jakub@gcc.gnu.org", "date": "2015-02-20T10:01:17Z"}, "message": "tree-streamer.c (preload_common_nodes): Don't preload TI_VA_LIST* for offloading.\n\n\t* tree-streamer.c (preload_common_nodes): Don't preload\n\tTI_VA_LIST* for offloading.\n\t* tree-stdarg.c (pass_stdarg::gate): Disable for ACCEL_COMPILER\n\tin_lto_p.\n\nCo-Authored-By: Jakub Jelinek <jakub@redhat.com>\n\nFrom-SVN: r220846", "tree": {"sha": "710955b79268344e8171ec3149def3129c01c4ef", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/710955b79268344e8171ec3149def3129c01c4ef"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/db3267c60664bcfa8d7b0683a5567b24432b5a48", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/db3267c60664bcfa8d7b0683a5567b24432b5a48", "html_url": "https://github.com/Rust-GCC/gccrs/commit/db3267c60664bcfa8d7b0683a5567b24432b5a48", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/db3267c60664bcfa8d7b0683a5567b24432b5a48/comments", "author": null, "committer": null, "parents": [{"sha": "6b66981a2f73615e0d3bb422a44b70a2ff38740d", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/6b66981a2f73615e0d3bb422a44b70a2ff38740d", "html_url": "https://github.com/Rust-GCC/gccrs/commit/6b66981a2f73615e0d3bb422a44b70a2ff38740d"}], "stats": {"total": 24, "additions": 23, "deletions": 1}, "files": [{"sha": "ff6df3df9f1441e08abfdec8fc61eefa0ce4318c", "filename": "gcc/ChangeLog", "status": "modified", "additions": 8, "deletions": 0, "changes": 8, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/db3267c60664bcfa8d7b0683a5567b24432b5a48/gcc%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/db3267c60664bcfa8d7b0683a5567b24432b5a48/gcc%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2FChangeLog?ref=db3267c60664bcfa8d7b0683a5567b24432b5a48", "patch": "@@ -1,3 +1,11 @@\n+2015-02-20  Bernd Schmidt  <bernds@codesourcery.com>\n+\t    Jakub Jelinek  <jakub@redhat.com>\n+\n+\t* tree-streamer.c (preload_common_nodes): Don't preload\n+\tTI_VA_LIST* for offloading.\n+\t* tree-stdarg.c (pass_stdarg::gate): Disable for ACCEL_COMPILER\n+\tin_lto_p.\n+\n 2015-02-19  John David Anglin  <danlgin@gcc.gnu.org>\n \n \t* config/pa/pa.c (pa_emit_move_sequence): Always force"}, {"sha": "0c70790f3eb875609716a37cf1df19e8019001b3", "filename": "gcc/tree-stdarg.c", "status": "modified", "additions": 7, "deletions": 0, "changes": 7, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/db3267c60664bcfa8d7b0683a5567b24432b5a48/gcc%2Ftree-stdarg.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/db3267c60664bcfa8d7b0683a5567b24432b5a48/gcc%2Ftree-stdarg.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftree-stdarg.c?ref=db3267c60664bcfa8d7b0683a5567b24432b5a48", "patch": "@@ -705,6 +705,13 @@ class pass_stdarg : public gimple_opt_pass\n   virtual bool gate (function *fun)\n     {\n       return (flag_stdarg_opt\n+#ifdef ACCEL_COMPILER\n+\t      /* Disable for GCC5 in the offloading compilers, as\n+\t\t va_list and gpr/fpr counter fields are not merged.\n+\t\t In GCC6 when stdarg is lowered late this shouldn't be\n+\t\t an issue.  */\n+\t      && !in_lto_p\n+#endif\n \t      /* This optimization is only for stdarg functions.  */\n \t      && fun->stdarg != 0);\n     }"}, {"sha": "7b35358c280dda6b119dcea89caf4efcc821b118", "filename": "gcc/tree-streamer.c", "status": "modified", "additions": 8, "deletions": 1, "changes": 9, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/db3267c60664bcfa8d7b0683a5567b24432b5a48/gcc%2Ftree-streamer.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/db3267c60664bcfa8d7b0683a5567b24432b5a48/gcc%2Ftree-streamer.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftree-streamer.c?ref=db3267c60664bcfa8d7b0683a5567b24432b5a48", "patch": "@@ -342,7 +342,14 @@ preload_common_nodes (struct streamer_tree_cache_d *cache)\n \t&& i != TI_TARGET_OPTION_DEFAULT\n \t&& i != TI_TARGET_OPTION_CURRENT\n \t&& i != TI_CURRENT_TARGET_PRAGMA\n-\t&& i != TI_CURRENT_OPTIMIZE_PRAGMA)\n+\t&& i != TI_CURRENT_OPTIMIZE_PRAGMA\n+\t/* Skip va_list* related nodes if offloading.  For native LTO\n+\t   we want them to be merged for the stdarg pass, for offloading\n+\t   they might not be identical between host and offloading target.  */\n+\t&& (!lto_stream_offload_p\n+\t    || (i != TI_VA_LIST_TYPE\n+\t\t&& i != TI_VA_LIST_GPR_COUNTER_FIELD\n+\t\t&& i != TI_VA_LIST_FPR_COUNTER_FIELD)))\n       record_common_node (cache, global_trees[i]);\n }\n "}]}