{"sha": "a84aff585b6fea6445ae831d523f088c9662af73", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6YTg0YWZmNTg1YjZmZWE2NDQ1YWU4MzFkNTIzZjA4OGM5NjYyYWY3Mw==", "commit": {"author": {"name": "Kyrylo Tkachov", "email": "kyrylo.tkachov@arm.com", "date": "2018-01-24T14:43:52Z"}, "committer": {"name": "Kyrylo Tkachov", "email": "ktkachov@gcc.gnu.org", "date": "2018-01-24T14:43:52Z"}, "message": "[testsuite] Fix arm options in gcc.dg/lto/20110201-1_0.c\n\nThis test fails on arm hardfloat targets because it sets an explicit -mfloat-abi=softfp.\nThe usual approach to setting the NEON options is to use dg-add-options arm_neon.\nBut in the lto tests we don't have that framework, we can only set them explicitly with dg-lto-options.\n\nThe solution is to remove the explicit -mfloat-abi=softfp and instead add an effective target check\nfor arm_neon_ok_no_float_abi that makes sure we only run this test if -mfpu=neon is enough to get NEON\nwithout any -mfloat-abi options. In fact, this is what the comment above check_effective_target_arm_neon_ok_no_float_abi_nocache\nrecommends for lto tests.\n\nThat way on my hardfloat toolchain the test doesn't try to link the softfp binary against a hard-float runtime/test glue\nand all is good. I've tested that the test is appropriately skipped when testing a --with-float=soft toolchain.\n\n\n     * gcc.dg/lto/20110201-1_0.c: Remove explicit -mfloat-abi=softfp\n     option.  Add arm_neon_ok_no_float_abi check.\n\nFrom-SVN: r257017", "tree": {"sha": "afd3a1d77c5531e4fbec38badaa7ad50024622d4", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/afd3a1d77c5531e4fbec38badaa7ad50024622d4"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/a84aff585b6fea6445ae831d523f088c9662af73", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/a84aff585b6fea6445ae831d523f088c9662af73", "html_url": "https://github.com/Rust-GCC/gccrs/commit/a84aff585b6fea6445ae831d523f088c9662af73", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/a84aff585b6fea6445ae831d523f088c9662af73/comments", "author": {"login": "ktkachov-arm", "id": 74917949, "node_id": "MDQ6VXNlcjc0OTE3OTQ5", "avatar_url": "https://avatars.githubusercontent.com/u/74917949?v=4", "gravatar_id": "", "url": "https://api.github.com/users/ktkachov-arm", "html_url": "https://github.com/ktkachov-arm", "followers_url": "https://api.github.com/users/ktkachov-arm/followers", "following_url": "https://api.github.com/users/ktkachov-arm/following{/other_user}", "gists_url": "https://api.github.com/users/ktkachov-arm/gists{/gist_id}", "starred_url": "https://api.github.com/users/ktkachov-arm/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/ktkachov-arm/subscriptions", "organizations_url": "https://api.github.com/users/ktkachov-arm/orgs", "repos_url": "https://api.github.com/users/ktkachov-arm/repos", "events_url": "https://api.github.com/users/ktkachov-arm/events{/privacy}", "received_events_url": "https://api.github.com/users/ktkachov-arm/received_events", "type": "User", "site_admin": false}, "committer": null, "parents": [{"sha": "3dede32b88100a88ff442c6228dddc989a8f407b", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/3dede32b88100a88ff442c6228dddc989a8f407b", "html_url": "https://github.com/Rust-GCC/gccrs/commit/3dede32b88100a88ff442c6228dddc989a8f407b"}], "stats": {"total": 8, "additions": 7, "deletions": 1}, "files": [{"sha": "af42b95cf877961867d44539ea1031729a5fe090", "filename": "gcc/testsuite/ChangeLog", "status": "modified", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/a84aff585b6fea6445ae831d523f088c9662af73/gcc%2Ftestsuite%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/a84aff585b6fea6445ae831d523f088c9662af73/gcc%2Ftestsuite%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2FChangeLog?ref=a84aff585b6fea6445ae831d523f088c9662af73", "patch": "@@ -1,3 +1,8 @@\n+2018-01-24  Kyrylo Tkachov  <kyrylo.tkachov@arm.com>\n+\n+\t* gcc.dg/lto/20110201-1_0.c: Remove explicit -mfloat-abi=softfp\n+\toption.  Add arm_neon_ok_no_float_abi check.\n+\n 2018-01-24  Richard Biener  <rguenther@suse.de>\n \n \tPR tree-optimization/83176"}, {"sha": "871a49fe1897511e39827b96c7c57931d689ce92", "filename": "gcc/testsuite/gcc.dg/lto/20110201-1_0.c", "status": "modified", "additions": 2, "deletions": 1, "changes": 3, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/a84aff585b6fea6445ae831d523f088c9662af73/gcc%2Ftestsuite%2Fgcc.dg%2Flto%2F20110201-1_0.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/a84aff585b6fea6445ae831d523f088c9662af73/gcc%2Ftestsuite%2Fgcc.dg%2Flto%2F20110201-1_0.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgcc.dg%2Flto%2F20110201-1_0.c?ref=a84aff585b6fea6445ae831d523f088c9662af73", "patch": "@@ -1,6 +1,7 @@\n /* { dg-lto-do run } */\n /* { dg-lto-options { { -O0 -flto -fno-math-errno } } } */\n-/* { dg-lto-options { \"-O0 -flto -fno-math-errno -mfloat-abi=softfp -mfpu=neon-vfpv4\" } { target arm*-*-* } } */\n+/* { dg-lto-options { \"-O0 -flto -fno-math-errno -mfpu=neon-vfpv4\" } { target arm*-*-* } } */\n+/* { dg-require-effective-target arm_neon_ok_no_float_abi { target arm*-*-* } } */\n /* { dg-require-linker-plugin \"\" } */\n /* { dg-require-effective-target sqrt_insn } */\n "}]}