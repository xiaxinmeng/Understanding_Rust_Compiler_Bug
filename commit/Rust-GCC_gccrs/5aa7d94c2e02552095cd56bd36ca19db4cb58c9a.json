{"sha": "5aa7d94c2e02552095cd56bd36ca19db4cb58c9a", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6NWFhN2Q5NGMyZTAyNTUyMDk1Y2Q1NmJkMzZjYTE5ZGI0Y2I1OGM5YQ==", "commit": {"author": {"name": "Jakub Jelinek", "email": "jakub@redhat.com", "date": "2016-02-16T15:15:40Z"}, "committer": {"name": "Jakub Jelinek", "email": "jakub@gcc.gnu.org", "date": "2016-02-16T15:15:40Z"}, "message": "re PR rtl-optimization/69764 (ICE on x86_64-linux-gnu at -O0 (in decompose, at rtl.h:2107))\n\n\tPR rtl-optimization/69764\n\tPR rtl-optimization/69771\n\t* optabs.c (expand_binop): Ensure for shift optabs invalid CONST_INT\n\top1 is valid for GET_MODE_INNER (mode) and force it into a reg.\n\nFrom-SVN: r233456", "tree": {"sha": "b6733f347deabb26123cd915133b4007c4eda4c1", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/b6733f347deabb26123cd915133b4007c4eda4c1"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/5aa7d94c2e02552095cd56bd36ca19db4cb58c9a", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/5aa7d94c2e02552095cd56bd36ca19db4cb58c9a", "html_url": "https://github.com/Rust-GCC/gccrs/commit/5aa7d94c2e02552095cd56bd36ca19db4cb58c9a", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/5aa7d94c2e02552095cd56bd36ca19db4cb58c9a/comments", "author": {"login": "jakubjelinek", "id": 9370665, "node_id": "MDQ6VXNlcjkzNzA2NjU=", "avatar_url": "https://avatars.githubusercontent.com/u/9370665?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jakubjelinek", "html_url": "https://github.com/jakubjelinek", "followers_url": "https://api.github.com/users/jakubjelinek/followers", "following_url": "https://api.github.com/users/jakubjelinek/following{/other_user}", "gists_url": "https://api.github.com/users/jakubjelinek/gists{/gist_id}", "starred_url": "https://api.github.com/users/jakubjelinek/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jakubjelinek/subscriptions", "organizations_url": "https://api.github.com/users/jakubjelinek/orgs", "repos_url": "https://api.github.com/users/jakubjelinek/repos", "events_url": "https://api.github.com/users/jakubjelinek/events{/privacy}", "received_events_url": "https://api.github.com/users/jakubjelinek/received_events", "type": "User", "site_admin": false}, "committer": null, "parents": [{"sha": "87440c298eb2ed47166b8d57a4afc90d310f3a8f", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/87440c298eb2ed47166b8d57a4afc90d310f3a8f", "html_url": "https://github.com/Rust-GCC/gccrs/commit/87440c298eb2ed47166b8d57a4afc90d310f3a8f"}], "stats": {"total": 17, "additions": 17, "deletions": 0}, "files": [{"sha": "5eb87544b6809aefb7e8682436d03fe60c1a27a5", "filename": "gcc/ChangeLog", "status": "modified", "additions": 7, "deletions": 0, "changes": 7, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/5aa7d94c2e02552095cd56bd36ca19db4cb58c9a/gcc%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/5aa7d94c2e02552095cd56bd36ca19db4cb58c9a/gcc%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2FChangeLog?ref=5aa7d94c2e02552095cd56bd36ca19db4cb58c9a", "patch": "@@ -1,3 +1,10 @@\n+2016-02-16  Jakub Jelinek  <jakub@redhat.com>\n+\n+\tPR rtl-optimization/69764\n+\tPR rtl-optimization/69771\n+\t* optabs.c (expand_binop): Ensure for shift optabs invalid CONST_INT\n+\top1 is valid for GET_MODE_INNER (mode) and force it into a reg.\n+\n 2016-02-16  Richard Biener  <rguenther@suse.de>\n \n \tPR tree-optimization/69776"}, {"sha": "a6d8822b87edc4f6cfe404e9a9e1bba707926e7d", "filename": "gcc/optabs.c", "status": "modified", "additions": 10, "deletions": 0, "changes": 10, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/5aa7d94c2e02552095cd56bd36ca19db4cb58c9a/gcc%2Foptabs.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/5aa7d94c2e02552095cd56bd36ca19db4cb58c9a/gcc%2Foptabs.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Foptabs.c?ref=5aa7d94c2e02552095cd56bd36ca19db4cb58c9a", "patch": "@@ -1125,6 +1125,16 @@ expand_binop (machine_mode mode, optab binoptab, rtx op0, rtx op1,\n       op1 = negate_rtx (mode, op1);\n       binoptab = add_optab;\n     }\n+  /* For shifts, constant invalid op1 might be expanded from different\n+     mode than MODE.  As those are invalid, force them to a register\n+     to avoid further problems during expansion.  */\n+  else if (CONST_INT_P (op1)\n+\t   && shift_optab_p (binoptab)\n+\t   && UINTVAL (op1) >= GET_MODE_BITSIZE (GET_MODE_INNER (mode)))\n+    {\n+      op1 = gen_int_mode (INTVAL (op1), GET_MODE_INNER (mode));\n+      op1 = force_reg (GET_MODE_INNER (mode), op1);\n+    }\n \n   /* Record where to delete back to if we backtrack.  */\n   last = get_last_insn ();"}]}