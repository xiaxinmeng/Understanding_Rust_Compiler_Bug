{"sha": "5ab656c5e90219ce2d11a9c88d06ff927b275297", "node_id": "C_kwDOANBUbNoAKDVhYjY1NmM1ZTkwMjE5Y2UyZDExYTljODhkMDZmZjkyN2IyNzUyOTc", "commit": {"author": {"name": "Etienne Servais", "email": "servais@adacore.com", "date": "2022-02-15T16:59:10Z"}, "committer": {"name": "Pierre-Marie de Rodat", "email": "derodat@adacore.com", "date": "2022-05-17T08:25:49Z"}, "message": "[Ada] Enhance the warning on C enum with size clause for size /= 32\n\nImprove the warning message and silence warning when size > 32, this is\nlikely intentional and does not warrant a warning.\n\ngcc/ada/\n\n\t* freeze.adb (Freeze_Enumeration_Type): Fix comment, enhance\n\tmessage and silence warning for size > 32.", "tree": {"sha": "027b423534c9fcc359fe03e98e934dd1e86a741b", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/027b423534c9fcc359fe03e98e934dd1e86a741b"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/5ab656c5e90219ce2d11a9c88d06ff927b275297", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/5ab656c5e90219ce2d11a9c88d06ff927b275297", "html_url": "https://github.com/Rust-GCC/gccrs/commit/5ab656c5e90219ce2d11a9c88d06ff927b275297", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/5ab656c5e90219ce2d11a9c88d06ff927b275297/comments", "author": {"login": "vser1", "id": 8308457, "node_id": "MDQ6VXNlcjgzMDg0NTc=", "avatar_url": "https://avatars.githubusercontent.com/u/8308457?v=4", "gravatar_id": "", "url": "https://api.github.com/users/vser1", "html_url": "https://github.com/vser1", "followers_url": "https://api.github.com/users/vser1/followers", "following_url": "https://api.github.com/users/vser1/following{/other_user}", "gists_url": "https://api.github.com/users/vser1/gists{/gist_id}", "starred_url": "https://api.github.com/users/vser1/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/vser1/subscriptions", "organizations_url": "https://api.github.com/users/vser1/orgs", "repos_url": "https://api.github.com/users/vser1/repos", "events_url": "https://api.github.com/users/vser1/events{/privacy}", "received_events_url": "https://api.github.com/users/vser1/received_events", "type": "User", "site_admin": false}, "committer": {"login": "pmderodat", "id": 758452, "node_id": "MDQ6VXNlcjc1ODQ1Mg==", "avatar_url": "https://avatars.githubusercontent.com/u/758452?v=4", "gravatar_id": "", "url": "https://api.github.com/users/pmderodat", "html_url": "https://github.com/pmderodat", "followers_url": "https://api.github.com/users/pmderodat/followers", "following_url": "https://api.github.com/users/pmderodat/following{/other_user}", "gists_url": "https://api.github.com/users/pmderodat/gists{/gist_id}", "starred_url": "https://api.github.com/users/pmderodat/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/pmderodat/subscriptions", "organizations_url": "https://api.github.com/users/pmderodat/orgs", "repos_url": "https://api.github.com/users/pmderodat/repos", "events_url": "https://api.github.com/users/pmderodat/events{/privacy}", "received_events_url": "https://api.github.com/users/pmderodat/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "3c802e974955085696b6ba3ca20bcde2e2c53921", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/3c802e974955085696b6ba3ca20bcde2e2c53921", "html_url": "https://github.com/Rust-GCC/gccrs/commit/3c802e974955085696b6ba3ca20bcde2e2c53921"}], "stats": {"total": 17, "additions": 12, "deletions": 5}, "files": [{"sha": "b75f9ef07d5c7094e8f39ea6d71c6be47f95189b", "filename": "gcc/ada/freeze.adb", "status": "modified", "additions": 12, "deletions": 5, "changes": 17, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/5ab656c5e90219ce2d11a9c88d06ff927b275297/gcc%2Fada%2Ffreeze.adb", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/5ab656c5e90219ce2d11a9c88d06ff927b275297/gcc%2Fada%2Ffreeze.adb", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fada%2Ffreeze.adb?ref=5ab656c5e90219ce2d11a9c88d06ff927b275297", "patch": "@@ -7968,15 +7968,17 @@ package body Freeze is\n \n       else\n          --  If the enumeration type interfaces to C, and it has a size clause\n-         --  that specifies less than int size, it warrants a warning. The\n-         --  user may intend the C type to be an enum or a char, so this is\n+         --  that is smaller than the size of int, it warrants a warning. The\n+         --  user may intend the C type to be a boolean or a char, so this is\n          --  not by itself an error that the Ada compiler can detect, but it\n-         --  it is a worth a heads-up. For Boolean and Character types we\n+         --  is worth a heads-up. For Boolean and Character types we\n          --  assume that the programmer has the proper C type in mind.\n+         --  For explicit sizes larger than int, assume the user knows what\n+         --  he is doing and that the code is intentional.\n \n          if Convention (Typ) = Convention_C\n            and then Has_Size_Clause (Typ)\n-           and then Esize (Typ) /= Esize (Standard_Integer)\n+           and then Esize (Typ) < Standard_Integer_Size\n            and then not Is_Boolean_Type (Typ)\n            and then not Is_Character_Type (Typ)\n \n@@ -7985,7 +7987,12 @@ package body Freeze is\n            and then not Target_Short_Enums\n          then\n             Error_Msg_N\n-              (\"C enum types have the size of a C int??\", Size_Clause (Typ));\n+              (\"??the size of enums in C is implementation-defined\",\n+               Size_Clause (Typ));\n+            Error_Msg_N\n+              (\"\\??check that the C counterpart has size of \" &\n+               UI_Image (Esize (Typ)),\n+               Size_Clause (Typ));\n          end if;\n \n          Adjust_Esize_For_Alignment (Typ);"}]}