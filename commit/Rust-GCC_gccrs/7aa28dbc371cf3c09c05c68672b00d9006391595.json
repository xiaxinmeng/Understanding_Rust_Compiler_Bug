{"sha": "7aa28dbc371cf3c09c05c68672b00d9006391595", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6N2FhMjhkYmMzNzFjZjNjMDljMDVjNjg2NzJiMDBkOTAwNjM5MTU5NQ==", "commit": {"author": {"name": "H.J. Lu", "email": "hjl.tools@gmail.com", "date": "2021-07-21T12:15:55Z"}, "committer": {"name": "H.J. Lu", "email": "hjl.tools@gmail.com", "date": "2021-07-21T17:09:49Z"}, "message": "x86: Remove OPTION_MASK_ISA_SSE4_2 from CRC32 _builtin functions\n\nSince\n\ncommit 39671f87b2df6a1894cc11a161e4a7949d1ddccd\nAuthor: H.J. Lu <hjl.tools@gmail.com>\nDate:   Thu Apr 15 05:59:48 2021 -0700\n\n    x86: Use crc32 target option for CRC32 intrinsics\n\nenabled OPTION_MASK_ISA_CRC32 for -msse4 and removed TARGET_SSE4_2 check\nin sse4_2_crc32<mode> pattens, remove OPTION_MASK_ISA_SSE4_2 from CRC32\n_builtin functions.\n\ngcc/\n\n\tPR target/101549\n\t* config/i386/i386-builtin.def: Remove OPTION_MASK_ISA_SSE4_2\n\tfrom CRC32 _builtin functions.\n\ngcc/testsuite/\n\n\tPR target/101549\n\t* gcc.target/i386/crc32-6.c: New test.", "tree": {"sha": "890b7fac68fe769e8ebbda92046c111479c76298", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/890b7fac68fe769e8ebbda92046c111479c76298"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/7aa28dbc371cf3c09c05c68672b00d9006391595", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/7aa28dbc371cf3c09c05c68672b00d9006391595", "html_url": "https://github.com/Rust-GCC/gccrs/commit/7aa28dbc371cf3c09c05c68672b00d9006391595", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/7aa28dbc371cf3c09c05c68672b00d9006391595/comments", "author": {"login": "hjl-tools", "id": 1072356, "node_id": "MDQ6VXNlcjEwNzIzNTY=", "avatar_url": "https://avatars.githubusercontent.com/u/1072356?v=4", "gravatar_id": "", "url": "https://api.github.com/users/hjl-tools", "html_url": "https://github.com/hjl-tools", "followers_url": "https://api.github.com/users/hjl-tools/followers", "following_url": "https://api.github.com/users/hjl-tools/following{/other_user}", "gists_url": "https://api.github.com/users/hjl-tools/gists{/gist_id}", "starred_url": "https://api.github.com/users/hjl-tools/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/hjl-tools/subscriptions", "organizations_url": "https://api.github.com/users/hjl-tools/orgs", "repos_url": "https://api.github.com/users/hjl-tools/repos", "events_url": "https://api.github.com/users/hjl-tools/events{/privacy}", "received_events_url": "https://api.github.com/users/hjl-tools/received_events", "type": "User", "site_admin": false}, "committer": {"login": "hjl-tools", "id": 1072356, "node_id": "MDQ6VXNlcjEwNzIzNTY=", "avatar_url": "https://avatars.githubusercontent.com/u/1072356?v=4", "gravatar_id": "", "url": "https://api.github.com/users/hjl-tools", "html_url": "https://github.com/hjl-tools", "followers_url": "https://api.github.com/users/hjl-tools/followers", "following_url": "https://api.github.com/users/hjl-tools/following{/other_user}", "gists_url": "https://api.github.com/users/hjl-tools/gists{/gist_id}", "starred_url": "https://api.github.com/users/hjl-tools/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/hjl-tools/subscriptions", "organizations_url": "https://api.github.com/users/hjl-tools/orgs", "repos_url": "https://api.github.com/users/hjl-tools/repos", "events_url": "https://api.github.com/users/hjl-tools/events{/privacy}", "received_events_url": "https://api.github.com/users/hjl-tools/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "c2b15fe27e6a0e42b108111d51acce69628593b4", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/c2b15fe27e6a0e42b108111d51acce69628593b4", "html_url": "https://github.com/Rust-GCC/gccrs/commit/c2b15fe27e6a0e42b108111d51acce69628593b4"}], "stats": {"total": 21, "additions": 17, "deletions": 4}, "files": [{"sha": "4b1ae0eb84cc80ee4c8c256409ddc2e6df9609bb", "filename": "gcc/config/i386/i386-builtin.def", "status": "modified", "additions": 4, "deletions": 4, "changes": 8, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/7aa28dbc371cf3c09c05c68672b00d9006391595/gcc%2Fconfig%2Fi386%2Fi386-builtin.def", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/7aa28dbc371cf3c09c05c68672b00d9006391595/gcc%2Fconfig%2Fi386%2Fi386-builtin.def", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fconfig%2Fi386%2Fi386-builtin.def?ref=7aa28dbc371cf3c09c05c68672b00d9006391595", "patch": "@@ -970,10 +970,10 @@ BDESC (OPTION_MASK_ISA_SSE4_1, 0, CODE_FOR_sse4_1_ptestv2di, \"__builtin_ia32_pte\n \n /* SSE4.2 */\n BDESC (OPTION_MASK_ISA_SSE4_2, 0, CODE_FOR_nothing, \"__builtin_ia32_pcmpgtq\", IX86_BUILTIN_PCMPGTQ, UNKNOWN, (int) V2DI_FTYPE_V2DI_V2DI)\n-BDESC (OPTION_MASK_ISA_SSE4_2 | OPTION_MASK_ISA_CRC32, 0, CODE_FOR_sse4_2_crc32qi, \"__builtin_ia32_crc32qi\", IX86_BUILTIN_CRC32QI, UNKNOWN, (int) UINT_FTYPE_UINT_UCHAR)\n-BDESC (OPTION_MASK_ISA_SSE4_2 | OPTION_MASK_ISA_CRC32, 0, CODE_FOR_sse4_2_crc32hi, \"__builtin_ia32_crc32hi\", IX86_BUILTIN_CRC32HI, UNKNOWN, (int) UINT_FTYPE_UINT_USHORT)\n-BDESC (OPTION_MASK_ISA_SSE4_2 | OPTION_MASK_ISA_CRC32, 0, CODE_FOR_sse4_2_crc32si, \"__builtin_ia32_crc32si\", IX86_BUILTIN_CRC32SI, UNKNOWN, (int) UINT_FTYPE_UINT_UINT)\n-BDESC (OPTION_MASK_ISA_SSE4_2 | OPTION_MASK_ISA_CRC32 | OPTION_MASK_ISA_64BIT, 0, CODE_FOR_sse4_2_crc32di, \"__builtin_ia32_crc32di\", IX86_BUILTIN_CRC32DI, UNKNOWN, (int) UINT64_FTYPE_UINT64_UINT64)\n+BDESC (OPTION_MASK_ISA_CRC32, 0, CODE_FOR_sse4_2_crc32qi, \"__builtin_ia32_crc32qi\", IX86_BUILTIN_CRC32QI, UNKNOWN, (int) UINT_FTYPE_UINT_UCHAR)\n+BDESC (OPTION_MASK_ISA_CRC32, 0, CODE_FOR_sse4_2_crc32hi, \"__builtin_ia32_crc32hi\", IX86_BUILTIN_CRC32HI, UNKNOWN, (int) UINT_FTYPE_UINT_USHORT)\n+BDESC (OPTION_MASK_ISA_CRC32, 0, CODE_FOR_sse4_2_crc32si, \"__builtin_ia32_crc32si\", IX86_BUILTIN_CRC32SI, UNKNOWN, (int) UINT_FTYPE_UINT_UINT)\n+BDESC (OPTION_MASK_ISA_CRC32 | OPTION_MASK_ISA_64BIT, 0, CODE_FOR_sse4_2_crc32di, \"__builtin_ia32_crc32di\", IX86_BUILTIN_CRC32DI, UNKNOWN, (int) UINT64_FTYPE_UINT64_UINT64)\n \n /* SSE4A */\n BDESC (OPTION_MASK_ISA_SSE4A, 0, CODE_FOR_sse4a_extrqi, \"__builtin_ia32_extrqi\", IX86_BUILTIN_EXTRQI, UNKNOWN, (int) V2DI_FTYPE_V2DI_UINT_UINT)"}, {"sha": "464e34440691fb6a0446a08ffa7d61d254e67091", "filename": "gcc/testsuite/gcc.target/i386/crc32-6.c", "status": "added", "additions": 13, "deletions": 0, "changes": 13, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/7aa28dbc371cf3c09c05c68672b00d9006391595/gcc%2Ftestsuite%2Fgcc.target%2Fi386%2Fcrc32-6.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/7aa28dbc371cf3c09c05c68672b00d9006391595/gcc%2Ftestsuite%2Fgcc.target%2Fi386%2Fcrc32-6.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgcc.target%2Fi386%2Fcrc32-6.c?ref=7aa28dbc371cf3c09c05c68672b00d9006391595", "patch": "@@ -0,0 +1,13 @@\n+/* PR target/101549 */\n+/* { dg-do compile } */\n+/* { dg-options \"-O2 -msse4 -mno-crc32\" } */\n+\n+#include <immintrin.h>\n+\n+unsigned int\n+test_mm_crc32_u8 (unsigned int CRC, unsigned char V)\n+{\n+  return _mm_crc32_u8 (CRC, V);\n+}\n+\n+/* { dg-error \"needs isa option -mcrc32\" \"\" { target *-*-* } 0  } */"}]}