{"sha": "c979d5f525e854fb26e8ff7a7ef34812abef8550", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6Yzk3OWQ1ZjUyNWU4NTRmYjI2ZThmZjdhN2VmMzQ4MTJhYmVmODU1MA==", "commit": {"author": {"name": "Richard Sandiford", "email": "rdsandiford@googlemail.com", "date": "2013-05-25T15:52:38Z"}, "committer": {"name": "Richard Sandiford", "email": "rsandifo@gcc.gnu.org", "date": "2013-05-25T15:52:38Z"}, "message": "re PR target/55777 (Inlining nomips16 function into mips16 function can result in undefined builtins)\n\ngcc/\n\tPR target/55777\n\t* config/mips/mips.c (mips_can_inline_p): New function.\n\t(TARGET_CAN_INLINE_P): Define.\n\ngcc/testsuite/\n\tPR target/55777\n\t* gcc.target/mips/mips16-attributes-5.c,\n\t* gcc.target/mips/mips16-attributes-6.c: New tests.\n\nFrom-SVN: r199328", "tree": {"sha": "5bc015eddc94bdfa09139723d37338fc9d038aca", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/5bc015eddc94bdfa09139723d37338fc9d038aca"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/c979d5f525e854fb26e8ff7a7ef34812abef8550", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/c979d5f525e854fb26e8ff7a7ef34812abef8550", "html_url": "https://github.com/Rust-GCC/gccrs/commit/c979d5f525e854fb26e8ff7a7ef34812abef8550", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/c979d5f525e854fb26e8ff7a7ef34812abef8550/comments", "author": {"login": "rsandifo", "id": 4235983, "node_id": "MDQ6VXNlcjQyMzU5ODM=", "avatar_url": "https://avatars.githubusercontent.com/u/4235983?v=4", "gravatar_id": "", "url": "https://api.github.com/users/rsandifo", "html_url": "https://github.com/rsandifo", "followers_url": "https://api.github.com/users/rsandifo/followers", "following_url": "https://api.github.com/users/rsandifo/following{/other_user}", "gists_url": "https://api.github.com/users/rsandifo/gists{/gist_id}", "starred_url": "https://api.github.com/users/rsandifo/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/rsandifo/subscriptions", "organizations_url": "https://api.github.com/users/rsandifo/orgs", "repos_url": "https://api.github.com/users/rsandifo/repos", "events_url": "https://api.github.com/users/rsandifo/events{/privacy}", "received_events_url": "https://api.github.com/users/rsandifo/received_events", "type": "User", "site_admin": false}, "committer": null, "parents": [{"sha": "f4b688f22f9de03e0dbaa4c7c0212e6e95aecc9d", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/f4b688f22f9de03e0dbaa4c7c0212e6e95aecc9d", "html_url": "https://github.com/Rust-GCC/gccrs/commit/f4b688f22f9de03e0dbaa4c7c0212e6e95aecc9d"}], "stats": {"total": 59, "additions": 59, "deletions": 0}, "files": [{"sha": "89936afd71d09c525353e4b043966300c442b4f3", "filename": "gcc/ChangeLog", "status": "modified", "additions": 6, "deletions": 0, "changes": 6, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/c979d5f525e854fb26e8ff7a7ef34812abef8550/gcc%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/c979d5f525e854fb26e8ff7a7ef34812abef8550/gcc%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2FChangeLog?ref=c979d5f525e854fb26e8ff7a7ef34812abef8550", "patch": "@@ -1,3 +1,9 @@\n+2013-05-25  Richard Sandiford  <rdsandiford@googlemail.com>\n+\n+\tPR target/55777\n+\t* config/mips/mips.c (mips_can_inline_p): New function.\n+\t(TARGET_CAN_INLINE_P): Define.\n+\n 2013-05-25  Steven Bosscher  <steven@gcc.gnu.org>\n \n \t* sched-int.h (ds_t, dw_t): Make unsigned int."}, {"sha": "c9383ea340831c8d172807670425eeac2689f9e9", "filename": "gcc/config/mips/mips.c", "status": "modified", "additions": 12, "deletions": 0, "changes": 12, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/c979d5f525e854fb26e8ff7a7ef34812abef8550/gcc%2Fconfig%2Fmips%2Fmips.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/c979d5f525e854fb26e8ff7a7ef34812abef8550/gcc%2Fconfig%2Fmips%2Fmips.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fconfig%2Fmips%2Fmips.c?ref=c979d5f525e854fb26e8ff7a7ef34812abef8550", "patch": "@@ -1426,6 +1426,16 @@ mips_merge_decl_attributes (tree olddecl, tree newdecl)\n   return merge_attributes (DECL_ATTRIBUTES (olddecl),\n \t\t\t   DECL_ATTRIBUTES (newdecl));\n }\n+\n+/* Implement TARGET_CAN_INLINE_P.  */\n+\n+static bool\n+mips_can_inline_p (tree caller, tree callee)\n+{\n+  if (mips_get_compress_mode (callee) != mips_get_compress_mode (caller))\n+    return false;\n+  return default_target_can_inline_p (caller, callee);\n+}\n \f\n /* If X is a PLUS of a CONST_INT, return the two terms in *BASE_PTR\n    and *OFFSET_PTR.  Return X in *BASE_PTR and 0 in *OFFSET_PTR otherwise.  */\n@@ -18600,6 +18610,8 @@ mips_expand_vec_minmax (rtx target, rtx op0, rtx op1,\n #define TARGET_INSERT_ATTRIBUTES mips_insert_attributes\n #undef TARGET_MERGE_DECL_ATTRIBUTES\n #define TARGET_MERGE_DECL_ATTRIBUTES mips_merge_decl_attributes\n+#undef TARGET_CAN_INLINE_P\n+#define TARGET_CAN_INLINE_P mips_can_inline_p\n #undef TARGET_SET_CURRENT_FUNCTION\n #define TARGET_SET_CURRENT_FUNCTION mips_set_current_function\n "}, {"sha": "fbc871641038123f2c9c9359ea8d3619d1d549dc", "filename": "gcc/testsuite/ChangeLog", "status": "modified", "additions": 6, "deletions": 0, "changes": 6, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/c979d5f525e854fb26e8ff7a7ef34812abef8550/gcc%2Ftestsuite%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/c979d5f525e854fb26e8ff7a7ef34812abef8550/gcc%2Ftestsuite%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2FChangeLog?ref=c979d5f525e854fb26e8ff7a7ef34812abef8550", "patch": "@@ -1,3 +1,9 @@\n+2013-05-25  Richard Sandiford  <rdsandiford@googlemail.com>\n+\n+\tPR target/55777\n+\t* gcc.target/mips/mips16-attributes-5.c,\n+\t* gcc.target/mips/mips16-attributes-6.c: New tests.\n+\n 2013-05-25  Eric Botcazou  <ebotcazou@adacore.com>\n \n \t* gcc.dg/builtin-bswap-6.c: Use same options as optimize-bswapsi-1.c."}, {"sha": "b84fa8862388f5abd508b3b36ddf7514a484901f", "filename": "gcc/testsuite/gcc.target/mips/mips16-attributes-5.c", "status": "added", "additions": 22, "deletions": 0, "changes": 22, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/c979d5f525e854fb26e8ff7a7ef34812abef8550/gcc%2Ftestsuite%2Fgcc.target%2Fmips%2Fmips16-attributes-5.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/c979d5f525e854fb26e8ff7a7ef34812abef8550/gcc%2Ftestsuite%2Fgcc.target%2Fmips%2Fmips16-attributes-5.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgcc.target%2Fmips%2Fmips16-attributes-5.c?ref=c979d5f525e854fb26e8ff7a7ef34812abef8550", "patch": "@@ -0,0 +1,22 @@\n+/* { dg-do compile } */\n+/* { dg-options \"(-mips16) addressing=absolute\" } */\n+/* { dg-skip-if \"requires inlining\" { *-*-* } { \"-O0\" } { \"\" } } */\n+\n+static inline MIPS16 int i1 (void) { return 1; }\n+static inline NOMIPS16 int i2 (void) { return 2; }\n+static inline MIPS16 int i3 (void) { return 3; }\n+static inline NOMIPS16 int i4 (void) { return 4; }\n+\n+int NOMIPS16 f1 (void) { return i1 (); }\n+int MIPS16 f2 (void) { return i2 (); }\n+int MIPS16 f3 (void) { return i3 (); }\n+int NOMIPS16 f4 (void) { return i4 (); }\n+\n+/* { dg-final { scan-assembler \"i1:\" } } */\n+/* { dg-final { scan-assembler \"i2:\" } } */\n+/* { dg-final { scan-assembler-not \"i3:\" } } */\n+/* { dg-final { scan-assembler-not \"i4:\" } } */\n+/* { dg-final { scan-assembler \"\\tjal\\ti1\" } } */\n+/* { dg-final { scan-assembler \"\\tjal\\ti2\" } } */\n+/* { dg-final { scan-assembler-not \"\\tjal\\ti3\" } } */\n+/* { dg-final { scan-assembler-not \"\\tjal\\ti4\" } } */"}, {"sha": "99bdf8c3ef6103e2f4754a2a8424291b7011ce12", "filename": "gcc/testsuite/gcc.target/mips/mips16-attributes-6.c", "status": "added", "additions": 13, "deletions": 0, "changes": 13, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/c979d5f525e854fb26e8ff7a7ef34812abef8550/gcc%2Ftestsuite%2Fgcc.target%2Fmips%2Fmips16-attributes-6.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/c979d5f525e854fb26e8ff7a7ef34812abef8550/gcc%2Ftestsuite%2Fgcc.target%2Fmips%2Fmips16-attributes-6.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgcc.target%2Fmips%2Fmips16-attributes-6.c?ref=c979d5f525e854fb26e8ff7a7ef34812abef8550", "patch": "@@ -0,0 +1,13 @@\n+/* { dg-do compile } */\n+/* { dg-options \"-mips16 addressing=absolute -mips3d\" } */\n+\n+static inline NOMIPS16 float\n+i1 (float f)\n+{\n+  return __builtin_mips_recip1_s (f);\n+}\n+\n+float f1 (float f) { return i1 (f); }\n+\n+/* { dg-final { scan-assembler \"\\trecip1.s\\t\" } } */\n+/* { dg-final { scan-assembler \"\\tjal\\ti1\" } } */"}]}