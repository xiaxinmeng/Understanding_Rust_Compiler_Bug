{"sha": "7f15b177ba2b5907242dec45da10da635df3e16e", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6N2YxNWIxNzdiYTJiNTkwNzI0MmRlYzQ1ZGExMGRhNjM1ZGYzZTE2ZQ==", "commit": {"author": {"name": "Richard Biener", "email": "rguenther@suse.de", "date": "2016-07-13T08:03:04Z"}, "committer": {"name": "Richard Biener", "email": "rguenth@gcc.gnu.org", "date": "2016-07-13T08:03:04Z"}, "message": "re PR tree-optimization/71104 (ICE: verify_ssa failed (with vfork /  error: definition in block 3 does not dominate use in block 7 ))\n\n2016-07-13  Richard Biener  <rguenther@suse.de>\n\n\tPR middle-end/71104\n\t* gimplify.c (gimplify_modify_expr): Gimplify the RHS before\n\tgimplifying the LHS.  Make sure to gimplify a returning twice\n\tcall LHS without using SSA names.\n\n\t* gcc.dg/pr71104-1.c: New testcase.\n\t* gcc.dg/pr71104-2.c: Likewise.\n\nFrom-SVN: r238287", "tree": {"sha": "ea0b49d988c805f076b94649d35c07b127b9da16", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/ea0b49d988c805f076b94649d35c07b127b9da16"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/7f15b177ba2b5907242dec45da10da635df3e16e", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/7f15b177ba2b5907242dec45da10da635df3e16e", "html_url": "https://github.com/Rust-GCC/gccrs/commit/7f15b177ba2b5907242dec45da10da635df3e16e", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/7f15b177ba2b5907242dec45da10da635df3e16e/comments", "author": {"login": "rguenth", "id": 2046526, "node_id": "MDQ6VXNlcjIwNDY1MjY=", "avatar_url": "https://avatars.githubusercontent.com/u/2046526?v=4", "gravatar_id": "", "url": "https://api.github.com/users/rguenth", "html_url": "https://github.com/rguenth", "followers_url": "https://api.github.com/users/rguenth/followers", "following_url": "https://api.github.com/users/rguenth/following{/other_user}", "gists_url": "https://api.github.com/users/rguenth/gists{/gist_id}", "starred_url": "https://api.github.com/users/rguenth/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/rguenth/subscriptions", "organizations_url": "https://api.github.com/users/rguenth/orgs", "repos_url": "https://api.github.com/users/rguenth/repos", "events_url": "https://api.github.com/users/rguenth/events{/privacy}", "received_events_url": "https://api.github.com/users/rguenth/received_events", "type": "User", "site_admin": false}, "committer": null, "parents": [{"sha": "4a0e3b5ac35c0f2b2b7b93aee81ddb10a45ff6d3", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/4a0e3b5ac35c0f2b2b7b93aee81ddb10a45ff6d3", "html_url": "https://github.com/Rust-GCC/gccrs/commit/4a0e3b5ac35c0f2b2b7b93aee81ddb10a45ff6d3"}], "stats": {"total": 48, "additions": 48, "deletions": 0}, "files": [{"sha": "e42e288653f48924f953049c40dd0363804cd54c", "filename": "gcc/ChangeLog", "status": "modified", "additions": 7, "deletions": 0, "changes": 7, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/7f15b177ba2b5907242dec45da10da635df3e16e/gcc%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/7f15b177ba2b5907242dec45da10da635df3e16e/gcc%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2FChangeLog?ref=7f15b177ba2b5907242dec45da10da635df3e16e", "patch": "@@ -1,3 +1,10 @@\n+2016-07-13  Richard Biener  <rguenther@suse.de>\n+\n+\tPR middle-end/71104\n+\t* gimplify.c (gimplify_modify_expr): Gimplify the RHS before\n+\tgimplifying the LHS.  Make sure to gimplify a returning twice\n+\tcall LHS without using SSA names.\n+\n 2016-07-12  Trevor Saunders  <tbsaunde+gcc@tbsaunde.org>\n \n \t* tree-data-ref.c (find_data_references_in_stmt): Remove"}, {"sha": "fb27dd0e75a458ea71a1dc0d760ed4db314178a3", "filename": "gcc/gimplify.c", "status": "modified", "additions": 12, "deletions": 0, "changes": 12, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/7f15b177ba2b5907242dec45da10da635df3e16e/gcc%2Fgimplify.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/7f15b177ba2b5907242dec45da10da635df3e16e/gcc%2Fgimplify.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fgimplify.c?ref=7f15b177ba2b5907242dec45da10da635df3e16e", "patch": "@@ -4810,7 +4810,19 @@ gimplify_modify_expr (tree *expr_p, gimple_seq *pre_p, gimple_seq *post_p,\n     return ret;\n \n   /* Then gimplify the LHS.  */\n+  /* If we gimplified the RHS to a CALL_EXPR and that call may return\n+     twice we have to make sure to gimplify into non-SSA as otherwise\n+     the abnormal edge added later will make those defs not dominate\n+     their uses.\n+     ???  Technically this applies only to the registers used in the\n+     resulting non-register *TO_P.  */\n+  bool saved_into_ssa = gimplify_ctxp->into_ssa;\n+  if (saved_into_ssa\n+      && TREE_CODE (*from_p) == CALL_EXPR\n+      && call_expr_flags (*from_p) & ECF_RETURNS_TWICE)\n+    gimplify_ctxp->into_ssa = false;\n   ret = gimplify_expr (to_p, pre_p, post_p, is_gimple_lvalue, fb_lvalue);\n+  gimplify_ctxp->into_ssa = saved_into_ssa;\n   if (ret == GS_ERROR)\n     return ret;\n "}, {"sha": "d4e0fcabdc038d4113cae00e4d0e1d71521291ff", "filename": "gcc/testsuite/ChangeLog", "status": "modified", "additions": 6, "deletions": 0, "changes": 6, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/7f15b177ba2b5907242dec45da10da635df3e16e/gcc%2Ftestsuite%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/7f15b177ba2b5907242dec45da10da635df3e16e/gcc%2Ftestsuite%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2FChangeLog?ref=7f15b177ba2b5907242dec45da10da635df3e16e", "patch": "@@ -1,3 +1,9 @@\n+2016-07-13  Richard Biener  <rguenther@suse.de>\n+\n+\tPR middle-end/71104\n+\t* gcc.dg/pr71104-1.c: New testcase.\n+\t* gcc.dg/pr71104-2.c: Likewise.\n+\n 2016-07-12  Michael Meissner  <meissner@linux.vnet.ibm.com>\n \n \tPR target/71805"}, {"sha": "20c055ad81794dedcea16c62e291693fa734a332", "filename": "gcc/testsuite/gcc.dg/pr71104-1.c", "status": "added", "additions": 11, "deletions": 0, "changes": 11, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/7f15b177ba2b5907242dec45da10da635df3e16e/gcc%2Ftestsuite%2Fgcc.dg%2Fpr71104-1.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/7f15b177ba2b5907242dec45da10da635df3e16e/gcc%2Ftestsuite%2Fgcc.dg%2Fpr71104-1.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgcc.dg%2Fpr71104-1.c?ref=7f15b177ba2b5907242dec45da10da635df3e16e", "patch": "@@ -0,0 +1,11 @@\n+/* { dg-do compile } */\n+\n+void foo(void);\n+int vfork(void);\n+int *p;\n+\n+void bar(void)\n+{\n+  foo();\n+  *p = vfork();\n+}"}, {"sha": "03c52a338c3eae9364e6899720d81bfcc17e4e75", "filename": "gcc/testsuite/gcc.dg/pr71104-2.c", "status": "added", "additions": 12, "deletions": 0, "changes": 12, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/7f15b177ba2b5907242dec45da10da635df3e16e/gcc%2Ftestsuite%2Fgcc.dg%2Fpr71104-2.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/7f15b177ba2b5907242dec45da10da635df3e16e/gcc%2Ftestsuite%2Fgcc.dg%2Fpr71104-2.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgcc.dg%2Fpr71104-2.c?ref=7f15b177ba2b5907242dec45da10da635df3e16e", "patch": "@@ -0,0 +1,12 @@\n+/* { dg-do compile } */\n+\n+struct Foo { char c[1024]; };\n+void foo(void);\n+struct Foo baz(void) __attribute__((returns_twice));\n+struct Foo *p;\n+\n+void bar(void)\n+{\n+  foo();\n+  *p = baz();\n+}"}]}