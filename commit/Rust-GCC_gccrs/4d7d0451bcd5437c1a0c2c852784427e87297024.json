{"sha": "4d7d0451bcd5437c1a0c2c852784427e87297024", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6NGQ3ZDA0NTFiY2Q1NDM3YzFhMGMyYzg1Mjc4NDQyN2U4NzI5NzAyNA==", "commit": {"author": {"name": "Jan Hubicka", "email": "jh@suse.cz", "date": "2003-06-25T22:14:26Z"}, "committer": {"name": "Jan Hubicka", "email": "hubicka@gcc.gnu.org", "date": "2003-06-25T22:14:26Z"}, "message": "c-common.c (handle_used_attribute): Use mark_referenced.\n\n\t* c-common.c (handle_used_attribute): Use mark_referenced.\n\t* varasm.c (mark_referenced): Break out from ...\n\t(assemble_name): ... here.\n\t* tree.h (mark_referenced): Declare.\n\nFrom-SVN: r68500", "tree": {"sha": "6bb2629ee62f198c4d510aa1649411077fcadf74", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/6bb2629ee62f198c4d510aa1649411077fcadf74"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/4d7d0451bcd5437c1a0c2c852784427e87297024", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/4d7d0451bcd5437c1a0c2c852784427e87297024", "html_url": "https://github.com/Rust-GCC/gccrs/commit/4d7d0451bcd5437c1a0c2c852784427e87297024", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/4d7d0451bcd5437c1a0c2c852784427e87297024/comments", "author": null, "committer": null, "parents": [{"sha": "6322fdd83b824be16b3d492a5897246db2ac9efd", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/6322fdd83b824be16b3d492a5897246db2ac9efd", "html_url": "https://github.com/Rust-GCC/gccrs/commit/6322fdd83b824be16b3d492a5897246db2ac9efd"}], "stats": {"total": 58, "additions": 37, "deletions": 21}, "files": [{"sha": "9d8dd82f8268cd431bf51a94bba2bd7d83f4f9f7", "filename": "gcc/ChangeLog", "status": "modified", "additions": 7, "deletions": 0, "changes": 7, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/4d7d0451bcd5437c1a0c2c852784427e87297024/gcc%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/4d7d0451bcd5437c1a0c2c852784427e87297024/gcc%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2FChangeLog?ref=4d7d0451bcd5437c1a0c2c852784427e87297024", "patch": "@@ -1,3 +1,10 @@\n+Thu Jun 26 00:13:35 CEST 2003  Jan Hubicka  <jh@suse.cz>\n+\n+\t* c-common.c (handle_used_attribute): Use mark_referenced.\n+\t* varasm.c (mark_referenced): Break out from ...\n+\t(assemble_name): ... here.\n+\t* tree.h (mark_referenced): Declare.\n+\n 2003-06-25  Wolfgang Bangerth  <bangerth@dealii.org>\n \n \t* gccbug.in: Add PCH to list of categories."}, {"sha": "43f9586d415782f799b8da7fcd4011c9d91c1c74", "filename": "gcc/c-common.c", "status": "modified", "additions": 4, "deletions": 2, "changes": 6, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/4d7d0451bcd5437c1a0c2c852784427e87297024/gcc%2Fc-common.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/4d7d0451bcd5437c1a0c2c852784427e87297024/gcc%2Fc-common.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fc-common.c?ref=4d7d0451bcd5437c1a0c2c852784427e87297024", "patch": "@@ -4812,8 +4812,10 @@ handle_used_attribute (tree *pnode, tree name, tree args ATTRIBUTE_UNUSED,\n \n   if (TREE_CODE (node) == FUNCTION_DECL\n       || (TREE_CODE (node) == VAR_DECL && TREE_STATIC (node)))\n-    TREE_SYMBOL_REFERENCED (DECL_ASSEMBLER_NAME (node))\n-      = TREE_USED (node) = 1;\n+    {\n+      mark_referenced (DECL_ASSEMBLER_NAME (node));\n+      TREE_USED (node) = 1;\n+    }\n   else\n     {\n       warning (\"`%s' attribute ignored\", IDENTIFIER_POINTER (name));"}, {"sha": "e43466b5d24aecaf8d720a860198a522ddb15e2c", "filename": "gcc/tree.h", "status": "modified", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/4d7d0451bcd5437c1a0c2c852784427e87297024/gcc%2Ftree.h", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/4d7d0451bcd5437c1a0c2c852784427e87297024/gcc%2Ftree.h", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftree.h?ref=4d7d0451bcd5437c1a0c2c852784427e87297024", "patch": "@@ -2908,6 +2908,7 @@ extern void variable_section\t\tPARAMS ((tree, int));\n enum tls_model decl_tls_model\t\tPARAMS ((tree));\n enum symbol_visibility decl_visibility\tPARAMS ((tree));\n extern void resolve_unique_section\tPARAMS ((tree, int, int));\n+extern void mark_referenced\tPARAMS ((tree));\n \n /* In stmt.c */\n extern void emit_nop\t\t\tPARAMS ((void));"}, {"sha": "7519138b3f6f0957b5124cf661370323fbc2f6ac", "filename": "gcc/varasm.c", "status": "modified", "additions": 25, "deletions": 19, "changes": 44, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/4d7d0451bcd5437c1a0c2c852784427e87297024/gcc%2Fvarasm.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/4d7d0451bcd5437c1a0c2c852784427e87297024/gcc%2Fvarasm.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fvarasm.c?ref=4d7d0451bcd5437c1a0c2c852784427e87297024", "patch": "@@ -1728,6 +1728,30 @@ assemble_label (name)\n   ASM_OUTPUT_LABEL (asm_out_file, name);\n }\n \n+/* Set the symbol_referenced flag for ID and notify callgraph code.  */\n+void\n+mark_referenced (id)\n+     tree id;\n+{\n+  if (!TREE_SYMBOL_REFERENCED (id))\n+    {\n+      struct cgraph_node *node;\n+      struct cgraph_varpool_node *vnode;\n+\n+      if (!cgraph_global_info_ready)\n+\t{\n+\t  node = cgraph_node_for_identifier (id);\n+\t  if (node)\n+\t    cgraph_mark_needed_node (node, 1);\n+\t}\n+\n+      vnode = cgraph_varpool_node_for_identifier (id);\n+      if (vnode)\n+\tcgraph_varpool_mark_needed_node (vnode);\n+    }\n+  TREE_SYMBOL_REFERENCED (id) = 1;\n+}\n+\n /* Output to FILE a reference to the assembler name of a C-level name NAME.\n    If NAME starts with a *, the rest of NAME is output verbatim.\n    Otherwise NAME is transformed in an implementation-defined way\n@@ -1746,25 +1770,7 @@ assemble_name (file, name)\n \n   id = maybe_get_identifier (real_name);\n   if (id)\n-    {\n-      if (!TREE_SYMBOL_REFERENCED (id))\n-\t{\n-\t  struct cgraph_node *node;\n-\t  struct cgraph_varpool_node *vnode;\n-\t  \n-\t  if (!cgraph_global_info_ready)\n-\t    {\n-\t      node = cgraph_node_for_identifier (id);\n-\t      if (node)\n-\t\tcgraph_mark_needed_node (node, 1);\n-\t    }\n-\n-\t  vnode = cgraph_varpool_node_for_identifier (id);\n-\t  if (vnode)\n-\t    cgraph_varpool_mark_needed_node (vnode);\n-\t}\n-      TREE_SYMBOL_REFERENCED (id) = 1;\n-    }\n+    mark_referenced (id);\n \n   if (name[0] == '*')\n     fputs (&name[1], file);"}]}