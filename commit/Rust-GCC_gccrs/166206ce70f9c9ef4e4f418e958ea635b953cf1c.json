{"sha": "166206ce70f9c9ef4e4f418e958ea635b953cf1c", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6MTY2MjA2Y2U3MGY5YzllZjRlNGY0MThlOTU4ZWE2MzViOTUzY2YxYw==", "commit": {"author": {"name": "Volker Reichelt", "email": "reichelt@igpm.rwth-aachen.de", "date": "2005-08-30T16:22:00Z"}, "committer": {"name": "Volker Reichelt", "email": "reichelt@gcc.gnu.org", "date": "2005-08-30T16:22:00Z"}, "message": "re PR c++/23586 (Bad diagnostic for invalid namespace-name)\n\n\tPR c++/23586\n\t* parser.c (cp_parser_namespace_name): Move diagnostic for\n\tinvalid namespace-name to here from ...\n\t* name-lookup.c (do_namespace_alias): ... here and ...\n\t(do_using_directive): ... here.  Remove dead code.\n\nFrom-SVN: r103643", "tree": {"sha": "149d5122acf1aea4600cd84ba169da49ef609206", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/149d5122acf1aea4600cd84ba169da49ef609206"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/166206ce70f9c9ef4e4f418e958ea635b953cf1c", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/166206ce70f9c9ef4e4f418e958ea635b953cf1c", "html_url": "https://github.com/Rust-GCC/gccrs/commit/166206ce70f9c9ef4e4f418e958ea635b953cf1c", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/166206ce70f9c9ef4e4f418e958ea635b953cf1c/comments", "author": null, "committer": null, "parents": [{"sha": "7a98d47cf7832ce369db72c587b9ed0d48f21755", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/7a98d47cf7832ce369db72c587b9ed0d48f21755", "html_url": "https://github.com/Rust-GCC/gccrs/commit/7a98d47cf7832ce369db72c587b9ed0d48f21755"}], "stats": {"total": 43, "additions": 20, "deletions": 23}, "files": [{"sha": "cc107753e19edf5caa91710a33ddbcc161462fbf", "filename": "gcc/cp/ChangeLog", "status": "modified", "additions": 8, "deletions": 0, "changes": 8, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/166206ce70f9c9ef4e4f418e958ea635b953cf1c/gcc%2Fcp%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/166206ce70f9c9ef4e4f418e958ea635b953cf1c/gcc%2Fcp%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fcp%2FChangeLog?ref=166206ce70f9c9ef4e4f418e958ea635b953cf1c", "patch": "@@ -1,3 +1,11 @@\n+2005-08-30  Volker Reichelt  <reichelt@igpm.rwth-aachen.de>\n+\n+\tPR c++/23586\n+\t* parser.c (cp_parser_namespace_name): Move diagnostic for\n+\tinvalid namespace-name to here from ...\n+\t* name-lookup.c (do_namespace_alias): ... here and ...\n+\t(do_using_directive): ... here.  Remove dead code.\n+\n 2005-08-28  Mark Mitchell  <mark@codesourcery.com>\n \n \tPR c++/23099"}, {"sha": "f936a86cc28ff9ccd1039fac02bb33060245c6bf", "filename": "gcc/cp/name-lookup.c", "status": "modified", "additions": 10, "deletions": 23, "changes": 33, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/166206ce70f9c9ef4e4f418e958ea635b953cf1c/gcc%2Fcp%2Fname-lookup.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/166206ce70f9c9ef4e4f418e958ea635b953cf1c/gcc%2Fcp%2Fname-lookup.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fcp%2Fname-lookup.c?ref=166206ce70f9c9ef4e4f418e958ea635b953cf1c", "patch": "@@ -3037,12 +3037,10 @@ namespace_ancestor (tree ns1, tree ns2)\n void\n do_namespace_alias (tree alias, tree namespace)\n {\n-  if (TREE_CODE (namespace) != NAMESPACE_DECL)\n-    {\n-      /* The parser did not find it, so it's not there.  */\n-      error (\"unknown namespace %qD\", namespace);\n-      return;\n-    }\n+  if (namespace == error_mark_node)\n+    return;\n+\n+  gcc_assert (TREE_CODE (namespace) == NAMESPACE_DECL);\n \n   namespace = ORIGINAL_NAMESPACE (namespace);\n \n@@ -3191,26 +3189,15 @@ do_using_directive (tree namespace)\n {\n   tree context = NULL_TREE;\n \n+  if (namespace == error_mark_node)\n+    return;\n+\n+  gcc_assert (TREE_CODE (namespace) == NAMESPACE_DECL);\n+\n   if (building_stmt_tree ())\n     add_stmt (build_stmt (USING_STMT, namespace));\n-\n-  /* using namespace A::B::C; */\n-  if (TREE_CODE (namespace) == SCOPE_REF)\n-      namespace = TREE_OPERAND (namespace, 1);\n-  if (TREE_CODE (namespace) == IDENTIFIER_NODE)\n-    {\n-      /* Lookup in lexer did not find a namespace.  */\n-      if (!processing_template_decl)\n-\terror (\"namespace %qT undeclared\", namespace);\n-      return;\n-    }\n-  if (TREE_CODE (namespace) != NAMESPACE_DECL)\n-    {\n-      if (!processing_template_decl)\n-\terror (\"%qT is not a namespace\", namespace);\n-      return;\n-    }\n   namespace = ORIGINAL_NAMESPACE (namespace);\n+\n   if (!toplevel_bindings_p ())\n     {\n       push_using_directive (namespace);"}, {"sha": "bebdfcbb5fe73dc6a3e150adc4e990092d938b6a", "filename": "gcc/cp/parser.c", "status": "modified", "additions": 2, "deletions": 0, "changes": 2, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/166206ce70f9c9ef4e4f418e958ea635b953cf1c/gcc%2Fcp%2Fparser.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/166206ce70f9c9ef4e4f418e958ea635b953cf1c/gcc%2Fcp%2Fparser.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fcp%2Fparser.c?ref=166206ce70f9c9ef4e4f418e958ea635b953cf1c", "patch": "@@ -10254,6 +10254,8 @@ cp_parser_namespace_name (cp_parser* parser)\n   if (namespace_decl == error_mark_node\n       || TREE_CODE (namespace_decl) != NAMESPACE_DECL)\n     {\n+      if (!cp_parser_uncommitted_to_tentative_parse_p (parser))\n+\terror (\"%qD is not a namespace-name\", identifier);\n       cp_parser_error (parser, \"expected namespace-name\");\n       namespace_decl = error_mark_node;\n     }"}]}