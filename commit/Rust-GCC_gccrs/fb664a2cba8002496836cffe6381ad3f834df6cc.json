{"sha": "fb664a2cba8002496836cffe6381ad3f834df6cc", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6ZmI2NjRhMmNiYTgwMDI0OTY4MzZjZmZlNjM4MWFkM2Y4MzRkZjZjYw==", "commit": {"author": {"name": "Richard Guenther", "email": "rguenth@gcc.gnu.org", "date": "2005-05-17T09:00:03Z"}, "committer": {"name": "Richard Biener", "email": "rguenth@gcc.gnu.org", "date": "2005-05-17T09:00:03Z"}, "message": "re PR middle-end/21595 (__builtin_constant_p(&\"Hello\"[0]) is true for C but not for C++)\n\n2005-05-17  Richard Guenther  <rguenth@gcc.gnu.org>\n\n\tPR middle-end/21595\n\t* builtins.c (fold_builtin_constant_p): Handle\n\t&\"string cst\"[0] as constant.\n\n\t* g++.dg/tree-ssa/builtin1.C: New testcase.\n\nFrom-SVN: r99825", "tree": {"sha": "08aa63c8607e392e807a4a279e038b70ec7fb28b", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/08aa63c8607e392e807a4a279e038b70ec7fb28b"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/fb664a2cba8002496836cffe6381ad3f834df6cc", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/fb664a2cba8002496836cffe6381ad3f834df6cc", "html_url": "https://github.com/Rust-GCC/gccrs/commit/fb664a2cba8002496836cffe6381ad3f834df6cc", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/fb664a2cba8002496836cffe6381ad3f834df6cc/comments", "author": null, "committer": null, "parents": [{"sha": "64e6863ed571bbd89eb7a65e3727a2a4ecc1ea27", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/64e6863ed571bbd89eb7a65e3727a2a4ecc1ea27", "html_url": "https://github.com/Rust-GCC/gccrs/commit/64e6863ed571bbd89eb7a65e3727a2a4ecc1ea27"}], "stats": {"total": 34, "additions": 31, "deletions": 3}, "files": [{"sha": "449a1b49c257a5c4304c6936c3f94b598636c039", "filename": "gcc/ChangeLog", "status": "modified", "additions": 6, "deletions": 0, "changes": 6, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/fb664a2cba8002496836cffe6381ad3f834df6cc/gcc%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/fb664a2cba8002496836cffe6381ad3f834df6cc/gcc%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2FChangeLog?ref=fb664a2cba8002496836cffe6381ad3f834df6cc", "patch": "@@ -1,3 +1,9 @@\n+2005-05-17  Richard Guenther  <rguenth@gcc.gnu.org>\n+\n+\tPR middle-end/21595\n+\t* builtins.c (fold_builtin_constant_p): Handle\n+\t&\"string cst\"[0] as constant.\n+\n 2005-05-17  Richard Henderson  <rth@redhat.com>\n \n \t* config/i386/sse.md (mulv16qi3, mulv2di3): New."}, {"sha": "cdc5cebcbc6dea3bcc5c076ebbde0bd488fb803b", "filename": "gcc/builtins.c", "status": "modified", "additions": 10, "deletions": 3, "changes": 13, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/fb664a2cba8002496836cffe6381ad3f834df6cc/gcc%2Fbuiltins.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/fb664a2cba8002496836cffe6381ad3f834df6cc/gcc%2Fbuiltins.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fbuiltins.c?ref=fb664a2cba8002496836cffe6381ad3f834df6cc", "patch": "@@ -6338,10 +6338,17 @@ fold_builtin_constant_p (tree arglist)\n   /* If we know this is a constant, emit the constant of one.  */\n   if (CONSTANT_CLASS_P (arglist)\n       || (TREE_CODE (arglist) == CONSTRUCTOR\n-\t  && TREE_CONSTANT (arglist))\n-      || (TREE_CODE (arglist) == ADDR_EXPR\n-\t  && TREE_CODE (TREE_OPERAND (arglist, 0)) == STRING_CST))\n+\t  && TREE_CONSTANT (arglist)))\n     return integer_one_node;\n+  if (TREE_CODE (arglist) == ADDR_EXPR)\n+    {\n+       tree op = TREE_OPERAND (arglist, 0);\n+       if (TREE_CODE (op) == STRING_CST\n+\t   || (TREE_CODE (op) == ARRAY_REF\n+\t       && integer_zerop (TREE_OPERAND (op, 1))\n+\t       && TREE_CODE (TREE_OPERAND (op, 0)) == STRING_CST))\n+\t return integer_one_node;\n+    }\n \n   /* If this expression has side effects, show we don't know it to be a\n      constant.  Likewise if it's a pointer or aggregate type since in"}, {"sha": "b6ce026b19719e2bf06aff0b60909314a6385e2b", "filename": "gcc/testsuite/ChangeLog", "status": "modified", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/fb664a2cba8002496836cffe6381ad3f834df6cc/gcc%2Ftestsuite%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/fb664a2cba8002496836cffe6381ad3f834df6cc/gcc%2Ftestsuite%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2FChangeLog?ref=fb664a2cba8002496836cffe6381ad3f834df6cc", "patch": "@@ -1,3 +1,8 @@\n+2005-05-17  Richard Guenther  <rguenth@gcc.gnu.org>\n+\n+\tPR middle-end/21595\n+\t* g++.dg/tree-ssa/builtin1.C: New testcase.\n+\n 2005-05-17  Jakub Jelinek  <jakub@redhat.com>\n \n \tPR c++/21454"}, {"sha": "76813cb8dddf083bf05d1c0f5718acb4ba334ff5", "filename": "gcc/testsuite/g++.dg/tree-ssa/builtin1.C", "status": "added", "additions": 10, "deletions": 0, "changes": 10, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/fb664a2cba8002496836cffe6381ad3f834df6cc/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Ftree-ssa%2Fbuiltin1.C", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/fb664a2cba8002496836cffe6381ad3f834df6cc/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Ftree-ssa%2Fbuiltin1.C", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Ftree-ssa%2Fbuiltin1.C?ref=fb664a2cba8002496836cffe6381ad3f834df6cc", "patch": "@@ -0,0 +1,10 @@\n+// { dg-do link }\n+\n+extern void link_error();\n+\n+int main()\n+{\n+\tif (! __builtin_constant_p (&\"Hello\"[0]))\n+\t\tlink_error();\n+\treturn 0;\n+}"}]}