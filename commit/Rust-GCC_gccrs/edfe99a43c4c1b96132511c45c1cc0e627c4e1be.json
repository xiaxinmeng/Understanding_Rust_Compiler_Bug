{"sha": "edfe99a43c4c1b96132511c45c1cc0e627c4e1be", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6ZWRmZTk5YTQzYzRjMWI5NjEzMjUxMWM0NWMxY2MwZTYyN2M0ZTFiZQ==", "commit": {"author": {"name": "Jan Hubicka", "email": "hubicka@ucw.cz", "date": "2017-07-03T12:17:59Z"}, "committer": {"name": "Jan Hubicka", "email": "hubicka@gcc.gnu.org", "date": "2017-07-03T12:17:59Z"}, "message": "re PR target/81285 (r249888 breaks bootstrap on ppc64le)\n\n\n\tPR bootstrap/81285\n\t* loop-doloop.c (add_test): Update profile.\n\nFrom-SVN: r249904", "tree": {"sha": "41816725acdbb28c440b96e080188f465dae969b", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/41816725acdbb28c440b96e080188f465dae969b"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/edfe99a43c4c1b96132511c45c1cc0e627c4e1be", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/edfe99a43c4c1b96132511c45c1cc0e627c4e1be", "html_url": "https://github.com/Rust-GCC/gccrs/commit/edfe99a43c4c1b96132511c45c1cc0e627c4e1be", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/edfe99a43c4c1b96132511c45c1cc0e627c4e1be/comments", "author": null, "committer": null, "parents": [{"sha": "da4029679e2be30dc78f3f3a016226f6e2299abb", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/da4029679e2be30dc78f3f3a016226f6e2299abb", "html_url": "https://github.com/Rust-GCC/gccrs/commit/da4029679e2be30dc78f3f3a016226f6e2299abb"}], "stats": {"total": 19, "additions": 14, "deletions": 5}, "files": [{"sha": "19c6c29070bda8d013f99f1d84a68f1baa1ca05b", "filename": "gcc/ChangeLog", "status": "modified", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/edfe99a43c4c1b96132511c45c1cc0e627c4e1be/gcc%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/edfe99a43c4c1b96132511c45c1cc0e627c4e1be/gcc%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2FChangeLog?ref=edfe99a43c4c1b96132511c45c1cc0e627c4e1be", "patch": "@@ -1,3 +1,8 @@\n+2017-07-02  Jan Hubicka  <hubicka@ucw.cz>\n+\n+\tPR bootstrap/81285\n+\t* loop-doloop.c (add_test): Update profile.\n+\n 2017-07-03  Martin Liska  <mliska@suse.cz>\n \n \tPR sanitize/81040"}, {"sha": "b4995b389bb4009dfaf060391d1f9722e4334d8d", "filename": "gcc/loop-doloop.c", "status": "modified", "additions": 9, "deletions": 5, "changes": 14, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/edfe99a43c4c1b96132511c45c1cc0e627c4e1be/gcc%2Floop-doloop.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/edfe99a43c4c1b96132511c45c1cc0e627c4e1be/gcc%2Floop-doloop.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Floop-doloop.c?ref=edfe99a43c4c1b96132511c45c1cc0e627c4e1be", "patch": "@@ -347,6 +347,8 @@ add_test (rtx cond, edge *e, basic_block dest)\n   rtx op0 = XEXP (cond, 0), op1 = XEXP (cond, 1);\n   enum rtx_code code = GET_CODE (cond);\n   basic_block bb;\n+  /* The jump is supposed to handle an unlikely special case.  */\n+  profile_probability prob = profile_probability::guessed_never ();\n \n   mode = GET_MODE (XEXP (cond, 0));\n   if (mode == VOIDmode)\n@@ -357,7 +359,7 @@ add_test (rtx cond, edge *e, basic_block dest)\n   op1 = force_operand (op1, NULL_RTX);\n   label = block_label (dest);\n   do_compare_rtx_and_jump (op0, op1, code, 0, mode, NULL_RTX, NULL, label,\n-\t\t\t   profile_probability::uninitialized ());\n+\t\t\t   prob);\n \n   jump = get_last_insn ();\n   if (!jump || !JUMP_P (jump))\n@@ -387,12 +389,14 @@ add_test (rtx cond, edge *e, basic_block dest)\n \n   JUMP_LABEL (jump) = label;\n \n-  /* The jump is supposed to handle an unlikely special case.  */\n-  add_int_reg_note (jump, REG_BR_PROB, 0);\n-\n   LABEL_NUSES (label)++;\n \n-  make_edge (bb, dest, (*e)->flags & ~EDGE_FALLTHRU);\n+  edge e2 = make_edge (bb, dest, (*e)->flags & ~EDGE_FALLTHRU);\n+  e2->probability = prob;\n+  e2->count = e2->src->count.apply_probability (prob);\n+  (*e)->probability = prob.invert ();\n+  (*e)->count = (*e)->count.apply_probability (prob);\n+  update_br_prob_note (e2->src);\n   return true;\n }\n "}]}