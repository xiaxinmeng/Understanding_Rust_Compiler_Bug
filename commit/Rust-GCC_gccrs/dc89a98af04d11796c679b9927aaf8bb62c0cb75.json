{"sha": "dc89a98af04d11796c679b9927aaf8bb62c0cb75", "node_id": "C_kwDOANBUbNoAKGRjODlhOThhZjA0ZDExNzk2YzY3OWI5OTI3YWFmOGJiNjJjMGNiNzU", "commit": {"author": {"name": "Pierre-Emmanuel Patry", "email": "pierre-emmanuel.patry@embecosm.com", "date": "2023-04-12T15:58:27Z"}, "committer": {"name": "CohenArthur", "email": "arthur.cohen@embecosm.com", "date": "2023-04-21T13:15:47Z"}, "message": "libproc_macro: Add remaining drop functions\n\nRemaining structures from the rust bridge that missed a drop function\nnow have one.\n\nChangeLog:\n\n\t* libgrust/libproc_macro/group.cc (Group::drop): Add drop\n\timplementation.\n\t* libgrust/libproc_macro/group.h: Add drop prototype.\n\t* libgrust/libproc_macro/tokenstream.cc (TokenStream::drop): Add\n\tdrop implementation.\n\t(TokenStream__drop): Change to a call to TokenStream::drop.\n\t* libgrust/libproc_macro/tokenstream.h: Add drop prototype.\n\t* libgrust/libproc_macro/tokentree.cc (TokenTree::drop): Add\n\tdrop implementation.\n\t* libgrust/libproc_macro/tokentree.h: Add drop prototype.\n\nSigned-off-by: Pierre-Emmanuel Patry <pierre-emmanuel.patry@embecosm.com>", "tree": {"sha": "c65af8354a5c373147c4fa4fd2f1ef7c4269285d", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/c65af8354a5c373147c4fa4fd2f1ef7c4269285d"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/dc89a98af04d11796c679b9927aaf8bb62c0cb75", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/dc89a98af04d11796c679b9927aaf8bb62c0cb75", "html_url": "https://github.com/Rust-GCC/gccrs/commit/dc89a98af04d11796c679b9927aaf8bb62c0cb75", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/dc89a98af04d11796c679b9927aaf8bb62c0cb75/comments", "author": {"login": "P-E-P", "id": 32375388, "node_id": "MDQ6VXNlcjMyMzc1Mzg4", "avatar_url": "https://avatars.githubusercontent.com/u/32375388?v=4", "gravatar_id": "", "url": "https://api.github.com/users/P-E-P", "html_url": "https://github.com/P-E-P", "followers_url": "https://api.github.com/users/P-E-P/followers", "following_url": "https://api.github.com/users/P-E-P/following{/other_user}", "gists_url": "https://api.github.com/users/P-E-P/gists{/gist_id}", "starred_url": "https://api.github.com/users/P-E-P/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/P-E-P/subscriptions", "organizations_url": "https://api.github.com/users/P-E-P/orgs", "repos_url": "https://api.github.com/users/P-E-P/repos", "events_url": "https://api.github.com/users/P-E-P/events{/privacy}", "received_events_url": "https://api.github.com/users/P-E-P/received_events", "type": "User", "site_admin": false}, "committer": {"login": "CohenArthur", "id": 43524065, "node_id": "MDQ6VXNlcjQzNTI0MDY1", "avatar_url": "https://avatars.githubusercontent.com/u/43524065?v=4", "gravatar_id": "", "url": "https://api.github.com/users/CohenArthur", "html_url": "https://github.com/CohenArthur", "followers_url": "https://api.github.com/users/CohenArthur/followers", "following_url": "https://api.github.com/users/CohenArthur/following{/other_user}", "gists_url": "https://api.github.com/users/CohenArthur/gists{/gist_id}", "starred_url": "https://api.github.com/users/CohenArthur/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/CohenArthur/subscriptions", "organizations_url": "https://api.github.com/users/CohenArthur/orgs", "repos_url": "https://api.github.com/users/CohenArthur/repos", "events_url": "https://api.github.com/users/CohenArthur/events{/privacy}", "received_events_url": "https://api.github.com/users/CohenArthur/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "ca50a4f3a665031a92e5030650049f7484756028", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/ca50a4f3a665031a92e5030650049f7484756028", "html_url": "https://github.com/Rust-GCC/gccrs/commit/ca50a4f3a665031a92e5030650049f7484756028"}], "stats": {"total": 48, "additions": 44, "deletions": 4}, "files": [{"sha": "c5948ed03c79d97e8d0dcf98240a8cb54816aa93", "filename": "libgrust/libproc_macro/group.cc", "status": "modified", "additions": 6, "deletions": 0, "changes": 6, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/dc89a98af04d11796c679b9927aaf8bb62c0cb75/libgrust%2Flibproc_macro%2Fgroup.cc", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/dc89a98af04d11796c679b9927aaf8bb62c0cb75/libgrust%2Flibproc_macro%2Fgroup.cc", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libgrust%2Flibproc_macro%2Fgroup.cc?ref=dc89a98af04d11796c679b9927aaf8bb62c0cb75", "patch": "@@ -30,4 +30,10 @@ Group::make_group (TokenStream::TokenStream stream, Delimiter delim)\n   return {delim, stream};\n }\n \n+void\n+Group::drop (Group *g)\n+{\n+  TokenStream::TokenStream::drop (&g->stream);\n+}\n+\n } // namespace Group"}, {"sha": "bf2a23ff3ecfd8fbe1a00ba4837f91d033db1dee", "filename": "libgrust/libproc_macro/group.h", "status": "modified", "additions": 2, "deletions": 0, "changes": 2, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/dc89a98af04d11796c679b9927aaf8bb62c0cb75/libgrust%2Flibproc_macro%2Fgroup.h", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/dc89a98af04d11796c679b9927aaf8bb62c0cb75/libgrust%2Flibproc_macro%2Fgroup.h", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libgrust%2Flibproc_macro%2Fgroup.h?ref=dc89a98af04d11796c679b9927aaf8bb62c0cb75", "patch": "@@ -42,6 +42,8 @@ struct Group\n \n public:\n   static Group make_group (TokenStream::TokenStream stream, Delimiter delim);\n+\n+  static void drop (Group *g);\n };\n \n } // namespace Group"}, {"sha": "921cc22bf13960e70b95dbe000760d976a8e82cb", "filename": "libgrust/libproc_macro/tokenstream.cc", "status": "modified", "additions": 13, "deletions": 4, "changes": 17, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/dc89a98af04d11796c679b9927aaf8bb62c0cb75/libgrust%2Flibproc_macro%2Ftokenstream.cc", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/dc89a98af04d11796c679b9927aaf8bb62c0cb75/libgrust%2Flibproc_macro%2Ftokenstream.cc", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libgrust%2Flibproc_macro%2Ftokenstream.cc?ref=dc89a98af04d11796c679b9927aaf8bb62c0cb75", "patch": "@@ -64,6 +64,18 @@ TokenStream::push (TokenTree::TokenTree tree)\n   size++;\n }\n \n+void\n+TokenStream::drop (TokenStream *stream)\n+{\n+  for (std::uint64_t i = 0; i < stream->size; i++)\n+    {\n+      TokenTree::TokenTree::drop (&stream->data[i]);\n+    }\n+  delete[] stream->data;\n+  stream->capacity = 0;\n+  stream->size = 0;\n+}\n+\n extern \"C\" TokenStream\n TokenStream__new ()\n {\n@@ -101,10 +113,7 @@ TokenStream__clone (const TokenStream *ts)\n extern \"C\" void\n TokenStream__drop (TokenStream *stream)\n {\n-  // FIXME: Also drop stream components\n-  delete[] stream->data;\n-  stream->capacity = 0;\n-  stream->size = 0;\n+  TokenStream::drop (stream);\n }\n \n } // namespace TokenStream"}, {"sha": "909e6f441b2be11fd91497d51cbe881335b3b1e3", "filename": "libgrust/libproc_macro/tokenstream.h", "status": "modified", "additions": 2, "deletions": 0, "changes": 2, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/dc89a98af04d11796c679b9927aaf8bb62c0cb75/libgrust%2Flibproc_macro%2Ftokenstream.h", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/dc89a98af04d11796c679b9927aaf8bb62c0cb75/libgrust%2Flibproc_macro%2Ftokenstream.h", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libgrust%2Flibproc_macro%2Ftokenstream.h?ref=dc89a98af04d11796c679b9927aaf8bb62c0cb75", "patch": "@@ -49,6 +49,8 @@ struct TokenStream\n   static TokenStream make_tokenstream (std::vector<TokenTree::TokenTree> vec);\n   static TokenStream make_tokenstream (std::uint64_t capacity\n \t\t\t\t       = DEFAULT_CAPACITY);\n+\n+  static void drop (TokenStream *stream);\n };\n \n extern \"C\" TokenStream"}, {"sha": "924e50c6f3b85ee0358a7781fc8854d5d858ffbd", "filename": "libgrust/libproc_macro/tokentree.cc", "status": "modified", "additions": 19, "deletions": 0, "changes": 19, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/dc89a98af04d11796c679b9927aaf8bb62c0cb75/libgrust%2Flibproc_macro%2Ftokentree.cc", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/dc89a98af04d11796c679b9927aaf8bb62c0cb75/libgrust%2Flibproc_macro%2Ftokentree.cc", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libgrust%2Flibproc_macro%2Ftokentree.cc?ref=dc89a98af04d11796c679b9927aaf8bb62c0cb75", "patch": "@@ -56,4 +56,23 @@ TokenTree::make_tokentree (Literal::Literal literal)\n   return {LITERAL, payload};\n }\n \n+void\n+TokenTree::drop (TokenTree *tt)\n+{\n+  switch (tt->tag)\n+    {\n+    case GROUP:\n+      Group::Group::drop (&tt->payload.group);\n+      break;\n+    case IDENT:\n+      Ident::Ident::drop (&tt->payload.ident);\n+      break;\n+    case LITERAL:\n+      Literal::Literal::drop (&tt->payload.literal);\n+      break;\n+    case PUNCT:\n+      break;\n+    }\n+}\n+\n } // namespace TokenTree"}, {"sha": "86fc5eb2688653be50674bc629c9c52c798ce42b", "filename": "libgrust/libproc_macro/tokentree.h", "status": "modified", "additions": 2, "deletions": 0, "changes": 2, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/dc89a98af04d11796c679b9927aaf8bb62c0cb75/libgrust%2Flibproc_macro%2Ftokentree.h", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/dc89a98af04d11796c679b9927aaf8bb62c0cb75/libgrust%2Flibproc_macro%2Ftokentree.h", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libgrust%2Flibproc_macro%2Ftokentree.h?ref=dc89a98af04d11796c679b9927aaf8bb62c0cb75", "patch": "@@ -56,6 +56,8 @@ struct TokenTree\n   static TokenTree make_tokentree (Ident::Ident ident);\n   static TokenTree make_tokentree (Punct::Punct punct);\n   static TokenTree make_tokentree (Literal::Literal literal);\n+\n+  static void drop (TokenTree *tt);\n };\n \n } // namespace TokenTree"}]}