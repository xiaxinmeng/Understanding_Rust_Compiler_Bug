{"sha": "2298ade7e57440cf008e0f7a2114fe37019bc2b0", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6MjI5OGFkZTdlNTc0NDBjZjAwOGUwZjdhMjExNGZlMzcwMTliYzJiMA==", "commit": {"author": {"name": "Dmitry Melnik", "email": "dm@ispras.ru", "date": "2010-10-20T12:26:10Z"}, "committer": {"name": "Alexander Monakov", "email": "amonakov@gcc.gnu.org", "date": "2010-10-20T12:26:10Z"}, "message": "fold-const.c (fold_binary_loc): New transformation.\n\n2010-10-20  Dmitry Melnik  <dm@ispras.ru>\n\ngcc/\n\t* fold-const.c (fold_binary_loc): New transformation.\n\ngcc/testsuite/\n\t* gcc.dg/20101013-1.c: New test.\n\nFrom-SVN: r165720", "tree": {"sha": "9d0beb425c9bd94cb8a4f5097dae4576793c8da4", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/9d0beb425c9bd94cb8a4f5097dae4576793c8da4"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/2298ade7e57440cf008e0f7a2114fe37019bc2b0", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/2298ade7e57440cf008e0f7a2114fe37019bc2b0", "html_url": "https://github.com/Rust-GCC/gccrs/commit/2298ade7e57440cf008e0f7a2114fe37019bc2b0", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/2298ade7e57440cf008e0f7a2114fe37019bc2b0/comments", "author": null, "committer": null, "parents": [{"sha": "b9121f42a1086a219ab6312b76e920639a0de260", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/b9121f42a1086a219ab6312b76e920639a0de260", "html_url": "https://github.com/Rust-GCC/gccrs/commit/b9121f42a1086a219ab6312b76e920639a0de260"}], "stats": {"total": 44, "additions": 44, "deletions": 0}, "files": [{"sha": "3db8d6e344616b55302f2f02e68a6fba3f0b60a4", "filename": "gcc/ChangeLog", "status": "modified", "additions": 4, "deletions": 0, "changes": 4, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/2298ade7e57440cf008e0f7a2114fe37019bc2b0/gcc%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/2298ade7e57440cf008e0f7a2114fe37019bc2b0/gcc%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2FChangeLog?ref=2298ade7e57440cf008e0f7a2114fe37019bc2b0", "patch": "@@ -1,3 +1,7 @@\n+2010-10-20  Dmitry Melnik  <dm@ispras.ru>\n+\n+\t* fold-const.c (fold_binary_loc): New transformation.\n+\n 2010-10-20  H.J. Lu  <hongjiu.lu@intel.com>\n \n \tPR target/46085"}, {"sha": "decb0fba8f51858d7ae71765988fb2199dd39a01", "filename": "gcc/fold-const.c", "status": "modified", "additions": 25, "deletions": 0, "changes": 25, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/2298ade7e57440cf008e0f7a2114fe37019bc2b0/gcc%2Ffold-const.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/2298ade7e57440cf008e0f7a2114fe37019bc2b0/gcc%2Ffold-const.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ffold-const.c?ref=2298ade7e57440cf008e0f7a2114fe37019bc2b0", "patch": "@@ -11599,6 +11599,31 @@ fold_binary_loc (location_t loc,\n       return NULL_TREE;\n \n     case TRUNC_DIV_EXPR:\n+      /* Optimize (X & (-A)) / A where A is a power of 2,\n+\t to X >> log2(A) */\n+      if (TREE_CODE (arg0) == BIT_AND_EXPR\n+\t  && !TYPE_UNSIGNED (type) && TREE_CODE (arg1) == INTEGER_CST\n+\t  && integer_pow2p (arg1) && tree_int_cst_sgn (arg1) > 0)\n+\t{\n+\t  tree sum = fold_binary_loc (loc, PLUS_EXPR, TREE_TYPE (arg1),\n+\t\t\t\t      arg1, TREE_OPERAND (arg0, 1));\n+\t  if (sum && integer_zerop (sum)) {\n+\t    unsigned long pow2;\n+\n+\t    if (TREE_INT_CST_LOW (arg1))\n+\t      pow2 = exact_log2 (TREE_INT_CST_LOW (arg1));\n+\t    else\n+\t      pow2 = exact_log2 (TREE_INT_CST_HIGH (arg1))\n+\t\t      + HOST_BITS_PER_WIDE_INT;\n+\n+\t    return fold_build2_loc (loc, RSHIFT_EXPR, type,\n+\t\t\t  TREE_OPERAND (arg0, 0),\n+\t\t\t  build_int_cst (NULL_TREE, pow2));\n+\t  }\n+\t}\n+\n+      /* Fall thru */\n+      \n     case FLOOR_DIV_EXPR:\n       /* Simplify A / (B << N) where A and B are positive and B is\n \t a power of 2, to A >> (N + log2(B)).  */"}, {"sha": "f69e743ac40d91a6cf54ac8edd8e0516e06b68c8", "filename": "gcc/testsuite/ChangeLog", "status": "modified", "additions": 4, "deletions": 0, "changes": 4, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/2298ade7e57440cf008e0f7a2114fe37019bc2b0/gcc%2Ftestsuite%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/2298ade7e57440cf008e0f7a2114fe37019bc2b0/gcc%2Ftestsuite%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2FChangeLog?ref=2298ade7e57440cf008e0f7a2114fe37019bc2b0", "patch": "@@ -1,3 +1,7 @@\n+2010-10-20  Dmitry Melnik  <dm@ispras.ru>\n+\n+\t* gcc.dg/20101013-1.c: New test.\n+\n 2010-10-20  H.J. Lu  <hongjiu.lu@intel.com>\n \n \tPR target/46085"}, {"sha": "b5bd3a7ce65564bff12bd4d01d8ff0b0d7a4cb9a", "filename": "gcc/testsuite/gcc.dg/20101013-1.c", "status": "added", "additions": 11, "deletions": 0, "changes": 11, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/2298ade7e57440cf008e0f7a2114fe37019bc2b0/gcc%2Ftestsuite%2Fgcc.dg%2F20101013-1.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/2298ade7e57440cf008e0f7a2114fe37019bc2b0/gcc%2Ftestsuite%2Fgcc.dg%2F20101013-1.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgcc.dg%2F20101013-1.c?ref=2298ade7e57440cf008e0f7a2114fe37019bc2b0", "patch": "@@ -0,0 +1,11 @@\n+/* { dg-do compile } */\n+/* { dg-options \"-O2 -fdump-tree-optimized\" } */\n+\n+int foo(int a)\n+{\n+  int x = (a & (~15)) / 16;\n+  return x;\n+}\n+\n+/* { dg-final { scan-tree-dump \">>\" \"optimized\" } } */\n+/* { dg-final { cleanup-tree-dump \"optimized\" } } */"}]}