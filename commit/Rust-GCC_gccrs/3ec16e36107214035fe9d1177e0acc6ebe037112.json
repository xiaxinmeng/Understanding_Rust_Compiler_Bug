{"sha": "3ec16e36107214035fe9d1177e0acc6ebe037112", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6M2VjMTZlMzYxMDcyMTQwMzVmZTlkMTE3N2UwYWNjNmViZTAzNzExMg==", "commit": {"author": {"name": "Alexandre Oliva", "email": "aoliva@redhat.com", "date": "2018-03-23T01:19:01Z"}, "committer": {"name": "Alexandre Oliva", "email": "aoliva@gcc.gnu.org", "date": "2018-03-23T01:19:01Z"}, "message": "[PR c++/84729] reject parenthesized array init\n\nA parenthesized initializer was only accepted when new()ing an array in\npermissive mode.  We were not careful, however, to convert the\nTREE_LIST initializer to the array element type in this extension.\n\nInstead of fixing it, converting the initializer to the base type\nafter turning the TREE_LIST initializer to a compound_expr, we disable\nthis deprecated extension.\n\n\nfor  gcc/cp/ChangeLog\n\n\tPR c++/84729\n\t* init.c (build_vec_init): Error at parenthesized array init.\n\nfor  gcc/testsuite/ChangeLog\n\n\tPR c++/84729\n\t* g++.dg/pr84729.C: New.\n        * g++.old-deja/g++.ext/arrnew2.C: Require error.\n\t* g++.old-deja/g++.robertl/eb58.C: Likewise.\n\t* g++.old-deja/g++.robertl/eb63.C: Likewise.\n\nFrom-SVN: r258791", "tree": {"sha": "5507925d2db5beeb704eaedf8a5f95a25504d3b0", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/5507925d2db5beeb704eaedf8a5f95a25504d3b0"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/3ec16e36107214035fe9d1177e0acc6ebe037112", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/3ec16e36107214035fe9d1177e0acc6ebe037112", "html_url": "https://github.com/Rust-GCC/gccrs/commit/3ec16e36107214035fe9d1177e0acc6ebe037112", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/3ec16e36107214035fe9d1177e0acc6ebe037112/comments", "author": null, "committer": null, "parents": [{"sha": "91f9108f1bd90c307daadfb4876258ec57cb746b", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/91f9108f1bd90c307daadfb4876258ec57cb746b", "html_url": "https://github.com/Rust-GCC/gccrs/commit/91f9108f1bd90c307daadfb4876258ec57cb746b"}], "stats": {"total": 37, "additions": 26, "deletions": 11}, "files": [{"sha": "33add697a8648b8756006971f3f5499e1981ab73", "filename": "gcc/cp/ChangeLog", "status": "modified", "additions": 3, "deletions": 0, "changes": 3, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/3ec16e36107214035fe9d1177e0acc6ebe037112/gcc%2Fcp%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/3ec16e36107214035fe9d1177e0acc6ebe037112/gcc%2Fcp%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fcp%2FChangeLog?ref=3ec16e36107214035fe9d1177e0acc6ebe037112", "patch": "@@ -1,5 +1,8 @@\n 2018-03-22  Alexandre Oliva <aoliva@redhat.com>\n \n+\tPR c++/84729\n+\t* init.c (build_vec_init): Error at parenthesized array init.\n+\n \tPR c++/84610\n \tPR c++/84642\n \tPR c++/84942"}, {"sha": "ff52c42c1ad85f7446cd77be876d64c0aeb86c17", "filename": "gcc/cp/init.c", "status": "modified", "additions": 2, "deletions": 5, "changes": 7, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/3ec16e36107214035fe9d1177e0acc6ebe037112/gcc%2Fcp%2Finit.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/3ec16e36107214035fe9d1177e0acc6ebe037112/gcc%2Fcp%2Finit.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fcp%2Finit.c?ref=3ec16e36107214035fe9d1177e0acc6ebe037112", "patch": "@@ -3370,11 +3370,8 @@ build_new_1 (vec<tree, va_gc> **placement, tree type, tree nelts,\n \t  else if (*init)\n             {\n               if (complain & tf_error)\n-                permerror (input_location,\n-\t\t\t   \"parenthesized initializer in array new\");\n-              else\n-                return error_mark_node;\n-\t      vecinit = build_tree_list_vec (*init);\n+                error (\"parenthesized initializer in array new\");\n+\t      return error_mark_node;\n             }\n \t  init_expr\n \t    = build_vec_init (data_addr,"}, {"sha": "07951d99ba9f658426c1c1d04c4993838c766bc7", "filename": "gcc/testsuite/ChangeLog", "status": "modified", "additions": 8, "deletions": 0, "changes": 8, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/3ec16e36107214035fe9d1177e0acc6ebe037112/gcc%2Ftestsuite%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/3ec16e36107214035fe9d1177e0acc6ebe037112/gcc%2Ftestsuite%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2FChangeLog?ref=3ec16e36107214035fe9d1177e0acc6ebe037112", "patch": "@@ -1,3 +1,11 @@\n+2018-03-22  Alexandre Oliva <aoliva@redhat.com>\n+\n+\tPR c++/84729\n+\t* g++.dg/pr84729.C: New.\n+\t* g++.old-deja/g++.ext/arrnew2.C: Require error.\n+\t* g++.old-deja/g++.robertl/eb58.C: Likewise.\n+\t* g++.old-deja/g++.robertl/eb63.C: Likewise.\n+\n 2018-03-22  Steven G. Kargl  <kargl@gcc.gnu.org\n \n \tPR fortran/84922"}, {"sha": "e5d689e0460c813e9b5bc0f8eec0e7442e10d79f", "filename": "gcc/testsuite/g++.dg/pr84729.C", "status": "added", "additions": 7, "deletions": 0, "changes": 7, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/3ec16e36107214035fe9d1177e0acc6ebe037112/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Fpr84729.C", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/3ec16e36107214035fe9d1177e0acc6ebe037112/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Fpr84729.C", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Fpr84729.C?ref=3ec16e36107214035fe9d1177e0acc6ebe037112", "patch": "@@ -0,0 +1,7 @@\n+// { dg-do compile }\n+// { dg-options \"-fpermissive\" }\n+\n+typedef int b[2];\n+void a() {\n+  new b(a); // { dg-error \"parenthesized initializer in array new\" }\n+}"}, {"sha": "aff6b9c7c63b4e1e19e57d000635e34ec1c70a98", "filename": "gcc/testsuite/g++.old-deja/g++.ext/arrnew2.C", "status": "modified", "additions": 2, "deletions": 2, "changes": 4, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/3ec16e36107214035fe9d1177e0acc6ebe037112/gcc%2Ftestsuite%2Fg%2B%2B.old-deja%2Fg%2B%2B.ext%2Farrnew2.C", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/3ec16e36107214035fe9d1177e0acc6ebe037112/gcc%2Ftestsuite%2Fg%2B%2B.old-deja%2Fg%2B%2B.ext%2Farrnew2.C", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fg%2B%2B.old-deja%2Fg%2B%2B.ext%2Farrnew2.C?ref=3ec16e36107214035fe9d1177e0acc6ebe037112", "patch": "@@ -1,7 +1,7 @@\n-// { dg-do run }\n+// { dg-do compile }\n // { dg-options \"-w -fpermissive\" }\n \n-int *foo = new int[1](42); // { dg-bogus \"\" }\n+int *foo = new int[1](42); // { dg-error \"parenthesized\" }\n int main ()\n {\n   return foo[0] != 42;"}, {"sha": "d702296bdc7810ef3b7e76e53364b83640783540", "filename": "gcc/testsuite/g++.old-deja/g++.robertl/eb58.C", "status": "modified", "additions": 2, "deletions": 2, "changes": 4, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/3ec16e36107214035fe9d1177e0acc6ebe037112/gcc%2Ftestsuite%2Fg%2B%2B.old-deja%2Fg%2B%2B.robertl%2Feb58.C", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/3ec16e36107214035fe9d1177e0acc6ebe037112/gcc%2Ftestsuite%2Fg%2B%2B.old-deja%2Fg%2B%2B.robertl%2Feb58.C", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fg%2B%2B.old-deja%2Fg%2B%2B.robertl%2Feb58.C?ref=3ec16e36107214035fe9d1177e0acc6ebe037112", "patch": "@@ -1,4 +1,4 @@\n-// { dg-do run  }\n+// { dg-do compile  }\n // { dg-options \"-w -fpermissive\" }\n // Test for g++ array init extension \n \n@@ -11,5 +11,5 @@ private:\n \n main()\n {\n-  A *list = new A[10](4);\n+  A *list = new A[10](4); // { dg-error \"parenthesized\" }\n }"}, {"sha": "653351b8dfad9297e5489d29fd90617caa080fa7", "filename": "gcc/testsuite/g++.old-deja/g++.robertl/eb63.C", "status": "modified", "additions": 2, "deletions": 2, "changes": 4, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/3ec16e36107214035fe9d1177e0acc6ebe037112/gcc%2Ftestsuite%2Fg%2B%2B.old-deja%2Fg%2B%2B.robertl%2Feb63.C", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/3ec16e36107214035fe9d1177e0acc6ebe037112/gcc%2Ftestsuite%2Fg%2B%2B.old-deja%2Fg%2B%2B.robertl%2Feb63.C", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fg%2B%2B.old-deja%2Fg%2B%2B.robertl%2Feb63.C?ref=3ec16e36107214035fe9d1177e0acc6ebe037112", "patch": "@@ -1,4 +1,4 @@\n-// { dg-do run  }\n+// { dg-do compile  }\n // { dg-options \"-w -fpermissive\" }\n //This uses GNU extensions, so disable -ansi\n #include <stdio.h>\n@@ -13,5 +13,5 @@ public:\n main() {\n         A* a;\n \n-        a = new A[2](1,false);\n+        a = new A[2](1,false); // { dg-error \"parenthesized\" }\n }"}]}