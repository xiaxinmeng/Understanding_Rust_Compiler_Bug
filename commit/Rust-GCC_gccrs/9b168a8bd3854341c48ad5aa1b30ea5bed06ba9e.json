{"sha": "9b168a8bd3854341c48ad5aa1b30ea5bed06ba9e", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6OWIxNjhhOGJkMzg1NDM0MWM0OGFkNWFhMWIzMGVhNWJlZDA2YmE5ZQ==", "commit": {"author": {"name": "Arnaud Charlet", "email": "charlet@gcc.gnu.org", "date": "2012-06-12T11:02:08Z"}, "committer": {"name": "Arnaud Charlet", "email": "charlet@gcc.gnu.org", "date": "2012-06-12T11:02:08Z"}, "message": "[multiple changes]\n\n2012-06-12  Hristian Kirtchev  <kirtchev@adacore.com>\n\n\t* exp_ch7.adb (Process_Transient_Objects): Renamed constant\n\tRequires_Hooking to Must_Hook and replace all occurrences of the name.\n\t(Requires_Hooking): New routine. Detect all contexts that require\n\ttransient variable export to the outer finalizer due to a potential\n\texception.\n\n2012-06-12  Eric Botcazou  <ebotcazou@adacore.com>\n\n\t* einfo.ads: Minor correction in comment.\n\nFrom-SVN: r188444", "tree": {"sha": "46f25fc3cb83485c5cec509ad4598cfbb0b5bd8d", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/46f25fc3cb83485c5cec509ad4598cfbb0b5bd8d"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/9b168a8bd3854341c48ad5aa1b30ea5bed06ba9e", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/9b168a8bd3854341c48ad5aa1b30ea5bed06ba9e", "html_url": "https://github.com/Rust-GCC/gccrs/commit/9b168a8bd3854341c48ad5aa1b30ea5bed06ba9e", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/9b168a8bd3854341c48ad5aa1b30ea5bed06ba9e/comments", "author": null, "committer": null, "parents": [{"sha": "7c4d75bfb59458d913c10a3b561b72f85c53dc71", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/7c4d75bfb59458d913c10a3b561b72f85c53dc71", "html_url": "https://github.com/Rust-GCC/gccrs/commit/7c4d75bfb59458d913c10a3b561b72f85c53dc71"}], "stats": {"total": 57, "additions": 51, "deletions": 6}, "files": [{"sha": "d1494f6ef50e713d855a1eb5b8eb85c28e9f22cb", "filename": "gcc/ada/ChangeLog", "status": "modified", "additions": 8, "deletions": 0, "changes": 8, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/9b168a8bd3854341c48ad5aa1b30ea5bed06ba9e/gcc%2Fada%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/9b168a8bd3854341c48ad5aa1b30ea5bed06ba9e/gcc%2Fada%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fada%2FChangeLog?ref=9b168a8bd3854341c48ad5aa1b30ea5bed06ba9e", "patch": "@@ -1,3 +1,11 @@\n+2012-06-12  Hristian Kirtchev  <kirtchev@adacore.com>\n+\n+\t* exp_ch7.adb (Process_Transient_Objects): Renamed constant\n+\tRequires_Hooking to Must_Hook and replace all occurrences of the name.\n+\t(Requires_Hooking): New routine. Detect all contexts that require\n+\ttransient variable export to the outer finalizer due to a potential\n+\texception.\n+\n 2012-06-12  Ed Schonberg  <schonberg@adacore.com>\n \n \t* sem_ch12.adb: Small adjustment."}, {"sha": "c69857a8bdd59e18b5ed3911a2f10caeea0f26e1", "filename": "gcc/ada/einfo.ads", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/9b168a8bd3854341c48ad5aa1b30ea5bed06ba9e/gcc%2Fada%2Feinfo.ads", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/9b168a8bd3854341c48ad5aa1b30ea5bed06ba9e/gcc%2Fada%2Feinfo.ads", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fada%2Feinfo.ads?ref=9b168a8bd3854341c48ad5aa1b30ea5bed06ba9e", "patch": "@@ -2671,7 +2671,7 @@ package Einfo is\n --       appropriate external name for use by the linker.\n \n --    Is_Protected_Record_Type (synthesized)\n---       Applies to all entities, true if Is_Concurrent_Record_Type\n+--       Applies to all entities, true if Is_Concurrent_Record_Type is true and\n --       Corresponding_Concurrent_Type is a protected type.\n \n --    Is_Pure (Flag44)"}, {"sha": "e9daade23adab1e3fedf13e9ca784fd712b61fef", "filename": "gcc/ada/exp_ch7.adb", "status": "modified", "additions": 42, "deletions": 5, "changes": 47, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/9b168a8bd3854341c48ad5aa1b30ea5bed06ba9e/gcc%2Fada%2Fexp_ch7.adb", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/9b168a8bd3854341c48ad5aa1b30ea5bed06ba9e/gcc%2Fada%2Fexp_ch7.adb", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fada%2Fexp_ch7.adb?ref=9b168a8bd3854341c48ad5aa1b30ea5bed06ba9e", "patch": "@@ -4327,10 +4327,47 @@ package body Exp_Ch7 is\n          Last_Object  : Node_Id;\n          Related_Node : Node_Id)\n       is\n-         Requires_Hooking : constant Boolean :=\n-                              Nkind_In (N, N_Function_Call,\n-                                           N_Procedure_Call_Statement);\n+         function Requires_Hooking return Boolean;\n+         --  Determine whether the context requires transient variable export\n+         --  to the outer finalizer. This scenario arises when the context may\n+         --  raise an exception.\n \n+         ----------------------\n+         -- Requires_Hooking --\n+         ----------------------\n+\n+         function Requires_Hooking return Boolean is\n+            function Is_Subprogram_Call (Nod : Node_Id) return Boolean;\n+            --  Determine whether a particular node is a procedure of function\n+            --  call.\n+\n+            ------------------------\n+            -- Is_Subprogram_Call --\n+            ------------------------\n+\n+            function Is_Subprogram_Call (Nod : Node_Id) return Boolean is\n+            begin\n+               return\n+                 Nkind_In (Nod, N_Function_Call, N_Procedure_Call_Statement);\n+            end Is_Subprogram_Call;\n+\n+         --  Start of processing for Requires_Hooking\n+\n+         begin\n+            --  The context is either a procedure or function call or an object\n+            --  declaration initialized by such a call. In all these cases, the\n+            --  calls are assumed to raise an exception.\n+\n+            return\n+              Is_Subprogram_Call (N)\n+                or else\n+                  (Nkind (N) = N_Object_Declaration\n+                     and then Is_Subprogram_Call (Expression (N)));\n+         end Requires_Hooking;\n+\n+         --  Local variables\n+\n+         Must_Hook : constant Boolean := Requires_Hooking;\n          Built     : Boolean := False;\n          Desig_Typ : Entity_Id;\n          Fin_Block : Node_Id;\n@@ -4395,7 +4432,7 @@ package body Exp_Ch7 is\n                --  enclosing sequence of statements where their corresponding\n                --  \"hooks\" are picked up by the finalization machinery.\n \n-               if Requires_Hooking then\n+               if Must_Hook then\n                   declare\n                      Expr   : Node_Id;\n                      Ptr_Id : Entity_Id;\n@@ -4470,7 +4507,7 @@ package body Exp_Ch7 is\n                --  Generate:\n                --    Temp := null;\n \n-               if Requires_Hooking then\n+               if Must_Hook then\n                   Append_To (Stmts,\n                     Make_Assignment_Statement (Loc,\n                       Name       => New_Reference_To (Temp_Id, Loc),"}]}