{"sha": "f434eb6997a825387bc5c068b0bd812c04c8e0d8", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6ZjQzNGViNjk5N2E4MjUzODdiYzVjMDY4YjBiZDgxMmMwNGM4ZTBkOA==", "commit": {"author": {"name": "Marat Zakirov", "email": "m.zakirov@samsung.com", "date": "2014-09-19T08:29:04Z"}, "committer": {"name": "Marat Zakirov", "email": "mzakirov@gcc.gnu.org", "date": "2014-09-19T08:29:04Z"}, "message": "asan.c (build_check_stmt): Alignment arg was added.\n\ngcc/ChangeLog:\n\n2014-09-19  Marat Zakirov  <m.zakirov@samsung.com>\n\n\t* asan.c (build_check_stmt): Alignment arg was added.\n\t(asan_expand_check_ifn): Optimization for alignment >= 8.\n\ngcc/testsuite/ChangeLog:\n\n2014-09-19  Marat Zakirov  <m.zakirov@samsung.com>\n\n\t* c-c++-common/asan/red-align-1.c: New test.\n\t* c-c++-common/asan/red-align-2.c: New test.\n\nFrom-SVN: r215380", "tree": {"sha": "0249efe52d96dad3408dbcabee61c3678d0c668d", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/0249efe52d96dad3408dbcabee61c3678d0c668d"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/f434eb6997a825387bc5c068b0bd812c04c8e0d8", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/f434eb6997a825387bc5c068b0bd812c04c8e0d8", "html_url": "https://github.com/Rust-GCC/gccrs/commit/f434eb6997a825387bc5c068b0bd812c04c8e0d8", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/f434eb6997a825387bc5c068b0bd812c04c8e0d8/comments", "author": null, "committer": null, "parents": [{"sha": "4ce351defb1341067c91b0a3f1c204e791fba71d", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/4ce351defb1341067c91b0a3f1c204e791fba71d", "html_url": "https://github.com/Rust-GCC/gccrs/commit/4ce351defb1341067c91b0a3f1c204e791fba71d"}], "stats": {"total": 64, "additions": 60, "deletions": 4}, "files": [{"sha": "ecfb1a66b408efbc1cd11c36612fab4a1db5a190", "filename": "gcc/ChangeLog", "status": "modified", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/f434eb6997a825387bc5c068b0bd812c04c8e0d8/gcc%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/f434eb6997a825387bc5c068b0bd812c04c8e0d8/gcc%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2FChangeLog?ref=f434eb6997a825387bc5c068b0bd812c04c8e0d8", "patch": "@@ -1,3 +1,8 @@\n+2014-09-19  Marat Zakirov  <m.zakirov@samsung.com>\n+\n+\t* asan.c (build_check_stmt): Alignment arg was added.\n+\t(asan_expand_check_ifn): Optimization for alignment >= 8.\n+\n 2014-09-19  Olivier Hainque  <hainque@adacore.com>\n \n \t* config/i386/vxworksae.h: Remove obsolete definitions."}, {"sha": "2a90d863d072c61e0ff5f32f9f738bd49bbdfd70", "filename": "gcc/asan.c", "status": "modified", "additions": 9, "deletions": 3, "changes": 12, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/f434eb6997a825387bc5c068b0bd812c04c8e0d8/gcc%2Fasan.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/f434eb6997a825387bc5c068b0bd812c04c8e0d8/gcc%2Fasan.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fasan.c?ref=f434eb6997a825387bc5c068b0bd812c04c8e0d8", "patch": "@@ -1667,9 +1667,11 @@ build_check_stmt (location_t loc, tree base, tree len,\n   if (end_instrumented)\n     flags |= ASAN_CHECK_END_INSTRUMENTED;\n \n-  g = gimple_build_call_internal (IFN_ASAN_CHECK, 3,\n+  g = gimple_build_call_internal (IFN_ASAN_CHECK, 4,\n \t\t\t\t  build_int_cst (integer_type_node, flags),\n-\t\t\t\t  base, len);\n+\t\t\t\t  base, len,\n+\t\t\t\t  build_int_cst (integer_type_node,\n+\t\t\t\t\t\t align / BITS_PER_UNIT));\n   gimple_set_location (g, loc);\n   if (before_p)\n     gsi_insert_before (&gsi, g, GSI_SAME_STMT);\n@@ -2466,6 +2468,7 @@ asan_expand_check_ifn (gimple_stmt_iterator *iter, bool use_calls)\n \n   tree base = gimple_call_arg (g, 1);\n   tree len = gimple_call_arg (g, 2);\n+  HOST_WIDE_INT align = tree_to_shwi (gimple_call_arg (g, 3));\n \n   HOST_WIDE_INT size_in_bytes\n     = is_scalar_access && tree_fits_shwi_p (len) ? tree_to_shwi (len) : -1;\n@@ -2576,7 +2579,10 @@ asan_expand_check_ifn (gimple_stmt_iterator *iter, bool use_calls)\n \t  gimple shadow_test = build_assign (NE_EXPR, shadow, 0);\n \t  gimple_seq seq = NULL;\n \t  gimple_seq_add_stmt (&seq, shadow_test);\n-\t  gimple_seq_add_stmt (&seq, build_assign (BIT_AND_EXPR, base_addr, 7));\n+\t  /* Aligned (>= 8 bytes) access do not need & 7.  */\n+\t  if (align < 8)\n+\t    gimple_seq_add_stmt (&seq, build_assign (BIT_AND_EXPR,\n+\t\t\t\t\t\t     base_addr, 7));\n \t  gimple_seq_add_stmt (&seq, build_type_cast (shadow_type,\n \t\t\t\t\t\t      gimple_seq_last (seq)));\n \t  if (real_size_in_bytes > 1)"}, {"sha": "54ade9f1cb53c45230fe10615112c5d27743f506", "filename": "gcc/internal-fn.def", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/f434eb6997a825387bc5c068b0bd812c04c8e0d8/gcc%2Finternal-fn.def", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/f434eb6997a825387bc5c068b0bd812c04c8e0d8/gcc%2Finternal-fn.def", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Finternal-fn.def?ref=f434eb6997a825387bc5c068b0bd812c04c8e0d8", "patch": "@@ -55,4 +55,4 @@ DEF_INTERNAL_FN (UBSAN_CHECK_SUB, ECF_CONST | ECF_LEAF | ECF_NOTHROW, NULL)\n DEF_INTERNAL_FN (UBSAN_CHECK_MUL, ECF_CONST | ECF_LEAF | ECF_NOTHROW, NULL)\n DEF_INTERNAL_FN (ABNORMAL_DISPATCHER, ECF_NORETURN, NULL)\n DEF_INTERNAL_FN (BUILTIN_EXPECT, ECF_CONST | ECF_LEAF | ECF_NOTHROW, NULL)\n-DEF_INTERNAL_FN (ASAN_CHECK, ECF_TM_PURE | ECF_LEAF | ECF_NOTHROW, \".W..\")\n+DEF_INTERNAL_FN (ASAN_CHECK, ECF_TM_PURE | ECF_LEAF | ECF_NOTHROW, \".W...\")"}, {"sha": "083c78bf30a7e843ebc42504d2458b12301a879e", "filename": "gcc/testsuite/ChangeLog", "status": "modified", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/f434eb6997a825387bc5c068b0bd812c04c8e0d8/gcc%2Ftestsuite%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/f434eb6997a825387bc5c068b0bd812c04c8e0d8/gcc%2Ftestsuite%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2FChangeLog?ref=f434eb6997a825387bc5c068b0bd812c04c8e0d8", "patch": "@@ -1,3 +1,8 @@\n+2014-09-19  Marat Zakirov  <m.zakirov@samsung.com>\n+\n+\t* c-c++-common/asan/red-align-1.c: New test.\n+\t* c-c++-common/asan/red-align-2.c: New test.\n+\n 2014-09-18  H.J. Lu  <hongjiu.lu@intel.com>\n \n \t* gcc.dg/pr61053.c: Updated for x32."}, {"sha": "afd746772073da54206feb437fb582e72b224548", "filename": "gcc/testsuite/c-c++-common/asan/red-align-1.c", "status": "added", "additions": 20, "deletions": 0, "changes": 20, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/f434eb6997a825387bc5c068b0bd812c04c8e0d8/gcc%2Ftestsuite%2Fc-c%2B%2B-common%2Fasan%2Fred-align-1.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/f434eb6997a825387bc5c068b0bd812c04c8e0d8/gcc%2Ftestsuite%2Fc-c%2B%2B-common%2Fasan%2Fred-align-1.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fc-c%2B%2B-common%2Fasan%2Fred-align-1.c?ref=f434eb6997a825387bc5c068b0bd812c04c8e0d8", "patch": "@@ -0,0 +1,20 @@\n+/* This tests aligment propagation to structure elem and\n+   abcense of redundant & 7.  */\n+\n+/* { dg-options \"-fdump-tree-sanopt\" } */\n+/* { dg-do compile } */\n+/* { dg-skip-if \"\" { *-*-* } { \"-flto\" } { \"\" } } */\n+\n+struct st {\n+  int a;\n+  int b;\n+  int c;\n+} __attribute__((aligned(16)));\n+\n+int foo (struct st * s_p)\n+{\n+  return s_p->a;\n+}\n+\n+/* { dg-final { scan-tree-dump-times \"& 7\" 0 \"sanopt\" } } */\n+/* { dg-final { cleanup-tree-dump \"sanopt\" } } */"}, {"sha": "d30b1ad9f0c302fec90ddf14487f5f980f98089c", "filename": "gcc/testsuite/c-c++-common/asan/red-align-2.c", "status": "added", "additions": 20, "deletions": 0, "changes": 20, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/f434eb6997a825387bc5c068b0bd812c04c8e0d8/gcc%2Ftestsuite%2Fc-c%2B%2B-common%2Fasan%2Fred-align-2.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/f434eb6997a825387bc5c068b0bd812c04c8e0d8/gcc%2Ftestsuite%2Fc-c%2B%2B-common%2Fasan%2Fred-align-2.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fc-c%2B%2B-common%2Fasan%2Fred-align-2.c?ref=f434eb6997a825387bc5c068b0bd812c04c8e0d8", "patch": "@@ -0,0 +1,20 @@\n+/* This tests aligment propagation to structure elem and\n+   abcense of redundant & 7.  */\n+\n+/* { dg-options \"-fdump-tree-sanopt\" } */\n+/* { dg-do compile } */\n+/* { dg-skip-if \"\" { *-*-* } { \"-flto\" } { \"\" } } */\n+\n+struct st {\n+  int a;\n+  int b;\n+  int c;\n+} __attribute__((aligned(16)));\n+\n+int foo (struct st * s_p)\n+{\n+  return s_p->b;\n+}\n+\n+/* { dg-final { scan-tree-dump-times \"& 7\" 1 \"sanopt\" } } */\n+/* { dg-final { cleanup-tree-dump \"sanopt\" } } */"}]}