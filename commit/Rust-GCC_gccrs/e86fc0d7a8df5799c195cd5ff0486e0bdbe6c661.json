{"sha": "e86fc0d7a8df5799c195cd5ff0486e0bdbe6c661", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6ZTg2ZmMwZDdhOGRmNTc5OWMxOTVjZDVmZjA0ODZlMGJkYmU2YzY2MQ==", "commit": {"author": {"name": "Iain Sandoe", "email": "iain@sandoe.co.uk", "date": "2019-10-08T19:24:22Z"}, "committer": {"name": "Iain Sandoe", "email": "iains@gcc.gnu.org", "date": "2019-10-08T19:24:22Z"}, "message": "[Darwin] Remove code deprecated in 4.x.\n\nThis removes some code that should be dead.\nGiven no reported problems from the warning since 4.6 this seems reasonable.\n\ngcc/ChangeLog:\n\n2019-10-08  Iain Sandoe  <iain@sandoe.co.uk>\n\n\t* config/darwin.c (machopic_select_section): Remove dead code for\n\told Objective-C section selection method, replace with unreachable.\n\nFrom-SVN: r276709", "tree": {"sha": "3b4e5725c3402676d5144d0ea0bd101bd595314e", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/3b4e5725c3402676d5144d0ea0bd101bd595314e"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/e86fc0d7a8df5799c195cd5ff0486e0bdbe6c661", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/e86fc0d7a8df5799c195cd5ff0486e0bdbe6c661", "html_url": "https://github.com/Rust-GCC/gccrs/commit/e86fc0d7a8df5799c195cd5ff0486e0bdbe6c661", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/e86fc0d7a8df5799c195cd5ff0486e0bdbe6c661/comments", "author": {"login": "iains", "id": 4039407, "node_id": "MDQ6VXNlcjQwMzk0MDc=", "avatar_url": "https://avatars.githubusercontent.com/u/4039407?v=4", "gravatar_id": "", "url": "https://api.github.com/users/iains", "html_url": "https://github.com/iains", "followers_url": "https://api.github.com/users/iains/followers", "following_url": "https://api.github.com/users/iains/following{/other_user}", "gists_url": "https://api.github.com/users/iains/gists{/gist_id}", "starred_url": "https://api.github.com/users/iains/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/iains/subscriptions", "organizations_url": "https://api.github.com/users/iains/orgs", "repos_url": "https://api.github.com/users/iains/repos", "events_url": "https://api.github.com/users/iains/events{/privacy}", "received_events_url": "https://api.github.com/users/iains/received_events", "type": "User", "site_admin": false}, "committer": {"login": "iains", "id": 4039407, "node_id": "MDQ6VXNlcjQwMzk0MDc=", "avatar_url": "https://avatars.githubusercontent.com/u/4039407?v=4", "gravatar_id": "", "url": "https://api.github.com/users/iains", "html_url": "https://github.com/iains", "followers_url": "https://api.github.com/users/iains/followers", "following_url": "https://api.github.com/users/iains/following{/other_user}", "gists_url": "https://api.github.com/users/iains/gists{/gist_id}", "starred_url": "https://api.github.com/users/iains/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/iains/subscriptions", "organizations_url": "https://api.github.com/users/iains/orgs", "repos_url": "https://api.github.com/users/iains/repos", "events_url": "https://api.github.com/users/iains/events{/privacy}", "received_events_url": "https://api.github.com/users/iains/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "a3fc4326ca94323e24693b907ce4352a70d4de8f", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/a3fc4326ca94323e24693b907ce4352a70d4de8f", "html_url": "https://github.com/Rust-GCC/gccrs/commit/a3fc4326ca94323e24693b907ce4352a70d4de8f"}], "stats": {"total": 82, "additions": 9, "deletions": 73}, "files": [{"sha": "f82d7f5b26db3399133a720160e9ccec376fd052", "filename": "gcc/ChangeLog", "status": "modified", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/e86fc0d7a8df5799c195cd5ff0486e0bdbe6c661/gcc%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/e86fc0d7a8df5799c195cd5ff0486e0bdbe6c661/gcc%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2FChangeLog?ref=e86fc0d7a8df5799c195cd5ff0486e0bdbe6c661", "patch": "@@ -1,3 +1,8 @@\n+2019-10-08  Iain Sandoe  <iain@sandoe.co.uk>\n+\n+\t* config/darwin.c (machopic_select_section): Remove dead code for\n+\told Objective-C section selection method, replace with unreachable.\n+\n 2019-10-08  Iain Sandoe  <iain@sandoe.co.uk>\n \n \t* config/darwin.c (machopic_indirect_data_reference): Check for"}, {"sha": "679e0c22910afdb0da8672f897e6d1d1cf146112", "filename": "gcc/config/darwin.c", "status": "modified", "additions": 4, "deletions": 73, "changes": 77, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/e86fc0d7a8df5799c195cd5ff0486e0bdbe6c661/gcc%2Fconfig%2Fdarwin.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/e86fc0d7a8df5799c195cd5ff0486e0bdbe6c661/gcc%2Fconfig%2Fdarwin.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fconfig%2Fdarwin.c?ref=e86fc0d7a8df5799c195cd5ff0486e0bdbe6c661", "patch": "@@ -1696,83 +1696,14 @@ machopic_select_section (tree decl,\n       else\n \treturn base_section;\n     }\n-  /* c) legacy meta-data selection.  */\n-  else if (TREE_CODE (decl) == VAR_DECL\n+  else if (flag_next_runtime\n+\t   && VAR_P (decl)\n \t   && DECL_NAME (decl)\n \t   && TREE_CODE (DECL_NAME (decl)) == IDENTIFIER_NODE\n \t   && IDENTIFIER_POINTER (DECL_NAME (decl))\n-\t   && flag_next_runtime\n \t   && !strncmp (IDENTIFIER_POINTER (DECL_NAME (decl)), \"_OBJC_\", 6))\n-    {\n-      const char *name = IDENTIFIER_POINTER (DECL_NAME (decl));\n-      static bool warned_objc_46 = false;\n-      /* We shall assert that zero-sized objects are an error in ObjC\n-         meta-data.  */\n-      gcc_assert (tree_to_uhwi (DECL_SIZE_UNIT (decl)) != 0);\n-\n-      /* ??? This mechanism for determining the metadata section is\n-\t broken when LTO is in use, since the frontend that generated\n-\t the data is not identified.  We will keep the capability for\n-\t the short term - in case any non-Objective-C programs are using\n-\t it to place data in specified sections.  */\n-      if (!warned_objc_46)\n-\t{\n-\t  location_t loc = DECL_SOURCE_LOCATION (decl);\n-\t  warning_at (loc, 0, \"the use of _OBJC_-prefixed variable names\"\n-\t\t      \" to select meta-data sections is deprecated at 4.6\"\n-\t\t      \" and will be removed in 4.7\");\n-\t  warned_objc_46 = true;\n-\t}\n-\n-      if (!strncmp (name, \"_OBJC_CLASS_METHODS_\", 20))\n-        return darwin_sections[objc_cls_meth_section];\n-      else if (!strncmp (name, \"_OBJC_INSTANCE_METHODS_\", 23))\n-        return darwin_sections[objc_inst_meth_section];\n-      else if (!strncmp (name, \"_OBJC_CATEGORY_CLASS_METHODS_\", 29))\n-        return darwin_sections[objc_cat_cls_meth_section];\n-      else if (!strncmp (name, \"_OBJC_CATEGORY_INSTANCE_METHODS_\", 32))\n-        return darwin_sections[objc_cat_inst_meth_section];\n-      else if (!strncmp (name, \"_OBJC_CLASS_VARIABLES_\", 22))\n-        return darwin_sections[objc_class_vars_section];\n-      else if (!strncmp (name, \"_OBJC_INSTANCE_VARIABLES_\", 25))\n-        return darwin_sections[objc_instance_vars_section];\n-      else if (!strncmp (name, \"_OBJC_CLASS_PROTOCOLS_\", 22))\n-        return darwin_sections[objc_cat_cls_meth_section];\n-      else if (!strncmp (name, \"_OBJC_CLASS_NAME_\", 17))\n-        return darwin_sections[objc_class_names_section];\n-      else if (!strncmp (name, \"_OBJC_METH_VAR_NAME_\", 20))\n-        return darwin_sections[objc_meth_var_names_section];\n-      else if (!strncmp (name, \"_OBJC_METH_VAR_TYPE_\", 20))\n-        return darwin_sections[objc_meth_var_types_section];\n-      else if (!strncmp (name, \"_OBJC_CLASS_REFERENCES\", 22))\n-        return darwin_sections[objc_cls_refs_section];\n-      else if (!strncmp (name, \"_OBJC_CLASS_\", 12))\n-        return darwin_sections[objc_class_section];\n-      else if (!strncmp (name, \"_OBJC_METACLASS_\", 16))\n-        return darwin_sections[objc_meta_class_section];\n-      else if (!strncmp (name, \"_OBJC_CATEGORY_\", 15))\n-        return darwin_sections[objc_category_section];\n-      else if (!strncmp (name, \"_OBJC_SELECTOR_REFERENCES\", 25))\n-        return darwin_sections[objc_selector_refs_section];\n-      else if (!strncmp (name, \"_OBJC_SELECTOR_FIXUP\", 20))\n-        return darwin_sections[objc_selector_fixup_section];\n-      else if (!strncmp (name, \"_OBJC_SYMBOLS\", 13))\n-        return darwin_sections[objc_symbols_section];\n-      else if (!strncmp (name, \"_OBJC_MODULES\", 13))\n-        return darwin_sections[objc_module_info_section];\n-      else if (!strncmp (name, \"_OBJC_IMAGE_INFO\", 16))\n-        return darwin_sections[objc_image_info_section];\n-      else if (!strncmp (name, \"_OBJC_PROTOCOL_INSTANCE_METHODS_\", 32))\n-        return darwin_sections[objc_cat_inst_meth_section];\n-      else if (!strncmp (name, \"_OBJC_PROTOCOL_CLASS_METHODS_\", 29))\n-        return darwin_sections[objc_cat_cls_meth_section];\n-      else if (!strncmp (name, \"_OBJC_PROTOCOL_REFS_\", 20))\n-        return darwin_sections[objc_cat_cls_meth_section];\n-      else if (!strncmp (name, \"_OBJC_PROTOCOL_\", 15))\n-        return darwin_sections[objc_protocol_section];\n-      else\n-        return base_section;\n-    }\n+    /* c) legacy meta-data selection was deprecated at 4.6, removed now.  */\n+    gcc_unreachable ();\n \n   return base_section;\n }"}]}