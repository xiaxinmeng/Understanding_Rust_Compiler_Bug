{"sha": "4d4ba374a73b226dc16af7190c688728f3e5d2c5", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6NGQ0YmEzNzRhNzNiMjI2ZGMxNmFmNzE5MGM2ODg3MjhmM2U1ZDJjNQ==", "commit": {"author": {"name": "Piotr Trojanek", "email": "trojanek@adacore.com", "date": "2020-08-26T12:20:20Z"}, "committer": {"name": "Pierre-Marie de Rodat", "email": "derodat@adacore.com", "date": "2020-10-23T08:24:41Z"}, "message": "[Ada] Sync code for external properties with SPARK RM\n\ngcc/ada/\n\n\t* sem_prag.adb (Check_External_Properties): Rewrite to match the\n\tSPARK RM description.", "tree": {"sha": "5f0402385166b88a2884786830ae69c5e04f47fd", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/5f0402385166b88a2884786830ae69c5e04f47fd"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/4d4ba374a73b226dc16af7190c688728f3e5d2c5", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/4d4ba374a73b226dc16af7190c688728f3e5d2c5", "html_url": "https://github.com/Rust-GCC/gccrs/commit/4d4ba374a73b226dc16af7190c688728f3e5d2c5", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/4d4ba374a73b226dc16af7190c688728f3e5d2c5/comments", "author": {"login": "ptroja", "id": 161602, "node_id": "MDQ6VXNlcjE2MTYwMg==", "avatar_url": "https://avatars.githubusercontent.com/u/161602?v=4", "gravatar_id": "", "url": "https://api.github.com/users/ptroja", "html_url": "https://github.com/ptroja", "followers_url": "https://api.github.com/users/ptroja/followers", "following_url": "https://api.github.com/users/ptroja/following{/other_user}", "gists_url": "https://api.github.com/users/ptroja/gists{/gist_id}", "starred_url": "https://api.github.com/users/ptroja/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/ptroja/subscriptions", "organizations_url": "https://api.github.com/users/ptroja/orgs", "repos_url": "https://api.github.com/users/ptroja/repos", "events_url": "https://api.github.com/users/ptroja/events{/privacy}", "received_events_url": "https://api.github.com/users/ptroja/received_events", "type": "User", "site_admin": false}, "committer": {"login": "pmderodat", "id": 758452, "node_id": "MDQ6VXNlcjc1ODQ1Mg==", "avatar_url": "https://avatars.githubusercontent.com/u/758452?v=4", "gravatar_id": "", "url": "https://api.github.com/users/pmderodat", "html_url": "https://github.com/pmderodat", "followers_url": "https://api.github.com/users/pmderodat/followers", "following_url": "https://api.github.com/users/pmderodat/following{/other_user}", "gists_url": "https://api.github.com/users/pmderodat/gists{/gist_id}", "starred_url": "https://api.github.com/users/pmderodat/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/pmderodat/subscriptions", "organizations_url": "https://api.github.com/users/pmderodat/orgs", "repos_url": "https://api.github.com/users/pmderodat/repos", "events_url": "https://api.github.com/users/pmderodat/events{/privacy}", "received_events_url": "https://api.github.com/users/pmderodat/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "846744902e122804242af2cb9f6c6828e887cdf9", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/846744902e122804242af2cb9f6c6828e887cdf9", "html_url": "https://github.com/Rust-GCC/gccrs/commit/846744902e122804242af2cb9f6c6828e887cdf9"}], "stats": {"total": 64, "additions": 29, "deletions": 35}, "files": [{"sha": "3c9c748f9afed6380528aa5422c074ad153befae", "filename": "gcc/ada/sem_prag.adb", "status": "modified", "additions": 29, "deletions": 35, "changes": 64, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/4d4ba374a73b226dc16af7190c688728f3e5d2c5/gcc%2Fada%2Fsem_prag.adb", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/4d4ba374a73b226dc16af7190c688728f3e5d2c5/gcc%2Fada%2Fsem_prag.adb", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fada%2Fsem_prag.adb?ref=4d4ba374a73b226dc16af7190c688728f3e5d2c5", "patch": "@@ -29600,44 +29600,38 @@ package body Sem_Prag is\n       ER   : Boolean;\n       EW   : Boolean)\n    is\n-   begin\n-      --  All properties enabled\n-\n-      if AR and AW and ER and EW then\n-         null;\n-\n-      --  Async_Readers + Effective_Writes\n-      --  Async_Readers + Async_Writers + Effective_Writes\n-\n-      elsif AR and EW and not ER then\n-         null;\n-\n-      --  Async_Writers + Effective_Reads\n-      --  Async_Readers + Async_Writers + Effective_Reads\n-\n-      elsif AW and ER and not EW then\n-         null;\n-\n-      --  Async_Readers + Async_Writers\n-\n-      elsif AR and AW and not ER and not EW then\n-         null;\n+      type Properties is array (Positive range 1 .. 4) of Boolean;\n+      type Combinations is array (Positive range <>) of Properties;\n+      --  Arrays of Async_Readers, Async_Writers, Effective_Writes and\n+      --  Effective_Reads properties and their combinations, respectively.\n+\n+      Specified : constant Properties := (AR, AW, EW, ER);\n+      --  External properties, as given by the Item pragma\n+\n+      Allowed : constant Combinations :=\n+        (1 => (True,  False, True,  False),\n+         2 => (False, True,  False, True),\n+         3 => (True,  False, False, False),\n+         4 => (False, True,  False, False),\n+         5 => (True,  True,  True,  False),\n+         6 => (True,  True,  False, True),\n+         7 => (True,  True,  False, False),\n+         8 => (True,  True,  True,  True));\n+      --  Allowed combinations, as listed in the SPARK RM 7.1.2(6) table\n \n-      --  Async_Readers\n-\n-      elsif AR and not AW and not ER and not EW then\n-         null;\n-\n-      --  Async_Writers\n+   begin\n+      --  Check if the specified properties match any of the allowed\n+      --  combination; if not, then emit an error.\n \n-      elsif AW and not AR and not ER and not EW then\n-         null;\n+      for J in Allowed'Range loop\n+         if Specified = Allowed (J) then\n+            return;\n+         end if;\n+      end loop;\n \n-      else\n-         SPARK_Msg_N\n-           (\"illegal combination of external properties (SPARK RM 7.1.2(6))\",\n-            Item);\n-      end if;\n+      SPARK_Msg_N\n+        (\"illegal combination of external properties (SPARK RM 7.1.2(6))\",\n+         Item);\n    end Check_External_Properties;\n \n    ----------------"}]}