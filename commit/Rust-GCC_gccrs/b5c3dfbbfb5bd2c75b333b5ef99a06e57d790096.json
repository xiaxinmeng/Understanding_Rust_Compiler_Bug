{"sha": "b5c3dfbbfb5bd2c75b333b5ef99a06e57d790096", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6YjVjM2RmYmJmYjViZDJjNzViMzMzYjVlZjk5YTA2ZTU3ZDc5MDA5Ng==", "commit": {"author": {"name": "Richard Guenther", "email": "rguenther@suse.de", "date": "2009-01-27T10:42:59Z"}, "committer": {"name": "Richard Biener", "email": "rguenth@gcc.gnu.org", "date": "2009-01-27T10:42:59Z"}, "message": "re PR middle-end/38503 (warnings from -isystem headers strikes back.)\n\n2009-01-27  Richard Guenther  <rguenther@suse.de>\n\n\tPR tree-optimization/38503\n\t* cfgexpand.c (expand_gimple_basic_block): Ignore\n\tGIMPLE_CHANGE_DYNAMIC_TYPE during expansion.\n\t* tree-ssa-structalias.c (set_uids_in_ptset): Do not prune\n\tvariables that cannot have TBAA applied.\n\t(compute_points_to_sets): Do not remove GIMPLE_CHANGE_DYNAMIC_TYPE\n\tstatements.\n\n\t* g++.dg/warn/Wstrict-aliasing-bogus-placement-new.C: New testcase.\n\nFrom-SVN: r143700", "tree": {"sha": "35e4880bf75f0d631d220529700fa59d67fd7ad5", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/35e4880bf75f0d631d220529700fa59d67fd7ad5"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/b5c3dfbbfb5bd2c75b333b5ef99a06e57d790096", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/b5c3dfbbfb5bd2c75b333b5ef99a06e57d790096", "html_url": "https://github.com/Rust-GCC/gccrs/commit/b5c3dfbbfb5bd2c75b333b5ef99a06e57d790096", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/b5c3dfbbfb5bd2c75b333b5ef99a06e57d790096/comments", "author": {"login": "rguenth", "id": 2046526, "node_id": "MDQ6VXNlcjIwNDY1MjY=", "avatar_url": "https://avatars.githubusercontent.com/u/2046526?v=4", "gravatar_id": "", "url": "https://api.github.com/users/rguenth", "html_url": "https://github.com/rguenth", "followers_url": "https://api.github.com/users/rguenth/followers", "following_url": "https://api.github.com/users/rguenth/following{/other_user}", "gists_url": "https://api.github.com/users/rguenth/gists{/gist_id}", "starred_url": "https://api.github.com/users/rguenth/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/rguenth/subscriptions", "organizations_url": "https://api.github.com/users/rguenth/orgs", "repos_url": "https://api.github.com/users/rguenth/repos", "events_url": "https://api.github.com/users/rguenth/events{/privacy}", "received_events_url": "https://api.github.com/users/rguenth/received_events", "type": "User", "site_admin": false}, "committer": null, "parents": [{"sha": "576de5cb6e4c42c549138a661792e1f7efc81724", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/576de5cb6e4c42c549138a661792e1f7efc81724", "html_url": "https://github.com/Rust-GCC/gccrs/commit/576de5cb6e4c42c549138a661792e1f7efc81724"}], "stats": {"total": 64, "additions": 49, "deletions": 15}, "files": [{"sha": "39f89ecca8fb0de229c44eeebbb853aafb6bdd44", "filename": "gcc/ChangeLog", "status": "modified", "additions": 10, "deletions": 0, "changes": 10, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/b5c3dfbbfb5bd2c75b333b5ef99a06e57d790096/gcc%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/b5c3dfbbfb5bd2c75b333b5ef99a06e57d790096/gcc%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2FChangeLog?ref=b5c3dfbbfb5bd2c75b333b5ef99a06e57d790096", "patch": "@@ -1,3 +1,13 @@\n+2009-01-27  Richard Guenther  <rguenther@suse.de>\n+\n+\tPR tree-optimization/38503\n+\t* cfgexpand.c (expand_gimple_basic_block): Ignore\n+\tGIMPLE_CHANGE_DYNAMIC_TYPE during expansion.\n+\t* tree-ssa-structalias.c (set_uids_in_ptset): Do not prune\n+\tvariables that cannot have TBAA applied.\n+\t(compute_points_to_sets): Do not remove GIMPLE_CHANGE_DYNAMIC_TYPE\n+\tstatements.\n+\n 2009-01-27 Uros Bizjak <ubizjak@gmail.com>\n \n \tPR middle-end/38969"}, {"sha": "a9a52c453515e19410a4a0c542a43bafd21bd1b3", "filename": "gcc/cfgexpand.c", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/b5c3dfbbfb5bd2c75b333b5ef99a06e57d790096/gcc%2Fcfgexpand.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/b5c3dfbbfb5bd2c75b333b5ef99a06e57d790096/gcc%2Fcfgexpand.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fcfgexpand.c?ref=b5c3dfbbfb5bd2c75b333b5ef99a06e57d790096", "patch": "@@ -1970,7 +1970,7 @@ expand_gimple_basic_block (basic_block bb)\n \t\t    return new_bb;\n \t\t}\n \t    }\n-\t  else\n+\t  else if (gimple_code (stmt) != GIMPLE_CHANGE_DYNAMIC_TYPE)\n \t    {\n \t      tree stmt_tree = gimple_to_tree (stmt);\n \t      last = get_last_insn ();"}, {"sha": "1ebe5038e2731301a79d1475e6d109d12cfa66f4", "filename": "gcc/testsuite/ChangeLog", "status": "modified", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/b5c3dfbbfb5bd2c75b333b5ef99a06e57d790096/gcc%2Ftestsuite%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/b5c3dfbbfb5bd2c75b333b5ef99a06e57d790096/gcc%2Ftestsuite%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2FChangeLog?ref=b5c3dfbbfb5bd2c75b333b5ef99a06e57d790096", "patch": "@@ -1,3 +1,8 @@\n+2009-01-27  Richard Guenther  <rguenther@suse.de>\n+\n+\tPR tree-optimization/38503\n+\t* g++.dg/warn/Wstrict-aliasing-bogus-placement-new.C: New testcase.\n+\n 2009-01-27 Uros Bizjak <ubizjak@gmail.com>\n \n \tPR middle-end/38969"}, {"sha": "514957bcde2f87a63ade75b444525322932f372d", "filename": "gcc/testsuite/g++.dg/warn/Wstrict-aliasing-bogus-placement-new.C", "status": "added", "additions": 29, "deletions": 0, "changes": 29, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/b5c3dfbbfb5bd2c75b333b5ef99a06e57d790096/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Fwarn%2FWstrict-aliasing-bogus-placement-new.C", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/b5c3dfbbfb5bd2c75b333b5ef99a06e57d790096/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Fwarn%2FWstrict-aliasing-bogus-placement-new.C", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Fwarn%2FWstrict-aliasing-bogus-placement-new.C?ref=b5c3dfbbfb5bd2c75b333b5ef99a06e57d790096", "patch": "@@ -0,0 +1,29 @@\n+/* { dg-do compile } */\n+/* { dg-options \"-O2 -Wstrict-aliasing\" } */\n+\n+inline void *operator new (__SIZE_TYPE__, void *__p) throw() { return __p; }\n+\n+struct Y {\n+  Y() {}\n+  int i;\n+};\n+\n+struct X {\n+  X() {}\n+  void construct(const Y& y)\n+  {\n+    new (&m_data[0]) Y(y);\n+  }\n+  bool initialized;\n+  char m_data[sizeof (Y)];\n+};\n+\n+void bar(const X&);\n+void foo(Y& y)\n+{\n+  X x;\n+  x.construct(y);\n+  x.initialized = true;\n+  bar(x);\n+}\n+"}, {"sha": "cae478afbf3368d91fae7950416d11b97b241ef8", "filename": "gcc/tree-ssa-structalias.c", "status": "modified", "additions": 4, "deletions": 14, "changes": 18, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/b5c3dfbbfb5bd2c75b333b5ef99a06e57d790096/gcc%2Ftree-ssa-structalias.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/b5c3dfbbfb5bd2c75b333b5ef99a06e57d790096/gcc%2Ftree-ssa-structalias.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftree-ssa-structalias.c?ref=b5c3dfbbfb5bd2c75b333b5ef99a06e57d790096", "patch": "@@ -4703,7 +4703,8 @@ set_uids_in_ptset (tree ptr, bitmap into, bitmap from, bool is_derefed,\n \t     type-based pruning disabled.  */\n \t  if (vi->is_artificial_var\n \t      || !is_derefed\n-\t      || no_tbaa_pruning)\n+\t      || no_tbaa_pruning\n+\t      || vi->no_tbaa_pruning)\n \t    bitmap_set_bit (into, DECL_UID (vi->decl));\n \t  else\n \t    {\n@@ -5496,19 +5497,8 @@ compute_points_to_sets (void)\n \t    find_func_aliases (phi);\n \t}\n \n-      for (gsi = gsi_start_bb (bb); !gsi_end_p (gsi); )\n-\t{\n-\t  gimple stmt = gsi_stmt (gsi);\n-\n-\t  find_func_aliases (stmt);\n-\n-\t  /* The information in GIMPLE_CHANGE_DYNAMIC_TYPE statements\n-\t     has now been captured, and we can remove them.  */\n-\t  if (gimple_code (stmt) == GIMPLE_CHANGE_DYNAMIC_TYPE)\n-\t    gsi_remove (&gsi, true);\n-\t  else\n-\t    gsi_next (&gsi);\n-\t}\n+      for (gsi = gsi_start_bb (bb); !gsi_end_p (gsi); gsi_next (&gsi))\n+\tfind_func_aliases (gsi_stmt (gsi));\n     }\n \n "}]}