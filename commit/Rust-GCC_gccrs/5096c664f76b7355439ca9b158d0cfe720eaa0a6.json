{"sha": "5096c664f76b7355439ca9b158d0cfe720eaa0a6", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6NTA5NmM2NjRmNzZiNzM1NTQzOWNhOWIxNThkMGNmZTcyMGVhYTBhNg==", "commit": {"author": {"name": "Jason Merrill", "email": "jason@yorick.cygnus.com", "date": "1999-09-23T21:04:10Z"}, "committer": {"name": "Jason Merrill", "email": "jason@gcc.gnu.org", "date": "1999-09-23T21:04:10Z"}, "message": "lex.c: Get WCHAR_TYPE_SIZE from wchar_type_node.\n\n\t* lex.c: Get WCHAR_TYPE_SIZE from wchar_type_node.\n\t* lang-specs.h: If -fshort-wchar, override __WCHAR_TYPE__.\n\t* decl2.c (lang_f_options): Add -fshort-wchar.\n\t* cp-tree.h: Declare flag_short_wchar.\n\t* decl.c (init_decl_processing): If -fshort-wchar, use 'short unsigned\n\tint' for wchar_t.\n\nFrom-SVN: r29639", "tree": {"sha": "97859354aefd622727d4158ea6e091ae0fad0b5c", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/97859354aefd622727d4158ea6e091ae0fad0b5c"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/5096c664f76b7355439ca9b158d0cfe720eaa0a6", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/5096c664f76b7355439ca9b158d0cfe720eaa0a6", "html_url": "https://github.com/Rust-GCC/gccrs/commit/5096c664f76b7355439ca9b158d0cfe720eaa0a6", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/5096c664f76b7355439ca9b158d0cfe720eaa0a6/comments", "author": null, "committer": null, "parents": [{"sha": "12a39b12648fdd1675757518450720d16ef24793", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/12a39b12648fdd1675757518450720d16ef24793", "html_url": "https://github.com/Rust-GCC/gccrs/commit/12a39b12648fdd1675757518450720d16ef24793"}], "stats": {"total": 36, "additions": 27, "deletions": 9}, "files": [{"sha": "51f48da76f5add68bb25734e74d6759d28dd3dcd", "filename": "gcc/cp/ChangeLog", "status": "modified", "additions": 9, "deletions": 0, "changes": 9, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/5096c664f76b7355439ca9b158d0cfe720eaa0a6/gcc%2Fcp%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/5096c664f76b7355439ca9b158d0cfe720eaa0a6/gcc%2Fcp%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fcp%2FChangeLog?ref=5096c664f76b7355439ca9b158d0cfe720eaa0a6", "patch": "@@ -1,3 +1,12 @@\n+1999-09-23  Jason Merrill  <jason@yorick.cygnus.com>\n+\n+\t* lex.c: Get WCHAR_TYPE_SIZE from wchar_type_node.\n+\t* lang-specs.h: If -fshort-wchar, override __WCHAR_TYPE__.\n+\t* decl2.c (lang_f_options): Add -fshort-wchar.\n+\t* cp-tree.h: Declare flag_short_wchar.\n+\t* decl.c (init_decl_processing): If -fshort-wchar, use 'short unsigned \n+\tint' for wchar_t.\n+\n 1999-09-23  Martin v. L\ufffdwis  <loewis@informatik.hu-berlin.de>\n \n \t* ir.texi: Fix formatting errors and typos."}, {"sha": "d601543f7b32d29a5999c3ae4f85b43f10c86ef0", "filename": "gcc/cp/cp-tree.h", "status": "modified", "additions": 4, "deletions": 0, "changes": 4, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/5096c664f76b7355439ca9b158d0cfe720eaa0a6/gcc%2Fcp%2Fcp-tree.h", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/5096c664f76b7355439ca9b158d0cfe720eaa0a6/gcc%2Fcp%2Fcp-tree.h", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fcp%2Fcp-tree.h?ref=5096c664f76b7355439ca9b158d0cfe720eaa0a6", "patch": "@@ -930,6 +930,10 @@ extern int name_mangling_version;\n /* Nonzero means that guiding declarations are allowed.  */\n extern int flag_guiding_decls;\n \n+/* Nonzero if wchar_t should be `unsigned short' instead of whatever it\n+   would normally be, for use with WINE.  */\n+extern int flag_short_wchar;\n+\n /* Nonzero if squashed mangling is to be performed. \n    This uses the B and K codes to reference previously seen class types \n    and class qualifiers.       */"}, {"sha": "86c17053f3e7fee37b6b2b57c7963eca6f6fc196", "filename": "gcc/cp/decl.c", "status": "modified", "additions": 4, "deletions": 2, "changes": 6, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/5096c664f76b7355439ca9b158d0cfe720eaa0a6/gcc%2Fcp%2Fdecl.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/5096c664f76b7355439ca9b158d0cfe720eaa0a6/gcc%2Fcp%2Fdecl.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fcp%2Fdecl.c?ref=5096c664f76b7355439ca9b158d0cfe720eaa0a6", "patch": "@@ -6247,8 +6247,10 @@ init_decl_processing ()\n   TYPE_REFERENCE_TO (unknown_type_node) = unknown_type_node;\n \n   /* This is special for C++ so functions can be overloaded.  */\n-  wchar_type_node\n-    = TREE_TYPE (IDENTIFIER_GLOBAL_VALUE (get_identifier (WCHAR_TYPE)));\n+  wchar_type_node = get_identifier (flag_short_wchar\n+\t\t\t\t    ? \"short unsigned int\"\n+\t\t\t\t    : WCHAR_TYPE);\n+  wchar_type_node = TREE_TYPE (IDENTIFIER_GLOBAL_VALUE (wchar_type_node));\n   wchar_type_size = TYPE_PRECISION (wchar_type_node);\n   signed_wchar_type_node = make_signed_type (wchar_type_size);\n   unsigned_wchar_type_node = make_unsigned_type (wchar_type_size);"}, {"sha": "3b80f6825a7e2d3f7b3434640453768405f733f2", "filename": "gcc/cp/decl2.c", "status": "modified", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/5096c664f76b7355439ca9b158d0cfe720eaa0a6/gcc%2Fcp%2Fdecl2.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/5096c664f76b7355439ca9b158d0cfe720eaa0a6/gcc%2Fcp%2Fdecl2.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fcp%2Fdecl2.c?ref=5096c664f76b7355439ca9b158d0cfe720eaa0a6", "patch": "@@ -456,6 +456,10 @@ int name_mangling_version = 2;\n /* Nonzero means that guiding declarations are allowed.  */\n int flag_guiding_decls;\n \n+/* Nonzero if wchar_t should be `unsigned short' instead of whatever it\n+   would normally be, for use with WINE.  */\n+int flag_short_wchar;\n+\n /* Nonzero if squashed mangling is to be performed. \n    This uses the B and K codes to reference previously seen class types \n    and class qualifiers.       */\n@@ -491,6 +495,7 @@ lang_f_options[] =\n   {\"unsigned-bitfields\", &flag_signed_bitfields, 0},\n   {\"short-enums\", &flag_short_enums, 1},\n   {\"short-double\", &flag_short_double, 1},\n+  {\"short-wchar\", &flag_short_wchar, 1},\n   {\"cond-mismatch\", &flag_cond_mismatch, 1},\n   {\"asm\", &flag_no_asm, 0},\n   {\"builtin\", &flag_no_builtin, 0},"}, {"sha": "692583ccc8f7beefa86c1a174a50db939afc59b0", "filename": "gcc/cp/lang-specs.h", "status": "modified", "additions": 3, "deletions": 0, "changes": 3, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/5096c664f76b7355439ca9b158d0cfe720eaa0a6/gcc%2Fcp%2Flang-specs.h", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/5096c664f76b7355439ca9b158d0cfe720eaa0a6/gcc%2Fcp%2Flang-specs.h", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fcp%2Flang-specs.h?ref=5096c664f76b7355439ca9b158d0cfe720eaa0a6", "patch": "@@ -39,6 +39,7 @@ Boston, MA 02111-1307, USA.  */\n \t%{!fno-exceptions:-D__EXCEPTIONS}\\\n         %c %{Os:-D__OPTIMIZE_SIZE__} %{O*:%{!O0:-D__OPTIMIZE__}} %{trigraphs}\\\n \t%{ffast-math:-D__FAST_MATH__}\\\n+\t%{fshort-wchar:-D__WCHAR_TYPE__=short\\\\ unsigned\\\\ int}\\\n \t%{g*} %{W*} %{w} %{pedantic*} %{H} %{d*} %C %{D*} %{U*} %{i*} %Z\\\n         %i %{E:%W{o*}}%{M:%W{o*}}%{MM:%W{o*}}\\n}\\\n       %{!E:%{!M:%{!MM:cc1plus %i %1 %2\\\n@@ -50,6 +51,7 @@ Boston, MA 02111-1307, USA.  */\n                             %{!fno-exceptions:-D__EXCEPTIONS}\\\n                             %c %{Os:-D__OPTIMIZE_SIZE__} %{O*:%{!O0:-D__OPTIMIZE__}}\\\n \t\t\t    %{ffast-math:-D__FAST_MATH__}\\\n+\t\t\t    %{fshort-wchar:-D__WCHAR_TYPE__=short\\\\ unsigned\\\\ int}\\\n                             %{trigraphs}\\\n \t\t\t    %{!Q:-quiet} -dumpbase %b.cc %{d*} %{m*} %{a}\\\n \t\t\t    %{g*} %{O*} %{W*} %{w} %{pedantic*} %{ansi}\\\n@@ -71,6 +73,7 @@ Boston, MA 02111-1307, USA.  */\n \t%{!fno-exceptions:-D__EXCEPTIONS}\\\n         %c %{Os:-D__OPTIMIZE_SIZE__} %{O*:%{!O0:-D__OPTIMIZE__}} %{trigraphs}\\\n \t%{ffast-math:-D__FAST_MATH__}\\\n+\t%{fshort-wchar:-D__WCHAR_TYPE__=short\\\\ unsigned\\\\ int}\\\n \t%{g*} %{W*} %{w} %{pedantic*} %{H} %{d*} %C %{D*} %{U*} %{i*} %Z\\\n         %i %{!M:%{!MM:%{!E:%{!pipe:%g.ii}}}}%{E:%W{o*}}%{M:%W{o*}}%{MM:%W{o*}} |\\n\",\n     \"%{!M:%{!MM:%{!E:cc1plus %{!pipe:%g.ii} %1 %2\\"}, {"sha": "c396a5031886f826df8b6c0b44c4a9f00a16b93b", "filename": "gcc/cp/lex.c", "status": "modified", "additions": 2, "deletions": 7, "changes": 9, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/5096c664f76b7355439ca9b158d0cfe720eaa0a6/gcc%2Fcp%2Flex.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/5096c664f76b7355439ca9b158d0cfe720eaa0a6/gcc%2Fcp%2Flex.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fcp%2Flex.c?ref=5096c664f76b7355439ca9b158d0cfe720eaa0a6", "patch": "@@ -348,13 +348,8 @@ int interface_unknown;\t\t/* whether or not we know this class\n \n /* lexical analyzer */\n \n-#ifndef WCHAR_TYPE_SIZE\n-#ifdef INT_TYPE_SIZE\n-#define WCHAR_TYPE_SIZE INT_TYPE_SIZE\n-#else\n-#define WCHAR_TYPE_SIZE\tBITS_PER_WORD\n-#endif\n-#endif\n+#undef WCHAR_TYPE_SIZE\n+#define WCHAR_TYPE_SIZE TYPE_PRECISION (wchar_type_node)\n \n /* Number of bytes in a wide character.  */\n #define WCHAR_BYTES (WCHAR_TYPE_SIZE / BITS_PER_UNIT)"}]}