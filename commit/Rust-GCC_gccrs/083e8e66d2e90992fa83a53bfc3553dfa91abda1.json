{"sha": "083e8e66d2e90992fa83a53bfc3553dfa91abda1", "node_id": "C_kwDOANBUbNoAKDA4M2U4ZTY2ZDJlOTA5OTJmYTgzYTUzYmZjMzU1M2RmYTkxYWJkYTE", "commit": {"author": {"name": "Jakub Jelinek", "email": "jakub@redhat.com", "date": "2022-04-11T08:41:07Z"}, "committer": {"name": "Jakub Jelinek", "email": "jakub@redhat.com", "date": "2022-04-11T08:41:07Z"}, "message": "c-family: Initialize ridpointers for __int128 etc. [PR105186]\n\nThe following testcase ICEs with C++ and is incorrectly rejected with C.\nThe reason is that both FEs use ridpointers identifiers for CPP_KEYWORD\nand value or u.value for CPP_NAME e.g. when parsing attributes or OpenMP\ndirectives etc., like:\n         /* Save away the identifier that indicates which attribute\n            this is.  */\n         identifier = (token->type == CPP_KEYWORD)\n           /* For keywords, use the canonical spelling, not the\n              parsed identifier.  */\n           ? ridpointers[(int) token->keyword]\n           : id_token->u.value;\n\n         identifier = canonicalize_attr_name (identifier);\nI've tried to change those to use ridpointers only if non-NULL and otherwise\nuse the value/u.value even for CPP_KEYWORDS, but that was a large 10 hunks\npatch.\n\nThe following patch instead just initializes ridpointers for the __intNN\nkeywords.  It can't be done earlier before we record_builtin_type as there\nare 2 different spellings and if we initialize those ridpointers early, the\nsecond record_builtin_type fails miserably.\n\n2022-04-11  Jakub Jelinek  <jakub@redhat.com>\n\n\tPR c++/105186\n\t* c-common.cc (c_common_nodes_and_builtins): After registering __int%d\n\tand __int%d__ builtin types, initialize corresponding ridpointers\n\tentry.\n\n\t* c-c++-common/pr105186.c: New test.", "tree": {"sha": "f792b4756e3cc01b00de9dd941502bcbf18a7a08", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/f792b4756e3cc01b00de9dd941502bcbf18a7a08"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/083e8e66d2e90992fa83a53bfc3553dfa91abda1", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/083e8e66d2e90992fa83a53bfc3553dfa91abda1", "html_url": "https://github.com/Rust-GCC/gccrs/commit/083e8e66d2e90992fa83a53bfc3553dfa91abda1", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/083e8e66d2e90992fa83a53bfc3553dfa91abda1/comments", "author": {"login": "jakubjelinek", "id": 9370665, "node_id": "MDQ6VXNlcjkzNzA2NjU=", "avatar_url": "https://avatars.githubusercontent.com/u/9370665?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jakubjelinek", "html_url": "https://github.com/jakubjelinek", "followers_url": "https://api.github.com/users/jakubjelinek/followers", "following_url": "https://api.github.com/users/jakubjelinek/following{/other_user}", "gists_url": "https://api.github.com/users/jakubjelinek/gists{/gist_id}", "starred_url": "https://api.github.com/users/jakubjelinek/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jakubjelinek/subscriptions", "organizations_url": "https://api.github.com/users/jakubjelinek/orgs", "repos_url": "https://api.github.com/users/jakubjelinek/repos", "events_url": "https://api.github.com/users/jakubjelinek/events{/privacy}", "received_events_url": "https://api.github.com/users/jakubjelinek/received_events", "type": "User", "site_admin": false}, "committer": {"login": "jakubjelinek", "id": 9370665, "node_id": "MDQ6VXNlcjkzNzA2NjU=", "avatar_url": "https://avatars.githubusercontent.com/u/9370665?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jakubjelinek", "html_url": "https://github.com/jakubjelinek", "followers_url": "https://api.github.com/users/jakubjelinek/followers", "following_url": "https://api.github.com/users/jakubjelinek/following{/other_user}", "gists_url": "https://api.github.com/users/jakubjelinek/gists{/gist_id}", "starred_url": "https://api.github.com/users/jakubjelinek/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jakubjelinek/subscriptions", "organizations_url": "https://api.github.com/users/jakubjelinek/orgs", "repos_url": "https://api.github.com/users/jakubjelinek/repos", "events_url": "https://api.github.com/users/jakubjelinek/events{/privacy}", "received_events_url": "https://api.github.com/users/jakubjelinek/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "8d331aab65488b3998bd106205bbe6cab5df31b5", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/8d331aab65488b3998bd106205bbe6cab5df31b5", "html_url": "https://github.com/Rust-GCC/gccrs/commit/8d331aab65488b3998bd106205bbe6cab5df31b5"}], "stats": {"total": 7, "additions": 7, "deletions": 0}, "files": [{"sha": "70f55f3a3465a60f75e5bdec2c28de371f1a9774", "filename": "gcc/c-family/c-common.cc", "status": "modified", "additions": 2, "deletions": 0, "changes": 2, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/083e8e66d2e90992fa83a53bfc3553dfa91abda1/gcc%2Fc-family%2Fc-common.cc", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/083e8e66d2e90992fa83a53bfc3553dfa91abda1/gcc%2Fc-family%2Fc-common.cc", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fc-family%2Fc-common.cc?ref=083e8e66d2e90992fa83a53bfc3553dfa91abda1", "patch": "@@ -4278,6 +4278,8 @@ c_common_nodes_and_builtins (void)\n       sprintf (name, \"__int%d__\", int_n_data[i].bitsize);\n       record_builtin_type ((enum rid)(RID_FIRST_INT_N + i), name,\n \t\t\t   int_n_trees[i].signed_type);\n+      ridpointers[RID_FIRST_INT_N + i]\n+\t= DECL_NAME (TYPE_NAME (int_n_trees[i].signed_type));\n \n       sprintf (name, \"__int%d unsigned\", int_n_data[i].bitsize);\n       record_builtin_type (RID_MAX, name, int_n_trees[i].unsigned_type);"}, {"sha": "ea687eacc4c1b50c033b32ff0a5ddc9407bb9781", "filename": "gcc/testsuite/c-c++-common/pr105186.c", "status": "added", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/083e8e66d2e90992fa83a53bfc3553dfa91abda1/gcc%2Ftestsuite%2Fc-c%2B%2B-common%2Fpr105186.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/083e8e66d2e90992fa83a53bfc3553dfa91abda1/gcc%2Ftestsuite%2Fc-c%2B%2B-common%2Fpr105186.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fc-c%2B%2B-common%2Fpr105186.c?ref=083e8e66d2e90992fa83a53bfc3553dfa91abda1", "patch": "@@ -0,0 +1,5 @@\n+/* PR c++/105186 */\n+/* { dg-do compile } */\n+\n+__attribute__((__int128)) int i;\t/* { dg-warning \"'__int128' attribute directive ignored\" } */\n+__attribute__((__int128__)) int j;\t/* { dg-warning \"'__int128' attribute directive ignored\" } */"}]}