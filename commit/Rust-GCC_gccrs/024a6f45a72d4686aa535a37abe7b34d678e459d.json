{"sha": "024a6f45a72d4686aa535a37abe7b34d678e459d", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6MDI0YTZmNDVhNzJkNDY4NmFhNTM1YTM3YWJlN2IzNGQ2NzhlNDU5ZA==", "commit": {"author": {"name": "Paolo Carlini", "email": "paolo.carlini@oracle.com", "date": "2018-03-14T01:03:13Z"}, "committer": {"name": "Jason Merrill", "email": "jason@gcc.gnu.org", "date": "2018-03-14T01:03:13Z"}, "message": "PR c++/82336 - link error with list-init default argument.\n\n\t* decl.c (check_default_argument): Unshare an initializer list.\n\nCo-Authored-By: Jason Merrill <jason@redhat.com>\n\nFrom-SVN: r258512", "tree": {"sha": "1435fb7d689bfd840cbef20af2eca339c8b440a7", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/1435fb7d689bfd840cbef20af2eca339c8b440a7"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/024a6f45a72d4686aa535a37abe7b34d678e459d", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/024a6f45a72d4686aa535a37abe7b34d678e459d", "html_url": "https://github.com/Rust-GCC/gccrs/commit/024a6f45a72d4686aa535a37abe7b34d678e459d", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/024a6f45a72d4686aa535a37abe7b34d678e459d/comments", "author": null, "committer": null, "parents": [{"sha": "17164de4f8d7409c65bcc9c060df824f49dc4629", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/17164de4f8d7409c65bcc9c060df824f49dc4629", "html_url": "https://github.com/Rust-GCC/gccrs/commit/17164de4f8d7409c65bcc9c060df824f49dc4629"}], "stats": {"total": 18, "additions": 17, "deletions": 1}, "files": [{"sha": "71fba7518072238a785e3dd4080500da7d856d5d", "filename": "gcc/cp/ChangeLog", "status": "modified", "additions": 6, "deletions": 0, "changes": 6, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/024a6f45a72d4686aa535a37abe7b34d678e459d/gcc%2Fcp%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/024a6f45a72d4686aa535a37abe7b34d678e459d/gcc%2Fcp%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fcp%2FChangeLog?ref=024a6f45a72d4686aa535a37abe7b34d678e459d", "patch": "@@ -1,3 +1,9 @@\n+2018-03-13  Paolo Carlini  <paolo.carlini@oracle.com>\n+\t    Jason Merrill  <jason@redhat.com>\n+\n+\tPR c++/82336 - link error with list-init default argument.\n+\t* decl.c (check_default_argument): Unshare an initializer list.\n+\n 2018-03-13  Jakub Jelinek  <jakub@redhat.com>\n \n \tPR c++/84843"}, {"sha": "45daccda9164d11c7235f71c40a4dc4eb277eece", "filename": "gcc/cp/decl.c", "status": "modified", "additions": 3, "deletions": 1, "changes": 4, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/024a6f45a72d4686aa535a37abe7b34d678e459d/gcc%2Fcp%2Fdecl.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/024a6f45a72d4686aa535a37abe7b34d678e459d/gcc%2Fcp%2Fdecl.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fcp%2Fdecl.c?ref=024a6f45a72d4686aa535a37abe7b34d678e459d", "patch": "@@ -12668,7 +12668,9 @@ check_default_argument (tree decl, tree arg, tsubst_flags_t complain)\n      A default argument expression is implicitly converted to the\n      parameter type.  */\n   ++cp_unevaluated_operand;\n-  perform_implicit_conversion_flags (decl_type, arg, complain,\n+  /* Avoid digest_init clobbering the initializer.  */\n+  tree carg = BRACE_ENCLOSED_INITIALIZER_P (arg) ? unshare_expr (arg): arg;\n+  perform_implicit_conversion_flags (decl_type, carg, complain,\n \t\t\t\t     LOOKUP_IMPLICIT);\n   --cp_unevaluated_operand;\n "}, {"sha": "65240355fc33bc25a673afe3fde8754c071c0658", "filename": "gcc/testsuite/g++.dg/cpp0x/initlist-defarg2.C", "status": "added", "additions": 8, "deletions": 0, "changes": 8, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/024a6f45a72d4686aa535a37abe7b34d678e459d/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Fcpp0x%2Finitlist-defarg2.C", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/024a6f45a72d4686aa535a37abe7b34d678e459d/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Fcpp0x%2Finitlist-defarg2.C", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Fcpp0x%2Finitlist-defarg2.C?ref=024a6f45a72d4686aa535a37abe7b34d678e459d", "patch": "@@ -0,0 +1,8 @@\n+// PR c++/82336\n+// { dg-do link { target c++11 } }\n+\n+struct foo { int x = 5; };\n+struct bar : foo { bar() = default; };\n+struct baz { bar x; };\n+void qux(baz = {}){}\n+int main() { qux(); }"}]}