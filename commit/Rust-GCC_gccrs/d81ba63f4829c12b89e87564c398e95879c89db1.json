{"sha": "d81ba63f4829c12b89e87564c398e95879c89db1", "node_id": "C_kwDOANBUbNoAKGQ4MWJhNjNmNDgyOWMxMmI4OWU4NzU2NGMzOThlOTU4NzljODlkYjE", "commit": {"author": {"name": "bors[bot]", "email": "26634292+bors[bot]@users.noreply.github.com", "date": "2022-02-17T08:44:36Z"}, "committer": {"name": "GitHub", "email": "noreply@github.com", "date": "2022-02-17T08:44:36Z"}, "message": "Merge #933\n\n933: macrotranscriber: Add location info r=CohenArthur a=CohenArthur\n\nCloses #929 \r\n\r\nAdds location info to the macro's transcriber. When generating a `MacroRule` error, this PR creates an empty location for the transcriber, since the error function is only called if no fat arrow is present or if there was an error parsing the macro's matcher. Please let me know if this is the expected behavior\n\nCo-authored-by: Arthur Cohen <arthur.cohen@embecosm.com>", "tree": {"sha": "46c2aa8c0da5a1cfd72b50fb4579ff000c2d46cc", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/46c2aa8c0da5a1cfd72b50fb4579ff000c2d46cc"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/d81ba63f4829c12b89e87564c398e95879c89db1", "comment_count": 0, "verification": {"verified": true, "reason": "valid", "signature": "-----BEGIN PGP SIGNATURE-----\n\nwsBcBAABCAAQBQJiDgr0CRBK7hj4Ov3rIwAAG7wIAJ+mTj4ArKZfM/Pfqpeaaugw\ngFdA2A24a/NTzt3qfEgL5MGIEj9MlO6Xu92Q6ohihlZ71hXmP6UKp4UUfgUpz+dj\nux6DpOd0U/lNDJ61D3CT95IpUV1hqSeN2K3cxNS/hkigyF+nIXdQA8RvgoYm2FdU\nPoj1M4LrkFXo9nKiCFTyhLv6q1Bm9jEFtVDOdtemSKtozXHqdxcnkv1sOwXER1M/\nL1VkKx4JDEZ7VPCbhO9KZJY1wNkMSIHTiwOcRnTUdne3H18DlMKQsH0w8sue/pz7\nR5KFMQhEWx2SSf0o6VSQRYjoW852QAKwq/q0VOJvnJodV/R1nKxLXe8JBvktI9o=\n=XhPc\n-----END PGP SIGNATURE-----\n", "payload": "tree 46c2aa8c0da5a1cfd72b50fb4579ff000c2d46cc\nparent a5272f389b02623b8bc4aaeafcf84013dae7c9fb\nparent 45ca46018f034e50d37e6fdcd3d0de9c0ce74927\nauthor bors[bot] <26634292+bors[bot]@users.noreply.github.com> 1645087476 +0000\ncommitter GitHub <noreply@github.com> 1645087476 +0000\n\nMerge #933\n\n933: macrotranscriber: Add location info r=CohenArthur a=CohenArthur\n\nCloses #929 \r\n\r\nAdds location info to the macro's transcriber. When generating a `MacroRule` error, this PR creates an empty location for the transcriber, since the error function is only called if no fat arrow is present or if there was an error parsing the macro's matcher. Please let me know if this is the expected behavior\n\nCo-authored-by: Arthur Cohen <arthur.cohen@embecosm.com>\n"}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/d81ba63f4829c12b89e87564c398e95879c89db1", "html_url": "https://github.com/Rust-GCC/gccrs/commit/d81ba63f4829c12b89e87564c398e95879c89db1", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/d81ba63f4829c12b89e87564c398e95879c89db1/comments", "author": {"login": "bors[bot]", "id": 26634292, "node_id": "MDM6Qm90MjY2MzQyOTI=", "avatar_url": "https://avatars.githubusercontent.com/in/1847?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors%5Bbot%5D", "html_url": "https://github.com/apps/bors", "followers_url": "https://api.github.com/users/bors%5Bbot%5D/followers", "following_url": "https://api.github.com/users/bors%5Bbot%5D/following{/other_user}", "gists_url": "https://api.github.com/users/bors%5Bbot%5D/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors%5Bbot%5D/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors%5Bbot%5D/subscriptions", "organizations_url": "https://api.github.com/users/bors%5Bbot%5D/orgs", "repos_url": "https://api.github.com/users/bors%5Bbot%5D/repos", "events_url": "https://api.github.com/users/bors%5Bbot%5D/events{/privacy}", "received_events_url": "https://api.github.com/users/bors%5Bbot%5D/received_events", "type": "Bot", "site_admin": false}, "committer": {"login": "web-flow", "id": 19864447, "node_id": "MDQ6VXNlcjE5ODY0NDQ3", "avatar_url": "https://avatars.githubusercontent.com/u/19864447?v=4", "gravatar_id": "", "url": "https://api.github.com/users/web-flow", "html_url": "https://github.com/web-flow", "followers_url": "https://api.github.com/users/web-flow/followers", "following_url": "https://api.github.com/users/web-flow/following{/other_user}", "gists_url": "https://api.github.com/users/web-flow/gists{/gist_id}", "starred_url": "https://api.github.com/users/web-flow/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/web-flow/subscriptions", "organizations_url": "https://api.github.com/users/web-flow/orgs", "repos_url": "https://api.github.com/users/web-flow/repos", "events_url": "https://api.github.com/users/web-flow/events{/privacy}", "received_events_url": "https://api.github.com/users/web-flow/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "a5272f389b02623b8bc4aaeafcf84013dae7c9fb", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/a5272f389b02623b8bc4aaeafcf84013dae7c9fb", "html_url": "https://github.com/Rust-GCC/gccrs/commit/a5272f389b02623b8bc4aaeafcf84013dae7c9fb"}, {"sha": "45ca46018f034e50d37e6fdcd3d0de9c0ce74927", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/45ca46018f034e50d37e6fdcd3d0de9c0ce74927", "html_url": "https://github.com/Rust-GCC/gccrs/commit/45ca46018f034e50d37e6fdcd3d0de9c0ce74927"}], "stats": {"total": 15, "additions": 9, "deletions": 6}, "files": [{"sha": "ef50e4a30156e8f5d1b1a731e5d4c31809d27c64", "filename": "gcc/rust/ast/rust-macro.h", "status": "modified", "additions": 7, "deletions": 5, "changes": 12, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/d81ba63f4829c12b89e87564c398e95879c89db1/gcc%2Frust%2Fast%2Frust-macro.h", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/d81ba63f4829c12b89e87564c398e95879c89db1/gcc%2Frust%2Fast%2Frust-macro.h", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Frust%2Fast%2Frust-macro.h?ref=d81ba63f4829c12b89e87564c398e95879c89db1", "patch": "@@ -277,15 +277,16 @@ struct MacroTranscriber\n {\n private:\n   DelimTokenTree token_tree;\n-\n-  // TODO: should store location information?\n+  Location locus;\n \n public:\n-  MacroTranscriber (DelimTokenTree token_tree)\n-    : token_tree (std::move (token_tree))\n+  MacroTranscriber (DelimTokenTree token_tree, Location locus)\n+    : token_tree (std::move (token_tree)), locus (locus)\n   {}\n \n   std::string as_string () const { return token_tree.as_string (); }\n+\n+  Location get_locus () const { return locus; }\n };\n \n // A macro rule? Matcher and transcriber pair?\n@@ -310,7 +311,8 @@ struct MacroRule\n   {\n     // FIXME: Once #928 is merged, give location to MacroMatcher\n     return MacroRule (MacroMatcher::create_error (Location ()),\n-\t\t      MacroTranscriber (DelimTokenTree::create_empty ()));\n+\t\t      MacroTranscriber (DelimTokenTree::create_empty (),\n+\t\t\t\t\tLocation ()));\n   }\n \n   std::string as_string () const;"}, {"sha": "ef0ad40a78193305e2310ddbe27e45f245d0dc11", "filename": "gcc/rust/parse/rust-parse-impl.h", "status": "modified", "additions": 2, "deletions": 1, "changes": 3, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/d81ba63f4829c12b89e87564c398e95879c89db1/gcc%2Frust%2Fparse%2Frust-parse-impl.h", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/d81ba63f4829c12b89e87564c398e95879c89db1/gcc%2Frust%2Fparse%2Frust-parse-impl.h", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Frust%2Fparse%2Frust-parse-impl.h?ref=d81ba63f4829c12b89e87564c398e95879c89db1", "patch": "@@ -1691,7 +1691,8 @@ Parser<ManagedTokenSource>::parse_macro_rule ()\n     }\n \n   // parse transcriber (this is just a delim token tree)\n-  AST::MacroTranscriber transcriber (parse_delim_token_tree ());\n+  Location token_tree_loc = lexer.peek_token ()->get_locus ();\n+  AST::MacroTranscriber transcriber (parse_delim_token_tree (), token_tree_loc);\n \n   return AST::MacroRule (std::move (matcher), std::move (transcriber));\n }"}]}