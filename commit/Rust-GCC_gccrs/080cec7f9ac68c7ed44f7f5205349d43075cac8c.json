{"sha": "080cec7f9ac68c7ed44f7f5205349d43075cac8c", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6MDgwY2VjN2Y5YWM2OGM3ZWQ0NGY3ZjUyMDUzNDlkNDMwNzVjYWM4Yw==", "commit": {"author": {"name": "Jonathan Wakely", "email": "jwakely@redhat.com", "date": "2018-12-20T18:12:11Z"}, "committer": {"name": "Jonathan Wakely", "email": "redi@gcc.gnu.org", "date": "2018-12-20T18:12:11Z"}, "message": "Fix filesystem::path tests that fail on Windows\n\n\t* testsuite/27_io/filesystem/operations/proximate.cc: Fix test for\n\tMinGW.\n\t* testsuite/27_io/filesystem/path/append/source.cc: Likewise.\n\t* testsuite/27_io/filesystem/path/compare/lwg2936.cc: Likewise.\n\nFrom-SVN: r267308", "tree": {"sha": "597b9e546f2f9b362453770365244380bab4bd2f", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/597b9e546f2f9b362453770365244380bab4bd2f"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/080cec7f9ac68c7ed44f7f5205349d43075cac8c", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/080cec7f9ac68c7ed44f7f5205349d43075cac8c", "html_url": "https://github.com/Rust-GCC/gccrs/commit/080cec7f9ac68c7ed44f7f5205349d43075cac8c", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/080cec7f9ac68c7ed44f7f5205349d43075cac8c/comments", "author": {"login": "jwakely", "id": 1254480, "node_id": "MDQ6VXNlcjEyNTQ0ODA=", "avatar_url": "https://avatars.githubusercontent.com/u/1254480?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jwakely", "html_url": "https://github.com/jwakely", "followers_url": "https://api.github.com/users/jwakely/followers", "following_url": "https://api.github.com/users/jwakely/following{/other_user}", "gists_url": "https://api.github.com/users/jwakely/gists{/gist_id}", "starred_url": "https://api.github.com/users/jwakely/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jwakely/subscriptions", "organizations_url": "https://api.github.com/users/jwakely/orgs", "repos_url": "https://api.github.com/users/jwakely/repos", "events_url": "https://api.github.com/users/jwakely/events{/privacy}", "received_events_url": "https://api.github.com/users/jwakely/received_events", "type": "User", "site_admin": false}, "committer": {"login": "jwakely", "id": 1254480, "node_id": "MDQ6VXNlcjEyNTQ0ODA=", "avatar_url": "https://avatars.githubusercontent.com/u/1254480?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jwakely", "html_url": "https://github.com/jwakely", "followers_url": "https://api.github.com/users/jwakely/followers", "following_url": "https://api.github.com/users/jwakely/following{/other_user}", "gists_url": "https://api.github.com/users/jwakely/gists{/gist_id}", "starred_url": "https://api.github.com/users/jwakely/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jwakely/subscriptions", "organizations_url": "https://api.github.com/users/jwakely/orgs", "repos_url": "https://api.github.com/users/jwakely/repos", "events_url": "https://api.github.com/users/jwakely/events{/privacy}", "received_events_url": "https://api.github.com/users/jwakely/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "159fdc3966a2b9501fea87930b21bf72d1202efd", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/159fdc3966a2b9501fea87930b21bf72d1202efd", "html_url": "https://github.com/Rust-GCC/gccrs/commit/159fdc3966a2b9501fea87930b21bf72d1202efd"}], "stats": {"total": 57, "additions": 43, "deletions": 14}, "files": [{"sha": "60e7e74a42df1408fee2c9b4e8fd34b026d990ea", "filename": "libstdc++-v3/ChangeLog", "status": "modified", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/080cec7f9ac68c7ed44f7f5205349d43075cac8c/libstdc%2B%2B-v3%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/080cec7f9ac68c7ed44f7f5205349d43075cac8c/libstdc%2B%2B-v3%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libstdc%2B%2B-v3%2FChangeLog?ref=080cec7f9ac68c7ed44f7f5205349d43075cac8c", "patch": "@@ -1,5 +1,10 @@\n 2018-12-20  Jonathan Wakely  <jwakely@redhat.com>\n \n+\t* testsuite/27_io/filesystem/operations/proximate.cc: Fix test for\n+\tMinGW.\n+\t* testsuite/27_io/filesystem/path/append/source.cc: Likewise.\n+\t* testsuite/27_io/filesystem/path/compare/lwg2936.cc: Likewise.\n+\n \t* testsuite/27_io/filesystem/directory_entry/lwg3171.cc: New test\n \t(missed from previous commit).\n "}, {"sha": "980161c9ead3aea256ae0a692c78b3c5900f6172", "filename": "libstdc++-v3/testsuite/27_io/filesystem/operations/proximate.cc", "status": "modified", "additions": 22, "deletions": 10, "changes": 32, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/080cec7f9ac68c7ed44f7f5205349d43075cac8c/libstdc%2B%2B-v3%2Ftestsuite%2F27_io%2Ffilesystem%2Foperations%2Fproximate.cc", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/080cec7f9ac68c7ed44f7f5205349d43075cac8c/libstdc%2B%2B-v3%2Ftestsuite%2F27_io%2Ffilesystem%2Foperations%2Fproximate.cc", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libstdc%2B%2B-v3%2Ftestsuite%2F27_io%2Ffilesystem%2Foperations%2Fproximate.cc?ref=080cec7f9ac68c7ed44f7f5205349d43075cac8c", "patch": "@@ -26,38 +26,50 @@\n using std::filesystem::proximate;\n using __gnu_test::compare_paths;\n \n+// Normalize directory-separators\n+std::string operator\"\"_norm(const char* s, std::size_t n)\n+{\n+  std::string str(s, n);\n+#if defined(__MING32__) || defined(__MINGW64__)\n+  for (auto& c : str)\n+    if (c == '/')\n+      c = '\\\\';\n+#endif\n+  return str;\n+}\n+\n void\n test01()\n {\n-  compare_paths( proximate(\"/a/d\", \"/a/b/c\"), \"../../d\" );\n-  compare_paths( proximate(\"/a/b/c\", \"/a/d\"), \"../b/c\" );\n-  compare_paths( proximate(\"a/b/c\", \"a\"), \"b/c\" );\n-  compare_paths( proximate(\"a/b/c\", \"a/b/c/x/y\"), \"../..\" );\n+  compare_paths( proximate(\"/a/d\", \"/a/b/c\"), \"../../d\"_norm );\n+  compare_paths( proximate(\"/a/b/c\", \"/a/d\"), \"../b/c\"_norm );\n+  compare_paths( proximate(\"a/b/c\", \"a\"), \"b/c\"_norm );\n+  compare_paths( proximate(\"a/b/c\", \"a/b/c/x/y\"), \"../..\"_norm );\n   compare_paths( proximate(\"a/b/c\", \"a/b/c\"), \".\" );\n-  compare_paths( proximate(\"a/b\", \"c/d\"), \"../../a/b\" );\n+  compare_paths( proximate(\"a/b\", \"c/d\"), \"../../a/b\"_norm );\n }\n \n void\n test02()\n {\n   const std::error_code bad_ec = make_error_code(std::errc::invalid_argument);\n   std::error_code ec = bad_ec;\n-  compare_paths( proximate(\"/a/d\", \"/a/b/c\", ec), \"../../d\" );\n+  compare_paths( proximate(\"/a/d\", \"/a/b/c\", ec), \"../../d\"_norm );\n   VERIFY( !ec );\n   ec = bad_ec;\n-  compare_paths( proximate(\"/a/b/c\", \"/a/d\", ec), \"../b/c\" );\n+  compare_paths( proximate(\"/a/b/c\", \"/a/d\", ec), \"../b/c\"_norm );\n   VERIFY( !ec );\n   ec = bad_ec;\n-  compare_paths( proximate(\"a/b/c\", \"a\", ec), \"b/c\" );\n+  compare_paths( proximate(\"a/b/c\", \"a\", ec), \"b/c\"_norm );\n   VERIFY( !ec );\n   ec = bad_ec;\n-  compare_paths( proximate(\"a/b/c\", \"a/b/c/x/y\", ec), \"../..\" );\n+  compare_paths( proximate(\"a/b/c\", \"a/b/c/x/y\", ec), \"../..\"_norm );\n   VERIFY( !ec );\n   ec = bad_ec;\n   compare_paths( proximate(\"a/b/c\", \"a/b/c\", ec), \".\" );\n   VERIFY( !ec );\n   ec = bad_ec;\n-  compare_paths( proximate(\"a/b\", \"c/d\", ec), \"../../a/b\" );\n+  compare_paths( proximate(\"a/b\", \"c/d\", ec), \"../../a/b\"_norm );\n   VERIFY( !ec );\n }\n "}, {"sha": "578d1350178c02e188704aa3fe91614ca1381c44", "filename": "libstdc++-v3/testsuite/27_io/filesystem/path/append/source.cc", "status": "modified", "additions": 11, "deletions": 4, "changes": 15, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/080cec7f9ac68c7ed44f7f5205349d43075cac8c/libstdc%2B%2B-v3%2Ftestsuite%2F27_io%2Ffilesystem%2Fpath%2Fappend%2Fsource.cc", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/080cec7f9ac68c7ed44f7f5205349d43075cac8c/libstdc%2B%2B-v3%2Ftestsuite%2F27_io%2Ffilesystem%2Fpath%2Fappend%2Fsource.cc", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libstdc%2B%2B-v3%2Ftestsuite%2F27_io%2Ffilesystem%2Fpath%2Fappend%2Fsource.cc?ref=080cec7f9ac68c7ed44f7f5205349d43075cac8c", "patch": "@@ -120,24 +120,31 @@ test05()\n   path p = \"0/1/2/3/4/5/6\";\n   // The string_view aliases the path's internal string:\n   s = p.native();\n+  path::string_type expected(s);\n+  expected += path::preferred_separator;\n+  expected += s;\n   // Append that string_view, which must work correctly even though the\n   // internal string will be reallocated during the operation:\n   p /= s;\n-  VERIFY( p.string() == \"0/1/2/3/4/5/6/0/1/2/3/4/5/6\" );\n+  compare_paths(p, expected);\n \n   // Same again with a trailing slash:\n   path p2 = \"0/1/2/3/4/5/\";\n   s = p2.native();\n+  expected = s;\n+  expected += s;\n   p2 /= s;\n-  VERIFY( p2.string() == \"0/1/2/3/4/5/0/1/2/3/4/5/\" );\n+  compare_paths(p2, expected);\n \n   // And aliasing one of the components of the path:\n   path p3 = \"0/123456789/a\";\n   path::iterator second = std::next(p3.begin());\n   s = second->native();\n+  expected = p3.native() + path::preferred_separator;\n+  expected += s;\n   p3 /= s;\n-  VERIFY( p3.string() == \"0/123456789/a/123456789\" );\n-  }\n+  compare_paths(p3, expected);\n+}\n \n void\n test06()"}, {"sha": "a62f01c3fb6cf94ea1d9e6cc3ec96b2971d9cf85", "filename": "libstdc++-v3/testsuite/27_io/filesystem/path/compare/lwg2936.cc", "status": "modified", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/080cec7f9ac68c7ed44f7f5205349d43075cac8c/libstdc%2B%2B-v3%2Ftestsuite%2F27_io%2Ffilesystem%2Fpath%2Fcompare%2Flwg2936.cc", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/080cec7f9ac68c7ed44f7f5205349d43075cac8c/libstdc%2B%2B-v3%2Ftestsuite%2F27_io%2Ffilesystem%2Fpath%2Fcompare%2Flwg2936.cc", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libstdc%2B%2B-v3%2Ftestsuite%2F27_io%2Ffilesystem%2Fpath%2Fcompare%2Flwg2936.cc?ref=080cec7f9ac68c7ed44f7f5205349d43075cac8c", "patch": "@@ -60,14 +60,19 @@ test01()\n   check(\"c:\", \"d:\", -1);\n   check(\"c:\", \"c:/\", -1);\n   check(\"d:\", \"c:/\", +1);\n+#if defined(__MING32__) || defined(__MINGW64__)\n+  check(\"c:/a/b\", \"c:a/b\", +1);\n+#else\n   check(\"c:/a/b\", \"c:a/b\", -1);\n+#endif\n \n   // These are root names on Cygwin (just relative paths elsewhere)\n   check(\"\", \"//c\", -1);\n   check(\"//c\", \"//d\", -1);\n   check(\"//c\", \"//c/\", -1);\n   check(\"//d\", \"//c/\", +1);\n \n+  check(\"a\", \"/\", -1);\n   check(\"/a\", \"/b\", -1);\n   check(\"a\", \"/b\", -1);\n   check(\"/b\", \"b\", +1);"}]}