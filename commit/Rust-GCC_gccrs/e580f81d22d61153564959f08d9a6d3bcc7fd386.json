{"sha": "e580f81d22d61153564959f08d9a6d3bcc7fd386", "node_id": "C_kwDOANBUbNoAKGU1ODBmODFkMjJkNjExNTM1NjQ5NTlmMDhkOWE2ZDNiY2M3ZmQzODY", "commit": {"author": {"name": "Jason Merrill", "email": "jason@redhat.com", "date": "2022-04-14T21:49:47Z"}, "committer": {"name": "Jason Merrill", "email": "jason@redhat.com", "date": "2022-04-15T01:55:08Z"}, "message": "c++: unsigned int32_t enum promotion [PR102804]\n\nThere's been an extension for a long time to allow applying 'unsigned' to an\nint typedef, but that was confusing the integer promotion code.  Fixed by\nforgetting about the typedef in that case.\n\nI'm going to make this an unconditional pedwarn in stage 1.\n\n\tPR c++/102804\n\ngcc/cp/ChangeLog:\n\n\t* decl.cc (grokdeclarator): Drop typedef used with 'unsigned'.\n\ngcc/testsuite/ChangeLog:\n\n\t* g++.dg/ext/unsigned-typedef1.C: New test.", "tree": {"sha": "5bf77da86a01b4989520ba1cc78f91bd07dbdb73", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/5bf77da86a01b4989520ba1cc78f91bd07dbdb73"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/e580f81d22d61153564959f08d9a6d3bcc7fd386", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/e580f81d22d61153564959f08d9a6d3bcc7fd386", "html_url": "https://github.com/Rust-GCC/gccrs/commit/e580f81d22d61153564959f08d9a6d3bcc7fd386", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/e580f81d22d61153564959f08d9a6d3bcc7fd386/comments", "author": {"login": "jicama", "id": 266146, "node_id": "MDQ6VXNlcjI2NjE0Ng==", "avatar_url": "https://avatars.githubusercontent.com/u/266146?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jicama", "html_url": "https://github.com/jicama", "followers_url": "https://api.github.com/users/jicama/followers", "following_url": "https://api.github.com/users/jicama/following{/other_user}", "gists_url": "https://api.github.com/users/jicama/gists{/gist_id}", "starred_url": "https://api.github.com/users/jicama/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jicama/subscriptions", "organizations_url": "https://api.github.com/users/jicama/orgs", "repos_url": "https://api.github.com/users/jicama/repos", "events_url": "https://api.github.com/users/jicama/events{/privacy}", "received_events_url": "https://api.github.com/users/jicama/received_events", "type": "User", "site_admin": false}, "committer": {"login": "jicama", "id": 266146, "node_id": "MDQ6VXNlcjI2NjE0Ng==", "avatar_url": "https://avatars.githubusercontent.com/u/266146?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jicama", "html_url": "https://github.com/jicama", "followers_url": "https://api.github.com/users/jicama/followers", "following_url": "https://api.github.com/users/jicama/following{/other_user}", "gists_url": "https://api.github.com/users/jicama/gists{/gist_id}", "starred_url": "https://api.github.com/users/jicama/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jicama/subscriptions", "organizations_url": "https://api.github.com/users/jicama/orgs", "repos_url": "https://api.github.com/users/jicama/repos", "events_url": "https://api.github.com/users/jicama/events{/privacy}", "received_events_url": "https://api.github.com/users/jicama/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "6364a39907bd68624a30df0c8e380c40d2a646c4", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/6364a39907bd68624a30df0c8e380c40d2a646c4", "html_url": "https://github.com/Rust-GCC/gccrs/commit/6364a39907bd68624a30df0c8e380c40d2a646c4"}], "stats": {"total": 11, "additions": 11, "deletions": 0}, "files": [{"sha": "2852093d6245e1d2b44d1b7044cc17804147bed3", "filename": "gcc/cp/decl.cc", "status": "modified", "additions": 2, "deletions": 0, "changes": 2, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/e580f81d22d61153564959f08d9a6d3bcc7fd386/gcc%2Fcp%2Fdecl.cc", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/e580f81d22d61153564959f08d9a6d3bcc7fd386/gcc%2Fcp%2Fdecl.cc", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fcp%2Fdecl.cc?ref=e580f81d22d61153564959f08d9a6d3bcc7fd386", "patch": "@@ -12243,6 +12243,8 @@ grokdeclarator (const cp_declarator *declarator,\n \t      pedwarn (loc, OPT_Wpedantic, \"%qs specified with %qT\",\n \t\t       key, type);\n \t      ok = !flag_pedantic_errors;\n+\t      type = DECL_ORIGINAL_TYPE (typedef_decl);\n+\t      typedef_decl = NULL_TREE;\n \t    }\n \t  else if (declspecs->decltype_p)\n \t    error_at (loc, \"%qs specified with %<decltype%>\", key);"}, {"sha": "360b5f81edfe3a89f124899c2fab3622b1608be2", "filename": "gcc/testsuite/g++.dg/ext/unsigned-typedef1.C", "status": "added", "additions": 9, "deletions": 0, "changes": 9, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/e580f81d22d61153564959f08d9a6d3bcc7fd386/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Fext%2Funsigned-typedef1.C", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/e580f81d22d61153564959f08d9a6d3bcc7fd386/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Fext%2Funsigned-typedef1.C", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Fext%2Funsigned-typedef1.C?ref=e580f81d22d61153564959f08d9a6d3bcc7fd386", "patch": "@@ -0,0 +1,9 @@\n+// PR c++/102804\n+// { dg-do compile { target c++11 } }\n+// { dg-options \"-Wpedantic\" }\n+\n+using int32_t = int;\n+enum: unsigned int32_t { foo };\t// { dg-warning \"int32_t\" }\n+int f(int) = delete;\n+int f(unsigned);\n+auto x = f(1 ? foo : 1);"}]}