{"sha": "5e33fea21957c97d63e3738be6056ae2a94e3284", "node_id": "C_kwDOANBUbNoAKDVlMzNmZWEyMTk1N2M5N2Q2M2UzNzM4YmU2MDU2YWUyYTk0ZTMyODQ", "commit": {"author": {"name": "Tobias Burnus", "email": "tobias@codesourcery.com", "date": "2022-03-23T15:54:12Z"}, "committer": {"name": "Tobias Burnus", "email": "tobias@codesourcery.com", "date": "2022-03-23T15:54:12Z"}, "message": "Fortran: Fix directory stat check for '.' [PR103560]\n\nMinGW does not like a call to 'stat' for './' via gfc_do_check_include_dir.\nSolution: Only append '/' when concatenating the path with the filename.\n\ngcc/fortran/ChangeLog:\n\n\tPR fortran/103560\n\t* scanner.cc (add_path_to_list): Don't append '/' to the\n\tsave include path.\n\t(open_included_file): Use '/' in concatenating path + file name.\n\t* module.cc (gzopen_included_file_1): Likewise.\n\ngcc/testsuite/ChangeLog:\n\n\tPR fortran/103560\n\t* gfortran.dg/include_14.f90: Update dg-warning.\n\t* gfortran.dg/include_17.f90: Likewise.\n\t* gfortran.dg/include_18.f90: Likewise.\n\t* gfortran.dg/include_6.f90: Update dg-*.", "tree": {"sha": "66283c2f660e7acf4b529b2848716bac8a3db57a", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/66283c2f660e7acf4b529b2848716bac8a3db57a"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/5e33fea21957c97d63e3738be6056ae2a94e3284", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/5e33fea21957c97d63e3738be6056ae2a94e3284", "html_url": "https://github.com/Rust-GCC/gccrs/commit/5e33fea21957c97d63e3738be6056ae2a94e3284", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/5e33fea21957c97d63e3738be6056ae2a94e3284/comments", "author": {"login": "tob2", "id": 264461, "node_id": "MDQ6VXNlcjI2NDQ2MQ==", "avatar_url": "https://avatars.githubusercontent.com/u/264461?v=4", "gravatar_id": "", "url": "https://api.github.com/users/tob2", "html_url": "https://github.com/tob2", "followers_url": "https://api.github.com/users/tob2/followers", "following_url": "https://api.github.com/users/tob2/following{/other_user}", "gists_url": "https://api.github.com/users/tob2/gists{/gist_id}", "starred_url": "https://api.github.com/users/tob2/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/tob2/subscriptions", "organizations_url": "https://api.github.com/users/tob2/orgs", "repos_url": "https://api.github.com/users/tob2/repos", "events_url": "https://api.github.com/users/tob2/events{/privacy}", "received_events_url": "https://api.github.com/users/tob2/received_events", "type": "User", "site_admin": false}, "committer": {"login": "tob2", "id": 264461, "node_id": "MDQ6VXNlcjI2NDQ2MQ==", "avatar_url": "https://avatars.githubusercontent.com/u/264461?v=4", "gravatar_id": "", "url": "https://api.github.com/users/tob2", "html_url": "https://github.com/tob2", "followers_url": "https://api.github.com/users/tob2/followers", "following_url": "https://api.github.com/users/tob2/following{/other_user}", "gists_url": "https://api.github.com/users/tob2/gists{/gist_id}", "starred_url": "https://api.github.com/users/tob2/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/tob2/subscriptions", "organizations_url": "https://api.github.com/users/tob2/orgs", "repos_url": "https://api.github.com/users/tob2/repos", "events_url": "https://api.github.com/users/tob2/events{/privacy}", "received_events_url": "https://api.github.com/users/tob2/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "d9792f8d227cdd409c2b082ef0685b47ccfaa334", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/d9792f8d227cdd409c2b082ef0685b47ccfaa334", "html_url": "https://github.com/Rust-GCC/gccrs/commit/d9792f8d227cdd409c2b082ef0685b47ccfaa334"}], "stats": {"total": 24, "additions": 12, "deletions": 12}, "files": [{"sha": "85aa153bd7750d56345c9c91d53c2b30ded88911", "filename": "gcc/fortran/module.cc", "status": "modified", "additions": 2, "deletions": 1, "changes": 3, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/5e33fea21957c97d63e3738be6056ae2a94e3284/gcc%2Ffortran%2Fmodule.cc", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/5e33fea21957c97d63e3738be6056ae2a94e3284/gcc%2Ffortran%2Fmodule.cc", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ffortran%2Fmodule.cc?ref=5e33fea21957c97d63e3738be6056ae2a94e3284", "patch": "@@ -1095,8 +1095,9 @@ gzopen_included_file_1 (const char *name, gfc_directorylist *list,\n       if (module && !p->use_for_modules)\n        continue;\n \n-      fullname = (char *) alloca(strlen (p->path) + strlen (name) + 1);\n+      fullname = (char *) alloca(strlen (p->path) + strlen (name) + 2);\n       strcpy (fullname, p->path);\n+      strcat (fullname, \"/\");\n       strcat (fullname, name);\n \n       f = gzopen (fullname, \"r\");"}, {"sha": "2dff2514700b374524258fbeb659893e551a5ecc", "filename": "gcc/fortran/scanner.cc", "status": "modified", "additions": 3, "deletions": 4, "changes": 7, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/5e33fea21957c97d63e3738be6056ae2a94e3284/gcc%2Ffortran%2Fscanner.cc", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/5e33fea21957c97d63e3738be6056ae2a94e3284/gcc%2Ffortran%2Fscanner.cc", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ffortran%2Fscanner.cc?ref=5e33fea21957c97d63e3738be6056ae2a94e3284", "patch": "@@ -409,9 +409,7 @@ add_path_to_list (gfc_directorylist **list, const char *path,\n     *list = dir;\n   dir->use_for_modules = use_for_modules;\n   dir->warn = warn;\n-  dir->path = XCNEWVEC (char, strlen (p) + 2);\n-  strcpy (dir->path, p);\n-  strcat (dir->path, \"/\");\t/* make '/' last character */\n+  dir->path = xstrdup (p);\n }\n \n /* defer_warn is set to true while parsing the commandline.  */\n@@ -476,8 +474,9 @@ open_included_file (const char *name, gfc_directorylist *list,\n       if (module && !p->use_for_modules)\n \tcontinue;\n \n-      fullname = (char *) alloca(strlen (p->path) + strlen (name) + 1);\n+      fullname = (char *) alloca(strlen (p->path) + strlen (name) + 2);\n       strcpy (fullname, p->path);\n+      strcat (fullname, \"/\");\n       strcat (fullname, name);\n \n       f = gfc_open_file (fullname);"}, {"sha": "39acf69b1b446d1f6595cf7861e72ea4b1657a44", "filename": "gcc/testsuite/gfortran.dg/include_14.f90", "status": "modified", "additions": 2, "deletions": 2, "changes": 4, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/5e33fea21957c97d63e3738be6056ae2a94e3284/gcc%2Ftestsuite%2Fgfortran.dg%2Finclude_14.f90", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/5e33fea21957c97d63e3738be6056ae2a94e3284/gcc%2Ftestsuite%2Fgfortran.dg%2Finclude_14.f90", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgfortran.dg%2Finclude_14.f90?ref=5e33fea21957c97d63e3738be6056ae2a94e3284", "patch": "@@ -1,6 +1,6 @@\n ! { dg-additional-options \"-cpp -idirafter /fdaf/ -I bar -J foo/bar\" }\n end\n ! default: warn for -I and -J but ignore other options.\n-! { dg-warning \"Nonexistent include directory 'bar/'\" \"\" { target *-*-* } 0 }\n-! { dg-warning \"Nonexistent include directory 'foo/bar/'\" \"\" { target *-*-* } 0 }\n+! { dg-warning \"Nonexistent include directory 'bar'\" \"\" { target *-*-* } 0 }\n+! { dg-warning \"Nonexistent include directory 'foo/bar'\" \"\" { target *-*-* } 0 }\n "}, {"sha": "f09b22f079abb0afc502535211a4413dbd217bb4", "filename": "gcc/testsuite/gfortran.dg/include_17.f90", "status": "modified", "additions": 2, "deletions": 2, "changes": 4, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/5e33fea21957c97d63e3738be6056ae2a94e3284/gcc%2Ftestsuite%2Fgfortran.dg%2Finclude_17.f90", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/5e33fea21957c97d63e3738be6056ae2a94e3284/gcc%2Ftestsuite%2Fgfortran.dg%2Finclude_17.f90", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgfortran.dg%2Finclude_17.f90?ref=5e33fea21957c97d63e3738be6056ae2a94e3284", "patch": "@@ -1,6 +1,6 @@\n ! { dg-do compile }\n ! { dg-options \"-I foo-bar -J foo/bar\" }\n end \n-! { dg-warning \"Nonexistent include directory 'foo-bar/'\" \"\" { target *-*-* } 0 }\n-! { dg-warning \"Nonexistent include directory 'foo/bar/'\" \"\" { target *-*-* } 0 }\n+! { dg-warning \"Nonexistent include directory 'foo-bar'\" \"\" { target *-*-* } 0 }\n+! { dg-warning \"Nonexistent include directory 'foo/bar'\" \"\" { target *-*-* } 0 }\n "}, {"sha": "7ca0e48f09187796aebb9cfe8892ea1ca4b1946f", "filename": "gcc/testsuite/gfortran.dg/include_18.f90", "status": "modified", "additions": 2, "deletions": 2, "changes": 4, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/5e33fea21957c97d63e3738be6056ae2a94e3284/gcc%2Ftestsuite%2Fgfortran.dg%2Finclude_18.f90", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/5e33fea21957c97d63e3738be6056ae2a94e3284/gcc%2Ftestsuite%2Fgfortran.dg%2Finclude_18.f90", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgfortran.dg%2Finclude_18.f90?ref=5e33fea21957c97d63e3738be6056ae2a94e3284", "patch": "@@ -1,5 +1,5 @@\n ! { dg-do compile }\n ! { dg-options \"-I nothere -J neither/here -Wmissing-include-dirs\" }\n end \n-! { dg-warning \"Nonexistent include directory 'nothere/'\" \"\" { target *-*-* } 0 }\n-! { dg-warning \"Nonexistent include directory 'neither/here/'\" \"\" { target *-*-* } 0 }\n+! { dg-warning \"Nonexistent include directory 'nothere'\" \"\" { target *-*-* } 0 }\n+! { dg-warning \"Nonexistent include directory 'neither/here'\" \"\" { target *-*-* } 0 }"}, {"sha": "2cea47390f4e1acc7f7e817c6f0c1be9699f62d7", "filename": "gcc/testsuite/gfortran.dg/include_6.f90", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/5e33fea21957c97d63e3738be6056ae2a94e3284/gcc%2Ftestsuite%2Fgfortran.dg%2Finclude_6.f90", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/5e33fea21957c97d63e3738be6056ae2a94e3284/gcc%2Ftestsuite%2Fgfortran.dg%2Finclude_6.f90", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgfortran.dg%2Finclude_6.f90?ref=5e33fea21957c97d63e3738be6056ae2a94e3284", "patch": "@@ -1,6 +1,6 @@\n ! { dg-do compile }\n ! { dg-options \"-I gfortran.log\" }\n-! { dg-warning \"Include directory 'gfortran.log/': Not a directory\" \"\" { target *-*-* } 0 }\n+! { dg-error \"'gfortran.log' is not a directory\" \"\" { target *-*-* } 0 }\n ! { dg-prune-output \"compilation terminated.\" }\n end \n "}]}