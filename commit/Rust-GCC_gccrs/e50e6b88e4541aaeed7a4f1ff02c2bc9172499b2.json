{"sha": "e50e6b88e4541aaeed7a4f1ff02c2bc9172499b2", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6ZTUwZTZiODhlNDU0MWFhZWVkN2E0ZjFmZjAyYzJiYzkxNzI0OTliMg==", "commit": {"author": {"name": "Danny Smith", "email": "dannysmith@users.sourceforge.net", "date": "2004-12-13T06:57:13Z"}, "committer": {"name": "Danny Smith", "email": "dannysmith@gcc.gnu.org", "date": "2004-12-13T06:57:13Z"}, "message": "defaults.h (TARGET_USE_JCR_SECTION): New macro.\n\ngcc\n\tPR/18549\n\t* defaults.h (TARGET_USE_JCR_SECTION): New macro.\n\t* doc/tm.texi (TARGET_USE_JCR_SECTION): Document it.\n\t* config/i386/cygming.h (TARGET_USE_JCR_SECTION): Override\n\tdefault.\n\ngcc/java\n\tPR/18549\n\t* class.c (emit_register_classes): Use TARGET_USE_JCR_SECTION.\n\tUpdate comment.\n\nFrom-SVN: r92078", "tree": {"sha": "8474907991a93da60a61bf807147a9c32fcc9b6d", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/8474907991a93da60a61bf807147a9c32fcc9b6d"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/e50e6b88e4541aaeed7a4f1ff02c2bc9172499b2", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/e50e6b88e4541aaeed7a4f1ff02c2bc9172499b2", "html_url": "https://github.com/Rust-GCC/gccrs/commit/e50e6b88e4541aaeed7a4f1ff02c2bc9172499b2", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/e50e6b88e4541aaeed7a4f1ff02c2bc9172499b2/comments", "author": null, "committer": null, "parents": [{"sha": "4049b3760e3141906fa86ab9071d4bd86c6a8b13", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/4049b3760e3141906fa86ab9071d4bd86c6a8b13", "html_url": "https://github.com/Rust-GCC/gccrs/commit/4049b3760e3141906fa86ab9071d4bd86c6a8b13"}], "stats": {"total": 48, "additions": 44, "deletions": 4}, "files": [{"sha": "2c5427b8d57460ff3940d9683847855581bfb516", "filename": "gcc/ChangeLog", "status": "modified", "additions": 8, "deletions": 0, "changes": 8, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/e50e6b88e4541aaeed7a4f1ff02c2bc9172499b2/gcc%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/e50e6b88e4541aaeed7a4f1ff02c2bc9172499b2/gcc%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2FChangeLog?ref=e50e6b88e4541aaeed7a4f1ff02c2bc9172499b2", "patch": "@@ -1,3 +1,11 @@\n+2004-12-13  Danny Smith  <dannysmith@users.sourceforge.net>\n+\n+\tPR/18549\n+\t* defaults.h (TARGET_USE_JCR_SECTION): New macro.\n+\t* doc/tm.texi (TARGET_USE_JCR_SECTION): Document it.\n+\t* config/i386/cygming.h (TARGET_USE_JCR_SECTION): Override\n+\tdefault.\n+\n 2004-12-13 Uros Bizjak <uros@kss-loka.si>\n \n \tPR target/14941"}, {"sha": "a354994179736eab33531ee2d832f81c702548d9", "filename": "gcc/config/i386/cygming.h", "status": "modified", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/e50e6b88e4541aaeed7a4f1ff02c2bc9172499b2/gcc%2Fconfig%2Fi386%2Fcygming.h", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/e50e6b88e4541aaeed7a4f1ff02c2bc9172499b2/gcc%2Fconfig%2Fi386%2Fcygming.h", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fconfig%2Fi386%2Fcygming.h?ref=e50e6b88e4541aaeed7a4f1ff02c2bc9172499b2", "patch": "@@ -408,6 +408,11 @@ extern int i386_pe_dllimport_name_p (const char *);\n   while (0)\n #endif /* HAVE_GAS_WEAK */\n \n+/* FIXME: SUPPORTS_WEAK && TARGET_HAVE_NAMED_SECTIONS is true,\n+   but for .jcr section to work we also need crtbegin and crtend\n+   objects.  */\n+#define TARGET_USE_JCR_SECTION 0\n+\n /* Decide whether it is safe to use a local alias for a virtual function\n    when constructing thunks.  */\n #undef TARGET_USE_LOCAL_THUNK_ALIAS_P"}, {"sha": "a60d2a2b0ff08d6fe6a20a9dd36355c635e3c1a0", "filename": "gcc/defaults.h", "status": "modified", "additions": 12, "deletions": 0, "changes": 12, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/e50e6b88e4541aaeed7a4f1ff02c2bc9172499b2/gcc%2Fdefaults.h", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/e50e6b88e4541aaeed7a4f1ff02c2bc9172499b2/gcc%2Fdefaults.h", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fdefaults.h?ref=e50e6b88e4541aaeed7a4f1ff02c2bc9172499b2", "patch": "@@ -339,6 +339,18 @@ do { fputs (integer_asm_op (POINTER_SIZE / BITS_PER_UNIT, TRUE), FILE); \\\n #endif\n #endif\n \n+/* This decision to use a .jcr section can be overriden by defining\n+   USE_JCR_SECTION to 0 in target file.  This is necessary if target\n+   can define JCR_SECTION_NAME but does not have crtstuff or\n+   linker support for .jcr section.  */\n+#ifndef TARGET_USE_JCR_SECTION\n+#ifdef JCR_SECTION_NAME\n+#define TARGET_USE_JCR_SECTION 1\n+#else\n+#define TARGET_USE_JCR_SECTION 0\n+#endif\n+#endif\n+\n /* Number of hardware registers that go into the DWARF-2 unwind info.\n    If not defined, equals FIRST_PSEUDO_REGISTER  */\n "}, {"sha": "f5436d7c78fb6eafa76d6a86c5336d1630e32bba", "filename": "gcc/doc/tm.texi", "status": "modified", "additions": 6, "deletions": 0, "changes": 6, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/e50e6b88e4541aaeed7a4f1ff02c2bc9172499b2/gcc%2Fdoc%2Ftm.texi", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/e50e6b88e4541aaeed7a4f1ff02c2bc9172499b2/gcc%2Fdoc%2Ftm.texi", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fdoc%2Ftm.texi?ref=e50e6b88e4541aaeed7a4f1ff02c2bc9172499b2", "patch": "@@ -9575,3 +9575,9 @@ option.  The default is to have no target-specific format checks.\n If defined, this macro is the number of entries in\n @code{TARGET_FORMAT_TYPES}.\n @end defmac\n+\n+@defmac TARGET_USE_JCR_SECTION\n+This macro determines whether to use the JCR section to register Java\n+classes. By default, TARGET_USE_JCR_SECTION is defined to 1 if both\n+SUPPORTS_WEAK and TARGET_HAVE_NAMED_SECTIONS are true, else 0.\n+@end defmac"}, {"sha": "dfb5ccba93233eff6d2bdc359a9fbf20891797e1", "filename": "gcc/java/ChangeLog", "status": "modified", "additions": 6, "deletions": 0, "changes": 6, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/e50e6b88e4541aaeed7a4f1ff02c2bc9172499b2/gcc%2Fjava%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/e50e6b88e4541aaeed7a4f1ff02c2bc9172499b2/gcc%2Fjava%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fjava%2FChangeLog?ref=e50e6b88e4541aaeed7a4f1ff02c2bc9172499b2", "patch": "@@ -1,3 +1,9 @@\n+2004-12-13  Danny Smith  <dannysmith@users.sourceforge.net>\n+\n+\tPR/18549\n+\t* class.c (emit_register_classes): Use TARGET_USE_JCR_SECTION.\n+\tUpdate comment.\n+\n 2004-12-07  Andrew Haley  <aph@redhat.com>\n \n \tPR java/18811:"}, {"sha": "94138200d0b1965983c5d0b6d829d6e7add5cd40", "filename": "gcc/java/class.c", "status": "modified", "additions": 7, "deletions": 4, "changes": 11, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/e50e6b88e4541aaeed7a4f1ff02c2bc9172499b2/gcc%2Fjava%2Fclass.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/e50e6b88e4541aaeed7a4f1ff02c2bc9172499b2/gcc%2Fjava%2Fclass.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fjava%2Fclass.c?ref=e50e6b88e4541aaeed7a4f1ff02c2bc9172499b2", "patch": "@@ -2419,10 +2419,11 @@ emit_register_classes (tree *list_p)\n   if (registered_class == NULL)\n     return;\n \n-  /* ??? This isn't quite the correct test.  We also have to know\n-     that the target is using gcc's crtbegin/crtend objects rather\n-     than the ones that come with the operating system.  */\n-  if (SUPPORTS_WEAK && targetm.have_named_sections)\n+  /* TARGET_USE_JCR_SECTION defaults to 1 if SUPPORTS_WEAK and\n+     TARGET_ASM_NAMED_SECTION, else 0.  Some targets meet those conditions\n+     but lack suitable crtbegin/end objects or linker support.  These\n+     targets can overide the default in tm.h to use the fallback mechanism.  */\n+  if (TARGET_USE_JCR_SECTION)\n     {\n #ifdef JCR_SECTION_NAME\n       tree t;\n@@ -2432,6 +2433,8 @@ emit_register_classes (tree *list_p)\n \tassemble_integer (XEXP (DECL_RTL (t), 0),\n \t\t\t  POINTER_SIZE / BITS_PER_UNIT, POINTER_SIZE, 1);\n #else\n+      /* A target has defined TARGET_USE_JCR_SECTION, but doesn't have a\n+\t JCR_SECTION_NAME.  */\n       abort ();\n #endif\n     }"}]}