{"sha": "97752b7c446e513677e9d49b0c57427d41aaebde", "node_id": "C_kwDOANBUbNoAKDk3NzUyYjdjNDQ2ZTUxMzY3N2U5ZDQ5YjBjNTc0MjdkNDFhYWViZGU", "commit": {"author": {"name": "Torbj\u00f6rn SVENSSON", "email": "torbjorn.svensson@foss.st.com", "date": "2022-10-25T14:11:05Z"}, "committer": {"name": "Torbj\u00f6rn SVENSSON", "email": "torbjorn.svensson@foss.st.com", "date": "2022-11-04T07:57:06Z"}, "message": "c++: Use in-process client when networking is disabled\n\nWithout the patch, the output for bad-mapper-3.C would be:\n\n/src/gcc/gcc/testsuite/g++.dg/modules/bad-mapper-3.C:2:1: error: unknown Compiled Module Interface: no such module\n\nAs this line is unexpected, the test case would fail.\nThe same problem can also be seen for g++.dg/modules/bad-mapper-2.C.\n\ngcc/cp/ChangeLog:\n\n\t* mapper-client.cc: Use in-process client when networking is\n\tdisabled.\n\ngcc/testsuite/ChangeLog:\n\n\t* g++.dg/modules/bad-mapper-3.C: Update dg-error pattern.\n\nCo-Authored-By: Yvan ROUX <yvan.roux@foss.st.com>\nSigned-off-by: Torbj\u00f6rn SVENSSON <torbjorn.svensson@foss.st.com>", "tree": {"sha": "a566b926ca48951a45025628da18b7e54e865d29", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/a566b926ca48951a45025628da18b7e54e865d29"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/97752b7c446e513677e9d49b0c57427d41aaebde", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/97752b7c446e513677e9d49b0c57427d41aaebde", "html_url": "https://github.com/Rust-GCC/gccrs/commit/97752b7c446e513677e9d49b0c57427d41aaebde", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/97752b7c446e513677e9d49b0c57427d41aaebde/comments", "author": null, "committer": null, "parents": [{"sha": "fabe470b2441a4a760a5f491395631e53821b765", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/fabe470b2441a4a760a5f491395631e53821b765", "html_url": "https://github.com/Rust-GCC/gccrs/commit/fabe470b2441a4a760a5f491395631e53821b765"}], "stats": {"total": 6, "additions": 5, "deletions": 1}, "files": [{"sha": "8e331c0e8969faa70c1acec36d43964b87260b27", "filename": "gcc/cp/mapper-client.cc", "status": "modified", "additions": 4, "deletions": 0, "changes": 4, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/97752b7c446e513677e9d49b0c57427d41aaebde/gcc%2Fcp%2Fmapper-client.cc", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/97752b7c446e513677e9d49b0c57427d41aaebde/gcc%2Fcp%2Fmapper-client.cc", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fcp%2Fmapper-client.cc?ref=97752b7c446e513677e9d49b0c57427d41aaebde", "patch": "@@ -227,6 +227,8 @@ module_client::open_module_client (location_t loc, const char *o,\n \t\tint fd = -1;\n #if CODY_NETWORKING\n \t\tfd = Cody::OpenLocal (&errmsg, name.c_str () + 1);\n+#else\n+\t\terrmsg = \"disabled\";\n #endif\n \t\tif (fd >= 0)\n \t\t  c = new module_client (fd, fd);\n@@ -254,6 +256,8 @@ module_client::open_module_client (location_t loc, const char *o,\n \t\t\tint fd = -1;\n #if CODY_NETWORKING\n \t\t\tfd = Cody::OpenInet6 (&errmsg, name.c_str (), port);\n+#else\n+\t\t\terrmsg = \"disabled\";\n #endif\n \t\t\tname[colon] = ':';\n "}, {"sha": "ab14dd39a67a524da704f9a8c4e05fcebca966dc", "filename": "gcc/testsuite/g++.dg/modules/bad-mapper-3.C", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/97752b7c446e513677e9d49b0c57427d41aaebde/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Fmodules%2Fbad-mapper-3.C", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/97752b7c446e513677e9d49b0c57427d41aaebde/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Fmodules%2Fbad-mapper-3.C", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Fmodules%2Fbad-mapper-3.C?ref=97752b7c446e513677e9d49b0c57427d41aaebde", "patch": "@@ -1,6 +1,6 @@\n //  { dg-additional-options \"-fmodules-ts -fmodule-mapper=localhost:172477262\" }\n import unique3.bob;\n-// { dg-error {failed connecting mapper 'localhost:172477262'} \"\" { target *-*-* } 0 }\n+// { dg-error {failed (connecting|disabled) mapper 'localhost:172477262'} \"\" { target *-*-* } 0 }\n // { dg-prune-output \"fatal error:\" }\n // { dg-prune-output \"failed to read\" }\n // { dg-prune-output \"compilation terminated\" }"}]}