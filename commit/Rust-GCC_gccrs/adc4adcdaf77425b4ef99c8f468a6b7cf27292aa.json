{"sha": "adc4adcdaf77425b4ef99c8f468a6b7cf27292aa", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6YWRjNGFkY2RhZjc3NDI1YjRlZjk5YzhmNDY4YTZiN2NmMjcyOTJhYQ==", "commit": {"author": {"name": "Gerald Pfeifer", "email": "gerald@gcc.gnu.org", "date": "2003-07-14T13:36:56Z"}, "committer": {"name": "Gerald Pfeifer", "email": "gerald@gcc.gnu.org", "date": "2003-07-14T13:36:56Z"}, "message": "ggc-page.c (extra_order_size_table): Insns have 9 slots.\n\n\t* ggc-page.c (extra_order_size_table): Insns have 9 slots. Regs\n\tdon't have 2.\n\n\t* ggc-page.c (struct globals): Add new fields to keep track of the\n\ttotal allocated memory and overhead.\n\t(ggc_print_statistics): Print them.\n\t(ggc_alloc): Keep track of the total allocated memory and the\n\toverhead.\n\n\t* tree.c (dump_tree_statistics): Increase spacing.\n\t(enum tree_node_kind): Move to ...\n\t* tree.h (enum tree_node_kind): ... here.\n\t(tree_node_counts, tree_node_sizes): Declare.\n\n\t* doc/include/texinfo.tex: Upgrade to texinfo 4.6.\n\nFrom-SVN: r69330", "tree": {"sha": "47bd6d886c5f588b7ab757036ddad7e0ef31691b", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/47bd6d886c5f588b7ab757036ddad7e0ef31691b"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/adc4adcdaf77425b4ef99c8f468a6b7cf27292aa", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/adc4adcdaf77425b4ef99c8f468a6b7cf27292aa", "html_url": "https://github.com/Rust-GCC/gccrs/commit/adc4adcdaf77425b4ef99c8f468a6b7cf27292aa", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/adc4adcdaf77425b4ef99c8f468a6b7cf27292aa/comments", "author": null, "committer": null, "parents": [{"sha": "3ad249b9c71911ab735f7ea4e43a0b3fa6f48513", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/3ad249b9c71911ab735f7ea4e43a0b3fa6f48513", "html_url": "https://github.com/Rust-GCC/gccrs/commit/3ad249b9c71911ab735f7ea4e43a0b3fa6f48513"}], "stats": {"total": 1884, "additions": 1124, "deletions": 760}, "files": [{"sha": "72a57bd7f7e7fa11b4f8e799a6c7af7e34810527", "filename": "gcc/ChangeLog", "status": "modified", "additions": 22, "deletions": 0, "changes": 22, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/adc4adcdaf77425b4ef99c8f468a6b7cf27292aa/gcc%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/adc4adcdaf77425b4ef99c8f468a6b7cf27292aa/gcc%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2FChangeLog?ref=adc4adcdaf77425b4ef99c8f468a6b7cf27292aa", "patch": "@@ -1,3 +1,25 @@\n+2003-07-14  Dan Nicolaescu  <dann@ics.uci.edu>\n+\n+\t* ggc-page.c (extra_order_size_table): Insns have 9 slots. Regs\n+\tdon't have 2.\n+\n+2003-07-14  Dan Nicolaescu  <dann@ics.uci.edu>\n+\n+\t* ggc-page.c (struct globals): Add new fields to keep track of the\n+\ttotal allocated memory and overhead.\n+\t(ggc_print_statistics): Print them.\n+\t(ggc_alloc): Keep track of the total allocated memory and the\n+\toverhead.\n+\n+\t* tree.c (dump_tree_statistics): Increase spacing.\n+\t(enum tree_node_kind): Move to ...\n+\t* tree.h (enum tree_node_kind): ... here.\n+\t(tree_node_counts, tree_node_sizes): Declare.\n+\n+2003-07-14  James A. Morrison  <ja2morri@student.math.uwaterloo.ca>\n+\n+\t* doc/include/texinfo.tex: Upgrade to texinfo 4.6.\n+\n 2003-07-14  Franz Sirl  <Franz.Sirl-kernel@lauterbach.com>\n \n \tPR optimization/11440"}, {"sha": "e9293f3b9d5fa18da8c66be711d932a33b75fd15", "filename": "gcc/doc/include/texinfo.tex", "status": "modified", "additions": 992, "deletions": 733, "changes": 1725, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/adc4adcdaf77425b4ef99c8f468a6b7cf27292aa/gcc%2Fdoc%2Finclude%2Ftexinfo.tex", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/adc4adcdaf77425b4ef99c8f468a6b7cf27292aa/gcc%2Fdoc%2Finclude%2Ftexinfo.tex", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fdoc%2Finclude%2Ftexinfo.tex?ref=adc4adcdaf77425b4ef99c8f468a6b7cf27292aa", "patch": "@@ -3,10 +3,10 @@\n % Load plain if necessary, i.e., if running under initex.\n \\expandafter\\ifx\\csname fmtname\\endcsname\\relax\\input plain\\fi\n %\n-\\def\\texinfoversion{2002-12-26.16}\n+\\def\\texinfoversion{2003-05-04.08}\n %\n % Copyright (C) 1985, 1986, 1988, 1990, 1991, 1992, 1993, 1994, 1995,\n-% 1996, 1997, 1998, 1999, 2000, 2001, 2002 Free Software Foundation, Inc.\n+% 1996, 1997, 1998, 1999, 2000, 2001, 2002, 2003 Free Software Foundation, Inc.\n %\n % This texinfo.tex file is free software; you can redistribute it and/or\n % modify it under the terms of the GNU General Public License as\n@@ -34,12 +34,12 @@\n %   ftp://tug.org/tex/texinfo.tex\n %     (and all CTAN mirrors, see http://www.ctan.org),\n %   and /home/gd/gnu/doc/texinfo.tex on the GNU machines.\n-% \n+%\n % The GNU Texinfo home page is http://www.gnu.org/software/texinfo.\n-% \n+%\n % The texinfo.tex in any given Texinfo distribution could well be out\n % of date, so if that's what you're using, please check.\n-% \n+%\n % Send bug reports to bug-texinfo@gnu.org.  Please include including a\n % complete document in each bug report with which we can reproduce the\n % problem.  Patches are, of course, greatly appreciated.\n@@ -56,8 +56,9 @@\n % Sometimes one run after texindex suffices, and sometimes you need more\n % than two; texi2dvi does it as many times as necessary.\n %\n-% It is possible to adapt texinfo.tex for other languages.  You can get\n-% the existing language-specific files from the full Texinfo distribution.\n+% It is possible to adapt texinfo.tex for other languages, to some\n+% extent.  You can get the existing language-specific files from the\n+% full Texinfo distribution.\n \n \\message{Loading texinfo [version \\texinfoversion]:}\n \n@@ -70,11 +71,11 @@\n \\message{Basics,}\n \\chardef\\other=12\n \n-% We never want plain's outer \\+ definition in Texinfo.\n+% We never want plain's \\outer definition of \\+ in Texinfo.\n % For @tex, we can use \\tabalign.\n \\let\\+ = \\relax\n \n-% Save some parts of plain tex whose names we will redefine.\n+% Save some plain tex macros whose names we will redefine.\n \\let\\ptexb=\\b\n \\let\\ptexbullet=\\bullet\n \\let\\ptexc=\\c\n@@ -87,10 +88,12 @@\n \\let\\ptexgtr=>\n \\let\\ptexhat=^\n \\let\\ptexi=\\i\n+\\let\\ptexindent=\\indent\n \\let\\ptexlbrace=\\{\n \\let\\ptexless=<\n \\let\\ptexplus=+\n \\let\\ptexrbrace=\\}\n+\\let\\ptexslash=\\/\n \\let\\ptexstar=\\*\n \\let\\ptext=\\t\n \n@@ -140,6 +143,18 @@\n \\ifx\\putwordDeffunc\\undefined   \\gdef\\putwordDeffunc{Function}\\fi\n \\ifx\\putwordDeftypefun\\undefined\\gdef\\putwordDeftypefun{Function}\\fi\n \n+% In some macros, we cannot use the `\\? notation---the left quote is\n+% in some cases the escape char.\n+\\chardef\\colonChar = `\\:\n+\\chardef\\commaChar = `\\,\n+\\chardef\\dotChar   = `\\.\n+\\chardef\\equalChar = `\\=\n+\\chardef\\exclamChar= `\\!\n+\\chardef\\questChar = `\\?\n+\\chardef\\semiChar  = `\\;\n+\\chardef\\spaceChar = `\\ %\n+\\chardef\\underChar = `\\_\n+\n % Ignore a token.\n %\n \\def\\gobble#1{}\n@@ -151,8 +166,9 @@\n \n % Hyphenation fixes.\n \\hyphenation{ap-pen-dix}\n-\\hyphenation{mini-buf-fer mini-buf-fers}\n \\hyphenation{eshell}\n+\\hyphenation{mini-buf-fer mini-buf-fers}\n+\\hyphenation{time-stamp}\n \\hyphenation{white-space}\n \n % Margin to add to right of even pages, to left of odd pages.\n@@ -189,7 +205,7 @@\n \n % add check for \\lastpenalty to plain's definitions.  If the last thing\n % we did was a \\nobreak, we don't want to insert more space.\n-% \n+%\n \\def\\smallbreak{\\ifnum\\lastpenalty<10000\\par\\ifdim\\lastskip<\\smallskipamount\n   \\removelastskip\\penalty-50\\smallskip\\fi\\fi}\n \\def\\medbreak{\\ifnum\\lastpenalty<10000\\par\\ifdim\\lastskip<\\medskipamount\n@@ -290,7 +306,7 @@\n       \\egroup % \\vbox from first cropmarks clause\n       \\fi\n     }% end of \\shipout\\vbox\n-  }% end of group with \\turnoffactive\n+  }% end of group with \\normalturnoffactive\n   \\advancepageno\n   \\ifnum\\outputpenalty>-20000 \\else\\dosupereject\\fi\n }\n@@ -469,16 +485,19 @@\n \\let\\{=\\mylbrace\n \\let\\}=\\myrbrace\n \\begingroup\n-  % Definitions to produce actual \\{ & \\} command in an index.\n-  \\catcode`\\{ = 12 \\catcode`\\} = 12\n+  % Definitions to produce \\{ and \\} commands for indices,\n+  % and @{ and @} for the aux file.\n+  \\catcode`\\{ = \\other \\catcode`\\} = \\other\n   \\catcode`\\[ = 1 \\catcode`\\] = 2\n-  \\catcode`\\@ = 0 \\catcode`\\\\ = 12\n-  @gdef@lbracecmd[\\{]%\n-  @gdef@rbracecmd[\\}]%\n-@endgroup\n+  \\catcode`\\! = 0 \\catcode`\\\\ = \\other\n+  !gdef!lbracecmd[\\{]%\n+  !gdef!rbracecmd[\\}]%\n+  !gdef!lbraceatcmd[@{]%\n+  !gdef!rbraceatcmd[@}]%\n+!endgroup\n \n % Accents: @, @dotaccent @ringaccent @ubaraccent @udotaccent\n-% Others are defined by plain TeX: @` @' @\" @^ @~ @= @v @H.\n+% Others are defined by plain TeX: @` @' @\" @^ @~ @= @u @v @H.\n \\let\\, = \\c\n \\let\\dotaccent = \\.\n \\def\\ringaccent#1{{\\accent23 #1}}\n@@ -487,7 +506,7 @@\n \\let\\udotaccent = \\d\n \n % Other special characters: @questiondown @exclamdown\n-% Plain TeX defines: @AA @AE @O @OE @L (and lowercase versions) @ss.\n+% Plain TeX defines: @AA @AE @O @OE @L (plus lowercase versions) @ss.\n \\def\\questiondown{?`}\n \\def\\exclamdown{!`}\n \n@@ -520,6 +539,9 @@\n % @* forces a line break.\n \\def\\*{\\hfil\\break\\hbox{}\\ignorespaces}\n \n+% @/ allows a line break.\n+\\let\\/=\\allowbreak\n+\n % @. is an end-of-sentence period.\n \\def\\.{.\\spacefactor=3000 }\n \n@@ -542,6 +564,16 @@\n % therefore, no glue is inserted, and the space between the headline and\n % the text is small, which looks bad.\n %\n+% Another complication is that the group might be very large.  This can\n+% cause the glue on the previous page to be unduly stretched, because it\n+% does not have much material.  In this case, it's better to add an\n+% explicit \\vfill so that the extra space is at the bottom.  The\n+% threshold for doing this is if the group is more than \\vfilllimit\n+% percent of a page (\\vfilllimit can be changed inside of @tex).\n+%\n+\\newbox\\groupbox\n+\\def\\vfilllimit{0.7}\n+%\n \\def\\group{\\begingroup\n   \\ifnum\\catcode13=\\active \\else\n     \\errhelp = \\groupinvalidhelp\n@@ -555,10 +587,22 @@\n   % above.  But it's pretty close.\n   \\def\\Egroup{%\n     \\egroup           % End the \\vtop.\n+    % \\dimen0 is the vertical size of the group's box.\n+    \\dimen0 = \\ht\\groupbox  \\advance\\dimen0 by \\dp\\groupbox\n+    % \\dimen2 is how much space is left on the page (more or less).\n+    \\dimen2 = \\pageheight   \\advance\\dimen2 by -\\pagetotal\n+    % if the group doesn't fit on the current page, and it's a big big\n+    % group, force a page break.\n+    \\ifdim \\dimen0 > \\dimen2\n+      \\ifdim \\pagetotal < \\vfilllimit\\pageheight\n+        \\page\n+      \\fi\n+    \\fi\n+    \\copy\\groupbox\n     \\endgroup         % End the \\group.\n   }%\n   %\n-  \\vtop\\bgroup\n+  \\setbox\\groupbox = \\vtop\\bgroup\n     % We have to put a strut on the last line in case the @group is in\n     % the midst of an example, rather than completely enclosing it.\n     % Otherwise, the interline space between the last line of the group\n@@ -683,8 +727,7 @@\n   \\spacefactor=3000\n }\n \n-\n-% @page    forces the start of a new page\n+% @page forces the start of a new page.\n %\n \\def\\page{\\par\\vfill\\supereject}\n \n@@ -733,10 +776,10 @@\n % @inmargin{TEXT [, RIGHT-TEXT]}\n % (if RIGHT-TEXT is given, use TEXT for left page, RIGHT-TEXT for right;\n % else use TEXT for both).\n-% \n+%\n \\def\\inmargin#1{\\parseinmargin #1,,\\finish}\n \\def\\parseinmargin#1,#2,#3\\finish{% not perfect, but better than nothing.\n-  \\setbox0 = \\hbox{\\ignorespaces #2}% \n+  \\setbox0 = \\hbox{\\ignorespaces #2}%\n   \\ifdim\\wd0 > 0pt\n     \\def\\lefttext{#1}%  have both texts\n     \\def\\righttext{#2}%\n@@ -756,30 +799,36 @@\n % @include file    insert text of that file as input.\n % Allow normal characters that  we make active in the argument (a file name).\n \\def\\include{\\begingroup\n-  \\catcode`\\\\=12\n-  \\catcode`~=12\n-  \\catcode`^=12\n-  \\catcode`_=12\n-  \\catcode`|=12\n-  \\catcode`<=12\n-  \\catcode`>=12\n-  \\catcode`+=12\n+  \\catcode`\\\\=\\other\n+  \\catcode`~=\\other\n+  \\catcode`^=\\other\n+  \\catcode`_=\\other\n+  \\catcode`|=\\other\n+  \\catcode`<=\\other\n+  \\catcode`>=\\other\n+  \\catcode`+=\\other\n   \\parsearg\\includezzz}\n % Restore active chars for included file.\n \\def\\includezzz#1{\\endgroup\\begingroup\n   % Read the included file in a group so nested @include's work.\n   \\def\\thisfile{#1}%\n+  \\let\\value=\\expandablevalue\n   \\input\\thisfile\n \\endgroup}\n \n \\def\\thisfile{}\n \n-% @center line   outputs that line, centered\n-\n-\\def\\center{\\parsearg\\centerzzz}\n-\\def\\centerzzz #1{{\\advance\\hsize by -\\leftskip\n-\\advance\\hsize by -\\rightskip\n-\\centerline{#1}}}\n+% @center line\n+% outputs that line, centered.\n+%\n+\\def\\center{\\parsearg\\docenter}\n+\\def\\docenter#1{{%\n+  \\ifhmode \\hfil\\break \\fi\n+  \\advance\\hsize by -\\leftskip\n+  \\advance\\hsize by -\\rightskip\n+  \\line{\\hfil \\ignorespaces#1\\unskip \\hfil}%\n+  \\ifhmode \\break \\fi\n+}}\n \n % @sp n   outputs n lines of vertical space\n \n@@ -799,8 +848,9 @@\n \n % @paragraphindent NCHARS\n % We'll use ems for NCHARS, close enough.\n-% We cannot implement @paragraphindent asis, though.\n-% \n+% NCHARS can also be the word `asis' or `none'.\n+% We cannot feasibly implement @paragraphindent asis, though.\n+%\n \\def\\asisword{asis} % no translation, these are keywords\n \\def\\noneword{none}\n %\n@@ -835,6 +885,53 @@\n   \\fi\n }\n \n+% @firstparagraphindent WORD\n+% If WORD is `none', then suppress indentation of the first paragraph\n+% after a section heading.  If WORD is `insert', then do indentat such\n+% paragraphs.\n+%\n+% The paragraph indentation is suppressed or not by calling\n+% \\suppressfirstparagraphindent, which the sectioning commands do.  We\n+% switch the definition of this back and forth according to WORD.  By\n+% default, we suppress indentation.\n+%\n+\\def\\suppressfirstparagraphindent{\\dosuppressfirstparagraphindent}\n+\\newdimen\\currentparindent\n+%\n+\\def\\insertword{insert}\n+%\n+\\def\\firstparagraphindent{\\parsearg\\dofirstparagraphindent}\n+\\def\\dofirstparagraphindent#1{%\n+  \\def\\temp{#1}%\n+  \\ifx\\temp\\noneword\n+    \\let\\suppressfirstparagraphindent = \\dosuppressfirstparagraphindent\n+  \\else\\ifx\\temp\\insertword\n+    \\let\\suppressfirstparagraphindent = \\relax\n+  \\else\n+    \\errhelp = \\EMsimple\n+    \\errmessage{Unknown @firstparagraphindent option `\\temp'}%\n+  \\fi\\fi\n+}\n+\n+% Here is how we actually suppress indentation.  Redefine \\everypar to\n+% \\kern backwards by \\parindent, and then reset itself to empty.\n+%\n+% We also make \\indent itself not actually do anything until the next\n+% paragraph.\n+%\n+\\gdef\\dosuppressfirstparagraphindent{%\n+  \\gdef\\indent{%\n+    \\global\\let\\indent=\\ptexindent\n+    \\global\\everypar = {}%\n+  }%\n+  \\global\\everypar = {%\n+    \\kern-\\parindent\n+    \\global\\let\\indent=\\ptexindent\n+    \\global\\everypar = {}%\n+  }%\n+}%\n+\n+\n % @asis just yields its argument.  Used with @table, for example.\n %\n \\def\\asis#1{#1}\n@@ -843,25 +940,25 @@\n % We don't use $'s directly in the definition of \\math because we need\n % to set catcodes according to plain TeX first, to allow for subscripts,\n % superscripts, special math chars, etc.\n-% \n+%\n \\let\\implicitmath = $%$ font-lock fix\n %\n % One complication: _ usually means subscripts, but it could also mean\n % an actual _ character, as in @math{@var{some_variable} + 1}.  So make\n % _ within @math be active (mathcode \"8000), and distinguish by seeing\n % if the current family is \\slfam, which is what @var uses.\n-% \n-{\\catcode95 = \\active  % 95 = _\n+%\n+{\\catcode\\underChar = \\active\n \\gdef\\mathunderscore{%\n-  \\catcode95=\\active\n+  \\catcode\\underChar=\\active\n   \\def_{\\ifnum\\fam=\\slfam \\_\\else\\sb\\fi}%\n }}\n %\n % Another complication: we want \\\\ (and @\\) to output a \\ character.\n % FYI, plain.tex uses \\\\ as a temporary control sequence (why?), but\n % this is not advertised and we don't care.  Texinfo does not\n % otherwise define @\\.\n-% \n+%\n % The \\mathchar is class=0=ordinary, family=7=ttfam, position=5C=\\.\n \\def\\mathbackslash{\\ifnum\\fam=\\ttfam \\mathchar\"075C \\else\\backslash \\fi}\n %\n@@ -876,7 +973,7 @@\n % Some active characters (such as <) are spaced differently in math.\n % We have to reset their definitions in case the @math was an\n % argument to a command which set the catcodes (such as @item or @section).\n-% \n+%\n {\n   \\catcode`^ = \\active\n   \\catcode`< = \\active\n@@ -1002,8 +1099,8 @@\n   \\def\\pdfmakeoutlines{{%\n     \\openin 1 \\jobname.toc\n     \\ifeof 1\\else\\begingroup\n-      \\closein 1 \n-      % Thanh's hack / proper braces in bookmarks  \n+      \\closein 1\n+      % Thanh's hack / proper braces in bookmarks\n       \\edef\\mylbrace{\\iftrue \\string{\\else}\\fi}\\let\\{=\\mylbrace\n       \\edef\\myrbrace{\\iffalse{\\else\\string}\\fi}\\let\\}=\\myrbrace\n       %\n@@ -1032,7 +1129,7 @@\n       \\let\\unnumbsubsubsecentry = \\subsubsecentry\n       %\n       % Make special characters normal for writing to the pdf file.\n-      % \n+      %\n       \\indexnofonts\n       \\let\\tt=\\relax\n       \\turnoffactive\n@@ -1047,7 +1144,7 @@\n       \\let\\nextmakelinks=\\makelinks\n       \\ifnum\\lnkcount>0,\\fi\n       \\picknum{#1}%\n-      \\startlink attr{/Border [0 0 0]} \n+      \\startlink attr{/Border [0 0 0]}\n         goto name{\\pdfmkpgn{\\the\\pgn}}%\n       \\linkcolor #1%\n       \\advance\\lnkcount by 1%\n@@ -1102,7 +1199,7 @@\n     \\ifx\\first0\\adn0\n     \\else\\ifx\\first1\\adn1 \\else\\ifx\\first2\\adn2 \\else\\ifx\\first3\\adn3\n     \\else\\ifx\\first4\\adn4 \\else\\ifx\\first5\\adn5 \\else\\ifx\\first6\\adn6\n-    \\else\\ifx\\first7\\adn7 \\else\\ifx\\first8\\adn8 \\else\\ifx\\first9\\adn9 \n+    \\else\\ifx\\first7\\adn7 \\else\\ifx\\first8\\adn8 \\else\\ifx\\first9\\adn9\n     \\else\n       \\ifnum0=\\countA\\else\\makelink\\fi\n       \\ifx\\first.\\let\\next=\\done\\else\n@@ -1193,9 +1290,10 @@\n   \\setfont\\textrm\\rmshape{10}{\\mainmagstep}\n   \\setfont\\texttt\\ttshape{10}{\\mainmagstep}\n \\fi\n-% Instead of cmb10, you many want to use cmbx10.\n+% Instead of cmb10, you may want to use cmbx10.\n % cmbx10 is a prettier font on its own, but cmb10\n-% looks better when embedded in a line with cmr10.\n+% looks better when embedded in a line with cmr10\n+% (in Bob's opinion).\n \\setfont\\textbf\\bfshape{10}{\\mainmagstep}\n \\setfont\\textit\\itshape{10}{\\mainmagstep}\n \\setfont\\textsl\\slshape{10}{\\mainmagstep}\n@@ -1344,7 +1442,25 @@\n   \\let\\tensf=\\smallersf \\let\\teni=\\smalleri \\let\\tensy=\\smallersy\n   \\let\\tenttsl=\\smallerttsl\n   \\resetmathfonts \\setleading{9.5pt}}\n-\\let\\smallexamplefonts = \\smallerfonts\n+\n+% Set the fonts to use with the @small... environments.\n+\\let\\smallexamplefonts = \\smallfonts\n+\n+% About \\smallexamplefonts.  If we use \\smallfonts (9pt), @smallexample\n+% can fit this many characters:\n+%   8.5x11=86   smallbook=72  a4=90  a5=69\n+% If we use \\smallerfonts (8pt), then we can fit this many characters:\n+%   8.5x11=90+  smallbook=80  a4=90+  a5=77\n+% For me, subjectively, the few extra characters that fit aren't worth\n+% the additional smallness of 8pt.  So I'm making the default 9pt.\n+%\n+% By the way, for comparison, here's what fits with @example (10pt):\n+%   8.5x11=71  smallbook=60  a4=75  a5=58\n+%\n+% I wish we used A4 paper on this side of the Atlantic.\n+%\n+% --karl, 24jan03.\n+\n \n % Set up the default fonts, so we can use them for creating boxes.\n %\n@@ -1368,7 +1484,8 @@\n \n % \\smartitalic{ARG} outputs arg in italics, followed by an italic correction\n % unless the following character is such as not to need one.\n-\\def\\smartitalicx{\\ifx\\next,\\else\\ifx\\next-\\else\\ifx\\next.\\else\\/\\fi\\fi\\fi}\n+\\def\\smartitalicx{\\ifx\\next,\\else\\ifx\\next-\\else\\ifx\\next.\\else\n+                    \\ptexslash\\fi\\fi\\fi}\n \\def\\smartslanted#1{{\\ifusingtt\\ttsl\\sl #1}\\futurelet\\next\\smartitalicx}\n \\def\\smartitalic#1{{\\ifusingtt\\ttsl\\it #1}\\futurelet\\next\\smartitalicx}\n \n@@ -1388,6 +1505,17 @@\n \\def\\nohyphenation{\\hyphenchar\\font = -1  \\aftergroup\\restorehyphenation}\n \\def\\restorehyphenation{\\hyphenchar\\font = `- }\n \n+% Set sfcode to normal for the chars that usually have another value.\n+% Can't use plain's \\frenchspacing because it uses the `\\x notation, and\n+% sometimes \\x has an active definition that messes things up.\n+%\n+\\catcode`@=11\n+  \\def\\frenchspacing{%\n+    \\sfcode\\dotChar  =\\@m \\sfcode\\questChar=\\@m \\sfcode\\exclamChar=\\@m\n+    \\sfcode\\colonChar=\\@m \\sfcode\\semiChar =\\@m \\sfcode\\commaChar =\\@m\n+  }\n+\\catcode`@=\\other\n+\n \\def\\t#1{%\n   {\\tt \\rawbackslash \\frenchspacing #1}%\n   \\null\n@@ -1487,15 +1615,17 @@\n     \\gdef\\kbdexamplefont{\\ttsl}\\gdef\\kbdfont{\\tt}%\n   \\else\\ifx\\arg\\wordcode\n     \\gdef\\kbdexamplefont{\\tt}\\gdef\\kbdfont{\\tt}%\n+  \\else\n+    \\errhelp = \\EMsimple\n+    \\errmessage{Unknown @kbdinputstyle option `\\arg'}%\n   \\fi\\fi\\fi\n }\n \\def\\worddistinct{distinct}\n \\def\\wordexample{example}\n \\def\\wordcode{code}\n \n-% Default is kbdinputdistinct.  (Too much of a hassle to call the macro,\n-% the catcodes are wrong for parsearg to work.)\n-\\gdef\\kbdexamplefont{\\ttsl}\\gdef\\kbdfont{\\ttsl}\n+% Default is `distinct.'\n+\\kbdinputstyle distinct\n \n \\def\\xkey{\\key}\n \\def\\kbdfoo#1#2#3\\par{\\def\\one{#1}\\def\\three{#3}\\def\\threex{??}%\n@@ -1538,7 +1668,7 @@\n \n % rms does not like angle brackets --karl, 17may97.\n % So now @email is just like @uref, unless we are pdf.\n-% \n+%\n %\\def\\email#1{\\angleleft{\\tt #1}\\angleright}\n \\ifpdf\n   \\def\\email#1{\\doemail#1,,\\finish}\n@@ -1583,6 +1713,16 @@\n % @pounds{} is a sterling sign.\n \\def\\pounds{{\\it\\$}}\n \n+% @registeredsymbol - R in a circle.  For now, only works in text size;\n+% we'd have to redo the font mechanism to change the \\scriptstyle and\n+% \\scriptscriptstyle font sizes to make it look right in headings.\n+% Adapted from the plain.tex definition of \\copyright.\n+%\n+\\def\\registeredsymbol{%\n+  $^{{\\ooalign{\\hfil\\raise.07ex\\hbox{$\\scriptstyle\\rm R$}\\hfil\\crcr\\Orb}}%\n+    }$%\n+}\n+\n \n \\message{page headings,}\n \n@@ -1995,23 +2135,21 @@\n   \\itemizey {#1}{\\Eitemize}\n }\n \n-\\def\\itemizey #1#2{%\n-\\aboveenvbreak %\n-\\itemmax=\\itemindent %\n-\\advance \\itemmax by -\\itemmargin %\n-\\advance \\leftskip by \\itemindent %\n-\\exdentamount=\\itemindent\n-\\parindent = 0pt %\n-\\parskip = \\smallskipamount %\n-\\ifdim \\parskip=0pt \\parskip=2pt \\fi%\n-\\def#2{\\endgraf\\afterenvbreak\\endgroup}%\n-\\def\\itemcontents{#1}%\n-\\let\\item=\\itemizeitem}\n-\n-% Set sfcode to normal for the chars that usually have another value.\n-% These are `.?!:;,'\n-\\def\\frenchspacing{\\sfcode46=1000 \\sfcode63=1000 \\sfcode33=1000\n-  \\sfcode58=1000 \\sfcode59=1000 \\sfcode44=1000 }\n+\\def\\itemizey#1#2{%\n+  \\aboveenvbreak\n+  \\itemmax=\\itemindent\n+  \\advance\\itemmax by -\\itemmargin\n+  \\advance\\leftskip by \\itemindent\n+  \\exdentamount=\\itemindent\n+  \\parindent=0pt\n+  \\parskip=\\smallskipamount\n+  \\ifdim\\parskip=0pt \\parskip=2pt \\fi\n+  \\def#2{\\endgraf\\afterenvbreak\\endgroup}%\n+  \\def\\itemcontents{#1}%\n+  % @itemize with no arg is equivalent to @itemize @bullet.\n+  \\ifx\\itemcontents\\empty\\def\\itemcontents{\\bullet}\\fi\n+  \\let\\item=\\itemizeitem\n+}\n \n % \\splitoff TOKENS\\endmark defines \\first to be the first token in\n % TOKENS, and \\rest to be the remainder.\n@@ -2234,8 +2372,8 @@\n          \\let\\go\\pickupwholefraction\n       \\else\n          \\global\\advance\\colcount by 1\n-         \\setbox0=\\hbox{#1\\unskip }% Add a normal word space as a separator;\n-                            % typically that is always in the input, anyway.\n+         \\setbox0=\\hbox{#1\\unskip\\space}% Add a normal word space as a\n+                   % separator; typically that is always in the input, anyway.\n          \\expandafter\\xdef\\csname col\\the\\colcount\\endcsname{\\the\\wd0}%\n       \\fi\n     \\fi\n@@ -2250,26 +2388,30 @@\n   \\go\n }\n \n-% This used to have \\hskip1sp.  But then the space in a template line is\n-% not enough.  That is bad.  So let's go back to just & until we\n-% encounter the problem it was intended to solve again.\n-% --karl, nathan@acm.org, 20apr99.\n-\\def\\tab{&}\n-\n % @multitable ... @end multitable definitions:\n %\n \\def\\multitable{\\parsearg\\dotable}\n \\def\\dotable#1{\\bgroup\n   \\vskip\\parskip\n-  \\let\\item\\crcr\n+  \\let\\item=\\crcrwithfootnotes\n+  % A \\tab used to include \\hskip1sp.  But then the space in a template\n+  % line is not enough.  That is bad.  So let's go back to just & until\n+  % we encounter the problem it was intended to solve again.  --karl,\n+  % nathan@acm.org, 20apr99.\n+  \\let\\tab=&%\n+  \\let\\startfootins=\\startsavedfootnote\n   \\tolerance=9500\n   \\hbadness=9500\n   \\setmultitablespacing\n   \\parskip=\\multitableparskip\n   \\parindent=\\multitableparindent\n   \\overfullrule=0pt\n   \\global\\colcount=0\n-  \\def\\Emultitable{\\global\\setpercentfalse\\cr\\egroup\\egroup}%\n+  \\def\\Emultitable{%\n+    \\global\\setpercentfalse\n+    \\crcrwithfootnotes\\crcr\n+    \\egroup\\egroup\n+  }%\n   %\n   % To parse everything between @multitable and @item:\n   \\setuptable#1 \\endsetuptable\n@@ -2358,6 +2500,25 @@\n                                       %% than skip between lines in the table.\n \\fi}\n \n+% In case a @footnote appears inside an alignment, save the footnote\n+% text to a box and make the \\insert when a row of the table is\n+% finished.  Otherwise, the insertion is lost, it never migrates to the\n+% main vertical list.  --kasal, 22jan03.\n+%\n+\\newbox\\savedfootnotes\n+%\n+% \\dotable \\let's \\startfootins to this, so that \\dofootnote will call\n+% it instead of starting the insertion right away.\n+\\def\\startsavedfootnote{%\n+  \\global\\setbox\\savedfootnotes = \\vbox\\bgroup\n+    \\unvbox\\savedfootnotes\n+}\n+\\def\\crcrwithfootnotes{%\n+  \\crcr\n+  \\ifvoid\\savedfootnotes \\else\n+    \\noalign{\\insert\\footins{\\box\\savedfootnotes}}%\n+  \\fi\n+}\n \n \\message{conditionals,}\n % Prevent errors for section commands.\n@@ -2393,50 +2554,101 @@\n % and so want to turn off most commands, in case they are used\n % incorrectly.\n %\n+% We use \\empty instead of \\relax for the @def... commands, so that \\end\n+% doesn't throw an error.  For instance:\n+% @ignore\n+% @deffn ...\n+% @end deffn\n+% @end ignore\n+%\n+% The @end deffn is going to get expanded, because we're trying to allow\n+% nested conditionals.  But we don't want to expand the actual @deffn,\n+% since it might be syntactically correct and intended to be ignored.\n+% Since \\end checks for \\relax, using \\empty does not cause an error.\n+%\n \\def\\ignoremorecommands{%\n   \\let\\defcodeindex = \\relax\n-  \\let\\defcv = \\relax\n-  \\let\\deffn = \\relax\n-  \\let\\deffnx = \\relax\n+  \\let\\defcv = \\empty\n+  \\let\\defcvx = \\empty\n+  \\let\\Edefcv = \\empty\n+  \\let\\deffn = \\empty\n+  \\let\\deffnx = \\empty\n+  \\let\\Edeffn = \\empty\n   \\let\\defindex = \\relax\n-  \\let\\defivar = \\relax\n-  \\let\\defmac = \\relax\n-  \\let\\defmethod = \\relax\n-  \\let\\defop = \\relax\n-  \\let\\defopt = \\relax\n-  \\let\\defspec = \\relax\n-  \\let\\deftp = \\relax\n-  \\let\\deftypefn = \\relax\n-  \\let\\deftypefun = \\relax\n-  \\let\\deftypeivar = \\relax\n-  \\let\\deftypeop = \\relax\n-  \\let\\deftypevar = \\relax\n-  \\let\\deftypevr = \\relax\n-  \\let\\defun = \\relax\n-  \\let\\defvar = \\relax\n-  \\let\\defvr = \\relax\n-  \\let\\ref = \\relax\n-  \\let\\xref = \\relax\n-  \\let\\printindex = \\relax\n-  \\let\\pxref = \\relax\n-  \\let\\settitle = \\relax\n-  \\let\\setchapternewpage = \\relax\n-  \\let\\setchapterstyle = \\relax\n-  \\let\\everyheading = \\relax\n+  \\let\\defivar = \\empty\n+  \\let\\defivarx = \\empty\n+  \\let\\Edefivar = \\empty\n+  \\let\\defmac = \\empty\n+  \\let\\defmacx = \\empty\n+  \\let\\Edefmac = \\empty\n+  \\let\\defmethod = \\empty\n+  \\let\\defmethodx = \\empty\n+  \\let\\Edefmethod = \\empty\n+  \\let\\defop = \\empty\n+  \\let\\defopx = \\empty\n+  \\let\\Edefop = \\empty\n+  \\let\\defopt = \\empty\n+  \\let\\defoptx = \\empty\n+  \\let\\Edefopt = \\empty\n+  \\let\\defspec = \\empty\n+  \\let\\defspecx = \\empty\n+  \\let\\Edefspec = \\empty\n+  \\let\\deftp = \\empty\n+  \\let\\deftpx = \\empty\n+  \\let\\Edeftp = \\empty\n+  \\let\\deftypefn = \\empty\n+  \\let\\deftypefnx = \\empty\n+  \\let\\Edeftypefn = \\empty\n+  \\let\\deftypefun = \\empty\n+  \\let\\deftypefunx = \\empty\n+  \\let\\Edeftypefun = \\empty\n+  \\let\\deftypeivar = \\empty\n+  \\let\\deftypeivarx = \\empty\n+  \\let\\Edeftypeivar = \\empty\n+  \\let\\deftypemethod = \\empty\n+  \\let\\deftypemethodx = \\empty\n+  \\let\\Edeftypemethod = \\empty\n+  \\let\\deftypeop = \\empty\n+  \\let\\deftypeopx = \\empty\n+  \\let\\Edeftypeop = \\empty\n+  \\let\\deftypevar = \\empty\n+  \\let\\deftypevarx = \\empty\n+  \\let\\Edeftypevar = \\empty\n+  \\let\\deftypevr = \\empty\n+  \\let\\deftypevrx = \\empty\n+  \\let\\Edeftypevr = \\empty\n+  \\let\\defun = \\empty\n+  \\let\\defunx = \\empty\n+  \\let\\Edefun = \\empty\n+  \\let\\defvar = \\empty\n+  \\let\\defvarx = \\empty\n+  \\let\\Edefvar = \\empty\n+  \\let\\defvr = \\empty\n+  \\let\\defvrx = \\empty\n+  \\let\\Edefvr = \\empty\n+  \\let\\clear = \\relax\n+  \\let\\down = \\relax\n+  \\let\\evenfooting = \\relax\n   \\let\\evenheading = \\relax\n-  \\let\\oddheading = \\relax\n   \\let\\everyfooting = \\relax\n-  \\let\\evenfooting = \\relax\n-  \\let\\oddfooting = \\relax\n+  \\let\\everyheading = \\relax\n   \\let\\headings = \\relax\n   \\let\\include = \\relax\n+  \\let\\item = \\relax\n   \\let\\lowersections = \\relax\n-  \\let\\down = \\relax\n+  \\let\\oddfooting = \\relax\n+  \\let\\oddheading = \\relax\n+  \\let\\printindex = \\relax\n+  \\let\\pxref = \\relax\n   \\let\\raisesections = \\relax\n-  \\let\\up = \\relax\n+  \\let\\ref = \\relax\n   \\let\\set = \\relax\n-  \\let\\clear = \\relax\n-  \\let\\item = \\relax\n+  \\let\\setchapternewpage = \\relax\n+  \\let\\setchapterstyle = \\relax\n+  \\let\\settitle = \\relax\n+  \\let\\up = \\relax\n+  \\let\\verbatiminclude = \\relax\n+  \\let\\xref = \\relax\n }\n \n % Ignore @ignore, @ifhtml, @ifinfo, and the like.\n@@ -2470,7 +2682,7 @@\n   \\long\\def\\doignoretext##1@end #1{\\enddoignore}%\n   %\n   % Make sure that spaces turn into tokens that match what \\doignoretext wants.\n-  \\catcode32 = 10\n+  \\catcode\\spaceChar = 10\n   %\n   % Ignore braces, too, so mismatched braces don't cause trouble.\n   \\catcode`\\{ = 9\n@@ -2535,7 +2747,7 @@\n   % command, so that nested ignore constructs work.  Thus, we put the\n   % text into a \\vbox and then do nothing with the result.  To minimize\n   % the chance of memory overflow, we follow the approach outlined on\n-  % page 401 of the TeXbook: make the current font be a dummy font.\n+  % page 401 of the TeXbook.\n   %\n   \\setbox0 = \\vbox\\bgroup\n     % Don't complain about control sequences we have declared \\outer.\n@@ -2556,8 +2768,8 @@\n     %\n     % Set the current font to be \\nullfont, a TeX primitive, and define\n     % all the font commands to also use \\nullfont.  We don't use\n-    % dummy.tfm, as suggested in the TeXbook, because not all sites\n-    % might have that installed.  Therefore, math mode will still\n+    % dummy.tfm, as suggested in the TeXbook, because some sites\n+    % might not have that installed.  Therefore, math mode will still\n     % produce output, but that should be an extremely small amount of\n     % stuff compared to the main input.\n     %\n@@ -2631,7 +2843,7 @@\n   % we're called from @code, as @code{@value{foo-bar_}}.  So \\let any\n   % such active characters to their normal equivalents.\n   \\gdef\\value{\\begingroup\n-    \\catcode`\\-=12 \\catcode`\\_=12\n+    \\catcode`\\-=\\other \\catcode`\\_=\\other\n     \\indexbreaks \\let_\\normalunderscore\n     \\valuexxx}\n }\n@@ -2640,15 +2852,17 @@\n % We have this subroutine so that we can handle at least some @value's\n % properly in indexes (we \\let\\value to this in \\indexdummies).  Ones\n % whose names contain - or _ still won't work, but we can't do anything\n-% about that.  The command has to be fully expandable, since the result\n-% winds up in the index file.  This means that if the variable's value\n-% contains other Texinfo commands, it's almost certain it will fail\n-% (although perhaps we could fix that with sufficient work to do a\n-% one-level expansion on the result, instead of complete).\n+% about that.  The command has to be fully expandable (if the variable\n+% is set), since the result winds up in the index file.  This means that\n+% if the variable's value contains other Texinfo commands, it's almost\n+% certain it will fail (although perhaps we could fix that with\n+% sufficient work to do a one-level expansion on the result, instead of\n+% complete).\n %\n \\def\\expandablevalue#1{%\n   \\expandafter\\ifx\\csname SET#1\\endcsname\\relax\n     {[No value for ``#1'']}%\n+    \\message{Variable `#1', used in @value, is not set.}%\n   \\else\n     \\csname SET#1\\endcsname\n   \\fi\n@@ -2657,13 +2871,14 @@\n % @ifset VAR ... @end ifset reads the `...' iff VAR has been defined\n % with @set.\n %\n-\\def\\ifset{\\parsearg\\ifsetxxx}\n-\\def\\ifsetxxx #1{%\n+\\def\\ifset{\\parsearg\\doifset}\n+\\def\\doifset#1{%\n   \\expandafter\\ifx\\csname SET#1\\endcsname\\relax\n-    \\expandafter\\ifsetfail\n+    \\let\\next=\\ifsetfail\n   \\else\n-    \\expandafter\\ifsetsucceed\n+    \\let\\next=\\ifsetsucceed\n   \\fi\n+  \\next\n }\n \\def\\ifsetsucceed{\\conditionalsucceed{ifset}}\n \\def\\ifsetfail{\\nestedignore{ifset}}\n@@ -2672,13 +2887,14 @@\n % @ifclear VAR ... @end ifclear reads the `...' iff VAR has never been\n % defined with @set, or has been undefined with @clear.\n %\n-\\def\\ifclear{\\parsearg\\ifclearxxx}\n-\\def\\ifclearxxx #1{%\n+\\def\\ifclear{\\parsearg\\doifclear}\n+\\def\\doifclear#1{%\n   \\expandafter\\ifx\\csname SET#1\\endcsname\\relax\n-    \\expandafter\\ifclearsucceed\n+    \\let\\next=\\ifclearsucceed\n   \\else\n-    \\expandafter\\ifclearfail\n+    \\let\\next=\\ifclearfail\n   \\fi\n+  \\next\n }\n \\def\\ifclearsucceed{\\conditionalsucceed{ifclear}}\n \\def\\ifclearfail{\\nestedignore{ifclear}}\n@@ -2697,28 +2913,13 @@\n \\defineunmatchedend{ifnotinfo}\n \\defineunmatchedend{ifnotplaintext}\n \n-% We can't just want to start a group at @iftex (etc.) and end it at\n-% @end iftex, since then @set commands inside the conditional have no\n-% effect (they'd get reverted at the end of the group).  So we must\n-% define \\Eiftex to redefine itself to be its previous value.  (We can't\n-% just define it to fail again with an ``unmatched end'' error, since\n-% the @ifset might be nested.)\n-%\n-\\def\\conditionalsucceed#1{%\n-  \\edef\\temp{%\n-    % Remember the current value of \\E#1.\n-    \\let\\nece{prevE#1} = \\nece{E#1}%\n-    %\n-    % At the `@end #1', redefine \\E#1 to be its previous value.\n-    \\def\\nece{E#1}{\\let\\nece{E#1} = \\nece{prevE#1}}%\n-  }%\n-  \\temp\n-}\n-\n-% We need to expand lots of \\csname's, but we don't want to expand the\n-% control sequences after we've constructed them.\n+% True conditional.  Since \\set globally defines its variables, we can\n+% just start and end a group (to keep the @end definition undefined at\n+% the outer level).\n %\n-\\def\\nece#1{\\expandafter\\noexpand\\csname#1\\endcsname}\n+\\def\\conditionalsucceed#1{\\begingroup\n+  \\expandafter\\def\\csname E#1\\endcsname{\\endgroup}%\n+}\n \n % @defininfoenclose.\n \\let\\definfoenclose=\\comment\n@@ -2769,10 +2970,10 @@\n \n % @synindex foo bar    makes index foo feed into index bar.\n % Do this instead of @defindex foo if you don't want it as a separate index.\n-% \n+%\n % @syncodeindex foo bar   similar, but put all entries made for index foo\n % inside @code.\n-% \n+%\n \\def\\synindex#1 #2 {\\dosynindex\\doindex{#1}{#2}}\n \\def\\syncodeindex#1 #2 {\\dosynindex\\docodeindex{#1}{#2}}\n \n@@ -2811,104 +3012,166 @@\n \\def\\docodeindex#1{\\edef\\indexname{#1}\\parsearg\\singlecodeindexer}\n \\def\\singlecodeindexer #1{\\doind{\\indexname}{\\code{#1}}}\n \n-% Take care of texinfo commands likely to appear in an index entry.\n-% (Must be a way to avoid doing expansion at all, and thus not have to\n-% laboriously list every single command here.)\n-% \n+% Take care of Texinfo commands that can appear in an index entry.\n+% Since there are some commands we want to expand, and others we don't,\n+% we have to laboriously prevent expansion for those that we don't.\n+%\n \\def\\indexdummies{%\n-\\def\\ { }%\n-\\def\\@{@}% change to @@ when we switch to @ as escape char in aux files.\n-% Need these in case \\tex is in effect and \\{ is a \\delimiter again.\n-% But can't use \\lbracecmd and \\rbracecmd because texindex assumes\n-% braces and backslashes are used only as delimiters.  \n-\\let\\{ = \\mylbrace\n-\\let\\} = \\myrbrace\n-\\def\\_{{\\realbackslash _}}%\n-\\normalturnoffactive\n-%\n-% Take care of the plain tex accent commands.\n-\\def\\,##1{\\realbackslash ,{##1}}%\n-\\def\\\"{\\realbackslash \"}%\n-\\def\\`{\\realbackslash `}%\n-\\def\\'{\\realbackslash '}%\n-\\def\\^{\\realbackslash ^}%\n-\\def\\~{\\realbackslash ~}%\n-\\def\\={\\realbackslash =}%\n-\\def\\b{\\realbackslash b}%\n-\\def\\c{\\realbackslash c}%\n-\\def\\d{\\realbackslash d}%\n-\\def\\u{\\realbackslash u}%\n-\\def\\v{\\realbackslash v}%\n-\\def\\H{\\realbackslash H}%\n-\\def\\dotless##1{\\realbackslash dotless {##1}}%\n-% Take care of the plain tex special European modified letters.\n-\\def\\AA{\\realbackslash AA}%\n-\\def\\AE{\\realbackslash AE}%\n-\\def\\L{\\realbackslash L}%\n-\\def\\OE{\\realbackslash OE}%\n-\\def\\O{\\realbackslash O}%\n-\\def\\aa{\\realbackslash aa}%\n-\\def\\ae{\\realbackslash ae}%\n-\\def\\l{\\realbackslash l}%\n-\\def\\oe{\\realbackslash oe}%\n-\\def\\o{\\realbackslash o}%\n-\\def\\ss{\\realbackslash ss}%\n-%\n-% Although these internals commands shouldn't show up, sometimes they do.\n-\\def\\bf{\\realbackslash bf }%\n-\\def\\gtr{\\realbackslash gtr}%\n-\\def\\hat{\\realbackslash hat}%\n-\\def\\less{\\realbackslash less}%\n-%\\def\\rm{\\realbackslash rm }%\n-\\def\\sf{\\realbackslash sf}%\n-\\def\\sl{\\realbackslash sl }%\n-\\def\\tclose##1{\\realbackslash tclose {##1}}%\n-\\def\\tt{\\realbackslash tt}%\n-%\n-\\def\\b##1{\\realbackslash b {##1}}%\n-\\def\\i##1{\\realbackslash i {##1}}%\n-\\def\\sc##1{\\realbackslash sc {##1}}%\n-\\def\\t##1{\\realbackslash t {##1}}%\n-\\def\\r##1{\\realbackslash r {##1}}%\n-%\n-\\def\\TeX{\\realbackslash TeX}%\n-\\def\\acronym##1{\\realbackslash acronym {##1}}%\n-\\def\\cite##1{\\realbackslash cite {##1}}%\n-\\def\\code##1{\\realbackslash code {##1}}%\n-\\def\\command##1{\\realbackslash command {##1}}%\n-\\def\\dfn##1{\\realbackslash dfn {##1}}%\n-\\def\\dots{\\realbackslash dots }%\n-\\def\\emph##1{\\realbackslash emph {##1}}%\n-\\def\\env##1{\\realbackslash env {##1}}%\n-\\def\\file##1{\\realbackslash file {##1}}%\n-\\def\\kbd##1{\\realbackslash kbd {##1}}%\n-\\def\\key##1{\\realbackslash key {##1}}%\n-\\def\\math##1{\\realbackslash math {##1}}%\n-\\def\\option##1{\\realbackslash option {##1}}%\n-\\def\\samp##1{\\realbackslash samp {##1}}%\n-\\def\\strong##1{\\realbackslash strong {##1}}%\n-\\def\\uref##1{\\realbackslash uref {##1}}%\n-\\def\\url##1{\\realbackslash url {##1}}%\n-\\def\\var##1{\\realbackslash var {##1}}%\n-\\def\\w{\\realbackslash w }%\n-%\n-% These math commands don't seem likely to be used in index entries.\n-\\def\\copyright{\\realbackslash copyright}%\n-\\def\\equiv{\\realbackslash equiv}%\n-\\def\\error{\\realbackslash error}%\n-\\def\\expansion{\\realbackslash expansion}%\n-\\def\\point{\\realbackslash point}%\n-\\def\\print{\\realbackslash print}%\n-\\def\\result{\\realbackslash result}%\n-%\n-% Handle some cases of @value -- where the variable name does not\n-% contain - or _, and the value does not contain any\n-% (non-fully-expandable) commands.\n-\\let\\value = \\expandablevalue\n-%\n-\\unsepspaces\n-% Turn off macro expansion\n-\\turnoffmacros\n+  \\def\\@{@}% change to @@ when we switch to @ as escape char in index files.\n+  \\def\\ {\\realbackslash\\space }%\n+  % Need these in case \\tex is in effect and \\{ is a \\delimiter again.\n+  % But can't use \\lbracecmd and \\rbracecmd because texindex assumes\n+  % braces and backslashes are used only as delimiters.\n+  \\let\\{ = \\mylbrace\n+  \\let\\} = \\myrbrace\n+  %\n+  % \\definedummyword defines \\#1 as \\realbackslash #1\\space, thus\n+  % effectively preventing its expansion.  This is used only for control\n+  % words, not control letters, because the \\space would be incorrect\n+  % for control characters, but is needed to separate the control word\n+  % from whatever follows.\n+  %\n+  % For control letters, we have \\definedummyletter, which omits the\n+  % space.\n+  %\n+  % These can be used both for control words that take an argument and\n+  % those that do not.  If it is followed by {arg} in the input, then\n+  % that will dutifully get written to the index (or wherever).\n+  %\n+  \\def\\definedummyword##1{%\n+    \\expandafter\\def\\csname ##1\\endcsname{\\realbackslash ##1\\space}%\n+  }%\n+  \\def\\definedummyletter##1{%\n+    \\expandafter\\def\\csname ##1\\endcsname{\\realbackslash ##1}%\n+  }%\n+  %\n+  % Do the redefinitions.\n+  \\commondummies\n+}\n+\n+% For the aux file, @ is the escape character.  So we want to redefine\n+% everything using @ instead of \\realbackslash.  When everything uses\n+% @, this will be simpler.\n+%\n+\\def\\atdummies{%\n+  \\def\\@{@@}%\n+  \\def\\ {@ }%\n+  \\let\\{ = \\lbraceatcmd\n+  \\let\\} = \\rbraceatcmd\n+  %\n+  % (See comments in \\indexdummies.)\n+  \\def\\definedummyword##1{%\n+    \\expandafter\\def\\csname ##1\\endcsname{@##1\\space}%\n+  }%\n+  \\def\\definedummyletter##1{%\n+    \\expandafter\\def\\csname ##1\\endcsname{@##1}%\n+  }%\n+  %\n+  % Do the redefinitions.\n+  \\commondummies\n+}\n+\n+% Called from \\indexdummies and \\atdummies.  \\definedummyword and\n+% \\definedummyletter must be defined first.\n+%\n+\\def\\commondummies{%\n+  %\n+  \\normalturnoffactive\n+  %\n+  % Control letters and accents.\n+  \\definedummyletter{_}%\n+  \\definedummyletter{,}%\n+  \\definedummyletter{\"}%\n+  \\definedummyletter{`}%\n+  \\definedummyletter{'}%\n+  \\definedummyletter{^}%\n+  \\definedummyletter{~}%\n+  \\definedummyletter{=}%\n+  \\definedummyword{u}%\n+  \\definedummyword{v}%\n+  \\definedummyword{H}%\n+  \\definedummyword{dotaccent}%\n+  \\definedummyword{ringaccent}%\n+  \\definedummyword{tieaccent}%\n+  \\definedummyword{ubaraccent}%\n+  \\definedummyword{udotaccent}%\n+  \\definedummyword{dotless}%\n+  %\n+  % Other non-English letters.\n+  \\definedummyword{AA}%\n+  \\definedummyword{AE}%\n+  \\definedummyword{L}%\n+  \\definedummyword{OE}%\n+  \\definedummyword{O}%\n+  \\definedummyword{aa}%\n+  \\definedummyword{ae}%\n+  \\definedummyword{l}%\n+  \\definedummyword{oe}%\n+  \\definedummyword{o}%\n+  \\definedummyword{ss}%\n+  %\n+  % Although these internal commands shouldn't show up, sometimes they do.\n+  \\definedummyword{bf}%\n+  \\definedummyword{gtr}%\n+  \\definedummyword{hat}%\n+  \\definedummyword{less}%\n+  \\definedummyword{sf}%\n+  \\definedummyword{sl}%\n+  \\definedummyword{tclose}%\n+  \\definedummyword{tt}%\n+  %\n+  % Texinfo font commands.\n+  \\definedummyword{b}%\n+  \\definedummyword{i}%\n+  \\definedummyword{r}%\n+  \\definedummyword{sc}%\n+  \\definedummyword{t}%\n+  %\n+  \\definedummyword{TeX}%\n+  \\definedummyword{acronym}%\n+  \\definedummyword{cite}%\n+  \\definedummyword{code}%\n+  \\definedummyword{command}%\n+  \\definedummyword{dfn}%\n+  \\definedummyword{dots}%\n+  \\definedummyword{emph}%\n+  \\definedummyword{env}%\n+  \\definedummyword{file}%\n+  \\definedummyword{kbd}%\n+  \\definedummyword{key}%\n+  \\definedummyword{math}%\n+  \\definedummyword{option}%\n+  \\definedummyword{samp}%\n+  \\definedummyword{strong}%\n+  \\definedummyword{uref}%\n+  \\definedummyword{url}%\n+  \\definedummyword{var}%\n+  \\definedummyword{w}%\n+  %\n+  % Assorted special characters.\n+  \\definedummyword{bullet}%\n+  \\definedummyword{copyright}%\n+  \\definedummyword{dots}%\n+  \\definedummyword{enddots}%\n+  \\definedummyword{equiv}%\n+  \\definedummyword{error}%\n+  \\definedummyword{expansion}%\n+  \\definedummyword{minus}%\n+  \\definedummyword{pounds}%\n+  \\definedummyword{point}%\n+  \\definedummyword{print}%\n+  \\definedummyword{result}%\n+  %\n+  % Handle some cases of @value -- where the variable name does not\n+  % contain - or _, and the value does not contain any\n+  % (non-fully-expandable) commands.\n+  \\let\\value = \\expandablevalue\n+  %\n+  % Normal spaces, not active ones.\n+  \\unsepspaces\n+  %\n+  % No macro expansion.\n+  \\turnoffmacros\n }\n \n % If an index command is used in an @example environment, any spaces\n@@ -2917,83 +3180,86 @@\n {\\obeyspaces\n  \\gdef\\unsepspaces{\\obeyspaces\\let =\\space}}\n \n-% \\indexnofonts no-ops all font-change commands.\n-% This is used when outputting the strings to sort the index by.\n-\\def\\indexdummyfont#1{#1}\n+\n+% \\indexnofonts is used when outputting the strings to sort the index\n+% by, and when constructing control sequence names.  It eliminates all\n+% control sequences and just writes whatever the best ASCII sort string\n+% would be for a given command (usually its argument).\n+%\n \\def\\indexdummytex{TeX}\n \\def\\indexdummydots{...}\n-\n+%\n \\def\\indexnofonts{%\n-\\def\\@{@}%\n-% how to handle braces?\n-\\def\\_{\\normalunderscore}%\n-%\n-\\let\\,=\\indexdummyfont\n-\\let\\\"=\\indexdummyfont\n-\\let\\`=\\indexdummyfont\n-\\let\\'=\\indexdummyfont\n-\\let\\^=\\indexdummyfont\n-\\let\\~=\\indexdummyfont\n-\\let\\==\\indexdummyfont\n-\\let\\b=\\indexdummyfont\n-\\let\\c=\\indexdummyfont\n-\\let\\d=\\indexdummyfont\n-\\let\\u=\\indexdummyfont\n-\\let\\v=\\indexdummyfont\n-\\let\\H=\\indexdummyfont\n-\\let\\dotless=\\indexdummyfont\n-% Take care of the plain tex special European modified letters.\n-\\def\\AA{AA}%\n-\\def\\AE{AE}%\n-\\def\\L{L}%\n-\\def\\OE{OE}%\n-\\def\\O{O}%\n-\\def\\aa{aa}%\n-\\def\\ae{ae}%\n-\\def\\l{l}%\n-\\def\\oe{oe}%\n-\\def\\o{o}%\n-\\def\\ss{ss}%\n-%\n-% Don't no-op \\tt, since it isn't a user-level command\n-% and is used in the definitions of the active chars like <, >, |, etc.\n-% Likewise with the other plain tex font commands.\n-%\\let\\tt=\\indexdummyfont\n-%\n-\\let\\b=\\indexdummyfont\n-\\let\\i=\\indexdummyfont\n-\\let\\r=\\indexdummyfont\n-\\let\\sc=\\indexdummyfont\n-\\let\\t=\\indexdummyfont\n-%\n-\\let\\TeX=\\indexdummytex\n-\\let\\acronym=\\indexdummyfont\n-\\let\\cite=\\indexdummyfont\n-\\let\\code=\\indexdummyfont\n-\\let\\command=\\indexdummyfont\n-\\let\\dfn=\\indexdummyfont\n-\\let\\dots=\\indexdummydots\n-\\let\\emph=\\indexdummyfont\n-\\let\\env=\\indexdummyfont\n-\\let\\file=\\indexdummyfont\n-\\let\\kbd=\\indexdummyfont\n-\\let\\key=\\indexdummyfont\n-\\let\\math=\\indexdummyfont\n-\\let\\option=\\indexdummyfont\n-\\let\\samp=\\indexdummyfont\n-\\let\\strong=\\indexdummyfont\n-\\let\\uref=\\indexdummyfont\n-\\let\\url=\\indexdummyfont\n-\\let\\var=\\indexdummyfont\n-\\let\\w=\\indexdummyfont\n-}\n-\n-% To define \\realbackslash, we must make \\ not be an escape.\n-% We must first make another character (@) an escape\n-% so we do not become unable to do a definition.\n-\n-{\\catcode`\\@=0 \\catcode`\\\\=\\other\n- @gdef@realbackslash{\\}}\n+  \\def\\ { }%\n+  \\def\\@{@}%\n+  % how to handle braces?\n+  \\def\\_{\\normalunderscore}%\n+  %\n+  \\let\\,=\\asis\n+  \\let\\\"=\\asis\n+  \\let\\`=\\asis\n+  \\let\\'=\\asis\n+  \\let\\^=\\asis\n+  \\let\\~=\\asis\n+  \\let\\==\\asis\n+  \\let\\u=\\asis\n+  \\let\\v=\\asis\n+  \\let\\H=\\asis\n+  \\let\\dotaccent=\\asis\n+  \\let\\ringaccent=\\asis\n+  \\let\\tieaccent=\\asis\n+  \\let\\ubaraccent=\\asis\n+  \\let\\udotaccent=\\asis\n+  \\let\\dotless=\\asis\n+  %\n+  % Other non-English letters.\n+  \\def\\AA{AA}%\n+  \\def\\AE{AE}%\n+  \\def\\L{L}%\n+  \\def\\OE{OE}%\n+  \\def\\O{O}%\n+  \\def\\aa{aa}%\n+  \\def\\ae{ae}%\n+  \\def\\l{l}%\n+  \\def\\oe{oe}%\n+  \\def\\o{o}%\n+  \\def\\ss{ss}%\n+  \\def\\exclamdown{!}%\n+  \\def\\questiondown{?}%\n+  %\n+  % Don't no-op \\tt, since it isn't a user-level command\n+  % and is used in the definitions of the active chars like <, >, |, etc.\n+  % Likewise with the other plain tex font commands.\n+  %\\let\\tt=\\asis\n+  %\n+  % Texinfo font commands.\n+  \\let\\b=\\asis\n+  \\let\\i=\\asis\n+  \\let\\r=\\asis\n+  \\let\\sc=\\asis\n+  \\let\\t=\\asis\n+  %\n+  \\let\\TeX=\\indexdummytex\n+  \\let\\acronym=\\asis\n+  \\let\\cite=\\asis\n+  \\let\\code=\\asis\n+  \\let\\command=\\asis\n+  \\let\\dfn=\\asis\n+  \\let\\dots=\\indexdummydots\n+  \\let\\emph=\\asis\n+  \\let\\env=\\asis\n+  \\let\\file=\\asis\n+  \\let\\kbd=\\asis\n+  \\let\\key=\\asis\n+  \\let\\math=\\asis\n+  \\let\\option=\\asis\n+  \\let\\samp=\\asis\n+  \\let\\strong=\\asis\n+  \\let\\uref=\\asis\n+  \\let\\url=\\asis\n+  \\let\\var=\\asis\n+  \\let\\w=\\asis\n+}\n \n \\let\\indexbackslash=0  %overridden during \\printindex.\n \\let\\SETmarginindex=\\relax % put index entries in margin (undocumented)?\n@@ -3025,28 +3291,24 @@\n         \\def\\rawbackslashxx{\\indexbackslash}% \\indexbackslash isn't defined now\n         % so it will be output as is; and it will print as backslash.\n         %\n-        \\def\\thirdarg{#3}%\n-        %\n-        % If third arg is present, precede it with space in sort key.\n-        \\ifx\\thirdarg\\emptymacro\n-          \\let\\subentry = \\empty\n-        \\else\n-          \\def\\subentry{ #3}%\n-        \\fi\n-        %\n-        % First process the index entry with all font commands turned\n-        % off to get the string to sort by.\n-        {\\indexnofonts \\xdef\\indexsorttmp{#2\\subentry}}%\n-        %\n-        % Now the real index entry with the fonts.\n+        % The main index entry text.\n         \\toks0 = {#2}%\n         %\n-        % If the third (subentry) arg is present, add it to the index\n-        % line to write.\n+        % If third arg is present, precede it with space in sort key.\n+        \\def\\thirdarg{#3}%\n         \\ifx\\thirdarg\\emptymacro \\else\n-          \\toks0 = \\expandafter{\\the\\toks0{#3}}%\n+           % If the third (subentry) arg is present, add it to the index\n+           % line to write.\n+          \\toks0 = \\expandafter{\\the\\toks0 \\space #3}%\n         \\fi\n         %\n+        % Process the index entry with all font commands turned off, to\n+        % get the string to sort by.\n+        {\\indexnofonts\n+         \\edef\\temp{\\the\\toks0}% need full expansion\n+         \\xdef\\indexsorttmp{\\temp}%\n+        }%\n+        %\n         % Set up the complete index entry, with both the sort key and\n         % the original text, including any font commands.  We write\n         % three arguments to \\entry to the .?? file (four in the\n@@ -3077,12 +3339,11 @@\n         \\iflinks\n           \\ifvmode\n             \\skip0 = \\lastskip\n-            \\ifdim\\lastskip = 0pt \\else \\nobreak\\vskip-\\lastskip \\fi\n+            \\ifdim\\lastskip = 0pt \\else \\nobreak\\vskip-\\skip0 \\fi\n           \\fi\n           %\n           \\temp % do the write\n           %\n-          %\n           \\ifvmode \\ifdim\\skip0 = 0pt \\else \\nobreak\\vskip\\skip0 \\fi \\fi\n         \\fi\n       }%\n@@ -3132,6 +3393,7 @@\n   %\n   \\smallfonts \\rm\n   \\tolerance = 9500\n+  \\everypar = {}% don't want the \\kern\\-parindent from indentation suppression.\n   \\indexbreaks\n   %\n   % See if the index file exists and is nonempty.\n@@ -3375,7 +3637,7 @@\n   \\wd0=\\hsize \\wd2=\\hsize\n   \\hbox to\\pagewidth{\\box0\\hfil\\box2}%\n }\n-% \n+%\n % All done with double columns.\n \\def\\enddoublecolumns{%\n   \\output = {%\n@@ -3513,6 +3775,7 @@\n     \\numberedsubsubseczzz{#2}\n   \\fi\n \\fi\n+\\suppressfirstparagraphindent\n }\n \n % like \\numhead, but chooses appendix heading levels\n@@ -3532,6 +3795,7 @@\n     \\appendixsubsubseczzz{#2}\n   \\fi\n \\fi\n+\\suppressfirstparagraphindent\n }\n \n % like \\numhead, but chooses numberless heading levels\n@@ -3551,29 +3815,27 @@\n     \\unnumberedsubsubseczzz{#2}\n   \\fi\n \\fi\n+\\suppressfirstparagraphindent\n }\n \n % @chapter, @appendix, @unnumbered.\n \\def\\thischaptername{No Chapter Title}\n \\outer\\def\\chapter{\\parsearg\\chapteryyy}\n \\def\\chapteryyy #1{\\numhead0{#1}} % normally numhead0 calls chapterzzz\n \\def\\chapterzzz #1{%\n-\\secno=0 \\subsecno=0 \\subsubsecno=0\n-\\global\\advance \\chapno by 1 \\message{\\putwordChapter\\space \\the\\chapno}%\n-\\chapmacro {#1}{\\the\\chapno}%\n-\\gdef\\thissection{#1}%\n-\\gdef\\thischaptername{#1}%\n-% We don't substitute the actual chapter name into \\thischapter\n-% because we don't want its macros evaluated now.\n-\\xdef\\thischapter{\\putwordChapter{} \\the\\chapno: \\noexpand\\thischaptername}%\n-\\toks0 = {#1}%\n-\\edef\\temp{\\noexpand\\writetocentry{\\realbackslash chapentry{\\the\\toks0}%\n-                                  {\\the\\chapno}}}%\n-\\temp\n-\\donoderef\n-\\global\\let\\section = \\numberedsec\n-\\global\\let\\subsection = \\numberedsubsec\n-\\global\\let\\subsubsection = \\numberedsubsubsec\n+  \\secno=0 \\subsecno=0 \\subsubsecno=0\n+  \\global\\advance \\chapno by 1 \\message{\\putwordChapter\\space \\the\\chapno}%\n+  \\chapmacro {#1}{\\the\\chapno}%\n+  \\gdef\\thissection{#1}%\n+  \\gdef\\thischaptername{#1}%\n+  % We don't substitute the actual chapter name into \\thischapter\n+  % because we don't want its macros evaluated now.\n+  \\xdef\\thischapter{\\putwordChapter{} \\the\\chapno: \\noexpand\\thischaptername}%\n+  \\writetocentry{chap}{#1}{{\\the\\chapno}}\n+  \\donoderef\n+  \\global\\let\\section = \\numberedsec\n+  \\global\\let\\subsection = \\numberedsubsec\n+  \\global\\let\\subsubsection = \\numberedsubsubsec\n }\n \n % we use \\chapno to avoid indenting back\n@@ -3584,21 +3846,18 @@\n \\outer\\def\\appendix{\\parsearg\\appendixyyy}\n \\def\\appendixyyy #1{\\apphead0{#1}} % normally apphead0 calls appendixzzz\n \\def\\appendixzzz #1{%\n-\\secno=0 \\subsecno=0 \\subsubsecno=0\n-\\global\\advance \\appendixno by 1\n-\\message{\\putwordAppendix\\space \\appendixletter}%\n-\\chapmacro {#1}{\\appendixbox{\\putwordAppendix{} \\appendixletter}}%\n-\\gdef\\thissection{#1}%\n-\\gdef\\thischaptername{#1}%\n-\\xdef\\thischapter{\\putwordAppendix{} \\appendixletter: \\noexpand\\thischaptername}%\n-\\toks0 = {#1}%\n-\\edef\\temp{\\noexpand\\writetocentry{\\realbackslash appendixentry{\\the\\toks0}%\n-                       {\\appendixletter}}}%\n-\\temp\n-\\appendixnoderef\n-\\global\\let\\section = \\appendixsec\n-\\global\\let\\subsection = \\appendixsubsec\n-\\global\\let\\subsubsection = \\appendixsubsubsec\n+  \\secno=0 \\subsecno=0 \\subsubsecno=0\n+  \\global\\advance \\appendixno by 1\n+  \\message{\\putwordAppendix\\space \\appendixletter}%\n+  \\chapmacro {#1}{\\appendixbox{\\putwordAppendix{} \\appendixletter}}%\n+  \\gdef\\thissection{#1}%\n+  \\gdef\\thischaptername{#1}%\n+  \\xdef\\thischapter{\\putwordAppendix{} \\appendixletter: \\noexpand\\thischaptername}%\n+  \\writetocentry{appendix}{#1}{{\\appendixletter}}\n+  \\appendixnoderef\n+  \\global\\let\\section = \\appendixsec\n+  \\global\\let\\subsection = \\appendixsubsec\n+  \\global\\let\\subsubsection = \\appendixsubsubsec\n }\n \n % @centerchap is like @unnumbered, but the heading is centered.\n@@ -3611,150 +3870,121 @@\n \\outer\\def\\unnumbered{\\parsearg\\unnumberedyyy}\n \\def\\unnumberedyyy #1{\\unnmhead0{#1}} % normally unnmhead0 calls unnumberedzzz\n \\def\\unnumberedzzz #1{%\n-\\secno=0 \\subsecno=0 \\subsubsecno=0\n-%\n-% This used to be simply \\message{#1}, but TeX fully expands the\n-% argument to \\message.  Therefore, if #1 contained @-commands, TeX\n-% expanded them.  For example, in `@unnumbered The @cite{Book}', TeX\n-% expanded @cite (which turns out to cause errors because \\cite is meant\n-% to be executed, not expanded).\n-%\n-% Anyway, we don't want the fully-expanded definition of @cite to appear\n-% as a result of the \\message, we just want `@cite' itself.  We use\n-% \\the<toks register> to achieve this: TeX expands \\the<toks> only once,\n-% simply yielding the contents of <toks register>.  (We also do this for\n-% the toc entries.)\n-\\toks0 = {#1}\\message{(\\the\\toks0)}%\n-%\n-\\unnumbchapmacro {#1}%\n-\\gdef\\thischapter{#1}\\gdef\\thissection{#1}%\n-\\toks0 = {#1}%\n-\\edef\\temp{\\noexpand\\writetocentry{\\realbackslash unnumbchapentry{\\the\\toks0}{\\the\\chapno}}}%\n-\\temp\n-\\unnumbnoderef\n-\\global\\let\\section = \\unnumberedsec\n-\\global\\let\\subsection = \\unnumberedsubsec\n-\\global\\let\\subsubsection = \\unnumberedsubsubsec\n+  \\secno=0 \\subsecno=0 \\subsubsecno=0\n+  %\n+  % This used to be simply \\message{#1}, but TeX fully expands the\n+  % argument to \\message.  Therefore, if #1 contained @-commands, TeX\n+  % expanded them.  For example, in `@unnumbered The @cite{Book}', TeX\n+  % expanded @cite (which turns out to cause errors because \\cite is meant\n+  % to be executed, not expanded).\n+  %\n+  % Anyway, we don't want the fully-expanded definition of @cite to appear\n+  % as a result of the \\message, we just want `@cite' itself.  We use\n+  % \\the<toks register> to achieve this: TeX expands \\the<toks> only once,\n+  % simply yielding the contents of <toks register>.  (We also do this for\n+  % the toc entries.)\n+  \\toks0 = {#1}\\message{(\\the\\toks0)}%\n+  %\n+  \\unnumbchapmacro {#1}%\n+  \\gdef\\thischapter{#1}\\gdef\\thissection{#1}%\n+  \\writetocentry{unnumbchap}{#1}{{\\the\\chapno}}\n+  \\unnumbnoderef\n+  \\global\\let\\section = \\unnumberedsec\n+  \\global\\let\\subsection = \\unnumberedsubsec\n+  \\global\\let\\subsubsection = \\unnumberedsubsubsec\n }\n \n % Sections.\n \\outer\\def\\numberedsec{\\parsearg\\secyyy}\n \\def\\secyyy #1{\\numhead1{#1}} % normally calls seczzz\n \\def\\seczzz #1{%\n-\\subsecno=0 \\subsubsecno=0 \\global\\advance \\secno by 1 %\n-\\gdef\\thissection{#1}\\secheading {#1}{\\the\\chapno}{\\the\\secno}%\n-\\toks0 = {#1}%\n-\\edef\\temp{\\noexpand\\writetocentry{\\realbackslash secentry{\\the\\toks0}%\n-                                  {\\the\\chapno}{\\the\\secno}}}%\n-\\temp\n-\\donoderef\n-\\nobreak\n+  \\subsecno=0 \\subsubsecno=0 \\global\\advance \\secno by 1 %\n+  \\gdef\\thissection{#1}\\secheading {#1}{\\the\\chapno}{\\the\\secno}%\n+  \\writetocentry{sec}{#1}{{\\the\\chapno}{\\the\\secno}}\n+  \\donoderef\n+  \\nobreak\n }\n \n \\outer\\def\\appendixsection{\\parsearg\\appendixsecyyy}\n \\outer\\def\\appendixsec{\\parsearg\\appendixsecyyy}\n \\def\\appendixsecyyy #1{\\apphead1{#1}} % normally calls appendixsectionzzz\n \\def\\appendixsectionzzz #1{%\n-\\subsecno=0 \\subsubsecno=0 \\global\\advance \\secno by 1 %\n-\\gdef\\thissection{#1}\\secheading {#1}{\\appendixletter}{\\the\\secno}%\n-\\toks0 = {#1}%\n-\\edef\\temp{\\noexpand\\writetocentry{\\realbackslash secentry{\\the\\toks0}%\n-                                  {\\appendixletter}{\\the\\secno}}}%\n-\\temp\n-\\appendixnoderef\n-\\nobreak\n+  \\subsecno=0 \\subsubsecno=0 \\global\\advance \\secno by 1 %\n+  \\gdef\\thissection{#1}\\secheading {#1}{\\appendixletter}{\\the\\secno}%\n+  \\writetocentry{sec}{#1}{{\\appendixletter}{\\the\\secno}}\n+  \\appendixnoderef\n+  \\nobreak\n }\n \n \\outer\\def\\unnumberedsec{\\parsearg\\unnumberedsecyyy}\n \\def\\unnumberedsecyyy #1{\\unnmhead1{#1}} % normally calls unnumberedseczzz\n \\def\\unnumberedseczzz #1{%\n-\\plainsecheading {#1}\\gdef\\thissection{#1}%\n-\\toks0 = {#1}%\n-\\edef\\temp{\\noexpand\\writetocentry{\\realbackslash unnumbsecentry%\n-  {\\the\\toks0}{\\the\\chapno}{\\the\\secno}}}%\n-\\temp\n-\\unnumbnoderef\n-\\nobreak\n+  \\plainsecheading {#1}\\gdef\\thissection{#1}%\n+  \\writetocentry{unnumbsec}{#1}{{\\the\\chapno}{\\the\\secno}}\n+  \\unnumbnoderef\n+  \\nobreak\n }\n \n % Subsections.\n \\outer\\def\\numberedsubsec{\\parsearg\\numberedsubsecyyy}\n \\def\\numberedsubsecyyy #1{\\numhead2{#1}} % normally calls numberedsubseczzz\n \\def\\numberedsubseczzz #1{%\n-\\gdef\\thissection{#1}\\subsubsecno=0 \\global\\advance \\subsecno by 1 %\n-\\subsecheading {#1}{\\the\\chapno}{\\the\\secno}{\\the\\subsecno}%\n-\\toks0 = {#1}%\n-\\edef\\temp{\\noexpand\\writetocentry{\\realbackslash subsecentry{\\the\\toks0}%\n-                                    {\\the\\chapno}{\\the\\secno}{\\the\\subsecno}}}%\n-\\temp\n-\\donoderef\n-\\nobreak\n+  \\gdef\\thissection{#1}\\subsubsecno=0 \\global\\advance \\subsecno by 1 %\n+  \\subsecheading {#1}{\\the\\chapno}{\\the\\secno}{\\the\\subsecno}%\n+  \\writetocentry{subsec}{#1}{{\\the\\chapno}{\\the\\secno}{\\the\\subsecno}}\n+  \\donoderef\n+  \\nobreak\n }\n \n \\outer\\def\\appendixsubsec{\\parsearg\\appendixsubsecyyy}\n \\def\\appendixsubsecyyy #1{\\apphead2{#1}} % normally calls appendixsubseczzz\n \\def\\appendixsubseczzz #1{%\n-\\gdef\\thissection{#1}\\subsubsecno=0 \\global\\advance \\subsecno by 1 %\n-\\subsecheading {#1}{\\appendixletter}{\\the\\secno}{\\the\\subsecno}%\n-\\toks0 = {#1}%\n-\\edef\\temp{\\noexpand\\writetocentry{\\realbackslash subsecentry{\\the\\toks0}%\n-                                {\\appendixletter}{\\the\\secno}{\\the\\subsecno}}}%\n-\\temp\n-\\appendixnoderef\n-\\nobreak\n+  \\gdef\\thissection{#1}\\subsubsecno=0 \\global\\advance \\subsecno by 1 %\n+  \\subsecheading {#1}{\\appendixletter}{\\the\\secno}{\\the\\subsecno}%\n+  \\writetocentry{subsec}{#1}{{\\appendixletter}{\\the\\secno}{\\the\\subsecno}}\n+  \\appendixnoderef\n+  \\nobreak\n }\n \n \\outer\\def\\unnumberedsubsec{\\parsearg\\unnumberedsubsecyyy}\n \\def\\unnumberedsubsecyyy #1{\\unnmhead2{#1}} %normally calls unnumberedsubseczzz\n \\def\\unnumberedsubseczzz #1{%\n-\\plainsubsecheading {#1}\\gdef\\thissection{#1}%\n-\\toks0 = {#1}%\n-\\edef\\temp{\\noexpand\\writetocentry{\\realbackslash unnumbsubsecentry%\n-  {\\the\\toks0}{\\the\\chapno}{\\the\\secno}{\\the\\subsecno}}}%\n-\\temp\n-\\unnumbnoderef\n-\\nobreak\n+  \\plainsubsecheading {#1}\\gdef\\thissection{#1}%\n+  \\writetocentry{unnumbsubsec}{#1}{{\\the\\chapno}{\\the\\secno}{\\the\\subsecno}}\n+  \\unnumbnoderef\n+  \\nobreak\n }\n \n % Subsubsections.\n \\outer\\def\\numberedsubsubsec{\\parsearg\\numberedsubsubsecyyy}\n \\def\\numberedsubsubsecyyy #1{\\numhead3{#1}} % normally numberedsubsubseczzz\n \\def\\numberedsubsubseczzz #1{%\n-\\gdef\\thissection{#1}\\global\\advance \\subsubsecno by 1 %\n-\\subsubsecheading {#1}\n-  {\\the\\chapno}{\\the\\secno}{\\the\\subsecno}{\\the\\subsubsecno}%\n-\\toks0 = {#1}%\n-\\edef\\temp{\\noexpand\\writetocentry{\\realbackslash subsubsecentry{\\the\\toks0}%\n-  {\\the\\chapno}{\\the\\secno}{\\the\\subsecno}{\\the\\subsubsecno}}}%\n-\\temp\n-\\donoderef\n-\\nobreak\n+  \\gdef\\thissection{#1}\\global\\advance \\subsubsecno by 1 %\n+  \\subsubsecheading {#1}\n+    {\\the\\chapno}{\\the\\secno}{\\the\\subsecno}{\\the\\subsubsecno}%\n+  \\writetocentry{subsubsec}{#1}{{\\the\\chapno}{\\the\\secno}{\\the\\subsecno}{\\the\\subsubsecno}}\n+  \\donoderef\n+  \\nobreak\n }\n \n \\outer\\def\\appendixsubsubsec{\\parsearg\\appendixsubsubsecyyy}\n \\def\\appendixsubsubsecyyy #1{\\apphead3{#1}} % normally appendixsubsubseczzz\n \\def\\appendixsubsubseczzz #1{%\n-\\gdef\\thissection{#1}\\global\\advance \\subsubsecno by 1 %\n-\\subsubsecheading {#1}\n-  {\\appendixletter}{\\the\\secno}{\\the\\subsecno}{\\the\\subsubsecno}%\n-\\toks0 = {#1}%\n-\\edef\\temp{\\noexpand\\writetocentry{\\realbackslash subsubsecentry{\\the\\toks0}%\n-  {\\appendixletter}{\\the\\secno}{\\the\\subsecno}{\\the\\subsubsecno}}}%\n-\\temp\n-\\appendixnoderef\n-\\nobreak\n+  \\gdef\\thissection{#1}\\global\\advance \\subsubsecno by 1 %\n+  \\subsubsecheading {#1}\n+    {\\appendixletter}{\\the\\secno}{\\the\\subsecno}{\\the\\subsubsecno}%\n+  \\writetocentry{subsubsec}{#1}{{\\appendixletter}{\\the\\secno}{\\the\\subsecno}{\\the\\subsubsecno}}\n+  \\appendixnoderef\n+  \\nobreak\n }\n \n \\outer\\def\\unnumberedsubsubsec{\\parsearg\\unnumberedsubsubsecyyy}\n \\def\\unnumberedsubsubsecyyy #1{\\unnmhead3{#1}} %normally unnumberedsubsubseczzz\n \\def\\unnumberedsubsubseczzz #1{%\n-\\plainsubsubsecheading {#1}\\gdef\\thissection{#1}%\n-\\toks0 = {#1}%\n-\\edef\\temp{\\noexpand\\writetocentry{\\realbackslash unnumbsubsubsecentry%\n-  {\\the\\toks0}{\\the\\chapno}{\\the\\secno}{\\the\\subsecno}{\\the\\subsubsecno}}}%\n-\\temp\n-\\unnumbnoderef\n-\\nobreak\n+  \\plainsubsubsecheading {#1}\\gdef\\thissection{#1}%\n+  \\writetocentry{unnumbsubsubsec}{#1}{{\\the\\chapno}{\\the\\secno}{\\the\\subsecno}{\\the\\subsubsecno}}\n+  \\unnumbnoderef\n+  \\nobreak\n }\n \n % These are variants which are not \"outer\", so they can appear in @ifinfo.\n@@ -3795,16 +4025,16 @@\n \n \\def\\majorheading{\\parsearg\\majorheadingzzz}\n \\def\\majorheadingzzz #1{%\n-{\\advance\\chapheadingskip by 10pt \\chapbreak }%\n-{\\chapfonts \\vbox{\\hyphenpenalty=10000\\tolerance=5000\n-                  \\parindent=0pt\\raggedright\n-                  \\rm #1\\hfill}}\\bigskip \\par\\penalty 200}\n+  {\\advance\\chapheadingskip by 10pt \\chapbreak }%\n+  {\\chapfonts \\vbox{\\hyphenpenalty=10000\\tolerance=5000\n+                    \\parindent=0pt\\raggedright\n+                    \\rm #1\\hfill}}\\bigskip \\par\\penalty 200}\n \n \\def\\chapheading{\\parsearg\\chapheadingzzz}\n \\def\\chapheadingzzz #1{\\chapbreak %\n-{\\chapfonts \\vbox{\\hyphenpenalty=10000\\tolerance=5000\n-                  \\parindent=0pt\\raggedright\n-                  \\rm #1\\hfill}}\\bigskip \\par\\penalty 200}\n+  {\\chapfonts \\vbox{\\hyphenpenalty=10000\\tolerance=5000\n+                    \\parindent=0pt\\raggedright\n+                    \\rm #1\\hfill}}\\bigskip \\par\\penalty 200}\n \n % @heading, @subheading, @subsubheading.\n \\def\\heading{\\parsearg\\plainsecheading}\n@@ -3952,7 +4182,7 @@\n   }%\n   % Add extra space after the heading -- either a line space or a\n   % paragraph space, whichever is more.  (Some people like to set\n-  % \\parskip to large values for some reason.)\n+  % \\parskip to large values for some reason.)  Don't allow stretch, though.\n   \\nobreak\n   \\ifdim\\parskip>\\normalbaselineskip\n     \\kern\\parskip\n@@ -3971,16 +4201,22 @@\n % Called from @chapter, etc.  We supply {\\folio} at the end of the\n % argument, which will end up as the last argument to the \\...entry macro.\n %\n-% We open the .toc file here instead of at @setfilename or any other\n-% fixed time so that @contents can be put in the document anywhere.\n+% Usage: \\writetocentry{chap}{The Name of The Game}{{\\the\\chapno}}\n+% We open the .toc file for writing here instead of at @setfilename (or\n+% any other fixed time) so that @contents can be anywhere in the document.\n %\n \\newif\\iftocfileopened\n-\\def\\writetocentry#1{%\n+\\def\\writetocentry#1#2#3{%\n   \\iftocfileopened\\else\n     \\immediate\\openout\\tocfile = \\jobname.toc\n     \\global\\tocfileopenedtrue\n   \\fi\n-  \\iflinks \\write\\tocfile{#1{\\folio}}\\fi\n+  %\n+  \\iflinks\n+    \\toks0 = {#2}%\n+    \\edef\\temp{\\write\\tocfile{\\realbackslash #1entry{\\the\\toks0}#3{\\folio}}}%\n+    \\temp\n+  \\fi\n   %\n   % Tell \\shipout to create a page destination if we're doing pdf, which\n   % will be the target of the links in the table of contents.  We can't\n@@ -4019,7 +4255,7 @@\n       \\advance\\hsize by -\\contentsrightmargin % Don't use the full line length.\n       %\n       % Roman numerals for page numbers.\n-      \\ifnum \\pageno>0 \\pageno = \\lastnegativepageno \\fi\n+      \\ifnum \\pageno>0 \\global\\pageno = \\lastnegativepageno \\fi\n }\n \n \n@@ -4036,7 +4272,7 @@\n      \\pdfmakeoutlines\n    \\endgroup\n    \\lastnegativepageno = \\pageno\n-   \\pageno = \\savepageno\n+   \\global\\pageno = \\savepageno\n }\n \n % And just the chapters.\n@@ -4068,7 +4304,7 @@\n      \\contentsalignmacro % in case @setchapternewpage odd is in effect\n    \\endgroup\n    \\lastnegativepageno = \\pageno\n-   \\pageno = \\savepageno\n+   \\global\\pageno = \\savepageno\n }\n \\let\\shortcontents = \\summarycontents\n \n@@ -4192,7 +4428,7 @@\n % @foo ... @end foo.\n \n % @point{}, @result{}, @expansion{}, @print{}, @equiv{}.\n-% \n+%\n % Since these characters are used in examples, it should be an even number of\n % \\tt widths. Each \\tt character is 1en, so two makes it 1em.\n %\n@@ -4204,7 +4440,7 @@\n \n % The @error{} command.\n % Adapted from the TeXbook's \\boxit.\n-% \n+%\n \\newbox\\errorbox\n %\n {\\tentt \\global\\dimen0 = 3em}% Width of the box.\n@@ -4232,14 +4468,14 @@\n \\def\\tex{\\begingroup\n   \\catcode `\\\\=0 \\catcode `\\{=1 \\catcode `\\}=2\n   \\catcode `\\$=3 \\catcode `\\&=4 \\catcode `\\#=6\n-  \\catcode `\\^=7 \\catcode `\\_=8 \\catcode `\\~=13 \\let~=\\tie\n+  \\catcode `\\^=7 \\catcode `\\_=8 \\catcode `\\~=\\active \\let~=\\tie\n   \\catcode `\\%=14\n-  \\catcode 43=12 % plus\n-  \\catcode`\\\"=12\n-  \\catcode`\\==12\n-  \\catcode`\\|=12\n-  \\catcode`\\<=12\n-  \\catcode`\\>=12\n+  \\catcode `\\+=\\other\n+  \\catcode `\\\"=\\other\n+  \\catcode `\\==\\other\n+  \\catcode `\\|=\\other\n+  \\catcode `\\<=\\other\n+  \\catcode `\\>=\\other\n   \\escapechar=`\\\\\n   %\n   \\let\\b=\\ptexb\n@@ -4251,9 +4487,11 @@\n   \\let\\equiv=\\ptexequiv\n   \\let\\!=\\ptexexclam\n   \\let\\i=\\ptexi\n+  \\let\\indent=\\ptexindent\n   \\let\\{=\\ptexlbrace\n   \\let\\+=\\tabalign\n   \\let\\}=\\ptexrbrace\n+  \\let\\/=\\ptexslash\n   \\let\\*=\\ptexstar\n   \\let\\t=\\ptext\n   %\n@@ -4336,7 +4574,8 @@\n %\n \\newskip\\lskip\\newskip\\rskip\n \n-\\long\\def\\cartouche{%\n+\\def\\cartouche{%\n+\\par  % can't be in the midst of a paragraph.\n \\begingroup\n         \\lskip=\\leftskip \\rskip=\\rightskip\n         \\leftskip=0pt\\rightskip=0pt %we want these *outside*.\n@@ -4421,27 +4660,16 @@\n % @example: Same as @lisp.\n \\def\\example{\\begingroup \\def\\Eexample{\\nonfillfinish\\endgroup}\\lisp}\n \n-% @small... is usually equivalent to the non-small (@smallbook\n-% redefines).  We must call \\example (or whatever) last in the\n-% definition, since it reads the return following the @example (or\n-% whatever) command.\n-%\n-% This actually allows (for example) @end display inside an\n-% @smalldisplay.  Too bad, but makeinfo will catch the error anyway.\n-%\n-\\def\\smalldisplay{\\begingroup\\def\\Esmalldisplay{\\nonfillfinish\\endgroup}\\display}\n-\\def\\smallexample{\\begingroup\\def\\Esmallexample{\\nonfillfinish\\endgroup}\\lisp}\n-\\def\\smallformat{\\begingroup\\def\\Esmallformat{\\nonfillfinish\\endgroup}\\format}\n-\\def\\smalllisp{\\begingroup\\def\\Esmalllisp{\\nonfillfinish\\endgroup}\\lisp}\n-\n-% Real @smallexample and @smalllisp (when @smallbook): use smaller fonts.\n+% @smallexample and @smalllisp: use smaller fonts.\n % Originally contributed by Pavel@xerox.\n-\\def\\smalllispx{\\begingroup\n+\\def\\smalllisp{\\begingroup\n   \\def\\Esmalllisp{\\nonfillfinish\\endgroup}%\n   \\def\\Esmallexample{\\nonfillfinish\\endgroup}%\n   \\smallexamplefonts\n   \\lisp\n }\n+\\let\\smallexample = \\smalllisp\n+\n \n % @display: same as @lisp except keep current font.\n %\n@@ -4451,9 +4679,9 @@\n   \\gobble\n }\n %\n-% @smalldisplay (when @smallbook): @display plus smaller fonts.\n+% @smalldisplay: @display plus smaller fonts.\n %\n-\\def\\smalldisplayx{\\begingroup\n+\\def\\smalldisplay{\\begingroup\n   \\def\\Esmalldisplay{\\nonfillfinish\\endgroup}%\n   \\smallexamplefonts \\rm\n   \\display\n@@ -4468,9 +4696,9 @@\n   \\gobble\n }\n %\n-% @smallformat (when @smallbook): @format plus smaller fonts.\n+% @smallformat: @format plus smaller fonts.\n %\n-\\def\\smallformatx{\\begingroup\n+\\def\\smallformat{\\begingroup\n   \\def\\Esmallformat{\\nonfillfinish\\endgroup}%\n   \\smallexamplefonts \\rm\n   \\format\n@@ -4513,7 +4741,7 @@\n \n \n % LaTeX-like @verbatim...@end verbatim and @verb{<char>...<char>}\n-% If we want to allow any <char> as delimiter, \n+% If we want to allow any <char> as delimiter,\n % we need the curly braces so that makeinfo sees the @verb command, eg:\n % `@verbx...x' would look like the '@verbx' command.  --janneke@gnu.org\n %\n@@ -4591,8 +4819,8 @@\n   \\everypar{\\starttabbox}%\n }\n \n-% Do the @verb magic: verbatim text is quoted by unique \n-% delimiter characters.  Before first delimiter expect a \n+% Do the @verb magic: verbatim text is quoted by unique\n+% delimiter characters.  Before first delimiter expect a\n % right brace, after last delimiter expect closing brace:\n %\n %    \\def\\doverb'{'<char>#1<char>'}'{#1}\n@@ -4611,7 +4839,7 @@\n %\n %     \\def\\doverbatim#1@end verbatim{#1}\n %\n-% For Texinfo it's a lot easier than for LaTeX, \n+% For Texinfo it's a lot easier than for LaTeX,\n % because texinfo's \\verbatim doesn't stop at '\\end{verbatim}':\n % we need not redefine '\\', '{' and '}'.\n %\n@@ -4646,14 +4874,14 @@\n % Allow normal characters that we make active in the argument (a file name).\n \\def\\verbatiminclude{%\n   \\begingroup\n-    \\catcode`\\\\=12\n-    \\catcode`~=12\n-    \\catcode`^=12\n-    \\catcode`_=12\n-    \\catcode`|=12\n-    \\catcode`<=12\n-    \\catcode`>=12\n-    \\catcode`+=12\n+    \\catcode`\\\\=\\other\n+    \\catcode`~=\\other\n+    \\catcode`^=\\other\n+    \\catcode`_=\\other\n+    \\catcode`|=\\other\n+    \\catcode`<=\\other\n+    \\catcode`>=\\other\n+    \\catcode`+=\\other\n     \\parsearg\\doverbatiminclude\n }\n \\def\\setupverbatiminclude{%\n@@ -4667,22 +4895,25 @@\n      % Restore active chars for included file.\n   \\endgroup\n   \\begingroup\n-  \\def\\thisfile{#1}%\n-  \\expandafter\\expandafter\\setupverbatiminclude\\input\\thisfile\n-  \\endgroup\\nonfillfinish\\endgroup\n+    \\let\\value=\\expandablevalue\n+    \\def\\thisfile{#1}%\n+    \\expandafter\\expandafter\\setupverbatiminclude\\input\\thisfile\n+  \\endgroup\n+  \\nonfillfinish\n+  \\endgroup\n }\n \n % @copying ... @end copying.\n % Save the text away for @insertcopying later.  Many commands won't be\n % allowed in this context, but that's ok.\n-% \n+%\n % We save the uninterpreted tokens, rather than creating a box.\n % Saving the text in a box would be much easier, but then all the\n % typesetting commands (@smallbook, font changes, etc.) have to be done\n % beforehand -- and a) we want @copying to be done first in the source\n % file; b) letting users define the frontmatter in as flexible order as\n % possible is very desirable.\n-% \n+%\n \\def\\copying{\\begingroup\n   % Define a command to swallow text until we reach `@end copying'.\n   % \\ is the escape char in this texinfo.tex file, so it is the\n@@ -4705,15 +4936,15 @@\n % end-of-line to be a \\par, as would happen with the normal active\n % definition of ^^M.  On the third hand, two ^^M's in a row should still\n % generate a \\par.\n-% \n+%\n % Our approach is to make ^^M insert a space and a penalty1 normally;\n % then it can also check if \\lastpenalty=1.  If it does, then manually\n % do \\par.\n-% \n+%\n % This messes up the normal definitions of @c[omment], so we redefine\n % it.  Similarly for @ignore.  (These commands are used in the gcc\n % manual for man page generation.)\n-% \n+%\n % Seems pretty fragile, most line-oriented commands will presumably\n % fail, but for the limited use of getting the copying text (which\n % should be quite simple) inserted, we can hope it's ok.\n@@ -4754,7 +4985,7 @@\n \\newcount\\parencount\n \n % We want ()&[] to print specially on the defun line.\n-% \n+%\n \\def\\activeparens{%\n   \\catcode`\\(=\\active \\catcode`\\)=\\active\n   \\catcode`\\&=\\active\n@@ -4806,7 +5037,7 @@\n \n % Active &'s sneak into the index arguments, so make sure it's defined.\n {\n-  \\catcode`& = 13\n+  \\catcode`& = \\active\n   \\global\\let& = \\ampnr\n }\n \n@@ -4857,14 +5088,17 @@\n % #1 is the \\E... control sequence to end the definition (which we define).\n % #2 is the \\...x control sequence (which our caller defines).\n % #3 is the control sequence to process the header, such as \\defunheader.\n-% \n+%\n \\def\\parsebodycommon#1#2#3{%\n   \\begingroup\\inENV\n   % If there are two @def commands in a row, we'll have a \\nobreak,\n   % which is there to keep the function description together with its\n   % header.  But if there's nothing but headers, we want to allow a\n-  % break after all.\n-  \\ifnum\\lastpenalty=10000 \\penalty0 \\fi\n+  % break after all.  Check for penalty 10002 (inserted by\n+  % \\defargscommonending) instead of 10000, since the sectioning\n+  % commands insert a \\penalty10000, and we don't want to allow a break\n+  % between a section heading and a defun.\n+  \\ifnum\\lastpenalty=10002 \\penalty0 \\fi\n   \\medbreak\n   %\n   % Define the \\E... end token that this defining construct specifies\n@@ -4877,7 +5111,7 @@\n }\n \n % Common part of the \\...x definitions.\n-% \n+%\n \\def\\defxbodycommon{%\n   % As with \\parsebodycommon above, allow line break if we have multiple\n   % x headers in a row.  It's not a great place, though.\n@@ -4891,7 +5125,7 @@\n \\def\\defparsebody#1#2#3{%\n   \\parsebodycommon{#1}{#2}{#3}%\n   \\def#2{\\defxbodycommon \\activeparens \\spacesplit#3}%\n-  \\catcode61=\\active % 61 is `='\n+  \\catcode\\equalChar=\\active\n   \\begingroup\\obeylines\\activeparens\n   \\spacesplit#3%\n }\n@@ -4928,7 +5162,7 @@\n % to account for this both in the \\...x definition and in parsing the\n % input at hand.  Thus also need a control sequence (passed as #5) for\n % the \\E... definition to assign the category name to.\n-% \n+%\n \\def\\deftypeopparsebody#1#2#3#4#5 #6 {%\n   \\parsebodycommon{#1}{#2}{#3}%\n   \\def#2##1 ##2 ##3 {\\def#4{##1}%\n@@ -4953,7 +5187,7 @@\n \\def\\defvarparsebody #1#2#3{%\n   \\parsebodycommon{#1}{#2}{#3}%\n   \\def#2{\\defxbodycommon \\spacesplit#3}%\n-  \\catcode61=\\active %\n+  \\catcode\\equalChar=\\active\n   \\begingroup\\obeylines\n   \\spacesplit#3%\n }\n@@ -5022,9 +5256,18 @@\n \n % Define @defun.\n \n-% First, define the processing that is wanted for arguments of \\defun\n-% Use this to expand the args and terminate the paragraph they make up\n+% This is called to end the arguments processing for all the @def... commands.\n+%\n+\\def\\defargscommonending{%\n+  \\interlinepenalty = 10000\n+  \\advance\\rightskip by 0pt plus 1fil\n+  \\endgraf\n+  \\nobreak\\vskip -\\parskip\n+  \\penalty 10002  % signal to \\parsebodycommon.\n+}\n \n+% This expands the args and terminates the paragraph they comprise.\n+%\n \\def\\defunargs#1{\\functionparens \\sl\n % Expand, preventing hyphenation at `-' chars.\n % Note that groups don't affect changes in \\hyphenchar.\n@@ -5033,9 +5276,7 @@\n #1%\n {\\tensl\\hyphenchar\\font=45}%\n \\ifnum\\parencount=0 \\else \\errmessage{Unbalanced parentheses in @def}\\fi%\n-\\interlinepenalty=10000\n-\\advance\\rightskip by 0pt plus 1fil\n-\\endgraf\\nobreak\\vskip -\\parskip\\nobreak\n+  \\defargscommonending\n }\n \n \\def\\deftypefunargs #1{%\n@@ -5044,9 +5285,7 @@\n % Use \\boldbraxnoamp, not \\functionparens, so that & is not special.\n \\boldbraxnoamp\n \\tclose{#1}% avoid \\code because of side effects on active chars\n-\\interlinepenalty=10000\n-\\advance\\rightskip by 0pt plus 1fil\n-\\endgraf\\nobreak\\vskip -\\parskip\\nobreak\n+  \\defargscommonending\n }\n \n % Do complete processing of one @defun or @defunx line already parsed.\n@@ -5057,7 +5296,7 @@\n \n \\def\\deffnheader #1#2#3{\\doind {fn}{\\code{#2}}%\n \\begingroup\\defname {#2}{#1}\\defunargs{#3}\\endgroup %\n-\\catcode 61=\\other % Turn off change made in \\defparsebody\n+\\catcode\\equalChar=\\other % Turn off change made in \\defparsebody\n }\n \n % @defun == @deffn Function\n@@ -5067,7 +5306,7 @@\n \\def\\defunheader #1#2{\\doind {fn}{\\code{#1}}% Make entry in function index\n \\begingroup\\defname {#1}{\\putwordDeffunc}%\n \\defunargs {#2}\\endgroup %\n-\\catcode 61=\\other % Turn off change made in \\defparsebody\n+\\catcode\\equalChar=\\other % Turn off change made in \\defparsebody\n }\n \n % @deftypefun int foobar (int @var{foo}, float @var{bar})\n@@ -5081,7 +5320,7 @@\n \\doind {fn}{\\code{#2}}% Make entry in function index\n \\begingroup\\defname {\\defheaderxcond#1\\relax$.$#2}{\\putwordDeftypefun}%\n \\deftypefunargs {#3}\\endgroup %\n-\\catcode 61=\\other % Turn off change made in \\defparsebody\n+\\catcode\\equalChar=\\other % Turn off change made in \\defparsebody\n }\n \n % @deftypefn {Library Function} int foobar (int @var{foo}, float @var{bar})\n@@ -5102,7 +5341,7 @@\n %               at least some C++ text from working\n \\defname {\\defheaderxcond#2\\relax$.$#3}{#1}%\n \\deftypefunargs {#4}\\endgroup %\n-\\catcode 61=\\other % Turn off change made in \\defparsebody\n+\\catcode\\equalChar=\\other % Turn off change made in \\defparsebody\n }\n \n % @defmac == @deffn Macro\n@@ -5112,7 +5351,7 @@\n \\def\\defmacheader #1#2{\\doind {fn}{\\code{#1}}% Make entry in function index\n \\begingroup\\defname {#1}{\\putwordDefmac}%\n \\defunargs {#2}\\endgroup %\n-\\catcode 61=\\other % Turn off change made in \\defparsebody\n+\\catcode\\equalChar=\\other % Turn off change made in \\defparsebody\n }\n \n % @defspec == @deffn Special Form\n@@ -5122,7 +5361,7 @@\n \\def\\defspecheader #1#2{\\doind {fn}{\\code{#1}}% Make entry in function index\n \\begingroup\\defname {#1}{\\putwordDefspec}%\n \\defunargs {#2}\\endgroup %\n-\\catcode 61=\\other % Turn off change made in \\defparsebody\n+\\catcode\\equalChar=\\other % Turn off change made in \\defparsebody\n }\n \n % @defop CATEGORY CLASS OPERATION ARG...\n@@ -5131,9 +5370,11 @@\n \\defopparsebody\\Edefop\\defopx\\defopheader\\defoptype}\n %\n \\def\\defopheader#1#2#3{%\n-\\dosubind {fn}{\\code{#2}}{\\putwordon\\ #1}% Make entry in function index\n-\\begingroup\\defname {#2}{\\defoptype\\ \\putwordon\\ #1}%\n-\\defunargs {#3}\\endgroup %\n+  \\dosubind{fn}{\\code{#2}}{\\putwordon\\ \\code{#1}}% function index entry\n+  \\begingroup\n+    \\defname{#2}{\\defoptype\\ \\putwordon\\ #1}%\n+    \\defunargs{#3}%\n+  \\endgroup\n }\n \n % @deftypeop CATEGORY CLASS TYPE OPERATION ARG...\n@@ -5200,17 +5441,19 @@\n \\defopvarparsebody\\Edefcv\\defcvx\\defcvarheader\\defcvtype}\n \n \\def\\defcvarheader #1#2#3{%\n-\\dosubind {vr}{\\code{#2}}{\\putwordof\\ #1}% Make entry in var index\n-\\begingroup\\defname {#2}{\\defcvtype\\ \\putwordof\\ #1}%\n-\\defvarargs {#3}\\endgroup %\n+  \\dosubind{vr}{\\code{#2}}{\\putwordof\\ \\code{#1}}% variable index entry\n+  \\begingroup\n+    \\defname{#2}{\\defcvtype\\ \\putwordof\\ #1}%\n+    \\defvarargs{#3}%\n+  \\endgroup\n }\n \n % @defivar CLASS VARNAME == @defcv {Instance Variable} CLASS VARNAME\n %\n \\def\\defivar{\\defvrparsebody\\Edefivar\\defivarx\\defivarheader}\n %\n \\def\\defivarheader#1#2#3{%\n-  \\dosubind {vr}{\\code{#2}}{\\putwordof\\ #1}% entry in var index\n+  \\dosubind{vr}{\\code{#2}}{\\putwordof\\ \\code{#1}}% entry in var index\n   \\begingroup\n     \\defname{#2}{\\putwordInstanceVariableof\\ #1}%\n     \\defvarargs{#3}%\n@@ -5222,8 +5465,8 @@\n % This is actually simple: just print them in roman.\n % This must expand the args and terminate the paragraph they make up\n \\def\\defvarargs #1{\\normalparens #1%\n-\\interlinepenalty=10000\n-\\endgraf\\nobreak\\vskip -\\parskip\\nobreak}\n+  \\defargscommonending\n+}\n \n % @defvr Counter foo-count\n \n@@ -5259,8 +5502,7 @@\n \\def\\deftypevarheader #1#2{%\n \\dovarind#2 \\relax% Make entry in variables index\n \\begingroup\\defname {\\defheaderxcond#1\\relax$.$#2}{\\putwordDeftypevar}%\n-\\interlinepenalty=10000\n-\\endgraf\\nobreak\\vskip -\\parskip\\nobreak\n+  \\defargscommonending\n \\endgroup}\n \\def\\dovarind#1 #2\\relax{\\doind{vr}{\\code{#1}}}\n \n@@ -5270,8 +5512,7 @@\n \n \\def\\deftypevrheader #1#2#3{\\dovarind#3 \\relax%\n \\begingroup\\defname {\\defheaderxcond#2\\relax$.$#3}{#1}\n-\\interlinepenalty=10000\n-\\endgraf\\nobreak\\vskip -\\parskip\\nobreak\n+  \\defargscommonending\n \\endgroup}\n \n % Now define @deftp\n@@ -5288,7 +5529,7 @@\n \n % These definitions are used if you use @defunx (etc.)\n % anywhere other than immediately after a @defun or @defunx.\n-% \n+%\n \\def\\defcvx#1 {\\errmessage{@defcvx in invalid context}}\n \\def\\deffnx#1 {\\errmessage{@deffnx in invalid context}}\n \\def\\defivarx#1 {\\errmessage{@defivarx in invalid context}}\n@@ -5320,7 +5561,7 @@\n  \\def\\scanmacro#1{%\n    \\begingroup \\newlinechar`\\^^M\n    % Undo catcode changes of \\startcontents and \\doprintindex\n-   \\catcode`\\@=0 \\catcode`\\\\=12 \\escapechar=`\\@\n+   \\catcode`\\@=0 \\catcode`\\\\=\\other \\escapechar=`\\@\n    % Append \\endinput to make sure that TeX does not see the ending newline.\n    \\toks0={#1\\endinput}%\n    \\immediate\\openout\\macscribble=\\jobname.tmp\n@@ -5334,7 +5575,7 @@\n \\def\\scanmacro#1{%\n \\begingroup \\newlinechar`\\^^M\n % Undo catcode changes of \\startcontents and \\doprintindex\n-\\catcode`\\@=0 \\catcode`\\\\=12 \\escapechar=`\\@\n+\\catcode`\\@=0 \\catcode`\\\\=\\other \\escapechar=`\\@\n \\let\\xeatspaces\\eatspaces\\scantokens{#1\\endinput}\\endgroup}\n \\fi\n \n@@ -5364,7 +5605,7 @@\n }\n \n % Trim a single trailing ^^M off a string.\n-{\\catcode`\\^^M=12\\catcode`\\Q=3%\n+{\\catcode`\\^^M=\\other \\catcode`\\Q=3%\n \\gdef\\eatcr #1{\\eatcra #1Q^^MQ}%\n \\gdef\\eatcra#1^^MQ{\\eatcrb#1Q}%\n \\gdef\\eatcrb#1Q#2Q{#1}%\n@@ -5379,29 +5620,29 @@\n % body, and then making it the \\newlinechar in \\scanmacro.\n \n \\def\\macrobodyctxt{%\n-  \\catcode`\\~=12\n-  \\catcode`\\^=12\n-  \\catcode`\\_=12\n-  \\catcode`\\|=12\n-  \\catcode`\\<=12\n-  \\catcode`\\>=12\n-  \\catcode`\\+=12\n-  \\catcode`\\{=12\n-  \\catcode`\\}=12\n-  \\catcode`\\@=12\n-  \\catcode`\\^^M=12\n+  \\catcode`\\~=\\other\n+  \\catcode`\\^=\\other\n+  \\catcode`\\_=\\other\n+  \\catcode`\\|=\\other\n+  \\catcode`\\<=\\other\n+  \\catcode`\\>=\\other\n+  \\catcode`\\+=\\other\n+  \\catcode`\\{=\\other\n+  \\catcode`\\}=\\other\n+  \\catcode`\\@=\\other\n+  \\catcode`\\^^M=\\other\n   \\usembodybackslash}\n \n \\def\\macroargctxt{%\n-  \\catcode`\\~=12\n-  \\catcode`\\^=12\n-  \\catcode`\\_=12\n-  \\catcode`\\|=12\n-  \\catcode`\\<=12\n-  \\catcode`\\>=12\n-  \\catcode`\\+=12\n-  \\catcode`\\@=12\n-  \\catcode`\\\\=12}\n+  \\catcode`\\~=\\other\n+  \\catcode`\\^=\\other\n+  \\catcode`\\_=\\other\n+  \\catcode`\\|=\\other\n+  \\catcode`\\<=\\other\n+  \\catcode`\\>=\\other\n+  \\catcode`\\+=\\other\n+  \\catcode`\\@=\\other\n+  \\catcode`\\\\=\\other}\n \n % \\mbodybackslash is the definition of \\ in @macro bodies.\n % It maps \\foo\\ => \\csname macarg.foo\\endcsname => #N\n@@ -5442,32 +5683,33 @@\n   \\else \\expandafter\\parsemacbody\n   \\fi}\n \n-\\def\\unmacro{\\parsearg\\unmacroxxx}\n-\\def\\unmacroxxx#1{%\n+\\def\\unmacro{\\parsearg\\dounmacro}\n+\\def\\dounmacro#1{%\n   \\if1\\csname ismacro.#1\\endcsname\n     \\global\\cslet{#1}{macsave.#1}%\n     \\global\\expandafter\\let \\csname ismacro.#1\\endcsname=0%\n-    % Remove the macro name from \\macrolist\n+    % Remove the macro name from \\macrolist:\n     \\begingroup\n-      \\edef\\tempa{\\expandafter\\noexpand\\csname#1\\endcsname}%\n-      \\def\\do##1{%\n-        \\def\\tempb{##1}%\n-        \\ifx\\tempa\\tempb\n-          % remove this\n-        \\else\n-          \\toks0 = \\expandafter{\\newmacrolist\\do}%\n-          \\edef\\newmacrolist{\\the\\toks0\\expandafter\\noexpand\\tempa}%\n-        \\fi}%\n-      \\def\\newmacrolist{}%\n-      % Execute macro list to define \\newmacrolist\n-      \\macrolist\n-      \\global\\let\\macrolist\\newmacrolist\n+      \\expandafter\\let\\csname#1\\endcsname \\relax\n+      \\let\\do\\unmacrodo\n+      \\xdef\\macrolist{\\macrolist}%\n     \\endgroup\n   \\else\n     \\errmessage{Macro #1 not defined}%\n   \\fi\n }\n \n+% Called by \\do from \\dounmacro on each macro.  The idea is to omit any\n+% macro definitions that have been changed to \\relax.\n+%\n+\\def\\unmacrodo#1{%\n+  \\ifx#1\\relax\n+    % remove this\n+  \\else\n+    \\noexpand\\do \\noexpand #1%\n+  \\fi\n+}\n+\n % This makes use of the obscure feature that if the last token of a\n % <parameter list> is #, then the preceding argument is delimited by\n % an opening brace, and that opening brace is not consumed.\n@@ -5615,8 +5857,8 @@\n \n % @node's job is to define \\lastnode.\n \\def\\node{\\ENVcheck\\parsearg\\nodezzz}\n-\\def\\nodezzz#1{\\nodexxx [#1,]}\n-\\def\\nodexxx[#1,#2]{\\gdef\\lastnode{#1}}\n+\\def\\nodezzz#1{\\nodexxx #1,\\finishnodeparse}\n+\\def\\nodexxx#1,#2\\finishnodeparse{\\gdef\\lastnode{#1}}\n \\let\\nwnode=\\node\n \\let\\lastnode=\\relax\n \n@@ -5650,15 +5892,23 @@\n \\gdef\\restoresf{\\relax \\ifhmode \\spacefactor=\\savesfregister \\fi}\n \\gdef\\anchor#1{\\savesf \\setref{#1}{Ynothing}\\restoresf \\ignorespaces}\n \n-% \\setref{NAME}{SNT} defines a cross-reference point NAME, namely\n-% NAME-title, NAME-pg, and NAME-SNT.  Called from \\foonoderef.  We have\n-% to set \\indexdummies so commands such as @code in a section title\n-% aren't expanded.  It would be nicer not to expand the titles in the\n-% first place, but there's so many layers that that is hard to do.\n+% \\setref{NAME}{SNT} defines a cross-reference point NAME (a node or an\n+% anchor), namely NAME-title (the corresponding @chapter/etc. name),\n+% NAME-pg (the page number), and NAME-snt (section number and type).\n+% Called from \\foonoderef.\n+%\n+% We have to set \\indexdummies so commands such as @code in a section\n+% title aren't expanded.  It would be nicer not to expand the titles in\n+% the first place, but there's so many layers that that is hard to do.\n+%\n+% Likewise, use \\turnoffactive so that punctuation chars such as underscore\n+% and backslash work in node names.\n %\n \\def\\setref#1#2{{%\n-  \\indexdummies\n+  \\atdummies\n   \\pdfmkdest{#1}%\n+  %\n+  \\turnoffactive\n   \\dosetq{#1-title}{Ytitle}%\n   \\dosetq{#1-pg}{Ypagenumber}%\n   \\dosetq{#1-snt}{#2}%\n@@ -5710,7 +5960,7 @@\n   \\ifpdf\n     \\leavevmode\n     \\getfilename{#4}%\n-    {\\normalturnoffactive\n+    {\\turnoffactive \\otherbackslash\n      \\ifnum\\filenamelength>0\n        \\startlink attr{/Border [0 0 0]}%\n          goto file{\\the\\filename.pdf} name{#1}%\n@@ -5730,82 +5980,94 @@\n     % into the usual \\leavevmode...\\vrule stuff for purposes of\n     % printing. So we \\turnoffactive for the \\refx-snt, back on for the\n     % printing, back off for the \\refx-pg.\n-    {\\normalturnoffactive\n+    {\\turnoffactive \\otherbackslash\n      % Only output a following space if the -snt ref is nonempty; for\n      % @unnumbered and @anchor, it won't be.\n      \\setbox2 = \\hbox{\\ignorespaces \\refx{#1-snt}{}}%\n      \\ifdim \\wd2 > 0pt \\refx{#1-snt}\\space\\fi\n     }%\n-    % [mynode],\n-    [\\printednodename],\\space\n-    % page 3\n-    \\turnoffactive \\putwordpage\\tie\\refx{#1-pg}{}%\n+    % output the `[mynode]' via a macro.\n+    \\xrefprintnodename\\printednodename\n+    %\n+    % But we always want a comma and a space:\n+    ,\\space\n+    %\n+    % output the `page 3'.\n+    \\turnoffactive \\otherbackslash \\putwordpage\\tie\\refx{#1-pg}{}%\n   \\fi\n   \\endlink\n \\endgroup}\n \n-% \\dosetq is the interface for calls from other macros\n+% This macro is called from \\xrefX for the `[nodename]' part of xref\n+% output.  It's a separate macro only so it can be changed more easily,\n+% since not square brackets don't work in some documents.  Particularly\n+% one that Bob is working on :).\n+%\n+\\def\\xrefprintnodename#1{[#1]}\n \n-% Use \\normalturnoffactive so that punctuation chars such as underscore\n-% and backslash work in node names.  (\\turnoffactive doesn't do \\.)\n+% \\dosetq is called from \\setref to do the actual \\write (\\iflinks).\n+%\n \\def\\dosetq#1#2{%\n   {\\let\\folio=0%\n-   \\normalturnoffactive\n    \\edef\\next{\\write\\auxfile{\\internalsetq{#1}{#2}}}%\n-   \\iflinks\n-     \\next\n-   \\fi\n+   \\iflinks \\next \\fi\n   }%\n }\n \n-% \\internalsetq {foo}{page} expands into\n-% CHARACTERS 'xrdef {foo}{...expansion of \\Ypage...}\n-% When the aux file is read, ' is the escape character\n-\n-\\def\\internalsetq #1#2{'xrdef {#1}{\\csname #2\\endcsname}}\n-\n-% Things to be expanded by \\internalsetq\n+% \\internalsetq{foo}{page} expands into\n+%   CHARACTERS @xrdef{foo}{...expansion of \\page...}\n+\\def\\internalsetq#1#2{@xrdef{#1}{\\csname #2\\endcsname}}\n \n+% Things to be expanded by \\internalsetq.\n+%\n \\def\\Ypagenumber{\\folio}\n-\n \\def\\Ytitle{\\thissection}\n-\n \\def\\Ynothing{}\n-\n \\def\\Ysectionnumberandtype{%\n-\\ifnum\\secno=0 \\putwordChapter\\xreftie\\the\\chapno %\n-\\else \\ifnum \\subsecno=0 \\putwordSection\\xreftie\\the\\chapno.\\the\\secno %\n-\\else \\ifnum \\subsubsecno=0 %\n-\\putwordSection\\xreftie\\the\\chapno.\\the\\secno.\\the\\subsecno %\n-\\else %\n-\\putwordSection\\xreftie\\the\\chapno.\\the\\secno.\\the\\subsecno.\\the\\subsubsecno %\n-\\fi \\fi \\fi }\n+  \\ifnum\\secno=0\n+    \\putwordChapter@tie \\the\\chapno\n+  \\else \\ifnum\\subsecno=0\n+    \\putwordSection@tie \\the\\chapno.\\the\\secno\n+  \\else \\ifnum\\subsubsecno=0\n+    \\putwordSection@tie \\the\\chapno.\\the\\secno.\\the\\subsecno\n+  \\else\n+    \\putwordSection@tie \\the\\chapno.\\the\\secno.\\the\\subsecno.\\the\\subsubsecno\n+  \\fi\\fi\\fi\n+}\n \n \\def\\Yappendixletterandtype{%\n-\\ifnum\\secno=0 \\putwordAppendix\\xreftie'char\\the\\appendixno{}%\n-\\else \\ifnum \\subsecno=0 \\putwordSection\\xreftie'char\\the\\appendixno.\\the\\secno %\n-\\else \\ifnum \\subsubsecno=0 %\n-\\putwordSection\\xreftie'char\\the\\appendixno.\\the\\secno.\\the\\subsecno %\n-\\else %\n-\\putwordSection\\xreftie'char\\the\\appendixno.\\the\\secno.\\the\\subsecno.\\the\\subsubsecno %\n-\\fi \\fi \\fi }\n-\n-\\gdef\\xreftie{'tie}\n+  \\ifnum\\secno=0\n+     \\putwordAppendix@tie @char\\the\\appendixno{}%\n+  \\else \\ifnum\\subsecno=0\n+     \\putwordSection@tie @char\\the\\appendixno.\\the\\secno\n+  \\else \\ifnum\\subsubsecno=0\n+    \\putwordSection@tie @char\\the\\appendixno.\\the\\secno.\\the\\subsecno\n+  \\else\n+    \\putwordSection@tie\n+      @char\\the\\appendixno.\\the\\secno.\\the\\subsecno.\\the\\subsubsecno\n+  \\fi\\fi\\fi\n+}\n \n % Use TeX 3.0's \\inputlineno to get the line number, for better error\n % messages, but if we're using an old version of TeX, don't do anything.\n %\n \\ifx\\inputlineno\\thisisundefined\n-  \\let\\linenumber = \\empty % Non-3.0.\n+  \\let\\linenumber = \\empty % Pre-3.0.\n \\else\n   \\def\\linenumber{\\the\\inputlineno:\\space}\n \\fi\n \n % Define \\refx{NAME}{SUFFIX} to reference a cross-reference string named NAME.\n % If its value is nonempty, SUFFIX is output afterward.\n-\n+%\n \\def\\refx#1#2{%\n-  \\expandafter\\ifx\\csname X#1\\endcsname\\relax\n+  {%\n+    \\indexnofonts\n+    \\otherbackslash\n+    \\expandafter\\global\\expandafter\\let\\expandafter\\thisrefX\n+      \\csname X#1\\endcsname\n+  }%\n+  \\ifx\\thisrefX\\relax\n     % If not defined, say something at least.\n     \\angleleft un\\-de\\-fined\\angleright\n     \\iflinks\n@@ -5820,19 +6082,14 @@\n     \\fi\n   \\else\n     % It's defined, so just use it.\n-    \\csname X#1\\endcsname\n+    \\thisrefX\n   \\fi\n   #2% Output the suffix in any case.\n }\n \n % This is the macro invoked by entries in the aux file.\n %\n-\\def\\xrdef#1{\\begingroup\n-  % Reenable \\ as an escape while reading the second argument.\n-  \\catcode`\\\\ = 0\n-  \\afterassignment\\endgroup\n-  \\expandafter\\gdef\\csname X#1\\endcsname\n-}\n+\\def\\xrdef#1{\\expandafter\\gdef\\csname X#1\\endcsname}\n \n % Read the last existing aux file, if any.  No error if none exists.\n \\def\\readauxfile{\\begingroup\n@@ -5863,9 +6120,7 @@\n   \\catcode`\\^^]=\\other\n   \\catcode`\\^^^=\\other\n   \\catcode`\\^^_=\\other\n-  \\catcode`\\@=\\other\n-  \\catcode`\\^=\\other\n-  % It was suggested to define this as 7, which would allow ^^e4 etc.\n+  % It was suggested to set the catcode of ^ to 7, which would allow ^^e4 etc.\n   % in xref tags, i.e., node names.  But since ^^e4 notation isn't\n   % supported in the main text, it doesn't seem desirable.  Furthermore,\n   % that is not enough: for node names that actually contain a ^\n@@ -5878,6 +6133,9 @@\n   % \\def\\auxhat{\\def^{'hat }}% extra space so ok if followed by letter\n   % and then to call \\auxhat in \\setq.\n   %\n+  \\catcode`\\^=\\other\n+  %\n+  % Special characters.  Should be turned off anyway, but...\n   \\catcode`\\~=\\other\n   \\catcode`\\[=\\other\n   \\catcode`\\]=\\other\n@@ -5889,7 +6147,9 @@\n   \\catcode`\\$=\\other\n   \\catcode`\\#=\\other\n   \\catcode`\\&=\\other\n+  \\catcode`\\%=\\other\n   \\catcode`+=\\other % avoid \\+ for paranoia even though we've turned it off\n+  %\n   % Make the characters 128-255 be printing characters\n   {%\n     \\count 1=128\n@@ -5899,17 +6159,18 @@\n       \\ifnum \\count 1<256 \\loop \\fi\n     }%\n   }%\n-  % The aux file uses ' as the escape (for now).\n+  %\n   % Turn off \\ as an escape so we do not lose on\n   % entries which were dumped with control sequences in their names.\n-  % For example, 'xrdef {$\\leq $-fun}{page ...} made by @defun ^^\n+  % For example, @xrdef{$\\leq $-fun}{page ...} made by @defun ^^\n   % Reference to such entries still does not work the way one would wish,\n   % but at least they do not bomb out when the aux file is read in.\n+  \\catcode`\\\\=\\other\n+  %\n+  % @ is our escape character in .aux files.\n   \\catcode`\\{=1\n   \\catcode`\\}=2\n-  \\catcode`\\%=\\other\n-  \\catcode`\\'=0\n-  \\catcode`\\\\=\\other\n+  \\catcode`\\@=0\n   %\n   \\openin 1 \\jobname.aux\n   \\ifeof 1 \\else\n@@ -5943,18 +6204,19 @@\n %\n % Auto-number footnotes.  Otherwise like plain.\n \\gdef\\footnote{%\n+  \\let\\indent=\\ptexindent\n   \\global\\advance\\footnoteno by \\@ne\n   \\edef\\thisfootno{$^{\\the\\footnoteno}$}%\n   %\n   % In case the footnote comes at the end of a sentence, preserve the\n   % extra spacing after we do the footnote number.\n   \\let\\@sf\\empty\n-  \\ifhmode\\edef\\@sf{\\spacefactor\\the\\spacefactor}\\/\\fi\n+  \\ifhmode\\edef\\@sf{\\spacefactor\\the\\spacefactor}\\ptexslash\\fi\n   %\n   % Remove inadvertent blank space before typesetting the footnote number.\n   \\unskip\n   \\thisfootno\\@sf\n-  \\footnotezzz\n+  \\dofootnote\n }%\n \n % Don't bother with the trickery in plain.tex to not require the\n@@ -5964,10 +6226,17 @@\n % \\parseargline fail inside footnotes because the tokens are fixed when\n % the footnote is read.  --karl, 16nov96.\n %\n-\\long\\gdef\\footnotezzz{\\insert\\footins\\bgroup\n+% The start of the footnote looks usually like this:\n+\\gdef\\startfootins{\\insert\\footins\\bgroup}\n+%\n+% ... but this macro is redefined inside @multitable.\n+%\n+\\gdef\\dofootnote{%\n+  \\startfootins\n   % We want to typeset this text as a normal paragraph, even if the\n   % footnote reference occurs in (for example) a display environment.\n   % So reset some parameters.\n+  \\hsize=\\pagewidth\n   \\interlinepenalty\\interfootnotelinepenalty\n   \\splittopskip\\ht\\strutbox % top baseline for broken footnotes\n   \\splitmaxdepth\\dp\\strutbox\n@@ -5997,12 +6266,6 @@\n   \\footstrut\n   \\futurelet\\next\\fo@t\n }\n-\\def\\fo@t{\\ifcat\\bgroup\\noexpand\\next \\let\\next\\f@@t\n-  \\else\\let\\next\\f@t\\fi \\next}\n-\\def\\f@@t{\\bgroup\\aftergroup\\@foot\\let\\next}\n-\\def\\f@t#1{#1\\@foot}\n-\\def\\@foot{\\strut\\par\\egroup}\n-\n }%end \\catcode `\\@=11\n \n % @| inserts a changebar to the left of the current line.  It should\n@@ -6049,8 +6312,8 @@\n \\openin 1 = epsf.tex\n \\ifeof 1 \\else\n   \\closein 1\n-  % Do not bother showing banner with post-v2.7 epsf.tex (available in\n-  % doc/epsf.tex until it shows up on ctan).\n+  % Do not bother showing banner with epsf.tex v2.7k (available in\n+  % doc/epsf.tex and on ctan).\n   \\def\\epsfannounce{\\toks0 = }%\n   \\input epsf.tex\n \\fi\n@@ -6089,7 +6352,7 @@\n     \\nobreak\\bigskip\n     % Usually we'll have text after the image which will insert\n     % \\parskip glue, so insert it here too to equalize the space\n-    % above and below. \n+    % above and below.\n     \\nobreak\\vskip\\parskip\n     \\nobreak\n     \\line\\bgroup\\hss\n@@ -6177,7 +6440,7 @@\n % Parameters in order: 1) textheight; 2) textwidth; 3) voffset;\n % 4) hoffset; 5) binding offset; 6) topskip; 7) physical page height; 8)\n % physical page width.\n-% \n+%\n % We also call \\setleading{\\textleading}, so the caller should define\n % \\textleading.  The caller should also set \\parskip.\n %\n@@ -6211,15 +6474,6 @@\n   \\setemergencystretch\n }\n \n-% Use `small' versions.\n-% \n-\\def\\smallenvironments{%\n-  \\let\\smalldisplay = \\smalldisplayx\n-  \\let\\smallexample = \\smalllispx\n-  \\let\\smallformat = \\smallformatx\n-  \\let\\smalllisp = \\smalllispx\n-}\n-\n % @letterpaper (the default).\n \\def\\letterpaper{{\\globaldefs = 1\n   \\parskip = 3pt plus 2pt minus 1pt\n@@ -6247,15 +6501,14 @@\n   \\hfuzz = 1pt\n   \\contentsrightmargin = 0pt\n   \\defbodyindent = .5cm\n-  \\smallenvironments\n }}\n \n % Use @afourpaper to print on European A4 paper.\n \\def\\afourpaper{{\\globaldefs = 1\n   \\parskip = 3pt plus 2pt minus 1pt\n   \\textleading = 13.2pt\n   %\n-  % Double-side printing via postscript on Laserjet 4050 \n+  % Double-side printing via postscript on Laserjet 4050\n   % prints double-sided nicely when \\bindingoffset=10mm and \\hoffset=-6mm.\n   % To change the settings for a different printer or situation, adjust\n   % \\normaloffset until the front-side and back-side texts align.  Then\n@@ -6294,11 +6547,9 @@\n   \\contentsrightmargin = 0pt\n   \\defbodyindent = 2mm\n   \\tableindent = 12mm\n-  %\n-  \\smallenvironments\n }}\n \n-% A specific text layout, 24x15cm overall, intended for A4 paper.  \n+% A specific text layout, 24x15cm overall, intended for A4 paper.\n \\def\\afourlatex{{\\globaldefs = 1\n   \\afourpaper\n   \\internalpagesizes{237mm}{150mm}%\n@@ -6406,7 +6657,7 @@\n \\catcode`\\_=\\active\n \\def_{\\ifusingtt\\normalunderscore\\_}\n % Subroutine for the previous macro.\n-\\def\\_{\\leavevmode \\kern.06em \\vbox{\\hrule width.3em height.1ex}}\n+\\def\\_{\\leavevmode \\kern.07em \\vbox{\\hrule width.3em height.1ex}\\kern .07em }\n \n \\catcode`\\|=\\active\n \\def|{{\\tt\\char124}}\n@@ -6420,8 +6671,6 @@\n \\def+{{\\tt \\char 43}}\n \\catcode`\\$=\\active\n \\def${\\ifusingit{{\\sl\\$}}\\normaldollar}%$ font-lock fix\n-%\\catcode 27=\\active\n-%\\def^^[{$\\diamondsuit$}\n \n % Set up an active definition for =, but don't enable it most of the time.\n {\\catcode`\\==\\active\n@@ -6438,35 +6687,45 @@\n \n \\catcode`\\@=0\n \n-% \\rawbackslashxx output one backslash character in current font\n+% \\rawbackslashxx outputs one backslash character in current font,\n+% as in \\char`\\\\.\n \\global\\chardef\\rawbackslashxx=`\\\\\n-%{\\catcode`\\\\=\\other\n-%@gdef@rawbackslashxx{\\}}\n \n-% \\rawbackslash redefines \\ as input to do \\rawbackslashxx.\n+% \\rawbackslash defines an active \\ to do \\rawbackslashxx.\n+% \\otherbackslash defines an active \\ to be a literal `\\' character with\n+% catcode other.\n {\\catcode`\\\\=\\active\n-@gdef@rawbackslash{@let\\=@rawbackslashxx }}\n+ @gdef@rawbackslash{@let\\=@rawbackslashxx}\n+ @gdef@otherbackslash{@let\\=@realbackslash}\n+}\n+\n+% \\realbackslash is an actual character `\\' with catcode other.\n+{\\catcode`\\\\=\\other @gdef@realbackslash{\\}}\n \n % \\normalbackslash outputs one backslash in fixed width font.\n \\def\\normalbackslash{{\\tt\\rawbackslashxx}}\n \n-% \\catcode 17=0   % Define control-q\n \\catcode`\\\\=\\active\n \n % Used sometimes to turn off (effectively) the active characters\n % even after parsing them.\n-@def@turnoffactive{@let\"=@normaldoublequote\n-@let\\=@realbackslash\n-@let~=@normaltilde\n-@let^=@normalcaret\n-@let_=@normalunderscore\n-@let|=@normalverticalbar\n-@let<=@normalless\n-@let>=@normalgreater\n-@let+=@normalplus\n-@let$=@normaldollar}%$ font-lock fix\n-\n-% Same as @turnoffactive except for \\.\n+@def@turnoffactive{%\n+  @let\"=@normaldoublequote\n+  @let\\=@realbackslash\n+  @let~=@normaltilde\n+  @let^=@normalcaret\n+  @let_=@normalunderscore\n+  @let|=@normalverticalbar\n+  @let<=@normalless\n+  @let>=@normalgreater\n+  @let+=@normalplus\n+  @let$=@normaldollar %$ font-lock fix\n+}\n+\n+% Same as @turnoffactive except outputs \\ as {\\tt\\char`\\\\} instead of\n+% the literal character `\\'.  (Thus, \\ is not expandable when this is in\n+% effect.)\n+%\n @def@normalturnoffactive{@turnoffactive @let\\=@normalbackslash}\n \n % Make _ and + \\other characters, temporarily.\n@@ -6495,7 +6754,7 @@\n % Say @foo, not \\foo, in error messages.\n @escapechar = `@@\n \n-% These look ok in all fonts, so just make them not special.  \n+% These look ok in all fonts, so just make them not special.\n @catcode`@& = @other\n @catcode`@# = @other\n @catcode`@% = @other"}, {"sha": "0e5845be3f629a9052e41e40a247371b898beadd", "filename": "gcc/ggc-page.c", "status": "modified", "additions": 79, "deletions": 3, "changes": 82, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/adc4adcdaf77425b4ef99c8f468a6b7cf27292aa/gcc%2Fggc-page.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/adc4adcdaf77425b4ef99c8f468a6b7cf27292aa/gcc%2Fggc-page.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fggc-page.c?ref=adc4adcdaf77425b4ef99c8f468a6b7cf27292aa", "patch": "@@ -184,8 +184,8 @@ static const size_t extra_order_size_table[] = {\n   sizeof (struct tree_decl),\n   sizeof (struct tree_list),\n   TREE_EXP_SIZE (2),\n-  RTL_SIZE (2),\t\t\t/* REG, MEM, PLUS, etc.  */\n-  RTL_SIZE (10),\t\t/* INSN, CALL_INSN, JUMP_INSN */\n+  RTL_SIZE (2),\t\t\t/* MEM, PLUS, etc.  */\n+  RTL_SIZE (9),\t\t/* INSN, CALL_INSN, JUMP_INSN */\n };\n \n /* The total number of orders.  */\n@@ -400,6 +400,31 @@ static struct globals\n      better runtime data access pattern.  */\n   unsigned long **save_in_use;\n \n+#ifdef GATHER_STATISTICS\n+  struct\n+  {\n+    /* Total memory allocated with ggc_alloc */\n+    unsigned long long total_allocated;\n+    /* Total overhead for memory to be allocated with ggc_alloc */\n+    unsigned long long total_overhead;\n+\n+    /* Total allocations and overhead for sizes less than 32, 64 and 128.\n+       These sizes are interesting because they are typical cache line\n+       sizes. */\n+   \n+    unsigned long long total_allocated_under32;\n+    unsigned long long total_overhead_under32;\n+  \n+    unsigned long long total_allocated_under64;\n+    unsigned long long total_overhead_under64;\n+  \n+    unsigned long long total_allocated_under128;\n+    unsigned long long total_overhead_under128;\n+  \n+    /* The overhead for each of the allocation orders. */\n+    unsigned long long total_overhead_per_order[NUM_ORDERS];\n+  } stats;\n+#endif\n } G;\n \n /* The size in bytes required to maintain a bitmap for the objects\n@@ -1123,6 +1148,30 @@ ggc_alloc (size_t size)\n      information is used in deciding when to collect.  */\n   G.allocated += OBJECT_SIZE (order);\n \n+#ifdef GATHER_STATISTICS\n+  {\n+    G.stats.total_overhead += OBJECT_SIZE (order) - size;\n+    G.stats.total_overhead_per_order[order] += OBJECT_SIZE (order) - size;\n+    G.stats.total_allocated += OBJECT_SIZE(order);\n+\n+    if (size <= 32){\n+      G.stats.total_overhead_under32 += OBJECT_SIZE (order) - size;\n+      G.stats.total_allocated_under32 += OBJECT_SIZE(order);\n+    }\n+\n+    if (size <= 64){\n+      G.stats.total_overhead_under64 += OBJECT_SIZE (order) - size;\n+      G.stats.total_allocated_under64 += OBJECT_SIZE(order);\n+    }\n+  \n+    if (size <= 128){\n+      G.stats.total_overhead_under128 += OBJECT_SIZE (order) - size;\n+      G.stats.total_allocated_under128 += OBJECT_SIZE(order);\n+    }\n+\n+  }\n+#endif\n+  \n   if (GGC_DEBUG_LEVEL >= 3)\n     fprintf (G.debug_file,\n \t     \"Allocating object, requested size=%lu, actual=%lu at %p on %p\\n\",\n@@ -1761,7 +1810,7 @@ ggc_print_statistics (void)\n \n   /* Collect some information about the various sizes of\n      allocation.  */\n-  fprintf (stderr, \"\\n%-5s %10s  %10s  %10s\\n\",\n+  fprintf (stderr, \"%-5s %10s  %10s  %10s\\n\",\n \t   \"Size\", \"Allocated\", \"Used\", \"Overhead\");\n   for (i = 0; i < NUM_ORDERS; ++i)\n     {\n@@ -1799,6 +1848,33 @@ ggc_print_statistics (void)\n \t   SCALE (G.bytes_mapped), LABEL (G.bytes_mapped),\n \t   SCALE (G.allocated), LABEL(G.allocated),\n \t   SCALE (total_overhead), LABEL (total_overhead));\n+\n+#ifdef GATHER_STATISTICS  \n+  {\n+    fprintf (stderr, \"Total Overhead:                        %10lld\\n\",\n+             G.stats.total_overhead);\n+    fprintf (stderr, \"Total Allocated:                       %10lld\\n\",\n+             G.stats.total_allocated);\n+\n+    fprintf (stderr, \"Total Overhead  under  32B:            %10lld\\n\",\n+             G.stats.total_overhead_under32);\n+    fprintf (stderr, \"Total Allocated under  32B:            %10lld\\n\",\n+             G.stats.total_allocated_under32);\n+    fprintf (stderr, \"Total Overhead  under  64B:            %10lld\\n\",\n+             G.stats.total_overhead_under64);\n+    fprintf (stderr, \"Total Allocated under  64B:            %10lld\\n\",\n+             G.stats.total_allocated_under64);\n+    fprintf (stderr, \"Total Overhead  under 128B:            %10lld\\n\",\n+             G.stats.total_overhead_under128);\n+    fprintf (stderr, \"Total Allocated under 128B:            %10lld\\n\",\n+             G.stats.total_allocated_under128);\n+   \n+    for (i = 0; i < NUM_ORDERS; i++)\n+      if (G.stats.total_overhead_per_order[i])\n+        fprintf (stderr, \"Total Overhead  page size %7d:     %10lld\\n\",\n+                 OBJECT_SIZE (i), G.stats.total_overhead_per_order[i]);\n+  }\n+#endif\n }\n \f\n struct ggc_pch_data"}, {"sha": "d362ec14ff24403220ce500049627a29a727790e", "filename": "gcc/tree.c", "status": "modified", "additions": 7, "deletions": 24, "changes": 31, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/adc4adcdaf77425b4ef99c8f468a6b7cf27292aa/gcc%2Ftree.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/adc4adcdaf77425b4ef99c8f468a6b7cf27292aa/gcc%2Ftree.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftree.c?ref=adc4adcdaf77425b4ef99c8f468a6b7cf27292aa", "patch": "@@ -51,28 +51,11 @@ extern int _obstack_allocated_p (struct obstack *h, void *obj);\n \n #ifdef GATHER_STATISTICS\n /* Statistics-gathering stuff.  */\n-typedef enum\n-{\n-  d_kind,\n-  t_kind,\n-  b_kind,\n-  s_kind,\n-  r_kind,\n-  e_kind,\n-  c_kind,\n-  id_kind,\n-  perm_list_kind,\n-  temp_list_kind,\n-  vec_kind,\n-  x_kind,\n-  lang_decl,\n-  lang_type,\n-  all_kinds\n-} tree_node_kind;\n \n int tree_node_counts[(int) all_kinds];\n int tree_node_sizes[(int) all_kinds];\n \n+/* Keep in sync with tree.h:enum tree_node_kind. */\n static const char * const tree_node_kind_names[] = {\n   \"decls\",\n   \"types\",\n@@ -4446,19 +4429,19 @@ dump_tree_statistics (void)\n \n   fprintf (stderr, \"\\n??? tree nodes created\\n\\n\");\n #ifdef GATHER_STATISTICS\n-  fprintf (stderr, \"Kind                  Nodes     Bytes\\n\");\n-  fprintf (stderr, \"-------------------------------------\\n\");\n+  fprintf (stderr, \"Kind                   Nodes      Bytes\\n\");\n+  fprintf (stderr, \"---------------------------------------\\n\");\n   total_nodes = total_bytes = 0;\n   for (i = 0; i < (int) all_kinds; i++)\n     {\n-      fprintf (stderr, \"%-20s %6d %9d\\n\", tree_node_kind_names[i],\n+      fprintf (stderr, \"%-20s %7d %10d\\n\", tree_node_kind_names[i],\n \t       tree_node_counts[i], tree_node_sizes[i]);\n       total_nodes += tree_node_counts[i];\n       total_bytes += tree_node_sizes[i];\n     }\n-  fprintf (stderr, \"-------------------------------------\\n\");\n-  fprintf (stderr, \"%-20s %6d %9d\\n\", \"Total\", total_nodes, total_bytes);\n-  fprintf (stderr, \"-------------------------------------\\n\");\n+  fprintf (stderr, \"---------------------------------------\\n\");\n+  fprintf (stderr, \"%-20s %7d %10d\\n\", \"Total\", total_nodes, total_bytes);\n+  fprintf (stderr, \"---------------------------------------\\n\");\n #else\n   fprintf (stderr, \"(No per-node statistics)\\n\");\n #endif"}, {"sha": "9fffe7e3a3c5d56aaf3c939532149698561d714d", "filename": "gcc/tree.h", "status": "modified", "additions": 24, "deletions": 0, "changes": 24, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/adc4adcdaf77425b4ef99c8f468a6b7cf27292aa/gcc%2Ftree.h", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/adc4adcdaf77425b4ef99c8f468a6b7cf27292aa/gcc%2Ftree.h", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftree.h?ref=adc4adcdaf77425b4ef99c8f468a6b7cf27292aa", "patch": "@@ -3017,4 +3017,28 @@ extern void fancy_abort (const char *, int, const char *)\n     ATTRIBUTE_NORETURN;\n #define abort() fancy_abort (__FILE__, __LINE__, __FUNCTION__)\n \n+/* Enum and arrays used for tree allocation stats. \n+   Keep in sync with tree.c:tree_node_kind_names. */\n+typedef enum\n+{\n+  d_kind,\n+  t_kind,\n+  b_kind,\n+  s_kind,\n+  r_kind,\n+  e_kind,\n+  c_kind,\n+  id_kind,\n+  perm_list_kind,\n+  temp_list_kind,\n+  vec_kind,\n+  x_kind,\n+  lang_decl,\n+  lang_type,\n+  all_kinds\n+} tree_node_kind;\n+\n+extern int tree_node_counts[];\n+extern int tree_node_sizes[];\n+    \n #endif  /* GCC_TREE_H  */"}]}