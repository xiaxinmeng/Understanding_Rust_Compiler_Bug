{"sha": "950a884bcb5a0123791df98679a2b6367b4e2beb", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6OTUwYTg4NGJjYjVhMDEyMzc5MWRmOTg2NzlhMmI2MzY3YjRlMmJlYg==", "commit": {"author": {"name": "Thomas Koenig", "email": "tkoenig@gcc.gnu.org", "date": "2017-08-07T16:43:05Z"}, "committer": {"name": "Thomas Koenig", "email": "tkoenig@gcc.gnu.org", "date": "2017-08-07T16:43:05Z"}, "message": "re PR fortran/68829 (Segfaults with -Ofast due to large array on stack)\n\n2017-08-07  Thomas Koenig  <tkoenig@gcc.gnu.org>\n\n\tPR fortran/68829\n\t* doc/invoke.texi: Document change in behvaior for -Ofast for\n\tFortran.\n\n2017-08-07  Thomas Koenig  <tkoenig@gcc.gnu.org>\n\n\tPR fortran/68829\n\tPR fortran/81701\n\t* options.c: Make -Ofast honor -fmax-stack-var-size.\n\t* invoke.texi: Document change.\n\n2017-08-07  Thomas Koenig  <tkoenig@gcc.gnu.org>\n\n\tPR fortran/68829\n\tPR fortran/81701\n\t* gfortran.dg/o_fast_stacksize.90:  New test.\n\nFrom-SVN: r250923", "tree": {"sha": "905385db157c5257f02a6ab7e4910db31dd1c8ae", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/905385db157c5257f02a6ab7e4910db31dd1c8ae"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/950a884bcb5a0123791df98679a2b6367b4e2beb", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/950a884bcb5a0123791df98679a2b6367b4e2beb", "html_url": "https://github.com/Rust-GCC/gccrs/commit/950a884bcb5a0123791df98679a2b6367b4e2beb", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/950a884bcb5a0123791df98679a2b6367b4e2beb/comments", "author": null, "committer": null, "parents": [{"sha": "ebeeb49c4437466db2c9b706b541da47e99f1fe9", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/ebeeb49c4437466db2c9b706b541da47e99f1fe9", "html_url": "https://github.com/Rust-GCC/gccrs/commit/ebeeb49c4437466db2c9b706b541da47e99f1fe9"}], "stats": {"total": 47, "additions": 45, "deletions": 2}, "files": [{"sha": "d77a93323e160bb56f25f42fa4da10d438ef094c", "filename": "gcc/ChangeLog", "status": "modified", "additions": 6, "deletions": 0, "changes": 6, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/950a884bcb5a0123791df98679a2b6367b4e2beb/gcc%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/950a884bcb5a0123791df98679a2b6367b4e2beb/gcc%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2FChangeLog?ref=950a884bcb5a0123791df98679a2b6367b4e2beb", "patch": "@@ -1,3 +1,9 @@\n+2017-08-07  Thomas Koenig  <tkoenig@gcc.gnu.org>\n+\n+\tPR fortran/68829\n+\t* doc/invoke.texi: Document change in behvaior for -Ofast for\n+\tFortran.\n+\n 2017-08-07  Wilco Dijkstra  <wdijkstr@arm.com>\n \n \t* config/aarch64/aarch64.c (aarch64_pushwb_single_reg):"}, {"sha": "5ee5b0e7b6d23badc95f0190c3af92a6ddcbdf40", "filename": "gcc/doc/invoke.texi", "status": "modified", "additions": 2, "deletions": 1, "changes": 3, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/950a884bcb5a0123791df98679a2b6367b4e2beb/gcc%2Fdoc%2Finvoke.texi", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/950a884bcb5a0123791df98679a2b6367b4e2beb/gcc%2Fdoc%2Finvoke.texi", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fdoc%2Finvoke.texi?ref=950a884bcb5a0123791df98679a2b6367b4e2beb", "patch": "@@ -7278,7 +7278,8 @@ Disregard strict standards compliance.  @option{-Ofast} enables all\n @option{-O3} optimizations.  It also enables optimizations that are not\n valid for all standard-compliant programs.\n It turns on @option{-ffast-math} and the Fortran-specific\n-@option{-fno-protect-parens} and @option{-fstack-arrays}.\n+@option{-fstack-arrays}, unless @option{-fmax-stack-var-size} is\n+specified, and @option{-fno-protect-parens}.\n \n @item -Og\n @opindex Og"}, {"sha": "e52bd0654aeb21d0baedfb9ca5ac664088240019", "filename": "gcc/fortran/ChangeLog", "status": "modified", "additions": 7, "deletions": 0, "changes": 7, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/950a884bcb5a0123791df98679a2b6367b4e2beb/gcc%2Ffortran%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/950a884bcb5a0123791df98679a2b6367b4e2beb/gcc%2Ffortran%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ffortran%2FChangeLog?ref=950a884bcb5a0123791df98679a2b6367b4e2beb", "patch": "@@ -1,3 +1,10 @@\n+2017-08-07  Thomas Koenig  <tkoenig@gcc.gnu.org>\n+\n+\tPR fortran/68829\n+\tPR fortran/81701\n+\t* options.c: Make -Ofast honor -fmax-stack-var-size.\n+\t* invoke.texi: Document change.\n+\n 2017-08-01  Thomas K\u00f6nig  <tkoenig@gcc.gnu.org>\n \n \tPR fortran/79312"}, {"sha": "283c8354e06e90dd5783b26db64b10ec37ab3926", "filename": "gcc/fortran/options.c", "status": "modified", "additions": 7, "deletions": 1, "changes": 8, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/950a884bcb5a0123791df98679a2b6367b4e2beb/gcc%2Ffortran%2Foptions.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/950a884bcb5a0123791df98679a2b6367b4e2beb/gcc%2Ffortran%2Foptions.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ffortran%2Foptions.c?ref=950a884bcb5a0123791df98679a2b6367b4e2beb", "patch": "@@ -235,7 +235,9 @@ gfc_post_options (const char **pfilename)\n   if (flag_protect_parens == -1)\n     flag_protect_parens = !optimize_fast;\n \n-  if (flag_stack_arrays == -1)\n+  /* -Ofast sets implies -fstack-arrays unless an explicit size is set for\n+     stack arrays.  */\n+  if (flag_stack_arrays == -1 && flag_max_stack_var_size == -2)\n     flag_stack_arrays = optimize_fast;\n \n   /* By default, disable (re)allocation during assignment for -std=f95,\n@@ -380,6 +382,10 @@ gfc_post_options (const char **pfilename)\n       flag_max_stack_var_size = -1;\n     }\n \n+  /* Set flag_stack_arrays correctly.  */\n+  if (flag_stack_arrays == -1)\n+    flag_stack_arrays = 0;\n+\n   /* Set default.  */\n   if (flag_max_stack_var_size == -2)\n     flag_max_stack_var_size = 32768;"}, {"sha": "6a07467cecfda32bbbfe66361f8b13ecad17e925", "filename": "gcc/testsuite/ChangeLog", "status": "modified", "additions": 6, "deletions": 0, "changes": 6, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/950a884bcb5a0123791df98679a2b6367b4e2beb/gcc%2Ftestsuite%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/950a884bcb5a0123791df98679a2b6367b4e2beb/gcc%2Ftestsuite%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2FChangeLog?ref=950a884bcb5a0123791df98679a2b6367b4e2beb", "patch": "@@ -1,3 +1,9 @@\n+2017-08-07  Thomas Koenig  <tkoenig@gcc.gnu.org>\n+\n+\tPR fortran/68829\n+\tPR fortran/81701\n+\t* gfortran.dg/o_fast_stacksize.90:  New test.\n+\n 2017-08-07  Wilco Dijkstra  <wdijkstr@arm.com>\n \n \tPR middle-end/46932"}, {"sha": "a373d15e54e48b44f89519bfb8184488ea55e79e", "filename": "gcc/testsuite/gfortran.dg/o_fast_stacksize.f90", "status": "added", "additions": 17, "deletions": 0, "changes": 17, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/950a884bcb5a0123791df98679a2b6367b4e2beb/gcc%2Ftestsuite%2Fgfortran.dg%2Fo_fast_stacksize.f90", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/950a884bcb5a0123791df98679a2b6367b4e2beb/gcc%2Ftestsuite%2Fgfortran.dg%2Fo_fast_stacksize.f90", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgfortran.dg%2Fo_fast_stacksize.f90?ref=950a884bcb5a0123791df98679a2b6367b4e2beb", "patch": "@@ -0,0 +1,17 @@\n+! { dg-do compile }\n+! { dg-options \"-Ofast -fmax-stack-var-size=100 -fdump-tree-original\" }\n+MODULE foo\n+CONTAINS\n+  SUBROUTINE mysum(a)\n+    INTEGER :: a(:)\n+    WRITE(6,*) SUM(a)\n+  END SUBROUTINE\n+END MODULE foo\n+\n+USE foo\n+INTEGER, ALLOCATABLE :: a(:)\n+INTEGER, PARAMETER :: N=2**26 ! 256Mb array\n+ALLOCATE(a(N)) ; a=1\n+CALL mysum(a*a)\n+END\n+! { dg-final { scan-tree-dump-times \"__builtin_malloc\" 2 \"original\" } }"}]}