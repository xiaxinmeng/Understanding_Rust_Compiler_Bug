{"sha": "674647e60381fe980fda563eea96e0536150057d", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6Njc0NjQ3ZTYwMzgxZmU5ODBmZGE1NjNlZWE5NmUwNTM2MTUwMDU3ZA==", "commit": {"author": {"name": "Ian Lance Taylor", "email": "iant@google.com", "date": "2013-11-06T01:03:57Z"}, "committer": {"name": "Ian Lance Taylor", "email": "ian@gcc.gnu.org", "date": "2013-11-06T01:03:57Z"}, "message": "sync.md (atomic_compare_and_swap<dwi>_doubleword): If possible, add .cfi directives to record change to bx.\n\n\t* config/i386/sync.md (atomic_compare_and_swap<dwi>_doubleword):\n\tIf possible, add .cfi directives to record change to bx.\n\t* config/i386/i386.c (ix86_emit_cfi): New function.\n\t* config/i386/i386-protos.h (ix86_emit_cfi): Declare.\n\nFrom-SVN: r204433", "tree": {"sha": "6883ff09dca6ecde88c7300e1d9c735df4a80b38", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/6883ff09dca6ecde88c7300e1d9c735df4a80b38"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/674647e60381fe980fda563eea96e0536150057d", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/674647e60381fe980fda563eea96e0536150057d", "html_url": "https://github.com/Rust-GCC/gccrs/commit/674647e60381fe980fda563eea96e0536150057d", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/674647e60381fe980fda563eea96e0536150057d/comments", "author": null, "committer": null, "parents": [{"sha": "39cf09b1f55b630ee462edce769bf8e9562ef74a", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/39cf09b1f55b630ee462edce769bf8e9562ef74a", "html_url": "https://github.com/Rust-GCC/gccrs/commit/39cf09b1f55b630ee462edce769bf8e9562ef74a"}], "stats": {"total": 31, "additions": 29, "deletions": 2}, "files": [{"sha": "d5c8ceb1c5ee791c972cbfcad03977fbb82278a3", "filename": "gcc/ChangeLog", "status": "modified", "additions": 7, "deletions": 0, "changes": 7, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/674647e60381fe980fda563eea96e0536150057d/gcc%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/674647e60381fe980fda563eea96e0536150057d/gcc%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2FChangeLog?ref=674647e60381fe980fda563eea96e0536150057d", "patch": "@@ -1,3 +1,10 @@\n+2013-11-05  Ian Lance Taylor  <iant@google.com>\n+\n+\t* config/i386/sync.md (atomic_compare_and_swap<dwi>_doubleword):\n+\tIf possible, add .cfi directives to record change to bx.\n+\t* config/i386/i386.c (ix86_emit_cfi): New function.\n+\t* config/i386/i386-protos.h (ix86_emit_cfi): Declare.\n+\n 2013-11-05  Steven Bosscher  <steven@gcc.gnu.org>\n \n "}, {"sha": "fdf9d5804df1eba19a7b51fa4599634cb5adc430", "filename": "gcc/config/i386/i386-protos.h", "status": "modified", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/674647e60381fe980fda563eea96e0536150057d/gcc%2Fconfig%2Fi386%2Fi386-protos.h", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/674647e60381fe980fda563eea96e0536150057d/gcc%2Fconfig%2Fi386%2Fi386-protos.h", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fconfig%2Fi386%2Fi386-protos.h?ref=674647e60381fe980fda563eea96e0536150057d", "patch": "@@ -143,6 +143,7 @@ extern void ix86_split_lshr (rtx *, rtx, enum machine_mode);\n extern rtx ix86_find_base_term (rtx);\n extern bool ix86_check_movabs (rtx, int);\n extern void ix86_split_idivmod (enum machine_mode, rtx[], bool);\n+extern bool ix86_emit_cfi ();\n \n extern rtx assign_386_stack_local (enum machine_mode, enum ix86_stack_slot);\n extern int ix86_attr_length_immediate_default (rtx, bool);"}, {"sha": "3d3838b97f9ff1e07dacfdae4f97ed0098c11202", "filename": "gcc/config/i386/i386.c", "status": "modified", "additions": 8, "deletions": 0, "changes": 8, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/674647e60381fe980fda563eea96e0536150057d/gcc%2Fconfig%2Fi386%2Fi386.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/674647e60381fe980fda563eea96e0536150057d/gcc%2Fconfig%2Fi386%2Fi386.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fconfig%2Fi386%2Fi386.c?ref=674647e60381fe980fda563eea96e0536150057d", "patch": "@@ -17344,6 +17344,14 @@ ix86_split_idivmod (enum machine_mode mode, rtx operands[],\n   emit_label (end_label);\n }\n \n+/* Whether it is OK to emit CFI directives when emitting asm code.  */\n+\n+bool\n+ix86_emit_cfi ()\n+{\n+  return dwarf2out_do_cfi_asm ();\n+}\n+\n #define LEA_MAX_STALL (3)\n #define LEA_SEARCH_THRESHOLD (LEA_MAX_STALL << 1)\n "}, {"sha": "8408a2bfe431eecea1529d2af058ff1618ec4253", "filename": "gcc/config/i386/sync.md", "status": "modified", "additions": 13, "deletions": 2, "changes": 15, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/674647e60381fe980fda563eea96e0536150057d/gcc%2Fconfig%2Fi386%2Fsync.md", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/674647e60381fe980fda563eea96e0536150057d/gcc%2Fconfig%2Fi386%2Fsync.md", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fconfig%2Fi386%2Fsync.md?ref=674647e60381fe980fda563eea96e0536150057d", "patch": "@@ -430,10 +430,21 @@\n   const char *xchg = \"xchg{<imodesuffix>}\\t%%<regprefix>bx, %5\";\n \n   if (swap)\n-    output_asm_insn (xchg, operands);\n+    {\n+      output_asm_insn (xchg, operands);\n+      if (ix86_emit_cfi ())\n+\t{\n+\t  output_asm_insn (\".cfi_remember_state\", operands);\n+\t  output_asm_insn (\".cfi_register\\t%%<regprefix>bx, %5\", operands);\n+\t}\n+    }\n   output_asm_insn (\"lock{%;} %K7cmpxchg<doublemodesuffix>b\\t%2\", operands);\n   if (swap)\n-    output_asm_insn (xchg, operands);\n+    {\n+      output_asm_insn (xchg, operands);\n+      if (ix86_emit_cfi ())\n+\toutput_asm_insn (\".cfi_restore_state\", operands);\n+    }\n \n   return \"\";\n })"}]}