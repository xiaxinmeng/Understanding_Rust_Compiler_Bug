{"sha": "a7d0852d3f7d3e0a596f53efb2d75cf522ffb43f", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6YTdkMDg1MmQzZjdkM2UwYTU5NmY1M2VmYjJkNzVjZjUyMmZmYjQzZg==", "commit": {"author": {"name": "Jakub Jelinek", "email": "jakub@redhat.com", "date": "2007-08-28T09:44:57Z"}, "committer": {"name": "Jakub Jelinek", "email": "jakub@gcc.gnu.org", "date": "2007-08-28T09:44:57Z"}, "message": "re PR debug/32914 (ICE in rtl_for_decl_init with -g option)\n\n\tPR debug/32914\n\t* dwarf2out.c (rtl_for_decl_init): If vector decl has CONSTRUCTOR\n\tinitializer, use build_vector_from_ctor if possible to create\n\tVECTOR_CST out of it.  If vector initializer is not VECTOR_CST\n\teven after this, return NULL.\n\n\t* d++.dg/debug/const3.C: New test.\n\t* d++.dg/debug/const4.C: New test.\n\t* d++.dg/debug/dwarf2/const1.C: New test.\n\t* d++.dg/debug/dwarf2/const2.C: New test.\n\t* d++.dg/debug/dwarf2/const2b.C: New test.\n\nFrom-SVN: r127854", "tree": {"sha": "4157d365858a0a5f25d896c2f084ec1c1692a791", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/4157d365858a0a5f25d896c2f084ec1c1692a791"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/a7d0852d3f7d3e0a596f53efb2d75cf522ffb43f", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/a7d0852d3f7d3e0a596f53efb2d75cf522ffb43f", "html_url": "https://github.com/Rust-GCC/gccrs/commit/a7d0852d3f7d3e0a596f53efb2d75cf522ffb43f", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/a7d0852d3f7d3e0a596f53efb2d75cf522ffb43f/comments", "author": {"login": "jakubjelinek", "id": 9370665, "node_id": "MDQ6VXNlcjkzNzA2NjU=", "avatar_url": "https://avatars.githubusercontent.com/u/9370665?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jakubjelinek", "html_url": "https://github.com/jakubjelinek", "followers_url": "https://api.github.com/users/jakubjelinek/followers", "following_url": "https://api.github.com/users/jakubjelinek/following{/other_user}", "gists_url": "https://api.github.com/users/jakubjelinek/gists{/gist_id}", "starred_url": "https://api.github.com/users/jakubjelinek/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jakubjelinek/subscriptions", "organizations_url": "https://api.github.com/users/jakubjelinek/orgs", "repos_url": "https://api.github.com/users/jakubjelinek/repos", "events_url": "https://api.github.com/users/jakubjelinek/events{/privacy}", "received_events_url": "https://api.github.com/users/jakubjelinek/received_events", "type": "User", "site_admin": false}, "committer": null, "parents": [{"sha": "6a76d2166ce933df0b010f83004cb10f5dde4fb3", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/6a76d2166ce933df0b010f83004cb10f5dde4fb3", "html_url": "https://github.com/Rust-GCC/gccrs/commit/6a76d2166ce933df0b010f83004cb10f5dde4fb3"}], "stats": {"total": 77, "additions": 77, "deletions": 0}, "files": [{"sha": "9f7fe58f98dcc249fa36ab1cef8f5e3b42c0a941", "filename": "gcc/ChangeLog", "status": "modified", "additions": 8, "deletions": 0, "changes": 8, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/a7d0852d3f7d3e0a596f53efb2d75cf522ffb43f/gcc%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/a7d0852d3f7d3e0a596f53efb2d75cf522ffb43f/gcc%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2FChangeLog?ref=a7d0852d3f7d3e0a596f53efb2d75cf522ffb43f", "patch": "@@ -1,3 +1,11 @@\n+2007-08-28  Jakub Jelinek  <jakub@redhat.com>\n+\n+\tPR debug/32914\n+\t* dwarf2out.c (rtl_for_decl_init): If vector decl has CONSTRUCTOR\n+\tinitializer, use build_vector_from_ctor if possible to create\n+\tVECTOR_CST out of it.  If vector initializer is not VECTOR_CST\n+\teven after this, return NULL.\n+\n 2007-08-28  Gabriel Dos Reis  <gdr@integrable-solutions.net>\n \n \t* c-pretty-print.c (pp_c_constant): Handle COMPLEX_CST."}, {"sha": "e1b332f7101887e3751d2c1ca2b835cfb5a773dc", "filename": "gcc/dwarf2out.c", "status": "modified", "additions": 37, "deletions": 0, "changes": 37, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/a7d0852d3f7d3e0a596f53efb2d75cf522ffb43f/gcc%2Fdwarf2out.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/a7d0852d3f7d3e0a596f53efb2d75cf522ffb43f/gcc%2Fdwarf2out.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fdwarf2out.c?ref=a7d0852d3f7d3e0a596f53efb2d75cf522ffb43f", "patch": "@@ -10403,6 +10403,43 @@ rtl_for_decl_init (tree init, tree type)\n   else if (initializer_constant_valid_p (init, type)\n \t   && ! walk_tree (&init, reference_to_unused, NULL, NULL))\n     {\n+      /* Convert vector CONSTRUCTOR initializers to VECTOR_CST if\n+\t possible.  */\n+      if (TREE_CODE (type) == VECTOR_TYPE)\n+\tswitch (TREE_CODE (init))\n+\t  {\n+\t  case VECTOR_CST:\n+\t    break;\n+\t  case CONSTRUCTOR:\n+\t    if (TREE_CONSTANT (init))\n+\t      {\n+\t\tVEC(constructor_elt,gc) *elts = CONSTRUCTOR_ELTS (init);\n+\t\tbool constant_p = true;\n+\t\ttree value;\n+\t\tunsigned HOST_WIDE_INT ix;\n+\n+\t\t/* Even when ctor is constant, it might contain non-*_CST\n+\t\t   elements (e.g. { 1.0/0.0 - 1.0/0.0, 0.0 }) and those don't\n+\t\t   belong into VECTOR_CST nodes.  */\n+\t\tFOR_EACH_CONSTRUCTOR_VALUE (elts, ix, value)\n+\t\t  if (!CONSTANT_CLASS_P (value))\n+\t\t    {\n+\t\t      constant_p = false;\n+\t\t      break;\n+\t\t    }\n+\n+\t\tif (constant_p)\n+\t\t  {\n+\t\t    init = build_vector_from_ctor (type, elts);\n+\t\t    break;\n+\t\t  }\n+\t      }\n+\t    /* FALLTHRU */\n+\n+\t  default:\n+\t    return NULL;\n+\t  }\n+\n       rtl = expand_expr (init, NULL_RTX, VOIDmode, EXPAND_INITIALIZER);\n \n       /* If expand_expr returns a MEM, it wasn't immediate.  */"}, {"sha": "49b1b9f3be720f66e272c16f0f53661b03047cdf", "filename": "gcc/testsuite/ChangeLog", "status": "modified", "additions": 9, "deletions": 0, "changes": 9, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/a7d0852d3f7d3e0a596f53efb2d75cf522ffb43f/gcc%2Ftestsuite%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/a7d0852d3f7d3e0a596f53efb2d75cf522ffb43f/gcc%2Ftestsuite%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2FChangeLog?ref=a7d0852d3f7d3e0a596f53efb2d75cf522ffb43f", "patch": "@@ -1,3 +1,12 @@\n+2007-08-28  Jakub Jelinek  <jakub@redhat.com>\n+\n+\tPR debug/32914\n+\t* d++.dg/debug/const3.C: New test.\n+\t* d++.dg/debug/const4.C: New test.\n+\t* d++.dg/debug/dwarf2/const1.C: New test.\n+\t* d++.dg/debug/dwarf2/const2.C: New test.\n+\t* d++.dg/debug/dwarf2/const2b.C: New test.\n+\n 2007-08-28  Mircea Namolaru  <namolaru@il.ibm.com>\n             Vladimir Yanovsky  <yanov@il.ibm.com>\n             Revital Eres  <eres@il.ibm.com>"}, {"sha": "375c548a3b362404177729662de100fed9196a5d", "filename": "gcc/testsuite/g++.dg/debug/const3.C", "status": "added", "additions": 3, "deletions": 0, "changes": 3, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/a7d0852d3f7d3e0a596f53efb2d75cf522ffb43f/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Fdebug%2Fconst3.C", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/a7d0852d3f7d3e0a596f53efb2d75cf522ffb43f/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Fdebug%2Fconst3.C", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Fdebug%2Fconst3.C?ref=a7d0852d3f7d3e0a596f53efb2d75cf522ffb43f", "patch": "@@ -0,0 +1,3 @@\n+/* { dg-do compile } */\n+typedef float FloatVect __attribute__((__vector_size__(16)));\n+const FloatVect Foo = { 250000000.0, 0.0, 0.0, 0.0 };"}, {"sha": "ec8133d778aaa12076d0cf788578bb62dd6309d6", "filename": "gcc/testsuite/g++.dg/debug/const4.C", "status": "added", "additions": 2, "deletions": 0, "changes": 2, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/a7d0852d3f7d3e0a596f53efb2d75cf522ffb43f/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Fdebug%2Fconst4.C", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/a7d0852d3f7d3e0a596f53efb2d75cf522ffb43f/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Fdebug%2Fconst4.C", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Fdebug%2Fconst4.C?ref=a7d0852d3f7d3e0a596f53efb2d75cf522ffb43f", "patch": "@@ -0,0 +1,2 @@\n+/* { dg-do compile } */\n+const __complex__ int x = 2i;"}, {"sha": "be23c10bae1a39105ca6383d2e4d83c7d8565c53", "filename": "gcc/testsuite/g++.dg/debug/dwarf2/const1.C", "status": "added", "additions": 6, "deletions": 0, "changes": 6, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/a7d0852d3f7d3e0a596f53efb2d75cf522ffb43f/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Fdebug%2Fdwarf2%2Fconst1.C", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/a7d0852d3f7d3e0a596f53efb2d75cf522ffb43f/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Fdebug%2Fdwarf2%2Fconst1.C", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Fdebug%2Fdwarf2%2Fconst1.C?ref=a7d0852d3f7d3e0a596f53efb2d75cf522ffb43f", "patch": "@@ -0,0 +1,6 @@\n+/* { dg-do compile } */\n+/* { dg-options \"-O -gdwarf-2 -dA\" } */\n+/* { dg-final { scan-assembler \"DW_AT_const_value\" } } */\n+\n+extern void x ();\n+void (* const f) () = x;"}, {"sha": "27f4c265851309df89ccacd6e63c36b6b62b4b78", "filename": "gcc/testsuite/g++.dg/debug/dwarf2/const2.C", "status": "added", "additions": 6, "deletions": 0, "changes": 6, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/a7d0852d3f7d3e0a596f53efb2d75cf522ffb43f/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Fdebug%2Fdwarf2%2Fconst2.C", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/a7d0852d3f7d3e0a596f53efb2d75cf522ffb43f/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Fdebug%2Fdwarf2%2Fconst2.C", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Fdebug%2Fdwarf2%2Fconst2.C?ref=a7d0852d3f7d3e0a596f53efb2d75cf522ffb43f", "patch": "@@ -0,0 +1,6 @@\n+/* { dg-do compile { target powerpc_altivec_ok } } */\n+/* { dg-options \"-O -gdwarf-2 -dA -maltivec\" } */\n+/* { dg-final { scan-assembler \"DW_AT_const_value\" } } */\n+\n+typedef float FloatVect __attribute__((__vector_size__(16)));\n+const FloatVect Foo = { 250000000.0, 0.0, 0.0, 0.0 };"}, {"sha": "593e080ac6949d6c68775aaee0e0054330bf63c7", "filename": "gcc/testsuite/g++.dg/debug/dwarf2/const2b.C", "status": "added", "additions": 6, "deletions": 0, "changes": 6, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/a7d0852d3f7d3e0a596f53efb2d75cf522ffb43f/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Fdebug%2Fdwarf2%2Fconst2b.C", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/a7d0852d3f7d3e0a596f53efb2d75cf522ffb43f/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Fdebug%2Fdwarf2%2Fconst2b.C", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Fdebug%2Fdwarf2%2Fconst2b.C?ref=a7d0852d3f7d3e0a596f53efb2d75cf522ffb43f", "patch": "@@ -0,0 +1,6 @@\n+/* { dg-do compile { target i386*-*-* } } */\n+/* { dg-options \"-O -gdwarf-2 -dA -msse\" } */\n+/* { dg-final { scan-assembler \"DW_AT_const_value\" } } */\n+\n+typedef float FloatVect __attribute__((__vector_size__(16)));\n+const FloatVect Foo = { 250000000.0, 0.0, 0.0, 0.0 };"}]}