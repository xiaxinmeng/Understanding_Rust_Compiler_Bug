{"sha": "91deb93712047ca1b5d3d5ddf8b0f12b4a164ef8", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6OTFkZWI5MzcxMjA0N2NhMWI1ZDNkNWRkZjhiMGYxMmI0YTE2NGVmOA==", "commit": {"author": {"name": "Richard Guenther", "email": "rguenther@suse.de", "date": "2009-07-02T10:18:24Z"}, "committer": {"name": "Richard Biener", "email": "rguenth@gcc.gnu.org", "date": "2009-07-02T10:18:24Z"}, "message": "tree-ssa-live.c (remove_unused_locals): Do not remove heap variables.\n\n2009-07-02  Richard Guenther  <rguenther@suse.de>\n\n\t* tree-ssa-live.c (remove_unused_locals): Do not remove\n\theap variables.\n\t* tree-ssa-structalias.c (handle_lhs_call): Delay setting\n\tof DECL_EXTERNAL for HEAP variables.\n\t(compute_points_to_sets): Set DECL_EXTERNAL for escaped\n\tHEAP variables.  Do not adjust RESTRICT vars.\n\t(find_what_var_points_to): Nobody cares if something\n\tpoints to READONLY.\n\nFrom-SVN: r149170", "tree": {"sha": "311b16650e82552b4d5ec734b325f969addba653", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/311b16650e82552b4d5ec734b325f969addba653"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/91deb93712047ca1b5d3d5ddf8b0f12b4a164ef8", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/91deb93712047ca1b5d3d5ddf8b0f12b4a164ef8", "html_url": "https://github.com/Rust-GCC/gccrs/commit/91deb93712047ca1b5d3d5ddf8b0f12b4a164ef8", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/91deb93712047ca1b5d3d5ddf8b0f12b4a164ef8/comments", "author": {"login": "rguenth", "id": 2046526, "node_id": "MDQ6VXNlcjIwNDY1MjY=", "avatar_url": "https://avatars.githubusercontent.com/u/2046526?v=4", "gravatar_id": "", "url": "https://api.github.com/users/rguenth", "html_url": "https://github.com/rguenth", "followers_url": "https://api.github.com/users/rguenth/followers", "following_url": "https://api.github.com/users/rguenth/following{/other_user}", "gists_url": "https://api.github.com/users/rguenth/gists{/gist_id}", "starred_url": "https://api.github.com/users/rguenth/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/rguenth/subscriptions", "organizations_url": "https://api.github.com/users/rguenth/orgs", "repos_url": "https://api.github.com/users/rguenth/repos", "events_url": "https://api.github.com/users/rguenth/events{/privacy}", "received_events_url": "https://api.github.com/users/rguenth/received_events", "type": "User", "site_admin": false}, "committer": null, "parents": [{"sha": "3e37f41e5ad844b1a7e5717bd04c93740699e1d7", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/3e37f41e5ad844b1a7e5717bd04c93740699e1d7", "html_url": "https://github.com/Rust-GCC/gccrs/commit/3e37f41e5ad844b1a7e5717bd04c93740699e1d7"}], "stats": {"total": 22, "additions": 19, "deletions": 3}, "files": [{"sha": "47548957e2cf4216bbfce6b5c80b662e1e47e978", "filename": "gcc/ChangeLog", "status": "modified", "additions": 11, "deletions": 0, "changes": 11, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/91deb93712047ca1b5d3d5ddf8b0f12b4a164ef8/gcc%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/91deb93712047ca1b5d3d5ddf8b0f12b4a164ef8/gcc%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2FChangeLog?ref=91deb93712047ca1b5d3d5ddf8b0f12b4a164ef8", "patch": "@@ -1,3 +1,14 @@\n+2009-07-02  Richard Guenther  <rguenther@suse.de>\n+\n+\t* tree-ssa-live.c (remove_unused_locals): Do not remove\n+\theap variables.\n+\t* tree-ssa-structalias.c (handle_lhs_call): Delay setting\n+\tof DECL_EXTERNAL for HEAP variables.\n+\t(compute_points_to_sets): Set DECL_EXTERNAL for escaped\n+\tHEAP variables.  Do not adjust RESTRICT vars.\n+\t(find_what_var_points_to): Nobody cares if something\n+\tpoints to READONLY.\n+\n 2009-07-02  Ben Elliston  <bje@au.ibm.com>\n \n \t* unwind-dw2-fde-glibc.c (_Unwind_IteratePhdrCallback): Move"}, {"sha": "d4166944e972ef0020a70a45480be6bb1df963d5", "filename": "gcc/tree-ssa-live.c", "status": "modified", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/91deb93712047ca1b5d3d5ddf8b0f12b4a164ef8/gcc%2Ftree-ssa-live.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/91deb93712047ca1b5d3d5ddf8b0f12b4a164ef8/gcc%2Ftree-ssa-live.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftree-ssa-live.c?ref=91deb93712047ca1b5d3d5ddf8b0f12b4a164ef8", "patch": "@@ -795,6 +795,7 @@ remove_unused_locals (void)\n \t&& TREE_CODE (t) != PARM_DECL\n \t&& TREE_CODE (t) != RESULT_DECL\n \t&& !(ann = var_ann (t))->used\n+\t&& !ann->is_heapvar\n \t&& !TREE_ADDRESSABLE (t))\n       remove_referenced_var (t);\n   remove_unused_scope_block_p (DECL_INITIAL (current_function_decl));"}, {"sha": "95ca88296d33738c73cffc6b99040dea5fa3ebe4", "filename": "gcc/tree-ssa-structalias.c", "status": "modified", "additions": 7, "deletions": 3, "changes": 10, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/91deb93712047ca1b5d3d5ddf8b0f12b4a164ef8/gcc%2Ftree-ssa-structalias.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/91deb93712047ca1b5d3d5ddf8b0f12b4a164ef8/gcc%2Ftree-ssa-structalias.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftree-ssa-structalias.c?ref=91deb93712047ca1b5d3d5ddf8b0f12b4a164ef8", "patch": "@@ -3475,6 +3475,7 @@ handle_lhs_call (tree lhs, int flags, VEC(ce_s, heap) *rhsc)\n       vi = make_constraint_from_heapvar (get_vi_for_tree (lhs), \"HEAP\");\n       /* We delay marking allocated storage global until we know if\n          it escapes.  */\n+      DECL_EXTERNAL (vi->decl) = 0;\n       vi->is_global_var = 0;\n     }\n   else if (VEC_length (ce_s, rhsc) > 0)\n@@ -4785,8 +4786,10 @@ find_what_var_points_to (varinfo_t vi, struct pt_solution *pt)\n \t  else if (vi->is_heap_var)\n \t    /* We represent heapvars in the points-to set properly.  */\n \t    ;\n+\t  else if (vi->id == readonly_id)\n+\t    /* Nobody cares.  */\n+\t    ;\n \t  else if (vi->id == anything_id\n-\t\t   || vi->id == readonly_id\n \t\t   || vi->id == integer_id)\n \t    pt->anything = 1;\n \t}\n@@ -5460,9 +5463,10 @@ compute_points_to_sets (void)\n   /* Mark escaped HEAP variables as global.  */\n   for (i = 0; VEC_iterate (varinfo_t, varmap, i, vi); ++i)\n     if (vi->is_heap_var\n+\t&& !vi->is_restrict_var\n \t&& !vi->is_global_var)\n-      vi->is_global_var = pt_solution_includes (&cfun->gimple_df->escaped,\n-\t\t\t\t\t\tvi->decl);\n+      DECL_EXTERNAL (vi->decl) = vi->is_global_var\n+\t= pt_solution_includes (&cfun->gimple_df->escaped, vi->decl);\n \n   /* Compute the points-to sets for pointer SSA_NAMEs.  */\n   for (i = 0; i < num_ssa_names; ++i)"}]}