{"sha": "7d67159b48803e2558f33600e2f015f4e251a3e1", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6N2Q2NzE1OWI0ODgwM2UyNTU4ZjMzNjAwZTJmMDE1ZjRlMjUxYTNlMQ==", "commit": {"author": {"name": "Ville Voutilainen", "email": "ville.voutilainen@gmail.com", "date": "2016-05-27T14:59:01Z"}, "committer": {"name": "Ville Voutilainen", "email": "ville@gcc.gnu.org", "date": "2016-05-27T14:59:01Z"}, "message": "re PR c++/69855 (Missing diagnostic for overload that only differs by return type)\n\n/cp\n\tPR c++/69855\n\t* name-lookup.c (pushdecl_maybe_friend_1): Push local function\n\tdecls into the global scope after stripping template bits\n\tand setting DECL_ANTICIPATED.\n\n/testsuite\n\tPR c++/69855\n\t* g++.dg/overload/69855.C: New.\n\t* g++.old-deja/g++.law/missed-error2.C: Adjust.\n\t* g++.old-deja/g++.pt/crash3.C: Likewise.\n\nFrom-SVN: r236826", "tree": {"sha": "5a2c297fd37b69d9c6efc9a705000ebc7a8bca8b", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/5a2c297fd37b69d9c6efc9a705000ebc7a8bca8b"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/7d67159b48803e2558f33600e2f015f4e251a3e1", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/7d67159b48803e2558f33600e2f015f4e251a3e1", "html_url": "https://github.com/Rust-GCC/gccrs/commit/7d67159b48803e2558f33600e2f015f4e251a3e1", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/7d67159b48803e2558f33600e2f015f4e251a3e1/comments", "author": {"login": "villevoutilainen", "id": 963599, "node_id": "MDQ6VXNlcjk2MzU5OQ==", "avatar_url": "https://avatars.githubusercontent.com/u/963599?v=4", "gravatar_id": "", "url": "https://api.github.com/users/villevoutilainen", "html_url": "https://github.com/villevoutilainen", "followers_url": "https://api.github.com/users/villevoutilainen/followers", "following_url": "https://api.github.com/users/villevoutilainen/following{/other_user}", "gists_url": "https://api.github.com/users/villevoutilainen/gists{/gist_id}", "starred_url": "https://api.github.com/users/villevoutilainen/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/villevoutilainen/subscriptions", "organizations_url": "https://api.github.com/users/villevoutilainen/orgs", "repos_url": "https://api.github.com/users/villevoutilainen/repos", "events_url": "https://api.github.com/users/villevoutilainen/events{/privacy}", "received_events_url": "https://api.github.com/users/villevoutilainen/received_events", "type": "User", "site_admin": false}, "committer": {"login": "villevoutilainen", "id": 963599, "node_id": "MDQ6VXNlcjk2MzU5OQ==", "avatar_url": "https://avatars.githubusercontent.com/u/963599?v=4", "gravatar_id": "", "url": "https://api.github.com/users/villevoutilainen", "html_url": "https://github.com/villevoutilainen", "followers_url": "https://api.github.com/users/villevoutilainen/followers", "following_url": "https://api.github.com/users/villevoutilainen/following{/other_user}", "gists_url": "https://api.github.com/users/villevoutilainen/gists{/gist_id}", "starred_url": "https://api.github.com/users/villevoutilainen/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/villevoutilainen/subscriptions", "organizations_url": "https://api.github.com/users/villevoutilainen/orgs", "repos_url": "https://api.github.com/users/villevoutilainen/repos", "events_url": "https://api.github.com/users/villevoutilainen/events{/privacy}", "received_events_url": "https://api.github.com/users/villevoutilainen/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "9b2bf368d7983b683867656160b8f79870daeb97", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/9b2bf368d7983b683867656160b8f79870daeb97", "html_url": "https://github.com/Rust-GCC/gccrs/commit/9b2bf368d7983b683867656160b8f79870daeb97"}], "stats": {"total": 87, "additions": 82, "deletions": 5}, "files": [{"sha": "6c07df156bd2ee98f1cf31bff9426f0a587d9748", "filename": "gcc/cp/ChangeLog", "status": "modified", "additions": 7, "deletions": 0, "changes": 7, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/7d67159b48803e2558f33600e2f015f4e251a3e1/gcc%2Fcp%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/7d67159b48803e2558f33600e2f015f4e251a3e1/gcc%2Fcp%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fcp%2FChangeLog?ref=7d67159b48803e2558f33600e2f015f4e251a3e1", "patch": "@@ -1,3 +1,10 @@\n+2016-05-27  Ville Voutilainen  <ville.voutilainen@gmail.com>\n+\n+\tPR c++/69855\n+\t* name-lookup.c (pushdecl_maybe_friend_1): Push local function\n+\tdecls into the global scope after stripping template bits\n+\tand setting DECL_ANTICIPATED.\n+\n 2016-05-26  Jakub Jelinek  <jakub@redhat.com>\n \n \t* semantics.c (finish_omp_clauses) <case OMP_CLAUSE_SCHEDULE>: Warn"}, {"sha": "568c75e80e4390448802688dc73f3f7521b0e92a", "filename": "gcc/cp/name-lookup.c", "status": "modified", "additions": 18, "deletions": 0, "changes": 18, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/7d67159b48803e2558f33600e2f015f4e251a3e1/gcc%2Fcp%2Fname-lookup.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/7d67159b48803e2558f33600e2f015f4e251a3e1/gcc%2Fcp%2Fname-lookup.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fcp%2Fname-lookup.c?ref=7d67159b48803e2558f33600e2f015f4e251a3e1", "patch": "@@ -929,6 +929,24 @@ pushdecl_maybe_friend_1 (tree x, bool is_friend)\n \t      DECL_ANTICIPATED (t) = 1;\n \t      DECL_HIDDEN_FRIEND_P (t) = 1;\n \t    }\n+\n+\t  if (TREE_CODE (x) == FUNCTION_DECL\n+\t      && DECL_LOCAL_FUNCTION_P (x)\n+\t      && !DECL_OMP_DECLARE_REDUCTION_P (x)\n+\t      && !type_dependent_expression_p (x))\n+\t    {\n+\t      /* PR c++/69855, a local function declaration\n+\t\t is stripped from template info and pushed to\n+\t\t the local scope as a hidden declaration. This\n+\t\t allows ill-formed overloads even in other scopes\n+\t\t to be diagnosed both at the local declaration site\n+\t\t and after it.  */\n+\t      tree t2 = copy_decl (t);\n+\t      DECL_USE_TEMPLATE (t2) = 0;\n+\t      DECL_TEMPLATE_INFO (t2) = NULL_TREE;\n+\t      DECL_ANTICIPATED (t2) = 1;\n+\t      push_overloaded_decl (t2, PUSH_GLOBAL, is_friend);\n+\t    }\n \t}\n \n       if (t != x || DECL_FUNCTION_TEMPLATE_P (t))"}, {"sha": "00c2a99aaea9731c5b5edfd9d1fef507ab71e0b8", "filename": "gcc/testsuite/ChangeLog", "status": "modified", "additions": 7, "deletions": 0, "changes": 7, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/7d67159b48803e2558f33600e2f015f4e251a3e1/gcc%2Ftestsuite%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/7d67159b48803e2558f33600e2f015f4e251a3e1/gcc%2Ftestsuite%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2FChangeLog?ref=7d67159b48803e2558f33600e2f015f4e251a3e1", "patch": "@@ -1,3 +1,10 @@\n+2016-05-27  Ville Voutilainen  <ville.voutilainen@gmail.com>\n+\n+\tPR c++/69855\n+\t* g++.dg/overload/69855.C: New.\n+\t* g++.old-deja/g++.law/missed-error2.C: Adjust.\n+\t* g++.old-deja/g++.pt/crash3.C: Likewise.\n+\n 2016-05-27  Jiong Wang  <jiong.wang@arm.com>\n \n \tPR target/63596"}, {"sha": "dc2d73370325c140e1fb6733f1595e080384e159", "filename": "gcc/testsuite/g++.dg/overload/69855.C", "status": "added", "additions": 44, "deletions": 0, "changes": 44, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/7d67159b48803e2558f33600e2f015f4e251a3e1/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Foverload%2F69855.C", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/7d67159b48803e2558f33600e2f015f4e251a3e1/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Foverload%2F69855.C", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Foverload%2F69855.C?ref=7d67159b48803e2558f33600e2f015f4e251a3e1", "patch": "@@ -0,0 +1,44 @@\n+// PR c++/69855\n+// { dg-do compile }\n+\n+int get();\n+void f() {\n+  char get(); // { dg-error \"ambiguating\" }\n+}\n+\n+int get2();\n+char get2(int);\n+void f2() {\n+  char get2(); // { dg-error \"ambiguating\" }\n+}\n+\n+char get3(int);\n+void f3() {\n+  char get3();\n+}\n+\n+void f4() {\n+  char get4();\n+}\n+int get4(); // { dg-error \"ambiguating\" }\n+\n+void get5();\n+\n+template <class T> struct X\n+{\n+  void g()\n+  {\n+    int get5(); // { dg-error \"ambiguating\" }\n+  }\n+};\n+\n+\n+template <class T> struct X2\n+{\n+  void g()\n+  {\n+    int get6();\n+  }\n+};\n+\n+void get6(); // { dg-error \"ambiguating\" }"}, {"sha": "26ae87d7a2e0930fbed5732e740ea109eb5d200f", "filename": "gcc/testsuite/g++.old-deja/g++.law/missed-error2.C", "status": "modified", "additions": 4, "deletions": 3, "changes": 7, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/7d67159b48803e2558f33600e2f015f4e251a3e1/gcc%2Ftestsuite%2Fg%2B%2B.old-deja%2Fg%2B%2B.law%2Fmissed-error2.C", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/7d67159b48803e2558f33600e2f015f4e251a3e1/gcc%2Ftestsuite%2Fg%2B%2B.old-deja%2Fg%2B%2B.law%2Fmissed-error2.C", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fg%2B%2B.old-deja%2Fg%2B%2B.law%2Fmissed-error2.C?ref=7d67159b48803e2558f33600e2f015f4e251a3e1", "patch": "@@ -25,9 +25,10 @@ int main() {\n    foo(4, -37, 14.39, 14.38);\n }\n \n-// 971006 we no longer give an error for this since we emit a hard error\n-// about the declaration above\n-static void foo(int i, int j, double x, double y) { \n+// 971006 we no longer gave an error for this since we emit a hard error\n+// about the declaration above, but after the fix for PR c++/69855\n+// this declaration emits a diagnostic again\n+static void foo(int i, int j, double x, double y) { // { dg-error \"extern|static\" }\n \n    std::cout << \"Max(int): \" << max(i,j) << \" Max(double): \" <<\n max(x,y) << '\\n';"}, {"sha": "2ba61d9cdb973a20586798d258da62b3db3369a8", "filename": "gcc/testsuite/g++.old-deja/g++.pt/crash3.C", "status": "modified", "additions": 2, "deletions": 2, "changes": 4, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/7d67159b48803e2558f33600e2f015f4e251a3e1/gcc%2Ftestsuite%2Fg%2B%2B.old-deja%2Fg%2B%2B.pt%2Fcrash3.C", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/7d67159b48803e2558f33600e2f015f4e251a3e1/gcc%2Ftestsuite%2Fg%2B%2B.old-deja%2Fg%2B%2B.pt%2Fcrash3.C", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fg%2B%2B.old-deja%2Fg%2B%2B.pt%2Fcrash3.C?ref=7d67159b48803e2558f33600e2f015f4e251a3e1", "patch": "@@ -10,7 +10,7 @@ public:\n     }\n     CVector<long> g() const\n     {\n-       CVector<long> v();\n-       return v;\n+       CVector<long> v2();\n+       return v2;\n     }\n };"}]}