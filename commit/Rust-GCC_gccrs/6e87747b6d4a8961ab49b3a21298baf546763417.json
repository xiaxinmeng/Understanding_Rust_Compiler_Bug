{"sha": "6e87747b6d4a8961ab49b3a21298baf546763417", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6NmU4Nzc0N2I2ZDRhODk2MWFiNDliM2EyMTI5OGJhZjU0Njc2MzQxNw==", "commit": {"author": {"name": "Tom Tromey", "email": "tromey@cygnus.com", "date": "1999-09-01T18:29:39Z"}, "committer": {"name": "Tom Tromey", "email": "tromey@gcc.gnu.org", "date": "1999-09-01T18:29:39Z"}, "message": "posix-threads.cc (_Jv_CondWait): Call _Jv_PthreadCheckMonitor.\n\n\t* posix-threads.cc (_Jv_CondWait): Call _Jv_PthreadCheckMonitor.\n\t* include/posix-threads.h (_Jv_PthreadCheckMonitor): New\n\tfunction.\n\t(_Jv_CondNotify): Use it.\n\t(_Jv_CondNotifyAll): Likewise.\n\n\t* java/lang/Class.h (JV_STATE_NOTHING): Correct misspelling.\n\nFrom-SVN: r29030", "tree": {"sha": "6fb15ec8b692fb14a98a2eaba9879e17e7f496a6", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/6fb15ec8b692fb14a98a2eaba9879e17e7f496a6"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/6e87747b6d4a8961ab49b3a21298baf546763417", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/6e87747b6d4a8961ab49b3a21298baf546763417", "html_url": "https://github.com/Rust-GCC/gccrs/commit/6e87747b6d4a8961ab49b3a21298baf546763417", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/6e87747b6d4a8961ab49b3a21298baf546763417/comments", "author": null, "committer": null, "parents": [{"sha": "b1133adfca2570b32dd7ded5a53b336630f593d1", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/b1133adfca2570b32dd7ded5a53b336630f593d1", "html_url": "https://github.com/Rust-GCC/gccrs/commit/b1133adfca2570b32dd7ded5a53b336630f593d1"}], "stats": {"total": 48, "additions": 40, "deletions": 8}, "files": [{"sha": "5a6d8a80b0a08c128b5af1258417c368467abf53", "filename": "libjava/ChangeLog", "status": "modified", "additions": 10, "deletions": 0, "changes": 10, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/6e87747b6d4a8961ab49b3a21298baf546763417/libjava%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/6e87747b6d4a8961ab49b3a21298baf546763417/libjava%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libjava%2FChangeLog?ref=6e87747b6d4a8961ab49b3a21298baf546763417", "patch": "@@ -1,3 +1,13 @@\n+1999-09-01  Tom Tromey  <tromey@cygnus.com>\n+\n+\t* posix-threads.cc (_Jv_CondWait): Call _Jv_PthreadCheckMonitor.\n+\t* include/posix-threads.h (_Jv_PthreadCheckMonitor): New\n+\tfunction.\n+\t(_Jv_CondNotify): Use it.\n+\t(_Jv_CondNotifyAll): Likewise.\n+\n+\t* java/lang/Class.h (JV_STATE_NOTHING): Correct misspelling.\n+\n 1999-08-31  Tom Tromey  <tromey@cygnus.com>\n \n \t* include/jvm.h (_Jv_makeUtf8TypeConst): Removed unused"}, {"sha": "2ad6c06e04724647728dcd8bd54171b19ea23e9a", "filename": "libjava/include/posix-threads.h", "status": "modified", "additions": 23, "deletions": 6, "changes": 29, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/6e87747b6d4a8961ab49b3a21298baf546763417/libjava%2Finclude%2Fposix-threads.h", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/6e87747b6d4a8961ab49b3a21298baf546763417/libjava%2Finclude%2Fposix-threads.h", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libjava%2Finclude%2Fposix-threads.h?ref=6e87747b6d4a8961ab49b3a21298baf546763417", "patch": "@@ -65,6 +65,25 @@ typedef struct\n typedef void _Jv_ThreadStartFunc (java::lang::Thread *);\n \n \n+// This is a convenience function used only by the pthreads thread\n+// implementation.  This is slow, but that's too bad -- we need to do\n+// the checks for correctness.  It might be nice to be able to compile\n+// this out.\n+inline int _Jv_PthreadCheckMonitor (_Jv_Mutex_t *mu)\n+{\n+  pthread_mutex_t *pmu;\n+#ifdef HAVE_RECURSIVE_MUTEX\n+  pmu = mu;\n+#else\n+  pmu = &mu->mutex2;\n+#endif\n+  // See if the mutex is locked by this thread.\n+  if (pthread_mutex_trylock (pmu))\n+    return 1;\n+  pthread_mutex_unlock (pmu);\n+  return 0;\n+}\n+\n //\n // Condition variables.\n //\n@@ -94,17 +113,15 @@ int _Jv_CondWait (_Jv_ConditionVariable_t *cv, _Jv_Mutex_t *mu,\n \t\t  jlong millis, jint nanos);\n \n inline int\n-_Jv_CondNotify (_Jv_ConditionVariable_t *cv, _Jv_Mutex_t *)\n+_Jv_CondNotify (_Jv_ConditionVariable_t *cv, _Jv_Mutex_t *mu)\n {\n-  // FIXME: check to see if mutex is held by current thread.\n-  return pthread_cond_signal (cv);\n+  return _Jv_PthreadCheckMonitor (mu) || pthread_cond_signal (cv);\n }\n \n inline int\n-_Jv_CondNotifyAll (_Jv_ConditionVariable_t *cv, _Jv_Mutex_t *)\n+_Jv_CondNotifyAll (_Jv_ConditionVariable_t *cv, _Jv_Mutex_t *mu)\n {\n-  // FIXME: check to see if mutex is held by current thread.\n-  return pthread_cond_broadcast (cv);\n+  return _Jv_PthreadCheckMonitor (mu) || pthread_cond_broadcast (cv);\n }\n \n "}, {"sha": "fd2c2eba777d4a97287daaeac151079296977676", "filename": "libjava/java/lang/Class.h", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/6e87747b6d4a8961ab49b3a21298baf546763417/libjava%2Fjava%2Flang%2FClass.h", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/6e87747b6d4a8961ab49b3a21298baf546763417/libjava%2Fjava%2Flang%2FClass.h", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libjava%2Fjava%2Flang%2FClass.h?ref=6e87747b6d4a8961ab49b3a21298baf546763417", "patch": "@@ -27,7 +27,7 @@ extern \"C\" void _Jv_RegisterClasses (jclass *classes);\n // `resolved' must come between `nothing' and the other states.\n // Whenever the state changes, one should notify all waiters of this\n // class.\n-#define JV_STATE_NOTING        0 // set by compiler\n+#define JV_STATE_NOTHING       0 // set by compiler\n \n #define JV_STATE_PRELOADING    1 // can do _Jv_FindClass\n #define JV_STATE_LOADING       3 // has super installed"}, {"sha": "0bd7cd0d9e94035260f7dd4347fad374b41e772f", "filename": "libjava/java/lang/natClassLoader.cc", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/6e87747b6d4a8961ab49b3a21298baf546763417/libjava%2Fjava%2Flang%2FnatClassLoader.cc", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/6e87747b6d4a8961ab49b3a21298baf546763417/libjava%2Fjava%2Flang%2FnatClassLoader.cc", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libjava%2Fjava%2Flang%2FnatClassLoader.cc?ref=6e87747b6d4a8961ab49b3a21298baf546763417", "patch": "@@ -405,7 +405,7 @@ _Jv_RegisterClasses (jclass *classes)\n \n       // registering a compiled class causes\n       // it to be immediately \"prepared\".  \n-      if (klass->state == JV_STATE_NOTING)\n+      if (klass->state == JV_STATE_NOTHING)\n \tklass->state = JV_STATE_COMPILED;\n     }\n }"}, {"sha": "413f7c3bfce6c2e1cd4c12870da97030a7b2c660", "filename": "libjava/posix-threads.cc", "status": "modified", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/6e87747b6d4a8961ab49b3a21298baf546763417/libjava%2Fposix-threads.cc", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/6e87747b6d4a8961ab49b3a21298baf546763417/libjava%2Fposix-threads.cc", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libjava%2Fposix-threads.cc?ref=6e87747b6d4a8961ab49b3a21298baf546763417", "patch": "@@ -75,13 +75,17 @@ int\n _Jv_CondWait (_Jv_ConditionVariable_t *cv, _Jv_Mutex_t *mu,\n \t      jlong millis, jint nanos)\n {\n+  if (_Jv_PthreadCheckMonitor (mu))\n+    return 1;\n+\n   int r;\n   pthread_mutex_t *pmu;\n #ifdef HAVE_RECURSIVE_MUTEX\n   pmu = mu;\n #else\n   pmu = &mu->mutex2;\n #endif\n+\n   if (millis == 0 && nanos == 0)\n     r = pthread_cond_wait (cv, pmu);\n   else\n@@ -96,6 +100,7 @@ _Jv_CondWait (_Jv_ConditionVariable_t *cv, _Jv_Mutex_t *mu,\n       if (r && errno == ETIMEDOUT)\n \tr = 0;\n     }\n+\n   return r;\n }\n "}]}