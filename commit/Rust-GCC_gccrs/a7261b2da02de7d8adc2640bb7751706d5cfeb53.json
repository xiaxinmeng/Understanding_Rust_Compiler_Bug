{"sha": "a7261b2da02de7d8adc2640bb7751706d5cfeb53", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6YTcyNjFiMmRhMDJkZTdkOGFkYzI2NDBiYjc3NTE3MDZkNWNmZWI1Mw==", "commit": {"author": {"name": "Jeff Sturm", "email": "jsturm@one-point.com", "date": "2002-02-24T17:55:44Z"}, "committer": {"name": "Jeff Sturm", "email": "jsturm@gcc.gnu.org", "date": "2002-02-24T17:55:44Z"}, "message": "natMethod.cc (_Jv_CallAnyMethodA): Define ffi_result union for ffi_call result.\n\n        * java/lang/reflect/natMethod.cc (_Jv_CallAnyMethodA):\n        Define ffi_result union for ffi_call result.  Cast\n        ffi_result members to jvalue.\n\nFrom-SVN: r50007", "tree": {"sha": "fc1dd755b6284db55539e69c6e09dec22014b349", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/fc1dd755b6284db55539e69c6e09dec22014b349"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/a7261b2da02de7d8adc2640bb7751706d5cfeb53", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/a7261b2da02de7d8adc2640bb7751706d5cfeb53", "html_url": "https://github.com/Rust-GCC/gccrs/commit/a7261b2da02de7d8adc2640bb7751706d5cfeb53", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/a7261b2da02de7d8adc2640bb7751706d5cfeb53/comments", "author": null, "committer": null, "parents": [{"sha": "02c521f4392d281744a926822200fd8afb90132e", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/02c521f4392d281744a926822200fd8afb90132e", "html_url": "https://github.com/Rust-GCC/gccrs/commit/02c521f4392d281744a926822200fd8afb90132e"}], "stats": {"total": 49, "additions": 48, "deletions": 1}, "files": [{"sha": "c6561ab84d6ad2a58f2c9c787f99115b32e7c18a", "filename": "libjava/ChangeLog", "status": "modified", "additions": 6, "deletions": 0, "changes": 6, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/a7261b2da02de7d8adc2640bb7751706d5cfeb53/libjava%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/a7261b2da02de7d8adc2640bb7751706d5cfeb53/libjava%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libjava%2FChangeLog?ref=a7261b2da02de7d8adc2640bb7751706d5cfeb53", "patch": "@@ -1,3 +1,9 @@\n+2002-02-24  Jeff Sturm  <jsturm@one-point.com>\n+\n+\t* java/lang/reflect/natMethod.cc (_Jv_CallAnyMethodA):\n+\tDefine ffi_result union for ffi_call result.  Cast\n+\tffi_result members to jvalue.\n+ \n 2002-02-23  Alexandre Oliva  <aoliva@redhat.com>\n \n \t* Makefile.in, gcj/Makefile.in, include/Makefile.in: Rebuilt."}, {"sha": "e11e5c3677c6e2e2015229202cb5bb4d71ce05fe", "filename": "libjava/java/lang/reflect/natMethod.cc", "status": "modified", "additions": 42, "deletions": 1, "changes": 43, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/a7261b2da02de7d8adc2640bb7751706d5cfeb53/libjava%2Fjava%2Flang%2Freflect%2FnatMethod.cc", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/a7261b2da02de7d8adc2640bb7751706d5cfeb53/libjava%2Fjava%2Flang%2Freflect%2FnatMethod.cc", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libjava%2Fjava%2Flang%2Freflect%2FnatMethod.cc?ref=a7261b2da02de7d8adc2640bb7751706d5cfeb53", "patch": "@@ -423,9 +423,17 @@ _Jv_CallAnyMethodA (jobject obj,\n \n   Throwable *ex = NULL;\n \n+  union\n+  {\n+    ffi_arg i;\n+    jlong l;\n+    jfloat f;\n+    jdouble d;\n+  } ffi_result;\n+\n   try\n     {\n-      ffi_call (&cif, (void (*)()) meth->ncode, result, values);\n+      ffi_call (&cif, (void (*)()) meth->ncode, &ffi_result, values);\n     }\n   catch (Throwable *ex2)\n     {\n@@ -436,6 +444,39 @@ _Jv_CallAnyMethodA (jobject obj,\n       ex = new InvocationTargetException (ex2);\n     }\n \n+  // Since ffi_call returns integer values promoted to a word, use\n+  // a narrowing conversion for jbyte, jchar, etc. results.\n+  // Note that boolean is handled either by the FFI_TYPE_SINT8 or\n+  // FFI_TYPE_SINT32 case.\n+  switch (rtype->type)\n+    {\n+    case FFI_TYPE_VOID:\n+      break;\n+    case FFI_TYPE_SINT8:\n+      result->b = (jbyte)ffi_result.i;\n+      break;\n+    case FFI_TYPE_SINT16:\n+      result->s = (jshort)ffi_result.i;\n+      break;\n+    case FFI_TYPE_UINT16:\n+      result->c = (jchar)ffi_result.i;\n+      break;\n+    case FFI_TYPE_SINT32:\n+      result->i = (jint)ffi_result.i;\n+      break;\n+    case FFI_TYPE_SINT64:\n+      result->j = (jlong)ffi_result.l;\n+      break;\n+    case FFI_TYPE_FLOAT:\n+      result->f = (jfloat)ffi_result.f;\n+      break;\n+    case FFI_TYPE_DOUBLE:\n+      result->d = (jdouble)ffi_result.d;\n+      break;\n+    default:\n+      JvFail (\"Unknown ffi_call return type\");\n+      break;\n+    }\n   if (is_constructor)\n     result->l = obj;\n "}]}