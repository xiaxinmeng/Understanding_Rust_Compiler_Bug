{"sha": "430d1e8de0800bc758534ad8048d9e8d53bb2335", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6NDMwZDFlOGRlMDgwMGJjNzU4NTM0YWQ4MDQ4ZDllOGQ1M2JiMjMzNQ==", "commit": {"author": {"name": "Martin Liska", "email": "mliska@suse.cz", "date": "2019-10-30T12:02:17Z"}, "committer": {"name": "Martin Liska", "email": "marxin@gcc.gnu.org", "date": "2019-10-30T12:02:17Z"}, "message": "Remove comparison for polymorphic types.\n\n2019-10-30  Martin Liska  <mliska@suse.cz>\n\n\t* ipa-icf-gimple.c (func_checker::func_checker): Do not\n\tinitialize m_compare_polymorphic.\n\t(func_checker::compare_decl): Do not compare polymorphic types.\n\t* ipa-icf-gimple.h (m_compare_polymorphic): Remove.\n\t* ipa-icf.c (sem_function::equals_private): Do not call\n\tcompare_polymorphic_p.\n\nFrom-SVN: r277617", "tree": {"sha": "e25b86c0c2b6b181f704312936aea7a2f17627fb", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/e25b86c0c2b6b181f704312936aea7a2f17627fb"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/430d1e8de0800bc758534ad8048d9e8d53bb2335", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/430d1e8de0800bc758534ad8048d9e8d53bb2335", "html_url": "https://github.com/Rust-GCC/gccrs/commit/430d1e8de0800bc758534ad8048d9e8d53bb2335", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/430d1e8de0800bc758534ad8048d9e8d53bb2335/comments", "author": {"login": "marxin", "id": 2658545, "node_id": "MDQ6VXNlcjI2NTg1NDU=", "avatar_url": "https://avatars.githubusercontent.com/u/2658545?v=4", "gravatar_id": "", "url": "https://api.github.com/users/marxin", "html_url": "https://github.com/marxin", "followers_url": "https://api.github.com/users/marxin/followers", "following_url": "https://api.github.com/users/marxin/following{/other_user}", "gists_url": "https://api.github.com/users/marxin/gists{/gist_id}", "starred_url": "https://api.github.com/users/marxin/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/marxin/subscriptions", "organizations_url": "https://api.github.com/users/marxin/orgs", "repos_url": "https://api.github.com/users/marxin/repos", "events_url": "https://api.github.com/users/marxin/events{/privacy}", "received_events_url": "https://api.github.com/users/marxin/received_events", "type": "User", "site_admin": false}, "committer": null, "parents": [{"sha": "938bba616d438fadf604fdea50395d3fe356ef72", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/938bba616d438fadf604fdea50395d3fe356ef72", "html_url": "https://github.com/Rust-GCC/gccrs/commit/938bba616d438fadf604fdea50395d3fe356ef72"}], "stats": {"total": 32, "additions": 9, "deletions": 23}, "files": [{"sha": "3537a6152c1c8c9fe04baff11095d54c0bbc47c4", "filename": "gcc/ChangeLog", "status": "modified", "additions": 9, "deletions": 0, "changes": 9, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/430d1e8de0800bc758534ad8048d9e8d53bb2335/gcc%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/430d1e8de0800bc758534ad8048d9e8d53bb2335/gcc%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2FChangeLog?ref=430d1e8de0800bc758534ad8048d9e8d53bb2335", "patch": "@@ -1,3 +1,12 @@\n+2019-10-30  Martin Liska  <mliska@suse.cz>\n+\n+\t* ipa-icf-gimple.c (func_checker::func_checker): Do not\n+\tinitialize m_compare_polymorphic.\n+\t(func_checker::compare_decl): Do not compare polymorphic types.\n+\t* ipa-icf-gimple.h (m_compare_polymorphic): Remove.\n+\t* ipa-icf.c (sem_function::equals_private): Do not call\n+\tcompare_polymorphic_p.\n+\n 2019-10-30  Martin Liska  <mliska@suse.cz>\n \n \t* ipa-icf-gimple.c (func_checker::compare_ssa_name): Call"}, {"sha": "3193823ce5a0b30c0e9e6a959aa4032315c1b8e8", "filename": "gcc/ipa-icf-gimple.c", "status": "modified", "additions": 0, "deletions": 18, "changes": 18, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/430d1e8de0800bc758534ad8048d9e8d53bb2335/gcc%2Fipa-icf-gimple.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/430d1e8de0800bc758534ad8048d9e8d53bb2335/gcc%2Fipa-icf-gimple.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fipa-icf-gimple.c?ref=430d1e8de0800bc758534ad8048d9e8d53bb2335", "patch": "@@ -51,14 +51,12 @@ namespace ipa_icf_gimple {\n    of declarations that can be skipped.  */\n \n func_checker::func_checker (tree source_func_decl, tree target_func_decl,\n-\t\t\t    bool compare_polymorphic,\n \t\t\t    bool ignore_labels,\n \t\t\t    hash_set<symtab_node *> *ignored_source_nodes,\n \t\t\t    hash_set<symtab_node *> *ignored_target_nodes)\n   : m_source_func_decl (source_func_decl), m_target_func_decl (target_func_decl),\n     m_ignored_source_nodes (ignored_source_nodes),\n     m_ignored_target_nodes (ignored_target_nodes),\n-    m_compare_polymorphic (compare_polymorphic),\n     m_ignore_labels (ignore_labels)\n {\n   function *source_func = DECL_STRUCT_FUNCTION (source_func_decl);\n@@ -156,23 +154,7 @@ func_checker::compare_decl (tree t1, tree t2)\n   if (!compatible_types_p (TREE_TYPE (t1), TREE_TYPE (t2)))\n     return return_false ();\n \n-  /* TODO: we are actually too strict here.  We only need to compare if\n-     T1 can be used in polymorphic call.  */\n-  if (TREE_ADDRESSABLE (t1)\n-      && m_compare_polymorphic\n-      && !compatible_polymorphic_types_p (TREE_TYPE (t1), TREE_TYPE (t2),\n-\t\t\t\t\t  false))\n-    return return_false ();\n-\n-  if ((t == VAR_DECL || t == PARM_DECL || t == RESULT_DECL)\n-      && DECL_BY_REFERENCE (t1)\n-      && m_compare_polymorphic\n-      && !compatible_polymorphic_types_p (TREE_TYPE (t1), TREE_TYPE (t2),\n-\t\t\t\t\t  true))\n-    return return_false ();\n-\n   bool existed_p;\n-\n   tree &slot = m_decl_map.get_or_insert (t1, &existed_p);\n   if (existed_p)\n     return return_with_debug (slot == t2);"}, {"sha": "8e0f03c1d141f421fd884f554f380a52247e0276", "filename": "gcc/ipa-icf-gimple.h", "status": "modified", "additions": 0, "deletions": 4, "changes": 4, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/430d1e8de0800bc758534ad8048d9e8d53bb2335/gcc%2Fipa-icf-gimple.h", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/430d1e8de0800bc758534ad8048d9e8d53bb2335/gcc%2Fipa-icf-gimple.h", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fipa-icf-gimple.h?ref=430d1e8de0800bc758534ad8048d9e8d53bb2335", "patch": "@@ -128,7 +128,6 @@ class func_checker : operand_compare\n      Similarly, IGNORE_SOURCE_DECLS and IGNORE_TARGET_DECLS are sets\n      of declarations that can be skipped.  */\n   func_checker (tree source_func_decl, tree target_func_decl,\n-\t\tbool compare_polymorphic,\n \t\tbool ignore_labels = false,\n \t\thash_set<symtab_node *> *ignored_source_nodes = NULL,\n \t\thash_set<symtab_node *> *ignored_target_nodes = NULL);\n@@ -258,9 +257,6 @@ class func_checker : operand_compare\n   /* Label to basic block index mapping.  */\n   hash_map <tree, int> m_label_bb_map;\n \n-  /* Flag if polymorphic comparison should be executed.  */\n-  bool m_compare_polymorphic;\n-\n   /* Flag if ignore labels in comparison.  */\n   bool m_ignore_labels;\n "}, {"sha": "67dd56f3f172434c183f488814c3bf06ffd53bff", "filename": "gcc/ipa-icf.c", "status": "modified", "additions": 0, "deletions": 1, "changes": 1, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/430d1e8de0800bc758534ad8048d9e8d53bb2335/gcc%2Fipa-icf.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/430d1e8de0800bc758534ad8048d9e8d53bb2335/gcc%2Fipa-icf.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fipa-icf.c?ref=430d1e8de0800bc758534ad8048d9e8d53bb2335", "patch": "@@ -845,7 +845,6 @@ sem_function::equals_private (sem_item *item)\n     return return_false ();\n \n   m_checker = new func_checker (decl, m_compared_func->decl,\n-\t\t\t\tcompare_polymorphic_p (),\n \t\t\t\tfalse,\n \t\t\t\t&refs_set,\n \t\t\t\t&m_compared_func->refs_set);"}]}