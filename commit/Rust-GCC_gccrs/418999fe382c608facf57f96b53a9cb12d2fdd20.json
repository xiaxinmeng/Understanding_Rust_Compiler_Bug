{"sha": "418999fe382c608facf57f96b53a9cb12d2fdd20", "node_id": "C_kwDOANBUbNoAKDQxODk5OWZlMzgyYzYwOGZhY2Y1N2Y5NmI1M2E5Y2IxMmQyZmRkMjA", "commit": {"author": {"name": "Jonathan Wakely", "email": "jwakely@redhat.com", "date": "2022-11-03T11:48:57Z"}, "committer": {"name": "Jonathan Wakely", "email": "jwakely@redhat.com", "date": "2022-11-04T14:04:53Z"}, "message": "libstdc++: Simplify lifetime of eh_globals variable [PR107500]\n\nSince this is a trivial type, we probably don't need to do anything to\nensure it's still accessible after other static dtors.\n\nlibstdc++-v3/ChangeLog:\n\n\tPR libstdc++/107500\n\t* libsupc++/eh_globals.cc (eh_globals): Remove immortalizing\n\twrapper.\n\t(__cxxabiv1::__cxa_get_globals_fast): Adjust.\n\t(__cxxabiv1::__cxa_get_globals): Adjust.", "tree": {"sha": "7d693603c6ea58df24186cad0acb80bfdc9407f1", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/7d693603c6ea58df24186cad0acb80bfdc9407f1"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/418999fe382c608facf57f96b53a9cb12d2fdd20", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/418999fe382c608facf57f96b53a9cb12d2fdd20", "html_url": "https://github.com/Rust-GCC/gccrs/commit/418999fe382c608facf57f96b53a9cb12d2fdd20", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/418999fe382c608facf57f96b53a9cb12d2fdd20/comments", "author": {"login": "jwakely", "id": 1254480, "node_id": "MDQ6VXNlcjEyNTQ0ODA=", "avatar_url": "https://avatars.githubusercontent.com/u/1254480?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jwakely", "html_url": "https://github.com/jwakely", "followers_url": "https://api.github.com/users/jwakely/followers", "following_url": "https://api.github.com/users/jwakely/following{/other_user}", "gists_url": "https://api.github.com/users/jwakely/gists{/gist_id}", "starred_url": "https://api.github.com/users/jwakely/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jwakely/subscriptions", "organizations_url": "https://api.github.com/users/jwakely/orgs", "repos_url": "https://api.github.com/users/jwakely/repos", "events_url": "https://api.github.com/users/jwakely/events{/privacy}", "received_events_url": "https://api.github.com/users/jwakely/received_events", "type": "User", "site_admin": false}, "committer": {"login": "jwakely", "id": 1254480, "node_id": "MDQ6VXNlcjEyNTQ0ODA=", "avatar_url": "https://avatars.githubusercontent.com/u/1254480?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jwakely", "html_url": "https://github.com/jwakely", "followers_url": "https://api.github.com/users/jwakely/followers", "following_url": "https://api.github.com/users/jwakely/following{/other_user}", "gists_url": "https://api.github.com/users/jwakely/gists{/gist_id}", "starred_url": "https://api.github.com/users/jwakely/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jwakely/subscriptions", "organizations_url": "https://api.github.com/users/jwakely/orgs", "repos_url": "https://api.github.com/users/jwakely/repos", "events_url": "https://api.github.com/users/jwakely/events{/privacy}", "received_events_url": "https://api.github.com/users/jwakely/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "f505f37a8e5a7646af4038b5c46f72d8a05dc7f0", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/f505f37a8e5a7646af4038b5c46f72d8a05dc7f0", "html_url": "https://github.com/Rust-GCC/gccrs/commit/f505f37a8e5a7646af4038b5c46f72d8a05dc7f0"}], "stats": {"total": 20, "additions": 5, "deletions": 15}, "files": [{"sha": "74e8a454ecc35d013079e8f032173d374789a8db", "filename": "libstdc++-v3/libsupc++/eh_globals.cc", "status": "modified", "additions": 5, "deletions": 15, "changes": 20, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/418999fe382c608facf57f96b53a9cb12d2fdd20/libstdc%2B%2B-v3%2Flibsupc%2B%2B%2Feh_globals.cc", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/418999fe382c608facf57f96b53a9cb12d2fdd20/libstdc%2B%2B-v3%2Flibsupc%2B%2B%2Feh_globals.cc", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libstdc%2B%2B-v3%2Flibsupc%2B%2B%2Feh_globals.cc?ref=418999fe382c608facf57f96b53a9cb12d2fdd20", "patch": "@@ -70,18 +70,8 @@ __cxxabiv1::__cxa_get_globals() _GLIBCXX_NOTHROW\n \n namespace\n {\n-  struct constant_init\n-  {\n-    union {\n-      __cxa_eh_globals obj;\n-    };\n-    constexpr constant_init() : obj() { }\n-\n-    ~constant_init() { /* do nothing, union member is not destroyed */ }\n-  };\n-\n   // Single-threaded fallback buffer.\n-  __constinit constant_init eh_globals;\n+  __constinit __cxa_eh_globals eh_globals;\n }\n \n #if __GTHREADS\n@@ -142,7 +132,7 @@ __cxxabiv1::__cxa_get_globals_fast() _GLIBCXX_NOTHROW\n   if (init._S_init)\n     g = static_cast<__cxa_eh_globals*>(__gthread_getspecific(init._M_key));\n   else\n-    g = &eh_globals.obj;\n+    g = &eh_globals;\n   return g;\n }\n \n@@ -167,19 +157,19 @@ __cxxabiv1::__cxa_get_globals() _GLIBCXX_NOTHROW\n \t}\n     }\n   else\n-    g = &eh_globals.obj;\n+    g = &eh_globals;\n   return g;\n }\n \n #else\n \n extern \"C\" __cxa_eh_globals*\n __cxxabiv1::__cxa_get_globals_fast() _GLIBCXX_NOTHROW\n-{ return &eh_globals.obj; }\n+{ return &eh_globals; }\n \n extern \"C\" __cxa_eh_globals*\n __cxxabiv1::__cxa_get_globals() _GLIBCXX_NOTHROW\n-{ return &eh_globals.obj; }\n+{ return &eh_globals; }\n \n #endif\n "}]}