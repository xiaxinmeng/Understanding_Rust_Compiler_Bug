{"sha": "bd6ecbe48ada79bb14cbb30ef8318495b5237790", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6YmQ2ZWNiZTQ4YWRhNzliYjE0Y2JiMzBlZjgzMTg0OTViNTIzNzc5MA==", "commit": {"author": {"name": "Martin Storsj\u00f6", "email": "martin@martin.st", "date": "2020-09-08T12:21:51Z"}, "committer": {"name": "Jonathan Yong", "email": "10walls@gmail.com", "date": "2020-11-03T00:30:35Z"}, "message": "libgcc: Expose the instruction pointer and stack pointer in SEH _Unwind_Backtrace\n\nPreviously, the SEH version of _Unwind_Backtrace did unwind\nthe stack and call the provided callback function as intended,\nbut there was little the caller could do within the callback to\nactually get any info about that particular level in the unwind.\n\nSet the ra and cfa pointers, which are used by _Unwind_GetIP\nand _Unwind_GetCFA, to allow using these functions from the\ncallacb to inspect the state at each stack frame.\n\n2020-09-08  Martin Storsj\u00f6  <martin@martin.st>\n\n\tlibgcc/\n\t* unwind-seh.c (_Unwind_Backtrace): Set the ra and cfa pointers\n\tbefore calling the callback.", "tree": {"sha": "1f7a9038f9f577216f5962c0333c39257f05802b", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/1f7a9038f9f577216f5962c0333c39257f05802b"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/bd6ecbe48ada79bb14cbb30ef8318495b5237790", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/bd6ecbe48ada79bb14cbb30ef8318495b5237790", "html_url": "https://github.com/Rust-GCC/gccrs/commit/bd6ecbe48ada79bb14cbb30ef8318495b5237790", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/bd6ecbe48ada79bb14cbb30ef8318495b5237790/comments", "author": {"login": "mstorsjo", "id": 69727, "node_id": "MDQ6VXNlcjY5NzI3", "avatar_url": "https://avatars.githubusercontent.com/u/69727?v=4", "gravatar_id": "", "url": "https://api.github.com/users/mstorsjo", "html_url": "https://github.com/mstorsjo", "followers_url": "https://api.github.com/users/mstorsjo/followers", "following_url": "https://api.github.com/users/mstorsjo/following{/other_user}", "gists_url": "https://api.github.com/users/mstorsjo/gists{/gist_id}", "starred_url": "https://api.github.com/users/mstorsjo/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/mstorsjo/subscriptions", "organizations_url": "https://api.github.com/users/mstorsjo/orgs", "repos_url": "https://api.github.com/users/mstorsjo/repos", "events_url": "https://api.github.com/users/mstorsjo/events{/privacy}", "received_events_url": "https://api.github.com/users/mstorsjo/received_events", "type": "User", "site_admin": false}, "committer": {"login": "jon-y", "id": 4688224, "node_id": "MDQ6VXNlcjQ2ODgyMjQ=", "avatar_url": "https://avatars.githubusercontent.com/u/4688224?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jon-y", "html_url": "https://github.com/jon-y", "followers_url": "https://api.github.com/users/jon-y/followers", "following_url": "https://api.github.com/users/jon-y/following{/other_user}", "gists_url": "https://api.github.com/users/jon-y/gists{/gist_id}", "starred_url": "https://api.github.com/users/jon-y/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jon-y/subscriptions", "organizations_url": "https://api.github.com/users/jon-y/orgs", "repos_url": "https://api.github.com/users/jon-y/repos", "events_url": "https://api.github.com/users/jon-y/events{/privacy}", "received_events_url": "https://api.github.com/users/jon-y/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "18f8fc9329c8ddd6db272e3c643f28bea11e52e4", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/18f8fc9329c8ddd6db272e3c643f28bea11e52e4", "html_url": "https://github.com/Rust-GCC/gccrs/commit/18f8fc9329c8ddd6db272e3c643f28bea11e52e4"}], "stats": {"total": 5, "additions": 5, "deletions": 0}, "files": [{"sha": "275d782903ad6eb6b4b72dcb15ad62774607f671", "filename": "libgcc/unwind-seh.c", "status": "modified", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/bd6ecbe48ada79bb14cbb30ef8318495b5237790/libgcc%2Funwind-seh.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/bd6ecbe48ada79bb14cbb30ef8318495b5237790/libgcc%2Funwind-seh.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libgcc%2Funwind-seh.c?ref=bd6ecbe48ada79bb14cbb30ef8318495b5237790", "patch": "@@ -466,6 +466,11 @@ _Unwind_Backtrace(_Unwind_Trace_Fn trace,\n \t\t\t    &gcc_context.disp->HandlerData,\n \t\t\t    &gcc_context.disp->EstablisherFrame, NULL);\n \n+      /* Set values that the callback can inspect via _Unwind_GetIP\n+       * and _Unwind_GetCFA. */\n+      gcc_context.ra = ms_context.Rip;\n+      gcc_context.cfa = ms_context.Rsp;\n+\n       /* Call trace function.  */\n       if (trace (&gcc_context, trace_argument) != _URC_NO_REASON)\n \treturn _URC_FATAL_PHASE1_ERROR;"}]}