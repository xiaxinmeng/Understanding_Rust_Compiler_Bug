{"sha": "a1a6b912b5f905e768da4d0f434591b4d523be49", "node_id": "C_kwDOANBUbNoAKGExYTZiOTEyYjVmOTA1ZTc2OGRhNGQwZjQzNDU5MWI0ZDUyM2JlNDk", "commit": {"author": {"name": "Christoph M\u00fcllner", "email": "christoph.muellner@vrull.eu", "date": "2022-10-27T18:42:30Z"}, "committer": {"name": "Philipp Tomsich", "email": "philipp.tomsich@vrull.eu", "date": "2022-11-02T19:07:08Z"}, "message": "RISC-V: Add Zawrs ISA extension support\n\nThis patch adds support for the Zawrs ISA extension.\nZawrs has been ratified by the RISC-V BoD on Oct 20th, 2022.\n\nBinutils support has been merged as:\n  https://sourceware.org/git/?p=binutils-gdb.git;a=commit;h=eb668e50036e979fb0a74821df4eee0307b44e66\n\ngcc/ChangeLog:\n\n\t* common/config/riscv/riscv-common.cc: Add zawrs extension.\n\t* config/riscv/riscv-opts.h (MASK_ZAWRS): New.\n\t(TARGET_ZAWRS): New.\n\t* config/riscv/riscv.opt: New.\n\ngcc/testsuite/ChangeLog:\n\n\t* gcc.target/riscv/zawrs.c: New test.\n\nSigned-off-by: Christoph M\u00fcllner <christoph.muellner@vrull.eu>", "tree": {"sha": "79ccfa98309b43376978f0b56caf46197f6cd16f", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/79ccfa98309b43376978f0b56caf46197f6cd16f"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/a1a6b912b5f905e768da4d0f434591b4d523be49", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/a1a6b912b5f905e768da4d0f434591b4d523be49", "html_url": "https://github.com/Rust-GCC/gccrs/commit/a1a6b912b5f905e768da4d0f434591b4d523be49", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/a1a6b912b5f905e768da4d0f434591b4d523be49/comments", "author": {"login": "cmuellner", "id": 92810, "node_id": "MDQ6VXNlcjkyODEw", "avatar_url": "https://avatars.githubusercontent.com/u/92810?v=4", "gravatar_id": "", "url": "https://api.github.com/users/cmuellner", "html_url": "https://github.com/cmuellner", "followers_url": "https://api.github.com/users/cmuellner/followers", "following_url": "https://api.github.com/users/cmuellner/following{/other_user}", "gists_url": "https://api.github.com/users/cmuellner/gists{/gist_id}", "starred_url": "https://api.github.com/users/cmuellner/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/cmuellner/subscriptions", "organizations_url": "https://api.github.com/users/cmuellner/orgs", "repos_url": "https://api.github.com/users/cmuellner/repos", "events_url": "https://api.github.com/users/cmuellner/events{/privacy}", "received_events_url": "https://api.github.com/users/cmuellner/received_events", "type": "User", "site_admin": false}, "committer": {"login": "ptomsich", "id": 14983582, "node_id": "MDQ6VXNlcjE0OTgzNTgy", "avatar_url": "https://avatars.githubusercontent.com/u/14983582?v=4", "gravatar_id": "", "url": "https://api.github.com/users/ptomsich", "html_url": "https://github.com/ptomsich", "followers_url": "https://api.github.com/users/ptomsich/followers", "following_url": "https://api.github.com/users/ptomsich/following{/other_user}", "gists_url": "https://api.github.com/users/ptomsich/gists{/gist_id}", "starred_url": "https://api.github.com/users/ptomsich/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/ptomsich/subscriptions", "organizations_url": "https://api.github.com/users/ptomsich/orgs", "repos_url": "https://api.github.com/users/ptomsich/repos", "events_url": "https://api.github.com/users/ptomsich/events{/privacy}", "received_events_url": "https://api.github.com/users/ptomsich/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "abaa32c7384edef065c79741764bc112dd18f32d", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/abaa32c7384edef065c79741764bc112dd18f32d", "html_url": "https://github.com/Rust-GCC/gccrs/commit/abaa32c7384edef065c79741764bc112dd18f32d"}], "stats": {"total": 23, "additions": 23, "deletions": 0}, "files": [{"sha": "4b7f777c103e4e7c80babf9f73a9090be678f14d", "filename": "gcc/common/config/riscv/riscv-common.cc", "status": "modified", "additions": 4, "deletions": 0, "changes": 4, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/a1a6b912b5f905e768da4d0f434591b4d523be49/gcc%2Fcommon%2Fconfig%2Friscv%2Friscv-common.cc", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/a1a6b912b5f905e768da4d0f434591b4d523be49/gcc%2Fcommon%2Fconfig%2Friscv%2Friscv-common.cc", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fcommon%2Fconfig%2Friscv%2Friscv-common.cc?ref=a1a6b912b5f905e768da4d0f434591b4d523be49", "patch": "@@ -163,6 +163,8 @@ static const struct riscv_ext_version riscv_ext_version_table[] =\n   {\"zifencei\", ISA_SPEC_CLASS_20191213, 2, 0},\n   {\"zifencei\", ISA_SPEC_CLASS_20190608, 2, 0},\n \n+  {\"zawrs\", ISA_SPEC_CLASS_NONE, 1, 0},\n+\n   {\"zba\", ISA_SPEC_CLASS_NONE, 1, 0},\n   {\"zbb\", ISA_SPEC_CLASS_NONE, 1, 0},\n   {\"zbc\", ISA_SPEC_CLASS_NONE, 1, 0},\n@@ -1180,6 +1182,8 @@ static const riscv_ext_flag_table_t riscv_ext_flag_table[] =\n   {\"zicsr\",    &gcc_options::x_riscv_zi_subext, MASK_ZICSR},\n   {\"zifencei\", &gcc_options::x_riscv_zi_subext, MASK_ZIFENCEI},\n \n+  {\"zawrs\", &gcc_options::x_riscv_za_subext, MASK_ZAWRS},\n+\n   {\"zba\",    &gcc_options::x_riscv_zb_subext, MASK_ZBA},\n   {\"zbb\",    &gcc_options::x_riscv_zb_subext, MASK_ZBB},\n   {\"zbc\",    &gcc_options::x_riscv_zb_subext, MASK_ZBC},"}, {"sha": "25fd85b09b1e3257960d292251a70ee468fb6d9e", "filename": "gcc/config/riscv/riscv-opts.h", "status": "modified", "additions": 3, "deletions": 0, "changes": 3, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/a1a6b912b5f905e768da4d0f434591b4d523be49/gcc%2Fconfig%2Friscv%2Friscv-opts.h", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/a1a6b912b5f905e768da4d0f434591b4d523be49/gcc%2Fconfig%2Friscv%2Friscv-opts.h", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fconfig%2Friscv%2Friscv-opts.h?ref=a1a6b912b5f905e768da4d0f434591b4d523be49", "patch": "@@ -73,6 +73,9 @@ enum stack_protector_guard {\n #define TARGET_ZICSR    ((riscv_zi_subext & MASK_ZICSR) != 0)\n #define TARGET_ZIFENCEI ((riscv_zi_subext & MASK_ZIFENCEI) != 0)\n \n+#define MASK_ZAWRS   (1 << 0)\n+#define TARGET_ZAWRS ((riscv_za_subext & MASK_ZAWRS) != 0)\n+\n #define MASK_ZBA      (1 << 0)\n #define MASK_ZBB      (1 << 1)\n #define MASK_ZBC      (1 << 2)"}, {"sha": "7c3ca48d1cc9f589b7e420fc79e75c9a6e12dcfd", "filename": "gcc/config/riscv/riscv.opt", "status": "modified", "additions": 3, "deletions": 0, "changes": 3, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/a1a6b912b5f905e768da4d0f434591b4d523be49/gcc%2Fconfig%2Friscv%2Friscv.opt", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/a1a6b912b5f905e768da4d0f434591b4d523be49/gcc%2Fconfig%2Friscv%2Friscv.opt", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fconfig%2Friscv%2Friscv.opt?ref=a1a6b912b5f905e768da4d0f434591b4d523be49", "patch": "@@ -203,6 +203,9 @@ long riscv_stack_protector_guard_offset = 0\n TargetVariable\n int riscv_zi_subext\n \n+TargetVariable\n+int riscv_za_subext\n+\n TargetVariable\n int riscv_zb_subext\n "}, {"sha": "0b7e2662343985dc0b80ac3e644445a5aa20a526", "filename": "gcc/testsuite/gcc.target/riscv/zawrs.c", "status": "added", "additions": 13, "deletions": 0, "changes": 13, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/a1a6b912b5f905e768da4d0f434591b4d523be49/gcc%2Ftestsuite%2Fgcc.target%2Friscv%2Fzawrs.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/a1a6b912b5f905e768da4d0f434591b4d523be49/gcc%2Ftestsuite%2Fgcc.target%2Friscv%2Fzawrs.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgcc.target%2Friscv%2Fzawrs.c?ref=a1a6b912b5f905e768da4d0f434591b4d523be49", "patch": "@@ -0,0 +1,13 @@\n+/* { dg-do compile } */\n+/* { dg-options \"-march=rv64gc_zawrs\" { target { rv64 } } } */\n+/* { dg-options \"-march=rv32gc_zawrs\" { target { rv32 } } } */\n+\n+#ifndef __riscv_zawrs\n+#error Feature macro not defined\n+#endif\n+\n+int\n+foo (int a)\n+{\n+  return a;\n+}"}]}