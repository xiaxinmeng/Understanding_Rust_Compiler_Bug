{"sha": "6f653a2c85a450714bac905ea4f153234bc6cd5f", "node_id": "C_kwDOANBUbNoAKDZmNjUzYTJjODVhNDUwNzE0YmFjOTA1ZWE0ZjE1MzIzNGJjNmNkNWY", "commit": {"author": {"name": "Xi Ruoyao", "email": "xry111@xry111.site", "date": "2022-10-12T14:06:07Z"}, "committer": {"name": "Xi Ruoyao", "email": "xry111@xry111.site", "date": "2022-10-13T10:05:22Z"}, "message": "LoongArch: implement count_{leading,trailing}_zeros\n\nLoongArch always support clz and ctz instructions, so we can always use\n__builtin_{clz,ctz} for count_{leading,trailing}_zeros.  This improves\nthe code of libgcc, and also benefits Glibc once we merge longlong.h\nthere.\n\nBootstrapped and regtested on loongarch64-linux-gnu.\n\ninclude/ChangeLog:\n\n\t* longlong.h [__loongarch__] (count_leading_zeros): Define.\n\t[__loongarch__] (count_trailing_zeros): Likewise.\n\t[__loongarch__] (COUNT_LEADING_ZEROS_0): Likewise.", "tree": {"sha": "d6218ef805fa751f65760f726dbf7b77bbfbe3cf", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/d6218ef805fa751f65760f726dbf7b77bbfbe3cf"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/6f653a2c85a450714bac905ea4f153234bc6cd5f", "comment_count": 0, "verification": {"verified": true, "reason": "valid", "signature": "-----BEGIN PGP SIGNATURE-----\n\niHUEABYKAB0WIQSR0PV2MB+STX3t3OisqtIOGecQ4wUCY0fi4gAKCRCsqtIOGecQ\n41WrAQC3h5PkomfdI1B46mA9xLpp3Y5PTWo/GZ7sviH22/XfNwD/WK8ncV+XbGJ3\nZDdchUc7NI73BVzX5AaenFUOL9tmpgc=\n=MjOq\n-----END PGP SIGNATURE-----", "payload": "tree d6218ef805fa751f65760f726dbf7b77bbfbe3cf\nparent 7f9a7465c863e482708d2a00f5f7ff91ae3a7e0b\nauthor Xi Ruoyao <xry111@xry111.site> 1665583567 +0800\ncommitter Xi Ruoyao <xry111@xry111.site> 1665655522 +0800\n\nLoongArch: implement count_{leading,trailing}_zeros\n\nLoongArch always support clz and ctz instructions, so we can always use\n__builtin_{clz,ctz} for count_{leading,trailing}_zeros.  This improves\nthe code of libgcc, and also benefits Glibc once we merge longlong.h\nthere.\n\nBootstrapped and regtested on loongarch64-linux-gnu.\n\ninclude/ChangeLog:\n\n\t* longlong.h [__loongarch__] (count_leading_zeros): Define.\n\t[__loongarch__] (count_trailing_zeros): Likewise.\n\t[__loongarch__] (COUNT_LEADING_ZEROS_0): Likewise.\n"}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/6f653a2c85a450714bac905ea4f153234bc6cd5f", "html_url": "https://github.com/Rust-GCC/gccrs/commit/6f653a2c85a450714bac905ea4f153234bc6cd5f", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/6f653a2c85a450714bac905ea4f153234bc6cd5f/comments", "author": {"login": "xry111", "id": 8733039, "node_id": "MDQ6VXNlcjg3MzMwMzk=", "avatar_url": "https://avatars.githubusercontent.com/u/8733039?v=4", "gravatar_id": "", "url": "https://api.github.com/users/xry111", "html_url": "https://github.com/xry111", "followers_url": "https://api.github.com/users/xry111/followers", "following_url": "https://api.github.com/users/xry111/following{/other_user}", "gists_url": "https://api.github.com/users/xry111/gists{/gist_id}", "starred_url": "https://api.github.com/users/xry111/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/xry111/subscriptions", "organizations_url": "https://api.github.com/users/xry111/orgs", "repos_url": "https://api.github.com/users/xry111/repos", "events_url": "https://api.github.com/users/xry111/events{/privacy}", "received_events_url": "https://api.github.com/users/xry111/received_events", "type": "User", "site_admin": false}, "committer": {"login": "xry111", "id": 8733039, "node_id": "MDQ6VXNlcjg3MzMwMzk=", "avatar_url": "https://avatars.githubusercontent.com/u/8733039?v=4", "gravatar_id": "", "url": "https://api.github.com/users/xry111", "html_url": "https://github.com/xry111", "followers_url": "https://api.github.com/users/xry111/followers", "following_url": "https://api.github.com/users/xry111/following{/other_user}", "gists_url": "https://api.github.com/users/xry111/gists{/gist_id}", "starred_url": "https://api.github.com/users/xry111/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/xry111/subscriptions", "organizations_url": "https://api.github.com/users/xry111/orgs", "repos_url": "https://api.github.com/users/xry111/repos", "events_url": "https://api.github.com/users/xry111/events{/privacy}", "received_events_url": "https://api.github.com/users/xry111/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "7f9a7465c863e482708d2a00f5f7ff91ae3a7e0b", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/7f9a7465c863e482708d2a00f5f7ff91ae3a7e0b", "html_url": "https://github.com/Rust-GCC/gccrs/commit/7f9a7465c863e482708d2a00f5f7ff91ae3a7e0b"}], "stats": {"total": 12, "additions": 12, "deletions": 0}, "files": [{"sha": "c3a6f1e7eaa706c2c5a3ed921dfdb1c1589376d4", "filename": "include/longlong.h", "status": "modified", "additions": 12, "deletions": 0, "changes": 12, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/6f653a2c85a450714bac905ea4f153234bc6cd5f/include%2Flonglong.h", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/6f653a2c85a450714bac905ea4f153234bc6cd5f/include%2Flonglong.h", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/include%2Flonglong.h?ref=6f653a2c85a450714bac905ea4f153234bc6cd5f", "patch": "@@ -593,6 +593,18 @@ extern UDItype __umulsidi3 (USItype, USItype);\n #define UMUL_TIME 14\n #endif\n \n+#ifdef __loongarch__\n+# if W_TYPE_SIZE == 32\n+#  define count_leading_zeros(count, x)  ((count) = __builtin_clz (x))\n+#  define count_trailing_zeros(count, x) ((count) = __builtin_ctz (x))\n+#  define COUNT_LEADING_ZEROS_0 32\n+# elif W_TYPE_SIZE == 64\n+#  define count_leading_zeros(count, x)  ((count) = __builtin_clzll (x))\n+#  define count_trailing_zeros(count, x) ((count) = __builtin_ctzll (x))\n+#  define COUNT_LEADING_ZEROS_0 64\n+# endif\n+#endif\n+\n #if defined (__M32R__) && W_TYPE_SIZE == 32\n #define add_ssaaaa(sh, sl, ah, al, bh, bl) \\\n   /* The cmp clears the condition bit.  */ \\"}]}