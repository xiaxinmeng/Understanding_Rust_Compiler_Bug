{"sha": "e00d5cafbe1a77772ecc57eec921ff0b7dd41344", "node_id": "C_kwDOANBUbNoAKGUwMGQ1Y2FmYmUxYTc3NzcyZWNjNTdlZWM5MjFmZjBiN2RkNDEzNDQ", "commit": {"author": {"name": "Jonathan Wakely", "email": "jwakely@redhat.com", "date": "2023-01-24T23:43:24Z"}, "committer": {"name": "Jonathan Wakely", "email": "jwakely@redhat.com", "date": "2023-01-24T23:46:43Z"}, "message": "libstdc++: Use /etc/sysconfig/clock for std::chrono::current_zone() [PR108530]\n\nOn some systems /etc/localtime is a tzfile, not a symlink to one. We\ncannot use it to determine the current time zone in that case. See if\n/etc/sysconfig/clock sets the variable DEFAULT_TIMEZONE instead.\n\nlibstdc++-v3/ChangeLog:\n\n\tPR libstdc++/108530\n\t* src/c++20/tzdb.cc (current_zone): Look for DEFAULT_TIMEZONE in\n\t/etc/sysconfig/clock.", "tree": {"sha": "79cace359a4791da0b5d87e97d9cd32cb30d7f10", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/79cace359a4791da0b5d87e97d9cd32cb30d7f10"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/e00d5cafbe1a77772ecc57eec921ff0b7dd41344", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/e00d5cafbe1a77772ecc57eec921ff0b7dd41344", "html_url": "https://github.com/Rust-GCC/gccrs/commit/e00d5cafbe1a77772ecc57eec921ff0b7dd41344", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/e00d5cafbe1a77772ecc57eec921ff0b7dd41344/comments", "author": {"login": "jwakely", "id": 1254480, "node_id": "MDQ6VXNlcjEyNTQ0ODA=", "avatar_url": "https://avatars.githubusercontent.com/u/1254480?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jwakely", "html_url": "https://github.com/jwakely", "followers_url": "https://api.github.com/users/jwakely/followers", "following_url": "https://api.github.com/users/jwakely/following{/other_user}", "gists_url": "https://api.github.com/users/jwakely/gists{/gist_id}", "starred_url": "https://api.github.com/users/jwakely/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jwakely/subscriptions", "organizations_url": "https://api.github.com/users/jwakely/orgs", "repos_url": "https://api.github.com/users/jwakely/repos", "events_url": "https://api.github.com/users/jwakely/events{/privacy}", "received_events_url": "https://api.github.com/users/jwakely/received_events", "type": "User", "site_admin": false}, "committer": {"login": "jwakely", "id": 1254480, "node_id": "MDQ6VXNlcjEyNTQ0ODA=", "avatar_url": "https://avatars.githubusercontent.com/u/1254480?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jwakely", "html_url": "https://github.com/jwakely", "followers_url": "https://api.github.com/users/jwakely/followers", "following_url": "https://api.github.com/users/jwakely/following{/other_user}", "gists_url": "https://api.github.com/users/jwakely/gists{/gist_id}", "starred_url": "https://api.github.com/users/jwakely/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jwakely/subscriptions", "organizations_url": "https://api.github.com/users/jwakely/orgs", "repos_url": "https://api.github.com/users/jwakely/repos", "events_url": "https://api.github.com/users/jwakely/events{/privacy}", "received_events_url": "https://api.github.com/users/jwakely/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "33ed11085837e9492c6ed512931f5b6375c68ee7", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/33ed11085837e9492c6ed512931f5b6375c68ee7", "html_url": "https://github.com/Rust-GCC/gccrs/commit/33ed11085837e9492c6ed512931f5b6375c68ee7"}], "stats": {"total": 24, "additions": 22, "deletions": 2}, "files": [{"sha": "eb68111e4444859fe471e657a5becc3ce5647d8e", "filename": "libstdc++-v3/src/c++20/tzdb.cc", "status": "modified", "additions": 22, "deletions": 2, "changes": 24, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/e00d5cafbe1a77772ecc57eec921ff0b7dd41344/libstdc%2B%2B-v3%2Fsrc%2Fc%2B%2B20%2Ftzdb.cc", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/e00d5cafbe1a77772ecc57eec921ff0b7dd41344/libstdc%2B%2B-v3%2Fsrc%2Fc%2B%2B20%2Ftzdb.cc", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libstdc%2B%2B-v3%2Fsrc%2Fc%2B%2B20%2Ftzdb.cc?ref=e00d5cafbe1a77772ecc57eec921ff0b7dd41344", "patch": "@@ -62,8 +62,8 @@\n #if ! __cpp_constinit\n # if __has_cpp_attribute(clang::require_constant_initialization)\n #  define constinit [[clang::require_constant_initialization]]\n-#else // YOLO\n-# define constinit\n+# else // YOLO\n+#  define constinit\n # endif\n #endif\n \n@@ -1663,6 +1663,26 @@ namespace std::chrono\n \t  if (auto tz = do_locate_zone(this->zones, this->links, name))\n \t    return tz;\n       }\n+\n+    if (ifstream tzf{\"/etc/sysconfig/clock\"})\n+      {\n+\tstring line;\n+\tstring_view key = \"DEFAULT_TIMEZONE=\";\n+\twhile (std::getline(tzf, line))\n+\t  if (line.starts_with(key))\n+\t    {\n+\t      string_view name = line;\n+\t      name.remove_prefix(key.size());\n+\t      if (name.size() != 0 && name.front() == '\"')\n+\t\t{\n+\t\t  name.remove_prefix(1);\n+\t\t  if (auto pos = name.find('\"'); pos != name.npos)\n+\t\t    name = name.substr(0, pos);\n+\t\t}\n+\t      if (auto tz = do_locate_zone(this->zones, this->links, name))\n+\t\treturn tz;\n+\t    }\n+      }\n #else\n     // AIX stores current zone in $TZ in /etc/environment but the value\n     // is typically a POSIX time zone name, not IANA zone."}]}