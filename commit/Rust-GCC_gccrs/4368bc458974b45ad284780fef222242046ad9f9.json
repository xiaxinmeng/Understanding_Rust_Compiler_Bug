{"sha": "4368bc458974b45ad284780fef222242046ad9f9", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6NDM2OGJjNDU4OTc0YjQ1YWQyODQ3ODBmZWYyMjIyNDIwNDZhZDlmOQ==", "commit": {"author": {"name": "Ian Lance Taylor", "email": "ian@gcc.gnu.org", "date": "2014-12-01T01:06:29Z"}, "committer": {"name": "Ian Lance Taylor", "email": "ian@gcc.gnu.org", "date": "2014-12-01T01:06:29Z"}, "message": "runtime: introduce mvifdiff.sh script to replace GCC's move-if-change\n\nThis goes towards making libgo more self-contained.\n\nFrom-SVN: r218198", "tree": {"sha": "0d6b22ae2b4ebff29aaf1c1b359fe717b09748d1", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/0d6b22ae2b4ebff29aaf1c1b359fe717b09748d1"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/4368bc458974b45ad284780fef222242046ad9f9", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/4368bc458974b45ad284780fef222242046ad9f9", "html_url": "https://github.com/Rust-GCC/gccrs/commit/4368bc458974b45ad284780fef222242046ad9f9", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/4368bc458974b45ad284780fef222242046ad9f9/comments", "author": null, "committer": null, "parents": [{"sha": "13d254137170b0743d902a025a11525a728a796d", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/13d254137170b0743d902a025a11525a728a796d", "html_url": "https://github.com/Rust-GCC/gccrs/commit/13d254137170b0743d902a025a11525a728a796d"}], "stats": {"total": 39, "additions": 27, "deletions": 12}, "files": [{"sha": "48114d11d505bddf3fbf49705f26b0c13f87d81f", "filename": "libgo/Makefile.am", "status": "modified", "additions": 6, "deletions": 6, "changes": 12, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/4368bc458974b45ad284780fef222242046ad9f9/libgo%2FMakefile.am", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/4368bc458974b45ad284780fef222242046ad9f9/libgo%2FMakefile.am", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libgo%2FMakefile.am?ref=4368bc458974b45ad284780fef222242046ad9f9", "patch": "@@ -1007,7 +1007,7 @@ s-version: Makefile\n \techo 'const theVersion = \"'`$(GOC) --version | sed 1q`'\"' >> version.go.tmp\n \techo 'const theGoarch = \"'$(GOARCH)'\"' >> version.go.tmp\n \techo 'const theGoos = \"'$(GOOS)'\"' >> version.go.tmp\n-\t$(SHELL) $(srcdir)/../move-if-change version.go.tmp version.go\n+\t$(SHELL) $(srcdir)/mvifdiff.sh version.go.tmp version.go\n \t$(STAMP) $@\n \n go_sort_files = \\\n@@ -1791,14 +1791,14 @@ s-libcalls: libcalls-list go/syscall/mksyscall.awk $(go_base_syscall_files)\n \trm -f libcalls.go.tmp\n \tfiles=`echo $^ | sed -e 's/libcalls-list//' -e 's|[^ ]*go/syscall/mksyscall.awk||'`; \\\n \t$(AWK) -f $(srcdir)/go/syscall/mksyscall.awk $${files} > libcalls.go.tmp\n-\t$(SHELL) $(srcdir)/../move-if-change libcalls.go.tmp libcalls.go\n+\t$(SHELL) $(srcdir)/mvifdiff.sh libcalls.go.tmp libcalls.go\n \t$(STAMP) $@\n \n libcalls-list: s-libcalls-list; @true\n s-libcalls-list: Makefile\n \trm -f libcalls-list.tmp\n \techo $(go_base_syscall_files) > libcalls-list.tmp\n-\t$(SHELL) $(srcdir)/../move-if-change libcalls-list.tmp libcalls-list\n+\t$(SHELL) $(srcdir)/mvifdiff.sh libcalls-list.tmp libcalls-list\n \t$(STAMP) $@\n \n syscall_arch.go: s-syscall_arch; @true\n@@ -1807,13 +1807,13 @@ s-syscall_arch: Makefile\n \techo \"package syscall\" > syscall_arch.go.tmp\n \techo 'const ARCH = \"'$(GOARCH)'\"' >> syscall_arch.go.tmp\n \techo 'const OS = \"'$(GOOS)'\"' >> syscall_arch.go.tmp\n-\t$(SHELL) $(srcdir)/../move-if-change syscall_arch.go.tmp syscall_arch.go\n+\t$(SHELL) $(srcdir)/mvifdiff.sh syscall_arch.go.tmp syscall_arch.go\n \t$(STAMP) $@\n \n sysinfo.go: s-sysinfo; @true\n s-sysinfo: $(srcdir)/mksysinfo.sh config.h\n \tCC=\"$(CC) $(DEFS) $(DEFAULT_INCLUDES) $(INCLUDES) $(AM_CPPFLAGS) $(CPPFLAGS) $(OSCFLAGS)\" $(SHELL) $(srcdir)/mksysinfo.sh\n-\t$(SHELL) $(srcdir)/../move-if-change tmp-sysinfo.go sysinfo.go\n+\t$(SHELL) $(srcdir)/mvifdiff.sh tmp-sysinfo.go sysinfo.go\n \t$(STAMP) $@\n \n # The epoll struct has an embedded union and is packed on x86_64,\n@@ -1841,7 +1841,7 @@ s-epoll: Makefile\n \t   exit 1; ;; \\\n \tesac\n \techo '}' >> epoll.go.tmp\n-\t$(SHELL) $(srcdir)/../move-if-change epoll.go.tmp epoll.go\n+\t$(SHELL) $(srcdir)/mvifdiff.sh epoll.go.tmp epoll.go\n \t$(STAMP) $@\n \n if LIBGO_IS_LINUX"}, {"sha": "259d134c9141492a9f94e244e1d88aff20fb81de", "filename": "libgo/Makefile.in", "status": "modified", "additions": 6, "deletions": 6, "changes": 12, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/4368bc458974b45ad284780fef222242046ad9f9/libgo%2FMakefile.in", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/4368bc458974b45ad284780fef222242046ad9f9/libgo%2FMakefile.in", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libgo%2FMakefile.in?ref=4368bc458974b45ad284780fef222242046ad9f9", "patch": "@@ -4392,22 +4392,22 @@ s-version: Makefile\n \techo 'const theVersion = \"'`$(GOC) --version | sed 1q`'\"' >> version.go.tmp\n \techo 'const theGoarch = \"'$(GOARCH)'\"' >> version.go.tmp\n \techo 'const theGoos = \"'$(GOOS)'\"' >> version.go.tmp\n-\t$(SHELL) $(srcdir)/../move-if-change version.go.tmp version.go\n+\t$(SHELL) $(srcdir)/mvifdiff.sh version.go.tmp version.go\n \t$(STAMP) $@\n \n libcalls.go: s-libcalls; @true\n s-libcalls: libcalls-list go/syscall/mksyscall.awk $(go_base_syscall_files)\n \trm -f libcalls.go.tmp\n \tfiles=`echo $^ | sed -e 's/libcalls-list//' -e 's|[^ ]*go/syscall/mksyscall.awk||'`; \\\n \t$(AWK) -f $(srcdir)/go/syscall/mksyscall.awk $${files} > libcalls.go.tmp\n-\t$(SHELL) $(srcdir)/../move-if-change libcalls.go.tmp libcalls.go\n+\t$(SHELL) $(srcdir)/mvifdiff.sh libcalls.go.tmp libcalls.go\n \t$(STAMP) $@\n \n libcalls-list: s-libcalls-list; @true\n s-libcalls-list: Makefile\n \trm -f libcalls-list.tmp\n \techo $(go_base_syscall_files) > libcalls-list.tmp\n-\t$(SHELL) $(srcdir)/../move-if-change libcalls-list.tmp libcalls-list\n+\t$(SHELL) $(srcdir)/mvifdiff.sh libcalls-list.tmp libcalls-list\n \t$(STAMP) $@\n \n syscall_arch.go: s-syscall_arch; @true\n@@ -4416,13 +4416,13 @@ s-syscall_arch: Makefile\n \techo \"package syscall\" > syscall_arch.go.tmp\n \techo 'const ARCH = \"'$(GOARCH)'\"' >> syscall_arch.go.tmp\n \techo 'const OS = \"'$(GOOS)'\"' >> syscall_arch.go.tmp\n-\t$(SHELL) $(srcdir)/../move-if-change syscall_arch.go.tmp syscall_arch.go\n+\t$(SHELL) $(srcdir)/mvifdiff.sh syscall_arch.go.tmp syscall_arch.go\n \t$(STAMP) $@\n \n sysinfo.go: s-sysinfo; @true\n s-sysinfo: $(srcdir)/mksysinfo.sh config.h\n \tCC=\"$(CC) $(DEFS) $(DEFAULT_INCLUDES) $(INCLUDES) $(AM_CPPFLAGS) $(CPPFLAGS) $(OSCFLAGS)\" $(SHELL) $(srcdir)/mksysinfo.sh\n-\t$(SHELL) $(srcdir)/../move-if-change tmp-sysinfo.go sysinfo.go\n+\t$(SHELL) $(srcdir)/mvifdiff.sh tmp-sysinfo.go sysinfo.go\n \t$(STAMP) $@\n \n # The epoll struct has an embedded union and is packed on x86_64,\n@@ -4450,7 +4450,7 @@ s-epoll: Makefile\n \t   exit 1; ;; \\\n \tesac\n \techo '}' >> epoll.go.tmp\n-\t$(SHELL) $(srcdir)/../move-if-change epoll.go.tmp epoll.go\n+\t$(SHELL) $(srcdir)/mvifdiff.sh epoll.go.tmp epoll.go\n \t$(STAMP) $@\n \n @go_include@ bufio.lo.dep"}, {"sha": "6706e40de409ab2be63d306eb1120056f6a164d0", "filename": "libgo/mvifdiff.sh", "status": "added", "additions": 15, "deletions": 0, "changes": 15, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/4368bc458974b45ad284780fef222242046ad9f9/libgo%2Fmvifdiff.sh", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/4368bc458974b45ad284780fef222242046ad9f9/libgo%2Fmvifdiff.sh", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libgo%2Fmvifdiff.sh?ref=4368bc458974b45ad284780fef222242046ad9f9", "patch": "@@ -0,0 +1,15 @@\n+#!/bin/sh\n+\n+# Copyright 2014 The Go Authors. All rights reserved.\n+# Use of this source code is governed by a BSD-style\n+# license that can be found in the LICENSE file.\n+\n+# The mvifdiff.sh script works like the mv(1) command, except\n+# that it does not touch the destination file if its contents\n+# are the same as the source file.\n+\n+if cmp -s \"$1\" \"$2\" ; then\n+  rm \"$1\"\n+else\n+  mv \"$1\" \"$2\"\n+fi"}]}