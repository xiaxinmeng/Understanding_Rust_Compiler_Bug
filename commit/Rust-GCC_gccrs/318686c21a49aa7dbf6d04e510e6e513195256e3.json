{"sha": "318686c21a49aa7dbf6d04e510e6e513195256e3", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6MzE4Njg2YzIxYTQ5YWE3ZGJmNmQwNGU1MTBlNmU1MTMxOTUyNTZlMw==", "commit": {"author": {"name": "Thomas Schwinge", "email": "thomas@codesourcery.com", "date": "2017-05-24T13:23:55Z"}, "committer": {"name": "Thomas Schwinge", "email": "tschwinge@gcc.gnu.org", "date": "2017-05-24T13:23:55Z"}, "message": "Fortran OpenACC \"openacc_lib.h\": acc_pcopyin, acc_pcreate\n\n\tlibgomp/\n\t* openacc_lib.h (acc_pcopyin, acc_pcreate): Route to\n\tacc_present_or_copyin and acc_present_or_create procedures,\n\trespectively.\n\t* testsuite/libgomp.oacc-fortran/lib-32-1.f: Exercise these, and\n\tgenerally different variants of OpenACC Runtime Library functions.\n\t* testsuite/libgomp.oacc-fortran/lib-32-2.f: Likewise.\n\nFrom-SVN: r248412", "tree": {"sha": "35a95fad166ea1cdbb27034040eef3e3e0b888fa", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/35a95fad166ea1cdbb27034040eef3e3e0b888fa"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/318686c21a49aa7dbf6d04e510e6e513195256e3", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/318686c21a49aa7dbf6d04e510e6e513195256e3", "html_url": "https://github.com/Rust-GCC/gccrs/commit/318686c21a49aa7dbf6d04e510e6e513195256e3", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/318686c21a49aa7dbf6d04e510e6e513195256e3/comments", "author": {"login": "tschwinge", "id": 21753, "node_id": "MDQ6VXNlcjIxNzUz", "avatar_url": "https://avatars.githubusercontent.com/u/21753?v=4", "gravatar_id": "", "url": "https://api.github.com/users/tschwinge", "html_url": "https://github.com/tschwinge", "followers_url": "https://api.github.com/users/tschwinge/followers", "following_url": "https://api.github.com/users/tschwinge/following{/other_user}", "gists_url": "https://api.github.com/users/tschwinge/gists{/gist_id}", "starred_url": "https://api.github.com/users/tschwinge/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/tschwinge/subscriptions", "organizations_url": "https://api.github.com/users/tschwinge/orgs", "repos_url": "https://api.github.com/users/tschwinge/repos", "events_url": "https://api.github.com/users/tschwinge/events{/privacy}", "received_events_url": "https://api.github.com/users/tschwinge/received_events", "type": "User", "site_admin": false}, "committer": null, "parents": [{"sha": "a67455348046637027060e225a5c022c676426b7", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/a67455348046637027060e225a5c022c676426b7", "html_url": "https://github.com/Rust-GCC/gccrs/commit/a67455348046637027060e225a5c022c676426b7"}], "stats": {"total": 111, "additions": 42, "deletions": 69}, "files": [{"sha": "55869d2bfbca836b36f5032818a5787a16596976", "filename": "libgomp/ChangeLog", "status": "modified", "additions": 7, "deletions": 0, "changes": 7, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/318686c21a49aa7dbf6d04e510e6e513195256e3/libgomp%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/318686c21a49aa7dbf6d04e510e6e513195256e3/libgomp%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libgomp%2FChangeLog?ref=318686c21a49aa7dbf6d04e510e6e513195256e3", "patch": "@@ -1,5 +1,12 @@\n 2017-05-24  Thomas Schwinge  <thomas@codesourcery.com>\n \n+\t* openacc_lib.h (acc_pcopyin, acc_pcreate): Route to\n+\tacc_present_or_copyin and acc_present_or_create procedures,\n+\trespectively.\n+\t* testsuite/libgomp.oacc-fortran/lib-32-1.f: Exercise these, and\n+\tgenerally different variants of OpenACC Runtime Library functions.\n+\t* testsuite/libgomp.oacc-fortran/lib-32-2.f: Likewise.\n+\n \t* testsuite/libgomp.oacc-fortran/lib-32-1.f: New file.\n \t* testsuite/libgomp.oacc-fortran/lib-32-2.f: Likewise.\n "}, {"sha": "7818bd7efad5bf92cdf0836da525a5ef4feb9b2d", "filename": "libgomp/openacc_lib.h", "status": "modified", "additions": 7, "deletions": 35, "changes": 42, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/318686c21a49aa7dbf6d04e510e6e513195256e3/libgomp%2Fopenacc_lib.h", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/318686c21a49aa7dbf6d04e510e6e513195256e3/libgomp%2Fopenacc_lib.h", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libgomp%2Fopenacc_lib.h?ref=318686c21a49aa7dbf6d04e510e6e513195256e3", "patch": "@@ -191,23 +191,9 @@\n       end interface\n \n       interface acc_pcopyin\n-        subroutine acc_pcopyin_32_h (a, len)\n-          use iso_c_binding, only: c_int32_t\n-          !GCC$ ATTRIBUTES NO_ARG_CHECK :: a\n-          type (*), dimension (*) :: a\n-          integer (c_int32_t) len\n-        end subroutine\n-\n-        subroutine acc_pcopyin_64_h (a, len)\n-          use iso_c_binding, only: c_int64_t\n-          !GCC$ ATTRIBUTES NO_ARG_CHECK :: a\n-          type (*), dimension (*) :: a\n-          integer (c_int64_t) len\n-        end subroutine\n-\n-        subroutine acc_pcopyin_array_h (a)\n-          type (*), dimension (..), contiguous :: a\n-          end subroutine\n+        procedure :: acc_present_or_copyin_32_h\n+        procedure :: acc_present_or_copyin_64_h\n+        procedure :: acc_present_or_copyin_array_h\n       end interface\n \n       interface acc_create\n@@ -251,23 +237,9 @@\n       end interface\n \n       interface acc_pcreate\n-        subroutine acc_pcreate_32_h (a, len)\n-          use iso_c_binding, only: c_int32_t\n-          !GCC$ ATTRIBUTES NO_ARG_CHECK :: a\n-          type (*), dimension (*) :: a\n-          integer (c_int32_t) len\n-        end subroutine\n-\n-        subroutine acc_pcreate_64_h (a, len)\n-          use iso_c_binding, only: c_int64_t\n-          !GCC$ ATTRIBUTES NO_ARG_CHECK :: a\n-          type (*), dimension (*) :: a\n-          integer (c_int64_t) len\n-        end subroutine\n-\n-        subroutine acc_pcreate_array_h (a)\n-          type (*), dimension (..), contiguous :: a\n-          end subroutine\n+        procedure :: acc_present_or_create_32_h\n+        procedure :: acc_present_or_create_64_h\n+        procedure :: acc_present_or_create_array_h\n       end interface\n \n       interface acc_copyout\n@@ -353,7 +325,7 @@\n       ! acc_map_data: Only available in C/C++\n       ! acc_unmap_data: Only available in C/C++\n       ! acc_deviceptr: Only available in C/C++\n-      ! acc_ostptr: Only available in C/C++\n+      ! acc_hostptr: Only available in C/C++\n \n       interface acc_is_present\n         function acc_is_present_32_h (a, len)"}, {"sha": "177e4fb6641a5294310e07e28b6e64b80bc50097", "filename": "libgomp/testsuite/libgomp.oacc-fortran/lib-32-1.f", "status": "modified", "additions": 15, "deletions": 21, "changes": 36, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/318686c21a49aa7dbf6d04e510e6e513195256e3/libgomp%2Ftestsuite%2Flibgomp.oacc-fortran%2Flib-32-1.f", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/318686c21a49aa7dbf6d04e510e6e513195256e3/libgomp%2Ftestsuite%2Flibgomp.oacc-fortran%2Flib-32-1.f", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libgomp%2Ftestsuite%2Flibgomp.oacc-fortran%2Flib-32-1.f?ref=318686c21a49aa7dbf6d04e510e6e513195256e3", "patch": "@@ -20,8 +20,8 @@ PROGRAM MAIN\n \n       SHARED_MEM = ACC_IS_PRESENT (H)\n \n-      CALL ACC_PRESENT_OR_CREATE (H)\n-      IF (.NOT. ACC_IS_PRESENT (H)) CALL ABORT\n+      CALL ACC_PRESENT_OR_CREATE (H, INT (SIZEOF (H), 4))\n+      IF (.NOT. ACC_IS_PRESENT (H, INT (SIZEOF (H), 8))) CALL ABORT\n \n !$ACC PARALLEL LOOP DEFAULT (PRESENT)\n       DO I = 1, N\n@@ -48,8 +48,7 @@ PROGRAM MAIN\n          H(I) = I + 4\n       END DO\n \n-!      CALL ACC_PCREATE (H)\n-      CALL ACC_PRESENT_OR_CREATE (H)\n+      CALL ACC_PCREATE (H, INT (SIZEOF (H), 4))\n \n !$ACC PARALLEL LOOP DEFAULT (PRESENT)\n       DO I = 1, N\n@@ -63,7 +62,7 @@ PROGRAM MAIN\n          H(I) = I + 6\n       END DO\n \n-      CALL ACC_PRESENT_OR_COPYIN (H)\n+      CALL ACC_PRESENT_OR_COPYIN (H, INT (SIZEOF (H), 8))\n \n !$ACC PARALLEL LOOP DEFAULT (PRESENT)\n       DO I = 1, N\n@@ -77,8 +76,7 @@ PROGRAM MAIN\n          H(I) = I + 8\n       END DO\n \n-!      CALL ACC_PCOPYIN (H)\n-      CALL ACC_PRESENT_OR_COPYIN (H)\n+      CALL ACC_PCOPYIN (H, INT (SIZEOF (H), 4))\n \n !$ACC PARALLEL LOOP DEFAULT (PRESENT)\n       DO I = 1, N\n@@ -92,18 +90,17 @@ PROGRAM MAIN\n          H(I) = I + 10\n       END DO\n \n-      CALL ACC_COPYOUT (H)\n+      CALL ACC_COPYOUT (H, INT (SIZEOF (H), 4))\n       IF (.NOT. SHARED_MEM) THEN\n-         IF (ACC_IS_PRESENT (H)) CALL ABORT\n+         IF (ACC_IS_PRESENT (H, INT (SIZEOF (H), 8))) CALL ABORT\n       ENDIF\n \n       DO I = 1, N\n          IF (H(I) .NE. I + MERGE (10, 9, SHARED_MEM)) CALL ABORT\n       END DO\n \n-!      CALL ACC_PCOPYIN (H)\n-      CALL ACC_PRESENT_OR_COPYIN (H)\n-      IF (.NOT. ACC_IS_PRESENT (H)) CALL ABORT\n+      CALL ACC_PCOPYIN (H)\n+      IF (.NOT. ACC_IS_PRESENT (H, INT (SIZEOF (H), 4))) CALL ABORT\n \n !$ACC PARALLEL LOOP DEFAULT (PRESENT)\n       DO I = 1, N\n@@ -117,8 +114,7 @@ PROGRAM MAIN\n          H(I) = I + 12\n       END DO\n \n-!      CALL ACC_PCOPYIN (H)\n-      CALL ACC_PRESENT_OR_COPYIN (H)\n+      CALL ACC_PCOPYIN (H, INT (SIZEOF (H), 8))\n \n !$ACC PARALLEL LOOP DEFAULT (PRESENT)\n       DO I = 1, N\n@@ -132,8 +128,7 @@ PROGRAM MAIN\n          H(I) = I + 14\n       END DO\n \n-!      CALL ACC_PCREATE (H)\n-      CALL ACC_PRESENT_OR_CREATE (H)\n+      CALL ACC_PCREATE (H)\n \n !$ACC PARALLEL LOOP DEFAULT (PRESENT)\n       DO I = 1, N\n@@ -147,8 +142,7 @@ PROGRAM MAIN\n          H(I) = I + 16\n       END DO\n \n-!      CALL ACC_PCREATE (H)\n-      CALL ACC_PRESENT_OR_CREATE (H)\n+      CALL ACC_PCREATE (H, INT (SIZEOF (H), 8))\n \n !$ACC PARALLEL LOOP DEFAULT (PRESENT)\n       DO I = 1, N\n@@ -162,16 +156,16 @@ PROGRAM MAIN\n          H(I) = I + 18\n       END DO\n \n-      CALL ACC_UPDATE_SELF (H)\n-      IF (.NOT. ACC_IS_PRESENT (H)) CALL ABORT\n+      CALL ACC_UPDATE_SELF (H, INT (SIZEOF (H), 4))\n+      IF (.NOT. ACC_IS_PRESENT (H, INT (SIZEOF (H), 8))) CALL ABORT\n \n       DO I = 1, N\n          IF (H(I) .NE. I + MERGE (18, 17, SHARED_MEM)) CALL ABORT\n       END DO\n \n       CALL ACC_DELETE (H)\n       IF (.NOT. SHARED_MEM) THEN\n-         IF (ACC_IS_PRESENT (H)) CALL ABORT\n+         IF (ACC_IS_PRESENT (H, INT (SIZEOF (H), 4))) CALL ABORT\n       ENDIF\n \n       DEALLOCATE (H)"}, {"sha": "a08eb8470f77ac5d442a9b2dfee5c79be65b663c", "filename": "libgomp/testsuite/libgomp.oacc-fortran/lib-32-2.f", "status": "modified", "additions": 13, "deletions": 13, "changes": 26, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/318686c21a49aa7dbf6d04e510e6e513195256e3/libgomp%2Ftestsuite%2Flibgomp.oacc-fortran%2Flib-32-2.f", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/318686c21a49aa7dbf6d04e510e6e513195256e3/libgomp%2Ftestsuite%2Flibgomp.oacc-fortran%2Flib-32-2.f", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libgomp%2Ftestsuite%2Flibgomp.oacc-fortran%2Flib-32-2.f?ref=318686c21a49aa7dbf6d04e510e6e513195256e3", "patch": "@@ -20,8 +20,8 @@ PROGRAM MAIN\n \n       SHARED_MEM = ACC_IS_PRESENT (H)\n \n-      CALL ACC_PRESENT_OR_CREATE (H)\n-      IF (.NOT. ACC_IS_PRESENT (H)) CALL ABORT\n+      CALL ACC_PRESENT_OR_CREATE (H, INT (SIZEOF (H), 4))\n+      IF (.NOT. ACC_IS_PRESENT (H, INT (SIZEOF (H), 8))) CALL ABORT\n \n !$ACC PARALLEL LOOP DEFAULT (PRESENT)\n       DO I = 1, N\n@@ -48,7 +48,7 @@ PROGRAM MAIN\n          H(I) = I + 4\n       END DO\n \n-      CALL ACC_PCREATE (H)\n+      CALL ACC_PCREATE (H, INT (SIZEOF (H), 4))\n \n !$ACC PARALLEL LOOP DEFAULT (PRESENT)\n       DO I = 1, N\n@@ -62,7 +62,7 @@ PROGRAM MAIN\n          H(I) = I + 6\n       END DO\n \n-      CALL ACC_PRESENT_OR_COPYIN (H)\n+      CALL ACC_PRESENT_OR_COPYIN (H, INT (SIZEOF (H), 8))\n \n !$ACC PARALLEL LOOP DEFAULT (PRESENT)\n       DO I = 1, N\n@@ -76,7 +76,7 @@ PROGRAM MAIN\n          H(I) = I + 8\n       END DO\n \n-      CALL ACC_PCOPYIN (H)\n+      CALL ACC_PCOPYIN (H, INT (SIZEOF (H), 4))\n \n !$ACC PARALLEL LOOP DEFAULT (PRESENT)\n       DO I = 1, N\n@@ -90,17 +90,17 @@ PROGRAM MAIN\n          H(I) = I + 10\n       END DO\n \n-      CALL ACC_COPYOUT (H)\n+      CALL ACC_COPYOUT (H, INT (SIZEOF (H), 4))\n       IF (.NOT. SHARED_MEM) THEN\n-         IF (ACC_IS_PRESENT (H)) CALL ABORT\n+         IF (ACC_IS_PRESENT (H, INT (SIZEOF (H), 8))) CALL ABORT\n       ENDIF\n \n       DO I = 1, N\n          IF (H(I) .NE. I + MERGE (10, 9, SHARED_MEM)) CALL ABORT\n       END DO\n \n       CALL ACC_PCOPYIN (H)\n-      IF (.NOT. ACC_IS_PRESENT (H)) CALL ABORT\n+      IF (.NOT. ACC_IS_PRESENT (H, INT (SIZEOF (H), 4))) CALL ABORT\n \n !$ACC PARALLEL LOOP DEFAULT (PRESENT)\n       DO I = 1, N\n@@ -114,7 +114,7 @@ PROGRAM MAIN\n          H(I) = I + 12\n       END DO\n \n-      CALL ACC_PCOPYIN (H)\n+      CALL ACC_PCOPYIN (H, INT (SIZEOF (H), 8))\n \n !$ACC PARALLEL LOOP DEFAULT (PRESENT)\n       DO I = 1, N\n@@ -142,7 +142,7 @@ PROGRAM MAIN\n          H(I) = I + 16\n       END DO\n \n-      CALL ACC_PCREATE (H)\n+      CALL ACC_PCREATE (H, INT (SIZEOF (H), 8))\n \n !$ACC PARALLEL LOOP DEFAULT (PRESENT)\n       DO I = 1, N\n@@ -156,16 +156,16 @@ PROGRAM MAIN\n          H(I) = I + 18\n       END DO\n \n-      CALL ACC_UPDATE_SELF (H)\n-      IF (.NOT. ACC_IS_PRESENT (H)) CALL ABORT\n+      CALL ACC_UPDATE_SELF (H, INT (SIZEOF (H), 4))\n+      IF (.NOT. ACC_IS_PRESENT (H, INT (SIZEOF (H), 8))) CALL ABORT\n \n       DO I = 1, N\n          IF (H(I) .NE. I + MERGE (18, 17, SHARED_MEM)) CALL ABORT\n       END DO\n \n       CALL ACC_DELETE (H)\n       IF (.NOT. SHARED_MEM) THEN\n-         IF (ACC_IS_PRESENT (H)) CALL ABORT\n+         IF (ACC_IS_PRESENT (H, INT (SIZEOF (H), 4))) CALL ABORT\n       ENDIF\n \n       DEALLOCATE (H)"}]}