{"sha": "b478c0cd398851b78a85b0667f3997b424e42f35", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6YjQ3OGMwY2QzOTg4NTFiNzhhODViMDY2N2YzOTk3YjQyNGU0MmYzNQ==", "commit": {"author": {"name": "Uros Bizjak", "email": "uros@gcc.gnu.org", "date": "2014-11-05T21:00:07Z"}, "committer": {"name": "Uros Bizjak", "email": "uros@gcc.gnu.org", "date": "2014-11-05T21:00:07Z"}, "message": "re PR target/63538 ([X86_64] With -mcmodel=medium .lrodata accesses do not use 64-bit addresses)\n\n\tPR target/63538\n\t* config/i386/i386.c (in_large_data_p): Reject automatic variables.\n\t(ix86_encode_section_info): Do not check for non-automatic varibles\n\twhen setting SYMBOL_FLAG_FAR_ADDR flag.\n\t(x86_64_elf_select_section): Do not check ix86_cmodel here.\n\t(x86_64_elf_unique_section): Ditto.\n\t(x86_elf_aligned_common): Emit tab before .largecomm.\n\ntestsuite/ChangeLog:\n\n\tPR target/63538\n\t* gcc.target/i386/pr63538.c: New test.\n\nFrom-SVN: r217156", "tree": {"sha": "ba1ca4bc338247654252816f9d8010fab9f068f8", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/ba1ca4bc338247654252816f9d8010fab9f068f8"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/b478c0cd398851b78a85b0667f3997b424e42f35", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/b478c0cd398851b78a85b0667f3997b424e42f35", "html_url": "https://github.com/Rust-GCC/gccrs/commit/b478c0cd398851b78a85b0667f3997b424e42f35", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/b478c0cd398851b78a85b0667f3997b424e42f35/comments", "author": null, "committer": null, "parents": [{"sha": "2374257aff7c2f88a7b1fa8c1466176b7d42f99c", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/2374257aff7c2f88a7b1fa8c1466176b7d42f99c", "html_url": "https://github.com/Rust-GCC/gccrs/commit/2374257aff7c2f88a7b1fa8c1466176b7d42f99c"}], "stats": {"total": 46, "additions": 37, "deletions": 9}, "files": [{"sha": "ead29c3897e2f343f9df9b67778039a933b85c1a", "filename": "gcc/ChangeLog", "status": "modified", "additions": 10, "deletions": 0, "changes": 10, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/b478c0cd398851b78a85b0667f3997b424e42f35/gcc%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/b478c0cd398851b78a85b0667f3997b424e42f35/gcc%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2FChangeLog?ref=b478c0cd398851b78a85b0667f3997b424e42f35", "patch": "@@ -1,3 +1,13 @@\n+2014-11-05  Uros Bizjak  <ubizjak@gmail.com>\n+\n+\tPR target/63538\n+\t* config/i386/i386.c (in_large_data_p): Reject automatic variables.\n+\t(ix86_encode_section_info): Do not check for non-automatic varibles\n+\twhen setting SYMBOL_FLAG_FAR_ADDR flag.\n+\t(x86_64_elf_select_section): Do not check ix86_cmodel here.\n+\t(x86_64_elf_unique_section): Ditto.\n+\t(x86_elf_aligned_common): Emit tab before .largecomm.\n+\n 2014-11-05  Anthony Brandon  <anthony.brandon@gmail.com>\n \n \tPR driver/36312"}, {"sha": "085eb54762173b8bb3499e99177dad1a0207c5e4", "filename": "gcc/config/i386/i386.c", "status": "modified", "additions": 8, "deletions": 8, "changes": 16, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/b478c0cd398851b78a85b0667f3997b424e42f35/gcc%2Fconfig%2Fi386%2Fi386.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/b478c0cd398851b78a85b0667f3997b424e42f35/gcc%2Fconfig%2Fi386%2Fi386.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fconfig%2Fi386%2Fi386.c?ref=b478c0cd398851b78a85b0667f3997b424e42f35", "patch": "@@ -5090,6 +5090,10 @@ ix86_in_large_data_p (tree exp)\n   if (TREE_CODE (exp) == FUNCTION_DECL)\n     return false;\n \n+  /* Automatic variables are never large data.  */\n+  if (TREE_CODE (exp) == VAR_DECL && !is_global_var (exp))\n+    return false;\n+\n   if (TREE_CODE (exp) == VAR_DECL && DECL_SECTION_NAME (exp))\n     {\n       const char *section = DECL_SECTION_NAME (exp);\n@@ -5123,8 +5127,7 @@ ATTRIBUTE_UNUSED static section *\n x86_64_elf_select_section (tree decl, int reloc,\n \t\t\t   unsigned HOST_WIDE_INT align)\n {\n-  if ((ix86_cmodel == CM_MEDIUM || ix86_cmodel == CM_MEDIUM_PIC)\n-      && ix86_in_large_data_p (decl))\n+  if (ix86_in_large_data_p (decl))\n     {\n       const char *sname = NULL;\n       unsigned int flags = SECTION_WRITE;\n@@ -5210,8 +5213,7 @@ x86_64_elf_section_type_flags (tree decl, const char *name, int reloc)\n static void ATTRIBUTE_UNUSED\n x86_64_elf_unique_section (tree decl, int reloc)\n {\n-  if ((ix86_cmodel == CM_MEDIUM || ix86_cmodel == CM_MEDIUM_PIC)\n-      && ix86_in_large_data_p (decl))\n+  if (ix86_in_large_data_p (decl))\n     {\n       const char *prefix = NULL;\n       /* We only need to use .gnu.linkonce if we don't have COMDAT groups.  */\n@@ -5280,7 +5282,7 @@ x86_elf_aligned_common (FILE *file,\n {\n   if ((ix86_cmodel == CM_MEDIUM || ix86_cmodel == CM_MEDIUM_PIC)\n       && size > (unsigned int)ix86_section_threshold)\n-    fputs (\".largecomm\\t\", file);\n+    fputs (\"\\t.largecomm\\t\", file);\n   else\n     fputs (COMMON_ASM_OP, file);\n   assemble_name (file, name);\n@@ -45178,9 +45180,7 @@ ix86_encode_section_info (tree decl, rtx rtl, int first)\n {\n   default_encode_section_info (decl, rtl, first);\n \n-  if (TREE_CODE (decl) == VAR_DECL\n-      && (TREE_STATIC (decl) || DECL_EXTERNAL (decl))\n-      && ix86_in_large_data_p (decl))\n+  if (ix86_in_large_data_p (decl))\n     SYMBOL_REF_FLAGS (XEXP (rtl, 0)) |= SYMBOL_FLAG_FAR_ADDR;\n }\n "}, {"sha": "4e64c97a4b53fe9093462f551725258cccbd4918", "filename": "gcc/testsuite/ChangeLog", "status": "modified", "additions": 6, "deletions": 1, "changes": 7, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/b478c0cd398851b78a85b0667f3997b424e42f35/gcc%2Ftestsuite%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/b478c0cd398851b78a85b0667f3997b424e42f35/gcc%2Ftestsuite%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2FChangeLog?ref=b478c0cd398851b78a85b0667f3997b424e42f35", "patch": "@@ -1,3 +1,8 @@\n+2014-11-05  Uros Bizjak  <ubizjak@gmail.com>\n+\n+\tPR target/63538\n+\t* gcc.target/i386/pr63538.c: New test.\n+\n 2014-11-05  Eric Botcazou  <ebotcazou@adacore.com>\n \n \t* gnat.dg/discr42.adb: New test.\n@@ -21,7 +26,7 @@\n \t* gnat.dg/inline5.adb: New test.\n \t* gnat.dg/inline5_pkg.ad[sb]: New helper.\n \t* gnat.dg/inline6.adb: New test.\n-\t* gnat.dg/inline6_pkg.ad[sb]: New helper.\t\n+\t* gnat.dg/inline6_pkg.ad[sb]: New helper.\n \t* gnat.dg/inline7.adb: New test.\n \t* gnat.dg/inline7_pkg1.ad[sb]: New helper.\n \t* gnat.dg/inline7_pkg2.ad[sb]: Likewise."}, {"sha": "7b979c35d81c1d8832445102730e4628462d646f", "filename": "gcc/testsuite/gcc.target/i386/pr63538.c", "status": "added", "additions": 13, "deletions": 0, "changes": 13, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/b478c0cd398851b78a85b0667f3997b424e42f35/gcc%2Ftestsuite%2Fgcc.target%2Fi386%2Fpr63538.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/b478c0cd398851b78a85b0667f3997b424e42f35/gcc%2Ftestsuite%2Fgcc.target%2Fi386%2Fpr63538.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgcc.target%2Fi386%2Fpr63538.c?ref=b478c0cd398851b78a85b0667f3997b424e42f35", "patch": "@@ -0,0 +1,13 @@\n+/* PR target/63538 */\n+/* { dg-do compile } */\n+/* { dg-require-effective-target lp64 } */\n+/* { dg-options \"-O2 -mcmodel=medium -mlarge-data-threshold=0\" } */\n+\n+static char *str = \"Hello World\";\n+\n+char *foo ()\n+{\n+  return str;\n+}\n+\n+/* { dg-final { scan-assembler \"movabs\" } } */"}]}