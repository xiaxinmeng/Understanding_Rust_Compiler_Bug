{"sha": "d8d8121add34439d69187182bacea680468270df", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6ZDhkODEyMWFkZDM0NDM5ZDY5MTg3MTgyYmFjZWE2ODA0NjgyNzBkZg==", "commit": {"author": {"name": "Paul Thomas", "email": "pault@gcc.gnu.org", "date": "2006-11-10T21:06:42Z"}, "committer": {"name": "Paul Thomas", "email": "pault@gcc.gnu.org", "date": "2006-11-10T21:06:42Z"}, "message": "re PR fortran/29758 (Runtime segfault in RESHAPE with insufficient elements in SOURCE)\n\n2006-11-10 Paul Thomas <pault@gcc.gnu.org>\n\n   PR fortran/29758\n   * check.c (gfc_check_reshape): Check that there are enough\n   elements in the source array as to be able to fill an array\n   defined by shape, when pad is absent.\n\n\n2006-11-10 Paul Thomas <pault@gcc.gnu.org>\n\n   PR fortran/29758\n   * gfortran.dg/reshape_source_size_1.f90: New test.\n\nFrom-SVN: r118664", "tree": {"sha": "08f1d1862fcda9270ca787d05266443665ded1d0", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/08f1d1862fcda9270ca787d05266443665ded1d0"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/d8d8121add34439d69187182bacea680468270df", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/d8d8121add34439d69187182bacea680468270df", "html_url": "https://github.com/Rust-GCC/gccrs/commit/d8d8121add34439d69187182bacea680468270df", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/d8d8121add34439d69187182bacea680468270df/comments", "author": null, "committer": null, "parents": [{"sha": "f70d742fc89c922a9ad5508753027eb17827369c", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/f70d742fc89c922a9ad5508753027eb17827369c", "html_url": "https://github.com/Rust-GCC/gccrs/commit/f70d742fc89c922a9ad5508753027eb17827369c"}], "stats": {"total": 57, "additions": 54, "deletions": 3}, "files": [{"sha": "445ed4b77021f2fda96e357ca0d8f691ecb4402a", "filename": "gcc/fortran/ChangeLog", "status": "modified", "additions": 5, "deletions": 3, "changes": 8, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/d8d8121add34439d69187182bacea680468270df/gcc%2Ffortran%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/d8d8121add34439d69187182bacea680468270df/gcc%2Ffortran%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ffortran%2FChangeLog?ref=d8d8121add34439d69187182bacea680468270df", "patch": "@@ -1,7 +1,9 @@\n-2006-11-10  Tobias Burnus  <burnus@net-b.de>\n+2006-11-10 Paul Thomas <pault@gcc.gnu.org>\n \n-\tPR fortran/29454\n-\t* resolve.c (gfc_resolve_blocks): Fix error message.\n+   PR fortran/29758\n+   * check.c (gfc_check_reshape): Check that there are enough\n+   elements in the source array as to be able to fill an array\n+   defined by shape, when pad is absent.\n \n 2006-11-10 Paul Thomas <pault@gcc.gnu.org>\n "}, {"sha": "0c5fc130b5ae0dd7ecb0d1db53169f07a86de551", "filename": "gcc/fortran/check.c", "status": "modified", "additions": 33, "deletions": 0, "changes": 33, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/d8d8121add34439d69187182bacea680468270df/gcc%2Ffortran%2Fcheck.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/d8d8121add34439d69187182bacea680468270df/gcc%2Ffortran%2Fcheck.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ffortran%2Fcheck.c?ref=d8d8121add34439d69187182bacea680468270df", "patch": "@@ -2110,6 +2110,7 @@ gfc_check_reshape (gfc_expr * source, gfc_expr * shape,\n \t\t   gfc_expr * pad, gfc_expr * order)\n {\n   mpz_t size;\n+  mpz_t nelems;\n   int m;\n \n   if (array_check (source, 0) == FAILURE)\n@@ -2149,6 +2150,38 @@ gfc_check_reshape (gfc_expr * source, gfc_expr * shape,\n   if (order != NULL && array_check (order, 3) == FAILURE)\n     return FAILURE;\n \n+  if (pad == NULL\n+\t&& shape->expr_type == EXPR_ARRAY\n+\t&& gfc_is_constant_expr (shape)\n+\t&& !(source->expr_type == EXPR_VARIABLE\n+\t       && source->symtree->n.sym->as\n+\t       && source->symtree->n.sym->as->type == AS_ASSUMED_SIZE))\n+    {\n+      /* Check the match in size between source and destination.  */\n+      if (gfc_array_size (source, &nelems) == SUCCESS)\n+\t{\n+\t  gfc_constructor *c;\n+\t  bool test;\n+\n+\t  c = shape->value.constructor;\n+\t  mpz_init_set_ui (size, 1);\n+\t  for (; c; c = c->next)\n+\t    mpz_mul (size, size, c->expr->value.integer);\n+\n+\t  test = mpz_cmp (nelems, size) < 0 && mpz_cmp_ui (size, 0) > 0;\n+\t  mpz_clear (nelems);\n+\t  mpz_clear (size);\n+\n+\t  if (test)\n+\t    {\n+\t      gfc_error (\"Without padding, there are not enough elements in the \"\n+\t\t\t \"intrinsic RESHAPE source at %L to match the shape\",\n+\t\t\t &source->where);\n+\t      return FAILURE;\n+\t    }\n+\t}\n+    }\n+\n   return SUCCESS;\n }\n "}, {"sha": "3880cb9f224868c3a08350edcaff8cd633f7cb2e", "filename": "gcc/testsuite/ChangeLog", "status": "modified", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/d8d8121add34439d69187182bacea680468270df/gcc%2Ftestsuite%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/d8d8121add34439d69187182bacea680468270df/gcc%2Ftestsuite%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2FChangeLog?ref=d8d8121add34439d69187182bacea680468270df", "patch": "@@ -1,3 +1,8 @@\n+2006-11-10 Paul Thomas <pault@gcc.gnu.org>\n+\n+   PR fortran/29758\n+   * gfortran.dg/reshape_source_size_1.f90: New test.\n+\n 2006-11-10 Paul Thomas <pault@gcc.gnu.org>\n \n \tPR fortran/29315"}, {"sha": "8290f61357735e42cb5fe59e7d64577d8c333be3", "filename": "gcc/testsuite/gfortran.dg/reshape_source_size_1.f90", "status": "added", "additions": 11, "deletions": 0, "changes": 11, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/d8d8121add34439d69187182bacea680468270df/gcc%2Ftestsuite%2Fgfortran.dg%2Freshape_source_size_1.f90", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/d8d8121add34439d69187182bacea680468270df/gcc%2Ftestsuite%2Fgfortran.dg%2Freshape_source_size_1.f90", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgfortran.dg%2Freshape_source_size_1.f90?ref=d8d8121add34439d69187182bacea680468270df", "patch": "@@ -0,0 +1,11 @@\n+! { dg-do compile }\n+! Tests patch for PR29758, which arose from PR29431.  There was no check that there\n+! were enough elements in the source to match the shape.\n+!\n+! Contributed by Paul Thomas  <pault@gcc.gnu.org>\n+!\n+   real :: a(2,2), b = 1.0, c(3), d(4)\n+   a = reshape ([b], [2,2]) ! { dg-error \"not enough elements\" }\n+   a = reshape (c, [2,2])   ! { dg-error \"not enough elements\" }\n+   a = reshape (d, [2,2])\n+end"}]}