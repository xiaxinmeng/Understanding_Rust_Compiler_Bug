{"sha": "70ece2d4ca403dfc6a837d876642378a8d4d3dce", "node_id": "C_kwDOANBUbNoAKDcwZWNlMmQ0Y2E0MDNkZmM2YTgzN2Q4NzY2NDIzNzhhOGQ0ZDNkY2U", "commit": {"author": {"name": "Richard Biener", "email": "rguenther@suse.de", "date": "2021-12-02T11:21:19Z"}, "committer": {"name": "Richard Biener", "email": "rguenther@suse.de", "date": "2021-12-02T12:32:11Z"}, "message": "tree-optimization/103527 - always use thruth type forgather mask\n\nThis makes sure to always use a truth type to build the gather\nmask argument even when the target builtin prototype in the end\nwants a float vector.\n\n2021-12-02  Richard Biener  <rguenther@suse.de>\n\n\tPR tree-optimization/103527\n\t* tree-vect-stmts.c (vect_build_gather_load_calls): Always\n\tuse a truth type for building the vector mask.", "tree": {"sha": "1da21ec8d1b5bc3afdb4d698bfc9b43cf72bf7a4", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/1da21ec8d1b5bc3afdb4d698bfc9b43cf72bf7a4"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/70ece2d4ca403dfc6a837d876642378a8d4d3dce", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/70ece2d4ca403dfc6a837d876642378a8d4d3dce", "html_url": "https://github.com/Rust-GCC/gccrs/commit/70ece2d4ca403dfc6a837d876642378a8d4d3dce", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/70ece2d4ca403dfc6a837d876642378a8d4d3dce/comments", "author": {"login": "rguenth", "id": 2046526, "node_id": "MDQ6VXNlcjIwNDY1MjY=", "avatar_url": "https://avatars.githubusercontent.com/u/2046526?v=4", "gravatar_id": "", "url": "https://api.github.com/users/rguenth", "html_url": "https://github.com/rguenth", "followers_url": "https://api.github.com/users/rguenth/followers", "following_url": "https://api.github.com/users/rguenth/following{/other_user}", "gists_url": "https://api.github.com/users/rguenth/gists{/gist_id}", "starred_url": "https://api.github.com/users/rguenth/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/rguenth/subscriptions", "organizations_url": "https://api.github.com/users/rguenth/orgs", "repos_url": "https://api.github.com/users/rguenth/repos", "events_url": "https://api.github.com/users/rguenth/events{/privacy}", "received_events_url": "https://api.github.com/users/rguenth/received_events", "type": "User", "site_admin": false}, "committer": {"login": "rguenth", "id": 2046526, "node_id": "MDQ6VXNlcjIwNDY1MjY=", "avatar_url": "https://avatars.githubusercontent.com/u/2046526?v=4", "gravatar_id": "", "url": "https://api.github.com/users/rguenth", "html_url": "https://github.com/rguenth", "followers_url": "https://api.github.com/users/rguenth/followers", "following_url": "https://api.github.com/users/rguenth/following{/other_user}", "gists_url": "https://api.github.com/users/rguenth/gists{/gist_id}", "starred_url": "https://api.github.com/users/rguenth/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/rguenth/subscriptions", "organizations_url": "https://api.github.com/users/rguenth/orgs", "repos_url": "https://api.github.com/users/rguenth/repos", "events_url": "https://api.github.com/users/rguenth/events{/privacy}", "received_events_url": "https://api.github.com/users/rguenth/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "1ea226fad13ab696c6d5d17b7bbfc5b4b693c363", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/1ea226fad13ab696c6d5d17b7bbfc5b4b693c363", "html_url": "https://github.com/Rust-GCC/gccrs/commit/1ea226fad13ab696c6d5d17b7bbfc5b4b693c363"}], "stats": {"total": 5, "additions": 3, "deletions": 2}, "files": [{"sha": "e63bc2afdaafd95e6b3715c317deb0f1ed465f14", "filename": "gcc/tree-vect-stmts.c", "status": "modified", "additions": 3, "deletions": 2, "changes": 5, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/70ece2d4ca403dfc6a837d876642378a8d4d3dce/gcc%2Ftree-vect-stmts.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/70ece2d4ca403dfc6a837d876642378a8d4d3dce/gcc%2Ftree-vect-stmts.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftree-vect-stmts.c?ref=70ece2d4ca403dfc6a837d876642378a8d4d3dce", "patch": "@@ -2740,7 +2740,7 @@ vect_build_gather_load_calls (vec_info *vinfo, stmt_vec_info stmt_info,\n \t\t       && (!mask\n \t\t\t   || TREE_CODE (masktype) == INTEGER_TYPE\n \t\t\t   || types_compatible_p (srctype, masktype)));\n-  if (mask && TREE_CODE (masktype) == INTEGER_TYPE)\n+  if (mask)\n     masktype = truth_type_for (srctype);\n \n   tree mask_halftype = masktype;\n@@ -2893,7 +2893,8 @@ vect_build_gather_load_calls (vec_info *vinfo, stmt_vec_info stmt_info,\n       if (masktype != real_masktype)\n \t{\n \t  tree utype, optype = TREE_TYPE (mask_op);\n-\t  if (TYPE_MODE (real_masktype) == TYPE_MODE (optype))\n+\t  if (VECTOR_TYPE_P (real_masktype)\n+\t      || TYPE_MODE (real_masktype) == TYPE_MODE (optype))\n \t    utype = real_masktype;\n \t  else\n \t    utype = lang_hooks.types.type_for_mode (TYPE_MODE (optype), 1);"}]}