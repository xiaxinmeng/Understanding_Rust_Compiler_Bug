{"sha": "8063de4a8cde958c34fbd2af4a25080709263c74", "node_id": "C_kwDOANBUbNoAKDgwNjNkZTRhOGNkZTk1OGMzNGZiZDJhZjRhMjUwODA3MDkyNjNjNzQ", "commit": {"author": {"name": "Iain Buclaw", "email": "ibuclaw@gdcproject.org", "date": "2023-01-29T20:17:47Z"}, "committer": {"name": "Iain Buclaw", "email": "ibuclaw@gdcproject.org", "date": "2023-02-21T14:12:19Z"}, "message": "d: Set doing_semantic_analysis_p before calling functionSemantic3\n\nAs functions which have semantic analysis ran late may still require\nthe use of CTFE built-ins to be evaluated.\n\ngcc/d/ChangeLog:\n\n\t* decl.cc (DeclVisitor::visit (FuncDeclaration *)): Set\n\tdoing_semantic_analysis_p before calling functionSemantic3.\n\ngcc/testsuite/ChangeLog:\n\n\t* gdc.dg/ctfeintrinsics.d: New test.", "tree": {"sha": "8f90f098f89977e542b3898d81885ca0481fcd98", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/8f90f098f89977e542b3898d81885ca0481fcd98"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/8063de4a8cde958c34fbd2af4a25080709263c74", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/8063de4a8cde958c34fbd2af4a25080709263c74", "html_url": "https://github.com/Rust-GCC/gccrs/commit/8063de4a8cde958c34fbd2af4a25080709263c74", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/8063de4a8cde958c34fbd2af4a25080709263c74/comments", "author": {"login": "ibuclaw", "id": 397929, "node_id": "MDQ6VXNlcjM5NzkyOQ==", "avatar_url": "https://avatars.githubusercontent.com/u/397929?v=4", "gravatar_id": "", "url": "https://api.github.com/users/ibuclaw", "html_url": "https://github.com/ibuclaw", "followers_url": "https://api.github.com/users/ibuclaw/followers", "following_url": "https://api.github.com/users/ibuclaw/following{/other_user}", "gists_url": "https://api.github.com/users/ibuclaw/gists{/gist_id}", "starred_url": "https://api.github.com/users/ibuclaw/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/ibuclaw/subscriptions", "organizations_url": "https://api.github.com/users/ibuclaw/orgs", "repos_url": "https://api.github.com/users/ibuclaw/repos", "events_url": "https://api.github.com/users/ibuclaw/events{/privacy}", "received_events_url": "https://api.github.com/users/ibuclaw/received_events", "type": "User", "site_admin": false}, "committer": {"login": "ibuclaw", "id": 397929, "node_id": "MDQ6VXNlcjM5NzkyOQ==", "avatar_url": "https://avatars.githubusercontent.com/u/397929?v=4", "gravatar_id": "", "url": "https://api.github.com/users/ibuclaw", "html_url": "https://github.com/ibuclaw", "followers_url": "https://api.github.com/users/ibuclaw/followers", "following_url": "https://api.github.com/users/ibuclaw/following{/other_user}", "gists_url": "https://api.github.com/users/ibuclaw/gists{/gist_id}", "starred_url": "https://api.github.com/users/ibuclaw/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/ibuclaw/subscriptions", "organizations_url": "https://api.github.com/users/ibuclaw/orgs", "repos_url": "https://api.github.com/users/ibuclaw/repos", "events_url": "https://api.github.com/users/ibuclaw/events{/privacy}", "received_events_url": "https://api.github.com/users/ibuclaw/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "dfd39ed30dd69a3613d47a83d3739923051734aa", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/dfd39ed30dd69a3613d47a83d3739923051734aa", "html_url": "https://github.com/Rust-GCC/gccrs/commit/dfd39ed30dd69a3613d47a83d3739923051734aa"}], "stats": {"total": 57, "additions": 57, "deletions": 0}, "files": [{"sha": "990ac4016b884190bb364402e7ee1d2dc1d14327", "filename": "gcc/d/decl.cc", "status": "modified", "additions": 4, "deletions": 0, "changes": 4, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/8063de4a8cde958c34fbd2af4a25080709263c74/gcc%2Fd%2Fdecl.cc", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/8063de4a8cde958c34fbd2af4a25080709263c74/gcc%2Fd%2Fdecl.cc", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fd%2Fdecl.cc?ref=8063de4a8cde958c34fbd2af4a25080709263c74", "patch": "@@ -829,8 +829,12 @@ class DeclVisitor : public Visitor\n     /* Ensure all semantic passes have run.  */\n     if (d->semanticRun < PASS::semantic3)\n       {\n+\tgcc_assert (!doing_semantic_analysis_p);\n+\n+\tdoing_semantic_analysis_p = true;\n \td->functionSemantic3 ();\n \tModule::runDeferredSemantic3 ();\n+\tdoing_semantic_analysis_p = false;\n       }\n \n     if (global.errors)"}, {"sha": "0e5592b9b1a171949762b59f0dd121644fb6b8a7", "filename": "gcc/testsuite/gdc.dg/ctfeintrinsics.d", "status": "added", "additions": 53, "deletions": 0, "changes": 53, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/8063de4a8cde958c34fbd2af4a25080709263c74/gcc%2Ftestsuite%2Fgdc.dg%2Fctfeintrinsics.d", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/8063de4a8cde958c34fbd2af4a25080709263c74/gcc%2Ftestsuite%2Fgdc.dg%2Fctfeintrinsics.d", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgdc.dg%2Fctfeintrinsics.d?ref=8063de4a8cde958c34fbd2af4a25080709263c74", "patch": "@@ -0,0 +1,53 @@\n+// { dg-do compile { target d_runtime_has_std_library } }\n+\n+//////////////////////////////////////////////////////\n+// std.math.exponential\n+import std.math.exponential;\n+\n+enum test_exp = exp(1.0L);\n+enum test_expm1 = expm1(1.0L);\n+enum test_exp2 = exp2(1.0L);\n+enum test_log = log(1.0L);\n+enum test_log2 = log2(1.0L);\n+enum test_log10 = log10(1.0L);\n+enum test_pow = pow(1.0L, 1L);\n+enum test_powi = pow(1L, 1L);\n+enum test_powf = pow(1L, 1.0L);\n+enum test_powl = pow(1.0L, 1.0L);\n+\n+//////////////////////////////////////////////////////\n+// std.math.operations\n+import std.math.operations;\n+\n+enum test_fmin = fmin(1.0L, 2.0L);\n+enum test_fmax = fmax(1.0L, 2.0L);\n+enum test_fma = fma(1.0L, 2.0L, 3.0L);\n+\n+//////////////////////////////////////////////////////\n+// std.math.rounding\n+import std.math.rounding;\n+\n+enum test_round = round(12.34L);\n+enum test_floorf = floor(12.34f);\n+enum test_floor = floor(12.34);\n+enum test_floorl = floor(12.34L);\n+enum test_ceilf = ceil(12.34f);\n+enum test_ceil = ceil(12.34);\n+enum test_ceill = ceil(12.34L);\n+enum test_trunc = trunc(12.34L);\n+\n+//////////////////////////////////////////////////////\n+// std.math.traits\n+import std.math.traits;\n+\n+enum test_isNaN = isNaN(real.nan);\n+enum test_isInfinity = isInfinity(real.infinity);\n+enum test_isFinite = isFinite(1.0L);\n+enum test_copysign = copysign(1.0L, -1.0L);\n+enum test_copysigni = copysign(1L, -1.0L);\n+\n+//////////////////////////////////////////////////////\n+// std.math.trigonometry\n+import std.math.trigonometry;\n+\n+enum test_tan = tan(1.0L);"}]}