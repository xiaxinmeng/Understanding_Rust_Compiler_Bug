{"sha": "f6a5ffbfbf3387414b14426d4f41c4e6bc39b6c8", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6ZjZhNWZmYmZiZjMzODc0MTRiMTQ0MjZkNGY0MWM0ZTZiYzM5YjZjOA==", "commit": {"author": {"name": "Jakub Jelinek", "email": "jakub@redhat.com", "date": "2006-05-04T06:34:06Z"}, "committer": {"name": "Jakub Jelinek", "email": "jakub@gcc.gnu.org", "date": "2006-05-04T06:34:06Z"}, "message": "re PR middle-end/27388 (omp_is_private issues)\n\n\tPR middle-end/27388\n\t* gimplify.c (omp_is_private): If var is shared in some outer context,\n\treturn false instead of true.  Stop searching on parallel context\n\tboundary.\n\n\t* gcc.dg/gomp/pr27388-1.c: New test.\n\t* gcc.dg/gomp/pr27388-2.c: New test.\n\t* gcc.dg/gomp/pr27388-3.c: New test.\n\nFrom-SVN: r113514", "tree": {"sha": "53c788c929ca8d179572822a778ff283ee27923b", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/53c788c929ca8d179572822a778ff283ee27923b"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/f6a5ffbfbf3387414b14426d4f41c4e6bc39b6c8", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/f6a5ffbfbf3387414b14426d4f41c4e6bc39b6c8", "html_url": "https://github.com/Rust-GCC/gccrs/commit/f6a5ffbfbf3387414b14426d4f41c4e6bc39b6c8", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/f6a5ffbfbf3387414b14426d4f41c4e6bc39b6c8/comments", "author": {"login": "jakubjelinek", "id": 9370665, "node_id": "MDQ6VXNlcjkzNzA2NjU=", "avatar_url": "https://avatars.githubusercontent.com/u/9370665?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jakubjelinek", "html_url": "https://github.com/jakubjelinek", "followers_url": "https://api.github.com/users/jakubjelinek/followers", "following_url": "https://api.github.com/users/jakubjelinek/following{/other_user}", "gists_url": "https://api.github.com/users/jakubjelinek/gists{/gist_id}", "starred_url": "https://api.github.com/users/jakubjelinek/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jakubjelinek/subscriptions", "organizations_url": "https://api.github.com/users/jakubjelinek/orgs", "repos_url": "https://api.github.com/users/jakubjelinek/repos", "events_url": "https://api.github.com/users/jakubjelinek/events{/privacy}", "received_events_url": "https://api.github.com/users/jakubjelinek/received_events", "type": "User", "site_admin": false}, "committer": null, "parents": [{"sha": "76c5e6e079f5efe7ba978771e5234c303ca407c8", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/76c5e6e079f5efe7ba978771e5234c303ca407c8", "html_url": "https://github.com/Rust-GCC/gccrs/commit/76c5e6e079f5efe7ba978771e5234c303ca407c8"}], "stats": {"total": 110, "additions": 104, "deletions": 6}, "files": [{"sha": "59d715326c580071cf58dfcd885b2f02d3471026", "filename": "gcc/ChangeLog", "status": "modified", "additions": 7, "deletions": 0, "changes": 7, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/f6a5ffbfbf3387414b14426d4f41c4e6bc39b6c8/gcc%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/f6a5ffbfbf3387414b14426d4f41c4e6bc39b6c8/gcc%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2FChangeLog?ref=f6a5ffbfbf3387414b14426d4f41c4e6bc39b6c8", "patch": "@@ -1,3 +1,10 @@\n+2006-05-04  Jakub Jelinek  <jakub@redhat.com>\n+\n+\tPR middle-end/27388\n+\t* gimplify.c (omp_is_private): If var is shared in some outer context,\n+\treturn false instead of true.  Stop searching on parallel context\n+\tboundary.\n+\n 2006-05-03  Alexandre Oliva  <aoliva@redhat.com>\n \n \tPR java/8260"}, {"sha": "000f610b4e6259101cf8b189734021df32576262", "filename": "gcc/gimplify.c", "status": "modified", "additions": 11, "deletions": 6, "changes": 17, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/f6a5ffbfbf3387414b14426d4f41c4e6bc39b6c8/gcc%2Fgimplify.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/f6a5ffbfbf3387414b14426d4f41c4e6bc39b6c8/gcc%2Fgimplify.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fgimplify.c?ref=f6a5ffbfbf3387414b14426d4f41c4e6bc39b6c8", "patch": "@@ -4443,17 +4443,22 @@ omp_is_private (struct gimplify_omp_ctx *ctx, tree decl)\n       if (n->value & GOVD_SHARED)\n \t{\n \t  if (ctx == gimplify_omp_ctxp)\n-\t    error (\"iteration variable %qs should be private\",\n-\t\t   IDENTIFIER_POINTER (DECL_NAME (decl)));\n-\t  n->value = GOVD_PRIVATE;\n+\t    {\n+\t      error (\"iteration variable %qs should be private\",\n+\t\t     IDENTIFIER_POINTER (DECL_NAME (decl)));\n+\t      n->value = GOVD_PRIVATE;\n+\t      return true;\n+\t    }\n+\t  else\n+\t    return false;\n \t}\n       return true;\n     }\n \n-  if (ctx->outer_context)\n-    return omp_is_private (ctx->outer_context, decl);\n-  else if (ctx->is_parallel)\n+  if (ctx->is_parallel)\n     return false;\n+  else if (ctx->outer_context)\n+    return omp_is_private (ctx->outer_context, decl);\n   else\n     return !is_global_var (decl);\n }"}, {"sha": "218a850be2a7134ba72ac8f2c0e67580be103c36", "filename": "gcc/testsuite/ChangeLog", "status": "modified", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/f6a5ffbfbf3387414b14426d4f41c4e6bc39b6c8/gcc%2Ftestsuite%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/f6a5ffbfbf3387414b14426d4f41c4e6bc39b6c8/gcc%2Ftestsuite%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2FChangeLog?ref=f6a5ffbfbf3387414b14426d4f41c4e6bc39b6c8", "patch": "@@ -1,5 +1,10 @@\n 2006-05-04  Jakub Jelinek  <jakub@redhat.com>\n \n+\tPR middle-end/27388\n+\t* gcc.dg/gomp/pr27388-1.c: New test.\n+\t* gcc.dg/gomp/pr27388-2.c: New test.\n+\t* gcc.dg/gomp/pr27388-3.c: New test.\n+\n \tPR c++/27359\n \t* g++.dg/gomp/pr27359.C: New test.\n "}, {"sha": "f315b8bd3804d148e5887d243231efa7a9eaa5d4", "filename": "gcc/testsuite/gcc.dg/gomp/pr27388-1.c", "status": "added", "additions": 23, "deletions": 0, "changes": 23, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/f6a5ffbfbf3387414b14426d4f41c4e6bc39b6c8/gcc%2Ftestsuite%2Fgcc.dg%2Fgomp%2Fpr27388-1.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/f6a5ffbfbf3387414b14426d4f41c4e6bc39b6c8/gcc%2Ftestsuite%2Fgcc.dg%2Fgomp%2Fpr27388-1.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgcc.dg%2Fgomp%2Fpr27388-1.c?ref=f6a5ffbfbf3387414b14426d4f41c4e6bc39b6c8", "patch": "@@ -0,0 +1,23 @@\n+/* PR middle-end/27388 */\n+/* { dg-do compile } */\n+/* { dg-options \"-fopenmp -fdump-tree-omplower\" } */\n+\n+int n, o;\n+\n+void\n+foo (void)\n+{\n+#pragma omp parallel firstprivate (n)\n+  {\n+    int i;\n+#pragma omp parallel for firstprivate (n)\n+    for (i = 0; i < 10; i++)\n+      ++n;\n+#pragma omp atomic\n+    o += n;\n+  }\n+}\n+\n+/* { dg-final { scan-tree-dump-times \"shared\\\\\\(i\\\\\\)\" 0 \"omplower\" } } */\n+/* { dg-final { scan-tree-dump-times \"private\\\\\\(i\\\\\\)\" 1 \"omplower\" } } */\n+/* { dg-final { cleanup-tree-dump \"omplower\" } } */"}, {"sha": "da8a48d7ef00f15f15cfda605db013038349540b", "filename": "gcc/testsuite/gcc.dg/gomp/pr27388-2.c", "status": "added", "additions": 35, "deletions": 0, "changes": 35, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/f6a5ffbfbf3387414b14426d4f41c4e6bc39b6c8/gcc%2Ftestsuite%2Fgcc.dg%2Fgomp%2Fpr27388-2.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/f6a5ffbfbf3387414b14426d4f41c4e6bc39b6c8/gcc%2Ftestsuite%2Fgcc.dg%2Fgomp%2Fpr27388-2.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgcc.dg%2Fgomp%2Fpr27388-2.c?ref=f6a5ffbfbf3387414b14426d4f41c4e6bc39b6c8", "patch": "@@ -0,0 +1,35 @@\n+/* PR middle-end/27388 */\n+/* { dg-do compile } */\n+/* { dg-options \"-fopenmp -fdump-tree-omplower\" } */\n+\n+extern void baz (int);\n+\n+void\n+foo (void)\n+{\n+  int i;\n+#pragma omp parallel for shared (i)\n+  for (i = 0; i < 2; i++)\n+    baz (i);\n+}\n+\n+void\n+bar (void)\n+{\n+  int j = 0;\n+#pragma omp parallel shared (j)\n+  {\n+    j++;\n+#pragma omp for\n+    for (j = 0; j < 2; j++)\n+      baz (j);\n+  }\n+}\n+\n+/* { dg-final { scan-tree-dump-times \"shared\\\\\\(i\\\\\\)\\[^\\\\n\\]*private\\\\\\(i\\\\\\)\" 0 \"omplower\" } } */\n+/* { dg-final { scan-tree-dump-times \"private\\\\\\(i\\\\\\)\\[^\\\\n\\]*shared\\\\\\(i\\\\\\)\" 0 \"omplower\" } } */\n+/* { dg-final { scan-tree-dump-times \"omp for\\[^\\\\n\\]*private\\\\\\(i\\\\\\)\" 1 \"omplower\" } } */\n+/* { dg-final { scan-tree-dump-times \"shared\\\\\\(j\\\\\\)\\[^\\\\n\\]*private\\\\\\(j\\\\\\)\" 0 \"omplower\" } } */\n+/* { dg-final { scan-tree-dump-times \"private\\\\\\(j\\\\\\)\\[^\\\\n\\]*shared\\\\\\(j\\\\\\)\" 0 \"omplower\" } } */\n+/* { dg-final { scan-tree-dump-times \"omp for\\[^\\\\n\\]*private\\\\\\(j\\\\\\)\" 1 \"omplower\" } } */\n+/* { dg-final { cleanup-tree-dump \"omplower\" } } */"}, {"sha": "a6f4647aa5fbd6e6ddc603e1fa9b7df1a02605a9", "filename": "gcc/testsuite/gcc.dg/gomp/pr27388-3.c", "status": "added", "additions": 23, "deletions": 0, "changes": 23, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/f6a5ffbfbf3387414b14426d4f41c4e6bc39b6c8/gcc%2Ftestsuite%2Fgcc.dg%2Fgomp%2Fpr27388-3.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/f6a5ffbfbf3387414b14426d4f41c4e6bc39b6c8/gcc%2Ftestsuite%2Fgcc.dg%2Fgomp%2Fpr27388-3.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgcc.dg%2Fgomp%2Fpr27388-3.c?ref=f6a5ffbfbf3387414b14426d4f41c4e6bc39b6c8", "patch": "@@ -0,0 +1,23 @@\n+/* PR middle-end/27388 */\n+/* { dg-do compile } */\n+/* { dg-options \"-fopenmp -fdump-tree-omplower\" } */\n+\n+extern void bar (int);\n+\n+void\n+foo (void)\n+{\n+  int i = 0, j = 0;\n+#pragma omp parallel firstprivate (i) private (j)\n+  {\n+#pragma omp for\n+    for (i = 0; i < 2; i++)\n+      bar (i);\n+#pragma omp for\n+    for (j = 0; j < 2; j++)\n+      bar (j);\n+  }\n+}\n+\n+/* { dg-final { scan-tree-dump-times \"omp for\\[^\\\\n\\]*private\" 0 \"omplower\" } } */\n+/* { dg-final { cleanup-tree-dump \"omplower\" } } */"}]}