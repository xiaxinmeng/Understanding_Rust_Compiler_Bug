{"sha": "09c7dc636d0f407c4184b33e97928c3e2545130b", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6MDljN2RjNjM2ZDBmNDA3YzQxODRiMzNlOTc5MjhjM2UyNTQ1MTMwYg==", "commit": {"author": {"name": "Tilo Schwarz", "email": "tilo@tilo-schwarz.de", "date": "2013-03-20T07:45:49Z"}, "committer": {"name": "Tobias Burnus", "email": "burnus@gcc.gnu.org", "date": "2013-03-20T07:45:49Z"}, "message": "re PR libfortran/48618 (Negative unit number in OPEN(...) is sometimes allowed)\n\n2013-03-20  Tilo Schwarz  <tilo@tilo-schwarz.de>\n\n        PR libfortran/48618\n        * io/open.c (st_open): Raise error for unit number < 0 only if\n        unit number does not exist already.\n\n2013-03-20  Tilo Schwarz  <tilo@tilo-schwarz.de>\n\n        PR libfortran/48618\n        * gfortran.dg/open_negative_unit_1.f90: New.\n\nFrom-SVN: r196805", "tree": {"sha": "0744b6d570842d8431a17b50679a66226389d6f5", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/0744b6d570842d8431a17b50679a66226389d6f5"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/09c7dc636d0f407c4184b33e97928c3e2545130b", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/09c7dc636d0f407c4184b33e97928c3e2545130b", "html_url": "https://github.com/Rust-GCC/gccrs/commit/09c7dc636d0f407c4184b33e97928c3e2545130b", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/09c7dc636d0f407c4184b33e97928c3e2545130b/comments", "author": {"login": "tischwa", "id": 2934304, "node_id": "MDQ6VXNlcjI5MzQzMDQ=", "avatar_url": "https://avatars.githubusercontent.com/u/2934304?v=4", "gravatar_id": "", "url": "https://api.github.com/users/tischwa", "html_url": "https://github.com/tischwa", "followers_url": "https://api.github.com/users/tischwa/followers", "following_url": "https://api.github.com/users/tischwa/following{/other_user}", "gists_url": "https://api.github.com/users/tischwa/gists{/gist_id}", "starred_url": "https://api.github.com/users/tischwa/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/tischwa/subscriptions", "organizations_url": "https://api.github.com/users/tischwa/orgs", "repos_url": "https://api.github.com/users/tischwa/repos", "events_url": "https://api.github.com/users/tischwa/events{/privacy}", "received_events_url": "https://api.github.com/users/tischwa/received_events", "type": "User", "site_admin": false}, "committer": null, "parents": [{"sha": "a192015dbab317517c463c5ed1ce03f3df22cbbe", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/a192015dbab317517c463c5ed1ce03f3df22cbbe", "html_url": "https://github.com/Rust-GCC/gccrs/commit/a192015dbab317517c463c5ed1ce03f3df22cbbe"}], "stats": {"total": 46, "additions": 41, "deletions": 5}, "files": [{"sha": "7fe42de5bf297bae6976c9d82cf8899b1ce0fe93", "filename": "gcc/testsuite/ChangeLog", "status": "modified", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/09c7dc636d0f407c4184b33e97928c3e2545130b/gcc%2Ftestsuite%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/09c7dc636d0f407c4184b33e97928c3e2545130b/gcc%2Ftestsuite%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2FChangeLog?ref=09c7dc636d0f407c4184b33e97928c3e2545130b", "patch": "@@ -1,3 +1,8 @@\n+2013-03-20  Tilo Schwarz  <tilo@tilo-schwarz.de>\n+\n+\tPR libfortran/48618\n+\t* gfortran.dg/open_negative_unit_1.f90: New.\n+\n 2013-03-19  Ian Bolton  <ian.bolton@arm.com>\n \n \t* gcc.target/aarch64/sbc.c: New test."}, {"sha": "6446436c8855c7fc963811adb06dc0c5febc98c4", "filename": "gcc/testsuite/gfortran.dg/open_negative_unit_1.f90", "status": "added", "additions": 21, "deletions": 0, "changes": 21, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/09c7dc636d0f407c4184b33e97928c3e2545130b/gcc%2Ftestsuite%2Fgfortran.dg%2Fopen_negative_unit_1.f90", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/09c7dc636d0f407c4184b33e97928c3e2545130b/gcc%2Ftestsuite%2Fgfortran.dg%2Fopen_negative_unit_1.f90", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgfortran.dg%2Fopen_negative_unit_1.f90?ref=09c7dc636d0f407c4184b33e97928c3e2545130b", "patch": "@@ -0,0 +1,21 @@\n+! { dg-do run }\n+! PR48618 - Negative unit number in OPEN(...) is sometimes allowed\n+!\n+! Test originally from Janne Blomqvist in PR:\n+! http://gcc.gnu.org/bugzilla/show_bug.cgi?id=48618\n+\n+program nutest\n+    implicit none\n+    integer id, ios\n+\n+    open(newunit=id, file=\"foo.txt\", iostat=ios)\n+    if (ios /= 0) call abort\n+\n+    open(id, file=\"bar.txt\", iostat=ios)\n+    if (ios /= 0) call abort\n+\n+    close(id, status=\"delete\")\n+\n+    open(-10, file=\"foo.txt\", iostat=ios)\n+    if (ios == 0) call abort\n+end program nutest"}, {"sha": "31d5b57ef91339790f3f5fc17bd96b916fc2e9bc", "filename": "libgfortran/ChangeLog", "status": "modified", "additions": 6, "deletions": 0, "changes": 6, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/09c7dc636d0f407c4184b33e97928c3e2545130b/libgfortran%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/09c7dc636d0f407c4184b33e97928c3e2545130b/libgfortran%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libgfortran%2FChangeLog?ref=09c7dc636d0f407c4184b33e97928c3e2545130b", "patch": "@@ -1,3 +1,9 @@\n+2013-03-20  Tilo Schwarz  <tilo@tilo-schwarz.de>\n+\n+\tPR libfortran/48618\n+\t* io/open.c (st_open): Raise error for unit number < 0 only if\n+\tunit number does not exist already.\n+\n 2013-03-19  Janne Blomqvist  <jb@gcc.gnu.org>\n \n \t* libgfortran.h: Include stdbool.h."}, {"sha": "19fab1d683f2646342a1f1ccc57b0d80f46b231a", "filename": "libgfortran/io/open.c", "status": "modified", "additions": 9, "deletions": 5, "changes": 14, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/09c7dc636d0f407c4184b33e97928c3e2545130b/libgfortran%2Fio%2Fopen.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/09c7dc636d0f407c4184b33e97928c3e2545130b/libgfortran%2Fio%2Fopen.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libgfortran%2Fio%2Fopen.c?ref=09c7dc636d0f407c4184b33e97928c3e2545130b", "patch": "@@ -818,10 +818,6 @@ st_open (st_parameter_open *opp)\n \n   flags.convert = conv;\n \n-  if (!(opp->common.flags & IOPARM_OPEN_HAS_NEWUNIT) && opp->common.unit < 0)\n-    generate_error (&opp->common, LIBERROR_BAD_OPTION,\n-\t\t    \"Bad unit number in OPEN statement\");\n-\n   if (flags.position != POSITION_UNSPECIFIED\n       && flags.access == ACCESS_DIRECT)\n     generate_error (&opp->common, LIBERROR_BAD_OPTION,\n@@ -848,8 +844,16 @@ st_open (st_parameter_open *opp)\n     {\n       if ((opp->common.flags & IOPARM_OPEN_HAS_NEWUNIT))\n \topp->common.unit = get_unique_unit_number(opp);\n+      else if (opp->common.unit < 0)\n+\t{\n+\t  u = find_unit (opp->common.unit);\n+\t  if (u == NULL) /* Negative unit and no NEWUNIT-created unit found.  */\n+\t    generate_error (&opp->common, LIBERROR_BAD_OPTION,\n+\t\t\t    \"Bad unit number in OPEN statement\");\n+\t}\n \n-      u = find_or_create_unit (opp->common.unit);\n+      if (u == NULL)\n+\tu = find_or_create_unit (opp->common.unit);\n       if (u->s == NULL)\n \t{\n \t  u = new_unit (opp, u, &flags);"}]}