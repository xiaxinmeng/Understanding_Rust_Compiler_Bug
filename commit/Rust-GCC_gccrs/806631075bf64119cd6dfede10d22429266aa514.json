{"sha": "806631075bf64119cd6dfede10d22429266aa514", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6ODA2NjMxMDc1YmY2NDExOWNkNmRmZWRlMTBkMjI0MjkyNjZhYTUxNA==", "commit": {"author": {"name": "Mircea Namolaru", "email": "namolaru@il.ibm.com", "date": "2008-01-17T17:49:32Z"}, "committer": {"name": "Revital Eres", "email": "revitale@gcc.gnu.org", "date": "2008-01-17T17:49:32Z"}, "message": "Fix 34826\n\nFrom-SVN: r131604", "tree": {"sha": "19b4e65ff60f74bee91f1896d5f9aeafbe206c91", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/19b4e65ff60f74bee91f1896d5f9aeafbe206c91"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/806631075bf64119cd6dfede10d22429266aa514", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/806631075bf64119cd6dfede10d22429266aa514", "html_url": "https://github.com/Rust-GCC/gccrs/commit/806631075bf64119cd6dfede10d22429266aa514", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/806631075bf64119cd6dfede10d22429266aa514/comments", "author": null, "committer": null, "parents": [{"sha": "599824d24ab2e824ba8af60c123debc03023a94d", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/599824d24ab2e824ba8af60c123debc03023a94d", "html_url": "https://github.com/Rust-GCC/gccrs/commit/599824d24ab2e824ba8af60c123debc03023a94d"}], "stats": {"total": 19, "additions": 19, "deletions": 0}, "files": [{"sha": "15885512ed314dde94b1389e7a0c51eea3d7a0cf", "filename": "gcc/ChangeLog", "status": "modified", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/806631075bf64119cd6dfede10d22429266aa514/gcc%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/806631075bf64119cd6dfede10d22429266aa514/gcc%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2FChangeLog?ref=806631075bf64119cd6dfede10d22429266aa514", "patch": "@@ -1,3 +1,8 @@\n+2008-01-17  Mircea Namolaru  <namolaru@il.ibm.com>\n+\n+\tPR rtl-optimization/34826\n+\t* loop-doloop (doloop_modify): Update the REG_BR_PROB note.\n+\n 2008-01-17  Andreas Krebbel  <krebbel1@de.ibm.com>\n \n \t* global.c (find_reg): Mark the eh regs as used if necessary."}, {"sha": "448bb723a55e7a67507ec282cbe98e1766a9f10b", "filename": "gcc/loop-doloop.c", "status": "modified", "additions": 14, "deletions": 0, "changes": 14, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/806631075bf64119cd6dfede10d22429266aa514/gcc%2Floop-doloop.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/806631075bf64119cd6dfede10d22429266aa514/gcc%2Floop-doloop.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Floop-doloop.c?ref=806631075bf64119cd6dfede10d22429266aa514", "patch": "@@ -348,6 +348,7 @@ doloop_modify (struct loop *loop, struct niter_desc *desc,\n   bool increment_count;\n   basic_block loop_end = desc->out_edge->src;\n   enum machine_mode mode;\n+  rtx true_prob_val;\n \n   jump_insn = BB_END (loop_end);\n \n@@ -361,6 +362,10 @@ doloop_modify (struct loop *loop, struct niter_desc *desc,\n       fputs (\" iterations).\\n\", dump_file);\n     }\n \n+  /* Get the probabilty of the original branch. If it exists we would\n+     need to update REG_BR_PROB of the new jump_insn.  */\n+  true_prob_val = find_reg_note (jump_insn, REG_BR_PROB, NULL_RTX);\n+\n   /* Discard original jump to continue loop.  The original compare\n      result may still be live, so it cannot be discarded explicitly.  */\n   delete_insn (jump_insn);\n@@ -516,6 +521,15 @@ doloop_modify (struct loop *loop, struct niter_desc *desc,\n       REG_NOTES (jump_insn)\n \t= gen_rtx_EXPR_LIST (REG_NONNEG, NULL_RTX, REG_NOTES (jump_insn));\n     }\n+  /* Update the REG_BR_PROB note.  */\n+  if (true_prob_val)\n+    {\n+      /* Seems safer to use the branch probability.  */\n+      REG_NOTES (jump_insn) =\n+        gen_rtx_EXPR_LIST (REG_BR_PROB,\n+                           GEN_INT (desc->in_edge->probability),\n+                           REG_NOTES (jump_insn));\n+    }\n }\n \n /* Process loop described by LOOP validating that the loop is suitable for"}]}