{"sha": "1eb4bea9e99660d553906b821561098e039d13dd", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6MWViNGJlYTllOTk2NjBkNTUzOTA2YjgyMTU2MTA5OGUwMzlkMTNkZA==", "commit": {"author": {"name": "Mark Mitchell", "email": "mark@codesourcery.com", "date": "2000-01-17T05:12:39Z"}, "committer": {"name": "Mark Mitchell", "email": "mmitchel@gcc.gnu.org", "date": "2000-01-17T05:12:39Z"}, "message": "class.c (finish_struct_1): Replace redundant code with assertions.\n\n\t* class.c (finish_struct_1): Replace redundant code with\n\tassertions.\n\nFrom-SVN: r31454", "tree": {"sha": "8e335965cfb0a27f94c9438c054a5d02f04d2ddd", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/8e335965cfb0a27f94c9438c054a5d02f04d2ddd"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/1eb4bea9e99660d553906b821561098e039d13dd", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/1eb4bea9e99660d553906b821561098e039d13dd", "html_url": "https://github.com/Rust-GCC/gccrs/commit/1eb4bea9e99660d553906b821561098e039d13dd", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/1eb4bea9e99660d553906b821561098e039d13dd/comments", "author": null, "committer": null, "parents": [{"sha": "39ac3e4f68b746afd0069f8c74355ecb34deeb73", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/39ac3e4f68b746afd0069f8c74355ecb34deeb73", "html_url": "https://github.com/Rust-GCC/gccrs/commit/39ac3e4f68b746afd0069f8c74355ecb34deeb73"}], "stats": {"total": 25, "additions": 14, "deletions": 11}, "files": [{"sha": "ae00eaf7a2402806c4fd7acd7da0f29c27e04d69", "filename": "gcc/cp/ChangeLog", "status": "modified", "additions": 3, "deletions": 0, "changes": 3, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/1eb4bea9e99660d553906b821561098e039d13dd/gcc%2Fcp%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/1eb4bea9e99660d553906b821561098e039d13dd/gcc%2Fcp%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fcp%2FChangeLog?ref=1eb4bea9e99660d553906b821561098e039d13dd", "patch": "@@ -1,5 +1,8 @@\n 2000-01-16  Mark Mitchell  <mark@codesourcery.com>\n \n+\t* class.c (finish_struct_1): Replace redundant code with\n+\tassertions.\n+\n \t* cp-tree.h (flag_new_abi): Move.\n \t(flag_use_cxa_atexit): Likewise.\n \t(flag_honor_std): Likewise."}, {"sha": "9b14ded42420a466c7ba27cc74d032c52ac62617", "filename": "gcc/cp/class.c", "status": "modified", "additions": 11, "deletions": 11, "changes": 22, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/1eb4bea9e99660d553906b821561098e039d13dd/gcc%2Fcp%2Fclass.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/1eb4bea9e99660d553906b821561098e039d13dd/gcc%2Fcp%2Fclass.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fcp%2Fclass.c?ref=1eb4bea9e99660d553906b821561098e039d13dd", "patch": "@@ -4906,18 +4906,18 @@ finish_struct_1 (t)\n \n   if (TYPE_CONTAINS_VPTR_P (t))\n     {\n+      if (TYPE_BINFO_VTABLE (t))\n+\tmy_friendly_assert (DECL_VIRTUAL_P (TYPE_BINFO_VTABLE (t)),\n+\t\t\t    20000116);\n+      if (!CLASSTYPE_HAS_PRIMARY_BASE_P (t))\n+\tmy_friendly_assert (TYPE_BINFO_VIRTUALS (t) == NULL_TREE,\n+\t\t\t    20000116);\n+\n       CLASSTYPE_VSIZE (t) = has_virtual;\n-      if (CLASSTYPE_HAS_PRIMARY_BASE_P (t))\n-\t{\n-\t  if (pending_virtuals)\n-\t    TYPE_BINFO_VIRTUALS (t) = chainon (TYPE_BINFO_VIRTUALS (t),\n-\t\t\t\t\t\tpending_virtuals);\n-\t}\n-      else if (has_virtual)\n-\t{\n-\t  TYPE_BINFO_VIRTUALS (t) = pending_virtuals;\n-\t  DECL_VIRTUAL_P (TYPE_BINFO_VTABLE (t)) = 1;\n-\t}\n+      /* Entries for virtual functions defined in the primary base are\n+\t followed by entries for new functions unique to this class.  */\n+      TYPE_BINFO_VIRTUALS (t) \n+\t= chainon (TYPE_BINFO_VIRTUALS (t), pending_virtuals);\n     }\n \n   /* Now lay out the virtual function table.  */"}]}