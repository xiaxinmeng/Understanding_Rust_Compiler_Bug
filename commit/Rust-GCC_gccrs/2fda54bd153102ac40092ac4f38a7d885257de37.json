{"sha": "2fda54bd153102ac40092ac4f38a7d885257de37", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6MmZkYTU0YmQxNTMxMDJhYzQwMDkyYWM0ZjM4YTdkODg1MjU3ZGUzNw==", "commit": {"author": {"name": "Matthias Klose", "email": "doko@ubuntu.com", "date": "2012-01-26T23:34:58Z"}, "committer": {"name": "Matthias Klose", "email": "doko@gcc.gnu.org", "date": "2012-01-26T23:34:58Z"}, "message": "gcc.c (add_sysrooted_prefix): Remove trailing dir separator from system root.\n\n2012-01-27  Matthias Klose  <doko@ubuntu.com>\n\n        * gcc.c (add_sysrooted_prefix): Remove trailing dir separator from\n          system root.\n        * incpath.c (add_standard_paths): Likewise.\n\nFrom-SVN: r183591", "tree": {"sha": "2fc10497db064ce149773544b78b0900ecfbf688", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/2fc10497db064ce149773544b78b0900ecfbf688"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/2fda54bd153102ac40092ac4f38a7d885257de37", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/2fda54bd153102ac40092ac4f38a7d885257de37", "html_url": "https://github.com/Rust-GCC/gccrs/commit/2fda54bd153102ac40092ac4f38a7d885257de37", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/2fda54bd153102ac40092ac4f38a7d885257de37/comments", "author": {"login": "doko42", "id": 11258518, "node_id": "MDQ6VXNlcjExMjU4NTE4", "avatar_url": "https://avatars.githubusercontent.com/u/11258518?v=4", "gravatar_id": "", "url": "https://api.github.com/users/doko42", "html_url": "https://github.com/doko42", "followers_url": "https://api.github.com/users/doko42/followers", "following_url": "https://api.github.com/users/doko42/following{/other_user}", "gists_url": "https://api.github.com/users/doko42/gists{/gist_id}", "starred_url": "https://api.github.com/users/doko42/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/doko42/subscriptions", "organizations_url": "https://api.github.com/users/doko42/orgs", "repos_url": "https://api.github.com/users/doko42/repos", "events_url": "https://api.github.com/users/doko42/events{/privacy}", "received_events_url": "https://api.github.com/users/doko42/received_events", "type": "User", "site_admin": false}, "committer": null, "parents": [{"sha": "3beac6b971c4c63da1a1f23b46f296d6156d7d3f", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/3beac6b971c4c63da1a1f23b46f296d6156d7d3f", "html_url": "https://github.com/Rust-GCC/gccrs/commit/3beac6b971c4c63da1a1f23b46f296d6156d7d3f"}], "stats": {"total": 28, "additions": 25, "deletions": 3}, "files": [{"sha": "82fc2ad5d5b8871142e19239dab7090f7f8b5f14", "filename": "gcc/ChangeLog", "status": "modified", "additions": 6, "deletions": 0, "changes": 6, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/2fda54bd153102ac40092ac4f38a7d885257de37/gcc%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/2fda54bd153102ac40092ac4f38a7d885257de37/gcc%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2FChangeLog?ref=2fda54bd153102ac40092ac4f38a7d885257de37", "patch": "@@ -1,3 +1,9 @@\n+2012-01-27  Matthias Klose  <doko@ubuntu.com>\n+\n+\t* gcc.c (add_sysrooted_prefix): Remove trailing dir separator from\n+\t  system root.\n+\t* incpath.c (add_standard_paths): Likewise.\n+\n 2012-01-27  Richard Henderson  <rth@redhat.com>\n \n \t* config/m68k/m68k.c (TARGET_ATOMIC_TEST_AND_SET_TRUEVAL): New."}, {"sha": "bea9b4642070ea5634299809078a48b09cb070b8", "filename": "gcc/gcc.c", "status": "modified", "additions": 9, "deletions": 1, "changes": 10, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/2fda54bd153102ac40092ac4f38a7d885257de37/gcc%2Fgcc.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/2fda54bd153102ac40092ac4f38a7d885257de37/gcc%2Fgcc.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fgcc.c?ref=2fda54bd153102ac40092ac4f38a7d885257de37", "patch": "@@ -2445,9 +2445,17 @@ add_sysrooted_prefix (struct path_prefix *pprefix, const char *prefix,\n \n   if (target_system_root)\n     {\n+      char *sysroot_no_trailing_dir_separator = xstrdup (target_system_root);\n+      size_t sysroot_len = strlen (target_system_root);\n+\n+      if (sysroot_len > 0\n+\t  && target_system_root[sysroot_len - 1] == DIR_SEPARATOR)\n+\tsysroot_no_trailing_dir_separator[sysroot_len - 1] = '\\0';\n+\n       if (target_sysroot_suffix)\n \t  prefix = concat (target_sysroot_suffix, prefix, NULL);\n-      prefix = concat (target_system_root, prefix, NULL);\n+      prefix = concat (sysroot_no_trailing_dir_separator, prefix, NULL);\n+      free (sysroot_no_trailing_dir_separator);\n \n       /* We have to override this because GCC's notion of sysroot\n \t moves along with GCC.  */"}, {"sha": "6693bf524503857fe84b316a4c79ef7902de390e", "filename": "gcc/incpath.c", "status": "modified", "additions": 10, "deletions": 2, "changes": 12, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/2fda54bd153102ac40092ac4f38a7d885257de37/gcc%2Fincpath.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/2fda54bd153102ac40092ac4f38a7d885257de37/gcc%2Fincpath.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fincpath.c?ref=2fda54bd153102ac40092ac4f38a7d885257de37", "patch": "@@ -1,6 +1,6 @@\n /* Set up combined include path chain for the preprocessor.\n    Copyright (C) 1986, 1987, 1989, 1992, 1993, 1994, 1995, 1996, 1997, 1998,\n-   1999, 2000, 2001, 2002, 2003, 2004, 2005, 2006, 2007, 2008, 2010\n+   1999, 2000, 2001, 2002, 2003, 2004, 2005, 2006, 2007, 2008, 2010, 2012\n    Free Software Foundation, Inc.\n \n    Broken out of cppinit.c and cppfiles.c and rewritten Mar 2003.\n@@ -166,7 +166,15 @@ add_standard_paths (const char *sysroot, const char *iprefix,\n \n \t  /* Should this directory start with the sysroot?  */\n \t  if (sysroot && p->add_sysroot)\n-\t    str = concat (sysroot, p->fname, NULL);\n+\t    {\n+\t      char *sysroot_no_trailing_dir_separator = xstrdup (sysroot);\n+\t      size_t sysroot_len = strlen (sysroot);\n+\n+\t      if (sysroot_len > 0 && sysroot[sysroot_len - 1] == DIR_SEPARATOR)\n+\t\tsysroot_no_trailing_dir_separator[sysroot_len - 1] = '\\0';\n+\t      str = concat (sysroot_no_trailing_dir_separator, p->fname, NULL);\n+\t      free (sysroot_no_trailing_dir_separator);\n+\t    }\n \t  else if (!p->add_sysroot && relocated\n \t\t   && !filename_ncmp (p->fname, cpp_PREFIX, cpp_PREFIX_len))\n \t    {"}]}