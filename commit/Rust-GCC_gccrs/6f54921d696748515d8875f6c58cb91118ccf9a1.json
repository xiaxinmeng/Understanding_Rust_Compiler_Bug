{"sha": "6f54921d696748515d8875f6c58cb91118ccf9a1", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6NmY1NDkyMWQ2OTY3NDg1MTVkODg3NWY2YzU4Y2I5MTExOGNjZjlhMQ==", "commit": {"author": {"name": "Jeff Law", "email": "law@gcc.gnu.org", "date": "1997-05-09T20:35:09Z"}, "committer": {"name": "Jeff Law", "email": "law@gcc.gnu.org", "date": "1997-05-09T20:35:09Z"}, "message": "mn10300.md (udivmodhi4, divmodhi4): Remove expander, give corresponding pattern [u]divmodhir4 name.\n\n        * mn10300.md (udivmodhi4, divmodhi4): Remove expander, give\n        corresponding pattern [u]divmodhir4 name.  Clear MDR register\n        in the udivmodhi4 pattern itself.\n        (clear_mdr): Delete pattern.\n\nFrom-SVN: r14058", "tree": {"sha": "dc8096f19f63ec311392cf3af27b2a53e892522f", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/dc8096f19f63ec311392cf3af27b2a53e892522f"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/6f54921d696748515d8875f6c58cb91118ccf9a1", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/6f54921d696748515d8875f6c58cb91118ccf9a1", "html_url": "https://github.com/Rust-GCC/gccrs/commit/6f54921d696748515d8875f6c58cb91118ccf9a1", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/6f54921d696748515d8875f6c58cb91118ccf9a1/comments", "author": null, "committer": null, "parents": [{"sha": "f0dc3f49258249dcec798021e1d7dabbf02a6ed0", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/f0dc3f49258249dcec798021e1d7dabbf02a6ed0", "html_url": "https://github.com/Rust-GCC/gccrs/commit/f0dc3f49258249dcec798021e1d7dabbf02a6ed0"}], "stats": {"total": 40, "additions": 8, "deletions": 32}, "files": [{"sha": "fcafb1295f79fbf5c6e9987cbf27bac8abd77e68", "filename": "gcc/config/mn10300/mn10300.md", "status": "modified", "additions": 8, "deletions": 32, "changes": 40, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/6f54921d696748515d8875f6c58cb91118ccf9a1/gcc%2Fconfig%2Fmn10300%2Fmn10300.md", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/6f54921d696748515d8875f6c58cb91118ccf9a1/gcc%2Fconfig%2Fmn10300%2Fmn10300.md", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fconfig%2Fmn10300%2Fmn10300.md?ref=6f54921d696748515d8875f6c58cb91118ccf9a1", "patch": "@@ -775,46 +775,28 @@\n   \"mul %2,%0\"\n   [(set_attr \"cc\" \"set_zn\")])\n \n-(define_expand \"udivmodsi4\"\n-  [(parallel [(set (match_operand:SI 0 \"register_operand\" \"\")\n-\t\t   (udiv:SI (match_operand:SI 1 \"register_operand\" \"\")\n-\t\t\t    (match_operand:SI 2 \"register_operand\" \"\")))\n-\t      (set (match_operand:SI 3 \"register_operand\" \"\")\n-\t\t   (umod:SI (match_dup 1) (match_dup 2)))])]\n-  \"\"\n-  \"\n-{\n-  rtx reg = gen_reg_rtx (SImode);\n-  emit_move_insn (reg, GEN_INT (0));\n-  emit_insn (gen_clear_mdr (reg));\n-}\")\n-\n-(define_insn \"\"\n+(define_insn \"udivmodsi4\"\n   [(set (match_operand:SI 0 \"general_operand\" \"=d\")\n \t(udiv:SI (match_operand:SI 1 \"general_operand\" \"0\")\n \t\t (match_operand:SI 2 \"general_operand\" \"d\")))\n-   (set (match_operand:SI 3 \"general_operand\" \"=d\")\n+   (set (match_operand:SI 3 \"general_operand\" \"=&d\")\n \t(umod:SI (match_dup 1) (match_dup 2)))]\n   \"\"\n   \"*\n {\n+  if (zero_dreg)\n+    output_asm_insn (\\\"mov %0,mdr\\\", &zero_dreg);\n+  else\n+    output_asm_insn (\\\"sub %3,%3\\;mov %3,mdr\\\", operands);\n+\n   if (find_reg_note (insn, REG_UNUSED, operands[3]))\n     return \\\"divu %2,%0\\\";\n   else\n     return \\\"divu %2,%0\\;mov mdr,%3\\\";\n }\"\n   [(set_attr \"cc\" \"set_zn\")])\n \n-(define_expand \"divmodsi4\"\n-  [(parallel [(set (match_operand:SI 0 \"register_operand\" \"\")\n-\t\t   (div:SI (match_operand:SI 1 \"register_operand\" \"\")\n-\t\t\t    (match_operand:SI 2 \"register_operand\" \"\")))\n-\t      (set (match_operand:SI 3 \"register_operand\" \"\")\n-\t\t   (mod:SI (match_dup 1) (match_dup 2)))])]\n-  \"\"\n-  \"\")\n-\n-(define_insn \"\"\n+(define_insn \"divmodsi4\"\n   [(set (match_operand:SI 0 \"general_operand\" \"=d\")\n \t(div:SI (match_operand:SI 1 \"general_operand\" \"0\")\n \t\t (match_operand:SI 2 \"general_operand\" \"d\")))\n@@ -830,12 +812,6 @@\n }\"\n   [(set_attr \"cc\" \"set_zn\")])\n \n-(define_insn \"clear_mdr\"\n-  [(unspec_volatile [(const_int 2)] 0)\n-   (use (match_operand:SI 0 \"register_operand\" \"d\"))]\n-  \"\"\n-  \"mov %0,mdr\"\n-  [(set_attr \"cc\" \"none\")])\n \f\n ;; ----------------------------------------------------------------------\n ;; AND INSTRUCTIONS"}]}