{"sha": "d35311a213ec3974c2bf91311ebd1380ffd080d4", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6ZDM1MzExYTIxM2VjMzk3NGMyYmY5MTMxMWViZDEzODBmZmQwODBkNA==", "commit": {"author": {"name": "Jason Merrill", "email": "jason@redhat.com", "date": "2009-12-04T00:26:35Z"}, "committer": {"name": "Jason Merrill", "email": "jason@gcc.gnu.org", "date": "2009-12-04T00:26:35Z"}, "message": "re PR middle-end/41611 (guard variable is emitted even when the guarded symbol isn't)\n\n\tPR c++/41611\n\t* decl2.c (get_guard): Don't use the same comdat group as the decl.\n\nFrom-SVN: r154965", "tree": {"sha": "3bc1df70e054a261cac8b5c41b0347f58b4a3919", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/3bc1df70e054a261cac8b5c41b0347f58b4a3919"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/d35311a213ec3974c2bf91311ebd1380ffd080d4", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/d35311a213ec3974c2bf91311ebd1380ffd080d4", "html_url": "https://github.com/Rust-GCC/gccrs/commit/d35311a213ec3974c2bf91311ebd1380ffd080d4", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/d35311a213ec3974c2bf91311ebd1380ffd080d4/comments", "author": {"login": "jicama", "id": 266146, "node_id": "MDQ6VXNlcjI2NjE0Ng==", "avatar_url": "https://avatars.githubusercontent.com/u/266146?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jicama", "html_url": "https://github.com/jicama", "followers_url": "https://api.github.com/users/jicama/followers", "following_url": "https://api.github.com/users/jicama/following{/other_user}", "gists_url": "https://api.github.com/users/jicama/gists{/gist_id}", "starred_url": "https://api.github.com/users/jicama/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jicama/subscriptions", "organizations_url": "https://api.github.com/users/jicama/orgs", "repos_url": "https://api.github.com/users/jicama/repos", "events_url": "https://api.github.com/users/jicama/events{/privacy}", "received_events_url": "https://api.github.com/users/jicama/received_events", "type": "User", "site_admin": false}, "committer": null, "parents": [{"sha": "4e3f6d8529cfab76897fa4f1618409efdd468ae7", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/4e3f6d8529cfab76897fa4f1618409efdd468ae7", "html_url": "https://github.com/Rust-GCC/gccrs/commit/4e3f6d8529cfab76897fa4f1618409efdd468ae7"}], "stats": {"total": 25, "additions": 24, "deletions": 1}, "files": [{"sha": "cdbd1c48a1f460ee10ddcc85c46f6f8d7ae1af9d", "filename": "gcc/cp/ChangeLog", "status": "modified", "additions": 3, "deletions": 0, "changes": 3, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/d35311a213ec3974c2bf91311ebd1380ffd080d4/gcc%2Fcp%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/d35311a213ec3974c2bf91311ebd1380ffd080d4/gcc%2Fcp%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fcp%2FChangeLog?ref=d35311a213ec3974c2bf91311ebd1380ffd080d4", "patch": "@@ -1,5 +1,8 @@\n 2009-12-03  Jason Merrill  <jason@redhat.com>\n \n+\tPR c++/41611\n+\t* decl2.c (get_guard): Don't use the same comdat group as the decl.\n+\n \tPR c++/42266\n \t* cvt.c (convert_from_reference): Do nothing if TREE_TYPE is null.\n "}, {"sha": "faa3c9d45a96bbfd6880523d777f0d3bf4d1a467", "filename": "gcc/cp/decl2.c", "status": "modified", "additions": 2, "deletions": 1, "changes": 3, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/d35311a213ec3974c2bf91311ebd1380ffd080d4/gcc%2Fcp%2Fdecl2.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/d35311a213ec3974c2bf91311ebd1380ffd080d4/gcc%2Fcp%2Fdecl2.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fcp%2Fdecl2.c?ref=d35311a213ec3974c2bf91311ebd1380ffd080d4", "patch": "@@ -2555,7 +2555,8 @@ get_guard (tree decl)\n       TREE_STATIC (guard) = TREE_STATIC (decl);\n       DECL_COMMON (guard) = DECL_COMMON (decl);\n       DECL_COMDAT (guard) = DECL_COMDAT (decl);\n-      DECL_COMDAT_GROUP (guard) = DECL_COMDAT_GROUP (decl);\n+      if (DECL_ONE_ONLY (decl))\n+\tmake_decl_one_only (guard, cxx_comdat_group (guard));\n       if (TREE_PUBLIC (decl))\n \tDECL_WEAK (guard) = DECL_WEAK (decl);\n       DECL_VISIBILITY (guard) = DECL_VISIBILITY (decl);"}, {"sha": "c68c0b64d4e9732ccd848b0fb9bd76307e27bee6", "filename": "gcc/testsuite/ChangeLog", "status": "modified", "additions": 3, "deletions": 0, "changes": 3, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/d35311a213ec3974c2bf91311ebd1380ffd080d4/gcc%2Ftestsuite%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/d35311a213ec3974c2bf91311ebd1380ffd080d4/gcc%2Ftestsuite%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2FChangeLog?ref=d35311a213ec3974c2bf91311ebd1380ffd080d4", "patch": "@@ -1,5 +1,8 @@\n 2009-12-03  Jason Merrill  <jason@redhat.com>\n \n+\tPR c++/41611\n+\t* g++.dg/abi/guard2.C: New.\n+\n \tPR c++/42266\n \t* g++.dg/cpp0x/variadic97.C: New.\n "}, {"sha": "09643e952285783ec83adaa068892f15a8b91038", "filename": "gcc/testsuite/g++.dg/abi/guard2.C", "status": "added", "additions": 16, "deletions": 0, "changes": 16, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/d35311a213ec3974c2bf91311ebd1380ffd080d4/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Fabi%2Fguard2.C", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/d35311a213ec3974c2bf91311ebd1380ffd080d4/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Fabi%2Fguard2.C", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Fabi%2Fguard2.C?ref=d35311a213ec3974c2bf91311ebd1380ffd080d4", "patch": "@@ -0,0 +1,16 @@\n+// PR c++/41611\n+// Test that the guard gets its own COMDAT group.\n+// { dg-final { scan-assembler \"_ZGVZN1A1fEvE1i,comdat\" { target i?86-*-* x86_64-*-* } } }\n+\n+struct A {\n+  static int f()\n+  {\n+    static int &i = *new int();\n+    return i;\n+  }\n+};\n+\n+int main()\n+{\n+  return A::f();\n+}"}]}