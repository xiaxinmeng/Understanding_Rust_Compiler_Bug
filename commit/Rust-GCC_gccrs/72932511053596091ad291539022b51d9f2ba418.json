{"sha": "72932511053596091ad291539022b51d9f2ba418", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6NzI5MzI1MTEwNTM1OTYwOTFhZDI5MTUzOTAyMmI1MWQ5ZjJiYTQxOA==", "commit": {"author": {"name": "Richard Biener", "email": "rguenther@suse.de", "date": "2021-02-10T09:17:15Z"}, "committer": {"name": "Richard Biener", "email": "rguenther@suse.de", "date": "2021-02-10T10:31:13Z"}, "message": "rtl-optimization/99054 - fix leak in fixup_partitions\n\nThis fixes a leak of the vector retured by find_partition_fixes\nby turning it into an auto_vec.\n\n2021-02-10  Richard Biener  <rguenther@suse.de>\n\n\tPR rtl-optimization/99054\n\t* cfgrtl.c (rtl-optimization/99054): Return an auto_vec.\n\t(fixup_partitions): Adjust.\n\t(rtl_verify_edges): Likewise.", "tree": {"sha": "deed5164277a505e145f917fc814cd9878f0d746", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/deed5164277a505e145f917fc814cd9878f0d746"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/72932511053596091ad291539022b51d9f2ba418", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/72932511053596091ad291539022b51d9f2ba418", "html_url": "https://github.com/Rust-GCC/gccrs/commit/72932511053596091ad291539022b51d9f2ba418", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/72932511053596091ad291539022b51d9f2ba418/comments", "author": {"login": "rguenth", "id": 2046526, "node_id": "MDQ6VXNlcjIwNDY1MjY=", "avatar_url": "https://avatars.githubusercontent.com/u/2046526?v=4", "gravatar_id": "", "url": "https://api.github.com/users/rguenth", "html_url": "https://github.com/rguenth", "followers_url": "https://api.github.com/users/rguenth/followers", "following_url": "https://api.github.com/users/rguenth/following{/other_user}", "gists_url": "https://api.github.com/users/rguenth/gists{/gist_id}", "starred_url": "https://api.github.com/users/rguenth/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/rguenth/subscriptions", "organizations_url": "https://api.github.com/users/rguenth/orgs", "repos_url": "https://api.github.com/users/rguenth/repos", "events_url": "https://api.github.com/users/rguenth/events{/privacy}", "received_events_url": "https://api.github.com/users/rguenth/received_events", "type": "User", "site_admin": false}, "committer": {"login": "rguenth", "id": 2046526, "node_id": "MDQ6VXNlcjIwNDY1MjY=", "avatar_url": "https://avatars.githubusercontent.com/u/2046526?v=4", "gravatar_id": "", "url": "https://api.github.com/users/rguenth", "html_url": "https://github.com/rguenth", "followers_url": "https://api.github.com/users/rguenth/followers", "following_url": "https://api.github.com/users/rguenth/following{/other_user}", "gists_url": "https://api.github.com/users/rguenth/gists{/gist_id}", "starred_url": "https://api.github.com/users/rguenth/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/rguenth/subscriptions", "organizations_url": "https://api.github.com/users/rguenth/orgs", "repos_url": "https://api.github.com/users/rguenth/repos", "events_url": "https://api.github.com/users/rguenth/events{/privacy}", "received_events_url": "https://api.github.com/users/rguenth/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "bd0e37f68a3aed944df4eb739a0734bb87153749", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/bd0e37f68a3aed944df4eb739a0734bb87153749", "html_url": "https://github.com/Rust-GCC/gccrs/commit/bd0e37f68a3aed944df4eb739a0734bb87153749"}], "stats": {"total": 8, "additions": 4, "deletions": 4}, "files": [{"sha": "3f55a3265f2e44c882aa927e97d491a8fc1c2eea", "filename": "gcc/cfgrtl.c", "status": "modified", "additions": 4, "deletions": 4, "changes": 8, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/72932511053596091ad291539022b51d9f2ba418/gcc%2Fcfgrtl.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/72932511053596091ad291539022b51d9f2ba418/gcc%2Fcfgrtl.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fcfgrtl.c?ref=72932511053596091ad291539022b51d9f2ba418", "patch": "@@ -2381,11 +2381,11 @@ find_bbs_reachable_by_hot_paths (hash_set<basic_block> *set)\n    cfg optimizations that may make hot blocks previously reached\n    by both hot and cold blocks now only reachable along cold paths.  */\n \n-static vec<basic_block>\n+static auto_vec<basic_block>\n find_partition_fixes (bool flag_only)\n {\n   basic_block bb;\n-  vec<basic_block> bbs_to_fix = vNULL;\n+  auto_vec<basic_block> bbs_to_fix;\n   hash_set<basic_block> set;\n \n   /* Callers check this.  */\n@@ -2431,7 +2431,7 @@ fixup_partitions (void)\n    \u00a0 a cold partition cannot dominate a basic block in a hot partition.\n      Fixup any that now violate this requirement, as a result of edge\n      forwarding and unreachable block deletion. \u00a0*/\n-  vec<basic_block> bbs_to_fix = find_partition_fixes (false);\n+  auto_vec<basic_block> bbs_to_fix = find_partition_fixes (false);\n \n   /* Do the partition fixup after all necessary blocks have been converted to\n      cold, so that we only update the region crossings the minimum number of\n@@ -2682,7 +2682,7 @@ rtl_verify_edges (void)\n   if (crtl->has_bb_partition && !err\n       && current_ir_type () == IR_RTL_CFGLAYOUT)\n     {\n-      vec<basic_block> bbs_to_fix = find_partition_fixes (true);\n+      auto_vec<basic_block> bbs_to_fix = find_partition_fixes (true);\n       err = !bbs_to_fix.is_empty ();\n     }\n "}]}