{"sha": "19448640ac04e980ef665ae72bc3f106b4e5b6e0", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6MTk0NDg2NDBhYzA0ZTk4MGVmNjY1YWU3MmJjM2YxMDZiNGU1YjZlMA==", "commit": {"author": {"name": "Hristian Kirtchev", "email": "kirtchev@adacore.com", "date": "2019-07-10T08:59:46Z"}, "committer": {"name": "Pierre-Marie de Rodat", "email": "pmderodat@gcc.gnu.org", "date": "2019-07-10T08:59:46Z"}, "message": "[Ada] Elaboration order v4.0 and linker switches\n\nThis patch adds a missing functionality with respect to elaboration\norder v3.0.  Units carry an attribute called Elab_Position which among\nother things controls the sorting of linker switches by gnatbind.\nSetting the proper position ensures the gnatbind will output the linker\nswitches in an order compatible with what gnatlink expects.\n\nNo simple test available as this requires a Windows cross-compiler.\n\n2019-07-10  Hristian Kirtchev  <kirtchev@adacore.com>\n\ngcc/ada/\n\n\t* bindo-elaborators.adb (Elaborate_Units): Set attribute\n\tElab_Position of all elaborated units.\n\t(Set_Unit_Elaboration_Positions): New routine.\n\nFrom-SVN: r273326", "tree": {"sha": "20d634a5fcbf09b983aef0012360fa7828ee4d59", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/20d634a5fcbf09b983aef0012360fa7828ee4d59"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/19448640ac04e980ef665ae72bc3f106b4e5b6e0", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/19448640ac04e980ef665ae72bc3f106b4e5b6e0", "html_url": "https://github.com/Rust-GCC/gccrs/commit/19448640ac04e980ef665ae72bc3f106b4e5b6e0", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/19448640ac04e980ef665ae72bc3f106b4e5b6e0/comments", "author": {"login": "kirtchev-adacore", "id": 60669983, "node_id": "MDQ6VXNlcjYwNjY5OTgz", "avatar_url": "https://avatars.githubusercontent.com/u/60669983?v=4", "gravatar_id": "", "url": "https://api.github.com/users/kirtchev-adacore", "html_url": "https://github.com/kirtchev-adacore", "followers_url": "https://api.github.com/users/kirtchev-adacore/followers", "following_url": "https://api.github.com/users/kirtchev-adacore/following{/other_user}", "gists_url": "https://api.github.com/users/kirtchev-adacore/gists{/gist_id}", "starred_url": "https://api.github.com/users/kirtchev-adacore/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/kirtchev-adacore/subscriptions", "organizations_url": "https://api.github.com/users/kirtchev-adacore/orgs", "repos_url": "https://api.github.com/users/kirtchev-adacore/repos", "events_url": "https://api.github.com/users/kirtchev-adacore/events{/privacy}", "received_events_url": "https://api.github.com/users/kirtchev-adacore/received_events", "type": "User", "site_admin": false}, "committer": null, "parents": [{"sha": "3f833dc291c4ece5b7419e9dacf08b0831782693", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/3f833dc291c4ece5b7419e9dacf08b0831782693", "html_url": "https://github.com/Rust-GCC/gccrs/commit/3f833dc291c4ece5b7419e9dacf08b0831782693"}], "stats": {"total": 32, "additions": 32, "deletions": 0}, "files": [{"sha": "097359309a34cd63b2b1c3a4fbb4470ceb9494ec", "filename": "gcc/ada/ChangeLog", "status": "modified", "additions": 6, "deletions": 0, "changes": 6, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/19448640ac04e980ef665ae72bc3f106b4e5b6e0/gcc%2Fada%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/19448640ac04e980ef665ae72bc3f106b4e5b6e0/gcc%2Fada%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fada%2FChangeLog?ref=19448640ac04e980ef665ae72bc3f106b4e5b6e0", "patch": "@@ -1,3 +1,9 @@\n+2019-07-10  Hristian Kirtchev  <kirtchev@adacore.com>\n+\n+\t* bindo-elaborators.adb (Elaborate_Units): Set attribute\n+\tElab_Position of all elaborated units.\n+\t(Set_Unit_Elaboration_Positions): New routine.\n+\n 2019-07-10  Gary Dismukes  <dismukes@adacore.com>\n \n \t* exp_util.adb: Reformatting and a typo fix."}, {"sha": "0d9f207be3cd6087fd103a310fcc471ac75d8a38", "filename": "gcc/ada/bindo-elaborators.adb", "status": "modified", "additions": 26, "deletions": 0, "changes": 26, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/19448640ac04e980ef665ae72bc3f106b4e5b6e0/gcc%2Fada%2Fbindo-elaborators.adb", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/19448640ac04e980ef665ae72bc3f106b4e5b6e0/gcc%2Fada%2Fbindo-elaborators.adb", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fada%2Fbindo-elaborators.adb?ref=19448640ac04e980ef665ae72bc3f106b4e5b6e0", "patch": "@@ -274,6 +274,10 @@ package body Bindo.Elaborators is\n       --  Determine whether vertex Vertex of library graph G is suitable for\n       --  weak elaboration.\n \n+      procedure Set_Unit_Elaboration_Positions (Order : Unit_Id_Table);\n+      pragma Inline (Set_Unit_Elaboration_Positions);\n+      --  Set the ALI.Units positions of all elaboration units in order Order\n+\n       procedure Trace_Component\n         (G    : Library_Graph;\n          Comp : Component_Id;\n@@ -750,6 +754,11 @@ package body Bindo.Elaborators is\n          if Status = Order_OK then\n             Validate_Elaboration_Order (Order);\n \n+            --  Set attribute Elab_Position of table ALI.Units for all units in\n+            --  the elaboration order.\n+\n+            Set_Unit_Elaboration_Positions (Order);\n+\n             --  Output the dependencies among units when switch -e (output\n             --  complete list of elaboration order dependencies) is active.\n \n@@ -1304,6 +1313,23 @@ package body Bindo.Elaborators is\n              and then Is_Weakly_Elaborable_Vertex (G, Vertex);\n       end Is_Suitable_Weakly_Elaborable_Vertex;\n \n+      ------------------------------------\n+      -- Set_Unit_Elaboration_Positions --\n+      ------------------------------------\n+\n+      procedure Set_Unit_Elaboration_Positions (Order : Unit_Id_Table) is\n+         U_Id : Unit_Id;\n+\n+      begin\n+         for Position in Unit_Id_Tables.First ..\n+                         Unit_Id_Tables.Last (Order)\n+         loop\n+            U_Id := Order.Table (Position);\n+\n+            ALI.Units.Table (U_Id).Elab_Position := Position;\n+         end loop;\n+      end Set_Unit_Elaboration_Positions;\n+\n       ---------------------\n       -- Trace_Component --\n       ---------------------"}]}