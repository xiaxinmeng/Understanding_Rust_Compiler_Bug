{"sha": "661131664980c54b72c6223a53a464f23b8ec0a3", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6NjYxMTMxNjY0OTgwYzU0YjcyYzYyMjNhNTNhNDY0ZjIzYjhlYzBhMw==", "commit": {"author": {"name": "Bill Schmidt", "email": "wschmidt@linux.vnet.ibm.com", "date": "2017-01-12T16:01:13Z"}, "committer": {"name": "William Schmidt", "email": "wschmidt@gcc.gnu.org", "date": "2017-01-12T16:01:13Z"}, "message": "re PR target/79044 (ICE in insn_is_swappable_p, at config/rs6000/rs6000.c:41191)\n\n[gcc]\n\n2017-01-12  Bill Schmidt  <wschmidt@linux.vnet.ibm.com>\n\n\tPR target/79044\n\t* config/rs6000/rs6000.c (insn_is_swappable_p): Mark\n\telement-reversing loads and stores as not swappable.\n\n[gcc/testsuite]\n\n2017-01-12  Bill Schmidt  <wschmidt@linux.vnet.ibm.com>\n\n\tPR target/79044\n\t* gcc.target/powerpc/swaps-p8-26.c: New.\n\nFrom-SVN: r244368", "tree": {"sha": "55da712110b42b89723181d93c414e14d5e20509", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/55da712110b42b89723181d93c414e14d5e20509"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/661131664980c54b72c6223a53a464f23b8ec0a3", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/661131664980c54b72c6223a53a464f23b8ec0a3", "html_url": "https://github.com/Rust-GCC/gccrs/commit/661131664980c54b72c6223a53a464f23b8ec0a3", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/661131664980c54b72c6223a53a464f23b8ec0a3/comments", "author": {"login": "wschmidt-ibm", "id": 5520937, "node_id": "MDQ6VXNlcjU1MjA5Mzc=", "avatar_url": "https://avatars.githubusercontent.com/u/5520937?v=4", "gravatar_id": "", "url": "https://api.github.com/users/wschmidt-ibm", "html_url": "https://github.com/wschmidt-ibm", "followers_url": "https://api.github.com/users/wschmidt-ibm/followers", "following_url": "https://api.github.com/users/wschmidt-ibm/following{/other_user}", "gists_url": "https://api.github.com/users/wschmidt-ibm/gists{/gist_id}", "starred_url": "https://api.github.com/users/wschmidt-ibm/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/wschmidt-ibm/subscriptions", "organizations_url": "https://api.github.com/users/wschmidt-ibm/orgs", "repos_url": "https://api.github.com/users/wschmidt-ibm/repos", "events_url": "https://api.github.com/users/wschmidt-ibm/events{/privacy}", "received_events_url": "https://api.github.com/users/wschmidt-ibm/received_events", "type": "User", "site_admin": false}, "committer": null, "parents": [{"sha": "4e41b0e67f203cc1249e34a25f4e65d154435163", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/4e41b0e67f203cc1249e34a25f4e65d154435163", "html_url": "https://github.com/Rust-GCC/gccrs/commit/4e41b0e67f203cc1249e34a25f4e65d154435163"}], "stats": {"total": 42, "additions": 40, "deletions": 2}, "files": [{"sha": "8c75c4744219cd750a13bba5982c2d94ad4d7176", "filename": "gcc/ChangeLog", "status": "modified", "additions": 6, "deletions": 0, "changes": 6, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/661131664980c54b72c6223a53a464f23b8ec0a3/gcc%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/661131664980c54b72c6223a53a464f23b8ec0a3/gcc%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2FChangeLog?ref=661131664980c54b72c6223a53a464f23b8ec0a3", "patch": "@@ -1,3 +1,9 @@\n+2017-01-12  Bill Schmidt  <wschmidt@linux.vnet.ibm.com>\n+\n+\tPR target/79044\n+\t* config/rs6000/rs6000.c (insn_is_swappable_p): Mark\n+\telement-reversing loads and stores as not swappable.\n+\n 2017-01-12  Nathan Sidwell  <nathan@acm.org>\n \t    Nicolai Stange  <nicstange@gmail.com>\n "}, {"sha": "5909e27a6e294cf0a80f12fb635b96ae8df98f23", "filename": "gcc/config/rs6000/rs6000.c", "status": "modified", "additions": 8, "deletions": 2, "changes": 10, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/661131664980c54b72c6223a53a464f23b8ec0a3/gcc%2Fconfig%2Frs6000%2Frs6000.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/661131664980c54b72c6223a53a464f23b8ec0a3/gcc%2Fconfig%2Frs6000%2Frs6000.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fconfig%2Frs6000%2Frs6000.c?ref=661131664980c54b72c6223a53a464f23b8ec0a3", "patch": "@@ -41344,7 +41344,10 @@ insn_is_swappable_p (swap_web_entry *insn_entry, rtx insn,\n       if (GET_CODE (body) == SET)\n \t{\n \t  rtx rhs = SET_SRC (body);\n-\t  gcc_assert (GET_CODE (rhs) == MEM);\n+\t  /* Even without a swap, the RHS might be a vec_select for, say,\n+\t     a byte-reversing load.  */\n+\t  if (GET_CODE (rhs) != MEM)\n+\t    return 0;\n \t  if (GET_CODE (XEXP (rhs, 0)) == AND)\n \t    return 0;\n \n@@ -41361,7 +41364,10 @@ insn_is_swappable_p (swap_web_entry *insn_entry, rtx insn,\n \t  && GET_CODE (SET_SRC (body)) != UNSPEC)\n \t{\n \t  rtx lhs = SET_DEST (body);\n-\t  gcc_assert (GET_CODE (lhs) == MEM);\n+\t  /* Even without a swap, the LHS might be a vec_select for, say,\n+\t     a byte-reversing store.  */\n+\t  if (GET_CODE (lhs) != MEM)\n+\t    return 0;\n \t  if (GET_CODE (XEXP (lhs, 0)) == AND)\n \t    return 0;\n \t  "}, {"sha": "1de9520887d564973dc94e21f6bf77501b4dfc86", "filename": "gcc/testsuite/ChangeLog", "status": "modified", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/661131664980c54b72c6223a53a464f23b8ec0a3/gcc%2Ftestsuite%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/661131664980c54b72c6223a53a464f23b8ec0a3/gcc%2Ftestsuite%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2FChangeLog?ref=661131664980c54b72c6223a53a464f23b8ec0a3", "patch": "@@ -1,3 +1,8 @@\n+2017-01-12  Bill Schmidt  <wschmidt@linux.vnet.ibm.com>\n+\n+\tPR target/79044\n+\t* gcc.target/powerpc/swaps-p8-26.c: New.\n+\n 2017-01-12  Richard Biener  <rguenther@suse.de>\n \n \t* gcc.dg/gimplefe-21.c: New testcase."}, {"sha": "d01d86b94eb25e1a6977d4f279c3606a7c24c70c", "filename": "gcc/testsuite/gcc.target/powerpc/swaps-p8-26.c", "status": "added", "additions": 21, "deletions": 0, "changes": 21, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/661131664980c54b72c6223a53a464f23b8ec0a3/gcc%2Ftestsuite%2Fgcc.target%2Fpowerpc%2Fswaps-p8-26.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/661131664980c54b72c6223a53a464f23b8ec0a3/gcc%2Ftestsuite%2Fgcc.target%2Fpowerpc%2Fswaps-p8-26.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgcc.target%2Fpowerpc%2Fswaps-p8-26.c?ref=661131664980c54b72c6223a53a464f23b8ec0a3", "patch": "@@ -0,0 +1,21 @@\n+/* { dg-do compile { target { powerpc64le-*-* } } } */\n+/* { dg-skip-if \"do not override -mcpu\" { powerpc*-*-* } { \"-mcpu=*\" } { \"-mcpu=power8\" } } */\n+/* { dg-options \"-mcpu=power8 -O3 \" } */\n+/* { dg-final { scan-assembler-times \"lxvw4x\" 2 } } */\n+/* { dg-final { scan-assembler \"stxvw4x\" } } */\n+/* { dg-final { scan-assembler-not \"xxpermdi\" } } */\n+\n+/* Verify that swap optimization does not interfere with element-reversing\n+   loads and stores.  */\n+\n+/* Test case to resolve PR79044.  */\n+\n+#include <altivec.h>\n+\n+void pr79044 (float *x, float *y, float *z)\n+{\n+  vector float a = __builtin_vec_xl (0, x);\n+  vector float b = __builtin_vec_xl (0, y);\n+  vector float c = __builtin_vec_mul (a, b);\n+  __builtin_vec_xst (c, 0, z);\n+}"}]}