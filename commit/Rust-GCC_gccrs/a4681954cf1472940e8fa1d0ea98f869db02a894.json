{"sha": "a4681954cf1472940e8fa1d0ea98f869db02a894", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6YTQ2ODE5NTRjZjE0NzI5NDBlOGZhMWQwZWE5OGY4NjlkYjAyYTg5NA==", "commit": {"author": {"name": "Sebastian Pop", "email": "seb@napoca", "date": "2010-02-11T19:42:45Z"}, "committer": {"name": "Sebastian Pop", "email": "spop@gcc.gnu.org", "date": "2010-02-11T19:42:45Z"}, "message": "Fix PR42914 and PR42530.\n\n2010-02-10  Sebastian Pop  <seb@napoca>\n\n\tPR middle-end/42914\n\tPR middle-end/42530\n\t* graphite-sese-to-poly.c (remove_phi): New.\n\t(translate_scalar_reduction_to_array): Call remove_phi.\n\n\t* gcc.dg/graphite/pr42530.c: New.\n\t* gcc.dg/graphite/pr42914.c: New.\n\nFrom-SVN: r156712", "tree": {"sha": "95565b7e65088fe9e8b94dd9329804d7da838463", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/95565b7e65088fe9e8b94dd9329804d7da838463"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/a4681954cf1472940e8fa1d0ea98f869db02a894", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/a4681954cf1472940e8fa1d0ea98f869db02a894", "html_url": "https://github.com/Rust-GCC/gccrs/commit/a4681954cf1472940e8fa1d0ea98f869db02a894", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/a4681954cf1472940e8fa1d0ea98f869db02a894/comments", "author": null, "committer": {"login": "sebpop", "id": 568397, "node_id": "MDQ6VXNlcjU2ODM5Nw==", "avatar_url": "https://avatars.githubusercontent.com/u/568397?v=4", "gravatar_id": "", "url": "https://api.github.com/users/sebpop", "html_url": "https://github.com/sebpop", "followers_url": "https://api.github.com/users/sebpop/followers", "following_url": "https://api.github.com/users/sebpop/following{/other_user}", "gists_url": "https://api.github.com/users/sebpop/gists{/gist_id}", "starred_url": "https://api.github.com/users/sebpop/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/sebpop/subscriptions", "organizations_url": "https://api.github.com/users/sebpop/orgs", "repos_url": "https://api.github.com/users/sebpop/repos", "events_url": "https://api.github.com/users/sebpop/events{/privacy}", "received_events_url": "https://api.github.com/users/sebpop/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "a1954f72c64181e9cd63945c12776e168f166bc3", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/a1954f72c64181e9cd63945c12776e168f166bc3", "html_url": "https://github.com/Rust-GCC/gccrs/commit/a1954f72c64181e9cd63945c12776e168f166bc3"}], "stats": {"total": 92, "additions": 86, "deletions": 6}, "files": [{"sha": "d7eb169c81c91b75ab6ddef8124a5cd356e44546", "filename": "gcc/ChangeLog.graphite", "status": "modified", "additions": 10, "deletions": 0, "changes": 10, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/a4681954cf1472940e8fa1d0ea98f869db02a894/gcc%2FChangeLog.graphite", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/a4681954cf1472940e8fa1d0ea98f869db02a894/gcc%2FChangeLog.graphite", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2FChangeLog.graphite?ref=a4681954cf1472940e8fa1d0ea98f869db02a894", "patch": "@@ -1,3 +1,13 @@\n+2010-02-10  Sebastian Pop  <seb@napoca>\n+\n+\tPR middle-end/42914\n+\tPR middle-end/42530\n+\t* graphite-sese-to-poly.c (remove_phi): New.\n+\t(translate_scalar_reduction_to_array): Call remove_phi.\n+\n+\t* gcc.dg/graphite/pr42530.c: New.\n+\t* gcc.dg/graphite/pr42914.c: New.\n+\n 2010-02-10  Sebastian Pop  <seb@napoca>\n \n \tPR middle-end/42771"}, {"sha": "d4889b044d629935e0e63e61a44b5ece48519055", "filename": "gcc/graphite-sese-to-poly.c", "status": "modified", "additions": 37, "deletions": 6, "changes": 43, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/a4681954cf1472940e8fa1d0ea98f869db02a894/gcc%2Fgraphite-sese-to-poly.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/a4681954cf1472940e8fa1d0ea98f869db02a894/gcc%2Fgraphite-sese-to-poly.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fgraphite-sese-to-poly.c?ref=a4681954cf1472940e8fa1d0ea98f869db02a894", "patch": "@@ -2719,6 +2719,41 @@ insert_copyin (tree red, gimple loop_phi)\n   gsi_insert_seq_on_edge (edge_initial_value_for_loop_phi (loop_phi), stmts);\n }\n \n+/* Removes the PHI node and resets all the debug stmts that are using\n+   the PHI_RESULT.  */\n+\n+static void\n+remove_phi (gimple phi)\n+{\n+  imm_use_iterator imm_iter;\n+  tree def;\n+  use_operand_p use_p;\n+  gimple_stmt_iterator gsi;\n+  VEC (gimple, heap) *update = VEC_alloc (gimple, heap, 3);\n+  unsigned int i;\n+  gimple stmt;\n+\n+  def = PHI_RESULT (phi);\n+  FOR_EACH_IMM_USE_FAST (use_p, imm_iter, def)\n+    {\n+      stmt = USE_STMT (use_p);\n+\n+      if (is_gimple_debug (stmt))\n+\t{\n+\t  gimple_debug_bind_reset_value (stmt);\n+\t  VEC_safe_push (gimple, heap, update, stmt);\n+\t}\n+    }\n+\n+  for (i = 0; VEC_iterate (gimple, update, i, stmt); i++)\n+    update_stmt (stmt);\n+\n+  VEC_free (gimple, heap, update);\n+\n+  gsi = gsi_for_phi_node (phi);\n+  remove_phi_node (&gsi, false);\n+}\n+\n /* Rewrite out of SSA the reduction described by the loop phi nodes\n    IN, and the close phi nodes OUT.  IN and OUT are structured by loop\n    levels like this:\n@@ -2737,7 +2772,6 @@ translate_scalar_reduction_to_array (VEC (gimple, heap) *in,\n   unsigned int i;\n   gimple loop_phi;\n   tree red;\n-  gimple_stmt_iterator gsi;\n \n   for (i = 0; VEC_iterate (gimple, in, i, loop_phi); i++)\n     {\n@@ -2764,11 +2798,8 @@ translate_scalar_reduction_to_array (VEC (gimple, heap) *in,\n \t  insert_copyin (red, loop_phi);\n \t}\n \n-      gsi = gsi_for_phi_node (loop_phi);\n-      remove_phi_node (&gsi, false);\n-\n-      gsi = gsi_for_phi_node (close_phi);\n-      remove_phi_node (&gsi, false);\n+      remove_phi (loop_phi);\n+      remove_phi (close_phi);\n     }\n }\n "}, {"sha": "c0fa299ce9729a0f41c2dc7ebda9e29c38dab6df", "filename": "gcc/testsuite/gcc.dg/graphite/pr42530.c", "status": "added", "additions": 18, "deletions": 0, "changes": 18, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/a4681954cf1472940e8fa1d0ea98f869db02a894/gcc%2Ftestsuite%2Fgcc.dg%2Fgraphite%2Fpr42530.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/a4681954cf1472940e8fa1d0ea98f869db02a894/gcc%2Ftestsuite%2Fgcc.dg%2Fgraphite%2Fpr42530.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgcc.dg%2Fgraphite%2Fpr42530.c?ref=a4681954cf1472940e8fa1d0ea98f869db02a894", "patch": "@@ -0,0 +1,18 @@\n+/* { dg-options \"-O2 -g -ffast-math -floop-parallelize-all\" } */\n+\n+int array[2][2];\n+\n+void foo(int *a)\n+{\n+  int i, j;\n+  int sum, tmp = 0;\n+\n+  for (i=0; i<2; i++)\n+    for (j=0; j<2; j++)\n+      sum += array[i][j];\n+\n+  if (sum > 0) {\n+    tmp = sum;\n+    *a = tmp;\n+  }\n+}"}, {"sha": "606ee0871f4604b8f3043bfbd8e471951419c3ca", "filename": "gcc/testsuite/gcc.dg/graphite/pr42914.c", "status": "added", "additions": 21, "deletions": 0, "changes": 21, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/a4681954cf1472940e8fa1d0ea98f869db02a894/gcc%2Ftestsuite%2Fgcc.dg%2Fgraphite%2Fpr42914.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/a4681954cf1472940e8fa1d0ea98f869db02a894/gcc%2Ftestsuite%2Fgcc.dg%2Fgraphite%2Fpr42914.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgcc.dg%2Fgraphite%2Fpr42914.c?ref=a4681954cf1472940e8fa1d0ea98f869db02a894", "patch": "@@ -0,0 +1,21 @@\n+/* { dg-options \"-O2 -g -ffast-math -fgraphite-identity\" } */\n+\n+int find_sad_16x16(int *mode)\n+{\n+  int current, best;\n+  int M1[16][16],M0[4][4][4][4],M3[4],M4[4][4];\n+  int i,j,k;\n+  int ii,jj;\n+\n+  for (jj=0;jj<4;jj++)\n+    for (ii=0;ii<4;ii++)\n+      for (j=0;j<4;j++)\n+\tfor (j=0;j<4;j++)\n+\t  current += abs(M0[i][ii][j][jj]);\n+\n+  if(current < best)\n+    {\n+      best = current;\n+      *mode = k;\n+    }\n+}"}]}