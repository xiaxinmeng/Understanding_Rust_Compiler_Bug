{"sha": "ffb9d1b140d2bd299642c001c1a79de4c2c81871", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6ZmZiOWQxYjE0MGQyYmQyOTk2NDJjMDAxYzFhNzlkZTRjMmM4MTg3MQ==", "commit": {"author": {"name": "Jan Hubicka", "email": "hubicka@ucw.cz", "date": "2017-06-09T11:38:35Z"}, "committer": {"name": "Jan Hubicka", "email": "hubicka@gcc.gnu.org", "date": "2017-06-09T11:38:35Z"}, "message": "profile.c (edge_gcov_counts): Turn to pointer.\n\n\t* profile.c (edge_gcov_counts): Turn to pointer.\n\t(compute_branch_probabilities, compute_branch_probabilities): Update.\n\t* profile.h (edge_gcov_counts): Turn to pointer.\n\t(edge_gcov_count): Update.\n\nFrom-SVN: r249056", "tree": {"sha": "886859fb9516d906dca0fefdd5ab571bbc8f687a", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/886859fb9516d906dca0fefdd5ab571bbc8f687a"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/ffb9d1b140d2bd299642c001c1a79de4c2c81871", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/ffb9d1b140d2bd299642c001c1a79de4c2c81871", "html_url": "https://github.com/Rust-GCC/gccrs/commit/ffb9d1b140d2bd299642c001c1a79de4c2c81871", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/ffb9d1b140d2bd299642c001c1a79de4c2c81871/comments", "author": null, "committer": null, "parents": [{"sha": "323eb0898cb8d1869ae5354b36f390940d29f7d1", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/323eb0898cb8d1869ae5354b36f390940d29f7d1", "html_url": "https://github.com/Rust-GCC/gccrs/commit/323eb0898cb8d1869ae5354b36f390940d29f7d1"}], "stats": {"total": 17, "additions": 13, "deletions": 4}, "files": [{"sha": "73bf358ec5799e4324fbd052442a3321d220d469", "filename": "gcc/ChangeLog", "status": "modified", "additions": 7, "deletions": 0, "changes": 7, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/ffb9d1b140d2bd299642c001c1a79de4c2c81871/gcc%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/ffb9d1b140d2bd299642c001c1a79de4c2c81871/gcc%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2FChangeLog?ref=ffb9d1b140d2bd299642c001c1a79de4c2c81871", "patch": "@@ -1,3 +1,10 @@\n+2017-06-09  Jan Hubicka  <hubicka@ucw.cz>\n+\n+\t* profile.c (edge_gcov_counts): Turn to pointer.\n+\t(compute_branch_probabilities, compute_branch_probabilities): Update.\n+\t* profile.h (edge_gcov_counts): Turn to pointer.\n+\t(edge_gcov_count): Update.\n+\n 2017-06-09  Jan Hubicka  <hubicka@ucw.cz>\n \n \t* gimple.h (gimple_check_failed): Mark cold."}, {"sha": "d6f2084a47d3e2cf249cac7e979fd27534c5c62f", "filename": "gcc/profile.c", "status": "modified", "additions": 4, "deletions": 2, "changes": 6, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/ffb9d1b140d2bd299642c001c1a79de4c2c81871/gcc%2Fprofile.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/ffb9d1b140d2bd299642c001c1a79de4c2c81871/gcc%2Fprofile.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fprofile.c?ref=ffb9d1b140d2bd299642c001c1a79de4c2c81871", "patch": "@@ -69,7 +69,7 @@ along with GCC; see the file COPYING3.  If not see\n \n /* Map from BBs/edges to gcov counters.  */\n vec<gcov_type> bb_gcov_counts;\n-hash_map<edge,gcov_type> edge_gcov_counts;\n+hash_map<edge,gcov_type> *edge_gcov_counts;\n \n struct bb_profile_info {\n   unsigned int count_valid : 1;\n@@ -532,6 +532,7 @@ compute_branch_probabilities (unsigned cfg_checksum, unsigned lineno_checksum)\n     return;\n \n   bb_gcov_counts.safe_grow_cleared (last_basic_block_for_fn (cfun));\n+  edge_gcov_counts = new hash_map<edge,gcov_type>;\n \n   if (profile_info->sum_all < profile_info->sum_max)\n     {\n@@ -836,7 +837,8 @@ compute_branch_probabilities (unsigned cfg_checksum, unsigned lineno_checksum)\n         e->count = profile_count::from_gcov_type (edge_gcov_count (e));\n     }\n   bb_gcov_counts.release ();\n-  edge_gcov_counts.empty ();\n+  delete edge_gcov_counts;\n+  edge_gcov_counts = NULL;\n \n   counts_to_freqs ();\n "}, {"sha": "4e3f482fa5afde61ebbf8587bd42755ea0f6f366", "filename": "gcc/profile.h", "status": "modified", "additions": 2, "deletions": 2, "changes": 4, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/ffb9d1b140d2bd299642c001c1a79de4c2c81871/gcc%2Fprofile.h", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/ffb9d1b140d2bd299642c001c1a79de4c2c81871/gcc%2Fprofile.h", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fprofile.h?ref=ffb9d1b140d2bd299642c001c1a79de4c2c81871", "patch": "@@ -40,13 +40,13 @@ struct edge_profile_info\n /* Helpers annotating edges/basic blocks to GCOV counts.  */\n \n extern vec<gcov_type> bb_gcov_counts;\n-extern hash_map<edge,gcov_type> edge_gcov_counts;\n+extern hash_map<edge,gcov_type> *edge_gcov_counts;\n \n inline gcov_type &\n edge_gcov_count (edge e)\n {\n   bool existed;\n-  gcov_type &c = edge_gcov_counts.get_or_insert (e, &existed);\n+  gcov_type &c = edge_gcov_counts->get_or_insert (e, &existed);\n   if (!existed)\n     c = 0;\n   return c;"}]}