{"sha": "a2754419d08d5a49551fb817a01067e81c3da3f4", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6YTI3NTQ0MTlkMDhkNWE0OTU1MWZiODE3YTAxMDY3ZTgxYzNkYTNmNA==", "commit": {"author": {"name": "Bob Duff", "email": "duff@adacore.com", "date": "2020-02-04T16:08:32Z"}, "committer": {"name": "Pierre-Marie de Rodat", "email": "derodat@adacore.com", "date": "2020-06-05T12:17:46Z"}, "message": "[Ada] Put_Image attribute: Rtsfind cleanups\n\n2020-06-05  Bob Duff  <duff@adacore.com>\n\ngcc/ada/\n\n\t* rtsfind.adb, rtsfind.ads: Move subtypes of RTU_Id into package\n\tbody, because they are not needed by clients. Change \"Child_\" to\n\t\"Descendant\", because grandchildren and great grandchildren are\n\tinvolved.  Replace all the repetitive comments with a single\n\tconcise one.  Change the parent subtypes to be more consistent;\n\tuse the most specific parent.", "tree": {"sha": "4b6a7931326c49972aa3b50c5bb309c55c9c209f", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/4b6a7931326c49972aa3b50c5bb309c55c9c209f"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/a2754419d08d5a49551fb817a01067e81c3da3f4", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/a2754419d08d5a49551fb817a01067e81c3da3f4", "html_url": "https://github.com/Rust-GCC/gccrs/commit/a2754419d08d5a49551fb817a01067e81c3da3f4", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/a2754419d08d5a49551fb817a01067e81c3da3f4/comments", "author": {"login": "bobduff", "id": 29099567, "node_id": "MDQ6VXNlcjI5MDk5NTY3", "avatar_url": "https://avatars.githubusercontent.com/u/29099567?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bobduff", "html_url": "https://github.com/bobduff", "followers_url": "https://api.github.com/users/bobduff/followers", "following_url": "https://api.github.com/users/bobduff/following{/other_user}", "gists_url": "https://api.github.com/users/bobduff/gists{/gist_id}", "starred_url": "https://api.github.com/users/bobduff/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bobduff/subscriptions", "organizations_url": "https://api.github.com/users/bobduff/orgs", "repos_url": "https://api.github.com/users/bobduff/repos", "events_url": "https://api.github.com/users/bobduff/events{/privacy}", "received_events_url": "https://api.github.com/users/bobduff/received_events", "type": "User", "site_admin": false}, "committer": {"login": "pmderodat", "id": 758452, "node_id": "MDQ6VXNlcjc1ODQ1Mg==", "avatar_url": "https://avatars.githubusercontent.com/u/758452?v=4", "gravatar_id": "", "url": "https://api.github.com/users/pmderodat", "html_url": "https://github.com/pmderodat", "followers_url": "https://api.github.com/users/pmderodat/followers", "following_url": "https://api.github.com/users/pmderodat/following{/other_user}", "gists_url": "https://api.github.com/users/pmderodat/gists{/gist_id}", "starred_url": "https://api.github.com/users/pmderodat/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/pmderodat/subscriptions", "organizations_url": "https://api.github.com/users/pmderodat/orgs", "repos_url": "https://api.github.com/users/pmderodat/repos", "events_url": "https://api.github.com/users/pmderodat/events{/privacy}", "received_events_url": "https://api.github.com/users/pmderodat/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "d1987ffdc27f0302dba0958083d69b7241194c1c", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/d1987ffdc27f0302dba0958083d69b7241194c1c", "html_url": "https://github.com/Rust-GCC/gccrs/commit/d1987ffdc27f0302dba0958083d69b7241194c1c"}], "stats": {"total": 226, "additions": 109, "deletions": 117}, "files": [{"sha": "d190115083afb29ccf39dcd8651a972c15de7492", "filename": "gcc/ada/rtsfind.adb", "status": "modified", "additions": 105, "deletions": 26, "changes": 131, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/a2754419d08d5a49551fb817a01067e81c3da3f4/gcc%2Fada%2Frtsfind.adb", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/a2754419d08d5a49551fb817a01067e81c3da3f4/gcc%2Fada%2Frtsfind.adb", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fada%2Frtsfind.adb?ref=a2754419d08d5a49551fb817a01067e81c3da3f4", "patch": "@@ -540,87 +540,166 @@ package body Rtsfind is\n    -- Get_Unit_Name --\n    -------------------\n \n+   --  The following subtypes include all the proper descendants of each unit\n+   --  that has such descendants. For example, Ada_Calendar_Descendant includes\n+   --  all the descendents of Ada.Calendar (except Ada.Calendar itself). These\n+   --  are used by Get_Unit_Name to know where to change \"_\" to \".\", and by\n+   --  Is_Text_IO_Special_Package to detect the special generic pseudo-children\n+   --  of [[Wide_]Wide_]Text_IO.\n+\n+   subtype Ada_Descendant is RTU_Id\n+     range Ada_Calendar .. Ada_Wide_Wide_Text_IO_Modular_IO;\n+\n+   subtype Ada_Calendar_Descendant is Ada_Descendant\n+     range Ada_Calendar_Delays .. Ada_Calendar_Delays;\n+\n+   subtype Ada_Dispatching_Descendant is Ada_Descendant\n+     range Ada_Dispatching_EDF .. Ada_Dispatching_EDF;\n+\n+   subtype Ada_Interrupts_Descendant is Ada_Descendant range\n+     Ada_Interrupts_Names .. Ada_Interrupts_Names;\n+\n+   subtype Ada_Numerics_Descendant is Ada_Descendant\n+     range Ada_Numerics_Generic_Elementary_Functions ..\n+           Ada_Numerics_Generic_Elementary_Functions;\n+\n+   subtype Ada_Real_Time_Descendant is Ada_Descendant\n+     range Ada_Real_Time_Delays .. Ada_Real_Time_Timing_Events;\n+\n+   subtype Ada_Streams_Descendant is Ada_Descendant\n+     range Ada_Streams_Stream_IO .. Ada_Streams_Stream_IO;\n+\n+   subtype Ada_Strings_Descendant is Ada_Descendant\n+     range Ada_Strings_Superbounded .. Ada_Strings_Text_Output_Utils;\n+\n+   subtype Ada_Strings_Text_Output_Descendant is Ada_Strings_Descendant\n+     range Ada_Strings_Text_Output_Utils .. Ada_Strings_Text_Output_Utils;\n+\n+   subtype Ada_Text_IO_Descendant is Ada_Descendant\n+     range Ada_Text_IO_Decimal_IO .. Ada_Text_IO_Modular_IO;\n+\n+   subtype Ada_Wide_Text_IO_Descendant is Ada_Descendant\n+     range Ada_Wide_Text_IO_Decimal_IO .. Ada_Wide_Text_IO_Modular_IO;\n+\n+   subtype Ada_Wide_Wide_Text_IO_Descendant is Ada_Descendant\n+     range Ada_Wide_Wide_Text_IO_Decimal_IO ..\n+           Ada_Wide_Wide_Text_IO_Modular_IO;\n+\n+   subtype Interfaces_Descendant is RTU_Id\n+     range Interfaces_Packed_Decimal .. Interfaces_Packed_Decimal;\n+\n+   subtype System_Descendant is RTU_Id\n+     range System_Address_Image .. System_Tasking_Stages;\n+\n+   subtype System_Dim_Descendant is System_Descendant\n+     range System_Dim_Float_IO .. System_Dim_Integer_IO;\n+\n+   subtype System_Multiprocessors_Descendant is System_Descendant\n+     range System_Multiprocessors_Dispatching_Domains ..\n+       System_Multiprocessors_Dispatching_Domains;\n+\n+   subtype System_Storage_Pools_Descendant is System_Descendant\n+     range System_Storage_Pools_Subpools .. System_Storage_Pools_Subpools;\n+\n+   subtype System_Strings_Descendant is System_Descendant\n+     range System_Strings_Stream_Ops .. System_Strings_Stream_Ops;\n+\n+   subtype System_Tasking_Descendant is System_Descendant\n+     range System_Tasking_Async_Delays .. System_Tasking_Stages;\n+\n+   subtype System_Tasking_Protected_Objects_Descendant is\n+     System_Tasking_Descendant\n+     range System_Tasking_Protected_Objects_Entries ..\n+       System_Tasking_Protected_Objects_Single_Entry;\n+\n+   subtype System_Tasking_Restricted_Descendant is System_Tasking_Descendant\n+     range System_Tasking_Restricted_Stages ..\n+       System_Tasking_Restricted_Stages;\n+\n+   subtype System_Tasking_Async_Delays_Descendant is System_Tasking_Descendant\n+     range System_Tasking_Async_Delays_Enqueue_Calendar ..\n+       System_Tasking_Async_Delays_Enqueue_RT;\n+\n    function Get_Unit_Name (U_Id : RTU_Id) return Unit_Name_Type is\n       Uname_Chars : constant String := RTU_Id'Image (U_Id);\n-\n    begin\n       Name_Len := Uname_Chars'Length;\n       Name_Buffer (1 .. Name_Len) := Uname_Chars;\n       Set_Casing (All_Lower_Case);\n \n-      if U_Id in Ada_Child then\n+      if U_Id in Ada_Descendant then\n          Name_Buffer (4) := '.';\n \n-         if U_Id in Ada_Calendar_Child then\n+         if U_Id in Ada_Calendar_Descendant then\n             Name_Buffer (13) := '.';\n \n-         elsif U_Id in Ada_Dispatching_Child then\n+         elsif U_Id in Ada_Dispatching_Descendant then\n             Name_Buffer (16) := '.';\n \n-         elsif U_Id in Ada_Interrupts_Child then\n+         elsif U_Id in Ada_Interrupts_Descendant then\n             Name_Buffer (15) := '.';\n \n-         elsif U_Id in Ada_Numerics_Child then\n+         elsif U_Id in Ada_Numerics_Descendant then\n             Name_Buffer (13) := '.';\n \n-         elsif U_Id in Ada_Real_Time_Child then\n+         elsif U_Id in Ada_Real_Time_Descendant then\n             Name_Buffer (14) := '.';\n \n-         elsif U_Id in Ada_Streams_Child then\n+         elsif U_Id in Ada_Streams_Descendant then\n             Name_Buffer (12) := '.';\n \n-         elsif U_Id in Ada_Strings_Child then\n+         elsif U_Id in Ada_Strings_Descendant then\n             Name_Buffer (12) := '.';\n \n-            if U_Id in Ada_Strings_Text_Output_Child then\n+            if U_Id in Ada_Strings_Text_Output_Descendant then\n                Name_Buffer (24) := '.';\n             end if;\n \n-         elsif U_Id in Ada_Text_IO_Child then\n+         elsif U_Id in Ada_Text_IO_Descendant then\n             Name_Buffer (12) := '.';\n \n-         elsif U_Id in Ada_Wide_Text_IO_Child then\n+         elsif U_Id in Ada_Wide_Text_IO_Descendant then\n             Name_Buffer (17) := '.';\n \n-         elsif U_Id in Ada_Wide_Wide_Text_IO_Child then\n+         elsif U_Id in Ada_Wide_Wide_Text_IO_Descendant then\n             Name_Buffer (22) := '.';\n          end if;\n \n-      elsif U_Id in Interfaces_Child then\n+      elsif U_Id in Interfaces_Descendant then\n          Name_Buffer (11) := '.';\n \n-      elsif U_Id in System_Child then\n+      elsif U_Id in System_Descendant then\n          Name_Buffer (7) := '.';\n \n-         if U_Id in System_Dim_Child then\n+         if U_Id in System_Dim_Descendant then\n             Name_Buffer (11) := '.';\n          end if;\n \n-         if U_Id in System_Multiprocessors_Child then\n+         if U_Id in System_Multiprocessors_Descendant then\n             Name_Buffer (23) := '.';\n          end if;\n \n-         if U_Id in System_Storage_Pools_Child then\n+         if U_Id in System_Storage_Pools_Descendant then\n             Name_Buffer (21) := '.';\n          end if;\n \n-         if U_Id in System_Strings_Child then\n+         if U_Id in System_Strings_Descendant then\n             Name_Buffer (15) := '.';\n          end if;\n \n-         if U_Id in System_Tasking_Child then\n+         if U_Id in System_Tasking_Descendant then\n             Name_Buffer (15) := '.';\n          end if;\n \n-         if U_Id in System_Tasking_Restricted_Child then\n+         if U_Id in System_Tasking_Restricted_Descendant then\n             Name_Buffer (26) := '.';\n          end if;\n \n-         if U_Id in System_Tasking_Protected_Objects_Child then\n+         if U_Id in System_Tasking_Protected_Objects_Descendant then\n             Name_Buffer (33) := '.';\n          end if;\n \n-         if U_Id in System_Tasking_Async_Delays_Child then\n+         if U_Id in System_Tasking_Async_Delays_Descendant then\n             Name_Buffer (28) := '.';\n          end if;\n       end if;\n@@ -769,19 +848,19 @@ package body Rtsfind is\n \n       --  ??? detection with a scope climbing might be more efficient\n \n-      for U in Ada_Text_IO_Child loop\n+      for U in Ada_Text_IO_Descendant loop\n          if Is_RTU (E, U) then\n             return True;\n          end if;\n       end loop;\n \n-      for U in Ada_Wide_Text_IO_Child loop\n+      for U in Ada_Wide_Text_IO_Descendant loop\n          if Is_RTU (E, U) then\n             return True;\n          end if;\n       end loop;\n \n-      for U in Ada_Wide_Wide_Text_IO_Child loop\n+      for U in Ada_Wide_Wide_Text_IO_Descendant loop\n          if Is_RTU (E, U) then\n             return True;\n          end if;"}, {"sha": "5074e18983b14dd63b5e7216a88500b20dc62ef8", "filename": "gcc/ada/rtsfind.ads", "status": "modified", "additions": 4, "deletions": 91, "changes": 95, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/a2754419d08d5a49551fb817a01067e81c3da3f4/gcc%2Fada%2Frtsfind.ads", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/a2754419d08d5a49551fb817a01067e81c3da3f4/gcc%2Fada%2Frtsfind.ads", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fada%2Frtsfind.ads?ref=a2754419d08d5a49551fb817a01067e81c3da3f4", "patch": "@@ -59,6 +59,9 @@ package Rtsfind is\n    --  the compilation except in the presence of use clauses, which might\n    --  result in unexpected ambiguities.\n \n+   --  NOTE: If RTU_Id is modified, the subtypes of RTU_Id in the package body\n+   --  might need to be modified. See Get_Unit_Name.\n+\n    type RTU_Id is (\n \n       --  Runtime packages, for list of accessible entities in each package,\n@@ -380,97 +383,6 @@ package Rtsfind is\n       System_Tasking_Rendezvous,\n       System_Tasking_Stages);\n \n-   subtype Ada_Child is RTU_Id\n-     range Ada_Calendar .. Ada_Wide_Wide_Text_IO_Modular_IO;\n-   --  Range of values for children or grandchildren of Ada\n-\n-   subtype Ada_Calendar_Child is Ada_Child\n-     range Ada_Calendar_Delays .. Ada_Calendar_Delays;\n-   --  Range of values for children of Ada.Calendar\n-\n-   subtype Ada_Dispatching_Child is RTU_Id\n-     range Ada_Dispatching_EDF .. Ada_Dispatching_EDF;\n-   --  Range of values for children of Ada.Dispatching\n-\n-   subtype Ada_Interrupts_Child is Ada_Child range\n-     Ada_Interrupts_Names .. Ada_Interrupts_Names;\n-   --  Range of values for children of Ada.Interrupts\n-\n-   subtype Ada_Numerics_Child is Ada_Child\n-     range Ada_Numerics_Generic_Elementary_Functions ..\n-           Ada_Numerics_Generic_Elementary_Functions;\n-   --  Range of values for children of Ada.Numerics\n-\n-   subtype Ada_Real_Time_Child is Ada_Child\n-     range Ada_Real_Time_Delays .. Ada_Real_Time_Timing_Events;\n-   --  Range of values for children of Ada.Real_Time\n-\n-   subtype Ada_Streams_Child is Ada_Child\n-     range Ada_Streams_Stream_IO .. Ada_Streams_Stream_IO;\n-   --  Range of values for children of Ada.Streams\n-\n-   subtype Ada_Strings_Child is Ada_Child\n-     range Ada_Strings_Superbounded .. Ada_Strings_Text_Output_Utils;\n-   --  Range of values for children and grandchildren of Ada.Strings\n-\n-   subtype Ada_Strings_Text_Output_Child is Ada_Child\n-     range Ada_Strings_Text_Output_Utils .. Ada_Strings_Text_Output_Utils;\n-   --  Range of values for children of Ada.Strings.Text_Output\n-\n-   subtype Ada_Text_IO_Child is Ada_Child\n-     range Ada_Text_IO_Decimal_IO .. Ada_Text_IO_Modular_IO;\n-   --  Range of values for children of Ada.Text_IO\n-\n-   subtype Ada_Wide_Text_IO_Child is Ada_Child\n-     range Ada_Wide_Text_IO_Decimal_IO .. Ada_Wide_Text_IO_Modular_IO;\n-   --  Range of values for children of Ada.Text_IO\n-\n-   subtype Ada_Wide_Wide_Text_IO_Child is Ada_Child\n-     range Ada_Wide_Wide_Text_IO_Decimal_IO ..\n-           Ada_Wide_Wide_Text_IO_Modular_IO;\n-\n-   subtype Interfaces_Child is RTU_Id\n-     range Interfaces_Packed_Decimal .. Interfaces_Packed_Decimal;\n-   --  Range of values for children of Interfaces\n-\n-   subtype System_Child is RTU_Id\n-     range System_Address_Image .. System_Tasking_Stages;\n-   --  Range of values for children or grandchildren of System\n-\n-   subtype System_Dim_Child is RTU_Id\n-     range System_Dim_Float_IO .. System_Dim_Integer_IO;\n-   --  Range of values for children of System.Dim\n-\n-   subtype System_Multiprocessors_Child is RTU_Id\n-     range System_Multiprocessors_Dispatching_Domains ..\n-       System_Multiprocessors_Dispatching_Domains;\n-   --  Range of values for children of System.Multiprocessors\n-\n-   subtype System_Storage_Pools_Child is RTU_Id\n-     range System_Storage_Pools_Subpools .. System_Storage_Pools_Subpools;\n-\n-   subtype System_Strings_Child is RTU_Id\n-     range System_Strings_Stream_Ops .. System_Strings_Stream_Ops;\n-\n-   subtype System_Tasking_Child is System_Child\n-     range System_Tasking_Async_Delays .. System_Tasking_Stages;\n-   --  Range of values for children of System.Tasking\n-\n-   subtype System_Tasking_Protected_Objects_Child is System_Tasking_Child\n-     range System_Tasking_Protected_Objects_Entries ..\n-       System_Tasking_Protected_Objects_Single_Entry;\n-   --  Range of values for children of System.Tasking.Protected_Objects\n-\n-   subtype System_Tasking_Restricted_Child is System_Tasking_Child\n-     range System_Tasking_Restricted_Stages ..\n-       System_Tasking_Restricted_Stages;\n-   --  Range of values for children of System.Tasking.Restricted\n-\n-   subtype System_Tasking_Async_Delays_Child is System_Tasking_Child\n-     range System_Tasking_Async_Delays_Enqueue_Calendar ..\n-       System_Tasking_Async_Delays_Enqueue_RT;\n-   --  Range of values for children of System.Tasking.Async_Delays\n-\n    --------------------------\n    -- Runtime Entity Table --\n    --------------------------\n@@ -3193,6 +3105,7 @@ package Rtsfind is\n    --  Ada RM defines to be nested in Ada.Text_IO, but GNAT defines as its\n    --  private children. This is similar to Is_Text_IO_Special_Unit, but is\n    --  meant to be used on a fully resolved AST, especially in the backends.\n+   --  This is used by SPARK.\n \n    function RTE (E : RE_Id) return Entity_Id;\n    --  Given the entity defined in the above tables, as identified by the"}]}