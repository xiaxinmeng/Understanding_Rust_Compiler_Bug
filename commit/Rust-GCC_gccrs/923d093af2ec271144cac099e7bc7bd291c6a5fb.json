{"sha": "923d093af2ec271144cac099e7bc7bd291c6a5fb", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6OTIzZDA5M2FmMmVjMjcxMTQ0Y2FjMDk5ZTdiYzdiZDI5MWM2YTVmYg==", "commit": {"author": {"name": "Anthony Green", "email": "green@gcc.gnu.org", "date": "2014-12-24T13:20:37Z"}, "committer": {"name": "Anthony Green", "email": "green@gcc.gnu.org", "date": "2014-12-24T13:20:37Z"}, "message": "Add mul.x support for moxie\n\nFrom-SVN: r219056", "tree": {"sha": "c049d5c5ff340a6c0cedecb633cab30723db0204", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/c049d5c5ff340a6c0cedecb633cab30723db0204"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/923d093af2ec271144cac099e7bc7bd291c6a5fb", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/923d093af2ec271144cac099e7bc7bd291c6a5fb", "html_url": "https://github.com/Rust-GCC/gccrs/commit/923d093af2ec271144cac099e7bc7bd291c6a5fb", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/923d093af2ec271144cac099e7bc7bd291c6a5fb/comments", "author": null, "committer": null, "parents": [{"sha": "36e87c2340eeef6901d76b07cd8e4bcf013c67d9", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/36e87c2340eeef6901d76b07cd8e4bcf013c67d9", "html_url": "https://github.com/Rust-GCC/gccrs/commit/36e87c2340eeef6901d76b07cd8e4bcf013c67d9"}], "stats": {"total": 63, "additions": 53, "deletions": 10}, "files": [{"sha": "1165e9ab50ef685c85e20ac6a85fc123321f6d53", "filename": "gcc/config/moxie/moxie.c", "status": "modified", "additions": 5, "deletions": 2, "changes": 7, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/923d093af2ec271144cac099e7bc7bd291c6a5fb/gcc%2Fconfig%2Fmoxie%2Fmoxie.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/923d093af2ec271144cac099e7bc7bd291c6a5fb/gcc%2Fconfig%2Fmoxie%2Fmoxie.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fconfig%2Fmoxie%2Fmoxie.c?ref=923d093af2ec271144cac099e7bc7bd291c6a5fb", "patch": "@@ -249,13 +249,16 @@ moxie_init_machine_status (void)\n }\n \n \n-/* The TARGET_OPTION_OVERRIDE worker.\n-   All this curently does is set init_machine_status.  */\n+/* The TARGET_OPTION_OVERRIDE worker.  */\n static void\n moxie_option_override (void)\n {\n   /* Set the per-function-data initializer.  */\n   init_machine_status = moxie_init_machine_status;\n+\n+#ifdef TARGET_MOXIEBOX  \n+  target_flags &= ~MASK_HAS_MULX;\n+#endif\n }\n \n /* Compute the size of the local area and the size to be adjusted by the"}, {"sha": "fd8abc3469a277ef46c0147e2da1e6de20ce6509", "filename": "gcc/config/moxie/moxie.md", "status": "modified", "additions": 36, "deletions": 7, "changes": 43, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/923d093af2ec271144cac099e7bc7bd291c6a5fb/gcc%2Fconfig%2Fmoxie%2Fmoxie.md", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/923d093af2ec271144cac099e7bc7bd291c6a5fb/gcc%2Fconfig%2Fmoxie%2Fmoxie.md", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fconfig%2Fmoxie%2Fmoxie.md?ref=923d093af2ec271144cac099e7bc7bd291c6a5fb", "patch": "@@ -50,7 +50,7 @@\n   \"@\n   inc    %0, %2\n   dec\t %0, -%2\n-  add.l  %0, %2\")\n+  add    %0, %2\")\n \n (define_insn \"subsi3\"\n   [(set (match_operand:SI 0 \"register_operand\" \"=r,r\")\n@@ -60,47 +60,76 @@\n   \"\"\n   \"@\n   dec    %0, %2\n-  sub.l  %0, %2\")\n+  sub    %0, %2\")\n \n (define_insn \"mulsi3\"\n   [(set (match_operand:SI 0 \"register_operand\" \"=r\")\n \t  (mult:SI\n \t   (match_operand:SI 1 \"register_operand\" \"0\")\n \t   (match_operand:SI 2 \"register_operand\" \"r\")))]\n   \"\"\n-  \"mul.l  %0, %2\")\n+  \"mul    %0, %2\")\n+\n+(define_code_iterator EXTEND [sign_extend zero_extend])\n+(define_code_attr mul [(sign_extend \"mul\") (zero_extend \"umul\")])\n+\n+(define_insn \"<mul>si3_highpart\"\n+  [(set (match_operand:SI 0 \"register_operand\"                       \"=r\")\n+        (truncate:SI\n+         (lshiftrt:DI\n+          (mult:DI (EXTEND:DI (match_operand:SI 1 \"register_operand\"  \"0\"))\n+                   (EXTEND:DI (match_operand:SI 2 \"register_operand\"  \"r\")))\n+          (const_int 32))))]\n+  \"TARGET_HAS_MULX\"\n+  \"<mul>.x\\\\t%0, %2\")\n+\n+(define_expand \"<mul>sidi3\"\n+  [(set (match_operand:DI 0 \"register_operand\" \"\")\n+\t(mult:DI (EXTEND:DI (match_operand:SI 1 \"register_operand\" \"0\"))\n+\t\t (EXTEND:DI (match_operand:SI 2 \"register_operand\" \"r\"))))]\n+  \"TARGET_HAS_MULX\"\n+{\n+  rtx hi = gen_reg_rtx (SImode);\n+  rtx lo = gen_reg_rtx (SImode);\n+\n+  emit_insn (gen_<mul>si3_highpart (hi, operands[1], operands[2]));\n+  emit_insn (gen_mulsi3 (lo, operands[1], operands[2]));\n+  emit_move_insn (gen_lowpart (SImode, operands[0]), lo);\n+  emit_move_insn (gen_highpart (SImode, operands[0]), hi);\n+  DONE;\n+})\n \n (define_insn \"divsi3\"\n   [(set (match_operand:SI 0 \"register_operand\" \"=r\")\n \t  (div:SI\n \t   (match_operand:SI 1 \"register_operand\" \"0\")\n \t   (match_operand:SI 2 \"register_operand\" \"r\")))]\n   \"\"\n-  \"div.l  %0, %2\")\n+  \"div    %0, %2\")\n \n (define_insn \"udivsi3\"\n   [(set (match_operand:SI 0 \"register_operand\" \"=r\")\n \t  (udiv:SI\n \t   (match_operand:SI 1 \"register_operand\" \"0\")\n \t   (match_operand:SI 2 \"register_operand\" \"r\")))]\n   \"\"\n-  \"udiv.l %0, %2\")\n+  \"udiv   %0, %2\")\n \n (define_insn \"modsi3\"\n   [(set (match_operand:SI 0 \"register_operand\" \"=r\")\n \t  (mod:SI\n \t   (match_operand:SI 1 \"register_operand\" \"0\")\n \t   (match_operand:SI 2 \"register_operand\" \"r\")))]\n   \"\"\n-  \"mod.l  %0, %2\")\n+  \"mod    %0, %2\")\n \n (define_insn \"umodsi3\"\n   [(set (match_operand:SI 0 \"register_operand\" \"=r\")\n \t  (umod:SI\n \t   (match_operand:SI 1 \"register_operand\" \"0\")\n \t   (match_operand:SI 2 \"register_operand\" \"r\")))]\n   \"\"\n-  \"umod.l %0, %2\")\n+  \"umod   %0, %2\")\n \n ;; -------------------------------------------------------------------------\n ;; Unary arithmetic instructions"}, {"sha": "58eb88557b496f8ff1c61dc9c8b4534b0bbd548b", "filename": "gcc/config/moxie/moxie.opt", "status": "modified", "additions": 4, "deletions": 0, "changes": 4, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/923d093af2ec271144cac099e7bc7bd291c6a5fb/gcc%2Fconfig%2Fmoxie%2Fmoxie.opt", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/923d093af2ec271144cac099e7bc7bd291c6a5fb/gcc%2Fconfig%2Fmoxie%2Fmoxie.opt", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fconfig%2Fmoxie%2Fmoxie.opt?ref=923d093af2ec271144cac099e7bc7bd291c6a5fb", "patch": "@@ -26,6 +26,10 @@ mel\n Target RejectNegative Report Mask(LITTLE_ENDIAN)\n Generate little-endian code\n \n+mmul.x\n+Target Report Mask(HAS_MULX)\n+Enable MUL.X and UMUL.X instructions\n+\n ; Ignored by the compiler\n mno-crt0\n Target RejectNegative"}, {"sha": "2b4512c7351e0447a8d75acff07448423ac5151f", "filename": "gcc/config/moxie/moxiebox.h", "status": "modified", "additions": 2, "deletions": 0, "changes": 2, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/923d093af2ec271144cac099e7bc7bd291c6a5fb/gcc%2Fconfig%2Fmoxie%2Fmoxiebox.h", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/923d093af2ec271144cac099e7bc7bd291c6a5fb/gcc%2Fconfig%2Fmoxie%2Fmoxiebox.h", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fconfig%2Fmoxie%2Fmoxiebox.h?ref=923d093af2ec271144cac099e7bc7bd291c6a5fb", "patch": "@@ -45,3 +45,5 @@ along with GCC; see the file COPYING3.  If not see\n #undef PTRDIFF_TYPE\n #undef WCHAR_TYPE\n #undef WCHAR_TYPE_SIZE\n+\n+#define TARGET_MOXIEBOX"}, {"sha": "9b978ee8d51208ecb32280b4bdaf9785622ebb2b", "filename": "gcc/doc/invoke.texi", "status": "modified", "additions": 6, "deletions": 1, "changes": 7, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/923d093af2ec271144cac099e7bc7bd291c6a5fb/gcc%2Fdoc%2Finvoke.texi", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/923d093af2ec271144cac099e7bc7bd291c6a5fb/gcc%2Fdoc%2Finvoke.texi", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fdoc%2Finvoke.texi?ref=923d093af2ec271144cac099e7bc7bd291c6a5fb", "patch": "@@ -843,7 +843,7 @@ Objective-C and Objective-C++ Dialects}.\n -mno-crt0  -mrelax -mliw -msetlb}\n \n @emph{Moxie Options}\n-@gccoptlist{-meb -mel -mno-crt0}\n+@gccoptlist{-meb -mel -mmul.x -mno-crt0}\n \n @emph{MSP430 Options}\n @gccoptlist{-msim -masm-hex -mmcu= -mcpu= -mlarge -msmall -mrelax @gol\n@@ -18854,6 +18854,11 @@ configurations.\n @opindex mel\n Generate little-endian code.\n \n+@item -mmul.x\n+@opindex mmul.x\n+Generate mul.x and umul.x instructions.  This is the default for\n+@samp{moxiebox-*-*} configurations.\n+\n @item -mno-crt0\n @opindex mno-crt0\n Do not link in the C run-time initialization object file."}]}