{"sha": "1afa4facb9348cac0349ff9c30066aa25a3608f7", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6MWFmYTRmYWNiOTM0OGNhYzAzNDlmZjljMzAwNjZhYTI1YTM2MDhmNw==", "commit": {"author": {"name": "Marek Polacek", "email": "polacek@redhat.com", "date": "2021-06-07T20:06:00Z"}, "committer": {"name": "Marek Polacek", "email": "polacek@redhat.com", "date": "2021-06-08T22:29:32Z"}, "message": "c++: explicit() ignored on deduction guide [PR100065]\n\nWhen we have explicit() with a value-dependent argument, we can't\nevaluate it at parsing time, so cp_parser_function_specifier_opt stashes\nthe argument into the decl-specifiers and grokdeclarator then stores it\ninto explicit_specifier_map, which is then used when substituting the\nfunction decl.  grokdeclarator stores it for constructors and conversion\nfunctions, but we also need to do it for deduction guides, otherwise\nwe'll forget that we've seen an explicit-specifier as in the attached\ntest.\n\n\tPR c++/100065\n\ngcc/cp/ChangeLog:\n\n\t* decl.c (grokdeclarator): Store a value-dependent\n\texplicit-specifier even for deduction guides.\n\ngcc/testsuite/ChangeLog:\n\n\t* g++.dg/cpp2a/explicit18.C: New test.", "tree": {"sha": "49a1e1942da2b82988682d1c7bf823be5d311d21", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/49a1e1942da2b82988682d1c7bf823be5d311d21"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/1afa4facb9348cac0349ff9c30066aa25a3608f7", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/1afa4facb9348cac0349ff9c30066aa25a3608f7", "html_url": "https://github.com/Rust-GCC/gccrs/commit/1afa4facb9348cac0349ff9c30066aa25a3608f7", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/1afa4facb9348cac0349ff9c30066aa25a3608f7/comments", "author": {"login": "mpolacek", "id": 10496300, "node_id": "MDQ6VXNlcjEwNDk2MzAw", "avatar_url": "https://avatars.githubusercontent.com/u/10496300?v=4", "gravatar_id": "", "url": "https://api.github.com/users/mpolacek", "html_url": "https://github.com/mpolacek", "followers_url": "https://api.github.com/users/mpolacek/followers", "following_url": "https://api.github.com/users/mpolacek/following{/other_user}", "gists_url": "https://api.github.com/users/mpolacek/gists{/gist_id}", "starred_url": "https://api.github.com/users/mpolacek/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/mpolacek/subscriptions", "organizations_url": "https://api.github.com/users/mpolacek/orgs", "repos_url": "https://api.github.com/users/mpolacek/repos", "events_url": "https://api.github.com/users/mpolacek/events{/privacy}", "received_events_url": "https://api.github.com/users/mpolacek/received_events", "type": "User", "site_admin": false}, "committer": {"login": "mpolacek", "id": 10496300, "node_id": "MDQ6VXNlcjEwNDk2MzAw", "avatar_url": "https://avatars.githubusercontent.com/u/10496300?v=4", "gravatar_id": "", "url": "https://api.github.com/users/mpolacek", "html_url": "https://github.com/mpolacek", "followers_url": "https://api.github.com/users/mpolacek/followers", "following_url": "https://api.github.com/users/mpolacek/following{/other_user}", "gists_url": "https://api.github.com/users/mpolacek/gists{/gist_id}", "starred_url": "https://api.github.com/users/mpolacek/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/mpolacek/subscriptions", "organizations_url": "https://api.github.com/users/mpolacek/orgs", "repos_url": "https://api.github.com/users/mpolacek/repos", "events_url": "https://api.github.com/users/mpolacek/events{/privacy}", "received_events_url": "https://api.github.com/users/mpolacek/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "c4574d23cb07340918793a5a98ae7bb2988b3791", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/c4574d23cb07340918793a5a98ae7bb2988b3791", "html_url": "https://github.com/Rust-GCC/gccrs/commit/c4574d23cb07340918793a5a98ae7bb2988b3791"}], "stats": {"total": 25, "additions": 25, "deletions": 0}, "files": [{"sha": "cbf647dd5697a4705505fd3c0b595b8f55e3ef6e", "filename": "gcc/cp/decl.c", "status": "modified", "additions": 2, "deletions": 0, "changes": 2, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/1afa4facb9348cac0349ff9c30066aa25a3608f7/gcc%2Fcp%2Fdecl.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/1afa4facb9348cac0349ff9c30066aa25a3608f7/gcc%2Fcp%2Fdecl.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fcp%2Fdecl.c?ref=1afa4facb9348cac0349ff9c30066aa25a3608f7", "patch": "@@ -14043,6 +14043,8 @@ grokdeclarator (const cp_declarator *declarator,\n \t\tstorage_class = sc_none;\n \t      }\n \t  }\n+\tif (declspecs->explicit_specifier)\n+\t  store_explicit_specifier (decl, declspecs->explicit_specifier);\n       }\n     else\n       {"}, {"sha": "c8916fa4743b183618cd971d36b3175992554478", "filename": "gcc/testsuite/g++.dg/cpp2a/explicit18.C", "status": "added", "additions": 23, "deletions": 0, "changes": 23, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/1afa4facb9348cac0349ff9c30066aa25a3608f7/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Fcpp2a%2Fexplicit18.C", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/1afa4facb9348cac0349ff9c30066aa25a3608f7/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Fcpp2a%2Fexplicit18.C", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Fcpp2a%2Fexplicit18.C?ref=1afa4facb9348cac0349ff9c30066aa25a3608f7", "patch": "@@ -0,0 +1,23 @@\n+// PR c++/100065\n+// { dg-do compile { target c++20 } }\n+\n+template<bool B>\n+struct bool_constant {\n+  static constexpr bool value = B;\n+  constexpr operator bool() const { return value; }\n+};\n+\n+using true_type = bool_constant<true>;\n+using false_type = bool_constant<false>;\n+\n+template<bool>\n+struct X {\n+    template<typename T>\n+    X(T);\n+};\n+\n+template<bool b>\n+explicit(b) X(bool_constant<b>) -> X<b>;\n+\n+X false_ = false_type{}; // OK\n+X true_  = true_type{};  // { dg-error \"explicit deduction guide\" }"}]}