{"sha": "9c63ca5a1da8f003feff00d808d5d67931038d29", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6OWM2M2NhNWExZGE4ZjAwM2ZlZmYwMGQ4MDhkNWQ2NzkzMTAzOGQyOQ==", "commit": {"author": {"name": "Janus Weil", "email": "janus@gcc.gnu.org", "date": "2011-11-09T09:45:36Z"}, "committer": {"name": "Janus Weil", "email": "janus@gcc.gnu.org", "date": "2011-11-09T09:45:36Z"}, "message": "re PR fortran/50960 ([OOP] vtables not marked as constant)\n\n2011-11-09  Janus Weil  <janus@gcc.gnu.org>\n\n\tPR fortran/50960\n\t* class.c (gfc_find_derived_vtab): Make the vtab symbols FL_PARAMETER.\n\t* expr.c (gfc_simplify_expr): Prevent vtabs from being replaced with\n\ttheir value.\n\t* resolve.c (resolve_values): Use-associated symbols do not need to\n\tbe resolved again.\n\t(resolve_fl_parameter): Make sure the symbol has a value.\n\nFrom-SVN: r181199", "tree": {"sha": "fd0cad36550bc533efd5247a37f76d9bec96615d", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/fd0cad36550bc533efd5247a37f76d9bec96615d"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/9c63ca5a1da8f003feff00d808d5d67931038d29", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/9c63ca5a1da8f003feff00d808d5d67931038d29", "html_url": "https://github.com/Rust-GCC/gccrs/commit/9c63ca5a1da8f003feff00d808d5d67931038d29", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/9c63ca5a1da8f003feff00d808d5d67931038d29/comments", "author": {"login": "janusw", "id": 484108, "node_id": "MDQ6VXNlcjQ4NDEwOA==", "avatar_url": "https://avatars.githubusercontent.com/u/484108?v=4", "gravatar_id": "", "url": "https://api.github.com/users/janusw", "html_url": "https://github.com/janusw", "followers_url": "https://api.github.com/users/janusw/followers", "following_url": "https://api.github.com/users/janusw/following{/other_user}", "gists_url": "https://api.github.com/users/janusw/gists{/gist_id}", "starred_url": "https://api.github.com/users/janusw/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/janusw/subscriptions", "organizations_url": "https://api.github.com/users/janusw/orgs", "repos_url": "https://api.github.com/users/janusw/repos", "events_url": "https://api.github.com/users/janusw/events{/privacy}", "received_events_url": "https://api.github.com/users/janusw/received_events", "type": "User", "site_admin": false}, "committer": {"login": "janusw", "id": 484108, "node_id": "MDQ6VXNlcjQ4NDEwOA==", "avatar_url": "https://avatars.githubusercontent.com/u/484108?v=4", "gravatar_id": "", "url": "https://api.github.com/users/janusw", "html_url": "https://github.com/janusw", "followers_url": "https://api.github.com/users/janusw/followers", "following_url": "https://api.github.com/users/janusw/following{/other_user}", "gists_url": "https://api.github.com/users/janusw/gists{/gist_id}", "starred_url": "https://api.github.com/users/janusw/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/janusw/subscriptions", "organizations_url": "https://api.github.com/users/janusw/orgs", "repos_url": "https://api.github.com/users/janusw/repos", "events_url": "https://api.github.com/users/janusw/events{/privacy}", "received_events_url": "https://api.github.com/users/janusw/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "02c74373cf0a29074e52b42827622c8bbb0b716a", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/02c74373cf0a29074e52b42827622c8bbb0b716a", "html_url": "https://github.com/Rust-GCC/gccrs/commit/02c74373cf0a29074e52b42827622c8bbb0b716a"}], "stats": {"total": 19, "additions": 15, "deletions": 4}, "files": [{"sha": "4b65c73ea384991d7079d109320ddbe5d78e121a", "filename": "gcc/fortran/ChangeLog", "status": "modified", "additions": 10, "deletions": 0, "changes": 10, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/9c63ca5a1da8f003feff00d808d5d67931038d29/gcc%2Ffortran%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/9c63ca5a1da8f003feff00d808d5d67931038d29/gcc%2Ffortran%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ffortran%2FChangeLog?ref=9c63ca5a1da8f003feff00d808d5d67931038d29", "patch": "@@ -1,3 +1,13 @@\n+2011-11-09  Janus Weil  <janus@gcc.gnu.org>\n+\n+\tPR fortran/50960\n+\t* class.c (gfc_find_derived_vtab): Make the vtab symbols FL_PARAMETER.\n+\t* expr.c (gfc_simplify_expr): Prevent vtabs from being replaced with\n+\ttheir value.\n+\t* resolve.c (resolve_values): Use-associated symbols do not need to\n+\tbe resolved again.\n+\t(resolve_fl_parameter): Make sure the symbol has a value.\n+\n 2011-11-08  Francois-Xavier Coudert  <fxcoudert@gcc.gnu.org>\n \n \tPR fortran/38718"}, {"sha": "dc76ad158bb47ccc98bbc1bde0239eac93adc8a6", "filename": "gcc/fortran/class.c", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/9c63ca5a1da8f003feff00d808d5d67931038d29/gcc%2Ffortran%2Fclass.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/9c63ca5a1da8f003feff00d808d5d67931038d29/gcc%2Ffortran%2Fclass.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ffortran%2Fclass.c?ref=9c63ca5a1da8f003feff00d808d5d67931038d29", "patch": "@@ -428,7 +428,7 @@ gfc_find_derived_vtab (gfc_symbol *derived)\n \t{\n \t  gfc_get_symbol (name, ns, &vtab);\n \t  vtab->ts.type = BT_DERIVED;\n-\t  if (gfc_add_flavor (&vtab->attr, FL_VARIABLE, NULL,\n+\t  if (gfc_add_flavor (&vtab->attr, FL_PARAMETER, NULL,\n \t                      &gfc_current_locus) == FAILURE)\n \t    goto cleanup;\n \t  vtab->attr.target = 1;"}, {"sha": "8817c2ceba3fdc458582ed6f5b5d50ce04090d2a", "filename": "gcc/fortran/expr.c", "status": "modified", "additions": 2, "deletions": 1, "changes": 3, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/9c63ca5a1da8f003feff00d808d5d67931038d29/gcc%2Ffortran%2Fexpr.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/9c63ca5a1da8f003feff00d808d5d67931038d29/gcc%2Ffortran%2Fexpr.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ffortran%2Fexpr.c?ref=9c63ca5a1da8f003feff00d808d5d67931038d29", "patch": "@@ -1883,7 +1883,8 @@ gfc_simplify_expr (gfc_expr *p, int type)\n \t initialization expression, or we want a subsection.  */\n       if (p->symtree->n.sym->attr.flavor == FL_PARAMETER\n \t  && (gfc_init_expr_flag || p->ref\n-\t      || p->symtree->n.sym->value->expr_type != EXPR_ARRAY))\n+\t      || p->symtree->n.sym->value->expr_type != EXPR_ARRAY)\n+\t  && !p->symtree->n.sym->attr.vtab)\n \t{\n \t  if (simplify_parameter_variable (p, type) == FAILURE)\n \t    return FAILURE;"}, {"sha": "0a8fac614be15c616848a975b9519d41c904a283", "filename": "gcc/fortran/resolve.c", "status": "modified", "additions": 2, "deletions": 2, "changes": 4, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/9c63ca5a1da8f003feff00d808d5d67931038d29/gcc%2Ffortran%2Fresolve.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/9c63ca5a1da8f003feff00d808d5d67931038d29/gcc%2Ffortran%2Fresolve.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ffortran%2Fresolve.c?ref=9c63ca5a1da8f003feff00d808d5d67931038d29", "patch": "@@ -9514,7 +9514,7 @@ resolve_values (gfc_symbol *sym)\n {\n   gfc_try t;\n \n-  if (sym->value == NULL)\n+  if (sym->value == NULL || sym->attr.use_assoc)\n     return;\n \n   if (sym->value->expr_type == EXPR_STRUCTURE)\n@@ -11982,7 +11982,7 @@ resolve_fl_parameter (gfc_symbol *sym)\n   /* Make sure the types of derived parameters are consistent.  This\n      type checking is deferred until resolution because the type may\n      refer to a derived type from the host.  */\n-  if (sym->ts.type == BT_DERIVED\n+  if (sym->ts.type == BT_DERIVED && sym->value\n       && !gfc_compare_types (&sym->ts, &sym->value->ts))\n     {\n       gfc_error (\"Incompatible derived type in PARAMETER at %L\","}]}