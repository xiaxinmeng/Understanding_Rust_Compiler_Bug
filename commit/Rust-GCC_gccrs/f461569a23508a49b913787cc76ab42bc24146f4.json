{"sha": "f461569a23508a49b913787cc76ab42bc24146f4", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6ZjQ2MTU2OWEyMzUwOGE0OWI5MTM3ODdjYzc2YWI0MmJjMjQxNDZmNA==", "commit": {"author": {"name": "Marek Polacek", "email": "polacek@redhat.com", "date": "2015-06-29T14:17:13Z"}, "committer": {"name": "Marek Polacek", "email": "mpolacek@gcc.gnu.org", "date": "2015-06-29T14:17:13Z"}, "message": "fold-const.c (fold_binary_loc): Move X - (X / Y) * Y -> X % Y to ...\n\n\t* fold-const.c (fold_binary_loc): Move X - (X / Y) * Y -> X % Y to ...\n\t* match.pd: ... pattern here.\n\nCo-Authored-By: Marc Glisse <marc.glisse@inria.fr>\n\nFrom-SVN: r225120", "tree": {"sha": "455965b67ca0c58d772f8ae71e821ca9badb8147", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/455965b67ca0c58d772f8ae71e821ca9badb8147"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/f461569a23508a49b913787cc76ab42bc24146f4", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/f461569a23508a49b913787cc76ab42bc24146f4", "html_url": "https://github.com/Rust-GCC/gccrs/commit/f461569a23508a49b913787cc76ab42bc24146f4", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/f461569a23508a49b913787cc76ab42bc24146f4/comments", "author": {"login": "mpolacek", "id": 10496300, "node_id": "MDQ6VXNlcjEwNDk2MzAw", "avatar_url": "https://avatars.githubusercontent.com/u/10496300?v=4", "gravatar_id": "", "url": "https://api.github.com/users/mpolacek", "html_url": "https://github.com/mpolacek", "followers_url": "https://api.github.com/users/mpolacek/followers", "following_url": "https://api.github.com/users/mpolacek/following{/other_user}", "gists_url": "https://api.github.com/users/mpolacek/gists{/gist_id}", "starred_url": "https://api.github.com/users/mpolacek/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/mpolacek/subscriptions", "organizations_url": "https://api.github.com/users/mpolacek/orgs", "repos_url": "https://api.github.com/users/mpolacek/repos", "events_url": "https://api.github.com/users/mpolacek/events{/privacy}", "received_events_url": "https://api.github.com/users/mpolacek/received_events", "type": "User", "site_admin": false}, "committer": null, "parents": [{"sha": "fd7b3ef52aa44a4e6de739e63b2c6a34cc6b00bc", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/fd7b3ef52aa44a4e6de739e63b2c6a34cc6b00bc", "html_url": "https://github.com/Rust-GCC/gccrs/commit/fd7b3ef52aa44a4e6de739e63b2c6a34cc6b00bc"}], "stats": {"total": 25, "additions": 12, "deletions": 13}, "files": [{"sha": "3ce7acb0085c6a7bbb2bd10aaa497c0b69614723", "filename": "gcc/ChangeLog", "status": "modified", "additions": 6, "deletions": 0, "changes": 6, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/f461569a23508a49b913787cc76ab42bc24146f4/gcc%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/f461569a23508a49b913787cc76ab42bc24146f4/gcc%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2FChangeLog?ref=f461569a23508a49b913787cc76ab42bc24146f4", "patch": "@@ -1,3 +1,9 @@\n+2015-06-29  Marek Polacek  <polacek@redhat.com>\n+\t    Marc Glisse  <marc.glisse@inria.fr>\n+\n+\t* fold-const.c (fold_binary_loc): Move X - (X / Y) * Y -> X % Y to ...\n+\t* match.pd: ... pattern here.\n+\n 2015-06-29  Tom de Vries  <tom@codesourcery.com>\n \n \t* tree-parloops.c (try_transform_to_exit_first_loop_alt): Simplify"}, {"sha": "a447452193dbae7752de8448d51eb7aef8969f5b", "filename": "gcc/fold-const.c", "status": "modified", "additions": 0, "deletions": 13, "changes": 13, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/f461569a23508a49b913787cc76ab42bc24146f4/gcc%2Ffold-const.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/f461569a23508a49b913787cc76ab42bc24146f4/gcc%2Ffold-const.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ffold-const.c?ref=f461569a23508a49b913787cc76ab42bc24146f4", "patch": "@@ -10509,19 +10509,6 @@ fold_binary_loc (location_t loc,\n \t\t\t    fold_convert_loc (loc, type,\n \t\t\t\t\t      TREE_OPERAND (arg0, 0)));\n \n-      /* X - (X / Y) * Y is X % Y.  */\n-      if ((INTEGRAL_TYPE_P (type) || VECTOR_INTEGER_TYPE_P (type))\n-\t  && TREE_CODE (arg1) == MULT_EXPR\n-\t  && TREE_CODE (TREE_OPERAND (arg1, 0)) == TRUNC_DIV_EXPR\n-\t  && operand_equal_p (arg0,\n-\t\t\t      TREE_OPERAND (TREE_OPERAND (arg1, 0), 0), 0)\n-\t  && operand_equal_p (TREE_OPERAND (TREE_OPERAND (arg1, 0), 1),\n-\t\t\t      TREE_OPERAND (arg1, 1), 0))\n-\treturn\n-\t  fold_convert_loc (loc, type,\n-\t\t\t    fold_build2_loc (loc, TRUNC_MOD_EXPR, TREE_TYPE (arg0),\n-\t\t\t\t\t arg0, TREE_OPERAND (arg1, 1)));\n-\n       if (! FLOAT_TYPE_P (type))\n \t{\n \t  /* Fold A - (A & B) into ~B & A.  */"}, {"sha": "0cf3d21838953a2658416e83cf38035a64f0f35a", "filename": "gcc/match.pd", "status": "modified", "additions": 6, "deletions": 0, "changes": 6, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/f461569a23508a49b913787cc76ab42bc24146f4/gcc%2Fmatch.pd", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/f461569a23508a49b913787cc76ab42bc24146f4/gcc%2Fmatch.pd", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fmatch.pd?ref=f461569a23508a49b913787cc76ab42bc24146f4", "patch": "@@ -238,6 +238,12 @@ along with GCC; see the file COPYING3.  If not see\n       && tree_nop_conversion_p (type, TREE_TYPE (@1)))\n   (trunc_mod @0 (convert @1))))\n \n+/* X - (X / Y) * Y is the same as X % Y.  */\n+(simplify\n+ (minus (convert? @0) (convert? (mult (trunc_div @0 @1) @1)))\n+ (if (INTEGRAL_TYPE_P (type) || VECTOR_INTEGER_TYPE_P (type))\n+  (convert (trunc_mod @0 @1))))\n+\n /* Optimize TRUNC_MOD_EXPR by a power of two into a BIT_AND_EXPR,\n    i.e. \"X % C\" into \"X & (C - 1)\", if X and C are positive.\n    Also optimize A % (C << N)  where C is a power of 2,"}]}