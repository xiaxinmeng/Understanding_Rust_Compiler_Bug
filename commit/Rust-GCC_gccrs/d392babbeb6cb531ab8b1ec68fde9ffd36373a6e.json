{"sha": "d392babbeb6cb531ab8b1ec68fde9ffd36373a6e", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6ZDM5MmJhYmJlYjZjYjUzMWFiOGIxZWM2OGZkZTlmZmQzNjM3M2E2ZQ==", "commit": {"author": {"name": "Jonathan Wakely", "email": "jwakely@redhat.com", "date": "2020-06-17T19:26:13Z"}, "committer": {"name": "Jonathan Wakely", "email": "jwakely@redhat.com", "date": "2020-06-17T19:26:13Z"}, "message": "c++: Fix bogus \"does not declare anything\" warning (PR 66159)\n\nG++ gives a bogus warning for 'struct A; using B = struct ::A;'\ncomplaining that the elaborated-type-specifier doesn't declare anything.\nThat's true, but it's not trying to declare struct ::A, just refer to it\nunambiguously. Do not emit the warning unless we're actually parsing a\ndeclaration.\n\ngcc/cp/ChangeLog:\n\n\tPR c++/66159\n\t* parser.c (cp_parser_elaborated_type_specifier): Do not warn\n\tunless in a declaration.\n\ngcc/testsuite/ChangeLog:\n\n\tPR c++/66159\n\t* g++.dg/warn/forward-inner.C: Check alias-declaration using\n\telaborated-type-specifier.", "tree": {"sha": "0fb1a2e97e30225aa4f459becebb527897e80e2b", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/0fb1a2e97e30225aa4f459becebb527897e80e2b"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/d392babbeb6cb531ab8b1ec68fde9ffd36373a6e", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/d392babbeb6cb531ab8b1ec68fde9ffd36373a6e", "html_url": "https://github.com/Rust-GCC/gccrs/commit/d392babbeb6cb531ab8b1ec68fde9ffd36373a6e", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/d392babbeb6cb531ab8b1ec68fde9ffd36373a6e/comments", "author": {"login": "jwakely", "id": 1254480, "node_id": "MDQ6VXNlcjEyNTQ0ODA=", "avatar_url": "https://avatars.githubusercontent.com/u/1254480?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jwakely", "html_url": "https://github.com/jwakely", "followers_url": "https://api.github.com/users/jwakely/followers", "following_url": "https://api.github.com/users/jwakely/following{/other_user}", "gists_url": "https://api.github.com/users/jwakely/gists{/gist_id}", "starred_url": "https://api.github.com/users/jwakely/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jwakely/subscriptions", "organizations_url": "https://api.github.com/users/jwakely/orgs", "repos_url": "https://api.github.com/users/jwakely/repos", "events_url": "https://api.github.com/users/jwakely/events{/privacy}", "received_events_url": "https://api.github.com/users/jwakely/received_events", "type": "User", "site_admin": false}, "committer": {"login": "jwakely", "id": 1254480, "node_id": "MDQ6VXNlcjEyNTQ0ODA=", "avatar_url": "https://avatars.githubusercontent.com/u/1254480?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jwakely", "html_url": "https://github.com/jwakely", "followers_url": "https://api.github.com/users/jwakely/followers", "following_url": "https://api.github.com/users/jwakely/following{/other_user}", "gists_url": "https://api.github.com/users/jwakely/gists{/gist_id}", "starred_url": "https://api.github.com/users/jwakely/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jwakely/subscriptions", "organizations_url": "https://api.github.com/users/jwakely/orgs", "repos_url": "https://api.github.com/users/jwakely/repos", "events_url": "https://api.github.com/users/jwakely/events{/privacy}", "received_events_url": "https://api.github.com/users/jwakely/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "4a31a8add56d49867c187d90b3a89e97634543c2", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/4a31a8add56d49867c187d90b3a89e97634543c2", "html_url": "https://github.com/Rust-GCC/gccrs/commit/4a31a8add56d49867c187d90b3a89e97634543c2"}], "stats": {"total": 12, "additions": 10, "deletions": 2}, "files": [{"sha": "815582c825eeb8765c1abe0991d6af15a68df28c", "filename": "gcc/cp/parser.c", "status": "modified", "additions": 2, "deletions": 1, "changes": 3, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/d392babbeb6cb531ab8b1ec68fde9ffd36373a6e/gcc%2Fcp%2Fparser.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/d392babbeb6cb531ab8b1ec68fde9ffd36373a6e/gcc%2Fcp%2Fparser.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fcp%2Fparser.c?ref=d392babbeb6cb531ab8b1ec68fde9ffd36373a6e", "patch": "@@ -18953,7 +18953,8 @@ cp_parser_elaborated_type_specifier (cp_parser* parser,\n              here.  */\n \n           if (cp_lexer_next_token_is (parser->lexer, CPP_SEMICOLON)\n-              && !is_friend && !processing_explicit_instantiation)\n+\t      && !is_friend && is_declaration\n+\t      && !processing_explicit_instantiation)\n             warning (0, \"declaration %qD does not declare anything\", decl);\n \n \t  type = TREE_TYPE (decl);"}, {"sha": "d7b93f8ad0804930cea5493eb8296a046f8849af", "filename": "gcc/testsuite/g++.dg/warn/forward-inner.C", "status": "modified", "additions": 8, "deletions": 1, "changes": 9, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/d392babbeb6cb531ab8b1ec68fde9ffd36373a6e/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Fwarn%2Fforward-inner.C", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/d392babbeb6cb531ab8b1ec68fde9ffd36373a6e/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Fwarn%2Fforward-inner.C", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Fwarn%2Fforward-inner.C?ref=d392babbeb6cb531ab8b1ec68fde9ffd36373a6e", "patch": "@@ -70,7 +70,7 @@ template class TC6<int>::TC7;  // Valid explicit instantiation, no warning\n \n \n // Verify that friend declarations, also easy to confuse with forward\n-// declrations, are similarly not warned about.\n+// declarations, are similarly not warned about.\n class C8 {\n  public:\n   class C9 { };\n@@ -79,3 +79,10 @@ class C10 {\n  public:\n   friend class C8::C9;         // Valid friend declaration, no warning\n };\n+\n+#if __cplusplus >= 201103L\n+// Verify that alias-declarations using an elaborated-type-specifier and\n+// nested-name-specifier are not warned about (PR c++/66159).\n+struct C11;\n+using A1 = struct ::C11; // Valid alias-decl, no warning\n+#endif"}]}