{"sha": "887ab4e55402409cd7b56ad518607d05687b7ed2", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6ODg3YWI0ZTU1NDAyNDA5Y2Q3YjU2YWQ1MTg2MDdkMDU2ODdiN2VkMg==", "commit": {"author": {"name": "Patrick Palka", "email": "ppalka@gcc.gnu.org", "date": "2016-03-24T15:59:53Z"}, "committer": {"name": "Patrick Palka", "email": "ppalka@gcc.gnu.org", "date": "2016-03-24T15:59:53Z"}, "message": "Fix PR c++/62212 (ICE during mangling of array type)\n\ngcc/cp/ChangeLog:\n\n\tPR c++/62212\n\t* tree.c (build_cplus_array_type): Determine type-dependentess\n\twith uses_template_parms instead of with dependent_type_p.\n\ngcc/testsuite/ChangeLog:\n\n\tPR c++/62212\n\t* g++.dg/template/mangle2.C: New test.\n\nFrom-SVN: r234457", "tree": {"sha": "e4e7977b4192f70da34b123ba7285848271f4783", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/e4e7977b4192f70da34b123ba7285848271f4783"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/887ab4e55402409cd7b56ad518607d05687b7ed2", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/887ab4e55402409cd7b56ad518607d05687b7ed2", "html_url": "https://github.com/Rust-GCC/gccrs/commit/887ab4e55402409cd7b56ad518607d05687b7ed2", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/887ab4e55402409cd7b56ad518607d05687b7ed2/comments", "author": null, "committer": null, "parents": [{"sha": "fc3fb4bad52a2185acb11a3c17aead7d63719954", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/fc3fb4bad52a2185acb11a3c17aead7d63719954", "html_url": "https://github.com/Rust-GCC/gccrs/commit/fc3fb4bad52a2185acb11a3c17aead7d63719954"}], "stats": {"total": 35, "additions": 32, "deletions": 3}, "files": [{"sha": "dbef1b206f28b734707af1344a528afd906b4731", "filename": "gcc/cp/ChangeLog", "status": "modified", "additions": 6, "deletions": 0, "changes": 6, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/887ab4e55402409cd7b56ad518607d05687b7ed2/gcc%2Fcp%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/887ab4e55402409cd7b56ad518607d05687b7ed2/gcc%2Fcp%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fcp%2FChangeLog?ref=887ab4e55402409cd7b56ad518607d05687b7ed2", "patch": "@@ -1,3 +1,9 @@\n+2016-03-24  Patrick Palka  <ppalka@gcc.gnu.org>\n+\n+\tPR c++/62212\n+\t* tree.c (build_cplus_array_type): Determine type-dependentess\n+\twith uses_template_parms instead of with dependent_type_p.\n+\n 2016-03-23  Patrick Palka  <ppalka@gcc.gnu.org>\n \n \tPR c++/70347"}, {"sha": "5d9de344e7c8a5fa4980ea0c437674395aaea99c", "filename": "gcc/cp/tree.c", "status": "modified", "additions": 2, "deletions": 3, "changes": 5, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/887ab4e55402409cd7b56ad518607d05687b7ed2/gcc%2Fcp%2Ftree.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/887ab4e55402409cd7b56ad518607d05687b7ed2/gcc%2Fcp%2Ftree.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fcp%2Ftree.c?ref=887ab4e55402409cd7b56ad518607d05687b7ed2", "patch": "@@ -824,9 +824,8 @@ build_cplus_array_type (tree elt_type, tree index_type)\n   if (elt_type == error_mark_node || index_type == error_mark_node)\n     return error_mark_node;\n \n-  bool dependent = (processing_template_decl\n-\t\t    && (dependent_type_p (elt_type)\n-\t\t\t|| (index_type && dependent_type_p (index_type))));\n+  bool dependent = (uses_template_parms (elt_type)\n+\t\t    || (index_type && uses_template_parms (index_type)));\n \n   if (elt_type != TYPE_MAIN_VARIANT (elt_type))\n     /* Start with an array of the TYPE_MAIN_VARIANT.  */"}, {"sha": "582bb8bcad06dc0ea67c99b1eb5d3a94642e0fef", "filename": "gcc/testsuite/ChangeLog", "status": "modified", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/887ab4e55402409cd7b56ad518607d05687b7ed2/gcc%2Ftestsuite%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/887ab4e55402409cd7b56ad518607d05687b7ed2/gcc%2Ftestsuite%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2FChangeLog?ref=887ab4e55402409cd7b56ad518607d05687b7ed2", "patch": "@@ -1,3 +1,8 @@\n+2016-03-24  Patrick Palka  <ppalka@gcc.gnu.org>\n+\n+\tPR c++/62212\n+\t* g++.dg/template/mangle2.C: New test.\n+\n 2016-03-24  Richard Biener  <rguenther@suse.de>\n \n \tPR tree-optimization/70396"}, {"sha": "50b0d9fb7daf138282dec0664335bc856299ec70", "filename": "gcc/testsuite/g++.dg/template/mangle2.C", "status": "added", "additions": 19, "deletions": 0, "changes": 19, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/887ab4e55402409cd7b56ad518607d05687b7ed2/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Ftemplate%2Fmangle2.C", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/887ab4e55402409cd7b56ad518607d05687b7ed2/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Ftemplate%2Fmangle2.C", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Ftemplate%2Fmangle2.C?ref=887ab4e55402409cd7b56ad518607d05687b7ed2", "patch": "@@ -0,0 +1,19 @@\n+// PR c++/62212\n+// { dg-do assemble }\n+\n+typedef int my_int;\n+\n+template<typename T>\n+struct X {\n+    enum {value = 1};\n+};\n+\n+template<typename T>\n+void f(const my_int(&)[X<T>::value]);\n+\n+int main() {\n+    const my_int a[1] = {};\n+    f<void>(a);\n+}\n+\n+// { dg-final { scan-assembler \"_Z1fIvEvRAsr1XIT_E5value_Ki\" } }"}]}