{"sha": "3a54c4564436e79b70b8dd3b6651b7a2fbaea028", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6M2E1NGM0NTY0NDM2ZTc5YjcwYjhkZDNiNjY1MWI3YTJmYmFlYTAyOA==", "commit": {"author": {"name": "Aldy Hernandez", "email": "aldyh@redhat.com", "date": "2012-01-04T14:32:54Z"}, "committer": {"name": "Aldy Hernandez", "email": "aldyh@gcc.gnu.org", "date": "2012-01-04T14:32:54Z"}, "message": "re PR middle-end/51696 ([trans-mem] unsafe indirect function call in struct not properly displayed)\n\n        PR middle-end/51696\n        * trans-mem.c (diagnose_tm_1): Display indirect calls with no name\n        correctly.\n\nFrom-SVN: r182876", "tree": {"sha": "d76d4e9878a22fccb8ef2ffc332071f5ac6e5712", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/d76d4e9878a22fccb8ef2ffc332071f5ac6e5712"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/3a54c4564436e79b70b8dd3b6651b7a2fbaea028", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/3a54c4564436e79b70b8dd3b6651b7a2fbaea028", "html_url": "https://github.com/Rust-GCC/gccrs/commit/3a54c4564436e79b70b8dd3b6651b7a2fbaea028", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/3a54c4564436e79b70b8dd3b6651b7a2fbaea028/comments", "author": {"login": "aldyh", "id": 12937877, "node_id": "MDQ6VXNlcjEyOTM3ODc3", "avatar_url": "https://avatars.githubusercontent.com/u/12937877?v=4", "gravatar_id": "", "url": "https://api.github.com/users/aldyh", "html_url": "https://github.com/aldyh", "followers_url": "https://api.github.com/users/aldyh/followers", "following_url": "https://api.github.com/users/aldyh/following{/other_user}", "gists_url": "https://api.github.com/users/aldyh/gists{/gist_id}", "starred_url": "https://api.github.com/users/aldyh/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/aldyh/subscriptions", "organizations_url": "https://api.github.com/users/aldyh/orgs", "repos_url": "https://api.github.com/users/aldyh/repos", "events_url": "https://api.github.com/users/aldyh/events{/privacy}", "received_events_url": "https://api.github.com/users/aldyh/received_events", "type": "User", "site_admin": false}, "committer": null, "parents": [{"sha": "17d038cd90a83ba09162aae38394c201a98d3a00", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/17d038cd90a83ba09162aae38394c201a98d3a00", "html_url": "https://github.com/Rust-GCC/gccrs/commit/17d038cd90a83ba09162aae38394c201a98d3a00"}], "stats": {"total": 46, "additions": 40, "deletions": 6}, "files": [{"sha": "fc64456497162bd042a25363de1833fee7a51ef8", "filename": "gcc/ChangeLog", "status": "modified", "additions": 6, "deletions": 0, "changes": 6, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/3a54c4564436e79b70b8dd3b6651b7a2fbaea028/gcc%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/3a54c4564436e79b70b8dd3b6651b7a2fbaea028/gcc%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2FChangeLog?ref=3a54c4564436e79b70b8dd3b6651b7a2fbaea028", "patch": "@@ -1,3 +1,9 @@\n+2012-01-04  Aldy Hernandez  <aldyh@redhat.com>\n+\n+\tPR middle-end/51696\n+\t* trans-mem.c (diagnose_tm_1): Display indirect calls with no name\n+\tcorrectly.\n+\n 2012-01-04  Richard Guenther  <rguenther@suse.de>\n \n \tPR middle-end/51750"}, {"sha": "02ee3f517c002283d3266525d78a61e1076804c1", "filename": "gcc/testsuite/gcc.dg/tm/pr51696.c", "status": "added", "additions": 14, "deletions": 0, "changes": 14, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/3a54c4564436e79b70b8dd3b6651b7a2fbaea028/gcc%2Ftestsuite%2Fgcc.dg%2Ftm%2Fpr51696.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/3a54c4564436e79b70b8dd3b6651b7a2fbaea028/gcc%2Ftestsuite%2Fgcc.dg%2Ftm%2Fpr51696.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgcc.dg%2Ftm%2Fpr51696.c?ref=3a54c4564436e79b70b8dd3b6651b7a2fbaea028", "patch": "@@ -0,0 +1,14 @@\n+/* { dg-do compile } */\n+/* { dg-options \"-fgnu-tm\" } */\n+\n+struct list {\n+  void (*compare)();\n+} *listPtr;\n+\n+static void (*compare)();\n+\n+__attribute__((transaction_safe))\n+static void func () {\n+  listPtr->compare(); /* { dg-error \"unsafe indirect function call\" } */\n+  compare(); /* { dg-error \"unsafe function call\" } */\n+}"}, {"sha": "750f3a186241a355f04684705a57a4d8af954edd", "filename": "gcc/trans-mem.c", "status": "modified", "additions": 20, "deletions": 6, "changes": 26, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/3a54c4564436e79b70b8dd3b6651b7a2fbaea028/gcc%2Ftrans-mem.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/3a54c4564436e79b70b8dd3b6651b7a2fbaea028/gcc%2Ftrans-mem.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftrans-mem.c?ref=3a54c4564436e79b70b8dd3b6651b7a2fbaea028", "patch": "@@ -664,9 +664,16 @@ diagnose_tm_1 (gimple_stmt_iterator *gsi, bool *handled_ops_p,\n \t\t\t\t\"unsafe function call %qD within \"\n \t\t\t\t\"atomic transaction\", fn);\n \t\t    else\n-\t\t      error_at (gimple_location (stmt),\n-\t\t\t\t\"unsafe function call %qE within \"\n-\t\t\t\t\"atomic transaction\", fn);\n+\t\t      {\n+\t\t\tif (!DECL_P (fn) || DECL_NAME (fn))\n+\t\t\t  error_at (gimple_location (stmt),\n+\t\t\t\t    \"unsafe function call %qE within \"\n+\t\t\t\t    \"atomic transaction\", fn);\n+\t\t\telse\n+\t\t\t  error_at (gimple_location (stmt),\n+\t\t\t\t    \"unsafe indirect function call within \"\n+\t\t\t\t    \"atomic transaction\");\n+\t\t      }\n \t\t  }\n \t\telse\n \t\t  {\n@@ -675,9 +682,16 @@ diagnose_tm_1 (gimple_stmt_iterator *gsi, bool *handled_ops_p,\n \t\t\t\t\"unsafe function call %qD within \"\n \t\t\t\t\"%<transaction_safe%> function\", fn);\n \t\t    else\n-\t\t      error_at (gimple_location (stmt),\n-\t\t\t\t\"unsafe function call %qE within \"\n-\t\t\t\t\"%<transaction_safe%> function\", fn);\n+\t\t      {\n+\t\t\tif (!DECL_P (fn) || DECL_NAME (fn))\n+\t\t\t  error_at (gimple_location (stmt),\n+\t\t\t\t    \"unsafe function call %qE within \"\n+\t\t\t\t    \"%<transaction_safe%> function\", fn);\n+\t\t\telse\n+\t\t\t  error_at (gimple_location (stmt),\n+\t\t\t\t    \"unsafe indirect function call within \"\n+\t\t\t\t    \"%<transaction_safe%> function\");\n+\t\t      }\n \t\t  }\n \t      }\n \t  }"}]}