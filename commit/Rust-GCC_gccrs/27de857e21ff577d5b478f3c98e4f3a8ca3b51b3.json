{"sha": "27de857e21ff577d5b478f3c98e4f3a8ca3b51b3", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6MjdkZTg1N2UyMWZmNTc3ZDViNDc4ZjNjOThlNGYzYThjYTNiNTFiMw==", "commit": {"author": {"name": "Gary Dismukes", "email": "dismukes@adacore.com", "date": "2019-08-14T09:50:46Z"}, "committer": {"name": "Pierre-Marie de Rodat", "email": "pmderodat@gcc.gnu.org", "date": "2019-08-14T09:50:46Z"}, "message": "[Ada] Illegal selection of first object in a task type's body not detected\n\nThe compiler was improperly allowing selection of an object declared\nwithin a task body when the prefix was of the task type, specifically in\nthe case where the object was the very first declared in the body\n(selections of later body declarations were being flagged).  The flag\nIs_Private_Op was only set at the point of the first \"private\"\ndeclaration of the type in cases where the first declaration's name\ndidn't match the selector.\n\n2019-08-14  Gary Dismukes  <dismukes@adacore.com>\n\ngcc/ada/\n\n\t* sem_ch4.adb (Analyze_Selected_Component): In the case where\n\tthe prefix is of a concurrent type, and the selected entity\n\tmatching the selector is the first private declaration of the\n\ttype (such as the first local variable in a task's body), set\n\tIs_Private_Op.\n\ngcc/testsuite/\n\n\t* gnat.dg/task5.adb: New testcase.\n\nFrom-SVN: r274446", "tree": {"sha": "c163a22dde0f76585b0540f4e0a30a9c9d966784", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/c163a22dde0f76585b0540f4e0a30a9c9d966784"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/27de857e21ff577d5b478f3c98e4f3a8ca3b51b3", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/27de857e21ff577d5b478f3c98e4f3a8ca3b51b3", "html_url": "https://github.com/Rust-GCC/gccrs/commit/27de857e21ff577d5b478f3c98e4f3a8ca3b51b3", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/27de857e21ff577d5b478f3c98e4f3a8ca3b51b3/comments", "author": {"login": "dismukes", "id": 50880541, "node_id": "MDQ6VXNlcjUwODgwNTQx", "avatar_url": "https://avatars.githubusercontent.com/u/50880541?v=4", "gravatar_id": "", "url": "https://api.github.com/users/dismukes", "html_url": "https://github.com/dismukes", "followers_url": "https://api.github.com/users/dismukes/followers", "following_url": "https://api.github.com/users/dismukes/following{/other_user}", "gists_url": "https://api.github.com/users/dismukes/gists{/gist_id}", "starred_url": "https://api.github.com/users/dismukes/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/dismukes/subscriptions", "organizations_url": "https://api.github.com/users/dismukes/orgs", "repos_url": "https://api.github.com/users/dismukes/repos", "events_url": "https://api.github.com/users/dismukes/events{/privacy}", "received_events_url": "https://api.github.com/users/dismukes/received_events", "type": "User", "site_admin": false}, "committer": null, "parents": [{"sha": "bc1f44ef8f87228591b7ecd74dac324812c0ff47", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/bc1f44ef8f87228591b7ecd74dac324812c0ff47", "html_url": "https://github.com/Rust-GCC/gccrs/commit/bc1f44ef8f87228591b7ecd74dac324812c0ff47"}], "stats": {"total": 48, "additions": 47, "deletions": 1}, "files": [{"sha": "8ad19833248ac8c767ea60fbd0faec6354ee5602", "filename": "gcc/ada/ChangeLog", "status": "modified", "additions": 8, "deletions": 0, "changes": 8, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/27de857e21ff577d5b478f3c98e4f3a8ca3b51b3/gcc%2Fada%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/27de857e21ff577d5b478f3c98e4f3a8ca3b51b3/gcc%2Fada%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fada%2FChangeLog?ref=27de857e21ff577d5b478f3c98e4f3a8ca3b51b3", "patch": "@@ -1,3 +1,11 @@\n+2019-08-14  Gary Dismukes  <dismukes@adacore.com>\n+\n+\t* sem_ch4.adb (Analyze_Selected_Component): In the case where\n+\tthe prefix is of a concurrent type, and the selected entity\n+\tmatching the selector is the first private declaration of the\n+\ttype (such as the first local variable in a task's body), set\n+\tIs_Private_Op.\n+\n 2019-08-14  Piotr Trojanek  <trojanek@adacore.com>\n \n \t* einfo.adb (Is_Generic_Actual_Subprogram): Replace repeated"}, {"sha": "16614edd98584e843fbece134ad8ee734768a2c3", "filename": "gcc/ada/sem_ch4.adb", "status": "modified", "additions": 9, "deletions": 1, "changes": 10, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/27de857e21ff577d5b478f3c98e4f3a8ca3b51b3/gcc%2Fada%2Fsem_ch4.adb", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/27de857e21ff577d5b478f3c98e4f3a8ca3b51b3/gcc%2Fada%2Fsem_ch4.adb", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fada%2Fsem_ch4.adb?ref=27de857e21ff577d5b478f3c98e4f3a8ca3b51b3", "patch": "@@ -4994,7 +4994,15 @@ package body Sem_Ch4 is\n                if Comp = First_Private_Entity (Type_To_Use) then\n                   if Etype (Sel) /= Any_Type then\n \n-                     --  We have a candiate\n+                     --  If the first private entity's name matches, then treat\n+                     --  it as a private op: needed for the error check for\n+                     --  illegal selection of private entities further below.\n+\n+                     if Chars (Comp) = Chars (Sel) then\n+                        Is_Private_Op := True;\n+                     end if;\n+\n+                     --  We have a candidate, so exit the loop\n \n                      exit;\n "}, {"sha": "0c6852b87771338b0b0b321614aa8eac85c2f34d", "filename": "gcc/testsuite/ChangeLog", "status": "modified", "additions": 4, "deletions": 0, "changes": 4, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/27de857e21ff577d5b478f3c98e4f3a8ca3b51b3/gcc%2Ftestsuite%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/27de857e21ff577d5b478f3c98e4f3a8ca3b51b3/gcc%2Ftestsuite%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2FChangeLog?ref=27de857e21ff577d5b478f3c98e4f3a8ca3b51b3", "patch": "@@ -1,3 +1,7 @@\n+2019-08-14  Gary Dismukes  <dismukes@adacore.com>\n+\n+\t* gnat.dg/task5.adb: New testcase.\n+\n 2019-08-14  Richard Biener  <rguenther@suse.de>\n \n \tPR testsuite/91419"}, {"sha": "cc8ec63b667a1e3f116cf6f83d28b59bfd99eac9", "filename": "gcc/testsuite/gnat.dg/task5.adb", "status": "added", "additions": 26, "deletions": 0, "changes": 26, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/27de857e21ff577d5b478f3c98e4f3a8ca3b51b3/gcc%2Ftestsuite%2Fgnat.dg%2Ftask5.adb", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/27de857e21ff577d5b478f3c98e4f3a8ca3b51b3/gcc%2Ftestsuite%2Fgnat.dg%2Ftask5.adb", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgnat.dg%2Ftask5.adb?ref=27de857e21ff577d5b478f3c98e4f3a8ca3b51b3", "patch": "@@ -0,0 +1,26 @@\n+procedure Task5 is\n+\n+   task type T is\n+      entry E (V1, V2 : Integer);\n+   end T;\n+\n+   T_Obj : T;\n+\n+   task body T is\n+      V1 : Integer;\n+      V2 : Integer;\n+      V3 : Integer;\n+   begin\n+      accept E (V1, V2 : Integer) do\n+         T.V1 := V1;\n+         T.V2 := V2;\n+\n+         T_Obj.V1 := V1;  -- { dg-error \"invalid reference to private operation of some object of type \\\"T\\\"\" }\n+         T_Obj.V2 := V2;  -- { dg-error \"invalid reference to private operation of some object of type \\\"T\\\"\" }\n+         T_Obj.V3 := V3;  -- { dg-error \"invalid reference to private operation of some object of type \\\"T\\\"\" }\n+      end E;\n+   end T;\n+\n+begin\n+   null;\n+end Task5;"}]}