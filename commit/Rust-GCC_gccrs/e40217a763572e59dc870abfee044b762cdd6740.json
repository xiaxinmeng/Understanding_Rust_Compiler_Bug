{"sha": "e40217a763572e59dc870abfee044b762cdd6740", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6ZTQwMjE3YTc2MzU3MmU1OWRjODcwYWJmZWUwNDRiNzYyY2RkNjc0MA==", "commit": {"author": {"name": "Tom Tromey", "email": "tromey@cygnus.com", "date": "1999-11-02T00:12:10Z"}, "committer": {"name": "Tom Tromey", "email": "tromey@gcc.gnu.org", "date": "1999-11-02T00:12:10Z"}, "message": "boehm.cc (_Jv_InitGC): Set GC_java_finalization.\n\n\t* boehm.cc (_Jv_InitGC): Set GC_java_finalization.\n\t(sum_blocks): Removed.\n\t(_Jv_GCFreeMemory): Use GC_get_free_bytes.\n\nFrom-SVN: r30335", "tree": {"sha": "5af320ca89be31cc40ce1c2bd128991ee310abce", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/5af320ca89be31cc40ce1c2bd128991ee310abce"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/e40217a763572e59dc870abfee044b762cdd6740", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/e40217a763572e59dc870abfee044b762cdd6740", "html_url": "https://github.com/Rust-GCC/gccrs/commit/e40217a763572e59dc870abfee044b762cdd6740", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/e40217a763572e59dc870abfee044b762cdd6740/comments", "author": null, "committer": null, "parents": [{"sha": "3d43c0742f8f99e615eca4d3e19b503665bf377e", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/3d43c0742f8f99e615eca4d3e19b503665bf377e", "html_url": "https://github.com/Rust-GCC/gccrs/commit/3d43c0742f8f99e615eca4d3e19b503665bf377e"}], "stats": {"total": 28, "additions": 9, "deletions": 19}, "files": [{"sha": "cad83603c9d545259bbd118d962df312c6f89df6", "filename": "libjava/ChangeLog", "status": "modified", "additions": 6, "deletions": 0, "changes": 6, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/e40217a763572e59dc870abfee044b762cdd6740/libjava%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/e40217a763572e59dc870abfee044b762cdd6740/libjava%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libjava%2FChangeLog?ref=e40217a763572e59dc870abfee044b762cdd6740", "patch": "@@ -1,3 +1,9 @@\n+1999-11-01  Tom Tromey  <tromey@cygnus.com>\n+\n+\t* boehm.cc (_Jv_InitGC): Set GC_java_finalization.\n+\t(sum_blocks): Removed.\n+\t(_Jv_GCFreeMemory): Use GC_get_free_bytes.\n+\n 1999-11-01  Bryce McKinlay  <bryce@albatross.co.nz>\n \n \t* java/io/PrintStream (PrintStream): Fix illegal usage of \"this\" "}, {"sha": "39fc9af9b09893eca0ed1c64b54168b68eec9f22", "filename": "libjava/boehm.cc", "status": "modified", "additions": 3, "deletions": 19, "changes": 22, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/e40217a763572e59dc870abfee044b762cdd6740/libjava%2Fboehm.cc", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/e40217a763572e59dc870abfee044b762cdd6740/libjava%2Fboehm.cc", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libjava%2Fboehm.cc?ref=e40217a763572e59dc870abfee044b762cdd6740", "patch": "@@ -368,28 +368,10 @@ _Jv_GCTotalMemory (void)\n   return GC_get_heap_size ();\n }\n \n-/* Sum size of each hblk.  */\n-static void\n-sum_blocks (struct hblk *h, word arg)\n-{\n-  long *sump = (long *) arg;\n-  /* This evil computation is from boehm-gc/checksums.c.  */\n-  hdr *hhdr = HDR (h);\n-  int bytes = WORDS_TO_BYTES (hhdr->hb_sz);\n-  bytes += HDR_BYTES + HBLKSIZE - 1;\n-  bytes &= ~ (HBLKSIZE - 1);\n-  *sump += bytes;\n-}\n-\n-/* This turns out to be expensive to implement.  For now, we don't\n-   care.  We could make it less expensive, perhaps, but that would\n-   require some changes to the collector.  */\n long\n _Jv_GCFreeMemory (void)\n {\n-  long sum = 0;\n-  GC_apply_to_all_blocks (sum_blocks, &sum);\n-  return sum;\n+  return GC_get_free_bytes ();\n }\n \n void\n@@ -423,6 +405,8 @@ _Jv_InitGC (void)\n     }\n   initialized = 1;\n \n+  GC_java_finalization = 1;\n+\n   // Set up state for marking and allocation of Java objects.\n   obj_free_list = (ptr_t *) GC_generic_malloc_inner ((MAXOBJSZ + 1)\n \t\t\t\t\t\t     * sizeof (ptr_t),"}]}