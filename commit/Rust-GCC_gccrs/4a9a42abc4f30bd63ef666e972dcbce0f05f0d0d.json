{"sha": "4a9a42abc4f30bd63ef666e972dcbce0f05f0d0d", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6NGE5YTQyYWJjNGYzMGJkNjNlZjY2NmU5NzJkY2JjZTBmMDVmMGQwZA==", "commit": {"author": {"name": "Marek Polacek", "email": "polacek@redhat.com", "date": "2015-01-07T08:21:50Z"}, "committer": {"name": "Marek Polacek", "email": "mpolacek@gcc.gnu.org", "date": "2015-01-07T08:21:50Z"}, "message": "re PR c/64440 (-Wdiv-by-zero false negative on const variables)\n\n\tPR c/64440\n\t* c-common.c (c_fully_fold_internal): Warn for division and modulo\n\tif orig_op1 isn't INTEGER_CST, op1 is INTEGER_CST and is zero.\n\n\t* gcc.dg/pr64440.c: New test.\n\t* c-c++-common/pr56607.c: Don't limit dg-warnings to C++.\n\nFrom-SVN: r219279", "tree": {"sha": "d0f2a4cd5014273666c800236267295be4add8a2", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/d0f2a4cd5014273666c800236267295be4add8a2"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/4a9a42abc4f30bd63ef666e972dcbce0f05f0d0d", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/4a9a42abc4f30bd63ef666e972dcbce0f05f0d0d", "html_url": "https://github.com/Rust-GCC/gccrs/commit/4a9a42abc4f30bd63ef666e972dcbce0f05f0d0d", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/4a9a42abc4f30bd63ef666e972dcbce0f05f0d0d/comments", "author": {"login": "mpolacek", "id": 10496300, "node_id": "MDQ6VXNlcjEwNDk2MzAw", "avatar_url": "https://avatars.githubusercontent.com/u/10496300?v=4", "gravatar_id": "", "url": "https://api.github.com/users/mpolacek", "html_url": "https://github.com/mpolacek", "followers_url": "https://api.github.com/users/mpolacek/followers", "following_url": "https://api.github.com/users/mpolacek/following{/other_user}", "gists_url": "https://api.github.com/users/mpolacek/gists{/gist_id}", "starred_url": "https://api.github.com/users/mpolacek/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/mpolacek/subscriptions", "organizations_url": "https://api.github.com/users/mpolacek/orgs", "repos_url": "https://api.github.com/users/mpolacek/repos", "events_url": "https://api.github.com/users/mpolacek/events{/privacy}", "received_events_url": "https://api.github.com/users/mpolacek/received_events", "type": "User", "site_admin": false}, "committer": null, "parents": [{"sha": "2cc901dcb29e15e06bfeab82a9834b6254b4ae0f", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/2cc901dcb29e15e06bfeab82a9834b6254b4ae0f", "html_url": "https://github.com/Rust-GCC/gccrs/commit/2cc901dcb29e15e06bfeab82a9834b6254b4ae0f"}], "stats": {"total": 42, "additions": 40, "deletions": 2}, "files": [{"sha": "4bcff011315109cb6c25652b36589ffe9f41861a", "filename": "gcc/c-family/ChangeLog", "status": "modified", "additions": 6, "deletions": 0, "changes": 6, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/4a9a42abc4f30bd63ef666e972dcbce0f05f0d0d/gcc%2Fc-family%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/4a9a42abc4f30bd63ef666e972dcbce0f05f0d0d/gcc%2Fc-family%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fc-family%2FChangeLog?ref=4a9a42abc4f30bd63ef666e972dcbce0f05f0d0d", "patch": "@@ -1,3 +1,9 @@\n+2015-01-07  Marek Polacek  <polacek@redhat.com>\n+\n+\tPR c/64440\n+\t* c-common.c (c_fully_fold_internal): Warn for division and modulo\n+\tif orig_op1 isn't INTEGER_CST, op1 is INTEGER_CST and is zero.\n+\n 2015-01-05  Trevor Saunders  <tsaunders@mozilla.com>\n \n \tPR c++/31397"}, {"sha": "df4fddd19265e27d1c52e4c060cb00f36a176a0b", "filename": "gcc/c-family/c-common.c", "status": "modified", "additions": 11, "deletions": 0, "changes": 11, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/4a9a42abc4f30bd63ef666e972dcbce0f05f0d0d/gcc%2Fc-family%2Fc-common.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/4a9a42abc4f30bd63ef666e972dcbce0f05f0d0d/gcc%2Fc-family%2Fc-common.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fc-family%2Fc-common.c?ref=4a9a42abc4f30bd63ef666e972dcbce0f05f0d0d", "patch": "@@ -1364,6 +1364,17 @@ c_fully_fold_internal (tree expr, bool in_init, bool *maybe_const_operands,\n \t\t\t\t ? G_(\"left shift count >= width of type\")\n \t\t\t\t : G_(\"right shift count >= width of type\")));\n \t}\n+      if ((code == TRUNC_DIV_EXPR\n+\t   || code == CEIL_DIV_EXPR\n+\t   || code == FLOOR_DIV_EXPR\n+\t   || code == EXACT_DIV_EXPR\n+\t   || code == TRUNC_MOD_EXPR)\n+\t  && TREE_CODE (orig_op1) != INTEGER_CST\n+\t  && TREE_CODE (op1) == INTEGER_CST\n+\t  && (TREE_CODE (TREE_TYPE (orig_op0)) == INTEGER_TYPE\n+\t      || TREE_CODE (TREE_TYPE (orig_op0)) == FIXED_POINT_TYPE)\n+\t  && TREE_CODE (TREE_TYPE (orig_op1)) == INTEGER_TYPE)\n+\twarn_for_div_by_zero (loc, op1);\n       goto out;\n \n     case INDIRECT_REF:"}, {"sha": "259d87f30eb59d2ee57246adf224861500c4cd13", "filename": "gcc/testsuite/ChangeLog", "status": "modified", "additions": 6, "deletions": 0, "changes": 6, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/4a9a42abc4f30bd63ef666e972dcbce0f05f0d0d/gcc%2Ftestsuite%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/4a9a42abc4f30bd63ef666e972dcbce0f05f0d0d/gcc%2Ftestsuite%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2FChangeLog?ref=4a9a42abc4f30bd63ef666e972dcbce0f05f0d0d", "patch": "@@ -1,3 +1,9 @@\n+2015-01-07  Marek Polacek  <polacek@redhat.com>\n+\n+\tPR c/64440\n+\t* gcc.dg/pr64440.c: New test.\n+\t* c-c++-common/pr56607.c: Don't limit dg-warnings to C++.\n+\n 2015-01-07  Marek Polacek  <polacek@redhat.com>\n \n \tPR c/64417"}, {"sha": "ba1395612da3a08ddc220373beddf7e5708c0494", "filename": "gcc/testsuite/c-c++-common/pr56607.c", "status": "modified", "additions": 2, "deletions": 2, "changes": 4, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/4a9a42abc4f30bd63ef666e972dcbce0f05f0d0d/gcc%2Ftestsuite%2Fc-c%2B%2B-common%2Fpr56607.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/4a9a42abc4f30bd63ef666e972dcbce0f05f0d0d/gcc%2Ftestsuite%2Fc-c%2B%2B-common%2Fpr56607.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fc-c%2B%2B-common%2Fpr56607.c?ref=4a9a42abc4f30bd63ef666e972dcbce0f05f0d0d", "patch": "@@ -12,7 +12,7 @@ int\n f2 (void)\n {\n   const int x = sizeof (char) - 1;\n-  return 1 / x;\t\t\t\t/* { dg-warning \"division by zero\" \"\" { target c++ } } */\n+  return 1 / x;\t\t\t\t/* { dg-warning \"division by zero\" } */\n }\n \n int\n@@ -25,5 +25,5 @@ int\n f4 (void)\n {\n   const int x = sizeof (int) / 3 - 1;\n-  return 1 / x;\t\t\t\t/* { dg-warning \"division by zero\" \"\" { target c++ } } */\n+  return 1 / x;\t\t\t\t/* { dg-warning \"division by zero\" } */\n }"}, {"sha": "f9cc46d0a5caede7477a0467d89422692921bdd2", "filename": "gcc/testsuite/gcc.dg/pr64440.c", "status": "added", "additions": 15, "deletions": 0, "changes": 15, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/4a9a42abc4f30bd63ef666e972dcbce0f05f0d0d/gcc%2Ftestsuite%2Fgcc.dg%2Fpr64440.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/4a9a42abc4f30bd63ef666e972dcbce0f05f0d0d/gcc%2Ftestsuite%2Fgcc.dg%2Fpr64440.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgcc.dg%2Fpr64440.c?ref=4a9a42abc4f30bd63ef666e972dcbce0f05f0d0d", "patch": "@@ -0,0 +1,15 @@\n+/* PR c/64440 */\n+/* { dg-do compile } */\n+/* { dg-options \"-Wall -O2\" } */\n+\n+int\n+foo (int x)\n+{\n+  const int y = 0;\n+  int r = 0;\n+  r += x / y; /* { dg-warning \"division by zero\" } */\n+  r += x / 0; /* { dg-warning \"division by zero\" } */\n+  r += x % y; /* { dg-warning \"division by zero\" } */\n+  r += x % 0; /* { dg-warning \"division by zero\" } */\n+  return r;\n+}"}]}