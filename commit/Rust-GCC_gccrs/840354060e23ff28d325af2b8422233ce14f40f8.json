{"sha": "840354060e23ff28d325af2b8422233ce14f40f8", "node_id": "C_kwDOANBUbNoAKDg0MDM1NDA2MGUyM2ZmMjhkMzI1YWYyYjg0MjIyMzNjZTE0ZjQwZjg", "commit": {"author": {"name": "Jakub Jelinek", "email": "jakub@redhat.com", "date": "2023-04-04T09:20:28Z"}, "committer": {"name": "Jakub Jelinek", "email": "jakub@redhat.com", "date": "2023-04-04T09:20:28Z"}, "message": "riscv: Fix bootstrap [PR109384]\n\nThe following patch unbreaks riscv bootstrap, where it previously failed\non -Werror=format-diag warning promoted to error.\n\nOk for trunk?\n\nOr shall it say e.g.\n\"%<-march=%s%>: %<zfinx%> extension conflicts with %<f>\"\n?\nOr say if the current condition is true, do\nconst char *ext = \"zfinx\";\nif (subset_list->lookup (\"zdinx\"))\n  ext = \"zdinx\";\nelse if (subset_list->lookup (\"zhinx\"))\n  ext = \"zhinx\";\nelse if (subset_list->lookup (\"zhinxmin\"))\n  ext = \"zhinxmin\";\nand\n\"%<-march=%s%>: %qs extension conflicts with %<f>\", arch, ext\n?  Or do similar check for which extension to print against it,\nconst char *ext = \"zfinx\";\nconst char *ext2 = \"f\";\nif (subset_list->lookup (\"zdinx\"))\n  {\n    ext = \"zdinx\";\n    if (subset_list->lookup (\"d\"))\n      ext2 = \"d\";\n  }\nelse if (subset_list->lookup (\"zhinx\"))\n  {\n    ext = \"zhinx\";\n    if (subset_list->lookup (\"zfh\"))\n      ext2 = \"zfh\";\n  }\nelse if (subset_list->lookup (\"zhinxmin\"))\n  {\n    ext = \"zhinxmin\";\n    if (subset_list->lookup (\"zfhmin\"))\n      ext2 = \"zfhmin\";\n  }\n\"%<-march=%s%>: %qs extension conflicts with %qs\", arch, ext, ext2\n?\n\n2023-04-04  Jakub Jelinek  <jakub@redhat.com>\n\n\tPR target/109384\n\t* common/config/riscv/riscv-common.cc (riscv_subset_list::parse):\n\tReword diagnostics about zfinx conflict with f, formatting fixes.\n\n\t* gcc.target/riscv/arch-19.c: Expect a different message about zfinx\n\tvs. f conflict.", "tree": {"sha": "1a53167a425a961a57753bc3a667695ad5c3326d", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/1a53167a425a961a57753bc3a667695ad5c3326d"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/840354060e23ff28d325af2b8422233ce14f40f8", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/840354060e23ff28d325af2b8422233ce14f40f8", "html_url": "https://github.com/Rust-GCC/gccrs/commit/840354060e23ff28d325af2b8422233ce14f40f8", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/840354060e23ff28d325af2b8422233ce14f40f8/comments", "author": {"login": "jakubjelinek", "id": 9370665, "node_id": "MDQ6VXNlcjkzNzA2NjU=", "avatar_url": "https://avatars.githubusercontent.com/u/9370665?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jakubjelinek", "html_url": "https://github.com/jakubjelinek", "followers_url": "https://api.github.com/users/jakubjelinek/followers", "following_url": "https://api.github.com/users/jakubjelinek/following{/other_user}", "gists_url": "https://api.github.com/users/jakubjelinek/gists{/gist_id}", "starred_url": "https://api.github.com/users/jakubjelinek/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jakubjelinek/subscriptions", "organizations_url": "https://api.github.com/users/jakubjelinek/orgs", "repos_url": "https://api.github.com/users/jakubjelinek/repos", "events_url": "https://api.github.com/users/jakubjelinek/events{/privacy}", "received_events_url": "https://api.github.com/users/jakubjelinek/received_events", "type": "User", "site_admin": false}, "committer": {"login": "jakubjelinek", "id": 9370665, "node_id": "MDQ6VXNlcjkzNzA2NjU=", "avatar_url": "https://avatars.githubusercontent.com/u/9370665?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jakubjelinek", "html_url": "https://github.com/jakubjelinek", "followers_url": "https://api.github.com/users/jakubjelinek/followers", "following_url": "https://api.github.com/users/jakubjelinek/following{/other_user}", "gists_url": "https://api.github.com/users/jakubjelinek/gists{/gist_id}", "starred_url": "https://api.github.com/users/jakubjelinek/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jakubjelinek/subscriptions", "organizations_url": "https://api.github.com/users/jakubjelinek/orgs", "repos_url": "https://api.github.com/users/jakubjelinek/repos", "events_url": "https://api.github.com/users/jakubjelinek/events{/privacy}", "received_events_url": "https://api.github.com/users/jakubjelinek/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "7735b117bcdd28df662dfa536519bffc75ae9dee", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/7735b117bcdd28df662dfa536519bffc75ae9dee", "html_url": "https://github.com/Rust-GCC/gccrs/commit/7735b117bcdd28df662dfa536519bffc75ae9dee"}], "stats": {"total": 9, "additions": 4, "deletions": 5}, "files": [{"sha": "2fc0f8bffc15643ebd2ba7aead1e84485ee5f118", "filename": "gcc/common/config/riscv/riscv-common.cc", "status": "modified", "additions": 3, "deletions": 4, "changes": 7, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/840354060e23ff28d325af2b8422233ce14f40f8/gcc%2Fcommon%2Fconfig%2Friscv%2Friscv-common.cc", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/840354060e23ff28d325af2b8422233ce14f40f8/gcc%2Fcommon%2Fconfig%2Friscv%2Friscv-common.cc", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fcommon%2Fconfig%2Friscv%2Friscv-common.cc?ref=840354060e23ff28d325af2b8422233ce14f40f8", "patch": "@@ -1153,10 +1153,9 @@ riscv_subset_list::parse (const char *arch, location_t loc)\n \n   subset_list->handle_combine_ext ();\n \n-  if (subset_list->lookup(\"zfinx\") && subset_list->lookup(\"f\"))\n-\terror_at (loc,\n-\t\"%<-march=%s%>: z*inx is conflict with float extensions\",\n-\tarch);\n+  if (subset_list->lookup (\"zfinx\") && subset_list->lookup (\"f\"))\n+    error_at (loc, \"%<-march=%s%>: z*inx conflicts with floating-point \"\n+\t\t   \"extensions\", arch);\n \n   return subset_list;\n "}, {"sha": "b042e1a49fe6f6150fd5f167d1b3b05b61c44b8e", "filename": "gcc/testsuite/gcc.target/riscv/arch-19.c", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/840354060e23ff28d325af2b8422233ce14f40f8/gcc%2Ftestsuite%2Fgcc.target%2Friscv%2Farch-19.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/840354060e23ff28d325af2b8422233ce14f40f8/gcc%2Ftestsuite%2Fgcc.target%2Friscv%2Farch-19.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgcc.target%2Friscv%2Farch-19.c?ref=840354060e23ff28d325af2b8422233ce14f40f8", "patch": "@@ -1,4 +1,4 @@\n /* { dg-do compile } */\n /* { dg-options \"-march=rv64if_zfinx -mabi=lp64\" } */\n int foo() {}\n-/* { dg-error \"'-march=rv64if_zfinx': z\\\\*inx is conflict with float extensions\" \"\" { target *-*-* } 0 } */\n+/* { dg-error \"'-march=rv64if_zfinx': z\\\\*inx conflicts with floating-point extensions\" \"\" { target *-*-* } 0 } */"}]}