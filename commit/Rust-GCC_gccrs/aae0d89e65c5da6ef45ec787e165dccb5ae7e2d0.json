{"sha": "aae0d89e65c5da6ef45ec787e165dccb5ae7e2d0", "node_id": "C_kwDOANBUbNoAKGFhZTBkODllNjVjNWRhNmVmNDVlYzc4N2UxNjVkY2NiNWFlN2UyZDA", "commit": {"author": {"name": "Gaius Mulley", "email": "gaiusmod2@gmail.com", "date": "2023-03-22T16:39:12Z"}, "committer": {"name": "Gaius Mulley", "email": "gaiusmod2@gmail.com", "date": "2023-03-22T16:39:12Z"}, "message": "modula2: Add cwd to include path.  Include m2cor before m2pim.\n\nThe driver should default to include the current working directory in the\nmodule search path.  This patch adds . to the search path provided\n-fm2-pathname has not been specified.  The patch also reorders the pim\nlibraries so that the m2cor directory is searched before m2pim.\nCoroutine support is visible by default for both -fpim and -fiso\n(from their respective SYSTEM modules).\n\ngcc/m2/ChangeLog:\n\n\tPR modula2/109248\n\t* Make-lang.in (m2/pge-boot/%.o): Add CFLAGS and CXXFLAGS for C\n\tand C++ compiles.\n\t* gm2spec.cc (add_m2_I_path): Indentation.\n\t(lang_specific_driver): New variable seen_pathname.\n\tDetect -fm2-pathname.  If not seen then push_back_Ipath (\".\").\n\tChange non iso library path to \"m2cor,m2log,m2pim,m2iso\".\n\nSigned-off-by: Gaius Mulley <gaiusmod2@gmail.com>", "tree": {"sha": "cb7b9c8b2af0c3a824f1d1854eb74049ca5a6af2", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/cb7b9c8b2af0c3a824f1d1854eb74049ca5a6af2"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/aae0d89e65c5da6ef45ec787e165dccb5ae7e2d0", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/aae0d89e65c5da6ef45ec787e165dccb5ae7e2d0", "html_url": "https://github.com/Rust-GCC/gccrs/commit/aae0d89e65c5da6ef45ec787e165dccb5ae7e2d0", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/aae0d89e65c5da6ef45ec787e165dccb5ae7e2d0/comments", "author": null, "committer": null, "parents": [{"sha": "426cab4e3b46abaeae0813042b5addc789e3b2be", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/426cab4e3b46abaeae0813042b5addc789e3b2be", "html_url": "https://github.com/Rust-GCC/gccrs/commit/426cab4e3b46abaeae0813042b5addc789e3b2be"}], "stats": {"total": 17, "additions": 13, "deletions": 4}, "files": [{"sha": "ad21b208f09be1d95a9ed71cd73664987f77bc02", "filename": "gcc/m2/Make-lang.in", "status": "modified", "additions": 2, "deletions": 2, "changes": 4, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/aae0d89e65c5da6ef45ec787e165dccb5ae7e2d0/gcc%2Fm2%2FMake-lang.in", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/aae0d89e65c5da6ef45ec787e165dccb5ae7e2d0/gcc%2Fm2%2FMake-lang.in", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fm2%2FMake-lang.in?ref=aae0d89e65c5da6ef45ec787e165dccb5ae7e2d0", "patch": "@@ -1694,11 +1694,11 @@ include m2/Make-maintainer\n else\n m2/pge-boot/%.o: m2/pge-boot/%.c m2/gm2-libs/gm2-libs-host.h m2/gm2config.h\n \t-test -d $(@D) || $(mkinstalldirs) $(@D)\n-\t$(CXX) $(INCLUDES) -I$(srcdir)/m2/pge-boot -Im2/gm2-libs -g -c $< -o $@\n+\t$(CXX) $(CFLAGS) $(INCLUDES) -I$(srcdir)/m2/pge-boot -Im2/gm2-libs -g -c $< -o $@\n \n m2/pge-boot/%.o: m2/pge-boot/%.cc m2/gm2-libs/gm2-libs-host.h m2/gm2config.h\n \t-test -d $(@D) || $(mkinstalldirs) $(@D)\n-\t$(CXX) $(INCLUDES) -I$(srcdir)/m2/pge-boot -Im2/gm2-libs -g -c $< -o $@\n+\t$(CXX) $(CXXFLAGS) $(INCLUDES) -I$(srcdir)/m2/pge-boot -Im2/gm2-libs -g -c $< -o $@\n \n $(PGE): $(BUILD-PGE-O)\n \t+$(LINKER) $(ALL_LINKERFLAGS) $(LDFLAGS) -o $@ $(BUILD-PGE-O) -lm"}, {"sha": "3b2652cd92a1880b2591dbf4fb56debe387547db", "filename": "gcc/m2/gm2spec.cc", "status": "modified", "additions": 11, "deletions": 2, "changes": 13, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/aae0d89e65c5da6ef45ec787e165dccb5ae7e2d0/gcc%2Fm2%2Fgm2spec.cc", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/aae0d89e65c5da6ef45ec787e165dccb5ae7e2d0/gcc%2Fm2%2Fgm2spec.cc", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fm2%2Fgm2spec.cc?ref=aae0d89e65c5da6ef45ec787e165dccb5ae7e2d0", "patch": "@@ -388,7 +388,7 @@ add_m2_I_path (void)\n       if (strcmp (np.name, \"\") == 0)\n \tappend_option (OPT_fm2_pathname_, safe_strdup (\"-\"), 1);\n       else\n-\t  append_option (OPT_fm2_pathname_, safe_strdup (np.name), 1);\n+\tappend_option (OPT_fm2_pathname_, safe_strdup (np.name), 1);\n       for (auto *s : np.path)\n \tappend_option (OPT_fm2_pathnameI, safe_strdup (s), 1);\n     }\n@@ -461,6 +461,9 @@ lang_specific_driver (struct cl_decoded_option **in_decoded_options,\n   /* Have we seen the -v flag?  */\n   bool verbose = false;\n \n+  /* Have we seen the -fm2-pathname flag?  */\n+  bool seen_pathname = false;\n+\n   /* The number of libraries added in.  */\n   int added_libraries;\n \n@@ -569,6 +572,7 @@ lang_specific_driver (struct cl_decoded_option **in_decoded_options,\n \t  uselist = decoded_options[i].value;\n \t  break;\n \tcase OPT_fm2_pathname_:\n+\t  seen_pathname = true;\n \t  args[i] |= SKIPOPT; /* We will add the option if it is needed.  */\n \t  m2_path_name = decoded_options[i].arg;\n \t  break;\n@@ -677,6 +681,11 @@ lang_specific_driver (struct cl_decoded_option **in_decoded_options,\n   if (language != NULL && (strcmp (language, \"modula-2\") != 0))\n     return;\n \n+  if (! seen_pathname)\n+    /* Not seen -fm2-pathname therefore make current working directory\n+       the first place to look for modules.  */\n+    push_back_Ipath (\".\");\n+\n   /* Override the default when the user specifies it.  */\n   if (seen_scaffold_static && scaffold_static && !seen_scaffold_dynamic)\n     scaffold_dynamic = false;\n@@ -772,7 +781,7 @@ lang_specific_driver (struct cl_decoded_option **in_decoded_options,\n \t    libraries = xstrdup (\"m2iso,m2cor,m2pim,m2log\");\n \t  else\n \t    /* Default to pim libraries otherwise.  */\n-\t    libraries = xstrdup (\"m2pim,m2iso,m2cor,m2log\");\n+\t    libraries = xstrdup (\"m2cor,m2log,m2pim,m2iso\");\n \t}\n       libraries = convert_abbreviations (libraries);\n       append_option (OPT_flibs_, xstrdup (libraries), 1);"}]}