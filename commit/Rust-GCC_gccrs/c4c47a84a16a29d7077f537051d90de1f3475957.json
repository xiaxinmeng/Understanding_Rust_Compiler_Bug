{"sha": "c4c47a84a16a29d7077f537051d90de1f3475957", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6YzRjNDdhODRhMTZhMjlkNzA3N2Y1MzcwNTFkOTBkZTFmMzQ3NTk1Nw==", "commit": {"author": {"name": "Claudiu Zissulescu", "email": "claziss@synopsys.com", "date": "2021-06-14T12:33:17Z"}, "committer": {"name": "Claudiu Zissulescu", "email": "claziss@synopsys.com", "date": "2021-06-14T12:33:25Z"}, "message": "arc: Add --with-fpu support for ARCv2 cpus\n\nSupport for a compile-time default FPU. The --with-fpu configuration\noption is ignored if -mfpu compiler option is specified. The FPU\noptions are only available for ARCv2 cpus.\n\ngcc/\n2021-06-14  Claudiu Zissulescu  <claziss@synopsys.com>\n\n\t* config.gcc (arc): Add support for with_cpu option.\n\t* config/arc/arc.h (OPTION_DEFAULT_SPECS): Add fpu.\n\nSigned-off-by: Claudiu Zissulescu <claziss@synopsys.com>", "tree": {"sha": "b1e3500f478976c7374252f932a371273eea1067", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/b1e3500f478976c7374252f932a371273eea1067"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/c4c47a84a16a29d7077f537051d90de1f3475957", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/c4c47a84a16a29d7077f537051d90de1f3475957", "html_url": "https://github.com/Rust-GCC/gccrs/commit/c4c47a84a16a29d7077f537051d90de1f3475957", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/c4c47a84a16a29d7077f537051d90de1f3475957/comments", "author": {"login": "claziss", "id": 2761368, "node_id": "MDQ6VXNlcjI3NjEzNjg=", "avatar_url": "https://avatars.githubusercontent.com/u/2761368?v=4", "gravatar_id": "", "url": "https://api.github.com/users/claziss", "html_url": "https://github.com/claziss", "followers_url": "https://api.github.com/users/claziss/followers", "following_url": "https://api.github.com/users/claziss/following{/other_user}", "gists_url": "https://api.github.com/users/claziss/gists{/gist_id}", "starred_url": "https://api.github.com/users/claziss/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/claziss/subscriptions", "organizations_url": "https://api.github.com/users/claziss/orgs", "repos_url": "https://api.github.com/users/claziss/repos", "events_url": "https://api.github.com/users/claziss/events{/privacy}", "received_events_url": "https://api.github.com/users/claziss/received_events", "type": "User", "site_admin": false}, "committer": {"login": "claziss", "id": 2761368, "node_id": "MDQ6VXNlcjI3NjEzNjg=", "avatar_url": "https://avatars.githubusercontent.com/u/2761368?v=4", "gravatar_id": "", "url": "https://api.github.com/users/claziss", "html_url": "https://github.com/claziss", "followers_url": "https://api.github.com/users/claziss/followers", "following_url": "https://api.github.com/users/claziss/following{/other_user}", "gists_url": "https://api.github.com/users/claziss/gists{/gist_id}", "starred_url": "https://api.github.com/users/claziss/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/claziss/subscriptions", "organizations_url": "https://api.github.com/users/claziss/orgs", "repos_url": "https://api.github.com/users/claziss/repos", "events_url": "https://api.github.com/users/claziss/events{/privacy}", "received_events_url": "https://api.github.com/users/claziss/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "831589c227cf1a53cb08490edbafb612d0a9db7c", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/831589c227cf1a53cb08490edbafb612d0a9db7c", "html_url": "https://github.com/Rust-GCC/gccrs/commit/831589c227cf1a53cb08490edbafb612d0a9db7c"}], "stats": {"total": 48, "additions": 43, "deletions": 5}, "files": [{"sha": "1be8d96f5e5addafd5db1710c8543c3aa208e3d3", "filename": "gcc/config.gcc", "status": "modified", "additions": 39, "deletions": 5, "changes": 44, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/c4c47a84a16a29d7077f537051d90de1f3475957/gcc%2Fconfig.gcc", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/c4c47a84a16a29d7077f537051d90de1f3475957/gcc%2Fconfig.gcc", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fconfig.gcc?ref=c4c47a84a16a29d7077f537051d90de1f3475957", "patch": "@@ -4260,18 +4260,52 @@ case \"${target}\" in\n \t\t;;\n \n \tarc*-*-*)\n-\t\tsupported_defaults=\"cpu\"\n+\t\tsupported_defaults=\"cpu fpu\"\n \n+\t\tnew_cpu=hs38_linux\n \t\tif [ x\"$with_cpu\" = x ] \\\n-\t\t    || grep \"^ARC_CPU ($with_cpu,\" \\\n-\t\t       ${srcdir}/config/arc/arc-cpus.def \\\n-\t\t       > /dev/null; then\n+\t\t    || grep -q -E \"^ARC_CPU[[:blank:]]*\\($with_cpu,\" \\\n+\t\t       ${srcdir}/config/arc/arc-cpus.def\n+\t\tthen\n \t\t # Ok\n-\t\t true\n+\t\t new_cpu=$with_cpu\n \t\telse\n \t\t echo \"Unknown cpu used in --with-cpu=$with_cpu\" 1>&2\n \t\t exit 1\n \t\tfi\n+\n+\t\t# see if --with-fpu matches any of the supported FPUs\n+\t\tcase \"$with_fpu\" in\n+\t\t\"\")\n+\t\t\t# OK\n+\t\t\t;;\n+\t\tfpus | fpus_div | fpus_fma | fpus_all)\n+\t\t\t# OK if em or hs\n+\t\t\tflags_ok=\"[emhs]+\"\n+\t\t\t;;\n+\t\tfpuda | fpuda_div | fpuda_fma | fpuda_all)\n+\t\t\t# OK only em\n+\t\t\tflags_ok=\"em\"\n+\t\t\t;;\n+\t\tfpud | fpud_div | fpud_fma | fpud_all)\n+\t\t\t# OK only hs\n+\t\t\tflags_ok=\"hs\"\n+\t\t\t;;\n+\t\t*)\n+\t\t\techo \"Unknown floating point type used in \"\\\n+\t\t\t     \"--with-fpu=$with_fpu\" 1>&2\n+\t\t\texit 1\n+\t\t\t;;\n+\t\tesac\n+\n+\t\tif [ -n \"$flags_ok\" ] \\\n+\t\t   && ! grep -q -E \"^ARC_CPU[[:blank:]]*\\($new_cpu,[[:blank:]]*$flags_ok,\" \\\n+\t\t   ${srcdir}/config/arc/arc-cpus.def\n+\t\tthen\n+\t\t   echo \"Unknown floating point type used in \"\\\n+\t\t\t \"--with-fpu=$with_fpu for cpu $new_cpu\" 1>&2\n+\t\t\t exit 1\n+\t\tfi\n \t\t;;\n \n     csky-*-*)"}, {"sha": "8cd63500044a021596c88b65b163a5ca766f38d7", "filename": "gcc/config/arc/arc.h", "status": "modified", "additions": 4, "deletions": 0, "changes": 4, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/c4c47a84a16a29d7077f537051d90de1f3475957/gcc%2Fconfig%2Farc%2Farc.h", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/c4c47a84a16a29d7077f537051d90de1f3475957/gcc%2Fconfig%2Farc%2Farc.h", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fconfig%2Farc%2Farc.h?ref=c4c47a84a16a29d7077f537051d90de1f3475957", "patch": "@@ -100,7 +100,11 @@ extern const char *arc_cpu_to_as (int argc, const char **argv);\n   \"%:cpu_to_as(%{mcpu=*:%*}) %{mspfp*} %{mdpfp*} \"                      \\\n   \"%{mfpu=fpuda*:-mfpuda} %{mcode-density}\"\n \n+/* Support for a compile-time default CPU and FPU.  The rules are:\n+   --with-cpu is ignored if -mcpu, mARC*, marc*, mA7, mA6 are specified.\n+   --with-fpu is ignored if -mfpu is specified.  */\n #define OPTION_DEFAULT_SPECS\t\t\t\t\t\t\\\n+  {\"fpu\", \"%{!mfpu=*:-mfpu=%(VALUE)}\"},\t\t\t\t\t\\\n   {\"cpu\", \"%{!mcpu=*:%{!mARC*:%{!marc*:%{!mA7:%{!mA6:-mcpu=%(VALUE)}}}}}\" }\n \n #ifndef DRIVER_ENDIAN_SELF_SPECS"}]}