{"sha": "4a557dc45650bbe500276680674afa18d291fdcc", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6NGE1NTdkYzQ1NjUwYmJlNTAwMjc2NjgwNjc0YWZhMThkMjkxZmRjYw==", "commit": {"author": {"name": "Iain Buclaw", "email": "ibuclaw@gdcproject.org", "date": "2020-06-14T09:02:52Z"}, "committer": {"name": "Iain Buclaw", "email": "ibuclaw@gdcproject.org", "date": "2020-06-14T09:04:17Z"}, "message": "testsuite: Re-add gdc.test prefix in test names (PR testsuite/95575)\n\ngcc/testsuite/ChangeLog:\n\n\tPR testsuite/95575\n\t* lib/gdc-utils.exp (gdc-do-test): Re-add $subdir link and inclusion\n\tin filename.", "tree": {"sha": "708fb2ef10e0d5e7003cf5b115e2d3cb1c0e1c32", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/708fb2ef10e0d5e7003cf5b115e2d3cb1c0e1c32"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/4a557dc45650bbe500276680674afa18d291fdcc", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/4a557dc45650bbe500276680674afa18d291fdcc", "html_url": "https://github.com/Rust-GCC/gccrs/commit/4a557dc45650bbe500276680674afa18d291fdcc", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/4a557dc45650bbe500276680674afa18d291fdcc/comments", "author": {"login": "ibuclaw", "id": 397929, "node_id": "MDQ6VXNlcjM5NzkyOQ==", "avatar_url": "https://avatars.githubusercontent.com/u/397929?v=4", "gravatar_id": "", "url": "https://api.github.com/users/ibuclaw", "html_url": "https://github.com/ibuclaw", "followers_url": "https://api.github.com/users/ibuclaw/followers", "following_url": "https://api.github.com/users/ibuclaw/following{/other_user}", "gists_url": "https://api.github.com/users/ibuclaw/gists{/gist_id}", "starred_url": "https://api.github.com/users/ibuclaw/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/ibuclaw/subscriptions", "organizations_url": "https://api.github.com/users/ibuclaw/orgs", "repos_url": "https://api.github.com/users/ibuclaw/repos", "events_url": "https://api.github.com/users/ibuclaw/events{/privacy}", "received_events_url": "https://api.github.com/users/ibuclaw/received_events", "type": "User", "site_admin": false}, "committer": {"login": "ibuclaw", "id": 397929, "node_id": "MDQ6VXNlcjM5NzkyOQ==", "avatar_url": "https://avatars.githubusercontent.com/u/397929?v=4", "gravatar_id": "", "url": "https://api.github.com/users/ibuclaw", "html_url": "https://github.com/ibuclaw", "followers_url": "https://api.github.com/users/ibuclaw/followers", "following_url": "https://api.github.com/users/ibuclaw/following{/other_user}", "gists_url": "https://api.github.com/users/ibuclaw/gists{/gist_id}", "starred_url": "https://api.github.com/users/ibuclaw/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/ibuclaw/subscriptions", "organizations_url": "https://api.github.com/users/ibuclaw/orgs", "repos_url": "https://api.github.com/users/ibuclaw/repos", "events_url": "https://api.github.com/users/ibuclaw/events{/privacy}", "received_events_url": "https://api.github.com/users/ibuclaw/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "efb4d745551ab22912a8a604965cf26d410a8f28", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/efb4d745551ab22912a8a604965cf26d410a8f28", "html_url": "https://github.com/Rust-GCC/gccrs/commit/efb4d745551ab22912a8a604965cf26d410a8f28"}], "stats": {"total": 18, "additions": 12, "deletions": 6}, "files": [{"sha": "0e4f57c756d4f0f6c300f0b77a97c461a61f1e8a", "filename": "gcc/testsuite/lib/gdc-utils.exp", "status": "modified", "additions": 12, "deletions": 6, "changes": 18, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/4a557dc45650bbe500276680674afa18d291fdcc/gcc%2Ftestsuite%2Flib%2Fgdc-utils.exp", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/4a557dc45650bbe500276680674afa18d291fdcc/gcc%2Ftestsuite%2Flib%2Fgdc-utils.exp", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Flib%2Fgdc-utils.exp?ref=4a557dc45650bbe500276680674afa18d291fdcc", "patch": "@@ -403,6 +403,7 @@ proc gdc-permute-options { options } {\n \n proc gdc-do-test { testcases } {\n     global dg-do-what-default\n+    global subdir\n     global verbose\n \n     # If a testcase doesn't have special options, use these.\n@@ -430,27 +431,32 @@ proc gdc-do-test { testcases } {\n \n     set saved-dg-do-what-default ${dg-do-what-default}\n \n+    # Create gdc.test link so test names include that subdir.\n+    set testdir [file dirname $subdir]\n+    catch { file link $testdir . }\n+\n     # Main loop.\n \n     # set verbose 1\n     # set dg-final-code \"\"\n     # Find all tests and pass to routine.\n     foreach test $testcases {\n-\tregexp -- \"(.*)/(.+)/(.+)\\.(.+)$\" $test match base dir name ext\n+\tregexp -- \"(.*)/(.+)/(.+)\\.(.+)$\" $test match base type name ext\n \n \t# Convert to DG test.\n-\tset imports [format \"-I%s/%s\" $base $dir]\n+\tset imports [format \"-I%s/%s\" $base $type]\n \tset cleanup_extra_files \"\"\n- \tset compilable_do_what \"assemble\"\n-\tset filename \"[gdc-convert-test $base $dir/$name.$ext]\"\n+\tset compilable_do_what \"assemble\"\n+\t# Include $testdir prefix so test names follow DejaGnu conventions.\n+\tset filename \"$testdir/[gdc-convert-test $base $type/$name.$ext]\"\n \n-\tif { $dir == \"runnable\" } {\n+\tif { $type == \"runnable\" } {\n \t    append PERMUTE_ARGS \" $SHARED_OPTION\"\n \t}\n \n \tset options [gdc-permute-options [lsort -unique $PERMUTE_ARGS]]\n \n-\tswitch $dir {\n+\tswitch $type {\n \t    runnable_cxx -\n \t    runnable {\n \t\tfor { set i 0 } { $i<[llength $options] } { incr i } {"}]}