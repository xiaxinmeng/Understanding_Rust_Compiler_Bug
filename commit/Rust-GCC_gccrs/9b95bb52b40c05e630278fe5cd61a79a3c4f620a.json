{"sha": "9b95bb52b40c05e630278fe5cd61a79a3c4f620a", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6OWI5NWJiNTJiNDBjMDVlNjMwMjc4ZmU1Y2Q2MWE3OWEzYzRmNjIwYQ==", "commit": {"author": {"name": "Jakub Jelinek", "email": "jakub@redhat.com", "date": "2020-05-07T12:54:20Z"}, "committer": {"name": "Jakub Jelinek", "email": "jakub@redhat.com", "date": "2020-05-07T12:54:20Z"}, "message": "c-family: Fix error-recovery ICE on __builtin_speculation_safe_value [PR94968]\n\nIf the second argument of __builtin_speculation_safe_value is\nerror_mark_node (or has such a type), we ICE during\nuseless_typ_conversion_p.\n\n202-05-07  Jakub Jelinek  <jakub@redhat.com>\n\n\tPR c/94968\n\t* c-common.c (speculation_safe_value_resolve_params): Return false if\n\terror_operand_p (val2).\n\t(resolve_overloaded_builtin) <case BUILT_IN_SPECULATION_SAFE_VALUE_N>:\n\tRemove extraneous semicolon.\n\n\t* gcc.dg/pr94968.c: New test.", "tree": {"sha": "29849696b5aaca2bd9d1d0f79263c4f4cd62d6ba", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/29849696b5aaca2bd9d1d0f79263c4f4cd62d6ba"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/9b95bb52b40c05e630278fe5cd61a79a3c4f620a", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/9b95bb52b40c05e630278fe5cd61a79a3c4f620a", "html_url": "https://github.com/Rust-GCC/gccrs/commit/9b95bb52b40c05e630278fe5cd61a79a3c4f620a", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/9b95bb52b40c05e630278fe5cd61a79a3c4f620a/comments", "author": {"login": "jakubjelinek", "id": 9370665, "node_id": "MDQ6VXNlcjkzNzA2NjU=", "avatar_url": "https://avatars.githubusercontent.com/u/9370665?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jakubjelinek", "html_url": "https://github.com/jakubjelinek", "followers_url": "https://api.github.com/users/jakubjelinek/followers", "following_url": "https://api.github.com/users/jakubjelinek/following{/other_user}", "gists_url": "https://api.github.com/users/jakubjelinek/gists{/gist_id}", "starred_url": "https://api.github.com/users/jakubjelinek/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jakubjelinek/subscriptions", "organizations_url": "https://api.github.com/users/jakubjelinek/orgs", "repos_url": "https://api.github.com/users/jakubjelinek/repos", "events_url": "https://api.github.com/users/jakubjelinek/events{/privacy}", "received_events_url": "https://api.github.com/users/jakubjelinek/received_events", "type": "User", "site_admin": false}, "committer": {"login": "jakubjelinek", "id": 9370665, "node_id": "MDQ6VXNlcjkzNzA2NjU=", "avatar_url": "https://avatars.githubusercontent.com/u/9370665?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jakubjelinek", "html_url": "https://github.com/jakubjelinek", "followers_url": "https://api.github.com/users/jakubjelinek/followers", "following_url": "https://api.github.com/users/jakubjelinek/following{/other_user}", "gists_url": "https://api.github.com/users/jakubjelinek/gists{/gist_id}", "starred_url": "https://api.github.com/users/jakubjelinek/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jakubjelinek/subscriptions", "organizations_url": "https://api.github.com/users/jakubjelinek/orgs", "repos_url": "https://api.github.com/users/jakubjelinek/repos", "events_url": "https://api.github.com/users/jakubjelinek/events{/privacy}", "received_events_url": "https://api.github.com/users/jakubjelinek/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "9cd70f3f0fa45cbe899da5ecd0b0c6da0657fd62", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/9cd70f3f0fa45cbe899da5ecd0b0c6da0657fd62", "html_url": "https://github.com/Rust-GCC/gccrs/commit/9cd70f3f0fa45cbe899da5ecd0b0c6da0657fd62"}], "stats": {"total": 25, "additions": 24, "deletions": 1}, "files": [{"sha": "2e3eb0868316d6768d39a6c13bb6af5b30303d99", "filename": "gcc/c-family/ChangeLog", "status": "modified", "additions": 8, "deletions": 0, "changes": 8, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/9b95bb52b40c05e630278fe5cd61a79a3c4f620a/gcc%2Fc-family%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/9b95bb52b40c05e630278fe5cd61a79a3c4f620a/gcc%2Fc-family%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fc-family%2FChangeLog?ref=9b95bb52b40c05e630278fe5cd61a79a3c4f620a", "patch": "@@ -1,3 +1,11 @@\n+202-05-07  Jakub Jelinek  <jakub@redhat.com>\n+\n+\tPR c/94968\n+\t* c-common.c (speculation_safe_value_resolve_params): Return false if\n+\terror_operand_p (val2).\n+\t(resolve_overloaded_builtin) <case BUILT_IN_SPECULATION_SAFE_VALUE_N>:\n+\tRemove extraneous semicolon.\n+\n 2020-05-06  qing zhao  <qing.zhao@oracle.com>\n \n \tPR c/94230"}, {"sha": "d164f1e2f1ff3f314ea8ba2cb67c12ff7075470a", "filename": "gcc/c-family/c-common.c", "status": "modified", "additions": 3, "deletions": 1, "changes": 4, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/9b95bb52b40c05e630278fe5cd61a79a3c4f620a/gcc%2Fc-family%2Fc-common.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/9b95bb52b40c05e630278fe5cd61a79a3c4f620a/gcc%2Fc-family%2Fc-common.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fc-family%2Fc-common.c?ref=9b95bb52b40c05e630278fe5cd61a79a3c4f620a", "patch": "@@ -6716,6 +6716,8 @@ speculation_safe_value_resolve_params (location_t loc, tree orig_function,\n       tree val2 = (*params)[1];\n       if (TREE_CODE (TREE_TYPE (val2)) == ARRAY_TYPE)\n \tval2 = default_conversion (val2);\n+      if (error_operand_p (val2))\n+\treturn false;\n       if (!(TREE_TYPE (val) == TREE_TYPE (val2)\n \t    || useless_type_conversion_p (TREE_TYPE (val), TREE_TYPE (val2))))\n \t{\n@@ -7400,7 +7402,7 @@ resolve_overloaded_builtin (location_t loc, tree function,\n       {\n \ttree new_function, first_param, result;\n \tenum built_in_function fncode\n-\t  = speculation_safe_value_resolve_call (function, params);;\n+\t  = speculation_safe_value_resolve_call (function, params);\n \n \tif (fncode == BUILT_IN_NONE)\n \t  return error_mark_node;"}, {"sha": "227aa639f74736f769e2c247ace8cfc61a8beb12", "filename": "gcc/testsuite/ChangeLog", "status": "modified", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/9b95bb52b40c05e630278fe5cd61a79a3c4f620a/gcc%2Ftestsuite%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/9b95bb52b40c05e630278fe5cd61a79a3c4f620a/gcc%2Ftestsuite%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2FChangeLog?ref=9b95bb52b40c05e630278fe5cd61a79a3c4f620a", "patch": "@@ -1,3 +1,8 @@\n+202-05-07  Jakub Jelinek  <jakub@redhat.com>\n+\n+\tPR c/94968\n+\t* gcc.dg/pr94968.c: New test.\n+\n 2020-05-07  Richard Biener  <rguenther@suse.de>\n \n \tPR tree-optimization/57359"}, {"sha": "e8b282139c49360edda5e767035b0c9b257db016", "filename": "gcc/testsuite/gcc.dg/pr94968.c", "status": "added", "additions": 8, "deletions": 0, "changes": 8, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/9b95bb52b40c05e630278fe5cd61a79a3c4f620a/gcc%2Ftestsuite%2Fgcc.dg%2Fpr94968.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/9b95bb52b40c05e630278fe5cd61a79a3c4f620a/gcc%2Ftestsuite%2Fgcc.dg%2Fpr94968.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgcc.dg%2Fpr94968.c?ref=9b95bb52b40c05e630278fe5cd61a79a3c4f620a", "patch": "@@ -0,0 +1,8 @@\n+/* PR c/94968 */\n+/* { dg-do compile } */\n+\n+int\n+foo (void)\n+{ \n+  __builtin_speculation_safe_value (1, x);\t/* { dg-error \"undeclared\" } */\n+}\t\t\t\t\t\t/* { dg-message \"each undeclared identifier is reported only once\" \"\" { target *-*-* } .-1 } */"}]}