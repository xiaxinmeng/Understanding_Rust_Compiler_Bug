{"sha": "3df1a115be22caeab3ffe7afb12e71adb54ff132", "node_id": "C_kwDOANBUbNoAKDNkZjFhMTE1YmUyMmNhZWFiM2ZmZTdhZmIxMmU3MWFkYjU0ZmYxMzI", "commit": {"author": {"name": "Christophe Lyon", "email": "christophe.lyon@arm.com", "date": "2022-06-14T21:08:33Z"}, "committer": {"name": "Christophe Lyon", "email": "christophe.lyon@arm.com", "date": "2023-01-12T13:42:00Z"}, "message": "aarch64: fix warning emission for ABI break since GCC 9.1\n\nWhile looking at PR 105549, which is about fixing the ABI break\nintroduced in GCC 9.1 in parameter alignment with bit-fields, we\nnoticed that the GCC 9.1 warning is not emitted in all the cases where\nit should be.  This patch fixes that and the next patch in the series\nfixes the GCC 9.1 break.\n\nWe split this into two patches since patch #2 introduces a new ABI\nbreak starting with GCC 13.1.  This way, patch #1 can be back-ported\nto release branches if needed to fix the GCC 9.1 warning issue.\n\nThe main idea is to add a new global boolean that indicates whether\nwe're expanding the start of a function, so that aarch64_layout_arg\ncan emit warnings for callees as well as callers.  This removes the\nneed for aarch64_function_arg_boundary to warn (with its incomplete\ninformation).  However, in the first patch there are still cases where\nwe emit warnings were we should not; this is fixed in patch #2 where\nwe can distinguish between GCC 9.1 and GCC.13.1 ABI breaks properly.\n\nThe fix in aarch64_function_arg_boundary (replacing & with &&) looks\nlike an oversight of a previous commit in this area which changed\n'abi_break' from a boolean to an integer.\n\nWe also take the opportunity to fix the comment above\naarch64_function_arg_alignment since the value of the abi_break\nparameter was changed in a previous commit, no longer matching the\ndescription.\n\n2022-11-28  Christophe Lyon  <christophe.lyon@arm.com>\n\t    Richard Sandiford  <richard.sandiford@arm.com>\n\ngcc/ChangeLog:\n\n\t* config/aarch64/aarch64.cc (aarch64_function_arg_alignment): Fix\n\tcomment.\n\t(aarch64_layout_arg): Factorize warning conditions.\n\t(aarch64_function_arg_boundary): Fix typo.\n\t* function.cc (currently_expanding_function_start): New variable.\n\t(expand_function_start): Handle\n\tcurrently_expanding_function_start.\n\t* function.h (currently_expanding_function_start): Declare.\n\ngcc/testsuite/ChangeLog:\n\n\t* gcc.target/aarch64/bitfield-abi-warning-align16-O2.c: New test.\n\t* gcc.target/aarch64/bitfield-abi-warning-align16-O2-extra.c: New\n\ttest.\n\t* gcc.target/aarch64/bitfield-abi-warning-align32-O2.c: New test.\n\t* gcc.target/aarch64/bitfield-abi-warning-align32-O2-extra.c: New\n\ttest.\n\t* gcc.target/aarch64/bitfield-abi-warning-align8-O2.c: New test.\n\t* gcc.target/aarch64/bitfield-abi-warning.h: New test.\n\t* g++.target/aarch64/bitfield-abi-warning-align16-O2.C: New test.\n\t* g++.target/aarch64/bitfield-abi-warning-align16-O2-extra.C: New\n\ttest.\n\t* g++.target/aarch64/bitfield-abi-warning-align32-O2.C: New test.\n\t* g++.target/aarch64/bitfield-abi-warning-align32-O2-extra.C: New\n\ttest.\n\t* g++.target/aarch64/bitfield-abi-warning-align8-O2.C: New test.\n\t* g++.target/aarch64/bitfield-abi-warning.h: New test.", "tree": {"sha": "0e8f83dd063f2b8e077ae6a4fc21a0006a6b5d35", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/0e8f83dd063f2b8e077ae6a4fc21a0006a6b5d35"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/3df1a115be22caeab3ffe7afb12e71adb54ff132", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/3df1a115be22caeab3ffe7afb12e71adb54ff132", "html_url": "https://github.com/Rust-GCC/gccrs/commit/3df1a115be22caeab3ffe7afb12e71adb54ff132", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/3df1a115be22caeab3ffe7afb12e71adb54ff132/comments", "author": null, "committer": null, "parents": [{"sha": "b073f2b098ba7819450d6c14a0fb96cb1c09f242", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/b073f2b098ba7819450d6c14a0fb96cb1c09f242", "html_url": "https://github.com/Rust-GCC/gccrs/commit/b073f2b098ba7819450d6c14a0fb96cb1c09f242"}], "stats": {"total": 1139, "additions": 1132, "deletions": 7}, "files": [{"sha": "9eb6652e421d1ab53454d7fcd1cfcba5f2edbf30", "filename": "gcc/config/aarch64/aarch64.cc", "status": "modified", "additions": 21, "deletions": 7, "changes": 28, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/3df1a115be22caeab3ffe7afb12e71adb54ff132/gcc%2Fconfig%2Faarch64%2Faarch64.cc", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/3df1a115be22caeab3ffe7afb12e71adb54ff132/gcc%2Fconfig%2Faarch64%2Faarch64.cc", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fconfig%2Faarch64%2Faarch64.cc?ref=3df1a115be22caeab3ffe7afb12e71adb54ff132", "patch": "@@ -7536,9 +7536,9 @@ aarch64_vfp_is_call_candidate (cumulative_args_t pcum_v, machine_mode mode,\n /* Given MODE and TYPE of a function argument, return the alignment in\n    bits.  The idea is to suppress any stronger alignment requested by\n    the user and opt for the natural alignment (specified in AAPCS64 \\S\n-   4.1).  ABI_BREAK is set to true if the alignment was incorrectly\n-   calculated in versions of GCC prior to GCC-9.  This is a helper\n-   function for local use only.  */\n+   4.1).  ABI_BREAK is set to the old alignment if the alignment was\n+   incorrectly calculated in versions of GCC prior to GCC-9.  This is\n+   a helper function for local use only.  */\n \n static unsigned int\n aarch64_function_arg_alignment (machine_mode mode, const_tree type,\n@@ -7614,11 +7614,24 @@ aarch64_layout_arg (cumulative_args_t pcum_v, const function_arg_info &arg)\n   if (pcum->aapcs_arg_processed)\n     return;\n \n+  bool warn_pcs_change\n+    = (warn_psabi\n+       && !pcum->silent_p\n+       && (currently_expanding_function_start\n+\t   || currently_expanding_gimple_stmt));\n+\n+  unsigned int alignment\n+    = aarch64_function_arg_alignment (mode, type, &abi_break);\n+  gcc_assert (!alignment || abi_break < alignment);\n+\n   pcum->aapcs_arg_processed = true;\n \n   pure_scalable_type_info pst_info;\n   if (type && pst_info.analyze_registers (type))\n     {\n+      /* aarch64_function_arg_alignment has never had an effect on\n+\t this case.  */\n+\n       /* The PCS says that it is invalid to pass an SVE value to an\n \t unprototyped function.  There is no ABI-defined location we\n \t can return in this case, so we have no real choice but to raise\n@@ -7689,6 +7702,8 @@ aarch64_layout_arg (cumulative_args_t pcum_v, const function_arg_info &arg)\n      and homogenous short-vector aggregates (HVA).  */\n   if (allocate_nvrn)\n     {\n+      /* aarch64_function_arg_alignment has never had an effect on\n+\t this case.  */\n       if (!pcum->silent_p && !TARGET_FLOAT)\n \taarch64_err_no_fpadvsimd (mode);\n \n@@ -7753,7 +7768,7 @@ aarch64_layout_arg (cumulative_args_t pcum_v, const function_arg_info &arg)\n \t  && (aarch64_function_arg_alignment (mode, type, &abi_break)\n \t      == 16 * BITS_PER_UNIT))\n \t{\n-\t  if (abi_break && warn_psabi && currently_expanding_gimple_stmt)\n+\t  if (warn_pcs_change && abi_break)\n \t    inform (input_location, \"parameter passing for argument of type \"\n \t\t    \"%qT changed in GCC 9.1\", type);\n \t  ++ncrn;\n@@ -7816,7 +7831,7 @@ aarch64_layout_arg (cumulative_args_t pcum_v, const function_arg_info &arg)\n       int new_size = ROUND_UP (pcum->aapcs_stack_size, 16 / UNITS_PER_WORD);\n       if (pcum->aapcs_stack_size != new_size)\n \t{\n-\t  if (abi_break && warn_psabi && currently_expanding_gimple_stmt)\n+\t  if (warn_pcs_change && abi_break)\n \t    inform (input_location, \"parameter passing for argument of type \"\n \t\t    \"%qT changed in GCC 9.1\", type);\n \t  pcum->aapcs_stack_size = new_size;\n@@ -7936,14 +7951,13 @@ aarch64_function_arg_boundary (machine_mode mode, const_tree type)\n   unsigned int alignment = aarch64_function_arg_alignment (mode, type,\n \t\t\t\t\t\t\t   &abi_break);\n   alignment = MIN (MAX (alignment, PARM_BOUNDARY), STACK_BOUNDARY);\n-  if (abi_break & warn_psabi)\n+  if (abi_break && warn_psabi)\n     {\n       abi_break = MIN (MAX (abi_break, PARM_BOUNDARY), STACK_BOUNDARY);\n       if (alignment != abi_break)\n \tinform (input_location, \"parameter passing for argument of type \"\n \t\t\"%qT changed in GCC 9.1\", type);\n     }\n-\n   return alignment;\n }\n "}, {"sha": "27ba880368ac3b98a82ffb08b1b2dbe01f807e91", "filename": "gcc/function.cc", "status": "modified", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/3df1a115be22caeab3ffe7afb12e71adb54ff132/gcc%2Ffunction.cc", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/3df1a115be22caeab3ffe7afb12e71adb54ff132/gcc%2Ffunction.cc", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ffunction.cc?ref=3df1a115be22caeab3ffe7afb12e71adb54ff132", "patch": "@@ -5062,9 +5062,12 @@ stack_protect_epilogue (void)\n    PARMS_HAVE_CLEANUPS is nonzero if there are cleanups associated with\n    the function's parameters, which must be run at any return statement.  */\n \n+bool currently_expanding_function_start;\n void\n expand_function_start (tree subr)\n {\n+  currently_expanding_function_start = true;\n+\n   /* Make sure volatile mem refs aren't considered\n      valid operands of arithmetic insns.  */\n   init_recog_no_volatile ();\n@@ -5257,6 +5260,8 @@ expand_function_start (tree subr)\n   /* If we are doing generic stack checking, the probe should go here.  */\n   if (flag_stack_check == GENERIC_STACK_CHECK)\n     stack_check_probe_note = emit_note (NOTE_INSN_DELETED);\n+\n+  currently_expanding_function_start = false;\n }\n \f\n void"}, {"sha": "cf85d2a4664eeb9a2fea80065e6206e28fad6680", "filename": "gcc/function.h", "status": "modified", "additions": 2, "deletions": 0, "changes": 2, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/3df1a115be22caeab3ffe7afb12e71adb54ff132/gcc%2Ffunction.h", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/3df1a115be22caeab3ffe7afb12e71adb54ff132/gcc%2Ffunction.h", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ffunction.h?ref=3df1a115be22caeab3ffe7afb12e71adb54ff132", "patch": "@@ -723,4 +723,6 @@ extern const char *current_function_name (void);\n \n extern void used_types_insert (tree);\n \n+extern bool currently_expanding_function_start;\n+\n #endif  /* GCC_FUNCTION_H */"}, {"sha": "c45be832d5bb21a7f135bf24443d9614f815ee75", "filename": "gcc/testsuite/g++.target/aarch64/bitfield-abi-warning-align16-O2-extra.C", "status": "added", "additions": 86, "deletions": 0, "changes": 86, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/3df1a115be22caeab3ffe7afb12e71adb54ff132/gcc%2Ftestsuite%2Fg%2B%2B.target%2Faarch64%2Fbitfield-abi-warning-align16-O2-extra.C", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/3df1a115be22caeab3ffe7afb12e71adb54ff132/gcc%2Ftestsuite%2Fg%2B%2B.target%2Faarch64%2Fbitfield-abi-warning-align16-O2-extra.C", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fg%2B%2B.target%2Faarch64%2Fbitfield-abi-warning-align16-O2-extra.C?ref=3df1a115be22caeab3ffe7afb12e71adb54ff132", "patch": "@@ -0,0 +1,86 @@\n+/* { dg-do compile } */\n+/* { dg-options \"-O2 -save-temps -Wno-narrowing\" } */\n+\n+#define ALIGN 16\n+//#define EXTRA\n+\n+#include \"bitfield-abi-warning.h\"\n+\n+/* In f1, f2, f4, f8, f16, f16p (and stdarg versions):  */\n+/* { dg-final { scan-assembler-times \"and\\tw0, w2, 1\" 12 { xfail *-*-* } } } */\n+/* In fp, f1p, f2p, f4p, f8p (and stdarg versions):  */\n+/* { dg-final { scan-assembler-times \"and\\tw0, w1, 1\" 10 { xfail *-*-* } } } */\n+\n+/* Bitfield parameter in registers.  */\n+/* { dg-note {parameter passing for argument of type 'S1' changed in GCC 9.1} \"\" { target *-*-* } 47 } f1 */\n+/* { dg-note {parameter passing for argument of type 'S2' changed in GCC 9.1} \"\" { target *-*-* } 48 } f2 */\n+/* { dg-note {parameter passing for argument of type 'S4' changed in GCC 9.1} \"\" { target *-*-* } 49 } f4 */\n+/* { dg-note {parameter passing for argument of type 'S8' changed in GCC 9.1} \"\" { target *-*-* } 50 } f8 */\n+\n+/* { dg-note {parameter passing for argument of type 'Sp' changed in GCC 9.1} \"\" { target *-*-* } 53 }  fp */\n+/* { dg-note {parameter passing for argument of type 'S1p' changed in GCC 9.1} \"\" { target *-*-* } 54 } f1p */\n+/* { dg-note {parameter passing for argument of type 'S2p' changed in GCC 9.1} \"\" { target *-*-* } 55 } f2p */\n+/* { dg-note {parameter passing for argument of type 'S4p' changed in GCC 9.1} \"\" { target *-*-* } 56 } f4p */\n+/* { dg-note {parameter passing for argument of type 'S8p' changed in GCC 9.1} \"\" { target *-*-* } 57 } f8p */\n+\n+/* Bitfield call argument in registers.  */\n+/* { dg-note {parameter passing for argument of type 'S1' changed in GCC 9.1} \"\"  { target *-*-* } 60 } g1 */\n+/* { dg-note {parameter passing for argument of type 'S2' changed in GCC 9.1} \"\"  { target *-*-* } 61 } g2 */\n+/* { dg-note {parameter passing for argument of type 'S4' changed in GCC 9.1} \"\"  { target *-*-* } 62 } g4 */\n+/* { dg-note {parameter passing for argument of type 'S8' changed in GCC 9.1} \"\"  { target *-*-* } 63 } g8 */\n+\n+/* { dg-note {parameter passing for argument of type 'Sp' changed in GCC 9.1} \"\" { target *-*-* } 66 }  gp */\n+/* { dg-note {parameter passing for argument of type 'S1p' changed in GCC 9.1} \"\" { target *-*-* } 67 } g1p */\n+/* { dg-note {parameter passing for argument of type 'S2p' changed in GCC 9.1} \"\" { target *-*-* } 68 } g2p */\n+/* { dg-note {parameter passing for argument of type 'S4p' changed in GCC 9.1} \"\" { target *-*-* } 69 } g4p */\n+/* { dg-note {parameter passing for argument of type 'S8p' changed in GCC 9.1} \"\" { target *-*-* } 70 } g8p */\n+\n+\n+/* Bitfield parameter in stack.  */\n+/* { dg-note {parameter passing for argument of type 'S1' changed in GCC 9.1} \"\" { target *-*-* } 74 } f1_stack */\n+/* { dg-note {parameter passing for argument of type 'S2' changed in GCC 9.1} \"\" { target *-*-* } 75 } f2_stack */\n+/* { dg-note {parameter passing for argument of type 'S4' changed in GCC 9.1} \"\" { target *-*-* } 76 } f4_stack */\n+/* { dg-note {parameter passing for argument of type 'S8' changed in GCC 9.1} \"\" { target *-*-* } 77 } f8_stack */\n+\n+/* { dg-note {parameter passing for argument of type 'Sp' changed in GCC 9.1} \"\" { target *-*-* } 80 }  fp_stack */\n+/* { dg-note {parameter passing for argument of type 'S1p' changed in GCC 9.1} \"\" { target *-*-* } 81 } f1p_stack */\n+/* { dg-note {parameter passing for argument of type 'S2p' changed in GCC 9.1} \"\" { target *-*-* } 82 } f2p_stack */\n+/* { dg-note {parameter passing for argument of type 'S4p' changed in GCC 9.1} \"\" { target *-*-* } 83 } f4p_stack */\n+/* { dg-note {parameter passing for argument of type 'S8p' changed in GCC 9.1} \"\" { target *-*-* } 84 } f8p_stack */\n+\n+/* Bitfield call argument in stack.  */\n+/* { dg-note {parameter passing for argument of type 'S1' changed in GCC 9.1} \"\"  { target *-*-* } 87 } g1_stack */\n+/* { dg-note {parameter passing for argument of type 'S2' changed in GCC 9.1} \"\"  { target *-*-* } 88 } g2_stack */\n+/* { dg-note {parameter passing for argument of type 'S4' changed in GCC 9.1} \"\"  { target *-*-* } 89 } g4_stack */\n+/* { dg-note {parameter passing for argument of type 'S8' changed in GCC 9.1} \"\"  { target *-*-* } 90 } g8_stack */\n+\n+/* { dg-note {parameter passing for argument of type 'Sp' changed in GCC 9.1} \"\" { target *-*-* } 93 }  gp_stack */\n+/* { dg-note {parameter passing for argument of type 'S1p' changed in GCC 9.1} \"\" { target *-*-* } 94 } g1p_stack */\n+/* { dg-note {parameter passing for argument of type 'S2p' changed in GCC 9.1} \"\" { target *-*-* } 95 } g2p_stack */\n+/* { dg-note {parameter passing for argument of type 'S4p' changed in GCC 9.1} \"\" { target *-*-* } 96 } g4p_stack */\n+/* { dg-note {parameter passing for argument of type 'S8p' changed in GCC 9.1} \"\" { target *-*-* } 97 } g8p_stack */\n+\n+\n+/* Bitfield parameter in stdarg.  */\n+/* { dg-note {parameter passing for argument of type 'S1' changed in GCC 9.1} \"\" { target *-*-* } 101 } f1_stdarg */\n+/* { dg-note {parameter passing for argument of type 'S2' changed in GCC 9.1} \"\" { target *-*-* } 102 } f2_stdarg */\n+/* { dg-note {parameter passing for argument of type 'S4' changed in GCC 9.1} \"\" { target *-*-* } 103 } f4_stdarg */\n+/* { dg-note {parameter passing for argument of type 'S8' changed in GCC 9.1} \"\" { target *-*-* } 104 } f8_stdarg */\n+\n+/* { dg-note {parameter passing for argument of type 'Sp' changed in GCC 9.1} \"\" { target *-*-* } 107 }  fp_stdarg */\n+/* { dg-note {parameter passing for argument of type 'S1p' changed in GCC 9.1} \"\" { target *-*-* } 108 } f1p_stdarg */\n+/* { dg-note {parameter passing for argument of type 'S2p' changed in GCC 9.1} \"\" { target *-*-* } 109 } f2p_stdarg */\n+/* { dg-note {parameter passing for argument of type 'S4p' changed in GCC 9.1} \"\" { target *-*-* } 110 } f4p_stdarg */\n+/* { dg-note {parameter passing for argument of type 'S8p' changed in GCC 9.1} \"\" { target *-*-* } 111 } f8p_stdarg */\n+\n+/* Bitfield call argument in stdarg.  */\n+/* { dg-note {parameter passing for argument of type 'S1' changed in GCC 9.1} \"\"  { target *-*-* } 114 } g1_stdarg */\n+/* { dg-note {parameter passing for argument of type 'S2' changed in GCC 9.1} \"\"  { target *-*-* } 115 } g2_stdarg */\n+/* { dg-note {parameter passing for argument of type 'S4' changed in GCC 9.1} \"\"  { target *-*-* } 116 } g4_stdarg */\n+/* { dg-note {parameter passing for argument of type 'S8' changed in GCC 9.1} \"\"  { target *-*-* } 117 } g8_stdarg */\n+\n+/* { dg-note {parameter passing for argument of type 'Sp' changed in GCC 9.1} \"\" { target *-*-* } 120 }  gp_stdarg */\n+/* { dg-note {parameter passing for argument of type 'S1p' changed in GCC 9.1} \"\" { target *-*-* } 121 } g1p_stdarg */\n+/* { dg-note {parameter passing for argument of type 'S2p' changed in GCC 9.1} \"\" { target *-*-* } 122 } g2p_stdarg */\n+/* { dg-note {parameter passing for argument of type 'S4p' changed in GCC 9.1} \"\" { target *-*-* } 123 } g4p_stdarg */\n+/* { dg-note {parameter passing for argument of type 'S8p' changed in GCC 9.1} \"\" { target *-*-* } 124 } g8p_stdarg */"}, {"sha": "61d12ec22ebcab32fd5e5bd5f42193efd75ca987", "filename": "gcc/testsuite/g++.target/aarch64/bitfield-abi-warning-align16-O2.C", "status": "added", "additions": 87, "deletions": 0, "changes": 87, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/3df1a115be22caeab3ffe7afb12e71adb54ff132/gcc%2Ftestsuite%2Fg%2B%2B.target%2Faarch64%2Fbitfield-abi-warning-align16-O2.C", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/3df1a115be22caeab3ffe7afb12e71adb54ff132/gcc%2Ftestsuite%2Fg%2B%2B.target%2Faarch64%2Fbitfield-abi-warning-align16-O2.C", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fg%2B%2B.target%2Faarch64%2Fbitfield-abi-warning-align16-O2.C?ref=3df1a115be22caeab3ffe7afb12e71adb54ff132", "patch": "@@ -0,0 +1,87 @@\n+/* { dg-do compile } */\n+/* { dg-options \"-O2 -save-temps -Wno-narrowing\" } */\n+\n+#define ALIGN 16\n+#define EXTRA\n+\n+#include \"bitfield-abi-warning.h\"\n+\n+/* In f1, f2, f4, f8, f16, f16p (and stdarg versions):  */\n+/* { dg-final { scan-assembler-times \"and\\tw0, w2, 1\" 12 { xfail *-*-* } } } */\n+/* In fp, f1p, f2p, f4p, f8p (and stdarg versions):  */\n+/* { dg-final { scan-assembler-times \"and\\tw0, w1, 1\" 10 { xfail *-*-* } } } */\n+\n+/* Bitfield parameter in registers.  */\n+/* { dg-note {parameter passing for argument of type 'S1' changed in GCC 9.1} \"\" { target *-*-* } 47 } f1 */\n+/* { dg-note {parameter passing for argument of type 'S2' changed in GCC 9.1} \"\" { target *-*-* } 48 } f2 */\n+/* { dg-note {parameter passing for argument of type 'S4' changed in GCC 9.1} \"\" { target *-*-* } 49 } f4 */\n+/* { dg-note {parameter passing for argument of type 'S8' changed in GCC 9.1} \"\" { target *-*-* } 50 } f8 */\n+\n+/* No change in parameter passing in GCC 9.1 for lines 53-57 (fp, f1p, f2p,\n+   f4p, f8p) (because the argument fits in a single register).  Should not\n+   warn, but aarch64_function_arg_boundary would need to take the argument size\n+   into account as well as whether it's passed via registers or the stack.  */\n+/* { dg-note {parameter passing for argument of type 'Sp' changed in GCC 9.1} \"\" { target *-*-* } 53 }  fp */\n+/* { dg-note {parameter passing for argument of type 'S1p' changed in GCC 9.1} \"\" { target *-*-* } 54 } f1p */\n+/* { dg-note {parameter passing for argument of type 'S2p' changed in GCC 9.1} \"\" { target *-*-* } 55 } f2p */\n+/* { dg-note {parameter passing for argument of type 'S4p' changed in GCC 9.1} \"\" { target *-*-* } 56 } f4p */\n+/* { dg-note {parameter passing for argument of type 'S8p' changed in GCC 9.1} \"\" { target *-*-* } 57 } f8p */\n+\n+/* Bitfield call argument in registers.  */\n+/* { dg-note {parameter passing for argument of type 'S1' changed in GCC 9.1} \"\"  { target *-*-* } 60 } g1 */\n+/* { dg-note {parameter passing for argument of type 'S2' changed in GCC 9.1} \"\"  { target *-*-* } 61 } g2 */\n+/* { dg-note {parameter passing for argument of type 'S4' changed in GCC 9.1} \"\"  { target *-*-* } 62 } g4 */\n+/* { dg-note {parameter passing for argument of type 'S8' changed in GCC 9.1} \"\"  { target *-*-* } 63 } g8 */\n+\n+/* No change in parameter passing in GCC 9.1 for lines 66-70 (gp, g1p, g2p,\n+   g4p, g8p), no warning expected.  */\n+\n+\n+/* Bitfield parameter in stack.  */\n+/* { dg-note {parameter passing for argument of type 'S1' changed in GCC 9.1} \"\" { target *-*-* } 74 } f1_stack */\n+/* { dg-note {parameter passing for argument of type 'S2' changed in GCC 9.1} \"\" { target *-*-* } 75 } f2_stack */\n+/* { dg-note {parameter passing for argument of type 'S4' changed in GCC 9.1} \"\" { target *-*-* } 76 } f4_stack */\n+/* { dg-note {parameter passing for argument of type 'S8' changed in GCC 9.1} \"\" { target *-*-* } 77 } f8_stack */\n+\n+/* { dg-note {parameter passing for argument of type 'Sp' changed in GCC 9.1} \"\" { target *-*-* } 80 }  fp_stack */\n+/* { dg-note {parameter passing for argument of type 'S1p' changed in GCC 9.1} \"\" { target *-*-* } 81 } f1p_stack */\n+/* { dg-note {parameter passing for argument of type 'S2p' changed in GCC 9.1} \"\" { target *-*-* } 82 } f2p_stack */\n+/* { dg-note {parameter passing for argument of type 'S4p' changed in GCC 9.1} \"\" { target *-*-* } 83 } f4p_stack */\n+/* { dg-note {parameter passing for argument of type 'S8p' changed in GCC 9.1} \"\" { target *-*-* } 84 } f8p_stack */\n+\n+/* Bitfield call argument in stack.  */\n+/* { dg-note {parameter passing for argument of type 'S1' changed in GCC 9.1} \"\"  { target *-*-* } 87 } g1_stack */\n+/* { dg-note {parameter passing for argument of type 'S2' changed in GCC 9.1} \"\"  { target *-*-* } 88 } g2_stack */\n+/* { dg-note {parameter passing for argument of type 'S4' changed in GCC 9.1} \"\"  { target *-*-* } 89 } g4_stack */\n+/* { dg-note {parameter passing for argument of type 'S8' changed in GCC 9.1} \"\"  { target *-*-* } 90 } g8_stack */\n+\n+/* { dg-note {parameter passing for argument of type 'Sp' changed in GCC 9.1} \"\" { target *-*-* } 93 }  gp_stack */\n+/* { dg-note {parameter passing for argument of type 'S1p' changed in GCC 9.1} \"\" { target *-*-* } 94 } g1p_stack */\n+/* { dg-note {parameter passing for argument of type 'S2p' changed in GCC 9.1} \"\" { target *-*-* } 95 } g2p_stack */\n+/* { dg-note {parameter passing for argument of type 'S4p' changed in GCC 9.1} \"\" { target *-*-* } 96 } g4p_stack */\n+/* { dg-note {parameter passing for argument of type 'S8p' changed in GCC 9.1} \"\" { target *-*-* } 97 } g8p_stack */\n+\n+\n+/* Bitfield parameter in stdarg.  */\n+/* { dg-note {parameter passing for argument of type 'S1' changed in GCC 9.1} \"\" { target *-*-* } 101 } f1_stdarg */\n+/* { dg-note {parameter passing for argument of type 'S2' changed in GCC 9.1} \"\" { target *-*-* } 102 } f2_stdarg */\n+/* { dg-note {parameter passing for argument of type 'S4' changed in GCC 9.1} \"\" { target *-*-* } 103 } f4_stdarg */\n+/* { dg-note {parameter passing for argument of type 'S8' changed in GCC 9.1} \"\" { target *-*-* } 104 } f8_stdarg */\n+\n+/* Parameter passing for these should not have changed in GCC 9.1 (PR 105549).\n+   Fortunately we warn. Note the discrepancy with lines 120-124 below: we warn\n+   in the callee, but not in the caller.  */\n+/* { dg-note {parameter passing for argument of type 'Sp' changed in GCC 9.1} \"\" { target *-*-* } 107 }  fp_stdarg */\n+/* { dg-note {parameter passing for argument of type 'S1p' changed in GCC 9.1} \"\" { target *-*-* } 108 } f1p_stdarg */\n+/* { dg-note {parameter passing for argument of type 'S2p' changed in GCC 9.1} \"\" { target *-*-* } 109 } f2p_stdarg */\n+/* { dg-note {parameter passing for argument of type 'S4p' changed in GCC 9.1} \"\" { target *-*-* } 110 } f4p_stdarg */\n+/* { dg-note {parameter passing for argument of type 'S8p' changed in GCC 9.1} \"\" { target *-*-* } 111 } f8p_stdarg */\n+\n+/* Bitfield call argument in stdarg.  */\n+/* { dg-note {parameter passing for argument of type 'S1' changed in GCC 9.1} \"\"  { target *-*-* } 114 } g1_stdarg */\n+/* { dg-note {parameter passing for argument of type 'S2' changed in GCC 9.1} \"\"  { target *-*-* } 115 } g2_stdarg */\n+/* { dg-note {parameter passing for argument of type 'S4' changed in GCC 9.1} \"\"  { target *-*-* } 116 } g4_stdarg */\n+/* { dg-note {parameter passing for argument of type 'S8' changed in GCC 9.1} \"\"  { target *-*-* } 117 } g8_stdarg */\n+\n+/* No change in parameter passing in GCC 9.1 for lines 120-124 (gp_stdarg\n+   g1p_stdarg, g2p_stdarg, g4p_stdarg, g8p_stdarg), no warning expected.  */"}, {"sha": "04b183af697fb1ab7b6b990479e38767d153e031", "filename": "gcc/testsuite/g++.target/aarch64/bitfield-abi-warning-align32-O2-extra.C", "status": "added", "additions": 119, "deletions": 0, "changes": 119, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/3df1a115be22caeab3ffe7afb12e71adb54ff132/gcc%2Ftestsuite%2Fg%2B%2B.target%2Faarch64%2Fbitfield-abi-warning-align32-O2-extra.C", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/3df1a115be22caeab3ffe7afb12e71adb54ff132/gcc%2Ftestsuite%2Fg%2B%2B.target%2Faarch64%2Fbitfield-abi-warning-align32-O2-extra.C", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fg%2B%2B.target%2Faarch64%2Fbitfield-abi-warning-align32-O2-extra.C?ref=3df1a115be22caeab3ffe7afb12e71adb54ff132", "patch": "@@ -0,0 +1,119 @@\n+/* { dg-do compile } */\n+/* { dg-options \"-O2 -save-temps -Wno-narrowing\" } */\n+\n+#define ALIGN 32\n+//#define EXTRA\n+\n+#include \"bitfield-abi-warning.h\"\n+\n+\n+/* In f1, f2, f4, f8, f16 (and stdarg versions):  */\n+/* { dg-final { scan-assembler-times \"ldr\\tx0, \\\\\\[x1\\\\\\]\" 10 } } */\n+\n+/* In fp, f1p, f2p, f4p, f8p (and stdarg versions):  */\n+/* { dg-final { scan-assembler-times \"and\\tw0, w1, 1\" 10 { xfail *-*-* } } } */\n+\n+/* In f16p (and stdarg version):  */\n+/* { dg-final { scan-assembler-times \"and\\tw0, w2, 1\" 2 { xfail *-*-* } } } */\n+\n+/* In f1_stack, f2_stack, f4_stack, f8_stack, f16_stack, f8p_stack:  */\n+/* { dg-final { scan-assembler-times \"ldr\\tx\\[0-9\\]+, \\\\\\[sp, 8\\\\\\]\" 6 { xfail *-*-* } } } */\n+\n+/* In fp_stack, f1p_stack:  */\n+/* { dg-final { scan-assembler-times \"ldrb\\tw0, \\\\\\[sp, 8\\\\\\]\" 2 { xfail *-*-* } } } */\n+\n+/* In f2p_stack:  */\n+/* { dg-final { scan-assembler-times \"ldrh\\tw0, \\\\\\[sp, 8\\\\\\]\" 1 { xfail *-*-* } } } */\n+\n+/* In f4p_stack:  */\n+/* { dg-final { scan-assembler-times \"ldr\\tw0, \\\\\\[sp, 8\\\\\\]\" 1 { xfail *-*-* } } } */\n+\n+/* In f16p_stack:  */\n+/* { dg-final { scan-assembler-times \"ldr\\tx0, \\\\\\[sp, 16\\\\\\]\" 1 { xfail *-*-* } } } */\n+\n+/* Bitfield parameter in registers.  */\n+/* No change in parameter passing in GCC 9.1 for lines 47-51 (f1, f2, f4, f8, f16)\n+   because the overall alignment is > 16.  No warning expected.  */\n+\n+/* No change in parameter passing in GCC 9.1 for lines 53-57 (fp, f1p, f2p,\n+   f4p, f8p) because the argument fits in a single register.  Should not warn,\n+   but aarch64_function_arg_boundary would need to take the argument size into\n+   account as well as whether it's passed via registers or the stack.  */\n+/* { dg-note {parameter passing for argument of type 'Sp' changed in GCC 9.1}  \"\" { target *-*-* } 53 } fp */\n+/* { dg-note {parameter passing for argument of type 'S1p' changed in GCC 9.1} \"\" { target *-*-* } 54 } f1p */\n+/* { dg-note {parameter passing for argument of type 'S2p' changed in GCC 9.1} \"\" { target *-*-* } 55 } f2p */\n+/* { dg-note {parameter passing for argument of type 'S4p' changed in GCC 9.1} \"\" { target *-*-* } 56 } f4p */\n+/* { dg-note {parameter passing for argument of type 'S8p' changed in GCC 9.1} \"\" { target *-*-* } 57 } f8p */\n+\n+/* Changed in GCC 9.1, but we fail to emit a warning since GCC 11 (was OK with GCC 9).  */\n+/* { dg-note {parameter passing for argument of type 'S16p' changed in GCC 9.1} \"\" { xfail *-*-* } 58 } f16p */\n+\n+\n+/* Bitfield call argument in registers.  */\n+/* No change in parameter passing in GCC 9.1 for lines 60-64 (g1, g2, g4, g8, g16)\n+   because the overall alignment is > 16.  No warning expected.  */\n+\n+/* No change in parameter passing in GCC 9.1 for lines 66-70 (gp, g1p, g2p,\n+   g4p, g8p), no warning expected.  */\n+\n+/* Changed in GCC 9.1, but we fail to emit a warning.  */\n+/* { dg-note {parameter passing for argument of type 'S16p' changed in GCC 9.1} \"\" { xfail *-*-* } 71 } g16p */\n+\n+\n+/* Bitfield parameter in stack.  */\n+/* No change in parameter passing in GCC 9.1 for lines 74-78 (f1_stack,\n+   f2_stack, f4_stack, f8_stack, f16_stack) because the overall alignment is >\n+   16.  No warning expected.  */\n+\n+/* Changed in GCC 9.1.  */\n+/* { dg-note {parameter passing for argument of type 'Sp' changed in GCC 9.1}  \"\" { target *-*-* } 80 } fp_stack */\n+/* { dg-note {parameter passing for argument of type 'S1p' changed in GCC 9.1} \"\" { target *-*-* } 81 } f1p_stack */\n+/* { dg-note {parameter passing for argument of type 'S2p' changed in GCC 9.1} \"\" { target *-*-* } 82 } f2p_stack */\n+/* { dg-note {parameter passing for argument of type 'S4p' changed in GCC 9.1} \"\" { target *-*-* } 83 } f4p_stack */\n+/* { dg-note {parameter passing for argument of type 'S8p' changed in GCC 9.1} \"\" { target *-*-* } 84 } f8p_stack */\n+\n+/* No change in parameter passing in GCC 9.1 for line 85 (f16p_stack) because\n+   the overall alignment is >= 16.  No warning expected.  */\n+\n+\n+/* Bitfield call argument in stack.  */\n+/* No change in parameter passing in GCC 9.1 for lines 87-91 (g1_stack,\n+   g2_stack, g4_stack, g8_stack, g16_stack) because the overall alignment is >\n+   16.  No warning expected.  */\n+\n+/* { dg-note {parameter passing for argument of type 'Sp' changed in GCC 9.1}  \"\" { target *-*-* } 93 } gp_stack */\n+/* { dg-note {parameter passing for argument of type 'S1p' changed in GCC 9.1} \"\" { target *-*-* } 94 } g1p_stack */\n+/* { dg-note {parameter passing for argument of type 'S2p' changed in GCC 9.1} \"\" { target *-*-* } 95 } g2p_stack */\n+/* { dg-note {parameter passing for argument of type 'S4p' changed in GCC 9.1} \"\" { target *-*-* } 96 } g4p_stack */\n+/* { dg-note {parameter passing for argument of type 'S8p' changed in GCC 9.1} \"\" { target *-*-* } 97 } g8p_stack */\n+\n+\n+/* No change in parameter passing in GCC 9.1 for line 98 (g16p_stack).  No\n+   warning expected.  */\n+\n+\n+/* Bitfield parameter in stdarg.  */\n+/* No change in parameter passing in GCC 9.1 for lines 101-105 (f1_stdarg,\n+   f2_stdarg, f4_stdarg, f8_stdarg, f16_stdarg) because the overall alignment\n+   is > 16.  No warning expected.  */\n+\n+/* { dg-note {parameter passing for argument of type 'Sp' changed in GCC 9.1}   \"\" { target *-*-* } 107 } fp_stdarg */\n+/* { dg-note {parameter passing for argument of type 'S1p' changed in GCC 9.1}  \"\" { target *-*-* } 108 } f1p_stdarg */\n+/* { dg-note {parameter passing for argument of type 'S2p' changed in GCC 9.1}  \"\" { target *-*-* } 109 } f2p_stdarg */\n+/* { dg-note {parameter passing for argument of type 'S4p' changed in GCC 9.1}  \"\" { target *-*-* } 110 } f4p_stdarg */\n+/* { dg-note {parameter passing for argument of type 'S8p' changed in GCC 9.1}  \"\" { target *-*-* } 111 } f8p_stdarg */\n+\n+/* No change in parameter passing in GCC 9.1 for line 112 (f16p_stdarg).\n+   Should not warn.  */\n+/* { dg-note {parameter passing for argument of type 'S16p' changed in GCC 9.1} \"\" { target *-*-* } 112 } f16p_stdarg */\n+\n+/* Bitfield call argument in stdarg.  */\n+/* No change in parameter passing in GCC 9.1 for lines 114-118 (g1_stdarg,\n+   g2_stdarg, g4_stdarg, g8_stdarg, g16_stdarg) because the overall alignment\n+   is > 16.  No warning expected.  */\n+\n+/* No change in parameter passing in GCC 9.1 for lines 120-124 (gp_stdarg,\n+   g1p_stdarg, g2p_stdarg, g4p_stdarg, g8p_stdarg), no warning expected.  */\n+\n+/* Changed in GCC 9.1, but we fail to emit a warning.  */\n+/* { dg-note {parameter passing for argument of type 'S16p' changed in GCC 9.1} \"\" { xfail *-*-* } 125 } g16p_stdarg */"}, {"sha": "cdb5b4df774102cd15ad3977d575a9e603073fcf", "filename": "gcc/testsuite/g++.target/aarch64/bitfield-abi-warning-align32-O2.C", "status": "added", "additions": 119, "deletions": 0, "changes": 119, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/3df1a115be22caeab3ffe7afb12e71adb54ff132/gcc%2Ftestsuite%2Fg%2B%2B.target%2Faarch64%2Fbitfield-abi-warning-align32-O2.C", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/3df1a115be22caeab3ffe7afb12e71adb54ff132/gcc%2Ftestsuite%2Fg%2B%2B.target%2Faarch64%2Fbitfield-abi-warning-align32-O2.C", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fg%2B%2B.target%2Faarch64%2Fbitfield-abi-warning-align32-O2.C?ref=3df1a115be22caeab3ffe7afb12e71adb54ff132", "patch": "@@ -0,0 +1,119 @@\n+/* { dg-do compile } */\n+/* { dg-options \"-O2 -save-temps -Wno-narrowing\" } */\n+\n+#define ALIGN 32\n+#define EXTRA\n+\n+#include \"bitfield-abi-warning.h\"\n+\n+/* In f1, f2, f4, f8, f16 (and stdarg versions):  */\n+/* { dg-final { scan-assembler-times \"ldr\\tx0, \\\\\\[x1\\\\\\]\" 10 } } */\n+\n+/* In fp, f1p, f2p, f4p, f8p (and stdarg versions):  */\n+/* { dg-final { scan-assembler-times \"and\\tw0, w1, 1\" 10 { xfail *-*-* } } } */\n+\n+/* In f16p (and stdarg version):  */\n+/* { dg-final { scan-assembler-times \"and\\tw0, w2, 1\" 2 { xfail *-*-* } } } */\n+\n+/* In f1_stack, f2_stack, f4_stack, f8_stack, f16_stack, f8p_stack:  */\n+/* { dg-final { scan-assembler-times \"ldr\\tx\\[0-9\\]+, \\\\\\[sp, 8\\\\\\]\" 6 { xfail *-*-* } } } */\n+\n+/* In fp_stack, f1p_stack:  */\n+/* { dg-final { scan-assembler-times \"ldrb\\tw0, \\\\\\[sp, 8\\\\\\]\" 2 { xfail *-*-* } } } */\n+\n+/* In f2p_stack:  */\n+/* { dg-final { scan-assembler-times \"ldrh\\tw0, \\\\\\[sp, 8\\\\\\]\" 1 { xfail *-*-* } } } */\n+\n+/* In f4p_stack:  */\n+/* { dg-final { scan-assembler-times \"ldr\\tw0, \\\\\\[sp, 8\\\\\\]\" 1 { xfail *-*-* } } } */\n+\n+/* In f16p_stack:  */\n+/* { dg-final { scan-assembler-times \"ldr\\tx0, \\\\\\[sp, 16\\\\\\]\" 1 { xfail *-*-* } } } */\n+\n+/* Bitfield parameter in registers.  */\n+/* No change in parameter passing in GCC 9.1 for lines 47-51 (f1, f2, f4, f8, f16)\n+   because the overall alignment is > 16.  No warning expected.  */\n+\n+/* No change in parameter passing in GCC 9.1 for lines 53-57 (fp, f1p, f2p,\n+   f4p, f8p) because the argument fits in a single register.  Should not warn,\n+   but aarch64_function_arg_boundary would need to take the argument size into\n+   account as well as whether it's passed via registers or the stack.  */\n+/* { dg-note {parameter passing for argument of type 'Sp' changed in GCC 9.1}  \"\" { target *-*-* } 53 } fp */\n+/* { dg-note {parameter passing for argument of type 'S1p' changed in GCC 9.1} \"\" { target *-*-* } 54 } f1p */\n+/* { dg-note {parameter passing for argument of type 'S2p' changed in GCC 9.1} \"\" { target *-*-* } 55 } f2p */\n+/* { dg-note {parameter passing for argument of type 'S4p' changed in GCC 9.1} \"\" { target *-*-* } 56 } f4p */\n+/* { dg-note {parameter passing for argument of type 'S8p' changed in GCC 9.1} \"\" { target *-*-* } 57 } f8p */\n+\n+/* Changed in GCC 9.1, but we fail to emit a warning since GCC 11 (was OK with GCC 9).  */\n+/* { dg-note {parameter passing for argument of type 'S16p' changed in GCC 9.1} \"\" { xfail *-*-* } 58 } f16p */\n+\n+\n+/* Bitfield call argument in registers.  */\n+/* No change in parameter passing in GCC 9.1 for lines 60-64 (g1, g2, g4, g8, g16)\n+   because the overall alignment is > 16.  No warning expected.  */\n+\n+/* No change in parameter passing in GCC 9.1 for lines 66-70 (gp, g1p, g2p,\n+   g4p, g8p), no warning expected.  */\n+\n+/* Changed in GCC 9.1, but we fail to emit a warning.  */\n+/* { dg-note {parameter passing for argument of type 'S16p' changed in GCC 9.1} \"\" { xfail *-*-* } 71 } g16p */\n+\n+\n+/* Bitfield parameter in stack.  */\n+/* No change in parameter passing in GCC 9.1 for lines 74-78 (f1_stack,\n+   f2_stack, f4_stack, f8_stack, f16_stack) because the overall alignment is >\n+   16.  No warning expected.  */\n+\n+/* { dg-note {parameter passing for argument of type 'Sp' changed in GCC 9.1}  \"\" { target *-*-* } 80 } fp_stack */\n+/* { dg-note {parameter passing for argument of type 'S1p' changed in GCC 9.1} \"\" { target *-*-* } 81 } f1p_stack */\n+/* { dg-note {parameter passing for argument of type 'S2p' changed in GCC 9.1} \"\" { target *-*-* } 82 } f2p_stack */\n+/* { dg-note {parameter passing for argument of type 'S4p' changed in GCC 9.1} \"\" { target *-*-* } 83 } f4p_stack */\n+/* { dg-note {parameter passing for argument of type 'S8p' changed in GCC 9.1} \"\" { target *-*-* } 84 } f8p_stack */\n+\n+/* No change in parameter passing in GCC 9.1 for line 85 (f16p_stack) because\n+   the overall alignment is >= 16.  No warning expected.  */\n+\n+/* Bitfield call argument in stack.  */\n+/* No change in parameter passing in GCC 9.1 for lines 87-91 (g1_stack,\n+   g2_stack, g4_stack, g8_stack, g16_stack) because the overall alignment is >\n+   16.  No warning expected.  */\n+\n+/* { dg-note {parameter passing for argument of type 'Sp' changed in GCC 9.1}  \"\" { target *-*-* } 93 } gp_stack */\n+/* { dg-note {parameter passing for argument of type 'S1p' changed in GCC 9.1} \"\" { target *-*-* } 94 } g1p_stack */\n+/* { dg-note {parameter passing for argument of type 'S2p' changed in GCC 9.1} \"\" { target *-*-* } 95 } g2p_stack */\n+/* { dg-note {parameter passing for argument of type 'S4p' changed in GCC 9.1} \"\" { target *-*-* } 96 } g4p_stack */\n+/* { dg-note {parameter passing for argument of type 'S8p' changed in GCC 9.1} \"\" { target *-*-* } 97 } g8p_stack */\n+\n+\n+/* No change in parameter passing in GCC 9.1 for line 98 (g16p_stack).  No\n+   warning expected.  */\n+\n+\n+/* Bitfield parameter in stdarg.  */\n+/* No change in parameter passing in GCC 9.1 for lines 101-105 (f1_stdarg,\n+   f2_stdarg, f4_stdarg, f8_stdarg, f16_stdarg) because the overall alignment\n+   is > 16.  No warning expected.  */\n+\n+/* Parameter passing for these should not have changed in GCC 9.1 (PR 105549).\n+   Fortunately we warn. Note the discrepancy with lines 120-124 below: we warn\n+   in the callee, but not in the caller.  */\n+/* { dg-note {parameter passing for argument of type 'Sp' changed in GCC 9.1}   \"\" { target *-*-* } 107 } fp_stdarg */\n+/* { dg-note {parameter passing for argument of type 'S1p' changed in GCC 9.1}  \"\" { target *-*-* } 108 } f1p_stdarg */\n+/* { dg-note {parameter passing for argument of type 'S2p' changed in GCC 9.1}  \"\" { target *-*-* } 109 } f2p_stdarg */\n+/* { dg-note {parameter passing for argument of type 'S4p' changed in GCC 9.1}  \"\" { target *-*-* } 110 } f4p_stdarg */\n+/* { dg-note {parameter passing for argument of type 'S8p' changed in GCC 9.1}  \"\" { target *-*-* } 111 } f8p_stdarg */\n+\n+/* No change in parameter passing in GCC 9.1 for line 112 (f16p_stdarg).\n+   Should not warn.  */\n+/* { dg-note {parameter passing for argument of type 'S16p' changed in GCC 9.1} \"\" { target *-*-* } 112 } f16p_stdarg */\n+\n+/* Bitfield call argument in stdarg.  */\n+/* No change in parameter passing in GCC 9.1 for lines 114-118 (g1_stdarg,\n+   g2_stdarg, g4_stdarg, g8_stdarg, g16_stdarg) because the overall alignment\n+   is > 16.  No warning expected.  */\n+\n+/* No change in parameter passing in GCC 9.1 for lines 120-124 (gp_stdarg,\n+   g1p_stdarg, g2p_stdarg, g4p_stdarg, g8p_stdarg), no warning expected.  */\n+\n+/* Changed in GCC 9.1, but we fail to emit a warning.  */\n+/* { dg-note {parameter passing for argument of type 'S16p' changed in GCC 9.1} \"\" { xfail *-*-* } 125 } g16p_stdarg */"}, {"sha": "b1764d97ea0d9335a5367dde110eae9f75ec058b", "filename": "gcc/testsuite/g++.target/aarch64/bitfield-abi-warning-align8-O2.C", "status": "added", "additions": 16, "deletions": 0, "changes": 16, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/3df1a115be22caeab3ffe7afb12e71adb54ff132/gcc%2Ftestsuite%2Fg%2B%2B.target%2Faarch64%2Fbitfield-abi-warning-align8-O2.C", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/3df1a115be22caeab3ffe7afb12e71adb54ff132/gcc%2Ftestsuite%2Fg%2B%2B.target%2Faarch64%2Fbitfield-abi-warning-align8-O2.C", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fg%2B%2B.target%2Faarch64%2Fbitfield-abi-warning-align8-O2.C?ref=3df1a115be22caeab3ffe7afb12e71adb54ff132", "patch": "@@ -0,0 +1,16 @@\n+/* { dg-do compile } */\n+/* { dg-options \"-O2 -save-temps -Wno-narrowing\" } */\n+\n+#define ALIGN 8\n+#define EXTRA\n+\n+#include \"bitfield-abi-warning.h\"\n+\n+/* In f1, f2, f4, f8, fp, f1p, f2p, f4p, f8p (and stdarg versions):  */\n+/* { dg-final { scan-assembler-times \"and\\tw0, w1, 1\" 18 } } */\n+\n+/* In f16, f16p (and stdarg versions):  */\n+/* { dg-final { scan-assembler-times \"and\\tw0, w2, 1\" 4 } } */\n+\n+/* In f1, f2, f4, f8, f16, fp, f1p, f2p, f4p, f8p, f16p stack versions:  */\n+/* { dg-final { scan-assembler-times \"and\\tw0, w0, 1\" 11 } } */"}, {"sha": "3940b714ef897b510c110d24123e9cd7b17e4e3b", "filename": "gcc/testsuite/g++.target/aarch64/bitfield-abi-warning.h", "status": "added", "additions": 125, "deletions": 0, "changes": 125, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/3df1a115be22caeab3ffe7afb12e71adb54ff132/gcc%2Ftestsuite%2Fg%2B%2B.target%2Faarch64%2Fbitfield-abi-warning.h", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/3df1a115be22caeab3ffe7afb12e71adb54ff132/gcc%2Ftestsuite%2Fg%2B%2B.target%2Faarch64%2Fbitfield-abi-warning.h", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fg%2B%2B.target%2Faarch64%2Fbitfield-abi-warning.h?ref=3df1a115be22caeab3ffe7afb12e71adb54ff132", "patch": "@@ -0,0 +1,125 @@\n+#include <stdarg.h>\n+\n+typedef unsigned long long ull __attribute__((aligned(ALIGN)));\n+\n+#ifndef EXTRA\n+#define EXTRA unsigned long long x;\n+#endif\n+\n+struct S1  { __attribute__((aligned(1))) ull i : 1; EXTRA };\n+struct S2  { __attribute__((aligned(2))) ull i : 1; EXTRA };\n+struct S4  { __attribute__((aligned(4))) ull i : 1; EXTRA };\n+struct S8  { __attribute__((aligned(8))) ull i : 1; EXTRA };\n+struct S16 { __attribute__((aligned(16))) ull i : 1; EXTRA };\n+\n+struct Sp   { ull i : 1; EXTRA }__attribute__((packed));\n+struct S1p  { __attribute__((packed, aligned(1))) ull i : 1; EXTRA };\n+struct S2p  { __attribute__((packed, aligned(2))) ull i : 1; EXTRA };\n+struct S4p  { __attribute__((packed, aligned(4))) ull i : 1; EXTRA };\n+struct S8p  { __attribute__((packed, aligned(8))) ull i : 1; EXTRA };\n+struct S16p { __attribute__((packed, aligned(16))) ull i : 1; EXTRA };\n+\n+/* Bitfield in registers.  */\n+#define PARAMS(xx) int a0, struct S##xx s, ull a1\n+/* Bitfield passed by the stack.  */\n+#define PARAMS_STACK(xx) int a0, ull a1, ull a2, ull a3, ull a4, ull a5, ull a6, ull a7, ull a8, struct S##xx t\n+/* Bitfield passed via stdarg.  */\n+#define PARAMS_STDARG(xx) int a0, ...\n+\n+#define CODE(xx)\t\t\t\t\\\n+  return s.i;\n+\n+#define CODE_STACK(xx)\t\t\t\t\\\n+  return t.i;\n+\n+#define CODE_STDARG(xx)\t\t\t\t\\\n+  va_list ap;\t\t\t\t\t\\\n+  struct S##xx arg;\t\t\t\t\\\n+  __builtin_va_start(ap,a0);\t\t\t\\\n+  arg = __builtin_va_arg(ap, struct S##xx);\t\\\n+  return arg.i;\n+\n+#define ARGS(xx) x, (struct S##xx) { x }, x\n+#define ARGS_STACK(xx) x, x, x, x, x, x, x, x, x, (struct S##xx) { x }\n+#define ARGS_STDARG(xx) x, (struct S##xx) { x }\n+\n+/* Bitfield in registers.  */\n+int __attribute__ ((noipa)) f1 (PARAMS(1))  { CODE(1) }\n+int __attribute__ ((noipa)) f2 (PARAMS(2))  { CODE(2) }\n+int __attribute__ ((noipa)) f4 (PARAMS(4))  { CODE(4) }\n+int __attribute__ ((noipa)) f8 (PARAMS(8))  { CODE(8) }\n+int __attribute__ ((noipa)) f16(PARAMS(16)) { CODE(16) }\n+\n+int __attribute__ ((noipa)) fp  (PARAMS(p))   { CODE(p) }\n+int __attribute__ ((noipa)) f1p (PARAMS(1p))  { CODE(1p) }\n+int __attribute__ ((noipa)) f2p (PARAMS(2p))  { CODE(2p) }\n+int __attribute__ ((noipa)) f4p (PARAMS(4p))  { CODE(4p) }\n+int __attribute__ ((noipa)) f8p (PARAMS(8p))  { CODE(8p) }\n+int __attribute__ ((noipa)) f16p(PARAMS(16p)) { CODE(16p) }\n+\n+int g1 (int x) { return f1 (ARGS(1)); }\n+int g2 (int x) { return f2 (ARGS(2)); }\n+int g4 (int x) { return f4 (ARGS(4)); }\n+int g8 (int x) { return f8 (ARGS(8)); }\n+int g16(int x) { return f16 (ARGS(16)); }\n+\n+int gp  (int x) { return fp   (ARGS(p)); }\n+int g1p (int x) { return f1p  (ARGS(1p)); }\n+int g2p (int x) { return f2p  (ARGS(2p)); }\n+int g4p (int x) { return f4p  (ARGS(4p)); }\n+int g8p (int x) { return f8p  (ARGS(8p)); }\n+int g16p(int x) { return f16p (ARGS(16p)); }\n+\n+/* Bitfield in the stack.  */\n+int __attribute__ ((noipa)) f1_stack (PARAMS_STACK(1))  { CODE_STACK(1) }\n+int __attribute__ ((noipa)) f2_stack (PARAMS_STACK(2))  { CODE_STACK(2) }\n+int __attribute__ ((noipa)) f4_stack (PARAMS_STACK(4))  { CODE_STACK(4) }\n+int __attribute__ ((noipa)) f8_stack (PARAMS_STACK(8))  { CODE_STACK(8) }\n+int __attribute__ ((noipa)) f16_stack(PARAMS_STACK(16)) { CODE_STACK(16) }\n+\n+int __attribute__ ((noipa)) fp_stack  (PARAMS_STACK(p))   { CODE_STACK(p) }\n+int __attribute__ ((noipa)) f1p_stack (PARAMS_STACK(1p))  { CODE_STACK(1p) }\n+int __attribute__ ((noipa)) f2p_stack (PARAMS_STACK(2p))  { CODE_STACK(2p) }\n+int __attribute__ ((noipa)) f4p_stack (PARAMS_STACK(4p))  { CODE_STACK(4p) }\n+int __attribute__ ((noipa)) f8p_stack (PARAMS_STACK(8p))  { CODE_STACK(8p) }\n+int __attribute__ ((noipa)) f16p_stack(PARAMS_STACK(16p)) { CODE_STACK(16p) }\n+\n+int g1_stack (int x) { return f1_stack (ARGS_STACK(1)); }\n+int g2_stack (int x) { return f2_stack (ARGS_STACK(2)); }\n+int g4_stack (int x) { return f4_stack (ARGS_STACK(4)); }\n+int g8_stack (int x) { return f8_stack (ARGS_STACK(8)); }\n+int g16_stack(int x) { return f16_stack (ARGS_STACK(16)); }\n+\n+int gp_stack  (int x) { return fp_stack (ARGS_STACK(p)); }\n+int g1p_stack (int x) { return f1p_stack (ARGS_STACK(1p)); }\n+int g2p_stack (int x) { return f2p_stack (ARGS_STACK(2p)); }\n+int g4p_stack (int x) { return f4p_stack (ARGS_STACK(4p)); }\n+int g8p_stack (int x) { return f8p_stack (ARGS_STACK(8p)); }\n+int g16p_stack(int x) { return f16p_stack (ARGS_STACK(16p)); }\n+\n+/* Bitfield  via stdarg.  */\n+int __attribute__ ((noipa)) f1_stdarg (PARAMS_STDARG(1))  { CODE_STDARG(1) }\n+int __attribute__ ((noipa)) f2_stdarg (PARAMS_STDARG(2))  { CODE_STDARG(2) }\n+int __attribute__ ((noipa)) f4_stdarg (PARAMS_STDARG(4))  { CODE_STDARG(4) }\n+int __attribute__ ((noipa)) f8_stdarg (PARAMS_STDARG(8))  { CODE_STDARG(8) }\n+int __attribute__ ((noipa)) f16_stdarg(PARAMS_STDARG(16)) { CODE_STDARG(16) }\n+\n+int __attribute__ ((noipa)) fp_stdarg  (PARAMS_STDARG(p))   { CODE_STDARG(p) }\n+int __attribute__ ((noipa)) f1p_stdarg (PARAMS_STDARG(1p))  { CODE_STDARG(1p) }\n+int __attribute__ ((noipa)) f2p_stdarg (PARAMS_STDARG(2p))  { CODE_STDARG(2p) }\n+int __attribute__ ((noipa)) f4p_stdarg (PARAMS_STDARG(4p))  { CODE_STDARG(4p) }\n+int __attribute__ ((noipa)) f8p_stdarg (PARAMS_STDARG(8p))  { CODE_STDARG(8p) }\n+int __attribute__ ((noipa)) f16p_stdarg(PARAMS_STDARG(16p)) { CODE_STDARG(16p) }\n+\n+int g1_stdarg (int x) { return f1_stdarg (ARGS_STDARG(1)); }\n+int g2_stdarg (int x) { return f2_stdarg (ARGS_STDARG(2)); }\n+int g4_stdarg (int x) { return f4_stdarg (ARGS_STDARG(4)); }\n+int g8_stdarg (int x) { return f8_stdarg (ARGS_STDARG(8)); }\n+int g16_stdarg(int x) { return f16_stdarg (ARGS_STDARG(16)); }\n+\n+int gp_stdarg  (int x) { return fp_stdarg (ARGS_STDARG(p)); }\n+int g1p_stdarg (int x) { return f1p_stdarg (ARGS_STDARG(1p)); }\n+int g2p_stdarg (int x) { return f2p_stdarg (ARGS_STDARG(2p)); }\n+int g4p_stdarg (int x) { return f4p_stdarg (ARGS_STDARG(4p)); }\n+int g8p_stdarg (int x) { return f8p_stdarg (ARGS_STDARG(8p)); }\n+int g16p_stdarg(int x) { return f16p_stdarg (ARGS_STDARG(16p)); }"}, {"sha": "3e38cac149d2426956a1f41c015fe8d35f46d456", "filename": "gcc/testsuite/gcc.target/aarch64/bitfield-abi-warning-align16-O2-extra.c", "status": "added", "additions": 86, "deletions": 0, "changes": 86, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/3df1a115be22caeab3ffe7afb12e71adb54ff132/gcc%2Ftestsuite%2Fgcc.target%2Faarch64%2Fbitfield-abi-warning-align16-O2-extra.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/3df1a115be22caeab3ffe7afb12e71adb54ff132/gcc%2Ftestsuite%2Fgcc.target%2Faarch64%2Fbitfield-abi-warning-align16-O2-extra.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgcc.target%2Faarch64%2Fbitfield-abi-warning-align16-O2-extra.c?ref=3df1a115be22caeab3ffe7afb12e71adb54ff132", "patch": "@@ -0,0 +1,86 @@\n+/* { dg-do compile } */\n+/* { dg-options \"-O2 -save-temps\" } */\n+\n+#define ALIGN 16\n+//#define EXTRA\n+\n+#include \"bitfield-abi-warning.h\"\n+\n+/* In f1, f2, f4, f8, f16, f16p (and stdarg versions):  */\n+/* { dg-final { scan-assembler-times \"and\\tw0, w2, 1\" 12 { xfail *-*-* } } } */\n+/* In fp, f1p, f2p, f4p, f8p (and stdarg versions):  */\n+/* { dg-final { scan-assembler-times \"and\\tw0, w1, 1\" 10 { xfail *-*-* } } } */\n+\n+/* Bitfield parameter in registers.  */\n+/* { dg-note {parameter passing for argument of type 'struct S1' changed in GCC 9.1} \"\" { target *-*-* } 47 } f1 */\n+/* { dg-note {parameter passing for argument of type 'struct S2' changed in GCC 9.1} \"\" { target *-*-* } 48 } f2 */\n+/* { dg-note {parameter passing for argument of type 'struct S4' changed in GCC 9.1} \"\" { target *-*-* } 49 } f4 */\n+/* { dg-note {parameter passing for argument of type 'struct S8' changed in GCC 9.1} \"\" { target *-*-* } 50 } f8 */\n+\n+/* { dg-note {parameter passing for argument of type 'struct Sp' changed in GCC 9.1} \"\" { target *-*-* } 53 }  fp */\n+/* { dg-note {parameter passing for argument of type 'struct S1p' changed in GCC 9.1} \"\" { target *-*-* } 54 } f1p */\n+/* { dg-note {parameter passing for argument of type 'struct S2p' changed in GCC 9.1} \"\" { target *-*-* } 55 } f2p */\n+/* { dg-note {parameter passing for argument of type 'struct S4p' changed in GCC 9.1} \"\" { target *-*-* } 56 } f4p */\n+/* { dg-note {parameter passing for argument of type 'struct S8p' changed in GCC 9.1} \"\" { target *-*-* } 57 } f8p */\n+\n+/* Bitfield call argument in registers.  */\n+/* { dg-note {parameter passing for argument of type 'struct S1' changed in GCC 9.1} \"\"  { target *-*-* } 60 } g1 */\n+/* { dg-note {parameter passing for argument of type 'struct S2' changed in GCC 9.1} \"\"  { target *-*-* } 61 } g2 */\n+/* { dg-note {parameter passing for argument of type 'struct S4' changed in GCC 9.1} \"\"  { target *-*-* } 62 } g4 */\n+/* { dg-note {parameter passing for argument of type 'struct S8' changed in GCC 9.1} \"\"  { target *-*-* } 63 } g8 */\n+\n+/* { dg-note {parameter passing for argument of type 'struct Sp' changed in GCC 9.1} \"\" { target *-*-* } 66 }  gp */\n+/* { dg-note {parameter passing for argument of type 'struct S1p' changed in GCC 9.1} \"\" { target *-*-* } 67 } g1p */\n+/* { dg-note {parameter passing for argument of type 'struct S2p' changed in GCC 9.1} \"\" { target *-*-* } 68 } g2p */\n+/* { dg-note {parameter passing for argument of type 'struct S4p' changed in GCC 9.1} \"\" { target *-*-* } 69 } g4p */\n+/* { dg-note {parameter passing for argument of type 'struct S8p' changed in GCC 9.1} \"\" { target *-*-* } 70 } g8p */\n+\n+\n+/* Bitfield parameter in stack.  */\n+/* { dg-note {parameter passing for argument of type 'struct S1' changed in GCC 9.1} \"\" { target *-*-* } 74 } f1_stack */\n+/* { dg-note {parameter passing for argument of type 'struct S2' changed in GCC 9.1} \"\" { target *-*-* } 75 } f2_stack */\n+/* { dg-note {parameter passing for argument of type 'struct S4' changed in GCC 9.1} \"\" { target *-*-* } 76 } f4_stack */\n+/* { dg-note {parameter passing for argument of type 'struct S8' changed in GCC 9.1} \"\" { target *-*-* } 77 } f8_stack */\n+\n+/* { dg-note {parameter passing for argument of type 'struct Sp' changed in GCC 9.1} \"\" { target *-*-* } 80 }  fp_stack */\n+/* { dg-note {parameter passing for argument of type 'struct S1p' changed in GCC 9.1} \"\" { target *-*-* } 81 } f1p_stack */\n+/* { dg-note {parameter passing for argument of type 'struct S2p' changed in GCC 9.1} \"\" { target *-*-* } 82 } f2p_stack */\n+/* { dg-note {parameter passing for argument of type 'struct S4p' changed in GCC 9.1} \"\" { target *-*-* } 83 } f4p_stack */\n+/* { dg-note {parameter passing for argument of type 'struct S8p' changed in GCC 9.1} \"\" { target *-*-* } 84 } f8p_stack */\n+\n+/* Bitfield call argument in stack.  */\n+/* { dg-note {parameter passing for argument of type 'struct S1' changed in GCC 9.1} \"\"  { target *-*-* } 87 } g1_stack */\n+/* { dg-note {parameter passing for argument of type 'struct S2' changed in GCC 9.1} \"\"  { target *-*-* } 88 } g2_stack */\n+/* { dg-note {parameter passing for argument of type 'struct S4' changed in GCC 9.1} \"\"  { target *-*-* } 89 } g4_stack */\n+/* { dg-note {parameter passing for argument of type 'struct S8' changed in GCC 9.1} \"\"  { target *-*-* } 90 } g8_stack */\n+\n+/* { dg-note {parameter passing for argument of type 'struct Sp' changed in GCC 9.1} \"\" { target *-*-* } 93 }  gp_stack */\n+/* { dg-note {parameter passing for argument of type 'struct S1p' changed in GCC 9.1} \"\" { target *-*-* } 94 } g1p_stack */\n+/* { dg-note {parameter passing for argument of type 'struct S2p' changed in GCC 9.1} \"\" { target *-*-* } 95 } g2p_stack */\n+/* { dg-note {parameter passing for argument of type 'struct S4p' changed in GCC 9.1} \"\" { target *-*-* } 96 } g4p_stack */\n+/* { dg-note {parameter passing for argument of type 'struct S8p' changed in GCC 9.1} \"\" { target *-*-* } 97 } g8p_stack */\n+\n+\n+/* Bitfield parameter in stdarg.  */\n+/* { dg-note {parameter passing for argument of type 'struct S1' changed in GCC 9.1} \"\" { target *-*-* } 101 } f1_stdarg */\n+/* { dg-note {parameter passing for argument of type 'struct S2' changed in GCC 9.1} \"\" { target *-*-* } 102 } f2_stdarg */\n+/* { dg-note {parameter passing for argument of type 'struct S4' changed in GCC 9.1} \"\" { target *-*-* } 103 } f4_stdarg */\n+/* { dg-note {parameter passing for argument of type 'struct S8' changed in GCC 9.1} \"\" { target *-*-* } 104 } f8_stdarg */\n+\n+/* { dg-note {parameter passing for argument of type 'struct Sp' changed in GCC 9.1} \"\" { target *-*-* } 107 }  fp_stdarg */\n+/* { dg-note {parameter passing for argument of type 'struct S1p' changed in GCC 9.1} \"\" { target *-*-* } 108 } f1p_stdarg */\n+/* { dg-note {parameter passing for argument of type 'struct S2p' changed in GCC 9.1} \"\" { target *-*-* } 109 } f2p_stdarg */\n+/* { dg-note {parameter passing for argument of type 'struct S4p' changed in GCC 9.1} \"\" { target *-*-* } 110 } f4p_stdarg */\n+/* { dg-note {parameter passing for argument of type 'struct S8p' changed in GCC 9.1} \"\" { target *-*-* } 111 } f8p_stdarg */\n+\n+/* Bitfield call argument in stdarg.  */\n+/* { dg-note {parameter passing for argument of type 'struct S1' changed in GCC 9.1} \"\"  { target *-*-* } 114 } g1_stdarg */\n+/* { dg-note {parameter passing for argument of type 'struct S2' changed in GCC 9.1} \"\"  { target *-*-* } 115 } g2_stdarg */\n+/* { dg-note {parameter passing for argument of type 'struct S4' changed in GCC 9.1} \"\"  { target *-*-* } 116 } g4_stdarg */\n+/* { dg-note {parameter passing for argument of type 'struct S8' changed in GCC 9.1} \"\"  { target *-*-* } 117 } g8_stdarg */\n+\n+/* { dg-note {parameter passing for argument of type 'struct Sp' changed in GCC 9.1} \"\" { target *-*-* } 120 }  gp_stdarg */\n+/* { dg-note {parameter passing for argument of type 'struct S1p' changed in GCC 9.1} \"\" { target *-*-* } 121 } g1p_stdarg */\n+/* { dg-note {parameter passing for argument of type 'struct S2p' changed in GCC 9.1} \"\" { target *-*-* } 122 } g2p_stdarg */\n+/* { dg-note {parameter passing for argument of type 'struct S4p' changed in GCC 9.1} \"\" { target *-*-* } 123 } g4p_stdarg */\n+/* { dg-note {parameter passing for argument of type 'struct S8p' changed in GCC 9.1} \"\" { target *-*-* } 124 } g8p_stdarg */"}, {"sha": "39c5f9228ee5263d0ae2952ae7d076d660ff2915", "filename": "gcc/testsuite/gcc.target/aarch64/bitfield-abi-warning-align16-O2.c", "status": "added", "additions": 87, "deletions": 0, "changes": 87, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/3df1a115be22caeab3ffe7afb12e71adb54ff132/gcc%2Ftestsuite%2Fgcc.target%2Faarch64%2Fbitfield-abi-warning-align16-O2.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/3df1a115be22caeab3ffe7afb12e71adb54ff132/gcc%2Ftestsuite%2Fgcc.target%2Faarch64%2Fbitfield-abi-warning-align16-O2.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgcc.target%2Faarch64%2Fbitfield-abi-warning-align16-O2.c?ref=3df1a115be22caeab3ffe7afb12e71adb54ff132", "patch": "@@ -0,0 +1,87 @@\n+/* { dg-do compile } */\n+/* { dg-options \"-O2 -save-temps\" } */\n+\n+#define ALIGN 16\n+#define EXTRA\n+\n+#include \"bitfield-abi-warning.h\"\n+\n+/* In f1, f2, f4, f8, f16, f16p (and stdarg versions):  */\n+/* { dg-final { scan-assembler-times \"and\\tw0, w2, 1\" 12 { xfail *-*-* } } } */\n+/* In fp, f1p, f2p, f4p, f8p (and stdarg versions):  */\n+/* { dg-final { scan-assembler-times \"and\\tw0, w1, 1\" 10 { xfail *-*-* } } } */\n+\n+/* Bitfield parameter in registers.  */\n+/* { dg-note {parameter passing for argument of type 'struct S1' changed in GCC 9.1} \"\" { target *-*-* } 47 } f1 */\n+/* { dg-note {parameter passing for argument of type 'struct S2' changed in GCC 9.1} \"\" { target *-*-* } 48 } f2 */\n+/* { dg-note {parameter passing for argument of type 'struct S4' changed in GCC 9.1} \"\" { target *-*-* } 49 } f4 */\n+/* { dg-note {parameter passing for argument of type 'struct S8' changed in GCC 9.1} \"\" { target *-*-* } 50 } f8 */\n+\n+/* No change in parameter passing in GCC 9.1 for lines 53-57 (fp, f1p, f2p,\n+   f4p, f8p) (because the argument fits in a single register).  Should not\n+   warn, but aarch64_function_arg_boundary would need to take the argument size\n+   into account as well as whether it's passed via registers or the stack.  */\n+/* { dg-note {parameter passing for argument of type 'struct Sp' changed in GCC 9.1} \"\" { target *-*-* } 53 }  fp */\n+/* { dg-note {parameter passing for argument of type 'struct S1p' changed in GCC 9.1} \"\" { target *-*-* } 54 } f1p */\n+/* { dg-note {parameter passing for argument of type 'struct S2p' changed in GCC 9.1} \"\" { target *-*-* } 55 } f2p */\n+/* { dg-note {parameter passing for argument of type 'struct S4p' changed in GCC 9.1} \"\" { target *-*-* } 56 } f4p */\n+/* { dg-note {parameter passing for argument of type 'struct S8p' changed in GCC 9.1} \"\" { target *-*-* } 57 } f8p */\n+\n+/* Bitfield call argument in registers.  */\n+/* { dg-note {parameter passing for argument of type 'struct S1' changed in GCC 9.1} \"\"  { target *-*-* } 60 } g1 */\n+/* { dg-note {parameter passing for argument of type 'struct S2' changed in GCC 9.1} \"\"  { target *-*-* } 61 } g2 */\n+/* { dg-note {parameter passing for argument of type 'struct S4' changed in GCC 9.1} \"\"  { target *-*-* } 62 } g4 */\n+/* { dg-note {parameter passing for argument of type 'struct S8' changed in GCC 9.1} \"\"  { target *-*-* } 63 } g8 */\n+\n+/* No change in parameter passing in GCC 9.1 for lines 66-70 (gp, g1p, g2p,\n+   g4p, g8p), no warning expected.  */\n+\n+\n+/* Bitfield parameter in stack.  */\n+/* { dg-note {parameter passing for argument of type 'struct S1' changed in GCC 9.1} \"\" { target *-*-* } 74 } f1_stack */\n+/* { dg-note {parameter passing for argument of type 'struct S2' changed in GCC 9.1} \"\" { target *-*-* } 75 } f2_stack */\n+/* { dg-note {parameter passing for argument of type 'struct S4' changed in GCC 9.1} \"\" { target *-*-* } 76 } f4_stack */\n+/* { dg-note {parameter passing for argument of type 'struct S8' changed in GCC 9.1} \"\" { target *-*-* } 77 } f8_stack */\n+\n+/* { dg-note {parameter passing for argument of type 'struct Sp' changed in GCC 9.1} \"\" { target *-*-* } 80 }  fp_stack */\n+/* { dg-note {parameter passing for argument of type 'struct S1p' changed in GCC 9.1} \"\" { target *-*-* } 81 } f1p_stack */\n+/* { dg-note {parameter passing for argument of type 'struct S2p' changed in GCC 9.1} \"\" { target *-*-* } 82 } f2p_stack */\n+/* { dg-note {parameter passing for argument of type 'struct S4p' changed in GCC 9.1} \"\" { target *-*-* } 83 } f4p_stack */\n+/* { dg-note {parameter passing for argument of type 'struct S8p' changed in GCC 9.1} \"\" { target *-*-* } 84 } f8p_stack */\n+\n+/* Bitfield call argument in stack.  */\n+/* { dg-note {parameter passing for argument of type 'struct S1' changed in GCC 9.1} \"\"  { target *-*-* } 87 } g1_stack */\n+/* { dg-note {parameter passing for argument of type 'struct S2' changed in GCC 9.1} \"\"  { target *-*-* } 88 } g2_stack */\n+/* { dg-note {parameter passing for argument of type 'struct S4' changed in GCC 9.1} \"\"  { target *-*-* } 89 } g4_stack */\n+/* { dg-note {parameter passing for argument of type 'struct S8' changed in GCC 9.1} \"\"  { target *-*-* } 90 } g8_stack */\n+\n+/* { dg-note {parameter passing for argument of type 'struct Sp' changed in GCC 9.1} \"\" { target *-*-* } 93 }  gp_stack */\n+/* { dg-note {parameter passing for argument of type 'struct S1p' changed in GCC 9.1} \"\" { target *-*-* } 94 } g1p_stack */\n+/* { dg-note {parameter passing for argument of type 'struct S2p' changed in GCC 9.1} \"\" { target *-*-* } 95 } g2p_stack */\n+/* { dg-note {parameter passing for argument of type 'struct S4p' changed in GCC 9.1} \"\" { target *-*-* } 96 } g4p_stack */\n+/* { dg-note {parameter passing for argument of type 'struct S8p' changed in GCC 9.1} \"\" { target *-*-* } 97 } g8p_stack */\n+\n+\n+/* Bitfield parameter in stdarg.  */\n+/* { dg-note {parameter passing for argument of type 'struct S1' changed in GCC 9.1} \"\" { target *-*-* } 101 } f1_stdarg */\n+/* { dg-note {parameter passing for argument of type 'struct S2' changed in GCC 9.1} \"\" { target *-*-* } 102 } f2_stdarg */\n+/* { dg-note {parameter passing for argument of type 'struct S4' changed in GCC 9.1} \"\" { target *-*-* } 103 } f4_stdarg */\n+/* { dg-note {parameter passing for argument of type 'struct S8' changed in GCC 9.1} \"\" { target *-*-* } 104 } f8_stdarg */\n+\n+/* Parameter passing for these should not have changed in GCC 9.1 (PR 105549).\n+   Fortunately we warn. Note the discrepancy with lines 120-124 below: we warn\n+   in the callee, but not in the caller.  */\n+/* { dg-note {parameter passing for argument of type 'struct Sp' changed in GCC 9.1} \"\" { target *-*-* } 107 }  fp_stdarg */\n+/* { dg-note {parameter passing for argument of type 'struct S1p' changed in GCC 9.1} \"\" { target *-*-* } 108 } f1p_stdarg */\n+/* { dg-note {parameter passing for argument of type 'struct S2p' changed in GCC 9.1} \"\" { target *-*-* } 109 } f2p_stdarg */\n+/* { dg-note {parameter passing for argument of type 'struct S4p' changed in GCC 9.1} \"\" { target *-*-* } 110 } f4p_stdarg */\n+/* { dg-note {parameter passing for argument of type 'struct S8p' changed in GCC 9.1} \"\" { target *-*-* } 111 } f8p_stdarg */\n+\n+/* Bitfield call argument in stdarg.  */\n+/* { dg-note {parameter passing for argument of type 'struct S1' changed in GCC 9.1} \"\"  { target *-*-* } 114 } g1_stdarg */\n+/* { dg-note {parameter passing for argument of type 'struct S2' changed in GCC 9.1} \"\"  { target *-*-* } 115 } g2_stdarg */\n+/* { dg-note {parameter passing for argument of type 'struct S4' changed in GCC 9.1} \"\"  { target *-*-* } 116 } g4_stdarg */\n+/* { dg-note {parameter passing for argument of type 'struct S8' changed in GCC 9.1} \"\"  { target *-*-* } 117 } g8_stdarg */\n+\n+/* No change in parameter passing in GCC 9.1 for lines 120-124 (gp_stdarg\n+   g1p_stdarg, g2p_stdarg, g4p_stdarg, g8p_stdarg), no warning expected.  */"}, {"sha": "70671ceda0914142f175a593c12eed2f4cd24c72", "filename": "gcc/testsuite/gcc.target/aarch64/bitfield-abi-warning-align32-O2-extra.c", "status": "added", "additions": 119, "deletions": 0, "changes": 119, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/3df1a115be22caeab3ffe7afb12e71adb54ff132/gcc%2Ftestsuite%2Fgcc.target%2Faarch64%2Fbitfield-abi-warning-align32-O2-extra.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/3df1a115be22caeab3ffe7afb12e71adb54ff132/gcc%2Ftestsuite%2Fgcc.target%2Faarch64%2Fbitfield-abi-warning-align32-O2-extra.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgcc.target%2Faarch64%2Fbitfield-abi-warning-align32-O2-extra.c?ref=3df1a115be22caeab3ffe7afb12e71adb54ff132", "patch": "@@ -0,0 +1,119 @@\n+/* { dg-do compile } */\n+/* { dg-options \"-O2 -save-temps\" } */\n+\n+#define ALIGN 32\n+//#define EXTRA\n+\n+#include \"bitfield-abi-warning.h\"\n+\n+\n+/* In f1, f2, f4, f8, f16 (and stdarg versions):  */\n+/* { dg-final { scan-assembler-times \"ldr\\tx0, \\\\\\[x1\\\\\\]\" 10 } } */\n+\n+/* In fp, f1p, f2p, f4p, f8p (and stdarg versions):  */\n+/* { dg-final { scan-assembler-times \"and\\tw0, w1, 1\" 10 { xfail *-*-* } } } */\n+\n+/* In f16p (and stdarg version):  */\n+/* { dg-final { scan-assembler-times \"and\\tw0, w2, 1\" 2 { xfail *-*-* } } } */\n+\n+/* In f1_stack, f2_stack, f4_stack, f8_stack, f16_stack, f8p_stack:  */\n+/* { dg-final { scan-assembler-times \"ldr\\tx\\[0-9\\]+, \\\\\\[sp, 8\\\\\\]\" 6 { xfail *-*-* } } } */\n+\n+/* In fp_stack, f1p_stack:  */\n+/* { dg-final { scan-assembler-times \"ldrb\\tw0, \\\\\\[sp, 8\\\\\\]\" 2 { xfail *-*-* } } } */\n+\n+/* In f2p_stack:  */\n+/* { dg-final { scan-assembler-times \"ldrh\\tw0, \\\\\\[sp, 8\\\\\\]\" 1 { xfail *-*-* } } } */\n+\n+/* In f4p_stack:  */\n+/* { dg-final { scan-assembler-times \"ldr\\tw0, \\\\\\[sp, 8\\\\\\]\" 1 { xfail *-*-* } } } */\n+\n+/* In f16p_stack:  */\n+/* { dg-final { scan-assembler-times \"ldr\\tx0, \\\\\\[sp, 16\\\\\\]\" 1 { xfail *-*-* } } } */\n+\n+/* Bitfield parameter in registers.  */\n+/* No change in parameter passing in GCC 9.1 for lines 47-51 (f1, f2, f4, f8, f16)\n+   because the overall alignment is > 16.  No warning expected.  */\n+\n+/* No change in parameter passing in GCC 9.1 for lines 53-57 (fp, f1p, f2p,\n+   f4p, f8p) because the argument fits in a single register.  Should not warn,\n+   but aarch64_function_arg_boundary would need to take the argument size into\n+   account as well as whether it's passed via registers or the stack.  */\n+/* { dg-note {parameter passing for argument of type 'struct Sp' changed in GCC 9.1}  \"\" { target *-*-* } 53 } fp */\n+/* { dg-note {parameter passing for argument of type 'struct S1p' changed in GCC 9.1} \"\" { target *-*-* } 54 } f1p */\n+/* { dg-note {parameter passing for argument of type 'struct S2p' changed in GCC 9.1} \"\" { target *-*-* } 55 } f2p */\n+/* { dg-note {parameter passing for argument of type 'struct S4p' changed in GCC 9.1} \"\" { target *-*-* } 56 } f4p */\n+/* { dg-note {parameter passing for argument of type 'struct S8p' changed in GCC 9.1} \"\" { target *-*-* } 57 } f8p */\n+\n+/* Changed in GCC 9.1, but we fail to emit a warning since GCC 11 (was OK with GCC 9).  */\n+/* { dg-note {parameter passing for argument of type 'struct S16p' changed in GCC 9.1} \"\" { xfail *-*-* } 58 } f16p */\n+\n+\n+/* Bitfield call argument in registers.  */\n+/* No change in parameter passing in GCC 9.1 for lines 60-64 (g1, g2, g4, g8, g16)\n+   because the overall alignment is > 16.  No warning expected.  */\n+\n+/* No change in parameter passing in GCC 9.1 for lines 66-70 (gp, g1p, g2p,\n+   g4p, g8p), no warning expected.  */\n+\n+/* Changed in GCC 9.1, but we fail to emit a warning.  */\n+/* { dg-note {parameter passing for argument of type 'struct S16p' changed in GCC 9.1} \"\" { xfail *-*-* } 71 } g16p */\n+\n+\n+/* Bitfield parameter in stack.  */\n+/* No change in parameter passing in GCC 9.1 for lines 74-78 (f1_stack,\n+   f2_stack, f4_stack, f8_stack, f16_stack) because the overall alignment is >\n+   16.  No warning expected.  */\n+\n+/* Changed in GCC 9.1.  */\n+/* { dg-note {parameter passing for argument of type 'struct Sp' changed in GCC 9.1}  \"\" { target *-*-* } 80 } fp_stack */\n+/* { dg-note {parameter passing for argument of type 'struct S1p' changed in GCC 9.1} \"\" { target *-*-* } 81 } f1p_stack */\n+/* { dg-note {parameter passing for argument of type 'struct S2p' changed in GCC 9.1} \"\" { target *-*-* } 82 } f2p_stack */\n+/* { dg-note {parameter passing for argument of type 'struct S4p' changed in GCC 9.1} \"\" { target *-*-* } 83 } f4p_stack */\n+/* { dg-note {parameter passing for argument of type 'struct S8p' changed in GCC 9.1} \"\" { target *-*-* } 84 } f8p_stack */\n+\n+/* No change in parameter passing in GCC 9.1 for line 85 (f16p_stack) because\n+   the overall alignment is >= 16.  No warning expected.  */\n+\n+\n+/* Bitfield call argument in stack.  */\n+/* No change in parameter passing in GCC 9.1 for lines 87-91 (g1_stack,\n+   g2_stack, g4_stack, g8_stack, g16_stack) because the overall alignment is >\n+   16.  No warning expected.  */\n+\n+/* { dg-note {parameter passing for argument of type 'struct Sp' changed in GCC 9.1}  \"\" { target *-*-* } 93 } gp_stack */\n+/* { dg-note {parameter passing for argument of type 'struct S1p' changed in GCC 9.1} \"\" { target *-*-* } 94 } g1p_stack */\n+/* { dg-note {parameter passing for argument of type 'struct S2p' changed in GCC 9.1} \"\" { target *-*-* } 95 } g2p_stack */\n+/* { dg-note {parameter passing for argument of type 'struct S4p' changed in GCC 9.1} \"\" { target *-*-* } 96 } g4p_stack */\n+/* { dg-note {parameter passing for argument of type 'struct S8p' changed in GCC 9.1} \"\" { target *-*-* } 97 } g8p_stack */\n+\n+\n+/* No change in parameter passing in GCC 9.1 for line 98 (g16p_stack).  No\n+   warning expected.  */\n+\n+\n+/* Bitfield parameter in stdarg.  */\n+/* No change in parameter passing in GCC 9.1 for lines 101-105 (f1_stdarg,\n+   f2_stdarg, f4_stdarg, f8_stdarg, f16_stdarg) because the overall alignment\n+   is > 16.  No warning expected.  */\n+\n+/* { dg-note {parameter passing for argument of type 'struct Sp' changed in GCC 9.1}   \"\" { target *-*-* } 107 } fp_stdarg */\n+/* { dg-note {parameter passing for argument of type 'struct S1p' changed in GCC 9.1}  \"\" { target *-*-* } 108 } f1p_stdarg */\n+/* { dg-note {parameter passing for argument of type 'struct S2p' changed in GCC 9.1}  \"\" { target *-*-* } 109 } f2p_stdarg */\n+/* { dg-note {parameter passing for argument of type 'struct S4p' changed in GCC 9.1}  \"\" { target *-*-* } 110 } f4p_stdarg */\n+/* { dg-note {parameter passing for argument of type 'struct S8p' changed in GCC 9.1}  \"\" { target *-*-* } 111 } f8p_stdarg */\n+\n+/* No change in parameter passing in GCC 9.1 for line 112 (f16p_stdarg).\n+   Should not warn.  */\n+/* { dg-note {parameter passing for argument of type 'struct S16p' changed in GCC 9.1} \"\" { target *-*-* } 112 } f16p_stdarg */\n+\n+/* Bitfield call argument in stdarg.  */\n+/* No change in parameter passing in GCC 9.1 for lines 114-118 (g1_stdarg,\n+   g2_stdarg, g4_stdarg, g8_stdarg, g16_stdarg) because the overall alignment\n+   is > 16.  No warning expected.  */\n+\n+/* No change in parameter passing in GCC 9.1 for lines 120-124 (gp_stdarg,\n+   g1p_stdarg, g2p_stdarg, g4p_stdarg, g8p_stdarg), no warning expected.  */\n+\n+/* Changed in GCC 9.1, but we fail to emit a warning.  */\n+/* { dg-note {parameter passing for argument of type 'struct S16p' changed in GCC 9.1} \"\" { xfail *-*-* } 125 } g16p_stdarg */"}, {"sha": "757a2f1543c3baa3c8db3d25e5449cb6e443ffce", "filename": "gcc/testsuite/gcc.target/aarch64/bitfield-abi-warning-align32-O2.c", "status": "added", "additions": 119, "deletions": 0, "changes": 119, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/3df1a115be22caeab3ffe7afb12e71adb54ff132/gcc%2Ftestsuite%2Fgcc.target%2Faarch64%2Fbitfield-abi-warning-align32-O2.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/3df1a115be22caeab3ffe7afb12e71adb54ff132/gcc%2Ftestsuite%2Fgcc.target%2Faarch64%2Fbitfield-abi-warning-align32-O2.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgcc.target%2Faarch64%2Fbitfield-abi-warning-align32-O2.c?ref=3df1a115be22caeab3ffe7afb12e71adb54ff132", "patch": "@@ -0,0 +1,119 @@\n+/* { dg-do compile } */\n+/* { dg-options \"-O2 -save-temps\" } */\n+\n+#define ALIGN 32\n+#define EXTRA\n+\n+#include \"bitfield-abi-warning.h\"\n+\n+/* In f1, f2, f4, f8, f16 (and stdarg versions):  */\n+/* { dg-final { scan-assembler-times \"ldr\\tx0, \\\\\\[x1\\\\\\]\" 10 } } */\n+\n+/* In fp, f1p, f2p, f4p, f8p (and stdarg versions):  */\n+/* { dg-final { scan-assembler-times \"and\\tw0, w1, 1\" 10 { xfail *-*-* } } } */\n+\n+/* In f16p (and stdarg version):  */\n+/* { dg-final { scan-assembler-times \"and\\tw0, w2, 1\" 2 { xfail *-*-* } } } */\n+\n+/* In f1_stack, f2_stack, f4_stack, f8_stack, f16_stack, f8p_stack:  */\n+/* { dg-final { scan-assembler-times \"ldr\\tx\\[0-9\\]+, \\\\\\[sp, 8\\\\\\]\" 6 { xfail *-*-* } } } */\n+\n+/* In fp_stack, f1p_stack:  */\n+/* { dg-final { scan-assembler-times \"ldrb\\tw0, \\\\\\[sp, 8\\\\\\]\" 2 { xfail *-*-* } } } */\n+\n+/* In f2p_stack:  */\n+/* { dg-final { scan-assembler-times \"ldrh\\tw0, \\\\\\[sp, 8\\\\\\]\" 1 { xfail *-*-* } } } */\n+\n+/* In f4p_stack:  */\n+/* { dg-final { scan-assembler-times \"ldr\\tw0, \\\\\\[sp, 8\\\\\\]\" 1 { xfail *-*-* } } } */\n+\n+/* In f16p_stack:  */\n+/* { dg-final { scan-assembler-times \"ldr\\tx0, \\\\\\[sp, 16\\\\\\]\" 1 { xfail *-*-* } } } */\n+\n+/* Bitfield parameter in registers.  */\n+/* No change in parameter passing in GCC 9.1 for lines 47-51 (f1, f2, f4, f8, f16)\n+   because the overall alignment is > 16.  No warning expected.  */\n+\n+/* No change in parameter passing in GCC 9.1 for lines 53-57 (fp, f1p, f2p,\n+   f4p, f8p) because the argument fits in a single register.  Should not warn,\n+   but aarch64_function_arg_boundary would need to take the argument size into\n+   account as well as whether it's passed via registers or the stack.  */\n+/* { dg-note {parameter passing for argument of type 'struct Sp' changed in GCC 9.1}  \"\" { target *-*-* } 53 } fp */\n+/* { dg-note {parameter passing for argument of type 'struct S1p' changed in GCC 9.1} \"\" { target *-*-* } 54 } f1p */\n+/* { dg-note {parameter passing for argument of type 'struct S2p' changed in GCC 9.1} \"\" { target *-*-* } 55 } f2p */\n+/* { dg-note {parameter passing for argument of type 'struct S4p' changed in GCC 9.1} \"\" { target *-*-* } 56 } f4p */\n+/* { dg-note {parameter passing for argument of type 'struct S8p' changed in GCC 9.1} \"\" { target *-*-* } 57 } f8p */\n+\n+/* Changed in GCC 9.1, but we fail to emit a warning since GCC 11 (was OK with GCC 9).  */\n+/* { dg-note {parameter passing for argument of type 'struct S16p' changed in GCC 9.1} \"\" { xfail *-*-* } 58 } f16p */\n+\n+\n+/* Bitfield call argument in registers.  */\n+/* No change in parameter passing in GCC 9.1 for lines 60-64 (g1, g2, g4, g8, g16)\n+   because the overall alignment is > 16.  No warning expected.  */\n+\n+/* No change in parameter passing in GCC 9.1 for lines 66-70 (gp, g1p, g2p,\n+   g4p, g8p), no warning expected.  */\n+\n+/* Changed in GCC 9.1, but we fail to emit a warning.  */\n+/* { dg-note {parameter passing for argument of type 'struct S16p' changed in GCC 9.1} \"\" { xfail *-*-* } 71 } g16p */\n+\n+\n+/* Bitfield parameter in stack.  */\n+/* No change in parameter passing in GCC 9.1 for lines 74-78 (f1_stack,\n+   f2_stack, f4_stack, f8_stack, f16_stack) because the overall alignment is >\n+   16.  No warning expected.  */\n+\n+/* { dg-note {parameter passing for argument of type 'struct Sp' changed in GCC 9.1}  \"\" { target *-*-* } 80 } fp_stack */\n+/* { dg-note {parameter passing for argument of type 'struct S1p' changed in GCC 9.1} \"\" { target *-*-* } 81 } f1p_stack */\n+/* { dg-note {parameter passing for argument of type 'struct S2p' changed in GCC 9.1} \"\" { target *-*-* } 82 } f2p_stack */\n+/* { dg-note {parameter passing for argument of type 'struct S4p' changed in GCC 9.1} \"\" { target *-*-* } 83 } f4p_stack */\n+/* { dg-note {parameter passing for argument of type 'struct S8p' changed in GCC 9.1} \"\" { target *-*-* } 84 } f8p_stack */\n+\n+/* No change in parameter passing in GCC 9.1 for line 85 (f16p_stack) because\n+   the overall alignment is >= 16.  No warning expected.  */\n+\n+/* Bitfield call argument in stack.  */\n+/* No change in parameter passing in GCC 9.1 for lines 87-91 (g1_stack,\n+   g2_stack, g4_stack, g8_stack, g16_stack) because the overall alignment is >\n+   16.  No warning expected.  */\n+\n+/* { dg-note {parameter passing for argument of type 'struct Sp' changed in GCC 9.1}  \"\" { target *-*-* } 93 } gp_stack */\n+/* { dg-note {parameter passing for argument of type 'struct S1p' changed in GCC 9.1} \"\" { target *-*-* } 94 } g1p_stack */\n+/* { dg-note {parameter passing for argument of type 'struct S2p' changed in GCC 9.1} \"\" { target *-*-* } 95 } g2p_stack */\n+/* { dg-note {parameter passing for argument of type 'struct S4p' changed in GCC 9.1} \"\" { target *-*-* } 96 } g4p_stack */\n+/* { dg-note {parameter passing for argument of type 'struct S8p' changed in GCC 9.1} \"\" { target *-*-* } 97 } g8p_stack */\n+\n+\n+/* No change in parameter passing in GCC 9.1 for line 98 (g16p_stack).  No\n+   warning expected.  */\n+\n+\n+/* Bitfield parameter in stdarg.  */\n+/* No change in parameter passing in GCC 9.1 for lines 101-105 (f1_stdarg,\n+   f2_stdarg, f4_stdarg, f8_stdarg, f16_stdarg) because the overall alignment\n+   is > 16.  No warning expected.  */\n+\n+/* Parameter passing for these should not have changed in GCC 9.1 (PR 105549).\n+   Fortunately we warn. Note the discrepancy with lines 120-124 below: we warn\n+   in the callee, but not in the caller.  */\n+/* { dg-note {parameter passing for argument of type 'struct Sp' changed in GCC 9.1}   \"\" { target *-*-* } 107 } fp_stdarg */\n+/* { dg-note {parameter passing for argument of type 'struct S1p' changed in GCC 9.1}  \"\" { target *-*-* } 108 } f1p_stdarg */\n+/* { dg-note {parameter passing for argument of type 'struct S2p' changed in GCC 9.1}  \"\" { target *-*-* } 109 } f2p_stdarg */\n+/* { dg-note {parameter passing for argument of type 'struct S4p' changed in GCC 9.1}  \"\" { target *-*-* } 110 } f4p_stdarg */\n+/* { dg-note {parameter passing for argument of type 'struct S8p' changed in GCC 9.1}  \"\" { target *-*-* } 111 } f8p_stdarg */\n+\n+/* No change in parameter passing in GCC 9.1 for line 112 (f16p_stdarg).\n+   Should not warn.  */\n+/* { dg-note {parameter passing for argument of type 'struct S16p' changed in GCC 9.1} \"\" { target *-*-* } 112 } f16p_stdarg */\n+\n+/* Bitfield call argument in stdarg.  */\n+/* No change in parameter passing in GCC 9.1 for lines 114-118 (g1_stdarg,\n+   g2_stdarg, g4_stdarg, g8_stdarg, g16_stdarg) because the overall alignment\n+   is > 16.  No warning expected.  */\n+\n+/* No change in parameter passing in GCC 9.1 for lines 120-124 (gp_stdarg,\n+   g1p_stdarg, g2p_stdarg, g4p_stdarg, g8p_stdarg), no warning expected.  */\n+\n+/* Changed in GCC 9.1, but we fail to emit a warning.  */\n+/* { dg-note {parameter passing for argument of type 'struct S16p' changed in GCC 9.1} \"\" { xfail *-*-* } 125 } g16p_stdarg */"}, {"sha": "cb2a945a81982bc1397e2a316ade6b307593c884", "filename": "gcc/testsuite/gcc.target/aarch64/bitfield-abi-warning-align8-O2.c", "status": "added", "additions": 16, "deletions": 0, "changes": 16, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/3df1a115be22caeab3ffe7afb12e71adb54ff132/gcc%2Ftestsuite%2Fgcc.target%2Faarch64%2Fbitfield-abi-warning-align8-O2.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/3df1a115be22caeab3ffe7afb12e71adb54ff132/gcc%2Ftestsuite%2Fgcc.target%2Faarch64%2Fbitfield-abi-warning-align8-O2.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgcc.target%2Faarch64%2Fbitfield-abi-warning-align8-O2.c?ref=3df1a115be22caeab3ffe7afb12e71adb54ff132", "patch": "@@ -0,0 +1,16 @@\n+/* { dg-do compile } */\n+/* { dg-options \"-O2 -save-temps\" } */\n+\n+#define ALIGN 8\n+#define EXTRA\n+\n+#include \"bitfield-abi-warning.h\"\n+\n+/* In f1, f2, f4, f8, fp, f1p, f2p, f4p, f8p (and stdarg versions):  */\n+/* { dg-final { scan-assembler-times \"and\\tw0, w1, 1\" 18 } } */\n+\n+/* In f16, f16p (and stdarg versions):  */\n+/* { dg-final { scan-assembler-times \"and\\tw0, w2, 1\" 4 } } */\n+\n+/* In f1, f2, f4, f8, f16, fp, f1p, f2p, f4p, f8p, f16p stack versions:  */\n+/* { dg-final { scan-assembler-times \"and\\tw0, w0, 1\" 11 } } */"}, {"sha": "3940b714ef897b510c110d24123e9cd7b17e4e3b", "filename": "gcc/testsuite/gcc.target/aarch64/bitfield-abi-warning.h", "status": "added", "additions": 125, "deletions": 0, "changes": 125, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/3df1a115be22caeab3ffe7afb12e71adb54ff132/gcc%2Ftestsuite%2Fgcc.target%2Faarch64%2Fbitfield-abi-warning.h", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/3df1a115be22caeab3ffe7afb12e71adb54ff132/gcc%2Ftestsuite%2Fgcc.target%2Faarch64%2Fbitfield-abi-warning.h", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgcc.target%2Faarch64%2Fbitfield-abi-warning.h?ref=3df1a115be22caeab3ffe7afb12e71adb54ff132", "patch": "@@ -0,0 +1,125 @@\n+#include <stdarg.h>\n+\n+typedef unsigned long long ull __attribute__((aligned(ALIGN)));\n+\n+#ifndef EXTRA\n+#define EXTRA unsigned long long x;\n+#endif\n+\n+struct S1  { __attribute__((aligned(1))) ull i : 1; EXTRA };\n+struct S2  { __attribute__((aligned(2))) ull i : 1; EXTRA };\n+struct S4  { __attribute__((aligned(4))) ull i : 1; EXTRA };\n+struct S8  { __attribute__((aligned(8))) ull i : 1; EXTRA };\n+struct S16 { __attribute__((aligned(16))) ull i : 1; EXTRA };\n+\n+struct Sp   { ull i : 1; EXTRA }__attribute__((packed));\n+struct S1p  { __attribute__((packed, aligned(1))) ull i : 1; EXTRA };\n+struct S2p  { __attribute__((packed, aligned(2))) ull i : 1; EXTRA };\n+struct S4p  { __attribute__((packed, aligned(4))) ull i : 1; EXTRA };\n+struct S8p  { __attribute__((packed, aligned(8))) ull i : 1; EXTRA };\n+struct S16p { __attribute__((packed, aligned(16))) ull i : 1; EXTRA };\n+\n+/* Bitfield in registers.  */\n+#define PARAMS(xx) int a0, struct S##xx s, ull a1\n+/* Bitfield passed by the stack.  */\n+#define PARAMS_STACK(xx) int a0, ull a1, ull a2, ull a3, ull a4, ull a5, ull a6, ull a7, ull a8, struct S##xx t\n+/* Bitfield passed via stdarg.  */\n+#define PARAMS_STDARG(xx) int a0, ...\n+\n+#define CODE(xx)\t\t\t\t\\\n+  return s.i;\n+\n+#define CODE_STACK(xx)\t\t\t\t\\\n+  return t.i;\n+\n+#define CODE_STDARG(xx)\t\t\t\t\\\n+  va_list ap;\t\t\t\t\t\\\n+  struct S##xx arg;\t\t\t\t\\\n+  __builtin_va_start(ap,a0);\t\t\t\\\n+  arg = __builtin_va_arg(ap, struct S##xx);\t\\\n+  return arg.i;\n+\n+#define ARGS(xx) x, (struct S##xx) { x }, x\n+#define ARGS_STACK(xx) x, x, x, x, x, x, x, x, x, (struct S##xx) { x }\n+#define ARGS_STDARG(xx) x, (struct S##xx) { x }\n+\n+/* Bitfield in registers.  */\n+int __attribute__ ((noipa)) f1 (PARAMS(1))  { CODE(1) }\n+int __attribute__ ((noipa)) f2 (PARAMS(2))  { CODE(2) }\n+int __attribute__ ((noipa)) f4 (PARAMS(4))  { CODE(4) }\n+int __attribute__ ((noipa)) f8 (PARAMS(8))  { CODE(8) }\n+int __attribute__ ((noipa)) f16(PARAMS(16)) { CODE(16) }\n+\n+int __attribute__ ((noipa)) fp  (PARAMS(p))   { CODE(p) }\n+int __attribute__ ((noipa)) f1p (PARAMS(1p))  { CODE(1p) }\n+int __attribute__ ((noipa)) f2p (PARAMS(2p))  { CODE(2p) }\n+int __attribute__ ((noipa)) f4p (PARAMS(4p))  { CODE(4p) }\n+int __attribute__ ((noipa)) f8p (PARAMS(8p))  { CODE(8p) }\n+int __attribute__ ((noipa)) f16p(PARAMS(16p)) { CODE(16p) }\n+\n+int g1 (int x) { return f1 (ARGS(1)); }\n+int g2 (int x) { return f2 (ARGS(2)); }\n+int g4 (int x) { return f4 (ARGS(4)); }\n+int g8 (int x) { return f8 (ARGS(8)); }\n+int g16(int x) { return f16 (ARGS(16)); }\n+\n+int gp  (int x) { return fp   (ARGS(p)); }\n+int g1p (int x) { return f1p  (ARGS(1p)); }\n+int g2p (int x) { return f2p  (ARGS(2p)); }\n+int g4p (int x) { return f4p  (ARGS(4p)); }\n+int g8p (int x) { return f8p  (ARGS(8p)); }\n+int g16p(int x) { return f16p (ARGS(16p)); }\n+\n+/* Bitfield in the stack.  */\n+int __attribute__ ((noipa)) f1_stack (PARAMS_STACK(1))  { CODE_STACK(1) }\n+int __attribute__ ((noipa)) f2_stack (PARAMS_STACK(2))  { CODE_STACK(2) }\n+int __attribute__ ((noipa)) f4_stack (PARAMS_STACK(4))  { CODE_STACK(4) }\n+int __attribute__ ((noipa)) f8_stack (PARAMS_STACK(8))  { CODE_STACK(8) }\n+int __attribute__ ((noipa)) f16_stack(PARAMS_STACK(16)) { CODE_STACK(16) }\n+\n+int __attribute__ ((noipa)) fp_stack  (PARAMS_STACK(p))   { CODE_STACK(p) }\n+int __attribute__ ((noipa)) f1p_stack (PARAMS_STACK(1p))  { CODE_STACK(1p) }\n+int __attribute__ ((noipa)) f2p_stack (PARAMS_STACK(2p))  { CODE_STACK(2p) }\n+int __attribute__ ((noipa)) f4p_stack (PARAMS_STACK(4p))  { CODE_STACK(4p) }\n+int __attribute__ ((noipa)) f8p_stack (PARAMS_STACK(8p))  { CODE_STACK(8p) }\n+int __attribute__ ((noipa)) f16p_stack(PARAMS_STACK(16p)) { CODE_STACK(16p) }\n+\n+int g1_stack (int x) { return f1_stack (ARGS_STACK(1)); }\n+int g2_stack (int x) { return f2_stack (ARGS_STACK(2)); }\n+int g4_stack (int x) { return f4_stack (ARGS_STACK(4)); }\n+int g8_stack (int x) { return f8_stack (ARGS_STACK(8)); }\n+int g16_stack(int x) { return f16_stack (ARGS_STACK(16)); }\n+\n+int gp_stack  (int x) { return fp_stack (ARGS_STACK(p)); }\n+int g1p_stack (int x) { return f1p_stack (ARGS_STACK(1p)); }\n+int g2p_stack (int x) { return f2p_stack (ARGS_STACK(2p)); }\n+int g4p_stack (int x) { return f4p_stack (ARGS_STACK(4p)); }\n+int g8p_stack (int x) { return f8p_stack (ARGS_STACK(8p)); }\n+int g16p_stack(int x) { return f16p_stack (ARGS_STACK(16p)); }\n+\n+/* Bitfield  via stdarg.  */\n+int __attribute__ ((noipa)) f1_stdarg (PARAMS_STDARG(1))  { CODE_STDARG(1) }\n+int __attribute__ ((noipa)) f2_stdarg (PARAMS_STDARG(2))  { CODE_STDARG(2) }\n+int __attribute__ ((noipa)) f4_stdarg (PARAMS_STDARG(4))  { CODE_STDARG(4) }\n+int __attribute__ ((noipa)) f8_stdarg (PARAMS_STDARG(8))  { CODE_STDARG(8) }\n+int __attribute__ ((noipa)) f16_stdarg(PARAMS_STDARG(16)) { CODE_STDARG(16) }\n+\n+int __attribute__ ((noipa)) fp_stdarg  (PARAMS_STDARG(p))   { CODE_STDARG(p) }\n+int __attribute__ ((noipa)) f1p_stdarg (PARAMS_STDARG(1p))  { CODE_STDARG(1p) }\n+int __attribute__ ((noipa)) f2p_stdarg (PARAMS_STDARG(2p))  { CODE_STDARG(2p) }\n+int __attribute__ ((noipa)) f4p_stdarg (PARAMS_STDARG(4p))  { CODE_STDARG(4p) }\n+int __attribute__ ((noipa)) f8p_stdarg (PARAMS_STDARG(8p))  { CODE_STDARG(8p) }\n+int __attribute__ ((noipa)) f16p_stdarg(PARAMS_STDARG(16p)) { CODE_STDARG(16p) }\n+\n+int g1_stdarg (int x) { return f1_stdarg (ARGS_STDARG(1)); }\n+int g2_stdarg (int x) { return f2_stdarg (ARGS_STDARG(2)); }\n+int g4_stdarg (int x) { return f4_stdarg (ARGS_STDARG(4)); }\n+int g8_stdarg (int x) { return f8_stdarg (ARGS_STDARG(8)); }\n+int g16_stdarg(int x) { return f16_stdarg (ARGS_STDARG(16)); }\n+\n+int gp_stdarg  (int x) { return fp_stdarg (ARGS_STDARG(p)); }\n+int g1p_stdarg (int x) { return f1p_stdarg (ARGS_STDARG(1p)); }\n+int g2p_stdarg (int x) { return f2p_stdarg (ARGS_STDARG(2p)); }\n+int g4p_stdarg (int x) { return f4p_stdarg (ARGS_STDARG(4p)); }\n+int g8p_stdarg (int x) { return f8p_stdarg (ARGS_STDARG(8p)); }\n+int g16p_stdarg(int x) { return f16p_stdarg (ARGS_STDARG(16p)); }"}]}