{"sha": "47b33e4c65161d94faafc23832ea9d1978f339f9", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6NDdiMzNlNGM2NTE2MWQ5NGZhYWZjMjM4MzJlYTlkMTk3OGYzMzlmOQ==", "commit": {"author": {"name": "Terry Guo", "email": "terry.guo@arm.com", "date": "2012-12-19T11:40:52Z"}, "committer": {"name": "Xuepeng Guo", "email": "xguo@gcc.gnu.org", "date": "2012-12-19T11:40:52Z"}, "message": "arm.c (thumb_find_work_register): Check argument register number based on current PCS.\n\ngcc/ChangeLog:\n\n2012-12-19  Terry Guo  <terry.guo@arm.com>\n\n        * config/arm/arm.c (thumb_find_work_register): Check argument\n        register number based on current PCS.\n\ngcc/testsuite/ChangeLog:\n\n2012-12-19  Terry Guo  <terry.guo@arm.com>\n\n        * gcc.target/arm/thumb-find-work-register.c: New.\n\nFrom-SVN: r194605", "tree": {"sha": "3a3ffdc613320447adc2800322607ab51fa4e7a2", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/3a3ffdc613320447adc2800322607ab51fa4e7a2"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/47b33e4c65161d94faafc23832ea9d1978f339f9", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/47b33e4c65161d94faafc23832ea9d1978f339f9", "html_url": "https://github.com/Rust-GCC/gccrs/commit/47b33e4c65161d94faafc23832ea9d1978f339f9", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/47b33e4c65161d94faafc23832ea9d1978f339f9/comments", "author": null, "committer": null, "parents": [{"sha": "36085529ca2fd651b3109eb920bf8010859db0be", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/36085529ca2fd651b3109eb920bf8010859db0be", "html_url": "https://github.com/Rust-GCC/gccrs/commit/36085529ca2fd651b3109eb920bf8010859db0be"}], "stats": {"total": 53, "additions": 52, "deletions": 1}, "files": [{"sha": "5c6c840cf253d5d7ae40c4dbc7de72db8675e23b", "filename": "gcc/ChangeLog", "status": "modified", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/47b33e4c65161d94faafc23832ea9d1978f339f9/gcc%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/47b33e4c65161d94faafc23832ea9d1978f339f9/gcc%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2FChangeLog?ref=47b33e4c65161d94faafc23832ea9d1978f339f9", "patch": "@@ -1,3 +1,8 @@\n+2012-12-19  Terry Guo  <terry.guo@arm.com>\n+\n+\t* config/arm/arm.c (thumb_find_work_register): Check argument\n+\tregister number based on current PCS.\n+\n 2012-12-18  Jakub Jelinek  <jakub@redhat.com>\n \n \tPR target/55562"}, {"sha": "15f9c9bf303ef5ffd6f729a1f7e7e985d6e5f0c7", "filename": "gcc/config/arm/arm.c", "status": "modified", "additions": 3, "deletions": 1, "changes": 4, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/47b33e4c65161d94faafc23832ea9d1978f339f9/gcc%2Fconfig%2Farm%2Farm.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/47b33e4c65161d94faafc23832ea9d1978f339f9/gcc%2Fconfig%2Farm%2Farm.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fconfig%2Farm%2Farm.c?ref=47b33e4c65161d94faafc23832ea9d1978f339f9", "patch": "@@ -5566,7 +5566,9 @@ thumb_find_work_register (unsigned long pushed_regs_mask)\n   if (! cfun->machine->uses_anonymous_args\n       && crtl->args.size >= 0\n       && crtl->args.size <= (LAST_ARG_REGNUM * UNITS_PER_WORD)\n-      && crtl->args.info.nregs < 4)\n+      && (TARGET_AAPCS_BASED\n+\t  ? crtl->args.info.aapcs_ncrn < 4\n+\t  : crtl->args.info.nregs < 4))\n     return LAST_ARG_REGNUM;\n \n   /* Otherwise look for a call-saved register that is going to be pushed.  */"}, {"sha": "6719b296651da1642a6aa01385c8b4c06a9f9891", "filename": "gcc/testsuite/ChangeLog", "status": "modified", "additions": 4, "deletions": 0, "changes": 4, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/47b33e4c65161d94faafc23832ea9d1978f339f9/gcc%2Ftestsuite%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/47b33e4c65161d94faafc23832ea9d1978f339f9/gcc%2Ftestsuite%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2FChangeLog?ref=47b33e4c65161d94faafc23832ea9d1978f339f9", "patch": "@@ -1,3 +1,7 @@\n+2012-12-19  Terry Guo  <terry.guo@arm.com>\n+\n+\t* gcc.target/arm/thumb-find-work-register.c: New.\n+\n 2012-12-19  Tobias Burnus  <burnus@net-b.de>\n \n \tPR fortran/55733"}, {"sha": "f2c0225a4d2a91ad3cfc7e6ae66dac24963fb562", "filename": "gcc/testsuite/gcc.target/arm/thumb-find-work-register.c", "status": "added", "additions": 40, "deletions": 0, "changes": 40, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/47b33e4c65161d94faafc23832ea9d1978f339f9/gcc%2Ftestsuite%2Fgcc.target%2Farm%2Fthumb-find-work-register.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/47b33e4c65161d94faafc23832ea9d1978f339f9/gcc%2Ftestsuite%2Fgcc.target%2Farm%2Fthumb-find-work-register.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgcc.target%2Farm%2Fthumb-find-work-register.c?ref=47b33e4c65161d94faafc23832ea9d1978f339f9", "patch": "@@ -0,0 +1,40 @@\n+/* Wrong method to get number of arg reg will cause argument corruption.  */\n+/* { dg-do run } */\n+/* { dg-require-effective-target arm_eabi } */\n+/* { dg-options \"-mthumb -O1\" } */\n+\n+extern void abort (void);\n+\n+int foo (int, int, int, int) __attribute__((noinline));\n+\n+int\n+foo (int a, int b, int c, int d)\n+{\n+  register int m asm (\"r8\");\n+\n+  m = a;\n+  m += b;\n+  m += c;\n+  m += d;\n+\n+  asm (\"\" : \"=r\" (m) : \"0\" (m));\n+\n+  return m;\n+}\n+\n+int\n+main ()\n+{\n+  volatile int a = 10;\n+  volatile int b = 20;\n+  volatile int c = 30;\n+  volatile int d = 40;\n+  volatile int sum = 0;\n+\n+  sum = foo (a, b, c, d);\n+\n+  if (sum != 100)\n+    abort ();\n+\n+  return 0;\n+}"}]}