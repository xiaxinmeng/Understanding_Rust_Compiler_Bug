{"sha": "1b6f0a561f24ac71e50e6ac30a01b5a101ea3980", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6MWI2ZjBhNTYxZjI0YWM3MWU1MGU2YWMzMGEwMWI1YTEwMWVhMzk4MA==", "commit": {"author": {"name": "Benjamin Kosnik", "email": "bkoz@redhat.com", "date": "2003-06-24T19:38:36Z"}, "committer": {"name": "Benjamin Kosnik", "email": "bkoz@gcc.gnu.org", "date": "2003-06-24T19:38:36Z"}, "message": "testsuite_performance.h: Tweak mallinfo.\n\n\n2003-06-24  Benjamin Kosnik  <bkoz@redhat.com>\n            Ulrich Drepper  <drepper@redhat.com>\n\n\t* testsuite/testsuite_performance.h: Tweak mallinfo.\n\nCo-Authored-By: Ulrich Drepper <drepper@redhat.com>\n\nFrom-SVN: r68436", "tree": {"sha": "95c59266182db618efadc792c8578d12f329d151", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/95c59266182db618efadc792c8578d12f329d151"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/1b6f0a561f24ac71e50e6ac30a01b5a101ea3980", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/1b6f0a561f24ac71e50e6ac30a01b5a101ea3980", "html_url": "https://github.com/Rust-GCC/gccrs/commit/1b6f0a561f24ac71e50e6ac30a01b5a101ea3980", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/1b6f0a561f24ac71e50e6ac30a01b5a101ea3980/comments", "author": null, "committer": null, "parents": [{"sha": "61f33c67c2601f0efde851cfcd00f82dc91ec0d5", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/61f33c67c2601f0efde851cfcd00f82dc91ec0d5", "html_url": "https://github.com/Rust-GCC/gccrs/commit/61f33c67c2601f0efde851cfcd00f82dc91ec0d5"}], "stats": {"total": 36, "additions": 22, "deletions": 14}, "files": [{"sha": "f0024acf3c634fce80363f140f7c197dedd9ee60", "filename": "libstdc++-v3/ChangeLog", "status": "modified", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/1b6f0a561f24ac71e50e6ac30a01b5a101ea3980/libstdc%2B%2B-v3%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/1b6f0a561f24ac71e50e6ac30a01b5a101ea3980/libstdc%2B%2B-v3%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libstdc%2B%2B-v3%2FChangeLog?ref=1b6f0a561f24ac71e50e6ac30a01b5a101ea3980", "patch": "@@ -1,3 +1,8 @@\n+2003-06-24  Benjamin Kosnik  <bkoz@redhat.com>\n+            Ulrich Drepper  <drepper@redhat.com>\n+\n+\t* testsuite/testsuite_performance.h: Tweak mallinfo.\n+\n 2003-06-24  Paolo Carlini  <pcarlini@unitus.it>\n             Nathan C. Myers  <ncm-nospam@cantrip.org>\n "}, {"sha": "1ad02518fd028ce0becd99a2fcecc5b04da37296", "filename": "libstdc++-v3/testsuite/testsuite_performance.h", "status": "modified", "additions": 17, "deletions": 14, "changes": 31, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/1b6f0a561f24ac71e50e6ac30a01b5a101ea3980/libstdc%2B%2B-v3%2Ftestsuite%2Ftestsuite_performance.h", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/1b6f0a561f24ac71e50e6ac30a01b5a101ea3980/libstdc%2B%2B-v3%2Ftestsuite%2Ftestsuite_performance.h", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libstdc%2B%2B-v3%2Ftestsuite%2Ftestsuite_performance.h?ref=1b6f0a561f24ac71e50e6ac30a01b5a101ea3980", "patch": "@@ -33,15 +33,22 @@\n \n #include <sys/times.h>\n #include <sys/resource.h>\n-#ifdef __FreeBSD__\n-#include <stdlib.h>\n-#else\n-#include <malloc.h>\n-#endif\n+#include <cstdlib>\n #include <string>\n #include <fstream>\n #include <iomanip>\n \n+#ifdef __linux__\n+#include <malloc.h>\n+#else\n+extern \"C\"\n+{\n+  struct mallinfo { int uordblks; };\n+  struct mallinfo empty = { 0 };\n+  struct mallinfo mallinfo(void) { return empty; }\n+}\n+#endif\n+\n namespace __gnu_cxx_test\n {\n   class time_counter\n@@ -85,11 +92,6 @@ namespace __gnu_cxx_test\n     { return tms_end.tms_stime - tms_begin.tms_stime; }\n   };\n \n-#ifdef __FreeBSD__\n-  struct mallinfo { int arena; };\n-  int mallinfo (void) { return 0; }\n-#endif\n-\n   class resource_counter\n   {\n     int\t\twho;\n@@ -116,20 +118,21 @@ namespace __gnu_cxx_test\n     { \n       if (getrusage(who, &rusage_begin) != 0 )\n \tmemset(&rusage_begin, 0, sizeof(rusage_begin));\n-      // allocation_begin = mallinfo();\n+      malloc(0); // Needed for some implementations.\n+      allocation_begin = mallinfo();\n     }\n     \n     void\n     stop()\n     { \n       if (getrusage(who, &rusage_end) != 0 )\n \tmemset(&rusage_end, 0, sizeof(rusage_end));\n-      // allocation_end = mallinfo();\n+      allocation_end = mallinfo();\n     }\n \n     int\n     allocated_memory() const\n-    { return allocation_end.arena - allocation_begin.arena; }\n+    { return allocation_end.uordblks - allocation_begin.uordblks; }\n     \n     long \n     hard_page_fault() const\n@@ -181,7 +184,7 @@ namespace __gnu_cxx_test\n     out << std::setw(4) << t.real_time() << \"r\" << space;\n     out << std::setw(4) << t.user_time() << \"u\" << space;\n     out << std::setw(4) << t.system_time() << \"s\" << space;\n-    //    out << std::setw(4) << r.allocated_memory() << \"mem\" << space;\n+    out << std::setw(4) << r.allocated_memory() << \"mem\" << space;\n     out << std::setw(4) << r.hard_page_fault() << \"pf\" << space;\n     \n     out << std::endl;"}]}