{"sha": "43d0b501eec49d6d4092fe0e5299aedf1d743124", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6NDNkMGI1MDFlZWM0OWQ2ZDQwOTJmZTBlNTI5OWFlZGYxZDc0MzEyNA==", "commit": {"author": {"name": "Jakub Jelinek", "email": "jakub@redhat.com", "date": "2016-12-01T07:56:49Z"}, "committer": {"name": "Jakub Jelinek", "email": "jakub@gcc.gnu.org", "date": "2016-12-01T07:56:49Z"}, "message": "re PR target/78614 (ICE error: invalid rtl sharing found in the insn (verify_rtx_sharing) gcc/emit-rtl.c:2743)\n\n\tPR target/78614\n\t* config/rs6000/rs6000.c (rs6000_frame_related): Call\n\tset_used_flags (pat) before any simplifications.  Clear used flag on\n\tPARALLEL copy.  Don't guard add_reg_note call.  Call\n\tcopy_rtx_if_shared on pat before storing it into\n\tREG_FRAME_RELATED_EXPR.\n\nFrom-SVN: r243099", "tree": {"sha": "e411a39aa09bdf4ea437478d2c363ae134fb0933", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/e411a39aa09bdf4ea437478d2c363ae134fb0933"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/43d0b501eec49d6d4092fe0e5299aedf1d743124", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/43d0b501eec49d6d4092fe0e5299aedf1d743124", "html_url": "https://github.com/Rust-GCC/gccrs/commit/43d0b501eec49d6d4092fe0e5299aedf1d743124", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/43d0b501eec49d6d4092fe0e5299aedf1d743124/comments", "author": {"login": "jakubjelinek", "id": 9370665, "node_id": "MDQ6VXNlcjkzNzA2NjU=", "avatar_url": "https://avatars.githubusercontent.com/u/9370665?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jakubjelinek", "html_url": "https://github.com/jakubjelinek", "followers_url": "https://api.github.com/users/jakubjelinek/followers", "following_url": "https://api.github.com/users/jakubjelinek/following{/other_user}", "gists_url": "https://api.github.com/users/jakubjelinek/gists{/gist_id}", "starred_url": "https://api.github.com/users/jakubjelinek/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jakubjelinek/subscriptions", "organizations_url": "https://api.github.com/users/jakubjelinek/orgs", "repos_url": "https://api.github.com/users/jakubjelinek/repos", "events_url": "https://api.github.com/users/jakubjelinek/events{/privacy}", "received_events_url": "https://api.github.com/users/jakubjelinek/received_events", "type": "User", "site_admin": false}, "committer": null, "parents": [{"sha": "d9b2d86c74a2153b07fb9d63baf220d385043a9d", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/d9b2d86c74a2153b07fb9d63baf220d385043a9d", "html_url": "https://github.com/Rust-GCC/gccrs/commit/d9b2d86c74a2153b07fb9d63baf220d385043a9d"}], "stats": {"total": 14, "additions": 12, "deletions": 2}, "files": [{"sha": "b3cc6305578124cc7d03f83c7e6a1fe49b0bfbde", "filename": "gcc/ChangeLog", "status": "modified", "additions": 9, "deletions": 0, "changes": 9, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/43d0b501eec49d6d4092fe0e5299aedf1d743124/gcc%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/43d0b501eec49d6d4092fe0e5299aedf1d743124/gcc%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2FChangeLog?ref=43d0b501eec49d6d4092fe0e5299aedf1d743124", "patch": "@@ -1,3 +1,12 @@\n+2016-12-01  Jakub Jelinek  <jakub@redhat.com>\n+\n+\tPR target/78614\n+\t* config/rs6000/rs6000.c (rs6000_frame_related): Call\n+\tset_used_flags (pat) before any simplifications.  Clear used flag on\n+\tPARALLEL copy.  Don't guard add_reg_note call.  Call\n+\tcopy_rtx_if_shared on pat before storing it into\n+\tREG_FRAME_RELATED_EXPR.\n+\n 2016-12-01  Alan Modra  <amodra@gmail.com>\n \n \t* gcc/config/rs6000/rs6000.c (insn_is_swappable_p): Properly"}, {"sha": "e57262092972d4fab0473ecc479b4d60ec844142", "filename": "gcc/config/rs6000/rs6000.c", "status": "modified", "additions": 3, "deletions": 2, "changes": 5, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/43d0b501eec49d6d4092fe0e5299aedf1d743124/gcc%2Fconfig%2Frs6000%2Frs6000.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/43d0b501eec49d6d4092fe0e5299aedf1d743124/gcc%2Fconfig%2Frs6000%2Frs6000.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fconfig%2Frs6000%2Frs6000.c?ref=43d0b501eec49d6d4092fe0e5299aedf1d743124", "patch": "@@ -27174,6 +27174,7 @@ rs6000_frame_related (rtx_insn *insn, rtx reg, HOST_WIDE_INT val,\n      Call simplify_replace_rtx on the SETs rather than the whole insn\n      so as to leave the other stuff alone (for example USE of r12).  */\n \n+  set_used_flags (pat);\n   if (GET_CODE (pat) == SET)\n     {\n       if (repl)\n@@ -27185,6 +27186,7 @@ rs6000_frame_related (rtx_insn *insn, rtx reg, HOST_WIDE_INT val,\n     {\n       pat = shallow_copy_rtx (pat);\n       XVEC (pat, 0) = shallow_copy_rtvec (XVEC (pat, 0));\n+      RTX_FLAG (pat, used) = 0;\n \n       for (int i = 0; i < XVECLEN (pat, 0); i++)\n \tif (GET_CODE (XVECEXP (pat, 0, i)) == SET)\n@@ -27207,8 +27209,7 @@ rs6000_frame_related (rtx_insn *insn, rtx reg, HOST_WIDE_INT val,\n     gcc_unreachable ();\n \n   RTX_FRAME_RELATED_P (insn) = 1;\n-  if (repl || reg2)\n-    add_reg_note (insn, REG_FRAME_RELATED_EXPR, pat);\n+  add_reg_note (insn, REG_FRAME_RELATED_EXPR, copy_rtx_if_shared (pat));\n \n   return insn;\n }"}]}