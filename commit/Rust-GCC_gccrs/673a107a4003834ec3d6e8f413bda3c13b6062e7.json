{"sha": "673a107a4003834ec3d6e8f413bda3c13b6062e7", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6NjczYTEwN2E0MDAzODM0ZWMzZDZlOGY0MTNiZGEzYzEzYjYwNjJlNw==", "commit": {"author": {"name": "Jakub Jelinek", "email": "jakub@redhat.com", "date": "2016-07-29T12:00:43Z"}, "committer": {"name": "Marek Polacek", "email": "mpolacek@gcc.gnu.org", "date": "2016-07-29T12:00:43Z"}, "message": "re PR c/71969 (Wrong setting of DECL_DISREGARD_INLINE_LIMITS in the C FE)\n\n\tPR c/71969\n\t* c-decl.c (finish_function): Only set DECL_DISREGARD_INLINE_LIMITS\n\ton GNU extern inline functions.\n\n\t* gcc.dg/alias-11.c (add_cfi, new_cfi): Change __inline__ to\n\tstatic __inline__.\n\t* gcc.dg/pr71969-1.c: New test.\n\t* gcc.dg/pr71969-2.c: New test.\n\t* gcc.dg/pr71969-3.c: New test.\n\nFrom-SVN: r238862", "tree": {"sha": "403f2bdea676b39e3c28c39a2297523e8092bf21", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/403f2bdea676b39e3c28c39a2297523e8092bf21"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/673a107a4003834ec3d6e8f413bda3c13b6062e7", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/673a107a4003834ec3d6e8f413bda3c13b6062e7", "html_url": "https://github.com/Rust-GCC/gccrs/commit/673a107a4003834ec3d6e8f413bda3c13b6062e7", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/673a107a4003834ec3d6e8f413bda3c13b6062e7/comments", "author": {"login": "jakubjelinek", "id": 9370665, "node_id": "MDQ6VXNlcjkzNzA2NjU=", "avatar_url": "https://avatars.githubusercontent.com/u/9370665?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jakubjelinek", "html_url": "https://github.com/jakubjelinek", "followers_url": "https://api.github.com/users/jakubjelinek/followers", "following_url": "https://api.github.com/users/jakubjelinek/following{/other_user}", "gists_url": "https://api.github.com/users/jakubjelinek/gists{/gist_id}", "starred_url": "https://api.github.com/users/jakubjelinek/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jakubjelinek/subscriptions", "organizations_url": "https://api.github.com/users/jakubjelinek/orgs", "repos_url": "https://api.github.com/users/jakubjelinek/repos", "events_url": "https://api.github.com/users/jakubjelinek/events{/privacy}", "received_events_url": "https://api.github.com/users/jakubjelinek/received_events", "type": "User", "site_admin": false}, "committer": null, "parents": [{"sha": "a5b5c8b62494c0089bfc60ad5dfeae4e7f4c6690", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/a5b5c8b62494c0089bfc60ad5dfeae4e7f4c6690", "html_url": "https://github.com/Rust-GCC/gccrs/commit/a5b5c8b62494c0089bfc60ad5dfeae4e7f4c6690"}], "stats": {"total": 121, "additions": 118, "deletions": 3}, "files": [{"sha": "d512a3da482766cc12615a7694e815dc58396805", "filename": "gcc/c/ChangeLog", "status": "modified", "additions": 6, "deletions": 0, "changes": 6, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/673a107a4003834ec3d6e8f413bda3c13b6062e7/gcc%2Fc%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/673a107a4003834ec3d6e8f413bda3c13b6062e7/gcc%2Fc%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fc%2FChangeLog?ref=673a107a4003834ec3d6e8f413bda3c13b6062e7", "patch": "@@ -1,3 +1,9 @@\n+2016-07-29  Jakub Jelinek  <jakub@redhat.com>\n+\n+\tPR c/71969\n+\t* c-decl.c (finish_function): Only set DECL_DISREGARD_INLINE_LIMITS\n+\ton GNU extern inline functions.\n+\n 2016-07-29  Marek Polacek  <polacek@redhat.com>\n \n \tPR c/71583"}, {"sha": "f2773c5bb7287883e90681aad1b77412f6ab9073", "filename": "gcc/c/c-decl.c", "status": "modified", "additions": 3, "deletions": 1, "changes": 4, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/673a107a4003834ec3d6e8f413bda3c13b6062e7/gcc%2Fc%2Fc-decl.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/673a107a4003834ec3d6e8f413bda3c13b6062e7/gcc%2Fc%2Fc-decl.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fc%2Fc-decl.c?ref=673a107a4003834ec3d6e8f413bda3c13b6062e7", "patch": "@@ -9262,7 +9262,9 @@ finish_function (void)\n \n   /* For GNU C extern inline functions disregard inline limits.  */\n   if (DECL_EXTERNAL (fndecl)\n-      && DECL_DECLARED_INLINE_P (fndecl))\n+      && DECL_DECLARED_INLINE_P (fndecl)\n+      && (flag_gnu89_inline\n+\t  || lookup_attribute (\"gnu_inline\", DECL_ATTRIBUTES (fndecl))))\n     DECL_DISREGARD_INLINE_LIMITS (fndecl) = 1;\n \n   /* Genericize before inlining.  Delay genericizing nested functions"}, {"sha": "1bc34b96395cb4c85226dcf0139e8caedbb0641e", "filename": "gcc/testsuite/ChangeLog", "status": "modified", "additions": 9, "deletions": 0, "changes": 9, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/673a107a4003834ec3d6e8f413bda3c13b6062e7/gcc%2Ftestsuite%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/673a107a4003834ec3d6e8f413bda3c13b6062e7/gcc%2Ftestsuite%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2FChangeLog?ref=673a107a4003834ec3d6e8f413bda3c13b6062e7", "patch": "@@ -1,3 +1,12 @@\n+2016-07-29  Jakub Jelinek  <jakub@redhat.com>\n+\n+\tPR c/71969\n+\t* gcc.dg/alias-11.c (add_cfi, new_cfi): Change __inline__ to\n+\tstatic __inline__.\n+\t* gcc.dg/pr71969-1.c: New test.\n+\t* gcc.dg/pr71969-2.c: New test.\n+\t* gcc.dg/pr71969-3.c: New test.\n+\n 2016-07-29  Marek Polacek  <polacek@redhat.com>\n \n \tPR c/71574"}, {"sha": "7629c6c7d1a1ed44e6f244f533b97fd9c1398288", "filename": "gcc/testsuite/gcc.dg/alias-11.c", "status": "modified", "additions": 2, "deletions": 2, "changes": 4, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/673a107a4003834ec3d6e8f413bda3c13b6062e7/gcc%2Ftestsuite%2Fgcc.dg%2Falias-11.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/673a107a4003834ec3d6e8f413bda3c13b6062e7/gcc%2Ftestsuite%2Fgcc.dg%2Falias-11.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgcc.dg%2Falias-11.c?ref=673a107a4003834ec3d6e8f413bda3c13b6062e7", "patch": "@@ -24,7 +24,7 @@ dw_cfi_node *cie_cfi_head;\n unsigned fde_table_in_use;\n dw_fde_node *fde_table;\n \n-__inline__ void\n+static __inline__ void\n add_cfi (dw_cfi_node **list_head, dw_cfi_node *cfi)\n {\n   dw_cfi_node **p;\n@@ -35,7 +35,7 @@ add_cfi (dw_cfi_node **list_head, dw_cfi_node *cfi)\n   *p = cfi;\n }\n \n-__inline__ struct dw_cfi_struct *\n+static __inline__ struct dw_cfi_struct *\n new_cfi (void)\n {\n   dw_cfi_node *cfi = (dw_cfi_node *) malloc (sizeof (dw_cfi_node));"}, {"sha": "a39b05ea9edf8e27685623026cc80ef9552ae94c", "filename": "gcc/testsuite/gcc.dg/pr71969-1.c", "status": "added", "additions": 37, "deletions": 0, "changes": 37, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/673a107a4003834ec3d6e8f413bda3c13b6062e7/gcc%2Ftestsuite%2Fgcc.dg%2Fpr71969-1.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/673a107a4003834ec3d6e8f413bda3c13b6062e7/gcc%2Ftestsuite%2Fgcc.dg%2Fpr71969-1.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgcc.dg%2Fpr71969-1.c?ref=673a107a4003834ec3d6e8f413bda3c13b6062e7", "patch": "@@ -0,0 +1,37 @@\n+/* PR c/71969 */\n+/* { dg-do compile } */\n+/* { dg-options \"-std=gnu99 -fno-gnu89-inline -O2 -fdump-tree-einline-details\" } */\n+\n+volatile int v;\n+#define S v++;\n+#define S10 S S S S S S S S S S\n+#define S100 S10 S10 S10 S10 S10 S10 S10 S10 S10 S10\n+\n+extern inline void\n+foo (void) { S100 }\n+\n+inline void\n+bar (void) { S100 }\n+\n+static inline void\n+baz (void) { S100 }\n+\n+int\n+main ()\n+{\n+  foo ();\n+  foo ();\n+  foo ();\n+  foo ();\n+  bar ();\n+  bar ();\n+  bar ();\n+  bar ();\n+  baz ();\n+  baz ();\n+  baz ();\n+  baz ();\n+  return 0;\n+}\n+\n+/* { dg-final { scan-tree-dump-times \"will not early inline\" 12 \"einline\" } } */"}, {"sha": "f434fd0debdf60d3eea78879973de6380f0bb3c5", "filename": "gcc/testsuite/gcc.dg/pr71969-2.c", "status": "added", "additions": 23, "deletions": 0, "changes": 23, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/673a107a4003834ec3d6e8f413bda3c13b6062e7/gcc%2Ftestsuite%2Fgcc.dg%2Fpr71969-2.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/673a107a4003834ec3d6e8f413bda3c13b6062e7/gcc%2Ftestsuite%2Fgcc.dg%2Fpr71969-2.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgcc.dg%2Fpr71969-2.c?ref=673a107a4003834ec3d6e8f413bda3c13b6062e7", "patch": "@@ -0,0 +1,23 @@\n+/* PR c/71969 */\n+/* { dg-do compile } */\n+/* { dg-options \"-std=gnu99 -fno-gnu89-inline -O2 -fdump-tree-einline-details\" } */\n+\n+volatile int v;\n+#define S v++;\n+#define S10 S S S S S S S S S S\n+#define S100 S10 S10 S10 S10 S10 S10 S10 S10 S10 S10\n+\n+extern inline __attribute__((gnu_inline)) void\n+foo (void) { S100 }\n+\n+int\n+main ()\n+{\n+  foo ();\n+  foo ();\n+  foo ();\n+  foo ();\n+  return 0;\n+}\n+\n+/* { dg-final { scan-tree-dump-times \"Inlining foo into main\" 4 \"einline\" } } */"}, {"sha": "583d89d68daca3d6f5c089a2243a72f2cb812a7f", "filename": "gcc/testsuite/gcc.dg/pr71969-3.c", "status": "added", "additions": 38, "deletions": 0, "changes": 38, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/673a107a4003834ec3d6e8f413bda3c13b6062e7/gcc%2Ftestsuite%2Fgcc.dg%2Fpr71969-3.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/673a107a4003834ec3d6e8f413bda3c13b6062e7/gcc%2Ftestsuite%2Fgcc.dg%2Fpr71969-3.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgcc.dg%2Fpr71969-3.c?ref=673a107a4003834ec3d6e8f413bda3c13b6062e7", "patch": "@@ -0,0 +1,38 @@\n+/* PR c/71969 */\n+/* { dg-do compile } */\n+/* { dg-options \"-std=gnu99 -fgnu89-inline -O2 -fdump-tree-einline-details\" } */\n+\n+volatile int v;\n+#define S v++;\n+#define S10 S S S S S S S S S S\n+#define S100 S10 S10 S10 S10 S10 S10 S10 S10 S10 S10\n+\n+extern inline void\n+foo (void) { S100 }\n+\n+inline void\n+bar (void) { S100 }\n+\n+static inline void\n+baz (void) { S100 }\n+\n+int\n+main ()\n+{\n+  foo ();\n+  foo ();\n+  foo ();\n+  foo ();\n+  bar ();\n+  bar ();\n+  bar ();\n+  bar ();\n+  baz ();\n+  baz ();\n+  baz ();\n+  baz ();\n+  return 0;\n+}\n+\n+/* { dg-final { scan-tree-dump-times \"will not early inline\" 8 \"einline\" } } */\n+/* { dg-final { scan-tree-dump-times \"Inlining foo into main\" 4 \"einline\" } } */"}]}