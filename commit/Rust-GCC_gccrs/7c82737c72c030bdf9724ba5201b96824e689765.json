{"sha": "7c82737c72c030bdf9724ba5201b96824e689765", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6N2M4MjczN2M3MmMwMzBiZGY5NzI0YmE1MjAxYjk2ODI0ZTY4OTc2NQ==", "commit": {"author": {"name": "Piotr Trojanek", "email": "trojanek@adacore.com", "date": "2021-02-08T22:39:24Z"}, "committer": {"name": "Pierre-Marie de Rodat", "email": "derodat@adacore.com", "date": "2021-05-07T09:29:19Z"}, "message": "[Ada] Fix link from body protected entry implementation to source code\n\ngcc/ada/\n\n\t* einfo.ads: Move Corresponding_Protected_Entry...\n\t* sinfo.ads: ... here.\n\t* exp_ch9.adb (Build_Entry_Body): Link procedure and entry\n\tbodies.\n\t* gen_il-fields.ads (Opt_Field_Enum): Add\n\tCorresponding_Entry_Body field to nodes; remove\n\tCorresponding_Protected_Entry field from entities.\n\t* gen_il-gen-gen_entities.adb (Gen_Entities): Remove\n\tCorresponding_Protected_Entry field from E_Void and\n\tE_Subprogram_Body.\n\t* gen_il-gen-gen_nodes.adb (Gen_Nodes): Add\n\tCorresponding_Entry_Body field to N_Subprogram_Body.\n\t* sem_ch6.adb (Analyze_Subprogram_Specification): Remove\n\tmanipulation of Ekind and Corresponding_Protected_Entry added as\n\tpart of the support for varsize-nodes.", "tree": {"sha": "ed57013d5f603f8772245087fdcb7bbf4db09e25", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/ed57013d5f603f8772245087fdcb7bbf4db09e25"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/7c82737c72c030bdf9724ba5201b96824e689765", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/7c82737c72c030bdf9724ba5201b96824e689765", "html_url": "https://github.com/Rust-GCC/gccrs/commit/7c82737c72c030bdf9724ba5201b96824e689765", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/7c82737c72c030bdf9724ba5201b96824e689765/comments", "author": {"login": "ptroja", "id": 161602, "node_id": "MDQ6VXNlcjE2MTYwMg==", "avatar_url": "https://avatars.githubusercontent.com/u/161602?v=4", "gravatar_id": "", "url": "https://api.github.com/users/ptroja", "html_url": "https://github.com/ptroja", "followers_url": "https://api.github.com/users/ptroja/followers", "following_url": "https://api.github.com/users/ptroja/following{/other_user}", "gists_url": "https://api.github.com/users/ptroja/gists{/gist_id}", "starred_url": "https://api.github.com/users/ptroja/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/ptroja/subscriptions", "organizations_url": "https://api.github.com/users/ptroja/orgs", "repos_url": "https://api.github.com/users/ptroja/repos", "events_url": "https://api.github.com/users/ptroja/events{/privacy}", "received_events_url": "https://api.github.com/users/ptroja/received_events", "type": "User", "site_admin": false}, "committer": {"login": "pmderodat", "id": 758452, "node_id": "MDQ6VXNlcjc1ODQ1Mg==", "avatar_url": "https://avatars.githubusercontent.com/u/758452?v=4", "gravatar_id": "", "url": "https://api.github.com/users/pmderodat", "html_url": "https://github.com/pmderodat", "followers_url": "https://api.github.com/users/pmderodat/followers", "following_url": "https://api.github.com/users/pmderodat/following{/other_user}", "gists_url": "https://api.github.com/users/pmderodat/gists{/gist_id}", "starred_url": "https://api.github.com/users/pmderodat/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/pmderodat/subscriptions", "organizations_url": "https://api.github.com/users/pmderodat/orgs", "repos_url": "https://api.github.com/users/pmderodat/repos", "events_url": "https://api.github.com/users/pmderodat/events{/privacy}", "received_events_url": "https://api.github.com/users/pmderodat/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "9fd8b9fa38ea47692abaf886ba2c30053e71623c", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/9fd8b9fa38ea47692abaf886ba2c30053e71623c", "html_url": "https://github.com/Rust-GCC/gccrs/commit/9fd8b9fa38ea47692abaf886ba2c30053e71623c"}], "stats": {"total": 36, "additions": 11, "deletions": 25}, "files": [{"sha": "7428eadfb433f5933b869f8ad3ad527481918424", "filename": "gcc/ada/einfo.ads", "status": "modified", "additions": 0, "deletions": 4, "changes": 4, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/7c82737c72c030bdf9724ba5201b96824e689765/gcc%2Fada%2Feinfo.ads", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/7c82737c72c030bdf9724ba5201b96824e689765/gcc%2Fada%2Feinfo.ads", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fada%2Feinfo.ads?ref=7c82737c72c030bdf9724ba5201b96824e689765", "patch": "@@ -786,10 +786,6 @@ package Einfo is\n --       Modify_Tree_For_C is set. Denotes the internally built procedure\n --       with an extra out parameter created for it.\n \n---    Corresponding_Protected_Entry (Node18)\n---       Defined in subprogram bodies. Set for subprogram bodies that implement\n---       a protected type entry to point to the entity for the entry.\n-\n --    Corresponding_Record_Component (Node21)\n --       Defined in components of a derived untagged record type, including\n --       discriminants. For a regular component or a girder discriminant,"}, {"sha": "8d17db8dc19f3706976e0c08744f859e6a395953", "filename": "gcc/ada/exp_ch9.adb", "status": "modified", "additions": 4, "deletions": 4, "changes": 8, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/7c82737c72c030bdf9724ba5201b96824e689765/gcc%2Fada%2Fexp_ch9.adb", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/7c82737c72c030bdf9724ba5201b96824e689765/gcc%2Fada%2Fexp_ch9.adb", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fada%2Fexp_ch9.adb?ref=7c82737c72c030bdf9724ba5201b96824e689765", "patch": "@@ -3779,10 +3779,6 @@ package body Exp_Ch9 is\n                raise Program_Error;\n          end case;\n \n-         --  Establish link between subprogram body entity and source entry\n-\n-         Set_Corresponding_Protected_Entry (Bod_Id, Ent);\n-\n          --  Create body of entry procedure. The renaming declarations are\n          --  placed ahead of the block that contains the actual entry body.\n \n@@ -3816,6 +3812,10 @@ package body Exp_Ch9 is\n                                New_Occurrence_Of\n                                  (RTE (RE_Get_GNAT_Exception), Loc)))))))));\n \n+         --  Establish link between subprogram body and source entry body\n+\n+         Set_Corresponding_Entry_Body (Proc_Body, N);\n+\n          Reset_Scopes_To (Proc_Body, Protected_Body_Subprogram (Ent));\n          return Proc_Body;\n       end if;"}, {"sha": "c26b25e742fe071d7aade108b0d2653af8a98ca5", "filename": "gcc/ada/gen_il-fields.ads", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/7c82737c72c030bdf9724ba5201b96824e689765/gcc%2Fada%2Fgen_il-fields.ads", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/7c82737c72c030bdf9724ba5201b96824e689765/gcc%2Fada%2Fgen_il-fields.ads", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fada%2Fgen_il-fields.ads?ref=7c82737c72c030bdf9724ba5201b96824e689765", "patch": "@@ -113,6 +113,7 @@ package Gen_IL.Fields is\n       Convert_To_Return_False,\n       Corresponding_Aspect,\n       Corresponding_Body,\n+      Corresponding_Entry_Body,\n       Corresponding_Formal_Spec,\n       Corresponding_Generic_Association,\n       Corresponding_Integer_Value,\n@@ -464,7 +465,6 @@ package Gen_IL.Fields is\n       Corresponding_Equality,\n       Corresponding_Function,\n       Corresponding_Procedure,\n-      Corresponding_Protected_Entry,\n       Corresponding_Record_Component,\n       Corresponding_Record_Type,\n       Corresponding_Remote_Type,"}, {"sha": "fd75f588a825df51d5c88ed1c51ac9aabec0f245", "filename": "gcc/ada/gen_il-gen-gen_entities.adb", "status": "modified", "additions": 0, "deletions": 2, "changes": 2, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/7c82737c72c030bdf9724ba5201b96824e689765/gcc%2Fada%2Fgen_il-gen-gen_entities.adb", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/7c82737c72c030bdf9724ba5201b96824e689765/gcc%2Fada%2Fgen_il-gen-gen_entities.adb", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fada%2Fgen_il-gen-gen_entities.adb?ref=7c82737c72c030bdf9724ba5201b96824e689765", "patch": "@@ -244,7 +244,6 @@ begin -- Gen_IL.Gen.Gen_Entities\n         Sm (Scope_Depth_Value, Uint),\n         Sm (SPARK_Pragma, Node_Id),\n         Sm (SPARK_Pragma_Inherited, Flag),\n-        Sm (Corresponding_Protected_Entry, Node_Id), -- setter only\n         Sm (Current_Value, Node_Id), -- setter only\n         Sm (Has_Predicates, Flag), -- setter only\n         Sm (Initialization_Statements, Node_Id), -- setter only\n@@ -1245,7 +1244,6 @@ begin -- Gen_IL.Gen.Gen_Entities\n    Cc (E_Subprogram_Body, Entity_Kind,\n        (Sm (Anonymous_Masters, Elist_Id),\n         Sm (Contract, Node_Id),\n-        Sm (Corresponding_Protected_Entry, Node_Id),\n         Sm (Extra_Formals, Node_Id),\n         Sm (First_Entity, Node_Id),\n         Sm (Ignore_SPARK_Mode_Pragmas, Flag),"}, {"sha": "d02e2d463df897d6bd971f10dfcdc6441c9740aa", "filename": "gcc/ada/gen_il-gen-gen_nodes.adb", "status": "modified", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/7c82737c72c030bdf9724ba5201b96824e689765/gcc%2Fada%2Fgen_il-gen-gen_nodes.adb", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/7c82737c72c030bdf9724ba5201b96824e689765/gcc%2Fada%2Fgen_il-gen-gen_nodes.adb", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fada%2Fgen_il-gen-gen_nodes.adb?ref=7c82737c72c030bdf9724ba5201b96824e689765", "patch": "@@ -790,6 +790,7 @@ begin -- Gen_IL.Gen.Gen_Nodes\n         Sy (Bad_Is_Detected, Flag),\n         Sm (Activation_Chain_Entity, Node_Id),\n         Sm (Acts_As_Spec, Flag),\n+        Sm (Corresponding_Entry_Body, Node_Id),\n         Sm (Do_Storage_Check, Flag),\n         Sm (Has_Relative_Deadline_Pragma, Flag),\n         Sm (Is_Entry_Barrier_Function, Flag),"}, {"sha": "c2b5c4d59b7b43ecc9a29face4117ccaea1ff3fb", "filename": "gcc/ada/sem_ch6.adb", "status": "modified", "additions": 1, "deletions": 14, "changes": 15, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/7c82737c72c030bdf9724ba5201b96824e689765/gcc%2Fada%2Fsem_ch6.adb", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/7c82737c72c030bdf9724ba5201b96824e689765/gcc%2Fada%2Fsem_ch6.adb", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fada%2Fsem_ch6.adb?ref=7c82737c72c030bdf9724ba5201b96824e689765", "patch": "@@ -5789,21 +5789,8 @@ package body Sem_Ch6 is\n       if Nkind (N) = N_Function_Specification then\n          Set_Ekind (Designator, E_Function);\n          Set_Mechanism (Designator, Default_Mechanism);\n-\n       else\n-         case Ekind (Designator) is\n-            when E_Subprogram_Body | E_Void =>\n-               Reinit_Field_To_Zero\n-                 (Designator, Corresponding_Protected_Entry);\n-               Set_Ekind (Designator, E_Procedure);\n-\n-            when E_Procedure | E_Generic_Procedure =>\n-               null;\n-\n-            when others =>\n-               pragma Assert (False);\n-         end case;\n-\n+         Set_Ekind (Designator, E_Procedure);\n          Set_Etype (Designator, Standard_Void_Type);\n       end if;\n "}, {"sha": "6a155bedf40334f1c40ce4bcf65b693699f17ff4", "filename": "gcc/ada/sinfo.ads", "status": "modified", "additions": 4, "deletions": 0, "changes": 4, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/7c82737c72c030bdf9724ba5201b96824e689765/gcc%2Fada%2Fsinfo.ads", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/7c82737c72c030bdf9724ba5201b96824e689765/gcc%2Fada%2Fsinfo.ads", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fada%2Fsinfo.ads?ref=7c82737c72c030bdf9724ba5201b96824e689765", "patch": "@@ -1040,6 +1040,10 @@ package Sinfo is\n    --    to the defining entity for the corresponding body (NOT the node for\n    --    the body itself).\n \n+   --    Corresponding_Entry_Body\n+   --    Defined in N_Subprogram_Body. Set for subprogram bodies that implement\n+   --    a protected type entry; points to the body for the entry.\n+\n    --  Corresponding_Formal_Spec (Node3-Sem)\n    --    This field is set in subprogram renaming declarations, where it points\n    --    to the defining entity for a formal subprogram in the case where the"}]}