{"sha": "68871a008e686dbe56ff0b502f2864176a140716", "node_id": "C_kwDOANBUbNoAKDY4ODcxYTAwOGU2ODZkYmU1NmZmMGI1MDJmMjg2NDE3NmExNDA3MTY", "commit": {"author": {"name": "David Malcolm", "email": "dmalcolm@redhat.com", "date": "2022-07-20T00:22:18Z"}, "committer": {"name": "David Malcolm", "email": "dmalcolm@redhat.com", "date": "2022-07-20T00:22:18Z"}, "message": "analyzer: don't track string literals in the store [PR106359]\n\nDoing so speeds up -fanalyzer from taking over 4 hours to under a\nminute on the Linux kernel's sound/soc/codecs/cs47l90.c\n\ngcc/analyzer/ChangeLog:\n\tPR analyzer/106359\n\t* region.h (string_region::tracked_p): New.\n\t* store.cc (binding_cluster::binding_cluster): Move here from\n\tstore.h.  Add assertion that base_region is tracked_p.\n\t* store.h (binding_cluster::binding_cluster): Move to store.cc.\n\nSigned-off-by: David Malcolm <dmalcolm@redhat.com>", "tree": {"sha": "3e344cb2ff5892d013c261908ca32ea3fa3a574d", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/3e344cb2ff5892d013c261908ca32ea3fa3a574d"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/68871a008e686dbe56ff0b502f2864176a140716", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/68871a008e686dbe56ff0b502f2864176a140716", "html_url": "https://github.com/Rust-GCC/gccrs/commit/68871a008e686dbe56ff0b502f2864176a140716", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/68871a008e686dbe56ff0b502f2864176a140716/comments", "author": {"login": "davidmalcolm", "id": 1553248, "node_id": "MDQ6VXNlcjE1NTMyNDg=", "avatar_url": "https://avatars.githubusercontent.com/u/1553248?v=4", "gravatar_id": "", "url": "https://api.github.com/users/davidmalcolm", "html_url": "https://github.com/davidmalcolm", "followers_url": "https://api.github.com/users/davidmalcolm/followers", "following_url": "https://api.github.com/users/davidmalcolm/following{/other_user}", "gists_url": "https://api.github.com/users/davidmalcolm/gists{/gist_id}", "starred_url": "https://api.github.com/users/davidmalcolm/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/davidmalcolm/subscriptions", "organizations_url": "https://api.github.com/users/davidmalcolm/orgs", "repos_url": "https://api.github.com/users/davidmalcolm/repos", "events_url": "https://api.github.com/users/davidmalcolm/events{/privacy}", "received_events_url": "https://api.github.com/users/davidmalcolm/received_events", "type": "User", "site_admin": false}, "committer": {"login": "davidmalcolm", "id": 1553248, "node_id": "MDQ6VXNlcjE1NTMyNDg=", "avatar_url": "https://avatars.githubusercontent.com/u/1553248?v=4", "gravatar_id": "", "url": "https://api.github.com/users/davidmalcolm", "html_url": "https://github.com/davidmalcolm", "followers_url": "https://api.github.com/users/davidmalcolm/followers", "following_url": "https://api.github.com/users/davidmalcolm/following{/other_user}", "gists_url": "https://api.github.com/users/davidmalcolm/gists{/gist_id}", "starred_url": "https://api.github.com/users/davidmalcolm/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/davidmalcolm/subscriptions", "organizations_url": "https://api.github.com/users/davidmalcolm/orgs", "repos_url": "https://api.github.com/users/davidmalcolm/repos", "events_url": "https://api.github.com/users/davidmalcolm/events{/privacy}", "received_events_url": "https://api.github.com/users/davidmalcolm/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "7c0c10db24f5c7f8c30810699fb0aff3c900d41a", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/7c0c10db24f5c7f8c30810699fb0aff3c900d41a", "html_url": "https://github.com/Rust-GCC/gccrs/commit/7c0c10db24f5c7f8c30810699fb0aff3c900d41a"}], "stats": {"total": 15, "additions": 12, "deletions": 3}, "files": [{"sha": "fd0d4a05cc9c2fca3f3932e3222a15dc3011ddf8", "filename": "gcc/analyzer/region.h", "status": "modified", "additions": 4, "deletions": 0, "changes": 4, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/68871a008e686dbe56ff0b502f2864176a140716/gcc%2Fanalyzer%2Fregion.h", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/68871a008e686dbe56ff0b502f2864176a140716/gcc%2Fanalyzer%2Fregion.h", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fanalyzer%2Fregion.h?ref=68871a008e686dbe56ff0b502f2864176a140716", "patch": "@@ -1151,6 +1151,10 @@ class string_region : public region\n \n   void dump_to_pp (pretty_printer *pp, bool simple) const final override;\n \n+  /* We assume string literals are immutable, so we don't track them in\n+     the store.  */\n+  bool tracked_p () const final override { return false; }\n+\n   tree get_string_cst () const { return m_string_cst; }\n \n private:"}, {"sha": "e3dabf300df44618a45a3a5d802542937d2ee25b", "filename": "gcc/analyzer/store.cc", "status": "modified", "additions": 7, "deletions": 0, "changes": 7, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/68871a008e686dbe56ff0b502f2864176a140716/gcc%2Fanalyzer%2Fstore.cc", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/68871a008e686dbe56ff0b502f2864176a140716/gcc%2Fanalyzer%2Fstore.cc", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fanalyzer%2Fstore.cc?ref=68871a008e686dbe56ff0b502f2864176a140716", "patch": "@@ -1103,6 +1103,13 @@ binding_map::remove_overlapping_bindings (store_manager *mgr,\n \n /* class binding_cluster.  */\n \n+binding_cluster::binding_cluster (const region *base_region)\n+: m_base_region (base_region), m_map (),\n+  m_escaped (false), m_touched (false)\n+{\n+  gcc_assert (base_region->tracked_p ());\n+}\n+\n /* binding_cluster's copy ctor.  */\n \n binding_cluster::binding_cluster (const binding_cluster &other)"}, {"sha": "9b54c7b915656e95847b0ca90b75f1f9f37d694f", "filename": "gcc/analyzer/store.h", "status": "modified", "additions": 1, "deletions": 3, "changes": 4, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/68871a008e686dbe56ff0b502f2864176a140716/gcc%2Fanalyzer%2Fstore.h", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/68871a008e686dbe56ff0b502f2864176a140716/gcc%2Fanalyzer%2Fstore.h", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fanalyzer%2Fstore.h?ref=68871a008e686dbe56ff0b502f2864176a140716", "patch": "@@ -544,9 +544,7 @@ class binding_cluster\n   typedef hash_map <const binding_key *, const svalue *> map_t;\n   typedef map_t::iterator iterator_t;\n \n-  binding_cluster (const region *base_region)\n-  : m_base_region (base_region), m_map (),\n-    m_escaped (false), m_touched (false) {}\n+  binding_cluster (const region *base_region);\n   binding_cluster (const binding_cluster &other);\n   binding_cluster& operator=(const binding_cluster &other);\n "}]}