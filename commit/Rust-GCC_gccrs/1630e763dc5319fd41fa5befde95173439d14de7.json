{"sha": "1630e763dc5319fd41fa5befde95173439d14de7", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6MTYzMGU3NjNkYzUzMTlmZDQxZmE1YmVmZGU5NTE3MzQzOWQxNGRlNw==", "commit": {"author": {"name": "Alexey Starovoytov", "email": "alexey.starovoytov@sun.com", "date": "2005-10-18T03:16:21Z"}, "committer": {"name": "Ian Lance Taylor", "email": "ian@gcc.gnu.org", "date": "2005-10-18T03:16:21Z"}, "message": "re PR middle-end/23522 (fold_widened_comparison bug)\n\n\tPR middle-end/23522\n\t* fold-const.c (fold_widened_comparison): Do not allow range based\n\tconstant folding when right operand cannot be unwidened.\n\nCo-Authored-By: Ian Lance Taylor <ian@airs.com>\n\nFrom-SVN: r105536", "tree": {"sha": "e871f3f34d248055c32dd92bd09a939c84f28016", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/e871f3f34d248055c32dd92bd09a939c84f28016"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/1630e763dc5319fd41fa5befde95173439d14de7", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/1630e763dc5319fd41fa5befde95173439d14de7", "html_url": "https://github.com/Rust-GCC/gccrs/commit/1630e763dc5319fd41fa5befde95173439d14de7", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/1630e763dc5319fd41fa5befde95173439d14de7/comments", "author": null, "committer": null, "parents": [{"sha": "74395677b78fbb5ce35c444f5977b087ebe1a759", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/74395677b78fbb5ce35c444f5977b087ebe1a759", "html_url": "https://github.com/Rust-GCC/gccrs/commit/74395677b78fbb5ce35c444f5977b087ebe1a759"}], "stats": {"total": 13, "additions": 10, "deletions": 3}, "files": [{"sha": "439ea318c23d26cae5db8dd40e37c1096bb7ef30", "filename": "gcc/ChangeLog", "status": "modified", "additions": 7, "deletions": 0, "changes": 7, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/1630e763dc5319fd41fa5befde95173439d14de7/gcc%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/1630e763dc5319fd41fa5befde95173439d14de7/gcc%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2FChangeLog?ref=1630e763dc5319fd41fa5befde95173439d14de7", "patch": "@@ -1,3 +1,10 @@\n+2005-10-17  Alexey Starovoytov  <alexey.starovoytov@sun.com>\n+            Ian Lance Taylor <ian@airs.com>\n+\n+\tPR middle-end/23522\n+\t* fold-const.c (fold_widened_comparison): Do not allow range based\n+\tconstant folding when right operand cannot be unwidened.\n+\n 2005-10-17  Richard Henderson  <rth@redhat.com>\n \n \t* builtins.c (expand_builtin_synchronize): Build a new-style asm"}, {"sha": "a6aa1df818c4785f6eadfb36f54b90985b3eb2ee", "filename": "gcc/fold-const.c", "status": "modified", "additions": 3, "deletions": 3, "changes": 6, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/1630e763dc5319fd41fa5befde95173439d14de7/gcc%2Ffold-const.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/1630e763dc5319fd41fa5befde95173439d14de7/gcc%2Ffold-const.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ffold-const.c?ref=1630e763dc5319fd41fa5befde95173439d14de7", "patch": "@@ -6250,8 +6250,6 @@ fold_widened_comparison (enum tree_code code, tree type, tree arg0, tree arg1)\n     return NULL_TREE;\n \n   arg1_unw = get_unwidened (arg1, shorter_type);\n-  if (!arg1_unw)\n-    return NULL_TREE;\n \n   /* If possible, express the comparison in the shorter mode.  */\n   if ((code == EQ_EXPR || code == NE_EXPR\n@@ -6264,7 +6262,9 @@ fold_widened_comparison (enum tree_code code, tree type, tree arg0, tree arg1)\n     return fold_build2 (code, type, arg0_unw,\n \t\t       fold_convert (shorter_type, arg1_unw));\n \n-  if (TREE_CODE (arg1_unw) != INTEGER_CST)\n+  if (TREE_CODE (arg1_unw) != INTEGER_CST\n+      || TREE_CODE (shorter_type) != INTEGER_TYPE\n+      || !int_fits_type_p (arg1_unw, shorter_type))\n     return NULL_TREE;\n \n   /* If we are comparing with the integer that does not fit into the range"}]}