{"sha": "0f59f5c12003e547e7557cc09da39c2abd63403d", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6MGY1OWY1YzEyMDAzZTU0N2U3NTU3Y2MwOWRhMzljMmFiZDYzNDAzZA==", "commit": {"author": {"name": "Ian Lance Taylor", "email": "ian@gcc.gnu.org", "date": "2015-01-16T23:23:31Z"}, "committer": {"name": "Ian Lance Taylor", "email": "ian@gcc.gnu.org", "date": "2015-01-16T23:23:31Z"}, "message": "runtime: Add __sparc__ case for SETCONTEXT_CLOBBERS_TLS.\n\nThe glibc setcontext incorrectly modifies %g7 on SPARC.\n\nFrom Richard Henderson.\n\nFrom-SVN: r219778", "tree": {"sha": "6f0b23e0fef3a29053254871f5eb212e6e6397bb", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/6f0b23e0fef3a29053254871f5eb212e6e6397bb"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/0f59f5c12003e547e7557cc09da39c2abd63403d", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/0f59f5c12003e547e7557cc09da39c2abd63403d", "html_url": "https://github.com/Rust-GCC/gccrs/commit/0f59f5c12003e547e7557cc09da39c2abd63403d", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/0f59f5c12003e547e7557cc09da39c2abd63403d/comments", "author": null, "committer": null, "parents": [{"sha": "20780a006fd26d5d6e97d81de479a7813f7ce05f", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/20780a006fd26d5d6e97d81de479a7813f7ce05f", "html_url": "https://github.com/Rust-GCC/gccrs/commit/20780a006fd26d5d6e97d81de479a7813f7ce05f"}], "stats": {"total": 24, "additions": 24, "deletions": 0}, "files": [{"sha": "da0f2ed3a75ab3a40312eff6647e2d22b7abff77", "filename": "libgo/runtime/proc.c", "status": "modified", "additions": 24, "deletions": 0, "changes": 24, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/0f59f5c12003e547e7557cc09da39c2abd63403d/libgo%2Fruntime%2Fproc.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/0f59f5c12003e547e7557cc09da39c2abd63403d/libgo%2Fruntime%2Fproc.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libgo%2Fruntime%2Fproc.c?ref=0f59f5c12003e547e7557cc09da39c2abd63403d", "patch": "@@ -126,6 +126,30 @@ fixcontext(ucontext_t* c)\n \tc->uc_mcontext._mc_tlsbase = tlsbase;\n }\n \n+# elif defined(__sparc__)\n+\n+static inline void\n+initcontext(void)\n+{\n+}\n+\n+static inline void\n+fixcontext(ucontext_t *c)\n+{\n+\t/* ??? Using \n+\t     register unsigned long thread __asm__(\"%g7\");\n+\t     c->uc_mcontext.gregs[REG_G7] = thread;\n+\t   results in\n+\t     error: variable \u2018thread\u2019 might be clobbered by \\\n+\t\t\u2018longjmp\u2019 or \u2018vfork\u2019 [-Werror=clobbered]\n+\t   which ought to be false, as %g7 is a fixed register.  */\n+\n+\tif (sizeof (c->uc_mcontext.gregs[REG_G7]) == 8)\n+\t\tasm (\"stx %%g7, %0\" : \"=m\"(c->uc_mcontext.gregs[REG_G7]));\n+\telse\n+\t\tasm (\"st %%g7, %0\" : \"=m\"(c->uc_mcontext.gregs[REG_G7]));\n+}\n+\n # else\n \n #  error unknown case for SETCONTEXT_CLOBBERS_TLS"}]}