{"sha": "4a61cf9c62212fd04f21704efc2decffe9544651", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6NGE2MWNmOWM2MjIxMmZkMDRmMjE3MDRlZmMyZGVjZmZlOTU0NDY1MQ==", "commit": {"author": {"name": "Jeff Law", "email": "law@redhat.com", "date": "2019-06-26T18:00:00Z"}, "committer": {"name": "Jeff Law", "email": "law@gcc.gnu.org", "date": "2019-06-26T18:00:00Z"}, "message": "tree-ssa-dse.c (initialize_ao_ref_for_dse): Handle _chk variants of memcpy, memmove and memset builtins.\n\n\t* tree-ssa-dse.c (initialize_ao_ref_for_dse): Handle _chk variants of\n\tmemcpy, memmove and memset builtins.\n\t(maybe_trim_memstar_call): Likewise.\n\n\t* gcc.c-torture/execute/builtins/builtins.exp: Add -fno-tree-dse\n\tas DSE compromises several of these tests.\n\t* gcc.dg/builtin-stringop-chk-1.c: Similarly.\n\t* gcc.dg/memcpy-2.c: Similarly.\n\t* gcc.dg/pr40340-1.c: Similarly.\n\t* gcc.dg/pr40340-2.c: Similarly.\n\t* gcc.dg/pr40340-5.c: Similarly.\n\nFrom-SVN: r272704", "tree": {"sha": "8a77e9e1bb86fbebcf8adcaa6f027ce901a2a13b", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/8a77e9e1bb86fbebcf8adcaa6f027ce901a2a13b"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/4a61cf9c62212fd04f21704efc2decffe9544651", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/4a61cf9c62212fd04f21704efc2decffe9544651", "html_url": "https://github.com/Rust-GCC/gccrs/commit/4a61cf9c62212fd04f21704efc2decffe9544651", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/4a61cf9c62212fd04f21704efc2decffe9544651/comments", "author": null, "committer": null, "parents": [{"sha": "f363fc5b49cb83aa98d89efa98fe42f57af4de05", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/f363fc5b49cb83aa98d89efa98fe42f57af4de05", "html_url": "https://github.com/Rust-GCC/gccrs/commit/f363fc5b49cb83aa98d89efa98fe42f57af4de05"}], "stats": {"total": 37, "additions": 31, "deletions": 6}, "files": [{"sha": "af5afa638b6d0940d75a6d8313c1ff18707ee2f9", "filename": "gcc/ChangeLog", "status": "modified", "additions": 6, "deletions": 0, "changes": 6, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/4a61cf9c62212fd04f21704efc2decffe9544651/gcc%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/4a61cf9c62212fd04f21704efc2decffe9544651/gcc%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2FChangeLog?ref=4a61cf9c62212fd04f21704efc2decffe9544651", "patch": "@@ -1,3 +1,9 @@\n+2019-06-26  Jeff Law  <law@redhat.com>\n+\n+\t* tree-ssa-dse.c (initialize_ao_ref_for_dse): Handle _chk variants of\n+\tmemcpy, memmove and memset builtins.\n+\t(maybe_trim_memstar_call): Likewise.\n+\n 2019-06-26  David Edelsohn  <dje.gcc@gmail.com>\n \n \t* config/rs6000/rs6000-logue.c: Add #ifndef TARGET_PROFILE_KERNEL."}, {"sha": "eb9f6cc9921e69535b25126b9b6127dfc10ddab2", "filename": "gcc/testsuite/ChangeLog", "status": "modified", "additions": 10, "deletions": 0, "changes": 10, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/4a61cf9c62212fd04f21704efc2decffe9544651/gcc%2Ftestsuite%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/4a61cf9c62212fd04f21704efc2decffe9544651/gcc%2Ftestsuite%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2FChangeLog?ref=4a61cf9c62212fd04f21704efc2decffe9544651", "patch": "@@ -1,3 +1,13 @@\n+2019-06-26  Jeff Law  <law@redhat.com>\n+\n+\t* gcc.c-torture/execute/builtins/builtins.exp: Add -fno-tree-dse\n+\tas DSE compromises several of these tests.\n+\t* gcc.dg/builtin-stringop-chk-1.c: Similarly.\n+\t* gcc.dg/memcpy-2.c: Similarly.\n+\t* gcc.dg/pr40340-1.c: Similarly.\n+\t* gcc.dg/pr40340-2.c: Similarly.\n+\t* gcc.dg/pr40340-5.c: Similarly.\n+\n 2019-06-26  Steven G. Kargl  <kargl@gcc.gnu.org>\n \n \tPR Fortran/90988"}, {"sha": "fb9d3ece181fee3489e1ddd2f72f40dbbf807bb6", "filename": "gcc/testsuite/gcc.c-torture/execute/builtins/builtins.exp", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/4a61cf9c62212fd04f21704efc2decffe9544651/gcc%2Ftestsuite%2Fgcc.c-torture%2Fexecute%2Fbuiltins%2Fbuiltins.exp", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/4a61cf9c62212fd04f21704efc2decffe9544651/gcc%2Ftestsuite%2Fgcc.c-torture%2Fexecute%2Fbuiltins%2Fbuiltins.exp", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgcc.c-torture%2Fexecute%2Fbuiltins%2Fbuiltins.exp?ref=4a61cf9c62212fd04f21704efc2decffe9544651", "patch": "@@ -37,7 +37,7 @@ load_lib c-torture.exp\n torture-init\n set-torture-options $C_TORTURE_OPTIONS {{}} $LTO_TORTURE_OPTIONS\n \n-set additional_flags \"-fno-tree-loop-distribute-patterns -fno-tracer\"\n+set additional_flags \"-fno-tree-dse -fno-tree-loop-distribute-patterns -fno-tracer\"\n if [istarget \"powerpc-*-darwin*\"] {\n    lappend additional_flags \"-Wl,-multiply_defined,suppress\"\n }"}, {"sha": "40cfa0472901ff35ae0f6fb929133158ce80f3c9", "filename": "gcc/testsuite/gcc.dg/builtin-stringop-chk-1.c", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/4a61cf9c62212fd04f21704efc2decffe9544651/gcc%2Ftestsuite%2Fgcc.dg%2Fbuiltin-stringop-chk-1.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/4a61cf9c62212fd04f21704efc2decffe9544651/gcc%2Ftestsuite%2Fgcc.dg%2Fbuiltin-stringop-chk-1.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgcc.dg%2Fbuiltin-stringop-chk-1.c?ref=4a61cf9c62212fd04f21704efc2decffe9544651", "patch": "@@ -1,7 +1,7 @@\n /* Test whether buffer overflow warnings for __*_chk builtins\n    are emitted properly.  */\n /* { dg-do compile } */\n-/* { dg-options \"-O2 -Wno-format -std=gnu99 -ftrack-macro-expansion=0\" } */\n+/* { dg-options \"-O2 -Wno-format -std=gnu99 -ftrack-macro-expansion=0 -fno-tree-dse\" } */\n // { dg-skip-if \"packed attribute missing for t\" { \"epiphany-*-*\" } }\n \n extern void abort (void);"}, {"sha": "6ad887416e3ae9cea842e07084d9366dffab4291", "filename": "gcc/testsuite/gcc.dg/memcpy-2.c", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/4a61cf9c62212fd04f21704efc2decffe9544651/gcc%2Ftestsuite%2Fgcc.dg%2Fmemcpy-2.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/4a61cf9c62212fd04f21704efc2decffe9544651/gcc%2Ftestsuite%2Fgcc.dg%2Fmemcpy-2.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgcc.dg%2Fmemcpy-2.c?ref=4a61cf9c62212fd04f21704efc2decffe9544651", "patch": "@@ -1,6 +1,6 @@\n /* PR middle-end/38454 */\n /* { dg-do compile } */\n-/* { dg-options \"-O2\" } */\n+/* { dg-options \"-O2 -fno-tree-dse\" } */\n \n typedef __SIZE_TYPE__ size_t;\n "}, {"sha": "6307e064c3d1a5754e8daef643caf0de7d52bd4c", "filename": "gcc/testsuite/gcc.dg/pr40340-1.c", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/4a61cf9c62212fd04f21704efc2decffe9544651/gcc%2Ftestsuite%2Fgcc.dg%2Fpr40340-1.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/4a61cf9c62212fd04f21704efc2decffe9544651/gcc%2Ftestsuite%2Fgcc.dg%2Fpr40340-1.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgcc.dg%2Fpr40340-1.c?ref=4a61cf9c62212fd04f21704efc2decffe9544651", "patch": "@@ -1,6 +1,6 @@\n /* PR middle-end/40340 */\n /* { dg-do compile } */\n-/* { dg-options \"-O2 -Wall -Wno-system-headers\" } */\n+/* { dg-options \"-O2 -Wall -Wno-system-headers -fno-tree-dse\" } */\n \n #include \"pr40340.h\"\n "}, {"sha": "ea76e10082d7658ac0a6551a112ff69c7dbad7be", "filename": "gcc/testsuite/gcc.dg/pr40340-2.c", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/4a61cf9c62212fd04f21704efc2decffe9544651/gcc%2Ftestsuite%2Fgcc.dg%2Fpr40340-2.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/4a61cf9c62212fd04f21704efc2decffe9544651/gcc%2Ftestsuite%2Fgcc.dg%2Fpr40340-2.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgcc.dg%2Fpr40340-2.c?ref=4a61cf9c62212fd04f21704efc2decffe9544651", "patch": "@@ -1,6 +1,6 @@\n /* PR middle-end/40340 */\n /* { dg-do compile } */\n-/* { dg-options \"-O2 -Wall -Wno-system-headers\" } */\n+/* { dg-options \"-O2 -Wall -Wno-system-headers -fno-tree-dse\" } */\n \n #include \"pr40340.h\"\n "}, {"sha": "99e58f2ab7ff28f91eb9aa64a174f3ddd761fb2b", "filename": "gcc/testsuite/gcc.dg/pr40340-5.c", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/4a61cf9c62212fd04f21704efc2decffe9544651/gcc%2Ftestsuite%2Fgcc.dg%2Fpr40340-5.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/4a61cf9c62212fd04f21704efc2decffe9544651/gcc%2Ftestsuite%2Fgcc.dg%2Fpr40340-5.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgcc.dg%2Fpr40340-5.c?ref=4a61cf9c62212fd04f21704efc2decffe9544651", "patch": "@@ -1,6 +1,6 @@\n /* PR middle-end/40340 */\n /* { dg-do compile } */\n-/* { dg-options \"-O2 -Wall -Wsystem-headers -g\" } */\n+/* { dg-options \"-O2 -Wall -Wsystem-headers -g -fno-tree-dse\" } */\n \n #define TEST3\n #include \"pr40340.h\""}, {"sha": "ea71f49ef8ca614743fddf3ef13e6568eba86122", "filename": "gcc/tree-ssa-dse.c", "status": "modified", "additions": 9, "deletions": 0, "changes": 9, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/4a61cf9c62212fd04f21704efc2decffe9544651/gcc%2Ftree-ssa-dse.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/4a61cf9c62212fd04f21704efc2decffe9544651/gcc%2Ftree-ssa-dse.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftree-ssa-dse.c?ref=4a61cf9c62212fd04f21704efc2decffe9544651", "patch": "@@ -98,6 +98,9 @@ initialize_ao_ref_for_dse (gimple *stmt, ao_ref *write)\n \t  case BUILT_IN_MEMCPY:\n \t  case BUILT_IN_MEMMOVE:\n \t  case BUILT_IN_MEMSET:\n+\t  case BUILT_IN_MEMCPY_CHK:\n+\t  case BUILT_IN_MEMMOVE_CHK:\n+\t  case BUILT_IN_MEMSET_CHK:\n \t    {\n \t      tree size = NULL_TREE;\n \t      if (gimple_call_num_args (stmt) == 3)\n@@ -434,6 +437,8 @@ maybe_trim_memstar_call (ao_ref *ref, sbitmap live, gimple *stmt)\n     {\n     case BUILT_IN_MEMCPY:\n     case BUILT_IN_MEMMOVE:\n+    case BUILT_IN_MEMCPY_CHK:\n+    case BUILT_IN_MEMMOVE_CHK:\n       {\n \tint head_trim, tail_trim;\n \tcompute_trims (ref, live, &head_trim, &tail_trim, stmt);\n@@ -455,6 +460,7 @@ maybe_trim_memstar_call (ao_ref *ref, sbitmap live, gimple *stmt)\n       }\n \n     case BUILT_IN_MEMSET:\n+    case BUILT_IN_MEMSET_CHK:\n       {\n \tint head_trim, tail_trim;\n \tcompute_trims (ref, live, &head_trim, &tail_trim, stmt);\n@@ -860,6 +866,9 @@ dse_dom_walker::dse_optimize_stmt (gimple_stmt_iterator *gsi)\n \t  case BUILT_IN_MEMCPY:\n \t  case BUILT_IN_MEMMOVE:\n \t  case BUILT_IN_MEMSET:\n+\t  case BUILT_IN_MEMCPY_CHK:\n+\t  case BUILT_IN_MEMMOVE_CHK:\n+\t  case BUILT_IN_MEMSET_CHK:\n \t    {\n \t      /* Occasionally calls with an explicit length of zero\n \t\t show up in the IL.  It's pointless to do analysis"}]}