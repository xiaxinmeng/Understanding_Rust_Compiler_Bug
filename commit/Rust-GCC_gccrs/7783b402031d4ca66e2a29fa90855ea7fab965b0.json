{"sha": "7783b402031d4ca66e2a29fa90855ea7fab965b0", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6Nzc4M2I0MDIwMzFkNGNhNjZlMmEyOWZhOTA4NTVlYTdmYWI5NjViMA==", "commit": {"author": {"name": "Gabriel Dos Reis", "email": "gdr@integrable-solutions.net", "date": "2004-08-30T04:48:34Z"}, "committer": {"name": "Gabriel Dos Reis", "email": "gdr@gcc.gnu.org", "date": "2004-08-30T04:48:34Z"}, "message": "c-opts.c (c_common_handle_option): <case OPT_Werror> set global_dc->warning_as_error_requested.\n\n        * c-opts.c (c_common_handle_option): <case OPT_Werror> set\n        global_dc->warning_as_error_requested.\n        * diagnostic.c (diagnostic_initialize): Tidy.\n        * diagnostic.h (diagnostic_context::x_data): Remove\n        (diagnostic_context::issue_warnings_are_errors_message): Rename\n        from warnings_are_errors_message.\n        (diagnostic_context::warning_as_error_requested): New.\n\nFrom-SVN: r86750", "tree": {"sha": "103c28a53c7590a4369c890c344849d943d7820c", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/103c28a53c7590a4369c890c344849d943d7820c"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/7783b402031d4ca66e2a29fa90855ea7fab965b0", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/7783b402031d4ca66e2a29fa90855ea7fab965b0", "html_url": "https://github.com/Rust-GCC/gccrs/commit/7783b402031d4ca66e2a29fa90855ea7fab965b0", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/7783b402031d4ca66e2a29fa90855ea7fab965b0/comments", "author": {"login": "cxx-undef", "id": 5528103, "node_id": "MDQ6VXNlcjU1MjgxMDM=", "avatar_url": "https://avatars.githubusercontent.com/u/5528103?v=4", "gravatar_id": "", "url": "https://api.github.com/users/cxx-undef", "html_url": "https://github.com/cxx-undef", "followers_url": "https://api.github.com/users/cxx-undef/followers", "following_url": "https://api.github.com/users/cxx-undef/following{/other_user}", "gists_url": "https://api.github.com/users/cxx-undef/gists{/gist_id}", "starred_url": "https://api.github.com/users/cxx-undef/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/cxx-undef/subscriptions", "organizations_url": "https://api.github.com/users/cxx-undef/orgs", "repos_url": "https://api.github.com/users/cxx-undef/repos", "events_url": "https://api.github.com/users/cxx-undef/events{/privacy}", "received_events_url": "https://api.github.com/users/cxx-undef/received_events", "type": "User", "site_admin": false}, "committer": null, "parents": [{"sha": "04204c2fbf4cb7db7e6b1ce8691ef99f7610f0ee", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/04204c2fbf4cb7db7e6b1ce8691ef99f7610f0ee", "html_url": "https://github.com/Rust-GCC/gccrs/commit/04204c2fbf4cb7db7e6b1ce8691ef99f7610f0ee"}], "stats": {"total": 31, "additions": 21, "deletions": 10}, "files": [{"sha": "a9b6627340bc25c01a1e539fc4f97f8d4be9a79c", "filename": "gcc/ChangeLog", "status": "modified", "additions": 11, "deletions": 0, "changes": 11, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/7783b402031d4ca66e2a29fa90855ea7fab965b0/gcc%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/7783b402031d4ca66e2a29fa90855ea7fab965b0/gcc%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2FChangeLog?ref=7783b402031d4ca66e2a29fa90855ea7fab965b0", "patch": "@@ -1,3 +1,14 @@\n+2004-08-29  Gabriel Dos Reis  <gdr@integrable-solutions.net>\n+\n+\tPR c++/15378\n+\t* c-opts.c (c_common_handle_option): <case OPT_Werror> set\n+\tglobal_dc->warning_as_error_requested.\n+\t* diagnostic.c (diagnostic_initialize): Tidy.\n+\t* diagnostic.h (diagnostic_context::x_data): Remove\n+\t(diagnostic_context::issue_warnings_are_errors_message): Rename\n+\tfrom warnings_are_errors_message.\n+\t(diagnostic_context::warning_as_error_requested): New.\n+\n 2004-08-30  Richard Earnshaw  <rearnsha@arm.com>\n \n \t* sched-deps.c (get_condition): Fix breakage in previous patch."}, {"sha": "c16bebe5c385fe26d32d9b18f144a5384de84922", "filename": "gcc/c-opts.c", "status": "modified", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/7783b402031d4ca66e2a29fa90855ea7fab965b0/gcc%2Fc-opts.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/7783b402031d4ca66e2a29fa90855ea7fab965b0/gcc%2Fc-opts.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fc-opts.c?ref=7783b402031d4ca66e2a29fa90855ea7fab965b0", "patch": "@@ -420,6 +420,7 @@ c_common_handle_option (size_t scode, const char *arg, int value)\n \n     case OPT_Werror:\n       cpp_opts->warnings_are_errors = value;\n+      global_dc->warning_as_error_requested = value;\n       break;\n \n     case OPT_Werror_implicit_function_declaration:"}, {"sha": "4fca486d9413a60361ecf6d82209a4a1df8809de", "filename": "gcc/diagnostic.c", "status": "modified", "additions": 5, "deletions": 6, "changes": 11, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/7783b402031d4ca66e2a29fa90855ea7fab965b0/gcc%2Fdiagnostic.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/7783b402031d4ca66e2a29fa90855ea7fab965b0/gcc%2Fdiagnostic.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fdiagnostic.c?ref=7783b402031d4ca66e2a29fa90855ea7fab965b0", "patch": "@@ -107,15 +107,15 @@ diagnostic_initialize (diagnostic_context *context)\n   context->printer->prefixing_rule = DIAGNOSTICS_SHOW_PREFIX_ONCE;\n \n   memset (context->diagnostic_count, 0, sizeof context->diagnostic_count);\n-  context->warnings_are_errors_message = warnings_are_errors;\n+  context->issue_warnings_are_errors_message = true;\n+  context->warning_as_error_requested = false;\n   context->abort_on_error = false;\n   context->internal_error = NULL;\n   diagnostic_starter (context) = default_diagnostic_starter;\n   diagnostic_finalizer (context) = default_diagnostic_finalizer;\n   context->last_module = 0;\n   context->last_function = NULL;\n   context->lock = 0;\n-  context->x_data = NULL;\n }\n \n /* Returns true if the next format specifier in TEXT is a format specifier\n@@ -226,17 +226,16 @@ diagnostic_count_diagnostic (diagnostic_context *context,\n       if (!diagnostic_report_warnings_p ())\n         return false;\n \n-      if (!warnings_are_errors)\n+      if (!context->warning_as_error_requested)\n         {\n           ++diagnostic_kind_count (context, DK_WARNING);\n           break;\n         }\n-\n-      if (context->warnings_are_errors_message)\n+      else if (context->issue_warnings_are_errors_message)\n         {\n \t  pp_verbatim (context->printer,\n                        \"%s: warnings being treated as errors\\n\", progname);\n-          context->warnings_are_errors_message = false;\n+          context->issue_warnings_are_errors_message = false;\n         }\n \n       /* And fall through.  */"}, {"sha": "cc0a911d8f91f03661e8e9ae26e5ce7f5207cbcb", "filename": "gcc/diagnostic.h", "status": "modified", "additions": 4, "deletions": 4, "changes": 8, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/7783b402031d4ca66e2a29fa90855ea7fab965b0/gcc%2Fdiagnostic.h", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/7783b402031d4ca66e2a29fa90855ea7fab965b0/gcc%2Fdiagnostic.h", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fdiagnostic.h?ref=7783b402031d4ca66e2a29fa90855ea7fab965b0", "patch": "@@ -65,7 +65,10 @@ struct diagnostic_context\n \n   /* True if we should display the \"warnings are being tread as error\"\n      message, usually displayed once per compiler run.  */\n-  bool warnings_are_errors_message;\n+  bool issue_warnings_are_errors_message;\n+  \n+  /* True if it has been requested that warnings be treated as errors.  */\n+  bool warning_as_error_requested;\n \n   /* True if we should raise a SIGABRT on errors.  */\n   bool abort_on_error;\n@@ -94,9 +97,6 @@ struct diagnostic_context\n   int last_module;\n \n   int lock;\n-  \n-  /* Hook for front-end extensions.  */\n-  void *x_data;\n };\n \n /* Client supplied function to announce a diagnostic.  */"}]}