{"sha": "2ce3c6c615fa735693e1de39e9777919ba4fd106", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6MmNlM2M2YzYxNWZhNzM1NjkzZTFkZTM5ZTk3Nzc5MTliYTRmZDEwNg==", "commit": {"author": {"name": "Jason Merrill", "email": "jason@yorick.cygnus.com", "date": "1998-08-13T17:29:30Z"}, "committer": {"name": "Jason Merrill", "email": "jason@gcc.gnu.org", "date": "1998-08-13T17:29:30Z"}, "message": "tree.h: De-conditionalize init_priority code.\n\n\t* tree.h: De-conditionalize init_priority code.\n\t* mips.h (NM_FLAGS): Change from -Bp to -Bn.\n\t* collect2.c (NM_FLAGS): Change from -p to -n.\n\t* configure.in: Turn on collect2 for mipstx39-elf.\n\tHandle use_collect2=no properly.\n\t* c-common.c: De-conditionalize init_priority code.\n\t* collect2.c (extract_init_priority, sort_ids): New fns.\n\t(main): Call sort_ids.\n\tMove sequence_number to file scope.\n\t* configure.in: Handle --enable-init-priority.\n\t* c-common.c (attrs): Add A_INIT_PRIORITY.\n\t(init_attributes, decl_attributes): Likewise.\n\t* tree.h (DEFAULT_INIT_PRIORITY, MAX_INIT_PRIORITY): New macros.\n\t* tree.c (get_file_function_name_long): Split out...\n\t(get_file_function_name): ...from here.\ncp/:\n\t* lang-options.h: Add -finit-priority.\n\t* decl2.c: Likewise.  Check flag_init_priority instead of\n\tUSE_INIT_PRIORITY.\n\t* decl2.c (setup_initp): New fn.\n\t(start_objects, finish_objects, do_ctors): Handle init_priority.\n\t(do_dtors, finish_file): Likewise.\n\nFrom-SVN: r21701", "tree": {"sha": "5151de01751b24d690444de42bb0d59e3a3d0764", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/5151de01751b24d690444de42bb0d59e3a3d0764"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/2ce3c6c615fa735693e1de39e9777919ba4fd106", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/2ce3c6c615fa735693e1de39e9777919ba4fd106", "html_url": "https://github.com/Rust-GCC/gccrs/commit/2ce3c6c615fa735693e1de39e9777919ba4fd106", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/2ce3c6c615fa735693e1de39e9777919ba4fd106/comments", "author": null, "committer": null, "parents": [{"sha": "db04386fd134ed6619ea9acf279ee245afd440a3", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/db04386fd134ed6619ea9acf279ee245afd440a3", "html_url": "https://github.com/Rust-GCC/gccrs/commit/db04386fd134ed6619ea9acf279ee245afd440a3"}], "stats": {"total": 765, "additions": 615, "deletions": 150}, "files": [{"sha": "eee41bba79a81bce637d4dce233a621fca66d806", "filename": "gcc/ChangeLog", "status": "modified", "additions": 22, "deletions": 0, "changes": 22, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/2ce3c6c615fa735693e1de39e9777919ba4fd106/gcc%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/2ce3c6c615fa735693e1de39e9777919ba4fd106/gcc%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2FChangeLog?ref=2ce3c6c615fa735693e1de39e9777919ba4fd106", "patch": "@@ -1,3 +1,25 @@\n+Thu Aug 13 17:08:11 1998  Jason Merrill  <jason@yorick.cygnus.com>\n+\n+\t* tree.h: De-conditionalize init_priority code.\n+\n+\t* mips.h (NM_FLAGS): Change from -Bp to -Bn.\n+\t* collect2.c (NM_FLAGS): Change from -p to -n.\n+\n+\t* configure.in: Turn on collect2 for mipstx39-elf.\n+\tHandle use_collect2=no properly.\n+\n+\t* c-common.c: De-conditionalize init_priority code.\n+\t* collect2.c (extract_init_priority, sort_ids): New fns.\n+\t(main): Call sort_ids.\n+\tMove sequence_number to file scope.\n+\n+\t* configure.in: Handle --enable-init-priority.\n+\t* c-common.c (attrs): Add A_INIT_PRIORITY.\n+\t(init_attributes, decl_attributes): Likewise.\n+\t* tree.h (DEFAULT_INIT_PRIORITY, MAX_INIT_PRIORITY): New macros.\n+\t* tree.c (get_file_function_name_long): Split out...\n+\t(get_file_function_name): ...from here.\n+\n Thu Aug 13 16:09:53 1998  Martin von Loewis  <loewis@informatik.hu-berlin.de>\n \n \t* expr.c (safe_from_p): Change code to ERROR_MARK only when not"}, {"sha": "6f14579f63f216cafc594ed5b8aae5a382e103ca", "filename": "gcc/c-common.c", "status": "modified", "additions": 65, "deletions": 1, "changes": 66, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/2ce3c6c615fa735693e1de39e9777919ba4fd106/gcc%2Fc-common.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/2ce3c6c615fa735693e1de39e9777919ba4fd106/gcc%2Fc-common.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fc-common.c?ref=2ce3c6c615fa735693e1de39e9777919ba4fd106", "patch": "@@ -52,7 +52,8 @@ int skip_evaluation;\n enum attrs {A_PACKED, A_NOCOMMON, A_COMMON, A_NORETURN, A_CONST, A_T_UNION,\n \t    A_NO_INSTRUMENT_FUNCTION,\n \t    A_CONSTRUCTOR, A_DESTRUCTOR, A_MODE, A_SECTION, A_ALIGNED,\n-\t    A_UNUSED, A_FORMAT, A_FORMAT_ARG, A_WEAK, A_ALIAS};\n+\t    A_UNUSED, A_FORMAT, A_FORMAT_ARG, A_WEAK, A_ALIAS,\n+\t    A_INIT_PRIORITY};\n \n enum format_type { printf_format_type, scanf_format_type,\n \t\t   strftime_format_type };\n@@ -89,6 +90,12 @@ static int if_stack_pointer = 0;\n /* Generate RTL for the start of an if-then, and record the start of it\n    for ambiguous else detection.  */\n \n+/* A list of objects which have constructors or destructors which\n+   reside in the global scope, and have an init_priority attribute\n+   associated with them.  The decl is stored in the TREE_VALUE slot\n+   and the priority number is stored in the TREE_PURPOSE slot.  */\n+tree static_aggregates_initp;\n+\n void\n c_expand_start_cond (cond, exitflag, compstmt_count)\n      tree cond;\n@@ -383,6 +390,7 @@ init_attributes ()\n   add_attribute (A_FORMAT_ARG, \"format_arg\", 1, 1, 1);\n   add_attribute (A_WEAK, \"weak\", 0, 0, 1);\n   add_attribute (A_ALIAS, \"alias\", 1, 1, 1);\n+  add_attribute (A_INIT_PRIORITY, \"init_priority\", 0, 1, 0);\n   add_attribute (A_NO_INSTRUMENT_FUNCTION, \"no_instrument_function\", 0, 0, 1);\n }\n \f\n@@ -859,6 +867,62 @@ decl_attributes (node, attributes, prefix_attributes)\n \t    warning (\"`%s' attribute ignored\", IDENTIFIER_POINTER (name));\n \t  break;\n \n+\tcase A_INIT_PRIORITY:\n+\t  {\n+\t    tree initp_expr = (args ? TREE_VALUE (args): NULL_TREE);\n+\t    int pri;\n+\n+\t    if (initp_expr)\n+\t      STRIP_NOPS (initp_expr);\n+\t  \n+\t    if (!initp_expr || TREE_CODE (initp_expr) != INTEGER_CST)\n+\t      {\n+\t\terror (\"requested init_priority is not an integer constant\");\n+\t\tcontinue;\n+\t      }\n+\n+\t    pri = TREE_INT_CST_LOW (initp_expr);\n+\t\n+\t    if (is_type || TREE_CODE (decl) != VAR_DECL\n+\t\t|| ! TREE_STATIC (decl)\n+\t\t|| DECL_EXTERNAL (decl)\n+\t\t|| (TREE_CODE (TREE_TYPE (decl)) != RECORD_TYPE\n+\t\t    && TREE_CODE (TREE_TYPE (decl)) != UNION_TYPE)\n+\t\t/* Static objects in functions are initialized the\n+                   first time control passes through that\n+                   function. This is not precise enough to pin down an\n+                   init_priority value, so don't allow it. */\n+\t\t|| current_function_decl) \n+\t      {\n+\t\terror (\"can only use init_priority attribute on file-scope definitions of objects of class type\");\n+\t\tcontinue; \n+\t      }\n+\n+\t    /* Check for init_priorities that are reserved for\n+               implementation. Reserved for language and runtime\n+               support implementations.*/\n+\t    if ((10 <= pri && pri <= 99)\n+\t\t/* Reserved for standard library implementations. */\n+\t\t|| (500 <= pri && pri <= 999)\n+\t\t/* Reserved for objects with no attributes. */\n+\t\t|| pri > (MAX_INIT_PRIORITY - 50))\n+\t      {\n+\t\twarning\n+\t\t  (\"requested init_priority is reserved for internal use\");\n+\t\tcontinue;\n+\t      }\n+\n+\t    if (pri > MAX_INIT_PRIORITY || pri <= 0)\n+\t      {\n+\t\terror (\"requested init_priority is out of range\");\n+\t\tcontinue;\n+\t      }\n+\n+\t    static_aggregates_initp\n+\t      = perm_tree_cons (initp_expr, decl, static_aggregates_initp);\n+\t    break;\n+\t  }\n+\n \tcase A_NO_INSTRUMENT_FUNCTION:\n \t  if (TREE_CODE (decl) != FUNCTION_DECL)\n \t    {"}, {"sha": "c9b471d4ba818b83c1eb9fb32fef5d008d14c951", "filename": "gcc/collect2.c", "status": "modified", "additions": 70, "deletions": 2, "changes": 72, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/2ce3c6c615fa735693e1de39e9777919ba4fd106/gcc%2Fcollect2.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/2ce3c6c615fa735693e1de39e9777919ba4fd106/gcc%2Fcollect2.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fcollect2.c?ref=2ce3c6c615fa735693e1de39e9777919ba4fd106", "patch": "@@ -137,7 +137,7 @@ extern char *make_temp_file PROTO ((char *));\n \n /* Default flags to pass to nm.  */\n #ifndef NM_FLAGS\n-#define NM_FLAGS \"-p\"\n+#define NM_FLAGS \"-n\"\n #endif\n \n #endif /* OBJECT_FORMAT_NONE */\n@@ -280,6 +280,8 @@ static void do_wait\t\tPROTO((char *));\n static void fork_execute\tPROTO((char *, char **));\n static void maybe_unlink\tPROTO((char *));\n static void add_to_list\t\tPROTO((struct head *, char *));\n+static int  extract_init_priority PROTO((char *));\n+static void sort_ids\t\tPROTO((struct head *));\n static void write_list\t\tPROTO((FILE *, char *, struct id *));\n #ifdef COLLECT_EXPORT_LIST\n static void dump_list\t\tPROTO((FILE *, char *, struct id *));\n@@ -1483,6 +1485,10 @@ main (argc, argv)\n       return 0;\n     }\n \n+  /* Sort ctor and dtor lists by priority. */\n+  sort_ids (&constructors);\n+  sort_ids (&destructors);\n+\n   maybe_unlink(output_file);\n   outf = fopen (c_file, \"w\");\n   if (outf == (FILE *) 0)\n@@ -1697,6 +1703,8 @@ maybe_unlink (file)\n }\n \n \f\n+static long sequence_number = 0;\n+\n /* Add a name to a linked list.  */\n \n static void\n@@ -1707,7 +1715,6 @@ add_to_list (head_ptr, name)\n   struct id *newid\n     = (struct id *) xcalloc (sizeof (struct id) + strlen (name), 1);\n   struct id *p;\n-  static long sequence_number = 0;\n   strcpy (newid->name, name);\n \n   if (head_ptr->first)\n@@ -1732,6 +1739,67 @@ add_to_list (head_ptr, name)\n   head_ptr->number++;\n }\n \n+/* Grab the init priority number from an init function name that\n+   looks like \"_GLOBAL_.I.12345.foo\".  */\n+\n+static int\n+extract_init_priority (name)\n+     char *name;\n+{\n+  int pos = 0;\n+\n+  while (name[pos] == '_')\n+    ++pos;\n+  pos += 10; /* strlen (\"GLOBAL__X_\") */\n+\n+  /* Extract init_p number from ctor/dtor name. */\n+  return strtoul(name + pos, NULL, 10);\n+}\n+\n+/* Insertion sort the ids from ctor/dtor list HEAD_PTR in descending order.\n+   ctors will be run from right to left, dtors from left to right.  */\n+\n+static void\n+sort_ids (head_ptr)\n+     struct head *head_ptr;\n+{\n+  /* id holds the current element to insert.  id_next holds the next\n+     element to insert.  id_ptr iterates through the already sorted elements\n+     looking for the place to insert id.  */\n+  struct id *id, *id_next, **id_ptr;\n+  int i;\n+\n+  id = head_ptr->first;\n+\n+  /* We don't have any sorted elements yet.  */\n+  head_ptr->first = NULL;\n+\n+  for (; id; id = id_next)\n+    {\n+      id_next = id->next;\n+      id->sequence = extract_init_priority (id->name);\n+\n+      for (id_ptr = &(head_ptr->first); ; id_ptr = &((*id_ptr)->next))\n+\tif (*id_ptr == NULL\n+\t    /* If the sequence numbers are the same, we put the id from the\n+\t       file later on the command line later in the list.  */\n+\t    || id->sequence > (*id_ptr)->sequence\n+\t    /* Hack: do lexical compare, too.\n+\t    || (id->sequence == (*id_ptr)->sequence\n+\t        && strcmp (id->name, (*id_ptr)->name) > 0) */\n+\t    )\n+\t  {\n+\t    id->next = *id_ptr;\n+\t    *id_ptr = id;\n+\t    break;\n+\t  }\n+    }\n+\n+  /* Now set the sequence numbers properly so write_c_file works.  */\n+  for (id = head_ptr->first; id; id = id->next)\n+    id->sequence = ++sequence_number;\n+}\n+\n /* Write: `prefix', the names on list LIST, `suffix'.  */\n \n static void"}, {"sha": "72e77b01398e8c6ffdf6a783bd54866382536cd2", "filename": "gcc/config/mips/mips.h", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/2ce3c6c615fa735693e1de39e9777919ba4fd106/gcc%2Fconfig%2Fmips%2Fmips.h", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/2ce3c6c615fa735693e1de39e9777919ba4fd106/gcc%2Fconfig%2Fmips%2Fmips.h", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fconfig%2Fmips%2Fmips.h?ref=2ce3c6c615fa735693e1de39e9777919ba4fd106", "patch": "@@ -716,7 +716,7 @@ while (0)\n \n /* Tell collect what flags to pass to nm.  */\n #ifndef NM_FLAGS\n-#define NM_FLAGS \"-Bp\"\n+#define NM_FLAGS \"-Bn\"\n #endif\n \n \f"}, {"sha": "2b76ae313879793962620806b43412f3298ae6ab", "filename": "gcc/configure", "status": "modified", "additions": 196, "deletions": 105, "changes": 301, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/2ce3c6c615fa735693e1de39e9777919ba4fd106/gcc%2Fconfigure", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/2ce3c6c615fa735693e1de39e9777919ba4fd106/gcc%2Fconfigure", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fconfigure?ref=2ce3c6c615fa735693e1de39e9777919ba4fd106", "patch": "@@ -1,7 +1,7 @@\n #! /bin/sh\n \n # Guess values for system-dependent variables and create Makefiles.\n-# Generated automatically using autoconf version 2.12.1 \n+# Generated automatically using autoconf version 2.12.2 \n # Copyright (C) 1992, 93, 94, 95, 96 Free Software Foundation, Inc.\n #\n # This configure script is free software; the Free Software Foundation\n@@ -36,6 +36,11 @@ ac_help=\"$ac_help\n                           targets which normally enable it.\"\n ac_help=\"$ac_help\n   --with-fast-fixincludes    Use a faster fixinclude program.  Experimental\"\n+ac_help=\"$ac_help\n+  --enable-init-priority  Use attributes to assign initialization order\n+\t\t\t  for static objects.\n+  --disable-init-priority Conform to ISO C++ rules for ordering static objects\n+\t\t\t  (i.e. initialized in order of declaration). \"\n ac_help=\"$ac_help\n   --enable-threads        enable thread usage for target GCC.\n   --enable-threads=LIB    use LIB thread package for target GCC.\"\n@@ -361,7 +366,7 @@ EOF\n     verbose=yes ;;\n \n   -version | --version | --versio | --versi | --vers)\n-    echo \"configure generated by autoconf version 2.12.1\"\n+    echo \"configure generated by autoconf version 2.12.2\"\n     exit 0 ;;\n \n   -with-* | --with-*)\n@@ -531,9 +536,11 @@ ac_ext=c\n # CFLAGS is not in ac_cpp because -g, -O, etc. are not valid cpp options.\n ac_cpp='$CPP $CPPFLAGS'\n ac_compile='${CC-cc} -c $CFLAGS $CPPFLAGS conftest.$ac_ext 1>&5'\n-ac_link='${CC-cc} -o conftest $CFLAGS $CPPFLAGS $LDFLAGS conftest.$ac_ext $LIBS 1>&5'\n+ac_link='${CC-cc} -o conftest${ac_exeext} $CFLAGS $CPPFLAGS $LDFLAGS conftest.$ac_ext $LIBS 1>&5'\n cross_compiling=$ac_cv_prog_cc_cross\n \n+ac_exeext=\n+ac_objext=o\n if (echo \"testing\\c\"; echo 1,2,3) | grep c >/dev/null; then\n   # Stardent Vistra SVR4 grep lacks -e, says ghazi@caip.rutgers.edu.\n   if (echo -n testing; echo 1,2,3) | sed s/-n/xn/ | grep xn >/dev/null; then\n@@ -694,6 +701,16 @@ else\n fi\n \n \n+# Enable init_priority.\n+# Check whether --enable-init-priority or --disable-init-priority was given.\n+if test \"${enable_init_priority+set}\" = set; then\n+  enableval=\"$enable_init_priority\"\n+  if [ x$enable_init_priority != xno ]; then\n+  extra_c_flags=-DUSE_INIT_PRIORITY\n+fi\n+fi\n+\n+\n # Enable threads\n # Pass with no value to take the default\n # Pass with a value to specify a thread package\n@@ -777,7 +794,7 @@ else { echo \"configure: error: can not run $ac_config_sub\" 1>&2; exit 1; }\n fi\n \n echo $ac_n \"checking host system type\"\"... $ac_c\" 1>&6\n-echo \"configure:781: checking host system type\" >&5\n+echo \"configure:798: checking host system type\" >&5\n \n host_alias=$host\n case \"$host_alias\" in\n@@ -798,7 +815,7 @@ host_os=`echo $host | sed 's/^\\([^-]*\\)-\\([^-]*\\)-\\(.*\\)$/\\3/'`\n echo \"$ac_t\"\"$host\" 1>&6\n \n echo $ac_n \"checking target system type\"\"... $ac_c\" 1>&6\n-echo \"configure:802: checking target system type\" >&5\n+echo \"configure:819: checking target system type\" >&5\n \n target_alias=$target\n case \"$target_alias\" in\n@@ -816,7 +833,7 @@ target_os=`echo $target | sed 's/^\\([^-]*\\)-\\([^-]*\\)-\\(.*\\)$/\\3/'`\n echo \"$ac_t\"\"$target\" 1>&6\n \n echo $ac_n \"checking build system type\"\"... $ac_c\" 1>&6\n-echo \"configure:820: checking build system type\" >&5\n+echo \"configure:837: checking build system type\" >&5\n \n build_alias=$build\n case \"$build_alias\" in\n@@ -843,14 +860,14 @@ test \"$host_alias\" != \"$target_alias\" &&\n # Extract the first word of \"gcc\", so it can be a program name with args.\n set dummy gcc; ac_word=$2\n echo $ac_n \"checking for $ac_word\"\"... $ac_c\" 1>&6\n-echo \"configure:847: checking for $ac_word\" >&5\n+echo \"configure:864: checking for $ac_word\" >&5\n if eval \"test \\\"`echo '$''{'ac_cv_prog_CC'+set}'`\\\" = set\"; then\n   echo $ac_n \"(cached) $ac_c\" 1>&6\n else\n   if test -n \"$CC\"; then\n   ac_cv_prog_CC=\"$CC\" # Let the user override the test.\n else\n-  IFS=\"${IFS= \t}\"; ac_save_ifs=\"$IFS\"; IFS=\"${IFS}:\"\n+  IFS=\"${IFS= \t}\"; ac_save_ifs=\"$IFS\"; IFS=\":\"\n   for ac_dir in $PATH; do\n     test -z \"$ac_dir\" && ac_dir=.\n     if test -f $ac_dir/$ac_word; then\n@@ -872,14 +889,14 @@ if test -z \"$CC\"; then\n   # Extract the first word of \"cc\", so it can be a program name with args.\n set dummy cc; ac_word=$2\n echo $ac_n \"checking for $ac_word\"\"... $ac_c\" 1>&6\n-echo \"configure:876: checking for $ac_word\" >&5\n+echo \"configure:893: checking for $ac_word\" >&5\n if eval \"test \\\"`echo '$''{'ac_cv_prog_CC'+set}'`\\\" = set\"; then\n   echo $ac_n \"(cached) $ac_c\" 1>&6\n else\n   if test -n \"$CC\"; then\n   ac_cv_prog_CC=\"$CC\" # Let the user override the test.\n else\n-  IFS=\"${IFS= \t}\"; ac_save_ifs=\"$IFS\"; IFS=\"${IFS}:\"\n+  IFS=\"${IFS= \t}\"; ac_save_ifs=\"$IFS\"; IFS=\":\"\n   ac_prog_rejected=no\n   for ac_dir in $PATH; do\n     test -z \"$ac_dir\" && ac_dir=.\n@@ -916,25 +933,58 @@ else\n   echo \"$ac_t\"\"no\" 1>&6\n fi\n \n+  if test -z \"$CC\"; then\n+    case \"`uname -s`\" in\n+    *win32* | *WIN32*)\n+      # Extract the first word of \"cl\", so it can be a program name with args.\n+set dummy cl; ac_word=$2\n+echo $ac_n \"checking for $ac_word\"\"... $ac_c\" 1>&6\n+echo \"configure:943: checking for $ac_word\" >&5\n+if eval \"test \\\"`echo '$''{'ac_cv_prog_CC'+set}'`\\\" = set\"; then\n+  echo $ac_n \"(cached) $ac_c\" 1>&6\n+else\n+  if test -n \"$CC\"; then\n+  ac_cv_prog_CC=\"$CC\" # Let the user override the test.\n+else\n+  IFS=\"${IFS= \t}\"; ac_save_ifs=\"$IFS\"; IFS=\":\"\n+  for ac_dir in $PATH; do\n+    test -z \"$ac_dir\" && ac_dir=.\n+    if test -f $ac_dir/$ac_word; then\n+      ac_cv_prog_CC=\"cl\"\n+      break\n+    fi\n+  done\n+  IFS=\"$ac_save_ifs\"\n+fi\n+fi\n+CC=\"$ac_cv_prog_CC\"\n+if test -n \"$CC\"; then\n+  echo \"$ac_t\"\"$CC\" 1>&6\n+else\n+  echo \"$ac_t\"\"no\" 1>&6\n+fi\n+ ;;\n+    esac\n+  fi\n   test -z \"$CC\" && { echo \"configure: error: no acceptable cc found in \\$PATH\" 1>&2; exit 1; }\n fi\n \n echo $ac_n \"checking whether the C compiler ($CC $CFLAGS $LDFLAGS) works\"\"... $ac_c\" 1>&6\n-echo \"configure:924: checking whether the C compiler ($CC $CFLAGS $LDFLAGS) works\" >&5\n+echo \"configure:974: checking whether the C compiler ($CC $CFLAGS $LDFLAGS) works\" >&5\n \n ac_ext=c\n # CFLAGS is not in ac_cpp because -g, -O, etc. are not valid cpp options.\n ac_cpp='$CPP $CPPFLAGS'\n ac_compile='${CC-cc} -c $CFLAGS $CPPFLAGS conftest.$ac_ext 1>&5'\n-ac_link='${CC-cc} -o conftest $CFLAGS $CPPFLAGS $LDFLAGS conftest.$ac_ext $LIBS 1>&5'\n+ac_link='${CC-cc} -o conftest${ac_exeext} $CFLAGS $CPPFLAGS $LDFLAGS conftest.$ac_ext $LIBS 1>&5'\n cross_compiling=$ac_cv_prog_cc_cross\n \n cat > conftest.$ac_ext <<EOF\n-#line 934 \"configure\"\n+#line 984 \"configure\"\n #include \"confdefs.h\"\n main(){return(0);}\n EOF\n-if { (eval echo configure:938: \\\"$ac_link\\\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest; then\n+if { (eval echo configure:988: \\\"$ac_link\\\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest${ac_exeext}; then\n   ac_cv_prog_cc_works=yes\n   # If we can't run a trivial program, we are probably using a cross compiler.\n   if (./conftest; exit) 2>/dev/null; then\n@@ -954,12 +1004,12 @@ if test $ac_cv_prog_cc_works = no; then\n   { echo \"configure: error: installation or configuration problem: C compiler cannot create executables.\" 1>&2; exit 1; }\n fi\n echo $ac_n \"checking whether the C compiler ($CC $CFLAGS $LDFLAGS) is a cross-compiler\"\"... $ac_c\" 1>&6\n-echo \"configure:958: checking whether the C compiler ($CC $CFLAGS $LDFLAGS) is a cross-compiler\" >&5\n+echo \"configure:1008: checking whether the C compiler ($CC $CFLAGS $LDFLAGS) is a cross-compiler\" >&5\n echo \"$ac_t\"\"$ac_cv_prog_cc_cross\" 1>&6\n cross_compiling=$ac_cv_prog_cc_cross\n \n echo $ac_n \"checking whether we are using GNU C\"\"... $ac_c\" 1>&6\n-echo \"configure:963: checking whether we are using GNU C\" >&5\n+echo \"configure:1013: checking whether we are using GNU C\" >&5\n if eval \"test \\\"`echo '$''{'ac_cv_prog_gcc'+set}'`\\\" = set\"; then\n   echo $ac_n \"(cached) $ac_c\" 1>&6\n else\n@@ -968,7 +1018,7 @@ else\n   yes;\n #endif\n EOF\n-if { ac_try='${CC-cc} -E conftest.c'; { (eval echo configure:972: \\\"$ac_try\\\") 1>&5; (eval $ac_try) 2>&5; }; } | egrep yes >/dev/null 2>&1; then\n+if { ac_try='${CC-cc} -E conftest.c'; { (eval echo configure:1022: \\\"$ac_try\\\") 1>&5; (eval $ac_try) 2>&5; }; } | egrep yes >/dev/null 2>&1; then\n   ac_cv_prog_gcc=yes\n else\n   ac_cv_prog_gcc=no\n@@ -979,11 +1029,15 @@ echo \"$ac_t\"\"$ac_cv_prog_gcc\" 1>&6\n \n if test $ac_cv_prog_gcc = yes; then\n   GCC=yes\n-  ac_test_CFLAGS=\"${CFLAGS+set}\"\n-  ac_save_CFLAGS=\"$CFLAGS\"\n-  CFLAGS=\n-  echo $ac_n \"checking whether ${CC-cc} accepts -g\"\"... $ac_c\" 1>&6\n-echo \"configure:987: checking whether ${CC-cc} accepts -g\" >&5\n+else\n+  GCC=\n+fi\n+\n+ac_test_CFLAGS=\"${CFLAGS+set}\"\n+ac_save_CFLAGS=\"$CFLAGS\"\n+CFLAGS=\n+echo $ac_n \"checking whether ${CC-cc} accepts -g\"\"... $ac_c\" 1>&6\n+echo \"configure:1041: checking whether ${CC-cc} accepts -g\" >&5\n if eval \"test \\\"`echo '$''{'ac_cv_prog_cc_g'+set}'`\\\" = set\"; then\n   echo $ac_n \"(cached) $ac_c\" 1>&6\n else\n@@ -998,20 +1052,24 @@ rm -f conftest*\n fi\n \n echo \"$ac_t\"\"$ac_cv_prog_cc_g\" 1>&6\n-  if test \"$ac_test_CFLAGS\" = set; then\n-    CFLAGS=\"$ac_save_CFLAGS\"\n-  elif test $ac_cv_prog_cc_g = yes; then\n+if test \"$ac_test_CFLAGS\" = set; then\n+  CFLAGS=\"$ac_save_CFLAGS\"\n+elif test $ac_cv_prog_cc_g = yes; then\n+  if test \"$GCC\" = yes; then\n     CFLAGS=\"-g -O2\"\n   else\n-    CFLAGS=\"-O2\"\n+    CFLAGS=\"-g\"\n   fi\n else\n-  GCC=\n-  test \"${CFLAGS+set}\" = set || CFLAGS=\"-g\"\n+  if test \"$GCC\" = yes; then\n+    CFLAGS=\"-O2\"\n+  else\n+    CFLAGS=\n+  fi\n fi\n \n echo $ac_n \"checking whether ${MAKE-make} sets \\${MAKE}\"\"... $ac_c\" 1>&6\n-echo \"configure:1015: checking whether ${MAKE-make} sets \\${MAKE}\" >&5\n+echo \"configure:1073: checking whether ${MAKE-make} sets \\${MAKE}\" >&5\n set dummy ${MAKE-make}; ac_make=`echo \"$2\" | sed 'y%./+-%__p_%'`\n if eval \"test \\\"`echo '$''{'ac_cv_prog_make_${ac_make}_set'+set}'`\\\" = set\"; then\n   echo $ac_n \"(cached) $ac_c\" 1>&6\n@@ -1044,14 +1102,14 @@ do\n # Extract the first word of \"$ac_prog\", so it can be a program name with args.\n set dummy $ac_prog; ac_word=$2\n echo $ac_n \"checking for $ac_word\"\"... $ac_c\" 1>&6\n-echo \"configure:1048: checking for $ac_word\" >&5\n+echo \"configure:1106: checking for $ac_word\" >&5\n if eval \"test \\\"`echo '$''{'ac_cv_prog_AWK'+set}'`\\\" = set\"; then\n   echo $ac_n \"(cached) $ac_c\" 1>&6\n else\n   if test -n \"$AWK\"; then\n   ac_cv_prog_AWK=\"$AWK\" # Let the user override the test.\n else\n-  IFS=\"${IFS= \t}\"; ac_save_ifs=\"$IFS\"; IFS=\"${IFS}:\"\n+  IFS=\"${IFS= \t}\"; ac_save_ifs=\"$IFS\"; IFS=\":\"\n   for ac_dir in $PATH; do\n     test -z \"$ac_dir\" && ac_dir=.\n     if test -f $ac_dir/$ac_word; then\n@@ -1075,14 +1133,14 @@ done\n # Extract the first word of \"flex\", so it can be a program name with args.\n set dummy flex; ac_word=$2\n echo $ac_n \"checking for $ac_word\"\"... $ac_c\" 1>&6\n-echo \"configure:1079: checking for $ac_word\" >&5\n+echo \"configure:1137: checking for $ac_word\" >&5\n if eval \"test \\\"`echo '$''{'ac_cv_prog_LEX'+set}'`\\\" = set\"; then\n   echo $ac_n \"(cached) $ac_c\" 1>&6\n else\n   if test -n \"$LEX\"; then\n   ac_cv_prog_LEX=\"$LEX\" # Let the user override the test.\n else\n-  IFS=\"${IFS= \t}\"; ac_save_ifs=\"$IFS\"; IFS=\"${IFS}:\"\n+  IFS=\"${IFS= \t}\"; ac_save_ifs=\"$IFS\"; IFS=\":\"\n   for ac_dir in $PATH; do\n     test -z \"$ac_dir\" && ac_dir=.\n     if test -f $ac_dir/$ac_word; then\n@@ -1108,15 +1166,15 @@ then\n   *) ac_lib=l ;;\n   esac\n   echo $ac_n \"checking for yywrap in -l$ac_lib\"\"... $ac_c\" 1>&6\n-echo \"configure:1112: checking for yywrap in -l$ac_lib\" >&5\n+echo \"configure:1170: checking for yywrap in -l$ac_lib\" >&5\n ac_lib_var=`echo $ac_lib'_'yywrap | sed 'y%./+-%__p_%'`\n if eval \"test \\\"`echo '$''{'ac_cv_lib_$ac_lib_var'+set}'`\\\" = set\"; then\n   echo $ac_n \"(cached) $ac_c\" 1>&6\n else\n   ac_save_LIBS=\"$LIBS\"\n LIBS=\"-l$ac_lib  $LIBS\"\n cat > conftest.$ac_ext <<EOF\n-#line 1120 \"configure\"\n+#line 1178 \"configure\"\n #include \"confdefs.h\"\n /* Override any gcc2 internal prototype to avoid an error.  */\n /* We use char because int might match the return type of a gcc2\n@@ -1127,7 +1185,7 @@ int main() {\n yywrap()\n ; return 0; }\n EOF\n-if { (eval echo configure:1131: \\\"$ac_link\\\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest; then\n+if { (eval echo configure:1189: \\\"$ac_link\\\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest${ac_exeext}; then\n   rm -rf conftest*\n   eval \"ac_cv_lib_$ac_lib_var=yes\"\n else\n@@ -1150,7 +1208,7 @@ fi\n fi\n \n echo $ac_n \"checking whether ln works\"\"... $ac_c\" 1>&6\n-echo \"configure:1154: checking whether ln works\" >&5\n+echo \"configure:1212: checking whether ln works\" >&5\n if eval \"test \\\"`echo '$''{'gcc_cv_prog_LN'+set}'`\\\" = set\"; then\n   echo $ac_n \"(cached) $ac_c\" 1>&6\n else\n@@ -1182,7 +1240,7 @@ else\n fi\n \n echo $ac_n \"checking whether ln -s works\"\"... $ac_c\" 1>&6\n-echo \"configure:1186: checking whether ln -s works\" >&5\n+echo \"configure:1244: checking whether ln -s works\" >&5\n if eval \"test \\\"`echo '$''{'gcc_cv_prog_LN_S'+set}'`\\\" = set\"; then\n   echo $ac_n \"(cached) $ac_c\" 1>&6\n else\n@@ -1214,19 +1272,19 @@ else\n fi\n \n echo $ac_n \"checking for volatile\"\"... $ac_c\" 1>&6\n-echo \"configure:1218: checking for volatile\" >&5\n+echo \"configure:1276: checking for volatile\" >&5\n if eval \"test \\\"`echo '$''{'gcc_cv_c_volatile'+set}'`\\\" = set\"; then\n   echo $ac_n \"(cached) $ac_c\" 1>&6\n else\n   cat > conftest.$ac_ext <<EOF\n-#line 1223 \"configure\"\n+#line 1281 \"configure\"\n #include \"confdefs.h\"\n \n int main() {\n volatile int foo;\n ; return 0; }\n EOF\n-if { (eval echo configure:1230: \\\"$ac_compile\\\") 1>&5; (eval $ac_compile) 2>&5; }; then\n+if { (eval echo configure:1288: \\\"$ac_compile\\\") 1>&5; (eval $ac_compile) 2>&5; }; then\n   rm -rf conftest*\n   gcc_cv_c_volatile=yes\n else\n@@ -1249,14 +1307,14 @@ fi\n # Extract the first word of \"ranlib\", so it can be a program name with args.\n set dummy ranlib; ac_word=$2\n echo $ac_n \"checking for $ac_word\"\"... $ac_c\" 1>&6\n-echo \"configure:1253: checking for $ac_word\" >&5\n+echo \"configure:1311: checking for $ac_word\" >&5\n if eval \"test \\\"`echo '$''{'ac_cv_prog_RANLIB'+set}'`\\\" = set\"; then\n   echo $ac_n \"(cached) $ac_c\" 1>&6\n else\n   if test -n \"$RANLIB\"; then\n   ac_cv_prog_RANLIB=\"$RANLIB\" # Let the user override the test.\n else\n-  IFS=\"${IFS= \t}\"; ac_save_ifs=\"$IFS\"; IFS=\"${IFS}:\"\n+  IFS=\"${IFS= \t}\"; ac_save_ifs=\"$IFS\"; IFS=\":\"\n   for ac_dir in $PATH; do\n     test -z \"$ac_dir\" && ac_dir=.\n     if test -f $ac_dir/$ac_word; then\n@@ -1280,14 +1338,14 @@ do\n # Extract the first word of \"$ac_prog\", so it can be a program name with args.\n set dummy $ac_prog; ac_word=$2\n echo $ac_n \"checking for $ac_word\"\"... $ac_c\" 1>&6\n-echo \"configure:1284: checking for $ac_word\" >&5\n+echo \"configure:1342: checking for $ac_word\" >&5\n if eval \"test \\\"`echo '$''{'ac_cv_prog_YACC'+set}'`\\\" = set\"; then\n   echo $ac_n \"(cached) $ac_c\" 1>&6\n else\n   if test -n \"$YACC\"; then\n   ac_cv_prog_YACC=\"$YACC\" # Let the user override the test.\n else\n-  IFS=\"${IFS= \t}\"; ac_save_ifs=\"$IFS\"; IFS=\"${IFS}:\"\n+  IFS=\"${IFS= \t}\"; ac_save_ifs=\"$IFS\"; IFS=\":\"\n   for ac_dir in $PATH; do\n     test -z \"$ac_dir\" && ac_dir=.\n     if test -f $ac_dir/$ac_word; then\n@@ -1320,7 +1378,7 @@ test -n \"$YACC\" || YACC=\"yacc\"\n # SVR4 /usr/ucb/install, which tries to use the nonexistent group \"staff\"\n # ./install, which can be erroneously created by make from ./install.sh.\n echo $ac_n \"checking for a BSD compatible install\"\"... $ac_c\" 1>&6\n-echo \"configure:1324: checking for a BSD compatible install\" >&5\n+echo \"configure:1382: checking for a BSD compatible install\" >&5\n if test -z \"$INSTALL\"; then\n if eval \"test \\\"`echo '$''{'ac_cv_path_install'+set}'`\\\" = set\"; then\n   echo $ac_n \"(cached) $ac_c\" 1>&6\n@@ -1371,7 +1429,7 @@ test -z \"$INSTALL_DATA\" && INSTALL_DATA='${INSTALL} -m 644'\n \n \n echo $ac_n \"checking how to run the C preprocessor\"\"... $ac_c\" 1>&6\n-echo \"configure:1375: checking how to run the C preprocessor\" >&5\n+echo \"configure:1433: checking how to run the C preprocessor\" >&5\n # On Suns, sometimes $CPP names a directory.\n if test -n \"$CPP\" && test -d \"$CPP\"; then\n   CPP=\n@@ -1386,14 +1444,14 @@ else\n   # On the NeXT, cc -E runs the code through the compiler's parser,\n   # not just through cpp.\n   cat > conftest.$ac_ext <<EOF\n-#line 1390 \"configure\"\n+#line 1448 \"configure\"\n #include \"confdefs.h\"\n #include <assert.h>\n Syntax Error\n EOF\n ac_try=\"$ac_cpp conftest.$ac_ext >/dev/null 2>conftest.out\"\n-{ (eval echo configure:1396: \\\"$ac_try\\\") 1>&5; (eval $ac_try) 2>&5; }\n-ac_err=`grep -v '^ *+' conftest.out`\n+{ (eval echo configure:1454: \\\"$ac_try\\\") 1>&5; (eval $ac_try) 2>&5; }\n+ac_err=`grep -v '^ *+' conftest.out | grep -v \"^conftest.${ac_ext}\\$\"`\n if test -z \"$ac_err\"; then\n   :\n else\n@@ -1403,14 +1461,31 @@ else\n   rm -rf conftest*\n   CPP=\"${CC-cc} -E -traditional-cpp\"\n   cat > conftest.$ac_ext <<EOF\n-#line 1407 \"configure\"\n+#line 1465 \"configure\"\n+#include \"confdefs.h\"\n+#include <assert.h>\n+Syntax Error\n+EOF\n+ac_try=\"$ac_cpp conftest.$ac_ext >/dev/null 2>conftest.out\"\n+{ (eval echo configure:1471: \\\"$ac_try\\\") 1>&5; (eval $ac_try) 2>&5; }\n+ac_err=`grep -v '^ *+' conftest.out | grep -v \"^conftest.${ac_ext}\\$\"`\n+if test -z \"$ac_err\"; then\n+  :\n+else\n+  echo \"$ac_err\" >&5\n+  echo \"configure: failed program was:\" >&5\n+  cat conftest.$ac_ext >&5\n+  rm -rf conftest*\n+  CPP=\"${CC-cc} -nologo -E\"\n+  cat > conftest.$ac_ext <<EOF\n+#line 1482 \"configure\"\n #include \"confdefs.h\"\n #include <assert.h>\n Syntax Error\n EOF\n ac_try=\"$ac_cpp conftest.$ac_ext >/dev/null 2>conftest.out\"\n-{ (eval echo configure:1413: \\\"$ac_try\\\") 1>&5; (eval $ac_try) 2>&5; }\n-ac_err=`grep -v '^ *+' conftest.out`\n+{ (eval echo configure:1488: \\\"$ac_try\\\") 1>&5; (eval $ac_try) 2>&5; }\n+ac_err=`grep -v '^ *+' conftest.out | grep -v \"^conftest.${ac_ext}\\$\"`\n if test -z \"$ac_err\"; then\n   :\n else\n@@ -1422,6 +1497,8 @@ else\n fi\n rm -f conftest*\n fi\n+rm -f conftest*\n+fi\n rm -f conftest*\n   ac_cv_prog_CPP=\"$CPP\"\n fi\n@@ -1432,21 +1509,21 @@ fi\n echo \"$ac_t\"\"$CPP\" 1>&6\n \n echo $ac_n \"checking for ANSI C header files\"\"... $ac_c\" 1>&6\n-echo \"configure:1436: checking for ANSI C header files\" >&5\n+echo \"configure:1513: checking for ANSI C header files\" >&5\n if eval \"test \\\"`echo '$''{'ac_cv_header_stdc'+set}'`\\\" = set\"; then\n   echo $ac_n \"(cached) $ac_c\" 1>&6\n else\n   cat > conftest.$ac_ext <<EOF\n-#line 1441 \"configure\"\n+#line 1518 \"configure\"\n #include \"confdefs.h\"\n #include <stdlib.h>\n #include <stdarg.h>\n #include <string.h>\n #include <float.h>\n EOF\n ac_try=\"$ac_cpp conftest.$ac_ext >/dev/null 2>conftest.out\"\n-{ (eval echo configure:1449: \\\"$ac_try\\\") 1>&5; (eval $ac_try) 2>&5; }\n-ac_err=`grep -v '^ *+' conftest.out`\n+{ (eval echo configure:1526: \\\"$ac_try\\\") 1>&5; (eval $ac_try) 2>&5; }\n+ac_err=`grep -v '^ *+' conftest.out | grep -v \"^conftest.${ac_ext}\\$\"`\n if test -z \"$ac_err\"; then\n   rm -rf conftest*\n   ac_cv_header_stdc=yes\n@@ -1462,7 +1539,7 @@ rm -f conftest*\n if test $ac_cv_header_stdc = yes; then\n   # SunOS 4.x string.h does not declare mem*, contrary to ANSI.\n cat > conftest.$ac_ext <<EOF\n-#line 1466 \"configure\"\n+#line 1543 \"configure\"\n #include \"confdefs.h\"\n #include <string.h>\n EOF\n@@ -1480,7 +1557,7 @@ fi\n if test $ac_cv_header_stdc = yes; then\n   # ISC 2.0.2 stdlib.h does not declare free, contrary to ANSI.\n cat > conftest.$ac_ext <<EOF\n-#line 1484 \"configure\"\n+#line 1561 \"configure\"\n #include \"confdefs.h\"\n #include <stdlib.h>\n EOF\n@@ -1501,7 +1578,7 @@ if test \"$cross_compiling\" = yes; then\n   :\n else\n   cat > conftest.$ac_ext <<EOF\n-#line 1505 \"configure\"\n+#line 1582 \"configure\"\n #include \"confdefs.h\"\n #include <ctype.h>\n #define ISLOWER(c) ('a' <= (c) && (c) <= 'z')\n@@ -1512,7 +1589,7 @@ if (XOR (islower (i), ISLOWER (i)) || toupper (i) != TOUPPER (i)) exit(2);\n exit (0); }\n \n EOF\n-if { (eval echo configure:1516: \\\"$ac_link\\\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest && (./conftest; exit) 2>/dev/null\n+if { (eval echo configure:1593: \\\"$ac_link\\\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest${ac_exeext} && (./conftest; exit) 2>/dev/null\n then\n   :\n else\n@@ -1536,12 +1613,12 @@ EOF\n fi\n \n echo $ac_n \"checking whether time.h and sys/time.h may both be included\"\"... $ac_c\" 1>&6\n-echo \"configure:1540: checking whether time.h and sys/time.h may both be included\" >&5\n+echo \"configure:1617: checking whether time.h and sys/time.h may both be included\" >&5\n if eval \"test \\\"`echo '$''{'ac_cv_header_time'+set}'`\\\" = set\"; then\n   echo $ac_n \"(cached) $ac_c\" 1>&6\n else\n   cat > conftest.$ac_ext <<EOF\n-#line 1545 \"configure\"\n+#line 1622 \"configure\"\n #include \"confdefs.h\"\n #include <sys/types.h>\n #include <sys/time.h>\n@@ -1550,7 +1627,7 @@ int main() {\n struct tm *tp;\n ; return 0; }\n EOF\n-if { (eval echo configure:1554: \\\"$ac_compile\\\") 1>&5; (eval $ac_compile) 2>&5; }; then\n+if { (eval echo configure:1631: \\\"$ac_compile\\\") 1>&5; (eval $ac_compile) 2>&5; }; then\n   rm -rf conftest*\n   ac_cv_header_time=yes\n else\n@@ -1574,18 +1651,18 @@ for ac_hdr in limits.h stddef.h string.h strings.h stdlib.h time.h fcntl.h unist\n do\n ac_safe=`echo \"$ac_hdr\" | sed 'y%./+-%__p_%'`\n echo $ac_n \"checking for $ac_hdr\"\"... $ac_c\" 1>&6\n-echo \"configure:1578: checking for $ac_hdr\" >&5\n+echo \"configure:1655: checking for $ac_hdr\" >&5\n if eval \"test \\\"`echo '$''{'ac_cv_header_$ac_safe'+set}'`\\\" = set\"; then\n   echo $ac_n \"(cached) $ac_c\" 1>&6\n else\n   cat > conftest.$ac_ext <<EOF\n-#line 1583 \"configure\"\n+#line 1660 \"configure\"\n #include \"confdefs.h\"\n #include <$ac_hdr>\n EOF\n ac_try=\"$ac_cpp conftest.$ac_ext >/dev/null 2>conftest.out\"\n-{ (eval echo configure:1588: \\\"$ac_try\\\") 1>&5; (eval $ac_try) 2>&5; }\n-ac_err=`grep -v '^ *+' conftest.out`\n+{ (eval echo configure:1665: \\\"$ac_try\\\") 1>&5; (eval $ac_try) 2>&5; }\n+ac_err=`grep -v '^ *+' conftest.out | grep -v \"^conftest.${ac_ext}\\$\"`\n if test -z \"$ac_err\"; then\n   rm -rf conftest*\n   eval \"ac_cv_header_$ac_safe=yes\"\n@@ -1614,18 +1691,18 @@ done\n # Check for thread headers.\n ac_safe=`echo \"thread.h\" | sed 'y%./+-%__p_%'`\n echo $ac_n \"checking for thread.h\"\"... $ac_c\" 1>&6\n-echo \"configure:1618: checking for thread.h\" >&5\n+echo \"configure:1695: checking for thread.h\" >&5\n if eval \"test \\\"`echo '$''{'ac_cv_header_$ac_safe'+set}'`\\\" = set\"; then\n   echo $ac_n \"(cached) $ac_c\" 1>&6\n else\n   cat > conftest.$ac_ext <<EOF\n-#line 1623 \"configure\"\n+#line 1700 \"configure\"\n #include \"confdefs.h\"\n #include <thread.h>\n EOF\n ac_try=\"$ac_cpp conftest.$ac_ext >/dev/null 2>conftest.out\"\n-{ (eval echo configure:1628: \\\"$ac_try\\\") 1>&5; (eval $ac_try) 2>&5; }\n-ac_err=`grep -v '^ *+' conftest.out`\n+{ (eval echo configure:1705: \\\"$ac_try\\\") 1>&5; (eval $ac_try) 2>&5; }\n+ac_err=`grep -v '^ *+' conftest.out | grep -v \"^conftest.${ac_ext}\\$\"`\n if test -z \"$ac_err\"; then\n   rm -rf conftest*\n   eval \"ac_cv_header_$ac_safe=yes\"\n@@ -1648,18 +1725,18 @@ fi\n \n ac_safe=`echo \"pthread.h\" | sed 'y%./+-%__p_%'`\n echo $ac_n \"checking for pthread.h\"\"... $ac_c\" 1>&6\n-echo \"configure:1652: checking for pthread.h\" >&5\n+echo \"configure:1729: checking for pthread.h\" >&5\n if eval \"test \\\"`echo '$''{'ac_cv_header_$ac_safe'+set}'`\\\" = set\"; then\n   echo $ac_n \"(cached) $ac_c\" 1>&6\n else\n   cat > conftest.$ac_ext <<EOF\n-#line 1657 \"configure\"\n+#line 1734 \"configure\"\n #include \"confdefs.h\"\n #include <pthread.h>\n EOF\n ac_try=\"$ac_cpp conftest.$ac_ext >/dev/null 2>conftest.out\"\n-{ (eval echo configure:1662: \\\"$ac_try\\\") 1>&5; (eval $ac_try) 2>&5; }\n-ac_err=`grep -v '^ *+' conftest.out`\n+{ (eval echo configure:1739: \\\"$ac_try\\\") 1>&5; (eval $ac_try) 2>&5; }\n+ac_err=`grep -v '^ *+' conftest.out | grep -v \"^conftest.${ac_ext}\\$\"`\n if test -z \"$ac_err\"; then\n   rm -rf conftest*\n   eval \"ac_cv_header_$ac_safe=yes\"\n@@ -1684,20 +1761,20 @@ fi\n # See if the system preprocessor understands the ANSI C preprocessor\n # stringification operator.\n echo $ac_n \"checking whether cpp understands the stringify operator\"\"... $ac_c\" 1>&6\n-echo \"configure:1688: checking whether cpp understands the stringify operator\" >&5\n+echo \"configure:1765: checking whether cpp understands the stringify operator\" >&5\n if eval \"test \\\"`echo '$''{'gcc_cv_c_have_stringify'+set}'`\\\" = set\"; then\n   echo $ac_n \"(cached) $ac_c\" 1>&6\n else\n   cat > conftest.$ac_ext <<EOF\n-#line 1693 \"configure\"\n+#line 1770 \"configure\"\n #include \"confdefs.h\"\n \n int main() {\n #define S(x)   #x\n char *test = S(foo);\n ; return 0; }\n EOF\n-if { (eval echo configure:1701: \\\"$ac_compile\\\") 1>&5; (eval $ac_compile) 2>&5; }; then\n+if { (eval echo configure:1778: \\\"$ac_compile\\\") 1>&5; (eval $ac_compile) 2>&5; }; then\n   rm -rf conftest*\n   gcc_cv_c_have_stringify=yes\n else\n@@ -1720,20 +1797,20 @@ fi\n # Use <inttypes.h> only if it exists,\n # doesn't clash with <sys/types.h>, and declares intmax_t.\n echo $ac_n \"checking for inttypes.h\"\"... $ac_c\" 1>&6\n-echo \"configure:1724: checking for inttypes.h\" >&5\n+echo \"configure:1801: checking for inttypes.h\" >&5\n if eval \"test \\\"`echo '$''{'gcc_cv_header_inttypes_h'+set}'`\\\" = set\"; then\n   echo $ac_n \"(cached) $ac_c\" 1>&6\n else\n   cat > conftest.$ac_ext <<EOF\n-#line 1729 \"configure\"\n+#line 1806 \"configure\"\n #include \"confdefs.h\"\n #include <sys/types.h>\n #include <inttypes.h>\n int main() {\n intmax_t i = -1;\n ; return 0; }\n EOF\n-if { (eval echo configure:1737: \\\"$ac_compile\\\") 1>&5; (eval $ac_compile) 2>&5; }; then\n+if { (eval echo configure:1814: \\\"$ac_compile\\\") 1>&5; (eval $ac_compile) 2>&5; }; then\n   rm -rf conftest*\n   cat >> confdefs.h <<EOF\n #define HAVE_INTTYPES_H 1\n@@ -1756,12 +1833,12 @@ for ac_func in strtoul bsearch strerror putenv popen bcopy bzero bcmp \\\n \tsysconf isascii gettimeofday\n do\n echo $ac_n \"checking for $ac_func\"\"... $ac_c\" 1>&6\n-echo \"configure:1760: checking for $ac_func\" >&5\n+echo \"configure:1837: checking for $ac_func\" >&5\n if eval \"test \\\"`echo '$''{'ac_cv_func_$ac_func'+set}'`\\\" = set\"; then\n   echo $ac_n \"(cached) $ac_c\" 1>&6\n else\n   cat > conftest.$ac_ext <<EOF\n-#line 1765 \"configure\"\n+#line 1842 \"configure\"\n #include \"confdefs.h\"\n /* System header to define __stub macros and hopefully few prototypes,\n     which can conflict with char $ac_func(); below.  */\n@@ -1784,7 +1861,7 @@ $ac_func();\n \n ; return 0; }\n EOF\n-if { (eval echo configure:1788: \\\"$ac_link\\\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest; then\n+if { (eval echo configure:1865: \\\"$ac_link\\\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest${ac_exeext}; then\n   rm -rf conftest*\n   eval \"ac_cv_func_$ac_func=yes\"\n else\n@@ -1813,12 +1890,12 @@ done\n #AC_CHECK_TYPE(wchar_t, unsigned int)\n \n echo $ac_n \"checking for vprintf\"\"... $ac_c\" 1>&6\n-echo \"configure:1817: checking for vprintf\" >&5\n+echo \"configure:1894: checking for vprintf\" >&5\n if eval \"test \\\"`echo '$''{'ac_cv_func_vprintf'+set}'`\\\" = set\"; then\n   echo $ac_n \"(cached) $ac_c\" 1>&6\n else\n   cat > conftest.$ac_ext <<EOF\n-#line 1822 \"configure\"\n+#line 1899 \"configure\"\n #include \"confdefs.h\"\n /* System header to define __stub macros and hopefully few prototypes,\n     which can conflict with char vprintf(); below.  */\n@@ -1841,7 +1918,7 @@ vprintf();\n \n ; return 0; }\n EOF\n-if { (eval echo configure:1845: \\\"$ac_link\\\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest; then\n+if { (eval echo configure:1922: \\\"$ac_link\\\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest${ac_exeext}; then\n   rm -rf conftest*\n   eval \"ac_cv_func_vprintf=yes\"\n else\n@@ -1865,12 +1942,12 @@ fi\n \n if test \"$ac_cv_func_vprintf\" != yes; then\n echo $ac_n \"checking for _doprnt\"\"... $ac_c\" 1>&6\n-echo \"configure:1869: checking for _doprnt\" >&5\n+echo \"configure:1946: checking for _doprnt\" >&5\n if eval \"test \\\"`echo '$''{'ac_cv_func__doprnt'+set}'`\\\" = set\"; then\n   echo $ac_n \"(cached) $ac_c\" 1>&6\n else\n   cat > conftest.$ac_ext <<EOF\n-#line 1874 \"configure\"\n+#line 1951 \"configure\"\n #include \"confdefs.h\"\n /* System header to define __stub macros and hopefully few prototypes,\n     which can conflict with char _doprnt(); below.  */\n@@ -1893,7 +1970,7 @@ _doprnt();\n \n ; return 0; }\n EOF\n-if { (eval echo configure:1897: \\\"$ac_link\\\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest; then\n+if { (eval echo configure:1974: \\\"$ac_link\\\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest${ac_exeext}; then\n   rm -rf conftest*\n   eval \"ac_cv_func__doprnt=yes\"\n else\n@@ -1929,15 +2006,15 @@ fi\n \n \n echo $ac_n \"checking whether the printf functions support %p\"\"... $ac_c\" 1>&6\n-echo \"configure:1933: checking whether the printf functions support %p\" >&5\n+echo \"configure:2010: checking whether the printf functions support %p\" >&5\n if eval \"test \\\"`echo '$''{'gcc_cv_func_printf_ptr'+set}'`\\\" = set\"; then\n   echo $ac_n \"(cached) $ac_c\" 1>&6\n else\n   if test \"$cross_compiling\" = yes; then\n   gcc_cv_func_printf_ptr=no\n else\n   cat > conftest.$ac_ext <<EOF\n-#line 1941 \"configure\"\n+#line 2018 \"configure\"\n #include \"confdefs.h\"\n #include <stdio.h>\n \n@@ -1950,7 +2027,7 @@ main()\n   exit (p != q);\n }\n EOF\n-if { (eval echo configure:1954: \\\"$ac_link\\\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest && (./conftest; exit) 2>/dev/null\n+if { (eval echo configure:2031: \\\"$ac_link\\\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest${ac_exeext} && (./conftest; exit) 2>/dev/null\n then\n   gcc_cv_func_printf_ptr=yes\n else\n@@ -1978,12 +2055,12 @@ for ac_func in malloc realloc calloc free bcopy bzero bcmp \\\n \tindex rindex getenv atol sbrk abort atof strerror getcwd getwd\n do\n echo $ac_n \"checking whether $ac_func must be declared\"\"... $ac_c\" 1>&6\n-echo \"configure:1982: checking whether $ac_func must be declared\" >&5\n+echo \"configure:2059: checking whether $ac_func must be declared\" >&5\n if eval \"test \\\"`echo '$''{'gcc_cv_decl_needed_$ac_func'+set}'`\\\" = set\"; then\n   echo $ac_n \"(cached) $ac_c\" 1>&6\n else\n   cat > conftest.$ac_ext <<EOF\n-#line 1987 \"configure\"\n+#line 2064 \"configure\"\n #include \"confdefs.h\"\n \n #include <stdio.h>\n@@ -2011,7 +2088,7 @@ int main() {\n char *(*pfn) = (char *(*)) $ac_func\n ; return 0; }\n EOF\n-if { (eval echo configure:2015: \\\"$ac_compile\\\") 1>&5; (eval $ac_compile) 2>&5; }; then\n+if { (eval echo configure:2092: \\\"$ac_compile\\\") 1>&5; (eval $ac_compile) 2>&5; }; then\n   rm -rf conftest*\n   eval \"gcc_cv_decl_needed_$ac_func=no\"\n else\n@@ -2040,12 +2117,12 @@ done\n for ac_func in getrlimit setrlimit\n do\n echo $ac_n \"checking whether $ac_func must be declared\"\"... $ac_c\" 1>&6\n-echo \"configure:2044: checking whether $ac_func must be declared\" >&5\n+echo \"configure:2121: checking whether $ac_func must be declared\" >&5\n if eval \"test \\\"`echo '$''{'gcc_cv_decl_needed_$ac_func'+set}'`\\\" = set\"; then\n   echo $ac_n \"(cached) $ac_c\" 1>&6\n else\n   cat > conftest.$ac_ext <<EOF\n-#line 2049 \"configure\"\n+#line 2126 \"configure\"\n #include \"confdefs.h\"\n \n #include <stdio.h>\n@@ -2077,7 +2154,7 @@ int main() {\n char *(*pfn) = (char *(*)) $ac_func\n ; return 0; }\n EOF\n-if { (eval echo configure:2081: \\\"$ac_compile\\\") 1>&5; (eval $ac_compile) 2>&5; }; then\n+if { (eval echo configure:2158: \\\"$ac_compile\\\") 1>&5; (eval $ac_compile) 2>&5; }; then\n   rm -rf conftest*\n   eval \"gcc_cv_decl_needed_$ac_func=no\"\n else\n@@ -2104,12 +2181,12 @@ done\n \n \n echo $ac_n \"checking for sys_siglist declaration in signal.h or unistd.h\"\"... $ac_c\" 1>&6\n-echo \"configure:2108: checking for sys_siglist declaration in signal.h or unistd.h\" >&5\n+echo \"configure:2185: checking for sys_siglist declaration in signal.h or unistd.h\" >&5\n if eval \"test \\\"`echo '$''{'ac_cv_decl_sys_siglist'+set}'`\\\" = set\"; then\n   echo $ac_n \"(cached) $ac_c\" 1>&6\n else\n   cat > conftest.$ac_ext <<EOF\n-#line 2113 \"configure\"\n+#line 2190 \"configure\"\n #include \"confdefs.h\"\n #include <sys/types.h>\n #include <signal.h>\n@@ -2121,7 +2198,7 @@ int main() {\n char *msg = *(sys_siglist + 1);\n ; return 0; }\n EOF\n-if { (eval echo configure:2125: \\\"$ac_compile\\\") 1>&5; (eval $ac_compile) 2>&5; }; then\n+if { (eval echo configure:2202: \\\"$ac_compile\\\") 1>&5; (eval $ac_compile) 2>&5; }; then\n   rm -rf conftest*\n   ac_cv_decl_sys_siglist=yes\n else\n@@ -4138,6 +4215,8 @@ for machine in $build $host $target; do\n \tmipstx39-*-elf*)\n \t\ttm_file=\"mips/r3900.h mips/elf.h mips/abi64.h libgloss.h\"\n \t\ttmake_file=mips/t-r3900\n+\t\t# FIXME mips-elf should be fixed to use crtstuff.\n+\t\tuse_collect2=yes\n \t\t;;\n \tmips-*-*)\t\t\t\t# Default MIPS RISC-OS 4.0.\n \t\tif [ x$stabs = xyes ]; then\n@@ -5230,6 +5309,10 @@ else\n \tdone\n fi\n \n+if [ x$use_collect2 = xno ]; then\n+\tuse_collect2=\n+fi\n+\n # Add a definition of USE_COLLECT2 if system wants one.\n # Also tell toplev.c what to do.\n # This substitutes for lots of t-* files.\n@@ -5277,7 +5360,7 @@ fi\n \n # Figure out what assembler alignment features are present.\n echo $ac_n \"checking assembler alignment features\"\"... $ac_c\" 1>&6\n-echo \"configure:5281: checking assembler alignment features\" >&5\n+echo \"configure:5364: checking assembler alignment features\" >&5\n gcc_cv_as=\n gcc_cv_as_alignment_features=\n gcc_cv_as_gas_srcdir=`echo $srcdir | sed -e 's,gcc$,gas,'`\n@@ -5530,6 +5613,14 @@ if [ x$enable_haifa != x ]; then\n     done\n fi\n \n+# Warn if using init_priority.\n+echo $ac_n \"checking whether to enable init_priority by default\"\"... $ac_c\" 1>&6\n+echo \"configure:5619: checking whether to enable init_priority by default\" >&5\n+if [ x$enable_init_priority != xyes ]; then\n+  enable_init_priority=no\n+fi\n+echo \"$ac_t\"\"$enable_init_priority\" 1>&6\n+\n # Nothing to do for FLOAT_H, float_format already handled.\n objdir=`pwd`\n \n@@ -5719,7 +5810,7 @@ do\n     echo \"running \\${CONFIG_SHELL-/bin/sh} $0 $ac_configure_args --no-create --no-recursion\"\n     exec \\${CONFIG_SHELL-/bin/sh} $0 $ac_configure_args --no-create --no-recursion ;;\n   -version | --version | --versio | --versi | --vers | --ver | --ve | --v)\n-    echo \"$CONFIG_STATUS generated by autoconf version 2.12.1\"\n+    echo \"$CONFIG_STATUS generated by autoconf version 2.12.2\"\n     exit 0 ;;\n   -help | --help | --hel | --he | --h)\n     echo \"\\$ac_cs_usage\"; exit 0 ;;"}, {"sha": "485debaacc5dd7c5a9218d113e2579bfb3dc09bf", "filename": "gcc/configure.in", "status": "modified", "additions": 23, "deletions": 0, "changes": 23, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/2ce3c6c615fa735693e1de39e9777919ba4fd106/gcc%2Fconfigure.in", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/2ce3c6c615fa735693e1de39e9777919ba4fd106/gcc%2Fconfigure.in", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fconfigure.in?ref=2ce3c6c615fa735693e1de39e9777919ba4fd106", "patch": "@@ -130,6 +130,16 @@ AC_ARG_WITH(fast-fixincludes,\n fast_fixinc=\"$with_fast_fixincludes\",\n fast_fixinc=no)\n \n+# Enable init_priority.\n+AC_ARG_ENABLE(init-priority,\n+[  --enable-init-priority  Use attributes to assign initialization order\n+\t\t\t  for static objects.\n+  --disable-init-priority Conform to ISO C++ rules for ordering static objects\n+\t\t\t  (i.e. initialized in order of declaration). ],\n+if [[[ x$enable_init_priority != xno ]]]; then\n+  extra_c_flags=-DUSE_INIT_PRIORITY\n+fi)\n+\n # Enable threads\n # Pass with no value to take the default\n # Pass with a value to specify a thread package\n@@ -2231,6 +2241,8 @@ for machine in $build $host $target; do\n \tmipstx39-*-elf*)\n \t\ttm_file=\"mips/r3900.h mips/elf.h mips/abi64.h libgloss.h\"\n \t\ttmake_file=mips/t-r3900\n+\t\t# FIXME mips-elf should be fixed to use crtstuff.\n+\t\tuse_collect2=yes\n \t\t;;\n \tmips-*-*)\t\t\t\t# Default MIPS RISC-OS 4.0.\n \t\tif [[ x$stabs = xyes ]]; then\n@@ -3323,6 +3335,10 @@ else\n \tdone\n fi\n \n+if [[ x$use_collect2 = xno ]]; then\n+\tuse_collect2=\n+fi\n+\n # Add a definition of USE_COLLECT2 if system wants one.\n # Also tell toplev.c what to do.\n # This substitutes for lots of t-* files.\n@@ -3610,6 +3626,13 @@ if [[ x$enable_haifa != x ]]; then\n     done\n fi\n \n+# Warn if using init_priority.\n+AC_MSG_CHECKING(whether to enable init_priority by default)\n+if [[ x$enable_init_priority != xyes ]]; then\n+  enable_init_priority=no\n+fi\n+AC_MSG_RESULT($enable_init_priority)\n+\n # Nothing to do for FLOAT_H, float_format already handled.\n objdir=`pwd`\n AC_SUBST(objdir)"}, {"sha": "00566fcf71aa34aca2834384d2aab4f6eb6ed809", "filename": "gcc/cp/ChangeLog", "status": "modified", "additions": 10, "deletions": 0, "changes": 10, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/2ce3c6c615fa735693e1de39e9777919ba4fd106/gcc%2Fcp%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/2ce3c6c615fa735693e1de39e9777919ba4fd106/gcc%2Fcp%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fcp%2FChangeLog?ref=2ce3c6c615fa735693e1de39e9777919ba4fd106", "patch": "@@ -1,3 +1,13 @@\n+1998-08-13  Jason Merrill  <jason@yorick.cygnus.com>\n+\n+\t* lang-options.h: Add -finit-priority.\n+\t* decl2.c: Likewise.  Check flag_init_priority instead of\n+\tUSE_INIT_PRIORITY.\n+\n+\t* decl2.c (setup_initp): New fn.\n+\t(start_objects, finish_objects, do_ctors): Handle init_priority.\n+\t(do_dtors, finish_file): Likewise.\n+\n 1998-08-13  Jason Merrill  <jason@yorick.cygnus.com>\n \n \t* pt.c (tsubst_copy): Hush warning."}, {"sha": "1176047ce89ec929e53ced49747f74cbad3f6bf9", "filename": "gcc/cp/decl2.c", "status": "modified", "additions": 190, "deletions": 30, "changes": 220, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/2ce3c6c615fa735693e1de39e9777919ba4fd106/gcc%2Fcp%2Fdecl2.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/2ce3c6c615fa735693e1de39e9777919ba4fd106/gcc%2Fcp%2Fdecl2.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fcp%2Fdecl2.c?ref=2ce3c6c615fa735693e1de39e9777919ba4fd106", "patch": "@@ -173,6 +173,14 @@ int flag_alt_external_templates;\n \n int flag_implicit_templates = 1;\n \n+/* Nonzero means allow numerical priorities on constructors.  */\n+\n+#ifdef USE_INIT_PRIORITY\n+int flag_init_priority = 1;\n+#else\n+int flag_init_priority;\n+#endif\n+\n /* Nonzero means warn about implicit declarations.  */\n \n int warn_implicit = 1;\n@@ -492,6 +500,7 @@ static struct { char *string; int *variable; int on_value;} lang_f_options[] =\n   {\"implement-inlines\", &flag_implement_inlines, 1},\n   {\"external-templates\", &flag_external_templates, 1},\n   {\"implicit-templates\", &flag_implicit_templates, 1},\n+  {\"init-priority\", &flag_init_priority, 1},\n   {\"huge-objects\", &flag_huge_objects, 1},\n   {\"conserve-space\", &flag_conserve_space, 1},\n   {\"vtable-thunks\", &flag_vtable_thunks, 1},\n@@ -2929,18 +2938,104 @@ get_sentry (base)\n   return sentry;\n }\n \n+/* A list of objects which have constructors or destructors\n+   which reside in the global scope.  The decl is stored in\n+   the TREE_VALUE slot and the initializer is stored\n+   in the TREE_PURPOSE slot.  */\n+extern tree static_aggregates_initp;\n+\n+/* Set up the static_aggregates* lists for processing.  Subroutine of\n+   finish_file.  Note that this function changes the format of\n+   static_aggregates_initp, from (priority . decl) to\n+   (priority . ((initializer . decl) ...)).  */\n+\n+static void\n+setup_initp ()\n+{\n+  tree t, *p, next_t;\n+\n+  if (! flag_init_priority)\n+    {\n+      for (t = static_aggregates_initp; t; t = TREE_CHAIN (t))\n+\tcp_warning (\"init_priority for `%#D' ignored without -finit-priority\",\n+\t\t    TREE_VALUE (t));\n+      return;\n+    }\n+\n+  /* First, remove any entries from static_aggregates that are also in\n+     static_aggregates_initp, and update the entries in _initp to\n+     include the initializer.  */\n+  p = &static_aggregates;\n+  for (; *p; )\n+    {\n+      t = value_member (TREE_VALUE (*p), static_aggregates_initp);\n+\n+      if (t)\n+\t{\n+\t  TREE_VALUE (t) = *p;\n+\t  *p = TREE_CHAIN (*p);\n+\t  TREE_CHAIN (TREE_VALUE (t)) = NULL_TREE;\n+\t}\n+      else\n+\tp = &TREE_CHAIN (*p);\n+    }\n+\n+  /* Then, group static_aggregates_initp.  After this step, there will only\n+     be one entry for each priority, with a chain coming off it.  */\n+  t = static_aggregates_initp;\n+  static_aggregates_initp = NULL_TREE;\n+\n+  for (; t; t = next_t)\n+    {\n+      next_t = TREE_CHAIN (t);\n+\n+      for (p = &static_aggregates_initp; ; p = &TREE_CHAIN (*p))\n+\t{\n+\t  if (*p == NULL_TREE\n+\t      || tree_int_cst_lt (TREE_PURPOSE (*p), TREE_PURPOSE (t)))\n+\t    {\n+\t      TREE_CHAIN (t) = *p;\n+\t      *p = t;\n+\t      break;\n+\t    }\n+\t  else if (tree_int_cst_equal (TREE_PURPOSE (*p), TREE_PURPOSE (t)))\n+\t    {\n+\t      TREE_CHAIN (TREE_VALUE (t)) = TREE_VALUE (*p);\n+\t      TREE_VALUE (*p) = TREE_VALUE (t);\n+\t      break;\n+\t    }\n+\t}\n+    }\n+\n+  /* Reverse each list to preserve the order (currently reverse declaration\n+     order, for destructors).  */\n+  for (t = static_aggregates_initp; t; t = TREE_CHAIN (t))\n+    TREE_VALUE (t) = nreverse (TREE_VALUE (t));\n+}\n+\n /* Start the process of running a particular set of global constructors\n    or destructors.  Subroutine of do_[cd]tors.  */\n \n static void\n-start_objects (method_type)\n-     int method_type;\n+start_objects (method_type, initp)\n+     int method_type, initp;\n {\n   tree fnname;\n+  char type[10];\n \n   /* Make ctor or dtor function.  METHOD_TYPE may be 'I' or 'D'.  */\n \n-  fnname = get_file_function_name (method_type);\n+  if (flag_init_priority)\n+    {\n+      if (initp == 0)\n+\tinitp = DEFAULT_INIT_PRIORITY;\n+\n+      sprintf (type, \"%c%c%.5u\", method_type, JOINER, initp);\n+    }\n+  else\n+    sprintf (type, \"%c\", method_type);\n+\n+  fnname = get_file_function_name_long (type);\n \n   start_function (void_list_node,\n \t\t  make_call_declarator (fnname, void_list_node, NULL_TREE,\n@@ -2958,18 +3053,21 @@ start_objects (method_type)\n    or destructors.  Subroutine of do_[cd]tors.  */\n \n static void\n-finish_objects (method_type)\n-     int method_type;\n+finish_objects (method_type, initp)\n+     int method_type, initp;\n {\n   char *fnname;\n \n-  tree list = (method_type == 'I' ? static_ctors : static_dtors);\n+  if (! initp)\n+    {\n+      tree list = (method_type == 'I' ? static_ctors : static_dtors);\n \n-  if (! current_function_decl && list)\n-    start_objects (method_type);\n+      if (! current_function_decl && list)\n+\tstart_objects (method_type, initp);\n \n-  for (; list; list = TREE_CHAIN (list))\n-    expand_expr_stmt (build_function_call (TREE_VALUE (list), NULL_TREE));\n+      for (; list; list = TREE_CHAIN (list))\n+\texpand_expr_stmt (build_function_call (TREE_VALUE (list), NULL_TREE));\n+    }\n \n   if (! current_function_decl)\n     return;\n@@ -2982,19 +3080,56 @@ finish_objects (method_type)\n   pop_momentary ();\n   finish_function (lineno, 0, 0);\n \n-  if (method_type == 'I')\n-    assemble_constructor (fnname);\n-  else\n-    assemble_destructor (fnname);\n+  if (! flag_init_priority)\n+    {\n+      if (method_type == 'I')\n+\tassemble_constructor (fnname);\n+      else\n+\tassemble_destructor (fnname);\n+    }\n+\n+#ifdef ASM_OUTPUT_SECTION_NAME\n+  /* If we're using init priority we can't use assemble_*tor, but on ELF\n+     targets we can stick the references into named sections for GNU ld\n+     to collect.  */\n+  if (flag_init_priority)\n+    {\n+      char buf[15];\n+      if (initp == 0)\n+\tinitp = DEFAULT_INIT_PRIORITY;\n+      sprintf (buf, \".%ctors.%.5u\", method_type == 'I' ? 'c' : 'd',\n+\t       /* invert the numbering so the linker puts us in the proper\n+\t\t  order; constructors are run from right to left, and the\n+\t\t  linker sorts in increasing order.  */\n+\t       MAX_INIT_PRIORITY - initp);\n+      named_section (NULL_TREE, buf, 0);\n+      assemble_integer (gen_rtx_SYMBOL_REF (Pmode, fnname),\n+\t\t\tPOINTER_SIZE / BITS_PER_UNIT, 1);\n+    }\n+#endif\n }\n \n-/* Generate a function to run a set of global destructors.  Subroutine of\n-   finish_file.  */\n+/* Generate a function to run a set of global destructors.  START is either\n+   NULL_TREE or a node indicating a set of destructors with the same\n+   init priority.  Subroutine of finish_file.  */\n \n static void\n-do_dtors ()\n+do_dtors (start)\n+     tree start;\n {\n-  tree vars = static_aggregates;\n+  tree vars;\n+  int initp;\n+\n+  if (start)\n+    {\n+      initp = TREE_INT_CST_LOW (TREE_PURPOSE (start));\n+      vars = TREE_VALUE (start);\n+    }\n+  else\n+    {\n+      initp = 0;\n+      vars = static_aggregates;\n+    }\n \n   for (; vars; vars = TREE_CHAIN (vars))\n     {\n@@ -3010,7 +3145,7 @@ do_dtors ()\n \t\t\t\t\t\t|| DECL_WEAK (decl)));\n \n \t  if (! current_function_decl)\n-\t    start_objects ('D');\n+\t    start_objects ('D', initp);\n \n \t  /* Because of:\n \n@@ -3053,16 +3188,30 @@ do_dtors ()\n \t}\n     }\n \n-  finish_objects ('D');\n+  finish_objects ('D', initp);\n }\n \n-/* Generate a function to run a set of global constructors.  Subroutine of\n-   finish_file.  */\n+/* Generate a function to run a set of global constructors.  START is\n+   either NULL_TREE or a node indicating a set of constructors with the\n+   same init priority.  Subroutine of finish_file.  */\n \n static void\n-do_ctors ()\n+do_ctors (start)\n+     tree start;\n {\n-  tree vars = static_aggregates;\n+  tree vars;\n+  int initp;\n+\n+  if (start)\n+    {\n+      initp = TREE_INT_CST_LOW (TREE_PURPOSE (start));\n+      vars = TREE_VALUE (start);\n+    }\n+  else\n+    {\n+      initp = 0;\n+      vars = static_aggregates;\n+    }\n \n   /* Reverse the list so it's in the right order for ctors.  */\n   vars = nreverse (vars);\n@@ -3088,7 +3237,7 @@ do_ctors ()\n \t\t\t\t\t\t|| DECL_WEAK (decl)));\n \n \t  if (! current_function_decl)\n-\t    start_objects ('I');\n+\t    start_objects ('I', initp);\n \n \t  /* Set these global variables so that GDB at least puts\n \t     us near the declaration which required the initialization.  */\n@@ -3148,7 +3297,7 @@ do_ctors ()\n \tmy_friendly_abort (22);\n     }\n \n-  finish_objects ('I');\n+  finish_objects ('I', initp);\n }\n \n /* This routine is called from the last rule in yyparse ().\n@@ -3262,17 +3411,28 @@ finish_file ()\n   if (static_dtors || vars)\n     needs_cleaning = 1;\n \n-  /* The aggregates are listed in reverse declaration order, for cleaning.  */\n+  setup_initp ();\n+\n+  /* After setup_initp, the aggregates are listed in reverse declaration\n+     order, for cleaning.  */\n   if (needs_cleaning)\n     {\n-      do_dtors ();\n+      do_dtors (NULL_TREE);\n+\n+      if (flag_init_priority)\n+\tfor (vars = static_aggregates_initp; vars; vars = TREE_CHAIN (vars))\n+\t  do_dtors (vars);\n     }\n \n   /* do_ctors will reverse the lists for messing up.  */\n   if (needs_messing_up)\n     {\n-      do_ctors ();\n-    }\n+      do_ctors (NULL_TREE);\n+\n+      if (flag_init_priority)\n+\tfor (vars = static_aggregates_initp; vars; vars = TREE_CHAIN (vars))\n+\t  do_ctors (vars);\n+  }\n \n   permanent_allocation (1);\n "}, {"sha": "dc39d28db7abd77ce67af5ddd90a02679cfa9c90", "filename": "gcc/cp/lang-options.h", "status": "modified", "additions": 2, "deletions": 0, "changes": 2, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/2ce3c6c615fa735693e1de39e9777919ba4fd106/gcc%2Fcp%2Flang-options.h", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/2ce3c6c615fa735693e1de39e9777919ba4fd106/gcc%2Fcp%2Flang-options.h", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fcp%2Flang-options.h?ref=2ce3c6c615fa735693e1de39e9777919ba4fd106", "patch": "@@ -66,6 +66,8 @@ DEFINE_LANG_NAME (\"C++\")\n   { \"-fno-implement-inlines\", \"Export functions even if they can be inlined\" },\n   { \"-fimplicit-templates\", \"Emit implicit instatiations if needed\" },\n   { \"-fno-implicit-templates\", \"\" },\n+  { \"-finit-priority\", \"Handle the init_priority attribute\" },\n+  { \"-fno-init-priority\", \"\" },\n   { \"-flabels-ok\", \"Labels can be used as first class objects\" },\n   { \"-fno-labels-ok\", \"\" },\n   { \"-fmemoize-lookups\", \"Enable caching of member function resolutions\" },"}, {"sha": "3d6688bef3285e5307556debd9e861d0002766dc", "filename": "gcc/invoke.texi", "status": "modified", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/2ce3c6c615fa735693e1de39e9777919ba4fd106/gcc%2Finvoke.texi", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/2ce3c6c615fa735693e1de39e9777919ba4fd106/gcc%2Finvoke.texi", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Finvoke.texi?ref=2ce3c6c615fa735693e1de39e9777919ba4fd106", "patch": "@@ -1030,6 +1030,11 @@ your code with this flag (including the C++ library, if you use it).\n \n This flag is not useful when compiling with -fvtable-thunks.\n \n+@item -finit-priority\n+Support @samp{__attribute__ ((init_priority (n)))} for controlling the\n+order of initialization of file-scope objects.  On ELF targets, this\n+requires GNU ld 2.10 or later.\n+\n @item -fno-implement-inlines\n To save space, do not emit out-of-line copies of inline functions\n controlled by @samp{#pragma implementation}.  This will cause linker"}, {"sha": "59c02b4b6294fffbc80c3a770f01066b6e7dddfa", "filename": "gcc/tree.c", "status": "modified", "additions": 25, "deletions": 11, "changes": 36, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/2ce3c6c615fa735693e1de39e9777919ba4fd106/gcc%2Ftree.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/2ce3c6c615fa735693e1de39e9777919ba4fd106/gcc%2Ftree.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftree.c?ref=2ce3c6c615fa735693e1de39e9777919ba4fd106", "patch": "@@ -4806,24 +4806,24 @@ dump_tree_statistics ()\n #define FILE_FUNCTION_PREFIX_LEN 9\n \n #ifndef NO_DOLLAR_IN_LABEL\n-#define FILE_FUNCTION_FORMAT \"_GLOBAL_$D$%s\"\n+#define FILE_FUNCTION_FORMAT \"_GLOBAL_$%s$%s\"\n #else /* NO_DOLLAR_IN_LABEL */\n #ifndef NO_DOT_IN_LABEL\n-#define FILE_FUNCTION_FORMAT \"_GLOBAL_.D.%s\"\n+#define FILE_FUNCTION_FORMAT \"_GLOBAL_.%s.%s\"\n #else /* NO_DOT_IN_LABEL */\n-#define FILE_FUNCTION_FORMAT \"_GLOBAL__D_%s\"\n+#define FILE_FUNCTION_FORMAT \"_GLOBAL__%s_%s\"\n #endif\t/* NO_DOT_IN_LABEL */\n #endif\t/* NO_DOLLAR_IN_LABEL */\n \n extern char * first_global_object_name;\n extern char * weak_global_object_name;\n \n-/* If KIND=='I', return a suitable global initializer (constructor) name.\n-   If KIND=='D', return a suitable global clean-up (destructor) name.  */\n+/* TYPE is some string to identify this function to the linker or\n+   collect2.  */\n \n tree\n-get_file_function_name (kind)\n-     int kind;\n+get_file_function_name_long (type)\n+     char *type;\n {\n   char *buf;\n   register char *p;\n@@ -4837,13 +4837,14 @@ get_file_function_name (kind)\n   else\n     p = input_filename;\n \n-  buf = (char *) alloca (sizeof (FILE_FUNCTION_FORMAT) + strlen (p));\n+  buf = (char *) alloca (sizeof (FILE_FUNCTION_FORMAT) + strlen (p)\n+\t\t\t + strlen (type));\n \n   /* Set up the name of the file-level functions we may need.  */\n   /* Use a global object (which is already required to be unique over\n      the program) rather than the file name (which imposes extra\n      constraints).  -- Raeburn@MIT.EDU, 10 Jan 1990.  */\n-  sprintf (buf, FILE_FUNCTION_FORMAT, p);\n+  sprintf (buf, FILE_FUNCTION_FORMAT, type, p);\n \n   /* Don't need to pull weird characters out of global names.  */\n   if (p != first_global_object_name)\n@@ -4866,10 +4867,23 @@ get_file_function_name (kind)\n \t  *p = '_';\n     }\n \n-  buf[FILE_FUNCTION_PREFIX_LEN] = kind;\n-\n   return get_identifier (buf);\n }\n+\n+/* If KIND=='I', return a suitable global initializer (constructor) name.\n+   If KIND=='D', return a suitable global clean-up (destructor) name.  */\n+\n+tree\n+get_file_function_name (kind)\n+     int kind;\n+{\n+  char p[2];\n+  p[0] = kind;\n+  p[1] = 0;\n+\n+  return get_file_function_name_long (p);\n+}\n+\n \f\n /* Expand (the constant part of) a SET_TYPE CONSTRUCTOR node.\n    The result is placed in BUFFER (which has length BIT_SIZE),"}, {"sha": "948787a196048524cfeefd8053491288c3523e9f", "filename": "gcc/tree.h", "status": "modified", "additions": 6, "deletions": 0, "changes": 6, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/2ce3c6c615fa735693e1de39e9777919ba4fd106/gcc%2Ftree.h", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/2ce3c6c615fa735693e1de39e9777919ba4fd106/gcc%2Ftree.h", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftree.h?ref=2ce3c6c615fa735693e1de39e9777919ba4fd106", "patch": "@@ -1124,6 +1124,11 @@ struct tree_type\n    do not allocate storage, and refer to a definition elsewhere.  */\n #define DECL_EXTERNAL(NODE) (DECL_CHECK (NODE)->decl.external_flag)\n \n+/* In a VAR_DECL for a RECORD_TYPE, sets number for non-init_priority\n+   initializatons. */\n+#define DEFAULT_INIT_PRIORITY 65535\n+#define MAX_INIT_PRIORITY 65535\n+\n /* In a TYPE_DECL\n    nonzero means the detail info about this type is not dumped into stabs.\n    Instead it will generate cross reference ('x') of names. \n@@ -1843,6 +1848,7 @@ extern void (*incomplete_decl_finalize_hook)\tPROTO((tree));\n /* In tree.c */\n extern char *perm_calloc\t\t\tPROTO((int, long));\n extern tree get_file_function_name\t\tPROTO((int));\n+extern tree get_file_function_name_long \tPROTO((char *));\n extern tree get_set_constructor_bits\t\tPROTO((tree, char *, int));\n extern tree get_set_constructor_bytes\t\tPROTO((tree,\n \t\t\t\t\t\t       unsigned char *, int));"}]}