{"sha": "a2ef8395fa970498985764514044e5fd00f7d5c0", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6YTJlZjgzOTVmYTk3MDQ5ODk4NTc2NDUxNDA0NGU1ZmQwMGY3ZDVjMA==", "commit": {"author": {"name": "Richard Biener", "email": "rguenther@suse.de", "date": "2021-06-22T08:14:02Z"}, "committer": {"name": "Richard Biener", "email": "rguenther@suse.de", "date": "2021-06-22T10:09:59Z"}, "message": "tree-optimization/101151 - fix irreducible region check for sinking\n\nThe check whether two blocks are in the same irreducible region\nand thus post-dominance checks being unreliable was incomplete\nsince an irreducible region can contain reducible sub-regions but\nif one block is in the irreducible part and one not the check\nstill doesn't work as expected.\n\n2021-06-22  Richard Biener  <rguenther@suse.de>\n\n\tPR tree-optimization/101151\n\t* tree-ssa-sink.c (statement_sink_location): Expand irreducible\n\tregion check.\n\n\t* gcc.dg/torture/pr101151.c: New testcase.", "tree": {"sha": "10b6023661e131ef103b33f2cca0018f39c8df1f", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/10b6023661e131ef103b33f2cca0018f39c8df1f"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/a2ef8395fa970498985764514044e5fd00f7d5c0", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/a2ef8395fa970498985764514044e5fd00f7d5c0", "html_url": "https://github.com/Rust-GCC/gccrs/commit/a2ef8395fa970498985764514044e5fd00f7d5c0", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/a2ef8395fa970498985764514044e5fd00f7d5c0/comments", "author": {"login": "rguenth", "id": 2046526, "node_id": "MDQ6VXNlcjIwNDY1MjY=", "avatar_url": "https://avatars.githubusercontent.com/u/2046526?v=4", "gravatar_id": "", "url": "https://api.github.com/users/rguenth", "html_url": "https://github.com/rguenth", "followers_url": "https://api.github.com/users/rguenth/followers", "following_url": "https://api.github.com/users/rguenth/following{/other_user}", "gists_url": "https://api.github.com/users/rguenth/gists{/gist_id}", "starred_url": "https://api.github.com/users/rguenth/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/rguenth/subscriptions", "organizations_url": "https://api.github.com/users/rguenth/orgs", "repos_url": "https://api.github.com/users/rguenth/repos", "events_url": "https://api.github.com/users/rguenth/events{/privacy}", "received_events_url": "https://api.github.com/users/rguenth/received_events", "type": "User", "site_admin": false}, "committer": {"login": "rguenth", "id": 2046526, "node_id": "MDQ6VXNlcjIwNDY1MjY=", "avatar_url": "https://avatars.githubusercontent.com/u/2046526?v=4", "gravatar_id": "", "url": "https://api.github.com/users/rguenth", "html_url": "https://github.com/rguenth", "followers_url": "https://api.github.com/users/rguenth/followers", "following_url": "https://api.github.com/users/rguenth/following{/other_user}", "gists_url": "https://api.github.com/users/rguenth/gists{/gist_id}", "starred_url": "https://api.github.com/users/rguenth/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/rguenth/subscriptions", "organizations_url": "https://api.github.com/users/rguenth/orgs", "repos_url": "https://api.github.com/users/rguenth/repos", "events_url": "https://api.github.com/users/rguenth/events{/privacy}", "received_events_url": "https://api.github.com/users/rguenth/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "7822285515cd4dab86f722a9f4969b6952904a37", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/7822285515cd4dab86f722a9f4969b6952904a37", "html_url": "https://github.com/Rust-GCC/gccrs/commit/7822285515cd4dab86f722a9f4969b6952904a37"}], "stats": {"total": 28, "additions": 27, "deletions": 1}, "files": [{"sha": "15c9a7b7f57f4cfb3195860043d066d221975515", "filename": "gcc/testsuite/gcc.dg/torture/pr101151.c", "status": "added", "additions": 19, "deletions": 0, "changes": 19, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/a2ef8395fa970498985764514044e5fd00f7d5c0/gcc%2Ftestsuite%2Fgcc.dg%2Ftorture%2Fpr101151.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/a2ef8395fa970498985764514044e5fd00f7d5c0/gcc%2Ftestsuite%2Fgcc.dg%2Ftorture%2Fpr101151.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgcc.dg%2Ftorture%2Fpr101151.c?ref=a2ef8395fa970498985764514044e5fd00f7d5c0", "patch": "@@ -0,0 +1,19 @@\n+/* { dg-do compile } */\n+\n+int a, *b = &a, c, d;\n+int main() {\n+  *b;\n+  if (a) {\n+  L1:\n+    a = 0;\n+  L2:\n+    if (d) {\n+      while (b)\n+        ;\n+      goto L1;\n+    }\n+  }\n+  if (c)\n+    goto L2;\n+  return 0;\n+}"}, {"sha": "92f444ec1c818915c505cd2365a26f78a9bdc258", "filename": "gcc/tree-ssa-sink.c", "status": "modified", "additions": 8, "deletions": 1, "changes": 9, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/a2ef8395fa970498985764514044e5fd00f7d5c0/gcc%2Ftree-ssa-sink.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/a2ef8395fa970498985764514044e5fd00f7d5c0/gcc%2Ftree-ssa-sink.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftree-ssa-sink.c?ref=a2ef8395fa970498985764514044e5fd00f7d5c0", "patch": "@@ -398,7 +398,14 @@ statement_sink_location (gimple *stmt, basic_block frombb,\n \t\t      && dominated_by_p (CDI_POST_DOMINATORS, commondom, bb)\n \t\t      /* If the blocks are possibly within the same irreducible\n \t\t\t cycle the above check breaks down.  */\n-\t\t      && !(bb->flags & commondom->flags & BB_IRREDUCIBLE_LOOP))\n+\t\t      && !((bb->flags & commondom->flags & BB_IRREDUCIBLE_LOOP)\n+\t\t\t   && bb->loop_father == commondom->loop_father)\n+\t\t      && !((commondom->flags & BB_IRREDUCIBLE_LOOP)\n+\t\t\t   && flow_loop_nested_p (commondom->loop_father,\n+\t\t\t\t\t\t  bb->loop_father))\n+\t\t      && !((bb->flags & BB_IRREDUCIBLE_LOOP)\n+\t\t\t   && flow_loop_nested_p (bb->loop_father,\n+\t\t\t\t\t\t  commondom->loop_father)))\n \t\t    continue;\n \t\t  bb = EDGE_PRED (bb, PHI_ARG_INDEX_FROM_USE (use_p))->src;\n \t\t}"}]}