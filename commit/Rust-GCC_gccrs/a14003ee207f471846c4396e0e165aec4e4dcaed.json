{"sha": "a14003ee207f471846c4396e0e165aec4e4dcaed", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6YTE0MDAzZWUyMDdmNDcxODQ2YzQzOTZlMGUxNjVhZWM0ZTRkY2FlZA==", "commit": {"author": {"name": "Jan Hubicka", "email": "hubicka@freesoft.cz", "date": "1999-04-15T23:24:57Z"}, "committer": {"name": "Jeff Law", "email": "law@gcc.gnu.org", "date": "1999-04-15T23:24:57Z"}, "message": "* i386.c (x86_adjust_cost): Move break statement to correct place.\n\nFrom-SVN: r26485", "tree": {"sha": "5b95ab8caa042bdd4cdc93a91cc762c04e14bf7e", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/5b95ab8caa042bdd4cdc93a91cc762c04e14bf7e"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/a14003ee207f471846c4396e0e165aec4e4dcaed", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/a14003ee207f471846c4396e0e165aec4e4dcaed", "html_url": "https://github.com/Rust-GCC/gccrs/commit/a14003ee207f471846c4396e0e165aec4e4dcaed", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/a14003ee207f471846c4396e0e165aec4e4dcaed/comments", "author": null, "committer": null, "parents": [{"sha": "6419e5b06383f259492f5365dc8a907c54cca709", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/6419e5b06383f259492f5365dc8a907c54cca709", "html_url": "https://github.com/Rust-GCC/gccrs/commit/6419e5b06383f259492f5365dc8a907c54cca709"}], "stats": {"total": 171, "additions": 110, "deletions": 61}, "files": [{"sha": "2d77e3e573c4b26000e06fb30419864cb4229831", "filename": "gcc/ChangeLog", "status": "modified", "additions": 4, "deletions": 0, "changes": 4, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/a14003ee207f471846c4396e0e165aec4e4dcaed/gcc%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/a14003ee207f471846c4396e0e165aec4e4dcaed/gcc%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2FChangeLog?ref=a14003ee207f471846c4396e0e165aec4e4dcaed", "patch": "@@ -1,3 +1,7 @@\n+Fri Apr 16 00:19:31 1999  Jan Hubicka <hubicka@freesoft.cz>\n+\n+\t* i386.c (x86_adjust_cost): Move break statement to correct place.\n+\n Thu Apr 15 23:17:33 1999  Jerry Quinn <jquinn@nortelnetworks.com>\n \n \t* pa.h (HAVE_PRE_INCREMENT, HAVE_POST_INCREMENT,"}, {"sha": "1270226bdd826c201f9c720155fcec4d2ca6294d", "filename": "gcc/config/i386/i386.c", "status": "modified", "additions": 106, "deletions": 61, "changes": 167, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/a14003ee207f471846c4396e0e165aec4e4dcaed/gcc%2Fconfig%2Fi386%2Fi386.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/a14003ee207f471846c4396e0e165aec4e4dcaed/gcc%2Fconfig%2Fi386%2Fi386.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fconfig%2Fi386%2Fi386.c?ref=a14003ee207f471846c4396e0e165aec4e4dcaed", "patch": "@@ -3139,7 +3139,8 @@ put_jump_code (code, reverse, file)\n      FILE *file;\n {\n   int flags = cc_prev_status.flags;\n-  int ieee = (TARGET_IEEE_FP && (flags & CC_IN_80387));\n+  int ieee = (TARGET_IEEE_FP && (flags & CC_IN_80387)\n+\t      && !(cc_prev_status.flags & CC_FCOMI));\n   const char *suffix;\n \n   if (flags & CC_Z_IN_NOT_C)\n@@ -3896,7 +3897,7 @@ notice_update_cc (exp)\n           if (stack_regs_mentioned_p (SET_SRC (XVECEXP (exp, 0, 0))))\n \t    {\n               cc_status.flags |= CC_IN_80387;\n-\t      if (0 && TARGET_CMOVE && stack_regs_mentioned_p\n+\t      if (TARGET_CMOVE && stack_regs_mentioned_p\n \t\t  (XEXP (SET_SRC (XVECEXP (exp, 0, 0)), 1)))\n \t\tcc_status.flags |= CC_FCOMI;\n \t    }\n@@ -4254,7 +4255,7 @@ output_float_compare (insn, operands)\n   int unordered_compare = GET_MODE (SET_SRC (body)) == CCFPEQmode;\n   rtx tmp;\n \n-  if (0 && TARGET_CMOVE && STACK_REG_P (operands[1]))\n+  if (TARGET_CMOVE && STACK_REG_P (operands[1]))\n     {\n       cc_status.flags |= CC_FCOMI;\n       cc_prev_status.flags &= ~CC_TEST_AX;\n@@ -4288,7 +4289,8 @@ output_float_compare (insn, operands)\n \t    {\n \t      output_asm_insn (AS2 (fucomip,%y1,%0), operands);\n \t      output_asm_insn (AS1 (fstp, %y0), operands);\n-\t      return \"\";\n+\t      if (!TARGET_IEEE_FP)\n+\t\treturn \"\";\n \t    }\n \t  else\n \t    output_asm_insn (\"fucompp\", operands);\n@@ -4324,7 +4326,8 @@ output_float_compare (insn, operands)\n       if (cc_status.flags & CC_FCOMI)\n \t{\n \t  output_asm_insn (strcat (buf, AS2 (%z1,%y1,%0)), operands);\n-\t  return \"\";\n+\t  if (!TARGET_IEEE_FP)\n+\t    return \"\";\n \t}\n       else\n         output_asm_insn (strcat (buf, AS1 (%z1,%y1)), operands);\n@@ -4348,17 +4351,19 @@ output_fp_cc0_set (insn)\n   rtx next;\n   enum rtx_code code;\n \n-  xops[0] = gen_rtx_REG (HImode, 0);\n-  output_asm_insn (AS1 (fnsts%W0,%0), xops);\n+  if (!(cc_status.flags & CC_FCOMI))\n+    {\n+      xops[0] = gen_rtx_REG (HImode, 0);\n+      output_asm_insn (AS1 (fnsts%W0,%0), xops);\n+    }\n \n   if (! TARGET_IEEE_FP)\n     {\n       if (!(cc_status.flags & CC_REVERSED))\n         {\n           next = next_cc0_user (insn);\n-\n-          if (GET_CODE (next) == JUMP_INSN\n-              && GET_CODE (PATTERN (next)) == SET\n+  \n+          if (GET_CODE (PATTERN (next)) == SET\n               && SET_DEST (PATTERN (next)) == pc_rtx\n               && GET_CODE (SET_SRC (PATTERN (next))) == IF_THEN_ELSE)\n \t    code = GET_CODE (XEXP (SET_SRC (PATTERN (next)), 0));\n@@ -4383,8 +4388,7 @@ output_fp_cc0_set (insn)\n   if (next == NULL_RTX)\n     abort ();\n \n-  if (GET_CODE (next) == JUMP_INSN\n-      && GET_CODE (PATTERN (next)) == SET\n+  if (GET_CODE (PATTERN (next)) == SET\n       && SET_DEST (PATTERN (next)) == pc_rtx\n       && GET_CODE (SET_SRC (PATTERN (next))) == IF_THEN_ELSE)\n     code = GET_CODE (XEXP (SET_SRC (PATTERN (next)), 0));\n@@ -4407,61 +4411,103 @@ output_fp_cc0_set (insn)\n   else\n     abort ();\n \n-  xops[0] = gen_rtx_REG (QImode, 0);\n+  if (cc_status.flags & CC_FCOMI)\n+    {\n+      /* It is very tricky. We have to do it right. */\n+\n+      xops [0] = gen_rtx_REG (QImode, 0);\n \n-  switch (code)\n+      switch (code)\n+\t{\n+\tcase GT:\n+\tcase GE:\n+\t  break;\n+\n+\tcase LT:\n+\t  output_asm_insn (AS1 (setb,%b0), xops);\n+\t  output_asm_insn (AS1 (setp,%h0), xops);\n+\t  output_asm_insn (AS2 (cmp%B0,%b0,%h0), xops);\n+\t  break;\n+\n+\tcase LE:\n+\t  output_asm_insn (AS1 (setbe,%b0), xops);\n+\t  output_asm_insn (AS1 (setnp,%h0), xops);\n+\t  output_asm_insn (AS2 (xor%B0,%b0,%h0), xops);\n+\t  break;\n+\n+\tcase EQ:\n+\tcase NE:\n+\t  output_asm_insn (AS1 (setne,%b0), xops);\n+\t  output_asm_insn (AS1 (setp,%h0), xops);\n+\t  output_asm_insn (AS2 (or%B0,%b0,%h0), xops);\n+\t  break;\n+\n+\tcase GTU:\n+\tcase LTU:\n+\tcase GEU:\n+\tcase LEU:\n+\tdefault:\n+\t  abort ();\n+\t}\n+    }\n+  else\n     {\n-    case GT:\n-      xops[1] = GEN_INT (0x45);\n-      output_asm_insn (AS2 (and%B0,%1,%h0), xops);\n-      /* je label */\n-      break;\n+      xops[0] = gen_rtx_REG (QImode, 0);\n \n-    case LT:\n-      xops[1] = GEN_INT (0x45);\n-      xops[2] = GEN_INT (0x01);\n-      output_asm_insn (AS2 (and%B0,%1,%h0), xops);\n-      output_asm_insn (AS2 (cmp%B0,%2,%h0), xops);\n-      /* je label */\n-      break;\n+      switch (code)\n+\t{\n+\tcase GT:\n+\t  xops[1] = GEN_INT (0x45);\n+\t  output_asm_insn (AS2 (and%B0,%1,%h0), xops);\n+\t  /* je label */\n+\t  break;\n \n-    case GE:\n-      xops[1] = GEN_INT (0x05);\n-      output_asm_insn (AS2 (and%B0,%1,%h0), xops);\n-      /* je label */\n-      break;\n+\tcase LT:\n+\t  xops[1] = GEN_INT (0x45);\n+\t  xops[2] = GEN_INT (0x01);\n+\t  output_asm_insn (AS2 (and%B0,%1,%h0), xops);\n+\t  output_asm_insn (AS2 (cmp%B0,%2,%h0), xops);\n+\t  /* je label */\n+\t  break;\n \n-    case LE:\n-      xops[1] = GEN_INT (0x45);\n-      xops[2] = GEN_INT (0x40);\n-      output_asm_insn (AS2 (and%B0,%1,%h0), xops);\n-      output_asm_insn (AS1 (dec%B0,%h0), xops);\n-      output_asm_insn (AS2 (cmp%B0,%2,%h0), xops);\n-      /* jb label */\n-      break;\n+\tcase GE:\n+\t  xops[1] = GEN_INT (0x05);\n+\t  output_asm_insn (AS2 (and%B0,%1,%h0), xops);\n+\t  /* je label */\n+\t  break;\n \n-    case EQ:\n-      xops[1] = GEN_INT (0x45);\n-      xops[2] = GEN_INT (0x40);\n-      output_asm_insn (AS2 (and%B0,%1,%h0), xops);\n-      output_asm_insn (AS2 (cmp%B0,%2,%h0), xops);\n-      /* je label */\n-      break;\n+\tcase LE:\n+\t  xops[1] = GEN_INT (0x45);\n+\t  xops[2] = GEN_INT (0x40);\n+\t  output_asm_insn (AS2 (and%B0,%1,%h0), xops);\n+\t  output_asm_insn (AS1 (dec%B0,%h0), xops);\n+\t  output_asm_insn (AS2 (cmp%B0,%2,%h0), xops);\n+\t  /* jb label */\n+\t  break;\n \n-    case NE:\n-      xops[1] = GEN_INT (0x44);\n-      xops[2] = GEN_INT (0x40);\n-      output_asm_insn (AS2 (and%B0,%1,%h0), xops);\n-      output_asm_insn (AS2 (xor%B0,%2,%h0), xops);\n-      /* jne label */\n-      break;\n+\tcase EQ:\n+\t  xops[1] = GEN_INT (0x45);\n+\t  xops[2] = GEN_INT (0x40);\n+\t  output_asm_insn (AS2 (and%B0,%1,%h0), xops);\n+\t  output_asm_insn (AS2 (cmp%B0,%2,%h0), xops);\n+\t  /* je label */\n+\t  break;\n \n-    case GTU:\n-    case LTU:\n-    case GEU:\n-    case LEU:\n-    default:\n-      abort ();\n+\tcase NE:\n+\t  xops[1] = GEN_INT (0x44);\n+\t  xops[2] = GEN_INT (0x40);\n+\t  output_asm_insn (AS2 (and%B0,%1,%h0), xops);\n+\t  output_asm_insn (AS2 (xor%B0,%2,%h0), xops);\n+\t  /* jne label */\n+\t  break;\n+\n+\tcase GTU:\n+\tcase LTU:\n+\tcase GEU:\n+\tcase LEU:\n+\tdefault:\n+\t  abort ();\n+\t}\n     }\n \n   return \"\";\n@@ -5493,12 +5539,11 @@ x86_adjust_cost (insn, link, dep_insn, cost)\n \t  && GET_CODE (next_inst) == JUMP_INSN)\n \t/* compare probably paired with jump */\n \treturn 0;\n-      break;\n \n       /* Stores stalls one cycle longer than other insns.  */\n       if (is_fp_insn (insn) && cost && is_fp_store (dep_insn))\n \tcost++;\n-\n+      break;\n     case PROCESSOR_K6:\n     default:\n       if (!is_fp_dest (dep_insn))"}]}