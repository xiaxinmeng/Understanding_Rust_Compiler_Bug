{"sha": "c7c0f73d6801b4e839775ec2a09c1acf6378dbda", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6YzdjMGY3M2Q2ODAxYjRlODM5Nzc1ZWMyYTA5YzFhY2Y2Mzc4ZGJkYQ==", "commit": {"author": {"name": "Richard Sandiford", "email": "rdsandiford@googlemail.com", "date": "2010-11-07T08:31:21Z"}, "committer": {"name": "Richard Sandiford", "email": "rsandifo@gcc.gnu.org", "date": "2010-11-07T08:31:21Z"}, "message": "mips.c (mips_rtx_costs): Handle FMA.\n\ngcc/\n\t* config/mips/mips.c (mips_rtx_costs): Handle FMA.\n\t* config/mips/mips.md (*madd4<mode>, *madd3<mode>, *msub4<mode>)\n\t(*msub3<mode>, *nmadd4<mode>_fastmath, *nmadd3<mode>_fastmath)\n\t(*nmsub4<mode>_fastmath, *nmsub3<mode>_fastmath): Delete.\n\t(*nmadd4<mode>, *nmadd3<mode>. *nmsub4<mode>, *nmsub3<mode>): Redefine\n\tto use FMA.\n\t(fma<mode>4, *fma<mode>4_madd3, *fma<mode>4_madd4): New patterns.\n\t(fms<mode>4, *fms<mode>4_msub3, *fms<mode>4_msub4): Likewise.\n\t(fnms<mode>4, *fnms<mode>4_nmadd3, *fnms<mode>4_nmadd4): Likewise.\n\t(fnma<mode>4, *fnma<mode>4_nmsub3, *fnma<mode>4_nmsub4): Likewise.\n\ngcc/testsuite/\n\t* gcc.target/mips/mips.exp: Add support for -ffp-contract.\n\t* gcc.target/mips/fma-1.c: New test.\n\t* gcc.target/mips/fma-2.c: Likewise.\n\t* gcc.target/mips/fma-3.c: Likewise.\n\t* gcc.target/mips/fma-4.c: Likewise.\n\t* gcc.target/mips/fma-5.c: Likewise.\n\t* gcc.target/mips/fma-6.c: Likewise.\n\t* gcc.target/mips/fma-7.c: Likewise.\n\t* gcc.target/mips/fma-8.c: Likewise.\n\t* gcc.target/mips/fma-9.c: Likewise.\n\t* gcc.target/mips/fma-10.c: Likewise.\n\t* gcc.target/mips/fma-11.c: Likewise.\n\t* gcc.target/mips/fma-12.c: Likewise.\n\t* gcc.target/mips/fma-13.c: Likewise.\n\t* gcc.target/mips/fma-14.c: Likewise.\n\t* gcc.target/mips/fma-15.c: Likewise.\n\t* gcc.target/mips/fma-16.c: Likewise.\n\t* gcc.target/mips/fma-17.c: Likewise.\n\t* gcc.target/mips/fma-18.c: Likewise.\n\t* gcc.target/mips/fma-19.c: Likewise.\n\t* gcc.target/mips/fma-20.c: Likewise.\n\nFrom-SVN: r166414", "tree": {"sha": "edb7d2ffaa18aad04bf1fc786b747a7550468a9b", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/edb7d2ffaa18aad04bf1fc786b747a7550468a9b"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/c7c0f73d6801b4e839775ec2a09c1acf6378dbda", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/c7c0f73d6801b4e839775ec2a09c1acf6378dbda", "html_url": "https://github.com/Rust-GCC/gccrs/commit/c7c0f73d6801b4e839775ec2a09c1acf6378dbda", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/c7c0f73d6801b4e839775ec2a09c1acf6378dbda/comments", "author": {"login": "rsandifo", "id": 4235983, "node_id": "MDQ6VXNlcjQyMzU5ODM=", "avatar_url": "https://avatars.githubusercontent.com/u/4235983?v=4", "gravatar_id": "", "url": "https://api.github.com/users/rsandifo", "html_url": "https://github.com/rsandifo", "followers_url": "https://api.github.com/users/rsandifo/followers", "following_url": "https://api.github.com/users/rsandifo/following{/other_user}", "gists_url": "https://api.github.com/users/rsandifo/gists{/gist_id}", "starred_url": "https://api.github.com/users/rsandifo/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/rsandifo/subscriptions", "organizations_url": "https://api.github.com/users/rsandifo/orgs", "repos_url": "https://api.github.com/users/rsandifo/repos", "events_url": "https://api.github.com/users/rsandifo/events{/privacy}", "received_events_url": "https://api.github.com/users/rsandifo/received_events", "type": "User", "site_admin": false}, "committer": null, "parents": [{"sha": "4de2f020aaca3d0a8112acc6234a34bb5d578fa0", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/4de2f020aaca3d0a8112acc6234a34bb5d578fa0", "html_url": "https://github.com/Rust-GCC/gccrs/commit/4de2f020aaca3d0a8112acc6234a34bb5d578fa0"}], "stats": {"total": 1395, "additions": 1305, "deletions": 90}, "files": [{"sha": "8b590661467e014a4fcb58639f31f7ca81b42367", "filename": "gcc/ChangeLog", "status": "modified", "additions": 13, "deletions": 0, "changes": 13, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/c7c0f73d6801b4e839775ec2a09c1acf6378dbda/gcc%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/c7c0f73d6801b4e839775ec2a09c1acf6378dbda/gcc%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2FChangeLog?ref=c7c0f73d6801b4e839775ec2a09c1acf6378dbda", "patch": "@@ -1,3 +1,16 @@\n+2010-11-07  Richard Sandiford  <rdsandiford@googlemail.com>\n+\n+\t* config/mips/mips.c (mips_rtx_costs): Handle FMA.\n+\t* config/mips/mips.md (*madd4<mode>, *madd3<mode>, *msub4<mode>)\n+\t(*msub3<mode>, *nmadd4<mode>_fastmath, *nmadd3<mode>_fastmath)\n+\t(*nmsub4<mode>_fastmath, *nmsub3<mode>_fastmath): Delete.\n+\t(*nmadd4<mode>, *nmadd3<mode>. *nmsub4<mode>, *nmsub3<mode>): Redefine\n+\tto use FMA.\n+\t(fma<mode>4, *fma<mode>4_madd3, *fma<mode>4_madd4): New patterns.\n+\t(fms<mode>4, *fms<mode>4_msub3, *fms<mode>4_msub4): Likewise.\n+\t(fnms<mode>4, *fnms<mode>4_nmadd3, *fnms<mode>4_nmadd4): Likewise.\n+\t(fnma<mode>4, *fnma<mode>4_nmsub3, *fnma<mode>4_nmsub4): Likewise.\n+\n 2010-11-06  Simon Martin  <simartin@users.sourceforge.net>\n \n \tPR c/43384"}, {"sha": "c10e9d1a7597c1064951e7ffe1d8627fbfb126ca", "filename": "gcc/config/mips/mips.c", "status": "modified", "additions": 4, "deletions": 0, "changes": 4, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/c7c0f73d6801b4e839775ec2a09c1acf6378dbda/gcc%2Fconfig%2Fmips%2Fmips.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/c7c0f73d6801b4e839775ec2a09c1acf6378dbda/gcc%2Fconfig%2Fmips%2Fmips.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fconfig%2Fmips%2Fmips.c?ref=c7c0f73d6801b4e839775ec2a09c1acf6378dbda", "patch": "@@ -3827,6 +3827,10 @@ mips_rtx_costs (rtx x, int code, int outer_code, int *total, bool speed)\n \t*total = mips_cost->int_mult_si;\n       return false;\n \n+    case FMA:\n+      *total = mips_fp_mult_cost (mode);\n+      return false;\n+\n     case DIV:\n       /* Check for a reciprocal.  */\n       if (float_mode_p"}, {"sha": "a5f5d488b6b3c88bfac9b18a33db5521764cd5ae", "filename": "gcc/config/mips/mips.md", "status": "modified", "additions": 108, "deletions": 90, "changes": 198, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/c7c0f73d6801b4e839775ec2a09c1acf6378dbda/gcc%2Fconfig%2Fmips%2Fmips.md", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/c7c0f73d6801b4e839775ec2a09c1acf6378dbda/gcc%2Fconfig%2Fmips%2Fmips.md", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fconfig%2Fmips%2Fmips.md?ref=c7c0f73d6801b4e839775ec2a09c1acf6378dbda", "patch": "@@ -2077,158 +2077,176 @@\n \n ;; Floating point multiply accumulate instructions.\n \n-(define_insn \"*madd4<mode>\"\n-  [(set (match_operand:ANYF 0 \"register_operand\" \"=f\")\n-\t(plus:ANYF (mult:ANYF (match_operand:ANYF 1 \"register_operand\" \"f\")\n-\t\t\t      (match_operand:ANYF 2 \"register_operand\" \"f\"))\n-\t\t   (match_operand:ANYF 3 \"register_operand\" \"f\")))]\n-  \"ISA_HAS_FP_MADD4_MSUB4 && TARGET_FUSED_MADD\"\n-  \"madd.<fmt>\\t%0,%3,%1,%2\"\n-  [(set_attr \"type\" \"fmadd\")\n-   (set_attr \"mode\" \"<UNITMODE>\")])\n+(define_expand \"fma<mode>4\"\n+  [(set (match_operand:ANYF 0 \"register_operand\")\n+\t(fma:ANYF (match_operand:ANYF 1 \"register_operand\")\n+\t\t  (match_operand:ANYF 2 \"register_operand\")\n+\t\t  (match_operand:ANYF 3 \"register_operand\")))]\n+  \"ISA_HAS_FP_MADD3_MSUB3 || ISA_HAS_FP_MADD4_MSUB4\")\n \n-(define_insn \"*madd3<mode>\"\n+(define_insn \"*fma<mode>4_madd3\"\n   [(set (match_operand:ANYF 0 \"register_operand\" \"=f\")\n-\t(plus:ANYF (mult:ANYF (match_operand:ANYF 1 \"register_operand\" \"f\")\n-\t\t\t      (match_operand:ANYF 2 \"register_operand\" \"f\"))\n-\t\t   (match_operand:ANYF 3 \"register_operand\" \"0\")))]\n-  \"ISA_HAS_FP_MADD3_MSUB3 && TARGET_FUSED_MADD\"\n+\t(fma:ANYF (match_operand:ANYF 1 \"register_operand\" \"f\")\n+\t\t  (match_operand:ANYF 2 \"register_operand\" \"f\")\n+\t\t  (match_operand:ANYF 3 \"register_operand\" \"0\")))]\n+  \"ISA_HAS_FP_MADD3_MSUB3\"\n   \"madd.<fmt>\\t%0,%1,%2\"\n   [(set_attr \"type\" \"fmadd\")\n    (set_attr \"mode\" \"<UNITMODE>\")])\n \n-(define_insn \"*msub4<mode>\"\n+(define_insn \"*fma<mode>4_madd4\"\n   [(set (match_operand:ANYF 0 \"register_operand\" \"=f\")\n-\t(minus:ANYF (mult:ANYF (match_operand:ANYF 1 \"register_operand\" \"f\")\n-\t\t\t       (match_operand:ANYF 2 \"register_operand\" \"f\"))\n-\t\t    (match_operand:ANYF 3 \"register_operand\" \"f\")))]\n-  \"ISA_HAS_FP_MADD4_MSUB4 && TARGET_FUSED_MADD\"\n-  \"msub.<fmt>\\t%0,%3,%1,%2\"\n+\t(fma:ANYF (match_operand:ANYF 1 \"register_operand\" \"f\")\n+\t\t  (match_operand:ANYF 2 \"register_operand\" \"f\")\n+\t\t  (match_operand:ANYF 3 \"register_operand\" \"f\")))]\n+  \"ISA_HAS_FP_MADD4_MSUB4\"\n+  \"madd.<fmt>\\t%0,%3,%1,%2\"\n   [(set_attr \"type\" \"fmadd\")\n    (set_attr \"mode\" \"<UNITMODE>\")])\n \n-(define_insn \"*msub3<mode>\"\n+(define_expand \"fms<mode>4\"\n+  [(set (match_operand:ANYF 0 \"register_operand\")\n+\t(fma:ANYF (match_operand:ANYF 1 \"register_operand\")\n+\t\t  (match_operand:ANYF 2 \"register_operand\")\n+\t\t  (neg:ANYF (match_operand:ANYF 3 \"register_operand\"))))]\n+  \"ISA_HAS_FP_MADD3_MSUB3 || ISA_HAS_FP_MADD4_MSUB4\")\n+\n+(define_insn \"*fms<mode>4_msub3\"\n   [(set (match_operand:ANYF 0 \"register_operand\" \"=f\")\n-\t(minus:ANYF (mult:ANYF (match_operand:ANYF 1 \"register_operand\" \"f\")\n-\t\t\t       (match_operand:ANYF 2 \"register_operand\" \"f\"))\n-\t\t    (match_operand:ANYF 3 \"register_operand\" \"0\")))]\n-  \"ISA_HAS_FP_MADD3_MSUB3 && TARGET_FUSED_MADD\"\n+\t(fma:ANYF (match_operand:ANYF 1 \"register_operand\" \"f\")\n+\t\t  (match_operand:ANYF 2 \"register_operand\" \"f\")\n+\t\t  (neg:ANYF (match_operand:ANYF 3 \"register_operand\" \"0\"))))]\n+  \"ISA_HAS_FP_MADD3_MSUB3\"\n   \"msub.<fmt>\\t%0,%1,%2\"\n   [(set_attr \"type\" \"fmadd\")\n    (set_attr \"mode\" \"<UNITMODE>\")])\n \n-(define_insn \"*nmadd4<mode>\"\n+(define_insn \"*fms<mode>4_msub4\"\n   [(set (match_operand:ANYF 0 \"register_operand\" \"=f\")\n-\t(neg:ANYF (plus:ANYF\n-\t\t   (mult:ANYF (match_operand:ANYF 1 \"register_operand\" \"f\")\n-\t\t\t      (match_operand:ANYF 2 \"register_operand\" \"f\"))\n-\t\t   (match_operand:ANYF 3 \"register_operand\" \"f\"))))]\n-  \"ISA_HAS_NMADD4_NMSUB4 (<MODE>mode)\n-   && TARGET_FUSED_MADD\n-   && HONOR_SIGNED_ZEROS (<MODE>mode)\n-   && !HONOR_NANS (<MODE>mode)\"\n-  \"nmadd.<fmt>\\t%0,%3,%1,%2\"\n+\t(fma:ANYF (match_operand:ANYF 1 \"register_operand\" \"f\")\n+\t\t  (match_operand:ANYF 2 \"register_operand\" \"f\")\n+\t\t  (neg:ANYF (match_operand:ANYF 3 \"register_operand\" \"f\"))))]\n+  \"ISA_HAS_FP_MADD4_MSUB4\"\n+  \"msub.<fmt>\\t%0,%3,%1,%2\"\n   [(set_attr \"type\" \"fmadd\")\n    (set_attr \"mode\" \"<UNITMODE>\")])\n \n-(define_insn \"*nmadd3<mode>\"\n+;; If we're ignoring signed zeros, we can use NMADD (-(a * b + c)) to\n+;; implement fnms (-a * b - c, which is unconditionally equivalent to\n+;; -(a * b) - c).\n+(define_expand \"fnms<mode>4\"\n+  [(set (match_operand:ANYF 0 \"register_operand\")\n+\t(fma:ANYF (neg:ANYF (match_operand:ANYF 1 \"register_operand\"))\n+\t\t  (match_operand:ANYF 2 \"register_operand\")\n+\t\t  (neg:ANYF (match_operand:ANYF 3 \"register_operand\"))))]\n+  \"(ISA_HAS_NMADD3_NMSUB3 (<MODE>mode) || ISA_HAS_NMADD4_NMSUB4 (<MODE>mode))\n+   && !HONOR_SIGNED_ZEROS (<MODE>mode)\n+   && !HONOR_NANS (<MODE>mode)\")\n+\n+(define_insn \"*fnms<mode>4_nmadd3\"\n   [(set (match_operand:ANYF 0 \"register_operand\" \"=f\")\n-\t(neg:ANYF (plus:ANYF\n-\t\t   (mult:ANYF (match_operand:ANYF 1 \"register_operand\" \"f\")\n-\t\t\t      (match_operand:ANYF 2 \"register_operand\" \"f\"))\n-\t\t   (match_operand:ANYF 3 \"register_operand\" \"0\"))))]\n+\t(fma:ANYF (neg:ANYF (match_operand:ANYF 1 \"register_operand\" \"f\"))\n+\t\t  (match_operand:ANYF 2 \"register_operand\" \"f\")\n+\t\t  (neg:ANYF (match_operand:ANYF 3 \"register_operand\" \"0\"))))]\n   \"ISA_HAS_NMADD3_NMSUB3 (<MODE>mode)\n-   && TARGET_FUSED_MADD\n-   && HONOR_SIGNED_ZEROS (<MODE>mode)\n+   && !HONOR_SIGNED_ZEROS (<MODE>mode)\n    && !HONOR_NANS (<MODE>mode)\"\n   \"nmadd.<fmt>\\t%0,%1,%2\"\n   [(set_attr \"type\" \"fmadd\")\n    (set_attr \"mode\" \"<UNITMODE>\")])\n \n-(define_insn \"*nmadd4<mode>_fastmath\"\n+(define_insn \"*fnms<mode>4_nmadd4\"\n   [(set (match_operand:ANYF 0 \"register_operand\" \"=f\")\n-\t(minus:ANYF\n-\t (mult:ANYF (neg:ANYF (match_operand:ANYF 1 \"register_operand\" \"f\"))\n-\t\t    (match_operand:ANYF 2 \"register_operand\" \"f\"))\n-\t (match_operand:ANYF 3 \"register_operand\" \"f\")))]\n+\t(fma:ANYF (neg:ANYF (match_operand:ANYF 1 \"register_operand\" \"f\"))\n+\t\t  (match_operand:ANYF 2 \"register_operand\" \"f\")\n+\t\t  (neg:ANYF (match_operand:ANYF 3 \"register_operand\" \"f\"))))]\n   \"ISA_HAS_NMADD4_NMSUB4 (<MODE>mode)\n-   && TARGET_FUSED_MADD\n    && !HONOR_SIGNED_ZEROS (<MODE>mode)\n    && !HONOR_NANS (<MODE>mode)\"\n   \"nmadd.<fmt>\\t%0,%3,%1,%2\"\n   [(set_attr \"type\" \"fmadd\")\n    (set_attr \"mode\" \"<UNITMODE>\")])\n \n-(define_insn \"*nmadd3<mode>_fastmath\"\n+(define_insn \"*nmadd3\"\n   [(set (match_operand:ANYF 0 \"register_operand\" \"=f\")\n-\t(minus:ANYF\n-\t (mult:ANYF (neg:ANYF (match_operand:ANYF 1 \"register_operand\" \"f\"))\n-\t\t    (match_operand:ANYF 2 \"register_operand\" \"f\"))\n-\t (match_operand:ANYF 3 \"register_operand\" \"0\")))]\n-  \"ISA_HAS_NMADD3_NMSUB3 (<MODE>mode)\n-   && TARGET_FUSED_MADD\n-   && !HONOR_SIGNED_ZEROS (<MODE>mode)\n-   && !HONOR_NANS (<MODE>mode)\"\n+  \t(neg:ANYF\n+\t (fma:ANYF (match_operand:ANYF 1 \"register_operand\" \"f\")\n+\t\t   (match_operand:ANYF 2 \"register_operand\" \"f\")\n+\t\t   (match_operand:ANYF 3 \"register_operand\" \"0\"))))]\n+  \"ISA_HAS_NMADD3_NMSUB3 (<MODE>mode) && !HONOR_NANS (<MODE>mode)\"\n   \"nmadd.<fmt>\\t%0,%1,%2\"\n   [(set_attr \"type\" \"fmadd\")\n    (set_attr \"mode\" \"<UNITMODE>\")])\n \n-(define_insn \"*nmsub4<mode>\"\n+(define_insn \"*nmadd4\"\n   [(set (match_operand:ANYF 0 \"register_operand\" \"=f\")\n-\t(neg:ANYF (minus:ANYF\n-\t\t   (mult:ANYF (match_operand:ANYF 2 \"register_operand\" \"f\")\n-\t\t\t      (match_operand:ANYF 3 \"register_operand\" \"f\"))\n-\t\t   (match_operand:ANYF 1 \"register_operand\" \"f\"))))]\n-  \"ISA_HAS_NMADD4_NMSUB4 (<MODE>mode)\n-   && TARGET_FUSED_MADD\n-   && HONOR_SIGNED_ZEROS (<MODE>mode)\n-   && !HONOR_NANS (<MODE>mode)\"\n-  \"nmsub.<fmt>\\t%0,%1,%2,%3\"\n+  \t(neg:ANYF\n+\t (fma:ANYF (match_operand:ANYF 1 \"register_operand\" \"f\")\n+\t\t   (match_operand:ANYF 2 \"register_operand\" \"f\")\n+\t\t   (match_operand:ANYF 3 \"register_operand\" \"f\"))))]\n+  \"ISA_HAS_NMADD4_NMSUB4 (<MODE>mode) && !HONOR_NANS (<MODE>mode)\"\n+  \"nmadd.<fmt>\\t%0,%3,%1,%2\"\n   [(set_attr \"type\" \"fmadd\")\n    (set_attr \"mode\" \"<UNITMODE>\")])\n \n-(define_insn \"*nmsub3<mode>\"\n+;; If we're ignoring signed zeros, we can use NMSUB (-(a * b - c)) to\n+;; implement fnma (-a * b + c, which is unconditionally equivalent to\n+;; -(a * b) + c).\n+(define_expand \"fnma<mode>4\"\n+  [(set (match_operand:ANYF 0 \"register_operand\")\n+\t(fma:ANYF (neg:ANYF (match_operand:ANYF 1 \"register_operand\"))\n+\t \t  (match_operand:ANYF 2 \"register_operand\")\n+\t\t  (match_operand:ANYF 3 \"register_operand\")))]\n+  \"(ISA_HAS_NMADD3_NMSUB3 (<MODE>mode) || ISA_HAS_NMADD4_NMSUB4 (<MODE>mode))\n+   && !HONOR_SIGNED_ZEROS (<MODE>mode)\n+   && !HONOR_NANS (<MODE>mode)\")\n+\n+(define_insn \"*fnma<mode>4_nmsub3\"\n   [(set (match_operand:ANYF 0 \"register_operand\" \"=f\")\n-\t(neg:ANYF (minus:ANYF\n-\t\t   (mult:ANYF (match_operand:ANYF 2 \"register_operand\" \"f\")\n-\t\t\t      (match_operand:ANYF 3 \"register_operand\" \"f\"))\n-\t\t   (match_operand:ANYF 1 \"register_operand\" \"0\"))))]\n+\t(fma:ANYF (neg:ANYF (match_operand:ANYF 1 \"register_operand\" \"f\"))\n+\t \t  (match_operand:ANYF 2 \"register_operand\" \"f\")\n+\t\t  (match_operand:ANYF 3 \"register_operand\" \"0\")))]\n   \"ISA_HAS_NMADD3_NMSUB3 (<MODE>mode)\n-   && TARGET_FUSED_MADD\n-   && HONOR_SIGNED_ZEROS (<MODE>mode)\n+   && !HONOR_SIGNED_ZEROS (<MODE>mode)\n    && !HONOR_NANS (<MODE>mode)\"\n   \"nmsub.<fmt>\\t%0,%1,%2\"\n   [(set_attr \"type\" \"fmadd\")\n    (set_attr \"mode\" \"<UNITMODE>\")])\n \n-(define_insn \"*nmsub4<mode>_fastmath\"\n+(define_insn \"*fnma<mode>4_nmsub4\"\n   [(set (match_operand:ANYF 0 \"register_operand\" \"=f\")\n-\t(minus:ANYF\n-\t (match_operand:ANYF 1 \"register_operand\" \"f\")\n-\t (mult:ANYF (match_operand:ANYF 2 \"register_operand\" \"f\")\n-\t\t    (match_operand:ANYF 3 \"register_operand\" \"f\"))))]\n+\t(fma:ANYF (neg:ANYF (match_operand:ANYF 1 \"register_operand\" \"f\"))\n+\t \t  (match_operand:ANYF 2 \"register_operand\" \"f\")\n+\t\t  (match_operand:ANYF 3 \"register_operand\" \"f\")))]\n   \"ISA_HAS_NMADD4_NMSUB4 (<MODE>mode)\n-   && TARGET_FUSED_MADD\n    && !HONOR_SIGNED_ZEROS (<MODE>mode)\n    && !HONOR_NANS (<MODE>mode)\"\n-  \"nmsub.<fmt>\\t%0,%1,%2,%3\"\n+  \"nmsub.<fmt>\\t%0,%3,%1,%2\"\n   [(set_attr \"type\" \"fmadd\")\n    (set_attr \"mode\" \"<UNITMODE>\")])\n \n-(define_insn \"*nmsub3<mode>_fastmath\"\n+(define_insn \"*nmsub3\"\n   [(set (match_operand:ANYF 0 \"register_operand\" \"=f\")\n-\t(minus:ANYF\n-\t (match_operand:ANYF 1 \"register_operand\" \"f\")\n-\t (mult:ANYF (match_operand:ANYF 2 \"register_operand\" \"f\")\n-\t\t    (match_operand:ANYF 3 \"register_operand\" \"0\"))))]\n-  \"ISA_HAS_NMADD3_NMSUB3 (<MODE>mode)\n-   && TARGET_FUSED_MADD\n-   && !HONOR_SIGNED_ZEROS (<MODE>mode)\n-   && !HONOR_NANS (<MODE>mode)\"\n+  \t(neg:ANYF\n+\t (fma:ANYF (match_operand:ANYF 1 \"register_operand\" \"f\")\n+\t \t   (match_operand:ANYF 2 \"register_operand\" \"f\")\n+\t\t   (neg:ANYF (match_operand:ANYF 3 \"register_operand\" \"0\")))))]\n+  \"ISA_HAS_NMADD3_NMSUB3 (<MODE>mode) && !HONOR_NANS (<MODE>mode)\"\n   \"nmsub.<fmt>\\t%0,%1,%2\"\n   [(set_attr \"type\" \"fmadd\")\n    (set_attr \"mode\" \"<UNITMODE>\")])\n \n+(define_insn \"*nmsub4\"\n+  [(set (match_operand:ANYF 0 \"register_operand\" \"=f\")\n+  \t(neg:ANYF\n+\t (fma:ANYF (match_operand:ANYF 1 \"register_operand\" \"f\")\n+\t \t   (match_operand:ANYF 2 \"register_operand\" \"f\")\n+\t\t   (neg:ANYF (match_operand:ANYF 3 \"register_operand\" \"f\")))))]\n+  \"ISA_HAS_NMADD4_NMSUB4 (<MODE>mode) && !HONOR_NANS (<MODE>mode)\"\n+  \"nmsub.<fmt>\\t%0,%3,%1,%2\"\n+  [(set_attr \"type\" \"fmadd\")\n+   (set_attr \"mode\" \"<UNITMODE>\")])\n+\n ;;\n ;;  ....................\n ;;"}, {"sha": "806b1d14a64791bd0b5b2748ee9b9b72d486d6ff", "filename": "gcc/testsuite/ChangeLog", "status": "modified", "additions": 24, "deletions": 0, "changes": 24, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/c7c0f73d6801b4e839775ec2a09c1acf6378dbda/gcc%2Ftestsuite%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/c7c0f73d6801b4e839775ec2a09c1acf6378dbda/gcc%2Ftestsuite%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2FChangeLog?ref=c7c0f73d6801b4e839775ec2a09c1acf6378dbda", "patch": "@@ -1,3 +1,27 @@\n+2010-11-07  Richard Sandiford  <rdsandiford@googlemail.com>\n+\n+\t* gcc.target/mips/mips.exp: Add support for -ffp-contract.\n+\t* gcc.target/mips/fma-1.c: New test.\n+\t* gcc.target/mips/fma-2.c: Likewise.\n+\t* gcc.target/mips/fma-3.c: Likewise.\n+\t* gcc.target/mips/fma-4.c: Likewise.\n+\t* gcc.target/mips/fma-5.c: Likewise.\n+\t* gcc.target/mips/fma-6.c: Likewise.\n+\t* gcc.target/mips/fma-7.c: Likewise.\n+\t* gcc.target/mips/fma-8.c: Likewise.\n+\t* gcc.target/mips/fma-9.c: Likewise.\n+\t* gcc.target/mips/fma-10.c: Likewise.\n+\t* gcc.target/mips/fma-11.c: Likewise.\n+\t* gcc.target/mips/fma-12.c: Likewise.\n+\t* gcc.target/mips/fma-13.c: Likewise.\n+\t* gcc.target/mips/fma-14.c: Likewise.\n+\t* gcc.target/mips/fma-15.c: Likewise.\n+\t* gcc.target/mips/fma-16.c: Likewise.\n+\t* gcc.target/mips/fma-17.c: Likewise.\n+\t* gcc.target/mips/fma-18.c: Likewise.\n+\t* gcc.target/mips/fma-19.c: Likewise.\n+\t* gcc.target/mips/fma-20.c: Likewise.\n+\n 2010-11-06  Jason Merrill  <jason@redhat.com>\n \n \t* g++.dg/cpp0x/constexpr-ctor3.C: New."}, {"sha": "d167473259e78380c3c4a334a65a76412ae06d8f", "filename": "gcc/testsuite/gcc.target/mips/fma-1.c", "status": "added", "additions": 82, "deletions": 0, "changes": 82, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/c7c0f73d6801b4e839775ec2a09c1acf6378dbda/gcc%2Ftestsuite%2Fgcc.target%2Fmips%2Ffma-1.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/c7c0f73d6801b4e839775ec2a09c1acf6378dbda/gcc%2Ftestsuite%2Fgcc.target%2Fmips%2Ffma-1.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgcc.target%2Fmips%2Ffma-1.c?ref=c7c0f73d6801b4e839775ec2a09c1acf6378dbda", "patch": "@@ -0,0 +1,82 @@\n+/* { dg-options \"-mgp64 -mhard-float isa>=4 -O3 -fno-fast-math -ffp-contract=off\" } */\n+/* { dg-final { scan-assembler-times \"\\tmadd\\\\.s\\t\" 3 } } */\n+/* { dg-final { scan-assembler-times \"\\tmsub\\\\.s\\t\" 3 } } */\n+/* { dg-final { scan-assembler-times \"\\tmadd\\\\.d\\t\" 3 } } */\n+/* { dg-final { scan-assembler-times \"\\tmsub\\\\.d\\t\" 3 } } */\n+/* { dg-final { scan-assembler-not \"\\tnmadd\\\\.\" } } */\n+/* { dg-final { scan-assembler-not \"\\tnmsub\\\\.\" } } */\n+\n+/* We should not use NMADD or NMSUB without -ffinite-math-only because\n+   those instructions may perform arithmetic negation.  */\n+\n+NOMIPS16 float\n+madd_s (float b, float c, float d)\n+{\n+  return __builtin_fmaf (b, c, d);\n+}\n+\n+NOMIPS16 float\n+msub_s (float b, float c, float d)\n+{\n+  return __builtin_fmaf (b, c, -d);\n+}\n+\n+NOMIPS16 float\n+not_nmadd_s (float b, float c, float d)\n+{\n+  return -__builtin_fmaf (b, c, d);\n+}\n+\n+NOMIPS16 float\n+not_nmsub_s (float b, float c, float d)\n+{\n+  return -__builtin_fmaf (b, c, -d);\n+}\n+\n+NOMIPS16 float\n+not_nmadd_s_2 (float b, float c, float d)\n+{\n+  return __builtin_fmaf (-b, c, -d);\n+}\n+\n+NOMIPS16 float\n+not_nmsub_s_2 (float b, float c, float d)\n+{\n+  return __builtin_fmaf (-b, c, d);\n+}\n+\n+NOMIPS16 double\n+madd_d (double b, double c, double d)\n+{\n+  return __builtin_fma (b, c, d);\n+}\n+\n+NOMIPS16 double\n+msub_d (double b, double c, double d)\n+{\n+  return __builtin_fma (b, c, -d);\n+}\n+\n+NOMIPS16 double\n+not_nmadd_d (double b, double c, double d)\n+{\n+  return -__builtin_fma (b, c, d);\n+}\n+\n+NOMIPS16 double\n+not_nmsub_d (double b, double c, double d)\n+{\n+  return -__builtin_fma (b, c, -d);\n+}\n+\n+NOMIPS16 double\n+not_nmadd_d_2 (double b, double c, double d)\n+{\n+  return __builtin_fma (-b, c, -d);\n+}\n+\n+NOMIPS16 double\n+not_nmsub_d_2 (double b, double c, double d)\n+{\n+  return __builtin_fma (-b, c, d);\n+}"}, {"sha": "bb3f31b954d0333a32ae3eb8dbd9fe96570dc088", "filename": "gcc/testsuite/gcc.target/mips/fma-10.c", "status": "added", "additions": 62, "deletions": 0, "changes": 62, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/c7c0f73d6801b4e839775ec2a09c1acf6378dbda/gcc%2Ftestsuite%2Fgcc.target%2Fmips%2Ffma-10.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/c7c0f73d6801b4e839775ec2a09c1acf6378dbda/gcc%2Ftestsuite%2Fgcc.target%2Fmips%2Ffma-10.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgcc.target%2Fmips%2Ffma-10.c?ref=c7c0f73d6801b4e839775ec2a09c1acf6378dbda", "patch": "@@ -0,0 +1,62 @@\n+/* { dg-options \"-mpaired-single -O -ffast-math -ftree-vectorize\" } */\n+/* { dg-final { scan-assembler-times \"\\tmadd\\\\.ps\\t\" 1 } } */\n+/* { dg-final { scan-assembler-times \"\\tmsub\\\\.ps\\t\" 1 } } */\n+/* { dg-final { scan-assembler-times \"\\tnmadd\\\\.ps\\t\" 2 } } */\n+/* { dg-final { scan-assembler-times \"\\tnmsub\\\\.ps\\t\" 2 } } */\n+\n+#define N 512\n+float a[N], b[N], c[N], d[N];\n+\n+NOMIPS16 void\n+madd_ps (void)\n+{\n+  int i;\n+\n+  for (i = 0; i < N; i++)\n+    a[i] = __builtin_fmaf (b[i], c[i], d[i]);\n+}\n+\n+NOMIPS16 float\n+msub_ps (void)\n+{\n+  int i;\n+\n+  for (i = 0; i < N; i++)\n+    a[i] = __builtin_fmaf (b[i], c[i], -d[i]);\n+}\n+\n+NOMIPS16 float\n+nmadd_ps (void)\n+{\n+  int i;\n+\n+  for (i = 0; i < N; i++)\n+    a[i] = -__builtin_fmaf (b[i], c[i], d[i]);\n+}\n+\n+NOMIPS16 float\n+nmsub_ps (void)\n+{\n+  int i;\n+\n+  for (i = 0; i < N; i++)\n+    a[i] = -__builtin_fmaf (b[i], c[i], -d[i]);\n+}\n+\n+NOMIPS16 float\n+nmadd_ps_2 (void)\n+{\n+  int i;\n+\n+  for (i = 0; i < N; i++)\n+    a[i] = __builtin_fmaf (-b[i], c[i], -d[i]);\n+}\n+\n+NOMIPS16 float\n+nmsub_ps_2 (void)\n+{\n+  int i;\n+\n+  for (i = 0; i < N; i++)\n+    a[i] = __builtin_fmaf (-b[i], c[i], d[i]);\n+}"}, {"sha": "17f124f28186b1a19e779c5b71c66df603b7d5fa", "filename": "gcc/testsuite/gcc.target/mips/fma-11.c", "status": "added", "additions": 79, "deletions": 0, "changes": 79, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/c7c0f73d6801b4e839775ec2a09c1acf6378dbda/gcc%2Ftestsuite%2Fgcc.target%2Fmips%2Ffma-11.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/c7c0f73d6801b4e839775ec2a09c1acf6378dbda/gcc%2Ftestsuite%2Fgcc.target%2Fmips%2Ffma-11.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgcc.target%2Fmips%2Ffma-11.c?ref=c7c0f73d6801b4e839775ec2a09c1acf6378dbda", "patch": "@@ -0,0 +1,79 @@\n+/* { dg-options \"-mgp64 -mhard-float isa>=4 -O3 -fno-fast-math -ffp-contract=off\" } */\n+/* { dg-final { scan-assembler-not \"\\tmadd\\\\.\" } } */\n+/* { dg-final { scan-assembler-not \"\\tmsub\\\\.\" } } */\n+/* { dg-final { scan-assembler-not \"\\tnmadd\\\\.\" } } */\n+/* { dg-final { scan-assembler-not \"\\tnmsub\\\\.\" } } */\n+\n+/* No function should use fused operations, however high the -O level.  */\n+\n+NOMIPS16 float\n+not_madd_s (float b, float c, float d)\n+{\n+  return b * c + d;\n+}\n+\n+NOMIPS16 float\n+not_msub_s (float b, float c, float d)\n+{\n+  return b * c + -d;\n+}\n+\n+NOMIPS16 float\n+not_nmadd_s (float b, float c, float d)\n+{\n+  return -(b * c + d);\n+}\n+\n+NOMIPS16 float\n+not_nmsub_s (float b, float c, float d)\n+{\n+  return -(b * c + -d);\n+}\n+\n+NOMIPS16 float\n+not_nmadd_s_2 (float b, float c, float d)\n+{\n+  return -b * c - d;\n+}\n+\n+NOMIPS16 float\n+not_nmsub_s_2 (float b, float c, float d)\n+{\n+  return -b * c + d;\n+}\n+\n+NOMIPS16 double\n+not_madd_d (double b, double c, double d)\n+{\n+  return b * c + d;\n+}\n+\n+NOMIPS16 double\n+not_msub_d (double b, double c, double d)\n+{\n+  return b * c + -d;\n+}\n+\n+NOMIPS16 double\n+not_nmadd_d (double b, double c, double d)\n+{\n+  return -(b * c + d);\n+}\n+\n+NOMIPS16 double\n+not_nmsub_d (double b, double c, double d)\n+{\n+  return -(b * c + -d);\n+}\n+\n+NOMIPS16 double\n+not_nmadd_d_2 (double b, double c, double d)\n+{\n+  return -b * c - d;\n+}\n+\n+NOMIPS16 double\n+not_nmsub_d_2 (double b, double c, double d)\n+{\n+  return -b * c + d;\n+}"}, {"sha": "6a6303c394d838013dd781f93fefbe6de8d0d276", "filename": "gcc/testsuite/gcc.target/mips/fma-12.c", "status": "added", "additions": 82, "deletions": 0, "changes": 82, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/c7c0f73d6801b4e839775ec2a09c1acf6378dbda/gcc%2Ftestsuite%2Fgcc.target%2Fmips%2Ffma-12.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/c7c0f73d6801b4e839775ec2a09c1acf6378dbda/gcc%2Ftestsuite%2Fgcc.target%2Fmips%2Ffma-12.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgcc.target%2Fmips%2Ffma-12.c?ref=c7c0f73d6801b4e839775ec2a09c1acf6378dbda", "patch": "@@ -0,0 +1,82 @@\n+/* { dg-options \"-mgp64 -mhard-float isa>=4 -O2 -fno-fast-math -ffp-contract=fast\" } */\n+/* { dg-final { scan-assembler-times \"\\tmadd\\\\.s\\t\" 3 } } */\n+/* { dg-final { scan-assembler-times \"\\tmsub\\\\.s\\t\" 3 } } */\n+/* { dg-final { scan-assembler-times \"\\tmadd\\\\.d\\t\" 3 } } */\n+/* { dg-final { scan-assembler-times \"\\tmsub\\\\.d\\t\" 3 } } */\n+/* { dg-final { scan-assembler-not \"\\tnmadd\\\\.\" } } */\n+/* { dg-final { scan-assembler-not \"\\tnmsub\\\\.\" } } */\n+\n+/* We should not use NMADD or NMSUB without -ffinite-math-only because\n+   those instructions may perform arithmetic negation.  */\n+\n+NOMIPS16 float\n+madd_s (float b, float c, float d)\n+{\n+  return b * c + d;\n+}\n+\n+NOMIPS16 float\n+msub_s (float b, float c, float d)\n+{\n+  return b * c + -d;\n+}\n+\n+NOMIPS16 float\n+not_nmadd_s (float b, float c, float d)\n+{\n+  return -(b * c + d);\n+}\n+\n+NOMIPS16 float\n+not_nmsub_s (float b, float c, float d)\n+{\n+  return -(b * c + -d);\n+}\n+\n+NOMIPS16 float\n+not_nmadd_s_2 (float b, float c, float d)\n+{\n+  return -b * c - d;\n+}\n+\n+NOMIPS16 float\n+not_nmsub_s_2 (float b, float c, float d)\n+{\n+  return -b * c + d;\n+}\n+\n+NOMIPS16 double\n+madd_d (double b, double c, double d)\n+{\n+  return b * c + d;\n+}\n+\n+NOMIPS16 double\n+msub_d (double b, double c, double d)\n+{\n+  return b * c + -d;\n+}\n+\n+NOMIPS16 double\n+not_nmadd_d (double b, double c, double d)\n+{\n+  return -(b * c + d);\n+}\n+\n+NOMIPS16 double\n+not_nmsub_d (double b, double c, double d)\n+{\n+  return -(b * c + -d);\n+}\n+\n+NOMIPS16 double\n+not_nmadd_d_2 (double b, double c, double d)\n+{\n+  return -b * c - d;\n+}\n+\n+NOMIPS16 double\n+not_nmsub_d_2 (double b, double c, double d)\n+{\n+  return -b * c + d;\n+}"}, {"sha": "2dbff9b1d49e9873e874f3ca399a30d9595aab93", "filename": "gcc/testsuite/gcc.target/mips/fma-13.c", "status": "added", "additions": 81, "deletions": 0, "changes": 81, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/c7c0f73d6801b4e839775ec2a09c1acf6378dbda/gcc%2Ftestsuite%2Fgcc.target%2Fmips%2Ffma-13.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/c7c0f73d6801b4e839775ec2a09c1acf6378dbda/gcc%2Ftestsuite%2Fgcc.target%2Fmips%2Ffma-13.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgcc.target%2Fmips%2Ffma-13.c?ref=c7c0f73d6801b4e839775ec2a09c1acf6378dbda", "patch": "@@ -0,0 +1,81 @@\n+/* { dg-options \"-mgp64 -mhard-float isa>=4 -O2 -ffast-math\" } */\n+/* { dg-final { scan-assembler-times \"\\tmadd\\\\.s\\t\" 1 } } */\n+/* { dg-final { scan-assembler-times \"\\tmsub\\\\.s\\t\" 1 } } */\n+/* { dg-final { scan-assembler-times \"\\tnmadd\\\\.s\\t\" 2 } } */\n+/* { dg-final { scan-assembler-times \"\\tnmsub\\\\.s\\t\" 2 } } */\n+/* { dg-final { scan-assembler-times \"\\tmadd\\\\.d\\t\" 1 } } */\n+/* { dg-final { scan-assembler-times \"\\tmsub\\\\.d\\t\" 1 } } */\n+/* { dg-final { scan-assembler-times \"\\tnmadd\\\\.d\\t\" 2 } } */\n+/* { dg-final { scan-assembler-times \"\\tnmsub\\\\.d\\t\" 2 } } */\n+\n+NOMIPS16 float\n+madd_s (float b, float c, float d)\n+{\n+  return b * c + d;\n+}\n+\n+NOMIPS16 float\n+msub_s (float b, float c, float d)\n+{\n+  return b * c + -d;\n+}\n+\n+NOMIPS16 float\n+nmadd_s (float b, float c, float d)\n+{\n+  return -(b * c + d);\n+}\n+\n+NOMIPS16 float\n+nmsub_s (float b, float c, float d)\n+{\n+  return -(b * c + -d);\n+}\n+\n+NOMIPS16 float\n+nmadd_s_2 (float b, float c, float d)\n+{\n+  return -b * c - d;\n+}\n+\n+NOMIPS16 float\n+nmsub_s_2 (float b, float c, float d)\n+{\n+  return -b * c + d;\n+}\n+\n+NOMIPS16 double\n+madd_d (double b, double c, double d)\n+{\n+  return b * c + d;\n+}\n+\n+NOMIPS16 double\n+msub_d (double b, double c, double d)\n+{\n+  return b * c + -d;\n+}\n+\n+NOMIPS16 double\n+nmadd_d (double b, double c, double d)\n+{\n+  return -(b * c + d);\n+}\n+\n+NOMIPS16 double\n+nmsub_d (double b, double c, double d)\n+{\n+  return -(b * c + -d);\n+}\n+\n+NOMIPS16 double\n+nmadd_d_2 (double b, double c, double d)\n+{\n+  return -b * c - d;\n+}\n+\n+NOMIPS16 double\n+nmsub_d_2 (double b, double c, double d)\n+{\n+  return -b * c + d;\n+}"}, {"sha": "383effdc336fa4b58c8ba449516f437f521e781f", "filename": "gcc/testsuite/gcc.target/mips/fma-14.c", "status": "added", "additions": 64, "deletions": 0, "changes": 64, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/c7c0f73d6801b4e839775ec2a09c1acf6378dbda/gcc%2Ftestsuite%2Fgcc.target%2Fmips%2Ffma-14.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/c7c0f73d6801b4e839775ec2a09c1acf6378dbda/gcc%2Ftestsuite%2Fgcc.target%2Fmips%2Ffma-14.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgcc.target%2Fmips%2Ffma-14.c?ref=c7c0f73d6801b4e839775ec2a09c1acf6378dbda", "patch": "@@ -0,0 +1,64 @@\n+/* { dg-options \"-mpaired-single -O3 -fno-fast-math -ftree-vectorize -ffp-contract=off\" } */\n+/* { dg-final { scan-assembler-not \"\\tmadd\\\\.\" } } */\n+/* { dg-final { scan-assembler-not \"\\tmsub\\\\.\" } } */\n+/* { dg-final { scan-assembler-not \"\\tnmadd\\\\.\" } } */\n+/* { dg-final { scan-assembler-not \"\\tnmsub\\\\.\" } } */\n+\n+/* No function should use fused operations, however high the -O level.  */\n+\n+#define N 512\n+float a[N], b[N], c[N], d[N];\n+\n+NOMIPS16 void\n+not_madd_ps (void)\n+{\n+  int i;\n+\n+  for (i = 0; i < N; i++)\n+    a[i] = b[i] * c[i] + d[i];\n+}\n+\n+NOMIPS16 float\n+not_msub_ps (void)\n+{\n+  int i;\n+\n+  for (i = 0; i < N; i++)\n+    a[i] = b[i] * c[i] - d[i];\n+}\n+\n+NOMIPS16 float\n+not_nmadd_ps (void)\n+{\n+  int i;\n+\n+  for (i = 0; i < N; i++)\n+    a[i] = -(b[i] * c[i] + d[i]);\n+}\n+\n+NOMIPS16 float\n+not_nmsub_ps (void)\n+{\n+  int i;\n+\n+  for (i = 0; i < N; i++)\n+    a[i] = -(b[i] * c[i] - d[i]);\n+}\n+\n+NOMIPS16 float\n+not_nmadd_ps_2 (void)\n+{\n+  int i;\n+\n+  for (i = 0; i < N; i++)\n+    a[i] = -b[i] * c[i] - d[i];\n+}\n+\n+NOMIPS16 float\n+not_nmsub_ps_2 (void)\n+{\n+  int i;\n+\n+  for (i = 0; i < N; i++)\n+    a[i] = -b[i] * c[i] + d[i];\n+}"}, {"sha": "4fdfeabaf5641fa212fefc9f01494ecbf0d44835", "filename": "gcc/testsuite/gcc.target/mips/fma-15.c", "status": "added", "additions": 65, "deletions": 0, "changes": 65, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/c7c0f73d6801b4e839775ec2a09c1acf6378dbda/gcc%2Ftestsuite%2Fgcc.target%2Fmips%2Ffma-15.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/c7c0f73d6801b4e839775ec2a09c1acf6378dbda/gcc%2Ftestsuite%2Fgcc.target%2Fmips%2Ffma-15.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgcc.target%2Fmips%2Ffma-15.c?ref=c7c0f73d6801b4e839775ec2a09c1acf6378dbda", "patch": "@@ -0,0 +1,65 @@\n+/* { dg-options \"-mpaired-single -O2 -fno-fast-math -ftree-vectorize -ffp-contract=fast\" } */\n+/* { dg-final { scan-assembler \"\\tmadd\\\\.ps\" } } */\n+/* { dg-final { scan-assembler \"\\tmsub\\\\.ps\" } } */\n+/* { dg-final { scan-assembler-not \"\\tnmadd\\\\.\" } } */\n+/* { dg-final { scan-assembler-not \"\\tnmsub\\\\.\" } } */\n+\n+/* We should not use NMADD or NMSUB without -ffinite-math-only because\n+   those instructions may perform arithmetic negation.  */\n+\n+#define N 512\n+float a[N], b[N], c[N], d[N];\n+\n+NOMIPS16 void\n+madd_ps (void)\n+{\n+  int i;\n+\n+  for (i = 0; i < N; i++)\n+    a[i] = b[i] * c[i] + d[i];\n+}\n+\n+NOMIPS16 float\n+msub_ps (void)\n+{\n+  int i;\n+\n+  for (i = 0; i < N; i++)\n+    a[i] = b[i] * c[i] - d[i];\n+}\n+\n+NOMIPS16 float\n+not_nmadd_ps (void)\n+{\n+  int i;\n+\n+  for (i = 0; i < N; i++)\n+    a[i] = -(b[i] * c[i] + d[i]);\n+}\n+\n+NOMIPS16 float\n+not_nmsub_ps (void)\n+{\n+  int i;\n+\n+  for (i = 0; i < N; i++)\n+    a[i] = -(b[i] * c[i] - d[i]);\n+}\n+\n+NOMIPS16 float\n+not_nmadd_ps_2 (void)\n+{\n+  int i;\n+\n+  for (i = 0; i < N; i++)\n+    a[i] = -b[i] * c[i] - d[i];\n+}\n+\n+NOMIPS16 float\n+not_nmsub_ps_2 (void)\n+{\n+  int i;\n+\n+  for (i = 0; i < N; i++)\n+    a[i] = -b[i] * c[i] + d[i];\n+}"}, {"sha": "16cda123316dca71e7fdfb4b995b37f3d8ff1b17", "filename": "gcc/testsuite/gcc.target/mips/fma-16.c", "status": "added", "additions": 62, "deletions": 0, "changes": 62, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/c7c0f73d6801b4e839775ec2a09c1acf6378dbda/gcc%2Ftestsuite%2Fgcc.target%2Fmips%2Ffma-16.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/c7c0f73d6801b4e839775ec2a09c1acf6378dbda/gcc%2Ftestsuite%2Fgcc.target%2Fmips%2Ffma-16.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgcc.target%2Fmips%2Ffma-16.c?ref=c7c0f73d6801b4e839775ec2a09c1acf6378dbda", "patch": "@@ -0,0 +1,62 @@\n+/* { dg-options \"-mpaired-single -O2 -ffast-math -ftree-vectorize\" } */\n+/* { dg-final { scan-assembler-times \"\\tmadd\\\\.ps\" 1 } } */\n+/* { dg-final { scan-assembler-times \"\\tmsub\\\\.ps\" 1 } } */\n+/* { dg-final { scan-assembler-times \"\\tnmadd\\\\.ps\" 2 } } */\n+/* { dg-final { scan-assembler-times \"\\tnmsub\\\\.ps\" 2 } } */\n+\n+#define N 512\n+float a[N], b[N], c[N], d[N];\n+\n+NOMIPS16 void\n+madd_ps (void)\n+{\n+  int i;\n+\n+  for (i = 0; i < N; i++)\n+    a[i] = b[i] * c[i] + d[i];\n+}\n+\n+NOMIPS16 float\n+msub_ps (void)\n+{\n+  int i;\n+\n+  for (i = 0; i < N; i++)\n+    a[i] = b[i] * c[i] - d[i];\n+}\n+\n+NOMIPS16 float\n+nmadd_ps (void)\n+{\n+  int i;\n+\n+  for (i = 0; i < N; i++)\n+    a[i] = -(b[i] * c[i] + d[i]);\n+}\n+\n+NOMIPS16 float\n+nmsub_ps (void)\n+{\n+  int i;\n+\n+  for (i = 0; i < N; i++)\n+    a[i] = -(b[i] * c[i] - d[i]);\n+}\n+\n+NOMIPS16 float\n+nmadd_ps_2 (void)\n+{\n+  int i;\n+\n+  for (i = 0; i < N; i++)\n+    a[i] = -b[i] * c[i] - d[i];\n+}\n+\n+NOMIPS16 float\n+nmsub_ps_2 (void)\n+{\n+  int i;\n+\n+  for (i = 0; i < N; i++)\n+    a[i] = -b[i] * c[i] + d[i];\n+}"}, {"sha": "87b2de1a9161159e156d4e54ed04c0e4e5a9cf91", "filename": "gcc/testsuite/gcc.target/mips/fma-17.c", "status": "added", "additions": 82, "deletions": 0, "changes": 82, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/c7c0f73d6801b4e839775ec2a09c1acf6378dbda/gcc%2Ftestsuite%2Fgcc.target%2Fmips%2Ffma-17.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/c7c0f73d6801b4e839775ec2a09c1acf6378dbda/gcc%2Ftestsuite%2Fgcc.target%2Fmips%2Ffma-17.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgcc.target%2Fmips%2Ffma-17.c?ref=c7c0f73d6801b4e839775ec2a09c1acf6378dbda", "patch": "@@ -0,0 +1,82 @@\n+/* { dg-options \"-mgp64 -mhard-float isa=loongson -O3 -fno-fast-math -ffp-contract=off\" } */\n+/* { dg-final { scan-assembler-times \"\\tmadd\\\\.s\\t\" 3 } } */\n+/* { dg-final { scan-assembler-times \"\\tmsub\\\\.s\\t\" 3 } } */\n+/* { dg-final { scan-assembler-times \"\\tmadd\\\\.d\\t\" 3 } } */\n+/* { dg-final { scan-assembler-times \"\\tmsub\\\\.d\\t\" 3 } } */\n+/* { dg-final { scan-assembler-not \"\\tnmadd\\\\.\" } } */\n+/* { dg-final { scan-assembler-not \"\\tnmsub\\\\.\" } } */\n+\n+/* We should not use NMADD or NMSUB without -ffinite-math-only because\n+   those instructions may perform arithmetic negation.  */\n+\n+NOMIPS16 float\n+madd_s (float b, float c, float d)\n+{\n+  return __builtin_fmaf (b, c, d);\n+}\n+\n+NOMIPS16 float\n+msub_s (float b, float c, float d)\n+{\n+  return __builtin_fmaf (b, c, -d);\n+}\n+\n+NOMIPS16 float\n+not_nmadd_s (float b, float c, float d)\n+{\n+  return -__builtin_fmaf (b, c, d);\n+}\n+\n+NOMIPS16 float\n+not_nmsub_s (float b, float c, float d)\n+{\n+  return -__builtin_fmaf (b, c, -d);\n+}\n+\n+NOMIPS16 float\n+not_nmadd_s_2 (float b, float c, float d)\n+{\n+  return __builtin_fmaf (-b, c, -d);\n+}\n+\n+NOMIPS16 float\n+not_nmsub_s_2 (float b, float c, float d)\n+{\n+  return __builtin_fmaf (-b, c, d);\n+}\n+\n+NOMIPS16 double\n+madd_d (double b, double c, double d)\n+{\n+  return __builtin_fma (b, c, d);\n+}\n+\n+NOMIPS16 double\n+msub_d (double b, double c, double d)\n+{\n+  return __builtin_fma (b, c, -d);\n+}\n+\n+NOMIPS16 double\n+not_nmadd_d (double b, double c, double d)\n+{\n+  return -__builtin_fma (b, c, d);\n+}\n+\n+NOMIPS16 double\n+not_nmsub_d (double b, double c, double d)\n+{\n+  return -__builtin_fma (b, c, -d);\n+}\n+\n+NOMIPS16 double\n+not_nmadd_d_2 (double b, double c, double d)\n+{\n+  return __builtin_fma (-b, c, -d);\n+}\n+\n+NOMIPS16 double\n+not_nmsub_d_2 (double b, double c, double d)\n+{\n+  return __builtin_fma (-b, c, d);\n+}"}, {"sha": "244f232f8ad284281ac9dbffcf6b3b2e9d847e78", "filename": "gcc/testsuite/gcc.target/mips/fma-18.c", "status": "added", "additions": 81, "deletions": 0, "changes": 81, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/c7c0f73d6801b4e839775ec2a09c1acf6378dbda/gcc%2Ftestsuite%2Fgcc.target%2Fmips%2Ffma-18.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/c7c0f73d6801b4e839775ec2a09c1acf6378dbda/gcc%2Ftestsuite%2Fgcc.target%2Fmips%2Ffma-18.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgcc.target%2Fmips%2Ffma-18.c?ref=c7c0f73d6801b4e839775ec2a09c1acf6378dbda", "patch": "@@ -0,0 +1,81 @@\n+/* { dg-options \"-mgp64 -mhard-float isa=loongson -O -ffast-math\" } */\n+/* { dg-final { scan-assembler-times \"\\tmadd\\\\.s\\t\" 1 } } */\n+/* { dg-final { scan-assembler-times \"\\tmsub\\\\.s\\t\" 1 } } */\n+/* { dg-final { scan-assembler-times \"\\tnmadd\\\\.s\\t\" 2 } } */\n+/* { dg-final { scan-assembler-times \"\\tnmsub\\\\.s\\t\" 2 } } */\n+/* { dg-final { scan-assembler-times \"\\tmadd\\\\.d\\t\" 1 } } */\n+/* { dg-final { scan-assembler-times \"\\tmsub\\\\.d\\t\" 1 } } */\n+/* { dg-final { scan-assembler-times \"\\tnmadd\\\\.d\\t\" 2 } } */\n+/* { dg-final { scan-assembler-times \"\\tnmsub\\\\.d\\t\" 2 } } */\n+\n+NOMIPS16 float\n+madd_s (float b, float c, float d)\n+{\n+  return __builtin_fmaf (b, c, d);\n+}\n+\n+NOMIPS16 float\n+msub_s (float b, float c, float d)\n+{\n+  return __builtin_fmaf (b, c, -d);\n+}\n+\n+NOMIPS16 float\n+nmadd_s (float b, float c, float d)\n+{\n+  return -__builtin_fmaf (b, c, d);\n+}\n+\n+NOMIPS16 float\n+nmsub_s (float b, float c, float d)\n+{\n+  return -__builtin_fmaf (b, c, -d);\n+}\n+\n+NOMIPS16 float\n+nmadd_s_2 (float b, float c, float d)\n+{\n+  return __builtin_fmaf (-b, c, -d);\n+}\n+\n+NOMIPS16 float\n+not_nmsub_s_2 (float b, float c, float d)\n+{\n+  return __builtin_fmaf (-b, c, d);\n+}\n+\n+NOMIPS16 double\n+madd_d (double b, double c, double d)\n+{\n+  return __builtin_fma (b, c, d);\n+}\n+\n+NOMIPS16 double\n+msub_d (double b, double c, double d)\n+{\n+  return __builtin_fma (b, c, -d);\n+}\n+\n+NOMIPS16 double\n+nmadd_d (double b, double c, double d)\n+{\n+  return -__builtin_fma (b, c, d);\n+}\n+\n+NOMIPS16 double\n+nmsub_d (double b, double c, double d)\n+{\n+  return -__builtin_fma (b, c, -d);\n+}\n+\n+NOMIPS16 double\n+nmadd_d_2 (double b, double c, double d)\n+{\n+  return __builtin_fma (-b, c, -d);\n+}\n+\n+NOMIPS16 double\n+nmsub_d_2 (double b, double c, double d)\n+{\n+  return __builtin_fma (-b, c, d);\n+}"}, {"sha": "c038f191d9c0acb8697c474c83a215913b103c5d", "filename": "gcc/testsuite/gcc.target/mips/fma-19.c", "status": "added", "additions": 79, "deletions": 0, "changes": 79, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/c7c0f73d6801b4e839775ec2a09c1acf6378dbda/gcc%2Ftestsuite%2Fgcc.target%2Fmips%2Ffma-19.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/c7c0f73d6801b4e839775ec2a09c1acf6378dbda/gcc%2Ftestsuite%2Fgcc.target%2Fmips%2Ffma-19.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgcc.target%2Fmips%2Ffma-19.c?ref=c7c0f73d6801b4e839775ec2a09c1acf6378dbda", "patch": "@@ -0,0 +1,79 @@\n+/* { dg-options \"-mgp64 -mhard-float isa=loongson -O3 -fno-fast-math -ffp-contract=off\" } */\n+/* { dg-final { scan-assembler-not \"\\tmadd\\\\.\" } } */\n+/* { dg-final { scan-assembler-not \"\\tmsub\\\\.\" } } */\n+/* { dg-final { scan-assembler-not \"\\tnmadd\\\\.\" } } */\n+/* { dg-final { scan-assembler-not \"\\tnmsub\\\\.\" } } */\n+\n+/* No function should use fused operations, however high the -O level.  */\n+\n+NOMIPS16 float\n+not_madd_s (float b, float c, float d)\n+{\n+  return b * c + d;\n+}\n+\n+NOMIPS16 float\n+not_msub_s (float b, float c, float d)\n+{\n+  return b * c + -d;\n+}\n+\n+NOMIPS16 float\n+not_nmadd_s (float b, float c, float d)\n+{\n+  return -(b * c + d);\n+}\n+\n+NOMIPS16 float\n+not_nmsub_s (float b, float c, float d)\n+{\n+  return -(b * c + -d);\n+}\n+\n+NOMIPS16 float\n+not_nmadd_s_2 (float b, float c, float d)\n+{\n+  return -b * c - d;\n+}\n+\n+NOMIPS16 float\n+not_nmsub_s_2 (float b, float c, float d)\n+{\n+  return -b * c + d;\n+}\n+\n+NOMIPS16 double\n+not_madd_d (double b, double c, double d)\n+{\n+  return b * c + d;\n+}\n+\n+NOMIPS16 double\n+not_msub_d (double b, double c, double d)\n+{\n+  return b * c + -d;\n+}\n+\n+NOMIPS16 double\n+not_nmadd_d (double b, double c, double d)\n+{\n+  return -(b * c + d);\n+}\n+\n+NOMIPS16 double\n+not_nmsub_d (double b, double c, double d)\n+{\n+  return -(b * c + -d);\n+}\n+\n+NOMIPS16 double\n+not_nmadd_d_2 (double b, double c, double d)\n+{\n+  return -b * c - d;\n+}\n+\n+NOMIPS16 double\n+not_nmsub_d_2 (double b, double c, double d)\n+{\n+  return -b * c + d;\n+}"}, {"sha": "26c77421a089bfc7b32b4dfaa563c812d0f007de", "filename": "gcc/testsuite/gcc.target/mips/fma-2.c", "status": "added", "additions": 16, "deletions": 0, "changes": 16, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/c7c0f73d6801b4e839775ec2a09c1acf6378dbda/gcc%2Ftestsuite%2Fgcc.target%2Fmips%2Ffma-2.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/c7c0f73d6801b4e839775ec2a09c1acf6378dbda/gcc%2Ftestsuite%2Fgcc.target%2Fmips%2Ffma-2.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgcc.target%2Fmips%2Ffma-2.c?ref=c7c0f73d6801b4e839775ec2a09c1acf6378dbda", "patch": "@@ -0,0 +1,16 @@\n+/* { dg-options \"-mgp64 -mhard-float isa>=4 -O3 -fno-fast-math -ffp-contract=off -ffinite-math-only\" } */\n+/* { dg-final { scan-assembler-times \"\\tnmadd\\\\.s\\t\" 1 } } */\n+/* { dg-final { scan-assembler-times \"\\tnmadd\\\\.d\\t\" 1 } } */\n+/* { dg-final { scan-assembler-not \"\\tnmsub\\\\.\" } } */\n+\n+NOMIPS16 float\n+nmadd_s (float b, float c, float d)\n+{\n+  return -__builtin_fmaf (b, c, d);\n+}\n+\n+NOMIPS16 double\n+nmadd_d (double b, double c, double d)\n+{\n+  return -__builtin_fma (b, c, d);\n+}"}, {"sha": "ab0cbdfb7913290b6b7ba24eb9e754aa81b5ee99", "filename": "gcc/testsuite/gcc.target/mips/fma-20.c", "status": "added", "additions": 81, "deletions": 0, "changes": 81, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/c7c0f73d6801b4e839775ec2a09c1acf6378dbda/gcc%2Ftestsuite%2Fgcc.target%2Fmips%2Ffma-20.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/c7c0f73d6801b4e839775ec2a09c1acf6378dbda/gcc%2Ftestsuite%2Fgcc.target%2Fmips%2Ffma-20.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgcc.target%2Fmips%2Ffma-20.c?ref=c7c0f73d6801b4e839775ec2a09c1acf6378dbda", "patch": "@@ -0,0 +1,81 @@\n+/* { dg-options \"-mgp64 -mhard-float isa=loongson -O2 -ffast-math\" } */\n+/* { dg-final { scan-assembler-times \"\\tmadd\\\\.s\\t\" 1 } } */\n+/* { dg-final { scan-assembler-times \"\\tmsub\\\\.s\\t\" 1 } } */\n+/* { dg-final { scan-assembler-times \"\\tnmadd\\\\.s\\t\" 2 } } */\n+/* { dg-final { scan-assembler-times \"\\tnmsub\\\\.s\\t\" 2 } } */\n+/* { dg-final { scan-assembler-times \"\\tmadd\\\\.d\\t\" 1 } } */\n+/* { dg-final { scan-assembler-times \"\\tmsub\\\\.d\\t\" 1 } } */\n+/* { dg-final { scan-assembler-times \"\\tnmadd\\\\.d\\t\" 2 } } */\n+/* { dg-final { scan-assembler-times \"\\tnmsub\\\\.d\\t\" 2 } } */\n+\n+NOMIPS16 float\n+madd_s (float b, float c, float d)\n+{\n+  return b * c + d;\n+}\n+\n+NOMIPS16 float\n+msub_s (float b, float c, float d)\n+{\n+  return b * c + -d;\n+}\n+\n+NOMIPS16 float\n+nmadd_s (float b, float c, float d)\n+{\n+  return -(b * c + d);\n+}\n+\n+NOMIPS16 float\n+nmsub_s (float b, float c, float d)\n+{\n+  return -(b * c + -d);\n+}\n+\n+NOMIPS16 float\n+nmadd_s_2 (float b, float c, float d)\n+{\n+  return -b * c - d;\n+}\n+\n+NOMIPS16 float\n+nmsub_s_2 (float b, float c, float d)\n+{\n+  return -b * c + d;\n+}\n+\n+NOMIPS16 double\n+madd_d (double b, double c, double d)\n+{\n+  return b * c + d;\n+}\n+\n+NOMIPS16 double\n+msub_d (double b, double c, double d)\n+{\n+  return b * c + -d;\n+}\n+\n+NOMIPS16 double\n+nmadd_d (double b, double c, double d)\n+{\n+  return -(b * c + d);\n+}\n+\n+NOMIPS16 double\n+nmsub_d (double b, double c, double d)\n+{\n+  return -(b * c + -d);\n+}\n+\n+NOMIPS16 double\n+nmadd_d_2 (double b, double c, double d)\n+{\n+  return -b * c - d;\n+}\n+\n+NOMIPS16 double\n+nmsub_d_2 (double b, double c, double d)\n+{\n+  return -b * c + d;\n+}"}, {"sha": "1a387c23bb6237f625c87a97994ced6c9cb7e508", "filename": "gcc/testsuite/gcc.target/mips/fma-3.c", "status": "added", "additions": 16, "deletions": 0, "changes": 16, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/c7c0f73d6801b4e839775ec2a09c1acf6378dbda/gcc%2Ftestsuite%2Fgcc.target%2Fmips%2Ffma-3.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/c7c0f73d6801b4e839775ec2a09c1acf6378dbda/gcc%2Ftestsuite%2Fgcc.target%2Fmips%2Ffma-3.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgcc.target%2Fmips%2Ffma-3.c?ref=c7c0f73d6801b4e839775ec2a09c1acf6378dbda", "patch": "@@ -0,0 +1,16 @@\n+/* { dg-options \"-mgp64 -mhard-float isa>=4 -O3 -fno-fast-math -ffp-contract=off -ffinite-math-only\" } */\n+/* { dg-final { scan-assembler-times \"\\tnmsub\\\\.s\\t\" 1 } } */\n+/* { dg-final { scan-assembler-times \"\\tnmsub\\\\.d\\t\" 1 } } */\n+/* { dg-final { scan-assembler-not \"\\tnmadd\\\\.\" } } */\n+\n+NOMIPS16 float\n+nmsub_s (float b, float c, float d)\n+{\n+  return -__builtin_fmaf (b, c, -d);\n+}\n+\n+NOMIPS16 double\n+nmsub_d (double b, double c, double d)\n+{\n+  return -__builtin_fma (b, c, -d);\n+}"}, {"sha": "4ae7f5f4b67eeb4bfefb1e8e1efc37e70cf2d6c6", "filename": "gcc/testsuite/gcc.target/mips/fma-4.c", "status": "added", "additions": 17, "deletions": 0, "changes": 17, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/c7c0f73d6801b4e839775ec2a09c1acf6378dbda/gcc%2Ftestsuite%2Fgcc.target%2Fmips%2Ffma-4.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/c7c0f73d6801b4e839775ec2a09c1acf6378dbda/gcc%2Ftestsuite%2Fgcc.target%2Fmips%2Ffma-4.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgcc.target%2Fmips%2Ffma-4.c?ref=c7c0f73d6801b4e839775ec2a09c1acf6378dbda", "patch": "@@ -0,0 +1,17 @@\n+/* { dg-options \"-mgp64 -mhard-float isa>=4 -O3 -fno-fast-math -ffp-contract=off -ffinite-math-only\" } */\n+/* { dg-final { scan-assembler-not \"\\tnmadd\\\\.\" } } */\n+/* { dg-final { scan-assembler-not \"\\tnmsub\\\\.\" } } */\n+\n+/* These patterns can only use NMADD if -fno-signed-zeros is in effect.  */\n+\n+NOMIPS16 float\n+not_nmadd_s_2 (float b, float c, float d)\n+{\n+  return __builtin_fmaf (-b, c, -d);\n+}\n+\n+NOMIPS16 double\n+not_nmadd_d_2 (double b, double c, double d)\n+{\n+  return __builtin_fma (-b, c, -d);\n+}"}, {"sha": "410a904734ac3788b9f5b507b55294f8f76b0daf", "filename": "gcc/testsuite/gcc.target/mips/fma-5.c", "status": "added", "additions": 17, "deletions": 0, "changes": 17, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/c7c0f73d6801b4e839775ec2a09c1acf6378dbda/gcc%2Ftestsuite%2Fgcc.target%2Fmips%2Ffma-5.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/c7c0f73d6801b4e839775ec2a09c1acf6378dbda/gcc%2Ftestsuite%2Fgcc.target%2Fmips%2Ffma-5.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgcc.target%2Fmips%2Ffma-5.c?ref=c7c0f73d6801b4e839775ec2a09c1acf6378dbda", "patch": "@@ -0,0 +1,17 @@\n+/* { dg-options \"-mgp64 -mhard-float isa>=4 -O3 -fno-fast-math -ffp-contract=off -ffinite-math-only\" } */\n+/* { dg-final { scan-assembler-not \"\\tnmadd\\\\.\" } } */\n+/* { dg-final { scan-assembler-not \"\\tnmsub\\\\.\" } } */\n+\n+/* These patterns can only use NMSUB if -fno-signed-zeros is in effect.  */\n+\n+NOMIPS16 float\n+not_nmsub_s_2 (float b, float c, float d)\n+{\n+  return __builtin_fmaf (-b, c, d);\n+}\n+\n+NOMIPS16 double\n+not_nmsub_d_2 (double b, double c, double d)\n+{\n+  return __builtin_fma (-b, c, d);\n+}"}, {"sha": "359983721d64c8214101fe402bb3682e43d8ef60", "filename": "gcc/testsuite/gcc.target/mips/fma-6.c", "status": "added", "additions": 16, "deletions": 0, "changes": 16, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/c7c0f73d6801b4e839775ec2a09c1acf6378dbda/gcc%2Ftestsuite%2Fgcc.target%2Fmips%2Ffma-6.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/c7c0f73d6801b4e839775ec2a09c1acf6378dbda/gcc%2Ftestsuite%2Fgcc.target%2Fmips%2Ffma-6.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgcc.target%2Fmips%2Ffma-6.c?ref=c7c0f73d6801b4e839775ec2a09c1acf6378dbda", "patch": "@@ -0,0 +1,16 @@\n+/* { dg-options \"-mgp64 -mhard-float isa>=4 -O3 -ffast-math\" } */\n+/* { dg-final { scan-assembler-times \"\\tnmadd\\\\.s\\t\" 1 } } */\n+/* { dg-final { scan-assembler-times \"\\tnmadd\\\\.d\\t\" 1 } } */\n+/* { dg-final { scan-assembler-not \"\\tnmsub\\\\.\" } } */\n+\n+NOMIPS16 float\n+nmadd_s_2 (float b, float c, float d)\n+{\n+  return __builtin_fmaf (-b, c, -d);\n+}\n+\n+NOMIPS16 double\n+nmadd_d_2 (double b, double c, double d)\n+{\n+  return __builtin_fma (-b, c, -d);\n+}"}, {"sha": "11817e636272de29474037b0787a54190eaf98af", "filename": "gcc/testsuite/gcc.target/mips/fma-7.c", "status": "added", "additions": 16, "deletions": 0, "changes": 16, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/c7c0f73d6801b4e839775ec2a09c1acf6378dbda/gcc%2Ftestsuite%2Fgcc.target%2Fmips%2Ffma-7.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/c7c0f73d6801b4e839775ec2a09c1acf6378dbda/gcc%2Ftestsuite%2Fgcc.target%2Fmips%2Ffma-7.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgcc.target%2Fmips%2Ffma-7.c?ref=c7c0f73d6801b4e839775ec2a09c1acf6378dbda", "patch": "@@ -0,0 +1,16 @@\n+/* { dg-options \"-mgp64 -mhard-float isa>=4 -O3 -ffast-math\" } */\n+/* { dg-final { scan-assembler-times \"\\tnmsub\\\\.s\\t\" 1 } } */\n+/* { dg-final { scan-assembler-times \"\\tnmsub\\\\.d\\t\" 1 } } */\n+/* { dg-final { scan-assembler-not \"\\tnmadd\\\\.\" } } */\n+\n+NOMIPS16 float\n+nmsub_s_2 (float b, float c, float d)\n+{\n+  return __builtin_fmaf (-b, c, d);\n+}\n+\n+NOMIPS16 double\n+nmsub_d_2 (double b, double c, double d)\n+{\n+  return __builtin_fma (-b, c, d);\n+}"}, {"sha": "d54138d3df44df9c64095719a46bc871b1c9c458", "filename": "gcc/testsuite/gcc.target/mips/fma-8.c", "status": "added", "additions": 81, "deletions": 0, "changes": 81, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/c7c0f73d6801b4e839775ec2a09c1acf6378dbda/gcc%2Ftestsuite%2Fgcc.target%2Fmips%2Ffma-8.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/c7c0f73d6801b4e839775ec2a09c1acf6378dbda/gcc%2Ftestsuite%2Fgcc.target%2Fmips%2Ffma-8.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgcc.target%2Fmips%2Ffma-8.c?ref=c7c0f73d6801b4e839775ec2a09c1acf6378dbda", "patch": "@@ -0,0 +1,81 @@\n+/* { dg-options \"-mgp64 -mhard-float isa>=4 -O -ffast-math\" } */\n+/* { dg-final { scan-assembler-times \"\\tmadd\\\\.s\\t\" 1 } } */\n+/* { dg-final { scan-assembler-times \"\\tmsub\\\\.s\\t\" 1 } } */\n+/* { dg-final { scan-assembler-times \"\\tnmadd\\\\.s\\t\" 2 } } */\n+/* { dg-final { scan-assembler-times \"\\tnmsub\\\\.s\\t\" 2 } } */\n+/* { dg-final { scan-assembler-times \"\\tmadd\\\\.d\\t\" 1 } } */\n+/* { dg-final { scan-assembler-times \"\\tmsub\\\\.d\\t\" 1 } } */\n+/* { dg-final { scan-assembler-times \"\\tnmadd\\\\.d\\t\" 2 } } */\n+/* { dg-final { scan-assembler-times \"\\tnmsub\\\\.d\\t\" 2 } } */\n+\n+NOMIPS16 float\n+madd_s (float b, float c, float d)\n+{\n+  return __builtin_fmaf (b, c, d);\n+}\n+\n+NOMIPS16 float\n+msub_s (float b, float c, float d)\n+{\n+  return __builtin_fmaf (b, c, -d);\n+}\n+\n+NOMIPS16 float\n+nmadd_s (float b, float c, float d)\n+{\n+  return -__builtin_fmaf (b, c, d);\n+}\n+\n+NOMIPS16 float\n+nmsub_s (float b, float c, float d)\n+{\n+  return -__builtin_fmaf (b, c, -d);\n+}\n+\n+NOMIPS16 float\n+nmadd_s_2 (float b, float c, float d)\n+{\n+  return __builtin_fmaf (-b, c, -d);\n+}\n+\n+NOMIPS16 float\n+nmsub_s_2 (float b, float c, float d)\n+{\n+  return __builtin_fmaf (-b, c, d);\n+}\n+\n+NOMIPS16 double\n+madd_d (double b, double c, double d)\n+{\n+  return __builtin_fma (b, c, d);\n+}\n+\n+NOMIPS16 double\n+msub_d (double b, double c, double d)\n+{\n+  return __builtin_fma (b, c, -d);\n+}\n+\n+NOMIPS16 double\n+nmadd_d (double b, double c, double d)\n+{\n+  return -__builtin_fma (b, c, d);\n+}\n+\n+NOMIPS16 double\n+nmsub_d (double b, double c, double d)\n+{\n+  return -__builtin_fma (b, c, -d);\n+}\n+\n+NOMIPS16 double\n+nmadd_d_2 (double b, double c, double d)\n+{\n+  return __builtin_fma (-b, c, -d);\n+}\n+\n+NOMIPS16 double\n+nmsub_d_2 (double b, double c, double d)\n+{\n+  return __builtin_fma (-b, c, d);\n+}"}, {"sha": "a0fc1b084c3b922e157096be1a1885192efd6d1e", "filename": "gcc/testsuite/gcc.target/mips/fma-9.c", "status": "added", "additions": 70, "deletions": 0, "changes": 70, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/c7c0f73d6801b4e839775ec2a09c1acf6378dbda/gcc%2Ftestsuite%2Fgcc.target%2Fmips%2Ffma-9.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/c7c0f73d6801b4e839775ec2a09c1acf6378dbda/gcc%2Ftestsuite%2Fgcc.target%2Fmips%2Ffma-9.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgcc.target%2Fmips%2Ffma-9.c?ref=c7c0f73d6801b4e839775ec2a09c1acf6378dbda", "patch": "@@ -0,0 +1,70 @@\n+/* { dg-options \"-mpaired-single -O3 -fno-fast-math -ftree-vectorize -ffp-contract=off\" } */\n+/* { dg-final { scan-assembler \"\\tmadd\\\\.ps\\t\" } } */\n+/* { dg-final { scan-assembler \"\\tmsub\\\\.s\\t\" } } */\n+/* { dg-final { scan-assembler-not \"\\tmsub\\\\.ps\\t\" } } */\n+/* { dg-final { scan-assembler-not \"\\tnmadd\\\\.\" } } */\n+/* { dg-final { scan-assembler-not \"\\tnmsub\\\\.\" } } */\n+\n+/* We should not use NMADD or NMSUB without -ffinite-math-only because\n+   those instructions may perform arithmetic negation.  We don't really\n+   expect the nmadd_ps and nmsub_ps functions to use MADD.PS and MSUB.PS,\n+   but there's no reason in principle why they shouldn't.\n+\n+   ??? At the moment, we don't vectorize msub_ps, but we probably should.  */\n+\n+#define N 512\n+float a[N], b[N], c[N], d[N];\n+\n+NOMIPS16 void\n+madd_ps (void)\n+{\n+  int i;\n+\n+  for (i = 0; i < N; i++)\n+    a[i] = __builtin_fmaf (b[i], c[i], d[i]);\n+}\n+\n+NOMIPS16 float\n+msub_ps (void)\n+{\n+  int i;\n+\n+  for (i = 0; i < N; i++)\n+    a[i] = __builtin_fmaf (b[i], c[i], -d[i]);\n+}\n+\n+NOMIPS16 float\n+not_nmadd_ps (void)\n+{\n+  int i;\n+\n+  for (i = 0; i < N; i++)\n+    a[i] = -__builtin_fmaf (b[i], c[i], d[i]);\n+}\n+\n+NOMIPS16 float\n+not_nmsub_ps (void)\n+{\n+  int i;\n+\n+  for (i = 0; i < N; i++)\n+    a[i] = -__builtin_fmaf (b[i], c[i], -d[i]);\n+}\n+\n+NOMIPS16 float\n+not_nmadd_ps_2 (void)\n+{\n+  int i;\n+\n+  for (i = 0; i < N; i++)\n+    a[i] = __builtin_fmaf (-b[i], c[i], -d[i]);\n+}\n+\n+NOMIPS16 float\n+not_nmsub_ps_2 (void)\n+{\n+  int i;\n+\n+  for (i = 0; i < N; i++)\n+    a[i] = __builtin_fmaf (-b[i], c[i], d[i]);\n+}"}, {"sha": "1165b17cdf9ad87e7d03ce91b1ecdc91afe32fea", "filename": "gcc/testsuite/gcc.target/mips/mips.exp", "status": "modified", "additions": 7, "deletions": 0, "changes": 7, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/c7c0f73d6801b4e839775ec2a09c1acf6378dbda/gcc%2Ftestsuite%2Fgcc.target%2Fmips%2Fmips.exp", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/c7c0f73d6801b4e839775ec2a09c1acf6378dbda/gcc%2Ftestsuite%2Fgcc.target%2Fmips%2Fmips.exp", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgcc.target%2Fmips%2Fmips.exp?ref=c7c0f73d6801b4e839775ec2a09c1acf6378dbda", "patch": "@@ -292,6 +292,13 @@ foreach option {\n     lappend mips_option_groups $option \"-f(no-|)$option\"\n }\n \n+# Add -ffoo= options to mips_option_groups.\n+foreach option {\n+    fp-contract\n+} {\n+    lappend mips_option_groups $option \"-f$option=.*\"\n+}\n+\n # A list of option groups that have an impact on the ABI.\n set mips_abi_groups {\n     abi"}]}