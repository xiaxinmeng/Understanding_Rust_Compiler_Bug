{"sha": "376cf6d19cdcb791a4257bc1cafabfae89227683", "node_id": "C_kwDOANBUbNoAKDM3NmNmNmQxOWNkY2I3OTFhNDI1N2JjMWNhZmFiZmFlODkyMjc2ODM", "commit": {"author": {"name": "Jakub Jelinek", "email": "jakub@redhat.com", "date": "2022-04-04T10:09:26Z"}, "committer": {"name": "Jakub Jelinek", "email": "jakub@redhat.com", "date": "2022-04-04T10:09:26Z"}, "message": "aarch64: Fix aarch64-tune.md (re)generation [PR105144]\n\nAs I wrote in the PR, our Fedora trunk gcc builds likely after r12-7842\nchange are now failing (lto1 crashes).\nWhat happens is that when one bootstraps into an empty build directory\n(or set of them), mddeps.mk doesn't exist yet and so Makefile doesn't\ninclude it.  When building from an empty dir, that is usually not a big\nissue, it is enough when various build directory files depend on just\n$(srcdir)/config/aarch64/aarch64.md, those files don't exist and\naarch64.md does, so they are built, so is mddeps.mk.\nBut because the other dependencies aren't there (in particular\n$(srcdir)/config/aarch64/aarch64-tune.md ), the\ns-aarch64-tune-md rule isn't invoked to regenerate that file and the\nr12-7842 commit reordered aarch64-cores.def entries but didn't commit\nregenerated aarch64-tune.md.  Because it is just reordering in\naarch64-tune.md, it actually doesn't matter and bootstraps succeeds.\nBut then during make install, mddeps.mk exists already in gcc/ directory,\nit sees that aarch64-cores.def is newer than aarch64-tune.md (unless\ngen_update is used, that just touches aarch64-tune.md to make sure it\nis newer) and regenerates it and as it is different, make install rebuilds\na large subset of the *.o files, but this time with the system g++\nrather than previous stage one.  And during lto linking of it there\nare differences in LTO bytecode between the compilers and we crash.\n\nThe following patch fixes that by regenerating aarch64-tune.md\n(what was forgotten in r12-7842) and by adding a dependency from\ns-mddeps to s-aarch64-tune-md, which makes sure that even when mddeps.mk\ndoesn't exist yet make sees the dependency and regenerates aarch64-tune.md\nif needed.\n\n2022-04-04  Jakub Jelinek  <jakub@redhat.com>\n\n\tPR target/105144\n\t* config/aarch64/t-aarch64 (s-mddeps): Depend on s-aarch64-tune-md.\n\t* config/aarch64/aarch64-tune.md: Regenerated.", "tree": {"sha": "ba6765cc6521f7b3e8b7a07a577ea5aa27353794", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/ba6765cc6521f7b3e8b7a07a577ea5aa27353794"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/376cf6d19cdcb791a4257bc1cafabfae89227683", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/376cf6d19cdcb791a4257bc1cafabfae89227683", "html_url": "https://github.com/Rust-GCC/gccrs/commit/376cf6d19cdcb791a4257bc1cafabfae89227683", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/376cf6d19cdcb791a4257bc1cafabfae89227683/comments", "author": {"login": "jakubjelinek", "id": 9370665, "node_id": "MDQ6VXNlcjkzNzA2NjU=", "avatar_url": "https://avatars.githubusercontent.com/u/9370665?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jakubjelinek", "html_url": "https://github.com/jakubjelinek", "followers_url": "https://api.github.com/users/jakubjelinek/followers", "following_url": "https://api.github.com/users/jakubjelinek/following{/other_user}", "gists_url": "https://api.github.com/users/jakubjelinek/gists{/gist_id}", "starred_url": "https://api.github.com/users/jakubjelinek/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jakubjelinek/subscriptions", "organizations_url": "https://api.github.com/users/jakubjelinek/orgs", "repos_url": "https://api.github.com/users/jakubjelinek/repos", "events_url": "https://api.github.com/users/jakubjelinek/events{/privacy}", "received_events_url": "https://api.github.com/users/jakubjelinek/received_events", "type": "User", "site_admin": false}, "committer": {"login": "jakubjelinek", "id": 9370665, "node_id": "MDQ6VXNlcjkzNzA2NjU=", "avatar_url": "https://avatars.githubusercontent.com/u/9370665?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jakubjelinek", "html_url": "https://github.com/jakubjelinek", "followers_url": "https://api.github.com/users/jakubjelinek/followers", "following_url": "https://api.github.com/users/jakubjelinek/following{/other_user}", "gists_url": "https://api.github.com/users/jakubjelinek/gists{/gist_id}", "starred_url": "https://api.github.com/users/jakubjelinek/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jakubjelinek/subscriptions", "organizations_url": "https://api.github.com/users/jakubjelinek/orgs", "repos_url": "https://api.github.com/users/jakubjelinek/repos", "events_url": "https://api.github.com/users/jakubjelinek/events{/privacy}", "received_events_url": "https://api.github.com/users/jakubjelinek/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "3eda57b4ae50b5fe57c174556f1daf3bd9a46b09", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/3eda57b4ae50b5fe57c174556f1daf3bd9a46b09", "html_url": "https://github.com/Rust-GCC/gccrs/commit/3eda57b4ae50b5fe57c174556f1daf3bd9a46b09"}], "stats": {"total": 4, "additions": 3, "deletions": 1}, "files": [{"sha": "27da961475adeedd352b57a1a8fcf5eed45081a5", "filename": "gcc/config/aarch64/aarch64-tune.md", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/376cf6d19cdcb791a4257bc1cafabfae89227683/gcc%2Fconfig%2Faarch64%2Faarch64-tune.md", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/376cf6d19cdcb791a4257bc1cafabfae89227683/gcc%2Fconfig%2Faarch64%2Faarch64-tune.md", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fconfig%2Faarch64%2Faarch64-tune.md?ref=376cf6d19cdcb791a4257bc1cafabfae89227683", "patch": "@@ -1,5 +1,5 @@\n ;; -*- buffer-read-only: t -*-\n ;; Generated automatically by gentune.sh from aarch64-cores.def\n (define_attr \"tune\"\n-\t\"cortexa34,cortexa35,cortexa53,cortexa57,cortexa72,cortexa73,thunderx,thunderxt88p1,thunderxt88,octeontx,octeontxt81,octeontxt83,thunderxt81,thunderxt83,ampere1,emag,xgene1,falkor,qdf24xx,exynosm1,phecda,thunderx2t99p1,vulcan,thunderx2t99,cortexa55,cortexa75,cortexa76,cortexa76ae,cortexa77,cortexa78,cortexa78ae,cortexa78c,cortexa65,cortexa65ae,cortexx1,ares,neoversen1,neoversee1,octeontx2,octeontx2t98,octeontx2t96,octeontx2t93,octeontx2f95,octeontx2f95n,octeontx2f95mm,a64fx,tsv110,thunderx3t110,zeus,neoversev1,neoverse512tvb,saphira,neoversen2,cortexa57cortexa53,cortexa72cortexa53,cortexa73cortexa35,cortexa73cortexa53,cortexa75cortexa55,cortexa76cortexa55,cortexr82,cortexa510,cortexa710,cortexx2,demeter\"\n+\t\"cortexa34,cortexa35,cortexa53,cortexa57,cortexa72,cortexa73,thunderx,thunderxt88p1,thunderxt88,octeontx,octeontxt81,octeontxt83,thunderxt81,thunderxt83,ampere1,emag,xgene1,falkor,qdf24xx,exynosm1,phecda,thunderx2t99p1,vulcan,thunderx2t99,cortexa55,cortexa75,cortexa76,cortexa76ae,cortexa77,cortexa78,cortexa78ae,cortexa78c,cortexa65,cortexa65ae,cortexx1,ares,neoversen1,neoversee1,octeontx2,octeontx2t98,octeontx2t96,octeontx2t93,octeontx2f95,octeontx2f95n,octeontx2f95mm,a64fx,tsv110,thunderx3t110,zeus,neoversev1,neoverse512tvb,saphira,cortexa57cortexa53,cortexa72cortexa53,cortexa73cortexa35,cortexa73cortexa53,cortexa75cortexa55,cortexa76cortexa55,cortexr82,cortexa510,cortexa710,cortexx2,neoversen2,demeter\"\n \t(const (symbol_ref \"((enum attr_tune) aarch64_tune)\")))"}, {"sha": "a421d26f31a4ce4b4a3c4bf5d0a8d79a7e5602b6", "filename": "gcc/config/aarch64/t-aarch64", "status": "modified", "additions": 2, "deletions": 0, "changes": 2, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/376cf6d19cdcb791a4257bc1cafabfae89227683/gcc%2Fconfig%2Faarch64%2Ft-aarch64", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/376cf6d19cdcb791a4257bc1cafabfae89227683/gcc%2Fconfig%2Faarch64%2Ft-aarch64", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fconfig%2Faarch64%2Ft-aarch64?ref=376cf6d19cdcb791a4257bc1cafabfae89227683", "patch": "@@ -34,6 +34,8 @@ s-aarch64-tune-md: $(srcdir)/config/aarch64/gentune.sh \\\n \t\t$(srcdir)/config/aarch64/aarch64-tune.md\n \t$(STAMP) s-aarch64-tune-md\n \n+s-mddeps: s-aarch64-tune-md\n+\n aarch64-builtins.o: $(srcdir)/config/aarch64/aarch64-builtins.cc $(CONFIG_H) \\\n   $(SYSTEM_H) coretypes.h $(TM_H) \\\n   $(RTL_H) $(TREE_H) expr.h $(TM_P_H) $(RECOG_H) langhooks.h \\"}]}