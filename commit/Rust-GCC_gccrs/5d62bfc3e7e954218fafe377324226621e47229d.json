{"sha": "5d62bfc3e7e954218fafe377324226621e47229d", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6NWQ2MmJmYzNlN2U5NTQyMThmYWZlMzc3MzI0MjI2NjIxZTQ3MjI5ZA==", "commit": {"author": {"name": "Thomas Schwinge", "email": "tschwinge@gcc.gnu.org", "date": "2018-12-09T12:49:20Z"}, "committer": {"name": "Thomas Schwinge", "email": "tschwinge@gcc.gnu.org", "date": "2018-12-09T12:49:20Z"}, "message": "Correct the reported line number in Fortran combined OpenACC directives\n\n\tgcc/fortran/\n\t* trans-openmp.c (gfc_trans_oacc_combined_directive): Set the\n\tlocation of combined acc loops.\n\tgcc/testsuite/\n\t* gfortran.dg/goacc/combined-directives-3.f90: New file.\n\nReviewed-by: Thomas Schwinge <thomas@codesourcery.com>\n\nFrom-SVN: r266924", "tree": {"sha": "e132847c23232f6e6a11e60ce2063e3add0a3306", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/e132847c23232f6e6a11e60ce2063e3add0a3306"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/5d62bfc3e7e954218fafe377324226621e47229d", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/5d62bfc3e7e954218fafe377324226621e47229d", "html_url": "https://github.com/Rust-GCC/gccrs/commit/5d62bfc3e7e954218fafe377324226621e47229d", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/5d62bfc3e7e954218fafe377324226621e47229d/comments", "author": null, "committer": null, "parents": [{"sha": "65b5f496995864ec8d789f232ea25329fbf0bf62", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/65b5f496995864ec8d789f232ea25329fbf0bf62", "html_url": "https://github.com/Rust-GCC/gccrs/commit/65b5f496995864ec8d789f232ea25329fbf0bf62"}], "stats": {"total": 41, "additions": 39, "deletions": 2}, "files": [{"sha": "e74bda7a1362dce345ad92a467f0e4d2eeecb834", "filename": "gcc/fortran/ChangeLog", "status": "modified", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/5d62bfc3e7e954218fafe377324226621e47229d/gcc%2Ffortran%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/5d62bfc3e7e954218fafe377324226621e47229d/gcc%2Ffortran%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ffortran%2FChangeLog?ref=5d62bfc3e7e954218fafe377324226621e47229d", "patch": "@@ -1,3 +1,8 @@\n+2018-12-09  Cesar Philippidis  <cesar@codesourcery.com>\n+\n+\t* trans-openmp.c (gfc_trans_oacc_combined_directive): Set the\n+\tlocation of combined acc loops.\n+\n 2018-12-09  Thomas Schwinge  <thomas@codesourcery.com>\n \n \t* openmp.c (resolve_oacc_loop_blocks): Remove checking of OpenACC"}, {"sha": "bf3f46939e39b495c6c8f439075737332c3a1ca1", "filename": "gcc/fortran/trans-openmp.c", "status": "modified", "additions": 3, "deletions": 2, "changes": 5, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/5d62bfc3e7e954218fafe377324226621e47229d/gcc%2Ffortran%2Ftrans-openmp.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/5d62bfc3e7e954218fafe377324226621e47229d/gcc%2Ffortran%2Ftrans-openmp.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ffortran%2Ftrans-openmp.c?ref=5d62bfc3e7e954218fafe377324226621e47229d", "patch": "@@ -3878,6 +3878,7 @@ gfc_trans_oacc_combined_directive (gfc_code *code)\n   gfc_omp_clauses construct_clauses, loop_clauses;\n   tree stmt, oacc_clauses = NULL_TREE;\n   enum tree_code construct_code;\n+  location_t loc = input_location;\n \n   switch (code->op)\n     {\n@@ -3939,12 +3940,12 @@ gfc_trans_oacc_combined_directive (gfc_code *code)\n   else\n     pushlevel ();\n   stmt = gfc_trans_omp_do (code, EXEC_OACC_LOOP, pblock, &loop_clauses, NULL);\n+  protected_set_expr_location (stmt, loc);\n   if (TREE_CODE (stmt) != BIND_EXPR)\n     stmt = build3_v (BIND_EXPR, NULL, stmt, poplevel (1, 0));\n   else\n     poplevel (0, 0);\n-  stmt = build2_loc (input_location, construct_code, void_type_node, stmt,\n-\t\t     oacc_clauses);\n+  stmt = build2_loc (loc, construct_code, void_type_node, stmt, oacc_clauses);\n   gfc_add_expr_to_block (&block, stmt);\n   return gfc_finish_block (&block);\n }"}, {"sha": "19bc532c9d5711e9db03f320e9c28b9e42ae1ebf", "filename": "gcc/testsuite/ChangeLog", "status": "modified", "additions": 4, "deletions": 0, "changes": 4, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/5d62bfc3e7e954218fafe377324226621e47229d/gcc%2Ftestsuite%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/5d62bfc3e7e954218fafe377324226621e47229d/gcc%2Ftestsuite%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2FChangeLog?ref=5d62bfc3e7e954218fafe377324226621e47229d", "patch": "@@ -1,3 +1,7 @@\n+2018-12-09  Thomas Schwinge  <thomas@codesourcery.com>\n+\n+\t* gfortran.dg/goacc/combined-directives-3.f90: New file.\n+\n 2018-12-09  Cesar Philippidis  <cesar@codesourcery.com>\n \n \t* c-c++-common/goacc/combined-directives-3.c: New test."}, {"sha": "c6e31c26a8f13733debc4aaa9d5cd3dc28d03d5a", "filename": "gcc/testsuite/c-c++-common/goacc/combined-directives-3.c", "status": "modified", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/5d62bfc3e7e954218fafe377324226621e47229d/gcc%2Ftestsuite%2Fc-c%2B%2B-common%2Fgoacc%2Fcombined-directives-3.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/5d62bfc3e7e954218fafe377324226621e47229d/gcc%2Ftestsuite%2Fc-c%2B%2B-common%2Fgoacc%2Fcombined-directives-3.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fc-c%2B%2B-common%2Fgoacc%2Fcombined-directives-3.c?ref=5d62bfc3e7e954218fafe377324226621e47229d", "patch": "@@ -1,5 +1,6 @@\n /* Verify the accuracy of the line number associated with combined\n    constructs.  */\n+/* See also \"../../gfortran.dg/goacc/combined-directives-3.f90\".  */\n \n int\n main ()"}, {"sha": "b138822827f6c9b55108b543656732fd14154eb7", "filename": "gcc/testsuite/gfortran.dg/goacc/combined-directives-3.f90", "status": "added", "additions": 26, "deletions": 0, "changes": 26, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/5d62bfc3e7e954218fafe377324226621e47229d/gcc%2Ftestsuite%2Fgfortran.dg%2Fgoacc%2Fcombined-directives-3.f90", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/5d62bfc3e7e954218fafe377324226621e47229d/gcc%2Ftestsuite%2Fgfortran.dg%2Fgoacc%2Fcombined-directives-3.f90", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgfortran.dg%2Fgoacc%2Fcombined-directives-3.f90?ref=5d62bfc3e7e954218fafe377324226621e47229d", "patch": "@@ -0,0 +1,26 @@\n+! Verify the accuracy of the line number associated with combined constructs.\n+! See \"../../c-c++-common/goacc/combined-directives-3.c\".\n+\n+subroutine test\n+  implicit none\n+  integer x, y, z\n+\n+  !$acc parallel loop seq auto ! { dg-error \"'seq' overrides other OpenACC loop specifiers\" }\n+  do x = 0, 10\n+     !$acc loop\n+     do y = 0, 10\n+     end do\n+  end do\n+  !$acc end parallel loop\n+\n+  !$acc parallel loop gang auto ! { dg-error \"'auto' conflicts with other OpenACC loop specifiers\" }\n+  do x = 0, 10\n+     !$acc loop worker auto ! { dg-error \"'auto' conflicts with other OpenACC loop specifiers\" }\n+     do y = 0, 10\n+        !$acc loop vector\n+        do z = 0, 10\n+        end do\n+     end do\n+  end do\n+  !$acc end parallel loop\n+end subroutine test"}]}