{"sha": "165b2f5f5d7fe14ab567e83a4cf2e0a492038a8c", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6MTY1YjJmNWY1ZDdmZTE0YWI1NjdlODNhNGNmMmUwYTQ5MjAzOGE4Yw==", "commit": {"author": {"name": "Richard Biener", "email": "rguenther@suse.de", "date": "2017-08-04T10:33:39Z"}, "committer": {"name": "Richard Biener", "email": "rguenth@gcc.gnu.org", "date": "2017-08-04T10:33:39Z"}, "message": "re PR middle-end/81705 (UBSAN: yet another false positive)\n\n2017-08-04  Richard Biener  <rguenther@suse.de>\n\n\tPR middle-end/81705\n\t* fold-const.c (fold_binary_loc): Properly restrict\n\tminus_var0 && minus_var1 case when associating undefined overflow\n\tentities.\n\n\t* c-c++-common/ubsan/pr81705.c: New testcase.\n\nFrom-SVN: r250866", "tree": {"sha": "a6eeeef546385086a7ce0dc6f4b34426958c7fff", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/a6eeeef546385086a7ce0dc6f4b34426958c7fff"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/165b2f5f5d7fe14ab567e83a4cf2e0a492038a8c", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/165b2f5f5d7fe14ab567e83a4cf2e0a492038a8c", "html_url": "https://github.com/Rust-GCC/gccrs/commit/165b2f5f5d7fe14ab567e83a4cf2e0a492038a8c", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/165b2f5f5d7fe14ab567e83a4cf2e0a492038a8c/comments", "author": {"login": "rguenth", "id": 2046526, "node_id": "MDQ6VXNlcjIwNDY1MjY=", "avatar_url": "https://avatars.githubusercontent.com/u/2046526?v=4", "gravatar_id": "", "url": "https://api.github.com/users/rguenth", "html_url": "https://github.com/rguenth", "followers_url": "https://api.github.com/users/rguenth/followers", "following_url": "https://api.github.com/users/rguenth/following{/other_user}", "gists_url": "https://api.github.com/users/rguenth/gists{/gist_id}", "starred_url": "https://api.github.com/users/rguenth/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/rguenth/subscriptions", "organizations_url": "https://api.github.com/users/rguenth/orgs", "repos_url": "https://api.github.com/users/rguenth/repos", "events_url": "https://api.github.com/users/rguenth/events{/privacy}", "received_events_url": "https://api.github.com/users/rguenth/received_events", "type": "User", "site_admin": false}, "committer": null, "parents": [{"sha": "54cb4e20069f00f96ad2b6249cb68295a61a1786", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/54cb4e20069f00f96ad2b6249cb68295a61a1786", "html_url": "https://github.com/Rust-GCC/gccrs/commit/54cb4e20069f00f96ad2b6249cb68295a61a1786"}], "stats": {"total": 33, "additions": 29, "deletions": 4}, "files": [{"sha": "d9c0b0a357969b8c4a8b6b729ad7a7a05222ed16", "filename": "gcc/ChangeLog", "status": "modified", "additions": 7, "deletions": 0, "changes": 7, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/165b2f5f5d7fe14ab567e83a4cf2e0a492038a8c/gcc%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/165b2f5f5d7fe14ab567e83a4cf2e0a492038a8c/gcc%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2FChangeLog?ref=165b2f5f5d7fe14ab567e83a4cf2e0a492038a8c", "patch": "@@ -1,3 +1,10 @@\n+2017-08-04  Richard Biener  <rguenther@suse.de>\n+\n+\tPR middle-end/81705\n+\t* fold-const.c (fold_binary_loc): Properly restrict\n+\tminus_var0 && minus_var1 case when associating undefined overflow\n+\tentities.\n+\n 2017-08-04  Tom de Vries  <tom@codesourcery.com>\n \n \t* omp-simd-clone.c (simd_clone_adjust): Add missing edge probability."}, {"sha": "53428b89454e766ab6f536f120b3424e596c0cb8", "filename": "gcc/fold-const.c", "status": "modified", "additions": 5, "deletions": 4, "changes": 9, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/165b2f5f5d7fe14ab567e83a4cf2e0a492038a8c/gcc%2Ffold-const.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/165b2f5f5d7fe14ab567e83a4cf2e0a492038a8c/gcc%2Ffold-const.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ffold-const.c?ref=165b2f5f5d7fe14ab567e83a4cf2e0a492038a8c", "patch": "@@ -9592,12 +9592,13 @@ fold_binary_loc (location_t loc,\n \t  if (POINTER_TYPE_P (atype)\n \t      || (INTEGRAL_TYPE_P (atype) && !TYPE_OVERFLOW_WRAPS (atype)))\n \t    {\n-\t      if (var0 && var1)\n+\t      if ((var0 && var1) || (minus_var0 && minus_var1))\n \t\t{\n \t\t  /* ???  If split_tree would handle NEGATE_EXPR we could\n-\t\t     simplify this down to the var0/minus_var1 cases.  */\n-\t\t  tree tmp0 = var0;\n-\t\t  tree tmp1 = var1;\n+\t\t     simply reject these cases and the allowed cases would\n+\t\t     be the var0/minus_var1 ones.  */\n+\t\t  tree tmp0 = var0 ? var0 : minus_var0;\n+\t\t  tree tmp1 = var1 ? var1 : minus_var1;\n \t\t  bool one_neg = false;\n \n \t\t  if (TREE_CODE (tmp0) == NEGATE_EXPR)"}, {"sha": "f5ec59d754bfe740112dfa3f9d9f66418ee3628f", "filename": "gcc/testsuite/ChangeLog", "status": "modified", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/165b2f5f5d7fe14ab567e83a4cf2e0a492038a8c/gcc%2Ftestsuite%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/165b2f5f5d7fe14ab567e83a4cf2e0a492038a8c/gcc%2Ftestsuite%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2FChangeLog?ref=165b2f5f5d7fe14ab567e83a4cf2e0a492038a8c", "patch": "@@ -1,3 +1,8 @@\n+2017-08-04  Richard Biener  <rguenther@suse.de>\n+\n+\tPR middle-end/81705\n+\t* c-c++-common/ubsan/pr81705.c: New testcase.\n+\n 2017-08-03  Bill Schmidt  <wschmidt@linux.vnet.ibm.com>\n \n \t* gcc.target/powerpc/bfp/scalar-cmp-exp-eq-2.c: Adjust for error"}, {"sha": "081c741c206603592740a081ec95a0570736855d", "filename": "gcc/testsuite/c-c++-common/ubsan/pr81705.c", "status": "added", "additions": 12, "deletions": 0, "changes": 12, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/165b2f5f5d7fe14ab567e83a4cf2e0a492038a8c/gcc%2Ftestsuite%2Fc-c%2B%2B-common%2Fubsan%2Fpr81705.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/165b2f5f5d7fe14ab567e83a4cf2e0a492038a8c/gcc%2Ftestsuite%2Fc-c%2B%2B-common%2Fubsan%2Fpr81705.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fc-c%2B%2B-common%2Fubsan%2Fpr81705.c?ref=165b2f5f5d7fe14ab567e83a4cf2e0a492038a8c", "patch": "@@ -0,0 +1,12 @@\n+/* { dg-do run } */\n+/* { dg-options \"-fsanitize=undefined -fsanitize-undefined-trap-on-error\" } */\n+\n+int var_4 = -1716607962;\n+int var_14 = 943738830;\n+volatile int a;\n+int main()\n+{\n+  //  (-(-1716607962) - 516151698) - -(9403738830)\n+  a = (-var_4 - 516151698) - -var_14;\n+  return 0;\n+}"}]}