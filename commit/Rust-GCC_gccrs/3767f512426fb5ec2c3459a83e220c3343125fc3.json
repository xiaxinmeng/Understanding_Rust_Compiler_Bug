{"sha": "3767f512426fb5ec2c3459a83e220c3343125fc3", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6Mzc2N2Y1MTI0MjZmYjVlYzJjMzQ1OWE4M2UyMjBjMzM0MzEyNWZjMw==", "commit": {"author": {"name": "Janis Johnson", "email": "janis187@us.ibm.com", "date": "2010-01-11T20:29:40Z"}, "committer": {"name": "Janis Johnson", "email": "janis@gcc.gnu.org", "date": "2010-01-11T20:29:40Z"}, "message": "re PR target/42416 (ICE in rs6000_bulitin_vec_perm for 177.mesa with -mvsx)\n\n\tPR target/42416\n\t* config/rs6000/rs6000.c (rs6000_override_options): On targets\n\tthat support VSX, warn for -mno-altivec if vsx is not disabled,\n\tand disable vsx.\n\t* gcc.target/powerpc/warn-1.c: New test.\n\t* gcc.target/powerpc/warn-2.c: New test.\n\nFrom-SVN: r155816", "tree": {"sha": "921eb5ca87c29b685960fc063304f50defe91b99", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/921eb5ca87c29b685960fc063304f50defe91b99"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/3767f512426fb5ec2c3459a83e220c3343125fc3", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/3767f512426fb5ec2c3459a83e220c3343125fc3", "html_url": "https://github.com/Rust-GCC/gccrs/commit/3767f512426fb5ec2c3459a83e220c3343125fc3", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/3767f512426fb5ec2c3459a83e220c3343125fc3/comments", "author": null, "committer": null, "parents": [{"sha": "a6ffbb9c263facd86def845b330c33538d7663fa", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/a6ffbb9c263facd86def845b330c33538d7663fa", "html_url": "https://github.com/Rust-GCC/gccrs/commit/a6ffbb9c263facd86def845b330c33538d7663fa"}], "stats": {"total": 62, "additions": 58, "deletions": 4}, "files": [{"sha": "3c59ab1f86b5ff9ae4a96be08db3eeb0b33eb036", "filename": "gcc/ChangeLog", "status": "modified", "additions": 7, "deletions": 0, "changes": 7, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/3767f512426fb5ec2c3459a83e220c3343125fc3/gcc%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/3767f512426fb5ec2c3459a83e220c3343125fc3/gcc%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2FChangeLog?ref=3767f512426fb5ec2c3459a83e220c3343125fc3", "patch": "@@ -1,3 +1,10 @@\n+2010-01-11  Janis Johnson  <janis187@us.ibm.com>\n+\n+\tPR target/42416\n+\t* config/rs6000/rs6000.c (rs6000_override_options): On targets\n+\tthat support VSX, warn for -mno-altivec if vsx is not disabled,\n+\tand disable vsx.\n+\n 2010-01-11  Joseph Myers  <joseph@codesourcery.com>\n \t    Shujing Zhao  <pearly.zhao@oracle.com>\n \t"}, {"sha": "906392eebf0aaa155788ba8e4dcb21fa9d097aba", "filename": "gcc/config/rs6000/rs6000.c", "status": "modified", "additions": 9, "deletions": 4, "changes": 13, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/3767f512426fb5ec2c3459a83e220c3343125fc3/gcc%2Fconfig%2Frs6000%2Frs6000.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/3767f512426fb5ec2c3459a83e220c3343125fc3/gcc%2Fconfig%2Frs6000%2Frs6000.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fconfig%2Frs6000%2Frs6000.c?ref=3767f512426fb5ec2c3459a83e220c3343125fc3", "patch": "@@ -2407,8 +2407,7 @@ rs6000_override_options (const char *default_cpu)\n \t}\n     }\n \n-  /* Add some warnings for VSX.  Enable -maltivec unless the user explicitly\n-     used -mno-altivec  */\n+  /* Add some warnings for VSX.  */\n   if (TARGET_VSX)\n     {\n       const char *msg = NULL;\n@@ -2429,14 +2428,20 @@ rs6000_override_options (const char *default_cpu)\n \tmsg = N_(\"-mvsx used with little endian code\");\n       else if (TARGET_AVOID_XFORM > 0)\n \tmsg = N_(\"-mvsx needs indexed addressing\");\n+      else if (!TARGET_ALTIVEC && (target_flags_explicit & MASK_ALTIVEC))\n+        {\n+\t  if (target_flags_explicit & MASK_VSX)\n+\t    msg = N_(\"-mvsx and -mno-altivec are incompatible\");\n+\t  else\n+\t    msg = N_(\"-mno-altivec disables vsx\");\n+        }\n \n       if (msg)\n \t{\n \t  warning (0, msg);\n \t  target_flags &= ~ MASK_VSX;\n \t}\n-      else if (TARGET_VSX && !TARGET_ALTIVEC\n-\t       && (target_flags_explicit & MASK_ALTIVEC) == 0)\n+      else if (TARGET_VSX && !TARGET_ALTIVEC)\n \ttarget_flags |= MASK_ALTIVEC;\n     }\n "}, {"sha": "0093948d36ee145bd26a19f57b3610b018267a1f", "filename": "gcc/testsuite/ChangeLog", "status": "modified", "additions": 6, "deletions": 0, "changes": 6, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/3767f512426fb5ec2c3459a83e220c3343125fc3/gcc%2Ftestsuite%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/3767f512426fb5ec2c3459a83e220c3343125fc3/gcc%2Ftestsuite%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2FChangeLog?ref=3767f512426fb5ec2c3459a83e220c3343125fc3", "patch": "@@ -1,3 +1,9 @@\n+2010-01-11  Janis Johnson  <janis187@us.ibm.com>\n+\n+\tPR target/42416\n+\t* gcc.target/powerpc/warn-1.c: New test.\n+\t* gcc.target/powerpc/warn-2.c: New test.\n+\n 2010-01-11  Uros Bizjak  <ubizjak@gmail.com>\n \n \t* gcc.target/x86_64/abi/avx/asm-support.S (snapshot_ret): Preserve"}, {"sha": "c00aff08c6edbf7e4462efa1328125dcb5e04e92", "filename": "gcc/testsuite/gcc.target/powerpc/warn-1.c", "status": "added", "additions": 18, "deletions": 0, "changes": 18, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/3767f512426fb5ec2c3459a83e220c3343125fc3/gcc%2Ftestsuite%2Fgcc.target%2Fpowerpc%2Fwarn-1.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/3767f512426fb5ec2c3459a83e220c3343125fc3/gcc%2Ftestsuite%2Fgcc.target%2Fpowerpc%2Fwarn-1.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgcc.target%2Fpowerpc%2Fwarn-1.c?ref=3767f512426fb5ec2c3459a83e220c3343125fc3", "patch": "@@ -0,0 +1,18 @@\n+/* { dg-do compile { target { powerpc*-*-* } } } */\n+/* { dg-skip-if \"\" { powerpc*-*-darwin* } { \"*\" } { \"\" } } */\n+/* { dg-options \"-O -mvsx -mno-altivec\" } */\n+\n+/* { dg-warning \"-mvsx and -mno-altivec are incompatible\" \"\" { target *-*-* } 1 } */\n+\n+double\n+foo (double *x, double *y)\n+{\n+  double z[2];\n+  int i;\n+\n+  for (i = 0; i < 2; i++)\n+    z[i] = x[i] + y[i];\n+  return z[0] * z[1];\n+}\n+\n+/* { dg-final { scan-assembler-not \"xsadddp\" } } */"}, {"sha": "0a9fa1e3ff35dd6306b2fc76508f9ea19355c85f", "filename": "gcc/testsuite/gcc.target/powerpc/warn-2.c", "status": "added", "additions": 18, "deletions": 0, "changes": 18, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/3767f512426fb5ec2c3459a83e220c3343125fc3/gcc%2Ftestsuite%2Fgcc.target%2Fpowerpc%2Fwarn-2.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/3767f512426fb5ec2c3459a83e220c3343125fc3/gcc%2Ftestsuite%2Fgcc.target%2Fpowerpc%2Fwarn-2.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgcc.target%2Fpowerpc%2Fwarn-2.c?ref=3767f512426fb5ec2c3459a83e220c3343125fc3", "patch": "@@ -0,0 +1,18 @@\n+/* { dg-do compile { target { powerpc*-*-* } } } */\n+/* { dg-skip-if \"\" { powerpc*-*-darwin* } { \"*\" } { \"\" } } */\n+/* { dg-options \"-O -mcpu=power7 -mno-altivec\" } */\n+\n+/* { dg-warning \"-mno-altivec disables vsx\" \"\" { target *-*-* } 1 } */\n+\n+double\n+foo (double *x, double *y)\n+{\n+  double z[2];\n+  int i;\n+\n+  for (i = 0; i < 2; i++)\n+    z[i] = x[i] + y[i];\n+  return z[0] * z[1];\n+}\n+\n+/* { dg-final { scan-assembler-not \"xsadddp\" } } */"}]}