{"sha": "eefec38c992e3622a69de9667e91f0cafbff03cc", "node_id": "C_kwDOANBUbNoAKGVlZmVjMzhjOTkyZTM2MjJhNjlkZTk2NjdlOTFmMGNhZmJmZjAzY2M", "commit": {"author": {"name": "Jeff Law", "email": "jeffreyalaw@gmail.com", "date": "2022-02-09T19:10:53Z"}, "committer": {"name": "Jeff Law", "email": "jeffreyalaw@gmail.com", "date": "2022-02-09T19:10:53Z"}, "message": "Avoid using predefined insn name for instruction with different semantics\n\nThis isn't technically a regression, but it only impacts the v850 target and\nfixes a long standing code correctness issue.\n\nAs outlined in slightly more detail in the PR, the v850 is using the pattern\nname \"fnmasf4\" and \"fnmssf4\" to generate fnmaf.s and fnmsf.s instructions\n respectively.\n\nUnfortunately fnmasf4 is expected to produce (-a * b) + c and\nfnmssf4 (-a * b) - c.  Those v850 instructions actually negate the entire\nresult.\n\nThe fix is trivial.  Use a different pattern name so that the combiner can\nstill generate those instructions, but prevent those instructions from being\nused to implement GCC's notion of what fnmas and fnmss should be.\n\nThis fixes pr97040 as well as a handful of testsuite failures for the v3e5\nmultilib.\n\ngcc/\n\tPR target/97040\n\t* config/v850/v850.md (*v850_fnmasf4): Renamed from fnmasf4.\n\t(*v850_fnmssf4): Renamed from fnmssf4", "tree": {"sha": "9e93d1e58a23d374a4f0a5e2e985d1aa233d5ece", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/9e93d1e58a23d374a4f0a5e2e985d1aa233d5ece"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/eefec38c992e3622a69de9667e91f0cafbff03cc", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/eefec38c992e3622a69de9667e91f0cafbff03cc", "html_url": "https://github.com/Rust-GCC/gccrs/commit/eefec38c992e3622a69de9667e91f0cafbff03cc", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/eefec38c992e3622a69de9667e91f0cafbff03cc/comments", "author": {"login": "JeffreyALaw", "id": 14062506, "node_id": "MDQ6VXNlcjE0MDYyNTA2", "avatar_url": "https://avatars.githubusercontent.com/u/14062506?v=4", "gravatar_id": "", "url": "https://api.github.com/users/JeffreyALaw", "html_url": "https://github.com/JeffreyALaw", "followers_url": "https://api.github.com/users/JeffreyALaw/followers", "following_url": "https://api.github.com/users/JeffreyALaw/following{/other_user}", "gists_url": "https://api.github.com/users/JeffreyALaw/gists{/gist_id}", "starred_url": "https://api.github.com/users/JeffreyALaw/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/JeffreyALaw/subscriptions", "organizations_url": "https://api.github.com/users/JeffreyALaw/orgs", "repos_url": "https://api.github.com/users/JeffreyALaw/repos", "events_url": "https://api.github.com/users/JeffreyALaw/events{/privacy}", "received_events_url": "https://api.github.com/users/JeffreyALaw/received_events", "type": "User", "site_admin": false}, "committer": {"login": "JeffreyALaw", "id": 14062506, "node_id": "MDQ6VXNlcjE0MDYyNTA2", "avatar_url": "https://avatars.githubusercontent.com/u/14062506?v=4", "gravatar_id": "", "url": "https://api.github.com/users/JeffreyALaw", "html_url": "https://github.com/JeffreyALaw", "followers_url": "https://api.github.com/users/JeffreyALaw/followers", "following_url": "https://api.github.com/users/JeffreyALaw/following{/other_user}", "gists_url": "https://api.github.com/users/JeffreyALaw/gists{/gist_id}", "starred_url": "https://api.github.com/users/JeffreyALaw/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/JeffreyALaw/subscriptions", "organizations_url": "https://api.github.com/users/JeffreyALaw/orgs", "repos_url": "https://api.github.com/users/JeffreyALaw/repos", "events_url": "https://api.github.com/users/JeffreyALaw/events{/privacy}", "received_events_url": "https://api.github.com/users/JeffreyALaw/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "d3f3ec5a555dbf0e3329515b38f848b4760589b2", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/d3f3ec5a555dbf0e3329515b38f848b4760589b2", "html_url": "https://github.com/Rust-GCC/gccrs/commit/d3f3ec5a555dbf0e3329515b38f848b4760589b2"}], "stats": {"total": 9, "additions": 7, "deletions": 2}, "files": [{"sha": "6ca31e3f43f4e67777e3c1bdb93a474a21e883a7", "filename": "gcc/config/v850/v850.md", "status": "modified", "additions": 7, "deletions": 2, "changes": 9, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/eefec38c992e3622a69de9667e91f0cafbff03cc/gcc%2Fconfig%2Fv850%2Fv850.md", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/eefec38c992e3622a69de9667e91f0cafbff03cc/gcc%2Fconfig%2Fv850%2Fv850.md", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fconfig%2Fv850%2Fv850.md?ref=eefec38c992e3622a69de9667e91f0cafbff03cc", "patch": "@@ -2601,7 +2601,12 @@\n    (set_attr \"type\" \"fpu\")])\n \n ;;; negative-multiply-add\n-(define_insn \"fnmasf4\"\n+;; Note the name on this and the following insn were previously fnmasf4\n+;; and fnmssf4.  Those names are known to the gimple->rtl expanders and\n+;; must implement specific semantics (negating one of the inputs to the\n+;; multiplication).  The v850 instructions actually negate the entire\n+;; result.  Thus the names have been changed and hidden.\n+(define_insn \"*v850_fnmasf4\"\n   [(set (match_operand:SF                 0 \"register_operand\" \"=r\")\n \t(neg:SF (fma:SF (match_operand:SF 1 \"register_operand\" \"r\")\n \t\t\t(match_operand:SF 2 \"register_operand\" \"r\")\n@@ -2612,7 +2617,7 @@\n    (set_attr \"type\" \"fpu\")])\n \n ;; negative-multiply-subtract\n-(define_insn \"fnmssf4\"\n+(define_insn \"*v850_fnmssf4\"\n   [(set (match_operand:SF                         0 \"register_operand\" \"=r\")\n \t(neg:SF (fma:SF (match_operand:SF         1 \"register_operand\" \"r\")\n \t\t\t(match_operand:SF         2 \"register_operand\" \"r\")"}]}