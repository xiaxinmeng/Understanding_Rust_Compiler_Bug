{"sha": "1718a2aa9b1715961e514331aea0f5aacc611580", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6MTcxOGEyYWE5YjE3MTU5NjFlNTE0MzMxYWVhMGY1YWFjYzYxMTU4MA==", "commit": {"author": {"name": "Richard Henderson", "email": "rth@redhat.com", "date": "2005-10-03T20:57:45Z"}, "committer": {"name": "Richard Henderson", "email": "rth@gcc.gnu.org", "date": "2005-10-03T20:57:45Z"}, "message": "re PR middle-end/24135 (nonlocal goto from nested function gets 'undefined symbol' in assembler)\n\n        PR 24135\n        * tree-nested.c (convert_nl_goto_reference): Lookup a translation\n        before creating a new one.\n\nFrom-SVN: r104911", "tree": {"sha": "81e9e5184f6f865cedc0d6d7a7a0898ce3083a1a", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/81e9e5184f6f865cedc0d6d7a7a0898ce3083a1a"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/1718a2aa9b1715961e514331aea0f5aacc611580", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/1718a2aa9b1715961e514331aea0f5aacc611580", "html_url": "https://github.com/Rust-GCC/gccrs/commit/1718a2aa9b1715961e514331aea0f5aacc611580", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/1718a2aa9b1715961e514331aea0f5aacc611580/comments", "author": null, "committer": null, "parents": [{"sha": "bb13c3502be2c6eda1771e10f95f615b71d4d026", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/bb13c3502be2c6eda1771e10f95f615b71d4d026", "html_url": "https://github.com/Rust-GCC/gccrs/commit/bb13c3502be2c6eda1771e10f95f615b71d4d026"}], "stats": {"total": 82, "additions": 70, "deletions": 12}, "files": [{"sha": "957ac6cfdd2a7ebe4fcd1563947f105ff4893889", "filename": "gcc/ChangeLog", "status": "modified", "additions": 6, "deletions": 0, "changes": 6, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/1718a2aa9b1715961e514331aea0f5aacc611580/gcc%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/1718a2aa9b1715961e514331aea0f5aacc611580/gcc%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2FChangeLog?ref=1718a2aa9b1715961e514331aea0f5aacc611580", "patch": "@@ -1,3 +1,9 @@\n+2005-10-03  Richard Henderson  <rth@redhat.com>\n+\n+\tPR 24135\n+\t* tree-nested.c (convert_nl_goto_reference): Lookup a translation\n+\tbefore creating a new one.\n+\n 2005-10-03  David Edelsohn  <edelsohn@gnu.org>\n \n \t* config/rs6000/t-aix43 (LDFLAGS): New."}, {"sha": "fdeda164004149725c220ba75b0d80b513b3625a", "filename": "gcc/testsuite/gcc.c-torture/execute/pr24135.c", "status": "added", "additions": 46, "deletions": 0, "changes": 46, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/1718a2aa9b1715961e514331aea0f5aacc611580/gcc%2Ftestsuite%2Fgcc.c-torture%2Fexecute%2Fpr24135.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/1718a2aa9b1715961e514331aea0f5aacc611580/gcc%2Ftestsuite%2Fgcc.c-torture%2Fexecute%2Fpr24135.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgcc.c-torture%2Fexecute%2Fpr24135.c?ref=1718a2aa9b1715961e514331aea0f5aacc611580", "patch": "@@ -0,0 +1,46 @@\n+#ifndef NO_TRAMPOLINES\n+extern void abort (void);\n+\n+int x(int a, int b)\n+{\n+  __label__ xlab;\n+  __label__ xlab2;\n+\n+  void y(int b)\n+    {\n+       switch (b)\n+        {\n+          case 1: goto xlab;\n+          case 2: goto xlab;\n+        }\n+    }\n+\n+  a = a + 2;\n+  y (b);\n+\n+ xlab:\n+  return a;\n+\n+ xlab2:\n+  a++;\n+  return a;\n+\n+}\n+\n+int main ()\n+{\n+  int i, j;\n+\n+  for (j = 1; j <= 2; ++j)\n+    for (i = 1; i <= 2; ++i)\n+      {\n+\tint a = x (j, i);\n+\tif (a != 2 + j)\n+\t  abort ();\n+      }\n+\n+  return 0;\n+}\n+#else\n+int main() { return 0; }\n+#endif"}, {"sha": "27819db3e445c5bbfb05cb06274d58664197f404", "filename": "gcc/tree-nested.c", "status": "modified", "additions": 18, "deletions": 12, "changes": 30, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/1718a2aa9b1715961e514331aea0f5aacc611580/gcc%2Ftree-nested.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/1718a2aa9b1715961e514331aea0f5aacc611580/gcc%2Ftree-nested.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftree-nested.c?ref=1718a2aa9b1715961e514331aea0f5aacc611580", "patch": "@@ -1089,7 +1089,7 @@ convert_nl_goto_reference (tree *tp, int *walk_subtrees, void *data)\n   struct walk_stmt_info *wi = data;\n   struct nesting_info *info = wi->info, *i;\n   tree t = *tp, label, new_label, target_context, x, arg, field;\n-  struct var_map_elt *elt;\n+  struct var_map_elt *elt, dummy;\n   void **slot;\n \n   *walk_subtrees = 0;\n@@ -1110,17 +1110,23 @@ convert_nl_goto_reference (tree *tp, int *walk_subtrees, void *data)\n      control transfer.  This new label will be marked LABEL_NONLOCAL; this\n      mark will trigger proper behavior in the cfg, as well as cause the\n      (hairy target-specific) non-local goto receiver code to be generated\n-     when we expand rtl.  */\n-  new_label = create_artificial_label ();\n-  DECL_NONLOCAL (new_label) = 1;\n-\n-  /* Enter this association into var_map so that we can insert the new\n-     label into the IL during a second pass.  */\n-  elt = ggc_alloc (sizeof (*elt));\n-  elt->old = label;\n-  elt->new = new_label;\n-  slot = htab_find_slot (i->var_map, elt, INSERT);\n-  *slot = elt;\n+     when we expand rtl.  Enter this association into var_map so that we\n+     can insert the new label into the IL during a second pass.  */\n+  dummy.old = label;\n+  slot = htab_find_slot (i->var_map, &dummy, INSERT);\n+  elt = *slot;\n+  if (elt == NULL)\n+    {\n+      new_label = create_artificial_label ();\n+      DECL_NONLOCAL (new_label) = 1;\n+\n+      elt = ggc_alloc (sizeof (*elt));\n+      elt->old = label;\n+      elt->new = new_label;\n+      *slot = elt;\n+    }\n+  else\n+    new_label = elt->new;\n   \n   /* Build: __builtin_nl_goto(new_label, &chain->nl_goto_field).  */\n   field = get_nl_goto_field (i);"}]}