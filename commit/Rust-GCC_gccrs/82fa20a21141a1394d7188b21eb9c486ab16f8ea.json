{"sha": "82fa20a21141a1394d7188b21eb9c486ab16f8ea", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6ODJmYTIwYTIxMTQxYTEzOTRkNzE4OGIyMWViOWM0ODZhYjE2ZjhlYQ==", "commit": {"author": {"name": "Frederic Konrad", "email": "konrad@adacore.com", "date": "2019-09-18T08:32:09Z"}, "committer": {"name": "Pierre-Marie de Rodat", "email": "pmderodat@gcc.gnu.org", "date": "2019-09-18T08:32:09Z"}, "message": "[Ada] Fix errno for rename for the VxWorks 6 target\n\nThis fixes the wrong errno for rename when the file is not existing on a\ndosFs. In the end it makes Ada.Directories.Rename raising the right\nexception in the case we are trying to move a file in a non existing\ndirectory.\n\n2019-09-18  Frederic Konrad  <konrad@adacore.com>\n\ngcc/ada/\n\n\t* adaint.c: Include dosFsLib.h and vwModNum.h for VxWorks 6.\n\t(__gnat_rename): Map S_dosFsLib_FILE_NOT_FOUND to ENOENT.\n\nFrom-SVN: r275846", "tree": {"sha": "e4cc10899843041c704b49ef285999ee901245a5", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/e4cc10899843041c704b49ef285999ee901245a5"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/82fa20a21141a1394d7188b21eb9c486ab16f8ea", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/82fa20a21141a1394d7188b21eb9c486ab16f8ea", "html_url": "https://github.com/Rust-GCC/gccrs/commit/82fa20a21141a1394d7188b21eb9c486ab16f8ea", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/82fa20a21141a1394d7188b21eb9c486ab16f8ea/comments", "author": {"login": "FredKonrad", "id": 29773702, "node_id": "MDQ6VXNlcjI5NzczNzAy", "avatar_url": "https://avatars.githubusercontent.com/u/29773702?v=4", "gravatar_id": "", "url": "https://api.github.com/users/FredKonrad", "html_url": "https://github.com/FredKonrad", "followers_url": "https://api.github.com/users/FredKonrad/followers", "following_url": "https://api.github.com/users/FredKonrad/following{/other_user}", "gists_url": "https://api.github.com/users/FredKonrad/gists{/gist_id}", "starred_url": "https://api.github.com/users/FredKonrad/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/FredKonrad/subscriptions", "organizations_url": "https://api.github.com/users/FredKonrad/orgs", "repos_url": "https://api.github.com/users/FredKonrad/repos", "events_url": "https://api.github.com/users/FredKonrad/events{/privacy}", "received_events_url": "https://api.github.com/users/FredKonrad/received_events", "type": "User", "site_admin": false}, "committer": null, "parents": [{"sha": "dcbe49a6c41e586e961664512726799a540757ee", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/dcbe49a6c41e586e961664512726799a540757ee", "html_url": "https://github.com/Rust-GCC/gccrs/commit/dcbe49a6c41e586e961664512726799a540757ee"}], "stats": {"total": 25, "additions": 25, "deletions": 0}, "files": [{"sha": "38c5a7ee16469b94b61138d7919eda0abebe45f9", "filename": "gcc/ada/ChangeLog", "status": "modified", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/82fa20a21141a1394d7188b21eb9c486ab16f8ea/gcc%2Fada%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/82fa20a21141a1394d7188b21eb9c486ab16f8ea/gcc%2Fada%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fada%2FChangeLog?ref=82fa20a21141a1394d7188b21eb9c486ab16f8ea", "patch": "@@ -1,3 +1,8 @@\n+2019-09-18  Frederic Konrad  <konrad@adacore.com>\n+\n+\t* adaint.c: Include dosFsLib.h and vwModNum.h for VxWorks 6.\n+\t(__gnat_rename): Map S_dosFsLib_FILE_NOT_FOUND to ENOENT.\n+\n 2019-09-18  Steve Baird  <baird@adacore.com>\n \n \t* freeze.adb (Freeze_Object_Declaration): Do not call"}, {"sha": "595abf87d65e3a7a1d11e317ee2ed7fd00b0c1a1", "filename": "gcc/ada/adaint.c", "status": "modified", "additions": 20, "deletions": 0, "changes": 20, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/82fa20a21141a1394d7188b21eb9c486ab16f8ea/gcc%2Fada%2Fadaint.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/82fa20a21141a1394d7188b21eb9c486ab16f8ea/gcc%2Fada%2Fadaint.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fada%2Fadaint.c?ref=82fa20a21141a1394d7188b21eb9c486ab16f8ea", "patch": "@@ -74,6 +74,12 @@\n    (such as chmod) are only available on VxWorks 6.  */\n #include \"version.h\"\n \n+/* vwModNum.h and dosFsLib.h are needed for the VxWorks 6 rename workaround.\n+   See below.  */\n+#if (_WRS_VXWORKS_MAJOR == 6)\n+#include <vwModNum.h>\n+#include <dosFsLib.h>\n+#endif /* 6.x */\n #endif /* VxWorks */\n \n #if defined (__APPLE__)\n@@ -754,6 +760,20 @@ __gnat_rename (char *from, char *to)\n     S2WSC (wto, to, GNAT_MAX_PATH_LEN);\n     return _trename (wfrom, wto);\n   }\n+#elif defined (__vxworks) && (_WRS_VXWORKS_MAJOR == 6)\n+  {\n+    /* When used on a dos filesystem under VxWorks 6.9 rename will trigger a\n+       S_dosFsLib_FILE_NOT_FOUND errno when the file is not found.  Let's map\n+       that to ENOENT so Ada.Directory.Rename can detect that and raise the\n+       Name_Error exception.  */\n+    int ret = rename (from, to);\n+\n+    if (ret && (errno == S_dosFsLib_FILE_NOT_FOUND))\n+      {\n+        errno = ENOENT;\n+      }\n+    return ret;\n+  }\n #else\n   return rename (from, to);\n #endif"}]}