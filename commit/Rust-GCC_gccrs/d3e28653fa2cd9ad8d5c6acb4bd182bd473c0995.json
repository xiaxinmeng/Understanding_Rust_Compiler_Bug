{"sha": "d3e28653fa2cd9ad8d5c6acb4bd182bd473c0995", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6ZDNlMjg2NTNmYTJjZDlhZDhkNWM2YWNiNGJkMTgyYmQ0NzNjMDk5NQ==", "commit": {"author": {"name": "David Malcolm", "email": "dmalcolm@redhat.com", "date": "2019-12-10T01:48:42Z"}, "committer": {"name": "David Malcolm", "email": "dmalcolm@gcc.gnu.org", "date": "2019-12-10T01:48:42Z"}, "message": "diagnostic_show_locus: move initial newline to callers\n\ndiagnostic_show_locus adds a newline before doing anything (including\nthe do-nothing-else case).\n\nThis patch removes this initial newline, adding it to all callers\nof diagnostic_show_locus instead.\n\nDoing so makes diagnostic_show_locus more flexible, allowing it to be\nused in my analyzer patch kit for printing diagnostic paths.\n\ngcc/c-family/ChangeLog:\n\t* c-format.c (selftest::test_type_mismatch_range_labels): Remove\n\tinitial newline from expected outputs.\n\t* c-opts.c (c_diagnostic_finalizer): Add pp_newline call before\n\tcall to diagnostic_show_locus.\n\ngcc/ChangeLog:\n\t* diagnostic-show-locus.c (diagnostic_show_locus): Remove initial\n\tnewline.\n\t(selftest::test_diagnostic_show_locus_unknown_location): Remove\n\tinitial newline from expected outputs.\n\t(selftest::test_one_liner_simple_caret): Likewise.\n\t(selftest::test_one_liner_caret_and_range): Likewise.\n\t(selftest::test_one_liner_multiple_carets_and_ranges): Likewise.\n\t(selftest::test_one_liner_fixit_insert_before): Likewise.\n\t(selftest::test_one_liner_fixit_insert_after): Likewise.\n\t(selftest::test_one_liner_fixit_remove): Likewise.\n\t(selftest::test_one_liner_fixit_replace): Likewise.\n\t(selftest::test_one_liner_fixit_replace_non_equal_range):\n\tLikewise.\n\t(selftest::test_one_liner_fixit_replace_equal_secondary_range):\n\tLikewise.\n\t(selftest::test_one_liner_fixit_validation_adhoc_locations):\n\tLikewise.\n\t(selftest::test_one_liner_many_fixits_1): Likewise.\n\t(selftest::test_one_liner_many_fixits_2): Likewise.\n\t(selftest::test_one_liner_labels): Likewise.\n\t(selftest::test_one_liner_simple_caret_utf8): Likewise.\n\t(selftest::test_one_liner_caret_and_range_utf8): Likewise.\n\t(selftest::test_one_liner_multiple_carets_and_ranges_utf8):\n\tLikewise.\n\t(selftest::test_one_liner_fixit_insert_before_utf8): Likewise.\n\t(selftest::test_one_liner_fixit_insert_after_utf8): Likewise.\n\t(selftest::test_one_liner_fixit_remove_utf8): Likewise.\n\t(selftest::test_one_liner_fixit_replace_utf8): Likewise.\n\t(selftest::test_one_liner_fixit_replace_non_equal_range_utf8):\n\tLikewise.\n\t(selftest::test_one_liner_fixit_replace_equal_secondary_range_utf8):\n\tLikewise.\n\t(selftest::test_one_liner_fixit_validation_adhoc_locations_utf8):\n\tLikewise.\n\t(selftest::test_one_liner_many_fixits_1_utf8): Likewise.\n\t(selftest::test_one_liner_many_fixits_2_utf8): Likewise.\n\t(selftest::test_one_liner_labels_utf8): Likewise.\n\t(selftest::test_add_location_if_nearby): Likewise.\n\t(selftest::test_diagnostic_show_locus_fixit_lines): Likewise.\n\t(selftest::test_overlapped_fixit_printing): Likewise.\n\t(selftest::test_overlapped_fixit_printing_utf8): Likewise.\n\t(selftest::test_overlapped_fixit_printing_2): Likewise.\n\t(selftest::test_fixit_insert_containing_newline): Likewise.\n\t(selftest::test_fixit_insert_containing_newline_2): Likewise.\n\t(selftest::test_fixit_replace_containing_newline): Likewise.\n\t(selftest::test_fixit_deletion_affecting_newline): Likewise.\n\t(selftest::test_line_numbers_multiline_range): Likewise.\n\t* diagnostic.c (default_diagnostic_finalizer): Add pp_newline call\n\tbefore call to diagnostic_show_locus.\n\t(diagnostic_append_note): Likewise.\n\ngcc/fortran/ChangeLog:\n\t* error.c (gfc_diagnostic_starter): Add pp_newline call before\n\tcall to diagnostic_show_locus.\n\ngcc/testsuite/ChangeLog:\n\t* gcc.dg/plugin/diagnostic_plugin_test_show_locus.c\n\t(custom_diagnostic_finalizer): Add pp_newline call before call to\n\tdiagnostic_show_locus.\n\nFrom-SVN: r279152", "tree": {"sha": "6a32daf2c3f7dda13f11c307644131f4996f3520", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/6a32daf2c3f7dda13f11c307644131f4996f3520"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/d3e28653fa2cd9ad8d5c6acb4bd182bd473c0995", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/d3e28653fa2cd9ad8d5c6acb4bd182bd473c0995", "html_url": "https://github.com/Rust-GCC/gccrs/commit/d3e28653fa2cd9ad8d5c6acb4bd182bd473c0995", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/d3e28653fa2cd9ad8d5c6acb4bd182bd473c0995/comments", "author": {"login": "davidmalcolm", "id": 1553248, "node_id": "MDQ6VXNlcjE1NTMyNDg=", "avatar_url": "https://avatars.githubusercontent.com/u/1553248?v=4", "gravatar_id": "", "url": "https://api.github.com/users/davidmalcolm", "html_url": "https://github.com/davidmalcolm", "followers_url": "https://api.github.com/users/davidmalcolm/followers", "following_url": "https://api.github.com/users/davidmalcolm/following{/other_user}", "gists_url": "https://api.github.com/users/davidmalcolm/gists{/gist_id}", "starred_url": "https://api.github.com/users/davidmalcolm/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/davidmalcolm/subscriptions", "organizations_url": "https://api.github.com/users/davidmalcolm/orgs", "repos_url": "https://api.github.com/users/davidmalcolm/repos", "events_url": "https://api.github.com/users/davidmalcolm/events{/privacy}", "received_events_url": "https://api.github.com/users/davidmalcolm/received_events", "type": "User", "site_admin": false}, "committer": null, "parents": [{"sha": "41aeca8d1bfc03f0db4437d5866c5f3d9343013f", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/41aeca8d1bfc03f0db4437d5866c5f3d9343013f", "html_url": "https://github.com/Rust-GCC/gccrs/commit/41aeca8d1bfc03f0db4437d5866c5f3d9343013f"}], "stats": {"total": 293, "additions": 148, "deletions": 145}, "files": [{"sha": "704403dabc12a309c9de9a3c7233ac59b3e6f56d", "filename": "gcc/ChangeLog", "status": "modified", "additions": 53, "deletions": 0, "changes": 53, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/d3e28653fa2cd9ad8d5c6acb4bd182bd473c0995/gcc%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/d3e28653fa2cd9ad8d5c6acb4bd182bd473c0995/gcc%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2FChangeLog?ref=d3e28653fa2cd9ad8d5c6acb4bd182bd473c0995", "patch": "@@ -1,3 +1,56 @@\n+2019-12-09  David Malcolm  <dmalcolm@redhat.com>\n+\n+\t* diagnostic-show-locus.c (diagnostic_show_locus): Remove initial\n+\tnewline.\n+\t(selftest::test_diagnostic_show_locus_unknown_location): Remove\n+\tinitial newline from expected outputs.\n+\t(selftest::test_one_liner_simple_caret): Likewise.\n+\t(selftest::test_one_liner_caret_and_range): Likewise.\n+\t(selftest::test_one_liner_multiple_carets_and_ranges): Likewise.\n+\t(selftest::test_one_liner_fixit_insert_before): Likewise.\n+\t(selftest::test_one_liner_fixit_insert_after): Likewise.\n+\t(selftest::test_one_liner_fixit_remove): Likewise.\n+\t(selftest::test_one_liner_fixit_replace): Likewise.\n+\t(selftest::test_one_liner_fixit_replace_non_equal_range):\n+\tLikewise.\n+\t(selftest::test_one_liner_fixit_replace_equal_secondary_range):\n+\tLikewise.\n+\t(selftest::test_one_liner_fixit_validation_adhoc_locations):\n+\tLikewise.\n+\t(selftest::test_one_liner_many_fixits_1): Likewise.\n+\t(selftest::test_one_liner_many_fixits_2): Likewise.\n+\t(selftest::test_one_liner_labels): Likewise.\n+\t(selftest::test_one_liner_simple_caret_utf8): Likewise.\n+\t(selftest::test_one_liner_caret_and_range_utf8): Likewise.\n+\t(selftest::test_one_liner_multiple_carets_and_ranges_utf8):\n+\tLikewise.\n+\t(selftest::test_one_liner_fixit_insert_before_utf8): Likewise.\n+\t(selftest::test_one_liner_fixit_insert_after_utf8): Likewise.\n+\t(selftest::test_one_liner_fixit_remove_utf8): Likewise.\n+\t(selftest::test_one_liner_fixit_replace_utf8): Likewise.\n+\t(selftest::test_one_liner_fixit_replace_non_equal_range_utf8):\n+\tLikewise.\n+\t(selftest::test_one_liner_fixit_replace_equal_secondary_range_utf8):\n+\tLikewise.\n+\t(selftest::test_one_liner_fixit_validation_adhoc_locations_utf8):\n+\tLikewise.\n+\t(selftest::test_one_liner_many_fixits_1_utf8): Likewise.\n+\t(selftest::test_one_liner_many_fixits_2_utf8): Likewise.\n+\t(selftest::test_one_liner_labels_utf8): Likewise.\n+\t(selftest::test_add_location_if_nearby): Likewise.\n+\t(selftest::test_diagnostic_show_locus_fixit_lines): Likewise.\n+\t(selftest::test_overlapped_fixit_printing): Likewise.\n+\t(selftest::test_overlapped_fixit_printing_utf8): Likewise.\n+\t(selftest::test_overlapped_fixit_printing_2): Likewise.\n+\t(selftest::test_fixit_insert_containing_newline): Likewise.\n+\t(selftest::test_fixit_insert_containing_newline_2): Likewise.\n+\t(selftest::test_fixit_replace_containing_newline): Likewise.\n+\t(selftest::test_fixit_deletion_affecting_newline): Likewise.\n+\t(selftest::test_line_numbers_multiline_range): Likewise.\n+\t* diagnostic.c (default_diagnostic_finalizer): Add pp_newline call\n+\tbefore call to diagnostic_show_locus.\n+\t(diagnostic_append_note): Likewise.\n+\n 2019-12-09  Martin Sebor  <msebor@redhat.com>\n \n \tPR middle-end/92761"}, {"sha": "09d7a040726bda53fba041a4809ca9fd7f2fc2d1", "filename": "gcc/c-family/ChangeLog", "status": "modified", "additions": 7, "deletions": 0, "changes": 7, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/d3e28653fa2cd9ad8d5c6acb4bd182bd473c0995/gcc%2Fc-family%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/d3e28653fa2cd9ad8d5c6acb4bd182bd473c0995/gcc%2Fc-family%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fc-family%2FChangeLog?ref=d3e28653fa2cd9ad8d5c6acb4bd182bd473c0995", "patch": "@@ -1,3 +1,10 @@\n+2019-12-09  David Malcolm  <dmalcolm@redhat.com>\n+\n+\t* c-format.c (selftest::test_type_mismatch_range_labels): Remove\n+\tinitial newline from expected outputs.\n+\t* c-opts.c (c_diagnostic_finalizer): Add pp_newline call before\n+\tcall to diagnostic_show_locus.\n+\n 2019-12-06  Jakub Jelinek  <jakub@redhat.com>\n \n \t* c-cppbuiltin.c (c_cpp_builtins): Don't define __cpp_consteval for"}, {"sha": "0be13496d8f183473970f1b74c34b02c099eef46", "filename": "gcc/c-family/c-format.c", "status": "modified", "additions": 2, "deletions": 4, "changes": 6, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/d3e28653fa2cd9ad8d5c6acb4bd182bd473c0995/gcc%2Fc-family%2Fc-format.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/d3e28653fa2cd9ad8d5c6acb4bd182bd473c0995/gcc%2Fc-family%2Fc-format.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fc-family%2Fc-format.c?ref=d3e28653fa2cd9ad8d5c6acb4bd182bd473c0995", "patch": "@@ -5392,16 +5392,14 @@ test_type_mismatch_range_labels ()\n   diagnostic_show_locus (&dc, &richloc, DK_ERROR);\n   if (c_dialect_cxx ())\n     /* \"char*\", without a space.  */\n-    ASSERT_STREQ (\"\\n\"\n-\t\t  \"   printf (\\\"msg: %i\\\\n\\\", msg);\\n\"\n+    ASSERT_STREQ (\"   printf (\\\"msg: %i\\\\n\\\", msg);\\n\"\n \t\t  \"                 ~^     ~~~\\n\"\n \t\t  \"                  |     |\\n\"\n \t\t  \"                  char* int\\n\",\n \t\t  pp_formatted_text (dc.printer));\n   else\n     /* \"char *\", with a space.  */\n-    ASSERT_STREQ (\"\\n\"\n-\t\t  \"   printf (\\\"msg: %i\\\\n\\\", msg);\\n\"\n+    ASSERT_STREQ (\"   printf (\\\"msg: %i\\\\n\\\", msg);\\n\"\n \t\t  \"                 ~^     ~~~\\n\"\n \t\t  \"                  |     |\\n\"\n \t\t  \"                  |     int\\n\""}, {"sha": "c3ad78e9735bc840cc565aa031bb269b58ee3688", "filename": "gcc/c-family/c-opts.c", "status": "modified", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/d3e28653fa2cd9ad8d5c6acb4bd182bd473c0995/gcc%2Fc-family%2Fc-opts.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/d3e28653fa2cd9ad8d5c6acb4bd182bd473c0995/gcc%2Fc-family%2Fc-opts.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fc-family%2Fc-opts.c?ref=d3e28653fa2cd9ad8d5c6acb4bd182bd473c0995", "patch": "@@ -170,6 +170,7 @@ c_diagnostic_finalizer (diagnostic_context *context,\n {\n   char *saved_prefix = pp_take_prefix (context->printer);\n   pp_set_prefix (context->printer, NULL);\n+  pp_newline (context->printer);\n   diagnostic_show_locus (context, diagnostic->richloc, diagnostic->kind);\n   /* By default print macro expansion contexts in the diagnostic\n      finalizer -- for tokens resulting from macro expansion.  */"}, {"sha": "c87603caf41984867f8e3a02630f1641de6b891b", "filename": "gcc/diagnostic-show-locus.c", "status": "modified", "additions": 70, "deletions": 141, "changes": 211, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/d3e28653fa2cd9ad8d5c6acb4bd182bd473c0995/gcc%2Fdiagnostic-show-locus.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/d3e28653fa2cd9ad8d5c6acb4bd182bd473c0995/gcc%2Fdiagnostic-show-locus.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fdiagnostic-show-locus.c?ref=d3e28653fa2cd9ad8d5c6acb4bd182bd473c0995", "patch": "@@ -2530,8 +2530,6 @@ diagnostic_show_locus (diagnostic_context * context,\n \t\t       rich_location *richloc,\n \t\t       diagnostic_t diagnostic_kind)\n {\n-  pp_newline (context->printer);\n-\n   location_t loc = richloc->get_loc ();\n   /* Do nothing if source-printing has been disabled.  */\n   if (!context->show_caret)\n@@ -2766,7 +2764,7 @@ test_diagnostic_show_locus_unknown_location ()\n   test_diagnostic_context dc;\n   rich_location richloc (line_table, UNKNOWN_LOCATION);\n   diagnostic_show_locus (&dc, &richloc, DK_ERROR);\n-  ASSERT_STREQ (\"\\n\", pp_formatted_text (dc.printer));\n+  ASSERT_STREQ (\"\", pp_formatted_text (dc.printer));\n }\n \n /* Verify that diagnostic_show_locus works sanely for various\n@@ -2788,8 +2786,7 @@ test_one_liner_simple_caret ()\n   location_t caret = linemap_position_for_column (line_table, 10);\n   rich_location richloc (line_table, caret);\n   diagnostic_show_locus (&dc, &richloc, DK_ERROR);\n-  ASSERT_STREQ (\"\\n\"\n-\t\t\" foo = bar.field;\\n\"\n+  ASSERT_STREQ (\" foo = bar.field;\\n\"\n \t\t\"          ^\\n\",\n \t\tpp_formatted_text (dc.printer));\n }\n@@ -2806,8 +2803,7 @@ test_one_liner_caret_and_range ()\n   location_t loc = make_location (caret, start, finish);\n   rich_location richloc (line_table, loc);\n   diagnostic_show_locus (&dc, &richloc, DK_ERROR);\n-  ASSERT_STREQ (\"\\n\"\n-\t\t\" foo = bar.field;\\n\"\n+  ASSERT_STREQ (\" foo = bar.field;\\n\"\n \t\t\"       ~~~^~~~~~\\n\",\n \t\tpp_formatted_text (dc.printer));\n }\n@@ -2840,8 +2836,7 @@ test_one_liner_multiple_carets_and_ranges ()\n   richloc.add_range (bar, SHOW_RANGE_WITH_CARET);\n   richloc.add_range (field, SHOW_RANGE_WITH_CARET);\n   diagnostic_show_locus (&dc, &richloc, DK_ERROR);\n-  ASSERT_STREQ (\"\\n\"\n-\t\t\" foo = bar.field;\\n\"\n+  ASSERT_STREQ (\" foo = bar.field;\\n\"\n \t\t\" ~A~   ~B~ ~~C~~\\n\",\n \t\tpp_formatted_text (dc.printer));\n }\n@@ -2856,8 +2851,7 @@ test_one_liner_fixit_insert_before ()\n   rich_location richloc (line_table, caret);\n   richloc.add_fixit_insert_before (\"&\");\n   diagnostic_show_locus (&dc, &richloc, DK_ERROR);\n-  ASSERT_STREQ (\"\\n\"\n-\t\t\" foo = bar.field;\\n\"\n+  ASSERT_STREQ (\" foo = bar.field;\\n\"\n \t\t\"       ^\\n\"\n \t\t\"       &\\n\",\n \t\tpp_formatted_text (dc.printer));\n@@ -2875,8 +2869,7 @@ test_one_liner_fixit_insert_after ()\n   rich_location richloc (line_table, foo);\n   richloc.add_fixit_insert_after (\"[0]\");\n   diagnostic_show_locus (&dc, &richloc, DK_ERROR);\n-  ASSERT_STREQ (\"\\n\"\n-\t\t\" foo = bar.field;\\n\"\n+  ASSERT_STREQ (\" foo = bar.field;\\n\"\n \t\t\" ^~~\\n\"\n \t\t\"    [0]\\n\",\n \t\tpp_formatted_text (dc.printer));\n@@ -2899,8 +2892,7 @@ test_one_liner_fixit_remove ()\n   {\n     test_diagnostic_context dc;\n     diagnostic_show_locus (&dc, &richloc, DK_ERROR);\n-    ASSERT_STREQ (\"\\n\"\n-\t\t  \" foo = bar.field;\\n\"\n+    ASSERT_STREQ (\" foo = bar.field;\\n\"\n \t\t  \"          ^~~~~~\\n\"\n \t\t  \"          ------\\n\",\n \t\t  pp_formatted_text (dc.printer));\n@@ -2912,8 +2904,7 @@ test_one_liner_fixit_remove ()\n     pp_prefixing_rule (dc.printer) = DIAGNOSTICS_SHOW_PREFIX_EVERY_LINE;\n     pp_set_prefix (dc.printer, xstrdup (\"TEST PREFIX:\"));\n     diagnostic_show_locus (&dc, &richloc, DK_ERROR);\n-    ASSERT_STREQ (\"\\n\"\n-\t\t  \"TEST PREFIX: foo = bar.field;\\n\"\n+    ASSERT_STREQ (\"TEST PREFIX: foo = bar.field;\\n\"\n \t\t  \"TEST PREFIX:          ^~~~~~\\n\"\n \t\t  \"TEST PREFIX:          ------\\n\",\n \t\t  pp_formatted_text (dc.printer));\n@@ -2925,8 +2916,7 @@ test_one_liner_fixit_remove ()\n     dc.show_ruler_p = true;\n     dc.caret_max_width = 104;\n     diagnostic_show_locus (&dc, &richloc, DK_ERROR);\n-    ASSERT_STREQ (\"\\n\"\n-\t\t  \"          0         0         0         0         0         0         0         0         0         1    \\n\"\n+    ASSERT_STREQ (\"          0         0         0         0         0         0         0         0         0         1    \\n\"\n \t\t  \"          1         2         3         4         5         6         7         8         9         0    \\n\"\n \t\t  \" 12345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234\\n\"\n \t\t  \" foo = bar.field;\\n\"\n@@ -2943,8 +2933,7 @@ test_one_liner_fixit_remove ()\n     pp_prefixing_rule (dc.printer) = DIAGNOSTICS_SHOW_PREFIX_EVERY_LINE;\n     pp_set_prefix (dc.printer, xstrdup (\"TEST PREFIX:\"));\n     diagnostic_show_locus (&dc, &richloc, DK_ERROR);\n-    ASSERT_STREQ (\"\\n\"\n-\t\t  \"TEST PREFIX:          1         2         3         4         5\\n\"\n+    ASSERT_STREQ (\"TEST PREFIX:          1         2         3         4         5\\n\"\n \t\t  \"TEST PREFIX: 12345678901234567890123456789012345678901234567890\\n\"\n \t\t  \"TEST PREFIX: foo = bar.field;\\n\"\n \t\t  \"TEST PREFIX:          ^~~~~~\\n\"\n@@ -2961,8 +2950,7 @@ test_one_liner_fixit_remove ()\n     pp_prefixing_rule (dc.printer) = DIAGNOSTICS_SHOW_PREFIX_EVERY_LINE;\n     pp_set_prefix (dc.printer, xstrdup (\"TEST PREFIX:\"));\n     diagnostic_show_locus (&dc, &richloc, DK_ERROR);\n-    ASSERT_STREQ (\"\\n\"\n-\t\t  \"TEST PREFIX:      |          1         2         3         4         5\\n\"\n+    ASSERT_STREQ (\"TEST PREFIX:      |          1         2         3         4         5\\n\"\n \t\t  \"TEST PREFIX:      | 12345678901234567890123456789012345678901234567890\\n\"\n \t\t  \"TEST PREFIX:    1 | foo = bar.field;\\n\"\n \t\t  \"TEST PREFIX:      |          ^~~~~~\\n\"\n@@ -2983,8 +2971,7 @@ test_one_liner_fixit_replace ()\n   rich_location richloc (line_table, field);\n   richloc.add_fixit_replace (\"m_field\");\n   diagnostic_show_locus (&dc, &richloc, DK_ERROR);\n-  ASSERT_STREQ (\"\\n\"\n-\t\t\" foo = bar.field;\\n\"\n+  ASSERT_STREQ (\" foo = bar.field;\\n\"\n \t\t\"           ^~~~~\\n\"\n \t\t\"           m_field\\n\",\n \t\tpp_formatted_text (dc.printer));\n@@ -3008,8 +2995,7 @@ test_one_liner_fixit_replace_non_equal_range ()\n   diagnostic_show_locus (&dc, &richloc, DK_ERROR);\n   /* The replacement range is not indicated in the annotation line, so\n      it should be indicated via an additional underline.  */\n-  ASSERT_STREQ (\"\\n\"\n-\t\t\" foo = bar.field;\\n\"\n+  ASSERT_STREQ (\" foo = bar.field;\\n\"\n \t\t\"     ^\\n\"\n \t\t\"           -----\\n\"\n \t\t\"           m_field\\n\",\n@@ -3034,8 +3020,7 @@ test_one_liner_fixit_replace_equal_secondary_range ()\n   diagnostic_show_locus (&dc, &richloc, DK_ERROR);\n   /* The replacement range is indicated in the annotation line,\n      so it shouldn't be indicated via an additional underline.  */\n-  ASSERT_STREQ (\"\\n\"\n-\t\t\" foo = bar.field;\\n\"\n+  ASSERT_STREQ (\" foo = bar.field;\\n\"\n \t\t\"     ^     ~~~~~\\n\"\n \t\t\"           m_field\\n\",\n \t\tpp_formatted_text (dc.printer));\n@@ -3068,8 +3053,7 @@ test_one_liner_fixit_validation_adhoc_locations ()\n \n     test_diagnostic_context dc;\n     diagnostic_show_locus (&dc, &richloc, DK_ERROR);\n-    ASSERT_STREQ (\"\\n\"\n-\t\t  \" foo = bar.field;\\n\"\n+    ASSERT_STREQ (\" foo = bar.field;\\n\"\n \t\t  \"       ^~~~~~~~~~                               \\n\"\n \t\t  \"       test\\n\",\n \t\t  pp_formatted_text (dc.printer));\n@@ -3085,8 +3069,7 @@ test_one_liner_fixit_validation_adhoc_locations ()\n \n     test_diagnostic_context dc;\n     diagnostic_show_locus (&dc, &richloc, DK_ERROR);\n-    ASSERT_STREQ (\"\\n\"\n-\t\t  \" foo = bar.field;\\n\"\n+    ASSERT_STREQ (\" foo = bar.field;\\n\"\n \t\t  \"       ^~~~~~~~~~                               \\n\"\n \t\t  \"       -----------------------------------------\\n\",\n \t\t  pp_formatted_text (dc.printer));\n@@ -3102,8 +3085,7 @@ test_one_liner_fixit_validation_adhoc_locations ()\n \n     test_diagnostic_context dc;\n     diagnostic_show_locus (&dc, &richloc, DK_ERROR);\n-    ASSERT_STREQ (\"\\n\"\n-\t\t  \" foo = bar.field;\\n\"\n+    ASSERT_STREQ (\" foo = bar.field;\\n\"\n \t\t  \"       ^~~~~~~~~~                               \\n\"\n \t\t  \"       test\\n\",\n \t\t  pp_formatted_text (dc.printer));\n@@ -3122,8 +3104,7 @@ test_one_liner_many_fixits_1 ()\n     richloc.add_fixit_insert_before (\"a\");\n   ASSERT_EQ (1, richloc.get_num_fixit_hints ());\n   diagnostic_show_locus (&dc, &richloc, DK_ERROR);\n-  ASSERT_STREQ (\"\\n\"\n-\t\t\" foo = bar.field;\\n\"\n+  ASSERT_STREQ (\" foo = bar.field;\\n\"\n \t\t\"     ^\\n\"\n \t\t\"     aaaaaaaaaaaaaaaaaaa\\n\",\n \t\tpp_formatted_text (dc.printer));\n@@ -3145,8 +3126,7 @@ test_one_liner_many_fixits_2 ()\n     }\n   ASSERT_EQ (19, richloc.get_num_fixit_hints ());\n   diagnostic_show_locus (&dc, &richloc, DK_ERROR);\n-  ASSERT_STREQ (\"\\n\"\n-\t\t\" foo = bar.field;\\n\"\n+  ASSERT_STREQ (\" foo = bar.field;\\n\"\n \t\t\"     ^\\n\"\n \t\t\"a a a a a a a a a a a a a a a a a a a\\n\",\n \t\tpp_formatted_text (dc.printer));\n@@ -3182,8 +3162,7 @@ test_one_liner_labels ()\n     {\n       test_diagnostic_context dc;\n       diagnostic_show_locus (&dc, &richloc, DK_ERROR);\n-      ASSERT_STREQ (\"\\n\"\n-\t\t    \" foo = bar.field;\\n\"\n+      ASSERT_STREQ (\" foo = bar.field;\\n\"\n \t\t    \" ^~~   ~~~ ~~~~~\\n\"\n \t\t    \" |     |   |\\n\"\n \t\t    \" 0     1   2\\n\",\n@@ -3195,8 +3174,7 @@ test_one_liner_labels ()\n       test_diagnostic_context dc;\n       dc.show_labels_p = false;\n       diagnostic_show_locus (&dc, &richloc, DK_ERROR);\n-      ASSERT_STREQ (\"\\n\"\n-\t\t    \" foo = bar.field;\\n\"\n+      ASSERT_STREQ (\" foo = bar.field;\\n\"\n \t\t    \" ^~~   ~~~ ~~~~~\\n\",\n \t\t    pp_formatted_text (dc.printer));\n     }\n@@ -3213,8 +3191,7 @@ test_one_liner_labels ()\n \n     test_diagnostic_context dc;\n     diagnostic_show_locus (&dc, &richloc, DK_ERROR);\n-    ASSERT_STREQ (\"\\n\"\n-\t\t  \" foo = bar.field;\\n\"\n+    ASSERT_STREQ (\" foo = bar.field;\\n\"\n \t\t  \" ^~~   ~~~ ~~~~~\\n\"\n \t\t  \" |     |   |\\n\"\n \t\t  \" |     |   label 2\\n\"\n@@ -3235,8 +3212,7 @@ test_one_liner_labels ()\n \n     test_diagnostic_context dc;\n     diagnostic_show_locus (&dc, &richloc, DK_ERROR);\n-    ASSERT_STREQ (\"\\n\"\n-\t\t  \" foo = bar.field;\\n\"\n+    ASSERT_STREQ (\" foo = bar.field;\\n\"\n \t\t  \" ^~~   ~~~ ~~~~~\\n\"\n \t\t  \" |     |   |\\n\"\n \t\t  \" |     |   c\\n\"\n@@ -3255,8 +3231,7 @@ test_one_liner_labels ()\n \n     test_diagnostic_context dc;\n     diagnostic_show_locus (&dc, &richloc, DK_ERROR);\n-    ASSERT_STREQ (\"\\n\"\n-\t\t  \" foo = bar.field;\\n\"\n+    ASSERT_STREQ (\" foo = bar.field;\\n\"\n \t\t  \" ~~~   ~~~ ^~~~~\\n\"\n \t\t  \" |     |   |\\n\"\n \t\t  \" 2     1   0\\n\",\n@@ -3275,8 +3250,7 @@ test_one_liner_labels ()\n \n     test_diagnostic_context dc;\n     diagnostic_show_locus (&dc, &richloc, DK_ERROR);\n-    ASSERT_STREQ (\"\\n\"\n-\t\t  \" foo = bar.field;\\n\"\n+    ASSERT_STREQ (\" foo = bar.field;\\n\"\n \t\t  \"       ^~~\\n\"\n \t\t  \"       |\\n\"\n \t\t  \"       label 0\\n\"\n@@ -3311,8 +3285,7 @@ test_one_liner_labels ()\n \n     test_diagnostic_context dc;\n     diagnostic_show_locus (&dc, &richloc, DK_ERROR);\n-    ASSERT_STREQ (\"\\n\"\n-\t\t  \" foo = bar.field;\\n\"\n+    ASSERT_STREQ (\" foo = bar.field;\\n\"\n \t\t  \" ~~~   ~~~ ^~~~~\\n\"\n \t\t  \" |     |   |\\n\"\n \t\t  \" |     |   label 0a\\n\"\n@@ -3335,8 +3308,7 @@ test_one_liner_labels ()\n \n     test_diagnostic_context dc;\n     diagnostic_show_locus (&dc, &richloc, DK_ERROR);\n-    ASSERT_STREQ (\"\\n\"\n-\t\t  \" foo = bar.field;\\n\"\n+    ASSERT_STREQ (\" foo = bar.field;\\n\"\n \t\t  \"       ^~~\\n\",\n \t\t  pp_formatted_text (dc.printer));\n    }\n@@ -3415,8 +3387,7 @@ test_one_liner_simple_caret_utf8 ()\n   location_t caret = linemap_position_for_column (line_table, 18);\n   rich_location richloc (line_table, caret);\n   diagnostic_show_locus (&dc, &richloc, DK_ERROR);\n-  ASSERT_STREQ (\"\\n\"\n-\t\t\" \\xf0\\x9f\\x98\\x82\"\n+  ASSERT_STREQ (\" \\xf0\\x9f\\x98\\x82\"\n \t\t   \"_foo = \\xcf\\x80\"\n \t\t\t   \"_bar.\\xf0\\x9f\\x98\\x82\"\n \t\t\t\t  \"_field\\xcf\\x80\"\n@@ -3436,8 +3407,7 @@ test_one_liner_caret_and_range_utf8 ()\n   location_t loc = make_location (caret, start, finish);\n   rich_location richloc (line_table, loc);\n   diagnostic_show_locus (&dc, &richloc, DK_ERROR);\n-  ASSERT_STREQ (\"\\n\"\n-\t\t\" \\xf0\\x9f\\x98\\x82\"\n+  ASSERT_STREQ (\" \\xf0\\x9f\\x98\\x82\"\n \t\t   \"_foo = \\xcf\\x80\"\n \t\t\t   \"_bar.\\xf0\\x9f\\x98\\x82\"\n \t\t\t\t  \"_field\\xcf\\x80\"\n@@ -3473,8 +3443,7 @@ test_one_liner_multiple_carets_and_ranges_utf8 ()\n   richloc.add_range (bar, SHOW_RANGE_WITH_CARET);\n   richloc.add_range (field, SHOW_RANGE_WITH_CARET);\n   diagnostic_show_locus (&dc, &richloc, DK_ERROR);\n-  ASSERT_STREQ (\"\\n\"\n-\t\t\" \\xf0\\x9f\\x98\\x82\"\n+  ASSERT_STREQ (\" \\xf0\\x9f\\x98\\x82\"\n \t\t   \"_foo = \\xcf\\x80\"\n \t\t\t   \"_bar.\\xf0\\x9f\\x98\\x82\"\n \t\t\t\t  \"_field\\xcf\\x80\"\n@@ -3493,8 +3462,7 @@ test_one_liner_fixit_insert_before_utf8 ()\n   rich_location richloc (line_table, caret);\n   richloc.add_fixit_insert_before (\"&\");\n   diagnostic_show_locus (&dc, &richloc, DK_ERROR);\n-  ASSERT_STREQ (\"\\n\"\n-\t\t\" \\xf0\\x9f\\x98\\x82\"\n+  ASSERT_STREQ (\" \\xf0\\x9f\\x98\\x82\"\n \t\t   \"_foo = \\xcf\\x80\"\n \t\t\t   \"_bar.\\xf0\\x9f\\x98\\x82\"\n \t\t\t\t  \"_field\\xcf\\x80\"\n@@ -3516,8 +3484,7 @@ test_one_liner_fixit_insert_after_utf8 ()\n   rich_location richloc (line_table, foo);\n   richloc.add_fixit_insert_after (\"[0]\");\n   diagnostic_show_locus (&dc, &richloc, DK_ERROR);\n-  ASSERT_STREQ (\"\\n\"\n-\t\t\" \\xf0\\x9f\\x98\\x82\"\n+  ASSERT_STREQ (\" \\xf0\\x9f\\x98\\x82\"\n \t\t   \"_foo = \\xcf\\x80\"\n \t\t\t   \"_bar.\\xf0\\x9f\\x98\\x82\"\n \t\t\t\t  \"_field\\xcf\\x80\"\n@@ -3539,8 +3506,7 @@ test_one_liner_fixit_remove_utf8 ()\n   rich_location richloc (line_table, dot);\n   richloc.add_fixit_remove ();\n   diagnostic_show_locus (&dc, &richloc, DK_ERROR);\n-  ASSERT_STREQ (\"\\n\"\n-\t\t\" \\xf0\\x9f\\x98\\x82\"\n+  ASSERT_STREQ (\" \\xf0\\x9f\\x98\\x82\"\n \t\t   \"_foo = \\xcf\\x80\"\n \t\t\t   \"_bar.\\xf0\\x9f\\x98\\x82\"\n \t\t\t\t  \"_field\\xcf\\x80\"\n@@ -3562,8 +3528,7 @@ test_one_liner_fixit_replace_utf8 ()\n   rich_location richloc (line_table, field);\n   richloc.add_fixit_replace (\"m_\\xf0\\x9f\\x98\\x82_field\\xcf\\x80\");\n   diagnostic_show_locus (&dc, &richloc, DK_ERROR);\n-  ASSERT_STREQ (\"\\n\"\n-\t\t\" \\xf0\\x9f\\x98\\x82\"\n+  ASSERT_STREQ (\" \\xf0\\x9f\\x98\\x82\"\n \t\t   \"_foo = \\xcf\\x80\"\n \t\t\t   \"_bar.\\xf0\\x9f\\x98\\x82\"\n \t\t\t\t  \"_field\\xcf\\x80\"\n@@ -3592,8 +3557,7 @@ test_one_liner_fixit_replace_non_equal_range_utf8 ()\n   diagnostic_show_locus (&dc, &richloc, DK_ERROR);\n   /* The replacement range is not indicated in the annotation line, so\n      it should be indicated via an additional underline.  */\n-  ASSERT_STREQ (\"\\n\"\n-\t\t\" \\xf0\\x9f\\x98\\x82\"\n+  ASSERT_STREQ (\" \\xf0\\x9f\\x98\\x82\"\n \t\t   \"_foo = \\xcf\\x80\"\n \t\t\t   \"_bar.\\xf0\\x9f\\x98\\x82\"\n \t\t\t\t  \"_field\\xcf\\x80\"\n@@ -3623,8 +3587,7 @@ test_one_liner_fixit_replace_equal_secondary_range_utf8 ()\n   diagnostic_show_locus (&dc, &richloc, DK_ERROR);\n   /* The replacement range is indicated in the annotation line,\n      so it shouldn't be indicated via an additional underline.  */\n-  ASSERT_STREQ (\"\\n\"\n-\t\t\" \\xf0\\x9f\\x98\\x82\"\n+  ASSERT_STREQ (\" \\xf0\\x9f\\x98\\x82\"\n \t\t   \"_foo = \\xcf\\x80\"\n \t\t\t   \"_bar.\\xf0\\x9f\\x98\\x82\"\n \t\t\t\t  \"_field\\xcf\\x80\"\n@@ -3662,8 +3625,7 @@ test_one_liner_fixit_validation_adhoc_locations_utf8 ()\n \n     test_diagnostic_context dc;\n     diagnostic_show_locus (&dc, &richloc, DK_ERROR);\n-    ASSERT_STREQ (\"\\n\"\n-\t\t  \" \\xf0\\x9f\\x98\\x82\"\n+    ASSERT_STREQ (\" \\xf0\\x9f\\x98\\x82\"\n \t\t     \"_foo = \\xcf\\x80\"\n \t\t\t     \"_bar.\\xf0\\x9f\\x98\\x82\"\n \t\t\t\t    \"_field\\xcf\\x80\"\n@@ -3683,8 +3645,7 @@ test_one_liner_fixit_validation_adhoc_locations_utf8 ()\n \n     test_diagnostic_context dc;\n     diagnostic_show_locus (&dc, &richloc, DK_ERROR);\n-    ASSERT_STREQ (\"\\n\"\n-\t\t  \" \\xf0\\x9f\\x98\\x82\"\n+    ASSERT_STREQ (\" \\xf0\\x9f\\x98\\x82\"\n \t\t     \"_foo = \\xcf\\x80\"\n \t\t\t     \"_bar.\\xf0\\x9f\\x98\\x82\"\n \t\t\t\t    \"_field\\xcf\\x80\"\n@@ -3704,8 +3665,7 @@ test_one_liner_fixit_validation_adhoc_locations_utf8 ()\n \n     test_diagnostic_context dc;\n     diagnostic_show_locus (&dc, &richloc, DK_ERROR);\n-    ASSERT_STREQ (\"\\n\"\n-\t\t  \" \\xf0\\x9f\\x98\\x82\"\n+    ASSERT_STREQ (\" \\xf0\\x9f\\x98\\x82\"\n \t\t     \"_foo = \\xcf\\x80\"\n \t\t\t     \"_bar.\\xf0\\x9f\\x98\\x82\"\n \t\t\t\t    \"_field\\xcf\\x80\"\n@@ -3728,8 +3688,7 @@ test_one_liner_many_fixits_1_utf8 ()\n     richloc.add_fixit_insert_before (i & 1 ? \"@\" : \"\\xcf\\x80\");\n   ASSERT_EQ (1, richloc.get_num_fixit_hints ());\n   diagnostic_show_locus (&dc, &richloc, DK_ERROR);\n-  ASSERT_STREQ (\"\\n\"\n-\t\t\" \\xf0\\x9f\\x98\\x82\"\n+  ASSERT_STREQ (\" \\xf0\\x9f\\x98\\x82\"\n \t\t   \"_foo = \\xcf\\x80\"\n \t\t\t   \"_bar.\\xf0\\x9f\\x98\\x82\"\n \t\t\t\t  \"_field\\xcf\\x80\"\n@@ -3760,8 +3719,7 @@ test_one_liner_many_fixits_2_utf8 ()\n \n   ASSERT_EQ (nlocs, richloc.get_num_fixit_hints ());\n   diagnostic_show_locus (&dc, &richloc, DK_ERROR);\n-  ASSERT_STREQ (\"\\n\"\n-\t\t\" \\xf0\\x9f\\x98\\x82\"\n+  ASSERT_STREQ (\" \\xf0\\x9f\\x98\\x82\"\n \t\t   \"_foo = \\xcf\\x80\"\n \t\t\t   \"_bar.\\xf0\\x9f\\x98\\x82\"\n \t\t\t\t  \"_field\\xcf\\x80\"\n@@ -3811,8 +3769,7 @@ test_one_liner_labels_utf8 ()\n     {\n       test_diagnostic_context dc;\n       diagnostic_show_locus (&dc, &richloc, DK_ERROR);\n-      ASSERT_STREQ (\"\\n\"\n-\t\t    \" \\xf0\\x9f\\x98\\x82\"\n+      ASSERT_STREQ (\" \\xf0\\x9f\\x98\\x82\"\n \t\t       \"_foo = \\xcf\\x80\"\n \t\t\t       \"_bar.\\xf0\\x9f\\x98\\x82\"\n \t\t\t\t      \"_field\\xcf\\x80\"\n@@ -3840,8 +3797,7 @@ test_one_liner_labels_utf8 ()\n     test_diagnostic_context dc;\n     diagnostic_show_locus (&dc, &richloc, DK_ERROR);\n \n-    ASSERT_STREQ (\"\\n\"\n-\t\t  \" \\xf0\\x9f\\x98\\x82\"\n+    ASSERT_STREQ (\" \\xf0\\x9f\\x98\\x82\"\n \t\t     \"_foo = \\xcf\\x80\"\n \t\t\t     \"_bar.\\xf0\\x9f\\x98\\x82\"\n \t\t\t\t    \"_field\\xcf\\x80\"\n@@ -3866,8 +3822,7 @@ test_one_liner_labels_utf8 ()\n \n     test_diagnostic_context dc;\n     diagnostic_show_locus (&dc, &richloc, DK_ERROR);\n-    ASSERT_STREQ (\"\\n\"\n-\t\t  \" \\xf0\\x9f\\x98\\x82\"\n+    ASSERT_STREQ (\" \\xf0\\x9f\\x98\\x82\"\n \t\t     \"_foo = \\xcf\\x80\"\n \t\t\t     \"_bar.\\xf0\\x9f\\x98\\x82\"\n \t\t\t\t    \"_field\\xcf\\x80\"\n@@ -3973,8 +3928,7 @@ test_add_location_if_nearby (const line_table_case &case_)\n     ASSERT_EQ (2, richloc.get_num_locations ());\n     test_diagnostic_context dc;\n     diagnostic_show_locus (&dc, &richloc, DK_ERROR);\n-    ASSERT_STREQ (\"\\n\"\n-\t\t  \" struct same_line { double x; double y; ;\\n\"\n+    ASSERT_STREQ (\" struct same_line { double x; double y; ;\\n\"\n \t\t  \"                  ~                    ^\\n\",\n \t\t  pp_formatted_text (dc.printer));\n   }\n@@ -4038,8 +3992,7 @@ test_diagnostic_show_locus_fixit_lines (const line_table_case &case_)\n     richloc.add_fixit_insert_before (x, \".\");\n     richloc.add_fixit_replace (colon, \"=\");\n     diagnostic_show_locus (&dc, &richloc, DK_ERROR);\n-    ASSERT_STREQ (\"\\n\"\n-\t\t  \" struct point origin = {x: 0.0,\\n\"\n+    ASSERT_STREQ (\" struct point origin = {x: 0.0,\\n\"\n \t\t  \"                         ^\\n\"\n \t\t  \"                        .=\\n\",\n \t\t  pp_formatted_text (dc.printer));\n@@ -4059,8 +4012,7 @@ test_diagnostic_show_locus_fixit_lines (const line_table_case &case_)\n     richloc.add_fixit_insert_before (y, \".\");\n     richloc.add_fixit_replace (colon, \"=\");\n     diagnostic_show_locus (&dc, &richloc, DK_ERROR);\n-    ASSERT_STREQ (\"\\n\"\n-\t\t  \"FILENAME:3:24:\\n\"\n+    ASSERT_STREQ (\"FILENAME:3:24:\\n\"\n \t\t  \"                        y\\n\"\n \t\t  \"                        .\\n\"\n \t\t  \"FILENAME:6:25:\\n\"\n@@ -4083,8 +4035,7 @@ test_diagnostic_show_locus_fixit_lines (const line_table_case &case_)\n     test_diagnostic_context dc;\n     dc.show_line_numbers_p = true;\n     diagnostic_show_locus (&dc, &richloc, DK_ERROR);\n-    ASSERT_STREQ (\"\\n\"\n-\t\t  \"    3 |                        y\\n\"\n+    ASSERT_STREQ (\"    3 |                        y\\n\"\n \t\t  \"      |                        .\\n\"\n \t\t  \"......\\n\"\n \t\t  \"    6 |                         : 0.0};\\n\"\n@@ -4294,8 +4245,7 @@ test_overlapped_fixit_printing (const line_table_case &case_)\n     richloc.add_fixit_insert_after (\")\");\n \n     diagnostic_show_locus (&dc, &richloc, DK_ERROR);\n-    ASSERT_STREQ (\"\\n\"\n-\t\t  \"   foo *f = (foo *)ptr->field;\\n\"\n+    ASSERT_STREQ (\"   foo *f = (foo *)ptr->field;\\n\"\n \t\t  \"                   ^~~~~~~~~~\\n\"\n \t\t  \"            -----------------\\n\"\n \t\t  \"            const_cast<foo *> (ptr->field)\\n\",\n@@ -4361,8 +4311,7 @@ test_overlapped_fixit_printing (const line_table_case &case_)\n     richloc.add_fixit_insert_after (\")\");\n \n     diagnostic_show_locus (&dc, &richloc, DK_ERROR);\n-    ASSERT_STREQ (\"\\n\"\n-\t\t  \"   foo *f = (foo *)ptr->field;\\n\"\n+    ASSERT_STREQ (\"   foo *f = (foo *)ptr->field;\\n\"\n \t\t  \"                   ^~~~~~~~~~\\n\"\n \t\t  \"            -\\n\"\n \t\t  \"            CAST (-\\n\"\n@@ -4379,8 +4328,7 @@ test_overlapped_fixit_printing (const line_table_case &case_)\n     richloc.add_fixit_insert_after (\")\");\n \n     diagnostic_show_locus (&dc, &richloc, DK_ERROR);\n-    ASSERT_STREQ (\"\\n\"\n-\t\t  \"   foo *f = (foo *)ptr->field;\\n\"\n+    ASSERT_STREQ (\"   foo *f = (foo *)ptr->field;\\n\"\n \t\t  \"                   ^~~~~~~~~~\\n\"\n \t\t  \"            -\\n\"\n \t\t  \"            CST ( -\\n\"\n@@ -4401,8 +4349,7 @@ test_overlapped_fixit_printing (const line_table_case &case_)\n     ASSERT_EQ (1, richloc.get_num_fixit_hints ());\n \n     diagnostic_show_locus (&dc, &richloc, DK_ERROR);\n-    ASSERT_STREQ (\"\\n\"\n-\t\t  \"   foo *f = (foo *)ptr->field;\\n\"\n+    ASSERT_STREQ (\"   foo *f = (foo *)ptr->field;\\n\"\n \t\t  \"                   ^~~~~~~~~~\\n\"\n \t\t  \"            -------\\n\"\n \t\t  \"            (bar *)\\n\",\n@@ -4422,8 +4369,7 @@ test_overlapped_fixit_printing (const line_table_case &case_)\n \n     /* But the corrections are.  */\n     diagnostic_show_locus (&dc, &richloc, DK_ERROR);\n-    ASSERT_STREQ (\"\\n\"\n-\t\t  \"   foo *f = (foo *)ptr->field;\\n\"\n+    ASSERT_STREQ (\"   foo *f = (foo *)ptr->field;\\n\"\n \t\t  \"                   ^~~~~~~~~~\\n\"\n \t\t  \"            -----------------\\n\"\n \t\t  \"            (longer *)(foo *)\\n\",\n@@ -4441,8 +4387,7 @@ test_overlapped_fixit_printing (const line_table_case &case_)\n        it would overlap with the second.\n        Verify that they are printed as a single replacement.  */\n     diagnostic_show_locus (&dc, &richloc, DK_ERROR);\n-    ASSERT_STREQ (\"\\n\"\n-\t\t  \"   foo *f = (foo *)ptr->field;\\n\"\n+    ASSERT_STREQ (\"   foo *f = (foo *)ptr->field;\\n\"\n \t\t  \"                   ^~~~~~~~~~\\n\"\n \t\t  \"            -------\\n\"\n \t\t  \"            LONGER THAN THE CAST(foo *)TEST\\n\",\n@@ -4507,8 +4452,7 @@ test_overlapped_fixit_printing_utf8 (const line_table_case &case_)\n     richloc.add_fixit_insert_after (\")\");\n \n     diagnostic_show_locus (&dc, &richloc, DK_ERROR);\n-    ASSERT_STREQ (\"\\n\"\n-\t\t  \"   f\\xf0\\x9f\\x98\\x82\"\n+    ASSERT_STREQ (\"   f\\xf0\\x9f\\x98\\x82\"\n \t\t\t\" *f = (f\\xf0\\x9f\\x98\\x82\"\n \t\t\t\t  \" *)ptr->field\\xcf\\x80\"\n \t\t\t\t\t\t\";\\n\"\n@@ -4580,8 +4524,7 @@ test_overlapped_fixit_printing_utf8 (const line_table_case &case_)\n     richloc.add_fixit_insert_after (\")\");\n \n     diagnostic_show_locus (&dc, &richloc, DK_ERROR);\n-    ASSERT_STREQ (\"\\n\"\n-\t\t  \"   f\\xf0\\x9f\\x98\\x82\"\n+    ASSERT_STREQ (\"   f\\xf0\\x9f\\x98\\x82\"\n \t\t\t\" *f = (f\\xf0\\x9f\\x98\\x82\"\n \t\t\t\t  \" *)ptr->field\\xcf\\x80\"\n \t\t\t\t\t\t\";\\n\"\n@@ -4601,8 +4544,7 @@ test_overlapped_fixit_printing_utf8 (const line_table_case &case_)\n     richloc.add_fixit_insert_after (\")\");\n \n     diagnostic_show_locus (&dc, &richloc, DK_ERROR);\n-    ASSERT_STREQ (\"\\n\"\n-\t\t  \"   f\\xf0\\x9f\\x98\\x82\"\n+    ASSERT_STREQ (\"   f\\xf0\\x9f\\x98\\x82\"\n \t\t\t\" *f = (f\\xf0\\x9f\\x98\\x82\"\n \t\t\t\t  \" *)ptr->field\\xcf\\x80\"\n \t\t\t\t\t\t\";\\n\"\n@@ -4626,8 +4568,7 @@ test_overlapped_fixit_printing_utf8 (const line_table_case &case_)\n     ASSERT_EQ (1, richloc.get_num_fixit_hints ());\n \n     diagnostic_show_locus (&dc, &richloc, DK_ERROR);\n-    ASSERT_STREQ (\"\\n\"\n-\t\t  \"   f\\xf0\\x9f\\x98\\x82\"\n+    ASSERT_STREQ (\"   f\\xf0\\x9f\\x98\\x82\"\n \t\t\t\" *f = (f\\xf0\\x9f\\x98\\x82\"\n \t\t\t\t  \" *)ptr->field\\xcf\\x80\"\n \t\t\t\t\t\t\";\\n\"\n@@ -4651,8 +4592,7 @@ test_overlapped_fixit_printing_utf8 (const line_table_case &case_)\n \n     /* But the corrections are.  */\n     diagnostic_show_locus (&dc, &richloc, DK_ERROR);\n-    ASSERT_STREQ (\"\\n\"\n-\t\t  \"   f\\xf0\\x9f\\x98\\x82\"\n+    ASSERT_STREQ (\"   f\\xf0\\x9f\\x98\\x82\"\n \t\t\t\" *f = (f\\xf0\\x9f\\x98\\x82\"\n \t\t\t\t  \" *)ptr->field\\xcf\\x80\"\n \t\t\t\t\t\t\";\\n\"\n@@ -4676,8 +4616,7 @@ test_overlapped_fixit_printing_utf8 (const line_table_case &case_)\n        it would overlap with the second.\n        Verify that they are printed as a single replacement.  */\n     diagnostic_show_locus (&dc, &richloc, DK_ERROR);\n-    ASSERT_STREQ (\"\\n\"\n-\t\t  \"   f\\xf0\\x9f\\x98\\x82\"\n+    ASSERT_STREQ (\"   f\\xf0\\x9f\\x98\\x82\"\n \t\t\t\" *f = (f\\xf0\\x9f\\x98\\x82\"\n \t\t\t\t  \" *)ptr->field\\xcf\\x80\"\n \t\t\t\t\t\t\";\\n\"\n@@ -4748,8 +4687,7 @@ test_overlapped_fixit_printing_2 (const line_table_case &case_)\n     /* Verify that they're printed correctly.  */\n     test_diagnostic_context dc;\n     diagnostic_show_locus (&dc, &richloc, DK_ERROR);\n-    ASSERT_STREQ (\"\\n\"\n-\t\t  \" int a5[][0][0] = { 1, 2 };\\n\"\n+    ASSERT_STREQ (\" int a5[][0][0] = { 1, 2 };\\n\"\n \t\t  \"                    ^\\n\"\n \t\t  \"                     } {\\n\",\n \t\t  pp_formatted_text (dc.printer));\n@@ -4771,8 +4709,7 @@ test_overlapped_fixit_printing_2 (const line_table_case &case_)\n     richloc.add_fixit_insert_before (col_1, \"{\");\n     richloc.add_fixit_insert_before (col_25, \"}\");\n     diagnostic_show_locus (&dc, &richloc, DK_ERROR);\n-    ASSERT_STREQ (\"\\n\"\n-\t\t  \" int a5[][0][0] = { 1, 2 };\\n\"\n+    ASSERT_STREQ (\" int a5[][0][0] = { 1, 2 };\\n\"\n \t\t  \"                    ^\\n\"\n \t\t  \" {                  -----\\n\"\n \t\t  \"                    {{1}}}}, {{{2 }}\\n\",\n@@ -4815,8 +4752,7 @@ test_fixit_insert_containing_newline (const line_table_case &case_)\n     {\n       test_diagnostic_context dc;\n       diagnostic_show_locus (&dc, &richloc, DK_ERROR);\n-      ASSERT_STREQ (\"\\n\"\n-\t\t    \"       x = a;\\n\"\n+      ASSERT_STREQ (\"       x = a;\\n\"\n \t\t    \"+      break;\\n\"\n \t\t    \"     case 'b':\\n\"\n \t\t    \"     ^~~~~~~~~\\n\",\n@@ -4828,8 +4764,7 @@ test_fixit_insert_containing_newline (const line_table_case &case_)\n       test_diagnostic_context dc;\n       dc.show_line_numbers_p = true;\n       diagnostic_show_locus (&dc, &richloc, DK_ERROR);\n-      ASSERT_STREQ (\"\\n\"\n-\t\t    \"    2 |       x = a;\\n\"\n+      ASSERT_STREQ (\"    2 |       x = a;\\n\"\n \t\t    \"  +++ |+      break;\\n\"\n \t\t    \"    3 |     case 'b':\\n\"\n \t\t    \"      |     ^~~~~~~~~\\n\",\n@@ -4845,8 +4780,7 @@ test_fixit_insert_containing_newline (const line_table_case &case_)\n     ASSERT_TRUE (richloc.seen_impossible_fixit_p ());\n     test_diagnostic_context dc;\n     diagnostic_show_locus (&dc, &richloc, DK_ERROR);\n-    ASSERT_STREQ (\"\\n\"\n-\t\t  \"     case 'b':\\n\"\n+    ASSERT_STREQ (\"     case 'b':\\n\"\n \t\t  \"     ^~~~~~~~~\\n\",\n \t\t  pp_formatted_text (dc.printer));\n   }\n@@ -4894,8 +4828,7 @@ test_fixit_insert_containing_newline_2 (const line_table_case &case_)\n   {\n     test_diagnostic_context dc;\n     diagnostic_show_locus (&dc, &richloc, DK_ERROR);\n-    ASSERT_STREQ (\"\\n\"\n-\t\t  \"FILENAME:1:1:\\n\"\n+    ASSERT_STREQ (\"FILENAME:1:1:\\n\"\n \t\t  \"+#include <stdio.h>\\n\"\n \t\t  \" test (int ch)\\n\"\n \t\t  \"FILENAME:3:2:\\n\"\n@@ -4910,8 +4843,7 @@ test_fixit_insert_containing_newline_2 (const line_table_case &case_)\n     test_diagnostic_context dc;\n     dc.show_line_numbers_p = true;\n     diagnostic_show_locus (&dc, &richloc, DK_ERROR);\n-    ASSERT_STREQ (\"\\n\"\n-\t\t  \"  +++ |+#include <stdio.h>\\n\"\n+    ASSERT_STREQ (\"  +++ |+#include <stdio.h>\\n\"\n \t\t  \"    1 | test (int ch)\\n\"\n \t\t  \"    2 | {\\n\"\n \t\t  \"    3 |  putchar (ch);\\n\"\n@@ -4954,8 +4886,7 @@ test_fixit_replace_containing_newline (const line_table_case &case_)\n \n   test_diagnostic_context dc;\n   diagnostic_show_locus (&dc, &richloc, DK_ERROR);\n-  ASSERT_STREQ (\"\\n\"\n-\t\t\" foo = bar ();\\n\"\n+  ASSERT_STREQ (\" foo = bar ();\\n\"\n \t\t\"             ^\\n\",\n \t\tpp_formatted_text (dc.printer));\n }\n@@ -4999,8 +4930,7 @@ test_fixit_deletion_affecting_newline (const line_table_case &case_)\n \n   test_diagnostic_context dc;\n   diagnostic_show_locus (&dc, &richloc, DK_ERROR);\n-  ASSERT_STREQ (\"\\n\"\n-\t\t\" foo = bar (\\n\"\n+  ASSERT_STREQ (\" foo = bar (\\n\"\n \t\t\"          ~^\\n\"\n \t\t\"       );\\n\"\n \t\t\"       ~    \\n\",\n@@ -5043,8 +4973,7 @@ test_line_numbers_multiline_range ()\n   dc.min_margin_width = 0;\n   gcc_rich_location richloc (loc);\n   diagnostic_show_locus (&dc, &richloc, DK_ERROR);\n-  ASSERT_STREQ (\"\\n\"\n-\t\t\" 9 | this is line 9\\n\"\n+  ASSERT_STREQ (\" 9 | this is line 9\\n\"\n \t\t\"   |         ~~~~~~\\n\"\n \t\t\"10 | this is line 10\\n\"\n \t\t\"   | ~~~~~^~~~~~~~~~\\n\""}, {"sha": "d6604e6fd41e36239d0fd4c0be3538934aa3b9e4", "filename": "gcc/diagnostic.c", "status": "modified", "additions": 2, "deletions": 0, "changes": 2, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/d3e28653fa2cd9ad8d5c6acb4bd182bd473c0995/gcc%2Fdiagnostic.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/d3e28653fa2cd9ad8d5c6acb4bd182bd473c0995/gcc%2Fdiagnostic.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fdiagnostic.c?ref=d3e28653fa2cd9ad8d5c6acb4bd182bd473c0995", "patch": "@@ -679,6 +679,7 @@ default_diagnostic_finalizer (diagnostic_context *context,\n {\n   char *saved_prefix = pp_take_prefix (context->printer);\n   pp_set_prefix (context->printer, NULL);\n+  pp_newline (context->printer);\n   diagnostic_show_locus (context, diagnostic->richloc, diagnostic->kind);\n   pp_set_prefix (context->printer, saved_prefix);\n   pp_flush (context->printer);\n@@ -1173,6 +1174,7 @@ diagnostic_append_note (diagnostic_context *context,\n   pp_output_formatted_text (context->printer);\n   pp_destroy_prefix (context->printer);\n   pp_set_prefix (context->printer, saved_prefix);\n+  pp_newline (context->printer);\n   diagnostic_show_locus (context, &richloc, DK_NOTE);\n   va_end (ap);\n }"}, {"sha": "bbc00aec2bc4c1c56672ed03647dd9c72f5154d3", "filename": "gcc/fortran/ChangeLog", "status": "modified", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/d3e28653fa2cd9ad8d5c6acb4bd182bd473c0995/gcc%2Ffortran%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/d3e28653fa2cd9ad8d5c6acb4bd182bd473c0995/gcc%2Ffortran%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ffortran%2FChangeLog?ref=d3e28653fa2cd9ad8d5c6acb4bd182bd473c0995", "patch": "@@ -1,3 +1,8 @@\n+2019-12-09  David Malcolm  <dmalcolm@redhat.com>\n+\n+\t* error.c (gfc_diagnostic_starter): Add pp_newline call before\n+\tcall to diagnostic_show_locus.\n+\n 2019-12-09  Frederik Harwath  <frederik@codesourcery.com>\n \n \t* trans-openmp.c (gfc_trans_omp_reduction_list): Pass correct location for each"}, {"sha": "03de73ecb35156245a9d73452240f8304ac81696", "filename": "gcc/fortran/error.c", "status": "modified", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/d3e28653fa2cd9ad8d5c6acb4bd182bd473c0995/gcc%2Ffortran%2Ferror.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/d3e28653fa2cd9ad8d5c6acb4bd182bd473c0995/gcc%2Ffortran%2Ferror.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ffortran%2Ferror.c?ref=d3e28653fa2cd9ad8d5c6acb4bd182bd473c0995", "patch": "@@ -1147,6 +1147,7 @@ gfc_diagnostic_starter (diagnostic_context *context,\n       /* Fortran uses an empty line between locus and caret line.  */\n       pp_newline (context->printer);\n       pp_set_prefix (context->printer, NULL);\n+      pp_newline (context->printer);\n       diagnostic_show_locus (context, diagnostic->richloc, diagnostic->kind);\n       /* If the caret line was shown, the prefix does not contain the\n \t locus.  */"}, {"sha": "2f6f7afe01471deda1e35502d9c3e33618757f6d", "filename": "gcc/testsuite/ChangeLog", "status": "modified", "additions": 6, "deletions": 0, "changes": 6, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/d3e28653fa2cd9ad8d5c6acb4bd182bd473c0995/gcc%2Ftestsuite%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/d3e28653fa2cd9ad8d5c6acb4bd182bd473c0995/gcc%2Ftestsuite%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2FChangeLog?ref=d3e28653fa2cd9ad8d5c6acb4bd182bd473c0995", "patch": "@@ -1,3 +1,9 @@\n+2019-12-09  David Malcolm  <dmalcolm@redhat.com>\n+\n+\t* gcc.dg/plugin/diagnostic_plugin_test_show_locus.c\n+\t(custom_diagnostic_finalizer): Add pp_newline call before call to\n+\tdiagnostic_show_locus.\n+\n 2019-12-09  Paolo Carlini  <paolo.carlini@oracle.com>\n \n \t* c-c++-common/Wcast-align.c: Check location(s) too."}, {"sha": "482dbda47f73c4230f185b717dd1eea33145f616", "filename": "gcc/testsuite/gcc.dg/plugin/diagnostic_plugin_test_show_locus.c", "status": "modified", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/d3e28653fa2cd9ad8d5c6acb4bd182bd473c0995/gcc%2Ftestsuite%2Fgcc.dg%2Fplugin%2Fdiagnostic_plugin_test_show_locus.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/d3e28653fa2cd9ad8d5c6acb4bd182bd473c0995/gcc%2Ftestsuite%2Fgcc.dg%2Fplugin%2Fdiagnostic_plugin_test_show_locus.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgcc.dg%2Fplugin%2Fdiagnostic_plugin_test_show_locus.c?ref=d3e28653fa2cd9ad8d5c6acb4bd182bd473c0995", "patch": "@@ -137,6 +137,7 @@ custom_diagnostic_finalizer (diagnostic_context *context,\n     pp_show_color (context->printer) = true;\n   char *saved_prefix = pp_take_prefix (context->printer);\n   pp_set_prefix (context->printer, NULL);\n+  pp_newline (context->printer);\n   diagnostic_show_locus (context, diagnostic->richloc, diagnostic->kind);\n   pp_show_color (context->printer) = old_show_color;\n   pp_set_prefix (context->printer, saved_prefix);"}]}