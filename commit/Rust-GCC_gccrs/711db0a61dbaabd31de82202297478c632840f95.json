{"sha": "711db0a61dbaabd31de82202297478c632840f95", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6NzExZGIwYTYxZGJhYWJkMzFkZTgyMjAyMjk3NDc4YzYzMjg0MGY5NQ==", "commit": {"author": {"name": "Tobias Burnus", "email": "burnus@net-b.de", "date": "2013-02-15T11:17:15Z"}, "committer": {"name": "Tobias Burnus", "email": "burnus@gcc.gnu.org", "date": "2013-02-15T11:17:15Z"}, "message": "re PR fortran/56318 (Wrong result with MATMUL of PARAMETER)\n\n2013-02-14  Tobias Burnus  <burnus@net-b.de>\n            Mikael Morin  <mikael@gcc.gnu.org>\n\n        PR fortran/56318\n        * simplify.c (gfc_simplify_matmul): Fix result shape\n        and matmul result.\n\n2013-02-14  Tobias Burnus  <burnus@net-b.de>\n\n        PR fortran/56318\n        * gcc/testsuite/gfortran.dg/matmul_9.f90: New.\n\n\nCo-Authored-By: Mikael Morin <mikael@gcc.gnu.org>\n\nFrom-SVN: r196075", "tree": {"sha": "ecc932de0bafe7b1f00422f0e108c4cbfc651409", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/ecc932de0bafe7b1f00422f0e108c4cbfc651409"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/711db0a61dbaabd31de82202297478c632840f95", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/711db0a61dbaabd31de82202297478c632840f95", "html_url": "https://github.com/Rust-GCC/gccrs/commit/711db0a61dbaabd31de82202297478c632840f95", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/711db0a61dbaabd31de82202297478c632840f95/comments", "author": {"login": "tob2", "id": 264461, "node_id": "MDQ6VXNlcjI2NDQ2MQ==", "avatar_url": "https://avatars.githubusercontent.com/u/264461?v=4", "gravatar_id": "", "url": "https://api.github.com/users/tob2", "html_url": "https://github.com/tob2", "followers_url": "https://api.github.com/users/tob2/followers", "following_url": "https://api.github.com/users/tob2/following{/other_user}", "gists_url": "https://api.github.com/users/tob2/gists{/gist_id}", "starred_url": "https://api.github.com/users/tob2/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/tob2/subscriptions", "organizations_url": "https://api.github.com/users/tob2/orgs", "repos_url": "https://api.github.com/users/tob2/repos", "events_url": "https://api.github.com/users/tob2/events{/privacy}", "received_events_url": "https://api.github.com/users/tob2/received_events", "type": "User", "site_admin": false}, "committer": null, "parents": [{"sha": "3fb7c69995f85f8efde91a03a26acf49d35351f8", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/3fb7c69995f85f8efde91a03a26acf49d35351f8", "html_url": "https://github.com/Rust-GCC/gccrs/commit/3fb7c69995f85f8efde91a03a26acf49d35351f8"}], "stats": {"total": 65, "additions": 62, "deletions": 3}, "files": [{"sha": "277ad3ef5957603e97f7410d85b717cb95aa7dca", "filename": "gcc/fortran/ChangeLog", "status": "modified", "additions": 7, "deletions": 0, "changes": 7, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/711db0a61dbaabd31de82202297478c632840f95/gcc%2Ffortran%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/711db0a61dbaabd31de82202297478c632840f95/gcc%2Ffortran%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ffortran%2FChangeLog?ref=711db0a61dbaabd31de82202297478c632840f95", "patch": "@@ -1,3 +1,10 @@\n+2013-02-15  Tobias Burnus  <burnus@net-b.de>\n+\t    Mikael Morin  <mikael@gcc.gnu.org>\n+\n+\tPR fortran/56318\n+\t* simplify.c (gfc_simplify_matmul): Fix result shape\n+\tand matmul result.\n+\n 2013-02-15  Tobias Burnus  <burnus@net-b.de>\n \n \tPR fortran/53818"}, {"sha": "a0909a38349a7ccd7b7d288c45a19331917eaa7c", "filename": "gcc/fortran/simplify.c", "status": "modified", "additions": 3, "deletions": 3, "changes": 6, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/711db0a61dbaabd31de82202297478c632840f95/gcc%2Ffortran%2Fsimplify.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/711db0a61dbaabd31de82202297478c632840f95/gcc%2Ffortran%2Fsimplify.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ffortran%2Fsimplify.c?ref=711db0a61dbaabd31de82202297478c632840f95", "patch": "@@ -3850,7 +3850,7 @@ gfc_simplify_matmul (gfc_expr *matrix_a, gfc_expr *matrix_b)\n   if (matrix_a->rank == 1 && matrix_b->rank == 2)\n     {\n       result_rows = 1;\n-      result_columns = mpz_get_si (matrix_b->shape[0]);\n+      result_columns = mpz_get_si (matrix_b->shape[1]);\n       stride_a = 1;\n       stride_b = mpz_get_si (matrix_b->shape[0]);\n \n@@ -3860,7 +3860,7 @@ gfc_simplify_matmul (gfc_expr *matrix_a, gfc_expr *matrix_b)\n     }\n   else if (matrix_a->rank == 2 && matrix_b->rank == 1)\n     {\n-      result_rows = mpz_get_si (matrix_b->shape[0]);\n+      result_rows = mpz_get_si (matrix_a->shape[0]);\n       result_columns = 1;\n       stride_a = mpz_get_si (matrix_a->shape[0]);\n       stride_b = 1;\n@@ -3873,7 +3873,7 @@ gfc_simplify_matmul (gfc_expr *matrix_a, gfc_expr *matrix_b)\n     {\n       result_rows = mpz_get_si (matrix_a->shape[0]);\n       result_columns = mpz_get_si (matrix_b->shape[1]);\n-      stride_a = mpz_get_si (matrix_a->shape[1]);\n+      stride_a = mpz_get_si (matrix_a->shape[0]);\n       stride_b = mpz_get_si (matrix_b->shape[0]);\n \n       result->rank = 2;"}, {"sha": "5d1726f0e89d50e53b6a6658a2b08f06e20b5f11", "filename": "gcc/testsuite/ChangeLog", "status": "modified", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/711db0a61dbaabd31de82202297478c632840f95/gcc%2Ftestsuite%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/711db0a61dbaabd31de82202297478c632840f95/gcc%2Ftestsuite%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2FChangeLog?ref=711db0a61dbaabd31de82202297478c632840f95", "patch": "@@ -1,3 +1,8 @@\n+2013-02-15  Tobias Burnus  <burnus@net-b.de>\n+\n+\tPR fortran/56318\n+\t* gcc/testsuite/gfortran.dg/matmul_9.f90: New.\n+\n 2013-02-15  Tobias Burnus  <burnus@net-b.de>\n \n \tPR fortran/53818"}, {"sha": "bf2a299c82110075d0c0f1cf922381f48baebcc6", "filename": "gcc/testsuite/gfortran.dg/matmul_9.f90", "status": "added", "additions": 47, "deletions": 0, "changes": 47, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/711db0a61dbaabd31de82202297478c632840f95/gcc%2Ftestsuite%2Fgfortran.dg%2Fmatmul_9.f90", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/711db0a61dbaabd31de82202297478c632840f95/gcc%2Ftestsuite%2Fgfortran.dg%2Fmatmul_9.f90", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgfortran.dg%2Fmatmul_9.f90?ref=711db0a61dbaabd31de82202297478c632840f95", "patch": "@@ -0,0 +1,47 @@\n+! { dg-do run }\n+! { dg-options \"-fdump-tree-original\" }\n+!\n+! PR fortran/56318\n+!\n+! Contributed by Alberto Luaces\n+!\n+SUBROUTINE mass_matrix        \n+  DOUBLE PRECISION,PARAMETER::m1=1.d0\n+  DOUBLE PRECISION,DIMENSION(3,2),PARAMETER::A1=reshape([1.d0,0.d0, 0.d0, &\n+       0.d0,1.d0, 0.d0],[3,2])\n+  DOUBLE PRECISION,DIMENSION(2,2),PARAMETER::Mel=reshape([1.d0/3.d0, 0.d0, &\n+       0.d0, 1.d0/3.d0],[2,2])\n+\n+  DOUBLE PRECISION,DIMENSION(3,3)::MM1\n+\n+  MM1=m1*matmul(A1,matmul(Mel,transpose(A1)))\n+  !print '(3f8.3)', MM1\n+  if (any (abs (MM1 &\n+                - reshape ([1.d0/3.d0, 0.d0,      0.d0,  &\n+                            0.d0,      1.d0/3.d0, 0.d0,  &\n+                            0.d0,      0.d0,      0.d0], &\n+                           [3,3])) > epsilon(1.0d0))) &\n+    call abort ()\n+END SUBROUTINE mass_matrix\n+\n+program name\n+  implicit none\n+  integer, parameter :: A(3,2) = reshape([1,2,3,4,5,6],[3,2])\n+  integer, parameter :: B(2,3) = reshape([3,17,23,31,43,71],[2,3])\n+  integer, parameter :: C(3)   = [-5,-7,-21]\n+  integer, parameter :: m1 = 1\n+\n+!  print *, matmul(B,C)\n+   if (any (matmul(B,C) /= [-1079, -1793])) call abort()\n+!  print *, matmul(C,A)\n+   if (any (matmul(C,A) /= [-82, -181])) call abort()\n+!  print '(3i5)', m1*matmul(A,B)\n+  if (any (m1*matmul(A,B) /= reshape([71,91,111, 147,201,255, 327,441,555],&\n+                                     [3,3]))) &\n+     call abort()\n+  call mass_matrix\n+end program name\n+\n+! { dg-final { scan-tree-dump-times \"matmul\" 0 \"original\" } }\n+! { dg-final { cleanup-tree-dump \"original\" } }\n+"}]}