{"sha": "1b115daf62d94337b3d0b2962b0bbbf005a450e0", "node_id": "C_kwDOANBUbNoAKDFiMTE1ZGFmNjJkOTQzMzdiM2QwYjI5NjJiMGJiYmYwMDVhNDUwZTA", "commit": {"author": {"name": "Harald Anlauf", "email": "anlauf@gmx.de", "date": "2021-10-14T18:18:14Z"}, "committer": {"name": "Harald Anlauf", "email": "anlauf@gmx.de", "date": "2021-10-14T18:18:14Z"}, "message": "Fortran: fix order of checks for the SHAPE intrinsic\n\ngcc/fortran/ChangeLog:\n\n\tPR fortran/102716\n\t* check.c (gfc_check_shape): Reorder checks so that invalid KIND\n\targuments can be detected.\n\ngcc/testsuite/ChangeLog:\n\n\tPR fortran/102716\n\t* gfortran.dg/shape_10.f90: New test.", "tree": {"sha": "8010fbd211e85d944a268a4c98ef43b058b2b500", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/8010fbd211e85d944a268a4c98ef43b058b2b500"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/1b115daf62d94337b3d0b2962b0bbbf005a450e0", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/1b115daf62d94337b3d0b2962b0bbbf005a450e0", "html_url": "https://github.com/Rust-GCC/gccrs/commit/1b115daf62d94337b3d0b2962b0bbbf005a450e0", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/1b115daf62d94337b3d0b2962b0bbbf005a450e0/comments", "author": {"login": "harald-anlauf", "id": 90786862, "node_id": "MDQ6VXNlcjkwNzg2ODYy", "avatar_url": "https://avatars.githubusercontent.com/u/90786862?v=4", "gravatar_id": "", "url": "https://api.github.com/users/harald-anlauf", "html_url": "https://github.com/harald-anlauf", "followers_url": "https://api.github.com/users/harald-anlauf/followers", "following_url": "https://api.github.com/users/harald-anlauf/following{/other_user}", "gists_url": "https://api.github.com/users/harald-anlauf/gists{/gist_id}", "starred_url": "https://api.github.com/users/harald-anlauf/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/harald-anlauf/subscriptions", "organizations_url": "https://api.github.com/users/harald-anlauf/orgs", "repos_url": "https://api.github.com/users/harald-anlauf/repos", "events_url": "https://api.github.com/users/harald-anlauf/events{/privacy}", "received_events_url": "https://api.github.com/users/harald-anlauf/received_events", "type": "User", "site_admin": false}, "committer": {"login": "harald-anlauf", "id": 90786862, "node_id": "MDQ6VXNlcjkwNzg2ODYy", "avatar_url": "https://avatars.githubusercontent.com/u/90786862?v=4", "gravatar_id": "", "url": "https://api.github.com/users/harald-anlauf", "html_url": "https://github.com/harald-anlauf", "followers_url": "https://api.github.com/users/harald-anlauf/followers", "following_url": "https://api.github.com/users/harald-anlauf/following{/other_user}", "gists_url": "https://api.github.com/users/harald-anlauf/gists{/gist_id}", "starred_url": "https://api.github.com/users/harald-anlauf/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/harald-anlauf/subscriptions", "organizations_url": "https://api.github.com/users/harald-anlauf/orgs", "repos_url": "https://api.github.com/users/harald-anlauf/repos", "events_url": "https://api.github.com/users/harald-anlauf/events{/privacy}", "received_events_url": "https://api.github.com/users/harald-anlauf/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "f0b7d4cc49ddb1c2c7474cc3f61e260aa93a96c0", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/f0b7d4cc49ddb1c2c7474cc3f61e260aa93a96c0", "html_url": "https://github.com/Rust-GCC/gccrs/commit/f0b7d4cc49ddb1c2c7474cc3f61e260aa93a96c0"}], "stats": {"total": 20, "additions": 13, "deletions": 7}, "files": [{"sha": "cfaf9d26bbc5c72c5576b320b93baa3a5de46524", "filename": "gcc/fortran/check.c", "status": "modified", "additions": 7, "deletions": 7, "changes": 14, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/1b115daf62d94337b3d0b2962b0bbbf005a450e0/gcc%2Ffortran%2Fcheck.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/1b115daf62d94337b3d0b2962b0bbbf005a450e0/gcc%2Ffortran%2Fcheck.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ffortran%2Fcheck.c?ref=1b115daf62d94337b3d0b2962b0bbbf005a450e0", "patch": "@@ -5086,6 +5086,13 @@ gfc_check_shape (gfc_expr *source, gfc_expr *kind)\n   if (gfc_invalid_null_arg (source))\n     return false;\n \n+  if (!kind_check (kind, 1, BT_INTEGER))\n+    return false;\n+  if (kind && !gfc_notify_std (GFC_STD_F2003, \"%qs intrinsic \"\n+\t\t\t       \"with KIND argument at %L\",\n+\t\t\t       gfc_current_intrinsic, &kind->where))\n+    return false;\n+\n   if (source->rank == 0 || source->expr_type != EXPR_VARIABLE)\n     return true;\n \n@@ -5098,13 +5105,6 @@ gfc_check_shape (gfc_expr *source, gfc_expr *kind)\n       return false;\n     }\n \n-  if (!kind_check (kind, 1, BT_INTEGER))\n-    return false;\n-  if (kind && !gfc_notify_std (GFC_STD_F2003, \"%qs intrinsic \"\n-\t\t\t       \"with KIND argument at %L\",\n-\t\t\t       gfc_current_intrinsic, &kind->where))\n-    return false;\n-\n   return true;\n }\n "}, {"sha": "4943c21b1d2ef12e008137b65c35bd5264a4b136", "filename": "gcc/testsuite/gfortran.dg/shape_10.f90", "status": "added", "additions": 6, "deletions": 0, "changes": 6, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/1b115daf62d94337b3d0b2962b0bbbf005a450e0/gcc%2Ftestsuite%2Fgfortran.dg%2Fshape_10.f90", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/1b115daf62d94337b3d0b2962b0bbbf005a450e0/gcc%2Ftestsuite%2Fgfortran.dg%2Fshape_10.f90", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgfortran.dg%2Fshape_10.f90?ref=1b115daf62d94337b3d0b2962b0bbbf005a450e0", "patch": "@@ -0,0 +1,6 @@\n+! { dg-do compile }\n+! PR fortran/102716\n+\n+program p\n+  integer, parameter :: a(1) = shape([2], [1]) ! { dg-error \"must be a scalar\" }\n+end"}]}