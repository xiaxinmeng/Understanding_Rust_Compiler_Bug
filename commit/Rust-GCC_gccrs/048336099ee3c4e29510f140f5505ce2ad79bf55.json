{"sha": "048336099ee3c4e29510f140f5505ce2ad79bf55", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6MDQ4MzM2MDk5ZWUzYzRlMjk1MTBmMTQwZjU1MDVjZTJhZDc5YmY1NQ==", "commit": {"author": {"name": "Jakub Jelinek", "email": "jakub@redhat.com", "date": "2016-03-23T18:42:19Z"}, "committer": {"name": "Jakub Jelinek", "email": "jakub@gcc.gnu.org", "date": "2016-03-23T18:42:19Z"}, "message": "re PR c++/70376 (OpenMP taskloop construct fails to instantiate copy constructor(same as Bug 48869))\n\n\tPR c++/70376\n\t* cp-gimplify.c (genericize_omp_for_stmt): Don't walk OMP_FOR_CLAUSES\n\tfor OMP_TASKLOOP here.\n\t(cp_genericize_r): Handle OMP_TASKLOOP like OMP_TASK, except do call\n\tgenericize_omp_for_stmt instead of cp_walk_tree on OMP_BODY.\n\n\t* testsuite/libgomp.c++/pr70376.C: New test.\n\nFrom-SVN: r234437", "tree": {"sha": "0578dd5aac3ba224d4ec3d82bfdd70c8163acfde", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/0578dd5aac3ba224d4ec3d82bfdd70c8163acfde"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/048336099ee3c4e29510f140f5505ce2ad79bf55", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/048336099ee3c4e29510f140f5505ce2ad79bf55", "html_url": "https://github.com/Rust-GCC/gccrs/commit/048336099ee3c4e29510f140f5505ce2ad79bf55", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/048336099ee3c4e29510f140f5505ce2ad79bf55/comments", "author": {"login": "jakubjelinek", "id": 9370665, "node_id": "MDQ6VXNlcjkzNzA2NjU=", "avatar_url": "https://avatars.githubusercontent.com/u/9370665?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jakubjelinek", "html_url": "https://github.com/jakubjelinek", "followers_url": "https://api.github.com/users/jakubjelinek/followers", "following_url": "https://api.github.com/users/jakubjelinek/following{/other_user}", "gists_url": "https://api.github.com/users/jakubjelinek/gists{/gist_id}", "starred_url": "https://api.github.com/users/jakubjelinek/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jakubjelinek/subscriptions", "organizations_url": "https://api.github.com/users/jakubjelinek/orgs", "repos_url": "https://api.github.com/users/jakubjelinek/repos", "events_url": "https://api.github.com/users/jakubjelinek/events{/privacy}", "received_events_url": "https://api.github.com/users/jakubjelinek/received_events", "type": "User", "site_admin": false}, "committer": null, "parents": [{"sha": "05aca4e73c2b4b18dcf617a8548e754161a28eea", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/05aca4e73c2b4b18dcf617a8548e754161a28eea", "html_url": "https://github.com/Rust-GCC/gccrs/commit/05aca4e73c2b4b18dcf617a8548e754161a28eea"}], "stats": {"total": 48, "additions": 43, "deletions": 5}, "files": [{"sha": "8b3918bc0ca5ec5f62729bc9767daf6ccc70813f", "filename": "gcc/cp/ChangeLog", "status": "modified", "additions": 8, "deletions": 0, "changes": 8, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/048336099ee3c4e29510f140f5505ce2ad79bf55/gcc%2Fcp%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/048336099ee3c4e29510f140f5505ce2ad79bf55/gcc%2Fcp%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fcp%2FChangeLog?ref=048336099ee3c4e29510f140f5505ce2ad79bf55", "patch": "@@ -1,3 +1,11 @@\n+2016-03-23  Jakub Jelinek  <jakub@redhat.com>\n+\n+\tPR c++/70376\n+\t* cp-gimplify.c (genericize_omp_for_stmt): Don't walk OMP_FOR_CLAUSES\n+\tfor OMP_TASKLOOP here.\n+\t(cp_genericize_r): Handle OMP_TASKLOOP like OMP_TASK, except do call\n+\tgenericize_omp_for_stmt instead of cp_walk_tree on OMP_BODY.\n+\n 2016-03-23  Alexandre Oliva  <aoliva@redhat.com>\n \t    Jason Merrill  <jason@redhat.com>\n \t    Jakub Jelinek  <jakub@redhat.com>"}, {"sha": "90b3464e5de77831e348a852459dba5bae47d948", "filename": "gcc/cp/cp-gimplify.c", "status": "modified", "additions": 10, "deletions": 5, "changes": 15, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/048336099ee3c4e29510f140f5505ce2ad79bf55/gcc%2Fcp%2Fcp-gimplify.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/048336099ee3c4e29510f140f5505ce2ad79bf55/gcc%2Fcp%2Fcp-gimplify.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fcp%2Fcp-gimplify.c?ref=048336099ee3c4e29510f140f5505ce2ad79bf55", "patch": "@@ -386,7 +386,8 @@ genericize_omp_for_stmt (tree *stmt_p, int *walk_subtrees, void *data)\n   tree clab = begin_bc_block (bc_continue, locus);\n \n   cp_walk_tree (&OMP_FOR_BODY (stmt), cp_genericize_r, data, NULL);\n-  cp_walk_tree (&OMP_FOR_CLAUSES (stmt), cp_genericize_r, data, NULL);\n+  if (TREE_CODE (stmt) != OMP_TASKLOOP)\n+    cp_walk_tree (&OMP_FOR_CLAUSES (stmt), cp_genericize_r, data, NULL);\n   cp_walk_tree (&OMP_FOR_INIT (stmt), cp_genericize_r, data, NULL);\n   cp_walk_tree (&OMP_FOR_COND (stmt), cp_genericize_r, data, NULL);\n   cp_walk_tree (&OMP_FOR_INCR (stmt), cp_genericize_r, data, NULL);\n@@ -1272,7 +1273,9 @@ cp_genericize_r (tree *stmt_p, int *walk_subtrees, void *data)\n       if (TREE_CODE (d) == VAR_DECL)\n \tgcc_assert (CP_DECL_THREAD_LOCAL_P (d) == DECL_THREAD_LOCAL_P (d));\n     }\n-  else if (TREE_CODE (stmt) == OMP_PARALLEL || TREE_CODE (stmt) == OMP_TASK)\n+  else if (TREE_CODE (stmt) == OMP_PARALLEL\n+\t   || TREE_CODE (stmt) == OMP_TASK\n+\t   || TREE_CODE (stmt) == OMP_TASKLOOP)\n     {\n       struct cp_genericize_omp_taskreg omp_ctx;\n       tree c, decl;\n@@ -1312,7 +1315,10 @@ cp_genericize_r (tree *stmt_p, int *walk_subtrees, void *data)\n \t  default:\n \t    break;\n \t  }\n-      cp_walk_tree (&OMP_BODY (stmt), cp_genericize_r, data, NULL);\n+      if (TREE_CODE (stmt) == OMP_TASKLOOP)\n+\tgenericize_omp_for_stmt (stmt_p, walk_subtrees, data);\n+      else\n+\tcp_walk_tree (&OMP_BODY (stmt), cp_genericize_r, data, NULL);\n       wtd->omp_ctx = omp_ctx.outer;\n       splay_tree_delete (omp_ctx.variables);\n     }\n@@ -1380,8 +1386,7 @@ cp_genericize_r (tree *stmt_p, int *walk_subtrees, void *data)\n     genericize_break_stmt (stmt_p);\n   else if (TREE_CODE (stmt) == OMP_FOR\n \t   || TREE_CODE (stmt) == OMP_SIMD\n-\t   || TREE_CODE (stmt) == OMP_DISTRIBUTE\n-\t   || TREE_CODE (stmt) == OMP_TASKLOOP)\n+\t   || TREE_CODE (stmt) == OMP_DISTRIBUTE)\n     genericize_omp_for_stmt (stmt_p, walk_subtrees, data);\n   else if ((flag_sanitize\n \t    & (SANITIZE_NULL | SANITIZE_ALIGNMENT | SANITIZE_VPTR))"}, {"sha": "cb8c98edabe89f05ec475f70537ea92ef6b48e3f", "filename": "libgomp/ChangeLog", "status": "modified", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/048336099ee3c4e29510f140f5505ce2ad79bf55/libgomp%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/048336099ee3c4e29510f140f5505ce2ad79bf55/libgomp%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libgomp%2FChangeLog?ref=048336099ee3c4e29510f140f5505ce2ad79bf55", "patch": "@@ -1,3 +1,8 @@\n+2016-03-23  Jakub Jelinek  <jakub@redhat.com>\n+\n+\tPR c++/70376\n+\t* testsuite/libgomp.c++/pr70376.C: New test.\n+\n 2016-03-23  Tom de Vries  <tom@codesourcery.com>\n \n \t* testsuite/libgomp.oacc-fortran/reduction-2.f90: Add missing"}, {"sha": "595c2cc930c28c99572c93143c245c7d2ed19825", "filename": "libgomp/testsuite/libgomp.c++/pr70376.C", "status": "added", "additions": 20, "deletions": 0, "changes": 20, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/048336099ee3c4e29510f140f5505ce2ad79bf55/libgomp%2Ftestsuite%2Flibgomp.c%2B%2B%2Fpr70376.C", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/048336099ee3c4e29510f140f5505ce2ad79bf55/libgomp%2Ftestsuite%2Flibgomp.c%2B%2B%2Fpr70376.C", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libgomp%2Ftestsuite%2Flibgomp.c%2B%2B%2Fpr70376.C?ref=048336099ee3c4e29510f140f5505ce2ad79bf55", "patch": "@@ -0,0 +1,20 @@\n+// PR c++/70376\n+// { dg-do link }\n+\n+template <typename T>\n+struct A\n+{\n+  A() { }\n+  A(const A&) { }\n+  void foo() { }\n+};\n+\n+int\n+main ()\n+{\n+  A<int> a;\n+  #pragma omp taskloop\n+  for (int i = 0; i < 64; i++)\n+    a.foo();\n+  return 0;\n+}"}]}