{"sha": "fef32cf89f7fe0c8864443dca942c6e34a204976", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6ZmVmMzJjZjg5ZjdmZTBjODg2NDQ0M2RjYTk0MmM2ZTM0YTIwNDk3Ng==", "commit": {"author": {"name": "Segher Boessenkool", "email": "segher@kernel.crashing.org", "date": "2014-10-02T02:18:01Z"}, "committer": {"name": "Segher Boessenkool", "email": "segher@gcc.gnu.org", "date": "2014-10-02T02:18:01Z"}, "message": "re PR rtl-optimization/62151 (wrong code at -O2 and -O3 on x86_64-linux-gnu)\n\n2014-10-01  Segher Boessenkool  <segher@kernel.crashing.org>\n\ngcc/\n\tPR rtl-optimization/62151\n\t* combine.c (can_combine_p): Allow the destination register of INSN\n\tto be clobbered in I3.\n\t(subst): Do not substitute into clobbers of registers.\n\ngcc/testsuite/\n\t* gcc.dg/combine-clobber.c: New.\n\nFrom-SVN: r215789", "tree": {"sha": "002696394921c8abd7ea2ffccb3f77aae36b575c", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/002696394921c8abd7ea2ffccb3f77aae36b575c"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/fef32cf89f7fe0c8864443dca942c6e34a204976", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/fef32cf89f7fe0c8864443dca942c6e34a204976", "html_url": "https://github.com/Rust-GCC/gccrs/commit/fef32cf89f7fe0c8864443dca942c6e34a204976", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/fef32cf89f7fe0c8864443dca942c6e34a204976/comments", "author": {"login": "segher", "id": 417629, "node_id": "MDQ6VXNlcjQxNzYyOQ==", "avatar_url": "https://avatars.githubusercontent.com/u/417629?v=4", "gravatar_id": "", "url": "https://api.github.com/users/segher", "html_url": "https://github.com/segher", "followers_url": "https://api.github.com/users/segher/followers", "following_url": "https://api.github.com/users/segher/following{/other_user}", "gists_url": "https://api.github.com/users/segher/gists{/gist_id}", "starred_url": "https://api.github.com/users/segher/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/segher/subscriptions", "organizations_url": "https://api.github.com/users/segher/orgs", "repos_url": "https://api.github.com/users/segher/repos", "events_url": "https://api.github.com/users/segher/events{/privacy}", "received_events_url": "https://api.github.com/users/segher/received_events", "type": "User", "site_admin": false}, "committer": null, "parents": [{"sha": "3f4dd27a6e582dd3e072656c61c61f2208c11a86", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/3f4dd27a6e582dd3e072656c61c61f2208c11a86", "html_url": "https://github.com/Rust-GCC/gccrs/commit/3f4dd27a6e582dd3e072656c61c61f2208c11a86"}], "stats": {"total": 20, "additions": 16, "deletions": 4}, "files": [{"sha": "aafbd2e048687b66bbbd5d8efa658fc8f615540b", "filename": "gcc/ChangeLog", "status": "modified", "additions": 7, "deletions": 0, "changes": 7, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/fef32cf89f7fe0c8864443dca942c6e34a204976/gcc%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/fef32cf89f7fe0c8864443dca942c6e34a204976/gcc%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2FChangeLog?ref=fef32cf89f7fe0c8864443dca942c6e34a204976", "patch": "@@ -1,3 +1,10 @@\n+2014-10-01  Segher Boessenkool  <segher@kernel.crashing.org>\n+\n+\tPR rtl-optimization/62151\n+\t* combine.c (can_combine_p): Allow the destination register of INSN\n+\tto be clobbered in I3.\n+\t(subst): Do not substitute into clobbers of registers.\n+\n 2014-10-01  Jakub Jelinek  <jakub@redhat.com>\n \n \tPR debug/63342"}, {"sha": "ff5f0dbd509c917fca50af74f7f049a0ad242f3a", "filename": "gcc/combine.c", "status": "modified", "additions": 5, "deletions": 4, "changes": 9, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/fef32cf89f7fe0c8864443dca942c6e34a204976/gcc%2Fcombine.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/fef32cf89f7fe0c8864443dca942c6e34a204976/gcc%2Fcombine.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fcombine.c?ref=fef32cf89f7fe0c8864443dca942c6e34a204976", "patch": "@@ -1950,11 +1950,7 @@ can_combine_p (rtx_insn *insn, rtx_insn *i3, rtx_insn *pred ATTRIBUTE_UNUSED,\n     for (i = XVECLEN (PATTERN (i3), 0) - 1; i >= 0; i--)\n       if (GET_CODE (XVECEXP (PATTERN (i3), 0, i)) == CLOBBER)\n \t{\n-\t  /* Don't substitute for a register intended as a clobberable\n-\t     operand.  */\n \t  rtx reg = XEXP (XVECEXP (PATTERN (i3), 0, i), 0);\n-\t  if (rtx_equal_p (reg, dest))\n-\t    return 0;\n \n \t  /* If the clobber represents an earlyclobber operand, we must not\n \t     substitute an expression containing the clobbered register.\n@@ -4963,6 +4959,11 @@ subst (rtx x, rtx from, rtx to, int in_dest, int in_cond, int unique_copy)\n    || (REG_P (X) && REG_P (Y)\t\\\n        && REGNO (X) == REGNO (Y) && GET_MODE (X) == GET_MODE (Y)))\n \n+  /* Do not substitute into clobbers of regs -- this will never result in\n+     valid RTL.  */\n+  if (GET_CODE (x) == CLOBBER && REG_P (XEXP (x, 0)))\n+    return x;\n+\n   if (! in_dest && COMBINE_RTX_EQUAL_P (x, from))\n     {\n       n_occurrences++;"}, {"sha": "0cf36a08329ed69d2f537680042f2031929bed02", "filename": "gcc/testsuite/ChangeLog", "status": "modified", "additions": 4, "deletions": 0, "changes": 4, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/fef32cf89f7fe0c8864443dca942c6e34a204976/gcc%2Ftestsuite%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/fef32cf89f7fe0c8864443dca942c6e34a204976/gcc%2Ftestsuite%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2FChangeLog?ref=fef32cf89f7fe0c8864443dca942c6e34a204976", "patch": "@@ -1,3 +1,7 @@\n+2014-10-01  Segher Boessenkool  <segher@kernel.crashing.org>\n+\n+\t* gcc.dg/combine-clobber.c: New.\n+\n 2014-10-01  Jakub Jelinek  <jakub@redhat.com>\n \n \tPR debug/63342"}]}