{"sha": "d12153046816f955e74943af7089d30de6a00e19", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6ZDEyMTUzMDQ2ODE2Zjk1NWU3NDk0M2FmNzA4OWQzMGRlNmEwMGUxOQ==", "commit": {"author": {"name": "Richard Biener", "email": "rguenther@suse.de", "date": "2020-02-27T10:42:50Z"}, "committer": {"name": "Richard Biener", "email": "rguenther@suse.de", "date": "2020-02-27T10:43:52Z"}, "message": "fix -fdebug-prefix-map without gas .file support\n\nThis applies file mapping when emitting the directory table\ndirectly instead of using the assemblers .file directive where\nwe already correctly apply the map.  Notably the non-assembler\npath is used for the early debug emission for LTO.\n\n2020-02-27  Mark Williams  <mwilliams@fb.com>\n\n\t* dwarf2out.c (file_name_acquire): Call remap_debug_filename.\n\t* lto-opts.c (lto_write_options): Drop -fdebug-prefix-map,\n\t-ffile-prefix-map and -fmacro-prefix-map.\n\t* lto-streamer-out.c: Include file-prefix-map.h.\n\t(lto_output_location): Remap the file part of locations.", "tree": {"sha": "f68600afdf02e6864b8982d42a2a294ad9db8477", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/f68600afdf02e6864b8982d42a2a294ad9db8477"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/d12153046816f955e74943af7089d30de6a00e19", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/d12153046816f955e74943af7089d30de6a00e19", "html_url": "https://github.com/Rust-GCC/gccrs/commit/d12153046816f955e74943af7089d30de6a00e19", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/d12153046816f955e74943af7089d30de6a00e19/comments", "author": {"login": "rguenth", "id": 2046526, "node_id": "MDQ6VXNlcjIwNDY1MjY=", "avatar_url": "https://avatars.githubusercontent.com/u/2046526?v=4", "gravatar_id": "", "url": "https://api.github.com/users/rguenth", "html_url": "https://github.com/rguenth", "followers_url": "https://api.github.com/users/rguenth/followers", "following_url": "https://api.github.com/users/rguenth/following{/other_user}", "gists_url": "https://api.github.com/users/rguenth/gists{/gist_id}", "starred_url": "https://api.github.com/users/rguenth/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/rguenth/subscriptions", "organizations_url": "https://api.github.com/users/rguenth/orgs", "repos_url": "https://api.github.com/users/rguenth/repos", "events_url": "https://api.github.com/users/rguenth/events{/privacy}", "received_events_url": "https://api.github.com/users/rguenth/received_events", "type": "User", "site_admin": false}, "committer": {"login": "rguenth", "id": 2046526, "node_id": "MDQ6VXNlcjIwNDY1MjY=", "avatar_url": "https://avatars.githubusercontent.com/u/2046526?v=4", "gravatar_id": "", "url": "https://api.github.com/users/rguenth", "html_url": "https://github.com/rguenth", "followers_url": "https://api.github.com/users/rguenth/followers", "following_url": "https://api.github.com/users/rguenth/following{/other_user}", "gists_url": "https://api.github.com/users/rguenth/gists{/gist_id}", "starred_url": "https://api.github.com/users/rguenth/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/rguenth/subscriptions", "organizations_url": "https://api.github.com/users/rguenth/orgs", "repos_url": "https://api.github.com/users/rguenth/repos", "events_url": "https://api.github.com/users/rguenth/events{/privacy}", "received_events_url": "https://api.github.com/users/rguenth/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "1956773cc655dfcba8d310066d3f6585dd4b8972", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/1956773cc655dfcba8d310066d3f6585dd4b8972", "html_url": "https://github.com/Rust-GCC/gccrs/commit/1956773cc655dfcba8d310066d3f6585dd4b8972"}], "stats": {"total": 17, "additions": 15, "deletions": 2}, "files": [{"sha": "beb56bc0130d3aa17d6c5704d055695e03b78aea", "filename": "gcc/ChangeLog", "status": "modified", "additions": 8, "deletions": 0, "changes": 8, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/d12153046816f955e74943af7089d30de6a00e19/gcc%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/d12153046816f955e74943af7089d30de6a00e19/gcc%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2FChangeLog?ref=d12153046816f955e74943af7089d30de6a00e19", "patch": "@@ -1,3 +1,11 @@\n+2020-02-27  Mark Williams  <mwilliams@fb.com>\n+\n+\t* dwarf2out.c (file_name_acquire): Call remap_debug_filename.\n+\t* lto-opts.c (lto_write_options): Drop -fdebug-prefix-map,\n+\t-ffile-prefix-map and -fmacro-prefix-map.\n+\t* lto-streamer-out.c: Include file-prefix-map.h.\n+\t(lto_output_location): Remap the file part of locations.\n+\n 2020-02-27  Jakub Jelinek  <jakub@redhat.com>\n \n \tPR c/93949"}, {"sha": "bb45279ea56d36621f14b0a68f4f0f0be3bf4e97", "filename": "gcc/dwarf2out.c", "status": "modified", "additions": 2, "deletions": 1, "changes": 3, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/d12153046816f955e74943af7089d30de6a00e19/gcc%2Fdwarf2out.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/d12153046816f955e74943af7089d30de6a00e19/gcc%2Fdwarf2out.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fdwarf2out.c?ref=d12153046816f955e74943af7089d30de6a00e19", "patch": "@@ -12101,8 +12101,9 @@ file_name_acquire (dwarf_file_data **slot, file_name_acquire_data *fnad)\n \n   fi = fnad->files + fnad->used_files++;\n \n+  f = remap_debug_filename (d->filename);\n+\n   /* Skip all leading \"./\".  */\n-  f = d->filename;\n   while (f[0] == '.' && IS_DIR_SEPARATOR (f[1]))\n     f += 2;\n "}, {"sha": "2512560cc6dec3b19f788292acfd1a47d4c73c38", "filename": "gcc/lto-opts.c", "status": "modified", "additions": 3, "deletions": 0, "changes": 3, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/d12153046816f955e74943af7089d30de6a00e19/gcc%2Flto-opts.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/d12153046816f955e74943af7089d30de6a00e19/gcc%2Flto-opts.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Flto-opts.c?ref=d12153046816f955e74943af7089d30de6a00e19", "patch": "@@ -131,6 +131,9 @@ lto_write_options (void)\n \tcase OPT_SPECIAL_input_file:\n \tcase OPT_dumpdir:\n \tcase OPT_fresolution_:\n+\tcase OPT_fdebug_prefix_map_:\n+\tcase OPT_ffile_prefix_map_:\n+\tcase OPT_fmacro_prefix_map_:\n \t  continue;\n \n \tdefault:"}, {"sha": "cea5e71cffbcfc068af6bb240a5bf2c8d561fa88", "filename": "gcc/lto-streamer-out.c", "status": "modified", "additions": 2, "deletions": 1, "changes": 3, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/d12153046816f955e74943af7089d30de6a00e19/gcc%2Flto-streamer-out.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/d12153046816f955e74943af7089d30de6a00e19/gcc%2Flto-streamer-out.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Flto-streamer-out.c?ref=d12153046816f955e74943af7089d30de6a00e19", "patch": "@@ -44,6 +44,7 @@ along with GCC; see the file COPYING3.  If not see\n #include \"omp-offload.h\"\n #include \"print-tree.h\"\n #include \"tree-dfa.h\"\n+#include \"file-prefix-map.h\" /* remap_debug_filename()  */\n \n \n static void lto_write_tree (struct output_block*, tree, bool);\n@@ -200,7 +201,7 @@ lto_output_location (struct output_block *ob, struct bitpack_d *bp,\n \n   if (ob->current_file != xloc.file)\n     {\n-      bp_pack_string (ob, bp, xloc.file, true);\n+      bp_pack_string (ob, bp, remap_debug_filename (xloc.file), true);\n       bp_pack_value (bp, xloc.sysp, 1);\n     }\n   ob->current_file = xloc.file;"}]}