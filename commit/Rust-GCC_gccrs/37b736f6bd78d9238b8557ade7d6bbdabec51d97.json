{"sha": "37b736f6bd78d9238b8557ade7d6bbdabec51d97", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6MzdiNzM2ZjZiZDc4ZDkyMzhiODU1N2FkZTdkNmJiZGFiZWM1MWQ5Nw==", "commit": {"author": {"name": "Jonathan Wakely", "email": "jwakely@redhat.com", "date": "2018-11-11T05:16:51Z"}, "committer": {"name": "Jonathan Wakely", "email": "redi@gcc.gnu.org", "date": "2018-11-11T05:16:51Z"}, "message": "Implement P1007R3 std::assume_aligned\n\n\tImplement P1007R3 std::assume_aligned\n\t* include/std/memory (assume_aligned): Implement for C++17.\n\t* testsuite/20_util/assume_aligned/1.cc: New test.\n\t* testsuite/20_util/assume_aligned/2_neg.cc: New test.\n\t* testsuite/20_util/assume_aligned/3.cc: New test.\n\nFrom-SVN: r266009", "tree": {"sha": "5cb0452c0ba9dc129ab71f3e90679b6cc26044bd", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/5cb0452c0ba9dc129ab71f3e90679b6cc26044bd"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/37b736f6bd78d9238b8557ade7d6bbdabec51d97", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/37b736f6bd78d9238b8557ade7d6bbdabec51d97", "html_url": "https://github.com/Rust-GCC/gccrs/commit/37b736f6bd78d9238b8557ade7d6bbdabec51d97", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/37b736f6bd78d9238b8557ade7d6bbdabec51d97/comments", "author": {"login": "jwakely", "id": 1254480, "node_id": "MDQ6VXNlcjEyNTQ0ODA=", "avatar_url": "https://avatars.githubusercontent.com/u/1254480?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jwakely", "html_url": "https://github.com/jwakely", "followers_url": "https://api.github.com/users/jwakely/followers", "following_url": "https://api.github.com/users/jwakely/following{/other_user}", "gists_url": "https://api.github.com/users/jwakely/gists{/gist_id}", "starred_url": "https://api.github.com/users/jwakely/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jwakely/subscriptions", "organizations_url": "https://api.github.com/users/jwakely/orgs", "repos_url": "https://api.github.com/users/jwakely/repos", "events_url": "https://api.github.com/users/jwakely/events{/privacy}", "received_events_url": "https://api.github.com/users/jwakely/received_events", "type": "User", "site_admin": false}, "committer": {"login": "jwakely", "id": 1254480, "node_id": "MDQ6VXNlcjEyNTQ0ODA=", "avatar_url": "https://avatars.githubusercontent.com/u/1254480?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jwakely", "html_url": "https://github.com/jwakely", "followers_url": "https://api.github.com/users/jwakely/followers", "following_url": "https://api.github.com/users/jwakely/following{/other_user}", "gists_url": "https://api.github.com/users/jwakely/gists{/gist_id}", "starred_url": "https://api.github.com/users/jwakely/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jwakely/subscriptions", "organizations_url": "https://api.github.com/users/jwakely/orgs", "repos_url": "https://api.github.com/users/jwakely/repos", "events_url": "https://api.github.com/users/jwakely/events{/privacy}", "received_events_url": "https://api.github.com/users/jwakely/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "47d591cf0055b52b71adb8e82e61002281b7035e", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/47d591cf0055b52b71adb8e82e61002281b7035e", "html_url": "https://github.com/Rust-GCC/gccrs/commit/47d591cf0055b52b71adb8e82e61002281b7035e"}], "stats": {"total": 122, "additions": 122, "deletions": 0}, "files": [{"sha": "967aa5bc53d410fc7d5df5d92c459263c4d09540", "filename": "libstdc++-v3/ChangeLog", "status": "modified", "additions": 8, "deletions": 0, "changes": 8, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/37b736f6bd78d9238b8557ade7d6bbdabec51d97/libstdc%2B%2B-v3%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/37b736f6bd78d9238b8557ade7d6bbdabec51d97/libstdc%2B%2B-v3%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libstdc%2B%2B-v3%2FChangeLog?ref=37b736f6bd78d9238b8557ade7d6bbdabec51d97", "patch": "@@ -1,3 +1,11 @@\n+2018-11-11  Jonathan Wakely  <jwakely@redhat.com>\n+\n+\tImplement P1007R3 std::assume_aligned\n+\t* include/std/memory (assume_aligned): Implement for C++17.\n+\t* testsuite/20_util/assume_aligned/1.cc: New test.\n+\t* testsuite/20_util/assume_aligned/2_neg.cc: New test.\n+\t* testsuite/20_util/assume_aligned/3.cc: New test.\n+\n 2018-11-09  Jonathan Wakely  <jwakely@redhat.com>\n \n \tPR libstdc++/87787"}, {"sha": "d7f0e8f6d21d5b0b351bb2bbf8b5bb6b8ec662f2", "filename": "libstdc++-v3/include/std/memory", "status": "modified", "additions": 15, "deletions": 0, "changes": 15, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/37b736f6bd78d9238b8557ade7d6bbdabec51d97/libstdc%2B%2B-v3%2Finclude%2Fstd%2Fmemory", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/37b736f6bd78d9238b8557ade7d6bbdabec51d97/libstdc%2B%2B-v3%2Finclude%2Fstd%2Fmemory", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libstdc%2B%2B-v3%2Finclude%2Fstd%2Fmemory?ref=37b736f6bd78d9238b8557ade7d6bbdabec51d97", "patch": "@@ -89,6 +89,9 @@\n \n #if __cplusplus >= 201103L\n #include <cstdint>\n+#if __cplusplus > 201703L\n+# include <bit>\t\t\t// for ispow2\n+#endif\n namespace std _GLIBCXX_VISIBILITY(default)\n {\n _GLIBCXX_BEGIN_NAMESPACE_VERSION\n@@ -151,6 +154,18 @@ undeclare_no_pointers(char*, size_t) { }\n inline pointer_safety\n get_pointer_safety() noexcept { return pointer_safety::relaxed; }\n \n+#if __cplusplus > 201703L\n+  /// Inform the compiler that a pointer is aligned.\n+  template<size_t _Align, class _Tp>\n+    [[nodiscard,__gnu__::__always_inline__]]\n+    constexpr _Tp* assume_aligned(_Tp* __ptr)\n+    {\n+      static_assert(std::ispow2(_Align));\n+      _GLIBCXX_DEBUG_ASSERT((std::uintptr_t)__ptr % _Align == 0);\n+      return static_cast<_Tp*>(__builtin_assume_aligned(__ptr, _Align));\n+    }\n+#endif // C++2a\n+\n _GLIBCXX_END_NAMESPACE_VERSION\n } // namespace\n #endif // C++11"}, {"sha": "be3bed14e6dddc07c72c520cb6f36696c5225e56", "filename": "libstdc++-v3/testsuite/20_util/assume_aligned/1.cc", "status": "added", "additions": 35, "deletions": 0, "changes": 35, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/37b736f6bd78d9238b8557ade7d6bbdabec51d97/libstdc%2B%2B-v3%2Ftestsuite%2F20_util%2Fassume_aligned%2F1.cc", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/37b736f6bd78d9238b8557ade7d6bbdabec51d97/libstdc%2B%2B-v3%2Ftestsuite%2F20_util%2Fassume_aligned%2F1.cc", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libstdc%2B%2B-v3%2Ftestsuite%2F20_util%2Fassume_aligned%2F1.cc?ref=37b736f6bd78d9238b8557ade7d6bbdabec51d97", "patch": "@@ -0,0 +1,35 @@\n+// Copyright (C) 2018 Free Software Foundation, Inc.\n+//\n+// This file is part of the GNU ISO C++ Library.  This library is free\n+// software; you can redistribute it and/or modify it under the\n+// terms of the GNU General Public License as published by the\n+// Free Software Foundation; either version 3, or (at your option)\n+// any later version.\n+\n+// This library is distributed in the hope that it will be useful,\n+// but WITHOUT ANY WARRANTY; without even the implied warranty of\n+// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n+// GNU General Public License for more details.\n+\n+// You should have received a copy of the GNU General Public License along\n+// with this library; see the file COPYING3.  If not see\n+// <http://www.gnu.org/licenses/>.\n+\n+// { dg-options \"-std=gnu++2a\" }\n+// { dg-do run { target c++2a } }\n+\n+#include <memory>\n+#include <testsuite_hooks.h>\n+\n+void\n+test01()\n+{\n+  int i = 0;\n+  int* p = std::assume_aligned<alignof(int)>(&i);\n+  VERIFY( p == &i );\n+}\n+\n+int main()\n+{\n+  test01();\n+}"}, {"sha": "f902e45a9a796a22d8abed4dc76dd8256760b188", "filename": "libstdc++-v3/testsuite/20_util/assume_aligned/2_neg.cc", "status": "added", "additions": 30, "deletions": 0, "changes": 30, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/37b736f6bd78d9238b8557ade7d6bbdabec51d97/libstdc%2B%2B-v3%2Ftestsuite%2F20_util%2Fassume_aligned%2F2_neg.cc", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/37b736f6bd78d9238b8557ade7d6bbdabec51d97/libstdc%2B%2B-v3%2Ftestsuite%2F20_util%2Fassume_aligned%2F2_neg.cc", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libstdc%2B%2B-v3%2Ftestsuite%2F20_util%2Fassume_aligned%2F2_neg.cc?ref=37b736f6bd78d9238b8557ade7d6bbdabec51d97", "patch": "@@ -0,0 +1,30 @@\n+// Copyright (C) 2018 Free Software Foundation, Inc.\n+//\n+// This file is part of the GNU ISO C++ Library.  This library is free\n+// software; you can redistribute it and/or modify it under the\n+// terms of the GNU General Public License as published by the\n+// Free Software Foundation; either version 3, or (at your option)\n+// any later version.\n+\n+// This library is distributed in the hope that it will be useful,\n+// but WITHOUT ANY WARRANTY; without even the implied warranty of\n+// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n+// GNU General Public License for more details.\n+\n+// You should have received a copy of the GNU General Public License along\n+// with this library; see the file COPYING3.  If not see\n+// <http://www.gnu.org/licenses/>.\n+\n+// { dg-options \"-std=gnu++2a\" }\n+// { dg-do compile { target c++2a } }\n+\n+#include <memory>\n+\n+void\n+test01()\n+{\n+  int i = 0;\n+  std::assume_aligned<2>(&i); // { dg-warning \"ignoring return value\" }\n+  (void) std::assume_aligned<3>(&i); // { dg-error \"here\" }\n+  // { dg-error \"static assertion failed\" \"\" { target *-*-* } 0 }\n+}"}, {"sha": "da2a6684bb913a646785164d6a1efc0dddd8443e", "filename": "libstdc++-v3/testsuite/20_util/assume_aligned/3.cc", "status": "added", "additions": 34, "deletions": 0, "changes": 34, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/37b736f6bd78d9238b8557ade7d6bbdabec51d97/libstdc%2B%2B-v3%2Ftestsuite%2F20_util%2Fassume_aligned%2F3.cc", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/37b736f6bd78d9238b8557ade7d6bbdabec51d97/libstdc%2B%2B-v3%2Ftestsuite%2F20_util%2Fassume_aligned%2F3.cc", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libstdc%2B%2B-v3%2Ftestsuite%2F20_util%2Fassume_aligned%2F3.cc?ref=37b736f6bd78d9238b8557ade7d6bbdabec51d97", "patch": "@@ -0,0 +1,34 @@\n+// Copyright (C) 2018 Free Software Foundation, Inc.\n+//\n+// This file is part of the GNU ISO C++ Library.  This library is free\n+// software; you can redistribute it and/or modify it under the\n+// terms of the GNU General Public License as published by the\n+// Free Software Foundation; either version 3, or (at your option)\n+// any later version.\n+\n+// This library is distributed in the hope that it will be useful,\n+// but WITHOUT ANY WARRANTY; without even the implied warranty of\n+// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n+// GNU General Public License for more details.\n+\n+// You should have received a copy of the GNU General Public License along\n+// with this library; see the file COPYING3.  If not see\n+// <http://www.gnu.org/licenses/>.\n+\n+// { dg-options \"-std=gnu++2a -O2\" }\n+// { dg-do compile { target c++2a } }\n+// { dg-final { scan-assembler-not \"undefined\" } }\n+\n+#include <memory>\n+\n+int* ptr();\n+extern \"C\" void undefined();\n+\n+void\n+test01()\n+{\n+  const std::size_t alignment = 4 * alignof(int);\n+  int* p = std::assume_aligned<alignment>(ptr());\n+  if ((std::uintptr_t)p % alignment)\n+    undefined();\n+}"}]}