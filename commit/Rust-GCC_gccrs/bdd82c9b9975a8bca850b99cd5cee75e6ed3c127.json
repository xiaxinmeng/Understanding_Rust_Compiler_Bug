{"sha": "bdd82c9b9975a8bca850b99cd5cee75e6ed3c127", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6YmRkODJjOWI5OTc1YThiY2E4NTBiOTljZDVjZWU3NWU2ZWQzYzEyNw==", "commit": {"author": {"name": "Steven G. Kargl", "email": "kargl@gcc.gnu.org", "date": "2018-01-10T23:26:15Z"}, "committer": {"name": "Steven G. Kargl", "email": "kargl@gcc.gnu.org", "date": "2018-01-10T23:26:15Z"}, "message": "re PR fortran/82367 (ICE with deferred length string allocate on non-deferred length argument)\n\n2018-01-10  Steven G. Kargl  <kargl@gcc.gnu.org>\n\n\tPR fortran/82367\n\t* resolve.c (resolve_allocate_expr): Check for NULL pointer.\n\n2018-01-10  Steven G. Kargl  <kargl@gcc.gnu.org>\n\n\tPR fortran/82367\n\t* gfortran.dg/deferred_character_18.f90: New test.\n\nFrom-SVN: r256464", "tree": {"sha": "f4a5914f6c206ced8e44b8db873a905434bccc68", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/f4a5914f6c206ced8e44b8db873a905434bccc68"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/bdd82c9b9975a8bca850b99cd5cee75e6ed3c127", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/bdd82c9b9975a8bca850b99cd5cee75e6ed3c127", "html_url": "https://github.com/Rust-GCC/gccrs/commit/bdd82c9b9975a8bca850b99cd5cee75e6ed3c127", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/bdd82c9b9975a8bca850b99cd5cee75e6ed3c127/comments", "author": null, "committer": null, "parents": [{"sha": "68dc87c3600fe0b6b629b45e5efc058c32b7bccc", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/68dc87c3600fe0b6b629b45e5efc058c32b7bccc", "html_url": "https://github.com/Rust-GCC/gccrs/commit/68dc87c3600fe0b6b629b45e5efc058c32b7bccc"}], "stats": {"total": 48, "additions": 46, "deletions": 2}, "files": [{"sha": "f4289343cc1428e30ba65349bc57d91595ac4a3c", "filename": "gcc/fortran/ChangeLog", "status": "modified", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/bdd82c9b9975a8bca850b99cd5cee75e6ed3c127/gcc%2Ffortran%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/bdd82c9b9975a8bca850b99cd5cee75e6ed3c127/gcc%2Ffortran%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ffortran%2FChangeLog?ref=bdd82c9b9975a8bca850b99cd5cee75e6ed3c127", "patch": "@@ -1,3 +1,8 @@\n+2018-01-10  Steven G. Kargl  <kargl@gcc.gnu.org>\n+\n+\tPR fortran/82367\n+\t* resolve.c (resolve_allocate_expr): Check for NULL pointer.\n+\n 2018-01-10  Steven G. Kargl  <kargl@gcc.gnu.org>\n \n \tPR fortran/83093"}, {"sha": "e9f91d883ef3c43353e5788bf6bab37e72353f45", "filename": "gcc/fortran/resolve.c", "status": "modified", "additions": 7, "deletions": 2, "changes": 9, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/bdd82c9b9975a8bca850b99cd5cee75e6ed3c127/gcc%2Ffortran%2Fresolve.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/bdd82c9b9975a8bca850b99cd5cee75e6ed3c127/gcc%2Ffortran%2Fresolve.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ffortran%2Fresolve.c?ref=bdd82c9b9975a8bca850b99cd5cee75e6ed3c127", "patch": "@@ -7484,8 +7484,13 @@ resolve_allocate_expr (gfc_expr *e, gfc_code *code, bool *array_alloc_wo_spec)\n   if (code->ext.alloc.ts.type == BT_CHARACTER && !e->ts.deferred\n       && !UNLIMITED_POLY (e))\n     {\n-      int cmp = gfc_dep_compare_expr (e->ts.u.cl->length,\n-\t\t\t\t      code->ext.alloc.ts.u.cl->length);\n+      int cmp;\n+\n+      if (!e->ts.u.cl->length)\n+\tgoto failure;\n+\n+      cmp = gfc_dep_compare_expr (e->ts.u.cl->length,\n+\t\t\t\t  code->ext.alloc.ts.u.cl->length);\n       if (cmp == 1 || cmp == -1 || cmp == -3)\n \t{\n \t  gfc_error (\"Allocating %s at %L with type-spec requires the same \""}, {"sha": "4ac9461afd22cdbc6f9f7485f7c738b897028680", "filename": "gcc/testsuite/ChangeLog", "status": "modified", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/bdd82c9b9975a8bca850b99cd5cee75e6ed3c127/gcc%2Ftestsuite%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/bdd82c9b9975a8bca850b99cd5cee75e6ed3c127/gcc%2Ftestsuite%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2FChangeLog?ref=bdd82c9b9975a8bca850b99cd5cee75e6ed3c127", "patch": "@@ -1,3 +1,8 @@\n+2018-01-10  Steven G. Kargl  <kargl@gcc.gnu.org>\n+\n+\tPR fortran/82367\n+\t* gfortran.dg/deferred_character_18.f90: New test.\n+\n 2018-01-10  Martin Sebor  <msebor@redhat.com>\n \n \tPR tree-optimization/83671"}, {"sha": "1b1457fa293c03310e8773c1decf9ffec8456d31", "filename": "gcc/testsuite/gfortran.dg/deferred_character_18.f90", "status": "added", "additions": 29, "deletions": 0, "changes": 29, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/bdd82c9b9975a8bca850b99cd5cee75e6ed3c127/gcc%2Ftestsuite%2Fgfortran.dg%2Fdeferred_character_18.f90", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/bdd82c9b9975a8bca850b99cd5cee75e6ed3c127/gcc%2Ftestsuite%2Fgfortran.dg%2Fdeferred_character_18.f90", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgfortran.dg%2Fdeferred_character_18.f90?ref=bdd82c9b9975a8bca850b99cd5cee75e6ed3c127", "patch": "@@ -0,0 +1,29 @@\n+! { dg-do compile }\n+! PR Fortran/82367\n+! Contributed by Walter Spector <w6ws at earthlink dot net>\n+module cls_allocmod\n+  implicit none\n+\n+contains\n+\n+ subroutine cls_alloc (n, str)\n+    integer,  intent(in) :: n\n+    character(*), allocatable, intent(out) :: str\n+!  Note: Star ^ should have been a colon (:)\n+\n+    allocate (character(n)::str)\n+\n+  end subroutine\n+\n+end module\n+\n+program cls\n+  use cls_allocmod\n+  implicit none\n+\n+  character(:), allocatable :: s\n+\n+  call cls_alloc(42, s) ! { dg-error \"allocatable or pointer dummy argument\" }\n+  print *, 'string len =', len(s)\n+\n+end program"}]}