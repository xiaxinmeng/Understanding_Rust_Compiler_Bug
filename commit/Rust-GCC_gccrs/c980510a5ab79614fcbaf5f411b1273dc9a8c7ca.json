{"sha": "c980510a5ab79614fcbaf5f411b1273dc9a8c7ca", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6Yzk4MDUxMGE1YWI3OTYxNGZjYmFmNWY0MTFiMTI3M2RjOWE4YzdjYQ==", "commit": {"author": {"name": "Steven G. Kargl", "email": "kargl@gcc.gnu.org", "date": "2019-08-28T20:36:00Z"}, "committer": {"name": "Steven G. Kargl", "email": "kargl@gcc.gnu.org", "date": "2019-08-28T20:36:00Z"}, "message": "re PR fortran/91551 (ICE in sort_actual, at fortran/intrinsic.c:4193)\n\n2019-08-28  Steven G. Kargl  <kargl@gcc.gnu.org>\n\n\tPR fortran/91551\n\t* intrinsic.c (sort_actual): ALLOCATED has one argument. Check for\n\tno argument case.\n\n2019-08-28  Steven G. Kargl  <kargl@gcc.gnu.org>\n\n\tPR fortran/91551\n\t* gfortran.dg/allocated_3.f90\n\nFrom-SVN: r275009", "tree": {"sha": "1d54640ebad4cd1963dbe737ea184c32f570888e", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/1d54640ebad4cd1963dbe737ea184c32f570888e"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/c980510a5ab79614fcbaf5f411b1273dc9a8c7ca", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/c980510a5ab79614fcbaf5f411b1273dc9a8c7ca", "html_url": "https://github.com/Rust-GCC/gccrs/commit/c980510a5ab79614fcbaf5f411b1273dc9a8c7ca", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/c980510a5ab79614fcbaf5f411b1273dc9a8c7ca/comments", "author": null, "committer": null, "parents": [{"sha": "4742dbe71804b3db099eb0eb8620dff2c79a71cf", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/4742dbe71804b3db099eb0eb8620dff2c79a71cf", "html_url": "https://github.com/Rust-GCC/gccrs/commit/4742dbe71804b3db099eb0eb8620dff2c79a71cf"}], "stats": {"total": 71, "additions": 49, "deletions": 22}, "files": [{"sha": "0f2efb239acd2278e4d24d1ea09818b44ce84e32", "filename": "gcc/fortran/ChangeLog", "status": "modified", "additions": 6, "deletions": 0, "changes": 6, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/c980510a5ab79614fcbaf5f411b1273dc9a8c7ca/gcc%2Ffortran%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/c980510a5ab79614fcbaf5f411b1273dc9a8c7ca/gcc%2Ffortran%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ffortran%2FChangeLog?ref=c980510a5ab79614fcbaf5f411b1273dc9a8c7ca", "patch": "@@ -1,3 +1,9 @@\n+2019-08-28  Steven G. Kargl  <kargl@gcc.gnu.org>\n+\n+\tPR fortran/91551\n+\t* intrinsic.c (sort_actual): ALLOCATED has one argument. Check for\n+\tno argument case.\n+\n 2019-08-28  Steven G. Kargl  <kargl@gcc.gnu.org>\n \n \tPR fortran/91565"}, {"sha": "764e350092632fa6ae4f9f3399003e7c09d7fd87", "filename": "gcc/fortran/intrinsic.c", "status": "modified", "additions": 32, "deletions": 22, "changes": 54, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/c980510a5ab79614fcbaf5f411b1273dc9a8c7ca/gcc%2Ffortran%2Fintrinsic.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/c980510a5ab79614fcbaf5f411b1273dc9a8c7ca/gcc%2Ffortran%2Fintrinsic.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ffortran%2Fintrinsic.c?ref=c980510a5ab79614fcbaf5f411b1273dc9a8c7ca", "patch": "@@ -4190,35 +4190,45 @@ sort_actual (const char *name, gfc_actual_arglist **ap,\n \n   /* ALLOCATED has two mutually exclusive keywords, but only one\n      can be present at time and neither is optional. */\n-  if (strcmp (name, \"allocated\") == 0 && a->name)\n+  if (strcmp (name, \"allocated\") == 0)\n     {\n-      if (strcmp (a->name, \"scalar\") == 0)\n+      if (!a)\n \t{\n-          if (a->next)\n-\t    goto whoops;\n-\t  if (a->expr->rank != 0)\n-\t    {\n-\t      gfc_error (\"Scalar entity required at %L\", &a->expr->where);\n-\t      return false;\n-\t    }\n-          return true;\n+\t  gfc_error (\"ALLOCATED intrinsic at %L requires an array or scalar \"\n+\t\t     \"allocatable entity\", where);\n+\t  return false;\n \t}\n-      else if (strcmp (a->name, \"array\") == 0)\n+\n+      if (a->name)\n \t{\n-          if (a->next)\n-\t    goto whoops;\n-\t  if (a->expr->rank == 0)\n+\t  if (strcmp (a->name, \"scalar\") == 0)\n+\t    {\n+\t      if (a->next)\n+\t\tgoto whoops;\n+\t      if (a->expr->rank != 0)\n+\t\t{\n+\t\t  gfc_error (\"Scalar entity required at %L\", &a->expr->where);\n+\t\t  return false;\n+\t\t}\n+\t      return true;\n+\t    }\n+\t  else if (strcmp (a->name, \"array\") == 0)\n \t    {\n-\t      gfc_error (\"Array entity required at %L\", &a->expr->where);\n+\t      if (a->next)\n+\t\tgoto whoops;\n+\t      if (a->expr->rank == 0)\n+\t\t{\n+\t\t  gfc_error (\"Array entity required at %L\", &a->expr->where);\n+\t\t  return false;\n+\t\t}\n+\t      return true;\n+\t    }\n+\t  else\n+\t    {\n+\t      gfc_error (\"Invalid keyword %qs in %qs intrinsic function at %L\",\n+\t\t\t a->name, name, &a->expr->where);\n \t      return false;\n \t    }\n-          return true;\n-\t}\n-      else\n-\t{\n-\t  gfc_error (\"Invalid keyword %qs in %qs intrinsic function at %L\",\n-\t\t     a->name, name, &a->expr->where);\n-\t  return false;\n \t}\n     }\n "}, {"sha": "bd9fe70d084c4110b7f05b1860090732fba45a80", "filename": "gcc/testsuite/ChangeLog", "status": "modified", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/c980510a5ab79614fcbaf5f411b1273dc9a8c7ca/gcc%2Ftestsuite%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/c980510a5ab79614fcbaf5f411b1273dc9a8c7ca/gcc%2Ftestsuite%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2FChangeLog?ref=c980510a5ab79614fcbaf5f411b1273dc9a8c7ca", "patch": "@@ -1,3 +1,8 @@\n+2019-08-28  Steven G. Kargl  <kargl@gcc.gnu.org>\n+\n+\tPR fortran/91551\n+ \t* gfortran.dg/allocated_3.f90\n+\n 2019-08-28  Marek Polacek  <polacek@redhat.com>\n \n \tPR c++/91360 - Implement C++20 P1143R2: constinit."}, {"sha": "66748d6142fe158c0b3b67ff839cba463a26d81d", "filename": "gcc/testsuite/gfortran.dg/allocated_3.f90", "status": "added", "additions": 6, "deletions": 0, "changes": 6, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/c980510a5ab79614fcbaf5f411b1273dc9a8c7ca/gcc%2Ftestsuite%2Fgfortran.dg%2Fallocated_3.f90", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/c980510a5ab79614fcbaf5f411b1273dc9a8c7ca/gcc%2Ftestsuite%2Fgfortran.dg%2Fallocated_3.f90", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgfortran.dg%2Fallocated_3.f90?ref=c980510a5ab79614fcbaf5f411b1273dc9a8c7ca", "patch": "@@ -0,0 +1,6 @@\n+! { dg-do compile }\n+! PR fortran/91551\n+! Contributed by Gerhard Steinmetz\n+program p\n+   if (allocated()) stop 1 ! { dg-error \"requires an array or scalar allocatable\" }\n+end"}]}