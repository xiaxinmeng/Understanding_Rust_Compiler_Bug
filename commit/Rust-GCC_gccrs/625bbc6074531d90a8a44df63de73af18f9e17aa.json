{"sha": "625bbc6074531d90a8a44df63de73af18f9e17aa", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6NjI1YmJjNjA3NDUzMWQ5MGE4YTQ0ZGY2M2RlNzNhZjE4ZjllMTdhYQ==", "commit": {"author": {"name": "Richard Stallman", "email": "rms@gnu.org", "date": "1993-01-26T06:00:49Z"}, "committer": {"name": "Richard Stallman", "email": "rms@gnu.org", "date": "1993-01-26T06:00:49Z"}, "message": "(handle_directive): Init already_output after old_linenum label.\n\n(finclude): Remove final backslash-newline *before* trigraph_pcp.\n(write_output): Free line_command at end.\n\nFrom-SVN: r3344", "tree": {"sha": "cb8325121a033431a2e8ac31d5a3c9b48e4f93bb", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/cb8325121a033431a2e8ac31d5a3c9b48e4f93bb"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/625bbc6074531d90a8a44df63de73af18f9e17aa", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/625bbc6074531d90a8a44df63de73af18f9e17aa", "html_url": "https://github.com/Rust-GCC/gccrs/commit/625bbc6074531d90a8a44df63de73af18f9e17aa", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/625bbc6074531d90a8a44df63de73af18f9e17aa/comments", "author": null, "committer": null, "parents": [{"sha": "716f003f91219c1a6997a7fcc960c796ca73a82e", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/716f003f91219c1a6997a7fcc960c796ca73a82e", "html_url": "https://github.com/Rust-GCC/gccrs/commit/716f003f91219c1a6997a7fcc960c796ca73a82e"}], "stats": {"total": 20, "additions": 11, "deletions": 9}, "files": [{"sha": "c28e3be624e4080c858f7d652ed78278be062c25", "filename": "gcc/cccp.c", "status": "modified", "additions": 11, "deletions": 9, "changes": 20, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/625bbc6074531d90a8a44df63de73af18f9e17aa/gcc%2Fcccp.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/625bbc6074531d90a8a44df63de73af18f9e17aa/gcc%2Fcccp.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fcccp.c?ref=625bbc6074531d90a8a44df63de73af18f9e17aa", "patch": "@@ -3232,7 +3232,7 @@ handle_directive (ip, op)\n       register U_CHAR *limit;\n       int unterminated;\n       int junk;\n-      int *already_output = 0;\n+      int *already_output;\n \n       /* Nonzero means do not delete comments within the directive.\n \t #define needs this when -traditional.  */\n@@ -3242,6 +3242,7 @@ handle_directive (ip, op)\n \n       limit = ip->buf + ip->length;\n       unterminated = 0;\n+      already_output = 0;\n       keep_comments = traditional && kt->traditional_comments;\n       /* #import is defined only in Objective C, or when on the NeXT.  */\n       if (kt->type == T_IMPORT && !(objc || lookup (\"__NeXT__\", -1, -1)))\n@@ -4183,6 +4184,14 @@ finclude (f, fname, op, system_header_p, dirptr)\n     fp->length = st_size;\n   }\n \n+  if ((fp->length > 0 && fp->buf[fp->length - 1] != '\\n')\n+      /* Backslash-newline at end is not good enough.  */\n+      || (fp->length > 1 && fp->buf[fp->length - 2] == '\\\\')) {\n+    fp->buf[fp->length++] = '\\n';\n+    missing_newline = 1;\n+  }\n+  fp->buf[fp->length] = '\\0';\n+\n   /* Close descriptor now, so nesting does not use lots of descriptors.  */\n   close (f);\n \n@@ -4195,14 +4204,6 @@ finclude (f, fname, op, system_header_p, dirptr)\n   if (!no_trigraphs)\n     trigraph_pcp (fp);\n \n-  if ((fp->length > 0 && fp->buf[fp->length - 1] != '\\n')\n-      /* Backslash-newline at end is not good enough.  */\n-      || (fp->length > 1 && fp->buf[fp->length - 2] == '\\\\')) {\n-    fp->buf[fp->length++] = '\\n';\n-    missing_newline = 1;\n-  }\n-  fp->buf[fp->length] = '\\0';\n-\n   output_line_command (fp, op, 0, enter_file);\n   rescan (op, 0);\n \n@@ -4646,6 +4647,7 @@ write_output ()\n       cur_buf_loc += len;\n     }\n   }\n+  free (line_command);\n }\n \n /* Pass a directive through to the output file."}]}