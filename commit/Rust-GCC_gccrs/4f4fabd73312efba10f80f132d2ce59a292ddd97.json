{"sha": "4f4fabd73312efba10f80f132d2ce59a292ddd97", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6NGY0ZmFiZDczMzEyZWZiYTEwZjgwZjEzMmQyY2U1OWEyOTJkZGQ5Nw==", "commit": {"author": {"name": "Thomas Koenig", "email": "tkoenig@gcc.gnu.org", "date": "2018-08-25T21:31:30Z"}, "committer": {"name": "Thomas Koenig", "email": "tkoenig@gcc.gnu.org", "date": "2018-08-25T21:31:30Z"}, "message": "re PR fortran/86704 (Segmentation fault when using matmul in combination with transpose)\n\n\n2018-08-25  Thomas Koenig  <tkoenig@gcc.gnu.org>\n\n\tPR libfortran/86704\n\t* m4/matmul_internal.m4: Correct calculation of needed buffer size\n\tfor arrays of shape (1,n).\n\t* generated/matmul_c10.c: Regenerated\n\t* generated/matmul_c16.c: Regenerated\n\t* generated/matmul_c4.c: Regenerated\n\t* generated/matmul_c8.c: Regenerated\n\t* generated/matmul_i1.c: Regenerated\n\t* generated/matmul_i16.c: Regenerated\n\t* generated/matmul_i2.c: Regenerated\n\t* generated/matmul_i4.c: Regenerated\n\t* generated/matmul_i8.c: Regenerated\n\t* generated/matmul_r10.c: Regenerated\n\t* generated/matmul_r16.c: Regenerated\n\t* generated/matmul_r4.c: Regenerated\n\t* generated/matmul_r8.c: Regenerated\n\t* generated/matmulavx128_c10.c: Regenerated\n\t* generated/matmulavx128_c16.c: Regenerated\n\t* generated/matmulavx128_c4.c: Regenerated\n\t* generated/matmulavx128_c8.c: Regenerated\n\t* generated/matmulavx128_i1.c: Regenerated\n\t* generated/matmulavx128_i16.c: Regenerated\n\t* generated/matmulavx128_i2.c: Regenerated\n\t* generated/matmulavx128_i4.c: Regenerated\n\t* generated/matmulavx128_i8.c: Regenerated\n\t* generated/matmulavx128_r10.c: Regenerated\n\t* generated/matmulavx128_r16.c: Regenerated\n\t* generated/matmulavx128_r4.c: Regenerated\n\t* generated/matmulavx128_r8.c: Regenerated\n\n2018-08-25  Thomas Koenig  <tkoenig@gcc.gnu.org>\n\n\tPR libfortran/86704\n\t* gfortran.dg/matmul_19.f90: New test.\n\nFrom-SVN: r263856", "tree": {"sha": "332d44ca7342e070ab53768b1c83f53df8006a76", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/332d44ca7342e070ab53768b1c83f53df8006a76"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/4f4fabd73312efba10f80f132d2ce59a292ddd97", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/4f4fabd73312efba10f80f132d2ce59a292ddd97", "html_url": "https://github.com/Rust-GCC/gccrs/commit/4f4fabd73312efba10f80f132d2ce59a292ddd97", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/4f4fabd73312efba10f80f132d2ce59a292ddd97/comments", "author": null, "committer": null, "parents": [{"sha": "75e96bc80cf32a302c27bdbbec1ec7119a690857", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/75e96bc80cf32a302c27bdbbec1ec7119a690857", "html_url": "https://github.com/Rust-GCC/gccrs/commit/75e96bc80cf32a302c27bdbbec1ec7119a690857"}], "stats": {"total": 890, "additions": 706, "deletions": 184}, "files": [{"sha": "67f4cdedbb043359f6cf7b0ce29e10ceb2546a17", "filename": "gcc/testsuite/ChangeLog", "status": "modified", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/4f4fabd73312efba10f80f132d2ce59a292ddd97/gcc%2Ftestsuite%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/4f4fabd73312efba10f80f132d2ce59a292ddd97/gcc%2Ftestsuite%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2FChangeLog?ref=4f4fabd73312efba10f80f132d2ce59a292ddd97", "patch": "@@ -1,3 +1,8 @@\n+2018-08-25  Thomas Koenig  <tkoenig@gcc.gnu.org>\n+\n+\tPR libfortran/86704\n+\t* gfortran.dg/matmul_19.f90: New test.\n+\n 2018-08-25  Janus Weil  <janus@gcc.gnu.org>\n \n \tPR fortran/86545"}, {"sha": "c4549240c1f53e1f006112ed223cb4ec7f99cd3a", "filename": "gcc/testsuite/gfortran.dg/matmul_19.f90", "status": "added", "additions": 25, "deletions": 0, "changes": 25, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/4f4fabd73312efba10f80f132d2ce59a292ddd97/gcc%2Ftestsuite%2Fgfortran.dg%2Fmatmul_19.f90", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/4f4fabd73312efba10f80f132d2ce59a292ddd97/gcc%2Ftestsuite%2Fgfortran.dg%2Fmatmul_19.f90", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgfortran.dg%2Fmatmul_19.f90?ref=4f4fabd73312efba10f80f132d2ce59a292ddd97", "patch": "@@ -0,0 +1,25 @@\n+! { dg-do  run }\n+! { dg-options \"-finline-matmul-limit=0\" }\n+! PR 86704 - this used to segfault.\n+\n+program testmaticovenasobeni\n+implicit none\n+  \n+  character(len=10) :: line\n+  write (unit=line,fmt=*) testmatmul(120,1,3)\n+\n+  contains\n+\n+   function testmatmul(m,n,o)\n+     integer, intent(in) :: m,n,o\n+     real    :: A(n,m),B(n,o),C(m,o)\n+     logical :: testmatmul\n+    \n+     call random_number(A)\n+     call random_number(B)\n+     \n+     C=matmul(transpose(A),B) \n+     testmatmul=.true.\n+   end function \n+\n+end program testmaticovenasobeni"}, {"sha": "76228e26b693b795a0406811a7187cae0849a7b7", "filename": "libgfortran/ChangeLog", "status": "modified", "additions": 32, "deletions": 0, "changes": 32, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/4f4fabd73312efba10f80f132d2ce59a292ddd97/libgfortran%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/4f4fabd73312efba10f80f132d2ce59a292ddd97/libgfortran%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libgfortran%2FChangeLog?ref=4f4fabd73312efba10f80f132d2ce59a292ddd97", "patch": "@@ -1,3 +1,35 @@\n+2018-08-25  Thomas Koenig  <tkoenig@gcc.gnu.org>\n+\n+\tPR libfortran/86704\n+\t* m4/matmul_internal.m4: Correct calculation of needed buffer size\n+\tfor arrays of shape (1,n).\n+\t* generated/matmul_c10.c: Regenerated\n+\t* generated/matmul_c16.c: Regenerated\n+\t* generated/matmul_c4.c: Regenerated\n+\t* generated/matmul_c8.c: Regenerated\n+\t* generated/matmul_i1.c: Regenerated\n+\t* generated/matmul_i16.c: Regenerated\n+\t* generated/matmul_i2.c: Regenerated\n+\t* generated/matmul_i4.c: Regenerated\n+\t* generated/matmul_i8.c: Regenerated\n+\t* generated/matmul_r10.c: Regenerated\n+\t* generated/matmul_r16.c: Regenerated\n+\t* generated/matmul_r4.c: Regenerated\n+\t* generated/matmul_r8.c: Regenerated\n+\t* generated/matmulavx128_c10.c: Regenerated\n+\t* generated/matmulavx128_c16.c: Regenerated\n+\t* generated/matmulavx128_c4.c: Regenerated\n+\t* generated/matmulavx128_c8.c: Regenerated\n+\t* generated/matmulavx128_i1.c: Regenerated\n+\t* generated/matmulavx128_i16.c: Regenerated\n+\t* generated/matmulavx128_i2.c: Regenerated\n+\t* generated/matmulavx128_i4.c: Regenerated\n+\t* generated/matmulavx128_i8.c: Regenerated\n+\t* generated/matmulavx128_r10.c: Regenerated\n+\t* generated/matmulavx128_r16.c: Regenerated\n+\t* generated/matmulavx128_r4.c: Regenerated\n+\t* generated/matmulavx128_r8.c: Regenerated\n+\n 2018-08-23  David Edelsohn  <dje.gcc@gmail.com>\n \n \t* async.h (ASYNC_IO): Revert _AIX test."}, {"sha": "462d71e23f5aa95d656aee8771f2aa9327964406", "filename": "libgfortran/generated/matmul_c10.c", "status": "modified", "additions": 35, "deletions": 10, "changes": 45, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/4f4fabd73312efba10f80f132d2ce59a292ddd97/libgfortran%2Fgenerated%2Fmatmul_c10.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/4f4fabd73312efba10f80f132d2ce59a292ddd97/libgfortran%2Fgenerated%2Fmatmul_c10.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libgfortran%2Fgenerated%2Fmatmul_c10.c?ref=4f4fabd73312efba10f80f132d2ce59a292ddd97", "patch": "@@ -317,8 +317,13 @@ matmul_c10_avx (gfc_array_c10 * const restrict retarray,\n \treturn;\n \n       /* Adjust size of t1 to what is needed.  */\n-      index_type t1_dim;\n-      t1_dim = (a_dim1 - (ycount > 1)) * 256 + b_dim1;\n+      index_type t1_dim, a_sz;\n+      if (aystride == 1)\n+        a_sz = rystride;\n+      else\n+        a_sz = a_dim1;\n+\n+      t1_dim = a_sz * 256 + b_dim1;\n       if (t1_dim > 65536)\n \tt1_dim = 65536;\n \n@@ -869,8 +874,13 @@ matmul_c10_avx2 (gfc_array_c10 * const restrict retarray,\n \treturn;\n \n       /* Adjust size of t1 to what is needed.  */\n-      index_type t1_dim;\n-      t1_dim = (a_dim1 - (ycount > 1)) * 256 + b_dim1;\n+      index_type t1_dim, a_sz;\n+      if (aystride == 1)\n+        a_sz = rystride;\n+      else\n+        a_sz = a_dim1;\n+\n+      t1_dim = a_sz * 256 + b_dim1;\n       if (t1_dim > 65536)\n \tt1_dim = 65536;\n \n@@ -1421,8 +1431,13 @@ matmul_c10_avx512f (gfc_array_c10 * const restrict retarray,\n \treturn;\n \n       /* Adjust size of t1 to what is needed.  */\n-      index_type t1_dim;\n-      t1_dim = (a_dim1 - (ycount > 1)) * 256 + b_dim1;\n+      index_type t1_dim, a_sz;\n+      if (aystride == 1)\n+        a_sz = rystride;\n+      else\n+        a_sz = a_dim1;\n+\n+      t1_dim = a_sz * 256 + b_dim1;\n       if (t1_dim > 65536)\n \tt1_dim = 65536;\n \n@@ -1987,8 +2002,13 @@ matmul_c10_vanilla (gfc_array_c10 * const restrict retarray,\n \treturn;\n \n       /* Adjust size of t1 to what is needed.  */\n-      index_type t1_dim;\n-      t1_dim = (a_dim1 - (ycount > 1)) * 256 + b_dim1;\n+      index_type t1_dim, a_sz;\n+      if (aystride == 1)\n+        a_sz = rystride;\n+      else\n+        a_sz = a_dim1;\n+\n+      t1_dim = a_sz * 256 + b_dim1;\n       if (t1_dim > 65536)\n \tt1_dim = 65536;\n \n@@ -2613,8 +2633,13 @@ matmul_c10 (gfc_array_c10 * const restrict retarray,\n \treturn;\n \n       /* Adjust size of t1 to what is needed.  */\n-      index_type t1_dim;\n-      t1_dim = (a_dim1 - (ycount > 1)) * 256 + b_dim1;\n+      index_type t1_dim, a_sz;\n+      if (aystride == 1)\n+        a_sz = rystride;\n+      else\n+        a_sz = a_dim1;\n+\n+      t1_dim = a_sz * 256 + b_dim1;\n       if (t1_dim > 65536)\n \tt1_dim = 65536;\n "}, {"sha": "2062739ce1f440e4dd4fc8662118198be35556e7", "filename": "libgfortran/generated/matmul_c16.c", "status": "modified", "additions": 35, "deletions": 10, "changes": 45, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/4f4fabd73312efba10f80f132d2ce59a292ddd97/libgfortran%2Fgenerated%2Fmatmul_c16.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/4f4fabd73312efba10f80f132d2ce59a292ddd97/libgfortran%2Fgenerated%2Fmatmul_c16.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libgfortran%2Fgenerated%2Fmatmul_c16.c?ref=4f4fabd73312efba10f80f132d2ce59a292ddd97", "patch": "@@ -317,8 +317,13 @@ matmul_c16_avx (gfc_array_c16 * const restrict retarray,\n \treturn;\n \n       /* Adjust size of t1 to what is needed.  */\n-      index_type t1_dim;\n-      t1_dim = (a_dim1 - (ycount > 1)) * 256 + b_dim1;\n+      index_type t1_dim, a_sz;\n+      if (aystride == 1)\n+        a_sz = rystride;\n+      else\n+        a_sz = a_dim1;\n+\n+      t1_dim = a_sz * 256 + b_dim1;\n       if (t1_dim > 65536)\n \tt1_dim = 65536;\n \n@@ -869,8 +874,13 @@ matmul_c16_avx2 (gfc_array_c16 * const restrict retarray,\n \treturn;\n \n       /* Adjust size of t1 to what is needed.  */\n-      index_type t1_dim;\n-      t1_dim = (a_dim1 - (ycount > 1)) * 256 + b_dim1;\n+      index_type t1_dim, a_sz;\n+      if (aystride == 1)\n+        a_sz = rystride;\n+      else\n+        a_sz = a_dim1;\n+\n+      t1_dim = a_sz * 256 + b_dim1;\n       if (t1_dim > 65536)\n \tt1_dim = 65536;\n \n@@ -1421,8 +1431,13 @@ matmul_c16_avx512f (gfc_array_c16 * const restrict retarray,\n \treturn;\n \n       /* Adjust size of t1 to what is needed.  */\n-      index_type t1_dim;\n-      t1_dim = (a_dim1 - (ycount > 1)) * 256 + b_dim1;\n+      index_type t1_dim, a_sz;\n+      if (aystride == 1)\n+        a_sz = rystride;\n+      else\n+        a_sz = a_dim1;\n+\n+      t1_dim = a_sz * 256 + b_dim1;\n       if (t1_dim > 65536)\n \tt1_dim = 65536;\n \n@@ -1987,8 +2002,13 @@ matmul_c16_vanilla (gfc_array_c16 * const restrict retarray,\n \treturn;\n \n       /* Adjust size of t1 to what is needed.  */\n-      index_type t1_dim;\n-      t1_dim = (a_dim1 - (ycount > 1)) * 256 + b_dim1;\n+      index_type t1_dim, a_sz;\n+      if (aystride == 1)\n+        a_sz = rystride;\n+      else\n+        a_sz = a_dim1;\n+\n+      t1_dim = a_sz * 256 + b_dim1;\n       if (t1_dim > 65536)\n \tt1_dim = 65536;\n \n@@ -2613,8 +2633,13 @@ matmul_c16 (gfc_array_c16 * const restrict retarray,\n \treturn;\n \n       /* Adjust size of t1 to what is needed.  */\n-      index_type t1_dim;\n-      t1_dim = (a_dim1 - (ycount > 1)) * 256 + b_dim1;\n+      index_type t1_dim, a_sz;\n+      if (aystride == 1)\n+        a_sz = rystride;\n+      else\n+        a_sz = a_dim1;\n+\n+      t1_dim = a_sz * 256 + b_dim1;\n       if (t1_dim > 65536)\n \tt1_dim = 65536;\n "}, {"sha": "91d193dca375398157876f24d742f4b435e0beda", "filename": "libgfortran/generated/matmul_c4.c", "status": "modified", "additions": 35, "deletions": 10, "changes": 45, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/4f4fabd73312efba10f80f132d2ce59a292ddd97/libgfortran%2Fgenerated%2Fmatmul_c4.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/4f4fabd73312efba10f80f132d2ce59a292ddd97/libgfortran%2Fgenerated%2Fmatmul_c4.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libgfortran%2Fgenerated%2Fmatmul_c4.c?ref=4f4fabd73312efba10f80f132d2ce59a292ddd97", "patch": "@@ -317,8 +317,13 @@ matmul_c4_avx (gfc_array_c4 * const restrict retarray,\n \treturn;\n \n       /* Adjust size of t1 to what is needed.  */\n-      index_type t1_dim;\n-      t1_dim = (a_dim1 - (ycount > 1)) * 256 + b_dim1;\n+      index_type t1_dim, a_sz;\n+      if (aystride == 1)\n+        a_sz = rystride;\n+      else\n+        a_sz = a_dim1;\n+\n+      t1_dim = a_sz * 256 + b_dim1;\n       if (t1_dim > 65536)\n \tt1_dim = 65536;\n \n@@ -869,8 +874,13 @@ matmul_c4_avx2 (gfc_array_c4 * const restrict retarray,\n \treturn;\n \n       /* Adjust size of t1 to what is needed.  */\n-      index_type t1_dim;\n-      t1_dim = (a_dim1 - (ycount > 1)) * 256 + b_dim1;\n+      index_type t1_dim, a_sz;\n+      if (aystride == 1)\n+        a_sz = rystride;\n+      else\n+        a_sz = a_dim1;\n+\n+      t1_dim = a_sz * 256 + b_dim1;\n       if (t1_dim > 65536)\n \tt1_dim = 65536;\n \n@@ -1421,8 +1431,13 @@ matmul_c4_avx512f (gfc_array_c4 * const restrict retarray,\n \treturn;\n \n       /* Adjust size of t1 to what is needed.  */\n-      index_type t1_dim;\n-      t1_dim = (a_dim1 - (ycount > 1)) * 256 + b_dim1;\n+      index_type t1_dim, a_sz;\n+      if (aystride == 1)\n+        a_sz = rystride;\n+      else\n+        a_sz = a_dim1;\n+\n+      t1_dim = a_sz * 256 + b_dim1;\n       if (t1_dim > 65536)\n \tt1_dim = 65536;\n \n@@ -1987,8 +2002,13 @@ matmul_c4_vanilla (gfc_array_c4 * const restrict retarray,\n \treturn;\n \n       /* Adjust size of t1 to what is needed.  */\n-      index_type t1_dim;\n-      t1_dim = (a_dim1 - (ycount > 1)) * 256 + b_dim1;\n+      index_type t1_dim, a_sz;\n+      if (aystride == 1)\n+        a_sz = rystride;\n+      else\n+        a_sz = a_dim1;\n+\n+      t1_dim = a_sz * 256 + b_dim1;\n       if (t1_dim > 65536)\n \tt1_dim = 65536;\n \n@@ -2613,8 +2633,13 @@ matmul_c4 (gfc_array_c4 * const restrict retarray,\n \treturn;\n \n       /* Adjust size of t1 to what is needed.  */\n-      index_type t1_dim;\n-      t1_dim = (a_dim1 - (ycount > 1)) * 256 + b_dim1;\n+      index_type t1_dim, a_sz;\n+      if (aystride == 1)\n+        a_sz = rystride;\n+      else\n+        a_sz = a_dim1;\n+\n+      t1_dim = a_sz * 256 + b_dim1;\n       if (t1_dim > 65536)\n \tt1_dim = 65536;\n "}, {"sha": "425af85d1bba34b4ec2887acd987ac15e0a82475", "filename": "libgfortran/generated/matmul_c8.c", "status": "modified", "additions": 35, "deletions": 10, "changes": 45, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/4f4fabd73312efba10f80f132d2ce59a292ddd97/libgfortran%2Fgenerated%2Fmatmul_c8.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/4f4fabd73312efba10f80f132d2ce59a292ddd97/libgfortran%2Fgenerated%2Fmatmul_c8.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libgfortran%2Fgenerated%2Fmatmul_c8.c?ref=4f4fabd73312efba10f80f132d2ce59a292ddd97", "patch": "@@ -317,8 +317,13 @@ matmul_c8_avx (gfc_array_c8 * const restrict retarray,\n \treturn;\n \n       /* Adjust size of t1 to what is needed.  */\n-      index_type t1_dim;\n-      t1_dim = (a_dim1 - (ycount > 1)) * 256 + b_dim1;\n+      index_type t1_dim, a_sz;\n+      if (aystride == 1)\n+        a_sz = rystride;\n+      else\n+        a_sz = a_dim1;\n+\n+      t1_dim = a_sz * 256 + b_dim1;\n       if (t1_dim > 65536)\n \tt1_dim = 65536;\n \n@@ -869,8 +874,13 @@ matmul_c8_avx2 (gfc_array_c8 * const restrict retarray,\n \treturn;\n \n       /* Adjust size of t1 to what is needed.  */\n-      index_type t1_dim;\n-      t1_dim = (a_dim1 - (ycount > 1)) * 256 + b_dim1;\n+      index_type t1_dim, a_sz;\n+      if (aystride == 1)\n+        a_sz = rystride;\n+      else\n+        a_sz = a_dim1;\n+\n+      t1_dim = a_sz * 256 + b_dim1;\n       if (t1_dim > 65536)\n \tt1_dim = 65536;\n \n@@ -1421,8 +1431,13 @@ matmul_c8_avx512f (gfc_array_c8 * const restrict retarray,\n \treturn;\n \n       /* Adjust size of t1 to what is needed.  */\n-      index_type t1_dim;\n-      t1_dim = (a_dim1 - (ycount > 1)) * 256 + b_dim1;\n+      index_type t1_dim, a_sz;\n+      if (aystride == 1)\n+        a_sz = rystride;\n+      else\n+        a_sz = a_dim1;\n+\n+      t1_dim = a_sz * 256 + b_dim1;\n       if (t1_dim > 65536)\n \tt1_dim = 65536;\n \n@@ -1987,8 +2002,13 @@ matmul_c8_vanilla (gfc_array_c8 * const restrict retarray,\n \treturn;\n \n       /* Adjust size of t1 to what is needed.  */\n-      index_type t1_dim;\n-      t1_dim = (a_dim1 - (ycount > 1)) * 256 + b_dim1;\n+      index_type t1_dim, a_sz;\n+      if (aystride == 1)\n+        a_sz = rystride;\n+      else\n+        a_sz = a_dim1;\n+\n+      t1_dim = a_sz * 256 + b_dim1;\n       if (t1_dim > 65536)\n \tt1_dim = 65536;\n \n@@ -2613,8 +2633,13 @@ matmul_c8 (gfc_array_c8 * const restrict retarray,\n \treturn;\n \n       /* Adjust size of t1 to what is needed.  */\n-      index_type t1_dim;\n-      t1_dim = (a_dim1 - (ycount > 1)) * 256 + b_dim1;\n+      index_type t1_dim, a_sz;\n+      if (aystride == 1)\n+        a_sz = rystride;\n+      else\n+        a_sz = a_dim1;\n+\n+      t1_dim = a_sz * 256 + b_dim1;\n       if (t1_dim > 65536)\n \tt1_dim = 65536;\n "}, {"sha": "0c9335d4322fe36965f9ee215b1da02fe520df7d", "filename": "libgfortran/generated/matmul_i1.c", "status": "modified", "additions": 35, "deletions": 10, "changes": 45, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/4f4fabd73312efba10f80f132d2ce59a292ddd97/libgfortran%2Fgenerated%2Fmatmul_i1.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/4f4fabd73312efba10f80f132d2ce59a292ddd97/libgfortran%2Fgenerated%2Fmatmul_i1.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libgfortran%2Fgenerated%2Fmatmul_i1.c?ref=4f4fabd73312efba10f80f132d2ce59a292ddd97", "patch": "@@ -317,8 +317,13 @@ matmul_i1_avx (gfc_array_i1 * const restrict retarray,\n \treturn;\n \n       /* Adjust size of t1 to what is needed.  */\n-      index_type t1_dim;\n-      t1_dim = (a_dim1 - (ycount > 1)) * 256 + b_dim1;\n+      index_type t1_dim, a_sz;\n+      if (aystride == 1)\n+        a_sz = rystride;\n+      else\n+        a_sz = a_dim1;\n+\n+      t1_dim = a_sz * 256 + b_dim1;\n       if (t1_dim > 65536)\n \tt1_dim = 65536;\n \n@@ -869,8 +874,13 @@ matmul_i1_avx2 (gfc_array_i1 * const restrict retarray,\n \treturn;\n \n       /* Adjust size of t1 to what is needed.  */\n-      index_type t1_dim;\n-      t1_dim = (a_dim1 - (ycount > 1)) * 256 + b_dim1;\n+      index_type t1_dim, a_sz;\n+      if (aystride == 1)\n+        a_sz = rystride;\n+      else\n+        a_sz = a_dim1;\n+\n+      t1_dim = a_sz * 256 + b_dim1;\n       if (t1_dim > 65536)\n \tt1_dim = 65536;\n \n@@ -1421,8 +1431,13 @@ matmul_i1_avx512f (gfc_array_i1 * const restrict retarray,\n \treturn;\n \n       /* Adjust size of t1 to what is needed.  */\n-      index_type t1_dim;\n-      t1_dim = (a_dim1 - (ycount > 1)) * 256 + b_dim1;\n+      index_type t1_dim, a_sz;\n+      if (aystride == 1)\n+        a_sz = rystride;\n+      else\n+        a_sz = a_dim1;\n+\n+      t1_dim = a_sz * 256 + b_dim1;\n       if (t1_dim > 65536)\n \tt1_dim = 65536;\n \n@@ -1987,8 +2002,13 @@ matmul_i1_vanilla (gfc_array_i1 * const restrict retarray,\n \treturn;\n \n       /* Adjust size of t1 to what is needed.  */\n-      index_type t1_dim;\n-      t1_dim = (a_dim1 - (ycount > 1)) * 256 + b_dim1;\n+      index_type t1_dim, a_sz;\n+      if (aystride == 1)\n+        a_sz = rystride;\n+      else\n+        a_sz = a_dim1;\n+\n+      t1_dim = a_sz * 256 + b_dim1;\n       if (t1_dim > 65536)\n \tt1_dim = 65536;\n \n@@ -2613,8 +2633,13 @@ matmul_i1 (gfc_array_i1 * const restrict retarray,\n \treturn;\n \n       /* Adjust size of t1 to what is needed.  */\n-      index_type t1_dim;\n-      t1_dim = (a_dim1 - (ycount > 1)) * 256 + b_dim1;\n+      index_type t1_dim, a_sz;\n+      if (aystride == 1)\n+        a_sz = rystride;\n+      else\n+        a_sz = a_dim1;\n+\n+      t1_dim = a_sz * 256 + b_dim1;\n       if (t1_dim > 65536)\n \tt1_dim = 65536;\n "}, {"sha": "b9334b3278fd70777dfd501984196cb064db2988", "filename": "libgfortran/generated/matmul_i16.c", "status": "modified", "additions": 35, "deletions": 10, "changes": 45, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/4f4fabd73312efba10f80f132d2ce59a292ddd97/libgfortran%2Fgenerated%2Fmatmul_i16.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/4f4fabd73312efba10f80f132d2ce59a292ddd97/libgfortran%2Fgenerated%2Fmatmul_i16.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libgfortran%2Fgenerated%2Fmatmul_i16.c?ref=4f4fabd73312efba10f80f132d2ce59a292ddd97", "patch": "@@ -317,8 +317,13 @@ matmul_i16_avx (gfc_array_i16 * const restrict retarray,\n \treturn;\n \n       /* Adjust size of t1 to what is needed.  */\n-      index_type t1_dim;\n-      t1_dim = (a_dim1 - (ycount > 1)) * 256 + b_dim1;\n+      index_type t1_dim, a_sz;\n+      if (aystride == 1)\n+        a_sz = rystride;\n+      else\n+        a_sz = a_dim1;\n+\n+      t1_dim = a_sz * 256 + b_dim1;\n       if (t1_dim > 65536)\n \tt1_dim = 65536;\n \n@@ -869,8 +874,13 @@ matmul_i16_avx2 (gfc_array_i16 * const restrict retarray,\n \treturn;\n \n       /* Adjust size of t1 to what is needed.  */\n-      index_type t1_dim;\n-      t1_dim = (a_dim1 - (ycount > 1)) * 256 + b_dim1;\n+      index_type t1_dim, a_sz;\n+      if (aystride == 1)\n+        a_sz = rystride;\n+      else\n+        a_sz = a_dim1;\n+\n+      t1_dim = a_sz * 256 + b_dim1;\n       if (t1_dim > 65536)\n \tt1_dim = 65536;\n \n@@ -1421,8 +1431,13 @@ matmul_i16_avx512f (gfc_array_i16 * const restrict retarray,\n \treturn;\n \n       /* Adjust size of t1 to what is needed.  */\n-      index_type t1_dim;\n-      t1_dim = (a_dim1 - (ycount > 1)) * 256 + b_dim1;\n+      index_type t1_dim, a_sz;\n+      if (aystride == 1)\n+        a_sz = rystride;\n+      else\n+        a_sz = a_dim1;\n+\n+      t1_dim = a_sz * 256 + b_dim1;\n       if (t1_dim > 65536)\n \tt1_dim = 65536;\n \n@@ -1987,8 +2002,13 @@ matmul_i16_vanilla (gfc_array_i16 * const restrict retarray,\n \treturn;\n \n       /* Adjust size of t1 to what is needed.  */\n-      index_type t1_dim;\n-      t1_dim = (a_dim1 - (ycount > 1)) * 256 + b_dim1;\n+      index_type t1_dim, a_sz;\n+      if (aystride == 1)\n+        a_sz = rystride;\n+      else\n+        a_sz = a_dim1;\n+\n+      t1_dim = a_sz * 256 + b_dim1;\n       if (t1_dim > 65536)\n \tt1_dim = 65536;\n \n@@ -2613,8 +2633,13 @@ matmul_i16 (gfc_array_i16 * const restrict retarray,\n \treturn;\n \n       /* Adjust size of t1 to what is needed.  */\n-      index_type t1_dim;\n-      t1_dim = (a_dim1 - (ycount > 1)) * 256 + b_dim1;\n+      index_type t1_dim, a_sz;\n+      if (aystride == 1)\n+        a_sz = rystride;\n+      else\n+        a_sz = a_dim1;\n+\n+      t1_dim = a_sz * 256 + b_dim1;\n       if (t1_dim > 65536)\n \tt1_dim = 65536;\n "}, {"sha": "e4246e948df61d393a2ddd5536b6bce1ec20418e", "filename": "libgfortran/generated/matmul_i2.c", "status": "modified", "additions": 35, "deletions": 10, "changes": 45, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/4f4fabd73312efba10f80f132d2ce59a292ddd97/libgfortran%2Fgenerated%2Fmatmul_i2.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/4f4fabd73312efba10f80f132d2ce59a292ddd97/libgfortran%2Fgenerated%2Fmatmul_i2.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libgfortran%2Fgenerated%2Fmatmul_i2.c?ref=4f4fabd73312efba10f80f132d2ce59a292ddd97", "patch": "@@ -317,8 +317,13 @@ matmul_i2_avx (gfc_array_i2 * const restrict retarray,\n \treturn;\n \n       /* Adjust size of t1 to what is needed.  */\n-      index_type t1_dim;\n-      t1_dim = (a_dim1 - (ycount > 1)) * 256 + b_dim1;\n+      index_type t1_dim, a_sz;\n+      if (aystride == 1)\n+        a_sz = rystride;\n+      else\n+        a_sz = a_dim1;\n+\n+      t1_dim = a_sz * 256 + b_dim1;\n       if (t1_dim > 65536)\n \tt1_dim = 65536;\n \n@@ -869,8 +874,13 @@ matmul_i2_avx2 (gfc_array_i2 * const restrict retarray,\n \treturn;\n \n       /* Adjust size of t1 to what is needed.  */\n-      index_type t1_dim;\n-      t1_dim = (a_dim1 - (ycount > 1)) * 256 + b_dim1;\n+      index_type t1_dim, a_sz;\n+      if (aystride == 1)\n+        a_sz = rystride;\n+      else\n+        a_sz = a_dim1;\n+\n+      t1_dim = a_sz * 256 + b_dim1;\n       if (t1_dim > 65536)\n \tt1_dim = 65536;\n \n@@ -1421,8 +1431,13 @@ matmul_i2_avx512f (gfc_array_i2 * const restrict retarray,\n \treturn;\n \n       /* Adjust size of t1 to what is needed.  */\n-      index_type t1_dim;\n-      t1_dim = (a_dim1 - (ycount > 1)) * 256 + b_dim1;\n+      index_type t1_dim, a_sz;\n+      if (aystride == 1)\n+        a_sz = rystride;\n+      else\n+        a_sz = a_dim1;\n+\n+      t1_dim = a_sz * 256 + b_dim1;\n       if (t1_dim > 65536)\n \tt1_dim = 65536;\n \n@@ -1987,8 +2002,13 @@ matmul_i2_vanilla (gfc_array_i2 * const restrict retarray,\n \treturn;\n \n       /* Adjust size of t1 to what is needed.  */\n-      index_type t1_dim;\n-      t1_dim = (a_dim1 - (ycount > 1)) * 256 + b_dim1;\n+      index_type t1_dim, a_sz;\n+      if (aystride == 1)\n+        a_sz = rystride;\n+      else\n+        a_sz = a_dim1;\n+\n+      t1_dim = a_sz * 256 + b_dim1;\n       if (t1_dim > 65536)\n \tt1_dim = 65536;\n \n@@ -2613,8 +2633,13 @@ matmul_i2 (gfc_array_i2 * const restrict retarray,\n \treturn;\n \n       /* Adjust size of t1 to what is needed.  */\n-      index_type t1_dim;\n-      t1_dim = (a_dim1 - (ycount > 1)) * 256 + b_dim1;\n+      index_type t1_dim, a_sz;\n+      if (aystride == 1)\n+        a_sz = rystride;\n+      else\n+        a_sz = a_dim1;\n+\n+      t1_dim = a_sz * 256 + b_dim1;\n       if (t1_dim > 65536)\n \tt1_dim = 65536;\n "}, {"sha": "78cf27c4fcdbc1e93a70441c8a4f3f6b111991ee", "filename": "libgfortran/generated/matmul_i4.c", "status": "modified", "additions": 35, "deletions": 10, "changes": 45, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/4f4fabd73312efba10f80f132d2ce59a292ddd97/libgfortran%2Fgenerated%2Fmatmul_i4.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/4f4fabd73312efba10f80f132d2ce59a292ddd97/libgfortran%2Fgenerated%2Fmatmul_i4.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libgfortran%2Fgenerated%2Fmatmul_i4.c?ref=4f4fabd73312efba10f80f132d2ce59a292ddd97", "patch": "@@ -317,8 +317,13 @@ matmul_i4_avx (gfc_array_i4 * const restrict retarray,\n \treturn;\n \n       /* Adjust size of t1 to what is needed.  */\n-      index_type t1_dim;\n-      t1_dim = (a_dim1 - (ycount > 1)) * 256 + b_dim1;\n+      index_type t1_dim, a_sz;\n+      if (aystride == 1)\n+        a_sz = rystride;\n+      else\n+        a_sz = a_dim1;\n+\n+      t1_dim = a_sz * 256 + b_dim1;\n       if (t1_dim > 65536)\n \tt1_dim = 65536;\n \n@@ -869,8 +874,13 @@ matmul_i4_avx2 (gfc_array_i4 * const restrict retarray,\n \treturn;\n \n       /* Adjust size of t1 to what is needed.  */\n-      index_type t1_dim;\n-      t1_dim = (a_dim1 - (ycount > 1)) * 256 + b_dim1;\n+      index_type t1_dim, a_sz;\n+      if (aystride == 1)\n+        a_sz = rystride;\n+      else\n+        a_sz = a_dim1;\n+\n+      t1_dim = a_sz * 256 + b_dim1;\n       if (t1_dim > 65536)\n \tt1_dim = 65536;\n \n@@ -1421,8 +1431,13 @@ matmul_i4_avx512f (gfc_array_i4 * const restrict retarray,\n \treturn;\n \n       /* Adjust size of t1 to what is needed.  */\n-      index_type t1_dim;\n-      t1_dim = (a_dim1 - (ycount > 1)) * 256 + b_dim1;\n+      index_type t1_dim, a_sz;\n+      if (aystride == 1)\n+        a_sz = rystride;\n+      else\n+        a_sz = a_dim1;\n+\n+      t1_dim = a_sz * 256 + b_dim1;\n       if (t1_dim > 65536)\n \tt1_dim = 65536;\n \n@@ -1987,8 +2002,13 @@ matmul_i4_vanilla (gfc_array_i4 * const restrict retarray,\n \treturn;\n \n       /* Adjust size of t1 to what is needed.  */\n-      index_type t1_dim;\n-      t1_dim = (a_dim1 - (ycount > 1)) * 256 + b_dim1;\n+      index_type t1_dim, a_sz;\n+      if (aystride == 1)\n+        a_sz = rystride;\n+      else\n+        a_sz = a_dim1;\n+\n+      t1_dim = a_sz * 256 + b_dim1;\n       if (t1_dim > 65536)\n \tt1_dim = 65536;\n \n@@ -2613,8 +2633,13 @@ matmul_i4 (gfc_array_i4 * const restrict retarray,\n \treturn;\n \n       /* Adjust size of t1 to what is needed.  */\n-      index_type t1_dim;\n-      t1_dim = (a_dim1 - (ycount > 1)) * 256 + b_dim1;\n+      index_type t1_dim, a_sz;\n+      if (aystride == 1)\n+        a_sz = rystride;\n+      else\n+        a_sz = a_dim1;\n+\n+      t1_dim = a_sz * 256 + b_dim1;\n       if (t1_dim > 65536)\n \tt1_dim = 65536;\n "}, {"sha": "cf8c401400dfba144fdb37113f3b26a4fe32e6bb", "filename": "libgfortran/generated/matmul_i8.c", "status": "modified", "additions": 35, "deletions": 10, "changes": 45, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/4f4fabd73312efba10f80f132d2ce59a292ddd97/libgfortran%2Fgenerated%2Fmatmul_i8.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/4f4fabd73312efba10f80f132d2ce59a292ddd97/libgfortran%2Fgenerated%2Fmatmul_i8.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libgfortran%2Fgenerated%2Fmatmul_i8.c?ref=4f4fabd73312efba10f80f132d2ce59a292ddd97", "patch": "@@ -317,8 +317,13 @@ matmul_i8_avx (gfc_array_i8 * const restrict retarray,\n \treturn;\n \n       /* Adjust size of t1 to what is needed.  */\n-      index_type t1_dim;\n-      t1_dim = (a_dim1 - (ycount > 1)) * 256 + b_dim1;\n+      index_type t1_dim, a_sz;\n+      if (aystride == 1)\n+        a_sz = rystride;\n+      else\n+        a_sz = a_dim1;\n+\n+      t1_dim = a_sz * 256 + b_dim1;\n       if (t1_dim > 65536)\n \tt1_dim = 65536;\n \n@@ -869,8 +874,13 @@ matmul_i8_avx2 (gfc_array_i8 * const restrict retarray,\n \treturn;\n \n       /* Adjust size of t1 to what is needed.  */\n-      index_type t1_dim;\n-      t1_dim = (a_dim1 - (ycount > 1)) * 256 + b_dim1;\n+      index_type t1_dim, a_sz;\n+      if (aystride == 1)\n+        a_sz = rystride;\n+      else\n+        a_sz = a_dim1;\n+\n+      t1_dim = a_sz * 256 + b_dim1;\n       if (t1_dim > 65536)\n \tt1_dim = 65536;\n \n@@ -1421,8 +1431,13 @@ matmul_i8_avx512f (gfc_array_i8 * const restrict retarray,\n \treturn;\n \n       /* Adjust size of t1 to what is needed.  */\n-      index_type t1_dim;\n-      t1_dim = (a_dim1 - (ycount > 1)) * 256 + b_dim1;\n+      index_type t1_dim, a_sz;\n+      if (aystride == 1)\n+        a_sz = rystride;\n+      else\n+        a_sz = a_dim1;\n+\n+      t1_dim = a_sz * 256 + b_dim1;\n       if (t1_dim > 65536)\n \tt1_dim = 65536;\n \n@@ -1987,8 +2002,13 @@ matmul_i8_vanilla (gfc_array_i8 * const restrict retarray,\n \treturn;\n \n       /* Adjust size of t1 to what is needed.  */\n-      index_type t1_dim;\n-      t1_dim = (a_dim1 - (ycount > 1)) * 256 + b_dim1;\n+      index_type t1_dim, a_sz;\n+      if (aystride == 1)\n+        a_sz = rystride;\n+      else\n+        a_sz = a_dim1;\n+\n+      t1_dim = a_sz * 256 + b_dim1;\n       if (t1_dim > 65536)\n \tt1_dim = 65536;\n \n@@ -2613,8 +2633,13 @@ matmul_i8 (gfc_array_i8 * const restrict retarray,\n \treturn;\n \n       /* Adjust size of t1 to what is needed.  */\n-      index_type t1_dim;\n-      t1_dim = (a_dim1 - (ycount > 1)) * 256 + b_dim1;\n+      index_type t1_dim, a_sz;\n+      if (aystride == 1)\n+        a_sz = rystride;\n+      else\n+        a_sz = a_dim1;\n+\n+      t1_dim = a_sz * 256 + b_dim1;\n       if (t1_dim > 65536)\n \tt1_dim = 65536;\n "}, {"sha": "e4309c80a6b4fbcb74f98646083be9df78b73dc3", "filename": "libgfortran/generated/matmul_r10.c", "status": "modified", "additions": 35, "deletions": 10, "changes": 45, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/4f4fabd73312efba10f80f132d2ce59a292ddd97/libgfortran%2Fgenerated%2Fmatmul_r10.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/4f4fabd73312efba10f80f132d2ce59a292ddd97/libgfortran%2Fgenerated%2Fmatmul_r10.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libgfortran%2Fgenerated%2Fmatmul_r10.c?ref=4f4fabd73312efba10f80f132d2ce59a292ddd97", "patch": "@@ -317,8 +317,13 @@ matmul_r10_avx (gfc_array_r10 * const restrict retarray,\n \treturn;\n \n       /* Adjust size of t1 to what is needed.  */\n-      index_type t1_dim;\n-      t1_dim = (a_dim1 - (ycount > 1)) * 256 + b_dim1;\n+      index_type t1_dim, a_sz;\n+      if (aystride == 1)\n+        a_sz = rystride;\n+      else\n+        a_sz = a_dim1;\n+\n+      t1_dim = a_sz * 256 + b_dim1;\n       if (t1_dim > 65536)\n \tt1_dim = 65536;\n \n@@ -869,8 +874,13 @@ matmul_r10_avx2 (gfc_array_r10 * const restrict retarray,\n \treturn;\n \n       /* Adjust size of t1 to what is needed.  */\n-      index_type t1_dim;\n-      t1_dim = (a_dim1 - (ycount > 1)) * 256 + b_dim1;\n+      index_type t1_dim, a_sz;\n+      if (aystride == 1)\n+        a_sz = rystride;\n+      else\n+        a_sz = a_dim1;\n+\n+      t1_dim = a_sz * 256 + b_dim1;\n       if (t1_dim > 65536)\n \tt1_dim = 65536;\n \n@@ -1421,8 +1431,13 @@ matmul_r10_avx512f (gfc_array_r10 * const restrict retarray,\n \treturn;\n \n       /* Adjust size of t1 to what is needed.  */\n-      index_type t1_dim;\n-      t1_dim = (a_dim1 - (ycount > 1)) * 256 + b_dim1;\n+      index_type t1_dim, a_sz;\n+      if (aystride == 1)\n+        a_sz = rystride;\n+      else\n+        a_sz = a_dim1;\n+\n+      t1_dim = a_sz * 256 + b_dim1;\n       if (t1_dim > 65536)\n \tt1_dim = 65536;\n \n@@ -1987,8 +2002,13 @@ matmul_r10_vanilla (gfc_array_r10 * const restrict retarray,\n \treturn;\n \n       /* Adjust size of t1 to what is needed.  */\n-      index_type t1_dim;\n-      t1_dim = (a_dim1 - (ycount > 1)) * 256 + b_dim1;\n+      index_type t1_dim, a_sz;\n+      if (aystride == 1)\n+        a_sz = rystride;\n+      else\n+        a_sz = a_dim1;\n+\n+      t1_dim = a_sz * 256 + b_dim1;\n       if (t1_dim > 65536)\n \tt1_dim = 65536;\n \n@@ -2613,8 +2633,13 @@ matmul_r10 (gfc_array_r10 * const restrict retarray,\n \treturn;\n \n       /* Adjust size of t1 to what is needed.  */\n-      index_type t1_dim;\n-      t1_dim = (a_dim1 - (ycount > 1)) * 256 + b_dim1;\n+      index_type t1_dim, a_sz;\n+      if (aystride == 1)\n+        a_sz = rystride;\n+      else\n+        a_sz = a_dim1;\n+\n+      t1_dim = a_sz * 256 + b_dim1;\n       if (t1_dim > 65536)\n \tt1_dim = 65536;\n "}, {"sha": "1ab554660d7d4f09bb9bc3aa4947fc5506e65e24", "filename": "libgfortran/generated/matmul_r16.c", "status": "modified", "additions": 35, "deletions": 10, "changes": 45, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/4f4fabd73312efba10f80f132d2ce59a292ddd97/libgfortran%2Fgenerated%2Fmatmul_r16.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/4f4fabd73312efba10f80f132d2ce59a292ddd97/libgfortran%2Fgenerated%2Fmatmul_r16.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libgfortran%2Fgenerated%2Fmatmul_r16.c?ref=4f4fabd73312efba10f80f132d2ce59a292ddd97", "patch": "@@ -317,8 +317,13 @@ matmul_r16_avx (gfc_array_r16 * const restrict retarray,\n \treturn;\n \n       /* Adjust size of t1 to what is needed.  */\n-      index_type t1_dim;\n-      t1_dim = (a_dim1 - (ycount > 1)) * 256 + b_dim1;\n+      index_type t1_dim, a_sz;\n+      if (aystride == 1)\n+        a_sz = rystride;\n+      else\n+        a_sz = a_dim1;\n+\n+      t1_dim = a_sz * 256 + b_dim1;\n       if (t1_dim > 65536)\n \tt1_dim = 65536;\n \n@@ -869,8 +874,13 @@ matmul_r16_avx2 (gfc_array_r16 * const restrict retarray,\n \treturn;\n \n       /* Adjust size of t1 to what is needed.  */\n-      index_type t1_dim;\n-      t1_dim = (a_dim1 - (ycount > 1)) * 256 + b_dim1;\n+      index_type t1_dim, a_sz;\n+      if (aystride == 1)\n+        a_sz = rystride;\n+      else\n+        a_sz = a_dim1;\n+\n+      t1_dim = a_sz * 256 + b_dim1;\n       if (t1_dim > 65536)\n \tt1_dim = 65536;\n \n@@ -1421,8 +1431,13 @@ matmul_r16_avx512f (gfc_array_r16 * const restrict retarray,\n \treturn;\n \n       /* Adjust size of t1 to what is needed.  */\n-      index_type t1_dim;\n-      t1_dim = (a_dim1 - (ycount > 1)) * 256 + b_dim1;\n+      index_type t1_dim, a_sz;\n+      if (aystride == 1)\n+        a_sz = rystride;\n+      else\n+        a_sz = a_dim1;\n+\n+      t1_dim = a_sz * 256 + b_dim1;\n       if (t1_dim > 65536)\n \tt1_dim = 65536;\n \n@@ -1987,8 +2002,13 @@ matmul_r16_vanilla (gfc_array_r16 * const restrict retarray,\n \treturn;\n \n       /* Adjust size of t1 to what is needed.  */\n-      index_type t1_dim;\n-      t1_dim = (a_dim1 - (ycount > 1)) * 256 + b_dim1;\n+      index_type t1_dim, a_sz;\n+      if (aystride == 1)\n+        a_sz = rystride;\n+      else\n+        a_sz = a_dim1;\n+\n+      t1_dim = a_sz * 256 + b_dim1;\n       if (t1_dim > 65536)\n \tt1_dim = 65536;\n \n@@ -2613,8 +2633,13 @@ matmul_r16 (gfc_array_r16 * const restrict retarray,\n \treturn;\n \n       /* Adjust size of t1 to what is needed.  */\n-      index_type t1_dim;\n-      t1_dim = (a_dim1 - (ycount > 1)) * 256 + b_dim1;\n+      index_type t1_dim, a_sz;\n+      if (aystride == 1)\n+        a_sz = rystride;\n+      else\n+        a_sz = a_dim1;\n+\n+      t1_dim = a_sz * 256 + b_dim1;\n       if (t1_dim > 65536)\n \tt1_dim = 65536;\n "}, {"sha": "97dba9825b1f366e8b21265aaee4a92d11258f36", "filename": "libgfortran/generated/matmul_r4.c", "status": "modified", "additions": 35, "deletions": 10, "changes": 45, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/4f4fabd73312efba10f80f132d2ce59a292ddd97/libgfortran%2Fgenerated%2Fmatmul_r4.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/4f4fabd73312efba10f80f132d2ce59a292ddd97/libgfortran%2Fgenerated%2Fmatmul_r4.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libgfortran%2Fgenerated%2Fmatmul_r4.c?ref=4f4fabd73312efba10f80f132d2ce59a292ddd97", "patch": "@@ -317,8 +317,13 @@ matmul_r4_avx (gfc_array_r4 * const restrict retarray,\n \treturn;\n \n       /* Adjust size of t1 to what is needed.  */\n-      index_type t1_dim;\n-      t1_dim = (a_dim1 - (ycount > 1)) * 256 + b_dim1;\n+      index_type t1_dim, a_sz;\n+      if (aystride == 1)\n+        a_sz = rystride;\n+      else\n+        a_sz = a_dim1;\n+\n+      t1_dim = a_sz * 256 + b_dim1;\n       if (t1_dim > 65536)\n \tt1_dim = 65536;\n \n@@ -869,8 +874,13 @@ matmul_r4_avx2 (gfc_array_r4 * const restrict retarray,\n \treturn;\n \n       /* Adjust size of t1 to what is needed.  */\n-      index_type t1_dim;\n-      t1_dim = (a_dim1 - (ycount > 1)) * 256 + b_dim1;\n+      index_type t1_dim, a_sz;\n+      if (aystride == 1)\n+        a_sz = rystride;\n+      else\n+        a_sz = a_dim1;\n+\n+      t1_dim = a_sz * 256 + b_dim1;\n       if (t1_dim > 65536)\n \tt1_dim = 65536;\n \n@@ -1421,8 +1431,13 @@ matmul_r4_avx512f (gfc_array_r4 * const restrict retarray,\n \treturn;\n \n       /* Adjust size of t1 to what is needed.  */\n-      index_type t1_dim;\n-      t1_dim = (a_dim1 - (ycount > 1)) * 256 + b_dim1;\n+      index_type t1_dim, a_sz;\n+      if (aystride == 1)\n+        a_sz = rystride;\n+      else\n+        a_sz = a_dim1;\n+\n+      t1_dim = a_sz * 256 + b_dim1;\n       if (t1_dim > 65536)\n \tt1_dim = 65536;\n \n@@ -1987,8 +2002,13 @@ matmul_r4_vanilla (gfc_array_r4 * const restrict retarray,\n \treturn;\n \n       /* Adjust size of t1 to what is needed.  */\n-      index_type t1_dim;\n-      t1_dim = (a_dim1 - (ycount > 1)) * 256 + b_dim1;\n+      index_type t1_dim, a_sz;\n+      if (aystride == 1)\n+        a_sz = rystride;\n+      else\n+        a_sz = a_dim1;\n+\n+      t1_dim = a_sz * 256 + b_dim1;\n       if (t1_dim > 65536)\n \tt1_dim = 65536;\n \n@@ -2613,8 +2633,13 @@ matmul_r4 (gfc_array_r4 * const restrict retarray,\n \treturn;\n \n       /* Adjust size of t1 to what is needed.  */\n-      index_type t1_dim;\n-      t1_dim = (a_dim1 - (ycount > 1)) * 256 + b_dim1;\n+      index_type t1_dim, a_sz;\n+      if (aystride == 1)\n+        a_sz = rystride;\n+      else\n+        a_sz = a_dim1;\n+\n+      t1_dim = a_sz * 256 + b_dim1;\n       if (t1_dim > 65536)\n \tt1_dim = 65536;\n "}, {"sha": "5e4c9500260fb3ffabb8da37ff965a0820c58562", "filename": "libgfortran/generated/matmul_r8.c", "status": "modified", "additions": 35, "deletions": 10, "changes": 45, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/4f4fabd73312efba10f80f132d2ce59a292ddd97/libgfortran%2Fgenerated%2Fmatmul_r8.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/4f4fabd73312efba10f80f132d2ce59a292ddd97/libgfortran%2Fgenerated%2Fmatmul_r8.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libgfortran%2Fgenerated%2Fmatmul_r8.c?ref=4f4fabd73312efba10f80f132d2ce59a292ddd97", "patch": "@@ -317,8 +317,13 @@ matmul_r8_avx (gfc_array_r8 * const restrict retarray,\n \treturn;\n \n       /* Adjust size of t1 to what is needed.  */\n-      index_type t1_dim;\n-      t1_dim = (a_dim1 - (ycount > 1)) * 256 + b_dim1;\n+      index_type t1_dim, a_sz;\n+      if (aystride == 1)\n+        a_sz = rystride;\n+      else\n+        a_sz = a_dim1;\n+\n+      t1_dim = a_sz * 256 + b_dim1;\n       if (t1_dim > 65536)\n \tt1_dim = 65536;\n \n@@ -869,8 +874,13 @@ matmul_r8_avx2 (gfc_array_r8 * const restrict retarray,\n \treturn;\n \n       /* Adjust size of t1 to what is needed.  */\n-      index_type t1_dim;\n-      t1_dim = (a_dim1 - (ycount > 1)) * 256 + b_dim1;\n+      index_type t1_dim, a_sz;\n+      if (aystride == 1)\n+        a_sz = rystride;\n+      else\n+        a_sz = a_dim1;\n+\n+      t1_dim = a_sz * 256 + b_dim1;\n       if (t1_dim > 65536)\n \tt1_dim = 65536;\n \n@@ -1421,8 +1431,13 @@ matmul_r8_avx512f (gfc_array_r8 * const restrict retarray,\n \treturn;\n \n       /* Adjust size of t1 to what is needed.  */\n-      index_type t1_dim;\n-      t1_dim = (a_dim1 - (ycount > 1)) * 256 + b_dim1;\n+      index_type t1_dim, a_sz;\n+      if (aystride == 1)\n+        a_sz = rystride;\n+      else\n+        a_sz = a_dim1;\n+\n+      t1_dim = a_sz * 256 + b_dim1;\n       if (t1_dim > 65536)\n \tt1_dim = 65536;\n \n@@ -1987,8 +2002,13 @@ matmul_r8_vanilla (gfc_array_r8 * const restrict retarray,\n \treturn;\n \n       /* Adjust size of t1 to what is needed.  */\n-      index_type t1_dim;\n-      t1_dim = (a_dim1 - (ycount > 1)) * 256 + b_dim1;\n+      index_type t1_dim, a_sz;\n+      if (aystride == 1)\n+        a_sz = rystride;\n+      else\n+        a_sz = a_dim1;\n+\n+      t1_dim = a_sz * 256 + b_dim1;\n       if (t1_dim > 65536)\n \tt1_dim = 65536;\n \n@@ -2613,8 +2633,13 @@ matmul_r8 (gfc_array_r8 * const restrict retarray,\n \treturn;\n \n       /* Adjust size of t1 to what is needed.  */\n-      index_type t1_dim;\n-      t1_dim = (a_dim1 - (ycount > 1)) * 256 + b_dim1;\n+      index_type t1_dim, a_sz;\n+      if (aystride == 1)\n+        a_sz = rystride;\n+      else\n+        a_sz = a_dim1;\n+\n+      t1_dim = a_sz * 256 + b_dim1;\n       if (t1_dim > 65536)\n \tt1_dim = 65536;\n "}, {"sha": "5cb0f6ad6f35472d002ea9779b388e1f7bf036ab", "filename": "libgfortran/generated/matmulavx128_c10.c", "status": "modified", "additions": 14, "deletions": 4, "changes": 18, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/4f4fabd73312efba10f80f132d2ce59a292ddd97/libgfortran%2Fgenerated%2Fmatmulavx128_c10.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/4f4fabd73312efba10f80f132d2ce59a292ddd97/libgfortran%2Fgenerated%2Fmatmulavx128_c10.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libgfortran%2Fgenerated%2Fmatmulavx128_c10.c?ref=4f4fabd73312efba10f80f132d2ce59a292ddd97", "patch": "@@ -282,8 +282,13 @@ matmul_c10_avx128_fma3 (gfc_array_c10 * const restrict retarray,\n \treturn;\n \n       /* Adjust size of t1 to what is needed.  */\n-      index_type t1_dim;\n-      t1_dim = (a_dim1 - (ycount > 1)) * 256 + b_dim1;\n+      index_type t1_dim, a_sz;\n+      if (aystride == 1)\n+        a_sz = rystride;\n+      else\n+        a_sz = a_dim1;\n+\n+      t1_dim = a_sz * 256 + b_dim1;\n       if (t1_dim > 65536)\n \tt1_dim = 65536;\n \n@@ -835,8 +840,13 @@ matmul_c10_avx128_fma4 (gfc_array_c10 * const restrict retarray,\n \treturn;\n \n       /* Adjust size of t1 to what is needed.  */\n-      index_type t1_dim;\n-      t1_dim = (a_dim1 - (ycount > 1)) * 256 + b_dim1;\n+      index_type t1_dim, a_sz;\n+      if (aystride == 1)\n+        a_sz = rystride;\n+      else\n+        a_sz = a_dim1;\n+\n+      t1_dim = a_sz * 256 + b_dim1;\n       if (t1_dim > 65536)\n \tt1_dim = 65536;\n "}, {"sha": "66272fefaf91e5c2c97cbfe8fb7f88a45dc306af", "filename": "libgfortran/generated/matmulavx128_c16.c", "status": "modified", "additions": 14, "deletions": 4, "changes": 18, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/4f4fabd73312efba10f80f132d2ce59a292ddd97/libgfortran%2Fgenerated%2Fmatmulavx128_c16.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/4f4fabd73312efba10f80f132d2ce59a292ddd97/libgfortran%2Fgenerated%2Fmatmulavx128_c16.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libgfortran%2Fgenerated%2Fmatmulavx128_c16.c?ref=4f4fabd73312efba10f80f132d2ce59a292ddd97", "patch": "@@ -282,8 +282,13 @@ matmul_c16_avx128_fma3 (gfc_array_c16 * const restrict retarray,\n \treturn;\n \n       /* Adjust size of t1 to what is needed.  */\n-      index_type t1_dim;\n-      t1_dim = (a_dim1 - (ycount > 1)) * 256 + b_dim1;\n+      index_type t1_dim, a_sz;\n+      if (aystride == 1)\n+        a_sz = rystride;\n+      else\n+        a_sz = a_dim1;\n+\n+      t1_dim = a_sz * 256 + b_dim1;\n       if (t1_dim > 65536)\n \tt1_dim = 65536;\n \n@@ -835,8 +840,13 @@ matmul_c16_avx128_fma4 (gfc_array_c16 * const restrict retarray,\n \treturn;\n \n       /* Adjust size of t1 to what is needed.  */\n-      index_type t1_dim;\n-      t1_dim = (a_dim1 - (ycount > 1)) * 256 + b_dim1;\n+      index_type t1_dim, a_sz;\n+      if (aystride == 1)\n+        a_sz = rystride;\n+      else\n+        a_sz = a_dim1;\n+\n+      t1_dim = a_sz * 256 + b_dim1;\n       if (t1_dim > 65536)\n \tt1_dim = 65536;\n "}, {"sha": "f6e06e2e88f3225bafa750a720d2b0bf329c196e", "filename": "libgfortran/generated/matmulavx128_c4.c", "status": "modified", "additions": 14, "deletions": 4, "changes": 18, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/4f4fabd73312efba10f80f132d2ce59a292ddd97/libgfortran%2Fgenerated%2Fmatmulavx128_c4.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/4f4fabd73312efba10f80f132d2ce59a292ddd97/libgfortran%2Fgenerated%2Fmatmulavx128_c4.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libgfortran%2Fgenerated%2Fmatmulavx128_c4.c?ref=4f4fabd73312efba10f80f132d2ce59a292ddd97", "patch": "@@ -282,8 +282,13 @@ matmul_c4_avx128_fma3 (gfc_array_c4 * const restrict retarray,\n \treturn;\n \n       /* Adjust size of t1 to what is needed.  */\n-      index_type t1_dim;\n-      t1_dim = (a_dim1 - (ycount > 1)) * 256 + b_dim1;\n+      index_type t1_dim, a_sz;\n+      if (aystride == 1)\n+        a_sz = rystride;\n+      else\n+        a_sz = a_dim1;\n+\n+      t1_dim = a_sz * 256 + b_dim1;\n       if (t1_dim > 65536)\n \tt1_dim = 65536;\n \n@@ -835,8 +840,13 @@ matmul_c4_avx128_fma4 (gfc_array_c4 * const restrict retarray,\n \treturn;\n \n       /* Adjust size of t1 to what is needed.  */\n-      index_type t1_dim;\n-      t1_dim = (a_dim1 - (ycount > 1)) * 256 + b_dim1;\n+      index_type t1_dim, a_sz;\n+      if (aystride == 1)\n+        a_sz = rystride;\n+      else\n+        a_sz = a_dim1;\n+\n+      t1_dim = a_sz * 256 + b_dim1;\n       if (t1_dim > 65536)\n \tt1_dim = 65536;\n "}, {"sha": "accc69c4d1a20556569fc2bb00ec28f9a96a61e8", "filename": "libgfortran/generated/matmulavx128_c8.c", "status": "modified", "additions": 14, "deletions": 4, "changes": 18, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/4f4fabd73312efba10f80f132d2ce59a292ddd97/libgfortran%2Fgenerated%2Fmatmulavx128_c8.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/4f4fabd73312efba10f80f132d2ce59a292ddd97/libgfortran%2Fgenerated%2Fmatmulavx128_c8.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libgfortran%2Fgenerated%2Fmatmulavx128_c8.c?ref=4f4fabd73312efba10f80f132d2ce59a292ddd97", "patch": "@@ -282,8 +282,13 @@ matmul_c8_avx128_fma3 (gfc_array_c8 * const restrict retarray,\n \treturn;\n \n       /* Adjust size of t1 to what is needed.  */\n-      index_type t1_dim;\n-      t1_dim = (a_dim1 - (ycount > 1)) * 256 + b_dim1;\n+      index_type t1_dim, a_sz;\n+      if (aystride == 1)\n+        a_sz = rystride;\n+      else\n+        a_sz = a_dim1;\n+\n+      t1_dim = a_sz * 256 + b_dim1;\n       if (t1_dim > 65536)\n \tt1_dim = 65536;\n \n@@ -835,8 +840,13 @@ matmul_c8_avx128_fma4 (gfc_array_c8 * const restrict retarray,\n \treturn;\n \n       /* Adjust size of t1 to what is needed.  */\n-      index_type t1_dim;\n-      t1_dim = (a_dim1 - (ycount > 1)) * 256 + b_dim1;\n+      index_type t1_dim, a_sz;\n+      if (aystride == 1)\n+        a_sz = rystride;\n+      else\n+        a_sz = a_dim1;\n+\n+      t1_dim = a_sz * 256 + b_dim1;\n       if (t1_dim > 65536)\n \tt1_dim = 65536;\n "}, {"sha": "48b15c8074a625cac0109065e67a17561443bfbe", "filename": "libgfortran/generated/matmulavx128_i1.c", "status": "modified", "additions": 14, "deletions": 4, "changes": 18, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/4f4fabd73312efba10f80f132d2ce59a292ddd97/libgfortran%2Fgenerated%2Fmatmulavx128_i1.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/4f4fabd73312efba10f80f132d2ce59a292ddd97/libgfortran%2Fgenerated%2Fmatmulavx128_i1.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libgfortran%2Fgenerated%2Fmatmulavx128_i1.c?ref=4f4fabd73312efba10f80f132d2ce59a292ddd97", "patch": "@@ -282,8 +282,13 @@ matmul_i1_avx128_fma3 (gfc_array_i1 * const restrict retarray,\n \treturn;\n \n       /* Adjust size of t1 to what is needed.  */\n-      index_type t1_dim;\n-      t1_dim = (a_dim1 - (ycount > 1)) * 256 + b_dim1;\n+      index_type t1_dim, a_sz;\n+      if (aystride == 1)\n+        a_sz = rystride;\n+      else\n+        a_sz = a_dim1;\n+\n+      t1_dim = a_sz * 256 + b_dim1;\n       if (t1_dim > 65536)\n \tt1_dim = 65536;\n \n@@ -835,8 +840,13 @@ matmul_i1_avx128_fma4 (gfc_array_i1 * const restrict retarray,\n \treturn;\n \n       /* Adjust size of t1 to what is needed.  */\n-      index_type t1_dim;\n-      t1_dim = (a_dim1 - (ycount > 1)) * 256 + b_dim1;\n+      index_type t1_dim, a_sz;\n+      if (aystride == 1)\n+        a_sz = rystride;\n+      else\n+        a_sz = a_dim1;\n+\n+      t1_dim = a_sz * 256 + b_dim1;\n       if (t1_dim > 65536)\n \tt1_dim = 65536;\n "}, {"sha": "319321eca492f872446c588b32d4814a59ecbd6b", "filename": "libgfortran/generated/matmulavx128_i16.c", "status": "modified", "additions": 14, "deletions": 4, "changes": 18, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/4f4fabd73312efba10f80f132d2ce59a292ddd97/libgfortran%2Fgenerated%2Fmatmulavx128_i16.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/4f4fabd73312efba10f80f132d2ce59a292ddd97/libgfortran%2Fgenerated%2Fmatmulavx128_i16.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libgfortran%2Fgenerated%2Fmatmulavx128_i16.c?ref=4f4fabd73312efba10f80f132d2ce59a292ddd97", "patch": "@@ -282,8 +282,13 @@ matmul_i16_avx128_fma3 (gfc_array_i16 * const restrict retarray,\n \treturn;\n \n       /* Adjust size of t1 to what is needed.  */\n-      index_type t1_dim;\n-      t1_dim = (a_dim1 - (ycount > 1)) * 256 + b_dim1;\n+      index_type t1_dim, a_sz;\n+      if (aystride == 1)\n+        a_sz = rystride;\n+      else\n+        a_sz = a_dim1;\n+\n+      t1_dim = a_sz * 256 + b_dim1;\n       if (t1_dim > 65536)\n \tt1_dim = 65536;\n \n@@ -835,8 +840,13 @@ matmul_i16_avx128_fma4 (gfc_array_i16 * const restrict retarray,\n \treturn;\n \n       /* Adjust size of t1 to what is needed.  */\n-      index_type t1_dim;\n-      t1_dim = (a_dim1 - (ycount > 1)) * 256 + b_dim1;\n+      index_type t1_dim, a_sz;\n+      if (aystride == 1)\n+        a_sz = rystride;\n+      else\n+        a_sz = a_dim1;\n+\n+      t1_dim = a_sz * 256 + b_dim1;\n       if (t1_dim > 65536)\n \tt1_dim = 65536;\n "}, {"sha": "4d8945b10a24538709750c23459658ee315a4e23", "filename": "libgfortran/generated/matmulavx128_i2.c", "status": "modified", "additions": 14, "deletions": 4, "changes": 18, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/4f4fabd73312efba10f80f132d2ce59a292ddd97/libgfortran%2Fgenerated%2Fmatmulavx128_i2.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/4f4fabd73312efba10f80f132d2ce59a292ddd97/libgfortran%2Fgenerated%2Fmatmulavx128_i2.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libgfortran%2Fgenerated%2Fmatmulavx128_i2.c?ref=4f4fabd73312efba10f80f132d2ce59a292ddd97", "patch": "@@ -282,8 +282,13 @@ matmul_i2_avx128_fma3 (gfc_array_i2 * const restrict retarray,\n \treturn;\n \n       /* Adjust size of t1 to what is needed.  */\n-      index_type t1_dim;\n-      t1_dim = (a_dim1 - (ycount > 1)) * 256 + b_dim1;\n+      index_type t1_dim, a_sz;\n+      if (aystride == 1)\n+        a_sz = rystride;\n+      else\n+        a_sz = a_dim1;\n+\n+      t1_dim = a_sz * 256 + b_dim1;\n       if (t1_dim > 65536)\n \tt1_dim = 65536;\n \n@@ -835,8 +840,13 @@ matmul_i2_avx128_fma4 (gfc_array_i2 * const restrict retarray,\n \treturn;\n \n       /* Adjust size of t1 to what is needed.  */\n-      index_type t1_dim;\n-      t1_dim = (a_dim1 - (ycount > 1)) * 256 + b_dim1;\n+      index_type t1_dim, a_sz;\n+      if (aystride == 1)\n+        a_sz = rystride;\n+      else\n+        a_sz = a_dim1;\n+\n+      t1_dim = a_sz * 256 + b_dim1;\n       if (t1_dim > 65536)\n \tt1_dim = 65536;\n "}, {"sha": "acaa00a30bbef0611dcbab07ba2a4a27c87208da", "filename": "libgfortran/generated/matmulavx128_i4.c", "status": "modified", "additions": 14, "deletions": 4, "changes": 18, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/4f4fabd73312efba10f80f132d2ce59a292ddd97/libgfortran%2Fgenerated%2Fmatmulavx128_i4.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/4f4fabd73312efba10f80f132d2ce59a292ddd97/libgfortran%2Fgenerated%2Fmatmulavx128_i4.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libgfortran%2Fgenerated%2Fmatmulavx128_i4.c?ref=4f4fabd73312efba10f80f132d2ce59a292ddd97", "patch": "@@ -282,8 +282,13 @@ matmul_i4_avx128_fma3 (gfc_array_i4 * const restrict retarray,\n \treturn;\n \n       /* Adjust size of t1 to what is needed.  */\n-      index_type t1_dim;\n-      t1_dim = (a_dim1 - (ycount > 1)) * 256 + b_dim1;\n+      index_type t1_dim, a_sz;\n+      if (aystride == 1)\n+        a_sz = rystride;\n+      else\n+        a_sz = a_dim1;\n+\n+      t1_dim = a_sz * 256 + b_dim1;\n       if (t1_dim > 65536)\n \tt1_dim = 65536;\n \n@@ -835,8 +840,13 @@ matmul_i4_avx128_fma4 (gfc_array_i4 * const restrict retarray,\n \treturn;\n \n       /* Adjust size of t1 to what is needed.  */\n-      index_type t1_dim;\n-      t1_dim = (a_dim1 - (ycount > 1)) * 256 + b_dim1;\n+      index_type t1_dim, a_sz;\n+      if (aystride == 1)\n+        a_sz = rystride;\n+      else\n+        a_sz = a_dim1;\n+\n+      t1_dim = a_sz * 256 + b_dim1;\n       if (t1_dim > 65536)\n \tt1_dim = 65536;\n "}, {"sha": "56e85167a3f909e98f3a4cd8fafd42bdd42ce00c", "filename": "libgfortran/generated/matmulavx128_i8.c", "status": "modified", "additions": 14, "deletions": 4, "changes": 18, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/4f4fabd73312efba10f80f132d2ce59a292ddd97/libgfortran%2Fgenerated%2Fmatmulavx128_i8.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/4f4fabd73312efba10f80f132d2ce59a292ddd97/libgfortran%2Fgenerated%2Fmatmulavx128_i8.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libgfortran%2Fgenerated%2Fmatmulavx128_i8.c?ref=4f4fabd73312efba10f80f132d2ce59a292ddd97", "patch": "@@ -282,8 +282,13 @@ matmul_i8_avx128_fma3 (gfc_array_i8 * const restrict retarray,\n \treturn;\n \n       /* Adjust size of t1 to what is needed.  */\n-      index_type t1_dim;\n-      t1_dim = (a_dim1 - (ycount > 1)) * 256 + b_dim1;\n+      index_type t1_dim, a_sz;\n+      if (aystride == 1)\n+        a_sz = rystride;\n+      else\n+        a_sz = a_dim1;\n+\n+      t1_dim = a_sz * 256 + b_dim1;\n       if (t1_dim > 65536)\n \tt1_dim = 65536;\n \n@@ -835,8 +840,13 @@ matmul_i8_avx128_fma4 (gfc_array_i8 * const restrict retarray,\n \treturn;\n \n       /* Adjust size of t1 to what is needed.  */\n-      index_type t1_dim;\n-      t1_dim = (a_dim1 - (ycount > 1)) * 256 + b_dim1;\n+      index_type t1_dim, a_sz;\n+      if (aystride == 1)\n+        a_sz = rystride;\n+      else\n+        a_sz = a_dim1;\n+\n+      t1_dim = a_sz * 256 + b_dim1;\n       if (t1_dim > 65536)\n \tt1_dim = 65536;\n "}, {"sha": "880c9d921b2b20c6bdf24f239c76c1de5f414c06", "filename": "libgfortran/generated/matmulavx128_r10.c", "status": "modified", "additions": 14, "deletions": 4, "changes": 18, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/4f4fabd73312efba10f80f132d2ce59a292ddd97/libgfortran%2Fgenerated%2Fmatmulavx128_r10.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/4f4fabd73312efba10f80f132d2ce59a292ddd97/libgfortran%2Fgenerated%2Fmatmulavx128_r10.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libgfortran%2Fgenerated%2Fmatmulavx128_r10.c?ref=4f4fabd73312efba10f80f132d2ce59a292ddd97", "patch": "@@ -282,8 +282,13 @@ matmul_r10_avx128_fma3 (gfc_array_r10 * const restrict retarray,\n \treturn;\n \n       /* Adjust size of t1 to what is needed.  */\n-      index_type t1_dim;\n-      t1_dim = (a_dim1 - (ycount > 1)) * 256 + b_dim1;\n+      index_type t1_dim, a_sz;\n+      if (aystride == 1)\n+        a_sz = rystride;\n+      else\n+        a_sz = a_dim1;\n+\n+      t1_dim = a_sz * 256 + b_dim1;\n       if (t1_dim > 65536)\n \tt1_dim = 65536;\n \n@@ -835,8 +840,13 @@ matmul_r10_avx128_fma4 (gfc_array_r10 * const restrict retarray,\n \treturn;\n \n       /* Adjust size of t1 to what is needed.  */\n-      index_type t1_dim;\n-      t1_dim = (a_dim1 - (ycount > 1)) * 256 + b_dim1;\n+      index_type t1_dim, a_sz;\n+      if (aystride == 1)\n+        a_sz = rystride;\n+      else\n+        a_sz = a_dim1;\n+\n+      t1_dim = a_sz * 256 + b_dim1;\n       if (t1_dim > 65536)\n \tt1_dim = 65536;\n "}, {"sha": "328e251a3a11769df77d9e40b2a4e2338719287e", "filename": "libgfortran/generated/matmulavx128_r16.c", "status": "modified", "additions": 14, "deletions": 4, "changes": 18, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/4f4fabd73312efba10f80f132d2ce59a292ddd97/libgfortran%2Fgenerated%2Fmatmulavx128_r16.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/4f4fabd73312efba10f80f132d2ce59a292ddd97/libgfortran%2Fgenerated%2Fmatmulavx128_r16.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libgfortran%2Fgenerated%2Fmatmulavx128_r16.c?ref=4f4fabd73312efba10f80f132d2ce59a292ddd97", "patch": "@@ -282,8 +282,13 @@ matmul_r16_avx128_fma3 (gfc_array_r16 * const restrict retarray,\n \treturn;\n \n       /* Adjust size of t1 to what is needed.  */\n-      index_type t1_dim;\n-      t1_dim = (a_dim1 - (ycount > 1)) * 256 + b_dim1;\n+      index_type t1_dim, a_sz;\n+      if (aystride == 1)\n+        a_sz = rystride;\n+      else\n+        a_sz = a_dim1;\n+\n+      t1_dim = a_sz * 256 + b_dim1;\n       if (t1_dim > 65536)\n \tt1_dim = 65536;\n \n@@ -835,8 +840,13 @@ matmul_r16_avx128_fma4 (gfc_array_r16 * const restrict retarray,\n \treturn;\n \n       /* Adjust size of t1 to what is needed.  */\n-      index_type t1_dim;\n-      t1_dim = (a_dim1 - (ycount > 1)) * 256 + b_dim1;\n+      index_type t1_dim, a_sz;\n+      if (aystride == 1)\n+        a_sz = rystride;\n+      else\n+        a_sz = a_dim1;\n+\n+      t1_dim = a_sz * 256 + b_dim1;\n       if (t1_dim > 65536)\n \tt1_dim = 65536;\n "}, {"sha": "013a1804a11d5ba3ce8bfabeff3745edbfd8c573", "filename": "libgfortran/generated/matmulavx128_r4.c", "status": "modified", "additions": 14, "deletions": 4, "changes": 18, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/4f4fabd73312efba10f80f132d2ce59a292ddd97/libgfortran%2Fgenerated%2Fmatmulavx128_r4.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/4f4fabd73312efba10f80f132d2ce59a292ddd97/libgfortran%2Fgenerated%2Fmatmulavx128_r4.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libgfortran%2Fgenerated%2Fmatmulavx128_r4.c?ref=4f4fabd73312efba10f80f132d2ce59a292ddd97", "patch": "@@ -282,8 +282,13 @@ matmul_r4_avx128_fma3 (gfc_array_r4 * const restrict retarray,\n \treturn;\n \n       /* Adjust size of t1 to what is needed.  */\n-      index_type t1_dim;\n-      t1_dim = (a_dim1 - (ycount > 1)) * 256 + b_dim1;\n+      index_type t1_dim, a_sz;\n+      if (aystride == 1)\n+        a_sz = rystride;\n+      else\n+        a_sz = a_dim1;\n+\n+      t1_dim = a_sz * 256 + b_dim1;\n       if (t1_dim > 65536)\n \tt1_dim = 65536;\n \n@@ -835,8 +840,13 @@ matmul_r4_avx128_fma4 (gfc_array_r4 * const restrict retarray,\n \treturn;\n \n       /* Adjust size of t1 to what is needed.  */\n-      index_type t1_dim;\n-      t1_dim = (a_dim1 - (ycount > 1)) * 256 + b_dim1;\n+      index_type t1_dim, a_sz;\n+      if (aystride == 1)\n+        a_sz = rystride;\n+      else\n+        a_sz = a_dim1;\n+\n+      t1_dim = a_sz * 256 + b_dim1;\n       if (t1_dim > 65536)\n \tt1_dim = 65536;\n "}, {"sha": "4da59f9e69c7b0605f2c2b61b36fd1feb6626913", "filename": "libgfortran/generated/matmulavx128_r8.c", "status": "modified", "additions": 14, "deletions": 4, "changes": 18, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/4f4fabd73312efba10f80f132d2ce59a292ddd97/libgfortran%2Fgenerated%2Fmatmulavx128_r8.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/4f4fabd73312efba10f80f132d2ce59a292ddd97/libgfortran%2Fgenerated%2Fmatmulavx128_r8.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libgfortran%2Fgenerated%2Fmatmulavx128_r8.c?ref=4f4fabd73312efba10f80f132d2ce59a292ddd97", "patch": "@@ -282,8 +282,13 @@ matmul_r8_avx128_fma3 (gfc_array_r8 * const restrict retarray,\n \treturn;\n \n       /* Adjust size of t1 to what is needed.  */\n-      index_type t1_dim;\n-      t1_dim = (a_dim1 - (ycount > 1)) * 256 + b_dim1;\n+      index_type t1_dim, a_sz;\n+      if (aystride == 1)\n+        a_sz = rystride;\n+      else\n+        a_sz = a_dim1;\n+\n+      t1_dim = a_sz * 256 + b_dim1;\n       if (t1_dim > 65536)\n \tt1_dim = 65536;\n \n@@ -835,8 +840,13 @@ matmul_r8_avx128_fma4 (gfc_array_r8 * const restrict retarray,\n \treturn;\n \n       /* Adjust size of t1 to what is needed.  */\n-      index_type t1_dim;\n-      t1_dim = (a_dim1 - (ycount > 1)) * 256 + b_dim1;\n+      index_type t1_dim, a_sz;\n+      if (aystride == 1)\n+        a_sz = rystride;\n+      else\n+        a_sz = a_dim1;\n+\n+      t1_dim = a_sz * 256 + b_dim1;\n       if (t1_dim > 65536)\n \tt1_dim = 65536;\n "}, {"sha": "2020e8a50dfe20e7c7fb491f361aed5025eec20b", "filename": "libgfortran/m4/matmul_internal.m4", "status": "modified", "additions": 7, "deletions": 2, "changes": 9, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/4f4fabd73312efba10f80f132d2ce59a292ddd97/libgfortran%2Fm4%2Fmatmul_internal.m4", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/4f4fabd73312efba10f80f132d2ce59a292ddd97/libgfortran%2Fm4%2Fmatmul_internal.m4", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libgfortran%2Fm4%2Fmatmul_internal.m4?ref=4f4fabd73312efba10f80f132d2ce59a292ddd97", "patch": "@@ -233,8 +233,13 @@ sinclude(`matmul_asm_'rtype_code`.m4')dnl\n \treturn;\n \n       /* Adjust size of t1 to what is needed.  */\n-      index_type t1_dim;\n-      t1_dim = (a_dim1 - (ycount > 1)) * 256 + b_dim1;\n+      index_type t1_dim, a_sz;\n+      if (aystride == 1)\n+        a_sz = rystride;\n+      else\n+        a_sz = a_dim1;\n+\n+      t1_dim = a_sz * 256 + b_dim1;\n       if (t1_dim > 65536)\n \tt1_dim = 65536;\n "}]}