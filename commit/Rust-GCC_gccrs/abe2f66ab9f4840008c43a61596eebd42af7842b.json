{"sha": "abe2f66ab9f4840008c43a61596eebd42af7842b", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6YWJlMmY2NmFiOWY0ODQwMDA4YzQzYTYxNTk2ZWViZDQyYWY3ODQyYg==", "commit": {"author": {"name": "Francis Kung", "email": "fkung@redhat.com", "date": "2007-04-17T20:15:53Z"}, "committer": {"name": "Thomas Fitzsimmons", "email": "fitzsim@gcc.gnu.org", "date": "2007-04-17T20:15:53Z"}, "message": "re PR awt/31311 (Quitting applet can hang X server)\n\n2007-04-17  Francis Kung  <fkung@redhat.com>\n\n\tPR classpath/31311\n\t* gnu/java/awt/peer/gtk/ComponentGraphics.java\n\t(dispose): Removed method.\n\t(disposeSurface): Removed method.\n\t* gnu_java_awt_peer_gtk_ComponentGraphics.h: Regenerated.\n\t* native/jni/gtk-peer/gnu_java_awt_peer_gtk_ComponentGraphics.c\n\t(Java_gnu_java_awt_peer_gtk_ComponentGraphics_disposeSurface): Removed.\n\t(Java_gnu_java_awt_peer_gtk_ComponentGraphics_initState): Destroy surface\n\tafter it is used to create a cairo context.\n\nFrom-SVN: r123928", "tree": {"sha": "2a9bf0482db315956df7cf772dc3988469964047", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/2a9bf0482db315956df7cf772dc3988469964047"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/abe2f66ab9f4840008c43a61596eebd42af7842b", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/abe2f66ab9f4840008c43a61596eebd42af7842b", "html_url": "https://github.com/Rust-GCC/gccrs/commit/abe2f66ab9f4840008c43a61596eebd42af7842b", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/abe2f66ab9f4840008c43a61596eebd42af7842b/comments", "author": null, "committer": null, "parents": [{"sha": "5594a6c8c051051e68c1dad0feec273eac4aa5d0", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/5594a6c8c051051e68c1dad0feec273eac4aa5d0", "html_url": "https://github.com/Rust-GCC/gccrs/commit/5594a6c8c051051e68c1dad0feec273eac4aa5d0"}], "stats": {"total": 60, "additions": 15, "deletions": 45}, "files": [{"sha": "244b98da8835d0a6156d3e95f3065a7bfa823660", "filename": "libjava/classpath/ChangeLog", "status": "modified", "additions": 12, "deletions": 0, "changes": 12, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/abe2f66ab9f4840008c43a61596eebd42af7842b/libjava%2Fclasspath%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/abe2f66ab9f4840008c43a61596eebd42af7842b/libjava%2Fclasspath%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libjava%2Fclasspath%2FChangeLog?ref=abe2f66ab9f4840008c43a61596eebd42af7842b", "patch": "@@ -1,3 +1,15 @@\n+2007-04-17  Francis Kung  <fkung@redhat.com>\n+\n+\tPR classpath/31311\n+\t* gnu/java/awt/peer/gtk/ComponentGraphics.java\n+\t(dispose): Removed method.\n+\t(disposeSurface): Removed method.\n+\t* gnu_java_awt_peer_gtk_ComponentGraphics.h: Regenerated.\n+\t* native/jni/gtk-peer/gnu_java_awt_peer_gtk_ComponentGraphics.c\n+\t(Java_gnu_java_awt_peer_gtk_ComponentGraphics_disposeSurface): Removed.\n+\t(Java_gnu_java_awt_peer_gtk_ComponentGraphics_initState): Destroy surface\n+\tafter it is used to create a cairo context.\n+\n 2007-04-16  Tom Tromey  <tromey@redhat.com>\n \n \thttps://bugzilla.redhat.com/bugzilla/show_bug.cgi?id=236614"}, {"sha": "098052ae961c7c0cc6ea12fb11c8e195ee16b1c8", "filename": "libjava/classpath/gnu/java/awt/peer/gtk/ComponentGraphics.java", "status": "modified", "additions": 0, "deletions": 15, "changes": 15, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/abe2f66ab9f4840008c43a61596eebd42af7842b/libjava%2Fclasspath%2Fgnu%2Fjava%2Fawt%2Fpeer%2Fgtk%2FComponentGraphics.java", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/abe2f66ab9f4840008c43a61596eebd42af7842b/libjava%2Fclasspath%2Fgnu%2Fjava%2Fawt%2Fpeer%2Fgtk%2FComponentGraphics.java", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libjava%2Fclasspath%2Fgnu%2Fjava%2Fawt%2Fpeer%2Fgtk%2FComponentGraphics.java?ref=abe2f66ab9f4840008c43a61596eebd42af7842b", "patch": "@@ -138,21 +138,6 @@ private void unlock()\n       hasLock.set(Integer.valueOf(i.intValue() - 1));\n   }\n \n-  /**\n-   * Destroys the component surface and calls dispose on the cairo\n-   * graphics2d to destroy any super class resources.\n-   */\n-  public void dispose()\n-  {\n-    super.dispose();\n-    disposeSurface(nativePointer);\n-  }\n-\n-  /**\n-   * Destroys the component surface.\n-   */\n-  private native void disposeSurface(long nativePointer);\n-\n   /**\n    * Creates a cairo_t for a volatile image\n    */"}, {"sha": "2df12469b42ea8811e498baa66bf5306ed06a176", "filename": "libjava/classpath/include/gnu_java_awt_peer_gtk_ComponentGraphics.h", "status": "modified", "additions": 0, "deletions": 1, "changes": 1, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/abe2f66ab9f4840008c43a61596eebd42af7842b/libjava%2Fclasspath%2Finclude%2Fgnu_java_awt_peer_gtk_ComponentGraphics.h", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/abe2f66ab9f4840008c43a61596eebd42af7842b/libjava%2Fclasspath%2Finclude%2Fgnu_java_awt_peer_gtk_ComponentGraphics.h", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libjava%2Fclasspath%2Finclude%2Fgnu_java_awt_peer_gtk_ComponentGraphics.h?ref=abe2f66ab9f4840008c43a61596eebd42af7842b", "patch": "@@ -11,7 +11,6 @@ extern \"C\"\n #endif\n \n JNIEXPORT jlong JNICALL Java_gnu_java_awt_peer_gtk_ComponentGraphics_initState (JNIEnv *env, jobject, jobject);\n-JNIEXPORT void JNICALL Java_gnu_java_awt_peer_gtk_ComponentGraphics_disposeSurface (JNIEnv *env, jobject, jlong);\n JNIEXPORT jlong JNICALL Java_gnu_java_awt_peer_gtk_ComponentGraphics_initFromVolatile (JNIEnv *env, jobject, jlong, jint, jint);\n JNIEXPORT void JNICALL Java_gnu_java_awt_peer_gtk_ComponentGraphics_start_1gdk_1drawing (JNIEnv *env, jobject);\n JNIEXPORT void JNICALL Java_gnu_java_awt_peer_gtk_ComponentGraphics_end_1gdk_1drawing (JNIEnv *env, jobject);"}, {"sha": "ed9cf3d6ddc3e16b9d6e3a4c1b0f4cf6a2a83fcd", "filename": "libjava/classpath/native/jni/gtk-peer/gnu_java_awt_peer_gtk_ComponentGraphics.c", "status": "modified", "additions": 3, "deletions": 29, "changes": 32, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/abe2f66ab9f4840008c43a61596eebd42af7842b/libjava%2Fclasspath%2Fnative%2Fjni%2Fgtk-peer%2Fgnu_java_awt_peer_gtk_ComponentGraphics.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/abe2f66ab9f4840008c43a61596eebd42af7842b/libjava%2Fclasspath%2Fnative%2Fjni%2Fgtk-peer%2Fgnu_java_awt_peer_gtk_ComponentGraphics.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libjava%2Fclasspath%2Fnative%2Fjni%2Fgtk-peer%2Fgnu_java_awt_peer_gtk_ComponentGraphics.c?ref=abe2f66ab9f4840008c43a61596eebd42af7842b", "patch": "@@ -1,5 +1,5 @@\n /* gnu_java_awt_peer_gtk_ComponentGraphics.c\n-   Copyright (C) 2006 Free Software Foundation, Inc.\n+   Copyright (C) 2006, 2007 Free Software Foundation, Inc.\n \n This file is part of GNU Classpath.\n \n@@ -159,40 +159,13 @@ Java_gnu_java_awt_peer_gtk_ComponentGraphics_initState\n \n   cr = cairo_create (surface);\n   g_assert(cr != NULL);\n+  cairo_surface_destroy(surface);\n \n   gdk_threads_leave();\n \n   return PTR_TO_JLONG(cr);\n }\n \n-/**\n- * Disposes of the surface\n- */\n-JNIEXPORT void JNICALL\n-Java_gnu_java_awt_peer_gtk_ComponentGraphics_disposeSurface\n-  (JNIEnv *env __attribute__((unused)), jobject obj __attribute__((unused)),\n-   jlong value)\n-{\n-  struct cairographics2d *gr;\n-  cairo_surface_t *surface;\n-\n-  gr = JLONG_TO_PTR(struct cairographics2d, value);\n-\n-  if (gr == NULL)\n-    return;\n-\n-  if (gr->cr == NULL)\n-    return;\n-\n-  surface = cairo_get_target (gr->cr);\n-  if (surface != NULL)\n-    {\n-      gdk_threads_enter();\n-      cairo_surface_destroy (surface);\n-      gdk_threads_leave();\n-    }\n-}\n-\n JNIEXPORT jlong JNICALL \n Java_gnu_java_awt_peer_gtk_ComponentGraphics_initFromVolatile\n   (JNIEnv *env  __attribute__ ((unused)), jobject obj __attribute__ ((unused)),\n@@ -224,6 +197,7 @@ Java_gnu_java_awt_peer_gtk_ComponentGraphics_initFromVolatile\n \n   cr = cairo_create (surface);\n   g_assert(cr != NULL);\n+  cairo_surface_destroy(surface);\n \n   gdk_threads_leave();\n "}]}