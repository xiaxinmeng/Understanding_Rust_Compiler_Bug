{"sha": "d59ee314a89863fa06f91eb59b2211585f3ebac9", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6ZDU5ZWUzMTRhODk4NjNmYTA2ZjkxZWI1OWIyMjExNTg1ZjNlYmFjOQ==", "commit": {"author": {"name": "Richard Earnshaw", "email": "rearnsha@arm.com", "date": "2017-06-16T21:05:46Z"}, "committer": {"name": "Richard Earnshaw", "email": "rearnsha@gcc.gnu.org", "date": "2017-06-16T21:05:46Z"}, "message": "[arm] Update t-rtems for new option framework\n\n\n[This patch has only been fairly lightly tested (I've built a compiler\nwith all the relevant multilibs and smoke-tested a few combinations to\ncheck that the tools still produce a sensible object file).]\n\nThis patch updates the RTEMS build to use the new option framework.\nIt tries as far as possible to keep the existing supported options,\nbut there are two necessary changes and one cleanup.  I've also\nrestructed the file slightly to make it slightly easier (IMO) to\nunderstand.\n\nNecessary changes:\n\n1: ARMv4t does not support a hard-float ABI, the earliest supported\narchitecture with floating-point support is ARMv5te, so I've rebased\nthe original fpu/hard libraries to that revision of the architecture.\n\n2: Similarly, the earliest version of the -m profile to support\nhardware floating-point is armv7e-m (not armv7-m), so the base\narchitecture for m-profile with FP has been correspondingly updated.\n\nClean-up:\n\n1: For greater consistency I've changed the\n-mcpu=cortex-m7/-mfpu=fpv5-d16/-mhard-float to\n-march=armv7e-m+fp.dp/-mhard-float.  The built-in -mcpu rewrite rules\ntake care of mapping the existing option sets onto the architecture\nstring to ensure compatibility.\n\nSince the existing rule set does not contain any MULTILIB_REUSE rules,\nI have not added any here this time around, but it would be worth the\nmaintainers of this file considering whether adding some rules would\nmake their toolchain more friendly to users.\n\nFinally, I've added lines to reset all the multilib variables at the\nhead of the file.  I found during testing that some definitions from\nt-arm-elf were leaking through and causing unexpected behviour.\n\n\t* config/arm/t-rtems: Rewrite for new option framework.\n\nFrom-SVN: r249301", "tree": {"sha": "a45d10ef294551f22b0e38a03799398214ce0dff", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/a45d10ef294551f22b0e38a03799398214ce0dff"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/d59ee314a89863fa06f91eb59b2211585f3ebac9", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/d59ee314a89863fa06f91eb59b2211585f3ebac9", "html_url": "https://github.com/Rust-GCC/gccrs/commit/d59ee314a89863fa06f91eb59b2211585f3ebac9", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/d59ee314a89863fa06f91eb59b2211585f3ebac9/comments", "author": null, "committer": null, "parents": [{"sha": "420938809a0ec729986e959a4c7bf8b1881f934a", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/420938809a0ec729986e959a4c7bf8b1881f934a", "html_url": "https://github.com/Rust-GCC/gccrs/commit/420938809a0ec729986e959a4c7bf8b1881f934a"}], "stats": {"total": 53, "additions": 36, "deletions": 17}, "files": [{"sha": "f603df53075e02f172f98c223f3abb51d221d06d", "filename": "gcc/ChangeLog", "status": "modified", "additions": 4, "deletions": 0, "changes": 4, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/d59ee314a89863fa06f91eb59b2211585f3ebac9/gcc%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/d59ee314a89863fa06f91eb59b2211585f3ebac9/gcc%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2FChangeLog?ref=d59ee314a89863fa06f91eb59b2211585f3ebac9", "patch": "@@ -1,3 +1,7 @@\n+2017-06-16  Richard Earnshaw  <rearnsha@arm.com>\n+\n+\t* config/arm/t-rtems: Rewrite for new option framework.\n+\n 2017-06-16  Richard Earnshaw  <rearnsha@arm.com>\n \n \t* config/arm/t-aprofile (v7_a_nosimd_variants, v7_a_simd_variants)"}, {"sha": "c07378657c8289014fc875a426e48b48b7c1f690", "filename": "gcc/config/arm/t-rtems", "status": "modified", "additions": 32, "deletions": 17, "changes": 49, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/d59ee314a89863fa06f91eb59b2211585f3ebac9/gcc%2Fconfig%2Farm%2Ft-rtems", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/d59ee314a89863fa06f91eb59b2211585f3ebac9/gcc%2Fconfig%2Farm%2Ft-rtems", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fconfig%2Farm%2Ft-rtems?ref=d59ee314a89863fa06f91eb59b2211585f3ebac9", "patch": "@@ -1,22 +1,37 @@\n # Custom RTEMS multilibs for ARM\n \n-MULTILIB_OPTIONS  = mbig-endian mthumb march=armv6-m/march=armv7-a/march=armv7-r/march=armv7-m/mcpu=cortex-m7 mfpu=neon/mfpu=vfp/mfpu=vfpv3-d16/mfpu=fpv4-sp-d16/mfpu=fpv5-d16 mfloat-abi=hard\n-MULTILIB_DIRNAMES = eb thumb armv6-m armv7-a armv7-r armv7-m cortex-m7 neon vfp vfpv3-d16 fpv4-sp-d16 fpv5-d16 hard\n+# Reset all MULTILIB variables\n+\n+MULTILIB_OPTIONS\t=\n+MULTILIB_DIRNAMES\t=\n+MULTILIB_EXCEPTIONS\t=\n+MULTILIB_REUSE\t\t=\n+MULTILIB_MATCHES\t=\n+MULTILIB_REQUIRED\t=\n \n # Enumeration of multilibs\n \n-MULTILIB_EXCEPTIONS =\n-\n-MULTILIB_REQUIRED =\n-MULTILIB_REQUIRED += mbig-endian/mthumb/march=armv7-r/mfpu=vfpv3-d16/mfloat-abi=hard\n-MULTILIB_REQUIRED += mbig-endian/mthumb/march=armv7-r\n-MULTILIB_REQUIRED += mfpu=vfp/mfloat-abi=hard\n-MULTILIB_REQUIRED += mthumb/march=armv6-m\n-MULTILIB_REQUIRED += mthumb/march=armv7-a/mfpu=neon/mfloat-abi=hard\n-MULTILIB_REQUIRED += mthumb/march=armv7-a\n-MULTILIB_REQUIRED += mthumb/march=armv7-r/mfpu=vfpv3-d16/mfloat-abi=hard\n-MULTILIB_REQUIRED += mthumb/march=armv7-r\n-MULTILIB_REQUIRED += mthumb/march=armv7-m/mfpu=fpv4-sp-d16/mfloat-abi=hard\n-MULTILIB_REQUIRED += mthumb/mcpu=cortex-m7/mfpu=fpv5-d16/mfloat-abi=hard\n-MULTILIB_REQUIRED += mthumb/march=armv7-m\n-MULTILIB_REQUIRED += mthumb\n+MULTILIB_OPTIONS\t+= mbig-endian\n+MULTILIB_DIRNAMES\t+= eb\n+\n+MULTILIB_OPTIONS\t+= mthumb\n+MULTILIB_DIRNAMES\t+= thumb\n+\n+MULTILIB_OPTIONS\t+= march=armv5te+fp/march=armv6-m/march=armv7-a/march=armv7-a+simd/march=armv7-r/march=armv7-r+fp/march=armv7-m/march=armv7e-m+fp/march=armv7e-m+fp.dp\n+MULTILIB_DIRNAMES\t+= armv5te+fp       armv6-m       armv7-a       armv7-a+simd       armv7-r       armv7-r+fp       armv7-m       armv7e-m+fp        armv7e-m+fp.dp\n+\n+MULTILIB_OPTIONS\t+= mfloat-abi=hard\n+MULTILIB_DIRNAMES\t+= hard\n+\n+MULTILIB_REQUIRED\t+= mbig-endian/mthumb/march=armv7-r+fp/mfloat-abi=hard\n+MULTILIB_REQUIRED\t+= mbig-endian/mthumb/march=armv7-r\n+MULTILIB_REQUIRED\t+= march=armv5te+fp/mfloat-abi=hard\n+MULTILIB_REQUIRED\t+= mthumb/march=armv6-m\n+MULTILIB_REQUIRED\t+= mthumb/march=armv7-a+simd/mfloat-abi=hard\n+MULTILIB_REQUIRED\t+= mthumb/march=armv7-a\n+MULTILIB_REQUIRED\t+= mthumb/march=armv7-r+fp/mfloat-abi=hard\n+MULTILIB_REQUIRED\t+= mthumb/march=armv7-r\n+MULTILIB_REQUIRED\t+= mthumb/march=armv7e-m+fp/mfloat-abi=hard\n+MULTILIB_REQUIRED\t+= mthumb/march=armv7e-m+fp.dp/mfloat-abi=hard\n+MULTILIB_REQUIRED\t+= mthumb/march=armv7-m\n+MULTILIB_REQUIRED\t+= mthumb"}]}