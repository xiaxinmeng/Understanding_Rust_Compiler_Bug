{"sha": "c589e975638b217501e4e868e7d706bb318e18e9", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6YzU4OWU5NzU2MzhiMjE3NTAxZTRlODY4ZTdkNzA2YmIzMThlMThlOQ==", "commit": {"author": {"name": "David Malcolm", "email": "dmalcolm@redhat.com", "date": "2016-01-05T15:54:46Z"}, "committer": {"name": "David Malcolm", "email": "dmalcolm@gcc.gnu.org", "date": "2016-01-05T15:54:46Z"}, "message": "Fix PR c/69122 (-Wmisleading-indentation false positive with empty macros)\n\ngcc/c-family/ChangeLog:\n\tPR c/69122\n\t* c-indentation.c (get_visual_column): Remove default argument.\n\t(should_warn_for_misleading_indentation): For the multiline case,\n\tupdate call to get_visual_column for next_stmt_exploc so that it\n\tcaptures the location of the first non-whitespace character in the\n\trelevant line.  Don't issue warnings if there is non-whitespace\n\tbefore the next statement.\n\ngcc/testsuite/ChangeLog:\n\tPR c/69122\n\t* c-c++-common/Wmisleading-indentation.c (pr69122): New function.\n\nFrom-SVN: r232076", "tree": {"sha": "1722ad395e726afbc91a2ce866781377c0ff8db4", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/1722ad395e726afbc91a2ce866781377c0ff8db4"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/c589e975638b217501e4e868e7d706bb318e18e9", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/c589e975638b217501e4e868e7d706bb318e18e9", "html_url": "https://github.com/Rust-GCC/gccrs/commit/c589e975638b217501e4e868e7d706bb318e18e9", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/c589e975638b217501e4e868e7d706bb318e18e9/comments", "author": {"login": "davidmalcolm", "id": 1553248, "node_id": "MDQ6VXNlcjE1NTMyNDg=", "avatar_url": "https://avatars.githubusercontent.com/u/1553248?v=4", "gravatar_id": "", "url": "https://api.github.com/users/davidmalcolm", "html_url": "https://github.com/davidmalcolm", "followers_url": "https://api.github.com/users/davidmalcolm/followers", "following_url": "https://api.github.com/users/davidmalcolm/following{/other_user}", "gists_url": "https://api.github.com/users/davidmalcolm/gists{/gist_id}", "starred_url": "https://api.github.com/users/davidmalcolm/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/davidmalcolm/subscriptions", "organizations_url": "https://api.github.com/users/davidmalcolm/orgs", "repos_url": "https://api.github.com/users/davidmalcolm/repos", "events_url": "https://api.github.com/users/davidmalcolm/events{/privacy}", "received_events_url": "https://api.github.com/users/davidmalcolm/received_events", "type": "User", "site_admin": false}, "committer": null, "parents": [{"sha": "ce3e43d7c8622171301e253ce5ffeba0e24d8d39", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/ce3e43d7c8622171301e253ce5ffeba0e24d8d39", "html_url": "https://github.com/Rust-GCC/gccrs/commit/ce3e43d7c8622171301e253ce5ffeba0e24d8d39"}], "stats": {"total": 49, "additions": 47, "deletions": 2}, "files": [{"sha": "7bae1a7649d46c9b2dac072e0bd36477b67bf433", "filename": "gcc/c-family/ChangeLog", "status": "modified", "additions": 10, "deletions": 0, "changes": 10, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/c589e975638b217501e4e868e7d706bb318e18e9/gcc%2Fc-family%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/c589e975638b217501e4e868e7d706bb318e18e9/gcc%2Fc-family%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fc-family%2FChangeLog?ref=c589e975638b217501e4e868e7d706bb318e18e9", "patch": "@@ -1,3 +1,13 @@\n+2016-01-05  David Malcolm  <dmalcolm@redhat.com>\n+\n+\tPR c/69122\n+\t* c-indentation.c (get_visual_column): Remove default argument.\n+\t(should_warn_for_misleading_indentation): For the multiline case,\n+\tupdate call to get_visual_column for next_stmt_exploc so that it\n+\tcaptures the location of the first non-whitespace character in the\n+\trelevant line.  Don't issue warnings if there is non-whitespace\n+\tbefore the next statement.\n+\n 2016-01-04  Jakub Jelinek  <jakub@redhat.com>\n \n \tUpdate copyright years."}, {"sha": "3c09336d15ab4984504b5bb39ad2efc759a43ce0", "filename": "gcc/c-family/c-indentation.c", "status": "modified", "additions": 22, "deletions": 2, "changes": 24, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/c589e975638b217501e4e868e7d706bb318e18e9/gcc%2Fc-family%2Fc-indentation.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/c589e975638b217501e4e868e7d706bb318e18e9/gcc%2Fc-family%2Fc-indentation.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fc-family%2Fc-indentation.c?ref=c589e975638b217501e4e868e7d706bb318e18e9", "patch": "@@ -38,7 +38,7 @@ extern cpp_options *cpp_opts;\n static bool\n get_visual_column (expanded_location exploc,\n \t\t   unsigned int *out,\n-\t\t   unsigned int *first_nws = NULL)\n+\t\t   unsigned int *first_nws)\n {\n   int line_len;\n   const char *line = location_get_source_line (exploc.file, exploc.line,\n@@ -329,12 +329,20 @@ should_warn_for_misleading_indentation (const token_indent_info &guard_tinfo,\n \t  ;\n \t  foo ();\n \t  ^ DON'T WARN HERE\n+\n+\t#define emit\n+\tif (flag)\n+\t     foo ();\n+\temit bar ();\n+\t     ^ DON'T WARN HERE\n+\n   */\n   if (next_stmt_exploc.line > body_exploc.line)\n     {\n       /* Determine if GUARD_LOC and NEXT_STMT_LOC are aligned on the same\n \t \"visual column\"...  */\n       unsigned int next_stmt_vis_column;\n+      unsigned int next_stmt_line_first_nws;\n       unsigned int body_vis_column;\n       unsigned int body_line_first_nws;\n       unsigned int guard_vis_column;\n@@ -343,7 +351,8 @@ should_warn_for_misleading_indentation (const token_indent_info &guard_tinfo,\n \t the case for input files containing #line directives, and these\n \t are often for autogenerated sources (e.g. from .md files), where\n \t it's not clear that it's meaningful to look at indentation.  */\n-      if (!get_visual_column (next_stmt_exploc, &next_stmt_vis_column))\n+      if (!get_visual_column (next_stmt_exploc, &next_stmt_vis_column,\n+\t\t\t      &next_stmt_line_first_nws))\n \treturn false;\n       if (!get_visual_column (body_exploc,\n \t\t\t      &body_vis_column,\n@@ -354,6 +363,17 @@ should_warn_for_misleading_indentation (const token_indent_info &guard_tinfo,\n \t\t\t      &guard_line_first_nws))\n \treturn false;\n \n+      /* If the line where the next stmt starts has non-whitespace\n+\t on it before the stmt, then don't warn:\n+\t  #define emit\n+\t  if (flag)\n+\t       foo ();\n+\t  emit bar ();\n+\t       ^ DON'T WARN HERE\n+\t (PR c/69122).  */\n+      if (next_stmt_line_first_nws < next_stmt_vis_column)\n+\treturn false;\n+\n       if ((body_type != CPP_SEMICOLON\n \t   && next_stmt_vis_column == body_vis_column)\n \t  /* As a special case handle the case where the body is a semicolon"}, {"sha": "9ff53ae6c1196699d20f4557f992cb8a22eafe04", "filename": "gcc/testsuite/ChangeLog", "status": "modified", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/c589e975638b217501e4e868e7d706bb318e18e9/gcc%2Ftestsuite%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/c589e975638b217501e4e868e7d706bb318e18e9/gcc%2Ftestsuite%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2FChangeLog?ref=c589e975638b217501e4e868e7d706bb318e18e9", "patch": "@@ -1,3 +1,8 @@\n+2016-01-05  David Malcolm  <dmalcolm@redhat.com>\n+\n+\tPR c/69122\n+\t* c-c++-common/Wmisleading-indentation.c (pr69122): New function.\n+\n 2016-01-05  Nathan Sidwell  <nathan@acm.org>\n \n \tPR c++/58583"}, {"sha": "491291c171cca22f3a4f91618210166ecf0886a5", "filename": "gcc/testsuite/c-c++-common/Wmisleading-indentation.c", "status": "modified", "additions": 10, "deletions": 0, "changes": 10, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/c589e975638b217501e4e868e7d706bb318e18e9/gcc%2Ftestsuite%2Fc-c%2B%2B-common%2FWmisleading-indentation.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/c589e975638b217501e4e868e7d706bb318e18e9/gcc%2Ftestsuite%2Fc-c%2B%2B-common%2FWmisleading-indentation.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fc-c%2B%2B-common%2FWmisleading-indentation.c?ref=c589e975638b217501e4e868e7d706bb318e18e9", "patch": "@@ -891,3 +891,13 @@ fn_39 (void)\n        i++);\n   foo (i);\n }\n+\n+/* We shouldn't complain about the following function.  */\n+#define emit\n+void pr69122 (void)\n+{\n+  if (flagA)\n+       foo (0);\n+  emit foo (1);\n+}\n+#undef emit"}]}