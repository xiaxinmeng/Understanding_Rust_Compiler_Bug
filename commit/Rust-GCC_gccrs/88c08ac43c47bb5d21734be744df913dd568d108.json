{"sha": "88c08ac43c47bb5d21734be744df913dd568d108", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6ODhjMDhhYzQzYzQ3YmI1ZDIxNzM0YmU3NDRkZjkxM2RkNTY4ZDEwOA==", "commit": {"author": {"name": "Paul Thomas", "email": "pault@gcc.gnu.org", "date": "2018-10-21T17:32:06Z"}, "committer": {"name": "Paul Thomas", "email": "pault@gcc.gnu.org", "date": "2018-10-21T17:32:06Z"}, "message": "re PR fortran/71880 (pointer to allocatable character)\n\n2018-10-21  Paul Thomas  <pault@gcc.gnu.org>\n\n\tPR fortran/71880\n\t* trans-expr.c (gfc_trans_pointer_assignment): Set the string\n\tlength for array valued deferred length lhs.\n\n2018-10-21  Paul Thomas  <pault@gcc.gnu.org>\n\n\tPR fortran/71880\n\t* gfortran.dg/deferred_character_31.f90 : New test.\n\nFrom-SVN: r265353", "tree": {"sha": "6219a582f7f6706baa77bf086db233e7bd3217c0", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/6219a582f7f6706baa77bf086db233e7bd3217c0"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/88c08ac43c47bb5d21734be744df913dd568d108", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/88c08ac43c47bb5d21734be744df913dd568d108", "html_url": "https://github.com/Rust-GCC/gccrs/commit/88c08ac43c47bb5d21734be744df913dd568d108", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/88c08ac43c47bb5d21734be744df913dd568d108/comments", "author": null, "committer": null, "parents": [{"sha": "ea1adf1d532124f2ed41e3220105562d3df3333c", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/ea1adf1d532124f2ed41e3220105562d3df3333c", "html_url": "https://github.com/Rust-GCC/gccrs/commit/ea1adf1d532124f2ed41e3220105562d3df3333c"}], "stats": {"total": 40, "additions": 40, "deletions": 0}, "files": [{"sha": "70ba4cce47320510ca42fd5aa56c5bb25db523a7", "filename": "gcc/fortran/ChangeLog", "status": "modified", "additions": 6, "deletions": 0, "changes": 6, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/88c08ac43c47bb5d21734be744df913dd568d108/gcc%2Ffortran%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/88c08ac43c47bb5d21734be744df913dd568d108/gcc%2Ffortran%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ffortran%2FChangeLog?ref=88c08ac43c47bb5d21734be744df913dd568d108", "patch": "@@ -1,3 +1,9 @@\n+2018-10-21  Paul Thomas  <pault@gcc.gnu.org>\n+\n+\tPR fortran/71880\n+\t* trans-expr.c (gfc_trans_pointer_assignment): Set the string\n+\tlength for array valued deferred length lhs.\n+\n 2018-10-18  Tobias Burnus  <burnus@net-b.de>\n \n \tPR fortran/87625"}, {"sha": "05b1d07eb0293dc4959bcbb6a90f11401c669f84", "filename": "gcc/fortran/trans-expr.c", "status": "modified", "additions": 13, "deletions": 0, "changes": 13, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/88c08ac43c47bb5d21734be744df913dd568d108/gcc%2Ffortran%2Ftrans-expr.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/88c08ac43c47bb5d21734be744df913dd568d108/gcc%2Ffortran%2Ftrans-expr.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ffortran%2Ftrans-expr.c?ref=88c08ac43c47bb5d21734be744df913dd568d108", "patch": "@@ -8870,6 +8870,19 @@ gfc_trans_pointer_assignment (gfc_expr * expr1, gfc_expr * expr2)\n \t\t\t\t   msg, rsize, lsize);\n \t}\n \n+      if (expr1->ts.type == BT_CHARACTER\n+\t  && expr1->symtree->n.sym->ts.deferred\n+\t  && expr1->symtree->n.sym->ts.u.cl->backend_decl\n+\t  && VAR_P (expr1->symtree->n.sym->ts.u.cl->backend_decl))\n+\t{\n+\t  tmp = expr1->symtree->n.sym->ts.u.cl->backend_decl;\n+\t  if (expr2->expr_type != EXPR_NULL)\n+\t    gfc_add_modify (&block, tmp,\n+\t\t\t    fold_convert (TREE_TYPE (tmp), strlen_rhs));\n+\t  else\n+\t    gfc_add_modify (&block, tmp, build_zero_cst (TREE_TYPE (tmp)));\n+\t}\n+\n       gfc_add_block_to_block (&block, &lse.post);\n       if (rank_remap)\n \tgfc_add_block_to_block (&block, &rse.post);"}, {"sha": "c3ea50c8e3ac0541f8d4bd7f59932592a8a7d23d", "filename": "gcc/testsuite/ChangeLog", "status": "modified", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/88c08ac43c47bb5d21734be744df913dd568d108/gcc%2Ftestsuite%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/88c08ac43c47bb5d21734be744df913dd568d108/gcc%2Ftestsuite%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2FChangeLog?ref=88c08ac43c47bb5d21734be744df913dd568d108", "patch": "@@ -1,3 +1,8 @@\n+2018-10-21  Paul Thomas  <pault@gcc.gnu.org>\n+\n+\tPR fortran/71880\n+\t* gfortran.dg/deferred_character_31.f90 : New test.\n+\n 2018-10-21  H.J. Lu  <hongjiu.lu@intel.com>\n \n \tPR target/72782"}, {"sha": "890b33e82df748fdcfad781f016c1de937facd0e", "filename": "gcc/testsuite/gfortran.dg/deferred_character_31.f90", "status": "added", "additions": 16, "deletions": 0, "changes": 16, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/88c08ac43c47bb5d21734be744df913dd568d108/gcc%2Ftestsuite%2Fgfortran.dg%2Fdeferred_character_31.f90", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/88c08ac43c47bb5d21734be744df913dd568d108/gcc%2Ftestsuite%2Fgfortran.dg%2Fdeferred_character_31.f90", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgfortran.dg%2Fdeferred_character_31.f90?ref=88c08ac43c47bb5d21734be744df913dd568d108", "patch": "@@ -0,0 +1,16 @@\n+! { dg-do }\n+!\n+! Test the fix for PR71880 in which the string length for 'p'\n+! was not set for the pointer assignment.\n+!\n+! Contributed by Valery Weber  <valeryweber@hotmail.com>\n+!\n+program t\n+  character(:), dimension(:), allocatable, target :: c\n+  character(:), dimension(:), pointer :: p => NULL ()\n+  allocate(c, source = ['ABC','DEF','GHI'])\n+  p => c\n+  if (len(p) .ne. len (c)) stop 1\n+  if (size (p, 1) .ne. size (c, 1)) stop 2\n+  if (any (p .ne. c)) stop 3\n+end program t"}]}