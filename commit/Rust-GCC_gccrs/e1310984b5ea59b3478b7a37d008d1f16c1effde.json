{"sha": "e1310984b5ea59b3478b7a37d008d1f16c1effde", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6ZTEzMTA5ODRiNWVhNTliMzQ3OGI3YTM3ZDAwOGQxZjE2YzFlZmZkZQ==", "commit": {"author": {"name": "Jason Merrill", "email": "jason@redhat.com", "date": "2012-07-19T20:01:56Z"}, "committer": {"name": "Jason Merrill", "email": "jason@gcc.gnu.org", "date": "2012-07-19T20:01:56Z"}, "message": "re PR debug/53235 (20120504 broke -fdebug-types-section)\n\n\tPR debug/53235\n\t* dwarf2out.c (generate_type_signature): Handle the case of DIE\n\tbeing nested, rather than its declaration..\n\nFrom-SVN: r189676", "tree": {"sha": "fb904da8c31d229932491fddd79d8a08930b1eed", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/fb904da8c31d229932491fddd79d8a08930b1eed"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/e1310984b5ea59b3478b7a37d008d1f16c1effde", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/e1310984b5ea59b3478b7a37d008d1f16c1effde", "html_url": "https://github.com/Rust-GCC/gccrs/commit/e1310984b5ea59b3478b7a37d008d1f16c1effde", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/e1310984b5ea59b3478b7a37d008d1f16c1effde/comments", "author": {"login": "jicama", "id": 266146, "node_id": "MDQ6VXNlcjI2NjE0Ng==", "avatar_url": "https://avatars.githubusercontent.com/u/266146?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jicama", "html_url": "https://github.com/jicama", "followers_url": "https://api.github.com/users/jicama/followers", "following_url": "https://api.github.com/users/jicama/following{/other_user}", "gists_url": "https://api.github.com/users/jicama/gists{/gist_id}", "starred_url": "https://api.github.com/users/jicama/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jicama/subscriptions", "organizations_url": "https://api.github.com/users/jicama/orgs", "repos_url": "https://api.github.com/users/jicama/repos", "events_url": "https://api.github.com/users/jicama/events{/privacy}", "received_events_url": "https://api.github.com/users/jicama/received_events", "type": "User", "site_admin": false}, "committer": null, "parents": [{"sha": "1312c276d64f91c4b44072d37bbef0b817ae2ee2", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/1312c276d64f91c4b44072d37bbef0b817ae2ee2", "html_url": "https://github.com/Rust-GCC/gccrs/commit/1312c276d64f91c4b44072d37bbef0b817ae2ee2"}], "stats": {"total": 47, "additions": 43, "deletions": 4}, "files": [{"sha": "c87c3cc19a9332c821dfc2d9707787749d5d1f9b", "filename": "gcc/ChangeLog", "status": "modified", "additions": 6, "deletions": 0, "changes": 6, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/e1310984b5ea59b3478b7a37d008d1f16c1effde/gcc%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/e1310984b5ea59b3478b7a37d008d1f16c1effde/gcc%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2FChangeLog?ref=e1310984b5ea59b3478b7a37d008d1f16c1effde", "patch": "@@ -1,3 +1,9 @@\n+2012-07-19  Jason Merrill  <jason@redhat.com>\n+\n+\tPR debug/53235\n+\t* dwarf2out.c (get_die_parent): New.\n+\t(generate_type_signature): Use it.\n+\n 2012-07-19  Richard Henderson  <rth@redhat.com>\n \n \t* config/ia64/vect.md (smulv4hi3_highpart): New."}, {"sha": "e36a15d60c93387664c416e2f7001b5b40623c66", "filename": "gcc/dwarf2out.c", "status": "modified", "additions": 23, "deletions": 4, "changes": 27, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/e1310984b5ea59b3478b7a37d008d1f16c1effde/gcc%2Fdwarf2out.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/e1310984b5ea59b3478b7a37d008d1f16c1effde/gcc%2Fdwarf2out.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fdwarf2out.c?ref=e1310984b5ea59b3478b7a37d008d1f16c1effde", "patch": "@@ -4011,6 +4011,23 @@ get_AT (dw_die_ref die, enum dwarf_attribute attr_kind)\n   return NULL;\n }\n \n+/* Returns the parent of the declaration of DIE.  */\n+\n+static dw_die_ref\n+get_die_parent (dw_die_ref die)\n+{\n+  dw_die_ref t;\n+\n+  if (!die)\n+    return NULL;\n+\n+  if ((t = get_AT_ref (die, DW_AT_abstract_origin))\n+      || (t = get_AT_ref (die, DW_AT_specification)))\n+    die = t;\n+\n+  return die->die_parent;\n+}\n+\n /* Return the \"low pc\" attribute value, typically associated with a subprogram\n    DIE.  Return null if the \"low pc\" attribute is either not present, or if it\n    cannot be represented as an assembler label identifier.  */\n@@ -5630,9 +5647,11 @@ generate_type_signature (dw_die_ref die, comdat_type_node *type_node)\n   unsigned char checksum[16];\n   struct md5_ctx ctx;\n   dw_die_ref decl;\n+  dw_die_ref parent;\n \n   name = get_AT_string (die, DW_AT_name);\n   decl = get_AT_ref (die, DW_AT_specification);\n+  parent = get_die_parent (die);\n \n   /* First, compute a signature for just the type name (and its surrounding\n      context, if any.  This is stored in the type unit DIE for link-time\n@@ -5643,8 +5662,8 @@ generate_type_signature (dw_die_ref die, comdat_type_node *type_node)\n       md5_init_ctx (&ctx);\n \n       /* Checksum the names of surrounding namespaces and structures.  */\n-      if (decl != NULL && decl->die_parent != NULL)\n-        checksum_die_context (decl->die_parent, &ctx);\n+      if (parent != NULL)\n+        checksum_die_context (parent, &ctx);\n \n       md5_process_bytes (&die->die_tag, sizeof (die->die_tag), &ctx);\n       md5_process_bytes (name, strlen (name) + 1, &ctx);\n@@ -5660,8 +5679,8 @@ generate_type_signature (dw_die_ref die, comdat_type_node *type_node)\n   die->die_mark = mark;\n \n   /* Checksum the names of surrounding namespaces and structures.  */\n-  if (decl != NULL && decl->die_parent != NULL)\n-    checksum_die_context (decl->die_parent, &ctx);\n+  if (parent != NULL)\n+    checksum_die_context (parent, &ctx);\n \n   /* Checksum the DIE and its children.  */\n   die_checksum_ordered (die, &ctx, &mark);"}, {"sha": "8ab75e1ce5ba13d06d4344b4130079cbe7cf8d09", "filename": "gcc/testsuite/g++.dg/debug/dwarf2/nested-4.C", "status": "added", "additions": 14, "deletions": 0, "changes": 14, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/e1310984b5ea59b3478b7a37d008d1f16c1effde/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Fdebug%2Fdwarf2%2Fnested-4.C", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/e1310984b5ea59b3478b7a37d008d1f16c1effde/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Fdebug%2Fdwarf2%2Fnested-4.C", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Fdebug%2Fdwarf2%2Fnested-4.C?ref=e1310984b5ea59b3478b7a37d008d1f16c1effde", "patch": "@@ -0,0 +1,14 @@\n+// PR debug/53235\n+// { dg-options \"-gdwarf-4 -fdebug-types-section\" }\n+// { dg-final { scan-assembler-times \"debug_types\" 2 } }\n+\n+namespace E {\n+  class O {};\n+  void f (O o) {}\n+}\n+namespace F {\n+  class O {};\n+  void f (O fo) {}\n+}\n+E::O eo;\n+int main () {}"}]}