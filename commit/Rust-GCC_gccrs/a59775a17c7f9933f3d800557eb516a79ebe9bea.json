{"sha": "a59775a17c7f9933f3d800557eb516a79ebe9bea", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6YTU5Nzc1YTE3YzdmOTkzM2YzZDgwMDU1N2ViNTE2YTc5ZWJlOWJlYQ==", "commit": {"author": {"name": "Paolo Carlini", "email": "paolo.carlini@oracle.com", "date": "2016-05-30T15:10:51Z"}, "committer": {"name": "Paolo Carlini", "email": "paolo@gcc.gnu.org", "date": "2016-05-30T15:10:51Z"}, "message": "re PR c++/71099 (Misleading diagnostic message with 'virtual' used in out-of-line definitions of class template member functions)\n\n/cp\n2016-05-30  Paolo Carlini  <paolo.carlini@oracle.com>\n\n\tPR c++/71099\n\t* parser.c (cp_parser_function_specifier_opt): Use current_class_type\n\tto improve the diagnostic about wrong uses of 'virtual'.\n\n/testsuite\n2016-05-30  Paolo Carlini  <paolo.carlini@oracle.com>\n\n\tPR c++/71099\n\t* g++.dg/parse/virtual1.C: New.\n\nFrom-SVN: r236885", "tree": {"sha": "c7c23ee68d8ebf6073ebdc1d427674d032309edb", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/c7c23ee68d8ebf6073ebdc1d427674d032309edb"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/a59775a17c7f9933f3d800557eb516a79ebe9bea", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/a59775a17c7f9933f3d800557eb516a79ebe9bea", "html_url": "https://github.com/Rust-GCC/gccrs/commit/a59775a17c7f9933f3d800557eb516a79ebe9bea", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/a59775a17c7f9933f3d800557eb516a79ebe9bea/comments", "author": null, "committer": null, "parents": [{"sha": "53d6d955606658b7fe0bb9356ad9d7191b61742c", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/53d6d955606658b7fe0bb9356ad9d7191b61742c", "html_url": "https://github.com/Rust-GCC/gccrs/commit/53d6d955606658b7fe0bb9356ad9d7191b61742c"}], "stats": {"total": 47, "additions": 46, "deletions": 1}, "files": [{"sha": "9b35abc66bc922dc6da4b0dafcde158feccc3385", "filename": "gcc/cp/ChangeLog", "status": "modified", "additions": 6, "deletions": 0, "changes": 6, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/a59775a17c7f9933f3d800557eb516a79ebe9bea/gcc%2Fcp%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/a59775a17c7f9933f3d800557eb516a79ebe9bea/gcc%2Fcp%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fcp%2FChangeLog?ref=a59775a17c7f9933f3d800557eb516a79ebe9bea", "patch": "@@ -1,3 +1,9 @@\n+2016-05-30  Paolo Carlini  <paolo.carlini@oracle.com>\n+\n+\tPR c++/71099\n+\t* parser.c (cp_parser_function_specifier_opt): Use current_class_type\n+\tto improve the diagnostic about wrong uses of 'virtual'.\n+\n 2016-05-29  Paolo Carlini  <paolo.carlini@oracle.com>\n \n \tPR c++/71105"}, {"sha": "c6c2c0cf948478480314edcc14f193bb257e66aa", "filename": "gcc/cp/parser.c", "status": "modified", "additions": 2, "deletions": 1, "changes": 3, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/a59775a17c7f9933f3d800557eb516a79ebe9bea/gcc%2Fcp%2Fparser.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/a59775a17c7f9933f3d800557eb516a79ebe9bea/gcc%2Fcp%2Fparser.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fcp%2Fparser.c?ref=a59775a17c7f9933f3d800557eb516a79ebe9bea", "patch": "@@ -12888,7 +12888,8 @@ cp_parser_function_specifier_opt (cp_parser* parser,\n       /* 14.5.2.3 [temp.mem]\n \n \t A member function template shall not be virtual.  */\n-      if (PROCESSING_REAL_TEMPLATE_DECL_P ())\n+      if (PROCESSING_REAL_TEMPLATE_DECL_P ()\n+\t  && current_class_type)\n \terror_at (token->location, \"templates may not be %<virtual%>\");\n       else\n \tset_and_check_decl_spec_loc (decl_specs, ds_virtual, token);"}, {"sha": "6df7274fcfda1677b27e54580229691b6efe571f", "filename": "gcc/testsuite/ChangeLog", "status": "modified", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/a59775a17c7f9933f3d800557eb516a79ebe9bea/gcc%2Ftestsuite%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/a59775a17c7f9933f3d800557eb516a79ebe9bea/gcc%2Ftestsuite%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2FChangeLog?ref=a59775a17c7f9933f3d800557eb516a79ebe9bea", "patch": "@@ -1,3 +1,8 @@\n+2016-05-30  Paolo Carlini  <paolo.carlini@oracle.com>\n+\n+\tPR c++/71099\n+\t* g++.dg/parse/virtual1.C: New.\n+\n 2016-05-30  Uros Bizjak  <ubizjak@gmail.com>\n \n \t* gcc.target/i386/iamcu/args.h (clear_non_sret_int_hardware_registers):"}, {"sha": "1a5b995e34e333e6cd68a094d2f3fd2f3cacebe4", "filename": "gcc/testsuite/g++.dg/parse/virtual1.C", "status": "added", "additions": 33, "deletions": 0, "changes": 33, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/a59775a17c7f9933f3d800557eb516a79ebe9bea/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Fparse%2Fvirtual1.C", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/a59775a17c7f9933f3d800557eb516a79ebe9bea/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Fparse%2Fvirtual1.C", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Fparse%2Fvirtual1.C?ref=a59775a17c7f9933f3d800557eb516a79ebe9bea", "patch": "@@ -0,0 +1,33 @@\n+// PR c++/71099\n+\n+struct A {\n+  virtual void foo();\n+};\n+\n+virtual void A::foo() {}  // { dg-error \"'virtual' outside class\" }\n+\n+template<typename>\n+struct B {\n+  virtual void foo();\n+};\n+\n+template<typename T>\n+virtual void B<T>::foo() {}  // { dg-error \"'virtual' outside class\" }\n+\n+struct C {\n+  template<typename>\n+  virtual void foo();  // { dg-error \"templates may not be 'virtual'\" }\n+};\n+\n+template<typename>\n+virtual void C::foo() {}  // { dg-error \"'virtual' outside class\" }\n+\n+template<typename>\n+struct D {\n+  template<typename>\n+  virtual void foo();  // { dg-error \"templates may not be 'virtual'\" }\n+};\n+\n+template<typename T>\n+template<typename>\n+virtual void D<T>::foo() {}  // { dg-error \"'virtual' outside class\" }"}]}