{"sha": "3807621a13b69e6b12fbae5d4667c696c0898da2", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6MzgwNzYyMWExM2I2OWU2YjEyZmJhZTVkNDY2N2M2OTZjMDg5OGRhMg==", "commit": {"author": {"name": "Nathan Sidwell", "email": "nathan@codesourcery.com", "date": "2002-01-19T20:55:35Z"}, "committer": {"name": "Nathan Sidwell", "email": "nathan@gcc.gnu.org", "date": "2002-01-19T20:55:35Z"}, "message": "Fix regression introduced with patch for c++/775\n\ncp:\n\tFix regression introduced with patch for c++/775\n\t* parse.y (class_head_defn): Check for template specializations\n\twith a different class-key.\ntestsuite:\n\t* g++.dg/template/access1.C: New test.\n\nFrom-SVN: r49016", "tree": {"sha": "c0caa429a30876deffed186413d273aee78c75d9", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/c0caa429a30876deffed186413d273aee78c75d9"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/3807621a13b69e6b12fbae5d4667c696c0898da2", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/3807621a13b69e6b12fbae5d4667c696c0898da2", "html_url": "https://github.com/Rust-GCC/gccrs/commit/3807621a13b69e6b12fbae5d4667c696c0898da2", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/3807621a13b69e6b12fbae5d4667c696c0898da2/comments", "author": null, "committer": null, "parents": [{"sha": "e5550355c859516409f4e089ca5bda09f3811ea6", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/e5550355c859516409f4e089ca5bda09f3811ea6", "html_url": "https://github.com/Rust-GCC/gccrs/commit/e5550355c859516409f4e089ca5bda09f3811ea6"}], "stats": {"total": 47, "additions": 47, "deletions": 0}, "files": [{"sha": "b4c9f704eb1f9bc0baa1c319b23c48fcccd9605e", "filename": "gcc/cp/ChangeLog", "status": "modified", "additions": 6, "deletions": 0, "changes": 6, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/3807621a13b69e6b12fbae5d4667c696c0898da2/gcc%2Fcp%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/3807621a13b69e6b12fbae5d4667c696c0898da2/gcc%2Fcp%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fcp%2FChangeLog?ref=3807621a13b69e6b12fbae5d4667c696c0898da2", "patch": "@@ -1,3 +1,9 @@\n+2002-01-19  Nathan Sidwell  <nathan@codesourcery.com>\n+\n+\tFix regression introduced with patch for c++/775\n+\t* parse.y (class_head_defn): Check for template specializations\n+\twith a different class-key.\n+\n 2002-01-17  Jason Merrill  <jason@redhat.com>\n \n \t* decl.c (begin_constructor_body, begin_destructor_body): New fns."}, {"sha": "420e428f0192238a637fec69aeb53745427fb4a9", "filename": "gcc/cp/parse.y", "status": "modified", "additions": 10, "deletions": 0, "changes": 10, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/3807621a13b69e6b12fbae5d4667c696c0898da2/gcc%2Fcp%2Fparse.y", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/3807621a13b69e6b12fbae5d4667c696c0898da2/gcc%2Fcp%2Fparse.y", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fcp%2Fparse.y?ref=3807621a13b69e6b12fbae5d4667c696c0898da2", "patch": "@@ -2434,12 +2434,22 @@ class_head_defn:\n \t\t  yyungetc ('{', 1);\n \t\t  $$.t = $1;\n \t\t  $$.new_type_flag = 0;\n+\t\t  if (TREE_CODE (TREE_TYPE ($1)) == RECORD_TYPE)\n+\t\t    /* We might be specializing a template with a different\n+\t\t       class-key.  */\n+\t\t    CLASSTYPE_DECLARED_CLASS (TREE_TYPE ($1))\n+\t\t      = (current_aggr == class_type_node);\n \t\t}\n \t| class_head_apparent_template ':'\n \t\t{\n \t\t  yyungetc (':', 1);\n \t\t  $$.t = $1;\n \t\t  $$.new_type_flag = 0;\n+\t\t  if (TREE_CODE (TREE_TYPE ($1)) == RECORD_TYPE)\n+\t\t    /* We might be specializing a template with a different\n+\t\t       class-key.  */\n+\t\t    CLASSTYPE_DECLARED_CLASS (TREE_TYPE ($1))\n+\t\t      = (current_aggr == class_type_node);\n \t\t}\n \t| aggr identifier_defn '{'\n \t\t{"}, {"sha": "54e1a3698d0ee3c9337f6bc6759f36da5e857570", "filename": "gcc/testsuite/ChangeLog", "status": "modified", "additions": 4, "deletions": 0, "changes": 4, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/3807621a13b69e6b12fbae5d4667c696c0898da2/gcc%2Ftestsuite%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/3807621a13b69e6b12fbae5d4667c696c0898da2/gcc%2Ftestsuite%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2FChangeLog?ref=3807621a13b69e6b12fbae5d4667c696c0898da2", "patch": "@@ -1,3 +1,7 @@\n+2002-01-19  Nathan Sidwell  <nathan@codesourcery.com>\n+\n+\t* g++.dg/template/access1.C: New test.\n+\n 2002-01-18  Aldy Hernandez  <aldyh@redhat.com>\n \n         * gcc.dg/20020118-1.c: New."}, {"sha": "1622e087df82d23f5cf699e7bc327a0a5795e855", "filename": "gcc/testsuite/g++.dg/template/access1.C", "status": "added", "additions": 27, "deletions": 0, "changes": 27, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/3807621a13b69e6b12fbae5d4667c696c0898da2/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Ftemplate%2Faccess1.C", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/3807621a13b69e6b12fbae5d4667c696c0898da2/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Ftemplate%2Faccess1.C", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Ftemplate%2Faccess1.C?ref=3807621a13b69e6b12fbae5d4667c696c0898da2", "patch": "@@ -0,0 +1,27 @@\n+// { dg-do compile }\n+\n+// Copyright (C) 2001 Free Software Foundation, Inc.\n+// Contributed by Nathan Sidwell 19 Jan 2002 <nathan@codesourcery.com>\n+\n+// It is legal to specialize a template with a different class-key.\n+\n+template<typename T> class X;\n+\n+template<typename T> struct X<T *>\n+{\n+  int i;\n+};\n+template<> struct X<int>\n+{\n+  int i;\n+};\n+\n+void foo ()\n+{\n+  X<int *> xip;\n+  X<int> xi;\n+\n+  xip.i;\n+  xi.i;\n+}\n+"}]}