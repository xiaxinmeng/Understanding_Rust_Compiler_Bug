{"sha": "3e1123e52f8eca2650efa0bc81768792d328961f", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6M2UxMTIzZTUyZjhlY2EyNjUwZWZhMGJjODE3Njg3OTJkMzI4OTYxZg==", "commit": {"author": {"name": "Jan Hubicka", "email": "jh@suse.cz", "date": "2020-10-08T15:15:58Z"}, "committer": {"name": "Jan Hubicka", "email": "jh@suse.cz", "date": "2020-10-08T15:23:16Z"}, "message": "Disable TBAA in some uses of call_may_clobber_ref_p\n\n\t* tree-nrv.c (dest_safe_for_nrv_p): Disable tbaa in\n\tcall_may_clobber_ref_p and ref_maybe_used_by_stmt_p.\n\t* tree-tailcall.c (find_tail_calls): Likewise.\n\t* tree-ssa-alias.c (call_may_clobber_ref_p): Add tbaa_p parameter.\n\t* tree-ssa-alias.h (call_may_clobber_ref_p): Update prototype.\n\t* tree-ssa-sccvn.c (vn_reference_lookup_3): Pass data->tbaa_p\n\tto call_may_clobber_ref_p_1.", "tree": {"sha": "6d7164bbf9f936430f020bc3ef566542abdbe447", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/6d7164bbf9f936430f020bc3ef566542abdbe447"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/3e1123e52f8eca2650efa0bc81768792d328961f", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/3e1123e52f8eca2650efa0bc81768792d328961f", "html_url": "https://github.com/Rust-GCC/gccrs/commit/3e1123e52f8eca2650efa0bc81768792d328961f", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/3e1123e52f8eca2650efa0bc81768792d328961f/comments", "author": null, "committer": null, "parents": [{"sha": "3a9e6ee42acf1e3d00e4391ab1b1a56bb0b32ad2", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/3a9e6ee42acf1e3d00e4391ab1b1a56bb0b32ad2", "html_url": "https://github.com/Rust-GCC/gccrs/commit/3a9e6ee42acf1e3d00e4391ab1b1a56bb0b32ad2"}], "stats": {"total": 18, "additions": 9, "deletions": 9}, "files": [{"sha": "df757f70e71ee9739d48f976ebaea76f53be26d5", "filename": "gcc/tree-nrv.c", "status": "modified", "additions": 2, "deletions": 2, "changes": 4, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/3e1123e52f8eca2650efa0bc81768792d328961f/gcc%2Ftree-nrv.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/3e1123e52f8eca2650efa0bc81768792d328961f/gcc%2Ftree-nrv.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftree-nrv.c?ref=3e1123e52f8eca2650efa0bc81768792d328961f", "patch": "@@ -315,8 +315,8 @@ dest_safe_for_nrv_p (gcall *call)\n   if (TREE_CODE (dest) == SSA_NAME)\n     return true;\n \n-  if (call_may_clobber_ref_p (call, dest)\n-      || ref_maybe_used_by_stmt_p (call, dest))\n+  if (call_may_clobber_ref_p (call, dest, false)\n+      || ref_maybe_used_by_stmt_p (call, dest, false))\n     return false;\n \n   return true;"}, {"sha": "ac7e020c5e23e442ec4391232153080a62dc0cd9", "filename": "gcc/tree-ssa-alias.c", "status": "modified", "additions": 2, "deletions": 2, "changes": 4, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/3e1123e52f8eca2650efa0bc81768792d328961f/gcc%2Ftree-ssa-alias.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/3e1123e52f8eca2650efa0bc81768792d328961f/gcc%2Ftree-ssa-alias.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftree-ssa-alias.c?ref=3e1123e52f8eca2650efa0bc81768792d328961f", "patch": "@@ -3320,12 +3320,12 @@ call_may_clobber_ref_p_1 (gcall *call, ao_ref *ref, bool tbaa_p)\n    return true, otherwise return false.  */\n \n bool\n-call_may_clobber_ref_p (gcall *call, tree ref)\n+call_may_clobber_ref_p (gcall *call, tree ref, bool tbaa_p)\n {\n   bool res;\n   ao_ref r;\n   ao_ref_init (&r, ref);\n-  res = call_may_clobber_ref_p_1 (call, &r, true);\n+  res = call_may_clobber_ref_p_1 (call, &r, tbaa_p);\n   if (res)\n     ++alias_stats.call_may_clobber_ref_p_may_alias;\n   else"}, {"sha": "1561ead2941e304f939fb0989474f1b7eae96495", "filename": "gcc/tree-ssa-alias.h", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/3e1123e52f8eca2650efa0bc81768792d328961f/gcc%2Ftree-ssa-alias.h", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/3e1123e52f8eca2650efa0bc81768792d328961f/gcc%2Ftree-ssa-alias.h", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftree-ssa-alias.h?ref=3e1123e52f8eca2650efa0bc81768792d328961f", "patch": "@@ -128,7 +128,7 @@ extern bool ref_maybe_used_by_stmt_p (gimple *, ao_ref *, bool = true);\n extern bool stmt_may_clobber_global_p (gimple *);\n extern bool stmt_may_clobber_ref_p (gimple *, tree, bool = true);\n extern bool stmt_may_clobber_ref_p_1 (gimple *, ao_ref *, bool = true);\n-extern bool call_may_clobber_ref_p (gcall *, tree);\n+extern bool call_may_clobber_ref_p (gcall *, tree, bool = true);\n extern bool call_may_clobber_ref_p_1 (gcall *, ao_ref *, bool = true);\n extern bool stmt_kills_ref_p (gimple *, tree);\n extern bool stmt_kills_ref_p (gimple *, ao_ref *);"}, {"sha": "c139adb6130b4f0cd43e265c6bc88e9f40f61b28", "filename": "gcc/tree-ssa-sccvn.c", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/3e1123e52f8eca2650efa0bc81768792d328961f/gcc%2Ftree-ssa-sccvn.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/3e1123e52f8eca2650efa0bc81768792d328961f/gcc%2Ftree-ssa-sccvn.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftree-ssa-sccvn.c?ref=3e1123e52f8eca2650efa0bc81768792d328961f", "patch": "@@ -2586,7 +2586,7 @@ vn_reference_lookup_3 (ao_ref *ref, tree vuse, void *data_,\n       if (valueized_anything)\n \t{\n \t  bool res = call_may_clobber_ref_p_1 (as_a <gcall *> (def_stmt),\n-\t\t\t\t\t       ref);\n+\t\t\t\t\t       ref, data->tbaa_p);\n \t  for (unsigned i = 0; i < gimple_call_num_args (def_stmt); ++i)\n \t    gimple_call_set_arg (def_stmt, i, oldargs[i]);\n \t  if (!res)"}, {"sha": "44643bef5f18a332bb5fe114838cbca32b430b32", "filename": "gcc/tree-tailcall.c", "status": "modified", "additions": 3, "deletions": 3, "changes": 6, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/3e1123e52f8eca2650efa0bc81768792d328961f/gcc%2Ftree-tailcall.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/3e1123e52f8eca2650efa0bc81768792d328961f/gcc%2Ftree-tailcall.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftree-tailcall.c?ref=3e1123e52f8eca2650efa0bc81768792d328961f", "patch": "@@ -523,7 +523,7 @@ find_tail_calls (basic_block bb, struct tailcall **ret)\n   tree result_decl = DECL_RESULT (cfun->decl);\n   if (result_decl\n       && may_be_aliased (result_decl)\n-      && ref_maybe_used_by_stmt_p (call, result_decl))\n+      && ref_maybe_used_by_stmt_p (call, result_decl, false))\n     return;\n \n   /* We found the call, check whether it is suitable.  */\n@@ -597,8 +597,8 @@ find_tail_calls (basic_block bb, struct tailcall **ret)\n       if (TREE_CODE (var) != PARM_DECL\n \t  && auto_var_in_fn_p (var, cfun->decl)\n \t  && may_be_aliased (var)\n-\t  && (ref_maybe_used_by_stmt_p (call, var)\n-\t      || call_may_clobber_ref_p (call, var)))\n+\t  && (ref_maybe_used_by_stmt_p (call, var, false)\n+\t      || call_may_clobber_ref_p (call, var, false)))\n \t{\n \t  if (!VAR_P (var))\n \t    {"}]}