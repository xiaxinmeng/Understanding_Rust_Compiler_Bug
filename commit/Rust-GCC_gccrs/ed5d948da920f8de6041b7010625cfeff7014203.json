{"sha": "ed5d948da920f8de6041b7010625cfeff7014203", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6ZWQ1ZDk0OGRhOTIwZjhkZTYwNDFiNzAxMDYyNWNmZWZmNzAxNDIwMw==", "commit": {"author": {"name": "Tom de Vries", "email": "tom@codesourcery.com", "date": "2016-02-15T09:30:31Z"}, "committer": {"name": "Tom de Vries", "email": "vries@gcc.gnu.org", "date": "2016-02-15T09:30:31Z"}, "message": "Don't mark offload symbols with force_output in ltrans\n\n2016-02-15  Tom de Vries  <tom@codesourcery.com>\n\n\tPR lto/69655\n\t* lto-cgraph.c (input_offload_tables): Add and handle bool parameter\n\tdo_force_output.\n\t* lto-streamer.h (input_offload_tables): Add and handle bool parameter.\n\n\t* lto.c (read_cgraph_and_symbols): Call input_offload_tables with\n\targument.\n\nFrom-SVN: r233419", "tree": {"sha": "24bbedf25b4db21dabf774f9f1f9752681a677a7", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/24bbedf25b4db21dabf774f9f1f9752681a677a7"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/ed5d948da920f8de6041b7010625cfeff7014203", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/ed5d948da920f8de6041b7010625cfeff7014203", "html_url": "https://github.com/Rust-GCC/gccrs/commit/ed5d948da920f8de6041b7010625cfeff7014203", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/ed5d948da920f8de6041b7010625cfeff7014203/comments", "author": null, "committer": null, "parents": [{"sha": "1c48bff185df422d6f9f980fd02466606be2ccd4", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/1c48bff185df422d6f9f980fd02466606be2ccd4", "html_url": "https://github.com/Rust-GCC/gccrs/commit/1c48bff185df422d6f9f980fd02466606be2ccd4"}], "stats": {"total": 25, "additions": 20, "deletions": 5}, "files": [{"sha": "59be0fdd68578b138b583e59a07ce98b82327904", "filename": "gcc/ChangeLog", "status": "modified", "additions": 7, "deletions": 0, "changes": 7, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/ed5d948da920f8de6041b7010625cfeff7014203/gcc%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/ed5d948da920f8de6041b7010625cfeff7014203/gcc%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2FChangeLog?ref=ed5d948da920f8de6041b7010625cfeff7014203", "patch": "@@ -1,3 +1,10 @@\n+2016-02-15  Tom de Vries  <tom@codesourcery.com>\n+\n+\tPR lto/69655\n+\t* lto-cgraph.c (input_offload_tables): Add and handle bool parameter\n+\tdo_force_output.\n+\t* lto-streamer.h (input_offload_tables): Add and handle bool parameter.\n+\n 2016-02-15  Richard Biener  <rguenther@suse.de>\n \n \tPR tree-optimization/69776"}, {"sha": "95c446d0696e54c7bd8934e4682cdac4fdcdf0a9", "filename": "gcc/lto-cgraph.c", "status": "modified", "additions": 5, "deletions": 3, "changes": 8, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/ed5d948da920f8de6041b7010625cfeff7014203/gcc%2Flto-cgraph.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/ed5d948da920f8de6041b7010625cfeff7014203/gcc%2Flto-cgraph.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Flto-cgraph.c?ref=ed5d948da920f8de6041b7010625cfeff7014203", "patch": "@@ -1885,7 +1885,7 @@ input_symtab (void)\n    target code, and store them into OFFLOAD_FUNCS and OFFLOAD_VARS.  */\n \n void\n-input_offload_tables (void)\n+input_offload_tables (bool do_force_output)\n {\n   struct lto_file_decl_data **file_data_vec = lto_get_file_decl_data ();\n   struct lto_file_decl_data *file_data;\n@@ -1915,7 +1915,8 @@ input_offload_tables (void)\n \t      /* Prevent IPA from removing fn_decl as unreachable, since there\n \t\t may be no refs from the parent function to child_fn in offload\n \t\t LTO mode.  */\n-\t      cgraph_node::get (fn_decl)->mark_force_output ();\n+\t      if (do_force_output)\n+\t\tcgraph_node::get (fn_decl)->mark_force_output ();\n \t    }\n \t  else if (tag == LTO_symtab_variable)\n \t    {\n@@ -1926,7 +1927,8 @@ input_offload_tables (void)\n \n \t      /* Prevent IPA from removing var_decl as unused, since there\n \t\t may be no refs to var_decl in offload LTO mode.  */\n-\t      varpool_node::get (var_decl)->force_output = 1;\n+\t      if (do_force_output)\n+\t\tvarpool_node::get (var_decl)->force_output = 1;\n \t    }\n \t  else\n \t    fatal_error (input_location,"}, {"sha": "f3911613b074e415feda24c240c12b6a52f981cc", "filename": "gcc/lto-streamer.h", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/ed5d948da920f8de6041b7010625cfeff7014203/gcc%2Flto-streamer.h", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/ed5d948da920f8de6041b7010625cfeff7014203/gcc%2Flto-streamer.h", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Flto-streamer.h?ref=ed5d948da920f8de6041b7010625cfeff7014203", "patch": "@@ -915,7 +915,7 @@ bool lto_symtab_encoder_encode_initializer_p (lto_symtab_encoder_t,\n void output_symtab (void);\n void input_symtab (void);\n void output_offload_tables (void);\n-void input_offload_tables (void);\n+void input_offload_tables (bool);\n bool referenced_from_other_partition_p (struct ipa_ref_list *,\n \t\t\t\t        lto_symtab_encoder_t);\n bool reachable_from_other_partition_p (struct cgraph_node *,"}, {"sha": "6496fd900a798d94158f6913ee6dd537a37f1d43", "filename": "gcc/lto/ChangeLog", "status": "modified", "additions": 6, "deletions": 0, "changes": 6, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/ed5d948da920f8de6041b7010625cfeff7014203/gcc%2Flto%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/ed5d948da920f8de6041b7010625cfeff7014203/gcc%2Flto%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Flto%2FChangeLog?ref=ed5d948da920f8de6041b7010625cfeff7014203", "patch": "@@ -1,3 +1,9 @@\n+2016-02-15  Tom de Vries  <tom@codesourcery.com>\n+\n+\tPR lto/69655\n+\t* lto.c (read_cgraph_and_symbols): Call input_offload_tables with\n+\targument.\n+\n 2016-01-27  Martin Liska  <mliska@suse.cz>\n \n \t* lto-partition.c (add_symbol_to_partition_1): Remove usage"}, {"sha": "9dd513fef8668346dcfa6716ccc8cc649e52ddad", "filename": "gcc/lto/lto.c", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/ed5d948da920f8de6041b7010625cfeff7014203/gcc%2Flto%2Flto.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/ed5d948da920f8de6041b7010625cfeff7014203/gcc%2Flto%2Flto.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Flto%2Flto.c?ref=ed5d948da920f8de6041b7010625cfeff7014203", "patch": "@@ -2855,7 +2855,7 @@ read_cgraph_and_symbols (unsigned nfiles, const char **fnames)\n   /* Read the symtab.  */\n   input_symtab ();\n \n-  input_offload_tables ();\n+  input_offload_tables (!flag_ltrans);\n \n   /* Store resolutions into the symbol table.  */\n "}]}