{"sha": "0f0027d1635c52d0deae174bfc68022dc1217c8b", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6MGYwMDI3ZDE2MzVjNTJkMGRlYWUxNzRiZmM2ODAyMmRjMTIxN2M4Yg==", "commit": {"author": {"name": "Kyrylo Tkachov", "email": "kyrylo.tkachov@arm.com", "date": "2017-09-13T13:49:50Z"}, "committer": {"name": "Kyrylo Tkachov", "email": "ktkachov@gcc.gnu.org", "date": "2017-09-13T13:49:50Z"}, "message": "[store-merging] Use store order as tie-breaker in sort_by_bitpos\n\nAs Alexander pointed out in the thread starting at [1] the sort_by_bitpos sorting function\nwas behaving badly when we had multiple stores at the same position.  He fixed that (thanks!)\nbut we can do better by not returning zero when the bitpositions are equal but by falling back\nto comparing the order the stores appear in, which is guaranteed to be unique (barring other\nbugs elsewhere).\n\nThis patch does that.\n\nBootstrapped and tested on aarch64-none-linux-gnu.\n\n[1] https://gcc.gnu.org/ml/gcc-patches/2017-07/msg00895.html \n\n\t* gimple-ssa-store-merging.c (sort_by_bitpos): Compare store order\n\twhen bitposition is the same.\n\nFrom-SVN: r252084", "tree": {"sha": "13d7fed1d513aede40a8fcde7e9259c7feb77bbf", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/13d7fed1d513aede40a8fcde7e9259c7feb77bbf"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/0f0027d1635c52d0deae174bfc68022dc1217c8b", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/0f0027d1635c52d0deae174bfc68022dc1217c8b", "html_url": "https://github.com/Rust-GCC/gccrs/commit/0f0027d1635c52d0deae174bfc68022dc1217c8b", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/0f0027d1635c52d0deae174bfc68022dc1217c8b/comments", "author": {"login": "ktkachov-arm", "id": 74917949, "node_id": "MDQ6VXNlcjc0OTE3OTQ5", "avatar_url": "https://avatars.githubusercontent.com/u/74917949?v=4", "gravatar_id": "", "url": "https://api.github.com/users/ktkachov-arm", "html_url": "https://github.com/ktkachov-arm", "followers_url": "https://api.github.com/users/ktkachov-arm/followers", "following_url": "https://api.github.com/users/ktkachov-arm/following{/other_user}", "gists_url": "https://api.github.com/users/ktkachov-arm/gists{/gist_id}", "starred_url": "https://api.github.com/users/ktkachov-arm/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/ktkachov-arm/subscriptions", "organizations_url": "https://api.github.com/users/ktkachov-arm/orgs", "repos_url": "https://api.github.com/users/ktkachov-arm/repos", "events_url": "https://api.github.com/users/ktkachov-arm/events{/privacy}", "received_events_url": "https://api.github.com/users/ktkachov-arm/received_events", "type": "User", "site_admin": false}, "committer": null, "parents": [{"sha": "7dbe3736d5fd19de6bb1768e9ca0a610b5e8ee3b", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/7dbe3736d5fd19de6bb1768e9ca0a610b5e8ee3b", "html_url": "https://github.com/Rust-GCC/gccrs/commit/7dbe3736d5fd19de6bb1768e9ca0a610b5e8ee3b"}], "stats": {"total": 9, "additions": 8, "deletions": 1}, "files": [{"sha": "0e0257d9675d9f8468b4a1a8765cbade4642ed1a", "filename": "gcc/ChangeLog", "status": "modified", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/0f0027d1635c52d0deae174bfc68022dc1217c8b/gcc%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/0f0027d1635c52d0deae174bfc68022dc1217c8b/gcc%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2FChangeLog?ref=0f0027d1635c52d0deae174bfc68022dc1217c8b", "patch": "@@ -1,3 +1,8 @@\n+2017-09-13  Kyrylo Tkachov  <kyrylo.tkachov@arm.com>\n+\n+\t* gimple-ssa-store-merging.c (sort_by_bitpos): Compare store order\n+\twhen bitposition is the same.\n+\n 2017-09-13  Richard Biener  <rguenther@suse.de>\n \n \t* dwarf2out.c (output_die_symbol): Remove."}, {"sha": "cb764032205a8233f826178e799a26ee3ae41083", "filename": "gcc/gimple-ssa-store-merging.c", "status": "modified", "additions": 3, "deletions": 1, "changes": 4, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/0f0027d1635c52d0deae174bfc68022dc1217c8b/gcc%2Fgimple-ssa-store-merging.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/0f0027d1635c52d0deae174bfc68022dc1217c8b/gcc%2Fgimple-ssa-store-merging.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fgimple-ssa-store-merging.c?ref=0f0027d1635c52d0deae174bfc68022dc1217c8b", "patch": "@@ -521,7 +521,9 @@ sort_by_bitpos (const void *x, const void *y)\n   else if ((*tmp)->bitpos > (*tmp2)->bitpos)\n     return 1;\n   else\n-    return 0;\n+    /* If they are the same let's use the order which is guaranteed to\n+       be different.  */\n+    return (*tmp)->order - (*tmp2)->order;\n }\n \n /* Sorting function for store_immediate_info objects."}]}