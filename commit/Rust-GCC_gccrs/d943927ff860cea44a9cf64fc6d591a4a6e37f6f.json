{"sha": "d943927ff860cea44a9cf64fc6d591a4a6e37f6f", "node_id": "C_kwDOANBUbNoAKGQ5NDM5MjdmZjg2MGNlYTQ0YTljZjY0ZmM2ZDU5MWE0YTZlMzdmNmY", "commit": {"author": {"name": "Jakub Jelinek", "email": "jakub@redhat.com", "date": "2022-11-09T12:07:32Z"}, "committer": {"name": "Jakub Jelinek", "email": "jakub@redhat.com", "date": "2022-11-09T12:07:32Z"}, "message": "Fix up foperator_abs::op1_range [PR107569]\n\nfoperator_abs::op1_range works except for the NaN handling,\nfrom:\n[frange] double [-Inf, 1.79769313486231570814527423731704356798070567525844996599e+308 (0x0.fffffffffffff8p+1024)]\nlhs it computes r\n[frange] double [-1.79769313486231570814527423731704356798070567525844996599e+308 (-0x0.fffffffffffff8p+1024), 1.79769313486231570814527423731704356798070567525844996599e+308\n+(0x0.fffffffffffff8p+1024)] +-NAN\nwhich is correct except for the +-NAN part.\nFor r before the final step it makes sure to add -NAN if there is +NAN\nin the lhs range, but the final r.union_ makes it unconditional +-NAN,\nbecause the frange ctor sets +-NAN.\nSo, I think we need to clear it (or have some set variant which\nsays not to set NAN).\n\nThis patch fixes that, but isn't enough to fix the PR, something in\nthe assumptions handling is still broken (and the PR has other parts).\n\n2022-11-09  Jakub Jelinek  <jakub@redhat.com>\n\n\tPR tree-optimization/107569\n\t* range-op-float.cc (foperator_abs::op1_range): Clear NaNs\n\tfrom the negatives frange before unioning it into r.", "tree": {"sha": "ad2e8a1cabd47be9eceab84234b6b0ce6be282f3", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/ad2e8a1cabd47be9eceab84234b6b0ce6be282f3"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/d943927ff860cea44a9cf64fc6d591a4a6e37f6f", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/d943927ff860cea44a9cf64fc6d591a4a6e37f6f", "html_url": "https://github.com/Rust-GCC/gccrs/commit/d943927ff860cea44a9cf64fc6d591a4a6e37f6f", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/d943927ff860cea44a9cf64fc6d591a4a6e37f6f/comments", "author": {"login": "jakubjelinek", "id": 9370665, "node_id": "MDQ6VXNlcjkzNzA2NjU=", "avatar_url": "https://avatars.githubusercontent.com/u/9370665?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jakubjelinek", "html_url": "https://github.com/jakubjelinek", "followers_url": "https://api.github.com/users/jakubjelinek/followers", "following_url": "https://api.github.com/users/jakubjelinek/following{/other_user}", "gists_url": "https://api.github.com/users/jakubjelinek/gists{/gist_id}", "starred_url": "https://api.github.com/users/jakubjelinek/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jakubjelinek/subscriptions", "organizations_url": "https://api.github.com/users/jakubjelinek/orgs", "repos_url": "https://api.github.com/users/jakubjelinek/repos", "events_url": "https://api.github.com/users/jakubjelinek/events{/privacy}", "received_events_url": "https://api.github.com/users/jakubjelinek/received_events", "type": "User", "site_admin": false}, "committer": {"login": "jakubjelinek", "id": 9370665, "node_id": "MDQ6VXNlcjkzNzA2NjU=", "avatar_url": "https://avatars.githubusercontent.com/u/9370665?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jakubjelinek", "html_url": "https://github.com/jakubjelinek", "followers_url": "https://api.github.com/users/jakubjelinek/followers", "following_url": "https://api.github.com/users/jakubjelinek/following{/other_user}", "gists_url": "https://api.github.com/users/jakubjelinek/gists{/gist_id}", "starred_url": "https://api.github.com/users/jakubjelinek/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jakubjelinek/subscriptions", "organizations_url": "https://api.github.com/users/jakubjelinek/orgs", "repos_url": "https://api.github.com/users/jakubjelinek/repos", "events_url": "https://api.github.com/users/jakubjelinek/events{/privacy}", "received_events_url": "https://api.github.com/users/jakubjelinek/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "d05a423c1e7b81021a1b6bee93db31a903d87667", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/d05a423c1e7b81021a1b6bee93db31a903d87667", "html_url": "https://github.com/Rust-GCC/gccrs/commit/d05a423c1e7b81021a1b6bee93db31a903d87667"}], "stats": {"total": 7, "additions": 4, "deletions": 3}, "files": [{"sha": "cc806438a19863906e7a8100e2e83fe9ea3f71e3", "filename": "gcc/range-op-float.cc", "status": "modified", "additions": 4, "deletions": 3, "changes": 7, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/d943927ff860cea44a9cf64fc6d591a4a6e37f6f/gcc%2Frange-op-float.cc", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/d943927ff860cea44a9cf64fc6d591a4a6e37f6f/gcc%2Frange-op-float.cc", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Frange-op-float.cc?ref=d943927ff860cea44a9cf64fc6d591a4a6e37f6f", "patch": "@@ -1394,9 +1394,10 @@ foperator_abs::op1_range (frange &r, tree type,\n     return true;\n   // Then add the negative of each pair:\n   // ABS(op1) = [5,20] would yield op1 => [-20,-5][5,20].\n-  r.union_ (frange (type,\n-\t\t    real_value_negate (&positives.upper_bound ()),\n-\t\t    real_value_negate (&positives.lower_bound ())));\n+  frange negatives (type, real_value_negate (&positives.upper_bound ()),\n+\t\t    real_value_negate (&positives.lower_bound ()));\n+  negatives.clear_nan ();\n+  r.union_ (negatives);\n   return true;\n }\n "}]}