{"sha": "602cfc746e9e0447221896a3d93608c6db3a89e5", "node_id": "C_kwDOANBUbNoAKDYwMmNmYzc0NmU5ZTA0NDcyMjE4OTZhM2Q5MzYwOGM2ZGIzYTg5ZTU", "commit": {"author": {"name": "Lin Sinan", "email": "sinan.lin@linux.alibaba.com", "date": "2023-03-05T08:09:50Z"}, "committer": {"name": "Kito Cheng", "email": "kito.cheng@sifive.com", "date": "2023-03-05T08:59:16Z"}, "message": "RISC-V: Allow const0_rtx operand in max/min\n\nOptimize cases that use max[u]/min[u] against a zero constant.\n\nE.g., the case int f(int x) { return x >= 0 ? x : 0; }\nthe current asm output in rv64gc_zba_zbb\n\n li rtmp,0\n max a0,a0,rtmp\n\ncould be optimized into\n\n max a0,a0,zero\n\ngcc/ChangeLog:\n\t* config/riscv/bitmanip.md: allow 0 constant in max/min\n\tpattern.\n\ngcc/testsuite/ChangeLog:\n\t* gcc.target/riscv/zbb-min-max-03.c: New test.", "tree": {"sha": "4dabfecbd076403b5e8c639b06f750a2f1cbb766", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/4dabfecbd076403b5e8c639b06f750a2f1cbb766"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/602cfc746e9e0447221896a3d93608c6db3a89e5", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/602cfc746e9e0447221896a3d93608c6db3a89e5", "html_url": "https://github.com/Rust-GCC/gccrs/commit/602cfc746e9e0447221896a3d93608c6db3a89e5", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/602cfc746e9e0447221896a3d93608c6db3a89e5/comments", "author": {"login": "linsinan1995", "id": 47880367, "node_id": "MDQ6VXNlcjQ3ODgwMzY3", "avatar_url": "https://avatars.githubusercontent.com/u/47880367?v=4", "gravatar_id": "", "url": "https://api.github.com/users/linsinan1995", "html_url": "https://github.com/linsinan1995", "followers_url": "https://api.github.com/users/linsinan1995/followers", "following_url": "https://api.github.com/users/linsinan1995/following{/other_user}", "gists_url": "https://api.github.com/users/linsinan1995/gists{/gist_id}", "starred_url": "https://api.github.com/users/linsinan1995/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/linsinan1995/subscriptions", "organizations_url": "https://api.github.com/users/linsinan1995/orgs", "repos_url": "https://api.github.com/users/linsinan1995/repos", "events_url": "https://api.github.com/users/linsinan1995/events{/privacy}", "received_events_url": "https://api.github.com/users/linsinan1995/received_events", "type": "User", "site_admin": false}, "committer": {"login": "kito-cheng", "id": 2723185, "node_id": "MDQ6VXNlcjI3MjMxODU=", "avatar_url": "https://avatars.githubusercontent.com/u/2723185?v=4", "gravatar_id": "", "url": "https://api.github.com/users/kito-cheng", "html_url": "https://github.com/kito-cheng", "followers_url": "https://api.github.com/users/kito-cheng/followers", "following_url": "https://api.github.com/users/kito-cheng/following{/other_user}", "gists_url": "https://api.github.com/users/kito-cheng/gists{/gist_id}", "starred_url": "https://api.github.com/users/kito-cheng/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/kito-cheng/subscriptions", "organizations_url": "https://api.github.com/users/kito-cheng/orgs", "repos_url": "https://api.github.com/users/kito-cheng/repos", "events_url": "https://api.github.com/users/kito-cheng/events{/privacy}", "received_events_url": "https://api.github.com/users/kito-cheng/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "9debb240a4b1a711c0648fd9e4385dbde5ad45fd", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/9debb240a4b1a711c0648fd9e4385dbde5ad45fd", "html_url": "https://github.com/Rust-GCC/gccrs/commit/9debb240a4b1a711c0648fd9e4385dbde5ad45fd"}], "stats": {"total": 14, "additions": 12, "deletions": 2}, "files": [{"sha": "cfdb9eb4689b6902779791a91ff38180cdee5185", "filename": "gcc/config/riscv/bitmanip.md", "status": "modified", "additions": 2, "deletions": 2, "changes": 4, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/602cfc746e9e0447221896a3d93608c6db3a89e5/gcc%2Fconfig%2Friscv%2Fbitmanip.md", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/602cfc746e9e0447221896a3d93608c6db3a89e5/gcc%2Fconfig%2Friscv%2Fbitmanip.md", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fconfig%2Friscv%2Fbitmanip.md?ref=602cfc746e9e0447221896a3d93608c6db3a89e5", "patch": "@@ -363,9 +363,9 @@\n (define_insn \"<bitmanip_optab><mode>3\"\n   [(set (match_operand:X 0 \"register_operand\" \"=r\")\n         (bitmanip_minmax:X (match_operand:X 1 \"register_operand\" \"r\")\n-\t\t\t   (match_operand:X 2 \"register_operand\" \"r\")))]\n+\t\t\t   (match_operand:X 2 \"reg_or_0_operand\" \"rJ\")))]\n   \"TARGET_ZBB\"\n-  \"<bitmanip_insn>\\t%0,%1,%2\"\n+  \"<bitmanip_insn>\\t%0,%1,%z2\"\n   [(set_attr \"type\" \"bitmanip\")])\n \n ;; Optimize the common case of a SImode min/max against a constant"}, {"sha": "c7de1004048920a4ebedc10212f3fa20c189ce6b", "filename": "gcc/testsuite/gcc.target/riscv/zbb-min-max-03.c", "status": "added", "additions": 10, "deletions": 0, "changes": 10, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/602cfc746e9e0447221896a3d93608c6db3a89e5/gcc%2Ftestsuite%2Fgcc.target%2Friscv%2Fzbb-min-max-03.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/602cfc746e9e0447221896a3d93608c6db3a89e5/gcc%2Ftestsuite%2Fgcc.target%2Friscv%2Fzbb-min-max-03.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgcc.target%2Friscv%2Fzbb-min-max-03.c?ref=602cfc746e9e0447221896a3d93608c6db3a89e5", "patch": "@@ -0,0 +1,10 @@\n+/* { dg-do compile } */\n+/* { dg-options \"-march=rv64gc_zba_zbb -mabi=lp64d\" } */\n+/* { dg-skip-if \"\" { *-*-* } { \"-O0\" } } */\n+\n+int f(int x) {\n+ return x >= 0 ? x : 0;\n+}\n+\n+/* { dg-final { scan-assembler-times \"max\\t\" 1 } } */\n+/* { dg-final { scan-assembler-not \"li\\t\" } } */"}]}