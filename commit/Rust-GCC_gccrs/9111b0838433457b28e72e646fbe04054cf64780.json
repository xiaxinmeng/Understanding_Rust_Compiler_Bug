{"sha": "9111b0838433457b28e72e646fbe04054cf64780", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6OTExMWIwODM4NDMzNDU3YjI4ZTcyZTY0NmZiZTA0MDU0Y2Y2NDc4MA==", "commit": {"author": {"name": "Jonathan Wakely", "email": "jwakely@redhat.com", "date": "2018-08-29T10:05:55Z"}, "committer": {"name": "Jonathan Wakely", "email": "redi@gcc.gnu.org", "date": "2018-08-29T10:05:55Z"}, "message": "PR libstdc++/31413 fix test failure on Debian systems\n\nDebian uses a different D_FMT string for the zh_TW.UTF-8 locale, which\ncaused this test to fail. Try to detect the Debian format and adjust\nthe input being tested.\n\n\tPR libstdc++/31413\n\t* testsuite/22_locale/time_get/get_date/wchar_t/4.cc: Check D_FMT\n\tstring for alternative format.\n\nFrom-SVN: r263948", "tree": {"sha": "08c6566ab2bbc235a191fc2ba0d3d53fbc6f57b5", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/08c6566ab2bbc235a191fc2ba0d3d53fbc6f57b5"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/9111b0838433457b28e72e646fbe04054cf64780", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/9111b0838433457b28e72e646fbe04054cf64780", "html_url": "https://github.com/Rust-GCC/gccrs/commit/9111b0838433457b28e72e646fbe04054cf64780", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/9111b0838433457b28e72e646fbe04054cf64780/comments", "author": {"login": "jwakely", "id": 1254480, "node_id": "MDQ6VXNlcjEyNTQ0ODA=", "avatar_url": "https://avatars.githubusercontent.com/u/1254480?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jwakely", "html_url": "https://github.com/jwakely", "followers_url": "https://api.github.com/users/jwakely/followers", "following_url": "https://api.github.com/users/jwakely/following{/other_user}", "gists_url": "https://api.github.com/users/jwakely/gists{/gist_id}", "starred_url": "https://api.github.com/users/jwakely/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jwakely/subscriptions", "organizations_url": "https://api.github.com/users/jwakely/orgs", "repos_url": "https://api.github.com/users/jwakely/repos", "events_url": "https://api.github.com/users/jwakely/events{/privacy}", "received_events_url": "https://api.github.com/users/jwakely/received_events", "type": "User", "site_admin": false}, "committer": {"login": "jwakely", "id": 1254480, "node_id": "MDQ6VXNlcjEyNTQ0ODA=", "avatar_url": "https://avatars.githubusercontent.com/u/1254480?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jwakely", "html_url": "https://github.com/jwakely", "followers_url": "https://api.github.com/users/jwakely/followers", "following_url": "https://api.github.com/users/jwakely/following{/other_user}", "gists_url": "https://api.github.com/users/jwakely/gists{/gist_id}", "starred_url": "https://api.github.com/users/jwakely/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jwakely/subscriptions", "organizations_url": "https://api.github.com/users/jwakely/orgs", "repos_url": "https://api.github.com/users/jwakely/repos", "events_url": "https://api.github.com/users/jwakely/events{/privacy}", "received_events_url": "https://api.github.com/users/jwakely/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "fb9cb5369dff9afae40dec2224e485625c425a67", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/fb9cb5369dff9afae40dec2224e485625c425a67", "html_url": "https://github.com/Rust-GCC/gccrs/commit/fb9cb5369dff9afae40dec2224e485625c425a67"}], "stats": {"total": 30, "additions": 29, "deletions": 1}, "files": [{"sha": "477784624b61441e0477cde1a3a87cb98c8dfddf", "filename": "libstdc++-v3/ChangeLog", "status": "modified", "additions": 6, "deletions": 0, "changes": 6, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/9111b0838433457b28e72e646fbe04054cf64780/libstdc%2B%2B-v3%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/9111b0838433457b28e72e646fbe04054cf64780/libstdc%2B%2B-v3%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libstdc%2B%2B-v3%2FChangeLog?ref=9111b0838433457b28e72e646fbe04054cf64780", "patch": "@@ -1,3 +1,9 @@\n+2018-08-29  Jonathan Wakely  <jwakely@redhat.com>\n+\n+\tPR libstdc++/31413\n+\t* testsuite/22_locale/time_get/get_date/wchar_t/4.cc: Check D_FMT\n+\tstring for alternative format.\n+\n 2018-08-28  Jonathan Wakely  <jwakely@redhat.com>\n \n \tPR libstdc++/87116"}, {"sha": "a532c93d4a14c793f7ede8a3d67c5b1a4ced0110", "filename": "libstdc++-v3/testsuite/22_locale/time_get/get_date/wchar_t/4.cc", "status": "modified", "additions": 23, "deletions": 1, "changes": 24, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/9111b0838433457b28e72e646fbe04054cf64780/libstdc%2B%2B-v3%2Ftestsuite%2F22_locale%2Ftime_get%2Fget_date%2Fwchar_t%2F4.cc", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/9111b0838433457b28e72e646fbe04054cf64780/libstdc%2B%2B-v3%2Ftestsuite%2F22_locale%2Ftime_get%2Fget_date%2Fwchar_t%2F4.cc", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libstdc%2B%2B-v3%2Ftestsuite%2F22_locale%2Ftime_get%2Fget_date%2Fwchar_t%2F4.cc?ref=9111b0838433457b28e72e646fbe04054cf64780", "patch": "@@ -25,6 +25,8 @@\n #include <sstream>\n #include <testsuite_hooks.h>\n \n+static bool debian_date_format();\n+\n void test01()\n {\n   using namespace std;\n@@ -46,7 +48,7 @@ void test01()\n \t\t\t   0x5e74, L'1', L'2', 0x6708, L'1', L'7',\n \t\t\t   0x65e5 , 0x0 };\n \n-  iss.str(wstr);\n+  iss.str(debian_date_format() ? wstr+2 : wstr);\n   iterator_type is_it01(iss);\n   tm time01;\n   tim_get.get_date(is_it01, end, iss, errorstate, &time01);\n@@ -56,6 +58,26 @@ void test01()\n   VERIFY( time01.tm_year == 103 );\n }\n \n+#include <locale.h>\n+#if __has_include(<langinfo.h>)\n+# include <langinfo.h>\n+#endif\n+\n+static bool debian_date_format()\n+{\n+#ifdef D_FMT\n+  if (setlocale(LC_TIME, \"zh_TW.UTF-8\") != NULL)\n+  {\n+    // See https://gcc.gnu.org/bugzilla/show_bug.cgi?id=31413\n+    // and https://gcc.gnu.org/bugzilla/show_bug.cgi?id=71641#c2\n+    if (*nl_langinfo(D_FMT) == '%')\n+      return true;\n+    setlocale(LC_TIME, \"C\");\n+  }\n+#endif\n+  return false;\n+}\n+\n int main()\n {\n   test01();"}]}