{"sha": "da157e2ee9e12348df78246ee33b244b7cc334df", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6ZGExNTdlMmVlOWUxMjM0OGRmNzgyNDZlZTMzYjI0NGI3Y2MzMzRkZg==", "commit": {"author": {"name": "Richard Sandiford", "email": "richard.sandiford@arm.com", "date": "2019-10-21T06:40:36Z"}, "committer": {"name": "Richard Sandiford", "email": "rsandifo@gcc.gnu.org", "date": "2019-10-21T06:40:36Z"}, "message": "Avoid setting current_vector_size in get_vec_alignment_for_array_type\n\nThe increase_alignment pass was using get_vectype_for_scalar_type\nto get the preferred vector type for each array element type.\nThis has the effect of carrying over the vector size chosen by\nthe first successful call to all subsequent calls, whereas it seems\nmore natural to treat each array type independently and pick the\n\"best\" vector type for each element type.\n\n2019-10-21  Richard Sandiford  <richard.sandiford@arm.com>\n\ngcc/\n\t* tree-vectorizer.c (get_vec_alignment_for_array_type): Use\n\tget_vectype_for_scalar_type_and_size instead of\n\tget_vectype_for_scalar_type.\n\nFrom-SVN: r277223", "tree": {"sha": "d082adc3becb58d53fcfa1683ccb991a353b9bd3", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/d082adc3becb58d53fcfa1683ccb991a353b9bd3"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/da157e2ee9e12348df78246ee33b244b7cc334df", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/da157e2ee9e12348df78246ee33b244b7cc334df", "html_url": "https://github.com/Rust-GCC/gccrs/commit/da157e2ee9e12348df78246ee33b244b7cc334df", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/da157e2ee9e12348df78246ee33b244b7cc334df/comments", "author": {"login": "rsandifo-arm", "id": 28043039, "node_id": "MDQ6VXNlcjI4MDQzMDM5", "avatar_url": "https://avatars.githubusercontent.com/u/28043039?v=4", "gravatar_id": "", "url": "https://api.github.com/users/rsandifo-arm", "html_url": "https://github.com/rsandifo-arm", "followers_url": "https://api.github.com/users/rsandifo-arm/followers", "following_url": "https://api.github.com/users/rsandifo-arm/following{/other_user}", "gists_url": "https://api.github.com/users/rsandifo-arm/gists{/gist_id}", "starred_url": "https://api.github.com/users/rsandifo-arm/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/rsandifo-arm/subscriptions", "organizations_url": "https://api.github.com/users/rsandifo-arm/orgs", "repos_url": "https://api.github.com/users/rsandifo-arm/repos", "events_url": "https://api.github.com/users/rsandifo-arm/events{/privacy}", "received_events_url": "https://api.github.com/users/rsandifo-arm/received_events", "type": "User", "site_admin": false}, "committer": null, "parents": [{"sha": "5bf2f16265fdc120bc2aff12729c831f93fad7a1", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/5bf2f16265fdc120bc2aff12729c831f93fad7a1", "html_url": "https://github.com/Rust-GCC/gccrs/commit/5bf2f16265fdc120bc2aff12729c831f93fad7a1"}], "stats": {"total": 9, "additions": 8, "deletions": 1}, "files": [{"sha": "4460d1e9e9da909e304986e66ffde0b25e84eacf", "filename": "gcc/ChangeLog", "status": "modified", "additions": 6, "deletions": 0, "changes": 6, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/da157e2ee9e12348df78246ee33b244b7cc334df/gcc%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/da157e2ee9e12348df78246ee33b244b7cc334df/gcc%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2FChangeLog?ref=da157e2ee9e12348df78246ee33b244b7cc334df", "patch": "@@ -1,3 +1,9 @@\n+2019-10-21  Richard Sandiford  <richard.sandiford@arm.com>\n+\n+\t* tree-vectorizer.c (get_vec_alignment_for_array_type): Use\n+\tget_vectype_for_scalar_type_and_size instead of\n+\tget_vectype_for_scalar_type.\n+\n 2019-10-20  Bernd Edlinger  <bernd.edlinger@hotmail.de>\n \n \t* common.opt (-fcommon): Fix description."}, {"sha": "0c0c018fd8eda28fd0589be76b72d0f675666709", "filename": "gcc/tree-vectorizer.c", "status": "modified", "additions": 2, "deletions": 1, "changes": 3, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/da157e2ee9e12348df78246ee33b244b7cc334df/gcc%2Ftree-vectorizer.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/da157e2ee9e12348df78246ee33b244b7cc334df/gcc%2Ftree-vectorizer.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftree-vectorizer.c?ref=da157e2ee9e12348df78246ee33b244b7cc334df", "patch": "@@ -1347,7 +1347,8 @@ get_vec_alignment_for_array_type (tree type)\n   gcc_assert (TREE_CODE (type) == ARRAY_TYPE);\n   poly_uint64 array_size, vector_size;\n \n-  tree vectype = get_vectype_for_scalar_type (strip_array_types (type));\n+  tree scalar_type = strip_array_types (type);\n+  tree vectype = get_vectype_for_scalar_type_and_size (scalar_type, 0);\n   if (!vectype\n       || !poly_int_tree_p (TYPE_SIZE (type), &array_size)\n       || !poly_int_tree_p (TYPE_SIZE (vectype), &vector_size)"}]}