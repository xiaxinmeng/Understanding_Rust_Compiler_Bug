{"sha": "26ed270e0fa48c1205256c1a4409a009ff6aa40f", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6MjZlZDI3MGUwZmE0OGMxMjA1MjU2YzFhNDQwOWEwMDlmZjZhYTQwZg==", "commit": {"author": {"name": "Eric Botcazou", "email": "ebotcazou@adacore.com", "date": "2014-11-25T09:07:25Z"}, "committer": {"name": "Eric Botcazou", "email": "ebotcazou@gcc.gnu.org", "date": "2014-11-25T09:07:25Z"}, "message": "rs6000.c (rs6000_call_aix): For the AIX ABI, do not load the static chain if the call was originally direct.\n\n\t* config/rs6000/rs6000.c (rs6000_call_aix): For the AIX ABI, do not\n\tload the static chain if the call was originally direct.\n\nFrom-SVN: r218040", "tree": {"sha": "6fca5efbac99f4cdc951686440646b60961d2b43", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/6fca5efbac99f4cdc951686440646b60961d2b43"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/26ed270e0fa48c1205256c1a4409a009ff6aa40f", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/26ed270e0fa48c1205256c1a4409a009ff6aa40f", "html_url": "https://github.com/Rust-GCC/gccrs/commit/26ed270e0fa48c1205256c1a4409a009ff6aa40f", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/26ed270e0fa48c1205256c1a4409a009ff6aa40f/comments", "author": null, "committer": null, "parents": [{"sha": "b286be940a8231b35ed111f6044b2bf7da471d07", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/b286be940a8231b35ed111f6044b2bf7da471d07", "html_url": "https://github.com/Rust-GCC/gccrs/commit/b286be940a8231b35ed111f6044b2bf7da471d07"}], "stats": {"total": 50, "additions": 48, "deletions": 2}, "files": [{"sha": "bed7cb86ed3d370fc8d391986020551210e29c12", "filename": "gcc/ChangeLog", "status": "modified", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/26ed270e0fa48c1205256c1a4409a009ff6aa40f/gcc%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/26ed270e0fa48c1205256c1a4409a009ff6aa40f/gcc%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2FChangeLog?ref=26ed270e0fa48c1205256c1a4409a009ff6aa40f", "patch": "@@ -1,3 +1,8 @@\n+2014-11-25  Eric Botcazou  <ebotcazou@adacore.com>\n+\n+\t* config/rs6000/rs6000.c (rs6000_call_aix): For the AIX ABI, do not\n+\tload the static chain if the call was originally direct.\n+\n 2014-11-25  Jan Hubicka  <hubicka@ucw.cz>\n \n \tPR ipa/64059"}, {"sha": "6873c77af7cbd588773e1122814e9eb554e50543", "filename": "gcc/config/rs6000/rs6000.c", "status": "modified", "additions": 7, "deletions": 2, "changes": 9, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/26ed270e0fa48c1205256c1a4409a009ff6aa40f/gcc%2Fconfig%2Frs6000%2Frs6000.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/26ed270e0fa48c1205256c1a4409a009ff6aa40f/gcc%2Fconfig%2Frs6000%2Frs6000.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fconfig%2Frs6000%2Frs6000.c?ref=26ed270e0fa48c1205256c1a4409a009ff6aa40f", "patch": "@@ -32853,6 +32853,8 @@ rs6000_legitimate_constant_p (machine_mode mode, rtx x)\n void\n rs6000_call_aix (rtx value, rtx func_desc, rtx flag, rtx cookie)\n {\n+  const bool direct_call_p\n+    = GET_CODE (func_desc) == SYMBOL_REF && SYMBOL_REF_FUNCTION_P (func_desc);\n   rtx toc_reg = gen_rtx_REG (Pmode, TOC_REGNUM);\n   rtx toc_load = NULL_RTX;\n   rtx toc_restore = NULL_RTX;\n@@ -32921,8 +32923,11 @@ rs6000_call_aix (rtx value, rtx func_desc, rtx flag, rtx cookie)\n \t\t\t\t\t\t\tfunc_toc_offset));\n \t  toc_load = gen_rtx_USE (VOIDmode, func_toc_mem);\n \n-\t  /* If we have a static chain, load it up.  */\n-\t  if (TARGET_POINTERS_TO_NESTED_FUNCTIONS)\n+\t  /* If we have a static chain, load it up.  But, if the call was\n+\t     originally direct, the 3rd word has not been written since no\n+\t     trampoline has been built, so we ought not to load it, lest we\n+\t     override a static chain value.  */\n+\t  if (!direct_call_p && TARGET_POINTERS_TO_NESTED_FUNCTIONS)\n \t    {\n \t      rtx sc_reg = gen_rtx_REG (Pmode, STATIC_CHAIN_REGNUM);\n \t      rtx func_sc_offset = GEN_INT (2 * GET_MODE_SIZE (Pmode));"}, {"sha": "6f96bfb6b92563ca45ce9043b368aefc96b6a5e8", "filename": "gcc/testsuite/ChangeLog", "status": "modified", "additions": 4, "deletions": 0, "changes": 4, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/26ed270e0fa48c1205256c1a4409a009ff6aa40f/gcc%2Ftestsuite%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/26ed270e0fa48c1205256c1a4409a009ff6aa40f/gcc%2Ftestsuite%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2FChangeLog?ref=26ed270e0fa48c1205256c1a4409a009ff6aa40f", "patch": "@@ -1,3 +1,7 @@\n+2014-10-25  Eric Botcazou  <ebotcazou@adacore.com>\n+\n+\t* gcc.target/powerpc/longcall-2.c: New test.\n+\n 2014-11-25  Marek Polacek  <polacek@redhat.com>\n \n \tPR c/63877"}, {"sha": "fc73cee3fb499864f7cbefefa59e60d9a81fcb09", "filename": "gcc/testsuite/gcc.target/powerpc/longcall-2.c", "status": "added", "additions": 32, "deletions": 0, "changes": 32, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/26ed270e0fa48c1205256c1a4409a009ff6aa40f/gcc%2Ftestsuite%2Fgcc.target%2Fpowerpc%2Flongcall-2.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/26ed270e0fa48c1205256c1a4409a009ff6aa40f/gcc%2Ftestsuite%2Fgcc.target%2Fpowerpc%2Flongcall-2.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgcc.target%2Fpowerpc%2Flongcall-2.c?ref=26ed270e0fa48c1205256c1a4409a009ff6aa40f", "patch": "@@ -0,0 +1,32 @@\n+/* { dg-do run } */\n+/* { dg-options \"-mlongcall\" } */\n+\n+extern void abort (void);\n+\n+#define VAL 12345678\n+\n+int j = VAL;\n+\n+void\n+bar (void)\n+{\n+  if (j != VAL)\n+    abort ();\n+}\n+\n+int\n+main (void)\n+{\n+  int i = VAL;\n+\n+  int foo (void)\n+  {\n+    if (i != VAL)\n+      abort ();\n+  }\n+\n+  foo ();\n+  bar ();\n+\n+  return 0;\n+}"}]}