{"sha": "b6872a13898d89eb0d52a2d306ae754d677b7819", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6YjY4NzJhMTM4OThkODllYjBkNTJhMmQzMDZhZTc1NGQ2NzdiNzgxOQ==", "commit": {"author": {"name": "Alan Modra", "email": "amodra@gmail.com", "date": "2013-09-09T23:40:34Z"}, "committer": {"name": "Alan Modra", "email": "amodra@gcc.gnu.org", "date": "2013-09-09T23:40:34Z"}, "message": "predicates.md (add_cint_operand): New.\n\ngcc/\n\t* config/rs6000/predicates.md (add_cint_operand): New.\n\t(reg_or_add_cint_operand, small_toc_ref): Use add_cint_operand.\n\t* config/rs6000/rs6000.md (largetoc_high_plus): Restrict offset\n\tusing add_cint_operand.\n\t(largetoc_high_plus_aix): Likewise.\ngcc/testsuite/\n\t* gcc.target/powerpc/medium_offset.c: New.\n\nFrom-SVN: r202417", "tree": {"sha": "ae6cc003997d65562a22922705a5239896f8ec90", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/ae6cc003997d65562a22922705a5239896f8ec90"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/b6872a13898d89eb0d52a2d306ae754d677b7819", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/b6872a13898d89eb0d52a2d306ae754d677b7819", "html_url": "https://github.com/Rust-GCC/gccrs/commit/b6872a13898d89eb0d52a2d306ae754d677b7819", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/b6872a13898d89eb0d52a2d306ae754d677b7819/comments", "author": {"login": "amodra", "id": 6006325, "node_id": "MDQ6VXNlcjYwMDYzMjU=", "avatar_url": "https://avatars.githubusercontent.com/u/6006325?v=4", "gravatar_id": "", "url": "https://api.github.com/users/amodra", "html_url": "https://github.com/amodra", "followers_url": "https://api.github.com/users/amodra/followers", "following_url": "https://api.github.com/users/amodra/following{/other_user}", "gists_url": "https://api.github.com/users/amodra/gists{/gist_id}", "starred_url": "https://api.github.com/users/amodra/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/amodra/subscriptions", "organizations_url": "https://api.github.com/users/amodra/orgs", "repos_url": "https://api.github.com/users/amodra/repos", "events_url": "https://api.github.com/users/amodra/events{/privacy}", "received_events_url": "https://api.github.com/users/amodra/received_events", "type": "User", "site_admin": false}, "committer": null, "parents": [{"sha": "904e9dbbabdd2184894afbf63edcf6b6a4544055", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/904e9dbbabdd2184894afbf63edcf6b6a4544055", "html_url": "https://github.com/Rust-GCC/gccrs/commit/904e9dbbabdd2184894afbf63edcf6b6a4544055"}], "stats": {"total": 40, "additions": 35, "deletions": 5}, "files": [{"sha": "42d1dc7249cb6f7a38ce1b2c9150eb6d8523c4a5", "filename": "gcc/ChangeLog", "status": "modified", "additions": 8, "deletions": 0, "changes": 8, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/b6872a13898d89eb0d52a2d306ae754d677b7819/gcc%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/b6872a13898d89eb0d52a2d306ae754d677b7819/gcc%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2FChangeLog?ref=b6872a13898d89eb0d52a2d306ae754d677b7819", "patch": "@@ -1,3 +1,11 @@\n+2013-09-10  Alan Modra  <amodra@gmail.com>\n+\n+\t* config/rs6000/predicates.md (add_cint_operand): New.\n+\t(reg_or_add_cint_operand, small_toc_ref): Use add_cint_operand.\n+\t* config/rs6000/rs6000.md (largetoc_high_plus): Restrict offset\n+\tusing add_cint_operand.\n+\t(largetoc_high_plus_aix): Likewise.\n+\n 2013-09-09  Jakub Jelinek  <jakub@redhat.com>\n \n \tPR tree-optimization/58364"}, {"sha": "b5bff04477911819aadfed8431ec113c30cf081b", "filename": "gcc/config/rs6000/predicates.md", "status": "modified", "additions": 9, "deletions": 3, "changes": 12, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/b6872a13898d89eb0d52a2d306ae754d677b7819/gcc%2Fconfig%2Frs6000%2Fpredicates.md", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/b6872a13898d89eb0d52a2d306ae754d677b7819/gcc%2Fconfig%2Frs6000%2Fpredicates.md", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fconfig%2Frs6000%2Fpredicates.md?ref=b6872a13898d89eb0d52a2d306ae754d677b7819", "patch": "@@ -376,12 +376,18 @@\n   (ior (match_code \"const_int\")\n        (match_operand 0 \"gpc_reg_operand\")))\n \n+;; Return 1 if op is a constant integer valid for addition with addis, addi.\n+(define_predicate \"add_cint_operand\"\n+  (and (match_code \"const_int\")\n+       (match_test \"(unsigned HOST_WIDE_INT)\n+\t\t      (INTVAL (op) + (mode == SImode ? 0x80000000 : 0x80008000))\n+\t\t    < (unsigned HOST_WIDE_INT) 0x100000000ll\")))\n+\n ;; Return 1 if op is a constant integer valid for addition\n ;; or non-special register.\n (define_predicate \"reg_or_add_cint_operand\"\n   (if_then_else (match_code \"const_int\")\n-    (match_test \"(unsigned HOST_WIDE_INT) (INTVAL (op) + 0x80008000)\n-\t\t < (unsigned HOST_WIDE_INT) 0x100000000ll\")\n+    (match_operand 0 \"add_cint_operand\")\n     (match_operand 0 \"gpc_reg_operand\")))\n \n ;; Return 1 if op is a constant integer valid for subtraction\n@@ -1697,7 +1703,7 @@\n (define_predicate \"small_toc_ref\"\n   (match_code \"unspec,plus\")\n {\n-  if (GET_CODE (op) == PLUS && CONST_INT_P (XEXP (op, 1)))\n+  if (GET_CODE (op) == PLUS && add_cint_operand (XEXP (op, 1), mode))\n     op = XEXP (op, 0);\n \n   return GET_CODE (op) == UNSPEC && XINT (op, 1) == UNSPEC_TOCREL;"}, {"sha": "0757d4de5ad564f490056c11932dd637284b49dc", "filename": "gcc/config/rs6000/rs6000.md", "status": "modified", "additions": 2, "deletions": 2, "changes": 4, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/b6872a13898d89eb0d52a2d306ae754d677b7819/gcc%2Fconfig%2Frs6000%2Frs6000.md", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/b6872a13898d89eb0d52a2d306ae754d677b7819/gcc%2Fconfig%2Frs6000%2Frs6000.md", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fconfig%2Frs6000%2Frs6000.md?ref=b6872a13898d89eb0d52a2d306ae754d677b7819", "patch": "@@ -12207,7 +12207,7 @@\n \t    (unspec [(match_operand:DI 1 \"\" \"\")\n \t\t     (match_operand:DI 2 \"gpc_reg_operand\" \"b\")]\n \t\t    UNSPEC_TOCREL)\n-\t    (match_operand 3 \"const_int_operand\" \"n\"))))]\n+\t    (match_operand:DI 3 \"add_cint_operand\" \"n\"))))]\n    \"TARGET_ELF && TARGET_CMODEL != CMODEL_SMALL\"\n    \"addis %0,%2,%1+%3@toc@ha\")\n \n@@ -12218,7 +12218,7 @@\n \t    (unspec [(match_operand:P 1 \"\" \"\")\n \t\t     (match_operand:P 2 \"gpc_reg_operand\" \"b\")]\n \t\t    UNSPEC_TOCREL)\n-\t    (match_operand 3 \"const_int_operand\" \"n\"))))]\n+\t    (match_operand:P 3 \"add_cint_operand\" \"n\"))))]\n    \"TARGET_XCOFF && TARGET_CMODEL != CMODEL_SMALL\"\n    \"addis %0,%1+%3@u(%2)\")\n "}, {"sha": "61d1469f1a8e970a2b5b823dbd5514d41b189b42", "filename": "gcc/testsuite/ChangeLog", "status": "modified", "additions": 4, "deletions": 0, "changes": 4, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/b6872a13898d89eb0d52a2d306ae754d677b7819/gcc%2Ftestsuite%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/b6872a13898d89eb0d52a2d306ae754d677b7819/gcc%2Ftestsuite%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2FChangeLog?ref=b6872a13898d89eb0d52a2d306ae754d677b7819", "patch": "@@ -1,3 +1,7 @@\n+2013-09-10  Alan Modra  <amodra@gmail.com>\n+\n+\t* gcc.target/powerpc/medium_offset.c: New.\n+\n 2013-09-09  Jakub Jelinek  <jakub@redhat.com>\n \n \tPR c++/58325"}, {"sha": "f29eba08c3837ca751660acd1a6634e35059b4a2", "filename": "gcc/testsuite/gcc.target/powerpc/medium_offset.c", "status": "added", "additions": 12, "deletions": 0, "changes": 12, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/b6872a13898d89eb0d52a2d306ae754d677b7819/gcc%2Ftestsuite%2Fgcc.target%2Fpowerpc%2Fmedium_offset.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/b6872a13898d89eb0d52a2d306ae754d677b7819/gcc%2Ftestsuite%2Fgcc.target%2Fpowerpc%2Fmedium_offset.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgcc.target%2Fpowerpc%2Fmedium_offset.c?ref=b6872a13898d89eb0d52a2d306ae754d677b7819", "patch": "@@ -0,0 +1,12 @@\n+/* { dg-do compile { target { powerpc*-*-* } } } */\n+/* { dg-require-effective-target lp64 } */\n+/* { dg-options \"-O\" } */\n+/* { dg-final { scan-assembler-not \"\\\\+4611686018427387904\" } } */\n+\n+static int x;\n+\n+unsigned long\n+foo (void)\n+{\n+  return ((unsigned long) &x) - 0xc000000000000000;\n+}"}]}