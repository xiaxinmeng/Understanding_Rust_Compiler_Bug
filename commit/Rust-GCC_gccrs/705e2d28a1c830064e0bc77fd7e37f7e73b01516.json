{"sha": "705e2d28a1c830064e0bc77fd7e37f7e73b01516", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6NzA1ZTJkMjhhMWM4MzAwNjRlMGJjNzdmZDdlMzdmN2U3M2IwMTUxNg==", "commit": {"author": {"name": "Tom Tromey", "email": "tromey@redhat.com", "date": "2007-01-04T15:32:26Z"}, "committer": {"name": "Tom Tromey", "email": "tromey@gcc.gnu.org", "date": "2007-01-04T15:32:26Z"}, "message": "re PR preprocessor/28165 (_Pragma GCC system_header broken)\n\nlibcpp\n\tPR preprocessor/28165:\n\t* internal.h (cpp_in_primary_file): New function.\n\t* directives.c (do_include_next): Use cpp_in_primary_file.\n\t(do_pragma_once): Likewise.\n\t(do_pragma_system_header): Likewise.\ngcc/testsuite\n\tPR preprocessor/28165:\n\t* gcc.dg/cpp/pr28165.c: New file.\n\nFrom-SVN: r120441", "tree": {"sha": "b221eae7c64169c5383839dda76552523ac6432e", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/b221eae7c64169c5383839dda76552523ac6432e"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/705e2d28a1c830064e0bc77fd7e37f7e73b01516", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/705e2d28a1c830064e0bc77fd7e37f7e73b01516", "html_url": "https://github.com/Rust-GCC/gccrs/commit/705e2d28a1c830064e0bc77fd7e37f7e73b01516", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/705e2d28a1c830064e0bc77fd7e37f7e73b01516/comments", "author": null, "committer": null, "parents": [{"sha": "79e6eaeb8f4c9f54c97425ec9c103378691a7099", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/79e6eaeb8f4c9f54c97425ec9c103378691a7099", "html_url": "https://github.com/Rust-GCC/gccrs/commit/79e6eaeb8f4c9f54c97425ec9c103378691a7099"}], "stats": {"total": 39, "additions": 32, "deletions": 7}, "files": [{"sha": "0663f79bb8e5fb8a9517e57eb542c62ec0fad1f9", "filename": "gcc/testsuite/ChangeLog", "status": "modified", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/705e2d28a1c830064e0bc77fd7e37f7e73b01516/gcc%2Ftestsuite%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/705e2d28a1c830064e0bc77fd7e37f7e73b01516/gcc%2Ftestsuite%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2FChangeLog?ref=705e2d28a1c830064e0bc77fd7e37f7e73b01516", "patch": "@@ -1,3 +1,8 @@\n+2007-01-04  Tom Tromey  <tromey@redhat.com>\n+\n+\tPR preprocessor/28165:\n+\t* gcc.dg/cpp/pr28165.c: New file.\n+\n 2007-01-03  Josh Conner  <jconner@apple.com>\n \n \tPR middle-end/29683"}, {"sha": "71c7c1dba46278c8c6b04cd4d0186aeeab09bc00", "filename": "gcc/testsuite/gcc.dg/cpp/pr28165.c", "status": "added", "additions": 6, "deletions": 0, "changes": 6, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/705e2d28a1c830064e0bc77fd7e37f7e73b01516/gcc%2Ftestsuite%2Fgcc.dg%2Fcpp%2Fpr28165.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/705e2d28a1c830064e0bc77fd7e37f7e73b01516/gcc%2Ftestsuite%2Fgcc.dg%2Fcpp%2Fpr28165.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgcc.dg%2Fcpp%2Fpr28165.c?ref=705e2d28a1c830064e0bc77fd7e37f7e73b01516", "patch": "@@ -0,0 +1,6 @@\n+/* Copyright (C) 2007 Free Software Foundation, Inc.  */\n+/* PR preprocessor/28165 */\n+\n+/* { dg-do preprocess } */\n+#pragma GCC system_header   /* { dg-warning \"system_header\" \"ignored\" } */\n+_Pragma (\"GCC system_header\")   /* { dg-warning \"system_header\" \"ignored\" } */"}, {"sha": "072c6aadbb99fa5b98c0384cc4d25e0a8e8c9ac4", "filename": "libcpp/ChangeLog", "status": "modified", "additions": 8, "deletions": 0, "changes": 8, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/705e2d28a1c830064e0bc77fd7e37f7e73b01516/libcpp%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/705e2d28a1c830064e0bc77fd7e37f7e73b01516/libcpp%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libcpp%2FChangeLog?ref=705e2d28a1c830064e0bc77fd7e37f7e73b01516", "patch": "@@ -1,3 +1,11 @@\n+2007-01-04  Tom Tromey  <tromey@redhat.com>\n+\n+\tPR preprocessor/28165:\n+\t* internal.h (cpp_in_primary_file): New function.\n+\t* directives.c (do_include_next): Use cpp_in_primary_file.\n+\t(do_pragma_once): Likewise.\n+\t(do_pragma_system_header): Likewise.\n+\n 2006-12-29  Ian Lance Taylor  <iant@google.com>\n \n \t* lex.c (_cpp_clean_line): Add uses of __builtin_expect.  Don't"}, {"sha": "2ef914a435e99dcc6ecc7d199d9167245e83a023", "filename": "libcpp/directives.c", "status": "modified", "additions": 5, "deletions": 6, "changes": 11, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/705e2d28a1c830064e0bc77fd7e37f7e73b01516/libcpp%2Fdirectives.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/705e2d28a1c830064e0bc77fd7e37f7e73b01516/libcpp%2Fdirectives.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libcpp%2Fdirectives.c?ref=705e2d28a1c830064e0bc77fd7e37f7e73b01516", "patch": "@@ -1,6 +1,7 @@\n /* CPP Library. (Directive handling.)\n    Copyright (C) 1986, 1987, 1989, 1992, 1993, 1994, 1995, 1996, 1997, 1998,\n-   1999, 2000, 2001, 2002, 2003, 2004, 2005 Free Software Foundation, Inc.\n+   1999, 2000, 2001, 2002, 2003, 2004, 2005,\n+   2007 Free Software Foundation, Inc.\n    Contributed by Per Bothner, 1994-95.\n    Based on CCCP program by Paul Rubin, June 1986\n    Adapted to ANSI C, Richard Stallman, Jan 1987\n@@ -772,7 +773,7 @@ do_include_next (cpp_reader *pfile)\n \n   /* If this is the primary source file, warn and use the normal\n      search logic.  */\n-  if (! pfile->buffer->prev)\n+  if (cpp_in_primary_file (pfile))\n     {\n       cpp_error (pfile, CPP_DL_WARNING,\n \t\t \"#include_next in primary source file\");\n@@ -1346,7 +1347,7 @@ do_pragma (cpp_reader *pfile)\n static void\n do_pragma_once (cpp_reader *pfile)\n {\n-  if (pfile->buffer->prev == NULL)\n+  if (cpp_in_primary_file (pfile))\n     cpp_error (pfile, CPP_DL_WARNING, \"#pragma once in main file\");\n \n   check_eol (pfile);\n@@ -1396,9 +1397,7 @@ do_pragma_poison (cpp_reader *pfile)\n static void\n do_pragma_system_header (cpp_reader *pfile)\n {\n-  cpp_buffer *buffer = pfile->buffer;\n-\n-  if (buffer->prev == 0)\n+  if (cpp_in_primary_file (pfile))\n     cpp_error (pfile, CPP_DL_WARNING,\n \t       \"#pragma system_header ignored outside include file\");\n   else"}, {"sha": "20f423580517d73fe6196efa2dcc4b2628d0dc31", "filename": "libcpp/internal.h", "status": "modified", "additions": 8, "deletions": 1, "changes": 9, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/705e2d28a1c830064e0bc77fd7e37f7e73b01516/libcpp%2Finternal.h", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/705e2d28a1c830064e0bc77fd7e37f7e73b01516/libcpp%2Finternal.h", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libcpp%2Finternal.h?ref=705e2d28a1c830064e0bc77fd7e37f7e73b01516", "patch": "@@ -1,5 +1,5 @@\n /* Part of CPP library.\n-   Copyright (C) 1997, 1998, 1999, 2000, 2001, 2002, 2003, 2004, 2005\n+   Copyright (C) 1997, 1998, 1999, 2000, 2001, 2002, 2003, 2004, 2005, 2007\n    Free Software Foundation, Inc.\n \n This program is free software; you can redistribute it and/or modify it\n@@ -488,6 +488,13 @@ cpp_in_system_header (cpp_reader *pfile)\n #define CPP_PEDANTIC(PF) CPP_OPTION (PF, pedantic)\n #define CPP_WTRADITIONAL(PF) CPP_OPTION (PF, warn_traditional)\n \n+static inline int cpp_in_primary_file (cpp_reader *);\n+static inline int\n+cpp_in_primary_file (cpp_reader *pfile)\n+{\n+  return pfile->line_table->depth == 1;\n+}\n+\n /* In errors.c  */\n extern int _cpp_begin_message (cpp_reader *, int,\n \t\t\t       source_location, unsigned int);"}]}