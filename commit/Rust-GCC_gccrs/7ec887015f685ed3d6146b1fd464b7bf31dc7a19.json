{"sha": "7ec887015f685ed3d6146b1fd464b7bf31dc7a19", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6N2VjODg3MDE1ZjY4NWVkM2Q2MTQ2YjFmZDQ2NGI3YmYzMWRjN2ExOQ==", "commit": {"author": {"name": "Richard Henderson", "email": "rth@redhat.com", "date": "2012-11-06T23:55:11Z"}, "committer": {"name": "Richard Henderson", "email": "rth@gcc.gnu.org", "date": "2012-11-06T23:55:11Z"}, "message": "Prevent \"illegal\" block sharing within transactions.\n\n        * tree-ssa-tail-merge.c (find_duplicate): Do not consider\n        is_tm_ending_fndecl calls as mergable.\n\nFrom-SVN: r193268", "tree": {"sha": "0785f2785ae84b5b812bfe805741e7d95249c3b9", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/0785f2785ae84b5b812bfe805741e7d95249c3b9"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/7ec887015f685ed3d6146b1fd464b7bf31dc7a19", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/7ec887015f685ed3d6146b1fd464b7bf31dc7a19", "html_url": "https://github.com/Rust-GCC/gccrs/commit/7ec887015f685ed3d6146b1fd464b7bf31dc7a19", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/7ec887015f685ed3d6146b1fd464b7bf31dc7a19/comments", "author": null, "committer": null, "parents": [{"sha": "99ea153e45c86a1b0318e3f5e983624c3336445e", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/99ea153e45c86a1b0318e3f5e983624c3336445e", "html_url": "https://github.com/Rust-GCC/gccrs/commit/99ea153e45c86a1b0318e3f5e983624c3336445e"}], "stats": {"total": 18, "additions": 17, "deletions": 1}, "files": [{"sha": "7cc405127af4c99a6e8eddbab7f390a666518357", "filename": "gcc/ChangeLog", "status": "modified", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/7ec887015f685ed3d6146b1fd464b7bf31dc7a19/gcc%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/7ec887015f685ed3d6146b1fd464b7bf31dc7a19/gcc%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2FChangeLog?ref=7ec887015f685ed3d6146b1fd464b7bf31dc7a19", "patch": "@@ -1,3 +1,8 @@\n+2012-11-06  Richard Henderson  <rth@redhat.com>\n+\n+\t* tree-ssa-tail-merge.c (find_duplicate): Do not consider\n+\tis_tm_ending_fndecl calls as mergable.\n+\n 2012-11-06  Sterling Augustine <saugustine@google.com>\n             Cary Coutant <ccoutant@google.com>\n "}, {"sha": "1521badebf85390272905cecd5787473d268939c", "filename": "gcc/tree-ssa-tail-merge.c", "status": "modified", "additions": 12, "deletions": 1, "changes": 13, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/7ec887015f685ed3d6146b1fd464b7bf31dc7a19/gcc%2Ftree-ssa-tail-merge.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/7ec887015f685ed3d6146b1fd464b7bf31dc7a19/gcc%2Ftree-ssa-tail-merge.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftree-ssa-tail-merge.c?ref=7ec887015f685ed3d6146b1fd464b7bf31dc7a19", "patch": "@@ -1213,7 +1213,18 @@ find_duplicate (same_succ same_succ, basic_block bb1, basic_block bb2)\n \n   while (!gsi_end_p (gsi1) && !gsi_end_p (gsi2))\n     {\n-      if (!gimple_equal_p (same_succ, gsi_stmt (gsi1), gsi_stmt (gsi2)))\n+      gimple stmt1 = gsi_stmt (gsi1);\n+      gimple stmt2 = gsi_stmt (gsi2);\n+\n+      if (!gimple_equal_p (same_succ, stmt1, stmt2))\n+\treturn;\n+\n+      // We cannot tail-merge the builtins that end transactions.\n+      // ??? The alternative being unsharing of BBs in the tm_init pass.\n+      if (flag_tm\n+\t  && is_gimple_call (stmt1)\n+\t  && (gimple_call_flags (stmt1) & ECF_TM_BUILTIN)\n+\t  && is_tm_ending_fndecl (gimple_call_fndecl (stmt1)))\n \treturn;\n \n       gsi_prev_nondebug (&gsi1);"}]}