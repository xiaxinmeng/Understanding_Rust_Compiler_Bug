{"sha": "94313f351a9d53ae192d425c82b023b895827009", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6OTQzMTNmMzUxYTlkNTNhZTE5MmQ0MjVjODJiMDIzYjg5NTgyNzAwOQ==", "commit": {"author": {"name": "Richard Henderson", "email": "rth@redhat.com", "date": "2002-09-17T02:02:08Z"}, "committer": {"name": "Richard Henderson", "email": "rth@gcc.gnu.org", "date": "2002-09-17T02:02:08Z"}, "message": "real.c (do_fix_trunc): New.\n\n        * real.c (do_fix_trunc): New.\n        (real_arithmetic): Call it.\n        * simplify-rtx.c (simplify_unary_operation): Handle FIX\n        with a floating-point result mode.\n\nFrom-SVN: r57223", "tree": {"sha": "df5b1eab0ed6952e5bf3b44a3f604f1b97de876f", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/df5b1eab0ed6952e5bf3b44a3f604f1b97de876f"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/94313f351a9d53ae192d425c82b023b895827009", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/94313f351a9d53ae192d425c82b023b895827009", "html_url": "https://github.com/Rust-GCC/gccrs/commit/94313f351a9d53ae192d425c82b023b895827009", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/94313f351a9d53ae192d425c82b023b895827009/comments", "author": null, "committer": null, "parents": [{"sha": "ad17a52a21392e7832aa96b950b02e970b6a390e", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/ad17a52a21392e7832aa96b950b02e970b6a390e", "html_url": "https://github.com/Rust-GCC/gccrs/commit/ad17a52a21392e7832aa96b950b02e970b6a390e"}], "stats": {"total": 61, "additions": 57, "deletions": 4}, "files": [{"sha": "06a2ff9966ce95f1afc27c14c995a1813d9613a9", "filename": "gcc/ChangeLog", "status": "modified", "additions": 7, "deletions": 0, "changes": 7, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/94313f351a9d53ae192d425c82b023b895827009/gcc%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/94313f351a9d53ae192d425c82b023b895827009/gcc%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2FChangeLog?ref=94313f351a9d53ae192d425c82b023b895827009", "patch": "@@ -1,3 +1,10 @@\n+2002-09-16  Richard Henderson  <rth@redhat.com>\n+\n+\t* real.c (do_fix_trunc): New.\n+\t(real_arithmetic): Call it.\n+\t* simplify-rtx.c (simplify_unary_operation): Handle FIX\n+\twith a floating-point result mode.\n+\n 2002-09-16  Richard Henderson  <rth@redhat.com>\n \n \t* builtin-types.def (BT_FN_FLOAT_CONST_STRING): New."}, {"sha": "dd9f9be4f9888536522d4f8047e612a7760a4ad0", "filename": "gcc/real.c", "status": "modified", "additions": 34, "deletions": 0, "changes": 34, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/94313f351a9d53ae192d425c82b023b895827009/gcc%2Freal.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/94313f351a9d53ae192d425c82b023b895827009/gcc%2Freal.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Freal.c?ref=94313f351a9d53ae192d425c82b023b895827009", "patch": "@@ -174,6 +174,8 @@ static void do_divide PARAMS ((struct real_value *, const struct real_value *,\n \t\t\t       const struct real_value *));\n static int do_compare PARAMS ((const struct real_value *,\n \t\t\t       const struct real_value *, int));\n+static void do_fix_trunc PARAMS ((struct real_value *,\n+\t\t\t\t  const struct real_value *));\n \n static const struct real_value * ten_to_ptwo PARAMS ((int));\n static const struct real_value * real_digit PARAMS ((int));\n@@ -1013,6 +1015,34 @@ do_compare (a, b, nan_result)\n   return (a->sign ? -ret : ret);\n }\n \n+/* Return A truncated to an integral value toward zero.  */\n+\n+void\n+do_fix_trunc (r, a)\n+     struct real_value *r;\n+     const struct real_value *a;\n+{\n+  *r = *a;\n+\n+  switch (a->class)\n+    {\n+    case rvc_zero:\n+    case rvc_inf:\n+    case rvc_nan:\n+      break;\n+\n+    case rvc_normal:\n+      if (r->exp <= 0)\n+\tget_zero (r, r->sign);\n+      else if (r->exp < SIGNIFICAND_BITS)\n+\tclear_significand_below (r, SIGNIFICAND_BITS - r->exp);\n+      break;\n+\n+    default:\n+      abort ();\n+    }\n+}\n+\n /* Perform the binary or unary operation described by CODE.\n    For a unary operation, leave OP1 NULL.  */\n \n@@ -1073,6 +1103,10 @@ real_arithmetic (tr, icode, top0, top1)\n       r->sign = 0;\n       break;\n \n+    case FIX_TRUNC_EXPR:\n+      do_fix_trunc (r, op0);\n+      break;\n+\n     default:\n       abort ();\n     }"}, {"sha": "3566d106a72eb74aa012bc03c2bee05e09334b69", "filename": "gcc/simplify-rtx.c", "status": "modified", "additions": 16, "deletions": 4, "changes": 20, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/94313f351a9d53ae192d425c82b023b895827009/gcc%2Fsimplify-rtx.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/94313f351a9d53ae192d425c82b023b895827009/gcc%2Fsimplify-rtx.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fsimplify-rtx.c?ref=94313f351a9d53ae192d425c82b023b895827009", "patch": "@@ -599,10 +599,22 @@ simplify_unary_operation (code, mode, op, op_mode)\n \t  /* We don't attempt to optimize this.  */\n \t  return 0;\n \n-\tcase ABS:\t      d = REAL_VALUE_ABS (d);\t\t\tbreak;\n-\tcase NEG:\t      d = REAL_VALUE_NEGATE (d);\t\tbreak;\n-\tcase FLOAT_TRUNCATE:  d = real_value_truncate (mode, d);\tbreak;\n-\tcase FLOAT_EXTEND:    /* All this does is change the mode.  */  break;\n+\tcase ABS:\n+\t  d = REAL_VALUE_ABS (d);\n+\t  break;\n+\tcase NEG:\n+\t  d = REAL_VALUE_NEGATE (d);\n+\t  break;\n+\tcase FLOAT_TRUNCATE:\n+\t  d = real_value_truncate (mode, d);\n+\t  break;\n+\tcase FLOAT_EXTEND:\n+\t  /* All this does is change the mode.  */\n+\t  break;\n+\tcase FIX:\n+\t  real_arithmetic (&d, FIX_TRUNC_EXPR, &d, NULL);\n+\t  break;\n+\n \tdefault:\n \t  abort ();\n \t}"}]}