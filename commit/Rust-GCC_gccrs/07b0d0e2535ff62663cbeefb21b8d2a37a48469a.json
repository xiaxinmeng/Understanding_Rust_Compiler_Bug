{"sha": "07b0d0e2535ff62663cbeefb21b8d2a37a48469a", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6MDdiMGQwZTI1MzVmZjYyNjYzY2JlZWZiMjFiOGQyYTM3YTQ4NDY5YQ==", "commit": {"author": {"name": "Alexander Monakov", "email": "amonakov@ispras.ru", "date": "2009-11-25T05:17:38Z"}, "committer": {"name": "Sebastian Pop", "email": "spop@gcc.gnu.org", "date": "2009-11-25T05:17:38Z"}, "message": "graphite-sese-to-poly.c (build_loop_iteration_domains): Generalize construction of parameter constraints from loop iteration analysis.\n\n2009-10-20  Alexander Monakov  <amonakov@ispras.ru>\n\n\t* graphite-sese-to-poly.c (build_loop_iteration_domains): Generalize\n\tconstruction of parameter constraints from loop iteration analysis.\n\t* gcc.dg/graphite/run-id-2.c: New test.\n\nFrom-SVN: r154610", "tree": {"sha": "c9231f3e31da81f882521e064ecae446d91fdbaf", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/c9231f3e31da81f882521e064ecae446d91fdbaf"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/07b0d0e2535ff62663cbeefb21b8d2a37a48469a", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/07b0d0e2535ff62663cbeefb21b8d2a37a48469a", "html_url": "https://github.com/Rust-GCC/gccrs/commit/07b0d0e2535ff62663cbeefb21b8d2a37a48469a", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/07b0d0e2535ff62663cbeefb21b8d2a37a48469a/comments", "author": {"login": "amonakov", "id": 1997391, "node_id": "MDQ6VXNlcjE5OTczOTE=", "avatar_url": "https://avatars.githubusercontent.com/u/1997391?v=4", "gravatar_id": "", "url": "https://api.github.com/users/amonakov", "html_url": "https://github.com/amonakov", "followers_url": "https://api.github.com/users/amonakov/followers", "following_url": "https://api.github.com/users/amonakov/following{/other_user}", "gists_url": "https://api.github.com/users/amonakov/gists{/gist_id}", "starred_url": "https://api.github.com/users/amonakov/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/amonakov/subscriptions", "organizations_url": "https://api.github.com/users/amonakov/orgs", "repos_url": "https://api.github.com/users/amonakov/repos", "events_url": "https://api.github.com/users/amonakov/events{/privacy}", "received_events_url": "https://api.github.com/users/amonakov/received_events", "type": "User", "site_admin": false}, "committer": {"login": "sebpop", "id": 568397, "node_id": "MDQ6VXNlcjU2ODM5Nw==", "avatar_url": "https://avatars.githubusercontent.com/u/568397?v=4", "gravatar_id": "", "url": "https://api.github.com/users/sebpop", "html_url": "https://github.com/sebpop", "followers_url": "https://api.github.com/users/sebpop/followers", "following_url": "https://api.github.com/users/sebpop/following{/other_user}", "gists_url": "https://api.github.com/users/sebpop/gists{/gist_id}", "starred_url": "https://api.github.com/users/sebpop/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/sebpop/subscriptions", "organizations_url": "https://api.github.com/users/sebpop/orgs", "repos_url": "https://api.github.com/users/sebpop/repos", "events_url": "https://api.github.com/users/sebpop/events{/privacy}", "received_events_url": "https://api.github.com/users/sebpop/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "67255edf95e35608b4d3f3b4a375203019d6b8c1", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/67255edf95e35608b4d3f3b4a375203019d6b8c1", "html_url": "https://github.com/Rust-GCC/gccrs/commit/67255edf95e35608b4d3f3b4a375203019d6b8c1"}], "stats": {"total": 57, "additions": 31, "deletions": 26}, "files": [{"sha": "acf847ccc5d2a054acdcccacedfd1665cdefeac1", "filename": "gcc/ChangeLog.graphite", "status": "modified", "additions": 6, "deletions": 0, "changes": 6, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/07b0d0e2535ff62663cbeefb21b8d2a37a48469a/gcc%2FChangeLog.graphite", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/07b0d0e2535ff62663cbeefb21b8d2a37a48469a/gcc%2FChangeLog.graphite", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2FChangeLog.graphite?ref=07b0d0e2535ff62663cbeefb21b8d2a37a48469a", "patch": "@@ -1,3 +1,9 @@\n+2009-10-20  Alexander Monakov  <amonakov@ispras.ru>\n+\n+\t* graphite-sese-to-poly.c (build_loop_iteration_domains): Generalize\n+\tconstruction of parameter constraints from loop iteration analysis.\n+\t* gcc.dg/graphite/run-id-2.c: New test.\n+\n 2009-10-17  Sebastian Pop  <sebastian.pop@amd.com>\n \n \t* graphite-interchange.c (memory_stride_in_loop): Delete p1, lma"}, {"sha": "214dc8b006fa2d31e5904fe3be812d03e529566a", "filename": "gcc/graphite-sese-to-poly.c", "status": "modified", "additions": 25, "deletions": 26, "changes": 51, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/07b0d0e2535ff62663cbeefb21b8d2a37a48469a/gcc%2Fgraphite-sese-to-poly.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/07b0d0e2535ff62663cbeefb21b8d2a37a48469a/gcc%2Fgraphite-sese-to-poly.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fgraphite-sese-to-poly.c?ref=07b0d0e2535ff62663cbeefb21b8d2a37a48469a", "patch": "@@ -1140,49 +1140,48 @@ build_loop_iteration_domains (scop_p scop, struct loop *loop,\n \t  Value val;\n \t  ppl_Linear_Expression_t nb_iters_le;\n \t  ppl_Polyhedron_t pol;\n-\t  graphite_dim_t p, n = scop_nb_params (scop);\n+\t  graphite_dim_t n = scop_nb_params (scop);\n \t  ppl_Coefficient_t coef;\n \n \t  ppl_new_C_Polyhedron_from_space_dimension (&pol, dim, 0);\n \t  ppl_new_Linear_Expression_from_Linear_Expression (&nb_iters_le,\n \t\t\t\t\t\t\t    ub_expr);\n \n+\t  /* Construct the negated number of last iteration in VAL.  */\n \t  value_init (val);\n \t  mpz_set_double_int (val, nit, false);\n+\t  value_sub_int (val, val, 1);\n+\t  value_oppose (val, val);\n+\n+\t  /* NB_ITERS_LE holds number of last iteration in parametrical form.\n+\t  Subtract estimated number of last iteration and assert that result\n+\t  is not positive.  */\n \t  ppl_new_Coefficient_from_mpz_t (&coef, val);\n \t  ppl_Linear_Expression_add_to_inhomogeneous (nb_iters_le, coef);\n \t  ppl_delete_Coefficient (coef);\n \t  ppl_new_Constraint (&ub, nb_iters_le,\n \t\t\t      PPL_CONSTRAINT_TYPE_LESS_OR_EQUAL);\n \t  ppl_Polyhedron_add_constraint (pol, ub);\n \n-\t  for (p = 0; p < n; p++)\n+\t  /* Remove all but last N dimensions from POL to obtain constraints\n+\t     on parameters.  */\n \t    {\n-\t      ppl_Linear_Expression_t le;\n-\n-\t      ppl_new_Linear_Expression_with_dimension (&le, dim);\n-\t      ppl_set_coef (le, nb + 1 + p, -1);\n-\n-\t      value_set_si (val, -1);\n-\t      ppl_min_for_le_polyhedron (pol, le, val);\n-\t      if (!value_mone_p (val))\n-\t\t{\n-\t\t  ppl_Linear_Expression_t parm_bound;\n-\t\t  ppl_Constraint_t cstr;\n-\n-\t\t  ppl_new_Linear_Expression_with_dimension (&parm_bound, n);\n-\t\t  ppl_set_coef (parm_bound, p, -1);\n-\t\t  ppl_set_inhomogeneous_gmp (parm_bound, val);\n-\t\t  ppl_new_Constraint (&cstr, parm_bound,\n-\t\t\t\t      PPL_CONSTRAINT_TYPE_GREATER_OR_EQUAL);\n-\t\t  ppl_Pointset_Powerset_C_Polyhedron_add_constraint\n-\t\t    (SCOP_CONTEXT (scop), cstr);\n-\n-\t\t  ppl_delete_Constraint (cstr);\n-\t\t  ppl_delete_Linear_Expression (parm_bound);\n-\t\t}\n+\t      ppl_dimension_type *dims = XNEWVEC (ppl_dimension_type, dim - n);\n+\t      graphite_dim_t i;\n+\t      for (i = 0; i < dim - n; i++)\n+\t\tdims[i] = i;\n+\t      ppl_Polyhedron_remove_space_dimensions (pol, dims, dim - n);\n+\t      XDELETEVEC (dims);\n+\t    }\n \n-\t      ppl_delete_Linear_Expression (le);\n+\t  /* Add constraints on parameters to SCoP context.  */\n+\t    {\n+\t      ppl_Pointset_Powerset_C_Polyhedron_t constraints_ps;\n+\t      ppl_new_Pointset_Powerset_C_Polyhedron_from_C_Polyhedron\n+\t       (&constraints_ps, pol);\n+\t      ppl_Pointset_Powerset_C_Polyhedron_intersection_assign\n+\t       (SCOP_CONTEXT (scop), constraints_ps);\n+\t      ppl_delete_Pointset_Powerset_C_Polyhedron (constraints_ps);\n \t    }\n \n \t  ppl_delete_Polyhedron (pol);"}]}