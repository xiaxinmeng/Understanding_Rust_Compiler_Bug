{"sha": "1bde114aaceb7f423aaafbc62df6e5ba51a15b27", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6MWJkZTExNGFhY2ViN2Y0MjNhYWFmYmM2MmRmNmU1YmE1MWExNWIyNw==", "commit": {"author": {"name": "Georg-Johann Lay", "email": "avr@gjlay.de", "date": "2017-07-12T15:25:07Z"}, "committer": {"name": "Georg-Johann Lay", "email": "gjl@gcc.gnu.org", "date": "2017-07-12T15:25:07Z"}, "message": "re PR target/79883 (avr i18n: untranslated \"interrupt\" or \"signal\")\n\n\tPR target/79883\n\t* config/avr/avr.c (avr_set_current_function): In diagnostic\n\tmessages: Quote keywords and (parts of) identifiers.\n\t[WITH_AVRLIBC]: Warn for functions named \"ISR\", \"SIGNAL\" or\n\t\"INTERUPT\".\n\nFrom-SVN: r250156", "tree": {"sha": "9acd4958bf26df7fc73ebacd0d586a342372a534", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/9acd4958bf26df7fc73ebacd0d586a342372a534"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/1bde114aaceb7f423aaafbc62df6e5ba51a15b27", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/1bde114aaceb7f423aaafbc62df6e5ba51a15b27", "html_url": "https://github.com/Rust-GCC/gccrs/commit/1bde114aaceb7f423aaafbc62df6e5ba51a15b27", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/1bde114aaceb7f423aaafbc62df6e5ba51a15b27/comments", "author": null, "committer": {"login": "sprintersb", "id": 8905355, "node_id": "MDQ6VXNlcjg5MDUzNTU=", "avatar_url": "https://avatars.githubusercontent.com/u/8905355?v=4", "gravatar_id": "", "url": "https://api.github.com/users/sprintersb", "html_url": "https://github.com/sprintersb", "followers_url": "https://api.github.com/users/sprintersb/followers", "following_url": "https://api.github.com/users/sprintersb/following{/other_user}", "gists_url": "https://api.github.com/users/sprintersb/gists{/gist_id}", "starred_url": "https://api.github.com/users/sprintersb/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/sprintersb/subscriptions", "organizations_url": "https://api.github.com/users/sprintersb/orgs", "repos_url": "https://api.github.com/users/sprintersb/repos", "events_url": "https://api.github.com/users/sprintersb/events{/privacy}", "received_events_url": "https://api.github.com/users/sprintersb/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "118009c1e5e8d1bce7739f542347ddd994b664a8", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/118009c1e5e8d1bce7739f542347ddd994b664a8", "html_url": "https://github.com/Rust-GCC/gccrs/commit/118009c1e5e8d1bce7739f542347ddd994b664a8"}], "stats": {"total": 38, "additions": 31, "deletions": 7}, "files": [{"sha": "bdf6e45d8498e060512bcdf7283ef79d1024c969", "filename": "gcc/ChangeLog", "status": "modified", "additions": 8, "deletions": 0, "changes": 8, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/1bde114aaceb7f423aaafbc62df6e5ba51a15b27/gcc%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/1bde114aaceb7f423aaafbc62df6e5ba51a15b27/gcc%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2FChangeLog?ref=1bde114aaceb7f423aaafbc62df6e5ba51a15b27", "patch": "@@ -1,3 +1,11 @@\n+2017-07-12  Georg-Johann Lay  <avr@gjlay.de>\n+\n+\tPR target/79883\n+\t* config/avr/avr.c (avr_set_current_function): In diagnostic\n+\tmessages: Quote keywords and (parts of) identifiers.\n+\t[WITH_AVRLIBC]: Warn for functions named \"ISR\", \"SIGNAL\" or\n+\t\"INTERUPT\".\n+\n 2017-07-12  Carl Love  <cel@us.ibm.com>\n \n \t* config/rs6000/rs6000-c.c: Add support for built-in functions"}, {"sha": "49ebb6352a291c3e546c289aa166e4aa98451e76", "filename": "gcc/config/avr/avr.c", "status": "modified", "additions": 23, "deletions": 7, "changes": 30, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/1bde114aaceb7f423aaafbc62df6e5ba51a15b27/gcc%2Fconfig%2Favr%2Favr.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/1bde114aaceb7f423aaafbc62df6e5ba51a15b27/gcc%2Fconfig%2Favr%2Favr.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fconfig%2Favr%2Favr.c?ref=1bde114aaceb7f423aaafbc62df6e5ba51a15b27", "patch": "@@ -1076,12 +1076,6 @@ avr_set_current_function (tree decl)\n \n       name = default_strip_name_encoding (name);\n \n-      /* Silently ignore 'signal' if 'interrupt' is present.  AVR-LibC startet\n-         using this when it switched from SIGNAL and INTERRUPT to ISR.  */\n-\n-      if (cfun->machine->is_interrupt)\n-        cfun->machine->is_signal = 0;\n-\n       /* Interrupt handlers must be  void __vector (void)  functions.  */\n \n       if (args && TREE_CODE (TREE_VALUE (args)) != VOID_TYPE)\n@@ -1090,14 +1084,36 @@ avr_set_current_function (tree decl)\n       if (TREE_CODE (ret) != VOID_TYPE)\n         error_at (loc, \"%qs function cannot return a value\", isr);\n \n+#if defined WITH_AVRLIBC\n+      /* Silently ignore 'signal' if 'interrupt' is present.  AVR-LibC startet\n+         using this when it switched from SIGNAL and INTERRUPT to ISR.  */\n+\n+      if (cfun->machine->is_interrupt)\n+        cfun->machine->is_signal = 0;\n+\n       /* If the function has the 'signal' or 'interrupt' attribute, ensure\n          that the name of the function is \"__vector_NN\" so as to catch\n          when the user misspells the vector name.  */\n \n       if (!STR_PREFIX_P (name, \"__vector\"))\n         warning_at (loc, OPT_Wmisspelled_isr, \"%qs appears to be a misspelled \"\n-                    \"%s handler, missing __vector prefix\", name, isr);\n+                    \"%qs handler, missing %<__vector%> prefix\", name, isr);\n+#endif // AVR-LibC naming conventions\n+    }\n+\n+#if defined WITH_AVRLIBC\n+  // Common problem is using \"ISR\" without first including avr/interrupt.h.\n+  const char *name = IDENTIFIER_POINTER (DECL_NAME (decl));\n+  name = default_strip_name_encoding (name);\n+  if (0 == strcmp (\"ISR\", name)\n+      || 0 == strcmp (\"INTERRUPT\", name)\n+      || 0 == strcmp (\"SIGNAL\", name))\n+    {\n+      warning_at (loc, OPT_Wmisspelled_isr, \"%qs is a reserved indentifier\"\n+                  \" in AVR-LibC.  Consider %<#include <avr/interrupt.h>%>\"\n+                  \" before using the %qs macro\", name, name);\n     }\n+#endif // AVR-LibC naming conventions\n \n   /* Don't print the above diagnostics more than once.  */\n "}]}