{"sha": "dc8f57914cb54a209cf2d52bb04d21502990842b", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6ZGM4ZjU3OTE0Y2I1NGEyMDljZjJkNTJiYjA0ZDIxNTAyOTkwODQyYg==", "commit": {"author": {"name": "Vincent Celier", "email": "celier@adacore.com", "date": "2005-06-16T08:55:59Z"}, "committer": {"name": "Arnaud Charlet", "email": "charlet@gcc.gnu.org", "date": "2005-06-16T08:55:59Z"}, "message": "makegpr.adb (Compile_Link_With_Gnatmake): Invoke gnatmake with -d if gprmake was invoked with -d.\n\n2005-06-14  Vincent Celier  <celier@adacore.com>\n\n\t* makegpr.adb (Compile_Link_With_Gnatmake): Invoke gnatmake with -d if\n\tgprmake was invoked with -d.\n\t(Compile_Sources): If -d was used, output the \"completed ...\" message\n\tfor each compilation.\n\t(Scan_Arg): Recognize new switch -d\n\tWhen -c and at least one main is specified, set\n\tUnique_Compile to True to guarantee that no other sources will be\n\tcompiled.\n\nFrom-SVN: r101068", "tree": {"sha": "e18aa2d051b82c7946e9a78cc5fbd846d4e04e46", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/e18aa2d051b82c7946e9a78cc5fbd846d4e04e46"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/dc8f57914cb54a209cf2d52bb04d21502990842b", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/dc8f57914cb54a209cf2d52bb04d21502990842b", "html_url": "https://github.com/Rust-GCC/gccrs/commit/dc8f57914cb54a209cf2d52bb04d21502990842b", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/dc8f57914cb54a209cf2d52bb04d21502990842b/comments", "author": {"login": "vcelier", "id": 8888056, "node_id": "MDQ6VXNlcjg4ODgwNTY=", "avatar_url": "https://avatars.githubusercontent.com/u/8888056?v=4", "gravatar_id": "", "url": "https://api.github.com/users/vcelier", "html_url": "https://github.com/vcelier", "followers_url": "https://api.github.com/users/vcelier/followers", "following_url": "https://api.github.com/users/vcelier/following{/other_user}", "gists_url": "https://api.github.com/users/vcelier/gists{/gist_id}", "starred_url": "https://api.github.com/users/vcelier/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/vcelier/subscriptions", "organizations_url": "https://api.github.com/users/vcelier/orgs", "repos_url": "https://api.github.com/users/vcelier/repos", "events_url": "https://api.github.com/users/vcelier/events{/privacy}", "received_events_url": "https://api.github.com/users/vcelier/received_events", "type": "User", "site_admin": false}, "committer": null, "parents": [{"sha": "a46edbad592965e0ff0b58d8466aa55fd54b95b0", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/a46edbad592965e0ff0b58d8466aa55fd54b95b0", "html_url": "https://github.com/Rust-GCC/gccrs/commit/a46edbad592965e0ff0b58d8466aa55fd54b95b0"}], "stats": {"total": 60, "additions": 60, "deletions": 0}, "files": [{"sha": "aad0ec4b7ffa943e11c4ddf2e7634824453f83ae", "filename": "gcc/ada/makegpr.adb", "status": "modified", "additions": 60, "deletions": 0, "changes": 60, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/dc8f57914cb54a209cf2d52bb04d21502990842b/gcc%2Fada%2Fmakegpr.adb", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/dc8f57914cb54a209cf2d52bb04d21502990842b/gcc%2Fada%2Fmakegpr.adb", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fada%2Fmakegpr.adb?ref=dc8f57914cb54a209cf2d52bb04d21502990842b", "patch": "@@ -280,6 +280,8 @@ package body Makegpr is\n    Dash_c            : constant String_Access := Dash_c_String'Access;\n    Dash_cargs_String : aliased  String := \"-cargs\";\n    Dash_cargs        : constant String_Access := Dash_cargs_String'Access;\n+   Dash_d_String     : aliased  String := \"-d\";\n+   Dash_d            : constant String_Access := Dash_d_String'Access;\n    Dash_f_String     : aliased  String := \"-f\";\n    Dash_f            : constant String_Access := Dash_f_String'Access;\n    Dash_k_String     : aliased  String := \"-k\";\n@@ -2494,6 +2496,12 @@ package body Makegpr is\n          Add_Argument (Dash_c, True);\n       end if;\n \n+      --  -d\n+\n+      if Display_Compilation_Progress then\n+         Add_Argument (Dash_d, True);\n+      end if;\n+\n       --  -k\n \n       if Keep_Going then\n@@ -2604,7 +2612,28 @@ package body Makegpr is\n       Need_To_Rebuild_Archive : Boolean := Force_Compilations;\n       --  True when the archive needs to be built/rebuilt unconditionally\n \n+      Total_Number_Of_Sources : Int := 0;\n+\n+      Current_Source_Number : Int := 0;\n+\n    begin\n+      --  First, get the number of sources\n+\n+      for Project in Project_Table.First ..\n+                     Project_Table.Last (Project_Tree.Projects)\n+      loop\n+         Data := Project_Tree.Projects.Table (Project);\n+\n+         if (not Data.Virtual) and then Data.Other_Sources_Present then\n+            Source_Id := Data.First_Other_Source;\n+            while Source_Id /= No_Other_Source loop\n+               Source := Project_Tree.Other_Sources.Table (Source_Id);\n+               Total_Number_Of_Sources := Total_Number_Of_Sources + 1;\n+               Source_Id := Source.Next;\n+            end loop;\n+         end if;\n+      end loop;\n+\n       --  Loop through project files\n \n       for Project in Project_Table.First ..\n@@ -2636,7 +2665,9 @@ package body Makegpr is\n             --  Process each source one by one\n \n             while Source_Id /= No_Other_Source loop\n+\n                Source := Project_Tree.Other_Sources.Table (Source_Id);\n+               Current_Source_Number := Current_Source_Number + 1;\n                Need_To_Compile := Force_Compilations;\n \n                --  Check if compilation is needed\n@@ -2656,6 +2687,18 @@ package body Makegpr is\n                   Compile (Source_Id, Data, Local_Errors);\n                end if;\n \n+               if Display_Compilation_Progress then\n+                  Write_Str (\"completed \");\n+                  Write_Int (Current_Source_Number);\n+                  Write_Str (\" out of \");\n+                  Write_Int (Total_Number_Of_Sources);\n+                  Write_Str (\" (\");\n+                  Write_Int\n+                    ((Current_Source_Number * 100) / Total_Number_Of_Sources);\n+                  Write_Str (\"%)...\");\n+                  Write_Eol;\n+               end if;\n+\n                --  Next source, if any\n \n                Source_Id := Source.Next;\n@@ -4031,6 +4074,16 @@ package body Makegpr is\n          if Arg = \"-c\" then\n             Compile_Only := True;\n \n+            --  Make sure that when a main is specified and switch -c is used,\n+            --  only the main(s) is/are compiled.\n+\n+            if Mains.Number_Of_Mains > 0 then\n+               Unique_Compile := True;\n+            end if;\n+\n+         elsif Arg = \"-d\" then\n+            Display_Compilation_Progress := True;\n+\n          elsif Arg = \"-f\" then\n             Force_Compilations := True;\n \n@@ -4103,6 +4156,13 @@ package body Makegpr is\n          --  Not a switch: must be a main\n \n          Mains.Add_Main (Arg);\n+\n+         --  Make sure that when a main is specified and switch -c is used,\n+         --  only the main(s) is/are compiled.\n+\n+         if Compile_Only then\n+            Unique_Compile := True;\n+         end if;\n       end if;\n    end Scan_Arg;\n "}]}