{"sha": "fb8d0fac17d730521734266b364159b8a6f4a226", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6ZmI4ZDBmYWMxN2Q3MzA1MjE3MzQyNjZiMzY0MTU5YjhhNmY0YTIyNg==", "commit": {"author": {"name": "Richard Henderson", "email": "rth@redhat.com", "date": "2009-09-22T15:16:18Z"}, "committer": {"name": "Richard Henderson", "email": "rth@gcc.gnu.org", "date": "2009-09-22T15:16:18Z"}, "message": "stormy16.c (xstormy16_trampoline_init): Rename from xstormy16_initialize_trampoline...\n\n        * config/stormy16/stormy16.c (xstormy16_trampoline_init): Rename\n        from xstormy16_initialize_trampoline; make static; update for\n        hook parameters.\n        (TARGET_TRAMPOLINE_INIT): New.\n        * config/stormy16/stormy16.h (INITIALIZE_TRAMPOLINE): Remove.\n\nFrom-SVN: r152014", "tree": {"sha": "d9edfa397031459bbd942a82286a4289bf6cfb7e", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/d9edfa397031459bbd942a82286a4289bf6cfb7e"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/fb8d0fac17d730521734266b364159b8a6f4a226", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/fb8d0fac17d730521734266b364159b8a6f4a226", "html_url": "https://github.com/Rust-GCC/gccrs/commit/fb8d0fac17d730521734266b364159b8a6f4a226", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/fb8d0fac17d730521734266b364159b8a6f4a226/comments", "author": null, "committer": null, "parents": [{"sha": "a85b4c91b30eda2893ecf5efeeda4f9dbb518763", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/a85b4c91b30eda2893ecf5efeeda4f9dbb518763", "html_url": "https://github.com/Rust-GCC/gccrs/commit/a85b4c91b30eda2893ecf5efeeda4f9dbb518763"}], "stats": {"total": 38, "additions": 22, "deletions": 16}, "files": [{"sha": "f9ef657c5a01508fadaab31741833f6b20c472c0", "filename": "gcc/ChangeLog", "status": "modified", "additions": 6, "deletions": 0, "changes": 6, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/fb8d0fac17d730521734266b364159b8a6f4a226/gcc%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/fb8d0fac17d730521734266b364159b8a6f4a226/gcc%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2FChangeLog?ref=fb8d0fac17d730521734266b364159b8a6f4a226", "patch": "@@ -270,6 +270,12 @@\n \t* config/spu/spu-protos.h: Update decls.\n \t* config/spu/spu.h (INITIALIZE_TRAMPOLINE): Remove.\n \n+\t* config/stormy16/stormy16.c (xstormy16_trampoline_init): Rename\n+\tfrom xstormy16_initialize_trampoline; make static; update for\n+\thook parameters.\n+\t(TARGET_TRAMPOLINE_INIT): New.\n+\t* config/stormy16/stormy16.h (INITIALIZE_TRAMPOLINE): Remove.\n+\n 2009-09-22  Jakub Jelinek  <jakub@redhat.com>\n \n \t* config/rs6000/rs6000.c (bdesc_2arg): Fix CODE_FOR_vector_gt* codes"}, {"sha": "03e716f096e6f50d8f95a0ef06c96c52d67e724b", "filename": "gcc/config/stormy16/stormy16.c", "status": "modified", "additions": 16, "deletions": 11, "changes": 27, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/fb8d0fac17d730521734266b364159b8a6f4a226/gcc%2Fconfig%2Fstormy16%2Fstormy16.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/fb8d0fac17d730521734266b364159b8a6f4a226/gcc%2Fconfig%2Fstormy16%2Fstormy16.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fconfig%2Fstormy16%2Fstormy16.c?ref=fb8d0fac17d730521734266b364159b8a6f4a226", "patch": "@@ -1456,34 +1456,36 @@ xstormy16_gimplify_va_arg_expr (tree valist, tree type, gimple_seq *pre_p,\n   return build_va_arg_indirect_ref (addr);\n }\n \n-/* Initialize the variable parts of a trampoline.  ADDR is an RTX for\n-   the address of the trampoline; FNADDR is an RTX for the address of\n-   the nested function; STATIC_CHAIN is an RTX for the static chain\n-   value that should be passed to the function when it is called.  */\n+/* Worker function for TARGET_TRAMPOLINE_INIT.  */\n \n-void\n-xstormy16_initialize_trampoline (rtx addr, rtx fnaddr, rtx static_chain)\n+static void\n+xstormy16_trampoline_init (rtx m_tramp, tree fndecl, rtx static_chain)\n {\n-  rtx reg_addr = gen_reg_rtx (Pmode);\n   rtx temp = gen_reg_rtx (HImode);\n   rtx reg_fnaddr = gen_reg_rtx (HImode);\n-  rtx reg_addr_mem;\n+  rtx reg_addr, reg_addr_mem;\n \n-  reg_addr_mem = gen_rtx_MEM (HImode, reg_addr);\n+  reg_addr = copy_to_reg (XEXP (m_tramp, 0));\n+  reg_addr_mem = adjust_automodify_address (m_tramp, HImode, reg_addr, 0);\n \n-  emit_move_insn (reg_addr, addr);\n   emit_move_insn (temp, GEN_INT (0x3130 | STATIC_CHAIN_REGNUM));\n   emit_move_insn (reg_addr_mem, temp);\n   emit_insn (gen_addhi3 (reg_addr, reg_addr, const2_rtx));\n+  reg_addr_mem = adjust_automodify_address (reg_addr_mem, VOIDmode, NULL, 2);\n+\n   emit_move_insn (temp, static_chain);\n   emit_move_insn (reg_addr_mem, temp);\n   emit_insn (gen_addhi3 (reg_addr, reg_addr, const2_rtx));\n-  emit_move_insn (reg_fnaddr, fnaddr);\n+  reg_addr_mem = adjust_automodify_address (reg_addr_mem, VOIDmode, NULL, 2);\n+\n+  emit_move_insn (reg_fnaddr, XEXP (DECL_RTL (fndecl), 0));\n   emit_move_insn (temp, reg_fnaddr);\n   emit_insn (gen_andhi3 (temp, temp, GEN_INT (0xFF)));\n   emit_insn (gen_iorhi3 (temp, temp, GEN_INT (0x0200)));\n   emit_move_insn (reg_addr_mem, temp);\n   emit_insn (gen_addhi3 (reg_addr, reg_addr, const2_rtx));\n+  reg_addr_mem = adjust_automodify_address (reg_addr_mem, VOIDmode, NULL, 2);\n+\n   emit_insn (gen_lshrhi3 (reg_fnaddr, reg_fnaddr, GEN_INT (8)));\n   emit_move_insn (reg_addr_mem, reg_fnaddr);\n }\n@@ -2667,6 +2669,9 @@ xstormy16_return_in_memory (const_tree type, const_tree fntype ATTRIBUTE_UNUSED)\n #undef TARGET_CAN_ELIMINATE\n #define TARGET_CAN_ELIMINATE xstormy16_can_eliminate\n \n+#undef TARGET_TRAMPOLINE_INIT\n+#define TARGET_TRAMPOLINE_INIT xstormy16_trampoline_init\n+\n struct gcc_target targetm = TARGET_INITIALIZER;\n \n #include \"gt-stormy16.h\""}, {"sha": "682f7e6f4662b856aa3b00c1366e40558ae3fcb7", "filename": "gcc/config/stormy16/stormy16.h", "status": "modified", "additions": 0, "deletions": 5, "changes": 5, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/fb8d0fac17d730521734266b364159b8a6f4a226/gcc%2Fconfig%2Fstormy16%2Fstormy16.h", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/fb8d0fac17d730521734266b364159b8a6f4a226/gcc%2Fconfig%2Fstormy16%2Fstormy16.h", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fconfig%2Fstormy16%2Fstormy16.h?ref=fb8d0fac17d730521734266b364159b8a6f4a226", "patch": "@@ -454,12 +454,7 @@ enum reg_class\n /* Trampolines for Nested Functions.  */\n \n #define TRAMPOLINE_SIZE 8\n-\n #define TRAMPOLINE_ALIGNMENT 16\n-\n-#define INITIALIZE_TRAMPOLINE(ADDR, FNADDR, STATIC_CHAIN) \\\n-  xstormy16_initialize_trampoline (ADDR, FNADDR, STATIC_CHAIN)\n-\n \f\n /* Define this macro to override the type used by the library routines to pick\n    up arguments of type `float'.  (By default, they use a union of `float' and"}]}