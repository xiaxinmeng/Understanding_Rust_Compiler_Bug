{"sha": "fcfad74515da38bf73d67e2eb76e81a3cd862340", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6ZmNmYWQ3NDUxNWRhMzhiZjczZDY3ZTJlYjc2ZTgxYTNjZDg2MjM0MA==", "commit": {"author": {"name": "Christophe Lyon", "email": "christophe.lyon@linaro.org", "date": "2020-04-20T22:37:23Z"}, "committer": {"name": "Christophe Lyon", "email": "christophe.lyon@linaro.org", "date": "2021-03-23T15:11:48Z"}, "message": "testsuite/arm: Add arm_softfp_ok or arm_hard_ok as needed.\n\nSeveral tests override the -mfloat-abi option detected by their\neffective targets. Make sure it is supported, so that these tests are\nunsupported rather than failures (the inclusion of arm_neon.h\notherwise fails for lack of gnu/stubs-*.h)\n\nThis avoids failures with\nbfloat16_simd_2_1.c\nbfloat16_simd_3_1.c\nbf16_vldn_1.c\nbf16_vstn_1.c on arm-linux-gnueabi\nand\npr51968.c\nbfloat16_simd_1_2.c\nbfloat16_simd_2_2.c\nbfloat16_simd_3_2.c on arm-linux-gnueabihf.\n\nOn arm-eabi with default cpu/fpu/mode and a+rm multilibs,\nbfloat16_simd_2_1.c, bfloat16_simd_3_1.c, bf16_vstn_1.c and\nbf16_vldn_1.c become unsupported instead of pass because arm_hard_ok\nfails with \"selected processor lacks an FPU\". Since we also override\nthe fpu in dg-additional-options, we'd need another effective target\n(say arm_hard_neon_ok) that would check -mfloat-abi=hard -mfpu=neon at\nthe same time. But we have already so many arm effective targets, it\ndoesn't seem like a good way forward.\n\n2021-03-19  Christophe Lyon  <christophe.lyon@linaro.org>\n\n\tgcc/testsuite/\n\t* gcc.target/arm/bfloat16_simd_1_2.c: Add arm_softfp_ok.\n\t* gcc.target/arm/bfloat16_simd_2_2.c: Likewise.\n\t* gcc.target/arm/bfloat16_simd_3_2.c: Likewise.\n\t* gcc.target/arm/pr51968.c: Likewise.\n\t* gcc.target/arm/bfloat16_simd_2_1.c: arm_hard_ok.\n\t* gcc.target/arm/bfloat16_simd_3_1.c: Likewise.\n\t* gcc.target/arm/simd/bf16_vldn_1.c: Likewise.\n\t* gcc.target/arm/simd/bf16_vstn_1.c: Likewise.", "tree": {"sha": "82c891ffb06704cc5261cf6c2a512b187e43505b", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/82c891ffb06704cc5261cf6c2a512b187e43505b"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/fcfad74515da38bf73d67e2eb76e81a3cd862340", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/fcfad74515da38bf73d67e2eb76e81a3cd862340", "html_url": "https://github.com/Rust-GCC/gccrs/commit/fcfad74515da38bf73d67e2eb76e81a3cd862340", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/fcfad74515da38bf73d67e2eb76e81a3cd862340/comments", "author": null, "committer": null, "parents": [{"sha": "451c51e8ed385d06d80776168897a1b2a2e5d870", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/451c51e8ed385d06d80776168897a1b2a2e5d870", "html_url": "https://github.com/Rust-GCC/gccrs/commit/451c51e8ed385d06d80776168897a1b2a2e5d870"}], "stats": {"total": 10, "additions": 9, "deletions": 1}, "files": [{"sha": "95eecec2d0973edc803edd41762f1ea48094f10a", "filename": "gcc/testsuite/gcc.target/arm/bfloat16_simd_1_2.c", "status": "modified", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/fcfad74515da38bf73d67e2eb76e81a3cd862340/gcc%2Ftestsuite%2Fgcc.target%2Farm%2Fbfloat16_simd_1_2.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/fcfad74515da38bf73d67e2eb76e81a3cd862340/gcc%2Ftestsuite%2Fgcc.target%2Farm%2Fbfloat16_simd_1_2.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgcc.target%2Farm%2Fbfloat16_simd_1_2.c?ref=fcfad74515da38bf73d67e2eb76e81a3cd862340", "patch": "@@ -1,4 +1,5 @@\n /* { dg-do assemble { target { arm*-*-* } } } */\n+/* { dg-require-effective-target arm_softfp_ok } */\n /* { dg-require-effective-target arm_v8_neon_ok } */\n /* { dg-require-effective-target arm_v8_2a_bf16_neon_ok } */\n /* { dg-additional-options \"-march=armv8.2-a+bf16 -mfloat-abi=softfp -mfpu=auto\" } */"}, {"sha": "02b4c416df6877818055da4d59a1cdf1ac4a362c", "filename": "gcc/testsuite/gcc.target/arm/bfloat16_simd_2_1.c", "status": "modified", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/fcfad74515da38bf73d67e2eb76e81a3cd862340/gcc%2Ftestsuite%2Fgcc.target%2Farm%2Fbfloat16_simd_2_1.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/fcfad74515da38bf73d67e2eb76e81a3cd862340/gcc%2Ftestsuite%2Fgcc.target%2Farm%2Fbfloat16_simd_2_1.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgcc.target%2Farm%2Fbfloat16_simd_2_1.c?ref=fcfad74515da38bf73d67e2eb76e81a3cd862340", "patch": "@@ -1,4 +1,5 @@\n /* { dg-do assemble { target { arm*-*-* } } } */\n+/* { dg-require-effective-target arm_hard_ok } */\n /* { dg-require-effective-target arm_v8_neon_ok } */\n /* { dg-require-effective-target arm_v8_2a_bf16_neon_ok } */\n /* { dg-additional-options \"-march=armv8.2-a -mfloat-abi=hard -mfpu=neon-fp-armv8\" } */"}, {"sha": "175bfa5c22738dc38382888089385ad53bc4e5c3", "filename": "gcc/testsuite/gcc.target/arm/bfloat16_simd_2_2.c", "status": "modified", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/fcfad74515da38bf73d67e2eb76e81a3cd862340/gcc%2Ftestsuite%2Fgcc.target%2Farm%2Fbfloat16_simd_2_2.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/fcfad74515da38bf73d67e2eb76e81a3cd862340/gcc%2Ftestsuite%2Fgcc.target%2Farm%2Fbfloat16_simd_2_2.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgcc.target%2Farm%2Fbfloat16_simd_2_2.c?ref=fcfad74515da38bf73d67e2eb76e81a3cd862340", "patch": "@@ -1,4 +1,5 @@\n /* { dg-do assemble { target { arm*-*-* } } } */\n+/* { dg-require-effective-target arm_softfp_ok } */\n /* { dg-require-effective-target arm_v8_neon_ok } */\n /* { dg-require-effective-target arm_v8_2a_bf16_neon_ok } */\n /* { dg-additional-options \"-march=armv8.2-a -mfloat-abi=softfp -mfpu=neon-fp-armv8\" } */"}, {"sha": "d2326c2daf5a8fc4b7fb66d58e419abb8379a0cc", "filename": "gcc/testsuite/gcc.target/arm/bfloat16_simd_3_1.c", "status": "modified", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/fcfad74515da38bf73d67e2eb76e81a3cd862340/gcc%2Ftestsuite%2Fgcc.target%2Farm%2Fbfloat16_simd_3_1.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/fcfad74515da38bf73d67e2eb76e81a3cd862340/gcc%2Ftestsuite%2Fgcc.target%2Farm%2Fbfloat16_simd_3_1.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgcc.target%2Farm%2Fbfloat16_simd_3_1.c?ref=fcfad74515da38bf73d67e2eb76e81a3cd862340", "patch": "@@ -1,4 +1,5 @@\n /* { dg-do assemble { target { arm*-*-* } } } */\n+/* { dg-require-effective-target arm_hard_ok } */\n /* { dg-require-effective-target arm_v8_neon_ok } */\n /* { dg-require-effective-target arm_v8_2a_bf16_neon_ok } */\n /* { dg-additional-options \"-march=armv8.2-a -mfloat-abi=hard -mfpu=neon-fp-armv8\" } */"}, {"sha": "346253b8a47dcd322f74d6bb6b63b45c64acd2ca", "filename": "gcc/testsuite/gcc.target/arm/bfloat16_simd_3_2.c", "status": "modified", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/fcfad74515da38bf73d67e2eb76e81a3cd862340/gcc%2Ftestsuite%2Fgcc.target%2Farm%2Fbfloat16_simd_3_2.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/fcfad74515da38bf73d67e2eb76e81a3cd862340/gcc%2Ftestsuite%2Fgcc.target%2Farm%2Fbfloat16_simd_3_2.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgcc.target%2Farm%2Fbfloat16_simd_3_2.c?ref=fcfad74515da38bf73d67e2eb76e81a3cd862340", "patch": "@@ -1,4 +1,5 @@\n /* { dg-do assemble { target { arm*-*-* } } } */\n+/* { dg-require-effective-target arm_softfp_ok } */\n /* { dg-require-effective-target arm_v8_neon_ok } */\n /* { dg-require-effective-target arm_v8_2a_bf16_neon_ok } */\n /* { dg-additional-options \"-march=armv8.2-a -mfloat-abi=softfp -mfpu=neon-fp-armv8\" } */"}, {"sha": "c06da486316dfb0d3fc994fc9099a0623a7974ff", "filename": "gcc/testsuite/gcc.target/arm/pr51968.c", "status": "modified", "additions": 2, "deletions": 1, "changes": 3, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/fcfad74515da38bf73d67e2eb76e81a3cd862340/gcc%2Ftestsuite%2Fgcc.target%2Farm%2Fpr51968.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/fcfad74515da38bf73d67e2eb76e81a3cd862340/gcc%2Ftestsuite%2Fgcc.target%2Farm%2Fpr51968.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgcc.target%2Farm%2Fpr51968.c?ref=fcfad74515da38bf73d67e2eb76e81a3cd862340", "patch": "@@ -1,7 +1,8 @@\n /* PR target/51968 */\n /* { dg-do compile } */\n-/* { dg-options \"-O2 -march=armv7-a -mfloat-abi=softfp -mfpu=neon\" } */\n+/* { dg-require-effective-target arm_softfp_ok } */\n /* { dg-require-effective-target arm_neon_ok } */\n+/* { dg-options \"-O2 -march=armv7-a -mfloat-abi=softfp -mfpu=neon\" } */\n #include <arm_neon.h>\n \n struct T { int8x8x2_t val; };"}, {"sha": "4d916149ac38f57f194e8ca796e02b87a5e1edf4", "filename": "gcc/testsuite/gcc.target/arm/simd/bf16_vldn_1.c", "status": "modified", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/fcfad74515da38bf73d67e2eb76e81a3cd862340/gcc%2Ftestsuite%2Fgcc.target%2Farm%2Fsimd%2Fbf16_vldn_1.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/fcfad74515da38bf73d67e2eb76e81a3cd862340/gcc%2Ftestsuite%2Fgcc.target%2Farm%2Fsimd%2Fbf16_vldn_1.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgcc.target%2Farm%2Fsimd%2Fbf16_vldn_1.c?ref=fcfad74515da38bf73d67e2eb76e81a3cd862340", "patch": "@@ -1,4 +1,5 @@\n /* { dg-do assemble } */\n+/* { dg-require-effective-target arm_hard_ok } */\n /* { dg-require-effective-target arm_v8_2a_bf16_neon_ok } */\n /* { dg-add-options arm_v8_2a_bf16_neon } */\n /* { dg-additional-options \"-save-temps -O2 -mfloat-abi=hard\" }  */"}, {"sha": "5c6cdd5e43e5079f2e09fd8e53b9bc8173fdb71b", "filename": "gcc/testsuite/gcc.target/arm/simd/bf16_vstn_1.c", "status": "modified", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/fcfad74515da38bf73d67e2eb76e81a3cd862340/gcc%2Ftestsuite%2Fgcc.target%2Farm%2Fsimd%2Fbf16_vstn_1.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/fcfad74515da38bf73d67e2eb76e81a3cd862340/gcc%2Ftestsuite%2Fgcc.target%2Farm%2Fsimd%2Fbf16_vstn_1.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgcc.target%2Farm%2Fsimd%2Fbf16_vstn_1.c?ref=fcfad74515da38bf73d67e2eb76e81a3cd862340", "patch": "@@ -1,4 +1,5 @@\n /* { dg-do assemble } */\n+/* { dg-require-effective-target arm_hard_ok } */\n /* { dg-require-effective-target arm_v8_2a_bf16_neon_ok } */\n /* { dg-add-options arm_v8_2a_bf16_neon } */\n /* { dg-additional-options \"-save-temps -O2 -mfloat-abi=hard\" }  */"}]}