{"sha": "55c195fa1fc12b2273367c475e6851b2059e5701", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6NTVjMTk1ZmExZmMxMmIyMjczMzY3YzQ3NWU2ODUxYjIwNTllNTcwMQ==", "commit": {"author": {"name": "Aldy Hernandez", "email": "aldyh@redhat.com", "date": "2012-09-10T17:21:17Z"}, "committer": {"name": "Aldy Hernandez", "email": "aldyh@gcc.gnu.org", "date": "2012-09-10T17:21:17Z"}, "message": "pr52558-2.c: Delete.\n\ntestsuite/\n        * gcc.dg/pr52558-2.c: Delete.\n        * gcc.dg/simulate-thread/speculative-store-3.c: New.\n\nFrom-SVN: r191153", "tree": {"sha": "e0a863cc88e70a4bdcdec378ba293fb04006a982", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/e0a863cc88e70a4bdcdec378ba293fb04006a982"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/55c195fa1fc12b2273367c475e6851b2059e5701", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/55c195fa1fc12b2273367c475e6851b2059e5701", "html_url": "https://github.com/Rust-GCC/gccrs/commit/55c195fa1fc12b2273367c475e6851b2059e5701", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/55c195fa1fc12b2273367c475e6851b2059e5701/comments", "author": {"login": "aldyh", "id": 12937877, "node_id": "MDQ6VXNlcjEyOTM3ODc3", "avatar_url": "https://avatars.githubusercontent.com/u/12937877?v=4", "gravatar_id": "", "url": "https://api.github.com/users/aldyh", "html_url": "https://github.com/aldyh", "followers_url": "https://api.github.com/users/aldyh/followers", "following_url": "https://api.github.com/users/aldyh/following{/other_user}", "gists_url": "https://api.github.com/users/aldyh/gists{/gist_id}", "starred_url": "https://api.github.com/users/aldyh/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/aldyh/subscriptions", "organizations_url": "https://api.github.com/users/aldyh/orgs", "repos_url": "https://api.github.com/users/aldyh/repos", "events_url": "https://api.github.com/users/aldyh/events{/privacy}", "received_events_url": "https://api.github.com/users/aldyh/received_events", "type": "User", "site_admin": false}, "committer": null, "parents": [{"sha": "84c3c7ce881a20095532baff121d38848efe2a0a", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/84c3c7ce881a20095532baff121d38848efe2a0a", "html_url": "https://github.com/Rust-GCC/gccrs/commit/84c3c7ce881a20095532baff121d38848efe2a0a"}], "stats": {"total": 99, "additions": 76, "deletions": 23}, "files": [{"sha": "948f3c5c102493729839e8eb44df8495ab569f16", "filename": "gcc/testsuite/ChangeLog", "status": "modified", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/55c195fa1fc12b2273367c475e6851b2059e5701/gcc%2Ftestsuite%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/55c195fa1fc12b2273367c475e6851b2059e5701/gcc%2Ftestsuite%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2FChangeLog?ref=55c195fa1fc12b2273367c475e6851b2059e5701", "patch": "@@ -17,6 +17,11 @@\n \tPR fortran/54208\n \t* gfortran.dg/bound_simplification_3.f90: New test.\n \n+2012-09-07  Aldy Hernandez  <aldyh@redhat.com>\n+\n+\t* gcc.dg/pr52558-2.c: Delete.\n+\t* gcc.dg/simulate-thread/speculative-store-3.c: New.\n+\n 2012-09-07  Aldy Hernandez  <aldyh@redhat.com>\n \n \tPR testsuite/54184"}, {"sha": "6d5f51c4f0c4f830c08de62d547ca64b02de0919", "filename": "gcc/testsuite/gcc.dg/pr52558-2.c", "status": "removed", "additions": 0, "deletions": 23, "changes": 23, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/84c3c7ce881a20095532baff121d38848efe2a0a/gcc%2Ftestsuite%2Fgcc.dg%2Fpr52558-2.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/84c3c7ce881a20095532baff121d38848efe2a0a/gcc%2Ftestsuite%2Fgcc.dg%2Fpr52558-2.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgcc.dg%2Fpr52558-2.c?ref=84c3c7ce881a20095532baff121d38848efe2a0a", "patch": "@@ -1,23 +0,0 @@\n-/* { dg-do compile } */\n-/* { dg-options \"--param allow-store-data-races=0 -O2 -fdump-tree-lim1\" } */\n-\n-/* Test that g_2 is not written to unless !g_1.  */\n-\n-int g_1 = 1;\n-int g_2 = 0;\n-\n-int func_1(void)\n-{\n- int l;\n- for (l = 0; l < 1234; l++)\n- {\n-   if (g_1)\n-     return l;\n-   else\n-     g_2 = 0;\n- }\n- return 999;\n-}\n-\n-/* { dg-final { scan-tree-dump-times \"MEM.*g_2_lsm_flag\" 1 \"lim1\" } } */\n-/* { dg-final { cleanup-tree-dump \"lim1\" } } */"}, {"sha": "203c026048d4be65e6ee22756c69559fb5cf65ab", "filename": "gcc/testsuite/gcc.dg/simulate-thread/speculative-store-3.c", "status": "added", "additions": 71, "deletions": 0, "changes": 71, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/55c195fa1fc12b2273367c475e6851b2059e5701/gcc%2Ftestsuite%2Fgcc.dg%2Fsimulate-thread%2Fspeculative-store-3.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/55c195fa1fc12b2273367c475e6851b2059e5701/gcc%2Ftestsuite%2Fgcc.dg%2Fsimulate-thread%2Fspeculative-store-3.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgcc.dg%2Fsimulate-thread%2Fspeculative-store-3.c?ref=55c195fa1fc12b2273367c475e6851b2059e5701", "patch": "@@ -0,0 +1,71 @@\n+/* { dg-do link } */\n+/* { dg-options \"--param allow-store-data-races=0 -O2\" } */\n+/* { dg-final { simulate-thread } } */\n+\n+#include <stdio.h>\n+#include <stdlib.h>\n+\n+#include \"simulate-thread.h\"\n+\n+/* Test distilled from PR52558.  */\n+\n+int g_1 = 1;\n+int g_2 = 0, insns = 0;\n+int f;\n+\n+/* Test that g_2 is not written to unless !g_1.  */\n+\n+__attribute__((noinline))\n+int funky()\n+{\n+  int l;\n+  for (l = 0; l != 4; l++)\n+    {\n+      if (g_1)\n+\t{\n+\t  /* g_1 is globally true so we should always execute here,\n+\t     thus never writing to g_2 under any circumstance in this\n+\t     code path.  */\n+\t  return l;\n+\t}\n+      for (g_2 = 0; g_2 >= 26; ++g_2)\n+\t;\n+    }\n+  return 999;\n+}\n+\n+int simulate_thread_final_verify ()\n+{\n+  /* If g_2 != insns, someone must have cached `g_2' and stored a\n+     racy value into it.  */\n+  if (g_2 != insns)\n+    {\n+      printf(\"FAIL: g_2 was incorrectly cached\\n\");\n+      return 1;\n+    }\n+  return 0;\n+}\n+\n+void simulate_thread_other_threads ()\n+{\n+  ++insns;\n+  ++g_2;\n+}\n+\n+int simulate_thread_step_verify ()\n+{\n+  return 0;\n+}\n+\n+__attribute__((noinline))\n+void simulate_thread_main()\n+{\n+  f = funky();\n+}\n+\n+int main()\n+{\n+  simulate_thread_main ();\n+  simulate_thread_done ();\n+  return 0;\n+}"}]}