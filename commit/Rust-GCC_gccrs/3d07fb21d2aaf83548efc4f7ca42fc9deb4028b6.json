{"sha": "3d07fb21d2aaf83548efc4f7ca42fc9deb4028b6", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6M2QwN2ZiMjFkMmFhZjgzNTQ4ZWZjNGY3Y2E0MmZjOWRlYjQwMjhiNg==", "commit": {"author": {"name": "Steven G. Kargl", "email": "kargl@gcc.gnu.org", "date": "2018-12-11T23:13:19Z"}, "committer": {"name": "Steven G. Kargl", "email": "kargl@gcc.gnu.org", "date": "2018-12-11T23:13:19Z"}, "message": "re PR fortran/88249 (ICE in gfc_resolve_filepos, at fortran/io.c:2853)\n\n2018-12-11  Steven G. Kargl  <kargl@gcc.gnu.org>\n\n\tPR fortran/88249\n\t* gfortran.h: Update prototype for gfc_resolve_filepos().\n\t* io.c (gfc_resolve_filepos): Check for UNIT number if ERR= is present.\n\tUse passed in locus for error message.\n\t* resolve.c (gfc_resolve_code): Pass locus in gfc_resolve_filepos()\n\tcall.\n\n2018-12-11  Steven G. Kargl  <kargl@gcc.gnu.org>\n\n\tPR fortran/88249\n\t* gfortran.dg/pr88249.f90: New test.\n\nFrom-SVN: r267035", "tree": {"sha": "9d1f2cbf8af8c12e601d7acd76e402e6e4c9d88b", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/9d1f2cbf8af8c12e601d7acd76e402e6e4c9d88b"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/3d07fb21d2aaf83548efc4f7ca42fc9deb4028b6", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/3d07fb21d2aaf83548efc4f7ca42fc9deb4028b6", "html_url": "https://github.com/Rust-GCC/gccrs/commit/3d07fb21d2aaf83548efc4f7ca42fc9deb4028b6", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/3d07fb21d2aaf83548efc4f7ca42fc9deb4028b6/comments", "author": null, "committer": null, "parents": [{"sha": "3b31a906085899ffea090ef9945ffda785dcad78", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/3b31a906085899ffea090ef9945ffda785dcad78", "html_url": "https://github.com/Rust-GCC/gccrs/commit/3b31a906085899ffea090ef9945ffda785dcad78"}], "stats": {"total": 38, "additions": 29, "deletions": 9}, "files": [{"sha": "945bb23e369ba443cc1a32ce1ca21e44903fed23", "filename": "gcc/fortran/ChangeLog", "status": "modified", "additions": 9, "deletions": 0, "changes": 9, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/3d07fb21d2aaf83548efc4f7ca42fc9deb4028b6/gcc%2Ffortran%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/3d07fb21d2aaf83548efc4f7ca42fc9deb4028b6/gcc%2Ffortran%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ffortran%2FChangeLog?ref=3d07fb21d2aaf83548efc4f7ca42fc9deb4028b6", "patch": "@@ -1,3 +1,12 @@\n+2018-12-11  Steven G. Kargl  <kargl@gcc.gnu.org>\n+\n+\tPR fortran/88249\n+\t* gfortran.h: Update prototype for gfc_resolve_filepos().\n+\t* io.c (gfc_resolve_filepos): Check for UNIT number if ERR= is present.\n+\tUse passed in locus for error message.\n+\t* resolve.c (gfc_resolve_code): Pass locus in gfc_resolve_filepos()\n+\tcall.\n+\n 2018-12-10  Steven G. Kargl  <kargl@gcc.gnu.org>\n \n \tPR fortran/97922"}, {"sha": "fd0bc36fee1276bb0c87ba8501d2388445dc407c", "filename": "gcc/fortran/gfortran.h", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/3d07fb21d2aaf83548efc4f7ca42fc9deb4028b6/gcc%2Ffortran%2Fgfortran.h", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/3d07fb21d2aaf83548efc4f7ca42fc9deb4028b6/gcc%2Ffortran%2Fgfortran.h", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ffortran%2Fgfortran.h?ref=3d07fb21d2aaf83548efc4f7ca42fc9deb4028b6", "patch": "@@ -3395,7 +3395,7 @@ bool gfc_resolve_open (gfc_open *);\n void gfc_free_close (gfc_close *);\n bool gfc_resolve_close (gfc_close *);\n void gfc_free_filepos (gfc_filepos *);\n-bool gfc_resolve_filepos (gfc_filepos *);\n+bool gfc_resolve_filepos (gfc_filepos *, locus *);\n void gfc_free_inquire (gfc_inquire *);\n bool gfc_resolve_inquire (gfc_inquire *);\n void gfc_free_dt (gfc_dt *);"}, {"sha": "9c3e6892a07b0295d634c7cb3aed6173fc79ab52", "filename": "gcc/fortran/io.c", "status": "modified", "additions": 6, "deletions": 7, "changes": 13, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/3d07fb21d2aaf83548efc4f7ca42fc9deb4028b6/gcc%2Ffortran%2Fio.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/3d07fb21d2aaf83548efc4f7ca42fc9deb4028b6/gcc%2Ffortran%2Fio.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ffortran%2Fio.c?ref=3d07fb21d2aaf83548efc4f7ca42fc9deb4028b6", "patch": "@@ -2849,22 +2849,21 @@ match_filepos (gfc_statement st, gfc_exec_op op)\n \n \n bool\n-gfc_resolve_filepos (gfc_filepos *fp)\n+gfc_resolve_filepos (gfc_filepos *fp, locus *where)\n {\n   RESOLVE_TAG (&tag_unit, fp->unit);\n   RESOLVE_TAG (&tag_iostat, fp->iostat);\n   RESOLVE_TAG (&tag_iomsg, fp->iomsg);\n-  if (!gfc_reference_st_label (fp->err, ST_LABEL_TARGET))\n-    return false;\n \n-  if (!fp->unit && (fp->iostat || fp->iomsg))\n+  if (!fp->unit && (fp->iostat || fp->iomsg || fp->err))\n     {\n-      locus where;\n-      where = fp->iostat ? fp->iostat->where : fp->iomsg->where;\n-      gfc_error (\"UNIT number missing in statement at %L\", &where);\n+      gfc_error (\"UNIT number missing in statement at %L\", where);\n       return false;\n     }\n \n+  if (!gfc_reference_st_label (fp->err, ST_LABEL_TARGET))\n+    return false;\n+\n   if (fp->unit->expr_type == EXPR_CONSTANT\n       && fp->unit->ts.type == BT_INTEGER\n       && mpz_sgn (fp->unit->value.integer) < 0)"}, {"sha": "dd705ed1bbfebbe90289e5cfbec651c955bc09cc", "filename": "gcc/fortran/resolve.c", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/3d07fb21d2aaf83548efc4f7ca42fc9deb4028b6/gcc%2Ffortran%2Fresolve.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/3d07fb21d2aaf83548efc4f7ca42fc9deb4028b6/gcc%2Ffortran%2Fresolve.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ffortran%2Fresolve.c?ref=3d07fb21d2aaf83548efc4f7ca42fc9deb4028b6", "patch": "@@ -11545,7 +11545,7 @@ gfc_resolve_code (gfc_code *code, gfc_namespace *ns)\n \tcase EXEC_ENDFILE:\n \tcase EXEC_REWIND:\n \tcase EXEC_FLUSH:\n-\t  if (!gfc_resolve_filepos (code->ext.filepos))\n+\t  if (!gfc_resolve_filepos (code->ext.filepos, &code->loc))\n \t    break;\n \n \t  resolve_branch (code->ext.filepos->err, code);"}, {"sha": "8c04149484cee36889fa8c77b73f3435c23f3446", "filename": "gcc/testsuite/ChangeLog", "status": "modified", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/3d07fb21d2aaf83548efc4f7ca42fc9deb4028b6/gcc%2Ftestsuite%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/3d07fb21d2aaf83548efc4f7ca42fc9deb4028b6/gcc%2Ftestsuite%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2FChangeLog?ref=3d07fb21d2aaf83548efc4f7ca42fc9deb4028b6", "patch": "@@ -1,3 +1,8 @@\n+2018-12-11  Steven G. Kargl  <kargl@gcc.gnu.org>\n+\n+\tPR fortran/88249\n+\t* gfortran.dg/pr88249.f90: New test.\n+\n 2018-12-11  Jakub Jelinek  <jakub@redhat.com>\n \n \tPR tree-optimization/80520"}, {"sha": "401fb3514e78eec52db0f36c2f3366675317c56b", "filename": "gcc/testsuite/gfortran.dg/pr88249.f90", "status": "added", "additions": 7, "deletions": 0, "changes": 7, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/3d07fb21d2aaf83548efc4f7ca42fc9deb4028b6/gcc%2Ftestsuite%2Fgfortran.dg%2Fpr88249.f90", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/3d07fb21d2aaf83548efc4f7ca42fc9deb4028b6/gcc%2Ftestsuite%2Fgfortran.dg%2Fpr88249.f90", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgfortran.dg%2Fpr88249.f90?ref=3d07fb21d2aaf83548efc4f7ca42fc9deb4028b6", "patch": "@@ -0,0 +1,7 @@\n+! { dg-do compile }\n+program p\n+   backspace (err=1) ! { dg-error \"UNIT number missing\" }\n+   endfile (err=1)   ! { dg-error \"UNIT number missing\" }\n+   flush (err=1)     ! { dg-error \"UNIT number missing\" }\n+   rewind (err=1)    ! { dg-error \"UNIT number missing\" }\n+end"}]}