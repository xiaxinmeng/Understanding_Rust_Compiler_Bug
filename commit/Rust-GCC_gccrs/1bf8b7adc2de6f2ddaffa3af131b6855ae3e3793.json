{"sha": "1bf8b7adc2de6f2ddaffa3af131b6855ae3e3793", "node_id": "C_kwDOANBUbNoAKDFiZjhiN2FkYzJkZTZmMmRkYWZmYTNhZjEzMWI2ODU1YWUzZTM3OTM", "commit": {"author": {"name": "Jakub Jelinek", "email": "jakub@redhat.com", "date": "2022-09-06T07:21:10Z"}, "committer": {"name": "Jakub Jelinek", "email": "jakub@redhat.com", "date": "2022-09-06T07:23:40Z"}, "message": "openmp: Fix ICE when splitting invalid depend(source)/depend(sink:vec)\n\nAs we now create OMP_CLAUSE_DOACROSS rather than OMP_CLAUSE_DEPEND when\ndepend is used with source/sink modifiers, c_omp_split_clauses can see\nOMP_CLAUSE_DOACROSS clause too before we diagnose it as erroneous.\n\nThe following patch treats it like OMP_CLAUSE_DEPEND during\nthe splitting but adds an assertion.\n\n2022-09-06  Jakub Jelinek  <jakub@redhat.com>\n\n\tPR c/106836\n\t* c-omp.cc (c_omp_split_clauses): Handle OMP_CLAUSE_DOACROSS.\n\n\t* c-c++-common/gomp/pr106836.c: New test.", "tree": {"sha": "816196f88a6aa7020a272147fcf97d5a0163efbc", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/816196f88a6aa7020a272147fcf97d5a0163efbc"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/1bf8b7adc2de6f2ddaffa3af131b6855ae3e3793", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/1bf8b7adc2de6f2ddaffa3af131b6855ae3e3793", "html_url": "https://github.com/Rust-GCC/gccrs/commit/1bf8b7adc2de6f2ddaffa3af131b6855ae3e3793", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/1bf8b7adc2de6f2ddaffa3af131b6855ae3e3793/comments", "author": {"login": "jakubjelinek", "id": 9370665, "node_id": "MDQ6VXNlcjkzNzA2NjU=", "avatar_url": "https://avatars.githubusercontent.com/u/9370665?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jakubjelinek", "html_url": "https://github.com/jakubjelinek", "followers_url": "https://api.github.com/users/jakubjelinek/followers", "following_url": "https://api.github.com/users/jakubjelinek/following{/other_user}", "gists_url": "https://api.github.com/users/jakubjelinek/gists{/gist_id}", "starred_url": "https://api.github.com/users/jakubjelinek/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jakubjelinek/subscriptions", "organizations_url": "https://api.github.com/users/jakubjelinek/orgs", "repos_url": "https://api.github.com/users/jakubjelinek/repos", "events_url": "https://api.github.com/users/jakubjelinek/events{/privacy}", "received_events_url": "https://api.github.com/users/jakubjelinek/received_events", "type": "User", "site_admin": false}, "committer": {"login": "jakubjelinek", "id": 9370665, "node_id": "MDQ6VXNlcjkzNzA2NjU=", "avatar_url": "https://avatars.githubusercontent.com/u/9370665?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jakubjelinek", "html_url": "https://github.com/jakubjelinek", "followers_url": "https://api.github.com/users/jakubjelinek/followers", "following_url": "https://api.github.com/users/jakubjelinek/following{/other_user}", "gists_url": "https://api.github.com/users/jakubjelinek/gists{/gist_id}", "starred_url": "https://api.github.com/users/jakubjelinek/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jakubjelinek/subscriptions", "organizations_url": "https://api.github.com/users/jakubjelinek/orgs", "repos_url": "https://api.github.com/users/jakubjelinek/repos", "events_url": "https://api.github.com/users/jakubjelinek/events{/privacy}", "received_events_url": "https://api.github.com/users/jakubjelinek/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "bc1bc808d860c013318a3f126dc69cb894cb3e11", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/bc1bc808d860c013318a3f126dc69cb894cb3e11", "html_url": "https://github.com/Rust-GCC/gccrs/commit/bc1bc808d860c013318a3f126dc69cb894cb3e11"}], "stats": {"total": 15, "additions": 15, "deletions": 0}, "files": [{"sha": "1b086d805813fa6e5e618e122ae37ad920538ea4", "filename": "gcc/c-family/c-omp.cc", "status": "modified", "additions": 6, "deletions": 0, "changes": 6, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/1bf8b7adc2de6f2ddaffa3af131b6855ae3e3793/gcc%2Fc-family%2Fc-omp.cc", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/1bf8b7adc2de6f2ddaffa3af131b6855ae3e3793/gcc%2Fc-family%2Fc-omp.cc", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fc-family%2Fc-omp.cc?ref=1bf8b7adc2de6f2ddaffa3af131b6855ae3e3793", "patch": "@@ -1877,6 +1877,12 @@ c_omp_split_clauses (location_t loc, enum tree_code code,\n \tcase OMP_CLAUSE_DEPEND:\n \t  s = C_OMP_CLAUSE_SPLIT_TARGET;\n \t  break;\n+\tcase OMP_CLAUSE_DOACROSS:\n+\t  /* This can happen with invalid depend(source) or\n+\t     depend(sink:vec) on target combined with other constructs.  */\n+\t  gcc_assert (OMP_CLAUSE_DOACROSS_DEPEND (clauses));\n+\t  s = C_OMP_CLAUSE_SPLIT_TARGET;\n+\t  break;\n \tcase OMP_CLAUSE_NUM_TEAMS:\n \t  s = C_OMP_CLAUSE_SPLIT_TEAMS;\n \t  break;"}, {"sha": "6df8250f81c3b3698640e7ea786421bac6197623", "filename": "gcc/testsuite/c-c++-common/gomp/pr106836.c", "status": "added", "additions": 9, "deletions": 0, "changes": 9, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/1bf8b7adc2de6f2ddaffa3af131b6855ae3e3793/gcc%2Ftestsuite%2Fc-c%2B%2B-common%2Fgomp%2Fpr106836.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/1bf8b7adc2de6f2ddaffa3af131b6855ae3e3793/gcc%2Ftestsuite%2Fc-c%2B%2B-common%2Fgomp%2Fpr106836.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fc-c%2B%2B-common%2Fgomp%2Fpr106836.c?ref=1bf8b7adc2de6f2ddaffa3af131b6855ae3e3793", "patch": "@@ -0,0 +1,9 @@\n+/* PR c/106836 */\n+\n+void\n+foo (void)\n+{\n+#pragma omp target parallel depend (source)\t/* { dg-error \"'depend\\\\\\(source\\\\\\)' is only allowed in 'omp ordered'\" } */\n+  ;\n+#pragma omp taskwait\n+}"}]}