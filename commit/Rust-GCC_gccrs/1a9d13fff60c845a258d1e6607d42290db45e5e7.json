{"sha": "1a9d13fff60c845a258d1e6607d42290db45e5e7", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6MWE5ZDEzZmZmNjBjODQ1YTI1OGQxZTY2MDdkNDIyOTBkYjQ1ZTVlNw==", "commit": {"author": {"name": "Eric Botcazou", "email": "ebotcazou@adacore.com", "date": "2021-04-09T11:29:44Z"}, "committer": {"name": "Pierre-Marie de Rodat", "email": "derodat@adacore.com", "date": "2021-06-29T14:23:46Z"}, "message": "[Ada] Further adjustment and optimization of System.Value_N\n\ngcc/ada/\n\n\t* rtsfind.ads (RE_Id): Change RE_Valid_Enumeration_Value_NN into\n\tRE_Valid_Value_Enumeration_NN.\n\t(RE_Unit_Table): Adjust to above renaming.\n\t* exp_imgv.adb (Expand_Valid_Value_Attribute): Likewise.\n\t* libgnat/s-valuen.ads (Invalid): Remove.\n\t(Value_Enumeration_Pos): Move to...\n\t* libgnat/s-valuen.adb (Value_Enumeration_Pos): ...here.\n\tReturn -1 instead of Invalid.\n\t(Value_Enumeration): Compare against 0 instead of Invalid.\n\t(Valid_Enumeration_Value): Likewise.  Rename to...\n\t(Valid_Value_Enumeration): ...this.\n\t* libgnat/s-vaenu8.ads (Valid_Enumeration_Value_8): Rename into...\n\t(Valid_Value_Enumeration_8): ...this.\n\t* libgnat/s-vaen16.ads (Valid_Enumeration_Value_16): Rename into...\n\t(Valid_Value_Enumeration_16): ...this.\n\t* libgnat/s-vaen32.ads (Valid_Enumeration_Value_32): Rename into...\n\t(Valid_Value_Enumeration_32): ...this.", "tree": {"sha": "e8234d8f2e9799d6c062ee95f52a5eb605db3870", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/e8234d8f2e9799d6c062ee95f52a5eb605db3870"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/1a9d13fff60c845a258d1e6607d42290db45e5e7", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/1a9d13fff60c845a258d1e6607d42290db45e5e7", "html_url": "https://github.com/Rust-GCC/gccrs/commit/1a9d13fff60c845a258d1e6607d42290db45e5e7", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/1a9d13fff60c845a258d1e6607d42290db45e5e7/comments", "author": null, "committer": {"login": "pmderodat", "id": 758452, "node_id": "MDQ6VXNlcjc1ODQ1Mg==", "avatar_url": "https://avatars.githubusercontent.com/u/758452?v=4", "gravatar_id": "", "url": "https://api.github.com/users/pmderodat", "html_url": "https://github.com/pmderodat", "followers_url": "https://api.github.com/users/pmderodat/followers", "following_url": "https://api.github.com/users/pmderodat/following{/other_user}", "gists_url": "https://api.github.com/users/pmderodat/gists{/gist_id}", "starred_url": "https://api.github.com/users/pmderodat/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/pmderodat/subscriptions", "organizations_url": "https://api.github.com/users/pmderodat/orgs", "repos_url": "https://api.github.com/users/pmderodat/repos", "events_url": "https://api.github.com/users/pmderodat/events{/privacy}", "received_events_url": "https://api.github.com/users/pmderodat/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "b9ec951f4318f1ed8d8c8d5477eeb534ad0811ae", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/b9ec951f4318f1ed8d8c8d5477eeb534ad0811ae", "html_url": "https://github.com/Rust-GCC/gccrs/commit/b9ec951f4318f1ed8d8c8d5477eeb534ad0811ae"}], "stats": {"total": 95, "additions": 48, "deletions": 47}, "files": [{"sha": "6e17a5c452a68b0ec07fc5d7bf4d2958f1e3d5ae", "filename": "gcc/ada/exp_imgv.adb", "status": "modified", "additions": 4, "deletions": 4, "changes": 8, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/1a9d13fff60c845a258d1e6607d42290db45e5e7/gcc%2Fada%2Fexp_imgv.adb", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/1a9d13fff60c845a258d1e6607d42290db45e5e7/gcc%2Fada%2Fexp_imgv.adb", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fada%2Fexp_imgv.adb?ref=1a9d13fff60c845a258d1e6607d42290db45e5e7", "patch": "@@ -1439,17 +1439,17 @@ package body Exp_Imgv is\n    begin\n       --  Generate:\n \n-      --     Valid_Enumeration_Value _NN\n+      --     Valid_Value_Enumeration_NN\n       --       (typS, typN'Address, typH'Unrestricted_Access, Num, X)\n \n       Ttyp := Component_Type (Etype (Lit_Indexes (Rtyp)));\n \n       if Ttyp = Standard_Integer_8 then\n-         Func := RE_Valid_Enumeration_Value_8;\n+         Func := RE_Valid_Value_Enumeration_8;\n       elsif Ttyp = Standard_Integer_16 then\n-         Func := RE_Valid_Enumeration_Value_16;\n+         Func := RE_Valid_Value_Enumeration_16;\n       else\n-         Func := RE_Valid_Enumeration_Value_32;\n+         Func := RE_Valid_Value_Enumeration_32;\n       end if;\n \n       Prepend_To (Args,"}, {"sha": "6ea6071f8a8a3c14722de96157ce18e5e9ee475e", "filename": "gcc/ada/libgnat/s-vaen16.ads", "status": "modified", "additions": 2, "deletions": 2, "changes": 4, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/1a9d13fff60c845a258d1e6607d42290db45e5e7/gcc%2Fada%2Flibgnat%2Fs-vaen16.ads", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/1a9d13fff60c845a258d1e6607d42290db45e5e7/gcc%2Fada%2Flibgnat%2Fs-vaen16.ads", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fada%2Flibgnat%2Fs-vaen16.ads?ref=1a9d13fff60c845a258d1e6607d42290db45e5e7", "patch": "@@ -49,13 +49,13 @@ package System.Val_Enum_16 is\n       return    Natural\n      renames Impl.Value_Enumeration;\n \n-   function Valid_Enumeration_Value_16\n+   function Valid_Value_Enumeration_16\n      (Names   : String;\n       Indexes : System.Address;\n       Hash    : Impl.Hash_Function_Ptr;\n       Num     : Natural;\n       Str     : String)\n       return    Boolean\n-     renames Impl.Valid_Enumeration_Value;\n+     renames Impl.Valid_Value_Enumeration;\n \n end System.Val_Enum_16;"}, {"sha": "e1a7644ec72a4a6f11bdcb920186225c71e21f3b", "filename": "gcc/ada/libgnat/s-vaen32.ads", "status": "modified", "additions": 2, "deletions": 2, "changes": 4, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/1a9d13fff60c845a258d1e6607d42290db45e5e7/gcc%2Fada%2Flibgnat%2Fs-vaen32.ads", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/1a9d13fff60c845a258d1e6607d42290db45e5e7/gcc%2Fada%2Flibgnat%2Fs-vaen32.ads", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fada%2Flibgnat%2Fs-vaen32.ads?ref=1a9d13fff60c845a258d1e6607d42290db45e5e7", "patch": "@@ -49,13 +49,13 @@ package System.Val_Enum_32 is\n       return    Natural\n      renames Impl.Value_Enumeration;\n \n-   function Valid_Enumeration_Value_32\n+   function Valid_Value_Enumeration_32\n      (Names   : String;\n       Indexes : System.Address;\n       Hash    : Impl.Hash_Function_Ptr;\n       Num     : Natural;\n       Str     : String)\n       return    Boolean\n-     renames Impl.Valid_Enumeration_Value;\n+     renames Impl.Valid_Value_Enumeration;\n \n end System.Val_Enum_32;"}, {"sha": "395a969db7be0c2c1c01343c77040cd07649d766", "filename": "gcc/ada/libgnat/s-vaenu8.ads", "status": "modified", "additions": 2, "deletions": 2, "changes": 4, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/1a9d13fff60c845a258d1e6607d42290db45e5e7/gcc%2Fada%2Flibgnat%2Fs-vaenu8.ads", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/1a9d13fff60c845a258d1e6607d42290db45e5e7/gcc%2Fada%2Flibgnat%2Fs-vaenu8.ads", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fada%2Flibgnat%2Fs-vaenu8.ads?ref=1a9d13fff60c845a258d1e6607d42290db45e5e7", "patch": "@@ -49,13 +49,13 @@ package System.Val_Enum_8 is\n       return    Natural\n      renames Impl.Value_Enumeration;\n \n-   function Valid_Enumeration_Value_8\n+   function Valid_Value_Enumeration_8\n      (Names   : String;\n       Indexes : System.Address;\n       Hash    : Impl.Hash_Function_Ptr;\n       Num     : Natural;\n       Str     : String)\n       return    Boolean\n-     renames Impl.Valid_Enumeration_Value;\n+     renames Impl.Valid_Value_Enumeration;\n \n end System.Val_Enum_8;"}, {"sha": "ef613a28cf8ef256ee00b12590e140961d9ffae1", "filename": "gcc/ada/libgnat/s-valuen.adb", "status": "modified", "additions": 31, "deletions": 18, "changes": 49, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/1a9d13fff60c845a258d1e6607d42290db45e5e7/gcc%2Fada%2Flibgnat%2Fs-valuen.adb", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/1a9d13fff60c845a258d1e6607d42290db45e5e7/gcc%2Fada%2Flibgnat%2Fs-valuen.adb", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fada%2Flibgnat%2Fs-valuen.adb?ref=1a9d13fff60c845a258d1e6607d42290db45e5e7", "patch": "@@ -35,6 +35,16 @@ with System.Val_Util; use System.Val_Util;\n \n package body System.Value_N is\n \n+   function Value_Enumeration_Pos\n+     (Names   : String;\n+      Indexes : System.Address;\n+      Hash    : Hash_Function_Ptr;\n+      Num     : Natural;\n+      Str     : String)\n+      return    Integer with Pure_Function;\n+   --  Same as Value_Enumeration, except returns negative if Value_Enumeration\n+   --  would raise Constraint_Error.\n+\n    ---------------------------\n    -- Value_Enumeration_Pos --\n    ---------------------------\n@@ -98,9 +108,25 @@ package body System.Value_N is\n          end if;\n       end;\n \n-      return Invalid;\n+      return -1;\n    end Value_Enumeration_Pos;\n \n+   -----------------------------\n+   -- Valid_Value_Enumeration --\n+   -----------------------------\n+\n+   function Valid_Value_Enumeration\n+     (Names   : String;\n+      Indexes : System.Address;\n+      Hash    : Hash_Function_Ptr;\n+      Num     : Natural;\n+      Str     : String)\n+      return    Boolean\n+   is\n+   begin\n+      return Value_Enumeration_Pos (Names, Indexes, Hash, Num, Str) >= 0;\n+   end Valid_Value_Enumeration;\n+\n    -----------------------\n    -- Value_Enumeration --\n    -----------------------\n@@ -115,28 +141,15 @@ package body System.Value_N is\n    is\n       Result : constant Integer :=\n         Value_Enumeration_Pos (Names, Indexes, Hash, Num, Str);\n+\n    begin\n-      if Result = Invalid then\n+      --  The comparison eliminates the need for a range check on return\n+\n+      if Result < 0 then\n          Bad_Value (Str);\n       else\n          return Result;\n       end if;\n    end Value_Enumeration;\n \n-   -----------------------------\n-   -- Valid_Enumeration_Value --\n-   -----------------------------\n-\n-   function Valid_Enumeration_Value\n-     (Names   : String;\n-      Indexes : System.Address;\n-      Hash    : Hash_Function_Ptr;\n-      Num     : Natural;\n-      Str     : String)\n-      return    Boolean\n-   is\n-   begin\n-      return Value_Enumeration_Pos (Names, Indexes, Hash, Num, Str) /= Invalid;\n-   end Valid_Enumeration_Value;\n-\n end System.Value_N;"}, {"sha": "db8ad1d03951c9d75a24a03375b86b739fdecee8", "filename": "gcc/ada/libgnat/s-valuen.ads", "status": "modified", "additions": 1, "deletions": 13, "changes": 14, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/1a9d13fff60c845a258d1e6607d42290db45e5e7/gcc%2Fada%2Flibgnat%2Fs-valuen.ads", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/1a9d13fff60c845a258d1e6607d42290db45e5e7/gcc%2Fada%2Flibgnat%2Fs-valuen.ads", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fada%2Flibgnat%2Fs-valuen.ads?ref=1a9d13fff60c845a258d1e6607d42290db45e5e7", "patch": "@@ -67,7 +67,7 @@ package System.Value_N is\n    --  If the image is found in Names, then the corresponding Pos value is\n    --  returned. If not, Constraint_Error is raised.\n \n-   function Valid_Enumeration_Value\n+   function Valid_Value_Enumeration\n      (Names   : String;\n       Indexes : System.Address;\n       Hash    : Hash_Function_Ptr;\n@@ -79,16 +79,4 @@ package System.Value_N is\n    --  raise Constraint_Error. The parameters have the same meaning as for\n    --  Value_Enumeration.\n \n-   Invalid : constant Integer := -1;\n-\n-   function Value_Enumeration_Pos\n-     (Names   : String;\n-      Indexes : System.Address;\n-      Hash    : Hash_Function_Ptr;\n-      Num     : Natural;\n-      Str     : String)\n-      return    Integer with Pure_Function;\n-   --  Same as Value_Enumeration, except returns Invalid if Value_Enumeration\n-   --  would raise Constraint_Error.\n-\n end System.Value_N;"}, {"sha": "ad84e9e761e8c1a8c01fa0bd1b75796a0991d7dc", "filename": "gcc/ada/rtsfind.ads", "status": "modified", "additions": 6, "deletions": 6, "changes": 12, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/1a9d13fff60c845a258d1e6607d42290db45e5e7/gcc%2Fada%2Frtsfind.ads", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/1a9d13fff60c845a258d1e6607d42290db45e5e7/gcc%2Fada%2Frtsfind.ads", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fada%2Frtsfind.ads?ref=1a9d13fff60c845a258d1e6607d42290db45e5e7", "patch": "@@ -2040,9 +2040,9 @@ package Rtsfind is\n      RE_Value_Enumeration_16,            -- System.Val_Enum_16\n      RE_Value_Enumeration_32,            -- System.Val_Enum_32\n \n-     RE_Valid_Enumeration_Value_8,       -- System.Val_Enum_8\n-     RE_Valid_Enumeration_Value_16,      -- System.Val_Enum_16\n-     RE_Valid_Enumeration_Value_32,      -- System.Val_Enum_32\n+     RE_Valid_Value_Enumeration_8,       -- System.Val_Enum_8\n+     RE_Valid_Value_Enumeration_16,      -- System.Val_Enum_16\n+     RE_Valid_Value_Enumeration_32,      -- System.Val_Enum_32\n \n      RE_Value_Fixed32,                   -- System_Val_Fixed_32\n \n@@ -3731,11 +3731,11 @@ package Rtsfind is\n \n      RE_Value_Enumeration_32             => System_Val_Enum_32,\n \n-     RE_Valid_Enumeration_Value_8        => System_Val_Enum_8,\n+     RE_Valid_Value_Enumeration_8        => System_Val_Enum_8,\n \n-     RE_Valid_Enumeration_Value_16       => System_Val_Enum_16,\n+     RE_Valid_Value_Enumeration_16       => System_Val_Enum_16,\n \n-     RE_Valid_Enumeration_Value_32       => System_Val_Enum_32,\n+     RE_Valid_Value_Enumeration_32       => System_Val_Enum_32,\n \n      RE_Value_Fixed32                    => System_Val_Fixed_32,\n "}]}