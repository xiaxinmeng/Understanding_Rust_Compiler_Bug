{"sha": "abbdb623c4287baad6e5bff1ae694ef30264519c", "node_id": "C_kwDOANBUbNoAKGFiYmRiNjIzYzQyODdiYWFkNmU1YmZmMWFlNjk0ZWYzMDI2NDUxOWM", "commit": {"author": {"name": "Hans-Peter Nilsson", "email": "hp@axis.com", "date": "2023-02-15T00:09:06Z"}, "committer": {"name": "Hans-Peter Nilsson", "email": "hp@bitrange.com", "date": "2023-02-15T00:09:06Z"}, "message": "debug: Support \"phrs\" for dumping a HARD_REG_SET\n\nThe debug-function in sel-sched-dump.cc that would be\nsuitable for a hookup to a command in gdb is guarded by\n#ifdef INSN_SCHEDULING, thus can't be used for all targets.\nBetter move the function marked DEBUG_FUNCTION elsewhere,\nhere to a file with a suitable static function to call.\n\nThere are multiple sets of similar functions dumping\nHARD_REG_SETs, but cleaning that up is better left to a\nseparate commit.\n\ngcc:\n\t* gdbinit.in (phrs): New command.\n\t* sel-sched-dump.cc (debug_hard_reg_set): Remove debug-function.\n\t* ira-color.cc (debug_hard_reg_set): New, calling print_hard_reg_set.", "tree": {"sha": "426a31a1cca30564c7c284eaf434a3d66a8aec1d", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/426a31a1cca30564c7c284eaf434a3d66a8aec1d"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/abbdb623c4287baad6e5bff1ae694ef30264519c", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/abbdb623c4287baad6e5bff1ae694ef30264519c", "html_url": "https://github.com/Rust-GCC/gccrs/commit/abbdb623c4287baad6e5bff1ae694ef30264519c", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/abbdb623c4287baad6e5bff1ae694ef30264519c/comments", "author": {"login": "hpataxisdotcom", "id": 80339731, "node_id": "MDQ6VXNlcjgwMzM5NzMx", "avatar_url": "https://avatars.githubusercontent.com/u/80339731?v=4", "gravatar_id": "", "url": "https://api.github.com/users/hpataxisdotcom", "html_url": "https://github.com/hpataxisdotcom", "followers_url": "https://api.github.com/users/hpataxisdotcom/followers", "following_url": "https://api.github.com/users/hpataxisdotcom/following{/other_user}", "gists_url": "https://api.github.com/users/hpataxisdotcom/gists{/gist_id}", "starred_url": "https://api.github.com/users/hpataxisdotcom/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/hpataxisdotcom/subscriptions", "organizations_url": "https://api.github.com/users/hpataxisdotcom/orgs", "repos_url": "https://api.github.com/users/hpataxisdotcom/repos", "events_url": "https://api.github.com/users/hpataxisdotcom/events{/privacy}", "received_events_url": "https://api.github.com/users/hpataxisdotcom/received_events", "type": "User", "site_admin": false}, "committer": null, "parents": [{"sha": "cce62625025380c2ea2a220deb10f8f355f83abf", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/cce62625025380c2ea2a220deb10f8f355f83abf", "html_url": "https://github.com/Rust-GCC/gccrs/commit/cce62625025380c2ea2a220deb10f8f355f83abf"}], "stats": {"total": 29, "additions": 19, "deletions": 10}, "files": [{"sha": "a76079a46af71a62ea6a496c9037a108e5991e23", "filename": "gcc/gdbinit.in", "status": "modified", "additions": 12, "deletions": 0, "changes": 12, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/abbdb623c4287baad6e5bff1ae694ef30264519c/gcc%2Fgdbinit.in", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/abbdb623c4287baad6e5bff1ae694ef30264519c/gcc%2Fgdbinit.in", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fgdbinit.in?ref=abbdb623c4287baad6e5bff1ae694ef30264519c", "patch": "@@ -31,6 +31,7 @@ GCC gdbinit file introduces several debugging shorthands:\n     pdd [dw_die_ref],\n     pbm [bitmap],\n     pel [location_t],\n+    phrs [HARD_REG_SET]\n     pp, pbs, pcfun\n \n They are generally implemented by calling a function that prints to stderr,\n@@ -145,6 +146,17 @@ Print given GENERIC expression in C syntax.\n See also 'help-gcc-hooks'.\n end\n \n+define phrs\n+eval \"set $debug_arg = $%s\", $argc ? \"arg0\" : \"\"\n+call debug_hard_reg_set ($debug_arg)\n+end\n+\n+document phrs\n+GCC hook: debug_hard_reg_set (HARD_REG_SET)\n+Print given HARD_REG_SET.\n+See also 'help-gcc-hooks'.\n+end\n+\n define pmz\n eval \"set $debug_arg = $%s\", $argc ? \"arg0\" : \"\"\n call mpz_out_str(stderr, 10, $debug_arg)"}, {"sha": "1fb2958bddd0d9db75b9eeae525a59cddb693659", "filename": "gcc/ira-color.cc", "status": "modified", "additions": 7, "deletions": 0, "changes": 7, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/abbdb623c4287baad6e5bff1ae694ef30264519c/gcc%2Fira-color.cc", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/abbdb623c4287baad6e5bff1ae694ef30264519c/gcc%2Fira-color.cc", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fira-color.cc?ref=abbdb623c4287baad6e5bff1ae694ef30264519c", "patch": "@@ -512,6 +512,13 @@ print_hard_reg_set (FILE *f, HARD_REG_SET set, bool new_line_p)\n     fprintf (f, \"\\n\");\n }\n \n+/* Dump a hard reg set SET to stderr.  */\n+DEBUG_FUNCTION void\n+debug_hard_reg_set (HARD_REG_SET set)\n+{\n+  print_hard_reg_set (stderr, set, true);\n+}\n+\n /* Print allocno hard register subforest given by ROOTS and its LEVEL\n    to F.  */\n static void"}, {"sha": "05de98409375c0461fbd05157d10a8f0dd5d5001", "filename": "gcc/sel-sched-dump.cc", "status": "modified", "additions": 0, "deletions": 10, "changes": 10, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/abbdb623c4287baad6e5bff1ae694ef30264519c/gcc%2Fsel-sched-dump.cc", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/abbdb623c4287baad6e5bff1ae694ef30264519c/gcc%2Fsel-sched-dump.cc", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fsel-sched-dump.cc?ref=abbdb623c4287baad6e5bff1ae694ef30264519c", "patch": "@@ -986,16 +986,6 @@ debug_blist (blist_t bnds)\n   restore_dump ();\n }\n \n-/* Dump a hard reg set SET to stderr.  */\n-DEBUG_FUNCTION void\n-debug_hard_reg_set (HARD_REG_SET set)\n-{\n-  switch_dump (stderr);\n-  dump_hard_reg_set (\"\", set);\n-  sel_print (\"\\n\");\n-  restore_dump ();\n-}\n-\n /* Debug a cfg region with default flags.  */\n void\n sel_debug_cfg (void)"}]}