{"sha": "ae7f3734d5e1a4aa88fe8b25d553e57d161ee681", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6YWU3ZjM3MzRkNWUxYTRhYTg4ZmU4YjI1ZDU1M2U1N2QxNjFlZTY4MQ==", "commit": {"author": {"name": "Devang Patel", "email": "dpatel@apple.com", "date": "2005-03-31T00:58:26Z"}, "committer": {"name": "Devang Patel", "email": "dpatel@gcc.gnu.org", "date": "2005-03-31T00:58:26Z"}, "message": "tree-sra.c (decide_block_copy): Disable scalarization of sub-elements.\n\n     * tree-sra.c (decide_block_copy): Disable scalarization of sub-elements.\n     * g++.dg/tree-sra/ssa-sra-3.C: New test.\n\nFrom-SVN: r97301", "tree": {"sha": "74da652d261bc868451481842f3c2ef76afa1b8e", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/74da652d261bc868451481842f3c2ef76afa1b8e"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/ae7f3734d5e1a4aa88fe8b25d553e57d161ee681", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/ae7f3734d5e1a4aa88fe8b25d553e57d161ee681", "html_url": "https://github.com/Rust-GCC/gccrs/commit/ae7f3734d5e1a4aa88fe8b25d553e57d161ee681", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/ae7f3734d5e1a4aa88fe8b25d553e57d161ee681/comments", "author": null, "committer": null, "parents": [{"sha": "9ba8c99d67124633c8a423e0b9f6091097779255", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/9ba8c99d67124633c8a423e0b9f6091097779255", "html_url": "https://github.com/Rust-GCC/gccrs/commit/9ba8c99d67124633c8a423e0b9f6091097779255"}], "stats": {"total": 97, "additions": 97, "deletions": 0}, "files": [{"sha": "f144088d9e6e40a7d4ed3d8f7e033bd511a4c0b0", "filename": "gcc/ChangeLog", "status": "modified", "additions": 4, "deletions": 0, "changes": 4, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/ae7f3734d5e1a4aa88fe8b25d553e57d161ee681/gcc%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/ae7f3734d5e1a4aa88fe8b25d553e57d161ee681/gcc%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2FChangeLog?ref=ae7f3734d5e1a4aa88fe8b25d553e57d161ee681", "patch": "@@ -1,3 +1,7 @@\n+2005-03-29  Devang Patel  <dpatel@apple.com>\n+\n+\t* tree-sra.c (decide_block_copy): Disable scalarization of sub-elements.\n+\t\n 2005-03-30  Stuart Hastings  <stuart@apple.com>\n \t    Dale Johannesen  <dalej@apple.com>\n "}, {"sha": "a02d78e5a0755893e1d8c355cca79341df7f179e", "filename": "gcc/testsuite/ChangeLog", "status": "modified", "additions": 4, "deletions": 0, "changes": 4, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/ae7f3734d5e1a4aa88fe8b25d553e57d161ee681/gcc%2Ftestsuite%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/ae7f3734d5e1a4aa88fe8b25d553e57d161ee681/gcc%2Ftestsuite%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2FChangeLog?ref=ae7f3734d5e1a4aa88fe8b25d553e57d161ee681", "patch": "@@ -1,3 +1,7 @@\n+2005-03-30  Devang Patel  <dpatel@apple.com>\n+\n+\t* g++.dg/tree-sra/ssa-sra-3.C: New test.\n+\n 2005-03-30  Dale Johannesen  <dalej@apple.com>\n \n \t* gcc.dg/20020919-1.c:  Remove unnecessary conditional."}, {"sha": "2a2d89c630d2caf5888c15597a6a55225e3a9cf3", "filename": "gcc/testsuite/g++.dg/tree-ssa/ssa-sra-3.C", "status": "added", "additions": 83, "deletions": 0, "changes": 83, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/ae7f3734d5e1a4aa88fe8b25d553e57d161ee681/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Ftree-ssa%2Fssa-sra-3.C", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/ae7f3734d5e1a4aa88fe8b25d553e57d161ee681/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Ftree-ssa%2Fssa-sra-3.C", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Ftree-ssa%2Fssa-sra-3.C?ref=ae7f3734d5e1a4aa88fe8b25d553e57d161ee681", "patch": "@@ -0,0 +1,83 @@\n+/* { dg-do compile } */\n+/* { dg-options \"-O2\" } */\n+/* Test check use_block_copy bit propagation in sra element hierarchy.  */\n+\n+typedef unsigned char UINT8 ;\n+typedef unsigned int UINT ;\n+class C4\n+{\n+public:\n+  int xy[2];\n+};\n+\n+class C3\n+{\n+public:\n+  inline void\n+  Reset()\n+  {\n+    C4 const mvMax = {0x7fff, 0x7fff};\n+\n+    m42(0,mvMax); \n+    m42(1,mvMax);\n+    m43(0);\n+  };\n+\n+  inline void m42 (UINT  i, C4 mv)\n+  {\n+    mMv[i] = mv;\n+  };\n+\n+\n+\n+  inline void  m43(UINT j)\n+  {\n+    m44 (j);\n+    d41 = j + 1;\n+  };\n+\n+private:\n+\n+  C4 mMv[2];\n+  UINT8 d41;\n+  inline void m44 (UINT j) const {};\n+};\n+\n+class C2\n+{\n+private:\n+  bool valid;\n+};\n+\n+class C1\n+{\n+public:\n+  void m1(C3 *c);\n+\n+private:\n+  const C2 * d1[2];\n+  void m2(C3 *m);\n+};                                                                                                                                                                           \n+\n+void C1::m1 (C3 *r)\n+{\n+  C3 x;\n+  m2(&x);\n+}\n+void C1::m2(C3 *x)\n+{\n+  C3 m3;\n+  int i;\n+  m3.Reset ();\n+  for(i=0; i<2; i++)\n+    {\n+      const C2 * r = d1[i];\n+      if (r!=__null)\n+        {\n+\t  C4 const c400 = {0,0};\n+          m3.m42 (i, c400);\n+\t  \n+        }\n+    }\n+}   \n+"}, {"sha": "2fb23bd6022eca5276935b34b89c8954a681ea77", "filename": "gcc/tree-sra.c", "status": "modified", "additions": 6, "deletions": 0, "changes": 6, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/ae7f3734d5e1a4aa88fe8b25d553e57d161ee681/gcc%2Ftree-sra.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/ae7f3734d5e1a4aa88fe8b25d553e57d161ee681/gcc%2Ftree-sra.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftree-sra.c?ref=ae7f3734d5e1a4aa88fe8b25d553e57d161ee681", "patch": "@@ -1299,6 +1299,12 @@ decide_block_copy (struct sra_elt *elt)\n \t  fputc ('\\n', dump_file);\n \t}\n \n+      /* Disable scalarization of sub-elements */\n+      for (c = elt->children; c; c = c->sibling)\n+\t{\n+\t  c->cannot_scalarize = 1;\n+\t  decide_block_copy (c);\n+\t}\n       return false;\n     }\n "}]}