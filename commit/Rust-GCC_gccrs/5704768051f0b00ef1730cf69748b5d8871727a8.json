{"sha": "5704768051f0b00ef1730cf69748b5d8871727a8", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6NTcwNDc2ODA1MWYwYjAwZWYxNzMwY2Y2OTc0OGI1ZDg4NzE3MjdhOA==", "commit": {"author": {"name": "Gunther Nikl", "email": "gni@gecko.de", "date": "2003-10-26T22:19:25Z"}, "committer": {"name": "Bernardo Innocenti", "email": "bernie@gcc.gnu.org", "date": "2003-10-26T22:19:25Z"}, "message": "m68k.c (m68k_compute_frame_layout): Ensure FPU related frame information is always valid.\n\n\t* config/m68k/m68k.c (m68k_compute_frame_layout): Ensure FPU related\n\tframe information is always valid.\n\t(m68k_output_function_prologue): Remove superfluous TARGET_68881\n\ttest; fix formatting.\n\nFrom-SVN: r72965", "tree": {"sha": "32c29edcc2f1e1d803054335a65b865a4df28157", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/32c29edcc2f1e1d803054335a65b865a4df28157"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/5704768051f0b00ef1730cf69748b5d8871727a8", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/5704768051f0b00ef1730cf69748b5d8871727a8", "html_url": "https://github.com/Rust-GCC/gccrs/commit/5704768051f0b00ef1730cf69748b5d8871727a8", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/5704768051f0b00ef1730cf69748b5d8871727a8/comments", "author": null, "committer": null, "parents": [{"sha": "858025041274c93ca54456cdf29caabd1c9fb342", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/858025041274c93ca54456cdf29caabd1c9fb342", "html_url": "https://github.com/Rust-GCC/gccrs/commit/858025041274c93ca54456cdf29caabd1c9fb342"}], "stats": {"total": 51, "additions": 27, "deletions": 24}, "files": [{"sha": "7d25e3309ebf7ad2d9fa80ffb307751d8c586b23", "filename": "gcc/ChangeLog", "status": "modified", "additions": 7, "deletions": 0, "changes": 7, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/5704768051f0b00ef1730cf69748b5d8871727a8/gcc%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/5704768051f0b00ef1730cf69748b5d8871727a8/gcc%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2FChangeLog?ref=5704768051f0b00ef1730cf69748b5d8871727a8", "patch": "@@ -1,3 +1,10 @@\n+2003-10-26  Gunther Nikl  <gni@gecko.de>\n+\n+\t* config/m68k/m68k.c (m68k_compute_frame_layout): Ensure FPU related\n+\tframe information is always valid.\n+\t(m68k_output_function_prologue): Remove superfluous TARGET_68881\n+\ttest; fix formatting.\n+\n 2003-10-26  Gunther Nikl  <gni@gecko.de>\n \n \t* config/m68k/m68k.c (m68k_compute_frame_layout): Swap reg_mask and"}, {"sha": "565e41ff7cd1909bd250443675aef8400fbc5b7c", "filename": "gcc/config/m68k/m68k.c", "status": "modified", "additions": 20, "deletions": 24, "changes": 44, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/5704768051f0b00ef1730cf69748b5d8871727a8/gcc%2Fconfig%2Fm68k%2Fm68k.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/5704768051f0b00ef1730cf69748b5d8871727a8/gcc%2Fconfig%2Fm68k%2Fm68k.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fconfig%2Fm68k%2Fm68k.c?ref=5704768051f0b00ef1730cf69748b5d8871727a8", "patch": "@@ -352,9 +352,10 @@ m68k_compute_frame_layout (void)\n   current_frame.reg_mask = mask;\n   current_frame.reg_rev_mask = rmask;\n \n+  current_frame.foffset = 0;\n+  mask = rmask = saved = 0;\n   if (TARGET_68881 /* || TARGET_CFV4E */)\n     {\n-      mask = rmask = saved = 0;\n       for (regno = 16; regno < 24; regno++)\n \tif (m68k_save_reg (regno, interrupt_handler))\n \t  {\n@@ -364,10 +365,10 @@ m68k_compute_frame_layout (void)\n \t  }\n       current_frame.foffset = saved * 12 /* (TARGET_CFV4E ? 8 : 12) */;\n       current_frame.offset += current_frame.foffset;\n-      current_frame.fpu_no = saved;\n-      current_frame.fpu_mask = mask;\n-      current_frame.fpu_rev_mask = rmask;\n     }\n+  current_frame.fpu_no = saved;\n+  current_frame.fpu_mask = mask;\n+  current_frame.fpu_rev_mask = rmask;\n \n   /* Remember what function this frame refers to.  */\n   current_frame.funcdef_no = current_function_funcdef_no;\n@@ -603,28 +604,24 @@ m68k_output_function_prologue (FILE *stream, HOST_WIDE_INT size ATTRIBUTE_UNUSED\n \t}\n     } /* !frame_pointer_needed */\n \n-  if (TARGET_68881)\n+  if (current_frame.fpu_mask)\n     {\n-      if (current_frame.fpu_mask)\n-\t{\n #ifdef MOTOROLA\n-\t  asm_fprintf (stream, \"\\tfmovm %I0x%x,-(%Rsp)\\n\", current_frame.fpu_mask);\n+      asm_fprintf (stream, \"\\tfmovm %I0x%x,-(%Rsp)\\n\", current_frame.fpu_mask);\n #else\n-\t  asm_fprintf (stream, \"\\tfmovem %I0x%x,%Rsp@-\\n\", current_frame.fpu_mask);\n+      asm_fprintf (stream, \"\\tfmovem %I0x%x,%Rsp@-\\n\", current_frame.fpu_mask);\n #endif\n-\t  if (dwarf2out_do_frame ())\n-\t    {\n-\t      char *l = (char *) dwarf2out_cfi_label ();\n-\t      int n_regs, regno;\n-\n-\t      cfa_offset += current_frame.fpu_no * 12;\n-\t      if (! frame_pointer_needed)\n-\t\tdwarf2out_def_cfa (l, STACK_POINTER_REGNUM, cfa_offset);\n-\t      for (regno = 16, n_regs = 0; regno < 24; regno++)\n-\t\tif (current_frame.fpu_mask & (1 << (regno - 16)))\n-\t\t  dwarf2out_reg_save (l, regno,\n-\t\t\t\t      -cfa_offset + n_regs++ * 12);\n-\t    }\n+      if (dwarf2out_do_frame ())\n+\t{\n+\t  char *l = (char *) dwarf2out_cfi_label ();\n+\t  int n_regs, regno;\n+\n+\t  cfa_offset += current_frame.fpu_no * 12;\n+\t  if (! frame_pointer_needed)\n+\t    dwarf2out_def_cfa (l, STACK_POINTER_REGNUM, cfa_offset);\n+\t  for (regno = 16, n_regs = 0; regno < 24; regno++)\n+\t    if (current_frame.fpu_mask & (1 << (regno - 16)))\n+\t      dwarf2out_reg_save (l, regno, -cfa_offset + n_regs++ * 12);\n \t}\n     }\n \n@@ -710,8 +707,7 @@ m68k_output_function_prologue (FILE *stream, HOST_WIDE_INT size ATTRIBUTE_UNUSED\n \t    dwarf2out_def_cfa (l, STACK_POINTER_REGNUM, cfa_offset);\n \t  for (regno = 0, n_regs = 0; regno < 16; regno++)\n \t    if (current_frame.reg_mask & (1 << regno))\n-\t      dwarf2out_reg_save (l, regno,\n-\t\t\t\t  -cfa_offset + n_regs++ * 4);\n+\t      dwarf2out_reg_save (l, regno, -cfa_offset + n_regs++ * 4);\n \t}\n     }\n   if (!TARGET_SEP_DATA && flag_pic &&"}]}