{"sha": "41501d1ae708f6977d957b61f797fda15ce33f0b", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6NDE1MDFkMWFlNzA4ZjY5NzdkOTU3YjYxZjc5N2ZkYTE1Y2UzM2YwYg==", "commit": {"author": {"name": "Tim Shen", "email": "timshen@google.com", "date": "2016-09-22T03:15:58Z"}, "committer": {"name": "Tim Shen", "email": "timshen@gcc.gnu.org", "date": "2016-09-22T03:15:58Z"}, "message": "re PR libstdc++/77641 (std::variant copy-initialization fails for type with non-trivial constexpr ctor)\n\n\tPR libstdc++/77641\n\t* include/std/variant (_Variant_storage::_Variant_storage):\n\tChange _Variant_storage's union to be default constructible.\n\t* testsuite/20_util/variant/compile.cc: New test.\n\nFrom-SVN: r240340", "tree": {"sha": "e30b1a795c8d8a407956e66b3e2f432308d98a84", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/e30b1a795c8d8a407956e66b3e2f432308d98a84"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/41501d1ae708f6977d957b61f797fda15ce33f0b", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/41501d1ae708f6977d957b61f797fda15ce33f0b", "html_url": "https://github.com/Rust-GCC/gccrs/commit/41501d1ae708f6977d957b61f797fda15ce33f0b", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/41501d1ae708f6977d957b61f797fda15ce33f0b/comments", "author": {"login": "timshen91", "id": 1157432, "node_id": "MDQ6VXNlcjExNTc0MzI=", "avatar_url": "https://avatars.githubusercontent.com/u/1157432?v=4", "gravatar_id": "", "url": "https://api.github.com/users/timshen91", "html_url": "https://github.com/timshen91", "followers_url": "https://api.github.com/users/timshen91/followers", "following_url": "https://api.github.com/users/timshen91/following{/other_user}", "gists_url": "https://api.github.com/users/timshen91/gists{/gist_id}", "starred_url": "https://api.github.com/users/timshen91/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/timshen91/subscriptions", "organizations_url": "https://api.github.com/users/timshen91/orgs", "repos_url": "https://api.github.com/users/timshen91/repos", "events_url": "https://api.github.com/users/timshen91/events{/privacy}", "received_events_url": "https://api.github.com/users/timshen91/received_events", "type": "User", "site_admin": false}, "committer": null, "parents": [{"sha": "77d7987a0cea2353b7bb1f11713577269d34c787", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/77d7987a0cea2353b7bb1f11713577269d34c787", "html_url": "https://github.com/Rust-GCC/gccrs/commit/77d7987a0cea2353b7bb1f11713577269d34c787"}], "stats": {"total": 45, "additions": 34, "deletions": 11}, "files": [{"sha": "0de2044de14d18f9e33a04ee9243bcb7f4f6ea0f", "filename": "libstdc++-v3/ChangeLog", "status": "modified", "additions": 7, "deletions": 0, "changes": 7, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/41501d1ae708f6977d957b61f797fda15ce33f0b/libstdc%2B%2B-v3%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/41501d1ae708f6977d957b61f797fda15ce33f0b/libstdc%2B%2B-v3%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libstdc%2B%2B-v3%2FChangeLog?ref=41501d1ae708f6977d957b61f797fda15ce33f0b", "patch": "@@ -1,3 +1,10 @@\n+2016-09-22  Tim Shen  <timshen@google.com>\n+\n+\tPR libstdc++/77641\n+\t* include/std/variant (_Variant_storage::_Variant_storage):\n+\tChange _Variant_storage's union to be default constructible.\n+\t* testsuite/20_util/variant/compile.cc: New test.\n+\n 2016-09-21  Ville Voutilainen  <ville.voutilainen@gmail.com>\n \n \tPR libstdc++/77288"}, {"sha": "013884bb23ec17f0bd41f52e8f522963edcabcd0", "filename": "libstdc++-v3/include/std/variant", "status": "modified", "additions": 18, "deletions": 11, "changes": 29, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/41501d1ae708f6977d957b61f797fda15ce33f0b/libstdc%2B%2B-v3%2Finclude%2Fstd%2Fvariant", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/41501d1ae708f6977d957b61f797fda15ce33f0b/libstdc%2B%2B-v3%2Finclude%2Fstd%2Fvariant", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libstdc%2B%2B-v3%2Finclude%2Fstd%2Fvariant?ref=41501d1ae708f6977d957b61f797fda15ce33f0b", "patch": "@@ -296,15 +296,9 @@ namespace __variant\n     {\n       constexpr _Variant_storage() = default;\n \n-      template<typename... _Args>\n-\tconstexpr _Variant_storage(in_place_index_t<0>, _Args&&... __args)\n-\t: _M_first(in_place<0>, forward<_Args>(__args)...)\n-\t{ }\n-\n-      template<size_t _Np, typename... _Args,\n-\t       typename = enable_if_t<0 < _Np && _Np < sizeof...(_Rest) + 1>>\n+      template<size_t _Np, typename... _Args>\n \tconstexpr _Variant_storage(in_place_index_t<_Np>, _Args&&... __args)\n-\t: _M_rest(in_place<_Np - 1>, forward<_Args>(__args)...)\n+\t: _M_union(in_place<_Np>, forward<_Args>(__args)...)\n \t{ }\n \n       ~_Variant_storage() = default;\n@@ -313,14 +307,27 @@ namespace __variant\n       _M_storage() const\n       {\n \treturn const_cast<void*>(\n-\t  static_cast<const void*>(std::addressof(_M_first._M_storage)));\n+\t  static_cast<const void*>(std::addressof(_M_union._M_first._M_storage)));\n       }\n \n-      union\n+      union _Union\n       {\n+\tconstexpr _Union() {};\n+\n+\ttemplate<typename... _Args>\n+\t  constexpr _Union(in_place_index_t<0>, _Args&&... __args)\n+\t  : _M_first(in_place<0>, forward<_Args>(__args)...)\n+\t  { }\n+\n+\ttemplate<size_t _Np, typename... _Args,\n+\t\t typename = enable_if_t<0 < _Np && _Np < sizeof...(_Rest) + 1>>\n+\t  constexpr _Union(in_place_index_t<_Np>, _Args&&... __args)\n+\t  : _M_rest(in_place<_Np - 1>, forward<_Args>(__args)...)\n+\t  { }\n+\n \t_Uninitialized<__storage<_First>> _M_first;\n \t_Variant_storage<_Rest...> _M_rest;\n-      };\n+      } _M_union;\n     };\n \n   template<typename _Derived, bool __is_trivially_destructible>"}, {"sha": "99f980a72db039e4bdf730cdfcfa2a33218e3120", "filename": "libstdc++-v3/testsuite/20_util/variant/compile.cc", "status": "modified", "additions": 9, "deletions": 0, "changes": 9, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/41501d1ae708f6977d957b61f797fda15ce33f0b/libstdc%2B%2B-v3%2Ftestsuite%2F20_util%2Fvariant%2Fcompile.cc", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/41501d1ae708f6977d957b61f797fda15ce33f0b/libstdc%2B%2B-v3%2Ftestsuite%2F20_util%2Fvariant%2Fcompile.cc", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libstdc%2B%2B-v3%2Ftestsuite%2F20_util%2Fvariant%2Fcompile.cc?ref=41501d1ae708f6977d957b61f797fda15ce33f0b", "patch": "@@ -403,3 +403,12 @@ void test_void()\n   v = 3;\n   v = \"asdf\";\n }\n+\n+void test_pr77641()\n+{\n+  struct X {\n+    constexpr X() { }\n+  };\n+\n+  constexpr std::variant<X> v1 = X{};\n+}"}]}