{"sha": "bd24ec2de08152666d95813a156007efff294bad", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6YmQyNGVjMmRlMDgxNTI2NjZkOTU4MTNhMTU2MDA3ZWZmZjI5NGJhZA==", "commit": {"author": {"name": "Jonathan Wakely", "email": "jwakely.gcc@gmail.com", "date": "2013-06-09T23:54:07Z"}, "committer": {"name": "Jonathan Wakely", "email": "redi@gcc.gnu.org", "date": "2013-06-09T23:54:07Z"}, "message": "mutex (call_once): Remove parentheses to fix error in c++1y and gnu++1y mode.\n\n\t* include/std/mutex (call_once): Remove parentheses to fix error in\n\tc++1y and gnu++1y mode.\n\t* testsuite/30_threads/mutex/try_lock/2.cc: Call try_lock() in new\n\tthread to avoid undefined behaviour.\n\nFrom-SVN: r199875", "tree": {"sha": "cbebc0c0bb8317e87a6ab55453980b226a4e1c0c", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/cbebc0c0bb8317e87a6ab55453980b226a4e1c0c"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/bd24ec2de08152666d95813a156007efff294bad", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/bd24ec2de08152666d95813a156007efff294bad", "html_url": "https://github.com/Rust-GCC/gccrs/commit/bd24ec2de08152666d95813a156007efff294bad", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/bd24ec2de08152666d95813a156007efff294bad/comments", "author": null, "committer": {"login": "jwakely", "id": 1254480, "node_id": "MDQ6VXNlcjEyNTQ0ODA=", "avatar_url": "https://avatars.githubusercontent.com/u/1254480?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jwakely", "html_url": "https://github.com/jwakely", "followers_url": "https://api.github.com/users/jwakely/followers", "following_url": "https://api.github.com/users/jwakely/following{/other_user}", "gists_url": "https://api.github.com/users/jwakely/gists{/gist_id}", "starred_url": "https://api.github.com/users/jwakely/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jwakely/subscriptions", "organizations_url": "https://api.github.com/users/jwakely/orgs", "repos_url": "https://api.github.com/users/jwakely/repos", "events_url": "https://api.github.com/users/jwakely/events{/privacy}", "received_events_url": "https://api.github.com/users/jwakely/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "0d00888247bcfe39791153f9aa1fd8734f58bc74", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/0d00888247bcfe39791153f9aa1fd8734f58bc74", "html_url": "https://github.com/Rust-GCC/gccrs/commit/0d00888247bcfe39791153f9aa1fd8734f58bc74"}], "stats": {"total": 31, "additions": 21, "deletions": 10}, "files": [{"sha": "5934f9bbe0addfe3618c9e8f2dfee2c37bd8bac8", "filename": "libstdc++-v3/ChangeLog", "status": "modified", "additions": 7, "deletions": 0, "changes": 7, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/bd24ec2de08152666d95813a156007efff294bad/libstdc%2B%2B-v3%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/bd24ec2de08152666d95813a156007efff294bad/libstdc%2B%2B-v3%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libstdc%2B%2B-v3%2FChangeLog?ref=bd24ec2de08152666d95813a156007efff294bad", "patch": "@@ -1,3 +1,10 @@\n+2013-06-09  Jonathan Wakely  <jwakely.gcc@gmail.com>\n+\n+\t* include/std/mutex (call_once): Remove parentheses to fix error in\n+\tc++1y and gnu++1y mode.\n+\t* testsuite/30_threads/mutex/try_lock/2.cc: Call try_lock() in new\n+\tthread to avoid undefined behaviour.\n+\n 2013-06-08  Ed Smith-Rowland  <3dw4rd@verizon.net>\n \n \tSimplify and clean up library literals."}, {"sha": "cdd05a37cbeeab0250e70a3dd7d2275aad7ca248", "filename": "libstdc++-v3/include/std/mutex", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/bd24ec2de08152666d95813a156007efff294bad/libstdc%2B%2B-v3%2Finclude%2Fstd%2Fmutex", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/bd24ec2de08152666d95813a156007efff294bad/libstdc%2B%2B-v3%2Finclude%2Fstd%2Fmutex", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libstdc%2B%2B-v3%2Finclude%2Fstd%2Fmutex?ref=bd24ec2de08152666d95813a156007efff294bad", "patch": "@@ -783,7 +783,7 @@ _GLIBCXX_BEGIN_NAMESPACE_VERSION\n       __set_once_functor_lock_ptr(&__functor_lock);\n #endif\n \n-      int __e = __gthread_once(&(__once._M_once), &__once_proxy);\n+      int __e = __gthread_once(&__once._M_once, &__once_proxy);\n \n #ifndef _GLIBCXX_HAVE_TLS\n       if (__functor_lock)"}, {"sha": "f2a67231cdadba98b909bf0343613d5d4fdd392d", "filename": "libstdc++-v3/testsuite/30_threads/mutex/try_lock/2.cc", "status": "modified", "additions": 13, "deletions": 9, "changes": 22, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/bd24ec2de08152666d95813a156007efff294bad/libstdc%2B%2B-v3%2Ftestsuite%2F30_threads%2Fmutex%2Ftry_lock%2F2.cc", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/bd24ec2de08152666d95813a156007efff294bad/libstdc%2B%2B-v3%2Ftestsuite%2F30_threads%2Fmutex%2Ftry_lock%2F2.cc", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libstdc%2B%2B-v3%2Ftestsuite%2F30_threads%2Fmutex%2Ftry_lock%2F2.cc?ref=bd24ec2de08152666d95813a156007efff294bad", "patch": "@@ -24,6 +24,7 @@\n \n \n #include <mutex>\n+#include <thread>\n #include <system_error>\n #include <testsuite_hooks.h>\n \n@@ -38,15 +39,18 @@ int main()\n       m.lock();\n       bool b;\n \n-      try\n-\t{\n-\t  b = m.try_lock();\n-\t  VERIFY( !b );\n-\t}\n-      catch (const std::system_error& e)\n-\t{\n-\t  VERIFY( false );\n-\t}\n+      std::thread t([&] {\n+        try\n+          {\n+            b = m.try_lock();\n+          }\n+        catch (const std::system_error& e)\n+          {\n+            VERIFY( false );\n+          }\n+      });\n+      t.join();\n+      VERIFY( !b );\n \n       m.unlock();\n     }"}]}