{"sha": "cd344e9570398b7436a4ed854618d5c186b20c02", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6Y2QzNDRlOTU3MDM5OGI3NDM2YTRlZDg1NDYxOGQ1YzE4NmIyMGMwMg==", "commit": {"author": {"name": "Arnaud Charlet", "email": "charlet@adacore.com", "date": "2021-03-17T07:59:23Z"}, "committer": {"name": "Pierre-Marie de Rodat", "email": "derodat@adacore.com", "date": "2021-06-18T08:36:49Z"}, "message": "[Ada] Fix handling of gnat check/test commands\n\ngcc/ada/\n\n\t* gnatcmd.adb: Fix handling of check and test commands.", "tree": {"sha": "38084899b0b5c67b4160277beec393555ce4f8e0", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/38084899b0b5c67b4160277beec393555ce4f8e0"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/cd344e9570398b7436a4ed854618d5c186b20c02", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/cd344e9570398b7436a4ed854618d5c186b20c02", "html_url": "https://github.com/Rust-GCC/gccrs/commit/cd344e9570398b7436a4ed854618d5c186b20c02", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/cd344e9570398b7436a4ed854618d5c186b20c02/comments", "author": {"login": "ArnaudCharlet", "id": 30291825, "node_id": "MDQ6VXNlcjMwMjkxODI1", "avatar_url": "https://avatars.githubusercontent.com/u/30291825?v=4", "gravatar_id": "", "url": "https://api.github.com/users/ArnaudCharlet", "html_url": "https://github.com/ArnaudCharlet", "followers_url": "https://api.github.com/users/ArnaudCharlet/followers", "following_url": "https://api.github.com/users/ArnaudCharlet/following{/other_user}", "gists_url": "https://api.github.com/users/ArnaudCharlet/gists{/gist_id}", "starred_url": "https://api.github.com/users/ArnaudCharlet/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/ArnaudCharlet/subscriptions", "organizations_url": "https://api.github.com/users/ArnaudCharlet/orgs", "repos_url": "https://api.github.com/users/ArnaudCharlet/repos", "events_url": "https://api.github.com/users/ArnaudCharlet/events{/privacy}", "received_events_url": "https://api.github.com/users/ArnaudCharlet/received_events", "type": "User", "site_admin": false}, "committer": {"login": "pmderodat", "id": 758452, "node_id": "MDQ6VXNlcjc1ODQ1Mg==", "avatar_url": "https://avatars.githubusercontent.com/u/758452?v=4", "gravatar_id": "", "url": "https://api.github.com/users/pmderodat", "html_url": "https://github.com/pmderodat", "followers_url": "https://api.github.com/users/pmderodat/followers", "following_url": "https://api.github.com/users/pmderodat/following{/other_user}", "gists_url": "https://api.github.com/users/pmderodat/gists{/gist_id}", "starred_url": "https://api.github.com/users/pmderodat/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/pmderodat/subscriptions", "organizations_url": "https://api.github.com/users/pmderodat/orgs", "repos_url": "https://api.github.com/users/pmderodat/repos", "events_url": "https://api.github.com/users/pmderodat/events{/privacy}", "received_events_url": "https://api.github.com/users/pmderodat/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "94c6d6fd7559167d3dc13698dbd58f27fb46cde4", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/94c6d6fd7559167d3dc13698dbd58f27fb46cde4", "html_url": "https://github.com/Rust-GCC/gccrs/commit/94c6d6fd7559167d3dc13698dbd58f27fb46cde4"}], "stats": {"total": 31, "additions": 17, "deletions": 14}, "files": [{"sha": "94da878ad85bfff767d5f27dcf2a1fac5a22b83e", "filename": "gcc/ada/gnatcmd.adb", "status": "modified", "additions": 17, "deletions": 14, "changes": 31, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/cd344e9570398b7436a4ed854618d5c186b20c02/gcc%2Fada%2Fgnatcmd.adb", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/cd344e9570398b7436a4ed854618d5c186b20c02/gcc%2Fada%2Fgnatcmd.adb", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fada%2Fgnatcmd.adb?ref=cd344e9570398b7436a4ed854618d5c186b20c02", "patch": "@@ -472,6 +472,15 @@ begin\n \n          Program := new String'(Command_List (The_Command).Unixcmd.all);\n \n+      elsif The_Command in Check | Test then\n+         Program := new String'(Command_List (The_Command).Unixcmd.all);\n+         Find_Program_Name;\n+\n+         if Name_Len > 5 then\n+            First_Switches.Append\n+              (new String'\n+                 (\"--target=\" & Name_Buffer (1 .. Name_Len - 5)));\n+         end if;\n       else\n          Program :=\n            Program_Name (Command_List (The_Command).Unixcmd.all, \"gnat\");\n@@ -481,13 +490,7 @@ begin\n          --  instead of gnatmake/gnatclean.\n          --  Ditto for gnatname -> gprname and gnatls -> gprls.\n \n-         if The_Command = Make\n-           or else The_Command = Compile\n-           or else The_Command = Bind\n-           or else The_Command = Link\n-           or else The_Command = Clean\n-           or else The_Command = Name\n-           or else The_Command = List\n+         if The_Command in Make | Compile | Bind | Link | Clean | Name | List\n          then\n             declare\n                Switch        : String_Access;\n@@ -588,23 +591,23 @@ begin\n       end if;\n \n       --  For FIND and XREF, look for switch -P. If it is specified, then\n-      --  report an error indicating that the command is no longer supporting\n-      --  project files.\n+      --  report an error indicating that the command does not support project\n+      --  files.\n \n-      if The_Command = Find or else The_Command = Xref then\n+      if The_Command in Find | Xref then\n          declare\n             Argv : String_Access;\n          begin\n             for Arg_Num in 1 .. Last_Switches.Last loop\n                Argv := Last_Switches.Table (Arg_Num);\n \n-               if Argv'Length >= 2 and then\n-                  Argv (Argv'First .. Argv'First + 1) = \"-P\"\n+               if Argv'Length >= 2\n+                 and then Argv (Argv'First .. Argv'First + 1) = \"-P\"\n                then\n                   if The_Command = Find then\n-                     Fail (\"'gnat find -P' is no longer supported;\");\n+                     Fail (\"'gnat find -P' is not supported;\");\n                   else\n-                     Fail (\"'gnat xref -P' is no longer supported;\");\n+                     Fail (\"'gnat xref -P' is not supported;\");\n                   end if;\n                end if;\n             end loop;"}]}