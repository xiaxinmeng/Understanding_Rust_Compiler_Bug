{"sha": "fe5568e99010574916f5b2607a173a34f2340891", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6ZmU1NTY4ZTk5MDEwNTc0OTE2ZjViMjYwN2ExNzNhMzRmMjM0MDg5MQ==", "commit": {"author": {"name": "Jakub Jelinek", "email": "jakub@redhat.com", "date": "2006-06-20T09:55:42Z"}, "committer": {"name": "Jakub Jelinek", "email": "jakub@gcc.gnu.org", "date": "2006-06-20T09:55:42Z"}, "message": "re PR libgomp/26175 (In gcc-4.2.0 libgomp/.../powerpc/futex.h SYS_futex undefined)\n\n\tPR libgomp/26175\n\tPR libgomp/26477\n\t* configure.ac: If neither --enable-linux-futex nor\n\t--disable-linux-futex is passed, determine the default by checking\n\tfor compiling and/or running against NPTL.  With --enable-linux-futex,\n\tcheck if SYS_gettid and SYS_futex are defined.\n\t* configure: Rebuilt.\n\nFrom-SVN: r114809", "tree": {"sha": "8bb868030ca7ee7205fdfbd8750e29fe2049be3b", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/8bb868030ca7ee7205fdfbd8750e29fe2049be3b"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/fe5568e99010574916f5b2607a173a34f2340891", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/fe5568e99010574916f5b2607a173a34f2340891", "html_url": "https://github.com/Rust-GCC/gccrs/commit/fe5568e99010574916f5b2607a173a34f2340891", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/fe5568e99010574916f5b2607a173a34f2340891/comments", "author": {"login": "jakubjelinek", "id": 9370665, "node_id": "MDQ6VXNlcjkzNzA2NjU=", "avatar_url": "https://avatars.githubusercontent.com/u/9370665?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jakubjelinek", "html_url": "https://github.com/jakubjelinek", "followers_url": "https://api.github.com/users/jakubjelinek/followers", "following_url": "https://api.github.com/users/jakubjelinek/following{/other_user}", "gists_url": "https://api.github.com/users/jakubjelinek/gists{/gist_id}", "starred_url": "https://api.github.com/users/jakubjelinek/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jakubjelinek/subscriptions", "organizations_url": "https://api.github.com/users/jakubjelinek/orgs", "repos_url": "https://api.github.com/users/jakubjelinek/repos", "events_url": "https://api.github.com/users/jakubjelinek/events{/privacy}", "received_events_url": "https://api.github.com/users/jakubjelinek/received_events", "type": "User", "site_admin": false}, "committer": null, "parents": [{"sha": "2a79fd67a509a9f020ed7492436c63eff7979802", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/2a79fd67a509a9f020ed7492436c63eff7979802", "html_url": "https://github.com/Rust-GCC/gccrs/commit/2a79fd67a509a9f020ed7492436c63eff7979802"}], "stats": {"total": 238, "additions": 229, "deletions": 9}, "files": [{"sha": "dc86f86bdac5e9af8a95c162732a12424ef3d594", "filename": "libgomp/ChangeLog", "status": "modified", "additions": 10, "deletions": 0, "changes": 10, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/fe5568e99010574916f5b2607a173a34f2340891/libgomp%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/fe5568e99010574916f5b2607a173a34f2340891/libgomp%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libgomp%2FChangeLog?ref=fe5568e99010574916f5b2607a173a34f2340891", "patch": "@@ -1,3 +1,13 @@\n+2006-06-20  Jakub Jelinek  <jakub@redhat.com>\n+\n+\tPR libgomp/26175\n+\tPR libgomp/26477\n+\t* configure.ac: If neither --enable-linux-futex nor\n+\t--disable-linux-futex is passed, determine the default by checking\n+\tfor compiling and/or running against NPTL.  With --enable-linux-futex,\n+\tcheck if SYS_gettid and SYS_futex are defined.\n+\t* configure: Rebuilt.\n+\n 2006-06-14  Richard Henderson  <rth@redhat.com>\n \n \tPR libgomp/28008"}, {"sha": "058b81b8486e87fdc6cf42a60f4f0fc2f4b8f0e5", "filename": "libgomp/configure", "status": "modified", "additions": 175, "deletions": 7, "changes": 182, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/fe5568e99010574916f5b2607a173a34f2340891/libgomp%2Fconfigure", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/fe5568e99010574916f5b2607a173a34f2340891/libgomp%2Fconfigure", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libgomp%2Fconfigure?ref=fe5568e99010574916f5b2607a173a34f2340891", "patch": "@@ -854,8 +854,8 @@ Optional Features:\n   --enable-version-specific-runtime-libs\n                           Specify that runtime libraries should be installed\n                           in a compiler-specific directory [default=no]\n-  _g_switchUse the Linux futex system call\n-                          permit yes|no [default=yes]\n+  --enable-linux-futex    Use the Linux futex system call\n+                          [default=default]\n   --enable-multilib       build many library versions (default)\n   --disable-dependency-tracking  speeds up one-time build\n   --enable-dependency-tracking   do not reject slow dependency extractors\n@@ -1369,14 +1369,14 @@ if test \"${enable_linux_futex+set}\" = set; then\n   enableval=\"$enable_linux_futex\"\n \n       case \"$enableval\" in\n-       yes|no) ;;\n-       *) { { echo \"$as_me:$LINENO: error: Argument to enable/disable linux-futex must be yes or no\" >&5\n-echo \"$as_me: error: Argument to enable/disable linux-futex must be yes or no\" >&2;}\n+       yes|no|default) ;;\n+       *) { { echo \"$as_me:$LINENO: error: Unknown argument to enable/disable linux-futex\" >&5\n+echo \"$as_me: error: Unknown argument to enable/disable linux-futex\" >&2;}\n    { (exit 1); exit 1; }; } ;;\n-      esac\n+                          esac\n \n else\n-  enable_linux_futex=yes\n+  enable_linux_futex=default\n fi;\n \n echo \"$as_me:$LINENO: result: $enable_linux_futex\" >&5\n@@ -8508,6 +8508,174 @@ cat >>confdefs.h <<\\_ACEOF\n #define HAVE_BROKEN_POSIX_SEMAPHORES 1\n _ACEOF\n \n+    ;;\n+  *-linux*)\n+    case \"$enable_linux_futex\" in\n+      default)\n+\t# If headers don't have gettid/futex syscalls definition, then\n+\t# default to no, otherwise there will be compile time failures.\n+\t# Otherwise, default to yes.  If we don't detect we are\n+\t# compiled/linked against NPTL and not cross-compiling, check\n+\t# if programs are run by default against NPTL and if not, issue\n+\t# a warning.\n+\tenable_linux_futex=no\n+\tcat >conftest.$ac_ext <<_ACEOF\n+/* confdefs.h.  */\n+_ACEOF\n+cat confdefs.h >>conftest.$ac_ext\n+cat >>conftest.$ac_ext <<_ACEOF\n+/* end confdefs.h.  */\n+#include <sys/syscall.h>\n+\t   int lk;\n+int\n+main ()\n+{\n+syscall (SYS_gettid); syscall (SYS_futex, &lk, 0, 0, 0);\n+  ;\n+  return 0;\n+}\n+_ACEOF\n+rm -f conftest.$ac_objext conftest$ac_exeext\n+if { (eval echo \"$as_me:$LINENO: \\\"$ac_link\\\"\") >&5\n+  (eval $ac_link) 2>conftest.er1\n+  ac_status=$?\n+  grep -v '^ *+' conftest.er1 >conftest.err\n+  rm -f conftest.er1\n+  cat conftest.err >&5\n+  echo \"$as_me:$LINENO: \\$? = $ac_status\" >&5\n+  (exit $ac_status); } &&\n+\t { ac_try='test -z \"$ac_c_werror_flag\"\n+\t\t\t || test ! -s conftest.err'\n+  { (eval echo \"$as_me:$LINENO: \\\"$ac_try\\\"\") >&5\n+  (eval $ac_try) 2>&5\n+  ac_status=$?\n+  echo \"$as_me:$LINENO: \\$? = $ac_status\" >&5\n+  (exit $ac_status); }; } &&\n+\t { ac_try='test -s conftest$ac_exeext'\n+  { (eval echo \"$as_me:$LINENO: \\\"$ac_try\\\"\") >&5\n+  (eval $ac_try) 2>&5\n+  ac_status=$?\n+  echo \"$as_me:$LINENO: \\$? = $ac_status\" >&5\n+  (exit $ac_status); }; }; then\n+  cat >conftest.$ac_ext <<_ACEOF\n+/* confdefs.h.  */\n+_ACEOF\n+cat confdefs.h >>conftest.$ac_ext\n+cat >>conftest.$ac_ext <<_ACEOF\n+/* end confdefs.h.  */\n+#ifndef _GNU_SOURCE\n+\t     #define _GNU_SOURCE 1\n+\t     #endif\n+\t     #include <pthread.h>\n+\t     pthread_t th; void *status;\n+int\n+main ()\n+{\n+pthread_tryjoin_np (th, &status);\n+  ;\n+  return 0;\n+}\n+_ACEOF\n+rm -f conftest.$ac_objext conftest$ac_exeext\n+if { (eval echo \"$as_me:$LINENO: \\\"$ac_link\\\"\") >&5\n+  (eval $ac_link) 2>conftest.er1\n+  ac_status=$?\n+  grep -v '^ *+' conftest.er1 >conftest.err\n+  rm -f conftest.er1\n+  cat conftest.err >&5\n+  echo \"$as_me:$LINENO: \\$? = $ac_status\" >&5\n+  (exit $ac_status); } &&\n+\t { ac_try='test -z \"$ac_c_werror_flag\"\n+\t\t\t || test ! -s conftest.err'\n+  { (eval echo \"$as_me:$LINENO: \\\"$ac_try\\\"\") >&5\n+  (eval $ac_try) 2>&5\n+  ac_status=$?\n+  echo \"$as_me:$LINENO: \\$? = $ac_status\" >&5\n+  (exit $ac_status); }; } &&\n+\t { ac_try='test -s conftest$ac_exeext'\n+  { (eval echo \"$as_me:$LINENO: \\\"$ac_try\\\"\") >&5\n+  (eval $ac_try) 2>&5\n+  ac_status=$?\n+  echo \"$as_me:$LINENO: \\$? = $ac_status\" >&5\n+  (exit $ac_status); }; }; then\n+  enable_linux_futex=yes\n+else\n+  echo \"$as_me: failed program was:\" >&5\n+sed 's/^/| /' conftest.$ac_ext >&5\n+\n+if test x$cross_compiling = xno; then\n+\t       if getconf GNU_LIBPTHREAD_VERSION 2>/dev/null \\\n+\t\t  | LC_ALL=C grep -i NPTL > /dev/null 2>/dev/null; then\n+\t\t { echo \"$as_me:$LINENO: WARNING: The kernel might not support futex or gettid syscalls.\n+If so, please configure with --disable-linux-futex\" >&5\n+echo \"$as_me: WARNING: The kernel might not support futex or gettid syscalls.\n+If so, please configure with --disable-linux-futex\" >&2;}\n+\t       fi\n+\t     fi\n+\t     enable_linux_futex=yes\n+fi\n+rm -f conftest.err conftest.$ac_objext \\\n+      conftest$ac_exeext conftest.$ac_ext\n+else\n+  echo \"$as_me: failed program was:\" >&5\n+sed 's/^/| /' conftest.$ac_ext >&5\n+\n+fi\n+rm -f conftest.err conftest.$ac_objext \\\n+      conftest$ac_exeext conftest.$ac_ext\n+\t;;\n+      yes)\n+\tcat >conftest.$ac_ext <<_ACEOF\n+/* confdefs.h.  */\n+_ACEOF\n+cat confdefs.h >>conftest.$ac_ext\n+cat >>conftest.$ac_ext <<_ACEOF\n+/* end confdefs.h.  */\n+#include <sys/syscall.h>\n+\t   int lk;\n+int\n+main ()\n+{\n+syscall (SYS_gettid); syscall (SYS_futex, &lk, 0, 0, 0);\n+  ;\n+  return 0;\n+}\n+_ACEOF\n+rm -f conftest.$ac_objext conftest$ac_exeext\n+if { (eval echo \"$as_me:$LINENO: \\\"$ac_link\\\"\") >&5\n+  (eval $ac_link) 2>conftest.er1\n+  ac_status=$?\n+  grep -v '^ *+' conftest.er1 >conftest.err\n+  rm -f conftest.er1\n+  cat conftest.err >&5\n+  echo \"$as_me:$LINENO: \\$? = $ac_status\" >&5\n+  (exit $ac_status); } &&\n+\t { ac_try='test -z \"$ac_c_werror_flag\"\n+\t\t\t || test ! -s conftest.err'\n+  { (eval echo \"$as_me:$LINENO: \\\"$ac_try\\\"\") >&5\n+  (eval $ac_try) 2>&5\n+  ac_status=$?\n+  echo \"$as_me:$LINENO: \\$? = $ac_status\" >&5\n+  (exit $ac_status); }; } &&\n+\t { ac_try='test -s conftest$ac_exeext'\n+  { (eval echo \"$as_me:$LINENO: \\\"$ac_try\\\"\") >&5\n+  (eval $ac_try) 2>&5\n+  ac_status=$?\n+  echo \"$as_me:$LINENO: \\$? = $ac_status\" >&5\n+  (exit $ac_status); }; }; then\n+  :\n+else\n+  echo \"$as_me: failed program was:\" >&5\n+sed 's/^/| /' conftest.$ac_ext >&5\n+\n+{ { echo \"$as_me:$LINENO: error: SYS_gettid and SYS_futex required for --enable-linux-futex\" >&5\n+echo \"$as_me: error: SYS_gettid and SYS_futex required for --enable-linux-futex\" >&2;}\n+   { (exit 1); exit 1; }; }\n+fi\n+rm -f conftest.err conftest.$ac_objext \\\n+      conftest$ac_exeext conftest.$ac_ext\n+\t;;\n+    esac\n     ;;\n esac\n "}, {"sha": "f653b70422d51269b73852e0050a3b419e0f38f3", "filename": "libgomp/configure.ac", "status": "modified", "additions": 44, "deletions": 2, "changes": 46, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/fe5568e99010574916f5b2607a173a34f2340891/libgomp%2Fconfigure.ac", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/fe5568e99010574916f5b2607a173a34f2340891/libgomp%2Fconfigure.ac", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libgomp%2Fconfigure.ac?ref=fe5568e99010574916f5b2607a173a34f2340891", "patch": "@@ -16,9 +16,9 @@ LIBGOMP_ENABLE(version-specific-runtime-libs, no, ,\n AC_MSG_RESULT($enable_version_specific_runtime_libs)\n \n AC_MSG_CHECKING([for --enable-linux-futex])\n-LIBGOMP_ENABLE(linux-futex, yes,\n+LIBGOMP_ENABLE(linux-futex, default, ,\n   [Use the Linux futex system call],\n-  permit yes|no)\n+  permit yes|no|default)\n AC_MSG_RESULT($enable_linux_futex)\n \n # -------\n@@ -171,6 +171,48 @@ case \"$host\" in\n     AC_DEFINE(HAVE_BROKEN_POSIX_SEMAPHORES, 1,\n \tDefine if the POSIX Semaphores do not work on your system.)\n     ;;\n+  *-linux*)\n+    case \"$enable_linux_futex\" in\n+      default)\n+\t# If headers don't have gettid/futex syscalls definition, then\n+\t# default to no, otherwise there will be compile time failures.\n+\t# Otherwise, default to yes.  If we don't detect we are\n+\t# compiled/linked against NPTL and not cross-compiling, check\n+\t# if programs are run by default against NPTL and if not, issue\n+\t# a warning.\n+\tenable_linux_futex=no\n+\tAC_LINK_IFELSE(\n+\t [AC_LANG_PROGRAM(\n+\t  [#include <sys/syscall.h>\n+\t   int lk;],\n+\t  [syscall (SYS_gettid); syscall (SYS_futex, &lk, 0, 0, 0);])],\n+\t  [AC_LINK_IFELSE(\n+\t   [AC_LANG_PROGRAM(\n+\t    [#ifndef _GNU_SOURCE\n+\t     #define _GNU_SOURCE 1\n+\t     #endif\n+\t     #include <pthread.h>\n+\t     pthread_t th; void *status;],\n+\t    [pthread_tryjoin_np (th, &status);])],[enable_linux_futex=yes],\n+\t    [if test x$cross_compiling = xno; then\n+\t       if getconf GNU_LIBPTHREAD_VERSION 2>/dev/null \\\n+\t\t  | LC_ALL=C grep -i NPTL > /dev/null 2>/dev/null; then\n+\t\t AC_MSG_WARN([The kernel might not support futex or gettid syscalls.\n+If so, please configure with --disable-linux-futex])\n+\t       fi\n+\t     fi\n+\t     enable_linux_futex=yes])])\n+\t;;\n+      yes)\n+\tAC_LINK_IFELSE(\n+\t [AC_LANG_PROGRAM(\n+\t  [#include <sys/syscall.h>\n+\t   int lk;],\n+\t  [syscall (SYS_gettid); syscall (SYS_futex, &lk, 0, 0, 0);])],[],\n+\t  [AC_MSG_ERROR([SYS_gettid and SYS_futex required for --enable-linux-futex])])\n+\t;;\n+    esac\n+    ;;\n esac\n \n # At least for glibc, clock_gettime is in librt.  But don't pull that"}]}