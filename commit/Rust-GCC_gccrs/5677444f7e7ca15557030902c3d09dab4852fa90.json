{"sha": "5677444f7e7ca15557030902c3d09dab4852fa90", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6NTY3NzQ0NGY3ZTdjYTE1NTU3MDMwOTAyYzNkMDlkYWI0ODUyZmE5MA==", "commit": {"author": {"name": "Thomas Schwinge", "email": "thomas@codesourcery.com", "date": "2020-10-30T12:13:51Z"}, "committer": {"name": "Thomas Schwinge", "email": "thomas@codesourcery.com", "date": "2020-11-02T13:15:39Z"}, "message": "Further improve Fortran column location information [PR92793]\n\nBuilding on top of commit 9c81750c5bedd7883182ee2684a012c6210ebe1d \"Fortran] PR\n92793 - fix column used for error diagnostic\", there is another place where we\nhave to use 'gfc_get_location' returning column-corrected locations.\n\nFor example, this improves column location information for OMP constructs.\n\n\tgcc/fortran/\n\tPR fortran/92793\n\t* trans.c (gfc_set_backend_locus): Use 'gfc_get_location'.\n\t(gfc_restore_backend_locus): Adjust.\n\tgcc/testsuite/\n\tPR fortran/92793\n\t* gfortran.dg/goacc/pr92793-1.f90: Adjust.", "tree": {"sha": "545eaff88dc8867672e5346be9683df407e694dd", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/545eaff88dc8867672e5346be9683df407e694dd"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/5677444f7e7ca15557030902c3d09dab4852fa90", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/5677444f7e7ca15557030902c3d09dab4852fa90", "html_url": "https://github.com/Rust-GCC/gccrs/commit/5677444f7e7ca15557030902c3d09dab4852fa90", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/5677444f7e7ca15557030902c3d09dab4852fa90/comments", "author": {"login": "tschwinge", "id": 21753, "node_id": "MDQ6VXNlcjIxNzUz", "avatar_url": "https://avatars.githubusercontent.com/u/21753?v=4", "gravatar_id": "", "url": "https://api.github.com/users/tschwinge", "html_url": "https://github.com/tschwinge", "followers_url": "https://api.github.com/users/tschwinge/followers", "following_url": "https://api.github.com/users/tschwinge/following{/other_user}", "gists_url": "https://api.github.com/users/tschwinge/gists{/gist_id}", "starred_url": "https://api.github.com/users/tschwinge/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/tschwinge/subscriptions", "organizations_url": "https://api.github.com/users/tschwinge/orgs", "repos_url": "https://api.github.com/users/tschwinge/repos", "events_url": "https://api.github.com/users/tschwinge/events{/privacy}", "received_events_url": "https://api.github.com/users/tschwinge/received_events", "type": "User", "site_admin": false}, "committer": {"login": "tschwinge", "id": 21753, "node_id": "MDQ6VXNlcjIxNzUz", "avatar_url": "https://avatars.githubusercontent.com/u/21753?v=4", "gravatar_id": "", "url": "https://api.github.com/users/tschwinge", "html_url": "https://github.com/tschwinge", "followers_url": "https://api.github.com/users/tschwinge/followers", "following_url": "https://api.github.com/users/tschwinge/following{/other_user}", "gists_url": "https://api.github.com/users/tschwinge/gists{/gist_id}", "starred_url": "https://api.github.com/users/tschwinge/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/tschwinge/subscriptions", "organizations_url": "https://api.github.com/users/tschwinge/orgs", "repos_url": "https://api.github.com/users/tschwinge/repos", "events_url": "https://api.github.com/users/tschwinge/events{/privacy}", "received_events_url": "https://api.github.com/users/tschwinge/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "528507fa0314c75d1105890e4781a475c8badd7c", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/528507fa0314c75d1105890e4781a475c8badd7c", "html_url": "https://github.com/Rust-GCC/gccrs/commit/528507fa0314c75d1105890e4781a475c8badd7c"}], "stats": {"total": 31, "additions": 17, "deletions": 14}, "files": [{"sha": "025abe389853cbe654def8870d39bbeb58f3badd", "filename": "gcc/fortran/trans.c", "status": "modified", "additions": 5, "deletions": 2, "changes": 7, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/5677444f7e7ca15557030902c3d09dab4852fa90/gcc%2Ffortran%2Ftrans.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/5677444f7e7ca15557030902c3d09dab4852fa90/gcc%2Ffortran%2Ftrans.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ffortran%2Ftrans.c?ref=5677444f7e7ca15557030902c3d09dab4852fa90", "patch": "@@ -1829,7 +1829,7 @@ void\n gfc_set_backend_locus (locus * loc)\n {\n   gfc_current_backend_file = loc->lb->file;\n-  input_location = loc->lb->location;\n+  input_location = gfc_get_location (loc);\n }\n \n \n@@ -1839,7 +1839,10 @@ gfc_set_backend_locus (locus * loc)\n void\n gfc_restore_backend_locus (locus * loc)\n {\n-  gfc_set_backend_locus (loc);\n+  /* This only restores the information captured by gfc_save_backend_locus,\n+     intentionally does not use gfc_get_location.  */\n+  input_location = loc->lb->location;\n+  gfc_current_backend_file = loc->lb->file;\n   free (loc->lb);\n }\n "}, {"sha": "72dd6b7b8f8142a75957f93da64912e21bbbb7c1", "filename": "gcc/testsuite/gfortran.dg/goacc/pr92793-1.f90", "status": "modified", "additions": 12, "deletions": 12, "changes": 24, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/5677444f7e7ca15557030902c3d09dab4852fa90/gcc%2Ftestsuite%2Fgfortran.dg%2Fgoacc%2Fpr92793-1.f90", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/5677444f7e7ca15557030902c3d09dab4852fa90/gcc%2Ftestsuite%2Fgfortran.dg%2Fgoacc%2Fpr92793-1.f90", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgfortran.dg%2Fgoacc%2Fpr92793-1.f90?ref=5677444f7e7ca15557030902c3d09dab4852fa90", "patch": "@@ -13,22 +13,22 @@ subroutine check ()\n   integer :: i, j, sum, diff\n \n  !$acc    parallel &\n-     !$acc & & ! Fortran location information points to the last line of the directive, and there is no column location information.\n-!$acc  && ! { dg-final { scan-tree-dump-times \"pr92793-1\\\\\\.f90:18:0\\\\\\] #pragma acc parallel\" 1 \"original\" } }\n-  !$acc & ! { dg-final { scan-tree-dump-times \"pr92793-1\\\\\\.f90:18:0\\\\\\] #pragma omp target oacc_parallel\" 1 \"gimple\" } }\n+     !$acc & & ! Fortran location information points to the last line, and last character of the directive.\n+!$acc  && ! { dg-final { scan-tree-dump-times \"pr92793-1\\\\\\.f90:18:123\\\\\\] #pragma acc parallel\" 1 \"original\" } }\n+  !$acc & ! { dg-final { scan-tree-dump-times \"pr92793-1\\\\\\.f90:18:123\\\\\\] #pragma omp target oacc_parallel\" 1 \"gimple\" } }\n       !$acc loop &\n-    !$acc & & ! Fortran location information points to the last line of the directive, and there is no column location information.\n-      !$acc  &   & ! { dg-final { scan-tree-dump-times \"pr92793-1\\\\\\.f90:26:0\\\\\\] #pragma acc loop\" 1 \"original\" } }\n-     !$acc &     & ! { dg-final { scan-tree-dump-times \"pr92793-1\\\\\\.f90:26:0\\\\\\] #pragma acc loop\" 1 \"gimple\" } }\n+    !$acc & & ! Fortran location information points to the last line, and last character of the directive.\n+      !$acc  &   & ! { dg-final { scan-tree-dump-times \"pr92793-1\\\\\\.f90:26:22\\\\\\] #pragma acc loop\" 1 \"original\" } }\n+     !$acc &     & ! { dg-final { scan-tree-dump-times \"pr92793-1\\\\\\.f90:26:22\\\\\\] #pragma acc loop\" 1 \"gimple\" } }\n     !$acc&       reduction  ( +    : sum ) & ! { dg-line sum1 }\n  !$acc && ! Fortran location information points to the ':' in 'reduction(+:sum)'.\n    !$acc   &    &  ! { dg-message \"36: location of the previous reduction for 'sum'\" \"\" { target *-*-* } sum1 }\n !$acc&     independent\n   do i = 1, 10\n       !$acc loop &\n-!$acc & & ! Fortran location information points to the last line of the directive, and there is no column location information.\n-   !$acc & & ! { dg-final { scan-tree-dump-times \"pr92793-1\\\\\\.f90:36:0\\\\\\] #pragma acc loop\" 1 \"original\" } }\n-    !$acc & & ! { dg-final { scan-tree-dump-times \"pr92793-1\\\\\\.f90:36:0\\\\\\] #pragma acc loop\" 1 \"gimple\" } }\n+!$acc & & ! Fortran location information points to the last line, and last character of the directive.\n+   !$acc & & ! { dg-final { scan-tree-dump-times \"pr92793-1\\\\\\.f90:36:34\\\\\\] #pragma acc loop\" 1 \"original\" } }\n+    !$acc & & ! { dg-final { scan-tree-dump-times \"pr92793-1\\\\\\.f90:36:34\\\\\\] #pragma acc loop\" 1 \"gimple\" } }\n   !$acc & reduction(-: diff     ) &\n              !$acc&reduction(- :    sum) & ! { dg-line sum2 }\n             !$acc & & ! Fortran location information points to the ':' in 'reduction(-:sum)'.\n@@ -38,9 +38,9 @@ subroutine check ()\n            sum &\n    & = &\n       & 1\n-        ! Fortran location information points to the last line of the statement, and there is no column location information.\n-        ! { dg-final { scan-tree-dump-times \"pr92793-1\\\\\\.f90:40:0\\\\\\] sum = 1\" 1 \"original\" } }\n-        ! { dg-final { scan-tree-dump-times \"pr92793-1\\\\\\.f90:40:0\\\\\\] sum = 1\" 1 \"gimple\" } }\n+        ! Fortran location information points to the last line, and last character of the statement.\n+        ! { dg-final { scan-tree-dump-times \"pr92793-1\\\\\\.f90:40:9\\\\\\] sum = 1\" 1 \"original\" } }\n+        ! { dg-final { scan-tree-dump-times \"pr92793-1\\\\\\.f90:40:9\\\\\\] sum = 1\" 1 \"gimple\" } }\n      end do\n   end do\n !$acc end  parallel"}]}