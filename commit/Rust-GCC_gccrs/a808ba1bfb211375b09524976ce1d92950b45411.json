{"sha": "a808ba1bfb211375b09524976ce1d92950b45411", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6YTgwOGJhMWJmYjIxMTM3NWIwOTUyNDk3NmNlMWQ5Mjk1MGI0NTQxMQ==", "commit": {"author": {"name": "Thomas Quinot", "email": "quinot@adacore.com", "date": "2009-04-15T08:47:44Z"}, "committer": {"name": "Arnaud Charlet", "email": "charlet@gcc.gnu.org", "date": "2009-04-15T08:47:44Z"}, "message": "exp_smem.adb (Make_Shared_Var_Procs): For a protected type...\n\n2009-04-15  Thomas Quinot  <quinot@adacore.com>\n\n\t* exp_smem.adb (Make_Shared_Var_Procs): For a protected type,\n\tinstantiate generic shared object package with the corresponding\n\trecord type.\n\nFrom-SVN: r146083", "tree": {"sha": "cf2a92ab785cc7f4190fc90e7a56c84979299bfa", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/cf2a92ab785cc7f4190fc90e7a56c84979299bfa"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/a808ba1bfb211375b09524976ce1d92950b45411", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/a808ba1bfb211375b09524976ce1d92950b45411", "html_url": "https://github.com/Rust-GCC/gccrs/commit/a808ba1bfb211375b09524976ce1d92950b45411", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/a808ba1bfb211375b09524976ce1d92950b45411/comments", "author": null, "committer": null, "parents": [{"sha": "e0568eecc317ac33f2e1e63c8cecafb82783fed2", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/e0568eecc317ac33f2e1e63c8cecafb82783fed2", "html_url": "https://github.com/Rust-GCC/gccrs/commit/e0568eecc317ac33f2e1e63c8cecafb82783fed2"}], "stats": {"total": 40, "additions": 29, "deletions": 11}, "files": [{"sha": "a06875469d644ee75567971d560646f49fcdd2f8", "filename": "gcc/ada/ChangeLog", "status": "modified", "additions": 6, "deletions": 0, "changes": 6, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/a808ba1bfb211375b09524976ce1d92950b45411/gcc%2Fada%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/a808ba1bfb211375b09524976ce1d92950b45411/gcc%2Fada%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fada%2FChangeLog?ref=a808ba1bfb211375b09524976ce1d92950b45411", "patch": "@@ -1,3 +1,9 @@\n+2009-04-15  Thomas Quinot  <quinot@adacore.com>\n+\n+\t* exp_smem.adb (Make_Shared_Var_Procs): For a protected type,\n+\tinstantiate generic shared object package with the corresponding\n+\trecord type.\n+\n 2009-04-15  Arnaud Charlet  <charlet@adacore.com>\n \n \t* system-linux-sparc.ads: Remove obsolete entries."}, {"sha": "6cbca26e0a800ece9937c2cd832afc658a9e61ab", "filename": "gcc/ada/exp_smem.adb", "status": "modified", "additions": 23, "deletions": 11, "changes": 34, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/a808ba1bfb211375b09524976ce1d92950b45411/gcc%2Fada%2Fexp_smem.adb", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/a808ba1bfb211375b09524976ce1d92950b45411/gcc%2Fada%2Fexp_smem.adb", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fada%2Fexp_smem.adb?ref=a808ba1bfb211375b09524976ce1d92950b45411", "patch": "@@ -25,6 +25,7 @@\n \n with Atree;    use Atree;\n with Einfo;    use Einfo;\n+with Exp_Ch9;  use Exp_Ch9;\n with Exp_Util; use Exp_Util;\n with Nmake;    use Nmake;\n with Namet;    use Namet;\n@@ -286,10 +287,12 @@ package body Exp_Smem is\n    ---------------------------\n \n    function Make_Shared_Var_Procs (N : Node_Id) return Node_Id is\n-      Loc : constant Source_Ptr := Sloc (N);\n-      Ent : constant Entity_Id  := Defining_Identifier (N);\n-      Typ : constant Entity_Id  := Etype (Ent);\n-      Vnm : String_Id;\n+      Loc     : constant Source_Ptr := Sloc (N);\n+      Ent     : constant Entity_Id  := Defining_Identifier (N);\n+      Typ     : constant Entity_Id  := Etype (Ent);\n+      Vnm     : String_Id;\n+      Obj     : Node_Id;\n+      Obj_Typ : Entity_Id;\n \n       After : constant Node_Id := Next (N);\n       --  Node located right after N originally (after insertion of the SV\n@@ -316,20 +319,29 @@ package body Exp_Smem is\n \n       --  Construct generic package instantiation\n \n-      --  package varG is new Shared_Var_Procs (Typ, var, \"pkg.var\");\n+      --  package varG is new Shared_Var_Procs (typ, var, \"pkg.var\");\n+\n+      Obj     := New_Occurrence_Of (Ent, Loc);\n+      Obj_Typ := Typ;\n+      if Is_Concurrent_Type (Typ) then\n+         Obj     := Convert_Concurrent (N => Obj, Typ => Typ);\n+         Obj_Typ := Corresponding_Record_Type (Typ);\n+      end if;\n \n       Instantiation :=\n         Make_Package_Instantiation (Loc,\n           Defining_Unit_Name   => SVP_Instance,\n           Name                 =>\n             New_Occurrence_Of (RTE (RE_Shared_Var_Procs), Loc),\n           Generic_Associations => New_List (\n-            Make_Generic_Association (Loc, Explicit_Generic_Actual_Parameter =>\n-              New_Occurrence_Of (Typ, Loc)),\n-            Make_Generic_Association (Loc, Explicit_Generic_Actual_Parameter =>\n-              New_Occurrence_Of (Ent, Loc)),\n-            Make_Generic_Association (Loc, Explicit_Generic_Actual_Parameter =>\n-              Make_String_Literal (Loc, Vnm))));\n+            Make_Generic_Association (Loc,\n+              Explicit_Generic_Actual_Parameter =>\n+                New_Occurrence_Of (Obj_Typ, Loc)),\n+            Make_Generic_Association (Loc,\n+              Explicit_Generic_Actual_Parameter => Obj),\n+            Make_Generic_Association (Loc,\n+              Explicit_Generic_Actual_Parameter =>\n+                Make_String_Literal (Loc, Vnm))));\n \n       Insert_After_And_Analyze (N, Instantiation);\n "}]}