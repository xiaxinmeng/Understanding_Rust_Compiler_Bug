{"sha": "9b0588e9362bdd86f4cfdbe115e220b38ed23aaa", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6OWIwNTg4ZTkzNjJiZGQ4NmY0Y2ZkYmUxMTVlMjIwYjM4ZWQyM2FhYQ==", "commit": {"author": {"name": "Mikael Morin", "email": "mikael@gcc.gnu.org", "date": "2018-03-28T20:12:55Z"}, "committer": {"name": "Mikael Morin", "email": "mikael@gcc.gnu.org", "date": "2018-03-28T20:12:55Z"}, "message": "re PR fortran/69497 (ICE in gfc_free_namespace, at fortran/symbol.c:3701)\n\n\n\tPR fortran/69497\n\t* symbol.c (gfc_symbol_done_2): Start freeing namespaces\n\tfrom the root.\n\t(gfc_free_namespace): Restore assert (revert r258839).\n\nFrom-SVN: r258935", "tree": {"sha": "17a22f09cca1b588faf489031f615175b1f1a0fc", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/17a22f09cca1b588faf489031f615175b1f1a0fc"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/9b0588e9362bdd86f4cfdbe115e220b38ed23aaa", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/9b0588e9362bdd86f4cfdbe115e220b38ed23aaa", "html_url": "https://github.com/Rust-GCC/gccrs/commit/9b0588e9362bdd86f4cfdbe115e220b38ed23aaa", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/9b0588e9362bdd86f4cfdbe115e220b38ed23aaa/comments", "author": null, "committer": null, "parents": [{"sha": "e8b8462de61abb0dc136906432e234fa620eb0c8", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/e8b8462de61abb0dc136906432e234fa620eb0c8", "html_url": "https://github.com/Rust-GCC/gccrs/commit/e8b8462de61abb0dc136906432e234fa620eb0c8"}], "stats": {"total": 22, "additions": 18, "deletions": 4}, "files": [{"sha": "9c13ff060c3cc502078c28f661a4fe939a42be39", "filename": "gcc/fortran/ChangeLog", "status": "modified", "additions": 7, "deletions": 0, "changes": 7, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/9b0588e9362bdd86f4cfdbe115e220b38ed23aaa/gcc%2Ffortran%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/9b0588e9362bdd86f4cfdbe115e220b38ed23aaa/gcc%2Ffortran%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ffortran%2FChangeLog?ref=9b0588e9362bdd86f4cfdbe115e220b38ed23aaa", "patch": "@@ -1,3 +1,10 @@\n+2018-03-28  Mikael Morin  <mikael@gcc.gnu.org>\n+\n+\tPR fortran/69497\n+\t* symbol.c (gfc_symbol_done_2): Start freeing namespaces\n+\tfrom the root.\n+\t(gfc_free_namespace): Restore assert (revert r258839). \n+\n 2018-03-28  Jakub Jelinek  <jakub@redhat.com>\n \n \t* gfortran.h (gfc_dt): Rename default_exp field to dec_ext."}, {"sha": "546a4fae0a8a1444880afa8658f6bd05a94b3933", "filename": "gcc/fortran/symbol.c", "status": "modified", "additions": 11, "deletions": 4, "changes": 15, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/9b0588e9362bdd86f4cfdbe115e220b38ed23aaa/gcc%2Ffortran%2Fsymbol.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/9b0588e9362bdd86f4cfdbe115e220b38ed23aaa/gcc%2Ffortran%2Fsymbol.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ffortran%2Fsymbol.c?ref=9b0588e9362bdd86f4cfdbe115e220b38ed23aaa", "patch": "@@ -4037,10 +4037,11 @@ gfc_free_namespace (gfc_namespace *ns)\n     return;\n \n   ns->refs--;\n-\n-  if (ns->refs != 0)\n+  if (ns->refs > 0)\n     return;\n \n+  gcc_assert (ns->refs == 0);\n+\n   gfc_free_statements (ns->code);\n \n   free_sym_tree (ns->sym_root);\n@@ -4087,8 +4088,14 @@ gfc_symbol_init_2 (void)\n void\n gfc_symbol_done_2 (void)\n {\n-  gfc_free_namespace (gfc_current_ns);\n-  gfc_current_ns = NULL;\n+  if (gfc_current_ns != NULL)\n+    {\n+      /* free everything from the root.  */\n+      while (gfc_current_ns->parent != NULL)\n+\tgfc_current_ns = gfc_current_ns->parent;\n+      gfc_free_namespace (gfc_current_ns);\n+      gfc_current_ns = NULL;\n+    }\n   gfc_free_dt_list ();\n \n   enforce_single_undo_checkpoint ();"}]}