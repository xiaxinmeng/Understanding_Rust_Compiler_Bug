{"sha": "99282f81a6bcb5873c2a3c4755f625b5a44a915d", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6OTkyODJmODFhNmJjYjU4NzNjMmEzYzQ3NTVmNjI1YjVhNDRhOTE1ZA==", "commit": {"author": {"name": "Markus Trippelsdorf", "email": "markus@trippelsdorf.de", "date": "2017-11-27T05:20:43Z"}, "committer": {"name": "Markus Trippelsdorf", "email": "trippels@gcc.gnu.org", "date": "2017-11-27T05:20:43Z"}, "message": "Fix PR82488 - signed integer overflow in expr.c\n\nbootstrap-ubsan shows:\n gcc/expr.c:4103:17: runtime error: signed integer overflow: 0 - -9223372036854775808 cannot be represented in type 'long int'\n\nFix by handling the saw_unknown case earlier.\n\n\tPR rtl-optimization/82488\n\t* expr.c (fixup_args_size_notes): Avoid signed integer overflow.\n\ndiff --git a/gcc/expr.c b/gcc/expr.c\nindex ee07de5aaa44..e9d8555c9452 100644\n--- a/gcc/expr.c\n+++ b/gcc/expr.c\n@@ -4100,10 +4100,13 @@ fixup_args_size_notes (rtx_insn *prev, rtx_insn *last, int end_args_size)\n       if (STACK_GROWS_DOWNWARD)\n \tthis_delta = -(unsigned HOST_WIDE_INT) this_delta;\n\n-      args_size -= this_delta;\n+      if (saw_unknown)\n+\targs_size = INT_MIN;\n+      else\n+\targs_size -= this_delta;\n     }\n\n-  return saw_unknown ? INT_MIN : args_size;\n+  return args_size;\n }\n\n #ifdef PUSH_ROUNDING\n--\nMarkus\n\nFrom-SVN: r255159", "tree": {"sha": "c003d29fccbed0d3197d3f058e86ffa7b1f173ab", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/c003d29fccbed0d3197d3f058e86ffa7b1f173ab"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/99282f81a6bcb5873c2a3c4755f625b5a44a915d", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/99282f81a6bcb5873c2a3c4755f625b5a44a915d", "html_url": "https://github.com/Rust-GCC/gccrs/commit/99282f81a6bcb5873c2a3c4755f625b5a44a915d", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/99282f81a6bcb5873c2a3c4755f625b5a44a915d/comments", "author": null, "committer": null, "parents": [{"sha": "62e8530cd54126ab5be8a7815df47dab5c8e6905", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/62e8530cd54126ab5be8a7815df47dab5c8e6905", "html_url": "https://github.com/Rust-GCC/gccrs/commit/62e8530cd54126ab5be8a7815df47dab5c8e6905"}], "stats": {"total": 12, "additions": 10, "deletions": 2}, "files": [{"sha": "dc980a96a0d2c83de40444ab2a5633636d377a67", "filename": "gcc/ChangeLog", "status": "modified", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/99282f81a6bcb5873c2a3c4755f625b5a44a915d/gcc%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/99282f81a6bcb5873c2a3c4755f625b5a44a915d/gcc%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2FChangeLog?ref=99282f81a6bcb5873c2a3c4755f625b5a44a915d", "patch": "@@ -1,3 +1,8 @@\n+2017-11-27  Markus Trippelsdorf  <markus@trippelsdorf.de>\n+\n+\tPR rtl-optimization/82488\n+\t* expr.c (fixup_args_size_notes): Avoid signed integer overflow.\n+\n 2017-11-26  Julia Koval  <julia.koval@intel.com>\n \n \t* config/i386/i386.c (processor_target_table): Add skylake_cost for"}, {"sha": "e9d8555c9452d3cd3b6c3c298e4ed428dd69f3e8", "filename": "gcc/expr.c", "status": "modified", "additions": 5, "deletions": 2, "changes": 7, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/99282f81a6bcb5873c2a3c4755f625b5a44a915d/gcc%2Fexpr.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/99282f81a6bcb5873c2a3c4755f625b5a44a915d/gcc%2Fexpr.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fexpr.c?ref=99282f81a6bcb5873c2a3c4755f625b5a44a915d", "patch": "@@ -4100,10 +4100,13 @@ fixup_args_size_notes (rtx_insn *prev, rtx_insn *last, int end_args_size)\n       if (STACK_GROWS_DOWNWARD)\n \tthis_delta = -(unsigned HOST_WIDE_INT) this_delta;\n \n-      args_size -= this_delta;\n+      if (saw_unknown)\n+\targs_size = INT_MIN;\n+      else\n+\targs_size -= this_delta;\n     }\n \n-  return saw_unknown ? INT_MIN : args_size;\n+  return args_size;\n }\n \n #ifdef PUSH_ROUNDING"}]}