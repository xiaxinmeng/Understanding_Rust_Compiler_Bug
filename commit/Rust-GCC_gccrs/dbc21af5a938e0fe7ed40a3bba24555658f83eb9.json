{"sha": "dbc21af5a938e0fe7ed40a3bba24555658f83eb9", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6ZGJjMjFhZjVhOTM4ZTBmZTdlZDQwYTNiYmEyNDU1NTY1OGY4M2ViOQ==", "commit": {"author": {"name": "Paolo Carlini", "email": "pcarlini@suse.de", "date": "2008-01-21T01:49:29Z"}, "committer": {"name": "Paolo Carlini", "email": "paolo@gcc.gnu.org", "date": "2008-01-21T01:49:29Z"}, "message": "re PR c++/34776 (ICE with invalid member declaration in template class)\n\n/cp\n2008-01-20  Paolo Carlini  <pcarlini@suse.de>\n\n        PR c++/34776\n\tPR c++/34486\n        * name-lookup.c (do_class_using_decl): Do not call constructor_name_p\n\ton non-IS_AGGR_TYPE type scope.\n\t(constructor_name_p): Assert IS_AGGR_TYPE.\n\n/testsuite\n2008-01-20  Paolo Carlini  <pcarlini@suse.de>\n\n        PR c++/34776\n\tPR c++/34486\n        * g++.dg/template/crash75.C: New.\n        * g++.dg/template/crash76.C: Likewise.\n\nFrom-SVN: r131686", "tree": {"sha": "ed3c687103842fcf2da43e11d04d5b4a2e3daa5a", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/ed3c687103842fcf2da43e11d04d5b4a2e3daa5a"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/dbc21af5a938e0fe7ed40a3bba24555658f83eb9", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/dbc21af5a938e0fe7ed40a3bba24555658f83eb9", "html_url": "https://github.com/Rust-GCC/gccrs/commit/dbc21af5a938e0fe7ed40a3bba24555658f83eb9", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/dbc21af5a938e0fe7ed40a3bba24555658f83eb9/comments", "author": null, "committer": null, "parents": [{"sha": "604f825c83f937b56207bca2fc92ef9d1442a8af", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/604f825c83f937b56207bca2fc92ef9d1442a8af", "html_url": "https://github.com/Rust-GCC/gccrs/commit/604f825c83f937b56207bca2fc92ef9d1442a8af"}], "stats": {"total": 43, "additions": 41, "deletions": 2}, "files": [{"sha": "453ad48a0db9f03206b4a36b52955a49f5675090", "filename": "gcc/cp/ChangeLog", "status": "modified", "additions": 8, "deletions": 0, "changes": 8, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/dbc21af5a938e0fe7ed40a3bba24555658f83eb9/gcc%2Fcp%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/dbc21af5a938e0fe7ed40a3bba24555658f83eb9/gcc%2Fcp%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fcp%2FChangeLog?ref=dbc21af5a938e0fe7ed40a3bba24555658f83eb9", "patch": "@@ -1,3 +1,11 @@\n+2008-01-20  Paolo Carlini  <pcarlini@suse.de>\n+\n+        PR c++/34776\n+\tPR c++/34486\n+        * name-lookup.c (do_class_using_decl): Do not call constructor_name_p\n+\ton non-IS_AGGR_TYPE scope.\n+\t(constructor_name_p): Assert IS_AGGR_TYPE.\n+\n 2008-01-18  Ian Lance Taylor  <iant@google.com>\n \n \tPR c++/33407"}, {"sha": "c21940c0b51904f31a6504be8257abd43679c24b", "filename": "gcc/cp/name-lookup.c", "status": "modified", "additions": 5, "deletions": 2, "changes": 7, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/dbc21af5a938e0fe7ed40a3bba24555658f83eb9/gcc%2Fcp%2Fname-lookup.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/dbc21af5a938e0fe7ed40a3bba24555658f83eb9/gcc%2Fcp%2Fname-lookup.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fcp%2Fname-lookup.c?ref=dbc21af5a938e0fe7ed40a3bba24555658f83eb9", "patch": "@@ -1730,13 +1730,16 @@ constructor_name (tree type)\n   return name;\n }\n \n-/* Returns TRUE if NAME is the name for the constructor for TYPE.  */\n+/* Returns TRUE if NAME is the name for the constructor for TYPE,\n+   which must be a class type.  */\n \n bool\n constructor_name_p (tree name, tree type)\n {\n   tree ctor_name;\n \n+  gcc_assert (IS_AGGR_TYPE (type));\n+\n   if (!name)\n     return false;\n \n@@ -2824,7 +2827,7 @@ do_class_using_decl (tree scope, tree name)\n       error (\"%<%T::%D%> names destructor\", scope, name);\n       return NULL_TREE;\n     }\n-  if (constructor_name_p (name, scope))\n+  if (IS_AGGR_TYPE (scope) && constructor_name_p (name, scope))\n     {\n       error (\"%<%T::%D%> names constructor\", scope, name);\n       return NULL_TREE;"}, {"sha": "f45329eeb0198f37417e47790642c19725250763", "filename": "gcc/testsuite/ChangeLog", "status": "modified", "additions": 7, "deletions": 0, "changes": 7, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/dbc21af5a938e0fe7ed40a3bba24555658f83eb9/gcc%2Ftestsuite%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/dbc21af5a938e0fe7ed40a3bba24555658f83eb9/gcc%2Ftestsuite%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2FChangeLog?ref=dbc21af5a938e0fe7ed40a3bba24555658f83eb9", "patch": "@@ -1,3 +1,10 @@\n+2008-01-20  Paolo Carlini  <pcarlini@suse.de>\n+\n+        PR c++/34776\n+\tPR c++/34486\n+        * g++.dg/template/crash75.C: New.\n+        * g++.dg/template/crash76.C: Likewise.\t\n+\n 2008-01-20  Kaz Kojima  <kkojima@gcc.gnu.org>\n \n \tPR rtl-optimization/34808"}, {"sha": "462be95b2f7fc6d3dc9be21ba4b3630c7dbc2b81", "filename": "gcc/testsuite/g++.dg/template/crash75.C", "status": "added", "additions": 8, "deletions": 0, "changes": 8, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/dbc21af5a938e0fe7ed40a3bba24555658f83eb9/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Ftemplate%2Fcrash75.C", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/dbc21af5a938e0fe7ed40a3bba24555658f83eb9/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Ftemplate%2Fcrash75.C", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Ftemplate%2Fcrash75.C?ref=dbc21af5a938e0fe7ed40a3bba24555658f83eb9", "patch": "@@ -0,0 +1,8 @@\n+// PR c++/34776\n+\n+template<typename T> struct A\n+{\n+  T::X<0> x; // { dg-error \"non-template|T::template|base type\" }\n+};\n+\n+A<int*> a;"}, {"sha": "851cdd8c436d31c6be2d18a6b03fde4ee65a03a9", "filename": "gcc/testsuite/g++.dg/template/crash76.C", "status": "added", "additions": 13, "deletions": 0, "changes": 13, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/dbc21af5a938e0fe7ed40a3bba24555658f83eb9/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Ftemplate%2Fcrash76.C", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/dbc21af5a938e0fe7ed40a3bba24555658f83eb9/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Ftemplate%2Fcrash76.C", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Ftemplate%2Fcrash76.C?ref=dbc21af5a938e0fe7ed40a3bba24555658f83eb9", "patch": "@@ -0,0 +1,13 @@\n+// PR c++/34486\n+\n+template<typename> struct A\n+{\n+  typedef A* X;\n+};\n+\n+template<typename T> struct B\n+{\n+  using A<T>::X::Y; // { dg-error \"not a base type\" }\n+};\n+\n+B<int> b;"}]}