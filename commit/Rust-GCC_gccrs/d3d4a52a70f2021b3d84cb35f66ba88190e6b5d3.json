{"sha": "d3d4a52a70f2021b3d84cb35f66ba88190e6b5d3", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6ZDNkNGE1MmE3MGYyMDIxYjNkODRjYjM1ZjY2YmE4ODE5MGU2YjVkMw==", "commit": {"author": {"name": "Jakub Jelinek", "email": "jakub@redhat.com", "date": "2018-02-22T08:29:56Z"}, "committer": {"name": "Jakub Jelinek", "email": "jakub@gcc.gnu.org", "date": "2018-02-22T08:29:56Z"}, "message": "re PR c++/84502 (Argument corruption when passing empty templated struct)\n\n\tPR target/84502\n\t* stor-layout.c (finalize_type_size): Propagate TYPE_EMPTY_P flag\n\tto all type variants.\n\n\t* g++.dg/torture/pr84502.C: New test.\n\nFrom-SVN: r257892", "tree": {"sha": "ef85c92dac9a135c13fd324d5a1fee8d324e20f0", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/ef85c92dac9a135c13fd324d5a1fee8d324e20f0"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/d3d4a52a70f2021b3d84cb35f66ba88190e6b5d3", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/d3d4a52a70f2021b3d84cb35f66ba88190e6b5d3", "html_url": "https://github.com/Rust-GCC/gccrs/commit/d3d4a52a70f2021b3d84cb35f66ba88190e6b5d3", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/d3d4a52a70f2021b3d84cb35f66ba88190e6b5d3/comments", "author": {"login": "jakubjelinek", "id": 9370665, "node_id": "MDQ6VXNlcjkzNzA2NjU=", "avatar_url": "https://avatars.githubusercontent.com/u/9370665?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jakubjelinek", "html_url": "https://github.com/jakubjelinek", "followers_url": "https://api.github.com/users/jakubjelinek/followers", "following_url": "https://api.github.com/users/jakubjelinek/following{/other_user}", "gists_url": "https://api.github.com/users/jakubjelinek/gists{/gist_id}", "starred_url": "https://api.github.com/users/jakubjelinek/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jakubjelinek/subscriptions", "organizations_url": "https://api.github.com/users/jakubjelinek/orgs", "repos_url": "https://api.github.com/users/jakubjelinek/repos", "events_url": "https://api.github.com/users/jakubjelinek/events{/privacy}", "received_events_url": "https://api.github.com/users/jakubjelinek/received_events", "type": "User", "site_admin": false}, "committer": null, "parents": [{"sha": "c5679c37aad3775ecbb41b1a191514b13bf73f77", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/c5679c37aad3775ecbb41b1a191514b13bf73f77", "html_url": "https://github.com/Rust-GCC/gccrs/commit/c5679c37aad3775ecbb41b1a191514b13bf73f77"}], "stats": {"total": 35, "additions": 32, "deletions": 3}, "files": [{"sha": "07dd795476df6a59aab56a7e51b8cedf9367bbf8", "filename": "gcc/ChangeLog", "status": "modified", "additions": 4, "deletions": 0, "changes": 4, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/d3d4a52a70f2021b3d84cb35f66ba88190e6b5d3/gcc%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/d3d4a52a70f2021b3d84cb35f66ba88190e6b5d3/gcc%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2FChangeLog?ref=d3d4a52a70f2021b3d84cb35f66ba88190e6b5d3", "patch": "@@ -1,5 +1,9 @@\n 2018-02-22  Jakub Jelinek  <jakub@redhat.com>\n \n+\tPR target/84502\n+\t* stor-layout.c (finalize_type_size): Propagate TYPE_EMPTY_P flag\n+\tto all type variants.\n+\n \tPR tree-optimization/84503\n \t* gimple-ssa-store-merging.c (merged_store_group::merge_into): Compute\n \twidth as info->bitpos + info->bitsize - start."}, {"sha": "a4eeff18ec0db855b569505b9096858cbe211d41", "filename": "gcc/stor-layout.c", "status": "modified", "additions": 5, "deletions": 3, "changes": 8, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/d3d4a52a70f2021b3d84cb35f66ba88190e6b5d3/gcc%2Fstor-layout.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/d3d4a52a70f2021b3d84cb35f66ba88190e6b5d3/gcc%2Fstor-layout.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fstor-layout.c?ref=d3d4a52a70f2021b3d84cb35f66ba88190e6b5d3", "patch": "@@ -1883,6 +1883,9 @@ finalize_type_size (tree type)\n       && TREE_CODE (TYPE_SIZE_UNIT (type)) != INTEGER_CST)\n     TYPE_SIZE_UNIT (type) = variable_size (TYPE_SIZE_UNIT (type));\n \n+  /* Handle empty records as per the x86-64 psABI.  */\n+  TYPE_EMPTY_P (type) = targetm.calls.empty_record_p (type);\n+\n   /* Also layout any other variants of the type.  */\n   if (TYPE_NEXT_VARIANT (type)\n       || type != TYPE_MAIN_VARIANT (type))\n@@ -1895,6 +1898,7 @@ finalize_type_size (tree type)\n       unsigned int precision = TYPE_PRECISION (type);\n       unsigned int user_align = TYPE_USER_ALIGN (type);\n       machine_mode mode = TYPE_MODE (type);\n+      bool empty_p = TYPE_EMPTY_P (type);\n \n       /* Copy it into all variants.  */\n       for (variant = TYPE_MAIN_VARIANT (type);\n@@ -1911,11 +1915,9 @@ finalize_type_size (tree type)\n \t  SET_TYPE_ALIGN (variant, valign);\n \t  TYPE_PRECISION (variant) = precision;\n \t  SET_TYPE_MODE (variant, mode);\n+\t  TYPE_EMPTY_P (variant) = empty_p;\n \t}\n     }\n-\n-  /* Handle empty records as per the x86-64 psABI.  */\n-  TYPE_EMPTY_P (type) = targetm.calls.empty_record_p (type);\n }\n \n /* Return a new underlying object for a bitfield started with FIELD.  */"}, {"sha": "681971b208e1a468ca836f0822cb12a2ca576d12", "filename": "gcc/testsuite/ChangeLog", "status": "modified", "additions": 3, "deletions": 0, "changes": 3, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/d3d4a52a70f2021b3d84cb35f66ba88190e6b5d3/gcc%2Ftestsuite%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/d3d4a52a70f2021b3d84cb35f66ba88190e6b5d3/gcc%2Ftestsuite%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2FChangeLog?ref=d3d4a52a70f2021b3d84cb35f66ba88190e6b5d3", "patch": "@@ -1,5 +1,8 @@\n 2018-02-22  Jakub Jelinek  <jakub@redhat.com>\n \n+\tPR target/84502\n+\t* g++.dg/torture/pr84502.C: New test.\n+\n \tPR tree-optimization/84503\n \t* gcc.dg/pr84503-1.c: New test.\n \t* gcc.dg/pr84503-2.c: New test."}, {"sha": "befde4e1f0c7ae2435e9b71ae71017304386492e", "filename": "gcc/testsuite/g++.dg/torture/pr84502.C", "status": "added", "additions": 20, "deletions": 0, "changes": 20, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/d3d4a52a70f2021b3d84cb35f66ba88190e6b5d3/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Ftorture%2Fpr84502.C", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/d3d4a52a70f2021b3d84cb35f66ba88190e6b5d3/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Ftorture%2Fpr84502.C", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Ftorture%2Fpr84502.C?ref=d3d4a52a70f2021b3d84cb35f66ba88190e6b5d3", "patch": "@@ -0,0 +1,20 @@\n+// PR target/84502\n+// { dg-do run }\n+\n+template<typename T>\n+struct A { };\n+using X = A<int>;\n+\n+void\n+foo (X, int a1, int a2, int a3, int a4, int a5, int a6, int a7, int a8)\n+{\n+  if (a1 != 0 || a2 != 1 || a3 != 2 || a4 != 3\n+      || a5 != 4 || a6 != 5 || a7 != 6 || a8 != 7)\n+    __builtin_abort ();\n+}\n+\n+int\n+main ()\n+{\n+  foo (X{}, 0, 1, 2, 3, 4, 5, 6, 7);\n+}"}]}