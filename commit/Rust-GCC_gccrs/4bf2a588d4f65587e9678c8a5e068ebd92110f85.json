{"sha": "4bf2a588d4f65587e9678c8a5e068ebd92110f85", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6NGJmMmE1ODhkNGY2NTU4N2U5Njc4YzhhNWUwNjhlYmQ5MjExMGY4NQ==", "commit": {"author": {"name": "Jan Hubicka", "email": "hubicka@ucw.cz", "date": "2014-02-05T00:52:53Z"}, "committer": {"name": "Jan Hubicka", "email": "hubicka@gcc.gnu.org", "date": "2014-02-05T00:52:53Z"}, "message": "ipa-prop.c (detect_type_change): Shor circuit testing of type changes on THIS pointer.\n\n\n\t* ipa-prop.c (detect_type_change): Shor circuit testing of\n\ttype changes on THIS pointer.\n\n\t* g++.dg/ipa/devirrt-22.C: Fix template.\n\nFrom-SVN: r207495", "tree": {"sha": "e585a48e997b5f785feaf19216a43ef36487ea3e", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/e585a48e997b5f785feaf19216a43ef36487ea3e"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/4bf2a588d4f65587e9678c8a5e068ebd92110f85", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/4bf2a588d4f65587e9678c8a5e068ebd92110f85", "html_url": "https://github.com/Rust-GCC/gccrs/commit/4bf2a588d4f65587e9678c8a5e068ebd92110f85", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/4bf2a588d4f65587e9678c8a5e068ebd92110f85/comments", "author": null, "committer": null, "parents": [{"sha": "d92f4df01a7c59cea958574a7d716661bb96a35b", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/d92f4df01a7c59cea958574a7d716661bb96a35b", "html_url": "https://github.com/Rust-GCC/gccrs/commit/d92f4df01a7c59cea958574a7d716661bb96a35b"}], "stats": {"total": 24, "additions": 23, "deletions": 1}, "files": [{"sha": "47b8a7c5f322d747dedc32305192bd8e9dd39933", "filename": "gcc/ChangeLog", "status": "modified", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/4bf2a588d4f65587e9678c8a5e068ebd92110f85/gcc%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/4bf2a588d4f65587e9678c8a5e068ebd92110f85/gcc%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2FChangeLog?ref=4bf2a588d4f65587e9678c8a5e068ebd92110f85", "patch": "@@ -1,3 +1,8 @@\n+2014-02-04  Jan Hubicka  <hubicka@ucw.cz>\n+\n+\t* ipa-prop.c (detect_type_change): Shor circuit testing of\n+\ttype changes on THIS pointer.\n+\n 2014-02-04  John David Anglin  <danglin@gcc.gnu.org>\n \n \tPR target/59777"}, {"sha": "bc23da656b4d0079ee38b890b79dadd33384d353", "filename": "gcc/ipa-prop.c", "status": "modified", "additions": 13, "deletions": 0, "changes": 13, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/4bf2a588d4f65587e9678c8a5e068ebd92110f85/gcc%2Fipa-prop.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/4bf2a588d4f65587e9678c8a5e068ebd92110f85/gcc%2Fipa-prop.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fipa-prop.c?ref=4bf2a588d4f65587e9678c8a5e068ebd92110f85", "patch": "@@ -688,6 +688,19 @@ detect_type_change (tree arg, tree base, tree comp_type, gimple call,\n       || !BINFO_VTABLE (TYPE_BINFO (comp_type)))\n     return false;\n \n+  /* C++ methods are not allowed to change THIS pointer unless they\n+     are constructors or destructors.  */\n+  if (TREE_CODE\t(base) == MEM_REF\n+      && TREE_CODE (TREE_OPERAND (base, 0)) == SSA_NAME\n+      && SSA_NAME_IS_DEFAULT_DEF (TREE_OPERAND (base, 0))\n+      && TREE_CODE (SSA_NAME_VAR (TREE_OPERAND (base, 0))) == PARM_DECL\n+      && TREE_CODE (TREE_TYPE (current_function_decl)) == METHOD_TYPE\n+      && !DECL_CXX_CONSTRUCTOR_P (current_function_decl)\n+      && !DECL_CXX_DESTRUCTOR_P (current_function_decl)\n+      && (SSA_NAME_VAR (TREE_OPERAND (base, 0))\n+\t  == DECL_ARGUMENTS (current_function_decl)))\n+    return false;\n+\n   ao_ref_init (&ao, arg);\n   ao.base = base;\n   ao.offset = offset;"}, {"sha": "4409d870363a9ef682ef42ad388dffecf299d25a", "filename": "gcc/testsuite/ChangeLog", "status": "modified", "additions": 4, "deletions": 0, "changes": 4, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/4bf2a588d4f65587e9678c8a5e068ebd92110f85/gcc%2Ftestsuite%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/4bf2a588d4f65587e9678c8a5e068ebd92110f85/gcc%2Ftestsuite%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2FChangeLog?ref=4bf2a588d4f65587e9678c8a5e068ebd92110f85", "patch": "@@ -1,3 +1,7 @@\n+2014-02-04  Jan Hubicka  <hubicka@ucw.cz>\n+\n+\t* g++.dg/ipa/devirrt-22.C: Fix template.\n+\n 2014-02-04  Marek Polacek  <polacek@redhat.com>\n \n \tPR c/60036"}, {"sha": "37e766945a39ddb403809a32f251c84a3d152d80", "filename": "gcc/testsuite/g++.dg/ipa/devirt-22.C", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/4bf2a588d4f65587e9678c8a5e068ebd92110f85/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Fipa%2Fdevirt-22.C", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/4bf2a588d4f65587e9678c8a5e068ebd92110f85/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Fipa%2Fdevirt-22.C", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Fipa%2Fdevirt-22.C?ref=4bf2a588d4f65587e9678c8a5e068ebd92110f85", "patch": "@@ -37,5 +37,5 @@ void update_sources() {\n /* Note that we miss one devirtualization because we are not able to track the\n    vtbl store in destructor.  \n    Previously we devirtualized to C::m_fn1 instead of B::m_fn1.  */\n-/* { dg-final { scan-tree-dump-times \"Discovered a virtual call to a known target\" 1 \"cp\"  } } */\n+/* { dg-final { scan-ipa-dump-times \"Discovered a virtual call to a known target\" 1 \"cp\"  } } */\n /* { dg-final { cleanup-ipa-dump \"cp\" } } */"}]}