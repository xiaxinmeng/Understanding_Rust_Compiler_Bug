{"sha": "cbbd2b1c82942411f70b41f0aca6f480a01baef8", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6Y2JiZDJiMWM4Mjk0MjQxMWY3MGI0MWYwYWNhNmY0ODBhMDFiYWVmOA==", "commit": {"author": {"name": "Tobias Burnus", "email": "burnus@net-b.de", "date": "2014-04-11T22:43:54Z"}, "committer": {"name": "Tobias Burnus", "email": "burnus@gcc.gnu.org", "date": "2014-04-11T22:43:54Z"}, "message": "re PR c/60194 (-Wformat should also warn when using %d (instead of %u) for unsigned arguments)\n\n2014-04-11  Tobias Burnus  <burnus@net-b.de>\n\n        PR c/60194\ngcc/\n        * doc/invoke.texi (-Wformat-signedness): Document it.\n        (Wformat=2): Mention that this enables -Wformat-signedness.\n\ngcc/c-family/\n        * c.opt (Wformat-signedness): Add\n        * c-format.c(check_format_types): Use it.\n\ngcc/testsuite/\n        * * g++.dg/warn/warn_format_signedness.C: New.\n        * gcc.dg/format/warn-signedness.c: New.\n\nFrom-SVN: r209328", "tree": {"sha": "393f5424c8fd3418772e0a6d95aebafeafbc5175", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/393f5424c8fd3418772e0a6d95aebafeafbc5175"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/cbbd2b1c82942411f70b41f0aca6f480a01baef8", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/cbbd2b1c82942411f70b41f0aca6f480a01baef8", "html_url": "https://github.com/Rust-GCC/gccrs/commit/cbbd2b1c82942411f70b41f0aca6f480a01baef8", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/cbbd2b1c82942411f70b41f0aca6f480a01baef8/comments", "author": {"login": "tob2", "id": 264461, "node_id": "MDQ6VXNlcjI2NDQ2MQ==", "avatar_url": "https://avatars.githubusercontent.com/u/264461?v=4", "gravatar_id": "", "url": "https://api.github.com/users/tob2", "html_url": "https://github.com/tob2", "followers_url": "https://api.github.com/users/tob2/followers", "following_url": "https://api.github.com/users/tob2/following{/other_user}", "gists_url": "https://api.github.com/users/tob2/gists{/gist_id}", "starred_url": "https://api.github.com/users/tob2/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/tob2/subscriptions", "organizations_url": "https://api.github.com/users/tob2/orgs", "repos_url": "https://api.github.com/users/tob2/repos", "events_url": "https://api.github.com/users/tob2/events{/privacy}", "received_events_url": "https://api.github.com/users/tob2/received_events", "type": "User", "site_admin": false}, "committer": null, "parents": [{"sha": "cb41490017822947d5d5c9dbf713af00af306110", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/cb41490017822947d5d5c9dbf713af00af306110", "html_url": "https://github.com/Rust-GCC/gccrs/commit/cb41490017822947d5d5c9dbf713af00af306110"}], "stats": {"total": 58, "additions": 55, "deletions": 3}, "files": [{"sha": "fd681633384f581dfceb2d67268c62d1543ba736", "filename": "gcc/ChangeLog", "status": "modified", "additions": 6, "deletions": 0, "changes": 6, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/cbbd2b1c82942411f70b41f0aca6f480a01baef8/gcc%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/cbbd2b1c82942411f70b41f0aca6f480a01baef8/gcc%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2FChangeLog?ref=cbbd2b1c82942411f70b41f0aca6f480a01baef8", "patch": "@@ -1,3 +1,9 @@\n+2014-04-11  Tobias Burnus  <burnus@net-b.de>\n+\n+\tPR c/60194\n+\t* doc/invoke.texi (-Wformat-signedness): Document it.\n+\t(Wformat=2): Mention that this enables -Wformat-signedness.\n+\n 2014-04-11  Joern Rennecke  <joern.rennecke@embecosm.com>\n \n \t* common/config/epiphany/epiphany-common.c"}, {"sha": "34354a31e1e41e04364c01f8815198f49896c052", "filename": "gcc/c-family/ChangeLog", "status": "modified", "additions": 6, "deletions": 0, "changes": 6, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/cbbd2b1c82942411f70b41f0aca6f480a01baef8/gcc%2Fc-family%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/cbbd2b1c82942411f70b41f0aca6f480a01baef8/gcc%2Fc-family%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fc-family%2FChangeLog?ref=cbbd2b1c82942411f70b41f0aca6f480a01baef8", "patch": "@@ -1,3 +1,9 @@\n+2014-04-11  Tobias Burnus  <burnus@net-b.de>\n+\n+\tPR c/60194\n+\t* c.opt (Wformat-signedness): Add\n+\t* c-format.c(check_format_types): Use it.\n+\n 2014-04-11  Jason Merrill  <jason@redhat.com>\n \n \tPR c++/57926"}, {"sha": "4c0313dc85fa90c4bb9cc1ff5716734540173aa1", "filename": "gcc/c-family/c-format.c", "status": "modified", "additions": 3, "deletions": 1, "changes": 4, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/cbbd2b1c82942411f70b41f0aca6f480a01baef8/gcc%2Fc-family%2Fc-format.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/cbbd2b1c82942411f70b41f0aca6f480a01baef8/gcc%2Fc-family%2Fc-format.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fc-family%2Fc-format.c?ref=cbbd2b1c82942411f70b41f0aca6f480a01baef8", "patch": "@@ -2418,7 +2418,9 @@ check_format_types (format_wanted_type *types)\n \t a second level of indirection.  */\n       if (TREE_CODE (wanted_type) == INTEGER_TYPE\n \t  && TREE_CODE (cur_type) == INTEGER_TYPE\n-\t  && (!pedantic || i == 0 || (i == 1 && char_type_flag))\n+\t  && ((!pedantic && !warn_format_signedness)\n+\t      || (i == 0 && !warn_format_signedness)\n+\t      || (i == 1 && char_type_flag))\n \t  && (TYPE_UNSIGNED (wanted_type)\n \t      ? wanted_type == c_common_unsigned_type (cur_type)\n \t      : wanted_type == c_common_signed_type (cur_type)))"}, {"sha": "390c056becc8f8063309b5d4797a30d95400f594", "filename": "gcc/c-family/c.opt", "status": "modified", "additions": 4, "deletions": 0, "changes": 4, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/cbbd2b1c82942411f70b41f0aca6f480a01baef8/gcc%2Fc-family%2Fc.opt", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/cbbd2b1c82942411f70b41f0aca6f480a01baef8/gcc%2Fc-family%2Fc.opt", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fc-family%2Fc.opt?ref=cbbd2b1c82942411f70b41f0aca6f480a01baef8", "patch": "@@ -415,6 +415,10 @@ Wformat-security\n C ObjC C++ ObjC++ Var(warn_format_security) Warning LangEnabledBy(C ObjC C++ ObjC++,Wformat=, warn_format >= 2, 0)\n Warn about possible security problems with format functions\n \n+Wformat-signedness\n+C ObjC C++ ObjC++ Var(warn_format_signedness) Warning LangEnabledBy(C ObjC C++ ObjC++,Wformat=, warn_format >= 2, 0)\n+Warn about sign differences with format functions\n+\n Wformat-y2k\n C ObjC C++ ObjC++ Var(warn_format_y2k) Warning LangEnabledBy(C ObjC C++ ObjC++,Wformat=,warn_format >= 2, 0)\n Warn about strftime formats yielding 2-digit years"}, {"sha": "860a545d95f3ada1d1984622ce5fe6bab96b2bb2", "filename": "gcc/doc/invoke.texi", "status": "modified", "additions": 8, "deletions": 2, "changes": 10, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/cbbd2b1c82942411f70b41f0aca6f480a01baef8/gcc%2Fdoc%2Finvoke.texi", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/cbbd2b1c82942411f70b41f0aca6f480a01baef8/gcc%2Fdoc%2Finvoke.texi", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fdoc%2Finvoke.texi?ref=cbbd2b1c82942411f70b41f0aca6f480a01baef8", "patch": "@@ -246,7 +246,7 @@ Objective-C and Objective-C++ Dialects}.\n -Wno-endif-labels -Werror  -Werror=* @gol\n -Wfatal-errors  -Wfloat-equal  -Wformat  -Wformat=2 @gol\n -Wno-format-contains-nul -Wno-format-extra-args -Wformat-nonliteral @gol\n--Wformat-security  -Wformat-y2k @gol\n+-Wformat-security  -Wformat-signedness  -Wformat-y2k @gol\n -Wframe-larger-than=@var{len} -Wno-free-nonheap-object -Wjump-misses-init @gol\n -Wignored-qualifiers @gol\n -Wimplicit  -Wimplicit-function-declaration  -Wimplicit-int @gol\n@@ -3539,7 +3539,7 @@ The C standard specifies that zero-length formats are allowed.\n @opindex Wformat=2\n Enable @option{-Wformat} plus additional format checks.  Currently\n equivalent to @option{-Wformat -Wformat-nonliteral -Wformat-security\n--Wformat-y2k}.\n+-Wformat-signedness -Wformat-y2k}.\n \n @item -Wformat-nonliteral\n @opindex Wformat-nonliteral\n@@ -3561,6 +3561,12 @@ currently a subset of what @option{-Wformat-nonliteral} warns about, but\n in future warnings may be added to @option{-Wformat-security} that are not\n included in @option{-Wformat-nonliteral}.)\n \n+@item -Wformat-signedness\n+@opindex Wformat-signedness\n+@opindex Wno-format-signedness\n+If @option{-Wformat} is specified, also warn if the format string\n+requires an unsigned argument and the argument is signed and vice versa.\n+\n @item -Wformat-y2k\n @opindex Wformat-y2k\n @opindex Wno-format-y2k"}, {"sha": "97a80a37a2a6a0ba9f1a32163b9cc4da3e94275f", "filename": "gcc/testsuite/ChangeLog", "status": "modified", "additions": 6, "deletions": 0, "changes": 6, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/cbbd2b1c82942411f70b41f0aca6f480a01baef8/gcc%2Ftestsuite%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/cbbd2b1c82942411f70b41f0aca6f480a01baef8/gcc%2Ftestsuite%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2FChangeLog?ref=cbbd2b1c82942411f70b41f0aca6f480a01baef8", "patch": "@@ -1,3 +1,9 @@\n+2014-04-11  Tobias Burnus  <burnus@net-b.de>\n+\n+\tPR c/60194\n+\t* * g++.dg/warn/warn_format_signedness.C: New.\n+\t* gcc.dg/format/warn-signedness.c: New.\n+\n 2014-04-11  Tobias Burnus  <burnus@net-b.de>\n \n \tPR fortran/58880"}, {"sha": "473d522c8a678f9bdaea136fffdab4303ce2ed37", "filename": "gcc/testsuite/g++.dg/warn/warn_format_signedness.C", "status": "added", "additions": 11, "deletions": 0, "changes": 11, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/cbbd2b1c82942411f70b41f0aca6f480a01baef8/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Fwarn%2Fwarn_format_signedness.C", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/cbbd2b1c82942411f70b41f0aca6f480a01baef8/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Fwarn%2Fwarn_format_signedness.C", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Fwarn%2Fwarn_format_signedness.C?ref=cbbd2b1c82942411f70b41f0aca6f480a01baef8", "patch": "@@ -0,0 +1,11 @@\n+/* { dg-do compile }  */\n+/* { dg-options \"-Wformat -Wformat-signedness\" }  */\n+\n+/* PR c/60194  */\n+\n+void foo(unsigned u, int i, unsigned char uc, signed char sc) {\n+  __builtin_printf(\"%d\\n\", u);  /* { dg-warning \"expects argument of type 'int', but argument 2 has type 'unsigned int'\" } */\n+  __builtin_printf(\"%u\\n\", i);  /* { dg-warning \"expects argument of type 'unsigned int', but argument 2 has type 'int'\" } */\n+  __builtin_printf(\"%c\\n\", sc);\n+  __builtin_printf(\"%c\\n\", uc);\n+}"}, {"sha": "473d522c8a678f9bdaea136fffdab4303ce2ed37", "filename": "gcc/testsuite/gcc.dg/format/warn-signedness.c", "status": "added", "additions": 11, "deletions": 0, "changes": 11, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/cbbd2b1c82942411f70b41f0aca6f480a01baef8/gcc%2Ftestsuite%2Fgcc.dg%2Fformat%2Fwarn-signedness.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/cbbd2b1c82942411f70b41f0aca6f480a01baef8/gcc%2Ftestsuite%2Fgcc.dg%2Fformat%2Fwarn-signedness.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgcc.dg%2Fformat%2Fwarn-signedness.c?ref=cbbd2b1c82942411f70b41f0aca6f480a01baef8", "patch": "@@ -0,0 +1,11 @@\n+/* { dg-do compile }  */\n+/* { dg-options \"-Wformat -Wformat-signedness\" }  */\n+\n+/* PR c/60194  */\n+\n+void foo(unsigned u, int i, unsigned char uc, signed char sc) {\n+  __builtin_printf(\"%d\\n\", u);  /* { dg-warning \"expects argument of type 'int', but argument 2 has type 'unsigned int'\" } */\n+  __builtin_printf(\"%u\\n\", i);  /* { dg-warning \"expects argument of type 'unsigned int', but argument 2 has type 'int'\" } */\n+  __builtin_printf(\"%c\\n\", sc);\n+  __builtin_printf(\"%c\\n\", uc);\n+}"}]}