{"sha": "a58762287e1a75e29df3d6e80e7b22e3ff03a320", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6YTU4NzYyMjg3ZTFhNzVlMjlkZjNkNmU4MGU3YjIyZTNmZjAzYTMyMA==", "commit": {"author": {"name": "Chung-Ju Wu", "email": "jasonwucj@gmail.com", "date": "2018-04-06T18:36:28Z"}, "committer": {"name": "Chung-Ju Wu", "email": "jasonwucj@gcc.gnu.org", "date": "2018-04-06T18:36:28Z"}, "message": "[NDS32] Refine ADJUST_INSN_LENGTH implementation.\n\ngcc/\n\t* config/nds32/nds32.c (nds32_adjust_insn_length): Refine.\n\t* config/nds32/nds32.h (ADJUST_INSN_LENGTH): Change the location in\n\tfile.\n\nFrom-SVN: r259187", "tree": {"sha": "286cd9ae620e38054bba7ba340b62b254e539fa0", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/286cd9ae620e38054bba7ba340b62b254e539fa0"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/a58762287e1a75e29df3d6e80e7b22e3ff03a320", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/a58762287e1a75e29df3d6e80e7b22e3ff03a320", "html_url": "https://github.com/Rust-GCC/gccrs/commit/a58762287e1a75e29df3d6e80e7b22e3ff03a320", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/a58762287e1a75e29df3d6e80e7b22e3ff03a320/comments", "author": {"login": "jasonwucj", "id": 5520732, "node_id": "MDQ6VXNlcjU1MjA3MzI=", "avatar_url": "https://avatars.githubusercontent.com/u/5520732?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jasonwucj", "html_url": "https://github.com/jasonwucj", "followers_url": "https://api.github.com/users/jasonwucj/followers", "following_url": "https://api.github.com/users/jasonwucj/following{/other_user}", "gists_url": "https://api.github.com/users/jasonwucj/gists{/gist_id}", "starred_url": "https://api.github.com/users/jasonwucj/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jasonwucj/subscriptions", "organizations_url": "https://api.github.com/users/jasonwucj/orgs", "repos_url": "https://api.github.com/users/jasonwucj/repos", "events_url": "https://api.github.com/users/jasonwucj/events{/privacy}", "received_events_url": "https://api.github.com/users/jasonwucj/received_events", "type": "User", "site_admin": false}, "committer": null, "parents": [{"sha": "f46706733954c2868af5e91687931538600b2a92", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/f46706733954c2868af5e91687931538600b2a92", "html_url": "https://github.com/Rust-GCC/gccrs/commit/f46706733954c2868af5e91687931538600b2a92"}], "stats": {"total": 73, "additions": 38, "deletions": 35}, "files": [{"sha": "f92cd60aed13e58b2f813945721b3365bece373c", "filename": "gcc/ChangeLog", "status": "modified", "additions": 6, "deletions": 0, "changes": 6, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/a58762287e1a75e29df3d6e80e7b22e3ff03a320/gcc%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/a58762287e1a75e29df3d6e80e7b22e3ff03a320/gcc%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2FChangeLog?ref=a58762287e1a75e29df3d6e80e7b22e3ff03a320", "patch": "@@ -1,3 +1,9 @@\n+2018-04-06  Chung-Ju Wu  <jasonwucj@gmail.com>\n+\n+\t* config/nds32/nds32.c (nds32_adjust_insn_length): Refine.\n+\t* config/nds32/nds32.h (ADJUST_INSN_LENGTH): Change the location in\n+\tfile.\n+\n 2018-04-06  Chung-Ju Wu  <jasonwucj@gmail.com>\n \t    Kito Cheng  <kito.cheng@gmail.com>\n "}, {"sha": "030fb2e0224a22e1b3cf72bf44bc29f57ed1db2b", "filename": "gcc/config/nds32/nds32.c", "status": "modified", "additions": 29, "deletions": 31, "changes": 60, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/a58762287e1a75e29df3d6e80e7b22e3ff03a320/gcc%2Fconfig%2Fnds32%2Fnds32.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/a58762287e1a75e29df3d6e80e7b22e3ff03a320/gcc%2Fconfig%2Fnds32%2Fnds32.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fconfig%2Fnds32%2Fnds32.c?ref=a58762287e1a75e29df3d6e80e7b22e3ff03a320", "patch": "@@ -1328,6 +1328,35 @@ nds32_register_passes (void)\n /* PART 3: Implement target hook stuff definitions.  */\n \f\n \n+/* Computing the Length of an Insn.\n+   Modifies the length assigned to instruction INSN.\n+   LEN is the initially computed length of the insn.  */\n+int\n+nds32_adjust_insn_length (rtx_insn *insn, int length)\n+{\n+  int adjust_value = 0;\n+  switch (recog_memoized (insn))\n+    {\n+    case CODE_FOR_call_internal:\n+    case CODE_FOR_call_value_internal:\n+      {\n+\t/* We need insert a nop after a noretun function call\n+\t   to prevent software breakpoint corrupt the next function. */\n+\tif (find_reg_note (insn, REG_NORETURN, NULL_RTX))\n+\t  {\n+\t    if (TARGET_16_BIT)\n+\t      adjust_value += 2;\n+\t    else\n+\t      adjust_value += 4;\n+\t  }\n+      }\n+      return length + adjust_value;\n+\n+    default:\n+      return length;\n+    }\n+}\n+\n /* Register Usage.  */\n \n static void\n@@ -4364,37 +4393,6 @@ nds32_ls_333_p (rtx rt, rtx ra, rtx imm, machine_mode mode)\n   return false;\n }\n \n-\n-/* Computing the Length of an Insn.\n-   Modifies the length assigned to instruction INSN.\n-   LEN is the initially computed length of the insn.  */\n-int\n-nds32_adjust_insn_length (rtx_insn *insn, int length)\n-{\n-  rtx src, dst;\n-\n-  switch (recog_memoized (insn))\n-    {\n-    case CODE_FOR_move_df:\n-    case CODE_FOR_move_di:\n-      /* Adjust length of movd44 to 2.  */\n-      src = XEXP (PATTERN (insn), 1);\n-      dst = XEXP (PATTERN (insn), 0);\n-\n-      if (REG_P (src)\n-\t  && REG_P (dst)\n-\t  && (REGNO (src) % 2) == 0\n-\t  && (REGNO (dst) % 2) == 0)\n-\tlength = 2;\n-      break;\n-\n-    default:\n-      break;\n-    }\n-\n-  return length;\n-}\n-\n bool\n nds32_split_double_word_load_store_p(rtx *operands, bool load_p)\n {"}, {"sha": "934fe03ba17de7695a2629c773668d4faf04d8a3", "filename": "gcc/config/nds32/nds32.h", "status": "modified", "additions": 3, "deletions": 4, "changes": 7, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/a58762287e1a75e29df3d6e80e7b22e3ff03a320/gcc%2Fconfig%2Fnds32%2Fnds32.h", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/a58762287e1a75e29df3d6e80e7b22e3ff03a320/gcc%2Fconfig%2Fnds32%2Fnds32.h", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fconfig%2Fnds32%2Fnds32.h?ref=a58762287e1a75e29df3d6e80e7b22e3ff03a320", "patch": "@@ -24,6 +24,9 @@\n /* The following are auxiliary macros or structure declarations\n    that are used all over the nds32.c and nds32.h.  */\n \n+#define ADJUST_INSN_LENGTH(INSN, LENGTH) \\\n+  (LENGTH = nds32_adjust_insn_length (INSN, LENGTH))\n+\n /* Use SYMBOL_FLAG_MACH_DEP to define our own symbol_ref flag.\n    It is used in nds32_encode_section_info() to store flag in symbol_ref\n    in case the symbol should be placed in .rodata section.\n@@ -41,10 +44,6 @@ enum nds32_expand_result_type\n   EXPAND_CREATE_TEMPLATE\n };\n \n-/* Computing the Length of an Insn.  */\n-#define ADJUST_INSN_LENGTH(INSN, LENGTH) \\\n-  (LENGTH = nds32_adjust_insn_length (INSN, LENGTH))\n-\n /* Check instruction LS-37-FP-implied form.\n    Note: actually its immediate range is imm9u\n          since it is used for lwi37/swi37 instructions.  */"}]}