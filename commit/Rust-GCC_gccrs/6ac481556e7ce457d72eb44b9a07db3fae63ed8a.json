{"sha": "6ac481556e7ce457d72eb44b9a07db3fae63ed8a", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6NmFjNDgxNTU2ZTdjZTQ1N2Q3MmViNDRiOWEwN2RiM2ZhZTYzZWQ4YQ==", "commit": {"author": {"name": "David Malcolm", "email": "dmalcolm@redhat.com", "date": "2015-06-02T18:45:50Z"}, "committer": {"name": "David Malcolm", "email": "dmalcolm@gcc.gnu.org", "date": "2015-06-02T18:45:50Z"}, "message": "PR c/66220: Fix false positive from -Wmisleading-indentation\n\ngcc/c-family/ChangeLog:\n\tPR c/66220:\n\t* c-indentation.c (should_warn_for_misleading_indentation): Use\n\texpand_location rather than expand_location_to_spelling_point.\n\tDon't warn if the guarding statement is more indented than the\n\tnext/body stmts.\n\ngcc/testsuite/ChangeLog:\n\tPR c/66220:\n\t* c-c++-common/Wmisleading-indentation.c (fn_35): New.\n\t(fn_36): New.\n\nFrom-SVN: r224041", "tree": {"sha": "978f85d03f17cc62ee6d5c54d34589c0e09a0def", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/978f85d03f17cc62ee6d5c54d34589c0e09a0def"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/6ac481556e7ce457d72eb44b9a07db3fae63ed8a", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/6ac481556e7ce457d72eb44b9a07db3fae63ed8a", "html_url": "https://github.com/Rust-GCC/gccrs/commit/6ac481556e7ce457d72eb44b9a07db3fae63ed8a", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/6ac481556e7ce457d72eb44b9a07db3fae63ed8a/comments", "author": {"login": "davidmalcolm", "id": 1553248, "node_id": "MDQ6VXNlcjE1NTMyNDg=", "avatar_url": "https://avatars.githubusercontent.com/u/1553248?v=4", "gravatar_id": "", "url": "https://api.github.com/users/davidmalcolm", "html_url": "https://github.com/davidmalcolm", "followers_url": "https://api.github.com/users/davidmalcolm/followers", "following_url": "https://api.github.com/users/davidmalcolm/following{/other_user}", "gists_url": "https://api.github.com/users/davidmalcolm/gists{/gist_id}", "starred_url": "https://api.github.com/users/davidmalcolm/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/davidmalcolm/subscriptions", "organizations_url": "https://api.github.com/users/davidmalcolm/orgs", "repos_url": "https://api.github.com/users/davidmalcolm/repos", "events_url": "https://api.github.com/users/davidmalcolm/events{/privacy}", "received_events_url": "https://api.github.com/users/davidmalcolm/received_events", "type": "User", "site_admin": false}, "committer": null, "parents": [{"sha": "773ce42e90609a47d648eed62afc05a2f309f300", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/773ce42e90609a47d648eed62afc05a2f309f300", "html_url": "https://github.com/Rust-GCC/gccrs/commit/773ce42e90609a47d648eed62afc05a2f309f300"}], "stats": {"total": 78, "additions": 70, "deletions": 8}, "files": [{"sha": "f1501bcb335fc83b128b5cc7870fc3c08bf6cba3", "filename": "gcc/c-family/ChangeLog", "status": "modified", "additions": 8, "deletions": 0, "changes": 8, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/6ac481556e7ce457d72eb44b9a07db3fae63ed8a/gcc%2Fc-family%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/6ac481556e7ce457d72eb44b9a07db3fae63ed8a/gcc%2Fc-family%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fc-family%2FChangeLog?ref=6ac481556e7ce457d72eb44b9a07db3fae63ed8a", "patch": "@@ -1,3 +1,11 @@\n+2015-06-02  David Malcolm  <dmalcolm@redhat.com>\n+\n+\tPR c/66220:\n+\t* c-indentation.c (should_warn_for_misleading_indentation): Use\n+\texpand_location rather than expand_location_to_spelling_point.\n+\tDon't warn if the guarding statement is more indented than the\n+\tnext/body stmts.\n+\n 2015-06-02  David Malcolm  <dmalcolm@redhat.com>\n \n \t* c-indentation.c (warn_for_misleading_indentation): Bail out"}, {"sha": "1e3a6d82f279c55ce45fb4dbb80fba810f68659a", "filename": "gcc/c-family/c-indentation.c", "status": "modified", "additions": 18, "deletions": 8, "changes": 26, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/6ac481556e7ce457d72eb44b9a07db3fae63ed8a/gcc%2Fc-family%2Fc-indentation.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/6ac481556e7ce457d72eb44b9a07db3fae63ed8a/gcc%2Fc-family%2Fc-indentation.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fc-family%2Fc-indentation.c?ref=6ac481556e7ce457d72eb44b9a07db3fae63ed8a", "patch": "@@ -230,10 +230,8 @@ should_warn_for_misleading_indentation (location_t guard_loc,\n   if (next_tok_type == CPP_SEMICOLON)\n     return false;\n \n-  expanded_location body_exploc\n-    = expand_location_to_spelling_point (body_loc);\n-  expanded_location next_stmt_exploc\n-    = expand_location_to_spelling_point (next_stmt_loc);\n+  expanded_location body_exploc = expand_location (body_loc);\n+  expanded_location next_stmt_exploc = expand_location (next_stmt_loc);\n \n   /* They must be in the same file.  */\n   if (next_stmt_exploc.file != body_exploc.file)\n@@ -257,8 +255,7 @@ should_warn_for_misleading_indentation (location_t guard_loc,\n                                           ^ DON'T WARN HERE.  */\n   if (next_stmt_exploc.line == body_exploc.line)\n     {\n-      expanded_location guard_exploc\n-\t= expand_location_to_spelling_point (guard_loc);\n+      expanded_location guard_exploc = expand_location (guard_loc);\n       if (guard_exploc.file != body_exploc.file)\n \treturn true;\n       if (guard_exploc.line < body_exploc.line)\n@@ -299,6 +296,15 @@ should_warn_for_misleading_indentation (location_t guard_loc,\n       #endif\n \t  bar ();\n \t  ^ DON'T WARN HERE\n+\n+        if (flag) {\n+          foo ();\n+        } else\n+        {\n+          bar ();\n+        }\n+        baz ();\n+        ^ DON'T WARN HERE\n   */\n   if (next_stmt_exploc.line > body_exploc.line)\n     {\n@@ -319,14 +325,18 @@ should_warn_for_misleading_indentation (location_t guard_loc,\n \t  /* Don't warn if they aren't aligned on the same column\n \t     as the guard itself (suggesting autogenerated code that\n \t     doesn't bother indenting at all).  */\n-\t  expanded_location guard_exploc\n-\t    = expand_location_to_spelling_point (guard_loc);\n+\t  expanded_location guard_exploc = expand_location (guard_loc);\n \t  unsigned int guard_vis_column;\n \t  if (!get_visual_column (guard_exploc, &guard_vis_column))\n \t    return false;\n \t  if (guard_vis_column == body_vis_column)\n \t    return false;\n \n+\t  /* PR 66220: Don't warn if the guarding statement is more\n+\t     indented than the next/body stmts.  */\n+\t  if (guard_vis_column > body_vis_column)\n+\t    return false;\n+\n \t  /* Don't warn if there is multiline preprocessor logic between\n \t     the two statements. */\n \t  if (detect_preprocessor_logic (body_exploc, next_stmt_exploc))"}, {"sha": "70a05dae193a0f322847ff04d87f4548ef1718ab", "filename": "gcc/testsuite/ChangeLog", "status": "modified", "additions": 6, "deletions": 0, "changes": 6, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/6ac481556e7ce457d72eb44b9a07db3fae63ed8a/gcc%2Ftestsuite%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/6ac481556e7ce457d72eb44b9a07db3fae63ed8a/gcc%2Ftestsuite%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2FChangeLog?ref=6ac481556e7ce457d72eb44b9a07db3fae63ed8a", "patch": "@@ -1,3 +1,9 @@\n+2015-06-02  David Malcolm  <dmalcolm@redhat.com>\n+\n+\tPR c/66220:\n+\t* c-c++-common/Wmisleading-indentation.c (fn_35): New.\n+\t(fn_36): New.\n+\n 2015-06-02  Prathamesh Kulkarni  <prathamesh.kulkarni@linaro.org>\n \n \tPR c/49551"}, {"sha": "443e3ddc30aa047edbd8359e8abc6d698ae43b0f", "filename": "gcc/testsuite/c-c++-common/Wmisleading-indentation.c", "status": "modified", "additions": 38, "deletions": 0, "changes": 38, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/6ac481556e7ce457d72eb44b9a07db3fae63ed8a/gcc%2Ftestsuite%2Fc-c%2B%2B-common%2FWmisleading-indentation.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/6ac481556e7ce457d72eb44b9a07db3fae63ed8a/gcc%2Ftestsuite%2Fc-c%2B%2B-common%2FWmisleading-indentation.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fc-c%2B%2B-common%2FWmisleading-indentation.c?ref=6ac481556e7ce457d72eb44b9a07db3fae63ed8a", "patch": "@@ -653,3 +653,41 @@ void fn_34_indent_linux_style(void)\n \t\t}\n \tfoo(5);\n }\n+\n+/* PR 66220.  */\n+int fn_35 (int v)\n+{\n+    int res = 28;\n+\n+    if (v == 2)\n+    {\n+        res = 27;\n+    } else\n+    {\n+        res = 18;\n+    }\n+    return res;\n+}\n+\n+/* This variant of K&R-style formatting (in the presence of conditional\n+   compilation) shouldn't lead to a warning.\n+\n+   Based on false positive seen with r223098 when compiling\n+   linux-4.0.3:arch/x86/crypto/aesni-intel_glue.c:aesni_init.  */\n+void\n+fn_36 (void)\n+{\n+#if 1 /* e.g. some configuration variable.  */\n+\tif (flagA) {\n+\t\tfoo(0);\n+\t\tfoo(1);\n+\t\tfoo(2);\n+\t} else\n+#endif\n+\t{\n+\t\tfoo(3);\n+\t\tfoo(4);\n+\t\tfoo(5);\n+\t}\n+\tfoo(6); /* We shouldn't warn here.  */\n+}"}]}