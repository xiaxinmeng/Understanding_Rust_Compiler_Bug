{"sha": "bb1ecfe8a92497f7040e522ffbf0572b00b92492", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6YmIxZWNmZThhOTI0OTdmNzA0MGU1MjJmZmJmMDU3MmIwMGI5MjQ5Mg==", "commit": {"author": {"name": "Richard Henderson", "email": "rth@redhat.com", "date": "2005-08-05T23:01:54Z"}, "committer": {"name": "Richard Henderson", "email": "rth@gcc.gnu.org", "date": "2005-08-05T23:01:54Z"}, "message": "re PR middle-end/21728 (Nonlocal goto from an unused nested function)\n\n        PR 21728\n        * tree-cfg.c (remove_bb): Transmute DECL_NONLOCAL labels into\n        FORCED_LABEL labels.\n\nFrom-SVN: r102786", "tree": {"sha": "ad686c8439d31d25ef09c4a852f5a872604eaa5e", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/ad686c8439d31d25ef09c4a852f5a872604eaa5e"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/bb1ecfe8a92497f7040e522ffbf0572b00b92492", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/bb1ecfe8a92497f7040e522ffbf0572b00b92492", "html_url": "https://github.com/Rust-GCC/gccrs/commit/bb1ecfe8a92497f7040e522ffbf0572b00b92492", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/bb1ecfe8a92497f7040e522ffbf0572b00b92492/comments", "author": null, "committer": null, "parents": [{"sha": "0e44ef6254bfa00961521b596e0d3ea703119ec0", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/0e44ef6254bfa00961521b596e0d3ea703119ec0", "html_url": "https://github.com/Rust-GCC/gccrs/commit/0e44ef6254bfa00961521b596e0d3ea703119ec0"}], "stats": {"total": 34, "additions": 31, "deletions": 3}, "files": [{"sha": "3a9b189c9de8d48125696a31cce28911a5183356", "filename": "gcc/ChangeLog", "status": "modified", "additions": 6, "deletions": 0, "changes": 6, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/bb1ecfe8a92497f7040e522ffbf0572b00b92492/gcc%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/bb1ecfe8a92497f7040e522ffbf0572b00b92492/gcc%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2FChangeLog?ref=bb1ecfe8a92497f7040e522ffbf0572b00b92492", "patch": "@@ -1,3 +1,9 @@\n+2005-08-05  Richard Henderson  <rth@redhat.com>\n+\n+\tPR 21728\n+\t* tree-cfg.c (remove_bb): Transmute DECL_NONLOCAL labels into\n+\tFORCED_LABEL labels.\n+\n 2005-08-05  J\"orn Rennecke <joern.rennecke@st.com>\n \n \tPR middle-end/23135"}, {"sha": "991cb3886f85681bdd2892e74bc67bd2ad9e7adb", "filename": "gcc/testsuite/gcc.c-torture/compile/pr21728.c", "status": "added", "additions": 10, "deletions": 0, "changes": 10, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/bb1ecfe8a92497f7040e522ffbf0572b00b92492/gcc%2Ftestsuite%2Fgcc.c-torture%2Fcompile%2Fpr21728.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/bb1ecfe8a92497f7040e522ffbf0572b00b92492/gcc%2Ftestsuite%2Fgcc.c-torture%2Fcompile%2Fpr21728.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgcc.c-torture%2Fcompile%2Fpr21728.c?ref=bb1ecfe8a92497f7040e522ffbf0572b00b92492", "patch": "@@ -0,0 +1,10 @@\n+int main (void)\n+{\n+  __label__ l1;\n+  void __attribute__((used)) q(void)\n+  {\n+    goto l1;\n+  }\n+\n+  l1:;\n+}"}, {"sha": "70dca21bc83aadd63d41ec9508502693f7d0278c", "filename": "gcc/tree-cfg.c", "status": "modified", "additions": 15, "deletions": 3, "changes": 18, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/bb1ecfe8a92497f7040e522ffbf0572b00b92492/gcc%2Ftree-cfg.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/bb1ecfe8a92497f7040e522ffbf0572b00b92492/gcc%2Ftree-cfg.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftree-cfg.c?ref=bb1ecfe8a92497f7040e522ffbf0572b00b92492", "patch": "@@ -1983,11 +1983,23 @@ remove_bb (basic_block bb)\n     {\n       tree stmt = bsi_stmt (i);\n       if (TREE_CODE (stmt) == LABEL_EXPR\n-          && FORCED_LABEL (LABEL_EXPR_LABEL (stmt)))\n+          && (FORCED_LABEL (LABEL_EXPR_LABEL (stmt))\n+\t      || DECL_NONLOCAL (LABEL_EXPR_LABEL (stmt))))\n \t{\n-\t  basic_block new_bb = bb->prev_bb;\n-\t  block_stmt_iterator new_bsi = bsi_start (new_bb);\n+\t  basic_block new_bb;\n+\t  block_stmt_iterator new_bsi;\n+\n+\t  /* A non-reachable non-local label may still be referenced.\n+\t     But it no longer needs to carry the extra semantics of\n+\t     non-locality.  */\n+\t  if (DECL_NONLOCAL (LABEL_EXPR_LABEL (stmt)))\n+\t    {\n+\t      DECL_NONLOCAL (LABEL_EXPR_LABEL (stmt)) = 0;\n+\t      FORCED_LABEL (LABEL_EXPR_LABEL (stmt)) = 1;\n+\t    }\n \t  \t  \n+\t  new_bb = bb->prev_bb;\n+\t  new_bsi = bsi_start (new_bb);\n \t  bsi_remove (&i);\n \t  bsi_insert_before (&new_bsi, stmt, BSI_NEW_STMT);\n \t}"}]}