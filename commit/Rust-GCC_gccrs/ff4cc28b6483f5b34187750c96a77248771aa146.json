{"sha": "ff4cc28b6483f5b34187750c96a77248771aa146", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6ZmY0Y2MyOGI2NDgzZjViMzQxODc3NTBjOTZhNzcyNDg3NzFhYTE0Ng==", "commit": {"author": {"name": "Thomas Fitzsimmons", "email": "fitzsim@redhat.com", "date": "2003-10-07T21:33:29Z"}, "committer": {"name": "Thomas Fitzsimmons", "email": "fitzsim@gcc.gnu.org", "date": "2003-10-07T21:33:29Z"}, "message": "GtkTextAreaPeer.java (gtkTextGetSize): Remove unused parameters.\n\n2003-10-07  Thomas Fitzsimmons  <fitzsim@redhat.com>\n\n\t* gnu/java/awt/peer/gtk/GtkTextAreaPeer.java (gtkTextGetSize):\n\tRemove unused parameters.\n\t* gnu/java/awt/peer/gtk/GtkTextFieldPeer.java (gtkEntryGetSize):\n\tLikewise.\n\t* jni/gtk-peer/gnu_java_awt_peer_gtk_GtkEvents.c\n\t(keyevent_state_to_awt_mods): Export function.\n\t* jni/gtk-peer/gnu_java_awt_peer_gtk_GtkTextComponentPeer.c\n\t(getCaretPosition): Fix TextArea case.\n\t(textcomponent_commit_cb): Get exact event time and modifier\n\tstate.\n\t* jni/gtk-peer/gtkpeer.h: Declare keyevent_state_to_awt_mods.\n\nFrom-SVN: r72202", "tree": {"sha": "80b71e797e1e02c98da15da3d83d404307827f60", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/80b71e797e1e02c98da15da3d83d404307827f60"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/ff4cc28b6483f5b34187750c96a77248771aa146", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/ff4cc28b6483f5b34187750c96a77248771aa146", "html_url": "https://github.com/Rust-GCC/gccrs/commit/ff4cc28b6483f5b34187750c96a77248771aa146", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/ff4cc28b6483f5b34187750c96a77248771aa146/comments", "author": null, "committer": null, "parents": [{"sha": "5c8d90405f04cdd193273d30ead2a0c08d766e36", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/5c8d90405f04cdd193273d30ead2a0c08d766e36", "html_url": "https://github.com/Rust-GCC/gccrs/commit/5c8d90405f04cdd193273d30ead2a0c08d766e36"}], "stats": {"total": 62, "additions": 34, "deletions": 28}, "files": [{"sha": "5d84c7382e69dd5a53465176373ffd1b0bd99748", "filename": "libjava/ChangeLog", "status": "modified", "additions": 14, "deletions": 0, "changes": 14, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/ff4cc28b6483f5b34187750c96a77248771aa146/libjava%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/ff4cc28b6483f5b34187750c96a77248771aa146/libjava%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libjava%2FChangeLog?ref=ff4cc28b6483f5b34187750c96a77248771aa146", "patch": "@@ -1,3 +1,17 @@\n+2003-10-07  Thomas Fitzsimmons  <fitzsim@redhat.com>\n+\n+\t* gnu/java/awt/peer/gtk/GtkTextAreaPeer.java (gtkTextGetSize):\n+\tRemove unused parameters.\n+\t* gnu/java/awt/peer/gtk/GtkTextFieldPeer.java (gtkEntryGetSize):\n+\tLikewise.\n+\t* jni/gtk-peer/gnu_java_awt_peer_gtk_GtkEvents.c\n+\t(keyevent_state_to_awt_mods): Export function.\n+\t* jni/gtk-peer/gnu_java_awt_peer_gtk_GtkTextComponentPeer.c\n+\t(getCaretPosition): Fix TextArea case.\n+\t(textcomponent_commit_cb): Get exact event time and modifier\n+\tstate.\n+\t* jni/gtk-peer/gtkpeer.h: Declare keyevent_state_to_awt_mods.\n+\n 2003-10-02  Guilhem Lavaux  <guilhem@kaffe.org>\n \n \t* java/net/InetSocketAddress.java"}, {"sha": "ef48a4a670176e56f4e60d372cccb9b997489fbc", "filename": "libjava/gnu/java/awt/peer/gtk/GtkTextAreaPeer.java", "status": "modified", "additions": 3, "deletions": 4, "changes": 7, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/ff4cc28b6483f5b34187750c96a77248771aa146/libjava%2Fgnu%2Fjava%2Fawt%2Fpeer%2Fgtk%2FGtkTextAreaPeer.java", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/ff4cc28b6483f5b34187750c96a77248771aa146/libjava%2Fgnu%2Fjava%2Fawt%2Fpeer%2Fgtk%2FGtkTextAreaPeer.java", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libjava%2Fgnu%2Fjava%2Fawt%2Fpeer%2Fgtk%2FGtkTextAreaPeer.java?ref=ff4cc28b6483f5b34187750c96a77248771aa146", "patch": "@@ -55,8 +55,7 @@ void create ()\n     create (((TextArea)awtComponent).getScrollbarVisibility ());\n   }\n \n-  // native void create (Object parent, String text, int scroll);\n-  native void gtkTextGetSize (int rows, int cols, int dims[]);\n+  native void gtkTextGetSize (int dims[]);\n \n   public GtkTextAreaPeer (TextArea ta)\n   {\n@@ -70,7 +69,7 @@ public Dimension getMinimumSize (int rows, int cols)\n   {\n     int dims[] = new int[2];\n \n-    gtkTextGetSize (rows, cols, dims);\n+    gtkTextGetSize (dims);\n \n     return (new Dimension (dims[0], dims[1]));\n   }\n@@ -79,7 +78,7 @@ public Dimension getPreferredSize (int rows, int cols)\n   {\n     int dims[] = new int[2];\n \n-    gtkTextGetSize (rows, cols, dims);\n+    gtkTextGetSize (dims);\n \n     return (new Dimension (dims[0], dims[1]));\n   }"}, {"sha": "b65354b449579e14544f5e014bc54fc946e71ef9", "filename": "libjava/gnu/java/awt/peer/gtk/GtkTextFieldPeer.java", "status": "modified", "additions": 3, "deletions": 3, "changes": 6, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/ff4cc28b6483f5b34187750c96a77248771aa146/libjava%2Fgnu%2Fjava%2Fawt%2Fpeer%2Fgtk%2FGtkTextFieldPeer.java", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/ff4cc28b6483f5b34187750c96a77248771aa146/libjava%2Fgnu%2Fjava%2Fawt%2Fpeer%2Fgtk%2FGtkTextFieldPeer.java", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libjava%2Fgnu%2Fjava%2Fawt%2Fpeer%2Fgtk%2FGtkTextFieldPeer.java?ref=ff4cc28b6483f5b34187750c96a77248771aa146", "patch": "@@ -53,7 +53,7 @@ public class GtkTextFieldPeer extends GtkTextComponentPeer\n \n   native void create ();\n \n-  native void gtkEntryGetSize (int cols, int dims[]);\n+  native void gtkEntryGetSize (int dims[]);\n \n   native void gtkSetFont(String xlfd, int size);\n \n@@ -69,7 +69,7 @@ public Dimension getMinimumSize (int cols)\n   {\n     int dims[] = new int[2];\n \n-    gtkEntryGetSize (cols, dims);\n+    gtkEntryGetSize (dims);\n \n     return (new Dimension (dims[0], dims[1]));\n   }\n@@ -78,7 +78,7 @@ public Dimension getPreferredSize (int cols)\n   {\n     int dims[] = new int[2];\n \n-    gtkEntryGetSize (cols, dims);\n+    gtkEntryGetSize (dims);\n \n     return (new Dimension (dims[0], dims[1]));\n   }"}, {"sha": "90ff6f42217465849e90edf27d71dda4c520d673", "filename": "libjava/jni/gtk-peer/gnu_java_awt_peer_gtk_GtkEvents.c", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/ff4cc28b6483f5b34187750c96a77248771aa146/libjava%2Fjni%2Fgtk-peer%2Fgnu_java_awt_peer_gtk_GtkEvents.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/ff4cc28b6483f5b34187750c96a77248771aa146/libjava%2Fjni%2Fgtk-peer%2Fgnu_java_awt_peer_gtk_GtkEvents.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libjava%2Fjni%2Fgtk-peer%2Fgnu_java_awt_peer_gtk_GtkEvents.c?ref=ff4cc28b6483f5b34187750c96a77248771aa146", "patch": "@@ -91,7 +91,7 @@ state_to_awt_mods (guint state)\n    key press event with modifiers=Shift, and a key release event with\n    no modifiers.  GDK's key events behave in the exact opposite way,\n    so this translation code is needed. */\n-static jint\n+jint\n keyevent_state_to_awt_mods (GdkEvent *event)\n {\n   jint result = 0;"}, {"sha": "77b4ae735244463188a7fd9b087be07c17d82c0b", "filename": "libjava/jni/gtk-peer/gnu_java_awt_peer_gtk_GtkTextAreaPeer.c", "status": "modified", "additions": 2, "deletions": 6, "changes": 8, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/ff4cc28b6483f5b34187750c96a77248771aa146/libjava%2Fjni%2Fgtk-peer%2Fgnu_java_awt_peer_gtk_GtkTextAreaPeer.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/ff4cc28b6483f5b34187750c96a77248771aa146/libjava%2Fjni%2Fgtk-peer%2Fgnu_java_awt_peer_gtk_GtkTextAreaPeer.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libjava%2Fjni%2Fgtk-peer%2Fgnu_java_awt_peer_gtk_GtkTextAreaPeer.c?ref=ff4cc28b6483f5b34187750c96a77248771aa146", "patch": "@@ -54,13 +54,11 @@ Java_gnu_java_awt_peer_gtk_GtkTextAreaPeer_create\n   sw = gtk_scrolled_window_new (NULL, NULL);\n   gtk_container_add (GTK_CONTAINER (sw), text);\n \n-  gtk_scrolled_window_set_policy (GTK_SCROLLED_WINDOW (sw), \n-\n+  gtk_scrolled_window_set_policy (GTK_SCROLLED_WINDOW (sw),\n      /* horizontal scrollbar */\n      (scroll == AWT_TEXTAREA_SCROLLBARS_BOTH\n       || scroll == AWT_TEXTAREA_SCROLLBARS_HORIZONTAL_ONLY) ? \n        GTK_POLICY_ALWAYS : GTK_POLICY_NEVER,\n-\n      /* vertical scrollbar */\n      (scroll == AWT_TEXTAREA_SCROLLBARS_BOTH\n       || scroll == AWT_TEXTAREA_SCROLLBARS_VERTICAL_ONLY) ? \n@@ -73,12 +71,11 @@ Java_gnu_java_awt_peer_gtk_GtkTextAreaPeer_create\n \n JNIEXPORT void JNICALL \n Java_gnu_java_awt_peer_gtk_GtkTextAreaPeer_gtkTextGetSize\n-  (JNIEnv *env, jobject obj, jint rows, jint cols, jintArray jdims)\n+  (JNIEnv *env, jobject obj, jintArray jdims)\n {\n   void *ptr;\n   jint *dims;\n   GtkWidget *text;\n-/*   GtkScrolledWindow *sw; */\n   GtkRequisition requisition;\n \n   ptr = NSA_GET_PTR (env, obj);\n@@ -89,7 +86,6 @@ Java_gnu_java_awt_peer_gtk_GtkTextAreaPeer_gtkTextGetSize\n   gdk_threads_enter ();\n \n   text = GTK_WIDGET (TEXT_FROM_SW (ptr));\n-  /*   sw = GTK_SCROLLED_WINDOW (ptr); */\n \n   gtk_widget_size_request(GTK_WIDGET (text), &requisition);\n   dims[0] = requisition.width;"}, {"sha": "b964ffdbe0915b89a4bdfadb53537603c78d5f00", "filename": "libjava/jni/gtk-peer/gnu_java_awt_peer_gtk_GtkTextComponentPeer.c", "status": "modified", "additions": 8, "deletions": 13, "changes": 21, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/ff4cc28b6483f5b34187750c96a77248771aa146/libjava%2Fjni%2Fgtk-peer%2Fgnu_java_awt_peer_gtk_GtkTextComponentPeer.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/ff4cc28b6483f5b34187750c96a77248771aa146/libjava%2Fjni%2Fgtk-peer%2Fgnu_java_awt_peer_gtk_GtkTextComponentPeer.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libjava%2Fjni%2Fgtk-peer%2Fgnu_java_awt_peer_gtk_GtkTextComponentPeer.c?ref=ff4cc28b6483f5b34187750c96a77248771aa146", "patch": "@@ -37,6 +37,7 @@ exception statement from your version. */\n \n \n #include \"gtkpeer.h\"\n+#include \"gnu_java_awt_peer_gtk_GtkComponentPeer.h\"\n #include \"gnu_java_awt_peer_gtk_GtkTextComponentPeer.h\"\n \n static void textcomponent_commit_cb (GtkIMContext *context,\n@@ -149,7 +150,6 @@ Java_gnu_java_awt_peer_gtk_GtkTextComponentPeer_setCaretPosition\n   GtkEditable *editable;    // type of GtkEntry    (TextField)\n   GtkWidget *text = NULL;   // type of GtkTextView (TextArea)\n   GtkTextBuffer *buf;\n-  GtkTextMark *mark;\n   GtkTextIter iter;\n \n   ptr = NSA_GET_PTR (env, obj);\n@@ -174,9 +174,8 @@ Java_gnu_java_awt_peer_gtk_GtkTextComponentPeer_setCaretPosition\n       if (text)\n \t{\n \t  buf = gtk_text_view_get_buffer (GTK_TEXT_VIEW (text));\n-\t  mark = gtk_text_buffer_get_insert (buf);\n-\t  gtk_text_buffer_get_iter_at_mark (buf, &iter, mark);\n-\t  gtk_text_iter_set_offset (&iter, pos);\n+\t  gtk_text_buffer_get_iter_at_offset (buf, &iter, pos);\n+\t  gtk_text_buffer_place_cursor (buf, &iter);\n \t}\n     }\n \n@@ -417,7 +416,6 @@ Java_gnu_java_awt_peer_gtk_GtkTextComponentPeer_setText\n   const char *str;\n   GtkWidget *text = NULL;   // type of GtkTextView (TextArea)\n   GtkTextBuffer *buf;\n-  jobject *obj_ptr;\n \n   ptr = NSA_GET_PTR (env, obj);\n   str = (*env)->GetStringUTFChars (env, contents, NULL);\n@@ -458,27 +456,24 @@ textcomponent_commit_cb (GtkIMContext *context,\n {\n   /* str is a \\0-terminated UTF-8 encoded character. */\n   gunichar2 *jc = g_utf8_to_utf16 (str, -1, NULL, NULL, NULL);\n+  GdkEvent *event = gtk_get_current_event ();\n \n   if (jc)\n     (*gdk_env)->CallVoidMethod (gdk_env, peer,\n                                 postKeyEventID,\n                                 (jint) AWT_KEY_TYPED,\n-                                /* We don't have access to the event\n-                                   that caused this commit signal to\n-                                   be fired.  So approximate the event\n-                                   time... */\n-                                (jlong) gdk_event_get_time (NULL),\n-                                /* ... and assume no modifiers. */\n-                                0,\n+                                (jlong) event->key.time,\n+                                keyevent_state_to_awt_mods (event),\n                                 VK_UNDEFINED,\n                                 (jchar) jc[0],\n                                 AWT_KEY_LOCATION_UNKNOWN);\n   g_free (jc);\n+  gdk_event_free (event);\n }\n \n static void\n textcomponent_changed_cb (GtkEditable *editable,\n-                      jobject peer)\n+\t\t\t  jobject peer)\n {\n   (*gdk_env)->CallVoidMethod (gdk_env, peer, postTextEventID);\n }"}, {"sha": "b075a693b346fdc15a846970508b2e45f707e92e", "filename": "libjava/jni/gtk-peer/gnu_java_awt_peer_gtk_GtkTextFieldPeer.c", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/ff4cc28b6483f5b34187750c96a77248771aa146/libjava%2Fjni%2Fgtk-peer%2Fgnu_java_awt_peer_gtk_GtkTextFieldPeer.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/ff4cc28b6483f5b34187750c96a77248771aa146/libjava%2Fjni%2Fgtk-peer%2Fgnu_java_awt_peer_gtk_GtkTextFieldPeer.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libjava%2Fjni%2Fgtk-peer%2Fgnu_java_awt_peer_gtk_GtkTextFieldPeer.c?ref=ff4cc28b6483f5b34187750c96a77248771aa146", "patch": "@@ -54,7 +54,7 @@ Java_gnu_java_awt_peer_gtk_GtkTextFieldPeer_create\n \n JNIEXPORT void JNICALL\n Java_gnu_java_awt_peer_gtk_GtkTextFieldPeer_gtkEntryGetSize\n-  (JNIEnv *env, jobject obj, jint cols, jintArray jdims)\n+  (JNIEnv *env, jobject obj, jintArray jdims)\n {\n   void *ptr;\n   jint *dims;"}, {"sha": "29414e1fc75cbed1def2c19f38a677a744b11594", "filename": "libjava/jni/gtk-peer/gtkpeer.h", "status": "modified", "additions": 2, "deletions": 0, "changes": 2, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/ff4cc28b6483f5b34187750c96a77248771aa146/libjava%2Fjni%2Fgtk-peer%2Fgtkpeer.h", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/ff4cc28b6483f5b34187750c96a77248771aa146/libjava%2Fjni%2Fgtk-peer%2Fgtkpeer.h", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libjava%2Fjni%2Fgtk-peer%2Fgtkpeer.h?ref=ff4cc28b6483f5b34187750c96a77248771aa146", "patch": "@@ -380,6 +380,8 @@ GtkLayout *find_gtk_layout (GtkWidget *parent);\n void setup_window (JNIEnv *env, jobject obj, GtkWidget *window, jint width, \n \t\t   jint height, jboolean visible);\n \n+jint keyevent_state_to_awt_mods (GdkEvent *event);\n+\n struct item_event_hook_info\n {\n   jobject peer_obj;"}]}