{"sha": "11598938f4989b238895062ff517862d0897cad8", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6MTE1OTg5MzhmNDk4OWIyMzg4OTUwNjJmZjUxNzg2MmQwODk3Y2FkOA==", "commit": {"author": {"name": "Ulrich Weigand", "email": "uweigand@de.ibm.com", "date": "2005-08-14T23:13:58Z"}, "committer": {"name": "Ulrich Weigand", "email": "uweigand@gcc.gnu.org", "date": "2005-08-14T23:13:58Z"}, "message": "s390.c (s390_const_ok_for_constraint_p): Add 'P' constraint.\n\n\t* config/s390/s390.c (s390_const_ok_for_constraint_p): Add 'P'\n\tconstraint.\n\t(legitimate_reload_constant_p): Fix handling of lliXX operands.\n\tAccept double-word constants that can be split.\n\t* config/s390/s390.md (\"movti\"): Use 'P' constraint.\n\t(\"*movdi_31\", \"*movdf_31\"): Likewise.\n\nFrom-SVN: r103088", "tree": {"sha": "b4e57599ad6c9969fea8d967030b6c4c2aab76ea", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/b4e57599ad6c9969fea8d967030b6c4c2aab76ea"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/11598938f4989b238895062ff517862d0897cad8", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/11598938f4989b238895062ff517862d0897cad8", "html_url": "https://github.com/Rust-GCC/gccrs/commit/11598938f4989b238895062ff517862d0897cad8", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/11598938f4989b238895062ff517862d0897cad8/comments", "author": null, "committer": null, "parents": [{"sha": "2b22401b5adc55029fb08feeb725058aa8020bb0", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/2b22401b5adc55029fb08feeb725058aa8020bb0", "html_url": "https://github.com/Rust-GCC/gccrs/commit/2b22401b5adc55029fb08feeb725058aa8020bb0"}], "stats": {"total": 34, "additions": 30, "deletions": 4}, "files": [{"sha": "f7ef0ce0474eccf0aeb021b7f6d46561dfe4f3fa", "filename": "gcc/ChangeLog", "status": "modified", "additions": 9, "deletions": 0, "changes": 9, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/11598938f4989b238895062ff517862d0897cad8/gcc%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/11598938f4989b238895062ff517862d0897cad8/gcc%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2FChangeLog?ref=11598938f4989b238895062ff517862d0897cad8", "patch": "@@ -1,3 +1,12 @@\n+2005-08-14  Ulrich Weigand  <uweigand@de.ibm.com>\n+\n+\t* config/s390/s390.c (s390_const_ok_for_constraint_p): Add 'P'\n+\tconstraint.\n+\t(legitimate_reload_constant_p): Fix handling of lliXX operands.\n+\tAccept double-word constants that can be split.\n+\t* config/s390/s390.md (\"movti\"): Use 'P' constraint.\n+\t(\"*movdi_31\", \"*movdf_31\"): Likewise.\n+\n 2005-08-14  Daniel Berlin  <dberlin@dberlin.org>\n \n \tFix PR tree-optimization/22615"}, {"sha": "ca32040a045ab8d388cfa2bbd6a096aa3cff36e7", "filename": "gcc/config/s390/s390.c", "status": "modified", "additions": 17, "deletions": 1, "changes": 18, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/11598938f4989b238895062ff517862d0897cad8/gcc%2Fconfig%2Fs390%2Fs390.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/11598938f4989b238895062ff517862d0897cad8/gcc%2Fconfig%2Fs390%2Fs390.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fconfig%2Fs390%2Fs390.c?ref=11598938f4989b238895062ff517862d0897cad8", "patch": "@@ -1876,6 +1876,9 @@ s390_const_ok_for_constraint_p (HOST_WIDE_INT value,\n \n       break;\n \n+    case 'P':\n+      return legitimate_reload_constant_p (GEN_INT (value));\n+\n     default:\n       return 0;\n     }\n@@ -2311,7 +2314,9 @@ legitimate_reload_constant_p (rtx op)\n \n   /* Accept lliXX operands.  */\n   if (TARGET_ZARCH\n-      && s390_single_part (op, DImode, HImode, 0) >= 0)\n+      && GET_CODE (op) == CONST_INT\n+      && trunc_int_for_mode (INTVAL (op), word_mode) == INTVAL (op)\n+      && s390_single_part (op, word_mode, HImode, 0) >= 0)\n   return true;\n \n   /* Accept larl operands.  */\n@@ -2324,6 +2329,17 @@ legitimate_reload_constant_p (rtx op)\n       && CONST_DOUBLE_OK_FOR_CONSTRAINT_P (op, 'G', \"G\"))\n     return true;\n \n+  /* Accept double-word operands that can be split.  */\n+  if (GET_CODE (op) == CONST_INT\n+      && trunc_int_for_mode (INTVAL (op), word_mode) != INTVAL (op))\n+    {\n+      enum machine_mode dword_mode = word_mode == SImode ? DImode : TImode;\n+      rtx hi = operand_subword (op, 0, 0, dword_mode);\n+      rtx lo = operand_subword (op, 1, 0, dword_mode);\n+      return legitimate_reload_constant_p (hi)\n+\t     && legitimate_reload_constant_p (lo);\n+    }\n+\n   /* Everything else cannot be handled without reload.  */\n   return false;\n }"}, {"sha": "dcbd1a025faebf60db79220b3899a1c56541a0e3", "filename": "gcc/config/s390/s390.md", "status": "modified", "additions": 4, "deletions": 3, "changes": 7, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/11598938f4989b238895062ff517862d0897cad8/gcc%2Fconfig%2Fs390%2Fs390.md", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/11598938f4989b238895062ff517862d0897cad8/gcc%2Fconfig%2Fs390%2Fs390.md", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fconfig%2Fs390%2Fs390.md?ref=11598938f4989b238895062ff517862d0897cad8", "patch": "@@ -47,6 +47,7 @@\n ;;         has a value different from its other parts.  If the letter x\n ;;         is specified instead of a part number, the constraint matches\n ;;         if there is any single part with non-default value.\n+;;    P -- Any integer constant that can be loaded without literal pool.\n ;;    Q -- Memory reference without index register and with short displacement.\n ;;    R -- Memory reference with index register and short displacement.\n ;;    S -- Memory reference without index register but with long displacement.\n@@ -785,7 +786,7 @@\n \n (define_insn \"movti\"\n   [(set (match_operand:TI 0 \"nonimmediate_operand\" \"=d,QS,d,o,Q\")\n-        (match_operand:TI 1 \"general_operand\" \"QS,d,dKm,d,Q\"))]\n+        (match_operand:TI 1 \"general_operand\" \"QS,d,dPm,d,Q\"))]\n   \"TARGET_64BIT\"\n   \"@\n    lmg\\t%0,%N0,%S1\n@@ -938,7 +939,7 @@\n \n (define_insn \"*movdi_31\"\n   [(set (match_operand:DI 0 \"nonimmediate_operand\" \"=d,d,Q,S,d,o,!*f,!*f,!*f,!R,!T,Q\")\n-        (match_operand:DI 1 \"general_operand\" \"Q,S,d,d,dKm,d,*f,R,T,*f,*f,Q\"))]\n+        (match_operand:DI 1 \"general_operand\" \"Q,S,d,d,dPm,d,*f,R,T,*f,*f,Q\"))]\n   \"!TARGET_64BIT\"\n   \"@\n    lm\\t%0,%N0,%S1\n@@ -1400,7 +1401,7 @@\n \n (define_insn \"*movdf_31\"\n   [(set (match_operand:DF 0 \"nonimmediate_operand\" \"=f,f,f,f,R,T,d,d,Q,S,d,o,Q\")\n-        (match_operand:DF 1 \"general_operand\" \"G,f,R,T,f,f,Q,S,d,d,dKm,d,Q\"))]\n+        (match_operand:DF 1 \"general_operand\" \"G,f,R,T,f,f,Q,S,d,d,dPm,d,Q\"))]\n   \"!TARGET_64BIT\"\n   \"@\n    lzdr\\t%0"}]}