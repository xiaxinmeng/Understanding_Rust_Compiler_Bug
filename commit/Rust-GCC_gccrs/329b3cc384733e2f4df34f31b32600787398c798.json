{"sha": "329b3cc384733e2f4df34f31b32600787398c798", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6MzI5YjNjYzM4NDczM2UyZjRkZjM0ZjMxYjMyNjAwNzg3Mzk4Yzc5OA==", "commit": {"author": {"name": "Kaz Kojima", "email": "kkojima@gcc.gnu.org", "date": "2006-11-13T03:28:13Z"}, "committer": {"name": "Kaz Kojima", "email": "kkojima@gcc.gnu.org", "date": "2006-11-13T03:28:13Z"}, "message": "genemit.c (gen_insn): Call gen_exp with a non-null used when handling multiple insns.\n\n\t* genemit.c (gen_insn): Call gen_exp with a non-null used\n\twhen handling multiple insns.\n\t(gen_expand): Likewise.\n\t* reorg.c (emit_delay_sequence): Copy the delay slot insn.\n\t* config/sh/sh.md (ashrsi2_31+1): Copy operands[0].\n\t(movsi_const_16bit+1): Copy operands[1].\n\t(call_pcrel): Copy the call_site pattern.\n\t(call_value_pcrel, sibcall_pcrel, GOTaddr2picreg): Likewise.\n\nFrom-SVN: r118746", "tree": {"sha": "59971702035ebe1fb851b935b3c42eccd90dded2", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/59971702035ebe1fb851b935b3c42eccd90dded2"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/329b3cc384733e2f4df34f31b32600787398c798", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/329b3cc384733e2f4df34f31b32600787398c798", "html_url": "https://github.com/Rust-GCC/gccrs/commit/329b3cc384733e2f4df34f31b32600787398c798", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/329b3cc384733e2f4df34f31b32600787398c798/comments", "author": null, "committer": null, "parents": [{"sha": "6d55dfe3a3317e05401df3a941e4ef2cdf7a86ed", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/6d55dfe3a3317e05401df3a941e4ef2cdf7a86ed", "html_url": "https://github.com/Rust-GCC/gccrs/commit/6d55dfe3a3317e05401df3a941e4ef2cdf7a86ed"}], "stats": {"total": 41, "additions": 30, "deletions": 11}, "files": [{"sha": "6865d8220de335f93419c7740d0586876468a679", "filename": "gcc/ChangeLog", "status": "modified", "additions": 11, "deletions": 0, "changes": 11, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/329b3cc384733e2f4df34f31b32600787398c798/gcc%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/329b3cc384733e2f4df34f31b32600787398c798/gcc%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2FChangeLog?ref=329b3cc384733e2f4df34f31b32600787398c798", "patch": "@@ -1,3 +1,14 @@\n+2006-11-12  Kaz Kojima  <kkojima@gcc.gnu.org>\n+\n+\t* genemit.c (gen_insn): Call gen_exp with a non-null used\n+\twhen handling multiple insns.\n+\t(gen_expand): Likewise.\n+\t* reorg.c (emit_delay_sequence): Copy the delay slot insn.\n+\t* config/sh/sh.md (ashrsi2_31+1): Copy operands[0].\n+\t(movsi_const_16bit+1): Copy operands[1].\n+\t(call_pcrel): Copy the call_site pattern.\n+\t(call_value_pcrel, sibcall_pcrel, GOTaddr2picreg): Likewise.\n+\n 2006-11-12  Roger Sayle  <roger@eyesopen.com>\n \n \t* fold-const.c (negate_expr_p) <PLUS_EXPR, MINUS_EXPR>: Correct/refine"}, {"sha": "ab9a3b4d6069ab3fd5fd4c05ef32c0b1163f53ba", "filename": "gcc/config/sh/sh.md", "status": "modified", "additions": 8, "deletions": 8, "changes": 16, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/329b3cc384733e2f4df34f31b32600787398c798/gcc%2Fconfig%2Fsh%2Fsh.md", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/329b3cc384733e2f4df34f31b32600787398c798/gcc%2Fconfig%2Fsh%2Fsh.md", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fconfig%2Fsh%2Fsh.md?ref=329b3cc384733e2f4df34f31b32600787398c798", "patch": "@@ -3752,7 +3752,7 @@ label:\n   \"\n {\n   emit_insn (gen_ashlsi_c (operands[0], operands[1]));\n-  emit_insn (gen_mov_neg_si_t (operands[0]));\n+  emit_insn (gen_mov_neg_si_t (copy_rtx (operands[0])));\n   DONE;\n }\")\n \n@@ -5113,7 +5113,7 @@ label:\n {\n   rtx insn = emit_insn (gen_movsi_const (operands[0], operands[1]));\n \n-  REG_NOTES (insn) = gen_rtx_EXPR_LIST (REG_EQUAL, operands[1],\n+  REG_NOTES (insn) = gen_rtx_EXPR_LIST (REG_EQUAL, copy_rtx (operands[1]),\n \t\t\t\t\tREG_NOTES (insn));\n \n   DONE;\n@@ -5497,7 +5497,7 @@ label:\n   else\n     insn = emit_insn (gen_movdi_const_32bit (operands[0], operands[1]));\n \n-  REG_NOTES (insn) = gen_rtx_EXPR_LIST (REG_EQUAL, operands[1],\n+  REG_NOTES (insn) = gen_rtx_EXPR_LIST (REG_EQUAL, copy_rtx (operands[1]),\n \t\t\t\t\tREG_NOTES (insn));\n \n   DONE;\n@@ -7390,7 +7390,7 @@ label:\n     emit_insn (gen_sym_label2reg (operands[2], operands[0], lab));\n   else\n     emit_insn (gen_symPLT_label2reg (operands[2], operands[0], lab));\n-  emit_call_insn (gen_calli_pcrel (operands[2], operands[1], lab));\n+  emit_call_insn (gen_calli_pcrel (operands[2], operands[1], copy_rtx (lab)));\n   DONE;\n }\"\n   [(set_attr \"type\" \"call\")\n@@ -7494,7 +7494,7 @@ label:\n   else\n     emit_insn (gen_symPLT_label2reg (operands[3], operands[1], lab));\n   emit_call_insn (gen_call_valuei_pcrel (operands[0], operands[3],\n-\t\t\t\t\t operands[2], lab));\n+\t\t\t\t\t operands[2], copy_rtx (lab)));\n   DONE;\n }\"\n   [(set_attr \"type\" \"call\")\n@@ -7875,7 +7875,7 @@ label:\n \n   emit_insn (gen_sym_label2reg (operands[2], operands[0], lab));\n   call_insn = emit_call_insn (gen_sibcalli_pcrel (operands[2], operands[1],\n-\t\t\t\t\t\t  lab));\n+\t\t\t\t\t\t  copy_rtx (lab)));\n   SIBLING_CALL_P (call_insn) = 1;\n   DONE;\n }\"\n@@ -8313,12 +8313,12 @@ label:\n       if (Pmode == SImode)\n \t{\n \t  emit_insn (gen_movsi_const (pic, operands[1]));\n-\t  emit_insn (gen_ptrel_si (tr, pic, lab));\n+\t  emit_insn (gen_ptrel_si (tr, pic, copy_rtx (lab)));\n \t}\n       else\n \t{\n \t  emit_insn (gen_movdi_const (pic, operands[1]));\n-\t  emit_insn (gen_ptrel_di (tr, pic, lab));\n+\t  emit_insn (gen_ptrel_di (tr, pic, copy_rtx (lab)));\n \t}\n \n       insn = emit_move_insn (operands[0], tr);"}, {"sha": "a1ebcf68cd7237d16f7c0608211122934a711740", "filename": "gcc/genemit.c", "status": "modified", "additions": 10, "deletions": 2, "changes": 12, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/329b3cc384733e2f4df34f31b32600787398c798/gcc%2Fgenemit.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/329b3cc384733e2f4df34f31b32600787398c798/gcc%2Fgenemit.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fgenemit.c?ref=329b3cc384733e2f4df34f31b32600787398c798", "patch": "@@ -428,15 +428,18 @@ gen_insn (rtx insn, int lineno)\n     }\n   else\n     {\n+      char *used = XCNEWVEC (char, operands);\n+\n       printf (\"  return gen_rtx_PARALLEL (VOIDmode, gen_rtvec (%d\",\n \t      XVECLEN (insn, 1));\n \n       for (i = 0; i < XVECLEN (insn, 1); i++)\n \t{\n \t  printf (\",\\n\\t\\t\");\n-\t  gen_exp (XVECEXP (insn, 1, i), DEFINE_INSN, NULL);\n+\t  gen_exp (XVECEXP (insn, 1, i), DEFINE_INSN, used);\n \t}\n       printf (\"));\\n}\\n\\n\");\n+      XDELETEVEC (used);\n     }\n }\n \f\n@@ -447,6 +450,7 @@ gen_expand (rtx expand)\n {\n   int operands;\n   int i;\n+  char *used;\n \n   if (strlen (XSTR (expand, 0)) == 0)\n     fatal (\"define_expand lacks a name\");\n@@ -530,6 +534,8 @@ gen_expand (rtx expand)\n      Use emit_insn to add them to the sequence being accumulated.\n      But don't do this if the user's code has set `no_more' nonzero.  */\n \n+  used = XCNEWVEC (char, operands);\n+\n   for (i = 0; i < XVECLEN (expand, 1); i++)\n     {\n       rtx next = XVECEXP (expand, 1, i);\n@@ -560,13 +566,15 @@ gen_expand (rtx expand)\n \tprintf (\"  emit (\");\n       else\n \tprintf (\"  emit_insn (\");\n-      gen_exp (next, DEFINE_EXPAND, NULL);\n+      gen_exp (next, DEFINE_EXPAND, used);\n       printf (\");\\n\");\n       if (GET_CODE (next) == SET && GET_CODE (SET_DEST (next)) == PC\n \t  && GET_CODE (SET_SRC (next)) == LABEL_REF)\n \tprintf (\"  emit_barrier ();\");\n     }\n \n+  XDELETEVEC (used);\n+\n   /* Call `get_insns' to extract the list of all the\n      insns emitted within this gen_... function.  */\n "}, {"sha": "dc3ce40bbf80f0669249845b3bab1507b501778f", "filename": "gcc/reorg.c", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/329b3cc384733e2f4df34f31b32600787398c798/gcc%2Freorg.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/329b3cc384733e2f4df34f31b32600787398c798/gcc%2Freorg.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Freorg.c?ref=329b3cc384733e2f4df34f31b32600787398c798", "patch": "@@ -513,7 +513,7 @@ emit_delay_sequence (rtx insn, rtx list, int length)\n \n   for (li = list; li; li = XEXP (li, 1), i++)\n     {\n-      rtx tem = XEXP (li, 0);\n+      rtx tem = copy_rtx (XEXP (li, 0));\n       rtx note, next;\n \n       /* Show that this copy of the insn isn't deleted.  */"}]}