{"sha": "29192293fdce8b3cf4888bbe0d5f504655e26cd5", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6MjkxOTIyOTNmZGNlOGIzY2Y0ODg4YmJlMGQ1ZjUwNDY1NWUyNmNkNQ==", "commit": {"author": {"name": "Mark Wielaard", "email": "mark@klomp.org", "date": "2021-07-05T19:11:03Z"}, "committer": {"name": "Mark Wielaard", "email": "mark@klomp.org", "date": "2021-07-05T19:11:03Z"}, "message": "Handle UTF-8 BOM in lexer\n\nThe very first thing in a rust source file might be the optional UTF-8\nBOM.  This is the 3 bytes 0xEF 0xBB 0xBF. They can simply be skipped,\nthey just mark the file as UTF-8.  Add some testcases to show we now\nhandle such files.", "tree": {"sha": "c79b390d50c717ad4e1abd2c262a7b53de69a467", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/c79b390d50c717ad4e1abd2c262a7b53de69a467"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/29192293fdce8b3cf4888bbe0d5f504655e26cd5", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/29192293fdce8b3cf4888bbe0d5f504655e26cd5", "html_url": "https://github.com/Rust-GCC/gccrs/commit/29192293fdce8b3cf4888bbe0d5f504655e26cd5", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/29192293fdce8b3cf4888bbe0d5f504655e26cd5/comments", "author": null, "committer": null, "parents": [{"sha": "27b3d34428801397e562b7fcc5ca10b13961f3e1", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/27b3d34428801397e562b7fcc5ca10b13961f3e1", "html_url": "https://github.com/Rust-GCC/gccrs/commit/27b3d34428801397e562b7fcc5ca10b13961f3e1"}], "stats": {"total": 20, "additions": 20, "deletions": 0}, "files": [{"sha": "617dd69a0801e091f58e3141dcda3230ad79d351", "filename": "gcc/rust/lex/rust-lex.cc", "status": "modified", "additions": 13, "deletions": 0, "changes": 13, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/29192293fdce8b3cf4888bbe0d5f504655e26cd5/gcc%2Frust%2Flex%2Frust-lex.cc", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/29192293fdce8b3cf4888bbe0d5f504655e26cd5/gcc%2Frust%2Flex%2Frust-lex.cc", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Frust%2Flex%2Frust-lex.cc?ref=29192293fdce8b3cf4888bbe0d5f504655e26cd5", "patch": "@@ -237,6 +237,19 @@ Lexer::build_token ()\n       current_char = peek_input ();\n       skip_input ();\n \n+      // detect UTF8 bom\n+      //\n+      // Must be the first thing on the first line.\n+      // There might be an optional BOM (Byte Order Mark), which for UTF-8 is\n+      // the three bytes 0xEF, 0xBB and 0xBF. These can simply be skipped.\n+      if (current_line == 1 && current_column == 1 && current_char == 0xef\n+\t  && peek_input () == 0xbb && peek_input (1) == 0xbf)\n+\t{\n+\t  skip_input (1);\n+\t  current_char = peek_input ();\n+\t  skip_input ();\n+\t}\n+\n       // detect shebang\n       // Must be the first thing on the first line, starting with #!\n       // But since an attribute can also start with an #! we don't count it as a"}, {"sha": "5edcab227ee20bfbedd3fd3c7f7a2bac7da9324b", "filename": "gcc/testsuite/rust/compile/torture/bom.rs", "status": "added", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/29192293fdce8b3cf4888bbe0d5f504655e26cd5/gcc%2Ftestsuite%2Frust%2Fcompile%2Ftorture%2Fbom.rs", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/29192293fdce8b3cf4888bbe0d5f504655e26cd5/gcc%2Ftestsuite%2Frust%2Fcompile%2Ftorture%2Fbom.rs", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Frust%2Fcompile%2Ftorture%2Fbom.rs?ref=29192293fdce8b3cf4888bbe0d5f504655e26cd5", "patch": "@@ -0,0 +1 @@\n+\ufeffpub fn main () { }"}, {"sha": "020e1707b556438ebedf4e5ff5c9b05596d17b08", "filename": "gcc/testsuite/rust/compile/torture/bom_comment.rs", "status": "added", "additions": 2, "deletions": 0, "changes": 2, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/29192293fdce8b3cf4888bbe0d5f504655e26cd5/gcc%2Ftestsuite%2Frust%2Fcompile%2Ftorture%2Fbom_comment.rs", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/29192293fdce8b3cf4888bbe0d5f504655e26cd5/gcc%2Ftestsuite%2Frust%2Fcompile%2Ftorture%2Fbom_comment.rs", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Frust%2Fcompile%2Ftorture%2Fbom_comment.rs?ref=29192293fdce8b3cf4888bbe0d5f504655e26cd5", "patch": "@@ -0,0 +1,2 @@\n+\ufeff// UTF8 BOM\n+pub fn main () { }"}, {"sha": "4c552e8d71dc116e8f1c0d8154eca69b511f43fe", "filename": "gcc/testsuite/rust/compile/torture/bom_shebang.rs", "status": "added", "additions": 2, "deletions": 0, "changes": 2, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/29192293fdce8b3cf4888bbe0d5f504655e26cd5/gcc%2Ftestsuite%2Frust%2Fcompile%2Ftorture%2Fbom_shebang.rs", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/29192293fdce8b3cf4888bbe0d5f504655e26cd5/gcc%2Ftestsuite%2Frust%2Fcompile%2Ftorture%2Fbom_shebang.rs", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Frust%2Fcompile%2Ftorture%2Fbom_shebang.rs?ref=29192293fdce8b3cf4888bbe0d5f504655e26cd5", "patch": "@@ -0,0 +1,2 @@\n+\ufeff#!/usr/bin/cat\n+pub fn main () { }"}, {"sha": "b10d5654473e7024d3f5134c5cbe26a1b57bed4b", "filename": "gcc/testsuite/rust/compile/torture/bom_whitespace.rs", "status": "added", "additions": 2, "deletions": 0, "changes": 2, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/29192293fdce8b3cf4888bbe0d5f504655e26cd5/gcc%2Ftestsuite%2Frust%2Fcompile%2Ftorture%2Fbom_whitespace.rs", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/29192293fdce8b3cf4888bbe0d5f504655e26cd5/gcc%2Ftestsuite%2Frust%2Fcompile%2Ftorture%2Fbom_whitespace.rs", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Frust%2Fcompile%2Ftorture%2Fbom_whitespace.rs?ref=29192293fdce8b3cf4888bbe0d5f504655e26cd5", "patch": "@@ -0,0 +1,2 @@\n+\ufeff\n+pub fn main () { }"}]}