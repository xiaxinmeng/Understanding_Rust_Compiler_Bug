{"sha": "5630e3e157a10a74e925de90e9badee11996a225", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6NTYzMGUzZTE1N2ExMGE3NGU5MjVkZTkwZTliYWRlZTExOTk2YTIyNQ==", "commit": {"author": {"name": "Jeff Law", "email": "law@gcc.gnu.org", "date": "2013-01-20T05:00:56Z"}, "committer": {"name": "Jeff Law", "email": "law@gcc.gnu.org", "date": "2013-01-20T05:00:56Z"}, "message": "re PR tree-optimization/52631 (VN does not use simplified expression for lookup)\n\n        PR tree-optimization/52631\n        * tree-ssa-sccvn (visit_use): Before looking up the original\n        statement, try looking up the simplified expression.\n\n        PR tree-optimization/52631\n        * tree-ssa/pr52631.c: New test.\n        * tree-ssa/ssa-fre-9: Update expected output.\n\nFrom-SVN: r195318", "tree": {"sha": "da83783cfe5329522a7123873999d87c323e4415", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/da83783cfe5329522a7123873999d87c323e4415"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/5630e3e157a10a74e925de90e9badee11996a225", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/5630e3e157a10a74e925de90e9badee11996a225", "html_url": "https://github.com/Rust-GCC/gccrs/commit/5630e3e157a10a74e925de90e9badee11996a225", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/5630e3e157a10a74e925de90e9badee11996a225/comments", "author": null, "committer": null, "parents": [{"sha": "424bac94825a2dda9eafecae640d5952e0c40108", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/424bac94825a2dda9eafecae640d5952e0c40108", "html_url": "https://github.com/Rust-GCC/gccrs/commit/424bac94825a2dda9eafecae640d5952e0c40108"}], "stats": {"total": 50, "additions": 49, "deletions": 1}, "files": [{"sha": "528afa12c3f4f5b889881ec4277358836be2d039", "filename": "gcc/ChangeLog", "status": "modified", "additions": 6, "deletions": 0, "changes": 6, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/5630e3e157a10a74e925de90e9badee11996a225/gcc%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/5630e3e157a10a74e925de90e9badee11996a225/gcc%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2FChangeLog?ref=5630e3e157a10a74e925de90e9badee11996a225", "patch": "@@ -1,3 +1,9 @@\n+2013-01-19  Andrew Pinski  <apinski@cavium.com>\n+\n+\tPR tree-optimization/52631\n+\t* tree-ssa-sccvn (visit_use): Before looking up the original\n+\tstatement, try looking up the simplified expression.\n+\n 2013-01-19  Anthony Green  <green@moxielogic.com>\n \n \t* config/moxie/moxie.c (moxie_expand_prologue): Set"}, {"sha": "0d502962e031959ff0cf55cc2629094b0a6bb9c3", "filename": "gcc/testsuite/ChangeLog", "status": "modified", "additions": 6, "deletions": 0, "changes": 6, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/5630e3e157a10a74e925de90e9badee11996a225/gcc%2Ftestsuite%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/5630e3e157a10a74e925de90e9badee11996a225/gcc%2Ftestsuite%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2FChangeLog?ref=5630e3e157a10a74e925de90e9badee11996a225", "patch": "@@ -1,3 +1,9 @@\n+2013-01-19  Jeff Law  <law@redhat.com>\n+\n+\tPR tree-optimization/52631\n+\t* tree-ssa/pr52631.c: New test.\n+\t* tree-ssa/ssa-fre-9: Update expected output.\n+\n 2013-01-19  Anthony Green  <green@moxielogic.com>\n \n \t* gcc.dg/tree-ssa/asm-2.c (REGISTER): Pick an appropriate register"}, {"sha": "c0d650b9ae6d8a1eb4518f22a12c1b3352e6e5ce", "filename": "gcc/testsuite/gcc.dg/tree-ssa/pr52631.c", "status": "added", "additions": 14, "deletions": 0, "changes": 14, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/5630e3e157a10a74e925de90e9badee11996a225/gcc%2Ftestsuite%2Fgcc.dg%2Ftree-ssa%2Fpr52631.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/5630e3e157a10a74e925de90e9badee11996a225/gcc%2Ftestsuite%2Fgcc.dg%2Ftree-ssa%2Fpr52631.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgcc.dg%2Ftree-ssa%2Fpr52631.c?ref=5630e3e157a10a74e925de90e9badee11996a225", "patch": "@@ -0,0 +1,14 @@\n+/* { dg-do compile } */\n+/* { dg-options \"-O2 -fdump-tree-fre1-details\" } */\n+\n+unsigned f(unsigned a)\n+{\n+  unsigned b = a >> 31;\n+  return b&1;\n+}\n+\n+/* We want to verify that we replace the b & 1 with b.  */\n+/* { dg-final { scan-tree-dump-times \"Replaced b_\\[0-9\\]+ & 1 with b_\\[0-9\\]+ in\" 1 \"fre1\"} } */\n+ \n+/* { dg-final { cleanup-tree-dump \"fre1\" } } */\n+"}, {"sha": "d3986f5ba17723e59a4effb6016a0d3e35003918", "filename": "gcc/testsuite/gcc.dg/tree-ssa/ssa-fre-9.c", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/5630e3e157a10a74e925de90e9badee11996a225/gcc%2Ftestsuite%2Fgcc.dg%2Ftree-ssa%2Fssa-fre-9.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/5630e3e157a10a74e925de90e9badee11996a225/gcc%2Ftestsuite%2Fgcc.dg%2Ftree-ssa%2Fssa-fre-9.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgcc.dg%2Ftree-ssa%2Fssa-fre-9.c?ref=5630e3e157a10a74e925de90e9badee11996a225", "patch": "@@ -23,6 +23,6 @@ void __frame_state_for1 (volatile char *state_in)\n     }\n }\n \n-/* { dg-final { scan-tree-dump-times \"Eliminated: 1\" 2 \"fre1\" } } */\n+/* { dg-final { scan-tree-dump-times \"Eliminated: 2\" 2 \"fre1\" } } */\n /* { dg-final { scan-tree-dump-times \"Insertions: 1\" 2 \"fre1\" } } */\n /* { dg-final { cleanup-tree-dump \"fre1\" } } */"}, {"sha": "81a07aefb4fc72cfe6c47df160f5403c944b63d1", "filename": "gcc/tree-ssa-sccvn.c", "status": "modified", "additions": 22, "deletions": 0, "changes": 22, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/5630e3e157a10a74e925de90e9badee11996a225/gcc%2Ftree-ssa-sccvn.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/5630e3e157a10a74e925de90e9badee11996a225/gcc%2Ftree-ssa-sccvn.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftree-ssa-sccvn.c?ref=5630e3e157a10a74e925de90e9badee11996a225", "patch": "@@ -3422,6 +3422,28 @@ visit_use (tree use)\n \t\t}\n \t      else\n \t\t{\n+\t\t  /* First try to lookup the simplified expression.  */\n+\t\t  if (simplified)\n+\t\t    {\n+\t\t      enum gimple_rhs_class rhs_class;\n+\n+\n+\t\t      rhs_class = get_gimple_rhs_class (TREE_CODE (simplified));\n+\t\t      if ((rhs_class == GIMPLE_UNARY_RHS\n+\t\t\t   || rhs_class == GIMPLE_BINARY_RHS\n+\t\t\t   || rhs_class == GIMPLE_TERNARY_RHS)\n+\t\t\t  && valid_gimple_rhs_p (simplified))\n+\t\t\t{\n+\t\t\t  tree result = vn_nary_op_lookup (simplified, NULL);\n+\t\t\t  if (result)\n+\t\t\t    {\n+\t\t\t      changed = set_ssa_val_to (lhs, result);\n+\t\t\t      goto done;\n+\t\t\t    }\n+\t\t\t}\n+\t\t    }\n+\n+\t\t  /* Otherwise visit the original statement.  */\n \t\t  switch (vn_get_stmt_kind (stmt))\n \t\t    {\n \t\t    case VN_NARY:"}]}