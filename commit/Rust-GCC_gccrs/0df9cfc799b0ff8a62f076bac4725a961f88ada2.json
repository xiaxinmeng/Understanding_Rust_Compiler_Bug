{"sha": "0df9cfc799b0ff8a62f076bac4725a961f88ada2", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6MGRmOWNmYzc5OWIwZmY4YTYyZjA3NmJhYzQ3MjVhOTYxZjg4YWRhMg==", "commit": {"author": {"name": "Tom Tromey", "email": "tromey@redhat.com", "date": "2002-04-24T23:05:17Z"}, "committer": {"name": "Tom Tromey", "email": "tromey@gcc.gnu.org", "date": "2002-04-24T23:05:17Z"}, "message": "natCore.cc (create): Use __builtin_alloca, and compute correct length of UTF-8 encoded name.\n\n\t* gnu/gcj/natCore.cc (create): Use __builtin_alloca, and compute\n\tcorrect length of UTF-8 encoded name.  Strip leading `/'.\n\t(_Jv_RegisterResource): Use _Jv_Malloc.\n\nFrom-SVN: r52744", "tree": {"sha": "33f3e50042a21d75762c7911d1b069426e0d91be", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/33f3e50042a21d75762c7911d1b069426e0d91be"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/0df9cfc799b0ff8a62f076bac4725a961f88ada2", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/0df9cfc799b0ff8a62f076bac4725a961f88ada2", "html_url": "https://github.com/Rust-GCC/gccrs/commit/0df9cfc799b0ff8a62f076bac4725a961f88ada2", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/0df9cfc799b0ff8a62f076bac4725a961f88ada2/comments", "author": null, "committer": null, "parents": [{"sha": "a62d375fda94a2dcbb05f00037d320e04cb02d4a", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/a62d375fda94a2dcbb05f00037d320e04cb02d4a", "html_url": "https://github.com/Rust-GCC/gccrs/commit/a62d375fda94a2dcbb05f00037d320e04cb02d4a"}], "stats": {"total": 20, "additions": 17, "deletions": 3}, "files": [{"sha": "a7d341980685a359273e9477e8547d1433312417", "filename": "libjava/ChangeLog", "status": "modified", "additions": 6, "deletions": 0, "changes": 6, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/0df9cfc799b0ff8a62f076bac4725a961f88ada2/libjava%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/0df9cfc799b0ff8a62f076bac4725a961f88ada2/libjava%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libjava%2FChangeLog?ref=0df9cfc799b0ff8a62f076bac4725a961f88ada2", "patch": "@@ -1,3 +1,9 @@\n+2002-04-24  Tom Tromey  <tromey@redhat.com>\n+\n+\t* gnu/gcj/natCore.cc (create): Use __builtin_alloca, and compute\n+\tcorrect length of UTF-8 encoded name.  Strip leading `/'.\n+\t(_Jv_RegisterResource): Use _Jv_Malloc.\n+\n 2002-04-23  Adam Megacz <adam@xwt.org>\n \n \t* win32.cc, include/win32.cc (backtrace): Added this function"}, {"sha": "75a7ad05ae139d90c75e4f6d71e34b133e395ca4", "filename": "libjava/gnu/gcj/natCore.cc", "status": "modified", "additions": 11, "deletions": 3, "changes": 14, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/0df9cfc799b0ff8a62f076bac4725a961f88ada2/libjava%2Fgnu%2Fgcj%2FnatCore.cc", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/0df9cfc799b0ff8a62f076bac4725a961f88ada2/libjava%2Fgnu%2Fgcj%2FnatCore.cc", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libjava%2Fgnu%2Fgcj%2FnatCore.cc?ref=0df9cfc799b0ff8a62f076bac4725a961f88ada2", "patch": "@@ -1,6 +1,6 @@\n // natCore -- C++ side of Core\n \n-/* Copyright (C) 2001  Free Software Foundation\n+/* Copyright (C) 2001, 2002  Free Software Foundation\n \n    This file is part of libgcj.\n \n@@ -40,7 +40,7 @@ void _Jv_RegisterResource (void *vptr)\n   // These are permanent data structures for now.  This routine is\n   // called from a static constructor, so we shouldn't depend on too\n   // much existing infrastructure.\n-  core_chain *cc = (core_chain *) malloc (sizeof (core_chain));\n+  core_chain *cc = (core_chain *) _Jv_Malloc (sizeof (core_chain));\n \n   cc->name_length = ((int *)rptr)[0];\n   cc->data_length = ((int *)rptr)[1];\n@@ -56,10 +56,18 @@ void _Jv_RegisterResource (void *vptr)\n gnu::gcj::Core *\n gnu::gcj::Core::create (jstring name)\n {\n-  char buf[name->length() + 1];\n+  char *buf = (char *) __builtin_alloca (JvGetStringUTFLength (name) + 1);\n   jsize total = JvGetStringUTFRegion (name, 0, name->length(), buf);\n   buf[total] = '\\0';\n \n+  // Usually requests here end up as an absolute URL.  We strip the\n+  // initial `/'.\n+  if (buf[0] == '/')\n+    {\n+      ++buf;\n+      --total;\n+    }\n+\n   core_chain *node = root;\n \n   while (node)"}]}