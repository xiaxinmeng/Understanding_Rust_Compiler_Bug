{"sha": "2b442504a0a4073992da8985ebcf1998ef4aff5e", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6MmI0NDI1MDRhMGE0MDczOTkyZGE4OTg1ZWJjZjE5OThlZjRhZmY1ZQ==", "commit": {"author": {"name": "Andrea Corallo", "email": "andrea.corallo@arm.com", "date": "2019-07-04T16:25:06Z"}, "committer": {"name": "Andrea Corallo", "email": "akrl@gcc.gnu.org", "date": "2019-07-04T16:25:06Z"}, "message": "jit: gcc_jit_context_new_binary_op check res type\n\ngcc/jit/ChangeLog:\n2019-07-04  Andrea Corallo <andrea.corallo@arm.com>\n\n\t* libgccjit.c (gcc_jit_context_new_binary_op): Check result_type to be a\n\tnumeric type.\n\ngcc/testsuite/ChangeLog:\n2019-07-04  Andrea Corallo <andrea.corallo@arm.com>\n\n\t* jit.dg/test-error-gcc_jit_context_new_binary_op-bad-res-type.c:\n\tNew testcase.\n\nFrom-SVN: r273089", "tree": {"sha": "b752f1ac911e361e8e659f03c5b684bf22896272", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/b752f1ac911e361e8e659f03c5b684bf22896272"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/2b442504a0a4073992da8985ebcf1998ef4aff5e", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/2b442504a0a4073992da8985ebcf1998ef4aff5e", "html_url": "https://github.com/Rust-GCC/gccrs/commit/2b442504a0a4073992da8985ebcf1998ef4aff5e", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/2b442504a0a4073992da8985ebcf1998ef4aff5e/comments", "author": {"login": "AndreaCorallo", "id": 6765576, "node_id": "MDQ6VXNlcjY3NjU1NzY=", "avatar_url": "https://avatars.githubusercontent.com/u/6765576?v=4", "gravatar_id": "", "url": "https://api.github.com/users/AndreaCorallo", "html_url": "https://github.com/AndreaCorallo", "followers_url": "https://api.github.com/users/AndreaCorallo/followers", "following_url": "https://api.github.com/users/AndreaCorallo/following{/other_user}", "gists_url": "https://api.github.com/users/AndreaCorallo/gists{/gist_id}", "starred_url": "https://api.github.com/users/AndreaCorallo/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/AndreaCorallo/subscriptions", "organizations_url": "https://api.github.com/users/AndreaCorallo/orgs", "repos_url": "https://api.github.com/users/AndreaCorallo/repos", "events_url": "https://api.github.com/users/AndreaCorallo/events{/privacy}", "received_events_url": "https://api.github.com/users/AndreaCorallo/received_events", "type": "User", "site_admin": false}, "committer": null, "parents": [{"sha": "e2c3bbbf905a8010729d35df8eda2792755107c4", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/e2c3bbbf905a8010729d35df8eda2792755107c4", "html_url": "https://github.com/Rust-GCC/gccrs/commit/e2c3bbbf905a8010729d35df8eda2792755107c4"}], "stats": {"total": 57, "additions": 57, "deletions": 0}, "files": [{"sha": "41cb60f1266498b99c946912e9e6648482f6a5c9", "filename": "gcc/jit/ChangeLog", "status": "modified", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/2b442504a0a4073992da8985ebcf1998ef4aff5e/gcc%2Fjit%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/2b442504a0a4073992da8985ebcf1998ef4aff5e/gcc%2Fjit%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fjit%2FChangeLog?ref=2b442504a0a4073992da8985ebcf1998ef4aff5e", "patch": "@@ -1,3 +1,8 @@\n+2019-07-04  Andrea Corallo <andrea.corallo@arm.com>\n+\n+\t* libgccjit.c (gcc_jit_context_new_binary_op): Check result_type to be a\n+\tnumeric type.\n+\n 2019-07-04  Andrea Corallo <andrea.corallo@arm.com>\n \n \t* docs/topics/compatibility.rst (LIBGCCJIT_ABI_12): New ABI tag."}, {"sha": "23e83e2e42c032d0742126d44151375499e1cf79", "filename": "gcc/jit/libgccjit.c", "status": "modified", "additions": 6, "deletions": 0, "changes": 6, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/2b442504a0a4073992da8985ebcf1998ef4aff5e/gcc%2Fjit%2Flibgccjit.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/2b442504a0a4073992da8985ebcf1998ef4aff5e/gcc%2Fjit%2Flibgccjit.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fjit%2Flibgccjit.c?ref=2b442504a0a4073992da8985ebcf1998ef4aff5e", "patch": "@@ -1385,6 +1385,12 @@ gcc_jit_context_new_binary_op (gcc_jit_context *ctxt,\n     a->get_type ()->get_debug_string (),\n     b->get_debug_string (),\n     b->get_type ()->get_debug_string ());\n+  RETURN_NULL_IF_FAIL_PRINTF4 (\n+    result_type->is_numeric (), ctxt, loc,\n+    \"gcc_jit_binary_op %i with operands a: %s b: %s \"\n+    \"has non numeric result_type: %s\",\n+    op, a->get_debug_string (), b->get_debug_string (),\n+    result_type->get_debug_string ());\n \n   return (gcc_jit_rvalue *)ctxt->new_binary_op (loc, op, result_type, a, b);\n }"}, {"sha": "73847a9388b73879f60e9ce3ea1ffed313c38598", "filename": "gcc/testsuite/ChangeLog", "status": "modified", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/2b442504a0a4073992da8985ebcf1998ef4aff5e/gcc%2Ftestsuite%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/2b442504a0a4073992da8985ebcf1998ef4aff5e/gcc%2Ftestsuite%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2FChangeLog?ref=2b442504a0a4073992da8985ebcf1998ef4aff5e", "patch": "@@ -1,3 +1,8 @@\n+2019-07-04  Andrea Corallo <andrea.corallo@arm.com>\n+\n+\t* jit.dg/test-error-gcc_jit_context_new_binary_op-bad-res-type.c:\n+\tNew testcase.\n+\n 2019-07-04  Wilco Dijkstra  <wdijkstr@arm.com>\n \n \t* gcc.dg/tree-ssa/cunroll-15.c: Remove XFAIL on arm."}, {"sha": "abadc9f941a0b51830842f9de3346685d72633b8", "filename": "gcc/testsuite/jit.dg/test-error-gcc_jit_context_new_binary_op-bad-res-type.c", "status": "added", "additions": 41, "deletions": 0, "changes": 41, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/2b442504a0a4073992da8985ebcf1998ef4aff5e/gcc%2Ftestsuite%2Fjit.dg%2Ftest-error-gcc_jit_context_new_binary_op-bad-res-type.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/2b442504a0a4073992da8985ebcf1998ef4aff5e/gcc%2Ftestsuite%2Fjit.dg%2Ftest-error-gcc_jit_context_new_binary_op-bad-res-type.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fjit.dg%2Ftest-error-gcc_jit_context_new_binary_op-bad-res-type.c?ref=2b442504a0a4073992da8985ebcf1998ef4aff5e", "patch": "@@ -0,0 +1,41 @@\n+#include <stdlib.h>\n+#include <stdio.h>\n+\n+#include \"libgccjit.h\"\n+\n+#include \"harness.h\"\n+\n+/* Try to create a binary operator with invalid result type.  */\n+\n+void\n+create_code (gcc_jit_context *ctxt, void *user_data)\n+{\n+  gcc_jit_type *int_type =\n+    gcc_jit_context_get_type (ctxt, GCC_JIT_TYPE_INT);\n+  gcc_jit_type *void_ptr_type =\n+    gcc_jit_context_get_type (ctxt, GCC_JIT_TYPE_VOID_PTR);\n+\n+  gcc_jit_context_new_binary_op (\n+    ctxt,\n+    NULL,\n+    GCC_JIT_BINARY_OP_MINUS,\n+    void_ptr_type,\n+    gcc_jit_context_new_rvalue_from_int (ctxt,\n+\t\t\t\t\t int_type,\n+\t\t\t\t\t 1),\n+    gcc_jit_context_new_rvalue_from_int (ctxt,\n+\t\t\t\t\t int_type,\n+\t\t\t\t\t 2));\n+}\n+\n+void\n+verify_code (gcc_jit_context *ctxt, gcc_jit_result *result)\n+{\n+  CHECK_VALUE (result, NULL);\n+\n+  /* Verify that the correct error message was emitted.\t */\n+  CHECK_STRING_VALUE (gcc_jit_context_get_first_error (ctxt),\n+\t\t      \"gcc_jit_context_new_binary_op: gcc_jit_binary_op 1 with\"\n+\t\t      \" operands a: (int)1 b: (int)2 has non numeric \"\n+\t\t      \"result_type: void *\");\n+}"}]}