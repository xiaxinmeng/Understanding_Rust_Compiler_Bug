{"sha": "a2e76867ad58dd0d7b5e09b95533029ad0659202", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6YTJlNzY4NjdhZDU4ZGQwZDdiNWUwOWI5NTUzMzAyOWFkMDY1OTIwMg==", "commit": {"author": {"name": "Prathamesh Kulkarni", "email": "prathamesh.kulkarni@linaro.org", "date": "2016-04-27T10:46:16Z"}, "committer": {"name": "Prathamesh Kulkarni", "email": "prathamesh3492@gcc.gnu.org", "date": "2016-04-27T10:46:16Z"}, "message": "params.def (MAX_PARTITION_SIZE): New param.\n\n2016-04-27  Prathamesh Kulkarni  <prathamesh.kulkarni@linaro.org>\n\n\t* params.def (MAX_PARTITION_SIZE): New param.\n\t* invoke.texi: Document lto-max-partition.\nlto/\n\t* lto-partition.h (lto_balanced_map): New parameter.\n\t* lto-partition.c (lto_balanced_map): New parameter\n\tmax_partition_size.\n\tCheck if partition size is greater than max_partition_size.\n\t* lto.c (do_whole_program_analysis): Adjust calls to\n\tlto_balanced_map() to pass 2nd argument.\n\nFrom-SVN: r235478", "tree": {"sha": "29c4c51dbc69ddde40d943dea16d9ac6289ef443", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/29c4c51dbc69ddde40d943dea16d9ac6289ef443"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/a2e76867ad58dd0d7b5e09b95533029ad0659202", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/a2e76867ad58dd0d7b5e09b95533029ad0659202", "html_url": "https://github.com/Rust-GCC/gccrs/commit/a2e76867ad58dd0d7b5e09b95533029ad0659202", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/a2e76867ad58dd0d7b5e09b95533029ad0659202/comments", "author": null, "committer": null, "parents": [{"sha": "2b78f22152e0af0612433f2bdf1d9eae76bfd843", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/2b78f22152e0af0612433f2bdf1d9eae76bfd843", "html_url": "https://github.com/Rust-GCC/gccrs/commit/2b78f22152e0af0612433f2bdf1d9eae76bfd843"}], "stats": {"total": 39, "additions": 34, "deletions": 5}, "files": [{"sha": "dc4429ad03d3bc3fa4fae7c033b393ff184de6fb", "filename": "gcc/ChangeLog", "status": "modified", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/a2e76867ad58dd0d7b5e09b95533029ad0659202/gcc%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/a2e76867ad58dd0d7b5e09b95533029ad0659202/gcc%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2FChangeLog?ref=a2e76867ad58dd0d7b5e09b95533029ad0659202", "patch": "@@ -1,3 +1,8 @@\n+2016-04-27  Prathamesh Kulkarni  <prathamesh.kulkarni@linaro.org>\n+\n+\t* params.def (MAX_PARTITION_SIZE): New param.\n+\t* invoke.texi: Document lto-max-partition.\n+\n 2016-04-27  Richard Biener  <rguenther@suse.de>\n \n \tPR ipa/70785"}, {"sha": "6e343c5cadae8efc0eb931b1a3353bc537107519", "filename": "gcc/doc/invoke.texi", "status": "modified", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/a2e76867ad58dd0d7b5e09b95533029ad0659202/gcc%2Fdoc%2Finvoke.texi", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/a2e76867ad58dd0d7b5e09b95533029ad0659202/gcc%2Fdoc%2Finvoke.texi", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fdoc%2Finvoke.texi?ref=a2e76867ad58dd0d7b5e09b95533029ad0659202", "patch": "@@ -9490,6 +9490,11 @@ Size of minimal partition for WHOPR (in estimated instructions).\n This prevents expenses of splitting very small programs into too many\n partitions.\n \n+@item lto-max-partition\n+Size of max partition for WHOPR (in estimated instructions).\n+to provide an upper bound for individual size of partition.\n+Meant to be used only with balanced partitioning.\n+\n @item cxx-max-namespaces-for-diagnostic-help\n The maximum number of namespaces to consult for suggestions when C++\n name lookup fails for an identifier.  The default is 1000."}, {"sha": "b1421cbe733bb76772f90b23b86e43da7dcef5b7", "filename": "gcc/lto/ChangeLog", "status": "modified", "additions": 9, "deletions": 0, "changes": 9, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/a2e76867ad58dd0d7b5e09b95533029ad0659202/gcc%2Flto%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/a2e76867ad58dd0d7b5e09b95533029ad0659202/gcc%2Flto%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Flto%2FChangeLog?ref=a2e76867ad58dd0d7b5e09b95533029ad0659202", "patch": "@@ -1,3 +1,12 @@\n+2016-04-27  Prathamesh Kulkarni  <prathamesh.kulkarni@linaro.org>\n+\n+\t* lto-partition.h (lto_balanced_map): New parameter.\n+\t* lto-partition.c (lto_balanced_map): New parameter\n+\tmax_partition_size.\n+\tCheck if partition size is greater than max_partition_size.\n+\t* lto.c (do_whole_program_analysis): Adjust calls to\n+\tlto_balanced_map() to pass 2nd argument.\n+\n 2016-03-17  H.J. Lu  <hongjiu.lu@intel.com>\n \n \tPR lto/70258"}, {"sha": "c191d24b497306554967c3e1c0c6afc64ab9616b", "filename": "gcc/lto/lto-partition.c", "status": "modified", "additions": 6, "deletions": 2, "changes": 8, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/a2e76867ad58dd0d7b5e09b95533029ad0659202/gcc%2Flto%2Flto-partition.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/a2e76867ad58dd0d7b5e09b95533029ad0659202/gcc%2Flto%2Flto-partition.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Flto%2Flto-partition.c?ref=a2e76867ad58dd0d7b5e09b95533029ad0659202", "patch": "@@ -447,7 +447,7 @@ add_sorted_nodes (vec<symtab_node *> &next_nodes, ltrans_partition partition)\n    and in-partition calls was reached.  */\n \n void\n-lto_balanced_map (int n_lto_partitions)\n+lto_balanced_map (int n_lto_partitions, int max_partition_size)\n {\n   int n_nodes = 0;\n   int n_varpool_nodes = 0, varpool_pos = 0, best_varpool_pos = 0;\n@@ -511,6 +511,9 @@ lto_balanced_map (int n_lto_partitions)\n   varpool_order.qsort (varpool_node_cmp);\n \n   /* Compute partition size and create the first partition.  */\n+  if (PARAM_VALUE (MIN_PARTITION_SIZE) > max_partition_size)\n+    fatal_error (input_location, \"min partition size cannot be greater than max partition size\");\n+\n   partition_size = total_size / n_lto_partitions;\n   if (partition_size < PARAM_VALUE (MIN_PARTITION_SIZE))\n     partition_size = PARAM_VALUE (MIN_PARTITION_SIZE);\n@@ -719,7 +722,8 @@ lto_balanced_map (int n_lto_partitions)\n \t\t best_cost, best_internal, best_i);\n       /* Partition is too large, unwind into step when best cost was reached and\n \t start new partition.  */\n-      if (partition->insns > 2 * partition_size)\n+      if (partition->insns > 2 * partition_size\n+\t  || partition->insns > max_partition_size)\n \t{\n \t  if (best_i != i)\n \t    {"}, {"sha": "f7abe620257eb6651fe34f56a4ce7c8e937e4682", "filename": "gcc/lto/lto-partition.h", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/a2e76867ad58dd0d7b5e09b95533029ad0659202/gcc%2Flto%2Flto-partition.h", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/a2e76867ad58dd0d7b5e09b95533029ad0659202/gcc%2Flto%2Flto-partition.h", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Flto%2Flto-partition.h?ref=a2e76867ad58dd0d7b5e09b95533029ad0659202", "patch": "@@ -35,7 +35,7 @@ extern vec<ltrans_partition> ltrans_partitions;\n \n void lto_1_to_1_map (void);\n void lto_max_map (void);\n-void lto_balanced_map (int);\n+void lto_balanced_map (int, int);\n void lto_promote_cross_file_statics (void);\n void free_ltrans_partitions (void);\n void lto_promote_statics_nonwpa (void);"}, {"sha": "af735cb179333e063ebb96da756d1fe5a0f8e4ef", "filename": "gcc/lto/lto.c", "status": "modified", "additions": 3, "deletions": 2, "changes": 5, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/a2e76867ad58dd0d7b5e09b95533029ad0659202/gcc%2Flto%2Flto.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/a2e76867ad58dd0d7b5e09b95533029ad0659202/gcc%2Flto%2Flto.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Flto%2Flto.c?ref=a2e76867ad58dd0d7b5e09b95533029ad0659202", "patch": "@@ -3117,9 +3117,10 @@ do_whole_program_analysis (void)\n   else if (flag_lto_partition == LTO_PARTITION_MAX)\n     lto_max_map ();\n   else if (flag_lto_partition == LTO_PARTITION_ONE)\n-    lto_balanced_map (1);\n+    lto_balanced_map (1, INT_MAX);\n   else if (flag_lto_partition == LTO_PARTITION_BALANCED)\n-    lto_balanced_map (PARAM_VALUE (PARAM_LTO_PARTITIONS));\n+    lto_balanced_map (PARAM_VALUE (PARAM_LTO_PARTITIONS),\n+\t\t      PARAM_VALUE (MAX_PARTITION_SIZE));\n   else\n     gcc_unreachable ();\n "}, {"sha": "eceee32d87684169cada8db1d16e50077e53eb69", "filename": "gcc/params.def", "status": "modified", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/a2e76867ad58dd0d7b5e09b95533029ad0659202/gcc%2Fparams.def", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/a2e76867ad58dd0d7b5e09b95533029ad0659202/gcc%2Fparams.def", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fparams.def?ref=a2e76867ad58dd0d7b5e09b95533029ad0659202", "patch": "@@ -1029,6 +1029,11 @@ DEFPARAM (MIN_PARTITION_SIZE,\n \t  \"Minimal size of a partition for LTO (in estimated instructions).\",\n \t  1000, 0, 0)\n \n+DEFPARAM (MAX_PARTITION_SIZE,\n+\t  \"lto-max-partition\",\n+\t  \"Maximal size of a partition for LTO (in estimated instructions).\",\n+\t  1000000, 0, INT_MAX)\n+\n /* Diagnostic parameters.  */\n \n DEFPARAM (CXX_MAX_NAMESPACES_FOR_DIAGNOSTIC_HELP,"}]}