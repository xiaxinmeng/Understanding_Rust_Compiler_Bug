{"sha": "1c3c12b0a6fdffce0eca0b21518cbb53b20abff1", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6MWMzYzEyYjBhNmZkZmZjZTBlY2EwYjIxNTE4Y2JiNTNiMjBhYmZmMQ==", "commit": {"author": {"name": "Eric Botcazou", "email": "ebotcazou@adacore.com", "date": "2021-03-10T11:04:25Z"}, "committer": {"name": "Eric Botcazou", "email": "ebotcazou@adacore.com", "date": "2021-03-10T11:32:03Z"}, "message": "Fix ICE on atomic enumeration type with LTO\n\nThis is a strange regression whereby an enumeration type declared as\natomic (or volatile) incorrectly triggers the ODR machinery for its\nvalues in LTO mode.\n\ngcc/ada/\n\t* gcc-interface/decl.c (gnat_to_gnu_entity): Build a TYPE_STUB_DECL\n\tfor the main variant of an enumeration type declared as volatile.\ngcc/testsuite/\n\t* gnat.dg/specs/lto25.ads: New test.", "tree": {"sha": "62d26b45c0bbe0298815419884a026be62e26738", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/62d26b45c0bbe0298815419884a026be62e26738"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/1c3c12b0a6fdffce0eca0b21518cbb53b20abff1", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/1c3c12b0a6fdffce0eca0b21518cbb53b20abff1", "html_url": "https://github.com/Rust-GCC/gccrs/commit/1c3c12b0a6fdffce0eca0b21518cbb53b20abff1", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/1c3c12b0a6fdffce0eca0b21518cbb53b20abff1/comments", "author": null, "committer": null, "parents": [{"sha": "da7343a6f48c6813a29640fec744b0a236b6540f", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/da7343a6f48c6813a29640fec744b0a236b6540f", "html_url": "https://github.com/Rust-GCC/gccrs/commit/da7343a6f48c6813a29640fec744b0a236b6540f"}], "stats": {"total": 16, "additions": 16, "deletions": 0}, "files": [{"sha": "27ef51a9eed6755ea2393ecc146526460ec97d86", "filename": "gcc/ada/gcc-interface/decl.c", "status": "modified", "additions": 4, "deletions": 0, "changes": 4, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/1c3c12b0a6fdffce0eca0b21518cbb53b20abff1/gcc%2Fada%2Fgcc-interface%2Fdecl.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/1c3c12b0a6fdffce0eca0b21518cbb53b20abff1/gcc%2Fada%2Fgcc-interface%2Fdecl.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fada%2Fgcc-interface%2Fdecl.c?ref=1c3c12b0a6fdffce0eca0b21518cbb53b20abff1", "patch": "@@ -4713,6 +4713,10 @@ gnat_to_gnu_entity (Entity_Id gnat_entity, tree gnu_expr, bool definition)\n \t  const int quals\n \t    = TYPE_QUAL_VOLATILE\n \t      | (Is_Full_Access (gnat_entity) ? TYPE_QUAL_ATOMIC : 0);\n+\t  /* This is required by free_lang_data_in_type to disable the ODR.  */\n+\t  if (TREE_CODE (gnu_type) == ENUMERAL_TYPE)\n+\t    TYPE_STUB_DECL (gnu_type)\n+\t      = create_type_stub_decl (TYPE_NAME (gnu_type), gnu_type);\n \t  gnu_type = change_qualified_type (gnu_type, quals);\n \t}\n "}, {"sha": "89876b64a00bdfd5533ffe6654e664de4c035d2a", "filename": "gcc/testsuite/gnat.dg/specs/lto25.ads", "status": "added", "additions": 12, "deletions": 0, "changes": 12, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/1c3c12b0a6fdffce0eca0b21518cbb53b20abff1/gcc%2Ftestsuite%2Fgnat.dg%2Fspecs%2Flto25.ads", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/1c3c12b0a6fdffce0eca0b21518cbb53b20abff1/gcc%2Ftestsuite%2Fgnat.dg%2Fspecs%2Flto25.ads", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgnat.dg%2Fspecs%2Flto25.ads?ref=1c3c12b0a6fdffce0eca0b21518cbb53b20abff1", "patch": "@@ -0,0 +1,12 @@\n+-- { dg-do compile }\n+-- { dg-options \"-flto\" { target lto } }\n+\n+package Lto25 is\n+\n+  type Enum is (One, Two, Three) with Atomic;\n+\n+  type Rec is record\n+    E : Enum := One;\n+  end record;\n+\n+end Lto25;"}]}