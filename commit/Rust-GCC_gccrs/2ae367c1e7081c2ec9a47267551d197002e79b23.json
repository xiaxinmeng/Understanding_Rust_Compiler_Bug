{"sha": "2ae367c1e7081c2ec9a47267551d197002e79b23", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6MmFlMzY3YzFlNzA4MWMyZWM5YTQ3MjY3NTUxZDE5NzAwMmU3OWIyMw==", "commit": {"author": {"name": "Sriraman Tallam", "email": "tmsriram@google.com", "date": "2013-11-19T22:12:21Z"}, "committer": {"name": "Sriraman Tallam", "email": "tmsriram@gcc.gnu.org", "date": "2013-11-19T22:12:21Z"}, "message": "Emit a label for the split cold function part.\n\nEmit a label for the split cold function part.  Label name is formed by\nsuffixing the original function name with \"cold\".\n\nPatch tested for bootstrap on all default languages on x86_64 and\nregression testsuite checked for parity with RUNTESTFLAGS -m32 and m64.\n\nFrom-SVN: r205057", "tree": {"sha": "c5c102bd1f2db820f1d57fb913fc67020e0bbb34", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/c5c102bd1f2db820f1d57fb913fc67020e0bbb34"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/2ae367c1e7081c2ec9a47267551d197002e79b23", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/2ae367c1e7081c2ec9a47267551d197002e79b23", "html_url": "https://github.com/Rust-GCC/gccrs/commit/2ae367c1e7081c2ec9a47267551d197002e79b23", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/2ae367c1e7081c2ec9a47267551d197002e79b23/comments", "author": {"login": "tmsri", "id": 38991943, "node_id": "MDQ6VXNlcjM4OTkxOTQz", "avatar_url": "https://avatars.githubusercontent.com/u/38991943?v=4", "gravatar_id": "", "url": "https://api.github.com/users/tmsri", "html_url": "https://github.com/tmsri", "followers_url": "https://api.github.com/users/tmsri/followers", "following_url": "https://api.github.com/users/tmsri/following{/other_user}", "gists_url": "https://api.github.com/users/tmsri/gists{/gist_id}", "starred_url": "https://api.github.com/users/tmsri/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/tmsri/subscriptions", "organizations_url": "https://api.github.com/users/tmsri/orgs", "repos_url": "https://api.github.com/users/tmsri/repos", "events_url": "https://api.github.com/users/tmsri/events{/privacy}", "received_events_url": "https://api.github.com/users/tmsri/received_events", "type": "User", "site_admin": false}, "committer": null, "parents": [{"sha": "50875e80e1ed5ba34bf4342571530b7ad516af1b", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/50875e80e1ed5ba34bf4342571530b7ad516af1b", "html_url": "https://github.com/Rust-GCC/gccrs/commit/50875e80e1ed5ba34bf4342571530b7ad516af1b"}], "stats": {"total": 55, "additions": 55, "deletions": 0}, "files": [{"sha": "9c79ee9e6784da6fdccabe3a87e1d74e8fb658d8", "filename": "gcc/ChangeLog", "status": "modified", "additions": 6, "deletions": 0, "changes": 6, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/2ae367c1e7081c2ec9a47267551d197002e79b23/gcc%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/2ae367c1e7081c2ec9a47267551d197002e79b23/gcc%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2FChangeLog?ref=2ae367c1e7081c2ec9a47267551d197002e79b23", "patch": "@@ -1,3 +1,9 @@\n+2013-11-19  Sriraman Tallam  <tmsriram@google.com>\n+\n+\t* final.c (final_scan_insn): Emit a label for the split\n+\tcold function part.  Label name is formed by suffixing\n+\tthe original function name with \"cold\".\n+\n 2013-11-19  David Malcolm  <dmalcolm@redhat.com>\n \n \t* basic-block.h (ENTRY_BLOCK_PTR_FOR_FUNCTION): Rename macro to..."}, {"sha": "2ab6a4df3e39325affea3abf32d637b706c8822e", "filename": "gcc/final.c", "status": "modified", "additions": 9, "deletions": 0, "changes": 9, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/2ae367c1e7081c2ec9a47267551d197002e79b23/gcc%2Ffinal.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/2ae367c1e7081c2ec9a47267551d197002e79b23/gcc%2Ffinal.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ffinal.c?ref=2ae367c1e7081c2ec9a47267551d197002e79b23", "patch": "@@ -2168,6 +2168,15 @@ final_scan_insn (rtx insn, FILE *file, int optimize_p ATTRIBUTE_UNUSED,\n \t  targetm.asm_out.function_switched_text_sections (asm_out_file,\n \t\t\t\t\t\t\t   current_function_decl,\n \t\t\t\t\t\t\t   in_cold_section_p);\n+\t  /* Emit a label for the split cold section.  Form label name by\n+\t     suffixing \"cold\" to the original function's name.  */\n+\t  if (in_cold_section_p)\n+\t    {\n+\t      tree cold_function_name\n+\t\t= clone_function_name (current_function_decl, \"cold\");\n+\t      ASM_OUTPUT_LABEL (asm_out_file,\n+\t\t\t\tIDENTIFIER_POINTER (cold_function_name));\n+\t    }\n \t  break;\n \n \tcase NOTE_INSN_BASIC_BLOCK:"}, {"sha": "190b2c4deafed3d2c795d2a311f85fb4b381acb3", "filename": "gcc/testsuite/ChangeLog", "status": "modified", "additions": 4, "deletions": 0, "changes": 4, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/2ae367c1e7081c2ec9a47267551d197002e79b23/gcc%2Ftestsuite%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/2ae367c1e7081c2ec9a47267551d197002e79b23/gcc%2Ftestsuite%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2FChangeLog?ref=2ae367c1e7081c2ec9a47267551d197002e79b23", "patch": "@@ -1,3 +1,7 @@\n+2013-11-19  Sriraman Tallam  <tmsriram@google.com>\n+\n+\t* gcc.dg/tree-prof/cold_partition_label.c: New testcase.\n+\n 2013-11-19  Ulrich Weigand  <Ulrich.Weigand@de.ibm.com>\n \n \t* gcc.target/powerpc/ppc64-abi-2.c (MAKE_SLOT): New macro to"}, {"sha": "9dc75668e8dad2604328ff6a9d4abbd08d87753b", "filename": "gcc/testsuite/gcc.dg/tree-prof/cold_partition_label.c", "status": "added", "additions": 36, "deletions": 0, "changes": 36, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/2ae367c1e7081c2ec9a47267551d197002e79b23/gcc%2Ftestsuite%2Fgcc.dg%2Ftree-prof%2Fcold_partition_label.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/2ae367c1e7081c2ec9a47267551d197002e79b23/gcc%2Ftestsuite%2Fgcc.dg%2Ftree-prof%2Fcold_partition_label.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgcc.dg%2Ftree-prof%2Fcold_partition_label.c?ref=2ae367c1e7081c2ec9a47267551d197002e79b23", "patch": "@@ -0,0 +1,36 @@\n+/* Test case to check if function foo gets split and the cold function\n+   gets a label.  */\n+/* { dg-require-effective-target freorder } */\n+/* { dg-options \"-O2 -freorder-blocks-and-partition --save-temps\" } */\n+\n+#define SIZE 10000\n+\n+const char *sarr[SIZE];\n+const char *buf_hot;\n+const char *buf_cold;\n+\n+__attribute__((noinline))\n+void \n+foo (int path)\n+{\n+  int i;\n+  if (path)\n+    {\n+      for (i = 0; i < SIZE; i++)\n+\tsarr[i] = buf_hot;\n+    }\n+  else\n+    {\n+      for (i = 0; i < SIZE; i++)\n+\tsarr[i] = buf_cold;\n+    }\n+}\n+\n+int\n+main (int argc, char *argv[])\n+{\n+  buf_hot =  \"hello\";\n+  buf_cold = \"world\";\n+  foo (argc);\n+  return 0;\n+}"}]}