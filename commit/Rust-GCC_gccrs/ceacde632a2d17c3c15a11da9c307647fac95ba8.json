{"sha": "ceacde632a2d17c3c15a11da9c307647fac95ba8", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6Y2VhY2RlNjMyYTJkMTdjM2MxNWExMWRhOWMzMDc2NDdmYWM5NWJhOA==", "commit": {"author": {"name": "Mark Mitchell", "email": "mark@codesourcery.com", "date": "2006-05-17T21:39:07Z"}, "committer": {"name": "Mark Mitchell", "email": "mmitchel@gcc.gnu.org", "date": "2006-05-17T21:39:07Z"}, "message": "re PR c++/26122 (Pure specifiers for templates causing trouble)\n\n\tPR c++/26122\n\t* decl2.c (check_member_template): Remove checks for virtual\n\tfunctions.\n\t* parser.c (cp_parser_function_specifier_opt): Complain about\n\tvirtual templates.\n\t(cp_parser_pure_specifier): Likewise.\n\tPR c++/26122\n\t* g++.old-deja/g++.oliva/template9.C: Remove XFAIL.\n\nFrom-SVN: r113873", "tree": {"sha": "daeb99f7f4633316f25dd268423f148742b7d42e", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/daeb99f7f4633316f25dd268423f148742b7d42e"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/ceacde632a2d17c3c15a11da9c307647fac95ba8", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/ceacde632a2d17c3c15a11da9c307647fac95ba8", "html_url": "https://github.com/Rust-GCC/gccrs/commit/ceacde632a2d17c3c15a11da9c307647fac95ba8", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/ceacde632a2d17c3c15a11da9c307647fac95ba8/comments", "author": null, "committer": null, "parents": [{"sha": "c89833429b5b5b63c8ff243ce9abd84efc0c1ec7", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/c89833429b5b5b63c8ff243ce9abd84efc0c1ec7", "html_url": "https://github.com/Rust-GCC/gccrs/commit/c89833429b5b5b63c8ff243ce9abd84efc0c1ec7"}], "stats": {"total": 50, "additions": 33, "deletions": 17}, "files": [{"sha": "0d990506d028951fce0258b07848cc96068aa4e4", "filename": "gcc/cp/ChangeLog", "status": "modified", "additions": 7, "deletions": 0, "changes": 7, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/ceacde632a2d17c3c15a11da9c307647fac95ba8/gcc%2Fcp%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/ceacde632a2d17c3c15a11da9c307647fac95ba8/gcc%2Fcp%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fcp%2FChangeLog?ref=ceacde632a2d17c3c15a11da9c307647fac95ba8", "patch": "@@ -1,5 +1,12 @@\n 2006-05-17  Mark Mitchell  <mark@codesourcery.com>\n \n+\tPR c++/26122\n+\t* decl2.c (check_member_template): Remove checks for virtual\n+\tfunctions.\n+\t* parser.c (cp_parser_function_specifier_opt): Complain about\n+\tvirtual templates.\n+\t(cp_parser_pure_specifier): Likewise.\n+\n \tPR c++/26068\n \t* parser.c (cp_parser_set_storage_class): Check for \n \tinvalid uses of storage classes on unbraced linkage"}, {"sha": "27b88f06b526f722a962b17a183ddf6ae25858e2", "filename": "gcc/cp/decl2.c", "status": "modified", "additions": 3, "deletions": 10, "changes": 13, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/ceacde632a2d17c3c15a11da9c307647fac95ba8/gcc%2Fcp%2Fdecl2.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/ceacde632a2d17c3c15a11da9c307647fac95ba8/gcc%2Fcp%2Fdecl2.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fcp%2Fdecl2.c?ref=ceacde632a2d17c3c15a11da9c307647fac95ba8", "patch": "@@ -452,16 +452,9 @@ check_member_template (tree tmpl)\n \terror (\"invalid declaration of member template %q#D in local class\",\n \t       decl);\n \n-      if (TREE_CODE (decl) == FUNCTION_DECL && DECL_VIRTUAL_P (decl))\n-\t{\n-\t  /* 14.5.2.3 [temp.mem]\n-\n-\t     A member function template shall not be virtual.  */\n-\t  error\n-\t    (\"invalid use of %<virtual%> in template declaration of %q#D\",\n-\t     decl);\n-\t  DECL_VIRTUAL_P (decl) = 0;\n-\t}\n+      /* The parser rejects any use of virtual in a function template.  */\n+      gcc_assert (!(TREE_CODE (decl) == FUNCTION_DECL\n+\t\t    && DECL_VIRTUAL_P (decl)));\n \n       /* The debug-information generating code doesn't know what to do\n \t with member templates.  */"}, {"sha": "e80b8ee09d957790e48c0b45cd29d8b88815f9e8", "filename": "gcc/cp/parser.c", "status": "modified", "additions": 19, "deletions": 6, "changes": 25, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/ceacde632a2d17c3c15a11da9c307647fac95ba8/gcc%2Fcp%2Fparser.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/ceacde632a2d17c3c15a11da9c307647fac95ba8/gcc%2Fcp%2Fparser.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fcp%2Fparser.c?ref=ceacde632a2d17c3c15a11da9c307647fac95ba8", "patch": "@@ -7664,7 +7664,12 @@ cp_parser_function_specifier_opt (cp_parser* parser,\n       break;\n \n     case RID_VIRTUAL:\n-      if (decl_specs)\n+      /* 14.5.2.3 [temp.mem]\n+\t \n+         A member function template shall not be virtual.  */\n+      if (PROCESSING_REAL_TEMPLATE_DECL_P ())\n+\terror (\"templates may not be %<virtual%>\");\n+      else if (decl_specs)\n \t++decl_specs->specs[(int) ds_virtual];\n       break;\n \n@@ -13864,12 +13869,20 @@ cp_parser_pure_specifier (cp_parser* parser)\n   /* Look for the `0' token.  */\n   token = cp_lexer_consume_token (parser->lexer);\n   /* c_lex_with_flags marks a single digit '0' with PURE_ZERO.  */\n-  if (token->type == CPP_NUMBER && (token->flags & PURE_ZERO))\n-    return integer_zero_node;\n+  if (token->type != CPP_NUMBER || !(token->flags & PURE_ZERO))\n+    {\n+      cp_parser_error (parser, \n+\t\t       \"invalid pure specifier (only `= 0' is allowed)\");\n+      cp_parser_skip_to_end_of_statement (parser);\n+      return error_mark_node;\n+    }\n+  if (PROCESSING_REAL_TEMPLATE_DECL_P ())\n+    {\n+      error (\"templates may not be %<virtual%>\");\n+      return error_mark_node;\n+    }\n \n-  cp_parser_error (parser, \"invalid pure specifier (only `= 0' is allowed)\");\n-  cp_parser_skip_to_end_of_statement (parser);\n-  return error_mark_node;\n+  return integer_zero_node;\n }\n \n /* Parse a constant-initializer."}, {"sha": "9cf94049cf820acf6a962c0401d948d7888dbeba", "filename": "gcc/testsuite/ChangeLog", "status": "modified", "additions": 3, "deletions": 0, "changes": 3, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/ceacde632a2d17c3c15a11da9c307647fac95ba8/gcc%2Ftestsuite%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/ceacde632a2d17c3c15a11da9c307647fac95ba8/gcc%2Ftestsuite%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2FChangeLog?ref=ceacde632a2d17c3c15a11da9c307647fac95ba8", "patch": "@@ -1,5 +1,8 @@\n 2006-05-17  Mark Mitchell  <mark@codesourcery.com>\n \n+\tPR c++/26122\n+\t* g++.old-deja/g++.oliva/template9.C: Remove XFAIL.\n+\n \tPR c++/26068\n \t* g++.dg/opt/pr17697-3.C: Remove invalid extern specifier.\n \t* g++.dg/parse/linkage1.C: New test."}, {"sha": "02be37a5f9977b10d8ca4831fbcc3c5882656bd7", "filename": "gcc/testsuite/g++.old-deja/g++.oliva/template9.C", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/ceacde632a2d17c3c15a11da9c307647fac95ba8/gcc%2Ftestsuite%2Fg%2B%2B.old-deja%2Fg%2B%2B.oliva%2Ftemplate9.C", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/ceacde632a2d17c3c15a11da9c307647fac95ba8/gcc%2Ftestsuite%2Fg%2B%2B.old-deja%2Fg%2B%2B.oliva%2Ftemplate9.C", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fg%2B%2B.old-deja%2Fg%2B%2B.oliva%2Ftemplate9.C?ref=ceacde632a2d17c3c15a11da9c307647fac95ba8", "patch": "@@ -7,5 +7,5 @@\n \n struct foo {\n   template <class>\n-  void bar() = 0; // { dg-error \"\" \"\" { xfail *-*-* } } invalid initializer - \n+  void bar() = 0; // { dg-error \"virtual\" }\n };"}]}