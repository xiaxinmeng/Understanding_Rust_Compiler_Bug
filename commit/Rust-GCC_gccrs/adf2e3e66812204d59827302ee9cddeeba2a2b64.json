{"sha": "adf2e3e66812204d59827302ee9cddeeba2a2b64", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6YWRmMmUzZTY2ODEyMjA0ZDU5ODI3MzAyZWU5Y2RkZWViYTJhMmI2NA==", "commit": {"author": {"name": "Paolo Carlini", "email": "pcarlini@unitus.it", "date": "2002-04-26T18:21:32Z"}, "committer": {"name": "Paolo Carlini", "email": "paolo@gcc.gnu.org", "date": "2002-04-26T18:21:32Z"}, "message": "basic_string.h (replace(__pos, __n1, __s, __n2): Fix and tighten __throw_length_error check.\n\n2002-04-26  Paolo Carlini  <pcarlini@unitus.it>\n\n\t* include/bits/basic_string.h (replace(__pos, __n1, __s, __n2):\n\tFix and tighten __throw_length_error check.\n\t* testsuite/21_strings/replace.cc (test05): New.\n\t* testsuite/21_strings/replace.cc (test02, test03, test04): Tweak.\n\nFrom-SVN: r52797", "tree": {"sha": "ba9d0378036212ae276aceb1413198a4370acc43", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/ba9d0378036212ae276aceb1413198a4370acc43"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/adf2e3e66812204d59827302ee9cddeeba2a2b64", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/adf2e3e66812204d59827302ee9cddeeba2a2b64", "html_url": "https://github.com/Rust-GCC/gccrs/commit/adf2e3e66812204d59827302ee9cddeeba2a2b64", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/adf2e3e66812204d59827302ee9cddeeba2a2b64/comments", "author": null, "committer": null, "parents": [{"sha": "bde3c0c07d7d1d92644aef53c91735234e8330ec", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/bde3c0c07d7d1d92644aef53c91735234e8330ec", "html_url": "https://github.com/Rust-GCC/gccrs/commit/bde3c0c07d7d1d92644aef53c91735234e8330ec"}], "stats": {"total": 28, "additions": 26, "deletions": 2}, "files": [{"sha": "34b1304af06a555455989599d6328de6b3819a2e", "filename": "libstdc++-v3/ChangeLog", "status": "modified", "additions": 7, "deletions": 0, "changes": 7, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/adf2e3e66812204d59827302ee9cddeeba2a2b64/libstdc%2B%2B-v3%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/adf2e3e66812204d59827302ee9cddeeba2a2b64/libstdc%2B%2B-v3%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libstdc%2B%2B-v3%2FChangeLog?ref=adf2e3e66812204d59827302ee9cddeeba2a2b64", "patch": "@@ -1,3 +1,10 @@\n+2002-04-26  Paolo Carlini  <pcarlini@unitus.it>\n+\n+\t* include/bits/basic_string.h (replace(__pos, __n1, __s, __n2):\n+\tFix and tighten __throw_length_error check.\n+\t* testsuite/21_strings/replace.cc (test05): New.\n+\t* testsuite/21_strings/replace.cc (test02, test03, test04): Tweak.\n+\n 2002-04-23  Loren J. Rittle <ljrittle@acm.org>\n \n \t* include/std/std_fstream.h (basic_filebuf::sync): Hoist"}, {"sha": "b7d826dc08b60c735e4b549f8d032f47cfc8c9a5", "filename": "libstdc++-v3/include/bits/basic_string.h", "status": "modified", "additions": 2, "deletions": 2, "changes": 4, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/adf2e3e66812204d59827302ee9cddeeba2a2b64/libstdc%2B%2B-v3%2Finclude%2Fbits%2Fbasic_string.h", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/adf2e3e66812204d59827302ee9cddeeba2a2b64/libstdc%2B%2B-v3%2Finclude%2Fbits%2Fbasic_string.h", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libstdc%2B%2B-v3%2Finclude%2Fbits%2Fbasic_string.h?ref=adf2e3e66812204d59827302ee9cddeeba2a2b64", "patch": "@@ -642,10 +642,10 @@ namespace std\n \tconst size_type __size = this->size();\n  \tif (__pos > __size)\n \t  __throw_out_of_range(\"basic_string::replace\");\n-\tif (__size - __n1 > this->max_size() - __n2)\n-\t  __throw_length_error(\"basic_string::replace\");\n \tconst bool __testn1 = __n1 < __size - __pos;\n \tconst size_type __foldn1 = __testn1 ? __n1 : __size - __pos;\n+\tif (__size - __foldn1 > this->max_size() - __n2)\n+\t  __throw_length_error(\"basic_string::replace\");\n \tif (_M_rep()->_M_is_shared() || less<const _CharT*>()(__s, _M_data())\n \t    || less<const _CharT*>()(_M_data() + __size, __s))\n \t  return _M_replace_safe(_M_ibegin() + __pos,"}, {"sha": "6dc9ec6b9bf712cc5b66b627ab4e68b410ea20ec", "filename": "libstdc++-v3/testsuite/21_strings/replace.cc", "status": "modified", "additions": 17, "deletions": 0, "changes": 17, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/adf2e3e66812204d59827302ee9cddeeba2a2b64/libstdc%2B%2B-v3%2Ftestsuite%2F21_strings%2Freplace.cc", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/adf2e3e66812204d59827302ee9cddeeba2a2b64/libstdc%2B%2B-v3%2Ftestsuite%2F21_strings%2Freplace.cc", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libstdc%2B%2B-v3%2Ftestsuite%2F21_strings%2Freplace.cc?ref=adf2e3e66812204d59827302ee9cddeeba2a2b64", "patch": "@@ -84,6 +84,7 @@ bool test01(void)\n void\n test02()\n {\n+  bool test = true;\n   const char* strlit = \"../the long pier/Hanalei Bay/Kauai/Hawaii\";\n   std::string aux = strlit;\n   aux.replace(aux.begin()+5, aux.begin()+20,\n@@ -100,6 +101,7 @@ test02()\n void\n test03()\n {\n+  bool test = true;\n   const char* title01 = \"nine types of ambiguity\";\n   const char* title02 = \"ultra\";\n   std::string str01 = title01;\n@@ -145,6 +147,7 @@ test03()\n void\n test04()\n {\n+  bool test = true;\n   std::string str01 = \"geogaddi\";\n   std::string str02;\n \n@@ -175,11 +178,25 @@ test04()\n   VERIFY(str02 == \"geogaddi\");\n }\n \n+// We wrongly used __n1 instead of __foldn1 in the length_error\n+// check at the beginning of replace(__pos, __n1, __s, __n2)\n+void\n+test05()\n+{\n+  bool test = true;\n+  std::string str01 = \"londinium\";\n+  std::string str02 = \"cydonia\";\n+\n+  str01.replace(0, 20, str02.c_str(), 3);\n+  VERIFY(str01 == \"cyd\");\n+}\n+\n int main()\n { \n   test01();\n   test02();\n   test03();\n   test04();\n+  test05();\n   return 0;\n }"}]}