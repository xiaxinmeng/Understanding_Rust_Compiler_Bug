{"sha": "41d146597caea6d5cab6def07a8b127de7b2099c", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6NDFkMTQ2NTk3Y2FlYTZkNWNhYjZkZWYwN2E4YjEyN2RlN2IyMDk5Yw==", "commit": {"author": {"name": "Ramana Radhakrishnan", "email": "ramana.radhakrishnan@arm.com", "date": "2016-04-01T14:58:53Z"}, "committer": {"name": "Ramana Radhakrishnan", "email": "ramana@gcc.gnu.org", "date": "2016-04-01T14:58:53Z"}, "message": "re PR target/70496 (inadvertent change to ASM_APP_OFF for .arm / .thumb directives.)\n\nFix PR target/70496\n\nWhile doing the unified asm rewrite - I inadvertently changed the\nmeaning of ASM_APP_OFF which causes failures when folks who know what\nthey are doing switch between arm and thumb states within a\nfunction. The intent of the unified asm rewrite was not to affect any\ninline assembler code in that it would remain in divided syntax by\ndefault and switching back to unified asm in normal compiled code\nafter the inline assembler block. Thanks to Jim Wilson for pointing it\nout on the linaro list.\n\nFixed thusly and a test is added. Tested arm-none-eabi cross and\napplied.\n\nRamana\n\n2016-04-01  Ramana Radhakrishnan  <ramana.radhakrishnan@arm.com>\n\n\tPR target/70496\n\t* config/arm/arm.h (ASM_APP_OFF): Handle TARGET_ARM\n\tand TARGET_THUMB.\n\n2016-04-01  Ramana Radhakrishnan  <ramana.radhakrishnan@arm.com>\n\n\tPR target/70496\n\t* gcc.target/arm/pr70496.c: New test.\n\nFrom-SVN: r234675", "tree": {"sha": "5d55f640e781322ec4066f43f995a1399b6a9854", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/5d55f640e781322ec4066f43f995a1399b6a9854"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/41d146597caea6d5cab6def07a8b127de7b2099c", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/41d146597caea6d5cab6def07a8b127de7b2099c", "html_url": "https://github.com/Rust-GCC/gccrs/commit/41d146597caea6d5cab6def07a8b127de7b2099c", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/41d146597caea6d5cab6def07a8b127de7b2099c/comments", "author": null, "committer": null, "parents": [{"sha": "9553dd73e12101952610efe89be599e06d999aee", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/9553dd73e12101952610efe89be599e06d999aee", "html_url": "https://github.com/Rust-GCC/gccrs/commit/9553dd73e12101952610efe89be599e06d999aee"}], "stats": {"total": 26, "additions": 25, "deletions": 1}, "files": [{"sha": "b0ac14078979b6fd435a96d45bf827fa1e22cd52", "filename": "gcc/ChangeLog", "status": "modified", "additions": 6, "deletions": 0, "changes": 6, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/41d146597caea6d5cab6def07a8b127de7b2099c/gcc%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/41d146597caea6d5cab6def07a8b127de7b2099c/gcc%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2FChangeLog?ref=41d146597caea6d5cab6def07a8b127de7b2099c", "patch": "@@ -1,3 +1,9 @@\n+2016-04-01  Ramana Radhakrishnan  <ramana.radhakrishnan@arm.com>\n+\n+\tPR target/70496\n+\t* config/arm/arm.h (ASM_APP_OFF): Handle TARGET_ARM\n+\tand TARGET_THUMB.\n+\n 2016-04-01  Nathan Sidwell  <nathan@acm.org>\n \n \t* tree.def (TRY_CATCH_EXPR): Correct documentation."}, {"sha": "ad123dde991a3e4c4b9563ee6ebb84981767988f", "filename": "gcc/config/arm/arm.h", "status": "modified", "additions": 2, "deletions": 1, "changes": 3, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/41d146597caea6d5cab6def07a8b127de7b2099c/gcc%2Fconfig%2Farm%2Farm.h", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/41d146597caea6d5cab6def07a8b127de7b2099c/gcc%2Fconfig%2Farm%2Farm.h", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fconfig%2Farm%2Farm.h?ref=41d146597caea6d5cab6def07a8b127de7b2099c", "patch": "@@ -2037,7 +2037,8 @@ extern int making_const_table;\n \t\t    \"\\t.syntax divided\\n\")\n \n #undef  ASM_APP_OFF\n-#define ASM_APP_OFF \"\\t.syntax unified\\n\"\n+#define ASM_APP_OFF (TARGET_ARM ? \"\\t.arm\\n\\t.syntax unified\\n\" : \\\n+\t\t     \"\\t.thumb\\n\\t.syntax unified\\n\")\n \n /* Output a push or a pop instruction (only used when profiling).\n    We can't push STATIC_CHAIN_REGNUM (r12) directly with Thumb-1.  We know"}, {"sha": "5393d8c7ee3e5d131abd0425828844fe3e85aa0b", "filename": "gcc/testsuite/ChangeLog", "status": "modified", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/41d146597caea6d5cab6def07a8b127de7b2099c/gcc%2Ftestsuite%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/41d146597caea6d5cab6def07a8b127de7b2099c/gcc%2Ftestsuite%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2FChangeLog?ref=41d146597caea6d5cab6def07a8b127de7b2099c", "patch": "@@ -1,3 +1,8 @@\n+2016-04-01  Ramana Radhakrishnan  <ramana.radhakrishnan@arm.com>\n+\n+\tPR target/70496\n+\t* gcc.target/arm/pr70496.c: New test.\n+\n 2016-04-01  Nathan Sidwell  <nathan@acm.org>\n \n \tPR c++/68475"}, {"sha": "89957e2c7a75cb89153b3e3fc34d8051b6a997d1", "filename": "gcc/testsuite/gcc.target/arm/pr70496.c", "status": "added", "additions": 12, "deletions": 0, "changes": 12, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/41d146597caea6d5cab6def07a8b127de7b2099c/gcc%2Ftestsuite%2Fgcc.target%2Farm%2Fpr70496.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/41d146597caea6d5cab6def07a8b127de7b2099c/gcc%2Ftestsuite%2Fgcc.target%2Farm%2Fpr70496.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgcc.target%2Farm%2Fpr70496.c?ref=41d146597caea6d5cab6def07a8b127de7b2099c", "patch": "@@ -0,0 +1,12 @@\n+/* { dg-do assemble } */\n+/* { dg-options \"-mthumb -O2\" } */\n+/* { dg-require-effective-target arm_thumb2_ok } */\n+\n+int i;\n+void\n+main (void)\n+{\n+  __asm__ volatile (\".arm\");\n+  i = 0;\n+  __asm__ volatile (\"\\n cbz r0, 2f\\n2:\");\n+}"}]}