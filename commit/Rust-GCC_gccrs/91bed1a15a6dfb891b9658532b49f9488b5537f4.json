{"sha": "91bed1a15a6dfb891b9658532b49f9488b5537f4", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6OTFiZWQxYTE1YTZkZmI4OTFiOTY1ODUzMmI0OWY5NDg4YjU1MzdmNA==", "commit": {"author": {"name": "Richard Earnshaw", "email": "rearnsha@arm.com", "date": "2019-06-20T17:27:06Z"}, "committer": {"name": "Richard Earnshaw", "email": "rearnsha@gcc.gnu.org", "date": "2019-06-20T17:27:06Z"}, "message": "[aarch64] Refactor common errata work-around specs\n\nWith the addition of the AArch64 NetBSD support code we now have four\nports all using and defining the same errata work-around headers.\nThat's silly and long-term becomes a maintenance burden.\n\nThis patch factors all that code into a single header to eliminate all\nthe duplication.\n\n\t* config/aarch64/aarch64-errata.h: New file.\n\t* config/aarch64/aarch64-elf-raw.h (CA53_ERR_835769_SPEC): Delete.\n\t(CA53_ERR_843419_SPEC): Delete.\n\t(LINK_SPEC): Use AARCH64_ERRATA_LINK_SPEC instead of above.\n\t* config/aarch64/aarch64-linux.h: Likewise.\n\t* config/aarch64/aarch64-netbsd.h: Likewise.\n\t* config/aarch64/aarch64-freebsd.h: Likewise.\n\nFrom-SVN: r272515", "tree": {"sha": "929885c2d0d8b1a1d8a37485cbeccfd4178affa6", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/929885c2d0d8b1a1d8a37485cbeccfd4178affa6"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/91bed1a15a6dfb891b9658532b49f9488b5537f4", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/91bed1a15a6dfb891b9658532b49f9488b5537f4", "html_url": "https://github.com/Rust-GCC/gccrs/commit/91bed1a15a6dfb891b9658532b49f9488b5537f4", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/91bed1a15a6dfb891b9658532b49f9488b5537f4/comments", "author": null, "committer": null, "parents": [{"sha": "ceb76ffc6b65e8e35d6cde1148dc0ac958e4a06c", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/ceb76ffc6b65e8e35d6cde1148dc0ac958e4a06c", "html_url": "https://github.com/Rust-GCC/gccrs/commit/ceb76ffc6b65e8e35d6cde1148dc0ac958e4a06c"}], "stats": {"total": 141, "additions": 63, "deletions": 78}, "files": [{"sha": "26ac4e70e7662d15b1e33209febd6a680abf953a", "filename": "gcc/ChangeLog", "status": "modified", "additions": 10, "deletions": 0, "changes": 10, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/91bed1a15a6dfb891b9658532b49f9488b5537f4/gcc%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/91bed1a15a6dfb891b9658532b49f9488b5537f4/gcc%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2FChangeLog?ref=91bed1a15a6dfb891b9658532b49f9488b5537f4", "patch": "@@ -1,3 +1,13 @@\n+2019-06-20  Richard Earnshaw  <rearnsha@arm.com>\n+\n+\t* config/aarch64/aarch64-errata.h: New file.\n+\t* config/aarch64/aarch64-elf-raw.h (CA53_ERR_835769_SPEC): Delete.\n+\t(CA53_ERR_843419_SPEC): Delete.\n+\t(LINK_SPEC): Use AARCH64_ERRATA_LINK_SPEC instead of above.\n+\t* config/aarch64/aarch64-linux.h: Likewise.\n+\t* config/aarch64/aarch64-netbsd.h: Likewise.\n+\t* config/aarch64/aarch64-freebsd.h: Likewise.\n+\n 2019-06-20  Marek Polacek  <polacek@redhat.com>\n \n \t* config/sh/sh.c (sh2a_function_vector_p): Use get_attribute_name."}, {"sha": "8488ab64702f4355565e9c0b422643ff7f0da7c9", "filename": "gcc/config.gcc", "status": "modified", "additions": 4, "deletions": 4, "changes": 8, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/91bed1a15a6dfb891b9658532b49f9488b5537f4/gcc%2Fconfig.gcc", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/91bed1a15a6dfb891b9658532b49f9488b5537f4/gcc%2Fconfig.gcc", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fconfig.gcc?ref=91bed1a15a6dfb891b9658532b49f9488b5537f4", "patch": "@@ -980,7 +980,7 @@ esac\n case ${target} in\n aarch64*-*-elf | aarch64*-*-fuchsia* | aarch64*-*-rtems*)\n \ttm_file=\"${tm_file} dbxelf.h elfos.h newlib-stdint.h\"\n-\ttm_file=\"${tm_file} aarch64/aarch64-elf.h aarch64/aarch64-elf-raw.h\"\n+\ttm_file=\"${tm_file} aarch64/aarch64-elf.h aarch64/aarch64-errata.h aarch64/aarch64-elf-raw.h\"\n \ttmake_file=\"${tmake_file} aarch64/t-aarch64\"\n \tcase $target in\n \taarch64-*-elf*)\n@@ -1017,19 +1017,19 @@ aarch64*-*-elf | aarch64*-*-fuchsia* | aarch64*-*-rtems*)\n \t;;\n aarch64*-*-freebsd*)\n \ttm_file=\"${tm_file} dbxelf.h elfos.h ${fbsd_tm_file}\"\n-\ttm_file=\"${tm_file} aarch64/aarch64-elf.h aarch64/aarch64-freebsd.h\"\n+\ttm_file=\"${tm_file} aarch64/aarch64-elf.h aarch64/aarch64-errata.h aarch64/aarch64-freebsd.h\"\n \ttmake_file=\"${tmake_file} aarch64/t-aarch64 aarch64/t-aarch64-freebsd\"\n \ttm_defines=\"${tm_defines}  TARGET_DEFAULT_ASYNC_UNWIND_TABLES=1\"\n \t;;\n aarch64*-*-netbsd*)\n \ttm_file=\"${tm_file} dbxelf.h elfos.h ${nbsd_tm_file}\"\n-\ttm_file=\"${tm_file} aarch64/aarch64-elf.h aarch64/aarch64-netbsd.h\"\n+\ttm_file=\"${tm_file} aarch64/aarch64-elf.h aarch64/aarch64-errata.h aarch64/aarch64-netbsd.h\"\n \ttmake_file=\"${tmake_file} aarch64/t-aarch64 aarch64/t-aarch64-netbsd\"\n \textra_options=\"${extra_options} netbsd.opt netbsd-elf.opt\"\n \t;;\n aarch64*-*-linux*)\n \ttm_file=\"${tm_file} dbxelf.h elfos.h gnu-user.h linux.h glibc-stdint.h\"\n-\ttm_file=\"${tm_file} aarch64/aarch64-elf.h aarch64/aarch64-linux.h\"\n+\ttm_file=\"${tm_file} aarch64/aarch64-elf.h aarch64/aarch64-errata.h aarch64/aarch64-linux.h\"\n \ttmake_file=\"${tmake_file} aarch64/t-aarch64 aarch64/t-aarch64-linux\"\n \ttm_defines=\"${tm_defines}  TARGET_DEFAULT_ASYNC_UNWIND_TABLES=1\"\n \tcase $target in"}, {"sha": "8fe7b378360e0afd6d5c3af25e8b39af29c9c1a9", "filename": "gcc/config/aarch64/aarch64-elf-raw.h", "status": "modified", "additions": 1, "deletions": 18, "changes": 19, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/91bed1a15a6dfb891b9658532b49f9488b5537f4/gcc%2Fconfig%2Faarch64%2Faarch64-elf-raw.h", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/91bed1a15a6dfb891b9658532b49f9488b5537f4/gcc%2Fconfig%2Faarch64%2Faarch64-elf-raw.h", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fconfig%2Faarch64%2Faarch64-elf-raw.h?ref=91bed1a15a6dfb891b9658532b49f9488b5537f4", "patch": "@@ -27,22 +27,6 @@\n   \" crtend%O%s crtn%O%s \" \\\n   \"%{Ofast|ffast-math|funsafe-math-optimizations:crtfastmath.o%s}\"\n \n-#if TARGET_FIX_ERR_A53_835769_DEFAULT\n-#define CA53_ERR_835769_SPEC \\\n-  \" %{!mno-fix-cortex-a53-835769:--fix-cortex-a53-835769}\"\n-#else\n-#define CA53_ERR_835769_SPEC \\\n-  \" %{mfix-cortex-a53-835769:--fix-cortex-a53-835769}\"\n-#endif\n-\n-#if TARGET_FIX_ERR_A53_843419_DEFAULT\n-#define CA53_ERR_843419_SPEC \\\n-  \" %{!mno-fix-cortex-a53-843419:--fix-cortex-a53-843419}\"\n-#else\n-#define CA53_ERR_843419_SPEC \\\n-  \" %{mfix-cortex-a53-843419:--fix-cortex-a53-843419}\"\n-#endif\n-\n #ifndef LINK_SPEC\n #define LINK_SPEC \"%{h*}\t\t\t\\\n    %{static:-Bstatic}\t\t\t\t\\\n@@ -51,8 +35,7 @@\n    %{!static:%{rdynamic:-export-dynamic}}\t\\\n    %{mbig-endian:-EB} %{mlittle-endian:-EL} -X\t\\\n   -maarch64elf%{mabi=ilp32*:32}%{mbig-endian:b}\" \\\n-  CA53_ERR_835769_SPEC \\\n-  CA53_ERR_843419_SPEC\n+  AARCH64_ERRATA_LINK_SPEC\n #endif\n \n #endif /* GCC_AARCH64_ELF_RAW_H */"}, {"sha": "8f062536e8b291e6873e7693e31944bf18f224fd", "filename": "gcc/config/aarch64/aarch64-errata.h", "status": "added", "additions": 44, "deletions": 0, "changes": 44, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/91bed1a15a6dfb891b9658532b49f9488b5537f4/gcc%2Fconfig%2Faarch64%2Faarch64-errata.h", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/91bed1a15a6dfb891b9658532b49f9488b5537f4/gcc%2Fconfig%2Faarch64%2Faarch64-errata.h", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fconfig%2Faarch64%2Faarch64-errata.h?ref=91bed1a15a6dfb891b9658532b49f9488b5537f4", "patch": "@@ -0,0 +1,44 @@\n+/* Machine description for AArch64 architecture.\n+   Copyright (C) 2009-2019 Free Software Foundation, Inc.\n+   Contributed by ARM Ltd.\n+\n+   This file is part of GCC.\n+\n+   GCC is free software; you can redistribute it and/or modify it\n+   under the terms of the GNU General Public License as published by\n+   the Free Software Foundation; either version 3, or (at your option)\n+   any later version.\n+\n+   GCC is distributed in the hope that it will be useful, but\n+   WITHOUT ANY WARRANTY; without even the implied warranty of\n+   MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU\n+   General Public License for more details.\n+\n+   You should have received a copy of the GNU General Public License\n+   along with GCC; see the file COPYING3.  If not see\n+   <http://www.gnu.org/licenses/>.  */\n+\n+#ifndef GCC_AARCH64_ERRATA_H\n+#define GCC_AARCH64_ERRATA_H\n+\n+#if TARGET_FIX_ERR_A53_835769_DEFAULT\n+#define CA53_ERR_835769_SPEC \\\n+  \" %{!mno-fix-cortex-a53-835769:--fix-cortex-a53-835769}\"\n+#else\n+#define CA53_ERR_835769_SPEC \\\n+  \" %{mfix-cortex-a53-835769:--fix-cortex-a53-835769}\"\n+#endif\n+\n+#if TARGET_FIX_ERR_A53_843419_DEFAULT\n+#define CA53_ERR_843419_SPEC \\\n+  \" %{!mno-fix-cortex-a53-843419:--fix-cortex-a53-843419}\"\n+#else\n+#define CA53_ERR_843419_SPEC \\\n+  \" %{mfix-cortex-a53-843419:--fix-cortex-a53-843419}\"\n+#endif\n+\n+#define AARCH64_ERRATA_LINK_SPEC\t\t\\\n+  CA53_ERR_835769_SPEC\t\t\t\t\\\n+  CA53_ERR_843419_SPEC\n+\n+#endif /*  GCC_AARCH64_ERRATA_H */"}, {"sha": "7a3e89b1b0e199fe65b4a0b2e573cae3574e7bf2", "filename": "gcc/config/aarch64/aarch64-freebsd.h", "status": "modified", "additions": 1, "deletions": 19, "changes": 20, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/91bed1a15a6dfb891b9658532b49f9488b5537f4/gcc%2Fconfig%2Faarch64%2Faarch64-freebsd.h", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/91bed1a15a6dfb891b9658532b49f9488b5537f4/gcc%2Fconfig%2Faarch64%2Faarch64-freebsd.h", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fconfig%2Faarch64%2Faarch64-freebsd.h?ref=91bed1a15a6dfb891b9658532b49f9488b5537f4", "patch": "@@ -46,26 +46,8 @@\n     -X\" SUBTARGET_EXTRA_LINK_SPEC \"                             \\\n     %{mbig-endian:-EB} %{mlittle-endian:-EL}\"\n \n-#if TARGET_FIX_ERR_A53_835769_DEFAULT\n-#define CA53_ERR_835769_SPEC \\\n-  \" %{!mno-fix-cortex-a53-835769:--fix-cortex-a53-835769}\"\n-#else\n-#define CA53_ERR_835769_SPEC \\\n-  \" %{mfix-cortex-a53-835769:--fix-cortex-a53-835769}\"\n-#endif\n-\n-#ifdef TARGET_FIX_ERR_A53_843419_DEFAULT\n-#define CA53_ERR_843419_SPEC \\\n-  \" %{!mno-fix-cortex-a53-843419:--fix-cortex-a53-843419}\"\n-#else\n-#define CA53_ERR_843419_SPEC \\\n-  \" %{mfix-cortex-a53-843419:--fix-cortex-a53-843419}\"\n-#endif\n-\n #undef  LINK_SPEC\n-#define LINK_SPEC FBSD_TARGET_LINK_SPEC\t\\\n-                  CA53_ERR_835769_SPEC\t\\\n-                  CA53_ERR_843419_SPEC\n+#define LINK_SPEC FBSD_TARGET_LINK_SPEC AARCH64_ERRATA_LINK_SPEC\n \n #define GNU_USER_TARGET_MATHFILE_SPEC \\\n   \"%{Ofast|ffast-math|funsafe-math-optimizations:crtfastmath.o%s}\""}, {"sha": "6ff2163b633409dedbb1a8f573fee364e3657d8b", "filename": "gcc/config/aarch64/aarch64-linux.h", "status": "modified", "additions": 2, "deletions": 19, "changes": 21, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/91bed1a15a6dfb891b9658532b49f9488b5537f4/gcc%2Fconfig%2Faarch64%2Faarch64-linux.h", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/91bed1a15a6dfb891b9658532b49f9488b5537f4/gcc%2Fconfig%2Faarch64%2Faarch64-linux.h", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fconfig%2Faarch64%2Faarch64-linux.h?ref=91bed1a15a6dfb891b9658532b49f9488b5537f4", "patch": "@@ -46,25 +46,8 @@\n    %{mbig-endian:-EB} %{mlittle-endian:-EL}     \\\n    -maarch64linux%{mabi=ilp32:32}%{mbig-endian:b}\"\n \n-#if TARGET_FIX_ERR_A53_835769_DEFAULT\n-#define CA53_ERR_835769_SPEC \\\n-  \" %{!mno-fix-cortex-a53-835769:--fix-cortex-a53-835769}\"\n-#else\n-#define CA53_ERR_835769_SPEC \\\n-  \" %{mfix-cortex-a53-835769:--fix-cortex-a53-835769}\"\n-#endif\n-\n-#if TARGET_FIX_ERR_A53_843419_DEFAULT\n-#define CA53_ERR_843419_SPEC \\\n-  \" %{!mno-fix-cortex-a53-843419:--fix-cortex-a53-843419}\"\n-#else\n-#define CA53_ERR_843419_SPEC \\\n-  \" %{mfix-cortex-a53-843419:--fix-cortex-a53-843419}\"\n-#endif\n-\n-#define LINK_SPEC LINUX_TARGET_LINK_SPEC \\\n-                  CA53_ERR_835769_SPEC \\\n-                  CA53_ERR_843419_SPEC\n+\n+#define LINK_SPEC LINUX_TARGET_LINK_SPEC AARCH64_ERRATA_LINK_SPEC\n \n #define GNU_USER_TARGET_MATHFILE_SPEC \\\n   \"%{Ofast|ffast-math|funsafe-math-optimizations:crtfastmath.o%s}\""}, {"sha": "e6c9264bd4ae48a6403a71d568f10ee4ceea628e", "filename": "gcc/config/aarch64/aarch64-netbsd.h", "status": "modified", "additions": 1, "deletions": 18, "changes": 19, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/91bed1a15a6dfb891b9658532b49f9488b5537f4/gcc%2Fconfig%2Faarch64%2Faarch64-netbsd.h", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/91bed1a15a6dfb891b9658532b49f9488b5537f4/gcc%2Fconfig%2Faarch64%2Faarch64-netbsd.h", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fconfig%2Faarch64%2Faarch64-netbsd.h?ref=91bed1a15a6dfb891b9658532b49f9488b5537f4", "patch": "@@ -39,27 +39,10 @@\n   \"%{mlittle-endian:-EL -m \" TARGET_LINKER_LITTLE_EMULATION \"} \"\t\\\n   \"%(netbsd_link_spec)\"\n \n-#if TARGET_FIX_ERR_A53_835769_DEFAULT\n-#define CA53_ERR_835769_SPEC \\\n-  \" %{!mno-fix-cortex-a53-835769:--fix-cortex-a53-835769}\"\n-#else\n-#define CA53_ERR_835769_SPEC \\\n-  \" %{mfix-cortex-a53-835769:--fix-cortex-a53-835769}\"\n-#endif\n-\n-#ifdef TARGET_FIX_ERR_A53_843419_DEFAULT\n-#define CA53_ERR_843419_SPEC \\\n-  \" %{!mno-fix-cortex-a53-843419:--fix-cortex-a53-843419}\"\n-#else\n-#define CA53_ERR_843419_SPEC \\\n-  \" %{mfix-cortex-a53-843419:--fix-cortex-a53-843419}\"\n-#endif\n-\n #undef  LINK_SPEC\n #define LINK_SPEC NETBSD_LINK_SPEC_ELF\t\t\\\n \t\t  NETBSD_TARGET_LINK_SPEC\t\\\n-\t\t  CA53_ERR_835769_SPEC\t\t\\\n-\t\t  CA53_ERR_843419_SPEC\n+\t\t  AARCH64_ERRATA_LINK_SPEC\n \n #undef TARGET_OS_CPP_BUILTINS\n #define TARGET_OS_CPP_BUILTINS()\t\t\\"}]}