{"sha": "317a38cd468d565dc8ce45c6da0dbccf38808f70", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6MzE3YTM4Y2Q0NjhkNTY1ZGM4Y2U0NWM2ZGEwZGJjY2YzODgwOGY3MA==", "commit": {"author": {"name": "Patrick Palka", "email": "ppalka@redhat.com", "date": "2021-05-21T03:39:05Z"}, "committer": {"name": "Patrick Palka", "email": "ppalka@redhat.com", "date": "2021-05-21T03:39:05Z"}, "message": "libstdc++: Fix access issue in iota_view::_Sentinel [PR100690]\n\nlibstdc++-v3/ChangeLog:\n\n\tPR libstdc++/100690\n\t* include/std/ranges (iota_view::_Sentinel::_M_distance_from):\n\tSplit out this member function from ...\n\t(iota_view::_Sentinel::operator-): ... here, for sake of access\n\tcontrol.\n\t* testsuite/std/ranges/iota/iota_view.cc (test05): New test.", "tree": {"sha": "7c730c085b98cb2ed9004191c6e4b8ffe01106fd", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/7c730c085b98cb2ed9004191c6e4b8ffe01106fd"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/317a38cd468d565dc8ce45c6da0dbccf38808f70", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/317a38cd468d565dc8ce45c6da0dbccf38808f70", "html_url": "https://github.com/Rust-GCC/gccrs/commit/317a38cd468d565dc8ce45c6da0dbccf38808f70", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/317a38cd468d565dc8ce45c6da0dbccf38808f70/comments", "author": null, "committer": null, "parents": [{"sha": "ea34e2edd3d7ab245d1f57a1487c10587f324ec6", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/ea34e2edd3d7ab245d1f57a1487c10587f324ec6", "html_url": "https://github.com/Rust-GCC/gccrs/commit/ea34e2edd3d7ab245d1f57a1487c10587f324ec6"}], "stats": {"total": 19, "additions": 17, "deletions": 2}, "files": [{"sha": "767a65c582266fb9091aeb1eb56a20664739e113", "filename": "libstdc++-v3/include/std/ranges", "status": "modified", "additions": 6, "deletions": 2, "changes": 8, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/317a38cd468d565dc8ce45c6da0dbccf38808f70/libstdc%2B%2B-v3%2Finclude%2Fstd%2Franges", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/317a38cd468d565dc8ce45c6da0dbccf38808f70/libstdc%2B%2B-v3%2Finclude%2Fstd%2Franges", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libstdc%2B%2B-v3%2Finclude%2Fstd%2Franges?ref=317a38cd468d565dc8ce45c6da0dbccf38808f70", "patch": "@@ -499,6 +499,10 @@ namespace ranges\n \t_M_equal(const _Iterator& __x) const\n \t{ return __x._M_value == _M_bound; }\n \n+\tconstexpr auto\n+\t_M_distance_from(const _Iterator& __x) const\n+\t{ return _M_bound - __x._M_value; }\n+\n \t_Bound _M_bound = _Bound();\n \n       public:\n@@ -515,12 +519,12 @@ namespace ranges\n \tfriend constexpr iter_difference_t<_Winc>\n \toperator-(const _Iterator& __x, const _Sentinel& __y)\n \t  requires sized_sentinel_for<_Bound, _Winc>\n-\t{ return __x._M_value - __y._M_bound; }\n+\t{ return -__y._M_distance_from(__x); }\n \n \tfriend constexpr iter_difference_t<_Winc>\n \toperator-(const _Sentinel& __x, const _Iterator& __y)\n \t  requires sized_sentinel_for<_Bound, _Winc>\n-\t{ return -(__y - __x); }\n+\t{ return __x._M_distance_from(__y); }\n       };\n \n       _Winc _M_value = _Winc();"}, {"sha": "362ef1f7f7859c541ad7dff2f30083644f9a092f", "filename": "libstdc++-v3/testsuite/std/ranges/iota/iota_view.cc", "status": "modified", "additions": 11, "deletions": 0, "changes": 11, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/317a38cd468d565dc8ce45c6da0dbccf38808f70/libstdc%2B%2B-v3%2Ftestsuite%2Fstd%2Franges%2Fiota%2Fiota_view.cc", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/317a38cd468d565dc8ce45c6da0dbccf38808f70/libstdc%2B%2B-v3%2Ftestsuite%2Fstd%2Franges%2Fiota%2Fiota_view.cc", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libstdc%2B%2B-v3%2Ftestsuite%2Fstd%2Franges%2Fiota%2Fiota_view.cc?ref=317a38cd468d565dc8ce45c6da0dbccf38808f70", "patch": "@@ -80,11 +80,22 @@ test04()\n // Verify we optimize away the 'bound' data member of an unbounded iota_view.\n static_assert(sizeof(std::ranges::iota_view<char>) == 1);\n \n+void\n+test05()\n+{\n+  // PR libstdc++/100690\n+  int x[] = {42, 42, 42};\n+  auto r = std::views::iota(std::ranges::begin(x), std::ranges::cbegin(x) + 3);\n+  VERIFY( r.end() - r.begin() == 3 );\n+  VERIFY( r.begin() - r.end() == -3 );\n+}\n+\n int\n main()\n {\n   test01();\n   test02();\n   test03();\n   test04();\n+  test05();\n }"}]}