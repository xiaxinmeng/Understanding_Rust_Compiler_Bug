{"sha": "4528392f3b932b71ecbe3f25caa1c90a2601c14a", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6NDUyODM5MmYzYjkzMmI3MWVjYmUzZjI1Y2FhMWM5MGEyNjAxYzE0YQ==", "commit": {"author": {"name": "Arnaud Charlet", "email": "charlet@gcc.gnu.org", "date": "2014-10-31T14:28:08Z"}, "committer": {"name": "Arnaud Charlet", "email": "charlet@gcc.gnu.org", "date": "2014-10-31T14:28:08Z"}, "message": "[multiple changes]\n\n2014-10-31  Vincent Celier  <celier@adacore.com>\n\n\t* prj-part.adb (Parse_Single_Project): Call Set_Display_Name_Of.\n\t* prj-proc.adb (Recursive_Process): Call Display_Name_Of to\n\tget the project Display_Name.\n\t* prj-tree.adb (Display_Name_Of): New function\n\t(Set_Display_Name_Of): New procedure.\n\t(Create_Project): Call Set_Display_Name_Of.\n\t* prj-tree.ads (Display_Name_Of): New function.\n\t(Set_Display_Name_Of): New procedure.\n\t(Project_Node_Record): New component Display_Name.\n\t(Project_Name_And_Node): Remove component Display_Name.\n\t* prj-conf.adb (Parse_Project_And_Apply_Config): Use the full\n\tConfig_File_Path as the Config_File_Name, not just its simple\n\tname.\n\n2014-10-31  Thomas Quinot  <quinot@adacore.com>\n\n\t* get_scos.adb: Minor reformatting.\n\n2014-10-31  Ed Schonberg  <schonberg@adacore.com>\n\n\t* exp_ch5.adb (Expand_Formal_Container_Loop): Create block to\n\tcapture declaration for cursor to prevent spurious errors when\n\tseveral formal iterators that use the same cursoe name appear\n\tin the same context.\n\nFrom-SVN: r216978", "tree": {"sha": "53a0771cee842e6f8992fe563fb7dd279ab6203b", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/53a0771cee842e6f8992fe563fb7dd279ab6203b"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/4528392f3b932b71ecbe3f25caa1c90a2601c14a", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/4528392f3b932b71ecbe3f25caa1c90a2601c14a", "html_url": "https://github.com/Rust-GCC/gccrs/commit/4528392f3b932b71ecbe3f25caa1c90a2601c14a", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/4528392f3b932b71ecbe3f25caa1c90a2601c14a/comments", "author": null, "committer": null, "parents": [{"sha": "32dfd2e0335282119b8f03e3e05676bdbf6fca84", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/32dfd2e0335282119b8f03e3e05676bdbf6fca84", "html_url": "https://github.com/Rust-GCC/gccrs/commit/32dfd2e0335282119b8f03e3e05676bdbf6fca84"}], "stats": {"total": 180, "additions": 131, "deletions": 49}, "files": [{"sha": "d2d9914b2795ae33ba9e56ee4e16b5ce1bed6a50", "filename": "gcc/ada/ChangeLog", "status": "modified", "additions": 27, "deletions": 0, "changes": 27, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/4528392f3b932b71ecbe3f25caa1c90a2601c14a/gcc%2Fada%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/4528392f3b932b71ecbe3f25caa1c90a2601c14a/gcc%2Fada%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fada%2FChangeLog?ref=4528392f3b932b71ecbe3f25caa1c90a2601c14a", "patch": "@@ -1,3 +1,30 @@\n+2014-10-31  Vincent Celier  <celier@adacore.com>\n+\n+\t* prj-part.adb (Parse_Single_Project): Call Set_Display_Name_Of.\n+\t* prj-proc.adb (Recursive_Process): Call Display_Name_Of to\n+\tget the project Display_Name.\n+\t* prj-tree.adb (Display_Name_Of): New function\n+\t(Set_Display_Name_Of): New procedure.\n+\t(Create_Project): Call Set_Display_Name_Of.\n+\t* prj-tree.ads (Display_Name_Of): New function.\n+\t(Set_Display_Name_Of): New procedure.\n+\t(Project_Node_Record): New component Display_Name.\n+\t(Project_Name_And_Node): Remove component Display_Name.\n+\t* prj-conf.adb (Parse_Project_And_Apply_Config): Use the full\n+\tConfig_File_Path as the Config_File_Name, not just its simple\n+\tname.\n+\n+2014-10-31  Thomas Quinot  <quinot@adacore.com>\n+\n+\t* get_scos.adb: Minor reformatting.\n+\n+2014-10-31  Ed Schonberg  <schonberg@adacore.com>\n+\n+\t* exp_ch5.adb (Expand_Formal_Container_Loop): Create block to\n+\tcapture declaration for cursor to prevent spurious errors when\n+\tseveral formal iterators that use the same cursoe name appear\n+\tin the same context.\n+\n 2014-10-31  Vincent Celier  <celier@adacore.com>\n \n \t* prj-proc.adb (Recursive_Process): Make sure that the project"}, {"sha": "e66a58363e9a84979708f504579c20d7b5cc80aa", "filename": "gcc/ada/exp_ch5.adb", "status": "modified", "additions": 13, "deletions": 4, "changes": 17, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/4528392f3b932b71ecbe3f25caa1c90a2601c14a/gcc%2Fada%2Fexp_ch5.adb", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/4528392f3b932b71ecbe3f25caa1c90a2601c14a/gcc%2Fada%2Fexp_ch5.adb", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fada%2Fexp_ch5.adb?ref=4528392f3b932b71ecbe3f25caa1c90a2601c14a", "patch": "@@ -2776,13 +2776,15 @@ package body Exp_Ch5 is\n    ----------------------------------\n \n    procedure Expand_Formal_Container_Loop (N : Node_Id) is\n+      Loc       : constant Source_Ptr := Sloc (N);\n       Isc       : constant Node_Id    := Iteration_Scheme (N);\n       I_Spec    : constant Node_Id    := Iterator_Specification (Isc);\n       Cursor    : constant Entity_Id  := Defining_Identifier (I_Spec);\n       Container : constant Node_Id    := Entity (Name (I_Spec));\n       Stats     : constant List_Id    := Statements (N);\n \n       Advance  : Node_Id;\n+      Blk_Nod  : Node_Id;\n       Init     : Node_Id;\n       New_Loop : Node_Id;\n \n@@ -2801,12 +2803,19 @@ package body Exp_Ch5 is\n         (N, Container, Cursor, Init, Advance, New_Loop);\n \n       Set_Ekind (Cursor, E_Variable);\n-      Insert_Action (N, Init);\n-\n       Append_To (Stats, Advance);\n \n-      Rewrite (N, New_Loop);\n-      Analyze (New_Loop);\n+      --  Build block to capture declaration of cursor entity.\n+\n+      Blk_Nod :=\n+        Make_Block_Statement (Loc,\n+          Declarations               => New_List (Init),\n+          Handled_Statement_Sequence =>\n+            Make_Handled_Sequence_Of_Statements (Loc,\n+              Statements => New_List (New_Loop)));\n+\n+      Rewrite (N, Blk_Nod);\n+      Analyze (N);\n    end Expand_Formal_Container_Loop;\n \n    ------------------------------------------"}, {"sha": "48c9c4632171bde2950f874ebdce4dc16049d48a", "filename": "gcc/ada/get_scos.adb", "status": "modified", "additions": 2, "deletions": 2, "changes": 4, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/4528392f3b932b71ecbe3f25caa1c90a2601c14a/gcc%2Fada%2Fget_scos.adb", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/4528392f3b932b71ecbe3f25caa1c90a2601c14a/gcc%2Fada%2Fget_scos.adb", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fada%2Fget_scos.adb?ref=4528392f3b932b71ecbe3f25caa1c90a2601c14a", "patch": "@@ -302,8 +302,8 @@ begin\n                      From       => SCO_Table.Last + 1,\n                      To         => 0));\n \n-                     when others =>\n-                        raise Program_Error;\n+               when others =>\n+                  raise Program_Error;\n \n             end case;\n "}, {"sha": "a9fd006c7ed12c99f942ef1aaf08c5a9d9dbc79a", "filename": "gcc/ada/prj-conf.adb", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/4528392f3b932b71ecbe3f25caa1c90a2601c14a/gcc%2Fada%2Fprj-conf.adb", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/4528392f3b932b71ecbe3f25caa1c90a2601c14a/gcc%2Fada%2Fprj-conf.adb", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fada%2Fprj-conf.adb?ref=4528392f3b932b71ecbe3f25caa1c90a2601c14a", "patch": "@@ -1753,7 +1753,7 @@ package body Prj.Conf is\n          Update_Ignore_Missing_With (Env.Flags, False);\n \n          if Config_File_Path /= null then\n-            Conf_File_Name := new String'(Simple_Name (Config_File_Path.all));\n+            Conf_File_Name := new String'(Config_File_Path.all);\n          end if;\n \n          --  For the second time the project files are parsed, the warning for"}, {"sha": "234ccdc172f5540c5bdfcdb0bce12598a7ba8f61", "filename": "gcc/ada/prj-part.adb", "status": "modified", "additions": 3, "deletions": 5, "changes": 8, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/4528392f3b932b71ecbe3f25caa1c90a2601c14a/gcc%2Fada%2Fprj-part.adb", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/4528392f3b932b71ecbe3f25caa1c90a2601c14a/gcc%2Fada%2Fprj-part.adb", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fada%2Fprj-part.adb?ref=4528392f3b932b71ecbe3f25caa1c90a2601c14a", "patch": "@@ -1298,7 +1298,6 @@ package body Prj.Part is\n       Name_From_Path  : constant Name_Id :=\n         Project_Name_From (Path_Name, Is_Config_File => Is_Config_File);\n       Name_Of_Project : Name_Id := No_Name;\n-      Display_Name_Of_Project : Name_Id := No_Name;\n \n       Duplicated : Boolean := False;\n \n@@ -1634,19 +1633,19 @@ package body Prj.Part is\n             end if;\n          end;\n \n-         --  Read the original casing of the project name\n+         --  Read the original casing of the project name and put it in the\n+         --  project node.\n \n          declare\n             Loc : Source_Ptr;\n-\n          begin\n             Loc := Location_Of (Project, In_Tree);\n             for J in 1 .. Name_Len loop\n                Name_Buffer (J) := Sinput.Source (Loc);\n                Loc := Loc + 1;\n             end loop;\n \n-            Display_Name_Of_Project := Name_Find;\n+            Set_Display_Name_Of (Project, In_Tree, Name_Find);\n          end;\n \n          declare\n@@ -2018,7 +2017,6 @@ package body Prj.Part is\n            (T => In_Tree.Projects_HT,\n             K => Name_Of_Project,\n             E => (Name           => Name_Of_Project,\n-                  Display_Name   => Display_Name_Of_Project,\n                   Node           => Project,\n                   Resolved_Path  => Resolved_Path_Name,\n                   Extended       => Extended,"}, {"sha": "71ac4213b0ff19ecdf9288a703072180adff0614", "filename": "gcc/ada/prj-proc.adb", "status": "modified", "additions": 8, "deletions": 11, "changes": 19, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/4528392f3b932b71ecbe3f25caa1c90a2601c14a/gcc%2Fada%2Fprj-proc.adb", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/4528392f3b932b71ecbe3f25caa1c90a2601c14a/gcc%2Fada%2Fprj-proc.adb", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fada%2Fprj-proc.adb?ref=4528392f3b932b71ecbe3f25caa1c90a2601c14a", "patch": "@@ -2765,6 +2765,10 @@ package body Prj.Proc is\n             Success := not Prj.Tree.No (Loaded_Project);\n \n             if Success then\n+               if Node_Tree.Incomplete_With then\n+                  From_Project_Node_Tree.Incomplete_With := True;\n+               end if;\n+\n                List.Tree := new Project_Tree_Data (Is_Root_Tree => False);\n                Prj.Initialize (List.Tree);\n                List.Tree.Shared := In_Tree.Shared;\n@@ -2928,9 +2932,9 @@ package body Prj.Proc is\n             Name : constant Name_Id :=\n                      Name_Of (From_Project_Node, From_Project_Node_Tree);\n \n-            Name_Node : constant Tree_Private_Part.Project_Name_And_Node :=\n-                          Tree_Private_Part.Projects_Htable.Get\n-                            (From_Project_Node_Tree.Projects_HT, Name);\n+            Display_Name : constant Name_Id :=\n+                             Display_Name_Of\n+                               (From_Project_Node, From_Project_Node_Tree);\n \n          begin\n             Project := Processed_Projects.Get (Name);\n@@ -2994,14 +2998,7 @@ package body Prj.Proc is\n             Processed_Projects.Set (Name, Project);\n \n             Project.Name := Name;\n-\n-            --  Make sure that the project display name is never No_Name\n-\n-            if Name_Node.Display_Name = No_Name then\n-               Project.Display_Name := Name;\n-            else\n-               Project.Display_Name := Name_Node.Display_Name;\n-            end if;\n+            Project.Display_Name := Display_Name;\n \n             Get_Name_String (Name);\n "}, {"sha": "52ba0437e9e9a8ef01eb4026dde78d5c494f6a5f", "filename": "gcc/ada/prj-tree.adb", "status": "modified", "additions": 60, "deletions": 21, "changes": 81, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/4528392f3b932b71ecbe3f25caa1c90a2601c14a/gcc%2Fada%2Fprj-tree.adb", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/4528392f3b932b71ecbe3f25caa1c90a2601c14a/gcc%2Fada%2Fprj-tree.adb", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fada%2Fprj-tree.adb?ref=4528392f3b932b71ecbe3f25caa1c90a2601c14a", "patch": "@@ -110,26 +110,27 @@ package body Prj.Tree is\n          Project_Node_Table.Increment_Last (In_Tree.Project_Nodes);\n          In_Tree.Project_Nodes.Table\n            (Project_Node_Table.Last (In_Tree.Project_Nodes)) :=\n-           (Kind      => N_Comment_Zones,\n-            Qualifier => Unspecified,\n-            Expr_Kind => Undefined,\n-            Location  => No_Location,\n-            Directory => No_Path,\n-            Variables => Empty_Node,\n-            Packages  => Empty_Node,\n-            Pkg_Id    => Empty_Package,\n-            Name      => No_Name,\n-            Src_Index => 0,\n-            Path_Name => No_Path,\n-            Value     => No_Name,\n-            Default   => Empty_Value,\n-            Field1    => Empty_Node,\n-            Field2    => Empty_Node,\n-            Field3    => Empty_Node,\n-            Field4    => Empty_Node,\n-            Flag1     => False,\n-            Flag2     => False,\n-            Comments  => Empty_Node);\n+           (Kind         => N_Comment_Zones,\n+            Qualifier    => Unspecified,\n+            Expr_Kind    => Undefined,\n+            Location     => No_Location,\n+            Directory    => No_Path,\n+            Variables    => Empty_Node,\n+            Packages     => Empty_Node,\n+            Pkg_Id       => Empty_Package,\n+            Name         => No_Name,\n+            Display_Name => No_Name,\n+            Src_Index    => 0,\n+            Path_Name    => No_Path,\n+            Value        => No_Name,\n+            Default      => Empty_Value,\n+            Field1       => Empty_Node,\n+            Field2       => Empty_Node,\n+            Field3       => Empty_Node,\n+            Field4       => Empty_Node,\n+            Flag1        => False,\n+            Flag2        => False,\n+            Comments     => Empty_Node);\n \n          Zone := Project_Node_Table.Last (In_Tree.Project_Nodes);\n          In_Tree.Project_Nodes.Table (To).Comments := Zone;\n@@ -170,6 +171,7 @@ package body Prj.Tree is\n                Packages         => Empty_Node,\n                Pkg_Id           => Empty_Package,\n                Name             => No_Name,\n+               Display_Name     => No_Name,\n                Src_Index        => 0,\n                Path_Name        => No_Path,\n                Value            => Comments.Table (J).Value,\n@@ -339,6 +341,7 @@ package body Prj.Tree is\n          Packages         => Empty_Node,\n          Pkg_Id           => Empty_Package,\n          Name             => No_Name,\n+         Display_Name     => No_Name,\n          Src_Index        => 0,\n          Path_Name        => No_Path,\n          Value            => No_Name,\n@@ -432,6 +435,7 @@ package body Prj.Tree is\n          Packages         => Empty_Node,\n          Pkg_Id           => Empty_Package,\n          Name             => No_Name,\n+         Display_Name     => No_Name,\n          Src_Index        => 0,\n          Path_Name        => No_Path,\n          Value            => No_Name,\n@@ -469,6 +473,7 @@ package body Prj.Tree is\n                Packages         => Empty_Node,\n                Pkg_Id           => Empty_Package,\n                Name             => No_Name,\n+               Display_Name     => No_Name,\n                Src_Index        => 0,\n                Path_Name        => No_Path,\n                Value            => No_Name,\n@@ -504,6 +509,7 @@ package body Prj.Tree is\n                   Packages         => Empty_Node,\n                   Pkg_Id           => Empty_Package,\n                   Name             => No_Name,\n+                  Display_Name     => No_Name,\n                   Src_Index        => 0,\n                   Path_Name        => No_Path,\n                   Value            => Comments.Table (J).Value,\n@@ -1225,6 +1231,22 @@ package body Prj.Tree is\n       return In_Tree.Project_Nodes.Table (Node).Name;\n    end Name_Of;\n \n+   ---------------------\n+   -- Display_Name_Of --\n+   ---------------------\n+\n+   function Display_Name_Of\n+     (Node    : Project_Node_Id;\n+      In_Tree : Project_Node_Tree_Ref) return Name_Id\n+   is\n+   begin\n+      pragma Assert\n+        (Present (Node)\n+         and then\n+         In_Tree.Project_Nodes.Table (Node).Kind = N_Project);\n+      return In_Tree.Project_Nodes.Table (Node).Display_Name;\n+   end Display_Name_Of;\n+\n    --------------------\n    -- Next_Case_Item --\n    --------------------\n@@ -2424,6 +2446,23 @@ package body Prj.Tree is\n       In_Tree.Project_Nodes.Table (Node).Name := To;\n    end Set_Name_Of;\n \n+   -------------------------\n+   -- Set_Display_Name_Of --\n+   -------------------------\n+\n+   procedure Set_Display_Name_Of\n+     (Node    : Project_Node_Id;\n+      In_Tree : Project_Node_Tree_Ref;\n+      To      : Name_Id)\n+   is\n+   begin\n+      pragma Assert\n+        (Present (Node)\n+         and then\n+         In_Tree.Project_Nodes.Table (Node).Kind = N_Project);\n+      In_Tree.Project_Nodes.Table (Node).Display_Name := To;\n+   end Set_Display_Name_Of;\n+\n    -------------------------------\n    -- Set_Next_Declarative_Item --\n    -------------------------------\n@@ -2949,6 +2988,7 @@ package body Prj.Tree is\n    begin\n       Project := Default_Project_Node (In_Tree, N_Project);\n       Set_Name_Of (Project, In_Tree, Name);\n+      Set_Display_Name_Of (Project, In_Tree, Name);\n       Set_Directory_Of\n         (Project, In_Tree,\n          Path_Name_Type (Get_Directory (File_Name_Type (Full_Path))));\n@@ -2968,7 +3008,6 @@ package body Prj.Tree is\n             Name,\n             Prj.Tree.Tree_Private_Part.Project_Name_And_Node'\n               (Name           => Name,\n-               Display_Name   => Name,\n                Resolved_Path  => No_Path,\n                Node           => Project,\n                Extended       => False,"}, {"sha": "e012d3736dc81bf27e16a8d0098da829f29ee4a2", "filename": "gcc/ada/prj-tree.ads", "status": "modified", "additions": 17, "deletions": 5, "changes": 22, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/4528392f3b932b71ecbe3f25caa1c90a2601c14a/gcc%2Fada%2Fprj-tree.ads", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/4528392f3b932b71ecbe3f25caa1c90a2601c14a/gcc%2Fada%2Fprj-tree.ads", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fada%2Fprj-tree.ads?ref=4528392f3b932b71ecbe3f25caa1c90a2601c14a", "patch": "@@ -269,6 +269,12 @@ package Prj.Tree is\n    --  Valid for all non empty nodes. May return No_Name for nodes that have\n    --  no names.\n \n+   function Display_Name_Of\n+     (Node    : Project_Node_Id;\n+      In_Tree : Project_Node_Tree_Ref) return Name_Id;\n+   pragma Inline (Display_Name_Of);\n+   --  Valid only for N_Project node. Returns the display name of the project.\n+\n    function Kind_Of\n      (Node    : Project_Node_Id;\n       In_Tree : Project_Node_Tree_Ref) return Project_Node_Kind;\n@@ -738,7 +744,14 @@ package Prj.Tree is\n       In_Tree : Project_Node_Tree_Ref;\n       To      : Name_Id);\n    pragma Inline (Set_Name_Of);\n-   --  Valid for all non empty nodes.\n+   --  Valid for all non empty nodes\n+\n+   procedure Set_Display_Name_Of\n+     (Node    : Project_Node_Id;\n+      In_Tree : Project_Node_Tree_Ref;\n+      To      : Name_Id);\n+   pragma Inline (Set_Display_Name_Of);\n+   --  Valid only for N_Project nodes\n \n    procedure Set_Kind_Of\n      (Node    : Project_Node_Id;\n@@ -1159,6 +1172,9 @@ package Prj.Tree is\n          Directory : Path_Name_Type := No_Path;\n          --  Only for N_Project\n \n+         Display_Name : Name_Id := No_Name;\n+         --  Only for N_Project\n+\n          Expr_Kind : Variable_Kind := Undefined;\n          --  See below for what Project_Node_Kind it is used\n \n@@ -1479,9 +1495,6 @@ package Prj.Tree is\n          Name : Name_Id;\n          --  Name of the project\n \n-         Display_Name : Name_Id;\n-         --  The name of the project as it appears in the .gpr file\n-\n          Node : Project_Node_Id;\n          --  Node of the project in table Project_Nodes\n \n@@ -1502,7 +1515,6 @@ package Prj.Tree is\n \n       No_Project_Name_And_Node : constant Project_Name_And_Node :=\n         (Name           => No_Name,\n-         Display_Name   => No_Name,\n          Node           => Empty_Node,\n          Resolved_Path  => No_Path,\n          Extended       => True,"}]}