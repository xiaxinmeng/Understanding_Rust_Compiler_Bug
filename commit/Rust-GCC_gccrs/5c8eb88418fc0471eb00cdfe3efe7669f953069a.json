{"sha": "5c8eb88418fc0471eb00cdfe3efe7669f953069a", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6NWM4ZWI4ODQxOGZjMDQ3MWViMDBjZGZlM2VmZTc2NjlmOTUzMDY5YQ==", "commit": {"author": {"name": "Hans-Peter Nilsson", "email": "hp@axis.com", "date": "2021-02-25T05:03:47Z"}, "committer": {"name": "Hans-Peter Nilsson", "email": "hp@axis.com", "date": "2021-03-04T00:10:12Z"}, "message": "gcc.misc-tests/outputs.exp: assert unique test-names\n\nThe gcc.misc-tests/outputs.exp tests can take some effort to\ndigest.\n\nNavigating and debugging causes for failing tests here isn't\nhelped by the existence of tests with duplicate names.\nLet's stop that from happening.  This requires that test-run\noutput is actually reviewed, as Tcl errors don't stop the\ntest-run, but then again there's no such dejagnu construct\nthat I know of.\n\nTested x86_64-pc-linux-gnu.\n\ngcc/testsuite:\n\t* gcc.misc-tests/outputs.exp: Append discriminating\n\tsuffixes to tests with duplicate names.\n\t(outest): Assert that each running test has a unique\n\tname.", "tree": {"sha": "d6d74f31d44b3be2be6387a170294ccd8f76a424", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/d6d74f31d44b3be2be6387a170294ccd8f76a424"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/5c8eb88418fc0471eb00cdfe3efe7669f953069a", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/5c8eb88418fc0471eb00cdfe3efe7669f953069a", "html_url": "https://github.com/Rust-GCC/gccrs/commit/5c8eb88418fc0471eb00cdfe3efe7669f953069a", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/5c8eb88418fc0471eb00cdfe3efe7669f953069a/comments", "author": {"login": "hpataxisdotcom", "id": 80339731, "node_id": "MDQ6VXNlcjgwMzM5NzMx", "avatar_url": "https://avatars.githubusercontent.com/u/80339731?v=4", "gravatar_id": "", "url": "https://api.github.com/users/hpataxisdotcom", "html_url": "https://github.com/hpataxisdotcom", "followers_url": "https://api.github.com/users/hpataxisdotcom/followers", "following_url": "https://api.github.com/users/hpataxisdotcom/following{/other_user}", "gists_url": "https://api.github.com/users/hpataxisdotcom/gists{/gist_id}", "starred_url": "https://api.github.com/users/hpataxisdotcom/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/hpataxisdotcom/subscriptions", "organizations_url": "https://api.github.com/users/hpataxisdotcom/orgs", "repos_url": "https://api.github.com/users/hpataxisdotcom/repos", "events_url": "https://api.github.com/users/hpataxisdotcom/events{/privacy}", "received_events_url": "https://api.github.com/users/hpataxisdotcom/received_events", "type": "User", "site_admin": false}, "committer": {"login": "hpataxisdotcom", "id": 80339731, "node_id": "MDQ6VXNlcjgwMzM5NzMx", "avatar_url": "https://avatars.githubusercontent.com/u/80339731?v=4", "gravatar_id": "", "url": "https://api.github.com/users/hpataxisdotcom", "html_url": "https://github.com/hpataxisdotcom", "followers_url": "https://api.github.com/users/hpataxisdotcom/followers", "following_url": "https://api.github.com/users/hpataxisdotcom/following{/other_user}", "gists_url": "https://api.github.com/users/hpataxisdotcom/gists{/gist_id}", "starred_url": "https://api.github.com/users/hpataxisdotcom/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/hpataxisdotcom/subscriptions", "organizations_url": "https://api.github.com/users/hpataxisdotcom/orgs", "repos_url": "https://api.github.com/users/hpataxisdotcom/repos", "events_url": "https://api.github.com/users/hpataxisdotcom/events{/privacy}", "received_events_url": "https://api.github.com/users/hpataxisdotcom/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "8d57bdadd2d9c2e5c95515ca7a583d7b407b55c4", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/8d57bdadd2d9c2e5c95515ca7a583d7b407b55c4", "html_url": "https://github.com/Rust-GCC/gccrs/commit/8d57bdadd2d9c2e5c95515ca7a583d7b407b55c4"}], "stats": {"total": 36, "additions": 22, "deletions": 14}, "files": [{"sha": "0e5c1a55ce87eff6504a2eacccd7205b8aaa7b70", "filename": "gcc/testsuite/gcc.misc-tests/outputs.exp", "status": "modified", "additions": 22, "deletions": 14, "changes": 36, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/5c8eb88418fc0471eb00cdfe3efe7669f953069a/gcc%2Ftestsuite%2Fgcc.misc-tests%2Foutputs.exp", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/5c8eb88418fc0471eb00cdfe3efe7669f953069a/gcc%2Ftestsuite%2Fgcc.misc-tests%2Foutputs.exp", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgcc.misc-tests%2Foutputs.exp?ref=5c8eb88418fc0471eb00cdfe3efe7669f953069a", "patch": "@@ -116,8 +116,16 @@ if [info exists env(MAKEFLAGS)] {\n # it weren't for\n # https://core.tcl-lang.org/tcl/tktview?name=5bbd044812), but .{i,s,o}\n # and .[iso] will pass even if only the .o is present.\n+array unset outests *\n proc outest { test sources opts dirs outputs } {\n     global b srcdir subdir\n+    global outests\n+\n+    if { [info exists outests($test)] } {\n+\terror \"multiple outputs.exp tests are named \\\"$test\\\", but for sanity, test-names must be unique\"\n+    }\n+    set outests($test) 1\n+\n     set src {}\n     foreach s $sources {\n \tlappend src $srcdir/$subdir/$b$s\n@@ -307,10 +315,10 @@ outest \"$b exe savetmp named2\" $mult \"-o $b.exe -save-temps\" {} {{--1.i --1.s --\n \n # Additional files are created when an @file is used\n if !$skip_atsave {\n-outest \"$b exe savetmp namedb\" $sing \"@/dev/null -o $b.exe -save-temps\" {} {{--0.i --0.s --0.o .args.0 !!$gld .ld1_args !0 .exe}}\n-outest \"$b exe savetmp named2\" $mult \"@/dev/null -o $b.exe -save-temps\" {} {{--1.i --1.s --1.o --2.i --2.s --2.o .args.0 !!$gld .ld1_args !0 .exe}}\n-outest \"$b exe savetmp named2\" $mult \"@/dev/null -I dummy -o $b.exe -save-temps\" {} {{--1.i --1.s --1.o --2.i --2.s --2.o -args.0 -args.1 .args.2 !!$gld .ld1_args !0 .exe}}\n-outest \"$b exe savetmp named2\" $mult \"@/dev/null -I dummy -L dummy -o $b.exe -save-temps\" {} {{--1.i --1.s --1.o --2.i --2.s --2.o -args.0 -args.1 .args.2 .args.3 !!$gld .ld1_args !0 .exe}}\n+outest \"$b exe savetmp namedb-2\" $sing \"@/dev/null -o $b.exe -save-temps\" {} {{--0.i --0.s --0.o .args.0 !!$gld .ld1_args !0 .exe}}\n+outest \"$b exe savetmp named2-2\" $mult \"@/dev/null -o $b.exe -save-temps\" {} {{--1.i --1.s --1.o --2.i --2.s --2.o .args.0 !!$gld .ld1_args !0 .exe}}\n+outest \"$b exe savetmp named2-3\" $mult \"@/dev/null -I dummy -o $b.exe -save-temps\" {} {{--1.i --1.s --1.o --2.i --2.s --2.o -args.0 -args.1 .args.2 !!$gld .ld1_args !0 .exe}}\n+outest \"$b exe savetmp named2-4\" $mult \"@/dev/null -I dummy -L dummy -o $b.exe -save-temps\" {} {{--1.i --1.s --1.o --2.i --2.s --2.o -args.0 -args.1 .args.2 .args.3 !!$gld .ld1_args !0 .exe}}\n }\n \n # Setting the main output to a dir selects it as the default aux&dump\n@@ -400,9 +408,9 @@ outest \"$b exe soddovr namedir2\" $mult \"-o o/$b.exe -save-temps=obj -dumpdir ./\"\n outest \"$b exe scddovr namedir0\" $sing \"-o o/$b-0.exe -save-temps=cwd -dumpdir o/\" {o/} {{-0.i -0.s -0.o -0.exe} {}}\n outest \"$b exe scddovr namedirb\" $sing \"-o o/$b.exe -save-temps=cwd -dumpdir o/\" {o/} {{-0.i -0.s -0.o .exe} {}}\n outest \"$b exe scddovr namedir2\" $mult \"-o o/$b.exe -save-temps=cwd -dumpdir o/\" {o/} {{-1.i -1.s -1.o -2.i -2.s -2.o .exe} {}}\n-outest \"$b exe ddstovr namedir0\" $sing \"-o $b-0.exe -save-temps -dumpdir o/\" {o/} {{-0.i -0.s -0.o} {-0.exe}}\n-outest \"$b exe ddstovr namedirb\" $sing \"-o $b.exe -save-temps -dumpdir o/\" {o/} {{-0.i -0.s -0.o} {.exe}}\n-outest \"$b exe ddstovr namedir2\" $mult \"-o $b.exe -save-temps -dumpdir o/\" {o/} {{-1.i -1.s -1.o -2.i -2.s -2.o} {.exe}}\n+outest \"$b exe ddstovr namedir0-2\" $sing \"-o $b-0.exe -save-temps -dumpdir o/\" {o/} {{-0.i -0.s -0.o} {-0.exe}}\n+outest \"$b exe ddstovr namedirb-2\" $sing \"-o $b.exe -save-temps -dumpdir o/\" {o/} {{-0.i -0.s -0.o} {.exe}}\n+outest \"$b exe ddstovr namedir2-2\" $mult \"-o $b.exe -save-temps -dumpdir o/\" {o/} {{-1.i -1.s -1.o -2.i -2.s -2.o} {.exe}}\n \n \n # Compiler- and driver-generated aux and dump outputs.\n@@ -661,14 +669,14 @@ outest \"$b lto mult nameddir\" $mult \"-o dir/$b.exe -O2 -flto -flto-partition=one\n \n if $ltop {\n # -flto -fno-use-linker-plugin\n-outest \"$b lto sing unnamed\" $sing \"-O2 -flto -fno-use-linker-plugin -flto-partition=one -fdump-ipa-icf-optimized -fdump-rtl-final -fstack-usage $oaout\" {} {{a--0.c.???i.icf a--0.c.???r.final a.wpa.???i.icf a.ltrans0.ltrans.???r.final a.ltrans0.ltrans.su $aout}}\n-outest \"$b lto mult unnamed\" $mult \"-O2 -flto -fno-use-linker-plugin -flto-partition=one -fdump-ipa-icf-optimized -fdump-rtl-final -fstack-usage $oaout\" {} {{a--1.c.???i.icf a--1.c.???r.final a--2.c.???i.icf a--2.c.???r.final a.wpa.???i.icf a.ltrans0.ltrans.???r.final a.ltrans0.ltrans.su $aout}}\n-outest \"$b lto sing named\" $sing \"-o $b.exe -O2 -flto -fno-use-linker-plugin -flto-partition=one -fdump-ipa-icf-optimized -fdump-rtl-final -fstack-usage\" {} {{--0.c.???i.icf --0.c.???r.final .wpa.???i.icf .ltrans0.ltrans.???r.final .ltrans0.ltrans.su .exe}}\n-outest \"$b lto mult named\" $mult \"-o $b.exe -O2 -flto -fno-use-linker-plugin -flto-partition=one -fdump-ipa-icf-optimized -fdump-rtl-final -fstack-usage\" {} {{--1.c.???i.icf --1.c.???r.final --2.c.???i.icf --2.c.???r.final .wpa.???i.icf .ltrans0.ltrans.???r.final .ltrans0.ltrans.su .exe}}\n-outest \"$b lto sing nameddir\" $sing \"-o dir/$b.exe -O2 -flto -fno-use-linker-plugin -flto-partition=one -fdump-ipa-icf-optimized -fdump-rtl-final -fstack-usage\" {dir/} {{--0.c.???i.icf --0.c.???r.final .wpa.???i.icf .ltrans0.ltrans.???r.final .ltrans0.ltrans.su .exe} {}}\n-outest \"$b lto mult nameddir\" $mult \"-o dir/$b.exe -O2 -flto -fno-use-linker-plugin -flto-partition=one -fdump-ipa-icf-optimized -fdump-rtl-final -fstack-usage\" {dir/} {{--1.c.???i.icf --1.c.???r.final --2.c.???i.icf --2.c.???r.final .wpa.???i.icf .ltrans0.ltrans.???r.final .ltrans0.ltrans.su .exe} {}}\n+outest \"$b lto sing unnamed-2\" $sing \"-O2 -flto -fno-use-linker-plugin -flto-partition=one -fdump-ipa-icf-optimized -fdump-rtl-final -fstack-usage $oaout\" {} {{a--0.c.???i.icf a--0.c.???r.final a.wpa.???i.icf a.ltrans0.ltrans.???r.final a.ltrans0.ltrans.su $aout}}\n+outest \"$b lto mult unnamed-2\" $mult \"-O2 -flto -fno-use-linker-plugin -flto-partition=one -fdump-ipa-icf-optimized -fdump-rtl-final -fstack-usage $oaout\" {} {{a--1.c.???i.icf a--1.c.???r.final a--2.c.???i.icf a--2.c.???r.final a.wpa.???i.icf a.ltrans0.ltrans.???r.final a.ltrans0.ltrans.su $aout}}\n+outest \"$b lto sing named-2\" $sing \"-o $b.exe -O2 -flto -fno-use-linker-plugin -flto-partition=one -fdump-ipa-icf-optimized -fdump-rtl-final -fstack-usage\" {} {{--0.c.???i.icf --0.c.???r.final .wpa.???i.icf .ltrans0.ltrans.???r.final .ltrans0.ltrans.su .exe}}\n+outest \"$b lto mult named-2\" $mult \"-o $b.exe -O2 -flto -fno-use-linker-plugin -flto-partition=one -fdump-ipa-icf-optimized -fdump-rtl-final -fstack-usage\" {} {{--1.c.???i.icf --1.c.???r.final --2.c.???i.icf --2.c.???r.final .wpa.???i.icf .ltrans0.ltrans.???r.final .ltrans0.ltrans.su .exe}}\n+outest \"$b lto sing nameddir-2\" $sing \"-o dir/$b.exe -O2 -flto -fno-use-linker-plugin -flto-partition=one -fdump-ipa-icf-optimized -fdump-rtl-final -fstack-usage\" {dir/} {{--0.c.???i.icf --0.c.???r.final .wpa.???i.icf .ltrans0.ltrans.???r.final .ltrans0.ltrans.su .exe} {}}\n+outest \"$b lto mult nameddir-2\" $mult \"-o dir/$b.exe -O2 -flto -fno-use-linker-plugin -flto-partition=one -fdump-ipa-icf-optimized -fdump-rtl-final -fstack-usage\" {dir/} {{--1.c.???i.icf --1.c.???r.final --2.c.???i.icf --2.c.???r.final .wpa.???i.icf .ltrans0.ltrans.???r.final .ltrans0.ltrans.su .exe} {}}\n if !$skip_atsave {\n-outest \"$b lto sing unnamed\" $sing \"@/dev/null -O2 -flto -fno-use-linker-plugin -flto-partition=one -fdump-ipa-icf-optimized -fdump-rtl-final -fstack-usage -save-temps $oaout\" {} {{a--0.c.???i.icf a--0.c.???r.final a.wpa.???i.icf a.ltrans0.ltrans.???r.final a.ltrans0.ltrans.su a--0.o a--0.s a--0.i a.ltrans0.o a.ltrans.out a.ltrans0.ltrans.o a.ltrans0.ltrans_args a.args.0 a.ltrans0.ltrans.s a.wpa.args.0 a.lto_args a.ld1_args a.ltrans_args a.ltrans0.ltrans.args.0 a.ld_args $aout}}\n+outest \"$b lto sing unnamed-3\" $sing \"@/dev/null -O2 -flto -fno-use-linker-plugin -flto-partition=one -fdump-ipa-icf-optimized -fdump-rtl-final -fstack-usage -save-temps $oaout\" {} {{a--0.c.???i.icf a--0.c.???r.final a.wpa.???i.icf a.ltrans0.ltrans.???r.final a.ltrans0.ltrans.su a--0.o a--0.s a--0.i a.ltrans0.o a.ltrans.out a.ltrans0.ltrans.o a.ltrans0.ltrans_args a.args.0 a.ltrans0.ltrans.s a.wpa.args.0 a.lto_args a.ld1_args a.ltrans_args a.ltrans0.ltrans.args.0 a.ld_args $aout}}\n }\n }\n "}]}