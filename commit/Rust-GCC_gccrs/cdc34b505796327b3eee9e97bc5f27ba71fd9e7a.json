{"sha": "cdc34b505796327b3eee9e97bc5f27ba71fd9e7a", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6Y2RjMzRiNTA1Nzk2MzI3YjNlZWU5ZTk3YmM1ZjI3YmE3MWZkOWU3YQ==", "commit": {"author": {"name": "Thomas Koenig", "email": "tkoenig@gcc.gnu.org", "date": "2020-05-14T16:30:27Z"}, "committer": {"name": "Thomas Koenig", "email": "tkoenig@gcc.gnu.org", "date": "2020-05-14T16:33:24Z"}, "message": "Add early return for invalid STATUS for close.\n\n2020-05-14  Thomas Koenig  <tkoenig@gcc.gnu.org>\n\n\tPR libfortran/95119\n\t* io/close.c (close_status): Add CLOSE_INVALID.\n\t(st_close): Return early on invalid STATUS parameter.\n\n2020-05-14  Thomas Koenig  <tkoenig@gcc.gnu.org>\n\n\tPR libfortran/95119\n\t* testsuite/libgomp.fortran/close_errors_1.f90: New test.", "tree": {"sha": "479abea4f28b9b3d1593a4b360e307dde3210f8f", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/479abea4f28b9b3d1593a4b360e307dde3210f8f"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/cdc34b505796327b3eee9e97bc5f27ba71fd9e7a", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/cdc34b505796327b3eee9e97bc5f27ba71fd9e7a", "html_url": "https://github.com/Rust-GCC/gccrs/commit/cdc34b505796327b3eee9e97bc5f27ba71fd9e7a", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/cdc34b505796327b3eee9e97bc5f27ba71fd9e7a/comments", "author": null, "committer": null, "parents": [{"sha": "8d286dd118a5bd16f7ae0fb9dfcdcfd020bea803", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/8d286dd118a5bd16f7ae0fb9dfcdcfd020bea803", "html_url": "https://github.com/Rust-GCC/gccrs/commit/8d286dd118a5bd16f7ae0fb9dfcdcfd020bea803"}], "stats": {"total": 50, "additions": 49, "deletions": 1}, "files": [{"sha": "476a41921f396f185bf430208b9be579db1f9fc2", "filename": "libgfortran/ChangeLog", "status": "modified", "additions": 10, "deletions": 0, "changes": 10, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/cdc34b505796327b3eee9e97bc5f27ba71fd9e7a/libgfortran%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/cdc34b505796327b3eee9e97bc5f27ba71fd9e7a/libgfortran%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libgfortran%2FChangeLog?ref=cdc34b505796327b3eee9e97bc5f27ba71fd9e7a", "patch": "@@ -1,3 +1,13 @@\n+2020-05-14  Thomas Koenig  <tkoenig@gcc.gnu.org>\n+\n+\tPR libfortran/95119\n+\t* io/close.c (close_status): Add CLOSE_INVALID.\n+\t(st_close): Return early on invalid STATUS parameter.\n+\n+2020-05-14  H.J. Lu  <hongjiu.lu@intel.com>\n+\n+\t* configure: Regenerated.\n+\n 2020-05-14  H.J. Lu  <hongjiu.lu@intel.com>\n \n \t* configure: Regenerated."}, {"sha": "17e064ba4e8d1ac05bac1963f03abf788c5dca6c", "filename": "libgfortran/io/close.c", "status": "modified", "additions": 7, "deletions": 1, "changes": 8, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/cdc34b505796327b3eee9e97bc5f27ba71fd9e7a/libgfortran%2Fio%2Fclose.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/cdc34b505796327b3eee9e97bc5f27ba71fd9e7a/libgfortran%2Fio%2Fclose.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libgfortran%2Fio%2Fclose.c?ref=cdc34b505796327b3eee9e97bc5f27ba71fd9e7a", "patch": "@@ -31,7 +31,7 @@ see the files COPYING3 and COPYING.RUNTIME respectively.  If not, see\n #endif\n \n typedef enum\n-{ CLOSE_DELETE, CLOSE_KEEP, CLOSE_UNSPECIFIED }\n+{ CLOSE_INVALID = - 1, CLOSE_DELETE, CLOSE_KEEP, CLOSE_UNSPECIFIED }\n close_status;\n \n static const st_option status_opt[] = {\n@@ -61,6 +61,12 @@ st_close (st_parameter_close *clp)\n     find_option (&clp->common, clp->status, clp->status_len,\n \t\t status_opt, \"Bad STATUS parameter in CLOSE statement\");\n \n+  if (status == CLOSE_INVALID)\n+    {\n+      library_end ();\n+      return;\n+    }\n+\n   u = find_unit (clp->common.unit);\n \n   if (ASYNC_IO && u && u->au)"}, {"sha": "3339ffb3b2221df0f7106129eeca079ae4871154", "filename": "libgomp/ChangeLog", "status": "modified", "additions": 13, "deletions": 0, "changes": 13, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/cdc34b505796327b3eee9e97bc5f27ba71fd9e7a/libgomp%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/cdc34b505796327b3eee9e97bc5f27ba71fd9e7a/libgomp%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libgomp%2FChangeLog?ref=cdc34b505796327b3eee9e97bc5f27ba71fd9e7a", "patch": "@@ -1,3 +1,16 @@\n+2020-05-14  Thomas Koenig  <tkoenig@gcc.gnu.org>\n+\n+\tPR libfortran/95119\n+\t* testsuite/libgomp.fortran/close_errors_1.f90: New test.\n+\n+2020-05-14  H.J. Lu  <hongjiu.lu@intel.com>\n+\n+\t* configure: Regenerated.\n+\n+2020-05-14  Jakub Jelinek  <jakub@redhat.com>\n+\n+\t* testsuite/libgomp.c-c++-common/target-40.c: New test.\n+\n 2020-05-14  H.J. Lu  <hongjiu.lu@intel.com>\n \n \t* configure: Regenerated."}, {"sha": "6edb7da4116f7e47db6ea45af872d2846c95b17a", "filename": "libgomp/testsuite/libgomp.fortran/close_errors_1.f90", "status": "added", "additions": 19, "deletions": 0, "changes": 19, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/cdc34b505796327b3eee9e97bc5f27ba71fd9e7a/libgomp%2Ftestsuite%2Flibgomp.fortran%2Fclose_errors_1.f90", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/cdc34b505796327b3eee9e97bc5f27ba71fd9e7a/libgomp%2Ftestsuite%2Flibgomp.fortran%2Fclose_errors_1.f90", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libgomp%2Ftestsuite%2Flibgomp.fortran%2Fclose_errors_1.f90?ref=cdc34b505796327b3eee9e97bc5f27ba71fd9e7a", "patch": "@@ -0,0 +1,19 @@\n+! { dg-do run }\n+! PR 95115 - this used to hang with -pthread.  Original test case by\n+! Bill Long.\n+\n+program test\n+  character(len=16) my_status\n+  character(len=1000) :: iomsg\n+  open (unit=10, file='test.dat')\n+  print *,42\n+  write (10, *) 'weird'\n+  rewind (10)\n+  read (10, *) my_status\n+  close (10)\n+  open (unit=10, file='test.dat')\n+  close (unit=10, status=my_status, iostat=ios, iomsg=iomsg)\n+  if (ios == 0) stop 1\n+  if (iomsg /= \"Bad STATUS parameter in CLOSE statement\") stop 2\n+  close (10, status='delete')\n+end program test"}]}