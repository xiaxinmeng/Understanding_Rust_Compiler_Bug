{"sha": "171a55e7f52c1e51a85ce0e4dad550c310d1030e", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6MTcxYTU1ZTdmNTJjMWU1MWE4NWNlMGU0ZGFkNTUwYzMxMGQxMDMwZQ==", "commit": {"author": {"name": "Alexandre Oliva", "email": "aoliva@redhat.com", "date": "2017-11-15T03:11:48Z"}, "committer": {"name": "Alexandre Oliva", "email": "aoliva@gcc.gnu.org", "date": "2017-11-15T03:11:48Z"}, "message": "introduce TDF_compare_debug, omit OBJ_TYPE_REF casts with it\n\nfor  gcc/ChangeLog\n\n\t* dumpfile.h (TDF_COMPARE_DEBUG): New.\n\t* final.c (rest_of_clean_state): Set it for the\n\t-fcompare-debug dump.\n\t* tree-pretty-print.c (dump_generic_node): Omit OBJ_TYPE_REF\n\tclass when TDF_COMPARE_DEBUG is set.\n\nFrom-SVN: r254751", "tree": {"sha": "4a2f16439b5d9964b8b0b04f7b84b25c3dfecac9", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/4a2f16439b5d9964b8b0b04f7b84b25c3dfecac9"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/171a55e7f52c1e51a85ce0e4dad550c310d1030e", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/171a55e7f52c1e51a85ce0e4dad550c310d1030e", "html_url": "https://github.com/Rust-GCC/gccrs/commit/171a55e7f52c1e51a85ce0e4dad550c310d1030e", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/171a55e7f52c1e51a85ce0e4dad550c310d1030e/comments", "author": null, "committer": null, "parents": [{"sha": "3267bd36aaf32ac4c88e5a4618067d9141fbfac7", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/3267bd36aaf32ac4c88e5a4618067d9141fbfac7", "html_url": "https://github.com/Rust-GCC/gccrs/commit/3267bd36aaf32ac4c88e5a4618067d9141fbfac7"}], "stats": {"total": 19, "additions": 17, "deletions": 2}, "files": [{"sha": "9cba109ec59946690262880211423a071c766a64", "filename": "gcc/ChangeLog", "status": "modified", "additions": 6, "deletions": 0, "changes": 6, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/171a55e7f52c1e51a85ce0e4dad550c310d1030e/gcc%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/171a55e7f52c1e51a85ce0e4dad550c310d1030e/gcc%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2FChangeLog?ref=171a55e7f52c1e51a85ce0e4dad550c310d1030e", "patch": "@@ -1,5 +1,11 @@\n 2017-11-15  Alexandre Oliva <aoliva@redhat.com>\n \n+\t* dumpfile.h (TDF_COMPARE_DEBUG): New.\n+\t* final.c (rest_of_clean_state): Set it for the\n+\t-fcompare-debug dump.\n+\t* tree-pretty-print.c (dump_generic_node): Omit OBJ_TYPE_REF\n+\tclass when TDF_COMPARE_DEBUG is set.\n+\n \t* dwarf2out.c (gen_producer_string): Discard\n \tOPT_fcompare_debug.\n "}, {"sha": "1b4d7e7dab71d22d7200c64871391071b49f76fd", "filename": "gcc/dumpfile.h", "status": "modified", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/171a55e7f52c1e51a85ce0e4dad550c310d1030e/gcc%2Fdumpfile.h", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/171a55e7f52c1e51a85ce0e4dad550c310d1030e/gcc%2Fdumpfile.h", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fdumpfile.h?ref=171a55e7f52c1e51a85ce0e4dad550c310d1030e", "patch": "@@ -93,6 +93,7 @@ enum dump_kind\n #define MSG_NOTE\t\t (1 << 24)  /* general optimization info */\n #define MSG_ALL\t\t(MSG_OPTIMIZED_LOCATIONS | MSG_MISSED_OPTIMIZATION \\\n \t\t\t | MSG_NOTE)\n+#define TDF_COMPARE_DEBUG (1 << 25)\t/* Dumping for -fcompare-debug.  */\n \n \n /* Value of TDF_NONE is used just for bits filtered by TDF_KIND_MASK.  */"}, {"sha": "fe35a36dbbf2994735a930e5adb9ad453333218f", "filename": "gcc/final.c", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/171a55e7f52c1e51a85ce0e4dad550c310d1030e/gcc%2Ffinal.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/171a55e7f52c1e51a85ce0e4dad550c310d1030e/gcc%2Ffinal.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ffinal.c?ref=171a55e7f52c1e51a85ce0e4dad550c310d1030e", "patch": "@@ -4629,7 +4629,7 @@ rest_of_clean_state (void)\n \t{\n \t  flag_dump_noaddr = flag_dump_unnumbered = 1;\n \t  if (flag_compare_debug_opt || flag_compare_debug)\n-\t    dump_flags |= TDF_NOUID;\n+\t    dump_flags |= TDF_NOUID | TDF_COMPARE_DEBUG;\n \t  dump_function_header (final_output, current_function_decl,\n \t\t\t\tdump_flags);\n \t  final_insns_dump_p = true;"}, {"sha": "80d45f96d67c7c776e85c4155cb91d108d62bced", "filename": "gcc/tree-pretty-print.c", "status": "modified", "additions": 9, "deletions": 1, "changes": 10, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/171a55e7f52c1e51a85ce0e4dad550c310d1030e/gcc%2Ftree-pretty-print.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/171a55e7f52c1e51a85ce0e4dad550c310d1030e/gcc%2Ftree-pretty-print.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftree-pretty-print.c?ref=171a55e7f52c1e51a85ce0e4dad550c310d1030e", "patch": "@@ -2760,7 +2760,15 @@ dump_generic_node (pretty_printer *pp, tree node, int spc, dump_flags_t flags,\n       pp_string (pp, \"OBJ_TYPE_REF(\");\n       dump_generic_node (pp, OBJ_TYPE_REF_EXPR (node), spc, flags, false);\n       pp_semicolon (pp);\n-      if (!(flags & TDF_SLIM) && virtual_method_call_p (node))\n+      /* We omit the class type for -fcompare-debug because we may\n+\t drop TYPE_BINFO early depending on debug info, and then\n+\t virtual_method_call_p would return false, whereas when\n+\t TYPE_BINFO is preserved it may still return true and then\n+\t we'd print the class type.  Compare tree and rtl dumps for\n+\t libstdc++-prettyprinters/shared_ptr.cc with and without -g,\n+\t for example, at occurrences of OBJ_TYPE_REF.  */\n+      if (!(flags & (TDF_SLIM | TDF_COMPARE_DEBUG))\n+\t  && virtual_method_call_p (node))\n \t{\n \t  pp_string (pp, \"(\");\n \t  dump_generic_node (pp, obj_type_ref_class (node), spc, flags, false);"}]}