{"sha": "1f91035fef4b9b43a47de29a925fb4638f322120", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6MWY5MTAzNWZlZjRiOWI0M2E0N2RlMjlhOTI1ZmI0NjM4ZjMyMjEyMA==", "commit": {"author": {"name": "Jan Hubicka", "email": "hubicka@gcc.gnu.org", "date": "2014-03-28T22:19:27Z"}, "committer": {"name": "Jan Hubicka", "email": "hubicka@gcc.gnu.org", "date": "2014-03-28T22:19:27Z"}, "message": "cgraph.c (cgraph_redirect_edge_call_stmt_to_callee): Clear static chain if needed.\n\n\n\t* cgraph.c (cgraph_redirect_edge_call_stmt_to_callee): Clear\n\tstatic chain if needed.\n\t* g++.dg/torture/pr60659.C: New testcase.\n\nFrom-SVN: r208927", "tree": {"sha": "a81ad361ae68752cb362377a7ef5130fe2dddcb9", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/a81ad361ae68752cb362377a7ef5130fe2dddcb9"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/1f91035fef4b9b43a47de29a925fb4638f322120", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/1f91035fef4b9b43a47de29a925fb4638f322120", "html_url": "https://github.com/Rust-GCC/gccrs/commit/1f91035fef4b9b43a47de29a925fb4638f322120", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/1f91035fef4b9b43a47de29a925fb4638f322120/comments", "author": null, "committer": null, "parents": [{"sha": "6e071b1e8f9902b8c65db6ca3349964a39d1651b", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/6e071b1e8f9902b8c65db6ca3349964a39d1651b", "html_url": "https://github.com/Rust-GCC/gccrs/commit/6e071b1e8f9902b8c65db6ca3349964a39d1651b"}], "stats": {"total": 58, "additions": 58, "deletions": 0}, "files": [{"sha": "ded35eb7e72ccdc14ea591c7e859ece18671e61a", "filename": "gcc/ChangeLog", "status": "modified", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/1f91035fef4b9b43a47de29a925fb4638f322120/gcc%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/1f91035fef4b9b43a47de29a925fb4638f322120/gcc%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2FChangeLog?ref=1f91035fef4b9b43a47de29a925fb4638f322120", "patch": "@@ -1,3 +1,8 @@\n+2014-03-28  Jan Hubicka  <hubicka@ucw.cz>\n+\n+\t* cgraph.c (cgraph_redirect_edge_call_stmt_to_callee): Clear\n+\tstatic chain if needed.\n+\n 2014-03-28  Vladimir Makarov  <vmakarov@redhat.com>\n \n \tPR target/60697"}, {"sha": "dcab9848307e4db4de1f39d21af9610dd042db46", "filename": "gcc/cgraph.c", "status": "modified", "additions": 8, "deletions": 0, "changes": 8, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/1f91035fef4b9b43a47de29a925fb4638f322120/gcc%2Fcgraph.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/1f91035fef4b9b43a47de29a925fb4638f322120/gcc%2Fcgraph.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fcgraph.c?ref=1f91035fef4b9b43a47de29a925fb4638f322120", "patch": "@@ -1488,6 +1488,14 @@ cgraph_redirect_edge_call_stmt_to_callee (struct cgraph_edge *e)\n \t  gsi_insert_before (&gsi, set_stmt, GSI_SAME_STMT);\n \t}\n       gimple_call_set_lhs (new_stmt, NULL_TREE);\n+      update_stmt_fn (DECL_STRUCT_FUNCTION (e->caller->decl), new_stmt);\n+    }\n+\n+  /* If new callee has no static chain, remove it.  */\n+  if (gimple_call_chain (new_stmt) && !DECL_STATIC_CHAIN (e->callee->decl))\n+    {\n+      gimple_call_set_chain (new_stmt, NULL);\n+      update_stmt_fn (DECL_STRUCT_FUNCTION (e->caller->decl), new_stmt);\n     }\n \n   cgraph_set_call_stmt_including_clones (e->caller, e->call_stmt, new_stmt, false);"}, {"sha": "63a43c2c3adb22ba5a68e5d9607ffcf6cf420919", "filename": "gcc/testsuite/ChangeLog", "status": "modified", "additions": 4, "deletions": 0, "changes": 4, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/1f91035fef4b9b43a47de29a925fb4638f322120/gcc%2Ftestsuite%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/1f91035fef4b9b43a47de29a925fb4638f322120/gcc%2Ftestsuite%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2FChangeLog?ref=1f91035fef4b9b43a47de29a925fb4638f322120", "patch": "@@ -1,3 +1,7 @@\n+2014-03-28  Eric Botcazou  <ebotcazou@adacore.com>\n+\n+\t* gnat.dg/opt33.adb: New testcase.\n+\n 2014-03-28  Vladimir Makarov  <vmakarov@redhat.com>\n \n \tPR target/60697"}, {"sha": "e1ac27c31eec107d00ec9f2f4d478dbd27ffb900", "filename": "gcc/testsuite/gnat.dg/opt33.adb", "status": "added", "additions": 41, "deletions": 0, "changes": 41, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/1f91035fef4b9b43a47de29a925fb4638f322120/gcc%2Ftestsuite%2Fgnat.dg%2Fopt33.adb", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/1f91035fef4b9b43a47de29a925fb4638f322120/gcc%2Ftestsuite%2Fgnat.dg%2Fopt33.adb", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgnat.dg%2Fopt33.adb?ref=1f91035fef4b9b43a47de29a925fb4638f322120", "patch": "@@ -0,0 +1,41 @@\n+-- { dg-do compile }\n+-- { dg-options \"-O\" }\n+\n+with Ada.Containers.Ordered_Sets;\n+with Ada.Strings.Unbounded;\n+\n+procedure Opt33 is\n+\n+   type Rec is record\n+      Name : Ada.Strings.Unbounded.Unbounded_String;\n+   end record;\n+\n+   function \"<\" (Left : Rec; Right : Rec) return Boolean;\n+\n+   package My_Ordered_Sets is new Ada.Containers.Ordered_Sets (Rec);\n+\n+   protected type Data is\n+      procedure Do_It;\n+   private\n+      Set : My_Ordered_Sets.Set;\n+   end Data;\n+\n+   function \"<\" (Left : Rec; Right : Rec) return Boolean is\n+   begin\n+      return False;\n+   end \"<\";\n+\n+   protected body Data is\n+      procedure Do_It is\n+         procedure Dummy (Position : My_Ordered_Sets.Cursor) is\n+         begin\n+            null;\n+         end;\n+      begin\n+         Set.Iterate (Dummy'Access);\n+      end;\n+   end Data;\n+\n+begin\n+   null;\n+end;"}]}