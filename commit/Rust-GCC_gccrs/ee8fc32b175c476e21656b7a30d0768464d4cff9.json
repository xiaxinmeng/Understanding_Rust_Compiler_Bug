{"sha": "ee8fc32b175c476e21656b7a30d0768464d4cff9", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6ZWU4ZmMzMmIxNzVjNDc2ZTIxNjU2YjdhMzBkMDc2ODQ2NGQ0Y2ZmOQ==", "commit": {"author": {"name": "Jason Merrill", "email": "jason@redhat.com", "date": "2001-04-13T00:49:43Z"}, "committer": {"name": "Jason Merrill", "email": "jason@gcc.gnu.org", "date": "2001-04-13T00:49:43Z"}, "message": "cp-tree.h (decl_namespace_list): New macro.\n\n        * cp-tree.h (decl_namespace_list): New macro.\n        (struct saved_scope): Add decl_ns_list.\n        * decl.c (mark_saved_scope): Mark it.\n        * decl2.c: Lose static decl_namespace_list.\n        (init_decl2): Don't save it.\n\nFrom-SVN: r41316", "tree": {"sha": "9c856bf58377189463c069a4824daf090ac8b39a", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/9c856bf58377189463c069a4824daf090ac8b39a"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/ee8fc32b175c476e21656b7a30d0768464d4cff9", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/ee8fc32b175c476e21656b7a30d0768464d4cff9", "html_url": "https://github.com/Rust-GCC/gccrs/commit/ee8fc32b175c476e21656b7a30d0768464d4cff9", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/ee8fc32b175c476e21656b7a30d0768464d4cff9/comments", "author": {"login": "jicama", "id": 266146, "node_id": "MDQ6VXNlcjI2NjE0Ng==", "avatar_url": "https://avatars.githubusercontent.com/u/266146?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jicama", "html_url": "https://github.com/jicama", "followers_url": "https://api.github.com/users/jicama/followers", "following_url": "https://api.github.com/users/jicama/following{/other_user}", "gists_url": "https://api.github.com/users/jicama/gists{/gist_id}", "starred_url": "https://api.github.com/users/jicama/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jicama/subscriptions", "organizations_url": "https://api.github.com/users/jicama/orgs", "repos_url": "https://api.github.com/users/jicama/repos", "events_url": "https://api.github.com/users/jicama/events{/privacy}", "received_events_url": "https://api.github.com/users/jicama/received_events", "type": "User", "site_admin": false}, "committer": null, "parents": [{"sha": "3b7da9c5fbf3490b5a02925eebd96ddc1d394a6d", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/3b7da9c5fbf3490b5a02925eebd96ddc1d394a6d", "html_url": "https://github.com/Rust-GCC/gccrs/commit/3b7da9c5fbf3490b5a02925eebd96ddc1d394a6d"}], "stats": {"total": 40, "additions": 32, "deletions": 8}, "files": [{"sha": "0ae306fa069f8a3ce66b8840bb4b1ba49b9235d6", "filename": "gcc/cp/ChangeLog", "status": "modified", "additions": 8, "deletions": 0, "changes": 8, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/ee8fc32b175c476e21656b7a30d0768464d4cff9/gcc%2Fcp%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/ee8fc32b175c476e21656b7a30d0768464d4cff9/gcc%2Fcp%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fcp%2FChangeLog?ref=ee8fc32b175c476e21656b7a30d0768464d4cff9", "patch": "@@ -1,3 +1,11 @@\n+2001-04-12  Jason Merrill  <jason_merrill@redhat.com>\n+\n+\t* cp-tree.h (decl_namespace_list): New macro.\n+\t(struct saved_scope): Add decl_ns_list.\n+\t* decl.c (mark_saved_scope): Mark it.\n+\t* decl2.c: Lose static decl_namespace_list.\n+\t(init_decl2): Don't save it.\n+\n 2001-04-12  Kaveh R. Ghazi  <ghazi@caip.rutgers.edu>\n \n \t* cp-tree.h (warn_return_type, yylex): Delete redundant"}, {"sha": "b1d3ee4c3dfd17e4aad1f05b0bf2d363e546ae8d", "filename": "gcc/cp/cp-tree.h", "status": "modified", "additions": 7, "deletions": 1, "changes": 8, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/ee8fc32b175c476e21656b7a30d0768464d4cff9/gcc%2Fcp%2Fcp-tree.h", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/ee8fc32b175c476e21656b7a30d0768464d4cff9/gcc%2Fcp%2Fcp-tree.h", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fcp%2Fcp-tree.h?ref=ee8fc32b175c476e21656b7a30d0768464d4cff9", "patch": "@@ -776,9 +776,11 @@ extern tree cp_global_trees[CPTI_MAX];\n \n /* Global state.  */\n \n-struct saved_scope {\n+struct saved_scope\n+{\n   tree old_bindings;\n   tree old_namespace;\n+  tree decl_ns_list;\n   tree class_name;\n   tree class_type;\n   tree access_specifier;\n@@ -809,6 +811,10 @@ struct saved_scope {\n \n #define current_namespace scope_chain->old_namespace\n \n+/* The stack for namespaces of current declarations. */\n+\n+#define decl_namespace_list scope_chain->decl_ns_list\n+\n /* IDENTIFIER_NODE: name of current class */\n \n #define current_class_name scope_chain->class_name"}, {"sha": "fb6b8a3c27bdf1a60b66a646bbc8c20ebfadc978", "filename": "gcc/cp/decl.c", "status": "modified", "additions": 2, "deletions": 1, "changes": 3, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/ee8fc32b175c476e21656b7a30d0768464d4cff9/gcc%2Fcp%2Fdecl.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/ee8fc32b175c476e21656b7a30d0768464d4cff9/gcc%2Fcp%2Fdecl.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fcp%2Fdecl.c?ref=ee8fc32b175c476e21656b7a30d0768464d4cff9", "patch": "@@ -2422,6 +2422,7 @@ mark_saved_scope (arg)\n       mark_binding_level (&t->class_bindings);\n       ggc_mark_tree (t->old_bindings);\n       ggc_mark_tree (t->old_namespace);\n+      ggc_mark_tree (t->decl_ns_list);\n       ggc_mark_tree (t->class_name);\n       ggc_mark_tree (t->class_type);\n       ggc_mark_tree (t->access_specifier);\n@@ -5750,7 +5751,7 @@ unqualified_namespace_lookup (name, flags, spacesp)\n      tree *spacesp;\n {\n   tree b = make_node (CPLUS_BINDING);\n-  tree initial = current_decl_namespace();\n+  tree initial = current_decl_namespace ();\n   tree scope = initial;\n   tree siter;\n   struct binding_level *level;"}, {"sha": "f8524cb3c506572a0f60215fbef303eab445e7b4", "filename": "gcc/cp/decl2.c", "status": "modified", "additions": 0, "deletions": 6, "changes": 6, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/ee8fc32b175c476e21656b7a30d0768464d4cff9/gcc%2Fcp%2Fdecl2.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/ee8fc32b175c476e21656b7a30d0768464d4cff9/gcc%2Fcp%2Fdecl2.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fcp%2Fdecl2.c?ref=ee8fc32b175c476e21656b7a30d0768464d4cff9", "patch": "@@ -125,11 +125,6 @@ tree static_dtors;\n /* The :: namespace. */\n \n tree global_namespace;\n-\n-/* The stack for namespaces of current declarations. */\n-\n-static tree decl_namespace_list;\n-\n \f\n /* C (and C++) language-specific option variables.  */\n \n@@ -5365,7 +5360,6 @@ handle_class_head (aggr, scope, id)\n void\n init_decl2 ()\n {\n-  ggc_add_tree_root (&decl_namespace_list, 1);\n   ggc_add_tree_varray_root (&deferred_fns, 1);\n   ggc_add_tree_varray_root (&pending_statics, 1);\n   ggc_add_tree_varray_root (&ssdf_decls, 1);"}, {"sha": "760be469dc8805f1f7cc210177e6662f84ff9c29", "filename": "gcc/testsuite/g++.old-deja/g++.ns/template16.C", "status": "added", "additions": 15, "deletions": 0, "changes": 15, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/ee8fc32b175c476e21656b7a30d0768464d4cff9/gcc%2Ftestsuite%2Fg%2B%2B.old-deja%2Fg%2B%2B.ns%2Ftemplate16.C", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/ee8fc32b175c476e21656b7a30d0768464d4cff9/gcc%2Ftestsuite%2Fg%2B%2B.old-deja%2Fg%2B%2B.ns%2Ftemplate16.C", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fg%2B%2B.old-deja%2Fg%2B%2B.ns%2Ftemplate16.C?ref=ee8fc32b175c476e21656b7a30d0768464d4cff9", "patch": "@@ -0,0 +1,15 @@\n+// Test that pushing into a namespace for a definition doesn't affect\n+// template instantiations.\n+\n+// Build don't link:\n+\n+namespace N {\n+  template <class T> void f () { }\n+  template <class T> struct A { friend void f<T>(); };\n+};\n+\n+namespace M {\n+  struct B;\n+};\n+\n+struct M::B: public N::A<int> { };"}]}