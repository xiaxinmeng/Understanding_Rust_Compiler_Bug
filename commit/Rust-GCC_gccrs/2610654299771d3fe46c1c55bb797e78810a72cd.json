{"sha": "2610654299771d3fe46c1c55bb797e78810a72cd", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6MjYxMDY1NDI5OTc3MWQzZmU0NmMxYzU1YmI3OTdlNzg4MTBhNzJjZA==", "commit": {"author": {"name": "Lee Millward", "email": "lee.millward@codesourcery.com", "date": "2006-10-11T19:31:33Z"}, "committer": {"name": "Lee Millward", "email": "lmillward@gcc.gnu.org", "date": "2006-10-11T19:31:33Z"}, "message": "re PR c++/29024 (storage class specifier accepted for typedef (clause 7.1.1 ; 1))\n\n        PR c++/29024\n        * cp-tree (struct cp_decl_specifier_seq): Rename to \n        conflicting_specifiers_p\n        * parser.c (cp_parser_set_storage_class): Set\n        conflicting_specifiers_p for the input decl specifier \n        if a typedef specifier is present. Rename uses of\n        multiple_specifiers_p to conflicting_specifiers_p.\n        (cp_parser_decl_specifier_seq) <RID_TYPEDEF>: If a storage \n        class specifier has already been set for this declaration, \n        set conflicting_specifiers_p to true on the decl_specs.\n        * decl.c (grokdeclarator): Rename uses of\n        multiple_specifiers_p to conflicting_specifiers_p.\n\n        * g++.dg/parse/typedef8.C: New test.\n        * g++.dg/other/mult-stor1.C: Adjust error markers.\n\nFrom-SVN: r117641", "tree": {"sha": "a7b32d64c052d1629ca208252036bb3c64a9f362", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/a7b32d64c052d1629ca208252036bb3c64a9f362"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/2610654299771d3fe46c1c55bb797e78810a72cd", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/2610654299771d3fe46c1c55bb797e78810a72cd", "html_url": "https://github.com/Rust-GCC/gccrs/commit/2610654299771d3fe46c1c55bb797e78810a72cd", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/2610654299771d3fe46c1c55bb797e78810a72cd/comments", "author": null, "committer": null, "parents": [{"sha": "377d569bdb93c48ccb209288dbddf0625e9ee335", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/377d569bdb93c48ccb209288dbddf0625e9ee335", "html_url": "https://github.com/Rust-GCC/gccrs/commit/377d569bdb93c48ccb209288dbddf0625e9ee335"}], "stats": {"total": 50, "additions": 44, "deletions": 6}, "files": [{"sha": "4c7fe491a41f52668e8ef6b577e9a724427c572e", "filename": "gcc/cp/ChangeLog", "status": "modified", "additions": 15, "deletions": 0, "changes": 15, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/2610654299771d3fe46c1c55bb797e78810a72cd/gcc%2Fcp%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/2610654299771d3fe46c1c55bb797e78810a72cd/gcc%2Fcp%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fcp%2FChangeLog?ref=2610654299771d3fe46c1c55bb797e78810a72cd", "patch": "@@ -1,3 +1,18 @@\n+2006-10-11  Lee Millward  <lee.millward@codesourcery.com>\n+\n+\tPR c++/29024\n+        * cp-tree (struct cp_decl_specifier_seq): Rename to \n+        conflicting_specifiers_p\n+        * parser.c (cp_parser_set_storage_class): Set\n+        conflicting_specifiers_p for the input decl specifier \n+        if a typedef specifier is present. Rename uses of\n+        multiple_specifiers_p to conflicting_specifiers_p.\n+        (cp_parser_decl_specifier_seq) <RID_TYPEDEF>: If a storage \n+        class specifier has already been set for this declaration, \n+        set conflicting_specifiers_p to true on the decl_specs.\n+        * decl.c (grokdeclarator): Rename uses of\n+        multiple_specifiers_p to conflicting_specifiers_p.\n+\n 2006-10-10  Brooks Moses  <bmoses@stanford.edu>\n \n \t* Make-lang.in: Added \"c++.pdf\" target support."}, {"sha": "8de90605c2bc37748e7fd7b882bd7ac8ace07475", "filename": "gcc/cp/cp-tree.h", "status": "modified", "additions": 3, "deletions": 2, "changes": 5, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/2610654299771d3fe46c1c55bb797e78810a72cd/gcc%2Fcp%2Fcp-tree.h", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/2610654299771d3fe46c1c55bb797e78810a72cd/gcc%2Fcp%2Fcp-tree.h", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fcp%2Fcp-tree.h?ref=2610654299771d3fe46c1c55bb797e78810a72cd", "patch": "@@ -3655,8 +3655,9 @@ typedef struct cp_decl_specifier_seq {\n      decl-specifier-seq.  */\n   BOOL_BITFIELD multiple_types_p : 1;\n   /* True iff multiple storage classes were (erroneously) specified\n-     for this decl-specifier-seq.  */\n-  BOOL_BITFIELD multiple_storage_classes_p : 1;\n+     for this decl-specifier-seq or a combination of a storage class\n+     with a typedef specifier.  */\n+  BOOL_BITFIELD conflicting_specifiers_p : 1;\n   /* True iff at least one decl-specifier was found.  */\n   BOOL_BITFIELD any_specifiers_p : 1;\n   /* True iff \"int\" was explicitly provided.  */"}, {"sha": "befd4e86485eb86f8ead96311fc08764e29f5ef4", "filename": "gcc/cp/decl.c", "status": "modified", "additions": 2, "deletions": 2, "changes": 4, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/2610654299771d3fe46c1c55bb797e78810a72cd/gcc%2Fcp%2Fdecl.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/2610654299771d3fe46c1c55bb797e78810a72cd/gcc%2Fcp%2Fdecl.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fcp%2Fdecl.c?ref=2610654299771d3fe46c1c55bb797e78810a72cd", "patch": "@@ -7402,9 +7402,9 @@ grokdeclarator (const cp_declarator *declarator,\n \n   /* Warn about storage classes that are invalid for certain\n      kinds of declarations (parameters, typenames, etc.).  */\n-  if (declspecs->multiple_storage_classes_p)\n+  if (declspecs->conflicting_specifiers_p)\n     {\n-      error (\"multiple storage classes in declaration of %qs\", name);\n+      error (\"conflicting specifiers in declaration of %qs\", name);\n       storage_class = sc_none;\n     }\n   else if (thread_p"}, {"sha": "41fe858b5efbab99b5edad4a28979621097cf246", "filename": "gcc/cp/parser.c", "status": "modified", "additions": 11, "deletions": 1, "changes": 12, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/2610654299771d3fe46c1c55bb797e78810a72cd/gcc%2Fcp%2Fparser.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/2610654299771d3fe46c1c55bb797e78810a72cd/gcc%2Fcp%2Fparser.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fcp%2Fparser.c?ref=2610654299771d3fe46c1c55bb797e78810a72cd", "patch": "@@ -7493,6 +7493,9 @@ cp_parser_decl_specifier_seq (cp_parser* parser,\n \t  /* The \"typedef\" keyword can only occur in a declaration; we\n \t     may as well commit at this point.  */\n \t  cp_parser_commit_to_tentative_parse (parser);\n+\n+          if (decl_specs->storage_class != sc_none)\n+            decl_specs->conflicting_specifiers_p = true;\n \t  break;\n \n \t  /* storage-class-specifier:\n@@ -16193,7 +16196,7 @@ cp_parser_set_storage_class (cp_parser *parser,\n     }\n   else if (decl_specs->storage_class != sc_none)\n     {\n-      decl_specs->multiple_storage_classes_p = true;\n+      decl_specs->conflicting_specifiers_p = true;\n       return;\n     }\n \n@@ -16225,6 +16228,13 @@ cp_parser_set_storage_class (cp_parser *parser,\n       gcc_unreachable ();\n     }\n   decl_specs->storage_class = storage_class;\n+\n+  /* A storage class specifier cannot be applied alongside a typedef \n+     specifier. If there is a typedef specifier present then set \n+     conflicting_specifiers_p which will trigger an error later\n+     on in grokdeclarator. */\n+  if (decl_specs->specs[(int)ds_typedef])\n+    decl_specs->conflicting_specifiers_p = true;\n }\n \n /* Update the DECL_SPECS to reflect the TYPE_SPEC.  If USER_DEFINED_P"}, {"sha": "2124585fc10c1ee8f7c850942ea52c5362733973", "filename": "gcc/testsuite/ChangeLog", "status": "modified", "additions": 6, "deletions": 0, "changes": 6, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/2610654299771d3fe46c1c55bb797e78810a72cd/gcc%2Ftestsuite%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/2610654299771d3fe46c1c55bb797e78810a72cd/gcc%2Ftestsuite%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2FChangeLog?ref=2610654299771d3fe46c1c55bb797e78810a72cd", "patch": "@@ -1,3 +1,9 @@\n+2006-10-11  Lee Millward  <lee.millward@codesourcery.com>\n+\n+        PR c++/29024\n+        * g++.dg/parse/typedef8.C: New test.\n+        * g++.dg/other/mult-stor1.C: Adjust error markers.\n+\t\n 2006-10-11  Richard Guenther  <rguenther@suse.de>\n \n \tPR tree-optimization/28230"}, {"sha": "1eaec4f14f9b37d94656e7990cda3250832d1dcb", "filename": "gcc/testsuite/g++.dg/other/mult-stor1.C", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/2610654299771d3fe46c1c55bb797e78810a72cd/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Fother%2Fmult-stor1.C", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/2610654299771d3fe46c1c55bb797e78810a72cd/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Fother%2Fmult-stor1.C", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Fother%2Fmult-stor1.C?ref=2610654299771d3fe46c1c55bb797e78810a72cd", "patch": "@@ -4,5 +4,5 @@\n \n struct A\n {\n-  extern static int i;  // { dg-error \"multiple storage classes\" }\n+  extern static int i;  // { dg-error \"conflicting specifiers\" }\n };"}, {"sha": "8c46bad8cae9b0b5248831019415c32ee1f1d1a5", "filename": "gcc/testsuite/g++.dg/parse/typedef8.C", "status": "added", "additions": 6, "deletions": 0, "changes": 6, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/2610654299771d3fe46c1c55bb797e78810a72cd/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Fparse%2Ftypedef8.C", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/2610654299771d3fe46c1c55bb797e78810a72cd/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Fparse%2Ftypedef8.C", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Fparse%2Ftypedef8.C?ref=2610654299771d3fe46c1c55bb797e78810a72cd", "patch": "@@ -0,0 +1,6 @@\n+//PR c++ 29024\n+\n+typedef static int a;   // { dg-error \"conflicting\" }\n+typedef register int b; // { dg-error \"conflicting\" }\n+typedef extern int c;   // { dg-error \"conflicting\" }\n+static typedef int a;   // { dg-error \"conflicting\" }"}]}