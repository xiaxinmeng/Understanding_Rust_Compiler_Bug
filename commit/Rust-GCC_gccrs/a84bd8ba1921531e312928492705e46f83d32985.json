{"sha": "a84bd8ba1921531e312928492705e46f83d32985", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6YTg0YmQ4YmExOTIxNTMxZTMxMjkyODQ5MjcwNWU0NmY4M2QzMjk4NQ==", "commit": {"author": {"name": "Ian Lance Taylor", "email": "ian@gcc.gnu.org", "date": "2011-12-16T14:45:49Z"}, "committer": {"name": "Ian Lance Taylor", "email": "ian@gcc.gnu.org", "date": "2011-12-16T14:45:49Z"}, "message": "os: Fix fileInfoFromStat for Solaris.\n\nFrom Rainer Orth.\n\nFrom-SVN: r182402", "tree": {"sha": "eb29d49c8104e9ecb5c03b9c06bb1ebb12709b1f", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/eb29d49c8104e9ecb5c03b9c06bb1ebb12709b1f"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/a84bd8ba1921531e312928492705e46f83d32985", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/a84bd8ba1921531e312928492705e46f83d32985", "html_url": "https://github.com/Rust-GCC/gccrs/commit/a84bd8ba1921531e312928492705e46f83d32985", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/a84bd8ba1921531e312928492705e46f83d32985/comments", "author": null, "committer": null, "parents": [{"sha": "271d01dfbb534e2311e43ec78442d43d95d12586", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/271d01dfbb534e2311e43ec78442d43d95d12586", "html_url": "https://github.com/Rust-GCC/gccrs/commit/271d01dfbb534e2311e43ec78442d43d95d12586"}], "stats": {"total": 68, "additions": 66, "deletions": 2}, "files": [{"sha": "5bbeb890bd91bfe3ef77e48ba724b0bf4b73cb5b", "filename": "libgo/Makefile.am", "status": "modified", "additions": 7, "deletions": 1, "changes": 8, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/a84bd8ba1921531e312928492705e46f83d32985/libgo%2FMakefile.am", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/a84bd8ba1921531e312928492705e46f83d32985/libgo%2FMakefile.am", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libgo%2FMakefile.am?ref=a84bd8ba1921531e312928492705e46f83d32985", "patch": "@@ -763,6 +763,12 @@ endif\n endif\n endif\n \n+if LIBGO_IS_SOLARIS\n+go_os_stat_file = go/os/stat_solaris.go\n+else\n+go_os_stat_file = go/os/stat.go\n+endif\n+\n go_os_files = \\\n \t$(go_os_dir_file) \\\n \tgo/os/dir.go \\\n@@ -779,7 +785,7 @@ go_os_files = \\\n \tgo/os/path.go \\\n \tgo/os/path_unix.go \\\n \tgo/os/proc.go \\\n-\tgo/os/stat.go \\\n+\t$(go_os_stat_file) \\\n \tgo/os/str.go \\\n \t$(go_os_sys_file) \\\n \tgo/os/time.go \\"}, {"sha": "70f3aca9ed8032a5bca584beb913d61bf59ac204", "filename": "libgo/Makefile.in", "status": "modified", "additions": 3, "deletions": 1, "changes": 4, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/a84bd8ba1921531e312928492705e46f83d32985/libgo%2FMakefile.in", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/a84bd8ba1921531e312928492705e46f83d32985/libgo%2FMakefile.in", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libgo%2FMakefile.in?ref=a84bd8ba1921531e312928492705e46f83d32985", "patch": "@@ -1096,6 +1096,8 @@ go_net_files = \\\n @LIBGO_IS_IRIX_TRUE@@LIBGO_IS_LINUX_FALSE@@LIBGO_IS_SOLARIS_FALSE@go_os_sys_file = go/os/sys_uname.go\n @LIBGO_IS_LINUX_FALSE@@LIBGO_IS_SOLARIS_TRUE@go_os_sys_file = go/os/sys_uname.go\n @LIBGO_IS_LINUX_TRUE@go_os_sys_file = go/os/sys_linux.go\n+@LIBGO_IS_SOLARIS_FALSE@go_os_stat_file = go/os/stat.go\n+@LIBGO_IS_SOLARIS_TRUE@go_os_stat_file = go/os/stat_solaris.go\n go_os_files = \\\n \t$(go_os_dir_file) \\\n \tgo/os/dir.go \\\n@@ -1112,7 +1114,7 @@ go_os_files = \\\n \tgo/os/path.go \\\n \tgo/os/path_unix.go \\\n \tgo/os/proc.go \\\n-\tgo/os/stat.go \\\n+\t$(go_os_stat_file) \\\n \tgo/os/str.go \\\n \t$(go_os_sys_file) \\\n \tgo/os/time.go \\"}, {"sha": "2321da6e50d85b08415736d3c660390c4356e8bd", "filename": "libgo/go/os/stat_solaris.go", "status": "added", "additions": 56, "deletions": 0, "changes": 56, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/a84bd8ba1921531e312928492705e46f83d32985/libgo%2Fgo%2Fos%2Fstat_solaris.go", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/a84bd8ba1921531e312928492705e46f83d32985/libgo%2Fgo%2Fos%2Fstat_solaris.go", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libgo%2Fgo%2Fos%2Fstat_solaris.go?ref=a84bd8ba1921531e312928492705e46f83d32985", "patch": "@@ -0,0 +1,56 @@\n+// Copyright 2011 The Go Authors. All rights reserved.\n+// Use of this source code is governed by a BSD-style\n+// license that can be found in the LICENSE file.\n+\n+package os\n+\n+import (\n+\t\"syscall\"\n+\t\"time\"\n+)\n+\n+func sameFile(fs1, fs2 *FileStat) bool {\n+\tsys1 := fs1.Sys.(*syscall.Stat_t)\n+\tsys2 := fs2.Sys.(*syscall.Stat_t)\n+\treturn sys1.Dev == sys2.Dev && sys1.Ino == sys2.Ino\n+}\n+\n+func fileInfoFromStat(st *syscall.Stat_t, name string) FileInfo {\n+\tfs := &FileStat{\n+\t\tname:    basename(name),\n+\t\tsize:    int64(st.Size),\n+\t\tmodTime: timestrucToTime(st.Mtime),\n+\t\tSys:     st,\n+\t}\n+\tfs.mode = FileMode(st.Mode & 0777)\n+\tswitch st.Mode & syscall.S_IFMT {\n+\tcase syscall.S_IFBLK, syscall.S_IFCHR:\n+\t\tfs.mode |= ModeDevice\n+\tcase syscall.S_IFDIR:\n+\t\tfs.mode |= ModeDir\n+\tcase syscall.S_IFIFO:\n+\t\tfs.mode |= ModeNamedPipe\n+\tcase syscall.S_IFLNK:\n+\t\tfs.mode |= ModeSymlink\n+\tcase syscall.S_IFREG:\n+\t\t// nothing to do\n+\tcase syscall.S_IFSOCK:\n+\t\tfs.mode |= ModeSocket\n+\t}\n+\tif st.Mode&syscall.S_ISGID != 0 {\n+\t\tfs.mode |= ModeSetgid\n+\t}\n+\tif st.Mode&syscall.S_ISUID != 0 {\n+\t\tfs.mode |= ModeSetuid\n+\t}\n+\treturn fs\n+}\n+\n+func timestrucToTime(ts syscall.Timestruc) time.Time {\n+\treturn time.Unix(int64(ts.Sec), int64(ts.Nsec))\n+}\n+\n+// For testing.\n+func atime(fi FileInfo) time.Time {\n+\treturn timestrucToTime(fi.(*FileStat).Sys.(*syscall.Stat_t).Atime)\n+}"}]}