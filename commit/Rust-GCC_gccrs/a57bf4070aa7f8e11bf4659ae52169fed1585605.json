{"sha": "a57bf4070aa7f8e11bf4659ae52169fed1585605", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6YTU3YmY0MDcwYWE3ZjhlMTFiZjQ2NTlhZTUyMTY5ZmVkMTU4NTYwNQ==", "commit": {"author": {"name": "Ian Lance Taylor", "email": "ian@gcc.gnu.org", "date": "2012-12-17T21:07:27Z"}, "committer": {"name": "Ian Lance Taylor", "email": "ian@gcc.gnu.org", "date": "2012-12-17T21:07:27Z"}, "message": "log/syslog: Solaris portability patches.\n\nFrom-SVN: r194566", "tree": {"sha": "7569f819ecc7d1b7b0ed44db9354f6d9e0a34444", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/7569f819ecc7d1b7b0ed44db9354f6d9e0a34444"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/a57bf4070aa7f8e11bf4659ae52169fed1585605", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/a57bf4070aa7f8e11bf4659ae52169fed1585605", "html_url": "https://github.com/Rust-GCC/gccrs/commit/a57bf4070aa7f8e11bf4659ae52169fed1585605", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/a57bf4070aa7f8e11bf4659ae52169fed1585605/comments", "author": null, "committer": null, "parents": [{"sha": "a48bd7c6a5991e8007fbd25285ac56f76e2561d7", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/a48bd7c6a5991e8007fbd25285ac56f76e2561d7", "html_url": "https://github.com/Rust-GCC/gccrs/commit/a48bd7c6a5991e8007fbd25285ac56f76e2561d7"}], "stats": {"total": 21, "additions": 13, "deletions": 8}, "files": [{"sha": "2d14d5d20a88207263adae3798060835a4048773", "filename": "libgo/go/log/syslog/syslog_libc.go", "status": "modified", "additions": 13, "deletions": 8, "changes": 21, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/a57bf4070aa7f8e11bf4659ae52169fed1585605/libgo%2Fgo%2Flog%2Fsyslog%2Fsyslog_libc.go", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/a57bf4070aa7f8e11bf4659ae52169fed1585605/libgo%2Fgo%2Flog%2Fsyslog%2Fsyslog_libc.go", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libgo%2Fgo%2Flog%2Fsyslog%2Fsyslog_libc.go?ref=a57bf4070aa7f8e11bf4659ae52169fed1585605", "patch": "@@ -10,7 +10,9 @@ package syslog\n \n import (\n \t\"fmt\"\n+\t\"os\"\n \t\"syscall\"\n+\t\"time\"\n )\n \n func unixSyslog() (conn serverConn, err error) {\n@@ -21,14 +23,17 @@ type libcConn int\n \n func syslog_c(int, *byte)\n \n-func (libcConn) writeBytes(p Priority, prefix string, b []byte) (int, error) {\n-\tsyslog_c(int(p), syscall.StringBytePtr(fmt.Sprintf(\"%s: %s\", prefix, b)))\n-\treturn len(b), nil\n-}\n-\n-func (libcConn) writeString(p Priority, prefix string, s string) (int, error) {\n-\tsyslog_c(int(p), syscall.StringBytePtr(fmt.Sprintf(\"%s: %s\", prefix, s)))\n-\treturn len(s), nil\n+func (libcConn) writeString(p Priority, hostname, tag, msg string) (int, error) {\n+\ttimestamp := time.Now().Format(time.RFC3339)\n+\tlog := fmt.Sprintf(\"%s %s %s[%d]: %s\", timestamp, hostname, tag, os.Getpid(), msg)\n+\tbuf, err := syscall.BytePtrFromString(log)\n+\tif err != nil {\n+\t\treturn 0, err\n+\t}\n+\tsyscall.Entersyscall()\n+\tsyslog_c(int(p), buf)\n+\tsyscall.Exitsyscall()\n+\treturn len(msg), nil\n }\n \n func (libcConn) close() error {"}]}