{"sha": "c09c4992ac138656415fc108edcab8d643fc89bb", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6YzA5YzQ5OTJhYzEzODY1NjQxNWZjMTA4ZWRjYWI4ZDY0M2ZjODliYg==", "commit": {"author": {"name": "Bernd Edlinger", "email": "bernd.edlinger@hotmail.de", "date": "2016-10-07T17:10:38Z"}, "committer": {"name": "Bernd Edlinger", "email": "edlinger@gcc.gnu.org", "date": "2016-10-07T17:10:38Z"}, "message": "re PR c++/77700 (suspicios code in cp/parser.c)\n\n2016-10-07  Bernd Edlinger  <bernd.edlinger@hotmail.de>\n\n        PR c++/77700\n        * c-common.c (c_common_truthvalue_conversion): Warn also for\n        suspicious enum values in boolean context.\n\ncp:\n2016-10-07  Bernd Edlinger  <bernd.edlinger@hotmail.de>\n\n        PR c++/77700\n        * parser.c (cp_parser_base_specifier): Fix a warning.\n\ntestsuite:\n2016-10-07  Bernd Edlinger  <bernd.edlinger@hotmail.de>\n\n        PR c++/77700\n        * c-c++-common/Wint-in-bool-context.c: Update test.\n\nFrom-SVN: r240867", "tree": {"sha": "303ab8a08b00dcbd206ce3f14a8c4ed3752ff2c6", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/303ab8a08b00dcbd206ce3f14a8c4ed3752ff2c6"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/c09c4992ac138656415fc108edcab8d643fc89bb", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/c09c4992ac138656415fc108edcab8d643fc89bb", "html_url": "https://github.com/Rust-GCC/gccrs/commit/c09c4992ac138656415fc108edcab8d643fc89bb", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/c09c4992ac138656415fc108edcab8d643fc89bb/comments", "author": {"login": "bernd-edlinger", "id": 17638929, "node_id": "MDQ6VXNlcjE3NjM4OTI5", "avatar_url": "https://avatars.githubusercontent.com/u/17638929?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bernd-edlinger", "html_url": "https://github.com/bernd-edlinger", "followers_url": "https://api.github.com/users/bernd-edlinger/followers", "following_url": "https://api.github.com/users/bernd-edlinger/following{/other_user}", "gists_url": "https://api.github.com/users/bernd-edlinger/gists{/gist_id}", "starred_url": "https://api.github.com/users/bernd-edlinger/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bernd-edlinger/subscriptions", "organizations_url": "https://api.github.com/users/bernd-edlinger/orgs", "repos_url": "https://api.github.com/users/bernd-edlinger/repos", "events_url": "https://api.github.com/users/bernd-edlinger/events{/privacy}", "received_events_url": "https://api.github.com/users/bernd-edlinger/received_events", "type": "User", "site_admin": false}, "committer": null, "parents": [{"sha": "125f0e39bfde6c0eb81a5409ce09112f4b875860", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/125f0e39bfde6c0eb81a5409ce09112f4b875860", "html_url": "https://github.com/Rust-GCC/gccrs/commit/125f0e39bfde6c0eb81a5409ce09112f4b875860"}], "stats": {"total": 31, "additions": 30, "deletions": 1}, "files": [{"sha": "08535d0ba2b4365a2504ad1600ae59ebf0c19f20", "filename": "gcc/c-family/ChangeLog", "status": "modified", "additions": 6, "deletions": 0, "changes": 6, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/c09c4992ac138656415fc108edcab8d643fc89bb/gcc%2Fc-family%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/c09c4992ac138656415fc108edcab8d643fc89bb/gcc%2Fc-family%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fc-family%2FChangeLog?ref=c09c4992ac138656415fc108edcab8d643fc89bb", "patch": "@@ -1,3 +1,9 @@\n+2016-10-07  Bernd Edlinger  <bernd.edlinger@hotmail.de>\n+\n+\tPR c++/77700\n+\t* c-common.c (c_common_truthvalue_conversion): Warn also for\n+\tsuspicious enum values in boolean context.\n+\n 2016-10-06  Jakub Jelinek  <jakub@redhat.com>\n \n \tImplement P0258R2 - helper for C++17"}, {"sha": "19609a59d9ccce4a9575a054ec32e95aa6cf8e13", "filename": "gcc/c-family/c-common.c", "status": "modified", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/c09c4992ac138656415fc108edcab8d643fc89bb/gcc%2Fc-family%2Fc-common.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/c09c4992ac138656415fc108edcab8d643fc89bb/gcc%2Fc-family%2Fc-common.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fc-family%2Fc-common.c?ref=c09c4992ac138656415fc108edcab8d643fc89bb", "patch": "@@ -4590,6 +4590,11 @@ c_common_truthvalue_conversion (location_t location, tree expr)\n       return expr;\n \n     case INTEGER_CST:\n+      if (TREE_CODE (TREE_TYPE (expr)) == ENUMERAL_TYPE\n+\t  && !integer_zerop (expr)\n+\t  && !integer_onep (expr))\n+\twarning_at (location, OPT_Wint_in_bool_context,\n+\t\t    \"enum constant in boolean context\");\n       return integer_zerop (expr) ? truthvalue_false_node\n \t\t\t\t  : truthvalue_true_node;\n "}, {"sha": "085e0a53c3874a5aa9f3b527244da4574f0eb0b3", "filename": "gcc/cp/ChangeLog", "status": "modified", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/c09c4992ac138656415fc108edcab8d643fc89bb/gcc%2Fcp%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/c09c4992ac138656415fc108edcab8d643fc89bb/gcc%2Fcp%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fcp%2FChangeLog?ref=c09c4992ac138656415fc108edcab8d643fc89bb", "patch": "@@ -1,3 +1,8 @@\n+2016-10-07  Bernd Edlinger  <bernd.edlinger@hotmail.de>\n+\n+\tPR c++/77700\n+\t* parser.c (cp_parser_base_specifier): Fix a warning.\n+\n 2016-10-07  Bernd Schmidt  <bschmidt@redhat.com>\n \n \tPR c++/69733"}, {"sha": "8728991af7393f74f959e1d8be5fe5dabe7a7001", "filename": "gcc/cp/parser.c", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/c09c4992ac138656415fc108edcab8d643fc89bb/gcc%2Fcp%2Fparser.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/c09c4992ac138656415fc108edcab8d643fc89bb/gcc%2Fcp%2Fparser.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fcp%2Fparser.c?ref=c09c4992ac138656415fc108edcab8d643fc89bb", "patch": "@@ -23338,7 +23338,7 @@ cp_parser_base_specifier (cp_parser* parser)\n   cp_parser_nested_name_specifier_opt (parser,\n \t\t\t\t       /*typename_keyword_p=*/true,\n \t\t\t\t       /*check_dependency_p=*/true,\n-\t\t\t\t       typename_type,\n+\t\t\t\t       /*type_p=*/true,\n \t\t\t\t       /*is_declaration=*/true);\n   /* If the base class is given by a qualified name, assume that names\n      we see are type names or templates, as appropriate.  */"}, {"sha": "fd69779350aff07139c74d4165e6206ecde1e6ec", "filename": "gcc/testsuite/ChangeLog", "status": "modified", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/c09c4992ac138656415fc108edcab8d643fc89bb/gcc%2Ftestsuite%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/c09c4992ac138656415fc108edcab8d643fc89bb/gcc%2Ftestsuite%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2FChangeLog?ref=c09c4992ac138656415fc108edcab8d643fc89bb", "patch": "@@ -1,3 +1,8 @@\n+2016-10-07  Bernd Edlinger  <bernd.edlinger@hotmail.de>\n+\n+\tPR c++/77700\n+\t* c-c++-common/Wint-in-bool-context.c: Update test.\n+\n 2016-10-07  Richard Biener  <rguenther@suse.de>\n \n \t* gcc.dg/tree-ssa/vrp01.c: Adjust."}, {"sha": "42ff14784cc84b811b39f63cf7b9d45122fd6191", "filename": "gcc/testsuite/c-c++-common/Wint-in-bool-context.c", "status": "modified", "additions": 8, "deletions": 0, "changes": 8, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/c09c4992ac138656415fc108edcab8d643fc89bb/gcc%2Ftestsuite%2Fc-c%2B%2B-common%2FWint-in-bool-context.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/c09c4992ac138656415fc108edcab8d643fc89bb/gcc%2Ftestsuite%2Fc-c%2B%2B-common%2FWint-in-bool-context.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fc-c%2B%2B-common%2FWint-in-bool-context.c?ref=c09c4992ac138656415fc108edcab8d643fc89bb", "patch": "@@ -2,6 +2,8 @@\n /* { dg-options \"-Wint-in-bool-context\" } */\n /* { dg-do compile } */\n \n+enum truth { yes, no, maybe };\n+\n int foo (int a, int b)\n {\n   if (a > 0 && a <= (b == 1) ? 1 : 2) /* { dg-warning \"boolean context\" } */\n@@ -27,5 +29,11 @@ int foo (int a, int b)\n \n   for (a = 0; 1 << a; a++); /* { dg-warning \"boolean context\" } */\n \n+  if (yes || no || maybe) /* { dg-warning \"boolean context\" \"\" { target c++ } } */\n+    return 8;\n+\n+  if (yes || no) /* { dg-bogus \"boolean context\" } */\n+    return 9;\n+\n   return 0;\n }"}]}