{"sha": "b2ae828d7a91ec75eeb2da0af8e05992afe9209c", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6YjJhZTgyOGQ3YTkxZWM3NWVlYjJkYTBhZjhlMDU5OTJhZmU5MjA5Yw==", "commit": {"author": {"name": "Joey Ye", "email": "joey.ye@intel.com", "date": "2008-02-18T23:43:23Z"}, "committer": {"name": "H.J. Lu", "email": "hjl@gcc.gnu.org", "date": "2008-02-18T23:43:23Z"}, "message": "re PR middle-end/34921 (Misalign stack variable referenced by nested function)\n\ngcc/\n\n2008-02-18  Joey Ye  <joey.ye@intel.com>\n\n\tPR middle-end/34921\n\t* tree-nested.c (insert_field_into_struct): Set type alignment\n\tto field alignment if the former is less than the latter.\n\ngcc/testsuite/\n\n2008-02-18  Joey Ye  <joey.ye@intel.com>\n\t    H.J. Lu  <hongjiu.lu@intel.com>\n\n\tPR middle-end/34921\n\t* gcc.c-torture/execute/nest-align-1.c: New test case.\n\nCo-Authored-By: H.J. Lu <hongjiu.lu@intel.com>\n\nFrom-SVN: r132396", "tree": {"sha": "4483353c2c7f7a20740bbd95d2b06188cd9bc909", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/4483353c2c7f7a20740bbd95d2b06188cd9bc909"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/b2ae828d7a91ec75eeb2da0af8e05992afe9209c", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/b2ae828d7a91ec75eeb2da0af8e05992afe9209c", "html_url": "https://github.com/Rust-GCC/gccrs/commit/b2ae828d7a91ec75eeb2da0af8e05992afe9209c", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/b2ae828d7a91ec75eeb2da0af8e05992afe9209c/comments", "author": {"login": "npg-joey", "id": 81339828, "node_id": "MDQ6VXNlcjgxMzM5ODI4", "avatar_url": "https://avatars.githubusercontent.com/u/81339828?v=4", "gravatar_id": "", "url": "https://api.github.com/users/npg-joey", "html_url": "https://github.com/npg-joey", "followers_url": "https://api.github.com/users/npg-joey/followers", "following_url": "https://api.github.com/users/npg-joey/following{/other_user}", "gists_url": "https://api.github.com/users/npg-joey/gists{/gist_id}", "starred_url": "https://api.github.com/users/npg-joey/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/npg-joey/subscriptions", "organizations_url": "https://api.github.com/users/npg-joey/orgs", "repos_url": "https://api.github.com/users/npg-joey/repos", "events_url": "https://api.github.com/users/npg-joey/events{/privacy}", "received_events_url": "https://api.github.com/users/npg-joey/received_events", "type": "User", "site_admin": false}, "committer": null, "parents": [{"sha": "bd67275ca9838005ad5856679c1177827f230f4b", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/bd67275ca9838005ad5856679c1177827f230f4b", "html_url": "https://github.com/Rust-GCC/gccrs/commit/bd67275ca9838005ad5856679c1177827f230f4b"}], "stats": {"total": 56, "additions": 56, "deletions": 0}, "files": [{"sha": "3ecc40c81329c349013208027bdc3a797653f49c", "filename": "gcc/ChangeLog", "status": "modified", "additions": 6, "deletions": 0, "changes": 6, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/b2ae828d7a91ec75eeb2da0af8e05992afe9209c/gcc%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/b2ae828d7a91ec75eeb2da0af8e05992afe9209c/gcc%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2FChangeLog?ref=b2ae828d7a91ec75eeb2da0af8e05992afe9209c", "patch": "@@ -1,3 +1,9 @@\n+2008-02-18  Joey Ye  <joey.ye@intel.com>\n+\n+\tPR middle-end/34921\n+\t* tree-nested.c (insert_field_into_struct): Set type alignment\n+\tto field alignment if the former is less than the latter.\n+\n 2008-02-18  Jakub Jelinek  <jakub@redhat.com>\n \n \t* BASE-VER: Set to 4.4.0."}, {"sha": "79db2f1bce9932d7ce6728d62014fafdc092791f", "filename": "gcc/testsuite/ChangeLog", "status": "modified", "additions": 6, "deletions": 0, "changes": 6, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/b2ae828d7a91ec75eeb2da0af8e05992afe9209c/gcc%2Ftestsuite%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/b2ae828d7a91ec75eeb2da0af8e05992afe9209c/gcc%2Ftestsuite%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2FChangeLog?ref=b2ae828d7a91ec75eeb2da0af8e05992afe9209c", "patch": "@@ -1,3 +1,9 @@\n+2008-02-18  Joey Ye  <joey.ye@intel.com>\n+\t    H.J. Lu  <hongjiu.lu@intel.com>\n+\n+\tPR middle-end/34921\n+\t* gcc.c-torture/execute/nest-align-1.c: New test case.\n+\n 2008-02-17  Richard Guenther  <rguenther@suse.de>\n \n \tPR middle-end/35227"}, {"sha": "6099a5001c9f5f111d270a593116775305a6089d", "filename": "gcc/testsuite/gcc.c-torture/execute/nest-align-1.c", "status": "added", "additions": 40, "deletions": 0, "changes": 40, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/b2ae828d7a91ec75eeb2da0af8e05992afe9209c/gcc%2Ftestsuite%2Fgcc.c-torture%2Fexecute%2Fnest-align-1.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/b2ae828d7a91ec75eeb2da0af8e05992afe9209c/gcc%2Ftestsuite%2Fgcc.c-torture%2Fexecute%2Fnest-align-1.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgcc.c-torture%2Fexecute%2Fnest-align-1.c?ref=b2ae828d7a91ec75eeb2da0af8e05992afe9209c", "patch": "@@ -0,0 +1,40 @@\n+/* Test for alignment handling when a variable is accessed by nested\n+   function.  */\n+/* Origin: Joey Ye <joey.ye@intel.com> */\n+\n+#include <stddef.h>\n+\n+typedef int aligned __attribute__((aligned(16)));\n+extern void abort (void);\n+\n+void\n+check (int *i)\n+{\n+  *i = 20;\n+  if ((((ptrdiff_t) i) & (__alignof__(aligned) - 1)) != 0)\n+    abort ();\n+}\n+\n+void\n+foo (void)\n+{\n+  aligned jj;\n+  void bar ()\n+    {\n+      jj = -20;\n+    }\n+  jj = 0;\n+  bar ();\n+  if (jj != -20)\n+    abort ();\n+  check (&jj);\n+  if (jj != 20)\n+    abort ();\n+}\n+\n+int\n+main()\n+{\n+  foo ();\n+  return 0;\n+}"}, {"sha": "2c1b9190d85793c5946dd2115c0fd45804f33afd", "filename": "gcc/tree-nested.c", "status": "modified", "additions": 4, "deletions": 0, "changes": 4, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/b2ae828d7a91ec75eeb2da0af8e05992afe9209c/gcc%2Ftree-nested.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/b2ae828d7a91ec75eeb2da0af8e05992afe9209c/gcc%2Ftree-nested.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftree-nested.c?ref=b2ae828d7a91ec75eeb2da0af8e05992afe9209c", "patch": "@@ -183,6 +183,10 @@ insert_field_into_struct (tree type, tree field)\n \n   TREE_CHAIN (field) = *p;\n   *p = field;\n+\n+  /* Set correct alignment for frame struct type.  */\n+  if (TYPE_ALIGN (type) < DECL_ALIGN (field))\n+    TYPE_ALIGN (type) = DECL_ALIGN (field);\n }\n \n /* Build or return the RECORD_TYPE that describes the frame state that is"}]}