{"sha": "0daa7ed9447c71f2a1c1311729f840c36d0a558d", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6MGRhYTdlZDk0NDdjNzFmMmExYzEzMTE3MjlmODQwYzM2ZDBhNTU4ZA==", "commit": {"author": {"name": "Alessandro Fanfarillo", "email": "fanfarillo.gcc@gmail.com", "date": "2016-03-28T09:05:01Z"}, "committer": {"name": "Alessandro Fanfarillo", "email": "afanfa@gcc.gnu.org", "date": "2016-03-28T09:05:01Z"}, "message": "STOP managed by external library when coarrays are used\n\nFrom-SVN: r234502", "tree": {"sha": "5e06caaa5702f05c412828249ea7d92ef377f1a6", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/5e06caaa5702f05c412828249ea7d92ef377f1a6"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/0daa7ed9447c71f2a1c1311729f840c36d0a558d", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/0daa7ed9447c71f2a1c1311729f840c36d0a558d", "html_url": "https://github.com/Rust-GCC/gccrs/commit/0daa7ed9447c71f2a1c1311729f840c36d0a558d", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/0daa7ed9447c71f2a1c1311729f840c36d0a558d/comments", "author": null, "committer": null, "parents": [{"sha": "45733562ce6c85f6bfd60afa5438f20ef47c2c15", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/45733562ce6c85f6bfd60afa5438f20ef47c2c15", "html_url": "https://github.com/Rust-GCC/gccrs/commit/45733562ce6c85f6bfd60afa5438f20ef47c2c15"}], "stats": {"total": 63, "additions": 60, "deletions": 3}, "files": [{"sha": "cf95d6ffc95949caa6a4154bfaf98fff39be5f0c", "filename": "gcc/fortran/ChangeLog", "status": "modified", "additions": 8, "deletions": 0, "changes": 8, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/0daa7ed9447c71f2a1c1311729f840c36d0a558d/gcc%2Ffortran%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/0daa7ed9447c71f2a1c1311729f840c36d0a558d/gcc%2Ffortran%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ffortran%2FChangeLog?ref=0daa7ed9447c71f2a1c1311729f840c36d0a558d", "patch": "@@ -1,3 +1,11 @@\n+2016-03-28  Alessandro Fanfarillo  <fanfarillo.gcc@gmail.com>\n+\n+\t* trans-decl.c (gfc_build_builtin_function_decls):\n+\tcaf_stop_numeric and caf_stop_str definition.\n+\t* trans-stmt.c (gfc_trans_stop): invoke external functions\n+\tfor stop and stop_str when coarrays are used.\n+\t* trans.h: extern for new functions.\n+\n 2016-03-19  Jerry DeLisle  <jvdelisle@gcc.gnu.org>\n \n \tPR fortran/69043"}, {"sha": "309baf1c69ecbab9d34b9fa86a1a9cd5e1bfaa1f", "filename": "gcc/fortran/trans-decl.c", "status": "modified", "additions": 14, "deletions": 0, "changes": 14, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/0daa7ed9447c71f2a1c1311729f840c36d0a558d/gcc%2Ffortran%2Ftrans-decl.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/0daa7ed9447c71f2a1c1311729f840c36d0a558d/gcc%2Ffortran%2Ftrans-decl.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ffortran%2Ftrans-decl.c?ref=0daa7ed9447c71f2a1c1311729f840c36d0a558d", "patch": "@@ -137,6 +137,8 @@ tree gfor_fndecl_caf_sendget;\n tree gfor_fndecl_caf_sync_all;\n tree gfor_fndecl_caf_sync_memory;\n tree gfor_fndecl_caf_sync_images;\n+tree gfor_fndecl_caf_stop_str;\n+tree gfor_fndecl_caf_stop_numeric;\n tree gfor_fndecl_caf_error_stop;\n tree gfor_fndecl_caf_error_stop_str;\n tree gfor_fndecl_caf_atomic_def;\n@@ -3550,6 +3552,18 @@ gfc_build_builtin_function_decls (void)\n       /* CAF's ERROR STOP doesn't return.  */\n       TREE_THIS_VOLATILE (gfor_fndecl_caf_error_stop_str) = 1;\n \n+      gfor_fndecl_caf_stop_numeric = gfc_build_library_function_decl_with_spec (\n+        get_identifier (PREFIX(\"caf_stop_numeric\")), \".R.\",\n+        void_type_node, 1, gfc_int4_type_node);\n+      /* CAF's STOP doesn't return.  */\n+      TREE_THIS_VOLATILE (gfor_fndecl_caf_stop_numeric) = 1;\n+\n+      gfor_fndecl_caf_stop_str = gfc_build_library_function_decl_with_spec (\n+        get_identifier (PREFIX(\"caf_stop_str\")), \".R.\",\n+        void_type_node, 2, pchar_type_node, gfc_int4_type_node);\n+      /* CAF's STOP doesn't return.  */\n+      TREE_THIS_VOLATILE (gfor_fndecl_caf_stop_str) = 1;\n+\n       gfor_fndecl_caf_atomic_def = gfc_build_library_function_decl_with_spec (\n \tget_identifier (PREFIX(\"caf_atomic_define\")), \"R..RW\",\n \tvoid_type_node, 7, pvoid_type_node, size_type_node, integer_type_node,"}, {"sha": "2fc43eddbe5f86d3cf203ba11107011e7850b817", "filename": "gcc/fortran/trans-stmt.c", "status": "modified", "additions": 9, "deletions": 3, "changes": 12, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/0daa7ed9447c71f2a1c1311729f840c36d0a558d/gcc%2Ffortran%2Ftrans-stmt.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/0daa7ed9447c71f2a1c1311729f840c36d0a558d/gcc%2Ffortran%2Ftrans-stmt.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ffortran%2Ftrans-stmt.c?ref=0daa7ed9447c71f2a1c1311729f840c36d0a558d", "patch": "@@ -635,7 +635,9 @@ gfc_trans_stop (gfc_code *code, bool error_stop)\n \t\t\t\t ? (flag_coarray == GFC_FCOARRAY_LIB\n \t\t\t\t    ? gfor_fndecl_caf_error_stop_str\n \t\t\t\t    : gfor_fndecl_error_stop_string)\n-\t\t\t\t : gfor_fndecl_stop_string,\n+\t\t\t\t : (flag_coarray == GFC_FCOARRAY_LIB\n+\t\t\t\t    ? gfor_fndecl_caf_stop_str\n+\t\t\t\t    : gfor_fndecl_stop_string),\n \t\t\t\t 2, build_int_cst (pchar_type_node, 0), tmp);\n     }\n   else if (code->expr1->ts.type == BT_INTEGER)\n@@ -646,7 +648,9 @@ gfc_trans_stop (gfc_code *code, bool error_stop)\n \t\t\t\t ? (flag_coarray == GFC_FCOARRAY_LIB\n \t\t\t\t    ? gfor_fndecl_caf_error_stop\n \t\t\t\t    : gfor_fndecl_error_stop_numeric)\n-\t\t\t\t : gfor_fndecl_stop_numeric_f08, 1,\n+\t\t\t\t : (flag_coarray == GFC_FCOARRAY_LIB\n+\t\t\t\t    ? gfor_fndecl_caf_stop_numeric\n+\t\t\t\t    : gfor_fndecl_stop_numeric_f08), 1,\n \t\t\t\t fold_convert (gfc_int4_type_node, se.expr));\n     }\n   else\n@@ -657,7 +661,9 @@ gfc_trans_stop (gfc_code *code, bool error_stop)\n \t\t\t\t ? (flag_coarray == GFC_FCOARRAY_LIB\n \t\t\t\t    ? gfor_fndecl_caf_error_stop_str\n \t\t\t\t    : gfor_fndecl_error_stop_string)\n-\t\t\t\t : gfor_fndecl_stop_string,\n+\t\t\t\t : (flag_coarray == GFC_FCOARRAY_LIB\n+\t\t\t\t    ? gfor_fndecl_caf_stop_str\n+\t\t\t\t    : gfor_fndecl_stop_string),\n \t\t\t\t 2, se.expr, se.string_length);\n     }\n "}, {"sha": "add0ceaa3db93e264ea6a3139eb86414a04d45a0", "filename": "gcc/fortran/trans.h", "status": "modified", "additions": 2, "deletions": 0, "changes": 2, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/0daa7ed9447c71f2a1c1311729f840c36d0a558d/gcc%2Ffortran%2Ftrans.h", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/0daa7ed9447c71f2a1c1311729f840c36d0a558d/gcc%2Ffortran%2Ftrans.h", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ffortran%2Ftrans.h?ref=0daa7ed9447c71f2a1c1311729f840c36d0a558d", "patch": "@@ -762,6 +762,8 @@ extern GTY(()) tree gfor_fndecl_caf_sendget;\n extern GTY(()) tree gfor_fndecl_caf_sync_all;\n extern GTY(()) tree gfor_fndecl_caf_sync_memory;\n extern GTY(()) tree gfor_fndecl_caf_sync_images;\n+extern GTY(()) tree gfor_fndecl_caf_stop_numeric;\n+extern GTY(()) tree gfor_fndecl_caf_stop_str;\n extern GTY(()) tree gfor_fndecl_caf_error_stop;\n extern GTY(()) tree gfor_fndecl_caf_error_stop_str;\n extern GTY(()) tree gfor_fndecl_caf_atomic_def;"}, {"sha": "6a742b505971999f59606a9bdf036e8612b43b85", "filename": "libgfortran/ChangeLog", "status": "modified", "additions": 6, "deletions": 0, "changes": 6, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/0daa7ed9447c71f2a1c1311729f840c36d0a558d/libgfortran%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/0daa7ed9447c71f2a1c1311729f840c36d0a558d/libgfortran%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libgfortran%2FChangeLog?ref=0daa7ed9447c71f2a1c1311729f840c36d0a558d", "patch": "@@ -1,3 +1,9 @@\n+2016-03-28  Alessandro Fanfarillo  <fanfarillo.gcc@gmail.com>\n+\n+\t* caf/libcaf.h: caf_stop_numeric and caf_stop_str prototype.\n+\t* caf/single.c: _gfortran_caf_stop_numeric and\n+\t_gfortran_caf_stop_str implementation.\n+\n 2016-02-23  Jerry DeLisle  <jvdelisle@gcc.gnu.org>\n \n \tPR libgfortran/69456"}, {"sha": "01a33f9d0ee9f88727f52be86f914047a7068502", "filename": "libgfortran/caf/libcaf.h", "status": "modified", "additions": 4, "deletions": 0, "changes": 4, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/0daa7ed9447c71f2a1c1311729f840c36d0a558d/libgfortran%2Fcaf%2Flibcaf.h", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/0daa7ed9447c71f2a1c1311729f840c36d0a558d/libgfortran%2Fcaf%2Flibcaf.h", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libgfortran%2Fcaf%2Flibcaf.h?ref=0daa7ed9447c71f2a1c1311729f840c36d0a558d", "patch": "@@ -105,6 +105,10 @@ void _gfortran_caf_sync_all (int *, char *, int);\n void _gfortran_caf_sync_memory (int *, char *, int);\n void _gfortran_caf_sync_images (int, int[], int *, char *, int);\n \n+void _gfortran_caf_stop_numeric (int32_t)\n+     __attribute__ ((noreturn));\n+void _gfortran_caf_stop_str (const char *, int32_t)\n+     __attribute__ ((noreturn));\n void _gfortran_caf_error_stop_str (const char *, int32_t)\n      __attribute__ ((noreturn));\n void _gfortran_caf_error_stop (int32_t) __attribute__ ((noreturn));"}, {"sha": "f726537e7884ee19f52e3f0c83fdbbfb65cc0e3c", "filename": "libgfortran/caf/single.c", "status": "modified", "additions": 17, "deletions": 0, "changes": 17, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/0daa7ed9447c71f2a1c1311729f840c36d0a558d/libgfortran%2Fcaf%2Fsingle.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/0daa7ed9447c71f2a1c1311729f840c36d0a558d/libgfortran%2Fcaf%2Fsingle.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libgfortran%2Fcaf%2Fsingle.c?ref=0daa7ed9447c71f2a1c1311729f840c36d0a558d", "patch": "@@ -204,6 +204,23 @@ _gfortran_caf_sync_images (int count __attribute__ ((unused)),\n     *stat = 0;\n }\n \n+void\n+_gfortran_caf_stop_numeric(int32_t stop_code)\n+{\n+  fprintf (stderr, \"STOP %d\\n\", stop_code);\n+  exit (0);\n+}\n+\n+void\n+_gfortran_caf_stop_str(const char *string, int32_t len)\n+{\n+  fputs (\"STOP \", stderr);\n+  while (len--)\n+    fputc (*(string++), stderr);\n+  fputs (\"\\n\", stderr);\n+\n+  exit (0);\n+}\n \n void\n _gfortran_caf_error_stop_str (const char *string, int32_t len)"}]}