{"sha": "149d6f9edd9430452e81bde4f6e611f5e81c9f2e", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6MTQ5ZDZmOWVkZDk0MzA0NTJlODFiZGU0ZjZlNjExZjVlODFjOWYyZQ==", "commit": {"author": {"name": "Jakub Jelinek", "email": "jakub@redhat.com", "date": "2002-02-20T23:19:24Z"}, "committer": {"name": "Jakub Jelinek", "email": "jakub@gcc.gnu.org", "date": "2002-02-20T23:19:24Z"}, "message": "re PR debug/4461 (Invalid dawrf2 debug code)\n\n\tPR debug/4461\n\t* varasm.c (get_pool_constant_mark): New.\n\t* rtl.h (get_pool_constant_mark): Add prototype.\n\t* dwarf2out.c (mem_loc_descriptor): A pool constant cannot\n\tbe represented if it has not been output.\n\n\t* gcc.dg/debug/20020220-1.c: New test.\n\nFrom-SVN: r49921", "tree": {"sha": "d49e4ee1337f2fdce87409b5a2a0ec6e2c56a37b", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/d49e4ee1337f2fdce87409b5a2a0ec6e2c56a37b"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/149d6f9edd9430452e81bde4f6e611f5e81c9f2e", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/149d6f9edd9430452e81bde4f6e611f5e81c9f2e", "html_url": "https://github.com/Rust-GCC/gccrs/commit/149d6f9edd9430452e81bde4f6e611f5e81c9f2e", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/149d6f9edd9430452e81bde4f6e611f5e81c9f2e/comments", "author": {"login": "jakubjelinek", "id": 9370665, "node_id": "MDQ6VXNlcjkzNzA2NjU=", "avatar_url": "https://avatars.githubusercontent.com/u/9370665?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jakubjelinek", "html_url": "https://github.com/jakubjelinek", "followers_url": "https://api.github.com/users/jakubjelinek/followers", "following_url": "https://api.github.com/users/jakubjelinek/following{/other_user}", "gists_url": "https://api.github.com/users/jakubjelinek/gists{/gist_id}", "starred_url": "https://api.github.com/users/jakubjelinek/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jakubjelinek/subscriptions", "organizations_url": "https://api.github.com/users/jakubjelinek/orgs", "repos_url": "https://api.github.com/users/jakubjelinek/repos", "events_url": "https://api.github.com/users/jakubjelinek/events{/privacy}", "received_events_url": "https://api.github.com/users/jakubjelinek/received_events", "type": "User", "site_admin": false}, "committer": null, "parents": [{"sha": "4161da12190d52eb1d622354e6ea67f67195c73c", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/4161da12190d52eb1d622354e6ea67f67195c73c", "html_url": "https://github.com/Rust-GCC/gccrs/commit/4161da12190d52eb1d622354e6ea67f67195c73c"}], "stats": {"total": 73, "additions": 71, "deletions": 2}, "files": [{"sha": "7abdd710fb03adfc557ab7de57601546db8f8822", "filename": "gcc/ChangeLog", "status": "modified", "additions": 8, "deletions": 0, "changes": 8, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/149d6f9edd9430452e81bde4f6e611f5e81c9f2e/gcc%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/149d6f9edd9430452e81bde4f6e611f5e81c9f2e/gcc%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2FChangeLog?ref=149d6f9edd9430452e81bde4f6e611f5e81c9f2e", "patch": "@@ -1,3 +1,11 @@\n+2002-02-20  Jakub Jelinek  <jakub@redhat.com>\n+\n+\tPR debug/4461\n+\t* varasm.c (get_pool_constant_mark): New.\n+\t* rtl.h (get_pool_constant_mark): Add prototype.\n+\t* dwarf2out.c (mem_loc_descriptor): A pool constant cannot\n+\tbe represented if it has not been output.\n+\n 2002-02-20  Alexandre Oliva  <aoliva@redhat.com>\n \n \t* combine.c (do_SUBST): Sanity check substitutions of"}, {"sha": "f51df45d77bd2f012807ad18db92753cc3ad7b97", "filename": "gcc/dwarf2out.c", "status": "modified", "additions": 16, "deletions": 2, "changes": 18, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/149d6f9edd9430452e81bde4f6e611f5e81c9f2e/gcc%2Fdwarf2out.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/149d6f9edd9430452e81bde4f6e611f5e81c9f2e/gcc%2Fdwarf2out.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fdwarf2out.c?ref=149d6f9edd9430452e81bde4f6e611f5e81c9f2e", "patch": "@@ -7801,10 +7801,24 @@ mem_loc_descriptor (rtl, mode)\n \t by a different symbol.  */\n       if (GET_CODE (rtl) == SYMBOL_REF && CONSTANT_POOL_ADDRESS_P (rtl))\n \t{\n-\t  rtx tmp = get_pool_constant (rtl);\n+\t  bool marked;\n+\t  rtx tmp = get_pool_constant_mark (rtl, &marked);\n \n \t  if (GET_CODE (tmp) == SYMBOL_REF)\n-\t    rtl = tmp;\n+\t    {\n+\t      rtl = tmp;\n+\t      if (CONSTANT_POOL_ADDRESS_P (tmp))\n+\t\tget_pool_constant_mark (tmp, &marked);\n+\t      else\n+\t\tmarked = true;\n+\t    }\n+\n+\t  /* If all references to this pool constant were optimized away,\n+\t     it was not output and thus we can't represent it.\n+\t     FIXME: might try to use DW_OP_const_value here, though\n+\t     DW_OP_piece complicates it.  */\n+\t  if (!marked)\n+\t    return 0;\n \t}\n \n       mem_loc_result = new_loc_descr (DW_OP_addr, 0, 0);"}, {"sha": "c5b3397a355b70e4d2e61ce4ad2af9c12db2c029", "filename": "gcc/rtl.h", "status": "modified", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/149d6f9edd9430452e81bde4f6e611f5e81c9f2e/gcc%2Frtl.h", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/149d6f9edd9430452e81bde4f6e611f5e81c9f2e/gcc%2Frtl.h", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Frtl.h?ref=149d6f9edd9430452e81bde4f6e611f5e81c9f2e", "patch": "@@ -1301,6 +1301,7 @@ extern rtx force_const_mem\t\tPARAMS ((enum machine_mode, rtx));\n \n /* In varasm.c  */\n extern rtx get_pool_constant\t\tPARAMS ((rtx));\n+extern rtx get_pool_constant_mark\tPARAMS ((rtx, bool *));\n extern enum machine_mode get_pool_mode\tPARAMS ((rtx));\n extern rtx get_pool_constant_for_function\tPARAMS ((struct function *, rtx));\n extern enum machine_mode get_pool_mode_for_function\tPARAMS ((struct function *, rtx));"}, {"sha": "a6653596fa66d0df012612ba4d7a653d67524949", "filename": "gcc/testsuite/ChangeLog", "status": "modified", "additions": 2, "deletions": 0, "changes": 2, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/149d6f9edd9430452e81bde4f6e611f5e81c9f2e/gcc%2Ftestsuite%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/149d6f9edd9430452e81bde4f6e611f5e81c9f2e/gcc%2Ftestsuite%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2FChangeLog?ref=149d6f9edd9430452e81bde4f6e611f5e81c9f2e", "patch": "@@ -12,6 +12,8 @@\n \n \t* g++.dg/opt/ptrintsum1.C: New test.\n \n+\t* gcc.dg/debug/20020220-1.c: New test.\n+\n 2002-02-17  Jakub Jelinek  <jakub@redhat.com>\n \n \t* gcc.c-torture/execute/20020216-1.c: New test."}, {"sha": "07109e86a985a61b370f7ed9e6da05683d49f925", "filename": "gcc/testsuite/gcc.dg/debug/20020220-1.c", "status": "added", "additions": 31, "deletions": 0, "changes": 31, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/149d6f9edd9430452e81bde4f6e611f5e81c9f2e/gcc%2Ftestsuite%2Fgcc.dg%2Fdebug%2F20020220-1.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/149d6f9edd9430452e81bde4f6e611f5e81c9f2e/gcc%2Ftestsuite%2Fgcc.dg%2Fdebug%2F20020220-1.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgcc.dg%2Fdebug%2F20020220-1.c?ref=149d6f9edd9430452e81bde4f6e611f5e81c9f2e", "patch": "@@ -0,0 +1,31 @@\n+/* PR debug/4461\n+   This testcase failed to link in Dwarf-2 because\n+   constant -4.0 in constant pool was never referenced by anything\n+   but Dwarf-2 location descriptor.  */\n+/* { dg-do run } */\n+\n+void __attribute__((noinline))\n+foo (const char *x __attribute__((unused)),\n+     __complex__ long double y __attribute__((unused)),\n+     __complex__ long double z __attribute__((unused)))\n+{\n+}\n+\n+void\n+bar (void)\n+{\n+  foo (\"\",\n+       __builtin_conjl (({ __complex__ long double r;\n+\t\t\t   __real__ r = 3.0;\n+\t\t\t   __imag__ r = -4.0;\n+\t\t\t   r; })),\n+       ({ __complex__ long double s;\n+\t  __real__ s = 3.0;\n+\t  __imag__ s = 4.0;\n+\t  s; }));\n+}\n+\n+int main (void)\n+{\n+  return 0;\n+}"}, {"sha": "46810c6833f4abda1589b534d9da82043132e117", "filename": "gcc/varasm.c", "status": "modified", "additions": 13, "deletions": 0, "changes": 13, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/149d6f9edd9430452e81bde4f6e611f5e81c9f2e/gcc%2Fvarasm.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/149d6f9edd9430452e81bde4f6e611f5e81c9f2e/gcc%2Fvarasm.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fvarasm.c?ref=149d6f9edd9430452e81bde4f6e611f5e81c9f2e", "patch": "@@ -3900,6 +3900,19 @@ get_pool_constant (addr)\n   return (find_pool_constant (cfun, addr))->constant;\n }\n \n+/* Given a constant pool SYMBOL_REF, return the corresponding constant\n+   and whether it has been output or not.  */\n+\n+rtx\n+get_pool_constant_mark (addr, pmarked)\n+     rtx addr;\n+     bool *pmarked;\n+{\n+  struct pool_constant *pool = find_pool_constant (cfun, addr);\n+  *pmarked = (pool->mark != 0);\n+  return pool->constant;\n+}\n+\n /* Likewise, but for the constant pool of a specific function.  */\n \n rtx"}]}