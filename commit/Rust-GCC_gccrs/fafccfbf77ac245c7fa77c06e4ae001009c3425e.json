{"sha": "fafccfbf77ac245c7fa77c06e4ae001009c3425e", "node_id": "C_kwDOANBUbNoAKGZhZmNjZmJmNzdhYzI0NWM3ZmE3N2MwNmU0YWUwMDEwMDljMzQyNWU", "commit": {"author": {"name": "Javier Miranda", "email": "miranda@adacore.com", "date": "2022-02-06T11:23:53Z"}, "committer": {"name": "Pierre-Marie de Rodat", "email": "derodat@adacore.com", "date": "2022-05-13T08:04:33Z"}, "message": "[Ada] Crash in task body reference to discriminant\n\nThe compiler may crash processing the successor or predecessor of a task\ntype discrete discriminant.\n\ngcc/ada/\n\n\t* sem_attr.adb (Resolve_Attribute): Ensure that attribute\n\texpressions are resolved at this stage; required for preanalyzed\n\treferences to discriminants since their resolution (and\n\texpansion) will take care of updating their Entity attribute to\n\treference their discriminal.", "tree": {"sha": "35fcb6faa4bb449666c2bc9485e88b15f5573009", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/35fcb6faa4bb449666c2bc9485e88b15f5573009"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/fafccfbf77ac245c7fa77c06e4ae001009c3425e", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/fafccfbf77ac245c7fa77c06e4ae001009c3425e", "html_url": "https://github.com/Rust-GCC/gccrs/commit/fafccfbf77ac245c7fa77c06e4ae001009c3425e", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/fafccfbf77ac245c7fa77c06e4ae001009c3425e/comments", "author": {"login": "miranda-adacore", "id": 54413934, "node_id": "MDQ6VXNlcjU0NDEzOTM0", "avatar_url": "https://avatars.githubusercontent.com/u/54413934?v=4", "gravatar_id": "", "url": "https://api.github.com/users/miranda-adacore", "html_url": "https://github.com/miranda-adacore", "followers_url": "https://api.github.com/users/miranda-adacore/followers", "following_url": "https://api.github.com/users/miranda-adacore/following{/other_user}", "gists_url": "https://api.github.com/users/miranda-adacore/gists{/gist_id}", "starred_url": "https://api.github.com/users/miranda-adacore/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/miranda-adacore/subscriptions", "organizations_url": "https://api.github.com/users/miranda-adacore/orgs", "repos_url": "https://api.github.com/users/miranda-adacore/repos", "events_url": "https://api.github.com/users/miranda-adacore/events{/privacy}", "received_events_url": "https://api.github.com/users/miranda-adacore/received_events", "type": "User", "site_admin": false}, "committer": {"login": "pmderodat", "id": 758452, "node_id": "MDQ6VXNlcjc1ODQ1Mg==", "avatar_url": "https://avatars.githubusercontent.com/u/758452?v=4", "gravatar_id": "", "url": "https://api.github.com/users/pmderodat", "html_url": "https://github.com/pmderodat", "followers_url": "https://api.github.com/users/pmderodat/followers", "following_url": "https://api.github.com/users/pmderodat/following{/other_user}", "gists_url": "https://api.github.com/users/pmderodat/gists{/gist_id}", "starred_url": "https://api.github.com/users/pmderodat/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/pmderodat/subscriptions", "organizations_url": "https://api.github.com/users/pmderodat/orgs", "repos_url": "https://api.github.com/users/pmderodat/repos", "events_url": "https://api.github.com/users/pmderodat/events{/privacy}", "received_events_url": "https://api.github.com/users/pmderodat/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "6a28d40dc4dd47431cc52edbb8b1994f81aa1748", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/6a28d40dc4dd47431cc52edbb8b1994f81aa1748", "html_url": "https://github.com/Rust-GCC/gccrs/commit/6a28d40dc4dd47431cc52edbb8b1994f81aa1748"}], "stats": {"total": 22, "additions": 22, "deletions": 0}, "files": [{"sha": "55da9ef73f2b3d19a6fcdec1ada437ad5f3c7403", "filename": "gcc/ada/sem_attr.adb", "status": "modified", "additions": 22, "deletions": 0, "changes": 22, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/fafccfbf77ac245c7fa77c06e4ae001009c3425e/gcc%2Fada%2Fsem_attr.adb", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/fafccfbf77ac245c7fa77c06e4ae001009c3425e/gcc%2Fada%2Fsem_attr.adb", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fada%2Fsem_attr.adb?ref=fafccfbf77ac245c7fa77c06e4ae001009c3425e", "patch": "@@ -12500,6 +12500,28 @@ package body Sem_Attr is\n                when others => null;\n             end case;\n \n+            --  Ensure that attribute expressions are resolved at this stage;\n+            --  required for preanalyzed references to discriminants since\n+            --  their resolution (and expansion) will take care of updating\n+            --  their Entity attribute to reference their discriminal.\n+\n+            if Expander_Active\n+              and then Present (Expressions (N))\n+            then\n+               declare\n+                  Expr : Node_Id := First (Expressions (N));\n+\n+               begin\n+                  while Present (Expr) loop\n+                     if not Analyzed (Expr) then\n+                        Resolve (Expr, Etype (Expr));\n+                     end if;\n+\n+                     Next (Expr);\n+                  end loop;\n+               end;\n+            end if;\n+\n             --  If the prefix of the attribute is a class-wide type then it\n             --  will be expanded into a dispatching call to a predefined\n             --  primitive. Therefore we must check for potential violation"}]}