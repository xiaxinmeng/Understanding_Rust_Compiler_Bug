{"sha": "99be38ec6a484b92940c2d415e14db33ebfb19bc", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6OTliZTM4ZWM2YTQ4NGI5Mjk0MGMyZDQxNWUxNGRiMzNlYmZiMTliYw==", "commit": {"author": {"name": "Jason Merrill", "email": "jason@redhat.com", "date": "2017-02-03T19:44:21Z"}, "committer": {"name": "Jason Merrill", "email": "jason@gcc.gnu.org", "date": "2017-02-03T19:44:21Z"}, "message": "PR c++/79294 - ICE with invalid template argument\n\n\t* pt.c (convert_nontype_argument_function): Check value-dependence.\n\t(convert_nontype_argument): Don't check it here for function ptrs.\n\nFrom-SVN: r245168", "tree": {"sha": "e8b2d429ae4e5e7f849bd9e5d2b838cecf0f8668", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/e8b2d429ae4e5e7f849bd9e5d2b838cecf0f8668"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/99be38ec6a484b92940c2d415e14db33ebfb19bc", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/99be38ec6a484b92940c2d415e14db33ebfb19bc", "html_url": "https://github.com/Rust-GCC/gccrs/commit/99be38ec6a484b92940c2d415e14db33ebfb19bc", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/99be38ec6a484b92940c2d415e14db33ebfb19bc/comments", "author": {"login": "jicama", "id": 266146, "node_id": "MDQ6VXNlcjI2NjE0Ng==", "avatar_url": "https://avatars.githubusercontent.com/u/266146?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jicama", "html_url": "https://github.com/jicama", "followers_url": "https://api.github.com/users/jicama/followers", "following_url": "https://api.github.com/users/jicama/following{/other_user}", "gists_url": "https://api.github.com/users/jicama/gists{/gist_id}", "starred_url": "https://api.github.com/users/jicama/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jicama/subscriptions", "organizations_url": "https://api.github.com/users/jicama/orgs", "repos_url": "https://api.github.com/users/jicama/repos", "events_url": "https://api.github.com/users/jicama/events{/privacy}", "received_events_url": "https://api.github.com/users/jicama/received_events", "type": "User", "site_admin": false}, "committer": null, "parents": [{"sha": "10613537a958bf1e73679e93f92e7e1032738b47", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/10613537a958bf1e73679e93f92e7e1032738b47", "html_url": "https://github.com/Rust-GCC/gccrs/commit/10613537a958bf1e73679e93f92e7e1032738b47"}], "stats": {"total": 20, "additions": 16, "deletions": 4}, "files": [{"sha": "8f65db5b357637634fa136423d3afd3ffd4e2412", "filename": "gcc/cp/ChangeLog", "status": "modified", "additions": 6, "deletions": 0, "changes": 6, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/99be38ec6a484b92940c2d415e14db33ebfb19bc/gcc%2Fcp%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/99be38ec6a484b92940c2d415e14db33ebfb19bc/gcc%2Fcp%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fcp%2FChangeLog?ref=99be38ec6a484b92940c2d415e14db33ebfb19bc", "patch": "@@ -1,3 +1,9 @@\n+2017-02-03  Jason Merrill  <jason@redhat.com>\n+\n+\tPR c++/79294 - ICE with invalid template argument\n+\t* pt.c (convert_nontype_argument_function): Check value-dependence.\n+\t(convert_nontype_argument): Don't check it here for function ptrs.\n+\n 2017-02-02  Richard Biener  <rguenther@suse.de>\n \n \tPR cp/14179"}, {"sha": "4c4941a88aa43103cca91d11ddf5c20d76fa67ec", "filename": "gcc/cp/pt.c", "status": "modified", "additions": 5, "deletions": 4, "changes": 9, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/99be38ec6a484b92940c2d415e14db33ebfb19bc/gcc%2Fcp%2Fpt.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/99be38ec6a484b92940c2d415e14db33ebfb19bc/gcc%2Fcp%2Fpt.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fcp%2Fpt.c?ref=99be38ec6a484b92940c2d415e14db33ebfb19bc", "patch": "@@ -5966,6 +5966,9 @@ convert_nontype_argument_function (tree type, tree expr,\n   if (fn == error_mark_node)\n     return error_mark_node;\n \n+  if (value_dependent_expression_p (fn))\n+    return fn;\n+\n   fn_no_ptr = strip_fnptr_conv (fn);\n   if (TREE_CODE (fn_no_ptr) == ADDR_EXPR)\n     fn_no_ptr = TREE_OPERAND (fn_no_ptr, 0);\n@@ -6698,8 +6701,7 @@ convert_nontype_argument (tree type, tree expr, tsubst_flags_t complain)\n \t/* Null pointer values are OK in C++11.  */\n \treturn perform_qualification_conversions (type, expr);\n \n-      if (!value_dependent_expression_p (expr))\n-\texpr = convert_nontype_argument_function (type, expr, complain);\n+      expr = convert_nontype_argument_function (type, expr, complain);\n       if (!expr || expr == error_mark_node)\n \treturn expr;\n     }\n@@ -6723,8 +6725,7 @@ convert_nontype_argument (tree type, tree expr, tsubst_flags_t complain)\n \t  return NULL_TREE;\n \t}\n \n-      if (!value_dependent_expression_p (expr))\n-\texpr = convert_nontype_argument_function (type, expr, complain);\n+      expr = convert_nontype_argument_function (type, expr, complain);\n       if (!expr || expr == error_mark_node)\n \treturn expr;\n     }"}, {"sha": "f67e0a6fa630dd74c3e46c59038ecef371d234d0", "filename": "gcc/testsuite/g++.dg/template/error57.C", "status": "added", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/99be38ec6a484b92940c2d415e14db33ebfb19bc/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Ftemplate%2Ferror57.C", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/99be38ec6a484b92940c2d415e14db33ebfb19bc/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Ftemplate%2Ferror57.C", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Ftemplate%2Ferror57.C?ref=99be38ec6a484b92940c2d415e14db33ebfb19bc", "patch": "@@ -0,0 +1,5 @@\n+// PR c++/79294\n+\n+template <int()> struct a;\n+template <int(b)> a < b\t\t// { dg-error \"int\" }\n+// { dg-error \"expected\" \"\" { target *-*-* } .-1 }"}]}