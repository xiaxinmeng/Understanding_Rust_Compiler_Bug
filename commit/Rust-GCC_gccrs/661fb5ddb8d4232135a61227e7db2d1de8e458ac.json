{"sha": "661fb5ddb8d4232135a61227e7db2d1de8e458ac", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6NjYxZmI1ZGRiOGQ0MjMyMTM1YTYxMjI3ZTdkYjJkMWRlOGU0NThhYw==", "commit": {"author": {"name": "Jakub Jelinek", "email": "jakub@redhat.com", "date": "2014-10-03T07:27:50Z"}, "committer": {"name": "Jakub Jelinek", "email": "jakub@gcc.gnu.org", "date": "2014-10-03T07:27:50Z"}, "message": "re PR target/62128 (Use vpalignr for AVX2 rotation)\n\n\tPR target/62128\n\t* config/i386/i386.c (expand_vec_perm_palignr): If op1, op0 order\n\tof palignr arguments can't be used due to min 0 or max - min\n\ttoo high, try also op0, op1 order of palignr arguments.\n\n\t* gcc.dg/torture/vshuf-16.inc (TESTS): Add 2 new permutations.\n\t* gcc.dg/torture/vshuf-32.inc (TESTS): Add 5 new permutations.\n\nFrom-SVN: r215834", "tree": {"sha": "21c8bb26b44517d40c368eceedb41b0db6841c7b", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/21c8bb26b44517d40c368eceedb41b0db6841c7b"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/661fb5ddb8d4232135a61227e7db2d1de8e458ac", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/661fb5ddb8d4232135a61227e7db2d1de8e458ac", "html_url": "https://github.com/Rust-GCC/gccrs/commit/661fb5ddb8d4232135a61227e7db2d1de8e458ac", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/661fb5ddb8d4232135a61227e7db2d1de8e458ac/comments", "author": {"login": "jakubjelinek", "id": 9370665, "node_id": "MDQ6VXNlcjkzNzA2NjU=", "avatar_url": "https://avatars.githubusercontent.com/u/9370665?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jakubjelinek", "html_url": "https://github.com/jakubjelinek", "followers_url": "https://api.github.com/users/jakubjelinek/followers", "following_url": "https://api.github.com/users/jakubjelinek/following{/other_user}", "gists_url": "https://api.github.com/users/jakubjelinek/gists{/gist_id}", "starred_url": "https://api.github.com/users/jakubjelinek/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jakubjelinek/subscriptions", "organizations_url": "https://api.github.com/users/jakubjelinek/orgs", "repos_url": "https://api.github.com/users/jakubjelinek/repos", "events_url": "https://api.github.com/users/jakubjelinek/events{/privacy}", "received_events_url": "https://api.github.com/users/jakubjelinek/received_events", "type": "User", "site_admin": false}, "committer": null, "parents": [{"sha": "4081ada2c7ae718f509dc403f83a4a08f2a6fe4a", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/4081ada2c7ae718f509dc403f83a4a08f2a6fe4a", "html_url": "https://github.com/Rust-GCC/gccrs/commit/4081ada2c7ae718f509dc403f83a4a08f2a6fe4a"}], "stats": {"total": 71, "additions": 60, "deletions": 11}, "files": [{"sha": "a650ecf720e48f32ceb44bd8a549619f4460ffc7", "filename": "gcc/ChangeLog", "status": "modified", "additions": 7, "deletions": 0, "changes": 7, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/661fb5ddb8d4232135a61227e7db2d1de8e458ac/gcc%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/661fb5ddb8d4232135a61227e7db2d1de8e458ac/gcc%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2FChangeLog?ref=661fb5ddb8d4232135a61227e7db2d1de8e458ac", "patch": "@@ -1,3 +1,10 @@\n+2014-10-03  Jakub Jelinek  <jakub@redhat.com>\n+\n+\tPR target/62128\n+\t* config/i386/i386.c (expand_vec_perm_palignr): If op1, op0 order\n+\tof palignr arguments can't be used due to min 0 or max - min\n+\ttoo high, try also op0, op1 order of palignr arguments.\n+\n 2014-10-02  Jan Hubicka  <hubicka@ucw.cz>\n \n \t* cgraph.h (ipa_polymorphic_call_context):"}, {"sha": "c4f97c05b9976ecf3d739a7e5e462b78cc8a1324", "filename": "gcc/config/i386/i386.c", "status": "modified", "additions": 38, "deletions": 9, "changes": 47, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/661fb5ddb8d4232135a61227e7db2d1de8e458ac/gcc%2Fconfig%2Fi386%2Fi386.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/661fb5ddb8d4232135a61227e7db2d1de8e458ac/gcc%2Fconfig%2Fi386%2Fi386.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fconfig%2Fi386%2Fi386.c?ref=661fb5ddb8d4232135a61227e7db2d1de8e458ac", "patch": "@@ -43298,8 +43298,8 @@ static bool\n expand_vec_perm_palignr (struct expand_vec_perm_d *d, bool single_insn_only_p)\n {\n   unsigned i, nelt = d->nelt;\n-  unsigned min, max;\n-  bool in_order, ok;\n+  unsigned min, max, minswap, maxswap;\n+  bool in_order, ok, swap = false;\n   rtx shift, target;\n   struct expand_vec_perm_d dcopy;\n \n@@ -43309,20 +43309,40 @@ expand_vec_perm_palignr (struct expand_vec_perm_d *d, bool single_insn_only_p)\n       && (!TARGET_AVX2 || GET_MODE_SIZE (d->vmode) != 32))\n     return false;\n \n-  min = 2 * nelt, max = 0;\n+  min = 2 * nelt;\n+  max = 0;\n+  minswap = 2 * nelt;\n+  maxswap = 0;\n   for (i = 0; i < nelt; ++i)\n     {\n       unsigned e = d->perm[i];\n+      unsigned eswap = d->perm[i] ^ nelt;\n       if (GET_MODE_SIZE (d->vmode) == 32)\n-\te = (e & ((nelt / 2) - 1)) | ((e & nelt) >> 1);\n+\t{\n+\t  e = (e & ((nelt / 2) - 1)) | ((e & nelt) >> 1);\n+\t  eswap = e ^ (nelt / 2);\n+\t}\n       if (e < min)\n \tmin = e;\n       if (e > max)\n \tmax = e;\n+      if (eswap < minswap)\n+\tminswap = eswap;\n+      if (eswap > maxswap)\n+\tmaxswap = eswap;\n     }\n   if (min == 0\n       || max - min >= (GET_MODE_SIZE (d->vmode) == 32 ? nelt / 2 : nelt))\n-    return false;\n+    {\n+      if (d->one_operand_p\n+\t  || minswap == 0\n+\t  || maxswap - minswap >= (GET_MODE_SIZE (d->vmode) == 32\n+\t\t\t\t   ? nelt / 2 : nelt))\n+\treturn false;\n+      swap = true;\n+      min = minswap;\n+      max = maxswap;\n+    }\n \n   /* Given that we have SSSE3, we know we'll be able to implement the\n      single operand permutation after the palignr with pshufb for\n@@ -43332,6 +43352,13 @@ expand_vec_perm_palignr (struct expand_vec_perm_d *d, bool single_insn_only_p)\n     return true;\n \n   dcopy = *d;\n+  if (swap)\n+    {\n+      dcopy.op0 = d->op1;\n+      dcopy.op1 = d->op0;\n+      for (i = 0; i < nelt; ++i)\n+\tdcopy.perm[i] ^= nelt;\n+    }\n \n   in_order = true;\n   for (i = 0; i < nelt; ++i)\n@@ -43365,14 +43392,16 @@ expand_vec_perm_palignr (struct expand_vec_perm_d *d, bool single_insn_only_p)\n   if (GET_MODE_SIZE (d->vmode) == 16)\n     {\n       target = gen_reg_rtx (TImode);\n-      emit_insn (gen_ssse3_palignrti (target, gen_lowpart (TImode, d->op1),\n-\t\t\t\t      gen_lowpart (TImode, d->op0), shift));\n+      emit_insn (gen_ssse3_palignrti (target, gen_lowpart (TImode, dcopy.op1),\n+\t\t\t\t      gen_lowpart (TImode, dcopy.op0), shift));\n     }\n   else\n     {\n       target = gen_reg_rtx (V2TImode);\n-      emit_insn (gen_avx2_palignrv2ti (target, gen_lowpart (V2TImode, d->op1),\n-\t\t\t\t       gen_lowpart (V2TImode, d->op0), shift));\n+      emit_insn (gen_avx2_palignrv2ti (target,\n+\t\t\t\t       gen_lowpart (V2TImode, dcopy.op1),\n+\t\t\t\t       gen_lowpart (V2TImode, dcopy.op0),\n+\t\t\t\t       shift));\n     }\n \n   dcopy.op0 = dcopy.op1 = gen_lowpart (d->vmode, target);"}, {"sha": "abfc0bc59be3a6953e1bf2953b8388427c3b8cec", "filename": "gcc/testsuite/ChangeLog", "status": "modified", "additions": 6, "deletions": 0, "changes": 6, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/661fb5ddb8d4232135a61227e7db2d1de8e458ac/gcc%2Ftestsuite%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/661fb5ddb8d4232135a61227e7db2d1de8e458ac/gcc%2Ftestsuite%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2FChangeLog?ref=661fb5ddb8d4232135a61227e7db2d1de8e458ac", "patch": "@@ -1,3 +1,9 @@\n+2014-10-03  Jakub Jelinek  <jakub@redhat.com>\n+\n+\tPR target/62128\n+\t* gcc.dg/torture/vshuf-16.inc (TESTS): Add 2 new permutations.\n+\t* gcc.dg/torture/vshuf-32.inc (TESTS): Add 5 new permutations.\n+\n 2014-10-02  Edward Smith-Rowland  <3dw4rd@verizon.net>\n \n \t* g++.dg/cpp1y/feat-cxx98-neg.C: Fix double negative thinko and"}, {"sha": "84586892a45c9394a459e4d2577342e9a6e0bdf4", "filename": "gcc/testsuite/gcc.dg/torture/vshuf-16.inc", "status": "modified", "additions": 3, "deletions": 1, "changes": 4, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/661fb5ddb8d4232135a61227e7db2d1de8e458ac/gcc%2Ftestsuite%2Fgcc.dg%2Ftorture%2Fvshuf-16.inc", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/661fb5ddb8d4232135a61227e7db2d1de8e458ac/gcc%2Ftestsuite%2Fgcc.dg%2Ftorture%2Fvshuf-16.inc", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgcc.dg%2Ftorture%2Fvshuf-16.inc?ref=661fb5ddb8d4232135a61227e7db2d1de8e458ac", "patch": "@@ -23,7 +23,9 @@ T (19,\t15, 14, 13, 12, 11, 10, 9, 8, 7, 6, 5, 4, 3, 2, 1, 0) \\\n T (20,\t0, 16, 1, 17, 2, 18, 3, 19, 4, 20, 5, 21, 6, 22, 7, 23) \\\n T (21,\t8, 24, 9, 25, 10, 26, 11, 27, 12, 28, 13, 29, 14, 30, 15, 31) \\\n T (22,\t1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 0) \\\n-T (23,\t14, 13, 12, 11, 10, 9, 8, 7, 6, 5, 4, 3, 2, 1, 0, 15)\n+T (23,\t14, 13, 12, 11, 10, 9, 8, 7, 6, 5, 4, 3, 2, 1, 0, 15) \\\n+T (24,\t22, 23, 24, 25, 26, 27, 28, 29, 30, 31, 0, 1, 2, 3, 4, 5) \\\n+T (25,\t6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17, 18, 19, 20, 21)\n #define EXPTESTS \\\n T (116,\t28, 13, 27, 11, 21, 1, 5, 22, 29, 14, 15, 6, 3, 10, 16, 30) \\\n T (117,\t22, 26, 1, 13, 29, 3, 18, 18, 11, 21, 12, 28, 19, 5, 7, 4) \\"}, {"sha": "e6425ce6b56d8a2841c12500972ba5cc23386652", "filename": "gcc/testsuite/gcc.dg/torture/vshuf-32.inc", "status": "modified", "additions": 6, "deletions": 1, "changes": 7, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/661fb5ddb8d4232135a61227e7db2d1de8e458ac/gcc%2Ftestsuite%2Fgcc.dg%2Ftorture%2Fvshuf-32.inc", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/661fb5ddb8d4232135a61227e7db2d1de8e458ac/gcc%2Ftestsuite%2Fgcc.dg%2Ftorture%2Fvshuf-32.inc", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgcc.dg%2Ftorture%2Fvshuf-32.inc?ref=661fb5ddb8d4232135a61227e7db2d1de8e458ac", "patch": "@@ -23,7 +23,12 @@ T (19,\t31, 30, 29, 28, 27, 26, 25, 24, 23, 22, 21, 20, 19, 18, 17, 16, 15, 14, 1\n T (20,\t0, 32, 1, 33, 2, 34, 3, 35, 4, 36, 5, 37, 6, 38, 7, 39, 8, 40, 9, 41, 10, 42, 11, 43, 12, 44, 13, 45, 14, 46, 15, 47) \\\n T (21,\t16, 48, 17, 49, 18, 50, 19, 51, 20, 52, 21, 53, 22, 54, 23, 55, 24, 56, 25, 57, 26, 58, 27, 59, 28, 60, 29, 61, 30, 62, 31, 63) \\\n T (22,\t1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17, 18, 19, 20, 21, 22, 23, 24, 25, 26, 27, 28, 29, 30, 31, 0) \\\n-T (23,\t30, 29, 28, 27, 26, 25, 24, 23, 22, 21, 20, 19, 18, 17, 16, 15, 14, 13, 12, 11, 10, 9, 8, 7, 6, 5, 4, 3, 2, 1, 0, 31)\n+T (23,\t30, 29, 28, 27, 26, 25, 24, 23, 22, 21, 20, 19, 18, 17, 16, 15, 14, 13, 12, 11, 10, 9, 8, 7, 6, 5, 4, 3, 2, 1, 0, 31) \\\n+T (24,\t0, 3, 6, 9, 12, 15, 18, 21, 24, 27, 30, 1, 4, 7, 10, 13, 16, 19, 22, 25, 28, 31, 2, 5, 8, 11, 14, 17, 20, 23, 26, 29) \\\n+T (25,\t11, 12, 13, 14, 15, 16, 17, 18, 19, 20, 21, 22, 23, 24, 25, 26, 27, 28, 29, 30, 31, 32, 33, 34, 35, 36, 37, 38, 39, 40, 41, 42) \\\n+T (26,\t21, 22, 23, 24, 25, 26, 27, 28, 29, 30, 31, 32, 33, 34, 35, 36, 37, 38, 39, 40, 41, 42, 43, 44, 45, 46, 47, 48, 49, 50, 51, 52) \\\n+T (27,\t22, 23, 24, 25, 26, 27, 28, 29, 30, 31, 32, 33, 34, 35, 36, 37, 38, 39, 40, 41, 42, 43, 44, 45, 46, 47, 48, 49, 50, 51, 52, 53) \\\n+T (28,\t38, 39, 40, 41, 42, 43, 44, 45, 46, 47, 0, 1, 2, 3, 4, 5, 54, 55, 56, 57, 58, 59, 60, 61, 62, 63, 16, 17, 18, 19, 20, 21)\n #define EXPTESTS \\\n T (116,\t13, 38, 47, 3, 17, 8, 38, 20, 59, 61, 39, 26, 7, 49, 63, 43, 57, 16, 40, 19, 4, 32, 27, 7, 52, 19, 46, 55, 36, 41, 48, 6) \\\n T (117,\t39, 35, 59, 20, 56, 18, 58, 63, 57, 14, 2, 16, 5, 61, 35, 4, 53, 9, 52, 51, 27, 33, 61, 12, 3, 35, 36, 40, 37, 7, 45, 42) \\"}]}