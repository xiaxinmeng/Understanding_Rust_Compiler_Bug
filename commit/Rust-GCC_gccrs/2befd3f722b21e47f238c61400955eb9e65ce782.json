{"sha": "2befd3f722b21e47f238c61400955eb9e65ce782", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6MmJlZmQzZjcyMmIyMWU0N2YyMzhjNjE0MDA5NTVlYjllNjVjZTc4Mg==", "commit": {"author": {"name": "Jason Merrill", "email": "jason@redhat.com", "date": "2016-06-21T18:19:13Z"}, "committer": {"name": "Jason Merrill", "email": "jason@gcc.gnu.org", "date": "2016-06-21T18:19:13Z"}, "message": "Fix constraint satisfaction in uninstantiated template.\n\n\t* constraint.cc (constraints_satisfied_p): Keep as many levels of\n\targs as our template has levels of parms.\n\nFrom-SVN: r237655", "tree": {"sha": "b2ca415533cd375bcd773bd499901ff83b30da51", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/b2ca415533cd375bcd773bd499901ff83b30da51"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/2befd3f722b21e47f238c61400955eb9e65ce782", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/2befd3f722b21e47f238c61400955eb9e65ce782", "html_url": "https://github.com/Rust-GCC/gccrs/commit/2befd3f722b21e47f238c61400955eb9e65ce782", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/2befd3f722b21e47f238c61400955eb9e65ce782/comments", "author": {"login": "jicama", "id": 266146, "node_id": "MDQ6VXNlcjI2NjE0Ng==", "avatar_url": "https://avatars.githubusercontent.com/u/266146?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jicama", "html_url": "https://github.com/jicama", "followers_url": "https://api.github.com/users/jicama/followers", "following_url": "https://api.github.com/users/jicama/following{/other_user}", "gists_url": "https://api.github.com/users/jicama/gists{/gist_id}", "starred_url": "https://api.github.com/users/jicama/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jicama/subscriptions", "organizations_url": "https://api.github.com/users/jicama/orgs", "repos_url": "https://api.github.com/users/jicama/repos", "events_url": "https://api.github.com/users/jicama/events{/privacy}", "received_events_url": "https://api.github.com/users/jicama/received_events", "type": "User", "site_admin": false}, "committer": null, "parents": [{"sha": "e547455bd62b59821c4ab9e900d7d0ff14fd69c8", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/e547455bd62b59821c4ab9e900d7d0ff14fd69c8", "html_url": "https://github.com/Rust-GCC/gccrs/commit/e547455bd62b59821c4ab9e900d7d0ff14fd69c8"}], "stats": {"total": 24, "additions": 22, "deletions": 2}, "files": [{"sha": "20e34d677ee81602f2f1a30288e30743837f2fcd", "filename": "gcc/cp/ChangeLog", "status": "modified", "additions": 3, "deletions": 0, "changes": 3, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/2befd3f722b21e47f238c61400955eb9e65ce782/gcc%2Fcp%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/2befd3f722b21e47f238c61400955eb9e65ce782/gcc%2Fcp%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fcp%2FChangeLog?ref=2befd3f722b21e47f238c61400955eb9e65ce782", "patch": "@@ -1,5 +1,8 @@\n 2016-06-21  Jason Merrill  <jason@redhat.com>\n \n+\t* constraint.cc (constraints_satisfied_p): Keep as many levels of\n+\targs as our template has levels of parms.\n+\n \t* pt.c (template_parm_outer_level, uses_outer_template_parms): New.\n \t(type_dependent_expression_p): Use uses_outer_template_parms.\n "}, {"sha": "af7a593a4f66b05cbccb03d00244d02e47060145", "filename": "gcc/cp/constraint.cc", "status": "modified", "additions": 4, "deletions": 2, "changes": 6, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/2befd3f722b21e47f238c61400955eb9e65ce782/gcc%2Fcp%2Fconstraint.cc", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/2befd3f722b21e47f238c61400955eb9e65ce782/gcc%2Fcp%2Fconstraint.cc", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fcp%2Fconstraint.cc?ref=2befd3f722b21e47f238c61400955eb9e65ce782", "patch": "@@ -2122,8 +2122,10 @@ constraints_satisfied_p (tree decl)\n   tree args = NULL_TREE;\n   if (tree ti = DECL_TEMPLATE_INFO (decl))\n     {\n-      ci = get_constraints (TI_TEMPLATE (ti));\n-      args = INNERMOST_TEMPLATE_ARGS (TI_ARGS (ti));\n+      tree tmpl = TI_TEMPLATE (ti);\n+      ci = get_constraints (tmpl);\n+      int depth = TMPL_PARMS_DEPTH (DECL_TEMPLATE_PARMS (tmpl));\n+      args = get_innermost_template_args (TI_ARGS (ti), depth);\n     }\n   else\n     {"}, {"sha": "6f3d5a3ebf65f5a56d52ff5baaa0419afb9cd8dc", "filename": "gcc/testsuite/g++.dg/concepts/memtmpl1.C", "status": "added", "additions": 15, "deletions": 0, "changes": 15, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/2befd3f722b21e47f238c61400955eb9e65ce782/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Fconcepts%2Fmemtmpl1.C", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/2befd3f722b21e47f238c61400955eb9e65ce782/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Fconcepts%2Fmemtmpl1.C", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Fconcepts%2Fmemtmpl1.C?ref=2befd3f722b21e47f238c61400955eb9e65ce782", "patch": "@@ -0,0 +1,15 @@\n+// { dg-options \"-std=c++1z -fconcepts\" }\n+\n+template <class T>\n+struct A {\n+  template <class U>\n+  requires sizeof(T) == 1\n+    static void f(U);\n+  template <class U>\n+  requires sizeof(T) == 2\n+    static void f(U);\n+  void g()\n+  {\n+    f(42);\n+  }\n+};"}]}