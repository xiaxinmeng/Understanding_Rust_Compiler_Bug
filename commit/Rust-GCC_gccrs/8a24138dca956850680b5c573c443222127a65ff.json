{"sha": "8a24138dca956850680b5c573c443222127a65ff", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6OGEyNDEzOGRjYTk1Njg1MDY4MGI1YzU3M2M0NDMyMjIxMjdhNjVmZg==", "commit": {"author": {"name": "Alexandre Oliva", "email": "aoliva@gcc.gnu.org", "date": "2000-09-10T07:53:51Z"}, "committer": {"name": "Alexandre Oliva", "email": "aoliva@gcc.gnu.org", "date": "2000-09-10T07:53:51Z"}, "message": "This commit was generated by cvs2svn to compensate for changes in r36292,\n\nwhich included commits to RCS files with non-trunk default branches.\n\nFrom-SVN: r36293", "tree": {"sha": "f13775c623c55b19c087067616af2c44afc72342", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/f13775c623c55b19c087067616af2c44afc72342"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/8a24138dca956850680b5c573c443222127a65ff", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/8a24138dca956850680b5c573c443222127a65ff", "html_url": "https://github.com/Rust-GCC/gccrs/commit/8a24138dca956850680b5c573c443222127a65ff", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/8a24138dca956850680b5c573c443222127a65ff/comments", "author": null, "committer": null, "parents": [{"sha": "77dd5bce7de3f060c0b998801f84aee290c66848", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/77dd5bce7de3f060c0b998801f84aee290c66848", "html_url": "https://github.com/Rust-GCC/gccrs/commit/77dd5bce7de3f060c0b998801f84aee290c66848"}], "stats": {"total": 192, "additions": 175, "deletions": 17}, "files": [{"sha": "666c785c8c16368cd4bd3c35e3e987e169bc9cf6", "filename": "libjava/libltdl/ltdl.h", "status": "modified", "additions": 175, "deletions": 17, "changes": 192, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/8a24138dca956850680b5c573c443222127a65ff/libjava%2Flibltdl%2Fltdl.h", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/8a24138dca956850680b5c573c443222127a65ff/libjava%2Flibltdl%2Fltdl.h", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libjava%2Flibltdl%2Fltdl.h?ref=8a24138dca956850680b5c573c443222127a65ff", "patch": "@@ -1,24 +1,24 @@\n /* ltdl.h -- generic dlopen functions\n-   Copyright (C) 1998-1999 Free Software Foundation, Inc.\n+   Copyright (C) 1998-2000 Free Software Foundation, Inc.\n    Originally by Thomas Tanner <tanner@ffii.org>\n    This file is part of GNU Libtool.\n \n This library is free software; you can redistribute it and/or\n-modify it under the terms of the GNU Library General Public\n+modify it under the terms of the GNU Lesser General Public\n License as published by the Free Software Foundation; either\n version 2 of the License, or (at your option) any later version.\n \n-As a special exception to the GNU Library General Public License,\n-if you distribute this file as part of a program that uses GNU libtool\n-to create libraries and programs, you may include it under the same\n+As a special exception to the GNU Lesser General Public License,\n+if you distribute this file as part of a program or library that\n+is built using GNU libtool, you may include it under the same\n distribution terms that you use for the rest of that program.\n \n This library is distributed in the hope that it will be useful,\n but WITHOUT ANY WARRANTY; without even the implied warranty of\n MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU\n-Library General Public License for more details.\n+Lesser General Public License for more details.\n \n-You should have received a copy of the GNU Library General Public\n+You should have received a copy of the GNU Lesser General Public\n License along with this library; if not, write to the Free\n Software Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA\n 02111-1307  USA\n@@ -28,6 +28,18 @@ Software Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA\n #ifndef _LTDL_H_\n #define _LTDL_H_ 1\n \n+/* Canonicalise Windows and Cygwin recognition macros.  */\n+#ifdef __CYGWIN32__\n+#  ifndef __CYGWIN__\n+#    define __CYGWIN__ __CYGWIN32__\n+#  endif\n+#endif\n+#ifdef _WIN32\n+#  ifndef WIN32\n+#    define WIN32 _WIN32\n+#  endif\n+#endif\n+\n /* __BEGIN_DECLS should be used at the beginning of your declarations,\n    so that C++ compilers don't mangle their names.  Use __END_DECLS at\n    the end of C declarations. */\n@@ -54,38 +66,184 @@ Software Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA\n # define lt_ptr_t\tchar*\n #endif\n \n+/* LTDL_STMT_START/END are used to create macros which expand to a\n+   a single compound statement in a portable way. */\n+#undef LTDL_STMT_START\n+#undef LTDL_STMT_END\n+#if defined (__GNUC__) && !defined (__STRICT_ANSI__) && !defined (__cplusplus)\n+#  define LTDL_STMT_START        (void)(\n+#  define LTDL_STMT_END          )\n+#else\n+#  if (defined (sun) || defined (__sun__))\n+#    define LTDL_STMT_START      if (1)\n+#    define LTDL_STMT_END        else (void)0\n+#  else\n+#    define LTDL_STMT_START      do\n+#    define LTDL_STMT_END        while (0)\n+#  endif\n+#endif\n+\n+#ifdef WIN32\n+#  ifndef __CYGWIN__\n+/* LTDL_DIRSEP_CHAR is accepted *in addition* to '/' as a directory\n+   separator when it is set. */\n+#    define LTDL_DIRSEP_CHAR\t'\\\\'\n+#    define LTDL_PATHSEP_CHAR\t';'\n+#  endif\n+#endif\n+#ifndef LTDL_PATHSEP_CHAR\n+#  define LTDL_PATHSEP_CHAR\t':'\n+#endif\n+\n+/* DLL building support on win32 hosts;  mostly to workaround their\n+   ridiculous implementation of data symbol exporting. */\n+#ifndef LTDL_SCOPE\n+#  ifdef _WIN32\n+#    ifdef DLL_EXPORT\t\t/* defined by libtool (if required) */\n+#      define LTDL_SCOPE\t__declspec(dllexport)\n+#    endif\n+#    ifdef LIBLTDL_DLL_IMPORT\t/* define if linking with this dll */\n+#      define LTDL_SCOPE\textern __declspec(dllimport)\n+#    endif\n+#  endif\n+#  ifndef LTDL_SCOPE\t\t/* static linking or !_WIN32 */\n+#    define LTDL_SCOPE\textern\n+#  endif\n+#endif\n+\n #include <stdlib.h>\n \n+/* Defining error strings alongside their symbolic names in a macro in\n+   this way allows us to expand the macro in different contexts with\n+   confidence that the enumeration of symbolic names will map correctly\n+   onto the table of error strings.  */\n+#define ltdl_error_table\t\t\t\t\t\t\\\n+\tLTDL_ERROR(UNKNOWN, \"unknown error\")\t\t\t\t\\\n+\tLTDL_ERROR(DLOPEN_NOT_SUPPORTED, \"dlopen support not available\")\\\n+\tLTDL_ERROR(INVALID_LOADER, \"invalid loader\")\t\t\t\\\n+\tLTDL_ERROR(INIT_LOADER, \"loader initialization failed\")\t\t\\\n+\tLTDL_ERROR(REMOVE_LOADER, \"loader removal failed\")\t\t\\\n+\tLTDL_ERROR(FILE_NOT_FOUND, \"file not found\")\t\t\t\\\n+\tLTDL_ERROR(DEPLIB_NOT_FOUND, \"dependency library not found\")\t\\\n+\tLTDL_ERROR(NO_SYMBOLS, \"no symbols defined\")\t\t\t\\\n+\tLTDL_ERROR(CANNOT_OPEN, \"can't open the module\")\t\t\\\n+\tLTDL_ERROR(CANNOT_CLOSE, \"can't close the module\")\t\t\\\n+\tLTDL_ERROR(SYMBOL_NOT_FOUND, \"symbol not found\")\t\t\\\n+\tLTDL_ERROR(NO_MEMORY, \"not enough memory\")\t\t\t\\\n+\tLTDL_ERROR(INVALID_HANDLE, \"invalid module handle\")\t\t\\\n+\tLTDL_ERROR(BUFFER_OVERFLOW, \"internal buffer overflow\")\t\t\\\n+\tLTDL_ERROR(INVALID_ERRORCODE, \"invalid errorcode\")\t\t\\\n+\tLTDL_ERROR(SHUTDOWN, \"library already shutdown\")\n+\n+/* Enumerate the symbolic error names. */\n+#if defined(__STDC__) || defined(__cplusplus)\n+#  define LTDL_ERROR(name, diagnostic)\tLTDL_ERROR_##name,\n+#else\n+#  define LTDL_ERROR(name, diagnostic)\tLTDL_ERROR_/**/name,\n+#endif\n+enum {\n+\tltdl_error_table\n+\tLTDL_ERROR_MAX\n+};\n+#undef LTDL_ERROR\n+\n+/* An opaque handle for a successfully lt_dlopened module instance. */\n #ifdef _LTDL_COMPILE_\n typedef\tstruct lt_dlhandle_t *lt_dlhandle;\n #else\n typedef\tlt_ptr_t lt_dlhandle;\n #endif\n \n+/* A preopened symbol. Arrays of this type comprise the exported\n+   symbols for a dlpreopened module. */\n typedef struct {\n \tconst char *name;\n \tlt_ptr_t address;\n } lt_dlsymlist;\n \n+/* Read only information pertaining to a loaded module. */\n+typedef\tstruct {\n+\tchar\t*filename;\t/* file name */\n+\tchar\t*name;\t\t/* module name */\n+\tint\tref_count;\t/* number of times lt_dlopened minus\n+\t\t\t\t   number of times lt_dlclosed. */\n+} lt_dlinfo;\n+\n+/* An opaque handle for a module loaded by a system call.  This is only\n+   used internally by ltdl loaders, and by user module loaders. */\n+typedef lt_ptr_t lt_module_t;\n+\n+/* An opaque handle for a module loader.  */\n+#ifdef _LTDL_COMPILE_\n+typedef\tstruct lt_dlloader_t lt_dlloader_t;\n+#else\n+typedef\tlt_ptr_t lt_dlloader_t;\n+#endif\n+\n+typedef lt_ptr_t lt_dlloader_data_t;\n+\n+/* Function pointer types for creating user defined module loaders. */\n+typedef lt_module_t lt_module_open_t LTDL_PARAMS((lt_dlloader_data_t loader_data, const char *filename));\n+typedef int lt_module_close_t LTDL_PARAMS((lt_dlloader_data_t loader_data, lt_module_t handle));\n+typedef lt_ptr_t lt_find_sym_t LTDL_PARAMS((lt_dlloader_data_t loader_data, lt_module_t handle, const char *symbol));\n+typedef int lt_dlloader_exit_t LTDL_PARAMS((lt_dlloader_data_t loader_data));\n+\n __BEGIN_DECLS\n+/* Initialisation and finalisation functions for libltdl. */\n extern int lt_dlinit LTDL_PARAMS((void));\n-extern int lt_dlpreload LTDL_PARAMS((const lt_dlsymlist *preloaded));\n-extern int lt_dlpreload_default LTDL_PARAMS((const lt_dlsymlist *preloaded));\n extern int lt_dlexit LTDL_PARAMS((void));\n+\n+/* Module search path manipultation.  */\n+extern int lt_dladdsearchdir LTDL_PARAMS((const char *search_dir));\n+extern int lt_dlsetsearchpath LTDL_PARAMS((const char *search_path));\n+extern const char *lt_dlgetsearchpath LTDL_PARAMS((void));\n+\n+/* Portable libltdl versions of the system dlopen() API. */\n extern lt_dlhandle lt_dlopen LTDL_PARAMS((const char *filename));\n extern lt_dlhandle lt_dlopenext LTDL_PARAMS((const char *filename));\n-extern int lt_dlclose LTDL_PARAMS((lt_dlhandle handle));\n extern lt_ptr_t lt_dlsym LTDL_PARAMS((lt_dlhandle handle, const char *name));\n extern const char *lt_dlerror LTDL_PARAMS((void));\n-extern int lt_dladdsearchdir LTDL_PARAMS((const char *search_dir));\n-extern int lt_dlsetsearchpath LTDL_PARAMS((const char *search_path));\n-extern const char *lt_dlgetsearchpath LTDL_PARAMS((void));\n+extern int lt_dlclose LTDL_PARAMS((lt_dlhandle handle));\n+\n+/* Support for preloaded modules through lt_dlopen() API. */\n+extern int lt_dlpreload LTDL_PARAMS((const lt_dlsymlist *preloaded));\n+extern int lt_dlpreload_default LTDL_PARAMS((const lt_dlsymlist *preloaded));\n+\n+#define LTDL_SET_PRELOADED_SYMBOLS() \t\tLTDL_STMT_START{\t\\\n+\textern const lt_dlsymlist lt_preloaded_symbols[];\t\t\\\n+\tlt_dlpreload_default(lt_preloaded_symbols);\t\t\t\\\n+\t\t\t\t\t\t}LTDL_STMT_END\n+\n+/* Managing user data associated with a loaded modules.  */\n+extern const lt_dlinfo *lt_dlgetinfo LTDL_PARAMS((lt_dlhandle handle));\n+extern int lt_dlforeach LTDL_PARAMS((\n+\t\tint (*func)(lt_dlhandle handle, lt_ptr_t data), lt_ptr_t data));\n+\n+/* User module loader API. */\n+struct lt_user_dlloader {\n+\tconst char *sym_prefix;\n+\tlt_module_open_t *module_open;\n+\tlt_module_close_t *module_close;\n+\tlt_find_sym_t *find_sym;\n+\tlt_dlloader_exit_t *dlloader_exit;\n+  \tlt_dlloader_data_t dlloader_data;\n+};\n+\n+extern lt_dlloader_t *lt_dlloader_next LTDL_PARAMS((lt_dlloader_t *place));\n+extern lt_dlloader_t *lt_dlloader_find LTDL_PARAMS((const char *loader_name));\n+extern const char *lt_dlloader_name LTDL_PARAMS((lt_dlloader_t *place));\n+extern lt_dlloader_data_t *lt_dlloader_data LTDL_PARAMS((lt_dlloader_t *place));\n+extern lt_dlloader_t *lt_find_dlloader LTDL_PARAMS((const char *loader_name));\n+extern int lt_dlloader_add LTDL_PARAMS((lt_dlloader_t *place, const struct lt_user_dlloader *dlloader, const char *loader_name));\n+extern int lt_dlloader_remove LTDL_PARAMS((const char *loader_name));\n \n-extern const lt_dlsymlist lt_preloaded_symbols[];\n-#define LTDL_SET_PRELOADED_SYMBOLS() lt_dlpreload_default(lt_preloaded_symbols)\n+/* Integrated lt_dlerror() messages for user loaders. */\n+extern int lt_dladderror LTDL_PARAMS((const char *diagnostic));\n+extern int lt_dlseterror LTDL_PARAMS((int errorcode));\n \n-extern lt_ptr_t (*lt_dlmalloc)LTDL_PARAMS((size_t size));\n-extern void (*lt_dlfree)LTDL_PARAMS((lt_ptr_t ptr));\n+/* Pointers to memory management functions to be used by libltdl. */\n+LTDL_SCOPE lt_ptr_t (*lt_dlmalloc)LTDL_PARAMS((size_t size));\n+LTDL_SCOPE void (*lt_dlfree)LTDL_PARAMS((lt_ptr_t ptr));\n \n __END_DECLS\n "}]}