{"sha": "efa7882fa699212d9d5417df3e39882e831eacbb", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6ZWZhNzg4MmZhNjk5MjEyZDlkNTQxN2RmM2UzOTg4MmU4MzFlYWNiYg==", "commit": {"author": {"name": "Richard Henderson", "email": "rth@redhat.com", "date": "2014-01-31T19:35:31Z"}, "committer": {"name": "Richard Henderson", "email": "rth@gcc.gnu.org", "date": "2014-01-31T19:35:31Z"}, "message": "re PR middle-end/60004 (Conditional return within transaction causes ICE)\n\nPR middle-end/60004\n\n        * tree-eh.c (lower_try_finally_switch): Delay lowering finally block\n        until after else_eh is processed.\n\n\t* g++.dg/tm/pr60004.C: New.\n\nFrom-SVN: r207367", "tree": {"sha": "7563625dd4f7cf06cb8dbd4f8104cb41a0e72fdd", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/7563625dd4f7cf06cb8dbd4f8104cb41a0e72fdd"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/efa7882fa699212d9d5417df3e39882e831eacbb", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/efa7882fa699212d9d5417df3e39882e831eacbb", "html_url": "https://github.com/Rust-GCC/gccrs/commit/efa7882fa699212d9d5417df3e39882e831eacbb", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/efa7882fa699212d9d5417df3e39882e831eacbb/comments", "author": null, "committer": null, "parents": [{"sha": "3d27e0669d807f01a93a03209f8cbb3c3f85d032", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/3d27e0669d807f01a93a03209f8cbb3c3f85d032", "html_url": "https://github.com/Rust-GCC/gccrs/commit/3d27e0669d807f01a93a03209f8cbb3c3f85d032"}], "stats": {"total": 24, "additions": 21, "deletions": 3}, "files": [{"sha": "93ebbb9efc0e77039f5f6a892bb386db770a3bf8", "filename": "gcc/ChangeLog", "status": "modified", "additions": 6, "deletions": 0, "changes": 6, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/efa7882fa699212d9d5417df3e39882e831eacbb/gcc%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/efa7882fa699212d9d5417df3e39882e831eacbb/gcc%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2FChangeLog?ref=efa7882fa699212d9d5417df3e39882e831eacbb", "patch": "@@ -1,3 +1,9 @@\n+2014-01-31  Richard Henderson  <rth@redhat.com>\n+\n+\tPR middle-end/60004\n+\t* tree-eh.c (lower_try_finally_switch): Delay lowering finally block\n+\tuntil after else_eh is processed.\n+\n 2014-01-31  Ilya Tocar  <ilya.tocar@intel.com>\n \n \t* config/i386/avx512fintrin.h (_MM_FROUND_TO_NEAREST_INT),"}, {"sha": "014dc08fbfd21c5ea9db330ed4447a4ec24c695b", "filename": "gcc/testsuite/ChangeLog", "status": "modified", "additions": 4, "deletions": 0, "changes": 4, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/efa7882fa699212d9d5417df3e39882e831eacbb/gcc%2Ftestsuite%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/efa7882fa699212d9d5417df3e39882e831eacbb/gcc%2Ftestsuite%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2FChangeLog?ref=efa7882fa699212d9d5417df3e39882e831eacbb", "patch": "@@ -1,3 +1,7 @@\n+2014-01-31  Richard Henderson <rth@redhat.com>\n+\n+\t* g++.dg/tm/pr60004.C: New.\n+\n 2014-01-31  Paolo Carlini  <paolo.carlini@oracle.com>\n \n \tPR c++/59082"}, {"sha": "b8c2c0e032b11cc26d1de143b481e9aab4720b88", "filename": "gcc/testsuite/g++.dg/tm/pr60004.C", "status": "added", "additions": 10, "deletions": 0, "changes": 10, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/efa7882fa699212d9d5417df3e39882e831eacbb/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Ftm%2Fpr60004.C", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/efa7882fa699212d9d5417df3e39882e831eacbb/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Ftm%2Fpr60004.C", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Ftm%2Fpr60004.C?ref=efa7882fa699212d9d5417df3e39882e831eacbb", "patch": "@@ -0,0 +1,10 @@\n+// { dg-do compile }\n+// { dg-options \"-fgnu-tm\" }\n+\n+int a;\n+int f() {\n+    __transaction_atomic {\n+        if (a == 5)\n+            return 1;\n+    }\n+}"}, {"sha": "e9c714c7714a9b15908e1a76cff74ec3b86be528", "filename": "gcc/tree-eh.c", "status": "modified", "additions": 1, "deletions": 3, "changes": 4, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/efa7882fa699212d9d5417df3e39882e831eacbb/gcc%2Ftree-eh.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/efa7882fa699212d9d5417df3e39882e831eacbb/gcc%2Ftree-eh.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftree-eh.c?ref=efa7882fa699212d9d5417df3e39882e831eacbb", "patch": "@@ -1388,9 +1388,6 @@ lower_try_finally_switch (struct leh_state *state, struct leh_tf_state *tf)\n   x = gimple_seq_last_stmt (finally);\n   finally_loc = x ? gimple_location (x) : tf_loc;\n \n-  /* Lower the finally block itself.  */\n-  lower_eh_constructs_1 (state, &finally);\n-\n   /* Prepare for switch statement generation.  */\n   nlabels = tf->dest_array.length ();\n   return_index = nlabels;\n@@ -1476,6 +1473,7 @@ lower_try_finally_switch (struct leh_state *state, struct leh_tf_state *tf)\n   x = gimple_build_label (finally_label);\n   gimple_seq_add_stmt (&tf->top_p_seq, x);\n \n+  lower_eh_constructs_1 (state, &finally);\n   gimple_seq_add_seq (&tf->top_p_seq, finally);\n \n   /* Redirect each incoming goto edge.  */"}]}