{"sha": "7e7cfcf6eb7ed4bbc1cc7d8c4f689fa72cc7deb0", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6N2U3Y2ZjZjZlYjdlZDRiYmMxY2M3ZDhjNGY2ODlmYTcyY2M3ZGViMA==", "commit": {"author": {"name": "Ulrich Weigand", "email": "ulrich.weigand@linaro.org", "date": "2011-04-18T07:14:22Z"}, "committer": {"name": "Ira Rosen", "email": "irar@gcc.gnu.org", "date": "2011-04-18T07:14:22Z"}, "message": "re PR target/48252 (ARM neon: problem with consecutive vzip, vuzp and vtrn)\n\n\n\tPR target/48252\n\t* config/arm/arm.c (neon_emit_pair_result_insn): Swap arguments\n\tto match neon_vzip/vuzp/vtrn_internal.\n\t* config/arm/neon.md (neon_vtrn<mode>_internal): Make both\n\toutputs explicitly dependent on both inputs.\n\t(neon_vzip<mode>_internal, neon_vuzp<mode>_internal): Likewise.\n\n\nCo-Authored-By: Ira Rosen <ira.rosen@linaro.org>\n\nFrom-SVN: r172639", "tree": {"sha": "82fa305bb3e3f3e1635e6e51c7bf01c0d5a1cbfb", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/82fa305bb3e3f3e1635e6e51c7bf01c0d5a1cbfb"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/7e7cfcf6eb7ed4bbc1cc7d8c4f689fa72cc7deb0", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/7e7cfcf6eb7ed4bbc1cc7d8c4f689fa72cc7deb0", "html_url": "https://github.com/Rust-GCC/gccrs/commit/7e7cfcf6eb7ed4bbc1cc7d8c4f689fa72cc7deb0", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/7e7cfcf6eb7ed4bbc1cc7d8c4f689fa72cc7deb0/comments", "author": null, "committer": null, "parents": [{"sha": "49eab32e6e79af5ef80832d058539c8d73a74ef9", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/49eab32e6e79af5ef80832d058539c8d73a74ef9", "html_url": "https://github.com/Rust-GCC/gccrs/commit/49eab32e6e79af5ef80832d058539c8d73a74ef9"}], "stats": {"total": 90, "additions": 70, "deletions": 20}, "files": [{"sha": "30398d23ec6d482a601877f077142a7e0ae042d0", "filename": "gcc/ChangeLog", "status": "modified", "additions": 10, "deletions": 0, "changes": 10, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/7e7cfcf6eb7ed4bbc1cc7d8c4f689fa72cc7deb0/gcc%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/7e7cfcf6eb7ed4bbc1cc7d8c4f689fa72cc7deb0/gcc%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2FChangeLog?ref=7e7cfcf6eb7ed4bbc1cc7d8c4f689fa72cc7deb0", "patch": "@@ -1,3 +1,13 @@\n+2011-04-18  Ulrich Weigand  <ulrich.weigand@linaro.org>\n+\t    Ira Rosen  <ira.rosen@linaro.org>\n+\n+\tPR target/48252\n+\t* config/arm/arm.c (neon_emit_pair_result_insn): Swap arguments\n+\tto match neon_vzip/vuzp/vtrn_internal.\n+\t* config/arm/neon.md (neon_vtrn<mode>_internal): Make both\n+\toutputs explicitly dependent on both inputs.\n+\t(neon_vzip<mode>_internal, neon_vuzp<mode>_internal): Likewise.\n+\n 2011-04-18  Jakub Jelinek  <jakub@redhat.com>\n \n \tPR tree-optimization/48616"}, {"sha": "aa13e2be2970ac38fa37cf09f6d90827e741aaa0", "filename": "gcc/config/arm/arm.c", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/7e7cfcf6eb7ed4bbc1cc7d8c4f689fa72cc7deb0/gcc%2Fconfig%2Farm%2Farm.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/7e7cfcf6eb7ed4bbc1cc7d8c4f689fa72cc7deb0/gcc%2Fconfig%2Farm%2Farm.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fconfig%2Farm%2Farm.c?ref=7e7cfcf6eb7ed4bbc1cc7d8c4f689fa72cc7deb0", "patch": "@@ -19632,7 +19632,7 @@ neon_emit_pair_result_insn (enum machine_mode mode,\n   rtx tmp1 = gen_reg_rtx (mode);\n   rtx tmp2 = gen_reg_rtx (mode);\n \n-  emit_insn (intfn (tmp1, op1, tmp2, op2));\n+  emit_insn (intfn (tmp1, op1, op2, tmp2));\n \n   emit_move_insn (mem, tmp1);\n   mem = adjust_address (mem, mode, GET_MODE_SIZE (mode));"}, {"sha": "a975d97836a2986535304ac23b1347d648717abb", "filename": "gcc/config/arm/neon.md", "status": "modified", "additions": 22, "deletions": 19, "changes": 41, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/7e7cfcf6eb7ed4bbc1cc7d8c4f689fa72cc7deb0/gcc%2Fconfig%2Farm%2Fneon.md", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/7e7cfcf6eb7ed4bbc1cc7d8c4f689fa72cc7deb0/gcc%2Fconfig%2Farm%2Fneon.md", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fconfig%2Farm%2Fneon.md?ref=7e7cfcf6eb7ed4bbc1cc7d8c4f689fa72cc7deb0", "patch": "@@ -4092,13 +4092,14 @@\n \n (define_insn \"neon_vtrn<mode>_internal\"\n   [(set (match_operand:VDQW 0 \"s_register_operand\" \"=w\")\n-\t(unspec:VDQW [(match_operand:VDQW 1 \"s_register_operand\" \"0\")]\n-\t\t     UNSPEC_VTRN1))\n-   (set (match_operand:VDQW 2 \"s_register_operand\" \"=w\")\n-        (unspec:VDQW [(match_operand:VDQW 3 \"s_register_operand\" \"2\")]\n-\t\t     UNSPEC_VTRN2))]\n-  \"TARGET_NEON\"\n-  \"vtrn.<V_sz_elem>\\t%<V_reg>0, %<V_reg>2\"\n+        (unspec:VDQW [(match_operand:VDQW 1 \"s_register_operand\" \"0\")\n+                      (match_operand:VDQW 2 \"s_register_operand\" \"w\")]\n+                     UNSPEC_VTRN1))\n+   (set (match_operand:VDQW 3 \"s_register_operand\" \"=2\")\n+         (unspec:VDQW [(match_dup 1) (match_dup 2)]\n+                     UNSPEC_VTRN2))]\n+  \"TARGET_NEON\"\n+  \"vtrn.<V_sz_elem>\\t%<V_reg>0, %<V_reg>3\"\n   [(set (attr \"neon_type\")\n       (if_then_else (ne (symbol_ref \"<Is_d_reg>\") (const_int 0))\n                     (const_string \"neon_bp_simple\")\n@@ -4118,13 +4119,14 @@\n \n (define_insn \"neon_vzip<mode>_internal\"\n   [(set (match_operand:VDQW 0 \"s_register_operand\" \"=w\")\n-\t(unspec:VDQW [(match_operand:VDQW 1 \"s_register_operand\" \"0\")]\n-\t\t     UNSPEC_VZIP1))\n-   (set (match_operand:VDQW 2 \"s_register_operand\" \"=w\")\n-        (unspec:VDQW [(match_operand:VDQW 3 \"s_register_operand\" \"2\")]\n-\t\t     UNSPEC_VZIP2))]\n-  \"TARGET_NEON\"\n-  \"vzip.<V_sz_elem>\\t%<V_reg>0, %<V_reg>2\"\n+        (unspec:VDQW [(match_operand:VDQW 1 \"s_register_operand\" \"0\")\n+                      (match_operand:VDQW 2 \"s_register_operand\" \"w\")]\n+                     UNSPEC_VZIP1))\n+   (set (match_operand:VDQW 3 \"s_register_operand\" \"=2\")\n+        (unspec:VDQW [(match_dup 1) (match_dup 2)]\n+                     UNSPEC_VZIP2))]\n+  \"TARGET_NEON\"\n+  \"vzip.<V_sz_elem>\\t%<V_reg>0, %<V_reg>3\"\n   [(set (attr \"neon_type\")\n       (if_then_else (ne (symbol_ref \"<Is_d_reg>\") (const_int 0))\n                     (const_string \"neon_bp_simple\")\n@@ -4144,13 +4146,14 @@\n \n (define_insn \"neon_vuzp<mode>_internal\"\n   [(set (match_operand:VDQW 0 \"s_register_operand\" \"=w\")\n-\t(unspec:VDQW [(match_operand:VDQW 1 \"s_register_operand\" \"0\")]\n+        (unspec:VDQW [(match_operand:VDQW 1 \"s_register_operand\" \"0\")\n+                      (match_operand:VDQW 2 \"s_register_operand\" \"w\")]\n                      UNSPEC_VUZP1))\n-   (set (match_operand:VDQW 2 \"s_register_operand\" \"=w\")\n-        (unspec:VDQW [(match_operand:VDQW 3 \"s_register_operand\" \"2\")]\n-\t\t     UNSPEC_VUZP2))]\n+   (set (match_operand:VDQW 3 \"s_register_operand\" \"=2\")\n+        (unspec:VDQW [(match_dup 1) (match_dup 2)]\n+                     UNSPEC_VUZP2))]\n   \"TARGET_NEON\"\n-  \"vuzp.<V_sz_elem>\\t%<V_reg>0, %<V_reg>2\"\n+  \"vuzp.<V_sz_elem>\\t%<V_reg>0, %<V_reg>3\"\n   [(set (attr \"neon_type\")\n       (if_then_else (ne (symbol_ref \"<Is_d_reg>\") (const_int 0))\n                     (const_string \"neon_bp_simple\")"}, {"sha": "f7d978418bb33497c55e4ff0204258b71446cc83", "filename": "gcc/testsuite/ChangeLog", "status": "modified", "additions": 6, "deletions": 0, "changes": 6, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/7e7cfcf6eb7ed4bbc1cc7d8c4f689fa72cc7deb0/gcc%2Ftestsuite%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/7e7cfcf6eb7ed4bbc1cc7d8c4f689fa72cc7deb0/gcc%2Ftestsuite%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2FChangeLog?ref=7e7cfcf6eb7ed4bbc1cc7d8c4f689fa72cc7deb0", "patch": "@@ -1,3 +1,9 @@\n+2011-04-18  Ulrich Weigand  <ulrich.weigand@linaro.org>\n+\t    Ira Rosen  <ira.rosen@linaro.org>\n+\n+\tPR target/48252\n+\t* gcc.target/arm/pr48252.c: New test.\n+\n 2011-04-18  Jakub Jelinek  <jakub@redhat.com>\n \n \tPR tree-optimization/48616"}, {"sha": "1a06c71e1befe583f05453cee53a814103e90de9", "filename": "gcc/testsuite/gcc.target/arm/pr48252.c", "status": "added", "additions": 31, "deletions": 0, "changes": 31, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/7e7cfcf6eb7ed4bbc1cc7d8c4f689fa72cc7deb0/gcc%2Ftestsuite%2Fgcc.target%2Farm%2Fpr48252.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/7e7cfcf6eb7ed4bbc1cc7d8c4f689fa72cc7deb0/gcc%2Ftestsuite%2Fgcc.target%2Farm%2Fpr48252.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgcc.target%2Farm%2Fpr48252.c?ref=7e7cfcf6eb7ed4bbc1cc7d8c4f689fa72cc7deb0", "patch": "@@ -0,0 +1,31 @@\n+/* { dg-do run } */\n+/* { dg-require-effective-target arm_neon_hw } */\n+/* { dg-options \"-O2\" } */\n+/* { dg-add-options arm_neon } */\n+\n+#include \"arm_neon.h\"\n+#include <stdlib.h>\n+\n+int main(void)\n+{\n+    uint8x8_t v1 = {1, 1, 1, 1, 1, 1, 1, 1};\n+    uint8x8_t v2 = {2, 2, 2, 2, 2, 2, 2, 2};\n+    uint8x8x2_t vd1, vd2;\n+    union {uint8x8_t v; uint8_t buf[8];} d1, d2, d3, d4;\n+    int i;\n+\n+    vd1 = vzip_u8(v1, vdup_n_u8(0));\n+    vd2 = vzip_u8(v2, vdup_n_u8(0));\n+\n+    vst1_u8(d1.buf, vd1.val[0]);\n+    vst1_u8(d2.buf, vd1.val[1]);\n+    vst1_u8(d3.buf, vd2.val[0]);\n+    vst1_u8(d4.buf, vd2.val[1]);\n+\n+    for (i = 0; i < 8; i++)\n+      if ((i % 2 == 0 && d4.buf[i] != 2)\n+          || (i % 2 == 1 && d4.buf[i] != 0))\n+         abort ();\n+\n+    return 0;\n+}"}]}