{"sha": "a0e1dcd44f9c0ee22f56b73660f36072633adb69", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6YTBlMWRjZDQ0ZjljMGVlMjJmNTZiNzM2NjBmMzYwNzI2MzNhZGI2OQ==", "commit": {"author": {"name": "Jonathan Wakely", "email": "jwakely@redhat.com", "date": "2019-11-15T14:38:59Z"}, "committer": {"name": "Jonathan Wakely", "email": "redi@gcc.gnu.org", "date": "2019-11-15T14:38:59Z"}, "message": "libstdc++: Fix definition of std::nostopstate object\n\nAlso add <stop_token> header to PCH and Doxygen config.\n\n\t* doc/doxygen/user.cfg.in: Add <stop_token>.\n\t* include/precompiled/stdc++.h: Likewise.\n\t* include/std/stop_token: Fix definition of std::nostopstate.\n\t* testsuite/30_threads/headers/stop_token/synopsis.cc: New test.\n\t* testsuite/30_threads/headers/thread/types_std_c++20.cc: New test.\n\t* testsuite/30_threads/stop_token/stop_source.cc: New test.\n\t* testsuite/30_threads/stop_token/stop_token.cc: Remove unnecessary\n\tdg-require directives. Remove I/O and inclusion of <iostream>.\n\nFrom-SVN: r278296", "tree": {"sha": "299841c9a1488666a529f2af88e0ff24b4bcaaa4", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/299841c9a1488666a529f2af88e0ff24b4bcaaa4"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/a0e1dcd44f9c0ee22f56b73660f36072633adb69", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/a0e1dcd44f9c0ee22f56b73660f36072633adb69", "html_url": "https://github.com/Rust-GCC/gccrs/commit/a0e1dcd44f9c0ee22f56b73660f36072633adb69", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/a0e1dcd44f9c0ee22f56b73660f36072633adb69/comments", "author": {"login": "jwakely", "id": 1254480, "node_id": "MDQ6VXNlcjEyNTQ0ODA=", "avatar_url": "https://avatars.githubusercontent.com/u/1254480?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jwakely", "html_url": "https://github.com/jwakely", "followers_url": "https://api.github.com/users/jwakely/followers", "following_url": "https://api.github.com/users/jwakely/following{/other_user}", "gists_url": "https://api.github.com/users/jwakely/gists{/gist_id}", "starred_url": "https://api.github.com/users/jwakely/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jwakely/subscriptions", "organizations_url": "https://api.github.com/users/jwakely/orgs", "repos_url": "https://api.github.com/users/jwakely/repos", "events_url": "https://api.github.com/users/jwakely/events{/privacy}", "received_events_url": "https://api.github.com/users/jwakely/received_events", "type": "User", "site_admin": false}, "committer": {"login": "jwakely", "id": 1254480, "node_id": "MDQ6VXNlcjEyNTQ0ODA=", "avatar_url": "https://avatars.githubusercontent.com/u/1254480?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jwakely", "html_url": "https://github.com/jwakely", "followers_url": "https://api.github.com/users/jwakely/followers", "following_url": "https://api.github.com/users/jwakely/following{/other_user}", "gists_url": "https://api.github.com/users/jwakely/gists{/gist_id}", "starred_url": "https://api.github.com/users/jwakely/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jwakely/subscriptions", "organizations_url": "https://api.github.com/users/jwakely/orgs", "repos_url": "https://api.github.com/users/jwakely/repos", "events_url": "https://api.github.com/users/jwakely/events{/privacy}", "received_events_url": "https://api.github.com/users/jwakely/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "f31e515fd519fe6ec3dc0b5cf5b1388fd1373ba4", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/f31e515fd519fe6ec3dc0b5cf5b1388fd1373ba4", "html_url": "https://github.com/Rust-GCC/gccrs/commit/f31e515fd519fe6ec3dc0b5cf5b1388fd1373ba4"}], "stats": {"total": 163, "additions": 156, "deletions": 7}, "files": [{"sha": "53f3b2961c867d0de088c0c0329949cbd08b9b3c", "filename": "libstdc++-v3/ChangeLog", "status": "modified", "additions": 11, "deletions": 0, "changes": 11, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/a0e1dcd44f9c0ee22f56b73660f36072633adb69/libstdc%2B%2B-v3%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/a0e1dcd44f9c0ee22f56b73660f36072633adb69/libstdc%2B%2B-v3%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libstdc%2B%2B-v3%2FChangeLog?ref=a0e1dcd44f9c0ee22f56b73660f36072633adb69", "patch": "@@ -1,3 +1,14 @@\n+2019-11-15  Jonathan Wakely  <jwakely@redhat.com>\n+\n+\t* doc/doxygen/user.cfg.in: Add <stop_token>.\n+\t* include/precompiled/stdc++.h: Likewise.\n+\t* include/std/stop_token: Fix definition of std::nostopstate.\n+\t* testsuite/30_threads/headers/stop_token/synopsis.cc: New test.\n+\t* testsuite/30_threads/headers/thread/types_std_c++20.cc: New test.\n+\t* testsuite/30_threads/stop_token/stop_source.cc: New test.\n+\t* testsuite/30_threads/stop_token/stop_token.cc: Remove unnecessary\n+\tdg-require directives. Remove I/O and inclusion of <iostream>.\n+\n 2019-11-14  Thomas Rodgers  <trodgers@redhat.com>\n \n \t* include/Makefile.am: Add <stop_token> header."}, {"sha": "19f8ffd823082a92a7bf57b47e36c2ba36e35670", "filename": "libstdc++-v3/doc/doxygen/user.cfg.in", "status": "modified", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/a0e1dcd44f9c0ee22f56b73660f36072633adb69/libstdc%2B%2B-v3%2Fdoc%2Fdoxygen%2Fuser.cfg.in", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/a0e1dcd44f9c0ee22f56b73660f36072633adb69/libstdc%2B%2B-v3%2Fdoc%2Fdoxygen%2Fuser.cfg.in", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libstdc%2B%2B-v3%2Fdoc%2Fdoxygen%2Fuser.cfg.in?ref=a0e1dcd44f9c0ee22f56b73660f36072633adb69", "patch": "@@ -840,6 +840,7 @@ INPUT                  = @srcdir@/doc/doxygen/doxygroups.cc \\\n                          include/sstream \\\n                          include/stack \\\n                          include/stdexcept \\\n+                         include/stop_token \\\n                          include/streambuf \\\n                          include/string \\\n                          include/string_view \\"}, {"sha": "c77136ef44165df513505098e9adfc9049d4014c", "filename": "libstdc++-v3/include/precompiled/stdc++.h", "status": "modified", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/a0e1dcd44f9c0ee22f56b73660f36072633adb69/libstdc%2B%2B-v3%2Finclude%2Fprecompiled%2Fstdc%2B%2B.h", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/a0e1dcd44f9c0ee22f56b73660f36072633adb69/libstdc%2B%2B-v3%2Finclude%2Fprecompiled%2Fstdc%2B%2B.h", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libstdc%2B%2B-v3%2Finclude%2Fprecompiled%2Fstdc%2B%2B.h?ref=a0e1dcd44f9c0ee22f56b73660f36072633adb69", "patch": "@@ -140,6 +140,7 @@\n #include <numbers>\n #include <ranges>\n #include <span>\n+#include <stop_token>\n // #include <syncstream>\n #include <version>\n #endif"}, {"sha": "f96c267f22e7784a3ee114b854de6d9bdf1183d6", "filename": "libstdc++-v3/include/std/stop_token", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/a0e1dcd44f9c0ee22f56b73660f36072633adb69/libstdc%2B%2B-v3%2Finclude%2Fstd%2Fstop_token", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/a0e1dcd44f9c0ee22f56b73660f36072633adb69/libstdc%2B%2B-v3%2Finclude%2Fstd%2Fstop_token", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libstdc%2B%2B-v3%2Finclude%2Fstd%2Fstop_token?ref=a0e1dcd44f9c0ee22f56b73660f36072633adb69", "patch": "@@ -47,7 +47,7 @@ _GLIBCXX_BEGIN_NAMESPACE_VERSION\n   class stop_callback;\n \n   struct nostopstate_t { explicit nostopstate_t() = default; };\n-  inline constexpr nostopstate_t nostopstate();\n+  inline constexpr nostopstate_t nostopstate{};\n \n   class stop_token\n   {"}, {"sha": "b185bc7be390d6c41c909d990af442c1f810c9fe", "filename": "libstdc++-v3/testsuite/30_threads/headers/stop_token/synopsis.cc", "status": "added", "additions": 35, "deletions": 0, "changes": 35, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/a0e1dcd44f9c0ee22f56b73660f36072633adb69/libstdc%2B%2B-v3%2Ftestsuite%2F30_threads%2Fheaders%2Fstop_token%2Fsynopsis.cc", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/a0e1dcd44f9c0ee22f56b73660f36072633adb69/libstdc%2B%2B-v3%2Ftestsuite%2F30_threads%2Fheaders%2Fstop_token%2Fsynopsis.cc", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libstdc%2B%2B-v3%2Ftestsuite%2F30_threads%2Fheaders%2Fstop_token%2Fsynopsis.cc?ref=a0e1dcd44f9c0ee22f56b73660f36072633adb69", "patch": "@@ -0,0 +1,35 @@\n+// Copyright (C) 2019 Free Software Foundation, Inc.\n+//\n+// This file is part of the GNU ISO C++ Library.  This library is free\n+// software; you can redistribute it and/or modify it under the\n+// terms of the GNU General Public License as published by the\n+// Free Software Foundation; either version 3, or (at your option)\n+// any later version.\n+\n+// This library is distributed in the hope that it will be useful,\n+// but WITHOUT ANY WARRANTY; without even the implied warranty of\n+// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n+// GNU General Public License for more details.\n+\n+// You should have received a copy of the GNU General Public License along\n+// with this library; see the file COPYING3.  If not see\n+// <http://www.gnu.org/licenses/>.\n+\n+// { dg-options \"-std=gnu++2a\" }\n+// { dg-do compile { target c++2a } }\n+\n+#include <stop_token>\n+\n+namespace std\n+{\n+  class stop_token;\n+  class stop_source;\n+  struct nostopstate_t;\n+  template<class>\n+    class stop_callback;\n+}\n+\n+namespace gnu\n+{\n+  constexpr const std::nostopstate_t* tag = &std::nostopstate;\n+}"}, {"sha": "86f29d8b0013637c45fa0a844244a2eba434a5cf", "filename": "libstdc++-v3/testsuite/30_threads/headers/thread/types_std_c++20.cc", "status": "added", "additions": 30, "deletions": 0, "changes": 30, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/a0e1dcd44f9c0ee22f56b73660f36072633adb69/libstdc%2B%2B-v3%2Ftestsuite%2F30_threads%2Fheaders%2Fthread%2Ftypes_std_c%2B%2B20.cc", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/a0e1dcd44f9c0ee22f56b73660f36072633adb69/libstdc%2B%2B-v3%2Ftestsuite%2F30_threads%2Fheaders%2Fthread%2Ftypes_std_c%2B%2B20.cc", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libstdc%2B%2B-v3%2Ftestsuite%2F30_threads%2Fheaders%2Fthread%2Ftypes_std_c%2B%2B20.cc?ref=a0e1dcd44f9c0ee22f56b73660f36072633adb69", "patch": "@@ -0,0 +1,30 @@\n+// { dg-options \"-std=gnu++2a\" }\n+// { dg-do compile { target c++2a } }\n+// { dg-require-gthreads \"\" }\n+\n+// Copyright (C) 2019 Free Software Foundation, Inc.\n+//\n+// This file is part of the GNU ISO C++ Library.  This library is free\n+// software; you can redistribute it and/or modify it under the\n+// terms of the GNU General Public License as published by the\n+// Free Software Foundation; either version 3, or (at your option)\n+// any later version.\n+//\n+// This library is distributed in the hope that it will be useful,\n+// but WITHOUT ANY WARRANTY; without even the implied warranty of\n+// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n+// GNU General Public License for more details.\n+//\n+// You should have received a copy of the GNU General Public License along\n+// with this library; see the file COPYING3.  If not see\n+// <http://www.gnu.org/licenses/>.\n+\n+#include <thread>\n+\n+void test01()\n+{\n+  using t_t = std::thread;\n+  using j_t = std::jthread;\n+\n+  using namespace std::this_thread;\n+}"}, {"sha": "9e477b7d7ee430be08aeef24c80e31a8b41981f6", "filename": "libstdc++-v3/testsuite/30_threads/stop_token/stop_source.cc", "status": "added", "additions": 75, "deletions": 0, "changes": 75, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/a0e1dcd44f9c0ee22f56b73660f36072633adb69/libstdc%2B%2B-v3%2Ftestsuite%2F30_threads%2Fstop_token%2Fstop_source.cc", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/a0e1dcd44f9c0ee22f56b73660f36072633adb69/libstdc%2B%2B-v3%2Ftestsuite%2F30_threads%2Fstop_token%2Fstop_source.cc", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libstdc%2B%2B-v3%2Ftestsuite%2F30_threads%2Fstop_token%2Fstop_source.cc?ref=a0e1dcd44f9c0ee22f56b73660f36072633adb69", "patch": "@@ -0,0 +1,75 @@\n+// Copyright (C) 2019 Free Software Foundation, Inc.\n+//\n+// This file is part of the GNU ISO C++ Library.  This library is free\n+// software; you can redistribute it and/or modify it under the\n+// terms of the GNU General Public License as published by the\n+// Free Software Foundation; either version 3, or (at your option)\n+// any later version.\n+\n+// This library is distributed in the hope that it will be useful,\n+// but WITHOUT ANY WARRANTY; without even the implied warranty of\n+// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n+// GNU General Public License for more details.\n+\n+// You should have received a copy of the GNU General Public License along\n+// with this library; see the file COPYING3.  If not see\n+// <http://www.gnu.org/licenses/>.\n+\n+// { dg-options \"-std=gnu++2a\" }\n+// { dg-do run { target c++2a } }\n+\n+#include <stop_token>\n+#include <testsuite_hooks.h>\n+\n+void\n+test01()\n+{\n+  std::stop_source ssrc;\n+  VERIFY( ssrc.stop_possible() );\n+  VERIFY( !ssrc.stop_requested() );\n+\n+  std::stop_source copy(ssrc);\n+  VERIFY( copy.stop_possible() );\n+  VERIFY( !copy.stop_requested() );\n+  VERIFY( ssrc.stop_possible() );\n+  VERIFY( !ssrc.stop_requested() );\n+\n+  std::stop_source move(std::move(ssrc));\n+  VERIFY( move.stop_possible() );\n+  VERIFY( !move.stop_requested() );\n+  VERIFY( copy.stop_possible() );\n+  VERIFY( !copy.stop_requested() );\n+  VERIFY( !ssrc.stop_possible() );\n+  VERIFY( !ssrc.stop_requested() );\n+}\n+\n+void\n+test02()\n+{\n+  // stop_source(nostopstate_t) constructor is explicit:\n+  static_assert(!std::is_convertible_v<std::nostopstate_t, std::stop_source>);\n+\n+  std::stop_source ssrc(std::nostopstate);\n+  VERIFY( !ssrc.stop_possible() );\n+  VERIFY( !ssrc.stop_requested() );\n+\n+  std::stop_source copy(ssrc);\n+  VERIFY( !copy.stop_possible() );\n+  VERIFY( !copy.stop_requested() );\n+  VERIFY( !ssrc.stop_possible() );\n+  VERIFY( !ssrc.stop_requested() );\n+\n+  std::stop_source move(std::move(ssrc));\n+  VERIFY( !move.stop_possible() );\n+  VERIFY( !move.stop_requested() );\n+  VERIFY( !copy.stop_possible() );\n+  VERIFY( !copy.stop_requested() );\n+  VERIFY( !ssrc.stop_possible() );\n+  VERIFY( !ssrc.stop_requested() );\n+}\n+\n+int main()\n+{\n+  test01();\n+  test02();\n+}"}, {"sha": "f0772c1d80fb10f78a4c204f3c2c4d6dabf34a08", "filename": "libstdc++-v3/testsuite/30_threads/stop_token/stop_token.cc", "status": "modified", "additions": 2, "deletions": 6, "changes": 8, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/a0e1dcd44f9c0ee22f56b73660f36072633adb69/libstdc%2B%2B-v3%2Ftestsuite%2F30_threads%2Fstop_token%2Fstop_token.cc", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/a0e1dcd44f9c0ee22f56b73660f36072633adb69/libstdc%2B%2B-v3%2Ftestsuite%2F30_threads%2Fstop_token%2Fstop_token.cc", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libstdc%2B%2B-v3%2Ftestsuite%2F30_threads%2Fstop_token%2Fstop_token.cc?ref=a0e1dcd44f9c0ee22f56b73660f36072633adb69", "patch": "@@ -15,13 +15,10 @@\n // with this library; see the file COPYING3.  If not see\n // <http://www.gnu.org/licenses/>.\n \n-// { dg-options \"-std=gnu++2a -pthread\" }\n-// { dg-do run }\n-// { dg-require-effective-target c++2a }\n-// { dg-require-effective-target pthread }\n+// { dg-options \"-std=gnu++2a\" }\n+// { dg-do run { target c++2a } }\n \n #include <stop_token>\n-#include <iostream>\n #include <testsuite_hooks.h>\n \n int main()\n@@ -41,7 +38,6 @@ int main()\n   // register callback\n   bool cb1called{false};\n   auto cb1 = [&]{\n-               std::cout << \"cb1\" << std::endl;\n                cb1called = true;\n              };\n   {"}]}