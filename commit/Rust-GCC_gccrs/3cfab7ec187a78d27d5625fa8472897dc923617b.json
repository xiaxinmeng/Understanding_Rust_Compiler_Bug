{"sha": "3cfab7ec187a78d27d5625fa8472897dc923617b", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6M2NmYWI3ZWMxODdhNzhkMjdkNTYyNWZhODQ3Mjg5N2RjOTIzNjE3Yg==", "commit": {"author": {"name": "Geoffrey Keating", "email": "geoffk@redhat.com", "date": "2002-07-24T23:01:07Z"}, "committer": {"name": "Geoffrey Keating", "email": "geoffk@gcc.gnu.org", "date": "2002-07-24T23:01:07Z"}, "message": "In cp/ChangeLog:\n\n\t* tree.c (cp_build_qualified_type_real): When copying\n\tpointer-to-method types, unshare the record that holds\n\tthe cached pointer-to-member-function type.\nIn testsuite/ChangeLog:\n\t* g++.dg/other/ptrmem4.C: New testcase.\n\nFrom-SVN: r55725", "tree": {"sha": "6463dfec266ba39f4994dd525a32dbb69233c8a6", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/6463dfec266ba39f4994dd525a32dbb69233c8a6"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/3cfab7ec187a78d27d5625fa8472897dc923617b", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/3cfab7ec187a78d27d5625fa8472897dc923617b", "html_url": "https://github.com/Rust-GCC/gccrs/commit/3cfab7ec187a78d27d5625fa8472897dc923617b", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/3cfab7ec187a78d27d5625fa8472897dc923617b/comments", "author": null, "committer": null, "parents": [{"sha": "eb5da24bed4710f5c1fa9be221d22ddbeb44f583", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/eb5da24bed4710f5c1fa9be221d22ddbeb44f583", "html_url": "https://github.com/Rust-GCC/gccrs/commit/eb5da24bed4710f5c1fa9be221d22ddbeb44f583"}], "stats": {"total": 36, "additions": 32, "deletions": 4}, "files": [{"sha": "659ecfa5f3b4cc7159c628e3a074ca05c89ca4bc", "filename": "gcc/cp/ChangeLog", "status": "modified", "additions": 6, "deletions": 0, "changes": 6, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/3cfab7ec187a78d27d5625fa8472897dc923617b/gcc%2Fcp%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/3cfab7ec187a78d27d5625fa8472897dc923617b/gcc%2Fcp%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fcp%2FChangeLog?ref=3cfab7ec187a78d27d5625fa8472897dc923617b", "patch": "@@ -1,3 +1,9 @@\n+2002-07-24  Geoffrey Keating  <geoffk@redhat.com>\n+\n+\t* tree.c (cp_build_qualified_type_real): When copying\n+\tpointer-to-method types, unshare the record that holds\n+\tthe cached pointer-to-member-function type.\n+\n 2002-07-23  Neil Booth  <neil@daikokuya.co.uk>\n \n \t* cp-tree.h (FILE_FUNCTION_PREFIX_LEN): Remove."}, {"sha": "ea456f00b5fd52392724242016c9581f7c6731f3", "filename": "gcc/cp/tree.c", "status": "modified", "additions": 4, "deletions": 4, "changes": 8, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/3cfab7ec187a78d27d5625fa8472897dc923617b/gcc%2Fcp%2Ftree.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/3cfab7ec187a78d27d5625fa8472897dc923617b/gcc%2Fcp%2Ftree.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fcp%2Ftree.c?ref=3cfab7ec187a78d27d5625fa8472897dc923617b", "patch": "@@ -644,13 +644,13 @@ cp_build_qualified_type_real (type, type_quals, complain)\n   result = build_qualified_type (type, type_quals);\n \n   /* If this was a pointer-to-method type, and we just made a copy,\n-     then we need to clear the cached associated\n-     pointer-to-member-function type; it is not valid for the new\n-     type.  */\n+     then we need to unshare the record that holds the cached\n+     pointer-to-member-function type, because these will be distinct\n+     between the unqualified and qualified types.  */\n   if (result != type \n       && TREE_CODE (type) == POINTER_TYPE\n       && TREE_CODE (TREE_TYPE (type)) == METHOD_TYPE)\n-    TYPE_SET_PTRMEMFUNC_TYPE (result, NULL_TREE);\n+    TYPE_LANG_SPECIFIC (result) = NULL;\n \n   return result;\n }"}, {"sha": "90da516a3e83018eb6ceba79e3279e051c857b45", "filename": "gcc/testsuite/ChangeLog", "status": "modified", "additions": 4, "deletions": 0, "changes": 4, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/3cfab7ec187a78d27d5625fa8472897dc923617b/gcc%2Ftestsuite%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/3cfab7ec187a78d27d5625fa8472897dc923617b/gcc%2Ftestsuite%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2FChangeLog?ref=3cfab7ec187a78d27d5625fa8472897dc923617b", "patch": "@@ -1,3 +1,7 @@\n+2002-07-24  Geoffrey Keating  <geoffk@redhat.com>\n+\n+\t* g++.dg/other/ptrmem4.C: New testcase.\n+\n 2002-07-24  Richard Henderson  <rth@redhat.com>\n \n \t* gcc.c-torture/execute/loop-2e.c: Rewrite for 64 bit and no mmap."}, {"sha": "4f3f541e583139e7d48ea2ba43397f3660a2465e", "filename": "gcc/testsuite/g++.dg/other/ptrmem4.C", "status": "added", "additions": 18, "deletions": 0, "changes": 18, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/3cfab7ec187a78d27d5625fa8472897dc923617b/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Fother%2Fptrmem4.C", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/3cfab7ec187a78d27d5625fa8472897dc923617b/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Fother%2Fptrmem4.C", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Fother%2Fptrmem4.C?ref=3cfab7ec187a78d27d5625fa8472897dc923617b", "patch": "@@ -0,0 +1,18 @@\n+// Bug: This checks that the pointer-to-member-function type is not\n+// shared between differently-qualified pointer-to-method types.\n+\n+// { dg-do compile }\n+struct A\n+{ \n+  void f () {}\n+};\n+\n+void (A::*const cp)() = &A::f;\n+\n+int main ()\n+{ \n+  void (A::* p)();\n+  void (A::** ip)() = &p;\n+\n+  *ip = &A::f;\n+}"}]}