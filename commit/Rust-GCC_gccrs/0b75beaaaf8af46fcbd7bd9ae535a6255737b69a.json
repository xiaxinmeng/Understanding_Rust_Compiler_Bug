{"sha": "0b75beaaaf8af46fcbd7bd9ae535a6255737b69a", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6MGI3NWJlYWFhZjhhZjQ2ZmNiZDdiZDlhZTUzNWE2MjU1NzM3YjY5YQ==", "commit": {"author": {"name": "Eric Botcazou", "email": "ebotcazou@libertysurf.fr", "date": "2003-09-17T07:11:01Z"}, "committer": {"name": "Eric Botcazou", "email": "ebotcazou@gcc.gnu.org", "date": "2003-09-17T07:11:01Z"}, "message": "re PR rtl-optimization/11646 (ICE in commit_one_edge_insertion with -fnon-call-exceptions -fgcse -O)\n\n\tPR optimization/11646\n\t* cfgrtl.c (purge_dead_edges) [JUMP_INSN]: Rematerialize the\n\tEDGE_ABNORMAL flag for EH edges.\n\t* toplev.c (rest_of_handle_cse): Delete unreachable blocks\n\tif dead edges were purged.\n\nFrom-SVN: r71455", "tree": {"sha": "3e48c1b60504587e9bfbfbaab16721bd61423b08", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/3e48c1b60504587e9bfbfbaab16721bd61423b08"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/0b75beaaaf8af46fcbd7bd9ae535a6255737b69a", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/0b75beaaaf8af46fcbd7bd9ae535a6255737b69a", "html_url": "https://github.com/Rust-GCC/gccrs/commit/0b75beaaaf8af46fcbd7bd9ae535a6255737b69a", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/0b75beaaaf8af46fcbd7bd9ae535a6255737b69a/comments", "author": {"login": "ebotcazou", "id": 48091907, "node_id": "MDQ6VXNlcjQ4MDkxOTA3", "avatar_url": "https://avatars.githubusercontent.com/u/48091907?v=4", "gravatar_id": "", "url": "https://api.github.com/users/ebotcazou", "html_url": "https://github.com/ebotcazou", "followers_url": "https://api.github.com/users/ebotcazou/followers", "following_url": "https://api.github.com/users/ebotcazou/following{/other_user}", "gists_url": "https://api.github.com/users/ebotcazou/gists{/gist_id}", "starred_url": "https://api.github.com/users/ebotcazou/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/ebotcazou/subscriptions", "organizations_url": "https://api.github.com/users/ebotcazou/orgs", "repos_url": "https://api.github.com/users/ebotcazou/repos", "events_url": "https://api.github.com/users/ebotcazou/events{/privacy}", "received_events_url": "https://api.github.com/users/ebotcazou/received_events", "type": "User", "site_admin": false}, "committer": null, "parents": [{"sha": "936346797b01c6f191bd904f1a6bdb36ab43317d", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/936346797b01c6f191bd904f1a6bdb36ab43317d", "html_url": "https://github.com/Rust-GCC/gccrs/commit/936346797b01c6f191bd904f1a6bdb36ab43317d"}], "stats": {"total": 84, "additions": 81, "deletions": 3}, "files": [{"sha": "aa323e23d745cec30ec3cd0aa6ff9c6813d2decf", "filename": "gcc/ChangeLog", "status": "modified", "additions": 8, "deletions": 0, "changes": 8, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/0b75beaaaf8af46fcbd7bd9ae535a6255737b69a/gcc%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/0b75beaaaf8af46fcbd7bd9ae535a6255737b69a/gcc%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2FChangeLog?ref=0b75beaaaf8af46fcbd7bd9ae535a6255737b69a", "patch": "@@ -1,3 +1,11 @@\n+2003-09-17  Eric Botcazou  <ebotcazou@libertysurf.fr>\n+\n+\tPR optimization/11646\n+\t* cfgrtl.c (purge_dead_edges) [JUMP_INSN]: Rematerialize the\n+\tEDGE_ABNORMAL flag for EH edges.\n+\t* toplev.c (rest_of_handle_cse): Delete unreachable blocks\n+\tif dead edges were purged.\n+\n 2003-09-16  Bernardo Innocenti  <bernie@develer.com>\n \n \t* config/m68k/m68k.h (TARGET_CPU_CPP_BUILTINS): Add target predefines."}, {"sha": "f383438e26b6ee3e6b57641336569156fb8d7506", "filename": "gcc/cfgrtl.c", "status": "modified", "additions": 6, "deletions": 2, "changes": 8, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/0b75beaaaf8af46fcbd7bd9ae535a6255737b69a/gcc%2Fcfgrtl.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/0b75beaaaf8af46fcbd7bd9ae535a6255737b69a/gcc%2Fcfgrtl.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fcfgrtl.c?ref=0b75beaaaf8af46fcbd7bd9ae535a6255737b69a", "patch": "@@ -2255,8 +2255,12 @@ purge_dead_edges (basic_block bb)\n \t    continue;\n \t  else if ((e->flags & EDGE_EH) && can_throw_internal (insn))\n \t    /* Keep the edges that correspond to exceptions thrown by\n-\t       this instruction.  */\n-\t    continue;\n+\t       this instruction and rematerialize the EDGE_ABNORMAL\n+\t       flag we just cleared above.  */\n+\t    {\n+\t      e->flags |= EDGE_ABNORMAL;\n+\t      continue;\n+\t    }\n \n \t  /* We do not need this edge.  */\n \t  bb->flags |= BB_DIRTY;"}, {"sha": "fae6be7893f944f647598a7fe0d88ea9b548a472", "filename": "gcc/testsuite/ChangeLog", "status": "modified", "additions": 4, "deletions": 0, "changes": 4, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/0b75beaaaf8af46fcbd7bd9ae535a6255737b69a/gcc%2Ftestsuite%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/0b75beaaaf8af46fcbd7bd9ae535a6255737b69a/gcc%2Ftestsuite%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2FChangeLog?ref=0b75beaaaf8af46fcbd7bd9ae535a6255737b69a", "patch": "@@ -1,3 +1,7 @@\n+2003-09-17  Eric Botcazou  <ebotcazou@libertysurf.fr>\n+\n+\t* g++.dg/opt/cfg3.C: New test.\n+\n 2003-09-16  Kriang Lerdsuwanakij  <lerdsuwa@users.sourceforge.net>\n \n \tPR c++/7939"}, {"sha": "123c2f5157ba77ba453658ea0db60a7060ea322b", "filename": "gcc/testsuite/g++.dg/opt/cfg3.C", "status": "added", "additions": 61, "deletions": 0, "changes": 61, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/0b75beaaaf8af46fcbd7bd9ae535a6255737b69a/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Fopt%2Fcfg3.C", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/0b75beaaaf8af46fcbd7bd9ae535a6255737b69a/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Fopt%2Fcfg3.C", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Fopt%2Fcfg3.C?ref=0b75beaaaf8af46fcbd7bd9ae535a6255737b69a", "patch": "@@ -0,0 +1,61 @@\n+// PR optimization/11646\n+// Origin: <nick@ilm.com>\n+\n+// This used to fail because the compiler inadvertently cleared\n+// the EDGE_ABNORMAL flag on a EDGE_EH edge and didn't delete\n+// unreachable blocks after CSE.\n+\n+// { dg-do compile }\n+// { dg-options \"-O -fgcse -fnon-call-exceptions\" }\n+\n+struct C\n+{\n+  int i;\n+};\n+\n+struct allocator\n+{\n+  ~allocator() throw() {}\n+};\n+\n+struct _Vector_alloc_base\n+{\n+  _Vector_alloc_base(const allocator& __a) {}\n+  allocator _M_data_allocator;\n+  struct C *_M_start, *_M_end_of_storage;\n+  void _M_deallocate(struct C* __p, unsigned int __n) {}\n+};\n+\n+struct _Vector_base : _Vector_alloc_base\n+{\n+  _Vector_base(const allocator& __a) : _Vector_alloc_base(__a) { }\n+  ~_Vector_base() { _M_deallocate(0, _M_end_of_storage - _M_start); }\n+};\n+\n+struct vector : _Vector_base\n+{\n+  vector(const allocator& __a = allocator()) : _Vector_base(__a) {}\n+  struct C& operator[](unsigned int __n) { return *_M_start; }\n+};\n+\n+struct A\n+{\n+  float l() const;\n+  A operator-(const A &) const;\n+  const A& operator=(float) const;\n+};\n+\n+struct B\n+{\n+  float d();\n+};\n+\n+float f(const A& a, B& b)\n+{\n+  vector vc;\n+  int index = vc[0].i;\n+  A aa;\n+  float d = (aa - a).l();\n+  if (d > b.d()) aa = 0;\n+    return b.d();\n+}"}, {"sha": "91409bf713494cd91220d37e9b4a7cc0eae28b30", "filename": "gcc/toplev.c", "status": "modified", "additions": 2, "deletions": 1, "changes": 3, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/0b75beaaaf8af46fcbd7bd9ae535a6255737b69a/gcc%2Ftoplev.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/0b75beaaaf8af46fcbd7bd9ae535a6255737b69a/gcc%2Ftoplev.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftoplev.c?ref=0b75beaaaf8af46fcbd7bd9ae535a6255737b69a", "patch": "@@ -2846,7 +2846,8 @@ rest_of_handle_cse (tree decl, rtx insns)\n   tem = cse_main (insns, max_reg_num (), 0, rtl_dump_file);\n   if (tem)\n     rebuild_jump_labels (insns);\n-  purge_all_dead_edges (0);\n+  if (purge_all_dead_edges (0))\n+    delete_unreachable_blocks ();\n \n   delete_trivially_dead_insns (insns, max_reg_num ());\n "}]}