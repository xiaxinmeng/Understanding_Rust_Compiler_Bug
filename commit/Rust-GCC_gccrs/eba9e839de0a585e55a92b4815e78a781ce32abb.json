{"sha": "eba9e839de0a585e55a92b4815e78a781ce32abb", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6ZWJhOWU4MzlkZTBhNTg1ZTU1YTkyYjQ4MTVlNzhhNzgxY2UzMmFiYg==", "commit": {"author": {"name": "Marek Polacek", "email": "polacek@redhat.com", "date": "2016-02-08T15:40:33Z"}, "committer": {"name": "Marek Polacek", "email": "mpolacek@gcc.gnu.org", "date": "2016-02-08T15:40:33Z"}, "message": "re PR c++/69688 (-Wsign-compare causes bogus error: size of array \u2018uc_code\u2019 is not an integral constant-expression)\n\n\tPR c++/69688\n\t* constexpr.c (clear_cv_and_fold_caches): Renamed from clear_cv_cache.\n\tCall clear_fold_cache.\n\t* cp-tree.h: Adjust declaration.\n\t* decl.c (finish_enum_value_list): Call clear_cv_and_fold_caches\n\trather than clear_cv_cache and clear_fold_cache.\n\t* typeck2.c (store_init_value): Call clear_cv_and_fold_caches.\n\n\t* g++.dg/init/const12.C: New test.\n\nFrom-SVN: r233220", "tree": {"sha": "e362aee6c662fd0043e5bdca1a8c68c79dad4c73", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/e362aee6c662fd0043e5bdca1a8c68c79dad4c73"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/eba9e839de0a585e55a92b4815e78a781ce32abb", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/eba9e839de0a585e55a92b4815e78a781ce32abb", "html_url": "https://github.com/Rust-GCC/gccrs/commit/eba9e839de0a585e55a92b4815e78a781ce32abb", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/eba9e839de0a585e55a92b4815e78a781ce32abb/comments", "author": {"login": "mpolacek", "id": 10496300, "node_id": "MDQ6VXNlcjEwNDk2MzAw", "avatar_url": "https://avatars.githubusercontent.com/u/10496300?v=4", "gravatar_id": "", "url": "https://api.github.com/users/mpolacek", "html_url": "https://github.com/mpolacek", "followers_url": "https://api.github.com/users/mpolacek/followers", "following_url": "https://api.github.com/users/mpolacek/following{/other_user}", "gists_url": "https://api.github.com/users/mpolacek/gists{/gist_id}", "starred_url": "https://api.github.com/users/mpolacek/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/mpolacek/subscriptions", "organizations_url": "https://api.github.com/users/mpolacek/orgs", "repos_url": "https://api.github.com/users/mpolacek/repos", "events_url": "https://api.github.com/users/mpolacek/events{/privacy}", "received_events_url": "https://api.github.com/users/mpolacek/received_events", "type": "User", "site_admin": false}, "committer": null, "parents": [{"sha": "2158532f314617f555389157fb46b86c5ef935b3", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/2158532f314617f555389157fb46b86c5ef935b3", "html_url": "https://github.com/Rust-GCC/gccrs/commit/2158532f314617f555389157fb46b86c5ef935b3"}], "stats": {"total": 48, "additions": 43, "deletions": 5}, "files": [{"sha": "32fbe6f6163a256226b5dff81ce47e3c62836c50", "filename": "gcc/cp/ChangeLog", "status": "modified", "additions": 10, "deletions": 0, "changes": 10, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/eba9e839de0a585e55a92b4815e78a781ce32abb/gcc%2Fcp%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/eba9e839de0a585e55a92b4815e78a781ce32abb/gcc%2Fcp%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fcp%2FChangeLog?ref=eba9e839de0a585e55a92b4815e78a781ce32abb", "patch": "@@ -1,3 +1,13 @@\n+2016-02-08  Marek Polacek  <polacek@redhat.com>\n+\n+\tPR c++/69688\n+\t* constexpr.c (clear_cv_and_fold_caches): Renamed from clear_cv_cache.\n+\tCall clear_fold_cache.\n+\t* cp-tree.h: Adjust declaration.\n+\t* decl.c (finish_enum_value_list): Call clear_cv_and_fold_caches\n+\trather than clear_cv_cache and clear_fold_cache.\n+\t* typeck2.c (store_init_value): Call clear_cv_and_fold_caches.\n+\n 2016-02-08  Jason Merrill  <jason@redhat.com>\n \n \t* cp-tree.h (CONV_FOLD, CONV_BACKEND_CONVERT): New."}, {"sha": "85fc64ed8cc90d2012a888c5cad9f16bb9dd5702", "filename": "gcc/cp/constexpr.c", "status": "modified", "additions": 3, "deletions": 2, "changes": 5, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/eba9e839de0a585e55a92b4815e78a781ce32abb/gcc%2Fcp%2Fconstexpr.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/eba9e839de0a585e55a92b4815e78a781ce32abb/gcc%2Fcp%2Fconstexpr.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fcp%2Fconstexpr.c?ref=eba9e839de0a585e55a92b4815e78a781ce32abb", "patch": "@@ -4098,12 +4098,13 @@ maybe_constant_value (tree t, tree decl)\n   return ret;\n }\n \n-/* Dispose of the whole CV_CACHE.  */\n+/* Dispose of the whole CV_CACHE and FOLD_CACHE.  */\n \n void\n-clear_cv_cache (void)\n+clear_cv_and_fold_caches (void)\n {\n   gt_cleare_cache (cv_cache);\n+  clear_fold_cache ();\n }\n \n /* Like maybe_constant_value but first fully instantiate the argument."}, {"sha": "ead017edab2ad3a8ad211a464d75fa6075c6ab8d", "filename": "gcc/cp/cp-tree.h", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/eba9e839de0a585e55a92b4815e78a781ce32abb/gcc%2Fcp%2Fcp-tree.h", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/eba9e839de0a585e55a92b4815e78a781ce32abb/gcc%2Fcp%2Fcp-tree.h", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fcp%2Fcp-tree.h?ref=eba9e839de0a585e55a92b4815e78a781ce32abb", "patch": "@@ -6922,7 +6922,7 @@ extern bool var_in_constexpr_fn                 (tree);\n extern void explain_invalid_constexpr_fn        (tree);\n extern vec<tree> cx_error_context               (void);\n extern tree fold_sizeof_expr\t\t\t(tree);\n-extern void clear_cv_cache\t\t\t(void);\n+extern void clear_cv_and_fold_caches\t\t(void);\n \n /* In c-family/cilk.c */\n extern bool cilk_valid_spawn                    (tree);"}, {"sha": "11f7ce615a490463b841985d7bc67d43bca9e7f6", "filename": "gcc/cp/decl.c", "status": "modified", "additions": 1, "deletions": 2, "changes": 3, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/eba9e839de0a585e55a92b4815e78a781ce32abb/gcc%2Fcp%2Fdecl.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/eba9e839de0a585e55a92b4815e78a781ce32abb/gcc%2Fcp%2Fdecl.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fcp%2Fdecl.c?ref=eba9e839de0a585e55a92b4815e78a781ce32abb", "patch": "@@ -13414,8 +13414,7 @@ finish_enum_value_list (tree enumtype)\n \n   /* Each enumerator now has the type of its enumeration.  Clear the cache\n      so that this change in types doesn't confuse us later on.  */\n-  clear_cv_cache ();\n-  clear_fold_cache ();\n+  clear_cv_and_fold_caches ();\n }\n \n /* Finishes the enum type. This is called only the first time an"}, {"sha": "2a76c96c7d48d27e8082fc14924ccc02e132ed0c", "filename": "gcc/cp/typeck2.c", "status": "modified", "additions": 3, "deletions": 0, "changes": 3, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/eba9e839de0a585e55a92b4815e78a781ce32abb/gcc%2Fcp%2Ftypeck2.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/eba9e839de0a585e55a92b4815e78a781ce32abb/gcc%2Fcp%2Ftypeck2.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fcp%2Ftypeck2.c?ref=eba9e839de0a585e55a92b4815e78a781ce32abb", "patch": "@@ -837,6 +837,9 @@ store_init_value (tree decl, tree init, vec<tree, va_gc>** cleanups, int flags)\n     /* Handle aggregate NSDMI in non-constant initializers, too.  */\n     value = replace_placeholders (value, decl);\n \n+  /* DECL may change value; purge caches.  */\n+  clear_cv_and_fold_caches ();\n+\n   /* If the initializer is not a constant, fill in DECL_INITIAL with\n      the bits that are constant, and then return an expression that\n      will perform the dynamic initialization.  */"}, {"sha": "b30f01d0ad2f80ef43df6349a23b5f7acf72be9b", "filename": "gcc/testsuite/ChangeLog", "status": "modified", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/eba9e839de0a585e55a92b4815e78a781ce32abb/gcc%2Ftestsuite%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/eba9e839de0a585e55a92b4815e78a781ce32abb/gcc%2Ftestsuite%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2FChangeLog?ref=eba9e839de0a585e55a92b4815e78a781ce32abb", "patch": "@@ -1,3 +1,8 @@\n+2016-02-08  Marek Polacek  <polacek@redhat.com>\n+\n+\tPR c++/69688\n+\t* g++.dg/init/const12.C: New test.\n+\n 2016-02-08  Bernd Schmidt  <bschmidt@redhat.com>\n \n \tPR target/60410"}, {"sha": "2f6f9b280fb5d2b385ede5dd1b1e41fc08c0dfee", "filename": "gcc/testsuite/g++.dg/init/const12.C", "status": "added", "additions": 20, "deletions": 0, "changes": 20, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/eba9e839de0a585e55a92b4815e78a781ce32abb/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Finit%2Fconst12.C", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/eba9e839de0a585e55a92b4815e78a781ce32abb/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Finit%2Fconst12.C", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Finit%2Fconst12.C?ref=eba9e839de0a585e55a92b4815e78a781ce32abb", "patch": "@@ -0,0 +1,20 @@\n+// PR c++/69688\n+// { dg-do compile }\n+// { dg-options \"-Wsign-compare\" }\n+\n+struct S\n+{\n+  static const int s;\n+  static const char c[];\n+  static wchar_t w[];\n+\n+  S ()\n+    {\n+      for (int i = 0; i < s; i++)\n+\tw[i] = 0;\n+    }\n+};\n+\n+const char S::c[] = \"x\";\n+const int S::s = sizeof (S::c) - 1;\n+wchar_t S::w[S::s];"}]}