{"sha": "86e9d05f3541b1142799a2772dab463bc696221c", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6ODZlOWQwNWYzNTQxYjExNDI3OTlhMjc3MmRhYjQ2M2JjNjk2MjIxYw==", "commit": {"author": {"name": "Tobias Schl\u00fcter", "email": "tobi@gcc.gnu.org", "date": "2007-09-24T21:15:00Z"}, "committer": {"name": "Tobias Schl\u00fcter", "email": "tobi@gcc.gnu.org", "date": "2007-09-24T21:15:00Z"}, "message": "re PR fortran/33269 (Diagnose missing \"(\" in  \"PRINT ('a'),\")\n\nPR fortran/33269\nfortran/\n* io.c (check_format_string): Move NULL and constant checks into\nthis function.\n(check_io_constraints): Call gfc_simplify_expr() before calling\ncheck_format_string().  Remove NULL and constant checks.\ntestsuite/\n* gfortran.dg/fmt_error_2.f90: New.\n\nFrom-SVN: r128732", "tree": {"sha": "6fd80c148ea321cfd2bc3f25ffe2aa5985e2ff64", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/6fd80c148ea321cfd2bc3f25ffe2aa5985e2ff64"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/86e9d05f3541b1142799a2772dab463bc696221c", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/86e9d05f3541b1142799a2772dab463bc696221c", "html_url": "https://github.com/Rust-GCC/gccrs/commit/86e9d05f3541b1142799a2772dab463bc696221c", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/86e9d05f3541b1142799a2772dab463bc696221c/comments", "author": {"login": "TobiSchluter", "id": 11887541, "node_id": "MDQ6VXNlcjExODg3NTQx", "avatar_url": "https://avatars.githubusercontent.com/u/11887541?v=4", "gravatar_id": "", "url": "https://api.github.com/users/TobiSchluter", "html_url": "https://github.com/TobiSchluter", "followers_url": "https://api.github.com/users/TobiSchluter/followers", "following_url": "https://api.github.com/users/TobiSchluter/following{/other_user}", "gists_url": "https://api.github.com/users/TobiSchluter/gists{/gist_id}", "starred_url": "https://api.github.com/users/TobiSchluter/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/TobiSchluter/subscriptions", "organizations_url": "https://api.github.com/users/TobiSchluter/orgs", "repos_url": "https://api.github.com/users/TobiSchluter/repos", "events_url": "https://api.github.com/users/TobiSchluter/events{/privacy}", "received_events_url": "https://api.github.com/users/TobiSchluter/received_events", "type": "User", "site_admin": false}, "committer": {"login": "TobiSchluter", "id": 11887541, "node_id": "MDQ6VXNlcjExODg3NTQx", "avatar_url": "https://avatars.githubusercontent.com/u/11887541?v=4", "gravatar_id": "", "url": "https://api.github.com/users/TobiSchluter", "html_url": "https://github.com/TobiSchluter", "followers_url": "https://api.github.com/users/TobiSchluter/followers", "following_url": "https://api.github.com/users/TobiSchluter/following{/other_user}", "gists_url": "https://api.github.com/users/TobiSchluter/gists{/gist_id}", "starred_url": "https://api.github.com/users/TobiSchluter/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/TobiSchluter/subscriptions", "organizations_url": "https://api.github.com/users/TobiSchluter/orgs", "repos_url": "https://api.github.com/users/TobiSchluter/repos", "events_url": "https://api.github.com/users/TobiSchluter/events{/privacy}", "received_events_url": "https://api.github.com/users/TobiSchluter/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "c028b28617a47266de561005bd3680ad03f9b6e9", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/c028b28617a47266de561005bd3680ad03f9b6e9", "html_url": "https://github.com/Rust-GCC/gccrs/commit/c028b28617a47266de561005bd3680ad03f9b6e9"}], "stats": {"total": 58, "additions": 56, "deletions": 2}, "files": [{"sha": "fcf15997eb4d008d0c58837d3d79e52a2bbcbb9d", "filename": "gcc/fortran/ChangeLog", "status": "modified", "additions": 8, "deletions": 0, "changes": 8, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/86e9d05f3541b1142799a2772dab463bc696221c/gcc%2Ffortran%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/86e9d05f3541b1142799a2772dab463bc696221c/gcc%2Ffortran%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ffortran%2FChangeLog?ref=86e9d05f3541b1142799a2772dab463bc696221c", "patch": "@@ -1,3 +1,11 @@\n+2007-09-23  Tobias Schl\ufffdter  <tobi@gcc.gnu.org>\n+\n+\tPR fortran/33269\n+\t* io.c (check_format_string): Move NULL and constant checks into\n+\tthis function.\n+\t(check_io_constraints): Call gfc_simplify_expr() before calling\n+\tcheck_format_string().  Remove NULL and constant checks.\n+\n 2007-09-24  Francois-Xavier Coudert  <fxcoudert@gcc.gnu.org>\n \n \tPR fortran/33538"}, {"sha": "0e2a0cb7df2c0fe912243dc67407a869ee5e44a4", "filename": "gcc/fortran/io.c", "status": "modified", "additions": 5, "deletions": 2, "changes": 7, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/86e9d05f3541b1142799a2772dab463bc696221c/gcc%2Ffortran%2Fio.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/86e9d05f3541b1142799a2772dab463bc696221c/gcc%2Ffortran%2Fio.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ffortran%2Fio.c?ref=86e9d05f3541b1142799a2772dab463bc696221c", "patch": "@@ -919,6 +919,9 @@ check_format (bool is_input)\n static try\n check_format_string (gfc_expr *e, bool is_input)\n {\n+  if (!e || e->expr_type != EXPR_CONSTANT)\n+    return SUCCESS;\n+\n   mode = MODE_STRING;\n   format_string = e->value.character.string;\n   return check_format (is_input);\n@@ -2786,8 +2789,8 @@ if (condition) \\\n     }\n \n   expr = dt->format_expr;\n-  if (expr != NULL && expr->expr_type == EXPR_CONSTANT\n-      && check_format_string (expr, k == M_READ) == FAILURE)\n+  if (gfc_simplify_expr (expr, 0) == FAILURE\n+      || check_format_string (expr, k == M_READ) == FAILURE)\n     return MATCH_ERROR;\n \n   return m;"}, {"sha": "f4da1ddf0a249ddd955259d13ff63f1c947c2672", "filename": "gcc/testsuite/ChangeLog", "status": "modified", "additions": 8, "deletions": 0, "changes": 8, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/86e9d05f3541b1142799a2772dab463bc696221c/gcc%2Ftestsuite%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/86e9d05f3541b1142799a2772dab463bc696221c/gcc%2Ftestsuite%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2FChangeLog?ref=86e9d05f3541b1142799a2772dab463bc696221c", "patch": "@@ -1,3 +1,11 @@\n+2007-09-23  Tobias Schl\ufffdter  <tobi@gcc.gnu.org>\n+\n+\tPR fortran/33269\n+\t* io.c (check_format_string): Move NULL and constant checks into\n+\tthis function.\n+\t(check_io_constraints): Call gfc_simplify_expr() before calling\n+\tcheck_format_string().  Remove NULL and constant checks.\n+\n 2007-09-24  Roman Zippel <zippel@linux-m68k.org>\n \n \t* gcc.c-torture/execute/loop-2f.x: New. Disable test for m68k-linux."}, {"sha": "8fdaf9e3f2199118d3ecda5f651e27d61894d807", "filename": "gcc/testsuite/gfortran.dg/fmt_error_2.f90", "status": "added", "additions": 35, "deletions": 0, "changes": 35, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/86e9d05f3541b1142799a2772dab463bc696221c/gcc%2Ftestsuite%2Fgfortran.dg%2Ffmt_error_2.f90", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/86e9d05f3541b1142799a2772dab463bc696221c/gcc%2Ftestsuite%2Fgfortran.dg%2Ffmt_error_2.f90", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgfortran.dg%2Ffmt_error_2.f90?ref=86e9d05f3541b1142799a2772dab463bc696221c", "patch": "@@ -0,0 +1,35 @@\n+! { dg-do compile }\n+! PR 33269: we used to not simplify format strings before checking if\n+! they were valid, leading to a missed error.\n+\n+IMPLICIT CHARACTER*5 (h-z)\n+\n+CHARACTER*5 f\n+CHARACTER*5 bad, good\n+parameter(bad=\"a\", good=\"(a)\")\n+\n+PRINT ('a'), \"hello\" ! { dg-error \"Missing leading left parenthesis in format string\" }\n+WRITE (*, (\"a\")) \"error\"  ! { dg-error \"Missing leading left parenthesis in format string\" }\n+\n+PRINT 'a', \"hello\" ! { dg-error \"Missing leading left parenthesis in format string\" }\n+WRITE (*, \"a\") \"error\"  ! { dg-error \"Missing leading left parenthesis in format string\" }\n+WRITE (*, bad) \"error\"  ! { dg-error \"Missing leading left parenthesis in format string\" }\n+\n+PRINT 'a' // ', a', \"err\", \"or\"   ! { dg-error \"Missing leading left parenthesis in format string\" }\n+\n+PRINT '(' // 'a'  ! { dg-error \"Unexpected end of format string in format string\" }\n+\n+! the following are ok\n+PRINT \"(2f5.3)\", bar, foo\n+PRINT ' (a)', \"hello\"\n+WRITE (*, \" ((a))\") \"hello\"\n+print \"(a\" // \")\", \"all is fine\"\n+print good, \"great\"\n+\n+! verify that we haven't broken non-constant expressions\n+f = \"(f5.3)\"\n+print f, 3.14159\n+print (f), 2.71813\n+print implicitly_typed, \"something\"\n+write (*, implicitly_typed_as_well) \"something else\"\n+END"}]}