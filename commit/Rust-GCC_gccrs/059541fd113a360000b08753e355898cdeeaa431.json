{"sha": "059541fd113a360000b08753e355898cdeeaa431", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6MDU5NTQxZmQxMTNhMzYwMDAwYjA4NzUzZTM1NTg5OGNkZWVhYTQzMQ==", "commit": {"author": {"name": "Jan Beulich", "email": "jbeulich@suse.com", "date": "2016-07-01T14:23:24Z"}, "committer": {"name": "Jan Beulich", "email": "jbeulich@gcc.gnu.org", "date": "2016-07-01T14:23:24Z"}, "message": "check initializer to be zero in .bss-like sections\n\nJust like gas, which has recently learned to reject such initializers,\ngcc shouldn't accept such either.\n\ngcc/\n2016-07-01  Jan Beulich  <jbeulich@suse.com>\n\n\t* varasm.c (get_variable_section): Validate initializer in\n\tnamed .bss-like sections.\n\ngcc/testsuite/\n2016-07-01  Jan Beulich  <jbeulich@suse.com>\n\n\t* gcc.dg/bss.c: New.\n\nFrom-SVN: r237913", "tree": {"sha": "d6335a7ae0fa08c73f02972395d93d140ba010c9", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/d6335a7ae0fa08c73f02972395d93d140ba010c9"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/059541fd113a360000b08753e355898cdeeaa431", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/059541fd113a360000b08753e355898cdeeaa431", "html_url": "https://github.com/Rust-GCC/gccrs/commit/059541fd113a360000b08753e355898cdeeaa431", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/059541fd113a360000b08753e355898cdeeaa431/comments", "author": {"login": "jbeulich", "id": 5610135, "node_id": "MDQ6VXNlcjU2MTAxMzU=", "avatar_url": "https://avatars.githubusercontent.com/u/5610135?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jbeulich", "html_url": "https://github.com/jbeulich", "followers_url": "https://api.github.com/users/jbeulich/followers", "following_url": "https://api.github.com/users/jbeulich/following{/other_user}", "gists_url": "https://api.github.com/users/jbeulich/gists{/gist_id}", "starred_url": "https://api.github.com/users/jbeulich/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jbeulich/subscriptions", "organizations_url": "https://api.github.com/users/jbeulich/orgs", "repos_url": "https://api.github.com/users/jbeulich/repos", "events_url": "https://api.github.com/users/jbeulich/events{/privacy}", "received_events_url": "https://api.github.com/users/jbeulich/received_events", "type": "User", "site_admin": false}, "committer": null, "parents": [{"sha": "51433308bb18319f173f75339e1ac1eb2fe24e80", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/51433308bb18319f173f75339e1ac1eb2fe24e80", "html_url": "https://github.com/Rust-GCC/gccrs/commit/51433308bb18319f173f75339e1ac1eb2fe24e80"}], "stats": {"total": 30, "additions": 29, "deletions": 1}, "files": [{"sha": "4020a4e37d4046d68f990eaf166088ace9f15db2", "filename": "gcc/ChangeLog", "status": "modified", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/059541fd113a360000b08753e355898cdeeaa431/gcc%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/059541fd113a360000b08753e355898cdeeaa431/gcc%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2FChangeLog?ref=059541fd113a360000b08753e355898cdeeaa431", "patch": "@@ -1,3 +1,8 @@\n+2016-07-01  Jan Beulich  <jbeulich@suse.com>\n+\n+\t* varasm.c (get_variable_section): Validate initializer in\n+\tnamed .bss-like sections.\n+\n 2016-07-01  Kelvin Nilsen  <kelvin@gcc.gnu.org>\n \n \t* config/rs6000/altivec.md (*altivec_vpermr_<mode>_internal):"}, {"sha": "382c172c77800f3aede4bcf3805822e96fd7ebb9", "filename": "gcc/testsuite/ChangeLog", "status": "modified", "additions": 4, "deletions": 0, "changes": 4, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/059541fd113a360000b08753e355898cdeeaa431/gcc%2Ftestsuite%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/059541fd113a360000b08753e355898cdeeaa431/gcc%2Ftestsuite%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2FChangeLog?ref=059541fd113a360000b08753e355898cdeeaa431", "patch": "@@ -1,3 +1,7 @@\n+2016-07-01  Jan Beulich  <jbeulich@suse.com>\n+\n+\t* gcc.dg/bss.c: New.\n+\n 2016-07-01  Peter Bergner  <bergner@vnet.ibm.com>\n \n \tPR target/71698"}, {"sha": "af8d0c634fe8b3e10d379104b69fe4810e380f59", "filename": "gcc/testsuite/gcc.dg/bss.c", "status": "added", "additions": 8, "deletions": 0, "changes": 8, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/059541fd113a360000b08753e355898cdeeaa431/gcc%2Ftestsuite%2Fgcc.dg%2Fbss.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/059541fd113a360000b08753e355898cdeeaa431/gcc%2Ftestsuite%2Fgcc.dg%2Fbss.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgcc.dg%2Fbss.c?ref=059541fd113a360000b08753e355898cdeeaa431", "patch": "@@ -0,0 +1,8 @@\n+/* Test non-zero initializers in .bss-like sections get properly refused.  */\n+/* { dg-do compile } */\n+/* { dg-require-named-sections \"\" } */\n+\n+int __attribute__((section(\".bss.local\"))) x = 1; /* { dg-error \"\" \"zero init\" } */\n+int *__attribute__((section(\".bss.local\"))) px = &x; /* { dg-error \"\" \"zero init\" } */\n+int __attribute__((section(\".bss.local\"))) y = 0;\n+int *__attribute__((section(\".bss.local\"))) py = (void*)0;"}, {"sha": "6a8fb81e41f95a5815e6c017caa31d2728a92183", "filename": "gcc/varasm.c", "status": "modified", "additions": 12, "deletions": 1, "changes": 13, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/059541fd113a360000b08753e355898cdeeaa431/gcc%2Fvarasm.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/059541fd113a360000b08753e355898cdeeaa431/gcc%2Fvarasm.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fvarasm.c?ref=059541fd113a360000b08753e355898cdeeaa431", "patch": "@@ -1150,7 +1150,18 @@ get_variable_section (tree decl, bool prefer_noswitch_p)\n \n   resolve_unique_section (decl, reloc, flag_data_sections);\n   if (IN_NAMED_SECTION (decl))\n-    return get_named_section (decl, NULL, reloc);\n+    {\n+      section *sect = get_named_section (decl, NULL, reloc);\n+\n+      if ((sect->common.flags & SECTION_BSS) && !bss_initializer_p (decl))\n+\t{\n+\t  error_at (DECL_SOURCE_LOCATION (decl),\n+\t\t    \"only zero initializers are allowed in section %qs\",\n+\t\t    sect->named.name);\n+\t  DECL_INITIAL (decl) = error_mark_node;\n+\t}\n+      return sect;\n+    }\n \n   if (ADDR_SPACE_GENERIC_P (as)\n       && !DECL_THREAD_LOCAL_P (decl)"}]}