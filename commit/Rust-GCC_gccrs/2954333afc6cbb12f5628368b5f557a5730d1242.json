{"sha": "2954333afc6cbb12f5628368b5f557a5730d1242", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6Mjk1NDMzM2FmYzZjYmIxMmY1NjI4MzY4YjVmNTU3YTU3MzBkMTI0Mg==", "commit": {"author": {"name": "Mark Mitchell", "email": "mark@codesourcery.com", "date": "2006-06-16T02:33:35Z"}, "committer": {"name": "Mark Mitchell", "email": "mmitchel@gcc.gnu.org", "date": "2006-06-16T02:33:35Z"}, "message": "re PR c++/27666 (ICE with volatile in conditional expression)\n\n\tPR c++/27666\n\t* call.c (build_conditional_expr): Robustify.\n\tPR c++/27666\n\t* g++.dg/expr/cond9.C: New test.\n\nFrom-SVN: r114702", "tree": {"sha": "94e1a3c01c007f49cf8e800c566242a2eb9a9642", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/94e1a3c01c007f49cf8e800c566242a2eb9a9642"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/2954333afc6cbb12f5628368b5f557a5730d1242", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/2954333afc6cbb12f5628368b5f557a5730d1242", "html_url": "https://github.com/Rust-GCC/gccrs/commit/2954333afc6cbb12f5628368b5f557a5730d1242", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/2954333afc6cbb12f5628368b5f557a5730d1242/comments", "author": null, "committer": null, "parents": [{"sha": "a95799ec5fe4e00d99fc1545ff0ea64d10e7e0b9", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/a95799ec5fe4e00d99fc1545ff0ea64d10e7e0b9", "html_url": "https://github.com/Rust-GCC/gccrs/commit/a95799ec5fe4e00d99fc1545ff0ea64d10e7e0b9"}], "stats": {"total": 25, "additions": 25, "deletions": 0}, "files": [{"sha": "778658afc25730f9bc4f969ee93a202162986f60", "filename": "gcc/cp/ChangeLog", "status": "modified", "additions": 3, "deletions": 0, "changes": 3, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/2954333afc6cbb12f5628368b5f557a5730d1242/gcc%2Fcp%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/2954333afc6cbb12f5628368b5f557a5730d1242/gcc%2Fcp%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fcp%2FChangeLog?ref=2954333afc6cbb12f5628368b5f557a5730d1242", "patch": "@@ -1,5 +1,8 @@\n 2006-06-15  Mark Mitchell  <mark@codesourcery.com>\n \n+\tPR c++/27666\n+\t* call.c (build_conditional_expr): Robustify.\n+\n \tPR c++/27640\n \t* pt.c (instantiate_template): Set processing_template_decl to\n \tzero while performing substitutions."}, {"sha": "cd82732d11451755f1ed795306534581ef7e0d2b", "filename": "gcc/cp/call.c", "status": "modified", "additions": 9, "deletions": 0, "changes": 9, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/2954333afc6cbb12f5628368b5f557a5730d1242/gcc%2Fcp%2Fcall.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/2954333afc6cbb12f5628368b5f557a5730d1242/gcc%2Fcp%2Fcall.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fcp%2Fcall.c?ref=2954333afc6cbb12f5628368b5f557a5730d1242", "patch": "@@ -3322,12 +3322,21 @@ build_conditional_expr (tree arg1, tree arg2, tree arg3)\n \t  arg2 = convert_like (conv2, arg2);\n \t  arg2 = convert_from_reference (arg2);\n \t  arg2_type = TREE_TYPE (arg2);\n+\t  /* Even if CONV2 is a valid conversion, the result of the\n+\t     conversion may be invalid.  For example, if ARG3 has type\n+\t     \"volatile X\", and X does not have a copy constructor\n+\t     accepting a \"volatile X&\", then even if ARG2 can be\n+\t     converted to X, the conversion will fail.  */\n+\t  if (error_operand_p (arg2))\n+\t    result = error_mark_node;\n \t}\n       else if (conv3 && (!conv3->bad_p || !conv2))\n \t{\n \t  arg3 = convert_like (conv3, arg3);\n \t  arg3 = convert_from_reference (arg3);\n \t  arg3_type = TREE_TYPE (arg3);\n+\t  if (error_operand_p (arg3))\n+\t    result = error_mark_node;\n \t}\n \n       /* Free all the conversions we allocated.  */"}, {"sha": "0696d9a6a58ae5b87f41a1a39a2a81a7e7be3f2e", "filename": "gcc/testsuite/ChangeLog", "status": "modified", "additions": 3, "deletions": 0, "changes": 3, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/2954333afc6cbb12f5628368b5f557a5730d1242/gcc%2Ftestsuite%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/2954333afc6cbb12f5628368b5f557a5730d1242/gcc%2Ftestsuite%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2FChangeLog?ref=2954333afc6cbb12f5628368b5f557a5730d1242", "patch": "@@ -1,5 +1,8 @@\n 2006-06-15  Mark Mitchell  <mark@codesourcery.com>\n \n+\tPR c++/27666\n+\t* g++.dg/expr/cond9.C: New test.\n+\n \tPR c++/27640\n \t* g++.dg/template/ctor7.C: New test.\n "}, {"sha": "9e8f08c1d6b78b3ca68dfad3ff580f722cc35dc9", "filename": "gcc/testsuite/g++.dg/expr/cond9.C", "status": "added", "additions": 10, "deletions": 0, "changes": 10, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/2954333afc6cbb12f5628368b5f557a5730d1242/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Fexpr%2Fcond9.C", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/2954333afc6cbb12f5628368b5f557a5730d1242/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Fexpr%2Fcond9.C", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Fexpr%2Fcond9.C?ref=2954333afc6cbb12f5628368b5f557a5730d1242", "patch": "@@ -0,0 +1,10 @@\n+// PR c++/27666\n+\n+struct A { // { dg-error \"A\" }\n+  A(int); // { dg-error \"A\" }\n+};\n+\n+void foo(volatile A a) { \n+  1 ? a : 0; // { dg-error \"match|temporary\" }\n+  1 ? 0 : a; // { dg-error \"match|temporary\" }\n+} "}]}