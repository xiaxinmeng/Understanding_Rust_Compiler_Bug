{"sha": "765c3e8f08dbd7208f348e5d318ed2dc8042275b", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6NzY1YzNlOGYwOGRiZDcyMDhmMzQ4ZTVkMzE4ZWQyZGM4MDQyMjc1Yg==", "commit": {"author": {"name": "H.J. Lu", "email": "hongjiu.lu@intel.com", "date": "2010-09-17T17:49:30Z"}, "committer": {"name": "H.J. Lu", "email": "hjl@gcc.gnu.org", "date": "2010-09-17T17:49:30Z"}, "message": "Update stack alignment when increasing local variable alignment.\n\ngcc/\n\n2010-09-17  H.J. Lu  <hongjiu.lu@intel.com>\n\n\tPR middle-end/45678\n\t* cfgexpand.c (update_stack_alignment): New.\n\t(get_decl_align_unit): Use it.\n\t(expand_one_stack_var_at): Call update_stack_alignment.\n\ngcc/testsuite/\n\n2010-09-17  H.J. Lu  <hongjiu.lu@intel.com>\n\n\tPR middle-end/45678\n\t* gcc.dg/torture/pr45678-2.c: New.\n\nFrom-SVN: r164375", "tree": {"sha": "2ba7a5b55ed477ffff8998549dfefde466f44b35", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/2ba7a5b55ed477ffff8998549dfefde466f44b35"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/765c3e8f08dbd7208f348e5d318ed2dc8042275b", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/765c3e8f08dbd7208f348e5d318ed2dc8042275b", "html_url": "https://github.com/Rust-GCC/gccrs/commit/765c3e8f08dbd7208f348e5d318ed2dc8042275b", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/765c3e8f08dbd7208f348e5d318ed2dc8042275b/comments", "author": {"login": "hjl-tools", "id": 1072356, "node_id": "MDQ6VXNlcjEwNzIzNTY=", "avatar_url": "https://avatars.githubusercontent.com/u/1072356?v=4", "gravatar_id": "", "url": "https://api.github.com/users/hjl-tools", "html_url": "https://github.com/hjl-tools", "followers_url": "https://api.github.com/users/hjl-tools/followers", "following_url": "https://api.github.com/users/hjl-tools/following{/other_user}", "gists_url": "https://api.github.com/users/hjl-tools/gists{/gist_id}", "starred_url": "https://api.github.com/users/hjl-tools/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/hjl-tools/subscriptions", "organizations_url": "https://api.github.com/users/hjl-tools/orgs", "repos_url": "https://api.github.com/users/hjl-tools/repos", "events_url": "https://api.github.com/users/hjl-tools/events{/privacy}", "received_events_url": "https://api.github.com/users/hjl-tools/received_events", "type": "User", "site_admin": false}, "committer": null, "parents": [{"sha": "349cfd93f47833397accadf890c4b10bfb2d66ac", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/349cfd93f47833397accadf890c4b10bfb2d66ac", "html_url": "https://github.com/Rust-GCC/gccrs/commit/349cfd93f47833397accadf890c4b10bfb2d66ac"}], "stats": {"total": 59, "additions": 48, "deletions": 11}, "files": [{"sha": "3d2d3775beed29e7752710ad4f1e439b2f8938e6", "filename": "gcc/ChangeLog", "status": "modified", "additions": 7, "deletions": 0, "changes": 7, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/765c3e8f08dbd7208f348e5d318ed2dc8042275b/gcc%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/765c3e8f08dbd7208f348e5d318ed2dc8042275b/gcc%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2FChangeLog?ref=765c3e8f08dbd7208f348e5d318ed2dc8042275b", "patch": "@@ -1,3 +1,10 @@\n+2010-09-17  H.J. Lu  <hongjiu.lu@intel.com>\n+\n+\tPR middle-end/45678\n+\t* cfgexpand.c (update_stack_alignment): New.\n+\t(get_decl_align_unit): Use it.\n+\t(expand_one_stack_var_at): Call update_stack_alignment.\n+\n 2010-09-17  Richard Guenther  <rguenther@suse.de>\n \n \t* lto-streamer-in.c (lto_input_ts_translation_unit_decl_tree_pointers):"}, {"sha": "1e67e7789789dfc9fd83445d4d1c4cf02861f56f", "filename": "gcc/cfgexpand.c", "status": "modified", "additions": 20, "deletions": 11, "changes": 31, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/765c3e8f08dbd7208f348e5d318ed2dc8042275b/gcc%2Fcfgexpand.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/765c3e8f08dbd7208f348e5d318ed2dc8042275b/gcc%2Fcfgexpand.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fcfgexpand.c?ref=765c3e8f08dbd7208f348e5d318ed2dc8042275b", "patch": "@@ -205,19 +205,11 @@ static bool has_protected_decls;\n    smaller than our cutoff threshold.  Used for -Wstack-protector.  */\n static bool has_short_buffer;\n \n-/* Discover the byte alignment to use for DECL.  Ignore alignment\n-   we can't do with expected alignment of the stack boundary.  */\n+/* Update stack alignment requirement.  */\n \n-static unsigned int\n-get_decl_align_unit (tree decl)\n+static void\n+update_stack_alignment (unsigned int align)\n {\n-  unsigned int align;\n-\n-  align = LOCAL_DECL_ALIGNMENT (decl);\n-\n-  if (align > MAX_SUPPORTED_STACK_ALIGNMENT)\n-    align = MAX_SUPPORTED_STACK_ALIGNMENT;\n-\n   if (SUPPORTS_STACK_ALIGNMENT)\n     {\n       if (crtl->stack_alignment_estimated < align)\n@@ -233,6 +225,22 @@ get_decl_align_unit (tree decl)\n     crtl->stack_alignment_needed = align;\n   if (crtl->max_used_stack_slot_alignment < align)\n     crtl->max_used_stack_slot_alignment = align;\n+}\n+\n+/* Discover the byte alignment to use for DECL.  Ignore alignment\n+   we can't do with expected alignment of the stack boundary.  */\n+\n+static unsigned int\n+get_decl_align_unit (tree decl)\n+{\n+  unsigned int align;\n+\n+  align = LOCAL_DECL_ALIGNMENT (decl);\n+\n+  if (align > MAX_SUPPORTED_STACK_ALIGNMENT)\n+    align = MAX_SUPPORTED_STACK_ALIGNMENT;\n+\n+  update_stack_alignment (align);\n \n   return align / BITS_PER_UNIT;\n }\n@@ -735,6 +743,7 @@ expand_one_stack_var_at (tree decl, HOST_WIDE_INT offset)\n       if (align == 0 || align > max_align)\n \talign = max_align;\n \n+      update_stack_alignment (align);\n       DECL_ALIGN (decl) = align;\n       DECL_USER_ALIGN (decl) = 0;\n     }"}, {"sha": "1552fa1bb9ad47fe555b6c40d5f5d819a01e963c", "filename": "gcc/testsuite/ChangeLog", "status": "modified", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/765c3e8f08dbd7208f348e5d318ed2dc8042275b/gcc%2Ftestsuite%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/765c3e8f08dbd7208f348e5d318ed2dc8042275b/gcc%2Ftestsuite%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2FChangeLog?ref=765c3e8f08dbd7208f348e5d318ed2dc8042275b", "patch": "@@ -1,3 +1,8 @@\n+2010-09-17  H.J. Lu  <hongjiu.lu@intel.com>\n+\n+\tPR middle-end/45678\n+\t* gcc.dg/torture/pr45678-2.c: New.\n+\n 2010-09-17  Richard Guenther  <rguenther@suse.de>\n \n \tPR middle-end/45678"}, {"sha": "449404cda1a8480767f2a17e33ffb9e68d37ddae", "filename": "gcc/testsuite/gcc.dg/torture/pr45678-2.c", "status": "added", "additions": 16, "deletions": 0, "changes": 16, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/765c3e8f08dbd7208f348e5d318ed2dc8042275b/gcc%2Ftestsuite%2Fgcc.dg%2Ftorture%2Fpr45678-2.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/765c3e8f08dbd7208f348e5d318ed2dc8042275b/gcc%2Ftestsuite%2Fgcc.dg%2Ftorture%2Fpr45678-2.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgcc.dg%2Ftorture%2Fpr45678-2.c?ref=765c3e8f08dbd7208f348e5d318ed2dc8042275b", "patch": "@@ -0,0 +1,16 @@\n+/* { dg-do run } */\n+\n+typedef float V __attribute__ ((vector_size (16)));\n+V g;\n+\n+int\n+main ()\n+{\n+  float d[4] = { 4, 3, 2, 1 };\n+  V e;\n+  __builtin_memcpy (&e, &d, sizeof (d));\n+  V f = { 5, 15, 25, 35 };\n+  e = e * f;\n+  g = e;\n+  return 0;\n+}"}]}