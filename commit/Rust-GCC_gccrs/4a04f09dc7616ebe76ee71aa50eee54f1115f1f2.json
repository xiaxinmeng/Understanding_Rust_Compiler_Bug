{"sha": "4a04f09dc7616ebe76ee71aa50eee54f1115f1f2", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6NGEwNGYwOWRjNzYxNmViZTc2ZWU3MWFhNTBlZWU1NGYxMTE1ZjFmMg==", "commit": {"author": {"name": "Iain Sandoe", "email": "iain@sandoe.co.uk", "date": "2020-12-31T14:43:00Z"}, "committer": {"name": "Iain Sandoe", "email": "iain@sandoe.co.uk", "date": "2021-01-02T19:56:19Z"}, "message": "Darwin, Simplify headers 4/5 : Remove redundant headers.\n\nThe darwinN.h headers (with the sole exception of darwin7.h,\nwhich contains a target macro definition) now only contain\nvalues that set fall-backs for cross-compilations, these can\nbe provided from the config.gcc script which means we no longer\nneed the darwinN.h - so delete them.\n\ngcc/ChangeLog:\n\n\t* config.gcc: Compute default version information\n\tfrom the configured target.  Likewise defaults for\n\tld64.\n\t* config/darwin10.h: Removed.\n\t* config/darwin12.h: Removed.\n\t* config/darwin9.h: Removed.\n\t* config/rs6000/darwin8.h: Removed.", "tree": {"sha": "7be74d466d91f4398541f10a38cdab04b82ed121", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/7be74d466d91f4398541f10a38cdab04b82ed121"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/4a04f09dc7616ebe76ee71aa50eee54f1115f1f2", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/4a04f09dc7616ebe76ee71aa50eee54f1115f1f2", "html_url": "https://github.com/Rust-GCC/gccrs/commit/4a04f09dc7616ebe76ee71aa50eee54f1115f1f2", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/4a04f09dc7616ebe76ee71aa50eee54f1115f1f2/comments", "author": {"login": "iains", "id": 4039407, "node_id": "MDQ6VXNlcjQwMzk0MDc=", "avatar_url": "https://avatars.githubusercontent.com/u/4039407?v=4", "gravatar_id": "", "url": "https://api.github.com/users/iains", "html_url": "https://github.com/iains", "followers_url": "https://api.github.com/users/iains/followers", "following_url": "https://api.github.com/users/iains/following{/other_user}", "gists_url": "https://api.github.com/users/iains/gists{/gist_id}", "starred_url": "https://api.github.com/users/iains/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/iains/subscriptions", "organizations_url": "https://api.github.com/users/iains/orgs", "repos_url": "https://api.github.com/users/iains/repos", "events_url": "https://api.github.com/users/iains/events{/privacy}", "received_events_url": "https://api.github.com/users/iains/received_events", "type": "User", "site_admin": false}, "committer": {"login": "iains", "id": 4039407, "node_id": "MDQ6VXNlcjQwMzk0MDc=", "avatar_url": "https://avatars.githubusercontent.com/u/4039407?v=4", "gravatar_id": "", "url": "https://api.github.com/users/iains", "html_url": "https://github.com/iains", "followers_url": "https://api.github.com/users/iains/followers", "following_url": "https://api.github.com/users/iains/following{/other_user}", "gists_url": "https://api.github.com/users/iains/gists{/gist_id}", "starred_url": "https://api.github.com/users/iains/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/iains/subscriptions", "organizations_url": "https://api.github.com/users/iains/orgs", "repos_url": "https://api.github.com/users/iains/repos", "events_url": "https://api.github.com/users/iains/events{/privacy}", "received_events_url": "https://api.github.com/users/iains/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "5282e22f0e7f0d0d5ca2bdc4a952c0d383300eba", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/5282e22f0e7f0d0d5ca2bdc4a952c0d383300eba", "html_url": "https://github.com/Rust-GCC/gccrs/commit/5282e22f0e7f0d0d5ca2bdc4a952c0d383300eba"}], "stats": {"total": 145, "additions": 39, "deletions": 106}, "files": [{"sha": "b942e9700d66d15b1f7269d6dd8daf5092ac28c3", "filename": "gcc/config.gcc", "status": "modified", "additions": 39, "deletions": 9, "changes": 48, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/4a04f09dc7616ebe76ee71aa50eee54f1115f1f2/gcc%2Fconfig.gcc", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/4a04f09dc7616ebe76ee71aa50eee54f1115f1f2/gcc%2Fconfig.gcc", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fconfig.gcc?ref=4a04f09dc7616ebe76ee71aa50eee54f1115f1f2", "patch": "@@ -685,17 +685,47 @@ case ${target} in\n *-*-darwin*)\n   tmake_file=\"t-darwin \"\n   tm_file=\"${tm_file} darwin.h\"\n+  darwin_os=`echo ${target} | sed 's/.*darwin\\([0-9.]*\\).*$/\\1/'`\n+  darwin_maj=`expr \"$darwin_os\" : '\\([0-9]*\\).*'`\n+  macos_min=`expr \"$darwin_os\" : '[0-9]*\\.\\([0-9]*\\).*'`\n+  macos_maj=10\n+  if test x\"${macos_min}\" = x; then\n+    macos_min=0\n+  fi\n+  def_ld64=85.2\n   case ${target} in\n-  *-*-darwin9*)\n-    tm_file=\"${tm_file} darwin9.h\"\n-    ;;\n-  *-*-darwin[1][01]*)\n-    tm_file=\"${tm_file} darwin9.h darwin10.h\"\n-    ;;\n-  *-*-darwin[1][2-9]* | *-*-darwin[2][0-9]*)\n-    tm_file=\"${tm_file} darwin9.h darwin10.h darwin12.h\"\n-    ;;\n+      # Darwin 4 to 19 correspond to macOS 10.0 to 10.15\n+      *-*-darwin[4-9]* | *-*-darwin1[0-9]*)\n+        macos_min=`expr $darwin_maj - 4`\n+        ;;\n+      *-*-darwin20*)\n+        # Darwin 20 corresponds to macOS 11.\n+        macos_maj=11\n+        def_ld64=609.0\n+        ;;\n+      *-*-darwin)\n+        case ${cpu_type} in\n+          aarch64) macos_maj=11 ;;\n+          x86_64) macos_min=6 ;;\n+          *)  macos_min=5 ;;\n+          esac\n+          case ${host} in\n+            *-*-darwin*) tm_defines=\"$tm_defines DARWIN_USE_KERNEL_VERS\" ;;\n+            *)\n+              # If configuring a cross-compiler then we will have set some\n+              #\u00a0default above, but it is probably not what was intended.\n+              echo \"Warning: Using ${target} is only suitable for Darwin hosts\" 1>&2\n+              echo \"configure with an explicit target version\" 1>&2\n+              ;;\n+          esac\n+        ;;\n+      *)\n+        echo \"Error: configuring for an unreleased macOS version ${target}\" 1>&2\n+        exit 1\n+        ;;\n   esac\n+  tm_defines=\"$tm_defines DEF_MIN_OSX_VERSION=\\\\\\\"${macos_maj}.${macos_min}\\\\\\\"\"\n+  tm_defines=\"$tm_defines DEF_LD64=\\\\\\\"${def_ld64}\\\\\\\"\"\n   tm_file=\"${tm_file} ${cpu_type}/darwin.h\"\n   tm_p_file=\"${tm_p_file} darwin-protos.h\"\n   target_gtfiles=\"$target_gtfiles \\$(srcdir)/config/darwin.c\""}, {"sha": "88b1fd061bb80aaa8b7a771f9284bd610fc0075e", "filename": "gcc/config/darwin10.h", "status": "removed", "additions": 0, "deletions": 27, "changes": 27, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/5282e22f0e7f0d0d5ca2bdc4a952c0d383300eba/gcc%2Fconfig%2Fdarwin10.h", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/5282e22f0e7f0d0d5ca2bdc4a952c0d383300eba/gcc%2Fconfig%2Fdarwin10.h", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fconfig%2Fdarwin10.h?ref=5282e22f0e7f0d0d5ca2bdc4a952c0d383300eba", "patch": "@@ -1,27 +0,0 @@\n-/* Target definitions for Darwin (Mac OS X) systems.\n-   Copyright (C) 2009-2020 Free Software Foundation, Inc.\n-   Contributed by Jack Howarth <howarth@bromo.med.uc.edu>.\n-\n-This file is part of GCC.\n-\n-GCC is free software; you can redistribute it and/or modify\n-it under the terms of the GNU General Public License as published by\n-the Free Software Foundation; either version 3, or (at your option)\n-any later version.\n-\n-GCC is distributed in the hope that it will be useful,\n-but WITHOUT ANY WARRANTY; without even the implied warranty of\n-MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n-GNU General Public License for more details.\n-\n-You should have received a copy of the GNU General Public License\n-along with GCC; see the file COPYING3.  If not see\n-<http://www.gnu.org/licenses/>.  */\n-\n-#undef DEF_MIN_OSX_VERSION\n-#define DEF_MIN_OSX_VERSION \"10.6\"\n-\n-#ifndef LD64_VERSION\n-#undef DEF_LD64\n-#define DEF_LD64 \"97.7\"\n-#endif"}, {"sha": "b397703dc78837dbd966723cda618ffeeb35a675", "filename": "gcc/config/darwin12.h", "status": "removed", "additions": 0, "deletions": 27, "changes": 27, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/5282e22f0e7f0d0d5ca2bdc4a952c0d383300eba/gcc%2Fconfig%2Fdarwin12.h", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/5282e22f0e7f0d0d5ca2bdc4a952c0d383300eba/gcc%2Fconfig%2Fdarwin12.h", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fconfig%2Fdarwin12.h?ref=5282e22f0e7f0d0d5ca2bdc4a952c0d383300eba", "patch": "@@ -1,27 +0,0 @@\n-/* Target definitions for Darwin (Mac OS X) systems.\n-   Copyright (C) 2009-2020 Free Software Foundation, Inc.\n-   Contributed by Jack Howarth <howarth.at.gcc@gmail.com>.\n-\n-This file is part of GCC.\n-\n-GCC is free software; you can redistribute it and/or modify\n-it under the terms of the GNU General Public License as published by\n-the Free Software Foundation; either version 3, or (at your option)\n-any later version.\n-\n-GCC is distributed in the hope that it will be useful,\n-but WITHOUT ANY WARRANTY; without even the implied warranty of\n-MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n-GNU General Public License for more details.\n-\n-You should have received a copy of the GNU General Public License\n-along with GCC; see the file COPYING3.  If not see\n-<http://www.gnu.org/licenses/>.  */\n-\n-#undef DEF_MIN_OSX_VERSION\n-#define DEF_MIN_OSX_VERSION \"10.8\"\n-\n-#ifndef LD64_VERSION\n-#undef DEF_LD64\n-#define DEF_LD64 \"236.4\"\n-#endif"}, {"sha": "92a77eeec713b0cf6438a0b457351d2dfe2f7877", "filename": "gcc/config/darwin9.h", "status": "removed", "additions": 0, "deletions": 22, "changes": 22, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/5282e22f0e7f0d0d5ca2bdc4a952c0d383300eba/gcc%2Fconfig%2Fdarwin9.h", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/5282e22f0e7f0d0d5ca2bdc4a952c0d383300eba/gcc%2Fconfig%2Fdarwin9.h", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fconfig%2Fdarwin9.h?ref=5282e22f0e7f0d0d5ca2bdc4a952c0d383300eba", "patch": "@@ -1,22 +0,0 @@\n-/* Target definitions for Darwin (Mac OS X) systems.\n-   Copyright (C) 2006-2020 Free Software Foundation, Inc.\n-   Contributed by Apple Inc.\n-\n-This file is part of GCC.\n-\n-GCC is free software; you can redistribute it and/or modify\n-it under the terms of the GNU General Public License as published by\n-the Free Software Foundation; either version 3, or (at your option)\n-any later version.\n-\n-GCC is distributed in the hope that it will be useful,\n-but WITHOUT ANY WARRANTY; without even the implied warranty of\n-MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n-GNU General Public License for more details.\n-\n-You should have received a copy of the GNU General Public License\n-along with GCC; see the file COPYING3.  If not see\n-<http://www.gnu.org/licenses/>.  */\n-\n-#undef DEF_MIN_OSX_VERSION\n-#define DEF_MIN_OSX_VERSION \"10.5\""}, {"sha": "01b2dc84291fdb435eec295fe4656f40bafa8525", "filename": "gcc/config/rs6000/darwin8.h", "status": "removed", "additions": 0, "deletions": 21, "changes": 21, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/5282e22f0e7f0d0d5ca2bdc4a952c0d383300eba/gcc%2Fconfig%2Frs6000%2Fdarwin8.h", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/5282e22f0e7f0d0d5ca2bdc4a952c0d383300eba/gcc%2Fconfig%2Frs6000%2Fdarwin8.h", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fconfig%2Frs6000%2Fdarwin8.h?ref=5282e22f0e7f0d0d5ca2bdc4a952c0d383300eba", "patch": "@@ -1,21 +0,0 @@\n-/* Target definitions for Darwin 8.0 and above (Mac OS X) systems.\n-   Copyright (C) 2004-2020 Free Software Foundation, Inc.\n-\n-This file is part of GCC.\n-\n-GCC is free software; you can redistribute it and/or modify\n-it under the terms of the GNU General Public License as published by\n-the Free Software Foundation; either version 3, or (at your option)\n-any later version.\n-\n-GCC is distributed in the hope that it will be useful,\n-but WITHOUT ANY WARRANTY; without even the implied warranty of\n-MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n-GNU General Public License for more details.\n-\n-You should have received a copy of the GNU General Public License\n-along with GCC; see the file COPYING3.  If not see\n-<http://www.gnu.org/licenses/>.  */\n-\n-#undef DEF_MIN_OSX_VERSION\n-#define DEF_MIN_OSX_VERSION \"10.4\""}]}