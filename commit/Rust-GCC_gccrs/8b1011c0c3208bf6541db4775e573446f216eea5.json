{"sha": "8b1011c0c3208bf6541db4775e573446f216eea5", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6OGIxMDExYzBjMzIwOGJmNjU0MWRiNDc3NWU1NzM0NDZmMjE2ZWVhNQ==", "commit": {"author": {"name": "Arnaud Charlet", "email": "charlet@gcc.gnu.org", "date": "2013-04-11T09:51:54Z"}, "committer": {"name": "Arnaud Charlet", "email": "charlet@gcc.gnu.org", "date": "2013-04-11T09:51:54Z"}, "message": "[multiple changes]\n\n2013-04-11  Yannick Moy  <moy@adacore.com>\n\n\t* gnat1drv.adb (Adjust_Global_Switches): Allow missing body in Alfa\n\tmode.\n\n2013-04-11  Hristian Kirtchev  <kirtchev@adacore.com>\n\n\t* exp_ch4.adb (Expand_N_Allocator): Detect the\n\tallocation of an anonymous controlled object where the type of\n\tthe context is named. Use the pool and finalization master of\n\tthe named access type to allocate the object.\n\n2013-04-11  Vincent Celier  <celier@adacore.com>\n\n\t* gnat_ugn.texi: Remove most mentions of gprbuild.\n\t* projects.texi: Remove all mentions of asociative array\n\tattributes.\n\nFrom-SVN: r197753", "tree": {"sha": "d2f24a10f5cc466aaaa6440f08052e0d3fdc01e8", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/d2f24a10f5cc466aaaa6440f08052e0d3fdc01e8"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/8b1011c0c3208bf6541db4775e573446f216eea5", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/8b1011c0c3208bf6541db4775e573446f216eea5", "html_url": "https://github.com/Rust-GCC/gccrs/commit/8b1011c0c3208bf6541db4775e573446f216eea5", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/8b1011c0c3208bf6541db4775e573446f216eea5/comments", "author": null, "committer": null, "parents": [{"sha": "5b75bf576f92ac16409fd7d3f1fd3f64c02bca11", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/5b75bf576f92ac16409fd7d3f1fd3f64c02bca11", "html_url": "https://github.com/Rust-GCC/gccrs/commit/5b75bf576f92ac16409fd7d3f1fd3f64c02bca11"}], "stats": {"total": 128, "additions": 88, "deletions": 40}, "files": [{"sha": "29de82b8893acc9c7a0b7521c204ec68fe4e4942", "filename": "gcc/ada/ChangeLog", "status": "modified", "additions": 18, "deletions": 0, "changes": 18, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/8b1011c0c3208bf6541db4775e573446f216eea5/gcc%2Fada%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/8b1011c0c3208bf6541db4775e573446f216eea5/gcc%2Fada%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fada%2FChangeLog?ref=8b1011c0c3208bf6541db4775e573446f216eea5", "patch": "@@ -1,3 +1,21 @@\n+2013-04-11  Yannick Moy  <moy@adacore.com>\n+\n+\t* gnat1drv.adb (Adjust_Global_Switches): Allow missing body in Alfa\n+\tmode.\n+\n+2013-04-11  Hristian Kirtchev  <kirtchev@adacore.com>\n+\n+\t* exp_ch4.adb (Expand_N_Allocator): Detect the\n+\tallocation of an anonymous controlled object where the type of\n+\tthe context is named. Use the pool and finalization master of\n+\tthe named access type to allocate the object.\n+\n+2013-04-11  Vincent Celier  <celier@adacore.com>\n+\n+\t* gnat_ugn.texi: Remove most mentions of gprbuild.\n+\t* projects.texi: Remove all mentions of asociative array\n+\tattributes.\n+\n 2013-04-11  Robert Dewar  <dewar@adacore.com>\n \n \t* sem_prag.adb, sem_attr.adb, gnat1drv.adb, prj-makr.adb,"}, {"sha": "489c388d44f2db82b4d75fae8f8a3c2b796710a5", "filename": "gcc/ada/exp_ch4.adb", "status": "modified", "additions": 50, "deletions": 21, "changes": 71, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/8b1011c0c3208bf6541db4775e573446f216eea5/gcc%2Fada%2Fexp_ch4.adb", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/8b1011c0c3208bf6541db4775e573446f216eea5/gcc%2Fada%2Fexp_ch4.adb", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fada%2Fexp_ch4.adb?ref=8b1011c0c3208bf6541db4775e573446f216eea5", "patch": "@@ -842,7 +842,7 @@ package body Exp_Ch4 is\n             --  if statement instead of the regular Program_Error circuitry.\n \n             Insert_Action (N,\n-              Make_If_Statement (Loc,\n+              Make_Implicit_If_Statement (N,\n                 Condition       => Cond,\n                 Then_Statements => Stmts));\n          end if;\n@@ -3017,8 +3017,6 @@ package body Exp_Ch4 is\n \n    --  Start of processing for Expand_Concatenate\n \n-   --  Kirtchev\n-\n    begin\n       --  Choose an appropriate computational type\n \n@@ -3965,7 +3963,7 @@ package body Exp_Ch4 is\n                       Name       => New_Occurrence_Of (Nnn, Loc),\n                       Expression => Relocate_Node (Lop)),\n \n-                    Make_If_Statement (Loc,\n+                    Make_Implicit_If_Statement (N,\n                       Condition =>\n                         Make_Op_Not (Loc,\n                           Right_Opnd =>\n@@ -4090,14 +4088,9 @@ package body Exp_Ch4 is\n    ------------------------\n \n    procedure Expand_N_Allocator (N : Node_Id) is\n-      PtrT  : constant Entity_Id  := Etype (N);\n-      Dtyp  : constant Entity_Id  := Available_View (Designated_Type (PtrT));\n-      Etyp  : constant Entity_Id  := Etype (Expression (N));\n-      Loc   : constant Source_Ptr := Sloc (N);\n-      Desig : Entity_Id;\n-      Nod   : Node_Id;\n-      Pool  : Entity_Id;\n-      Temp  : Entity_Id;\n+      Etyp : constant Entity_Id  := Etype (Expression (N));\n+      Loc  : constant Source_Ptr := Sloc (N);\n+      PtrT : constant Entity_Id  := Etype (N);\n \n       procedure Rewrite_Coextension (N : Node_Id);\n       --  Static coextensions have the same lifetime as the entity they\n@@ -4195,6 +4188,15 @@ package body Exp_Ch4 is\n          end;\n       end Size_In_Storage_Elements;\n \n+      --  Local variables\n+\n+      Dtyp    : constant Entity_Id  := Available_View (Designated_Type (PtrT));\n+      Desig   : Entity_Id;\n+      Nod     : Node_Id;\n+      Pool    : Entity_Id;\n+      Rel_Typ : Entity_Id;\n+      Temp    : Entity_Id;\n+\n    --  Start of processing for Expand_N_Allocator\n \n    begin\n@@ -4216,13 +4218,40 @@ package body Exp_Ch4 is\n              (Is_Itype (PtrT) and then No (Finalization_Master (PtrT))))\n         and then Needs_Finalization (Dtyp)\n       then\n+         --  Detect the allocation of an anonymous controlled object where the\n+         --  type of the context is named. For example:\n+\n+         --     procedure Proc (Ptr : Named_Access_Typ);\n+         --     Proc (new Designated_Typ);\n+\n+         --  Regardless of the anonymous-to-named access type conversion, the\n+         --  lifetime of the object must be associated with the named access\n+         --  type. Use the finalization-related attributes of the named access\n+         --  type.\n+\n+         if Nkind_In (Parent (N), N_Type_Conversion,\n+                                  N_Unchecked_Type_Conversion)\n+           and then Ekind_In (Etype (Parent (N)), E_Access_Subtype,\n+                                                  E_Access_Type,\n+                                                  E_General_Access_Type)\n+         then\n+            Rel_Typ := Etype (Parent (N));\n+         else\n+            Rel_Typ := Empty;\n+         end if;\n+\n          --  Anonymous access-to-controlled types allocate on the global pool.\n          --  Do not set this attribute on .NET/JVM since those targets do not\n          --  support pools.\n \n          if No (Associated_Storage_Pool (PtrT)) and then VM_Target = No_VM then\n-            Set_Associated_Storage_Pool\n-              (PtrT, Get_Global_Pool_For_Access_Type (PtrT));\n+            if Present (Rel_Typ) then\n+               Set_Associated_Storage_Pool (PtrT,\n+                 Associated_Storage_Pool (Rel_Typ));\n+            else\n+               Set_Associated_Storage_Pool (PtrT,\n+                 Get_Global_Pool_For_Access_Type (PtrT));\n+            end if;\n          end if;\n \n          --  The finalization master must be inserted and analyzed as part of\n@@ -4231,7 +4260,11 @@ package body Exp_Ch4 is\n          --  updated when analysis changes current units.\n \n          if not Alfa_Mode then\n-            Set_Finalization_Master (PtrT, Current_Anonymous_Master);\n+            if Present (Rel_Typ) then\n+               Set_Finalization_Master (PtrT, Finalization_Master (Rel_Typ));\n+            else\n+               Set_Finalization_Master (PtrT, Current_Anonymous_Master);\n+            end if;\n          end if;\n       end if;\n \n@@ -5186,8 +5219,6 @@ package body Exp_Ch4 is\n                Desig_Typ := Obj_Typ;\n             end if;\n \n-            --  Kirtchev J730-020\n-\n             Desig_Typ := Base_Type (Desig_Typ);\n \n             --  Generate:\n@@ -5261,7 +5292,7 @@ package body Exp_Ch4 is\n \n             if Nkind (Context) /= N_Simple_Return_Statement then\n                Insert_Action_After (Context,\n-                 Make_If_Statement (Loc,\n+                 Make_Implicit_If_Statement (Obj_Decl,\n                    Condition =>\n                      Make_Op_Ne (Loc,\n                        Left_Opnd  => New_Reference_To (Temp_Id, Loc),\n@@ -6729,8 +6760,6 @@ package body Exp_Ch4 is\n       --  Node which is to be replaced by the result of concatenating the nodes\n       --  in the list Opnds.\n \n-   --  Kirtchev\n-\n    begin\n       --  Ensure validity of both operands\n \n@@ -11552,7 +11581,7 @@ package body Exp_Ch4 is\n             Set_Has_Dereference_Action (Deref);\n \n             Stmt :=\n-              Make_If_Statement (Loc,\n+              Make_Implicit_If_Statement (N,\n                 Condition       =>\n                   Make_Function_Call (Loc,\n                     Name                   =>"}, {"sha": "7a1c4f5ecd759a77b1eccb8c090e8394a1a43350", "filename": "gcc/ada/gnat1drv.adb", "status": "modified", "additions": 3, "deletions": 2, "changes": 5, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/8b1011c0c3208bf6541db4775e573446f216eea5/gcc%2Fada%2Fgnat1drv.adb", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/8b1011c0c3208bf6541db4775e573446f216eea5/gcc%2Fada%2Fgnat1drv.adb", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fada%2Fgnat1drv.adb?ref=8b1011c0c3208bf6541db4775e573446f216eea5", "patch": "@@ -1030,9 +1030,10 @@ begin\n       elsif Main_Kind in N_Generic_Renaming_Declaration then\n          Back_End_Mode := Generate_Object;\n \n-      --  It's not an error to generate SCIL for e.g. a spec which has a body\n+      --  It is not an error to analyze (in CodePeer or Alfa modes) a spec\n+      --  which requires a body, when the body is not available.\n \n-      elsif CodePeer_Mode then\n+      elsif CodePeer_Mode or Alfa_Mode then\n          Back_End_Mode := Generate_Object;\n \n       --  In all other cases (specs which have bodies, generics, and bodies"}, {"sha": "b8423f6fc6992c47f7bb8e6849f49f78e1158f44", "filename": "gcc/ada/gnat_ugn.texi", "status": "modified", "additions": 11, "deletions": 11, "changes": 22, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/8b1011c0c3208bf6541db4775e573446f216eea5/gcc%2Fada%2Fgnat_ugn.texi", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/8b1011c0c3208bf6541db4775e573446f216eea5/gcc%2Fada%2Fgnat_ugn.texi", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fada%2Fgnat_ugn.texi?ref=8b1011c0c3208bf6541db4775e573446f216eea5", "patch": "@@ -7944,7 +7944,7 @@ preprocessing is triggered and parameterized.\n This switch indicates to the compiler the file name (without directory\n information) of the preprocessor data file to use. The preprocessor data file\n should be found in the source directories. Note that when the compiler is\n-called by a builder (@command{gnatmake} or @command{gprbuild}) with a project\n+called by a builder such as (@command{gnatmake} with a project\n file, if the object directory is not also a source directory, the builder needs\n to be called with @option{-x}.\n \n@@ -18518,8 +18518,8 @@ $ gnattest --harness-dir=driver -Psimple.gpr\n a test driver is created in directory \"driver\". It can be compiled and run:\n \n @smallexample\n-$ cd driver\n-$ gprbuild -Ptest_driver\n+$ cd obj/driver\n+$ gnatmake -Ptest_driver\n $ test_runner\n @end smallexample\n \n@@ -18584,8 +18584,8 @@ and body of function Dec in simple.ads and simple.adb, running\n \n @smallexample\n gnattest --harness-dir=driver -Psimple.gpr\n-cd driver\n-gprbuild -Ptest_driver\n+cd obj/driver\n+gnatmake -Ptest_driver\n test_runner\n @end smallexample\n \n@@ -18680,8 +18680,8 @@ seen by running the test driver generated for the second example. As previously\n mentioned, actual tests are already written for this example.\n \n @smallexample\n-cd driver\n-gprbuild -Ptest_driver\n+cd obj/driver\n+gnatmake -Ptest_driver\n test_runner\n @end smallexample\n \n@@ -18722,8 +18722,8 @@ of the type which have overriding primitives:\n \n @smallexample\n gnattest --harness-dir=driver --validate-type-extensions -Ptagged_rec.gpr\n-cd driver\n-gprbuild -Ptest_driver\n+cd obj/driver\n+gnatmake -Ptest_driver\n test_runner\n @end smallexample\n \n@@ -18771,8 +18771,8 @@ Assert (Sqrt (-5.0) = -1.0, \"wrong error indication\");\n are acceptable:\n \n @smallexample\n-cd driver\n-gprbuild -Ptest_driver\n+cd obj/driver\n+gnatmake -Ptest_driver\n test_runner\n @end smallexample\n "}, {"sha": "cb632ffe283f9266c6bd0995fe6b8c94f5fa536a", "filename": "gcc/ada/projects.texi", "status": "modified", "additions": 6, "deletions": 6, "changes": 12, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/8b1011c0c3208bf6541db4775e573446f216eea5/gcc%2Fada%2Fprojects.texi", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/8b1011c0c3208bf6541db4775e573446f216eea5/gcc%2Fada%2Fprojects.texi", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fada%2Fprojects.texi?ref=8b1011c0c3208bf6541db4775e573446f216eea5", "patch": "@@ -1,7 +1,7 @@\n @set gprconfig GPRconfig\n \n @c ------ projects.texi\n-@c Copyright (C) 2002-2012, Free Software Foundation, Inc.\n+@c Copyright (C) 2002-2013, Free Software Foundation, Inc.\n @c This file is shared between the GNAT user's guide and gprbuild. It is not\n @c compilable on its own, you should instead compile the other two manuals.\n @c For that reason, there is no toplevel @menu\n@@ -3570,7 +3570,7 @@ Here are some examples of attribute declarations:\n @end smallexample\n \n @noindent\n-Attributes references may be appear anywhere in expressions, and are used\n+Attributes references may appear anywhere in expressions, and are used\n to retrieve the value previously assigned to the attribute. If an attribute\n has not been set in a given package or project, its value defaults to the\n empty string or the empty list.\n@@ -3721,15 +3721,15 @@ system (file). The text is between brackets ([]) if the index is optional.\n @item Required_Switches @tab list @tab Compiler,Binder,Linker @tab insensitive (language)\n @item Leading_Required_Switches @tab list @tab Compiler @tab insensitive (language)\n @item Trailing_Required_Switches @tab list @tab Compiler @tab insensitive (language)\n-@item Pic_Options @tab list @tab Compiler @tab insensitive (language)\n+@item Pic_Option @tab list @tab Compiler @tab insensitive (language)\n @item Path_Syntax @tab string @tab Compiler @tab insensitive (language)\n @item Object_File_Suffix @tab string @tab Compiler @tab insensitive (language)\n @item Object_File_Switches @tab list @tab Compiler @tab insensitive (language)\n @item Multi_Unit_Switches @tab list @tab Compiler @tab insensitive (language)\n @item Multi_Unit_Object_Separator @tab string @tab Compiler @tab insensitive (language)\n @item Mapping_File_Switches @tab list @tab Compiler @tab insensitive (language)\n @item Mapping_Spec_Suffix @tab string @tab Compiler @tab insensitive (language)\n-@item Mapping_body_Suffix @tab string @tab Compiler @tab insensitive (language)\n+@item Mapping_Body_Suffix @tab string @tab Compiler @tab insensitive (language)\n @item Config_File_Switches @tab list @tab Compiler @tab insensitive (language)\n @item Config_Body_File_Name @tab string @tab Compiler @tab insensitive (language)\n @item Config_Body_File_Name_Index @tab string @tab Compiler @tab insensitive (language)\n@@ -4654,7 +4654,7 @@ to use to communicate with the target in a cross-compilation environment,\n e.g.@: @code{\"wtx\"} or @code{\"vxworks\"}.\n \n @item Compiler_Command\n-This is an associative array attribute, whose domain is a language name. Its\n+This is an indexed attribute, whose domain is a language name. Its\n value is  string that denotes the command to be used to invoke the compiler.\n The value of @code{Compiler_Command (\"Ada\")} is expected to be compatible with\n @command{gnatmake}, in particular in the handling of switches.\n@@ -4664,7 +4664,7 @@ This is simple attribute, Its value is a string that specifies the name of\n the debugger to be used, such as gdb, powerpc-wrs-vxworks-gdb or gdb-4.\n \n @item Default_Switches\n-This is an associative array attribute. Its indexes are the name of the\n+This is an indexed attribute. Its indexes are the name of the\n external tools that the GNAT Programming System (GPS) is supporting. Its\n value is a list of switches to use when invoking that tool.\n "}]}