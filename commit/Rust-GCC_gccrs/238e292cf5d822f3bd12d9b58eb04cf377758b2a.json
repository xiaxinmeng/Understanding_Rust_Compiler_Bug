{"sha": "238e292cf5d822f3bd12d9b58eb04cf377758b2a", "node_id": "C_kwDOANBUbNoAKDIzOGUyOTJjZjVkODIyZjNiZDEyZDliNThlYjA0Y2YzNzc3NThiMmE", "commit": {"author": {"name": "Patrick Palka", "email": "ppalka@redhat.com", "date": "2023-01-04T19:12:25Z"}, "committer": {"name": "Patrick Palka", "email": "ppalka@redhat.com", "date": "2023-01-04T19:12:25Z"}, "message": "c++: mark_single_function and SFINAE [PR108282]\n\nWe typically ignore mark_used failure when in a non-SFINAE context for\nsake of better error recovery.  But in mark_single_function we're\ninstead ignoring mark_used failure in a SFINAE context, which ends up\ncausing the second static_assert here to incorrectly fail.\n\n\tPR c++/108282\n\ngcc/cp/ChangeLog:\n\n\t* decl2.cc (mark_single_function): Ignore mark_used failure\n\tonly in a non-SFINAE context rather than in a SFINAE one.\n\ngcc/testsuite/ChangeLog:\n\n\t* g++.dg/cpp2a/concepts-requires34.C: New test.", "tree": {"sha": "c2ee369fd5e91ad6a5ae9332e8be96d523224352", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/c2ee369fd5e91ad6a5ae9332e8be96d523224352"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/238e292cf5d822f3bd12d9b58eb04cf377758b2a", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/238e292cf5d822f3bd12d9b58eb04cf377758b2a", "html_url": "https://github.com/Rust-GCC/gccrs/commit/238e292cf5d822f3bd12d9b58eb04cf377758b2a", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/238e292cf5d822f3bd12d9b58eb04cf377758b2a/comments", "author": null, "committer": null, "parents": [{"sha": "fc349931adcf1024ee95e0a0cd98cf4a41996093", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/fc349931adcf1024ee95e0a0cd98cf4a41996093", "html_url": "https://github.com/Rust-GCC/gccrs/commit/fc349931adcf1024ee95e0a0cd98cf4a41996093"}], "stats": {"total": 21, "additions": 20, "deletions": 1}, "files": [{"sha": "00ed64d1691b5bf11c08d9545a9da0c8a0486d22", "filename": "gcc/cp/decl2.cc", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/238e292cf5d822f3bd12d9b58eb04cf377758b2a/gcc%2Fcp%2Fdecl2.cc", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/238e292cf5d822f3bd12d9b58eb04cf377758b2a/gcc%2Fcp%2Fdecl2.cc", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fcp%2Fdecl2.cc?ref=238e292cf5d822f3bd12d9b58eb04cf377758b2a", "patch": "@@ -5600,7 +5600,7 @@ mark_single_function (tree expr, tsubst_flags_t complain)\n \n   if (is_overloaded_fn (expr) == 1\n       && !mark_used (expr, complain)\n-      && (complain & tf_error))\n+      && !(complain & tf_error))\n     return false;\n   return true;\n }"}, {"sha": "5bbd62f6d8efbfa96fa7853e6944594035acad1f", "filename": "gcc/testsuite/g++.dg/cpp2a/concepts-requires34.C", "status": "added", "additions": 19, "deletions": 0, "changes": 19, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/238e292cf5d822f3bd12d9b58eb04cf377758b2a/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Fcpp2a%2Fconcepts-requires34.C", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/238e292cf5d822f3bd12d9b58eb04cf377758b2a/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Fcpp2a%2Fconcepts-requires34.C", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Fcpp2a%2Fconcepts-requires34.C?ref=238e292cf5d822f3bd12d9b58eb04cf377758b2a", "patch": "@@ -0,0 +1,19 @@\n+// PR c++/108282\n+// { dg-do compile { target c++20 } }\n+\n+template<class T>\n+concept TEST = requires { T::TT; };\n+\n+struct C { };\n+\n+template<class AT>\n+struct B {\n+  static void TT() requires TEST<AT>;\n+};\n+\n+int main() {\n+  static_assert( !TEST<C> );\n+  static_assert( !TEST<B<C>> );\n+\n+  B<C>::TT();  // { dg-error \"no match\" }\n+}"}]}