{"sha": "1039d00c597ece034f51a66d085fa80f1f11d9e2", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6MTAzOWQwMGM1OTdlY2UwMzRmNTFhNjZkMDg1ZmE4MGYxZjExZDllMg==", "commit": {"author": {"name": "Paolo Carlini", "email": "paolo.carlini@oracle.com", "date": "2018-12-15T09:07:38Z"}, "committer": {"name": "Paolo Carlini", "email": "paolo@gcc.gnu.org", "date": "2018-12-15T09:07:38Z"}, "message": "re PR c++/84644 (internal compiler error: in warn_misplaced_attr_for_class_type, at cp/decl.c:4718)\n\n/cp\n2018-12-15  Paolo Carlini  <paolo.carlini@oracle.com>\n\n\tPR c++/84644\n\t* decl.c (check_tag_decl): A decltype with no declarator\n\tdoesn't declare anything.\n\n/testsuite\n2018-12-15  Paolo Carlini  <paolo.carlini@oracle.com>\n\n\tPR c++/84644\n\t* g++.dg/cpp0x/decltype68.C: New.\n\t* g++.dg/cpp0x/decltype-33838.C: Adjust.\n\t* g++.dg/template/spec32.C: Likewise.\n\t* g++.dg/template/ttp22.C: Likewise.\n\nFrom-SVN: r267165", "tree": {"sha": "c6d0a9f9ff6ad1c4a868f8af6bfe1c20b3f41b96", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/c6d0a9f9ff6ad1c4a868f8af6bfe1c20b3f41b96"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/1039d00c597ece034f51a66d085fa80f1f11d9e2", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/1039d00c597ece034f51a66d085fa80f1f11d9e2", "html_url": "https://github.com/Rust-GCC/gccrs/commit/1039d00c597ece034f51a66d085fa80f1f11d9e2", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/1039d00c597ece034f51a66d085fa80f1f11d9e2/comments", "author": null, "committer": null, "parents": [{"sha": "590f447b7027c218a11df8434569135abf450747", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/590f447b7027c218a11df8434569135abf450747", "html_url": "https://github.com/Rust-GCC/gccrs/commit/590f447b7027c218a11df8434569135abf450747"}], "stats": {"total": 38, "additions": 32, "deletions": 6}, "files": [{"sha": "ee9e570687b8ae0e7bba5a2b837b0d6c817a87b7", "filename": "gcc/cp/ChangeLog", "status": "modified", "additions": 6, "deletions": 0, "changes": 6, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/1039d00c597ece034f51a66d085fa80f1f11d9e2/gcc%2Fcp%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/1039d00c597ece034f51a66d085fa80f1f11d9e2/gcc%2Fcp%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fcp%2FChangeLog?ref=1039d00c597ece034f51a66d085fa80f1f11d9e2", "patch": "@@ -1,3 +1,9 @@\n+2018-12-15  Paolo Carlini  <paolo.carlini@oracle.com>\n+\n+\tPR c++/84644\n+\t* decl.c (check_tag_decl): A decltype with no declarator\n+\tdoesn't declare anything.\n+\n 2018-12-14  Alexandre Oliva <aoliva@redhat.com>\n \n \tPR c++/87814"}, {"sha": "d6028e3608c448e7bd8db683af5ae40f7220c18a", "filename": "gcc/cp/decl.c", "status": "modified", "additions": 8, "deletions": 3, "changes": 11, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/1039d00c597ece034f51a66d085fa80f1f11d9e2/gcc%2Fcp%2Fdecl.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/1039d00c597ece034f51a66d085fa80f1f11d9e2/gcc%2Fcp%2Fdecl.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fcp%2Fdecl.c?ref=1039d00c597ece034f51a66d085fa80f1f11d9e2", "patch": "@@ -4803,15 +4803,20 @@ check_tag_decl (cp_decl_specifier_seq *declspecs,\n     declared_type = declspecs->type;\n   else if (declspecs->type == error_mark_node)\n     error_p = true;\n-  if (declared_type == NULL_TREE && ! saw_friend && !error_p)\n-    permerror (input_location, \"declaration does not declare anything\");\n-  else if (declared_type != NULL_TREE && type_uses_auto (declared_type))\n+\n+  if (type_uses_auto (declared_type))\n     {\n       error_at (declspecs->locations[ds_type_spec],\n \t\t\"%<auto%> can only be specified for variables \"\n \t\t\"or function declarations\");\n       return error_mark_node;\n     }\n+\n+  if (declared_type && !OVERLOAD_TYPE_P (declared_type))\n+    declared_type = NULL_TREE;\n+\n+  if (!declared_type && !saw_friend && !error_p)\n+    permerror (input_location, \"declaration does not declare anything\");\n   /* Check for an anonymous union.  */\n   else if (declared_type && RECORD_OR_UNION_CODE_P (TREE_CODE (declared_type))\n \t   && TYPE_UNNAMED_P (declared_type))"}, {"sha": "707d728bd29175b845da8890d561110812087dde", "filename": "gcc/testsuite/ChangeLog", "status": "modified", "additions": 8, "deletions": 0, "changes": 8, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/1039d00c597ece034f51a66d085fa80f1f11d9e2/gcc%2Ftestsuite%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/1039d00c597ece034f51a66d085fa80f1f11d9e2/gcc%2Ftestsuite%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2FChangeLog?ref=1039d00c597ece034f51a66d085fa80f1f11d9e2", "patch": "@@ -1,3 +1,11 @@\n+2018-12-15  Paolo Carlini  <paolo.carlini@oracle.com>\n+\n+\tPR c++/84644\n+\t* g++.dg/cpp0x/decltype68.C: New.\n+\t* g++.dg/cpp0x/decltype-33838.C: Adjust.\n+\t* g++.dg/template/spec32.C: Likewise.\n+\t* g++.dg/template/ttp22.C: Likewise.\n+\n 2018-12-15  Jakub Jelinek  <jakub@redhat.com>\n \n \tPR target/88489"}, {"sha": "43888da548a50210c8907ca78d905bad16e454ff", "filename": "gcc/testsuite/g++.dg/cpp0x/decltype-33838.C", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/1039d00c597ece034f51a66d085fa80f1f11d9e2/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Fcpp0x%2Fdecltype-33838.C", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/1039d00c597ece034f51a66d085fa80f1f11d9e2/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Fcpp0x%2Fdecltype-33838.C", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Fcpp0x%2Fdecltype-33838.C?ref=1039d00c597ece034f51a66d085fa80f1f11d9e2", "patch": "@@ -2,5 +2,5 @@\n // PR c++/33838\n template<typename T> struct A\n {\n-  __decltype (T* foo()); // { dg-error \"expected|no arguments|accept\" }\n+  __decltype (T* foo()); // { dg-error \"expected|no arguments|declaration\" }\n };"}, {"sha": "58740c1f10f2a2a1820249f3c5049ddd7498e9cd", "filename": "gcc/testsuite/g++.dg/cpp0x/decltype68.C", "status": "added", "additions": 7, "deletions": 0, "changes": 7, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/1039d00c597ece034f51a66d085fa80f1f11d9e2/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Fcpp0x%2Fdecltype68.C", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/1039d00c597ece034f51a66d085fa80f1f11d9e2/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Fcpp0x%2Fdecltype68.C", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Fcpp0x%2Fdecltype68.C?ref=1039d00c597ece034f51a66d085fa80f1f11d9e2", "patch": "@@ -0,0 +1,7 @@\n+// PR c++/84644\n+// { dg-do compile { target c++11 } }\n+\n+template<int a>\n+struct b {\n+  decltype(a) __attribute__((break));  // { dg-error \"declaration does not declare anything\" }\n+};"}, {"sha": "7cb3f40267643e77efbb245790539ea2892d2ca9", "filename": "gcc/testsuite/g++.dg/template/spec32.C", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/1039d00c597ece034f51a66d085fa80f1f11d9e2/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Ftemplate%2Fspec32.C", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/1039d00c597ece034f51a66d085fa80f1f11d9e2/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Ftemplate%2Fspec32.C", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Ftemplate%2Fspec32.C?ref=1039d00c597ece034f51a66d085fa80f1f11d9e2", "patch": "@@ -2,5 +2,5 @@\n \n struct A\n {\n-  template<template<int> class B> struct B<0>;  // { dg-error \"name of class shadows\" }\n+  template<template<int> class B> struct B<0>;  // { dg-error \"declaration does not declare anything\" }\n };"}, {"sha": "64aaf7437713565dc90f37365ba930d8296f9edf", "filename": "gcc/testsuite/g++.dg/template/ttp22.C", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/1039d00c597ece034f51a66d085fa80f1f11d9e2/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Ftemplate%2Fttp22.C", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/1039d00c597ece034f51a66d085fa80f1f11d9e2/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Ftemplate%2Fttp22.C", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Ftemplate%2Fttp22.C?ref=1039d00c597ece034f51a66d085fa80f1f11d9e2", "patch": "@@ -2,7 +2,7 @@\n // { dg-do compile }\n \n template<template<int> class A>\n-class A<0>;  // { dg-error \"shadows template template parameter\" }\n+class A<0>;  // { dg-error \"declaration does not declare anything\" }\n \n template<template<int> class B>\n class B<0> {};  // { dg-error \"shadows template template parameter\" }"}]}