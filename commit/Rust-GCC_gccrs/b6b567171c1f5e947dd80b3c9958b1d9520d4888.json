{"sha": "b6b567171c1f5e947dd80b3c9958b1d9520d4888", "node_id": "C_kwDOANBUbNoAKGI2YjU2NzE3MWMxZjVlOTQ3ZGQ4MGIzYzk5NThiMWQ5NTIwZDQ4ODg", "commit": {"author": {"name": "Arthur Cohen", "email": "arthur.cohen@embecosm.com", "date": "2022-03-14T10:33:53Z"}, "committer": {"name": "Arthur Cohen", "email": "arthur.cohen@embecosm.com", "date": "2022-03-16T08:38:09Z"}, "message": "attribute expansion: Fix spurious stripping of tail expression\n\nThis commit fixes the issue reported in #391, but highlights another\none, which will be reported.", "tree": {"sha": "681beb045d95736bb2d4cdb357a8f58b5f05889e", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/681beb045d95736bb2d4cdb357a8f58b5f05889e"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/b6b567171c1f5e947dd80b3c9958b1d9520d4888", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/b6b567171c1f5e947dd80b3c9958b1d9520d4888", "html_url": "https://github.com/Rust-GCC/gccrs/commit/b6b567171c1f5e947dd80b3c9958b1d9520d4888", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/b6b567171c1f5e947dd80b3c9958b1d9520d4888/comments", "author": {"login": "CohenArthur", "id": 43524065, "node_id": "MDQ6VXNlcjQzNTI0MDY1", "avatar_url": "https://avatars.githubusercontent.com/u/43524065?v=4", "gravatar_id": "", "url": "https://api.github.com/users/CohenArthur", "html_url": "https://github.com/CohenArthur", "followers_url": "https://api.github.com/users/CohenArthur/followers", "following_url": "https://api.github.com/users/CohenArthur/following{/other_user}", "gists_url": "https://api.github.com/users/CohenArthur/gists{/gist_id}", "starred_url": "https://api.github.com/users/CohenArthur/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/CohenArthur/subscriptions", "organizations_url": "https://api.github.com/users/CohenArthur/orgs", "repos_url": "https://api.github.com/users/CohenArthur/repos", "events_url": "https://api.github.com/users/CohenArthur/events{/privacy}", "received_events_url": "https://api.github.com/users/CohenArthur/received_events", "type": "User", "site_admin": false}, "committer": {"login": "CohenArthur", "id": 43524065, "node_id": "MDQ6VXNlcjQzNTI0MDY1", "avatar_url": "https://avatars.githubusercontent.com/u/43524065?v=4", "gravatar_id": "", "url": "https://api.github.com/users/CohenArthur", "html_url": "https://github.com/CohenArthur", "followers_url": "https://api.github.com/users/CohenArthur/followers", "following_url": "https://api.github.com/users/CohenArthur/following{/other_user}", "gists_url": "https://api.github.com/users/CohenArthur/gists{/gist_id}", "starred_url": "https://api.github.com/users/CohenArthur/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/CohenArthur/subscriptions", "organizations_url": "https://api.github.com/users/CohenArthur/orgs", "repos_url": "https://api.github.com/users/CohenArthur/repos", "events_url": "https://api.github.com/users/CohenArthur/events{/privacy}", "received_events_url": "https://api.github.com/users/CohenArthur/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "41f402f0b19c7e4f19f8d4d65d15223d2752f302", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/41f402f0b19c7e4f19f8d4d65d15223d2752f302", "html_url": "https://github.com/Rust-GCC/gccrs/commit/41f402f0b19c7e4f19f8d4d65d15223d2752f302"}], "stats": {"total": 17, "additions": 12, "deletions": 5}, "files": [{"sha": "c254712f4aeaceaecfb0a7ff11733d759b50e1f2", "filename": "gcc/rust/ast/rust-ast.h", "status": "modified", "additions": 4, "deletions": 3, "changes": 7, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/b6b567171c1f5e947dd80b3c9958b1d9520d4888/gcc%2Frust%2Fast%2Frust-ast.h", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/b6b567171c1f5e947dd80b3c9958b1d9520d4888/gcc%2Frust%2Fast%2Frust-ast.h", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Frust%2Fast%2Frust-ast.h?ref=b6b567171c1f5e947dd80b3c9958b1d9520d4888", "patch": "@@ -249,7 +249,8 @@ struct Literal\n     BYTE_STRING,\n     INT,\n     FLOAT,\n-    BOOL\n+    BOOL,\n+    ERROR\n   };\n \n private:\n@@ -274,11 +275,11 @@ struct Literal\n \n   static Literal create_error ()\n   {\n-    return Literal (\"\", CHAR, PrimitiveCoreType::CORETYPE_UNKNOWN);\n+    return Literal (\"\", ERROR, PrimitiveCoreType::CORETYPE_UNKNOWN);\n   }\n \n   // Returns whether literal is in an invalid state.\n-  bool is_error () const { return value_as_string == \"\"; }\n+  bool is_error () const { return type == ERROR; }\n };\n \n /* Forward decl - definition moved to rust-expr.h as it requires LiteralExpr to"}, {"sha": "4bfcbc80db4d2e5811694563087ff0da34815d6e", "filename": "gcc/rust/hir/rust-ast-lower-expr.h", "status": "modified", "additions": 4, "deletions": 0, "changes": 4, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/b6b567171c1f5e947dd80b3c9958b1d9520d4888/gcc%2Frust%2Fhir%2Frust-ast-lower-expr.h", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/b6b567171c1f5e947dd80b3c9958b1d9520d4888/gcc%2Frust%2Fhir%2Frust-ast-lower-expr.h", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Frust%2Fhir%2Frust-ast-lower-expr.h?ref=b6b567171c1f5e947dd80b3c9958b1d9520d4888", "patch": "@@ -359,6 +359,10 @@ class ASTLoweringExpr : public ASTLoweringBase\n       case AST::Literal::LitType::BOOL:\n \ttype = HIR::Literal::LitType::BOOL;\n \tbreak;\n+\t// Error literals should have been stripped during expansion\n+      case AST::Literal::LitType::ERROR:\n+\tgcc_unreachable ();\n+\tbreak;\n       }\n     auto crate_num = mappings->get_current_crate ();\n     Analysis::NodeMapping mapping (crate_num, expr.get_node_id (),"}, {"sha": "3087d4d0a5f8ad01382e81aa244a325563ac0c80", "filename": "gcc/testsuite/rust/compile/xfail/slice1.rs", "status": "modified", "additions": 4, "deletions": 2, "changes": 6, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/b6b567171c1f5e947dd80b3c9958b1d9520d4888/gcc%2Ftestsuite%2Frust%2Fcompile%2Fxfail%2Fslice1.rs", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/b6b567171c1f5e947dd80b3c9958b1d9520d4888/gcc%2Ftestsuite%2Frust%2Fcompile%2Fxfail%2Fslice1.rs", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Frust%2Fcompile%2Fxfail%2Fslice1.rs?ref=b6b567171c1f5e947dd80b3c9958b1d9520d4888", "patch": "@@ -1,3 +1,5 @@\n-fn foo (e: &str) -> &str {\n-    &\"\" // { dg-bogus \"cannot strip expression in this position - outer attributes not allowed\" \"#391\" { xfail *-*-* } }\n+// { dg-additional-options \"-w\" }\n+\n+fn foo(e: &str) -> &str { // { dg-bogus \"expected\" \"#391\" { xfail *-*-* } }\n+    &\"\" // { dg-bogus \"expected\" \"#391\" { xfail *-*-* } }\n }"}]}