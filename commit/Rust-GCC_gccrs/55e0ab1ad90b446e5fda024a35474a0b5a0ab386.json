{"sha": "55e0ab1ad90b446e5fda024a35474a0b5a0ab386", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6NTVlMGFiMWFkOTBiNDQ2ZTVmZGEwMjRhMzU0NzRhMGI1YTBhYjM4Ng==", "commit": {"author": {"name": "Ian Lance Taylor", "email": "ian@gcc.gnu.org", "date": "2013-10-11T22:53:17Z"}, "committer": {"name": "Ian Lance Taylor", "email": "ian@gcc.gnu.org", "date": "2013-10-11T22:53:17Z"}, "message": "compiler: Fix handling of hidden methods for unnamed types.\n\nIf an interface has hidden methods, we must make the interface\ntable comdat if it is for an unnamed type.\n\nWhen we create a stub method for an unnamed type, don't make\nit publically visible.\n\nFrom-SVN: r203468", "tree": {"sha": "34dffec5bc928bd0f98e09d5dc441034f6eb6c68", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/34dffec5bc928bd0f98e09d5dc441034f6eb6c68"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/55e0ab1ad90b446e5fda024a35474a0b5a0ab386", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/55e0ab1ad90b446e5fda024a35474a0b5a0ab386", "html_url": "https://github.com/Rust-GCC/gccrs/commit/55e0ab1ad90b446e5fda024a35474a0b5a0ab386", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/55e0ab1ad90b446e5fda024a35474a0b5a0ab386/comments", "author": null, "committer": null, "parents": [{"sha": "b7d93b468a08d46d5bd7d0ed9e08695eef89ce24", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/b7d93b468a08d46d5bd7d0ed9e08695eef89ce24", "html_url": "https://github.com/Rust-GCC/gccrs/commit/b7d93b468a08d46d5bd7d0ed9e08695eef89ce24"}], "stats": {"total": 29, "additions": 23, "deletions": 6}, "files": [{"sha": "ca80869da6ad1b02a272789d21e93ea891dd6048", "filename": "gcc/go/gofrontend/gogo-tree.cc", "status": "modified", "additions": 5, "deletions": 4, "changes": 9, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/55e0ab1ad90b446e5fda024a35474a0b5a0ab386/gcc%2Fgo%2Fgofrontend%2Fgogo-tree.cc", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/55e0ab1ad90b446e5fda024a35474a0b5a0ab386/gcc%2Fgo%2Fgofrontend%2Fgogo-tree.cc", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fgo%2Fgofrontend%2Fgogo-tree.cc?ref=55e0ab1ad90b446e5fda024a35474a0b5a0ab386", "patch": "@@ -2154,10 +2154,11 @@ Gogo::interface_method_table_for_type(const Interface_type* interface,\n   TREE_CONSTANT(decl) = 1;\n   DECL_INITIAL(decl) = constructor;\n \n-  // If the interface type has hidden methods, then this is the only\n-  // definition of the table.  Otherwise it is a comdat table which\n-  // may be defined in multiple packages.\n-  if (has_hidden_methods)\n+  // If the interface type has hidden methods, and the table is for a\n+  // named type, then this is the only definition of the table.\n+  // Otherwise it is a comdat table which may be defined in multiple\n+  // packages.\n+  if (has_hidden_methods && type->named_type() != NULL)\n     TREE_PUBLIC(decl) = 1;\n   else\n     {"}, {"sha": "eebb75377fae537fa5331f6b5f1d802daeaa1db5", "filename": "gcc/go/gofrontend/gogo.cc", "status": "modified", "additions": 4, "deletions": 2, "changes": 6, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/55e0ab1ad90b446e5fda024a35474a0b5a0ab386/gcc%2Fgo%2Fgofrontend%2Fgogo.cc", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/55e0ab1ad90b446e5fda024a35474a0b5a0ab386/gcc%2Fgo%2Fgofrontend%2Fgogo.cc", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fgo%2Fgofrontend%2Fgogo.cc?ref=55e0ab1ad90b446e5fda024a35474a0b5a0ab386", "patch": "@@ -3320,7 +3320,8 @@ Function::Function(Function_type* type, Function* enclosing, Block* block,\n     closure_var_(NULL), block_(block), location_(location), labels_(),\n     local_type_count_(0), descriptor_(NULL), fndecl_(NULL), defer_stack_(NULL),\n     is_sink_(false), results_are_named_(false), nointerface_(false),\n-    calls_recover_(false), is_recover_thunk_(false), has_recover_thunk_(false),\n+    is_unnamed_type_stub_method_(false), calls_recover_(false),\n+    is_recover_thunk_(false), has_recover_thunk_(false),\n     in_unique_section_(false)\n {\n }\n@@ -3844,7 +3845,8 @@ Function::get_or_make_decl(Gogo* gogo, Named_object* no)\n       else if (!Gogo::is_hidden_name(no->name())\n                || this->type_->is_method())\n         {\n-          is_visible = true;\n+\t  if (!this->is_unnamed_type_stub_method_)\n+\t    is_visible = true;\n           std::string pkgpath = gogo->pkgpath_symbol();\n           if (this->type_->is_method()\n               && Gogo::is_hidden_name(no->name())"}, {"sha": "31b258d62d6e3e17399af7706980780f55e021c5", "filename": "gcc/go/gofrontend/gogo.h", "status": "modified", "additions": 12, "deletions": 0, "changes": 12, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/55e0ab1ad90b446e5fda024a35474a0b5a0ab386/gcc%2Fgo%2Fgofrontend%2Fgogo.h", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/55e0ab1ad90b446e5fda024a35474a0b5a0ab386/gcc%2Fgo%2Fgofrontend%2Fgogo.h", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fgo%2Fgofrontend%2Fgogo.h?ref=55e0ab1ad90b446e5fda024a35474a0b5a0ab386", "patch": "@@ -953,6 +953,15 @@ class Function\n     this->nointerface_ = true;\n   }\n \n+  // Record that this function is a stub method created for an unnamed\n+  // type.\n+  void\n+  set_is_unnamed_type_stub_method()\n+  {\n+    go_assert(this->is_method());\n+    this->is_unnamed_type_stub_method_ = true;\n+  }\n+\n   // Add a new field to the closure variable.\n   void\n   add_closure_field(Named_object* var, Location loc)\n@@ -1178,6 +1187,9 @@ class Function\n   bool results_are_named_ : 1;\n   // True if this method should not be included in the type descriptor.\n   bool nointerface_ : 1;\n+  // True if this function is a stub method created for an unnamed\n+  // type.\n+  bool is_unnamed_type_stub_method_ : 1;\n   // True if this function calls the predeclared recover function.\n   bool calls_recover_ : 1;\n   // True if this a thunk built for a function which calls recover."}, {"sha": "69e3e99c1ff03e31bcdaf8f235ef950443104869", "filename": "gcc/go/gofrontend/types.cc", "status": "modified", "additions": 2, "deletions": 0, "changes": 2, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/55e0ab1ad90b446e5fda024a35474a0b5a0ab386/gcc%2Fgo%2Fgofrontend%2Ftypes.cc", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/55e0ab1ad90b446e5fda024a35474a0b5a0ab386/gcc%2Fgo%2Fgofrontend%2Ftypes.cc", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fgo%2Fgofrontend%2Ftypes.cc?ref=55e0ab1ad90b446e5fda024a35474a0b5a0ab386", "patch": "@@ -9031,6 +9031,8 @@ Type::build_stub_methods(Gogo* gogo, const Type* type, const Methods* methods,\n \t\t\t\t      fntype->is_varargs(), location);\n \t  gogo->finish_function(fntype->location());\n \n+\t  if (type->named_type() == NULL && stub->is_function())\n+\t    stub->func_value()->set_is_unnamed_type_stub_method();\n \t  if (m->nointerface() && stub->is_function())\n \t    stub->func_value()->set_nointerface();\n \t}"}]}