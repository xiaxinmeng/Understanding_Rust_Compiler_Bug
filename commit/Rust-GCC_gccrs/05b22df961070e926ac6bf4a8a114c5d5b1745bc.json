{"sha": "05b22df961070e926ac6bf4a8a114c5d5b1745bc", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6MDViMjJkZjk2MTA3MGU5MjZhYzZiZjRhOGExMTRjNWQ1YjE3NDViYw==", "commit": {"author": {"name": "Mark Mitchell", "email": "mark@codesourcery.com", "date": "2006-10-17T22:25:35Z"}, "committer": {"name": "Mark Mitchell", "email": "mmitchel@gcc.gnu.org", "date": "2006-10-17T22:25:35Z"}, "message": "re PR c++/27270 (ICE in process_init_constructor_array, at cp/typeck2.c:788)\n\n\tPR c++/27270\n\t* decl.c (reshape_init_class): Move check for designated\n\tto ...\n\t* parser.c (cp_parser_initializer_list): ... here.\n\t* pt.c (tsubst_copy_and_build): Use finish_compound_literal.\n\tPR c++/27270\n\t* g++.dg/ext/complit8.C: Tweak error markers.\n\t* g++.dg/template/complit1.C: Add error marker.\n\nFrom-SVN: r117832", "tree": {"sha": "7ae5ef2f3ce54bf483d079ff2b41fe4ea8cb9cc1", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/7ae5ef2f3ce54bf483d079ff2b41fe4ea8cb9cc1"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/05b22df961070e926ac6bf4a8a114c5d5b1745bc", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/05b22df961070e926ac6bf4a8a114c5d5b1745bc", "html_url": "https://github.com/Rust-GCC/gccrs/commit/05b22df961070e926ac6bf4a8a114c5d5b1745bc", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/05b22df961070e926ac6bf4a8a114c5d5b1745bc/comments", "author": null, "committer": null, "parents": [{"sha": "b3b363332380c4306374247285e21a7ac771731b", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/b3b363332380c4306374247285e21a7ac771731b", "html_url": "https://github.com/Rust-GCC/gccrs/commit/b3b363332380c4306374247285e21a7ac771731b"}], "stats": {"total": 36, "additions": 22, "deletions": 14}, "files": [{"sha": "47285866dc6608cfe7d42e3cd0e3e6abc7a35be3", "filename": "gcc/cp/ChangeLog", "status": "modified", "additions": 8, "deletions": 0, "changes": 8, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/05b22df961070e926ac6bf4a8a114c5d5b1745bc/gcc%2Fcp%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/05b22df961070e926ac6bf4a8a114c5d5b1745bc/gcc%2Fcp%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fcp%2FChangeLog?ref=05b22df961070e926ac6bf4a8a114c5d5b1745bc", "patch": "@@ -1,3 +1,11 @@\n+2006-10-17  Mark Mitchell  <mark@codesourcery.com>\n+\n+\tPR c++/27270\n+\t* decl.c (reshape_init_class): Move check for designated\n+\tto ...\n+\t* parser.c (cp_parser_initializer_list): ... here.\n+\t* pt.c (tsubst_copy_and_build): Use finish_compound_literal.\n+\n 2006-10-16  Mark Mitchell  <mark@codesourcery.com>\n \n \tPR c++/27270"}, {"sha": "11bb6486456c04d47b6be0eedaab3bf9a958766e", "filename": "gcc/cp/decl.c", "status": "modified", "additions": 0, "deletions": 3, "changes": 3, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/05b22df961070e926ac6bf4a8a114c5d5b1745bc/gcc%2Fcp%2Fdecl.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/05b22df961070e926ac6bf4a8a114c5d5b1745bc/gcc%2Fcp%2Fdecl.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fcp%2Fdecl.c?ref=05b22df961070e926ac6bf4a8a114c5d5b1745bc", "patch": "@@ -4485,9 +4485,6 @@ reshape_init_class (tree type, reshape_iter *d, bool first_initializer_p)\n       /* Handle designated initializers, as an extension.  */\n       if (d->cur->index)\n \t{\n-\t  if (pedantic)\n-\t    pedwarn (\"ISO C++ does not allow designated initializers\");\n-\n \t  field = lookup_field_1 (type, d->cur->index, /*want_type=*/false);\n \n \t  if (!field || TREE_CODE (field) != FIELD_DECL)"}, {"sha": "dfcbe733316e8413821845b4e6f2b0ef339ce5da", "filename": "gcc/cp/parser.c", "status": "modified", "additions": 3, "deletions": 0, "changes": 3, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/05b22df961070e926ac6bf4a8a114c5d5b1745bc/gcc%2Fcp%2Fparser.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/05b22df961070e926ac6bf4a8a114c5d5b1745bc/gcc%2Fcp%2Fparser.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fcp%2Fparser.c?ref=05b22df961070e926ac6bf4a8a114c5d5b1745bc", "patch": "@@ -12736,6 +12736,9 @@ cp_parser_initializer_list (cp_parser* parser, bool* non_constant_p)\n \t  && cp_lexer_next_token_is (parser->lexer, CPP_NAME)\n \t  && cp_lexer_peek_nth_token (parser->lexer, 2)->type == CPP_COLON)\n \t{\n+\t  /* Warn the user that they are using an extension.  */\n+\t  if (pedantic)\n+\t    pedwarn (\"ISO C++ does not allow designated initializers\");\n \t  /* Consume the identifier.  */\n \t  identifier = cp_lexer_consume_token (parser->lexer)->value;\n \t  /* Consume the `:'.  */"}, {"sha": "9a4626415c85f75b4ed57d90777831562a96c7df", "filename": "gcc/cp/pt.c", "status": "modified", "additions": 3, "deletions": 9, "changes": 12, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/05b22df961070e926ac6bf4a8a114c5d5b1745bc/gcc%2Fcp%2Fpt.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/05b22df961070e926ac6bf4a8a114c5d5b1745bc/gcc%2Fcp%2Fpt.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fcp%2Fpt.c?ref=05b22df961070e926ac6bf4a8a114c5d5b1745bc", "patch": "@@ -9323,7 +9323,6 @@ tsubst_copy_and_build (tree t,\n \tVEC(constructor_elt,gc) *n;\n \tconstructor_elt *ce;\n \tunsigned HOST_WIDE_INT idx;\n-\ttree r;\n \ttree type = tsubst (TREE_TYPE (t), args, complain, in_decl);\n \tbool process_index_p;\n \n@@ -9347,15 +9346,10 @@ tsubst_copy_and_build (tree t,\n \t    ce->value = RECUR (ce->value);\n \t  }\n \n-\tr = build_constructor (NULL_TREE, n);\n-\tTREE_HAS_CONSTRUCTOR (r) = TREE_HAS_CONSTRUCTOR (t);\n+\tif (TREE_HAS_CONSTRUCTOR (t))\n+\t  return finish_compound_literal (type, n);\n \n-\tif (type)\n-\t  {\n-\t    r = reshape_init (type, r);\n-\t    return digest_init (type, r);\n-\t  }\n-\treturn r;\n+\treturn build_constructor (NULL_TREE, n);\n       }\n \n     case TYPEID_EXPR:"}, {"sha": "4fed928d1caddcdee2befeaf65d20953d9e718f4", "filename": "gcc/testsuite/ChangeLog", "status": "modified", "additions": 6, "deletions": 0, "changes": 6, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/05b22df961070e926ac6bf4a8a114c5d5b1745bc/gcc%2Ftestsuite%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/05b22df961070e926ac6bf4a8a114c5d5b1745bc/gcc%2Ftestsuite%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2FChangeLog?ref=05b22df961070e926ac6bf4a8a114c5d5b1745bc", "patch": "@@ -1,3 +1,9 @@\n+2006-10-17  Mark Mitchell  <mark@codesourcery.com>\n+\n+\tPR c++/27270\n+\t* g++.dg/ext/complit8.C: Tweak error markers.\n+\t* g++.dg/template/complit1.C: Add error marker.\n+\n 2006-10-16  Mark Mitchell  <mark@codesourcery.com>\n \n \tPR c++/27270"}, {"sha": "97ff563feec16a17c1c892f42e5f2f702a06bcec", "filename": "gcc/testsuite/g++.dg/ext/complit8.C", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/05b22df961070e926ac6bf4a8a114c5d5b1745bc/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Fext%2Fcomplit8.C", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/05b22df961070e926ac6bf4a8a114c5d5b1745bc/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Fext%2Fcomplit8.C", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Fext%2Fcomplit8.C?ref=05b22df961070e926ac6bf4a8a114c5d5b1745bc", "patch": "@@ -5,7 +5,7 @@ template<typename Entry>\n struct Array {\n   Entry *array[32];\n   Array () :\n-    array ( (Entry*[1]) { 0, 0 } ) // { dg-error \"initializers|conversion\" }\n+    array ( (Entry*[1]) { 0, 0 } ) // { dg-error \"initializers|incompatible\" }\n   {}\n };\n "}, {"sha": "218a7c92908306d1570d39cdd8a935bed31a55bf", "filename": "gcc/testsuite/g++.dg/template/complit1.C", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/05b22df961070e926ac6bf4a8a114c5d5b1745bc/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Ftemplate%2Fcomplit1.C", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/05b22df961070e926ac6bf4a8a114c5d5b1745bc/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Ftemplate%2Fcomplit1.C", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Ftemplate%2Fcomplit1.C?ref=05b22df961070e926ac6bf4a8a114c5d5b1745bc", "patch": "@@ -6,6 +6,6 @@ template <int D> struct C {\n };\n \n template<int D>\n-C<D>::C() : d((int[]){1,2,3}) {}\n+C<D>::C() : d((int[]){1,2,3}) {} // { dg-error \"array\" }\n \n template class C<1>;"}]}