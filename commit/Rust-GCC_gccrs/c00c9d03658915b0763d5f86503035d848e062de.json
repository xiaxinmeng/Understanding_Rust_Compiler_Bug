{"sha": "c00c9d03658915b0763d5f86503035d848e062de", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6YzAwYzlkMDM2NTg5MTViMDc2M2Q1Zjg2NTAzMDM1ZDg0OGUwNjJkZQ==", "commit": {"author": {"name": "Martin Liska", "email": "mliska@suse.cz", "date": "2018-07-26T12:13:14Z"}, "committer": {"name": "Martin Liska", "email": "marxin@gcc.gnu.org", "date": "2018-07-26T12:13:14Z"}, "message": "Add linker_output as prefix for LTO temps (PR lto/86548).\n\n2018-07-26  Martin Liska  <mliska@suse.cz>\n\n        PR lto/86548\n\t* lto-wrapper.c: Add linker_output as prefix\n        for ltrans_output_file.\n2018-07-26  Martin Liska  <mliska@suse.cz>\n\n        PR lto/86548\n\t* libiberty.h (make_temp_file_with_prefix): New function.\n2018-07-26  Martin Liska  <mliska@suse.cz>\n\n        PR lto/86548\n\t* make-temp-file.c (TEMP_FILE): Remove leading 'cc'.\n\t(make_temp_file): Call make_temp_file_with_prefix with\n        first argument set to NULL.\n\t(make_temp_file_with_prefix): Support also prefix.\n\nFrom-SVN: r262999", "tree": {"sha": "2ed49df7c6193dcb1395b26386f0cda4a3c03605", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/2ed49df7c6193dcb1395b26386f0cda4a3c03605"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/c00c9d03658915b0763d5f86503035d848e062de", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/c00c9d03658915b0763d5f86503035d848e062de", "html_url": "https://github.com/Rust-GCC/gccrs/commit/c00c9d03658915b0763d5f86503035d848e062de", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/c00c9d03658915b0763d5f86503035d848e062de/comments", "author": {"login": "marxin", "id": 2658545, "node_id": "MDQ6VXNlcjI2NTg1NDU=", "avatar_url": "https://avatars.githubusercontent.com/u/2658545?v=4", "gravatar_id": "", "url": "https://api.github.com/users/marxin", "html_url": "https://github.com/marxin", "followers_url": "https://api.github.com/users/marxin/followers", "following_url": "https://api.github.com/users/marxin/following{/other_user}", "gists_url": "https://api.github.com/users/marxin/gists{/gist_id}", "starred_url": "https://api.github.com/users/marxin/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/marxin/subscriptions", "organizations_url": "https://api.github.com/users/marxin/orgs", "repos_url": "https://api.github.com/users/marxin/repos", "events_url": "https://api.github.com/users/marxin/events{/privacy}", "received_events_url": "https://api.github.com/users/marxin/received_events", "type": "User", "site_admin": false}, "committer": null, "parents": [{"sha": "e98edc20cd615f43afce32c5de40d59fa25e40ed", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/e98edc20cd615f43afce32c5de40d59fa25e40ed", "html_url": "https://github.com/Rust-GCC/gccrs/commit/e98edc20cd615f43afce32c5de40d59fa25e40ed"}], "stats": {"total": 62, "additions": 55, "deletions": 7}, "files": [{"sha": "d9e8e1083312e964355e36b76284ed0c22d32376", "filename": "gcc/ChangeLog", "status": "modified", "additions": 6, "deletions": 0, "changes": 6, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/c00c9d03658915b0763d5f86503035d848e062de/gcc%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/c00c9d03658915b0763d5f86503035d848e062de/gcc%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2FChangeLog?ref=c00c9d03658915b0763d5f86503035d848e062de", "patch": "@@ -1,3 +1,9 @@\n+2018-07-26  Martin Liska  <mliska@suse.cz>\n+\n+        PR lto/86548\n+\t* lto-wrapper.c: Add linker_output as prefix\n+        for ltrans_output_file.\n+\n 2018-07-26  Segher Boessenkool  <segher@kernel.crashing.org>\n \n \tPR rtl-optimization/85805"}, {"sha": "cf4a8c659e08bbc58dda2050152d1ff421c9f42f", "filename": "gcc/lto-wrapper.c", "status": "modified", "additions": 13, "deletions": 1, "changes": 14, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/c00c9d03658915b0763d5f86503035d848e062de/gcc%2Flto-wrapper.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/c00c9d03658915b0763d5f86503035d848e062de/gcc%2Flto-wrapper.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Flto-wrapper.c?ref=c00c9d03658915b0763d5f86503035d848e062de", "patch": "@@ -1373,7 +1373,19 @@ run_gcc (unsigned argc, char *argv[])\n \t  strcat (ltrans_output_file, \".ltrans.out\");\n \t}\n       else\n-\tltrans_output_file = make_temp_file (\".ltrans.out\");\n+\t{\n+\t  char *prefix = NULL;\n+\t  if (linker_output)\n+\t    {\n+\t      prefix = (char *) xmalloc (strlen (linker_output) + 2);\n+\t      strcpy (prefix, linker_output);\n+\t      strcat (prefix, \".\");\n+\t    }\n+\n+\t  ltrans_output_file = make_temp_file_with_prefix (prefix,\n+\t\t\t\t\t\t\t   \".ltrans.out\");\n+\t  free (prefix);\n+\t}\n       list_option_full = (char *) xmalloc (sizeof (char) *\n \t\t         (strlen (ltrans_output_file) + list_option_len + 1));\n       tmp = list_option_full;"}, {"sha": "6d04fa14a677aad494f8ce51cc542564b184fc7b", "filename": "include/ChangeLog", "status": "modified", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/c00c9d03658915b0763d5f86503035d848e062de/include%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/c00c9d03658915b0763d5f86503035d848e062de/include%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/include%2FChangeLog?ref=c00c9d03658915b0763d5f86503035d848e062de", "patch": "@@ -1,3 +1,8 @@\n+2018-07-26  Martin Liska  <mliska@suse.cz>\n+\n+        PR lto/86548\n+\t* libiberty.h (make_temp_file_with_prefix): New function.\n+\n 2018-05-30  Jan Hubicka  <hubicka@ucw.cz>\n \n \t* simple-object.h (simple_object_copy_lto_debug_sections): Add rename"}, {"sha": "0823614c00e1ff8a0700349d0331afecc1ff3dee", "filename": "include/libiberty.h", "status": "modified", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/c00c9d03658915b0763d5f86503035d848e062de/include%2Flibiberty.h", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/c00c9d03658915b0763d5f86503035d848e062de/include%2Flibiberty.h", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/include%2Flibiberty.h?ref=c00c9d03658915b0763d5f86503035d848e062de", "patch": "@@ -239,6 +239,11 @@ extern char *choose_temp_base (void) ATTRIBUTE_MALLOC ATTRIBUTE_RETURNS_NONNULL;\n \n extern char *make_temp_file (const char *) ATTRIBUTE_MALLOC;\n \n+/* Return a temporary file name with given PREFIX and SUFFIX\n+   or NULL if unable to create one.  */\n+\n+extern char *make_temp_file_with_prefix (const char *, const char *) ATTRIBUTE_MALLOC;\n+\n /* Remove a link to a file unless it is special. */\n \n extern int unlink_if_ordinary (const char *);"}, {"sha": "dc5d9971f68e0c5a7339aefe856c8a29161768d0", "filename": "libiberty/ChangeLog", "status": "modified", "additions": 8, "deletions": 0, "changes": 8, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/c00c9d03658915b0763d5f86503035d848e062de/libiberty%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/c00c9d03658915b0763d5f86503035d848e062de/libiberty%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libiberty%2FChangeLog?ref=c00c9d03658915b0763d5f86503035d848e062de", "patch": "@@ -1,3 +1,11 @@\n+2018-07-26  Martin Liska  <mliska@suse.cz>\n+\n+        PR lto/86548\n+\t* make-temp-file.c (TEMP_FILE): Remove leading 'cc'.\n+\t(make_temp_file): Call make_temp_file_with_prefix with\n+        first argument set to NULL.\n+\t(make_temp_file_with_prefix): Support also prefix.\n+\n 2018-07-19  Eli Zaretskii  <eliz@gnu.org>\n \n \t* simple-object-elf.c (ENOTSUP): If not defined by errno.h, redirect"}, {"sha": "21b0545754245e5371ed4e5758b0b7870861a002", "filename": "libiberty/make-temp-file.c", "status": "modified", "additions": 18, "deletions": 6, "changes": 24, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/c00c9d03658915b0763d5f86503035d848e062de/libiberty%2Fmake-temp-file.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/c00c9d03658915b0763d5f86503035d848e062de/libiberty%2Fmake-temp-file.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libiberty%2Fmake-temp-file.c?ref=c00c9d03658915b0763d5f86503035d848e062de", "patch": "@@ -56,7 +56,7 @@ extern int mkstemps (char *, int);\n \n /* Name of temporary file.\n    mktemp requires 6 trailing X's.  */\n-#define TEMP_FILE \"ccXXXXXX\"\n+#define TEMP_FILE \"XXXXXX\"\n #define TEMP_FILE_LEN (sizeof(TEMP_FILE) - 1)\n \n #if !defined(_WIN32) || defined(__CYGWIN__)\n@@ -181,25 +181,31 @@ string is @code{malloc}ed, and the temporary file has been created.\n */\n \n char *\n-make_temp_file (const char *suffix)\n+make_temp_file_with_prefix (const char *prefix, const char *suffix)\n {\n   const char *base = choose_tmpdir ();\n   char *temp_filename;\n-  int base_len, suffix_len;\n+  int base_len, suffix_len, prefix_len;\n   int fd;\n \n+  if (prefix == 0)\n+    prefix = \"cc\";\n+\n   if (suffix == 0)\n     suffix = \"\";\n \n   base_len = strlen (base);\n+  prefix_len = strlen (prefix);\n   suffix_len = strlen (suffix);\n \n   temp_filename = XNEWVEC (char, base_len\n \t\t\t   + TEMP_FILE_LEN\n-\t\t\t   + suffix_len + 1);\n+\t\t\t   + suffix_len\n+\t\t\t   + prefix_len + 1);\n   strcpy (temp_filename, base);\n-  strcpy (temp_filename + base_len, TEMP_FILE);\n-  strcpy (temp_filename + base_len + TEMP_FILE_LEN, suffix);\n+  strcpy (temp_filename + base_len, prefix);\n+  strcpy (temp_filename + base_len + prefix_len, TEMP_FILE);\n+  strcpy (temp_filename + base_len + prefix_len + TEMP_FILE_LEN, suffix);\n \n   fd = mkstemps (temp_filename, suffix_len);\n   /* Mkstemps failed.  It may be EPERM, ENOSPC etc.  */\n@@ -214,3 +220,9 @@ make_temp_file (const char *suffix)\n     abort ();\n   return temp_filename;\n }\n+\n+char *\n+make_temp_file (const char *suffix)\n+{\n+  return make_temp_file_with_prefix (NULL, suffix);\n+}"}]}