{"sha": "0bde02b33905ecfb252b96cbe2ea257f0c0606da", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6MGJkZTAyYjMzOTA1ZWNmYjI1MmI5NmNiZTJlYTI1N2YwYzA2MDZkYQ==", "commit": {"author": {"name": "Jan Hubicka", "email": "jh@suse.cz", "date": "2005-07-30T22:14:17Z"}, "committer": {"name": "Jan Hubicka", "email": "hubicka@gcc.gnu.org", "date": "2005-07-30T22:14:17Z"}, "message": "tree-outof-ssa.c (coalesce_ssa_name): Use coalesce_cost.\n\n\n\t* tree-outof-ssa.c (coalesce_ssa_name): Use coalesce_cost.\n\t(coalesce_vars): Likewise.\n\t* tree-ssa-live.c (coalesce_cost): New.\n\t(build_tree_conflict_graph): Use coalesce_cost.\n\t* tree-ssa-live.h (coalesce_cost): Declare.\n\nFrom-SVN: r102593", "tree": {"sha": "90c26e80fc63e94c4779d3d07c7d2bf90e51f41c", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/90c26e80fc63e94c4779d3d07c7d2bf90e51f41c"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/0bde02b33905ecfb252b96cbe2ea257f0c0606da", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/0bde02b33905ecfb252b96cbe2ea257f0c0606da", "html_url": "https://github.com/Rust-GCC/gccrs/commit/0bde02b33905ecfb252b96cbe2ea257f0c0606da", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/0bde02b33905ecfb252b96cbe2ea257f0c0606da/comments", "author": null, "committer": null, "parents": [{"sha": "ee25d4cbe310fb88f30e64ed49be405e98cf2300", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/ee25d4cbe310fb88f30e64ed49be405e98cf2300", "html_url": "https://github.com/Rust-GCC/gccrs/commit/ee25d4cbe310fb88f30e64ed49be405e98cf2300"}], "stats": {"total": 56, "additions": 51, "deletions": 5}, "files": [{"sha": "a2c7bdc02729c1f3971ee69a88bc58222b5394c3", "filename": "gcc/ChangeLog", "status": "modified", "additions": 8, "deletions": 0, "changes": 8, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/0bde02b33905ecfb252b96cbe2ea257f0c0606da/gcc%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/0bde02b33905ecfb252b96cbe2ea257f0c0606da/gcc%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2FChangeLog?ref=0bde02b33905ecfb252b96cbe2ea257f0c0606da", "patch": "@@ -1,3 +1,11 @@\n+2005-07-31  Jan Hubicka  <jh@suse.cz>\n+\n+\t* tree-outof-ssa.c (coalesce_ssa_name): Use coalesce_cost.\n+\t(coalesce_vars): Likewise.\n+\t* tree-ssa-live.c (coalesce_cost): New.\n+\t(build_tree_conflict_graph): Use coalesce_cost.\n+\t* tree-ssa-live.h (coalesce_cost): Declare.\n+\n 2005-07-30  Richard Earnshaw  <richard.earnshaw@arm.com>\n \n \t* arm.md (all peepholes for post-increment operations): Delete."}, {"sha": "b8ceaa85cd41d0ea201fbb6ef296ef23a7a44a5c", "filename": "gcc/tree-outof-ssa.c", "status": "modified", "additions": 19, "deletions": 3, "changes": 22, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/0bde02b33905ecfb252b96cbe2ea257f0c0606da/gcc%2Ftree-outof-ssa.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/0bde02b33905ecfb252b96cbe2ea257f0c0606da/gcc%2Ftree-outof-ssa.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftree-outof-ssa.c?ref=0bde02b33905ecfb252b96cbe2ea257f0c0606da", "patch": "@@ -729,7 +729,13 @@ coalesce_ssa_name (var_map map, int flags)\n \t\tcontinue;\n \t      p2 = var_to_partition (map, PHI_ARG_DEF (phi, x));\n \t      if (p2 != NO_PARTITION)\n-\t\tadd_coalesce (cl, p, p2, 1);\n+\t\t{\n+\t\t  edge e = PHI_ARG_EDGE (phi, x);\n+\t\t  add_coalesce (cl, p, p2,\n+\t\t\t\tcoalesce_cost (EDGE_FREQUENCY (e),\n+\t\t\t\t\t       maybe_hot_bb_p (bb),\n+\t\t\t\t\t       EDGE_CRITICAL_P (e)));\n+\t\t}\n \t    }\n \t}\n     }\n@@ -748,7 +754,10 @@ coalesce_ssa_name (var_map map, int flags)\n \t      i = x;\n \t    }\n \t  else\n-\t    add_coalesce (cl, i, x, 1);\n+\t    add_coalesce (cl, i, x,\n+\t\t\t  coalesce_cost (EXIT_BLOCK_PTR->frequency,\n+\t\t\t\t\t maybe_hot_bb_p (EXIT_BLOCK_PTR),\n+\t\t\t\t\t false));\n \t}\n     }\n \n@@ -1097,7 +1106,14 @@ coalesce_vars (var_map map, tree_live_info_p liveinfo)\n \t      if (p2 == (unsigned)NO_PARTITION)\n \t\tcontinue;\n \t      if (p != p2)\n-\t        add_coalesce (cl, p, p2, 1);\n+\t\t{\n+\t\t  edge e = PHI_ARG_EDGE (phi, x);\n+\n+\t\t  add_coalesce (cl, p, p2, \n+\t\t\t\tcoalesce_cost (EDGE_FREQUENCY (e),\n+\t\t\t\t\t       maybe_hot_bb_p (bb),\n+\t\t\t\t\t       EDGE_CRITICAL_P (e)));\n+\t\t}\n \t    }\n \t}\n    }"}, {"sha": "132af929852e8ba4b33a55e85279f0f8214adc78", "filename": "gcc/tree-ssa-live.c", "status": "modified", "additions": 23, "deletions": 2, "changes": 25, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/0bde02b33905ecfb252b96cbe2ea257f0c0606da/gcc%2Ftree-ssa-live.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/0bde02b33905ecfb252b96cbe2ea257f0c0606da/gcc%2Ftree-ssa-live.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftree-ssa-live.c?ref=0bde02b33905ecfb252b96cbe2ea257f0c0606da", "patch": "@@ -1145,11 +1145,30 @@ find_partition_pair (coalesce_list_p cl, int p1, int p2, bool create)\n   return node;\n }\n \n+/* Return cost of execution of copy instruction with FREQUENCY\n+   possibly on CRITICAL edge and in HOT basic block.  */\n+int\n+coalesce_cost (int frequency, bool hot, bool critical)\n+{\n+  /* Base costs on BB frequencies bounded by 1.  */\n+  int cost = frequency;\n+\n+  if (!cost)\n+    cost = 1;\n+  if (optimize_size || hot)\n+    cost = 1;\n+  /* Inserting copy on critical edge costs more\n+     than inserting it elsewhere.  */\n+  if (critical)\n+    cost *= 2;\n+  return cost;\n+}\n \n /* Add a potential coalesce between P1 and P2 in CL with a cost of VALUE.  */\n \n void \n-add_coalesce (coalesce_list_p cl, int p1, int p2, int value)\n+add_coalesce (coalesce_list_p cl, int p1, int p2,\n+\t      int value)\n {\n   partition_pair_p node;\n \n@@ -1383,7 +1402,9 @@ build_tree_conflict_graph (tree_live_info_p liveinfo, tpa_p tpa,\n \t\t  if (bit)\n \t\t    bitmap_set_bit (live, p2);\n \t\t  if (cl)\n-\t\t    add_coalesce (cl, p1, p2, 1);\n+\t\t    add_coalesce (cl, p1, p2,\n+\t\t\t\t  coalesce_cost (bb->frequency,\n+\t\t\t\t                 maybe_hot_bb_p (bb), false));\n \t\t  set_if_valid (map, live, rhs);\n \t\t}\n \t    }"}, {"sha": "2c4127402fab6f9e4dd9e1ef3b17a0196ba71caa", "filename": "gcc/tree-ssa-live.h", "status": "modified", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/0bde02b33905ecfb252b96cbe2ea257f0c0606da/gcc%2Ftree-ssa-live.h", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/0bde02b33905ecfb252b96cbe2ea257f0c0606da/gcc%2Ftree-ssa-live.h", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftree-ssa-live.h?ref=0bde02b33905ecfb252b96cbe2ea257f0c0606da", "patch": "@@ -700,6 +700,7 @@ typedef struct coalesce_list_d\n \n extern coalesce_list_p create_coalesce_list (var_map);\n extern void add_coalesce (coalesce_list_p, int, int, int);\n+extern int coalesce_cost (int, bool, bool);\n extern void sort_coalesce_list (coalesce_list_p);\n extern void dump_coalesce_list (FILE *, coalesce_list_p);\n extern void delete_coalesce_list (coalesce_list_p);"}]}