{"sha": "caff7edf99996cbf552d1f76308f7fc103d51f47", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6Y2FmZjdlZGY5OTk5NmNiZjU1MmQxZjc2MzA4ZjdmYzEwM2Q1MWY0Nw==", "commit": {"author": {"name": "Jakub Jelinek", "email": "jakub@redhat.com", "date": "2013-03-01T22:55:26Z"}, "committer": {"name": "Jakub Jelinek", "email": "jakub@gcc.gnu.org", "date": "2013-03-01T22:55:26Z"}, "message": "re PR middle-end/56461 (GCC is leaking lots of memory)\n\n\tPR middle-end/56461\n\t* ira-build.c (ira_loop_nodes_count): New variable.\n\t(create_loop_tree_nodes): Initialize it.\n\t(finish_loop_tree_nodes): Use it instead of looking at current_loops.\n\nFrom-SVN: r196397", "tree": {"sha": "890b5e0f3346d2d526e143f398661f7d0627dffc", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/890b5e0f3346d2d526e143f398661f7d0627dffc"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/caff7edf99996cbf552d1f76308f7fc103d51f47", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/caff7edf99996cbf552d1f76308f7fc103d51f47", "html_url": "https://github.com/Rust-GCC/gccrs/commit/caff7edf99996cbf552d1f76308f7fc103d51f47", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/caff7edf99996cbf552d1f76308f7fc103d51f47/comments", "author": {"login": "jakubjelinek", "id": 9370665, "node_id": "MDQ6VXNlcjkzNzA2NjU=", "avatar_url": "https://avatars.githubusercontent.com/u/9370665?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jakubjelinek", "html_url": "https://github.com/jakubjelinek", "followers_url": "https://api.github.com/users/jakubjelinek/followers", "following_url": "https://api.github.com/users/jakubjelinek/following{/other_user}", "gists_url": "https://api.github.com/users/jakubjelinek/gists{/gist_id}", "starred_url": "https://api.github.com/users/jakubjelinek/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jakubjelinek/subscriptions", "organizations_url": "https://api.github.com/users/jakubjelinek/orgs", "repos_url": "https://api.github.com/users/jakubjelinek/repos", "events_url": "https://api.github.com/users/jakubjelinek/events{/privacy}", "received_events_url": "https://api.github.com/users/jakubjelinek/received_events", "type": "User", "site_admin": false}, "committer": null, "parents": [{"sha": "b6b9227d52396910e9dd81f4de4e90a80103fb8d", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/b6b9227d52396910e9dd81f4de4e90a80103fb8d", "html_url": "https://github.com/Rust-GCC/gccrs/commit/b6b9227d52396910e9dd81f4de4e90a80103fb8d"}], "stats": {"total": 20, "additions": 13, "deletions": 7}, "files": [{"sha": "133af66eaf7c2cfbb90d9eb72431402a4e9e3011", "filename": "gcc/ChangeLog", "status": "modified", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/caff7edf99996cbf552d1f76308f7fc103d51f47/gcc%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/caff7edf99996cbf552d1f76308f7fc103d51f47/gcc%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2FChangeLog?ref=caff7edf99996cbf552d1f76308f7fc103d51f47", "patch": "@@ -1,5 +1,10 @@\n 2013-03-01  Jakub Jelinek  <jakub@redhat.com>\n \n+\tPR middle-end/56461\n+\t* ira-build.c (ira_loop_nodes_count): New variable.\n+\t(create_loop_tree_nodes): Initialize it.\n+\t(finish_loop_tree_nodes): Use it instead of looking at current_loops.\n+\n \tPR middle-end/56461\n \t* tree-vect-data-refs.c (vect_permute_store_chain): Avoid using copy\n \tmethod on dr_chain and result_chain."}, {"sha": "b1e481bdb055b634bd91f43fc15585b6e9dad87b", "filename": "gcc/ira-build.c", "status": "modified", "additions": 8, "deletions": 7, "changes": 15, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/caff7edf99996cbf552d1f76308f7fc103d51f47/gcc%2Fira-build.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/caff7edf99996cbf552d1f76308f7fc103d51f47/gcc%2Fira-build.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fira-build.c?ref=caff7edf99996cbf552d1f76308f7fc103d51f47", "patch": "@@ -57,6 +57,9 @@ ira_loop_tree_node_t ira_bb_nodes;\n    array.  */\n ira_loop_tree_node_t ira_loop_nodes;\n \n+/* And size of the ira_loop_nodes array.  */\n+unsigned int ira_loop_nodes_count;\n+\n /* Map regno -> allocnos with given regno (see comments for\n    allocno member `next_regno_allocno').  */\n ira_allocno_t *ira_regno_allocno_map;\n@@ -142,14 +145,16 @@ create_loop_tree_nodes (void)\n     }\n   if (current_loops == NULL)\n     {\n+      ira_loop_nodes_count = 1;\n       ira_loop_nodes = ((struct ira_loop_tree_node *)\n \t\t\tira_allocate (sizeof (struct ira_loop_tree_node)));\n       init_loop_tree_node (ira_loop_nodes, 0);\n       return;\n     }\n+  ira_loop_nodes_count = number_of_loops ();\n   ira_loop_nodes = ((struct ira_loop_tree_node *)\n \t\t    ira_allocate (sizeof (struct ira_loop_tree_node)\n-\t\t\t\t  * number_of_loops ()));\n+\t\t\t\t  * ira_loop_nodes_count));\n   FOR_EACH_VEC_SAFE_ELT (get_loops (), i, loop)\n     {\n       if (loop_outer (loop) != NULL)\n@@ -217,13 +222,9 @@ static void\n finish_loop_tree_nodes (void)\n {\n   unsigned int i;\n-  loop_p loop;\n \n-  if (current_loops == NULL)\n-    finish_loop_tree_node (&ira_loop_nodes[0]);\n-  else\n-    FOR_EACH_VEC_SAFE_ELT (get_loops (), i, loop)\n-      finish_loop_tree_node (&ira_loop_nodes[i]);\n+  for (i = 0; i < ira_loop_nodes_count; i++)\n+    finish_loop_tree_node (&ira_loop_nodes[i]);\n   ira_free (ira_loop_nodes);\n   for (i = 0; i < (unsigned int) last_basic_block_before_change; i++)\n     {"}]}