{"sha": "4fa5dc951e9b22b61da8a4a5e0c1731d8b12a763", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6NGZhNWRjOTUxZTliMjJiNjFkYThhNGE1ZTBjMTczMWQ4YjEyYTc2Mw==", "commit": {"author": {"name": "Richard Biener", "email": "rguenther@suse.de", "date": "2020-10-21T07:45:50Z"}, "committer": {"name": "Richard Biener", "email": "rguenther@suse.de", "date": "2020-10-21T08:45:08Z"}, "message": "Separate new_edges compute in copy_bbs\n\nThis separates out a loop finding new_edges from edges in copy_bbs,\nmaking its complexity cheaper overall from total number of succs in\ncopied bbs times num_edges to num_edges times the complexity of\nfind_edge.\n\n2020-10-21  Richard Biener  <rguenther@suse.de>\n\n\t* cfghooks.c (copy_bbs): Split out loop computing new_edges.", "tree": {"sha": "2f11523b9a4e0072f51fe45598c876b6df52ab88", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/2f11523b9a4e0072f51fe45598c876b6df52ab88"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/4fa5dc951e9b22b61da8a4a5e0c1731d8b12a763", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/4fa5dc951e9b22b61da8a4a5e0c1731d8b12a763", "html_url": "https://github.com/Rust-GCC/gccrs/commit/4fa5dc951e9b22b61da8a4a5e0c1731d8b12a763", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/4fa5dc951e9b22b61da8a4a5e0c1731d8b12a763/comments", "author": {"login": "rguenth", "id": 2046526, "node_id": "MDQ6VXNlcjIwNDY1MjY=", "avatar_url": "https://avatars.githubusercontent.com/u/2046526?v=4", "gravatar_id": "", "url": "https://api.github.com/users/rguenth", "html_url": "https://github.com/rguenth", "followers_url": "https://api.github.com/users/rguenth/followers", "following_url": "https://api.github.com/users/rguenth/following{/other_user}", "gists_url": "https://api.github.com/users/rguenth/gists{/gist_id}", "starred_url": "https://api.github.com/users/rguenth/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/rguenth/subscriptions", "organizations_url": "https://api.github.com/users/rguenth/orgs", "repos_url": "https://api.github.com/users/rguenth/repos", "events_url": "https://api.github.com/users/rguenth/events{/privacy}", "received_events_url": "https://api.github.com/users/rguenth/received_events", "type": "User", "site_admin": false}, "committer": {"login": "rguenth", "id": 2046526, "node_id": "MDQ6VXNlcjIwNDY1MjY=", "avatar_url": "https://avatars.githubusercontent.com/u/2046526?v=4", "gravatar_id": "", "url": "https://api.github.com/users/rguenth", "html_url": "https://github.com/rguenth", "followers_url": "https://api.github.com/users/rguenth/followers", "following_url": "https://api.github.com/users/rguenth/following{/other_user}", "gists_url": "https://api.github.com/users/rguenth/gists{/gist_id}", "starred_url": "https://api.github.com/users/rguenth/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/rguenth/subscriptions", "organizations_url": "https://api.github.com/users/rguenth/orgs", "repos_url": "https://api.github.com/users/rguenth/repos", "events_url": "https://api.github.com/users/rguenth/events{/privacy}", "received_events_url": "https://api.github.com/users/rguenth/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "878315ae489ebf92e97470d7019da91f1c57436d", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/878315ae489ebf92e97470d7019da91f1c57436d", "html_url": "https://github.com/Rust-GCC/gccrs/commit/878315ae489ebf92e97470d7019da91f1c57436d"}], "stats": {"total": 21, "additions": 15, "deletions": 6}, "files": [{"sha": "14c006df6e1dbd41356874adae17b91eabaa5767", "filename": "gcc/cfghooks.c", "status": "modified", "additions": 15, "deletions": 6, "changes": 21, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/4fa5dc951e9b22b61da8a4a5e0c1731d8b12a763/gcc%2Fcfghooks.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/4fa5dc951e9b22b61da8a4a5e0c1731d8b12a763/gcc%2Fcfghooks.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fcfghooks.c?ref=4fa5dc951e9b22b61da8a4a5e0c1731d8b12a763", "patch": "@@ -1391,8 +1391,6 @@ copy_bbs (basic_block *bbs, unsigned n, basic_block *new_bbs,\n     }\n \n   /* Redirect edges.  */\n-  for (j = 0; j < num_edges; j++)\n-    new_edges[j] = NULL;\n   for (i = 0; i < n; i++)\n     {\n       edge_iterator ei;\n@@ -1401,15 +1399,26 @@ copy_bbs (basic_block *bbs, unsigned n, basic_block *new_bbs,\n \n       FOR_EACH_EDGE (e, ei, new_bb->succs)\n \t{\n-\t  for (j = 0; j < num_edges; j++)\n-\t    if (edges[j] && edges[j]->src == bb && edges[j]->dest == e->dest)\n-\t      new_edges[j] = e;\n-\n \t  if (!(e->dest->flags & BB_DUPLICATED))\n \t    continue;\n \t  redirect_edge_and_branch_force (e, get_bb_copy (e->dest));\n \t}\n     }\n+  for (j = 0; j < num_edges; j++)\n+    {\n+      if (!edges[j])\n+\tnew_edges[j] = NULL;\n+      else\n+\t{\n+\t  basic_block src = edges[j]->src;\n+\t  basic_block dest = edges[j]->dest;\n+\t  if (src->flags & BB_DUPLICATED)\n+\t    src = get_bb_copy (src);\n+\t  if (dest->flags & BB_DUPLICATED)\n+\t    dest = get_bb_copy (dest);\n+\t  new_edges[j] = find_edge (src, dest);\n+\t}\n+    }\n \n   /* Clear information about duplicates.  */\n   for (i = 0; i < n; i++)"}]}