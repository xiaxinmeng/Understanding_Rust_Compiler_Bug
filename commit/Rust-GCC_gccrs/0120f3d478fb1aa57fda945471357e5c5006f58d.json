{"sha": "0120f3d478fb1aa57fda945471357e5c5006f58d", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6MDEyMGYzZDQ3OGZiMWFhNTdmZGE5NDU0NzEzNTdlNWM1MDA2ZjU4ZA==", "commit": {"author": {"name": "Daiki Ueno", "email": "ueno@unixuser.org", "date": "2003-01-31T22:48:27Z"}, "committer": {"name": "Tom Tromey", "email": "tromey@gcc.gnu.org", "date": "2003-01-31T22:48:27Z"}, "message": "jartool.c (extract_jar): Don't lseek to skip extra fields.\n\n2003-01-31  Daiki Ueno  <ueno@unixuser.org>\n\n\t* jartool.c (extract_jar): Don't lseek to skip extra fields.\n\t(consume): If the stream is seekable, do lseek.\n\nFrom-SVN: r62208", "tree": {"sha": "3c4eb60ed277f4b006a285bb92ce4e79504a4b1a", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/3c4eb60ed277f4b006a285bb92ce4e79504a4b1a"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/0120f3d478fb1aa57fda945471357e5c5006f58d", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/0120f3d478fb1aa57fda945471357e5c5006f58d", "html_url": "https://github.com/Rust-GCC/gccrs/commit/0120f3d478fb1aa57fda945471357e5c5006f58d", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/0120f3d478fb1aa57fda945471357e5c5006f58d/comments", "author": {"login": "ueno", "id": 47549, "node_id": "MDQ6VXNlcjQ3NTQ5", "avatar_url": "https://avatars.githubusercontent.com/u/47549?v=4", "gravatar_id": "", "url": "https://api.github.com/users/ueno", "html_url": "https://github.com/ueno", "followers_url": "https://api.github.com/users/ueno/followers", "following_url": "https://api.github.com/users/ueno/following{/other_user}", "gists_url": "https://api.github.com/users/ueno/gists{/gist_id}", "starred_url": "https://api.github.com/users/ueno/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/ueno/subscriptions", "organizations_url": "https://api.github.com/users/ueno/orgs", "repos_url": "https://api.github.com/users/ueno/repos", "events_url": "https://api.github.com/users/ueno/events{/privacy}", "received_events_url": "https://api.github.com/users/ueno/received_events", "type": "User", "site_admin": false}, "committer": null, "parents": [{"sha": "7c712dcc2b30ee6466a89ba586c9e00c4f378794", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/7c712dcc2b30ee6466a89ba586c9e00c4f378794", "html_url": "https://github.com/Rust-GCC/gccrs/commit/7c712dcc2b30ee6466a89ba586c9e00c4f378794"}], "stats": {"total": 21, "additions": 14, "deletions": 7}, "files": [{"sha": "8cd13466b639bd407b7ccee80d3d926936b54bca", "filename": "fastjar/ChangeLog", "status": "modified", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/0120f3d478fb1aa57fda945471357e5c5006f58d/fastjar%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/0120f3d478fb1aa57fda945471357e5c5006f58d/fastjar%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/fastjar%2FChangeLog?ref=0120f3d478fb1aa57fda945471357e5c5006f58d", "patch": "@@ -1,3 +1,8 @@\n+2003-01-31  Daiki Ueno  <ueno@unixuser.org>\n+\n+\t* jartool.c (extract_jar): Don't lseek to skip extra fields.\n+\t(consume): If the stream is seekable, do lseek.\n+\n 2003-01-28  Ranjit Mathew  <rmathew@hotmail.com>\n \n \t* jargrep.c: Include xregex.h from libiberty instead of"}, {"sha": "aacf765f21d69e5f3e75e6132012d290a67d53e6", "filename": "fastjar/jartool.c", "status": "modified", "additions": 9, "deletions": 7, "changes": 16, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/0120f3d478fb1aa57fda945471357e5c5006f58d/fastjar%2Fjartool.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/0120f3d478fb1aa57fda945471357e5c5006f58d/fastjar%2Fjartool.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/fastjar%2Fjartool.c?ref=0120f3d478fb1aa57fda945471357e5c5006f58d", "patch": "@@ -1465,9 +1465,6 @@ int extract_jar(int fd, char **files, int file_num){\n     }\n \n     if(method == 8 || flags & 0x0008){\n-      if(seekable)\n-        lseek(fd, eflen, SEEK_CUR);\n-      else\n         consume(&pbf, eflen);\n       \n       inflate_file(&pbf, f_fd, &ze);\n@@ -1502,9 +1499,6 @@ int extract_jar(int fd, char **files, int file_num){\n #endif\n       }\n \n-      if(seekable)\n-        lseek(fd, eflen, SEEK_CUR);\n-      else\n         consume(&pbf, eflen);\n     }\n \n@@ -1849,6 +1843,14 @@ int consume(pb_file *pbf, int amt){\n   printf(\"Consuming %d bytes\\n\", amt);\n #endif\n \n+  if (seekable){\n+    if (amt <= (int)pbf->buff_amt)\n+      pb_read(pbf, buff, amt);\n+    else {\n+      lseek(pbf->fd, amt - pbf->buff_amt, SEEK_CUR);\n+      pb_read(pbf, buff, pbf->buff_amt); /* clear pbf */\n+    }\n+  } else\n   while(tc < amt){\n     rdamt = pb_read(pbf, buff, ((amt - tc) < RDSZ ? (amt - tc) : RDSZ));\n #ifdef DEBUG\n@@ -1858,7 +1860,7 @@ int consume(pb_file *pbf, int amt){\n   }\n \n #ifdef DEBUG\n-  printf(\"%d bytes consumed\\n\", tc);\n+  printf(\"%d bytes consumed\\n\", amt);\n #endif\n \n   return 0;"}]}