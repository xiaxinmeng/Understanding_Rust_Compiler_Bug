{"sha": "995a740cb01a0671a2082cb1ae13d0c356d4b568", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6OTk1YTc0MGNiMDFhMDY3MWEyMDgyY2IxYWUxM2QwYzM1NmQ0YjU2OA==", "commit": {"author": {"name": "Jonathan Wakely", "email": "jwakely@redhat.com", "date": "2021-03-12T11:47:20Z"}, "committer": {"name": "Jonathan Wakely", "email": "jwakely@redhat.com", "date": "2021-03-16T12:25:28Z"}, "message": "libstdc++: Remove symbols for new std::call_once implementation [PR 99341]\n\nThis removes the new symbols added for the new futex-based\nstd::call_once implementation. These symbols were new on trunk, so not\nin any released version. However, they are already present in some\nbeta distro releases (Fedora Linux 34) and in Fedora Linux rawhide. This\nchange can be locally reverted by distros that need to keep the symbols\npresent until affected packages have been rebuilt.\n\nlibstdc++-v3/ChangeLog:\n\n\tPR libstdc++/99341\n\t* config/abi/post/aarch64-linux-gnu/baseline_symbols.txt: Remove\n\tstd::once_flag symbols.\n\t* config/abi/post/ia64-linux-gnu/baseline_symbols.txt: Likewise.\n\t* config/abi/post/m68k-linux-gnu/baseline_symbols.txt: Likewise.\n\t* config/abi/post/riscv64-linux-gnu/baseline_symbols.txt:\n\tLikewise.\n\t* config/abi/pre/gnu.ver: Likewise.\n\t* src/c++11/mutex.cc [_GLIBCXX_HAVE_LINUX_FUTEX]\n\t(struct __once_flag_compat): Remove.\n\t(_ZNSt9once_flag11_M_activateEv): Remove.\n\t(_ZNSt9once_flag9_M_finishEb): Remove.", "tree": {"sha": "55fecfcb90d647cf56780c1b02b8c2e93d175272", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/55fecfcb90d647cf56780c1b02b8c2e93d175272"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/995a740cb01a0671a2082cb1ae13d0c356d4b568", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/995a740cb01a0671a2082cb1ae13d0c356d4b568", "html_url": "https://github.com/Rust-GCC/gccrs/commit/995a740cb01a0671a2082cb1ae13d0c356d4b568", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/995a740cb01a0671a2082cb1ae13d0c356d4b568/comments", "author": {"login": "jwakely", "id": 1254480, "node_id": "MDQ6VXNlcjEyNTQ0ODA=", "avatar_url": "https://avatars.githubusercontent.com/u/1254480?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jwakely", "html_url": "https://github.com/jwakely", "followers_url": "https://api.github.com/users/jwakely/followers", "following_url": "https://api.github.com/users/jwakely/following{/other_user}", "gists_url": "https://api.github.com/users/jwakely/gists{/gist_id}", "starred_url": "https://api.github.com/users/jwakely/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jwakely/subscriptions", "organizations_url": "https://api.github.com/users/jwakely/orgs", "repos_url": "https://api.github.com/users/jwakely/repos", "events_url": "https://api.github.com/users/jwakely/events{/privacy}", "received_events_url": "https://api.github.com/users/jwakely/received_events", "type": "User", "site_admin": false}, "committer": {"login": "jwakely", "id": 1254480, "node_id": "MDQ6VXNlcjEyNTQ0ODA=", "avatar_url": "https://avatars.githubusercontent.com/u/1254480?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jwakely", "html_url": "https://github.com/jwakely", "followers_url": "https://api.github.com/users/jwakely/followers", "following_url": "https://api.github.com/users/jwakely/following{/other_user}", "gists_url": "https://api.github.com/users/jwakely/gists{/gist_id}", "starred_url": "https://api.github.com/users/jwakely/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jwakely/subscriptions", "organizations_url": "https://api.github.com/users/jwakely/orgs", "repos_url": "https://api.github.com/users/jwakely/repos", "events_url": "https://api.github.com/users/jwakely/events{/privacy}", "received_events_url": "https://api.github.com/users/jwakely/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "6ee24638ed0ad51e568c799bacf149ba9bd7628b", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/6ee24638ed0ad51e568c799bacf149ba9bd7628b", "html_url": "https://github.com/Rust-GCC/gccrs/commit/6ee24638ed0ad51e568c799bacf149ba9bd7628b"}], "stats": {"total": 97, "additions": 0, "deletions": 97}, "files": [{"sha": "898c8e1e895809c929a028520528699eee78df60", "filename": "libstdc++-v3/config/abi/post/aarch64-linux-gnu/baseline_symbols.txt", "status": "modified", "additions": 0, "deletions": 2, "changes": 2, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/995a740cb01a0671a2082cb1ae13d0c356d4b568/libstdc%2B%2B-v3%2Fconfig%2Fabi%2Fpost%2Faarch64-linux-gnu%2Fbaseline_symbols.txt", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/995a740cb01a0671a2082cb1ae13d0c356d4b568/libstdc%2B%2B-v3%2Fconfig%2Fabi%2Fpost%2Faarch64-linux-gnu%2Fbaseline_symbols.txt", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libstdc%2B%2B-v3%2Fconfig%2Fabi%2Fpost%2Faarch64-linux-gnu%2Fbaseline_symbols.txt?ref=995a740cb01a0671a2082cb1ae13d0c356d4b568", "patch": "@@ -4086,8 +4086,6 @@ FUNC:_ZNSt9money_putIwSt19ostreambuf_iteratorIwSt11char_traitsIwEEEC2Em@@GLIBCXX\n FUNC:_ZNSt9money_putIwSt19ostreambuf_iteratorIwSt11char_traitsIwEEED0Ev@@GLIBCXX_3.4\n FUNC:_ZNSt9money_putIwSt19ostreambuf_iteratorIwSt11char_traitsIwEEED1Ev@@GLIBCXX_3.4\n FUNC:_ZNSt9money_putIwSt19ostreambuf_iteratorIwSt11char_traitsIwEEED2Ev@@GLIBCXX_3.4\n-FUNC:_ZNSt9once_flag11_M_activateEv@@GLIBCXX_3.4.29\n-FUNC:_ZNSt9once_flag9_M_finishEb@@GLIBCXX_3.4.29\n FUNC:_ZNSt9strstream3strEv@@GLIBCXX_3.4\n FUNC:_ZNSt9strstream6freezeEb@@GLIBCXX_3.4\n FUNC:_ZNSt9strstreamC1EPciSt13_Ios_Openmode@@GLIBCXX_3.4"}, {"sha": "92288ccb8a62819568a05856b28f96a727460286", "filename": "libstdc++-v3/config/abi/post/ia64-linux-gnu/baseline_symbols.txt", "status": "modified", "additions": 0, "deletions": 2, "changes": 2, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/995a740cb01a0671a2082cb1ae13d0c356d4b568/libstdc%2B%2B-v3%2Fconfig%2Fabi%2Fpost%2Fia64-linux-gnu%2Fbaseline_symbols.txt", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/995a740cb01a0671a2082cb1ae13d0c356d4b568/libstdc%2B%2B-v3%2Fconfig%2Fabi%2Fpost%2Fia64-linux-gnu%2Fbaseline_symbols.txt", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libstdc%2B%2B-v3%2Fconfig%2Fabi%2Fpost%2Fia64-linux-gnu%2Fbaseline_symbols.txt?ref=995a740cb01a0671a2082cb1ae13d0c356d4b568", "patch": "@@ -4086,8 +4086,6 @@ FUNC:_ZNSt9money_putIwSt19ostreambuf_iteratorIwSt11char_traitsIwEEEC2Em@@GLIBCXX\n FUNC:_ZNSt9money_putIwSt19ostreambuf_iteratorIwSt11char_traitsIwEEED0Ev@@GLIBCXX_3.4\n FUNC:_ZNSt9money_putIwSt19ostreambuf_iteratorIwSt11char_traitsIwEEED1Ev@@GLIBCXX_3.4\n FUNC:_ZNSt9money_putIwSt19ostreambuf_iteratorIwSt11char_traitsIwEEED2Ev@@GLIBCXX_3.4\n-FUNC:_ZNSt9once_flag11_M_activateEv@@GLIBCXX_3.4.29\n-FUNC:_ZNSt9once_flag9_M_finishEb@@GLIBCXX_3.4.29\n FUNC:_ZNSt9strstream3strEv@@GLIBCXX_3.4\n FUNC:_ZNSt9strstream6freezeEb@@GLIBCXX_3.4\n FUNC:_ZNSt9strstreamC1EPciSt13_Ios_Openmode@@GLIBCXX_3.4"}, {"sha": "af5dc020e00a8ef7014c76fe9a420035652fde21", "filename": "libstdc++-v3/config/abi/post/m68k-linux-gnu/baseline_symbols.txt", "status": "modified", "additions": 0, "deletions": 2, "changes": 2, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/995a740cb01a0671a2082cb1ae13d0c356d4b568/libstdc%2B%2B-v3%2Fconfig%2Fabi%2Fpost%2Fm68k-linux-gnu%2Fbaseline_symbols.txt", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/995a740cb01a0671a2082cb1ae13d0c356d4b568/libstdc%2B%2B-v3%2Fconfig%2Fabi%2Fpost%2Fm68k-linux-gnu%2Fbaseline_symbols.txt", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libstdc%2B%2B-v3%2Fconfig%2Fabi%2Fpost%2Fm68k-linux-gnu%2Fbaseline_symbols.txt?ref=995a740cb01a0671a2082cb1ae13d0c356d4b568", "patch": "@@ -4086,8 +4086,6 @@ FUNC:_ZNSt9money_putIwSt19ostreambuf_iteratorIwSt11char_traitsIwEEEC2Ej@@GLIBCXX\n FUNC:_ZNSt9money_putIwSt19ostreambuf_iteratorIwSt11char_traitsIwEEED0Ev@@GLIBCXX_3.4\n FUNC:_ZNSt9money_putIwSt19ostreambuf_iteratorIwSt11char_traitsIwEEED1Ev@@GLIBCXX_3.4\n FUNC:_ZNSt9money_putIwSt19ostreambuf_iteratorIwSt11char_traitsIwEEED2Ev@@GLIBCXX_3.4\n-FUNC:_ZNSt9once_flag11_M_activateEv@@GLIBCXX_3.4.29\n-FUNC:_ZNSt9once_flag9_M_finishEb@@GLIBCXX_3.4.29\n FUNC:_ZNSt9strstream3strEv@@GLIBCXX_3.4\n FUNC:_ZNSt9strstream6freezeEb@@GLIBCXX_3.4\n FUNC:_ZNSt9strstreamC1EPciSt13_Ios_Openmode@@GLIBCXX_3.4"}, {"sha": "6e5da521255f80e9c1f20aaea28362ae900d03c5", "filename": "libstdc++-v3/config/abi/post/riscv64-linux-gnu/baseline_symbols.txt", "status": "modified", "additions": 0, "deletions": 2, "changes": 2, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/995a740cb01a0671a2082cb1ae13d0c356d4b568/libstdc%2B%2B-v3%2Fconfig%2Fabi%2Fpost%2Friscv64-linux-gnu%2Fbaseline_symbols.txt", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/995a740cb01a0671a2082cb1ae13d0c356d4b568/libstdc%2B%2B-v3%2Fconfig%2Fabi%2Fpost%2Friscv64-linux-gnu%2Fbaseline_symbols.txt", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libstdc%2B%2B-v3%2Fconfig%2Fabi%2Fpost%2Friscv64-linux-gnu%2Fbaseline_symbols.txt?ref=995a740cb01a0671a2082cb1ae13d0c356d4b568", "patch": "@@ -4086,8 +4086,6 @@ FUNC:_ZNSt9money_putIwSt19ostreambuf_iteratorIwSt11char_traitsIwEEEC2Em@@GLIBCXX\n FUNC:_ZNSt9money_putIwSt19ostreambuf_iteratorIwSt11char_traitsIwEEED0Ev@@GLIBCXX_3.4\n FUNC:_ZNSt9money_putIwSt19ostreambuf_iteratorIwSt11char_traitsIwEEED1Ev@@GLIBCXX_3.4\n FUNC:_ZNSt9money_putIwSt19ostreambuf_iteratorIwSt11char_traitsIwEEED2Ev@@GLIBCXX_3.4\n-FUNC:_ZNSt9once_flag11_M_activateEv@@GLIBCXX_3.4.29\n-FUNC:_ZNSt9once_flag9_M_finishEb@@GLIBCXX_3.4.29\n FUNC:_ZNSt9strstream3strEv@@GLIBCXX_3.4\n FUNC:_ZNSt9strstream6freezeEb@@GLIBCXX_3.4\n FUNC:_ZNSt9strstreamC1EPciSt13_Ios_Openmode@@GLIBCXX_3.4"}, {"sha": "5323c7f06043722ed04da133153dec8161900472", "filename": "libstdc++-v3/config/abi/pre/gnu.ver", "status": "modified", "additions": 0, "deletions": 5, "changes": 5, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/995a740cb01a0671a2082cb1ae13d0c356d4b568/libstdc%2B%2B-v3%2Fconfig%2Fabi%2Fpre%2Fgnu.ver", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/995a740cb01a0671a2082cb1ae13d0c356d4b568/libstdc%2B%2B-v3%2Fconfig%2Fabi%2Fpre%2Fgnu.ver", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libstdc%2B%2B-v3%2Fconfig%2Fabi%2Fpre%2Fgnu.ver?ref=995a740cb01a0671a2082cb1ae13d0c356d4b568", "patch": "@@ -2388,11 +2388,6 @@ GLIBCXX_3.4.29 {\n     _ZNKRSt7__cxx1118basic_stringstreamI[cw]St11char_traitsI[cw]ESaI[cw]EE3strEv;\n     _ZNSt7__cxx1118basic_stringstreamI[cw]St11char_traitsI[cw]ESaI[cw]EE3strEONS_12basic_stringI[cw]S2_S3_EE;\n \n-    # std::once_flag::_M_activate()\n-    _ZNSt9once_flag11_M_activateEv;\n-    # std::once_flag::_M_finish(bool)\n-    _ZNSt9once_flag9_M_finishEb;\n-\n     # std::to_chars(char*, char*, [float|double|long double])\n     _ZSt8to_charsPcS_[def];\n     # std::to_chars(char*, char*, [float|double|long double], chars_format)"}, {"sha": "646fd17ec45c8e1daf1b1a6fde41a246745485b7", "filename": "libstdc++-v3/src/c++11/mutex.cc", "status": "modified", "additions": 0, "deletions": 84, "changes": 84, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/995a740cb01a0671a2082cb1ae13d0c356d4b568/libstdc%2B%2B-v3%2Fsrc%2Fc%2B%2B11%2Fmutex.cc", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/995a740cb01a0671a2082cb1ae13d0c356d4b568/libstdc%2B%2B-v3%2Fsrc%2Fc%2B%2B11%2Fmutex.cc", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libstdc%2B%2B-v3%2Fsrc%2Fc%2B%2B11%2Fmutex.cc?ref=995a740cb01a0671a2082cb1ae13d0c356d4b568", "patch": "@@ -26,90 +26,6 @@\n \n #ifdef _GLIBCXX_HAS_GTHREADS\n \n-#if defined _GLIBCXX_SHARED && ! _GLIBCXX_INLINE_VERSION\n-\n-#ifdef _GLIBCXX_HAVE_LINUX_FUTEX\n-# include <syscall.h>\n-# include <unistd.h>\n-# include <limits.h>\n-\n-namespace std _GLIBCXX_VISIBILITY(default)\n-{\n-_GLIBCXX_BEGIN_NAMESPACE_VERSION\n-\n-struct __once_flag_compat\n-{\n-  enum _Bits : int { _Init = 0, _Active = 1, _Done = 2 };\n-  int _M_once = 0;\n-  bool _M_activate();\n-  void _M_finish(bool returning) noexcept;\n-};\n-\n-bool\n-__once_flag_compat::_M_activate()\n-{\n-  if (__gnu_cxx::__is_single_threaded())\n-    {\n-      if (_M_once == _Bits::_Done)\n-\treturn false;\n-      _M_once = _Bits::_Active;\n-      return true;\n-    }\n-\n-  while (true)\n-    {\n-      int expected = _Bits::_Init;\n-      constexpr int active = _Bits::_Active;\n-      if (__atomic_compare_exchange_n(&_M_once, &expected, active, false,\n-\t\t\t\t\t    __ATOMIC_ACQ_REL,\n-\t\t\t\t\t    __ATOMIC_ACQUIRE))\n-\t{\n-\t  // This thread is now doing an active execution.\n-\t  return true;\n-\t}\n-\n-      if (expected == _Bits::_Done)\n-\treturn false; // A returning execution happened, this is passive.\n-\n-      // Otherwise, an active execution is happening. Wait for it to finish.\n-      constexpr int futex_wait = 128; // FUTEX_WAIT_PRIVATE\n-      syscall (SYS_futex, &_M_once, futex_wait, expected, 0);\n-    }\n-}\n-\n-void\n-std::__once_flag_compat::_M_finish(bool returning) noexcept\n-{\n-  const int newval = returning ? _Bits::_Done : _Bits::_Init;\n-  if (__gnu_cxx::__is_single_threaded())\n-    {\n-      __glibcxx_assert(_M_once == _Bits::_Active);\n-      _M_once = newval;\n-    }\n-  else\n-    {\n-      int prev [[maybe_unused]]\n-\t= __atomic_exchange_n(&_M_once, newval, __ATOMIC_RELEASE);\n-      __glibcxx_assert(prev & _Bits::_Active);\n-      // Wake any other threads waiting for this execution to finish.\n-      constexpr int futex_wake = 129; // FUTEX_WAKE_PRIVATE\n-      syscall (SYS_futex, &_M_once, futex_wake, INT_MAX);\n-    }\n-}\n-\n-#pragma GCC diagnostic push\n-#pragma GCC diagnostic ignored \"-Wattribute-alias\"\n-extern \"C\" bool _ZNSt9once_flag11_M_activateEv()\n-  __attribute__((alias (\"_ZNSt18__once_flag_compat11_M_activateEv\")));\n-extern \"C\" void _ZNSt9once_flag9_M_finishEb() noexcept\n-  __attribute__((alias (\"_ZNSt18__once_flag_compat9_M_finishEb\")));\n-#pragma GCC diagnostic pop\n-\n-_GLIBCXX_END_NAMESPACE_VERSION\n-} // namespace std\n-#endif // FUTEX\n-#endif // ONCE_FLAG_COMPAT && SHARED && ! INLINE_VERSION\n-\n namespace std _GLIBCXX_VISIBILITY(default)\n {\n _GLIBCXX_BEGIN_NAMESPACE_VERSION"}]}