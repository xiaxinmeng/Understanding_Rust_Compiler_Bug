{"sha": "9c5719f69cf99842be94eb18315a802cbb7b246e", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6OWM1NzE5ZjY5Y2Y5OTg0MmJlOTRlYjE4MzE1YTgwMmNiYjdiMjQ2ZQ==", "commit": {"author": {"name": "Arnaud Charlet", "email": "charlet@gcc.gnu.org", "date": "2017-09-08T13:44:39Z"}, "committer": {"name": "Arnaud Charlet", "email": "charlet@gcc.gnu.org", "date": "2017-09-08T13:44:39Z"}, "message": "[multiple changes]\n\n2017-09-08  Eric Botcazou  <ebotcazou@adacore.com>\n\n\t* sem_util.adb (NCT_Tables_In_Use): Move to library level from...\n\t(New_Copy_Tree): ...there.  Reset the hash tables only if they\n\twere used in the previous invocation.\n\t* s-htable.adb: Fix typo.\n\n2017-09-08  Bob Duff  <duff@adacore.com>\n\n\t* a-ssicst.adb (Open): Set File.Last_Op to the appropriate value.\n\n2017-09-08  Arnaud Charlet  <charlet@adacore.com>\n\n\t* sem_aggr.adb: minor style fix.\n\n2017-09-08  Bob Duff  <duff@adacore.com>\n\n\t* sprint.adb (Write_Corresponding_Source): Ignore if there is\n\tno current source file.\n\t(Write_Name_With_Col_Check, Write_Name_With_Col_Check_Sloc):\n\tPrint something helpful in case N is invalid.\n\t* sprint.ads: Minor comment fix.\n\nFrom-SVN: r251897", "tree": {"sha": "2e7704d122d153fb2bf24e6b84a5e2462c9ed3e4", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/2e7704d122d153fb2bf24e6b84a5e2462c9ed3e4"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/9c5719f69cf99842be94eb18315a802cbb7b246e", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/9c5719f69cf99842be94eb18315a802cbb7b246e", "html_url": "https://github.com/Rust-GCC/gccrs/commit/9c5719f69cf99842be94eb18315a802cbb7b246e", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/9c5719f69cf99842be94eb18315a802cbb7b246e/comments", "author": null, "committer": null, "parents": [{"sha": "410abeeb0dde4aa71e47a507aa517ff4a4dbb6a1", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/410abeeb0dde4aa71e47a507aa517ff4a4dbb6a1", "html_url": "https://github.com/Rust-GCC/gccrs/commit/410abeeb0dde4aa71e47a507aa517ff4a4dbb6a1"}], "stats": {"total": 86, "additions": 68, "deletions": 18}, "files": [{"sha": "566b7a4fd6b15bd0b85fe83dc28e8aafe4d3e09b", "filename": "gcc/ada/ChangeLog", "status": "modified", "additions": 23, "deletions": 0, "changes": 23, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/9c5719f69cf99842be94eb18315a802cbb7b246e/gcc%2Fada%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/9c5719f69cf99842be94eb18315a802cbb7b246e/gcc%2Fada%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fada%2FChangeLog?ref=9c5719f69cf99842be94eb18315a802cbb7b246e", "patch": "@@ -1,3 +1,26 @@\n+2017-09-08  Eric Botcazou  <ebotcazou@adacore.com>\n+\n+\t* sem_util.adb (NCT_Tables_In_Use): Move to library level from...\n+\t(New_Copy_Tree): ...there.  Reset the hash tables only if they\n+\twere used in the previous invocation.\n+\t* s-htable.adb: Fix typo.\n+\n+2017-09-08  Bob Duff  <duff@adacore.com>\n+\n+\t* a-ssicst.adb (Open): Set File.Last_Op to the appropriate value.\n+\n+2017-09-08  Arnaud Charlet  <charlet@adacore.com>\n+\n+\t* sem_aggr.adb: minor style fix.\n+\n+2017-09-08  Bob Duff  <duff@adacore.com>\n+\n+\t* sprint.adb (Write_Corresponding_Source): Ignore if there is\n+\tno current source file.\n+\t(Write_Name_With_Col_Check, Write_Name_With_Col_Check_Sloc):\n+\tPrint something helpful in case N is invalid.\n+\t* sprint.ads: Minor comment fix.\n+\n 2017-09-08  Eric Botcazou  <ebotcazou@adacore.com>\n \n \t* exp_aggr.adb: (Aggr_Assignment_OK_For_Backend): Add early return for"}, {"sha": "1e5b394bcb582434728e42894ed9450033ca7927", "filename": "gcc/ada/a-ssicst.adb", "status": "modified", "additions": 4, "deletions": 1, "changes": 5, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/9c5719f69cf99842be94eb18315a802cbb7b246e/gcc%2Fada%2Fa-ssicst.adb", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/9c5719f69cf99842be94eb18315a802cbb7b246e/gcc%2Fada%2Fa-ssicst.adb", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fada%2Fa-ssicst.adb?ref=9c5719f69cf99842be94eb18315a802cbb7b246e", "patch": "@@ -6,7 +6,7 @@\n --                                                                          --\n --                                 B o d y                                  --\n --                                                                          --\n---          Copyright (C) 1992-2009, Free Software Foundation, Inc.         --\n+--          Copyright (C) 1992-2017, Free Software Foundation, Inc.         --\n --                                                                          --\n -- GNAT is free software;  you can  redistribute it  and/or modify it under --\n -- terms of the  GNU General Public License as published  by the Free Soft- --\n@@ -79,6 +79,9 @@ package body Ada.Streams.Stream_IO.C_Streams is\n                 Creat     => False,\n                 Text      => False,\n                 C_Stream  => C_Stream);\n+\n+      File.Last_Op := (if Mode = Out_File then Op_Write else Op_Read);\n+      --  See comment in Ada.Streams.Stream_IO.Open for the reason\n    end Open;\n \n end Ada.Streams.Stream_IO.C_Streams;"}, {"sha": "f72b64923e417ce23feb86c9ce40ad8ad5b4b0e9", "filename": "gcc/ada/s-htable.adb", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/9c5719f69cf99842be94eb18315a802cbb7b246e/gcc%2Fada%2Fs-htable.adb", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/9c5719f69cf99842be94eb18315a802cbb7b246e/gcc%2Fada%2Fs-htable.adb", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fada%2Fs-htable.adb?ref=9c5719f69cf99842be94eb18315a802cbb7b246e", "patch": "@@ -171,7 +171,7 @@ package body System.HTable is\n \n       procedure Reset is\n       begin\n-         --  Use an aggregate for efficient reasons\n+         --  Use an aggregate for efficiency reasons\n \n          Table := (others => Null_Ptr);\n       end Reset;"}, {"sha": "aa2510dd94331efc48e4b7f9b344ec3fc3792759", "filename": "gcc/ada/sem_aggr.adb", "status": "modified", "additions": 1, "deletions": 3, "changes": 4, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/9c5719f69cf99842be94eb18315a802cbb7b246e/gcc%2Fada%2Fsem_aggr.adb", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/9c5719f69cf99842be94eb18315a802cbb7b246e/gcc%2Fada%2Fsem_aggr.adb", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fada%2Fsem_aggr.adb?ref=9c5719f69cf99842be94eb18315a802cbb7b246e", "patch": "@@ -4048,9 +4048,7 @@ package body Sem_Aggr is\n             end if;\n          end Rewrite_Bound;\n \n-         ---------------------\n-         -- Local Variables --\n-         ---------------------\n+         --  Local variables\n \n          Low, High : Node_Id;\n          Disc      : Entity_Id;"}, {"sha": "228a1d54a7e7567ba143c8b040dab038cf6ec90d", "filename": "gcc/ada/sem_util.adb", "status": "modified", "additions": 13, "deletions": 9, "changes": 22, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/9c5719f69cf99842be94eb18315a802cbb7b246e/gcc%2Fada%2Fsem_util.adb", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/9c5719f69cf99842be94eb18315a802cbb7b246e/gcc%2Fada%2Fsem_util.adb", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fada%2Fsem_util.adb?ref=9c5719f69cf99842be94eb18315a802cbb7b246e", "patch": "@@ -17316,6 +17316,13 @@ package body Sem_Util is\n    function NCT_Table_Hash (Key : Node_Or_Entity_Id) return NCT_Table_Index;\n    --  Obtain the hash value of node or entity Key\n \n+   NCT_Tables_In_Use : Boolean := False;\n+   --  This flag keeps track of whether the two tables NCT_New_Entities and\n+   --  NCT_Pending_Itypes are in use. The flag is part of an optimization\n+   --  where certain operations are not performed if the tables are not in\n+   --  use. This saves up to 8% of the entire compilation time spent in the\n+   --  front end.\n+\n    --------------------\n    -- NCT_Table_Hash --\n    --------------------\n@@ -17389,13 +17396,6 @@ package body Sem_Util is\n       --  This counter keeps track of how many scoping constructs appear within\n       --  an N_Expression_With_Actions node.\n \n-      NCT_Tables_In_Use : Boolean := False;\n-      --  This flag keeps track of whether the two tables NCT_New_Entities and\n-      --  NCT_Pending_Itypes are in use. The flag is part of an optimization\n-      --  where certain operations are not performed if the tables are not in\n-      --  use. This saves up to 8% of the entire compilation time spent in the\n-      --  front end.\n-\n       procedure Add_New_Entity (Old_Id : Entity_Id; New_Id : Entity_Id);\n       pragma Inline (Add_New_Entity);\n       --  Add an entry in the NCT_New_Entities table which maps key Old_Id to\n@@ -18744,8 +18744,12 @@ package body Sem_Util is\n       --  NCT_Pending_Itypes in case a previous call to New_Copy_Tree left some\n       --  data inside.\n \n-      NCT_New_Entities.Reset;\n-      NCT_Pending_Itypes.Reset;\n+      if NCT_Tables_In_Use then\n+         NCT_Tables_In_Use := False;\n+\n+         NCT_New_Entities.Reset;\n+         NCT_Pending_Itypes.Reset;\n+      end if;\n \n       --  Populate tables NCT_New_Entities and NCT_Pending_Itypes with data\n       --  supplied by a linear entity map. The tables offer faster access to"}, {"sha": "d97a1f78dd7701eb1cef189881699964289e83fc", "filename": "gcc/ada/sprint.adb", "status": "modified", "additions": 24, "deletions": 2, "changes": 26, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/9c5719f69cf99842be94eb18315a802cbb7b246e/gcc%2Fada%2Fsprint.adb", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/9c5719f69cf99842be94eb18315a802cbb7b246e/gcc%2Fada%2Fsprint.adb", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fada%2Fsprint.adb?ref=9c5719f69cf99842be94eb18315a802cbb7b246e", "patch": "@@ -3749,9 +3749,13 @@ package body Sprint is\n       Src : Source_Buffer_Ptr;\n \n    begin\n-      --  Ignore if not in dump source text mode, or if in freeze actions\n+      --  Ignore if there is no current source file, or we're not in dump\n+      --  source text mode, or if in freeze actions.\n \n-      if Dump_Source_Text and then Freeze_Indent = 0 then\n+      if Current_Source_File /= No_Source_File\n+        and then Dump_Source_Text\n+        and then Freeze_Indent = 0\n+      then\n \n          --  Ignore null string\n \n@@ -4504,6 +4508,15 @@ package body Sprint is\n       L : Natural;\n \n    begin\n+      --  Avoid crashing on invalid Name_Ids\n+\n+      if not Is_Valid_Name (N) then\n+         Write_Str (\"<invalid name \");\n+         Write_Int (Int (N));\n+         Write_Str (\">\");\n+         return;\n+      end if;\n+\n       Get_Name_String (N);\n \n       --  Deal with -gnatdI which replaces any sequence Cnnnb where C is an\n@@ -4552,6 +4565,15 @@ package body Sprint is\n \n    procedure Write_Name_With_Col_Check_Sloc (N : Name_Id) is\n    begin\n+      --  Avoid crashing on invalid Name_Ids\n+\n+      if not Is_Valid_Name (N) then\n+         Write_Str (\"<invalid name \");\n+         Write_Int (Int (N));\n+         Write_Str (\">\");\n+         return;\n+      end if;\n+\n       Get_Name_String (N);\n       Write_Str_With_Col_Check_Sloc (Name_Buffer (1 .. Name_Len));\n    end Write_Name_With_Col_Check_Sloc;"}, {"sha": "275960e23bbb2509476a64ba6483b720ffbef804", "filename": "gcc/ada/sprint.ads", "status": "modified", "additions": 2, "deletions": 2, "changes": 4, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/9c5719f69cf99842be94eb18315a802cbb7b246e/gcc%2Fada%2Fsprint.ads", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/9c5719f69cf99842be94eb18315a802cbb7b246e/gcc%2Fada%2Fsprint.ads", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fada%2Fsprint.ads?ref=9c5719f69cf99842be94eb18315a802cbb7b246e", "patch": "@@ -6,7 +6,7 @@\n --                                                                          --\n --                                 S p e c                                  --\n --                                                                          --\n---          Copyright (C) 1992-2013, Free Software Foundation, Inc.         --\n+--          Copyright (C) 1992-2017, Free Software Foundation, Inc.         --\n --                                                                          --\n -- GNAT is free software;  you can  redistribute it  and/or modify it under --\n -- terms of the  GNU General Public License as published  by the Free Soft- --\n@@ -42,7 +42,7 @@ package Sprint is\n    --  When the generated tree is printed, it contains constructs that are not\n    --  pure Ada. For convenience, syntactic extensions to Ada have been defined\n    --  purely for the purposes of this printout (they are not recognized by the\n-   --  parser)\n+   --  parser).\n \n    --  Could use more documentation for all of these ???\n "}]}