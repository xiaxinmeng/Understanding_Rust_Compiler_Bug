{"sha": "41521dee8edc8fcfbc8fb2d56773d85f909bf356", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6NDE1MjFkZWU4ZWRjOGZjZmJjOGZiMmQ1Njc3M2Q4NWY5MDliZjM1Ng==", "commit": {"author": {"name": "Jakub Jelinek", "email": "jakub@redhat.com", "date": "2017-11-23T20:17:29Z"}, "committer": {"name": "Jakub Jelinek", "email": "jakub@gcc.gnu.org", "date": "2017-11-23T20:17:29Z"}, "message": "c-parser.c (c_parser_omp_declare_simd): Reject declare simd in pragma_stmt context.\n\n\t* c-parser.c (c_parser_omp_declare_simd): Reject declare simd in\n\tpragma_stmt context.\n\n\t* gcc.dg/gomp/declare-simd-1.c (f9): Remove.\n\t* gcc.dg/gomp/declare-simd-5.c: New test.\n\nFrom-SVN: r255116", "tree": {"sha": "c6a3664d7f25a4d85dfa16c75e38ff5c94829781", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/c6a3664d7f25a4d85dfa16c75e38ff5c94829781"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/41521dee8edc8fcfbc8fb2d56773d85f909bf356", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/41521dee8edc8fcfbc8fb2d56773d85f909bf356", "html_url": "https://github.com/Rust-GCC/gccrs/commit/41521dee8edc8fcfbc8fb2d56773d85f909bf356", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/41521dee8edc8fcfbc8fb2d56773d85f909bf356/comments", "author": {"login": "jakubjelinek", "id": 9370665, "node_id": "MDQ6VXNlcjkzNzA2NjU=", "avatar_url": "https://avatars.githubusercontent.com/u/9370665?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jakubjelinek", "html_url": "https://github.com/jakubjelinek", "followers_url": "https://api.github.com/users/jakubjelinek/followers", "following_url": "https://api.github.com/users/jakubjelinek/following{/other_user}", "gists_url": "https://api.github.com/users/jakubjelinek/gists{/gist_id}", "starred_url": "https://api.github.com/users/jakubjelinek/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jakubjelinek/subscriptions", "organizations_url": "https://api.github.com/users/jakubjelinek/orgs", "repos_url": "https://api.github.com/users/jakubjelinek/repos", "events_url": "https://api.github.com/users/jakubjelinek/events{/privacy}", "received_events_url": "https://api.github.com/users/jakubjelinek/received_events", "type": "User", "site_admin": false}, "committer": null, "parents": [{"sha": "3b575376fbba16c3be9f607fbf53a6c841b3baae", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/3b575376fbba16c3be9f607fbf53a6c841b3baae", "html_url": "https://github.com/Rust-GCC/gccrs/commit/3b575376fbba16c3be9f607fbf53a6c841b3baae"}], "stats": {"total": 57, "additions": 44, "deletions": 13}, "files": [{"sha": "1d698508131bef58632546847b15a464105bc68a", "filename": "gcc/c/ChangeLog", "status": "modified", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/41521dee8edc8fcfbc8fb2d56773d85f909bf356/gcc%2Fc%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/41521dee8edc8fcfbc8fb2d56773d85f909bf356/gcc%2Fc%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fc%2FChangeLog?ref=41521dee8edc8fcfbc8fb2d56773d85f909bf356", "patch": "@@ -1,3 +1,8 @@\n+2017-11-23  Jakub Jelinek  <jakub@redhat.com>\n+\n+\t* c-parser.c (c_parser_omp_declare_simd): Reject declare simd in\n+\tpragma_stmt context.\n+\n 2017-11-23  Mike Stump  <mikestump@comcast.net>\n \t    Eric Botcazou  <ebotcazou@adacore.com>\n "}, {"sha": "9a6685a6744da7332942e2d99769e0d6bccc80f2", "filename": "gcc/c/c-parser.c", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/41521dee8edc8fcfbc8fb2d56773d85f909bf356/gcc%2Fc%2Fc-parser.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/41521dee8edc8fcfbc8fb2d56773d85f909bf356/gcc%2Fc%2Fc-parser.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fc%2Fc-parser.c?ref=41521dee8edc8fcfbc8fb2d56773d85f909bf356", "patch": "@@ -17486,11 +17486,11 @@ c_parser_omp_declare_simd (c_parser *parser, enum pragma_context context)\n       break;\n     case pragma_struct:\n     case pragma_param:\n+    case pragma_stmt:\n       c_parser_error (parser, \"%<#pragma omp declare simd%> must be followed by \"\n \t\t\t      \"function declaration or definition\");\n       break;\n     case pragma_compound:\n-    case pragma_stmt:\n       if (c_parser_next_token_is (parser, CPP_KEYWORD)\n \t  && c_parser_peek_token (parser)->keyword == RID_EXTENSION)\n \t{"}, {"sha": "619e9593bb3f9b1639958ce8d56dff13b65ef5f0", "filename": "gcc/testsuite/ChangeLog", "status": "modified", "additions": 3, "deletions": 0, "changes": 3, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/41521dee8edc8fcfbc8fb2d56773d85f909bf356/gcc%2Ftestsuite%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/41521dee8edc8fcfbc8fb2d56773d85f909bf356/gcc%2Ftestsuite%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2FChangeLog?ref=41521dee8edc8fcfbc8fb2d56773d85f909bf356", "patch": "@@ -1,5 +1,8 @@\n 2017-11-23  Jakub Jelinek  <jakub@redhat.com>\n \n+\t* gcc.dg/gomp/declare-simd-1.c (f9): Remove.\n+\t* gcc.dg/gomp/declare-simd-5.c: New test.\n+\n \t* g++.dg/pr65240-1.C: Add -Wno-return-type to dg-options.\n \t* g++.dg/pr65240-2.C: Likewise.\n \t* g++.dg/pr65240-3.C: Likewise."}, {"sha": "b8bba1f892b6d1fb6885a47f4b7ef78f7caba7ef", "filename": "gcc/testsuite/gcc.dg/gomp/declare-simd-1.c", "status": "modified", "additions": 0, "deletions": 12, "changes": 12, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/41521dee8edc8fcfbc8fb2d56773d85f909bf356/gcc%2Ftestsuite%2Fgcc.dg%2Fgomp%2Fdeclare-simd-1.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/41521dee8edc8fcfbc8fb2d56773d85f909bf356/gcc%2Ftestsuite%2Fgcc.dg%2Fgomp%2Fdeclare-simd-1.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgcc.dg%2Fgomp%2Fdeclare-simd-1.c?ref=41521dee8edc8fcfbc8fb2d56773d85f909bf356", "patch": "@@ -58,18 +58,6 @@ f7 (int x)\n /* { dg-final { scan-assembler-times \"_ZGVeM16v_f7:\" 1 { target { i?86-*-* x86_64-*-* } } } } */\n /* { dg-final { scan-assembler-times \"_ZGVeN16v_f7:\" 1 { target { i?86-*-* x86_64-*-* } } } } */\n \n-int\n-f9 (int x)\n-{\n-  if (x)\n-    #pragma omp declare simd simdlen (8) aligned (b : 8 * sizeof (int))\n-    extern int f10 (int a, int *b, int c);\n-  while (x < 10)\n-    #pragma omp declare simd simdlen (8) aligned (b : 8 * sizeof (int))\n-    extern int f11 (int a, int *b, int c);\n-  return x;\n-}\n-\n #pragma omp declare simd uniform (a) aligned (b : 8 * sizeof (int)) linear (c : 4) simdlen (8)\n int f12 (int c; int *b; int a; int a, int *b, int c);\n "}, {"sha": "fe236525d6205a4f474468c2d8dd23e5405e3d66", "filename": "gcc/testsuite/gcc.dg/gomp/declare-simd-5.c", "status": "added", "additions": 35, "deletions": 0, "changes": 35, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/41521dee8edc8fcfbc8fb2d56773d85f909bf356/gcc%2Ftestsuite%2Fgcc.dg%2Fgomp%2Fdeclare-simd-5.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/41521dee8edc8fcfbc8fb2d56773d85f909bf356/gcc%2Ftestsuite%2Fgcc.dg%2Fgomp%2Fdeclare-simd-5.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgcc.dg%2Fgomp%2Fdeclare-simd-5.c?ref=41521dee8edc8fcfbc8fb2d56773d85f909bf356", "patch": "@@ -0,0 +1,35 @@\n+/* Test parsing of #pragma omp declare simd */\n+/* { dg-do compile } */\n+\n+int\n+f1 (int x)\n+{\n+  if (x)\n+    #pragma omp declare simd simdlen (8) aligned (b : 8 * sizeof (int))\n+    extern int f3 (int a, int *b, int c);\t/* { dg-error \"must be followed by function declaration or definition\" } */\n+  while (x < 10)\n+    #pragma omp declare simd simdlen (8) aligned (b : 8 * sizeof (int))\n+    extern int f4 (int a, int *b, int c);\t/* { dg-error \"must be followed by function declaration or definition\" } */\n+  {\n+lab:\n+    #pragma omp declare simd simdlen (8) aligned (b : 8 * sizeof (int))\n+    extern int f5 (int a, int *b, int c);\t/* { dg-error \"must be followed by function declaration or definition\" } */\n+    x++;\t\t\t\t\t/* { dg-error \"expected expression before\" \"\" { target *-*-* } .-1 } */\n+  }\n+  return x;\n+}\n+\n+int\n+f2 (int x)\n+{\n+  if (x)\n+    extern int f6 (int a, int *b, int c);\t/* { dg-error \"expected expression before\" } */\n+  while (x < 10)\n+    extern int f7 (int a, int *b, int c);\t/* { dg-error \"expected expression before\" } */\n+  {\n+lab:\n+    extern int f8 (int a, int *b, int c);\t/* { dg-error \"a label can only be part of a statement and a declaration is not a statement\" } */\n+    x++;\n+  }\n+  return x;\n+}"}]}