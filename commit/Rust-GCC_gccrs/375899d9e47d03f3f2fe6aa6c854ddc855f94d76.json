{"sha": "375899d9e47d03f3f2fe6aa6c854ddc855f94d76", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6Mzc1ODk5ZDllNDdkMDNmM2YyZmU2YWE2Yzg1NGRkYzg1NWY5NGQ3Ng==", "commit": {"author": {"name": "Chenghua Xu", "email": "paul.hua.gm@gmail.com", "date": "2018-11-07T08:35:54Z"}, "committer": {"name": "Chenghua Xu", "email": "paulhua@gcc.gnu.org", "date": "2018-11-07T08:35:54Z"}, "message": "Add support for Loongson EXT instructions.\n\ngcc/\n\t* config/mips/mips.h (TARGET_CPU_CPP_BUILTINS): Add\n\t__mips_loongson_ext.\n\t(MIPS_ASE_LOONGSON_EXT_SPEC): New.\n\t(BASE_DRIVER_SELF_SPECS): march=loongson3a implies\n\t-mloongson-ext.\n\t(ASM_SPEC): Add mloongson-ext and mno-loongson-ext.\n\t* config/mips/mips.md (mul<mode>3, mul<mode>3_mul3_nohilo,\n\t<u>div<mode>3, <u>mod<mode>3, prefetch): Use TARGET_LOONGSON_EXT\n\tinstead of TARGET_LOONGSON_3A.\n\t* config/mips/mips.opt (-mloongson-ext): Add option.\n\t* gcc/doc/invoke.texi (-mloongson-ext): Document.\n\ngcc/testsuite/\n\t* gcc.target/mips/mips.exp (mips_option_groups): Add\n\t-mloongson-ext option.\n\t(mips-dg-options): Add mips_option_dependency options\n\t\"-mmicromips\" vs \"-mno-loongson-ext\",\n\nFrom-SVN: r265863", "tree": {"sha": "2999733cfb1a8bba26a48661ebf1723961f10a3f", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/2999733cfb1a8bba26a48661ebf1723961f10a3f"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/375899d9e47d03f3f2fe6aa6c854ddc855f94d76", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/375899d9e47d03f3f2fe6aa6c854ddc855f94d76", "html_url": "https://github.com/Rust-GCC/gccrs/commit/375899d9e47d03f3f2fe6aa6c854ddc855f94d76", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/375899d9e47d03f3f2fe6aa6c854ddc855f94d76/comments", "author": {"login": "ChenghuaXu", "id": 87753117, "node_id": "MDQ6VXNlcjg3NzUzMTE3", "avatar_url": "https://avatars.githubusercontent.com/u/87753117?v=4", "gravatar_id": "", "url": "https://api.github.com/users/ChenghuaXu", "html_url": "https://github.com/ChenghuaXu", "followers_url": "https://api.github.com/users/ChenghuaXu/followers", "following_url": "https://api.github.com/users/ChenghuaXu/following{/other_user}", "gists_url": "https://api.github.com/users/ChenghuaXu/gists{/gist_id}", "starred_url": "https://api.github.com/users/ChenghuaXu/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/ChenghuaXu/subscriptions", "organizations_url": "https://api.github.com/users/ChenghuaXu/orgs", "repos_url": "https://api.github.com/users/ChenghuaXu/repos", "events_url": "https://api.github.com/users/ChenghuaXu/events{/privacy}", "received_events_url": "https://api.github.com/users/ChenghuaXu/received_events", "type": "User", "site_admin": false}, "committer": null, "parents": [{"sha": "8ae8bad7e558ce916c52e91a4e1879557f287bbc", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/8ae8bad7e558ce916c52e91a4e1879557f287bbc", "html_url": "https://github.com/Rust-GCC/gccrs/commit/8ae8bad7e558ce916c52e91a4e1879557f287bbc"}], "stats": {"total": 64, "additions": 55, "deletions": 9}, "files": [{"sha": "22fa98afb80fc57d95b3f513fe5628ae05814be3", "filename": "gcc/ChangeLog", "status": "modified", "additions": 14, "deletions": 0, "changes": 14, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/375899d9e47d03f3f2fe6aa6c854ddc855f94d76/gcc%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/375899d9e47d03f3f2fe6aa6c854ddc855f94d76/gcc%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2FChangeLog?ref=375899d9e47d03f3f2fe6aa6c854ddc855f94d76", "patch": "@@ -1,3 +1,17 @@\n+2018-11-07  Chenghua Xu  <paul.hua.gm@gmail.com>\n+\n+\t* config/mips/mips.h (TARGET_CPU_CPP_BUILTINS): Add\n+\t__mips_loongson_ext.\n+\t(MIPS_ASE_LOONGSON_EXT_SPEC): New.\n+\t(BASE_DRIVER_SELF_SPECS): march=loongson3a implies\n+\t-mloongson-ext.\n+\t(ASM_SPEC): Add mloongson-ext and mno-loongson-ext.\n+\t* config/mips/mips.md (mul<mode>3, mul<mode>3_mul3_nohilo,\n+\t<u>div<mode>3, <u>mod<mode>3, prefetch): Use TARGET_LOONGSON_EXT\n+\tinstead of TARGET_LOONGSON_3A.\n+\t* config/mips/mips.opt (-mloongson-ext): Add option.\n+\t* gcc/doc/invoke.texi (-mloongson-ext): Document.\n+\n 2018-11-07  Chenghua Xu  <paul.hua.gm@gmail.com>\n \n \t* config.gcc (extra_headers): Add loongson-mmiintrin.h."}, {"sha": "7237c8da8ac81c0be99400b739e0a1afb6a1fd4b", "filename": "gcc/config/mips/mips.h", "status": "modified", "additions": 13, "deletions": 1, "changes": 14, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/375899d9e47d03f3f2fe6aa6c854ddc855f94d76/gcc%2Fconfig%2Fmips%2Fmips.h", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/375899d9e47d03f3f2fe6aa6c854ddc855f94d76/gcc%2Fconfig%2Fmips%2Fmips.h", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fconfig%2Fmips%2Fmips.h?ref=375899d9e47d03f3f2fe6aa6c854ddc855f94d76", "patch": "@@ -596,6 +596,12 @@ struct mips_cpu_info {\n \t  builtin_define (\"__mips_loongson_mmi\");\t\t\t\\\n \t}\t\t\t\t\t\t\t\t\\\n \t\t\t\t\t\t\t\t\t\\\n+      /* Whether Loongson EXT modes are enabled.  */\t\t\t\\\n+      if (TARGET_LOONGSON_EXT)\t\t\t\t\t\t\\\n+\t{\t\t\t\t\t\t\t\t\\\n+\t  builtin_define (\"__mips_loongson_ext\");\t\t\t\\\n+\t}\t\t\t\t\t\t\t\t\\\n+\t\t\t\t\t\t\t\t\t\\\n       /* Historical Octeon macro.  */\t\t\t\t\t\\\n       if (TARGET_OCTEON)\t\t\t\t\t\t\\\n \tbuiltin_define (\"__OCTEON__\");\t\t\t\t\t\\\n@@ -881,7 +887,8 @@ struct mips_cpu_info {\n #define BASE_DRIVER_SELF_SPECS\t\\\n   MIPS_ISA_NAN2008_SPEC,\t\\\n   MIPS_ASE_DSP_SPEC, \t\t\\\n-  MIPS_ASE_LOONGSON_MMI_SPEC\n+  MIPS_ASE_LOONGSON_MMI_SPEC,\t\\\n+  MIPS_ASE_LOONGSON_EXT_SPEC\n \n #define MIPS_ASE_DSP_SPEC \\\n   \"%{!mno-dsp: \\\n@@ -893,6 +900,10 @@ struct mips_cpu_info {\n   \"%{!mno-loongson-mmi:\t\t\t\t\t\t\t\t\\\n      %{march=loongson2e|march=loongson2f|march=loongson3a: -mloongson-mmi}}\"\n \n+#define MIPS_ASE_LOONGSON_EXT_SPEC\t\t\t\t\t\t\\\n+  \"%{!mno-loongson-ext:\t\t\t\t\t\t\t\t\\\n+     %{march=loongson3a: -mloongson-ext}}\"\n+\n #define DRIVER_SELF_SPECS \\\n   MIPS_ISA_LEVEL_SPEC,\t  \\\n   BASE_DRIVER_SELF_SPECS\n@@ -1367,6 +1378,7 @@ struct mips_cpu_info {\n %{mginv} %{mno-ginv} \\\n %{mmsa} %{mno-msa} \\\n %{mloongson-mmi} %{mno-loongson-mmi} \\\n+%{mloongson-ext} %{mno-loongson-ext} \\\n %{msmartmips} %{mno-smartmips} \\\n %{mmt} %{mno-mt} \\\n %{mfix-rm7000} %{mno-fix-rm7000} \\"}, {"sha": "4b7a627b7a67b84b80a5c32bd04ab7e1e4f727b7", "filename": "gcc/config/mips/mips.md", "status": "modified", "additions": 8, "deletions": 8, "changes": 16, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/375899d9e47d03f3f2fe6aa6c854ddc855f94d76/gcc%2Fconfig%2Fmips%2Fmips.md", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/375899d9e47d03f3f2fe6aa6c854ddc855f94d76/gcc%2Fconfig%2Fmips%2Fmips.md", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fconfig%2Fmips%2Fmips.md?ref=375899d9e47d03f3f2fe6aa6c854ddc855f94d76", "patch": "@@ -1599,7 +1599,7 @@\n {\n   rtx lo;\n \n-  if (TARGET_LOONGSON_2EF || TARGET_LOONGSON_3A || ISA_HAS_R6<D>MUL)\n+  if (TARGET_LOONGSON_2EF || TARGET_LOONGSON_EXT || ISA_HAS_R6<D>MUL)\n     emit_insn (gen_mul<mode>3_mul3_nohilo (operands[0], operands[1],\n \t\t\t\t\t   operands[2]));\n   else if (ISA_HAS_<D>MUL3)\n@@ -1622,11 +1622,11 @@\n   [(set (match_operand:GPR 0 \"register_operand\" \"=d\")\n         (mult:GPR (match_operand:GPR 1 \"register_operand\" \"d\")\n                   (match_operand:GPR 2 \"register_operand\" \"d\")))]\n-  \"TARGET_LOONGSON_2EF || TARGET_LOONGSON_3A || ISA_HAS_R6<D>MUL\"\n+  \"TARGET_LOONGSON_2EF || TARGET_LOONGSON_EXT || ISA_HAS_R6<D>MUL\"\n {\n   if (TARGET_LOONGSON_2EF)\n     return \"<d>multu.g\\t%0,%1,%2\";\n-  else if (TARGET_LOONGSON_3A)\n+  else if (TARGET_LOONGSON_EXT)\n     return \"gs<d>multu\\t%0,%1,%2\";\n   else\n     return \"<d>mul\\t%0,%1,%2\";\n@@ -3016,11 +3016,11 @@\n   [(set (match_operand:GPR 0 \"register_operand\" \"=&d\")\n \t(any_div:GPR (match_operand:GPR 1 \"register_operand\" \"d\")\n \t\t     (match_operand:GPR 2 \"register_operand\" \"d\")))]\n-  \"TARGET_LOONGSON_2EF || TARGET_LOONGSON_3A || ISA_HAS_R6<D>DIV\"\n+  \"TARGET_LOONGSON_2EF || TARGET_LOONGSON_EXT || ISA_HAS_R6<D>DIV\"\n   {\n     if (TARGET_LOONGSON_2EF)\n       return mips_output_division (\"<d>div<u>.g\\t%0,%1,%2\", operands);\n-    else if (TARGET_LOONGSON_3A)\n+    else if (TARGET_LOONGSON_EXT)\n       return mips_output_division (\"gs<d>div<u>\\t%0,%1,%2\", operands);\n     else\n       return mips_output_division (\"<d>div<u>\\t%0,%1,%2\", operands);\n@@ -3032,11 +3032,11 @@\n   [(set (match_operand:GPR 0 \"register_operand\" \"=&d\")\n \t(any_mod:GPR (match_operand:GPR 1 \"register_operand\" \"d\")\n \t\t     (match_operand:GPR 2 \"register_operand\" \"d\")))]\n-  \"TARGET_LOONGSON_2EF || TARGET_LOONGSON_3A || ISA_HAS_R6<D>DIV\"\n+  \"TARGET_LOONGSON_2EF || TARGET_LOONGSON_EXT || ISA_HAS_R6<D>DIV\"\n   {\n     if (TARGET_LOONGSON_2EF)\n       return mips_output_division (\"<d>mod<u>.g\\t%0,%1,%2\", operands);\n-    else if (TARGET_LOONGSON_3A)\n+    else if (TARGET_LOONGSON_EXT)\n       return mips_output_division (\"gs<d>mod<u>\\t%0,%1,%2\", operands);\n     else\n       return mips_output_division (\"<d>mod<u>\\t%0,%1,%2\", operands);\n@@ -7136,7 +7136,7 @@\n \t     (match_operand 2 \"const_int_operand\" \"n\"))]\n   \"ISA_HAS_PREFETCH && TARGET_EXPLICIT_RELOCS\"\n {\n-  if (TARGET_LOONGSON_2EF || TARGET_LOONGSON_3A)\n+  if (TARGET_LOONGSON_2EF || TARGET_LOONGSON_EXT)\n     {\n       /* Loongson 2[ef] and Loongson 3a use load to $0 for prefetching.  */\n       if (TARGET_64BIT)"}, {"sha": "a8fe8db3c66c5937e5bc5ed6e3aa44068412f97b", "filename": "gcc/config/mips/mips.opt", "status": "modified", "additions": 4, "deletions": 0, "changes": 4, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/375899d9e47d03f3f2fe6aa6c854ddc855f94d76/gcc%2Fconfig%2Fmips%2Fmips.opt", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/375899d9e47d03f3f2fe6aa6c854ddc855f94d76/gcc%2Fconfig%2Fmips%2Fmips.opt", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fconfig%2Fmips%2Fmips.opt?ref=375899d9e47d03f3f2fe6aa6c854ddc855f94d76", "patch": "@@ -463,3 +463,7 @@ Enum(mips_cb_setting) String(always) Value(MIPS_CB_ALWAYS)\n mloongson-mmi\n Target Report Mask(LOONGSON_MMI)\n Use Loongson MultiMedia extensions Instructions (MMI) instructions.\n+\n+mloongson-ext\n+Target Report Mask(LOONGSON_EXT)\n+Use Loongson EXTension (EXT) instructions."}, {"sha": "1348c13223b0e5ba1b3c4717f37e3b29adc85f69", "filename": "gcc/doc/invoke.texi", "status": "modified", "additions": 7, "deletions": 0, "changes": 7, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/375899d9e47d03f3f2fe6aa6c854ddc855f94d76/gcc%2Fdoc%2Finvoke.texi", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/375899d9e47d03f3f2fe6aa6c854ddc855f94d76/gcc%2Fdoc%2Finvoke.texi", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fdoc%2Finvoke.texi?ref=375899d9e47d03f3f2fe6aa6c854ddc855f94d76", "patch": "@@ -921,6 +921,7 @@ Objective-C and Objective-C++ Dialects}.\n -mmicromips  -mno-micromips @gol\n -mmsa  -mno-msa @gol\n -mloongson-mmi  -mno-loongson-mmi @gol\n+-mloongson-ext  -mno-loongson-ext @gol\n -mfpu=@var{fpu-type} @gol\n -msmartmips  -mno-smartmips @gol\n -mpaired-single  -mno-paired-single  -mdmx  -mno-mdmx @gol\n@@ -21293,6 +21294,12 @@ Use (do not use) the MIPS Global INValidate (GINV) instructions.\n @opindex mno-loongson-mmi\n Use (do not use) the MIPS Loongson MultiMedia extensions Instructions (MMI).\n \n+@item -mloongson-ext\n+@itemx -mno-loongson-ext\n+@opindex mloongson-ext\n+@opindex mno-loongson-ext\n+Use (do not use) the MIPS Loongson EXTensions (EXT) instructions.\n+\n @item -mlong64\n @opindex mlong64\n Force @code{long} types to be 64 bits wide.  See @option{-mlong32} for"}, {"sha": "f709d2ca2a812dd675b617c3ad7dd20fcacc8582", "filename": "gcc/testsuite/ChangeLog", "status": "modified", "additions": 7, "deletions": 0, "changes": 7, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/375899d9e47d03f3f2fe6aa6c854ddc855f94d76/gcc%2Ftestsuite%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/375899d9e47d03f3f2fe6aa6c854ddc855f94d76/gcc%2Ftestsuite%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2FChangeLog?ref=375899d9e47d03f3f2fe6aa6c854ddc855f94d76", "patch": "@@ -1,3 +1,10 @@\n+2018-11-07  Chenghua Xu  <paul.hua.gm@gmail.com>\n+\n+\t* gcc.target/mips/mips.exp (mips_option_groups): Add\n+\t-mloongson-ext option.\n+\t(mips-dg-options): Add mips_option_dependency options\n+\t\"-mmicromips\" vs \"-mno-loongson-ext\",\n+\n 2018-11-07  Chenghua Xu  <paul.hua.gm@gmail.com>\n \n \t* gcc.target/mips/loongson-shift-count-truncated-1.c"}, {"sha": "ceb86cc0276becdf439ccadd1ffb444266e6d2e6", "filename": "gcc/testsuite/gcc.target/mips/mips.exp", "status": "modified", "additions": 2, "deletions": 0, "changes": 2, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/375899d9e47d03f3f2fe6aa6c854ddc855f94d76/gcc%2Ftestsuite%2Fgcc.target%2Fmips%2Fmips.exp", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/375899d9e47d03f3f2fe6aa6c854ddc855f94d76/gcc%2Ftestsuite%2Fgcc.target%2Fmips%2Fmips.exp", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgcc.target%2Fmips%2Fmips.exp?ref=375899d9e47d03f3f2fe6aa6c854ddc855f94d76", "patch": "@@ -297,6 +297,7 @@ foreach option {\n     odd-spreg\n     msa\n     loongson-mmi\n+    loongson-ext\n } {\n     lappend mips_option_groups $option \"-m(no-|)$option\"\n }\n@@ -1055,6 +1056,7 @@ proc mips-dg-options { args } {\n     mips_option_dependency options \"-mips16\" \"-mno-loongson-mmi\"\n     mips_option_dependency options \"-mmicromips\" \"-mno-loongson-mmi\"\n     mips_option_dependency options \"-msoft-float\" \"-mno-loongson-mmi\"\n+    mips_option_dependency options \"-mmicromips\" \"-mno-loongson-ext\"\n \n     # Work out information about the current ABI.\n     set abi_test_option_p [mips_test_option_p options abi]"}]}