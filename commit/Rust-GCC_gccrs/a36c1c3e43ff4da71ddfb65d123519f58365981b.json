{"sha": "a36c1c3e43ff4da71ddfb65d123519f58365981b", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6YTM2YzFjM2U0M2ZmNGRhNzFkZGZiNjVkMTIzNTE5ZjU4MzY1OTgxYg==", "commit": {"author": {"name": "Robert Dewar", "email": "dewar@adacore.com", "date": "2009-07-22T10:25:57Z"}, "committer": {"name": "Arnaud Charlet", "email": "charlet@gcc.gnu.org", "date": "2009-07-22T10:25:57Z"}, "message": "sem_res.adb (Check_No_Direct_Boolean_Operators): Add check for -gnatyB\n\n2009-07-22  Robert Dewar  <dewar@adacore.com>\n\n\t* sem_res.adb (Check_No_Direct_Boolean_Operators): Add check for -gnatyB\n\t* style.ads, styleg.adb, styleg.ads (Check_Boolean_Operator): New\n\tprocedure.\n\t* usage.adb, stylesw.ads, stylesw.adb: Add handling of -gnatyB switch\n\t* gnat_ugn.texi: Add documentation of -gnatyB\n\t* vms_data.ads: Add entry for -gnatyB (STYLE=BOOLEAN_OPERATORS)\n\nFrom-SVN: r149923", "tree": {"sha": "eadd181009b4822e6ce92897aef59201db5cab36", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/eadd181009b4822e6ce92897aef59201db5cab36"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/a36c1c3e43ff4da71ddfb65d123519f58365981b", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/a36c1c3e43ff4da71ddfb65d123519f58365981b", "html_url": "https://github.com/Rust-GCC/gccrs/commit/a36c1c3e43ff4da71ddfb65d123519f58365981b", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/a36c1c3e43ff4da71ddfb65d123519f58365981b/comments", "author": null, "committer": null, "parents": [{"sha": "d1ced162c2d0525032df4c98d4d14dbcc7980de7", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/d1ced162c2d0525032df4c98d4d14dbcc7980de7", "html_url": "https://github.com/Rust-GCC/gccrs/commit/d1ced162c2d0525032df4c98d4d14dbcc7980de7"}], "stats": {"total": 142, "additions": 138, "deletions": 4}, "files": [{"sha": "e6e5f8daed303ded8e60ce862c45dc17df8b9885", "filename": "gcc/ada/ChangeLog", "status": "modified", "additions": 9, "deletions": 0, "changes": 9, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/a36c1c3e43ff4da71ddfb65d123519f58365981b/gcc%2Fada%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/a36c1c3e43ff4da71ddfb65d123519f58365981b/gcc%2Fada%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fada%2FChangeLog?ref=a36c1c3e43ff4da71ddfb65d123519f58365981b", "patch": "@@ -1,3 +1,12 @@\n+2009-07-22  Robert Dewar  <dewar@adacore.com>\n+\n+\t* sem_res.adb (Check_No_Direct_Boolean_Operators): Add check for -gnatyB\n+\t* style.ads, styleg.adb, styleg.ads (Check_Boolean_Operator): New\n+\tprocedure.\n+\t* usage.adb, stylesw.ads, stylesw.adb: Add handling of -gnatyB switch\n+\t* gnat_ugn.texi: Add documentation of -gnatyB\n+\t* vms_data.ads: Add entry for -gnatyB (STYLE=BOOLEAN_OPERATORS)\n+\n 2009-07-22  Robert Dewar  <dewar@adacore.com>\n \n \t* s-stchop.adb, a-direct.adb, a-ztexio.adb, gnatchop.adb, prj-proc.adb,"}, {"sha": "24e7867d6e86d20a655e2906400f4144075232eb", "filename": "gcc/ada/gnat_ugn.texi", "status": "modified", "additions": 11, "deletions": 0, "changes": 11, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/a36c1c3e43ff4da71ddfb65d123519f58365981b/gcc%2Fada%2Fgnat_ugn.texi", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/a36c1c3e43ff4da71ddfb65d123519f58365981b/gcc%2Fada%2Fgnat_ugn.texi", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fada%2Fgnat_ugn.texi?ref=a36c1c3e43ff4da71ddfb65d123519f58365981b", "patch": "@@ -6118,6 +6118,12 @@ Trailing blanks are not allowed at the end of statements. The purpose of this\n rule, together with h (no horizontal tabs), is to enforce a canonical format\n for the use of blanks to separate source tokens.\n \n+@item ^B^BOOLEAN_OPERATORS^\n+@emph{Check Boolean operators.}\n+The use of AND/OR operators is not permitted except in the cases of modular\n+operands, array operands, and simple stand-alone boolean variables or\n+boolean constants. In all other cases AND THEN/OR ELSE are required.\n+\n @item ^c^COMMENTS^\n @emph{Check comments.}\n Comments must meet the following set of rules:\n@@ -22616,6 +22622,11 @@ Same as @option{^-gnatyM^/MAX_LINE_LENGTH=^@var{n}}\n Avoind raising PROGRAM_ERROR in the generated bodies of program unit stubs.\n This is not always possible for function stubs.\n \n+@item ^--no-local-header^/NO_LOCAL_HEADER^\n+@cindex @option{^--no-local-header^/NO_LOCAL_HEADER^} (@command{gnatstub})\n+Do not place local comment header with unit name before body stub for a\n+unit.\n+\n @item ^-o ^/BODY=^@var{body-name}\n @cindex @option{^-o^/BODY^} (@command{gnatstub})\n Body file name.  This should be set if the argument file name does not"}, {"sha": "ca478bda1ff3e84d8dbc51ff69abd6537ec00130", "filename": "gcc/ada/sem_res.adb", "status": "modified", "additions": 6, "deletions": 1, "changes": 7, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/a36c1c3e43ff4da71ddfb65d123519f58365981b/gcc%2Fada%2Fsem_res.adb", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/a36c1c3e43ff4da71ddfb65d123519f58365981b/gcc%2Fada%2Fsem_res.adb", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fada%2Fsem_res.adb?ref=a36c1c3e43ff4da71ddfb65d123519f58365981b", "patch": "@@ -122,7 +122,8 @@ package body Sem_Res is\n    procedure Check_No_Direct_Boolean_Operators (N : Node_Id);\n    --  N is the node for a logical operator. If the operator is predefined, and\n    --  the root type of the operands is Standard.Boolean, then a check is made\n-   --  for restriction No_Direct_Boolean_Operators.\n+   --  for restriction No_Direct_Boolean_Operators. This procedure also handles\n+   --  the style check for Style_Check_Boolean_And_Or.\n \n    function Is_Definite_Access_Type (E : Entity_Id) return Boolean;\n    --  Determine whether E is an access type declared by an access\n@@ -947,6 +948,10 @@ package body Sem_Res is\n             Check_Restriction (No_Direct_Boolean_Operators, N);\n          end if;\n       end if;\n+\n+      if Style_Check then\n+         Check_Boolean_Operator (N);\n+      end if;\n    end Check_No_Direct_Boolean_Operators;\n \n    ------------------------------"}, {"sha": "b61cd08bbf9df31f91d1d4644a85b71647421bb8", "filename": "gcc/ada/style.ads", "status": "modified", "additions": 5, "deletions": 1, "changes": 6, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/a36c1c3e43ff4da71ddfb65d123519f58365981b/gcc%2Fada%2Fstyle.ads", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/a36c1c3e43ff4da71ddfb65d123519f58365981b/gcc%2Fada%2Fstyle.ads", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fada%2Fstyle.ads?ref=a36c1c3e43ff4da71ddfb65d123519f58365981b", "patch": "@@ -6,7 +6,7 @@\n --                                                                          --\n --                                 S p e c                                  --\n --                                                                          --\n---          Copyright (C) 1992-2008, Free Software Foundation, Inc.         --\n+--          Copyright (C) 1992-2009, Free Software Foundation, Inc.         --\n --                                                                          --\n -- GNAT is free software;  you can  redistribute it  and/or modify it under --\n -- terms of the  GNU General Public License as published  by the Free Soft- --\n@@ -90,6 +90,10 @@ package Style is\n    --  designator is a reserved word (access, digits, delta or range) to allow\n    --  differing rules for the two cases.\n \n+   procedure Check_Boolean_Operator (Node : Node_Id)\n+     renames Style_Inst.Check_Boolean_Operator;\n+   --  Called after resolving AND or OR node to check short circuit rules\n+\n    procedure Check_Box\n      renames Style_Inst.Check_Box;\n    --  Called after scanning out a box to check spacing"}, {"sha": "8bd9f2ee2bd5dadf9501033a8f4c6edceae35d3d", "filename": "gcc/ada/styleg.adb", "status": "modified", "additions": 81, "deletions": 0, "changes": 81, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/a36c1c3e43ff4da71ddfb65d123519f58365981b/gcc%2Fada%2Fstyleg.adb", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/a36c1c3e43ff4da71ddfb65d123519f58365981b/gcc%2Fada%2Fstyleg.adb", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fada%2Fstyleg.adb?ref=a36c1c3e43ff4da71ddfb65d123519f58365981b", "patch": "@@ -27,11 +27,14 @@\n --  checking rules. For documentation of these rules, see comments on the\n --  individual procedures.\n \n+with Atree;    use Atree;\n with Casing;   use Casing;\n with Csets;    use Csets;\n+with Einfo;    use Einfo;\n with Err_Vars; use Err_Vars;\n with Opt;      use Opt;\n with Scans;    use Scans;\n+with Sinfo;    use Sinfo;\n with Sinput;   use Sinput;\n with Stylesw;  use Stylesw;\n \n@@ -166,6 +169,84 @@ package body Styleg is\n       end if;\n    end Check_Binary_Operator;\n \n+   ----------------------------\n+   -- Check_Boolean_Operator --\n+   ----------------------------\n+\n+   procedure Check_Boolean_Operator (Node : Node_Id) is\n+\n+      function OK_Boolean_Operand (N : Node_Id) return Boolean;\n+      --  Returns True for simple variable, or \"not X1\" or \"X1 and X2\" or\n+      --  \"X1 or X2\" where X1, X2 are recursively OK_Boolean_Operand's.\n+\n+      ------------------------\n+      -- OK_Boolean_Operand --\n+      ------------------------\n+\n+      function OK_Boolean_Operand (N : Node_Id) return Boolean is\n+      begin\n+         if Nkind_In (N, N_Identifier, N_Expanded_Name) then\n+            return True;\n+\n+         elsif Nkind (N) = N_Op_Not then\n+            return OK_Boolean_Operand (Original_Node (Right_Opnd (N)));\n+\n+         elsif Nkind_In (N, N_Op_And, N_Op_Or) then\n+            return OK_Boolean_Operand (Original_Node (Left_Opnd (N)))\n+                     and then\n+                   OK_Boolean_Operand (Original_Node (Right_Opnd (N)));\n+\n+         else\n+            return False;\n+         end if;\n+      end OK_Boolean_Operand;\n+\n+   --  Start of processig for Check_Boolean_Operator\n+   begin\n+      if Style_Check_Boolean_And_Or\n+        and then Comes_From_Source (Node)\n+      then\n+         declare\n+            Orig : constant Node_Id := Original_Node (Node);\n+\n+         begin\n+            if Nkind_In (Orig, N_Op_And, N_Op_Or) then\n+               declare\n+                  L : constant Node_Id := Original_Node (Left_Opnd  (Orig));\n+                  R : constant Node_Id := Original_Node (Right_Opnd (Orig));\n+\n+               begin\n+                  --  First OK case, simple boolean constants/identifiers\n+\n+                  if OK_Boolean_Operand (L)\n+                       and then\n+                     OK_Boolean_Operand (R)\n+                  then\n+                     return;\n+\n+                  --  Second OK case, modular types\n+\n+                  elsif Is_Modular_Integer_Type (Etype (Node)) then\n+                     return;\n+\n+                  --  Third OK case, array types\n+\n+                  elsif Is_Array_Type (Etype (Node)) then\n+                     return;\n+\n+                  --  Otherwise we have an error\n+\n+                  elsif Nkind (Orig) = N_Op_And then\n+                     Error_Msg (\"(style) `AND THEN` required\", Sloc (Orig));\n+                  else\n+                     Error_Msg (\"(style) `OR ELSE` required\", Sloc (Orig));\n+                  end if;\n+               end;\n+            end if;\n+         end;\n+      end if;\n+   end Check_Boolean_Operator;\n+\n    ---------------\n    -- Check_Box --\n    ---------------"}, {"sha": "91c90d2ae81b14ad9c7d2573fc44c409ae16d080", "filename": "gcc/ada/styleg.ads", "status": "modified", "additions": 5, "deletions": 1, "changes": 6, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/a36c1c3e43ff4da71ddfb65d123519f58365981b/gcc%2Fada%2Fstyleg.ads", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/a36c1c3e43ff4da71ddfb65d123519f58365981b/gcc%2Fada%2Fstyleg.ads", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fada%2Fstyleg.ads?ref=a36c1c3e43ff4da71ddfb65d123519f58365981b", "patch": "@@ -6,7 +6,7 @@\n --                                                                          --\n --                                 S p e c                                  --\n --                                                                          --\n---          Copyright (C) 1992-2008, Free Software Foundation, Inc.         --\n+--          Copyright (C) 1992-2009, Free Software Foundation, Inc.         --\n --                                                                          --\n -- GNAT is free software;  you can  redistribute it  and/or modify it under --\n -- terms of the  GNU General Public License as published  by the Free Soft- --\n@@ -61,6 +61,10 @@ package Styleg is\n    --  the attribute designator is a reserved word (access, digits,\n    --  delta or range) to allow differing rules for the two cases.\n \n+   procedure Check_Boolean_Operator (Node : Node_Id);\n+   --  Node is a node for an AND or OR operator. Check that the usage meets\n+   --  the style rules.\n+\n    procedure Check_Box;\n    --  Called after scanning out a box to check spacing\n "}, {"sha": "41275b795935cdfac2703880b303347bd03a4ae9", "filename": "gcc/ada/stylesw.adb", "status": "modified", "additions": 9, "deletions": 1, "changes": 10, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/a36c1c3e43ff4da71ddfb65d123519f58365981b/gcc%2Fada%2Fstylesw.adb", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/a36c1c3e43ff4da71ddfb65d123519f58365981b/gcc%2Fada%2Fstylesw.adb", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fada%2Fstylesw.adb?ref=a36c1c3e43ff4da71ddfb65d123519f58365981b", "patch": "@@ -6,7 +6,7 @@\n --                                                                          --\n --                                 B o d y                                  --\n --                                                                          --\n---          Copyright (C) 1992-2008, Free Software Foundation, Inc.         --\n+--          Copyright (C) 1992-2009, Free Software Foundation, Inc.         --\n --                                                                          --\n -- GNAT is free software;  you can  redistribute it  and/or modify it under --\n -- terms of the  GNU General Public License as published  by the Free Soft- --\n@@ -39,6 +39,7 @@ package body Stylesw is\n       Style_Check_Attribute_Casing      := False;\n       Style_Check_Blanks_At_End         := False;\n       Style_Check_Blank_Lines           := False;\n+      Style_Check_Boolean_And_Or        := False;\n       Style_Check_Comments              := False;\n       Style_Check_DOS_Line_Terminator   := False;\n       Style_Check_End_Labels            := False;\n@@ -122,6 +123,7 @@ package body Stylesw is\n       Add ('a', Style_Check_Attribute_Casing);\n       Add ('A', Style_Check_Array_Attribute_Index);\n       Add ('b', Style_Check_Blanks_At_End);\n+      Add ('B', Style_Check_Boolean_And_Or);\n       Add ('c', Style_Check_Comments);\n       Add ('d', Style_Check_DOS_Line_Terminator);\n       Add ('e', Style_Check_End_Labels);\n@@ -279,6 +281,9 @@ package body Stylesw is\n             when 'b' =>\n                Style_Check_Blanks_At_End         := True;\n \n+            when 'B' =>\n+               Style_Check_Boolean_And_Or        := True;\n+\n             when 'c' =>\n                Style_Check_Comments              := True;\n \n@@ -440,6 +445,9 @@ package body Stylesw is\n             when 'b' =>\n                Style_Check_Blanks_At_End         := False;\n \n+            when 'B' =>\n+               Style_Check_Boolean_And_Or        := False;\n+\n             when 'c' =>\n                Style_Check_Comments              := False;\n "}, {"sha": "744706380c8e97b3569f716972eb49273a1269b8", "filename": "gcc/ada/stylesw.ads", "status": "modified", "additions": 9, "deletions": 0, "changes": 9, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/a36c1c3e43ff4da71ddfb65d123519f58365981b/gcc%2Fada%2Fstylesw.ads", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/a36c1c3e43ff4da71ddfb65d123519f58365981b/gcc%2Fada%2Fstylesw.ads", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fada%2Fstylesw.ads?ref=a36c1c3e43ff4da71ddfb65d123519f58365981b", "patch": "@@ -67,6 +67,15 @@ package Stylesw is\n    --  multiple blank lines are not permitted, and there may not be a blank\n    --  line at the end of the file.\n \n+   Style_Check_Boolean_And_Or : Boolean := False;\n+   --  This can be set True by using the -gnatyB switch. If it is True, then\n+   --  the use of AND THEN/OR ELSE rather than AND/OR is required except for\n+   --  the following cases:\n+   --\n+   --     a) Both operands are simple Boolean constants or variables\n+   --     b) Both operands are of a modular type\n+   --     c) Both operands are of an array type\n+\n    Style_Check_Comments : Boolean := False;\n    --  This can be set True by using the -gnatyc switch. If it is True, then\n    --  comments are style checked as follows:"}, {"sha": "0d6e9ccac91d48c17637507fe261ba41d3866f18", "filename": "gcc/ada/usage.adb", "status": "modified", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/a36c1c3e43ff4da71ddfb65d123519f58365981b/gcc%2Fada%2Fusage.adb", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/a36c1c3e43ff4da71ddfb65d123519f58365981b/gcc%2Fada%2Fusage.adb", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fada%2Fusage.adb?ref=a36c1c3e43ff4da71ddfb65d123519f58365981b", "patch": "@@ -524,6 +524,7 @@ begin\n    Write_Line (\"        a    check attribute casing\");\n    Write_Line (\"        A    check array attribute indexes\");\n    Write_Line (\"        b    check no blanks at end of lines\");\n+   Write_Line (\"        B    check no use of AND/OR for boolean expressions\");\n    Write_Line (\"        c    check comment format\");\n    Write_Line (\"        d    check no DOS line terminators\");\n    Write_Line (\"        e    check end/exit labels present\");"}, {"sha": "eae2058e06faa40a98213b3f4318006dc0eb36ec", "filename": "gcc/ada/vms_data.ads", "status": "modified", "additions": 2, "deletions": 0, "changes": 2, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/a36c1c3e43ff4da71ddfb65d123519f58365981b/gcc%2Fada%2Fvms_data.ads", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/a36c1c3e43ff4da71ddfb65d123519f58365981b/gcc%2Fada%2Fvms_data.ads", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fada%2Fvms_data.ads?ref=a36c1c3e43ff4da71ddfb65d123519f58365981b", "patch": "@@ -2222,6 +2222,8 @@ package VMS_Data is\n                                                \"-gnaty-A \"                 &\n                                             \"BLANKS \"                      &\n                                                \"-gnatyb \"                  &\n+                                            \"BOOLEAN_OPERATORS \"           &\n+                                               \"-gnatyB \"                  &\n                                             \"NOBLANKS \"                    &\n                                                \"-gnaty-b \"                 &\n                                             \"COMMENTS \"                    &"}]}