{"sha": "caee690e915e13a48a16dabbb61110ae88d1821a", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6Y2FlZTY5MGU5MTVlMTNhNDhhMTZkYWJiYjYxMTEwYWU4OGQxODIxYQ==", "commit": {"author": {"name": "Jason Merrill", "email": "jason@redhat.com", "date": "2015-01-13T21:04:43Z"}, "committer": {"name": "Jason Merrill", "email": "jason@gcc.gnu.org", "date": "2015-01-13T21:04:43Z"}, "message": "re PR c++/64356 (Some constexpr expressions not recognized as constexpr)\n\n\tPR c++/64356\n\tPR libstdc++/58777\n\t* constexpr.c (cxx_eval_binary_expression): Don't VERIFY_CONSTANT\n\tpointer expressions.\n\t(cxx_eval_increment_expression): Likewise.\n\nFrom-SVN: r219559", "tree": {"sha": "9eaa74bed3b9d5c63d6e7a29849c7e6a834a3344", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/9eaa74bed3b9d5c63d6e7a29849c7e6a834a3344"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/caee690e915e13a48a16dabbb61110ae88d1821a", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/caee690e915e13a48a16dabbb61110ae88d1821a", "html_url": "https://github.com/Rust-GCC/gccrs/commit/caee690e915e13a48a16dabbb61110ae88d1821a", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/caee690e915e13a48a16dabbb61110ae88d1821a/comments", "author": {"login": "jicama", "id": 266146, "node_id": "MDQ6VXNlcjI2NjE0Ng==", "avatar_url": "https://avatars.githubusercontent.com/u/266146?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jicama", "html_url": "https://github.com/jicama", "followers_url": "https://api.github.com/users/jicama/followers", "following_url": "https://api.github.com/users/jicama/following{/other_user}", "gists_url": "https://api.github.com/users/jicama/gists{/gist_id}", "starred_url": "https://api.github.com/users/jicama/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jicama/subscriptions", "organizations_url": "https://api.github.com/users/jicama/orgs", "repos_url": "https://api.github.com/users/jicama/repos", "events_url": "https://api.github.com/users/jicama/events{/privacy}", "received_events_url": "https://api.github.com/users/jicama/received_events", "type": "User", "site_admin": false}, "committer": null, "parents": [{"sha": "7c368fb23cc92a3406e181ae361ebce3f5b9ab22", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/7c368fb23cc92a3406e181ae361ebce3f5b9ab22", "html_url": "https://github.com/Rust-GCC/gccrs/commit/7c368fb23cc92a3406e181ae361ebce3f5b9ab22"}], "stats": {"total": 60, "additions": 45, "deletions": 15}, "files": [{"sha": "013c432a6618f64b269f61e392e80f526bd7377f", "filename": "gcc/cp/ChangeLog", "status": "modified", "additions": 6, "deletions": 0, "changes": 6, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/caee690e915e13a48a16dabbb61110ae88d1821a/gcc%2Fcp%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/caee690e915e13a48a16dabbb61110ae88d1821a/gcc%2Fcp%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fcp%2FChangeLog?ref=caee690e915e13a48a16dabbb61110ae88d1821a", "patch": "@@ -1,5 +1,11 @@\n 2015-01-13  Jason Merrill  <jason@redhat.com>\n \n+\tPR c++/64356\n+\tPR libstdc++/58777\n+\t* constexpr.c (cxx_eval_binary_expression): Don't VERIFY_CONSTANT\n+\tpointer expressions.\n+\t(cxx_eval_increment_expression): Likewise.\n+\n \tPR c++/64514\n \t* pt.c (coerce_template_parameter_pack): Return NULL for a\n \tzero-length fixed parameter pack with a pack expansion arg."}, {"sha": "14325069531e280024d8256f6315d6dc9cef1aed", "filename": "gcc/cp/constexpr.c", "status": "modified", "additions": 16, "deletions": 5, "changes": 21, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/caee690e915e13a48a16dabbb61110ae88d1821a/gcc%2Fcp%2Fconstexpr.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/caee690e915e13a48a16dabbb61110ae88d1821a/gcc%2Fcp%2Fconstexpr.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fcp%2Fconstexpr.c?ref=caee690e915e13a48a16dabbb61110ae88d1821a", "patch": "@@ -1616,10 +1616,15 @@ cxx_eval_binary_expression (const constexpr_ctx *ctx, tree t,\n   tree lhs, rhs;\n   lhs = cxx_eval_constant_expression (ctx, orig_lhs, /*lval*/false,\n \t\t\t\t      non_constant_p, overflow_p);\n-  VERIFY_CONSTANT (lhs);\n+  /* Don't VERIFY_CONSTANT if this might be dealing with a pointer to\n+     a local array in a constexpr function.  */\n+  bool ptr = POINTER_TYPE_P (TREE_TYPE (lhs));\n+  if (!ptr)\n+    VERIFY_CONSTANT (lhs);\n   rhs = cxx_eval_constant_expression (ctx, orig_rhs, /*lval*/false,\n \t\t\t\t      non_constant_p, overflow_p);\n-  VERIFY_CONSTANT (rhs);\n+  if (!ptr)\n+    VERIFY_CONSTANT (lhs);\n \n   location_t loc = EXPR_LOCATION (t);\n   enum tree_code code = TREE_CODE (t);\n@@ -1634,7 +1639,8 @@ cxx_eval_binary_expression (const constexpr_ctx *ctx, tree t,\n     }\n   else if (cxx_eval_check_shift_p (loc, ctx, code, type, lhs, rhs))\n     *non_constant_p = true;\n-  VERIFY_CONSTANT (r);\n+  if (!ptr)\n+    VERIFY_CONSTANT (lhs);\n   return r;\n }\n \n@@ -2704,7 +2710,11 @@ cxx_eval_increment_expression (const constexpr_ctx *ctx, tree t,\n   tree val = rvalue (op);\n   val = cxx_eval_constant_expression (ctx, val, false,\n \t\t\t\t      non_constant_p, overflow_p);\n-  VERIFY_CONSTANT (val);\n+  /* Don't VERIFY_CONSTANT if this might be dealing with a pointer to\n+     a local array in a constexpr function.  */\n+  bool ptr = POINTER_TYPE_P (TREE_TYPE (val));\n+  if (!ptr)\n+    VERIFY_CONSTANT (val);\n \n   /* The modified value.  */\n   bool inc = (code == PREINCREMENT_EXPR || code == POSTINCREMENT_EXPR);\n@@ -2719,7 +2729,8 @@ cxx_eval_increment_expression (const constexpr_ctx *ctx, tree t,\n     }\n   else\n     mod = fold_build2 (inc ? PLUS_EXPR : MINUS_EXPR, type, val, offset);\n-  VERIFY_CONSTANT (mod);\n+  if (!ptr)\n+    VERIFY_CONSTANT (mod);\n \n   /* Storing the modified value.  */\n   tree store = build2 (MODIFY_EXPR, type, op, mod);"}, {"sha": "fd6143b091eb1972312dc28d4d528a22ef03cd3b", "filename": "gcc/testsuite/g++.dg/cpp1y/constexpr-local2.C", "status": "added", "additions": 22, "deletions": 0, "changes": 22, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/caee690e915e13a48a16dabbb61110ae88d1821a/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Fcpp1y%2Fconstexpr-local2.C", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/caee690e915e13a48a16dabbb61110ae88d1821a/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Fcpp1y%2Fconstexpr-local2.C", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Fcpp1y%2Fconstexpr-local2.C?ref=caee690e915e13a48a16dabbb61110ae88d1821a", "patch": "@@ -0,0 +1,22 @@\n+// PR c++/64356\n+// { dg-do compile { target c++14 } }\n+\n+typedef unsigned long size_t;\n+\n+template<size_t N>\n+constexpr size_t f(const char (&x)[N]) {\n+  size_t s = 0;\n+  for(size_t c : x)\n+    s += c;\n+  return s;\n+}\n+\n+template<size_t N>\n+constexpr size_t g(const char (&x)[N]) {\n+  char y[N] = {0};\n+  for(size_t i = 0; i < N; ++i)\n+    y[i] = x[i];\n+  return f(y);\n+}\n+\n+constexpr auto x = g(__DATE__);"}, {"sha": "8f66cdc389362eae22dde72c2dbd51dc9414c53c", "filename": "gcc/testsuite/g++.dg/cpp1y/pr63996.C", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/caee690e915e13a48a16dabbb61110ae88d1821a/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Fcpp1y%2Fpr63996.C", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/caee690e915e13a48a16dabbb61110ae88d1821a/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Fcpp1y%2Fpr63996.C", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Fcpp1y%2Fpr63996.C?ref=caee690e915e13a48a16dabbb61110ae88d1821a", "patch": "@@ -6,5 +6,5 @@ foo (int i)\n   int a[i] = { }; // { dg-error \"forbids variable length\" }\n }\n \n-constexpr int j = foo (1); // { dg-error \"is not a constant expression\" }\n+constexpr int j = foo (1); // { dg-error \"flows off the end\" }\n "}, {"sha": "d57cf5cf6ebe7b419b3bf1542a1011bfc28293f8", "filename": "libstdc++-v3/testsuite/experimental/optional/constexpr/make_optional.cc", "status": "modified", "additions": 0, "deletions": 3, "changes": 3, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/caee690e915e13a48a16dabbb61110ae88d1821a/libstdc%2B%2B-v3%2Ftestsuite%2Fexperimental%2Foptional%2Fconstexpr%2Fmake_optional.cc", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/caee690e915e13a48a16dabbb61110ae88d1821a/libstdc%2B%2B-v3%2Ftestsuite%2Fexperimental%2Foptional%2Fconstexpr%2Fmake_optional.cc", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libstdc%2B%2B-v3%2Ftestsuite%2Fexperimental%2Foptional%2Fconstexpr%2Fmake_optional.cc?ref=caee690e915e13a48a16dabbb61110ae88d1821a", "patch": "@@ -1,7 +1,4 @@\n // { dg-options \"-std=gnu++14\" }\n-// XFAIL pending resolution of PR libstdc++/58777\n-// { dg-do compile { xfail *-*-* } }\n-// { dg-excess-errors \"\" }\n \n // Copyright (C) 2013-2015 Free Software Foundation, Inc.\n //"}, {"sha": "803927bec05243a7f8b88f6e4e7c8cfc2655076d", "filename": "libstdc++-v3/testsuite/experimental/optional/constexpr/observers/2.cc", "status": "modified", "additions": 0, "deletions": 3, "changes": 3, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/caee690e915e13a48a16dabbb61110ae88d1821a/libstdc%2B%2B-v3%2Ftestsuite%2Fexperimental%2Foptional%2Fconstexpr%2Fobservers%2F2.cc", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/caee690e915e13a48a16dabbb61110ae88d1821a/libstdc%2B%2B-v3%2Ftestsuite%2Fexperimental%2Foptional%2Fconstexpr%2Fobservers%2F2.cc", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libstdc%2B%2B-v3%2Ftestsuite%2Fexperimental%2Foptional%2Fconstexpr%2Fobservers%2F2.cc?ref=caee690e915e13a48a16dabbb61110ae88d1821a", "patch": "@@ -1,7 +1,4 @@\n // { dg-options \"-std=gnu++14\" }\n-// XFAIL pending resolution of PR libstdc++/58777\n-// { dg-do compile { xfail *-*-* } }\n-// { dg-excess-errors \"\" }\n \n // Copyright (C) 2013-2015 Free Software Foundation, Inc.\n //"}, {"sha": "be170f572462fb6c0f08c91d741db7c6a0e69948", "filename": "libstdc++-v3/testsuite/experimental/optional/constexpr/observers/3.cc", "status": "modified", "additions": 0, "deletions": 3, "changes": 3, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/caee690e915e13a48a16dabbb61110ae88d1821a/libstdc%2B%2B-v3%2Ftestsuite%2Fexperimental%2Foptional%2Fconstexpr%2Fobservers%2F3.cc", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/caee690e915e13a48a16dabbb61110ae88d1821a/libstdc%2B%2B-v3%2Ftestsuite%2Fexperimental%2Foptional%2Fconstexpr%2Fobservers%2F3.cc", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libstdc%2B%2B-v3%2Ftestsuite%2Fexperimental%2Foptional%2Fconstexpr%2Fobservers%2F3.cc?ref=caee690e915e13a48a16dabbb61110ae88d1821a", "patch": "@@ -1,7 +1,4 @@\n // { dg-options \"-std=gnu++14\" }\n-// XFAIL pending resolution of PR libstdc++/58777\n-// { dg-do compile { xfail *-*-* } }\n-// { dg-excess-errors \"\" }\n \n // Copyright (C) 2013-2015 Free Software Foundation, Inc.\n //"}]}