{"sha": "26993e95b9e5d4c79ee6c9b16307046383590748", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6MjY5OTNlOTViOWU1ZDRjNzllZTZjOWIxNjMwNzA0NjM4MzU5MDc0OA==", "commit": {"author": {"name": "Richard Biener", "email": "rguenther@suse.de", "date": "2017-09-25T13:19:16Z"}, "committer": {"name": "Richard Biener", "email": "rguenth@gcc.gnu.org", "date": "2017-09-25T13:19:16Z"}, "message": "cfgloop.h (sort_sibling_loops): Declare.\n\n2017-09-25  Richard Biener  <rguenther@suse.de>\n\n\t* cfgloop.h (sort_sibling_loops): Declare.\n\t* cfgloop.c (sort_sibling_loops_cmp): New helper.\n\t(sort_sibling_loops): New function sorting the sibling loop list\n\tin RPO order.\n\t* graphite.c (graphite_transform_loops): Sort sibling loops.\n\nFrom-SVN: r253149", "tree": {"sha": "62988443002b9798950e5d2cb60215d7239a4b6e", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/62988443002b9798950e5d2cb60215d7239a4b6e"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/26993e95b9e5d4c79ee6c9b16307046383590748", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/26993e95b9e5d4c79ee6c9b16307046383590748", "html_url": "https://github.com/Rust-GCC/gccrs/commit/26993e95b9e5d4c79ee6c9b16307046383590748", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/26993e95b9e5d4c79ee6c9b16307046383590748/comments", "author": {"login": "rguenth", "id": 2046526, "node_id": "MDQ6VXNlcjIwNDY1MjY=", "avatar_url": "https://avatars.githubusercontent.com/u/2046526?v=4", "gravatar_id": "", "url": "https://api.github.com/users/rguenth", "html_url": "https://github.com/rguenth", "followers_url": "https://api.github.com/users/rguenth/followers", "following_url": "https://api.github.com/users/rguenth/following{/other_user}", "gists_url": "https://api.github.com/users/rguenth/gists{/gist_id}", "starred_url": "https://api.github.com/users/rguenth/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/rguenth/subscriptions", "organizations_url": "https://api.github.com/users/rguenth/orgs", "repos_url": "https://api.github.com/users/rguenth/repos", "events_url": "https://api.github.com/users/rguenth/events{/privacy}", "received_events_url": "https://api.github.com/users/rguenth/received_events", "type": "User", "site_admin": false}, "committer": null, "parents": [{"sha": "579f368704e340c47957d5fb5aca6ecda6624a69", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/579f368704e340c47957d5fb5aca6ecda6624a69", "html_url": "https://github.com/Rust-GCC/gccrs/commit/579f368704e340c47957d5fb5aca6ecda6624a69"}], "stats": {"total": 62, "additions": 62, "deletions": 0}, "files": [{"sha": "f4060b103bf3353a082e17a16496f2255477dfc7", "filename": "gcc/ChangeLog", "status": "modified", "additions": 8, "deletions": 0, "changes": 8, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/26993e95b9e5d4c79ee6c9b16307046383590748/gcc%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/26993e95b9e5d4c79ee6c9b16307046383590748/gcc%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2FChangeLog?ref=26993e95b9e5d4c79ee6c9b16307046383590748", "patch": "@@ -1,3 +1,11 @@\n+2017-09-25  Richard Biener  <rguenther@suse.de>\n+\n+\t* cfgloop.h (sort_sibling_loops): Declare.\n+\t* cfgloop.c (sort_sibling_loops_cmp): New helper.\n+\t(sort_sibling_loops): New function sorting the sibling loop list\n+\tin RPO order.\n+\t* graphite.c (graphite_transform_loops): Sort sibling loops.\n+\n 2017-09-25  Richard Sandiford  <richard.sandifird@linaro.org>\n \n \t* target.def (vec_perm_const_ok): Change sel parameter to"}, {"sha": "6911426787b1f470119536c56bf75931f7493444", "filename": "gcc/cfgloop.c", "status": "modified", "additions": 52, "deletions": 0, "changes": 52, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/26993e95b9e5d4c79ee6c9b16307046383590748/gcc%2Fcfgloop.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/26993e95b9e5d4c79ee6c9b16307046383590748/gcc%2Fcfgloop.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fcfgloop.c?ref=26993e95b9e5d4c79ee6c9b16307046383590748", "patch": "@@ -521,6 +521,58 @@ flow_loops_find (struct loops *loops)\n   return loops;\n }\n \n+/* qsort helper for sort_sibling_loops.  */\n+\n+static int *sort_sibling_loops_cmp_rpo;\n+static int\n+sort_sibling_loops_cmp (const void *la_, const void *lb_)\n+{\n+  const struct loop *la = *(const struct loop * const *)la_;\n+  const struct loop *lb = *(const struct loop * const *)lb_;\n+  return (sort_sibling_loops_cmp_rpo[la->header->index]\n+\t  - sort_sibling_loops_cmp_rpo[lb->header->index]);\n+}\n+\n+/* Sort sibling loops in RPO order.  */\n+\n+void\n+sort_sibling_loops (function *fn)\n+{\n+  /* Match flow_loops_find in the order we sort sibling loops.  */\n+  sort_sibling_loops_cmp_rpo = XNEWVEC (int, last_basic_block_for_fn (cfun));\n+  int *rc_order = XNEWVEC (int, n_basic_blocks_for_fn (cfun));\n+  pre_and_rev_post_order_compute_fn (fn, NULL, rc_order, false);\n+  for (int i = 0; i < n_basic_blocks_for_fn (cfun) - NUM_FIXED_BLOCKS; ++i)\n+    sort_sibling_loops_cmp_rpo[rc_order[i]] = i;\n+  free (rc_order);\n+\n+  auto_vec<loop_p, 3> siblings;\n+  loop_p loop;\n+  FOR_EACH_LOOP_FN (fn, loop, LI_INCLUDE_ROOT)\n+    if (loop->inner && loop->inner->next)\n+      {\n+\tloop_p sibling = loop->inner;\n+\tdo\n+\t  {\n+\t    siblings.safe_push (sibling);\n+\t    sibling = sibling->next;\n+\t  }\n+\twhile (sibling);\n+\tsiblings.qsort (sort_sibling_loops_cmp);\n+\tloop_p *siblingp = &loop->inner;\n+\tfor (unsigned i = 0; i < siblings.length (); ++i)\n+\t  {\n+\t    *siblingp = siblings[i];\n+\t    siblingp = &(*siblingp)->next;\n+\t  }\n+\t*siblingp = NULL;\n+\tsiblings.truncate (0);\n+      }\n+\n+  free (sort_sibling_loops_cmp_rpo);\n+  sort_sibling_loops_cmp_rpo = NULL;\n+}\n+\n /* Ratio of frequencies of edges so that one of more latch edges is\n    considered to belong to inner loop with same header.  */\n #define HEAVY_EDGE_RATIO 8"}, {"sha": "0b164e97b1f08e8689cfff9fde2cea274b2eb754", "filename": "gcc/cfgloop.h", "status": "modified", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/26993e95b9e5d4c79ee6c9b16307046383590748/gcc%2Fcfgloop.h", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/26993e95b9e5d4c79ee6c9b16307046383590748/gcc%2Fcfgloop.h", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fcfgloop.h?ref=26993e95b9e5d4c79ee6c9b16307046383590748", "patch": "@@ -333,6 +333,7 @@ bool mark_irreducible_loops (void);\n void release_recorded_exits (function *);\n void record_loop_exits (void);\n void rescan_loop_exit (edge, bool, bool);\n+void sort_sibling_loops (function *);\n \n /* Loop data structure manipulation/querying.  */\n extern void flow_loop_tree_node_add (struct loop *, struct loop *);"}, {"sha": "7e6ba5078ecc3d7d96947a7d8fd347fd00b87ad2", "filename": "gcc/graphite.c", "status": "modified", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/26993e95b9e5d4c79ee6c9b16307046383590748/gcc%2Fgraphite.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/26993e95b9e5d4c79ee6c9b16307046383590748/gcc%2Fgraphite.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fgraphite.c?ref=26993e95b9e5d4c79ee6c9b16307046383590748", "patch": "@@ -419,6 +419,7 @@ graphite_transform_loops (void)\n   isl_options_set_on_error (ctx, ISL_ON_ERROR_ABORT);\n   the_isl_ctx = ctx;\n \n+  sort_sibling_loops (cfun);\n   canonicalize_loop_closed_ssa_form ();\n \n   calculate_dominance_info (CDI_POST_DOMINATORS);"}]}