{"sha": "b36cf9d28f68d00e8b24e38a028c8076342b06a6", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6YjM2Y2Y5ZDI4ZjY4ZDAwZThiMjRlMzhhMDI4YzgwNzYzNDJiMDZhNg==", "commit": {"author": {"name": "Michael Meissner", "email": "meissner@linux.vnet.ibm.com", "date": "2010-08-23T16:47:01Z"}, "committer": {"name": "Michael Meissner", "email": "meissner@gcc.gnu.org", "date": "2010-08-23T16:47:01Z"}, "message": "Update to use -mveclibabi=mass instead of -mmass\n\nFrom-SVN: r163471", "tree": {"sha": "75babdfed5a5d5dbf4490f8815f7461775c5339b", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/75babdfed5a5d5dbf4490f8815f7461775c5339b"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/b36cf9d28f68d00e8b24e38a028c8076342b06a6", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/b36cf9d28f68d00e8b24e38a028c8076342b06a6", "html_url": "https://github.com/Rust-GCC/gccrs/commit/b36cf9d28f68d00e8b24e38a028c8076342b06a6", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/b36cf9d28f68d00e8b24e38a028c8076342b06a6/comments", "author": null, "committer": null, "parents": [{"sha": "8bcc030417710a0a30422305c73d2e29b22fadd9", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/8bcc030417710a0a30422305c73d2e29b22fadd9", "html_url": "https://github.com/Rust-GCC/gccrs/commit/8bcc030417710a0a30422305c73d2e29b22fadd9"}], "stats": {"total": 59, "additions": 38, "deletions": 21}, "files": [{"sha": "fb77db6d53f015aa72db30a044a90267210ae7ef", "filename": "gcc/ChangeLog", "status": "modified", "additions": 11, "deletions": 8, "changes": 19, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/b36cf9d28f68d00e8b24e38a028c8076342b06a6/gcc%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/b36cf9d28f68d00e8b24e38a028c8076342b06a6/gcc%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2FChangeLog?ref=b36cf9d28f68d00e8b24e38a028c8076342b06a6", "patch": "@@ -1,15 +1,18 @@\n 2010-08-23  Michael Meissner  <meissner@linux.vnet.ibm.com>\n \n-\t* config/rs6000/rs6000.opt (-mmass): New option to enable the\n-\tcompiler to autovectorize mathmetical functions for power7 using\n-\tthe Mathematical Acceleration Subsystem library.\n-\n-\t* config/rs6000/rs6000.c (rs6000_builtin_vectorized_libmass): New\n-\tfunction to handle auto vectorizing math functions that are in the\n-\tMASS library.\n+\t* config/rs6000/rs6000.opt (-mveclibabi=mass): New option to\n+\tenable the compiler to autovectorize mathmetical functions for\n+\tpower7 using the Mathematical Acceleration Subsystem library.\n+\n+\t* config/rs6000/rs6000.c (rs6000_veclib_handler): New variable to\n+\thandle which vector math library we have.\n+\t(rs6000_override_options): Add -mveclibabi=mass support.\n+\t(rs6000_builtin_vectorized_libmass): New function to handle auto\n+\tvectorizing math functions that are in the MASS library.\n \t(rs6000_builtin_vectorized_function): Call it.\n \n-\t* doc/invoke.texi (RS/6000 and PowerPC Options): Document -mmass.\n+\t* doc/invoke.texi (RS/6000 and PowerPC Options): Document\n+\t-mveclibabi=mass.\n \n 2010-08-22  John David Anglin  <dave.anglin@nrc-cnrc.gc.ca>\n "}, {"sha": "95968a8cd8b2e9dfe255c4d321ed76123c1c722f", "filename": "gcc/config/rs6000/rs6000.c", "status": "modified", "additions": 14, "deletions": 2, "changes": 16, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/b36cf9d28f68d00e8b24e38a028c8076342b06a6/gcc%2Fconfig%2Frs6000%2Frs6000.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/b36cf9d28f68d00e8b24e38a028c8076342b06a6/gcc%2Fconfig%2Frs6000%2Frs6000.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fconfig%2Frs6000%2Frs6000.c?ref=b36cf9d28f68d00e8b24e38a028c8076342b06a6", "patch": "@@ -949,6 +949,9 @@ static const enum rs6000_btc builtin_classify[(int)RS6000_BUILTIN_COUNT] =\n #undef RS6000_BUILTIN\n #undef RS6000_BUILTIN_EQUATE\n \n+/* Support for -mveclibabi=<xxx> to control which vector library to use.  */\n+static tree (*rs6000_veclib_handler) (tree, tree, tree);\n+\n \f\n static bool rs6000_function_ok_for_sibcall (tree, tree);\n static const char *rs6000_invalid_within_doloop (const_rtx);\n@@ -2772,6 +2775,15 @@ rs6000_override_options (const char *default_cpu)\n \t       rs6000_traceback_name);\n     }\n \n+  if (rs6000_veclibabi_name)\n+    {\n+      if (strcmp (rs6000_veclibabi_name, \"mass\") == 0)\n+\trs6000_veclib_handler = rs6000_builtin_vectorized_libmass;\n+      else\n+\terror (\"unknown vectorization library ABI type (%s) for \"\n+\t       \"-mveclibabi= switch\", rs6000_veclibabi_name);\n+    }\n+\n   if (!rs6000_explicit_options.long_double)\n     rs6000_long_double_type_size = RS6000_DEFAULT_LONG_DOUBLE_SIZE;\n \n@@ -3909,8 +3921,8 @@ rs6000_builtin_vectorized_function (tree fndecl, tree type_out,\n     }\n \n   /* Generate calls to libmass if appropriate.  */\n-  if (TARGET_MASS)\n-    return rs6000_builtin_vectorized_libmass (fndecl, type_out, type_in);\n+  if (rs6000_veclib_handler)\n+    return rs6000_veclib_handler (fndecl, type_out, type_in);\n \n   return NULL_TREE;\n }"}, {"sha": "56d68886eafcc46cccecea90940fdeada0ac7e21", "filename": "gcc/config/rs6000/rs6000.opt", "status": "modified", "additions": 3, "deletions": 3, "changes": 6, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/b36cf9d28f68d00e8b24e38a028c8076342b06a6/gcc%2Fconfig%2Frs6000%2Frs6000.opt", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/b36cf9d28f68d00e8b24e38a028c8076342b06a6/gcc%2Fconfig%2Frs6000%2Frs6000.opt", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fconfig%2Frs6000%2Frs6000.opt?ref=b36cf9d28f68d00e8b24e38a028c8076342b06a6", "patch": "@@ -115,9 +115,9 @@ mpopcntd\n Target Report Mask(POPCNTD)\n Use PowerPC V2.06 popcntd instruction\n \n-mmass\n-Target Report Var(TARGET_MASS) Init(0)\n-Use the Mathematical Acceleration Subsystem library high performance math libraries.\n+mveclibabi=\n+Target RejectNegative Joined Var(rs6000_veclibabi_name)\n+Vector library ABI to use\n \n mvsx\n Target Report Mask(VSX)"}, {"sha": "148117da6476360e572b13377ea7b21146b0be1f", "filename": "gcc/doc/invoke.texi", "status": "modified", "additions": 8, "deletions": 7, "changes": 15, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/b36cf9d28f68d00e8b24e38a028c8076342b06a6/gcc%2Fdoc%2Finvoke.texi", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/b36cf9d28f68d00e8b24e38a028c8076342b06a6/gcc%2Fdoc%2Finvoke.texi", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fdoc%2Finvoke.texi?ref=b36cf9d28f68d00e8b24e38a028c8076342b06a6", "patch": "@@ -788,7 +788,7 @@ See RS/6000 and PowerPC Options.\n -msdata=@var{opt}  -mvxworks  -G @var{num}  -pthread @gol\n -mrecip -mrecip=@var{opt} -mno-recip -mrecip-precision\n -mno-recip-precision @gol\n--mmass}\n+-mveclibabi=@var{type}}\n \n @emph{RX Options}\n @gccoptlist{-m64bit-doubles  -m32bit-doubles  -fpu  -nofpu@gol\n@@ -15850,12 +15850,13 @@ precision square root estimate instructions are not generated by\n default on low precision machines, since they do not provide an\n estimate that converges after three steps.\n \n-@item -mmass\n-@itemx -mno-mass\n-@opindex mmass\n-Specifies to use IBM's Mathematical Acceleration Subsystem (MASS)\n-libraries for vectorizing intrinsics using external libraries.  GCC\n-will currently emit calls to @code{acosd2}, @code{acosf4},\n+@item -mveclibabi=@var{type}\n+@opindex mveclibabi\n+Specifies the ABI type to use for vectorizing intrinsics using an\n+external library.  The only type supported at present is @code{mass},\n+which specifies to use IBM's Mathematical Acceleration Subsystem\n+(MASS) libraries for vectorizing intrinsics using external libraries.\n+GCC will currently emit calls to @code{acosd2}, @code{acosf4},\n @code{acoshd2}, @code{acoshf4}, @code{asind2}, @code{asinf4},\n @code{asinhd2}, @code{asinhf4}, @code{atan2d2}, @code{atan2f4},\n @code{atand2}, @code{atanf4}, @code{atanhd2}, @code{atanhf4},"}, {"sha": "2ad04f0c7ea5d989c97f67db1c69b6ca20740345", "filename": "gcc/testsuite/ChangeLog", "status": "modified", "additions": 2, "deletions": 1, "changes": 3, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/b36cf9d28f68d00e8b24e38a028c8076342b06a6/gcc%2Ftestsuite%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/b36cf9d28f68d00e8b24e38a028c8076342b06a6/gcc%2Ftestsuite%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2FChangeLog?ref=b36cf9d28f68d00e8b24e38a028c8076342b06a6", "patch": "@@ -1,6 +1,7 @@\n 2010-08-23  Michael Meissner  <meissner@linux.vnet.ibm.com>\n \n-\t* gcc.target/powerpc/vsx-mass-1.c: New file, test -mmass.\n+\t* gcc.target/powerpc/vsx-mass-1.c: New file, test\n+\t-mveclibabi=mass.\n \n 2010-08-23  Janus Weil  <janus@gcc.gnu.org>\n "}]}