{"sha": "02e819ffd481be3a48701f535e7daad5ddaaae6a", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6MDJlODE5ZmZkNDgxYmUzYTQ4NzAxZjUzNWU3ZGFhZDVkZGFhYWU2YQ==", "commit": {"author": {"name": "Rafael Avila de Espindola", "email": "espindola@google.com", "date": "2009-04-16T14:31:45Z"}, "committer": {"name": "Rafael Espindola", "email": "espindola@gcc.gnu.org", "date": "2009-04-16T14:31:45Z"}, "message": "common.opt (fhelp): Add Var(help_flag).\n\n2009-04-16  Rafael Avila de Espindola  <espindola@google.com>\n\n\t* common.opt (fhelp): Add Var(help_flag).\n\t* gcc-plugin.h (plugin_info): Add help.\n\t* plugin.c (plugin_name_args): Add help.\n\t(register_plugin_info): Set plugin->help.\n\t(print_help_one_plugin): New.\n\t(print_plugins_help): New.\n\t* plugin.h (print_plugins_help): New.\n\t* toplev.c (toplev_main): Call print_plugins_help if needed.\n\nFrom-SVN: r146195", "tree": {"sha": "c6fbd7f9013fa3335143a10692c790200c87a198", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/c6fbd7f9013fa3335143a10692c790200c87a198"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/02e819ffd481be3a48701f535e7daad5ddaaae6a", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/02e819ffd481be3a48701f535e7daad5ddaaae6a", "html_url": "https://github.com/Rust-GCC/gccrs/commit/02e819ffd481be3a48701f535e7daad5ddaaae6a", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/02e819ffd481be3a48701f535e7daad5ddaaae6a/comments", "author": null, "committer": null, "parents": [{"sha": "0455c7f47e493504b31d90195271a52d74099fbe", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/0455c7f47e493504b31d90195271a52d74099fbe", "html_url": "https://github.com/Rust-GCC/gccrs/commit/0455c7f47e493504b31d90195271a52d74099fbe"}], "stats": {"total": 65, "additions": 64, "deletions": 1}, "files": [{"sha": "04eb70a1d361395692be9a56e7909e5953127327", "filename": "gcc/ChangeLog", "status": "modified", "additions": 11, "deletions": 0, "changes": 11, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/02e819ffd481be3a48701f535e7daad5ddaaae6a/gcc%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/02e819ffd481be3a48701f535e7daad5ddaaae6a/gcc%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2FChangeLog?ref=02e819ffd481be3a48701f535e7daad5ddaaae6a", "patch": "@@ -1,3 +1,14 @@\n+2009-04-16  Rafael Avila de Espindola  <espindola@google.com>\n+\n+\t* common.opt (fhelp): Add Var(help_flag).\n+\t* gcc-plugin.h (plugin_info): Add help.\n+\t* plugin.c (plugin_name_args): Add help.\n+\t(register_plugin_info): Set plugin->help.\n+\t(print_help_one_plugin): New.\n+\t(print_plugins_help): New.\n+\t* plugin.h (print_plugins_help): New.\n+\t* toplev.c (toplev_main): Call print_plugins_help if needed.\n+\n 2009-04-16  Richard Guenther  <rguenther@suse.de>\n \n \t* gimple.c (gimple_copy): Do not clear addresses_taken bitmap."}, {"sha": "20dd071cd7cdbb91079ca991b15a3127a4d5c415", "filename": "gcc/common.opt", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/02e819ffd481be3a48701f535e7daad5ddaaae6a/gcc%2Fcommon.opt", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/02e819ffd481be3a48701f535e7daad5ddaaae6a/gcc%2Fcommon.opt", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fcommon.opt?ref=02e819ffd481be3a48701f535e7daad5ddaaae6a", "patch": "@@ -39,7 +39,7 @@ Alias for --help=target\n ;; program's insatiable desire to turn options starting with a\n ;; double dash (--) into options starting with a dash f (-f).\n fhelp\n-Common\n+Common Var(help_flag)\n \n fhelp=\n Common Joined"}, {"sha": "6865566472f20edbc888ac39af4de670ff41b60b", "filename": "gcc/gcc-plugin.h", "status": "modified", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/02e819ffd481be3a48701f535e7daad5ddaaae6a/gcc%2Fgcc-plugin.h", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/02e819ffd481be3a48701f535e7daad5ddaaae6a/gcc%2Fgcc-plugin.h", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fgcc-plugin.h?ref=02e819ffd481be3a48701f535e7daad5ddaaae6a", "patch": "@@ -64,6 +64,7 @@ struct plugin_pass\n struct plugin_info\n {\n   const char *version;\n+  const char *help;\n };\n \n /* Function type for the plugin initialization routine. Each plugin module"}, {"sha": "4d4addd3bd8f77885a48a321a6ed9a4e517d369c", "filename": "gcc/plugin.c", "status": "modified", "additions": 47, "deletions": 0, "changes": 47, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/02e819ffd481be3a48701f535e7daad5ddaaae6a/gcc%2Fplugin.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/02e819ffd481be3a48701f535e7daad5ddaaae6a/gcc%2Fplugin.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fplugin.c?ref=02e819ffd481be3a48701f535e7daad5ddaaae6a", "patch": "@@ -61,6 +61,7 @@ struct plugin_name_args\n   int argc;\n   struct plugin_argument *argv;\n   const char *version;\n+  const char *help;\n };\n \n /* Hash table for the plugin_name_args objects created during command-line\n@@ -461,6 +462,7 @@ register_plugin_info (const char* name, struct plugin_info *info)\n   void **slot = htab_find_slot (plugin_name_args_tab, name, NO_INSERT);\n   struct plugin_name_args *plugin = (struct plugin_name_args *) *slot;\n   plugin->version = info->version;\n+  plugin->help = info->help;\n }\n \n /* Called from the plugin's initialization code. Register a single callback.\n@@ -708,6 +710,51 @@ print_plugins_versions (FILE *file, const char *indent)\n   htab_traverse_noresize (plugin_name_args_tab, print_version_one_plugin, &opt);\n }\n \n+/* Print help for one plugin. SLOT is the hash table slot. DATA is the\n+   argument to htab_traverse_noresize. */\n+\n+static int\n+print_help_one_plugin (void **slot, void *data)\n+{\n+  struct print_options *opt = (struct print_options *) data;\n+  struct plugin_name_args *plugin = (struct plugin_name_args *) *slot;\n+  const char *help = plugin->help ? plugin->help : \"No help available .\";\n+\n+  char *dup = xstrdup (help);\n+  char *p, *nl;\n+  fprintf (opt->file, \" %s%s:\\n\", opt->indent, plugin->base_name);\n+\n+  for (p = nl = dup; nl; p = nl)\n+    {\n+      nl = strchr (nl, '\\n');\n+      if (nl)\n+\t{\n+\t  *nl = '\\0';\n+\t  nl++;\n+\t}\n+      fprintf (opt->file, \"   %s %s\\n\", opt->indent, p);\n+    }\n+\n+  free (dup);\n+  return 1;\n+}\n+\n+/* Print help for each plugin. The output goes to FILE and every line starts\n+   with INDENT. */\n+\n+void\n+print_plugins_help (FILE *file, const char *indent)\n+{\n+  struct print_options opt;\n+  opt.file = file;\n+  opt.indent = indent;\n+  if (!plugin_name_args_tab || htab_elements (plugin_name_args_tab) == 0)\n+    return;\n+\n+  fprintf (file, \"%sHelp for the loaded plugins:\\n\", indent);\n+  htab_traverse_noresize (plugin_name_args_tab, print_help_one_plugin, &opt);\n+}\n+\n \n /* Return true if plugins have been loaded.  */\n "}, {"sha": "c1f566ba80f20795caaca1649ac7eab7fe4e5272", "filename": "gcc/plugin.h", "status": "modified", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/02e819ffd481be3a48701f535e7daad5ddaaae6a/gcc%2Fplugin.h", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/02e819ffd481be3a48701f535e7daad5ddaaae6a/gcc%2Fplugin.h", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fplugin.h?ref=02e819ffd481be3a48701f535e7daad5ddaaae6a", "patch": "@@ -30,6 +30,7 @@ extern bool plugins_active_p (void);\n extern void dump_active_plugins (FILE *);\n extern void debug_active_plugins (void);\n extern void print_plugins_versions (FILE *file, const char *indent);\n+extern void print_plugins_help (FILE *file, const char *indent);\n extern void finalize_plugins (void);\n \n #endif /* PLUGIN_H */"}, {"sha": "0f3d30b3b6331d73a670f8db595d8dfa07b75b8a", "filename": "gcc/toplev.c", "status": "modified", "additions": 3, "deletions": 0, "changes": 3, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/02e819ffd481be3a48701f535e7daad5ddaaae6a/gcc%2Ftoplev.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/02e819ffd481be3a48701f535e7daad5ddaaae6a/gcc%2Ftoplev.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftoplev.c?ref=02e819ffd481be3a48701f535e7daad5ddaaae6a", "patch": "@@ -2279,6 +2279,9 @@ toplev_main (unsigned int argc, const char **argv)\n   if (version_flag)\n     print_version (stderr, \"\");\n \n+  if (help_flag)\n+    print_plugins_help (stderr, \"\");\n+\n   /* Exit early if we can (e.g. -help).  */\n   if (!exit_after_options)\n     do_compile ();"}]}