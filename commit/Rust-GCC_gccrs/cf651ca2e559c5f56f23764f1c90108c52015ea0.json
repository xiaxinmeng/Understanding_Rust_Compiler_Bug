{"sha": "cf651ca2e559c5f56f23764f1c90108c52015ea0", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6Y2Y2NTFjYTJlNTU5YzVmNTZmMjM3NjRmMWM5MDEwOGM1MjAxNWVhMA==", "commit": {"author": {"name": "Tobias Burnus", "email": "burnus@net-b.de", "date": "2011-11-19T09:26:33Z"}, "committer": {"name": "Tobias Burnus", "email": "burnus@gcc.gnu.org", "date": "2011-11-19T09:26:33Z"}, "message": "re PR fortran/51207 ([OOP] Mark __def_init_... as FL_PARAMETER)\n\n2011-11-19  Tobias Burnus  <burnus@net-b.de>\n\n        PR fortran/51207\n        * class.c (gfc_find_derived_vtab): Mark __def_init as PARAMETER\n        and hence as TREE_READONLY; add subroutine attribute to\n        __copy_ procedure.\n\n        PR fortran/50640\n        * trans.h (GFC_DECL_PUSH_TOPLEVEL): New DECL_LANG_FLAG_7.\n        * trans-decl.c (gfc_get_symbol_decl): Mark __def_init and vtab\n        as GFC_DECL_PUSH_TOPLEVEL.\n        (gfc_generate_function_code): If GFC_DECL_PUSH_TOPLEVEL, push it there.\n        (build_function_decl): Push __copy_ procedure to the toplevel.\n\nFrom-SVN: r181505", "tree": {"sha": "03ad52bf6cb39e5e03380e6202c1d82ec366d4bb", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/03ad52bf6cb39e5e03380e6202c1d82ec366d4bb"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/cf651ca2e559c5f56f23764f1c90108c52015ea0", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/cf651ca2e559c5f56f23764f1c90108c52015ea0", "html_url": "https://github.com/Rust-GCC/gccrs/commit/cf651ca2e559c5f56f23764f1c90108c52015ea0", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/cf651ca2e559c5f56f23764f1c90108c52015ea0/comments", "author": {"login": "tob2", "id": 264461, "node_id": "MDQ6VXNlcjI2NDQ2MQ==", "avatar_url": "https://avatars.githubusercontent.com/u/264461?v=4", "gravatar_id": "", "url": "https://api.github.com/users/tob2", "html_url": "https://github.com/tob2", "followers_url": "https://api.github.com/users/tob2/followers", "following_url": "https://api.github.com/users/tob2/following{/other_user}", "gists_url": "https://api.github.com/users/tob2/gists{/gist_id}", "starred_url": "https://api.github.com/users/tob2/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/tob2/subscriptions", "organizations_url": "https://api.github.com/users/tob2/orgs", "repos_url": "https://api.github.com/users/tob2/repos", "events_url": "https://api.github.com/users/tob2/events{/privacy}", "received_events_url": "https://api.github.com/users/tob2/received_events", "type": "User", "site_admin": false}, "committer": null, "parents": [{"sha": "ea5cbe6161d115541b7b1dee24d6f07b269cb1bb", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/ea5cbe6161d115541b7b1dee24d6f07b269cb1bb", "html_url": "https://github.com/Rust-GCC/gccrs/commit/ea5cbe6161d115541b7b1dee24d6f07b269cb1bb"}], "stats": {"total": 30, "additions": 27, "deletions": 3}, "files": [{"sha": "83974b51ca0dd28dde651be30af6279a55457f29", "filename": "gcc/fortran/ChangeLog", "status": "modified", "additions": 14, "deletions": 0, "changes": 14, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/cf651ca2e559c5f56f23764f1c90108c52015ea0/gcc%2Ffortran%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/cf651ca2e559c5f56f23764f1c90108c52015ea0/gcc%2Ffortran%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ffortran%2FChangeLog?ref=cf651ca2e559c5f56f23764f1c90108c52015ea0", "patch": "@@ -1,3 +1,17 @@\n+2011-11-19  Tobias Burnus  <burnus@net-b.de>\n+\n+\tPR fortran/51207\n+\t* class.c (gfc_find_derived_vtab): Mark __def_init as PARAMETER\n+\tand hence as TREE_READONLY; add subroutine attribute to\n+\t__copy_ procedure.\n+\n+\tPR fortran/50640\n+\t* trans.h (GFC_DECL_PUSH_TOPLEVEL): New DECL_LANG_FLAG_7.\n+\t* trans-decl.c (gfc_get_symbol_decl): Mark __def_init and vtab as\n+\tGFC_DECL_PUSH_TOPLEVEL.\n+\t(gfc_generate_function_code): If GFC_DECL_PUSH_TOPLEVEL, push it there.\n+\t(build_function_decl): Push __copy_ procedure to the toplevel.\n+\n 2011-11-16  Tobias Burnus  <burnus@net-b.de>\n \n \tPR fortran/39427"}, {"sha": "bcb2d0b76bcff8385a6895937dd0b6af3ac03f76", "filename": "gcc/fortran/class.c", "status": "modified", "additions": 2, "deletions": 1, "changes": 3, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/cf651ca2e559c5f56f23764f1c90108c52015ea0/gcc%2Ffortran%2Fclass.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/cf651ca2e559c5f56f23764f1c90108c52015ea0/gcc%2Ffortran%2Fclass.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ffortran%2Fclass.c?ref=cf651ca2e559c5f56f23764f1c90108c52015ea0", "patch": "@@ -522,7 +522,7 @@ gfc_find_derived_vtab (gfc_symbol *derived)\n \t\t  def_init->attr.target = 1;\n \t\t  def_init->attr.save = SAVE_IMPLICIT;\n \t\t  def_init->attr.access = ACCESS_PUBLIC;\n-\t\t  def_init->attr.flavor = FL_VARIABLE;\n+\t\t  def_init->attr.flavor = FL_PARAMETER;\n \t\t  gfc_set_sym_referenced (def_init);\n \t\t  def_init->ts.type = BT_DERIVED;\n \t\t  def_init->ts.u.derived = derived;\n@@ -552,6 +552,7 @@ gfc_find_derived_vtab (gfc_symbol *derived)\n \t\t  gfc_get_symbol (name, sub_ns, &copy);\n \t\t  sub_ns->proc_name = copy;\n \t\t  copy->attr.flavor = FL_PROCEDURE;\n+\t\t  copy->attr.subroutine = 1;\n \t\t  copy->attr.if_source = IFSRC_DECL;\n \t\t  if (ns->proc_name->attr.flavor == FL_MODULE)\n \t\t    copy->module = ns->proc_name->name;"}, {"sha": "fc8a9ed4e4bbe9cacbcaff8a67738f199c7bdc22", "filename": "gcc/fortran/trans-decl.c", "status": "modified", "additions": 10, "deletions": 2, "changes": 12, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/cf651ca2e559c5f56f23764f1c90108c52015ea0/gcc%2Ffortran%2Ftrans-decl.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/cf651ca2e559c5f56f23764f1c90108c52015ea0/gcc%2Ffortran%2Ftrans-decl.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ffortran%2Ftrans-decl.c?ref=cf651ca2e559c5f56f23764f1c90108c52015ea0", "patch": "@@ -1471,6 +1471,10 @@ gfc_get_symbol_decl (gfc_symbol * sym)\n       && !sym->attr.proc_pointer)\n     DECL_BY_REFERENCE (decl) = 1;\n \n+  if (sym->attr.vtab\n+      || (sym->name[0] == '_' && strncmp (\"__def_init\", sym->name, 10) == 0))\n+    GFC_DECL_PUSH_TOPLEVEL (decl) = 1;\n+\n   return decl;\n }\n \n@@ -1891,7 +1895,8 @@ build_function_decl (gfc_symbol * sym, bool global)\n   /* Layout the function declaration and put it in the binding level\n      of the current function.  */\n \n-  if (global)\n+  if (global\n+      || (sym->name[0] == '_' && strncmp (\"__copy\", sym->name, 6) == 0))\n     pushdecl_top_level (fndecl);\n   else\n     pushdecl (fndecl);\n@@ -5316,7 +5321,10 @@ gfc_generate_function_code (gfc_namespace * ns)\n \n       next = DECL_CHAIN (decl);\n       DECL_CHAIN (decl) = NULL_TREE;\n-      pushdecl (decl);\n+      if (GFC_DECL_PUSH_TOPLEVEL (decl))\n+\tpushdecl_top_level (decl);\n+      else\n+\tpushdecl (decl);\n       decl = next;\n     }\n   saved_function_decls = NULL_TREE;"}, {"sha": "8fc7599473dc50547303151226b77c11566a8fc6", "filename": "gcc/fortran/trans.h", "status": "modified", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/cf651ca2e559c5f56f23764f1c90108c52015ea0/gcc%2Ffortran%2Ftrans.h", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/cf651ca2e559c5f56f23764f1c90108c52015ea0/gcc%2Ffortran%2Ftrans.h", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ffortran%2Ftrans.h?ref=cf651ca2e559c5f56f23764f1c90108c52015ea0", "patch": "@@ -802,6 +802,7 @@ struct GTY((variable_size)) lang_decl {\n #define GFC_DECL_CRAY_POINTEE(node) DECL_LANG_FLAG_4(node)\n #define GFC_DECL_RESULT(node) DECL_LANG_FLAG_5(node)\n #define GFC_DECL_SUBREF_ARRAY_P(node) DECL_LANG_FLAG_6(node)\n+#define GFC_DECL_PUSH_TOPLEVEL(node) DECL_LANG_FLAG_7(node)\n \n /* An array descriptor.  */\n #define GFC_DESCRIPTOR_TYPE_P(node) TYPE_LANG_FLAG_1(node)"}]}