{"sha": "c4efba1c212b3cc4c3af05a420888b878fcc29ae", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6YzRlZmJhMWMyMTJiM2NjNGMzYWYwNWE0MjA4ODhiODc4ZmNjMjlhZQ==", "commit": {"author": {"name": "Simon Martin", "email": "simartin@users.sourceforge.net", "date": "2009-07-06T04:55:20Z"}, "committer": {"name": "Simon Martin", "email": "simartin@gcc.gnu.org", "date": "2009-07-06T04:55:20Z"}, "message": "re PR c++/40557 (ICE with template union)\n\ngcc/cp/\n\n2009-07-06  Simon Martin  <simartin@users.sourceforge.net>\n\n\tPR c++/40557\n\t* pt.c (perform_typedefs_access_check, get_types_needing_access_check,\n\tappend_type_to_template_for_access_check_1): Use\n\tRECORD_OR_UNION_CODE_P.\n\ngcc/testsuite/\n\n2009-07-06  Simon Martin  <simartin@users.sourceforge.net>\n\n\tPR c++/40557\n\t* g++.dg/template/union2.C: New test.\n\nFrom-SVN: r149276", "tree": {"sha": "8b91a502c4d1053787176cc0bd0f199bd0077f4e", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/8b91a502c4d1053787176cc0bd0f199bd0077f4e"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/c4efba1c212b3cc4c3af05a420888b878fcc29ae", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/c4efba1c212b3cc4c3af05a420888b878fcc29ae", "html_url": "https://github.com/Rust-GCC/gccrs/commit/c4efba1c212b3cc4c3af05a420888b878fcc29ae", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/c4efba1c212b3cc4c3af05a420888b878fcc29ae/comments", "author": {"login": "simartin", "id": 935202, "node_id": "MDQ6VXNlcjkzNTIwMg==", "avatar_url": "https://avatars.githubusercontent.com/u/935202?v=4", "gravatar_id": "", "url": "https://api.github.com/users/simartin", "html_url": "https://github.com/simartin", "followers_url": "https://api.github.com/users/simartin/followers", "following_url": "https://api.github.com/users/simartin/following{/other_user}", "gists_url": "https://api.github.com/users/simartin/gists{/gist_id}", "starred_url": "https://api.github.com/users/simartin/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/simartin/subscriptions", "organizations_url": "https://api.github.com/users/simartin/orgs", "repos_url": "https://api.github.com/users/simartin/repos", "events_url": "https://api.github.com/users/simartin/events{/privacy}", "received_events_url": "https://api.github.com/users/simartin/received_events", "type": "User", "site_admin": false}, "committer": null, "parents": [{"sha": "e2e23550fca10255ad0251e10c53fbeecc8bc057", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/e2e23550fca10255ad0251e10c53fbeecc8bc057", "html_url": "https://github.com/Rust-GCC/gccrs/commit/e2e23550fca10255ad0251e10c53fbeecc8bc057"}], "stats": {"total": 31, "additions": 28, "deletions": 3}, "files": [{"sha": "03a0349960ae2c958fd30eb3e1fdd90a667b79cd", "filename": "gcc/cp/ChangeLog", "status": "modified", "additions": 7, "deletions": 0, "changes": 7, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/c4efba1c212b3cc4c3af05a420888b878fcc29ae/gcc%2Fcp%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/c4efba1c212b3cc4c3af05a420888b878fcc29ae/gcc%2Fcp%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fcp%2FChangeLog?ref=c4efba1c212b3cc4c3af05a420888b878fcc29ae", "patch": "@@ -1,3 +1,10 @@\n+2009-07-06  Simon Martin  <simartin@users.sourceforge.net>\n+\n+\tPR c++/40557\n+\t* pt.c (perform_typedefs_access_check, get_types_needing_access_check,\n+\tappend_type_to_template_for_access_check_1): Use\n+\tRECORD_OR_UNION_CODE_P.\n+\n 2009-07-04  Jason Merrill  <jason@redhat.com>\n \n \t* pt.c (retrieve_specialization): Don't get confused by a"}, {"sha": "f1104e2d737376b8ec7dd59da59dbd0469a3adad", "filename": "gcc/cp/pt.c", "status": "modified", "additions": 4, "deletions": 3, "changes": 7, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/c4efba1c212b3cc4c3af05a420888b878fcc29ae/gcc%2Fcp%2Fpt.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/c4efba1c212b3cc4c3af05a420888b878fcc29ae/gcc%2Fcp%2Fpt.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fcp%2Fpt.c?ref=c4efba1c212b3cc4c3af05a420888b878fcc29ae", "patch": "@@ -7142,7 +7142,7 @@ perform_typedefs_access_check (tree tmpl, tree targs)\n   tree t;\n \n   if (!tmpl\n-      || (TREE_CODE (tmpl) != RECORD_TYPE\n+      || (!RECORD_OR_UNION_CODE_P (TREE_CODE (tmpl))\n \t  && TREE_CODE (tmpl) != FUNCTION_DECL))\n     return;\n \n@@ -17512,7 +17512,8 @@ get_types_needing_access_check (tree t)\n   if (!(ti = get_template_info (t)))\n     return NULL_TREE;\n \n-  if (TREE_CODE (t) == RECORD_TYPE || TREE_CODE (t) == FUNCTION_DECL)\n+  if (RECORD_OR_UNION_CODE_P (TREE_CODE (t))\n+      || TREE_CODE (t) == FUNCTION_DECL)\n     {\n       if (!TI_TEMPLATE (ti))\n \treturn NULL_TREE;\n@@ -17544,7 +17545,7 @@ append_type_to_template_for_access_check_1 (tree t,\n     return;\n \n   gcc_assert ((TREE_CODE (t) == FUNCTION_DECL\n-\t       || TREE_CODE (t) == RECORD_TYPE)\n+\t       || RECORD_OR_UNION_CODE_P (TREE_CODE (t)))\n \t      && type_decl\n \t      && TREE_CODE (type_decl) == TYPE_DECL\n \t      && scope);"}, {"sha": "d4f4d05160fb7e48e7dddf349f9c03b21da6d58a", "filename": "gcc/testsuite/ChangeLog", "status": "modified", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/c4efba1c212b3cc4c3af05a420888b878fcc29ae/gcc%2Ftestsuite%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/c4efba1c212b3cc4c3af05a420888b878fcc29ae/gcc%2Ftestsuite%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2FChangeLog?ref=c4efba1c212b3cc4c3af05a420888b878fcc29ae", "patch": "@@ -1,3 +1,8 @@\n+2009-07-06  Simon Martin  <simartin@users.sourceforge.net>\n+\n+\tPR c++/40557\n+\t* g++.dg/template/union2.C: New test.\n+\n 2009-07-04  Jason Merrill  <jason@redhat.com>\n \n \t* g++.dg/template/using15.C: New."}, {"sha": "9e0666eae57b970d9a5bfb147327a5f15e975614", "filename": "gcc/testsuite/g++.dg/template/union2.C", "status": "added", "additions": 12, "deletions": 0, "changes": 12, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/c4efba1c212b3cc4c3af05a420888b878fcc29ae/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Ftemplate%2Funion2.C", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/c4efba1c212b3cc4c3af05a420888b878fcc29ae/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Ftemplate%2Funion2.C", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Ftemplate%2Funion2.C?ref=c4efba1c212b3cc4c3af05a420888b878fcc29ae", "patch": "@@ -0,0 +1,12 @@\n+/* PR c++/40557 */\n+/* { dg-do \"compile\" } */\n+\n+struct A\n+{\n+  typedef int X;\n+};\n+\n+template<int> union B\n+{\n+  A::X x;\n+};"}]}