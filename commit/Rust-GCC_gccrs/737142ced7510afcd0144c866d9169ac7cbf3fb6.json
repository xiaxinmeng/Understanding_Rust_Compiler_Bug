{"sha": "737142ced7510afcd0144c866d9169ac7cbf3fb6", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6NzM3MTQyY2VkNzUxMGFmY2QwMTQ0Yzg2NmQ5MTY5YWM3Y2JmM2ZiNg==", "commit": {"author": {"name": "Andrew Pinski", "email": "andrew_pinski@playstation.sony.com", "date": "2009-06-12T19:00:39Z"}, "committer": {"name": "Andrew Pinski", "email": "pinskia@gcc.gnu.org", "date": "2009-06-12T19:00:39Z"}, "message": "re PR tree-optimization/38865 (missing FRE with VIEW_CONVERT_EXPR)\n\n2009-06-12  Andrew Pinski  <andrew_pinski@playstation.sony.com>\n\n        PR tree-opt/38865\n        * tree-ssa-sccvn.c (visit_reference_op_load): If vn_reference_lookup\n        is returns NULL and OP is a VCE, look through the VCE.\n\n\n\n2009-06-12  Andrew Pinski  <andrew_pinski@playstation.sony.com>\n\n        PR tree-opt/38865\n        * gcc.dg/tree-ssa/fre-vce-1.c\n:\n\nFrom-SVN: r148437", "tree": {"sha": "ce8fe06a4a5b43d55c7335eddbcf12d9026c27d4", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/ce8fe06a4a5b43d55c7335eddbcf12d9026c27d4"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/737142ced7510afcd0144c866d9169ac7cbf3fb6", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/737142ced7510afcd0144c866d9169ac7cbf3fb6", "html_url": "https://github.com/Rust-GCC/gccrs/commit/737142ced7510afcd0144c866d9169ac7cbf3fb6", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/737142ced7510afcd0144c866d9169ac7cbf3fb6/comments", "author": null, "committer": null, "parents": [{"sha": "d3a0d55d663e3837aaba816af1aabf983df0ffab", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/d3a0d55d663e3837aaba816af1aabf983df0ffab", "html_url": "https://github.com/Rust-GCC/gccrs/commit/d3a0d55d663e3837aaba816af1aabf983df0ffab"}], "stats": {"total": 52, "additions": 52, "deletions": 0}, "files": [{"sha": "2e8f5ebcca2901d5b9ddfa78beacc8456a9ca13e", "filename": "gcc/ChangeLog", "status": "modified", "additions": 6, "deletions": 0, "changes": 6, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/737142ced7510afcd0144c866d9169ac7cbf3fb6/gcc%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/737142ced7510afcd0144c866d9169ac7cbf3fb6/gcc%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2FChangeLog?ref=737142ced7510afcd0144c866d9169ac7cbf3fb6", "patch": "@@ -1,3 +1,9 @@\n+2009-06-12  Andrew Pinski  <andrew_pinski@playstation.sony.com>\n+\n+\tPR tree-opt/38865\n+\t* tree-ssa-sccvn.c (visit_reference_op_load): If vn_reference_lookup\n+\tis returns NULL and OP is a VCE, look through the VCE.\n+\n 2009-06-12  Ian Lance Taylor  <iant@google.com>\n \n \tPR bootstrap/40430"}, {"sha": "8c218933be25625d2f98daac9da5d7b071297b43", "filename": "gcc/testsuite/ChangeLog", "status": "modified", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/737142ced7510afcd0144c866d9169ac7cbf3fb6/gcc%2Ftestsuite%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/737142ced7510afcd0144c866d9169ac7cbf3fb6/gcc%2Ftestsuite%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2FChangeLog?ref=737142ced7510afcd0144c866d9169ac7cbf3fb6", "patch": "@@ -1,3 +1,8 @@\n+2009-06-12  Andrew Pinski  <andrew_pinski@playstation.sony.com>\n+\n+\tPR tree-opt/38865\n+\t* gcc.dg/tree-ssa/fre-vce-1.c\n+\n 2009-06-12  H.J. Lu  <hongjiu.lu@intel.com>\n \n \tPR testsuite/40384"}, {"sha": "f8c12c8d6c573bc675b8a7fe78339dc9db19789b", "filename": "gcc/testsuite/gcc.dg/tree-ssa/fre-vce-1.c", "status": "added", "additions": 35, "deletions": 0, "changes": 35, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/737142ced7510afcd0144c866d9169ac7cbf3fb6/gcc%2Ftestsuite%2Fgcc.dg%2Ftree-ssa%2Ffre-vce-1.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/737142ced7510afcd0144c866d9169ac7cbf3fb6/gcc%2Ftestsuite%2Fgcc.dg%2Ftree-ssa%2Ffre-vce-1.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgcc.dg%2Ftree-ssa%2Ffre-vce-1.c?ref=737142ced7510afcd0144c866d9169ac7cbf3fb6", "patch": "@@ -0,0 +1,35 @@\n+/* { dg-options \"-O2 -fdump-tree-fre -w\" } */\n+/* { dg-do compile } */\n+#define vector __attribute__((vector_size(sizeof(int)*4) ))\n+struct s { vector int i; };\n+vector float f(struct s *sv)\n+{\n+  sv->i = (vector int){1, 2, 3, 4};\n+  return (vector float)sv->i;\n+}\n+\n+\n+vector float f1(struct s *sv, vector int a)\n+{\n+  sv->i = a;\n+  return (vector float)sv->i;\n+}\n+\n+struct s1 { int i; };\n+\n+void g(struct s1 *, float);\n+void a1 (struct s1 sv)\n+{\n+  sv.i = 1;\n+  g(&sv, *(float*)&sv.i);\n+}\n+\n+\n+void a2 (struct s1 sv, int i)\n+{\n+  sv.i = i;\n+  g(&sv, *(float*)&sv.i);\n+}\n+\n+/* { dg-final { scan-tree-dump-times \"sv_\\[0-9\\]\\\\\\(D\\\\\\)->i\" 2 \"fre\" } } */\n+/* { dg-final { scan-tree-dump-times \"sv.i\" 2 \"fre\" } } */"}, {"sha": "6d263ded1775fe7840ebb9d1cbfa508b53cecd73", "filename": "gcc/tree-ssa-sccvn.c", "status": "modified", "additions": 6, "deletions": 0, "changes": 6, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/737142ced7510afcd0144c866d9169ac7cbf3fb6/gcc%2Ftree-ssa-sccvn.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/737142ced7510afcd0144c866d9169ac7cbf3fb6/gcc%2Ftree-ssa-sccvn.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftree-ssa-sccvn.c?ref=737142ced7510afcd0144c866d9169ac7cbf3fb6", "patch": "@@ -1976,6 +1976,12 @@ visit_reference_op_load (tree lhs, tree op, gimple stmt)\n   bool changed = false;\n   tree result = vn_reference_lookup (op, gimple_vuse (stmt), true, NULL);\n \n+  /* If we have a VCE, try looking up its operand as it might be stored in\n+     a different type.  */\n+  if (!result && TREE_CODE (op) == VIEW_CONVERT_EXPR)\n+    result = vn_reference_lookup (TREE_OPERAND (op, 0), gimple_vuse (stmt),\n+    \t\t\t\t  true, NULL);\n+\n   /* We handle type-punning through unions by value-numbering based\n      on offset and size of the access.  Be prepared to handle a\n      type-mismatch here via creating a VIEW_CONVERT_EXPR.  */"}]}