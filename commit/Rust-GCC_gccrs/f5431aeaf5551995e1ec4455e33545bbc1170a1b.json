{"sha": "f5431aeaf5551995e1ec4455e33545bbc1170a1b", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6ZjU0MzFhZWFmNTU1MTk5NWUxZWM0NDU1ZTMzNTQ1YmJjMTE3MGExYg==", "commit": {"author": {"name": "Nikhil Benesch", "email": "nikhil.benesch@gmail.com", "date": "2020-10-05T03:40:40Z"}, "committer": {"name": "Ian Lance Taylor", "email": "iant@golang.org", "date": "2020-10-06T20:53:42Z"}, "message": "compiler: avoid undefined behavior in Import::read\n\nFor some implementations of Stream, advancing the stream will invalidate\nthe previously-returned peek buffer. Copy the peek buffer before\nadvancing in Import::read to avoid this undefined behavior.\n\nReviewed-on: https://go-review.googlesource.com/c/gofrontend/+/259438", "tree": {"sha": "b86130cccc5ee6c5698061672064106be54aa590", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/b86130cccc5ee6c5698061672064106be54aa590"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/f5431aeaf5551995e1ec4455e33545bbc1170a1b", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/f5431aeaf5551995e1ec4455e33545bbc1170a1b", "html_url": "https://github.com/Rust-GCC/gccrs/commit/f5431aeaf5551995e1ec4455e33545bbc1170a1b", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/f5431aeaf5551995e1ec4455e33545bbc1170a1b/comments", "author": {"login": "benesch", "id": 882976, "node_id": "MDQ6VXNlcjg4Mjk3Ng==", "avatar_url": "https://avatars.githubusercontent.com/u/882976?v=4", "gravatar_id": "", "url": "https://api.github.com/users/benesch", "html_url": "https://github.com/benesch", "followers_url": "https://api.github.com/users/benesch/followers", "following_url": "https://api.github.com/users/benesch/following{/other_user}", "gists_url": "https://api.github.com/users/benesch/gists{/gist_id}", "starred_url": "https://api.github.com/users/benesch/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/benesch/subscriptions", "organizations_url": "https://api.github.com/users/benesch/orgs", "repos_url": "https://api.github.com/users/benesch/repos", "events_url": "https://api.github.com/users/benesch/events{/privacy}", "received_events_url": "https://api.github.com/users/benesch/received_events", "type": "User", "site_admin": false}, "committer": {"login": "ianlancetaylor", "id": 3194333, "node_id": "MDQ6VXNlcjMxOTQzMzM=", "avatar_url": "https://avatars.githubusercontent.com/u/3194333?v=4", "gravatar_id": "", "url": "https://api.github.com/users/ianlancetaylor", "html_url": "https://github.com/ianlancetaylor", "followers_url": "https://api.github.com/users/ianlancetaylor/followers", "following_url": "https://api.github.com/users/ianlancetaylor/following{/other_user}", "gists_url": "https://api.github.com/users/ianlancetaylor/gists{/gist_id}", "starred_url": "https://api.github.com/users/ianlancetaylor/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/ianlancetaylor/subscriptions", "organizations_url": "https://api.github.com/users/ianlancetaylor/orgs", "repos_url": "https://api.github.com/users/ianlancetaylor/repos", "events_url": "https://api.github.com/users/ianlancetaylor/events{/privacy}", "received_events_url": "https://api.github.com/users/ianlancetaylor/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "fcae5121154d1c3382b056bcc2c563cedac28e74", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/fcae5121154d1c3382b056bcc2c563cedac28e74", "html_url": "https://github.com/Rust-GCC/gccrs/commit/fcae5121154d1c3382b056bcc2c563cedac28e74"}], "stats": {"total": 21, "additions": 11, "deletions": 10}, "files": [{"sha": "c5c02aa2392bedc140c9f752aae9d8eaef1af80d", "filename": "gcc/go/gofrontend/MERGE", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/f5431aeaf5551995e1ec4455e33545bbc1170a1b/gcc%2Fgo%2Fgofrontend%2FMERGE", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/f5431aeaf5551995e1ec4455e33545bbc1170a1b/gcc%2Fgo%2Fgofrontend%2FMERGE", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fgo%2Fgofrontend%2FMERGE?ref=f5431aeaf5551995e1ec4455e33545bbc1170a1b", "patch": "@@ -1,4 +1,4 @@\n-d00febdab0535546ccbf1ef634be1f23b09c8b77\n+613e530547549f4220c4571ea913acbe5fa56f72\n \n The first line of this file holds the git revision number of the last\n merge done from the gofrontend repository."}, {"sha": "f40f13129e6988ab7a4151795182df6a947272c6", "filename": "gcc/go/gofrontend/gogo.cc", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/f5431aeaf5551995e1ec4455e33545bbc1170a1b/gcc%2Fgo%2Fgofrontend%2Fgogo.cc", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/f5431aeaf5551995e1ec4455e33545bbc1170a1b/gcc%2Fgo%2Fgofrontend%2Fgogo.cc", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fgo%2Fgofrontend%2Fgogo.cc?ref=f5431aeaf5551995e1ec4455e33545bbc1170a1b", "patch": "@@ -6212,7 +6212,7 @@ Function::import_func(Import* imp, std::string* pname,\n \t  return false;\n \t}\n \n-      *body = imp->read(static_cast<size_t>(llen));\n+      imp->read(static_cast<size_t>(llen), body);\n     }\n \n   return true;"}, {"sha": "c6c1178bc2484f74a52cdf6cdd50bd85030066a5", "filename": "gcc/go/gofrontend/import.cc", "status": "modified", "additions": 5, "deletions": 4, "changes": 9, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/f5431aeaf5551995e1ec4455e33545bbc1170a1b/gcc%2Fgo%2Fgofrontend%2Fimport.cc", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/f5431aeaf5551995e1ec4455e33545bbc1170a1b/gcc%2Fgo%2Fgofrontend%2Fimport.cc", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fgo%2Fgofrontend%2Fimport.cc?ref=f5431aeaf5551995e1ec4455e33545bbc1170a1b", "patch": "@@ -1375,8 +1375,8 @@ Import::read_name()\n \n // Read LENGTH bytes from the stream.\n \n-std::string\n-Import::read(size_t length)\n+void\n+Import::read(size_t length, std::string* out)\n {\n   const char* data;\n   if (!this->stream_->peek(length, &data))\n@@ -1385,10 +1385,11 @@ Import::read(size_t length)\n \tgo_error_at(this->location_, \"import error at %d: expected %d bytes\",\n \t\t    this->stream_->pos(), static_cast<int>(length));\n       this->stream_->set_saw_error();\n-      return \"\";\n+      *out = std::string(\"\");\n+      return;\n     }\n+  *out = std::string(data, length);\n   this->advance(length);\n-  return std::string(data, length);\n }\n \n // Turn a string into a integer with appropriate error handling."}, {"sha": "1d8aae493f2f6a780385bbbe7ed032afa2d5ea16", "filename": "gcc/go/gofrontend/import.h", "status": "modified", "additions": 4, "deletions": 4, "changes": 8, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/f5431aeaf5551995e1ec4455e33545bbc1170a1b/gcc%2Fgo%2Fgofrontend%2Fimport.h", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/f5431aeaf5551995e1ec4455e33545bbc1170a1b/gcc%2Fgo%2Fgofrontend%2Fimport.h", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fgo%2Fgofrontend%2Fimport.h?ref=f5431aeaf5551995e1ec4455e33545bbc1170a1b", "patch": "@@ -240,10 +240,10 @@ class Import : public Import_expression\n   get_char()\n   { return this->stream_->get_char(); }\n \n-  // Read LENGTH characters into a string and advance past them.  On\n-  // EOF reports an error and returns an empty string.\n-  std::string\n-  read(size_t length);\n+  // Read LENGTH characters into *OUT and advance past them.  On\n+  // EOF reports an error and sets *OUT to an empty string.\n+  void\n+  read(size_t length, std::string* out);\n \n   // Return true at the end of the stream.\n   bool"}]}