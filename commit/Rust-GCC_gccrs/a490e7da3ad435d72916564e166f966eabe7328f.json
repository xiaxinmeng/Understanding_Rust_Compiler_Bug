{"sha": "a490e7da3ad435d72916564e166f966eabe7328f", "node_id": "C_kwDOANBUbNoAKGE0OTBlN2RhM2FkNDM1ZDcyOTE2NTY0ZTE2NmY5NjZlYWJlNzMyOGY", "commit": {"author": {"name": "Piotr Trojanek", "email": "trojanek@adacore.com", "date": "2022-09-14T19:59:05Z"}, "committer": {"name": "Marc Poulhi\u00e8s", "email": "poulhies@adacore.com", "date": "2022-09-26T09:02:31Z"}, "message": "ada: Fix location of pragmas coming from aspects in top-level instances\n\nThis patch fixes an AST anomaly where pragmas that correspond to aspects\nof a generic package declaration appeared as the auxiliary declarations\nof the compilation unit for the instantiated package body.\n\nIn particular, this anomaly happened for aspect Annotate and affected\nGNATprove, which didn't pick pragma corresponding to this aspect.\n\ngcc/ada/\n\n\t* sem_ch12.adb (Build_Instance_Compilation_Unit_Nodes): Relocate\n\tauxiliary declarations from the original compilation unit to the\n\tnewly created compilation unit for the spec.", "tree": {"sha": "559034c26846d37f728a42e67f38e627bbfaf519", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/559034c26846d37f728a42e67f38e627bbfaf519"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/a490e7da3ad435d72916564e166f966eabe7328f", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/a490e7da3ad435d72916564e166f966eabe7328f", "html_url": "https://github.com/Rust-GCC/gccrs/commit/a490e7da3ad435d72916564e166f966eabe7328f", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/a490e7da3ad435d72916564e166f966eabe7328f/comments", "author": {"login": "ptroja", "id": 161602, "node_id": "MDQ6VXNlcjE2MTYwMg==", "avatar_url": "https://avatars.githubusercontent.com/u/161602?v=4", "gravatar_id": "", "url": "https://api.github.com/users/ptroja", "html_url": "https://github.com/ptroja", "followers_url": "https://api.github.com/users/ptroja/followers", "following_url": "https://api.github.com/users/ptroja/following{/other_user}", "gists_url": "https://api.github.com/users/ptroja/gists{/gist_id}", "starred_url": "https://api.github.com/users/ptroja/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/ptroja/subscriptions", "organizations_url": "https://api.github.com/users/ptroja/orgs", "repos_url": "https://api.github.com/users/ptroja/repos", "events_url": "https://api.github.com/users/ptroja/events{/privacy}", "received_events_url": "https://api.github.com/users/ptroja/received_events", "type": "User", "site_admin": false}, "committer": {"login": "dkm", "id": 87603, "node_id": "MDQ6VXNlcjg3NjAz", "avatar_url": "https://avatars.githubusercontent.com/u/87603?v=4", "gravatar_id": "", "url": "https://api.github.com/users/dkm", "html_url": "https://github.com/dkm", "followers_url": "https://api.github.com/users/dkm/followers", "following_url": "https://api.github.com/users/dkm/following{/other_user}", "gists_url": "https://api.github.com/users/dkm/gists{/gist_id}", "starred_url": "https://api.github.com/users/dkm/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/dkm/subscriptions", "organizations_url": "https://api.github.com/users/dkm/orgs", "repos_url": "https://api.github.com/users/dkm/repos", "events_url": "https://api.github.com/users/dkm/events{/privacy}", "received_events_url": "https://api.github.com/users/dkm/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "756efb7484f4bbdc74dd9c285fff5c5d4a0730ff", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/756efb7484f4bbdc74dd9c285fff5c5d4a0730ff", "html_url": "https://github.com/Rust-GCC/gccrs/commit/756efb7484f4bbdc74dd9c285fff5c5d4a0730ff"}], "stats": {"total": 7, "additions": 5, "deletions": 2}, "files": [{"sha": "ab2e182567986130c46e5d88360ade78bc7fbf9f", "filename": "gcc/ada/sem_ch12.adb", "status": "modified", "additions": 5, "deletions": 2, "changes": 7, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/a490e7da3ad435d72916564e166f966eabe7328f/gcc%2Fada%2Fsem_ch12.adb", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/a490e7da3ad435d72916564e166f966eabe7328f/gcc%2Fada%2Fsem_ch12.adb", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fada%2Fsem_ch12.adb?ref=a490e7da3ad435d72916564e166f966eabe7328f", "patch": "@@ -6296,13 +6296,16 @@ package body Sem_Ch12 is\n       Old_Main   : constant Entity_Id := Cunit_Entity (Main_Unit);\n \n    begin\n-      --  A new compilation unit node is built for the instance declaration\n+      --  A new compilation unit node is built for the instance declaration.\n+      --  It relocates the auxiliary declaration node from the compilation unit\n+      --  where the instance appeared, so that declarations that originally\n+      --  followed the instance will be attached to the spec compilation unit.\n \n       Decl_Cunit :=\n         Make_Compilation_Unit (Sloc (N),\n           Context_Items  => Empty_List,\n           Unit           => Act_Decl,\n-          Aux_Decls_Node => Make_Compilation_Unit_Aux (Sloc (N)));\n+          Aux_Decls_Node => Relocate_Node (Aux_Decls_Node (Parent (N))));\n \n       Set_Parent_Spec (Act_Decl, Parent_Spec (N));\n "}]}