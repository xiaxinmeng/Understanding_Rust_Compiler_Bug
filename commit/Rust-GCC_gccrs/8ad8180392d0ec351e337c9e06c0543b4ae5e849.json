{"sha": "8ad8180392d0ec351e337c9e06c0543b4ae5e849", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6OGFkODE4MDM5MmQwZWMzNTFlMzM3YzllMDZjMDU0M2I0YWU1ZTg0OQ==", "commit": {"author": {"name": "Eric Botcazou", "email": "ebotcazou@adacore.com", "date": "2019-07-01T16:26:38Z"}, "committer": {"name": "Eric Botcazou", "email": "ebotcazou@gcc.gnu.org", "date": "2019-07-01T16:26:38Z"}, "message": "re PR middle-end/64242 (Longjmp expansion incorrect)\n\n\tPR middle-end/64242\n\t* config/sparc/sparc.md (nonlocal_goto): Restore frame pointer last.\n\tAdd frame clobber and schedule blockage.\n\nFrom-SVN: r272889", "tree": {"sha": "eb94b6a78318399ce765ae0e5e04177747f0136e", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/eb94b6a78318399ce765ae0e5e04177747f0136e"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/8ad8180392d0ec351e337c9e06c0543b4ae5e849", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/8ad8180392d0ec351e337c9e06c0543b4ae5e849", "html_url": "https://github.com/Rust-GCC/gccrs/commit/8ad8180392d0ec351e337c9e06c0543b4ae5e849", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/8ad8180392d0ec351e337c9e06c0543b4ae5e849/comments", "author": null, "committer": null, "parents": [{"sha": "2d526072efb83eacfe0695794f36eb89d260b453", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/2d526072efb83eacfe0695794f36eb89d260b453", "html_url": "https://github.com/Rust-GCC/gccrs/commit/2d526072efb83eacfe0695794f36eb89d260b453"}], "stats": {"total": 24, "additions": 19, "deletions": 5}, "files": [{"sha": "5072232ae41df6b7af657c5290370fe9ad95fb06", "filename": "gcc/ChangeLog", "status": "modified", "additions": 6, "deletions": 0, "changes": 6, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/8ad8180392d0ec351e337c9e06c0543b4ae5e849/gcc%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/8ad8180392d0ec351e337c9e06c0543b4ae5e849/gcc%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2FChangeLog?ref=8ad8180392d0ec351e337c9e06c0543b4ae5e849", "patch": "@@ -1,3 +1,9 @@\n+2019-07-01  Eric Botcazou  <ebotcazou@adacore.com>\n+\n+\tPR middle-end/64242\n+\t* config/sparc/sparc.md (nonlocal_goto): Restore frame pointer last.\n+\tAdd frame clobber and schedule blockage.\n+\n 2019-07-01  Sandra Loosemore  <sandra@codesourcery.com>\n \n \t* doc/invoke.texi (Link Options): Further editorial changes to"}, {"sha": "7af62d599b974def980362a6e3aadf870cc3bc1d", "filename": "gcc/config/sparc/sparc.md", "status": "modified", "additions": 13, "deletions": 5, "changes": 18, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/8ad8180392d0ec351e337c9e06c0543b4ae5e849/gcc%2Fconfig%2Fsparc%2Fsparc.md", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/8ad8180392d0ec351e337c9e06c0543b4ae5e849/gcc%2Fconfig%2Fsparc%2Fsparc.md", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fconfig%2Fsparc%2Fsparc.md?ref=8ad8180392d0ec351e337c9e06c0543b4ae5e849", "patch": "@@ -7381,7 +7381,7 @@ visl\")\n   \"\"\n {\n   rtx i7 = gen_rtx_REG (Pmode, RETURN_ADDR_REGNUM);\n-  rtx r_label = copy_to_reg (operands[1]);\n+  rtx r_label = operands[1];\n   rtx r_sp = adjust_address (operands[2], Pmode, 0);\n   rtx r_fp = operands[3];\n   rtx r_i7 = adjust_address (operands[2], Pmode, GET_MODE_SIZE (Pmode));\n@@ -7394,9 +7394,18 @@ visl\")\n   emit_clobber (gen_rtx_MEM (BLKmode, gen_rtx_SCRATCH (VOIDmode)));\n   emit_clobber (gen_rtx_MEM (BLKmode, hard_frame_pointer_rtx));\n \n-  /* Restore frame pointer for containing function.  */\n-  emit_move_insn (hard_frame_pointer_rtx, r_fp);\n+  r_label = copy_to_reg (r_label);\n+\n+  /* Restore the frame pointer and stack pointer.  We must use a\n+     temporary since the setjmp buffer may be a local.  */\n+  r_fp = copy_to_reg (r_fp);\n   emit_stack_restore (SAVE_NONLOCAL, r_sp);\n+  r_i7 = copy_to_reg (r_i7);\n+\n+  /* Ensure the frame pointer move is not optimized.  */\n+  emit_insn (gen_blockage ());\n+  emit_clobber (hard_frame_pointer_rtx);\n+  emit_move_insn (hard_frame_pointer_rtx, r_fp);\n   emit_move_insn (i7, r_i7);\n \n   /* USE of hard_frame_pointer_rtx added for consistency;\n@@ -7405,8 +7414,7 @@ visl\")\n   emit_use (stack_pointer_rtx);\n   emit_use (i7);\n \n-  emit_jump_insn (gen_indirect_jump (r_label));\n-  emit_barrier ();\n+  emit_indirect_jump (r_label);\n   DONE;\n })\n "}]}