{"sha": "dc718e52b96bde01a6095f8319c3a0191bff65a3", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6ZGM3MThlNTJiOTZiZGUwMWE2MDk1ZjgzMTljM2EwMTkxYmZmNjVhMw==", "commit": {"author": {"name": "Robert Dewar", "email": "dewar@adacore.com", "date": "2010-10-26T13:17:23Z"}, "committer": {"name": "Arnaud Charlet", "email": "charlet@gcc.gnu.org", "date": "2010-10-26T13:17:23Z"}, "message": "opt.ads: Move documentation on checksum stuff here from prj-nmsc\n\n2010-10-26  Robert Dewar  <dewar@adacore.com>\n\n\t* opt.ads: Move documentation on checksum stuff here from prj-nmsc\n\t* prj-nmsc.adb (Process_Project_Level_Array_Attributes): Move\n\tdocumentation on checksum versions to opt.ads.\n\nFrom-SVN: r165962", "tree": {"sha": "466f5fb04a37f7d7c9a58c69639e6a947c91bcc8", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/466f5fb04a37f7d7c9a58c69639e6a947c91bcc8"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/dc718e52b96bde01a6095f8319c3a0191bff65a3", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/dc718e52b96bde01a6095f8319c3a0191bff65a3", "html_url": "https://github.com/Rust-GCC/gccrs/commit/dc718e52b96bde01a6095f8319c3a0191bff65a3", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/dc718e52b96bde01a6095f8319c3a0191bff65a3/comments", "author": null, "committer": null, "parents": [{"sha": "b251750b22953106e31f33f86b6ff064f6a1b204", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/b251750b22953106e31f33f86b6ff064f6a1b204", "html_url": "https://github.com/Rust-GCC/gccrs/commit/b251750b22953106e31f33f86b6ff064f6a1b204"}], "stats": {"total": 133, "additions": 73, "deletions": 60}, "files": [{"sha": "59e34b36db46dd326a98fe4f147ac5b0980cc3e8", "filename": "gcc/ada/ChangeLog", "status": "modified", "additions": 6, "deletions": 0, "changes": 6, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/dc718e52b96bde01a6095f8319c3a0191bff65a3/gcc%2Fada%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/dc718e52b96bde01a6095f8319c3a0191bff65a3/gcc%2Fada%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fada%2FChangeLog?ref=dc718e52b96bde01a6095f8319c3a0191bff65a3", "patch": "@@ -1,3 +1,9 @@\n+2010-10-26  Robert Dewar  <dewar@adacore.com>\n+\n+\t* opt.ads: Move documentation on checksum stuff here from prj-nmsc\n+\t* prj-nmsc.adb (Process_Project_Level_Array_Attributes): Move\n+\tdocumentation on checksum versions to opt.ads.\n+\n 2010-10-26  Vincent Celier  <celier@adacore.com>\n \n \t* opt.ads (Checksum_Accumulate_Token_Checksum): New Boolean flag,"}, {"sha": "24df38cd2af7e2be5aeeaf52eafa7d7cb452ea25", "filename": "gcc/ada/opt.ads", "status": "modified", "additions": 50, "deletions": 20, "changes": 70, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/dc718e52b96bde01a6095f8319c3a0191bff65a3/gcc%2Fada%2Fopt.ads", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/dc718e52b96bde01a6095f8319c3a0191bff65a3/gcc%2Fada%2Fopt.ads", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fada%2Fopt.ads?ref=dc718e52b96bde01a6095f8319c3a0191bff65a3", "patch": "@@ -49,6 +49,56 @@ pragma Warnings (On);\n \n package Opt is\n \n+   ----------------------\n+   -- Checksum Control --\n+   ----------------------\n+\n+   --  Checksums are computed for sources to check for sources being the same\n+   --  from a compilation point of view (e.g. spelling of identifiers and\n+   --  white space layout do not count in this computation).\n+\n+   --  The way the checksum is computed has evolved across the various versions\n+   --  of GNAT. When gprbuild is called with -m, the checksums must be computed\n+   --  the same way in gprbuild as it was in the GNAT version of the compiler.\n+   --  The different ways are\n+\n+   --    Version 6.4 and later:\n+\n+   --      The Accumulate_Token_Checksum procedure is called after each numeric\n+   --      literal and each identifier/keyword. For keywords, Tok_Identifier is\n+   --      used in the call to Accumulate_Token_Checksum.\n+\n+   --    Versions 5.04 to 6.3:\n+\n+   --      For keywords, the token value were used in the call to procedure\n+   --      Accumulate_Token_Checksum. Type Token_Type did not include Tok_Some.\n+\n+   --    Versions 5.03:\n+\n+   --      For keywords, the token value were used in the call to\n+   --      Accumulate_Token_Checksum. Type Token_Type did not include\n+   --      Tok_Interface, Tok_Overriding, Tok_Synchronized and Tok_Some.\n+\n+   --    Versions 5.02 and before:\n+\n+   --      No calls to procedure Accumulate_Token_Checksum (the checksum\n+   --      mechanism was introduced in version 5.03).\n+\n+   --  To signal to the scanner whether Accumulate_Token_Checksum needs to be\n+   --  called and what versions to call, the following Boolean flags are used:\n+\n+   Checksum_Accumulate_Token_Checksum : Boolean := True;\n+   --  GPRBUILD\n+   --  Set to False by gprbuild when the version of GNAT is 5.02 or before.\n+\n+   Checksum_GNAT_6_3 : Boolean := False;\n+   --  GPRBUILD\n+   --  Set to True by gprbuild when the version of GNAT is 6.3 or before.\n+\n+   Checksum_GNAT_5_03 : Boolean := False;\n+   --  GPRBUILD\n+   --  Set to True by gprbuild when the version of GNAT is 5.03 or before.\n+\n    ----------------------------------------------\n    -- Settings of Modes for Current Processing --\n    ----------------------------------------------\n@@ -933,26 +983,6 @@ package Opt is\n    --  GNATMAKE\n    --  Set to True when an object directory is specified with option -D\n \n-   Checksum_Accumulate_Token_Checksum : Boolean := True;\n-   --  GPRBUILD\n-   --  Set to False by gprbuild when the version of GNAT is 5.02 or before.\n-   --  There were no call to procedure Accumulate_Token_Checksum in these\n-   --  versions.\n-\n-   Checksum_GNAT_6_3 : Boolean := False;\n-   --  GPRBUILD\n-   --  Set to True by gprbuild when the version of GNAT is 6.3 or before. For\n-   --  GNAT versions 5.04 to 6.3, Accumulate_Token_Checksum were called with\n-   --  the token values of the keywords, instead of Tok_Identifier for later\n-   --  versions, and Tok_Some was not in Token_Type.\n-\n-   Checksum_GNAT_5_03 : Boolean := False;\n-   --  GPRBUILD\n-   --  Set to True by gprbuild when the version of GNAT is 5.03. For GNAT 5.04,\n-   --  Accumulate_Token_Checksum were called with the token values of the\n-   --  keywords, and Tok_Interface, Tok_Overriding, Tok_Synchronized and\n-   --  Tok_Some were not in Token_Type.\n-\n    One_Compilation_Per_Obj_Dir : Boolean := False;\n    --  GNATMAKE, GPRBUILD\n    --  Set to True with switch --single-compile-per-obj-dir. When True, there"}, {"sha": "3865887fe459de7eb3cc51dc79a2026eb94b0d12", "filename": "gcc/ada/prj-nmsc.adb", "status": "modified", "additions": 17, "deletions": 40, "changes": 57, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/dc718e52b96bde01a6095f8319c3a0191bff65a3/gcc%2Fada%2Fprj-nmsc.adb", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/dc718e52b96bde01a6095f8319c3a0191bff65a3/gcc%2Fada%2Fprj-nmsc.adb", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fada%2Fprj-nmsc.adb?ref=dc718e52b96bde01a6095f8319c3a0191bff65a3", "patch": "@@ -54,7 +54,10 @@ package body Prj.Nmsc is\n    --  location.\n \n    type Name_Location is record\n-      Name     : File_Name_Type;  --  ??? duplicates the key\n+      Name     : File_Name_Type;\n+      --  Key is duplicated, so that it is known when using functions Get_First\n+      --  and Get_Next, as these functions only return an Element.\n+\n       Location : Source_Ptr;\n       Source   : Source_Id := No_Source;\n       Listed   : Boolean := False;\n@@ -81,7 +84,10 @@ package body Prj.Nmsc is\n    --  found on the disk.\n \n    type Unit_Exception is record\n-      Name : Name_Id;  --  ??? duplicates the key\n+      Name : Name_Id;\n+      --  Key is duplicated, so that it is known when using functions Get_First\n+      --  and Get_Next, as these functions only return an Element.\n+\n       Spec : File_Name_Type;\n       Impl : File_Name_Type;\n    end record;\n@@ -2399,50 +2405,17 @@ package body Prj.Nmsc is\n                         Lang_Index.Config.Toolchain_Version :=\n                           Element.Value.Value;\n \n-                        if Lang_Index.Name = Name_Ada then\n-                           --  The way the checksum is computed has evolved\n-                           --  across the different versions of GNAT. When\n-                           --  gprbuild is called with -m, the checksums need\n-                           --  to be computed the same way in gprbuild as it\n-                           --  was in the GNAT version of the compiler.\n-                           --  The different ways are:\n-                           --    - version 6.4 and later:\n-                           --      procedure Accumulate_Token_Checksum is\n-                           --      called after each numeric literal and each\n-                           --      identifier/keyword. For keywords,\n-                           --      Tok_Identifier is used in the call to\n-                           --      Accumulate_Token_Checksum.\n-                           --    - versions 5.04 to 6.3:\n-                           --      for keywords, the token value were used in\n-                           --      the call to Accumulate_Token_Checksum. Type\n-                           --      Token_Type did not include Tok_Some.\n-                           --    - versions 5.03:\n-                           --      for keywords, the token value were used in\n-                           --      the call to Accumulate_Token_Checksum. Type\n-                           --      Token_Type did not include Tok_Interface,\n-                           --      Tok_Overriding, Tok_Synchronized and\n-                           --      Tok_Some.\n-                           --    - versions 5.02 and before:\n-                           --      no call to Accumulate_Token_Checksum.\n-                           --\n-                           --  To signal to the scanner that\n-                           --  Accumulate_Token_Checksum needs to be called and\n-                           --  what versions to call, 3 Booleans flags are used\n-                           --  in Opt:\n-                           --    - Checksum_Accumulate_Token_Checksum: True for\n-                           --      versions 5.03 and later, False for 5.02 and\n-                           --      before.\n-                           --    - Checksum_GNAT_6_3: False for versions 6.4\n-                           --      and later, True for versions 6.3 and before.\n-                           --    - Checksum_GNAT_5_03: False for versions 5.04\n-                           --    and later, True for versions 5.03 and before.\n+                        --  For Ada, set proper checksum computation mode\n \n+                        if Lang_Index.Name = Name_Ada then\n                            declare\n                               Vers : constant String :=\n                                        Get_Name_String (Element.Value.Value);\n                               pragma Assert (Vers'First = 1);\n \n                            begin\n+                              --  Version 6.3 or earlier\n+\n                               if Vers'Length >= 8\n                                 and then Vers (1 .. 5) = \"GNAT \"\n                                 and then Vers (7) = '.'\n@@ -2453,17 +2426,21 @@ package body Prj.Nmsc is\n                               then\n                                  Checksum_GNAT_6_3 := True;\n \n+                                 --  Version 5.03 or earlier\n+\n                                  if Vers (6) < '5'\n                                    or else (Vers (6) = '5'\n                                              and then Vers (Vers'Last) < '4')\n                                  then\n                                     Checksum_GNAT_5_03 := True;\n \n+                                    --  Version 5.02 or earlier\n+\n                                     if Vers (6) /= '5'\n                                       or else Vers (Vers'Last) < '3'\n                                     then\n                                        Checksum_Accumulate_Token_Checksum :=\n-                                       False;\n+                                         False;\n                                     end if;\n                                  end if;\n                               end if;"}]}