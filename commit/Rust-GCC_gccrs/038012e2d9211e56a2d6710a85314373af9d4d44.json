{"sha": "038012e2d9211e56a2d6710a85314373af9d4d44", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6MDM4MDEyZTJkOTIxMWU1NmEyZDY3MTBhODUzMTQzNzNhZjlkNGQ0NA==", "commit": {"author": {"name": "Tom de Vries", "email": "tom@codesourcery.com", "date": "2018-03-20T10:31:23Z"}, "committer": {"name": "Tom de Vries", "email": "vries@gcc.gnu.org", "date": "2018-03-20T10:31:23Z"}, "message": "[nvptx] Fix bar.sync position\n\n2018-03-20  Tom de Vries  <tom@codesourcery.com>\n\n\tPR target/84952\n\t* config/nvptx/nvptx.c (nvptx_single): Don't neuter bar.sync.\n\t(nvptx_process_pars): Emit bar.sync asap and alap.\n\nFrom-SVN: r258676", "tree": {"sha": "47c77648024f770d83b12543cd295c655ee1e2ac", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/47c77648024f770d83b12543cd295c655ee1e2ac"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/038012e2d9211e56a2d6710a85314373af9d4d44", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/038012e2d9211e56a2d6710a85314373af9d4d44", "html_url": "https://github.com/Rust-GCC/gccrs/commit/038012e2d9211e56a2d6710a85314373af9d4d44", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/038012e2d9211e56a2d6710a85314373af9d4d44/comments", "author": null, "committer": null, "parents": [{"sha": "452154b9e6d3aca59f09b9470b5cfcb2c206fb3e", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/452154b9e6d3aca59f09b9470b5cfcb2c206fb3e", "html_url": "https://github.com/Rust-GCC/gccrs/commit/452154b9e6d3aca59f09b9470b5cfcb2c206fb3e"}], "stats": {"total": 15, "additions": 12, "deletions": 3}, "files": [{"sha": "c1ac2f9228a889cb7ec81de0dcca7598a1a4a4c0", "filename": "gcc/ChangeLog", "status": "modified", "additions": 6, "deletions": 0, "changes": 6, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/038012e2d9211e56a2d6710a85314373af9d4d44/gcc%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/038012e2d9211e56a2d6710a85314373af9d4d44/gcc%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2FChangeLog?ref=038012e2d9211e56a2d6710a85314373af9d4d44", "patch": "@@ -1,3 +1,9 @@\n+2018-03-20  Tom de Vries  <tom@codesourcery.com>\n+\n+\tPR target/84952\n+\t* config/nvptx/nvptx.c (nvptx_single): Don't neuter bar.sync.\n+\t(nvptx_process_pars): Emit bar.sync asap and alap.\n+\n 2018-03-20  Tom de Vries  <tom@codesourcery.com>\n \n \tPR target/84954"}, {"sha": "1ba27e31ef088d3c9bdf3dc42c0a355e9ec53cb2", "filename": "gcc/config/nvptx/nvptx.c", "status": "modified", "additions": 6, "deletions": 3, "changes": 9, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/038012e2d9211e56a2d6710a85314373af9d4d44/gcc%2Fconfig%2Fnvptx%2Fnvptx.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/038012e2d9211e56a2d6710a85314373af9d4d44/gcc%2Fconfig%2Fnvptx%2Fnvptx.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fconfig%2Fnvptx%2Fnvptx.c?ref=038012e2d9211e56a2d6710a85314373af9d4d44", "patch": "@@ -3969,7 +3969,9 @@ nvptx_single (unsigned mask, basic_block from, basic_block to)\n   while (true)\n     {\n       /* Find first insn of from block.  */\n-      while (head != BB_END (from) && !INSN_P (head))\n+      while (head != BB_END (from)\n+\t     && (!INSN_P (head)\n+\t\t || recog_memoized (head) == CODE_FOR_nvptx_barsync))\n \thead = NEXT_INSN (head);\n \n       if (from == to)\n@@ -4018,6 +4020,7 @@ nvptx_single (unsigned mask, basic_block from, basic_block to)\n \t{\n \tdefault:\n \t  break;\n+\tcase CODE_FOR_nvptx_barsync:\n \tcase CODE_FOR_nvptx_fork:\n \tcase CODE_FOR_nvptx_forked:\n \tcase CODE_FOR_nvptx_joining:\n@@ -4275,8 +4278,8 @@ nvptx_process_pars (parallel *par)\n       nvptx_wpropagate (false, par->forked_block, par->forked_insn);\n       nvptx_wpropagate (true, par->forked_block, par->fork_insn);\n       /* Insert begin and end synchronizations.  */\n-      emit_insn_after (nvptx_wsync (false), par->forked_insn);\n-      emit_insn_before (nvptx_wsync (true), par->joining_insn);\n+      emit_insn_before (nvptx_wsync (false), par->forked_insn);\n+      emit_insn_before (nvptx_wsync (true), par->join_insn);\n     }\n   else if (par->mask & GOMP_DIM_MASK (GOMP_DIM_VECTOR))\n     nvptx_vpropagate (par->forked_block, par->forked_insn);"}]}