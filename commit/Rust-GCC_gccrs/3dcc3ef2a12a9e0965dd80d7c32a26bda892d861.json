{"sha": "3dcc3ef2a12a9e0965dd80d7c32a26bda892d861", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6M2RjYzNlZjJhMTJhOWUwOTY1ZGQ4MGQ3YzMyYTI2YmRhODkyZDg2MQ==", "commit": {"author": {"name": "Tobias Burnus", "email": "burnus@net-b.de", "date": "2008-09-25T15:01:16Z"}, "committer": {"name": "Tobias Burnus", "email": "burnus@gcc.gnu.org", "date": "2008-09-25T15:01:16Z"}, "message": "re PR fortran/37504 (Wrongly rejects: unprotected_pointer => protected_pointer)\n\n2008-09-25  Tobias Burnus  <burnus@net-b.de>\n\n        PR fortran/37504\n        * expr.c (gfc_check_pointer_assign): Allow assignment of\n        protected pointers.\n        * match.c (gfc_match_assignment,gfc_match_pointer_assignment):\n        Remove unreachable code.\n\n2008-09-25  Tobias Burnus  <burnus@net-b.de>\n\n        PR fortran/37504\n        * gfortran.dg/protected_7.f90: New test.\n\nFrom-SVN: r140663", "tree": {"sha": "865291e5e807cb4b828220df3729141d099a64a7", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/865291e5e807cb4b828220df3729141d099a64a7"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/3dcc3ef2a12a9e0965dd80d7c32a26bda892d861", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/3dcc3ef2a12a9e0965dd80d7c32a26bda892d861", "html_url": "https://github.com/Rust-GCC/gccrs/commit/3dcc3ef2a12a9e0965dd80d7c32a26bda892d861", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/3dcc3ef2a12a9e0965dd80d7c32a26bda892d861/comments", "author": {"login": "tob2", "id": 264461, "node_id": "MDQ6VXNlcjI2NDQ2MQ==", "avatar_url": "https://avatars.githubusercontent.com/u/264461?v=4", "gravatar_id": "", "url": "https://api.github.com/users/tob2", "html_url": "https://github.com/tob2", "followers_url": "https://api.github.com/users/tob2/followers", "following_url": "https://api.github.com/users/tob2/following{/other_user}", "gists_url": "https://api.github.com/users/tob2/gists{/gist_id}", "starred_url": "https://api.github.com/users/tob2/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/tob2/subscriptions", "organizations_url": "https://api.github.com/users/tob2/orgs", "repos_url": "https://api.github.com/users/tob2/repos", "events_url": "https://api.github.com/users/tob2/events{/privacy}", "received_events_url": "https://api.github.com/users/tob2/received_events", "type": "User", "site_admin": false}, "committer": null, "parents": [{"sha": "116612b99423703dfdb01a531e42d1444af75e14", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/116612b99423703dfdb01a531e42d1444af75e14", "html_url": "https://github.com/Rust-GCC/gccrs/commit/116612b99423703dfdb01a531e42d1444af75e14"}], "stats": {"total": 55, "additions": 37, "deletions": 18}, "files": [{"sha": "16ed9e9d68bb78b4bb2aba16be26b72b5ee6128c", "filename": "gcc/fortran/ChangeLog", "status": "modified", "additions": 8, "deletions": 0, "changes": 8, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/3dcc3ef2a12a9e0965dd80d7c32a26bda892d861/gcc%2Ffortran%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/3dcc3ef2a12a9e0965dd80d7c32a26bda892d861/gcc%2Ffortran%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ffortran%2FChangeLog?ref=3dcc3ef2a12a9e0965dd80d7c32a26bda892d861", "patch": "@@ -1,3 +1,11 @@\n+2008-09-25  Tobias Burnus  <burnus@net-b.de>\n+\n+\tPR fortran/37504\n+\t* expr.c (gfc_check_pointer_assign): Allow assignment of\n+\tprotected pointers.\n+\t* match.c (gfc_match_assignment,gfc_match_pointer_assignment):\n+\tRemove unreachable code.\n+\n 2008-09-24  Tobias Burnus  <burnus@net-b.de>\n \n \t* options.c (set_default_std_flags,gfc_init_options):"}, {"sha": "7b741b88050e5ffab5c903bd8ebe0d9730b8a3cc", "filename": "gcc/fortran/expr.c", "status": "modified", "additions": 2, "deletions": 1, "changes": 3, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/3dcc3ef2a12a9e0965dd80d7c32a26bda892d861/gcc%2Ffortran%2Fexpr.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/3dcc3ef2a12a9e0965dd80d7c32a26bda892d861/gcc%2Ffortran%2Fexpr.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ffortran%2Fexpr.c?ref=3dcc3ef2a12a9e0965dd80d7c32a26bda892d861", "patch": "@@ -3076,7 +3076,8 @@ gfc_check_pointer_assign (gfc_expr *lvalue, gfc_expr *rvalue)\n       return FAILURE;\n     }\n \n-  if (attr.is_protected && attr.use_assoc)\n+  if (attr.is_protected && attr.use_assoc\n+      && !(attr.pointer || attr.proc_pointer))\n     {\n       gfc_error (\"Pointer assignment target has PROTECTED \"\n \t\t \"attribute at %L\", &rvalue->where);"}, {"sha": "c8fd30d754f568816b11dd2b11b15296ae645121", "filename": "gcc/fortran/match.c", "status": "modified", "additions": 0, "deletions": 17, "changes": 17, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/3dcc3ef2a12a9e0965dd80d7c32a26bda892d861/gcc%2Ffortran%2Fmatch.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/3dcc3ef2a12a9e0965dd80d7c32a26bda892d861/gcc%2Ffortran%2Fmatch.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ffortran%2Fmatch.c?ref=3dcc3ef2a12a9e0965dd80d7c32a26bda892d861", "patch": "@@ -1293,15 +1293,6 @@ gfc_match_assignment (void)\n       return MATCH_NO;\n     }\n \n-  if (lvalue->symtree->n.sym->attr.is_protected\n-      && lvalue->symtree->n.sym->attr.use_assoc)\n-    {\n-      gfc_current_locus = old_loc;\n-      gfc_free_expr (lvalue);\n-      gfc_error (\"Setting value of PROTECTED variable at %C\");\n-      return MATCH_ERROR;\n-    }\n-\n   rvalue = NULL;\n   m = gfc_match (\" %e%t\", &rvalue);\n   if (m != MATCH_YES)\n@@ -1353,14 +1344,6 @@ gfc_match_pointer_assignment (void)\n   if (m != MATCH_YES)\n     goto cleanup;\n \n-  if (lvalue->symtree->n.sym->attr.is_protected\n-      && lvalue->symtree->n.sym->attr.use_assoc)\n-    {\n-      gfc_error (\"Assigning to a PROTECTED pointer at %C\");\n-      m = MATCH_ERROR;\n-      goto cleanup;\n-    }\n-\n   new_st.op = EXEC_POINTER_ASSIGN;\n   new_st.expr = lvalue;\n   new_st.expr2 = rvalue;"}, {"sha": "2941ac9778c58863d5d66bcafef82380d46e197e", "filename": "gcc/testsuite/ChangeLog", "status": "modified", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/3dcc3ef2a12a9e0965dd80d7c32a26bda892d861/gcc%2Ftestsuite%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/3dcc3ef2a12a9e0965dd80d7c32a26bda892d861/gcc%2Ftestsuite%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2FChangeLog?ref=3dcc3ef2a12a9e0965dd80d7c32a26bda892d861", "patch": "@@ -1,3 +1,8 @@\n+2008-09-25  Tobias Burnus  <burnus@net-b.de>\n+\n+\tPR fortran/37504\n+\t* gfortran.dg/protected_7.f90: New test.\n+\n 2008-09-24  Steve Ellcey  <sje@cup.hp.com>\n \n \t*  gcc.dg/vect/O3-vect-pr34223.c: Check vect_int_mult."}, {"sha": "0325a49a568521638966723f21780388f55b64b3", "filename": "gcc/testsuite/gfortran.dg/protected_7.f90", "status": "added", "additions": 22, "deletions": 0, "changes": 22, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/3dcc3ef2a12a9e0965dd80d7c32a26bda892d861/gcc%2Ftestsuite%2Fgfortran.dg%2Fprotected_7.f90", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/3dcc3ef2a12a9e0965dd80d7c32a26bda892d861/gcc%2Ftestsuite%2Fgfortran.dg%2Fprotected_7.f90", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgfortran.dg%2Fprotected_7.f90?ref=3dcc3ef2a12a9e0965dd80d7c32a26bda892d861", "patch": "@@ -0,0 +1,22 @@\n+! { dg-do compile }\n+! PR fortran/37504\n+!\n+module m\n+  implicit none\n+  integer, pointer, protected :: protected_pointer\n+  integer, target,  protected :: protected_target\n+end module m\n+\n+program p\n+  use m\n+  implicit none\n+  integer, pointer :: unprotected_pointer\n+  ! The next two lines should be rejected; see PR 37513 why\n+  ! we get such a strange error message.\n+  protected_pointer => unprotected_pointer ! { dg-error \"only allowed in specification part\" }\n+  protected_pointer =  unprotected_pointer ! { dg-error \"only allowed in specification part\" }\n+  unprotected_pointer => protected_target  ! { dg-error \"target has PROTECTED attribute\" }\n+  unprotected_pointer => protected_pointer ! OK\n+end program p\n+\n+! { dg-final { cleanup-modules \"m\" } }"}]}