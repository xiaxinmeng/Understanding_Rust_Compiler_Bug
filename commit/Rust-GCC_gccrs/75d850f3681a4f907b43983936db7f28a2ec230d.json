{"sha": "75d850f3681a4f907b43983936db7f28a2ec230d", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6NzVkODUwZjM2ODFhNGY5MDdiNDM5ODM5MzZkYjdmMjhhMmVjMjMwZA==", "commit": {"author": {"name": "Patrick Palka", "email": "patrick@parcs.ath.cx", "date": "2014-04-01T00:48:33Z"}, "committer": {"name": "Jason Merrill", "email": "jason@gcc.gnu.org", "date": "2014-04-01T00:48:33Z"}, "message": "re PR c++/44859 (missed warning: returning reference to temporary)\n\n\tPR c++/44859\n\t* typeck.c (maybe_warn_about_returning_address_of_local): Unwrap\n\tCOMPONENT_REFs and ARRAY_REFs sooner.\n\nFrom-SVN: r208970", "tree": {"sha": "830660eae8355c31ce7b0fcf6569c8b5bbd927b3", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/830660eae8355c31ce7b0fcf6569c8b5bbd927b3"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/75d850f3681a4f907b43983936db7f28a2ec230d", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/75d850f3681a4f907b43983936db7f28a2ec230d", "html_url": "https://github.com/Rust-GCC/gccrs/commit/75d850f3681a4f907b43983936db7f28a2ec230d", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/75d850f3681a4f907b43983936db7f28a2ec230d/comments", "author": null, "committer": null, "parents": [{"sha": "3020dc6e31cc701e5e19b4d680271b9f84437c93", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/3020dc6e31cc701e5e19b4d680271b9f84437c93", "html_url": "https://github.com/Rust-GCC/gccrs/commit/3020dc6e31cc701e5e19b4d680271b9f84437c93"}], "stats": {"total": 25, "additions": 21, "deletions": 4}, "files": [{"sha": "553a05976cf1ad60de108ed28555eb41c430e5cc", "filename": "gcc/cp/ChangeLog", "status": "modified", "additions": 6, "deletions": 0, "changes": 6, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/75d850f3681a4f907b43983936db7f28a2ec230d/gcc%2Fcp%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/75d850f3681a4f907b43983936db7f28a2ec230d/gcc%2Fcp%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fcp%2FChangeLog?ref=75d850f3681a4f907b43983936db7f28a2ec230d", "patch": "@@ -1,3 +1,9 @@\n+2014-03-31  Patrick Palka  patrick@parcs.ath.cx\n+\n+\tPR c++/44859\n+\t* typeck.c (maybe_warn_about_returning_address_of_local): Unwrap\n+\tCOMPONENT_REFs and ARRAY_REFs sooner.\n+\n 2014-03-29  Adam Butcher  <adam@jessamine.co.uk>\n \n \tPR c++/60626"}, {"sha": "9a80727dd8e47dee4993fcaf0618654a9303e486", "filename": "gcc/cp/typeck.c", "status": "modified", "additions": 4, "deletions": 4, "changes": 8, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/75d850f3681a4f907b43983936db7f28a2ec230d/gcc%2Fcp%2Ftypeck.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/75d850f3681a4f907b43983936db7f28a2ec230d/gcc%2Fcp%2Ftypeck.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fcp%2Ftypeck.c?ref=75d850f3681a4f907b43983936db7f28a2ec230d", "patch": "@@ -8283,6 +8283,10 @@ maybe_warn_about_returning_address_of_local (tree retval)\n     return;\n   whats_returned = TREE_OPERAND (whats_returned, 0);\n \n+  while (TREE_CODE (whats_returned) == COMPONENT_REF\n+\t || TREE_CODE (whats_returned) == ARRAY_REF)\n+    whats_returned = TREE_OPERAND (whats_returned, 0);\n+\n   if (TREE_CODE (valtype) == REFERENCE_TYPE)\n     {\n       if (TREE_CODE (whats_returned) == AGGR_INIT_EXPR\n@@ -8300,10 +8304,6 @@ maybe_warn_about_returning_address_of_local (tree retval)\n \t}\n     }\n \n-  while (TREE_CODE (whats_returned) == COMPONENT_REF\n-\t || TREE_CODE (whats_returned) == ARRAY_REF)\n-    whats_returned = TREE_OPERAND (whats_returned, 0);\n-\n   if (DECL_P (whats_returned)\n       && DECL_NAME (whats_returned)\n       && DECL_FUNCTION_SCOPE_P (whats_returned)"}, {"sha": "c483601e6b23e866e21afb7dd2462f7122091e4a", "filename": "gcc/testsuite/g++.dg/warn/Wreturn-local-addr-2.C", "status": "added", "additions": 11, "deletions": 0, "changes": 11, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/75d850f3681a4f907b43983936db7f28a2ec230d/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Fwarn%2FWreturn-local-addr-2.C", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/75d850f3681a4f907b43983936db7f28a2ec230d/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Fwarn%2FWreturn-local-addr-2.C", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Fwarn%2FWreturn-local-addr-2.C?ref=75d850f3681a4f907b43983936db7f28a2ec230d", "patch": "@@ -0,0 +1,11 @@\n+// PR c++/44859\n+\n+struct Base2 { int m_foo; };\n+struct Derived2 : public Base2 {};\n+\n+const Base2& f8() { return Derived2(); } // { dg-warning \"reference to temporary\" }\n+\n+struct foo { };\n+struct bar { foo base; };\n+\n+const foo& f9() { return bar().base; } // { dg-warning \"reference to temporary\" }"}]}