{"sha": "c4060df4b1ae72421aa0da0fbb0acdc7af3b7c68", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6YzQwNjBkZjRiMWFlNzI0MjFhYTBkYTBmYmIwYWNkYzdhZjNiN2M2OA==", "commit": {"author": {"name": "Jakub Jelinek", "email": "jakub@redhat.com", "date": "2017-04-04T10:41:33Z"}, "committer": {"name": "Jakub Jelinek", "email": "jakub@gcc.gnu.org", "date": "2017-04-04T10:41:33Z"}, "message": "re PR libgomp/79876 (FAIL: libgomp.fortran/strassen.f90   -O  execution test on x86_64-apple-darwin16)\n\n\tPR libgomp/79876\n\t* config/posix/thread-stacksize.h: New file.\n\t* config/darwin/thread-stacksize.h: New file.\n\t* config/nvptx/thread-stacksize.h: New file.\n\t* env.c: Include thread-stacksize.h.\n\t(initialize_env): Initialize stacksize to GOMP_DEFAULT_STACKSIZE\n\tinstead of 0.  Call pthread_attr_setstacksize even if\n\tGOMP_DEFAULT_STACKSIZE is non-zero.\n\nFrom-SVN: r246675", "tree": {"sha": "5a3168b71a136e04b15bf32d997bde9d51232721", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/5a3168b71a136e04b15bf32d997bde9d51232721"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/c4060df4b1ae72421aa0da0fbb0acdc7af3b7c68", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/c4060df4b1ae72421aa0da0fbb0acdc7af3b7c68", "html_url": "https://github.com/Rust-GCC/gccrs/commit/c4060df4b1ae72421aa0da0fbb0acdc7af3b7c68", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/c4060df4b1ae72421aa0da0fbb0acdc7af3b7c68/comments", "author": {"login": "jakubjelinek", "id": 9370665, "node_id": "MDQ6VXNlcjkzNzA2NjU=", "avatar_url": "https://avatars.githubusercontent.com/u/9370665?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jakubjelinek", "html_url": "https://github.com/jakubjelinek", "followers_url": "https://api.github.com/users/jakubjelinek/followers", "following_url": "https://api.github.com/users/jakubjelinek/following{/other_user}", "gists_url": "https://api.github.com/users/jakubjelinek/gists{/gist_id}", "starred_url": "https://api.github.com/users/jakubjelinek/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jakubjelinek/subscriptions", "organizations_url": "https://api.github.com/users/jakubjelinek/orgs", "repos_url": "https://api.github.com/users/jakubjelinek/repos", "events_url": "https://api.github.com/users/jakubjelinek/events{/privacy}", "received_events_url": "https://api.github.com/users/jakubjelinek/received_events", "type": "User", "site_admin": false}, "committer": null, "parents": [{"sha": "248179b5fc812b294e2488b23fedaaabe099ad9d", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/248179b5fc812b294e2488b23fedaaabe099ad9d", "html_url": "https://github.com/Rust-GCC/gccrs/commit/248179b5fc812b294e2488b23fedaaabe099ad9d"}], "stats": {"total": 100, "additions": 98, "deletions": 2}, "files": [{"sha": "5beaaa7cfba947476be48d03b86bb9992ff30d1a", "filename": "libgomp/ChangeLog", "status": "modified", "additions": 11, "deletions": 0, "changes": 11, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/c4060df4b1ae72421aa0da0fbb0acdc7af3b7c68/libgomp%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/c4060df4b1ae72421aa0da0fbb0acdc7af3b7c68/libgomp%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libgomp%2FChangeLog?ref=c4060df4b1ae72421aa0da0fbb0acdc7af3b7c68", "patch": "@@ -1,3 +1,14 @@\n+2017-04-04  Jakub Jelinek  <jakub@redhat.com>\n+\n+\tPR libgomp/79876\n+\t* config/posix/thread-stacksize.h: New file.\n+\t* config/darwin/thread-stacksize.h: New file.\n+\t* config/nvptx/thread-stacksize.h: New file.\n+\t* env.c: Include thread-stacksize.h.\n+\t(initialize_env): Initialize stacksize to GOMP_DEFAULT_STACKSIZE\n+\tinstead of 0.  Call pthread_attr_setstacksize even if\n+\tGOMP_DEFAULT_STACKSIZE is non-zero.\n+\n 2017-03-30  Jakub Jelinek  <jakub@redhat.com>\n \n \t* env.c (initialize_env): Initialize stacksize to 0."}, {"sha": "ae3910de84586f7ce5d12efef9bcd1e585977b63", "filename": "libgomp/config/darwin/thread-stacksize.h", "status": "added", "additions": 29, "deletions": 0, "changes": 29, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/c4060df4b1ae72421aa0da0fbb0acdc7af3b7c68/libgomp%2Fconfig%2Fdarwin%2Fthread-stacksize.h", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/c4060df4b1ae72421aa0da0fbb0acdc7af3b7c68/libgomp%2Fconfig%2Fdarwin%2Fthread-stacksize.h", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libgomp%2Fconfig%2Fdarwin%2Fthread-stacksize.h?ref=c4060df4b1ae72421aa0da0fbb0acdc7af3b7c68", "patch": "@@ -0,0 +1,29 @@\n+/* Copyright (C) 2017 Free Software Foundation, Inc.\n+   Contributed by Jakub Jelinek <jakub@redhat.com>\n+\n+   This file is part of the GNU Offloading and Multi Processing Library\n+   (libgomp).\n+\n+   Libgomp is free software; you can redistribute it and/or modify it\n+   under the terms of the GNU General Public License as published by\n+   the Free Software Foundation; either version 3, or (at your option)\n+   any later version.\n+\n+   Libgomp is distributed in the hope that it will be useful, but WITHOUT ANY\n+   WARRANTY; without even the implied warranty of MERCHANTABILITY or FITNESS\n+   FOR A PARTICULAR PURPOSE.  See the GNU General Public License for\n+   more details.\n+\n+   Under Section 7 of GPL version 3, you are granted additional\n+   permissions described in the GCC Runtime Library Exception, version\n+   3.1, as published by the Free Software Foundation.\n+\n+   You should have received a copy of the GNU General Public License and\n+   a copy of the GCC Runtime Library Exception along with this program;\n+   see the files COPYING3 and COPYING.RUNTIME respectively.  If not, see\n+   <http://www.gnu.org/licenses/>.  */\n+\n+/* OSX uses too small default stack size (0.5MB), use a bigger default.\n+   Users can still override it through OMP_STACKSIZE or GOMP_STACKSIZE\n+   environment variables.  */\n+#define GOMP_DEFAULT_STACKSIZE\t(2 * 1024 * 1024)"}, {"sha": "19da63fc515f34f2a973abc9701963f3debc88c3", "filename": "libgomp/config/nvptx/thread-stacksize.h", "status": "added", "additions": 27, "deletions": 0, "changes": 27, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/c4060df4b1ae72421aa0da0fbb0acdc7af3b7c68/libgomp%2Fconfig%2Fnvptx%2Fthread-stacksize.h", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/c4060df4b1ae72421aa0da0fbb0acdc7af3b7c68/libgomp%2Fconfig%2Fnvptx%2Fthread-stacksize.h", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libgomp%2Fconfig%2Fnvptx%2Fthread-stacksize.h?ref=c4060df4b1ae72421aa0da0fbb0acdc7af3b7c68", "patch": "@@ -0,0 +1,27 @@\n+/* Copyright (C) 2017 Free Software Foundation, Inc.\n+   Contributed by Jakub Jelinek <jakub@redhat.com>\n+\n+   This file is part of the GNU Offloading and Multi Processing Library\n+   (libgomp).\n+\n+   Libgomp is free software; you can redistribute it and/or modify it\n+   under the terms of the GNU General Public License as published by\n+   the Free Software Foundation; either version 3, or (at your option)\n+   any later version.\n+\n+   Libgomp is distributed in the hope that it will be useful, but WITHOUT ANY\n+   WARRANTY; without even the implied warranty of MERCHANTABILITY or FITNESS\n+   FOR A PARTICULAR PURPOSE.  See the GNU General Public License for\n+   more details.\n+\n+   Under Section 7 of GPL version 3, you are granted additional\n+   permissions described in the GCC Runtime Library Exception, version\n+   3.1, as published by the Free Software Foundation.\n+\n+   You should have received a copy of the GNU General Public License and\n+   a copy of the GCC Runtime Library Exception along with this program;\n+   see the files COPYING3 and COPYING.RUNTIME respectively.  If not, see\n+   <http://www.gnu.org/licenses/>.  */\n+\n+/* Not really applicable to NVPTX.  */\n+#define GOMP_DEFAULT_STACKSIZE\t0"}, {"sha": "570c486394bc1387c9092a069aaa476cd07b631f", "filename": "libgomp/config/posix/thread-stacksize.h", "status": "added", "additions": 27, "deletions": 0, "changes": 27, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/c4060df4b1ae72421aa0da0fbb0acdc7af3b7c68/libgomp%2Fconfig%2Fposix%2Fthread-stacksize.h", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/c4060df4b1ae72421aa0da0fbb0acdc7af3b7c68/libgomp%2Fconfig%2Fposix%2Fthread-stacksize.h", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libgomp%2Fconfig%2Fposix%2Fthread-stacksize.h?ref=c4060df4b1ae72421aa0da0fbb0acdc7af3b7c68", "patch": "@@ -0,0 +1,27 @@\n+/* Copyright (C) 2017 Free Software Foundation, Inc.\n+   Contributed by Jakub Jelinek <jakub@redhat.com>\n+\n+   This file is part of the GNU Offloading and Multi Processing Library\n+   (libgomp).\n+\n+   Libgomp is free software; you can redistribute it and/or modify it\n+   under the terms of the GNU General Public License as published by\n+   the Free Software Foundation; either version 3, or (at your option)\n+   any later version.\n+\n+   Libgomp is distributed in the hope that it will be useful, but WITHOUT ANY\n+   WARRANTY; without even the implied warranty of MERCHANTABILITY or FITNESS\n+   FOR A PARTICULAR PURPOSE.  See the GNU General Public License for\n+   more details.\n+\n+   Under Section 7 of GPL version 3, you are granted additional\n+   permissions described in the GCC Runtime Library Exception, version\n+   3.1, as published by the Free Software Foundation.\n+\n+   You should have received a copy of the GNU General Public License and\n+   a copy of the GCC Runtime Library Exception along with this program;\n+   see the files COPYING3 and COPYING.RUNTIME respectively.  If not, see\n+   <http://www.gnu.org/licenses/>.  */\n+\n+/* 0 means use the system default.  */\n+#define GOMP_DEFAULT_STACKSIZE\t0"}, {"sha": "ced752d18e49d2c6ce8e864ffc4dba15e3b130c4", "filename": "libgomp/env.c", "status": "modified", "additions": 4, "deletions": 2, "changes": 6, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/c4060df4b1ae72421aa0da0fbb0acdc7af3b7c68/libgomp%2Fenv.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/c4060df4b1ae72421aa0da0fbb0acdc7af3b7c68/libgomp%2Fenv.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libgomp%2Fenv.c?ref=c4060df4b1ae72421aa0da0fbb0acdc7af3b7c68", "patch": "@@ -51,6 +51,7 @@\n # endif\n #endif\n #include <errno.h>\n+#include \"thread-stacksize.h\"\n \n #ifndef HAVE_STRTOULL\n # define strtoull(ptr, eptr, base) strtoul (ptr, eptr, base)\n@@ -1187,7 +1188,7 @@ handle_omp_display_env (unsigned long stacksize, int wait_policy)\n static void __attribute__((constructor))\n initialize_env (void)\n {\n-  unsigned long thread_limit_var, stacksize = 0;\n+  unsigned long thread_limit_var, stacksize = GOMP_DEFAULT_STACKSIZE;\n   int wait_policy;\n \n   /* Do a compile time check that mkomp_h.pl did good job.  */\n@@ -1274,7 +1275,8 @@ initialize_env (void)\n   pthread_attr_setdetachstate (&gomp_thread_attr, PTHREAD_CREATE_DETACHED);\n \n   if (parse_stacksize (\"OMP_STACKSIZE\", &stacksize)\n-      || parse_stacksize (\"GOMP_STACKSIZE\", &stacksize))\n+      || parse_stacksize (\"GOMP_STACKSIZE\", &stacksize)\n+      || GOMP_DEFAULT_STACKSIZE)\n     {\n       int err;\n "}]}