{"sha": "ba99296704bd337a302e5dee43dc57f013d1177b", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6YmE5OTI5NjcwNGJkMzM3YTMwMmU1ZGVlNDNkYzU3ZjAxM2QxMTc3Yg==", "commit": {"author": {"name": "Seongbae Park", "email": "seongbae.park@gmail.com", "date": "2007-05-02T23:11:13Z"}, "committer": {"name": "Seongbae Park", "email": "spark@gcc.gnu.org", "date": "2007-05-02T23:11:13Z"}, "message": "re PR c++/31663 (Segfault in constrain_class_visibility with anonymous namespace)\n\ngcc/ChangeLog:\n2007-05-02  Seongbae Park  <seongbae.park@gmail.com>\n\n\tPR c++/31663\n\t* c-common.c (strip_pointer_or_array_types): New function.\n\t* c-common.h (strip_pointer_or_array_types): New function declaration.\n\ngcc/cp/ChangeLog:\n2007-05-02  Seongbae Park  <seongbae.park@gmail.com>\n\n\tPR c++/31663\n\t* decl2.c (constrain_class_visibility): \n\tUse strip_pointer_or_array_types instead of strip_array_types.\n\ngcc/testsuite/ChangeLog:\n2007-05-02  Seongbae Park  <seongbae.park@gmail.com>\n\n\tPR C++/31663\n\t* g++.dg/warn/anonymous-namespace-2.C: New. \n\t* g++.dg/warn/anonymous-namespace-2.h: New.\n\nFrom-SVN: r124363", "tree": {"sha": "607c7af016a22b560e2c1a42510cf7ce4d505d96", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/607c7af016a22b560e2c1a42510cf7ce4d505d96"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/ba99296704bd337a302e5dee43dc57f013d1177b", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/ba99296704bd337a302e5dee43dc57f013d1177b", "html_url": "https://github.com/Rust-GCC/gccrs/commit/ba99296704bd337a302e5dee43dc57f013d1177b", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/ba99296704bd337a302e5dee43dc57f013d1177b/comments", "author": null, "committer": null, "parents": [{"sha": "e0310afb08cc322a877a51e232bda6efe59d92ed", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/e0310afb08cc322a877a51e232bda6efe59d92ed", "html_url": "https://github.com/Rust-GCC/gccrs/commit/e0310afb08cc322a877a51e232bda6efe59d92ed"}], "stats": {"total": 62, "additions": 61, "deletions": 1}, "files": [{"sha": "01aa44e466e77732bec71a41263c4228ff77bbf8", "filename": "gcc/ChangeLog", "status": "modified", "additions": 6, "deletions": 0, "changes": 6, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/ba99296704bd337a302e5dee43dc57f013d1177b/gcc%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/ba99296704bd337a302e5dee43dc57f013d1177b/gcc%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2FChangeLog?ref=ba99296704bd337a302e5dee43dc57f013d1177b", "patch": "@@ -1,3 +1,9 @@\n+2007-05-02  Seongbae Park  <seongbae.park@gmail.com>\n+\n+\tPR c++/31663\n+\t* c-common.c (strip_pointer_or_array_types): New function.\n+\t* c-common.h (strip_pointer_or_array_types): New function declaration.\n+\n 2007-05-03  Zdenek Dvorak  <dvorakz@suse.cz>\n \n \tPR tree-optimization/31771"}, {"sha": "4e92ae6073dfc3ad0ba6bb2cdf3b1cc9a87a07b3", "filename": "gcc/c-common.c", "status": "modified", "additions": 9, "deletions": 0, "changes": 9, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/ba99296704bd337a302e5dee43dc57f013d1177b/gcc%2Fc-common.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/ba99296704bd337a302e5dee43dc57f013d1177b/gcc%2Fc-common.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fc-common.c?ref=ba99296704bd337a302e5dee43dc57f013d1177b", "patch": "@@ -3894,6 +3894,15 @@ strip_pointer_operator (tree t)\n   return t;\n }\n \n+/* Recursively remove pointer or array type from TYPE. */\n+tree\n+strip_pointer_or_array_types (tree t)\n+{\n+  while (TREE_CODE (t) == ARRAY_TYPE || POINTER_TYPE_P (t))\n+    t = TREE_TYPE (t);\n+  return t;\n+}\n+\n /* Used to compare case labels.  K1 and K2 are actually tree nodes\n    representing case labels, or NULL_TREE for a `default' label.\n    Returns -1 if K1 is ordered before K2, -1 if K1 is ordered after"}, {"sha": "d4afaec45354b5049e794c95f51aeb0cb6622cbc", "filename": "gcc/c-common.h", "status": "modified", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/ba99296704bd337a302e5dee43dc57f013d1177b/gcc%2Fc-common.h", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/ba99296704bd337a302e5dee43dc57f013d1177b/gcc%2Fc-common.h", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fc-common.h?ref=ba99296704bd337a302e5dee43dc57f013d1177b", "patch": "@@ -727,6 +727,7 @@ extern bool c_promoting_integer_type_p (tree);\n extern int self_promoting_args_p (tree);\n extern tree strip_array_types (tree);\n extern tree strip_pointer_operator (tree);\n+extern tree strip_pointer_or_array_types (tree);\n extern HOST_WIDE_INT c_common_to_target_charset (HOST_WIDE_INT);\n \n /* This is the basic parsing function.  */"}, {"sha": "b2f34a3f92a335b2c591cacc1b17a747bbf79731", "filename": "gcc/cp/ChangeLog", "status": "modified", "additions": 6, "deletions": 0, "changes": 6, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/ba99296704bd337a302e5dee43dc57f013d1177b/gcc%2Fcp%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/ba99296704bd337a302e5dee43dc57f013d1177b/gcc%2Fcp%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fcp%2FChangeLog?ref=ba99296704bd337a302e5dee43dc57f013d1177b", "patch": "@@ -1,3 +1,9 @@\n+2007-05-02  Seongbae Park  <seongbae.park@gmail.com>\n+\n+\tPR c++/31663\n+\t* decl2.c (constrain_class_visibility): \n+\tUse strip_pointer_or_array_types instead of strip_array_types.\n+\n 2007-04-28  Andrew Pinski  <andrew_pinski@playstation.sony.com>\n \n \tPR C++/30221"}, {"sha": "5788f94ca13fe77167272037debe7d87382fa53e", "filename": "gcc/cp/decl2.c", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/ba99296704bd337a302e5dee43dc57f013d1177b/gcc%2Fcp%2Fdecl2.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/ba99296704bd337a302e5dee43dc57f013d1177b/gcc%2Fcp%2Fdecl2.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fcp%2Fdecl2.c?ref=ba99296704bd337a302e5dee43dc57f013d1177b", "patch": "@@ -1856,7 +1856,7 @@ constrain_class_visibility (tree type)\n   for (t = TYPE_FIELDS (type); t; t = TREE_CHAIN (t))\n     if (TREE_CODE (t) == FIELD_DECL && TREE_TYPE (t) != error_mark_node)\n       {\n-\ttree ftype = strip_array_types (TREE_TYPE (t));\n+\ttree ftype = strip_pointer_or_array_types (TREE_TYPE (t));\n \tint subvis = type_visibility (ftype);\n \n \tif (subvis == VISIBILITY_ANON)"}, {"sha": "1ecf01394b309f3339d1aca2bce2711ac87d8aa4", "filename": "gcc/testsuite/ChangeLog", "status": "modified", "additions": 6, "deletions": 0, "changes": 6, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/ba99296704bd337a302e5dee43dc57f013d1177b/gcc%2Ftestsuite%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/ba99296704bd337a302e5dee43dc57f013d1177b/gcc%2Ftestsuite%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2FChangeLog?ref=ba99296704bd337a302e5dee43dc57f013d1177b", "patch": "@@ -1,3 +1,9 @@\n+2007-05-02  Seongbae Park  <seongbae.park@gmail.com>\n+\n+\tPR C++/31663\n+\t* g++.dg/warn/anonymous-namespace-2.C: New. \n+\t* g++.dg/warn/anonymous-namespace-2.h: New. \n+\n 2007-05-02  Paul Brook  <paul@codesourcery.com>\n \n \t* gcc.dg/arm-eabi1.c: Move debug output.  Augment lcmp/ulcmp tests."}, {"sha": "4d87b69d3961f3e2c0e0134b37c10b3f95da8fd3", "filename": "gcc/testsuite/g++.dg/warn/anonymous-namespace-2.C", "status": "added", "additions": 29, "deletions": 0, "changes": 29, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/ba99296704bd337a302e5dee43dc57f013d1177b/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Fwarn%2Fanonymous-namespace-2.C", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/ba99296704bd337a302e5dee43dc57f013d1177b/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Fwarn%2Fanonymous-namespace-2.C", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Fwarn%2Fanonymous-namespace-2.C?ref=ba99296704bd337a302e5dee43dc57f013d1177b", "patch": "@@ -0,0 +1,29 @@\n+// Test for the warning of exposing types from an anonymous namespace\n+// { dg-do compile }\n+//\n+#include \"anonymous-namespace-2.h\"\n+\n+namespace {\n+    struct good { };\n+}\n+\n+struct g1 {\n+    good * A;\n+};\n+struct b1 { // { dg-warning \"uses the anonymous namespace\" }\n+    bad * B;\n+};\n+\n+struct g2 {\n+    good * A[1];\n+};\n+struct b2 { // { dg-warning \"uses the anonymous namespace\" }\n+    bad * B[1];\n+};\n+\n+struct g3 {\n+    good (*A)[1];\n+};\n+struct b3 { // { dg-warning \"uses the anonymous namespace\" }\n+    bad (*B)[1];\n+};"}, {"sha": "ce5d05c2aecd78837bce2d7ce82da0abfa6522f1", "filename": "gcc/testsuite/g++.dg/warn/anonymous-namespace-2.h", "status": "added", "additions": 3, "deletions": 0, "changes": 3, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/ba99296704bd337a302e5dee43dc57f013d1177b/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Fwarn%2Fanonymous-namespace-2.h", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/ba99296704bd337a302e5dee43dc57f013d1177b/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Fwarn%2Fanonymous-namespace-2.h", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Fwarn%2Fanonymous-namespace-2.h?ref=ba99296704bd337a302e5dee43dc57f013d1177b", "patch": "@@ -0,0 +1,3 @@\n+namespace {\n+  struct bad { };\n+}"}]}