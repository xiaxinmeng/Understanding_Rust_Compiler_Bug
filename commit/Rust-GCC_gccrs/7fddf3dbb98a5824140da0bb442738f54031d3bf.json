{"sha": "7fddf3dbb98a5824140da0bb442738f54031d3bf", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6N2ZkZGYzZGJiOThhNTgyNDE0MGRhMGJiNDQyNzM4ZjU0MDMxZDNiZg==", "commit": {"author": {"name": "Hans-Peter Nilsson", "email": "hp@axis.com", "date": "2021-02-25T04:07:37Z"}, "committer": {"name": "Hans-Peter Nilsson", "email": "hp@axis.com", "date": "2021-03-02T23:15:17Z"}, "message": "outputs.exp: skip @file -save-temps if target has -L or -I\n\nThe outputs.exp tests check what temporary files are created\nand left behind with e.g. -save-temps.\n\nAdditional files are created in presence of @file option.\nAdding an -I or -L option causes *another* temporary file to\nappear.  I take it that's deliberate, as there are tests for\nthat behavior.\n\nFor native testing, the default test-framework baseboard\nfile unix.exp doesn't add any -I or -L options and all tests\npass.  For a newlib target however, you'll have a couple of\n-L options (see the nopts handling in outputs.exp), leading\nto:\n\nRunning /x/gcc/gcc/testsuite/gcc.misc-tests/outputs.exp ...\nFAIL: outputs exe savetmp namedb: extra\noutputs.args.1\nFAIL: outputs exe savetmp named2: extra\noutputs.args.1\nFAIL: outputs exe savetmp named2: extra\noutputs.args.3\nFAIL: outputs lto sing unnamed: extra\na.args.1\n\nThe failing tests are among the actual tests that check the\nbehavior of @file, and are confused by the additional -L.\n\nIdentify presence of -I or -L from the test framework and\nskip those tests.\n\nTested cris-elf and x86_64-pc-linux-gnu.\n\ngcc/testsuite:\n\t* gcc.misc-tests/outputs.exp: Skip @file -save-temps\n\ttests if target test-framework has -L or -I options.", "tree": {"sha": "91601487d161da150ad3af232868729096bd02d1", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/91601487d161da150ad3af232868729096bd02d1"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/7fddf3dbb98a5824140da0bb442738f54031d3bf", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/7fddf3dbb98a5824140da0bb442738f54031d3bf", "html_url": "https://github.com/Rust-GCC/gccrs/commit/7fddf3dbb98a5824140da0bb442738f54031d3bf", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/7fddf3dbb98a5824140da0bb442738f54031d3bf/comments", "author": {"login": "hpataxisdotcom", "id": 80339731, "node_id": "MDQ6VXNlcjgwMzM5NzMx", "avatar_url": "https://avatars.githubusercontent.com/u/80339731?v=4", "gravatar_id": "", "url": "https://api.github.com/users/hpataxisdotcom", "html_url": "https://github.com/hpataxisdotcom", "followers_url": "https://api.github.com/users/hpataxisdotcom/followers", "following_url": "https://api.github.com/users/hpataxisdotcom/following{/other_user}", "gists_url": "https://api.github.com/users/hpataxisdotcom/gists{/gist_id}", "starred_url": "https://api.github.com/users/hpataxisdotcom/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/hpataxisdotcom/subscriptions", "organizations_url": "https://api.github.com/users/hpataxisdotcom/orgs", "repos_url": "https://api.github.com/users/hpataxisdotcom/repos", "events_url": "https://api.github.com/users/hpataxisdotcom/events{/privacy}", "received_events_url": "https://api.github.com/users/hpataxisdotcom/received_events", "type": "User", "site_admin": false}, "committer": {"login": "hpataxisdotcom", "id": 80339731, "node_id": "MDQ6VXNlcjgwMzM5NzMx", "avatar_url": "https://avatars.githubusercontent.com/u/80339731?v=4", "gravatar_id": "", "url": "https://api.github.com/users/hpataxisdotcom", "html_url": "https://github.com/hpataxisdotcom", "followers_url": "https://api.github.com/users/hpataxisdotcom/followers", "following_url": "https://api.github.com/users/hpataxisdotcom/following{/other_user}", "gists_url": "https://api.github.com/users/hpataxisdotcom/gists{/gist_id}", "starred_url": "https://api.github.com/users/hpataxisdotcom/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/hpataxisdotcom/subscriptions", "organizations_url": "https://api.github.com/users/hpataxisdotcom/orgs", "repos_url": "https://api.github.com/users/hpataxisdotcom/repos", "events_url": "https://api.github.com/users/hpataxisdotcom/events{/privacy}", "received_events_url": "https://api.github.com/users/hpataxisdotcom/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "8b6ebc025cf2b25fdc1e8f6e6261701dc71bac74", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/8b6ebc025cf2b25fdc1e8f6e6261701dc71bac74", "html_url": "https://github.com/Rust-GCC/gccrs/commit/8b6ebc025cf2b25fdc1e8f6e6261701dc71bac74"}], "stats": {"total": 12, "additions": 12, "deletions": 0}, "files": [{"sha": "ebd61448bfdd67d3329adb4b982c2bd207a08022", "filename": "gcc/testsuite/gcc.misc-tests/outputs.exp", "status": "modified", "additions": 12, "deletions": 0, "changes": 12, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/7fddf3dbb98a5824140da0bb442738f54031d3bf/gcc%2Ftestsuite%2Fgcc.misc-tests%2Foutputs.exp", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/7fddf3dbb98a5824140da0bb442738f54031d3bf/gcc%2Ftestsuite%2Fgcc.misc-tests%2Foutputs.exp", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgcc.misc-tests%2Foutputs.exp?ref=7fddf3dbb98a5824140da0bb442738f54031d3bf", "patch": "@@ -57,10 +57,18 @@ set gld [check_effective_target_gld]\n # We do not compile to an executable, because that requires naming an output.\n set link_options \"\"\n set dest [target_info name]\n+set skip_atsave 0\n foreach i { ldflags libs ldscript } {\n     if {[board_info $dest exists $i]} {\n \tset opts [board_info $dest $i]\n \tset nopts [gcc_adjust_linker_flags_list $opts]\n+\n+\t# Options -I<X> and -L<X> affect the behavior of @files\n+\t# wrt. temporary files.  Skip @file -save-temps tests if we\n+\t# have any of them in the board-flags.\n+\tif { [string match \"* -\\[LI\\]*\" \" $nopts\"]} {\n+\t    set skip_atsave 1\n+\t}\n \tforeach opt $nopts {\n \t    append link_options \" additional_flags=$opt\"\n \t}\n@@ -298,10 +306,12 @@ outest \"$b exe savetmp namedb\" $sing \"-o $b.exe -save-temps\" {} {{--0.i --0.s --\n outest \"$b exe savetmp named2\" $mult \"-o $b.exe -save-temps\" {} {{--1.i --1.s --1.o --2.i --2.s --2.o .exe}}\n \n # Additional files are created when an @file is used\n+if !$skip_atsave {\n outest \"$b exe savetmp namedb\" $sing \"@/dev/null -o $b.exe -save-temps\" {} {{--0.i --0.s --0.o .args.0 !!$gld .ld1_args !0 .exe}}\n outest \"$b exe savetmp named2\" $mult \"@/dev/null -o $b.exe -save-temps\" {} {{--1.i --1.s --1.o --2.i --2.s --2.o .args.0 !!$gld .ld1_args !0 .exe}}\n outest \"$b exe savetmp named2\" $mult \"@/dev/null -I dummy -o $b.exe -save-temps\" {} {{--1.i --1.s --1.o --2.i --2.s --2.o -args.0 -args.1 .args.2 !!$gld .ld1_args !0 .exe}}\n outest \"$b exe savetmp named2\" $mult \"@/dev/null -I dummy -L dummy -o $b.exe -save-temps\" {} {{--1.i --1.s --1.o --2.i --2.s --2.o -args.0 -args.1 .args.2 .args.3 !!$gld .ld1_args !0 .exe}}\n+}\n \n # Setting the main output to a dir selects it as the default aux&dump\n # location.\n@@ -657,8 +667,10 @@ outest \"$b lto sing named\" $sing \"-o $b.exe -O2 -flto -fno-use-linker-plugin -fl\n outest \"$b lto mult named\" $mult \"-o $b.exe -O2 -flto -fno-use-linker-plugin -flto-partition=one -fdump-ipa-icf-optimized -fdump-rtl-final -fstack-usage\" {} {{--1.c.???i.icf --1.c.???r.final --2.c.???i.icf --2.c.???r.final .wpa.???i.icf .ltrans0.ltrans.???r.final .ltrans0.ltrans.su .exe}}\n outest \"$b lto sing nameddir\" $sing \"-o dir/$b.exe -O2 -flto -fno-use-linker-plugin -flto-partition=one -fdump-ipa-icf-optimized -fdump-rtl-final -fstack-usage\" {dir/} {{--0.c.???i.icf --0.c.???r.final .wpa.???i.icf .ltrans0.ltrans.???r.final .ltrans0.ltrans.su .exe} {}}\n outest \"$b lto mult nameddir\" $mult \"-o dir/$b.exe -O2 -flto -fno-use-linker-plugin -flto-partition=one -fdump-ipa-icf-optimized -fdump-rtl-final -fstack-usage\" {dir/} {{--1.c.???i.icf --1.c.???r.final --2.c.???i.icf --2.c.???r.final .wpa.???i.icf .ltrans0.ltrans.???r.final .ltrans0.ltrans.su .exe} {}}\n+if !$skip_atsave {\n outest \"$b lto sing unnamed\" $sing \"@/dev/null -O2 -flto -fno-use-linker-plugin -flto-partition=one -fdump-ipa-icf-optimized -fdump-rtl-final -fstack-usage -save-temps $oaout\" {} {{a--0.c.???i.icf a--0.c.???r.final a.wpa.???i.icf a.ltrans0.ltrans.???r.final a.ltrans0.ltrans.su a--0.o a--0.s a--0.i a.ltrans0.o a.ltrans.out a.ltrans0.ltrans.o a.ltrans0.ltrans_args a.args.0 a.ltrans0.ltrans.s a.wpa.args.0 a.lto_args a.ld1_args a.ltrans_args a.ltrans0.ltrans.args.0 a.ld_args $aout}}\n }\n+}\n \n # -dumpbase without -dumpdir.  The trailing dumppfx dash after it is\n # combined with dumpbase turns into a period when passed to lto as"}]}