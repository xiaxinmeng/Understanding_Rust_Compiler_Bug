{"sha": "c36774bcc38ba51fc9091d92a079e5b2d4aab759", "node_id": "C_kwDOANBUbNoAKGMzNjc3NGJjYzM4YmE1MWZjOTA5MWQ5MmEwNzllNWIyZDRhYWI3NTk", "commit": {"author": {"name": "Bob Duff", "email": "duff@adacore.com", "date": "2021-08-29T15:25:08Z"}, "committer": {"name": "Pierre-Marie de Rodat", "email": "derodat@adacore.com", "date": "2021-10-04T08:45:07Z"}, "message": "[Ada] Declaration_Node for Itypes returns Empty or declaration\n\ngcc/ada/\n\n\t* einfo.ads (Declaration_Node): Document that Declaration_Node\n\tfor Itypes.\n\t* einfo-utils.adb (Declaration_Node): Make it return Empty for\n\tItypes, or a proper type or subtype declaration.\n\t* gen_il-gen.adb: Minor comment improvement.", "tree": {"sha": "ba9ec3c09b1aa05ba21648c5e9edf42bfd43f9a0", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/ba9ec3c09b1aa05ba21648c5e9edf42bfd43f9a0"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/c36774bcc38ba51fc9091d92a079e5b2d4aab759", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/c36774bcc38ba51fc9091d92a079e5b2d4aab759", "html_url": "https://github.com/Rust-GCC/gccrs/commit/c36774bcc38ba51fc9091d92a079e5b2d4aab759", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/c36774bcc38ba51fc9091d92a079e5b2d4aab759/comments", "author": {"login": "bobduff", "id": 29099567, "node_id": "MDQ6VXNlcjI5MDk5NTY3", "avatar_url": "https://avatars.githubusercontent.com/u/29099567?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bobduff", "html_url": "https://github.com/bobduff", "followers_url": "https://api.github.com/users/bobduff/followers", "following_url": "https://api.github.com/users/bobduff/following{/other_user}", "gists_url": "https://api.github.com/users/bobduff/gists{/gist_id}", "starred_url": "https://api.github.com/users/bobduff/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bobduff/subscriptions", "organizations_url": "https://api.github.com/users/bobduff/orgs", "repos_url": "https://api.github.com/users/bobduff/repos", "events_url": "https://api.github.com/users/bobduff/events{/privacy}", "received_events_url": "https://api.github.com/users/bobduff/received_events", "type": "User", "site_admin": false}, "committer": {"login": "pmderodat", "id": 758452, "node_id": "MDQ6VXNlcjc1ODQ1Mg==", "avatar_url": "https://avatars.githubusercontent.com/u/758452?v=4", "gravatar_id": "", "url": "https://api.github.com/users/pmderodat", "html_url": "https://github.com/pmderodat", "followers_url": "https://api.github.com/users/pmderodat/followers", "following_url": "https://api.github.com/users/pmderodat/following{/other_user}", "gists_url": "https://api.github.com/users/pmderodat/gists{/gist_id}", "starred_url": "https://api.github.com/users/pmderodat/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/pmderodat/subscriptions", "organizations_url": "https://api.github.com/users/pmderodat/orgs", "repos_url": "https://api.github.com/users/pmderodat/repos", "events_url": "https://api.github.com/users/pmderodat/events{/privacy}", "received_events_url": "https://api.github.com/users/pmderodat/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "f9974930bcb21fb436217972db38d04ab88eb8c4", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/f9974930bcb21fb436217972db38d04ab88eb8c4", "html_url": "https://github.com/Rust-GCC/gccrs/commit/f9974930bcb21fb436217972db38d04ab88eb8c4"}], "stats": {"total": 27, "additions": 18, "deletions": 9}, "files": [{"sha": "0274e6b1aa8ac0ce69427bc04d6301b92c417db0", "filename": "gcc/ada/einfo-utils.adb", "status": "modified", "additions": 13, "deletions": 8, "changes": 21, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/c36774bcc38ba51fc9091d92a079e5b2d4aab759/gcc%2Fada%2Feinfo-utils.adb", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/c36774bcc38ba51fc9091d92a079e5b2d4aab759/gcc%2Fada%2Feinfo-utils.adb", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fada%2Feinfo-utils.adb?ref=c36774bcc38ba51fc9091d92a079e5b2d4aab759", "patch": "@@ -655,16 +655,21 @@ package body Einfo.Utils is\n          P := Parent (Id);\n       end if;\n \n+      while Nkind (P) in N_Selected_Component | N_Expanded_Name\n+        or else (Nkind (P) = N_Defining_Program_Unit_Name\n+                   and then Is_Child_Unit (Id))\n       loop\n-         if Nkind (P) in N_Selected_Component | N_Expanded_Name\n-           or else (Nkind (P) = N_Defining_Program_Unit_Name\n-                     and then Is_Child_Unit (Id))\n-         then\n-            P := Parent (P);\n-         else\n-            return P;\n-         end if;\n+         P := Parent (P);\n       end loop;\n+\n+      if Is_Itype (Id)\n+        and then Nkind (P) not in\n+          N_Full_Type_Declaration | N_Subtype_Declaration\n+      then\n+         P := Empty;\n+      end if;\n+\n+      return P;\n    end Declaration_Node;\n \n    ---------------------"}, {"sha": "2030841eaabc61f2e6d56d6eb28a241b9e4c5ff6", "filename": "gcc/ada/einfo.ads", "status": "modified", "additions": 3, "deletions": 1, "changes": 4, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/c36774bcc38ba51fc9091d92a079e5b2d4aab759/gcc%2Fada%2Feinfo.ads", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/c36774bcc38ba51fc9091d92a079e5b2d4aab759/gcc%2Fada%2Feinfo.ads", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fada%2Feinfo.ads?ref=c36774bcc38ba51fc9091d92a079e5b2d4aab759", "patch": "@@ -829,7 +829,9 @@ package Einfo is\n --       a private type, then we obtain the declaration node denoted by the\n --       full type, i.e. the full type declaration node. Also note that for\n --       subprograms, this returns the {function,procedure}_specification, not\n---       the subprogram_declaration.\n+--       the subprogram_declaration. If the parent of an Itype is a type or\n+--       subtype declaration, we return the declaration node as for any other\n+--       type. For other Itypes, we return Empty.\n \n --    Default_Aspect_Component_Value [base type only]\n --       Defined in array types. Holds the static value specified in a"}, {"sha": "9983e1052db4a6807a75f016286704e993323d48", "filename": "gcc/ada/gen_il-gen.adb", "status": "modified", "additions": 2, "deletions": 0, "changes": 2, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/c36774bcc38ba51fc9091d92a079e5b2d4aab759/gcc%2Fada%2Fgen_il-gen.adb", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/c36774bcc38ba51fc9091d92a079e5b2d4aab759/gcc%2Fada%2Fgen_il-gen.adb", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fada%2Fgen_il-gen.adb?ref=c36774bcc38ba51fc9091d92a079e5b2d4aab759", "patch": "@@ -710,6 +710,8 @@ package body Gen_IL.Gen is\n                   Type_Table (T).Last  := T;\n                   Add_Concrete_Descendant_To_Ancestors\n                     (Type_Table (T).Parent, T);\n+                  --  Parent cannot be No_Type here, because T is a concrete\n+                  --  type, and therefore not a root type.\n \n                when Abstract_Type =>\n                   declare"}]}