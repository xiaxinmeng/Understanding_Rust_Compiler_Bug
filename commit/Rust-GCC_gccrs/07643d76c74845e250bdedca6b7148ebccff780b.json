{"sha": "07643d76c74845e250bdedca6b7148ebccff780b", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6MDc2NDNkNzZjNzQ4NDVlMjUwYmRlZGNhNmI3MTQ4ZWJjY2ZmNzgwYg==", "commit": {"author": {"name": "Alexander Monakov", "email": "amonakov@ispras.ru", "date": "2011-04-08T11:49:43Z"}, "committer": {"name": "Alexander Monakov", "email": "amonakov@gcc.gnu.org", "date": "2011-04-08T11:49:43Z"}, "message": "re PR target/48273 (ICE: in create_copy_of_insn_rtx, at sel-sched-ir.c:5604 with -fsel-sched-pipelining -fselective-scheduling2 -march=core2)\n\n\tPR target/48273\n\t* cfgloop.h (loop_has_exit_edges): New helper.\n\t* sel-sched-ir.c (init_global_and_expr_for_insn): Make CALLs\n\tnon-clonable.\n\t* sel-sched.c (sel_setup_region_sched_flags): Don't pipeline loops\n\tthat have no exit edges.\n\ntestsuite:\n\t* g++.dg/opt/pr48273.C: New.\n\nFrom-SVN: r172175", "tree": {"sha": "b24f6232438679f7da43611698b485f6401bd044", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/b24f6232438679f7da43611698b485f6401bd044"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/07643d76c74845e250bdedca6b7148ebccff780b", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/07643d76c74845e250bdedca6b7148ebccff780b", "html_url": "https://github.com/Rust-GCC/gccrs/commit/07643d76c74845e250bdedca6b7148ebccff780b", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/07643d76c74845e250bdedca6b7148ebccff780b/comments", "author": {"login": "amonakov", "id": 1997391, "node_id": "MDQ6VXNlcjE5OTczOTE=", "avatar_url": "https://avatars.githubusercontent.com/u/1997391?v=4", "gravatar_id": "", "url": "https://api.github.com/users/amonakov", "html_url": "https://github.com/amonakov", "followers_url": "https://api.github.com/users/amonakov/followers", "following_url": "https://api.github.com/users/amonakov/following{/other_user}", "gists_url": "https://api.github.com/users/amonakov/gists{/gist_id}", "starred_url": "https://api.github.com/users/amonakov/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/amonakov/subscriptions", "organizations_url": "https://api.github.com/users/amonakov/orgs", "repos_url": "https://api.github.com/users/amonakov/repos", "events_url": "https://api.github.com/users/amonakov/events{/privacy}", "received_events_url": "https://api.github.com/users/amonakov/received_events", "type": "User", "site_admin": false}, "committer": null, "parents": [{"sha": "1f3b2b4e2914cbb5750e23acf609c5c5b7ca42a3", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/1f3b2b4e2914cbb5750e23acf609c5c5b7ca42a3", "html_url": "https://github.com/Rust-GCC/gccrs/commit/1f3b2b4e2914cbb5750e23acf609c5c5b7ca42a3"}], "stats": {"total": 36, "additions": 35, "deletions": 1}, "files": [{"sha": "523c3b704cf2534653f6bce9726dd2f9f929ae0b", "filename": "gcc/ChangeLog", "status": "modified", "additions": 9, "deletions": 0, "changes": 9, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/07643d76c74845e250bdedca6b7148ebccff780b/gcc%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/07643d76c74845e250bdedca6b7148ebccff780b/gcc%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2FChangeLog?ref=07643d76c74845e250bdedca6b7148ebccff780b", "patch": "@@ -1,3 +1,12 @@\n+2011-04-08  Alexander Monakov  <amonakov@ispras.ru>\n+\n+\tPR target/48273\n+\t* cfgloop.h (loop_has_exit_edges): New helper.\n+\t* sel-sched-ir.c (init_global_and_expr_for_insn): Make CALLs\n+\tnon-clonable.\n+\t* sel-sched.c (sel_setup_region_sched_flags): Don't pipeline loops\n+\tthat have no exit edges.\n+\n 2011-04-08  Alexander Monakov  <amonakov@ispras.ru>\n \n \tPR rtl-optimization/48442"}, {"sha": "0ff44de67d34154643b64dbedb1839899d6f1ec9", "filename": "gcc/cfgloop.h", "status": "modified", "additions": 8, "deletions": 0, "changes": 8, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/07643d76c74845e250bdedca6b7148ebccff780b/gcc%2Fcfgloop.h", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/07643d76c74845e250bdedca6b7148ebccff780b/gcc%2Fcfgloop.h", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fcfgloop.h?ref=07643d76c74845e250bdedca6b7148ebccff780b", "patch": "@@ -443,6 +443,14 @@ loop_outer (const struct loop *loop)\n   return VEC_index (loop_p, loop->superloops, n - 1);\n }\n \n+/* Returns true if LOOP has at least one exit edge.  */\n+\n+static inline bool\n+loop_has_exit_edges (const struct loop *loop)\n+{\n+  return loop->exits->next->e != NULL;\n+}\n+\n /* Returns the list of loops in current_loops.  */\n \n static inline VEC (loop_p, gc) *"}, {"sha": "95c1431001ed8db4813d1c7e5ff20d77e89e30bf", "filename": "gcc/sel-sched-ir.c", "status": "modified", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/07643d76c74845e250bdedca6b7148ebccff780b/gcc%2Fsel-sched-ir.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/07643d76c74845e250bdedca6b7148ebccff780b/gcc%2Fsel-sched-ir.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fsel-sched-ir.c?ref=07643d76c74845e250bdedca6b7148ebccff780b", "patch": "@@ -2905,6 +2905,7 @@ init_global_and_expr_for_insn (insn_t insn)\n       if (CANT_MOVE (insn)\n           || INSN_ASM_P (insn)\n           || SCHED_GROUP_P (insn)\n+\t  || CALL_P (insn)\n           /* Exception handling insns are always unique.  */\n           || (cfun->can_throw_non_call_exceptions && can_throw_internal (insn))\n           /* TRAP_IF though have an INSN code is control_flow_insn_p ().  */"}, {"sha": "fb1a026bf28a2657882853c2d4dac730f11b0440", "filename": "gcc/sel-sched.c", "status": "modified", "additions": 2, "deletions": 1, "changes": 3, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/07643d76c74845e250bdedca6b7148ebccff780b/gcc%2Fsel-sched.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/07643d76c74845e250bdedca6b7148ebccff780b/gcc%2Fsel-sched.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fsel-sched.c?ref=07643d76c74845e250bdedca6b7148ebccff780b", "patch": "@@ -6781,7 +6781,8 @@ sel_setup_region_sched_flags (void)\n   bookkeeping_p = 1;\n   pipelining_p = (bookkeeping_p\n                   && (flag_sel_sched_pipelining != 0)\n-\t\t  && current_loop_nest != NULL);\n+\t\t  && current_loop_nest != NULL\n+\t\t  && loop_has_exit_edges (current_loop_nest));\n   max_insns_to_rename = PARAM_VALUE (PARAM_SELSCHED_INSNS_TO_RENAME);\n   max_ws = MAX_WS;\n }"}, {"sha": "96c224fcfec6c4961067c1abf5bc623ef8e66d0e", "filename": "gcc/testsuite/ChangeLog", "status": "modified", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/07643d76c74845e250bdedca6b7148ebccff780b/gcc%2Ftestsuite%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/07643d76c74845e250bdedca6b7148ebccff780b/gcc%2Ftestsuite%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2FChangeLog?ref=07643d76c74845e250bdedca6b7148ebccff780b", "patch": "@@ -1,3 +1,8 @@\n+2011-04-08  Alexander Monakov  <amonakov@ispras.ru>\n+\n+\tPR target/48273\n+\t* g++.dg/opt/pr48273.C: New.\n+\n 2011-04-08  Alexander Monakov  <amonakov@ispras.ru>\n \n \tPR rtl-optimization/48442"}, {"sha": "4c5108bdd26b08a71c56db6dea8394d5aaa6e767", "filename": "gcc/testsuite/g++.dg/opt/pr48273.C", "status": "added", "additions": 10, "deletions": 0, "changes": 10, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/07643d76c74845e250bdedca6b7148ebccff780b/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Fopt%2Fpr48273.C", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/07643d76c74845e250bdedca6b7148ebccff780b/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Fopt%2Fpr48273.C", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Fopt%2Fpr48273.C?ref=07643d76c74845e250bdedca6b7148ebccff780b", "patch": "@@ -0,0 +1,10 @@\n+// { dg-do compile { target x86_64-*-* } }\n+// { dg-options \"-fschedule-insns2 -fsel-sched-pipelining -fselective-scheduling2 -funroll-all-loops -march=core2\" }\n+\n+void bar ();\n+\n+void foo ()\n+{\n+  for (;;)\n+    bar ();\n+}"}]}