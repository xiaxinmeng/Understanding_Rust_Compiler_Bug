{"sha": "b7675b592316cd5c2a972cb25c714fe85ec743c1", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6Yjc2NzViNTkyMzE2Y2Q1YzJhOTcyY2IyNWM3MTRmZTg1ZWM3NDNjMQ==", "commit": {"author": {"name": "Richard Biener", "email": "rguenther@suse.de", "date": "2017-07-27T13:46:07Z"}, "committer": {"name": "Richard Biener", "email": "rguenth@gcc.gnu.org", "date": "2017-07-27T13:46:07Z"}, "message": "re PR tree-optimization/81573 (wrong code at -O3 on x86_64-linux-gnu)\n\n2017-07-27  Richard Biener  <rguenther@suse.de>\n\n\tPR tree-optimization/81573\n\tPR tree-optimization/81494\n\t* tree-vect-loop.c (vect_create_epilog_for_reduction): Handle\n\tmulti defuse cycle case.\n\n\t* gcc.dg/torture/pr81573.c: New testcase.\n\nFrom-SVN: r250627", "tree": {"sha": "0a9f661b70c26d76e9840eed4e2be1147628c826", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/0a9f661b70c26d76e9840eed4e2be1147628c826"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/b7675b592316cd5c2a972cb25c714fe85ec743c1", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/b7675b592316cd5c2a972cb25c714fe85ec743c1", "html_url": "https://github.com/Rust-GCC/gccrs/commit/b7675b592316cd5c2a972cb25c714fe85ec743c1", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/b7675b592316cd5c2a972cb25c714fe85ec743c1/comments", "author": {"login": "rguenth", "id": 2046526, "node_id": "MDQ6VXNlcjIwNDY1MjY=", "avatar_url": "https://avatars.githubusercontent.com/u/2046526?v=4", "gravatar_id": "", "url": "https://api.github.com/users/rguenth", "html_url": "https://github.com/rguenth", "followers_url": "https://api.github.com/users/rguenth/followers", "following_url": "https://api.github.com/users/rguenth/following{/other_user}", "gists_url": "https://api.github.com/users/rguenth/gists{/gist_id}", "starred_url": "https://api.github.com/users/rguenth/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/rguenth/subscriptions", "organizations_url": "https://api.github.com/users/rguenth/orgs", "repos_url": "https://api.github.com/users/rguenth/repos", "events_url": "https://api.github.com/users/rguenth/events{/privacy}", "received_events_url": "https://api.github.com/users/rguenth/received_events", "type": "User", "site_admin": false}, "committer": null, "parents": [{"sha": "719488f819ceb7e7185bf324f04aa9030ba9c2ad", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/719488f819ceb7e7185bf324f04aa9030ba9c2ad", "html_url": "https://github.com/Rust-GCC/gccrs/commit/719488f819ceb7e7185bf324f04aa9030ba9c2ad"}], "stats": {"total": 62, "additions": 55, "deletions": 7}, "files": [{"sha": "77a77ebca7f5507483679bd8017bdc2f74ffcbb1", "filename": "gcc/ChangeLog", "status": "modified", "additions": 7, "deletions": 0, "changes": 7, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/b7675b592316cd5c2a972cb25c714fe85ec743c1/gcc%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/b7675b592316cd5c2a972cb25c714fe85ec743c1/gcc%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2FChangeLog?ref=b7675b592316cd5c2a972cb25c714fe85ec743c1", "patch": "@@ -1,3 +1,10 @@\n+2017-07-27  Richard Biener  <rguenther@suse.de>\n+\n+\tPR tree-optimization/81573\n+\tPR tree-optimization/81494\n+\t* tree-vect-loop.c (vect_create_epilog_for_reduction): Handle\n+\tmulti defuse cycle case.\n+\n 2017-07-27  Richard Biener  <rguenther@suse.de>\n \n \tPR tree-optimization/81571"}, {"sha": "fe0b88c84fed7cfc05eccc9f255d498e0f78e34e", "filename": "gcc/testsuite/ChangeLog", "status": "modified", "additions": 6, "deletions": 0, "changes": 6, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/b7675b592316cd5c2a972cb25c714fe85ec743c1/gcc%2Ftestsuite%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/b7675b592316cd5c2a972cb25c714fe85ec743c1/gcc%2Ftestsuite%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2FChangeLog?ref=b7675b592316cd5c2a972cb25c714fe85ec743c1", "patch": "@@ -1,3 +1,9 @@\n+2017-07-27  Richard Biener  <rguenther@suse.de>\n+\n+\tPR tree-optimization/81573\n+\tPR tree-optimization/81494\n+\t* gcc.dg/torture/pr81573.c: New testcase.\n+\n 2017-07-27  Richard Biener  <rguenther@suse.de>\n \n \tPR tree-optimization/81571"}, {"sha": "3f0904aa5ea90b3d8bc1fab77a01568d6ca95aae", "filename": "gcc/testsuite/gcc.dg/torture/pr81573.c", "status": "added", "additions": 16, "deletions": 0, "changes": 16, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/b7675b592316cd5c2a972cb25c714fe85ec743c1/gcc%2Ftestsuite%2Fgcc.dg%2Ftorture%2Fpr81573.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/b7675b592316cd5c2a972cb25c714fe85ec743c1/gcc%2Ftestsuite%2Fgcc.dg%2Ftorture%2Fpr81573.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgcc.dg%2Ftorture%2Fpr81573.c?ref=b7675b592316cd5c2a972cb25c714fe85ec743c1", "patch": "@@ -0,0 +1,16 @@\n+/* { dg-do run } */\n+\n+int a = 1, *c = &a, d;\n+char b;\n+\n+int main ()\n+{\n+  for (; b > -27; b--)\n+    {\n+      *c ^= b;\n+      *c ^= 1;\n+    }\n+  while (a > 1)\n+    ;\n+  return 0; \n+}"}, {"sha": "8740a7573acdd5e44777e5f8ca80ab2086685f8a", "filename": "gcc/tree-vect-loop.c", "status": "modified", "additions": 26, "deletions": 7, "changes": 33, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/b7675b592316cd5c2a972cb25c714fe85ec743c1/gcc%2Ftree-vect-loop.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/b7675b592316cd5c2a972cb25c714fe85ec743c1/gcc%2Ftree-vect-loop.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftree-vect-loop.c?ref=b7675b592316cd5c2a972cb25c714fe85ec743c1", "patch": "@@ -4787,20 +4787,17 @@ vect_create_epilog_for_reduction (vec<tree> vect_defs, gimple *stmt,\n   if (GROUP_FIRST_ELEMENT (vinfo_for_stmt (stmt)))\n     {\n       tree first_vect = PHI_RESULT (new_phis[0]);\n-      tree tmp;\n       gassign *new_vec_stmt = NULL;\n-\n       vec_dest = vect_create_destination_var (scalar_dest, vectype);\n       for (k = 1; k < new_phis.length (); k++)\n         {\n \t  gimple *next_phi = new_phis[k];\n           tree second_vect = PHI_RESULT (next_phi);\n-\n-          tmp = build2 (code, vectype,  first_vect, second_vect);\n-          new_vec_stmt = gimple_build_assign (vec_dest, tmp);\n-          first_vect = make_ssa_name (vec_dest, new_vec_stmt);\n-          gimple_assign_set_lhs (new_vec_stmt, first_vect);\n+          tree tem = make_ssa_name (vec_dest, new_vec_stmt);\n+          new_vec_stmt = gimple_build_assign (tem, code,\n+\t\t\t\t\t      first_vect, second_vect);\n           gsi_insert_before (&exit_gsi, new_vec_stmt, GSI_SAME_STMT);\n+\t  first_vect = tem;\n         }\n \n       new_phi_result = first_vect;\n@@ -4810,6 +4807,28 @@ vect_create_epilog_for_reduction (vec<tree> vect_defs, gimple *stmt,\n           new_phis.safe_push (new_vec_stmt);\n         }\n     }\n+  /* Likewise if we couldn't use a single defuse cycle.  */\n+  else if (ncopies > 1)\n+    {\n+      gcc_assert (new_phis.length () == 1);\n+      tree first_vect = PHI_RESULT (new_phis[0]);\n+      gassign *new_vec_stmt = NULL;\n+      vec_dest = vect_create_destination_var (scalar_dest, vectype);\n+      gimple *next_phi = new_phis[0];\n+      for (int k = 1; k < ncopies; ++k)\n+\t{\n+\t  next_phi = STMT_VINFO_RELATED_STMT (vinfo_for_stmt (next_phi));\n+\t  tree second_vect = PHI_RESULT (next_phi);\n+          tree tem = make_ssa_name (vec_dest, new_vec_stmt);\n+          new_vec_stmt = gimple_build_assign (tem, code,\n+\t\t\t\t\t      first_vect, second_vect);\n+          gsi_insert_before (&exit_gsi, new_vec_stmt, GSI_SAME_STMT);\n+\t  first_vect = tem;\n+\t}\n+      new_phi_result = first_vect;\n+      new_phis.truncate (0);\n+      new_phis.safe_push (new_vec_stmt);\n+    }\n   else\n     new_phi_result = PHI_RESULT (new_phis[0]);\n "}]}