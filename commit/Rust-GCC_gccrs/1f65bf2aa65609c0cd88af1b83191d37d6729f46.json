{"sha": "1f65bf2aa65609c0cd88af1b83191d37d6729f46", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6MWY2NWJmMmFhNjU2MDljMGNkODhhZjFiODMxOTFkMzdkNjcyOWY0Ng==", "commit": {"author": {"name": "Ville Voutilainen", "email": "ville.voutilainen@gmail.com", "date": "2020-10-17T19:08:50Z"}, "committer": {"name": "Ville Voutilainen", "email": "ville.voutilainen@gmail.com", "date": "2020-10-17T20:10:40Z"}, "message": "libstdc++: Fix visitor return type diagnostics [PR97449]\n\nlibstdc++-v3/ChangeLog:\n\n\tPR libstdc++/97449\n\t* include/std/variant\n\t(__gen_vtable_impl<>::_S_apply_single_alt):\n\tDiagnose visitor return type mismatches here..\n\t(__gen_vtable_impl</*base case*/>::_S_apply):\n\t..not here.", "tree": {"sha": "0208e7f53eb1b3ff2b0fde31d952adc894132ff4", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/0208e7f53eb1b3ff2b0fde31d952adc894132ff4"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/1f65bf2aa65609c0cd88af1b83191d37d6729f46", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/1f65bf2aa65609c0cd88af1b83191d37d6729f46", "html_url": "https://github.com/Rust-GCC/gccrs/commit/1f65bf2aa65609c0cd88af1b83191d37d6729f46", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/1f65bf2aa65609c0cd88af1b83191d37d6729f46/comments", "author": {"login": "villevoutilainen", "id": 963599, "node_id": "MDQ6VXNlcjk2MzU5OQ==", "avatar_url": "https://avatars.githubusercontent.com/u/963599?v=4", "gravatar_id": "", "url": "https://api.github.com/users/villevoutilainen", "html_url": "https://github.com/villevoutilainen", "followers_url": "https://api.github.com/users/villevoutilainen/followers", "following_url": "https://api.github.com/users/villevoutilainen/following{/other_user}", "gists_url": "https://api.github.com/users/villevoutilainen/gists{/gist_id}", "starred_url": "https://api.github.com/users/villevoutilainen/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/villevoutilainen/subscriptions", "organizations_url": "https://api.github.com/users/villevoutilainen/orgs", "repos_url": "https://api.github.com/users/villevoutilainen/repos", "events_url": "https://api.github.com/users/villevoutilainen/events{/privacy}", "received_events_url": "https://api.github.com/users/villevoutilainen/received_events", "type": "User", "site_admin": false}, "committer": {"login": "villevoutilainen", "id": 963599, "node_id": "MDQ6VXNlcjk2MzU5OQ==", "avatar_url": "https://avatars.githubusercontent.com/u/963599?v=4", "gravatar_id": "", "url": "https://api.github.com/users/villevoutilainen", "html_url": "https://github.com/villevoutilainen", "followers_url": "https://api.github.com/users/villevoutilainen/followers", "following_url": "https://api.github.com/users/villevoutilainen/following{/other_user}", "gists_url": "https://api.github.com/users/villevoutilainen/gists{/gist_id}", "starred_url": "https://api.github.com/users/villevoutilainen/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/villevoutilainen/subscriptions", "organizations_url": "https://api.github.com/users/villevoutilainen/orgs", "repos_url": "https://api.github.com/users/villevoutilainen/repos", "events_url": "https://api.github.com/users/villevoutilainen/events{/privacy}", "received_events_url": "https://api.github.com/users/villevoutilainen/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "f476a9fe912132abf06c2832a1bb9abe6c1a1bb1", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/f476a9fe912132abf06c2832a1bb9abe6c1a1bb1", "html_url": "https://github.com/Rust-GCC/gccrs/commit/f476a9fe912132abf06c2832a1bb9abe6c1a1bb1"}], "stats": {"total": 12, "additions": 7, "deletions": 5}, "files": [{"sha": "17f8bcd638b80926f609cfae2149c7e6d202f0fb", "filename": "libstdc++-v3/include/std/variant", "status": "modified", "additions": 7, "deletions": 5, "changes": 12, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/1f65bf2aa65609c0cd88af1b83191d37d6729f46/libstdc%2B%2B-v3%2Finclude%2Fstd%2Fvariant", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/1f65bf2aa65609c0cd88af1b83191d37d6729f46/libstdc%2B%2B-v3%2Finclude%2Fstd%2Fvariant", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libstdc%2B%2B-v3%2Finclude%2Fstd%2Fvariant?ref=1f65bf2aa65609c0cd88af1b83191d37d6729f46", "patch": "@@ -960,9 +960,13 @@ namespace __variant\n \t    }\n \t  else\n \t    {\n-\t      __element = __gen_vtable_impl<\n+\t      auto __tmp_element = __gen_vtable_impl<\n \t\tremove_reference_t<decltype(__element)>,\n \t\tstd::index_sequence<__indices..., __index>>::_S_apply();\n+\t      static_assert(is_same_v<_Tp, decltype(__tmp_element)>,\n+\t\t\t    \"std::visit requires the visitor to have the same \"\n+\t\t\t    \"return type for all alternatives of a variant\");\n+\t      __element = __tmp_element;\n \t    }\n \t}\n     };\n@@ -1026,10 +1030,8 @@ namespace __variant\n \t\t\t\t    std::declval<_Variants>()...))>;\n \t    if constexpr (__visit_ret_type_mismatch)\n \t      {\n-\t\tstatic_assert(!__visit_ret_type_mismatch,\n-\t\t  \"std::visit requires the visitor to have the same \"\n-\t\t  \"return type for all alternatives of a variant\");\n-\t\treturn __nonesuch{};\n+\t\tstruct __cannot_match {};\n+\t\treturn __cannot_match{};\n \t      }\n \t    else\n \t      return _Array_type{&__visit_invoke};"}]}