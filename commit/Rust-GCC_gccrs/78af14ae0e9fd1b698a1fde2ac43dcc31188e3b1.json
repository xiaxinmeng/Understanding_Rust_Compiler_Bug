{"sha": "78af14ae0e9fd1b698a1fde2ac43dcc31188e3b1", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6NzhhZjE0YWUwZTlmZDFiNjk4YTFmZGUyYWM0M2RjYzMxMTg4ZTNiMQ==", "commit": {"author": {"name": "Marek Polacek", "email": "polacek@redhat.com", "date": "2017-02-22T19:31:49Z"}, "committer": {"name": "Marek Polacek", "email": "mpolacek@gcc.gnu.org", "date": "2017-02-22T19:31:49Z"}, "message": "re PR c++/79653 (ICE on invalid c++ code in cp_check_const_attributes in cp/decl2.c:1423)\n\n\tPR c++/79653\n\t* parser.c (cp_parser_std_attribute_spec): Don't build the attribute\n\tif the alignas expression is erroneous.\n\t* pt.c (tsubst_attribute): If tsubst_pack_expansion fails, return\n\terror_mark_node.\n\n\t* g++.dg/cpp0x/alignas10.C: New test.\n\t* g++.dg/cpp0x/alignas9.C: New test.\n\nFrom-SVN: r245657", "tree": {"sha": "c8ac56e87a30aaa556489b6ede9d585044030122", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/c8ac56e87a30aaa556489b6ede9d585044030122"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/78af14ae0e9fd1b698a1fde2ac43dcc31188e3b1", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/78af14ae0e9fd1b698a1fde2ac43dcc31188e3b1", "html_url": "https://github.com/Rust-GCC/gccrs/commit/78af14ae0e9fd1b698a1fde2ac43dcc31188e3b1", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/78af14ae0e9fd1b698a1fde2ac43dcc31188e3b1/comments", "author": {"login": "mpolacek", "id": 10496300, "node_id": "MDQ6VXNlcjEwNDk2MzAw", "avatar_url": "https://avatars.githubusercontent.com/u/10496300?v=4", "gravatar_id": "", "url": "https://api.github.com/users/mpolacek", "html_url": "https://github.com/mpolacek", "followers_url": "https://api.github.com/users/mpolacek/followers", "following_url": "https://api.github.com/users/mpolacek/following{/other_user}", "gists_url": "https://api.github.com/users/mpolacek/gists{/gist_id}", "starred_url": "https://api.github.com/users/mpolacek/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/mpolacek/subscriptions", "organizations_url": "https://api.github.com/users/mpolacek/orgs", "repos_url": "https://api.github.com/users/mpolacek/repos", "events_url": "https://api.github.com/users/mpolacek/events{/privacy}", "received_events_url": "https://api.github.com/users/mpolacek/received_events", "type": "User", "site_admin": false}, "committer": null, "parents": [{"sha": "3b2a007843c9ccb740b05980358f13c75dc296b0", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/3b2a007843c9ccb740b05980358f13c75dc296b0", "html_url": "https://github.com/Rust-GCC/gccrs/commit/3b2a007843c9ccb740b05980358f13c75dc296b0"}], "stats": {"total": 34, "additions": 34, "deletions": 0}, "files": [{"sha": "38b60bc695f3595128983eac573dd2ceeb952c87", "filename": "gcc/cp/ChangeLog", "status": "modified", "additions": 8, "deletions": 0, "changes": 8, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/78af14ae0e9fd1b698a1fde2ac43dcc31188e3b1/gcc%2Fcp%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/78af14ae0e9fd1b698a1fde2ac43dcc31188e3b1/gcc%2Fcp%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fcp%2FChangeLog?ref=78af14ae0e9fd1b698a1fde2ac43dcc31188e3b1", "patch": "@@ -1,3 +1,11 @@\n+2017-02-22  Marek Polacek  <polacek@redhat.com>\n+\n+\tPR c++/79653\n+\t* parser.c (cp_parser_std_attribute_spec): Don't build the attribute\n+\tif the alignas expression is erroneous.\n+\t* pt.c (tsubst_attribute): If tsubst_pack_expansion fails, return\n+\terror_mark_node.\n+\n 2017-02-21  Jason Merrill  <jason@redhat.com>\n \n \tPR c++/50308 - wrong deprecated warning with ADL"}, {"sha": "e20257c5bf9888f1b68515c6fb1ca916880d8ea4", "filename": "gcc/cp/parser.c", "status": "modified", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/78af14ae0e9fd1b698a1fde2ac43dcc31188e3b1/gcc%2Fcp%2Fparser.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/78af14ae0e9fd1b698a1fde2ac43dcc31188e3b1/gcc%2Fcp%2Fparser.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fcp%2Fparser.c?ref=78af14ae0e9fd1b698a1fde2ac43dcc31188e3b1", "patch": "@@ -24977,12 +24977,17 @@ cp_parser_std_attribute_spec (cp_parser *parser)\n       alignas_expr = cxx_alignas_expr (alignas_expr);\n       alignas_expr = build_tree_list (NULL_TREE, alignas_expr);\n \n+      /* Handle alignas (pack...).  */\n       if (cp_lexer_next_token_is (parser->lexer, CPP_ELLIPSIS))\n \t{\n \t  cp_lexer_consume_token (parser->lexer);\n \t  alignas_expr = make_pack_expansion (alignas_expr);\n \t}\n \n+      /* Something went wrong, so don't build the attribute.  */\n+      if (alignas_expr == error_mark_node)\n+\treturn error_mark_node;\n+\n       if (cp_parser_require (parser, CPP_CLOSE_PAREN, RT_CLOSE_PAREN) == NULL)\n \t{\n \t  cp_parser_error (parser, \"expected %<)%>\");"}, {"sha": "5b0f62d3832b014ed9520f0d41a927eb5fd348e1", "filename": "gcc/cp/pt.c", "status": "modified", "additions": 2, "deletions": 0, "changes": 2, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/78af14ae0e9fd1b698a1fde2ac43dcc31188e3b1/gcc%2Fcp%2Fpt.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/78af14ae0e9fd1b698a1fde2ac43dcc31188e3b1/gcc%2Fcp%2Fpt.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fcp%2Fpt.c?ref=78af14ae0e9fd1b698a1fde2ac43dcc31188e3b1", "patch": "@@ -10012,6 +10012,8 @@ tsubst_attribute (tree t, tree *decl_p, tree args,\n       /* An attribute pack expansion.  */\n       tree purp = TREE_PURPOSE (t);\n       tree pack = tsubst_pack_expansion (val, args, complain, in_decl);\n+      if (pack == error_mark_node)\n+\treturn error_mark_node;\n       int len = TREE_VEC_LENGTH (pack);\n       tree list = NULL_TREE;\n       tree *q = &list;"}, {"sha": "628529b535cd0ad99cf0fd5273d2ed4f09015ff5", "filename": "gcc/testsuite/ChangeLog", "status": "modified", "additions": 6, "deletions": 0, "changes": 6, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/78af14ae0e9fd1b698a1fde2ac43dcc31188e3b1/gcc%2Ftestsuite%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/78af14ae0e9fd1b698a1fde2ac43dcc31188e3b1/gcc%2Ftestsuite%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2FChangeLog?ref=78af14ae0e9fd1b698a1fde2ac43dcc31188e3b1", "patch": "@@ -1,3 +1,9 @@\n+2017-02-22  Marek Polacek  <polacek@redhat.com>\n+\n+\tPR c++/79653\n+\t* g++.dg/cpp0x/alignas10.C: New test.\n+\t* g++.dg/cpp0x/alignas9.C: New test.\n+\n 2017-02-22  Jakub Jelinek  <jakub@redhat.com>\n \n \tPR target/70465"}, {"sha": "164994eb12b967fa9290b40c4eb9b67c550a5553", "filename": "gcc/testsuite/g++.dg/cpp0x/alignas10.C", "status": "added", "additions": 7, "deletions": 0, "changes": 7, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/78af14ae0e9fd1b698a1fde2ac43dcc31188e3b1/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Fcpp0x%2Falignas10.C", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/78af14ae0e9fd1b698a1fde2ac43dcc31188e3b1/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Fcpp0x%2Falignas10.C", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Fcpp0x%2Falignas10.C?ref=78af14ae0e9fd1b698a1fde2ac43dcc31188e3b1", "patch": "@@ -0,0 +1,7 @@\n+// PR c++/79653\n+// { dg-do compile { target c++11 } }\n+\n+template <typename... A> struct outer {\n+  template <typename... B> struct alignas(alignof(A) * alignof(B)...) inner {}; // { dg-error \"mismatched argument pack lengths\" }\n+};\n+outer<int>::inner<> mismatched_packs;"}, {"sha": "98fe7077582f0f07791c9aa9c838af19f7ad0ef8", "filename": "gcc/testsuite/g++.dg/cpp0x/alignas9.C", "status": "added", "additions": 6, "deletions": 0, "changes": 6, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/78af14ae0e9fd1b698a1fde2ac43dcc31188e3b1/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Fcpp0x%2Falignas9.C", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/78af14ae0e9fd1b698a1fde2ac43dcc31188e3b1/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Fcpp0x%2Falignas9.C", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Fcpp0x%2Falignas9.C?ref=78af14ae0e9fd1b698a1fde2ac43dcc31188e3b1", "patch": "@@ -0,0 +1,6 @@\n+// PR c++/79653\n+// { dg-do compile { target c++11 } }\n+\n+template <typename... T>\n+struct A { alignas(int...) char c; }; // { dg-error \"no argument packs|expected\" }\n+A<int, double> a;"}]}