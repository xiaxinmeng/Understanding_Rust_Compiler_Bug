{"sha": "b66cf46e4d410cb19a3529efa2ffda289848298d", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6YjY2Y2Y0NmU0ZDQxMGNiMTlhMzUyOWVmYTJmZmRhMjg5ODQ4Mjk4ZA==", "commit": {"author": {"name": "Ulrich Weigand", "email": "uweigand@de.ibm.com", "date": "2011-10-21T01:27:36Z"}, "committer": {"name": "Ulrich Weigand", "email": "uweigand@gcc.gnu.org", "date": "2011-10-21T01:27:36Z"}, "message": "spu.md (\"vec_permv16qi\"): Reduce selector modulo 32 before using the shufb instruction.\n\n\t* config/spu/spu.md (\"vec_permv16qi\"): Reduce selector modulo 32\n\tbefore using the shufb instruction.\n\nFrom-SVN: r180283", "tree": {"sha": "957c6c40ee40385030690d332b7b1c12a97926bb", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/957c6c40ee40385030690d332b7b1c12a97926bb"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/b66cf46e4d410cb19a3529efa2ffda289848298d", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/b66cf46e4d410cb19a3529efa2ffda289848298d", "html_url": "https://github.com/Rust-GCC/gccrs/commit/b66cf46e4d410cb19a3529efa2ffda289848298d", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/b66cf46e4d410cb19a3529efa2ffda289848298d/comments", "author": null, "committer": null, "parents": [{"sha": "d2a80c9fbd5e17f2923dbe9f84dea940e5f540e7", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/d2a80c9fbd5e17f2923dbe9f84dea940e5f540e7", "html_url": "https://github.com/Rust-GCC/gccrs/commit/d2a80c9fbd5e17f2923dbe9f84dea940e5f540e7"}], "stats": {"total": 17, "additions": 14, "deletions": 3}, "files": [{"sha": "3b5fc23e90633670aaded7e45e6c3b9ed672a71a", "filename": "gcc/ChangeLog", "status": "modified", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/b66cf46e4d410cb19a3529efa2ffda289848298d/gcc%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/b66cf46e4d410cb19a3529efa2ffda289848298d/gcc%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2FChangeLog?ref=b66cf46e4d410cb19a3529efa2ffda289848298d", "patch": "@@ -1,3 +1,8 @@\n+2011-10-20  Ulrich Weigand  <Ulrich.Weigand@de.ibm.com>\n+\n+\t* config/spu/spu.md (\"vec_permv16qi\"): Reduce selector modulo 32\n+\tbefore using the shufb instruction.\n+\n 2011-10-20  Kirill Yukhin  <kirill.yukhin@intel.com>\n \n \tPR target/50766"}, {"sha": "ca2cad9ba54aedfb4bd024e375c5589715dc1214", "filename": "gcc/config/spu/spu.md", "status": "modified", "additions": 9, "deletions": 3, "changes": 12, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/b66cf46e4d410cb19a3529efa2ffda289848298d/gcc%2Fconfig%2Fspu%2Fspu.md", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/b66cf46e4d410cb19a3529efa2ffda289848298d/gcc%2Fconfig%2Fspu%2Fspu.md", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fconfig%2Fspu%2Fspu.md?ref=b66cf46e4d410cb19a3529efa2ffda289848298d", "patch": "@@ -4395,16 +4395,22 @@ selb\\t%0,%4,%0,%3\"\n   \"shufb\\t%0,%1,%2,%3\"\n   [(set_attr \"type\" \"shuf\")])\n \n+; The semantics of vec_permv16qi are nearly identical to those of the SPU\n+; shufb instruction, except that we need to reduce the selector modulo 32.\n (define_expand \"vec_permv16qi\"\n-  [(set (match_operand:V16QI 0 \"spu_reg_operand\" \"\")\n+  [(set (match_dup 4) (and:V16QI (match_operand:V16QI 3 \"spu_reg_operand\" \"\")\n+                                 (match_dup 6)))\n+   (set (match_operand:V16QI 0 \"spu_reg_operand\" \"\")\n \t(unspec:V16QI\n \t  [(match_operand:V16QI 1 \"spu_reg_operand\" \"\")\n \t   (match_operand:V16QI 2 \"spu_reg_operand\" \"\")\n-\t   (match_operand:V16QI 3 \"spu_reg_operand\" \"\")]\n+\t   (match_dup 5)]\n \t  UNSPEC_SHUFB))]\n   \"\"\n   {\n-    operands[3] = gen_lowpart (TImode, operands[3]);\n+    operands[4] = gen_reg_rtx (V16QImode);\n+    operands[5] = gen_lowpart (TImode, operands[4]);\n+    operands[6] = spu_const (V16QImode, 31);\n   })\n \n (define_insn \"nop\""}]}