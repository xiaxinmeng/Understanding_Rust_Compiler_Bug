{"sha": "ef834ed9da2903adc3ecf4b33ada4e85c08dd394", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6ZWY4MzRlZDlkYTI5MDNhZGMzZWNmNGIzM2FkYTRlODVjMDhkZDM5NA==", "commit": {"author": {"name": "Kelvin Nilsen", "email": "kelvin@gcc.gnu.org", "date": "2020-05-11T13:44:48Z"}, "committer": {"name": "Bill Schmidt", "email": "wschmidt@linux.ibm.com", "date": "2020-05-11T13:44:48Z"}, "message": "rs6000: powerpc_future_ok and powerpc_future_hw\n\nDejagnu targets for these.\n\n2020-05-11  Kelvin Nilsen  <kelvin@gcc.gnu.org>\n\n\t* gcc.target/powerpc/dg-future-0.c: New.\n\t* gcc.target/powerpc/dg-future-1.c: New.\n\t* lib/target-supports.exp (check_powerpc_future_hw_available):\n\tReplace -mfuture with -mcpu=future.\n\t(check_effective_target_powerpc_future_ok): Likewise.\n\t(is-effective-target): Add powerpc_future_hw.", "tree": {"sha": "824e5e1b7f8b2ddb4af1e4990d0fb10ee2d78e76", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/824e5e1b7f8b2ddb4af1e4990d0fb10ee2d78e76"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/ef834ed9da2903adc3ecf4b33ada4e85c08dd394", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/ef834ed9da2903adc3ecf4b33ada4e85c08dd394", "html_url": "https://github.com/Rust-GCC/gccrs/commit/ef834ed9da2903adc3ecf4b33ada4e85c08dd394", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/ef834ed9da2903adc3ecf4b33ada4e85c08dd394/comments", "author": null, "committer": null, "parents": [{"sha": "ffeb6554bee0f5c3bf2f823aeb1af5c0b3f3cb00", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/ffeb6554bee0f5c3bf2f823aeb1af5c0b3f3cb00", "html_url": "https://github.com/Rust-GCC/gccrs/commit/ffeb6554bee0f5c3bf2f823aeb1af5c0b3f3cb00"}], "stats": {"total": 38, "additions": 36, "deletions": 2}, "files": [{"sha": "abfda82a684006e9299a13885e42613e4bf1ecfa", "filename": "gcc/testsuite/gcc.target/powerpc/dg-future-0.c", "status": "added", "additions": 14, "deletions": 0, "changes": 14, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/ef834ed9da2903adc3ecf4b33ada4e85c08dd394/gcc%2Ftestsuite%2Fgcc.target%2Fpowerpc%2Fdg-future-0.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/ef834ed9da2903adc3ecf4b33ada4e85c08dd394/gcc%2Ftestsuite%2Fgcc.target%2Fpowerpc%2Fdg-future-0.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgcc.target%2Fpowerpc%2Fdg-future-0.c?ref=ef834ed9da2903adc3ecf4b33ada4e85c08dd394", "patch": "@@ -0,0 +1,14 @@\n+/* { dg-do compile { target { powerpc*-*-* } } } */\n+/* { dg-options \"-mdejagnu-cpu=future\" } */\n+\n+/* This tests that powerpc_future_ok works.  */\n+\n+extern void abort (void);\n+\n+int futurity (void) {\n+  long int e = -1;\n+  asm (\"pli %0,%1\": \"+r\" (e) : \"n\" (0x12345));\n+  return (e == 0x12345);\n+}\n+\n+/* { dg-final { scan-assembler {\\mpli\\M} } } */"}, {"sha": "6087fe7c894b0ba6fab4aa6290256b9acd891f24", "filename": "gcc/testsuite/gcc.target/powerpc/dg-future-1.c", "status": "added", "additions": 19, "deletions": 0, "changes": 19, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/ef834ed9da2903adc3ecf4b33ada4e85c08dd394/gcc%2Ftestsuite%2Fgcc.target%2Fpowerpc%2Fdg-future-1.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/ef834ed9da2903adc3ecf4b33ada4e85c08dd394/gcc%2Ftestsuite%2Fgcc.target%2Fpowerpc%2Fdg-future-1.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgcc.target%2Fpowerpc%2Fdg-future-1.c?ref=ef834ed9da2903adc3ecf4b33ada4e85c08dd394", "patch": "@@ -0,0 +1,19 @@\n+/* { dg-do run { target { powerpc*-*-* } } } */\n+/* { dg-require-effective-target powerpc_future_hw } */\n+/* { dg-options \"-mdejagnu-cpu=future\" } */\n+\n+/* This tests that powerpc_future_hw works.  */\n+\n+extern void abort (void);\n+\n+int futurity (void) {\n+  long int e = -1;\n+  asm (\"pli %0,%1\": \"+r\" (e) : \"n\" (0x12345));\n+  return (e == 0x12345);\n+}\n+\n+int main (int argc, char *argv [])\n+{\n+  if (!futurity ())\n+    abort ();\n+}"}, {"sha": "3a6ab8740c3d3579f934c21920634ffab41992d3", "filename": "gcc/testsuite/lib/target-supports.exp", "status": "modified", "additions": 3, "deletions": 2, "changes": 5, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/ef834ed9da2903adc3ecf4b33ada4e85c08dd394/gcc%2Ftestsuite%2Flib%2Ftarget-supports.exp", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/ef834ed9da2903adc3ecf4b33ada4e85c08dd394/gcc%2Ftestsuite%2Flib%2Ftarget-supports.exp", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Flib%2Ftarget-supports.exp?ref=ef834ed9da2903adc3ecf4b33ada4e85c08dd394", "patch": "@@ -2203,7 +2203,7 @@ proc check_powerpc_future_hw_available { } {\n \t\tasm (\"pli %0,%1\" : \"+r\" (e) : \"n\" (0x12345));\n \t\treturn (e == 0x12345);\n \t    }\n-\t} \"-mfuture\"\n+\t} \"-mcpu=future\"\n     }]\n }\n \n@@ -5815,7 +5815,7 @@ proc check_effective_target_powerpc_future_ok { } {\n \t\tasm (\"pli %0,%1\" : \"=r\" (e) : \"n\" (0x12345));\n \t\treturn e;\n \t    }\n-\t} \"-mfuture\"]\n+\t} \"-mcpu=future\"]\n     } else {\n \treturn 0\n     }\n@@ -7762,6 +7762,7 @@ proc is-effective-target { arg } {\n \t  \"named_sections\" { set selected [check_named_sections_available] }\n \t  \"gc_sections\"    { set selected [check_gc_sections_available] }\n \t  \"cxa_atexit\"     { set selected [check_cxa_atexit_available] }\n+\t  \"powerpc_future_hw\" { set selected [check_powerpc_future_hw_available] }\n \t  default          { error \"unknown effective target keyword `$arg'\" }\n \t}\n     }"}]}