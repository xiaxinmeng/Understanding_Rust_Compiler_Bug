{"sha": "098db05ef4e65f466788dac6006c4e4da9cdf3f8", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6MDk4ZGIwNWVmNGU2NWY0NjY3ODhkYWM2MDA2YzRlNGRhOWNkZjNmOA==", "commit": {"author": {"name": "Jakub Jelinek", "email": "jakub@redhat.com", "date": "2010-10-04T22:02:28Z"}, "committer": {"name": "Jakub Jelinek", "email": "jakub@gcc.gnu.org", "date": "2010-10-04T22:02:28Z"}, "message": "re PR debug/45849 (ICE: in emit_note_insn_var_location, at var-tracking.c:7336 with -O -g)\n\n\tPR debug/45849\n\t* var-tracking.c (strip_pointer_flags): New function.\n\t(emit_note_insn_var_location): If rtx_equal_p check failed,\n\tretry on locations simplified with simplify_replace_fn_rtx\n\tand strip_pointer_flags as its callback.\n\n\t* gcc.dg/debug/pr45849.c: New test.\n\nFrom-SVN: r164962", "tree": {"sha": "f54dcafd52295b4f2158bf0f8bd42e684f418501", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/f54dcafd52295b4f2158bf0f8bd42e684f418501"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/098db05ef4e65f466788dac6006c4e4da9cdf3f8", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/098db05ef4e65f466788dac6006c4e4da9cdf3f8", "html_url": "https://github.com/Rust-GCC/gccrs/commit/098db05ef4e65f466788dac6006c4e4da9cdf3f8", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/098db05ef4e65f466788dac6006c4e4da9cdf3f8/comments", "author": {"login": "jakubjelinek", "id": 9370665, "node_id": "MDQ6VXNlcjkzNzA2NjU=", "avatar_url": "https://avatars.githubusercontent.com/u/9370665?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jakubjelinek", "html_url": "https://github.com/jakubjelinek", "followers_url": "https://api.github.com/users/jakubjelinek/followers", "following_url": "https://api.github.com/users/jakubjelinek/following{/other_user}", "gists_url": "https://api.github.com/users/jakubjelinek/gists{/gist_id}", "starred_url": "https://api.github.com/users/jakubjelinek/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jakubjelinek/subscriptions", "organizations_url": "https://api.github.com/users/jakubjelinek/orgs", "repos_url": "https://api.github.com/users/jakubjelinek/repos", "events_url": "https://api.github.com/users/jakubjelinek/events{/privacy}", "received_events_url": "https://api.github.com/users/jakubjelinek/received_events", "type": "User", "site_admin": false}, "committer": null, "parents": [{"sha": "b3b9f3d0a808a2e0773e90d70dff2048270cc359", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/b3b9f3d0a808a2e0773e90d70dff2048270cc359", "html_url": "https://github.com/Rust-GCC/gccrs/commit/b3b9f3d0a808a2e0773e90d70dff2048270cc359"}], "stats": {"total": 72, "additions": 70, "deletions": 2}, "files": [{"sha": "a949d2e26fe6e7715de8ad58c2245452fdce48a6", "filename": "gcc/ChangeLog", "status": "modified", "additions": 8, "deletions": 0, "changes": 8, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/098db05ef4e65f466788dac6006c4e4da9cdf3f8/gcc%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/098db05ef4e65f466788dac6006c4e4da9cdf3f8/gcc%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2FChangeLog?ref=098db05ef4e65f466788dac6006c4e4da9cdf3f8", "patch": "@@ -1,3 +1,11 @@\n+2010-10-04  Jakub Jelinek  <jakub@redhat.com>\n+\n+\tPR debug/45849\n+\t* var-tracking.c (strip_pointer_flags): New function.\n+\t(emit_note_insn_var_location): If rtx_equal_p check failed,\n+\tretry on locations simplified with simplify_replace_fn_rtx\n+\tand strip_pointer_flags as its callback.\n+\n 2010-10-04  Jan Hubicka  <jh@suse.cz>\n \n \t* gimple-fold.c (static_object_in_other_unit_p): Rename to..."}, {"sha": "1a21e0eeb3d3a54dfe8a609ad81840bb9c7abde6", "filename": "gcc/testsuite/ChangeLog", "status": "modified", "additions": 3, "deletions": 0, "changes": 3, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/098db05ef4e65f466788dac6006c4e4da9cdf3f8/gcc%2Ftestsuite%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/098db05ef4e65f466788dac6006c4e4da9cdf3f8/gcc%2Ftestsuite%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2FChangeLog?ref=098db05ef4e65f466788dac6006c4e4da9cdf3f8", "patch": "@@ -1,5 +1,8 @@\n 2010-10-04  Jakub Jelinek  <jakub@redhat.com>\n \n+\tPR debug/45849\n+\t* gcc.dg/debug/pr45849.c: New test.\n+\n \tPR middle-end/45876\n \t* gcc.c-torture/compile/pr45876.c: New test.\n "}, {"sha": "93279b7081c7b7d70cb8ace2397d24036831aac5", "filename": "gcc/testsuite/gcc.dg/debug/pr45849.c", "status": "added", "additions": 31, "deletions": 0, "changes": 31, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/098db05ef4e65f466788dac6006c4e4da9cdf3f8/gcc%2Ftestsuite%2Fgcc.dg%2Fdebug%2Fpr45849.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/098db05ef4e65f466788dac6006c4e4da9cdf3f8/gcc%2Ftestsuite%2Fgcc.dg%2Fdebug%2Fpr45849.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgcc.dg%2Fdebug%2Fpr45849.c?ref=098db05ef4e65f466788dac6006c4e4da9cdf3f8", "patch": "@@ -0,0 +1,31 @@\n+/* PR debug/45849 */\n+/* { dg-do compile } */\n+/* { dg-options \"-g -Wno-uninitialized\" } */\n+\n+extern void bar (void);\n+\n+void\n+foo (long repllen, char *rp)\n+{\n+  char *matchend;\n+  char *scan;\n+  long len;\n+  char *matchstart;\n+  char *text;\n+  char *t;\n+\n+  repllen--;\n+\n+  for (;;)\n+    {\n+      matchstart = t + rp[0];\n+      matchend = rp;\n+      len = matchstart - text + repllen * (matchend - matchstart);\n+      while (len)\n+\t;\n+      for (scan = text; scan != rp; scan++)\n+\tbar ();\n+      if (matchstart)\n+\ttext = matchend;\n+    }\n+}"}, {"sha": "c74ef7cd649e5a470f555054bc4850c01d55fd89", "filename": "gcc/var-tracking.c", "status": "modified", "additions": 28, "deletions": 2, "changes": 30, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/098db05ef4e65f466788dac6006c4e4da9cdf3f8/gcc%2Fvar-tracking.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/098db05ef4e65f466788dac6006c4e4da9cdf3f8/gcc%2Fvar-tracking.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fvar-tracking.c?ref=098db05ef4e65f466788dac6006c4e4da9cdf3f8", "patch": "@@ -7133,6 +7133,19 @@ vt_expand_loc_dummy (rtx loc, htab_t vars, bool *pcur_loc_changed)\n #ifdef ENABLE_RTL_CHECKING\n /* Used to verify that cur_loc_changed updating is safe.  */\n static struct pointer_map_t *emitted_notes;\n+\n+/* Strip REG_POINTER from REGs and MEM_POINTER from MEMs in order to\n+   avoid differences in commutative operand simplification.  */\n+static rtx\n+strip_pointer_flags (rtx x, const_rtx old_rtx ATTRIBUTE_UNUSED,\n+\t\t     void *data ATTRIBUTE_UNUSED)\n+{\n+  if (REG_P (x) && REG_POINTER (x))\n+    return gen_rtx_REG (GET_MODE (x), REGNO (x));\n+  if (MEM_P (x) && MEM_POINTER (x))\n+    return gen_rtx_MEM (GET_MODE (x), XEXP (x, 0));\n+  return NULL_RTX;\n+}\n #endif\n \n /* Emit the NOTE_INSN_VAR_LOCATION for variable *VARP.  DATA contains\n@@ -7331,9 +7344,22 @@ emit_note_insn_var_location (void **varp, void *data)\n       rtx pnote = (rtx) *note_slot;\n       if (!var->cur_loc_changed && (pnote || PAT_VAR_LOCATION_LOC (note_vl)))\n \t{\n+\t  rtx old_vl, new_vl;\n \t  gcc_assert (pnote);\n-\t  gcc_assert (rtx_equal_p (PAT_VAR_LOCATION_LOC (pnote),\n-\t\t\t\t   PAT_VAR_LOCATION_LOC (note_vl)));\n+\t  old_vl = PAT_VAR_LOCATION_LOC (pnote);\n+\t  new_vl = PAT_VAR_LOCATION_LOC (note_vl);\n+\t  if (!rtx_equal_p (old_vl, new_vl))\n+\t    {\n+\t      /* There might be differences caused by REG_POINTER\n+\t\t differences.  REG_POINTER affects\n+\t\t swap_commutative_operands_p.  */\n+\t      old_vl = simplify_replace_fn_rtx (old_vl, NULL_RTX,\n+\t\t\t\t\t\tstrip_pointer_flags, NULL);\n+\t      new_vl = simplify_replace_fn_rtx (new_vl, NULL_RTX,\n+\t\t\t\t\t\tstrip_pointer_flags, NULL);\n+\t      gcc_assert (rtx_equal_p (old_vl, new_vl));\n+\t      PAT_VAR_LOCATION_LOC (note_vl) = new_vl;\n+\t    }\n \t}\n       *note_slot = (void *) note_vl;\n     }"}]}