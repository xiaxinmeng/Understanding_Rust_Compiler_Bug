{"sha": "8f40ad50192495c5ae12d53e5a563ad1b60738b3", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6OGY0MGFkNTAxOTI0OTVjNWFlMTJkNTNlNWE1NjNhZDFiNjA3MzhiMw==", "commit": {"author": {"name": "Jakub Jelinek", "email": "jakub@redhat.com", "date": "2010-02-23T22:52:20Z"}, "committer": {"name": "Jakub Jelinek", "email": "jakub@gcc.gnu.org", "date": "2010-02-23T22:52:20Z"}, "message": "re PR target/43107 (ICE: SIGSEGV with -O3 -mavx)\n\n\tPR target/43107\n\t* config/i386/i386.c (avx_vpermilp_parallel): Reject indexes\n\tgreater or equal to nelt instead of 2 * nelt.\n\t(expand_vec_perm_1): When op0 and op1 are equal, mask indexes\n\twith nelt - 1.\n\n\t* gcc.target/i386/pr43107.c: New test.\n\nFrom-SVN: r157022", "tree": {"sha": "53b241cf7864323c8b5c0e63099b71ac0761b869", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/53b241cf7864323c8b5c0e63099b71ac0761b869"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/8f40ad50192495c5ae12d53e5a563ad1b60738b3", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/8f40ad50192495c5ae12d53e5a563ad1b60738b3", "html_url": "https://github.com/Rust-GCC/gccrs/commit/8f40ad50192495c5ae12d53e5a563ad1b60738b3", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/8f40ad50192495c5ae12d53e5a563ad1b60738b3/comments", "author": {"login": "jakubjelinek", "id": 9370665, "node_id": "MDQ6VXNlcjkzNzA2NjU=", "avatar_url": "https://avatars.githubusercontent.com/u/9370665?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jakubjelinek", "html_url": "https://github.com/jakubjelinek", "followers_url": "https://api.github.com/users/jakubjelinek/followers", "following_url": "https://api.github.com/users/jakubjelinek/following{/other_user}", "gists_url": "https://api.github.com/users/jakubjelinek/gists{/gist_id}", "starred_url": "https://api.github.com/users/jakubjelinek/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jakubjelinek/subscriptions", "organizations_url": "https://api.github.com/users/jakubjelinek/orgs", "repos_url": "https://api.github.com/users/jakubjelinek/repos", "events_url": "https://api.github.com/users/jakubjelinek/events{/privacy}", "received_events_url": "https://api.github.com/users/jakubjelinek/received_events", "type": "User", "site_admin": false}, "committer": null, "parents": [{"sha": "c6569cd04e1677007aad30c13ed934c34f9ecaac", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/c6569cd04e1677007aad30c13ed934c34f9ecaac", "html_url": "https://github.com/Rust-GCC/gccrs/commit/c6569cd04e1677007aad30c13ed934c34f9ecaac"}], "stats": {"total": 55, "additions": 47, "deletions": 8}, "files": [{"sha": "b4e3cab342c54a45887c8d3b3195902787b5547a", "filename": "gcc/ChangeLog", "status": "modified", "additions": 8, "deletions": 0, "changes": 8, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/8f40ad50192495c5ae12d53e5a563ad1b60738b3/gcc%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/8f40ad50192495c5ae12d53e5a563ad1b60738b3/gcc%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2FChangeLog?ref=8f40ad50192495c5ae12d53e5a563ad1b60738b3", "patch": "@@ -1,3 +1,11 @@\n+2010-02-23  Jakub Jelinek  <jakub@redhat.com>\n+\n+\tPR target/43107\n+\t* config/i386/i386.c (avx_vpermilp_parallel): Reject indexes\n+\tgreater or equal to nelt instead of 2 * nelt.\n+\t(expand_vec_perm_1): When op0 and op1 are equal, mask indexes\n+\twith nelt - 1.\n+\n 2010-02-23  Jason Merrill  <jason@redhat.com>\n \n \tPR debug/42800"}, {"sha": "bb03cba0a046039fed94bf8f0b3b4e4eb0903283", "filename": "gcc/config/i386/i386.c", "status": "modified", "additions": 14, "deletions": 8, "changes": 22, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/8f40ad50192495c5ae12d53e5a563ad1b60738b3/gcc%2Fconfig%2Fi386%2Fi386.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/8f40ad50192495c5ae12d53e5a563ad1b60738b3/gcc%2Fconfig%2Fi386%2Fi386.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fconfig%2Fi386%2Fi386.c?ref=8f40ad50192495c5ae12d53e5a563ad1b60738b3", "patch": "@@ -24673,7 +24673,7 @@ avx_vpermilp_parallel (rtx par, enum machine_mode mode)\n       if (!CONST_INT_P (er))\n \treturn 0;\n       ei = INTVAL (er);\n-      if (ei >= 2 * nelt)\n+      if (ei >= nelt)\n \treturn 0;\n       ipar[i] = ei;\n     }\n@@ -29265,7 +29265,12 @@ expand_vec_perm_1 (struct expand_vec_perm_d *d)\n      input where SEL+CONCAT may not.  */\n   if (d->op0 == d->op1)\n     {\n-      if (expand_vselect (d->target, d->op0, d->perm, nelt))\n+      int mask = nelt - 1;\n+\n+      for (i = 0; i < nelt; i++)\n+\tperm2[i] = d->perm[i] & mask;\n+\n+      if (expand_vselect (d->target, d->op0, perm2, nelt))\n \treturn true;\n \n       /* There are plenty of patterns in sse.md that are written for\n@@ -29276,20 +29281,21 @@ expand_vec_perm_1 (struct expand_vec_perm_d *d)\n \t every other permutation operand.  */\n       for (i = 0; i < nelt; i += 2)\n \t{\n-\t  perm2[i] = d->perm[i];\n-\t  perm2[i+1] = d->perm[i+1] + nelt;\n+\t  perm2[i] = d->perm[i] & mask;\n+\t  perm2[i + 1] = (d->perm[i + 1] & mask) + nelt;\n \t}\n       if (expand_vselect_vconcat (d->target, d->op0, d->op0, perm2, nelt))\n \treturn true;\n \n       /* Recognize shufps, which means adding {0, 0, nelt, nelt}.  */\n       if (nelt >= 4)\n \t{\n-\t  memcpy (perm2, d->perm, nelt);\n-\t  for (i = 2; i < nelt; i += 4)\n+\t  for (i = 0; i < nelt; i += 4)\n \t    {\n-\t      perm2[i+0] += nelt;\n-\t      perm2[i+1] += nelt;\n+\t      perm2[i + 0] = d->perm[i + 0] & mask;\n+\t      perm2[i + 1] = d->perm[i + 1] & mask;\n+\t      perm2[i + 2] = (d->perm[i + 2] & mask) + nelt;\n+\t      perm2[i + 3] = (d->perm[i + 3] & mask) + nelt;\n \t    }\n \n \t  if (expand_vselect_vconcat (d->target, d->op0, d->op0, perm2, nelt))"}, {"sha": "dc688dd61ee93050a618580d9003daeb51d51cb6", "filename": "gcc/testsuite/ChangeLog", "status": "modified", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/8f40ad50192495c5ae12d53e5a563ad1b60738b3/gcc%2Ftestsuite%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/8f40ad50192495c5ae12d53e5a563ad1b60738b3/gcc%2Ftestsuite%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2FChangeLog?ref=8f40ad50192495c5ae12d53e5a563ad1b60738b3", "patch": "@@ -1,3 +1,8 @@\n+2010-02-23  Jakub Jelinek  <jakub@redhat.com>\n+\n+\tPR target/43107\n+\t* gcc.target/i386/pr43107.c: New test.\n+\n 2010-02-23  Jason Merrill  <jason@redhat.com>\n \n \tPR c++/43143"}, {"sha": "879652931167ef5068e718ee46633abe3e5ab16f", "filename": "gcc/testsuite/gcc.target/i386/pr43107.c", "status": "added", "additions": 20, "deletions": 0, "changes": 20, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/8f40ad50192495c5ae12d53e5a563ad1b60738b3/gcc%2Ftestsuite%2Fgcc.target%2Fi386%2Fpr43107.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/8f40ad50192495c5ae12d53e5a563ad1b60738b3/gcc%2Ftestsuite%2Fgcc.target%2Fi386%2Fpr43107.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgcc.target%2Fi386%2Fpr43107.c?ref=8f40ad50192495c5ae12d53e5a563ad1b60738b3", "patch": "@@ -0,0 +1,20 @@\n+/* PR target/43107 */\n+/* { dg-do compile } */\n+/* { dg-options \"-O3 -mavx\" } */\n+\n+extern void bar (float b[4][4]);\n+\n+void\n+foo ()\n+{\n+  float a[4][4], b[4][4];\n+  int i, j;\n+  for (i = 0; i < 4; i++)\n+    {\n+      for (j = 0; j < 4; j++)\n+\ta[i][j] = 0;\n+      for (j = 0; j < 4; j++)\n+\tb[i][j] = a[i][j];\n+    }\n+  bar (b);\n+}"}]}