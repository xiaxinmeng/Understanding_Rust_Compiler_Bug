{"sha": "b5f5d41d1a95994af84eececdb450685d0f1c436", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6YjVmNWQ0MWQxYTk1OTk0YWY4NGVlY2VjZGI0NTA2ODVkMGYxYzQzNg==", "commit": {"author": {"name": "Anatoly Sokolov", "email": "aesok@post.ru", "date": "2010-07-26T18:00:17Z"}, "committer": {"name": "Anatoly Sokolov", "email": "aesok@gcc.gnu.org", "date": "2010-07-26T18:00:17Z"}, "message": "target.def (output_source_filename): New hook.\n\n\t* target.def (output_source_filename): New hook.\n\t* doc/tm.texi.in (TARGET_ASM_OUTPUT_SOURCE_FILENAME): Document.\n\t* doc/tm.texi: Regenerate.\n\t* toplev.c (output_file_directive) Remove function.\n\t* toplev.h (output_file_directive) Remove.\n\t* output.h (default_asm_output_source_filename,\n\toutput_file_directive): Declare.\n\t* varasm.h (default_asm_output_source_filename,\n\toutput_file_directive): New functions.\n\n\t* config/mips/mips.h (ASM_OUTPUT_SOURCE_FILENAME): Remove macro.\n\t* config/mips/mips-protos.h (mips_output_filename): Remove.\n\t* config/mips/mips.c (mips_output_filename): Make Static.\n\t(TARGET_ASM_OUTPUT_SOURCE_FILENAME): Define.\n\nFrom-SVN: r162542", "tree": {"sha": "d56be18415909b5f90b4a54679d77846826cda08", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/d56be18415909b5f90b4a54679d77846826cda08"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/b5f5d41d1a95994af84eececdb450685d0f1c436", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/b5f5d41d1a95994af84eececdb450685d0f1c436", "html_url": "https://github.com/Rust-GCC/gccrs/commit/b5f5d41d1a95994af84eececdb450685d0f1c436", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/b5f5d41d1a95994af84eececdb450685d0f1c436/comments", "author": null, "committer": null, "parents": [{"sha": "114e33e1e6658de6e5a65e5d4bdc8623acb11527", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/114e33e1e6658de6e5a65e5d4bdc8623acb11527", "html_url": "https://github.com/Rust-GCC/gccrs/commit/114e33e1e6658de6e5a65e5d4bdc8623acb11527"}], "stats": {"total": 125, "additions": 85, "deletions": 40}, "files": [{"sha": "5eb1ae9e60476756d569e4fb84f6af0cd6957b6b", "filename": "gcc/ChangeLog", "status": "modified", "additions": 17, "deletions": 0, "changes": 17, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/b5f5d41d1a95994af84eececdb450685d0f1c436/gcc%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/b5f5d41d1a95994af84eececdb450685d0f1c436/gcc%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2FChangeLog?ref=b5f5d41d1a95994af84eececdb450685d0f1c436", "patch": "@@ -1,3 +1,20 @@\n+2010-07-26  Anatoly Sokolov  <aesok@post.ru>\n+\n+\t* target.def (output_source_filename): New hook.\n+\t* doc/tm.texi.in (TARGET_ASM_OUTPUT_SOURCE_FILENAME): Document.\n+\t* doc/tm.texi: Regenerate.\n+\t* toplev.c (output_file_directive) Remove function.\n+\t* toplev.h (output_file_directive) Remove.\n+\t* output.h (default_asm_output_source_filename,\n+\toutput_file_directive): Declare.\n+\t* varasm.h (default_asm_output_source_filename,\n+\toutput_file_directive): New functions.\n+\n+\t* config/mips/mips.h (ASM_OUTPUT_SOURCE_FILENAME): Remove macro.\n+\t* config/mips/mips-protos.h (mips_output_filename): Remove.\n+\t* config/mips/mips.c (mips_output_filename): Make Static.\n+\t(TARGET_ASM_OUTPUT_SOURCE_FILENAME): Define.\n+\n 2010-07-26  Richard Guenther  <rguenther@suse.de>\n \n \tPR tree-optimization/43784"}, {"sha": "dd928e3dc8ffacdd65e14899bf3e2a155260e4bc", "filename": "gcc/config/mips/mips-protos.h", "status": "modified", "additions": 0, "deletions": 1, "changes": 1, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/b5f5d41d1a95994af84eececdb450685d0f1c436/gcc%2Fconfig%2Fmips%2Fmips-protos.h", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/b5f5d41d1a95994af84eececdb450685d0f1c436/gcc%2Fconfig%2Fmips%2Fmips-protos.h", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fconfig%2Fmips%2Fmips-protos.h?ref=b5f5d41d1a95994af84eececdb450685d0f1c436", "patch": "@@ -261,7 +261,6 @@ extern HOST_WIDE_INT mips_debugger_offset (rtx, HOST_WIDE_INT);\n extern void mips_push_asm_switch (struct mips_asm_switch *);\n extern void mips_pop_asm_switch (struct mips_asm_switch *);\n extern void mips_output_external (FILE *, tree, const char *);\n-extern void mips_output_filename (FILE *, const char *);\n extern void mips_output_ascii (FILE *, const char *, size_t);\n extern void mips_output_aligned_decl_common (FILE *, tree, const char *,\n \t\t\t\t\t     unsigned HOST_WIDE_INT,"}, {"sha": "0892c3e1d9fd040f8b7d1e2789b4140083a6df10", "filename": "gcc/config/mips/mips.c", "status": "modified", "additions": 5, "deletions": 2, "changes": 7, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/b5f5d41d1a95994af84eececdb450685d0f1c436/gcc%2Fconfig%2Fmips%2Fmips.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/b5f5d41d1a95994af84eececdb450685d0f1c436/gcc%2Fconfig%2Fmips%2Fmips.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fconfig%2Fmips%2Fmips.c?ref=b5f5d41d1a95994af84eececdb450685d0f1c436", "patch": "@@ -7892,9 +7892,9 @@ mips_output_external (FILE *file, tree decl, const char *name)\n     }\n }\n \n-/* Implement ASM_OUTPUT_SOURCE_FILENAME.  */\n+/* Implement TARGET_ASM_OUTPUT_SOURCE_FILENAME.  */\n \n-void\n+static void\n mips_output_filename (FILE *stream, const char *name)\n {\n   /* If we are emitting DWARF-2, let dwarf2out handle the \".file\"\n@@ -16497,6 +16497,9 @@ void mips_function_profiler (FILE *file)\n #undef TARGET_TRAMPOLINE_INIT\n #define TARGET_TRAMPOLINE_INIT mips_trampoline_init\n \n+#undef TARGET_ASM_OUTPUT_SOURCE_FILENAME\n+#define TARGET_ASM_OUTPUT_SOURCE_FILENAME mips_output_filename\n+\n struct gcc_target targetm = TARGET_INITIALIZER;\n \f\n #include \"gt-mips.h\""}, {"sha": "ff36a90301a4c21d9209f7c904f1ad5a8f370b7a", "filename": "gcc/config/mips/mips.h", "status": "modified", "additions": 0, "deletions": 3, "changes": 3, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/b5f5d41d1a95994af84eececdb450685d0f1c436/gcc%2Fconfig%2Fmips%2Fmips.h", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/b5f5d41d1a95994af84eececdb450685d0f1c436/gcc%2Fconfig%2Fmips%2Fmips.h", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fconfig%2Fmips%2Fmips.h?ref=b5f5d41d1a95994af84eececdb450685d0f1c436", "patch": "@@ -2666,9 +2666,6 @@ do\t\t\t\t\t\t\t\t\t\\\n   }\t\t\t\t\t\t\t\t\t\\\n while (0)\n \n-/* How to tell the debugger about changes of source files.  */\n-#define ASM_OUTPUT_SOURCE_FILENAME mips_output_filename\n-\n /* mips-tfile does not understand .stabd directives.  */\n #define DBX_OUTPUT_SOURCE_LINE(STREAM, LINE, COUNTER) do {\t\\\n   dbxout_begin_stabn_sline (LINE);\t\t\t\t\\"}, {"sha": "e94fdf6067e88fc4750b6e2b04cbfc8db2b553d5", "filename": "gcc/doc/tm.texi", "status": "modified", "additions": 6, "deletions": 0, "changes": 6, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/b5f5d41d1a95994af84eececdb450685d0f1c436/gcc%2Fdoc%2Ftm.texi", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/b5f5d41d1a95994af84eececdb450685d0f1c436/gcc%2Fdoc%2Ftm.texi", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fdoc%2Ftm.texi?ref=b5f5d41d1a95994af84eececdb450685d0f1c436", "patch": "@@ -7262,6 +7262,12 @@ This macro need not be defined if the standard form of output\n for the file format in use is appropriate.\n @end defmac\n \n+@deftypefn {Target Hook} void TARGET_ASM_OUTPUT_SOURCE_FILENAME (FILE *@var{file}, const char *@var{name})\n+Output COFF information or DWARF debugging information which indicates that filename @var{name} is the current source file to the stdio stream @var{file}.\n+ \n+ This target hook need not be defined if the standard form of output for the file format in use is appropriate.\n+@end deftypefn\n+\n @defmac OUTPUT_QUOTED_STRING (@var{stream}, @var{string})\n A C statement to output the string @var{string} to the stdio stream\n @var{stream}.  If you do not call the function @code{output_quoted_string}"}, {"sha": "caa0115c9d663bbcdb72f231648737410ac266e6", "filename": "gcc/doc/tm.texi.in", "status": "modified", "additions": 2, "deletions": 0, "changes": 2, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/b5f5d41d1a95994af84eececdb450685d0f1c436/gcc%2Fdoc%2Ftm.texi.in", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/b5f5d41d1a95994af84eececdb450685d0f1c436/gcc%2Fdoc%2Ftm.texi.in", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fdoc%2Ftm.texi.in?ref=b5f5d41d1a95994af84eececdb450685d0f1c436", "patch": "@@ -7262,6 +7262,8 @@ This macro need not be defined if the standard form of output\n for the file format in use is appropriate.\n @end defmac\n \n+@hook TARGET_ASM_OUTPUT_SOURCE_FILENAME\n+\n @defmac OUTPUT_QUOTED_STRING (@var{stream}, @var{string})\n A C statement to output the string @var{string} to the stdio stream\n @var{stream}.  If you do not call the function @code{output_quoted_string}"}, {"sha": "26e6268f6a5a452790be49254aae4358f4fa511b", "filename": "gcc/output.h", "status": "modified", "additions": 3, "deletions": 0, "changes": 3, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/b5f5d41d1a95994af84eececdb450685d0f1c436/gcc%2Foutput.h", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/b5f5d41d1a95994af84eececdb450685d0f1c436/gcc%2Foutput.h", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Foutput.h?ref=b5f5d41d1a95994af84eececdb450685d0f1c436", "patch": "@@ -595,6 +595,9 @@ extern bool unlikely_text_section_p (section *);\n extern void switch_to_section (section *);\n extern void output_section_asm_op (const void *);\n \n+extern void default_asm_output_source_filename (FILE *, const char *);\n+extern void output_file_directive (FILE *, const char *);\n+\n extern unsigned int default_section_type_flags (tree, const char *, int);\n \n extern bool have_global_bss_p (void);"}, {"sha": "01ab4782008a1242dc2e97d1543b9828043d1d40", "filename": "gcc/target.def", "status": "modified", "additions": 11, "deletions": 0, "changes": 11, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/b5f5d41d1a95994af84eececdb450685d0f1c436/gcc%2Ftarget.def", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/b5f5d41d1a95994af84eececdb450685d0f1c436/gcc%2Ftarget.def", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftarget.def?ref=b5f5d41d1a95994af84eececdb450685d0f1c436", "patch": "@@ -404,6 +404,17 @@ DEFHOOK\n  void, (FILE *f),\n  NULL)\n \n+DEFHOOK\n+(output_source_filename,\n+ \"Output COFF information or DWARF debugging information which indicates\\\n+ that filename @var{name} is the current source file to the stdio\\\n+ stream @var{file}.\\n\\\n+ \\n\\\n+ This target hook need not be defined if the standard form of output\\\n+ for the file format in use is appropriate.\",\n+ void ,(FILE *file, const char *name),\n+ default_asm_output_source_filename)\n+\n /* ??? The TARGET_PRINT_OPERAND* hooks are part of the asm_out struct,\n    even though that is not reflected in the macro name to override their\n    initializers.  */"}, {"sha": "740d8c067a0889e486ce8fb9bd66bd7c0d784046", "filename": "gcc/toplev.c", "status": "modified", "additions": 0, "deletions": 33, "changes": 33, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/b5f5d41d1a95994af84eececdb450685d0f1c436/gcc%2Ftoplev.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/b5f5d41d1a95994af84eececdb450685d0f1c436/gcc%2Ftoplev.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftoplev.c?ref=b5f5d41d1a95994af84eececdb450685d0f1c436", "patch": "@@ -620,39 +620,6 @@ output_quoted_string (FILE *asm_file, const char *string)\n #endif\n }\n \n-/* Output a file name in the form wanted by System V.  */\n-\n-void\n-output_file_directive (FILE *asm_file, const char *input_name)\n-{\n-  int len;\n-  const char *na;\n-\n-  if (input_name == NULL)\n-    input_name = \"<stdin>\";\n-  else\n-    input_name = remap_debug_filename (input_name);\n-\n-  len = strlen (input_name);\n-  na = input_name + len;\n-\n-  /* NA gets INPUT_NAME sans directory names.  */\n-  while (na > input_name)\n-    {\n-      if (IS_DIR_SEPARATOR (na[-1]))\n-\tbreak;\n-      na--;\n-    }\n-\n-#ifdef ASM_OUTPUT_SOURCE_FILENAME\n-  ASM_OUTPUT_SOURCE_FILENAME (asm_file, na);\n-#else\n-  fprintf (asm_file, \"\\t.file\\t\");\n-  output_quoted_string (asm_file, na);\n-  putc ('\\n', asm_file);\n-#endif\n-}\n-\n /* A subroutine of wrapup_global_declarations.  We've come to the end of\n    the compilation unit.  All deferred variables should be undeferred,\n    and all incomplete decls should be finalized.  */"}, {"sha": "44920ed7a009d3c6e5f49bafc292421652c6b2fb", "filename": "gcc/toplev.h", "status": "modified", "additions": 0, "deletions": 1, "changes": 1, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/b5f5d41d1a95994af84eececdb450685d0f1c436/gcc%2Ftoplev.h", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/b5f5d41d1a95994af84eececdb450685d0f1c436/gcc%2Ftoplev.h", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftoplev.h?ref=b5f5d41d1a95994af84eececdb450685d0f1c436", "patch": "@@ -50,7 +50,6 @@ extern bool parse_optimize_options (tree, bool);\n \n #ifdef BUFSIZ\n extern void output_quoted_string\t(FILE *, const char *);\n-extern void output_file_directive\t(FILE *, const char *);\n #endif\n \n extern void wrapup_global_declaration_1 (tree);"}, {"sha": "f43f206e51231e49ab55598a112138bbb1f4fd47", "filename": "gcc/varasm.c", "status": "modified", "additions": 41, "deletions": 0, "changes": 41, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/b5f5d41d1a95994af84eececdb450685d0f1c436/gcc%2Fvarasm.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/b5f5d41d1a95994af84eececdb450685d0f1c436/gcc%2Fvarasm.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fvarasm.c?ref=b5f5d41d1a95994af84eececdb450685d0f1c436", "patch": "@@ -7247,6 +7247,47 @@ default_elf_asm_output_external (FILE *file ATTRIBUTE_UNUSED,\n     maybe_assemble_visibility (decl);\n }\n \n+/* The default hook for TARGET_ASM_OUTPUT_SOURCE_FILENAME.  */\n+\n+void\n+default_asm_output_source_filename (FILE *file, const char *name)\n+{\n+#ifdef ASM_OUTPUT_SOURCE_FILENAME\n+  ASM_OUTPUT_SOURCE_FILENAME (file, name);\n+#else\n+  fprintf (file, \"\\t.file\\t\");\n+  output_quoted_string (file, name);\n+  putc ('\\n', file);\n+#endif\n+}\n+\n+/* Output a file name in the form wanted by System V.  */\n+\n+void\n+output_file_directive (FILE *asm_file, const char *input_name)\n+{\n+  int len;\n+  const char *na;\n+\n+  if (input_name == NULL)\n+    input_name = \"<stdin>\";\n+  else\n+    input_name = remap_debug_filename (input_name);\n+\n+  len = strlen (input_name);\n+  na = input_name + len;\n+\n+  /* NA gets INPUT_NAME sans directory names.  */\n+  while (na > input_name)\n+    {\n+      if (IS_DIR_SEPARATOR (na[-1]))\n+\tbreak;\n+      na--;\n+    }\n+\n+  targetm.asm_out.output_source_filename (asm_file, na);\n+}\n+\n /* Create a DEBUG_EXPR_DECL / DEBUG_EXPR pair from RTL expression\n    EXP.  */\n rtx"}]}