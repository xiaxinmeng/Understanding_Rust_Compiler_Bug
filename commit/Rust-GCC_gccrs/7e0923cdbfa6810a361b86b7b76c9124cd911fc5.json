{"sha": "7e0923cdbfa6810a361b86b7b76c9124cd911fc5", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6N2UwOTIzY2RiZmE2ODEwYTM2MWI4NmI3Yjc2YzkxMjRjZDkxMWZjNQ==", "commit": {"author": {"name": "Sebastian Pop", "email": "pop@cri.ensmp.fr", "date": "2005-08-15T12:26:12Z"}, "committer": {"name": "Sebastian Pop", "email": "spop@gcc.gnu.org", "date": "2005-08-15T12:26:12Z"}, "message": "re PR tree-optimization/23391 (Tree checking failure due to scev)\n\n\tPR 23391\n\t* Makefile.in (tree-chrec.o): Depends on real.h.\n\t* tree-chrec.c: Include real.h.\n\t(chrec_fold_plus_poly_poly, chrec_fold_multiply_poly_poly,\n\tchrec_fold_plus_1): Use build_real for SCALAR_FLOAT_TYPE_P.\n\t* tree-scalar-evolution.c (add_to_evolution_1,\n\tinterpret_rhs_modify_expr): Ditto.\n\nFrom-SVN: r103109", "tree": {"sha": "4d471877a47c52da8db1b99983435baf60e9e7e7", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/4d471877a47c52da8db1b99983435baf60e9e7e7"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/7e0923cdbfa6810a361b86b7b76c9124cd911fc5", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/7e0923cdbfa6810a361b86b7b76c9124cd911fc5", "html_url": "https://github.com/Rust-GCC/gccrs/commit/7e0923cdbfa6810a361b86b7b76c9124cd911fc5", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/7e0923cdbfa6810a361b86b7b76c9124cd911fc5/comments", "author": null, "committer": {"login": "sebpop", "id": 568397, "node_id": "MDQ6VXNlcjU2ODM5Nw==", "avatar_url": "https://avatars.githubusercontent.com/u/568397?v=4", "gravatar_id": "", "url": "https://api.github.com/users/sebpop", "html_url": "https://github.com/sebpop", "followers_url": "https://api.github.com/users/sebpop/followers", "following_url": "https://api.github.com/users/sebpop/following{/other_user}", "gists_url": "https://api.github.com/users/sebpop/gists{/gist_id}", "starred_url": "https://api.github.com/users/sebpop/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/sebpop/subscriptions", "organizations_url": "https://api.github.com/users/sebpop/orgs", "repos_url": "https://api.github.com/users/sebpop/repos", "events_url": "https://api.github.com/users/sebpop/events{/privacy}", "received_events_url": "https://api.github.com/users/sebpop/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "852c19aae40795aff2dabaee47422e65f99b116a", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/852c19aae40795aff2dabaee47422e65f99b116a", "html_url": "https://github.com/Rust-GCC/gccrs/commit/852c19aae40795aff2dabaee47422e65f99b116a"}], "stats": {"total": 57, "additions": 50, "deletions": 7}, "files": [{"sha": "7cf73cded46c815bb36565c943fe1990b5336961", "filename": "gcc/ChangeLog", "status": "modified", "additions": 10, "deletions": 0, "changes": 10, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/7e0923cdbfa6810a361b86b7b76c9124cd911fc5/gcc%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/7e0923cdbfa6810a361b86b7b76c9124cd911fc5/gcc%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2FChangeLog?ref=7e0923cdbfa6810a361b86b7b76c9124cd911fc5", "patch": "@@ -1,3 +1,13 @@\n+2005-08-15  Sebastian Pop  <pop@cri.ensmp.fr>\n+\n+\tPR 23391\n+\t* Makefile.in (tree-chrec.o): Depends on real.h.\n+\t* tree-chrec.c: Include real.h.\n+\t(chrec_fold_plus_poly_poly, chrec_fold_multiply_poly_poly,\n+\tchrec_fold_plus_1): Use build_real for SCALAR_FLOAT_TYPE_P.\n+\t* tree-scalar-evolution.c (add_to_evolution_1,\n+\tinterpret_rhs_modify_expr): Ditto.\n+\n 2005-08-15  Sebastian Pop  <pop@cri.ensmp.fr>\n \n \tPR 23386"}, {"sha": "d56e666a1be68108ea659b04f39732164a792f45", "filename": "gcc/Makefile.in", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/7e0923cdbfa6810a361b86b7b76c9124cd911fc5/gcc%2FMakefile.in", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/7e0923cdbfa6810a361b86b7b76c9124cd911fc5/gcc%2FMakefile.in", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2FMakefile.in?ref=7e0923cdbfa6810a361b86b7b76c9124cd911fc5", "patch": "@@ -1942,7 +1942,7 @@ tree-browser.o : tree-browser.c tree-browser.def $(CONFIG_H) $(SYSTEM_H) \\\n    $(TREE_H) tree-inline.h $(DIAGNOSTIC_H) $(HASHTAB_H) \\\n    $(TM_H) coretypes.h\n tree-chrec.o: tree-chrec.c $(CONFIG_H) $(SYSTEM_H) coretypes.h $(TM_H) \\\n-   $(GGC_H) $(TREE_H) tree-chrec.h tree-pass.h $(PARAMS_H) \\\n+   $(GGC_H) $(TREE_H) real.h tree-chrec.h tree-pass.h $(PARAMS_H) \\\n    $(DIAGNOSTIC_H) $(VARRAY_H) $(CFGLOOP_H) $(TREE_FLOW_H)\n tree-scalar-evolution.o: tree-scalar-evolution.c $(CONFIG_H) $(SYSTEM_H) \\\n    coretypes.h $(TM_H) $(GGC_H) $(TREE_H) real.h $(RTL_H) \\"}, {"sha": "8d2c3023d4f92e18ab650dbc75742d38a2108dac", "filename": "gcc/testsuite/gcc.dg/tree-ssa/pr23391.c", "status": "added", "additions": 22, "deletions": 0, "changes": 22, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/7e0923cdbfa6810a361b86b7b76c9124cd911fc5/gcc%2Ftestsuite%2Fgcc.dg%2Ftree-ssa%2Fpr23391.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/7e0923cdbfa6810a361b86b7b76c9124cd911fc5/gcc%2Ftestsuite%2Fgcc.dg%2Ftree-ssa%2Fpr23391.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgcc.dg%2Ftree-ssa%2Fpr23391.c?ref=7e0923cdbfa6810a361b86b7b76c9124cd911fc5", "patch": "@@ -0,0 +1,22 @@\n+/* { dg-do compile } */\n+\n+void \n+foo (int N) \n+{ \n+  int C; \n+  double R; \n+ \n+  R = 0.0; \n+  do \n+    { \n+      R += 0.001; \n+      C = (int) (R * N); \n+      if (-R * N <= R * N) \n+        { \n+          C++; \n+        } \n+    } \n+  while (C < 0); \n+ \n+  return; \n+} "}, {"sha": "87cc148c1a71dad4d20cf8325577b8e4a606b13a", "filename": "gcc/tree-chrec.c", "status": "modified", "additions": 11, "deletions": 4, "changes": 15, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/7e0923cdbfa6810a361b86b7b76c9124cd911fc5/gcc%2Ftree-chrec.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/7e0923cdbfa6810a361b86b7b76c9124cd911fc5/gcc%2Ftree-chrec.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftree-chrec.c?ref=7e0923cdbfa6810a361b86b7b76c9124cd911fc5", "patch": "@@ -30,6 +30,7 @@ Software Foundation, 51 Franklin Street, Fifth Floor, Boston, MA\n #include \"tm.h\"\n #include \"ggc.h\"\n #include \"tree.h\"\n+#include \"real.h\"\n #include \"diagnostic.h\"\n #include \"varray.h\"\n #include \"cfgloop.h\"\n@@ -119,7 +120,9 @@ chrec_fold_plus_poly_poly (enum tree_code code,\n \t  (CHREC_VARIABLE (poly1), \n \t   chrec_fold_minus (type, poly0, CHREC_LEFT (poly1)),\n \t   chrec_fold_multiply (type, CHREC_RIGHT (poly1), \n-\t\t\t\tbuild_int_cst_type (type, -1)));\n+\t\t\t\tSCALAR_FLOAT_TYPE_P (type)\n+\t\t\t\t? build_real (type, dconstm1)\n+\t\t\t\t: build_int_cst_type (type, -1)));\n     }\n   \n   if (CHREC_VARIABLE (poly0) > CHREC_VARIABLE (poly1))\n@@ -208,7 +211,9 @@ chrec_fold_multiply_poly_poly (tree type,\n \t\t\t\t\t\t       CHREC_RIGHT (poly1)));\n   /* \"2*b*d\".  */\n   t2 = chrec_fold_multiply (type, CHREC_RIGHT (poly0), CHREC_RIGHT (poly1));\n-  t2 = chrec_fold_multiply (type, build_int_cst_type (type, 2), t2);\n+  t2 = chrec_fold_multiply (type, SCALAR_FLOAT_TYPE_P (type)\n+\t\t\t    ? build_real (type, dconst2)\n+\t\t\t    : build_int_cst_type (type, 2), t2);\n \n   var = CHREC_VARIABLE (poly0);\n   return build_polynomial_chrec (var, t0,\n@@ -284,8 +289,10 @@ chrec_fold_plus_1 (enum tree_code code,\n \t    return build_polynomial_chrec \n \t      (CHREC_VARIABLE (op1), \n \t       chrec_fold_minus (type, op0, CHREC_LEFT (op1)),\n-\t       chrec_fold_multiply (type, CHREC_RIGHT (op1),\n-\t\t\t\t    build_int_cst_type (type, -1)));\n+\t       chrec_fold_multiply (type, CHREC_RIGHT (op1), \n+\t\t\t\t    SCALAR_FLOAT_TYPE_P (type)\n+\t\t\t\t    ? build_real (type, dconstm1)\n+\t\t\t\t    : build_int_cst_type (type, -1)));\n \n \tdefault:\n \t  {"}, {"sha": "e74904797778578fc90d519250cc551fc4633c8a", "filename": "gcc/tree-scalar-evolution.c", "status": "modified", "additions": 6, "deletions": 2, "changes": 8, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/7e0923cdbfa6810a361b86b7b76c9124cd911fc5/gcc%2Ftree-scalar-evolution.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/7e0923cdbfa6810a361b86b7b76c9124cd911fc5/gcc%2Ftree-scalar-evolution.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftree-scalar-evolution.c?ref=7e0923cdbfa6810a361b86b7b76c9124cd911fc5", "patch": "@@ -676,7 +676,9 @@ add_to_evolution_1 (unsigned loop_nb,\n \t    {\n \t      var = loop_nb;\n \t      left = chrec_before;\n-\t      right = build_int_cst (type, 0);\n+\t      right = SCALAR_FLOAT_TYPE_P (type)\n+\t\t? build_real (type, dconst0)\n+\t\t: build_int_cst (type, 0);\n \t    }\n \t  else\n \t    {\n@@ -1680,7 +1682,9 @@ interpret_rhs_modify_expr (struct loop *loop, tree at_stmt,\n       opnd10 = TREE_OPERAND (opnd1, 0);\n       chrec10 = analyze_scalar_evolution (loop, opnd10);\n       chrec10 = chrec_convert (type, chrec10, at_stmt);\n-      res = chrec_fold_minus (type, build_int_cst (type, 0), chrec10);\n+      res = chrec_fold_multiply (type, chrec10, SCALAR_FLOAT_TYPE_P (type)\n+\t\t\t\t  ? build_real (type, dconstm1)\n+\t\t\t\t  : build_int_cst_type (type, -1));\n       break;\n \n     case MULT_EXPR:"}]}