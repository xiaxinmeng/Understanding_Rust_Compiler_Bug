{"sha": "99b766fc8bf3b91a7e326aeb07792eb33635184d", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6OTliNzY2ZmM4YmYzYjkxYTdlMzI2YWViMDc3OTJlYjMzNjM1MTg0ZA==", "commit": {"author": {"name": "Jan Hubicka", "email": "jh@suse.cz", "date": "2010-05-11T08:14:50Z"}, "committer": {"name": "Jan Hubicka", "email": "hubicka@gcc.gnu.org", "date": "2010-05-11T08:14:50Z"}, "message": "cgraphbuild.c (cgraph_rebuild_references): New.\n\n\n\t* cgraphbuild.c (cgraph_rebuild_references): New.\n\t(cgraph_mark_reachable_node): Accept references to optimized out\n\textern inlines.\n\t* cgraph.h (cgraph_rebuild_references): Declare.\n\t* tree-inline.c (tree_function_versioning): Use it.\n\t* ipa-struct-reorg.c (do_reorg_for_func): Likewise.\n\nFrom-SVN: r159259", "tree": {"sha": "42568770dccb09df07e5beff55df5ce77b3c4957", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/42568770dccb09df07e5beff55df5ce77b3c4957"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/99b766fc8bf3b91a7e326aeb07792eb33635184d", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/99b766fc8bf3b91a7e326aeb07792eb33635184d", "html_url": "https://github.com/Rust-GCC/gccrs/commit/99b766fc8bf3b91a7e326aeb07792eb33635184d", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/99b766fc8bf3b91a7e326aeb07792eb33635184d/comments", "author": null, "committer": null, "parents": [{"sha": "a940b4d9ab2566bce05dd5abb9b90467684a43e8", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/a940b4d9ab2566bce05dd5abb9b90467684a43e8", "html_url": "https://github.com/Rust-GCC/gccrs/commit/a940b4d9ab2566bce05dd5abb9b90467684a43e8"}], "stats": {"total": 44, "additions": 44, "deletions": 0}, "files": [{"sha": "3abdc3f5b3b2aaec1ae4ae5a1ba5a07584e6b051", "filename": "gcc/ChangeLog", "status": "modified", "additions": 9, "deletions": 0, "changes": 9, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/99b766fc8bf3b91a7e326aeb07792eb33635184d/gcc%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/99b766fc8bf3b91a7e326aeb07792eb33635184d/gcc%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2FChangeLog?ref=99b766fc8bf3b91a7e326aeb07792eb33635184d", "patch": "@@ -1,3 +1,12 @@\n+2010-05-11  Jan Hubicka  <jh@suse.cz>\n+\n+\t* cgraphbuild.c (cgraph_rebuild_references): New.\n+\t(cgraph_mark_reachable_node): Accept references to optimized out\n+\textern inlines.\n+\t* cgraph.h (cgraph_rebuild_references): Declare.\n+\t* tree-inline.c (tree_function_versioning): Use it.\n+\t* ipa-struct-reorg.c (do_reorg_for_func): Likewise.\n+\n 2010-05-11  Jan Hubicka  <jh@suse.cz>\n \n \t* cgraph.c: Include ipa-utils.h"}, {"sha": "97df56bc4182338b247a158413bcceec16353c11", "filename": "gcc/cgraph.h", "status": "modified", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/99b766fc8bf3b91a7e326aeb07792eb33635184d/gcc%2Fcgraph.h", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/99b766fc8bf3b91a7e326aeb07792eb33635184d/gcc%2Fcgraph.h", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fcgraph.h?ref=99b766fc8bf3b91a7e326aeb07792eb33635184d", "patch": "@@ -619,6 +619,7 @@ gimple cgraph_redirect_edge_call_stmt_to_callee (struct cgraph_edge *);\n bool cgraph_propagate_frequency (struct cgraph_node *node);\n /* In cgraphbuild.c  */\n unsigned int rebuild_cgraph_edges (void);\n+void cgraph_rebuild_references (void);\n void reset_inline_failed (struct cgraph_node *);\n int compute_call_stmt_bb_frequency (tree, basic_block bb);\n "}, {"sha": "b09963d1c0405dbdf0fa2c34e9c3e626caa32082", "filename": "gcc/cgraphbuild.c", "status": "modified", "additions": 31, "deletions": 0, "changes": 31, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/99b766fc8bf3b91a7e326aeb07792eb33635184d/gcc%2Fcgraphbuild.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/99b766fc8bf3b91a7e326aeb07792eb33635184d/gcc%2Fcgraphbuild.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fcgraphbuild.c?ref=99b766fc8bf3b91a7e326aeb07792eb33635184d", "patch": "@@ -463,6 +463,37 @@ rebuild_cgraph_edges (void)\n   return 0;\n }\n \n+/* Rebuild cgraph edges for current function node.  This needs to be run after\n+   passes that don't update the cgraph.  */\n+\n+void\n+cgraph_rebuild_references (void)\n+{\n+  basic_block bb;\n+  struct cgraph_node *node = cgraph_node (current_function_decl);\n+  gimple_stmt_iterator gsi;\n+\n+  ipa_remove_all_references (&node->ref_list);\n+\n+  node->count = ENTRY_BLOCK_PTR->count;\n+\n+  FOR_EACH_BB (bb)\n+    {\n+      for (gsi = gsi_start_bb (bb); !gsi_end_p (gsi); gsi_next (&gsi))\n+\t{\n+\t  gimple stmt = gsi_stmt (gsi);\n+\n+\t  walk_stmt_load_store_addr_ops (stmt, node, mark_load,\n+\t\t\t\t\t mark_store, mark_address);\n+\n+\t}\n+      for (gsi = gsi_start (phi_nodes (bb)); !gsi_end_p (gsi); gsi_next (&gsi))\n+\twalk_stmt_load_store_addr_ops (gsi_stmt (gsi), node,\n+\t\t\t\t       mark_load, mark_store, mark_address);\n+    }\n+  record_eh_tables (node, cfun);\n+}\n+\n struct gimple_opt_pass pass_rebuild_cgraph_edges =\n {\n  {"}, {"sha": "460c23fc9ed7e711088094492729b1b1e694379f", "filename": "gcc/ipa-struct-reorg.c", "status": "modified", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/99b766fc8bf3b91a7e326aeb07792eb33635184d/gcc%2Fipa-struct-reorg.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/99b766fc8bf3b91a7e326aeb07792eb33635184d/gcc%2Fipa-struct-reorg.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fipa-struct-reorg.c?ref=99b766fc8bf3b91a7e326aeb07792eb33635184d", "patch": "@@ -3241,6 +3241,7 @@ do_reorg_for_func (struct cgraph_node *node)\n   create_new_accesses_for_func ();\n   update_ssa (TODO_update_ssa);\n   cleanup_tree_cfg ();\n+  cgraph_rebuild_references ();\n \n   /* Free auxiliary data representing local variables.  */\n   free_new_vars_htab (new_local_vars);"}, {"sha": "ee7a45712dfcb897ba07077756a1eb5663b9833e", "filename": "gcc/tree-inline.c", "status": "modified", "additions": 2, "deletions": 0, "changes": 2, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/99b766fc8bf3b91a7e326aeb07792eb33635184d/gcc%2Ftree-inline.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/99b766fc8bf3b91a7e326aeb07792eb33635184d/gcc%2Ftree-inline.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftree-inline.c?ref=99b766fc8bf3b91a7e326aeb07792eb33635184d", "patch": "@@ -5037,6 +5037,8 @@ tree_function_versioning (tree old_decl, tree new_decl,\n   pointer_set_destroy (id.statements_to_fold);\n   fold_cond_expr_cond ();\n   delete_unreachable_blocks_update_callgraph (&id);\n+  if (id.dst_node->analyzed)\n+    cgraph_rebuild_references ();\n   update_ssa (TODO_update_ssa);\n   free_dominance_info (CDI_DOMINATORS);\n   free_dominance_info (CDI_POST_DOMINATORS);"}]}