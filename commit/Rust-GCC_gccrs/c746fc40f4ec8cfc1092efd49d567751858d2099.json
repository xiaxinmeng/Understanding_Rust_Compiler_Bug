{"sha": "c746fc40f4ec8cfc1092efd49d567751858d2099", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6Yzc0NmZjNDBmNGVjOGNmYzEwOTJlZmQ0OWQ1Njc3NTE4NThkMjA5OQ==", "commit": {"author": {"name": "Jozef Lawrynowicz", "email": "jozef.l@mittosystems.com", "date": "2020-11-15T21:03:06Z"}, "committer": {"name": "Jozef Lawrynowicz", "email": "jozef.l@mittosystems.com", "date": "2020-11-15T21:04:56Z"}, "message": "MSP430: Fix inconsistent naming of hwmult libfuncs\n\nThe naming scheme used by GCC to reference MSP430 hardware multiply\nlibrary functions is inconsistent.\n\nSometimes the \"GCC\" names (e.g. mulsi2) are used, other times the\n\"MSPABI\" names (e.g. __mspabi_mpyl) are used.\n\nAlso, sometimes an identifier for the hardware multiply support is\nappended to the GCC name, when the functions are defined, but this is\nnot required.\n\nThis patch fixes those issues, so the names used to refer to the\nhardware multiply library functions follow a consistent pattern.\n\ngcc/ChangeLog:\n\n\t* config/msp430/msp430.c (msp430_output_labelref): Don't process mspabi\n\thwmult library function names into GCC-style names.\n\nlibgcc/ChangeLog:\n\n\t* config/msp430/lib2hw_mul.S: Omit _hw* suffix from GCC names for\n\thwmult library functions.\n\ngcc/testsuite/ChangeLog:\n\n\t* gcc.target/msp430/rtx-cost-Os-f5series.c: Adjust test to use new\n\thwmult library function name.", "tree": {"sha": "319c1393b92367f6012c6175775c909a17a7f25b", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/319c1393b92367f6012c6175775c909a17a7f25b"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/c746fc40f4ec8cfc1092efd49d567751858d2099", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/c746fc40f4ec8cfc1092efd49d567751858d2099", "html_url": "https://github.com/Rust-GCC/gccrs/commit/c746fc40f4ec8cfc1092efd49d567751858d2099", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/c746fc40f4ec8cfc1092efd49d567751858d2099/comments", "author": {"login": "jozefl-mitto", "id": 36524004, "node_id": "MDQ6VXNlcjM2NTI0MDA0", "avatar_url": "https://avatars.githubusercontent.com/u/36524004?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jozefl-mitto", "html_url": "https://github.com/jozefl-mitto", "followers_url": "https://api.github.com/users/jozefl-mitto/followers", "following_url": "https://api.github.com/users/jozefl-mitto/following{/other_user}", "gists_url": "https://api.github.com/users/jozefl-mitto/gists{/gist_id}", "starred_url": "https://api.github.com/users/jozefl-mitto/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jozefl-mitto/subscriptions", "organizations_url": "https://api.github.com/users/jozefl-mitto/orgs", "repos_url": "https://api.github.com/users/jozefl-mitto/repos", "events_url": "https://api.github.com/users/jozefl-mitto/events{/privacy}", "received_events_url": "https://api.github.com/users/jozefl-mitto/received_events", "type": "User", "site_admin": false}, "committer": {"login": "jozefl-mitto", "id": 36524004, "node_id": "MDQ6VXNlcjM2NTI0MDA0", "avatar_url": "https://avatars.githubusercontent.com/u/36524004?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jozefl-mitto", "html_url": "https://github.com/jozefl-mitto", "followers_url": "https://api.github.com/users/jozefl-mitto/followers", "following_url": "https://api.github.com/users/jozefl-mitto/following{/other_user}", "gists_url": "https://api.github.com/users/jozefl-mitto/gists{/gist_id}", "starred_url": "https://api.github.com/users/jozefl-mitto/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jozefl-mitto/subscriptions", "organizations_url": "https://api.github.com/users/jozefl-mitto/orgs", "repos_url": "https://api.github.com/users/jozefl-mitto/repos", "events_url": "https://api.github.com/users/jozefl-mitto/events{/privacy}", "received_events_url": "https://api.github.com/users/jozefl-mitto/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "814949ddceaef59725c84fe8ef7c6c617fb5d049", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/814949ddceaef59725c84fe8ef7c6c617fb5d049", "html_url": "https://github.com/Rust-GCC/gccrs/commit/814949ddceaef59725c84fe8ef7c6c617fb5d049"}], "stats": {"total": 36, "additions": 7, "deletions": 29}, "files": [{"sha": "51f49edffa88c1b6ed6a0b53bcc3d41ba1eac41b", "filename": "gcc/config/msp430/msp430.c", "status": "modified", "additions": 0, "deletions": 22, "changes": 22, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/c746fc40f4ec8cfc1092efd49d567751858d2099/gcc%2Fconfig%2Fmsp430%2Fmsp430.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/c746fc40f4ec8cfc1092efd49d567751858d2099/gcc%2Fconfig%2Fmsp430%2Fmsp430.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fconfig%2Fmsp430%2Fmsp430.c?ref=c746fc40f4ec8cfc1092efd49d567751858d2099", "patch": "@@ -4031,28 +4031,6 @@ msp430_output_labelref (FILE *file, const char *name)\n \tbreak;\n       }\n \n-  /* If we have been given a specific MCU name then we may be\n-     able to make use of its hardware multiply capabilities.  */\n-  if (msp430_has_hwmult ())\n-    {\n-      if (strcmp (\"__mspabi_mpyi\", name) == 0)\n-\t{\n-\t  if (msp430_use_f5_series_hwmult ())\n-\t    name = \"__mulhi2_f5\";\n-\t  else\n-\t    name = \"__mulhi2\";\n-\t}\n-      else if (strcmp (\"__mspabi_mpyl\", name) == 0)\n-\t{\n-\t  if (msp430_use_f5_series_hwmult ())\n-\t    name = \"__mulsi2_f5\";\n-\t  else if (msp430_use_32bit_hwmult ())\n-\t    name = \"__mulsi2_hw32\";\n-\t  else\n-\t    name = \"__mulsi2\";\n-\t}\n-    }\n-\n   if (user_label_prefix[0] != 0)\n     fputs (user_label_prefix, file);\n "}, {"sha": "67d91983715ebd1fb9dedd95ba162fc8e02cc207", "filename": "gcc/testsuite/gcc.target/msp430/rtx-cost-Os-f5series.c", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/c746fc40f4ec8cfc1092efd49d567751858d2099/gcc%2Ftestsuite%2Fgcc.target%2Fmsp430%2Frtx-cost-Os-f5series.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/c746fc40f4ec8cfc1092efd49d567751858d2099/gcc%2Ftestsuite%2Fgcc.target%2Fmsp430%2Frtx-cost-Os-f5series.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgcc.target%2Fmsp430%2Frtx-cost-Os-f5series.c?ref=c746fc40f4ec8cfc1092efd49d567751858d2099", "patch": "@@ -24,7 +24,7 @@ unsigned long res3;\n **\tMOV.B\t#100, R14\n **\tMOV.B\t#0, R15\n ** ...\n-**\tCALL.*\t#__mulsi2_f5\n+**\tCALL.*\t#__mspabi_mpyl_f5hw\n ** ...\n */\n void foo (void)"}, {"sha": "0fbafcd8b9590f1ee7e69781c617ecdd973721ec", "filename": "libgcc/config/msp430/lib2hw_mul.S", "status": "modified", "additions": 6, "deletions": 6, "changes": 12, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/c746fc40f4ec8cfc1092efd49d567751858d2099/libgcc%2Fconfig%2Fmsp430%2Flib2hw_mul.S", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/c746fc40f4ec8cfc1092efd49d567751858d2099/libgcc%2Fconfig%2Fmsp430%2Flib2hw_mul.S", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libgcc%2Fconfig%2Fmsp430%2Flib2hw_mul.S?ref=c746fc40f4ec8cfc1092efd49d567751858d2099", "patch": "@@ -353,9 +353,9 @@\n \tmult1632 MPY, OP2, RESLO, RESHI\n \tend_func   __umulhisi2\n \n-\tstart_func __mulsi2_hw32  __mspabi_mpyl  __mspabi_mpyl_hw32\n+\tstart_func __mulsi2  __mspabi_mpyl  __mspabi_mpyl_hw32\n \tmult32_hw MPY32L, MPY32H, OP2L, OP2H, RES0, RES1\n-\tend_func   __mulsi2_hw32\n+\tend_func   __mulsi2\n \n \tstart_func __mulsidi2  __mspabi_mpysll  __mspabi_mpysll_hw32\n \tmult3264_hw MPYS32L, MPYS32H, OP2L, OP2H, RES0, RES1, RES2, RES3\n@@ -373,9 +373,9 @@\n    as the second generation hardware, but they are accessed from different\n    memory registers.  */\n \n-\tstart_func __mulhi2_f5 __mspabi_mpyi  __mspabi_mpyi_f5hw\n+\tstart_func __mulhi2 __mspabi_mpyi  __mspabi_mpyi_f5hw\n \tmult16 MPY_F5, OP2_F5, RESLO_F5\n-\tend_func   __mulhi2_f5\n+\tend_func   __mulhi2\n \n \tstart_func __mulhisi2  __mspabi_mpysl  __mspabi_mpysl_f5hw\n \tmult1632 MPYS_F5, OP2_F5, RESLO_F5, RESHI_F5\n@@ -385,9 +385,9 @@\n \tmult1632 MPY_F5, OP2_F5, RESLO_F5, RESHI_F5\n \tend_func   __umulhisi2\n \n-\tstart_func __mulsi2_f5  __mspabi_mpyl  __mspabi_mpyl_f5hw\n+\tstart_func __mulsi2  __mspabi_mpyl  __mspabi_mpyl_f5hw\n \tmult32_hw MPY32L_F5, MPY32H_F5, OP2L_F5, OP2H_F5, RES0_F5, RES1_F5\n-\tend_func   __mulsi2_f5\n+\tend_func   __mulsi2\n \n \tstart_func __mulsidi2  __mspabi_mpysll  __mspabi_mpysll_f5hw\n \tmult3264_hw MPYS32L_F5, MPYS32H_F5, OP2L_F5, OP2H_F5, RES0_F5, RES1_F5, RES2_F5, RES3_F5"}]}