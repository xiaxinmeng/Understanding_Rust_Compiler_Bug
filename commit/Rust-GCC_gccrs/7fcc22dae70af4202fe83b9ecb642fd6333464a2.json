{"sha": "7fcc22dae70af4202fe83b9ecb642fd6333464a2", "node_id": "C_kwDOANBUbNoAKDdmY2MyMmRhZTcwYWY0MjAyZmU4M2I5ZWNiNjQyZmQ2MzMzNDY0YTI", "commit": {"author": {"name": "Hongyu Wang", "email": "hongyu.wang@intel.com", "date": "2021-11-03T05:58:52Z"}, "committer": {"name": "Hongyu Wang", "email": "hongyu.wang@intel.com", "date": "2021-11-04T05:01:16Z"}, "message": "i386: Fix wrong result for AMX-TILE intrinsic when parsing expression.\n\n_tile_loadd, _tile_stored, _tile_streamloadd intrinsics are defined by\nmacro, so the parameters should be wrapped by parentheses to accept\nexpressions.\n\ngcc/ChangeLog:\n\n\t* config/i386/amxtileintrin.h (_tile_loadd_internal): Add\n\tparentheses to base and stride.\n\t(_tile_stream_loadd_internal): Likewise.\n\t(_tile_stored_internal): Likewise.\n\ngcc/testsuite/ChangeLog:\n\t* gcc.target/i386/amxtile-3.c: New test.", "tree": {"sha": "14c063eb654b149038b6d7f604842058613e8bf2", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/14c063eb654b149038b6d7f604842058613e8bf2"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/7fcc22dae70af4202fe83b9ecb642fd6333464a2", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/7fcc22dae70af4202fe83b9ecb642fd6333464a2", "html_url": "https://github.com/Rust-GCC/gccrs/commit/7fcc22dae70af4202fe83b9ecb642fd6333464a2", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/7fcc22dae70af4202fe83b9ecb642fd6333464a2/comments", "author": {"login": "wwwhhhyyy", "id": 5366075, "node_id": "MDQ6VXNlcjUzNjYwNzU=", "avatar_url": "https://avatars.githubusercontent.com/u/5366075?v=4", "gravatar_id": "", "url": "https://api.github.com/users/wwwhhhyyy", "html_url": "https://github.com/wwwhhhyyy", "followers_url": "https://api.github.com/users/wwwhhhyyy/followers", "following_url": "https://api.github.com/users/wwwhhhyyy/following{/other_user}", "gists_url": "https://api.github.com/users/wwwhhhyyy/gists{/gist_id}", "starred_url": "https://api.github.com/users/wwwhhhyyy/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/wwwhhhyyy/subscriptions", "organizations_url": "https://api.github.com/users/wwwhhhyyy/orgs", "repos_url": "https://api.github.com/users/wwwhhhyyy/repos", "events_url": "https://api.github.com/users/wwwhhhyyy/events{/privacy}", "received_events_url": "https://api.github.com/users/wwwhhhyyy/received_events", "type": "User", "site_admin": false}, "committer": {"login": "wwwhhhyyy", "id": 5366075, "node_id": "MDQ6VXNlcjUzNjYwNzU=", "avatar_url": "https://avatars.githubusercontent.com/u/5366075?v=4", "gravatar_id": "", "url": "https://api.github.com/users/wwwhhhyyy", "html_url": "https://github.com/wwwhhhyyy", "followers_url": "https://api.github.com/users/wwwhhhyyy/followers", "following_url": "https://api.github.com/users/wwwhhhyyy/following{/other_user}", "gists_url": "https://api.github.com/users/wwwhhhyyy/gists{/gist_id}", "starred_url": "https://api.github.com/users/wwwhhhyyy/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/wwwhhhyyy/subscriptions", "organizations_url": "https://api.github.com/users/wwwhhhyyy/orgs", "repos_url": "https://api.github.com/users/wwwhhhyyy/repos", "events_url": "https://api.github.com/users/wwwhhhyyy/events{/privacy}", "received_events_url": "https://api.github.com/users/wwwhhhyyy/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "cd389e5f9447d21084abff5d4b7db6cf1da74e57", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/cd389e5f9447d21084abff5d4b7db6cf1da74e57", "html_url": "https://github.com/Rust-GCC/gccrs/commit/cd389e5f9447d21084abff5d4b7db6cf1da74e57"}], "stats": {"total": 34, "additions": 31, "deletions": 3}, "files": [{"sha": "3a0a6b44c170b97eca92a31c65acd8b6dccb440e", "filename": "gcc/config/i386/amxtileintrin.h", "status": "modified", "additions": 3, "deletions": 3, "changes": 6, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/7fcc22dae70af4202fe83b9ecb642fd6333464a2/gcc%2Fconfig%2Fi386%2Famxtileintrin.h", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/7fcc22dae70af4202fe83b9ecb642fd6333464a2/gcc%2Fconfig%2Fi386%2Famxtileintrin.h", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fconfig%2Fi386%2Famxtileintrin.h?ref=7fcc22dae70af4202fe83b9ecb642fd6333464a2", "patch": "@@ -62,23 +62,23 @@ _tile_release (void)\n #define _tile_loadd_internal(dst,base,stride)\t\t\t\t\\\n   __asm__ volatile\t\t\t\t\t\t\t\\\n   (\"{tileloadd\\t(%0,%1,1), %%tmm\"#dst\"|tileloadd\\t%%tmm\"#dst\", [%0+%1*1]}\" \\\n-   :: \"r\" ((const void*) base), \"r\" ((long) stride))\n+   :: \"r\" ((const void*) (base)), \"r\" ((long) (stride)))\n \n #define _tile_stream_loadd(dst,base,stride)\t\t\\\n   _tile_stream_loadd_internal (dst, base, stride)\n \n #define _tile_stream_loadd_internal(dst,base,stride)\t\t\t\\\n   __asm__ volatile\t\t\t\t\t\t\t\\\n   (\"{tileloaddt1\\t(%0,%1,1), %%tmm\"#dst\"|tileloaddt1\\t%%tmm\"#dst\", [%0+%1*1]}\" \\\n-   :: \"r\" ((const void*) base), \"r\" ((long) stride))\n+   :: \"r\" ((const void*) (base)), \"r\" ((long) (stride)))\n \n #define _tile_stored(dst,base,stride)\t\t\\\n   _tile_stored_internal (dst, base, stride)\n \n #define _tile_stored_internal(src,base,stride)\t\t\t\t\\\n   __asm__ volatile\t\t\t\t\t\t\t\\\n   (\"{tilestored\\t%%tmm\"#src\", (%0,%1,1)|tilestored\\t[%0+%1*1], %%tmm\"#src\"}\" \\\n-   :: \"r\" ((void*) base), \"r\" ((long) stride) \\\n+   :: \"r\" ((void*) (base)), \"r\" ((long) (stride)) \\\n    : \"memory\")\n \n #define _tile_zero(dst)\t\t\t\t\\"}, {"sha": "31b34d0ed15f38016609754b5e6d9c3495269c47", "filename": "gcc/testsuite/gcc.target/i386/amxtile-3.c", "status": "added", "additions": 28, "deletions": 0, "changes": 28, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/7fcc22dae70af4202fe83b9ecb642fd6333464a2/gcc%2Ftestsuite%2Fgcc.target%2Fi386%2Famxtile-3.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/7fcc22dae70af4202fe83b9ecb642fd6333464a2/gcc%2Ftestsuite%2Fgcc.target%2Fi386%2Famxtile-3.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgcc.target%2Fi386%2Famxtile-3.c?ref=7fcc22dae70af4202fe83b9ecb642fd6333464a2", "patch": "@@ -0,0 +1,28 @@\n+/* { dg-do compile { target { ! ia32 } } } */\n+/* { dg-options \"-O2 -mamx-tile \" } */\n+/* { dg-final { scan-assembler \"tileloadd\\[ \\\\t]+\\[^\\n\\]*\\\\(%\\[a-z0-9]*\\,%\\[a-z0-9\\]*\\,\\[124\\]\\\\)+\\[^\\n\\]*%tmm\\[0-9\\]\"  } } */\n+/* { dg-final { scan-assembler \"tileloaddt1\\[ \\\\t]+\\[^\\n\\]*\\\\(%\\[a-z0-9]*\\,%\\[a-z0-9\\]*\\,\\[124\\]\\\\)+\\[^\\n\\]*%tmm\\[0-9\\]\"  } } */\n+/* { dg-final { scan-assembler \"tilestored\\[ \\\\t]+\\[^\\n\\]*%tmm\\[0-9\\]+\\[^\\n\\]*\\\\(%\\[a-z0-9]*\\,%\\[a-z0-9\\]*\\,\\[124\\]\\\\)\"  } } */\n+/* { dg-final { scan-assembler \"leaq\\[ \\\\t]+4\" } } */\n+/* { dg-final { scan-assembler \"leaq\\[ \\\\t]+8\" } } */\n+/* { dg-final { scan-assembler \"addq\\[ \\\\t]+\\\\\\$12\" } } */\n+/* { dg-final { scan-assembler-not \"leaq\\[ \\\\t]+1\" } } */\n+/* { dg-final { scan-assembler-not \"leaq\\[ \\\\t]+2\" } } */\n+/* { dg-final { scan-assembler-not \"addq\\[ \\\\t]+\\\\\\$3\" } } */\n+#include <immintrin.h>\n+\n+extern int a[];\n+extern const float* base;\n+extern const int stride;\n+\n+#define TMM0 0\n+#define TMM1 1\n+#define TMM2 2\n+#define TMM3 3\n+\n+void TEST ()\n+{\n+  _tile_loadd (TMM3, base + 1, stride);\n+  _tile_stream_loadd (TMM2, base + 2, stride);\n+  _tile_stored (TMM2, base + 3, stride);\n+}"}]}