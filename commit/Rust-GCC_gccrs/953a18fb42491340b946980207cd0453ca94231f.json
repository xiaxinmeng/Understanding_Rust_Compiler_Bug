{"sha": "953a18fb42491340b946980207cd0453ca94231f", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6OTUzYTE4ZmI0MjQ5MTM0MGI5NDY5ODAyMDdjZDA0NTNjYTk0MjMxZg==", "commit": {"author": {"name": "Richard Earnshaw", "email": "rearnsha@arm.com", "date": "2009-10-30T09:16:36Z"}, "committer": {"name": "Richard Earnshaw", "email": "rearnsha@gcc.gnu.org", "date": "2009-10-30T09:16:36Z"}, "message": "arm.md (QHSI): New mode iterator.\n\n\t* arm.md (QHSI): New mode iterator.\n\t(movqi): If generating for thumb, then truncate any immediate to\n\t8 bits.\n\t* thumb2.md (thumb2_movsi_shortim and peephole2 generator): Replace\n\twith...\n\t(thumb2_mov<mode>_shortim and peephole2 generator): ... iterator based\n\tversion.\n\nFrom-SVN: r153739", "tree": {"sha": "2fec46398eab606f74b48f91eda97295b02b4549", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/2fec46398eab606f74b48f91eda97295b02b4549"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/953a18fb42491340b946980207cd0453ca94231f", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/953a18fb42491340b946980207cd0453ca94231f", "html_url": "https://github.com/Rust-GCC/gccrs/commit/953a18fb42491340b946980207cd0453ca94231f", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/953a18fb42491340b946980207cd0453ca94231f/comments", "author": null, "committer": null, "parents": [{"sha": "649fb657d597922f0e0fa7647c22292a705e9859", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/649fb657d597922f0e0fa7647c22292a705e9859", "html_url": "https://github.com/Rust-GCC/gccrs/commit/649fb657d597922f0e0fa7647c22292a705e9859"}], "stats": {"total": 28, "additions": 23, "deletions": 5}, "files": [{"sha": "c060b6f0c7e923175e8341d566ad899e0b85dc4b", "filename": "gcc/ChangeLog", "status": "modified", "additions": 10, "deletions": 0, "changes": 10, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/953a18fb42491340b946980207cd0453ca94231f/gcc%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/953a18fb42491340b946980207cd0453ca94231f/gcc%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2FChangeLog?ref=953a18fb42491340b946980207cd0453ca94231f", "patch": "@@ -1,3 +1,13 @@\n+2009-10-30  Richard Earnshaw  <rearnsha@arm.com>\n+\n+\t* arm.md (QHSI): New mode iterator.\n+\t(movqi): If generating for thumb, then truncate any immediate to\n+\t8 bits.\n+\t* thumb2.md (thumb2_movsi_shortim and peephole2 generator): Replace\n+\twith...\n+\t(thumb2_mov<mode>_shortim and peephole2 generator): ... iterator based\n+\tversion.\n+\n 2009-10-29  Cary Coutant  <ccoutant@google.com>\n \n \tPR debug/41700"}, {"sha": "b8bf700242b228524e481527f2c4ca7042949c06", "filename": "gcc/config/arm/arm.md", "status": "modified", "additions": 8, "deletions": 0, "changes": 8, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/953a18fb42491340b946980207cd0453ca94231f/gcc%2Fconfig%2Farm%2Farm.md", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/953a18fb42491340b946980207cd0453ca94231f/gcc%2Fconfig%2Farm%2Farm.md", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fconfig%2Farm%2Farm.md?ref=953a18fb42491340b946980207cd0453ca94231f", "patch": "@@ -392,6 +392,9 @@\n ; registers.\n (define_mode_iterator ANY64 [DI DF V8QI V4HI V2SI V2SF])\n \n+;; The integer modes up to word size\n+(define_mode_iterator QHSI [QI HI SI])\n+\n ;;---------------------------------------------------------------------------\n ;; Predicates\n \n@@ -5848,6 +5851,11 @@\n \t{\n \t  rtx reg = gen_reg_rtx (SImode);\n \n+\t  /* For thumb we want an unsigned immediate, then we are more likely \n+\t     to be able to use a movs insn.  */\n+\t  if (TARGET_THUMB)\n+\t    operands[1] = GEN_INT (INTVAL (operands[1]) & 255);\n+\n \t  emit_insn (gen_movsi (reg, operands[1]));\n \t  operands[1] = gen_lowpart (QImode, reg);\n \t}"}, {"sha": "82f75f9b7336d183b67f7e52596faac9bc425682", "filename": "gcc/config/arm/thumb2.md", "status": "modified", "additions": 5, "deletions": 5, "changes": 10, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/953a18fb42491340b946980207cd0453ca94231f/gcc%2Fconfig%2Farm%2Fthumb2.md", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/953a18fb42491340b946980207cd0453ca94231f/gcc%2Fconfig%2Farm%2Fthumb2.md", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fconfig%2Farm%2Fthumb2.md?ref=953a18fb42491340b946980207cd0453ca94231f", "patch": "@@ -1156,8 +1156,8 @@\n \n ;; 16-bit load immediate\n (define_peephole2\n-  [(set (match_operand:SI 0 \"low_register_operand\" \"\")\n-\t(match_operand:SI 1 \"const_int_operand\" \"\"))]\n+  [(set (match_operand:QHSI 0 \"low_register_operand\" \"\")\n+\t(match_operand:QHSI 1 \"const_int_operand\" \"\"))]\n   \"TARGET_THUMB2\n    && peep2_regno_dead_p(0, CC_REGNUM)\n    && (unsigned HOST_WIDE_INT) INTVAL(operands[1]) < 256\"\n@@ -1168,9 +1168,9 @@\n   \"\"\n )\n \n-(define_insn \"*thumb2_movsi_shortim\"\n-  [(set (match_operand:SI 0 \"low_register_operand\" \"=l\")\n-\t(match_operand:SI 1 \"const_int_operand\" \"I\"))\n+(define_insn \"*thumb2_mov<mode>_shortim\"\n+  [(set (match_operand:QHSI 0 \"low_register_operand\" \"=l\")\n+\t(match_operand:QHSI 1 \"const_int_operand\" \"I\"))\n    (clobber (reg:CC CC_REGNUM))]\n   \"TARGET_THUMB2 && reload_completed\"\n   \"mov%!\\t%0, %1\""}]}