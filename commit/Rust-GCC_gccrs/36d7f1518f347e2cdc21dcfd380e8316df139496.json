{"sha": "36d7f1518f347e2cdc21dcfd380e8316df139496", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6MzZkN2YxNTE4ZjM0N2UyY2RjMjFkY2ZkMzgwZTgzMTZkZjEzOTQ5Ng==", "commit": {"author": {"name": "Johannes Pfau", "email": "johannespfau@gmail.com", "date": "2019-02-18T23:29:39Z"}, "committer": {"name": "Iain Buclaw", "email": "ibuclaw@gcc.gnu.org", "date": "2019-02-18T23:29:39Z"}, "message": "libphobos: Detect if qsort_r is available\n\nMerges upstream druntime bbfb58e8.\n\nlibphobos/ChangeLog:\n\n2019-02-19  Johannes Pfau  <johannespfau@gmail.com>\n\n\tPR d/88127\n\t* m4/druntime/libraries.m4 (DRUNTIME_LIBRARIES_CLIB): Add new macro.\n\t* configure.ac: Use DRUNTIME_LIBRARIES_CLIB.\n\t* configure: Regenerate\n\t* Makefile.in: Regenerate\n\t* libdruntime/gcc/config.d.in: Add Have_Qsort_R.\n\t* libdruntime/Makefile.in: Regenerate.\n\t* src/Makefile.in: Regenerate.\n\t* testsuite/Makefile.in: Regenerate.\n\nFrom-SVN: r268999", "tree": {"sha": "b39c85a4affc15b249d6b9c57cdb3a4c0f2dd256", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/b39c85a4affc15b249d6b9c57cdb3a4c0f2dd256"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/36d7f1518f347e2cdc21dcfd380e8316df139496", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/36d7f1518f347e2cdc21dcfd380e8316df139496", "html_url": "https://github.com/Rust-GCC/gccrs/commit/36d7f1518f347e2cdc21dcfd380e8316df139496", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/36d7f1518f347e2cdc21dcfd380e8316df139496/comments", "author": {"login": "jpf91", "id": 583238, "node_id": "MDQ6VXNlcjU4MzIzOA==", "avatar_url": "https://avatars.githubusercontent.com/u/583238?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jpf91", "html_url": "https://github.com/jpf91", "followers_url": "https://api.github.com/users/jpf91/followers", "following_url": "https://api.github.com/users/jpf91/following{/other_user}", "gists_url": "https://api.github.com/users/jpf91/gists{/gist_id}", "starred_url": "https://api.github.com/users/jpf91/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jpf91/subscriptions", "organizations_url": "https://api.github.com/users/jpf91/orgs", "repos_url": "https://api.github.com/users/jpf91/repos", "events_url": "https://api.github.com/users/jpf91/events{/privacy}", "received_events_url": "https://api.github.com/users/jpf91/received_events", "type": "User", "site_admin": false}, "committer": null, "parents": [{"sha": "0232a2191b72a57a84c0d9967b7b00bdfdab898e", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/0232a2191b72a57a84c0d9967b7b00bdfdab898e", "html_url": "https://github.com/Rust-GCC/gccrs/commit/0232a2191b72a57a84c0d9967b7b00bdfdab898e"}], "stats": {"total": 78, "additions": 75, "deletions": 3}, "files": [{"sha": "5e24d948513980c692231e79e7fa2eee9b3532d6", "filename": "libphobos/ChangeLog", "status": "modified", "additions": 12, "deletions": 0, "changes": 12, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/36d7f1518f347e2cdc21dcfd380e8316df139496/libphobos%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/36d7f1518f347e2cdc21dcfd380e8316df139496/libphobos%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libphobos%2FChangeLog?ref=36d7f1518f347e2cdc21dcfd380e8316df139496", "patch": "@@ -1,3 +1,15 @@\n+2019-02-19  Johannes Pfau  <johannespfau@gmail.com>\n+\n+\tPR d/88127\n+\t* m4/druntime/libraries.m4 (DRUNTIME_LIBRARIES_CLIB): Add new macro.\n+\t* configure.ac: Use DRUNTIME_LIBRARIES_CLIB.\n+\t* configure: Regenerate\n+\t* Makefile.in: Regenerate\n+\t* libdruntime/gcc/config.d.in: Add Have_Qsort_R.\n+\t* libdruntime/Makefile.in: Regenerate.\n+\t* src/Makefile.in: Regenerate.\n+\t* testsuite/Makefile.in: Regenerate.\n+\n 2019-02-18  Rainer Orth  <ro@CeBiTec.Uni-Bielefeld.DE>\n \n \t* testsuite/lib/libphobos-dg.exp: Tabify."}, {"sha": "e7c156aa5eb22dcadb4487726b66b337a9b02a33", "filename": "libphobos/Makefile.in", "status": "modified", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/36d7f1518f347e2cdc21dcfd380e8316df139496/libphobos%2FMakefile.in", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/36d7f1518f347e2cdc21dcfd380e8316df139496/libphobos%2FMakefile.in", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libphobos%2FMakefile.in?ref=36d7f1518f347e2cdc21dcfd380e8316df139496", "patch": "@@ -213,6 +213,7 @@ DCFG_ARM_EABI_UNWINDER = @DCFG_ARM_EABI_UNWINDER@\n DCFG_HAVE_64BIT_ATOMICS = @DCFG_HAVE_64BIT_ATOMICS@\n DCFG_HAVE_ATOMIC_BUILTINS = @DCFG_HAVE_ATOMIC_BUILTINS@\n DCFG_HAVE_LIBATOMIC = @DCFG_HAVE_LIBATOMIC@\n+DCFG_HAVE_QSORT_R = @DCFG_HAVE_QSORT_R@\n DCFG_MINFO_BRACKETING = @DCFG_MINFO_BRACKETING@\n DCFG_THREAD_MODEL = @DCFG_THREAD_MODEL@\n DEFS = @DEFS@"}, {"sha": "7bb034b841d2b3cdea62a2d6c47aec1b58f76035", "filename": "libphobos/configure", "status": "modified", "additions": 24, "deletions": 2, "changes": 26, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/36d7f1518f347e2cdc21dcfd380e8316df139496/libphobos%2Fconfigure", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/36d7f1518f347e2cdc21dcfd380e8316df139496/libphobos%2Fconfigure", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libphobos%2Fconfigure?ref=36d7f1518f347e2cdc21dcfd380e8316df139496", "patch": "@@ -650,6 +650,7 @@ LIBATOMIC\n DCFG_HAVE_LIBATOMIC\n DCFG_HAVE_64BIT_ATOMICS\n DCFG_HAVE_ATOMIC_BUILTINS\n+DCFG_HAVE_QSORT_R\n DRUNTIME_OS_MINFO_BRACKETING_FALSE\n DRUNTIME_OS_MINFO_BRACKETING_TRUE\n DCFG_MINFO_BRACKETING\n@@ -11498,7 +11499,7 @@ else\n   lt_dlunknown=0; lt_dlno_uscore=1; lt_dlneed_uscore=2\n   lt_status=$lt_dlunknown\n   cat > conftest.$ac_ext <<_LT_EOF\n-#line 11501 \"configure\"\n+#line 11502 \"configure\"\n #include \"confdefs.h\"\n \n #if HAVE_DLFCN_H\n@@ -11604,7 +11605,7 @@ else\n   lt_dlunknown=0; lt_dlno_uscore=1; lt_dlneed_uscore=2\n   lt_status=$lt_dlunknown\n   cat > conftest.$ac_ext <<_LT_EOF\n-#line 11607 \"configure\"\n+#line 11608 \"configure\"\n #include \"confdefs.h\"\n \n #if HAVE_DLFCN_H\n@@ -14137,6 +14138,27 @@ ac_compiler_gnu=$ac_cv_c_compiler_gnu\n \n \n \n+  ac_ext=c\n+ac_cpp='$CPP $CPPFLAGS'\n+ac_compile='$CC -c $CFLAGS $CPPFLAGS conftest.$ac_ext >&5'\n+ac_link='$CC -o conftest$ac_exeext $CFLAGS $CPPFLAGS $LDFLAGS conftest.$ac_ext $LIBS >&5'\n+ac_compiler_gnu=$ac_cv_c_compiler_gnu\n+\n+  DCFG_HAVE_QSORT_R=false\n+  ac_fn_c_check_func \"$LINENO\" \"qsort_r\" \"ac_cv_func_qsort_r\"\n+if test \"x$ac_cv_func_qsort_r\" = xyes; then :\n+  DCFG_HAVE_QSORT_R=true\n+fi\n+\n+\n+  ac_ext=c\n+ac_cpp='$CPP $CPPFLAGS'\n+ac_compile='$CC -c $CFLAGS $CPPFLAGS conftest.$ac_ext >&5'\n+ac_link='$CC -o conftest$ac_exeext $CFLAGS $CPPFLAGS $LDFLAGS conftest.$ac_ext $LIBS >&5'\n+ac_compiler_gnu=$ac_cv_c_compiler_gnu\n+\n+\n+\n \n \n   gdc_save_DFLAGS=$GDCFLAGS"}, {"sha": "b436dc034ae07f37ef31f8b89e1d39832bd68ec4", "filename": "libphobos/configure.ac", "status": "modified", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/36d7f1518f347e2cdc21dcfd380e8316df139496/libphobos%2Fconfigure.ac", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/36d7f1518f347e2cdc21dcfd380e8316df139496/libphobos%2Fconfigure.ac", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libphobos%2Fconfigure.ac?ref=36d7f1518f347e2cdc21dcfd380e8316df139496", "patch": "@@ -126,6 +126,7 @@ DRUNTIME_OS_SOURCES\n DRUNTIME_OS_THREAD_MODEL\n DRUNTIME_OS_ARM_EABI_UNWINDER\n DRUNTIME_OS_MINFO_BRACKETING\n+DRUNTIME_LIBRARIES_CLIB\n \n WITH_LOCAL_DRUNTIME([\n   AC_LANG_PUSH([D])"}, {"sha": "1a09ebf54109833ac9a8142fe7bc2303c104fde4", "filename": "libphobos/libdruntime/MERGE", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/36d7f1518f347e2cdc21dcfd380e8316df139496/libphobos%2Flibdruntime%2FMERGE", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/36d7f1518f347e2cdc21dcfd380e8316df139496/libphobos%2Flibdruntime%2FMERGE", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libphobos%2Flibdruntime%2FMERGE?ref=36d7f1518f347e2cdc21dcfd380e8316df139496", "patch": "@@ -1,4 +1,4 @@\n-fb4bda91b0b43b5a18e1c143943c101ad4e17667\n+bbfb58e8a921cabdd0002a40bf63fe35ed7c77e8\n \n The first line of this file holds the git revision number of the last\n merge done from the dlang/druntime repository."}, {"sha": "8f4ff8b1831694ffc854730a21dbec0691d0cac4", "filename": "libphobos/libdruntime/Makefile.in", "status": "modified", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/36d7f1518f347e2cdc21dcfd380e8316df139496/libphobos%2Flibdruntime%2FMakefile.in", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/36d7f1518f347e2cdc21dcfd380e8316df139496/libphobos%2Flibdruntime%2FMakefile.in", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libphobos%2Flibdruntime%2FMakefile.in?ref=36d7f1518f347e2cdc21dcfd380e8316df139496", "patch": "@@ -1096,6 +1096,7 @@ DCFG_ARM_EABI_UNWINDER = @DCFG_ARM_EABI_UNWINDER@\n DCFG_HAVE_64BIT_ATOMICS = @DCFG_HAVE_64BIT_ATOMICS@\n DCFG_HAVE_ATOMIC_BUILTINS = @DCFG_HAVE_ATOMIC_BUILTINS@\n DCFG_HAVE_LIBATOMIC = @DCFG_HAVE_LIBATOMIC@\n+DCFG_HAVE_QSORT_R = @DCFG_HAVE_QSORT_R@\n DCFG_MINFO_BRACKETING = @DCFG_MINFO_BRACKETING@\n DCFG_THREAD_MODEL = @DCFG_THREAD_MODEL@\n DEFS = @DEFS@"}, {"sha": "4652bf095313055e8786ce7377cacdf82133e402", "filename": "libphobos/libdruntime/gcc/config.d.in", "status": "modified", "additions": 3, "deletions": 0, "changes": 3, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/36d7f1518f347e2cdc21dcfd380e8316df139496/libphobos%2Flibdruntime%2Fgcc%2Fconfig.d.in", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/36d7f1518f347e2cdc21dcfd380e8316df139496/libphobos%2Flibdruntime%2Fgcc%2Fconfig.d.in", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libphobos%2Flibdruntime%2Fgcc%2Fconfig.d.in?ref=36d7f1518f347e2cdc21dcfd380e8316df139496", "patch": "@@ -43,3 +43,6 @@ enum GNU_Have_64Bit_Atomics = @DCFG_HAVE_64BIT_ATOMICS@;\n \n // Do we have libatomic available\n enum GNU_Have_LibAtomic = @DCFG_HAVE_LIBATOMIC@;\n+\n+// Do we have qsort_r function\n+enum Have_Qsort_R = @DCFG_HAVE_QSORT_R@;"}, {"sha": "af0c1eb704aaf36af79373fe2878ab12ef8022f2", "filename": "libphobos/libdruntime/rt/qsort.d", "status": "modified", "additions": 18, "deletions": 0, "changes": 18, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/36d7f1518f347e2cdc21dcfd380e8316df139496/libphobos%2Flibdruntime%2Frt%2Fqsort.d", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/36d7f1518f347e2cdc21dcfd380e8316df139496/libphobos%2Flibdruntime%2Frt%2Fqsort.d", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libphobos%2Flibdruntime%2Frt%2Fqsort.d?ref=36d7f1518f347e2cdc21dcfd380e8316df139496", "patch": "@@ -27,7 +27,25 @@ else version (TVOS)\n else version (WatchOS)\n     version = Darwin;\n \n+// qsort_r was added in glibc in 2.8. https://gcc.gnu.org/bugzilla/show_bug.cgi?id=88127\n version (CRuntime_Glibc)\n+{\n+    version (GNU)\n+    {\n+        import gcc.config : Have_Qsort_R;\n+        enum Glibc_Qsort_R = Have_Qsort_R;\n+    }\n+    else\n+    {\n+        enum Glibc_Qsort_R = true;\n+    }\n+}\n+else\n+{\n+    enum Glibc_Qsort_R = false;\n+}\n+\n+static if (Glibc_Qsort_R)\n {\n     alias extern (C) int function(scope const void *, scope const void *, scope void *) Cmp;\n     extern (C) void qsort_r(scope void *base, size_t nmemb, size_t size, Cmp cmp, scope void *arg);"}, {"sha": "35a791d137a57171ddea8d1c7db7c9ac64c00089", "filename": "libphobos/m4/druntime/libraries.m4", "status": "modified", "additions": 12, "deletions": 0, "changes": 12, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/36d7f1518f347e2cdc21dcfd380e8316df139496/libphobos%2Fm4%2Fdruntime%2Flibraries.m4", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/36d7f1518f347e2cdc21dcfd380e8316df139496/libphobos%2Fm4%2Fdruntime%2Flibraries.m4", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libphobos%2Fm4%2Fdruntime%2Flibraries.m4?ref=36d7f1518f347e2cdc21dcfd380e8316df139496", "patch": "@@ -161,3 +161,15 @@ AC_DEFUN([DRUNTIME_LIBRARIES_BACKTRACE],\n   AC_SUBST(BACKTRACE_SUPPORTS_THREADS)\n   AC_LANG_POP([C])\n ])\n+\n+# DRUNTIME_LIBRARIES_CLIB\n+# -----------------------\n+# Perform various feature checks on the C library.\n+AC_DEFUN([DRUNTIME_LIBRARIES_CLIB],\n+[\n+  AC_LANG_PUSH([C])\n+  DCFG_HAVE_QSORT_R=false\n+  AC_CHECK_FUNC(qsort_r, [DCFG_HAVE_QSORT_R=true])\n+  AC_SUBST(DCFG_HAVE_QSORT_R)\n+  AC_LANG_POP([C])\n+])"}, {"sha": "b6037ac0ff0e58567a1b1b8a6c357135db4a8916", "filename": "libphobos/src/Makefile.in", "status": "modified", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/36d7f1518f347e2cdc21dcfd380e8316df139496/libphobos%2Fsrc%2FMakefile.in", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/36d7f1518f347e2cdc21dcfd380e8316df139496/libphobos%2Fsrc%2FMakefile.in", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libphobos%2Fsrc%2FMakefile.in?ref=36d7f1518f347e2cdc21dcfd380e8316df139496", "patch": "@@ -504,6 +504,7 @@ DCFG_ARM_EABI_UNWINDER = @DCFG_ARM_EABI_UNWINDER@\n DCFG_HAVE_64BIT_ATOMICS = @DCFG_HAVE_64BIT_ATOMICS@\n DCFG_HAVE_ATOMIC_BUILTINS = @DCFG_HAVE_ATOMIC_BUILTINS@\n DCFG_HAVE_LIBATOMIC = @DCFG_HAVE_LIBATOMIC@\n+DCFG_HAVE_QSORT_R = @DCFG_HAVE_QSORT_R@\n DCFG_MINFO_BRACKETING = @DCFG_MINFO_BRACKETING@\n DCFG_THREAD_MODEL = @DCFG_THREAD_MODEL@\n DEFS = @DEFS@"}, {"sha": "78107d22680500fa9df8dd9d93781eb3fb7b4cce", "filename": "libphobos/testsuite/Makefile.in", "status": "modified", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/36d7f1518f347e2cdc21dcfd380e8316df139496/libphobos%2Ftestsuite%2FMakefile.in", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/36d7f1518f347e2cdc21dcfd380e8316df139496/libphobos%2Ftestsuite%2FMakefile.in", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libphobos%2Ftestsuite%2FMakefile.in?ref=36d7f1518f347e2cdc21dcfd380e8316df139496", "patch": "@@ -159,6 +159,7 @@ DCFG_ARM_EABI_UNWINDER = @DCFG_ARM_EABI_UNWINDER@\n DCFG_HAVE_64BIT_ATOMICS = @DCFG_HAVE_64BIT_ATOMICS@\n DCFG_HAVE_ATOMIC_BUILTINS = @DCFG_HAVE_ATOMIC_BUILTINS@\n DCFG_HAVE_LIBATOMIC = @DCFG_HAVE_LIBATOMIC@\n+DCFG_HAVE_QSORT_R = @DCFG_HAVE_QSORT_R@\n DCFG_MINFO_BRACKETING = @DCFG_MINFO_BRACKETING@\n DCFG_THREAD_MODEL = @DCFG_THREAD_MODEL@\n DEFS = @DEFS@"}]}