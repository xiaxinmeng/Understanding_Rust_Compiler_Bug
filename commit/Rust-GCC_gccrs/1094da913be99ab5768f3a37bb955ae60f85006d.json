{"sha": "1094da913be99ab5768f3a37bb955ae60f85006d", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6MTA5NGRhOTEzYmU5OWFiNTc2OGYzYTM3YmI5NTVhZTYwZjg1MDA2ZA==", "commit": {"author": {"name": "Simon Martin", "email": "simartin@users.sourceforge.net", "date": "2007-05-25T20:26:36Z"}, "committer": {"name": "Simon Martin", "email": "simartin@gcc.gnu.org", "date": "2007-05-25T20:26:36Z"}, "message": "re PR c++/31745 (ICE on invalid use of namespace)\n\n2007-05-25  Simon Martin  <simartin@users.sourceforge.net>\n\t    Manuel Lopez-Ibanez  <manu@gcc.gnu.org>\n\n\tPR c++/31745\n\t* parser.c (cp_parser_skip_to_closing_brace): Return true if the next\n\ttoken is a closing brace, false if there are no tokens left.\n\t(cp_parser_namespace_alias_definition): Only consume the next token if\n\tit is a closing brace.\n\n\t* parser.c (cp_parser_class_specifier): Likewise.\n\nCo-Authored-By: Lee Millward <lee.millward@gmail.com>\nCo-Authored-By: Manuel L\u00f3pez-Ib\u00e1\u00f1ez <manu@gcc.gnu.org>\n\nFrom-SVN: r125070", "tree": {"sha": "1e64bb39a5081cc53752f25e2be1fe856894fd75", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/1e64bb39a5081cc53752f25e2be1fe856894fd75"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/1094da913be99ab5768f3a37bb955ae60f85006d", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/1094da913be99ab5768f3a37bb955ae60f85006d", "html_url": "https://github.com/Rust-GCC/gccrs/commit/1094da913be99ab5768f3a37bb955ae60f85006d", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/1094da913be99ab5768f3a37bb955ae60f85006d/comments", "author": {"login": "simartin", "id": 935202, "node_id": "MDQ6VXNlcjkzNTIwMg==", "avatar_url": "https://avatars.githubusercontent.com/u/935202?v=4", "gravatar_id": "", "url": "https://api.github.com/users/simartin", "html_url": "https://github.com/simartin", "followers_url": "https://api.github.com/users/simartin/followers", "following_url": "https://api.github.com/users/simartin/following{/other_user}", "gists_url": "https://api.github.com/users/simartin/gists{/gist_id}", "starred_url": "https://api.github.com/users/simartin/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/simartin/subscriptions", "organizations_url": "https://api.github.com/users/simartin/orgs", "repos_url": "https://api.github.com/users/simartin/repos", "events_url": "https://api.github.com/users/simartin/events{/privacy}", "received_events_url": "https://api.github.com/users/simartin/received_events", "type": "User", "site_admin": false}, "committer": null, "parents": [{"sha": "eb89f88cb853ff9e2604c9414360a312a39263ab", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/eb89f88cb853ff9e2604c9414360a312a39263ab", "html_url": "https://github.com/Rust-GCC/gccrs/commit/eb89f88cb853ff9e2604c9414360a312a39263ab"}], "stats": {"total": 52, "additions": 42, "deletions": 10}, "files": [{"sha": "5b4d88c98a3c0a595e69ff06b0def124308d94af", "filename": "gcc/cp/ChangeLog", "status": "modified", "additions": 11, "deletions": 0, "changes": 11, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/1094da913be99ab5768f3a37bb955ae60f85006d/gcc%2Fcp%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/1094da913be99ab5768f3a37bb955ae60f85006d/gcc%2Fcp%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fcp%2FChangeLog?ref=1094da913be99ab5768f3a37bb955ae60f85006d", "patch": "@@ -1,3 +1,14 @@\n+2007-05-25  Simon Martin  <simartin@users.sourceforge.net>\n+\t    Manuel Lopez-Ibanez  <manu@gcc.gnu.org>\n+\n+\tPR c++/31745\n+\t* parser.c (cp_parser_skip_to_closing_brace): Return true if the next\n+\ttoken is a closing brace, false if there are no tokens left.\n+\t(cp_parser_namespace_alias_definition): Only consume the next token if\n+\tit is a closing brace.\n+\n+\t* parser.c (cp_parser_class_specifier): Likewise.\n+\n 2007-05-25  H.J. Lu  <hongjiu.lu@intel.com>\n \n \t* semantics.c (finish_member_declaration): Fix a typo in the"}, {"sha": "e7b90b25158982eea67eada628ec04e38c42e846", "filename": "gcc/cp/parser.c", "status": "modified", "additions": 10, "deletions": 10, "changes": 20, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/1094da913be99ab5768f3a37bb955ae60f85006d/gcc%2Fcp%2Fparser.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/1094da913be99ab5768f3a37bb955ae60f85006d/gcc%2Fcp%2Fparser.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fcp%2Fparser.c?ref=1094da913be99ab5768f3a37bb955ae60f85006d", "patch": "@@ -1999,7 +1999,7 @@ static void cp_parser_consume_semicolon_at_end_of_statement\n   (cp_parser *);\n static void cp_parser_skip_to_end_of_block_or_statement\n   (cp_parser *);\n-static void cp_parser_skip_to_closing_brace\n+static bool cp_parser_skip_to_closing_brace\n   (cp_parser *);\n static void cp_parser_skip_to_end_of_template_parameter_list\n   (cp_parser *);\n@@ -2599,9 +2599,10 @@ cp_parser_skip_to_end_of_block_or_statement (cp_parser* parser)\n }\n \n /* Skip tokens until a non-nested closing curly brace is the next\n-   token.  */\n+   token, or there are no more tokens. Return true in the first case,\n+   false otherwise.  */\n \n-static void\n+static bool\n cp_parser_skip_to_closing_brace (cp_parser *parser)\n {\n   unsigned nesting_depth = 0;\n@@ -2615,13 +2616,13 @@ cp_parser_skip_to_closing_brace (cp_parser *parser)\n \tcase CPP_EOF:\n \tcase CPP_PRAGMA_EOL:\n \t  /* If we've run out of tokens, stop.  */\n-\t  return;\n+\t  return false;\n \n \tcase CPP_CLOSE_BRACE:\n \t  /* If the next token is a non-nested `}', then we have reached\n \t     the end of the current block.  */\n \t  if (nesting_depth-- == 0)\n-\t    return;\n+\t    return true;\n \t  break;\n \n \tcase CPP_OPEN_BRACE:\n@@ -11295,8 +11296,8 @@ cp_parser_namespace_alias_definition (cp_parser* parser)\n       error (\"%<namespace%> definition is not allowed here\");\n       /* Skip the definition.  */\n       cp_lexer_consume_token (parser->lexer);\n-      cp_parser_skip_to_closing_brace (parser);\n-      cp_lexer_consume_token (parser->lexer);\n+      if (cp_parser_skip_to_closing_brace (parser))\n+\tcp_lexer_consume_token (parser->lexer);\n       return;\n     }\n   cp_parser_require (parser, CPP_EQ, \"`='\");\n@@ -13818,11 +13819,10 @@ cp_parser_class_specifier (cp_parser* parser)\n      entire class body.  */\n   if (!xref_basetypes (type, bases))\n     {\n-      cp_parser_skip_to_closing_brace (parser);\n-\n       /* Consuming the closing brace yields better error messages\n          later on.  */\n-      cp_lexer_consume_token (parser->lexer);\n+      if (cp_parser_skip_to_closing_brace (parser))\n+\tcp_lexer_consume_token (parser->lexer);\n       pop_deferring_access_checks ();\n       return error_mark_node;\n     }"}, {"sha": "0da350c3944ff0396c770b7aa92967612a3ea4e1", "filename": "gcc/testsuite/ChangeLog", "status": "modified", "additions": 8, "deletions": 0, "changes": 8, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/1094da913be99ab5768f3a37bb955ae60f85006d/gcc%2Ftestsuite%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/1094da913be99ab5768f3a37bb955ae60f85006d/gcc%2Ftestsuite%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2FChangeLog?ref=1094da913be99ab5768f3a37bb955ae60f85006d", "patch": "@@ -1,3 +1,11 @@\n+2007-05-25  Simon Martin  <simartin@users.sourceforge.net>\n+\t    Lee Millward  <lee.millward@gmail.com>\n+\n+\tPR c++/31745\n+\t* g++.dg/parse/crash34.C: New test.\n+\n+\t* g++.dg/parse/crash35.C: New test.\n+\n 2007-05-25  H.J. Lu  <hongjiu.lu@intel.com>\n \n \t* gcc.target/i386/sse2-check.h: New."}, {"sha": "e2517a5e20c91aa885762825c9d419e4f7293743", "filename": "gcc/testsuite/g++.dg/parse/crash34.C", "status": "added", "additions": 6, "deletions": 0, "changes": 6, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/1094da913be99ab5768f3a37bb955ae60f85006d/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Fparse%2Fcrash34.C", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/1094da913be99ab5768f3a37bb955ae60f85006d/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Fparse%2Fcrash34.C", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Fparse%2Fcrash34.C?ref=1094da913be99ab5768f3a37bb955ae60f85006d", "patch": "@@ -0,0 +1,6 @@\n+/* PR c++/31745 */\n+/* { dg-do \"compile\" }  */\n+\n+void foo()\n+{\n+  namespace N { /* { dg-error \"is not allowed|at end of input\" } */"}, {"sha": "a0448af5ed64ddb11f155f55b7a76b651051e7da", "filename": "gcc/testsuite/g++.dg/parse/crash35.C", "status": "added", "additions": 7, "deletions": 0, "changes": 7, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/1094da913be99ab5768f3a37bb955ae60f85006d/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Fparse%2Fcrash35.C", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/1094da913be99ab5768f3a37bb955ae60f85006d/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Fparse%2Fcrash35.C", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Fparse%2Fcrash35.C?ref=1094da913be99ab5768f3a37bb955ae60f85006d", "patch": "@@ -0,0 +1,7 @@\n+/* This used to ICE. */\n+/* { dg-do \"compile\" } */\n+\n+struct a {};\n+\n+class foo : public a, a\n+{ /* { dg-error \"duplicate base type|at end of input\" } */"}]}