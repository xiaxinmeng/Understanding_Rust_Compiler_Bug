{"sha": "416f380b0de93075cdf0e968ad76f1c102db5dd7", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6NDE2ZjM4MGIwZGU5MzA3NWNkZjBlOTY4YWQ3NmYxYzEwMmRiNWRkNw==", "commit": {"author": {"name": "Jakub Jelinek", "email": "jakub@redhat.com", "date": "2010-07-02T20:22:32Z"}, "committer": {"name": "Jakub Jelinek", "email": "jakub@gcc.gnu.org", "date": "2010-07-02T20:22:32Z"}, "message": "re PR c++/44780 (Bogus set-but-not-used variable warning)\n\n\tPR c++/44780\n\t* typeck.c (convert_for_assignment): When converting a convertible\n\tvector type or objc++ types, call mark_rvalue_use.\n\t* typeck2.c (build_m_component_ref): Use return values from\n\tmark_rvalue_use or mark_lvalue_use.\n\t* class.c (build_base_path): Likewise.\n\t* call.c (build_conditional_expr): Likewise.\n\n\t* c-c++-common/Wunused-var-12.c: New test.\n\nFrom-SVN: r161742", "tree": {"sha": "94ec85f85c58f86f21bfcc5897fdfbbd27949fbf", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/94ec85f85c58f86f21bfcc5897fdfbbd27949fbf"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/416f380b0de93075cdf0e968ad76f1c102db5dd7", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/416f380b0de93075cdf0e968ad76f1c102db5dd7", "html_url": "https://github.com/Rust-GCC/gccrs/commit/416f380b0de93075cdf0e968ad76f1c102db5dd7", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/416f380b0de93075cdf0e968ad76f1c102db5dd7/comments", "author": {"login": "jakubjelinek", "id": 9370665, "node_id": "MDQ6VXNlcjkzNzA2NjU=", "avatar_url": "https://avatars.githubusercontent.com/u/9370665?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jakubjelinek", "html_url": "https://github.com/jakubjelinek", "followers_url": "https://api.github.com/users/jakubjelinek/followers", "following_url": "https://api.github.com/users/jakubjelinek/following{/other_user}", "gists_url": "https://api.github.com/users/jakubjelinek/gists{/gist_id}", "starred_url": "https://api.github.com/users/jakubjelinek/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jakubjelinek/subscriptions", "organizations_url": "https://api.github.com/users/jakubjelinek/orgs", "repos_url": "https://api.github.com/users/jakubjelinek/repos", "events_url": "https://api.github.com/users/jakubjelinek/events{/privacy}", "received_events_url": "https://api.github.com/users/jakubjelinek/received_events", "type": "User", "site_admin": false}, "committer": null, "parents": [{"sha": "2dc8bd762e1b69c34ce88b5b4d3672f008d856b8", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/2dc8bd762e1b69c34ce88b5b4d3672f008d856b8", "html_url": "https://github.com/Rust-GCC/gccrs/commit/2dc8bd762e1b69c34ce88b5b4d3672f008d856b8"}], "stats": {"total": 60, "additions": 53, "deletions": 7}, "files": [{"sha": "33aee8a96b0ca4a09386c95d82060907a1a2997f", "filename": "gcc/cp/ChangeLog", "status": "modified", "additions": 10, "deletions": 0, "changes": 10, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/416f380b0de93075cdf0e968ad76f1c102db5dd7/gcc%2Fcp%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/416f380b0de93075cdf0e968ad76f1c102db5dd7/gcc%2Fcp%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fcp%2FChangeLog?ref=416f380b0de93075cdf0e968ad76f1c102db5dd7", "patch": "@@ -1,3 +1,13 @@\n+2010-07-02  Jakub Jelinek  <jakub@redhat.com>\n+\n+\tPR c++/44780\n+\t* typeck.c (convert_for_assignment): When converting a convertible\n+\tvector type or objc++ types, call mark_rvalue_use.\n+\t* typeck2.c (build_m_component_ref): Use return values from\n+\tmark_rvalue_use or mark_lvalue_use.\n+\t* class.c (build_base_path): Likewise.\n+\t* call.c (build_conditional_expr): Likewise.\n+\n 2010-07-02  Paolo Carlini  <paolo.carlini@oracle.com>\n \n \tPR c++/44039"}, {"sha": "c4f3e95e3f49fe93f93708be079c20a63c036ade", "filename": "gcc/cp/call.c", "status": "modified", "additions": 2, "deletions": 2, "changes": 4, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/416f380b0de93075cdf0e968ad76f1c102db5dd7/gcc%2Fcp%2Fcall.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/416f380b0de93075cdf0e968ad76f1c102db5dd7/gcc%2Fcp%2Fcall.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fcp%2Fcall.c?ref=416f380b0de93075cdf0e968ad76f1c102db5dd7", "patch": "@@ -3861,8 +3861,8 @@ build_conditional_expr (tree arg1, tree arg2, tree arg3,\n       && same_type_p (arg2_type, arg3_type))\n     {\n       result_type = arg2_type;\n-      mark_lvalue_use (arg2);\n-      mark_lvalue_use (arg3);\n+      arg2 = mark_lvalue_use (arg2);\n+      arg3 = mark_lvalue_use (arg3);\n       goto valid_operands;\n     }\n "}, {"sha": "3c4830e857e2b9495957ead2f09c9fde9e1a8c8f", "filename": "gcc/cp/class.c", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/416f380b0de93075cdf0e968ad76f1c102db5dd7/gcc%2Fcp%2Fclass.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/416f380b0de93075cdf0e968ad76f1c102db5dd7/gcc%2Fcp%2Fclass.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fcp%2Fclass.c?ref=416f380b0de93075cdf0e968ad76f1c102db5dd7", "patch": "@@ -284,7 +284,7 @@ build_base_path (enum tree_code code,\n     /* This must happen before the call to save_expr.  */\n     expr = cp_build_unary_op (ADDR_EXPR, expr, 0, tf_warning_or_error);\n   else\n-    mark_rvalue_use (expr);\n+    expr = mark_rvalue_use (expr);\n \n   offset = BINFO_OFFSET (binfo);\n   fixed_type_p = resolves_to_fixed_type_p (expr, &nonnull);"}, {"sha": "ec0b06d378bef9aef5d624d1dc7b9aebb90e3989", "filename": "gcc/cp/typeck.c", "status": "modified", "additions": 8, "deletions": 2, "changes": 10, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/416f380b0de93075cdf0e968ad76f1c102db5dd7/gcc%2Fcp%2Ftypeck.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/416f380b0de93075cdf0e968ad76f1c102db5dd7/gcc%2Fcp%2Ftypeck.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fcp%2Ftypeck.c?ref=416f380b0de93075cdf0e968ad76f1c102db5dd7", "patch": "@@ -7211,7 +7211,10 @@ convert_for_assignment (tree type, tree rhs,\n \n   if (TREE_CODE (type) == VECTOR_TYPE && coder == VECTOR_TYPE\n       && vector_types_convertible_p (type, rhstype, true))\n-    return convert (type, rhs);\n+    {\n+      rhs = mark_rvalue_use (rhs);\n+      return convert (type, rhs);\n+    }\n \n   if (rhs == error_mark_node || rhstype == error_mark_node)\n     return error_mark_node;\n@@ -7255,7 +7258,10 @@ convert_for_assignment (tree type, tree rhs,\n \t}\n \n       if (objc_compare_types (type, rhstype, parmno, rname))\n-\treturn convert (type, rhs);\n+\t{\n+\t  rhs = mark_rvalue_use (rhs);\n+\t  return convert (type, rhs);\n+\t}\n     }\n \n   /* [expr.ass]"}, {"sha": "bdc14c7fa0836349c2b9e597e0e82c1163676388", "filename": "gcc/cp/typeck2.c", "status": "modified", "additions": 2, "deletions": 2, "changes": 4, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/416f380b0de93075cdf0e968ad76f1c102db5dd7/gcc%2Fcp%2Ftypeck2.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/416f380b0de93075cdf0e968ad76f1c102db5dd7/gcc%2Fcp%2Ftypeck2.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fcp%2Ftypeck2.c?ref=416f380b0de93075cdf0e968ad76f1c102db5dd7", "patch": "@@ -1478,8 +1478,8 @@ build_m_component_ref (tree datum, tree component)\n   if (error_operand_p (datum) || error_operand_p (component))\n     return error_mark_node;\n \n-  mark_lvalue_use (datum);\n-  mark_rvalue_use (component);\n+  datum = mark_lvalue_use (datum);\n+  component = mark_rvalue_use (component);\n \n   ptrmem_type = TREE_TYPE (component);\n   if (!TYPE_PTR_TO_MEMBER_P (ptrmem_type))"}, {"sha": "09e56fb29e471a86592959cdab6a2feabeb63a8f", "filename": "gcc/testsuite/ChangeLog", "status": "modified", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/416f380b0de93075cdf0e968ad76f1c102db5dd7/gcc%2Ftestsuite%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/416f380b0de93075cdf0e968ad76f1c102db5dd7/gcc%2Ftestsuite%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2FChangeLog?ref=416f380b0de93075cdf0e968ad76f1c102db5dd7", "patch": "@@ -1,3 +1,8 @@\n+2010-07-02  Jakub Jelinek  <jakub@redhat.com>\n+\n+\tPR c++/44780\n+\t* c-c++-common/Wunused-var-12.c: New test.\n+\n 2010-07-02  Bernd Schmidt  <bernds@codesourcery.com>\n \n \tPR target/42835"}, {"sha": "312680a72e85c3e7f00eece5e39fcade5d7e3424", "filename": "gcc/testsuite/c-c++-common/Wunused-var-12.c", "status": "added", "additions": 25, "deletions": 0, "changes": 25, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/416f380b0de93075cdf0e968ad76f1c102db5dd7/gcc%2Ftestsuite%2Fc-c%2B%2B-common%2FWunused-var-12.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/416f380b0de93075cdf0e968ad76f1c102db5dd7/gcc%2Ftestsuite%2Fc-c%2B%2B-common%2FWunused-var-12.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fc-c%2B%2B-common%2FWunused-var-12.c?ref=416f380b0de93075cdf0e968ad76f1c102db5dd7", "patch": "@@ -0,0 +1,25 @@\n+/* PR c++/44780 */\n+/* { dg-do compile } */\n+/* { dg-options \"-Wunused\" } */\n+\n+typedef double vec __attribute__ ((__vector_size__ (16)));\n+vec c, d;\n+\n+void\n+foo (void)\n+{\n+  vec a;\n+  vec b;\n+  a = c;\n+  b = a;\n+  d = b;\n+}\n+\n+void\n+bar (void)\n+{\n+  vec a;\n+  vec b;\t/* { dg-warning \"set but not used\" } */\n+  a = c;\n+  b = a;\n+}"}]}