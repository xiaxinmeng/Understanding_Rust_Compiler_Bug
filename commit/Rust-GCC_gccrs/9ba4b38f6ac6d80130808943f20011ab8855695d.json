{"sha": "9ba4b38f6ac6d80130808943f20011ab8855695d", "node_id": "C_kwDOANBUbNoAKDliYTRiMzhmNmFjNmQ4MDEzMDgwODk0M2YyMDAxMWFiODg1NTY5NWQ", "commit": {"author": {"name": "Doug Rupp", "email": "rupp@adacore.com", "date": "2022-05-06T22:28:49Z"}, "committer": {"name": "Pierre-Marie de Rodat", "email": "derodat@adacore.com", "date": "2022-06-01T08:43:19Z"}, "message": "[Ada] arm-qnx-7.1: unwind goes wrong after regs restore\n\nBump the pc +3 total for Thumb mode, the same calculation that as is\ndone for arm-linux.\n\ngcc/ada/\n\n\t* init.c (__gnat_adjust_context_for_raise) [QNX][__thumb2__]: Bump\n\tthe pc an extra byte.", "tree": {"sha": "d737f765fa8f9b653f74e7158f3e4917ab26b99b", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/d737f765fa8f9b653f74e7158f3e4917ab26b99b"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/9ba4b38f6ac6d80130808943f20011ab8855695d", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/9ba4b38f6ac6d80130808943f20011ab8855695d", "html_url": "https://github.com/Rust-GCC/gccrs/commit/9ba4b38f6ac6d80130808943f20011ab8855695d", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/9ba4b38f6ac6d80130808943f20011ab8855695d/comments", "author": {"login": "Cementitious", "id": 115579865, "node_id": "U_kgDOBuOb2Q", "avatar_url": "https://avatars.githubusercontent.com/u/115579865?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Cementitious", "html_url": "https://github.com/Cementitious", "followers_url": "https://api.github.com/users/Cementitious/followers", "following_url": "https://api.github.com/users/Cementitious/following{/other_user}", "gists_url": "https://api.github.com/users/Cementitious/gists{/gist_id}", "starred_url": "https://api.github.com/users/Cementitious/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Cementitious/subscriptions", "organizations_url": "https://api.github.com/users/Cementitious/orgs", "repos_url": "https://api.github.com/users/Cementitious/repos", "events_url": "https://api.github.com/users/Cementitious/events{/privacy}", "received_events_url": "https://api.github.com/users/Cementitious/received_events", "type": "User", "site_admin": false}, "committer": {"login": "pmderodat", "id": 758452, "node_id": "MDQ6VXNlcjc1ODQ1Mg==", "avatar_url": "https://avatars.githubusercontent.com/u/758452?v=4", "gravatar_id": "", "url": "https://api.github.com/users/pmderodat", "html_url": "https://github.com/pmderodat", "followers_url": "https://api.github.com/users/pmderodat/followers", "following_url": "https://api.github.com/users/pmderodat/following{/other_user}", "gists_url": "https://api.github.com/users/pmderodat/gists{/gist_id}", "starred_url": "https://api.github.com/users/pmderodat/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/pmderodat/subscriptions", "organizations_url": "https://api.github.com/users/pmderodat/orgs", "repos_url": "https://api.github.com/users/pmderodat/repos", "events_url": "https://api.github.com/users/pmderodat/events{/privacy}", "received_events_url": "https://api.github.com/users/pmderodat/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "65818fc9550ffda7724504e38c8d2005f6c4f2ca", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/65818fc9550ffda7724504e38c8d2005f6c4f2ca", "html_url": "https://github.com/Rust-GCC/gccrs/commit/65818fc9550ffda7724504e38c8d2005f6c4f2ca"}], "stats": {"total": 10, "additions": 10, "deletions": 0}, "files": [{"sha": "cfae740d64dc3da8e427fd258a0ba3e892654d97", "filename": "gcc/ada/init.c", "status": "modified", "additions": 10, "deletions": 0, "changes": 10, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/9ba4b38f6ac6d80130808943f20011ab8855695d/gcc%2Fada%2Finit.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/9ba4b38f6ac6d80130808943f20011ab8855695d/gcc%2Fada%2Finit.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fada%2Finit.c?ref=9ba4b38f6ac6d80130808943f20011ab8855695d", "patch": "@@ -2579,7 +2579,17 @@ __gnat_adjust_context_for_raise (int signo ATTRIBUTE_UNUSED,\n   uintptr_t *pc_addr;\n   mcontext_t *mcontext = &((ucontext_t *) sc)->uc_mcontext;\n   pc_addr = (uintptr_t *)&mcontext->cpu.gpr [ARM_REG_PC];\n+\n+  /* ARM Bump has to be an even number because of odd/even architecture.  */\n   *pc_addr += 2;\n+#ifdef __thumb2__\n+  /* For thumb, the return address must have the low order bit set, otherwise\n+     the unwinder will reset to \"arm\" mode upon return.  As long as the\n+     compilation unit containing the landing pad is compiled with the same\n+     mode (arm vs thumb) as the signaling compilation unit, this works.  */\n+  if (mcontext->cpu.spsr & ARM_CPSR_T)\n+    *pc_addr += 1;\n+#endif\n }\n #endif /* ARMEL */\n "}]}