{"sha": "8d1359c77334511c56e62e1ae6b0b65e4003e930", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6OGQxMzU5Yzc3MzM0NTExYzU2ZTYyZTFhZTZiMGI2NWU0MDAzZTkzMA==", "commit": {"author": {"name": "Arnaud Charlet", "email": "charlet@gcc.gnu.org", "date": "2015-01-06T09:53:40Z"}, "committer": {"name": "Arnaud Charlet", "email": "charlet@gcc.gnu.org", "date": "2015-01-06T09:53:40Z"}, "message": "[multiple changes]\n\n2015-01-06  Robert Dewar  <dewar@adacore.com>\n\n\t* s-valint.adb, s-valuns.adb (Value_Integer): Deal with case where\n\tStr'Last = Positive'Last\n\n2015-01-06  Thomas Quinot  <quinot@adacore.com>\n\n\t* xoscons.adb: Display exception information and return non-zero\n\texit status in top level exception handler.\n\nFrom-SVN: r219242", "tree": {"sha": "c97bb16df64b364a5a9589a9fc4a6299e2b90dc9", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/c97bb16df64b364a5a9589a9fc4a6299e2b90dc9"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/8d1359c77334511c56e62e1ae6b0b65e4003e930", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/8d1359c77334511c56e62e1ae6b0b65e4003e930", "html_url": "https://github.com/Rust-GCC/gccrs/commit/8d1359c77334511c56e62e1ae6b0b65e4003e930", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/8d1359c77334511c56e62e1ae6b0b65e4003e930/comments", "author": null, "committer": null, "parents": [{"sha": "fb153d02da077fb18f52372dab68a8cc52ea3a54", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/fb153d02da077fb18f52372dab68a8cc52ea3a54", "html_url": "https://github.com/Rust-GCC/gccrs/commit/fb153d02da077fb18f52372dab68a8cc52ea3a54"}], "stats": {"total": 59, "additions": 47, "deletions": 12}, "files": [{"sha": "784e9c7942820ab7582409412a55c79b6f97c200", "filename": "gcc/ada/ChangeLog", "status": "modified", "additions": 10, "deletions": 0, "changes": 10, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/8d1359c77334511c56e62e1ae6b0b65e4003e930/gcc%2Fada%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/8d1359c77334511c56e62e1ae6b0b65e4003e930/gcc%2Fada%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fada%2FChangeLog?ref=8d1359c77334511c56e62e1ae6b0b65e4003e930", "patch": "@@ -1,3 +1,13 @@\n+2015-01-06  Robert Dewar  <dewar@adacore.com>\n+\n+\t* s-valint.adb, s-valuns.adb (Value_Integer): Deal with case where\n+\tStr'Last = Positive'Last\n+\n+2015-01-06  Thomas Quinot  <quinot@adacore.com>\n+\n+\t* xoscons.adb: Display exception information and return non-zero\n+\texit status in top level exception handler.\n+\n 2015-01-06  Ed Schonberg  <schonberg@adacore.com>\n \n \t* sem_ch8.adb: Code clean up."}, {"sha": "25b9216b18948b6bbe7b25bc891da614e012b8ce", "filename": "gcc/ada/s-valint.adb", "status": "modified", "additions": 24, "deletions": 6, "changes": 30, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/8d1359c77334511c56e62e1ae6b0b65e4003e930/gcc%2Fada%2Fs-valint.adb", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/8d1359c77334511c56e62e1ae6b0b65e4003e930/gcc%2Fada%2Fs-valint.adb", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fada%2Fs-valint.adb?ref=8d1359c77334511c56e62e1ae6b0b65e4003e930", "patch": "@@ -6,7 +6,7 @@\n --                                                                          --\n --                                 B o d y                                  --\n --                                                                          --\n---          Copyright (C) 1992-2012, Free Software Foundation, Inc.         --\n+--          Copyright (C) 1992-2014, Free Software Foundation, Inc.         --\n --                                                                          --\n -- GNAT is free software;  you can  redistribute it  and/or modify it under --\n -- terms of the  GNU General Public License as published  by the Free Soft- --\n@@ -89,12 +89,30 @@ package body System.Val_Int is\n    -------------------\n \n    function Value_Integer (Str : String) return Integer is\n-      V : Integer;\n-      P : aliased Integer := Str'First;\n    begin\n-      V := Scan_Integer (Str, P'Access, Str'Last);\n-      Scan_Trailing_Blanks (Str, P);\n-      return V;\n+      --  We have to special case Str'Last = Positive'Last because the normal\n+      --  circuit ends up setting P to Str'Last + 1 which is out of bounds. We\n+      --  deal with this by converting to a subtype which fixes the bounds.\n+\n+      if Str'Last = Positive'Last then\n+         declare\n+            subtype NT is String (1 .. Str'Length);\n+         begin\n+            return Value_Integer (NT (Str));\n+         end;\n+\n+      --  Normal case where Str'Last < Positive'Last\n+\n+      else\n+         declare\n+            V : Integer;\n+            P : aliased Integer := Str'First;\n+         begin\n+            V := Scan_Integer (Str, P'Access, Str'Length);\n+            Scan_Trailing_Blanks (Str, P);\n+            return V;\n+         end;\n+      end if;\n    end Value_Integer;\n \n end System.Val_Int;"}, {"sha": "062b6d751b337116f6a487598421804268e26765", "filename": "gcc/ada/s-valuns.adb", "status": "modified", "additions": 8, "deletions": 3, "changes": 11, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/8d1359c77334511c56e62e1ae6b0b65e4003e930/gcc%2Fada%2Fs-valuns.adb", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/8d1359c77334511c56e62e1ae6b0b65e4003e930/gcc%2Fada%2Fs-valuns.adb", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fada%2Fs-valuns.adb?ref=8d1359c77334511c56e62e1ae6b0b65e4003e930", "patch": "@@ -289,11 +289,16 @@ package body System.Val_Uns is\n    --------------------\n \n    function Value_Unsigned (Str : String) return Unsigned is\n+      subtype NT is String (1 .. Str'Length);\n+      --  We use this subtype to convert Str for the calls below to deal with\n+      --  the obscure case where Str'Last is Positive'Last. Without these\n+      --  conversions, such a case would raise Constraint_Error.\n+\n       V : Unsigned;\n-      P : aliased Integer := Str'First;\n+      P : aliased Integer := 1;\n    begin\n-      V := Scan_Unsigned (Str, P'Access, Str'Last);\n-      Scan_Trailing_Blanks (Str, P);\n+      V := Scan_Unsigned (NT (Str), P'Access, Str'Length);\n+      Scan_Trailing_Blanks (NT (Str), P);\n       return V;\n    end Value_Unsigned;\n "}, {"sha": "3d5bfab4153fca5d21bf89560fb6ba9720c2e6dd", "filename": "gcc/ada/xoscons.adb", "status": "modified", "additions": 5, "deletions": 3, "changes": 8, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/8d1359c77334511c56e62e1ae6b0b65e4003e930/gcc%2Fada%2Fxoscons.adb", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/8d1359c77334511c56e62e1ae6b0b65e4003e930/gcc%2Fada%2Fxoscons.adb", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fada%2Fxoscons.adb?ref=8d1359c77334511c56e62e1ae6b0b65e4003e930", "patch": "@@ -6,7 +6,7 @@\n --                                                                          --\n --                                 B o d y                                  --\n --                                                                          --\n---          Copyright (C) 2008-2013, Free Software Foundation, Inc.         --\n+--          Copyright (C) 2008-2014, Free Software Foundation, Inc.         --\n --                                                                          --\n -- GNAT is free software;  you can  redistribute it  and/or modify it under --\n -- terms of the  GNU General Public License as published  by the Free Soft- --\n@@ -47,6 +47,7 @@ pragma Warnings (Off);\n with System.Unsigned_Types;   use System.Unsigned_Types;\n pragma Warnings (On);\n \n+with GNAT.OS_Lib;\n with GNAT.String_Split; use GNAT.String_Split;\n with GNAT.Table;\n \n@@ -700,6 +701,7 @@ begin\n    Close (Tmpl_File);\n \n exception\n-   when others =>\n-      Put_Line (\"xoscons <base_name>\");\n+   when E : others =>\n+      Put_Line (\"raised \" & Ada.Exceptions.Exception_Information (E));\n+      GNAT.OS_Lib.OS_Exit (1);\n end XOSCons;"}]}