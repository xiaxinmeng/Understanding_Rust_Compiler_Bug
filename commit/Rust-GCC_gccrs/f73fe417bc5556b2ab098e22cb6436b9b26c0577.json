{"sha": "f73fe417bc5556b2ab098e22cb6436b9b26c0577", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6ZjczZmU0MTdiYzU1NTZiMmFiMDk4ZTIyY2I2NDM2YjliMjZjMDU3Nw==", "commit": {"author": {"name": "Manuel L\u00f3pez-Ib\u00e1\u00f1ez", "email": "manu@gcc.gnu.org", "date": "2007-03-04T23:29:41Z"}, "committer": {"name": "Manuel L\u00f3pez-Ib\u00e1\u00f1ez", "email": "manu@gcc.gnu.org", "date": "2007-03-04T23:29:41Z"}, "message": "re PR other/30465 (Duplicated overflow warning)\n\n2007-03-04  Manuel Lopez-Ibanez  <manu@gcc.gnu.org>\n\n\tPR other/30465\n\t* c-common.c (convert_and_check): Don't give warnings for\n\tconversion if 'expr' already overflowed.\n\ntestsuite/\n\t* gcc.dg/multiple-overflow-warn-3.c: New.\n\t* g++.dg/warn/multiple-overflow-warn-3.C: New.\n\nFrom-SVN: r122534", "tree": {"sha": "b5345e046ddd0c7cfef6c82973f5e694a3fbb99e", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/b5345e046ddd0c7cfef6c82973f5e694a3fbb99e"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/f73fe417bc5556b2ab098e22cb6436b9b26c0577", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/f73fe417bc5556b2ab098e22cb6436b9b26c0577", "html_url": "https://github.com/Rust-GCC/gccrs/commit/f73fe417bc5556b2ab098e22cb6436b9b26c0577", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/f73fe417bc5556b2ab098e22cb6436b9b26c0577/comments", "author": null, "committer": null, "parents": [{"sha": "af13a7a6ec9a50c39948ee5631a47c29c84fc6d1", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/af13a7a6ec9a50c39948ee5631a47c29c84fc6d1", "html_url": "https://github.com/Rust-GCC/gccrs/commit/af13a7a6ec9a50c39948ee5631a47c29c84fc6d1"}], "stats": {"total": 67, "additions": 50, "deletions": 17}, "files": [{"sha": "47b83c869a3530d5cd358bc3e8d55026835f8844", "filename": "gcc/ChangeLog", "status": "modified", "additions": 6, "deletions": 0, "changes": 6, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/f73fe417bc5556b2ab098e22cb6436b9b26c0577/gcc%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/f73fe417bc5556b2ab098e22cb6436b9b26c0577/gcc%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2FChangeLog?ref=f73fe417bc5556b2ab098e22cb6436b9b26c0577", "patch": "@@ -1,3 +1,9 @@\n+2007-03-04  Manuel Lopez-Ibanez  <manu@gcc.gnu.org>\n+\n+\tPR other/30465\n+\t* c-common.c (convert_and_check): Don't give warnings for\n+\tconversion if 'expr' already overflowed.\n+\t\n 2007-03-04  Roger Sayle  <roger@eyesopen.com>\n \n \tPR middle-end/30744"}, {"sha": "523ef464be565f20fbf8dec5f5d745930073effd", "filename": "gcc/c-common.c", "status": "modified", "additions": 14, "deletions": 17, "changes": 31, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/f73fe417bc5556b2ab098e22cb6436b9b26c0577/gcc%2Fc-common.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/f73fe417bc5556b2ab098e22cb6436b9b26c0577/gcc%2Fc-common.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fc-common.c?ref=f73fe417bc5556b2ab098e22cb6436b9b26c0577", "patch": "@@ -1250,10 +1250,9 @@ convert_and_check (tree type, tree expr)\n   \n   result = convert (type, expr);\n \n-  if (skip_evaluation)\n+  if (skip_evaluation || TREE_OVERFLOW_P (expr))\n     return result;\n \n-\n   if (TREE_CODE (expr) == INTEGER_CST\n       && (TREE_CODE (type) == INTEGER_TYPE\n           || TREE_CODE (type) == ENUMERAL_TYPE)\n@@ -1274,21 +1273,19 @@ convert_and_check (tree type, tree expr)\n           else if (warn_conversion)\n             conversion_warning (type, expr);\n         }\n-      else\n-        {\n-          if (!int_fits_type_p (expr, c_common_unsigned_type (type)))\n-            warning (OPT_Woverflow,\n-                     \"overflow in implicit constant conversion\");\n-          /* No warning for converting 0x80000000 to int.  */\n-          else if (pedantic\n-                   && (TREE_CODE (TREE_TYPE (expr)) != INTEGER_TYPE\n-                       || TYPE_PRECISION (TREE_TYPE (expr))\n-                       != TYPE_PRECISION (type)))\n-            warning (OPT_Woverflow,\n-                     \"overflow in implicit constant conversion\");\n-          else if (warn_conversion)\n-            conversion_warning (type, expr);\n-        }\n+      else if (!int_fits_type_p (expr, c_common_unsigned_type (type))) \n+\twarning (OPT_Woverflow,\n+\t\t \"overflow in implicit constant conversion\");\n+      /* No warning for converting 0x80000000 to int.  */\n+      else if (pedantic\n+\t       && (TREE_CODE (TREE_TYPE (expr)) != INTEGER_TYPE\n+\t\t   || TYPE_PRECISION (TREE_TYPE (expr))\n+\t\t   != TYPE_PRECISION (type)))\n+\twarning (OPT_Woverflow,\n+\t\t \"overflow in implicit constant conversion\");\n+\n+      else if (warn_conversion)\n+\tconversion_warning (type, expr);\n     }\n   else if (TREE_CODE (result) == INTEGER_CST && TREE_OVERFLOW (result)) \n     warning (OPT_Woverflow,"}, {"sha": "84c2d21496510c625e5ccf02f0d26db45f79c32c", "filename": "gcc/testsuite/ChangeLog", "status": "modified", "additions": 6, "deletions": 0, "changes": 6, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/f73fe417bc5556b2ab098e22cb6436b9b26c0577/gcc%2Ftestsuite%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/f73fe417bc5556b2ab098e22cb6436b9b26c0577/gcc%2Ftestsuite%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2FChangeLog?ref=f73fe417bc5556b2ab098e22cb6436b9b26c0577", "patch": "@@ -1,3 +1,9 @@\n+2007-03-04  Manuel Lopez-Ibanez  <manu@gcc.gnu.org>\n+\n+\tPR other/30465\n+\t* gcc.dg/multiple-overflow-warn-3.c: New.\n+\t* g++.dg/warn/multiple-overflow-warn-3.C: New.\n+\t\n 2007-03-04  Simon Martin  <simartin@users.sourceforge.net>\n \n \tPR c++/30895"}, {"sha": "491f7af58ca2fba583d8db957ba2fe1cc30b19c4", "filename": "gcc/testsuite/g++.dg/warn/multiple-overflow-warn-3.C", "status": "added", "additions": 12, "deletions": 0, "changes": 12, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/f73fe417bc5556b2ab098e22cb6436b9b26c0577/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Fwarn%2Fmultiple-overflow-warn-3.C", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/f73fe417bc5556b2ab098e22cb6436b9b26c0577/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Fwarn%2Fmultiple-overflow-warn-3.C", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Fwarn%2Fmultiple-overflow-warn-3.C?ref=f73fe417bc5556b2ab098e22cb6436b9b26c0577", "patch": "@@ -0,0 +1,12 @@\n+/* PR 30465 : Test for duplicated warnings in a conversion.  */\n+/* { dg-do compile } */\n+/* { dg-options \"-Woverflow\" } */\n+\n+wchar_t\n+g (void)\n+{\n+  wchar_t wc = ((wchar_t)1 << 31) - 1; /* { dg-bogus \"overflow .* overflow\" } */\n+  /* { dg-warning \"overflow\" \"\" { target *-*-* } 8 } */\n+  return wc;\n+}\n+"}, {"sha": "afb4e517f287d33e793ad771c77857383026399d", "filename": "gcc/testsuite/gcc.dg/multiple-overflow-warn-3.c", "status": "added", "additions": 12, "deletions": 0, "changes": 12, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/f73fe417bc5556b2ab098e22cb6436b9b26c0577/gcc%2Ftestsuite%2Fgcc.dg%2Fmultiple-overflow-warn-3.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/f73fe417bc5556b2ab098e22cb6436b9b26c0577/gcc%2Ftestsuite%2Fgcc.dg%2Fmultiple-overflow-warn-3.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgcc.dg%2Fmultiple-overflow-warn-3.c?ref=f73fe417bc5556b2ab098e22cb6436b9b26c0577", "patch": "@@ -0,0 +1,12 @@\n+/* PR 30465 : Test for duplicated warnings in a conversion.  */\n+/* { dg-do compile } */\n+/* { dg-options \"-Woverflow\" } */\n+\n+short int\n+g (void)\n+{\n+  short int wc = ((short int)1 << 31) - 1; /* { dg-bogus \"overflow .* overflow\" } */\n+  /* { dg-warning \"overflow\" \"\" { target *-*-* } 8 } */\n+  return wc;\n+}\n+"}]}