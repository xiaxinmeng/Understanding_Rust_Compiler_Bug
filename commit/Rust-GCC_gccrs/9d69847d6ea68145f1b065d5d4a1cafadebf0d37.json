{"sha": "9d69847d6ea68145f1b065d5d4a1cafadebf0d37", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6OWQ2OTg0N2Q2ZWE2ODE0NWYxYjA2NWQ1ZDRhMWNhZmFkZWJmMGQzNw==", "commit": {"author": {"name": "Richard Guenther", "email": "rguenther@suse.de", "date": "2011-12-15T14:50:25Z"}, "committer": {"name": "Richard Biener", "email": "rguenth@gcc.gnu.org", "date": "2011-12-15T14:50:25Z"}, "message": "lto-wrapper.c (run_gcc): In non-parallel mode remove ltrans inputs immediately after processing them.\n\n2011-12-15  Richard Guenther  <rguenther@suse.de>\n\n\t* lto-wrapper.c (run_gcc): In non-parallel mode remove\n\tltrans inputs immediately after processing them.  In parallel\n\tmode truncate the ltrans inputs in the make rule that processes\n\tthem if temporary files are not to be preserved.\n\nFrom-SVN: r182370", "tree": {"sha": "6c48720d70dd823a0ad924b247e1e048ec0e16f2", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/6c48720d70dd823a0ad924b247e1e048ec0e16f2"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/9d69847d6ea68145f1b065d5d4a1cafadebf0d37", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/9d69847d6ea68145f1b065d5d4a1cafadebf0d37", "html_url": "https://github.com/Rust-GCC/gccrs/commit/9d69847d6ea68145f1b065d5d4a1cafadebf0d37", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/9d69847d6ea68145f1b065d5d4a1cafadebf0d37/comments", "author": {"login": "rguenth", "id": 2046526, "node_id": "MDQ6VXNlcjIwNDY1MjY=", "avatar_url": "https://avatars.githubusercontent.com/u/2046526?v=4", "gravatar_id": "", "url": "https://api.github.com/users/rguenth", "html_url": "https://github.com/rguenth", "followers_url": "https://api.github.com/users/rguenth/followers", "following_url": "https://api.github.com/users/rguenth/following{/other_user}", "gists_url": "https://api.github.com/users/rguenth/gists{/gist_id}", "starred_url": "https://api.github.com/users/rguenth/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/rguenth/subscriptions", "organizations_url": "https://api.github.com/users/rguenth/orgs", "repos_url": "https://api.github.com/users/rguenth/repos", "events_url": "https://api.github.com/users/rguenth/events{/privacy}", "received_events_url": "https://api.github.com/users/rguenth/received_events", "type": "User", "site_admin": false}, "committer": null, "parents": [{"sha": "7598036b5a94ff138f7ae9a007b385d1b6000afd", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/7598036b5a94ff138f7ae9a007b385d1b6000afd", "html_url": "https://github.com/Rust-GCC/gccrs/commit/7598036b5a94ff138f7ae9a007b385d1b6000afd"}], "stats": {"total": 22, "additions": 20, "deletions": 2}, "files": [{"sha": "9ec882ddc19169192132abb6f088cb90bf8ef1cc", "filename": "gcc/ChangeLog", "status": "modified", "additions": 7, "deletions": 0, "changes": 7, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/9d69847d6ea68145f1b065d5d4a1cafadebf0d37/gcc%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/9d69847d6ea68145f1b065d5d4a1cafadebf0d37/gcc%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2FChangeLog?ref=9d69847d6ea68145f1b065d5d4a1cafadebf0d37", "patch": "@@ -1,3 +1,10 @@\n+2011-12-15  Richard Guenther  <rguenther@suse.de>\n+\n+\t* lto-wrapper.c (run_gcc): In non-parallel mode remove\n+\tltrans inputs immediately after processing them.  In parallel\n+\tmode truncate the ltrans inputs in the make rule that processes\n+\tthem if temporary files are not to be preserved.\n+\n 2011-12-15  Anatoly Sokolov  <aesok@post.ru>\n \n \t* config/arm/arm.h (REGISTER_MOVE_COST, MEMORY_MOVE_COST): Remove."}, {"sha": "1cc7bfb843dd6b99090c078389dada4b429f7abc", "filename": "gcc/lto-wrapper.c", "status": "modified", "additions": 13, "deletions": 2, "changes": 15, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/9d69847d6ea68145f1b065d5d4a1cafadebf0d37/gcc%2Flto-wrapper.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/9d69847d6ea68145f1b065d5d4a1cafadebf0d37/gcc%2Flto-wrapper.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Flto-wrapper.c?ref=9d69847d6ea68145f1b065d5d4a1cafadebf0d37", "patch": "@@ -811,9 +811,19 @@ run_gcc (unsigned argc, char *argv[])\n \t      for (j = 1; new_argv[j] != NULL; ++j)\n \t\tfprintf (mstream, \" '%s'\", new_argv[j]);\n \t      fprintf (mstream, \"\\n\");\n+\t      /* If we are not preserving the ltrans input files then\n+\t         truncate them as soon as we have processed it.  This\n+\t\t reduces temporary disk-space usage.  */\n+\t      if (! debug)\n+\t\tfprintf (mstream, \"\\t@-touch -r %s %s.tem > /dev/null 2>&1 \"\n+\t\t\t \"&& mv %s.tem %s\\n\",\n+\t\t\t input_name, input_name, input_name, input_name); \n \t    }\n \t  else\n-\t    fork_execute (CONST_CAST (char **, new_argv));\n+\t    {\n+\t      fork_execute (CONST_CAST (char **, new_argv));\n+\t      maybe_unlink_file (input_name);\n+\t    }\n \n \t  output_names[i] = output_name;\n \t}\n@@ -851,12 +861,13 @@ run_gcc (unsigned argc, char *argv[])\n \t  collect_wait (new_argv[0], pex);\n \t  maybe_unlink_file (makefile);\n \t  makefile = NULL;\n+\t  for (i = 0; i < nr; ++i)\n+\t    maybe_unlink_file (input_names[i]);\n \t}\n       for (i = 0; i < nr; ++i)\n \t{\n \t  fputs (output_names[i], stdout);\n \t  putc ('\\n', stdout);\n-\t  maybe_unlink_file (input_names[i]);\n \t  free (input_names[i]);\n \t}\n       nr = 0;"}]}