{"sha": "2c52b2884ba10b1c5050fe066bae651680c8ebae", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6MmM1MmIyODg0YmExMGIxYzUwNTBmZTA2NmJhZTY1MTY4MGM4ZWJhZQ==", "commit": {"author": {"name": "Tobias Burnus", "email": "tobias@codesourcery.com", "date": "2020-02-20T17:11:32Z"}, "committer": {"name": "Tobias Burnus", "email": "tobias@codesourcery.com", "date": "2020-02-20T17:11:32Z"}, "message": "OpenACC's tile clause fix for implicit typing (PR93825)\n\n2020-02-20  Tobias Burnus  <tobias@codesourcery.com>\n\n\tPR fortran/93825\n\t* openmp.c (resolve_oacc_loop_blocks): Move call to\n\tresolve_oacc_nested_loops from here ...\n\t(resolve_oacc_loop): ... to here.\n\n\tPR fortran/93825\n\t* gfortran.dg/goacc/tile-3.f90: New.", "tree": {"sha": "4983f8105a363dc94ef9ba03fb531f3c4737ddcd", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/4983f8105a363dc94ef9ba03fb531f3c4737ddcd"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/2c52b2884ba10b1c5050fe066bae651680c8ebae", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/2c52b2884ba10b1c5050fe066bae651680c8ebae", "html_url": "https://github.com/Rust-GCC/gccrs/commit/2c52b2884ba10b1c5050fe066bae651680c8ebae", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/2c52b2884ba10b1c5050fe066bae651680c8ebae/comments", "author": {"login": "tob2", "id": 264461, "node_id": "MDQ6VXNlcjI2NDQ2MQ==", "avatar_url": "https://avatars.githubusercontent.com/u/264461?v=4", "gravatar_id": "", "url": "https://api.github.com/users/tob2", "html_url": "https://github.com/tob2", "followers_url": "https://api.github.com/users/tob2/followers", "following_url": "https://api.github.com/users/tob2/following{/other_user}", "gists_url": "https://api.github.com/users/tob2/gists{/gist_id}", "starred_url": "https://api.github.com/users/tob2/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/tob2/subscriptions", "organizations_url": "https://api.github.com/users/tob2/orgs", "repos_url": "https://api.github.com/users/tob2/repos", "events_url": "https://api.github.com/users/tob2/events{/privacy}", "received_events_url": "https://api.github.com/users/tob2/received_events", "type": "User", "site_admin": false}, "committer": {"login": "tob2", "id": 264461, "node_id": "MDQ6VXNlcjI2NDQ2MQ==", "avatar_url": "https://avatars.githubusercontent.com/u/264461?v=4", "gravatar_id": "", "url": "https://api.github.com/users/tob2", "html_url": "https://github.com/tob2", "followers_url": "https://api.github.com/users/tob2/followers", "following_url": "https://api.github.com/users/tob2/following{/other_user}", "gists_url": "https://api.github.com/users/tob2/gists{/gist_id}", "starred_url": "https://api.github.com/users/tob2/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/tob2/subscriptions", "organizations_url": "https://api.github.com/users/tob2/orgs", "repos_url": "https://api.github.com/users/tob2/repos", "events_url": "https://api.github.com/users/tob2/events{/privacy}", "received_events_url": "https://api.github.com/users/tob2/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "b82d426662469ee8b78ec7e8f74abe950485c9d5", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/b82d426662469ee8b78ec7e8f74abe950485c9d5", "html_url": "https://github.com/Rust-GCC/gccrs/commit/b82d426662469ee8b78ec7e8f74abe950485c9d5"}], "stats": {"total": 58, "additions": 46, "deletions": 12}, "files": [{"sha": "6795b82b74cd6844157977f0ba0cdb106cddaf2f", "filename": "gcc/fortran/ChangeLog", "status": "modified", "additions": 16, "deletions": 9, "changes": 25, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/2c52b2884ba10b1c5050fe066bae651680c8ebae/gcc%2Ffortran%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/2c52b2884ba10b1c5050fe066bae651680c8ebae/gcc%2Ffortran%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ffortran%2FChangeLog?ref=2c52b2884ba10b1c5050fe066bae651680c8ebae", "patch": "@@ -1,3 +1,10 @@\n+2020-02-20  Tobias Burnus  <tobias@codesourcery.com>\n+\n+\tPR fortran/93825\n+\t* openmp.c (resolve_oacc_loop_blocks): Move call to\n+\tresolve_oacc_nested_loops from here ...\n+\t(resolve_oacc_loop): ... to here.\n+\n 2020-02-18  Mark Eggleston  <markeggleston@gcc.gnu.org>\n \n \tPR fortran/93714\n@@ -29,15 +36,15 @@\n \n 2020-02-10  Andrew Benson  <abensonca@gmail.com>\n \n-        PR fortran/83113\n-        * array.c: Do not attempt to set the array spec for a submodule\n-        function symbol (as it has already been set in the corresponding\n-        module procedure interface).\n-        * symbol.c: Do not reject duplicate POINTER, ALLOCATABLE, or\n-        DIMENSION attributes in declarations of a submodule function.\n-        * gfortran.h: Add a macro that tests for a module procedure in a\n-        submodule.\n-        * gfortran.dg/pr83113.f90: New test.\n+\tPR fortran/83113\n+\t* array.c: Do not attempt to set the array spec for a submodule\n+\tfunction symbol (as it has already been set in the corresponding\n+\tmodule procedure interface).\n+\t* symbol.c: Do not reject duplicate POINTER, ALLOCATABLE, or\n+\tDIMENSION attributes in declarations of a submodule function.\n+\t* gfortran.h: Add a macro that tests for a module procedure in a\n+\tsubmodule.\n+\t* gfortran.dg/pr83113.f90: New test.\n \n 2020-02-03  Julian Brown  <julian@codesourcery.com>\n \t    Tobias Burnus  <tobias@codesourcery.com>"}, {"sha": "35f6b2f4938bd96a26cf5de5d68b3c1436aea8fd", "filename": "gcc/fortran/openmp.c", "status": "modified", "additions": 12, "deletions": 3, "changes": 15, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/2c52b2884ba10b1c5050fe066bae651680c8ebae/gcc%2Ffortran%2Fopenmp.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/2c52b2884ba10b1c5050fe066bae651680c8ebae/gcc%2Ffortran%2Fopenmp.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ffortran%2Fopenmp.c?ref=2c52b2884ba10b1c5050fe066bae651680c8ebae", "patch": "@@ -6192,10 +6192,8 @@ resolve_oacc_loop_blocks (gfc_code *code)\n   if (code->ext.omp_clauses->tile_list)\n     {\n       gfc_expr_list *el;\n-      int num = 0;\n       for (el = code->ext.omp_clauses->tile_list; el; el = el->next)\n \t{\n-\t  num++;\n \t  if (el->expr == NULL)\n \t    {\n \t      /* NULL expressions are used to represent '*' arguments.\n@@ -6213,7 +6211,6 @@ resolve_oacc_loop_blocks (gfc_code *code)\n \t\t\t   &code->loc);\n \t    }\n \t}\n-      resolve_oacc_nested_loops (code, code->block->next, num, \"tiled\");\n     }\n }\n \n@@ -6266,6 +6263,18 @@ resolve_oacc_loop (gfc_code *code)\n   do_code = code->block->next;\n   collapse = code->ext.omp_clauses->collapse;\n \n+  /* Both collapsed and tiled loops are lowered the same way, but are not\n+     compatible.  In gfc_trans_omp_do, the tile is prioritized.  */\n+  if (code->ext.omp_clauses->tile_list)\n+    {\n+      int num = 0;\n+      gfc_expr_list *el;\n+      for (el = code->ext.omp_clauses->tile_list; el; el = el->next)\n+\t++num;\n+      resolve_oacc_nested_loops (code, code->block->next, num, \"tiled\");\n+      return;\n+    }\n+\n   if (collapse <= 0)\n     collapse = 1;\n   resolve_oacc_nested_loops (code, do_code, collapse, \"collapsed\");"}, {"sha": "89acd3f518f1505da54d9b144c556419462535b1", "filename": "gcc/testsuite/ChangeLog", "status": "modified", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/2c52b2884ba10b1c5050fe066bae651680c8ebae/gcc%2Ftestsuite%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/2c52b2884ba10b1c5050fe066bae651680c8ebae/gcc%2Ftestsuite%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2FChangeLog?ref=2c52b2884ba10b1c5050fe066bae651680c8ebae", "patch": "@@ -1,3 +1,8 @@\n+2020-02-20  Tobias Burnus  <tobias@codesourcery.com>\n+\n+\tPR fortran/93825\n+\t* gfortran.dg/goacc/tile-3.f90: New.\n+\n 2020-02-19  Marek Polacek  <polacek@redhat.com>\n \n \tPR c++/93169 - wrong-code with a non-constexpr constructor."}, {"sha": "00b4f1df2d8e92194f8f92ef82632a0c06932b00", "filename": "gcc/testsuite/gfortran.dg/goacc/tile-3.f90", "status": "added", "additions": 13, "deletions": 0, "changes": 13, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/2c52b2884ba10b1c5050fe066bae651680c8ebae/gcc%2Ftestsuite%2Fgfortran.dg%2Fgoacc%2Ftile-3.f90", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/2c52b2884ba10b1c5050fe066bae651680c8ebae/gcc%2Ftestsuite%2Fgfortran.dg%2Fgoacc%2Ftile-3.f90", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgfortran.dg%2Fgoacc%2Ftile-3.f90?ref=2c52b2884ba10b1c5050fe066bae651680c8ebae", "patch": "@@ -0,0 +1,13 @@\n+! { dg-do compile }\n+!\n+! PR fortran/93825\n+!\n+! Check that implicit typing works\n+\n+program p\n+   !$acc parallel loop tile(2,2)\n+   do i = 1, 8\n+      do j = 1, 8\n+      end do\n+   end do\n+end"}]}