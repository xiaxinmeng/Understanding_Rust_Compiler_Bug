{"sha": "b8fedf996be60ac2de2dcd0dbe39e9f258cf0c8e", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6YjhmZWRmOTk2YmU2MGFjMmRlMmRjZDBkYmUzOWU5ZjI1OGNmMGM4ZQ==", "commit": {"author": {"name": "Andreas Krebbel", "email": "krebbel@linux.vnet.ibm.com", "date": "2015-07-24T11:29:50Z"}, "committer": {"name": "Andreas Krebbel", "email": "krebbel@gcc.gnu.org", "date": "2015-07-24T11:29:50Z"}, "message": "S/390: Fix cfi for GPR 2 FPR saves\n\ngcc/ChangeLog:\n\n2015-07-24  Andreas Krebbel  <krebbel@linux.vnet.ibm.com>\n\n\t    * config/s390/s390.c (s390_save_gprs_to_fprs): Add CFA_REGISTER\n\t    reg note to the GPR -> FPR save instructions.\n\ngcc/testsuite/ChangeLog:\n\n2015-07-24  Andreas Krebbel  <krebbel@linux.vnet.ibm.com>\n\n\t    * gcc.target/s390/gpr2fprsavecfi.c: New test.\n\nFrom-SVN: r226149", "tree": {"sha": "4728ead18e2dd89bc3e6776b36773433d129a5e5", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/4728ead18e2dd89bc3e6776b36773433d129a5e5"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/b8fedf996be60ac2de2dcd0dbe39e9f258cf0c8e", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/b8fedf996be60ac2de2dcd0dbe39e9f258cf0c8e", "html_url": "https://github.com/Rust-GCC/gccrs/commit/b8fedf996be60ac2de2dcd0dbe39e9f258cf0c8e", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/b8fedf996be60ac2de2dcd0dbe39e9f258cf0c8e/comments", "author": null, "committer": null, "parents": [{"sha": "3d44ff9919d50db3a67bee88235bbdb9735ba34b", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/3d44ff9919d50db3a67bee88235bbdb9735ba34b", "html_url": "https://github.com/Rust-GCC/gccrs/commit/3d44ff9919d50db3a67bee88235bbdb9735ba34b"}], "stats": {"total": 36, "additions": 36, "deletions": 0}, "files": [{"sha": "b613180edaf6251893b738b1b8c67489e3edfb6a", "filename": "gcc/ChangeLog", "status": "modified", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/b8fedf996be60ac2de2dcd0dbe39e9f258cf0c8e/gcc%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/b8fedf996be60ac2de2dcd0dbe39e9f258cf0c8e/gcc%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2FChangeLog?ref=b8fedf996be60ac2de2dcd0dbe39e9f258cf0c8e", "patch": "@@ -1,3 +1,8 @@\n+2015-07-24  Andreas Krebbel  <krebbel@linux.vnet.ibm.com>\n+\n+\t* config/s390/s390.c (s390_save_gprs_to_fprs): Add CFA_REGISTER\n+\treg note to the GPR -> FPR save instructions.\n+\n 2015-07-24  Andreas Krebbel  <krebbel@linux.vnet.ibm.com>\n \n \t* config/s390/s390.c (s390_rtx_costs): Make risbg patterns"}, {"sha": "7f609baba7b3d7bfb9b4525cd55b2d720aad0695", "filename": "gcc/config/s390/s390.c", "status": "modified", "additions": 4, "deletions": 0, "changes": 4, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/b8fedf996be60ac2de2dcd0dbe39e9f258cf0c8e/gcc%2Fconfig%2Fs390%2Fs390.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/b8fedf996be60ac2de2dcd0dbe39e9f258cf0c8e/gcc%2Fconfig%2Fs390%2Fs390.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fconfig%2Fs390%2Fs390.c?ref=b8fedf996be60ac2de2dcd0dbe39e9f258cf0c8e", "patch": "@@ -10132,6 +10132,10 @@ s390_save_gprs_to_fprs (void)\n \t    emit_move_insn (gen_rtx_REG (DImode, cfun_gpr_save_slot (i)),\n \t\t\t    gen_rtx_REG (DImode, i));\n \t  RTX_FRAME_RELATED_P (insn) = 1;\n+\t  /* This prevents dwarf2cfi from interpreting the set.  Doing\n+\t     so it might emit def_cfa_register infos setting an FPR as\n+\t     new CFA.  */\n+\t  add_reg_note (insn, REG_CFA_REGISTER, PATTERN (insn));\n \t}\n     }\n }"}, {"sha": "72955da88ee6d8f92eff8f258f3edcecef42a66c", "filename": "gcc/testsuite/ChangeLog", "status": "modified", "additions": 4, "deletions": 0, "changes": 4, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/b8fedf996be60ac2de2dcd0dbe39e9f258cf0c8e/gcc%2Ftestsuite%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/b8fedf996be60ac2de2dcd0dbe39e9f258cf0c8e/gcc%2Ftestsuite%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2FChangeLog?ref=b8fedf996be60ac2de2dcd0dbe39e9f258cf0c8e", "patch": "@@ -1,3 +1,7 @@\n+2015-07-24  Andreas Krebbel  <krebbel@linux.vnet.ibm.com>\n+\n+\t* gcc.target/s390/gpr2fprsavecfi.c: New test.\n+\n 2015-07-24  Andreas Krebbel  <krebbel@linux.vnet.ibm.com>\n \n \t* gcc.target/s390/insv-1.c: New test."}, {"sha": "92a0d3ae29a36e8b41efa0584bfc12e7220b1f8e", "filename": "gcc/testsuite/gcc.target/s390/gpr2fprsavecfi.c", "status": "added", "additions": 23, "deletions": 0, "changes": 23, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/b8fedf996be60ac2de2dcd0dbe39e9f258cf0c8e/gcc%2Ftestsuite%2Fgcc.target%2Fs390%2Fgpr2fprsavecfi.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/b8fedf996be60ac2de2dcd0dbe39e9f258cf0c8e/gcc%2Ftestsuite%2Fgcc.target%2Fs390%2Fgpr2fprsavecfi.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgcc.target%2Fs390%2Fgpr2fprsavecfi.c?ref=b8fedf996be60ac2de2dcd0dbe39e9f258cf0c8e", "patch": "@@ -0,0 +1,23 @@\n+/* { dg-do compile } */\n+/* { dg-options \"-O3 -march=z10 -mzarch -fdwarf2-cfi-asm\" } */\n+\n+char *gl[100];\n+\n+long\n+foo ()\n+{\n+  long r = 0;\n+  char bla[100];\n+  int i;\n+\n+  __builtin_memcpy (bla, gl, 100);\n+\n+  for (i = 0; i < 100; i++)\n+    r += bla[i];\n+\n+  return r;\n+}\n+\n+/* { dg-final { scan-assembler-not \"cfi_def_cfa_register\" } } */\n+/* { dg-final { scan-assembler \"cfi_register\" } } */\n+/* { dg-final { scan-assembler \"cfi_def_cfa_offset\" } } */"}]}