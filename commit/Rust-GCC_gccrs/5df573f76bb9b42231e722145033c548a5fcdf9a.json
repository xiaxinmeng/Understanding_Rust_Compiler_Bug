{"sha": "5df573f76bb9b42231e722145033c548a5fcdf9a", "node_id": "C_kwDOANBUbNoAKDVkZjU3M2Y3NmJiOWI0MjIzMWU3MjIxNDUwMzNjNTQ4YTVmY2RmOWE", "commit": {"author": {"name": "Jakub Jelinek", "email": "jakub@redhat.com", "date": "2023-02-06T08:05:56Z"}, "committer": {"name": "Jakub Jelinek", "email": "jakub@redhat.com", "date": "2023-02-06T08:05:56Z"}, "message": "ubsan: Fix up another spot that should have been BUILT_IN_UNREACHABLE_TRAPS [PR108655]\n\nWe ICE on the following testcase, because ivcanon calls\ngimple_build_builtin_unreachable but doesn't expect it would need vops.\nBUILT_IN_UNREACHABLE_TRAP I've introduced yesterday doesn't need\nvops and should be used in that case instead of BUILT_IN_TRAP which\nneeds them.\n\n2023-02-06  Jakub Jelinek  <jakub@redhat.com>\n\n\tPR tree-optimization/108655\n\t* ubsan.cc (sanitize_unreachable_fn): For -funreachable-traps\n\tor -fsanitize=unreachable -fsanitize-trap=unreachable return\n\tBUILT_IN_UNREACHABLE_TRAP decl rather than BUILT_IN_TRAP.\n\n\t* gcc.dg/pr108655.c: New test.", "tree": {"sha": "f44c66b7d240ed18118d4390b7ad444fc59503f7", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/f44c66b7d240ed18118d4390b7ad444fc59503f7"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/5df573f76bb9b42231e722145033c548a5fcdf9a", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/5df573f76bb9b42231e722145033c548a5fcdf9a", "html_url": "https://github.com/Rust-GCC/gccrs/commit/5df573f76bb9b42231e722145033c548a5fcdf9a", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/5df573f76bb9b42231e722145033c548a5fcdf9a/comments", "author": {"login": "jakubjelinek", "id": 9370665, "node_id": "MDQ6VXNlcjkzNzA2NjU=", "avatar_url": "https://avatars.githubusercontent.com/u/9370665?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jakubjelinek", "html_url": "https://github.com/jakubjelinek", "followers_url": "https://api.github.com/users/jakubjelinek/followers", "following_url": "https://api.github.com/users/jakubjelinek/following{/other_user}", "gists_url": "https://api.github.com/users/jakubjelinek/gists{/gist_id}", "starred_url": "https://api.github.com/users/jakubjelinek/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jakubjelinek/subscriptions", "organizations_url": "https://api.github.com/users/jakubjelinek/orgs", "repos_url": "https://api.github.com/users/jakubjelinek/repos", "events_url": "https://api.github.com/users/jakubjelinek/events{/privacy}", "received_events_url": "https://api.github.com/users/jakubjelinek/received_events", "type": "User", "site_admin": false}, "committer": {"login": "jakubjelinek", "id": 9370665, "node_id": "MDQ6VXNlcjkzNzA2NjU=", "avatar_url": "https://avatars.githubusercontent.com/u/9370665?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jakubjelinek", "html_url": "https://github.com/jakubjelinek", "followers_url": "https://api.github.com/users/jakubjelinek/followers", "following_url": "https://api.github.com/users/jakubjelinek/following{/other_user}", "gists_url": "https://api.github.com/users/jakubjelinek/gists{/gist_id}", "starred_url": "https://api.github.com/users/jakubjelinek/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jakubjelinek/subscriptions", "organizations_url": "https://api.github.com/users/jakubjelinek/orgs", "repos_url": "https://api.github.com/users/jakubjelinek/repos", "events_url": "https://api.github.com/users/jakubjelinek/events{/privacy}", "received_events_url": "https://api.github.com/users/jakubjelinek/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "31924665c86d47af6b1f22a74f594f2e1dc0ed2d", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/31924665c86d47af6b1f22a74f594f2e1dc0ed2d", "html_url": "https://github.com/Rust-GCC/gccrs/commit/31924665c86d47af6b1f22a74f594f2e1dc0ed2d"}], "stats": {"total": 17, "additions": 16, "deletions": 1}, "files": [{"sha": "f407616976e0a44960cfdd84f241a76d8faaf221", "filename": "gcc/testsuite/gcc.dg/pr108655.c", "status": "added", "additions": 15, "deletions": 0, "changes": 15, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/5df573f76bb9b42231e722145033c548a5fcdf9a/gcc%2Ftestsuite%2Fgcc.dg%2Fpr108655.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/5df573f76bb9b42231e722145033c548a5fcdf9a/gcc%2Ftestsuite%2Fgcc.dg%2Fpr108655.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgcc.dg%2Fpr108655.c?ref=5df573f76bb9b42231e722145033c548a5fcdf9a", "patch": "@@ -0,0 +1,15 @@\n+/* PR tree-optimization/108655 */\n+/* { dg-do compile } */\n+/* { dg-options \"-w -O1 -funreachable-traps\" } */\n+\n+void\n+foo (void)\n+{\n+  int i, j;\n+  for (; i;)\n+    ;\n+  for (; i < 6;)\n+    for (j = 0; j < 6; ++j)\n+      i += j;\n+  __builtin_trap ();\n+}"}, {"sha": "c2f2e75b300a54cfb7ded8f9abe6fe6b5d900b99", "filename": "gcc/ubsan.cc", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/5df573f76bb9b42231e722145033c548a5fcdf9a/gcc%2Fubsan.cc", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/5df573f76bb9b42231e722145033c548a5fcdf9a/gcc%2Fubsan.cc", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fubsan.cc?ref=5df573f76bb9b42231e722145033c548a5fcdf9a", "patch": "@@ -649,7 +649,7 @@ sanitize_unreachable_fn (tree *data, location_t loc)\n       ? (flag_sanitize_trap & SANITIZE_UNREACHABLE)\n       : flag_unreachable_traps)\n     {\n-      fn = builtin_decl_explicit (BUILT_IN_TRAP);\n+      fn = builtin_decl_explicit (BUILT_IN_UNREACHABLE_TRAP);\n       *data = NULL_TREE;\n     }\n   else if (san)"}]}