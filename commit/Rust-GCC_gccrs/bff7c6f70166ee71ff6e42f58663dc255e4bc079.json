{"sha": "bff7c6f70166ee71ff6e42f58663dc255e4bc079", "node_id": "C_kwDOANBUbNoAKGJmZjdjNmY3MDE2NmVlNzFmZjZlNDJmNTg2NjNkYzI1NWU0YmMwNzk", "commit": {"author": {"name": "Richard Biener", "email": "rguenther@suse.de", "date": "2023-03-27T12:30:47Z"}, "committer": {"name": "Richard Biener", "email": "rguenther@suse.de", "date": "2023-03-27T12:32:07Z"}, "message": "tree-optimization/54498 - testcase for the bug\n\nI realized I never added a testcase for the fix of this bug.  Now done\nafter verifying it still fails when reverting the fix.\n\n\tPR tree-optimization/54498\n\t* g++.dg/torture/pr54498.C: New testcase.", "tree": {"sha": "103375491771825a52d456c5319bed5b385b49a4", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/103375491771825a52d456c5319bed5b385b49a4"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/bff7c6f70166ee71ff6e42f58663dc255e4bc079", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/bff7c6f70166ee71ff6e42f58663dc255e4bc079", "html_url": "https://github.com/Rust-GCC/gccrs/commit/bff7c6f70166ee71ff6e42f58663dc255e4bc079", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/bff7c6f70166ee71ff6e42f58663dc255e4bc079/comments", "author": {"login": "rguenth", "id": 2046526, "node_id": "MDQ6VXNlcjIwNDY1MjY=", "avatar_url": "https://avatars.githubusercontent.com/u/2046526?v=4", "gravatar_id": "", "url": "https://api.github.com/users/rguenth", "html_url": "https://github.com/rguenth", "followers_url": "https://api.github.com/users/rguenth/followers", "following_url": "https://api.github.com/users/rguenth/following{/other_user}", "gists_url": "https://api.github.com/users/rguenth/gists{/gist_id}", "starred_url": "https://api.github.com/users/rguenth/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/rguenth/subscriptions", "organizations_url": "https://api.github.com/users/rguenth/orgs", "repos_url": "https://api.github.com/users/rguenth/repos", "events_url": "https://api.github.com/users/rguenth/events{/privacy}", "received_events_url": "https://api.github.com/users/rguenth/received_events", "type": "User", "site_admin": false}, "committer": {"login": "rguenth", "id": 2046526, "node_id": "MDQ6VXNlcjIwNDY1MjY=", "avatar_url": "https://avatars.githubusercontent.com/u/2046526?v=4", "gravatar_id": "", "url": "https://api.github.com/users/rguenth", "html_url": "https://github.com/rguenth", "followers_url": "https://api.github.com/users/rguenth/followers", "following_url": "https://api.github.com/users/rguenth/following{/other_user}", "gists_url": "https://api.github.com/users/rguenth/gists{/gist_id}", "starred_url": "https://api.github.com/users/rguenth/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/rguenth/subscriptions", "organizations_url": "https://api.github.com/users/rguenth/orgs", "repos_url": "https://api.github.com/users/rguenth/repos", "events_url": "https://api.github.com/users/rguenth/events{/privacy}", "received_events_url": "https://api.github.com/users/rguenth/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "ce4a00e29c71f2f51d52f407ecd265fa40688586", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/ce4a00e29c71f2f51d52f407ecd265fa40688586", "html_url": "https://github.com/Rust-GCC/gccrs/commit/ce4a00e29c71f2f51d52f407ecd265fa40688586"}], "stats": {"total": 57, "additions": 57, "deletions": 0}, "files": [{"sha": "74651f9063a896b78f5720c876172e5048632d7a", "filename": "gcc/testsuite/g++.dg/torture/pr54498.C", "status": "added", "additions": 57, "deletions": 0, "changes": 57, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/bff7c6f70166ee71ff6e42f58663dc255e4bc079/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Ftorture%2Fpr54498.C", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/bff7c6f70166ee71ff6e42f58663dc255e4bc079/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Ftorture%2Fpr54498.C", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Ftorture%2Fpr54498.C?ref=bff7c6f70166ee71ff6e42f58663dc255e4bc079", "patch": "@@ -0,0 +1,57 @@\n+// { dg-do run }\n+// { dg-additional-options \"-fno-tree-sra\" }\n+\n+#include <complex>\n+\n+using namespace std;\n+\n+class bar_src {\n+ public:\n+  bar_src() : next(0) {}\n+  virtual ~bar_src() { delete next; }\n+\n+  bar_src *next;\n+};\n+\n+class foo_src : public bar_src {\n+ public:\n+  foo_src(double f, double fwidth, double s = 5.0);\n+  virtual ~foo_src() {}\n+\n+ private:\n+  double freq, width, peak_time, cutoff;\n+};\n+\n+\n+foo_src::foo_src(double f, double fwidth, double s) {\n+  freq = f; width = 1/fwidth; cutoff = s*width; peak_time = cutoff;\n+}\n+\n+complex<double> do_ft2(int i) __attribute__ ((noinline));\n+\n+complex<double> do_ft2(int i) {\n+  return i == 0 ? complex<double>(-491.697,887.05) : complex<double>(-491.692,887.026);\n+}\n+\n+void foo(void) {\n+  complex<double> prev_ft = 0.0, ft = 0.0;\n+  for (int i=0; i < 2; i++) {\n+    prev_ft = ft;\n+    {\n+      foo_src src(1.0, 1.0 / 20);\n+      ft = do_ft2(i);\n+    }\n+    if (i > 0)\n+      {\n+        double a = abs(ft - prev_ft);\n+        if (a < 0.024 || a > 0.025)\n+          __builtin_abort ();\n+      }\n+  }\n+}\n+\n+int main()\n+{\n+  foo();\n+  return 0;\n+}"}]}