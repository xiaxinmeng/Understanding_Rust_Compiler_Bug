{"sha": "6c072e217f59a92136af99839ff7cab9065a4fa0", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6NmMwNzJlMjE3ZjU5YTkyMTM2YWY5OTgzOWZmN2NhYjkwNjVhNGZhMA==", "commit": {"author": {"name": "Nathan Sidwell", "email": "nathan@acm.org", "date": "2018-05-03T19:26:38Z"}, "committer": {"name": "Nathan Sidwell", "email": "nathan@gcc.gnu.org", "date": "2018-05-03T19:26:38Z"}, "message": "[C++ Patch] Kill -ffriend-injection\n\nhttps://gcc.gnu.org/ml/gcc-patches/2018-05/msg00175.html\n\n\t* doc/extend.texi (Deprecated Features): Remove\n\t-ffriend-injection.\n\t(Backwards Compatibility): Likewise.\n\t* doc/invoke.texi (C++ Language Options): Likewise.\n\t(C++ Dialect Options): Likewise.\n\n\tc-family/\n\t* c.opt (ffriend-injection): Remove functionality, issue warning.\n\n\tcp/\n\t* decl.c (cxx_init_decl_processing): Remove flag_friend_injection.\n\t* name-lookup.c (do_pushdecl): Likewise.\n\n\ttestsuite/\n\tRemove -ffriend-injection.\n\t* g++.old-deja/g++.jason/scoping15.C: Delete.\n\t* g++.old-deja/g++.mike/net43.C: Delete.\n\nFrom-SVN: r259904", "tree": {"sha": "c1a46ca2286357bf1cd6337b1fd1a6c1d41c0f4e", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/c1a46ca2286357bf1cd6337b1fd1a6c1d41c0f4e"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/6c072e217f59a92136af99839ff7cab9065a4fa0", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/6c072e217f59a92136af99839ff7cab9065a4fa0", "html_url": "https://github.com/Rust-GCC/gccrs/commit/6c072e217f59a92136af99839ff7cab9065a4fa0", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/6c072e217f59a92136af99839ff7cab9065a4fa0/comments", "author": {"login": "urnathan", "id": 13103001, "node_id": "MDQ6VXNlcjEzMTAzMDAx", "avatar_url": "https://avatars.githubusercontent.com/u/13103001?v=4", "gravatar_id": "", "url": "https://api.github.com/users/urnathan", "html_url": "https://github.com/urnathan", "followers_url": "https://api.github.com/users/urnathan/followers", "following_url": "https://api.github.com/users/urnathan/following{/other_user}", "gists_url": "https://api.github.com/users/urnathan/gists{/gist_id}", "starred_url": "https://api.github.com/users/urnathan/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/urnathan/subscriptions", "organizations_url": "https://api.github.com/users/urnathan/orgs", "repos_url": "https://api.github.com/users/urnathan/repos", "events_url": "https://api.github.com/users/urnathan/events{/privacy}", "received_events_url": "https://api.github.com/users/urnathan/received_events", "type": "User", "site_admin": false}, "committer": null, "parents": [{"sha": "503ac4e037217724c3c8d5468fb757ec398e8077", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/503ac4e037217724c3c8d5468fb757ec398e8077", "html_url": "https://github.com/Rust-GCC/gccrs/commit/503ac4e037217724c3c8d5468fb757ec398e8077"}], "stats": {"total": 98, "additions": 27, "deletions": 71}, "files": [{"sha": "df60e1faeae93d54461693081364bb79b3dd23ce", "filename": "gcc/ChangeLog", "status": "modified", "additions": 8, "deletions": 0, "changes": 8, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/6c072e217f59a92136af99839ff7cab9065a4fa0/gcc%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/6c072e217f59a92136af99839ff7cab9065a4fa0/gcc%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2FChangeLog?ref=6c072e217f59a92136af99839ff7cab9065a4fa0", "patch": "@@ -1,3 +1,11 @@\n+2018-05-03  Nathan Sidwell  <nathan@acm.org>\n+\n+\t* doc/extend.texi (Deprecated Features): Remove\n+\t-ffriend-injection.\n+\t(Backwards Compatibility): Likewise.\n+\t* doc/invoke.texi (C++ Language Options): Likewise.\n+\t(C++ Dialect Options): Likewise.\n+\n 2018-05-03  Jakub Jelinek  <jakub@redhat.com>\n \n \tPR target/85530"}, {"sha": "56391e512a5fe00da9291c2d40acf3de1887f8dd", "filename": "gcc/c-family/ChangeLog", "status": "modified", "additions": 4, "deletions": 0, "changes": 4, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/6c072e217f59a92136af99839ff7cab9065a4fa0/gcc%2Fc-family%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/6c072e217f59a92136af99839ff7cab9065a4fa0/gcc%2Fc-family%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fc-family%2FChangeLog?ref=6c072e217f59a92136af99839ff7cab9065a4fa0", "patch": "@@ -1,3 +1,7 @@\n+2018-05-03  Nathan Sidwell  <nathan@acm.org>\n+\n+\t* c.opt (ffriend-injection): Remove functionality, issue warning.\n+\n 2018-05-01  David Malcolm  <dmalcolm@redhat.com>\n \n \tPR c/84258"}, {"sha": "5013501b2323dd42a6aaf56b7e4f80b490532803", "filename": "gcc/c-family/c.opt", "status": "modified", "additions": 1, "deletions": 2, "changes": 3, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/6c072e217f59a92136af99839ff7cab9065a4fa0/gcc%2Fc-family%2Fc.opt", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/6c072e217f59a92136af99839ff7cab9065a4fa0/gcc%2Fc-family%2Fc.opt", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fc-family%2Fc.opt?ref=6c072e217f59a92136af99839ff7cab9065a4fa0", "patch": "@@ -1494,8 +1494,7 @@ C++ ObjC++ Var(flag_new_inheriting_ctors) Init(1)\n Implement C++17 inheriting constructor semantics.\n \n ffriend-injection\n-C++ ObjC++ Var(flag_friend_injection)\n-Inject friend functions into enclosing namespace.\n+C++ ObjC++ Ignore Warn(switch %qs is no longer supported)\n \n fkeep-inline-dllexport\n C C++ ObjC ObjC++ Var(flag_keep_inline_dllexport) Init(1) Report Condition(TARGET_DLLIMPORT_DECL_ATTRIBUTES)"}, {"sha": "25cb43a1a7731d6383a73698c5f6ca281ba0bb78", "filename": "gcc/cp/ChangeLog", "status": "modified", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/6c072e217f59a92136af99839ff7cab9065a4fa0/gcc%2Fcp%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/6c072e217f59a92136af99839ff7cab9065a4fa0/gcc%2Fcp%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fcp%2FChangeLog?ref=6c072e217f59a92136af99839ff7cab9065a4fa0", "patch": "@@ -1,3 +1,8 @@\n+2018-05-03  Nathan Sidwell  <nathan@acm.org>\n+\n+\t* decl.c (cxx_init_decl_processing): Remove flag_friend_injection.\n+\t* name-lookup.c (do_pushdecl): Likewise.\n+\n 2018-05-02  Paolo Carlini  <paolo.carlini@oracle.com>\n \t    Jason Merrill  <jason@redhat.com>\n "}, {"sha": "5e671814d8a2a290d2ab45cdc39ac3ef9f2f69c7", "filename": "gcc/cp/decl.c", "status": "modified", "additions": 0, "deletions": 3, "changes": 3, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/6c072e217f59a92136af99839ff7cab9065a4fa0/gcc%2Fcp%2Fdecl.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/6c072e217f59a92136af99839ff7cab9065a4fa0/gcc%2Fcp%2Fdecl.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fcp%2Fdecl.c?ref=6c072e217f59a92136af99839ff7cab9065a4fa0", "patch": "@@ -4175,9 +4175,6 @@ cxx_init_decl_processing (void)\n   if (!flag_new_for_scope)\n     warning_at (UNKNOWN_LOCATION, OPT_Wdeprecated,\n \t\t\"%<-fno-for-scope%> is deprecated\");\n-  if (flag_friend_injection)\n-    warning_at (UNKNOWN_LOCATION, OPT_Wdeprecated,\n-\t\t\"%<-ffriend-injection%> is deprecated\");\n \n   c_common_nodes_and_builtins ();\n "}, {"sha": "9710addcf69ac6c4a11df573580ddad05d1fae74", "filename": "gcc/cp/name-lookup.c", "status": "modified", "additions": 2, "deletions": 9, "changes": 11, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/6c072e217f59a92136af99839ff7cab9065a4fa0/gcc%2Fcp%2Fname-lookup.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/6c072e217f59a92136af99839ff7cab9065a4fa0/gcc%2Fcp%2Fname-lookup.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fcp%2Fname-lookup.c?ref=6c072e217f59a92136af99839ff7cab9065a4fa0", "patch": "@@ -3055,7 +3055,6 @@ do_pushdecl (tree decl, bool is_friend)\n \told = OVL_CHAIN (old);\n \n       check_template_shadow (decl);\n-      bool visible_injection = false;\n \n       if (DECL_DECLARES_FUNCTION_P (decl))\n \t{\n@@ -3073,11 +3072,8 @@ do_pushdecl (tree decl, bool is_friend)\n \t\t  /* Don't attempt to push it.  */\n \t\t  return error_mark_node;\n \t\t}\n-\t      if (!flag_friend_injection)\n-\t\t/* Hide it from ordinary lookup.  */\n-\t\tDECL_ANTICIPATED (decl) = DECL_HIDDEN_FRIEND_P (decl) = true;\n-\t      else\n-\t\tvisible_injection = true;\n+\t      /* Hide it from ordinary lookup.  */\n+\t      DECL_ANTICIPATED (decl) = DECL_HIDDEN_FRIEND_P (decl) = true;\n \t    }\n \t}\n \n@@ -3129,9 +3125,6 @@ do_pushdecl (tree decl, bool is_friend)\n \t}\n       else if (VAR_P (decl))\n \tmaybe_register_incomplete_var (decl);\n-      else if (visible_injection)\n-\twarning (0, \"injected friend %qD is visible\"\n-\t\t\" due to %<-ffriend-injection%>\", decl);\n \n       if ((VAR_P (decl) || TREE_CODE (decl) == FUNCTION_DECL)\n \t  && DECL_EXTERN_C_P (decl))"}, {"sha": "253aea18b030d9afc35ebd88536e4c3fd53957f4", "filename": "gcc/doc/extend.texi", "status": "modified", "additions": 1, "deletions": 7, "changes": 8, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/6c072e217f59a92136af99839ff7cab9065a4fa0/gcc%2Fdoc%2Fextend.texi", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/6c072e217f59a92136af99839ff7cab9065a4fa0/gcc%2Fdoc%2Fextend.texi", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fdoc%2Fextend.texi?ref=6c072e217f59a92136af99839ff7cab9065a4fa0", "patch": "@@ -23846,8 +23846,7 @@ that are now deprecated or have been removed:\n @table @code\n \n @item -fno-for-scope\n-@itemx -ffriend-injection\n-These two options provide compatibility with pre-standard C++.\n+This option provides compatibility with pre-standard C++.\n @xref{Backwards Compatibility}.\n \n @end table\n@@ -23907,11 +23906,6 @@ The behavior is deprecated, only available with @option{-std=c++98}\n @option{-fpermissive} option to enable it.  The behavior will be\n removed.\n \n-@item Friend Injection\n-The @option{-ffriend-injection} option makes injected friends visible\n-to regular name lookup, unlike standard C++.  This option is\n-deprecated and will be removed.\n-\n @item Implicit C language\n Old C system header files did not contain an @code{extern \"C\" @{@dots{}@}}\n scope to set the language.  On such systems, all header files are"}, {"sha": "3de372f28b8b5513bafe336e4ab41a61a3020f89", "filename": "gcc/doc/invoke.texi", "status": "modified", "additions": 0, "deletions": 13, "changes": 13, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/6c072e217f59a92136af99839ff7cab9065a4fa0/gcc%2Fdoc%2Finvoke.texi", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/6c072e217f59a92136af99839ff7cab9065a4fa0/gcc%2Fdoc%2Finvoke.texi", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fdoc%2Finvoke.texi?ref=6c072e217f59a92136af99839ff7cab9065a4fa0", "patch": "@@ -193,7 +193,6 @@ in the following sections.\n @gccoptlist{-fabi-version=@var{n}  -fno-access-control @gol\n -faligned-new=@var{n}  -fargs-in-order=@var{n}  -fcheck-new @gol\n -fconstexpr-depth=@var{n}  -fconstexpr-loop-limit=@var{n} @gol\n--ffriend-injection @gol\n -fno-elide-constructors @gol\n -fno-enforce-eh-specs @gol\n -ffor-scope  -fno-for-scope  -fno-gnu-keywords @gol\n@@ -2448,18 +2447,6 @@ originally proposed semantics for the C++11 standard, but was not part\n of the final standard, so it is disabled by default.  This option is\n deprecated, and may be removed in a future version of G++.\n \n-@item -ffriend-injection\n-@opindex ffriend-injection\n-Inject friend functions into the enclosing namespace, so that they are\n-visible outside the scope of the class in which they are declared.\n-Friend functions were documented to work this way in the old Annotated\n-C++ Reference Manual.  \n-However, in ISO C++ a friend function that is not declared\n-in an enclosing scope can only be found using argument dependent\n-lookup.  GCC defaults to the standard behavior.\n-\n-This option is deprecated and will be removed.\n-\n @item -fno-elide-constructors\n @opindex fno-elide-constructors\n The C++ standard allows an implementation to omit creating a temporary"}, {"sha": "3ea876067e955c386282e107012c87c9a11e8c79", "filename": "gcc/testsuite/ChangeLog", "status": "modified", "additions": 6, "deletions": 0, "changes": 6, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/6c072e217f59a92136af99839ff7cab9065a4fa0/gcc%2Ftestsuite%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/6c072e217f59a92136af99839ff7cab9065a4fa0/gcc%2Ftestsuite%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2FChangeLog?ref=6c072e217f59a92136af99839ff7cab9065a4fa0", "patch": "@@ -1,3 +1,9 @@\n+2018-05-03  Nathan Sidwell  <nathan@acm.org>\n+\n+\tRemove -ffriend-injection.\n+\t* g++.old-deja/g++.jason/scoping15.C: Delete.\n+\t* g++.old-deja/g++.mike/net43.C: Delete.\n+\n 2018-05-03  Jakub Jelinek  <jakub@redhat.com>\n \n \tPR target/85530"}, {"sha": "c677b0d36d3eec6eab4d727847fdb1543250c393", "filename": "gcc/testsuite/g++.old-deja/g++.jason/scoping15.C", "status": "removed", "additions": 0, "deletions": 25, "changes": 25, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/503ac4e037217724c3c8d5468fb757ec398e8077/gcc%2Ftestsuite%2Fg%2B%2B.old-deja%2Fg%2B%2B.jason%2Fscoping15.C", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/503ac4e037217724c3c8d5468fb757ec398e8077/gcc%2Ftestsuite%2Fg%2B%2B.old-deja%2Fg%2B%2B.jason%2Fscoping15.C", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fg%2B%2B.old-deja%2Fg%2B%2B.jason%2Fscoping15.C?ref=503ac4e037217724c3c8d5468fb757ec398e8077", "patch": "@@ -1,25 +0,0 @@\n-// { dg-do assemble  }\n-// { dg-options \"-ffriend-injection\" }\n-// Bug: g++ ignores the :: qualification and dies trying to treat an integer\n-// variable as a list of functions.\n-\n-class DComplex;\n-double imag (const DComplex&);\n-\n-class DComplex {\n-public:\n-  friend  double   imag(const DComplex& a); // Not injected, no warning\n-};\n-\n-class FComplex {\n-public:\n-  friend  float    imag(const FComplex& a); // { dg-warning \"is visible\" }\n-};\n-\n-void\n-scnrm2(FComplex cx[])\n-{\n-  int imag;\n-  ::imag( cx[0] );\n-}\n-// { dg-warning \"ffriend-injection.* is deprecated\" \"cc1plus:\" { target *-*-* } 0 }"}, {"sha": "de266de4a8768cd85021cf2a4503bde5722f96b6", "filename": "gcc/testsuite/g++.old-deja/g++.mike/net43.C", "status": "removed", "additions": 0, "deletions": 12, "changes": 12, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/503ac4e037217724c3c8d5468fb757ec398e8077/gcc%2Ftestsuite%2Fg%2B%2B.old-deja%2Fg%2B%2B.mike%2Fnet43.C", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/503ac4e037217724c3c8d5468fb757ec398e8077/gcc%2Ftestsuite%2Fg%2B%2B.old-deja%2Fg%2B%2B.mike%2Fnet43.C", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fg%2B%2B.old-deja%2Fg%2B%2B.mike%2Fnet43.C?ref=503ac4e037217724c3c8d5468fb757ec398e8077", "patch": "@@ -1,12 +0,0 @@\n-// { dg-do assemble  }\n-// { dg-options \"-ffriend-injection -Wno-deprecated\" }\n-\n-class foo {\n- public:\n-  friend int operator ^(const foo&, const foo&); // { dg-message \"is visible\" }\n-};\n-\n-int main ()\n-{\n-   int (*funptr) (const foo &, const foo &)  = operator ^;\n-}"}]}