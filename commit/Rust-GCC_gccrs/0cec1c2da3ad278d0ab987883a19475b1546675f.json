{"sha": "0cec1c2da3ad278d0ab987883a19475b1546675f", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6MGNlYzFjMmRhM2FkMjc4ZDBhYjk4Nzg4M2ExOTQ3NWIxNTQ2Njc1Zg==", "commit": {"author": {"name": "Eric Botcazou", "email": "ebotcazou@adacore.com", "date": "2015-10-02T09:28:56Z"}, "committer": {"name": "Eric Botcazou", "email": "ebotcazou@gcc.gnu.org", "date": "2015-10-02T09:28:56Z"}, "message": "trans.c (Pragma_to_gnu): Replace linear search with call to find_opt and issue warnings if...\n\n\t* gcc-interface/trans.c (Pragma_to_gnu) <Pragma_Warnings>: Replace\n\tlinear search with call to find_opt and issue warnings if the -W\n\tswitch is not appropriate.\n\nFrom-SVN: r228379", "tree": {"sha": "6dc50d08224fdb4cf18ae702a432094a90f9915b", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/6dc50d08224fdb4cf18ae702a432094a90f9915b"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/0cec1c2da3ad278d0ab987883a19475b1546675f", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/0cec1c2da3ad278d0ab987883a19475b1546675f", "html_url": "https://github.com/Rust-GCC/gccrs/commit/0cec1c2da3ad278d0ab987883a19475b1546675f", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/0cec1c2da3ad278d0ab987883a19475b1546675f/comments", "author": null, "committer": null, "parents": [{"sha": "e0512e8dc4145e32dbf235f693104af68ba9f1c8", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/e0512e8dc4145e32dbf235f693104af68ba9f1c8", "html_url": "https://github.com/Rust-GCC/gccrs/commit/e0512e8dc4145e32dbf235f693104af68ba9f1c8"}], "stats": {"total": 46, "additions": 37, "deletions": 9}, "files": [{"sha": "a4b159ddd020619e6caa8a95ba8e2f8f9d41addf", "filename": "gcc/ada/ChangeLog", "status": "modified", "additions": 6, "deletions": 0, "changes": 6, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/0cec1c2da3ad278d0ab987883a19475b1546675f/gcc%2Fada%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/0cec1c2da3ad278d0ab987883a19475b1546675f/gcc%2Fada%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fada%2FChangeLog?ref=0cec1c2da3ad278d0ab987883a19475b1546675f", "patch": "@@ -1,3 +1,9 @@\n+2015-10-02  Eric Botcazou  <ebotcazou@adacore.com>\n+\n+\t* gcc-interface/trans.c (Pragma_to_gnu) <Pragma_Warnings>: Replace\n+\tlinear search with call to find_opt and issue warnings if the -W\n+\tswitch is not appropriate.\n+\n 2015-10-02  Eric Botcazou  <ebotcazou@adacore.com>\n \n \t* gcc-interface/ada-tree.h (DECL_RESTRICTED_ALIASING_P): New flag."}, {"sha": "3252ea2732e7c4dc345fe29df0c1053c778c2b8f", "filename": "gcc/ada/gcc-interface/trans.c", "status": "modified", "additions": 16, "deletions": 9, "changes": 25, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/0cec1c2da3ad278d0ab987883a19475b1546675f/gcc%2Fada%2Fgcc-interface%2Ftrans.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/0cec1c2da3ad278d0ab987883a19475b1546675f/gcc%2Fada%2Fgcc-interface%2Ftrans.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fada%2Fgcc-interface%2Ftrans.c?ref=0cec1c2da3ad278d0ab987883a19475b1546675f", "patch": "@@ -1442,21 +1442,28 @@ Pragma_to_gnu (Node_Id gnat_node)\n \t  gcc_unreachable ();\n \n \t/* This is the same implementation as in the C family of compilers.  */\n+\tconst unsigned int lang_mask = CL_Ada | CL_COMMON;\n \tif (Present (gnat_expr))\n \t  {\n \t    tree gnu_expr = gnat_to_gnu (gnat_expr);\n-\t    const char *opt_string = TREE_STRING_POINTER (gnu_expr);\n+\t    const char *option_string = TREE_STRING_POINTER (gnu_expr);\n \t    const int len = TREE_STRING_LENGTH (gnu_expr);\n-\t    if (len < 3 || opt_string[0] != '-' || opt_string[1] != 'W')\n+\t    if (len < 3 || option_string[0] != '-' || option_string[1] != 'W')\n \t      break;\n-\t    for (option_index = 0;\n-\t\t option_index < cl_options_count;\n-\t\t option_index++)\n-\t      if (strcmp (cl_options[option_index].opt_text, opt_string) == 0)\n+\t    option_index = find_opt (option_string + 1, lang_mask);\n+\t    if (option_index == OPT_SPECIAL_unknown)\n+\t      {\n+\t\tpost_error (\"?unknown -W switch\", gnat_node);\n \t\tbreak;\n-\t    if (option_index == cl_options_count)\n+\t      }\n+\t    else if (!(cl_options[option_index].flags & CL_WARNING))\n+\t      {\n+\t\tpost_error (\"?-W switch does not control warning\", gnat_node);\n+\t\tbreak;\n+\t      }\n+\t    else if (!(cl_options[option_index].flags & lang_mask))\n \t      {\n-\t\tpost_error (\"unknown -W switch\", gnat_node);\n+\t\tpost_error (\"?-W switch not valid for Ada\", gnat_node);\n \t\tbreak;\n \t      }\n \t  }\n@@ -1465,7 +1472,7 @@ Pragma_to_gnu (Node_Id gnat_node)\n \n \tset_default_handlers (&handlers);\n \tcontrol_warning_option (option_index, (int) kind, imply, location,\n-\t\t\t\tCL_Ada, &handlers, &global_options,\n+\t\t\t\tlang_mask, &handlers, &global_options,\n \t\t\t\t&global_options_set, global_dc);\n       }\n       break;"}, {"sha": "169c0c4e218b117632dd62d45420d5ee96167119", "filename": "gcc/testsuite/ChangeLog", "status": "modified", "additions": 4, "deletions": 0, "changes": 4, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/0cec1c2da3ad278d0ab987883a19475b1546675f/gcc%2Ftestsuite%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/0cec1c2da3ad278d0ab987883a19475b1546675f/gcc%2Ftestsuite%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2FChangeLog?ref=0cec1c2da3ad278d0ab987883a19475b1546675f", "patch": "@@ -1,3 +1,7 @@\n+2015-10-02  Eric Botcazou  <ebotcazou@adacore.com>\n+\n+\t* gnat.dg/warn13.adb: New test.\n+\n 2015-10-02  Eric Botcazou  <ebotcazou@adacore.com>\n \n \t* gnat.dg/vect15.ad[sb]: New test."}, {"sha": "2a9c4e392ccf891ae6e12e06dedda0d834437294", "filename": "gcc/testsuite/gnat.dg/warn13.adb", "status": "added", "additions": 11, "deletions": 0, "changes": 11, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/0cec1c2da3ad278d0ab987883a19475b1546675f/gcc%2Ftestsuite%2Fgnat.dg%2Fwarn13.adb", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/0cec1c2da3ad278d0ab987883a19475b1546675f/gcc%2Ftestsuite%2Fgnat.dg%2Fwarn13.adb", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgnat.dg%2Fwarn13.adb?ref=0cec1c2da3ad278d0ab987883a19475b1546675f", "patch": "@@ -0,0 +1,11 @@\n+-- { dg-compile }\n+\n+procedure Warn13 is\n+\n+  pragma Warnings (\"-Wbogus\");  -- { dg-warning \"unknown\" }\n+  pragma Warnings (\"-Werror\");  -- { dg-warning \"does not control warning\" }\n+  pragma Warnings (\"-Wformat\"); -- { dg-warning \"switch not valid for Ada\" }\n+\n+begin\n+  null;\n+end;"}]}