{"sha": "fd1e840d81c4d581d118ef1890e682fb90a4a72b", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6ZmQxZTg0MGQ4MWM0ZDU4MWQxMThlZjE4OTBlNjgyZmI5MGE0YTcyYg==", "commit": {"author": {"name": "Paul Thomas", "email": "pault@gcc.gnu.org", "date": "2009-08-05T16:10:19Z"}, "committer": {"name": "Paul Thomas", "email": "pault@gcc.gnu.org", "date": "2009-08-05T16:10:19Z"}, "message": "re PR fortran/40847 (segfault & bogus warning)\n\n2009-08-05  Paul Thomas  <pault@gcc.gnu.org>\n\n\tPR fortran/40847\n\t* iresolve.c (gfc_resolve_transfer): Correct error in 'mold'\n\tcharacter length for case where length expresson is NULL.\n\n2009-08-05  Paul Thomas  <pault@gcc.gnu.org>\n\n\tPR fortran/40847\n\t* gfortran.dg/transfer_resolve_1.f90 : New test.\n\nFrom-SVN: r150493", "tree": {"sha": "c665e2426f5c2db1de2f984e9fe9682991a6da62", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/c665e2426f5c2db1de2f984e9fe9682991a6da62"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/fd1e840d81c4d581d118ef1890e682fb90a4a72b", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/fd1e840d81c4d581d118ef1890e682fb90a4a72b", "html_url": "https://github.com/Rust-GCC/gccrs/commit/fd1e840d81c4d581d118ef1890e682fb90a4a72b", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/fd1e840d81c4d581d118ef1890e682fb90a4a72b/comments", "author": null, "committer": null, "parents": [{"sha": "ec52288b33d1928b62fd5ef9ae576d1cf8b51774", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/ec52288b33d1928b62fd5ef9ae576d1cf8b51774", "html_url": "https://github.com/Rust-GCC/gccrs/commit/ec52288b33d1928b62fd5ef9ae576d1cf8b51774"}], "stats": {"total": 48, "additions": 45, "deletions": 3}, "files": [{"sha": "72b6b85e22410eb938ab6820714efbd98ee3d42c", "filename": "gcc/fortran/ChangeLog", "status": "modified", "additions": 6, "deletions": 0, "changes": 6, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/fd1e840d81c4d581d118ef1890e682fb90a4a72b/gcc%2Ffortran%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/fd1e840d81c4d581d118ef1890e682fb90a4a72b/gcc%2Ffortran%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ffortran%2FChangeLog?ref=fd1e840d81c4d581d118ef1890e682fb90a4a72b", "patch": "@@ -1,3 +1,9 @@\n+2009-08-05  Paul Thomas  <pault@gcc.gnu.org>\n+\n+\tPR fortran/40847\n+\t* iresolve.c (gfc_resolve_transfer): Correct error in 'mold'\n+\tcharacter length for case where length expresson is NULL.\n+\n 2009-08-04  Tobias Burnus  <burnus@net-b.de>\n \n \tPR fortran/40949"}, {"sha": "5bb24a42a21446b1d882236c5938f15ff0da39ee", "filename": "gcc/fortran/iresolve.c", "status": "modified", "additions": 13, "deletions": 3, "changes": 16, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/fd1e840d81c4d581d118ef1890e682fb90a4a72b/gcc%2Ffortran%2Firesolve.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/fd1e840d81c4d581d118ef1890e682fb90a4a72b/gcc%2Ffortran%2Firesolve.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ffortran%2Firesolve.c?ref=fd1e840d81c4d581d118ef1890e682fb90a4a72b", "patch": "@@ -2340,9 +2340,19 @@ gfc_resolve_transfer (gfc_expr *f, gfc_expr *source ATTRIBUTE_UNUSED,\n   /* TODO: Make this do something meaningful.  */\n   static char transfer0[] = \"__transfer0\", transfer1[] = \"__transfer1\";\n \n-  if (mold->ts.type == BT_CHARACTER && !mold->ts.cl->length\n-\t&& !(mold->expr_type == EXPR_VARIABLE && mold->symtree->n.sym->attr.dummy))\n-    mold->ts.cl->length = gfc_int_expr (mold->value.character.length);\n+  if (mold->ts.type == BT_CHARACTER\n+\t&& !mold->ts.cl->length\n+\t&& gfc_is_constant_expr (mold))\n+    {\n+      int len;\n+      if (mold->expr_type == EXPR_CONSTANT)\n+\tmold->ts.cl->length = gfc_int_expr (mold->value.character.length);\n+      else\n+\t{\n+\t  len = mold->value.constructor->expr->value.character.length;\n+\t  mold->ts.cl->length = gfc_int_expr (len);\n+\t}\n+    }\n \n   f->ts = mold->ts;\n "}, {"sha": "5bbd2f8d3f890c6b9d16f043e3b1b61c1373b23c", "filename": "gcc/testsuite/ChangeLog", "status": "modified", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/fd1e840d81c4d581d118ef1890e682fb90a4a72b/gcc%2Ftestsuite%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/fd1e840d81c4d581d118ef1890e682fb90a4a72b/gcc%2Ftestsuite%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2FChangeLog?ref=fd1e840d81c4d581d118ef1890e682fb90a4a72b", "patch": "@@ -1,3 +1,8 @@\n+2009-08-05  Paul Thomas  <pault@gcc.gnu.org>\n+\n+\tPR fortran/40847\n+\t* gfortran.dg/transfer_resolve_1.f90 : New test.\n+\n 2009-08-05  Uros Bizjak  <ubizjak@gmail.com>\n \t    Mikulas Patocka  <mikulas@artax.karlin.mff.cuni.cz>\n "}, {"sha": "8d326a186a4401b66459178323d95d4edb08d368", "filename": "gcc/testsuite/gfortran.dg/transfer_resolve_1.f90", "status": "added", "additions": 21, "deletions": 0, "changes": 21, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/fd1e840d81c4d581d118ef1890e682fb90a4a72b/gcc%2Ftestsuite%2Fgfortran.dg%2Ftransfer_resolve_1.f90", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/fd1e840d81c4d581d118ef1890e682fb90a4a72b/gcc%2Ftestsuite%2Fgfortran.dg%2Ftransfer_resolve_1.f90", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgfortran.dg%2Ftransfer_resolve_1.f90?ref=fd1e840d81c4d581d118ef1890e682fb90a4a72b", "patch": "@@ -0,0 +1,21 @@\n+! { dg-do run }\n+! PR40847 - an error in gfc_resolve_transfer caused the character length\n+! of 'mold' to be set incorrectly.\n+!\n+! Contributed by Joost VandeVondele <jv244@cam.ac.uk>\n+!\n+program test_elemental\n+\n+if (any (transfer_size((/0.,0./),(/'a','b'/)) .ne. [4 ,4])) call abort\n+\n+contains\n+\n+   elemental function transfer_size (source, mold)\n+     real, intent(in)         :: source\n+     character(*), intent(in) :: mold\n+     integer                  :: transfer_size\n+     transfer_size = SIZE(TRANSFER(source, (/mold/)))\n+     return\n+   end function transfer_size\n+\n+end program test_elemental"}]}