{"sha": "38d346765a731bd88dcda419cc2a247485f49507", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6MzhkMzQ2NzY1YTczMWJkODhkY2RhNDE5Y2MyYTI0NzQ4NWY0OTUwNw==", "commit": {"author": {"name": "Tom Tromey", "email": "tromey@redhat.com", "date": "2007-11-06T15:57:02Z"}, "committer": {"name": "Tom Tromey", "email": "tromey@gcc.gnu.org", "date": "2007-11-06T15:57:02Z"}, "message": "PR c++/32256, PR c++/32368:\n\ngcc\n\tPR c++/32256, PR c++/32368:\n\t* function.c (saved_in_system_header): New global.\n\t(push_cfun): Save in_system_header.\n\t(pop_cfun): Restore in_system_header.\n\t(push_struct_function): Save in_system_header.\ngcc/testsuite\n\tPR c++/32368:\n\t* g++.dg/warn/pragma-system_header3.h: New.\n\t* g++.dg/warn/pragma-system_header3.C: New.\n\n\tPR c++/32256:\n\t* g++.dg/warn/pragma-system_header4.C: New.\n\t* g++.dg/warn/pragma-system_header4.h: New.\n\nFrom-SVN: r129936", "tree": {"sha": "16730e771eacc9991f800037794eaf32f3a28735", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/16730e771eacc9991f800037794eaf32f3a28735"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/38d346765a731bd88dcda419cc2a247485f49507", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/38d346765a731bd88dcda419cc2a247485f49507", "html_url": "https://github.com/Rust-GCC/gccrs/commit/38d346765a731bd88dcda419cc2a247485f49507", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/38d346765a731bd88dcda419cc2a247485f49507/comments", "author": null, "committer": null, "parents": [{"sha": "9ae165a0722366ba1ee877d1099d147a506d0135", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/9ae165a0722366ba1ee877d1099d147a506d0135", "html_url": "https://github.com/Rust-GCC/gccrs/commit/9ae165a0722366ba1ee877d1099d147a506d0135"}], "stats": {"total": 61, "additions": 60, "deletions": 1}, "files": [{"sha": "0025efaa506201a26b99145c386212e50712734b", "filename": "gcc/ChangeLog", "status": "modified", "additions": 8, "deletions": 0, "changes": 8, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/38d346765a731bd88dcda419cc2a247485f49507/gcc%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/38d346765a731bd88dcda419cc2a247485f49507/gcc%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2FChangeLog?ref=38d346765a731bd88dcda419cc2a247485f49507", "patch": "@@ -1,3 +1,11 @@\n+2007-11-06  Tom Tromey  <tromey@redhat.com>\n+\n+\tPR c++/32256, PR c++/32368:\n+\t* function.c (saved_in_system_header): New global.\n+\t(push_cfun): Save in_system_header.\n+\t(pop_cfun): Restore in_system_header.\n+\t(push_struct_function): Save in_system_header.\n+\n 2007-11-06  Douglas Gregor  <doug.gregor@gmail.com>\n \n \tPR c++/33977"}, {"sha": "56abe4d80621b57a34db9dae0142b442c082d3e8", "filename": "gcc/function.c", "status": "modified", "additions": 18, "deletions": 1, "changes": 19, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/38d346765a731bd88dcda419cc2a247485f49507/gcc%2Ffunction.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/38d346765a731bd88dcda419cc2a247485f49507/gcc%2Ffunction.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ffunction.c?ref=38d346765a731bd88dcda419cc2a247485f49507", "patch": "@@ -3834,12 +3834,22 @@ DEF_VEC_ALLOC_P(function_p,heap);\n \n static VEC(function_p,heap) *cfun_stack;\n \n+/* We save the value of in_system_header here when pushing the first\n+   function on the cfun stack, and we restore it from here when\n+   popping the last function.  */\n+\n+static bool saved_in_system_header;\n+\n /* Push the current cfun onto the stack, and set cfun to new_cfun.  */\n \n void\n push_cfun (struct function *new_cfun)\n {\n+  if (cfun == NULL)\n+    saved_in_system_header = in_system_header;\n   VEC_safe_push (function_p, heap, cfun_stack, cfun);\n+  if (new_cfun)\n+    in_system_header = DECL_IN_SYSTEM_HEADER (new_cfun->decl);\n   set_cfun (new_cfun);\n }\n \n@@ -3848,7 +3858,10 @@ push_cfun (struct function *new_cfun)\n void\n pop_cfun (void)\n {\n-  set_cfun (VEC_pop (function_p, cfun_stack));\n+  struct function *new_cfun = VEC_pop (function_p, cfun_stack);\n+  in_system_header = ((new_cfun == NULL) ? saved_in_system_header\n+\t\t      : DECL_IN_SYSTEM_HEADER (new_cfun->decl));\n+  set_cfun (new_cfun);\n }\n \n /* Return value of funcdef and increase it.  */\n@@ -3922,7 +3935,11 @@ allocate_struct_function (tree fndecl)\n void\n push_struct_function (tree fndecl)\n {\n+  if (cfun == NULL)\n+    saved_in_system_header = in_system_header;\n   VEC_safe_push (function_p, heap, cfun_stack, cfun);\n+  if (fndecl)\n+    in_system_header = DECL_IN_SYSTEM_HEADER (fndecl);\n   allocate_struct_function (fndecl);\n }\n "}, {"sha": "405068cd2ade49b939e863c0ae04e4044cab70b3", "filename": "gcc/testsuite/ChangeLog", "status": "modified", "additions": 10, "deletions": 0, "changes": 10, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/38d346765a731bd88dcda419cc2a247485f49507/gcc%2Ftestsuite%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/38d346765a731bd88dcda419cc2a247485f49507/gcc%2Ftestsuite%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2FChangeLog?ref=38d346765a731bd88dcda419cc2a247485f49507", "patch": "@@ -1,3 +1,13 @@\n+2007-11-06  Tom Tromey  <tromey@redhat.com>\n+\n+\tPR c++/32368:\n+\t* g++.dg/warn/pragma-system_header3.h: New.\n+\t* g++.dg/warn/pragma-system_header3.C: New.\n+\n+\tPR c++/32256:\n+\t* g++.dg/warn/pragma-system_header4.C: New.\n+\t* g++.dg/warn/pragma-system_header4.h: New.\n+\n 2007-11-06  Douglas Gregor  <doug.gregor@gmail.com>\n \n \tPR c++/33977"}, {"sha": "a9255c9c1c1215c1e4ae7fd3d1196cf89d83a5ba", "filename": "gcc/testsuite/g++.dg/warn/pragma-system_header3.C", "status": "added", "additions": 9, "deletions": 0, "changes": 9, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/38d346765a731bd88dcda419cc2a247485f49507/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Fwarn%2Fpragma-system_header3.C", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/38d346765a731bd88dcda419cc2a247485f49507/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Fwarn%2Fpragma-system_header3.C", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Fwarn%2Fpragma-system_header3.C?ref=38d346765a731bd88dcda419cc2a247485f49507", "patch": "@@ -0,0 +1,9 @@\n+// PR c++/32368\n+// { dg-options \"-Wall -O\" }\n+\n+#include \"pragma-system_header3.h\"\n+\n+int main()\n+{\n+\treturn f();\n+}"}, {"sha": "e16f38f8aad4f4ac14bedd2279fea00c1f261731", "filename": "gcc/testsuite/g++.dg/warn/pragma-system_header3.h", "status": "added", "additions": 7, "deletions": 0, "changes": 7, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/38d346765a731bd88dcda419cc2a247485f49507/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Fwarn%2Fpragma-system_header3.h", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/38d346765a731bd88dcda419cc2a247485f49507/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Fwarn%2Fpragma-system_header3.h", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Fwarn%2Fpragma-system_header3.h?ref=38d346765a731bd88dcda419cc2a247485f49507", "patch": "@@ -0,0 +1,7 @@\n+#pragma GCC system_header\n+\n+static inline int f()\n+{\n+\tint i;\n+\treturn i;\n+}"}, {"sha": "898e10801cace6f93b5595687bb46dd92fcd03f2", "filename": "gcc/testsuite/g++.dg/warn/pragma-system_header4.C", "status": "added", "additions": 6, "deletions": 0, "changes": 6, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/38d346765a731bd88dcda419cc2a247485f49507/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Fwarn%2Fpragma-system_header4.C", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/38d346765a731bd88dcda419cc2a247485f49507/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Fwarn%2Fpragma-system_header4.C", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Fwarn%2Fpragma-system_header4.C?ref=38d346765a731bd88dcda419cc2a247485f49507", "patch": "@@ -0,0 +1,6 @@\n+// PR c++/32256\n+// { dg-options \"-Wall\" }\n+\n+#include \"pragma-system_header4.h\"\n+\n+void ok() { }"}, {"sha": "c3abae0af27dedc1d69bcac3dc0b5d1b9af1785e", "filename": "gcc/testsuite/g++.dg/warn/pragma-system_header4.h", "status": "added", "additions": 2, "deletions": 0, "changes": 2, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/38d346765a731bd88dcda419cc2a247485f49507/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Fwarn%2Fpragma-system_header4.h", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/38d346765a731bd88dcda419cc2a247485f49507/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Fwarn%2Fpragma-system_header4.h", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Fwarn%2Fpragma-system_header4.h?ref=38d346765a731bd88dcda419cc2a247485f49507", "patch": "@@ -0,0 +1,2 @@\n+#pragma GCC system_header\n+int noreturn() { }"}]}