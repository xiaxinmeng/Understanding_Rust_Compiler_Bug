{"sha": "3362737705972ba59976909b9dbff31615a1021a", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6MzM2MjczNzcwNTk3MmJhNTk5NzY5MDliOWRiZmYzMTYxNWExMDIxYQ==", "commit": {"author": {"name": "Kewen Lin", "email": "linkw@gcc.gnu.org", "date": "2019-07-12T05:07:35Z"}, "committer": {"name": "Kewen Lin", "email": "linkw@gcc.gnu.org", "date": "2019-07-12T05:07:35Z"}, "message": "Add hint if the fallthrough target of current BB isn't the one\nplaced closely next.\n\n2019-07-12  Kewen Lin  <linkw@gcc.gnu.org>\n\n    * gcc/cfgrtl.c (print_rtl_with_bb): Emit a hint if the\n    fallthrough target of current basic block isn't the placed\n    right next.\n\nFrom-SVN: r273430", "tree": {"sha": "f8f8639d25fb8d9f98a6aa2a4647338f14366de7", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/f8f8639d25fb8d9f98a6aa2a4647338f14366de7"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/3362737705972ba59976909b9dbff31615a1021a", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/3362737705972ba59976909b9dbff31615a1021a", "html_url": "https://github.com/Rust-GCC/gccrs/commit/3362737705972ba59976909b9dbff31615a1021a", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/3362737705972ba59976909b9dbff31615a1021a/comments", "author": {"login": "jedilyn", "id": 38515402, "node_id": "MDQ6VXNlcjM4NTE1NDAy", "avatar_url": "https://avatars.githubusercontent.com/u/38515402?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jedilyn", "html_url": "https://github.com/jedilyn", "followers_url": "https://api.github.com/users/jedilyn/followers", "following_url": "https://api.github.com/users/jedilyn/following{/other_user}", "gists_url": "https://api.github.com/users/jedilyn/gists{/gist_id}", "starred_url": "https://api.github.com/users/jedilyn/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jedilyn/subscriptions", "organizations_url": "https://api.github.com/users/jedilyn/orgs", "repos_url": "https://api.github.com/users/jedilyn/repos", "events_url": "https://api.github.com/users/jedilyn/events{/privacy}", "received_events_url": "https://api.github.com/users/jedilyn/received_events", "type": "User", "site_admin": false}, "committer": {"login": "jedilyn", "id": 38515402, "node_id": "MDQ6VXNlcjM4NTE1NDAy", "avatar_url": "https://avatars.githubusercontent.com/u/38515402?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jedilyn", "html_url": "https://github.com/jedilyn", "followers_url": "https://api.github.com/users/jedilyn/followers", "following_url": "https://api.github.com/users/jedilyn/following{/other_user}", "gists_url": "https://api.github.com/users/jedilyn/gists{/gist_id}", "starred_url": "https://api.github.com/users/jedilyn/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jedilyn/subscriptions", "organizations_url": "https://api.github.com/users/jedilyn/orgs", "repos_url": "https://api.github.com/users/jedilyn/repos", "events_url": "https://api.github.com/users/jedilyn/events{/privacy}", "received_events_url": "https://api.github.com/users/jedilyn/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "e63f834983bfbcfc88520993ad3442134c9f8dbd", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/e63f834983bfbcfc88520993ad3442134c9f8dbd", "html_url": "https://github.com/Rust-GCC/gccrs/commit/e63f834983bfbcfc88520993ad3442134c9f8dbd"}], "stats": {"total": 51, "additions": 40, "deletions": 11}, "files": [{"sha": "d4eaa491a10e324ae2cb21f6645da4681cd2829b", "filename": "gcc/ChangeLog", "status": "modified", "additions": 6, "deletions": 0, "changes": 6, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/3362737705972ba59976909b9dbff31615a1021a/gcc%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/3362737705972ba59976909b9dbff31615a1021a/gcc%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2FChangeLog?ref=3362737705972ba59976909b9dbff31615a1021a", "patch": "@@ -1,3 +1,9 @@\n+2019-07-12  Kewen Lin  <linkw@gcc.gnu.org>\n+\n+\t* gcc/cfgrtl.c (print_rtl_with_bb): Emit a hint if the\n+\tfallthrough target of current basic block isn't the placed\n+\tright next.\n+\n 2019-07-11  Sunil K Pandey  <sunil.k.pandey@intel.com>\n \n \tPR target/90980"}, {"sha": "bdef400537d6b54d13a37f35898c33780a9eead9", "filename": "gcc/cfgrtl.c", "status": "modified", "additions": 34, "deletions": 11, "changes": 45, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/3362737705972ba59976909b9dbff31615a1021a/gcc%2Fcfgrtl.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/3362737705972ba59976909b9dbff31615a1021a/gcc%2Fcfgrtl.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fcfgrtl.c?ref=3362737705972ba59976909b9dbff31615a1021a", "patch": "@@ -2198,24 +2198,27 @@ print_rtl_with_bb (FILE *outf, const rtx_insn *rtx_first, dump_flags_t flags)\n       if (df)\n \tdf_dump_start (outf);\n \n-      if (flags & TDF_BLOCKS)\n+      if (cfun->curr_properties & PROP_cfg)\n \t{\n \t  FOR_EACH_BB_REVERSE_FN (bb, cfun)\n \t    {\n \t      rtx_insn *x;\n \n \t      start[INSN_UID (BB_HEAD (bb))] = bb;\n \t      end[INSN_UID (BB_END (bb))] = bb;\n-\t      for (x = BB_HEAD (bb); x != NULL_RTX; x = NEXT_INSN (x))\n+\t      if (flags & TDF_BLOCKS)\n \t\t{\n-\t\t  enum bb_state state = IN_MULTIPLE_BB;\n+\t\t  for (x = BB_HEAD (bb); x != NULL_RTX; x = NEXT_INSN (x))\n+\t\t    {\n+\t\t      enum bb_state state = IN_MULTIPLE_BB;\n \n-\t\t  if (in_bb_p[INSN_UID (x)] == NOT_IN_BB)\n-\t\t    state = IN_ONE_BB;\n-\t\t  in_bb_p[INSN_UID (x)] = state;\n+\t\t      if (in_bb_p[INSN_UID (x)] == NOT_IN_BB)\n+\t\t\tstate = IN_ONE_BB;\n+\t\t      in_bb_p[INSN_UID (x)] = state;\n \n-\t\t  if (x == BB_END (bb))\n-\t\t    break;\n+\t\t      if (x == BB_END (bb))\n+\t\t\tbreak;\n+\t\t    }\n \t\t}\n \t    }\n \t}\n@@ -2249,16 +2252,36 @@ print_rtl_with_bb (FILE *outf, const rtx_insn *rtx_first, dump_flags_t flags)\n \t  if (flags & TDF_DETAILS)\n \t    df_dump_insn_bottom (tmp_rtx, outf);\n \n-\t  if (flags & TDF_BLOCKS)\n+\t  bb = end[INSN_UID (tmp_rtx)];\n+\t  if (bb != NULL)\n \t    {\n-\t      bb = end[INSN_UID (tmp_rtx)];\n-\t      if (bb != NULL)\n+\t      if (flags & TDF_BLOCKS)\n \t\t{\n \t\t  dump_bb_info (outf, bb, 0, dump_flags, false, true);\n \t\t  if (df && (flags & TDF_DETAILS))\n \t\t    df_dump_bottom (bb, outf);\n \t\t  putc ('\\n', outf);\n \t\t}\n+\t      /* Emit a hint if the fallthrough target of current basic block\n+\t         isn't the one placed right next.  */\n+\t      else if (EDGE_COUNT (bb->succs) > 0)\n+\t\t{\n+\t\t  gcc_assert (BB_END (bb) == tmp_rtx);\n+\t\t  const rtx_insn *ninsn = NEXT_INSN (tmp_rtx);\n+\t\t  /* Bypass intervening deleted-insn notes and debug insns.  */\n+\t\t  while (ninsn\n+\t\t\t && !NONDEBUG_INSN_P (ninsn)\n+\t\t\t && !start[INSN_UID (ninsn)])\n+\t\t    ninsn = NEXT_INSN (ninsn);\n+\t\t  edge e = find_fallthru_edge (bb->succs);\n+\t\t  if (e && ninsn)\n+\t\t    {\n+\t\t      basic_block dest = e->dest;\n+\t\t      if (start[INSN_UID (ninsn)] != dest)\n+\t\t\tfprintf (outf, \"%s      ; pc falls through to BB %d\\n\",\n+\t\t\t\t print_rtx_head, dest->index);\n+\t\t    }\n+\t\t}\n \t    }\n \t}\n "}]}