{"sha": "367740bf6d3a6627798b3955e5d85efc7549ef50", "node_id": "C_kwDOANBUbNoAKDM2Nzc0MGJmNmQzYTY2Mjc3OThiMzk1NWU1ZDg1ZWZjNzU0OWVmNTA", "commit": {"author": {"name": "Jonathan Wakely", "email": "jwakely@redhat.com", "date": "2022-05-26T20:32:55Z"}, "committer": {"name": "Jonathan Wakely", "email": "jwakely@redhat.com", "date": "2022-05-26T21:29:05Z"}, "message": "libstdc++: Fix narrowing conversions for 16-bit size_t [PR105681]\n\nOn a 16-bit target such as msp430 we get errors about narrowing long\nvalues to size_t, which is only 16-bit. When --enable-libstdcxx-pch is\nused the <bits/extc++.h> header breaks the build because of these\nnarrowing errors.\n\nlibstdc++-v3/ChangeLog:\n\n\tPR libstdc++/105681\n\t* include/ext/pb_ds/detail/resize_policy/hash_prime_size_policy_imp.hpp:\n\tLimit ga_sizes array to values that fit in size_t.\n\t* include/ext/random [__SIZE_WIDTH < 32] (sfmt86243)\n\t(sfmt86243_64, sfmt132049, sfmt132049_64, sfmt216091)\n\t(sfmt216091_64): Do not declare.", "tree": {"sha": "fcba7794dc9420038b80e182b320fe2926834ff1", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/fcba7794dc9420038b80e182b320fe2926834ff1"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/367740bf6d3a6627798b3955e5d85efc7549ef50", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/367740bf6d3a6627798b3955e5d85efc7549ef50", "html_url": "https://github.com/Rust-GCC/gccrs/commit/367740bf6d3a6627798b3955e5d85efc7549ef50", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/367740bf6d3a6627798b3955e5d85efc7549ef50/comments", "author": {"login": "jwakely", "id": 1254480, "node_id": "MDQ6VXNlcjEyNTQ0ODA=", "avatar_url": "https://avatars.githubusercontent.com/u/1254480?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jwakely", "html_url": "https://github.com/jwakely", "followers_url": "https://api.github.com/users/jwakely/followers", "following_url": "https://api.github.com/users/jwakely/following{/other_user}", "gists_url": "https://api.github.com/users/jwakely/gists{/gist_id}", "starred_url": "https://api.github.com/users/jwakely/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jwakely/subscriptions", "organizations_url": "https://api.github.com/users/jwakely/orgs", "repos_url": "https://api.github.com/users/jwakely/repos", "events_url": "https://api.github.com/users/jwakely/events{/privacy}", "received_events_url": "https://api.github.com/users/jwakely/received_events", "type": "User", "site_admin": false}, "committer": {"login": "jwakely", "id": 1254480, "node_id": "MDQ6VXNlcjEyNTQ0ODA=", "avatar_url": "https://avatars.githubusercontent.com/u/1254480?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jwakely", "html_url": "https://github.com/jwakely", "followers_url": "https://api.github.com/users/jwakely/followers", "following_url": "https://api.github.com/users/jwakely/following{/other_user}", "gists_url": "https://api.github.com/users/jwakely/gists{/gist_id}", "starred_url": "https://api.github.com/users/jwakely/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jwakely/subscriptions", "organizations_url": "https://api.github.com/users/jwakely/orgs", "repos_url": "https://api.github.com/users/jwakely/repos", "events_url": "https://api.github.com/users/jwakely/events{/privacy}", "received_events_url": "https://api.github.com/users/jwakely/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "11e1ee1b38f0d3a825b0cb70122cb345636b0534", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/11e1ee1b38f0d3a825b0cb70122cb345636b0534", "html_url": "https://github.com/Rust-GCC/gccrs/commit/11e1ee1b38f0d3a825b0cb70122cb345636b0534"}], "stats": {"total": 20, "additions": 17, "deletions": 3}, "files": [{"sha": "43d727682066056025e8d475c46241d4cb17585e", "filename": "libstdc++-v3/include/ext/pb_ds/detail/resize_policy/hash_prime_size_policy_imp.hpp", "status": "modified", "additions": 15, "deletions": 3, "changes": 18, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/367740bf6d3a6627798b3955e5d85efc7549ef50/libstdc%2B%2B-v3%2Finclude%2Fext%2Fpb_ds%2Fdetail%2Fresize_policy%2Fhash_prime_size_policy_imp.hpp", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/367740bf6d3a6627798b3955e5d85efc7549ef50/libstdc%2B%2B-v3%2Finclude%2Fext%2Fpb_ds%2Fdetail%2Fresize_policy%2Fhash_prime_size_policy_imp.hpp", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libstdc%2B%2B-v3%2Finclude%2Fext%2Fpb_ds%2Fdetail%2Fresize_policy%2Fhash_prime_size_policy_imp.hpp?ref=367740bf6d3a6627798b3955e5d85efc7549ef50", "patch": "@@ -46,15 +46,23 @@ namespace detail\n {\n   enum\n     {\n+      num_distinct_sizes_16_bit = 14,\n       num_distinct_sizes_32_bit = 30,\n       num_distinct_sizes_64_bit = 62,\n-      num_distinct_sizes = sizeof(std::size_t) != 8 ? \n-            num_distinct_sizes_32_bit : num_distinct_sizes_64_bit,\t\n+      // The number of values is limited by the width of size_t.\n+      // Maybe we could just use (__SIZE_WIDTH__ - 2) here.\n+#if __SIZE_WIDTH__ >= 64\n+      num_distinct_sizes =  num_distinct_sizes_64_bit\n+#elif __SIZE_WIDTH__ >= 32\n+      num_distinct_sizes =  num_distinct_sizes_32_bit\n+#else\n+      num_distinct_sizes =  num_distinct_sizes_16_bit\n+#endif\n     };\n \n   // Originally taken from the SGI implementation; acknowledged in the docs.\n   // Further modified (for 64 bits) from tr1's hashtable.\n-  static const std::size_t g_a_sizes[num_distinct_sizes_64_bit] =\n+  static const std::size_t g_a_sizes[num_distinct_sizes] =\n     {\n       /* 0     */              5ul,\n       /* 1     */              11ul, \n@@ -70,6 +78,7 @@ namespace detail\n       /* 11    */              14033ul, \n       /* 12    */              28411ul, \n       /* 13    */              57557ul, \n+#if __SIZE_WIDTH__ >= 32\n       /* 14    */              116731ul, \n       /* 15    */              236897ul,\n       /* 16    */              480881ul, \n@@ -86,6 +95,7 @@ namespace detail\n       /* 27    */              1164186217ul,\n       /* 28    */              2364114217ul, \n       /* 29    */              4294967291ul,\n+#if __SIZE_WIDTH__ >= 64\n       /* 30    */ (std::size_t)8589934583ull,\n       /* 31    */ (std::size_t)17179869143ull,\n       /* 32    */ (std::size_t)34359738337ull,\n@@ -118,6 +128,8 @@ namespace detail\n       /* 59    */ (std::size_t)4611686018427387847ull,\n       /* 60    */ (std::size_t)9223372036854775783ull,\n       /* 61    */ (std::size_t)18446744073709551557ull,\n+#endif\n+#endif\n     };\n \n } // namespace detail"}, {"sha": "50505b876cc639e7cb267f4dd081df1f91ba1e8b", "filename": "libstdc++-v3/include/ext/random", "status": "modified", "additions": 2, "deletions": 0, "changes": 2, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/367740bf6d3a6627798b3955e5d85efc7549ef50/libstdc%2B%2B-v3%2Finclude%2Fext%2Frandom", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/367740bf6d3a6627798b3955e5d85efc7549ef50/libstdc%2B%2B-v3%2Finclude%2Fext%2Frandom", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libstdc%2B%2B-v3%2Finclude%2Fext%2Frandom?ref=367740bf6d3a6627798b3955e5d85efc7549ef50", "patch": "@@ -346,6 +346,7 @@ _GLIBCXX_BEGIN_NAMESPACE_VERSION\n \t\t\t\t\t    0xa3ac4000U, 0xecc1327aU>\n     sfmt44497_64;\n \n+#if __SIZE_WIDTH__ >= 32\n \n   typedef simd_fast_mersenne_twister_engine<uint32_t, 86243, 366,\n \t\t\t\t\t    6, 7, 19, 1,\n@@ -396,6 +397,7 @@ _GLIBCXX_BEGIN_NAMESPACE_VERSION\n \t\t\t\t\t    0xf8000001U, 0x89e80709U,\n \t\t\t\t\t    0x3bd2b64bU, 0x0c64b1e4U>\n     sfmt216091_64;\n+#endif // __SIZE_WIDTH__ >= 32\n \n #endif // __BYTE_ORDER__ == __ORDER_LITTLE_ENDIAN__\n "}]}