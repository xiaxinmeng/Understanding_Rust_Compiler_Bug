{"sha": "a0aedc7a41c6756a30669632d3df22e05b174401", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6YTBhZWRjN2E0MWM2NzU2YTMwNjY5NjMyZDNkZjIyZTA1YjE3NDQwMQ==", "commit": {"author": {"name": "Marek Polacek", "email": "polacek@redhat.com", "date": "2019-09-24T14:40:24Z"}, "committer": {"name": "Marek Polacek", "email": "mpolacek@gcc.gnu.org", "date": "2019-09-24T14:40:24Z"}, "message": "PR c++/91868 - improve -Wshadow location.\n\n\t* name-lookup.c (check_local_shadow): Use DECL_SOURCE_LOCATION\n\tinstead of input_location.\n\n\t* g++.dg/warn/Wshadow-16.C: New test.\n\nFrom-SVN: r276103", "tree": {"sha": "97fccfffc60fafc496fb4cfb99831577a41d8df6", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/97fccfffc60fafc496fb4cfb99831577a41d8df6"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/a0aedc7a41c6756a30669632d3df22e05b174401", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/a0aedc7a41c6756a30669632d3df22e05b174401", "html_url": "https://github.com/Rust-GCC/gccrs/commit/a0aedc7a41c6756a30669632d3df22e05b174401", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/a0aedc7a41c6756a30669632d3df22e05b174401/comments", "author": {"login": "mpolacek", "id": 10496300, "node_id": "MDQ6VXNlcjEwNDk2MzAw", "avatar_url": "https://avatars.githubusercontent.com/u/10496300?v=4", "gravatar_id": "", "url": "https://api.github.com/users/mpolacek", "html_url": "https://github.com/mpolacek", "followers_url": "https://api.github.com/users/mpolacek/followers", "following_url": "https://api.github.com/users/mpolacek/following{/other_user}", "gists_url": "https://api.github.com/users/mpolacek/gists{/gist_id}", "starred_url": "https://api.github.com/users/mpolacek/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/mpolacek/subscriptions", "organizations_url": "https://api.github.com/users/mpolacek/orgs", "repos_url": "https://api.github.com/users/mpolacek/repos", "events_url": "https://api.github.com/users/mpolacek/events{/privacy}", "received_events_url": "https://api.github.com/users/mpolacek/received_events", "type": "User", "site_admin": false}, "committer": null, "parents": [{"sha": "fea3397e56a3662a9b2361c14e427c9786042ebf", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/fea3397e56a3662a9b2361c14e427c9786042ebf", "html_url": "https://github.com/Rust-GCC/gccrs/commit/fea3397e56a3662a9b2361c14e427c9786042ebf"}], "stats": {"total": 37, "additions": 34, "deletions": 3}, "files": [{"sha": "f4c87c56b1c74c2b36ce162e285a55a9ae638a93", "filename": "gcc/cp/ChangeLog", "status": "modified", "additions": 4, "deletions": 0, "changes": 4, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/a0aedc7a41c6756a30669632d3df22e05b174401/gcc%2Fcp%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/a0aedc7a41c6756a30669632d3df22e05b174401/gcc%2Fcp%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fcp%2FChangeLog?ref=a0aedc7a41c6756a30669632d3df22e05b174401", "patch": "@@ -1,5 +1,9 @@\n 2019-09-24  Marek Polacek  <polacek@redhat.com>\n \n+\tPR c++/91868 - improve -Wshadow location.\n+\t* name-lookup.c (check_local_shadow): Use DECL_SOURCE_LOCATION\n+\tinstead of input_location.\n+\n \tPR c++/91845 - ICE with invalid pointer-to-member.\n \t* expr.c (mark_use): Use error_operand_p.\n \t* typeck2.c (build_m_component_ref): Check error_operand_p after"}, {"sha": "74f1072fa8c5c361e15d36341c994bd092b90078", "filename": "gcc/cp/name-lookup.c", "status": "modified", "additions": 3, "deletions": 3, "changes": 6, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/a0aedc7a41c6756a30669632d3df22e05b174401/gcc%2Fcp%2Fname-lookup.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/a0aedc7a41c6756a30669632d3df22e05b174401/gcc%2Fcp%2Fname-lookup.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fcp%2Fname-lookup.c?ref=a0aedc7a41c6756a30669632d3df22e05b174401", "patch": "@@ -2771,7 +2771,7 @@ check_local_shadow (tree decl)\n \tmsg = \"declaration of %qD shadows a previous local\";\n \n       auto_diagnostic_group d;\n-      if (warning_at (input_location, warning_code, msg, decl))\n+      if (warning_at (DECL_SOURCE_LOCATION (decl), warning_code, msg, decl))\n \tinform_shadowed (old);\n       return;\n     }\n@@ -2798,7 +2798,7 @@ check_local_shadow (tree decl)\n \t    || TYPE_PTRMEMFUNC_P (TREE_TYPE (decl)))\n \t  {\n \t    auto_diagnostic_group d;\n-\t    if (warning_at (input_location, OPT_Wshadow,\n+\t    if (warning_at (DECL_SOURCE_LOCATION (decl), OPT_Wshadow,\n \t\t\t    \"declaration of %qD shadows a member of %qT\",\n \t\t\t    decl, current_nonlambda_class_type ())\n \t\t&& DECL_P (member))\n@@ -2818,7 +2818,7 @@ check_local_shadow (tree decl)\n     /* XXX shadow warnings in outer-more namespaces */\n     {\n       auto_diagnostic_group d;\n-      if (warning_at (input_location, OPT_Wshadow,\n+      if (warning_at (DECL_SOURCE_LOCATION (decl), OPT_Wshadow,\n \t\t      \"declaration of %qD shadows a global declaration\",\n \t\t      decl))\n \tinform_shadowed (old);"}, {"sha": "b90eb6d13ca05666c526c46b24900e8029ed6cc3", "filename": "gcc/testsuite/ChangeLog", "status": "modified", "additions": 3, "deletions": 0, "changes": 3, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/a0aedc7a41c6756a30669632d3df22e05b174401/gcc%2Ftestsuite%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/a0aedc7a41c6756a30669632d3df22e05b174401/gcc%2Ftestsuite%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2FChangeLog?ref=a0aedc7a41c6756a30669632d3df22e05b174401", "patch": "@@ -1,5 +1,8 @@\n 2019-09-24  Marek Polacek  <polacek@redhat.com>\n \n+\tPR c++/91868 - improve -Wshadow location.\n+\t* g++.dg/warn/Wshadow-16.C: New test.\n+\n \tPR c++/91845 - ICE with invalid pointer-to-member.\n \t* g++.dg/cpp1y/pr91845.C: New test.\n "}, {"sha": "bbf3a463fe2ac1e25e5a8f671c7c747554e35d46", "filename": "gcc/testsuite/g++.dg/warn/Wshadow-16.C", "status": "added", "additions": 24, "deletions": 0, "changes": 24, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/a0aedc7a41c6756a30669632d3df22e05b174401/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Fwarn%2FWshadow-16.C", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/a0aedc7a41c6756a30669632d3df22e05b174401/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Fwarn%2FWshadow-16.C", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Fwarn%2FWshadow-16.C?ref=a0aedc7a41c6756a30669632d3df22e05b174401", "patch": "@@ -0,0 +1,24 @@\n+// PR c++/91868 - improve -Wshadow location.\n+// { dg-options \"-Wshadow\" }\n+\n+int global; // { dg-message \"shadowed declaration\" }\n+\n+struct S\n+{\n+  static int bar; // { dg-message \"shadowed declaration\" }\n+  S (int i) { int bar // { dg-warning \"19:declaration of .bar. shadows a member\" }\n+      (1);\n+    int global // { dg-warning \"9:declaration of .global. shadows a global declaration\" }\n+      (42);\n+  }\n+};\n+\n+void\n+foo ()\n+{\n+  int xx; // { dg-message \"shadowed declaration\" }\n+  {\n+    S xx // { dg-warning \"7:declaration of .xx. shadows a previous local\" }\n+    (42);\n+  }\n+}"}]}