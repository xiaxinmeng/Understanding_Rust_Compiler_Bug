{"sha": "3be33b6eacc702052999b851cc2a8bee97cec47f", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6M2JlMzNiNmVhY2M3MDIwNTI5OTliODUxY2MyYThiZWU5N2NlYzQ3Zg==", "commit": {"author": {"name": "Jakub Jelinek", "email": "jakub@redhat.com", "date": "2015-12-15T07:46:23Z"}, "committer": {"name": "Jakub Jelinek", "email": "jakub@gcc.gnu.org", "date": "2015-12-15T07:46:23Z"}, "message": "re PR debug/66688 (compare debug failure building Linux kernel on ppc64le)\n\n\tPR tree-optimization/66688\n\t* tree-cfgcleanup.c (cleanup_control_flow_bb): Handle\n\tnoreturn call followed only by debug stmts by removing\n\tthe debug stmts and handling it the same as if the noreturn\n\tcall is the last stmt.\n\n\t* gcc.dg/pr66688.c: New test.\n\nFrom-SVN: r231644", "tree": {"sha": "053148663998d24f5a8549a720787932ed33c901", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/053148663998d24f5a8549a720787932ed33c901"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/3be33b6eacc702052999b851cc2a8bee97cec47f", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/3be33b6eacc702052999b851cc2a8bee97cec47f", "html_url": "https://github.com/Rust-GCC/gccrs/commit/3be33b6eacc702052999b851cc2a8bee97cec47f", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/3be33b6eacc702052999b851cc2a8bee97cec47f/comments", "author": {"login": "jakubjelinek", "id": 9370665, "node_id": "MDQ6VXNlcjkzNzA2NjU=", "avatar_url": "https://avatars.githubusercontent.com/u/9370665?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jakubjelinek", "html_url": "https://github.com/jakubjelinek", "followers_url": "https://api.github.com/users/jakubjelinek/followers", "following_url": "https://api.github.com/users/jakubjelinek/following{/other_user}", "gists_url": "https://api.github.com/users/jakubjelinek/gists{/gist_id}", "starred_url": "https://api.github.com/users/jakubjelinek/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jakubjelinek/subscriptions", "organizations_url": "https://api.github.com/users/jakubjelinek/orgs", "repos_url": "https://api.github.com/users/jakubjelinek/repos", "events_url": "https://api.github.com/users/jakubjelinek/events{/privacy}", "received_events_url": "https://api.github.com/users/jakubjelinek/received_events", "type": "User", "site_admin": false}, "committer": null, "parents": [{"sha": "3ce38f68f93279b193ecb91cdc3635db6f9c810f", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/3ce38f68f93279b193ecb91cdc3635db6f9c810f", "html_url": "https://github.com/Rust-GCC/gccrs/commit/3ce38f68f93279b193ecb91cdc3635db6f9c810f"}], "stats": {"total": 72, "additions": 67, "deletions": 5}, "files": [{"sha": "e36f0ed603ec0586d8371edad3126181fd45b083", "filename": "gcc/ChangeLog", "status": "modified", "additions": 8, "deletions": 0, "changes": 8, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/3be33b6eacc702052999b851cc2a8bee97cec47f/gcc%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/3be33b6eacc702052999b851cc2a8bee97cec47f/gcc%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2FChangeLog?ref=3be33b6eacc702052999b851cc2a8bee97cec47f", "patch": "@@ -1,3 +1,11 @@\n+2015-12-15  Jakub Jelinek  <jakub@redhat.com>\n+\n+\tPR tree-optimization/66688\n+\t* tree-cfgcleanup.c (cleanup_control_flow_bb): Handle\n+\tnoreturn call followed only by debug stmts by removing\n+\tthe debug stmts and handling it the same as if the noreturn\n+\tcall is the last stmt.\n+\n 2015-12-14  Steve Ellcey  <sellcey@imgtec.com>\n \n \t* config/mips/mips.c (mips_promote_function_mode): New function."}, {"sha": "8f6436025eebff20dfcfd4763a73a29ebe523514", "filename": "gcc/testsuite/ChangeLog", "status": "modified", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/3be33b6eacc702052999b851cc2a8bee97cec47f/gcc%2Ftestsuite%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/3be33b6eacc702052999b851cc2a8bee97cec47f/gcc%2Ftestsuite%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2FChangeLog?ref=3be33b6eacc702052999b851cc2a8bee97cec47f", "patch": "@@ -1,3 +1,8 @@\n+2015-12-15  Jakub Jelinek  <jakub@redhat.com>\n+\n+\tPR tree-optimization/66688\n+\t* gcc.dg/pr66688.c: New test.\n+\n 2015-12-15  Patrick Palka  <ppalka@gcc.gnu.org>\n \n \tPR c++/21802"}, {"sha": "af6f8443a7c88467266168a733d79c845726456d", "filename": "gcc/testsuite/gcc.dg/pr66688.c", "status": "added", "additions": 39, "deletions": 0, "changes": 39, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/3be33b6eacc702052999b851cc2a8bee97cec47f/gcc%2Ftestsuite%2Fgcc.dg%2Fpr66688.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/3be33b6eacc702052999b851cc2a8bee97cec47f/gcc%2Ftestsuite%2Fgcc.dg%2Fpr66688.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgcc.dg%2Fpr66688.c?ref=3be33b6eacc702052999b851cc2a8bee97cec47f", "patch": "@@ -0,0 +1,39 @@\n+/* PR tree-optimization/66688 */\n+/* { dg-do compile } */\n+/* { dg-options \"-O2 -fno-reorder-blocks -fcompare-debug\" } */\n+\n+struct fdt_header { unsigned magic; } *a;\n+\n+int d;\n+\n+int\n+__fswab32 (int p1)\n+{\n+  return __builtin_bswap32 (p1);\n+}\n+\n+void\n+fdt_set_magic (int p1)\n+{\n+  struct fdt_header *b = a;\n+  b->magic = __builtin_constant_p (p1) ? : __fswab32 (p1);\n+}\n+\n+int\n+_fdt_sw_check_header ()\n+{\n+  int c = ((struct fdt_header *) 1)->magic;\n+  if (c)\n+    return 1;\n+  return 0;\n+}\n+\n+int\n+fdt_finish ()\n+{\n+  if (_fdt_sw_check_header ())\n+    if (d)\n+      return 0;\n+  fdt_set_magic (0);\n+  return 0;\n+}"}, {"sha": "3f50c66af6060d29ea1072533b776028681a9f7d", "filename": "gcc/tree-cfgcleanup.c", "status": "modified", "additions": 15, "deletions": 5, "changes": 20, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/3be33b6eacc702052999b851cc2a8bee97cec47f/gcc%2Ftree-cfgcleanup.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/3be33b6eacc702052999b851cc2a8bee97cec47f/gcc%2Ftree-cfgcleanup.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftree-cfgcleanup.c?ref=3be33b6eacc702052999b851cc2a8bee97cec47f", "patch": "@@ -186,7 +186,7 @@ cleanup_control_flow_bb (basic_block bb)\n      we need to prune cfg.  */\n   retval |= gimple_purge_dead_eh_edges (bb);\n \n-  gsi = gsi_last_bb (bb);\n+  gsi = gsi_last_nondebug_bb (bb);\n   if (gsi_end_p (gsi))\n     return retval;\n \n@@ -197,7 +197,10 @@ cleanup_control_flow_bb (basic_block bb)\n \n   if (gimple_code (stmt) == GIMPLE_COND\n       || gimple_code (stmt) == GIMPLE_SWITCH)\n-    retval |= cleanup_control_expr_graph (bb, gsi);\n+    {\n+      gcc_checking_assert (gsi_stmt (gsi_last_bb (bb)) == stmt);\n+      retval |= cleanup_control_expr_graph (bb, gsi);\n+    }\n   else if (gimple_code (stmt) == GIMPLE_GOTO\n \t   && TREE_CODE (gimple_goto_dest (stmt)) == ADDR_EXPR\n \t   && (TREE_CODE (TREE_OPERAND (gimple_goto_dest (stmt), 0))\n@@ -210,6 +213,7 @@ cleanup_control_flow_bb (basic_block bb)\n       edge_iterator ei;\n       basic_block target_block;\n \n+      gcc_checking_assert (gsi_stmt (gsi_last_bb (bb)) == stmt);\n       /* First look at all the outgoing edges.  Delete any outgoing\n \t edges which do not go to the right block.  For the one\n \t edge which goes to the right block, fix up its flags.  */\n@@ -242,9 +246,15 @@ cleanup_control_flow_bb (basic_block bb)\n   /* Check for indirect calls that have been turned into\n      noreturn calls.  */\n   else if (is_gimple_call (stmt)\n-           && gimple_call_noreturn_p (stmt)\n-           && remove_fallthru_edge (bb->succs))\n-    retval = true;\n+\t   && gimple_call_noreturn_p (stmt))\n+    {\n+      /* If there are debug stmts after the noreturn call, remove them\n+\t now, they should be all unreachable anyway.  */\n+      for (gsi_next (&gsi); !gsi_end_p (gsi); )\n+\tgsi_remove (&gsi, true);\n+      if (remove_fallthru_edge (bb->succs))\n+\tretval = true;\n+    }\n \n   return retval;\n }"}]}