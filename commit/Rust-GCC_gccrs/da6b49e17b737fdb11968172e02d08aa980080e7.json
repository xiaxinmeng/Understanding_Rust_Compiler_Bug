{"sha": "da6b49e17b737fdb11968172e02d08aa980080e7", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6ZGE2YjQ5ZTE3YjczN2ZkYjExOTY4MTcyZTAyZDA4YWE5ODAwODBlNw==", "commit": {"author": {"name": "Paul Thomas", "email": "pault@gcc.gnu.org", "date": "2007-09-21T15:02:44Z"}, "committer": {"name": "Paul Thomas", "email": "pault@gcc.gnu.org", "date": "2007-09-21T15:02:44Z"}, "message": "trans-expr.c (gfc_trans_pointer_assignment): Convert array descriptor for subref pointer assignements...\n\n2007-09-21  Paul Thomas  <pault@gcc.gnu.org>\n\n\t*trans-expr.c (gfc_trans_pointer_assignment): Convert array\n\tdescriptor for subref pointer assignements, rather than using\n\tthe loop info version.\n\nFrom-SVN: r128651", "tree": {"sha": "cbee7322eb42d62fa08adb164300a6accb5efc26", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/cbee7322eb42d62fa08adb164300a6accb5efc26"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/da6b49e17b737fdb11968172e02d08aa980080e7", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/da6b49e17b737fdb11968172e02d08aa980080e7", "html_url": "https://github.com/Rust-GCC/gccrs/commit/da6b49e17b737fdb11968172e02d08aa980080e7", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/da6b49e17b737fdb11968172e02d08aa980080e7/comments", "author": null, "committer": null, "parents": [{"sha": "9723778490b9963e98658dc82a5f48b291cfe67a", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/9723778490b9963e98658dc82a5f48b291cfe67a", "html_url": "https://github.com/Rust-GCC/gccrs/commit/9723778490b9963e98658dc82a5f48b291cfe67a"}], "stats": {"total": 19, "additions": 14, "deletions": 5}, "files": [{"sha": "586c71919eb7316bd026683be704e920aee22ef1", "filename": "gcc/fortran/ChangeLog", "status": "modified", "additions": 6, "deletions": 0, "changes": 6, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/da6b49e17b737fdb11968172e02d08aa980080e7/gcc%2Ffortran%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/da6b49e17b737fdb11968172e02d08aa980080e7/gcc%2Ffortran%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ffortran%2FChangeLog?ref=da6b49e17b737fdb11968172e02d08aa980080e7", "patch": "@@ -1,3 +1,9 @@\n+2007-09-21  Paul Thomas  <pault@gcc.gnu.org>\n+\n+\t*trans-expr.c (gfc_trans_pointer_assignment): Convert array\n+\tdescriptor for subref pointer assignements, rather than using\n+\tthe loop info version.\n+\n 2007-09-21  Tobias Burnus  <burnus@net-b.de>\n \n \tPR fortran/33037"}, {"sha": "dff1fd8fcc148727e43f0336b9360e270d13cac2", "filename": "gcc/fortran/trans-expr.c", "status": "modified", "additions": 8, "deletions": 5, "changes": 13, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/da6b49e17b737fdb11968172e02d08aa980080e7/gcc%2Ffortran%2Ftrans-expr.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/da6b49e17b737fdb11968172e02d08aa980080e7/gcc%2Ffortran%2Ftrans-expr.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ffortran%2Ftrans-expr.c?ref=da6b49e17b737fdb11968172e02d08aa980080e7", "patch": "@@ -3499,14 +3499,17 @@ gfc_trans_pointer_assignment (gfc_expr * expr1, gfc_expr * expr2)\n \t  gfc_conv_expr_descriptor (&lse, expr2, rss);\n \n \t  /* If this is a subreference array pointer assignment, use the rhs\n-\t     element size for the lhs span.  */\n+\t     descriptor element size for the lhs span.  */\n \t  if (expr1->symtree->n.sym->attr.subref_array_pointer)\n \t    {\n \t      decl = expr1->symtree->n.sym->backend_decl;\n-\t      tmp = rss->data.info.descriptor;\n-\t      tmp = gfc_get_element_type (TREE_TYPE (tmp));\n-\t      tmp = size_in_bytes (tmp);\n-\t      tmp = fold_convert (gfc_array_index_type, tmp);\n+\t      gfc_init_se (&rse, NULL);\n+\t      rse.descriptor_only = 1;\n+\t      gfc_conv_expr (&rse, expr2);\n+\t      tmp = gfc_get_element_type (TREE_TYPE (rse.expr));\n+\t      tmp = fold_convert (gfc_array_index_type, size_in_bytes (tmp));\n+\t      if (!INTEGER_CST_P (tmp))\n+\t        gfc_add_block_to_block (&lse.post, &rse.pre);\n \t      gfc_add_modify_expr (&lse.post, GFC_DECL_SPAN(decl), tmp);\n \t    }\n "}]}