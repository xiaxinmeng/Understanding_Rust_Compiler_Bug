{"sha": "783dc66f9ccb0019c3dad2701bb9110286758d70", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6NzgzZGM2NmY5Y2NiMDAxOWMzZGFkMjcwMWJiOTExMDI4Njc1OGQ3MA==", "commit": {"author": {"name": "Richard Biener", "email": "rguenther@suse.de", "date": "2020-09-09T08:36:46Z"}, "committer": {"name": "Richard Biener", "email": "rguenther@suse.de", "date": "2020-09-09T09:36:19Z"}, "message": "enable live condition vectorization\n\nThis removes a check preventing vectorization of live results of\nvectorized conditions.\n\n2020-09-09  Richard Biener  <rguenther@suse.de>\n\n\t* tree-vect-stmts.c (vectorizable_condition): Allow\n\tSTMT_VINFO_LIVE_P stmts.\n\n\t* gcc.dg/vect/vect-cond-13.c: New testcase.\n\t* gcc.target/i386/pr87007-4.c: Adjust.\n\t* gcc.target/i386/pr87007-5.c: Likewise.", "tree": {"sha": "e7d54a5d276ed7fbfb17e9edfb945856aacccb23", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/e7d54a5d276ed7fbfb17e9edfb945856aacccb23"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/783dc66f9ccb0019c3dad2701bb9110286758d70", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/783dc66f9ccb0019c3dad2701bb9110286758d70", "html_url": "https://github.com/Rust-GCC/gccrs/commit/783dc66f9ccb0019c3dad2701bb9110286758d70", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/783dc66f9ccb0019c3dad2701bb9110286758d70/comments", "author": {"login": "rguenth", "id": 2046526, "node_id": "MDQ6VXNlcjIwNDY1MjY=", "avatar_url": "https://avatars.githubusercontent.com/u/2046526?v=4", "gravatar_id": "", "url": "https://api.github.com/users/rguenth", "html_url": "https://github.com/rguenth", "followers_url": "https://api.github.com/users/rguenth/followers", "following_url": "https://api.github.com/users/rguenth/following{/other_user}", "gists_url": "https://api.github.com/users/rguenth/gists{/gist_id}", "starred_url": "https://api.github.com/users/rguenth/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/rguenth/subscriptions", "organizations_url": "https://api.github.com/users/rguenth/orgs", "repos_url": "https://api.github.com/users/rguenth/repos", "events_url": "https://api.github.com/users/rguenth/events{/privacy}", "received_events_url": "https://api.github.com/users/rguenth/received_events", "type": "User", "site_admin": false}, "committer": {"login": "rguenth", "id": 2046526, "node_id": "MDQ6VXNlcjIwNDY1MjY=", "avatar_url": "https://avatars.githubusercontent.com/u/2046526?v=4", "gravatar_id": "", "url": "https://api.github.com/users/rguenth", "html_url": "https://github.com/rguenth", "followers_url": "https://api.github.com/users/rguenth/followers", "following_url": "https://api.github.com/users/rguenth/following{/other_user}", "gists_url": "https://api.github.com/users/rguenth/gists{/gist_id}", "starred_url": "https://api.github.com/users/rguenth/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/rguenth/subscriptions", "organizations_url": "https://api.github.com/users/rguenth/orgs", "repos_url": "https://api.github.com/users/rguenth/repos", "events_url": "https://api.github.com/users/rguenth/events{/privacy}", "received_events_url": "https://api.github.com/users/rguenth/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "0d7d52131a4a0e480465ced7ae049e7eae2d3efd", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/0d7d52131a4a0e480465ced7ae049e7eae2d3efd", "html_url": "https://github.com/Rust-GCC/gccrs/commit/0d7d52131a4a0e480465ced7ae049e7eae2d3efd"}], "stats": {"total": 51, "additions": 40, "deletions": 11}, "files": [{"sha": "2dfb8797cd8e8bdc4aa633e9472d0479077ef5bb", "filename": "gcc/testsuite/gcc.dg/vect/vect-cond-13.c", "status": "added", "additions": 38, "deletions": 0, "changes": 38, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/783dc66f9ccb0019c3dad2701bb9110286758d70/gcc%2Ftestsuite%2Fgcc.dg%2Fvect%2Fvect-cond-13.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/783dc66f9ccb0019c3dad2701bb9110286758d70/gcc%2Ftestsuite%2Fgcc.dg%2Fvect%2Fvect-cond-13.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgcc.dg%2Fvect%2Fvect-cond-13.c?ref=783dc66f9ccb0019c3dad2701bb9110286758d70", "patch": "@@ -0,0 +1,38 @@\n+/* { dg-do run } */\n+\n+#include \"tree-vect.h\"\n+\n+int a[1024];\n+int b[1024];\n+\n+int\n+foo ()\n+{\n+  int tem;\n+  for (int i = 0; i < 1024; ++i)\n+    {\n+      if (a[i] < 0)\n+        tem = -a[i] - 1;\n+      else\n+        tem = a[i];\n+      b[i] = tem + 10;\n+    }\n+  return tem;\n+}\n+\n+int main()\n+{\n+  check_vect ();\n+\n+  for (int i = 0; i < 1024; ++i)\n+    {\n+      a[i] = i - 333;\n+      __asm__ volatile (\"\" ::: \"memory\");\n+    }\n+  int res = foo ();\n+  if (res != 1023 - 333)\n+    abort ();\n+  return 0;\n+}\n+\n+/* { dg-final { scan-tree-dump \"vectorized 1 loops\" \"vect\" { target vect_condition } } } */"}, {"sha": "9c4b8005af30b50a39ba5de8f0eb197711830cd3", "filename": "gcc/testsuite/gcc.target/i386/pr87007-4.c", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/783dc66f9ccb0019c3dad2701bb9110286758d70/gcc%2Ftestsuite%2Fgcc.target%2Fi386%2Fpr87007-4.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/783dc66f9ccb0019c3dad2701bb9110286758d70/gcc%2Ftestsuite%2Fgcc.target%2Fi386%2Fpr87007-4.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgcc.target%2Fi386%2Fpr87007-4.c?ref=783dc66f9ccb0019c3dad2701bb9110286758d70", "patch": "@@ -15,4 +15,4 @@ foo (int n, int k)\n       d1 = ceil (d3);\n }\n \n-/* { dg-final { scan-assembler-times \"vxorps\\[^\\n\\r\\]*xmm\\[0-9\\]\" 1 } } */\n+/* { dg-final { scan-assembler-times \"vxorps\\[^\\n\\r\\]*xmm\\[0-9\\]\" 0 } } */"}, {"sha": "e4d956a5d7fb8d2d85f0da4cc4670fec99f48225", "filename": "gcc/testsuite/gcc.target/i386/pr87007-5.c", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/783dc66f9ccb0019c3dad2701bb9110286758d70/gcc%2Ftestsuite%2Fgcc.target%2Fi386%2Fpr87007-5.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/783dc66f9ccb0019c3dad2701bb9110286758d70/gcc%2Ftestsuite%2Fgcc.target%2Fi386%2Fpr87007-5.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgcc.target%2Fi386%2Fpr87007-5.c?ref=783dc66f9ccb0019c3dad2701bb9110286758d70", "patch": "@@ -15,4 +15,4 @@ foo (int n, int k)\n       d1 = sqrt (d3);\n }\n \n-/* { dg-final { scan-assembler-times \"vxorps\\[^\\n\\r\\]*xmm\\[0-9\\]\" 1 } } */\n+/* { dg-final { scan-assembler-times \"vxorps\\[^\\n\\r\\]*xmm\\[0-9\\]\" 0 } } */"}, {"sha": "e069f874f72537a5236a27836fd37e87626b4e7f", "filename": "gcc/tree-vect-stmts.c", "status": "modified", "additions": 0, "deletions": 9, "changes": 9, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/783dc66f9ccb0019c3dad2701bb9110286758d70/gcc%2Ftree-vect-stmts.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/783dc66f9ccb0019c3dad2701bb9110286758d70/gcc%2Ftree-vect-stmts.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftree-vect-stmts.c?ref=783dc66f9ccb0019c3dad2701bb9110286758d70", "patch": "@@ -9853,15 +9853,6 @@ vectorizable_condition (vec_info *vinfo,\n     {\n       if (STMT_VINFO_DEF_TYPE (stmt_info) != vect_internal_def)\n \treturn false;\n-\n-      /* FORNOW: only supported as part of a reduction.  */\n-      if (loop_vinfo && STMT_VINFO_LIVE_P (stmt_info))\n-\t{\n-\t  if (dump_enabled_p ())\n-\t    dump_printf_loc (MSG_MISSED_OPTIMIZATION, vect_location,\n-\t\t\t     \"value used after loop.\\n\");\n-\t  return false;\n-\t}\n     }\n \n   tree vectype = STMT_VINFO_VECTYPE (stmt_info);"}]}