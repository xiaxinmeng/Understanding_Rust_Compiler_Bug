{"sha": "b246f5272eb7242a9cefe5b4e7220be9d86ea512", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6YjI0NmY1MjcyZWI3MjQyYTljZWZlNWI0ZTcyMjBiZTlkODZlYTUxMg==", "commit": {"author": {"name": "Richard Biener", "email": "rguenther@suse.de", "date": "2020-09-03T10:44:40Z"}, "committer": {"name": "Richard Biener", "email": "rguenther@suse.de", "date": "2020-09-03T10:47:59Z"}, "message": "Improve constant folding of vector lowering with vector bools\n\nThis improves the situation somewhat when vector lowering tries\nto access vector bools as seen in PR96814.\n\n2020-09-03  Richard Biener  <rguenther@suse.de>\n\n\t* tree-vect-generic.c (tree_vec_extract): Remove odd\n\tspecial-casing of boolean vectors.\n\t* fold-const.c (fold_ternary_loc): Handle boolean vector\n\ttype BIT_FIELD_REFs.", "tree": {"sha": "1f7a696836df0185d80f2ec8e97961107f414ea1", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/1f7a696836df0185d80f2ec8e97961107f414ea1"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/b246f5272eb7242a9cefe5b4e7220be9d86ea512", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/b246f5272eb7242a9cefe5b4e7220be9d86ea512", "html_url": "https://github.com/Rust-GCC/gccrs/commit/b246f5272eb7242a9cefe5b4e7220be9d86ea512", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/b246f5272eb7242a9cefe5b4e7220be9d86ea512/comments", "author": {"login": "rguenth", "id": 2046526, "node_id": "MDQ6VXNlcjIwNDY1MjY=", "avatar_url": "https://avatars.githubusercontent.com/u/2046526?v=4", "gravatar_id": "", "url": "https://api.github.com/users/rguenth", "html_url": "https://github.com/rguenth", "followers_url": "https://api.github.com/users/rguenth/followers", "following_url": "https://api.github.com/users/rguenth/following{/other_user}", "gists_url": "https://api.github.com/users/rguenth/gists{/gist_id}", "starred_url": "https://api.github.com/users/rguenth/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/rguenth/subscriptions", "organizations_url": "https://api.github.com/users/rguenth/orgs", "repos_url": "https://api.github.com/users/rguenth/repos", "events_url": "https://api.github.com/users/rguenth/events{/privacy}", "received_events_url": "https://api.github.com/users/rguenth/received_events", "type": "User", "site_admin": false}, "committer": {"login": "rguenth", "id": 2046526, "node_id": "MDQ6VXNlcjIwNDY1MjY=", "avatar_url": "https://avatars.githubusercontent.com/u/2046526?v=4", "gravatar_id": "", "url": "https://api.github.com/users/rguenth", "html_url": "https://github.com/rguenth", "followers_url": "https://api.github.com/users/rguenth/followers", "following_url": "https://api.github.com/users/rguenth/following{/other_user}", "gists_url": "https://api.github.com/users/rguenth/gists{/gist_id}", "starred_url": "https://api.github.com/users/rguenth/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/rguenth/subscriptions", "organizations_url": "https://api.github.com/users/rguenth/orgs", "repos_url": "https://api.github.com/users/rguenth/repos", "events_url": "https://api.github.com/users/rguenth/events{/privacy}", "received_events_url": "https://api.github.com/users/rguenth/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "3cc3a373fe5ceb66839daca6861188d04c98362e", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/3cc3a373fe5ceb66839daca6861188d04c98362e", "html_url": "https://github.com/Rust-GCC/gccrs/commit/3cc3a373fe5ceb66839daca6861188d04c98362e"}], "stats": {"total": 18, "additions": 4, "deletions": 14}, "files": [{"sha": "0cc80adf632fa3a5482780a41b682c258ee11afb", "filename": "gcc/fold-const.c", "status": "modified", "additions": 3, "deletions": 1, "changes": 4, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/b246f5272eb7242a9cefe5b4e7220be9d86ea512/gcc%2Ffold-const.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/b246f5272eb7242a9cefe5b4e7220be9d86ea512/gcc%2Ffold-const.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ffold-const.c?ref=b246f5272eb7242a9cefe5b4e7220be9d86ea512", "patch": "@@ -12581,7 +12581,9 @@ fold_ternary_loc (location_t loc, enum tree_code code, tree type,\n \t  && tree_fits_uhwi_p (op2))\n \t{\n \t  tree eltype = TREE_TYPE (TREE_TYPE (arg0));\n-\t  unsigned HOST_WIDE_INT width = tree_to_uhwi (TYPE_SIZE (eltype));\n+\t  unsigned HOST_WIDE_INT width\n+\t    = (TREE_CODE (eltype) == BOOLEAN_TYPE\n+\t       ? TYPE_PRECISION (eltype) : tree_to_uhwi (TYPE_SIZE (eltype)));\n \t  unsigned HOST_WIDE_INT n = tree_to_uhwi (arg1);\n \t  unsigned HOST_WIDE_INT idx = tree_to_uhwi (op2);\n "}, {"sha": "d7bafa77134079faf743c1b482251311abb681c5", "filename": "gcc/tree-vect-generic.c", "status": "modified", "additions": 1, "deletions": 13, "changes": 14, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/b246f5272eb7242a9cefe5b4e7220be9d86ea512/gcc%2Ftree-vect-generic.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/b246f5272eb7242a9cefe5b4e7220be9d86ea512/gcc%2Ftree-vect-generic.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftree-vect-generic.c?ref=b246f5272eb7242a9cefe5b4e7220be9d86ea512", "patch": "@@ -136,19 +136,7 @@ tree_vec_extract (gimple_stmt_iterator *gsi, tree type,\n \tt = gimple_assign_rhs1 (def_stmt);\n     }\n   if (bitpos)\n-    {\n-      if (TREE_CODE (type) == BOOLEAN_TYPE)\n-\t{\n-\t  tree itype\n-\t    = build_nonstandard_integer_type (tree_to_uhwi (bitsize), 0);\n-\t  tree field = gimplify_build3 (gsi, BIT_FIELD_REF, itype, t,\n-\t\t\t\t\tbitsize, bitpos);\n-\t  return gimplify_build2 (gsi, NE_EXPR, type, field,\n-\t\t\t\t  build_zero_cst (itype));\n-\t}\n-      else\n-\treturn gimplify_build3 (gsi, BIT_FIELD_REF, type, t, bitsize, bitpos);\n-    }\n+    return gimplify_build3 (gsi, BIT_FIELD_REF, type, t, bitsize, bitpos);\n   else\n     return gimplify_build1 (gsi, VIEW_CONVERT_EXPR, type, t);\n }"}]}