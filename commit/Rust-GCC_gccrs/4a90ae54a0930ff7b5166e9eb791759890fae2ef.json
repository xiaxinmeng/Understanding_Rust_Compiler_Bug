{"sha": "4a90ae54a0930ff7b5166e9eb791759890fae2ef", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6NGE5MGFlNTRhMDkzMGZmN2I1MTY2ZTllYjc5MTc1OTg5MGZhZTJlZg==", "commit": {"author": {"name": "Feng Wang", "email": "fengwang@gcc.gnu.org", "date": "2005-07-14T01:37:41Z"}, "committer": {"name": "Feng Wang", "email": "fengwang@gcc.gnu.org", "date": "2005-07-14T01:37:41Z"}, "message": "[multiple changes]\n\n2005-07-14  Steven G. Kargl  <kargls@comcast.net>\n\n\t* gfortran.dg/char_array_constructor.f90: New test.\n\n2005-07-14  Feng Wang  <fengwang@nudt.edu.cn>\n\tSteven G. Kargl  <kargls@comcast.net>\n\n\t* array.c (resolve_character_array_constructor): Allocate gfc_charlen\n\tfor the array and attach to namespace list for automatic deallocation.\n\nFrom-SVN: r102002", "tree": {"sha": "407dbe2a3bb86005b9a7c59cb103c30859bc4c21", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/407dbe2a3bb86005b9a7c59cb103c30859bc4c21"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/4a90ae54a0930ff7b5166e9eb791759890fae2ef", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/4a90ae54a0930ff7b5166e9eb791759890fae2ef", "html_url": "https://github.com/Rust-GCC/gccrs/commit/4a90ae54a0930ff7b5166e9eb791759890fae2ef", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/4a90ae54a0930ff7b5166e9eb791759890fae2ef/comments", "author": null, "committer": null, "parents": [{"sha": "0063a8238d6f2b3cb933cffb33a0b69abfa90674", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/0063a8238d6f2b3cb933cffb33a0b69abfa90674", "html_url": "https://github.com/Rust-GCC/gccrs/commit/0063a8238d6f2b3cb933cffb33a0b69abfa90674"}], "stats": {"total": 36, "additions": 33, "deletions": 3}, "files": [{"sha": "a4897da6434bbbf1513ae87dd4e9bfc45e10fa0b", "filename": "gcc/fortran/ChangeLog", "status": "modified", "additions": 6, "deletions": 0, "changes": 6, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/4a90ae54a0930ff7b5166e9eb791759890fae2ef/gcc%2Ffortran%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/4a90ae54a0930ff7b5166e9eb791759890fae2ef/gcc%2Ffortran%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ffortran%2FChangeLog?ref=4a90ae54a0930ff7b5166e9eb791759890fae2ef", "patch": "@@ -1,3 +1,9 @@\n+2005-07-14  Feng Wang  <fengwang@nudt.edu.cn>\n+\tSteven G. Kargl  <kargls@comcast.net>\n+\n+\t* array.c (resolve_character_array_constructor): Allocate gfc_charlen\n+\tfor the array and attach to namespace list for automatic deallocation.\n+\n 2005-07-13  Andreas Schwab  <schwab@suse.de>\n \n \t* Make-lang.in (fortran/dependency.o): Depend on"}, {"sha": "72b92a8368bd7f0f1aa214fe159cd2f1c95aab3d", "filename": "gcc/fortran/array.c", "status": "modified", "additions": 8, "deletions": 3, "changes": 11, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/4a90ae54a0930ff7b5166e9eb791759890fae2ef/gcc%2Ffortran%2Farray.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/4a90ae54a0930ff7b5166e9eb791759890fae2ef/gcc%2Ffortran%2Farray.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ffortran%2Farray.c?ref=4a90ae54a0930ff7b5166e9eb791759890fae2ef", "patch": "@@ -1529,7 +1529,14 @@ resolve_character_array_constructor (gfc_expr * expr)\n \n   max_length = -1;\n \n-  if (expr->ts.cl == NULL || expr->ts.cl->length == NULL)\n+  if (expr->ts.cl == NULL)\n+    {\n+      expr->ts.cl = gfc_get_charlen ();\n+      expr->ts.cl->next = gfc_current_ns->cl_list;\n+      gfc_current_ns->cl_list = expr->ts.cl;\n+    }\n+\n+  if (expr->ts.cl->length == NULL)\n     {\n       /* Find the maximum length of the elements. Do nothing for variable array\n \t constructor.  */\n@@ -1542,8 +1549,6 @@ resolve_character_array_constructor (gfc_expr * expr)\n       if (max_length != -1)\n \t{\n \t  /* Update the character length of the array constructor.  */\n-\t  if (expr->ts.cl == NULL)\n-\t    expr->ts.cl = gfc_get_charlen ();\n \t  expr->ts.cl->length = gfc_int_expr (max_length);\n \t  /* Update the element constructors.  */\n \t  for (p = expr->value.constructor; p; p = p->next)"}, {"sha": "1c94063bc1bd4899e764593db4f70f61e2ac16a2", "filename": "gcc/testsuite/ChangeLog", "status": "modified", "additions": 4, "deletions": 0, "changes": 4, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/4a90ae54a0930ff7b5166e9eb791759890fae2ef/gcc%2Ftestsuite%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/4a90ae54a0930ff7b5166e9eb791759890fae2ef/gcc%2Ftestsuite%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2FChangeLog?ref=4a90ae54a0930ff7b5166e9eb791759890fae2ef", "patch": "@@ -1,3 +1,7 @@\n+2005-07-14  Steven G. Kargl  <kargls@comcast.net>\n+\n+\t* gfortran.dg/char_array_constructor.f90: New test.\n+\n 2005-07-13  Paul Thomas  <pault@gcc.gnu.org>\n \n \t* gfortran.dg/past_eor.f90: New."}, {"sha": "0cb4d38bf039e35b592cb91f72cab056b1f57159", "filename": "gcc/testsuite/gfortran.dg/char_array_constructor.f90", "status": "added", "additions": 15, "deletions": 0, "changes": 15, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/4a90ae54a0930ff7b5166e9eb791759890fae2ef/gcc%2Ftestsuite%2Fgfortran.dg%2Fchar_array_constructor.f90", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/4a90ae54a0930ff7b5166e9eb791759890fae2ef/gcc%2Ftestsuite%2Fgfortran.dg%2Fchar_array_constructor.f90", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgfortran.dg%2Fchar_array_constructor.f90?ref=4a90ae54a0930ff7b5166e9eb791759890fae2ef", "patch": "@@ -0,0 +1,15 @@\n+! { dg-do run }\n+module z\n+   integer :: i\n+   character(6) :: a(2) = (/ ('main  ' , i = 1, 2) /)\n+   character(6) :: b(2) = (/ 'abcd  ' , 'efghij' /)\n+end module\n+\n+program y\n+  use z\n+  if (a(1) /= 'main  ') call abort\n+  if (a(2) /= 'main  ') call abort\n+  if (b(1) /= 'abcd  ') call abort\n+  if (b(2) /= 'efghij') call abort\n+end program y\n+"}]}