{"sha": "652c28736209f10bac1aa7ecb31f9056b518dacf", "node_id": "C_kwDOANBUbNoAKDY1MmMyODczNjIwOWYxMGJhYzFhYTdlY2IzMWY5MDU2YjUxOGRhY2Y", "commit": {"author": {"name": "Harald Anlauf", "email": "anlauf@gmx.de", "date": "2021-12-07T17:46:52Z"}, "committer": {"name": "Harald Anlauf", "email": "anlauf@gmx.de", "date": "2021-12-07T17:46:52Z"}, "message": "Fortran: catch failed simplification of bad stride expression\n\ngcc/fortran/ChangeLog:\n\n\tPR fortran/103588\n\t* array.c (gfc_ref_dimen_size): Do not generate internal error on\n\tfailed simplification of stride expression; just return failure.\n\ngcc/testsuite/ChangeLog:\n\n\tPR fortran/103588\n\t* gfortran.dg/pr103588.f90: New test.", "tree": {"sha": "19b8c7355a56680f15b2c8393cc57e77558cc33a", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/19b8c7355a56680f15b2c8393cc57e77558cc33a"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/652c28736209f10bac1aa7ecb31f9056b518dacf", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/652c28736209f10bac1aa7ecb31f9056b518dacf", "html_url": "https://github.com/Rust-GCC/gccrs/commit/652c28736209f10bac1aa7ecb31f9056b518dacf", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/652c28736209f10bac1aa7ecb31f9056b518dacf/comments", "author": {"login": "harald-anlauf", "id": 90786862, "node_id": "MDQ6VXNlcjkwNzg2ODYy", "avatar_url": "https://avatars.githubusercontent.com/u/90786862?v=4", "gravatar_id": "", "url": "https://api.github.com/users/harald-anlauf", "html_url": "https://github.com/harald-anlauf", "followers_url": "https://api.github.com/users/harald-anlauf/followers", "following_url": "https://api.github.com/users/harald-anlauf/following{/other_user}", "gists_url": "https://api.github.com/users/harald-anlauf/gists{/gist_id}", "starred_url": "https://api.github.com/users/harald-anlauf/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/harald-anlauf/subscriptions", "organizations_url": "https://api.github.com/users/harald-anlauf/orgs", "repos_url": "https://api.github.com/users/harald-anlauf/repos", "events_url": "https://api.github.com/users/harald-anlauf/events{/privacy}", "received_events_url": "https://api.github.com/users/harald-anlauf/received_events", "type": "User", "site_admin": false}, "committer": {"login": "harald-anlauf", "id": 90786862, "node_id": "MDQ6VXNlcjkwNzg2ODYy", "avatar_url": "https://avatars.githubusercontent.com/u/90786862?v=4", "gravatar_id": "", "url": "https://api.github.com/users/harald-anlauf", "html_url": "https://github.com/harald-anlauf", "followers_url": "https://api.github.com/users/harald-anlauf/followers", "following_url": "https://api.github.com/users/harald-anlauf/following{/other_user}", "gists_url": "https://api.github.com/users/harald-anlauf/gists{/gist_id}", "starred_url": "https://api.github.com/users/harald-anlauf/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/harald-anlauf/subscriptions", "organizations_url": "https://api.github.com/users/harald-anlauf/orgs", "repos_url": "https://api.github.com/users/harald-anlauf/repos", "events_url": "https://api.github.com/users/harald-anlauf/events{/privacy}", "received_events_url": "https://api.github.com/users/harald-anlauf/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "f47662204de27f7685699eeef89aa173ccf32d85", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/f47662204de27f7685699eeef89aa173ccf32d85", "html_url": "https://github.com/Rust-GCC/gccrs/commit/f47662204de27f7685699eeef89aa173ccf32d85"}], "stats": {"total": 17, "additions": 12, "deletions": 5}, "files": [{"sha": "e5e220994054ea565f51a64094c585d6780469b9", "filename": "gcc/fortran/array.c", "status": "modified", "additions": 4, "deletions": 5, "changes": 9, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/652c28736209f10bac1aa7ecb31f9056b518dacf/gcc%2Ffortran%2Farray.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/652c28736209f10bac1aa7ecb31f9056b518dacf/gcc%2Ffortran%2Farray.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ffortran%2Farray.c?ref=652c28736209f10bac1aa7ecb31f9056b518dacf", "patch": "@@ -2403,12 +2403,11 @@ gfc_ref_dimen_size (gfc_array_ref *ar, int dimen, mpz_t *result, mpz_t *end)\n \t{\n \t  stride_expr = gfc_copy_expr(ar->stride[dimen]); \n \n-\t  if(!gfc_simplify_expr(stride_expr, 1))\n-\t    gfc_internal_error(\"Simplification error\");\n-\n-\t  if (stride_expr->expr_type != EXPR_CONSTANT\n-\t      || mpz_cmp_ui (stride_expr->value.integer, 0) == 0)\n+\t  if (!gfc_simplify_expr (stride_expr, 1)\n+\t     || stride_expr->expr_type != EXPR_CONSTANT\n+\t     || mpz_cmp_ui (stride_expr->value.integer, 0) == 0)\n \t    {\n+\t      gfc_free_expr (stride_expr);\n \t      mpz_clear (stride);\n \t      return false;\n \t    }"}, {"sha": "198e1766cd29aef5a00d40c68d962eef31a3dac8", "filename": "gcc/testsuite/gfortran.dg/pr103588.f90", "status": "added", "additions": 8, "deletions": 0, "changes": 8, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/652c28736209f10bac1aa7ecb31f9056b518dacf/gcc%2Ftestsuite%2Fgfortran.dg%2Fpr103588.f90", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/652c28736209f10bac1aa7ecb31f9056b518dacf/gcc%2Ftestsuite%2Fgfortran.dg%2Fpr103588.f90", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgfortran.dg%2Fpr103588.f90?ref=652c28736209f10bac1aa7ecb31f9056b518dacf", "patch": "@@ -0,0 +1,8 @@\n+! { dg-do compile }\n+! PR fortran/103588 - ICE: Simplification error in gfc_ref_dimen_size\n+! Contributed by G.Steinmetz\n+\n+program p\n+  integer, parameter :: a(:) = [1,2] ! { dg-error \"cannot be automatic or of deferred shape\" }\n+  integer :: b(2) = a(::a(1))        ! { dg-error \"Invalid\" }\n+end"}]}