{"sha": "d300615539796bd95ab74ca982a682471ce4b9fe", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6ZDMwMDYxNTUzOTc5NmJkOTVhYjc0Y2E5ODJhNjgyNDcxY2U0YjlmZQ==", "commit": {"author": {"name": "Matthias Klose", "email": "doko@gcc.gnu.org", "date": "2017-05-18T18:49:16Z"}, "committer": {"name": "Matthias Klose", "email": "doko@gcc.gnu.org", "date": "2017-05-18T18:49:16Z"}, "message": "gcc_release (build_gzip): Build xz tarball instead of bz2 tarball.\n\n2017-05-18  Matthias Klose  <doko@ubuntu.com>\n\n        * gcc_release (build_gzip): Build xz tarball instead of bz2 tarball.\n        (build_diffs): Handle building diffs from either bz2 or xz tarballs,\n        compress diffs using xz instead of bz2.\n        (build_diff): Likewise.\n        (upload_files): Check for *.xz files instead of *.bz2 files.\n        (announce_snapshot): Announce xz tarball instead of bz2 tarball.\n        (XZ): New definition.\n        (<toplevel>): Look for both bz2 and xz compressed old tarballs.\n\nFrom-SVN: r248251", "tree": {"sha": "e9da82f45dbca3e1f6f956da541f0b8faccbc562", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/e9da82f45dbca3e1f6f956da541f0b8faccbc562"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/d300615539796bd95ab74ca982a682471ce4b9fe", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/d300615539796bd95ab74ca982a682471ce4b9fe", "html_url": "https://github.com/Rust-GCC/gccrs/commit/d300615539796bd95ab74ca982a682471ce4b9fe", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/d300615539796bd95ab74ca982a682471ce4b9fe/comments", "author": null, "committer": null, "parents": [{"sha": "1bf07cc3ff38a893fd8daa248e834e9dac567b88", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/1bf07cc3ff38a893fd8daa248e834e9dac567b88", "html_url": "https://github.com/Rust-GCC/gccrs/commit/1bf07cc3ff38a893fd8daa248e834e9dac567b88"}], "stats": {"total": 63, "additions": 46, "deletions": 17}, "files": [{"sha": "c328ee83666c50b26f86099ab2cd7b2894095c34", "filename": "maintainer-scripts/ChangeLog", "status": "modified", "additions": 12, "deletions": 1, "changes": 13, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/d300615539796bd95ab74ca982a682471ce4b9fe/maintainer-scripts%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/d300615539796bd95ab74ca982a682471ce4b9fe/maintainer-scripts%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/maintainer-scripts%2FChangeLog?ref=d300615539796bd95ab74ca982a682471ce4b9fe", "patch": "@@ -1,3 +1,14 @@\n+2017-05-18  Matthias Klose  <doko@ubuntu.com>\n+\n+\t* gcc_release (build_gzip): Build xz tarball instead of bz2 tarball.\n+\t(build_diffs): Handle building diffs from either bz2 or xz tarballs,\n+\tcompress diffs using xz instead of bz2.\n+\t(build_diff): Likewise.\n+\t(upload_files): Check for *.xz files instead of *.bz2 files.\n+\t(announce_snapshot): Announce xz tarball instead of bz2 tarball.\n+\t(XZ): New definition.\n+\t(<toplevel>): Look for both bz2 and xz compressed old tarballs.\n+\n 2017-04-20  Jakub Jelinek  <jakub@redhat.com>\n \n \t* crontab: Enable snapshots from gcc-7-branch.\n@@ -19,7 +30,7 @@\n \n 2016-09-04  Gerald Pfeifer  <gerald@pfeifer.com>\n \n-\tPR documentation/50642 \n+\tPR documentation/50642\n \t* update_web_docs_svn (CSS): Introduce.\n \tHave generated files refer to it.\n "}, {"sha": "142f99c085f1296aa7b09b5c4dd7be9460544b49", "filename": "maintainer-scripts/gcc_release", "status": "modified", "additions": 34, "deletions": 16, "changes": 50, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/d300615539796bd95ab74ca982a682471ce4b9fe/maintainer-scripts%2Fgcc_release", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/d300615539796bd95ab74ca982a682471ce4b9fe/maintainer-scripts%2Fgcc_release", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/maintainer-scripts%2Fgcc_release?ref=d300615539796bd95ab74ca982a682471ce4b9fe", "patch": "@@ -221,7 +221,7 @@ EOF\n   # Create a \"MD5SUMS\" file to use for checking the validity of the release.\n   echo \\\n \"# This file contains the MD5 checksums of the files in the \n-# gcc-\"${RELEASE}\".tar.bz2 tarball.\n+# gcc-\"${RELEASE}\".tar.xz tarball.\n #\n # Besides verifying that all files in the tarball were correctly expanded,\n # it also can be used to determine if any files have changed since the\n@@ -244,11 +244,11 @@ EOF\n \n build_tarfile() {\n   # Get the name of the destination tar file.\n-  TARFILE=\"$1.tar.bz2\"\n+  TARFILE=\"$1.tar.xz\"\n   shift\n \n   # Build the tar file itself.\n-  (${TAR} cf - \"$@\" | ${BZIP2} > ${TARFILE}) || \\\n+  (${TAR} cf - \"$@\" | ${XZ} > ${TARFILE}) || \\\n     error \"Could not build tarfile\"\n   FILE_LIST=\"${FILE_LIST} ${TARFILE}\"\n }\n@@ -273,28 +273,35 @@ build_tarfiles() {\n # Build .gz files.\n build_gzip() {\n   for f in ${FILE_LIST}; do\n-    target=${f%.bz2}.gz\n-    (${BZIP2} -d -c $f | ${GZIP} > ${target}) || error \"Could not create ${target}\"\n+    target=${f%.xz}.gz\n+    (${XZ} -d -c $f | ${GZIP} > ${target}) || error \"Could not create ${target}\"\n   done\n }\n \n # Build diffs against an old release.\n build_diffs() {\n   old_dir=${1%/*}\n   old_file=${1##*/}\n-  old_vers=${old_file%.tar.bz2}\n+  case \"$old_file\" in\n+    *.tar.xz) old_vers=${old_file%.tar.xz};;\n+    *) old_vers=${old_file%.tar.bz2};;\n+  esac\n   old_vers=${old_vers#gcc-}\n   inform \"Building diffs against version $old_vers\"\n   for f in gcc; do\n-    old_tar=${old_dir}/${f}-${old_vers}.tar.bz2\n-    new_tar=${WORKING_DIRECTORY}/${f}-${RELEASE}.tar.bz2\n+    if [ -e ${old_dir}/${f}-${old_vers}.tar.xz ]; then\n+      old_tar=${old_dir}/${f}-${old_vers}.tar.xz\n+    else\n+      old_tar=${old_dir}/${f}-${old_vers}.tar.bz2\n+    fi\n+    new_tar=${WORKING_DIRECTORY}/${f}-${RELEASE}.tar.xz\n     if [ ! -e $old_tar ]; then\n       inform \"$old_tar not found; not generating diff file\"\n     elif [ ! -e $new_tar ]; then\n       inform \"$new_tar not found; not generating diff file\"\n     else\n       build_diff $old_tar gcc-${old_vers} $new_tar gcc-${RELEASE} \\\n-        ${f}-${old_vers}-${RELEASE}.diff.bz2\n+        ${f}-${old_vers}-${RELEASE}.diff.xz\n     fi\n   done\n }\n@@ -305,13 +312,20 @@ build_diff() {\n   tmpdir=gccdiff.$$\n   mkdir $tmpdir || error \"Could not create directory $tmpdir\"\n   changedir $tmpdir\n-  (${BZIP2} -d -c $1 | ${TAR} xf - ) || error \"Could not unpack $1 for diffs\"\n-  (${BZIP2} -d -c $3 | ${TAR} xf - ) || error \"Could not unpack $3 for diffs\"\n-  ${DIFF} $2 $4 > ../${5%.bz2}\n+  case \"$1\" in\n+    *.tar.bz2)\n+      (${BZIP2} -d -c $1 | ${TAR} xf - ) || error \"Could not unpack $1 for diffs\"\n+      ;;\n+    *.tar.xz)\n+      (${XZ} -d -c $1 | ${TAR} xf - ) || error \"Could not unpack $1 for diffs\"\n+      ;;\n+  esac\n+  (${XZ} -d -c $3 | ${TAR} xf - ) || error \"Could not unpack $3 for diffs\"\n+  ${DIFF} $2 $4 > ../${5%.xz}\n   if [ $? -eq 2 ]; then\n     error \"Trouble making diffs from $1 to $3\"\n   fi\n-  ${BZIP2} ../${5%.bz2} || error \"Could not generate ../$5\"\n+  ${XZ} ../${5%.xz} || error \"Could not generate ../$5\"\n   changedir ..\n   rm -rf $tmpdir\n   FILE_LIST=\"${FILE_LIST} $5\"\n@@ -335,7 +349,7 @@ upload_files() {\n   fi\n \n   # Then copy files to their respective (sub)directories.\n-  for x in gcc*.gz gcc*.bz2; do\n+  for x in gcc*.gz gcc*.xz; do\n     if [ -e ${x} ]; then\n       # Make sure the file will be readable on the server.\n       chmod a+r ${x}\n@@ -410,7 +424,7 @@ with the following options: <code>\"svn://gcc.gnu.org/svn/gcc/${SVNBRANCH} revisi\n \n <table>\" > ${SNAPSHOT_INDEX}\n        \n-  snapshot_print gcc-${RELEASE}.tar.bz2 \"Complete GCC\"\n+  snapshot_print gcc-${RELEASE}.tar.xz \"Complete GCC\"\n \n   echo \\\n \"Diffs from \"${BRANCH}\"-\"${LAST_DATE}\" are available in the diffs/ subdirectory.\n@@ -528,12 +542,13 @@ MODE_SOURCES=0\n MODE_TARFILES=0\n MODE_UPLOAD=0\n \n-# List of archive files generated; used to create .gz files from .bz2.\n+# List of archive files generated; used to create .gz files from .xz.\n FILE_LIST=\"\"\n \n # Programs we use.\n \n BZIP2=\"${BZIP2:-bzip2}\"\n+XZ=\"${XZ:-xz}\"\n CVS=\"${CVS:-cvs -f -Q -z9}\"\n DIFF=\"${DIFF:-diff -Nrcpad}\"\n ENV=\"${ENV:-env}\"\n@@ -644,6 +659,9 @@ else\n   if [ $MODE_DIFFS -ne 0 ] && [ $LOCAL -ne 0 ] && [ -z \"${OLD_TARS}\" ]; then\n     LAST_DATE=`cat ~/.snapshot_date-${BRANCH}`\n     OLD_TARS=${SNAPSHOTS_DIR}/${BRANCH}-${LAST_DATE}/gcc-${BRANCH}-${LAST_DATE}.tar.bz2\n+    if [ ! -e $OLD_TARS ]; then\n+      OLD_TARS=${SNAPSHOTS_DIR}/${BRANCH}-${LAST_DATE}/gcc-${BRANCH}-${LAST_DATE}.tar.xz\n+    fi\n   fi\n fi\n "}]}