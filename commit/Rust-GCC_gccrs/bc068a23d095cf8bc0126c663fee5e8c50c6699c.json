{"sha": "bc068a23d095cf8bc0126c663fee5e8c50c6699c", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6YmMwNjhhMjNkMDk1Y2Y4YmMwMTI2YzY2M2ZlZTVlOGM1MGM2Njk5Yw==", "commit": {"author": {"name": "Changpeng Fang", "email": "changpeng.fang@amd.com", "date": "2010-08-23T17:45:08Z"}, "committer": {"name": "Changpeng Fang", "email": "cfang@gcc.gnu.org", "date": "2010-08-23T17:45:08Z"}, "message": "pr45260 Don't generate prefetch if the address of base could not be taken.\n\n\t* tree-flow.h (may_be_nonaddressable_p): New definition. Make the\n\texisting static function global.\n\n\t*tree-ssa-loop-ivopts.c (may_be_nonaddressable_p): This function\n\tis changed to global.\n\n\t*tree-ssa-loop-prefetch.c (gather_memory_references_ref): Call\n\tmay_be_nonaddressable_p on base, and don't collect this reference\n\tif the address of the base could not be taken.\n\nFrom-SVN: r163475", "tree": {"sha": "9db10ff1386e8c9e1c0147f462aacb0ee6eaab28", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/9db10ff1386e8c9e1c0147f462aacb0ee6eaab28"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/bc068a23d095cf8bc0126c663fee5e8c50c6699c", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/bc068a23d095cf8bc0126c663fee5e8c50c6699c", "html_url": "https://github.com/Rust-GCC/gccrs/commit/bc068a23d095cf8bc0126c663fee5e8c50c6699c", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/bc068a23d095cf8bc0126c663fee5e8c50c6699c/comments", "author": {"login": "changpeng", "id": 4239661, "node_id": "MDQ6VXNlcjQyMzk2NjE=", "avatar_url": "https://avatars.githubusercontent.com/u/4239661?v=4", "gravatar_id": "", "url": "https://api.github.com/users/changpeng", "html_url": "https://github.com/changpeng", "followers_url": "https://api.github.com/users/changpeng/followers", "following_url": "https://api.github.com/users/changpeng/following{/other_user}", "gists_url": "https://api.github.com/users/changpeng/gists{/gist_id}", "starred_url": "https://api.github.com/users/changpeng/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/changpeng/subscriptions", "organizations_url": "https://api.github.com/users/changpeng/orgs", "repos_url": "https://api.github.com/users/changpeng/repos", "events_url": "https://api.github.com/users/changpeng/events{/privacy}", "received_events_url": "https://api.github.com/users/changpeng/received_events", "type": "User", "site_admin": false}, "committer": null, "parents": [{"sha": "f8895c4b7f7014fa8daf1d71e3c33c9bf933db97", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/f8895c4b7f7014fa8daf1d71e3c33c9bf933db97", "html_url": "https://github.com/Rust-GCC/gccrs/commit/f8895c4b7f7014fa8daf1d71e3c33c9bf933db97"}], "stats": {"total": 19, "additions": 18, "deletions": 1}, "files": [{"sha": "dac6ea85fbaf8d4ff9f531be6e1b37b60cb406ca", "filename": "gcc/ChangeLog", "status": "modified", "additions": 12, "deletions": 0, "changes": 12, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/bc068a23d095cf8bc0126c663fee5e8c50c6699c/gcc%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/bc068a23d095cf8bc0126c663fee5e8c50c6699c/gcc%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2FChangeLog?ref=bc068a23d095cf8bc0126c663fee5e8c50c6699c", "patch": "@@ -1,3 +1,15 @@\n+2010-08-23  Changpeng Fang  <changpeng.fang@amd.com>\n+\n+\t* tree-flow.h (may_be_nonaddressable_p): New definition. Make the\n+\texisting static function global.\n+\n+\t*tree-ssa-loop-ivopts.c (may_be_nonaddressable_p): This function\n+\tis changed to global.\n+\n+\t*tree-ssa-loop-prefetch.c (gather_memory_references_ref): Call\n+\tmay_be_nonaddressable_p on base, and don't collect this reference\n+\tif the address of the base could not be taken.\n+\n 2010-08-23  Michael Meissner  <meissner@linux.vnet.ibm.com>\n \n \t* config/rs6000/rs6000.opt (-mveclibabi=mass): New option to"}, {"sha": "67313088ffdf75357e0c6bd6f4262daa24a4ddc9", "filename": "gcc/tree-flow.h", "status": "modified", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/bc068a23d095cf8bc0126c663fee5e8c50c6699c/gcc%2Ftree-flow.h", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/bc068a23d095cf8bc0126c663fee5e8c50c6699c/gcc%2Ftree-flow.h", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftree-flow.h?ref=bc068a23d095cf8bc0126c663fee5e8c50c6699c", "patch": "@@ -817,6 +817,7 @@ bool stmt_invariant_in_loop_p (struct loop *, gimple);\n bool multiplier_allowed_in_address_p (HOST_WIDE_INT, enum machine_mode,\n \t\t\t\t      addr_space_t);\n unsigned multiply_by_cost (HOST_WIDE_INT, enum machine_mode, bool);\n+bool may_be_nonaddressable_p (tree expr);\n \n /* In tree-ssa-threadupdate.c.  */\n extern bool thread_through_all_blocks (bool);"}, {"sha": "0029c762687e73a803f42dca8cfadd4ca41959ad", "filename": "gcc/tree-ssa-loop-ivopts.c", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/bc068a23d095cf8bc0126c663fee5e8c50c6699c/gcc%2Ftree-ssa-loop-ivopts.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/bc068a23d095cf8bc0126c663fee5e8c50c6699c/gcc%2Ftree-ssa-loop-ivopts.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftree-ssa-loop-ivopts.c?ref=bc068a23d095cf8bc0126c663fee5e8c50c6699c", "patch": "@@ -1640,7 +1640,7 @@ may_be_unaligned_p (tree ref, tree step)\n \n /* Return true if EXPR may be non-addressable.   */\n \n-static bool\n+bool\n may_be_nonaddressable_p (tree expr)\n {\n   switch (TREE_CODE (expr))"}, {"sha": "4e7068f18593eb24e18ac99733ae8b0e0852f772", "filename": "gcc/tree-ssa-loop-prefetch.c", "status": "modified", "additions": 4, "deletions": 0, "changes": 4, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/bc068a23d095cf8bc0126c663fee5e8c50c6699c/gcc%2Ftree-ssa-loop-prefetch.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/bc068a23d095cf8bc0126c663fee5e8c50c6699c/gcc%2Ftree-ssa-loop-prefetch.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftree-ssa-loop-prefetch.c?ref=bc068a23d095cf8bc0126c663fee5e8c50c6699c", "patch": "@@ -539,6 +539,10 @@ gather_memory_references_ref (struct loop *loop, struct mem_ref_group **refs,\n   if (step == NULL_TREE)\n     return false;\n \n+  /* Stop if the address of BASE could not taken.  */\n+  if (may_be_nonaddressable_p (base))\n+    return false;\n+\n   /* Limit non-constant step prefetching only to the innermost loops.  */\n   if (!cst_and_fits_in_hwi (step) && loop->inner != NULL)\n     return false;"}]}