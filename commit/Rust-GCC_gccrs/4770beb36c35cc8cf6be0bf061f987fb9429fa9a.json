{"sha": "4770beb36c35cc8cf6be0bf061f987fb9429fa9a", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6NDc3MGJlYjM2YzM1Y2M4Y2Y2YmUwYmYwNjFmOTg3ZmI5NDI5ZmE5YQ==", "commit": {"author": {"name": "Marek Polacek", "email": "polacek@redhat.com", "date": "2019-02-22T19:24:37Z"}, "committer": {"name": "Marek Polacek", "email": "mpolacek@gcc.gnu.org", "date": "2019-02-22T19:24:37Z"}, "message": "PR c++/89420 - ICE with CAST_EXPR in explicit-specifier.\n\n\t* decl.c (build_explicit_specifier): Don't check\n\tprocessing_template_decl.  Call instantiation_dependent_expression_p\n\tinstead of value_dependent_expression_p.  Call\n\tinstantiate_non_dependent_expr_sfinae before\n\tbuild_converted_constant_expr instead of calling\n\tinstantiate_non_dependent_expr after it.  Add\n\tprocessing_template_decl_sentinel.\n\n\t* g++.dg/cpp2a/explicit14.C: New test.\n\nFrom-SVN: r269131", "tree": {"sha": "847b766bd496cefd3030185c4117303caa676190", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/847b766bd496cefd3030185c4117303caa676190"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/4770beb36c35cc8cf6be0bf061f987fb9429fa9a", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/4770beb36c35cc8cf6be0bf061f987fb9429fa9a", "html_url": "https://github.com/Rust-GCC/gccrs/commit/4770beb36c35cc8cf6be0bf061f987fb9429fa9a", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/4770beb36c35cc8cf6be0bf061f987fb9429fa9a/comments", "author": {"login": "mpolacek", "id": 10496300, "node_id": "MDQ6VXNlcjEwNDk2MzAw", "avatar_url": "https://avatars.githubusercontent.com/u/10496300?v=4", "gravatar_id": "", "url": "https://api.github.com/users/mpolacek", "html_url": "https://github.com/mpolacek", "followers_url": "https://api.github.com/users/mpolacek/followers", "following_url": "https://api.github.com/users/mpolacek/following{/other_user}", "gists_url": "https://api.github.com/users/mpolacek/gists{/gist_id}", "starred_url": "https://api.github.com/users/mpolacek/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/mpolacek/subscriptions", "organizations_url": "https://api.github.com/users/mpolacek/orgs", "repos_url": "https://api.github.com/users/mpolacek/repos", "events_url": "https://api.github.com/users/mpolacek/events{/privacy}", "received_events_url": "https://api.github.com/users/mpolacek/received_events", "type": "User", "site_admin": false}, "committer": null, "parents": [{"sha": "fcb141ac220aabc330dff94cb343a9a39da810c3", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/fcb141ac220aabc330dff94cb343a9a39da810c3", "html_url": "https://github.com/Rust-GCC/gccrs/commit/fcb141ac220aabc330dff94cb343a9a39da810c3"}], "stats": {"total": 33, "additions": 31, "deletions": 2}, "files": [{"sha": "838139196093f233aaead7b5ec54027ba3f0c261", "filename": "gcc/cp/ChangeLog", "status": "modified", "additions": 11, "deletions": 0, "changes": 11, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/4770beb36c35cc8cf6be0bf061f987fb9429fa9a/gcc%2Fcp%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/4770beb36c35cc8cf6be0bf061f987fb9429fa9a/gcc%2Fcp%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fcp%2FChangeLog?ref=4770beb36c35cc8cf6be0bf061f987fb9429fa9a", "patch": "@@ -1,3 +1,14 @@\n+2019-02-22  Marek Polacek  <polacek@redhat.com>\n+\n+\tPR c++/89420 - ICE with CAST_EXPR in explicit-specifier.\n+\t* decl.c (build_explicit_specifier): Don't check\n+\tprocessing_template_decl.  Call instantiation_dependent_expression_p\n+\tinstead of value_dependent_expression_p.  Call\n+\tinstantiate_non_dependent_expr_sfinae before\n+\tbuild_converted_constant_expr instead of calling\n+\tinstantiate_non_dependent_expr after it.  Add\n+\tprocessing_template_decl_sentinel.\n+\n 2019-02-22  Thomas Schwinge  <thomas@codesourcery.com>\n \n \t* parser.c (cp_parser_oacc_simple_clause): Remove parser formal"}, {"sha": "c5b5bd3ce08c59521d124509e939b287c88290b1", "filename": "gcc/cp/decl.c", "status": "modified", "additions": 4, "deletions": 2, "changes": 6, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/4770beb36c35cc8cf6be0bf061f987fb9429fa9a/gcc%2Fcp%2Fdecl.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/4770beb36c35cc8cf6be0bf061f987fb9429fa9a/gcc%2Fcp%2Fdecl.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fcp%2Fdecl.c?ref=4770beb36c35cc8cf6be0bf061f987fb9429fa9a", "patch": "@@ -16687,12 +16687,14 @@ require_deduced_type (tree decl, tsubst_flags_t complain)\n tree\n build_explicit_specifier (tree expr, tsubst_flags_t complain)\n {\n-  if (processing_template_decl && value_dependent_expression_p (expr))\n+  if (instantiation_dependent_expression_p (expr))\n     /* Wait for instantiation, tsubst_function_decl will handle it.  */\n     return expr;\n \n+  expr = instantiate_non_dependent_expr_sfinae (expr, complain);\n+  /* Don't let convert_like_real create more template codes.  */\n+  processing_template_decl_sentinel s;\n   expr = build_converted_constant_expr (boolean_type_node, expr, complain);\n-  expr = instantiate_non_dependent_expr (expr);\n   expr = cxx_constant_value (expr);\n   return expr;\n }"}, {"sha": "9fae9ffa169033f10aeb8241b37461188dc30f4f", "filename": "gcc/testsuite/ChangeLog", "status": "modified", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/4770beb36c35cc8cf6be0bf061f987fb9429fa9a/gcc%2Ftestsuite%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/4770beb36c35cc8cf6be0bf061f987fb9429fa9a/gcc%2Ftestsuite%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2FChangeLog?ref=4770beb36c35cc8cf6be0bf061f987fb9429fa9a", "patch": "@@ -1,3 +1,8 @@\n+2019-02-22  Marek Polacek  <polacek@redhat.com>\n+\n+\tPR c++/89420 - ICE with CAST_EXPR in explicit-specifier.\n+\t* g++.dg/cpp2a/explicit14.C: New test.\n+\n 2019-02-22  Matthew Malcomson  <matthew.malcomson@arm.com>\n \n \tPR target/89324"}, {"sha": "9c3acc32ac45b4f4c208cbaeb4d9bbb73261fd9b", "filename": "gcc/testsuite/g++.dg/cpp2a/explicit14.C", "status": "added", "additions": 11, "deletions": 0, "changes": 11, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/4770beb36c35cc8cf6be0bf061f987fb9429fa9a/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Fcpp2a%2Fexplicit14.C", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/4770beb36c35cc8cf6be0bf061f987fb9429fa9a/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Fcpp2a%2Fexplicit14.C", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Fcpp2a%2Fexplicit14.C?ref=4770beb36c35cc8cf6be0bf061f987fb9429fa9a", "patch": "@@ -0,0 +1,11 @@\n+// PR c++/89420\n+// { dg-do compile { target c++2a } }\n+\n+template<typename>\n+struct S {\n+  explicit(int(1)) S(int);\n+  explicit(int{1}) S(int, int);\n+};\n+\n+S<int> s(1);\n+S<int> s2(1, 2);"}]}