{"sha": "4f00c4d40a539360938607561460904663c64cda", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6NGYwMGM0ZDQwYTUzOTM2MDkzODYwNzU2MTQ2MDkwNDY2M2M2NGNkYQ==", "commit": {"author": {"name": "Martin Liska", "email": "mliska@suse.cz", "date": "2021-03-24T14:58:03Z"}, "committer": {"name": "Martin Liska", "email": "mliska@suse.cz", "date": "2021-03-24T19:45:26Z"}, "message": "i386: fix -march=amd crash\n\nIt started with g:3e2ae3ee285a57455d5a23bd352a68c289130186 where\nnew entry was added to processor_alias_table after generic node:\n\n+  {\"amdfam19h\", PROCESSOR_GENERIC, CPU_GENERIC, 0,\n+    M_CPU_TYPE (AMDFAM19H), P_NONE},\n\nand then the following is violated:\n\n/* NB: processor_alias_table stops at the \"generic\" entry.  */\n\ngcc/ChangeLog:\n\n\tPR target/99753\n\t* common/config/i386/i386-common.c (ARRAY_SIZE): Fix off-by-one\n\terror.\n\t* config/i386/i386-options.c (ix86_option_override_internal):\n\tAdd run-time assert.\n\ngcc/testsuite/ChangeLog:\n\n\tPR target/99753\n\t* gcc.target/i386/pr99753.c: New test.", "tree": {"sha": "0a8140488ab47f3739b56f9d6d6beaf3af23d6cf", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/0a8140488ab47f3739b56f9d6d6beaf3af23d6cf"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/4f00c4d40a539360938607561460904663c64cda", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/4f00c4d40a539360938607561460904663c64cda", "html_url": "https://github.com/Rust-GCC/gccrs/commit/4f00c4d40a539360938607561460904663c64cda", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/4f00c4d40a539360938607561460904663c64cda/comments", "author": {"login": "marxin", "id": 2658545, "node_id": "MDQ6VXNlcjI2NTg1NDU=", "avatar_url": "https://avatars.githubusercontent.com/u/2658545?v=4", "gravatar_id": "", "url": "https://api.github.com/users/marxin", "html_url": "https://github.com/marxin", "followers_url": "https://api.github.com/users/marxin/followers", "following_url": "https://api.github.com/users/marxin/following{/other_user}", "gists_url": "https://api.github.com/users/marxin/gists{/gist_id}", "starred_url": "https://api.github.com/users/marxin/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/marxin/subscriptions", "organizations_url": "https://api.github.com/users/marxin/orgs", "repos_url": "https://api.github.com/users/marxin/repos", "events_url": "https://api.github.com/users/marxin/events{/privacy}", "received_events_url": "https://api.github.com/users/marxin/received_events", "type": "User", "site_admin": false}, "committer": {"login": "marxin", "id": 2658545, "node_id": "MDQ6VXNlcjI2NTg1NDU=", "avatar_url": "https://avatars.githubusercontent.com/u/2658545?v=4", "gravatar_id": "", "url": "https://api.github.com/users/marxin", "html_url": "https://github.com/marxin", "followers_url": "https://api.github.com/users/marxin/followers", "following_url": "https://api.github.com/users/marxin/following{/other_user}", "gists_url": "https://api.github.com/users/marxin/gists{/gist_id}", "starred_url": "https://api.github.com/users/marxin/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/marxin/subscriptions", "organizations_url": "https://api.github.com/users/marxin/orgs", "repos_url": "https://api.github.com/users/marxin/repos", "events_url": "https://api.github.com/users/marxin/events{/privacy}", "received_events_url": "https://api.github.com/users/marxin/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "f225c6b0c50dc472e0b73b440b572a3bf1514020", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/f225c6b0c50dc472e0b73b440b572a3bf1514020", "html_url": "https://github.com/Rust-GCC/gccrs/commit/f225c6b0c50dc472e0b73b440b572a3bf1514020"}], "stats": {"total": 10, "additions": 9, "deletions": 1}, "files": [{"sha": "b89183b830efe752d011222485168368ffaf360a", "filename": "gcc/common/config/i386/i386-common.c", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/4f00c4d40a539360938607561460904663c64cda/gcc%2Fcommon%2Fconfig%2Fi386%2Fi386-common.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/4f00c4d40a539360938607561460904663c64cda/gcc%2Fcommon%2Fconfig%2Fi386%2Fi386-common.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fcommon%2Fconfig%2Fi386%2Fi386-common.c?ref=4f00c4d40a539360938607561460904663c64cda", "patch": "@@ -2051,7 +2051,7 @@ const pta processor_alias_table[] =\n };\n \n /* NB: processor_alias_table stops at the \"generic\" entry.  */\n-unsigned int const pta_size = ARRAY_SIZE (processor_alias_table) - 6;\n+unsigned int const pta_size = ARRAY_SIZE (processor_alias_table) - 7;\n unsigned int const num_arch_names = ARRAY_SIZE (processor_alias_table);\n \n /* Provide valid option values for -march and -mtune options.  */"}, {"sha": "88d5e717f26616d3dfe95986947fd1bb1e68b8b2", "filename": "gcc/config/i386/i386-options.c", "status": "modified", "additions": 3, "deletions": 0, "changes": 3, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/4f00c4d40a539360938607561460904663c64cda/gcc%2Fconfig%2Fi386%2Fi386-options.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/4f00c4d40a539360938607561460904663c64cda/gcc%2Fconfig%2Fi386%2Fi386-options.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fconfig%2Fi386%2Fi386-options.c?ref=4f00c4d40a539360938607561460904663c64cda", "patch": "@@ -2042,6 +2042,9 @@ ix86_option_override_internal (bool main_args_p,\n     sorry (\"%i-bit mode not compiled in\",\n \t   (opts->x_ix86_isa_flags & OPTION_MASK_ISA_64BIT) ? 64 : 32);\n \n+  /* Last processor_alias_table must point to \"generic\" entry.  */\n+  gcc_checking_assert (strcmp (processor_alias_table[pta_size - 1].name,\n+\t\t\t       \"generic\") == 0);\n   for (i = 0; i < pta_size; i++)\n     if (! strcmp (opts->x_ix86_arch_string, processor_alias_table[i].name))\n       {"}, {"sha": "3def1fd7481af7b9b0d1df13798f9e2739136cfe", "filename": "gcc/testsuite/gcc.target/i386/pr99753.c", "status": "added", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/4f00c4d40a539360938607561460904663c64cda/gcc%2Ftestsuite%2Fgcc.target%2Fi386%2Fpr99753.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/4f00c4d40a539360938607561460904663c64cda/gcc%2Ftestsuite%2Fgcc.target%2Fi386%2Fpr99753.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgcc.target%2Fi386%2Fpr99753.c?ref=4f00c4d40a539360938607561460904663c64cda", "patch": "@@ -0,0 +1,5 @@\n+/* PR target/99753 */\n+\n+/* { dg-do compile } */\n+/* { dg-options \"-march=amd -m32\" } */\n+/* { dg-error \"bad value .'amd'. for '-march=' switch\"  \"\" { target *-*-* } 0 } */"}]}