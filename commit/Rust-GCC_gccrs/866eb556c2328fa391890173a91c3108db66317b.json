{"sha": "866eb556c2328fa391890173a91c3108db66317b", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6ODY2ZWI1NTZjMjMyOGZhMzkxODkwMTczYTkxYzMxMDhkYjY2MzE3Yg==", "commit": {"author": {"name": "Kriang Lerdsuwanakij", "email": "lerdsuwa@users.sourceforge.net", "date": "2003-07-16T15:42:15Z"}, "committer": {"name": "Kriang Lerdsuwanakij", "email": "lerdsuwa@gcc.gnu.org", "date": "2003-07-16T15:42:15Z"}, "message": "re PR c++/5421 (friends+templates: ICE: expected identifier_node, have template_id_expr in grokfndecl, at cp/decl.c:8835)\n\n\tPR c++/5421\n\t* decl.c (grokdeclarator): Handle TEMPLATE_ID_EXPR if friend\n\tis a member of other class.\n\t* friend.c (do_friend): Don't build TEMPLATE_DECL if friend\n\tis a specialization of function template.\n\n\t* g++.dg/template/friend21.C: New test.\n\nFrom-SVN: r69457", "tree": {"sha": "ce989dcd709f54247a75f3bf17e5c9c1ca60836c", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/ce989dcd709f54247a75f3bf17e5c9c1ca60836c"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/866eb556c2328fa391890173a91c3108db66317b", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/866eb556c2328fa391890173a91c3108db66317b", "html_url": "https://github.com/Rust-GCC/gccrs/commit/866eb556c2328fa391890173a91c3108db66317b", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/866eb556c2328fa391890173a91c3108db66317b/comments", "author": null, "committer": null, "parents": [{"sha": "94b7906a3a8ea86c701bef97d31f6fdf22db7fc7", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/94b7906a3a8ea86c701bef97d31f6fdf22db7fc7", "html_url": "https://github.com/Rust-GCC/gccrs/commit/94b7906a3a8ea86c701bef97d31f6fdf22db7fc7"}], "stats": {"total": 36, "additions": 35, "deletions": 1}, "files": [{"sha": "68bcb3af7b3e8e2cbbf558b0f734b3e26249389e", "filename": "gcc/cp/ChangeLog", "status": "modified", "additions": 8, "deletions": 0, "changes": 8, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/866eb556c2328fa391890173a91c3108db66317b/gcc%2Fcp%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/866eb556c2328fa391890173a91c3108db66317b/gcc%2Fcp%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fcp%2FChangeLog?ref=866eb556c2328fa391890173a91c3108db66317b", "patch": "@@ -1,3 +1,11 @@\n+2003-07-16  Kriang Lerdsuwanakij  <lerdsuwa@users.sourceforge.net>\n+\n+\tPR c++/5421\n+\t* decl.c (grokdeclarator): Handle TEMPLATE_ID_EXPR if friend\n+\tis a member of other class.\n+\t* friend.c (do_friend): Don't build TEMPLATE_DECL if friend\n+\tis a specialization of function template.\n+\n 2003-07-16  Gabriel Dos Reis  <gdr@integrable-solutions.net>\n \n \tPR c++/10903"}, {"sha": "1dd2ddf7a9459ffcb01f9608a70a4fdffae3da0a", "filename": "gcc/cp/decl.c", "status": "modified", "additions": 4, "deletions": 1, "changes": 5, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/866eb556c2328fa391890173a91c3108db66317b/gcc%2Fcp%2Fdecl.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/866eb556c2328fa391890173a91c3108db66317b/gcc%2Fcp%2Fdecl.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fcp%2Fdecl.c?ref=866eb556c2328fa391890173a91c3108db66317b", "patch": "@@ -11488,7 +11488,10 @@ grokdeclarator (tree declarator,\n \t       members of other classes.  */\n \t    /* All method decls are public, so tell grokfndecl to set\n \t       TREE_PUBLIC, also.  */\n-\t    decl = grokfndecl (ctype, type, declarator, declarator,\n+\t    decl = grokfndecl (ctype, type,\n+\t\t\t       TREE_CODE (declarator) != TEMPLATE_ID_EXPR\n+\t\t\t       ? declarator : dname,\n+\t\t\t       declarator,\n \t\t\t       virtualp, flags, quals, raises,\n \t\t\t       friendp ? -1 : 0, friendp, 1, 0, funcdef_flag,\n \t\t\t       template_count, in_namespace);"}, {"sha": "e31a0559a0fd00e4ea2619c277a7c9acead86884", "filename": "gcc/cp/friend.c", "status": "modified", "additions": 2, "deletions": 0, "changes": 2, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/866eb556c2328fa391890173a91c3108db66317b/gcc%2Fcp%2Ffriend.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/866eb556c2328fa391890173a91c3108db66317b/gcc%2Fcp%2Ffriend.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fcp%2Ffriend.c?ref=866eb556c2328fa391890173a91c3108db66317b", "patch": "@@ -357,6 +357,8 @@ do_friend (tree ctype, tree declarator, tree decl, tree parmdecls,\n \n       if (is_friend_template)\n \tdecl = DECL_TI_TEMPLATE (push_template_decl (decl));\n+      else if (DECL_TEMPLATE_INFO (decl))\n+\t;\n       else if (template_class_depth (current_class_type))\n \tdecl = push_template_decl_real (decl, /*is_friend=*/1);\n "}, {"sha": "68f98a1366cdf5862249935038e88c180c60a93e", "filename": "gcc/testsuite/ChangeLog", "status": "modified", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/866eb556c2328fa391890173a91c3108db66317b/gcc%2Ftestsuite%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/866eb556c2328fa391890173a91c3108db66317b/gcc%2Ftestsuite%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2FChangeLog?ref=866eb556c2328fa391890173a91c3108db66317b", "patch": "@@ -1,3 +1,8 @@\n+2003-07-16  Kriang Lerdsuwanakij  <lerdsuwa@users.sourceforge.net>\n+\n+\tPR c++/5421\n+\t* g++.dg/template/friend21.C: New test.\n+\n 2003-07-16  Jakub Jelinek  <jakub@redhat.com>\n \n \t* gcc.dg/cleanup-8.c: New test."}, {"sha": "854ed67d592f1a1fdec3fb73e3bbf120813dbcf7", "filename": "gcc/testsuite/g++.dg/template/friend21.C", "status": "added", "additions": 16, "deletions": 0, "changes": 16, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/866eb556c2328fa391890173a91c3108db66317b/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Ftemplate%2Ffriend21.C", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/866eb556c2328fa391890173a91c3108db66317b/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Ftemplate%2Ffriend21.C", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Ftemplate%2Ffriend21.C?ref=866eb556c2328fa391890173a91c3108db66317b", "patch": "@@ -0,0 +1,16 @@\n+// { dg-do compile }\n+\n+// Origin: ajl13@bellatlantic.net\n+\n+// PR c++/5421: ICE for specialization of member function template\n+// as friend.\n+\n+struct B {\n+  template <class T> void b();\n+};\n+\n+template <class T> class A {\n+  friend void B::b<T>();\n+};\n+\n+static A<int> a;"}]}