{"sha": "dbc31f20d30615404c2994f2d0bb9876cd75585a", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6ZGJjMzFmMjBkMzA2MTU0MDRjMjk5NGYyZDBiYjk4NzZjZDc1NTg1YQ==", "commit": {"author": {"name": "Thomas Schwinge", "email": "thomas@codesourcery.com", "date": "2017-10-02T11:56:25Z"}, "committer": {"name": "Thomas Schwinge", "email": "tschwinge@gcc.gnu.org", "date": "2017-10-02T11:56:25Z"}, "message": "libbacktrace: Conditionalize test timing on clock_gettime availability\n\n\tlibbacktrace/\n\tPR other/67165\n\t* configure.ac: Check for clock_gettime.\n\t* config.h.in: Regenerate.\n\t* configure: Likewise.\n\t* ztest.c (average_time, test_large): Conditionalize test timing\n\ton clock_gettime availability.\n\nFrom-SVN: r253344", "tree": {"sha": "6180153dd27e37972f90f06729c67e136418f62c", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/6180153dd27e37972f90f06729c67e136418f62c"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/dbc31f20d30615404c2994f2d0bb9876cd75585a", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/dbc31f20d30615404c2994f2d0bb9876cd75585a", "html_url": "https://github.com/Rust-GCC/gccrs/commit/dbc31f20d30615404c2994f2d0bb9876cd75585a", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/dbc31f20d30615404c2994f2d0bb9876cd75585a/comments", "author": {"login": "tschwinge", "id": 21753, "node_id": "MDQ6VXNlcjIxNzUz", "avatar_url": "https://avatars.githubusercontent.com/u/21753?v=4", "gravatar_id": "", "url": "https://api.github.com/users/tschwinge", "html_url": "https://github.com/tschwinge", "followers_url": "https://api.github.com/users/tschwinge/followers", "following_url": "https://api.github.com/users/tschwinge/following{/other_user}", "gists_url": "https://api.github.com/users/tschwinge/gists{/gist_id}", "starred_url": "https://api.github.com/users/tschwinge/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/tschwinge/subscriptions", "organizations_url": "https://api.github.com/users/tschwinge/orgs", "repos_url": "https://api.github.com/users/tschwinge/repos", "events_url": "https://api.github.com/users/tschwinge/events{/privacy}", "received_events_url": "https://api.github.com/users/tschwinge/received_events", "type": "User", "site_admin": false}, "committer": null, "parents": [{"sha": "6146ee73730cd2a4406918a0d5f98f0f71331f01", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/6146ee73730cd2a4406918a0d5f98f0f71331f01", "html_url": "https://github.com/Rust-GCC/gccrs/commit/6146ee73730cd2a4406918a0d5f98f0f71331f01"}], "stats": {"total": 40, "additions": 39, "deletions": 1}, "files": [{"sha": "0e4cfd24cd34cd41e11e0d44c3075bf5276273aa", "filename": "libbacktrace/ChangeLog", "status": "modified", "additions": 9, "deletions": 0, "changes": 9, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/dbc31f20d30615404c2994f2d0bb9876cd75585a/libbacktrace%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/dbc31f20d30615404c2994f2d0bb9876cd75585a/libbacktrace%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libbacktrace%2FChangeLog?ref=dbc31f20d30615404c2994f2d0bb9876cd75585a", "patch": "@@ -1,3 +1,12 @@\n+2017-10-02  Thomas Schwinge  <thomas@codesourcery.com>\n+\n+\tPR other/67165\n+\t* configure.ac: Check for clock_gettime.\n+\t* config.h.in: Regenerate.\n+\t* configure: Likewise.\n+\t* ztest.c (average_time, test_large): Conditionalize test timing\n+\ton clock_gettime availability.\n+\n 2017-09-29  Tony Reix  <tony.reix@atos.net>\n \n \t* xcoff.c: Initial support for DWARF debug sections in XCOFF."}, {"sha": "c19b6e430cb57d5c8b5979de395cf6984c928b69", "filename": "libbacktrace/config.h.in", "status": "modified", "additions": 3, "deletions": 0, "changes": 3, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/dbc31f20d30615404c2994f2d0bb9876cd75585a/libbacktrace%2Fconfig.h.in", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/dbc31f20d30615404c2994f2d0bb9876cd75585a/libbacktrace%2Fconfig.h.in", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libbacktrace%2Fconfig.h.in?ref=dbc31f20d30615404c2994f2d0bb9876cd75585a", "patch": "@@ -9,6 +9,9 @@\n /* Define to 1 if you have the __atomic functions */\n #undef HAVE_ATOMIC_FUNCTIONS\n \n+/* Define to 1 if you have the `clock_gettime' function. */\n+#undef HAVE_CLOCK_GETTIME\n+\n /* Define to 1 if you have the declaration of `strnlen', and to 0 if you\n    don't. */\n #undef HAVE_DECL_STRNLEN"}, {"sha": "062dc77c9b221c9d797113a66b47a7fda7f45385", "filename": "libbacktrace/configure", "status": "modified", "additions": 13, "deletions": 0, "changes": 13, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/dbc31f20d30615404c2994f2d0bb9876cd75585a/libbacktrace%2Fconfigure", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/dbc31f20d30615404c2994f2d0bb9876cd75585a/libbacktrace%2Fconfigure", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libbacktrace%2Fconfigure?ref=dbc31f20d30615404c2994f2d0bb9876cd75585a", "patch": "@@ -12747,6 +12747,19 @@ $as_echo \"#define HAVE_GETEXECNAME 1\" >>confdefs.h\n \n fi\n \n+# Check for the clock_gettime function.\n+for ac_func in clock_gettime\n+do :\n+  ac_fn_c_check_func \"$LINENO\" \"clock_gettime\" \"ac_cv_func_clock_gettime\"\n+if test \"x$ac_cv_func_clock_gettime\" = x\"\"yes; then :\n+  cat >>confdefs.h <<_ACEOF\n+#define HAVE_CLOCK_GETTIME 1\n+_ACEOF\n+\n+fi\n+done\n+\n+\n { $as_echo \"$as_me:${as_lineno-$LINENO}: checking whether -pthread is supported\" >&5\n $as_echo_n \"checking whether -pthread is supported... \" >&6; }\n if test \"${libgo_cv_lib_pthread+set}\" = set; then :"}, {"sha": "75ec9f503a2a1e18ed868b6a98cda268737ac01f", "filename": "libbacktrace/configure.ac", "status": "modified", "additions": 3, "deletions": 0, "changes": 3, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/dbc31f20d30615404c2994f2d0bb9876cd75585a/libbacktrace%2Fconfigure.ac", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/dbc31f20d30615404c2994f2d0bb9876cd75585a/libbacktrace%2Fconfigure.ac", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libbacktrace%2Fconfigure.ac?ref=dbc31f20d30615404c2994f2d0bb9876cd75585a", "patch": "@@ -388,6 +388,9 @@ if test \"$have_getexecname\" = \"yes\"; then\n   AC_DEFINE(HAVE_GETEXECNAME, 1, [Define if getexecname is available.])\n fi\n \n+# Check for the clock_gettime function.\n+AC_CHECK_FUNCS(clock_gettime)\n+\n dnl Test whether the compiler supports the -pthread option.\n AC_CACHE_CHECK([whether -pthread is supported],\n [libgo_cv_lib_pthread],"}, {"sha": "0b1cbc35f0ca346f95a572bf36b70fccf3d46ff0", "filename": "libbacktrace/ztest.c", "status": "modified", "additions": 11, "deletions": 1, "changes": 12, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/dbc31f20d30615404c2994f2d0bb9876cd75585a/libbacktrace%2Fztest.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/dbc31f20d30615404c2994f2d0bb9876cd75585a/libbacktrace%2Fztest.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libbacktrace%2Fztest.c?ref=dbc31f20d30615404c2994f2d0bb9876cd75585a", "patch": "@@ -43,6 +43,10 @@ POSSIBILITY OF SUCH DAMAGE.  */\n #include <zlib.h>\n #endif\n \n+#ifdef HAVE_CLOCK_GETTIME\n+# define TEST_TIMING\n+#endif\n+\n #include \"backtrace.h\"\n #include \"backtrace-supported.h\"\n \n@@ -157,7 +161,7 @@ test_samples (struct backtrace_state *state)\n     }\n }\n \n-#ifdef HAVE_ZLIB\n+#if defined HAVE_ZLIB && defined TEST_TIMING\n \n /* Given a set of TRIALS timings, discard the lowest and highest\n    values and return the mean average of the rest.  */\n@@ -216,6 +220,7 @@ test_large (struct backtrace_state *state)\n   unsigned char *uncompressed_buf;\n   size_t uncompressed_bufsize;\n   int r;\n+# ifdef TEST_TIMING\n   clockid_t cid;\n   struct timespec ts1;\n   struct timespec ts2;\n@@ -224,6 +229,7 @@ test_large (struct backtrace_state *state)\n   const size_t trials = 16;\n   size_t ctimes[16];\n   size_t ztimes[16];\n+# endif /* TEST_TIMING */\n   static const char * const names[] = {\n     \"Mark.Twain-Tom.Sawyer.txt\",\n     \"../libgo/go/compress/testdata/Mark.Twain-Tom.Sawyer.txt\"\n@@ -341,6 +347,8 @@ test_large (struct backtrace_state *state)\n \n   printf (\"PASS: inflate large\\n\");\n \n+# ifdef TEST_TIMING\n+\n   for (i = 0; i < trials; ++i)\n     {\n       cid = CLOCK_REALTIME;\n@@ -411,6 +419,8 @@ test_large (struct backtrace_state *state)\n   printf (\"zlib time:    : %zu ns\\n\", ztime);\n   printf (\"percentage    : %g\\n\", (double) ztime / (double) ctime);\n \n+# endif /* TEST_TIMING */\n+\n   return;\n \n  fail:"}]}