{"sha": "dd6e65c618576b52c46bc6fbf28ac6b91bce2951", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6ZGQ2ZTY1YzYxODU3NmI1MmM0NmJjNmZiZjI4YWM2YjkxYmNlMjk1MQ==", "commit": {"author": {"name": "Yannick Moy", "email": "moy@adacore.com", "date": "2019-08-20T09:50:29Z"}, "committer": {"name": "Pierre-Marie de Rodat", "email": "pmderodat@gcc.gnu.org", "date": "2019-08-20T09:50:29Z"}, "message": "[Ada] Adapt GNATprove expansion for slices with access prefix\n\nThe special expansion done in GNATprove mode should be adapted to slices\nwhere the prefix has access type, like indexed expressions.\n\nThere is no impact on compilation.\n\n2019-08-20  Yannick Moy  <moy@adacore.com>\n\ngcc/ada/\n\n\t* exp_spark.adb (Expand_SPARK_N_Slice_Or_Indexed_Component):\n\tRenaming of function to apply to slices as well.\n\t(Expand_SPARK): Expand prefix of slices of access type.\n\nFrom-SVN: r274740", "tree": {"sha": "ccc47ba32b4f7cd5d4f8cdf4adb8e41f2807ecd5", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/ccc47ba32b4f7cd5d4f8cdf4adb8e41f2807ecd5"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/dd6e65c618576b52c46bc6fbf28ac6b91bce2951", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/dd6e65c618576b52c46bc6fbf28ac6b91bce2951", "html_url": "https://github.com/Rust-GCC/gccrs/commit/dd6e65c618576b52c46bc6fbf28ac6b91bce2951", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/dd6e65c618576b52c46bc6fbf28ac6b91bce2951/comments", "author": {"login": "yannickmoy", "id": 859440, "node_id": "MDQ6VXNlcjg1OTQ0MA==", "avatar_url": "https://avatars.githubusercontent.com/u/859440?v=4", "gravatar_id": "", "url": "https://api.github.com/users/yannickmoy", "html_url": "https://github.com/yannickmoy", "followers_url": "https://api.github.com/users/yannickmoy/followers", "following_url": "https://api.github.com/users/yannickmoy/following{/other_user}", "gists_url": "https://api.github.com/users/yannickmoy/gists{/gist_id}", "starred_url": "https://api.github.com/users/yannickmoy/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/yannickmoy/subscriptions", "organizations_url": "https://api.github.com/users/yannickmoy/orgs", "repos_url": "https://api.github.com/users/yannickmoy/repos", "events_url": "https://api.github.com/users/yannickmoy/events{/privacy}", "received_events_url": "https://api.github.com/users/yannickmoy/received_events", "type": "User", "site_admin": false}, "committer": null, "parents": [{"sha": "d4e4e88a4c1b13bc480603ad96672ce079e32ffb", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/d4e4e88a4c1b13bc480603ad96672ce079e32ffb", "html_url": "https://github.com/Rust-GCC/gccrs/commit/d4e4e88a4c1b13bc480603ad96672ce079e32ffb"}], "stats": {"total": 48, "additions": 28, "deletions": 20}, "files": [{"sha": "a27d1d9fb0d8c4ab0f7e2c73fb86c315d1d20f88", "filename": "gcc/ada/ChangeLog", "status": "modified", "additions": 6, "deletions": 0, "changes": 6, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/dd6e65c618576b52c46bc6fbf28ac6b91bce2951/gcc%2Fada%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/dd6e65c618576b52c46bc6fbf28ac6b91bce2951/gcc%2Fada%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fada%2FChangeLog?ref=dd6e65c618576b52c46bc6fbf28ac6b91bce2951", "patch": "@@ -1,3 +1,9 @@\n+2019-08-20  Yannick Moy  <moy@adacore.com>\n+\n+\t* exp_spark.adb (Expand_SPARK_N_Slice_Or_Indexed_Component):\n+\tRenaming of function to apply to slices as well.\n+\t(Expand_SPARK): Expand prefix of slices of access type.\n+\n 2019-08-20  Bob Duff  <duff@adacore.com>\n \n \t* exp_aggr.adb (Expand_Array_Aggregate): Use build-in-place in"}, {"sha": "e64babef4a7bc9e39e63f278b438335fa49b26d8", "filename": "gcc/ada/exp_spark.adb", "status": "modified", "additions": 22, "deletions": 20, "changes": 42, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/dd6e65c618576b52c46bc6fbf28ac6b91bce2951/gcc%2Fada%2Fexp_spark.adb", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/dd6e65c618576b52c46bc6fbf28ac6b91bce2951/gcc%2Fada%2Fexp_spark.adb", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fada%2Fexp_spark.adb?ref=dd6e65c618576b52c46bc6fbf28ac6b91bce2951", "patch": "@@ -59,9 +59,6 @@ package body Exp_SPARK is\n    procedure Expand_SPARK_N_Freeze_Type (E : Entity_Id);\n    --  Build the DIC procedure of a type when needed, if not already done\n \n-   procedure Expand_SPARK_N_Indexed_Component (N : Node_Id);\n-   --  Insert explicit dereference if required\n-\n    procedure Expand_SPARK_N_Loop_Statement (N : Node_Id);\n    --  Perform loop statement-specific expansion\n \n@@ -77,6 +74,9 @@ package body Exp_SPARK is\n    procedure Expand_SPARK_N_Selected_Component (N : Node_Id);\n    --  Insert explicit dereference if required\n \n+   procedure Expand_SPARK_N_Slice_Or_Indexed_Component (N : Node_Id);\n+   --  Insert explicit dereference if required\n+\n    ------------------\n    -- Expand_SPARK --\n    ------------------\n@@ -138,8 +138,10 @@ package body Exp_SPARK is\n                Expand_SPARK_N_Freeze_Type (Entity (N));\n             end if;\n \n-         when N_Indexed_Component =>\n-            Expand_SPARK_N_Indexed_Component (N);\n+         when N_Indexed_Component\n+            | N_Slice\n+         =>\n+            Expand_SPARK_N_Slice_Or_Indexed_Component (N);\n \n          when N_Selected_Component =>\n             Expand_SPARK_N_Selected_Component (N);\n@@ -326,21 +328,6 @@ package body Exp_SPARK is\n       end if;\n    end Expand_SPARK_N_Loop_Statement;\n \n-   --------------------------------------\n-   -- Expand_SPARK_N_Indexed_Component --\n-   --------------------------------------\n-\n-   procedure Expand_SPARK_N_Indexed_Component (N : Node_Id) is\n-      Pref : constant Node_Id    := Prefix (N);\n-      Typ  : constant Entity_Id  := Etype (Pref);\n-\n-   begin\n-      if Is_Access_Type (Typ) then\n-         Insert_Explicit_Dereference (Pref);\n-         Analyze_And_Resolve (Pref, Designated_Type (Typ));\n-      end if;\n-   end Expand_SPARK_N_Indexed_Component;\n-\n    ---------------------------------------\n    -- Expand_SPARK_N_Object_Declaration --\n    ---------------------------------------\n@@ -552,4 +539,19 @@ package body Exp_SPARK is\n       end if;\n    end Expand_SPARK_N_Selected_Component;\n \n+   -----------------------------------------------\n+   -- Expand_SPARK_N_Slice_Or_Indexed_Component --\n+   -----------------------------------------------\n+\n+   procedure Expand_SPARK_N_Slice_Or_Indexed_Component (N : Node_Id) is\n+      Pref : constant Node_Id   := Prefix (N);\n+      Typ  : constant Entity_Id := Etype (Pref);\n+\n+   begin\n+      if Is_Access_Type (Typ) then\n+         Insert_Explicit_Dereference (Pref);\n+         Analyze_And_Resolve (Pref, Designated_Type (Typ));\n+      end if;\n+   end Expand_SPARK_N_Slice_Or_Indexed_Component;\n+\n end Exp_SPARK;"}]}