{"sha": "f5d56cf957f9235d43f4dc4cec511b042e0b18de", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6ZjVkNTZjZjk1N2Y5MjM1ZDQzZjRkYzRjZWM1MTFiMDQyZTBiMThkZQ==", "commit": {"author": {"name": "Claudiu Zissulescu", "email": "claziss@synopsys.com", "date": "2019-03-18T09:28:45Z"}, "committer": {"name": "Claudiu Zissulescu", "email": "claziss@gcc.gnu.org", "date": "2019-03-18T09:28:45Z"}, "message": "[ARC] Enable code density frame option for elf targets.\n\nxxxx-xx-xx  Claudiu Zissulescu  <claziss@synopsys.com>\n\n\t* config/arc/arc.opt (mcode-density-frame): Get the inital value\n\tfrom TARGET_CODE_DENSITY_FRAME_DEFAULT.\n\t* config/arc/elf.h (TARGET_CODE_DENSITY_FRAME_DEFAULT): Define.\n\t* config/arc/linux.h (TARGET_CODE_DENSITY_FRAME_DEFAULT): Define.\n\t* config/arc/arc.md (pop_multi_fp_blink): Adjust constraints to\n\tmatch what the ops is doing.\n\t(push_multi_fp_blink): Likewise.\n\t* config/arc/arc.c (arc_override_options): Enable enter/leave when\n\tcompiling for size and elf target.\n\t(arc_save_callee_enter): Adjust note to match what enter/leave\n\toperation does.\n\nFrom-SVN: r269758", "tree": {"sha": "37fdf654ca2596fa914ee5fd1ed4790225b3bf57", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/37fdf654ca2596fa914ee5fd1ed4790225b3bf57"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/f5d56cf957f9235d43f4dc4cec511b042e0b18de", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/f5d56cf957f9235d43f4dc4cec511b042e0b18de", "html_url": "https://github.com/Rust-GCC/gccrs/commit/f5d56cf957f9235d43f4dc4cec511b042e0b18de", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/f5d56cf957f9235d43f4dc4cec511b042e0b18de/comments", "author": {"login": "claziss", "id": 2761368, "node_id": "MDQ6VXNlcjI3NjEzNjg=", "avatar_url": "https://avatars.githubusercontent.com/u/2761368?v=4", "gravatar_id": "", "url": "https://api.github.com/users/claziss", "html_url": "https://github.com/claziss", "followers_url": "https://api.github.com/users/claziss/followers", "following_url": "https://api.github.com/users/claziss/following{/other_user}", "gists_url": "https://api.github.com/users/claziss/gists{/gist_id}", "starred_url": "https://api.github.com/users/claziss/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/claziss/subscriptions", "organizations_url": "https://api.github.com/users/claziss/orgs", "repos_url": "https://api.github.com/users/claziss/repos", "events_url": "https://api.github.com/users/claziss/events{/privacy}", "received_events_url": "https://api.github.com/users/claziss/received_events", "type": "User", "site_admin": false}, "committer": null, "parents": [{"sha": "a09479605013801c23451d47a297077195cae8da", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/a09479605013801c23451d47a297077195cae8da", "html_url": "https://github.com/Rust-GCC/gccrs/commit/a09479605013801c23451d47a297077195cae8da"}], "stats": {"total": 51, "additions": 39, "deletions": 12}, "files": [{"sha": "2da36e7030b57f61393bbc167590c7017eb659a1", "filename": "gcc/ChangeLog", "status": "modified", "additions": 14, "deletions": 0, "changes": 14, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/f5d56cf957f9235d43f4dc4cec511b042e0b18de/gcc%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/f5d56cf957f9235d43f4dc4cec511b042e0b18de/gcc%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2FChangeLog?ref=f5d56cf957f9235d43f4dc4cec511b042e0b18de", "patch": "@@ -1,3 +1,17 @@\n+2019-03-18  Claudiu Zissulescu  <claziss@synopsys.com>\n+\n+\t* config/arc/arc.opt (mcode-density-frame): Get the inital value\n+\tfrom TARGET_CODE_DENSITY_FRAME_DEFAULT.\n+\t* config/arc/elf.h (TARGET_CODE_DENSITY_FRAME_DEFAULT): Define.\n+\t* config/arc/linux.h (TARGET_CODE_DENSITY_FRAME_DEFAULT): Define.\n+\t* config/arc/arc.md (pop_multi_fp_blink): Adjust constraints to\n+\tmatch what the ops is doing.\n+\t(push_multi_fp_blink): Likewise.\n+\t* config/arc/arc.c (arc_override_options): Enable enter/leave when\n+\tcompiling for size and elf target.\n+\t(arc_save_callee_enter): Adjust note to match what enter/leave\n+\toperation does.\n+\n 2019-03-18  Claudiu Zissulescu  <claziss@synopsys.com>\n \n \t* config/arc/arc.md (tst_movb): Fix constraint."}, {"sha": "978d8450ab0f28842887bc2dea73cdfc9ceb1543", "filename": "gcc/config/arc/arc.c", "status": "modified", "additions": 4, "deletions": 1, "changes": 5, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/f5d56cf957f9235d43f4dc4cec511b042e0b18de/gcc%2Fconfig%2Farc%2Farc.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/f5d56cf957f9235d43f4dc4cec511b042e0b18de/gcc%2Fconfig%2Farc%2Farc.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fconfig%2Farc%2Farc.c?ref=f5d56cf957f9235d43f4dc4cec511b042e0b18de", "patch": "@@ -1294,6 +1294,9 @@ arc_override_options (void)\n   if (arc_size_opt_level == 3)\n     optimize_size = 1;\n \n+  if (TARGET_V2 && optimize_size && (ATTRIBUTE_PCS == 2))\n+    TARGET_CODE_DENSITY_FRAME = 1;\n+\n   if (flag_pic)\n     target_flags |= MASK_NO_SDATA_SET;\n \n@@ -3140,7 +3143,7 @@ arc_save_callee_enter (unsigned int gmask,\n   reg = gen_rtx_SET (stack_pointer_rtx,\n \t\t     plus_constant (Pmode,\n \t\t\t\t    stack_pointer_rtx,\n-\t\t\t\t    nregs * UNITS_PER_WORD));\n+\t\t\t\t    -nregs * UNITS_PER_WORD));\n   RTX_FRAME_RELATED_P (reg) = 1;\n   XVECEXP (insn, 0, indx++) = reg;\n   off = nregs * UNITS_PER_WORD;"}, {"sha": "e682983048a4b17b9979fe2842fdbe2bf0a21458", "filename": "gcc/config/arc/arc.md", "status": "modified", "additions": 12, "deletions": 10, "changes": 22, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/f5d56cf957f9235d43f4dc4cec511b042e0b18de/gcc%2Fconfig%2Farc%2Farc.md", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/f5d56cf957f9235d43f4dc4cec511b042e0b18de/gcc%2Fconfig%2Farc%2Farc.md", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fconfig%2Farc%2Farc.md?ref=f5d56cf957f9235d43f4dc4cec511b042e0b18de", "patch": "@@ -6458,22 +6458,23 @@ core_3, archs4x, archs4xd, archs4xd_slow\"\n \t\t\t (plus:SI (reg:SI SP_REG)\n \t\t\t\t  (match_operand 1 \"immediate_operand\" \"\")))\n \t\t    (set (mem:SI (plus:SI (reg:SI SP_REG)\n-\t\t\t\t\t  (match_dup 1)))\n+\t\t\t\t\t  (match_operand 2 \"immediate_operand\"\n+\t\t\t\t\t\t\t \"\")))\n \t\t\t (reg:SI 13))])]\n   \"TARGET_CODE_DENSITY\"\n   {\n    int len = XVECLEN (operands[0], 0);\n    rtx tmp = XVECEXP (operands[0], 0, len - 1);\n    if (MEM_P (XEXP (tmp, 0)))\n      {\n-      operands[2] = XEXP (tmp, 1);\n-      return \"enter_s\\\\t{r13-%2} ; sp=sp-%1\";\n+      operands[3] = XEXP (tmp, 1);\n+      return \"enter_s\\\\t{r13-%3} ; sp=sp+(%1)\";\n      }\n    else\n      {\n       tmp = XVECEXP (operands[0], 0, len - 3);\n-      operands[2] = XEXP (tmp, 1);\n-      return \"enter_s\\\\t{r13-%2, fp} ; sp=sp-%1\";\n+      operands[3] = XEXP (tmp, 1);\n+      return \"enter_s\\\\t{r13-%3, fp} ; sp=sp+(%1)\";\n      }\n   }\n   [(set_attr \"type\" \"call_no_delay_slot\")\n@@ -6485,22 +6486,23 @@ core_3, archs4x, archs4xd, archs4xd_slow\"\n \t\t\t (plus:SI (reg:SI SP_REG)\n \t\t\t\t  (match_operand 1 \"immediate_operand\" \"\")))\n \t\t    (set (mem:SI (plus:SI (reg:SI SP_REG)\n-\t\t\t\t\t  (match_dup 1)))\n+\t\t\t\t\t  (match_operand 2 \"immediate_operand\"\n+\t\t\t\t\t\t\t \"\")))\n \t\t\t (reg:SI RETURN_ADDR_REGNUM))])]\n   \"TARGET_CODE_DENSITY\"\n   {\n    int len = XVECLEN (operands[0], 0);\n    rtx tmp = XVECEXP (operands[0], 0, len - 1);\n    if (MEM_P (XEXP (tmp, 0)))\n      {\n-      operands[2] = XEXP (tmp, 1);\n-      return \"enter_s\\\\t{r13-%2, blink} ; sp=sp-%1\";\n+      operands[3] = XEXP (tmp, 1);\n+      return \"enter_s\\\\t{r13-%3, blink} ; sp=sp+(%1)\";\n      }\n    else\n      {\n       tmp = XVECEXP (operands[0], 0, len - 3);\n-      operands[2] = XEXP (tmp, 1);\n-      return \"enter_s\\\\t{r13-%2, fp, blink} ; sp=sp-%1\";\n+      operands[3] = XEXP (tmp, 1);\n+      return \"enter_s\\\\t{r13-%3, fp, blink} ; sp=sp+(%1)\";\n      }\n   }\n   [(set_attr \"type\" \"call_no_delay_slot\")"}, {"sha": "e4330135a01e24e0a75a96aee51abbb34cbaf9f7", "filename": "gcc/config/arc/arc.opt", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/f5d56cf957f9235d43f4dc4cec511b042e0b18de/gcc%2Fconfig%2Farc%2Farc.opt", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/f5d56cf957f9235d43f4dc4cec511b042e0b18de/gcc%2Fconfig%2Farc%2Farc.opt", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fconfig%2Farc%2Farc.opt?ref=f5d56cf957f9235d43f4dc4cec511b042e0b18de", "patch": "@@ -537,5 +537,5 @@ Target Report Var(TARGET_BRANCH_INDEX) Init(DEFAULT_BRANCH_INDEX)\n Enable use of BI/BIH instructions when available.\n \n mcode-density-frame\n-Target Report Var(TARGET_CODE_DENSITY_FRAME)\n+Target Report Var(TARGET_CODE_DENSITY_FRAME) Init(TARGET_CODE_DENSITY_FRAME_DEFAULT)\n Enable ENTER_S and LEAVE_S opcodes for ARCv2."}, {"sha": "297ac9b0ce01e2677a5039369d656de1fdf9b7de", "filename": "gcc/config/arc/elf.h", "status": "modified", "additions": 4, "deletions": 0, "changes": 4, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/f5d56cf957f9235d43f4dc4cec511b042e0b18de/gcc%2Fconfig%2Farc%2Felf.h", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/f5d56cf957f9235d43f4dc4cec511b042e0b18de/gcc%2Fconfig%2Farc%2Felf.h", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fconfig%2Farc%2Felf.h?ref=f5d56cf957f9235d43f4dc4cec511b042e0b18de", "patch": "@@ -87,3 +87,7 @@ along with GCC; see the file COPYING3.  If not see\n     fun = gen_rtx_SYMBOL_REF (Pmode, \"__mcount\");\t\t\\\n     emit_library_call (fun, LCT_NORMAL, VOIDmode);\t\t\\\n   }\n+\n+/* Enter/Leave default value.  */\n+#undef TARGET_CODE_DENSITY_FRAME_DEFAULT\n+#define TARGET_CODE_DENSITY_FRAME_DEFAULT 0"}, {"sha": "270ca907d8759001bc8d704458021c37d870f6da", "filename": "gcc/config/arc/linux.h", "status": "modified", "additions": 4, "deletions": 0, "changes": 4, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/f5d56cf957f9235d43f4dc4cec511b042e0b18de/gcc%2Fconfig%2Farc%2Flinux.h", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/f5d56cf957f9235d43f4dc4cec511b042e0b18de/gcc%2Fconfig%2Farc%2Flinux.h", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fconfig%2Farc%2Flinux.h?ref=f5d56cf957f9235d43f4dc4cec511b042e0b18de", "patch": "@@ -133,3 +133,7 @@ along with GCC; see the file COPYING3.  If not see\n    fun = gen_rtx_SYMBOL_REF (Pmode, \"_mcount\");\t\t\t\\\n    emit_library_call (fun, LCT_NORMAL, VOIDmode, rt, Pmode);\t\\\n   }\n+\n+/* Enter/Leave ops are default off for linux targets.  */\n+#undef TARGET_CODE_DENSITY_FRAME_DEFAULT\n+#define TARGET_CODE_DENSITY_FRAME_DEFAULT 0"}]}