{"sha": "41a9e940c7014f117738a9a59b31833047a1083d", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6NDFhOWU5NDBjNzAxNGYxMTc3MzhhOWE1OWIzMTgzMzA0N2ExMDgzZA==", "commit": {"author": {"name": "David Malcolm", "email": "dmalcolm@redhat.com", "date": "2020-02-05T21:48:53Z"}, "committer": {"name": "David Malcolm", "email": "dmalcolm@redhat.com", "date": "2020-02-10T21:23:59Z"}, "message": "analyzer: fix ICE with fortran constant arguments (PR 93405)\n\nPR analyzer/93405 reports an ICE with -fanalyzer when passing\na constant \"by reference\" in gfortran.\n\nThe issue is that the constant is passed as an ADDR_EXPR\nof a CONST_DECL, and region_model::get_lvalue_1 doesn't\nknow how to handle CONST_DECL.\n\nThis patch implements it for CONST_DECL by providing\na placeholder region, holding the CONST_DECL's value,\nfixing the ICE.\n\ngcc/analyzer/ChangeLog:\n\tPR analyzer/93405\n\t* region-model.cc (region_model::get_lvalue_1): Implement\n\tCONST_DECL.\n\ngcc/testsuite/ChangeLog:\n\tPR analyzer/93405\n\t* gfortran.dg/analyzer/pr93405.f90: New test.", "tree": {"sha": "eaad923c5d678f90dfedabfabc76fb407074302e", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/eaad923c5d678f90dfedabfabc76fb407074302e"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/41a9e940c7014f117738a9a59b31833047a1083d", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/41a9e940c7014f117738a9a59b31833047a1083d", "html_url": "https://github.com/Rust-GCC/gccrs/commit/41a9e940c7014f117738a9a59b31833047a1083d", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/41a9e940c7014f117738a9a59b31833047a1083d/comments", "author": {"login": "davidmalcolm", "id": 1553248, "node_id": "MDQ6VXNlcjE1NTMyNDg=", "avatar_url": "https://avatars.githubusercontent.com/u/1553248?v=4", "gravatar_id": "", "url": "https://api.github.com/users/davidmalcolm", "html_url": "https://github.com/davidmalcolm", "followers_url": "https://api.github.com/users/davidmalcolm/followers", "following_url": "https://api.github.com/users/davidmalcolm/following{/other_user}", "gists_url": "https://api.github.com/users/davidmalcolm/gists{/gist_id}", "starred_url": "https://api.github.com/users/davidmalcolm/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/davidmalcolm/subscriptions", "organizations_url": "https://api.github.com/users/davidmalcolm/orgs", "repos_url": "https://api.github.com/users/davidmalcolm/repos", "events_url": "https://api.github.com/users/davidmalcolm/events{/privacy}", "received_events_url": "https://api.github.com/users/davidmalcolm/received_events", "type": "User", "site_admin": false}, "committer": {"login": "davidmalcolm", "id": 1553248, "node_id": "MDQ6VXNlcjE1NTMyNDg=", "avatar_url": "https://avatars.githubusercontent.com/u/1553248?v=4", "gravatar_id": "", "url": "https://api.github.com/users/davidmalcolm", "html_url": "https://github.com/davidmalcolm", "followers_url": "https://api.github.com/users/davidmalcolm/followers", "following_url": "https://api.github.com/users/davidmalcolm/following{/other_user}", "gists_url": "https://api.github.com/users/davidmalcolm/gists{/gist_id}", "starred_url": "https://api.github.com/users/davidmalcolm/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/davidmalcolm/subscriptions", "organizations_url": "https://api.github.com/users/davidmalcolm/orgs", "repos_url": "https://api.github.com/users/davidmalcolm/repos", "events_url": "https://api.github.com/users/davidmalcolm/events{/privacy}", "received_events_url": "https://api.github.com/users/davidmalcolm/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "e9fb7579cbb9fa7adea13e7ee34dfd44fe19ad90", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/e9fb7579cbb9fa7adea13e7ee34dfd44fe19ad90", "html_url": "https://github.com/Rust-GCC/gccrs/commit/e9fb7579cbb9fa7adea13e7ee34dfd44fe19ad90"}], "stats": {"total": 38, "additions": 38, "deletions": 0}, "files": [{"sha": "e24976bbefd7f43d1982e594b50a471b2c5741bb", "filename": "gcc/analyzer/ChangeLog", "status": "modified", "additions": 6, "deletions": 0, "changes": 6, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/41a9e940c7014f117738a9a59b31833047a1083d/gcc%2Fanalyzer%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/41a9e940c7014f117738a9a59b31833047a1083d/gcc%2Fanalyzer%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fanalyzer%2FChangeLog?ref=41a9e940c7014f117738a9a59b31833047a1083d", "patch": "@@ -1,3 +1,9 @@\n+2020-02-10  David Malcolm  <dmalcolm@redhat.com>\n+\n+\tPR analyzer/93405\n+\t* region-model.cc (region_model::get_lvalue_1): Implement\n+\tCONST_DECL.\n+\n 2020-02-06  David Malcolm  <dmalcolm@redhat.com>\n \n \t* region-model.cc (region_model::maybe_cast_1): Attempt to provide"}, {"sha": "86a5b424911690070348b5c200e5dd48fba487e6", "filename": "gcc/analyzer/region-model.cc", "status": "modified", "additions": 13, "deletions": 0, "changes": 13, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/41a9e940c7014f117738a9a59b31833047a1083d/gcc%2Fanalyzer%2Fregion-model.cc", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/41a9e940c7014f117738a9a59b31833047a1083d/gcc%2Fanalyzer%2Fregion-model.cc", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fanalyzer%2Fregion-model.cc?ref=41a9e940c7014f117738a9a59b31833047a1083d", "patch": "@@ -4690,6 +4690,19 @@ region_model::get_lvalue_1 (path_var pv, region_model_context *ctxt)\n       }\n       break;\n \n+    case CONST_DECL:\n+      {\n+\ttree cst_type = TREE_TYPE (expr);\n+\tregion_id cst_rid = add_region_for_type (m_root_rid, cst_type);\n+\tif (tree value = DECL_INITIAL (expr))\n+\t  {\n+\t    svalue_id sid = get_rvalue (value, ctxt);\n+\t    get_region (cst_rid)->set_value (*this, cst_rid, sid, ctxt);\n+\t  }\n+\treturn cst_rid;\n+      }\n+      break;\n+\n     case STRING_CST:\n       {\n \ttree cst_type = TREE_TYPE (expr);"}, {"sha": "b3a875efb8baf660f7289931fd8fd7348a0246b8", "filename": "gcc/testsuite/ChangeLog", "status": "modified", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/41a9e940c7014f117738a9a59b31833047a1083d/gcc%2Ftestsuite%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/41a9e940c7014f117738a9a59b31833047a1083d/gcc%2Ftestsuite%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2FChangeLog?ref=41a9e940c7014f117738a9a59b31833047a1083d", "patch": "@@ -1,3 +1,8 @@\n+2020-02-10  David Malcolm  <dmalcolm@redhat.com>\n+\n+\tPR analyzer/93405\n+\t* gfortran.dg/analyzer/pr93405.f90: New test.\n+\n 2020-02-10  David Malcolm  <dmalcolm@redhat.com>\n \n \t* gfortran.dg/analyzer/analyzer.exp: New subdirectory and .exp"}, {"sha": "e2c23753015f4e304527c3c9569b7aa20dfdee22", "filename": "gcc/testsuite/gfortran.dg/analyzer/pr93405.f90", "status": "added", "additions": 14, "deletions": 0, "changes": 14, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/41a9e940c7014f117738a9a59b31833047a1083d/gcc%2Ftestsuite%2Fgfortran.dg%2Fanalyzer%2Fpr93405.f90", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/41a9e940c7014f117738a9a59b31833047a1083d/gcc%2Ftestsuite%2Fgfortran.dg%2Fanalyzer%2Fpr93405.f90", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgfortran.dg%2Fanalyzer%2Fpr93405.f90?ref=41a9e940c7014f117738a9a59b31833047a1083d", "patch": "@@ -0,0 +1,14 @@\n+! { dg-do compile }\n+real a(10), b(10), c(10)\n+a = 0.\n+b = 1.\n+call sum(a, b, c, 10)\n+print *, c(5)\n+end\n+subroutine sum(a, b, c, n)\n+integer i, n\n+real a(n), b(n), c(n)\n+do i = 1, n\n+   c(i) = a(i) + b(i)\n+enddo\n+end"}]}