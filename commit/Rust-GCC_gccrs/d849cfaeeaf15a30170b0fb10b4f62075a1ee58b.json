{"sha": "d849cfaeeaf15a30170b0fb10b4f62075a1ee58b", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6ZDg0OWNmYWVlYWYxNWEzMDE3MGIwZmIxMGI0ZjYyMDc1YTFlZTU4Yg==", "commit": {"author": {"name": "Jason Merrill", "email": "jason@redhat.com", "date": "2019-03-18T19:35:12Z"}, "committer": {"name": "Jason Merrill", "email": "jason@gcc.gnu.org", "date": "2019-03-18T19:35:12Z"}, "message": "PR c++/89761 - ICE with sizeof... in pack expansion.\n\nIn this testcase we get confused when looking at the sizeof... because the\nargument pack for 'args' has been wrapped in an ARGUMENT_PACK_SELECT as part\nof expanding the fold-expression.  We handle this situation a bit lower down\nin tsubst_pack_expansion, but that doesn't help the call to\nargument_pack_element_is_expansion_p, which happens earlier.\n\n\t* pt.c (argument_pack_element_is_expansion_p): Handle\n\tARGUMENT_PACK_SELECT.\n\nFrom-SVN: r269776", "tree": {"sha": "c32251d20bb1609b1357de819c8f7add7824427a", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/c32251d20bb1609b1357de819c8f7add7824427a"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/d849cfaeeaf15a30170b0fb10b4f62075a1ee58b", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/d849cfaeeaf15a30170b0fb10b4f62075a1ee58b", "html_url": "https://github.com/Rust-GCC/gccrs/commit/d849cfaeeaf15a30170b0fb10b4f62075a1ee58b", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/d849cfaeeaf15a30170b0fb10b4f62075a1ee58b/comments", "author": {"login": "jicama", "id": 266146, "node_id": "MDQ6VXNlcjI2NjE0Ng==", "avatar_url": "https://avatars.githubusercontent.com/u/266146?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jicama", "html_url": "https://github.com/jicama", "followers_url": "https://api.github.com/users/jicama/followers", "following_url": "https://api.github.com/users/jicama/following{/other_user}", "gists_url": "https://api.github.com/users/jicama/gists{/gist_id}", "starred_url": "https://api.github.com/users/jicama/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jicama/subscriptions", "organizations_url": "https://api.github.com/users/jicama/orgs", "repos_url": "https://api.github.com/users/jicama/repos", "events_url": "https://api.github.com/users/jicama/events{/privacy}", "received_events_url": "https://api.github.com/users/jicama/received_events", "type": "User", "site_admin": false}, "committer": null, "parents": [{"sha": "6e3587dbbcefd4d4bdafaea0aa1cb8eb9495bd9c", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/6e3587dbbcefd4d4bdafaea0aa1cb8eb9495bd9c", "html_url": "https://github.com/Rust-GCC/gccrs/commit/6e3587dbbcefd4d4bdafaea0aa1cb8eb9495bd9c"}], "stats": {"total": 24, "additions": 24, "deletions": 0}, "files": [{"sha": "d4dc5d7146aa77f14b2c300768bdfa2d191201db", "filename": "gcc/cp/ChangeLog", "status": "modified", "additions": 4, "deletions": 0, "changes": 4, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/d849cfaeeaf15a30170b0fb10b4f62075a1ee58b/gcc%2Fcp%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/d849cfaeeaf15a30170b0fb10b4f62075a1ee58b/gcc%2Fcp%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fcp%2FChangeLog?ref=d849cfaeeaf15a30170b0fb10b4f62075a1ee58b", "patch": "@@ -1,5 +1,9 @@\n 2019-03-18  Jason Merrill  <jason@redhat.com>\n \n+\tPR c++/89761 - ICE with sizeof... in pack expansion.\n+\t* pt.c (argument_pack_element_is_expansion_p): Handle\n+\tARGUMENT_PACK_SELECT.\n+\n \tPR c++/89640 - GNU attributes on lambda.\n \t* parser.c (cp_parser_lambda_declarator_opt): Allow GNU attributes.\n "}, {"sha": "0acc16d1b92294cd5e58d91303b2584f69270d9a", "filename": "gcc/cp/pt.c", "status": "modified", "additions": 3, "deletions": 0, "changes": 3, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/d849cfaeeaf15a30170b0fb10b4f62075a1ee58b/gcc%2Fcp%2Fpt.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/d849cfaeeaf15a30170b0fb10b4f62075a1ee58b/gcc%2Fcp%2Fpt.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fcp%2Fpt.c?ref=d849cfaeeaf15a30170b0fb10b4f62075a1ee58b", "patch": "@@ -11544,6 +11544,9 @@ make_fnparm_pack (tree spec_parm)\n static int\n argument_pack_element_is_expansion_p (tree arg_pack, int i)\n {\n+  if (TREE_CODE (arg_pack) == ARGUMENT_PACK_SELECT)\n+    /* We're being called before this happens in tsubst_pack_expansion.  */\n+    arg_pack = ARGUMENT_PACK_SELECT_FROM_PACK (arg_pack);\n   tree vec = ARGUMENT_PACK_ARGS (arg_pack);\n   if (i >= TREE_VEC_LENGTH (vec))\n     return 0;"}, {"sha": "1bd39a05400015b77126dd91b8cfe8cc301ed0bc", "filename": "gcc/testsuite/g++.dg/cpp1z/fold10.C", "status": "added", "additions": 17, "deletions": 0, "changes": 17, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/d849cfaeeaf15a30170b0fb10b4f62075a1ee58b/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Fcpp1z%2Ffold10.C", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/d849cfaeeaf15a30170b0fb10b4f62075a1ee58b/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Fcpp1z%2Ffold10.C", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Fcpp1z%2Ffold10.C?ref=d849cfaeeaf15a30170b0fb10b4f62075a1ee58b", "patch": "@@ -0,0 +1,17 @@\n+// PR c++/89761\n+// { dg-do compile { target c++17 } }\n+\n+template <int...> struct seq {};\n+template <bool> struct S {\n+    template <typename Args>\n+    constexpr static void call(Args&&...) {}\n+};\n+\n+template <int ...Idx,typename ...Args>\n+auto foo (seq<Idx...>, Args&& ...args) {\n+    return (S<Idx==sizeof...(args)>::call(args), ...);\n+}\n+\n+void bar() {\n+    foo(seq<0,1,2>{}, 1,2,3);\n+}"}]}