{"sha": "37058415033503179d69f4d58e08dddae0a44142", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6MzcwNTg0MTUwMzM1MDMxNzlkNjlmNGQ1OGUwOGRkZGFlMGE0NDE0Mg==", "commit": {"author": {"name": "Francois-Xavier Coudert", "email": "fxcoudert@gcc.gnu.org", "date": "2007-07-14T23:11:04Z"}, "committer": {"name": "Fran\u00e7ois-Xavier Coudert", "email": "fxcoudert@gcc.gnu.org", "date": "2007-07-14T23:11:04Z"}, "message": "re PR fortran/32357 (MVBITS gives wrong-code on big-endian with -fdefault-integer-8)\n\n\tPR fortran/32357\n\n\t* iresolve.c (gfc_resolve_mvbits): Convert FROMPOS, LEN and TOPOS\n\tto C int.\n\n\t* intrinsics/mvbits.c: Change prototype so that FROMPOS, LEN and\n\tTOPOS arguments are C int.\n\n\t* gfortran.dg/mvbits_2.f90: New test.\n\nFrom-SVN: r126646", "tree": {"sha": "cb6072d1b22add852e30552e5ec23a6e5ded7c79", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/cb6072d1b22add852e30552e5ec23a6e5ded7c79"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/37058415033503179d69f4d58e08dddae0a44142", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/37058415033503179d69f4d58e08dddae0a44142", "html_url": "https://github.com/Rust-GCC/gccrs/commit/37058415033503179d69f4d58e08dddae0a44142", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/37058415033503179d69f4d58e08dddae0a44142/comments", "author": {"login": "fxcoudert", "id": 1980544, "node_id": "MDQ6VXNlcjE5ODA1NDQ=", "avatar_url": "https://avatars.githubusercontent.com/u/1980544?v=4", "gravatar_id": "", "url": "https://api.github.com/users/fxcoudert", "html_url": "https://github.com/fxcoudert", "followers_url": "https://api.github.com/users/fxcoudert/followers", "following_url": "https://api.github.com/users/fxcoudert/following{/other_user}", "gists_url": "https://api.github.com/users/fxcoudert/gists{/gist_id}", "starred_url": "https://api.github.com/users/fxcoudert/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/fxcoudert/subscriptions", "organizations_url": "https://api.github.com/users/fxcoudert/orgs", "repos_url": "https://api.github.com/users/fxcoudert/repos", "events_url": "https://api.github.com/users/fxcoudert/events{/privacy}", "received_events_url": "https://api.github.com/users/fxcoudert/received_events", "type": "User", "site_admin": false}, "committer": {"login": "fxcoudert", "id": 1980544, "node_id": "MDQ6VXNlcjE5ODA1NDQ=", "avatar_url": "https://avatars.githubusercontent.com/u/1980544?v=4", "gravatar_id": "", "url": "https://api.github.com/users/fxcoudert", "html_url": "https://github.com/fxcoudert", "followers_url": "https://api.github.com/users/fxcoudert/followers", "following_url": "https://api.github.com/users/fxcoudert/following{/other_user}", "gists_url": "https://api.github.com/users/fxcoudert/gists{/gist_id}", "starred_url": "https://api.github.com/users/fxcoudert/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/fxcoudert/subscriptions", "organizations_url": "https://api.github.com/users/fxcoudert/orgs", "repos_url": "https://api.github.com/users/fxcoudert/repos", "events_url": "https://api.github.com/users/fxcoudert/events{/privacy}", "received_events_url": "https://api.github.com/users/fxcoudert/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "00f46785eb6b0fd29997e5fe5756e9ef141a1b11", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/00f46785eb6b0fd29997e5fe5756e9ef141a1b11", "html_url": "https://github.com/Rust-GCC/gccrs/commit/00f46785eb6b0fd29997e5fe5756e9ef141a1b11"}], "stats": {"total": 60, "additions": 53, "deletions": 7}, "files": [{"sha": "1493c65ec4d7b6d0c79abad7e43152037f18bf47", "filename": "gcc/fortran/ChangeLog", "status": "modified", "additions": 6, "deletions": 0, "changes": 6, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/37058415033503179d69f4d58e08dddae0a44142/gcc%2Ffortran%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/37058415033503179d69f4d58e08dddae0a44142/gcc%2Ffortran%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ffortran%2FChangeLog?ref=37058415033503179d69f4d58e08dddae0a44142", "patch": "@@ -1,3 +1,9 @@\n+2007-07-15  Francois-Xavier Coudert  <fxcoudert@gcc.gnu.org>\n+\n+\tPR fortran/32357\n+\t* iresolve.c (gfc_resolve_mvbits): Convert FROMPOS, LEN and TOPOS\n+\tto C int.\n+\n 2007-07-14  Thomas Koenig  <tkoenig@gcc.gnu.org>\n \n \tPR libfortran/32731"}, {"sha": "22de74d49c4492ac9f9f53714c21d907e83c2045", "filename": "gcc/fortran/iresolve.c", "status": "modified", "additions": 16, "deletions": 3, "changes": 19, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/37058415033503179d69f4d58e08dddae0a44142/gcc%2Ffortran%2Firesolve.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/37058415033503179d69f4d58e08dddae0a44142/gcc%2Ffortran%2Firesolve.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ffortran%2Firesolve.c?ref=37058415033503179d69f4d58e08dddae0a44142", "patch": "@@ -2443,9 +2443,22 @@ void\n gfc_resolve_mvbits (gfc_code *c)\n {\n   const char *name;\n-  int kind;\n-  kind = c->ext.actual->expr->ts.kind;\n-  name = gfc_get_string (PREFIX (\"mvbits_i%d\"), kind);\n+  gfc_typespec ts;\n+\n+  /* FROMPOS, LEN and TOPOS are restricted to small values.  As such,\n+     they will be converted so that they fit into a C int.  */\n+  ts.type = BT_INTEGER;\n+  ts.kind = gfc_c_int_kind;\n+  if (c->ext.actual->next->expr->ts.kind != gfc_c_int_kind)\n+    gfc_convert_type (c->ext.actual->next->expr, &ts, 2);\n+  if (c->ext.actual->next->next->expr->ts.kind != gfc_c_int_kind)\n+    gfc_convert_type (c->ext.actual->next->next->expr, &ts, 2);\n+  if (c->ext.actual->next->next->next->next->expr->ts.kind != gfc_c_int_kind)\n+    gfc_convert_type (c->ext.actual->next->next->next->next->expr, &ts, 2);\n+\n+  /* TO and FROM are guaranteed to have the same kind parameter.  */\n+  name = gfc_get_string (PREFIX (\"mvbits_i%d\"),\n+\t\t\t c->ext.actual->expr->ts.kind);\n   c->resolved_sym = gfc_get_intrinsic_sub_symbol (name);\n }\n "}, {"sha": "61b2924554862496dc0ad3a2b0477044080e08dc", "filename": "gcc/testsuite/ChangeLog", "status": "modified", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/37058415033503179d69f4d58e08dddae0a44142/gcc%2Ftestsuite%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/37058415033503179d69f4d58e08dddae0a44142/gcc%2Ftestsuite%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2FChangeLog?ref=37058415033503179d69f4d58e08dddae0a44142", "patch": "@@ -1,3 +1,8 @@\n+2007-07-15  Francois-Xavier Coudert  <fxcoudert@gcc.gnu.org>\n+\n+\tPR fortran/32357\n+\t* gfortran.dg/mvbits_2.f90: New test.\n+\n 2007-07-14  Thomas Koenig  <tkoenig@gcc.gnu.org>\n \n \tPR libfortran/32731"}, {"sha": "885002ad6f202ab42f21646fca319606cc98132b", "filename": "gcc/testsuite/gfortran.dg/mvbits_2.f90", "status": "added", "additions": 16, "deletions": 0, "changes": 16, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/37058415033503179d69f4d58e08dddae0a44142/gcc%2Ftestsuite%2Fgfortran.dg%2Fmvbits_2.f90", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/37058415033503179d69f4d58e08dddae0a44142/gcc%2Ftestsuite%2Fgfortran.dg%2Fmvbits_2.f90", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgfortran.dg%2Fmvbits_2.f90?ref=37058415033503179d69f4d58e08dddae0a44142", "patch": "@@ -0,0 +1,16 @@\n+! Test for the MVBITS subroutine\n+! This used to fail on big-endian architectures (PR 32357)\n+! { dg-do run }\n+  integer(kind=8) :: i8 = 0\n+  integer(kind=4) :: i4 = 0\n+  integer(kind=2) :: i2 = 0\n+  integer(kind=1) :: i1 = 0\n+  call mvbits (1_1, 0, 8, i1, 0)\n+  if (i1 /= 1) call abort\n+  call mvbits (1_2, 0, 16, i2, 0)\n+  if (i2 /= 1) call abort\n+  call mvbits (1_4, 0, 16, i4, 0)\n+  if (i4 /= 1) call abort\n+  call mvbits (1_8, 0, 16, i8, 0)\n+  if (i8 /= 1) call abort\n+  end"}, {"sha": "7f4a815a6b91f8da5d6245bbcbbf4315f05d582a", "filename": "libgfortran/ChangeLog", "status": "modified", "additions": 6, "deletions": 0, "changes": 6, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/37058415033503179d69f4d58e08dddae0a44142/libgfortran%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/37058415033503179d69f4d58e08dddae0a44142/libgfortran%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libgfortran%2FChangeLog?ref=37058415033503179d69f4d58e08dddae0a44142", "patch": "@@ -1,3 +1,9 @@\n+2007-07-15  Francois-Xavier Coudert  <fxcoudert@gcc.gnu.org>\n+\n+\tPR fortran/32357\n+\t* intrinsics/mvbits.c: Change prototype so that FROMPOS, LEN and\n+\tTOPOS arguments are C int.\n+\n 2007-07-09  Jerry DeLisle  <jvdelisle@gcc.gnu.org>\n \n \tPR libgfortran/32702"}, {"sha": "8e5813c23623f67273c82d57debc642fa3fb0423", "filename": "libgfortran/intrinsics/mvbits.c", "status": "modified", "additions": 4, "deletions": 4, "changes": 8, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/37058415033503179d69f4d58e08dddae0a44142/libgfortran%2Fintrinsics%2Fmvbits.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/37058415033503179d69f4d58e08dddae0a44142/libgfortran%2Fintrinsics%2Fmvbits.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libgfortran%2Fintrinsics%2Fmvbits.c?ref=37058415033503179d69f4d58e08dddae0a44142", "patch": "@@ -38,13 +38,13 @@ Boston, MA 02110-1301, USA.  */\n /* MVBITS copies LEN bits starting at bit position FROMPOS from FROM\n    into TO, starting at bit position TOPOS.  */\n \n-extern void SUB_NAME (const TYPE *, const GFC_INTEGER_4 *,\n-\t\t      const GFC_INTEGER_4 *, TYPE *, const GFC_INTEGER_4 *);\n+extern void SUB_NAME (const TYPE *, const int *, const int *, TYPE *,\n+\t\t      const int *);\n export_proto(SUB_NAME);\n \n void \n-SUB_NAME (const TYPE *from, const GFC_INTEGER_4 *frompos,\n-          const GFC_INTEGER_4 *len, TYPE *to, const GFC_INTEGER_4 *topos)\n+SUB_NAME (const TYPE *from, const int *frompos, const int *len, TYPE *to,\n+\t  const int *topos)\n {\n   TYPE oldbits, newbits, lenmask;\n "}]}