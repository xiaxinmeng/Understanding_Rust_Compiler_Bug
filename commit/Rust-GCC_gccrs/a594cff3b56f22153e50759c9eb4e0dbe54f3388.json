{"sha": "a594cff3b56f22153e50759c9eb4e0dbe54f3388", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6YTU5NGNmZjNiNTZmMjIxNTNlNTA3NTljOWViNGUwZGJlNTRmMzM4OA==", "commit": {"author": {"name": "Martin Sebor", "email": "msebor@redhat.com", "date": "2018-01-03T20:43:47Z"}, "committer": {"name": "Martin Sebor", "email": "msebor@gcc.gnu.org", "date": "2018-01-03T20:43:47Z"}, "message": "PR c/83559 - -Wsuggest-attribute=const conflicts with -Wattributes warning about const attribute on function returning void\n\ngcc/ChangeLog:\n\n\tPR c/83559\n\t* doc/extend.texi (attribute const): Fix a typo.\n\t* ipa-pure-const.c ((warn_function_const, warn_function_pure): Avoid\n\tissuing -Wsuggest-attribute for void functions.\n\ngcc/testsuite/ChangeLog:\n\n\tPR c/83559\n\t* gcc.dg/const-2.c: New test.\n\t* gcc.dg/pure-3.c: New test.\n\nFrom-SVN: r256188", "tree": {"sha": "4f749714f4626da6f165eb6211413bf86d5ab660", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/4f749714f4626da6f165eb6211413bf86d5ab660"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/a594cff3b56f22153e50759c9eb4e0dbe54f3388", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/a594cff3b56f22153e50759c9eb4e0dbe54f3388", "html_url": "https://github.com/Rust-GCC/gccrs/commit/a594cff3b56f22153e50759c9eb4e0dbe54f3388", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/a594cff3b56f22153e50759c9eb4e0dbe54f3388/comments", "author": {"login": "msebor", "id": 381149, "node_id": "MDQ6VXNlcjM4MTE0OQ==", "avatar_url": "https://avatars.githubusercontent.com/u/381149?v=4", "gravatar_id": "", "url": "https://api.github.com/users/msebor", "html_url": "https://github.com/msebor", "followers_url": "https://api.github.com/users/msebor/followers", "following_url": "https://api.github.com/users/msebor/following{/other_user}", "gists_url": "https://api.github.com/users/msebor/gists{/gist_id}", "starred_url": "https://api.github.com/users/msebor/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/msebor/subscriptions", "organizations_url": "https://api.github.com/users/msebor/orgs", "repos_url": "https://api.github.com/users/msebor/repos", "events_url": "https://api.github.com/users/msebor/events{/privacy}", "received_events_url": "https://api.github.com/users/msebor/received_events", "type": "User", "site_admin": false}, "committer": null, "parents": [{"sha": "a6fd2cd769c3bb446085e45794fcb22481eed400", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/a6fd2cd769c3bb446085e45794fcb22481eed400", "html_url": "https://github.com/Rust-GCC/gccrs/commit/a6fd2cd769c3bb446085e45794fcb22481eed400"}], "stats": {"total": 76, "additions": 72, "deletions": 4}, "files": [{"sha": "8786a9110871725a5406ad8615e7c2543e94d702", "filename": "gcc/ChangeLog", "status": "modified", "additions": 7, "deletions": 0, "changes": 7, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/a594cff3b56f22153e50759c9eb4e0dbe54f3388/gcc%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/a594cff3b56f22153e50759c9eb4e0dbe54f3388/gcc%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2FChangeLog?ref=a594cff3b56f22153e50759c9eb4e0dbe54f3388", "patch": "@@ -1,3 +1,10 @@\n+2018-01-03  Martin Sebor  <msebor@redhat.com>\n+\n+\tPR c/83559\n+\t* doc/extend.texi (attribute const): Fix a typo.\n+\t* ipa-pure-const.c ((warn_function_const, warn_function_pure): Avoid\n+\tissuing -Wsuggest-attribute for void functions.\n+\n 2018-01-03  Martin Sebor  <msebor@redhat.com>\n \n \t* gimple-ssa-warn-restrict.c (builtin_memref::builtin_memref): Use"}, {"sha": "5f0f4b86cb28149159c8daee45d6628c6e43742a", "filename": "gcc/doc/extend.texi", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/a594cff3b56f22153e50759c9eb4e0dbe54f3388/gcc%2Fdoc%2Fextend.texi", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/a594cff3b56f22153e50759c9eb4e0dbe54f3388/gcc%2Fdoc%2Fextend.texi", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fdoc%2Fextend.texi?ref=a594cff3b56f22153e50759c9eb4e0dbe54f3388", "patch": "@@ -2500,7 +2500,7 @@ definition than the similar @code{pure} attribute below because it prohibits\n the function from reading global variables.  Consequently, the presence of\n the attribute on a function declarations allows GCC to emit more efficient\n code for some calls to the function.  Decorating the same function with\n-both the @code{const} and the @code{pure} attribute is diagnnosed.\n+both the @code{const} and the @code{pure} attribute is diagnosed.\n \n @cindex pointer arguments\n Note that a function that has pointer arguments and examines the data"}, {"sha": "a80b6845633e009373486323345f0584ad3dc1ef", "filename": "gcc/ipa-pure-const.c", "status": "modified", "additions": 12, "deletions": 3, "changes": 15, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/a594cff3b56f22153e50759c9eb4e0dbe54f3388/gcc%2Fipa-pure-const.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/a594cff3b56f22153e50759c9eb4e0dbe54f3388/gcc%2Fipa-pure-const.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fipa-pure-const.c?ref=a594cff3b56f22153e50759c9eb4e0dbe54f3388", "patch": "@@ -213,9 +213,13 @@ suggest_attribute (int option, tree decl, bool known_finite,\n static void\n warn_function_pure (tree decl, bool known_finite)\n {\n-  static hash_set<tree> *warned_about;\n+  /* Declaring a void function pure makes no sense and is diagnosed\n+     by -Wattributes because calling it would have no effect.  */\n+  if (VOID_TYPE_P (TREE_TYPE (TREE_TYPE (decl))))\n+    return;\n \n-  warned_about \n+  static hash_set<tree> *warned_about;\n+  warned_about\n     = suggest_attribute (OPT_Wsuggest_attribute_pure, decl,\n \t\t\t known_finite, warned_about, \"pure\");\n }\n@@ -226,8 +230,13 @@ warn_function_pure (tree decl, bool known_finite)\n static void\n warn_function_const (tree decl, bool known_finite)\n {\n+  /* Declaring a void function const makes no sense is diagnosed\n+     by -Wattributes because calling it would have no effect.  */\n+  if (VOID_TYPE_P (TREE_TYPE (TREE_TYPE (decl))))\n+    return;\n+\n   static hash_set<tree> *warned_about;\n-  warned_about \n+  warned_about\n     = suggest_attribute (OPT_Wsuggest_attribute_const, decl,\n \t\t\t known_finite, warned_about, \"const\");\n }"}, {"sha": "23c5d1ccbd840720baed04b8e29e6c7bd5a34c11", "filename": "gcc/testsuite/ChangeLog", "status": "modified", "additions": 6, "deletions": 0, "changes": 6, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/a594cff3b56f22153e50759c9eb4e0dbe54f3388/gcc%2Ftestsuite%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/a594cff3b56f22153e50759c9eb4e0dbe54f3388/gcc%2Ftestsuite%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2FChangeLog?ref=a594cff3b56f22153e50759c9eb4e0dbe54f3388", "patch": "@@ -1,3 +1,9 @@\n+2018-01-03  Martin Sebor  <msebor@redhat.com>\n+\n+\tPR c/83559\n+\t* gcc.dg/const-2.c: New test.\n+\t* gcc.dg/pure-3.c: New test.\n+\n 2018-01-03  Martin Sebor  <msebor@redhat.com>\n \n \t* gcc.dg/Wrestrict-3.c: New test."}, {"sha": "e48005dfb0ad4b80b2c448748b6d01394c4cbe76", "filename": "gcc/testsuite/gcc.dg/const-2.c", "status": "added", "additions": 22, "deletions": 0, "changes": 22, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/a594cff3b56f22153e50759c9eb4e0dbe54f3388/gcc%2Ftestsuite%2Fgcc.dg%2Fconst-2.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/a594cff3b56f22153e50759c9eb4e0dbe54f3388/gcc%2Ftestsuite%2Fgcc.dg%2Fconst-2.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgcc.dg%2Fconst-2.c?ref=a594cff3b56f22153e50759c9eb4e0dbe54f3388", "patch": "@@ -0,0 +1,22 @@\n+/* PR tree-optimization/83559 - -Wsuggest-attribute=const conflicts with\n+   -Wattributes warning about const attribute on function returning void\n+   { dg-do compile { target nonpic } }\n+   { dg-options \"-O2 -Wsuggest-attribute=const\" } */\n+\n+int f_i_v (void)    /* { dg-warning \"candidate for attribute .const.\" } */\n+{\n+  return 0;\n+}\n+\n+int f_i ()          /* { dg-warning \"candidate for attribute .const.\" } */\n+{\n+  return 0;\n+}\n+\n+void f_v_v (void)   /* { dg-bogus \"candidate\" } */\n+{\n+}\n+\n+void f_v ()         /* { dg-bogus \"candidate\" } */\n+{\n+}"}, {"sha": "2eeb8a30e9c8333f299de51b5a90f871fa40a1e2", "filename": "gcc/testsuite/gcc.dg/pure-3.c", "status": "added", "additions": 24, "deletions": 0, "changes": 24, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/a594cff3b56f22153e50759c9eb4e0dbe54f3388/gcc%2Ftestsuite%2Fgcc.dg%2Fpure-3.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/a594cff3b56f22153e50759c9eb4e0dbe54f3388/gcc%2Ftestsuite%2Fgcc.dg%2Fpure-3.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgcc.dg%2Fpure-3.c?ref=a594cff3b56f22153e50759c9eb4e0dbe54f3388", "patch": "@@ -0,0 +1,24 @@\n+/* PR tree-optimization/83559 - -Wsuggest-attribute=const conflicts with\n+   -Wattributes warning about const attribute on function returning void\n+   { dg-do compile { target nonpic } }\n+   { dg-options \"-O2 -Wsuggest-attribute=pure\" } */\n+\n+int global;\n+\n+int f_i_v (void)    /* { dg-warning \"candidate for attribute .pure.\" } */\n+{\n+  return global;\n+}\n+\n+int f_i ()          /* { dg-warning \"candidate for attribute .pure.\" } */\n+{\n+  return global;\n+}\n+\n+void f_v_v (void)   /* { dg-bogus \"candidate\" } */\n+{\n+}\n+\n+void f_v ()         /* { dg-bogus \"candidate\" } */\n+{\n+}"}]}