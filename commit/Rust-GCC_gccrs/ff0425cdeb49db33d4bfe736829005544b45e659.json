{"sha": "ff0425cdeb49db33d4bfe736829005544b45e659", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6ZmYwNDI1Y2RlYjQ5ZGIzM2Q0YmZlNzM2ODI5MDA1NTQ0YjQ1ZTY1OQ==", "commit": {"author": {"name": "Jonathan Wakely", "email": "jwakely@redhat.com", "date": "2019-01-08T08:57:58Z"}, "committer": {"name": "Jakub Jelinek", "email": "jakub@gcc.gnu.org", "date": "2019-01-08T08:57:58Z"}, "message": "re PR c++/88554 (Segfault ICE when falling off the end of a reference-returning friend operator)\n\n\tPR c++/88554\n\t* decl.c (finish_function): For -Wreturn-type don't add a return *this;\n\tfixit hint if current_class_ref is NULL.  Use a single if instead of\n\ttwo nested ones.\n\n\t* g++.dg/warn/Wreturn-type-11.C: New test.\n\nCo-Authored-By: Jakub Jelinek <jakub@redhat.com>\n\nFrom-SVN: r267672", "tree": {"sha": "2543158574fdc0776e2b1b7f480d733de18aedff", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/2543158574fdc0776e2b1b7f480d733de18aedff"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/ff0425cdeb49db33d4bfe736829005544b45e659", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/ff0425cdeb49db33d4bfe736829005544b45e659", "html_url": "https://github.com/Rust-GCC/gccrs/commit/ff0425cdeb49db33d4bfe736829005544b45e659", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/ff0425cdeb49db33d4bfe736829005544b45e659/comments", "author": {"login": "jwakely", "id": 1254480, "node_id": "MDQ6VXNlcjEyNTQ0ODA=", "avatar_url": "https://avatars.githubusercontent.com/u/1254480?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jwakely", "html_url": "https://github.com/jwakely", "followers_url": "https://api.github.com/users/jwakely/followers", "following_url": "https://api.github.com/users/jwakely/following{/other_user}", "gists_url": "https://api.github.com/users/jwakely/gists{/gist_id}", "starred_url": "https://api.github.com/users/jwakely/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jwakely/subscriptions", "organizations_url": "https://api.github.com/users/jwakely/orgs", "repos_url": "https://api.github.com/users/jwakely/repos", "events_url": "https://api.github.com/users/jwakely/events{/privacy}", "received_events_url": "https://api.github.com/users/jwakely/received_events", "type": "User", "site_admin": false}, "committer": null, "parents": [{"sha": "44e813ecd1fa610e3e4ed2420a69d4a1e200b19c", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/44e813ecd1fa610e3e4ed2420a69d4a1e200b19c", "html_url": "https://github.com/Rust-GCC/gccrs/commit/44e813ecd1fa610e3e4ed2420a69d4a1e200b19c"}], "stats": {"total": 34, "additions": 30, "deletions": 4}, "files": [{"sha": "32c7f40b2129f994d7b3514a23a9410010244402", "filename": "gcc/cp/ChangeLog", "status": "modified", "additions": 8, "deletions": 0, "changes": 8, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/ff0425cdeb49db33d4bfe736829005544b45e659/gcc%2Fcp%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/ff0425cdeb49db33d4bfe736829005544b45e659/gcc%2Fcp%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fcp%2FChangeLog?ref=ff0425cdeb49db33d4bfe736829005544b45e659", "patch": "@@ -1,3 +1,11 @@\n+2019-01-08  Jonathan Wakely  <jwakely@redhat.com>\n+\t    Jakub Jelinek  <jakub@redhat.com>\n+\n+\tPR c++/88554\n+\t* decl.c (finish_function): For -Wreturn-type don't add a return *this;\n+\tfixit hint if current_class_ref is NULL.  Use a single if instead of\n+\ttwo nested ones.\n+\n 2019-01-07  Paolo Carlini  <paolo.carlini@oracle.com>\n \n \t* decl.c (start_decl): Improve two error_at locations."}, {"sha": "f456c070dcd2f361874933125a9fd5ee8b7a1acf", "filename": "gcc/cp/decl.c", "status": "modified", "additions": 5, "deletions": 4, "changes": 9, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/ff0425cdeb49db33d4bfe736829005544b45e659/gcc%2Fcp%2Fdecl.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/ff0425cdeb49db33d4bfe736829005544b45e659/gcc%2Fcp%2Fdecl.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fcp%2Fdecl.c?ref=ff0425cdeb49db33d4bfe736829005544b45e659", "patch": "@@ -16097,11 +16097,12 @@ finish_function (bool inline_p)\n \t{\n \t  tree valtype = TREE_TYPE (DECL_RESULT (fndecl));\n \t  if (TREE_CODE (valtype) == REFERENCE_TYPE\n+\t      && current_class_ref\n \t      && same_type_ignoring_top_level_qualifiers_p\n-\t\t  (TREE_TYPE (valtype), TREE_TYPE (current_class_ref)))\n-\t    if (global_dc->option_enabled (OPT_Wreturn_type,\n-\t\t\t\t\t   global_dc->option_state))\n-\t      add_return_star_this_fixit (&richloc, fndecl);\n+\t\t  (TREE_TYPE (valtype), TREE_TYPE (current_class_ref))\n+\t      && global_dc->option_enabled (OPT_Wreturn_type,\n+\t\t\t\t\t    global_dc->option_state))\n+\t    add_return_star_this_fixit (&richloc, fndecl);\n \t}\n       warning_at (&richloc, OPT_Wreturn_type,\n \t\t  \"no return statement in function returning non-void\");"}, {"sha": "552ba4dd9778a3eb85bfdf3bcde455024992dc90", "filename": "gcc/testsuite/ChangeLog", "status": "modified", "additions": 6, "deletions": 0, "changes": 6, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/ff0425cdeb49db33d4bfe736829005544b45e659/gcc%2Ftestsuite%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/ff0425cdeb49db33d4bfe736829005544b45e659/gcc%2Ftestsuite%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2FChangeLog?ref=ff0425cdeb49db33d4bfe736829005544b45e659", "patch": "@@ -1,3 +1,9 @@\n+2019-01-08  Jonathan Wakely  <jwakely@redhat.com>\n+\t    Jakub Jelinek  <jakub@redhat.com>\n+\n+\tPR c++/88554\n+\t* g++.dg/warn/Wreturn-type-11.C: New test.\n+\n 2019-01-07  David Malcolm  <dmalcolm@redhat.com>\n \n \tPR jit/88747"}, {"sha": "35d05eb6012c80a7b832fae904f6b4a37d7f4083", "filename": "gcc/testsuite/g++.dg/warn/Wreturn-type-11.C", "status": "added", "additions": 11, "deletions": 0, "changes": 11, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/ff0425cdeb49db33d4bfe736829005544b45e659/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Fwarn%2FWreturn-type-11.C", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/ff0425cdeb49db33d4bfe736829005544b45e659/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Fwarn%2FWreturn-type-11.C", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Fwarn%2FWreturn-type-11.C?ref=ff0425cdeb49db33d4bfe736829005544b45e659", "patch": "@@ -0,0 +1,11 @@\n+// PR c++/88554\n+// { dg-do compile }\n+// { dg-options \"-Wreturn-type\" }\n+\n+struct X {\n+  friend X & operator+= (X &, int) { }\t// { dg-warning \"no return statement in function returning non-void\" }\n+\t\t\t\t\t// { dg-bogus \"return \\\\*this;\" \"\" { target *-*-* } .-1 }\n+};\n+struct Y {};\n+Y & operator += (Y &, Y &) { }\t\t// { dg-warning \"no return statement in function returning non-void\" }\n+\t\t\t\t\t// { dg-bogus \"return \\\\*this;\" \"\" { target *-*-* } .-1 }"}]}