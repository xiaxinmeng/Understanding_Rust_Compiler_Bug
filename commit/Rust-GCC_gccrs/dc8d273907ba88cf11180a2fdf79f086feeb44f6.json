{"sha": "dc8d273907ba88cf11180a2fdf79f086feeb44f6", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6ZGM4ZDI3MzkwN2JhODhjZjExMTgwYTJmZGY3OWYwODZmZWViNDRmNg==", "commit": {"author": {"name": "Manuel L\u00f3pez-Ib\u00e1\u00f1ez", "email": "manu@gcc.gnu.org", "date": "2010-04-09T07:49:41Z"}, "committer": {"name": "Manuel L\u00f3pez-Ib\u00e1\u00f1ez", "email": "manu@gcc.gnu.org", "date": "2010-04-09T07:49:41Z"}, "message": "re PR c++/28584 (Cast to pointer from integer of different size)\n\n2010-04-09  Manuel L\u00f3pez-Ib\u00e1\u00f1ez  <manu@gcc.gnu.org>\n\n\tPR c++/28584\n\t* c.opt (Wint-to-pointer-cast): Available in C++.\n\t* doc/invoke.texi (Wint-to-pointer-cast): Available in C++.\ncp/\n\t* typeck.c (cp_build_c_cast): Warn for casting integer to larger\n\tpointer type.\ntestsuite/\n\t* gcc.dg/Wint-to-pointer-cast-1.c: Move to...\n\t* c-c++-common/Wint-to-pointer-cast-1.c: ...  here.\n\t* gcc.dg/Wint-to-pointer-cast-2.c: Move to...\t\n\t* c-c++-common/Wint-to-pointer-cast-2.c: ...  here.\n\t* gcc.dg/Wint-to-pointer-cast-3.c: Move to...\t\n\t* c-c++-common/Wint-to-pointer-cast-3.c: ...  here. Update.\n\t* g++.old-deja/g++.mike/warn1.C: Add -Wno-int-to-pointer-cast.\n\t* g++.dg/other/increment1.C: Likewise.\n\nFrom-SVN: r158150", "tree": {"sha": "d3948de1f31acd50882bef52bb6d0f63b19293a6", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/d3948de1f31acd50882bef52bb6d0f63b19293a6"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/dc8d273907ba88cf11180a2fdf79f086feeb44f6", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/dc8d273907ba88cf11180a2fdf79f086feeb44f6", "html_url": "https://github.com/Rust-GCC/gccrs/commit/dc8d273907ba88cf11180a2fdf79f086feeb44f6", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/dc8d273907ba88cf11180a2fdf79f086feeb44f6/comments", "author": null, "committer": null, "parents": [{"sha": "d3a9eea2c0e65e0f03c249bab8aa3fa56149dfe0", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/d3a9eea2c0e65e0f03c249bab8aa3fa56149dfe0", "html_url": "https://github.com/Rust-GCC/gccrs/commit/d3a9eea2c0e65e0f03c249bab8aa3fa56149dfe0"}], "stats": {"total": 48, "additions": 43, "deletions": 5}, "files": [{"sha": "23377d1d760ffcc7b570e43d6d32d066a9faaf36", "filename": "gcc/ChangeLog", "status": "modified", "additions": 6, "deletions": 0, "changes": 6, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/dc8d273907ba88cf11180a2fdf79f086feeb44f6/gcc%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/dc8d273907ba88cf11180a2fdf79f086feeb44f6/gcc%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2FChangeLog?ref=dc8d273907ba88cf11180a2fdf79f086feeb44f6", "patch": "@@ -1,3 +1,9 @@\n+2010-04-09  Manuel L\u00f3pez-Ib\u00e1\u00f1ez  <manu@gcc.gnu.org>\n+\n+\tPR c++/28584\n+\t* c.opt (Wint-to-pointer-cast): Available in C++.\n+\t* doc/invoke.texi (Wint-to-pointer-cast): Available in C++.\n+\n 2010-04-08  Eric Botcazou  <ebotcazou@adacore.com>\n \n \t* tree.h (TREE_ADDRESSABLE): Document its effect for function types."}, {"sha": "973acf46c210da89c0dbd46532d86c421c05afa0", "filename": "gcc/c.opt", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/dc8d273907ba88cf11180a2fdf79f086feeb44f6/gcc%2Fc.opt", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/dc8d273907ba88cf11180a2fdf79f086feeb44f6/gcc%2Fc.opt", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fc.opt?ref=dc8d273907ba88cf11180a2fdf79f086feeb44f6", "patch": "@@ -277,7 +277,7 @@ Wimport\n C ObjC C++ ObjC++ Undocumented\n \n Wint-to-pointer-cast\n-C ObjC Var(warn_int_to_pointer_cast) Init(1) Warning\n+C ObjC C++ ObjC++ Var(warn_int_to_pointer_cast) Init(1) Warning\n Warn when there is a cast to a pointer from an integer of a different size\n \n Winvalid-offsetof"}, {"sha": "c40e368f46c871c474064bc40c5c3cb5e6e9c819", "filename": "gcc/cp/ChangeLog", "status": "modified", "additions": 6, "deletions": 0, "changes": 6, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/dc8d273907ba88cf11180a2fdf79f086feeb44f6/gcc%2Fcp%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/dc8d273907ba88cf11180a2fdf79f086feeb44f6/gcc%2Fcp%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fcp%2FChangeLog?ref=dc8d273907ba88cf11180a2fdf79f086feeb44f6", "patch": "@@ -1,3 +1,9 @@\n+2010-04-09  Manuel L\u00f3pez-Ib\u00e1\u00f1ez  <manu@gcc.gnu.org>\n+\n+\tPR c++/28584\n+\t* typeck.c (cp_build_c_cast): Warn for casting integer to larger\n+\tpointer type.\n+\n 2010-04-07  Jason Merrill  <jason@redhat.com>\n \n \tPR c++/43016"}, {"sha": "383754bea4df94995609f09edaa8dfaa0b10a597", "filename": "gcc/cp/typeck.c", "status": "modified", "additions": 9, "deletions": 0, "changes": 9, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/dc8d273907ba88cf11180a2fdf79f086feeb44f6/gcc%2Fcp%2Ftypeck.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/dc8d273907ba88cf11180a2fdf79f086feeb44f6/gcc%2Fcp%2Ftypeck.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fcp%2Ftypeck.c?ref=dc8d273907ba88cf11180a2fdf79f086feeb44f6", "patch": "@@ -6289,6 +6289,15 @@ cp_build_c_cast (tree type, tree expr, tsubst_flags_t complain)\n       return error_mark_node;\n     }\n \n+  if (TREE_CODE (type) == POINTER_TYPE\n+      && TREE_CODE (TREE_TYPE (value)) == INTEGER_TYPE\n+      /* Casting to an integer of smaller size is an error detected elsewhere.  */\n+      && TYPE_PRECISION (type) > TYPE_PRECISION (TREE_TYPE (value))\n+      /* Don't warn about converting any constant.  */\n+      && !TREE_CONSTANT (value))\n+    warning_at (input_location, OPT_Wint_to_pointer_cast, \n+\t\t\"cast to pointer from integer of different size\");\n+\n   /* A C-style cast can be a const_cast.  */\n   result = build_const_cast_1 (type, value, /*complain=*/false,\n \t\t\t       &valid_p);"}, {"sha": "ad7d097990fde7cebe36dd6284c0b17c6f3ba533", "filename": "gcc/doc/invoke.texi", "status": "modified", "additions": 4, "deletions": 2, "changes": 6, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/dc8d273907ba88cf11180a2fdf79f086feeb44f6/gcc%2Fdoc%2Finvoke.texi", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/dc8d273907ba88cf11180a2fdf79f086feeb44f6/gcc%2Fdoc%2Finvoke.texi", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fdoc%2Finvoke.texi?ref=dc8d273907ba88cf11180a2fdf79f086feeb44f6", "patch": "@@ -4284,11 +4284,13 @@ warning about it.\n The restrictions on @samp{offsetof} may be relaxed in a future version\n of the C++ standard.\n \n-@item -Wno-int-to-pointer-cast @r{(C and Objective-C only)}\n+@item -Wno-int-to-pointer-cast\n @opindex Wno-int-to-pointer-cast\n @opindex Wint-to-pointer-cast\n Suppress warnings from casts to pointer type of an integer of a\n-different size.\n+different size. In C++, casting to a pointer type of smaller size is\n+an error. @option{Wint-to-pointer-cast} is enabled by default.\n+\n \n @item -Wno-pointer-to-int-cast @r{(C and Objective-C only)}\n @opindex Wno-pointer-to-int-cast"}, {"sha": "17277cf65332d35e99593c9267c8c0518b914233", "filename": "gcc/testsuite/ChangeLog", "status": "modified", "additions": 12, "deletions": 0, "changes": 12, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/dc8d273907ba88cf11180a2fdf79f086feeb44f6/gcc%2Ftestsuite%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/dc8d273907ba88cf11180a2fdf79f086feeb44f6/gcc%2Ftestsuite%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2FChangeLog?ref=dc8d273907ba88cf11180a2fdf79f086feeb44f6", "patch": "@@ -1,3 +1,15 @@\n+2010-04-09  Manuel L\u00f3pez-Ib\u00e1\u00f1ez  <manu@gcc.gnu.org>\n+\n+\tPR c++/28584\n+\t* gcc.dg/Wint-to-pointer-cast-1.c: Move to...\n+\t* c-c++-common/Wint-to-pointer-cast-1.c: ...  here.\n+\t* gcc.dg/Wint-to-pointer-cast-2.c: Move to...\t\n+\t* c-c++-common/Wint-to-pointer-cast-2.c: ...  here.\n+\t* gcc.dg/Wint-to-pointer-cast-3.c: Move to...\t\n+\t* c-c++-common/Wint-to-pointer-cast-3.c: ...  here. Update.\n+\t* g++.old-deja/g++.mike/warn1.C: Add -Wno-int-to-pointer-cast.\n+\t* g++.dg/other/increment1.C: Likewise.\n+\n 2010-04-09  Tobias Burnus  <burnus@net-b.de>\n \n \tPR fortran/18918"}, {"sha": "a7687a60758fb1e1afc16a24046522590ec986ac", "filename": "gcc/testsuite/c-c++-common/Wint-to-pointer-cast-1.c", "status": "renamed", "additions": 0, "deletions": 0, "changes": 0, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/dc8d273907ba88cf11180a2fdf79f086feeb44f6/gcc%2Ftestsuite%2Fc-c%2B%2B-common%2FWint-to-pointer-cast-1.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/dc8d273907ba88cf11180a2fdf79f086feeb44f6/gcc%2Ftestsuite%2Fc-c%2B%2B-common%2FWint-to-pointer-cast-1.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fc-c%2B%2B-common%2FWint-to-pointer-cast-1.c?ref=dc8d273907ba88cf11180a2fdf79f086feeb44f6", "previous_filename": "gcc/testsuite/gcc.dg/Wint-to-pointer-cast-1.c"}, {"sha": "5546abb8186085129f9068eeca98b4351f46d323", "filename": "gcc/testsuite/c-c++-common/Wint-to-pointer-cast-2.c", "status": "renamed", "additions": 0, "deletions": 0, "changes": 0, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/dc8d273907ba88cf11180a2fdf79f086feeb44f6/gcc%2Ftestsuite%2Fc-c%2B%2B-common%2FWint-to-pointer-cast-2.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/dc8d273907ba88cf11180a2fdf79f086feeb44f6/gcc%2Ftestsuite%2Fc-c%2B%2B-common%2FWint-to-pointer-cast-2.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fc-c%2B%2B-common%2FWint-to-pointer-cast-2.c?ref=dc8d273907ba88cf11180a2fdf79f086feeb44f6", "previous_filename": "gcc/testsuite/gcc.dg/Wint-to-pointer-cast-2.c"}, {"sha": "052ab3727fca20fb627d1e246617c8edeff460d5", "filename": "gcc/testsuite/c-c++-common/Wint-to-pointer-cast-3.c", "status": "renamed", "additions": 3, "deletions": 1, "changes": 4, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/dc8d273907ba88cf11180a2fdf79f086feeb44f6/gcc%2Ftestsuite%2Fc-c%2B%2B-common%2FWint-to-pointer-cast-3.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/dc8d273907ba88cf11180a2fdf79f086feeb44f6/gcc%2Ftestsuite%2Fc-c%2B%2B-common%2FWint-to-pointer-cast-3.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fc-c%2B%2B-common%2FWint-to-pointer-cast-3.c?ref=dc8d273907ba88cf11180a2fdf79f086feeb44f6", "patch": "@@ -16,5 +16,7 @@ void *p;\n char\n g (void)\n {\n-  return (char) p; /* { dg-warning \"cast from pointer to integer of different size\" } */\n+  return (char) p;\n+/* { dg-warning \"cast from pointer to integer of different size\" \"\" { target c } 19 } */\n+/* { dg-error \"cast from 'void\\\\*' to 'char' loses precision\" \"\" { target c++ } 19 } */\n }", "previous_filename": "gcc/testsuite/gcc.dg/Wint-to-pointer-cast-3.c"}, {"sha": "506157ef24e2fa6dcdb5a7b4b2e69bdbcd133fb9", "filename": "gcc/testsuite/g++.dg/other/increment1.C", "status": "modified", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/dc8d273907ba88cf11180a2fdf79f086feeb44f6/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Fother%2Fincrement1.C", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/dc8d273907ba88cf11180a2fdf79f086feeb44f6/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Fother%2Fincrement1.C", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Fother%2Fincrement1.C?ref=dc8d273907ba88cf11180a2fdf79f086feeb44f6", "patch": "@@ -1,5 +1,6 @@\n // PR c++/37561\n // { dg-do compile }\n+// { dg-options \"-Wno-int-to-pointer-cast\" }\n \n __PTRDIFF_TYPE__ p;\n char q;"}, {"sha": "5d6fdec5291dfac6cc57a66c516bbc8272bd375f", "filename": "gcc/testsuite/g++.old-deja/g++.mike/warn1.C", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/dc8d273907ba88cf11180a2fdf79f086feeb44f6/gcc%2Ftestsuite%2Fg%2B%2B.old-deja%2Fg%2B%2B.mike%2Fwarn1.C", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/dc8d273907ba88cf11180a2fdf79f086feeb44f6/gcc%2Ftestsuite%2Fg%2B%2B.old-deja%2Fg%2B%2B.mike%2Fwarn1.C", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fg%2B%2B.old-deja%2Fg%2B%2B.mike%2Fwarn1.C?ref=dc8d273907ba88cf11180a2fdf79f086feeb44f6", "patch": "@@ -1,5 +1,5 @@\n // { dg-do assemble  }\n-// { dg-options \"-Wall\" }\n+// { dg-options \"-Wall -Wno-int-to-pointer-cast\" }\n \n typedef char * charptr;\n typedef __SIZE_TYPE__ size_t;"}]}