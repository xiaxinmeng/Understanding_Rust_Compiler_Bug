{"sha": "b158b5c6aa0a3773622552c165ee88ebc31ab004", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6YjE1OGI1YzZhYTBhMzc3MzYyMjU1MmMxNjVlZTg4ZWJjMzFhYjAwNA==", "commit": {"author": {"name": "Alon Dayan", "email": "alond@il.ibm.com", "date": "2008-01-21T09:07:12Z"}, "committer": {"name": "Olga Golovanevsky", "email": "olga@gcc.gnu.org", "date": "2008-01-21T09:07:12Z"}, "message": "re PR middle-end/34701 (ICE in tree-ssa-ccp.c with -fipa-struct-reorg)\n\n2008-01-21  Alon Dayan  <alond@il.ibm.com>\n\t    Olga Golovanevsky  <olga@il.ibm.com>\n\n\tPR tree-optimization/34701\n\t* gcc.dg/struct/wo_prof_array_field.c: New test.\n\t\n2008-01-21  Alon Dayan  <alond@il.ibm.com>\n\t    Olga Golovanevsky  <olga@il.ibm.com>\n\t\n\tPR tree-optimization/34701\n\t* ipa-struct-reorg.c (gen_size): Fix the malloc parameter calculation\n\twhen the structure size is not a power of 2.\n\nCo-Authored-By: Olga Golovanevsky <olga@il.ibm.com>\n\nFrom-SVN: r131689", "tree": {"sha": "0e7ce94084774885f2271b72843dc3ab47004225", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/0e7ce94084774885f2271b72843dc3ab47004225"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/b158b5c6aa0a3773622552c165ee88ebc31ab004", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/b158b5c6aa0a3773622552c165ee88ebc31ab004", "html_url": "https://github.com/Rust-GCC/gccrs/commit/b158b5c6aa0a3773622552c165ee88ebc31ab004", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/b158b5c6aa0a3773622552c165ee88ebc31ab004/comments", "author": null, "committer": null, "parents": [{"sha": "b8ce93da2d75be94304dbc519156ad0181bcfa36", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/b8ce93da2d75be94304dbc519156ad0181bcfa36", "html_url": "https://github.com/Rust-GCC/gccrs/commit/b8ce93da2d75be94304dbc519156ad0181bcfa36"}], "stats": {"total": 47, "additions": 46, "deletions": 1}, "files": [{"sha": "28474ddf8a3b634f3bedd0bdbb44d0cb90bab63b", "filename": "gcc/ChangeLog", "status": "modified", "additions": 7, "deletions": 0, "changes": 7, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/b158b5c6aa0a3773622552c165ee88ebc31ab004/gcc%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/b158b5c6aa0a3773622552c165ee88ebc31ab004/gcc%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2FChangeLog?ref=b158b5c6aa0a3773622552c165ee88ebc31ab004", "patch": "@@ -1,3 +1,10 @@\n+2008-01-21  Alon Dayan  <alond@il.ibm.com>\n+\t    Olga Golovanevsky  <olga@il.ibm.com>\n+\t\n+\tPR tree-optimization/34701\n+\t* ipa-struct-reorg.c (gen_size): Fix the malloc parameter calculation\n+\twhen the structure size is not a power of 2.\n+\n 2008-01-20  Kenneth Zadeck <zadeck@naturalbridge.com>\n \n \t* doc/install.texi: Add doc for --enable-checking=df."}, {"sha": "0619576e7327a7bc1a30b8dac8dfbd2e93581ea8", "filename": "gcc/ipa-struct-reorg.c", "status": "modified", "additions": 6, "deletions": 1, "changes": 7, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/b158b5c6aa0a3773622552c165ee88ebc31ab004/gcc%2Fipa-struct-reorg.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/b158b5c6aa0a3773622552c165ee88ebc31ab004/gcc%2Fipa-struct-reorg.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fipa-struct-reorg.c?ref=b158b5c6aa0a3773622552c165ee88ebc31ab004", "patch": "@@ -623,7 +623,12 @@ gen_size (tree num, tree type, tree *res)\n     add_referenced_var (*res);\n \n   if (exact_log2 (struct_size_int) == -1)\n-    new_stmt = build_gimple_modify_stmt (num, struct_size);\n+    {\n+      tree size = build_int_cst (TREE_TYPE (num), struct_size_int);\n+      new_stmt = build_gimple_modify_stmt (*res, build2 (MULT_EXPR,\n+\t\t\t\t\t\t\t TREE_TYPE (num),\n+\t\t\t\t\t\t\t num, size));\n+    }\n   else\n     {\n       tree C = build_int_cst (TREE_TYPE (num), exact_log2 (struct_size_int));"}, {"sha": "1fda4f9b2d1b80fcb61da1a7f5453d4eaed0a467", "filename": "gcc/testsuite/ChangeLog", "status": "modified", "additions": 6, "deletions": 0, "changes": 6, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/b158b5c6aa0a3773622552c165ee88ebc31ab004/gcc%2Ftestsuite%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/b158b5c6aa0a3773622552c165ee88ebc31ab004/gcc%2Ftestsuite%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2FChangeLog?ref=b158b5c6aa0a3773622552c165ee88ebc31ab004", "patch": "@@ -1,3 +1,9 @@\n+2008-01-21  Alon Dayan  <alond@il.ibm.com>\n+\t    Olga Golovanevsky  <olga@il.ibm.com>\n+\n+\tPR tree-optimization/34701\n+\t* gcc.dg/struct/wo_prof_array_field.c: New test.\n+\t\n 2008-01-20  Paolo Carlini  <pcarlini@suse.de>\n \n         PR c++/34891"}, {"sha": "1c41de5bc3c64c70d11e48ae150ef5e4b4200815", "filename": "gcc/testsuite/gcc.dg/struct/wo_prof_array_field.c", "status": "added", "additions": 27, "deletions": 0, "changes": 27, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/b158b5c6aa0a3773622552c165ee88ebc31ab004/gcc%2Ftestsuite%2Fgcc.dg%2Fstruct%2Fwo_prof_array_field.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/b158b5c6aa0a3773622552c165ee88ebc31ab004/gcc%2Ftestsuite%2Fgcc.dg%2Fstruct%2Fwo_prof_array_field.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgcc.dg%2Fstruct%2Fwo_prof_array_field.c?ref=b158b5c6aa0a3773622552c165ee88ebc31ab004", "patch": "@@ -0,0 +1,27 @@\n+/* { dg-do compile } */\n+/* { dg-do run } */\n+\n+#include <stdlib.h>\n+typedef struct basic\n+{\n+  int a;\n+  int b[10];\n+} type_struct;\n+\n+type_struct *str1;\n+\n+int main()\n+{\n+  int i;\n+\n+  str1 = malloc (10 * sizeof (type_struct));\n+\n+  for (i=0; i<=9; i++)\n+    str1[i].a = str1[i].b[0];\n+\n+  return 0;\n+}\n+\n+/*--------------------------------------------------------------------------*/\n+/* { dg-final { scan-ipa-dump \"Number of structures to transform is 1\" \"ipa_struct_reorg\" } } */\n+/* { dg-final { cleanup-ipa-dump \"*\" } } */"}]}