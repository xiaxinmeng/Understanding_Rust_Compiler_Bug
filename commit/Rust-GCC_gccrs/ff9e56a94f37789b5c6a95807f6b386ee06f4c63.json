{"sha": "ff9e56a94f37789b5c6a95807f6b386ee06f4c63", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6ZmY5ZTU2YTk0ZjM3Nzg5YjVjNmE5NTgwN2Y2YjM4NmVlMDZmNGM2Mw==", "commit": {"author": {"name": "Thomas Koenig", "email": "tkoenig@gcc.gnu.org", "date": "2012-08-01T21:43:50Z"}, "committer": {"name": "Thomas Koenig", "email": "tkoenig@gcc.gnu.org", "date": "2012-08-01T21:43:50Z"}, "message": "re PR fortran/54033 (gfortran: Passing file as include directory - add diagnostic and ICE with -cpp)\n\n2012-08-01  Thomas K\u00f6nig  <tkoenig@gcc.gnu.org>\n\n\tPR fortran/54033\n\t* scanner.c (add_path_to_list): Emit warning if an error occurs\n\tfor an include path, if it is not present or if it is not a\n\tdirectory.  Do not add the path in these cases.\n\n2012-08-01  Thomas K\u00f6nig  <tkoenig@gcc.gnu.org>\n\n\tPR fortran/54033\n\t* gfortran.dg/include_6.f90:  New test case.\n\t* gfortran.dg/include_7.f90:  New test case.\n\t* gfortran.dg/include_3.f90:  Add dg-warning for missing directory.\n\nFrom-SVN: r190054", "tree": {"sha": "a5368a8af9bbaa6f65552a5f9215bfcbed995783", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/a5368a8af9bbaa6f65552a5f9215bfcbed995783"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/ff9e56a94f37789b5c6a95807f6b386ee06f4c63", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/ff9e56a94f37789b5c6a95807f6b386ee06f4c63", "html_url": "https://github.com/Rust-GCC/gccrs/commit/ff9e56a94f37789b5c6a95807f6b386ee06f4c63", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/ff9e56a94f37789b5c6a95807f6b386ee06f4c63/comments", "author": null, "committer": null, "parents": [{"sha": "fdd195f49b06618c0ec8a30cbc6c5495038e34b5", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/fdd195f49b06618c0ec8a30cbc6c5495038e34b5", "html_url": "https://github.com/Rust-GCC/gccrs/commit/fdd195f49b06618c0ec8a30cbc6c5495038e34b5"}], "stats": {"total": 44, "additions": 43, "deletions": 1}, "files": [{"sha": "a2b69d4575770c0637295bc333b47ca1b3b2a747", "filename": "gcc/fortran/ChangeLog", "status": "modified", "additions": 7, "deletions": 0, "changes": 7, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/ff9e56a94f37789b5c6a95807f6b386ee06f4c63/gcc%2Ffortran%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/ff9e56a94f37789b5c6a95807f6b386ee06f4c63/gcc%2Ffortran%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ffortran%2FChangeLog?ref=ff9e56a94f37789b5c6a95807f6b386ee06f4c63", "patch": "@@ -1,3 +1,10 @@\n+2012-08-01  Thomas K\u00f6nig  <tkoenig@gcc.gnu.org>\n+\n+\tPR fortran/54033\n+\t* scanner.c (add_path_to_list): Emit warning if an error occurs\n+\tfor an include path, if it is not present or if it is not a\n+\tdirectory.  Do not add the path in these cases.\n+\n 2012-07-31  Janus Weil  <janus@gcc.gnu.org>\n \n \tPR fortran/42418"}, {"sha": "d4a27a845329ebfd83d176e9be748284c8b15ba3", "filename": "gcc/fortran/scanner.c", "status": "modified", "additions": 18, "deletions": 1, "changes": 19, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/ff9e56a94f37789b5c6a95807f6b386ee06f4c63/gcc%2Ffortran%2Fscanner.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/ff9e56a94f37789b5c6a95807f6b386ee06f4c63/gcc%2Ffortran%2Fscanner.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ffortran%2Fscanner.c?ref=ff9e56a94f37789b5c6a95807f6b386ee06f4c63", "patch": "@@ -311,12 +311,29 @@ add_path_to_list (gfc_directorylist **list, const char *path,\n {\n   gfc_directorylist *dir;\n   const char *p;\n-\n+  struct stat st;\n+  \n   p = path;\n   while (*p == ' ' || *p == '\\t')  /* someone might do \"-I include\" */\n     if (*p++ == '\\0')\n       return;\n \n+  if (stat (p, &st))\n+    {\n+      if (errno != ENOENT)\n+\tgfc_warning_now (\"Include directory \\\"%s\\\": %s\", path,\n+\t\t\t xstrerror(errno));\n+      else\n+\t/* FIXME:  Also support -Wmissing-include-dirs.  */\n+\tgfc_warning_now (\"Nonexistent include directory \\\"%s\\\"\", path);\n+      return;\n+    }\n+  else if (!S_ISDIR (st.st_mode))\n+    {\n+      gfc_warning_now (\"\\\"%s\\\" is not a directory\", path);\n+      return;\n+    }\n+\n   if (head || *list == NULL)\n     {\n       dir = XCNEW (gfc_directorylist);"}, {"sha": "5c05d52e60de0dc722b2df591aed1623cafa7af1", "filename": "gcc/testsuite/ChangeLog", "status": "modified", "additions": 7, "deletions": 0, "changes": 7, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/ff9e56a94f37789b5c6a95807f6b386ee06f4c63/gcc%2Ftestsuite%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/ff9e56a94f37789b5c6a95807f6b386ee06f4c63/gcc%2Ftestsuite%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2FChangeLog?ref=ff9e56a94f37789b5c6a95807f6b386ee06f4c63", "patch": "@@ -1,3 +1,10 @@\n+2012-08-01  Thomas K\u00f6nig  <tkoenig@gcc.gnu.org>\n+\n+\tPR fortran/54033\n+\t* gfortran.dg/include_6.f90:  New test case.\n+\t* gfortran.dg/include_7.f90:  New test case.\n+\t* gfortran.dg/include_3.f90:  Add dg-warning for missing directory.\n+\n 2012-08-01  Tom de Vries  <tom@codesourcery.com>\n \n \t* gcc.dg/tree-ssa/vrp76.c: New test."}, {"sha": "1e429c41aaf9716f99ff58ad78d1bad8642483c4", "filename": "gcc/testsuite/gfortran.dg/include_3.f95", "status": "modified", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/ff9e56a94f37789b5c6a95807f6b386ee06f4c63/gcc%2Ftestsuite%2Fgfortran.dg%2Finclude_3.f95", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/ff9e56a94f37789b5c6a95807f6b386ee06f4c63/gcc%2Ftestsuite%2Fgfortran.dg%2Finclude_3.f95", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgfortran.dg%2Finclude_3.f95?ref=ff9e56a94f37789b5c6a95807f6b386ee06f4c63", "patch": "@@ -24,3 +24,4 @@ elemental function abs_c4 (parm)\n \n ! { dg-do compile }\n ! { dg-options \"-fpreprocessed -g3\" }\n+! { dg-warning \"Nonexistent include directory\" \"missing directory\" { target *-*-* } 0 }"}, {"sha": "0bac3909b8a04ecb6691abc0f7a42459b7878556", "filename": "gcc/testsuite/gfortran.dg/include_6.f90", "status": "added", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/ff9e56a94f37789b5c6a95807f6b386ee06f4c63/gcc%2Ftestsuite%2Fgfortran.dg%2Finclude_6.f90", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/ff9e56a94f37789b5c6a95807f6b386ee06f4c63/gcc%2Ftestsuite%2Fgfortran.dg%2Finclude_6.f90", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgfortran.dg%2Finclude_6.f90?ref=ff9e56a94f37789b5c6a95807f6b386ee06f4c63", "patch": "@@ -0,0 +1,5 @@\n+! { dg-do compile }\n+! { dg-options \"-I gfortran.log\" }\n+! { dg-warning \"is not a directory\" \"\" { target *-*-* } 0 }\n+end \n+"}, {"sha": "9a30945f1092e41f4d3b2d8c6dd7fce2d4670de2", "filename": "gcc/testsuite/gfortran.dg/include_7.f90", "status": "added", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/ff9e56a94f37789b5c6a95807f6b386ee06f4c63/gcc%2Ftestsuite%2Fgfortran.dg%2Finclude_7.f90", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/ff9e56a94f37789b5c6a95807f6b386ee06f4c63/gcc%2Ftestsuite%2Fgfortran.dg%2Finclude_7.f90", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgfortran.dg%2Finclude_7.f90?ref=ff9e56a94f37789b5c6a95807f6b386ee06f4c63", "patch": "@@ -0,0 +1,5 @@\n+! { dg-do compile }\n+! { dg-options \"-I nothere\" }\n+! { dg-warning \"Nonexistent include directory\" \"missing directory\" { target *-*-* } 0 }\n+end \n+"}]}