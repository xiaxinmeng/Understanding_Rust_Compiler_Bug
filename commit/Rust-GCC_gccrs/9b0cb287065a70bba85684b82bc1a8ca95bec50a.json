{"sha": "9b0cb287065a70bba85684b82bc1a8ca95bec50a", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6OWIwY2IyODcwNjVhNzBiYmE4NTY4NGI4MmJjMWE4Y2E5NWJlYzUwYQ==", "commit": {"author": {"name": "Tom Tromey", "email": "tromey@cygnus.com", "date": "1999-09-23T18:50:59Z"}, "committer": {"name": "Tom Tromey", "email": "tromey@gcc.gnu.org", "date": "1999-09-23T18:50:59Z"}, "message": "re GNATS gcj/51 (Writing on OutputStream of bad Socket kills app with \"Broken pipe\")\n\n\t* prims.cc (main_init): New function.\n\t(JvRunMain): Call it.\n\t(_Jv_RunMain): Likewise.\n\tInclude <signal.h>.\n\t(main_init): Ignore SIGPIPE.  Fixes PR 51.\n\nFrom-SVN: r29625", "tree": {"sha": "a7bf4c3c72c80e372c2cadf7180155d043dc9684", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/a7bf4c3c72c80e372c2cadf7180155d043dc9684"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/9b0cb287065a70bba85684b82bc1a8ca95bec50a", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/9b0cb287065a70bba85684b82bc1a8ca95bec50a", "html_url": "https://github.com/Rust-GCC/gccrs/commit/9b0cb287065a70bba85684b82bc1a8ca95bec50a", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/9b0cb287065a70bba85684b82bc1a8ca95bec50a/comments", "author": null, "committer": null, "parents": [{"sha": "fe1dbf6c7cc38cd0c38031bf43013dd61cd7de43", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/fe1dbf6c7cc38cd0c38031bf43013dd61cd7de43", "html_url": "https://github.com/Rust-GCC/gccrs/commit/fe1dbf6c7cc38cd0c38031bf43013dd61cd7de43"}], "stats": {"total": 40, "additions": 25, "deletions": 15}, "files": [{"sha": "906d69b0ca9da2b724fd363e1cccb4eba021b631", "filename": "libjava/ChangeLog", "status": "modified", "additions": 8, "deletions": 0, "changes": 8, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/9b0cb287065a70bba85684b82bc1a8ca95bec50a/libjava%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/9b0cb287065a70bba85684b82bc1a8ca95bec50a/libjava%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libjava%2FChangeLog?ref=9b0cb287065a70bba85684b82bc1a8ca95bec50a", "patch": "@@ -1,3 +1,11 @@\n+1999-09-23  Tom Tromey  <tromey@cygnus.com>\n+\n+\t* prims.cc (main_init): New function.\n+\t(JvRunMain): Call it.\n+\t(_Jv_RunMain): Likewise.\n+\tInclude <signal.h>.\n+\t(main_init): Ignore SIGPIPE.  Fixes PR 51.\n+\n 1999-09-22  Tom Tromey  <tromey@cygnus.com>\n \n \t* libgcj.spec.in: Use `jc1' spec, not `cc1' spec."}, {"sha": "39357a24d852c40e16f0fc97906c5c481ef58603", "filename": "libjava/prims.cc", "status": "modified", "additions": 17, "deletions": 15, "changes": 32, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/9b0cb287065a70bba85684b82bc1a8ca95bec50a/libjava%2Fprims.cc", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/9b0cb287065a70bba85684b82bc1a8ca95bec50a/libjava%2Fprims.cc", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libjava%2Fprims.cc?ref=9b0cb287065a70bba85684b82bc1a8ca95bec50a", "patch": "@@ -14,6 +14,7 @@ details.  */\n #include <stdarg.h>\n #include <stdio.h>\n #include <string.h>\n+#include <signal.h>\n \n #pragma implementation \"gcj/array.h\"\n \n@@ -595,8 +596,8 @@ static java::lang::ThreadGroup *main_group;\n // The primary thread.\n static java::lang::Thread *main_thread;\n \n-void\n-JvRunMain (jclass klass, int argc, const char **argv)\n+static void\n+main_init (void)\n {\n   INIT_SEGV;\n #ifdef HANDLE_FPE\n@@ -612,6 +613,19 @@ JvRunMain (jclass klass, int argc, const char **argv)\n   LTDL_SET_PRELOADED_SYMBOLS ();\n #endif\n \n+  // FIXME: we only want this on POSIX systems.\n+  struct sigaction act;\n+  act.sa_handler = SIG_IGN;\n+  sigemptyset (&act.sa_mask);\n+  act.sa_flags = 0;\n+  sigaction (SIGPIPE, &act, NULL);\n+}\n+\n+void\n+JvRunMain (jclass klass, int argc, const char **argv)\n+{\n+  main_init ();\n+\n   arg_vec = JvConvertArgv (argc - 1, argv + 1);\n   main_group = new java::lang::ThreadGroup (23);\n   main_thread = new java::lang::FirstThread (main_group, klass, arg_vec);\n@@ -625,19 +639,7 @@ JvRunMain (jclass klass, int argc, const char **argv)\n void\n _Jv_RunMain (const char *class_name, int argc, const char **argv)\n {\n-  INIT_SEGV;\n-#ifdef HANDLE_FPE\n-  INIT_FPE;\n-#else\n-  arithexception = new java::lang::ArithmeticException\n-    (JvNewStringLatin1 (\"/ by zero\"));\n-#endif\n-\n-  no_memory = new java::lang::OutOfMemoryError;\n-\n-#ifdef USE_LTDL\n-  LTDL_SET_PRELOADED_SYMBOLS ();\n-#endif\n+  main_init ();\n \n   arg_vec = JvConvertArgv (argc - 1, argv + 1);\n   main_group = new java::lang::ThreadGroup (23);"}]}