{"sha": "0562ed3104a26738bda3828e2cbe7e4711e9e666", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6MDU2MmVkMzEwNGEyNjczOGJkYTM4MjhlMmNiZTdlNDcxMWU5ZTY2Ng==", "commit": {"author": {"name": "Piotr Trojanek", "email": "trojanek@adacore.com", "date": "2018-05-31T10:47:19Z"}, "committer": {"name": "Pierre-Marie de Rodat", "email": "pmderodat@gcc.gnu.org", "date": "2018-05-31T10:47:19Z"}, "message": "[Ada] Detect returning procedures annotated with No_Return\n\nGNAT was emitting a warning about procedures with No_Return aspect on the\nspec and a returning body, but failed to handle similar procedures with\nno explicit spec. Now fixed.\n\nThis was also affecting GNATprove, where an undetected mismatch between\nNo_Return aspect and the body was a soundness bug, i.e. GNATprove was\nsilently accept code that raise a runtime exception.\n\n------------\n-- Source --\n------------\n\nprocedure P (X : Boolean) with No_Return is\nbegin\n   if X then\n      raise Program_Error;\n   end if;\nend;\n\n-----------------\n-- Compilation --\n-----------------\n\n$ gcc -c p.adb\np.adb:3:04: warning: implied return after this statement will raise\n                     Program_Error\np.adb:3:04: warning: procedure \"P\" is marked as No_Return\n\n2018-05-31  Piotr Trojanek  <trojanek@adacore.com>\n\ngcc/ada/\n\n\t* sem_ch6.adb (Check_Missing_Return): Handle procedures with no\n\texplicit spec.\n\nFrom-SVN: r261012", "tree": {"sha": "12c711233bf0bc1c9559d8adbf1d6a7f7cf0a222", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/12c711233bf0bc1c9559d8adbf1d6a7f7cf0a222"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/0562ed3104a26738bda3828e2cbe7e4711e9e666", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/0562ed3104a26738bda3828e2cbe7e4711e9e666", "html_url": "https://github.com/Rust-GCC/gccrs/commit/0562ed3104a26738bda3828e2cbe7e4711e9e666", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/0562ed3104a26738bda3828e2cbe7e4711e9e666/comments", "author": {"login": "ptroja", "id": 161602, "node_id": "MDQ6VXNlcjE2MTYwMg==", "avatar_url": "https://avatars.githubusercontent.com/u/161602?v=4", "gravatar_id": "", "url": "https://api.github.com/users/ptroja", "html_url": "https://github.com/ptroja", "followers_url": "https://api.github.com/users/ptroja/followers", "following_url": "https://api.github.com/users/ptroja/following{/other_user}", "gists_url": "https://api.github.com/users/ptroja/gists{/gist_id}", "starred_url": "https://api.github.com/users/ptroja/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/ptroja/subscriptions", "organizations_url": "https://api.github.com/users/ptroja/orgs", "repos_url": "https://api.github.com/users/ptroja/repos", "events_url": "https://api.github.com/users/ptroja/events{/privacy}", "received_events_url": "https://api.github.com/users/ptroja/received_events", "type": "User", "site_admin": false}, "committer": null, "parents": [{"sha": "6e03839f3d5a26617da02a5d052451251486ede1", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/6e03839f3d5a26617da02a5d052451251486ede1", "html_url": "https://github.com/Rust-GCC/gccrs/commit/6e03839f3d5a26617da02a5d052451251486ede1"}], "stats": {"total": 20, "additions": 15, "deletions": 5}, "files": [{"sha": "546e0d853a681b789f487d0601c753eb83ec24fa", "filename": "gcc/ada/ChangeLog", "status": "modified", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/0562ed3104a26738bda3828e2cbe7e4711e9e666/gcc%2Fada%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/0562ed3104a26738bda3828e2cbe7e4711e9e666/gcc%2Fada%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fada%2FChangeLog?ref=0562ed3104a26738bda3828e2cbe7e4711e9e666", "patch": "@@ -1,3 +1,8 @@\n+2018-05-31  Piotr Trojanek  <trojanek@adacore.com>\n+\n+\t* sem_ch6.adb (Check_Missing_Return): Handle procedures with no\n+\texplicit spec.\n+\n 2018-05-31  Eric Botcazou  <ebotcazou@adacore.com>\n \n \t* gcc-interface/trans.c (Call_to_gnu): In the by-reference case, if"}, {"sha": "3413e2185b57d7b5618105fc84c0abfa68b22f40", "filename": "gcc/ada/sem_ch6.adb", "status": "modified", "additions": 10, "deletions": 5, "changes": 15, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/0562ed3104a26738bda3828e2cbe7e4711e9e666/gcc%2Fada%2Fsem_ch6.adb", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/0562ed3104a26738bda3828e2cbe7e4711e9e666/gcc%2Fada%2Fsem_ch6.adb", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fada%2Fsem_ch6.adb?ref=0562ed3104a26738bda3828e2cbe7e4711e9e666", "patch": "@@ -3040,11 +3040,16 @@ package body Sem_Ch6 is\n \n          --  If procedure with No_Return, check returns\n \n-         elsif Nkind (Body_Spec) = N_Procedure_Specification\n-           and then Present (Spec_Id)\n-           and then No_Return (Spec_Id)\n-         then\n-            Check_Returns (HSS, 'P', Missing_Ret, Spec_Id);\n+         elsif Nkind (Body_Spec) = N_Procedure_Specification then\n+            if Present (Spec_Id) then\n+               Id := Spec_Id;\n+            else\n+               Id := Body_Id;\n+            end if;\n+\n+            if No_Return (Id) then\n+               Check_Returns (HSS, 'P', Missing_Ret, Id);\n+            end if;\n          end if;\n \n          --  Special checks in SPARK mode"}]}