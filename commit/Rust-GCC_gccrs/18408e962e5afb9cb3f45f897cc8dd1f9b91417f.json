{"sha": "18408e962e5afb9cb3f45f897cc8dd1f9b91417f", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6MTg0MDhlOTYyZTVhZmI5Y2IzZjQ1Zjg5N2NjOGRkMWY5YjkxNDE3Zg==", "commit": {"author": {"name": "Alexandre Oliva", "email": "aoliva@redhat.com", "date": "2017-12-22T02:07:31Z"}, "committer": {"name": "Alexandre Oliva", "email": "aoliva@gcc.gnu.org", "date": "2017-12-22T02:07:31Z"}, "message": "[SFN] sync up debug-only stmt list's side effects with empty stmts too\n\nfor  gcc/c-family/ChangeLog\n\n\tPR debug/83527\n\tPR debug/83419\n\t* c-semantics.c (only_debug_stmts_after_p): New.\n\t(pop_stmt_list): Clear side effects in debug-only stmt list.\n\tCheck for single nondebug stmt followed by debug stmts only.\n\nfor  gcc/testsuite/ChangeLog\n\n\tPR debug/83527\n\tPR debug/83419\n\t* gcc.dg/pr83527.c: New.\n\nFrom-SVN: r255966", "tree": {"sha": "0e7d1c33665858f6ba7e584ff9b9744de0b9c9c2", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/0e7d1c33665858f6ba7e584ff9b9744de0b9c9c2"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/18408e962e5afb9cb3f45f897cc8dd1f9b91417f", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/18408e962e5afb9cb3f45f897cc8dd1f9b91417f", "html_url": "https://github.com/Rust-GCC/gccrs/commit/18408e962e5afb9cb3f45f897cc8dd1f9b91417f", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/18408e962e5afb9cb3f45f897cc8dd1f9b91417f/comments", "author": null, "committer": null, "parents": [{"sha": "cacb2cce55df175925c16dd3c640e08c4c8a8374", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/cacb2cce55df175925c16dd3c640e08c4c8a8374", "html_url": "https://github.com/Rust-GCC/gccrs/commit/cacb2cce55df175925c16dd3c640e08c4c8a8374"}], "stats": {"total": 63, "additions": 59, "deletions": 4}, "files": [{"sha": "ba61fcef8a9cf51d234b75a080e977b8b4729d57", "filename": "gcc/c-family/ChangeLog", "status": "modified", "additions": 8, "deletions": 0, "changes": 8, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/18408e962e5afb9cb3f45f897cc8dd1f9b91417f/gcc%2Fc-family%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/18408e962e5afb9cb3f45f897cc8dd1f9b91417f/gcc%2Fc-family%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fc-family%2FChangeLog?ref=18408e962e5afb9cb3f45f897cc8dd1f9b91417f", "patch": "@@ -1,3 +1,11 @@\n+2017-12-22  Alexandre Oliva <aoliva@redhat.com>\n+\n+\tPR debug/83527\n+\tPR debug/83419\n+\t* c-semantics.c (only_debug_stmts_after_p): New.\n+\t(pop_stmt_list): Clear side effects in debug-only stmt list.\n+\tCheck for single nondebug stmt followed by debug stmts only.\n+\n 2017-12-21  Alexandre Oliva  <aoliva@redhat.com>\n \n \tPR debug/83419"}, {"sha": "21d908ed06c18804f19620e264136ec88b2ab50a", "filename": "gcc/c-family/c-semantics.c", "status": "modified", "additions": 19, "deletions": 4, "changes": 23, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/18408e962e5afb9cb3f45f897cc8dd1f9b91417f/gcc%2Fc-family%2Fc-semantics.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/18408e962e5afb9cb3f45f897cc8dd1f9b91417f/gcc%2Fc-family%2Fc-semantics.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fc-family%2Fc-semantics.c?ref=18408e962e5afb9cb3f45f897cc8dd1f9b91417f", "patch": "@@ -35,6 +35,17 @@ push_stmt_list (void)\n   return t;\n }\n \n+/* Return TRUE if, after I, there are any nondebug stmts.  */\n+\n+static inline bool\n+only_debug_stmts_after_p (tree_stmt_iterator i)\n+{\n+  for (tsi_next (&i); !tsi_end_p (i); tsi_next (&i))\n+    if (TREE_CODE (tsi_stmt (i)) != DEBUG_BEGIN_STMT)\n+      return false;\n+  return true;\n+}\n+\n /* Finish the statement tree rooted at T.  */\n \n tree\n@@ -99,11 +110,15 @@ pop_stmt_list (tree t)\n \t  while (!tsi_end_p (i)\n \t\t && TREE_CODE (tsi_stmt (i)) == DEBUG_BEGIN_STMT)\n \t    tsi_next (&i);\n-\t  /* If there's only one nondebug stmt in the list, we'd have\n-\t     extracted the stmt and dropped the list, and we'd take\n-\t     TREE_SIDE_EFFECTS from that statement, so keep the list's\n+\t  /* If there are only debug stmts in the list, without them\n+\t     we'd have an empty stmt without side effects.  If there's\n+\t     only one nondebug stmt, we'd have extracted the stmt and\n+\t     dropped the list, and we'd take TREE_SIDE_EFFECTS from\n+\t     that statement.  In either case, keep the list's\n \t     TREE_SIDE_EFFECTS in sync.  */\n-\t  if (tsi_one_before_end_p (i))\n+\t  if (tsi_end_p (i))\n+\t    TREE_SIDE_EFFECTS (t) = 0;\n+\t  else if (only_debug_stmts_after_p (i))\n \t    TREE_SIDE_EFFECTS (t) = TREE_SIDE_EFFECTS (tsi_stmt (i));\n \t}\n     }"}, {"sha": "3969bd2771e13a6dfe3046ee5f1ec352db66a99f", "filename": "gcc/testsuite/ChangeLog", "status": "modified", "additions": 6, "deletions": 0, "changes": 6, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/18408e962e5afb9cb3f45f897cc8dd1f9b91417f/gcc%2Ftestsuite%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/18408e962e5afb9cb3f45f897cc8dd1f9b91417f/gcc%2Ftestsuite%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2FChangeLog?ref=18408e962e5afb9cb3f45f897cc8dd1f9b91417f", "patch": "@@ -1,3 +1,9 @@\n+2017-12-22  Alexandre Oliva <aoliva@redhat.com>\n+\n+\tPR debug/83527\n+\tPR debug/83419\n+\t* gcc.dg/pr83527.c: New.\n+\n 2017-12-21  Martin Sebor  <msebor@redhat.com>\n \n \tPR testsuite/83462"}, {"sha": "effef439ac07928e759c008a1aab48b07d21d538", "filename": "gcc/testsuite/gcc.dg/pr83527.c", "status": "added", "additions": 26, "deletions": 0, "changes": 26, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/18408e962e5afb9cb3f45f897cc8dd1f9b91417f/gcc%2Ftestsuite%2Fgcc.dg%2Fpr83527.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/18408e962e5afb9cb3f45f897cc8dd1f9b91417f/gcc%2Ftestsuite%2Fgcc.dg%2Fpr83527.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgcc.dg%2Fpr83527.c?ref=18408e962e5afb9cb3f45f897cc8dd1f9b91417f", "patch": "@@ -0,0 +1,26 @@\n+/* PR debug/83527 */\n+/* { dg-do compile } */\n+/* { dg-options \"-O2 -fcompare-debug\" } */\n+\n+extern void fn2(void);\n+extern void fn3(void);\n+int a, b;\n+void fn1() {\n+  int c;\n+  short d;\n+  switch (a) {\n+  case 32800:\n+    fn2();\n+  case 32769:\n+    b = 0;\n+  case 32771:\n+  case 32772:\n+  case 32782:\n+    fn3();\n+  }\n+  if (d || c) {\n+    do\n+      ;\n+    while (0);\n+  }\n+}"}]}