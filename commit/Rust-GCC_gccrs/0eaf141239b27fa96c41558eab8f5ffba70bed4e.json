{"sha": "0eaf141239b27fa96c41558eab8f5ffba70bed4e", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6MGVhZjE0MTIzOWIyN2ZhOTZjNDE1NThlYWI4ZjVmZmJhNzBiZWQ0ZQ==", "commit": {"author": {"name": "Jakub Jelinek", "email": "jakub@redhat.com", "date": "2019-02-26T10:36:05Z"}, "committer": {"name": "Jakub Jelinek", "email": "jakub@gcc.gnu.org", "date": "2019-02-26T10:36:05Z"}, "message": "re PR fortran/43210 (Initializer of huge static arrays should be improved)\n\n\tPR fortran/43210\n\t* trans-array.c (gfc_conv_array_initializer): Use RANGE_EXPR instead\n\tof duplicating the initializer possibly many times.\n\nFrom-SVN: r269207", "tree": {"sha": "9a4f4e292ff6910e50766e0cb1c93990d47e6e7a", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/9a4f4e292ff6910e50766e0cb1c93990d47e6e7a"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/0eaf141239b27fa96c41558eab8f5ffba70bed4e", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/0eaf141239b27fa96c41558eab8f5ffba70bed4e", "html_url": "https://github.com/Rust-GCC/gccrs/commit/0eaf141239b27fa96c41558eab8f5ffba70bed4e", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/0eaf141239b27fa96c41558eab8f5ffba70bed4e/comments", "author": {"login": "jakubjelinek", "id": 9370665, "node_id": "MDQ6VXNlcjkzNzA2NjU=", "avatar_url": "https://avatars.githubusercontent.com/u/9370665?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jakubjelinek", "html_url": "https://github.com/jakubjelinek", "followers_url": "https://api.github.com/users/jakubjelinek/followers", "following_url": "https://api.github.com/users/jakubjelinek/following{/other_user}", "gists_url": "https://api.github.com/users/jakubjelinek/gists{/gist_id}", "starred_url": "https://api.github.com/users/jakubjelinek/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jakubjelinek/subscriptions", "organizations_url": "https://api.github.com/users/jakubjelinek/orgs", "repos_url": "https://api.github.com/users/jakubjelinek/repos", "events_url": "https://api.github.com/users/jakubjelinek/events{/privacy}", "received_events_url": "https://api.github.com/users/jakubjelinek/received_events", "type": "User", "site_admin": false}, "committer": null, "parents": [{"sha": "ba790e6f5ede0967acd57324569715c147b1e870", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/ba790e6f5ede0967acd57324569715c147b1e870", "html_url": "https://github.com/Rust-GCC/gccrs/commit/ba790e6f5ede0967acd57324569715c147b1e870"}], "stats": {"total": 18, "additions": 10, "deletions": 8}, "files": [{"sha": "2293c9ac47b1b4c3e2356e13b52495f35d7f078d", "filename": "gcc/fortran/ChangeLog", "status": "modified", "additions": 6, "deletions": 0, "changes": 6, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/0eaf141239b27fa96c41558eab8f5ffba70bed4e/gcc%2Ffortran%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/0eaf141239b27fa96c41558eab8f5ffba70bed4e/gcc%2Ffortran%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ffortran%2FChangeLog?ref=0eaf141239b27fa96c41558eab8f5ffba70bed4e", "patch": "@@ -1,3 +1,9 @@\n+2019-02-26  Jakub Jelinek  <jakub@redhat.com>\n+\n+\tPR fortran/43210\n+\t* trans-array.c (gfc_conv_array_initializer): Use RANGE_EXPR instead\n+\tof duplicating the initializer possibly many times.\n+\n 2019-02-24  Thomas Koenig  <tkoenig@gcc.gnu.org>\n \n \tPR fortran/89174"}, {"sha": "6192e6830dda1db3f934c9603f4adafd7938af4d", "filename": "gcc/fortran/trans-array.c", "status": "modified", "additions": 4, "deletions": 8, "changes": 12, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/0eaf141239b27fa96c41558eab8f5ffba70bed4e/gcc%2Ffortran%2Ftrans-array.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/0eaf141239b27fa96c41558eab8f5ffba70bed4e/gcc%2Ffortran%2Ftrans-array.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ffortran%2Ftrans-array.c?ref=0eaf141239b27fa96c41558eab8f5ffba70bed4e", "patch": "@@ -5986,7 +5986,6 @@ gfc_conv_array_initializer (tree type, gfc_expr * expr)\n {\n   gfc_constructor *c;\n   tree tmp;\n-  offset_int wtmp;\n   gfc_se se;\n   tree index, range;\n   vec<constructor_elt, va_gc> *v = NULL;\n@@ -6009,13 +6008,10 @@ gfc_conv_array_initializer (tree type, gfc_expr * expr)\n       else\n \tgfc_conv_structure (&se, expr, 1);\n \n-      wtmp = wi::to_offset (TYPE_MAX_VALUE (TYPE_DOMAIN (type))) + 1;\n-      /* This will probably eat buckets of memory for large arrays.  */\n-      while (wtmp != 0)\n-        {\n-\t  CONSTRUCTOR_APPEND_ELT (v, NULL_TREE, se.expr);\n-\t  wtmp -= 1;\n-        }\n+      CONSTRUCTOR_APPEND_ELT (v, build2 (RANGE_EXPR, gfc_array_index_type,\n+\t\t\t\t\t TYPE_MIN_VALUE (TYPE_DOMAIN (type)),\n+\t\t\t\t\t TYPE_MAX_VALUE (TYPE_DOMAIN (type))),\n+\t\t\t      se.expr);\n       break;\n \n     case EXPR_ARRAY:"}]}