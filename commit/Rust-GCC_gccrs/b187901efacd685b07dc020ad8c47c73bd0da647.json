{"sha": "b187901efacd685b07dc020ad8c47c73bd0da647", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6YjE4NzkwMWVmYWNkNjg1YjA3ZGMwMjBhZDhjNDdjNzNiZDBkYTY0Nw==", "commit": {"author": {"name": "Andrew Pinski", "email": "pinskia@physics.uc.edu", "date": "2004-10-11T03:16:47Z"}, "committer": {"name": "Andrew Pinski", "email": "pinskia@gcc.gnu.org", "date": "2004-10-11T03:16:47Z"}, "message": "re PR c++/17907 (ice in optimize_inline_calls, at tree-inline.c)\n\n2004-10-10  Andrew Pinski  <pinskia@physics.uc.edu>\n\n        PR c++/17907\n        * semantics.c (add_decl_expr): If the decl has a size which\n        has side effects then the decl expression needs a cleanup point.\n2004-10-10  Andrew Pinski  <pinskia@physics.uc.edu>\n\n        PR c++/17907\n        * g++.dg/eh/cleanup5.C: New test.\n\nFrom-SVN: r88867", "tree": {"sha": "b070f35d5388bd4b6ba19d422c594efdb733d896", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/b070f35d5388bd4b6ba19d422c594efdb733d896"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/b187901efacd685b07dc020ad8c47c73bd0da647", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/b187901efacd685b07dc020ad8c47c73bd0da647", "html_url": "https://github.com/Rust-GCC/gccrs/commit/b187901efacd685b07dc020ad8c47c73bd0da647", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/b187901efacd685b07dc020ad8c47c73bd0da647/comments", "author": null, "committer": null, "parents": [{"sha": "90d82a979d9e3f466d6777e6f594db69661b1caa", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/90d82a979d9e3f466d6777e6f594db69661b1caa", "html_url": "https://github.com/Rust-GCC/gccrs/commit/90d82a979d9e3f466d6777e6f594db69661b1caa"}], "stats": {"total": 30, "additions": 29, "deletions": 1}, "files": [{"sha": "d6aca574f7c5e37b49ad3ee27356b72fdca1251c", "filename": "gcc/cp/ChangeLog", "status": "modified", "additions": 6, "deletions": 0, "changes": 6, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/b187901efacd685b07dc020ad8c47c73bd0da647/gcc%2Fcp%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/b187901efacd685b07dc020ad8c47c73bd0da647/gcc%2Fcp%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fcp%2FChangeLog?ref=b187901efacd685b07dc020ad8c47c73bd0da647", "patch": "@@ -1,3 +1,9 @@\n+2004-10-10  Andrew Pinski  <pinskia@physics.uc.edu>\n+\n+\tPR c++/17907\n+\t* semantics.c (add_decl_expr): If the decl has a size which\n+\thas side effects then the decl expression needs a cleanup point.\n+\n 2004-10-10  Mark Mitchell  <mark@codesourcery.com>\n \n \tPR c++/17393"}, {"sha": "45912c1707b9c42c20a180248cd44460581aabf6", "filename": "gcc/cp/semantics.c", "status": "modified", "additions": 2, "deletions": 1, "changes": 3, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/b187901efacd685b07dc020ad8c47c73bd0da647/gcc%2Fcp%2Fsemantics.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/b187901efacd685b07dc020ad8c47c73bd0da647/gcc%2Fcp%2Fsemantics.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fcp%2Fsemantics.c?ref=b187901efacd685b07dc020ad8c47c73bd0da647", "patch": "@@ -368,7 +368,8 @@ void\n add_decl_expr (tree decl)\n {\n   tree r = build_stmt (DECL_EXPR, decl);\n-  if (DECL_INITIAL (decl))\n+  if (DECL_INITIAL (decl)\n+      || (DECL_SIZE (decl) && TREE_SIDE_EFFECTS (DECL_SIZE (decl))))\n     r = maybe_cleanup_point_expr (r);\n   add_stmt (r);\n }"}, {"sha": "ac9574dff53b515334ea799d7b45b49cfe28fc3b", "filename": "gcc/testsuite/ChangeLog", "status": "modified", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/b187901efacd685b07dc020ad8c47c73bd0da647/gcc%2Ftestsuite%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/b187901efacd685b07dc020ad8c47c73bd0da647/gcc%2Ftestsuite%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2FChangeLog?ref=b187901efacd685b07dc020ad8c47c73bd0da647", "patch": "@@ -1,3 +1,8 @@\n+2004-10-10  Andrew Pinski  <pinskia@physics.uc.edu>\n+\n+\tPR c++/17907\n+\t* g++.dg/eh/cleanup5.C: New test.\n+\n 2004-10-10  Mark Mitchell  <mark@codesourcery.com>\n \n \tPR c++/17393"}, {"sha": "b78c73afcffa5217d0fc165dece0414c5fa6c39d", "filename": "gcc/testsuite/g++.dg/eh/cleanup5.C", "status": "added", "additions": 16, "deletions": 0, "changes": 16, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/b187901efacd685b07dc020ad8c47c73bd0da647/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Feh%2Fcleanup5.C", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/b187901efacd685b07dc020ad8c47c73bd0da647/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Feh%2Fcleanup5.C", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Feh%2Fcleanup5.C?ref=b187901efacd685b07dc020ad8c47c73bd0da647", "patch": "@@ -0,0 +1,16 @@\n+// PR 17907\n+// { dg-do compile }\n+// We lost a CLEANUP_POINT_EXPR, leading to a crash destroying temp of A.\n+\n+\n+struct String {\n+  ~String();\n+  int size() const;\n+};\n+struct CodingSystem {\n+  String convertOut() const;\n+};\n+void inputOpened(CodingSystem *outputCodingSystem)\n+{\n+   char filePath[outputCodingSystem->convertOut().size()];\n+}"}]}