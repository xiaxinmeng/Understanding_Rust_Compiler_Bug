{"sha": "5d0001f01521eb923c16cd69c807c655ae9acb54", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6NWQwMDAxZjAxNTIxZWI5MjNjMTZjZDY5YzgwN2M2NTVhZTlhY2I1NA==", "commit": {"author": {"name": "Frank Ch. Eigler", "email": "fche@redhat.com", "date": "2009-09-22T16:17:50Z"}, "committer": {"name": "Frank Ch. Eigler", "email": "fche@gcc.gnu.org", "date": "2009-09-22T16:17:50Z"}, "message": "re PR libmudflap/41433 (security: mudflap accepts environment variables if setuid)\n\n2009-09-22  Frank Ch. Eigler  <fche@redhat.com>\n\n\tPR libmudflap/41433\n\t* mf-runtime.c (__mf_init): Ignore $MUDFLAP_OPTIONS if\n\trunning setuid or setgid.\n\nFrom-SVN: r152026", "tree": {"sha": "915871f786aef584174d4a4ecfbc78dd8d483e49", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/915871f786aef584174d4a4ecfbc78dd8d483e49"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/5d0001f01521eb923c16cd69c807c655ae9acb54", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/5d0001f01521eb923c16cd69c807c655ae9acb54", "html_url": "https://github.com/Rust-GCC/gccrs/commit/5d0001f01521eb923c16cd69c807c655ae9acb54", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/5d0001f01521eb923c16cd69c807c655ae9acb54/comments", "author": {"login": "fche", "id": 588885, "node_id": "MDQ6VXNlcjU4ODg4NQ==", "avatar_url": "https://avatars.githubusercontent.com/u/588885?v=4", "gravatar_id": "", "url": "https://api.github.com/users/fche", "html_url": "https://github.com/fche", "followers_url": "https://api.github.com/users/fche/followers", "following_url": "https://api.github.com/users/fche/following{/other_user}", "gists_url": "https://api.github.com/users/fche/gists{/gist_id}", "starred_url": "https://api.github.com/users/fche/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/fche/subscriptions", "organizations_url": "https://api.github.com/users/fche/orgs", "repos_url": "https://api.github.com/users/fche/repos", "events_url": "https://api.github.com/users/fche/events{/privacy}", "received_events_url": "https://api.github.com/users/fche/received_events", "type": "User", "site_admin": false}, "committer": null, "parents": [{"sha": "e0601576f7e369ca48ac2b7e64f9a327fac33a4f", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/e0601576f7e369ca48ac2b7e64f9a327fac33a4f", "html_url": "https://github.com/Rust-GCC/gccrs/commit/e0601576f7e369ca48ac2b7e64f9a327fac33a4f"}], "stats": {"total": 19, "additions": 17, "deletions": 2}, "files": [{"sha": "f65cf2ab3d367aaac5754f820d92da3a7accc626", "filename": "libmudflap/ChangeLog", "status": "modified", "additions": 6, "deletions": 0, "changes": 6, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/5d0001f01521eb923c16cd69c807c655ae9acb54/libmudflap%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/5d0001f01521eb923c16cd69c807c655ae9acb54/libmudflap%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libmudflap%2FChangeLog?ref=5d0001f01521eb923c16cd69c807c655ae9acb54", "patch": "@@ -1,3 +1,9 @@\n+2009-09-22  Frank Ch. Eigler  <fche@redhat.com>\n+\n+\tPR libmudflap/41433\n+\t* mf-runtime.c (__mf_init): Ignore $MUDFLAP_OPTIONS if\n+\trunning setuid or setgid.\n+\n 2009-09-01  Loren J. Rittle  <ljrittle@acm.org>\n \n \t* mf-runtime.c (__mf_init): Support FreeBSD."}, {"sha": "08a50c218073285abf2fde95be08abf9486edfb1", "filename": "libmudflap/mf-runtime.c", "status": "modified", "additions": 11, "deletions": 2, "changes": 13, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/5d0001f01521eb923c16cd69c807c655ae9acb54/libmudflap%2Fmf-runtime.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/5d0001f01521eb923c16cd69c807c655ae9acb54/libmudflap%2Fmf-runtime.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libmudflap%2Fmf-runtime.c?ref=5d0001f01521eb923c16cd69c807c655ae9acb54", "patch": "@@ -303,6 +303,14 @@ __mf_set_default_options ()\n #ifdef LIBMUDFLAPTH\n   __mf_opts.thread_stack = 0;\n #endif\n+\n+  /* PR41443: Beware that the above flags will be applied to\n+     setuid/setgid binaries, and cannot be overriden with\n+     $MUDFLAP_OPTIONS.  So the defaults must be non-exploitable. \n+\n+     Should we consider making the default violation_mode something\n+     harsher than viol_nop?  OTOH, glibc's MALLOC_CHECK_ is disabled\n+     by default for these same programs. */\n }\n \n static struct mudoption\n@@ -442,7 +450,7 @@ __mf_usage ()\n            \"This is a %s%sGCC \\\"mudflap\\\" memory-checked binary.\\n\"\n            \"Mudflap is Copyright (C) 2002-2009 Free Software Foundation, Inc.\\n\"\n            \"\\n\"\n-           \"The mudflap code can be controlled by an environment variable:\\n\"\n+           \"Unless setuid, a program's mudflap options be set by an environment variable:\\n\"\n            \"\\n\"\n            \"$ export MUDFLAP_OPTIONS='<options>'\\n\"\n            \"$ <mudflapped_program>\\n\"\n@@ -711,7 +719,8 @@ __mf_init ()\n \n   __mf_set_default_options ();\n \n-  ov = getenv (\"MUDFLAP_OPTIONS\");\n+  if (getuid () == geteuid () && getgid () == getegid ()) /* PR41433, not setuid */\n+    ov = getenv (\"MUDFLAP_OPTIONS\");\n   if (ov)\n     {\n       int rc = __mfu_set_options (ov);"}]}