{"sha": "8ada417fa14ff7efe2a06eb5143b34d7c05dab2f", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6OGFkYTQxN2ZhMTRmZjdlZmUyYTA2ZWI1MTQzYjM0ZDdjMDVkYWIyZg==", "commit": {"author": {"name": "Zack Weinberg", "email": "zack@codesourcery.com", "date": "2003-07-12T20:03:14Z"}, "committer": {"name": "Zack Weinberg", "email": "zack@gcc.gnu.org", "date": "2003-07-12T20:03:14Z"}, "message": "aclocal.m4 (gcc_AC_CHECK_TYPE): Clone of AC_CHECK_TYPE...\n\n\t* aclocal.m4 (gcc_AC_CHECK_TYPE): Clone of AC_CHECK_TYPE,\n\tuses three-argument AC_DEFINE so no acconfig.h entries are\n\tneeded.\n\t(_gcc_COMPUTE_GAS_VERSION): Also provide gcc_cv_gas_vers\n\twhich contains the GAS version number as a scaled integer.\n\t(gcc_GAS_VERSION_GTE_IFELSE): Use gcc_cv_gas_vers.  Add\n\tability to check for ELF assembler.\n\t(gcc_GAS_CHECK_FEATURE): New macro.\n\t* configure.in: Use gcc_AC_CHECK_TYPE.  Rewrite all\n\tassembler feature checks using gcc_GAS_CHECK_FEATURE.\n\tUse three-argument AC_DEFINE everywhere.\n\t* acconfig.h: Deleted.\n\t* config.in, configure: Regenerate.\n\nFrom-SVN: r69272", "tree": {"sha": "e13e6d89a077f8b4bb07f9e345be8688e24246f3", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/e13e6d89a077f8b4bb07f9e345be8688e24246f3"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/8ada417fa14ff7efe2a06eb5143b34d7c05dab2f", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/8ada417fa14ff7efe2a06eb5143b34d7c05dab2f", "html_url": "https://github.com/Rust-GCC/gccrs/commit/8ada417fa14ff7efe2a06eb5143b34d7c05dab2f", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/8ada417fa14ff7efe2a06eb5143b34d7c05dab2f/comments", "author": null, "committer": null, "parents": [{"sha": "d33fb69b53150065ed0dcc8939f98b13e55ede10", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/d33fb69b53150065ed0dcc8939f98b13e55ede10", "html_url": "https://github.com/Rust-GCC/gccrs/commit/d33fb69b53150065ed0dcc8939f98b13e55ede10"}], "stats": {"total": 2615, "additions": 1208, "deletions": 1407}, "files": [{"sha": "34b8c92f2a50f17a2a7219e6cf0e94b83809e845", "filename": "gcc/ChangeLog", "status": "modified", "additions": 16, "deletions": 0, "changes": 16, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/8ada417fa14ff7efe2a06eb5143b34d7c05dab2f/gcc%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/8ada417fa14ff7efe2a06eb5143b34d7c05dab2f/gcc%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2FChangeLog?ref=8ada417fa14ff7efe2a06eb5143b34d7c05dab2f", "patch": "@@ -1,3 +1,19 @@\n+2003-07-12  Zack Weinberg  <zack@codesourcery.com>\n+\n+\t* aclocal.m4 (gcc_AC_CHECK_TYPE): Clone of AC_CHECK_TYPE,\n+\tuses three-argument AC_DEFINE so no acconfig.h entries are\n+\tneeded.\n+\t(_gcc_COMPUTE_GAS_VERSION): Also provide gcc_cv_gas_vers\n+\twhich contains the GAS version number as a scaled integer.\n+\t(gcc_GAS_VERSION_GTE_IFELSE): Use gcc_cv_gas_vers.  Add\n+\tability to check for ELF assembler.\n+\t(gcc_GAS_CHECK_FEATURE): New macro.\n+\t* configure.in: Use gcc_AC_CHECK_TYPE.  Rewrite all\n+\tassembler feature checks using gcc_GAS_CHECK_FEATURE.\n+\tUse three-argument AC_DEFINE everywhere.\n+\t* acconfig.h: Deleted.\n+\t* config.in, configure: Regenerate.\n+\n 2003-07-12  Nathanael Nerode  <neroden@gcc.gnu.org>\n \n \t* fixinc/inclhack.def (struct_sockaddr): Avoid \"fixing\" sockaddr_in"}, {"sha": "b31910a5e6082f250a6d3e8f36dc1ecf9915d015", "filename": "gcc/acconfig.h", "status": "removed", "additions": 0, "deletions": 29, "changes": 29, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/d33fb69b53150065ed0dcc8939f98b13e55ede10/gcc%2Facconfig.h", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/d33fb69b53150065ed0dcc8939f98b13e55ede10/gcc%2Facconfig.h", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Facconfig.h?ref=d33fb69b53150065ed0dcc8939f98b13e55ede10", "patch": "@@ -1,29 +0,0 @@\n-/* Define if your assembler supports specifying the maximum number\n-   of bytes to skip when using the GAS .p2align command.  */\n-#undef HAVE_GAS_MAX_SKIP_P2ALIGN\n-\n-/* Define if your assembler supports .balign and .p2align.  */\n-#undef HAVE_GAS_BALIGN_AND_P2ALIGN\n-\n-/* Define if your assembler uses the old HImode fild and fist notation.  */\n-#undef HAVE_GAS_FILDS_FISTS\n-\n-/* Define to `int' if <sys/types.h> doesn't define.  */\n-#undef ssize_t\n-\n-/* Define if cpp should also search $prefix/include.  */\n-#undef PREFIX_INCLUDE_DIR\n-\n-@BOTTOM@\n-\n-/* Bison unconditionally undefines `const' if neither `__STDC__' nor\n-   __cplusplus are defined.  That's a problem since we use `const' in\n-   the GCC headers, and the resulting bison code is therefore type\n-   unsafe.  Thus, we must match the bison behavior here.  */\n-\n-#ifndef __STDC__\n-#ifndef __cplusplus\n-#undef const\n-#define const\n-#endif\n-#endif"}, {"sha": "8c3c5ac8583bde9259b36406fdd94377a5d62158", "filename": "gcc/aclocal.m4", "status": "modified", "additions": 72, "deletions": 17, "changes": 89, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/8ada417fa14ff7efe2a06eb5143b34d7c05dab2f/gcc%2Faclocal.m4", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/8ada417fa14ff7efe2a06eb5143b34d7c05dab2f/gcc%2Faclocal.m4", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Faclocal.m4?ref=8ada417fa14ff7efe2a06eb5143b34d7c05dab2f", "patch": "@@ -16,6 +16,27 @@ if test $ac_cv_header_stdbool_h = yes; then\n fi\n ])\n \n+dnl Fixed AC_CHECK_TYPE that doesn't need anything in acconfig.h.\n+dnl Remove after migrating to 2.5x.\n+AC_DEFUN(gcc_AC_CHECK_TYPE,\n+[AC_REQUIRE([AC_HEADER_STDC])dnl\n+AC_MSG_CHECKING(for $1)\n+AC_CACHE_VAL(ac_cv_type_$1,\n+[AC_EGREP_CPP(dnl\n+changequote(<<,>>)dnl\n+<<(^|[^a-zA-Z_0-9])$1[^a-zA-Z_0-9]>>dnl\n+changequote([,]), [#include <sys/types.h>\n+#if STDC_HEADERS\n+#include <stdlib.h>\n+#include <stddef.h>\n+#endif], ac_cv_type_$1=yes, ac_cv_type_$1=no)])dnl\n+AC_MSG_RESULT($ac_cv_type_$1)\n+if test $ac_cv_type_$1 = no; then\n+  AC_DEFINE($1, $2, [Define as \\`$2' if <sys/types.h> doesn't define.])\n+fi\n+])\n+\n+\n dnl See whether we can include both string.h and strings.h.\n AC_DEFUN(gcc_AC_HEADER_STRING,\n [AC_CACHE_CHECK([whether string.h and strings.h may both be included],\n@@ -659,9 +680,12 @@ done\n gcc_cv_gas_major_version=`expr \"$gcc_cv_gas_version\" : \"VERSION=\\([[0-9]]*\\)\"`\n gcc_cv_gas_minor_version=`expr \"$gcc_cv_gas_version\" : \"VERSION=[[0-9]]*\\.\\([[0-9]]*\\)\"`\n gcc_cv_gas_patch_version=`expr \"$gcc_cv_gas_version\" : \"VERSION=[[0-9]]*\\.[[0-9]]*\\.\\([[0-9]]*\\)\"`\n+gcc_cv_gas_vers=`expr \\( \\( $gcc_cv_gas_major_version \\* 1000 \\) \\\n+\t\t\t    + $gcc_cv_gas_minor_version \\) \\* 1000 \\\n+\t\t\t    + $gcc_cv_gas_patch_version`\n ]) []dnl # _gcc_COMPUTE_GAS_VERSION\n \n-dnl # gcc_GAS_VERSION_GTE_IFELSE(major, minor, patchlevel,\n+dnl # gcc_GAS_VERSION_GTE_IFELSE([elf,] major, minor, patchlevel,\n dnl #                     [command_if_true = :], [command_if_false = :])\n dnl # Check to see if the version of GAS is greater than or\n dnl # equal to the specified version.\n@@ -670,23 +694,54 @@ dnl # The first ifelse() shortens the shell code if the patchlevel\n dnl # is unimportant (the usual case).  The others handle missing\n dnl # commands.  Note that the tests are structured so that the most\n dnl # common version number cases are tested first.\n+AC_DEFUN([_gcc_GAS_VERSION_GTE_IFELSE],\n+[ifelse([$1], elf,\n+ [if test $in_tree_gas_is_elf = yes \\\n+  &&],\n+ [if]) test $gcc_cv_gas_vers -ge `expr \\( \\( $2 \\* 1000 \\) + $3 \\) \\* 1000 + $4`\n+  then dnl\n+ifelse([$5],,:,[$5])[]dnl\n+ifelse([$6],,,[\n+  else $6])\n+fi])\n+\n AC_DEFUN([gcc_GAS_VERSION_GTE_IFELSE],\n-[AC_REQUIRE([_gcc_COMPUTE_GAS_VERSION]) []dnl\n-ifelse([$3],[0],\n-[if test $gcc_cv_gas_major_version -eq $1 \\\n-&& test $gcc_cv_gas_minor_version -ge $2 \\\n-|| test $gcc_cv_gas_major_version -gt $1 ; then\n-],\n-[if test $gcc_cv_gas_major_version -eq $1 \\\n-&& (test $gcc_cv_gas_minor_version -gt $2 \\\n-    || (test $gcc_cv_gas_minor_version -eq $2 \\\n-        && test $gcc_cv_gas_patch_version -ge $3 )) \\\n-|| test $gcc_cv_gas_major_version -gt $1 ; then\n-])\n-ifelse([$4],[],[:],[$4])\n-ifelse([$5],[],[],[else $5])\n-fi\n-]) []dnl # gcc_GAS_VERSION_GTE_IFELSE\n+[AC_REQUIRE([_gcc_COMPUTE_GAS_VERSION])dnl\n+ifelse([$1], elf, [_gcc_GAS_VERSION_GTE_IFELSE($@)],\n+                  [_gcc_GAS_VERSION_GTE_IFELSE(,$@)])])\n+\n+dnl gcc_GAS_CHECK_FEATURE(description, cv, [[elf,]major,minor,patchlevel],\n+dnl [extra switches to as], [assembler input],\n+dnl [extra testing logic], [command if feature available])\n+dnl\n+dnl Checks for an assembler feature.  If we are building an in-tree\n+dnl gas, the feature is available if the associated assembler version\n+dnl is greater than or equal to major.minor.patchlevel.  If not, then\n+dnl ASSEMBLER INPUT is fed to the assembler and the feature is available\n+dnl if assembly succeeds.  If EXTRA TESTING LOGIC is not the empty string,\n+dnl then it is run instead of simply setting CV to \"yes\" - it is responsible\n+dnl for doing so, if appropriate.\n+AC_DEFUN([gcc_GAS_CHECK_FEATURE],\n+[AC_CACHE_CHECK([assembler for $1], [$2],\n+ [[$2]=no\n+  ifelse([$3],,,[dnl\n+  if test $in_tree_gas = yes; then\n+    gcc_GAS_VERSION_GTE_IFELSE($3, [[$2]=yes])\n+  el])if test x$gcc_cv_as != x; then\n+    echo ifelse(substr([$5],0,1),[$], \"[$5]\", '[$5]') > conftest.s\n+    if AC_TRY_COMMAND([$gcc_cv_as $4 -o conftest.o conftest.s >&AC_FD_CC])\n+    then\n+\tifelse([$6],, [$2]=yes, [$6])\n+    else\n+      echo \"configure: failed program was\" >&AC_FD_CC\n+      cat conftest.s >&AC_FD_CC\n+    fi\n+    rm -f conftest.o conftest.s\n+  fi])\n+ifelse([$7],,,[dnl\n+if test $[$2] = yes; then\n+  $7\n+fi])])\n \n # lcmessage.m4 serial 3 (gettext-0.11.3)\n dnl Copyright (C) 1995-2002 Free Software Foundation, Inc."}, {"sha": "106fcc605e8958a09ae2898edfe16052afc7075e", "filename": "gcc/config.in", "status": "modified", "additions": 17, "deletions": 32, "changes": 49, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/8ada417fa14ff7efe2a06eb5143b34d7c05dab2f/gcc%2Fconfig.in", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/8ada417fa14ff7efe2a06eb5143b34d7c05dab2f/gcc%2Fconfig.in", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fconfig.in?ref=8ada417fa14ff7efe2a06eb5143b34d7c05dab2f", "patch": "@@ -34,22 +34,6 @@\n /* Define vfork as fork if vfork does not work.  */\n #undef vfork\n \n-/* Define if your assembler supports specifying the maximum number\n-   of bytes to skip when using the GAS .p2align command.  */\n-#undef HAVE_GAS_MAX_SKIP_P2ALIGN\n-\n-/* Define if your assembler supports .balign and .p2align.  */\n-#undef HAVE_GAS_BALIGN_AND_P2ALIGN\n-\n-/* Define if your assembler uses the old HImode fild and fist notation.  */\n-#undef HAVE_GAS_FILDS_FISTS\n-\n-/* Define to `int' if <sys/types.h> doesn't define.  */\n-#undef ssize_t\n-\n-/* Define if cpp should also search $prefix/include.  */\n-#undef PREFIX_INCLUDE_DIR\n-\n /* Define if you have the alphasort function.  */\n #undef HAVE_ALPHASORT\n \n@@ -288,6 +272,9 @@\n    first argument is NULL. */\n #undef HAVE_WORKING_MBSTOWCS\n \n+/* Define as `int' if <sys/types.h> doesn't define. */\n+#undef ssize_t\n+\n /* Define if printf supports %p. */\n #undef HAVE_PRINTF_PTR\n \n@@ -442,17 +429,24 @@\n /* Define to be the last portion of registry key on windows hosts. */\n #undef WIN32_REGISTRY_KEY\n \n+/* Define if your assembler supports .balign and .p2align. */\n+#undef HAVE_GAS_BALIGN_AND_P2ALIGN\n+\n+/* Define if your assembler supports specifying the maximum number\n+   of bytes to skip when using the GAS .p2align command. */\n+#undef HAVE_GAS_MAX_SKIP_P2ALIGN\n+\n /* Define if your assembler supports .subsection and .subsection -1 starts\n    emitting at the beginning of your section. */\n #undef HAVE_GAS_SUBSECTION_ORDERING\n \n /* Define if your assembler supports .weak. */\n #undef HAVE_GAS_WEAK\n \n-/* Define if your assembler supports .hidden. */\n+/* Define if your assembler and linker support .hidden. */\n #undef HAVE_GAS_HIDDEN\n \n-/* Define if your assembler supports .uleb128. */\n+/* Define if your assembler supports .sleb128 and .uleb128. */\n #undef HAVE_AS_LEB128\n \n /* Define if your assembler mis-optimizes .eh_frame data. */\n@@ -482,6 +476,9 @@\n /* Define if your assembler supports offsetable %lo(). */\n #undef HAVE_AS_OFFSETABLE_LO10\n \n+/* Define if your assembler uses the new HImode fild and fist notation. */\n+#undef HAVE_GAS_FILDS_FISTS\n+\n /* Define true if the assembler supports '.long foo@GOTOFF'. */\n #undef HAVE_AS_GOTOFF_IN_DATA\n \n@@ -498,9 +495,6 @@\n /* Define if your assembler supports the --gdwarf2 option. */\n #undef HAVE_AS_GDWARF2_DEBUG_FLAG\n \n-/* Define if your assembler supports the --gstabs option. */\n-#undef HAVE_AS_GSTABS_DEBUG_FLAG\n-\n /* Define if your linker links a mix of read-only\n    and read-write sections into a read-write section. */\n #undef HAVE_LD_RO_RW_SECTION_MIXING\n@@ -514,15 +508,6 @@\n /* Define if your MIPS libgloss linker scripts consistently include STARTUP directives. */\n #undef HAVE_MIPS_LIBGLOSS_STARTUP_DIRECTIVES\n \n+/* Define to PREFIX/include if cpp should also search that directory. */\n+#undef PREFIX_INCLUDE_DIR\n \n-/* Bison unconditionally undefines `const' if neither `__STDC__' nor\n-   __cplusplus are defined.  That's a problem since we use `const' in\n-   the GCC headers, and the resulting bison code is therefore type\n-   unsafe.  Thus, we must match the bison behavior here.  */\n-\n-#ifndef __STDC__\n-#ifndef __cplusplus\n-#undef const\n-#define const\n-#endif\n-#endif"}, {"sha": "fe3ac94ff5d24646c84b7f4de29864687f65abff", "filename": "gcc/configure", "status": "modified", "additions": 763, "deletions": 714, "changes": 1477, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/8ada417fa14ff7efe2a06eb5143b34d7c05dab2f/gcc%2Fconfigure", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/8ada417fa14ff7efe2a06eb5143b34d7c05dab2f/gcc%2Fconfigure", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fconfigure?ref=8ada417fa14ff7efe2a06eb5143b34d7c05dab2f", "patch": "@@ -5767,6 +5767,9 @@ done\n gcc_cv_gas_major_version=`expr \"$gcc_cv_gas_version\" : \"VERSION=\\([0-9]*\\)\"`\n gcc_cv_gas_minor_version=`expr \"$gcc_cv_gas_version\" : \"VERSION=[0-9]*\\.\\([0-9]*\\)\"`\n gcc_cv_gas_patch_version=`expr \"$gcc_cv_gas_version\" : \"VERSION=[0-9]*\\.[0-9]*\\.\\([0-9]*\\)\"`\n+gcc_cv_gas_vers=`expr \\( \\( $gcc_cv_gas_major_version \\* 1000 \\) \\\n+\t\t\t    + $gcc_cv_gas_minor_version \\) \\* 1000 \\\n+\t\t\t    + $gcc_cv_gas_patch_version`\n \n   rm -f as$host_exeext\n   $symbolic_link ../gas/as-new$host_exeext as$host_exeext 2>/dev/null\n@@ -5855,7 +5858,7 @@ esac\n # build->target linker and hope that it will have the same features\n # as the host->target linker we'll be using.\n echo $ac_n \"checking what linker to use\"\"... $ac_c\" 1>&6\n-echo \"configure:5859: checking what linker to use\" >&5\n+echo \"configure:5862: checking what linker to use\" >&5\n in_tree_ld=no\n gcc_cv_ld=\n gcc_cv_gld_major_version=\n@@ -5963,7 +5966,7 @@ esac\n # Figure out what nm we will be using.\n gcc_cv_binutils_srcdir=`echo $srcdir | sed -e 's,/gcc$,,'`/binutils\n echo $ac_n \"checking what nm to use\"\"... $ac_c\" 1>&6\n-echo \"configure:5967: checking what nm to use\" >&5\n+echo \"configure:5970: checking what nm to use\" >&5\n in_tree_nm=no\n if test -x nm$host_exeext; then\n \tgcc_cv_nm=./nm$host_exeext\n@@ -5986,7 +5989,7 @@ esac\n \n # Figure out what objdump we will be using.\n echo $ac_n \"checking what objdump to use\"\"... $ac_c\" 1>&6\n-echo \"configure:5990: checking what objdump to use\" >&5\n+echo \"configure:5993: checking what objdump to use\" >&5\n in_tree_objdump=no\n if test -x objdump$host_exeext; then\n \tgcc_cv_objdump=./objdump$host_exeext\n@@ -6010,305 +6013,318 @@ case $in_tree_objdump in\n esac\n \n # Figure out what assembler alignment features are present.\n-echo $ac_n \"checking assembler alignment features\"\"... $ac_c\" 1>&6\n-echo \"configure:6015: checking assembler alignment features\" >&5\n-gcc_cv_as_alignment_features=none\n-if test $in_tree_gas = yes; then\n-  # Gas version 2.6 and later support for .balign and .p2align.\n-   if test $gcc_cv_gas_major_version -eq 2 \\\n-&& test $gcc_cv_gas_minor_version -ge 6 \\\n-|| test $gcc_cv_gas_major_version -gt 2 ; then\n-\n+echo $ac_n \"checking assembler for .balign and .p2align\"\"... $ac_c\" 1>&6\n+echo \"configure:6018: checking assembler for .balign and .p2align\" >&5\n+if eval \"test \\\"`echo '$''{'gcc_cv_as_balign_and_p2align'+set}'`\\\" = set\"; then\n+  echo $ac_n \"(cached) $ac_c\" 1>&6\n+else\n+  gcc_cv_as_balign_and_p2align=no\n+    if test $in_tree_gas = yes; then\n+    if test $gcc_cv_gas_vers -ge `expr \\( \\( 2 \\* 1000 \\) + 6 \\) \\* 1000 + 0`\n+  then gcc_cv_as_balign_and_p2align=yes\n+fi\n+  elif test x$gcc_cv_as != x; then\n+    echo '.balign 4\n+.p2align 2' > conftest.s\n+    if { ac_try='$gcc_cv_as  -o conftest.o conftest.s >&5'; { (eval echo configure:6030: \\\"$ac_try\\\") 1>&5; (eval $ac_try) 2>&5; }; }\n+    then\n+\tgcc_cv_as_balign_and_p2align=yes\n+    else\n+      echo \"configure: failed program was\" >&5\n+      cat conftest.s >&5\n+    fi\n+    rm -f conftest.o conftest.s\n+  fi\n+fi\n \n-    gcc_cv_as_alignment_features=\".balign and .p2align\"\n-    cat >> confdefs.h <<\\EOF\n+echo \"$ac_t\"\"$gcc_cv_as_balign_and_p2align\" 1>&6\n+if test $gcc_cv_as_balign_and_p2align = yes; then\n+  cat >> confdefs.h <<\\EOF\n #define HAVE_GAS_BALIGN_AND_P2ALIGN 1\n EOF\n \n-  \n-\n fi\n \n-  # Gas version 2.8 and later support specifying the maximum\n-  # bytes to skip when using .p2align.\n-   if test $gcc_cv_gas_major_version -eq 2 \\\n-&& test $gcc_cv_gas_minor_version -ge 8 \\\n-|| test $gcc_cv_gas_major_version -gt 2 ; then\n-\n-\n-    gcc_cv_as_alignment_features=\".p2align including maximum skip\"\n-    cat >> confdefs.h <<\\EOF\n-#define HAVE_GAS_MAX_SKIP_P2ALIGN 1\n-EOF\n-\n-  \n-\n+echo $ac_n \"checking assembler for .p2align with maximum skip\"\"... $ac_c\" 1>&6\n+echo \"configure:6050: checking assembler for .p2align with maximum skip\" >&5\n+if eval \"test \\\"`echo '$''{'gcc_cv_as_max_skip_p2align'+set}'`\\\" = set\"; then\n+  echo $ac_n \"(cached) $ac_c\" 1>&6\n+else\n+  gcc_cv_as_max_skip_p2align=no\n+    if test $in_tree_gas = yes; then\n+    if test $gcc_cv_gas_vers -ge `expr \\( \\( 2 \\* 1000 \\) + 8 \\) \\* 1000 + 0`\n+  then gcc_cv_as_max_skip_p2align=yes\n+fi\n+  elif test x$gcc_cv_as != x; then\n+    echo '.p2align 4,,7' > conftest.s\n+    if { ac_try='$gcc_cv_as  -o conftest.o conftest.s >&5'; { (eval echo configure:6061: \\\"$ac_try\\\") 1>&5; (eval $ac_try) 2>&5; }; }\n+    then\n+\tgcc_cv_as_max_skip_p2align=yes\n+    else\n+      echo \"configure: failed program was\" >&5\n+      cat conftest.s >&5\n+    fi\n+    rm -f conftest.o conftest.s\n+  fi\n fi\n \n-elif test x$gcc_cv_as != x; then\n-\t# Check if we have .balign and .p2align\n-\techo \".balign  4\" > conftest.s\n-\techo \".p2align  2\" >> conftest.s\n-\tif $gcc_cv_as -o conftest.o conftest.s > /dev/null 2>&1; then\n-\t\tgcc_cv_as_alignment_features=\".balign and .p2align\"\n-\t\tcat >> confdefs.h <<\\EOF\n-#define HAVE_GAS_BALIGN_AND_P2ALIGN 1\n-EOF\n-\n-\tfi\n-\trm -f conftest.s conftest.o\n-\t# Check if specifying the maximum bytes to skip when\n-\t# using .p2align is supported.\n-\techo \".p2align 4,,7\" > conftest.s\n-\tif $gcc_cv_as -o conftest.o conftest.s > /dev/null 2>&1; then\n-\t\tgcc_cv_as_alignment_features=\".p2align including maximum skip\"\n-\t\tcat >> confdefs.h <<\\EOF\n+echo \"$ac_t\"\"$gcc_cv_as_max_skip_p2align\" 1>&6\n+if test $gcc_cv_as_max_skip_p2align = yes; then\n+  cat >> confdefs.h <<\\EOF\n #define HAVE_GAS_MAX_SKIP_P2ALIGN 1\n EOF\n \n-\tfi\n-\trm -f conftest.s conftest.o\n fi\n-echo \"$ac_t\"\"$gcc_cv_as_alignment_features\" 1>&6\n-\n-echo $ac_n \"checking assembler subsection support\"\"... $ac_c\" 1>&6\n-echo \"configure:6076: checking assembler subsection support\" >&5\n-gcc_cv_as_subsections=no\n-if test $in_tree_gas = yes ; then\n-   if test $gcc_cv_gas_major_version -eq 2 \\\n-&& test $gcc_cv_gas_minor_version -ge 9 \\\n-|| test $gcc_cv_gas_major_version -gt 2 ; then\n-\n-\n-    test $in_tree_gas_is_elf = yes \\\n-\t&& gcc_cv_as_subsections=\"working .subsection -1\"\n-  \n \n+echo $ac_n \"checking assembler for working .subsection -1\"\"... $ac_c\" 1>&6\n+echo \"configure:6081: checking assembler for working .subsection -1\" >&5\n+if eval \"test \\\"`echo '$''{'gcc_cv_as_subsection_m1'+set}'`\\\" = set\"; then\n+  echo $ac_n \"(cached) $ac_c\" 1>&6\n+else\n+  gcc_cv_as_subsection_m1=no\n+    if test $in_tree_gas = yes; then\n+    if test $in_tree_gas_is_elf = yes \\\n+  && test $gcc_cv_gas_vers -ge `expr \\( \\( 2 \\* 1000 \\) + 9 \\) \\* 1000 + 0`\n+  then gcc_cv_as_subsection_m1=yes\n fi\n-\n-elif test x$gcc_cv_as != x; then\n-\t# Check if we have .subsection\n-\techo \".subsection 1\" > conftest.s\n-\tif $gcc_cv_as -o conftest.o conftest.s > /dev/null 2>&1; then\n-\t\tgcc_cv_as_subsections=\".subsection\"\n-\t\tif test x$gcc_cv_nm != x; then\n-\t\t\tcat > conftest.s <<EOF\n-conftest_label1: .word 0\n+  elif test x$gcc_cv_as != x; then\n+    echo 'conftest_label1: .word 0\n .subsection -1\n conftest_label2: .word 0\n-.previous\n-EOF\n-\t\t\tif $gcc_cv_as -o conftest.o conftest.s > /dev/null 2>&1; then\n-\t\t\t\t$gcc_cv_nm conftest.o | grep conftest_label1 > conftest.nm1\n-\t\t\t\t$gcc_cv_nm conftest.o | grep conftest_label2 | sed -e 's/label2/label1/' > conftest.nm2\n-\t\t\t\tif cmp conftest.nm1 conftest.nm2 > /dev/null 2>&1; then\n-\t\t\t\t\t:\n-\t\t\t\telse\n-\t\t\t\t\tgcc_cv_as_subsections=\"working .subsection -1\"\n-\t\t\t\tfi\n-\t\t\tfi\n-\t\tfi\n-\tfi\n-\trm -f conftest.s conftest.o conftest.nm1 conftest.nm2\n+.previous' > conftest.s\n+    if { ac_try='$gcc_cv_as  -o conftest.o conftest.s >&5'; { (eval echo configure:6096: \\\"$ac_try\\\") 1>&5; (eval $ac_try) 2>&5; }; }\n+    then\n+\tif test x$gcc_cv_nm != x; then\n+    $gcc_cv_nm conftest.o | grep conftest_label1 > conftest.nm1\n+    $gcc_cv_nm conftest.o | grep conftest_label2 | sed -e 's/label2/label1/' > conftest.nm2\n+    if cmp conftest.nm1 conftest.nm2 > /dev/null 2>&1\n+    then :\n+    else gcc_cv_as_subsection_m1=yes\n+    fi\n+    rm -f conftest.nm1 conftest.nm2\n+  fi\n+    else\n+      echo \"configure: failed program was\" >&5\n+      cat conftest.s >&5\n+    fi\n+    rm -f conftest.o conftest.s\n+  fi\n fi\n-if test x\"$gcc_cv_as_subsections\" = x\"working .subsection -1\"; then\n-\tcat >> confdefs.h <<\\EOF\n+\n+echo \"$ac_t\"\"$gcc_cv_as_subsection_m1\" 1>&6\n+if test $gcc_cv_as_subsection_m1 = yes; then\n+  cat >> confdefs.h <<\\EOF\n #define HAVE_GAS_SUBSECTION_ORDERING 1\n EOF\n \n fi\n-echo \"$ac_t\"\"$gcc_cv_as_subsections\" 1>&6\n-\n-echo $ac_n \"checking assembler weak support\"\"... $ac_c\" 1>&6\n-echo \"configure:6124: checking assembler weak support\" >&5\n-gcc_cv_as_weak=no\n-if test $in_tree_gas = yes ; then\n-   if test $gcc_cv_gas_major_version -eq 2 \\\n-&& test $gcc_cv_gas_minor_version -ge 2 \\\n-|| test $gcc_cv_gas_major_version -gt 2 ; then\n-\n-\n-    gcc_cv_as_weak=\"yes\"\n-  \n \n+echo $ac_n \"checking assembler for .weak\"\"... $ac_c\" 1>&6\n+echo \"configure:6124: checking assembler for .weak\" >&5\n+if eval \"test \\\"`echo '$''{'gcc_cv_as_weak'+set}'`\\\" = set\"; then\n+  echo $ac_n \"(cached) $ac_c\" 1>&6\n+else\n+  gcc_cv_as_weak=no\n+    if test $in_tree_gas = yes; then\n+    if test $gcc_cv_gas_vers -ge `expr \\( \\( 2 \\* 1000 \\) + 2 \\) \\* 1000 + 0`\n+  then gcc_cv_as_weak=yes\n fi\n-\n-elif test x$gcc_cv_as != x; then\n-\t# Check if we have .weak\n-\techo \"\t.weak foobar\" > conftest.s\n-\tif $gcc_cv_as -o conftest.o conftest.s > /dev/null 2>&1; then\n-\t\tgcc_cv_as_weak=\"yes\"\n-\tfi\n-\trm -f conftest.s conftest.o conftest.nm1 conftest.nm2\n+  elif test x$gcc_cv_as != x; then\n+    echo '\t.weak foobar' > conftest.s\n+    if { ac_try='$gcc_cv_as  -o conftest.o conftest.s >&5'; { (eval echo configure:6135: \\\"$ac_try\\\") 1>&5; (eval $ac_try) 2>&5; }; }\n+    then\n+\tgcc_cv_as_weak=yes\n+    else\n+      echo \"configure: failed program was\" >&5\n+      cat conftest.s >&5\n+    fi\n+    rm -f conftest.o conftest.s\n+  fi\n fi\n-if test x\"$gcc_cv_as_weak\" = xyes; then\n-\tcat >> confdefs.h <<\\EOF\n+\n+echo \"$ac_t\"\"$gcc_cv_as_weak\" 1>&6\n+if test $gcc_cv_as_weak = yes; then\n+  cat >> confdefs.h <<\\EOF\n #define HAVE_GAS_WEAK 1\n EOF\n \n fi\n-echo \"$ac_t\"\"$gcc_cv_as_weak\" 1>&6\n-\n-echo $ac_n \"checking assembler hidden support\"\"... $ac_c\" 1>&6\n-echo \"configure:6154: checking assembler hidden support\" >&5\n-gcc_cv_as_hidden=no\n-if test $in_tree_gas = yes ; then\n-   if test $gcc_cv_gas_major_version -eq 2 \\\n-&& (test $gcc_cv_gas_minor_version -gt 12 \\\n-    || (test $gcc_cv_gas_minor_version -eq 12 \\\n-        && test $gcc_cv_gas_patch_version -ge 1 )) \\\n-|| test $gcc_cv_gas_major_version -gt 2 ; then\n \n+# .hidden needs to be supported in both the assembler and the linker,\n+# because GNU LD versions before 2.12.1 have buggy support for STV_HIDDEN.\n+# This is irritatingly difficult to feature test for; we have to check the\n+# date string after the version number.  If we've got an in-tree\n+# ld, we don't know its patchlevel version, so we set the baseline at 2.13\n+# to be safe.\n+# The gcc_GAS_CHECK_FEATURE call just sets a cache variable.\n+echo $ac_n \"checking assembler for .hidden\"\"... $ac_c\" 1>&6\n+echo \"configure:6162: checking assembler for .hidden\" >&5\n+if eval \"test \\\"`echo '$''{'gcc_cv_as_hidden'+set}'`\\\" = set\"; then\n+  echo $ac_n \"(cached) $ac_c\" 1>&6\n+else\n+  gcc_cv_as_hidden=no\n+    if test $in_tree_gas = yes; then\n+    if test $in_tree_gas_is_elf = yes \\\n+  && test $gcc_cv_gas_vers -ge `expr \\( \\( 2 \\* 1000 \\) + 13 \\) \\* 1000 + 0`\n+  then gcc_cv_as_hidden=yes\n+fi\n+  elif test x$gcc_cv_as != x; then\n+    echo '\t.hidden foobar\n+foobar:' > conftest.s\n+    if { ac_try='$gcc_cv_as  -o conftest.o conftest.s >&5'; { (eval echo configure:6175: \\\"$ac_try\\\") 1>&5; (eval $ac_try) 2>&5; }; }\n+    then\n+\tgcc_cv_as_hidden=yes\n+    else\n+      echo \"configure: failed program was\" >&5\n+      cat conftest.s >&5\n+    fi\n+    rm -f conftest.o conftest.s\n+  fi\n+fi\n \n-    test $in_tree_gas_is_elf = yes && gcc_cv_as_hidden=\"yes\"\n-  \n+echo \"$ac_t\"\"$gcc_cv_as_hidden\" 1>&6\n \n-fi\n \n-elif test x$gcc_cv_as != x; then\n-\t# Check if we have .hidden\n-\techo \"\t.hidden foobar\" > conftest.s\n-\techo \"foobar:\" >> conftest.s\n-\tif $gcc_cv_as -o conftest.o conftest.s > /dev/null 2>&1; then\n-\t\tgcc_cv_as_hidden=\"yes\"\n-\tfi\n-\trm -f conftest.s conftest.o conftest.nm1 conftest.nm2\n-\n- \t# GNU LD versions before 2.12.1 have buggy support for STV_HIDDEN.\n-\t# This is irritatingly difficult to feature test for.  Look for \n-\t# the date string after the version number.\n-\tld_ver=`$gcc_cv_ld --version 2>/dev/null | head -1`\n-\tif echo \"$ld_ver\" | grep GNU > /dev/null; then\n-               ld_vers=`echo $ld_ver | sed -n \\\n-\t       -e 's,^.*[\t ]\\([0-9][0-9]*\\.[0-9][0-9]*\\)$,\\1,p' \\\n-\t       -e 's,^.*[\t ]\\([0-9][0-9]*\\.[0-9][0-9]*\\.[0-9][0-9]*\\)$,\\1,p' \\\n-\t       -e 's,^.*[\t ]\\([0-9][0-9]*\\.[0-9][0-9]*\\.[0-9][0-9]*\\.[0-9][0-9]*\\)$,\\1,p' \\\n-\t       -e 's,^.*[\t ]\\([0-9][0-9]*\\.[0-9][0-9]*\\)[\t ].*$,\\1,p' \\\n-\t       -e 's,^.*[\t ]\\([0-9][0-9]*\\.[0-9][0-9]*\\.[0-9][0-9]*\\)[\t ].*$,\\1,p' \\\n-\t       -e 's,^.*[\t ]\\([0-9][0-9]*\\.[0-9][0-9]*\\.[0-9][0-9]*\\.[0-9][0-9]*\\)[\t ].*$,\\1,p'`\n-               ld_date=`echo $ld_ver | sed -n 's,^.*\\([2-9][0-9][0-9][0-9]\\)[-]*\\([01][0-9]\\)[-]*\\([0-3][0-9]\\).*$,\\1\\2\\3,p'`\n-\t\tif test 0\"$ld_date\" -lt 20020404; then\n-\t\t\tif test -n \"$ld_date\"; then\n-\t\t\t\t# If there was date string, but was earlier than 2002-04-04, fail\n-\t\t\t\tgcc_cv_as_hidden=\"no\"\n-\t\t\telif test -z \"$ld_vers\"; then\n-\t\t\t\t# If there was no date string nor ld version number, something is wrong\n-\t\t\t\tgcc_cv_as_hidden=\"no\"\n-\t\t\telse\n-\t\t\t\tld_vers_major=`expr \"$ld_vers\" : '\\([0-9]*\\)'`\n-\t\t\t\tld_vers_minor=`expr \"$ld_vers\" : '[0-9]*\\.\\([0-9]*\\)'`\n-\t\t\t\tld_vers_patch=`expr \"$ld_vers\" : '[0-9]*\\.[0-9]*\\.\\([0-9]*\\)'`\n-\t\t\t\ttest -z \"$ld_vers_patch\" && ld_vers_patch=0\n-\t\t\t\tif test \"$ld_vers_major\" -lt 2; then\n-\t\t\t\t\tgcc_cv_as_hidden=\"no\"\n-\t\t\t\telif test \"$ld_vers_major\" -eq 2 -a \"$ld_vers_minor\" -lt 12; then\n-\t\t\t\t\tgcc_cv_as_hidden=\"no\"\n-\t\t\t\telif test \"$ld_vers_major\" -eq 2 -a \"$ld_vers_minor\" -eq 12 \\\n-\t\t\t\t\t  -a \"$ld_vers_patch\" -eq 0; then\n-\t\t\t\t\tgcc_cv_as_hidden=\"no\"\n-\t\t\t\tfi\n-\t\t\tfi\n-\t\tfi\n+echo $ac_n \"checking linker for .hidden support\"\"... $ac_c\" 1>&6\n+echo \"configure:6190: checking linker for .hidden support\" >&5\n+if eval \"test \\\"`echo '$''{'gcc_cv_ld_hidden'+set}'`\\\" = set\"; then\n+  echo $ac_n \"(cached) $ac_c\" 1>&6\n+else\n+  if test $in_tree_ld = yes ; then\n+  gcc_cv_ld_hidden=no\n+  if test \"$gcc_cv_gld_major_version\" -eq 2 -a \"$gcc_cv_gld_minor_version\" -ge 13 -o \"$gcc_cv_gld_major_version\" -gt 2 \\\n+     && test $in_tree_ld_is_elf = yes; then\n+     gcc_cv_ld_hidden=yes\n+  fi\n+else\n+  gcc_cv_ld_hidden=yes\n+  ld_ver=`$gcc_cv_ld --version 2>/dev/null | head -1`\n+  if echo \"$ld_ver\" | grep GNU > /dev/null; then\n+    ld_vers=`echo $ld_ver | sed -n \\\n+\t-e 's,^.*[\t ]\\([0-9][0-9]*\\.[0-9][0-9]*\\)$,\\1,p' \\\n+\t-e 's,^.*[\t ]\\([0-9][0-9]*\\.[0-9][0-9]*\\.[0-9][0-9]*\\)$,\\1,p' \\\n+\t-e 's,^.*[\t ]\\([0-9][0-9]*\\.[0-9][0-9]*\\.[0-9][0-9]*\\.[0-9][0-9]*\\)$,\\1,p' \\\n+\t-e 's,^.*[\t ]\\([0-9][0-9]*\\.[0-9][0-9]*\\)[\t ].*$,\\1,p' \\\n+\t-e 's,^.*[\t ]\\([0-9][0-9]*\\.[0-9][0-9]*\\.[0-9][0-9]*\\)[\t ].*$,\\1,p' \\\n+\t-e 's,^.*[\t ]\\([0-9][0-9]*\\.[0-9][0-9]*\\.[0-9][0-9]*\\.[0-9][0-9]*\\)[\t ].*$,\\1,p'`\n+    ld_date=`echo $ld_ver | sed -n 's,^.*\\([2-9][0-9][0-9][0-9]\\)[-]*\\([01][0-9]\\)[-]*\\([0-3][0-9]\\).*$,\\1\\2\\3,p'`\n+    if test 0\"$ld_date\" -lt 20020404; then\n+      if test -n \"$ld_date\"; then\n+\t# If there was date string, but was earlier than 2002-04-04, fail\n+\tgcc_cv_ld_hidden=no\n+      elif test -z \"$ld_vers\"; then\n+\t# If there was no date string nor ld version number, something is wrong\n+\tgcc_cv_ld_hidden=no\n+      else\n+\tld_vers_major=`expr \"$ld_vers\" : '\\([0-9]*\\)'`\n+\tld_vers_minor=`expr \"$ld_vers\" : '[0-9]*\\.\\([0-9]*\\)'`\n+\tld_vers_patch=`expr \"$ld_vers\" : '[0-9]*\\.[0-9]*\\.\\([0-9]*\\)'`\n+\ttest -z \"$ld_vers_patch\" && ld_vers_patch=0\n+\tif test \"$ld_vers_major\" -lt 2; then\n+\t  gcc_cv_ld_hidden=no\n+\telif test \"$ld_vers_major\" -eq 2 -a \"$ld_vers_minor\" -lt 12; then\n+\t  gcc_cv_ld_hidden=\"no\"\n+\telif test \"$ld_vers_major\" -eq 2 -a \"$ld_vers_minor\" -eq 12 -a \"$ld_vers_patch\" -eq 0; then\n+\t  gcc_cv_ld_hidden=no\n \tfi\n-fi\n-case \"$target\" in\n-  mips-sgi-irix6*)\n-    if test x\"$gnu_ld_flag\" = x\"no\"; then\n-      # Even if using gas with .hidden support, the resulting object files\n-      # cannot be linked with the IRIX 6 O32 linker.  With the N32 and\n-      # N64 linkers, the problem is that the linker refuses to accept\n-      # -call_shared (passed by default to the linker) and -r (used to\n-      # link the object file generated without .hidden directives with\n-      # one that hides symbols), so we also lose.\n-      gcc_cv_as_hidden=no\n+      fi\n     fi\n-    ;;\n-esac\n-if test x\"$gcc_cv_as_hidden\" = xyes; then\n-\tcat >> confdefs.h <<\\EOF\n-#define HAVE_GAS_HIDDEN 1\n-EOF\n-\n+  else\n+    case \"$target\" in\n+      mips-sgi-irix6*)\n+        if test x\"$gnu_ld_flag\" = x\"no\"; then\n+          # Even if using gas with .hidden support, the resulting object files\n+          # cannot be linked with the IRIX 6 O32 linker.  With the N32 and\n+          # N64 linkers, the problem is that the linker refuses to accept\n+          # -call_shared (passed by default to the linker) and -r (used to\n+          # link the object file generated without .hidden directives with\n+          # one that hides symbols), so we also lose.\n+          gcc_cv_ld_hidden=no\n+        fi\n+     ;;\n+    esac\n+  fi\n+fi\n fi\n-echo \"$ac_t\"\"$gcc_cv_as_hidden\" 1>&6\n-libgcc_visibility=$gcc_cv_as_hidden\n-\n-\n-echo $ac_n \"checking assembler leb128 support\"\"... $ac_c\" 1>&6\n-echo \"configure:6239: checking assembler leb128 support\" >&5\n-gcc_cv_as_leb128=no\n-if test $in_tree_gas = yes ; then\n-   if test $gcc_cv_gas_major_version -eq 2 \\\n-&& test $gcc_cv_gas_minor_version -ge 11 \\\n-|| test $gcc_cv_gas_major_version -gt 2 ; then\n \n+echo \"$ac_t\"\"$gcc_cv_ld_hidden\" 1>&6\n+libgcc_visibility=no\n \n-    test $in_tree_gas_is_elf = yes && gcc_cv_as_leb128=\"yes\"\n-  \n+if test $gcc_cv_as_hidden = yes && test $gcc_cv_ld_hidden=yes; then\n+  libgcc_visibility=yes\n+  cat >> confdefs.h <<\\EOF\n+#define HAVE_GAS_HIDDEN 1\n+EOF\n \n fi\n \n-elif test x$gcc_cv_as != x; then\n-\t# Check if we have .[us]leb128, and support symbol arithmetic with it.\n-\tcat > conftest.s <<EOF\n-\t.data\n+# Check if we have .[us]leb128, and support symbol arithmetic with it.\n+echo $ac_n \"checking assembler for .sleb128 and .uleb128\"\"... $ac_c\" 1>&6\n+echo \"configure:6264: checking assembler for .sleb128 and .uleb128\" >&5\n+if eval \"test \\\"`echo '$''{'gcc_cv_as_leb128'+set}'`\\\" = set\"; then\n+  echo $ac_n \"(cached) $ac_c\" 1>&6\n+else\n+  gcc_cv_as_leb128=no\n+    if test $in_tree_gas = yes; then\n+    if test $in_tree_gas_is_elf = yes \\\n+  && test $gcc_cv_gas_vers -ge `expr \\( \\( 2 \\* 1000 \\) + 11 \\) \\* 1000 + 0`\n+  then gcc_cv_as_leb128=yes\n+fi\n+  elif test x$gcc_cv_as != x; then\n+    echo '\t.data\n \t.uleb128 L2 - L1\n L1:\n \t.uleb128 1280\n \t.sleb128 -1010\n-L2:\n-EOF\n-\tif $gcc_cv_as -o conftest.o conftest.s > /dev/null 2>&1; then\n-\t\tgcc_cv_as_leb128=\"yes\"\n-\n-\t\t# GAS versions before 2.11 do not support uleb128,\n-\t\t# despite appearing to.\n-\t\t# ??? There exists an elf-specific test that will crash\n-\t\t# the assembler.  Perhaps it's better to figure out whether\n-\t\t# arbitrary sections are supported and try the test.\n-\t\tas_ver=`$gcc_cv_as --version 2>/dev/null | head -1`\n-\t\tif echo \"$as_ver\" | grep GNU > /dev/null; then\n-\t\t\tas_ver=`echo $as_ver | sed -e 's/GNU assembler \\([0-9.][0-9.]*\\).*/\\1/'`\n-\t\t\tas_major=`echo $as_ver | sed 's/\\..*//'`\n-\t\t\tas_minor=`echo $as_ver | sed 's/[^.]*\\.\\([0-9]*\\).*/\\1/'`\n-\t\t\tif test $as_major -eq 2 -a $as_minor -lt 11; then\n-\t\t\t\tgcc_cv_as_leb128=\"no\"\n-\t\t\tfi\n-\t\tfi\n-\tfi\n-\trm -f conftest.s conftest.o conftest.nm1 conftest.nm2\n+L2:' > conftest.s\n+    if { ac_try='$gcc_cv_as  -o conftest.o conftest.s >&5'; { (eval echo configure:6281: \\\"$ac_try\\\") 1>&5; (eval $ac_try) 2>&5; }; }\n+    then\n+\t# GAS versions before 2.11 do not support uleb128,\n+  # despite appearing to.\n+  # ??? There exists an elf-specific test that will crash\n+  # the assembler.  Perhaps it's better to figure out whether\n+  # arbitrary sections are supported and try the test.\n+  as_ver=`$gcc_cv_as --version 2>/dev/null | head -1`\n+  if echo \"$as_ver\" | grep GNU > /dev/null; then\n+    as_ver=`echo $as_ver | sed -e 's/GNU assembler \\([0-9.][0-9.]*\\).*/\\1/'`\n+    as_major=`echo $as_ver | sed 's/\\..*//'`\n+    as_minor=`echo $as_ver | sed 's/[^.]*\\.\\([0-9]*\\).*/\\1/'`\n+    if test $as_major -eq 2 && test $as_minor -lt 11\n+    then :\n+    else gcc_cv_as_leb128=yes\n+    fi\n+  fi\n+    else\n+      echo \"configure: failed program was\" >&5\n+      cat conftest.s >&5\n+    fi\n+    rm -f conftest.o conftest.s\n+  fi\n fi\n-if test x\"$gcc_cv_as_leb128\" = xyes; then\n-\tcat >> confdefs.h <<\\EOF\n+\n+echo \"$ac_t\"\"$gcc_cv_as_leb128\" 1>&6\n+if test $gcc_cv_as_leb128 = yes; then\n+  cat >> confdefs.h <<\\EOF\n #define HAVE_AS_LEB128 1\n EOF\n \n fi\n-echo \"$ac_t\"\"$gcc_cv_as_leb128\" 1>&6\n-\n-echo $ac_n \"checking assembler eh_frame optimization\"\"... $ac_c\" 1>&6\n-echo \"configure:6291: checking assembler eh_frame optimization\" >&5\n-gcc_cv_as_eh_frame=no\n-if test $in_tree_gas = yes ; then\n-   if test $gcc_cv_gas_major_version -eq 2 \\\n-&& test $gcc_cv_gas_minor_version -ge 12 \\\n-|| test $gcc_cv_gas_major_version -gt 2 ; then\n-\n-\n-    test $in_tree_gas_is_elf = yes && gcc_cv_as_eh_frame=\"yes\"\n-  \n \n+# GAS versions up to and including 2.11.0 may mis-optimize\n+# .eh_frame data.\n+echo $ac_n \"checking assembler for eh_frame optimization\"\"... $ac_c\" 1>&6\n+echo \"configure:6317: checking assembler for eh_frame optimization\" >&5\n+if eval \"test \\\"`echo '$''{'gcc_cv_as_eh_frame'+set}'`\\\" = set\"; then\n+  echo $ac_n \"(cached) $ac_c\" 1>&6\n+else\n+  gcc_cv_as_eh_frame=no\n+    if test $in_tree_gas = yes; then\n+    if test $in_tree_gas_is_elf = yes \\\n+  && test $gcc_cv_gas_vers -ge `expr \\( \\( 2 \\* 1000 \\) + 12 \\) \\* 1000 + 0`\n+  then gcc_cv_as_eh_frame=yes\n fi\n-\n-elif test x$gcc_cv_as != x; then\n-\t# Check if this is GAS.\n-\tas_ver=`$gcc_cv_as --version < /dev/null 2> /dev/null | head -1`\n-\trm -f a.out 2> /dev/null\n-\tif echo \"$as_ver\" | grep GNU > /dev/null; then\n-\t\t# Versions up to and including 2.11.0 may mis-optimize\n-\t\t# .eh_frame data.  Try something.\n-\t\tcat > conftest.s <<EOF\n-\t.text\n+  elif test x$gcc_cv_as != x; then\n+    echo '\t.text\n .LFB1:\n \t.4byte\t0\n .L1:\n@@ -6339,74 +6355,85 @@ __FRAME_BEGIN__:\n \t.4byte\t.LFE1-.LFB1\n \t.byte\t0x4\n \t.4byte\t.L1-.LFB1\n-.LEFDE1:\n-EOF\n-\t\tcat > conftest.lit <<EOF\n+.LEFDE1:' > conftest.s\n+    if { ac_try='$gcc_cv_as  -o conftest.o conftest.s >&5'; { (eval echo configure:6360: \\\"$ac_try\\\") 1>&5; (eval $ac_try) 2>&5; }; }\n+    then\n+\t  cat > conftest.lit <<EOF\n  0000 10000000 00000000 017a0001 781a0004  .........z..x...\n  0010 01000000 12000000 18000000 00000000  ................\n  0020 08000000 04080000 0044               .........D      \n EOF\n-\t\tcat > conftest.big <<EOF\n+  cat > conftest.big <<EOF\n  0000 00000010 00000000 017a0001 781a0004  .........z..x...\n  0010 00000001 00000012 00000018 00000000  ................\n  0020 00000008 04000000 0844               .........D      \n EOF\n-\t\t# If the assembler didn't choke, and we can objdump,\n-\t\t# and we got the correct data, then succeed.\n-\t\tif $gcc_cv_as -o conftest.o conftest.s > /dev/null 2>&1 \\\n-\t\t   && $gcc_cv_objdump -s -j .eh_frame conftest.o 2>/dev/null \\\n-\t\t      | tail -3 > conftest.got \\\n-\t\t   && { cmp conftest.lit conftest.got > /dev/null 2>&1 \\\n-\t\t        || cmp conftest.big conftest.got > /dev/null 2>&1; }\n-\t\tthen\n-\t\t\tgcc_cv_as_eh_frame=\"yes\"\n-\t\telse\n-\t\t\tgcc_cv_as_eh_frame=\"bad\"\n-\t\t\tif $gcc_cv_as -o conftest.o --traditional-format /dev/null; then\n-\t\t\t\tcat >> confdefs.h <<\\EOF\n-#define USE_AS_TRADITIONAL_FORMAT 1\n-EOF\n-\n-\t\t\tfi\n-\t\tfi\n-\tfi\n-\trm -f conftest.*\n+  # If the assembler didn't choke, and we can objdump,\n+  # and we got the correct data, then succeed.\n+  if test x$gcc_cv_objdump != x \\\n+  && $gcc_cv_objdump -s -j .eh_frame conftest.o 2>/dev/null \\\n+     | tail -3 > conftest.got \\\n+  && { cmp conftest.lit conftest.got > /dev/null 2>&1 \\\n+    || cmp conftest.big conftest.got > /dev/null 2>&1; }\n+  then\n+    gcc_cv_as_eh_frame=yes\n+  elif { ac_try='$gcc_cv_as -o conftest.o --traditional-format /dev/null'; { (eval echo configure:6381: \\\"$ac_try\\\") 1>&5; (eval $ac_try) 2>&5; }; }; then\n+    gcc_cv_as_eh_frame=buggy\n+  else\n+    # Uh oh, what do we do now?\n+    gcc_cv_as_eh_frame=no\n+  fi\n+    else\n+      echo \"configure: failed program was\" >&5\n+      cat conftest.s >&5\n+    fi\n+    rm -f conftest.o conftest.s\n+  fi\n fi\n-echo \"$ac_t\"\"$gcc_cv_as_eh_frame\" 1>&6\n \n-echo $ac_n \"checking assembler section merging support\"\"... $ac_c\" 1>&6\n-echo \"configure:6379: checking assembler section merging support\" >&5\n-gcc_cv_as_shf_merge=no\n-if test $in_tree_gas = yes ; then\n-   if test $gcc_cv_gas_major_version -eq 2 \\\n-&& test $gcc_cv_gas_minor_version -ge 12 \\\n-|| test $gcc_cv_gas_major_version -gt 2 ; then\n+echo \"$ac_t\"\"$gcc_cv_as_eh_frame\" 1>&6\n \n \n-    test $in_tree_gas_is_elf = yes && gcc_cv_as_shf_merge=\"yes\"\n-  \n+if test $gcc_cv_as_eh_frame = buggy; then\n+  cat >> confdefs.h <<\\EOF\n+#define USE_AS_TRADITIONAL_FORMAT 1\n+EOF\n \n fi\n \n-elif test x$gcc_cv_as != x; then\n-\t# Check if we support SHF_MERGE sections\n-\techo '.section .rodata.str, \"aMS\", @progbits, 1' > conftest.s\n-\tif $gcc_cv_as --fatal-warnings -o conftest.o conftest.s > /dev/null 2>&1; then\n-\t\tgcc_cv_as_shf_merge=yes\n-\tfi\n-\trm -f conftest.s conftest.o\n+echo $ac_n \"checking assembler for section merging support\"\"... $ac_c\" 1>&6\n+echo \"configure:6406: checking assembler for section merging support\" >&5\n+if eval \"test \\\"`echo '$''{'gcc_cv_as_shf_merge'+set}'`\\\" = set\"; then\n+  echo $ac_n \"(cached) $ac_c\" 1>&6\n+else\n+  gcc_cv_as_shf_merge=no\n+    if test $in_tree_gas = yes; then\n+    if test $in_tree_gas_is_elf = yes \\\n+  && test $gcc_cv_gas_vers -ge `expr \\( \\( 2 \\* 1000 \\) + 12 \\) \\* 1000 + 0`\n+  then gcc_cv_as_shf_merge=yes\n+fi\n+  elif test x$gcc_cv_as != x; then\n+    echo '.section .rodata.str, \"aMS\", @progbits, 1' > conftest.s\n+    if { ac_try='$gcc_cv_as --fatal-warnings -o conftest.o conftest.s >&5'; { (eval echo configure:6418: \\\"$ac_try\\\") 1>&5; (eval $ac_try) 2>&5; }; }\n+    then\n+\tgcc_cv_as_shf_merge=yes\n+    else\n+      echo \"configure: failed program was\" >&5\n+      cat conftest.s >&5\n+    fi\n+    rm -f conftest.o conftest.s\n+  fi\n fi\n-if test x\"$gcc_cv_as_shf_merge\" = xyes; then\n-\tcat >> confdefs.h <<\\EOF\n+\n+echo \"$ac_t\"\"$gcc_cv_as_shf_merge\" 1>&6\n+if test $gcc_cv_as_shf_merge = yes; then\n+  cat >> confdefs.h <<\\EOF\n #define HAVE_GAS_SHF_MERGE 1\n EOF\n \n fi\n-echo \"$ac_t\"\"$gcc_cv_as_shf_merge\" 1>&6\n \n-echo $ac_n \"checking assembler thread-local storage support\"\"... $ac_c\" 1>&6\n-echo \"configure:6409: checking assembler thread-local storage support\" >&5\n-gcc_cv_as_tls=no\n+# Thread-local storage - the check is heavily parametrized.\n conftest_s=\n tls_first_major=\n tls_first_minor=\n@@ -6583,58 +6610,57 @@ foo:\t.long\t25\n \t;;\n esac\n if test -z \"$tls_first_major\"; then\n-  :\n-elif test $in_tree_gas = yes ; then\n-   if test $gcc_cv_gas_major_version -eq $tls_first_major \\\n-&& test $gcc_cv_gas_minor_version -ge $tls_first_minor \\\n-|| test $gcc_cv_gas_major_version -gt $tls_first_major ; then\n-\n-\n-    gcc_cv_as_tls=yes\n-  \n-\n+  : # If we don't have a check, assume no support.\n+else\n+  echo $ac_n \"checking assembler for thread-local storage support\"\"... $ac_c\" 1>&6\n+echo \"configure:6617: checking assembler for thread-local storage support\" >&5\n+if eval \"test \\\"`echo '$''{'gcc_cv_as_tls'+set}'`\\\" = set\"; then\n+  echo $ac_n \"(cached) $ac_c\" 1>&6\n+else\n+  gcc_cv_as_tls=no\n+    if test $in_tree_gas = yes; then\n+    if test $gcc_cv_gas_vers -ge `expr \\( \\( $tls_first_major \\* 1000 \\) + $tls_first_minor \\) \\* 1000 + 0`\n+  then gcc_cv_as_tls=yes\n fi\n-\n-elif test x$gcc_cv_as != x; then\n-  echo \"$conftest_s\" > conftest.s\n-  if $gcc_cv_as $tls_as_opt --fatal-warnings -o conftest.o conftest.s > /dev/null 2>&1\n-  then\n-    gcc_cv_as_tls=yes\n+  elif test x$gcc_cv_as != x; then\n+    echo \"$conftest_s\" > conftest.s\n+    if { ac_try='$gcc_cv_as $tls_as_opt --fatal-warnings -o conftest.o conftest.s >&5'; { (eval echo configure:6628: \\\"$ac_try\\\") 1>&5; (eval $ac_try) 2>&5; }; }\n+    then\n+\tgcc_cv_as_tls=yes\n+    else\n+      echo \"configure: failed program was\" >&5\n+      cat conftest.s >&5\n+    fi\n+    rm -f conftest.o conftest.s\n   fi\n-  rm -f conftest.s conftest.o\n fi\n-if test \"$gcc_cv_as_tls\" = yes; then\n+\n+echo \"$ac_t\"\"$gcc_cv_as_tls\" 1>&6\n+if test $gcc_cv_as_tls = yes; then\n   cat >> confdefs.h <<\\EOF\n #define HAVE_AS_TLS 1\n EOF\n \n fi\n-echo \"$ac_t\"\"$gcc_cv_as_tls\" 1>&6\n+fi\n+\n+# Target-specific assembler checks.\n \n case \"$target\" in\n   # All TARGET_ABI_OSF targets.\n   alpha*-*-osf* | alpha*-*-linux* | alpha*-*-*bsd*)\n-    echo $ac_n \"checking assembler supports explicit relocations\"\"... $ac_c\" 1>&6\n-echo \"configure:6619: checking assembler supports explicit relocations\" >&5\n-if eval \"test \\\"`echo '$''{'gcc_cv_as_explicit_relocs'+set}'`\\\" = set\"; then\n+    echo $ac_n \"checking assembler for explicit relocation support\"\"... $ac_c\" 1>&6\n+echo \"configure:6654: checking assembler for explicit relocation support\" >&5\n+if eval \"test \\\"`echo '$''{'gcc_cv_as_alpha_explicit_relocs'+set}'`\\\" = set\"; then\n   echo $ac_n \"(cached) $ac_c\" 1>&6\n else\n-  \n-\tgcc_cv_as_explicit_relocs=unknown\n-\tif test $in_tree_gas = yes ; then\n-            if test $gcc_cv_gas_major_version -eq 2 \\\n-&& test $gcc_cv_gas_minor_version -ge 12 \\\n-|| test $gcc_cv_gas_major_version -gt 2 ; then\n-\n-\n-\t      gcc_cv_as_explicit_relocs=yes\n-\t   \n-\n+  gcc_cv_as_alpha_explicit_relocs=no\n+    if test $in_tree_gas = yes; then\n+    if test $gcc_cv_gas_vers -ge `expr \\( \\( 2 \\* 1000 \\) + 12 \\) \\* 1000 + 0`\n+  then gcc_cv_as_alpha_explicit_relocs=yes\n fi\n-\n-\telif test x$gcc_cv_as != x; then\n-\t    cat > conftest.s << 'EOF'\n-\t.set nomacro\n+  elif test x$gcc_cv_as != x; then\n+    echo '\t.set nomacro\n \t.text\n \textbl\t$3, $2, $3\t!lituse_bytoff!1\n \tldq\t$2, a($29)\t!literal!1\n@@ -6646,354 +6672,377 @@ fi\n \tlda\t$0, c($29)\t!gprel\n \tldah\t$1, d($29)\t!gprelhigh\n \tlda\t$1, d($1)\t!gprellow\n-\tlda\t$29, 0($29)\t!gpdisp!3\n-EOF\n-\t    if $gcc_cv_as -o conftest.o conftest.s > /dev/null 2>&1; then\n-\t\tgcc_cv_as_explicit_relocs=yes\n-\t    else\n-\t\tgcc_cv_as_explicit_relocs=no\n-\t    fi\n-\t    rm -f conftest.s conftest.o\n-\tfi\n-    \n+\tlda\t$29, 0($29)\t!gpdisp!3' > conftest.s\n+    if { ac_try='$gcc_cv_as  -o conftest.o conftest.s >&5'; { (eval echo configure:6677: \\\"$ac_try\\\") 1>&5; (eval $ac_try) 2>&5; }; }\n+    then\n+\tgcc_cv_as_alpha_explicit_relocs=yes\n+    else\n+      echo \"configure: failed program was\" >&5\n+      cat conftest.s >&5\n+    fi\n+    rm -f conftest.o conftest.s\n+  fi\n fi\n \n-echo \"$ac_t\"\"$gcc_cv_as_explicit_relocs\" 1>&6\n-    if test \"x$gcc_cv_as_explicit_relocs\" = xyes; then\n-\tcat >> confdefs.h <<\\EOF\n+echo \"$ac_t\"\"$gcc_cv_as_alpha_explicit_relocs\" 1>&6\n+if test $gcc_cv_as_alpha_explicit_relocs = yes; then\n+  cat >> confdefs.h <<\\EOF\n #define HAVE_AS_EXPLICIT_RELOCS 1\n EOF\n \n-    fi\n+fi\n     ;;\n+\n   sparc*-*-*)\n-    echo $ac_n \"checking assembler .register pseudo-op support\"\"... $ac_c\" 1>&6\n-echo \"configure:6672: checking assembler .register pseudo-op support\" >&5\n-if eval \"test \\\"`echo '$''{'gcc_cv_as_register_pseudo_op'+set}'`\\\" = set\"; then\n+    echo $ac_n \"checking assembler for .register\"\"... $ac_c\" 1>&6\n+echo \"configure:6699: checking assembler for .register\" >&5\n+if eval \"test \\\"`echo '$''{'gcc_cv_as_sparc_register_op'+set}'`\\\" = set\"; then\n   echo $ac_n \"(cached) $ac_c\" 1>&6\n else\n-  \n-\tgcc_cv_as_register_pseudo_op=unknown\n-\tif test x$gcc_cv_as != x; then\n-\t    # Check if we have .register\n-\t    echo \".register %g2, #scratch\" > conftest.s\n-\t    if $gcc_cv_as -o conftest.o conftest.s > /dev/null 2>&1; then\n-\t\tgcc_cv_as_register_pseudo_op=yes\n-\t    else\n-\t\tgcc_cv_as_register_pseudo_op=no\n-\t    fi\n-\t    rm -f conftest.s conftest.o\n-\tfi\n-    \n+  gcc_cv_as_sparc_register_op=no\n+  if test x$gcc_cv_as != x; then\n+    echo '.register %g2, #scratch' > conftest.s\n+    if { ac_try='$gcc_cv_as  -o conftest.o conftest.s >&5'; { (eval echo configure:6706: \\\"$ac_try\\\") 1>&5; (eval $ac_try) 2>&5; }; }\n+    then\n+\tgcc_cv_as_sparc_register_op=yes\n+    else\n+      echo \"configure: failed program was\" >&5\n+      cat conftest.s >&5\n+    fi\n+    rm -f conftest.o conftest.s\n+  fi\n fi\n \n-echo \"$ac_t\"\"$gcc_cv_as_register_pseudo_op\" 1>&6\n-    if test \"x$gcc_cv_as_register_pseudo_op\" = xyes; then\n-\tcat >> confdefs.h <<\\EOF\n+echo \"$ac_t\"\"$gcc_cv_as_sparc_register_op\" 1>&6\n+if test $gcc_cv_as_sparc_register_op = yes; then\n+  cat >> confdefs.h <<\\EOF\n #define HAVE_AS_REGISTER_PSEUDO_OP 1\n EOF\n \n-    fi\n+fi\n \n-    echo $ac_n \"checking assembler supports -relax\"\"... $ac_c\" 1>&6\n-echo \"configure:6700: checking assembler supports -relax\" >&5\n-if eval \"test \\\"`echo '$''{'gcc_cv_as_relax_opt'+set}'`\\\" = set\"; then\n+    echo $ac_n \"checking assembler for -relax option\"\"... $ac_c\" 1>&6\n+echo \"configure:6726: checking assembler for -relax option\" >&5\n+if eval \"test \\\"`echo '$''{'gcc_cv_as_sparc_relax'+set}'`\\\" = set\"; then\n   echo $ac_n \"(cached) $ac_c\" 1>&6\n else\n-  \n-\tgcc_cv_as_relax_opt=unknown\n-\tif test x$gcc_cv_as != x; then\n-\t    # Check if gas supports -relax\n-\t    echo \".text\" > conftest.s\n-\t    if $gcc_cv_as -relax -o conftest.o conftest.s > /dev/null 2>&1; then\n-\t\tgcc_cv_as_relax_opt=yes\n-\t    else\n-\t\tgcc_cv_as_relax_opt=no\n-\t    fi\n-\t    rm -f conftest.s conftest.o\n-\tfi\n-    \n+  gcc_cv_as_sparc_relax=no\n+  if test x$gcc_cv_as != x; then\n+    echo '.text' > conftest.s\n+    if { ac_try='$gcc_cv_as -relax -o conftest.o conftest.s >&5'; { (eval echo configure:6733: \\\"$ac_try\\\") 1>&5; (eval $ac_try) 2>&5; }; }\n+    then\n+\tgcc_cv_as_sparc_relax=yes\n+    else\n+      echo \"configure: failed program was\" >&5\n+      cat conftest.s >&5\n+    fi\n+    rm -f conftest.o conftest.s\n+  fi\n fi\n \n-echo \"$ac_t\"\"$gcc_cv_as_relax_opt\" 1>&6\n-    if test \"x$gcc_cv_as_relax_opt\" = xyes; then\n-\tcat >> confdefs.h <<\\EOF\n+echo \"$ac_t\"\"$gcc_cv_as_sparc_relax\" 1>&6\n+if test $gcc_cv_as_sparc_relax = yes; then\n+  cat >> confdefs.h <<\\EOF\n #define HAVE_AS_RELAX_OPTION 1\n EOF\n \n-    fi\n+fi\n \n-    echo $ac_n \"checking assembler and linker support unaligned pc related relocs\"\"... $ac_c\" 1>&6\n-echo \"configure:6728: checking assembler and linker support unaligned pc related relocs\" >&5\n+    echo $ac_n \"checking assembler for unaligned pcrel relocs\"\"... $ac_c\" 1>&6\n+echo \"configure:6753: checking assembler for unaligned pcrel relocs\" >&5\n if eval \"test \\\"`echo '$''{'gcc_cv_as_sparc_ua_pcrel'+set}'`\\\" = set\"; then\n   echo $ac_n \"(cached) $ac_c\" 1>&6\n else\n-  \n-\tgcc_cv_as_sparc_ua_pcrel=unknown\n-\tif test x$gcc_cv_as != x -a x$gcc_cv_ld != x; then\n-\t    gcc_cv_as_sparc_ua_pcrel=no\n-\t    echo \".text; foo: nop; .data; .align 4; .byte 0; .uaword %r_disp32(foo)\" > conftest.s\n-\t    if $gcc_cv_as -K PIC -o conftest.o conftest.s > /dev/null 2>&1 \\\n-\t       && $gcc_cv_ld -o conftest conftest.o -G > /dev/null 2>&1; then\n-\t\tgcc_cv_as_sparc_ua_pcrel=yes\n-\t    fi\n-\t    rm -f conftest.s conftest.o conftest\n-\tfi\n-    \n+  gcc_cv_as_sparc_ua_pcrel=no\n+  if test x$gcc_cv_as != x; then\n+    echo '.text\n+foo:\n+\tnop\n+.data\n+.align 4\n+.byte 0\n+.uaword %r_disp32(foo)' > conftest.s\n+    if { ac_try='$gcc_cv_as -K PIC -o conftest.o conftest.s >&5'; { (eval echo configure:6766: \\\"$ac_try\\\") 1>&5; (eval $ac_try) 2>&5; }; }\n+    then\n+\tif test x$gcc_cv_ld != x \\\n+       && $gcc_cv_ld -o conftest conftest.o -G > /dev/null 2>&1; then\n+\t gcc_cv_as_sparc_ua_pcrel=yes\n+       fi\n+       rm -f conftest\n+    else\n+      echo \"configure: failed program was\" >&5\n+      cat conftest.s >&5\n+    fi\n+    rm -f conftest.o conftest.s\n+  fi\n fi\n \n echo \"$ac_t\"\"$gcc_cv_as_sparc_ua_pcrel\" 1>&6\n-    if test \"x$gcc_cv_as_sparc_ua_pcrel\" = xyes; then\n-\tcat >> confdefs.h <<\\EOF\n+if test $gcc_cv_as_sparc_ua_pcrel = yes; then\n+  cat >> confdefs.h <<\\EOF\n #define HAVE_AS_SPARC_UA_PCREL 1\n EOF\n \n-    fi\n \n-    echo $ac_n \"checking assembler and linker support unaligned pc related relocs against hidden symbols\"\"... $ac_c\" 1>&6\n-echo \"configure:6755: checking assembler and linker support unaligned pc related relocs against hidden symbols\" >&5\n+      echo $ac_n \"checking assembler for unaligned pcrel relocs against hidden symbols\"\"... $ac_c\" 1>&6\n+echo \"configure:6789: checking assembler for unaligned pcrel relocs against hidden symbols\" >&5\n if eval \"test \\\"`echo '$''{'gcc_cv_as_sparc_ua_pcrel_hidden'+set}'`\\\" = set\"; then\n   echo $ac_n \"(cached) $ac_c\" 1>&6\n else\n-  \n-\tif test \"x$gcc_cv_as_sparc_ua_pcrel\" = xyes; then\n-\t    gcc_cv_as_sparc_ua_pcrel_hidden=unknown\n-\t    if test x$gcc_cv_objdump != x; then\n-\t        gcc_cv_as_sparc_ua_pcrel_hidden=no\n-\t\techo \".data; .align 4; .byte 0x31; .uaword %r_disp32(foo)\" > conftest.s\n-\t\techo \".byte 0x32, 0x33, 0x34; .global foo; .hidden foo\" >> conftest.s\n-\t\techo \"foo: .skip 4\" >> conftest.s\n-\t\tif $gcc_cv_as -K PIC -o conftest.o conftest.s > /dev/null 2>&1 \\\n-\t\t   && $gcc_cv_ld -o conftest conftest.o -G > /dev/null 2>&1 \\\n-\t\t   && $gcc_cv_objdump -s -j .data conftest 2> /dev/null \\\n-\t\t      | grep ' 31000000 07323334' > /dev/null 2>&1; then\n-\t\t    if $gcc_cv_objdump -R conftest 2> /dev/null \\\n-\t\t       | grep 'DISP32' > /dev/null 2>&1; then\n-\t\t\t:\n-\t\t    else\n-\t\t\tgcc_cv_as_sparc_ua_pcrel_hidden=yes\n-\t\t    fi\n-\t\tfi\n+  gcc_cv_as_sparc_ua_pcrel_hidden=no\n+  if test x$gcc_cv_as != x; then\n+    echo '.data\n+.align 4\n+.byte 0x31\n+.uaword %r_disp32(foo)\n+.byte 0x32, 0x33, 0x34\n+.global foo\n+.hidden foo\n+foo:\n+.skip 4' > conftest.s\n+    if { ac_try='$gcc_cv_as -K PIC -o conftest.o conftest.s >&5'; { (eval echo configure:6804: \\\"$ac_try\\\") 1>&5; (eval $ac_try) 2>&5; }; }\n+    then\n+\tif test x$gcc_cv_ld != x && test x$gcc_cv_objdump != x \\\n+\t && $gcc_cv_ld -o conftest conftest.o -G > /dev/null 2>&1 \\\n+\t && $gcc_cv_objdump -s -j .data conftest 2> /dev/null \\\n+\t    | grep ' 31000000 07323334' > /dev/null 2>&1; then\n+\t    if $gcc_cv_objdump -R conftest 2> /dev/null \\\n+\t       | grep 'DISP32' > /dev/null 2>&1; then\n+\t\t:\n+\t    else\n+\t\tgcc_cv_as_sparc_ua_pcrel_hidden=yes\n \t    fi\n-\t    rm -f conftest.s conftest.o conftest\n-\telse\n-\t    gcc_cv_as_sparc_ua_pcrel_hidden=\"$gcc_cv_as_sparc_ua_pcrel\"\n-\tfi\n-    \n+\t fi\n+\t rm -f conftest\n+    else\n+      echo \"configure: failed program was\" >&5\n+      cat conftest.s >&5\n+    fi\n+    rm -f conftest.o conftest.s\n+  fi\n fi\n \n echo \"$ac_t\"\"$gcc_cv_as_sparc_ua_pcrel_hidden\" 1>&6\n-    if test \"x$gcc_cv_as_sparc_ua_pcrel_hidden\" = xyes; then\n-\tcat >> confdefs.h <<\\EOF\n+if test $gcc_cv_as_sparc_ua_pcrel_hidden = yes; then\n+  cat >> confdefs.h <<\\EOF\n #define HAVE_AS_SPARC_UA_PCREL_HIDDEN 1\n EOF\n \n-    fi\n+fi\n+    \n+fi # unaligned pcrel relocs\n \n-    echo $ac_n \"checking for assembler offsetable %lo() support\"\"... $ac_c\" 1>&6\n-echo \"configure:6795: checking for assembler offsetable %lo() support\" >&5\n-if eval \"test \\\"`echo '$''{'gcc_cv_as_offsetable_lo10'+set}'`\\\" = set\"; then\n+    echo $ac_n \"checking assembler for offsetable %lo()\"\"... $ac_c\" 1>&6\n+echo \"configure:6837: checking assembler for offsetable %lo()\" >&5\n+if eval \"test \\\"`echo '$''{'gcc_cv_as_sparc_offsetable_lo10'+set}'`\\\" = set\"; then\n   echo $ac_n \"(cached) $ac_c\" 1>&6\n else\n-  \n-\tgcc_cv_as_offsetable_lo10=unknown\n-\tif test \"x$gcc_cv_as\" != x; then\n-\t    # Check if assembler has offsetable %lo()\n-\t    echo \"or %g1, %lo(ab) + 12, %g1\" > conftest.s\n-\t    echo \"or %g1, %lo(ab + 12), %g1\" > conftest1.s\n-\t    if $gcc_cv_as -xarch=v9 -o conftest.o conftest.s \\\n-\t\t    > /dev/null 2>&1 &&\n-\t       $gcc_cv_as -xarch=v9 -o conftest1.o conftest1.s \\\n-\t\t    > /dev/null 2>&1; then\n-\t\tif cmp conftest.o conftest1.o > /dev/null 2>&1; then\n-\t\t    gcc_cv_as_offsetable_lo10=no\n-\t\telse\n-\t\t    gcc_cv_as_offsetable_lo10=yes\n-\t\tfi\n-\t    else\n-\t\tgcc_cv_as_offsetable_lo10=no\n-\t    fi\n-\t    rm -f conftest.s conftest.o conftest1.s conftest1.o\n-\tfi\n-    \n+  gcc_cv_as_sparc_offsetable_lo10=no\n+  if test x$gcc_cv_as != x; then\n+    echo '.text\n+\tor %g1, %lo(ab) + 12, %g1\n+\tor %g1, %lo(ab + 12), %g1' > conftest.s\n+    if { ac_try='$gcc_cv_as -xarch=v9 -o conftest.o conftest.s >&5'; { (eval echo configure:6846: \\\"$ac_try\\\") 1>&5; (eval $ac_try) 2>&5; }; }\n+    then\n+\tif test x$gcc_cv_objdump != x \\\n+       && %gcc_cv_objdump -s -j .text conftest.o 2> /dev/null \\\n+          | grep ' 82106000 82106000' > /dev/null 2>&1; then\n+\t gcc_cv_as_offsetable_lo10=yes\n+       fi\n+    else\n+      echo \"configure: failed program was\" >&5\n+      cat conftest.s >&5\n+    fi\n+    rm -f conftest.o conftest.s\n+  fi\n fi\n \n-echo \"$ac_t\"\"$gcc_cv_as_offsetable_lo10\" 1>&6\n-    if test \"x$gcc_cv_as_offsetable_lo10\" = xyes; then\n-\tcat >> confdefs.h <<\\EOF\n+echo \"$ac_t\"\"$gcc_cv_as_sparc_offsetable_lo10\" 1>&6\n+if test $gcc_cv_as_sparc_offsetable_lo10 = yes; then\n+  cat >> confdefs.h <<\\EOF\n #define HAVE_AS_OFFSETABLE_LO10 1\n EOF\n \n-    fi\n-\n+fi\n     ;;\n \n   i[34567]86-*-* | x86_64-*-*)\n-    echo $ac_n \"checking assembler instructions\"\"... $ac_c\" 1>&6\n-echo \"configure:6834: checking assembler instructions\" >&5\n-    gcc_cv_as_instructions=\n-    if test $in_tree_gas = yes ; then \n-       if test $gcc_cv_gas_major_version -eq 2 \\\n-&& test $gcc_cv_gas_minor_version -ge 9 \\\n-|| test $gcc_cv_gas_major_version -gt 2 ; then\n-\n-\n-\tgcc_cv_as_instructions=\"filds fists\"\n-      \n-\n+    echo $ac_n \"checking assembler for filds and fists mnemonics\"\"... $ac_c\" 1>&6\n+echo \"configure:6872: checking assembler for filds and fists mnemonics\" >&5\n+if eval \"test \\\"`echo '$''{'gcc_cv_as_ix86_filds_fists'+set}'`\\\" = set\"; then\n+  echo $ac_n \"(cached) $ac_c\" 1>&6\n+else\n+  gcc_cv_as_ix86_filds_fists=no\n+    if test $in_tree_gas = yes; then\n+    if test $gcc_cv_gas_vers -ge `expr \\( \\( 2 \\* 1000 \\) + 9 \\) \\* 1000 + 0`\n+  then gcc_cv_as_ix86_filds_fists=yes\n fi\n-\n-    elif test x$gcc_cv_as != x; then\n-\tset \"filds fists\" \"filds mem; fists mem\"\n-\twhile test $# -gt 0\n-  \tdo\n-\t\techo \"$2\" > conftest.s\n-\t\tif $gcc_cv_as -o conftest.o conftest.s > /dev/null 2>&1; then\n-\t\t\tgcc_cv_as_instructions=${gcc_cv_as_instructions}$1\" \"\n-\t\tfi\n-\t\tshift 2\n-\tdone\n-\trm -f conftest.s conftest.o\n-    fi\n-    if test x\"$gcc_cv_as_instructions\" != x; then\n-\tcat >> confdefs.h <<EOF\n-#define HAVE_GAS_`echo \"$gcc_cv_as_instructions\" | sed -e 's/ $//' | tr 'a-z ' 'A-Z_'` 1\n-EOF\n-\n+  elif test x$gcc_cv_as != x; then\n+    echo 'filds mem; fists mem' > conftest.s\n+    if { ac_try='$gcc_cv_as  -o conftest.o conftest.s >&5'; { (eval echo configure:6883: \\\"$ac_try\\\") 1>&5; (eval $ac_try) 2>&5; }; }\n+    then\n+\tgcc_cv_as_ix86_filds_fists=yes\n+    else\n+      echo \"configure: failed program was\" >&5\n+      cat conftest.s >&5\n     fi\n-    echo \"$ac_t\"\"$gcc_cv_as_instructions\" 1>&6\n-\n-    echo $ac_n \"checking assembler GOTOFF in data directives\"\"... $ac_c\" 1>&6\n-echo \"configure:6868: checking assembler GOTOFF in data directives\" >&5\n-    gcc_cv_as_gotoff_in_data=no\n-    if test $in_tree_gas = yes ; then\n-       if test $gcc_cv_gas_major_version -eq 2 \\\n-&& test $gcc_cv_gas_minor_version -ge 11 \\\n-|| test $gcc_cv_gas_major_version -gt 2 ; then\n-\n+    rm -f conftest.o conftest.s\n+  fi\n+fi\n \n-\tgcc_cv_as_gotoff_in_data=yes\n-      \n+echo \"$ac_t\"\"$gcc_cv_as_ix86_filds_fists\" 1>&6\n+if test $gcc_cv_as_ix86_filds_fists = yes; then\n+  cat >> confdefs.h <<\\EOF\n+#define HAVE_GAS_FILDS_FISTS 1\n+EOF\n \n fi\n \n-    elif test x$gcc_cv_as != x; then\n-\tcat > conftest.s <<EOF\n-\t.text\n+    echo $ac_n \"checking assembler for GOTOFF in data\"\"... $ac_c\" 1>&6\n+echo \"configure:6903: checking assembler for GOTOFF in data\" >&5\n+if eval \"test \\\"`echo '$''{'gcc_cv_as_ix86_gotoff_in_data'+set}'`\\\" = set\"; then\n+  echo $ac_n \"(cached) $ac_c\" 1>&6\n+else\n+  gcc_cv_as_ix86_gotoff_in_data=no\n+    if test $in_tree_gas = yes; then\n+    if test $gcc_cv_gas_vers -ge `expr \\( \\( 2 \\* 1000 \\) + 11 \\) \\* 1000 + 0`\n+  then gcc_cv_as_ix86_gotoff_in_data=yes\n+fi\n+  elif test x$gcc_cv_as != x; then\n+    echo '\t.text\n .L0:\n \tnop\n \t.data\n-\t.long .L0@GOTOFF\n-EOF\n-\tif $gcc_cv_as -o conftest.o conftest.s > /dev/null 2>&1; then\n-\t  gcc_cv_as_gotoff_in_data=yes\n-\tfi\n+\t.long .L0@GOTOFF' > conftest.s\n+    if { ac_try='$gcc_cv_as  -o conftest.o conftest.s >&5'; { (eval echo configure:6918: \\\"$ac_try\\\") 1>&5; (eval $ac_try) 2>&5; }; }\n+    then\n+\tgcc_cv_as_ix86_gotoff_in_data=yes\n+    else\n+      echo \"configure: failed program was\" >&5\n+      cat conftest.s >&5\n     fi\n-    cat >> confdefs.h <<EOF\n+    rm -f conftest.o conftest.s\n+  fi\n+fi\n+\n+echo \"$ac_t\"\"$gcc_cv_as_ix86_gotoff_in_data\" 1>&6\n+if test $gcc_cv_as_ix86_gotoff_in_data = yes; then\n+  cat >> confdefs.h <<EOF\n #define HAVE_AS_GOTOFF_IN_DATA `if test $gcc_cv_as_gotoff_in_data = yes; then echo 1; else echo 0; fi`\n EOF\n \n-    echo \"$ac_t\"\"$gcc_cv_as_gotoff_in_data\" 1>&6\n+fi\n     ;;\n \n   ia64*-*-*)\n-    echo $ac_n \"checking assembler supports ltoffx and ldxmov\"\"... $ac_c\" 1>&6\n-echo \"configure:6902: checking assembler supports ltoffx and ldxmov\" >&5\n-if eval \"test \\\"`echo '$''{'gcc_cv_as_ltoffx_ldxmov_relocs'+set}'`\\\" = set\"; then\n+    echo $ac_n \"checking assembler for ltoffx and ldxmov relocs\"\"... $ac_c\" 1>&6\n+echo \"configure:6940: checking assembler for ltoffx and ldxmov relocs\" >&5\n+if eval \"test \\\"`echo '$''{'gcc_cv_as_ia64_ltoffx_ldxmov_relocs'+set}'`\\\" = set\"; then\n   echo $ac_n \"(cached) $ac_c\" 1>&6\n else\n-  \n-\tgcc_cv_as_ltoffx_ldxmov_relocs=unknown\n-\tif test $in_tree_gas = yes ; then\n-           if test $gcc_cv_gas_major_version -eq 2 \\\n-&& test $gcc_cv_gas_minor_version -ge 14 \\\n-|| test $gcc_cv_gas_major_version -gt 2 ; then\n-\n-\n-\t    gcc_cv_as_ltoffx_ldxmov_relocs=yes\n-          \n-\n+  gcc_cv_as_ia64_ltoffx_ldxmov_relocs=no\n+    if test $in_tree_gas = yes; then\n+    if test $gcc_cv_gas_vers -ge `expr \\( \\( 2 \\* 1000 \\) + 14 \\) \\* 1000 + 0`\n+  then gcc_cv_as_ia64_ltoffx_ldxmov_relocs=yes\n fi\n-\n-\telif test x$gcc_cv_as != x; then\n-\t    cat > conftest.s << 'EOF'\n-\t.text\n+  elif test x$gcc_cv_as != x; then\n+    echo '\t.text\n \taddl r15 = @ltoffx(x#), gp\n \t;;\n-\tld8.mov r16 = [r15], x#\n-EOF\n-\t    if $gcc_cv_as -o conftest.o conftest.s > /dev/null 2>&1; then\n-\t\tgcc_cv_as_ltoffx_ldxmov_relocs=yes\n-\t    else\n-\t\tgcc_cv_as_ltoffx_ldxmov_relocs=no\n-\t    fi\n-\t    rm -f conftest.s conftest.o\n-\tfi\n-    \n-fi\n-\n-echo \"$ac_t\"\"$gcc_cv_as_ltoffx_ldxmov_relocs\" 1>&6\n-    if test \"x$gcc_cv_as_ltoffx_ldxmov_relocs\" = xyes; then\n-\tcat >> confdefs.h <<\\EOF\n+\tld8.mov r16 = r15, x#' > conftest.s\n+    if { ac_try='$gcc_cv_as  -o conftest.o conftest.s >&5'; { (eval echo configure:6954: \\\"$ac_try\\\") 1>&5; (eval $ac_try) 2>&5; }; }\n+    then\n+\t    cat >> confdefs.h <<\\EOF\n #define HAVE_AS_LTOFFX_LDXMOV_RELOCS 1\n EOF\n \n+    else\n+      echo \"configure: failed program was\" >&5\n+      cat conftest.s >&5\n     fi\n+    rm -f conftest.o conftest.s\n+  fi\n+fi\n+\n+echo \"$ac_t\"\"$gcc_cv_as_ia64_ltoffx_ldxmov_relocs\" 1>&6\n+\n+\n     ;;\n+\n   powerpc*-*-*)\n-    echo $ac_n \"checking assembler supports mfcr field\"\"... $ac_c\" 1>&6\n-echo \"configure:6946: checking assembler supports mfcr field\" >&5\n-if eval \"test \\\"`echo '$''{'gcc_cv_as_mfcrf'+set}'`\\\" = set\"; then\n+    case $target in\n+      *-*-aix) conftest_s='\t.csect .textPR';;\n+      *)       conftest_s='\t.text';;\n+    esac\n+    conftest_s=\"$conftest_s\n+\tmfcr 3,128\"\n+\n+    echo $ac_n \"checking assembler for mfcr field support\"\"... $ac_c\" 1>&6\n+echo \"configure:6982: checking assembler for mfcr field support\" >&5\n+if eval \"test \\\"`echo '$''{'gcc_cv_as_powerpc_mfcrf'+set}'`\\\" = set\"; then\n   echo $ac_n \"(cached) $ac_c\" 1>&6\n else\n-  \n-\tgcc_cv_as_mfcrf=unknown\n-\tif test $in_tree_gas = yes ; then\n-           if test $gcc_cv_gas_major_version -eq 2 \\\n-&& test $gcc_cv_gas_minor_version -ge 14 \\\n-|| test $gcc_cv_gas_major_version -gt 2 ; then\n-\n-\n-\t    gcc_cv_as_mfcrf=yes\n-          \n-\n+  gcc_cv_as_powerpc_mfcrf=no\n+    if test $in_tree_gas = yes; then\n+    if test $gcc_cv_gas_vers -ge `expr \\( \\( 2 \\* 1000 \\) + 14 \\) \\* 1000 + 0`\n+  then gcc_cv_as_powerpc_mfcrf=yes\n fi\n-\n-\telif test x$gcc_cv_as != x; then\n-\t    cat > conftest.s << 'EOF'\n-\t      case \"$target\" in\n-\t\t*-*-aix*)\n-\t.csect .text[PR]\n-\t\t;;\n-\t\t*)\n-\t.text\n-\t\t;;\n-\t      esac\n-\tmfcr 3,128\n-EOF\n-\t    if $gcc_cv_as -o conftest.o conftest.s > /dev/null 2>&1; then\n-\t\tgcc_cv_as_mfcrf=yes\n-\t    else\n-\t\tgcc_cv_as_mfcrf=no\n-\t    fi\n-\t    rm -f conftest.s conftest.o\n-\tfi\n-    \n+  elif test x$gcc_cv_as != x; then\n+    echo \"$conftest_s\" > conftest.s\n+    if { ac_try='$gcc_cv_as  -o conftest.o conftest.s >&5'; { (eval echo configure:6993: \\\"$ac_try\\\") 1>&5; (eval $ac_try) 2>&5; }; }\n+    then\n+\tgcc_cv_as_powerpc_mfcrf=yes\n+    else\n+      echo \"configure: failed program was\" >&5\n+      cat conftest.s >&5\n+    fi\n+    rm -f conftest.o conftest.s\n+  fi\n fi\n \n-echo \"$ac_t\"\"$gcc_cv_as_mfcrf\" 1>&6\n-    if test \"x$gcc_cv_as_mfcrf\" = xyes; then\n-\tcat >> confdefs.h <<\\EOF\n+echo \"$ac_t\"\"$gcc_cv_as_powerpc_mfcrf\" 1>&6\n+if test $gcc_cv_as_powerpc_mfcrf = yes; then\n+  cat >> confdefs.h <<\\EOF\n #define HAVE_AS_MFCRF 1\n EOF\n \n+fi\n+    ;;\n+\n+  mips*-*-*)\n+    echo $ac_n \"checking assembler for explicit relocation support\"\"... $ac_c\" 1>&6\n+echo \"configure:7015: checking assembler for explicit relocation support\" >&5\n+if eval \"test \\\"`echo '$''{'gcc_cv_as_mips_explicit_relocs'+set}'`\\\" = set\"; then\n+  echo $ac_n \"(cached) $ac_c\" 1>&6\n+else\n+  gcc_cv_as_mips_explicit_relocs=no\n+    if test $in_tree_gas = yes; then\n+    if test $gcc_cv_gas_vers -ge `expr \\( \\( 2 \\* 1000 \\) + 14 \\) \\* 1000 + 0`\n+  then gcc_cv_as_mips_explicit_relocs=yes\n+fi\n+  elif test x$gcc_cv_as != x; then\n+    echo '\tlw $4,%gp_rel(foo)($4)' > conftest.s\n+    if { ac_try='$gcc_cv_as  -o conftest.o conftest.s >&5'; { (eval echo configure:7026: \\\"$ac_try\\\") 1>&5; (eval $ac_try) 2>&5; }; }\n+    then\n+\tgcc_cv_as_mips_explicit_relocs=yes\n+    else\n+      echo \"configure: failed program was\" >&5\n+      cat conftest.s >&5\n     fi\n+    rm -f conftest.o conftest.s\n+  fi\n+fi\n+\n+echo \"$ac_t\"\"$gcc_cv_as_mips_explicit_relocs\" 1>&6\n+if test $gcc_cv_as_mips_explicit_relocs = yes; then\n+  if test x$target_cpu_default = x\n+       then target_cpu_default=MASK_EXPLICIT_RELOCS\n+       else target_cpu_default=\"($target_cpu_default)|MASK_EXPLICIT_RELOCS\"\n+       fi\n+fi\n+\n     ;;\n esac\n-\n-echo $ac_n \"checking assembler dwarf2 debug_line support\"\"... $ac_c\" 1>&6\n-echo \"configure:6996: checking assembler dwarf2 debug_line support\" >&5\n-gcc_cv_as_dwarf2_debug_line=no\n # ??? Not all targets support dwarf2 debug_line, even within a version\n # of gas.  Moreover, we need to emit a valid instruction to trigger any\n # info to the output file.  So, as supported targets are added to gas 2.11,\n@@ -7012,121 +7061,150 @@ case \"$target\" in\n   mmix-*-*)\n     insn=\"swym 0\"\n     ;;\n-  esac\n-if test $in_tree_gas = yes ; then\n-   if test $gcc_cv_gas_major_version -eq 2 \\\n-&& test $gcc_cv_gas_minor_version -ge 11 \\\n-|| test $gcc_cv_gas_major_version -gt 2 ; then\n+esac\n+if test x\"$insn\" != x; then\n+ conftest_s=\"\\\n+\t.file 1 \\\"conftest.s\\\"\n+\t.loc 1 3 0\n+\t$insn\"\n+ echo $ac_n \"checking assembler for dwarf2 debug_line support\"\"... $ac_c\" 1>&6\n+echo \"configure:7072: checking assembler for dwarf2 debug_line support\" >&5\n+if eval \"test \\\"`echo '$''{'gcc_cv_as_dwarf2_debug_line'+set}'`\\\" = set\"; then\n+  echo $ac_n \"(cached) $ac_c\" 1>&6\n+else\n+  gcc_cv_as_dwarf2_debug_line=no\n+    if test $in_tree_gas = yes; then\n+    if test $in_tree_gas_is_elf = yes \\\n+  && test $gcc_cv_gas_vers -ge `expr \\( \\( 2 \\* 1000 \\) + 11 \\) \\* 1000 + 0`\n+  then gcc_cv_as_dwarf2_debug_line=yes\n+fi\n+  elif test x$gcc_cv_as != x; then\n+    echo \"$conftest_s\" > conftest.s\n+    if { ac_try='$gcc_cv_as  -o conftest.o conftest.s >&5'; { (eval echo configure:7084: \\\"$ac_try\\\") 1>&5; (eval $ac_try) 2>&5; }; }\n+    then\n+\t# ??? This fails with non-gnu grep.  Maybe use objdump?\n+   if grep debug_line conftest.o > /dev/null 2>&1; then\n+     gcc_cv_as_dwarf2_debug_line=yes\n+   fi\n+    else\n+      echo \"configure: failed program was\" >&5\n+      cat conftest.s >&5\n+    fi\n+    rm -f conftest.o conftest.s\n+  fi\n+fi\n \n+echo \"$ac_t\"\"$gcc_cv_as_dwarf2_debug_line\" 1>&6\n \n-    test $in_tree_gas_is_elf = yes && test x\"$insn\" != x \\\n-\t&& gcc_cv_as_dwarf2_debug_line=\"yes\"\n-  \n \n+# The .debug_line file table must be in the exact order that\n+# we specified the files, since these indices are also used\n+# by DW_AT_decl_file.  Approximate this test by testing if\n+# the assembler bitches if the same index is assigned twice.\n+ echo $ac_n \"checking assembler for buggy dwarf2 .file directive\"\"... $ac_c\" 1>&6\n+echo \"configure:7106: checking assembler for buggy dwarf2 .file directive\" >&5\n+if eval \"test \\\"`echo '$''{'gcc_cv_as_dwarf2_file_buggy'+set}'`\\\" = set\"; then\n+  echo $ac_n \"(cached) $ac_c\" 1>&6\n+else\n+  gcc_cv_as_dwarf2_file_buggy=no\n+  if test x$gcc_cv_as != x; then\n+    echo '\t.file 1 \"foo.s\"\n+\t.file 1 \"bar.s\"' > conftest.s\n+    if { ac_try='$gcc_cv_as  -o conftest.o conftest.s >&5'; { (eval echo configure:7114: \\\"$ac_try\\\") 1>&5; (eval $ac_try) 2>&5; }; }\n+    then\n+\tgcc_cv_as_dwarf2_file_buggy=yes\n+    else\n+      echo \"configure: failed program was\" >&5\n+      cat conftest.s >&5\n+    fi\n+    rm -f conftest.o conftest.s\n+  fi\n fi\n \n-elif test x$gcc_cv_as != x -a x\"$insn\" != x ; then\n-\techo '\t.file 1 \"conftest.s\"' > conftest.s\n-\techo '\t.loc 1 3 0' >> conftest.s\n-\techo \"\t$insn\" >> conftest.s\n-\t# ??? This fails with non-gnu grep.\n-\tif $gcc_cv_as -o conftest.o conftest.s > /dev/null 2>&1 \\\n-\t   && grep debug_line conftest.o > /dev/null 2>&1 ; then\n-\t\t# The .debug_line file table must be in the exact order that\n-\t\t# we specified the files, since these indices are also used\n-\t\t# by DW_AT_decl_file.  Approximate this test by testing if\n-\t\t# the assembler bitches if the same index is assigned twice.\n-\t\techo '\t.file 1 \"foo.s\"' > conftest.s\n-\t\techo '\t.file 1 \"bar.s\"' >> conftest.s\n-\t\tif $gcc_cv_as -o conftest.o conftest.s > /dev/null 2>&1\n-\t\tthen\n-\t\t  gcc_cv_as_dwarf2_debug_line=\"no\"\n-\t\telse\n-\t\t  gcc_cv_as_dwarf2_debug_line=\"yes\"\n-\t\tfi\n-\tfi\n-\trm -f conftest.s conftest.o conftest.nm1 conftest.nm2\n-fi\n-if test x\"$gcc_cv_as_dwarf2_debug_line\" = xyes; then\n+echo \"$ac_t\"\"$gcc_cv_as_dwarf2_file_buggy\" 1>&6\n+\n+\n+ if test $gcc_cv_as_dwarf2_debug_line = yes \\\n+ && test $gcc_cv_as_dwarf2_file_buggy = no; then\n \tcat >> confdefs.h <<\\EOF\n #define HAVE_AS_DWARF2_DEBUG_LINE 1\n EOF\n \n-fi\n-echo \"$ac_t\"\"$gcc_cv_as_dwarf2_debug_line\" 1>&6\n-\n-echo $ac_n \"checking assembler --gdwarf2 support\"\"... $ac_c\" 1>&6\n-echo \"configure:7060: checking assembler --gdwarf2 support\" >&5\n-gcc_cv_as_gdwarf2_flag=no\n-if test $in_tree_gas = yes ; then\n-   if test $gcc_cv_gas_major_version -eq 2 \\\n-&& test $gcc_cv_gas_minor_version -ge 11 \\\n-|| test $gcc_cv_gas_major_version -gt 2 ; then\n-\n-\n-    test $in_tree_gas_is_elf = yes && test x\"$insn\" != x \\\n-\t&& gcc_cv_as_gdwarf2_flag=\"yes\"\n-  \n+ fi\n \n+ echo $ac_n \"checking assembler for --gdwarf2 option\"\"... $ac_c\" 1>&6\n+echo \"configure:7137: checking assembler for --gdwarf2 option\" >&5\n+if eval \"test \\\"`echo '$''{'gcc_cv_as_gdwarf2_flag'+set}'`\\\" = set\"; then\n+  echo $ac_n \"(cached) $ac_c\" 1>&6\n+else\n+  gcc_cv_as_gdwarf2_flag=no\n+    if test $in_tree_gas = yes; then\n+    if test $in_tree_gas_is_elf = yes \\\n+  && test $gcc_cv_gas_vers -ge `expr \\( \\( 2 \\* 1000 \\) + 11 \\) \\* 1000 + 0`\n+  then gcc_cv_as_gdwarf2_flag=yes\n+fi\n+  elif test x$gcc_cv_as != x; then\n+    echo \"$insn\" > conftest.s\n+    if { ac_try='$gcc_cv_as --gdwarf2 -o conftest.o conftest.s >&5'; { (eval echo configure:7149: \\\"$ac_try\\\") 1>&5; (eval $ac_try) 2>&5; }; }\n+    then\n+\tgcc_cv_as_gdwarf2_flag=yes\n+    else\n+      echo \"configure: failed program was\" >&5\n+      cat conftest.s >&5\n+    fi\n+    rm -f conftest.o conftest.s\n+  fi\n fi\n \n-elif test x$gcc_cv_as != x -a x\"$insn\" != x ; then\n-\techo '' > conftest.s\n-\t# ??? This fails with non-gnu grep.\n-\tif $gcc_cv_as --gdwarf2 -o conftest.o conftest.s > /dev/null 2>&1\n-\t  then\n-\t  gcc_cv_as_gdwarf2_flag=\"yes\"\n-\tfi\n-\trm -f conftest.s conftest.o\n-fi\n-if test x\"$gcc_cv_as_gdwarf2_flag\" = xyes; then\n-\tcat >> confdefs.h <<\\EOF\n+echo \"$ac_t\"\"$gcc_cv_as_gdwarf2_flag\" 1>&6\n+if test $gcc_cv_as_gdwarf2_flag = yes; then\n+  cat >> confdefs.h <<\\EOF\n #define HAVE_AS_GDWARF2_DEBUG_FLAG 1\n EOF\n \n fi\n-echo \"$ac_t\"\"$gcc_cv_as_gdwarf2_flag\" 1>&6\n-\n-echo $ac_n \"checking assembler --gstabs support\"\"... $ac_c\" 1>&6\n-echo \"configure:7092: checking assembler --gstabs support\" >&5\n-gcc_cv_as_gstabs_flag=no\n-if test $in_tree_gas = yes ; then\n-   if test $gcc_cv_gas_major_version -eq 2 \\\n-&& test $gcc_cv_gas_minor_version -ge 11 \\\n-|| test $gcc_cv_gas_major_version -gt 2 ; then\n-\n-\n-    test $in_tree_gas_is_elf = yes && test x\"$insn\" != x \\\n-\t&& gcc_cv_as_gstabs_flag=\"yes\"\n-  \n \n+ echo $ac_n \"checking assembler for --gstabs option\"\"... $ac_c\" 1>&6\n+echo \"configure:7169: checking assembler for --gstabs option\" >&5\n+if eval \"test \\\"`echo '$''{'gcc_cv_as_gstabs_flag'+set}'`\\\" = set\"; then\n+  echo $ac_n \"(cached) $ac_c\" 1>&6\n+else\n+  gcc_cv_as_gstabs_flag=no\n+    if test $in_tree_gas = yes; then\n+    if test $in_tree_gas_is_elf = yes \\\n+  && test $gcc_cv_gas_vers -ge `expr \\( \\( 2 \\* 1000 \\) + 11 \\) \\* 1000 + 0`\n+  then gcc_cv_as_gstabs_flag=yes\n+fi\n+  elif test x$gcc_cv_as != x; then\n+    echo \"$insn\" > conftest.s\n+    if { ac_try='$gcc_cv_as --gstabs -o conftest.o conftest.s >&5'; { (eval echo configure:7181: \\\"$ac_try\\\") 1>&5; (eval $ac_try) 2>&5; }; }\n+    then\n+\t# The native Solaris 9/Intel assembler doesn't understand --gstabs\n+   # and warns about it, but still exits successfully.  So check for\n+   # this.\n+   if { ac_try='$gcc_cv_as --gstabs -o conftest.o conftest.s 2>&1 | grep -i warning > /dev/null'; { (eval echo configure:7186: \\\"$ac_try\\\") 1>&5; (eval $ac_try) 2>&5; }; }\n+   then :\n+   else gcc_cv_as_gstabs_flag=yes\n+   fi\n+    else\n+      echo \"configure: failed program was\" >&5\n+      cat conftest.s >&5\n+    fi\n+    rm -f conftest.o conftest.s\n+  fi\n fi\n \n-elif test x$gcc_cv_as != x -a x\"$insn\" != x ; then\n-\techo '' > conftest.s\n-\t# ??? This fails with non-gnu grep.\n-\tif $gcc_cv_as --gstabs -o conftest.o conftest.s > /dev/null 2>&1 ; then\n-\t  gcc_cv_as_gstabs_flag=\"yes\"\n-\t  # The native Solaris 9/Intel assembler doesn't understand --gstabs\n-\t  # and warns about it, but still exits successfully.  So check for\n-\t  # this.\n-\t  if $gcc_cv_as --gstabs -o conftest.o conftest.s 2>&1 | \\\n-\t\tgrep -i warning > /dev/null ; then\n-\t    gcc_cv_as_gstabs_flag=\"no\"\n-\t  fi\n-\tfi\n-\trm -f conftest.s conftest.o\n-fi\n-if test x\"$gcc_cv_as_gstabs_flag\" = xyes; then\n-\tcat >> confdefs.h <<\\EOF\n+echo \"$ac_t\"\"$gcc_cv_as_gstabs_flag\" 1>&6\n+if test $gcc_cv_as_gstabs_flag = yes; then\n+  cat >> confdefs.h <<\\EOF\n #define HAVE_AS_GSTABS_DEBUG_FLAG 1\n EOF\n \n fi\n-echo \"$ac_t\"\"$gcc_cv_as_gstabs_flag\" 1>&6\n+fi\n \n echo $ac_n \"checking linker read-only and read-write section mixing\"\"... $ac_c\" 1>&6\n-echo \"configure:7130: checking linker read-only and read-write section mixing\" >&5\n+echo \"configure:7208: checking linker read-only and read-write section mixing\" >&5\n gcc_cv_ld_ro_rw_mix=unknown\n if test $in_tree_ld = yes ; then\n   if test \"$gcc_cv_gld_major_version\" -eq 2 -a \"$gcc_cv_gld_minor_version\" -ge 10 -o \"$gcc_cv_gld_major_version\" -gt 2 \\\n@@ -7165,7 +7243,7 @@ fi\n echo \"$ac_t\"\"$gcc_cv_ld_ro_rw_mix\" 1>&6\n \n echo $ac_n \"checking linker PT_GNU_EH_FRAME support\"\"... $ac_c\" 1>&6\n-echo \"configure:7169: checking linker PT_GNU_EH_FRAME support\" >&5\n+echo \"configure:7247: checking linker PT_GNU_EH_FRAME support\" >&5\n gcc_cv_ld_eh_frame_hdr=no\n if test $in_tree_ld = yes ; then\n   if test \"$gcc_cv_gld_major_version\" -eq 2 -a \"$gcc_cv_gld_minor_version\" -ge 12 -o \"$gcc_cv_gld_major_version\" -gt 2 \\\n@@ -7187,7 +7265,7 @@ fi\n echo \"$ac_t\"\"$gcc_cv_ld_eh_frame_hdr\" 1>&6\n \n echo $ac_n \"checking linker position independent executable support\"\"... $ac_c\" 1>&6\n-echo \"configure:7191: checking linker position independent executable support\" >&5\n+echo \"configure:7269: checking linker position independent executable support\" >&5\n gcc_cv_ld_pie=no\n if test $in_tree_ld = yes ; then\n   if test \"$gcc_cv_gld_major_version\" -eq 2 -a \"$gcc_cv_gld_minor_version\" -ge 15 -o \"$gcc_cv_gld_major_version\" -gt 2 \\\n@@ -7212,7 +7290,7 @@ echo \"$ac_t\"\"$gcc_cv_ld_pie\" 1>&6\n case \"$target\" in\n   mips*-*-*)\n     echo $ac_n \"checking whether libgloss uses STARTUP directives consistently\"\"... $ac_c\" 1>&6\n-echo \"configure:7216: checking whether libgloss uses STARTUP directives consistently\" >&5\n+echo \"configure:7294: checking whether libgloss uses STARTUP directives consistently\" >&5\n     gcc_cv_mips_libgloss_startup=no\n     gcc_cv_libgloss_srcdir=`echo $srcdir | sed -e 's,/gcc$,,'`/libgloss\n     if test \"x$exec_prefix\" = xNONE; then\n@@ -7238,35 +7316,6 @@ EOF\n \n     fi\n     echo \"$ac_t\"\"$gcc_cv_mips_libgloss_startup\" 1>&6\n-\n-    echo $ac_n \"checking whether the assembler has explicit relocation support\"\"... $ac_c\" 1>&6\n-echo \"configure:7244: checking whether the assembler has explicit relocation support\" >&5\n-    if test x$gcc_cv_mips_explicit_relocs = x; then\n-      gcc_cv_mips_explicit_relocs=no\n-      if test $in_tree_gas = yes; then\n-         if test $gcc_cv_gas_major_version -eq 2 \\\n-&& test $gcc_cv_gas_minor_version -ge 14 \\\n-|| test $gcc_cv_gas_major_version -gt 2 ; then\n-\n-\n-\t  gcc_cv_mips_explicit_relocs=yes\n-\t\n-\n-fi\n-\n-      elif test x$gcc_cv_as != x; then\n-\techo '  lw $4,%gp_rel(foo)($4)' > conftest.s\n-\tif $gcc_cv_as conftest.s -o conftest.o > /dev/null 2>&1; then\n-\t  gcc_cv_mips_explicit_relocs=yes\n-\tfi\n-\trm -f conftest.s conftest.o\n-      fi\n-    fi\n-    if test $gcc_cv_mips_explicit_relocs = yes; then\n-      test x$target_cpu_default != x || target_cpu_default=0\n-      target_cpu_default=\"(${target_cpu_default}|MASK_EXPLICIT_RELOCS)\"\n-    fi\n-    echo \"$ac_t\"\"$gcc_cv_mips_explicit_relocs\" 1>&6\n     ;;\n esac\n \n@@ -7446,7 +7495,7 @@ fi\n \n \n echo $ac_n \"checking whether to enable maintainer-specific portions of Makefiles\"\"... $ac_c\" 1>&6\n-echo \"configure:7450: checking whether to enable maintainer-specific portions of Makefiles\" >&5\n+echo \"configure:7499: checking whether to enable maintainer-specific portions of Makefiles\" >&5\n     # Check whether --enable-maintainer-mode or --disable-maintainer-mode was given.\n if test \"${enable_maintainer_mode+set}\" = set; then\n   enableval=\"$enable_maintainer_mode\""}, {"sha": "71ac38416bfcae4d5d74be7f6865f0aafd067011", "filename": "gcc/configure.in", "status": "modified", "additions": 340, "deletions": 615, "changes": 955, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/8ada417fa14ff7efe2a06eb5143b34d7c05dab2f/gcc%2Fconfigure.in", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/8ada417fa14ff7efe2a06eb5143b34d7c05dab2f/gcc%2Fconfigure.in", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fconfigure.in?ref=8ada417fa14ff7efe2a06eb5143b34d7c05dab2f", "patch": "@@ -805,7 +805,7 @@ int main()\n   fi\n fi\n \n-AC_CHECK_TYPE(ssize_t, int)\n+gcc_AC_CHECK_TYPE(ssize_t, int)\n \n # Try to determine the array type of the second argument of getgroups\n # for the target system (int or gid_t).\n@@ -1726,232 +1726,156 @@ case $in_tree_objdump in\n esac\n \n # Figure out what assembler alignment features are present.\n-AC_MSG_CHECKING(assembler alignment features)\n-gcc_cv_as_alignment_features=none\n-if test $in_tree_gas = yes; then\n-  # Gas version 2.6 and later support for .balign and .p2align.\n-  gcc_GAS_VERSION_GTE_IFELSE(2,6,0,[\n-    gcc_cv_as_alignment_features=\".balign and .p2align\"\n-    AC_DEFINE(HAVE_GAS_BALIGN_AND_P2ALIGN)\n-  ])\n-  # Gas version 2.8 and later support specifying the maximum\n-  # bytes to skip when using .p2align.\n-  gcc_GAS_VERSION_GTE_IFELSE(2,8,0,[\n-    gcc_cv_as_alignment_features=\".p2align including maximum skip\"\n-    AC_DEFINE(HAVE_GAS_MAX_SKIP_P2ALIGN)\n-  ])\n-elif test x$gcc_cv_as != x; then\n-\t# Check if we have .balign and .p2align\n-\techo \".balign  4\" > conftest.s\n-\techo \".p2align  2\" >> conftest.s\n-\tif $gcc_cv_as -o conftest.o conftest.s > /dev/null 2>&1; then\n-\t\tgcc_cv_as_alignment_features=\".balign and .p2align\"\n-\t\tAC_DEFINE(HAVE_GAS_BALIGN_AND_P2ALIGN)\n-\tfi\n-\trm -f conftest.s conftest.o\n-\t# Check if specifying the maximum bytes to skip when\n-\t# using .p2align is supported.\n-\techo \".p2align 4,,7\" > conftest.s\n-\tif $gcc_cv_as -o conftest.o conftest.s > /dev/null 2>&1; then\n-\t\tgcc_cv_as_alignment_features=\".p2align including maximum skip\"\n-\t\tAC_DEFINE(HAVE_GAS_MAX_SKIP_P2ALIGN)\n-\tfi\n-\trm -f conftest.s conftest.o\n-fi\n-AC_MSG_RESULT($gcc_cv_as_alignment_features)\n-\n-AC_MSG_CHECKING(assembler subsection support)\n-gcc_cv_as_subsections=no\n-if test $in_tree_gas = yes ; then\n-  gcc_GAS_VERSION_GTE_IFELSE(2,9,0,[\n-    test $in_tree_gas_is_elf = yes \\\n-\t&& gcc_cv_as_subsections=\"working .subsection -1\"\n-  ])\n-elif test x$gcc_cv_as != x; then\n-\t# Check if we have .subsection\n-\techo \".subsection 1\" > conftest.s\n-\tif $gcc_cv_as -o conftest.o conftest.s > /dev/null 2>&1; then\n-\t\tgcc_cv_as_subsections=\".subsection\"\n-\t\tif test x$gcc_cv_nm != x; then\n-\t\t\tcat > conftest.s <<EOF\n-conftest_label1: .word 0\n+gcc_GAS_CHECK_FEATURE([.balign and .p2align], gcc_cv_as_balign_and_p2align,\n+ [2,6,0],,\n+[.balign 4\n+.p2align 2],,\n+[AC_DEFINE(HAVE_GAS_BALIGN_AND_P2ALIGN, 1,\n+  [Define if your assembler supports .balign and .p2align.])])\n+\n+gcc_GAS_CHECK_FEATURE([.p2align with maximum skip], gcc_cv_as_max_skip_p2align,\n+ [2,8,0],,\n+ [.p2align 4,,7],,\n+[AC_DEFINE(HAVE_GAS_MAX_SKIP_P2ALIGN, 1,\n+  [Define if your assembler supports specifying the maximum number\n+   of bytes to skip when using the GAS .p2align command.])])\n+\n+gcc_GAS_CHECK_FEATURE([working .subsection -1], gcc_cv_as_subsection_m1,\n+ [elf,2,9,0],,\n+ [conftest_label1: .word 0\n .subsection -1\n conftest_label2: .word 0\n-.previous\n-EOF\n-\t\t\tif $gcc_cv_as -o conftest.o conftest.s > /dev/null 2>&1; then\n-\t\t\t\t$gcc_cv_nm conftest.o | grep conftest_label1 > conftest.nm1\n-\t\t\t\t$gcc_cv_nm conftest.o | grep conftest_label2 | sed -e 's/label2/label1/' > conftest.nm2\n-\t\t\t\tif cmp conftest.nm1 conftest.nm2 > /dev/null 2>&1; then\n-\t\t\t\t\t:\n-\t\t\t\telse\n-\t\t\t\t\tgcc_cv_as_subsections=\"working .subsection -1\"\n-\t\t\t\tfi\n-\t\t\tfi\n-\t\tfi\n-\tfi\n-\trm -f conftest.s conftest.o conftest.nm1 conftest.nm2\n-fi\n-if test x\"$gcc_cv_as_subsections\" = x\"working .subsection -1\"; then\n-\tAC_DEFINE(HAVE_GAS_SUBSECTION_ORDERING, 1,\n-[Define if your assembler supports .subsection and .subsection -1 starts\n-   emitting at the beginning of your section.])\n-fi\n-AC_MSG_RESULT($gcc_cv_as_subsections)\n-\n-AC_MSG_CHECKING(assembler weak support)\n-gcc_cv_as_weak=no\n-if test $in_tree_gas = yes ; then\n-  gcc_GAS_VERSION_GTE_IFELSE(2,2,0,[\n-    gcc_cv_as_weak=\"yes\"\n-  ])\n-elif test x$gcc_cv_as != x; then\n-\t# Check if we have .weak\n-\techo \"\t.weak foobar\" > conftest.s\n-\tif $gcc_cv_as -o conftest.o conftest.s > /dev/null 2>&1; then\n-\t\tgcc_cv_as_weak=\"yes\"\n-\tfi\n-\trm -f conftest.s conftest.o conftest.nm1 conftest.nm2\n-fi\n-if test x\"$gcc_cv_as_weak\" = xyes; then\n-\tAC_DEFINE(HAVE_GAS_WEAK, 1, [Define if your assembler supports .weak.])\n-fi\n-AC_MSG_RESULT($gcc_cv_as_weak)\n-\n-AC_MSG_CHECKING(assembler hidden support)\n-gcc_cv_as_hidden=no\n-if test $in_tree_gas = yes ; then\n-  gcc_GAS_VERSION_GTE_IFELSE(2,12,1,[\n-    test $in_tree_gas_is_elf = yes && gcc_cv_as_hidden=\"yes\"\n-  ])\n-elif test x$gcc_cv_as != x; then\n-\t# Check if we have .hidden\n-\techo \"\t.hidden foobar\" > conftest.s\n-\techo \"foobar:\" >> conftest.s\n-\tif $gcc_cv_as -o conftest.o conftest.s > /dev/null 2>&1; then\n-\t\tgcc_cv_as_hidden=\"yes\"\n-\tfi\n-\trm -f conftest.s conftest.o conftest.nm1 conftest.nm2\n-\n- \t# GNU LD versions before 2.12.1 have buggy support for STV_HIDDEN.\n-\t# This is irritatingly difficult to feature test for.  Look for \n-\t# the date string after the version number.\n-\tld_ver=`$gcc_cv_ld --version 2>/dev/null | head -1`\n-\tif echo \"$ld_ver\" | grep GNU > /dev/null; then\n+.previous],\n+ [if test x$gcc_cv_nm != x; then\n+    $gcc_cv_nm conftest.o | grep conftest_label1 > conftest.nm1\n+    $gcc_cv_nm conftest.o | grep conftest_label2 | sed -e 's/label2/label1/' > conftest.nm2\n+    if cmp conftest.nm1 conftest.nm2 > /dev/null 2>&1\n+    then :\n+    else gcc_cv_as_subsection_m1=yes\n+    fi\n+    rm -f conftest.nm1 conftest.nm2\n+  fi],\n+ [AC_DEFINE(HAVE_GAS_SUBSECTION_ORDERING, 1,\n+  [Define if your assembler supports .subsection and .subsection -1 starts\n+   emitting at the beginning of your section.])])\n+\n+gcc_GAS_CHECK_FEATURE([.weak], gcc_cv_as_weak,\n+ [2,2,0],,\n+ [\t.weak foobar],,\n+[AC_DEFINE(HAVE_GAS_WEAK, 1, [Define if your assembler supports .weak.])])\n+\n+# .hidden needs to be supported in both the assembler and the linker,\n+# because GNU LD versions before 2.12.1 have buggy support for STV_HIDDEN.\n+# This is irritatingly difficult to feature test for; we have to check the\n+# date string after the version number.  If we've got an in-tree\n+# ld, we don't know its patchlevel version, so we set the baseline at 2.13\n+# to be safe.\n+# The gcc_GAS_CHECK_FEATURE call just sets a cache variable.\n+gcc_GAS_CHECK_FEATURE([.hidden], gcc_cv_as_hidden,\n+ [elf,2,13,0],,\n+[\t.hidden foobar\n+foobar:])\n+\n+AC_CACHE_CHECK(linker for .hidden support, gcc_cv_ld_hidden,\n+[if test $in_tree_ld = yes ; then\n+  gcc_cv_ld_hidden=no\n+  if test \"$gcc_cv_gld_major_version\" -eq 2 -a \"$gcc_cv_gld_minor_version\" -ge 13 -o \"$gcc_cv_gld_major_version\" -gt 2 \\\n+     && test $in_tree_ld_is_elf = yes; then\n+     gcc_cv_ld_hidden=yes\n+  fi\n+else\n+  gcc_cv_ld_hidden=yes\n+  ld_ver=`$gcc_cv_ld --version 2>/dev/null | head -1`\n+  if echo \"$ld_ver\" | grep GNU > /dev/null; then\n changequote(,)dnl\n-               ld_vers=`echo $ld_ver | sed -n \\\n-\t       -e 's,^.*[\t ]\\([0-9][0-9]*\\.[0-9][0-9]*\\)$,\\1,p' \\\n-\t       -e 's,^.*[\t ]\\([0-9][0-9]*\\.[0-9][0-9]*\\.[0-9][0-9]*\\)$,\\1,p' \\\n-\t       -e 's,^.*[\t ]\\([0-9][0-9]*\\.[0-9][0-9]*\\.[0-9][0-9]*\\.[0-9][0-9]*\\)$,\\1,p' \\\n-\t       -e 's,^.*[\t ]\\([0-9][0-9]*\\.[0-9][0-9]*\\)[\t ].*$,\\1,p' \\\n-\t       -e 's,^.*[\t ]\\([0-9][0-9]*\\.[0-9][0-9]*\\.[0-9][0-9]*\\)[\t ].*$,\\1,p' \\\n-\t       -e 's,^.*[\t ]\\([0-9][0-9]*\\.[0-9][0-9]*\\.[0-9][0-9]*\\.[0-9][0-9]*\\)[\t ].*$,\\1,p'`\n-               ld_date=`echo $ld_ver | sed -n 's,^.*\\([2-9][0-9][0-9][0-9]\\)[-]*\\([01][0-9]\\)[-]*\\([0-3][0-9]\\).*$,\\1\\2\\3,p'`\n-\t\tif test 0\"$ld_date\" -lt 20020404; then\n-\t\t\tif test -n \"$ld_date\"; then\n-\t\t\t\t# If there was date string, but was earlier than 2002-04-04, fail\n-\t\t\t\tgcc_cv_as_hidden=\"no\"\n-\t\t\telif test -z \"$ld_vers\"; then\n-\t\t\t\t# If there was no date string nor ld version number, something is wrong\n-\t\t\t\tgcc_cv_as_hidden=\"no\"\n-\t\t\telse\n-\t\t\t\tld_vers_major=`expr \"$ld_vers\" : '\\([0-9]*\\)'`\n-\t\t\t\tld_vers_minor=`expr \"$ld_vers\" : '[0-9]*\\.\\([0-9]*\\)'`\n-\t\t\t\tld_vers_patch=`expr \"$ld_vers\" : '[0-9]*\\.[0-9]*\\.\\([0-9]*\\)'`\n-\t\t\t\ttest -z \"$ld_vers_patch\" && ld_vers_patch=0\n-\t\t\t\tif test \"$ld_vers_major\" -lt 2; then\n-\t\t\t\t\tgcc_cv_as_hidden=\"no\"\n-\t\t\t\telif test \"$ld_vers_major\" -eq 2 -a \"$ld_vers_minor\" -lt 12; then\n-\t\t\t\t\tgcc_cv_as_hidden=\"no\"\n-\t\t\t\telif test \"$ld_vers_major\" -eq 2 -a \"$ld_vers_minor\" -eq 12 \\\n-\t\t\t\t\t  -a \"$ld_vers_patch\" -eq 0; then\n-\t\t\t\t\tgcc_cv_as_hidden=\"no\"\n-\t\t\t\tfi\n-\t\t\tfi\n-\t\tfi\n-changequote([,])dnl\n+    ld_vers=`echo $ld_ver | sed -n \\\n+\t-e 's,^.*[\t ]\\([0-9][0-9]*\\.[0-9][0-9]*\\)$,\\1,p' \\\n+\t-e 's,^.*[\t ]\\([0-9][0-9]*\\.[0-9][0-9]*\\.[0-9][0-9]*\\)$,\\1,p' \\\n+\t-e 's,^.*[\t ]\\([0-9][0-9]*\\.[0-9][0-9]*\\.[0-9][0-9]*\\.[0-9][0-9]*\\)$,\\1,p' \\\n+\t-e 's,^.*[\t ]\\([0-9][0-9]*\\.[0-9][0-9]*\\)[\t ].*$,\\1,p' \\\n+\t-e 's,^.*[\t ]\\([0-9][0-9]*\\.[0-9][0-9]*\\.[0-9][0-9]*\\)[\t ].*$,\\1,p' \\\n+\t-e 's,^.*[\t ]\\([0-9][0-9]*\\.[0-9][0-9]*\\.[0-9][0-9]*\\.[0-9][0-9]*\\)[\t ].*$,\\1,p'`\n+    ld_date=`echo $ld_ver | sed -n 's,^.*\\([2-9][0-9][0-9][0-9]\\)[-]*\\([01][0-9]\\)[-]*\\([0-3][0-9]\\).*$,\\1\\2\\3,p'`\n+    if test 0\"$ld_date\" -lt 20020404; then\n+      if test -n \"$ld_date\"; then\n+\t# If there was date string, but was earlier than 2002-04-04, fail\n+\tgcc_cv_ld_hidden=no\n+      elif test -z \"$ld_vers\"; then\n+\t# If there was no date string nor ld version number, something is wrong\n+\tgcc_cv_ld_hidden=no\n+      else\n+\tld_vers_major=`expr \"$ld_vers\" : '\\([0-9]*\\)'`\n+\tld_vers_minor=`expr \"$ld_vers\" : '[0-9]*\\.\\([0-9]*\\)'`\n+\tld_vers_patch=`expr \"$ld_vers\" : '[0-9]*\\.[0-9]*\\.\\([0-9]*\\)'`\n+\ttest -z \"$ld_vers_patch\" && ld_vers_patch=0\n+\tif test \"$ld_vers_major\" -lt 2; then\n+\t  gcc_cv_ld_hidden=no\n+\telif test \"$ld_vers_major\" -eq 2 -a \"$ld_vers_minor\" -lt 12; then\n+\t  gcc_cv_ld_hidden=\"no\"\n+\telif test \"$ld_vers_major\" -eq 2 -a \"$ld_vers_minor\" -eq 12 -a \"$ld_vers_patch\" -eq 0; then\n+\t  gcc_cv_ld_hidden=no\n \tfi\n-fi\n-case \"$target\" in\n-  mips-sgi-irix6*)\n-    if test x\"$gnu_ld_flag\" = x\"no\"; then\n-      # Even if using gas with .hidden support, the resulting object files\n-      # cannot be linked with the IRIX 6 O32 linker.  With the N32 and\n-      # N64 linkers, the problem is that the linker refuses to accept\n-      # -call_shared (passed by default to the linker) and -r (used to\n-      # link the object file generated without .hidden directives with\n-      # one that hides symbols), so we also lose.\n-      gcc_cv_as_hidden=no\n+      fi\n+changequote([,])dnl\n     fi\n-    ;;\n-esac\n-if test x\"$gcc_cv_as_hidden\" = xyes; then\n-\tAC_DEFINE(HAVE_GAS_HIDDEN, 1,\n-\t\t[Define if your assembler supports .hidden.])\n-fi\n-AC_MSG_RESULT($gcc_cv_as_hidden)\n-libgcc_visibility=$gcc_cv_as_hidden\n+  else\n+    case \"$target\" in\n+      mips-sgi-irix6*)\n+        if test x\"$gnu_ld_flag\" = x\"no\"; then\n+          # Even if using gas with .hidden support, the resulting object files\n+          # cannot be linked with the IRIX 6 O32 linker.  With the N32 and\n+          # N64 linkers, the problem is that the linker refuses to accept\n+          # -call_shared (passed by default to the linker) and -r (used to\n+          # link the object file generated without .hidden directives with\n+          # one that hides symbols), so we also lose.\n+          gcc_cv_ld_hidden=no\n+        fi\n+     ;;\n+    esac\n+  fi\n+fi])\n+libgcc_visibility=no\n AC_SUBST(libgcc_visibility)\n+if test $gcc_cv_as_hidden = yes && test $gcc_cv_ld_hidden=yes; then\n+  libgcc_visibility=yes\n+  AC_DEFINE(HAVE_GAS_HIDDEN, 1,\n+  [Define if your assembler and linker support .hidden.])\n+fi\n \n-AC_MSG_CHECKING(assembler leb128 support)\n-gcc_cv_as_leb128=no\n-if test $in_tree_gas = yes ; then\n-  gcc_GAS_VERSION_GTE_IFELSE(2,11,0,[\n-    test $in_tree_gas_is_elf = yes && gcc_cv_as_leb128=\"yes\"\n-  ])\n-elif test x$gcc_cv_as != x; then\n-\t# Check if we have .[us]leb128, and support symbol arithmetic with it.\n-\tcat > conftest.s <<EOF\n-\t.data\n+# Check if we have .[us]leb128, and support symbol arithmetic with it.\n+gcc_GAS_CHECK_FEATURE([.sleb128 and .uleb128], gcc_cv_as_leb128,\n+  [elf,2,11,0],,\n+[\t.data\n \t.uleb128 L2 - L1\n L1:\n \t.uleb128 1280\n \t.sleb128 -1010\n-L2:\n-EOF\n-\tif $gcc_cv_as -o conftest.o conftest.s > /dev/null 2>&1; then\n-\t\tgcc_cv_as_leb128=\"yes\"\n-\n-\t\t# GAS versions before 2.11 do not support uleb128,\n-\t\t# despite appearing to.\n-\t\t# ??? There exists an elf-specific test that will crash\n-\t\t# the assembler.  Perhaps it's better to figure out whether\n-\t\t# arbitrary sections are supported and try the test.\n-\t\tas_ver=`$gcc_cv_as --version 2>/dev/null | head -1`\n-\t\tif echo \"$as_ver\" | grep GNU > /dev/null; then\n+L2:],\n+ [# GAS versions before 2.11 do not support uleb128,\n+  # despite appearing to.\n+  # ??? There exists an elf-specific test that will crash\n+  # the assembler.  Perhaps it's better to figure out whether\n+  # arbitrary sections are supported and try the test.\n+  as_ver=`$gcc_cv_as --version 2>/dev/null | head -1`\n+  if echo \"$as_ver\" | grep GNU > /dev/null; then\n changequote(,)dnl\n-\t\t\tas_ver=`echo $as_ver | sed -e 's/GNU assembler \\([0-9.][0-9.]*\\).*/\\1/'`\n-\t\t\tas_major=`echo $as_ver | sed 's/\\..*//'`\n-\t\t\tas_minor=`echo $as_ver | sed 's/[^.]*\\.\\([0-9]*\\).*/\\1/'`\n+    as_ver=`echo $as_ver | sed -e 's/GNU assembler \\([0-9.][0-9.]*\\).*/\\1/'`\n+    as_major=`echo $as_ver | sed 's/\\..*//'`\n+    as_minor=`echo $as_ver | sed 's/[^.]*\\.\\([0-9]*\\).*/\\1/'`\n changequote([,])dnl\n-\t\t\tif test $as_major -eq 2 -a $as_minor -lt 11; then\n-\t\t\t\tgcc_cv_as_leb128=\"no\"\n-\t\t\tfi\n-\t\tfi\n-\tfi\n-\trm -f conftest.s conftest.o conftest.nm1 conftest.nm2\n-fi\n-if test x\"$gcc_cv_as_leb128\" = xyes; then\n-\tAC_DEFINE(HAVE_AS_LEB128, 1,\n-\t\t[Define if your assembler supports .uleb128.])\n-fi\n-AC_MSG_RESULT($gcc_cv_as_leb128)\n-\n-AC_MSG_CHECKING(assembler eh_frame optimization)\n-gcc_cv_as_eh_frame=no\n-if test $in_tree_gas = yes ; then\n-  gcc_GAS_VERSION_GTE_IFELSE(2,12,0,[\n-    test $in_tree_gas_is_elf = yes && gcc_cv_as_eh_frame=\"yes\"\n-  ])\n-elif test x$gcc_cv_as != x; then\n-\t# Check if this is GAS.\n-\tas_ver=`$gcc_cv_as --version < /dev/null 2> /dev/null | head -1`\n-\trm -f a.out 2> /dev/null\n-\tif echo \"$as_ver\" | grep GNU > /dev/null; then\n-\t\t# Versions up to and including 2.11.0 may mis-optimize\n-\t\t# .eh_frame data.  Try something.\n-\t\tcat > conftest.s <<EOF\n-\t.text\n+    if test $as_major -eq 2 && test $as_minor -lt 11\n+    then :\n+    else gcc_cv_as_leb128=yes\n+    fi\n+  fi],\n+  [AC_DEFINE(HAVE_AS_LEB128, 1,\n+    [Define if your assembler supports .sleb128 and .uleb128.])])\n+\n+# GAS versions up to and including 2.11.0 may mis-optimize\n+# .eh_frame data.\n+gcc_GAS_CHECK_FEATURE(eh_frame optimization, gcc_cv_as_eh_frame,\n+  [elf,2,12,0],,\n+[\t.text\n .LFB1:\n \t.4byte\t0\n .L1:\n@@ -1982,61 +1906,45 @@ __FRAME_BEGIN__:\n \t.4byte\t.LFE1-.LFB1\n \t.byte\t0x4\n \t.4byte\t.L1-.LFB1\n-.LEFDE1:\n-EOF\n-\t\tcat > conftest.lit <<EOF\n+.LEFDE1:],\n+[  cat > conftest.lit <<EOF\n  0000 10000000 00000000 017a0001 781a0004  .........z..x...\n  0010 01000000 12000000 18000000 00000000  ................\n  0020 08000000 04080000 0044               .........D      \n EOF\n-\t\tcat > conftest.big <<EOF\n+  cat > conftest.big <<EOF\n  0000 00000010 00000000 017a0001 781a0004  .........z..x...\n  0010 00000001 00000012 00000018 00000000  ................\n  0020 00000008 04000000 0844               .........D      \n EOF\n-\t\t# If the assembler didn't choke, and we can objdump,\n-\t\t# and we got the correct data, then succeed.\n-\t\tif $gcc_cv_as -o conftest.o conftest.s > /dev/null 2>&1 \\\n-\t\t   && $gcc_cv_objdump -s -j .eh_frame conftest.o 2>/dev/null \\\n-\t\t      | tail -3 > conftest.got \\\n-\t\t   && { cmp conftest.lit conftest.got > /dev/null 2>&1 \\\n-\t\t        || cmp conftest.big conftest.got > /dev/null 2>&1; }\n-\t\tthen\n-\t\t\tgcc_cv_as_eh_frame=\"yes\"\n-\t\telse\n-\t\t\tgcc_cv_as_eh_frame=\"bad\"\n-\t\t\tif $gcc_cv_as -o conftest.o --traditional-format /dev/null; then\n-\t\t\t\tAC_DEFINE(USE_AS_TRADITIONAL_FORMAT, 1,\n-\t[Define if your assembler mis-optimizes .eh_frame data.])\n-\t\t\tfi\n-\t\tfi\n-\tfi\n-\trm -f conftest.*\n-fi\n-AC_MSG_RESULT($gcc_cv_as_eh_frame)\n-\n-AC_MSG_CHECKING(assembler section merging support)\n-gcc_cv_as_shf_merge=no\n-if test $in_tree_gas = yes ; then\n-  gcc_GAS_VERSION_GTE_IFELSE(2,12,0,[\n-    test $in_tree_gas_is_elf = yes && gcc_cv_as_shf_merge=\"yes\"\n-  ])\n-elif test x$gcc_cv_as != x; then\n-\t# Check if we support SHF_MERGE sections\n-\techo '.section .rodata.str, \"aMS\", @progbits, 1' > conftest.s\n-\tif $gcc_cv_as --fatal-warnings -o conftest.o conftest.s > /dev/null 2>&1; then\n-\t\tgcc_cv_as_shf_merge=yes\n-\tfi\n-\trm -f conftest.s conftest.o\n-fi\n-if test x\"$gcc_cv_as_shf_merge\" = xyes; then\n-\tAC_DEFINE(HAVE_GAS_SHF_MERGE, 1,\n-[Define if your assembler supports marking sections with SHF_MERGE flag.])\n+  # If the assembler didn't choke, and we can objdump,\n+  # and we got the correct data, then succeed.\n+  if test x$gcc_cv_objdump != x \\\n+  && $gcc_cv_objdump -s -j .eh_frame conftest.o 2>/dev/null \\\n+     | tail -3 > conftest.got \\\n+  && { cmp conftest.lit conftest.got > /dev/null 2>&1 \\\n+    || cmp conftest.big conftest.got > /dev/null 2>&1; }\n+  then\n+    gcc_cv_as_eh_frame=yes\n+  elif AC_TRY_COMMAND($gcc_cv_as -o conftest.o --traditional-format /dev/null); then\n+    gcc_cv_as_eh_frame=buggy\n+  else\n+    # Uh oh, what do we do now?\n+    gcc_cv_as_eh_frame=no\n+  fi])\n+\n+if test $gcc_cv_as_eh_frame = buggy; then\n+  AC_DEFINE(USE_AS_TRADITIONAL_FORMAT, 1,\n+  [Define if your assembler mis-optimizes .eh_frame data.])\n fi\n-AC_MSG_RESULT($gcc_cv_as_shf_merge)\n \n-AC_MSG_CHECKING(assembler thread-local storage support)\n-gcc_cv_as_tls=no\n+gcc_GAS_CHECK_FEATURE(section merging support, gcc_cv_as_shf_merge,\n+ [elf,2,12,0], [--fatal-warnings],\n+ [.section .rodata.str, \"aMS\", @progbits, 1],,\n+ [AC_DEFINE(HAVE_GAS_SHF_MERGE, 1,\n+[Define if your assembler supports marking sections with SHF_MERGE flag.])])\n+\n+# Thread-local storage - the check is heavily parametrized.\n conftest_s=\n tls_first_major=\n tls_first_minor=\n@@ -2215,38 +2123,23 @@ foo:\t.long\t25\n \t;;\n esac\n if test -z \"$tls_first_major\"; then\n-  :\n-elif test $in_tree_gas = yes ; then\n-  gcc_GAS_VERSION_GTE_IFELSE($tls_first_major,$tls_first_minor,0,[\n-    gcc_cv_as_tls=yes\n-  ])\n-elif test x$gcc_cv_as != x; then\n-  echo \"$conftest_s\" > conftest.s\n-  if $gcc_cv_as $tls_as_opt --fatal-warnings -o conftest.o conftest.s > /dev/null 2>&1\n-  then\n-    gcc_cv_as_tls=yes\n-  fi\n-  rm -f conftest.s conftest.o\n-fi\n-if test \"$gcc_cv_as_tls\" = yes; then\n-  AC_DEFINE(HAVE_AS_TLS, 1,\n-\t    [Define if your assembler supports thread-local storage.])\n+  : # If we don't have a check, assume no support.\n+else\n+  gcc_GAS_CHECK_FEATURE(thread-local storage support, gcc_cv_as_tls,\n+  [$tls_first_major,$tls_first_minor,0], [$tls_as_opt --fatal-warnings],\n+  [$conftest_s],,\n+  [AC_DEFINE(HAVE_AS_TLS, 1,\n+\t    [Define if your assembler supports thread-local storage.])])\n fi\n-AC_MSG_RESULT($gcc_cv_as_tls)\n+\n+# Target-specific assembler checks.\n \n case \"$target\" in\n   # All TARGET_ABI_OSF targets.\n   alpha*-*-osf* | alpha*-*-linux* | alpha*-*-*bsd*)\n-    AC_CACHE_CHECK([assembler supports explicit relocations],\n-\tgcc_cv_as_explicit_relocs, [\n-\tgcc_cv_as_explicit_relocs=unknown\n-\tif test $in_tree_gas = yes ; then\n-           gcc_GAS_VERSION_GTE_IFELSE(2,12,0,[\n-\t      gcc_cv_as_explicit_relocs=yes\n-\t   ])\n-\telif test x$gcc_cv_as != x; then\n-\t    cat > conftest.s << 'EOF'\n-\t.set nomacro\n+    gcc_GAS_CHECK_FEATURE([explicit relocation support],\n+\tgcc_cv_as_alpha_explicit_relocs, [2,12,0],,\n+[\t.set nomacro\n \t.text\n \textbl\t$3, $2, $3\t!lituse_bytoff!1\n \tldq\t$2, a($29)\t!literal!1\n@@ -2258,257 +2151,144 @@ case \"$target\" in\n \tlda\t$0, c($29)\t!gprel\n \tldah\t$1, d($29)\t!gprelhigh\n \tlda\t$1, d($1)\t!gprellow\n-\tlda\t$29, 0($29)\t!gpdisp!3\n-EOF\n-\t    if $gcc_cv_as -o conftest.o conftest.s > /dev/null 2>&1; then\n-\t\tgcc_cv_as_explicit_relocs=yes\n-\t    else\n-\t\tgcc_cv_as_explicit_relocs=no\n-\t    fi\n-\t    rm -f conftest.s conftest.o\n-\tfi\n-    ])\n-    if test \"x$gcc_cv_as_explicit_relocs\" = xyes; then\n-\tAC_DEFINE(HAVE_AS_EXPLICIT_RELOCS, 1,\n-\t\t[Define if your assembler supports explicit relocations.])\n-    fi\n+\tlda\t$29, 0($29)\t!gpdisp!3],,\n+    [AC_DEFINE(HAVE_AS_EXPLICIT_RELOCS, 1,\n+  [Define if your assembler supports explicit relocations.])])\n     ;;\n-  sparc*-*-*)\n-    AC_CACHE_CHECK([assembler .register pseudo-op support],\n-\tgcc_cv_as_register_pseudo_op, [\n-\tgcc_cv_as_register_pseudo_op=unknown\n-\tif test x$gcc_cv_as != x; then\n-\t    # Check if we have .register\n-\t    echo \".register %g2, #scratch\" > conftest.s\n-\t    if $gcc_cv_as -o conftest.o conftest.s > /dev/null 2>&1; then\n-\t\tgcc_cv_as_register_pseudo_op=yes\n-\t    else\n-\t\tgcc_cv_as_register_pseudo_op=no\n-\t    fi\n-\t    rm -f conftest.s conftest.o\n-\tfi\n-    ])\n-    if test \"x$gcc_cv_as_register_pseudo_op\" = xyes; then\n-\tAC_DEFINE(HAVE_AS_REGISTER_PSEUDO_OP, 1,\n-\t\t[Define if your assembler supports .register.])\n-    fi\n-\n-    AC_CACHE_CHECK([assembler supports -relax],\n-\tgcc_cv_as_relax_opt, [\n-\tgcc_cv_as_relax_opt=unknown\n-\tif test x$gcc_cv_as != x; then\n-\t    # Check if gas supports -relax\n-\t    echo \".text\" > conftest.s\n-\t    if $gcc_cv_as -relax -o conftest.o conftest.s > /dev/null 2>&1; then\n-\t\tgcc_cv_as_relax_opt=yes\n-\t    else\n-\t\tgcc_cv_as_relax_opt=no\n-\t    fi\n-\t    rm -f conftest.s conftest.o\n-\tfi\n-    ])\n-    if test \"x$gcc_cv_as_relax_opt\" = xyes; then\n-\tAC_DEFINE(HAVE_AS_RELAX_OPTION, 1,\n-\t\t[Define if your assembler supports -relax option.])\n-    fi\n \n-    AC_CACHE_CHECK([assembler and linker support unaligned pc related relocs],\n-\tgcc_cv_as_sparc_ua_pcrel, [\n-\tgcc_cv_as_sparc_ua_pcrel=unknown\n-\tif test x$gcc_cv_as != x -a x$gcc_cv_ld != x; then\n-\t    gcc_cv_as_sparc_ua_pcrel=no\n-\t    echo \".text; foo: nop; .data; .align 4; .byte 0; .uaword %r_disp32(foo)\" > conftest.s\n-\t    if $gcc_cv_as -K PIC -o conftest.o conftest.s > /dev/null 2>&1 \\\n-\t       && $gcc_cv_ld -o conftest conftest.o -G > /dev/null 2>&1; then\n-\t\tgcc_cv_as_sparc_ua_pcrel=yes\n-\t    fi\n-\t    rm -f conftest.s conftest.o conftest\n-\tfi\n-    ])\n-    if test \"x$gcc_cv_as_sparc_ua_pcrel\" = xyes; then\n-\tAC_DEFINE(HAVE_AS_SPARC_UA_PCREL, 1,\n+  sparc*-*-*)\n+    gcc_GAS_CHECK_FEATURE([.register], gcc_cv_as_sparc_register_op,,,\n+      [.register %g2, #scratch],,\n+      [AC_DEFINE(HAVE_AS_REGISTER_PSEUDO_OP, 1,\n+\t\t[Define if your assembler supports .register.])])\n+\n+    gcc_GAS_CHECK_FEATURE([-relax option], gcc_cv_as_sparc_relax,,\n+      [-relax], [.text],,\n+      [AC_DEFINE(HAVE_AS_RELAX_OPTION, 1,\n+\t\t[Define if your assembler supports -relax option.])])\n+\n+    gcc_GAS_CHECK_FEATURE([unaligned pcrel relocs],\n+      gcc_cv_as_sparc_ua_pcrel,,\n+      [-K PIC],\n+[.text\n+foo:\n+\tnop\n+.data\n+.align 4\n+.byte 0\n+.uaword %r_disp32(foo)],\n+      [if test x$gcc_cv_ld != x \\\n+       && $gcc_cv_ld -o conftest conftest.o -G > /dev/null 2>&1; then\n+\t gcc_cv_as_sparc_ua_pcrel=yes\n+       fi\n+       rm -f conftest],\n+      [AC_DEFINE(HAVE_AS_SPARC_UA_PCREL, 1,\n \t\t[Define if your assembler and linker support unaligned PC relative relocs.])\n-    fi\n \n-    AC_CACHE_CHECK([assembler and linker support unaligned pc related relocs against hidden symbols],\n-\tgcc_cv_as_sparc_ua_pcrel_hidden, [\n-\tif test \"x$gcc_cv_as_sparc_ua_pcrel\" = xyes; then\n-\t    gcc_cv_as_sparc_ua_pcrel_hidden=unknown\n-\t    if test x$gcc_cv_objdump != x; then\n-\t        gcc_cv_as_sparc_ua_pcrel_hidden=no\n-\t\techo \".data; .align 4; .byte 0x31; .uaword %r_disp32(foo)\" > conftest.s\n-\t\techo \".byte 0x32, 0x33, 0x34; .global foo; .hidden foo\" >> conftest.s\n-\t\techo \"foo: .skip 4\" >> conftest.s\n-\t\tif $gcc_cv_as -K PIC -o conftest.o conftest.s > /dev/null 2>&1 \\\n-\t\t   && $gcc_cv_ld -o conftest conftest.o -G > /dev/null 2>&1 \\\n-\t\t   && $gcc_cv_objdump -s -j .data conftest 2> /dev/null \\\n-\t\t      | grep ' 31000000 07323334' > /dev/null 2>&1; then\n-\t\t    if $gcc_cv_objdump -R conftest 2> /dev/null \\\n-\t\t       | grep 'DISP32' > /dev/null 2>&1; then\n-\t\t\t:\n-\t\t    else\n-\t\t\tgcc_cv_as_sparc_ua_pcrel_hidden=yes\n-\t\t    fi\n-\t\tfi\n-\t    fi\n-\t    rm -f conftest.s conftest.o conftest\n-\telse\n-\t    gcc_cv_as_sparc_ua_pcrel_hidden=\"$gcc_cv_as_sparc_ua_pcrel\"\n-\tfi\n-    ])\n-    if test \"x$gcc_cv_as_sparc_ua_pcrel_hidden\" = xyes; then\n-\tAC_DEFINE(HAVE_AS_SPARC_UA_PCREL_HIDDEN, 1,\n-\t\t[Define if your assembler and linker support unaligned PC relative relocs against hidden symbols.])\n-    fi\n-\n-    AC_CACHE_CHECK([for assembler offsetable %lo() support],\n-\tgcc_cv_as_offsetable_lo10, [\n-\tgcc_cv_as_offsetable_lo10=unknown\n-\tif test \"x$gcc_cv_as\" != x; then\n-\t    # Check if assembler has offsetable %lo()\n-\t    echo \"or %g1, %lo(ab) + 12, %g1\" > conftest.s\n-\t    echo \"or %g1, %lo(ab + 12), %g1\" > conftest1.s\n-\t    if $gcc_cv_as -xarch=v9 -o conftest.o conftest.s \\\n-\t\t    > /dev/null 2>&1 &&\n-\t       $gcc_cv_as -xarch=v9 -o conftest1.o conftest1.s \\\n-\t\t    > /dev/null 2>&1; then\n-\t\tif cmp conftest.o conftest1.o > /dev/null 2>&1; then\n-\t\t    gcc_cv_as_offsetable_lo10=no\n-\t\telse\n-\t\t    gcc_cv_as_offsetable_lo10=yes\n-\t\tfi\n+      gcc_GAS_CHECK_FEATURE([unaligned pcrel relocs against hidden symbols],\n+\tgcc_cv_as_sparc_ua_pcrel_hidden,,\n+\t[-K PIC],\n+[.data\n+.align 4\n+.byte 0x31\n+.uaword %r_disp32(foo)\n+.byte 0x32, 0x33, 0x34\n+.global foo\n+.hidden foo\n+foo:\n+.skip 4],\n+\t[if test x$gcc_cv_ld != x && test x$gcc_cv_objdump != x \\\n+\t && $gcc_cv_ld -o conftest conftest.o -G > /dev/null 2>&1 \\\n+\t && $gcc_cv_objdump -s -j .data conftest 2> /dev/null \\\n+\t    | grep ' 31000000 07323334' > /dev/null 2>&1; then\n+\t    if $gcc_cv_objdump -R conftest 2> /dev/null \\\n+\t       | grep 'DISP32' > /dev/null 2>&1; then\n+\t\t:\n \t    else\n-\t\tgcc_cv_as_offsetable_lo10=no\n+\t\tgcc_cv_as_sparc_ua_pcrel_hidden=yes\n \t    fi\n-\t    rm -f conftest.s conftest.o conftest1.s conftest1.o\n-\tfi\n-    ])\n-    if test \"x$gcc_cv_as_offsetable_lo10\" = xyes; then\n-\tAC_DEFINE(HAVE_AS_OFFSETABLE_LO10, 1,\n-\t    [Define if your assembler supports offsetable %lo().])\n-    fi\n-\n+\t fi\n+\t rm -f conftest],\n+\t [AC_DEFINE(HAVE_AS_SPARC_UA_PCREL_HIDDEN, 1,\n+\t\t   [Define if your assembler and linker support unaligned PC relative relocs against hidden symbols.])])\n+    ]) # unaligned pcrel relocs\n+\n+    gcc_GAS_CHECK_FEATURE([offsetable %lo()],\n+      gcc_cv_as_sparc_offsetable_lo10,,\n+      [-xarch=v9],\n+[.text\n+\tor %g1, %lo(ab) + 12, %g1\n+\tor %g1, %lo(ab + 12), %g1],\n+      [if test x$gcc_cv_objdump != x \\\n+       && %gcc_cv_objdump -s -j .text conftest.o 2> /dev/null \\\n+          | grep ' 82106000 82106000' > /dev/null 2>&1; then\n+\t gcc_cv_as_offsetable_lo10=yes\n+       fi],\n+       [AC_DEFINE(HAVE_AS_OFFSETABLE_LO10, 1,\n+\t         [Define if your assembler supports offsetable %lo().])])\n     ;;\n \n changequote(,)dnl\n   i[34567]86-*-* | x86_64-*-*)\n changequote([,])dnl\n-    AC_MSG_CHECKING(assembler instructions)\n-    gcc_cv_as_instructions=\n-    if test $in_tree_gas = yes ; then \n-      gcc_GAS_VERSION_GTE_IFELSE(2,9,0,[\n-\tgcc_cv_as_instructions=\"filds fists\"\n-      ])\n-    elif test x$gcc_cv_as != x; then\n-\tset \"filds fists\" \"filds mem; fists mem\"\n-\twhile test $# -gt 0\n-  \tdo\n-\t\techo \"$2\" > conftest.s\n-\t\tif $gcc_cv_as -o conftest.o conftest.s > /dev/null 2>&1; then\n-\t\t\tgcc_cv_as_instructions=${gcc_cv_as_instructions}$1\" \"\n-\t\tfi\n-\t\tshift 2\n-\tdone\n-\trm -f conftest.s conftest.o\n-    fi\n-    if test x\"$gcc_cv_as_instructions\" != x; then\n-\tAC_DEFINE_UNQUOTED(HAVE_GAS_`echo \"$gcc_cv_as_instructions\" | sed -e 's/ $//' | tr '[a-z ]' '[A-Z_]'`)\n-    fi\n-    AC_MSG_RESULT($gcc_cv_as_instructions)\n-\n-    AC_MSG_CHECKING(assembler GOTOFF in data directives)\n-    gcc_cv_as_gotoff_in_data=no\n-    if test $in_tree_gas = yes ; then\n-      gcc_GAS_VERSION_GTE_IFELSE(2,11,0,[\n-\tgcc_cv_as_gotoff_in_data=yes\n-      ])\n-    elif test x$gcc_cv_as != x; then\n-\tcat > conftest.s <<EOF\n-\t.text\n+    gcc_GAS_CHECK_FEATURE([filds and fists mnemonics],\n+       gcc_cv_as_ix86_filds_fists,\n+      [2,9,0],, [filds mem; fists mem],,\n+      [AC_DEFINE(HAVE_GAS_FILDS_FISTS, 1,\n+        [Define if your assembler uses the new HImode fild and fist notation.])])\n+\n+    gcc_GAS_CHECK_FEATURE([GOTOFF in data],\n+        gcc_cv_as_ix86_gotoff_in_data, [2,11,0],,\n+[\t.text\n .L0:\n \tnop\n \t.data\n-\t.long .L0@GOTOFF\n-EOF\n-\tif $gcc_cv_as -o conftest.o conftest.s > /dev/null 2>&1; then\n-\t  gcc_cv_as_gotoff_in_data=yes\n-\tfi\n-    fi\n-    AC_DEFINE_UNQUOTED(HAVE_AS_GOTOFF_IN_DATA,\n+\t.long .L0@GOTOFF],,\n+    [AC_DEFINE_UNQUOTED(HAVE_AS_GOTOFF_IN_DATA,\n       [`if test $gcc_cv_as_gotoff_in_data = yes; then echo 1; else echo 0; fi`],\n-      [Define true if the assembler supports '.long foo@GOTOFF'.])\n-    AC_MSG_RESULT($gcc_cv_as_gotoff_in_data)\n+      [Define true if the assembler supports '.long foo@GOTOFF'.])])\n     ;;\n \n   ia64*-*-*)\n-    AC_CACHE_CHECK([assembler supports ltoffx and ldxmov],\n-\tgcc_cv_as_ltoffx_ldxmov_relocs, [\n-\tgcc_cv_as_ltoffx_ldxmov_relocs=unknown\n-\tif test $in_tree_gas = yes ; then\n-          gcc_GAS_VERSION_GTE_IFELSE(2,14,0,[\n-\t    gcc_cv_as_ltoffx_ldxmov_relocs=yes\n-          ])\n-\telif test x$gcc_cv_as != x; then\n-\t    cat > conftest.s << 'EOF'\n-changequote(,)dnl\n-\t.text\n+    gcc_GAS_CHECK_FEATURE([ltoffx and ldxmov relocs],\n+\tgcc_cv_as_ia64_ltoffx_ldxmov_relocs, [2,14,0],,\n+changequote(<<,>>)dnl\n+<<\t.text\n \taddl r15 = @ltoffx(x#), gp\n \t;;\n-\tld8.mov r16 = [r15], x#\n-EOF\n+\tld8.mov r16 = [r15], x#>>,\n changequote([,])dnl\n-\t    if $gcc_cv_as -o conftest.o conftest.s > /dev/null 2>&1; then\n-\t\tgcc_cv_as_ltoffx_ldxmov_relocs=yes\n-\t    else\n-\t\tgcc_cv_as_ltoffx_ldxmov_relocs=no\n-\t    fi\n-\t    rm -f conftest.s conftest.o\n-\tfi\n-    ])\n-    if test \"x$gcc_cv_as_ltoffx_ldxmov_relocs\" = xyes; then\n-\tAC_DEFINE(HAVE_AS_LTOFFX_LDXMOV_RELOCS, 1,\n-\t  [Define if your assembler supports ltoffx and ldxmov relocations.])\n-    fi\n+    [AC_DEFINE(HAVE_AS_LTOFFX_LDXMOV_RELOCS, 1,\n+\t  [Define if your assembler supports ltoffx and ldxmov relocations.])])\n+\n     ;;\n+\n   powerpc*-*-*)\n-    AC_CACHE_CHECK([assembler supports mfcr field],\n-\tgcc_cv_as_mfcrf, [\n-\tgcc_cv_as_mfcrf=unknown\n-\tif test $in_tree_gas = yes ; then\n-          gcc_GAS_VERSION_GTE_IFELSE(2,14,0,[\n-\t    gcc_cv_as_mfcrf=yes\n-          ])\n-\telif test x$gcc_cv_as != x; then\n-\t    cat > conftest.s << 'EOF'\n-\t      case \"$target\" in\n-changequote(,)dnl\n-\t\t*-*-aix*)\n-\t.csect .text[PR]\n-\t\t;;\n-\t\t*)\n-\t.text\n-\t\t;;\n-\t      esac\n-\tmfcr 3,128\n-EOF\n-changequote([,])dnl\n-\t    if $gcc_cv_as -o conftest.o conftest.s > /dev/null 2>&1; then\n-\t\tgcc_cv_as_mfcrf=yes\n-\t    else\n-\t\tgcc_cv_as_mfcrf=no\n-\t    fi\n-\t    rm -f conftest.s conftest.o\n-\tfi\n-    ])\n-    if test \"x$gcc_cv_as_mfcrf\" = xyes; then\n-\tAC_DEFINE(HAVE_AS_MFCRF, 1,\n-\t  [Define if your assembler supports mfcr field.])\n-    fi\n+    case $target in\n+      *-*-aix) conftest_s='\t.csect .text[PR]';;\n+      *)       conftest_s='\t.text';;\n+    esac\n+    conftest_s=\"$conftest_s\n+\tmfcr 3,128\"\n+\n+    gcc_GAS_CHECK_FEATURE([mfcr field support],\n+      gcc_cv_as_powerpc_mfcrf, [2,14,0],,\n+      [$conftest_s],,\n+      [AC_DEFINE(HAVE_AS_MFCRF, 1,\n+\t  [Define if your assembler supports mfcr field.])])\n     ;;\n-esac\n \n-AC_MSG_CHECKING(assembler dwarf2 debug_line support)\n-gcc_cv_as_dwarf2_debug_line=no\n+  mips*-*-*)\n+    gcc_GAS_CHECK_FEATURE([explicit relocation support],\n+      gcc_cv_as_mips_explicit_relocs, [2,14,0],,\n+[\tlw $4,%gp_rel(foo)($4)],,\n+      [if test x$target_cpu_default = x\n+       then target_cpu_default=MASK_EXPLICIT_RELOCS\n+       else target_cpu_default=\"($target_cpu_default)|MASK_EXPLICIT_RELOCS\"\n+       fi])\n+\n+    ;;\n+esac\n # ??? Not all targets support dwarf2 debug_line, even within a version\n # of gas.  Moreover, we need to emit a valid instruction to trigger any\n # info to the output file.  So, as supported targets are added to gas 2.11,\n@@ -2527,90 +2307,55 @@ case \"$target\" in\n   mmix-*-*)\n     insn=\"swym 0\"\n     ;;\n-  esac\n-if test $in_tree_gas = yes ; then\n-  gcc_GAS_VERSION_GTE_IFELSE(2,11,0,[\n-    test $in_tree_gas_is_elf = yes && test x\"$insn\" != x \\\n-\t&& gcc_cv_as_dwarf2_debug_line=\"yes\"\n-  ])\n-elif test x$gcc_cv_as != x -a x\"$insn\" != x ; then\n-\techo '\t.file 1 \"conftest.s\"' > conftest.s\n-\techo '\t.loc 1 3 0' >> conftest.s\n-\techo \"\t$insn\" >> conftest.s\n-\t# ??? This fails with non-gnu grep.\n-\tif $gcc_cv_as -o conftest.o conftest.s > /dev/null 2>&1 \\\n-\t   && grep debug_line conftest.o > /dev/null 2>&1 ; then\n-\t\t# The .debug_line file table must be in the exact order that\n-\t\t# we specified the files, since these indices are also used\n-\t\t# by DW_AT_decl_file.  Approximate this test by testing if\n-\t\t# the assembler bitches if the same index is assigned twice.\n-\t\techo '\t.file 1 \"foo.s\"' > conftest.s\n-\t\techo '\t.file 1 \"bar.s\"' >> conftest.s\n-\t\tif $gcc_cv_as -o conftest.o conftest.s > /dev/null 2>&1\n-\t\tthen\n-\t\t  gcc_cv_as_dwarf2_debug_line=\"no\"\n-\t\telse\n-\t\t  gcc_cv_as_dwarf2_debug_line=\"yes\"\n-\t\tfi\n-\tfi\n-\trm -f conftest.s conftest.o conftest.nm1 conftest.nm2\n-fi\n-if test x\"$gcc_cv_as_dwarf2_debug_line\" = xyes; then\n+esac\n+if test x\"$insn\" != x; then\n+ conftest_s=\"\\\n+\t.file 1 \\\"conftest.s\\\"\n+\t.loc 1 3 0\n+\t$insn\"\n+ gcc_GAS_CHECK_FEATURE([dwarf2 debug_line support],\n+  gcc_cv_as_dwarf2_debug_line,\n+  [elf,2,11,0],, [$conftest_s],\n+  [# ??? This fails with non-gnu grep.  Maybe use objdump?\n+   if grep debug_line conftest.o > /dev/null 2>&1; then\n+     gcc_cv_as_dwarf2_debug_line=yes\n+   fi])\n+\n+# The .debug_line file table must be in the exact order that\n+# we specified the files, since these indices are also used\n+# by DW_AT_decl_file.  Approximate this test by testing if\n+# the assembler bitches if the same index is assigned twice.\n+ gcc_GAS_CHECK_FEATURE([buggy dwarf2 .file directive],\n+  gcc_cv_as_dwarf2_file_buggy,,,\n+[\t.file 1 \"foo.s\"\n+\t.file 1 \"bar.s\"])\n+\n+ if test $gcc_cv_as_dwarf2_debug_line = yes \\\n+ && test $gcc_cv_as_dwarf2_file_buggy = no; then\n \tAC_DEFINE(HAVE_AS_DWARF2_DEBUG_LINE, 1,\n-[Define if your assembler supports dwarf2 .file/.loc directives,\n+  [Define if your assembler supports dwarf2 .file/.loc directives,\n    and preserves file table indices exactly as given.])\n+ fi\n+\n+ gcc_GAS_CHECK_FEATURE([--gdwarf2 option],\n+  gcc_cv_as_gdwarf2_flag,\n+  [elf,2,11,0], [--gdwarf2], [$insn],,\n+  [AC_DEFINE(HAVE_AS_GDWARF2_DEBUG_FLAG, 1,\n+[Define if your assembler supports the --gdwarf2 option.])])\n+\n+ gcc_GAS_CHECK_FEATURE([--gstabs option],\n+  gcc_cv_as_gstabs_flag,\n+  [elf,2,11,0], [--gstabs], [$insn],\n+  [# The native Solaris 9/Intel assembler doesn't understand --gstabs\n+   # and warns about it, but still exits successfully.  So check for\n+   # this.\n+   if AC_TRY_COMMAND([$gcc_cv_as --gstabs -o conftest.o conftest.s 2>&1 | grep -i warning > /dev/null])\n+   then :\n+   else gcc_cv_as_gstabs_flag=yes\n+   fi],\n+  [AC_DEFINE(HAVE_AS_GSTABS_DEBUG_FLAG, 1,\n+[Define if your assembler supports the --gstabs option.])])\n fi\n-AC_MSG_RESULT($gcc_cv_as_dwarf2_debug_line)\n-\n-AC_MSG_CHECKING(assembler --gdwarf2 support)\n-gcc_cv_as_gdwarf2_flag=no\n-if test $in_tree_gas = yes ; then\n-  gcc_GAS_VERSION_GTE_IFELSE(2,11,0,[\n-    test $in_tree_gas_is_elf = yes && test x\"$insn\" != x \\\n-\t&& gcc_cv_as_gdwarf2_flag=\"yes\"\n-  ])\n-elif test x$gcc_cv_as != x -a x\"$insn\" != x ; then\n-\techo '' > conftest.s\n-\t# ??? This fails with non-gnu grep.\n-\tif $gcc_cv_as --gdwarf2 -o conftest.o conftest.s > /dev/null 2>&1\n-\t  then\n-\t  gcc_cv_as_gdwarf2_flag=\"yes\"\n-\tfi\n-\trm -f conftest.s conftest.o\n-fi\n-if test x\"$gcc_cv_as_gdwarf2_flag\" = xyes; then\n-\tAC_DEFINE(HAVE_AS_GDWARF2_DEBUG_FLAG, 1,\n-[Define if your assembler supports the --gdwarf2 option.])\n-fi\n-AC_MSG_RESULT($gcc_cv_as_gdwarf2_flag)\n-\n-AC_MSG_CHECKING(assembler --gstabs support)\n-gcc_cv_as_gstabs_flag=no\n-if test $in_tree_gas = yes ; then\n-  gcc_GAS_VERSION_GTE_IFELSE(2,11,0,[\n-    test $in_tree_gas_is_elf = yes && test x\"$insn\" != x \\\n-\t&& gcc_cv_as_gstabs_flag=\"yes\"\n-  ])\n-elif test x$gcc_cv_as != x -a x\"$insn\" != x ; then\n-\techo '' > conftest.s\n-\t# ??? This fails with non-gnu grep.\n-\tif $gcc_cv_as --gstabs -o conftest.o conftest.s > /dev/null 2>&1 ; then\n-\t  gcc_cv_as_gstabs_flag=\"yes\"\n-\t  # The native Solaris 9/Intel assembler doesn't understand --gstabs\n-\t  # and warns about it, but still exits successfully.  So check for\n-\t  # this.\n-\t  if $gcc_cv_as --gstabs -o conftest.o conftest.s 2>&1 | \\\n-\t\tgrep -i warning > /dev/null ; then\n-\t    gcc_cv_as_gstabs_flag=\"no\"\n-\t  fi\n-\tfi\n-\trm -f conftest.s conftest.o\n-fi\n-if test x\"$gcc_cv_as_gstabs_flag\" = xyes; then\n-\tAC_DEFINE(HAVE_AS_GSTABS_DEBUG_FLAG, 1,\n-[Define if your assembler supports the --gstabs option.])\n-fi\n-AC_MSG_RESULT($gcc_cv_as_gstabs_flag)\n \n AC_MSG_CHECKING(linker read-only and read-write section mixing)\n gcc_cv_ld_ro_rw_mix=unknown\n@@ -2716,33 +2461,13 @@ case \"$target\" in\n         [Define if your MIPS libgloss linker scripts consistently include STARTUP directives.])\n     fi\n     AC_MSG_RESULT($gcc_cv_mips_libgloss_startup)\n-\n-    AC_MSG_CHECKING(whether the assembler has explicit relocation support)\n-    if test x$gcc_cv_mips_explicit_relocs = x; then\n-      gcc_cv_mips_explicit_relocs=no\n-      if test $in_tree_gas = yes; then\n-        gcc_GAS_VERSION_GTE_IFELSE(2,14,0,[\n-\t  gcc_cv_mips_explicit_relocs=yes\n-\t])\n-      elif test x$gcc_cv_as != x; then\n-\techo '  lw $4,%gp_rel(foo)($4)' > conftest.s\n-\tif $gcc_cv_as conftest.s -o conftest.o > /dev/null 2>&1; then\n-\t  gcc_cv_mips_explicit_relocs=yes\n-\tfi\n-\trm -f conftest.s conftest.o\n-      fi\n-    fi\n-    if test $gcc_cv_mips_explicit_relocs = yes; then\n-      test x$target_cpu_default != x || target_cpu_default=0\n-      target_cpu_default=\"(${target_cpu_default}|MASK_EXPLICIT_RELOCS)\"\n-    fi\n-    AC_MSG_RESULT($gcc_cv_mips_explicit_relocs)\n     ;;\n esac\n \n if test x$with_sysroot = x && test x$host = x$target \\\n    && test \"$prefix\" != \"/usr\" && test \"x$prefix\" != \"x$local_prefix\" ; then\n-  AC_DEFINE_UNQUOTED(PREFIX_INCLUDE_DIR, \"$prefix/include\")\n+  AC_DEFINE_UNQUOTED(PREFIX_INCLUDE_DIR, \"$prefix/include\",\n+[Define to PREFIX/include if cpp should also search that directory.])\n fi\n \n # Figure out what language subdirectories are present."}]}