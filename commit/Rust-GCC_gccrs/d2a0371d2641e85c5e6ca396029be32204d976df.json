{"sha": "d2a0371d2641e85c5e6ca396029be32204d976df", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6ZDJhMDM3MWQyNjQxZTg1YzVlNmNhMzk2MDI5YmUzMjIwNGQ5NzZkZg==", "commit": {"author": {"name": "Jan Hubicka", "email": "hubicka@ucw.cz", "date": "2019-04-14T20:56:45Z"}, "committer": {"name": "Jan Hubicka", "email": "hubicka@gcc.gnu.org", "date": "2019-04-14T20:56:45Z"}, "message": "re PR lto/89358 (Combining -std=c++14 and -std=c++17 objects gives ODR warnings)\n\n\n\tPR lto/89358\n\t* g++.dg/lto/pr89358_0.C: New testcase.\n\t* g++.dg/lto/pr89358_1.C: New testcase.\n\t* ipa-devirt.c (skip_in_fields_list_p): New.\n\t(odr_types_equivalent_p): Use it.\n\nFrom-SVN: r270355", "tree": {"sha": "fb74dc5db596afc26879acc34a23a9f9156a6f86", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/fb74dc5db596afc26879acc34a23a9f9156a6f86"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/d2a0371d2641e85c5e6ca396029be32204d976df", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/d2a0371d2641e85c5e6ca396029be32204d976df", "html_url": "https://github.com/Rust-GCC/gccrs/commit/d2a0371d2641e85c5e6ca396029be32204d976df", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/d2a0371d2641e85c5e6ca396029be32204d976df/comments", "author": null, "committer": null, "parents": [{"sha": "ceae614e1debf582340fe73ca350db93966b24bb", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/ceae614e1debf582340fe73ca350db93966b24bb", "html_url": "https://github.com/Rust-GCC/gccrs/commit/ceae614e1debf582340fe73ca350db93966b24bb"}], "stats": {"total": 52, "additions": 50, "deletions": 2}, "files": [{"sha": "a41417bbcbd58a3de8591414805c89f45dccd422", "filename": "gcc/ChangeLog", "status": "modified", "additions": 6, "deletions": 0, "changes": 6, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/d2a0371d2641e85c5e6ca396029be32204d976df/gcc%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/d2a0371d2641e85c5e6ca396029be32204d976df/gcc%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2FChangeLog?ref=d2a0371d2641e85c5e6ca396029be32204d976df", "patch": "@@ -1,3 +1,9 @@\n+2019-04-14  Jan Hubicka  <hubicka@ucw.cz>\n+\n+\tPR lto/89358\n+\t* ipa-devirt.c (skip_in_fields_list_p): New.\n+\t(odr_types_equivalent_p): Use it.\n+\n 2019-04-13  Jakub Jelinek  <jakub@redhat.com>\n \n \tPR target/89093"}, {"sha": "defa2ed3a5dc95bbd8411be1d04b8037bc9f9212", "filename": "gcc/ipa-devirt.c", "status": "modified", "additions": 20, "deletions": 2, "changes": 22, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/d2a0371d2641e85c5e6ca396029be32204d976df/gcc%2Fipa-devirt.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/d2a0371d2641e85c5e6ca396029be32204d976df/gcc%2Fipa-devirt.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fipa-devirt.c?ref=d2a0371d2641e85c5e6ca396029be32204d976df", "patch": "@@ -1282,6 +1282,24 @@ warn_types_mismatch (tree t1, tree t2, location_t loc1, location_t loc2)\n     inform (loc_t2, \"the incompatible type is defined here\");\n }\n \n+/* Return true if T should be ignored in TYPE_FIELDS for ODR comparsion.  */\n+\n+static bool\n+skip_in_fields_list_p (tree t)\n+{\n+  if (TREE_CODE (t) != FIELD_DECL)\n+    return true;\n+  /* C++ FE introduces zero sized fields depending on -std setting, see\n+     PR89358.  */\n+  if (DECL_SIZE (t)\n+      && integer_zerop (DECL_SIZE (t))\n+      && DECL_ARTIFICIAL (t)\n+      && DECL_IGNORED_P (t)\n+      && !DECL_NAME (t))\n+    return true;\n+  return false;\n+}\n+\n /* Compare T1 and T2, report ODR violations if WARN is true and set\n    WARNED to true if anything is reported.  Return true if types match.\n    If true is returned, the types are also compatible in the sense of\n@@ -1548,9 +1566,9 @@ odr_types_equivalent_p (tree t1, tree t2, bool warn, bool *warned,\n \t\t f1 = TREE_CHAIN (f1), f2 = TREE_CHAIN (f2))\n \t      {\n \t\t/* Skip non-fields.  */\n-\t\twhile (f1 && TREE_CODE (f1) != FIELD_DECL)\n+\t\twhile (f1 && skip_in_fields_list_p (f1))\n \t\t  f1 = TREE_CHAIN (f1);\n-\t\twhile (f2 && TREE_CODE (f2) != FIELD_DECL)\n+\t\twhile (f2 && skip_in_fields_list_p (f2))\n \t\t  f2 = TREE_CHAIN (f2);\n \t\tif (!f1 || !f2)\n \t\t  break;"}, {"sha": "8055780aaa18810ca329d433b87547ece0bb31db", "filename": "gcc/testsuite/ChangeLog", "status": "modified", "additions": 6, "deletions": 0, "changes": 6, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/d2a0371d2641e85c5e6ca396029be32204d976df/gcc%2Ftestsuite%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/d2a0371d2641e85c5e6ca396029be32204d976df/gcc%2Ftestsuite%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2FChangeLog?ref=d2a0371d2641e85c5e6ca396029be32204d976df", "patch": "@@ -1,3 +1,9 @@\n+2019-04-14  Jan Hubicka  <hubicka@ucw.cz>\n+\n+\tPR lto/89358\n+\t* g++.dg/lto/pr89358_0.C: New testcase.\n+\t* g++.dg/lto/pr89358_1.C: New testcase.\n+\n 2019-04-14  Thomas Koenig  <tkoenig@gcc.gnu.org>\n \n \tPR fortran/85448"}, {"sha": "aebd2127c0cf5308b81923f16adcea4d7c16b07d", "filename": "gcc/testsuite/g++.dg/lto/pr89358_0.C", "status": "added", "additions": 11, "deletions": 0, "changes": 11, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/d2a0371d2641e85c5e6ca396029be32204d976df/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Flto%2Fpr89358_0.C", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/d2a0371d2641e85c5e6ca396029be32204d976df/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Flto%2Fpr89358_0.C", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Flto%2Fpr89358_0.C?ref=d2a0371d2641e85c5e6ca396029be32204d976df", "patch": "@@ -0,0 +1,11 @@\n+/* { dg-do link } */\n+/* { dg-options \"-std=c++17\"  } */\n+#include <map>\n+\n+extern void test();\n+\n+int main()\n+{\n+        std::map<int, int> m;\n+        test();\n+}"}, {"sha": "68b80a37662380d18626e853cb329270e3e7bd12", "filename": "gcc/testsuite/g++.dg/lto/pr89358_1.C", "status": "added", "additions": 7, "deletions": 0, "changes": 7, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/d2a0371d2641e85c5e6ca396029be32204d976df/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Flto%2Fpr89358_1.C", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/d2a0371d2641e85c5e6ca396029be32204d976df/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Flto%2Fpr89358_1.C", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Flto%2Fpr89358_1.C?ref=d2a0371d2641e85c5e6ca396029be32204d976df", "patch": "@@ -0,0 +1,7 @@\n+/* { dg-options \"-std=c++14\"  } */\n+#include <map>\n+\n+void test()\n+{\n+        std::map<int, int> m;\n+}"}]}