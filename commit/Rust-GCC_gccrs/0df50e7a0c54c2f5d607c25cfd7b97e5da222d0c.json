{"sha": "0df50e7a0c54c2f5d607c25cfd7b97e5da222d0c", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6MGRmNTBlN2EwYzU0YzJmNWQ2MDdjMjVjZmQ3Yjk3ZTVkYTIyMmQwYw==", "commit": {"author": {"name": "Francois-Xavier Coudert", "email": "fxcoudert@gcc.gnu.org", "date": "2007-11-21T18:32:40Z"}, "committer": {"name": "Fran\u00e7ois-Xavier Coudert", "email": "fxcoudert@gcc.gnu.org", "date": "2007-11-21T18:32:40Z"}, "message": "re PR fortran/34083 (internal compiler error: in gfc_conv_array_constructor_expr, at fortran/trans-expr.c:2819)\n\n\tPR fortran/34083\n\n\t* resolve.c (resolve_structure_cons): Also check for zero rank.\n\n\t* gfortran.dg/derived_constructor_comps_2.f90: Add check.\n\nFrom-SVN: r130332", "tree": {"sha": "b686db35b0db0fd1df24395b4a72da636f5547ba", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/b686db35b0db0fd1df24395b4a72da636f5547ba"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/0df50e7a0c54c2f5d607c25cfd7b97e5da222d0c", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/0df50e7a0c54c2f5d607c25cfd7b97e5da222d0c", "html_url": "https://github.com/Rust-GCC/gccrs/commit/0df50e7a0c54c2f5d607c25cfd7b97e5da222d0c", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/0df50e7a0c54c2f5d607c25cfd7b97e5da222d0c/comments", "author": {"login": "fxcoudert", "id": 1980544, "node_id": "MDQ6VXNlcjE5ODA1NDQ=", "avatar_url": "https://avatars.githubusercontent.com/u/1980544?v=4", "gravatar_id": "", "url": "https://api.github.com/users/fxcoudert", "html_url": "https://github.com/fxcoudert", "followers_url": "https://api.github.com/users/fxcoudert/followers", "following_url": "https://api.github.com/users/fxcoudert/following{/other_user}", "gists_url": "https://api.github.com/users/fxcoudert/gists{/gist_id}", "starred_url": "https://api.github.com/users/fxcoudert/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/fxcoudert/subscriptions", "organizations_url": "https://api.github.com/users/fxcoudert/orgs", "repos_url": "https://api.github.com/users/fxcoudert/repos", "events_url": "https://api.github.com/users/fxcoudert/events{/privacy}", "received_events_url": "https://api.github.com/users/fxcoudert/received_events", "type": "User", "site_admin": false}, "committer": {"login": "fxcoudert", "id": 1980544, "node_id": "MDQ6VXNlcjE5ODA1NDQ=", "avatar_url": "https://avatars.githubusercontent.com/u/1980544?v=4", "gravatar_id": "", "url": "https://api.github.com/users/fxcoudert", "html_url": "https://github.com/fxcoudert", "followers_url": "https://api.github.com/users/fxcoudert/followers", "following_url": "https://api.github.com/users/fxcoudert/following{/other_user}", "gists_url": "https://api.github.com/users/fxcoudert/gists{/gist_id}", "starred_url": "https://api.github.com/users/fxcoudert/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/fxcoudert/subscriptions", "organizations_url": "https://api.github.com/users/fxcoudert/orgs", "repos_url": "https://api.github.com/users/fxcoudert/repos", "events_url": "https://api.github.com/users/fxcoudert/events{/privacy}", "received_events_url": "https://api.github.com/users/fxcoudert/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "c60cd1dcf7a8c5d20ad41ba781d562ebc5dca45c", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/c60cd1dcf7a8c5d20ad41ba781d562ebc5dca45c", "html_url": "https://github.com/Rust-GCC/gccrs/commit/c60cd1dcf7a8c5d20ad41ba781d562ebc5dca45c"}], "stats": {"total": 30, "additions": 27, "deletions": 3}, "files": [{"sha": "74e5df01bb7f3d130be304b4c386980f24a8831f", "filename": "gcc/fortran/ChangeLog", "status": "modified", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/0df50e7a0c54c2f5d607c25cfd7b97e5da222d0c/gcc%2Ffortran%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/0df50e7a0c54c2f5d607c25cfd7b97e5da222d0c/gcc%2Ffortran%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ffortran%2FChangeLog?ref=0df50e7a0c54c2f5d607c25cfd7b97e5da222d0c", "patch": "@@ -1,3 +1,8 @@\n+2007-11-21  Francois-Xavier Coudert  <fxcoudert@gcc.gnu.org>\n+\n+\tPR fortran/34083\n+\t* resolve.c (resolve_structure_cons): Also check for zero rank.\n+\n 2007-11-19  Jerry DeLisle  <jvdelisle@gcc.gnu.org>\n \n \tPR fortran/33317"}, {"sha": "c6808eb1f216b18246d7a7b4c0c04ebff82bd5f7", "filename": "gcc/fortran/resolve.c", "status": "modified", "additions": 5, "deletions": 3, "changes": 8, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/0df50e7a0c54c2f5d607c25cfd7b97e5da222d0c/gcc%2Ffortran%2Fresolve.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/0df50e7a0c54c2f5d607c25cfd7b97e5da222d0c/gcc%2Ffortran%2Fresolve.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ffortran%2Fresolve.c?ref=0df50e7a0c54c2f5d607c25cfd7b97e5da222d0c", "patch": "@@ -742,6 +742,8 @@ resolve_structure_cons (gfc_expr *expr)\n \n   for (; comp; comp = comp->next, cons = cons->next)\n     {\n+      int rank;\n+\n       if (!cons->expr)\n \tcontinue;\n \n@@ -751,14 +753,14 @@ resolve_structure_cons (gfc_expr *expr)\n \t  continue;\n \t}\n \n-      if (cons->expr->expr_type != EXPR_NULL\n-\t  && comp->as && comp->as->rank != cons->expr->rank\n+      rank = comp->as ? comp->as->rank : 0;\n+      if (cons->expr->expr_type != EXPR_NULL && rank != cons->expr->rank\n \t  && (comp->allocatable || cons->expr->rank))\n \t{\n \t  gfc_error (\"The rank of the element in the derived type \"\n \t\t     \"constructor at %L does not match that of the \"\n \t\t     \"component (%d/%d)\", &cons->expr->where,\n-\t\t     cons->expr->rank, comp->as ? comp->as->rank : 0);\n+\t\t     cons->expr->rank, rank);\n \t  t = FAILURE;\n \t}\n "}, {"sha": "ff241baebf651d999d76ca13591f776924909f0c", "filename": "gcc/testsuite/ChangeLog", "status": "modified", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/0df50e7a0c54c2f5d607c25cfd7b97e5da222d0c/gcc%2Ftestsuite%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/0df50e7a0c54c2f5d607c25cfd7b97e5da222d0c/gcc%2Ftestsuite%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2FChangeLog?ref=0df50e7a0c54c2f5d607c25cfd7b97e5da222d0c", "patch": "@@ -1,3 +1,8 @@\n+2007-11-21  Francois-Xavier Coudert  <fxcoudert@gcc.gnu.org>\n+\n+\tPR fortran/34083\n+\t* gfortran.dg/derived_constructor_comps_2.f90: Add check.\n+\n 2007-11-20  Richard Guenther  <rguenther@suse.de>\n \n \tPR middle-end/34154"}, {"sha": "ef3005da294ccaf6f9ade49440d1d63e3dc84aaf", "filename": "gcc/testsuite/gfortran.dg/derived_constructor_comps_2.f90", "status": "modified", "additions": 12, "deletions": 0, "changes": 12, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/0df50e7a0c54c2f5d607c25cfd7b97e5da222d0c/gcc%2Ftestsuite%2Fgfortran.dg%2Fderived_constructor_comps_2.f90", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/0df50e7a0c54c2f5d607c25cfd7b97e5da222d0c/gcc%2Ftestsuite%2Fgfortran.dg%2Fderived_constructor_comps_2.f90", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgfortran.dg%2Fderived_constructor_comps_2.f90?ref=0df50e7a0c54c2f5d607c25cfd7b97e5da222d0c", "patch": "@@ -13,3 +13,15 @@\n   marge = homer (duff_beer) ! { dg-error \"should be a POINTER or a TARGET\" }\n end\n \n+!\n+! The following yield an ICE, see PR 34083\n+!\n+subroutine foo\n+  type ByteType\n+    character(len=1) :: singleByte\n+  end type\n+  type (ByteType) :: bytes(4)\n+\n+  print *, size(bytes)\n+  bytes = ByteType((/'H', 'i', '!', ' '/)) ! { dg-error \"rank of the element in the derived type constructor\" }\n+end subroutine foo"}]}