{"sha": "d51151b2f4284ee26ceca0944a34b7763335eee4", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6ZDUxMTUxYjJmNDI4NGVlMjZjZWNhMDk0NGEzNGI3NzYzMzM1ZWVlNA==", "commit": {"author": {"name": "Jakub Jelinek", "email": "jakub@redhat.com", "date": "2015-02-09T21:23:58Z"}, "committer": {"name": "Jakub Jelinek", "email": "jakub@gcc.gnu.org", "date": "2015-02-09T21:23:58Z"}, "message": "re PR sanitizer/64981 (-fsanitize=address cant expand __builtin_ia32_rdtsc)\n\n\tPR sanitizer/64981\n\t* builtins.c (expand_builtin): Call targetm.expand_builtin\n\tfor BUILT_IN_MD builtins regardless of asan_intercepted_p.\n\n\t* gcc.dg/asan/pr64981.c: New test.\n\nFrom-SVN: r220551", "tree": {"sha": "1ca21e0d206ad1ed93a5fbce4c51308411f4589d", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/1ca21e0d206ad1ed93a5fbce4c51308411f4589d"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/d51151b2f4284ee26ceca0944a34b7763335eee4", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/d51151b2f4284ee26ceca0944a34b7763335eee4", "html_url": "https://github.com/Rust-GCC/gccrs/commit/d51151b2f4284ee26ceca0944a34b7763335eee4", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/d51151b2f4284ee26ceca0944a34b7763335eee4/comments", "author": {"login": "jakubjelinek", "id": 9370665, "node_id": "MDQ6VXNlcjkzNzA2NjU=", "avatar_url": "https://avatars.githubusercontent.com/u/9370665?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jakubjelinek", "html_url": "https://github.com/jakubjelinek", "followers_url": "https://api.github.com/users/jakubjelinek/followers", "following_url": "https://api.github.com/users/jakubjelinek/following{/other_user}", "gists_url": "https://api.github.com/users/jakubjelinek/gists{/gist_id}", "starred_url": "https://api.github.com/users/jakubjelinek/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jakubjelinek/subscriptions", "organizations_url": "https://api.github.com/users/jakubjelinek/orgs", "repos_url": "https://api.github.com/users/jakubjelinek/repos", "events_url": "https://api.github.com/users/jakubjelinek/events{/privacy}", "received_events_url": "https://api.github.com/users/jakubjelinek/received_events", "type": "User", "site_admin": false}, "committer": null, "parents": [{"sha": "c3e38a03df5f6074fd83d06c2c8d7393b0446026", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/c3e38a03df5f6074fd83d06c2c8d7393b0446026", "html_url": "https://github.com/Rust-GCC/gccrs/commit/c3e38a03df5f6074fd83d06c2c8d7393b0446026"}], "stats": {"total": 29, "additions": 26, "deletions": 3}, "files": [{"sha": "328c37d030398b3080dc7f1ca6d04d7935413513", "filename": "gcc/ChangeLog", "status": "modified", "additions": 6, "deletions": 0, "changes": 6, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/d51151b2f4284ee26ceca0944a34b7763335eee4/gcc%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/d51151b2f4284ee26ceca0944a34b7763335eee4/gcc%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2FChangeLog?ref=d51151b2f4284ee26ceca0944a34b7763335eee4", "patch": "@@ -1,3 +1,9 @@\n+2015-02-09  Jakub Jelinek  <jakub@redhat.com>\n+\n+\tPR sanitizer/64981\n+\t* builtins.c (expand_builtin): Call targetm.expand_builtin\n+\tfor BUILT_IN_MD builtins regardless of asan_intercepted_p.\n+\n 2015-02-08  Jan Hubicka  <hubicka@ucw.cz>\n \n \tPR ipa/61548"}, {"sha": "8f3c0bc22b30541310b1bfa453820cfee2341b0d", "filename": "gcc/builtins.c", "status": "modified", "additions": 3, "deletions": 3, "changes": 6, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/d51151b2f4284ee26ceca0944a34b7763335eee4/gcc%2Fbuiltins.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/d51151b2f4284ee26ceca0944a34b7763335eee4/gcc%2Fbuiltins.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fbuiltins.c?ref=d51151b2f4284ee26ceca0944a34b7763335eee4", "patch": "@@ -5960,6 +5960,9 @@ expand_builtin (tree exp, rtx target, rtx subtarget, machine_mode mode,\n   machine_mode target_mode = TYPE_MODE (TREE_TYPE (exp));\n   int flags;\n \n+  if (DECL_BUILT_IN_CLASS (fndecl) == BUILT_IN_MD)\n+    return targetm.expand_builtin (exp, target, subtarget, mode, ignore);\n+\n   /* When ASan is enabled, we don't want to expand some memory/string\n      builtins and rely on libsanitizer's hooks.  This allows us to avoid\n      redundant checks and be sure, that possible overflow will be detected\n@@ -5968,9 +5971,6 @@ expand_builtin (tree exp, rtx target, rtx subtarget, machine_mode mode,\n   if ((flag_sanitize & SANITIZE_ADDRESS) && asan_intercepted_p (fcode))\n     return expand_call (exp, target, ignore);\n \n-  if (DECL_BUILT_IN_CLASS (fndecl) == BUILT_IN_MD)\n-    return targetm.expand_builtin (exp, target, subtarget, mode, ignore);\n-\n   /* When not optimizing, generate calls to library functions for a certain\n      set of builtins.  */\n   if (!optimize"}, {"sha": "67f1e8e5355109d1d1ebe1184357647f64318af2", "filename": "gcc/testsuite/ChangeLog", "status": "modified", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/d51151b2f4284ee26ceca0944a34b7763335eee4/gcc%2Ftestsuite%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/d51151b2f4284ee26ceca0944a34b7763335eee4/gcc%2Ftestsuite%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2FChangeLog?ref=d51151b2f4284ee26ceca0944a34b7763335eee4", "patch": "@@ -1,3 +1,8 @@\n+2015-02-09  Jakub Jelinek  <jakub@redhat.com>\n+\n+\tPR sanitizer/64981\n+\t* gcc.dg/asan/pr64981.c: New test.\n+\n 2015-02-09  Marek Polacek  <polacek@redhat.com>\n \n \tPR c/64856"}, {"sha": "85e34794e4e517d96a3fac7e4917e83dcddfaf82", "filename": "gcc/testsuite/gcc.dg/asan/pr64981.c", "status": "added", "additions": 12, "deletions": 0, "changes": 12, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/d51151b2f4284ee26ceca0944a34b7763335eee4/gcc%2Ftestsuite%2Fgcc.dg%2Fasan%2Fpr64981.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/d51151b2f4284ee26ceca0944a34b7763335eee4/gcc%2Ftestsuite%2Fgcc.dg%2Fasan%2Fpr64981.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgcc.dg%2Fasan%2Fpr64981.c?ref=d51151b2f4284ee26ceca0944a34b7763335eee4", "patch": "@@ -0,0 +1,12 @@\n+/* PR sanitizer/64981 */\n+/* { dg-do compile { target { i?86-*-* x86_64-*-* } } } */\n+/* { dg-options \"-fsanitize=address -march=x86-64\" } */\n+\n+int\n+main ()\n+{\n+  __builtin_ia32_rdtsc ();\n+  return 0;\n+}\n+\n+/* { dg-final { scan-assembler-not \"__builtin_ia32_rdtsc\" } } */"}]}