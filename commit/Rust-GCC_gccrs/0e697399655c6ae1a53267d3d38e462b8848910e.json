{"sha": "0e697399655c6ae1a53267d3d38e462b8848910e", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6MGU2OTczOTk2NTVjNmFlMWE1MzI2N2QzZDM4ZTQ2MmI4ODQ4OTEwZQ==", "commit": {"author": {"name": "Andrew Pinski", "email": "pinskia@gmail.com", "date": "2006-10-30T16:15:09Z"}, "committer": {"name": "Andrew Pinski", "email": "pinskia@gcc.gnu.org", "date": "2006-10-30T16:15:09Z"}, "message": "re PR fortran/29410 ([4.2 only] bug with TRANSFER() and -O2)\n\n2006-10-30  Andrew Pinski  <pinskia@gmail.com>\n\n        PR fortran/29410\n        * trans-intrinsic.c (gfc_conv_intrinsic_array_transfer):\n        Change over to create VIEW_CONVERT_EXPR instead of using an\n        ADDR_EXPR, a cast and then an indirect reference\n2006-10-30  Andrew Pinski  <pinskia@gmail.com>\n\n        PR Fortran/29410\n        * gfortran.fortran-torture/execute/transfer1.f90: New test.\n\nFrom-SVN: r118186", "tree": {"sha": "a627b06af6dec5b97093fe2b8d55d7d273615ce4", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/a627b06af6dec5b97093fe2b8d55d7d273615ce4"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/0e697399655c6ae1a53267d3d38e462b8848910e", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/0e697399655c6ae1a53267d3d38e462b8848910e", "html_url": "https://github.com/Rust-GCC/gccrs/commit/0e697399655c6ae1a53267d3d38e462b8848910e", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/0e697399655c6ae1a53267d3d38e462b8848910e/comments", "author": {"login": "pinskia", "id": 8496799, "node_id": "MDQ6VXNlcjg0OTY3OTk=", "avatar_url": "https://avatars.githubusercontent.com/u/8496799?v=4", "gravatar_id": "", "url": "https://api.github.com/users/pinskia", "html_url": "https://github.com/pinskia", "followers_url": "https://api.github.com/users/pinskia/followers", "following_url": "https://api.github.com/users/pinskia/following{/other_user}", "gists_url": "https://api.github.com/users/pinskia/gists{/gist_id}", "starred_url": "https://api.github.com/users/pinskia/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/pinskia/subscriptions", "organizations_url": "https://api.github.com/users/pinskia/orgs", "repos_url": "https://api.github.com/users/pinskia/repos", "events_url": "https://api.github.com/users/pinskia/events{/privacy}", "received_events_url": "https://api.github.com/users/pinskia/received_events", "type": "User", "site_admin": false}, "committer": null, "parents": [{"sha": "ff84991f990cfd20fd24331701912f78427f83ae", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/ff84991f990cfd20fd24331701912f78427f83ae", "html_url": "https://github.com/Rust-GCC/gccrs/commit/ff84991f990cfd20fd24331701912f78427f83ae"}], "stats": {"total": 29, "additions": 26, "deletions": 3}, "files": [{"sha": "25ace324b40486d76491a18857b3abc4eda715fd", "filename": "gcc/fortran/ChangeLog", "status": "modified", "additions": 7, "deletions": 0, "changes": 7, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/0e697399655c6ae1a53267d3d38e462b8848910e/gcc%2Ffortran%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/0e697399655c6ae1a53267d3d38e462b8848910e/gcc%2Ffortran%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ffortran%2FChangeLog?ref=0e697399655c6ae1a53267d3d38e462b8848910e", "patch": "@@ -1,3 +1,10 @@\n+2006-10-30  Andrew Pinski  <pinskia@gmail.com>\n+\n+\tPR fortran/29410\n+\t* trans-intrinsic.c (gfc_conv_intrinsic_array_transfer):\n+\tChange over to create VIEW_CONVERT_EXPR instead of using an\n+\tADDR_EXPR, a cast and then an indirect reference\n+\n 2006-10-29  Francois-Xavier Coudert  <coudert@clipper.ens.fr>\n \n \t* trans-intrinsic.c (gfc_conv_intrinsic_loc): Make LOC return a"}, {"sha": "44d439d01ce8b24ec1804216248cb1528062ad35", "filename": "gcc/fortran/trans-intrinsic.c", "status": "modified", "additions": 4, "deletions": 3, "changes": 7, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/0e697399655c6ae1a53267d3d38e462b8848910e/gcc%2Ffortran%2Ftrans-intrinsic.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/0e697399655c6ae1a53267d3d38e462b8848910e/gcc%2Ffortran%2Ftrans-intrinsic.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ffortran%2Ftrans-intrinsic.c?ref=0e697399655c6ae1a53267d3d38e462b8848910e", "patch": "@@ -2914,7 +2914,7 @@ gfc_conv_intrinsic_array_transfer (gfc_se * se, gfc_expr * expr)\n \n \n /* Scalar transfer statement.\n-   TRANSFER (source, mold) = *(typeof<mold> *)&source.  */\n+   TRANSFER (source, mold) = VIEW_CONVERT_EXPR<typeof<mold> >source.  */\n \n static void\n gfc_conv_intrinsic_transfer (gfc_se * se, gfc_expr * expr)\n@@ -2939,9 +2939,9 @@ gfc_conv_intrinsic_transfer (gfc_se * se, gfc_expr * expr)\n \n   arg = arg->next;\n   type = gfc_typenode_for_spec (&expr->ts);\n-  ptr = convert (build_pointer_type (type), ptr);\n   if (expr->ts.type == BT_CHARACTER)\n     {\n+      ptr = convert (build_pointer_type (type), ptr);\n       gfc_init_se (&argse, NULL);\n       gfc_conv_expr (&argse, arg->expr);\n       gfc_add_block_to_block (&se->pre, &argse.pre);\n@@ -2951,7 +2951,8 @@ gfc_conv_intrinsic_transfer (gfc_se * se, gfc_expr * expr)\n     }\n   else\n     {\n-      se->expr = build_fold_indirect_ref (ptr);\n+      tree tmp = build_fold_indirect_ref (ptr);\n+      se->expr = fold_build1 (VIEW_CONVERT_EXPR, type, tmp);\n     }\n }\n "}, {"sha": "f8876e353d7da0ef3333006296f300a8470cc80a", "filename": "gcc/testsuite/ChangeLog", "status": "modified", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/0e697399655c6ae1a53267d3d38e462b8848910e/gcc%2Ftestsuite%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/0e697399655c6ae1a53267d3d38e462b8848910e/gcc%2Ftestsuite%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2FChangeLog?ref=0e697399655c6ae1a53267d3d38e462b8848910e", "patch": "@@ -1,3 +1,8 @@\n+2006-10-30  Andrew Pinski  <pinskia@gmail.com>\n+\n+\tPR Fortran/29410\n+\t* gfortran.fortran-torture/execute/transfer1.f90: New test.\n+\n 2006-10-30  Joseph Myers  <joseph@codesourcery.com>\n \n \t* lib/target-supports.exp (check_function_available): Declare"}, {"sha": "855fe9df17afe9fc18162063227e14449afc4655", "filename": "gcc/testsuite/gfortran.fortran-torture/execute/transfer1.f90", "status": "added", "additions": 10, "deletions": 0, "changes": 10, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/0e697399655c6ae1a53267d3d38e462b8848910e/gcc%2Ftestsuite%2Fgfortran.fortran-torture%2Fexecute%2Ftransfer1.f90", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/0e697399655c6ae1a53267d3d38e462b8848910e/gcc%2Ftestsuite%2Fgfortran.fortran-torture%2Fexecute%2Ftransfer1.f90", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgfortran.fortran-torture%2Fexecute%2Ftransfer1.f90?ref=0e697399655c6ae1a53267d3d38e462b8848910e", "patch": "@@ -0,0 +1,10 @@\n+program chop\n+  integer ix, iy\n+  real x, y\n+  x = 1.\n+  y = x\n+  ix = transfer(x,ix)\n+  iy = transfer(y,iy)\n+  print '(2z20.8)', ix, iy\n+  if (ix /= iy) call abort\n+end program chop"}]}