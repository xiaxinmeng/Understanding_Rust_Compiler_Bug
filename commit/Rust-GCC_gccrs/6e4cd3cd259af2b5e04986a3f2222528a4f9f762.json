{"sha": "6e4cd3cd259af2b5e04986a3f2222528a4f9f762", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6NmU0Y2QzY2QyNTlhZjJiNWUwNDk4NmEzZjIyMjI1MjhhNGY5Zjc2Mg==", "commit": {"author": {"name": "Jakub Jelinek", "email": "jakub@redhat.com", "date": "2020-03-25T18:06:45Z"}, "committer": {"name": "Jakub Jelinek", "email": "jakub@redhat.com", "date": "2020-03-25T18:06:45Z"}, "message": "arm: Fix ICE caused by arm_gen_dicompare_reg [PR94292]\n\nThe following testcase ICEs, because arm_gen_dicompare_reg creates invalid\nRTL which then propagates into DEBUG_INSNs and ICEs while handling them.\nThe problem is that this function emits\n(insn 18 17 19 2 (set (reg:CC_DNE 100 cc)\n        (compare (ior:SI (ne:SI (subreg:SI (reg:DI 129) 0)\n                    (subreg:SI (reg:DI 114 [ _2 ]) 0))\n                (ne:SI (subreg:SI (reg:DI 129) 4)\n                    (subreg:SI (reg:DI 114 [ _2 ]) 4)))\n            (const_int 0 [0]))) \"pr94292.c\":7:11 325 {*cmp_ior}\n     (nil))\nand the invalid thing is that the COMPARE has VOIDmode.  Setting a\nnon-VOIDmode SET_DEST to VOIDmode SET_SRC is only valid if the SET_SRC is\nCONST_INT/CONST_DOUBLE.\nThe following patch fixes it by giving the COMPARE the same mode as it gives\nto the SET_DEST cc register.\n\n2020-03-25  Jakub Jelinek  <jakub@redhat.com>\n\n\tPR target/94292\n\t* config/arm/arm.c (arm_gen_dicompare_reg): Set mode of COMPARE to\n\tmode rather than VOIDmode.\n\n\t* gcc.dg/pr94292.c: New test.", "tree": {"sha": "afd4ccab92b1baa6322728fc5eecf170fadde9fc", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/afd4ccab92b1baa6322728fc5eecf170fadde9fc"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/6e4cd3cd259af2b5e04986a3f2222528a4f9f762", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/6e4cd3cd259af2b5e04986a3f2222528a4f9f762", "html_url": "https://github.com/Rust-GCC/gccrs/commit/6e4cd3cd259af2b5e04986a3f2222528a4f9f762", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/6e4cd3cd259af2b5e04986a3f2222528a4f9f762/comments", "author": {"login": "jakubjelinek", "id": 9370665, "node_id": "MDQ6VXNlcjkzNzA2NjU=", "avatar_url": "https://avatars.githubusercontent.com/u/9370665?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jakubjelinek", "html_url": "https://github.com/jakubjelinek", "followers_url": "https://api.github.com/users/jakubjelinek/followers", "following_url": "https://api.github.com/users/jakubjelinek/following{/other_user}", "gists_url": "https://api.github.com/users/jakubjelinek/gists{/gist_id}", "starred_url": "https://api.github.com/users/jakubjelinek/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jakubjelinek/subscriptions", "organizations_url": "https://api.github.com/users/jakubjelinek/orgs", "repos_url": "https://api.github.com/users/jakubjelinek/repos", "events_url": "https://api.github.com/users/jakubjelinek/events{/privacy}", "received_events_url": "https://api.github.com/users/jakubjelinek/received_events", "type": "User", "site_admin": false}, "committer": {"login": "jakubjelinek", "id": 9370665, "node_id": "MDQ6VXNlcjkzNzA2NjU=", "avatar_url": "https://avatars.githubusercontent.com/u/9370665?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jakubjelinek", "html_url": "https://github.com/jakubjelinek", "followers_url": "https://api.github.com/users/jakubjelinek/followers", "following_url": "https://api.github.com/users/jakubjelinek/following{/other_user}", "gists_url": "https://api.github.com/users/jakubjelinek/gists{/gist_id}", "starred_url": "https://api.github.com/users/jakubjelinek/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jakubjelinek/subscriptions", "organizations_url": "https://api.github.com/users/jakubjelinek/orgs", "repos_url": "https://api.github.com/users/jakubjelinek/repos", "events_url": "https://api.github.com/users/jakubjelinek/events{/privacy}", "received_events_url": "https://api.github.com/users/jakubjelinek/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "b5228b1bc8cb81be494f5b5faa68b6b859ce0227", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/b5228b1bc8cb81be494f5b5faa68b6b859ce0227", "html_url": "https://github.com/Rust-GCC/gccrs/commit/b5228b1bc8cb81be494f5b5faa68b6b859ce0227"}], "stats": {"total": 26, "additions": 25, "deletions": 1}, "files": [{"sha": "06b06ab68de79bbc4ef9e2df3141661186f239c2", "filename": "gcc/ChangeLog", "status": "modified", "additions": 6, "deletions": 0, "changes": 6, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/6e4cd3cd259af2b5e04986a3f2222528a4f9f762/gcc%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/6e4cd3cd259af2b5e04986a3f2222528a4f9f762/gcc%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2FChangeLog?ref=6e4cd3cd259af2b5e04986a3f2222528a4f9f762", "patch": "@@ -1,3 +1,9 @@\n+2020-03-25  Jakub Jelinek  <jakub@redhat.com>\n+\n+\tPR target/94292\n+\t* config/arm/arm.c (arm_gen_dicompare_reg): Set mode of COMPARE to\n+\tmode rather than VOIDmode.\n+\n 2020-03-25  Martin Sebor  <msebor@redhat.com>\n \n \tPR middle-end/94004"}, {"sha": "d5207e0d8f07f9be5265fc6d175c148c6cdd53cb", "filename": "gcc/config/arm/arm.c", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/6e4cd3cd259af2b5e04986a3f2222528a4f9f762/gcc%2Fconfig%2Farm%2Farm.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/6e4cd3cd259af2b5e04986a3f2222528a4f9f762/gcc%2Fconfig%2Farm%2Farm.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fconfig%2Farm%2Farm.c?ref=6e4cd3cd259af2b5e04986a3f2222528a4f9f762", "patch": "@@ -15763,7 +15763,7 @@ arm_gen_dicompare_reg (rtx_code code, rtx x, rtx y, rtx scratch)\n \tcc_reg = gen_rtx_REG (mode, CC_REGNUM);\n \n \temit_insn (gen_rtx_SET (cc_reg,\n-\t\t\t\tgen_rtx_COMPARE (VOIDmode, conjunction,\n+\t\t\t\tgen_rtx_COMPARE (mode, conjunction,\n \t\t\t\t\t\t const0_rtx)));\n \treturn cc_reg;\n       }"}, {"sha": "fe8460c76647eafd094f77a19346ed61ad70d8a4", "filename": "gcc/testsuite/ChangeLog", "status": "modified", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/6e4cd3cd259af2b5e04986a3f2222528a4f9f762/gcc%2Ftestsuite%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/6e4cd3cd259af2b5e04986a3f2222528a4f9f762/gcc%2Ftestsuite%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2FChangeLog?ref=6e4cd3cd259af2b5e04986a3f2222528a4f9f762", "patch": "@@ -1,3 +1,8 @@\n+2020-03-25  Jakub Jelinek  <jakub@redhat.com>\n+\n+\tPR target/94292\n+\t* gcc.dg/pr94292.c: New test.\n+\n 2020-03-25  Martin Sebor  <msebor@redhat.com>\n \n \tPR middle-end/94004"}, {"sha": "dd2a29c066f3590e72a4c3883bda2615c81c9b7c", "filename": "gcc/testsuite/gcc.dg/pr94292.c", "status": "added", "additions": 13, "deletions": 0, "changes": 13, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/6e4cd3cd259af2b5e04986a3f2222528a4f9f762/gcc%2Ftestsuite%2Fgcc.dg%2Fpr94292.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/6e4cd3cd259af2b5e04986a3f2222528a4f9f762/gcc%2Ftestsuite%2Fgcc.dg%2Fpr94292.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgcc.dg%2Fpr94292.c?ref=6e4cd3cd259af2b5e04986a3f2222528a4f9f762", "patch": "@@ -0,0 +1,13 @@\n+/* PR target/94292 */\n+/* { dg-do compile } */\n+/* { dg-options \"-O1 -g -fno-tree-dce\" } */\n+\n+unsigned short a;\n+unsigned long long b;\n+\n+long long\n+foo (int d)\n+{\n+  d >>= a != (unsigned long long) -a;\n+  return a + b;\n+}"}]}