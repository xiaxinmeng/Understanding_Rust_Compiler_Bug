{"sha": "7d1496792bf96d5364e31b90656539ce3539c608", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6N2QxNDk2NzkyYmY5NmQ1MzY0ZTMxYjkwNjU2NTM5Y2UzNTM5YzYwOA==", "commit": {"author": {"name": "Aldy Hernandez", "email": "aldyh@redhat.com", "date": "2003-08-07T12:49:57Z"}, "committer": {"name": "Aldy Hernandez", "email": "aldyh@gcc.gnu.org", "date": "2003-08-07T12:49:57Z"}, "message": "Make-lang.in (cp/call.o): Add dependency for target.h.\n\n2003-08-07  Aldy Hernandez  <aldyh@redhat.com>\n\n\t* cp/Make-lang.in (cp/call.o): Add dependency for target.h.\n\n\t* cp/call.c (standard_conversion): Support opaque types.\n\tInclude target.h.\n\t(strip_top_quals): Use cp_build_qualified_type instead of\n\tTYPE_MAIN_VARIANT.\n\n\t* cp/typeck.c (convert_for_assignment): Support opaque types.\n\n\t* testsuite/g++.dg/other/opaque-1.C: New.\n\n\t* testsuite/g++.dg/other/opaque-2.C: New.\n\nFrom-SVN: r70223", "tree": {"sha": "f526fe69ca18f05fe4d77fb26284e92bd09419cf", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/f526fe69ca18f05fe4d77fb26284e92bd09419cf"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/7d1496792bf96d5364e31b90656539ce3539c608", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/7d1496792bf96d5364e31b90656539ce3539c608", "html_url": "https://github.com/Rust-GCC/gccrs/commit/7d1496792bf96d5364e31b90656539ce3539c608", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/7d1496792bf96d5364e31b90656539ce3539c608/comments", "author": {"login": "aldyh", "id": 12937877, "node_id": "MDQ6VXNlcjEyOTM3ODc3", "avatar_url": "https://avatars.githubusercontent.com/u/12937877?v=4", "gravatar_id": "", "url": "https://api.github.com/users/aldyh", "html_url": "https://github.com/aldyh", "followers_url": "https://api.github.com/users/aldyh/followers", "following_url": "https://api.github.com/users/aldyh/following{/other_user}", "gists_url": "https://api.github.com/users/aldyh/gists{/gist_id}", "starred_url": "https://api.github.com/users/aldyh/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/aldyh/subscriptions", "organizations_url": "https://api.github.com/users/aldyh/orgs", "repos_url": "https://api.github.com/users/aldyh/repos", "events_url": "https://api.github.com/users/aldyh/events{/privacy}", "received_events_url": "https://api.github.com/users/aldyh/received_events", "type": "User", "site_admin": false}, "committer": null, "parents": [{"sha": "d40c829f55c0b35e9b6ce9e9b7da9e6dc56a7941", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/d40c829f55c0b35e9b6ce9e9b7da9e6dc56a7941", "html_url": "https://github.com/Rust-GCC/gccrs/commit/d40c829f55c0b35e9b6ce9e9b7da9e6dc56a7941"}], "stats": {"total": 76, "additions": 74, "deletions": 2}, "files": [{"sha": "87f0107e023bc2f0ca9bd311cb0be71784317301", "filename": "gcc/cp/ChangeLog", "status": "modified", "additions": 15, "deletions": 0, "changes": 15, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/7d1496792bf96d5364e31b90656539ce3539c608/gcc%2Fcp%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/7d1496792bf96d5364e31b90656539ce3539c608/gcc%2Fcp%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fcp%2FChangeLog?ref=7d1496792bf96d5364e31b90656539ce3539c608", "patch": "@@ -1,3 +1,18 @@\n+2003-08-07  Aldy Hernandez  <aldyh@redhat.com>\n+\n+\t* cp/Make-lang.in (cp/call.o): Add dependency for target.h.\n+\n+\t* cp/call.c (standard_conversion): Support opaque types.\n+\tInclude target.h.\n+\t(strip_top_quals): Use cp_build_qualified_type instead of\n+\tTYPE_MAIN_VARIANT.\n+\n+\t* cp/typeck.c (convert_for_assignment): Support opaque types.\n+\n+\t* testsuite/g++.dg/other/opaque-1.C: New.\n+\n+\t* testsuite/g++.dg/other/opaque-2.C: New.\n+\n 2003-08-06  Aldy Hernandez  <aldyh@redhat.com>\n \n \t* decl.c (grokparms): Use cp_build_qualified_type instead"}, {"sha": "8ab0b5591f82a81c6f9047941375cf1b26b6fd85", "filename": "gcc/cp/Make-lang.in", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/7d1496792bf96d5364e31b90656539ce3539c608/gcc%2Fcp%2FMake-lang.in", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/7d1496792bf96d5364e31b90656539ce3539c608/gcc%2Fcp%2FMake-lang.in", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fcp%2FMake-lang.in?ref=7d1496792bf96d5364e31b90656539ce3539c608", "patch": "@@ -249,7 +249,7 @@ cp/typeck.o: cp/typeck.c $(CXX_TREE_H) $(TM_H) flags.h $(RTL_H) $(EXPR_H) toplev\n    diagnostic.h convert.h\n cp/class.o: cp/class.c $(CXX_TREE_H) $(TM_H) flags.h toplev.h $(RTL_H) $(TARGET_H) convert.h\n cp/call.o: cp/call.c $(CXX_TREE_H) $(TM_H) flags.h toplev.h $(RTL_H) $(EXPR_H) \\\n-     diagnostic.h intl.h gt-cp-call.h convert.h\n+     diagnostic.h intl.h gt-cp-call.h convert.h target.h\n cp/friend.o: cp/friend.c $(CXX_TREE_H) $(TM_H) flags.h $(RTL_H) toplev.h $(EXPR_H)\n cp/init.o: cp/init.c $(CXX_TREE_H) $(TM_H) flags.h $(RTL_H) $(EXPR_H) toplev.h \\\n   except.h"}, {"sha": "e77aaee84421d7b94603a86eb3481ecdd79213fb", "filename": "gcc/cp/call.c", "status": "modified", "additions": 6, "deletions": 1, "changes": 7, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/7d1496792bf96d5364e31b90656539ce3539c608/gcc%2Fcp%2Fcall.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/7d1496792bf96d5364e31b90656539ce3539c608/gcc%2Fcp%2Fcall.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fcp%2Fcall.c?ref=7d1496792bf96d5364e31b90656539ce3539c608", "patch": "@@ -37,6 +37,7 @@ Boston, MA 02111-1307, USA.  */\n #include \"expr.h\"\n #include \"diagnostic.h\"\n #include \"intl.h\"\n+#include \"target.h\"\n #include \"convert.h\"\n \n static tree build_field_call (tree, tree, tree);\n@@ -568,7 +569,7 @@ strip_top_quals (tree t)\n {\n   if (TREE_CODE (t) == ARRAY_TYPE)\n     return t;\n-  return TYPE_MAIN_VARIANT (t);\n+  return cp_build_qualified_type (t, 0);\n }\n \n /* Returns the standard conversion path (see [conv]) from type FROM to type\n@@ -792,6 +793,10 @@ standard_conversion (tree to, tree from, tree expr)\n \t  && ICS_STD_RANK (TREE_OPERAND (conv, 0)) <= PROMO_RANK)\n \tICS_STD_RANK (conv) = PROMO_RANK;\n     }\n+  else if (fcode == VECTOR_TYPE && tcode == VECTOR_TYPE\n+      && ((*targetm.vector_opaque_p) (from)\n+\t  || (*targetm.vector_opaque_p) (to)))\n+    return build_conv (STD_CONV, to, conv);\n   else if (IS_AGGR_TYPE (to) && IS_AGGR_TYPE (from)\n \t   && is_properly_derived_from (from, to))\n     {"}, {"sha": "5cb8ed4b113d8da4b7e1b05a7db890f6623548b1", "filename": "gcc/cp/typeck.c", "status": "modified", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/7d1496792bf96d5364e31b90656539ce3539c608/gcc%2Fcp%2Ftypeck.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/7d1496792bf96d5364e31b90656539ce3539c608/gcc%2Fcp%2Ftypeck.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fcp%2Ftypeck.c?ref=7d1496792bf96d5364e31b90656539ce3539c608", "patch": "@@ -5533,6 +5533,11 @@ convert_for_assignment (tree type, tree rhs,\n   rhstype = TREE_TYPE (rhs);\n   coder = TREE_CODE (rhstype);\n \n+  if (TREE_CODE (type) == VECTOR_TYPE && coder == VECTOR_TYPE\n+      && ((*targetm.vector_opaque_p) (type)\n+\t  || (*targetm.vector_opaque_p) (rhstype)))\n+    return convert (type, rhs);\n+\n   if (rhs == error_mark_node || rhstype == error_mark_node)\n     return error_mark_node;\n   if (TREE_CODE (rhs) == TREE_LIST && TREE_VALUE (rhs) == error_mark_node)"}, {"sha": "ad79bfa21b6f4cdde3475edc09468100de84de26", "filename": "gcc/testsuite/g++.dg/other/opaque-1.C", "status": "added", "additions": 29, "deletions": 0, "changes": 29, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/7d1496792bf96d5364e31b90656539ce3539c608/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Fother%2Fopaque-1.C", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/7d1496792bf96d5364e31b90656539ce3539c608/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Fother%2Fopaque-1.C", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Fother%2Fopaque-1.C?ref=7d1496792bf96d5364e31b90656539ce3539c608", "patch": "@@ -0,0 +1,29 @@\n+/* { dg-do run { target powerpc-*-eabispe* } } */\n+\n+#define __vector __attribute__((vector_size(8)))\n+typedef float __vector __ev64_fs__;\n+\n+__ev64_fs__ f;\n+__ev64_opaque__ o;\n+\n+int here = 0;\n+\n+void bar (__ev64_opaque__ x)\n+{\n+  here = 0;\n+}\n+\n+void bar (__ev64_fs__ x)\n+{ \n+  here = 888;\n+}\n+\n+int main ()\n+{\n+  f = o;\n+  o = f;\n+  bar (f);\n+  if (here != 888)\n+    return 1;\n+  return 0;\n+}"}, {"sha": "efe04e3df1bc946c03b5cb3f30c5f5cd5ea584ae", "filename": "gcc/testsuite/g++.dg/other/opaque-2.C", "status": "added", "additions": 18, "deletions": 0, "changes": 18, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/7d1496792bf96d5364e31b90656539ce3539c608/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Fother%2Fopaque-2.C", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/7d1496792bf96d5364e31b90656539ce3539c608/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Fother%2Fopaque-2.C", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Fother%2Fopaque-2.C?ref=7d1496792bf96d5364e31b90656539ce3539c608", "patch": "@@ -0,0 +1,18 @@\n+/* { dg-do compile { target powerpc-*-eabi* } } */\n+/* { dg-options \"-mcpu=8540 -mabi=spe\" } */\n+\n+#define __vector __attribute__((vector_size(8)))\n+typedef float __vector __ev64_fs__;\n+\n+__ev64_fs__ f;\n+__ev64_opaque__ o;\n+\n+extern void bar (__ev64_opaque__);\n+\n+int main ()\n+{\n+  f = o;\n+  o = f;\n+  bar (f);\n+  return 0;\n+}"}]}