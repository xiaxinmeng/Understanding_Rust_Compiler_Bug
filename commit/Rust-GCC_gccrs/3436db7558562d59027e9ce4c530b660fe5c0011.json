{"sha": "3436db7558562d59027e9ce4c530b660fe5c0011", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6MzQzNmRiNzU1ODU2MmQ1OTAyN2U5Y2U0YzUzMGI2NjBmZTVjMDAxMQ==", "commit": {"author": {"name": "Janus Weil", "email": "janus@gcc.gnu.org", "date": "2013-11-25T09:45:40Z"}, "committer": {"name": "Janus Weil", "email": "janus@gcc.gnu.org", "date": "2013-11-25T09:45:40Z"}, "message": "re PR fortran/59143 ([OOP] Bogus warning with array-valued type-bound procedure)\n\n2013-11-25  Janus Weil  <janus@gcc.gnu.org>\n\n\tPR fortran/59143\n\t* interface.c (get_expr_storage_size): Handle array-valued type-bound\n\tprocedures.\n\n2013-11-25  Janus Weil  <janus@gcc.gnu.org>\n\n\tPR fortran/59143\n\t* gfortran.dg/typebound_proc_30.f90: New.\n\nFrom-SVN: r205345", "tree": {"sha": "6c1218b6df0da65a7147f2d94d186b29707aa20d", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/6c1218b6df0da65a7147f2d94d186b29707aa20d"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/3436db7558562d59027e9ce4c530b660fe5c0011", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/3436db7558562d59027e9ce4c530b660fe5c0011", "html_url": "https://github.com/Rust-GCC/gccrs/commit/3436db7558562d59027e9ce4c530b660fe5c0011", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/3436db7558562d59027e9ce4c530b660fe5c0011/comments", "author": {"login": "janusw", "id": 484108, "node_id": "MDQ6VXNlcjQ4NDEwOA==", "avatar_url": "https://avatars.githubusercontent.com/u/484108?v=4", "gravatar_id": "", "url": "https://api.github.com/users/janusw", "html_url": "https://github.com/janusw", "followers_url": "https://api.github.com/users/janusw/followers", "following_url": "https://api.github.com/users/janusw/following{/other_user}", "gists_url": "https://api.github.com/users/janusw/gists{/gist_id}", "starred_url": "https://api.github.com/users/janusw/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/janusw/subscriptions", "organizations_url": "https://api.github.com/users/janusw/orgs", "repos_url": "https://api.github.com/users/janusw/repos", "events_url": "https://api.github.com/users/janusw/events{/privacy}", "received_events_url": "https://api.github.com/users/janusw/received_events", "type": "User", "site_admin": false}, "committer": {"login": "janusw", "id": 484108, "node_id": "MDQ6VXNlcjQ4NDEwOA==", "avatar_url": "https://avatars.githubusercontent.com/u/484108?v=4", "gravatar_id": "", "url": "https://api.github.com/users/janusw", "html_url": "https://github.com/janusw", "followers_url": "https://api.github.com/users/janusw/followers", "following_url": "https://api.github.com/users/janusw/following{/other_user}", "gists_url": "https://api.github.com/users/janusw/gists{/gist_id}", "starred_url": "https://api.github.com/users/janusw/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/janusw/subscriptions", "organizations_url": "https://api.github.com/users/janusw/orgs", "repos_url": "https://api.github.com/users/janusw/repos", "events_url": "https://api.github.com/users/janusw/events{/privacy}", "received_events_url": "https://api.github.com/users/janusw/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "7c3001f41a2346db040675a26a14979d3bf76c2b", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/7c3001f41a2346db040675a26a14979d3bf76c2b", "html_url": "https://github.com/Rust-GCC/gccrs/commit/7c3001f41a2346db040675a26a14979d3bf76c2b"}], "stats": {"total": 67, "additions": 67, "deletions": 0}, "files": [{"sha": "4ac92423102d2e7c6f4102621af0913c577227e2", "filename": "gcc/fortran/ChangeLog", "status": "modified", "additions": 6, "deletions": 0, "changes": 6, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/3436db7558562d59027e9ce4c530b660fe5c0011/gcc%2Ffortran%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/3436db7558562d59027e9ce4c530b660fe5c0011/gcc%2Ffortran%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ffortran%2FChangeLog?ref=3436db7558562d59027e9ce4c530b660fe5c0011", "patch": "@@ -1,3 +1,9 @@\n+2013-11-25  Janus Weil  <janus@gcc.gnu.org>\n+\n+\tPR fortran/59143\n+\t* interface.c (get_expr_storage_size): Handle array-valued type-bound\n+\tprocedures.\n+\n 2013-11-24  Francois-Xavier Coudert  <fxcoudert@gcc.gnu.org>\n \n \t* scanner.c (gfc_open_intrinsic_module): Remove function."}, {"sha": "da3db7e096c36196c35a26f428710317273f65e3", "filename": "gcc/fortran/interface.c", "status": "modified", "additions": 18, "deletions": 0, "changes": 18, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/3436db7558562d59027e9ce4c530b660fe5c0011/gcc%2Ffortran%2Finterface.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/3436db7558562d59027e9ce4c530b660fe5c0011/gcc%2Ffortran%2Finterface.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ffortran%2Finterface.c?ref=3436db7558562d59027e9ce4c530b660fe5c0011", "patch": "@@ -2426,6 +2426,24 @@ get_expr_storage_size (gfc_expr *e)\n \t\t\t- mpz_get_si (ref->u.ar.as->lower[i]->value.integer));\n \t    }\n         }\n+      else if (ref->type == REF_COMPONENT && ref->u.c.component->attr.function\n+\t       && ref->u.c.component->attr.proc_pointer\n+\t       && ref->u.c.component->attr.dimension)\n+\t{\n+\t  /* Array-valued procedure-pointer components.  */\n+\t  gfc_array_spec *as = ref->u.c.component->as;\n+\t  for (i = 0; i < as->rank; i++)\n+\t    {\n+\t      if (!as->upper[i] || !as->lower[i]\n+\t\t  || as->upper[i]->expr_type != EXPR_CONSTANT\n+\t\t  || as->lower[i]->expr_type != EXPR_CONSTANT)\n+\t\treturn 0;\n+\n+\t      elements = elements\n+\t\t\t * (mpz_get_si (as->upper[i]->value.integer)\n+\t\t\t    - mpz_get_si (as->lower[i]->value.integer) + 1L);\n+\t    }\n+\t}\n     }\n \n   if (substrlen)"}, {"sha": "ee6e343239899a756e73abbbc08fa99e897756dd", "filename": "gcc/testsuite/ChangeLog", "status": "modified", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/3436db7558562d59027e9ce4c530b660fe5c0011/gcc%2Ftestsuite%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/3436db7558562d59027e9ce4c530b660fe5c0011/gcc%2Ftestsuite%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2FChangeLog?ref=3436db7558562d59027e9ce4c530b660fe5c0011", "patch": "@@ -1,3 +1,8 @@\n+2013-11-25  Janus Weil  <janus@gcc.gnu.org>\n+\n+\tPR fortran/59143\n+\t* gfortran.dg/typebound_proc_30.f90: New.\n+\n 2013-11-25  Paolo Carlini  <paolo.carlini@oracle.com>\n \n \tPR c++/59080"}, {"sha": "09b072610893fcf5bffeeb965dc074d05f4aa85c", "filename": "gcc/testsuite/gfortran.dg/typebound_proc_30.f90", "status": "added", "additions": 38, "deletions": 0, "changes": 38, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/3436db7558562d59027e9ce4c530b660fe5c0011/gcc%2Ftestsuite%2Fgfortran.dg%2Ftypebound_proc_30.f90", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/3436db7558562d59027e9ce4c530b660fe5c0011/gcc%2Ftestsuite%2Fgfortran.dg%2Ftypebound_proc_30.f90", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgfortran.dg%2Ftypebound_proc_30.f90?ref=3436db7558562d59027e9ce4c530b660fe5c0011", "patch": "@@ -0,0 +1,38 @@\n+! { dg-do compile }\n+!\n+! PR 59143: [OOP] Bogus warning with array-valued type-bound procedure\n+!\n+! Contributed by J\u00fcrgen Reuter <juergen.reuter@desy.de>\n+\n+module phs_single\n+\n+  type :: phs_single_t\n+   contains\n+     procedure, nopass :: d1, d2\n+  end type\n+  \n+contains\n+\n+  subroutine evaluate (phs)\n+    class(phs_single_t) :: phs\n+    call func1 (phs%d1 ())\n+    call func1 (phs%d2 (2))\n+  end subroutine\n+\n+  subroutine func1 (p)\n+    real :: p(2)\n+  end subroutine\n+  \n+  function d1 ()\n+    real :: d1(2)\n+    d1 = 1.\n+  end function\n+\n+  function d2 (n)\n+    real :: d2(n)\n+    d2 = 1.\n+  end function\n+\n+end module\n+\n+! { dg-final { cleanup-modules \"phs_single\" } }"}]}