{"sha": "766a4175b12e77540da5a39482d1cd3e4beb81ff", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6NzY2YTQxNzViMTJlNzc1NDBkYTVhMzk0ODJkMWNkM2U0YmViODFmZg==", "commit": {"author": {"name": "Loren J. Rittle", "email": "ljrittle@acm.org", "date": "2001-05-22T19:28:15Z"}, "committer": {"name": "Loren J. Rittle", "email": "ljrittle@gcc.gnu.org", "date": "2001-05-22T19:28:15Z"}, "message": "freebsd.h (LIB_SPEC): Key the exact setting to configure-time options and target version of FreeBSD.\n\n\t* config/freebsd.h (LIB_SPEC): Key the exact setting to\n\tconfigure-time options and target version of FreeBSD.  Set-up\n\tto match architectural change in threading support.  Correctly\n\treport when -pthread option is not supported by configure-time\n\toptions.\n\t(FBSD_CPP_PREDEFINES): Move from architecture-specific files\n\tand extend to encode target version number in run-time setting\n\tof __FreeBSD__ macro to match the system compiler.\n\t(CPP_PREDEFINES): Likewise.\n\t(PREFERRED_DEBUGGING_TYPE): Change to DWARF2_DEBUG.\n\n\t* config/alpha/freebsd.h (CPP_PREDEFINES): Moved to common freebsd.h.\n\t* config/i386/freebsd.h (CPP_PREDEFINES): Likewise.\n\nCo-Authored-By: David O'Brien <obrien@freebsd.org>\n\nFrom-SVN: r42464", "tree": {"sha": "4f02300804e0911e677d07ff67301cd3d153605e", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/4f02300804e0911e677d07ff67301cd3d153605e"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/766a4175b12e77540da5a39482d1cd3e4beb81ff", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/766a4175b12e77540da5a39482d1cd3e4beb81ff", "html_url": "https://github.com/Rust-GCC/gccrs/commit/766a4175b12e77540da5a39482d1cd3e4beb81ff", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/766a4175b12e77540da5a39482d1cd3e4beb81ff/comments", "author": null, "committer": null, "parents": [{"sha": "9e405fe52ee14ad3cdcfe1e535225c384436398e", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/9e405fe52ee14ad3cdcfe1e535225c384436398e", "html_url": "https://github.com/Rust-GCC/gccrs/commit/9e405fe52ee14ad3cdcfe1e535225c384436398e"}], "stats": {"total": 92, "additions": 76, "deletions": 16}, "files": [{"sha": "efdd1a4b42264f73066a535df4090269a77c6dd6", "filename": "gcc/ChangeLog", "status": "modified", "additions": 17, "deletions": 0, "changes": 17, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/766a4175b12e77540da5a39482d1cd3e4beb81ff/gcc%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/766a4175b12e77540da5a39482d1cd3e4beb81ff/gcc%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2FChangeLog?ref=766a4175b12e77540da5a39482d1cd3e4beb81ff", "patch": "@@ -1,3 +1,20 @@\n+2001-05-22  Loren J. Rittle  <ljrittle@acm.org>\n+\t    David O'Brien  <obrien@freebsd.org>\n+\n+\t* config/freebsd.h (LIB_SPEC): Key the exact setting to\n+\tconfigure-time options and target version of FreeBSD.  Set-up\n+\tto match architectural change in threading support.  Correctly\n+\treport when -pthread option is not supported by configure-time\n+\toptions.\n+\t(FBSD_CPP_PREDEFINES): Move from architecture-specific files\n+\tand extend to encode target version number in run-time setting\n+\tof __FreeBSD__ macro to match the system compiler.\n+\t(CPP_PREDEFINES): Likewise.\n+\t(PREFERRED_DEBUGGING_TYPE): Change to DWARF2_DEBUG.\n+\n+\t* config/alpha/freebsd.h (CPP_PREDEFINES): Moved to common freebsd.h.\n+\t* config/i386/freebsd.h (CPP_PREDEFINES): Likewise.\n+\n 2001-05-22  Loren J. Rittle  <ljrittle@acm.org>\n \t    David O'Brien  <obrien@freebsd.org>\n "}, {"sha": "494fdab7a989e04bf4cb0d8e4443258c0cc2d6bd", "filename": "gcc/config/alpha/freebsd.h", "status": "modified", "additions": 0, "deletions": 4, "changes": 4, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/766a4175b12e77540da5a39482d1cd3e4beb81ff/gcc%2Fconfig%2Falpha%2Ffreebsd.h", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/766a4175b12e77540da5a39482d1cd3e4beb81ff/gcc%2Fconfig%2Falpha%2Ffreebsd.h", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fconfig%2Falpha%2Ffreebsd.h?ref=766a4175b12e77540da5a39482d1cd3e4beb81ff", "patch": "@@ -19,10 +19,6 @@ along with GNU CC; see the file COPYING.  If not, write to\n the Free Software Foundation, 675 Mass Ave, Cambridge, MA 02139, USA.  */\n \n \n-#undef  CPP_PREDEFINES\n-#define CPP_PREDEFINES \\\n-  \"-D__ELF__ -Dunix -D__FreeBSD__ -Asystem(unix) -Asystem(bsd) -Asystem(FreeBSD)\"\n-\n /* Provide a CPP_SPEC appropriate for FreeBSD/alpha.  Besides the dealing with\n    the GCC option `-posix', and PIC issues as on all FreeBSD platforms, we must\n    deal with the Alpha's FP issues.  */"}, {"sha": "8b526ca1cf258c435ef325fbae9e9780152fd27d", "filename": "gcc/config/freebsd.h", "status": "modified", "additions": 59, "deletions": 8, "changes": 67, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/766a4175b12e77540da5a39482d1cd3e4beb81ff/gcc%2Fconfig%2Ffreebsd.h", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/766a4175b12e77540da5a39482d1cd3e4beb81ff/gcc%2Fconfig%2Ffreebsd.h", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fconfig%2Ffreebsd.h?ref=766a4175b12e77540da5a39482d1cd3e4beb81ff", "patch": "@@ -1,5 +1,5 @@\n /* Base configuration file for all FreeBSD targets.\n-   Copyright (C) 1999, 2000 Free Software Foundation, Inc.\n+   Copyright (C) 1999, 2000, 2001 Free Software Foundation, Inc.\n \n This file is part of GNU CC.\n \n@@ -22,7 +22,9 @@ Boston, MA 02111-1307, USA.  */\n    All FreeBSD architectures should include this file, which will specify\n    their commonalities.\n    Adapted from gcc/config/i386/freebsd-elf.h by \n-   David O'Brien <obrien@FreeBSD.org>.  */\n+   David O'Brien <obrien@FreeBSD.org>.  \n+   Further work by David O'Brien <obrien@FreeBSD.org> and\n+   Loren J. Rittle <ljrittle@acm.org>.  */\n \n \n /* This defines which switch letters take arguments.  On FreeBSD, most of\n@@ -48,6 +50,26 @@ Boston, MA 02111-1307, USA.  */\n #undef WORD_SWITCH_TAKES_ARG\n #define WORD_SWITCH_TAKES_ARG(STR) (FBSD_WORD_SWITCH_TAKES_ARG(STR))\n \n+#if FBSD_MAJOR == 6\n+#define FBSD_CPP_PREDEFINES \\\n+  \"-D__FreeBSD__=6 -Dunix -D__ELF__ -Asystem=unix -Asystem=bsd -Asystem=FreeBSD\"\n+#elif FBSD_MAJOR == 5\n+#define FBSD_CPP_PREDEFINES \\\n+  \"-D__FreeBSD__=5 -Dunix -D__ELF__ -Asystem=unix -Asystem=bsd -Asystem=FreeBSD\"\n+#elif FBSD_MAJOR == 4\n+#define FBSD_CPP_PREDEFINES \\\n+  \"-D__FreeBSD__=4 -Dunix -D__ELF__ -Asystem=unix -Asystem=bsd -Asystem=FreeBSD\"\n+#elif FBSD_MAJOR == 3\n+#define FBSD_CPP_PREDEFINES \\\n+  \"-D__FreeBSD__=3 -Dunix -D__ELF__ -Asystem=unix -Asystem=bsd -Asystem=FreeBSD\"\n+#else\n+#define FBSD_CPP_PREDEFINES \\\n+  \"-D__FreeBSD__   -Dunix -D__ELF__ -Asystem=unix -Asystem=bsd -Asystem=FreeBSD\"\n+#endif\n+\n+#undef  CPP_PREDEFINES\n+#define CPP_PREDEFINES FBSD_CPP_PREDEFINES\n+\n /* Provide a CPP_SPEC appropriate for FreeBSD.  We just deal with the GCC \n    option `-posix', and PIC issues.  */\n \n@@ -56,11 +78,37 @@ Boston, MA 02111-1307, USA.  */\n   %{fPIC:-D__PIC__ -D__pic__} %{fpic:-D__PIC__ -D__pic__}\t\t\\\n   %{posix:-D_POSIX_SOURCE}\"\n \n-/* Provide a LIB_SPEC appropriate for FreeBSD.  Just select the appropriate\n-   libc, depending on whether we're doing profiling or need threads support.\n-   (simular to the default, except no -lg, and no -p).  */\n+/* Provide a LIB_SPEC appropriate for FreeBSD as configured and as\n+   required by the user-land thread model.  Before __FreeBSD_version\n+   500016, select the appropriate libc, depending on whether we're\n+   doing profiling or need threads support.  At __FreeBSD_version\n+   500016 and later, when threads support is requested include both\n+   -lc and -lc_r instead of only -lc_r.  To make matters interesting,\n+   we can't actually use __FreeBSD_version provided by <osreldate.h>\n+   directly since it breaks cross-compiling.  As a final twist, make\n+   it a hard error if -pthread is provided on the command line and gcc\n+   was configured with --disable-threads (this will help avoid bug\n+   reports from users complaining about threading when they\n+   misconfigured the gcc bootstrap but are later consulting FreeBSD\n+   manual pages that refer to the mythical -pthread option).  */\n \n #undef  LIB_SPEC\n+#ifdef FBSD_NO_THREADS\n+#define LIB_SPEC \"\t\t\t\t\t\t\t\\\n+  %{pthread: %eThe -pthread option is only supported on FreeBSD when gcc \\\n+is built with the --enable-threads configure-time option.}\t\t\\\n+  %{!shared:\t\t\t\t\t\t\t\t\\\n+    %{!pg: -lc}\t\t\t\t\t\t\t\t\\\n+    %{pg:  -lc_p}\t\t\t\t\t\t\t\\\n+  }\"\n+#else\n+#if FBSD_MAJOR >= 5\n+#define LIB_SPEC \"\t\t\t\t\t\t\t\\\n+  %{!shared:\t\t\t\t\t\t\t\t\\\n+    %{!pg: %{pthread:-lc_r} -lc}\t\t\t\t\t\\\n+    %{pg:  %{pthread:-lc_r_p} -lc_p}\t\t\t\t\t\\\n+  }\"\n+#else\n #define LIB_SPEC \"\t\t\t\t\t\t\t\\\n   %{!shared:\t\t\t\t\t\t\t\t\\\n     %{!pg:\t\t\t\t\t\t\t\t\\\n@@ -70,7 +118,8 @@ Boston, MA 02111-1307, USA.  */\n       %{!pthread:-lc_p}\t\t\t\t\t\t\t\\\n       %{pthread:-lc_r_p}}\t\t\t\t\t\t\\\n   }\"\n-\n+#endif\n+#endif\n \n /* Code generation parameters.  */\n \n@@ -97,9 +146,11 @@ Boston, MA 02111-1307, USA.  */\n #undef DEFAULT_VTABLE_THUNKS\n #define DEFAULT_VTABLE_THUNKS 1\n \n-/* This is BSD, so use stabs instead of DWARF debug format.  */\n+/* The GNU tools operate better with dwarf2 than stabs.  Since we\n+   don't have any native tools to be compatible with, default to\n+   dwarf2.  */\n #undef PREFERRED_DEBUGGING_TYPE\n-#define PREFERRED_DEBUGGING_TYPE DBX_DEBUG\n+#define PREFERRED_DEBUGGING_TYPE DWARF2_DEBUG\n \n #undef IDENT_ASM_OP\n #define IDENT_ASM_OP \"\\t.ident\\t\""}, {"sha": "2d34117d118dba430ac09561400137edafee08db", "filename": "gcc/config/i386/freebsd.h", "status": "modified", "additions": 0, "deletions": 4, "changes": 4, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/766a4175b12e77540da5a39482d1cd3e4beb81ff/gcc%2Fconfig%2Fi386%2Ffreebsd.h", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/766a4175b12e77540da5a39482d1cd3e4beb81ff/gcc%2Fconfig%2Fi386%2Ffreebsd.h", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fconfig%2Fi386%2Ffreebsd.h?ref=766a4175b12e77540da5a39482d1cd3e4beb81ff", "patch": "@@ -78,10 +78,6 @@ Boston, MA 02111-1307, USA.  */\n #undef WCHAR_TYPE_SIZE\n #define WCHAR_TYPE_SIZE BITS_PER_WORD\n     \n-#undef CPP_PREDEFINES\n-#define CPP_PREDEFINES \"-Dunix -D__ELF__ -D__FreeBSD__\\\n- -Asystem=unix -Asystem=bsd -Asystem=FreeBSD\"\n-\n /* Provide a STARTFILE_SPEC appropriate for FreeBSD.  Here we add\n    the magical crtbegin.o file (see crtstuff.c) which provides part \n \tof the support for getting C++ file-scope static object constructed "}]}