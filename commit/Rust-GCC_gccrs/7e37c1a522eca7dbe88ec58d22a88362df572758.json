{"sha": "7e37c1a522eca7dbe88ec58d22a88362df572758", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6N2UzN2MxYTUyMmVjYTdkYmU4OGVjNThkMjJhODgzNjJkZjU3Mjc1OA==", "commit": {"author": {"name": "Ed Schonberg", "email": "schonberg@adacore.com", "date": "2020-06-24T17:24:49Z"}, "committer": {"name": "Pierre-Marie de Rodat", "email": "derodat@adacore.com", "date": "2020-10-15T09:39:12Z"}, "message": "[Ada] Crash on subtype of fixed-point type\n\ngcc/ada/\n\n\t* freeze.adb (Freeze_Fixed_Point_Type): Do not scale the bounds\n\tof a declared subtype using the 'Small of the type;  this is\n\tdone during resolution of the bound itself, unlike what is done\n\tfor the bounds of the base type, which are used to determine its\n\trequired size. Previous code performed this scaling twice,\n\tleading to meaningless values for such a subtype.", "tree": {"sha": "623e3ecc298c0d32bd6e14573fc2db9c9c502076", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/623e3ecc298c0d32bd6e14573fc2db9c9c502076"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/7e37c1a522eca7dbe88ec58d22a88362df572758", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/7e37c1a522eca7dbe88ec58d22a88362df572758", "html_url": "https://github.com/Rust-GCC/gccrs/commit/7e37c1a522eca7dbe88ec58d22a88362df572758", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/7e37c1a522eca7dbe88ec58d22a88362df572758/comments", "author": {"login": "Edschonberg", "id": 6352375, "node_id": "MDQ6VXNlcjYzNTIzNzU=", "avatar_url": "https://avatars.githubusercontent.com/u/6352375?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Edschonberg", "html_url": "https://github.com/Edschonberg", "followers_url": "https://api.github.com/users/Edschonberg/followers", "following_url": "https://api.github.com/users/Edschonberg/following{/other_user}", "gists_url": "https://api.github.com/users/Edschonberg/gists{/gist_id}", "starred_url": "https://api.github.com/users/Edschonberg/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Edschonberg/subscriptions", "organizations_url": "https://api.github.com/users/Edschonberg/orgs", "repos_url": "https://api.github.com/users/Edschonberg/repos", "events_url": "https://api.github.com/users/Edschonberg/events{/privacy}", "received_events_url": "https://api.github.com/users/Edschonberg/received_events", "type": "User", "site_admin": false}, "committer": {"login": "pmderodat", "id": 758452, "node_id": "MDQ6VXNlcjc1ODQ1Mg==", "avatar_url": "https://avatars.githubusercontent.com/u/758452?v=4", "gravatar_id": "", "url": "https://api.github.com/users/pmderodat", "html_url": "https://github.com/pmderodat", "followers_url": "https://api.github.com/users/pmderodat/followers", "following_url": "https://api.github.com/users/pmderodat/following{/other_user}", "gists_url": "https://api.github.com/users/pmderodat/gists{/gist_id}", "starred_url": "https://api.github.com/users/pmderodat/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/pmderodat/subscriptions", "organizations_url": "https://api.github.com/users/pmderodat/orgs", "repos_url": "https://api.github.com/users/pmderodat/repos", "events_url": "https://api.github.com/users/pmderodat/events{/privacy}", "received_events_url": "https://api.github.com/users/pmderodat/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "e4f503be5d8f4b6f985f91ffe8a42ed9663466b3", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/e4f503be5d8f4b6f985f91ffe8a42ed9663466b3", "html_url": "https://github.com/Rust-GCC/gccrs/commit/e4f503be5d8f4b6f985f91ffe8a42ed9663466b3"}], "stats": {"total": 21, "additions": 10, "deletions": 11}, "files": [{"sha": "5032724045096eb092394ee2dc7fad33cbb548ab", "filename": "gcc/ada/freeze.adb", "status": "modified", "additions": 10, "deletions": 11, "changes": 21, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/7e37c1a522eca7dbe88ec58d22a88362df572758/gcc%2Fada%2Ffreeze.adb", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/7e37c1a522eca7dbe88ec58d22a88362df572758/gcc%2Fada%2Ffreeze.adb", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fada%2Ffreeze.adb?ref=7e37c1a522eca7dbe88ec58d22a88362df572758", "patch": "@@ -8494,21 +8494,21 @@ package body Freeze is\n       Set_Analyzed (Lo, False);\n       Analyze (Lo);\n \n-      --  Resolve with universal fixed if the base type, and the base type if\n-      --  it is a subtype. Note we can't resolve the base type with itself,\n-      --  that would be a reference before definition.\n+      --  Resolve with universal fixed if the base type, and with the base\n+      --  type if we are freezing a subtype. Note we can't resolve the base\n+      --  type with itself, that would be a reference before definition.\n+      --  The resolution of the bounds of a subtype, if they are given by real\n+      --  literals,  includes the setting of the Corresponding_Integer_Value,\n+      --  as for other literals of a fixed-point type.\n \n       if Typ = Btyp then\n          Resolve (Lo, Universal_Fixed);\n+         Set_Corresponding_Integer_Value\n+           (Lo, UR_To_Uint (Realval (Lo) / Small));\n       else\n          Resolve (Lo, Btyp);\n       end if;\n \n-      --  Set corresponding integer value for bound\n-\n-      Set_Corresponding_Integer_Value\n-        (Lo, UR_To_Uint (Realval (Lo) / Small));\n-\n       --  Similar processing for high bound\n \n       Set_Etype (Hi, Empty);\n@@ -8517,13 +8517,12 @@ package body Freeze is\n \n       if Typ = Btyp then\n          Resolve (Hi, Universal_Fixed);\n+         Set_Corresponding_Integer_Value\n+           (Hi, UR_To_Uint (Realval (Hi) / Small));\n       else\n          Resolve (Hi, Btyp);\n       end if;\n \n-      Set_Corresponding_Integer_Value\n-        (Hi, UR_To_Uint (Realval (Hi) / Small));\n-\n       --  Set type of range to correspond to bounds\n \n       Set_Etype (Rng, Etype (Lo));"}]}