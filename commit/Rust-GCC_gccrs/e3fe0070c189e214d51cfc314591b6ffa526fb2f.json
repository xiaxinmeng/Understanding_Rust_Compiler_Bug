{"sha": "e3fe0070c189e214d51cfc314591b6ffa526fb2f", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6ZTNmZTAwNzBjMTg5ZTIxNGQ1MWNmYzMxNDU5MWI2ZmZhNTI2ZmIyZg==", "commit": {"author": {"name": "Jan Hubicka", "email": "jh@suse.cz", "date": "2020-01-24T11:12:17Z"}, "committer": {"name": "Jan Hubicka", "email": "jh@suse.cz", "date": "2020-01-24T11:12:17Z"}, "message": "libgcov: Fix merging of topn [PR92924]\n\n\tPR tree-optimization/92924\n\t* libgcov-merge.c (merge_topn_values_set): Fix merging.", "tree": {"sha": "dcbcdf9230a512673f736800e2787d299f7d3cba", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/dcbcdf9230a512673f736800e2787d299f7d3cba"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/e3fe0070c189e214d51cfc314591b6ffa526fb2f", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/e3fe0070c189e214d51cfc314591b6ffa526fb2f", "html_url": "https://github.com/Rust-GCC/gccrs/commit/e3fe0070c189e214d51cfc314591b6ffa526fb2f", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/e3fe0070c189e214d51cfc314591b6ffa526fb2f/comments", "author": null, "committer": null, "parents": [{"sha": "ad8e2415d6e2dc7c6f1206e78d48f999ff6b0bc4", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/ad8e2415d6e2dc7c6f1206e78d48f999ff6b0bc4", "html_url": "https://github.com/Rust-GCC/gccrs/commit/ad8e2415d6e2dc7c6f1206e78d48f999ff6b0bc4"}], "stats": {"total": 25, "additions": 16, "deletions": 9}, "files": [{"sha": "19b8ee72ae99f9434fce806922558f17c0114df6", "filename": "libgcc/libgcov-merge.c", "status": "modified", "additions": 16, "deletions": 9, "changes": 25, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/e3fe0070c189e214d51cfc314591b6ffa526fb2f/libgcc%2Flibgcov-merge.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/e3fe0070c189e214d51cfc314591b6ffa526fb2f/libgcc%2Flibgcov-merge.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libgcc%2Flibgcov-merge.c?ref=e3fe0070c189e214d51cfc314591b6ffa526fb2f", "patch": "@@ -112,9 +112,11 @@ merge_topn_values_set (gcov_type *counters)\n   for (unsigned i = 0; i < GCOV_TOPN_VALUES; i++)\n     {\n       if (read_counters[2 * i + 1] == 0)\n-\treturn;\n+\tcontinue;\n \n       unsigned j;\n+      int slot = -1;\n+\n       for (j = 0; j < GCOV_TOPN_VALUES; j++)\n \t{\n \t  if (counters[2 * j] == read_counters[2 * i])\n@@ -123,18 +125,23 @@ merge_topn_values_set (gcov_type *counters)\n \t      break;\n \t    }\n \t  else if (counters[2 * j + 1] == 0)\n-\t    {\n-\t      counters[2 * j] += read_counters[2 * i];\n-\t      counters[2 * j + 1] += read_counters[2 * i + 1];\n-\t      break;\n-\t    }\n+\t    slot = j;\n \t}\n \n-      /* We haven't found a slot, bail out.  */\n       if (j == GCOV_TOPN_VALUES)\n \t{\n-\t  counters[1] = -1;\n-\t  return;\n+\t  if (slot > 0)\n+\t    {\n+\t      /* If we found empty slot, add the value.  */\n+\t      counters[2 * slot] = read_counters[2 * i];\n+\t      counters[2 * slot + 1] = read_counters[2 * i + 1];\n+\t    }\n+\t  else\n+\t    {\n+\t      /* We haven't found a slot, bail out.  */\n+\t      counters[1] = -1;\n+\t      return;\n+\t    }\n \t}\n     }\n }"}]}