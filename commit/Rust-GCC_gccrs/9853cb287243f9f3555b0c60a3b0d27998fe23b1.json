{"sha": "9853cb287243f9f3555b0c60a3b0d27998fe23b1", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6OTg1M2NiMjg3MjQzZjlmMzU1NWIwYzYwYTNiMGQyNzk5OGZlMjNiMQ==", "commit": {"author": {"name": "Peter Bergner", "email": "bergner@vnet.ibm.com", "date": "2017-05-17T14:05:21Z"}, "committer": {"name": "Peter Bergner", "email": "bergner@gcc.gnu.org", "date": "2017-05-17T14:05:21Z"}, "message": "re PR middle-end/80775 (-O3 produces ice in group_case_labels_stmt)\n\ngcc/\n\tPR middle-end/80775\n\t* tree-cfg.c: Move deletion of unreachable case statements to after\n\tthe merging of consecutive case labels.\n\ngcc/testsuite/\n\tPR middle-end/80775\n\t* gcc.dg/pr80775.c: New test.\n\nFrom-SVN: r248155", "tree": {"sha": "06f3c9db5f3316035b286c59b6e9f237579201ac", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/06f3c9db5f3316035b286c59b6e9f237579201ac"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/9853cb287243f9f3555b0c60a3b0d27998fe23b1", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/9853cb287243f9f3555b0c60a3b0d27998fe23b1", "html_url": "https://github.com/Rust-GCC/gccrs/commit/9853cb287243f9f3555b0c60a3b0d27998fe23b1", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/9853cb287243f9f3555b0c60a3b0d27998fe23b1/comments", "author": {"login": "peter-bergner", "id": 17504345, "node_id": "MDQ6VXNlcjE3NTA0MzQ1", "avatar_url": "https://avatars.githubusercontent.com/u/17504345?v=4", "gravatar_id": "", "url": "https://api.github.com/users/peter-bergner", "html_url": "https://github.com/peter-bergner", "followers_url": "https://api.github.com/users/peter-bergner/followers", "following_url": "https://api.github.com/users/peter-bergner/following{/other_user}", "gists_url": "https://api.github.com/users/peter-bergner/gists{/gist_id}", "starred_url": "https://api.github.com/users/peter-bergner/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/peter-bergner/subscriptions", "organizations_url": "https://api.github.com/users/peter-bergner/orgs", "repos_url": "https://api.github.com/users/peter-bergner/repos", "events_url": "https://api.github.com/users/peter-bergner/events{/privacy}", "received_events_url": "https://api.github.com/users/peter-bergner/received_events", "type": "User", "site_admin": false}, "committer": null, "parents": [{"sha": "b42cc3ca244ea57d5112638a73e7f83c58202a84", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/b42cc3ca244ea57d5112638a73e7f83c58202a84", "html_url": "https://github.com/Rust-GCC/gccrs/commit/b42cc3ca244ea57d5112638a73e7f83c58202a84"}], "stats": {"total": 59, "additions": 48, "deletions": 11}, "files": [{"sha": "004c7bb446f493099f3829879d119369ad61b0e8", "filename": "gcc/ChangeLog", "status": "modified", "additions": 6, "deletions": 0, "changes": 6, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/9853cb287243f9f3555b0c60a3b0d27998fe23b1/gcc%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/9853cb287243f9f3555b0c60a3b0d27998fe23b1/gcc%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2FChangeLog?ref=9853cb287243f9f3555b0c60a3b0d27998fe23b1", "patch": "@@ -1,3 +1,9 @@\n+2017-05-17  Peter Bergner  <bergner@vnet.ibm.com>\n+\n+\tPR middle-end/80775\n+\t* tree-cfg.c: Move deletion of unreachable case statements to after\n+\tthe merging of consecutive case labels.\n+\n 2017-05-17  Thomas Preud'homme  <thomas.preudhomme@arm.com>\n \n \t* config/arm/arm.c (cmse_nonsecure_call_clear_caller_saved): Refer"}, {"sha": "8f62adb2d620014afd387dfaeeb3d0f41c7eb4f9", "filename": "gcc/testsuite/ChangeLog", "status": "modified", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/9853cb287243f9f3555b0c60a3b0d27998fe23b1/gcc%2Ftestsuite%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/9853cb287243f9f3555b0c60a3b0d27998fe23b1/gcc%2Ftestsuite%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2FChangeLog?ref=9853cb287243f9f3555b0c60a3b0d27998fe23b1", "patch": "@@ -1,3 +1,8 @@\n+2017-05-17  Peter Bergner  <bergner@vnet.ibm.com>\n+\n+\tPR middle-end/80775\n+\t* gcc.dg/pr80775.c: New test.\n+\n 2017-05-17  Marek Polacek  <polacek@redhat.com>\n \n \tPR sanitizer/80659"}, {"sha": "df4d250687be2b13b29dddc620811ba2982cf202", "filename": "gcc/testsuite/gcc.dg/pr80775.c", "status": "added", "additions": 21, "deletions": 0, "changes": 21, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/9853cb287243f9f3555b0c60a3b0d27998fe23b1/gcc%2Ftestsuite%2Fgcc.dg%2Fpr80775.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/9853cb287243f9f3555b0c60a3b0d27998fe23b1/gcc%2Ftestsuite%2Fgcc.dg%2Fpr80775.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgcc.dg%2Fpr80775.c?ref=9853cb287243f9f3555b0c60a3b0d27998fe23b1", "patch": "@@ -0,0 +1,21 @@\n+/* PR middle-end/80775 ICE: -O3 produces ice in group_case_labels_stmt.  */\n+/* { dg-do compile }  */\n+/* { dg-options \"-O3\" }  */\n+\n+typedef struct { short a; } b;\n+b c[10];\n+int d, e, f, g, h;\n+int\n+i (void)\n+{\n+  f = 0;\n+  for (; f < e; f++) {\n+    switch (g) {\n+    case 1:\n+      d = 1;\n+    case 2:\n+      c[2 + f].a = 1;\n+    }\n+    h += c[f].a;\n+  }\n+}"}, {"sha": "ba19661b860c430108c946dca31f3b41f17c5c25", "filename": "gcc/tree-cfg.c", "status": "modified", "additions": 16, "deletions": 11, "changes": 27, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/9853cb287243f9f3555b0c60a3b0d27998fe23b1/gcc%2Ftree-cfg.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/9853cb287243f9f3555b0c60a3b0d27998fe23b1/gcc%2Ftree-cfg.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftree-cfg.c?ref=9853cb287243f9f3555b0c60a3b0d27998fe23b1", "patch": "@@ -1661,7 +1661,7 @@ void\n group_case_labels_stmt (gswitch *stmt)\n {\n   int old_size = gimple_switch_num_labels (stmt);\n-  int i, j, new_size = old_size;\n+  int i, j, base_index, new_size = old_size;\n   basic_block default_bb = NULL;\n \n   default_bb = label_to_block (CASE_LABEL (gimple_switch_default_label (stmt)));\n@@ -1678,16 +1678,9 @@ group_case_labels_stmt (gswitch *stmt)\n       gcc_assert (base_case);\n       base_bb = label_to_block (CASE_LABEL (base_case));\n \n-      /* Discard cases that have the same destination as the default case\n-\t or if their destination block is unreachable.  */\n-      if (base_bb == default_bb\n-\t  || (EDGE_COUNT (base_bb->succs) == 0\n-\t      && gimple_seq_unreachable_p (bb_seq (base_bb))))\n+      /* Discard cases that have the same destination as the default case.  */\n+      if (base_bb == default_bb)\n \t{\n-\t  edge e;\n-\t  if (base_bb != default_bb\n-\t      && (e = find_edge (gimple_bb (stmt), base_bb)) != NULL)\n-\t    remove_edge_and_dominated_blocks (e);\n \t  gimple_switch_set_label (stmt, i, NULL_TREE);\n \t  i++;\n \t  new_size--;\n@@ -1697,7 +1690,7 @@ group_case_labels_stmt (gswitch *stmt)\n       base_high = CASE_HIGH (base_case)\n \t  ? CASE_HIGH (base_case)\n \t  : CASE_LOW (base_case);\n-      i++;\n+      base_index = i++;\n \n       /* Try to merge case labels.  Break out when we reach the end\n \t of the label vector or when we cannot merge the next case\n@@ -1723,6 +1716,18 @@ group_case_labels_stmt (gswitch *stmt)\n \t  else\n \t    break;\n \t}\n+\n+      /* Discard cases that have an unreachable destination block.  */\n+      if (EDGE_COUNT (base_bb->succs) == 0\n+\t  && gimple_seq_unreachable_p (bb_seq (base_bb)))\n+\t{\n+\t  edge base_edge = find_edge (gimple_bb (stmt), base_bb);\n+\t  if (base_edge != NULL)\n+\t    remove_edge_and_dominated_blocks (base_edge);\n+\t  gimple_switch_set_label (stmt, base_index, NULL_TREE);\n+\t  new_size--;\n+\t  i++;\n+\t}\n     }\n \n   /* Compress the case labels in the label vector, and adjust the"}]}