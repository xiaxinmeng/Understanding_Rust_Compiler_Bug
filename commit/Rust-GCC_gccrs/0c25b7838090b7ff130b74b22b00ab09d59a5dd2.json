{"sha": "0c25b7838090b7ff130b74b22b00ab09d59a5dd2", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6MGMyNWI3ODM4MDkwYjdmZjEzMGI3NGIyMmIwMGFiMDlkNTlhNWRkMg==", "commit": {"author": {"name": "Piotr Trojanek", "email": "trojanek@adacore.com", "date": "2020-03-17T15:58:24Z"}, "committer": {"name": "Pierre-Marie de Rodat", "email": "derodat@adacore.com", "date": "2020-06-11T09:53:47Z"}, "message": "[Ada] Avoid \"others => <>\" association in resolved record aggregates\n\n2020-06-11  Piotr Trojanek  <trojanek@adacore.com>\n\ngcc/ada/\n\n\t* sem_aggr.adb (Add_Association): Add assertion about the formal\n\tparameters.\n\t(Propagate_Discriminants): Always add an explicit component\n\tassociation, so that an \"others => <>\" association is never\n\tneeded.", "tree": {"sha": "ee83324880aa55730d09ea89fbfadcafd3dcbae2", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/ee83324880aa55730d09ea89fbfadcafd3dcbae2"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/0c25b7838090b7ff130b74b22b00ab09d59a5dd2", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/0c25b7838090b7ff130b74b22b00ab09d59a5dd2", "html_url": "https://github.com/Rust-GCC/gccrs/commit/0c25b7838090b7ff130b74b22b00ab09d59a5dd2", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/0c25b7838090b7ff130b74b22b00ab09d59a5dd2/comments", "author": {"login": "ptroja", "id": 161602, "node_id": "MDQ6VXNlcjE2MTYwMg==", "avatar_url": "https://avatars.githubusercontent.com/u/161602?v=4", "gravatar_id": "", "url": "https://api.github.com/users/ptroja", "html_url": "https://github.com/ptroja", "followers_url": "https://api.github.com/users/ptroja/followers", "following_url": "https://api.github.com/users/ptroja/following{/other_user}", "gists_url": "https://api.github.com/users/ptroja/gists{/gist_id}", "starred_url": "https://api.github.com/users/ptroja/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/ptroja/subscriptions", "organizations_url": "https://api.github.com/users/ptroja/orgs", "repos_url": "https://api.github.com/users/ptroja/repos", "events_url": "https://api.github.com/users/ptroja/events{/privacy}", "received_events_url": "https://api.github.com/users/ptroja/received_events", "type": "User", "site_admin": false}, "committer": {"login": "pmderodat", "id": 758452, "node_id": "MDQ6VXNlcjc1ODQ1Mg==", "avatar_url": "https://avatars.githubusercontent.com/u/758452?v=4", "gravatar_id": "", "url": "https://api.github.com/users/pmderodat", "html_url": "https://github.com/pmderodat", "followers_url": "https://api.github.com/users/pmderodat/followers", "following_url": "https://api.github.com/users/pmderodat/following{/other_user}", "gists_url": "https://api.github.com/users/pmderodat/gists{/gist_id}", "starred_url": "https://api.github.com/users/pmderodat/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/pmderodat/subscriptions", "organizations_url": "https://api.github.com/users/pmderodat/orgs", "repos_url": "https://api.github.com/users/pmderodat/repos", "events_url": "https://api.github.com/users/pmderodat/events{/privacy}", "received_events_url": "https://api.github.com/users/pmderodat/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "d84eb7c511b163473c272f846905631fc4a66a52", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/d84eb7c511b163473c272f846905631fc4a66a52", "html_url": "https://github.com/Rust-GCC/gccrs/commit/d84eb7c511b163473c272f846905631fc4a66a52"}], "stats": {"total": 16, "additions": 5, "deletions": 11}, "files": [{"sha": "a0f878442f448d317c1c97a16387f12c753eef6e", "filename": "gcc/ada/sem_aggr.adb", "status": "modified", "additions": 5, "deletions": 11, "changes": 16, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/0c25b7838090b7ff130b74b22b00ab09d59a5dd2/gcc%2Fada%2Fsem_aggr.adb", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/0c25b7838090b7ff130b74b22b00ab09d59a5dd2/gcc%2Fada%2Fsem_aggr.adb", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fada%2Fsem_aggr.adb?ref=0c25b7838090b7ff130b74b22b00ab09d59a5dd2", "patch": "@@ -3393,6 +3393,8 @@ package body Sem_Aggr is\n          --  If this is a box association the expression is missing, so use the\n          --  Sloc of the aggregate itself for the new association.\n \n+         pragma Assert (Present (Expr) xor Is_Box_Present);\n+\n          if Present (Expr) then\n             Loc := Sloc (Expr);\n          else\n@@ -3804,8 +3806,6 @@ package body Sem_Aggr is\n       is\n          Loc : constant Source_Ptr := Sloc (N);\n \n-         Needs_Box : Boolean := False;\n-\n          procedure Process_Component (Comp : Entity_Id);\n          --  Add one component with a box association to the inner aggregate,\n          --  and recurse if component is itself composite.\n@@ -3834,7 +3834,9 @@ package body Sem_Aggr is\n                Build_Constrained_Itype\n                  (New_Aggr, T, Component_Associations (New_Aggr));\n             else\n-               Needs_Box := True;\n+               Add_Association\n+                 (Comp, Empty, Component_Associations (Aggr),\n+                  Is_Box_Present => True);\n             end if;\n          end Process_Component;\n \n@@ -3885,14 +3887,6 @@ package body Sem_Aggr is\n                Next_Component (Comp);\n             end loop;\n          end if;\n-\n-         if Needs_Box then\n-            Append_To (Component_Associations (Aggr),\n-              Make_Component_Association (Loc,\n-                Choices     => New_List (Make_Others_Choice (Loc)),\n-                Expression  => Empty,\n-                Box_Present => True));\n-         end if;\n       end Propagate_Discriminants;\n \n       -----------------------"}]}