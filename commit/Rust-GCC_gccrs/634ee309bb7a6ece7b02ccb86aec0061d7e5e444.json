{"sha": "634ee309bb7a6ece7b02ccb86aec0061d7e5e444", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6NjM0ZWUzMDliYjdhNmVjZTdiMDJjY2I4NmFlYzAwNjFkN2U1ZTQ0NA==", "commit": {"author": {"name": "Zdenek Dvorak", "email": "ook@ucw.cz", "date": "2011-03-05T14:28:14Z"}, "committer": {"name": "Jakub Jelinek", "email": "jakub@gcc.gnu.org", "date": "2011-03-05T14:28:14Z"}, "message": "re PR rtl-optimization/47899 (ICE in get_loop_body, at cfgloop.c:831)\n\n\tPR rtl-optimization/47899\n\t* cfgloopmanip.c (fix_bb_placements): Fix first argument\n\tto flow_loop_nested_p when moving the loop upward.\n\n\t* gcc.dg/pr47899.c: New test.\n\nFrom-SVN: r170699", "tree": {"sha": "8380a4d0ef4aacbc3059d789c8ee2360c0c3d0fc", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/8380a4d0ef4aacbc3059d789c8ee2360c0c3d0fc"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/634ee309bb7a6ece7b02ccb86aec0061d7e5e444", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/634ee309bb7a6ece7b02ccb86aec0061d7e5e444", "html_url": "https://github.com/Rust-GCC/gccrs/commit/634ee309bb7a6ece7b02ccb86aec0061d7e5e444", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/634ee309bb7a6ece7b02ccb86aec0061d7e5e444/comments", "author": {"login": "rakdver", "id": 20416833, "node_id": "MDQ6VXNlcjIwNDE2ODMz", "avatar_url": "https://avatars.githubusercontent.com/u/20416833?v=4", "gravatar_id": "", "url": "https://api.github.com/users/rakdver", "html_url": "https://github.com/rakdver", "followers_url": "https://api.github.com/users/rakdver/followers", "following_url": "https://api.github.com/users/rakdver/following{/other_user}", "gists_url": "https://api.github.com/users/rakdver/gists{/gist_id}", "starred_url": "https://api.github.com/users/rakdver/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/rakdver/subscriptions", "organizations_url": "https://api.github.com/users/rakdver/orgs", "repos_url": "https://api.github.com/users/rakdver/repos", "events_url": "https://api.github.com/users/rakdver/events{/privacy}", "received_events_url": "https://api.github.com/users/rakdver/received_events", "type": "User", "site_admin": false}, "committer": null, "parents": [{"sha": "6fe471c8ca8eddcfa7ed64b290e24758bbca669e", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/6fe471c8ca8eddcfa7ed64b290e24758bbca669e", "html_url": "https://github.com/Rust-GCC/gccrs/commit/6fe471c8ca8eddcfa7ed64b290e24758bbca669e"}], "stats": {"total": 48, "additions": 44, "deletions": 4}, "files": [{"sha": "9fd15c423ba9ad4d0f3226edb48c14f1893bf59c", "filename": "gcc/ChangeLog", "status": "modified", "additions": 6, "deletions": 0, "changes": 6, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/634ee309bb7a6ece7b02ccb86aec0061d7e5e444/gcc%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/634ee309bb7a6ece7b02ccb86aec0061d7e5e444/gcc%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2FChangeLog?ref=634ee309bb7a6ece7b02ccb86aec0061d7e5e444", "patch": "@@ -1,3 +1,9 @@\n+2011-03-05  Zdenek Dvorak  <ook@ucw.cz>\n+\n+\tPR rtl-optimization/47899\n+\t* cfgloopmanip.c (fix_bb_placements): Fix first argument\n+\tto flow_loop_nested_p when moving the loop upward.\n+\n 2011-03-05  Richard Earnshaw  <rearnsha@arm.com>\n \n \tPR target/47719"}, {"sha": "3802f9cff12d5439126d46e9f7d211b811e6e4ed", "filename": "gcc/cfgloopmanip.c", "status": "modified", "additions": 9, "deletions": 4, "changes": 13, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/634ee309bb7a6ece7b02ccb86aec0061d7e5e444/gcc%2Fcfgloopmanip.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/634ee309bb7a6ece7b02ccb86aec0061d7e5e444/gcc%2Fcfgloopmanip.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fcfgloopmanip.c?ref=634ee309bb7a6ece7b02ccb86aec0061d7e5e444", "patch": "@@ -1,5 +1,5 @@\n /* Loop manipulation code for GNU compiler.\n-   Copyright (C) 2002, 2003, 2004, 2005, 2007, 2008, 2009, 2010\n+   Copyright (C) 2002, 2003, 2004, 2005, 2007, 2008, 2009, 2010, 2011\n    Free Software Foundation, Inc.\n \n This file is part of GCC.\n@@ -174,7 +174,7 @@ fix_bb_placements (basic_block from,\n {\n   sbitmap in_queue;\n   basic_block *queue, *qtop, *qbeg, *qend;\n-  struct loop *base_loop;\n+  struct loop *base_loop, *target_loop;\n   edge e;\n \n   /* We pass through blocks back-reachable from FROM, testing whether some\n@@ -214,12 +214,14 @@ fix_bb_placements (basic_block from,\n \t  /* Subloop header, maybe move the loop upward.  */\n \t  if (!fix_loop_placement (from->loop_father))\n \t    continue;\n+\t  target_loop = loop_outer (from->loop_father);\n \t}\n       else\n \t{\n \t  /* Ordinary basic block.  */\n \t  if (!fix_bb_placement (from))\n \t    continue;\n+\t  target_loop = from->loop_father;\n \t}\n \n       FOR_EACH_EDGE (e, ei, from->succs)\n@@ -248,9 +250,12 @@ fix_bb_placements (basic_block from,\n \t      && (nca == base_loop\n \t\t  || nca != pred->loop_father))\n \t    pred = pred->loop_father->header;\n-\t  else if (!flow_loop_nested_p (from->loop_father, pred->loop_father))\n+\t  else if (!flow_loop_nested_p (target_loop, pred->loop_father))\n \t    {\n-\t      /* No point in processing it.  */\n+\t      /* If PRED is already higher in the loop hierarchy than the\n+\t\t TARGET_LOOP to that we moved FROM, the change of the position\n+\t\t of FROM does not affect the position of PRED, so there is no\n+\t\t point in processing it.  */\n \t      continue;\n \t    }\n "}, {"sha": "6edf8e279156a61ab8e3f2c3fa37330e743ffca5", "filename": "gcc/testsuite/ChangeLog", "status": "modified", "additions": 3, "deletions": 0, "changes": 3, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/634ee309bb7a6ece7b02ccb86aec0061d7e5e444/gcc%2Ftestsuite%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/634ee309bb7a6ece7b02ccb86aec0061d7e5e444/gcc%2Ftestsuite%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2FChangeLog?ref=634ee309bb7a6ece7b02ccb86aec0061d7e5e444", "patch": "@@ -1,5 +1,8 @@\n 2011-03-05  Jakub Jelinek  <jakub@redhat.com>\n \n+\tPR rtl-optimization/47899\n+\t* gcc.dg/pr47899.c: New test.\n+\n \t* gcc.dg/torture/pr47968.c: Ignore warnings.\n \n \tPR tree-optimization/47967"}, {"sha": "c83bb85e314ca2d9dc751f530a65326af3256cb8", "filename": "gcc/testsuite/gcc.dg/pr47899.c", "status": "added", "additions": 26, "deletions": 0, "changes": 26, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/634ee309bb7a6ece7b02ccb86aec0061d7e5e444/gcc%2Ftestsuite%2Fgcc.dg%2Fpr47899.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/634ee309bb7a6ece7b02ccb86aec0061d7e5e444/gcc%2Ftestsuite%2Fgcc.dg%2Fpr47899.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgcc.dg%2Fpr47899.c?ref=634ee309bb7a6ece7b02ccb86aec0061d7e5e444", "patch": "@@ -0,0 +1,26 @@\n+/* PR rtl-optimization/47899 */\n+/* { dg-do compile } */\n+/* { dg-options \"-O -funroll-loops\" } */\n+\n+extern unsigned int a, b, c;\n+extern int d;\n+\n+static int\n+foo (void)\n+{\n+lab:\n+  if (b)\n+    for (d = 0; d >= 0; d--)\n+      if (a || c)\n+\tfor (; c; c++)\n+\t  ;\n+      else\n+\tgoto lab;\n+}\n+\n+int\n+main ()\n+{\n+  foo ();\n+  return 0;\n+}"}]}