{"sha": "6a53553086657d6b4668f0c3a2030ec1f63447d0", "node_id": "C_kwDOANBUbNoAKDZhNTM1NTMwODY2NTdkNmI0NjY4ZjBjM2EyMDMwZWMxZjYzNDQ3ZDA", "commit": {"author": {"name": "Ed Schonberg", "email": "schonberg@adacore.com", "date": "2021-09-05T15:22:52Z"}, "committer": {"name": "Pierre-Marie de Rodat", "email": "derodat@adacore.com", "date": "2021-10-04T08:45:12Z"}, "message": "[Ada] Handle properly user_defined literals given by operators.\n\ngcc/ada/\n\n\t* sem_ch6.adb (Analyze_Operator_Symbol): Recognize strings as\n\toperator names when they are the value of one of the Ada2022\n\taspects for User_Defined_Literals.\n\t* sem_ch13.adb (Analyze_One_Aspect): Handle an aspect value\n\tgiven by an Operator_Name.\n\t(Validate_Literal_Aspect): Call Analyze_Operator_Symbol when\n\tneeded.", "tree": {"sha": "2658a1092bd1d06c52e095a9d8e679ccfb49517c", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/2658a1092bd1d06c52e095a9d8e679ccfb49517c"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/6a53553086657d6b4668f0c3a2030ec1f63447d0", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/6a53553086657d6b4668f0c3a2030ec1f63447d0", "html_url": "https://github.com/Rust-GCC/gccrs/commit/6a53553086657d6b4668f0c3a2030ec1f63447d0", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/6a53553086657d6b4668f0c3a2030ec1f63447d0/comments", "author": {"login": "Edschonberg", "id": 6352375, "node_id": "MDQ6VXNlcjYzNTIzNzU=", "avatar_url": "https://avatars.githubusercontent.com/u/6352375?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Edschonberg", "html_url": "https://github.com/Edschonberg", "followers_url": "https://api.github.com/users/Edschonberg/followers", "following_url": "https://api.github.com/users/Edschonberg/following{/other_user}", "gists_url": "https://api.github.com/users/Edschonberg/gists{/gist_id}", "starred_url": "https://api.github.com/users/Edschonberg/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Edschonberg/subscriptions", "organizations_url": "https://api.github.com/users/Edschonberg/orgs", "repos_url": "https://api.github.com/users/Edschonberg/repos", "events_url": "https://api.github.com/users/Edschonberg/events{/privacy}", "received_events_url": "https://api.github.com/users/Edschonberg/received_events", "type": "User", "site_admin": false}, "committer": {"login": "pmderodat", "id": 758452, "node_id": "MDQ6VXNlcjc1ODQ1Mg==", "avatar_url": "https://avatars.githubusercontent.com/u/758452?v=4", "gravatar_id": "", "url": "https://api.github.com/users/pmderodat", "html_url": "https://github.com/pmderodat", "followers_url": "https://api.github.com/users/pmderodat/followers", "following_url": "https://api.github.com/users/pmderodat/following{/other_user}", "gists_url": "https://api.github.com/users/pmderodat/gists{/gist_id}", "starred_url": "https://api.github.com/users/pmderodat/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/pmderodat/subscriptions", "organizations_url": "https://api.github.com/users/pmderodat/orgs", "repos_url": "https://api.github.com/users/pmderodat/repos", "events_url": "https://api.github.com/users/pmderodat/events{/privacy}", "received_events_url": "https://api.github.com/users/pmderodat/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "861dc87d7513f920365f0cf52be7406ca06711cf", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/861dc87d7513f920365f0cf52be7406ca06711cf", "html_url": "https://github.com/Rust-GCC/gccrs/commit/861dc87d7513f920365f0cf52be7406ca06711cf"}], "stats": {"total": 31, "additions": 27, "deletions": 4}, "files": [{"sha": "412855490d386ac475ddaeb0aa164834507c85f9", "filename": "gcc/ada/sem_ch13.adb", "status": "modified", "additions": 18, "deletions": 2, "changes": 20, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/6a53553086657d6b4668f0c3a2030ec1f63447d0/gcc%2Fada%2Fsem_ch13.adb", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/6a53553086657d6b4668f0c3a2030ec1f63447d0/gcc%2Fada%2Fsem_ch13.adb", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fada%2Fsem_ch13.adb?ref=6a53553086657d6b4668f0c3a2030ec1f63447d0", "patch": "@@ -2991,7 +2991,15 @@ package body Sem_Ch13 is\n             --  Copy expression for later processing by the procedures\n             --  Check_Aspect_At_[Freeze_Point | End_Of_Declarations]\n \n-            Set_Entity (Id, New_Copy_Tree (Expr));\n+            --  The expression may be a subprogram name, and can\n+            --  be an operator name that appears as a string, but\n+            --  requires its own analysis procedure (see sem_ch6).\n+\n+            if Nkind (Expr) = N_Operator_Symbol then\n+               Set_Entity (Id, Expr);\n+            else\n+               Set_Entity (Id, New_Copy_Tree (Expr));\n+            end if;\n \n             --  Set Delay_Required as appropriate to aspect\n \n@@ -16668,7 +16676,15 @@ package body Sem_Ch13 is\n       end if;\n \n       if not Overloaded and then not Present (Entity (Func_Name)) then\n-         Analyze (Func_Name);\n+         --  The aspect is specified by a subprogram name, which\n+         --  may be an operator name given originally by a string.\n+\n+         if Is_Operator_Name (Chars (Func_Name)) then\n+            Analyze_Operator_Symbol (Func_Name);\n+         else\n+            Analyze (Func_Name);\n+         end if;\n+\n          Overloaded := Is_Overloaded (Func_Name);\n       end if;\n "}, {"sha": "e32c4ad504c1414cd642d88b75362b33bcf548f2", "filename": "gcc/ada/sem_ch6.adb", "status": "modified", "additions": 9, "deletions": 2, "changes": 11, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/6a53553086657d6b4668f0c3a2030ec1f63447d0/gcc%2Fada%2Fsem_ch6.adb", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/6a53553086657d6b4668f0c3a2030ec1f63447d0/gcc%2Fada%2Fsem_ch6.adb", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fada%2Fsem_ch6.adb?ref=6a53553086657d6b4668f0c3a2030ec1f63447d0", "patch": "@@ -2126,8 +2126,15 @@ package body Sem_Ch6 is\n                   and then Attribute_Name (Par) /= Name_Value)\n         or else (Nkind (Maybe_Aspect_Spec) = N_Aspect_Specification\n                   and then Get_Aspect_Id (Maybe_Aspect_Spec)\n-                            --  include other aspects here ???\n-                            in Aspect_Stable_Properties | Aspect_Aggregate)\n+\n+                            --  Include aspects that can be specified by a\n+                            --  subprogram name, which can be an operator.\n+\n+                            in  Aspect_Stable_Properties\n+                              | Aspect_Integer_Literal\n+                              | Aspect_Real_Literal\n+                              | Aspect_String_Literal\n+                              | Aspect_Aggregate)\n       then\n          Find_Direct_Name (N);\n "}]}