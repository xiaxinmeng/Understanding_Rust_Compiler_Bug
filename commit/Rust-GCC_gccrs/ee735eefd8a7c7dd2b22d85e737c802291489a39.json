{"sha": "ee735eefd8a7c7dd2b22d85e737c802291489a39", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6ZWU3MzVlZWZkOGE3YzdkZDJiMjJkODVlNzM3YzgwMjI5MTQ4OWEzOQ==", "commit": {"author": {"name": "Josef Zlomek", "email": "zlomekj@suse.cz", "date": "2003-07-21T17:18:00Z"}, "committer": {"name": "Josef Zlomek", "email": "zlomek@gcc.gnu.org", "date": "2003-07-21T17:18:00Z"}, "message": "cfgcleanup.c (merge_blocks_move_successor_nojumps): Use tablejump_p.\n\n\t* cfgcleanup.c (merge_blocks_move_successor_nojumps): Use tablejump_p.\n\t* rtlanal.c (tablejump_p): Use next_active_insn for finding the jump\n\ttable.\n\nFrom-SVN: r69637", "tree": {"sha": "bcd516494e3a3a432b0f74413525c76618b44685", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/bcd516494e3a3a432b0f74413525c76618b44685"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/ee735eefd8a7c7dd2b22d85e737c802291489a39", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/ee735eefd8a7c7dd2b22d85e737c802291489a39", "html_url": "https://github.com/Rust-GCC/gccrs/commit/ee735eefd8a7c7dd2b22d85e737c802291489a39", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/ee735eefd8a7c7dd2b22d85e737c802291489a39/comments", "author": null, "committer": null, "parents": [{"sha": "f345c6b5225e3d4d64686f8b045c4a7bbf016cf0", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/f345c6b5225e3d4d64686f8b045c4a7bbf016cf0", "html_url": "https://github.com/Rust-GCC/gccrs/commit/f345c6b5225e3d4d64686f8b045c4a7bbf016cf0"}], "stats": {"total": 54, "additions": 27, "deletions": 27}, "files": [{"sha": "1a78a427f4c506ad93f174e12e39499be55cb82c", "filename": "gcc/ChangeLog", "status": "modified", "additions": 6, "deletions": 0, "changes": 6, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/ee735eefd8a7c7dd2b22d85e737c802291489a39/gcc%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/ee735eefd8a7c7dd2b22d85e737c802291489a39/gcc%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2FChangeLog?ref=ee735eefd8a7c7dd2b22d85e737c802291489a39", "patch": "@@ -1,3 +1,9 @@\n+2003-07-21  Josef Zlomek  <zlomekj@suse.cz>\n+\n+\t* cfgcleanup.c (merge_blocks_move_successor_nojumps): Use tablejump_p.\n+\t* rtlanal.c (tablejump_p): Use next_active_insn for finding the jump\n+\ttable.\n+\n 2003-07-17  Eric Botcazou  <ebotcazou@libertysurf.fr>\n \n         PR optimization/11536"}, {"sha": "d03a16d88f96a892683eff4e77466184c2cde56e", "filename": "gcc/cfgcleanup.c", "status": "modified", "additions": 7, "deletions": 12, "changes": 19, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/ee735eefd8a7c7dd2b22d85e737c802291489a39/gcc%2Fcfgcleanup.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/ee735eefd8a7c7dd2b22d85e737c802291489a39/gcc%2Fcfgcleanup.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fcfgcleanup.c?ref=ee735eefd8a7c7dd2b22d85e737c802291489a39", "patch": "@@ -714,25 +714,20 @@ static void\n merge_blocks_move_successor_nojumps (basic_block a, basic_block b)\n {\n   rtx barrier, real_b_end;\n+  rtx label, table;\n \n   real_b_end = b->end;\n-  barrier = NEXT_INSN (b->end);\n \n-  /* Recognize a jump table following block B.  */\n-  if (barrier\n-      && GET_CODE (barrier) == CODE_LABEL\n-      && NEXT_INSN (barrier)\n-      && GET_CODE (NEXT_INSN (barrier)) == JUMP_INSN\n-      && (GET_CODE (PATTERN (NEXT_INSN (barrier))) == ADDR_VEC\n-\t  || GET_CODE (PATTERN (NEXT_INSN (barrier))) == ADDR_DIFF_VEC))\n+  /* If there is a jump table following block B temporarily add the jump table\n+     to block B so that it will also be moved to the correct location.  */\n+  if (tablejump_p (b->end, &label, &table)\n+      && prev_active_insn (label) == b->end)\n     {\n-      /* Temporarily add the table jump insn to b, so that it will also\n-\t be moved to the correct location.  */\n-      b->end = NEXT_INSN (barrier);\n-      barrier = NEXT_INSN (b->end);\n+      b->end = table;\n     }\n \n   /* There had better have been a barrier there.  Delete it.  */\n+  barrier = NEXT_INSN (b->end);\n   if (barrier && GET_CODE (barrier) == BARRIER)\n     delete_insn (barrier);\n "}, {"sha": "55c1020f3fb8876c67b9688f654d16df2d35e20a", "filename": "gcc/rtlanal.c", "status": "modified", "additions": 14, "deletions": 15, "changes": 29, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/ee735eefd8a7c7dd2b22d85e737c802291489a39/gcc%2Frtlanal.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/ee735eefd8a7c7dd2b22d85e737c802291489a39/gcc%2Frtlanal.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Frtlanal.c?ref=ee735eefd8a7c7dd2b22d85e737c802291489a39", "patch": "@@ -2795,26 +2795,25 @@ rtx_referenced_p (rtx x, rtx body)\n   return for_each_rtx (&body, rtx_referenced_p_1, x);\n }\n \n-/* If INSN is a jump to jumptable insn rturn true and store the label (which\n-   INSN jumps to) to *LABEL and the tablejump insn to *TABLE.\n-   LABEL and TABLE may be NULL.  */\n+/* If INSN is a tablejump return true and store the label (before jump table) to\n+   *LABELP and the jump table to *TABLEP.  LABELP and TABLEP may be NULL.  */\n \n bool\n-tablejump_p (rtx insn, rtx *label, rtx *table)\n+tablejump_p (rtx insn, rtx *labelp, rtx *tablep)\n {\n-  rtx l, t;\n+  rtx label, table;\n \n-  if (onlyjump_p (insn)\n-      && (l = JUMP_LABEL (insn)) != NULL_RTX\n-      && (t = NEXT_INSN (l)) != NULL_RTX\n-      && GET_CODE (t) == JUMP_INSN\n-      && (GET_CODE (PATTERN (t)) == ADDR_VEC\n-\t  || GET_CODE (PATTERN (t)) == ADDR_DIFF_VEC))\n+  if (GET_CODE (insn) == JUMP_INSN\n+      && (label = JUMP_LABEL (insn)) != NULL_RTX\n+      && (table = next_active_insn (label)) != NULL_RTX\n+      && GET_CODE (table) == JUMP_INSN\n+      && (GET_CODE (PATTERN (table)) == ADDR_VEC\n+\t  || GET_CODE (PATTERN (table)) == ADDR_DIFF_VEC))\n     {\n-      if (label)\n-\t*label = l;\n-      if (table)\n-\t*table = t;\n+      if (labelp)\n+\t*labelp = label;\n+      if (tablep)\n+\t*tablep = table;\n       return true;\n     }\n   return false;"}]}