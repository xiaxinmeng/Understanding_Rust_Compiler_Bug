{"sha": "8c266ffa32d238cc400fa8ed92448de789f67739", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6OGMyNjZmZmEzMmQyMzhjYzQwMGZhOGVkOTI0NDhkZTc4OWY2NzczOQ==", "commit": {"author": {"name": "Steven Bosscher", "email": "steven@gcc.gnu.org", "date": "2012-10-17T06:15:38Z"}, "committer": {"name": "Steven Bosscher", "email": "steven@gcc.gnu.org", "date": "2012-10-17T06:15:38Z"}, "message": "df-problems.c (df_kill_notes): Split up in two functions.\n\n\t* df-problems.c (df_kill_notes): Split up in two functions.\n\t(df_remove_dead_and_unused_notes): New function, first half of\n\tdf_kill notes to remove all REG_DEAD and REG_UNUSED notes.\n\t(df_remove_dead_eq_notes): New function, second half of df_kill_notes\n\tto remove REG_EQUAL and REG_EQUIV notes referring to dead registers.\n\t(df_note_bb_compute): Call df_remove_dead_and_unused_notes instead\n\tof df_kill_notes.  Call df_remove_dead_eq_notes after processing insn.\n\n\t* web.c (web): Re-add DF_RD_PRUNE_DEAD_DEFS;\n\nFrom-SVN: r192526", "tree": {"sha": "fef0784fa67a3a57115f1178eca84b52d9a8e0aa", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/fef0784fa67a3a57115f1178eca84b52d9a8e0aa"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/8c266ffa32d238cc400fa8ed92448de789f67739", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/8c266ffa32d238cc400fa8ed92448de789f67739", "html_url": "https://github.com/Rust-GCC/gccrs/commit/8c266ffa32d238cc400fa8ed92448de789f67739", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/8c266ffa32d238cc400fa8ed92448de789f67739/comments", "author": null, "committer": null, "parents": [{"sha": "d564b816874a443ae3ced1f11b48633abe412cc3", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/d564b816874a443ae3ced1f11b48633abe412cc3", "html_url": "https://github.com/Rust-GCC/gccrs/commit/d564b816874a443ae3ced1f11b48633abe412cc3"}], "stats": {"total": 49, "additions": 40, "deletions": 9}, "files": [{"sha": "72b9e142957434e111701d5797891c770b5931ca", "filename": "gcc/ChangeLog", "status": "modified", "additions": 12, "deletions": 0, "changes": 12, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/8c266ffa32d238cc400fa8ed92448de789f67739/gcc%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/8c266ffa32d238cc400fa8ed92448de789f67739/gcc%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2FChangeLog?ref=8c266ffa32d238cc400fa8ed92448de789f67739", "patch": "@@ -1,3 +1,15 @@\n+2012-10-16  Steven Bosscher  <steven@gcc.gnu.org>\n+\n+\t* df-problems.c (df_kill_notes): Split up in two functions.\n+\t(df_remove_dead_and_unused_notes): New function, first half of\n+\tdf_kill notes to remove all REG_DEAD and REG_UNUSED notes.\n+\t(df_remove_dead_eq_notes): New function, second half of df_kill_notes\n+\tto remove REG_EQUAL and REG_EQUIV notes referring to dead registers.\n+\t(df_note_bb_compute): Call df_remove_dead_and_unused_notes instead\n+\tof df_kill_notes.  Call df_remove_dead_eq_notes after processing insn.\n+\n+\t* web.c (web): Re-add DF_RD_PRUNE_DEAD_DEFS;\n+\n 2012-10-16  Ian Lance Taylor  <iant@google.com>\n \n \t* doc/extend.texi (Return Address): Change"}, {"sha": "3f9228dc53ad7e3a4930cc49ea086e8ac45d216f", "filename": "gcc/df-problems.c", "status": "modified", "additions": 27, "deletions": 7, "changes": 34, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/8c266ffa32d238cc400fa8ed92448de789f67739/gcc%2Fdf-problems.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/8c266ffa32d238cc400fa8ed92448de789f67739/gcc%2Fdf-problems.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fdf-problems.c?ref=8c266ffa32d238cc400fa8ed92448de789f67739", "patch": "@@ -2822,13 +2822,10 @@ df_ignore_stack_reg (int regno ATTRIBUTE_UNUSED)\n #endif\n \n \n-/* Remove all of the REG_DEAD or REG_UNUSED notes from INSN and add\n-   them to OLD_DEAD_NOTES and OLD_UNUSED_NOTES.  Remove also\n-   REG_EQUAL/REG_EQUIV notes referring to dead pseudos using LIVE\n-   as the bitmap of currently live registers.  */\n+/* Remove all of the REG_DEAD or REG_UNUSED notes from INSN.  */\n \n static void\n-df_kill_notes (rtx insn, bitmap live)\n+df_remove_dead_and_unused_notes (rtx insn)\n {\n   rtx *pprev = &REG_NOTES (insn);\n   rtx link = *pprev;\n@@ -2873,6 +2870,27 @@ df_kill_notes (rtx insn, bitmap live)\n \t    }\n \t  break;\n \n+\tdefault:\n+\t  pprev = &XEXP (link, 1);\n+\t  link = *pprev;\n+\t  break;\n+\t}\n+    }\n+}\n+\n+/* Remove REG_EQUAL/REG_EQUIV notes referring to dead pseudos using LIVE\n+   as the bitmap of currently live registers.  */\n+\n+static void\n+df_remove_dead_eq_notes (rtx insn, bitmap live)\n+{\n+  rtx *pprev = &REG_NOTES (insn);\n+  rtx link = *pprev;\n+\n+  while (link)\n+    {\n+      switch (REG_NOTE_KIND (link))\n+\t{\n \tcase REG_EQUAL:\n \tcase REG_EQUIV:\n \t  {\n@@ -2913,6 +2931,7 @@ df_kill_notes (rtx insn, bitmap live)\n \t      }\n \t    break;\n \t  }\n+\n \tdefault:\n \t  pprev = &XEXP (link, 1);\n \t  link = *pprev;\n@@ -2921,7 +2940,6 @@ df_kill_notes (rtx insn, bitmap live)\n     }\n }\n \n-\n /* Set a NOTE_TYPE note for REG in INSN.  */\n \n static inline void\n@@ -3195,7 +3213,7 @@ df_note_bb_compute (unsigned int bb_index,\n       debug_insn = DEBUG_INSN_P (insn);\n \n       bitmap_clear (do_not_gen);\n-      df_kill_notes (insn, live);\n+      df_remove_dead_and_unused_notes (insn);\n \n       /* Process the defs.  */\n       if (CALL_P (insn))\n@@ -3336,6 +3354,8 @@ df_note_bb_compute (unsigned int bb_index,\n \t    }\n \t}\n \n+      df_remove_dead_eq_notes (insn, live);\n+\n       if (debug_insn == -1)\n \t{\n \t  /* ??? We could probably do better here, replacing dead"}, {"sha": "d56563430c2433a24f54e379e3552d829e6ddca3", "filename": "gcc/web.c", "status": "modified", "additions": 1, "deletions": 2, "changes": 3, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/8c266ffa32d238cc400fa8ed92448de789f67739/gcc%2Fweb.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/8c266ffa32d238cc400fa8ed92448de789f67739/gcc%2Fweb.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fweb.c?ref=8c266ffa32d238cc400fa8ed92448de789f67739", "patch": "@@ -336,8 +336,7 @@ web_main (void)\n   rtx insn;\n \n   df_set_flags (DF_NO_HARD_REGS + DF_EQ_NOTES);\n-  /* We can not RD_PRUNE_DEAD_DEFS, because we care about REG_EQUAL\n-     notes.  */\n+  df_set_flags (DF_RD_PRUNE_DEAD_DEFS);\n   df_chain_add_problem (DF_UD_CHAIN);\n   df_analyze ();\n   df_set_flags (DF_DEFER_INSN_RESCAN);"}]}