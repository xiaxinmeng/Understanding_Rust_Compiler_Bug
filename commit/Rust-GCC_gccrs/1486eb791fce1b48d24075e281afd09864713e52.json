{"sha": "1486eb791fce1b48d24075e281afd09864713e52", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6MTQ4NmViNzkxZmNlMWI0OGQyNDA3NWUyODFhZmQwOTg2NDcxM2U1Mg==", "commit": {"author": {"name": "Martin Sebor", "email": "msebor@redhat.com", "date": "2018-12-11T01:22:08Z"}, "committer": {"name": "Martin Sebor", "email": "msebor@gcc.gnu.org", "date": "2018-12-11T01:22:08Z"}, "message": "PR tree-optimization/86196 - Bogus -Wrestrict on memcpy between array elements at unequal indices\n\ngcc/ChangeLog:\n\n\tPR tree-optimization/86196\n\t* gimple-ssa-warn-restrict.c (builtin_memref::builtin_memref): Use\n\tbase size only of arrays.\n\ngcc/testsuite/ChangeLog:\n\n\tPR tree-optimization/86196\n\t* gcc.dg/Wrestrict-18.c: New test.\n\nFrom-SVN: r266967", "tree": {"sha": "67f9b03a71809c4fd08239f8335cf2235efe5765", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/67f9b03a71809c4fd08239f8335cf2235efe5765"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/1486eb791fce1b48d24075e281afd09864713e52", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/1486eb791fce1b48d24075e281afd09864713e52", "html_url": "https://github.com/Rust-GCC/gccrs/commit/1486eb791fce1b48d24075e281afd09864713e52", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/1486eb791fce1b48d24075e281afd09864713e52/comments", "author": {"login": "msebor", "id": 381149, "node_id": "MDQ6VXNlcjM4MTE0OQ==", "avatar_url": "https://avatars.githubusercontent.com/u/381149?v=4", "gravatar_id": "", "url": "https://api.github.com/users/msebor", "html_url": "https://github.com/msebor", "followers_url": "https://api.github.com/users/msebor/followers", "following_url": "https://api.github.com/users/msebor/following{/other_user}", "gists_url": "https://api.github.com/users/msebor/gists{/gist_id}", "starred_url": "https://api.github.com/users/msebor/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/msebor/subscriptions", "organizations_url": "https://api.github.com/users/msebor/orgs", "repos_url": "https://api.github.com/users/msebor/repos", "events_url": "https://api.github.com/users/msebor/events{/privacy}", "received_events_url": "https://api.github.com/users/msebor/received_events", "type": "User", "site_admin": false}, "committer": null, "parents": [{"sha": "03da9b757be0d4b2b1770c10f7e6f68d286a01da", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/03da9b757be0d4b2b1770c10f7e6f68d286a01da", "html_url": "https://github.com/Rust-GCC/gccrs/commit/03da9b757be0d4b2b1770c10f7e6f68d286a01da"}], "stats": {"total": 68, "additions": 59, "deletions": 9}, "files": [{"sha": "14c52ad64bec43ef731ec281d3aef4bf522bb70b", "filename": "gcc/ChangeLog", "status": "modified", "additions": 6, "deletions": 0, "changes": 6, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/1486eb791fce1b48d24075e281afd09864713e52/gcc%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/1486eb791fce1b48d24075e281afd09864713e52/gcc%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2FChangeLog?ref=1486eb791fce1b48d24075e281afd09864713e52", "patch": "@@ -1,3 +1,9 @@\n+2018-12-10  Martin Sebor  <msebor@redhat.com>\n+\n+\tPR tree-optimization/86196\n+\t* gimple-ssa-warn-restrict.c (builtin_memref::builtin_memref): Use\n+\tbase size only of arrays.\n+\n 2018-12-10  Segher Boessenkool  <segher@kernel.crashing.org>\n \n \t* config.gcc (Obsolete configurations): Delete powerpc*-*-*spe*."}, {"sha": "d47f73f7be65bd603d62cc33f058213a9729a5a6", "filename": "gcc/gimple-ssa-warn-restrict.c", "status": "modified", "additions": 10, "deletions": 9, "changes": 19, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/1486eb791fce1b48d24075e281afd09864713e52/gcc%2Fgimple-ssa-warn-restrict.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/1486eb791fce1b48d24075e281afd09864713e52/gcc%2Fgimple-ssa-warn-restrict.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fgimple-ssa-warn-restrict.c?ref=1486eb791fce1b48d24075e281afd09864713e52", "patch": "@@ -272,15 +272,16 @@ builtin_memref::builtin_memref (tree expr, tree size)\n \n   offset_int maxoff = maxobjsize;\n   tree basetype = TREE_TYPE (base);\n-  if (TREE_CODE (basetype) == ARRAY_TYPE\n-      && ref\n-      && array_at_struct_end_p (ref))\n-    ;   /* Use the maximum possible offset for last member arrays.  */\n-  else if (tree basesize = TYPE_SIZE_UNIT (basetype))\n-    if (TREE_CODE (basesize) == INTEGER_CST)\n-      /* Size could be non-constant for a variable-length type such\n-\t as a struct with a VLA member (a GCC extension).  */\n-      maxoff = wi::to_offset (basesize);\n+  if (TREE_CODE (basetype) == ARRAY_TYPE)\n+    {\n+      if (ref && array_at_struct_end_p (ref))\n+\t;   /* Use the maximum possible offset for last member arrays.  */\n+      else if (tree basesize = TYPE_SIZE_UNIT (basetype))\n+\tif (TREE_CODE (basesize) == INTEGER_CST)\n+\t  /* Size could be non-constant for a variable-length type such\n+\t     as a struct with a VLA member (a GCC extension).  */\n+\t  maxoff = wi::to_offset (basesize);\n+    }\n \n   if (offrange[0] >= 0)\n     {"}, {"sha": "414ecd3c74f60582515b2f86ff4fc4a908a775b3", "filename": "gcc/testsuite/ChangeLog", "status": "modified", "additions": 6, "deletions": 0, "changes": 6, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/1486eb791fce1b48d24075e281afd09864713e52/gcc%2Ftestsuite%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/1486eb791fce1b48d24075e281afd09864713e52/gcc%2Ftestsuite%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2FChangeLog?ref=1486eb791fce1b48d24075e281afd09864713e52", "patch": "@@ -1,3 +1,9 @@\n+2018-12-10  Martin Sebor  <msebor@redhat.com>\n+\n+\tPR tree-optimization/86196\n+\t* gimple-ssa-warn-restrict.c (builtin_memref::builtin_memref): Use\n+\tbase size only of arrays.\n+\n 2018-12-10  Uros Bizjak  <ubizjak@gmail.com>\n \n \t* gcc.dg/sinatan-1.c: Use dg-add-options ieee."}, {"sha": "dbad9566bd3e42587c18ac763c397392aa59bee6", "filename": "gcc/testsuite/gcc.dg/Wrestrict-18.c", "status": "added", "additions": 37, "deletions": 0, "changes": 37, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/1486eb791fce1b48d24075e281afd09864713e52/gcc%2Ftestsuite%2Fgcc.dg%2FWrestrict-18.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/1486eb791fce1b48d24075e281afd09864713e52/gcc%2Ftestsuite%2Fgcc.dg%2FWrestrict-18.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgcc.dg%2FWrestrict-18.c?ref=1486eb791fce1b48d24075e281afd09864713e52", "patch": "@@ -0,0 +1,37 @@\n+/* PR tree-optimization/86196 - Bogus -Wrestrict on memcpy between array\n+   elements at unequal indices\n+   { dg-do compile }\n+   { dg-options \"-O2 -Wall\" } */\n+\n+typedef __SIZE_TYPE__ size_t;\n+\n+extern void* memcpy (void*, const void*, size_t);\n+\n+struct S\n+{\n+  int n;\n+  void * p;\n+};\n+\n+/* Test case submitted in the PR.  */\n+\n+void pr86196_c0 (struct S * a, size_t n)\n+{\n+  for (size_t i = 0, j = 0; i != n; ++i)\n+    {\n+      if (a[i].n == 0)\n+\t{\n+\t  if (i != j)\n+\t    memcpy (&a[j], &a[i], sizeof (struct S));   /* { dg-bogus \"\\\\\\[-Wrestrict\" } */\n+\t  ++j;\n+\t}\n+    }\n+}\n+\n+/* Reduced test case.  */\n+\n+void pr86196_c1 (struct S *a, int i, int j)\n+{\n+  if (i != j)\n+    memcpy (&a[j], &a[i], sizeof (struct S));   /* { dg-bogus \"\\\\\\[-Wrestrict\" } */\n+}"}]}