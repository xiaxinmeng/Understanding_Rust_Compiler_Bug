{"sha": "8bda7ce8ec8b5c61b03082d76b5ce33b14a7288a", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6OGJkYTdjZThlYzhiNWM2MWIwMzA4MmQ3NmI1Y2UzM2IxNGE3Mjg4YQ==", "commit": {"author": {"name": "Martin Jambor", "email": "mjambor@suse.cz", "date": "2019-12-18T16:08:09Z"}, "committer": {"name": "Martin Jambor", "email": "jamborm@gcc.gnu.org", "date": "2019-12-18T16:08:09Z"}, "message": "IPA-CP: Remove bogus static keyword (PR 92971)\n\n2019-12-18  Martin Jambor  <mjambor@suse.cz>\n\n\tPR ipa/92971\n\t* ipa-cp.c (cgraph_edge_brings_all_agg_vals_for_node): Fix\n          definition of values, release memory on exit.\n\n\ttestsuite/\n\t* gcc.dg/ipa/ipcp-agg-12.c: New test.\n\nFrom-SVN: r279525", "tree": {"sha": "691975280b6886f40f90681dec07252e61b34eea", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/691975280b6886f40f90681dec07252e61b34eea"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/8bda7ce8ec8b5c61b03082d76b5ce33b14a7288a", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/8bda7ce8ec8b5c61b03082d76b5ce33b14a7288a", "html_url": "https://github.com/Rust-GCC/gccrs/commit/8bda7ce8ec8b5c61b03082d76b5ce33b14a7288a", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/8bda7ce8ec8b5c61b03082d76b5ce33b14a7288a/comments", "author": {"login": "jamborm", "id": 2180070, "node_id": "MDQ6VXNlcjIxODAwNzA=", "avatar_url": "https://avatars.githubusercontent.com/u/2180070?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jamborm", "html_url": "https://github.com/jamborm", "followers_url": "https://api.github.com/users/jamborm/followers", "following_url": "https://api.github.com/users/jamborm/following{/other_user}", "gists_url": "https://api.github.com/users/jamborm/gists{/gist_id}", "starred_url": "https://api.github.com/users/jamborm/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jamborm/subscriptions", "organizations_url": "https://api.github.com/users/jamborm/orgs", "repos_url": "https://api.github.com/users/jamborm/repos", "events_url": "https://api.github.com/users/jamborm/events{/privacy}", "received_events_url": "https://api.github.com/users/jamborm/received_events", "type": "User", "site_admin": false}, "committer": null, "parents": [{"sha": "15ef05444f18a9a690e4484f24a523c6aed59896", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/15ef05444f18a9a690e4484f24a523c6aed59896", "html_url": "https://github.com/Rust-GCC/gccrs/commit/15ef05444f18a9a690e4484f24a523c6aed59896"}], "stats": {"total": 68, "additions": 66, "deletions": 2}, "files": [{"sha": "51e45a82e48d0d05ee64d790b45f5ed58f55ae3d", "filename": "gcc/ChangeLog", "status": "modified", "additions": 6, "deletions": 0, "changes": 6, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/8bda7ce8ec8b5c61b03082d76b5ce33b14a7288a/gcc%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/8bda7ce8ec8b5c61b03082d76b5ce33b14a7288a/gcc%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2FChangeLog?ref=8bda7ce8ec8b5c61b03082d76b5ce33b14a7288a", "patch": "@@ -1,3 +1,9 @@\n+2019-12-18  Martin Jambor  <mjambor@suse.cz>\n+\n+\tPR ipa/92971\n+\t* ipa-cp.c (cgraph_edge_brings_all_agg_vals_for_node): Fix\n+          definition of values, release memory on exit.\n+\n 2019-12-17  Jan Hubicka  <hubicka@ucw.cz>\n \t    Martin Jambor  <mjambor@suse.cz>\n "}, {"sha": "243b064ee2ca510c7e4a0384aa17250b2974804b", "filename": "gcc/ipa-cp.c", "status": "modified", "additions": 2, "deletions": 2, "changes": 4, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/8bda7ce8ec8b5c61b03082d76b5ce33b14a7288a/gcc%2Fipa-cp.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/8bda7ce8ec8b5c61b03082d76b5ce33b14a7288a/gcc%2Fipa-cp.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fipa-cp.c?ref=8bda7ce8ec8b5c61b03082d76b5ce33b14a7288a", "patch": "@@ -5117,7 +5117,6 @@ cgraph_edge_brings_all_agg_vals_for_node (struct cgraph_edge *cs,\n \n   for (i = 0; i < count; i++)\n     {\n-      static vec<ipa_agg_value> values = vNULL;\n       class ipcp_param_lattices *plats;\n       bool interesting = false;\n       for (struct ipa_agg_replacement_value *av = aggval; av; av = av->next)\n@@ -5133,7 +5132,7 @@ cgraph_edge_brings_all_agg_vals_for_node (struct cgraph_edge *cs,\n       if (plats->aggs_bottom)\n \treturn false;\n \n-      values = intersect_aggregates_with_edge (cs, i, values);\n+      vec<ipa_agg_value> values = intersect_aggregates_with_edge (cs, i, vNULL);\n       if (!values.exists ())\n \treturn false;\n \n@@ -5157,6 +5156,7 @@ cgraph_edge_brings_all_agg_vals_for_node (struct cgraph_edge *cs,\n \t\treturn false;\n \t      }\n \t  }\n+      values.release ();\n     }\n   return true;\n }"}, {"sha": "df1299dc9bf0c4695724fb6b8236d93e49984b6f", "filename": "gcc/testsuite/ChangeLog", "status": "modified", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/8bda7ce8ec8b5c61b03082d76b5ce33b14a7288a/gcc%2Ftestsuite%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/8bda7ce8ec8b5c61b03082d76b5ce33b14a7288a/gcc%2Ftestsuite%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2FChangeLog?ref=8bda7ce8ec8b5c61b03082d76b5ce33b14a7288a", "patch": "@@ -1,3 +1,8 @@\n+2019-12-18  Martin Jambor  <mjambor@suse.cz>\n+\n+\tPR ipa/92971\n+\t* gcc.dg/ipa/ipcp-agg-12.c: New test.\n+\n 2019-12-17  Jan Hubicka  <hubicka@ucw.cz>\n \t    Martin Jambor  <mjambor@suse.cz>\n "}, {"sha": "5c57913803ea3b788242cf36407992f929d2dc03", "filename": "gcc/testsuite/gcc.dg/ipa/ipcp-agg-12.c", "status": "added", "additions": 53, "deletions": 0, "changes": 53, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/8bda7ce8ec8b5c61b03082d76b5ce33b14a7288a/gcc%2Ftestsuite%2Fgcc.dg%2Fipa%2Fipcp-agg-12.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/8bda7ce8ec8b5c61b03082d76b5ce33b14a7288a/gcc%2Ftestsuite%2Fgcc.dg%2Fipa%2Fipcp-agg-12.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgcc.dg%2Fipa%2Fipcp-agg-12.c?ref=8bda7ce8ec8b5c61b03082d76b5ce33b14a7288a", "patch": "@@ -0,0 +1,53 @@\n+/* { dg-do compile } */\n+/* { dg-options \"-O3 -fno-ipa-sra -fdump-ipa-cp-details --param=ipa-cp-eval-threshold=2\"  } */\n+\n+struct S\n+{\n+  int a, b, c;\n+};\n+\n+int __attribute__((noinline)) foo (int i, struct S s);\n+int __attribute__((noinline)) bar (int i, struct S s);\n+int __attribute__((noinline)) baz (int i, struct S s);\n+\n+\n+int __attribute__((noinline))\n+bar (int i, struct S s)\n+{\n+  return baz (i, s);\n+}\n+\n+int __attribute__((noinline))\n+baz (int i, struct S s)\n+{\n+  return foo (i, s);\n+}\n+\n+int __attribute__((noinline))\n+foo (int i, struct S s)\n+{\n+  if (i == 2)\n+    return 0;\n+  else\n+    return s.b * s.b + bar (i - 1, s);\n+}\n+\n+volatile int g;\n+\n+void entry (void)\n+{\n+  struct S s;\n+  s.b = 4;\n+  g = bar (g, s);\n+}\n+\n+\n+void entry2 (void)\n+{\n+  struct S s;\n+  s.b = 6;\n+  g = baz (g, s);\n+}\n+\n+\n+/* { dg-final { scan-ipa-dump-times \"adding an extra caller\" 2 \"cp\" } } */"}]}