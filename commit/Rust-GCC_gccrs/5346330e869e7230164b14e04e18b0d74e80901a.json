{"sha": "5346330e869e7230164b14e04e18b0d74e80901a", "node_id": "C_kwDOANBUbNoAKDUzNDYzMzBlODY5ZTcyMzAxNjRiMTRlMDRlMThiMGQ3NGU4MDkwMWE", "commit": {"author": {"name": "Arthur Cohen", "email": "arthur.cohen@embecosm.com", "date": "2022-10-11T09:38:55Z"}, "committer": {"name": "Arthur Cohen", "email": "arthur.cohen@embecosm.com", "date": "2022-10-11T13:55:41Z"}, "message": "mappings: Add MacroInvocation -> MacroRulesDef mappings", "tree": {"sha": "d85b6ad674424e4f92f20d3be44a3d44b129dbd1", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/d85b6ad674424e4f92f20d3be44a3d44b129dbd1"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/5346330e869e7230164b14e04e18b0d74e80901a", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/5346330e869e7230164b14e04e18b0d74e80901a", "html_url": "https://github.com/Rust-GCC/gccrs/commit/5346330e869e7230164b14e04e18b0d74e80901a", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/5346330e869e7230164b14e04e18b0d74e80901a/comments", "author": {"login": "CohenArthur", "id": 43524065, "node_id": "MDQ6VXNlcjQzNTI0MDY1", "avatar_url": "https://avatars.githubusercontent.com/u/43524065?v=4", "gravatar_id": "", "url": "https://api.github.com/users/CohenArthur", "html_url": "https://github.com/CohenArthur", "followers_url": "https://api.github.com/users/CohenArthur/followers", "following_url": "https://api.github.com/users/CohenArthur/following{/other_user}", "gists_url": "https://api.github.com/users/CohenArthur/gists{/gist_id}", "starred_url": "https://api.github.com/users/CohenArthur/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/CohenArthur/subscriptions", "organizations_url": "https://api.github.com/users/CohenArthur/orgs", "repos_url": "https://api.github.com/users/CohenArthur/repos", "events_url": "https://api.github.com/users/CohenArthur/events{/privacy}", "received_events_url": "https://api.github.com/users/CohenArthur/received_events", "type": "User", "site_admin": false}, "committer": {"login": "CohenArthur", "id": 43524065, "node_id": "MDQ6VXNlcjQzNTI0MDY1", "avatar_url": "https://avatars.githubusercontent.com/u/43524065?v=4", "gravatar_id": "", "url": "https://api.github.com/users/CohenArthur", "html_url": "https://github.com/CohenArthur", "followers_url": "https://api.github.com/users/CohenArthur/followers", "following_url": "https://api.github.com/users/CohenArthur/following{/other_user}", "gists_url": "https://api.github.com/users/CohenArthur/gists{/gist_id}", "starred_url": "https://api.github.com/users/CohenArthur/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/CohenArthur/subscriptions", "organizations_url": "https://api.github.com/users/CohenArthur/orgs", "repos_url": "https://api.github.com/users/CohenArthur/repos", "events_url": "https://api.github.com/users/CohenArthur/events{/privacy}", "received_events_url": "https://api.github.com/users/CohenArthur/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "b4096017e3b9ca499b56988b67e05667a02ca202", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/b4096017e3b9ca499b56988b67e05667a02ca202", "html_url": "https://github.com/Rust-GCC/gccrs/commit/b4096017e3b9ca499b56988b67e05667a02ca202"}], "stats": {"total": 28, "additions": 28, "deletions": 0}, "files": [{"sha": "53c5b5aedbded547e87070100d8a6885e31a9c0f", "filename": "gcc/rust/util/rust-hir-map.cc", "status": "modified", "additions": 22, "deletions": 0, "changes": 22, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/5346330e869e7230164b14e04e18b0d74e80901a/gcc%2Frust%2Futil%2Frust-hir-map.cc", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/5346330e869e7230164b14e04e18b0d74e80901a/gcc%2Frust%2Futil%2Frust-hir-map.cc", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Frust%2Futil%2Frust-hir-map.cc?ref=5346330e869e7230164b14e04e18b0d74e80901a", "patch": "@@ -866,6 +866,28 @@ Mappings::lookup_macro_def (NodeId id, AST::MacroRulesDefinition **def)\n   return true;\n }\n \n+void\n+Mappings::insert_macro_invocation (AST::MacroInvocation &invoc,\n+\t\t\t\t   AST::MacroRulesDefinition *def)\n+{\n+  auto it = macroInvocations.find (invoc.get_macro_node_id ());\n+  rust_assert (it == macroInvocations.end ());\n+\n+  macroInvocations[invoc.get_macro_node_id ()] = def;\n+}\n+\n+bool\n+Mappings::lookup_macro_invocation (AST::MacroInvocation &invoc,\n+\t\t\t\t   AST::MacroRulesDefinition **def)\n+{\n+  auto it = macroInvocations.find (invoc.get_macro_node_id ());\n+  if (it == macroInvocations.end ())\n+    return false;\n+\n+  *def = it->second;\n+  return true;\n+}\n+\n void\n Mappings::insert_visibility (NodeId id, Privacy::ModuleVisibility visibility)\n {"}, {"sha": "5913a020f6d0f5685f653a60654d7ab4745f686d", "filename": "gcc/rust/util/rust-hir-map.h", "status": "modified", "additions": 6, "deletions": 0, "changes": 6, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/5346330e869e7230164b14e04e18b0d74e80901a/gcc%2Frust%2Futil%2Frust-hir-map.h", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/5346330e869e7230164b14e04e18b0d74e80901a/gcc%2Frust%2Futil%2Frust-hir-map.h", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Frust%2Futil%2Frust-hir-map.h?ref=5346330e869e7230164b14e04e18b0d74e80901a", "patch": "@@ -269,6 +269,11 @@ class Mappings\n \n   bool lookup_macro_def (NodeId id, AST::MacroRulesDefinition **def);\n \n+  void insert_macro_invocation (AST::MacroInvocation &invoc,\n+\t\t\t\tAST::MacroRulesDefinition *def);\n+  bool lookup_macro_invocation (AST::MacroInvocation &invoc,\n+\t\t\t\tAST::MacroRulesDefinition **def);\n+\n   void insert_visibility (NodeId id, Privacy::ModuleVisibility visibility);\n   bool lookup_visibility (NodeId id, Privacy::ModuleVisibility &def);\n \n@@ -334,6 +339,7 @@ class Mappings\n \n   // macros\n   std::map<NodeId, AST::MacroRulesDefinition *> macroMappings;\n+  std::map<NodeId, AST::MacroRulesDefinition *> macroInvocations;\n \n   // crate names\n   std::map<CrateNum, std::string> crate_names;"}]}