{"sha": "b7a78333b1d28106f1c1326fb69b97452c98fc49", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6YjdhNzgzMzNiMWQyODEwNmYxYzEzMjZmYjY5Yjk3NDUyYzk4ZmM0OQ==", "commit": {"author": {"name": "Mark Mitchell", "email": "mark@codesourcery.com", "date": "2003-07-27T18:25:57Z"}, "committer": {"name": "Mark Mitchell", "email": "mmitchel@gcc.gnu.org", "date": "2003-07-27T18:25:57Z"}, "message": "call.c (standard_conversion): Tweak handling of pointer-to-member types.\n\n\t* call.c (standard_conversion): Tweak handling of\n\tpointer-to-member types.\n\t* pt.c (tsubst): Correctly qualify pointers-to-data member types.\n\t* typeck.c (comp_ptr_ttypes_real): Check qualifiers on\n\tpointer-to-data member types.\n\n\t* g++.dg/template/ptrmem6.C: New test.\n\nFrom-SVN: r69855", "tree": {"sha": "769d7a5c53b31574bf3700a5fe31ce8f81b2c2f1", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/769d7a5c53b31574bf3700a5fe31ce8f81b2c2f1"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/b7a78333b1d28106f1c1326fb69b97452c98fc49", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/b7a78333b1d28106f1c1326fb69b97452c98fc49", "html_url": "https://github.com/Rust-GCC/gccrs/commit/b7a78333b1d28106f1c1326fb69b97452c98fc49", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/b7a78333b1d28106f1c1326fb69b97452c98fc49/comments", "author": null, "committer": null, "parents": [{"sha": "90ea7324e82180a4235a1690b413f78d7c0ace48", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/90ea7324e82180a4235a1690b413f78d7c0ace48", "html_url": "https://github.com/Rust-GCC/gccrs/commit/90ea7324e82180a4235a1690b413f78d7c0ace48"}], "stats": {"total": 38, "additions": 31, "deletions": 7}, "files": [{"sha": "209e1adce9e8ba09fe63afbadcee20eef011cde9", "filename": "gcc/cp/ChangeLog", "status": "modified", "additions": 8, "deletions": 0, "changes": 8, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/b7a78333b1d28106f1c1326fb69b97452c98fc49/gcc%2Fcp%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/b7a78333b1d28106f1c1326fb69b97452c98fc49/gcc%2Fcp%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fcp%2FChangeLog?ref=b7a78333b1d28106f1c1326fb69b97452c98fc49", "patch": "@@ -1,3 +1,11 @@\n+2003-07-27  Mark Mitchell  <mark@codesourcery.com>\n+\n+\t* call.c (standard_conversion): Tweak handling of\n+\tpointer-to-member types.\n+\t* pt.c (tsubst): Correctly qualify pointers-to-data member types.\n+\t* typeck.c (comp_ptr_ttypes_real): Check qualifiers on\n+\tpointer-to-data member types.\n+\n 2003-07-27  Nathan Sidwell  <nathan@codesourcery.com>\n \n \t* parser.c (cp_parser_type_parameter): Reformat."}, {"sha": "7e3302fa0f7d02e0097947b3a0ba6812669d621f", "filename": "gcc/cp/call.c", "status": "modified", "additions": 2, "deletions": 2, "changes": 4, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/b7a78333b1d28106f1c1326fb69b97452c98fc49/gcc%2Fcp%2Fcall.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/b7a78333b1d28106f1c1326fb69b97452c98fc49/gcc%2Fcp%2Fcall.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fcp%2Fcall.c?ref=b7a78333b1d28106f1c1326fb69b97452c98fc49", "patch": "@@ -715,8 +715,8 @@ standard_conversion (tree to, tree from, tree expr)\n \t}\n       else\n \t{\n-\t  to_pointee = to;\n-\t  from_pointee = from;\n+\t  to_pointee = TYPE_PTRMEM_POINTED_TO_TYPE (to);\n+\t  from_pointee = TYPE_PTRMEM_POINTED_TO_TYPE (from);\n \t}\n \n       if (same_type_p (from, to))"}, {"sha": "efbf75abb694571a64918f188b34f41ae9571d6b", "filename": "gcc/cp/pt.c", "status": "modified", "additions": 3, "deletions": 1, "changes": 4, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/b7a78333b1d28106f1c1326fb69b97452c98fc49/gcc%2Fcp%2Fpt.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/b7a78333b1d28106f1c1326fb69b97452c98fc49/gcc%2Fcp%2Fpt.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fcp%2Fpt.c?ref=b7a78333b1d28106f1c1326fb69b97452c98fc49", "patch": "@@ -6827,7 +6827,9 @@ tsubst (tree t, tree args, tsubst_flags_t complain, tree in_decl)\n \t    return build_ptrmemfunc_type (build_pointer_type (method_type));\n \t  }\n \telse\n-\t  return build_ptrmem_type (r, type);\n+\t  return cp_build_qualified_type_real (build_ptrmem_type (r, type),\n+\t\t\t\t\t       TYPE_QUALS (t),\n+\t\t\t\t\t       complain);\n       }\n     case FUNCTION_TYPE:\n     case METHOD_TYPE:"}, {"sha": "ec6765b28b06e67067c2294ea040d6ed23cace32", "filename": "gcc/cp/typeck.c", "status": "modified", "additions": 4, "deletions": 4, "changes": 8, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/b7a78333b1d28106f1c1326fb69b97452c98fc49/gcc%2Fcp%2Ftypeck.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/b7a78333b1d28106f1c1326fb69b97452c98fc49/gcc%2Fcp%2Ftypeck.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fcp%2Ftypeck.c?ref=b7a78333b1d28106f1c1326fb69b97452c98fc49", "patch": "@@ -6013,9 +6013,9 @@ comp_ptr_ttypes_real (tree to, tree from, int constp)\n \treturn 0;\n \n       if (TREE_CODE (from) == OFFSET_TYPE\n-\t  && same_type_p (TYPE_OFFSET_BASETYPE (from),\n-\t\t\t  TYPE_OFFSET_BASETYPE (to)))\n-\t  continue;\n+\t  && !same_type_p (TYPE_OFFSET_BASETYPE (from),\n+\t\t\t   TYPE_OFFSET_BASETYPE (to)))\n+\treturn 0;\n \n       /* Const and volatile mean something different for function types,\n \t so the usual checks are not appropriate.  */\n@@ -6035,7 +6035,7 @@ comp_ptr_ttypes_real (tree to, tree from, int constp)\n \t    constp &= TYPE_READONLY (to);\n \t}\n \n-      if (TREE_CODE (to) != POINTER_TYPE)\n+      if (TREE_CODE (to) != POINTER_TYPE && !TYPE_PTR_TO_MEMBER_P (to))\n \treturn ((constp >= 0 || to_more_cv_qualified)\n \t\t&& same_type_ignoring_top_level_qualifiers_p (to, from));\n     }"}, {"sha": "1057be5c667d65759c11a65ecfed543128550f93", "filename": "gcc/testsuite/ChangeLog", "status": "modified", "additions": 4, "deletions": 0, "changes": 4, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/b7a78333b1d28106f1c1326fb69b97452c98fc49/gcc%2Ftestsuite%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/b7a78333b1d28106f1c1326fb69b97452c98fc49/gcc%2Ftestsuite%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2FChangeLog?ref=b7a78333b1d28106f1c1326fb69b97452c98fc49", "patch": "@@ -1,3 +1,7 @@\n+2003-07-27  Mark Mitchell  <mark@codesourcery.com>\n+\n+\t* g++.dg/template/ptrmem6.C: New test.\n+\n 2003-07-26  Geoffrey Keating  <geoffk@apple.com>\n \n \t* gcc.c-torture/compile/zero-strct-2.c: New test."}, {"sha": "0d7dec219813d585c2590a6f2097d9edd84376ff", "filename": "gcc/testsuite/g++.dg/template/ptrmem6.C", "status": "added", "additions": 10, "deletions": 0, "changes": 10, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/b7a78333b1d28106f1c1326fb69b97452c98fc49/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Ftemplate%2Fptrmem6.C", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/b7a78333b1d28106f1c1326fb69b97452c98fc49/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Ftemplate%2Fptrmem6.C", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Ftemplate%2Fptrmem6.C?ref=b7a78333b1d28106f1c1326fb69b97452c98fc49", "patch": "@@ -0,0 +1,10 @@\n+struct S {};\n+\n+void g(int S::**);\n+\n+template <typename T>\n+void f (int T::* volatile *p) {\n+  g(p); // { dg-error \"\" }\n+}\n+\n+template void f(int S::* volatile *); // { dg-error \"instantiated\" }"}]}