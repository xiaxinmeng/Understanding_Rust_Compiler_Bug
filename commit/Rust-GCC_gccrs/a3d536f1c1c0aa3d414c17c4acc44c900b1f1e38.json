{"sha": "a3d536f1c1c0aa3d414c17c4acc44c900b1f1e38", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6YTNkNTM2ZjFjMWMwYWEzZDQxNGMxN2M0YWNjNDRjOTAwYjFmMWUzOA==", "commit": {"author": {"name": "Volker Reichelt", "email": "reichelt@igpm.rwth-aachen.de", "date": "2006-06-23T15:59:51Z"}, "committer": {"name": "Volker Reichelt", "email": "reichelt@gcc.gnu.org", "date": "2006-06-23T15:59:51Z"}, "message": "re PR c++/11468 (Deriving from CNI class java::lang::Object  causing an ICE)\n\n\tPR c++/11468\n\t* init.c (build_new_1): Handle error_mark_nodes returned by\n\tbuild_java_class_ref.\n\t(build_java_class_ref): Do not abort compilation, but return\n\terror_mark_node.  Improve error message.  Fix indentation.\n\n\t* g++.dg/other/java2.C: New test.\n\nFrom-SVN: r114937", "tree": {"sha": "834611c09e87709f52ba63aed4621e8b5f75bb29", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/834611c09e87709f52ba63aed4621e8b5f75bb29"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/a3d536f1c1c0aa3d414c17c4acc44c900b1f1e38", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/a3d536f1c1c0aa3d414c17c4acc44c900b1f1e38", "html_url": "https://github.com/Rust-GCC/gccrs/commit/a3d536f1c1c0aa3d414c17c4acc44c900b1f1e38", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/a3d536f1c1c0aa3d414c17c4acc44c900b1f1e38/comments", "author": null, "committer": null, "parents": [{"sha": "6de5f432f1e671c985b02a29bea02eb15e7553cc", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/6de5f432f1e671c985b02a29bea02eb15e7553cc", "html_url": "https://github.com/Rust-GCC/gccrs/commit/6de5f432f1e671c985b02a29bea02eb15e7553cc"}], "stats": {"total": 40, "additions": 36, "deletions": 4}, "files": [{"sha": "2f726bdf8edf52df7580c08abd2b1fe227c4a6a3", "filename": "gcc/cp/ChangeLog", "status": "modified", "additions": 8, "deletions": 0, "changes": 8, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/a3d536f1c1c0aa3d414c17c4acc44c900b1f1e38/gcc%2Fcp%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/a3d536f1c1c0aa3d414c17c4acc44c900b1f1e38/gcc%2Fcp%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fcp%2FChangeLog?ref=a3d536f1c1c0aa3d414c17c4acc44c900b1f1e38", "patch": "@@ -1,3 +1,11 @@\n+2006-06-23  Volker Reichelt  <reichelt@igpm.rwth-aachen.de>\n+\n+\tPR c++/11468\n+\t* init.c (build_new_1): Handle error_mark_nodes returned by\n+\tbuild_java_class_ref.\n+\t(build_java_class_ref): Do not abort compilation, but return\n+\terror_mark_node.  Improve error message.  Fix indentation.\n+\n 2006-06-23  Danny Smith   <dannysmith@users.sourceforge.net>\n \n \tPR target/27789"}, {"sha": "c785308699f80ab2dcb7b749e9ebf84ff79b6f97", "filename": "gcc/cp/init.c", "status": "modified", "additions": 12, "deletions": 4, "changes": 16, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/a3d536f1c1c0aa3d414c17c4acc44c900b1f1e38/gcc%2Fcp%2Finit.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/a3d536f1c1c0aa3d414c17c4acc44c900b1f1e38/gcc%2Fcp%2Finit.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fcp%2Finit.c?ref=a3d536f1c1c0aa3d414c17c4acc44c900b1f1e38", "patch": "@@ -1696,6 +1696,9 @@ build_new_1 (tree placement, tree type, tree nelts, tree init,\n       tree class_decl = build_java_class_ref (elt_type);\n       static const char alloc_name[] = \"_Jv_AllocObject\";\n \n+      if (class_decl == error_mark_node)\n+\treturn error_mark_node;\n+\n       use_java_new = 1;\n       if (!get_global_value_if_present (get_identifier (alloc_name),\n \t\t\t\t\t&alloc_fn))\n@@ -2148,8 +2151,10 @@ build_java_class_ref (tree type)\n     {\n       jclass_node = IDENTIFIER_GLOBAL_VALUE (get_identifier (\"jclass\"));\n       if (jclass_node == NULL_TREE)\n-\tfatal_error (\"call to Java constructor, while %<jclass%> undefined\");\n-\n+\t{\n+\t  error (\"call to Java constructor, while %<jclass%> undefined\");\n+\t  return error_mark_node;\n+\t}\n       jclass_node = TREE_TYPE (jclass_node);\n     }\n \n@@ -2164,8 +2169,11 @@ build_java_class_ref (tree type)\n \t  break;\n \t}\n     if (!field)\n-      internal_error (\"can't find class$\");\n-    }\n+      {\n+\terror (\"can't find %<class$%> in %qT\", type);\n+\treturn error_mark_node;\n+      }\n+  }\n \n   class_decl = IDENTIFIER_GLOBAL_VALUE (name);\n   if (class_decl == NULL_TREE)"}, {"sha": "3b3dc6bac2fcabddc39f41990bc09579d613ed5c", "filename": "gcc/testsuite/ChangeLog", "status": "modified", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/a3d536f1c1c0aa3d414c17c4acc44c900b1f1e38/gcc%2Ftestsuite%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/a3d536f1c1c0aa3d414c17c4acc44c900b1f1e38/gcc%2Ftestsuite%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2FChangeLog?ref=a3d536f1c1c0aa3d414c17c4acc44c900b1f1e38", "patch": "@@ -1,3 +1,8 @@\n+2006-06-23  Volker Reichelt  <reichelt@igpm.rwth-aachen.de>\n+\n+\tPR c++/11468\n+\t* g++.dg/other/java2.C: New test.\n+\n 2006-06-23  Danny Smith   <dannysmith@users.sourceforge.net>\n \n \tPR target/27789"}, {"sha": "8ba4d5a72c84a39f612207cf4d2bad5344f1f83f", "filename": "gcc/testsuite/g++.dg/other/java2.C", "status": "added", "additions": 11, "deletions": 0, "changes": 11, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/a3d536f1c1c0aa3d414c17c4acc44c900b1f1e38/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Fother%2Fjava2.C", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/a3d536f1c1c0aa3d414c17c4acc44c900b1f1e38/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Fother%2Fjava2.C", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Fother%2Fjava2.C?ref=a3d536f1c1c0aa3d414c17c4acc44c900b1f1e38", "patch": "@@ -0,0 +1,11 @@\n+// PR c++/???\n+// { dg-do compile }\n+\n+extern \"Java\"\n+{\n+  struct A {};\n+}\n+\n+typedef void* jclass;\n+\n+A* p = new A;  // { dg-error \"class\\\\$\" }"}]}