{"sha": "ae2cac711f13fb778f5065b160e5b27b56c0f129", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6YWUyY2FjNzExZjEzZmI3NzhmNTA2NWIxNjBlNWIyN2I1NmMwZjEyOQ==", "commit": {"author": {"name": "Richard Guenther", "email": "rguenther@suse.de", "date": "2009-12-11T18:00:24Z"}, "committer": {"name": "Richard Biener", "email": "rguenth@gcc.gnu.org", "date": "2009-12-11T18:00:24Z"}, "message": "re PR lto/41658 (Execution testsuite fails with -O2 -fwhopr)\n\n2009-12-11  Richard Guenther  <rguenther@suse.de>\n\n\tPR lto/41658\n\tPR lto/41657\n\t* lto-streamer-out.c (write_global_stream): Do not make decls\n\tweak but resort to TREE_ASM_WRITTEN to avoid multiple definitions.\n\tMake sure to mark all decls that we have written.\n\nFrom-SVN: r155174", "tree": {"sha": "9de40a53031617104951f6fd37441cc49b1fae6f", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/9de40a53031617104951f6fd37441cc49b1fae6f"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/ae2cac711f13fb778f5065b160e5b27b56c0f129", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/ae2cac711f13fb778f5065b160e5b27b56c0f129", "html_url": "https://github.com/Rust-GCC/gccrs/commit/ae2cac711f13fb778f5065b160e5b27b56c0f129", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/ae2cac711f13fb778f5065b160e5b27b56c0f129/comments", "author": {"login": "rguenth", "id": 2046526, "node_id": "MDQ6VXNlcjIwNDY1MjY=", "avatar_url": "https://avatars.githubusercontent.com/u/2046526?v=4", "gravatar_id": "", "url": "https://api.github.com/users/rguenth", "html_url": "https://github.com/rguenth", "followers_url": "https://api.github.com/users/rguenth/followers", "following_url": "https://api.github.com/users/rguenth/following{/other_user}", "gists_url": "https://api.github.com/users/rguenth/gists{/gist_id}", "starred_url": "https://api.github.com/users/rguenth/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/rguenth/subscriptions", "organizations_url": "https://api.github.com/users/rguenth/orgs", "repos_url": "https://api.github.com/users/rguenth/repos", "events_url": "https://api.github.com/users/rguenth/events{/privacy}", "received_events_url": "https://api.github.com/users/rguenth/received_events", "type": "User", "site_admin": false}, "committer": null, "parents": [{"sha": "8246b3148ea869d8f2cc2d420312feed719943db", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/8246b3148ea869d8f2cc2d420312feed719943db", "html_url": "https://github.com/Rust-GCC/gccrs/commit/8246b3148ea869d8f2cc2d420312feed719943db"}], "stats": {"total": 49, "additions": 21, "deletions": 28}, "files": [{"sha": "ba3f0d3610158ffa1cd7bf1a37a84e92f590c964", "filename": "gcc/ChangeLog", "status": "modified", "additions": 8, "deletions": 0, "changes": 8, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/ae2cac711f13fb778f5065b160e5b27b56c0f129/gcc%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/ae2cac711f13fb778f5065b160e5b27b56c0f129/gcc%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2FChangeLog?ref=ae2cac711f13fb778f5065b160e5b27b56c0f129", "patch": "@@ -1,3 +1,11 @@\n+2009-12-11  Richard Guenther  <rguenther@suse.de>\n+\n+\tPR lto/41658\n+\tPR lto/41657\n+\t* lto-streamer-out.c (write_global_stream): Do not make decls\n+\tweak but resort to TREE_ASM_WRITTEN to avoid multiple definitions.\n+\tMake sure to mark all decls that we have written.\n+\n 2009-12-11  Sebastian Andrzej Siewior  <bigeasy@linutronix.de>\n \n \tPR target/36047"}, {"sha": "920cd2708650df79392cac900915a581f06a7bb1", "filename": "gcc/lto-streamer-out.c", "status": "modified", "additions": 13, "deletions": 28, "changes": 41, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/ae2cac711f13fb778f5065b160e5b27b56c0f129/gcc%2Flto-streamer-out.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/ae2cac711f13fb778f5065b160e5b27b56c0f129/gcc%2Flto-streamer-out.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Flto-streamer-out.c?ref=ae2cac711f13fb778f5065b160e5b27b56c0f129", "patch": "@@ -2147,35 +2147,20 @@ write_global_stream (struct output_block *ob,\n     {\n       t = lto_tree_ref_encoder_get_tree (encoder, index);\n       if (!lto_streamer_cache_lookup (ob->writer_cache, t, NULL))\n-\t{\n-\t  if (flag_wpa)\n-\t    {\n-\t      /* In WPA we should not emit multiple definitions of the\n-\t\t same symbol to all the files in the link set.  If\n-\t\t T had already been emitted as the pervailing definition\n-\t\t in one file, emit it as an external reference in the\n-\t\t others.  */\n-\t      /* FIXME lto.  We should check if T belongs to the\n-\t\t file we are writing to.  */\n-\t      if (TREE_CODE (t) == VAR_DECL\n-\t\t  && TREE_PUBLIC (t)\n-\t\t  && !DECL_EXTERNAL (t))\n-\t\t{\n-\t\t  /* FIXME lto.  Make DECLS_ALREADY_EMITTED an argument\n-\t\t     to this function so it can be freed up afterwards.\n-\t\t     Alternately, assign global symbols to cgraph\n-\t\t     node sets.  */\n-\t\t  static struct pointer_set_t *decls_already_emitted = NULL;\n-\n-\t\t  if (decls_already_emitted == NULL)\n-\t\t    decls_already_emitted = pointer_set_create ();\n-\n-\t\t  if (pointer_set_insert (decls_already_emitted, t))\n-\t\t    make_decl_one_only (t, DECL_ASSEMBLER_NAME (t));\n-\t\t}\n-\t    }\n+\tlto_output_tree (ob, t, false);\n \n-\t  lto_output_tree (ob, t, false);\n+      if (flag_wpa)\n+\t{\n+\t  /* In WPA we should not emit multiple definitions of the\n+\t     same symbol to all the files in the link set.  If\n+\t     T had already been emitted as the pervailing definition\n+\t     in one file, do not emit it in the others.  */\n+\t  /* FIXME lto.  We should check if T belongs to the\n+\t     file we are writing to.  */\n+\t  if (TREE_CODE (t) == VAR_DECL\n+\t      && TREE_PUBLIC (t)\n+\t      && !DECL_EXTERNAL (t))\n+\t    TREE_ASM_WRITTEN (t) = 1;\n \t}\n     }\n }"}]}