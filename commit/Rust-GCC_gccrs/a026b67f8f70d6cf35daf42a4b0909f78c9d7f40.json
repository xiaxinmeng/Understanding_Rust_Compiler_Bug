{"sha": "a026b67f8f70d6cf35daf42a4b0909f78c9d7f40", "node_id": "C_kwDOANBUbNoAKGEwMjZiNjdmOGY3MGQ2Y2YzNWRhZjQyYTRiMDkwOWY3OGM5ZDdmNDA", "commit": {"author": {"name": "Alexandre Oliva", "email": "oliva@adacore.com", "date": "2022-02-25T01:03:34Z"}, "committer": {"name": "Alexandre Oliva", "email": "oliva@gnu.org", "date": "2022-02-25T01:03:34Z"}, "message": "Cope with NULL dw_cfi_cfa_loc\n\nIn def_cfa_0, we may set the 2nd operand's dw_cfi_cfa_loc to NULL, but\nthen cfi_oprnd_equal_p calls cfa_equal_p with a NULL dw_cfa_location*.\nThis patch aranges for us to tolerate NULL dw_cfi_cfa_loc.\n\n\nfor  gcc/ChangeLog\n\n\tPR middle-end/104540\n\t* dwarf2cfi.cc (cfi_oprnd_equal_p): Cope with NULL\n\tdw_cfi_cfa_loc.\n\nfor  gcc/testsuite/ChangeLog\n\n\tPR middle-end/104540\n\t* g++.dg/pr104540.C: New.", "tree": {"sha": "5919e9a5d44357ab3440937fcafe2f3c5b499189", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/5919e9a5d44357ab3440937fcafe2f3c5b499189"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/a026b67f8f70d6cf35daf42a4b0909f78c9d7f40", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/a026b67f8f70d6cf35daf42a4b0909f78c9d7f40", "html_url": "https://github.com/Rust-GCC/gccrs/commit/a026b67f8f70d6cf35daf42a4b0909f78c9d7f40", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/a026b67f8f70d6cf35daf42a4b0909f78c9d7f40/comments", "author": null, "committer": null, "parents": [{"sha": "e53bb1965db9c7882ded4a70296340d8db52053a", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/e53bb1965db9c7882ded4a70296340d8db52053a", "html_url": "https://github.com/Rust-GCC/gccrs/commit/e53bb1965db9c7882ded4a70296340d8db52053a"}], "stats": {"total": 24, "additions": 24, "deletions": 0}, "files": [{"sha": "ab7c5cc5b27b5fb48b0f63ee2240fda8054c7a33", "filename": "gcc/dwarf2cfi.cc", "status": "modified", "additions": 3, "deletions": 0, "changes": 3, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/a026b67f8f70d6cf35daf42a4b0909f78c9d7f40/gcc%2Fdwarf2cfi.cc", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/a026b67f8f70d6cf35daf42a4b0909f78c9d7f40/gcc%2Fdwarf2cfi.cc", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fdwarf2cfi.cc?ref=a026b67f8f70d6cf35daf42a4b0909f78c9d7f40", "patch": "@@ -788,6 +788,9 @@ cfi_oprnd_equal_p (enum dw_cfi_oprnd_type t, dw_cfi_oprnd *a, dw_cfi_oprnd *b)\n     case dw_cfi_oprnd_loc:\n       return loc_descr_equal_p (a->dw_cfi_loc, b->dw_cfi_loc);\n     case dw_cfi_oprnd_cfa_loc:\n+      /* If any of them is NULL, don't dereference either.  */\n+      if (!a->dw_cfi_cfa_loc || !b->dw_cfi_cfa_loc)\n+\treturn a->dw_cfi_cfa_loc == b->dw_cfi_cfa_loc;\n       return cfa_equal_p (a->dw_cfi_cfa_loc, b->dw_cfi_cfa_loc);\n     }\n   gcc_unreachable ();"}, {"sha": "a86ecbfd088c36dee9ab41ecfed6d0887a6629d8", "filename": "gcc/testsuite/g++.dg/pr104540.C", "status": "added", "additions": 21, "deletions": 0, "changes": 21, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/a026b67f8f70d6cf35daf42a4b0909f78c9d7f40/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Fpr104540.C", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/a026b67f8f70d6cf35daf42a4b0909f78c9d7f40/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Fpr104540.C", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Fpr104540.C?ref=a026b67f8f70d6cf35daf42a4b0909f78c9d7f40", "patch": "@@ -0,0 +1,21 @@\n+/* { dg-do compile } */\n+/* { dg-options \"-O2 -fharden-conditional-branches -mforce-drap -mstackrealign --param=max-grow-copy-bb-insns=125\" } */\n+\n+char c;\n+int i;\n+\n+void bar(int);\n+\n+struct S {\n+  int mi;\n+  long ml;\n+  S(int);\n+};\n+\n+\n+void foo() {\n+  int s = c == 0 ? 1 : 2;\n+  bar(s);\n+  if (i)\n+    S s(0);\n+}"}]}