{"sha": "ada2eb687fd49e37664b92a59dbed55f19e62eb8", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6YWRhMmViNjg3ZmQ0OWUzNzY2NGI5MmE1OWRiZWQ1NWYxOWU2MmViOA==", "commit": {"author": {"name": "Jiong Wang", "email": "jiong.wang@arm.com", "date": "2016-05-12T17:00:52Z"}, "committer": {"name": "Jiong Wang", "email": "jiwang@gcc.gnu.org", "date": "2016-05-12T17:00:52Z"}, "message": "[LRA] PR70904, relax the restriction on subreg reload for wide mode \n\n2016-05-12  Jiong Wang  <jiong.wang@arm.com>\n\ngcc/\n  PR rtl-optimization/70904\n  * lra-constraint.c (process_addr_reg): Relax the restriction on\n  subreg reload for wide mode.\n\nFrom-SVN: r236181", "tree": {"sha": "1f0bc42a2d9246e4039ee13e03ae965bcc2d9e23", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/1f0bc42a2d9246e4039ee13e03ae965bcc2d9e23"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/ada2eb687fd49e37664b92a59dbed55f19e62eb8", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/ada2eb687fd49e37664b92a59dbed55f19e62eb8", "html_url": "https://github.com/Rust-GCC/gccrs/commit/ada2eb687fd49e37664b92a59dbed55f19e62eb8", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/ada2eb687fd49e37664b92a59dbed55f19e62eb8/comments", "author": null, "committer": null, "parents": [{"sha": "4f2e1536a349a98cc4840fc90a4b97fc4fbc3467", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/4f2e1536a349a98cc4840fc90a4b97fc4fbc3467", "html_url": "https://github.com/Rust-GCC/gccrs/commit/4f2e1536a349a98cc4840fc90a4b97fc4fbc3467"}], "stats": {"total": 22, "additions": 21, "deletions": 1}, "files": [{"sha": "b9a18e8dd60a8d745bf890f70135cbe426d2037d", "filename": "gcc/ChangeLog", "status": "modified", "additions": 6, "deletions": 0, "changes": 6, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/ada2eb687fd49e37664b92a59dbed55f19e62eb8/gcc%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/ada2eb687fd49e37664b92a59dbed55f19e62eb8/gcc%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2FChangeLog?ref=ada2eb687fd49e37664b92a59dbed55f19e62eb8", "patch": "@@ -1,3 +1,9 @@\n+2016-05-12  Jiong Wang  <jiong.wang@arm.com>\n+\n+\tPR rtl-optimization/70904\n+\t* lra-constraint.c (process_addr_reg): Relax the restriction on subreg\n+\treload for wide mode.\n+\n 2016-05-12  Marek Polacek  <polacek@redhat.com>\n \n \tPR c/70756"}, {"sha": "56ab5b45c17cdfebe0593834111cc9e4f7f69a0c", "filename": "gcc/lra-constraints.c", "status": "modified", "additions": 15, "deletions": 1, "changes": 16, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/ada2eb687fd49e37664b92a59dbed55f19e62eb8/gcc%2Flra-constraints.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/ada2eb687fd49e37664b92a59dbed55f19e62eb8/gcc%2Flra-constraints.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Flra-constraints.c?ref=ada2eb687fd49e37664b92a59dbed55f19e62eb8", "patch": "@@ -1307,7 +1307,21 @@ process_addr_reg (rtx *loc, bool check_only_p, rtx_insn **before, rtx_insn **aft\n \n   subreg_p = GET_CODE (*loc) == SUBREG;\n   if (subreg_p)\n-    loc = &SUBREG_REG (*loc);\n+    {\n+      reg = SUBREG_REG (*loc);\n+      mode = GET_MODE (reg);\n+\n+      /* For mode with size bigger than ptr_mode, there unlikely to be \"mov\"\n+\t between two registers with different classes, but there normally will\n+\t be \"mov\" which transfers element of vector register into the general\n+\t register, and this normally will be a subreg which should be reloaded\n+\t as a whole.  This is particularly likely to be triggered when\n+\t -fno-split-wide-types specified.  */\n+      if (in_class_p (reg, cl, &new_class)\n+\t  || GET_MODE_SIZE (mode) <= GET_MODE_SIZE (ptr_mode))\n+       loc = &SUBREG_REG (*loc);\n+    }\n+\n   reg = *loc;\n   mode = GET_MODE (reg);\n   if (! REG_P (reg))"}]}