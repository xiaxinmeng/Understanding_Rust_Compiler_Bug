{"sha": "8aa5bdd61e96a7adeec6dad22847be27faad7122", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6OGFhNWJkZDYxZTk2YTdhZGVlYzZkYWQyMjg0N2JlMjdmYWFkNzEyMg==", "commit": {"author": {"name": "Aaron Conole", "email": "aconole@redhat.com", "date": "2016-06-02T12:22:01Z"}, "committer": {"name": "Nathan Sidwell", "email": "nathan@gcc.gnu.org", "date": "2016-06-02T12:22:01Z"}, "message": "On behalf of Aaron Conole <aconole@redhat.com>\n\nOn behalf of  Aaron Conole  <aconole@redhat.com>\n\t* libgcov-driver-system.c (__gcov_error_file): New.\n\t(get_gcov_error_file): New.\n\t(gcov_error): Use and set __gcov_error_file.\n\t(gcov_error_exit): New.\n\t* libgcov-driver.c (gcov_exit): Call gcov_error_exit.\n\nFrom-SVN: r237033", "tree": {"sha": "3d70d4e52b2e726d7ebe1241651fedc71dfd0812", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/3d70d4e52b2e726d7ebe1241651fedc71dfd0812"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/8aa5bdd61e96a7adeec6dad22847be27faad7122", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/8aa5bdd61e96a7adeec6dad22847be27faad7122", "html_url": "https://github.com/Rust-GCC/gccrs/commit/8aa5bdd61e96a7adeec6dad22847be27faad7122", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/8aa5bdd61e96a7adeec6dad22847be27faad7122/comments", "author": {"login": "orgcandman", "id": 1092926, "node_id": "MDQ6VXNlcjEwOTI5MjY=", "avatar_url": "https://avatars.githubusercontent.com/u/1092926?v=4", "gravatar_id": "", "url": "https://api.github.com/users/orgcandman", "html_url": "https://github.com/orgcandman", "followers_url": "https://api.github.com/users/orgcandman/followers", "following_url": "https://api.github.com/users/orgcandman/following{/other_user}", "gists_url": "https://api.github.com/users/orgcandman/gists{/gist_id}", "starred_url": "https://api.github.com/users/orgcandman/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/orgcandman/subscriptions", "organizations_url": "https://api.github.com/users/orgcandman/orgs", "repos_url": "https://api.github.com/users/orgcandman/repos", "events_url": "https://api.github.com/users/orgcandman/events{/privacy}", "received_events_url": "https://api.github.com/users/orgcandman/received_events", "type": "User", "site_admin": false}, "committer": null, "parents": [{"sha": "930ebd0e2a99523b7991c71436e58bdf1dc43fe3", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/930ebd0e2a99523b7991c71436e58bdf1dc43fe3", "html_url": "https://github.com/Rust-GCC/gccrs/commit/930ebd0e2a99523b7991c71436e58bdf1dc43fe3"}], "stats": {"total": 65, "additions": 62, "deletions": 3}, "files": [{"sha": "a003c5171fbf28f1222c32df210bcf2d09ec891c", "filename": "libgcc/ChangeLog", "status": "modified", "additions": 8, "deletions": 0, "changes": 8, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/8aa5bdd61e96a7adeec6dad22847be27faad7122/libgcc%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/8aa5bdd61e96a7adeec6dad22847be27faad7122/libgcc%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libgcc%2FChangeLog?ref=8aa5bdd61e96a7adeec6dad22847be27faad7122", "patch": "@@ -1,3 +1,11 @@\n+2016-06-02  Aaron Conole  <aconole@redhat.com>\n+\n+\t* libgcov-driver-system.c (__gcov_error_file): New.\n+\t(get_gcov_error_file): New.\n+\t(gcov_error): Use and set __gcov_error_file.\n+\t(gcov_error_exit): New.\n+\t* libgcov-driver.c (gcov_exit): Call gcov_error_exit.\n+\n 2016-05-26  Nathan Sidwell  <nathan@acm.org>\n \n \t* config/nvptx/free.asm: Delete."}, {"sha": "ff8a521690b150e1177c9e647bd615d4ccd715e4", "filename": "libgcc/libgcov-driver-system.c", "status": "modified", "additions": 47, "deletions": 2, "changes": 49, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/8aa5bdd61e96a7adeec6dad22847be27faad7122/libgcc%2Flibgcov-driver-system.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/8aa5bdd61e96a7adeec6dad22847be27faad7122/libgcc%2Flibgcov-driver-system.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libgcc%2Flibgcov-driver-system.c?ref=8aa5bdd61e96a7adeec6dad22847be27faad7122", "patch": "@@ -23,19 +23,64 @@ a copy of the GCC Runtime Library Exception along with this program;\n see the files COPYING3 and COPYING.RUNTIME respectively.  If not, see\n <http://www.gnu.org/licenses/>.  */\n \n-/* A utility function for outputing errors.  */\n+/* Configured via the GCOV_ERROR_FILE environment variable;\n+   it will either be stderr, or a file of the user's choosing.\n+   Non-static to prevent multiple gcov-aware shared objects from\n+   instantiating their own copies. */\n+FILE *__gcov_error_file = NULL;\n+\n+/* A utility function to populate the __gcov_error_file pointer.\n+   This should NOT be called outside of the gcov system driver code. */\n+\n+static FILE *\n+get_gcov_error_file(void)\n+{\n+#if !IN_GCOV_TOOL\n+  return stderr;\n+#else\n+  char *gcov_error_filename = getenv (\"GCOV_ERROR_FILE\");\n+\n+  if (gcov_error_filename)\n+    {\n+      FILE *openfile = fopen (gcov_error_filename, \"a\");\n+      if (openfile)\n+        __gcov_error_file = openfile;\n+    }\n+  if (!__gcov_error_file)\n+    __gcov_error_file = stderr;\n+  return __gcov_error_file;\n+#endif\n+}\n+\n+/* A utility function for outputting errors.  */\n \n static int __attribute__((format(printf, 1, 2)))\n gcov_error (const char *fmt, ...)\n {\n   int ret;\n   va_list argp;\n+\n+  if (!__gcov_error_file)\n+    __gcov_error_file = get_gcov_error_file ();\n+\n   va_start (argp, fmt);\n-  ret = vfprintf (stderr, fmt, argp);\n+  ret = vfprintf (__gcov_error_file, fmt, argp);\n   va_end (argp);\n   return ret;\n }\n \n+#if !IN_GCOV_TOOL\n+static void\n+gcov_error_exit (void)\n+{\n+  if (__gcov_error_file && __gcov_error_file != stderr)\n+    {\n+      fclose (__gcov_error_file);\n+      __gcov_error_file = NULL;\n+    }\n+}\n+#endif\n+\n /* Make sure path component of the given FILENAME exists, create\n    missing directories. FILENAME must be writable.\n    Returns zero on success, or -1 if an error occurred.  */"}, {"sha": "d51397e0f8a0d8d48063fbe4f4b14e0a252a6f7c", "filename": "libgcc/libgcov-driver.c", "status": "modified", "additions": 7, "deletions": 1, "changes": 8, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/8aa5bdd61e96a7adeec6dad22847be27faad7122/libgcc%2Flibgcov-driver.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/8aa5bdd61e96a7adeec6dad22847be27faad7122/libgcc%2Flibgcov-driver.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libgcc%2Flibgcov-driver.c?ref=8aa5bdd61e96a7adeec6dad22847be27faad7122", "patch": "@@ -43,9 +43,13 @@ void __gcov_init (struct gcov_info *p __attribute__ ((unused))) {}\n \n #ifdef L_gcov\n \n-/* A utility function for outputing errors.  */\n+/* A utility function for outputting errors.  */\n static int gcov_error (const char *, ...);\n \n+#if !IN_GCOV_TOOL\n+static void gcov_error_exit (void);\n+#endif\n+\n #include \"gcov-io.c\"\n \n struct gcov_fn_buffer\n@@ -878,6 +882,8 @@ gcov_exit (void)\n     __gcov_root.prev->next = __gcov_root.next;\n   else\n     __gcov_master.root = __gcov_root.next;\n+\n+  gcov_error_exit ();\n }\n \n /* Add a new object file onto the bb chain.  Invoked automatically"}]}