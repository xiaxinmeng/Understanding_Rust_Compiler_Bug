{"sha": "44c945e62c87d9e01156c9cd6da93f69b984be37", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6NDRjOTQ1ZTYyYzg3ZDllMDExNTZjOWNkNmRhOTNmNjliOTg0YmUzNw==", "commit": {"author": {"name": "Jan Hubicka", "email": "hubicka@ucw.cz", "date": "2018-01-30T13:17:40Z"}, "committer": {"name": "Jan Hubicka", "email": "hubicka@gcc.gnu.org", "date": "2018-01-30T13:17:40Z"}, "message": "re PR lto/83954 (LTO: Bogus -Wlto-type-mismatch warning for array of pointer to incomplete type)\n\n\n\tPR lto/83954\n\t* lto-symtab.c (warn_type_compatibility_p): Silence false positive\n\tfor type match warning on arrays of pointers.\n\t* gcc.dg/lto/pr83954.h: New testcase.\n\t* gcc.dg/lto/pr83954_0.c: New testcase.\n\t* gcc.dg/lto/pr83954_1.c: New testcase.\n\nFrom-SVN: r257183", "tree": {"sha": "2454d2d5f9eefccf53c515d30f9b23f948f986f0", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/2454d2d5f9eefccf53c515d30f9b23f948f986f0"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/44c945e62c87d9e01156c9cd6da93f69b984be37", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/44c945e62c87d9e01156c9cd6da93f69b984be37", "html_url": "https://github.com/Rust-GCC/gccrs/commit/44c945e62c87d9e01156c9cd6da93f69b984be37", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/44c945e62c87d9e01156c9cd6da93f69b984be37/comments", "author": null, "committer": null, "parents": [{"sha": "6439c358063d3660e08a7931d720b901282879f8", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/6439c358063d3660e08a7931d720b901282879f8", "html_url": "https://github.com/Rust-GCC/gccrs/commit/6439c358063d3660e08a7931d720b901282879f8"}], "stats": {"total": 50, "additions": 46, "deletions": 4}, "files": [{"sha": "7265b760865671dfa378bc275271fe4b66724813", "filename": "gcc/lto/ChangeLog", "status": "modified", "additions": 6, "deletions": 0, "changes": 6, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/44c945e62c87d9e01156c9cd6da93f69b984be37/gcc%2Flto%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/44c945e62c87d9e01156c9cd6da93f69b984be37/gcc%2Flto%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Flto%2FChangeLog?ref=44c945e62c87d9e01156c9cd6da93f69b984be37", "patch": "@@ -1,3 +1,9 @@\n+2018-01-30  Jan Hubicka  <hubicka@ucw.cz>\n+\n+\tPR lto/83954\n+\t* lto-symtab.c (warn_type_compatibility_p): Silence false positive\n+\tfor type match warning on arrays of pointers.\n+\n 2018-01-23  Martin Liska  <mliska@suse.cz>\n \n \tPR lto/81440"}, {"sha": "0508c5e67502dc26e5086a80710e6082e6b2e1ad", "filename": "gcc/lto/lto-symtab.c", "status": "modified", "additions": 15, "deletions": 4, "changes": 19, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/44c945e62c87d9e01156c9cd6da93f69b984be37/gcc%2Flto%2Flto-symtab.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/44c945e62c87d9e01156c9cd6da93f69b984be37/gcc%2Flto%2Flto-symtab.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Flto%2Flto-symtab.c?ref=44c945e62c87d9e01156c9cd6da93f69b984be37", "patch": "@@ -284,11 +284,22 @@ warn_type_compatibility_p (tree prevailing_type, tree type,\n       alias_set_type set1 = get_alias_set (type);\n       alias_set_type set2 = get_alias_set (prevailing_type);\n \n-      if (set1 && set2 && set1 != set2 \n-          && (!POINTER_TYPE_P (type) || !POINTER_TYPE_P (prevailing_type)\n+      if (set1 && set2 && set1 != set2)\n+\t{\n+          tree t1 = type, t2 = prevailing_type;\n+\n+\t  /* Alias sets of arrays are the same as alias sets of the inner\n+\t     types.  */\n+\t  while (TREE_CODE (t1) == ARRAY_TYPE && TREE_CODE (t2) == ARRAY_TYPE)\n+\t    {\n+\t      t1 = TREE_TYPE (t1);\n+\t      t2 = TREE_TYPE (t2);\n+\t    }\n+          if ((!POINTER_TYPE_P (t1) || !POINTER_TYPE_P (t2))\n \t      || (set1 != TYPE_ALIAS_SET (ptr_type_node)\n-\t\t  && set2 != TYPE_ALIAS_SET (ptr_type_node))))\n-        lev |= 5;\n+\t\t  && set2 != TYPE_ALIAS_SET (ptr_type_node)))\n+             lev |= 5;\n+\t}\n     }\n \n   return lev;"}, {"sha": "10cc5e849d7a6b66cc2c43a0eb86bee47c2e3ea1", "filename": "gcc/testsuite/ChangeLog", "status": "modified", "additions": 7, "deletions": 0, "changes": 7, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/44c945e62c87d9e01156c9cd6da93f69b984be37/gcc%2Ftestsuite%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/44c945e62c87d9e01156c9cd6da93f69b984be37/gcc%2Ftestsuite%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2FChangeLog?ref=44c945e62c87d9e01156c9cd6da93f69b984be37", "patch": "@@ -1,3 +1,10 @@\n+2018-01-30  Jan Hubicka  <hubicka@ucw.cz>\n+\n+\tPR lto/83954\n+\t* gcc.dg/lto/pr83954.h: New testcase.\n+\t* gcc.dg/lto/pr83954_0.c: New testcase.\n+\t* gcc.dg/lto/pr83954_1.c: New testcase.\n+\n 2018-01-30  Rainer Orth  <ro@CeBiTec.Uni-Bielefeld.DE>\n \n \tPR bootstrap/84017"}, {"sha": "e01554025041d8cec9ad3133bf78ffbd1cb7f760", "filename": "gcc/testsuite/gcc.dg/lto/pr83954.h", "status": "added", "additions": 3, "deletions": 0, "changes": 3, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/44c945e62c87d9e01156c9cd6da93f69b984be37/gcc%2Ftestsuite%2Fgcc.dg%2Flto%2Fpr83954.h", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/44c945e62c87d9e01156c9cd6da93f69b984be37/gcc%2Ftestsuite%2Fgcc.dg%2Flto%2Fpr83954.h", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgcc.dg%2Flto%2Fpr83954.h?ref=44c945e62c87d9e01156c9cd6da93f69b984be37", "patch": "@@ -0,0 +1,3 @@\n+struct foo;\n+extern struct foo *FOO_PTR_ARR[1];\n+"}, {"sha": "5fb7f76008a7b399f9ae0e88f4a7a03845f15584", "filename": "gcc/testsuite/gcc.dg/lto/pr83954_0.c", "status": "added", "additions": 8, "deletions": 0, "changes": 8, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/44c945e62c87d9e01156c9cd6da93f69b984be37/gcc%2Ftestsuite%2Fgcc.dg%2Flto%2Fpr83954_0.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/44c945e62c87d9e01156c9cd6da93f69b984be37/gcc%2Ftestsuite%2Fgcc.dg%2Flto%2Fpr83954_0.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgcc.dg%2Flto%2Fpr83954_0.c?ref=44c945e62c87d9e01156c9cd6da93f69b984be37", "patch": "@@ -0,0 +1,8 @@\n+/* { dg-lto-do link } */\n+#include \"pr83954.h\"\n+\n+int main() { \n+  // just to prevent symbol removal\n+  FOO_PTR_ARR[1] = 0;\n+  return 0;\n+}"}, {"sha": "61b40fc77598f17539ce0725a528017d240d03d5", "filename": "gcc/testsuite/gcc.dg/lto/pr83954_1.c", "status": "added", "additions": 7, "deletions": 0, "changes": 7, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/44c945e62c87d9e01156c9cd6da93f69b984be37/gcc%2Ftestsuite%2Fgcc.dg%2Flto%2Fpr83954_1.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/44c945e62c87d9e01156c9cd6da93f69b984be37/gcc%2Ftestsuite%2Fgcc.dg%2Flto%2Fpr83954_1.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgcc.dg%2Flto%2Fpr83954_1.c?ref=44c945e62c87d9e01156c9cd6da93f69b984be37", "patch": "@@ -0,0 +1,7 @@\n+#include \"pr83954.h\"\n+\n+struct foo {\n+ int x;\n+};\n+struct foo *FOO_PTR_ARR[1] = { 0 };\n+"}]}