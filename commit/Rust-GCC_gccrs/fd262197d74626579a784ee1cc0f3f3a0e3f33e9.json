{"sha": "fd262197d74626579a784ee1cc0f3f3a0e3f33e9", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6ZmQyNjIxOTdkNzQ2MjY1NzlhNzg0ZWUxY2MwZjNmM2EwZTNmMzNlOQ==", "commit": {"author": {"name": "Jerry DeLisle", "email": "jvdelisle@gcc.gnu.org", "date": "2017-05-29T19:17:57Z"}, "committer": {"name": "Jerry DeLisle", "email": "jvdelisle@gcc.gnu.org", "date": "2017-05-29T19:17:57Z"}, "message": "re PR fortran/53029 (missed optimization in internal read (without implied-do-loop))\n\n2017-05-29  Jerry DeLisle  <jvdelisle@gcc.gnu.org>\n\n\tPR libgfortran/53029\n\t* list_read.c (list_formatted_read_scala): Set the err return\n\tvalue to the common.flags error values.\n\n\t* gfortran.dg/read_5.f90: New test.\n\nFrom-SVN: r248577", "tree": {"sha": "92cfd1b6d2284c50ad86327360b617f65d955161", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/92cfd1b6d2284c50ad86327360b617f65d955161"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/fd262197d74626579a784ee1cc0f3f3a0e3f33e9", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/fd262197d74626579a784ee1cc0f3f3a0e3f33e9", "html_url": "https://github.com/Rust-GCC/gccrs/commit/fd262197d74626579a784ee1cc0f3f3a0e3f33e9", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/fd262197d74626579a784ee1cc0f3f3a0e3f33e9/comments", "author": null, "committer": null, "parents": [{"sha": "a5cfa13ab9ef5b9a740129fca6b73acea436c493", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/a5cfa13ab9ef5b9a740129fca6b73acea436c493", "html_url": "https://github.com/Rust-GCC/gccrs/commit/a5cfa13ab9ef5b9a740129fca6b73acea436c493"}], "stats": {"total": 37, "additions": 37, "deletions": 0}, "files": [{"sha": "58dd05b305585d3b63935ebd610dfe3dec8f8e9a", "filename": "gcc/testsuite/ChangeLog", "status": "modified", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/fd262197d74626579a784ee1cc0f3f3a0e3f33e9/gcc%2Ftestsuite%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/fd262197d74626579a784ee1cc0f3f3a0e3f33e9/gcc%2Ftestsuite%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2FChangeLog?ref=fd262197d74626579a784ee1cc0f3f3a0e3f33e9", "patch": "@@ -1,3 +1,8 @@\n+2017-05-29  Jerry DeLisle  <jvdelisle@gcc.gnu.org>\n+\n+\tPR libgfortran/53029\n+\t* gfortran.dg/read_5.f90: New test.\n+\n 2017-05-29  Nathan Sidwell  <nathan@acm.org>\n \n \tPR c++/80891 (#4)"}, {"sha": "81f1f11cf285afd27586eba95fe0c86e82024916", "filename": "gcc/testsuite/gfortran.dg/read_5.f90", "status": "added", "additions": 21, "deletions": 0, "changes": 21, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/fd262197d74626579a784ee1cc0f3f3a0e3f33e9/gcc%2Ftestsuite%2Fgfortran.dg%2Fread_5.f90", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/fd262197d74626579a784ee1cc0f3f3a0e3f33e9/gcc%2Ftestsuite%2Fgfortran.dg%2Fread_5.f90", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgfortran.dg%2Fread_5.f90?ref=fd262197d74626579a784ee1cc0f3f3a0e3f33e9", "patch": "@@ -0,0 +1,21 @@\n+! { dg-do run }\n+! PR53029 Missed optimization, this test case took several seconds to\n+      program internalread\n+      implicit none\n+      integer m\n+      parameter(m=1000000)\n+      character value*10\n+      character(80) :: result\n+      integer i,j,intvalues(m)\n+      real :: start, finish\n+      intvalues = 33\n+      call cpu_time(start)\n+      do j=1,100\n+        write(value,'(i3,a5)') j,\" 5 69\"\n+        read(value,*,end=20) intvalues\n+   20   write(result,*) (intvalues(i),i=2,4)\n+      if (result.ne.('           5          69          33')) call abort\n+      call cpu_time(finish)\n+      if ((finish-start).gt. 0.5) call abort\n+      enddo\n+      end program internalread"}, {"sha": "e763232744d8a73dee5bc0760cfeb266092f05c7", "filename": "libgfortran/ChangeLog", "status": "modified", "additions": 6, "deletions": 0, "changes": 6, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/fd262197d74626579a784ee1cc0f3f3a0e3f33e9/libgfortran%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/fd262197d74626579a784ee1cc0f3f3a0e3f33e9/libgfortran%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libgfortran%2FChangeLog?ref=fd262197d74626579a784ee1cc0f3f3a0e3f33e9", "patch": "@@ -1,3 +1,9 @@\n+2017-05-29  Jerry DeLisle  <jvdelisle@gcc.gnu.org>\n+\n+\tPR libgfortran/53029\n+\t* list_read.c (list_formatted_read_scala): Set the err return\n+\tvalue to the common.flags error values.\n+\n 2017-05-28  Rainer Orth  <ro@CeBiTec.Uni-Bielefeld.DE>\n \n \t* acinclude.m4 (LIBGFOR_CHECK_FMA3): Use test from"}, {"sha": "b6cd66706bb079efbe9875a03b7bfec308e9b204", "filename": "libgfortran/io/list_read.c", "status": "modified", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/fd262197d74626579a784ee1cc0f3f3a0e3f33e9/libgfortran%2Fio%2Flist_read.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/fd262197d74626579a784ee1cc0f3f3a0e3f33e9/libgfortran%2Fio%2Flist_read.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libgfortran%2Fio%2Flist_read.c?ref=fd262197d74626579a784ee1cc0f3f3a0e3f33e9", "patch": "@@ -2298,11 +2298,16 @@ list_formatted_read_scalar (st_parameter_dt *dtp, bt type, void *p,\n     free_saved (dtp);\n \n cleanup:\n+  /* err may have been set above from finish_separator, so if it is set\n+     trigger the hit_eof. The hit_eof will set bits in common.flags.  */\n   if (err == LIBERROR_END)\n     {\n       free_line (dtp);\n       hit_eof (dtp);\n     }\n+  /* Now we check common.flags for any errors that could have occurred in\n+     a READ elsewhere such as in read_integer.  */\n+  err = dtp->common.flags & IOPARM_LIBRETURN_MASK;\n   fbuf_flush_list (dtp->u.p.current_unit, LIST_READING);\n   return err;\n }"}]}