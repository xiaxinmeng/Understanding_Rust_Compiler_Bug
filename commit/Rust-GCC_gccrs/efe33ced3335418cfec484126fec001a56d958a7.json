{"sha": "efe33ced3335418cfec484126fec001a56d958a7", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6ZWZlMzNjZWQzMzM1NDE4Y2ZlYzQ4NDEyNmZlYzAwMWE1NmQ5NThhNw==", "commit": {"author": {"name": "Igor Tsimbalist", "email": "igor.v.tsimbalist@intel.com", "date": "2017-11-17T21:22:09Z"}, "committer": {"name": "Igor Tsimbalist", "email": "itsimbal@gcc.gnu.org", "date": "2017-11-17T21:22:09Z"}, "message": "Enable building libgomp with Intel CET\n\nlibgomp/\n\t* configure.ac: Set CET_FLAGS, update XCFLAGS and FCFLAGS.\n\t* acinclude.m4: Add cet.m4.\n\t* configure: Regenerate.\n\t* Makefile.in: Likewise.\n\t* testsuite/Makefile.in: Likewise.\n\nFrom-SVN: r254894", "tree": {"sha": "ef70030968b644d4f92e01f7b881f41a8c860f2f", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/ef70030968b644d4f92e01f7b881f41a8c860f2f"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/efe33ced3335418cfec484126fec001a56d958a7", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/efe33ced3335418cfec484126fec001a56d958a7", "html_url": "https://github.com/Rust-GCC/gccrs/commit/efe33ced3335418cfec484126fec001a56d958a7", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/efe33ced3335418cfec484126fec001a56d958a7/comments", "author": {"login": "itsimbal", "id": 29258612, "node_id": "MDQ6VXNlcjI5MjU4NjEy", "avatar_url": "https://avatars.githubusercontent.com/u/29258612?v=4", "gravatar_id": "", "url": "https://api.github.com/users/itsimbal", "html_url": "https://github.com/itsimbal", "followers_url": "https://api.github.com/users/itsimbal/followers", "following_url": "https://api.github.com/users/itsimbal/following{/other_user}", "gists_url": "https://api.github.com/users/itsimbal/gists{/gist_id}", "starred_url": "https://api.github.com/users/itsimbal/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/itsimbal/subscriptions", "organizations_url": "https://api.github.com/users/itsimbal/orgs", "repos_url": "https://api.github.com/users/itsimbal/repos", "events_url": "https://api.github.com/users/itsimbal/events{/privacy}", "received_events_url": "https://api.github.com/users/itsimbal/received_events", "type": "User", "site_admin": false}, "committer": null, "parents": [{"sha": "efc643e90d0e75d3e003644404d4e29f84f274e6", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/efc643e90d0e75d3e003644404d4e29f84f274e6", "html_url": "https://github.com/Rust-GCC/gccrs/commit/efc643e90d0e75d3e003644404d4e29f84f274e6"}], "stats": {"total": 99, "additions": 93, "deletions": 6}, "files": [{"sha": "2299ed968fb9175d0c193ced03e2450b3a537957", "filename": "libgomp/ChangeLog", "status": "modified", "additions": 8, "deletions": 0, "changes": 8, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/efe33ced3335418cfec484126fec001a56d958a7/libgomp%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/efe33ced3335418cfec484126fec001a56d958a7/libgomp%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libgomp%2FChangeLog?ref=efe33ced3335418cfec484126fec001a56d958a7", "patch": "@@ -1,3 +1,11 @@\n+2017-11-17  Igor Tsimbalist  <igor.v.tsimbalist@intel.com>\n+\n+\t* configure.ac: Set CET_FLAGS, update XCFLAGS and FCFLAGS.\n+\t* acinclude.m4: Add cet.m4.\n+\t* configure: Regenerate.\n+\t* Makefile.in: Likewise.\n+\t* testsuite/Makefile.in: Likewise.\n+\n 2017-11-15  Tom de Vries  <tom@codesourcery.com>\n \n \t* testsuite/libgomp.oacc-c-c++-common/f-asyncwait-1.c: New test, copied"}, {"sha": "6aff7fc0d965a507ec426a8b370d719e30a15b00", "filename": "libgomp/Makefile.in", "status": "modified", "additions": 2, "deletions": 2, "changes": 4, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/efe33ced3335418cfec484126fec001a56d958a7/libgomp%2FMakefile.in", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/efe33ced3335418cfec484126fec001a56d958a7/libgomp%2FMakefile.in", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libgomp%2FMakefile.in?ref=efe33ced3335418cfec484126fec001a56d958a7", "patch": "@@ -105,8 +105,8 @@ am__aclocal_m4_deps = $(top_srcdir)/../config/acx.m4 \\\n \t$(top_srcdir)/../config/tls.m4 $(top_srcdir)/../ltoptions.m4 \\\n \t$(top_srcdir)/../ltsugar.m4 $(top_srcdir)/../ltversion.m4 \\\n \t$(top_srcdir)/../lt~obsolete.m4 $(top_srcdir)/acinclude.m4 \\\n-\t$(top_srcdir)/../libtool.m4 $(top_srcdir)/plugin/configfrag.ac \\\n-\t$(top_srcdir)/configure.ac\n+\t$(top_srcdir)/../libtool.m4 $(top_srcdir)/../config/cet.m4 \\\n+\t$(top_srcdir)/plugin/configfrag.ac $(top_srcdir)/configure.ac\n am__configure_deps = $(am__aclocal_m4_deps) $(CONFIGURE_DEPENDENCIES) \\\n \t$(ACLOCAL_M4)\n am__CONFIG_DISTCLEAN_FILES = config.status config.cache config.log \\"}, {"sha": "51f4f30256cbbafc49e5339809a75f3f228736e4", "filename": "libgomp/acinclude.m4", "status": "modified", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/efe33ced3335418cfec484126fec001a56d958a7/libgomp%2Facinclude.m4", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/efe33ced3335418cfec484126fec001a56d958a7/libgomp%2Facinclude.m4", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libgomp%2Facinclude.m4?ref=efe33ced3335418cfec484126fec001a56d958a7", "patch": "@@ -56,6 +56,7 @@ extern void bar(void) __attribute__((alias(\"foo\")));],\n   fi])\n \n sinclude(../libtool.m4)\n+sinclude(../config/cet.m4)\n dnl The lines below arrange for aclocal not to bring an installed\n dnl libtool.m4 into aclocal.m4, while still arranging for automake to\n dnl add a definition of LIBTOOL to Makefile.in."}, {"sha": "e7842b5519f15e45eb91844a5afd9ebf5a24a754", "filename": "libgomp/configure", "status": "modified", "additions": 75, "deletions": 2, "changes": 77, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/efe33ced3335418cfec484126fec001a56d958a7/libgomp%2Fconfigure", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/efe33ced3335418cfec484126fec001a56d958a7/libgomp%2Fconfigure", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libgomp%2Fconfigure?ref=efe33ced3335418cfec484126fec001a56d958a7", "patch": "@@ -799,6 +799,7 @@ with_hsa_runtime_lib\n enable_linux_futex\n enable_tls\n enable_symvers\n+enable_cet\n with_gcc_major_version_only\n '\n       ac_precious_vars='build_alias\n@@ -1451,6 +1452,8 @@ Optional Features:\n   --enable-tls            Use thread-local storage [default=yes]\n   --enable-symvers=STYLE  enables symbol versioning of the shared library\n                           [default=yes]\n+  --enable-cet            enable Intel CET in target libraries\n+                          [default=default]\n \n Optional Packages:\n   --with-PACKAGE[=ARG]    use PACKAGE [ARG=yes]\n@@ -11155,7 +11158,7 @@ else\n   lt_dlunknown=0; lt_dlno_uscore=1; lt_dlneed_uscore=2\n   lt_status=$lt_dlunknown\n   cat > conftest.$ac_ext <<_LT_EOF\n-#line 11158 \"configure\"\n+#line 11161 \"configure\"\n #include \"confdefs.h\"\n \n #if HAVE_DLFCN_H\n@@ -11261,7 +11264,7 @@ else\n   lt_dlunknown=0; lt_dlno_uscore=1; lt_dlneed_uscore=2\n   lt_status=$lt_dlunknown\n   cat > conftest.$ac_ext <<_LT_EOF\n-#line 11264 \"configure\"\n+#line 11267 \"configure\"\n #include \"confdefs.h\"\n \n #if HAVE_DLFCN_H\n@@ -16616,6 +16619,76 @@ $as_echo \"#define HAVE_SYNC_BUILTINS 1\" >>confdefs.h\n \n XCFLAGS=\"$XCFLAGS$XPCFLAGS\"\n \n+# Add CET specific flags if CET is enabled\n+ # Check whether --enable-cet was given.\n+if test \"${enable_cet+set}\" = set; then :\n+  enableval=$enable_cet;\n+      case \"$enableval\" in\n+       yes|no|default) ;;\n+       *) as_fn_error \"Unknown argument to enable/disable cet\" \"$LINENO\" 5 ;;\n+                          esac\n+\n+else\n+  enable_cet=default\n+fi\n+\n+\n+case \"$host\" in\n+  i[34567]86-*-linux* | x86_64-*-linux*)\n+    case \"$enable_cet\" in\n+      default)\n+\t# Check if assembler supports CET.\n+\tcat confdefs.h - <<_ACEOF >conftest.$ac_ext\n+/* end confdefs.h.  */\n+\n+int\n+main ()\n+{\n+asm (\"setssbsy\");\n+  ;\n+  return 0;\n+}\n+_ACEOF\n+if ac_fn_c_try_compile \"$LINENO\"; then :\n+  enable_cet=yes\n+else\n+  enable_cet=no\n+fi\n+rm -f core conftest.err conftest.$ac_objext conftest.$ac_ext\n+\t;;\n+      yes)\n+\t# Check if assembler supports CET.\n+\tcat confdefs.h - <<_ACEOF >conftest.$ac_ext\n+/* end confdefs.h.  */\n+\n+int\n+main ()\n+{\n+asm (\"setssbsy\");\n+  ;\n+  return 0;\n+}\n+_ACEOF\n+if ac_fn_c_try_compile \"$LINENO\"; then :\n+\n+else\n+  as_fn_error \"assembler with CET support is required for --enable-cet\" \"$LINENO\" 5\n+fi\n+rm -f core conftest.err conftest.$ac_objext conftest.$ac_ext\n+\t;;\n+    esac\n+    ;;\n+  *)\n+    enable_cet=no\n+    ;;\n+esac\n+if test x$enable_cet = xyes; then\n+  CET_FLAGS=\"-fcf-protection -mcet\"\n+fi\n+\n+XCFLAGS=\"$XCFLAGS $CET_FLAGS\"\n+FCFLAGS=\"$FCFLAGS $CET_FLAGS\"\n+\n \n \n "}, {"sha": "4e0bc8166a9bf7281dd20df5b5d68e6f07478827", "filename": "libgomp/configure.ac", "status": "modified", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/efe33ced3335418cfec484126fec001a56d958a7/libgomp%2Fconfigure.ac", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/efe33ced3335418cfec484126fec001a56d958a7/libgomp%2Fconfigure.ac", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libgomp%2Fconfigure.ac?ref=efe33ced3335418cfec484126fec001a56d958a7", "patch": "@@ -293,6 +293,11 @@ LIBGOMP_CHECK_SYNC_BUILTINS\n \n XCFLAGS=\"$XCFLAGS$XPCFLAGS\"\n \n+# Add CET specific flags if CET is enabled\n+GCC_CET_FLAGS(CET_FLAGS)\n+XCFLAGS=\"$XCFLAGS $CET_FLAGS\"\n+FCFLAGS=\"$FCFLAGS $CET_FLAGS\"\n+\n AC_SUBST(config_path)\n AC_SUBST(XCFLAGS)\n AC_SUBST(XLDFLAGS)"}, {"sha": "9310138c32c9bb09738d416ce0f7ce11ccef378b", "filename": "libgomp/testsuite/Makefile.in", "status": "modified", "additions": 2, "deletions": 2, "changes": 4, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/efe33ced3335418cfec484126fec001a56d958a7/libgomp%2Ftestsuite%2FMakefile.in", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/efe33ced3335418cfec484126fec001a56d958a7/libgomp%2Ftestsuite%2FMakefile.in", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libgomp%2Ftestsuite%2FMakefile.in?ref=efe33ced3335418cfec484126fec001a56d958a7", "patch": "@@ -67,8 +67,8 @@ am__aclocal_m4_deps = $(top_srcdir)/../config/acx.m4 \\\n \t$(top_srcdir)/../config/tls.m4 $(top_srcdir)/../ltoptions.m4 \\\n \t$(top_srcdir)/../ltsugar.m4 $(top_srcdir)/../ltversion.m4 \\\n \t$(top_srcdir)/../lt~obsolete.m4 $(top_srcdir)/acinclude.m4 \\\n-\t$(top_srcdir)/../libtool.m4 $(top_srcdir)/plugin/configfrag.ac \\\n-\t$(top_srcdir)/configure.ac\n+\t$(top_srcdir)/../libtool.m4 $(top_srcdir)/../config/cet.m4 \\\n+\t$(top_srcdir)/plugin/configfrag.ac $(top_srcdir)/configure.ac\n am__configure_deps = $(am__aclocal_m4_deps) $(CONFIGURE_DEPENDENCIES) \\\n \t$(ACLOCAL_M4)\n mkinstalldirs = $(SHELL) $(top_srcdir)/../mkinstalldirs"}]}