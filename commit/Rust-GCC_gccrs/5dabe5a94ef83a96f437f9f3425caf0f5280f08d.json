{"sha": "5dabe5a94ef83a96f437f9f3425caf0f5280f08d", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6NWRhYmU1YTk0ZWY4M2E5NmY0MzdmOWYzNDI1Y2FmMGY1MjgwZjA4ZA==", "commit": {"author": {"name": "Richard Sandiford", "email": "richard.sandiford@arm.com", "date": "2014-10-26T10:40:15Z"}, "committer": {"name": "Richard Sandiford", "email": "rsandifo@gcc.gnu.org", "date": "2014-10-26T10:40:15Z"}, "message": "sh-protos.h (shmedia_cleanup_truncate): Take an rtx as argument and return the number of changes.\n\ngcc/\n\t* config/sh/sh-protos.h (shmedia_cleanup_truncate): Take an\n\trtx as argument and return the number of changes.\n\t* config/sh/sh.c: Include rtl-iter.h.\n\t(shmedia_cleanup_truncate): Take an rtx as argument and iterate\n\tover all subrtxes.  Return the number of changes made.\n\t* config/sh/sh.md: Update caller accordingly.\n\nFrom-SVN: r216701", "tree": {"sha": "6ba9d4ba81a5e022c7bec20213ef7e639b35421d", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/6ba9d4ba81a5e022c7bec20213ef7e639b35421d"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/5dabe5a94ef83a96f437f9f3425caf0f5280f08d", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/5dabe5a94ef83a96f437f9f3425caf0f5280f08d", "html_url": "https://github.com/Rust-GCC/gccrs/commit/5dabe5a94ef83a96f437f9f3425caf0f5280f08d", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/5dabe5a94ef83a96f437f9f3425caf0f5280f08d/comments", "author": {"login": "rsandifo-arm", "id": 28043039, "node_id": "MDQ6VXNlcjI4MDQzMDM5", "avatar_url": "https://avatars.githubusercontent.com/u/28043039?v=4", "gravatar_id": "", "url": "https://api.github.com/users/rsandifo-arm", "html_url": "https://github.com/rsandifo-arm", "followers_url": "https://api.github.com/users/rsandifo-arm/followers", "following_url": "https://api.github.com/users/rsandifo-arm/following{/other_user}", "gists_url": "https://api.github.com/users/rsandifo-arm/gists{/gist_id}", "starred_url": "https://api.github.com/users/rsandifo-arm/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/rsandifo-arm/subscriptions", "organizations_url": "https://api.github.com/users/rsandifo-arm/orgs", "repos_url": "https://api.github.com/users/rsandifo-arm/repos", "events_url": "https://api.github.com/users/rsandifo-arm/events{/privacy}", "received_events_url": "https://api.github.com/users/rsandifo-arm/received_events", "type": "User", "site_admin": false}, "committer": null, "parents": [{"sha": "a57841528cd3cb916985b4b650759f30eb37eaaa", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/a57841528cd3cb916985b4b650759f30eb37eaaa", "html_url": "https://github.com/Rust-GCC/gccrs/commit/a57841528cd3cb916985b4b650759f30eb37eaaa"}], "stats": {"total": 52, "additions": 32, "deletions": 20}, "files": [{"sha": "c33e0e5033e3f93634086a0cf24e74559877c52f", "filename": "gcc/ChangeLog", "status": "modified", "additions": 9, "deletions": 0, "changes": 9, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/5dabe5a94ef83a96f437f9f3425caf0f5280f08d/gcc%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/5dabe5a94ef83a96f437f9f3425caf0f5280f08d/gcc%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2FChangeLog?ref=5dabe5a94ef83a96f437f9f3425caf0f5280f08d", "patch": "@@ -1,3 +1,12 @@\n+2014-10-26  Richard Sandiford  <richard.sandiford@arm.com>\n+\n+\t* config/sh/sh-protos.h (shmedia_cleanup_truncate): Take an\n+\trtx as argument and return the number of changes.\n+\t* config/sh/sh.c: Include rtl-iter.h.\n+\t(shmedia_cleanup_truncate): Take an rtx as argument and iterate\n+\tover all subrtxes.  Return the number of changes made.\n+\t* config/sh/sh.md: Update caller accordingly.\n+\n 2014-10-26  Richard Sandiford  <richard.sandiford@arm.com>\n \n \t* config/m68k/m68k.c (m68k_tls_reference_p_1): Delete."}, {"sha": "a170c11537428e469c53cf5292eceb20bbad327d", "filename": "gcc/config/sh/sh-protos.h", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/5dabe5a94ef83a96f437f9f3425caf0f5280f08d/gcc%2Fconfig%2Fsh%2Fsh-protos.h", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/5dabe5a94ef83a96f437f9f3425caf0f5280f08d/gcc%2Fconfig%2Fsh%2Fsh-protos.h", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fconfig%2Fsh%2Fsh-protos.h?ref=5dabe5a94ef83a96f437f9f3425caf0f5280f08d", "patch": "@@ -215,7 +215,7 @@ extern void sh_init_cumulative_args (CUMULATIVE_ARGS *, tree, rtx, tree,\n extern rtx sh_dwarf_register_span (rtx);\n \n extern rtx replace_n_hard_rtx (rtx, rtx *, int , int);\n-extern int shmedia_cleanup_truncate (rtx *, void *);\n+extern int shmedia_cleanup_truncate (rtx);\n \n extern bool sh_contains_memref_p (rtx);\n extern bool sh_loads_bankedreg_p (rtx);"}, {"sha": "2d1a9273a756cb8176899843b91a75f4ad4ca906", "filename": "gcc/config/sh/sh.c", "status": "modified", "additions": 21, "deletions": 15, "changes": 36, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/5dabe5a94ef83a96f437f9f3425caf0f5280f08d/gcc%2Fconfig%2Fsh%2Fsh.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/5dabe5a94ef83a96f437f9f3425caf0f5280f08d/gcc%2Fconfig%2Fsh%2Fsh.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fconfig%2Fsh%2Fsh.c?ref=5dabe5a94ef83a96f437f9f3425caf0f5280f08d", "patch": "@@ -78,6 +78,7 @@ along with GCC; see the file COPYING3.  If not see\n #include \"pass_manager.h\"\n #include \"context.h\"\n #include \"builtins.h\"\n+#include \"rtl-iter.h\"\n \n int code_for_indirect_jump_scratch = CODE_FOR_indirect_jump_scratch;\n \n@@ -12940,25 +12941,30 @@ sh_gen_truncate (enum machine_mode mode, rtx x, int need_sign_ext)\n   return gen_rtx_fmt_e (code, mode, x);\n }\n \n-/* Called via for_each_rtx after reload, to clean up truncates of\n-   registers that span multiple actual hard registers.  */\n+/* Look through X cleaning up truncates of registers that span multiple\n+   actual hard registers.  Return the number of changes made.  */\n int\n-shmedia_cleanup_truncate (rtx *p, void *n_changes)\n+shmedia_cleanup_truncate (rtx x)\n {\n-  rtx x = *p, reg;\n-\n-  if (GET_CODE (x) != TRUNCATE)\n-    return 0;\n-  reg = XEXP (x, 0);\n-  if (GET_MODE_SIZE (GET_MODE (reg)) > 8 && REG_P (reg))\n+  int n_changes = 0;\n+  subrtx_var_iterator::array_type array;\n+  FOR_EACH_SUBRTX_VAR (iter, array, x, NONCONST)\n     {\n-      enum machine_mode reg_mode = GET_MODE (reg);\n-      XEXP (x, 0) = simplify_subreg (DImode, reg, reg_mode,\n-\t\t\t\t     subreg_lowpart_offset (DImode, reg_mode));\n-      *(int*) n_changes += 1;\n-      return -1;\n+      rtx x = *iter;\n+      if (GET_CODE (x) == TRUNCATE)\n+\t{\n+\t  rtx reg = XEXP (x, 0);\n+\t  enum machine_mode reg_mode = GET_MODE (reg);\n+\t  if (REG_P (reg) && GET_MODE_SIZE (reg_mode) > 8)\n+\t    {\n+\t      int offset = subreg_lowpart_offset (DImode, reg_mode);\n+\t      XEXP (x, 0) = simplify_subreg (DImode, reg, reg_mode, offset);\n+\t      n_changes += 1;\n+\t      iter.skip_subrtxes ();\n+\t    }\n+\t}\n     }\n-  return 0;\n+  return n_changes;\n }\n \n /* Load and store depend on the highpart of the address.  However,"}, {"sha": "e0c0940bf3c19330a35a0b34d44c8436506836f6", "filename": "gcc/config/sh/sh.md", "status": "modified", "additions": 1, "deletions": 4, "changes": 5, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/5dabe5a94ef83a96f437f9f3425caf0f5280f08d/gcc%2Fconfig%2Fsh%2Fsh.md", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/5dabe5a94ef83a96f437f9f3425caf0f5280f08d/gcc%2Fconfig%2Fsh%2Fsh.md", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fconfig%2Fsh%2Fsh.md?ref=5dabe5a94ef83a96f437f9f3425caf0f5280f08d", "patch": "@@ -15803,10 +15803,7 @@ label:\n   \"TARGET_SHMEDIA && reload_completed\"\n   [(set (match_dup 0) (match_dup 1))]\n {\n-  int n_changes = 0;\n-\n-  for_each_rtx (&operands[1], shmedia_cleanup_truncate, &n_changes);\n-  if (!n_changes)\n+  if (!shmedia_cleanup_truncate (operands[1]))\n     FAIL;\n })\n "}]}