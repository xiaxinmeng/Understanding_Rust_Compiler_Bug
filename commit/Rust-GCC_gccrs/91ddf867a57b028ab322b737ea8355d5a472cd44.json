{"sha": "91ddf867a57b028ab322b737ea8355d5a472cd44", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6OTFkZGY4NjdhNTdiMDI4YWIzMjJiNzM3ZWE4MzU1ZDVhNDcyY2Q0NA==", "commit": {"author": {"name": "Jakub Jelinek", "email": "jakub@redhat.com", "date": "2020-12-01T20:41:44Z"}, "committer": {"name": "Jakub Jelinek", "email": "jakub@redhat.com", "date": "2020-12-01T20:46:03Z"}, "message": "openmp: Avoid ICE on depend clause on depobj OpenMP construct [PR98072]\n\nSince r11-5430 we ICE on the following testcase.  When parsing the depobj\ndirective we don't really use cp_parser_omp_all_clauses routine which ATM\ndisables generation of location wrappers and the newly added assertion\nthat there are no location wrappers thus triggers.\n\nFixed by adding the location wrappers suppression sentinel.\n\nLonger term, we should handle location wrappers inside of OpenMP clauses.\n\n2020-12-01  Jakub Jelinek  <jakub@redhat.com>\n\n\tPR c++/98072\n\t* parser.c (cp_parser_omp_depobj): Suppress location wrappers when\n\tparsing depend clause.\n\n\t* c-c++-common/gomp/depobj-2.c: New test.", "tree": {"sha": "9d41ad142b68b1b5856a1be28230e50801b2cbee", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/9d41ad142b68b1b5856a1be28230e50801b2cbee"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/91ddf867a57b028ab322b737ea8355d5a472cd44", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/91ddf867a57b028ab322b737ea8355d5a472cd44", "html_url": "https://github.com/Rust-GCC/gccrs/commit/91ddf867a57b028ab322b737ea8355d5a472cd44", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/91ddf867a57b028ab322b737ea8355d5a472cd44/comments", "author": {"login": "jakubjelinek", "id": 9370665, "node_id": "MDQ6VXNlcjkzNzA2NjU=", "avatar_url": "https://avatars.githubusercontent.com/u/9370665?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jakubjelinek", "html_url": "https://github.com/jakubjelinek", "followers_url": "https://api.github.com/users/jakubjelinek/followers", "following_url": "https://api.github.com/users/jakubjelinek/following{/other_user}", "gists_url": "https://api.github.com/users/jakubjelinek/gists{/gist_id}", "starred_url": "https://api.github.com/users/jakubjelinek/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jakubjelinek/subscriptions", "organizations_url": "https://api.github.com/users/jakubjelinek/orgs", "repos_url": "https://api.github.com/users/jakubjelinek/repos", "events_url": "https://api.github.com/users/jakubjelinek/events{/privacy}", "received_events_url": "https://api.github.com/users/jakubjelinek/received_events", "type": "User", "site_admin": false}, "committer": {"login": "jakubjelinek", "id": 9370665, "node_id": "MDQ6VXNlcjkzNzA2NjU=", "avatar_url": "https://avatars.githubusercontent.com/u/9370665?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jakubjelinek", "html_url": "https://github.com/jakubjelinek", "followers_url": "https://api.github.com/users/jakubjelinek/followers", "following_url": "https://api.github.com/users/jakubjelinek/following{/other_user}", "gists_url": "https://api.github.com/users/jakubjelinek/gists{/gist_id}", "starred_url": "https://api.github.com/users/jakubjelinek/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jakubjelinek/subscriptions", "organizations_url": "https://api.github.com/users/jakubjelinek/orgs", "repos_url": "https://api.github.com/users/jakubjelinek/repos", "events_url": "https://api.github.com/users/jakubjelinek/events{/privacy}", "received_events_url": "https://api.github.com/users/jakubjelinek/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "d02c41dd414dcc65a08bc82f312f7808b5d90028", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/d02c41dd414dcc65a08bc82f312f7808b5d90028", "html_url": "https://github.com/Rust-GCC/gccrs/commit/d02c41dd414dcc65a08bc82f312f7808b5d90028"}], "stats": {"total": 13, "additions": 13, "deletions": 0}, "files": [{"sha": "52743b03be29146d2604003f3e373d030a4b0b2f", "filename": "gcc/cp/parser.c", "status": "modified", "additions": 2, "deletions": 0, "changes": 2, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/91ddf867a57b028ab322b737ea8355d5a472cd44/gcc%2Fcp%2Fparser.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/91ddf867a57b028ab322b737ea8355d5a472cd44/gcc%2Fcp%2Fparser.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fcp%2Fparser.c?ref=91ddf867a57b028ab322b737ea8355d5a472cd44", "patch": "@@ -38787,6 +38787,8 @@ cp_parser_omp_depobj (cp_parser *parser, cp_token *pragma_tok)\n       cp_lexer_consume_token (parser->lexer);\n       if (!strcmp (\"depend\", p))\n \t{\n+\t  /* Don't create location wrapper nodes within the depend clause.  */\n+\t  auto_suppress_location_wrappers sentinel;\n \t  clause = cp_parser_omp_clause_depend (parser, NULL_TREE, c_loc);\n \t  if (clause)\n \t    clause = finish_omp_clauses (clause, C_ORT_OMP);"}, {"sha": "d06910c420a6c1c2b0e5b718ba5e7b3f1a572aae", "filename": "gcc/testsuite/c-c++-common/gomp/depobj-2.c", "status": "added", "additions": 11, "deletions": 0, "changes": 11, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/91ddf867a57b028ab322b737ea8355d5a472cd44/gcc%2Ftestsuite%2Fc-c%2B%2B-common%2Fgomp%2Fdepobj-2.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/91ddf867a57b028ab322b737ea8355d5a472cd44/gcc%2Ftestsuite%2Fc-c%2B%2B-common%2Fgomp%2Fdepobj-2.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fc-c%2B%2B-common%2Fgomp%2Fdepobj-2.c?ref=91ddf867a57b028ab322b737ea8355d5a472cd44", "patch": "@@ -0,0 +1,11 @@\n+/* PR c++/98072 */\n+\n+typedef struct __attribute__((__aligned__ (sizeof (void *)))) omp_depend_t {\n+  char __omp_depend_t__[2 * sizeof (void *)];\n+} omp_depend_t;\n+\n+void\n+foo (int *x, omp_depend_t *y, int z)\n+{\n+  #pragma omp depobj (*y) depend (in: x[z])\n+}"}]}