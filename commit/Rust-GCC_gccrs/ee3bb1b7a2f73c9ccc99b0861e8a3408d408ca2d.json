{"sha": "ee3bb1b7a2f73c9ccc99b0861e8a3408d408ca2d", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6ZWUzYmIxYjdhMmY3M2M5Y2NjOTliMDg2MWU4YTM0MDhkNDA4Y2EyZA==", "commit": {"author": {"name": "Janus Weil", "email": "janus@gcc.gnu.org", "date": "2018-02-14T21:46:59Z"}, "committer": {"name": "Janus Weil", "email": "janus@gcc.gnu.org", "date": "2018-02-14T21:46:59Z"}, "message": "re PR fortran/84385 ([F03] Reject invalid SELECT TYPE selector (allocate_with_source_22.f03))\n\n2018-02-14  Janus Weil  <janus@gcc.gnu.org>\n\n\tPR fortran/84385\n\t* match.c (gfc_match_select_type): Fix check for selector in\n\tSELECT TYPE statement.\n\n\n2018-02-14  Janus Weil  <janus@gcc.gnu.org>\n\n\tPR fortran/84385\n\t* gfortran.dg/allocate_with_source_22.f03: Fix invalid test case.\n\t* gfortran.dg/allocate_with_source_23.f90: Ditto.\n\t* gfortran.dg/select_type_1.f03: Extend test case.\n\nFrom-SVN: r257673", "tree": {"sha": "d73e71b2cb9316303d25db93a31702bac268629c", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/d73e71b2cb9316303d25db93a31702bac268629c"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/ee3bb1b7a2f73c9ccc99b0861e8a3408d408ca2d", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/ee3bb1b7a2f73c9ccc99b0861e8a3408d408ca2d", "html_url": "https://github.com/Rust-GCC/gccrs/commit/ee3bb1b7a2f73c9ccc99b0861e8a3408d408ca2d", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/ee3bb1b7a2f73c9ccc99b0861e8a3408d408ca2d/comments", "author": {"login": "janusw", "id": 484108, "node_id": "MDQ6VXNlcjQ4NDEwOA==", "avatar_url": "https://avatars.githubusercontent.com/u/484108?v=4", "gravatar_id": "", "url": "https://api.github.com/users/janusw", "html_url": "https://github.com/janusw", "followers_url": "https://api.github.com/users/janusw/followers", "following_url": "https://api.github.com/users/janusw/following{/other_user}", "gists_url": "https://api.github.com/users/janusw/gists{/gist_id}", "starred_url": "https://api.github.com/users/janusw/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/janusw/subscriptions", "organizations_url": "https://api.github.com/users/janusw/orgs", "repos_url": "https://api.github.com/users/janusw/repos", "events_url": "https://api.github.com/users/janusw/events{/privacy}", "received_events_url": "https://api.github.com/users/janusw/received_events", "type": "User", "site_admin": false}, "committer": {"login": "janusw", "id": 484108, "node_id": "MDQ6VXNlcjQ4NDEwOA==", "avatar_url": "https://avatars.githubusercontent.com/u/484108?v=4", "gravatar_id": "", "url": "https://api.github.com/users/janusw", "html_url": "https://github.com/janusw", "followers_url": "https://api.github.com/users/janusw/followers", "following_url": "https://api.github.com/users/janusw/following{/other_user}", "gists_url": "https://api.github.com/users/janusw/gists{/gist_id}", "starred_url": "https://api.github.com/users/janusw/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/janusw/subscriptions", "organizations_url": "https://api.github.com/users/janusw/orgs", "repos_url": "https://api.github.com/users/janusw/repos", "events_url": "https://api.github.com/users/janusw/events{/privacy}", "received_events_url": "https://api.github.com/users/janusw/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "6ae679894362865b7cb9e77a639e7e3451447f51", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/6ae679894362865b7cb9e77a639e7e3451447f51", "html_url": "https://github.com/Rust-GCC/gccrs/commit/6ae679894362865b7cb9e77a639e7e3451447f51"}], "stats": {"total": 24, "additions": 20, "deletions": 4}, "files": [{"sha": "ed91bf79b52ea22068f56171ffe9217cf246e1c0", "filename": "gcc/fortran/ChangeLog", "status": "modified", "additions": 6, "deletions": 0, "changes": 6, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/ee3bb1b7a2f73c9ccc99b0861e8a3408d408ca2d/gcc%2Ffortran%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/ee3bb1b7a2f73c9ccc99b0861e8a3408d408ca2d/gcc%2Ffortran%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ffortran%2FChangeLog?ref=ee3bb1b7a2f73c9ccc99b0861e8a3408d408ca2d", "patch": "@@ -1,3 +1,9 @@\n+2018-02-14  Janus Weil  <janus@gcc.gnu.org>\n+\n+\tPR fortran/84385\n+\t* match.c (gfc_match_select_type): Fix check for selector in\n+\tSELECT TYPE statement.\n+\n 2018-02-13  Janus Weil  <janus@gcc.gnu.org>\n \n \tPR fortran/84313"}, {"sha": "8f3a027c209d9571401b5076d71a616e932ce051", "filename": "gcc/fortran/match.c", "status": "modified", "additions": 2, "deletions": 1, "changes": 3, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/ee3bb1b7a2f73c9ccc99b0861e8a3408d408ca2d/gcc%2Ffortran%2Fmatch.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/ee3bb1b7a2f73c9ccc99b0861e8a3408d408ca2d/gcc%2Ffortran%2Fmatch.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ffortran%2Fmatch.c?ref=ee3bb1b7a2f73c9ccc99b0861e8a3408d408ca2d", "patch": "@@ -6201,9 +6201,10 @@ gfc_match_select_type (void)\n \t\t     || CLASS_DATA (expr1)->attr.codimension)\n \t\t && expr1->ref\n \t\t && expr1->ref->type == REF_ARRAY\n+\t\t && expr1->ref->u.ar.type == AR_FULL\n \t\t && expr1->ref->next == NULL);\n \n-  /* Check for F03:C811.  */\n+  /* Check for F03:C811 (F08:C835).  */\n   if (!expr2 && (expr1->expr_type != EXPR_VARIABLE\n \t\t || (!class_array && expr1->ref != NULL)))\n     {"}, {"sha": "e3d1cec40f162aa8f282381d14000a0decf6ae85", "filename": "gcc/testsuite/ChangeLog", "status": "modified", "additions": 7, "deletions": 0, "changes": 7, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/ee3bb1b7a2f73c9ccc99b0861e8a3408d408ca2d/gcc%2Ftestsuite%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/ee3bb1b7a2f73c9ccc99b0861e8a3408d408ca2d/gcc%2Ftestsuite%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2FChangeLog?ref=ee3bb1b7a2f73c9ccc99b0861e8a3408d408ca2d", "patch": "@@ -1,3 +1,10 @@\n+2018-02-14  Janus Weil  <janus@gcc.gnu.org>\n+\n+\tPR fortran/84385\n+\t* gfortran.dg/allocate_with_source_22.f03: Fix invalid test case.\n+\t* gfortran.dg/allocate_with_source_23.f90: Ditto.\n+\t* gfortran.dg/select_type_1.f03: Extend test case.\n+\n 2017-02-14  Uros Bizjak  <ubizjak@gmail.com>\n \n \t* gcc.target/i386/pr57193.c (dg-do): Remove target selector."}, {"sha": "babda71a3254c66a87096705db38a9f9f77d853f", "filename": "gcc/testsuite/gfortran.dg/allocate_with_source_22.f03", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/ee3bb1b7a2f73c9ccc99b0861e8a3408d408ca2d/gcc%2Ftestsuite%2Fgfortran.dg%2Fallocate_with_source_22.f03", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/ee3bb1b7a2f73c9ccc99b0861e8a3408d408ca2d/gcc%2Ftestsuite%2Fgfortran.dg%2Fallocate_with_source_22.f03", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgfortran.dg%2Fallocate_with_source_22.f03?ref=ee3bb1b7a2f73c9ccc99b0861e8a3408d408ca2d", "patch": "@@ -27,7 +27,7 @@ subroutine test_class()\n   ! with -fcheck=bounds.\n   if (size(b) /= 4) call abort()\n   if (any(b(1:2)%i /= [ 1,2])) call abort()\n-  select type (b(1))\n+  select type (b1 => b(1))\n     class is (tt)\n       continue\n     class default"}, {"sha": "51ea0c627a457c4e676c01b70c01ce2937970f76", "filename": "gcc/testsuite/gfortran.dg/allocate_with_source_23.f03", "status": "modified", "additions": 2, "deletions": 2, "changes": 4, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/ee3bb1b7a2f73c9ccc99b0861e8a3408d408ca2d/gcc%2Ftestsuite%2Fgfortran.dg%2Fallocate_with_source_23.f03", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/ee3bb1b7a2f73c9ccc99b0861e8a3408d408ca2d/gcc%2Ftestsuite%2Fgfortran.dg%2Fallocate_with_source_23.f03", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgfortran.dg%2Fallocate_with_source_23.f03?ref=ee3bb1b7a2f73c9ccc99b0861e8a3408d408ca2d", "patch": "@@ -28,7 +28,7 @@ subroutine test_class_correct()\n   allocate(b(1:4), source=a(1))\n   if (size(b) /= 4) call abort()\n   if (any(b(:)%i /= [ 1,1,1,1])) call abort()\n-  select type (b(1))\n+  select type (b1 => b(1))\n     class is (tt)\n       continue\n     class default\n@@ -46,7 +46,7 @@ subroutine test_class_fail()\n   allocate(b(1:4), source=a) ! Fail expected: sizes do not conform\n   if (size(b) /= 4) call abort()\n   if (any(b(1:2)%i /= [ 1,2])) call abort()\n-  select type (b(1))\n+  select type (b1 => b(1))\n     class is (tt)\n       continue\n     class default"}, {"sha": "695f75661b87b1cfe3d8cd555b54f3217b35a4fc", "filename": "gcc/testsuite/gfortran.dg/select_type_1.f03", "status": "modified", "additions": 2, "deletions": 0, "changes": 2, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/ee3bb1b7a2f73c9ccc99b0861e8a3408d408ca2d/gcc%2Ftestsuite%2Fgfortran.dg%2Fselect_type_1.f03", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/ee3bb1b7a2f73c9ccc99b0861e8a3408d408ca2d/gcc%2Ftestsuite%2Fgfortran.dg%2Fselect_type_1.f03", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgfortran.dg%2Fselect_type_1.f03?ref=ee3bb1b7a2f73c9ccc99b0861e8a3408d408ca2d", "patch": "@@ -23,6 +23,7 @@\n   end type\n \n   class(t1), pointer :: a => NULL()\n+  class(t1), allocatable, dimension(:) :: ca\n   type(t1), target :: b\n   type(t2), target :: c\n   a => b\n@@ -32,6 +33,7 @@\n \n   select type (3.5)  ! { dg-error \"is not a named variable\" }\n   select type (a%cp) ! { dg-error \"is not a named variable\" }\n+  select type (ca(1))! { dg-error \"is not a named variable\" }\n   select type (b)    ! { dg-error \"Selector shall be polymorphic\" }\n   end select\n "}]}