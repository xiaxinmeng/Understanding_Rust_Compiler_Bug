{"sha": "f52152d6acbf1118835ce6832685d8da00074daf", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6ZjUyMTUyZDZhY2JmMTExODgzNWNlNjgzMjY4NWQ4ZGEwMDA3NGRhZg==", "commit": {"author": {"name": "Jim Wilson", "email": "wilson@gcc.gnu.org", "date": "1993-05-14T21:16:34Z"}, "committer": {"name": "Jim Wilson", "email": "wilson@gcc.gnu.org", "date": "1993-05-14T21:16:34Z"}, "message": "(split_hard_reg_notes): Handle 0th sub register, and multiple register kills.\n\n(split_hard_reg_notes): Handle 0th sub register, and\nmultiple register kills.\n(update_flow_info): For multi-word hard regs, use\nsplit_hard_reg_notes to add all REG_DEAD notes, instead of just\nthe additional ones due to splitting.\n\nFrom-SVN: r4460", "tree": {"sha": "265f9f8d78fdff8ef42a9bbe0344762e257ac114", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/265f9f8d78fdff8ef42a9bbe0344762e257ac114"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/f52152d6acbf1118835ce6832685d8da00074daf", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/f52152d6acbf1118835ce6832685d8da00074daf", "html_url": "https://github.com/Rust-GCC/gccrs/commit/f52152d6acbf1118835ce6832685d8da00074daf", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/f52152d6acbf1118835ce6832685d8da00074daf/comments", "author": null, "committer": null, "parents": [{"sha": "65488bae3e420f9381fe2ff2b217317e1cf58509", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/65488bae3e420f9381fe2ff2b217317e1cf58509", "html_url": "https://github.com/Rust-GCC/gccrs/commit/65488bae3e420f9381fe2ff2b217317e1cf58509"}], "stats": {"total": 37, "additions": 19, "deletions": 18}, "files": [{"sha": "1797d1c7364242902585f744fbcd7967f230c25e", "filename": "gcc/sched.c", "status": "modified", "additions": 19, "deletions": 18, "changes": 37, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/f52152d6acbf1118835ce6832685d8da00074daf/gcc%2Fsched.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/f52152d6acbf1118835ce6832685d8da00074daf/gcc%2Fsched.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fsched.c?ref=f52152d6acbf1118835ce6832685d8da00074daf", "patch": "@@ -3833,11 +3833,7 @@ split_hard_reg_notes (note, first, last, orig_insn)\n \n   n_regs = HARD_REGNO_NREGS (REGNO (reg), GET_MODE (reg));\n \n-  /* ??? Could add check here to see whether, the hard register is referenced\n-     in the same mode as in the original insn.  If so, then it has not been\n-     split, and the rest of the code below is unnecessary.  */\n-\n-  for (i = 1; i < n_regs; i++)\n+  for (i = 0; i < n_regs; i++)\n     {\n       new_reg = REGNO (reg) + i;\n \n@@ -3853,6 +3849,10 @@ split_hard_reg_notes (note, first, last, orig_insn)\n \t      XEXP (link, 0) = temp;\n \t      XEXP (link, 1) = REG_NOTES (insn);\n \t      REG_NOTES (insn) = link;\n+\n+\t      /* If killed multiple registers here, then add in the excess.  */\n+\t      i += HARD_REGNO_NREGS (REGNO (temp), GET_MODE (temp)) - 1;\n+\n \t      break;\n \t    }\n \t  /* It isn't mentioned anywhere, so no new reg note is needed for\n@@ -4033,8 +4033,20 @@ update_flow_info (notes, first, last, orig_insn)\n \t      if (GET_RTX_CLASS (GET_CODE (insn)) == 'i'\n \t\t  && reg_mentioned_p (XEXP (note, 0), PATTERN (insn)))\n \t\t{\n-\t\t  XEXP (note, 1) = REG_NOTES (insn);\n-\t\t  REG_NOTES (insn) = note;\n+\t\t  /* If this note refers to a multiple word hard register, it\n+\t\t     may have been split into several smaller hard register\n+\t\t     references, so handle it specially.  */\n+\t\t  temp = XEXP (note, 0);\n+\t\t  if (REG_NOTE_KIND (note) == REG_DEAD\n+\t\t      && GET_CODE (temp) == REG\n+\t\t      && REGNO (temp) < FIRST_PSEUDO_REGISTER\n+\t\t      && HARD_REGNO_NREGS (REGNO (temp), GET_MODE (temp)) > 1)\n+\t\t    split_hard_reg_notes (note, first, last, orig_insn);\n+\t\t  else\n+\t\t    {\n+\t\t      XEXP (note, 1) = REG_NOTES (insn);\n+\t\t      REG_NOTES (insn) = note;\n+\t\t    }\n \n \t\t  /* Sometimes need to convert REG_UNUSED notes to REG_DEAD\n \t\t     notes.  */\n@@ -4061,17 +4073,6 @@ update_flow_info (notes, first, last, orig_insn)\n \t\t  break;\n \t\t}\n \t    }\n-\n-\t  /* If this note refers to a multiple word hard register, it may\n-\t     have been split into several smaller hard register references.\n-\t     Check to see if there are any new register references that\n-\t     need REG_NOTES added for them.  */\n-\t  temp = XEXP (note, 0);\n-\t  if (REG_NOTE_KIND (note) == REG_DEAD\n-\t      && GET_CODE (temp) == REG\n-\t      && REGNO (temp) < FIRST_PSEUDO_REGISTER\n-\t      && HARD_REGNO_NREGS (REGNO (temp), GET_MODE (temp)))\n-\t    split_hard_reg_notes (note, first, last, orig_insn);\n \t  break;\n \n \tcase REG_WAS_0:"}]}