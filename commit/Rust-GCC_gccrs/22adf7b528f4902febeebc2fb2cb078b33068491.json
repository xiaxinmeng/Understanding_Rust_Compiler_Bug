{"sha": "22adf7b528f4902febeebc2fb2cb078b33068491", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6MjJhZGY3YjUyOGY0OTAyZmViZWViYzJmYjJjYjA3OGIzMzA2ODQ5MQ==", "commit": {"author": {"name": "Paolo Carlini", "email": "paolo.carlini@oracle.com", "date": "2013-07-09T09:28:09Z"}, "committer": {"name": "Paolo Carlini", "email": "paolo@gcc.gnu.org", "date": "2013-07-09T09:28:09Z"}, "message": "re PR c++/51786 ([c++0x] Invalid declaration with decltype accepted)\n\n/cp\n2013-07-09  Paolo Carlini  <paolo.carlini@oracle.com>\n\n\tPR c++/51786\n\t* parser.c (cp_parser_simple_declaration): Before calling shadow_tag\n\talso check declares_class_or_enum.\n\n/testsuite\n2013-07-09  Paolo Carlini  <paolo.carlini@oracle.com>\n\n\tPR c++/51786\n\t* g++.dg/cpp0x/pr51786.C: New.\n\nFrom-SVN: r200813", "tree": {"sha": "6a081aa5b0857c7f331dc62a775e0ff7273ee0b3", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/6a081aa5b0857c7f331dc62a775e0ff7273ee0b3"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/22adf7b528f4902febeebc2fb2cb078b33068491", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/22adf7b528f4902febeebc2fb2cb078b33068491", "html_url": "https://github.com/Rust-GCC/gccrs/commit/22adf7b528f4902febeebc2fb2cb078b33068491", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/22adf7b528f4902febeebc2fb2cb078b33068491/comments", "author": null, "committer": null, "parents": [{"sha": "3830d98a8ba5f6071683e83f37becdfee359a8eb", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/3830d98a8ba5f6071683e83f37becdfee359a8eb", "html_url": "https://github.com/Rust-GCC/gccrs/commit/3830d98a8ba5f6071683e83f37becdfee359a8eb"}], "stats": {"total": 32, "additions": 30, "deletions": 2}, "files": [{"sha": "696ef35825fb6f1ad94702191e9982398f942212", "filename": "gcc/cp/ChangeLog", "status": "modified", "additions": 6, "deletions": 0, "changes": 6, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/22adf7b528f4902febeebc2fb2cb078b33068491/gcc%2Fcp%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/22adf7b528f4902febeebc2fb2cb078b33068491/gcc%2Fcp%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fcp%2FChangeLog?ref=22adf7b528f4902febeebc2fb2cb078b33068491", "patch": "@@ -1,3 +1,9 @@\n+2013-07-09  Paolo Carlini  <paolo.carlini@oracle.com>\n+\n+\tPR c++/51786\n+\t* parser.c (cp_parser_simple_declaration): Before calling shadow_tag\n+\talso check declares_class_or_enum.\n+\n 2013-07-08  Jason Merrill  <jason@redhat.com>\n \n \tPR c++/57550"}, {"sha": "e2c3c3e95e47dcba81d8e874cc4d8a3066b01784", "filename": "gcc/cp/parser.c", "status": "modified", "additions": 11, "deletions": 2, "changes": 13, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/22adf7b528f4902febeebc2fb2cb078b33068491/gcc%2Fcp%2Fparser.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/22adf7b528f4902febeebc2fb2cb078b33068491/gcc%2Fcp%2Fparser.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fcp%2Fparser.c?ref=22adf7b528f4902febeebc2fb2cb078b33068491", "patch": "@@ -11009,11 +11009,20 @@ cp_parser_simple_declaration (cp_parser* parser,\n \n   /* Issue an error message if no declarators are present, and the\n      decl-specifier-seq does not itself declare a class or\n-     enumeration.  */\n+     enumeration: [dcl.dcl]/3.  */\n   if (!saw_declarator)\n     {\n       if (cp_parser_declares_only_class_p (parser))\n-\tshadow_tag (&decl_specifiers);\n+\t{\n+\t  if (!declares_class_or_enum\n+\t      && decl_specifiers.type\n+\t      && OVERLOAD_TYPE_P (decl_specifiers.type))\n+\t    /* Ensure an error is issued anyway when finish_decltype_type,\n+\t       called via cp_parser_decl_specifier_seq, returns a class or\n+\t       an enumeration (c++/51786).  */\n+\t    decl_specifiers.type = NULL_TREE;\n+\t  shadow_tag (&decl_specifiers);\n+\t}\n       /* Perform any deferred access checks.  */\n       perform_deferred_access_checks (tf_warning_or_error);\n     }"}, {"sha": "e73706aee795fe8a496dc16a9194646ed372aa79", "filename": "gcc/testsuite/ChangeLog", "status": "modified", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/22adf7b528f4902febeebc2fb2cb078b33068491/gcc%2Ftestsuite%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/22adf7b528f4902febeebc2fb2cb078b33068491/gcc%2Ftestsuite%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2FChangeLog?ref=22adf7b528f4902febeebc2fb2cb078b33068491", "patch": "@@ -1,3 +1,8 @@\n+2013-07-09  Paolo Carlini  <paolo.carlini@oracle.com>\n+\n+\tPR c++/51786\n+\t* g++.dg/cpp0x/pr51786.C: New.\n+\n 2013-07-08  Janis Johnson  <janisjo@codesourcery.com>\n \n \t* gcc.target/powerpc/tfmode_off.c: Skip for EABI targets."}, {"sha": "69b7441588feedbb7d54e031be7c11b7161582c9", "filename": "gcc/testsuite/g++.dg/cpp0x/pr51786.C", "status": "added", "additions": 8, "deletions": 0, "changes": 8, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/22adf7b528f4902febeebc2fb2cb078b33068491/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Fcpp0x%2Fpr51786.C", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/22adf7b528f4902febeebc2fb2cb078b33068491/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Fcpp0x%2Fpr51786.C", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Fcpp0x%2Fpr51786.C?ref=22adf7b528f4902febeebc2fb2cb078b33068491", "patch": "@@ -0,0 +1,8 @@\n+// PR c++/51786\n+// { dg-do compile { target c++11 } }\n+\n+enum E {};\n+struct A {};\n+\n+void foo() { decltype(E{}); }  // { dg-error \"does not declare anything\" }\n+void bar() { decltype(A{}); }  // { dg-error \"does not declare anything\" }"}]}