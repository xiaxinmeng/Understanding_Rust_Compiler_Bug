{"sha": "3b778d9d1268ec838c22fca98cd4dd351feb5914", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6M2I3NzhkOWQxMjY4ZWM4MzhjMjJmY2E5OGNkNGRkMzUxZmViNTkxNA==", "commit": {"author": {"name": "Alexandre Oliva", "email": "aoliva@redhat.com", "date": "2017-12-13T18:46:43Z"}, "committer": {"name": "Jakub Jelinek", "email": "jakub@gcc.gnu.org", "date": "2017-12-13T18:46:43Z"}, "message": "re PR bootstrap/83396 (Bootstrap failures with Statement Frontiers)\n\n\tPR bootstrap/83396\n\tPR debug/83391\n\t* tree-cfgcleanup.c (remove_forwarder_block): Keep after\n\tlabels debug stmts that can only appear after labels.\n\n\t* gcc.dg/torture/pr83396.c: New test.\n\t* g++.dg/torture/pr83391.C: New test.\n\nCo-Authored-By: Jakub Jelinek <jakub@redhat.com>\n\nFrom-SVN: r255609", "tree": {"sha": "d1117d1721f7642823be5e5f70d6903e9de82aea", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/d1117d1721f7642823be5e5f70d6903e9de82aea"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/3b778d9d1268ec838c22fca98cd4dd351feb5914", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/3b778d9d1268ec838c22fca98cd4dd351feb5914", "html_url": "https://github.com/Rust-GCC/gccrs/commit/3b778d9d1268ec838c22fca98cd4dd351feb5914", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/3b778d9d1268ec838c22fca98cd4dd351feb5914/comments", "author": null, "committer": null, "parents": [{"sha": "3ca652c1995cd691850a53c656c958a83c3fecde", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/3ca652c1995cd691850a53c656c958a83c3fecde", "html_url": "https://github.com/Rust-GCC/gccrs/commit/3ca652c1995cd691850a53c656c958a83c3fecde"}], "stats": {"total": 114, "additions": 112, "deletions": 2}, "files": [{"sha": "a72b4bcfef8d044e62bcd54dcb66cc446e667b52", "filename": "gcc/ChangeLog", "status": "modified", "additions": 8, "deletions": 0, "changes": 8, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/3b778d9d1268ec838c22fca98cd4dd351feb5914/gcc%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/3b778d9d1268ec838c22fca98cd4dd351feb5914/gcc%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2FChangeLog?ref=3b778d9d1268ec838c22fca98cd4dd351feb5914", "patch": "@@ -1,3 +1,11 @@\n+2017-12-13  Alexandre Oliva <aoliva@redhat.com>\n+\t    Jakub Jelinek  <jakub@redhat.com>\n+\n+\tPR bootstrap/83396\n+\tPR debug/83391\n+\t* tree-cfgcleanup.c (remove_forwarder_block): Keep after\n+\tlabels debug stmts that can only appear after labels.\n+\n 2017-12-13  Alexander Monakov  <amonakov@ispras.ru>\n \n \tPR rtl-optimization/82398"}, {"sha": "4af0d0c4d69868e6f667425ca1d58a9f2257c9b8", "filename": "gcc/testsuite/ChangeLog", "status": "modified", "additions": 8, "deletions": 0, "changes": 8, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/3b778d9d1268ec838c22fca98cd4dd351feb5914/gcc%2Ftestsuite%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/3b778d9d1268ec838c22fca98cd4dd351feb5914/gcc%2Ftestsuite%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2FChangeLog?ref=3b778d9d1268ec838c22fca98cd4dd351feb5914", "patch": "@@ -1,3 +1,11 @@\n+2017-12-13  Alexandre Oliva <aoliva@redhat.com>\n+\t    Jakub Jelinek  <jakub@redhat.com>\n+\n+\tPR bootstrap/83396\n+\tPR debug/83391\n+\t* gcc.dg/torture/pr83396.c: New test.\n+\t* g++.dg/torture/pr83391.C: New test.\n+\n 2017-12-13  Segher Boessenkool  <segher@kernel.crashing.org>\n \n \tPR rtl-optimization/83393"}, {"sha": "902d7fbcb74026d7cd9f5e11f333d54df9c5da4e", "filename": "gcc/testsuite/g++.dg/torture/pr83391.C", "status": "added", "additions": 36, "deletions": 0, "changes": 36, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/3b778d9d1268ec838c22fca98cd4dd351feb5914/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Ftorture%2Fpr83391.C", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/3b778d9d1268ec838c22fca98cd4dd351feb5914/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Ftorture%2Fpr83391.C", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Ftorture%2Fpr83391.C?ref=3b778d9d1268ec838c22fca98cd4dd351feb5914", "patch": "@@ -0,0 +1,36 @@\n+// PR debug/83391\n+// { dg-do compile }\n+// { dg-options \"-g\" }\n+// { dg-additional-options \"-mbranch-cost=1\" { target { i?86-*-* x86_64-*-* mips*-*-* s390*-*-* avr*-*-* } } }\n+\n+unsigned char a;\n+enum E { F, G, H } b;\n+int c, d;\n+\n+void\n+foo ()\n+{\n+  int e;\n+  bool f;\n+  E g = b;\n+  while (1)\n+    {\n+      unsigned char h = a ? d : 0;\n+      switch (g)\n+\t{\n+\tcase 0:\n+\t  f = h <= 'Z' || h >= 'a' && h <= 'z';\n+\t  break;\n+\tcase 1:\n+\t  {\n+\t    unsigned char i = h;\n+\t    e = 0;\n+\t  }\n+\t  if (e || h)\n+\t    g = H;\n+\t  /* FALLTHRU */\n+\tdefault:\n+\t  c = 0;\n+\t}\n+    }\n+}"}, {"sha": "24c1d5de98002c55db7a7a8f4358f13eb630e6c9", "filename": "gcc/testsuite/gcc.dg/torture/pr83396.c", "status": "added", "additions": 38, "deletions": 0, "changes": 38, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/3b778d9d1268ec838c22fca98cd4dd351feb5914/gcc%2Ftestsuite%2Fgcc.dg%2Ftorture%2Fpr83396.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/3b778d9d1268ec838c22fca98cd4dd351feb5914/gcc%2Ftestsuite%2Fgcc.dg%2Ftorture%2Fpr83396.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgcc.dg%2Ftorture%2Fpr83396.c?ref=3b778d9d1268ec838c22fca98cd4dd351feb5914", "patch": "@@ -0,0 +1,38 @@\n+/* PR bootstrap/83396 */\n+/* { dg-do compile } */\n+/* { dg-options \"-g\" } */\n+\n+int fn1 (void);\n+void fn2 (void *, const char *);\n+void fn3 (void);\n+\n+void\n+fn4 (long long x)\n+{\n+  fn3 ();\n+}\n+\n+void\n+fn5 (long long x)\n+{\n+  if (x)\n+    fn3();\n+}\n+\n+void\n+fn6 (long long x)\n+{\n+  switch (fn1 ())\n+    {\n+    case 0:\n+      fn5 (x);\n+    case 2:\n+      fn2 (0, \"\");\n+      break;\n+    case 1:\n+    case 3:\n+      fn4(x);\n+    case 5:\n+      fn2 (0, \"\");\n+    }\n+}"}, {"sha": "a0e5797ec0ecb8b413b8aad19ffc4149e87676a4", "filename": "gcc/tree-cfgcleanup.c", "status": "modified", "additions": 22, "deletions": 2, "changes": 24, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/3b778d9d1268ec838c22fca98cd4dd351feb5914/gcc%2Ftree-cfgcleanup.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/3b778d9d1268ec838c22fca98cd4dd351feb5914/gcc%2Ftree-cfgcleanup.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftree-cfgcleanup.c?ref=3b778d9d1268ec838c22fca98cd4dd351feb5914", "patch": "@@ -536,9 +536,14 @@ remove_forwarder_block (basic_block bb)\n      defined labels and labels with an EH landing pad number to the\n      new block, so that the redirection of the abnormal edges works,\n      jump targets end up in a sane place and debug information for\n-     labels is retained.  */\n+     labels is retained.\n+\n+     While at that, move any debug stmts that appear before or in between\n+     labels, but not those that can only appear after labels.  */\n   gsi_to = gsi_start_bb (dest);\n-  for (gsi = gsi_start_bb (bb); !gsi_end_p (gsi); )\n+  gsi = gsi_start_bb (bb);\n+  gimple_stmt_iterator gsie = gsi_after_labels (bb);\n+  while (gsi_stmt (gsi) != gsi_stmt (gsie))\n     {\n       tree decl;\n       label = gsi_stmt (gsi);\n@@ -557,6 +562,21 @@ remove_forwarder_block (basic_block bb)\n \tgsi_next (&gsi);\n     }\n \n+  /* Move debug statements if the destination has a single predecessor.  */\n+  if (can_move_debug_stmts && !gsi_end_p (gsi))\n+    {\n+      gcc_assert (gsi_stmt (gsi) == gsi_stmt (gsie));\n+      gimple_stmt_iterator gsie_to = gsi_after_labels (dest);\n+      do\n+\t{\n+\t  gimple *debug = gsi_stmt (gsi);\n+\t  gcc_assert (is_gimple_debug (debug));\n+\t  gsi_remove (&gsi, false);\n+\t  gsi_insert_before (&gsie_to, debug, GSI_SAME_STMT);\n+\t}\n+      while (!gsi_end_p (gsi));\n+    }\n+\n   bitmap_set_bit (cfgcleanup_altered_bbs, dest->index);\n \n   /* Update the dominators.  */"}]}