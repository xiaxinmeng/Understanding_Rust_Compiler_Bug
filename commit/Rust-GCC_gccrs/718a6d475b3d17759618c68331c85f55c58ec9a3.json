{"sha": "718a6d475b3d17759618c68331c85f55c58ec9a3", "node_id": "C_kwDOANBUbNoAKDcxOGE2ZDQ3NWIzZDE3NzU5NjE4YzY4MzMxYzg1ZjU1YzU4ZWM5YTM", "commit": {"author": {"name": "Patrick Palka", "email": "ppalka@redhat.com", "date": "2022-09-09T18:56:32Z"}, "committer": {"name": "Patrick Palka", "email": "ppalka@redhat.com", "date": "2022-09-09T18:56:32Z"}, "message": "libstdc++: Fix zip_view's operator- for integer-class difference type [PR106766]\n\nThe difference type of an underlying iterator could be an integer-class\ntype, which make_unsigned_t doesn't handle, so we need to use the more\ngeneral __make_unsigned_like_t / __to_unsigned_like here instead.\n\n\tPR libstdc++/106766\n\nlibstdc++-v3/ChangeLog:\n\n\t* include/std/ranges (zip_view::_Iterator::operator-): Use\n\t__to_unsigned_like instead of make_unsigned_t.\n\t(zip_view::_Sentinel::operator-): Likewise.\n\t* testsuite/std/ranges/zip/1.cc (test04): New test.", "tree": {"sha": "47bc41e6852c0c2d2920bad705819c4aa4e9b6ca", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/47bc41e6852c0c2d2920bad705819c4aa4e9b6ca"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/718a6d475b3d17759618c68331c85f55c58ec9a3", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/718a6d475b3d17759618c68331c85f55c58ec9a3", "html_url": "https://github.com/Rust-GCC/gccrs/commit/718a6d475b3d17759618c68331c85f55c58ec9a3", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/718a6d475b3d17759618c68331c85f55c58ec9a3/comments", "author": null, "committer": null, "parents": [{"sha": "50be486dff4ea2676ed022e9524ef190b92ae2b1", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/50be486dff4ea2676ed022e9524ef190b92ae2b1", "html_url": "https://github.com/Rust-GCC/gccrs/commit/50be486dff4ea2676ed022e9524ef190b92ae2b1"}], "stats": {"total": 26, "additions": 22, "deletions": 4}, "files": [{"sha": "2b8fec3c386d3b9867ca37b862981437537a76f1", "filename": "libstdc++-v3/include/std/ranges", "status": "modified", "additions": 4, "deletions": 4, "changes": 8, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/718a6d475b3d17759618c68331c85f55c58ec9a3/libstdc%2B%2B-v3%2Finclude%2Fstd%2Franges", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/718a6d475b3d17759618c68331c85f55c58ec9a3/libstdc%2B%2B-v3%2Finclude%2Fstd%2Franges", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libstdc%2B%2B-v3%2Finclude%2Fstd%2Franges?ref=718a6d475b3d17759618c68331c85f55c58ec9a3", "patch": "@@ -4657,8 +4657,8 @@ namespace views::__adaptor\n \treturn ranges::min({difference_type(std::get<_Is>(__x._M_current)\n \t\t\t\t\t    - std::get<_Is>(__y._M_current))...},\n \t\t\t   ranges::less{},\n-\t\t\t   [](difference_type __i) -> make_unsigned_t<difference_type> {\n-\t\t\t     return __i < 0 ? -__i : __i;\n+\t\t\t   [](difference_type __i) {\n+\t\t\t     return __detail::__to_unsigned_like(__i < 0 ? -__i : __i);\n \t\t\t   });\n       }(make_index_sequence<sizeof...(_Vs)>{});\n     }\n@@ -4726,8 +4726,8 @@ namespace views::__adaptor\n       return [&]<size_t... _Is>(index_sequence<_Is...>) {\n \treturn ranges::min({_Ret(std::get<_Is>(__x._M_current) - std::get<_Is>(__y._M_end))...},\n \t\t\t   ranges::less{},\n-\t\t\t   [](_Ret __i) -> make_unsigned_t<_Ret> {\n-\t\t\t     return __i < 0 ? -__i : __i;\n+\t\t\t   [](_Ret __i) {\n+\t\t\t     return __detail::__to_unsigned_like(__i < 0 ? -__i : __i);\n \t\t\t   });\n       }(make_index_sequence<sizeof...(_Vs)>{});\n     }"}, {"sha": "e9e40fb15eb7af850cdba526b2829bf7ad43f7d9", "filename": "libstdc++-v3/testsuite/std/ranges/zip/1.cc", "status": "modified", "additions": 18, "deletions": 0, "changes": 18, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/718a6d475b3d17759618c68331c85f55c58ec9a3/libstdc%2B%2B-v3%2Ftestsuite%2Fstd%2Franges%2Fzip%2F1.cc", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/718a6d475b3d17759618c68331c85f55c58ec9a3/libstdc%2B%2B-v3%2Ftestsuite%2Fstd%2Franges%2Fzip%2F1.cc", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libstdc%2B%2B-v3%2Ftestsuite%2Fstd%2Franges%2Fzip%2F1.cc?ref=718a6d475b3d17759618c68331c85f55c58ec9a3", "patch": "@@ -102,10 +102,28 @@ test03()\n   return true;\n }\n \n+constexpr bool\n+test04()\n+{\n+  // PR libstdc++/106766\n+#if __SIZEOF_INT128__\n+  auto r = views::zip(views::iota(__int128(0), __int128(1)));\n+#else\n+  auto r = views::zip(views::iota(0ll, 1ll));\n+#endif\n+  auto i = r.begin();\n+  auto s = r.end();\n+  VERIFY( s - i == 1 );\n+  VERIFY( i + 1 - i == 1 );\n+\n+  return true;\n+}\n+\n int\n main()\n {\n   static_assert(test01());\n   static_assert(test02());\n   static_assert(test03());\n+  static_assert(test04());\n }"}]}