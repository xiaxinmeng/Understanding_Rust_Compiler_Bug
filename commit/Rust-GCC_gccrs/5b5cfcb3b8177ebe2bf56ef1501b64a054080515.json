{"sha": "5b5cfcb3b8177ebe2bf56ef1501b64a054080515", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6NWI1Y2ZjYjNiODE3N2ViZTJiZjU2ZWYxNTAxYjY0YTA1NDA4MDUxNQ==", "commit": {"author": {"name": "Mike Stump", "email": "mikestump@comcast.net", "date": "2010-03-23T20:02:57Z"}, "committer": {"name": "Mike Stump", "email": "mrs@gcc.gnu.org", "date": "2010-03-23T20:02:57Z"}, "message": "re PR target/33120 (Data not put in BSS section on Mac OS)\n\n\tPR target/33120\n\t* config/darwin.h (ASM_OUTPUT_ALIGNED_BSS): Add.\n\t* config/darwin.c (darwin_output_aligned_bss): Add.\n\t* config/darwin-protos.h: Add darwin_output_aligned_bss.\n\ntestsuite:\n\t* g++.dg/ext/instantiate2.C: Update for .zerofill as it doesn't\n\tfollow the usual conventions for symbol definitions.\n\t* gcc.target/i386/darwin-zerofill.c: Add.\n\nFrom-SVN: r157677", "tree": {"sha": "7820d324d67e845b78023c85751c65923ae591a0", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/7820d324d67e845b78023c85751c65923ae591a0"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/5b5cfcb3b8177ebe2bf56ef1501b64a054080515", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/5b5cfcb3b8177ebe2bf56ef1501b64a054080515", "html_url": "https://github.com/Rust-GCC/gccrs/commit/5b5cfcb3b8177ebe2bf56ef1501b64a054080515", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/5b5cfcb3b8177ebe2bf56ef1501b64a054080515/comments", "author": null, "committer": null, "parents": [{"sha": "478ab26dedbe5102e90724ea51fde59764949c92", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/478ab26dedbe5102e90724ea51fde59764949c92", "html_url": "https://github.com/Rust-GCC/gccrs/commit/478ab26dedbe5102e90724ea51fde59764949c92"}], "stats": {"total": 68, "additions": 67, "deletions": 1}, "files": [{"sha": "0d5f1a568a2a38016a393208cbf265fe6a16a74e", "filename": "gcc/ChangeLog", "status": "modified", "additions": 7, "deletions": 0, "changes": 7, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/5b5cfcb3b8177ebe2bf56ef1501b64a054080515/gcc%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/5b5cfcb3b8177ebe2bf56ef1501b64a054080515/gcc%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2FChangeLog?ref=5b5cfcb3b8177ebe2bf56ef1501b64a054080515", "patch": "@@ -1,3 +1,10 @@\n+2010-03-23  Mike Stump  <mikestump@comcast.net>\n+\n+\tPR target/33120\n+\t* config/darwin.h (ASM_OUTPUT_ALIGNED_BSS): Add.\n+\t* config/darwin.c (darwin_output_aligned_bss): Add.\n+\t* config/darwin-protos.h: Add darwin_output_aligned_bss.\n+\n 2010-03-23  Vladimir Makarov  <vmakarov@redhat.com>\n \n \tPR rtl-optimization/43413"}, {"sha": "5675044df7a19fb9c7870083f960be4b2e67887d", "filename": "gcc/config/darwin-protos.h", "status": "modified", "additions": 3, "deletions": 0, "changes": 3, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/5b5cfcb3b8177ebe2bf56ef1501b64a054080515/gcc%2Fconfig%2Fdarwin-protos.h", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/5b5cfcb3b8177ebe2bf56ef1501b64a054080515/gcc%2Fconfig%2Fdarwin-protos.h", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fconfig%2Fdarwin-protos.h?ref=5b5cfcb3b8177ebe2bf56ef1501b64a054080515", "patch": "@@ -90,3 +90,6 @@ extern void darwin_asm_output_anchor (rtx symbol);\n extern bool darwin_kextabi_p (void);\n extern void darwin_override_options (void);\n extern void darwin_patch_builtins (void);\n+extern void darwin_output_aligned_bss (FILE *, tree, const char *,\n+\t\t\t\t       unsigned HOST_WIDE_INT size,\n+\t\t\t\t       unsigned int align);"}, {"sha": "da12c057ca9abf8160e5177e1a495fde83fb51df", "filename": "gcc/config/darwin.c", "status": "modified", "additions": 36, "deletions": 0, "changes": 36, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/5b5cfcb3b8177ebe2bf56ef1501b64a054080515/gcc%2Fconfig%2Fdarwin.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/5b5cfcb3b8177ebe2bf56ef1501b64a054080515/gcc%2Fconfig%2Fdarwin.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fconfig%2Fdarwin.c?ref=5b5cfcb3b8177ebe2bf56ef1501b64a054080515", "patch": "@@ -1788,5 +1788,41 @@ darwin_patch_builtins (void)\n #undef PATCH_BUILTIN_VARIADIC\n }\n \n+void\n+darwin_output_aligned_bss(FILE *fp, tree decl, const char *name,\n+\t\t\t  unsigned HOST_WIDE_INT size, unsigned int align)\n+{\n+  bool weak = (DECL_P (decl)\n+\t       && DECL_WEAK (decl)\n+\t       && !lookup_attribute (\"weak_import\",\n+\t\t\t\t     DECL_ATTRIBUTES (decl)));\n+  if (size == 0)\n+    size = 1;\n+  align = floor_log2 (align / BITS_PER_UNIT);\n+  if (DECL_ONE_ONLY (decl) || weak) {\n+    if (TREE_READONLY (decl) || TREE_CONSTANT (decl))\n+      switch_to_section (darwin_sections[const_data_coal_section]);\n+    else\n+      switch_to_section (darwin_sections[data_coal_section]);\n+    ASM_OUTPUT_ALIGN (fp, align);\n+    ASM_DECLARE_OBJECT_NAME (fp, name, decl);\n+    ASM_OUTPUT_SKIP (fp, size);\n+    return;\n+  }\n+\n+  fputs (\".zerofill \", fp);\n+  /* We uniquely name sections based upon the alignment as otherwise\n+     all symbols in the section would get that alignment.  */\n+  if (TREE_READONLY (decl) || TREE_CONSTANT (decl))\n+    fputs (\"__TEXT, \", fp);\n+  else\n+    fputs (\"__DATA, \", fp);\n+  fprintf (fp, \"__bss%d, \", align);\n+  assemble_name (fp, name);\n+  fprintf (fp, \", \"HOST_WIDE_INT_PRINT_UNSIGNED\", %u\\n\",\n+\t   size, align);\n+  (* targetm.encode_section_info) (decl, DECL_RTL (decl), false);\n+  machopic_define_symbol (DECL_RTL (decl));\n+}\n \n #include \"gt-darwin.h\""}, {"sha": "ca32669353b1c76bf0946bfff4c839cea5a926ac", "filename": "gcc/config/darwin.h", "status": "modified", "additions": 3, "deletions": 0, "changes": 3, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/5b5cfcb3b8177ebe2bf56ef1501b64a054080515/gcc%2Fconfig%2Fdarwin.h", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/5b5cfcb3b8177ebe2bf56ef1501b64a054080515/gcc%2Fconfig%2Fdarwin.h", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fconfig%2Fdarwin.h?ref=5b5cfcb3b8177ebe2bf56ef1501b64a054080515", "patch": "@@ -728,6 +728,9 @@ int darwin_label_is_anonymous_local_objc_name (const char *name);\n       }\t\t\t\t\t\t\t\t\t\\\n   } while (0)\n \n+#define ASM_OUTPUT_ALIGNED_BSS(FILE, DECL, NAME, SIZE, ALIGN)\t\t\\\n+  darwin_output_aligned_bss(FILE, DECL, NAME, SIZE, ALIGN)\n+\n /* The maximum alignment which the object file format can support in\n    bits.  For Mach-O, this is 2^15 bytes.  */\n "}, {"sha": "4dd6d086ed6086a377dadabd4b2799bab87a44fb", "filename": "gcc/testsuite/ChangeLog", "status": "modified", "additions": 7, "deletions": 0, "changes": 7, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/5b5cfcb3b8177ebe2bf56ef1501b64a054080515/gcc%2Ftestsuite%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/5b5cfcb3b8177ebe2bf56ef1501b64a054080515/gcc%2Ftestsuite%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2FChangeLog?ref=5b5cfcb3b8177ebe2bf56ef1501b64a054080515", "patch": "@@ -1,3 +1,10 @@\n+2010-03-23  Mike Stump  <mikestump@comcast.net>\n+\n+\tPR target/33120\n+\t* g++.dg/ext/instantiate2.C: Update for .zerofill as it doesn't\n+\tfollow the usual conventions for symbol definitions.\n+\t* gcc.target/i386/darwin-zerofill.c: Add.\n+\n 2010-03-22  Jason Merrill  <jason@redhat.com>\n \n \tPR c++/43333"}, {"sha": "02a54fee1c675ea3e7b2b953402da8f2c2516f7e", "filename": "gcc/testsuite/g++.dg/ext/instantiate2.C", "status": "modified", "additions": 2, "deletions": 1, "changes": 3, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/5b5cfcb3b8177ebe2bf56ef1501b64a054080515/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Fext%2Finstantiate2.C", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/5b5cfcb3b8177ebe2bf56ef1501b64a054080515/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Fext%2Finstantiate2.C", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Fext%2Finstantiate2.C?ref=5b5cfcb3b8177ebe2bf56ef1501b64a054080515", "patch": "@@ -8,7 +8,8 @@ template <class T> struct A {\n template <class T> T A<T>::t = 0;\n static template struct A<int>;\n \n-// { dg-final { scan-assembler \"\\n_?_ZN1AIiE1tE(:|\\n|\\t)\" } }\n+// { dg-final { scan-assembler \"\\n_?_ZN1AIiE1tE(:|\\n|\\t)\" { target { ! *-apple-darwin* } } } }\n+// { dg-final { scan-assembler \".zerofill __DATA, __bss2, __ZN1AIiE1tE\" { target *-apple-darwin* } } }\n void test_int() { A<int>::t = 42; }\n \n // { dg-final { scan-assembler-not \"\\n_?_ZN1AIcE1tE(:|\\n|\\t)\" } }"}, {"sha": "73221347a9c5e4d80671d6ab37f36fb0f3750ec5", "filename": "gcc/testsuite/gcc.target/i386/darwin-zerofill.c", "status": "added", "additions": 9, "deletions": 0, "changes": 9, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/5b5cfcb3b8177ebe2bf56ef1501b64a054080515/gcc%2Ftestsuite%2Fgcc.target%2Fi386%2Fdarwin-zerofill.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/5b5cfcb3b8177ebe2bf56ef1501b64a054080515/gcc%2Ftestsuite%2Fgcc.target%2Fi386%2Fdarwin-zerofill.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgcc.target%2Fi386%2Fdarwin-zerofill.c?ref=5b5cfcb3b8177ebe2bf56ef1501b64a054080515", "patch": "@@ -0,0 +1,9 @@\n+/* { dg-do compile { target i?86-apple-darwin* x86_64-apple-darwin* } } */\n+/* { dg-options \"-fno-common\" } */\n+\n+/* { dg-final { scan-assembler \".zerofill __DATA, __bss11, _ji, 4000000, 11\" } } */\n+/* { dg-final { scan-assembler \".zerofill __TEXT, __bss8, _cj, 4000000, 8\" } } */\n+/* PR33120 */\n+\n+int ji[1000000] __attribute((aligned(2048)));\n+const int cj[1000000] __attribute((aligned(256)));"}]}