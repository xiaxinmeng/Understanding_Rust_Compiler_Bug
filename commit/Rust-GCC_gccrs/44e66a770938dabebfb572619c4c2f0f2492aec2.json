{"sha": "44e66a770938dabebfb572619c4c2f0f2492aec2", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6NDRlNjZhNzcwOTM4ZGFiZWJmYjU3MjYxOWM0YzJmMGYyNDkyYWVjMg==", "commit": {"author": {"name": "Jerry DeLisle", "email": "jvdelisle@gcc.gnu.org", "date": "2016-03-13T17:38:07Z"}, "committer": {"name": "Jerry DeLisle", "email": "jvdelisle@gcc.gnu.org", "date": "2016-03-13T17:38:07Z"}, "message": "re PR fortran/69043 (Trying to include a directory causes an infinite loop)\n\n2016-03-13  Jerry DeLisle  <jvdelisle@gcc.gnu.org>\n\t    Jim MacArthur  <jim.macarthur@codethink.co.uk>\n\n\tPR fortran/69043\n\t* scanner.c (load_file): Check that included file is regular.\n\n\tPR fortran/69043\n\t* gfortran.dg/include_9.f90: New test.\n\nCo-Authored-By: Jim MacArthur <jim.macarthur@codethink.co.uk>\n\nFrom-SVN: r234169", "tree": {"sha": "7880c8ac436cbf2e236c6f8336abc9f0d89b53eb", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/7880c8ac436cbf2e236c6f8336abc9f0d89b53eb"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/44e66a770938dabebfb572619c4c2f0f2492aec2", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/44e66a770938dabebfb572619c4c2f0f2492aec2", "html_url": "https://github.com/Rust-GCC/gccrs/commit/44e66a770938dabebfb572619c4c2f0f2492aec2", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/44e66a770938dabebfb572619c4c2f0f2492aec2/comments", "author": null, "committer": null, "parents": [{"sha": "a18e0fe1e4f3788fbc6ca10d8c7671885ed9baea", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/a18e0fe1e4f3788fbc6ca10d8c7671885ed9baea", "html_url": "https://github.com/Rust-GCC/gccrs/commit/a18e0fe1e4f3788fbc6ca10d8c7671885ed9baea"}], "stats": {"total": 29, "additions": 29, "deletions": 0}, "files": [{"sha": "9ed112ec63163ff71700f08bc1f277768977070e", "filename": "gcc/fortran/ChangeLog", "status": "modified", "additions": 6, "deletions": 0, "changes": 6, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/44e66a770938dabebfb572619c4c2f0f2492aec2/gcc%2Ffortran%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/44e66a770938dabebfb572619c4c2f0f2492aec2/gcc%2Ffortran%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ffortran%2FChangeLog?ref=44e66a770938dabebfb572619c4c2f0f2492aec2", "patch": "@@ -1,3 +1,9 @@\n+2016-03-13  Jerry DeLisle  <jvdelisle@gcc.gnu.org>\n+\t    Jim MacArthur  <jim.macarthur@codethink.co.uk>\n+\n+\tPR fortran/69043\n+\t* scanner.c (load_file): Check that included file is regular.\n+\n 2016-03-12  Jerry DeLisle  <jvdelisle@gcc.gnu.org>\n \t    Harold Anlauf  <anlauf@gmx.de>\n "}, {"sha": "33d96d88d922ca5b06f67cb0f5b8841efcc27ccd", "filename": "gcc/fortran/scanner.c", "status": "modified", "additions": 12, "deletions": 0, "changes": 12, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/44e66a770938dabebfb572619c4c2f0f2492aec2/gcc%2Ffortran%2Fscanner.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/44e66a770938dabebfb572619c4c2f0f2492aec2/gcc%2Ffortran%2Fscanner.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ffortran%2Fscanner.c?ref=44e66a770938dabebfb572619c4c2f0f2492aec2", "patch": "@@ -2200,6 +2200,8 @@ load_file (const char *realfilename, const char *displayedname, bool initial)\n   FILE *input;\n   int len, line_len;\n   bool first_line;\n+  struct stat st;\n+  int stat_result;\n   const char *filename;\n   /* If realfilename and displayedname are different and non-null then\n      surely realfilename is the preprocessed form of\n@@ -2227,6 +2229,7 @@ load_file (const char *realfilename, const char *displayedname, bool initial)\n \t}\n       else\n \tinput = gfc_open_file (realfilename);\n+\n       if (input == NULL)\n \t{\n \t  gfc_error_now (\"Can't open file %qs\", filename);\n@@ -2242,6 +2245,15 @@ load_file (const char *realfilename, const char *displayedname, bool initial)\n \t\t   current_file->filename, current_file->line, filename);\n \t  return false;\n \t}\n+      stat_result = stat (realfilename, &st);\n+      if (stat_result == 0 && !(st.st_mode & S_IFREG))\n+\t{\n+\t  fprintf (stderr, \"%s:%d: Error: Included path '%s'\"\n+\t\t   \" is not a regular file\\n\",\n+\t\t   current_file->filename, current_file->line, filename);\n+\t  fclose (input);\n+\t  return false;\n+\t}\n     }\n \n   /* Load the file."}, {"sha": "78e3ec9e27280310af1fd245ad25680788631e57", "filename": "gcc/testsuite/ChangeLog", "status": "modified", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/44e66a770938dabebfb572619c4c2f0f2492aec2/gcc%2Ftestsuite%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/44e66a770938dabebfb572619c4c2f0f2492aec2/gcc%2Ftestsuite%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2FChangeLog?ref=44e66a770938dabebfb572619c4c2f0f2492aec2", "patch": "@@ -1,3 +1,8 @@\n+2016-03-13  Jerry DeLisle  <jvdelisle@gcc.gnu.org>\n+\n+\tPR fortran/69043\n+\t* gfortran.dg/include_9.f90: New test.\n+\n 2016-03-13  Dominique d'Humieres  <dominiq@lps.ens.fr>\n \n \tPR fortran/45076"}, {"sha": "c4ef50f6e504d348eac1c2bfe6420a51c90376a4", "filename": "gcc/testsuite/gfortran.dg/include_9.f90", "status": "added", "additions": 6, "deletions": 0, "changes": 6, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/44e66a770938dabebfb572619c4c2f0f2492aec2/gcc%2Ftestsuite%2Fgfortran.dg%2Finclude_9.f90", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/44e66a770938dabebfb572619c4c2f0f2492aec2/gcc%2Ftestsuite%2Fgfortran.dg%2Finclude_9.f90", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgfortran.dg%2Finclude_9.f90?ref=44e66a770938dabebfb572619c4c2f0f2492aec2", "patch": "@@ -0,0 +1,6 @@\n+! { dg-do compile }\n+! PR69043 Trying to include a directory causes an infinite loop\n+      include '.'\n+      program main\n+      end program\n+! { dg-error \"is not a regular file\" \" \" { target *-*-* } 3 }"}]}