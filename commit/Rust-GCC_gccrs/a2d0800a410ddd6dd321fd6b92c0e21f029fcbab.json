{"sha": "a2d0800a410ddd6dd321fd6b92c0e21f029fcbab", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6YTJkMDgwMGE0MTBkZGQ2ZGQzMjFmZDZiOTJjMGUyMWYwMjlmY2JhYg==", "commit": {"author": {"name": "Thomas Koenig", "email": "tkoenig@gcc.gnu.org", "date": "2013-04-08T19:36:43Z"}, "committer": {"name": "Thomas Koenig", "email": "tkoenig@gcc.gnu.org", "date": "2013-04-08T19:36:43Z"}, "message": "re PR fortran/56872 (Incorrect SUM evaluation, involving implied-do loop, with -ffrontend-optimize)\n\n2013-04-08  Thomas Koenig  <tkoenig@gcc.gnu.org>\n\n\tPR fortran/56782\n\t* frontend-passes.c (callback_reduction):  Dont't do\n\tany simplification if there is only a single element\n\twhich has an iterator.\n\n2013-04-08  Thomas Koenig  <tkoenig@gcc.gnu.org>\n\n\tPR fortran/56782\n\t* gfortran.dg/array_constructor_44.f90:  New test.\n\nFrom-SVN: r197610", "tree": {"sha": "215bf2c76484ac343ef397d3ddb0d5780a8a0b55", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/215bf2c76484ac343ef397d3ddb0d5780a8a0b55"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/a2d0800a410ddd6dd321fd6b92c0e21f029fcbab", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/a2d0800a410ddd6dd321fd6b92c0e21f029fcbab", "html_url": "https://github.com/Rust-GCC/gccrs/commit/a2d0800a410ddd6dd321fd6b92c0e21f029fcbab", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/a2d0800a410ddd6dd321fd6b92c0e21f029fcbab/comments", "author": null, "committer": null, "parents": [{"sha": "0c3f68a025fc9d41a615854c21c6f2363739c066", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/0c3f68a025fc9d41a615854c21c6f2363739c066", "html_url": "https://github.com/Rust-GCC/gccrs/commit/0c3f68a025fc9d41a615854c21c6f2363739c066"}], "stats": {"total": 31, "additions": 30, "deletions": 1}, "files": [{"sha": "538ce473bc6ef8a268d26c883205913c355e778b", "filename": "gcc/fortran/ChangeLog", "status": "modified", "additions": 7, "deletions": 0, "changes": 7, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/a2d0800a410ddd6dd321fd6b92c0e21f029fcbab/gcc%2Ffortran%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/a2d0800a410ddd6dd321fd6b92c0e21f029fcbab/gcc%2Ffortran%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ffortran%2FChangeLog?ref=a2d0800a410ddd6dd321fd6b92c0e21f029fcbab", "patch": "@@ -1,3 +1,10 @@\n+2013-04-08  Thomas Koenig  <tkoenig@gcc.gnu.org>\n+\n+\tPR fortran/56782\n+\t* frontend-passes.c (callback_reduction):  Dont't do\n+\tany simplification if there is only a single element\n+\twhich has an iterator.\n+\n 2013-04-07  Tobias Burnus  <burnus@net-b.de>\n \n \tPR fortran/56849"}, {"sha": "b2d01169e3bdf3405238b47733fc7552b0ab66b6", "filename": "gcc/fortran/frontend-passes.c", "status": "modified", "additions": 6, "deletions": 1, "changes": 7, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/a2d0800a410ddd6dd321fd6b92c0e21f029fcbab/gcc%2Ffortran%2Ffrontend-passes.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/a2d0800a410ddd6dd321fd6b92c0e21f029fcbab/gcc%2Ffortran%2Ffrontend-passes.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ffortran%2Ffrontend-passes.c?ref=a2d0800a410ddd6dd321fd6b92c0e21f029fcbab", "patch": "@@ -300,7 +300,12 @@ callback_reduction (gfc_expr **e, int *walk_subtrees ATTRIBUTE_UNUSED,\n \n   c = gfc_constructor_first (arg->value.constructor);\n \n-  if (c == NULL)\n+  /* Don't do any simplififcation if we have\n+     - no element in the constructor or\n+     - only have a single element in the array which contains an\n+     iterator.  */\n+\n+  if (c == NULL || (c->iterator != NULL && gfc_constructor_next (c) == NULL))\n     return 0;\n \n   res = copy_walk_reduction_arg (c->expr, fn);"}, {"sha": "73935171e31993b944f6ebe5c6dec34a075f431c", "filename": "gcc/testsuite/ChangeLog", "status": "modified", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/a2d0800a410ddd6dd321fd6b92c0e21f029fcbab/gcc%2Ftestsuite%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/a2d0800a410ddd6dd321fd6b92c0e21f029fcbab/gcc%2Ftestsuite%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2FChangeLog?ref=a2d0800a410ddd6dd321fd6b92c0e21f029fcbab", "patch": "@@ -1,3 +1,8 @@\n+2013-04-08  Thomas Koenig  <tkoenig@gcc.gnu.org>\n+\n+\tPR fortran/56782\n+\t* gfortran.dg/array_constructor_44.f90:  New test.\n+\n 2013-04-08  Paolo Carlini  <paolo.carlini@oracle.com>\n \n \tPR c++/56871"}, {"sha": "e0cffd168beb37ed16130fd4f9ac8ce800ae44b4", "filename": "gcc/testsuite/gfortran.dg/array_constructor_44.f90", "status": "added", "additions": 12, "deletions": 0, "changes": 12, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/a2d0800a410ddd6dd321fd6b92c0e21f029fcbab/gcc%2Ftestsuite%2Fgfortran.dg%2Farray_constructor_44.f90", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/a2d0800a410ddd6dd321fd6b92c0e21f029fcbab/gcc%2Ftestsuite%2Fgfortran.dg%2Farray_constructor_44.f90", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgfortran.dg%2Farray_constructor_44.f90?ref=a2d0800a410ddd6dd321fd6b92c0e21f029fcbab", "patch": "@@ -0,0 +1,12 @@\n+! { dg-do run }\n+! { dg-options \"-ffrontend-optimize\" }\n+! PR 56872 - wrong front-end optimization with a single constructor.\n+! Original bug report by Rich Townsend.\n+  integer :: k\n+  real :: s\n+  integer :: m\n+  s = 2.0\n+  m = 4\n+  res = SUM([(s**(REAL(k-1)/REAL(m-1)),k=1,m)])\n+  if (abs(res - 5.84732246) > 1e-6) call abort\n+  end"}]}