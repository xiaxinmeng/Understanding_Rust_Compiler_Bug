{"sha": "d7ddbe241a953a4ba9adae1f3a38ade24f9121f0", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6ZDdkZGJlMjQxYTk1M2E0YmE5YWRhZTFmM2EzOGFkZTI0ZjkxMjFmMA==", "commit": {"author": {"name": "Richard Henderson", "email": "rth@gcc.gnu.org", "date": "2003-02-19T02:07:06Z"}, "committer": {"name": "Richard Henderson", "email": "rth@gcc.gnu.org", "date": "2003-02-19T02:07:06Z"}, "message": "c-common.c (handle_used_attribute): Accept static data too.\n\n        * c-common.c (handle_used_attribute): Accept static data too.\n\n        * gcc.dg/attr-invalid.c: Allow __used__ on static data.\n        * gcc.dg/attr-used-2.c: New.\n\nFrom-SVN: r63082", "tree": {"sha": "61bfc9f2c849a8b517a22fb036bb9ba1c8838f72", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/61bfc9f2c849a8b517a22fb036bb9ba1c8838f72"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/d7ddbe241a953a4ba9adae1f3a38ade24f9121f0", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/d7ddbe241a953a4ba9adae1f3a38ade24f9121f0", "html_url": "https://github.com/Rust-GCC/gccrs/commit/d7ddbe241a953a4ba9adae1f3a38ade24f9121f0", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/d7ddbe241a953a4ba9adae1f3a38ade24f9121f0/comments", "author": null, "committer": null, "parents": [{"sha": "05e9e0a570f2a0d9f1d683b4cb543ba556d6a1a6", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/05e9e0a570f2a0d9f1d683b4cb543ba556d6a1a6", "html_url": "https://github.com/Rust-GCC/gccrs/commit/05e9e0a570f2a0d9f1d683b4cb543ba556d6a1a6"}], "stats": {"total": 39, "additions": 31, "deletions": 8}, "files": [{"sha": "04b7f814bd41421c2eb17e3fa6ef0eb90931e470", "filename": "gcc/ChangeLog", "status": "modified", "additions": 5, "deletions": 1, "changes": 6, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/d7ddbe241a953a4ba9adae1f3a38ade24f9121f0/gcc%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/d7ddbe241a953a4ba9adae1f3a38ade24f9121f0/gcc%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2FChangeLog?ref=d7ddbe241a953a4ba9adae1f3a38ade24f9121f0", "patch": "@@ -1,4 +1,8 @@\n-003-02-18  Nick Clifton  <nickc@redhat.com>\n+2003-02-18  Richard Henderson  <rth@redhat.com>\n+\n+\t* c-common.c (handle_used_attribute): Accept static data too.\n+\n+2003-02-18  Nick Clifton  <nickc@redhat.com>\n             Aldy Hernandez  <aldyh@redhat.com>\n \n         * testsuite/gcc.dg/20030218-1.c: New."}, {"sha": "b49dc25f43dd7ffab4b7408d2273112dc7d9a361", "filename": "gcc/c-common.c", "status": "modified", "additions": 8, "deletions": 5, "changes": 13, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/d7ddbe241a953a4ba9adae1f3a38ade24f9121f0/gcc%2Fc-common.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/d7ddbe241a953a4ba9adae1f3a38ade24f9121f0/gcc%2Fc-common.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fc-common.c?ref=d7ddbe241a953a4ba9adae1f3a38ade24f9121f0", "patch": "@@ -5415,16 +5415,19 @@ handle_always_inline_attribute (node, name, args, flags, no_add_attrs)\n    struct attribute_spec.handler.  */\n \n static tree\n-handle_used_attribute (node, name, args, flags, no_add_attrs)\n-     tree *node;\n+handle_used_attribute (pnode, name, args, flags, no_add_attrs)\n+     tree *pnode;\n      tree name;\n      tree args ATTRIBUTE_UNUSED;\n      int flags ATTRIBUTE_UNUSED;\n      bool *no_add_attrs;\n {\n-  if (TREE_CODE (*node) == FUNCTION_DECL)\n-    TREE_SYMBOL_REFERENCED (DECL_ASSEMBLER_NAME (*node))\n-      = TREE_USED (*node) = 1;\n+  tree node = *pnode;\n+\n+  if (TREE_CODE (node) == FUNCTION_DECL\n+      || (TREE_CODE (node) == VAR_DECL && TREE_STATIC (node)))\n+    TREE_SYMBOL_REFERENCED (DECL_ASSEMBLER_NAME (node))\n+      = TREE_USED (node) = 1;\n   else\n     {\n       warning (\"`%s' attribute ignored\", IDENTIFIER_POINTER (name));"}, {"sha": "4c7b8b38e1cfe84a635217a12540107d58f9e4cb", "filename": "gcc/testsuite/ChangeLog", "status": "modified", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/d7ddbe241a953a4ba9adae1f3a38ade24f9121f0/gcc%2Ftestsuite%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/d7ddbe241a953a4ba9adae1f3a38ade24f9121f0/gcc%2Ftestsuite%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2FChangeLog?ref=d7ddbe241a953a4ba9adae1f3a38ade24f9121f0", "patch": "@@ -1,3 +1,8 @@\n+2003-02-18  Richard Henderson  <rth@redhat.com>\n+\n+\t* gcc.dg/attr-invalid.c: Allow __used__ on static data.\n+\t* gcc.dg/attr-used-2.c: New.\n+\n 2003-02-18  Mark Mitchell  <mark@codesourcery.com>\n \n \tPR c++/9704"}, {"sha": "9cb645415480e87fbeccc7c42ac4401e3d0b8faf", "filename": "gcc/testsuite/gcc.dg/attr-invalid.c", "status": "modified", "additions": 2, "deletions": 2, "changes": 4, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/d7ddbe241a953a4ba9adae1f3a38ade24f9121f0/gcc%2Ftestsuite%2Fgcc.dg%2Fattr-invalid.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/d7ddbe241a953a4ba9adae1f3a38ade24f9121f0/gcc%2Ftestsuite%2Fgcc.dg%2Fattr-invalid.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgcc.dg%2Fattr-invalid.c?ref=d7ddbe241a953a4ba9adae1f3a38ade24f9121f0", "patch": "@@ -43,7 +43,7 @@ struct ATSYM(struct) {\n   char dummy ATTR; /* { dg-warning \"attribute ignored\" \"\" } */\n } ATTR; /* { dg-warning \"does not apply to types\" \"\" } */\n \n-int ATSYM(var) ATTR;  /* { dg-warning \"attribute ignored\" \"\" } */\n+int ATSYM(var) ATTR;\n \n int ATSYM(fn_knrarg) (arg)\n   int arg ATTR; /* { dg-warning \"attribute ignored\" \"\" } */\n@@ -52,7 +52,7 @@ int ATSYM(fn_knrarg) (arg)\n int ATSYM(fn_isoarg) (int arg ATTR) { return 0; } /* { dg-warning \"attribute ignored\" \"\" } */\n \n int ATSYM(fn_vars) (void) {\n-  static int svar ATTR; /* { dg-warning \"attribute ignored\" \"\" } */\n+  static int svar ATTR;\n   auto int lvar ATTR; /* { dg-warning \"attribute ignored\" \"\" } */\n   return 0;\n }"}, {"sha": "f78b94b53a940e825ae7f4bb11901056fa516622", "filename": "gcc/testsuite/gcc.dg/attr-used-2.c", "status": "added", "additions": 11, "deletions": 0, "changes": 11, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/d7ddbe241a953a4ba9adae1f3a38ade24f9121f0/gcc%2Ftestsuite%2Fgcc.dg%2Fattr-used-2.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/d7ddbe241a953a4ba9adae1f3a38ade24f9121f0/gcc%2Ftestsuite%2Fgcc.dg%2Fattr-used-2.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgcc.dg%2Fattr-used-2.c?ref=d7ddbe241a953a4ba9adae1f3a38ade24f9121f0", "patch": "@@ -0,0 +1,11 @@\n+/* { dg-do compile } */\n+/* { dg-options \"-Wall -O2\" } */\n+\n+static int xyzzy __attribute__((__used__)) = 1; \n+\n+void foo()\n+{\n+  int x __attribute__((__used__)); /* { dg-warning \"attribute ignored|unused variable\" } */\n+}\n+\n+/* { dg-final { scan-assembler \"xyzzy\" } } */"}]}