{"sha": "9a8e528cf1e5aa1a7e7fa09716a3b5b87b56dc93", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6OWE4ZTUyOGNmMWU1YWExYTdlN2ZhMDk3MTZhM2I1Yjg3YjU2ZGM5Mw==", "commit": {"author": {"name": "Jonathan Wakely", "email": "jwakely@redhat.com", "date": "2016-08-04T12:33:10Z"}, "committer": {"name": "Jonathan Wakely", "email": "redi@gcc.gnu.org", "date": "2016-08-04T12:33:10Z"}, "message": "Define std::enable_shared_from_this::weak_from_this\n\n\t* testsuite/20_util/enable_shared_from_this/members/reinit.cc: Use\n\teffective target not dg-options. Move check for feature-test macro to:\n\t* testsuite/20_util/enable_shared_from_this/members/weak_from_this.cc:\n\tNew test.\n\nFrom-SVN: r239121", "tree": {"sha": "d50041f0f0c70e41f67259b511c6e1e9adf5ed37", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/d50041f0f0c70e41f67259b511c6e1e9adf5ed37"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/9a8e528cf1e5aa1a7e7fa09716a3b5b87b56dc93", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/9a8e528cf1e5aa1a7e7fa09716a3b5b87b56dc93", "html_url": "https://github.com/Rust-GCC/gccrs/commit/9a8e528cf1e5aa1a7e7fa09716a3b5b87b56dc93", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/9a8e528cf1e5aa1a7e7fa09716a3b5b87b56dc93/comments", "author": {"login": "jwakely", "id": 1254480, "node_id": "MDQ6VXNlcjEyNTQ0ODA=", "avatar_url": "https://avatars.githubusercontent.com/u/1254480?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jwakely", "html_url": "https://github.com/jwakely", "followers_url": "https://api.github.com/users/jwakely/followers", "following_url": "https://api.github.com/users/jwakely/following{/other_user}", "gists_url": "https://api.github.com/users/jwakely/gists{/gist_id}", "starred_url": "https://api.github.com/users/jwakely/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jwakely/subscriptions", "organizations_url": "https://api.github.com/users/jwakely/orgs", "repos_url": "https://api.github.com/users/jwakely/repos", "events_url": "https://api.github.com/users/jwakely/events{/privacy}", "received_events_url": "https://api.github.com/users/jwakely/received_events", "type": "User", "site_admin": false}, "committer": {"login": "jwakely", "id": 1254480, "node_id": "MDQ6VXNlcjEyNTQ0ODA=", "avatar_url": "https://avatars.githubusercontent.com/u/1254480?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jwakely", "html_url": "https://github.com/jwakely", "followers_url": "https://api.github.com/users/jwakely/followers", "following_url": "https://api.github.com/users/jwakely/following{/other_user}", "gists_url": "https://api.github.com/users/jwakely/gists{/gist_id}", "starred_url": "https://api.github.com/users/jwakely/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jwakely/subscriptions", "organizations_url": "https://api.github.com/users/jwakely/orgs", "repos_url": "https://api.github.com/users/jwakely/repos", "events_url": "https://api.github.com/users/jwakely/events{/privacy}", "received_events_url": "https://api.github.com/users/jwakely/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "7d2035fafe935fd7552a2b764807fe1e0274f2be", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/7d2035fafe935fd7552a2b764807fe1e0274f2be", "html_url": "https://github.com/Rust-GCC/gccrs/commit/7d2035fafe935fd7552a2b764807fe1e0274f2be"}], "stats": {"total": 33, "additions": 27, "deletions": 6}, "files": [{"sha": "bf22550a6e38b9bce3c6e8b78b746d324750164f", "filename": "libstdc++-v3/ChangeLog", "status": "modified", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/9a8e528cf1e5aa1a7e7fa09716a3b5b87b56dc93/libstdc%2B%2B-v3%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/9a8e528cf1e5aa1a7e7fa09716a3b5b87b56dc93/libstdc%2B%2B-v3%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libstdc%2B%2B-v3%2FChangeLog?ref=9a8e528cf1e5aa1a7e7fa09716a3b5b87b56dc93", "patch": "@@ -1,5 +1,10 @@\n 2016-08-04  Jonathan Wakely  <jwakely@redhat.com>\n \n+\t* testsuite/20_util/enable_shared_from_this/members/reinit.cc: Use\n+\teffective target not dg-options. Move check for feature-test macro to:\n+\t* testsuite/20_util/enable_shared_from_this/members/weak_from_this.cc:\n+\tNew test.\n+\n \t* include/std/functional (_Unwrap): Rename to __inv_unwrap.\n \t(__invfwd): Adjust.\n \t(__invoke_impl): Remove unused template parameters."}, {"sha": "747b09a2155e20dcb67b2c52242d2057751e09a9", "filename": "libstdc++-v3/include/bits/shared_ptr.h", "status": "modified", "additions": 11, "deletions": 0, "changes": 11, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/9a8e528cf1e5aa1a7e7fa09716a3b5b87b56dc93/libstdc%2B%2B-v3%2Finclude%2Fbits%2Fshared_ptr.h", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/9a8e528cf1e5aa1a7e7fa09716a3b5b87b56dc93/libstdc%2B%2B-v3%2Finclude%2Fbits%2Fshared_ptr.h", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libstdc%2B%2B-v3%2Finclude%2Fbits%2Fshared_ptr.h?ref=9a8e528cf1e5aa1a7e7fa09716a3b5b87b56dc93", "patch": "@@ -586,6 +586,17 @@ _GLIBCXX_BEGIN_NAMESPACE_VERSION\n       shared_from_this() const\n       { return shared_ptr<const _Tp>(this->_M_weak_this); }\n \n+#if __cplusplus > 201402L || !defined(__STRICT_ANSI__) // c++1z or gnu++11\n+#define __cpp_lib_enable_shared_from_this 201603\n+      weak_ptr<_Tp>\n+      weak_from_this()\n+      { return this->_M_weak_this; }\n+\n+      weak_ptr<const _Tp>\n+      weak_from_this() const\n+      { return this->_M_weak_this; }\n+#endif\n+\n     private:\n       template<typename _Tp1>\n \tvoid"}, {"sha": "787dc9b865885045426be7238e4b4a6f5e370dab", "filename": "libstdc++-v3/include/bits/shared_ptr_base.h", "status": "modified", "additions": 10, "deletions": 1, "changes": 11, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/9a8e528cf1e5aa1a7e7fa09716a3b5b87b56dc93/libstdc%2B%2B-v3%2Finclude%2Fbits%2Fshared_ptr_base.h", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/9a8e528cf1e5aa1a7e7fa09716a3b5b87b56dc93/libstdc%2B%2B-v3%2Finclude%2Fbits%2Fshared_ptr_base.h", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libstdc%2B%2B-v3%2Finclude%2Fbits%2Fshared_ptr_base.h?ref=9a8e528cf1e5aa1a7e7fa09716a3b5b87b56dc93", "patch": "@@ -1472,7 +1472,6 @@ _GLIBCXX_BEGIN_NAMESPACE_VERSION\n       void\n       _M_assign(_Tp* __ptr, const __shared_count<_Lp>& __refcount) noexcept\n       {\n-#define __cpp_lib_enable_shared_from_this 201603\n \tif (use_count() == 0)\n \t  {\n \t    _M_ptr = __ptr;\n@@ -1557,6 +1556,16 @@ _GLIBCXX_BEGIN_NAMESPACE_VERSION\n       shared_from_this() const\n       { return __shared_ptr<const _Tp, _Lp>(this->_M_weak_this); }\n \n+#if __cplusplus > 201402L || !defined(__STRICT_ANSI__) // c++1z or gnu++11\n+      __weak_ptr<_Tp, _Lp>\n+      weak_from_this()\n+      { return this->_M_weak_this; }\n+\n+      __weak_ptr<const _Tp, _Lp>\n+      weak_from_this() const\n+      { return this->_M_weak_this; }\n+#endif\n+\n     private:\n       template<typename _Tp1>\n \tvoid"}, {"sha": "3209f87026a4e593f59d7589cc5dc3484812b14f", "filename": "libstdc++-v3/testsuite/20_util/enable_shared_from_this/members/reinit.cc", "status": "modified", "additions": 1, "deletions": 5, "changes": 6, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/9a8e528cf1e5aa1a7e7fa09716a3b5b87b56dc93/libstdc%2B%2B-v3%2Ftestsuite%2F20_util%2Fenable_shared_from_this%2Fmembers%2Freinit.cc", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/9a8e528cf1e5aa1a7e7fa09716a3b5b87b56dc93/libstdc%2B%2B-v3%2Ftestsuite%2F20_util%2Fenable_shared_from_this%2Fmembers%2Freinit.cc", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libstdc%2B%2B-v3%2Ftestsuite%2F20_util%2Fenable_shared_from_this%2Fmembers%2Freinit.cc?ref=9a8e528cf1e5aa1a7e7fa09716a3b5b87b56dc93", "patch": "@@ -15,15 +15,11 @@\n // with this library; see the file COPYING3.  If not see\n // <http://www.gnu.org/licenses/>.\n \n-// { dg-options \"-std=gnu++11\" }\n+// { dg-do run { target c++11 } }\n \n #include <memory>\n #include <testsuite_hooks.h>\n \n-#if __cpp_lib_enable_shared_from_this < 201603\n-# error \"__cpp_lib_enable_shared_from_this < 201603\"\n-#endif\n-\n struct X : public std::enable_shared_from_this<X> { };\n \n bool"}]}