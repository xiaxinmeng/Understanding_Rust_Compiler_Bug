{"sha": "a00a42220eca0305312b842ded274fd0aa23383d", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6YTAwYTQyMjIwZWNhMDMwNTMxMmI4NDJkZWQyNzRmZDBhYTIzMzgzZA==", "commit": {"author": {"name": "Kyrylo Tkachov", "email": "kyrylo.tkachov@arm.com", "date": "2018-01-08T15:15:08Z"}, "committer": {"name": "Kyrylo Tkachov", "email": "ktkachov@gcc.gnu.org", "date": "2018-01-08T15:15:08Z"}, "message": "[arm] Add -march=armv8.3-a and dotprod multilib selection rules\n\nWe don't have the t-aprofile, t-multilib and t-arm-elf mapping\nrules for multilibs when using the variants of -march=armv8.3-a\nand the dotproduct extension.\nThis patch adds them. -march=armv8.3-a behaves in the same\nway as -march=armv8.2-a in this regard.\n\nBootstrapped and tested with the aprofile multilib list.\nChecked that --print-multi-directory gives sensible results\nwith armv8.3-a options and extensions.\nI've also added some armv8.3-a, fp16 and dotprod\ncombination tests to multilib.exp\n\n\t* config/arm/t-aprofile (MULTILIB_MATCHES): Add mapping rules for\n\t-march=armv8.3-a variants.\n\t* config/arm/t-multilib: Likewise.\n\t* config/arm/t-arm-elf: Likewise.  Handle dotprod extension.\n\n\t* gcc.target/arm/multilib.exp: Add fp16, dotprod and armv8.3-a\n\tcombination tests.\n\nFrom-SVN: r256345", "tree": {"sha": "3744ab510d2dcebe8b8863e77938b3734a779cc6", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/3744ab510d2dcebe8b8863e77938b3734a779cc6"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/a00a42220eca0305312b842ded274fd0aa23383d", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/a00a42220eca0305312b842ded274fd0aa23383d", "html_url": "https://github.com/Rust-GCC/gccrs/commit/a00a42220eca0305312b842ded274fd0aa23383d", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/a00a42220eca0305312b842ded274fd0aa23383d/comments", "author": {"login": "ktkachov-arm", "id": 74917949, "node_id": "MDQ6VXNlcjc0OTE3OTQ5", "avatar_url": "https://avatars.githubusercontent.com/u/74917949?v=4", "gravatar_id": "", "url": "https://api.github.com/users/ktkachov-arm", "html_url": "https://github.com/ktkachov-arm", "followers_url": "https://api.github.com/users/ktkachov-arm/followers", "following_url": "https://api.github.com/users/ktkachov-arm/following{/other_user}", "gists_url": "https://api.github.com/users/ktkachov-arm/gists{/gist_id}", "starred_url": "https://api.github.com/users/ktkachov-arm/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/ktkachov-arm/subscriptions", "organizations_url": "https://api.github.com/users/ktkachov-arm/orgs", "repos_url": "https://api.github.com/users/ktkachov-arm/repos", "events_url": "https://api.github.com/users/ktkachov-arm/events{/privacy}", "received_events_url": "https://api.github.com/users/ktkachov-arm/received_events", "type": "User", "site_admin": false}, "committer": null, "parents": [{"sha": "8f2c60230485a3510ad719c2e5efaea594e95992", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/8f2c60230485a3510ad719c2e5efaea594e95992", "html_url": "https://github.com/Rust-GCC/gccrs/commit/8f2c60230485a3510ad719c2e5efaea594e95992"}], "stats": {"total": 52, "additions": 46, "deletions": 6}, "files": [{"sha": "e08bd9213fe49ad4b94c44569e95c5ac68861d19", "filename": "gcc/ChangeLog", "status": "modified", "additions": 7, "deletions": 0, "changes": 7, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/a00a42220eca0305312b842ded274fd0aa23383d/gcc%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/a00a42220eca0305312b842ded274fd0aa23383d/gcc%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2FChangeLog?ref=a00a42220eca0305312b842ded274fd0aa23383d", "patch": "@@ -1,3 +1,10 @@\n+2018-01-08  Kyrylo Tkachov  <kyrylo.tkachov@arm.com>\n+\n+\t* config/arm/t-aprofile (MULTILIB_MATCHES): Add mapping rules for\n+\t-march=armv8.3-a variants.\n+\t* config/arm/t-multilib: Likewise.\n+\t* config/arm/t-arm-elf: Likewise.  Handle dotprod extension.\n+\n 2018-01-08  Aaron Sawdey  <acsawdey@linux.vnet.ibm.com>\n \n \t* config/rs6000/rs6000.md (cceq_ior_compare): Remove * so I can use it"}, {"sha": "6c34c09cc15ff53526a682553270132795a24b51", "filename": "gcc/config/arm/t-aprofile", "status": "modified", "additions": 6, "deletions": 2, "changes": 8, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/a00a42220eca0305312b842ded274fd0aa23383d/gcc%2Fconfig%2Farm%2Ft-aprofile", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/a00a42220eca0305312b842ded274fd0aa23383d/gcc%2Fconfig%2Farm%2Ft-aprofile", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fconfig%2Farm%2Ft-aprofile?ref=a00a42220eca0305312b842ded274fd0aa23383d", "patch": "@@ -88,9 +88,13 @@ MULTILIB_MATCHES\t+= $(foreach ARCH, $(v8_1_a_simd_variants), \\\n # Baseline v8.2-a: map down to baseline v8-a\n MULTILIB_MATCHES\t+= march?armv8-a=march?armv8.2-a\n \n-# Map all v8.2-a SIMD variants to v8-a+simd\n+# Baseline v8.3-a: map down to baseline v8-a\n+MULTILIB_MATCHES\t+= march?armv8-a=march?armv8.3-a\n+\n+# Map all v8.2-a and v8.3-a SIMD variants to v8-a+simd\n MULTILIB_MATCHES\t+= $(foreach ARCH, $(v8_2_a_simd_variants), \\\n-\t\t\t     march?armv8-a+simd=march?armv8.2-a$(ARCH))\n+\t\t\t     march?armv8-a+simd=march?armv8.2-a$(ARCH) \\\n+\t\t\t     march?armv8-a+simd=march?armv8.3-a$(ARCH))\n \n # Use Thumb libraries for everything.\n "}, {"sha": "189ab9beb00561a53e34d479a45038a8bc47585d", "filename": "gcc/config/arm/t-arm-elf", "status": "modified", "additions": 2, "deletions": 2, "changes": 4, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/a00a42220eca0305312b842ded274fd0aa23383d/gcc%2Fconfig%2Farm%2Ft-arm-elf", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/a00a42220eca0305312b842ded274fd0aa23383d/gcc%2Fconfig%2Farm%2Ft-arm-elf", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fconfig%2Farm%2Ft-arm-elf?ref=a00a42220eca0305312b842ded274fd0aa23383d", "patch": "@@ -36,7 +36,7 @@ v7ve_fps\t:= vfpv3-d16 vfpv3 vfpv3-d16-fp16 vfpv3-fp16 vfpv4 neon \\\n \n # Not all these permutations exist for all architecture variants, but\n # it seems to work ok.\n-v8_fps\t\t:= simd fp16 crypto fp16+crypto\n+v8_fps\t\t:= simd fp16 crypto fp16+crypto dotprod\n \n # We don't do anything special with these.  Pre-v4t probably doesn't work.\n all_early_nofp\t:= armv2 armv2a armv3 armv3m armv4 armv4t armv5 armv5t\n@@ -46,7 +46,7 @@ all_early_arch\t:= armv5e armv5tej armv6 armv6j armv6k armv6z armv6kz \\\n \n all_v7_a_r\t:= armv7-a armv7ve armv7-r\n \n-all_v8_archs\t:= armv8-a armv8-a+crc armv8.1-a armv8.2-a\n+all_v8_archs\t:= armv8-a armv8-a+crc armv8.1-a armv8.2-a armv8.3-a\n \n # No floating point variants, require thumb1 softfp\n all_nofp_t\t:= armv6-m armv6s-m armv8-m.base"}, {"sha": "c0ca255c0175aef6745cb82e972c97f5a7240a29", "filename": "gcc/config/arm/t-multilib", "status": "modified", "additions": 6, "deletions": 2, "changes": 8, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/a00a42220eca0305312b842ded274fd0aa23383d/gcc%2Fconfig%2Farm%2Ft-multilib", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/a00a42220eca0305312b842ded274fd0aa23383d/gcc%2Fconfig%2Farm%2Ft-multilib", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fconfig%2Farm%2Ft-multilib?ref=a00a42220eca0305312b842ded274fd0aa23383d", "patch": "@@ -139,9 +139,13 @@ MULTILIB_MATCHES\t+= $(foreach ARCH, $(v8_1_a_simd_variants), \\\n # Baseline v8.2-a: map down to baseline v8-a\n MULTILIB_MATCHES\t+= march?armv7=march?armv8.2-a\n \n-# Map all v8.2-a SIMD variants\n+# Baseline v8.3-a: map down to baseline v8-a\n+MULTILIB_MATCHES\t+= march?armv7=march?armv8.3-a\n+\n+# Map all v8.2-a SIMD variants.  v8.3-a SIMD variants have the same mappings\n MULTILIB_MATCHES\t+= $(foreach ARCH, $(v8_2_a_simd_variants), \\\n-\t\t\t     march?armv7+fp=march?armv8.2-a$(ARCH))\n+\t\t\t     march?armv7+fp=march?armv8.2-a$(ARCH) \\\n+\t\t\t     march?armv7+fp=march?armv8.3-a$(ARCH))\n \n # Use Thumb libraries for everything.\n "}, {"sha": "749668f981637709d1fa1993ab3f2cdd35f19915", "filename": "gcc/testsuite/ChangeLog", "status": "modified", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/a00a42220eca0305312b842ded274fd0aa23383d/gcc%2Ftestsuite%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/a00a42220eca0305312b842ded274fd0aa23383d/gcc%2Ftestsuite%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2FChangeLog?ref=a00a42220eca0305312b842ded274fd0aa23383d", "patch": "@@ -1,3 +1,8 @@\n+2018-01-08  Kyrylo Tkachov  <kyrylo.tkachov@arm.com>\n+\n+\t* gcc.target/arm/multilib.exp: Add fp16, dotprod and armv8.3-a\n+\tcombination tests.\n+\n 2018-01-08  Richard Biener  <rguenther@suse.de>\n \n \tPR tree-optimization/83563"}, {"sha": "c3c8e1f919dedb3ecdf0b9dc20df506efcd8d91a", "filename": "gcc/testsuite/gcc.target/arm/multilib.exp", "status": "modified", "additions": 20, "deletions": 0, "changes": 20, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/a00a42220eca0305312b842ded274fd0aa23383d/gcc%2Ftestsuite%2Fgcc.target%2Farm%2Fmultilib.exp", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/a00a42220eca0305312b842ded274fd0aa23383d/gcc%2Ftestsuite%2Fgcc.target%2Farm%2Fmultilib.exp", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgcc.target%2Farm%2Fmultilib.exp?ref=a00a42220eca0305312b842ded274fd0aa23383d", "patch": "@@ -72,6 +72,26 @@ if {[multilib_config \"aprofile\"] } {\n \t{-march=armv8.2-a+simd+crypto -mfloat-abi=softfp} \"thumb/v8-a+simd/softfp\"\n \t{-march=armv8.2-a+simd+crypto+nofp -mfloat-abi=softfp} \"thumb/v8-a/nofp\"\n \t{-march=armv8.2-a+simd+nofp+crypto -mfloat-abi=softfp} \"thumb/v8-a+simd/softfp\"\n+\t{-march=armv8.2-a+fp16 -mfloat-abi=soft} \"thumb/v8-a/nofp\"\n+\t{-march=armv8.2-a+simd+fp16 -mfloat-abi=softfp} \"thumb/v8-a+simd/softfp\"\n+\t{-march=armv8.2-a+simd+fp16+nofp -mfloat-abi=softfp} \"thumb/v8-a/nofp\"\n+\t{-march=armv8.2-a+simd+nofp+fp16 -mfloat-abi=softfp} \"thumb/v8-a+simd/softfp\"\n+\t{-march=armv8.2-a+dotprod -mfloat-abi=soft} \"thumb/v8-a/nofp\"\n+\t{-march=armv8.2-a+simd+dotprod -mfloat-abi=softfp} \"thumb/v8-a+simd/softfp\"\n+\t{-march=armv8.2-a+simd+dotprod+nofp -mfloat-abi=softfp} \"thumb/v8-a/nofp\"\n+\t{-march=armv8.2-a+simd+nofp+dotprod -mfloat-abi=softfp} \"thumb/v8-a+simd/softfp\"\n+\t{-march=armv8.3-a+crypto -mfloat-abi=soft} \"thumb/v8-a/nofp\"\n+\t{-march=armv8.3-a+simd+crypto -mfloat-abi=softfp} \"thumb/v8-a+simd/softfp\"\n+\t{-march=armv8.3-a+simd+crypto+nofp -mfloat-abi=softfp} \"thumb/v8-a/nofp\"\n+\t{-march=armv8.3-a+simd+nofp+crypto -mfloat-abi=softfp} \"thumb/v8-a+simd/softfp\"\n+\t{-march=armv8.3-a+fp16 -mfloat-abi=soft} \"thumb/v8-a/nofp\"\n+\t{-march=armv8.3-a+simd+fp16 -mfloat-abi=softfp} \"thumb/v8-a+simd/softfp\"\n+\t{-march=armv8.3-a+simd+fp16+nofp -mfloat-abi=softfp} \"thumb/v8-a/nofp\"\n+\t{-march=armv8.3-a+simd+nofp+fp16 -mfloat-abi=softfp} \"thumb/v8-a+simd/softfp\"\n+\t{-march=armv8.3-a+dotprod -mfloat-abi=soft} \"thumb/v8-a/nofp\"\n+\t{-march=armv8.3-a+simd+dotprod -mfloat-abi=softfp} \"thumb/v8-a+simd/softfp\"\n+\t{-march=armv8.3-a+simd+dotprod+nofp -mfloat-abi=softfp} \"thumb/v8-a/nofp\"\n+\t{-march=armv8.3-a+simd+nofp+dotprod -mfloat-abi=softfp} \"thumb/v8-a+simd/softfp\"\n \t{-mcpu=cortex-a53+crypto -mfloat-abi=hard} \"thumb/v8-a+simd/hard\"\n \t{-mcpu=cortex-a53+nofp -mfloat-abi=softfp} \"thumb/v8-a/nofp\"\n \t{-march=armv8-a+crc -mfloat-abi=hard -mfpu=vfp} \"thumb/v8-a+simd/hard\""}]}