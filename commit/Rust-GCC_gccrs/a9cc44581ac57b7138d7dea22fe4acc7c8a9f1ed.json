{"sha": "a9cc44581ac57b7138d7dea22fe4acc7c8a9f1ed", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6YTljYzQ0NTgxYWM1N2I3MTM4ZDdkZWEyMmZlNGFjYzdjOGE5ZjFlZA==", "commit": {"author": {"name": "Richard Guenther", "email": "rguenther@suse.de", "date": "2009-10-05T14:30:10Z"}, "committer": {"name": "Richard Biener", "email": "rguenth@gcc.gnu.org", "date": "2009-10-05T14:30:10Z"}, "message": "re PR lto/41281 (toplevel asms do not work)\n\n2009-10-05  Richard Guenther  <rguenther@suse.de>\n\n\tPR lto/41281\n\t* lto-cgraph.c (output_cgraph): Output toplevel asms.\n\t(input_cgraph_1): Input toplevel asms.\n\n\t* gcc.dg/lto/20090914-2_0.c: New testcase.\n\nFrom-SVN: r152453", "tree": {"sha": "92361780d8563222d530a8515e625d920a179b6c", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/92361780d8563222d530a8515e625d920a179b6c"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/a9cc44581ac57b7138d7dea22fe4acc7c8a9f1ed", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/a9cc44581ac57b7138d7dea22fe4acc7c8a9f1ed", "html_url": "https://github.com/Rust-GCC/gccrs/commit/a9cc44581ac57b7138d7dea22fe4acc7c8a9f1ed", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/a9cc44581ac57b7138d7dea22fe4acc7c8a9f1ed/comments", "author": {"login": "rguenth", "id": 2046526, "node_id": "MDQ6VXNlcjIwNDY1MjY=", "avatar_url": "https://avatars.githubusercontent.com/u/2046526?v=4", "gravatar_id": "", "url": "https://api.github.com/users/rguenth", "html_url": "https://github.com/rguenth", "followers_url": "https://api.github.com/users/rguenth/followers", "following_url": "https://api.github.com/users/rguenth/following{/other_user}", "gists_url": "https://api.github.com/users/rguenth/gists{/gist_id}", "starred_url": "https://api.github.com/users/rguenth/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/rguenth/subscriptions", "organizations_url": "https://api.github.com/users/rguenth/orgs", "repos_url": "https://api.github.com/users/rguenth/repos", "events_url": "https://api.github.com/users/rguenth/events{/privacy}", "received_events_url": "https://api.github.com/users/rguenth/received_events", "type": "User", "site_admin": false}, "committer": null, "parents": [{"sha": "fd7588bcde3fd5a94a4e62b51a394a2a0926701b", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/fd7588bcde3fd5a94a4e62b51a394a2a0926701b", "html_url": "https://github.com/Rust-GCC/gccrs/commit/fd7588bcde3fd5a94a4e62b51a394a2a0926701b"}], "stats": {"total": 49, "additions": 49, "deletions": 0}, "files": [{"sha": "f3efe2442ee87f69e343687c1c75f43a4a9f9c8b", "filename": "gcc/ChangeLog", "status": "modified", "additions": 6, "deletions": 0, "changes": 6, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/a9cc44581ac57b7138d7dea22fe4acc7c8a9f1ed/gcc%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/a9cc44581ac57b7138d7dea22fe4acc7c8a9f1ed/gcc%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2FChangeLog?ref=a9cc44581ac57b7138d7dea22fe4acc7c8a9f1ed", "patch": "@@ -1,3 +1,9 @@\n+2009-10-05  Richard Guenther  <rguenther@suse.de>\n+\n+\tPR lto/41281\n+\t* lto-cgraph.c (output_cgraph): Output toplevel asms.\n+\t(input_cgraph_1): Input toplevel asms.\n+\n 2009-10-05  Richard Guenther  <rguenther@suse.de>\n \n \tPR lto/40902"}, {"sha": "14916473640c7a99bdbeb83871850e103300f774", "filename": "gcc/lto-cgraph.c", "status": "modified", "additions": 27, "deletions": 0, "changes": 27, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/a9cc44581ac57b7138d7dea22fe4acc7c8a9f1ed/gcc%2Flto-cgraph.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/a9cc44581ac57b7138d7dea22fe4acc7c8a9f1ed/gcc%2Flto-cgraph.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Flto-cgraph.c?ref=a9cc44581ac57b7138d7dea22fe4acc7c8a9f1ed", "patch": "@@ -318,6 +318,7 @@ output_cgraph (cgraph_node_set set)\n   int i, n_nodes;\n   bitmap written_decls;\n   lto_cgraph_encoder_t encoder;\n+  struct cgraph_asm_node *can;\n \n   ob = lto_create_simple_output_block (LTO_section_cgraph);\n \n@@ -375,6 +376,18 @@ output_cgraph (cgraph_node_set set)\n \n   lto_output_uleb128_stream (ob->main_stream, 0);\n \n+  /* Emit toplevel asms.  */\n+  for (can = cgraph_asm_nodes; can; can = can->next)\n+    {\n+      int len = TREE_STRING_LENGTH (can->asm_str);\n+      lto_output_uleb128_stream (ob->main_stream, len);\n+      for (i = 0; i < len; ++i)\n+\tlto_output_1_stream (ob->main_stream,\n+\t\t\t     TREE_STRING_POINTER (can->asm_str)[i]);\n+    }\n+\n+  lto_output_uleb128_stream (ob->main_stream, 0);\n+\n   lto_destroy_simple_output_block (ob);\n }\n \n@@ -573,6 +586,7 @@ input_cgraph_1 (struct lto_file_decl_data *file_data,\n   VEC(cgraph_node_ptr, heap) *nodes = NULL;\n   struct cgraph_node *node;\n   unsigned i;\n+  unsigned HOST_WIDE_INT len;\n \n   tag = (enum LTO_cgraph_tags) lto_input_uleb128 (ib);\n   while (tag)\n@@ -591,6 +605,19 @@ input_cgraph_1 (struct lto_file_decl_data *file_data,\n       tag = (enum LTO_cgraph_tags) lto_input_uleb128 (ib);\n     }\n \n+  /* Input toplevel asms.  */\n+  len = lto_input_uleb128 (ib);\n+  while (len)\n+    {\n+      char *str = (char *)xmalloc (len + 1);\n+      for (i = 0; i < len; ++i)\n+\tstr[i] = lto_input_1_unsigned (ib);\n+      cgraph_add_asm_node (build_string (len, str));\n+      free (str);\n+\n+      len = lto_input_uleb128 (ib);\n+    }\n+\n   for (i = 0; VEC_iterate (cgraph_node_ptr, nodes, i, node); i++)\n     {\n       const int ref = (int) (intptr_t) node->global.inlined_to;"}, {"sha": "aa6181dd091ff577a761e83f28a22a028b87fa50", "filename": "gcc/testsuite/ChangeLog", "status": "modified", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/a9cc44581ac57b7138d7dea22fe4acc7c8a9f1ed/gcc%2Ftestsuite%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/a9cc44581ac57b7138d7dea22fe4acc7c8a9f1ed/gcc%2Ftestsuite%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2FChangeLog?ref=a9cc44581ac57b7138d7dea22fe4acc7c8a9f1ed", "patch": "@@ -1,3 +1,8 @@\n+2009-10-05  Richard Guenther  <rguenther@suse.de>\n+\n+\tPR lto/41281\n+\t* gcc.dg/lto/20090914-2_0.c: New testcase.\n+\n 2009-10-05  Richard Guenther  <rguenther@suse.de>\n \n \tPR lto/40902"}, {"sha": "f78ecf8899f2661dcbf307637e9e601f1faaf7de", "filename": "gcc/testsuite/gcc.dg/lto/20090914-2_0.c", "status": "added", "additions": 11, "deletions": 0, "changes": 11, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/a9cc44581ac57b7138d7dea22fe4acc7c8a9f1ed/gcc%2Ftestsuite%2Fgcc.dg%2Flto%2F20090914-2_0.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/a9cc44581ac57b7138d7dea22fe4acc7c8a9f1ed/gcc%2Ftestsuite%2Fgcc.dg%2Flto%2F20090914-2_0.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgcc.dg%2Flto%2F20090914-2_0.c?ref=a9cc44581ac57b7138d7dea22fe4acc7c8a9f1ed", "patch": "@@ -0,0 +1,11 @@\n+/* { dg-lto-do run { target x86_64-*-* i?86-*-* } } */\n+\n+/* Doesn't work without this dummy function with -fwhopr.  */\n+int foo(void) { }\n+\n+asm(\".text\\n\"\n+    \".globl main\\n\"\n+    \"\\t.type main,@function\\n\"\n+    \"main:\\n\"\n+    \"\\txorl %eax, %eax\\n\"\n+    \"\\tret\\n\");"}]}