{"sha": "dfa2f821c18b7e926b5f5d6e394a0c915937db5e", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6ZGZhMmY4MjFjMThiN2U5MjZiNWY1ZDZlMzk0YTBjOTE1OTM3ZGI1ZQ==", "commit": {"author": {"name": "Jerry DeLisle", "email": "jvdelisle@gcc.gnu.org", "date": "2021-02-19T20:47:54Z"}, "committer": {"name": "Jerry DeLisle", "email": "jvdelisle@gcc.gnu.org", "date": "2021-02-19T20:47:54Z"}, "message": "fortran: Object types should be declared before use in NAMELIST.\n\ngcc/fortran/ChangeLog:\n\n\tPR fortran/98686\n\t* match.c (gfc_match_namelist): If BT_UNKNOWN, check for\n\tIMPLICIT NONE and and issue an error, otherwise set the type\n\tto its IMPLICIT type so that any subsequent use of objects will\n\twill confirm their types.\n\ngcc/testsuite/ChangeLog:\n\n\tPR fortran/98686\n\t* gfortran.dg/namelist_4.f90: Modify.\n\t* gfortran.dg/namelist_98.f90: New test.", "tree": {"sha": "db8df1cf647142fab67bad6b2152187c9e158d1b", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/db8df1cf647142fab67bad6b2152187c9e158d1b"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/dfa2f821c18b7e926b5f5d6e394a0c915937db5e", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/dfa2f821c18b7e926b5f5d6e394a0c915937db5e", "html_url": "https://github.com/Rust-GCC/gccrs/commit/dfa2f821c18b7e926b5f5d6e394a0c915937db5e", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/dfa2f821c18b7e926b5f5d6e394a0c915937db5e/comments", "author": null, "committer": null, "parents": [{"sha": "d1e7e83aaf11274266d83b7be5ce013b95e8b8c2", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/d1e7e83aaf11274266d83b7be5ce013b95e8b8c2", "html_url": "https://github.com/Rust-GCC/gccrs/commit/d1e7e83aaf11274266d83b7be5ce013b95e8b8c2"}], "stats": {"total": 36, "additions": 33, "deletions": 3}, "files": [{"sha": "4d5890fd52329d523b4c1d32322caf86c3e97138", "filename": "gcc/fortran/match.c", "status": "modified", "additions": 18, "deletions": 0, "changes": 18, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/dfa2f821c18b7e926b5f5d6e394a0c915937db5e/gcc%2Ffortran%2Fmatch.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/dfa2f821c18b7e926b5f5d6e394a0c915937db5e/gcc%2Ffortran%2Fmatch.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ffortran%2Fmatch.c?ref=dfa2f821c18b7e926b5f5d6e394a0c915937db5e", "patch": "@@ -5536,6 +5536,24 @@ gfc_match_namelist (void)\n \t  if (m == MATCH_ERROR)\n \t    goto error;\n \n+\t  if (sym->ts.type == BT_UNKNOWN)\n+\t    {\n+\t      if (gfc_current_ns->seen_implicit_none)\n+\t\t{\n+\t\t  /* It is required that members of a namelist be declared\n+\t\t     before the namelist.  We check this by checking if the\n+\t\t     symbol has a defined type for IMPLICIT NONE.  */\n+\t\t  gfc_error (\"Symbol %qs in namelist %qs at %C must be \"\n+\t\t\t     \"declared before the namelist is declared.\",\n+\t\t\t     sym->name, group_name->name);\n+\t\t  gfc_error_check ();\n+\t\t}\n+\t      else\n+\t\t/* If the type is not set already, we set it here to the\n+\t\t   implicit default type.  It is not allowed to set it\n+\t\t   later to any other type.  */\n+\t\tgfc_set_default_type (sym, 0, gfc_current_ns);\n+\t    }\n \t  if (sym->attr.in_namelist == 0\n \t      && !gfc_add_in_namelist (&sym->attr, sym->name, NULL))\n \t    goto error;"}, {"sha": "e6681fd3b554207a0710c127d0750211b3df8810", "filename": "gcc/testsuite/gfortran.dg/namelist_4.f90", "status": "modified", "additions": 4, "deletions": 3, "changes": 7, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/dfa2f821c18b7e926b5f5d6e394a0c915937db5e/gcc%2Ftestsuite%2Fgfortran.dg%2Fnamelist_4.f90", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/dfa2f821c18b7e926b5f5d6e394a0c915937db5e/gcc%2Ftestsuite%2Fgfortran.dg%2Fnamelist_4.f90", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgfortran.dg%2Fnamelist_4.f90?ref=dfa2f821c18b7e926b5f5d6e394a0c915937db5e", "patch": "@@ -23,18 +23,19 @@ INTEGER FUNCTION G3()\n     G3=1\r\n   END FUNCTION\r\n END module M1\r\n- \n+\r\n program P1\r\n+implicit none\r\n CONTAINS\r\n ! This has the additional wrinkle of a reference to the object.\r\n   INTEGER FUNCTION F1()\r\n-    NAMELIST /NML3/ F2 ! { dg-error \"PROCEDURE attribute conflicts\" }\n+    NAMELIST /NML3/ F2 ! { dg-error \"PROCEDURE attribute conflicts\" }\r\n ! Used to ICE here\r\n     f2 = 1             ! { dg-error \"is not a VALUE\" }\r\n     F1=1\r\n   END FUNCTION\r\n   INTEGER FUNCTION F2()\r\n     F2=1\r\n   END FUNCTION\r\n-END\n+END\r\n \r"}, {"sha": "19a7e869f924440143ce6eea1d9b8fe75219fdac", "filename": "gcc/testsuite/gfortran.dg/namelist_98.f90", "status": "added", "additions": 11, "deletions": 0, "changes": 11, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/dfa2f821c18b7e926b5f5d6e394a0c915937db5e/gcc%2Ftestsuite%2Fgfortran.dg%2Fnamelist_98.f90", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/dfa2f821c18b7e926b5f5d6e394a0c915937db5e/gcc%2Ftestsuite%2Fgfortran.dg%2Fnamelist_98.f90", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgfortran.dg%2Fnamelist_98.f90?ref=dfa2f821c18b7e926b5f5d6e394a0c915937db5e", "patch": "@@ -0,0 +1,11 @@\n+! { dg-do compile }\n+! pr98686\n+  implicit none\n+  real    :: x, m\n+  namelist /NML/ x, m, q ! { dg-error \"must be declared before the namelist*\" }\n+  integer :: q\n+  x = 1.0\n+  m = 2.0\n+  q = 3\n+  write(*, nml=NML)\n+end"}]}