{"sha": "cf0d2c4044fb7a95db4ee80d60003590dce5b6a6", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6Y2YwZDJjNDA0NGZiN2E5NWRiNGVlODBkNjAwMDM1OTBkY2U1YjZhNg==", "commit": {"author": {"name": "Paolo Carlini", "email": "pcarlini@suse.de", "date": "2004-02-09T23:10:47Z"}, "committer": {"name": "Paolo Carlini", "email": "paolo@gcc.gnu.org", "date": "2004-02-09T23:10:47Z"}, "message": "re PR libstdc++/14071 (locale::global doesn't always call setlocale)\n\n2004-02-09  Paolo Carlini  <pcarlini@suse.de>\n\n\tPR libstdc++/14071\n\t* src/locale_init.cc (locale::global(const locale&)): Use\n\tlocale::name() in order to decide whether calling setlocale.\n\t* testsuite/22_locale/locale/global_locale_objects/14071.cc: New.\n\n\t* include/bits/locale_classes.h (locale::_Impl::_M_check_same_name()):\n\tAvoid computing &= unnecessarily.\n\nFrom-SVN: r77568", "tree": {"sha": "c36990d7f1dba6b6043233d2d75cb472a37fc044", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/c36990d7f1dba6b6043233d2d75cb472a37fc044"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/cf0d2c4044fb7a95db4ee80d60003590dce5b6a6", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/cf0d2c4044fb7a95db4ee80d60003590dce5b6a6", "html_url": "https://github.com/Rust-GCC/gccrs/commit/cf0d2c4044fb7a95db4ee80d60003590dce5b6a6", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/cf0d2c4044fb7a95db4ee80d60003590dce5b6a6/comments", "author": null, "committer": null, "parents": [{"sha": "cee63f4d4eb5f36d5059a00ddd83a99049367e2d", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/cee63f4d4eb5f36d5059a00ddd83a99049367e2d", "html_url": "https://github.com/Rust-GCC/gccrs/commit/cee63f4d4eb5f36d5059a00ddd83a99049367e2d"}], "stats": {"total": 66, "additions": 62, "deletions": 4}, "files": [{"sha": "b519c948a269861ccebb7e81cc4980dff70ac1db", "filename": "libstdc++-v3/ChangeLog", "status": "modified", "additions": 10, "deletions": 0, "changes": 10, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/cf0d2c4044fb7a95db4ee80d60003590dce5b6a6/libstdc%2B%2B-v3%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/cf0d2c4044fb7a95db4ee80d60003590dce5b6a6/libstdc%2B%2B-v3%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libstdc%2B%2B-v3%2FChangeLog?ref=cf0d2c4044fb7a95db4ee80d60003590dce5b6a6", "patch": "@@ -1,3 +1,13 @@\n+2004-02-09  Paolo Carlini  <pcarlini@suse.de>\n+\n+\tPR libstdc++/14071\n+\t* src/locale_init.cc (locale::global(const locale&)): Use\n+\tlocale::name() in order to decide whether calling setlocale.\n+\t* testsuite/22_locale/locale/global_locale_objects/14071.cc: New.\n+\n+\t* include/bits/locale_classes.h (locale::_Impl::_M_check_same_name()):\n+\tAvoid computing &= unnecessarily.\n+\n 2004-02-09  James E Wilson  <wilson@specifixinc.com>\n \n \tPR libstdc++/5625"}, {"sha": "e4f5c17780e33d3f2882adfacdad2f1ec4b11934", "filename": "libstdc++-v3/include/bits/locale_classes.h", "status": "modified", "additions": 2, "deletions": 2, "changes": 4, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/cf0d2c4044fb7a95db4ee80d60003590dce5b6a6/libstdc%2B%2B-v3%2Finclude%2Fbits%2Flocale_classes.h", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/cf0d2c4044fb7a95db4ee80d60003590dce5b6a6/libstdc%2B%2B-v3%2Finclude%2Fbits%2Flocale_classes.h", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libstdc%2B%2B-v3%2Finclude%2Fbits%2Flocale_classes.h?ref=cf0d2c4044fb7a95db4ee80d60003590dce5b6a6", "patch": "@@ -1,6 +1,6 @@\n // Locale support -*- C++ -*-\n \n-// Copyright (C) 1997, 1998, 1999, 2000, 2001, 2002, 2003\n+// Copyright (C) 1997, 1998, 1999, 2000, 2001, 2002, 2003, 2004\n // Free Software Foundation, Inc.\n //\n // This file is part of the GNU ISO C++ Library.  This library is free\n@@ -535,7 +535,7 @@ namespace std\n     {\n       bool __ret = true;\n       for (size_t __i = 0; __ret && __i < _S_categories_size - 1; ++__i)\n-\t__ret &= (std::strcmp(_M_names[__i], _M_names[__i + 1]) == 0);\n+\t__ret = std::strcmp(_M_names[__i], _M_names[__i + 1]) == 0;\n       return __ret;\n     }\n "}, {"sha": "276d68641913302b7ffed1655dfaf54c62482950", "filename": "libstdc++-v3/src/locale_init.cc", "status": "modified", "additions": 1, "deletions": 2, "changes": 3, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/cf0d2c4044fb7a95db4ee80d60003590dce5b6a6/libstdc%2B%2B-v3%2Fsrc%2Flocale_init.cc", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/cf0d2c4044fb7a95db4ee80d60003590dce5b6a6/libstdc%2B%2B-v3%2Fsrc%2Flocale_init.cc", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libstdc%2B%2B-v3%2Fsrc%2Flocale_init.cc?ref=cf0d2c4044fb7a95db4ee80d60003590dce5b6a6", "patch": "@@ -108,8 +108,7 @@ namespace std\n     _Impl* __old = _S_global;\n     __other._M_impl->_M_add_reference();\n     _S_global = __other._M_impl; \n-    if (_S_global->_M_check_same_name() \n-\t&& (std::strcmp(_S_global->_M_names[0], \"*\") != 0))\n+    if (__other.name() != \"*\")\n       setlocale(LC_ALL, __other.name().c_str());\n \n     // Reference count sanity check: one reference removed for the"}, {"sha": "7c143f4f5770ee73e23a95967a6f122bdedff014", "filename": "libstdc++-v3/testsuite/22_locale/locale/global_locale_objects/14071.cc", "status": "added", "additions": 49, "deletions": 0, "changes": 49, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/cf0d2c4044fb7a95db4ee80d60003590dce5b6a6/libstdc%2B%2B-v3%2Ftestsuite%2F22_locale%2Flocale%2Fglobal_locale_objects%2F14071.cc", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/cf0d2c4044fb7a95db4ee80d60003590dce5b6a6/libstdc%2B%2B-v3%2Ftestsuite%2F22_locale%2Flocale%2Fglobal_locale_objects%2F14071.cc", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libstdc%2B%2B-v3%2Ftestsuite%2F22_locale%2Flocale%2Fglobal_locale_objects%2F14071.cc?ref=cf0d2c4044fb7a95db4ee80d60003590dce5b6a6", "patch": "@@ -0,0 +1,49 @@\n+// 2004-02-09  Petur Runolfsson  <peturr02@ru.is>\n+\n+// Copyright (C) 2004 Free Software Foundation\n+//\n+// This file is part of the GNU ISO C++ Library.  This library is free\n+// software; you can redistribute it and/or modify it under the\n+// terms of the GNU General Public License as published by the\n+// Free Software Foundation; either version 2, or (at your option)\n+// any later version.\n+\n+// This library is distributed in the hope that it will be useful,\n+// but WITHOUT ANY WARRANTY; without even the implied warranty of\n+// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n+// GNU General Public License for more details.\n+\n+// You should have received a copy of the GNU General Public License along\n+// with this library; see the file COPYING.  If not, write to the Free\n+// Software Foundation, 59 Temple Place - Suite 330, Boston, MA 02111-1307,\n+// USA.\n+\n+// 22.1.1.5 locale static members [lib.locale.statics]\n+\n+#include <locale>\n+#include <clocale>\n+#include <testsuite_hooks.h>\n+\n+// libstdc++/14071\n+void test01()\n+{\n+  using namespace std;\n+  bool test __attribute__((unused)) = true;\n+\n+  const locale loc_is = __gnu_test::try_named_locale(\"is_IS\");\n+  const locale loc_en = __gnu_test::try_named_locale(\"en_US\");\n+\n+  const locale loc(loc_is, loc_en, locale::monetary);\n+\n+  if (loc.name() != \"*\")\n+    {\n+      locale::global(loc);\n+      VERIFY( loc.name() == setlocale(LC_ALL, NULL) );\n+    }\n+}\n+\n+int main()\n+{\n+  test01();\n+  return 0;\n+}"}]}