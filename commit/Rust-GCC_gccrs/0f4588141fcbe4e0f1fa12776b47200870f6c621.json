{"sha": "0f4588141fcbe4e0f1fa12776b47200870f6c621", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6MGY0NTg4MTQxZmNiZTRlMGYxZmExMjc3NmI0NzIwMDg3MGY2YzYyMQ==", "commit": {"author": {"name": "Jakub Jelinek", "email": "jakub@redhat.com", "date": "2021-04-22T13:08:21Z"}, "committer": {"name": "Jakub Jelinek", "email": "jakub@redhat.com", "date": "2021-04-22T13:09:58Z"}, "message": "libstdc++: Add workaround for ia32 floating atomics miscompilations [PR100184]\n\ngcc on ia32 miscompiles various atomics involving floating point,\nunfortunately I'm afraid it is too late to fix that for 11.1 and\nas I'm quite lost on it, it might take a while for 12 too\n(disabling all the 8 peephole2s would be easiest, but then we'd\nrun into optimization regressions).\n\nWhile 1.cc just FAILs, with dejagnu 1.6.1 wait_notify.cc hangs the\nmake check even after the timeout fires.  The following patch therefore\nxfails the former and skips the latter.\n\nTested on x86_64-linux where\nmake check RUNTESTFLAGS='conformance.exp=atomic_float/*.cc'\nis still\n                === libstdc++ Summary ===\n\n # of expected passes            8\nand on i686-linux, where it is now\n                === libstdc++ Summary ===\n\n # of expected passes            5\n # of expected failures          1\n # of unsupported tests          1\n\n2021-04-22  Jakub Jelinek  <jakub@redhat.com>\n\n\tPR target/100182\n\t* testsuite/29_atomics/atomic_float/1.cc: Add dg-xfail-run-if for\n\tia32.\n\t* testsuite/29_atomics/atomic_float/wait_notify.cc: Add dg-skip-if for\n\tia32.", "tree": {"sha": "ac4d22acf97b4ff95c0591bb9574c4cc538ec347", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/ac4d22acf97b4ff95c0591bb9574c4cc538ec347"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/0f4588141fcbe4e0f1fa12776b47200870f6c621", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/0f4588141fcbe4e0f1fa12776b47200870f6c621", "html_url": "https://github.com/Rust-GCC/gccrs/commit/0f4588141fcbe4e0f1fa12776b47200870f6c621", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/0f4588141fcbe4e0f1fa12776b47200870f6c621/comments", "author": {"login": "jakubjelinek", "id": 9370665, "node_id": "MDQ6VXNlcjkzNzA2NjU=", "avatar_url": "https://avatars.githubusercontent.com/u/9370665?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jakubjelinek", "html_url": "https://github.com/jakubjelinek", "followers_url": "https://api.github.com/users/jakubjelinek/followers", "following_url": "https://api.github.com/users/jakubjelinek/following{/other_user}", "gists_url": "https://api.github.com/users/jakubjelinek/gists{/gist_id}", "starred_url": "https://api.github.com/users/jakubjelinek/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jakubjelinek/subscriptions", "organizations_url": "https://api.github.com/users/jakubjelinek/orgs", "repos_url": "https://api.github.com/users/jakubjelinek/repos", "events_url": "https://api.github.com/users/jakubjelinek/events{/privacy}", "received_events_url": "https://api.github.com/users/jakubjelinek/received_events", "type": "User", "site_admin": false}, "committer": {"login": "jakubjelinek", "id": 9370665, "node_id": "MDQ6VXNlcjkzNzA2NjU=", "avatar_url": "https://avatars.githubusercontent.com/u/9370665?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jakubjelinek", "html_url": "https://github.com/jakubjelinek", "followers_url": "https://api.github.com/users/jakubjelinek/followers", "following_url": "https://api.github.com/users/jakubjelinek/following{/other_user}", "gists_url": "https://api.github.com/users/jakubjelinek/gists{/gist_id}", "starred_url": "https://api.github.com/users/jakubjelinek/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jakubjelinek/subscriptions", "organizations_url": "https://api.github.com/users/jakubjelinek/orgs", "repos_url": "https://api.github.com/users/jakubjelinek/repos", "events_url": "https://api.github.com/users/jakubjelinek/events{/privacy}", "received_events_url": "https://api.github.com/users/jakubjelinek/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "4b2db8077136d2f8b5a0db026e6161810be327b3", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/4b2db8077136d2f8b5a0db026e6161810be327b3", "html_url": "https://github.com/Rust-GCC/gccrs/commit/4b2db8077136d2f8b5a0db026e6161810be327b3"}], "stats": {"total": 2, "additions": 2, "deletions": 0}, "files": [{"sha": "797d3b7ecbe813201ce88065ff9413a068b7b07b", "filename": "libstdc++-v3/testsuite/29_atomics/atomic_float/1.cc", "status": "modified", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/0f4588141fcbe4e0f1fa12776b47200870f6c621/libstdc%2B%2B-v3%2Ftestsuite%2F29_atomics%2Fatomic_float%2F1.cc", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/0f4588141fcbe4e0f1fa12776b47200870f6c621/libstdc%2B%2B-v3%2Ftestsuite%2F29_atomics%2Fatomic_float%2F1.cc", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libstdc%2B%2B-v3%2Ftestsuite%2F29_atomics%2Fatomic_float%2F1.cc?ref=0f4588141fcbe4e0f1fa12776b47200870f6c621", "patch": "@@ -18,6 +18,7 @@\n // { dg-add-options ieee }\n // { dg-options \"-std=gnu++2a\" }\n // { dg-do run { target c++2a } }\n+// { dg-xfail-run-if \"PR100182\" { ia32 } }\n \n #include <atomic>\n #include <testsuite_hooks.h>"}, {"sha": "e0ff34dbf24d9173e20fe0a6c2445d92342fc058", "filename": "libstdc++-v3/testsuite/29_atomics/atomic_float/wait_notify.cc", "status": "modified", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/0f4588141fcbe4e0f1fa12776b47200870f6c621/libstdc%2B%2B-v3%2Ftestsuite%2F29_atomics%2Fatomic_float%2Fwait_notify.cc", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/0f4588141fcbe4e0f1fa12776b47200870f6c621/libstdc%2B%2B-v3%2Ftestsuite%2F29_atomics%2Fatomic_float%2Fwait_notify.cc", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libstdc%2B%2B-v3%2Ftestsuite%2F29_atomics%2Fatomic_float%2Fwait_notify.cc?ref=0f4588141fcbe4e0f1fa12776b47200870f6c621", "patch": "@@ -2,6 +2,7 @@\n // { dg-do run { target c++2a } }\n // { dg-require-gthreads \"\" }\n // { dg-additional-options \"-pthread\" { target pthread } }\n+// { dg-skip-if \"PR100182\" { ia32 } }\n // { dg-add-options libatomic }\n \n // Copyright (C) 2020-2021 Free Software Foundation, Inc."}]}