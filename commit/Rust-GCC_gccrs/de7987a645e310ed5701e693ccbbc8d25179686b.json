{"sha": "de7987a645e310ed5701e693ccbbc8d25179686b", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6ZGU3OTg3YTY0NWUzMTBlZDU3MDFlNjkzY2NiYmM4ZDI1MTc5Njg2Yg==", "commit": {"author": {"name": "J\"orn Rennecke", "email": "amylaar@cygnus.co.uk", "date": "1998-03-03T20:45:49Z"}, "committer": {"name": "Jeff Law", "email": "law@gcc.gnu.org", "date": "1998-03-03T20:45:49Z"}, "message": "final.c (max_labelno): New static variable.\n\n        * final.c (max_labelno): New static variable.\n        (final_scan_insn): Check max_labelno before outputting an\n        alignment for a label.\n        (shorten_branches): Remove unused variable length_align.\nFix some minor problems with new shortening code.\n\nFrom-SVN: r18390", "tree": {"sha": "f6188cbd7b5136452a061cafd98479dc96d0c06f", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/f6188cbd7b5136452a061cafd98479dc96d0c06f"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/de7987a645e310ed5701e693ccbbc8d25179686b", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/de7987a645e310ed5701e693ccbbc8d25179686b", "html_url": "https://github.com/Rust-GCC/gccrs/commit/de7987a645e310ed5701e693ccbbc8d25179686b", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/de7987a645e310ed5701e693ccbbc8d25179686b/comments", "author": null, "committer": null, "parents": [{"sha": "27d8f9ea6f7eafd14b8ec9a877b8cc2734ab2f06", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/27d8f9ea6f7eafd14b8ec9a877b8cc2734ab2f06", "html_url": "https://github.com/Rust-GCC/gccrs/commit/27d8f9ea6f7eafd14b8ec9a877b8cc2734ab2f06"}], "stats": {"total": 26, "additions": 18, "deletions": 8}, "files": [{"sha": "13166c135998fa3977a227a19a31367381934d09", "filename": "gcc/ChangeLog", "status": "modified", "additions": 8, "deletions": 0, "changes": 8, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/de7987a645e310ed5701e693ccbbc8d25179686b/gcc%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/de7987a645e310ed5701e693ccbbc8d25179686b/gcc%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2FChangeLog?ref=de7987a645e310ed5701e693ccbbc8d25179686b", "patch": "@@ -1,3 +1,11 @@\n+Tue Mar  3 21:48:35 1998  J\"orn Rennecke <amylaar@cygnus.co.uk>\n+\n+\t* final.c (max_labelno): New static variable.\n+\t(final_scan_insn): Check max_labelno before outputting an\n+\talignment for a label.\n+\n+\t(shorten_branches): Remove unused variable length_align.\n+\n Tue Mar  3 14:27:23 1998  Kaveh R. Ghazi  <ghazi@caip.rutgers.edu>\n \n \t* sparc.c (ultrasparc_adjust_cost): Add default case in"}, {"sha": "a3ad85af912eca3aab418e52c96542e55d0ba966", "filename": "gcc/final.c", "status": "modified", "additions": 10, "deletions": 8, "changes": 18, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/de7987a645e310ed5701e693ccbbc8d25179686b/gcc%2Ffinal.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/de7987a645e310ed5701e693ccbbc8d25179686b/gcc%2Ffinal.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ffinal.c?ref=de7987a645e310ed5701e693ccbbc8d25179686b", "patch": "@@ -795,7 +795,7 @@ short *label_align; /* sh.c needs this to calculate constant tables.  */\n \n #define INSN_SHUID(INSN) (uid_shuid[INSN_UID (INSN)])\n \n-static int min_labelno;\n+static int min_labelno, max_labelno;\n \n #define LABEL_TO_ALIGNMENT(LABEL) \\\n   (label_align[CODE_LABEL_NUMBER (LABEL) - min_labelno])\n@@ -932,7 +932,6 @@ shorten_branches (first)\n   rtx insn;\n   int max_uid;\n   int i;\n-  int max_labelno;\n   int max_log;\n #ifdef HAVE_ATTR_length\n #define MAX_CODE_ALIGN 16\n@@ -1079,7 +1078,6 @@ shorten_branches (first)\n     {\n       int uid = INSN_UID (seq);\n       int log;\n-      int length_align;\n       log = (GET_CODE (seq) == CODE_LABEL ? LABEL_TO_ALIGNMENT (seq) : 0);\n       uid_align[uid] = align_tab[0];\n       insn_addresses[uid] = --insn_current_address;\n@@ -2011,12 +2009,16 @@ final_scan_insn (insn, file, optimize, prescan, nopeepholes)\n       break;\n \n     case CODE_LABEL:\n-      {\n-\tint align = LABEL_TO_ALIGNMENT (insn);\n+      if (CODE_LABEL_NUMBER (insn) <= max_labelno)\n+\t{\n+\t  int align = LABEL_TO_ALIGNMENT (insn);\n \n-\tif (align && NEXT_INSN (insn))\n-\t  ASM_OUTPUT_ALIGN (file, align);\n-      }\n+\t  /* The target port might emit labels in the output function for\n+\t     some insn, e.g. sh.c output_branchy_insn.  */\n+\t  if (align && NEXT_INSN (insn)\n+\t      && CODE_LABEL_NUMBER (insn) <= max_labelno)\n+\t    ASM_OUTPUT_ALIGN (file, align);\n+\t}\n       CC_STATUS_INIT;\n       if (prescan > 0)\n \tbreak;"}]}