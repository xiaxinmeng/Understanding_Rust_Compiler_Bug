{"sha": "08ab0acf19e1447657e3f49f665b5b292dcc39db", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6MDhhYjBhY2YxOWUxNDQ3NjU3ZTNmNDlmNjY1YjViMjkyZGNjMzlkYg==", "commit": {"author": {"name": "Jakub Jelinek", "email": "jakub@redhat.com", "date": "2009-09-03T16:32:07Z"}, "committer": {"name": "Jakub Jelinek", "email": "jakub@gcc.gnu.org", "date": "2009-09-03T16:32:07Z"}, "message": "re PR debug/41238 (VTA: bootstrap failure, ICE in loc_cmp, at var-tracking.c:2456)\n\n\tPR debug/41238\n\t* function.c (assign_parm_find_stack_rtl): Don't set mem attributes on\n\tthe stack slot if it is passed by invisible reference.\n\t* var-tracking.c (vt_add_function_parameters): Handle arguments passed by\n\tinvisible reference.\n\nFrom-SVN: r151384", "tree": {"sha": "f3ec163f897ed92b319bc326b8a0d6d88496b34c", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/f3ec163f897ed92b319bc326b8a0d6d88496b34c"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/08ab0acf19e1447657e3f49f665b5b292dcc39db", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/08ab0acf19e1447657e3f49f665b5b292dcc39db", "html_url": "https://github.com/Rust-GCC/gccrs/commit/08ab0acf19e1447657e3f49f665b5b292dcc39db", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/08ab0acf19e1447657e3f49f665b5b292dcc39db/comments", "author": {"login": "jakubjelinek", "id": 9370665, "node_id": "MDQ6VXNlcjkzNzA2NjU=", "avatar_url": "https://avatars.githubusercontent.com/u/9370665?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jakubjelinek", "html_url": "https://github.com/jakubjelinek", "followers_url": "https://api.github.com/users/jakubjelinek/followers", "following_url": "https://api.github.com/users/jakubjelinek/following{/other_user}", "gists_url": "https://api.github.com/users/jakubjelinek/gists{/gist_id}", "starred_url": "https://api.github.com/users/jakubjelinek/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jakubjelinek/subscriptions", "organizations_url": "https://api.github.com/users/jakubjelinek/orgs", "repos_url": "https://api.github.com/users/jakubjelinek/repos", "events_url": "https://api.github.com/users/jakubjelinek/events{/privacy}", "received_events_url": "https://api.github.com/users/jakubjelinek/received_events", "type": "User", "site_admin": false}, "committer": null, "parents": [{"sha": "eead42e0c554eaf55bc48a864adcd537bd6e9e52", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/eead42e0c554eaf55bc48a864adcd537bd6e9e52", "html_url": "https://github.com/Rust-GCC/gccrs/commit/eead42e0c554eaf55bc48a864adcd537bd6e9e52"}], "stats": {"total": 55, "additions": 39, "deletions": 16}, "files": [{"sha": "a4e3758bf0064c1c3c6a2a39598beb117e1a9ca1", "filename": "gcc/ChangeLog", "status": "modified", "additions": 8, "deletions": 0, "changes": 8, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/08ab0acf19e1447657e3f49f665b5b292dcc39db/gcc%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/08ab0acf19e1447657e3f49f665b5b292dcc39db/gcc%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2FChangeLog?ref=08ab0acf19e1447657e3f49f665b5b292dcc39db", "patch": "@@ -1,3 +1,11 @@\n+2009-09-03  Jakub Jelinek  <jakub@redhat.com>\n+\n+\tPR debug/41238\n+\t* function.c (assign_parm_find_stack_rtl): Don't set mem attributes on\n+\tthe stack slot if it is passed by invisible reference.\n+\t* var-tracking.c (vt_add_function_parameters): Handle arguments passed by\n+\tinvisible reference.\n+\n 2009-09-03  Bernd Schmidt  <bernd.schmidt@analog.com>\n \n \t* config/bfin/linux.h (TARGET_SUPPORTS_SYNC_CALLS): Define to 1."}, {"sha": "85e2f05893282cc38fc61919d50b8d59c4d250ff", "filename": "gcc/function.c", "status": "modified", "additions": 17, "deletions": 12, "changes": 29, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/08ab0acf19e1447657e3f49f665b5b292dcc39db/gcc%2Ffunction.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/08ab0acf19e1447657e3f49f665b5b292dcc39db/gcc%2Ffunction.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ffunction.c?ref=08ab0acf19e1447657e3f49f665b5b292dcc39db", "patch": "@@ -2433,20 +2433,25 @@ assign_parm_find_stack_rtl (tree parm, struct assign_parm_data_one *data)\n     stack_parm = gen_rtx_PLUS (Pmode, stack_parm, offset_rtx);\n   stack_parm = gen_rtx_MEM (data->promoted_mode, stack_parm);\n \n-  set_mem_attributes (stack_parm, parm, 1);\n-  /* set_mem_attributes could set MEM_SIZE to the passed mode's size,\n-     while promoted mode's size is needed.  */\n-  if (data->promoted_mode != BLKmode\n-      && data->promoted_mode != DECL_MODE (parm))\n+  if (!data->passed_pointer)\n     {\n-      set_mem_size (stack_parm, GEN_INT (GET_MODE_SIZE (data->promoted_mode)));\n-      if (MEM_EXPR (stack_parm) && MEM_OFFSET (stack_parm))\n+      set_mem_attributes (stack_parm, parm, 1);\n+      /* set_mem_attributes could set MEM_SIZE to the passed mode's size,\n+\t while promoted mode's size is needed.  */\n+      if (data->promoted_mode != BLKmode\n+\t  && data->promoted_mode != DECL_MODE (parm))\n \t{\n-\t  int offset = subreg_lowpart_offset (DECL_MODE (parm),\n-\t\t\t\t\t      data->promoted_mode);\n-\t  if (offset)\n-\t    set_mem_offset (stack_parm,\n-\t\t\t    plus_constant (MEM_OFFSET (stack_parm), -offset));\n+\t  set_mem_size (stack_parm,\n+\t\t\tGEN_INT (GET_MODE_SIZE (data->promoted_mode)));\n+\t  if (MEM_EXPR (stack_parm) && MEM_OFFSET (stack_parm))\n+\t    {\n+\t      int offset = subreg_lowpart_offset (DECL_MODE (parm),\n+\t\t\t\t\t\t  data->promoted_mode);\n+\t      if (offset)\n+\t\tset_mem_offset (stack_parm,\n+\t\t\t\tplus_constant (MEM_OFFSET (stack_parm),\n+\t\t\t\t\t       -offset));\n+\t    }\n \t}\n     }\n "}, {"sha": "4d30324569ba9143edf6d67d5fa0f3dfc02ad551", "filename": "gcc/var-tracking.c", "status": "modified", "additions": 14, "deletions": 4, "changes": 18, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/08ab0acf19e1447657e3f49f665b5b292dcc39db/gcc%2Fvar-tracking.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/08ab0acf19e1447657e3f49f665b5b292dcc39db/gcc%2Fvar-tracking.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fvar-tracking.c?ref=08ab0acf19e1447657e3f49f665b5b292dcc39db", "patch": "@@ -7058,10 +7058,20 @@ vt_add_function_parameters (void)\n \n       if (!vt_get_decl_and_offset (incoming, &decl, &offset))\n \t{\n-\t  if (!vt_get_decl_and_offset (decl_rtl, &decl, &offset))\n-\t    continue;\n-\t  offset += byte_lowpart_offset (GET_MODE (incoming),\n-\t\t\t\t\t GET_MODE (decl_rtl));\n+\t  if (REG_P (incoming) || MEM_P (incoming))\n+\t    {\n+\t      /* This means argument is passed by invisible reference.  */\n+\t      offset = 0;\n+\t      decl = parm;\n+\t      incoming = gen_rtx_MEM (GET_MODE (decl_rtl), incoming);\n+\t    }\n+\t  else\n+\t    {\n+\t      if (!vt_get_decl_and_offset (decl_rtl, &decl, &offset))\n+\t\tcontinue;\n+\t      offset += byte_lowpart_offset (GET_MODE (incoming),\n+\t\t\t\t\t     GET_MODE (decl_rtl));\n+\t    }\n \t}\n \n       if (!decl)"}]}