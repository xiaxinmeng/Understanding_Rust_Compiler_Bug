{"sha": "b3d5a58b519ee457be4c5a69ef1d8b6f5bb1dae7", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6YjNkNWE1OGI1MTllZTQ1N2JlNGM1YTY5ZWYxZDhiNmY1YmIxZGFlNw==", "commit": {"author": {"name": "Jody Goldberg", "email": "jodyg@idt.net", "date": "1997-09-08T09:37:29Z"}, "committer": {"name": "Jason Merrill", "email": "jason@gcc.gnu.org", "date": "1997-09-08T09:37:29Z"}, "message": "decl.c (current_local_enum): Remove static.\n\nMon Sep  8 02:33:20 1997  Jody Goldberg  <jodyg@idt.net>\n\n\t* decl.c (current_local_enum): Remove static.\n\t* pt.c (tsubst_enum): Save and restore value of current_local_enum\n\tin case template is expanded in enum decl.\n\t(instantiate_class_template) : Use new tsubst_enum signature.\n\t(tsubst_expr): Likewise.\n\nFrom-SVN: r15156", "tree": {"sha": "2d1a50eadf42b66e125138c2250f3c3dd1aa8809", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/2d1a50eadf42b66e125138c2250f3c3dd1aa8809"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/b3d5a58b519ee457be4c5a69ef1d8b6f5bb1dae7", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/b3d5a58b519ee457be4c5a69ef1d8b6f5bb1dae7", "html_url": "https://github.com/Rust-GCC/gccrs/commit/b3d5a58b519ee457be4c5a69ef1d8b6f5bb1dae7", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/b3d5a58b519ee457be4c5a69ef1d8b6f5bb1dae7/comments", "author": null, "committer": null, "parents": [{"sha": "786b5245966e3e9b710015ce7fd28992391d891b", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/786b5245966e3e9b710015ce7fd28992391d891b", "html_url": "https://github.com/Rust-GCC/gccrs/commit/786b5245966e3e9b710015ce7fd28992391d891b"}], "stats": {"total": 28, "additions": 22, "deletions": 6}, "files": [{"sha": "0bd033ff4789ebc6f2a7a071f1809c6a0fe5ba9d", "filename": "gcc/cp/ChangeLog", "status": "modified", "additions": 8, "deletions": 0, "changes": 8, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/b3d5a58b519ee457be4c5a69ef1d8b6f5bb1dae7/gcc%2Fcp%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/b3d5a58b519ee457be4c5a69ef1d8b6f5bb1dae7/gcc%2Fcp%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fcp%2FChangeLog?ref=b3d5a58b519ee457be4c5a69ef1d8b6f5bb1dae7", "patch": "@@ -1,3 +1,11 @@\n+Mon Sep  8 02:33:20 1997  Jody Goldberg  <jodyg@idt.net>\n+\n+\t* decl.c (current_local_enum): Remove static.\n+\t* pt.c (tsubst_enum): Save and restore value of current_local_enum\n+\tin case template is expanded in enum decl.\n+\t(instantiate_class_template) : Use new tsubst_enum signature.\n+\t(tsubst_expr): Likewise.\n+\n Mon Sep  8 01:21:43 1997  Mark Mitchell  <mmitchell@usa.net>\n \n \t* pt.c (begin_member_template_processing): Take a function as"}, {"sha": "3543ddd331c3f1978a9e7a776bc599416fde8383", "filename": "gcc/cp/decl.c", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/b3d5a58b519ee457be4c5a69ef1d8b6f5bb1dae7/gcc%2Fcp%2Fdecl.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/b3d5a58b519ee457be4c5a69ef1d8b6f5bb1dae7/gcc%2Fcp%2Fdecl.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fcp%2Fdecl.c?ref=b3d5a58b519ee457be4c5a69ef1d8b6f5bb1dae7", "patch": "@@ -10797,7 +10797,7 @@ xref_basetypes (code_type_node, name, ref, binfo)\n }\n   \n \f\n-static tree current_local_enum = NULL_TREE;\n+tree current_local_enum = NULL_TREE;\n \n /* Begin compiling the definition of an enumeration type.\n    NAME is its name (or null if anonymous)."}, {"sha": "88af38bdc0ea51365b7f6ee432b8085b90bbd08a", "filename": "gcc/cp/pt.c", "status": "modified", "additions": 13, "deletions": 5, "changes": 18, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/b3d5a58b519ee457be4c5a69ef1d8b6f5bb1dae7/gcc%2Fcp%2Fpt.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/b3d5a58b519ee457be4c5a69ef1d8b6f5bb1dae7/gcc%2Fcp%2Fpt.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fcp%2Fpt.c?ref=b3d5a58b519ee457be4c5a69ef1d8b6f5bb1dae7", "patch": "@@ -76,7 +76,7 @@ static int comp_template_args PROTO((tree, tree));\n static int list_eq PROTO((tree, tree));\n static tree get_class_bindings PROTO((tree, tree, tree));\n static tree coerce_template_parms PROTO((tree, tree, tree));\n-static tree tsubst_enum\tPROTO((tree, tree, int));\n+static tree tsubst_enum\tPROTO((tree, tree, int, tree *));\n static tree add_to_template_args PROTO((tree, tree));\n \n /* Restore the template parameter context. */\n@@ -1450,9 +1450,8 @@ instantiate_class_template (type)\n       if (TREE_CODE (tag) == ENUMERAL_TYPE)\n \t{\n \t  tree e, newtag = tsubst_enum (tag, args, \n-\t\t\t\t\tTREE_VEC_LENGTH (args));\n+\t\t\t\t\tTREE_VEC_LENGTH (args), field_chain);\n \n-\t  *field_chain = grok_enum_decls (newtag, NULL_TREE);\n \t  while (*field_chain)\n \t    {\n \t      DECL_FIELD_CONTEXT (*field_chain) = type;\n@@ -2840,7 +2839,7 @@ tsubst_expr (t, args, nargs, in_decl)\n       lineno = TREE_COMPLEXITY (t);\n       t = TREE_TYPE (t);\n       if (TREE_CODE (t) == ENUMERAL_TYPE)\n-\ttsubst_enum (t, args, nargs);\n+\ttsubst_enum (t, args, nargs, NULL);\n       break;\n \n     default:\n@@ -4053,10 +4052,14 @@ add_maybe_template (d, fns)\n    tsubst_expr.  */\n \n static tree\n-tsubst_enum (tag, args, nargs)\n+tsubst_enum (tag, args, nargs, field_chain)\n      tree tag, args;\n      int nargs;\n+     tree * field_chain;\n {\n+  extern tree current_local_enum;\n+  tree prev_local_enum = current_local_enum;\n+\n   tree newtag = start_enum (TYPE_IDENTIFIER (tag));\n   tree e, values = NULL_TREE;\n \n@@ -4071,5 +4074,10 @@ tsubst_enum (tag, args, nargs)\n \n   finish_enum (newtag, values);\n \n+  if (NULL != field_chain)\n+    *field_chain = grok_enum_decls (newtag, NULL_TREE);\n+\n+  current_local_enum = prev_local_enum;\n+\n   return newtag;\n }"}]}