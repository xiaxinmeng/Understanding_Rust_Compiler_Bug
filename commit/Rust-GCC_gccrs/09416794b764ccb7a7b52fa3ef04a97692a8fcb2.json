{"sha": "09416794b764ccb7a7b52fa3ef04a97692a8fcb2", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6MDk0MTY3OTRiNzY0Y2NiN2E3YjUyZmEzZWYwNGE5NzY5MmE4ZmNiMg==", "commit": {"author": {"name": "Danny Smith", "email": "dannysmith@users.sourceforge.net", "date": "2006-08-20T08:46:13Z"}, "committer": {"name": "Danny Smith", "email": "dannysmith@gcc.gnu.org", "date": "2006-08-20T08:46:13Z"}, "message": "PR target/28648 c:\n\n\t* tree.c (handle_dll_attribute): Return early if not a\n   \tvar or function decl.\n\ntestsuite\n\t* gcc.dg/attr-invalid.c: Add tests for invalid dllimport.\n\nFrom-SVN: r116270", "tree": {"sha": "26a4e207b3099822df6d3fef23730184c651c6b8", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/26a4e207b3099822df6d3fef23730184c651c6b8"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/09416794b764ccb7a7b52fa3ef04a97692a8fcb2", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/09416794b764ccb7a7b52fa3ef04a97692a8fcb2", "html_url": "https://github.com/Rust-GCC/gccrs/commit/09416794b764ccb7a7b52fa3ef04a97692a8fcb2", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/09416794b764ccb7a7b52fa3ef04a97692a8fcb2/comments", "author": null, "committer": null, "parents": [{"sha": "3e978d3094f29abe03d271d63cdc16930c5e51de", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/3e978d3094f29abe03d271d63cdc16930c5e51de", "html_url": "https://github.com/Rust-GCC/gccrs/commit/3e978d3094f29abe03d271d63cdc16930c5e51de"}], "stats": {"total": 43, "additions": 42, "deletions": 1}, "files": [{"sha": "6104ecda4f843e3bf449c501434f0a6ae1b5dfde", "filename": "gcc/ChangeLog", "status": "modified", "additions": 6, "deletions": 0, "changes": 6, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/09416794b764ccb7a7b52fa3ef04a97692a8fcb2/gcc%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/09416794b764ccb7a7b52fa3ef04a97692a8fcb2/gcc%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2FChangeLog?ref=09416794b764ccb7a7b52fa3ef04a97692a8fcb2", "patch": "@@ -1,3 +1,9 @@\n+006-08-20  Danny Smith  <dannysmith@users.sourceforge.net>\n+\n+\tPR target/28648 c:\n+\t* tree.c (handle_dll_attribute): Return early if not a\n+   \tvar or function decl.\n+\n 2006-08-18  Joseph Myers  <joseph@codesourcery.com>\n \n \tPR target/27565"}, {"sha": "abaa9b7f8569dfdbeb0d8e4cbe8dcd4e4dd7b6be", "filename": "gcc/testsuite/ChangeLog", "status": "modified", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/09416794b764ccb7a7b52fa3ef04a97692a8fcb2/gcc%2Ftestsuite%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/09416794b764ccb7a7b52fa3ef04a97692a8fcb2/gcc%2Ftestsuite%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2FChangeLog?ref=09416794b764ccb7a7b52fa3ef04a97692a8fcb2", "patch": "@@ -1,3 +1,8 @@\n+2006-08-20  Danny Smith  <dannysmith@users.sourceforge.net>\n+\n+\tPR target/28648 c:\n+\t* gcc.dg/attr-invalid.c: Add tests for invalid dllimport.\n+\n 2006-08-20  Paul Thomas  <pault@gcc.gnu.org>\n \n \tPR fortran/28630"}, {"sha": "7d1c151969b443ad8b4e4a0ec0c9deb1e95f29ce", "filename": "gcc/testsuite/gcc.dg/attr-invalid.c", "status": "modified", "additions": 21, "deletions": 0, "changes": 21, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/09416794b764ccb7a7b52fa3ef04a97692a8fcb2/gcc%2Ftestsuite%2Fgcc.dg%2Fattr-invalid.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/09416794b764ccb7a7b52fa3ef04a97692a8fcb2/gcc%2Ftestsuite%2Fgcc.dg%2Fattr-invalid.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgcc.dg%2Fattr-invalid.c?ref=09416794b764ccb7a7b52fa3ef04a97692a8fcb2", "patch": "@@ -77,3 +77,24 @@ int ATSYM(fn_knrarg) (arg)\n { return 0; }\n \n int ATSYM(fn_isoarg) (int arg ATTR) { return 0; } /* { dg-warning \"attribute ignored\" \"\" } */\n+\n+\n+/* PR target/28648  */\n+/* These are invalid on all targets.  Applying to PARM_ or FIELD_DECL\n+   also caused a tree checking ice on targets that support dllimport.  */\n+#undef AT\n+#define AT dllimport\n+\n+typedef int ATSYM(type) ATTR; /* { dg-warning \"attribute ignored\" \"\" } */\n+\n+typedef int (*ATSYM(fntype))(void) ATTR; /* { dg-warning \"attribute ignored\" \"\" } */\n+\n+struct ATSYM(struct) {\n+  char dummy ATTR; /* { dg-warning \"attribute ignored\" \"\" } */\n+};\n+\n+int ATSYM(fn_knrarg) (arg)\n+  int arg ATTR; /* { dg-warning \"attribute ignored\" \"\" } */\n+{ return 0; }\n+\n+int ATSYM(fn_isoarg) (int arg ATTR) { return 0; } /* { dg-warning \"attribute ignored\" \"\" } */"}, {"sha": "a58c3274c4bf0db876d3feadd315ea282c62f975", "filename": "gcc/tree.c", "status": "modified", "additions": 10, "deletions": 1, "changes": 11, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/09416794b764ccb7a7b52fa3ef04a97692a8fcb2/gcc%2Ftree.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/09416794b764ccb7a7b52fa3ef04a97692a8fcb2/gcc%2Ftree.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftree.c?ref=09416794b764ccb7a7b52fa3ef04a97692a8fcb2", "patch": "@@ -3706,9 +3706,18 @@ handle_dll_attribute (tree * pnode, tree name, tree args, int flags,\n       return NULL_TREE;\n     }\n \n+  if (TREE_CODE (node) != FUNCTION_DECL\n+      && TREE_CODE (node) != VAR_DECL)\n+    {\n+      *no_add_attrs = true;\n+      warning (OPT_Wattributes, \"%qs attribute ignored\",\n+\t       IDENTIFIER_POINTER (name));\n+      return NULL_TREE;\n+    }\n+\n   /* Report error on dllimport ambiguities seen now before they cause\n      any damage.  */\n-  if (is_attribute_p (\"dllimport\", name))\n+  else if (is_attribute_p (\"dllimport\", name))\n     {\n       /* Honor any target-specific overrides. */ \n       if (!targetm.valid_dllimport_attribute_p (node))"}]}