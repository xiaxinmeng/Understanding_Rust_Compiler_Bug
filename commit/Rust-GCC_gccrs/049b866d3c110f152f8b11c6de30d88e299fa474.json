{"sha": "049b866d3c110f152f8b11c6de30d88e299fa474", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6MDQ5Yjg2NmQzYzExMGYxNTJmOGIxMWM2ZGUzMGQ4OGUyOTlmYTQ3NA==", "commit": {"author": {"name": "Sebastian Perta", "email": "sebastian.perta@renesas.com", "date": "2018-01-22T13:53:48Z"}, "committer": {"name": "Sebastian Perta", "email": "sebastianperta@gcc.gnu.org", "date": "2018-01-22T13:53:48Z"}, "message": "rl78.c (rl78_note_reg_set): fixed dead reg check for non-QImode registers\n\n2018-01-12  Sebastian Perta  <sebastian.perta@renesas.com>\n\t\n\t* config/rl78/rl78.c (rl78_note_reg_set): fixed dead reg check \n\tfor non-QImode registers\n\nFrom-SVN: r256945", "tree": {"sha": "736718f06723b1908aed2e8407c459fa5217244f", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/736718f06723b1908aed2e8407c459fa5217244f"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/049b866d3c110f152f8b11c6de30d88e299fa474", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/049b866d3c110f152f8b11c6de30d88e299fa474", "html_url": "https://github.com/Rust-GCC/gccrs/commit/049b866d3c110f152f8b11c6de30d88e299fa474", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/049b866d3c110f152f8b11c6de30d88e299fa474/comments", "author": null, "committer": null, "parents": [{"sha": "6b271a2ec41ac5eb9331a7c5857e3719c9a24ef4", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/6b271a2ec41ac5eb9331a7c5857e3719c9a24ef4", "html_url": "https://github.com/Rust-GCC/gccrs/commit/6b271a2ec41ac5eb9331a7c5857e3719c9a24ef4"}], "stats": {"total": 16, "additions": 13, "deletions": 3}, "files": [{"sha": "17f22767582bff6c43fb50c7dac4d526efca7445", "filename": "gcc/ChangeLog", "status": "modified", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/049b866d3c110f152f8b11c6de30d88e299fa474/gcc%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/049b866d3c110f152f8b11c6de30d88e299fa474/gcc%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2FChangeLog?ref=049b866d3c110f152f8b11c6de30d88e299fa474", "patch": "@@ -1,3 +1,8 @@\n+2018-01-22  Sebastian Perta  <sebastian.perta@renesas.com>\n+\t\n+\t* config/rl78/rl78.c (rl78_note_reg_set): fixed dead reg check \n+\tfor non-QImode registers\n+\n 2018-01-22  Richard Biener  <rguenther@suse.de>\n \n \tPR tree-optimization/83963"}, {"sha": "3e34a88f0b797173ee9d9562251e18c3c1df9167", "filename": "gcc/config/rl78/rl78.c", "status": "modified", "additions": 8, "deletions": 3, "changes": 11, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/049b866d3c110f152f8b11c6de30d88e299fa474/gcc%2Fconfig%2Frl78%2Frl78.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/049b866d3c110f152f8b11c6de30d88e299fa474/gcc%2Fconfig%2Frl78%2Frl78.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fconfig%2Frl78%2Frl78.c?ref=049b866d3c110f152f8b11c6de30d88e299fa474", "patch": "@@ -3792,16 +3792,21 @@ static void\n rl78_note_reg_set (char *dead, rtx d, rtx insn)\n {\n   int r, i;\n-\n+  bool is_dead;\n   if (GET_CODE (d) == MEM)\n     rl78_note_reg_uses (dead, XEXP (d, 0), insn);\n \n   if (GET_CODE (d) != REG)\n     return;\n \n+  /* Do not mark the reg unused unless all QImode parts of it are dead.  */\n   r = REGNO (d);\n-  if (dead [r])\n-    add_reg_note (insn, REG_UNUSED, gen_rtx_REG (GET_MODE (d), r));\n+  is_dead = true;\n+  for (i = 0; i < GET_MODE_SIZE (GET_MODE (d)); i ++)\n+\t  if (!dead [r + i])\n+\t\t  is_dead = false;\n+  if(is_dead)\n+\tadd_reg_note (insn, REG_UNUSED, gen_rtx_REG (GET_MODE (d), r));\n   if (dump_file)\n     fprintf (dump_file, \"note set reg %d size %d\\n\", r, GET_MODE_SIZE (GET_MODE (d)));\n   for (i = 0; i < GET_MODE_SIZE (GET_MODE (d)); i ++)"}]}