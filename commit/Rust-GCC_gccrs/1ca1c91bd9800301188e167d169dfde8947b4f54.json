{"sha": "1ca1c91bd9800301188e167d169dfde8947b4f54", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6MWNhMWM5MWJkOTgwMDMwMTE4OGUxNjdkMTY5ZGZkZTg5NDdiNGY1NA==", "commit": {"author": {"name": "Tom Tromey", "email": "tromey@redhat.com", "date": "2001-12-11T04:03:57Z"}, "committer": {"name": "Tom Tromey", "email": "tromey@gcc.gnu.org", "date": "2001-12-11T04:03:57Z"}, "message": "For PR libgcj/1147:\n\n\t* prims.cc (JvConvertArgv): Convert using current locale's\n\tencoding.\n\nFrom-SVN: r47862", "tree": {"sha": "f0bd1b8b42ebddf95297eedc5da2982e2d850812", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/f0bd1b8b42ebddf95297eedc5da2982e2d850812"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/1ca1c91bd9800301188e167d169dfde8947b4f54", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/1ca1c91bd9800301188e167d169dfde8947b4f54", "html_url": "https://github.com/Rust-GCC/gccrs/commit/1ca1c91bd9800301188e167d169dfde8947b4f54", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/1ca1c91bd9800301188e167d169dfde8947b4f54/comments", "author": null, "committer": null, "parents": [{"sha": "d12a187337e82450144973ddd957287408318050", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/d12a187337e82450144973ddd957287408318050", "html_url": "https://github.com/Rust-GCC/gccrs/commit/d12a187337e82450144973ddd957287408318050"}], "stats": {"total": 22, "additions": 18, "deletions": 4}, "files": [{"sha": "227bcc121961e4746d6f5f6fbbe3c580e488c9ba", "filename": "libjava/ChangeLog", "status": "modified", "additions": 6, "deletions": 0, "changes": 6, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/1ca1c91bd9800301188e167d169dfde8947b4f54/libjava%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/1ca1c91bd9800301188e167d169dfde8947b4f54/libjava%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libjava%2FChangeLog?ref=1ca1c91bd9800301188e167d169dfde8947b4f54", "patch": "@@ -1,3 +1,9 @@\n+2001-12-10  Tom Tromey  <tromey@redhat.com>\n+\n+\tFor PR libgcj/1147:\n+\t* prims.cc (JvConvertArgv): Convert using current locale's\n+\tencoding.\n+\n 2001-12-10  Tom Tromey  <tromey@redhat.com>\n \n \tFix for PR libgcj/5064."}, {"sha": "5a4c3a6cbd85c3a89d9ebc64222b930394f18294", "filename": "libjava/prims.cc", "status": "modified", "additions": 12, "deletions": 4, "changes": 16, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/1ca1c91bd9800301188e167d169dfde8947b4f54/libjava%2Fprims.cc", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/1ca1c91bd9800301188e167d169dfde8947b4f54/libjava%2Fprims.cc", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libjava%2Fprims.cc?ref=1ca1c91bd9800301188e167d169dfde8947b4f54", "patch": "@@ -657,12 +657,20 @@ JvConvertArgv (int argc, const char **argv)\n   if (argc < 0)\n     argc = 0;\n   jobjectArray ar = JvNewObjectArray(argc, &StringClass, NULL);\n-  jobject* ptr = elements(ar);\n+  jobject *ptr = elements(ar);\n+  jbyteArray bytes = NULL;\n   for (int i = 0;  i < argc;  i++)\n     {\n       const char *arg = argv[i];\n-      // FIXME - should probably use JvNewStringUTF.\n-      *ptr++ = JvNewStringLatin1(arg, strlen(arg));\n+      int len = strlen (arg);\n+      if (bytes == NULL || bytes->length < len)\n+\tbytes = JvNewByteArray (len);\n+      jbyte *bytePtr = elements (bytes);\n+      // We assume jbyte == char.\n+      memcpy (bytePtr, arg, len);\n+\n+      // Now convert using the default encoding.\n+      *ptr++ = new java::lang::String (bytes, 0, len);\n     }\n   return (JArray<jstring>*) ar;\n }\n@@ -993,7 +1001,7 @@ _Jv_RunMain (jclass klass, const char *name, int argc, const char **argv,\n       runtime = java::lang::Runtime::getRuntime ();\n \n       arg_vec = JvConvertArgv (argc - 1, argv + 1);\n-      \n+\n       if (klass)\n \tmain_thread = new gnu::gcj::runtime::FirstThread (klass, arg_vec);\n       else"}]}