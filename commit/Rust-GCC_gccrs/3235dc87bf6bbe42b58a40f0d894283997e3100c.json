{"sha": "3235dc87bf6bbe42b58a40f0d894283997e3100c", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6MzIzNWRjODdiZjZiYmU0MmI1OGE0MGYwZDg5NDI4Mzk5N2UzMTAwYw==", "commit": {"author": {"name": "Arnaud Charlet", "email": "charlet@gcc.gnu.org", "date": "2012-06-12T10:12:40Z"}, "committer": {"name": "Arnaud Charlet", "email": "charlet@gcc.gnu.org", "date": "2012-06-12T10:12:40Z"}, "message": "[multiple changes]\n\n2012-06-12  Hristian Kirtchev  <kirtchev@adacore.com>\n\n\t* exp_ch7.adb (Create_Finalizer): Add the\n\texception reraise mechanism at the very end of the finalizer\n\tstatements. This placement ensures that all objects are finalized,\n\tthe secondary stack mark released and aborts undeferred before\n\tpropagating an exception.\n\n2012-06-12  Ed Schonberg  <schonberg@adacore.com>\n\n\t* sem_ch10.adb (Remove_Unit_From_Visibility): if the unit is a\n\twrapper package. remove from visibility the original subprogram\n\tinstance.\n\n2012-06-12  Javier Miranda  <miranda@adacore.com>\n\n\t* sem_prag.adb (Process_Convention): Generate reference to entity\n\texported to foreign language. Needed for GPS navigation.\n\t* xref_lib.adb (Parse_Identifier_Info): Parse exported entities.\n\t* lib-xref (Output_References): Output exported entities.\n\n2012-06-12  Pascal Obry  <obry@adacore.com>\n\n\t* prj-attr.adb: Add install package and corresponding attributes.\n\t* snames.ads-tmpl (Name_Active): New constant.\n\t(Name_Exec_Subdir): Likewise.\n\t(Name_Install): Likewise.\n\t(Name_Lib_Subdir): Likewise.\n\t(Name_Project_Subdir): Likewise.\n\t(Name_Sources_Subdir): Likewise.\n\n2012-06-12  Bob Duff  <duff@adacore.com>\n\n\t* sem_res.adb (Check_Infinite_Recursion):\n\tSuppress spurious warning on recursion after \"raise with ...\".\n\nFrom-SVN: r188438", "tree": {"sha": "89eee6cf718fed8243d56f373857da26fb54ad6d", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/89eee6cf718fed8243d56f373857da26fb54ad6d"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/3235dc87bf6bbe42b58a40f0d894283997e3100c", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/3235dc87bf6bbe42b58a40f0d894283997e3100c", "html_url": "https://github.com/Rust-GCC/gccrs/commit/3235dc87bf6bbe42b58a40f0d894283997e3100c", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/3235dc87bf6bbe42b58a40f0d894283997e3100c/comments", "author": null, "committer": null, "parents": [{"sha": "83bb90af7af5df4179c85586409efe342d655b90", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/83bb90af7af5df4179c85586409efe342d655b90", "html_url": "https://github.com/Rust-GCC/gccrs/commit/83bb90af7af5df4179c85586409efe342d655b90"}], "stats": {"total": 128, "additions": 103, "deletions": 25}, "files": [{"sha": "8ffc81c6b8d8c4bebc28a6a219088f1982a6f7cd", "filename": "gcc/ada/ChangeLog", "status": "modified", "additions": 36, "deletions": 0, "changes": 36, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/3235dc87bf6bbe42b58a40f0d894283997e3100c/gcc%2Fada%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/3235dc87bf6bbe42b58a40f0d894283997e3100c/gcc%2Fada%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fada%2FChangeLog?ref=3235dc87bf6bbe42b58a40f0d894283997e3100c", "patch": "@@ -1,3 +1,39 @@\n+2012-06-12  Hristian Kirtchev  <kirtchev@adacore.com>\n+\n+\t* exp_ch7.adb (Create_Finalizer): Add the\n+\texception reraise mechanism at the very end of the finalizer\n+\tstatements. This placement ensures that all objects are finalized,\n+\tthe secondary stack mark released and aborts undeferred before\n+\tpropagating an exception.\n+\n+2012-06-12  Ed Schonberg  <schonberg@adacore.com>\n+\n+\t* sem_ch10.adb (Remove_Unit_From_Visibility): if the unit is a\n+\twrapper package. remove from visibility the original subprogram\n+\tinstance.\n+\n+2012-06-12  Javier Miranda  <miranda@adacore.com>\n+\n+\t* sem_prag.adb (Process_Convention): Generate reference to entity\n+\texported to foreign language. Needed for GPS navigation.\n+\t* xref_lib.adb (Parse_Identifier_Info): Parse exported entities.\n+\t* lib-xref (Output_References): Output exported entities.\n+\n+2012-06-12  Pascal Obry  <obry@adacore.com>\n+\n+\t* prj-attr.adb: Add install package and corresponding attributes.\n+\t* snames.ads-tmpl (Name_Active): New constant.\n+\t(Name_Exec_Subdir): Likewise.\n+\t(Name_Install): Likewise.\n+\t(Name_Lib_Subdir): Likewise.\n+\t(Name_Project_Subdir): Likewise.\n+\t(Name_Sources_Subdir): Likewise.\n+\n+2012-06-12  Bob Duff  <duff@adacore.com>\n+\n+\t* sem_res.adb (Check_Infinite_Recursion):\n+\tSuppress spurious warning on recursion after \"raise with ...\".\n+\n 2012-06-12  Thomas Quinot  <quinot@adacore.com>\n \n \t* sem_prag.adb (Analyze_Pragma, case Unchecked_Union): Do"}, {"sha": "f42cb814202692b0c4c68d2635e456273091ff1b", "filename": "gcc/ada/exp_ch7.adb", "status": "modified", "additions": 17, "deletions": 14, "changes": 31, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/3235dc87bf6bbe42b58a40f0d894283997e3100c/gcc%2Fada%2Fexp_ch7.adb", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/3235dc87bf6bbe42b58a40f0d894283997e3100c/gcc%2Fada%2Fexp_ch7.adb", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fada%2Fexp_ch7.adb?ref=3235dc87bf6bbe42b58a40f0d894283997e3100c", "patch": "@@ -1490,20 +1490,6 @@ package body Exp_Ch7 is\n \n             Append_To (Finalizer_Stmts, Label);\n \n-            --  The local exception does not need to be reraised for library-\n-            --  level finalizers. Generate:\n-            --\n-            --    if Raised and then not Abort then\n-            --       Raise_From_Controlled_Operation (E);\n-            --    end if;\n-\n-            if not For_Package\n-              and then Exceptions_OK\n-            then\n-               Append_To (Finalizer_Stmts,\n-                 Build_Raise_Statement (Finalizer_Data));\n-            end if;\n-\n             --  Create the jump block which controls the finalization flow\n             --  depending on the value of the state counter.\n \n@@ -1570,6 +1556,22 @@ package body Exp_Ch7 is\n                 Name => New_Reference_To (RTE (RE_Abort_Undefer), Loc)));\n          end if;\n \n+         --  The local exception does not need to be reraised for library-level\n+         --  finalizers. Note that this action must be carried out after object\n+         --  clean up, secondary stack release and abort undeferral. Generate:\n+\n+         --    if Raised and then not Abort then\n+         --       Raise_From_Controlled_Operation (E);\n+         --    end if;\n+\n+         if Has_Ctrl_Objs\n+           and then Exceptions_OK\n+           and then not For_Package\n+         then\n+            Append_To (Finalizer_Stmts,\n+              Build_Raise_Statement (Finalizer_Data));\n+         end if;\n+\n          --  Generate:\n          --    procedure Fin_Id is\n          --       Abort  : constant Boolean := Triggered_By_Abort;\n@@ -1590,6 +1592,7 @@ package body Exp_Ch7 is\n          --       <finalization statements>  --  Added if Has_Ctrl_Objs\n          --       <stack release>            --  Added if Mark_Id exists\n          --       Abort_Undefer;             --  Added if abort is allowed\n+         --       <exception propagation>    --  Added if Has_Ctrl_Objs\n          --    end Fin_Id;\n \n          --  Create the body of the finalizer"}, {"sha": "692752944ca73b8e26d73376285b3453cbd74c95", "filename": "gcc/ada/lib-xref.adb", "status": "modified", "additions": 7, "deletions": 5, "changes": 12, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/3235dc87bf6bbe42b58a40f0d894283997e3100c/gcc%2Fada%2Flib-xref.adb", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/3235dc87bf6bbe42b58a40f0d894283997e3100c/gcc%2Fada%2Flib-xref.adb", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fada%2Flib-xref.adb?ref=3235dc87bf6bbe42b58a40f0d894283997e3100c", "patch": "@@ -2441,11 +2441,13 @@ package body Lib.Xref is\n                        (Int (Get_Logical_Line_Number (XE.Key.Loc)));\n                      Write_Info_Char (XE.Key.Typ);\n \n-                     if Is_Overloadable (XE.Key.Ent)\n-                       and then Is_Imported (XE.Key.Ent)\n-                       and then XE.Key.Typ = 'b'\n-                     then\n-                        Output_Import_Export_Info (XE.Key.Ent);\n+                     if Is_Overloadable (XE.Key.Ent) then\n+                        if (Is_Imported (XE.Key.Ent) and then XE.Key.Typ = 'b')\n+                          or else\n+                           (Is_Exported (XE.Key.Ent) and then XE.Key.Typ = 'i')\n+                        then\n+                           Output_Import_Export_Info (XE.Key.Ent);\n+                        end if;\n                      end if;\n \n                      Write_Info_Nat (Int (Get_Column_Number (XE.Key.Loc)));"}, {"sha": "0321533fc18e2ce9caca1588385a607ccda4984e", "filename": "gcc/ada/prj-attr.adb", "status": "modified", "additions": 10, "deletions": 0, "changes": 10, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/3235dc87bf6bbe42b58a40f0d894283997e3100c/gcc%2Fada%2Fprj-attr.adb", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/3235dc87bf6bbe42b58a40f0d894283997e3100c/gcc%2Fada%2Fprj-attr.adb", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fada%2Fprj-attr.adb?ref=3235dc87bf6bbe42b58a40f0d894283997e3100c", "patch": "@@ -351,6 +351,16 @@ package body Prj.Attr is\n    \"SVvcs_log_check#\" &\n    \"SVdocumentation_dir#\" &\n \n+   --  package Install\n+\n+   \"Pinstall#\" &\n+   \"SVprefix#\" &\n+   \"SVsources_subdir#\" &\n+   \"SVexec_subdir#\" &\n+   \"SVlib_subdir#\" &\n+   \"SVproject_subdir#\" &\n+   \"SVactive#\" &\n+\n    --  package Stack\n \n    \"Pstack#\" &"}, {"sha": "be79b34b2729efdfad842d0a3885e2a5af405ab5", "filename": "gcc/ada/sem_ch10.adb", "status": "modified", "additions": 7, "deletions": 0, "changes": 7, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/3235dc87bf6bbe42b58a40f0d894283997e3100c/gcc%2Fada%2Fsem_ch10.adb", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/3235dc87bf6bbe42b58a40f0d894283997e3100c/gcc%2Fada%2Fsem_ch10.adb", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fada%2Fsem_ch10.adb?ref=3235dc87bf6bbe42b58a40f0d894283997e3100c", "patch": "@@ -6211,6 +6211,13 @@ package body Sem_Ch10 is\n \n       Set_Is_Potentially_Use_Visible (Unit_Name, False);\n       Set_Is_Immediately_Visible     (Unit_Name, False);\n+\n+      --  If the unit is a wrapper package, the subprogram instance is\n+      --  what must be removed from visibility.\n+\n+      if Is_Wrapper_Package (Unit_Name) then\n+         Set_Is_Immediately_Visible (Current_Entity (Unit_Name), False);\n+      end if;\n    end Remove_Unit_From_Visibility;\n \n    --------"}, {"sha": "2b038fa51c9d7e4963d4d3308135d51097b5665c", "filename": "gcc/ada/sem_prag.adb", "status": "modified", "additions": 12, "deletions": 1, "changes": 13, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/3235dc87bf6bbe42b58a40f0d894283997e3100c/gcc%2Fada%2Fsem_prag.adb", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/3235dc87bf6bbe42b58a40f0d894283997e3100c/gcc%2Fada%2Fsem_prag.adb", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fada%2Fsem_prag.adb?ref=3235dc87bf6bbe42b58a40f0d894283997e3100c", "patch": "@@ -3655,10 +3655,21 @@ package body Sem_Prag is\n             Comp_Unit := Get_Source_Unit (E);\n             Set_Convention_From_Pragma (E);\n \n-            --  Treat a pragma Import as an implicit body, for GPS use\n+            --  Treat a pragma Import as an implicit body, and pragma import\n+            --  as implicit reference (for navigation in GPS).\n \n             if Prag_Id = Pragma_Import then\n                Generate_Reference (E, Id, 'b');\n+\n+            --  For exported entities we restrict the generation of references\n+            --  to entities exported to foreign languages since entities\n+            --  exported to Ada do not provide further information to GPS and\n+            --  add undesired references to the output of the gnatxref tool.\n+\n+            elsif Prag_Id = Pragma_Export\n+              and then Convention (E) /= Convention_Ada\n+            then\n+               Generate_Reference (E, Id, 'i');\n             end if;\n \n             --  Loop through the homonyms of the pragma argument's entity"}, {"sha": "b33cffef79c546ff09ba75c16bc6464d6b12188a", "filename": "gcc/ada/sem_res.adb", "status": "modified", "additions": 4, "deletions": 2, "changes": 6, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/3235dc87bf6bbe42b58a40f0d894283997e3100c/gcc%2Fada%2Fsem_res.adb", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/3235dc87bf6bbe42b58a40f0d894283997e3100c/gcc%2Fada%2Fsem_res.adb", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fada%2Fsem_res.adb?ref=3235dc87bf6bbe42b58a40f0d894283997e3100c", "patch": "@@ -853,9 +853,11 @@ package body Sem_Res is\n                      Prev (Nod);\n                   end loop;\n \n-                  --  If no raise statement, give warning\n+                  --  If no raise statement, give warning. We look at the\n+                  --  original node, because in the case of \"raise ... with\n+                  --  ...\", the node has been transformed into a call.\n \n-                  exit when Nkind (Nod) /= N_Raise_Statement\n+                  exit when Nkind (Original_Node (Nod)) /= N_Raise_Statement\n                     and then\n                       (Nkind (Nod) not in N_Raise_xxx_Error\n                         or else Present (Condition (Nod)));"}, {"sha": "b8e381520b72c58f0da5b263b86e209e1b85bb7a", "filename": "gcc/ada/snames.ads-tmpl", "status": "modified", "additions": 6, "deletions": 0, "changes": 6, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/3235dc87bf6bbe42b58a40f0d894283997e3100c/gcc%2Fada%2Fsnames.ads-tmpl", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/3235dc87bf6bbe42b58a40f0d894283997e3100c/gcc%2Fada%2Fsnames.ads-tmpl", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fada%2Fsnames.ads-tmpl?ref=3235dc87bf6bbe42b58a40f0d894283997e3100c", "patch": "@@ -1099,6 +1099,7 @@ package Snames is\n \n    --  The names with the -- GB annotation are only used in gprbuild.\n \n+   Name_Active                             : constant Name_Id := N + $;\n    Name_Aggregate                          : constant Name_Id := N + $;\n    Name_Archive_Builder                    : constant Name_Id := N + $;\n    Name_Archive_Builder_Append_Option      : constant Name_Id := N + $;\n@@ -1130,6 +1131,7 @@ package Snames is\n    Name_Excluded_Source_Files              : constant Name_Id := N + $;\n    Name_Excluded_Source_List_File          : constant Name_Id := N + $;\n    Name_Exec_Dir                           : constant Name_Id := N + $;\n+   Name_Exec_Subdir                        : constant Name_Id := N + $;\n    Name_Executable                         : constant Name_Id := N + $;\n    Name_Executable_Suffix                  : constant Name_Id := N + $;\n    Name_Extends                            : constant Name_Id := N + $;\n@@ -1151,11 +1153,13 @@ package Snames is\n    Name_Include_Path                       : constant Name_Id := N + $;\n    Name_Include_Path_File                  : constant Name_Id := N + $;\n    Name_Inherit_Source_Path                : constant Name_Id := N + $;\n+   Name_Install                            : constant Name_Id := N + $;\n    Name_Languages                          : constant Name_Id := N + $;\n    Name_Language_Kind                      : constant Name_Id := N + $;\n    Name_Leading_Library_Options            : constant Name_Id := N + $;\n    Name_Leading_Required_Switches          : constant Name_Id := N + $;\n    Name_Leading_Switches                   : constant Name_Id := N + $;\n+   Name_Lib_Subdir                         : constant Name_Id := N + $;\n    Name_Library                            : constant Name_Id := N + $;\n    Name_Library_Ali_Dir                    : constant Name_Id := N + $;\n    Name_Library_Auto_Init                  : constant Name_Id := N + $;\n@@ -1216,6 +1220,7 @@ package Snames is\n    Name_Project_Dir                        : constant Name_Id := N + $;\n    Name_Project_Files                      : constant Name_Id := N + $;\n    Name_Project_Path                       : constant Name_Id := N + $;\n+   Name_Project_Subdir                     : constant Name_Id := N + $;\n    Name_Response_File_Format               : constant Name_Id := N + $;\n    Name_Response_File_Switches             : constant Name_Id := N + $;\n    Name_Roots                              : constant Name_Id := N + $; -- GB\n@@ -1232,6 +1237,7 @@ package Snames is\n    Name_Source_File_Switches               : constant Name_Id := N + $;\n    Name_Source_Files                       : constant Name_Id := N + $;\n    Name_Source_List_File                   : constant Name_Id := N + $;\n+   Name_Sources_Subdir                     : constant Name_Id := N + $;\n    Name_Spec                               : constant Name_Id := N + $;\n    Name_Spec_Suffix                        : constant Name_Id := N + $;\n    Name_Specification                      : constant Name_Id := N + $;"}, {"sha": "4ff1cdc4fcfa375b784c4b76098a7c93bf448ccb", "filename": "gcc/ada/xref_lib.adb", "status": "modified", "additions": 4, "deletions": 3, "changes": 7, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/3235dc87bf6bbe42b58a40f0d894283997e3100c/gcc%2Fada%2Fxref_lib.adb", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/3235dc87bf6bbe42b58a40f0d894283997e3100c/gcc%2Fada%2Fxref_lib.adb", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fada%2Fxref_lib.adb?ref=3235dc87bf6bbe42b58a40f0d894283997e3100c", "patch": "@@ -6,7 +6,7 @@\n --                                                                          --\n --                                 B o d y                                  --\n --                                                                          --\n---          Copyright (C) 1998-2011, Free Software Foundation, Inc.         --\n+--          Copyright (C) 1998-2012, Free Software Foundation, Inc.         --\n --                                                                          --\n -- GNAT is free software;  you can  redistribute it  and/or modify it under --\n -- terms of the  GNU General Public License as published  by the Free Soft- --\n@@ -1105,9 +1105,10 @@ package body Xref_Lib is\n \n             --  Imported entities might special indication as to their external\n             --  name:\n-            --    5U14*Foo2 5>20 6b<c,myfoo2>22\n+            --    5U14*Foo2 5>20 6b<c,myfoo2>22   # Imported entity\n+            --    5U14*Foo2 5>20 6i<c,myfoo2>22   # Exported entity\n \n-            if R_Type = 'b'\n+            if (R_Type = 'b' or else R_Type = 'i')\n               and then Ali (Ptr) = '<'\n             then\n                while Ptr <= Ali'Last"}]}