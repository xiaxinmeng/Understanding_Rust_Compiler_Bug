{"sha": "776256757b3d12830e5449c41f1dd6c13fdf2868", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6Nzc2MjU2NzU3YjNkMTI4MzBlNTQ0OWM0MWYxZGQ2YzEzZmRmMjg2OA==", "commit": {"author": {"name": "Michael Kuhn", "email": "gcc@ikkoku.de", "date": "2020-06-09T20:05:07Z"}, "committer": {"name": "Jeff Law", "email": "law@redhat.com", "date": "2020-06-09T20:07:46Z"}, "message": "When specifying a non-system prefix with --with-zstd, the build fails because the header and library cannot be found (see https://gcc.gnu.org/bugzilla/show_bug.cgi?id=95005).\n\nThe attached patch fixes the problem and is what we use in Spack to\nmake GCC build with zstd support.\n\ngcc/\n\t* Makefile.in (ZSTD_INC): Define.\n\t(ZSTD_LIB): Include ZSTD_LDFLAGS.\n\t(CFLAGS-lto-compress.o): Add ZSTD_INC.\n\t* configure.ac (ZSTD_CPPFLAGS, ZSTD_LDFLAGS): New variables for\n\tAC_SUBST.\n\t* configure: Rebuilt.", "tree": {"sha": "3a9d1c3f92cd65e644e961eeefd85e9379ceec95", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/3a9d1c3f92cd65e644e961eeefd85e9379ceec95"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/776256757b3d12830e5449c41f1dd6c13fdf2868", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/776256757b3d12830e5449c41f1dd6c13fdf2868", "html_url": "https://github.com/Rust-GCC/gccrs/commit/776256757b3d12830e5449c41f1dd6c13fdf2868", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/776256757b3d12830e5449c41f1dd6c13fdf2868/comments", "author": null, "committer": null, "parents": [{"sha": "84fa38d20a65e6d0dd5707c275acdb5cad3ceb5a", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/84fa38d20a65e6d0dd5707c275acdb5cad3ceb5a", "html_url": "https://github.com/Rust-GCC/gccrs/commit/84fa38d20a65e6d0dd5707c275acdb5cad3ceb5a"}], "stats": {"total": 9, "additions": 7, "deletions": 2}, "files": [{"sha": "4f70c189b9d90361cd09bf938b3bc1d114ebac82", "filename": "gcc/Makefile.in", "status": "modified", "additions": 3, "deletions": 2, "changes": 5, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/776256757b3d12830e5449c41f1dd6c13fdf2868/gcc%2FMakefile.in", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/776256757b3d12830e5449c41f1dd6c13fdf2868/gcc%2FMakefile.in", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2FMakefile.in?ref=776256757b3d12830e5449c41f1dd6c13fdf2868", "patch": "@@ -1081,7 +1081,8 @@ GNATMAKE = @GNATMAKE@\n # Libs needed (at present) just for jcf-dump.\n LDEXP_LIB = @LDEXP_LIB@\n \n-ZSTD_LIB = @ZSTD_LIB@\n+ZSTD_INC = @ZSTD_CPPFLAGS@\n+ZSTD_LIB = @ZSTD_LDFLAGS@ @ZSTD_LIB@\n \n # Likewise, for use in the tools that must run on this machine\n # even if we are cross-building GCC.\n@@ -2286,7 +2287,7 @@ CFLAGS-version.o += -DBASEVER=$(BASEVER_s) -DDATESTAMP=$(DATESTAMP_s) \\\n version.o: $(REVISION) $(DATESTAMP) $(BASEVER) $(DEVPHASE)\n \n # lto-compress.o needs $(ZLIBINC) added to the include flags.\n-CFLAGS-lto-compress.o += $(ZLIBINC)\n+CFLAGS-lto-compress.o += $(ZLIBINC) $(ZSTD_INC)\n \n CFLAGS-lto-streamer-in.o += -DTARGET_MACHINE=\\\"$(target_noncanonical)\\\"\n "}, {"sha": "def9d9a48bee144f869f29e40462422000362c49", "filename": "gcc/configure", "status": "modified", "additions": 2, "deletions": 0, "changes": 2, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/776256757b3d12830e5449c41f1dd6c13fdf2868/gcc%2Fconfigure", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/776256757b3d12830e5449c41f1dd6c13fdf2868/gcc%2Fconfigure", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fconfigure?ref=776256757b3d12830e5449c41f1dd6c13fdf2868", "patch": "@@ -787,6 +787,8 @@ LTLIBICONV\n LIBICONV\n ZSTD_LIB\n ZSTD_INCLUDE\n+ZSTD_LDFLAGS\n+ZSTD_CPPFLAGS\n DL_LIB\n LDEXP_LIB\n EXTRA_GCC_LIBS"}, {"sha": "e769c9c87d4516b1bedfd1e8a1c71b1f8aa0a345", "filename": "gcc/configure.ac", "status": "modified", "additions": 2, "deletions": 0, "changes": 2, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/776256757b3d12830e5449c41f1dd6c13fdf2868/gcc%2Fconfigure.ac", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/776256757b3d12830e5449c41f1dd6c13fdf2868/gcc%2Fconfigure.ac", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fconfigure.ac?ref=776256757b3d12830e5449c41f1dd6c13fdf2868", "patch": "@@ -1340,6 +1340,8 @@ AC_SUBST(ZSTD_INCLUDE)\n AC_SUBST(ZSTD_LIB)\n ZSTD_CPPFLAGS=\n ZSTD_LDFLAGS=\n+AC_SUBST(ZSTD_CPPFLAGS)\n+AC_SUBST(ZSTD_LDFLAGS)\n AC_ARG_WITH(zstd,\n \t[AS_HELP_STRING([--with-zstd=PATH],\n \t\t[specify prefix directory for installed zstd library."}]}