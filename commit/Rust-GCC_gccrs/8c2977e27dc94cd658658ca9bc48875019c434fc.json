{"sha": "8c2977e27dc94cd658658ca9bc48875019c434fc", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6OGMyOTc3ZTI3ZGM5NGNkNjU4NjU4Y2E5YmM0ODg3NTAxOWM0MzRmYw==", "commit": {"author": {"name": "Jim Wilson", "email": "wilson@gcc.gnu.org", "date": "1994-12-29T02:39:10Z"}, "committer": {"name": "Jim Wilson", "email": "wilson@gcc.gnu.org", "date": "1994-12-29T02:39:10Z"}, "message": "(fill_simple_delay_slots): For the epilogue case...\n\n(fill_simple_delay_slots): For the epilogue case, set needed\nto include frame pointer and stack pointer, don't include all of\nend_of_function_needs.\tReject insn if it sets a previously set\nresource.\n\nFrom-SVN: r8698", "tree": {"sha": "5bf32a1048cb73221b4777734b8a0df423a3872a", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/5bf32a1048cb73221b4777734b8a0df423a3872a"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/8c2977e27dc94cd658658ca9bc48875019c434fc", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/8c2977e27dc94cd658658ca9bc48875019c434fc", "html_url": "https://github.com/Rust-GCC/gccrs/commit/8c2977e27dc94cd658658ca9bc48875019c434fc", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/8c2977e27dc94cd658658ca9bc48875019c434fc/comments", "author": null, "committer": null, "parents": [{"sha": "40d2032bdfbfe0c8f3c80f69235c91a570ce0967", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/40d2032bdfbfe0c8f3c80f69235c91a570ce0967", "html_url": "https://github.com/Rust-GCC/gccrs/commit/40d2032bdfbfe0c8f3c80f69235c91a570ce0967"}], "stats": {"total": 21, "additions": 20, "deletions": 1}, "files": [{"sha": "e4058d7e4142330f9c16908acbfbfc9f54dcf232", "filename": "gcc/reorg.c", "status": "modified", "additions": 20, "deletions": 1, "changes": 21, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/8c2977e27dc94cd658658ca9bc48875019c434fc/gcc%2Freorg.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/8c2977e27dc94cd658658ca9bc48875019c434fc/gcc%2Freorg.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Freorg.c?ref=8c2977e27dc94cd658658ca9bc48875019c434fc", "patch": "@@ -3146,9 +3146,27 @@ fill_simple_delay_slots (first, non_jumps_p)\n     return;\n \n   slots_filled = 0;\n-  needed = end_of_function_needs;\n   CLEAR_RESOURCE (&set);\n \n+  /* The frame pointer and stack pointer are needed at the beginning of\n+     the epilogue, so instructions setting them can not be put in the\n+     epilogue delay slot.  However, everything else needed at function\n+     end is safe, so we don't want to use end_of_function_needs here.  */\n+  CLEAR_RESOURCE (&needed);\n+  if (frame_pointer_needed)\n+    {\n+      SET_HARD_REG_BIT (needed.regs, FRAME_POINTER_REGNUM);\n+#if HARD_FRAME_POINTER_REGNUM != FRAME_POINTER_REGNUM\n+      SET_HARD_REG_BIT (needed.regs, HARD_FRAME_POINTER_REGNUM);\n+#endif\n+#ifdef EXIT_IGNORE_STACK\n+      if (! EXIT_IGNORE_STACK)\n+#endif\n+\tSET_HARD_REG_BIT (needed.regs, STACK_POINTER_REGNUM);\n+    }\n+  else\n+    SET_HARD_REG_BIT (needed.regs, STACK_POINTER_REGNUM);\n+\n   for (trial = get_last_insn (); ! stop_search_p (trial, 1);\n        trial = PREV_INSN (trial))\n     {\n@@ -3160,6 +3178,7 @@ fill_simple_delay_slots (first, non_jumps_p)\n \n       if (! insn_references_resource_p (trial, &set, 1)\n \t  && ! insn_sets_resource_p (trial, &needed, 1)\n+\t  && ! insn_sets_resource_p (trial, &set, 1)\n #ifdef HAVE_cc0\n \t  /* Don't want to mess with cc0 here.  */\n \t  && ! reg_mentioned_p (cc0_rtx, pat)"}]}