{"sha": "cde3a7a96908f651a844fd43905a64651d42c5af", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6Y2RlM2E3YTk2OTA4ZjY1MWE4NDRmZDQzOTA1YTY0NjUxZDQyYzVhZg==", "commit": {"author": {"name": "Asher Langton", "email": "langton2@llnl.gov", "date": "2011-06-02T21:41:12Z"}, "committer": {"name": "Asher Langton", "email": "langton@gcc.gnu.org", "date": "2011-06-02T21:41:12Z"}, "message": "re PR fortran/49268 (Invalid code generated for assumed-size Cray pointee)\n\n    * trans-decl.c (gfc_trans_deferred_vars): Treat assumed-size Cray\n        pointees as AS_EXPLICIT.\n\n    * gfortran.dg/PR49268.f90: New test.\n\nFrom-SVN: r174584", "tree": {"sha": "f9006deff7edb39e13973983e95767c37b35e499", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/f9006deff7edb39e13973983e95767c37b35e499"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/cde3a7a96908f651a844fd43905a64651d42c5af", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/cde3a7a96908f651a844fd43905a64651d42c5af", "html_url": "https://github.com/Rust-GCC/gccrs/commit/cde3a7a96908f651a844fd43905a64651d42c5af", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/cde3a7a96908f651a844fd43905a64651d42c5af/comments", "author": null, "committer": null, "parents": [{"sha": "11126dc093925fdfebfb0d3f9eff60a75d5e5a23", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/11126dc093925fdfebfb0d3f9eff60a75d5e5a23", "html_url": "https://github.com/Rust-GCC/gccrs/commit/11126dc093925fdfebfb0d3f9eff60a75d5e5a23"}], "stats": {"total": 68, "additions": 67, "deletions": 1}, "files": [{"sha": "532a30b1ab31f8a7ef6d53056314b4a20b54c720", "filename": "gcc/fortran/ChangeLog", "status": "modified", "additions": 6, "deletions": 0, "changes": 6, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/cde3a7a96908f651a844fd43905a64651d42c5af/gcc%2Ffortran%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/cde3a7a96908f651a844fd43905a64651d42c5af/gcc%2Ffortran%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ffortran%2FChangeLog?ref=cde3a7a96908f651a844fd43905a64651d42c5af", "patch": "@@ -1,3 +1,9 @@\n+2011-06-02  Asher Langton  <langton2@llnl.gov>\n+\n+\tPR fortran/49268\n+\t* trans-decl.c (gfc_trans_deferred_vars): Treat assumed-size Cray\n+\tpointees as AS_EXPLICIT.\n+\n 2011-06-02  Asher Langton  <langton2@llnl.gov>\n \n \tPR fortran/37039"}, {"sha": "a22591535639984d2a38f15975a5ac76ab1e5acb", "filename": "gcc/fortran/trans-decl.c", "status": "modified", "additions": 5, "deletions": 1, "changes": 6, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/cde3a7a96908f651a844fd43905a64651d42c5af/gcc%2Ffortran%2Ftrans-decl.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/cde3a7a96908f651a844fd43905a64651d42c5af/gcc%2Ffortran%2Ftrans-decl.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ffortran%2Ftrans-decl.c?ref=cde3a7a96908f651a844fd43905a64651d42c5af", "patch": "@@ -3465,7 +3465,11 @@ gfc_trans_deferred_vars (gfc_symbol * proc_sym, gfc_wrapped_block * block)\n \n       if (sym->attr.dimension || sym->attr.codimension)\n \t{\n-\t  switch (sym->as->type)\n+          /* Assumed-size Cray pointees need to be treated as AS_EXPLICIT.  */\n+          array_type tmp = sym->as->type;\n+          if (tmp == AS_ASSUMED_SIZE && sym->as->cp_was_assumed)\n+            tmp = AS_EXPLICIT;\n+          switch (tmp)\n \t    {\n \t    case AS_EXPLICIT:\n \t      if (sym->attr.dummy || sym->attr.result)"}, {"sha": "135087c8a4583900ebc4403a0e7f0d674c9519ff", "filename": "gcc/testsuite/ChangeLog", "status": "modified", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/cde3a7a96908f651a844fd43905a64651d42c5af/gcc%2Ftestsuite%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/cde3a7a96908f651a844fd43905a64651d42c5af/gcc%2Ftestsuite%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2FChangeLog?ref=cde3a7a96908f651a844fd43905a64651d42c5af", "patch": "@@ -1,3 +1,8 @@\n+2011-06-02  Asher Langton  <langton2@llnl.gov>\n+\n+\tPR fortran/49268\n+\t* gfortran.dg/PR49268.f90: New test.\n+\n 2011-06-02  Asher Langton  <langton2@llnl.gov>\n \n \tPR fortran/37039"}, {"sha": "5b274cf483d158c15212108d0b8e3f9cbf71852e", "filename": "gcc/testsuite/gfortran.dg/PR49268.f90", "status": "added", "additions": 51, "deletions": 0, "changes": 51, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/cde3a7a96908f651a844fd43905a64651d42c5af/gcc%2Ftestsuite%2Fgfortran.dg%2FPR49268.f90", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/cde3a7a96908f651a844fd43905a64651d42c5af/gcc%2Ftestsuite%2Fgfortran.dg%2FPR49268.f90", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgfortran.dg%2FPR49268.f90?ref=cde3a7a96908f651a844fd43905a64651d42c5af", "patch": "@@ -0,0 +1,51 @@\n+! { dg-do run }\n+! { dg-options \"-fcray-pointer\" }\n+\n+! Test the fix for a runtime error \n+! Contributed by Mike Kumbera <kumbera1@llnl.gov>\n+\n+        program bob\n+        implicit none\n+        integer*8 ipfoo\n+        integer n,m,i,j\n+        real*8 foo\n+        \n+        common /ipdata/ ipfoo\n+        common /ipsize/ n,m\n+        POINTER ( ipfoo, foo(3,7) )\n+\n+        n=3\n+        m=7\n+\n+        ipfoo=malloc(8*n*m)\n+        do i=1,n\n+            do j=1,m\n+                foo(i,j)=1.d0\n+            end do\n+        end do\n+        call use_foo()\n+        end  program bob\n+\n+\n+        subroutine use_foo()\n+        implicit none\n+        integer n,m,i,j\n+        integer*8 ipfoo\n+        common /ipdata/ ipfoo\n+        common /ipsize/ n,m\n+        real*8 foo,boo\n+\n+        !fails if * is the last dimension\n+        POINTER ( ipfoo, foo(n,*) )\n+\n+        !works if the last dimension is specified\n+        !POINTER ( ipfoo, foo(n,m) )\n+        boo=0.d0\n+        do i=1,n\n+            do j=1,m\n+               boo=foo(i,j)+1.0\n+               if (abs (boo - 2.0) .gt. 1e-6) call abort\n+            end do\n+        end do\n+\n+        end subroutine use_foo"}]}