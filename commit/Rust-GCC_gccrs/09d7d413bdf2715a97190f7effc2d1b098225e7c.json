{"sha": "09d7d413bdf2715a97190f7effc2d1b098225e7c", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6MDlkN2Q0MTNiZGYyNzE1YTk3MTkwZjdlZmZjMmQxYjA5ODIyNWU3Yw==", "commit": {"author": {"name": "Pascal Obry", "email": "obry@adacore.com", "date": "2010-01-27T14:15:42Z"}, "committer": {"name": "Arnaud Charlet", "email": "charlet@gcc.gnu.org", "date": "2010-01-27T14:15:42Z"}, "message": "g-awk.adb: ensure that an AWK session is reusable.\n\n2010-01-27  Pascal Obry  <obry@adacore.com>\n\n\t* g-awk.adb: ensure that an AWK session is reusable.\n\nFrom-SVN: r156285", "tree": {"sha": "306ec243504f4966a74c0cedbc57b00e91e4063d", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/306ec243504f4966a74c0cedbc57b00e91e4063d"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/09d7d413bdf2715a97190f7effc2d1b098225e7c", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/09d7d413bdf2715a97190f7effc2d1b098225e7c", "html_url": "https://github.com/Rust-GCC/gccrs/commit/09d7d413bdf2715a97190f7effc2d1b098225e7c", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/09d7d413bdf2715a97190f7effc2d1b098225e7c/comments", "author": {"login": "TurboGit", "id": 467069, "node_id": "MDQ6VXNlcjQ2NzA2OQ==", "avatar_url": "https://avatars.githubusercontent.com/u/467069?v=4", "gravatar_id": "", "url": "https://api.github.com/users/TurboGit", "html_url": "https://github.com/TurboGit", "followers_url": "https://api.github.com/users/TurboGit/followers", "following_url": "https://api.github.com/users/TurboGit/following{/other_user}", "gists_url": "https://api.github.com/users/TurboGit/gists{/gist_id}", "starred_url": "https://api.github.com/users/TurboGit/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/TurboGit/subscriptions", "organizations_url": "https://api.github.com/users/TurboGit/orgs", "repos_url": "https://api.github.com/users/TurboGit/repos", "events_url": "https://api.github.com/users/TurboGit/events{/privacy}", "received_events_url": "https://api.github.com/users/TurboGit/received_events", "type": "User", "site_admin": false}, "committer": null, "parents": [{"sha": "0309455b5035575ca19b1a6e23f8109db9e7797e", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/0309455b5035575ca19b1a6e23f8109db9e7797e", "html_url": "https://github.com/Rust-GCC/gccrs/commit/0309455b5035575ca19b1a6e23f8109db9e7797e"}], "stats": {"total": 26, "additions": 15, "deletions": 11}, "files": [{"sha": "303ab26ddb379895d774b6361a4d9c4c3c3edad8", "filename": "gcc/ada/ChangeLog", "status": "modified", "additions": 4, "deletions": 0, "changes": 4, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/09d7d413bdf2715a97190f7effc2d1b098225e7c/gcc%2Fada%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/09d7d413bdf2715a97190f7effc2d1b098225e7c/gcc%2Fada%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fada%2FChangeLog?ref=09d7d413bdf2715a97190f7effc2d1b098225e7c", "patch": "@@ -1,3 +1,7 @@\n+2010-01-27  Pascal Obry  <obry@adacore.com>\n+\n+\t* g-awk.adb: ensure that an AWK session is reusable.\n+\n 2010-01-27  Vasiliy Fofanov  <fofanov@adacore.com>\n \n \t* g-regist.adb (For_Every_Key): Fix previous change."}, {"sha": "6c8fa1a8bb81f4e30260a1804af4d92a330c47ea", "filename": "gcc/ada/g-awk.adb", "status": "modified", "additions": 11, "deletions": 11, "changes": 22, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/09d7d413bdf2715a97190f7effc2d1b098225e7c/gcc%2Fada%2Fg-awk.adb", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/09d7d413bdf2715a97190f7effc2d1b098225e7c/gcc%2Fada%2Fg-awk.adb", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fada%2Fg-awk.adb?ref=09d7d413bdf2715a97190f7effc2d1b098225e7c", "patch": "@@ -6,7 +6,7 @@\n --                                                                          --\n --                                 B o d y                                  --\n --                                                                          --\n---                     Copyright (C) 2000-2008, AdaCore                     --\n+--                     Copyright (C) 2000-2010, AdaCore                     --\n --                                                                          --\n -- GNAT is free software;  you can  redistribute it  and/or modify it under --\n -- terms of the  GNU General Public License as published  by the Free Soft- --\n@@ -294,6 +294,10 @@ package body GNAT.AWK is\n       --  We release the session data only if it is not the default session\n \n       if Session.Data /= Get_Def then\n+         --  Release separators\n+\n+         Free (Session.Data.Separators);\n+\n          Free (Session.Data);\n \n          --  Since we have closed the current session, set it to point now to\n@@ -485,11 +489,10 @@ package body GNAT.AWK is\n       procedure Current_Line (S : Separator; Session : Session_Type) is\n          Line   : constant String := To_String (Session.Data.Current_Line);\n          Fields : Field_Table.Instance renames Session.Data.Fields;\n+         Seps   : constant Maps.Character_Set := Maps.To_Set (S.Separators);\n \n-         Start : Natural;\n-         Stop  : Natural;\n-\n-         Seps  : constant Maps.Character_Set := Maps.To_Set (S.Separators);\n+         Start  : Natural;\n+         Stop   : Natural;\n \n       begin\n          --  First field start here\n@@ -506,8 +509,8 @@ package body GNAT.AWK is\n             --  Look for next separator\n \n             Stop := Fixed.Index\n-              (Source  => Line (Start .. Line'Last),\n-               Set     => Seps);\n+              (Source => Line (Start .. Line'Last),\n+               Set    => Seps);\n \n             exit when Stop = 0;\n \n@@ -526,6 +529,7 @@ package body GNAT.AWK is\n                if Start = 0 then\n                   Start := Stop + 1;\n                end if;\n+\n             else\n                Start := Stop + 1;\n             end if;\n@@ -707,10 +711,6 @@ package body GNAT.AWK is\n          Text_IO.Close (Session.Data.Current_File);\n       end if;\n \n-      --  Release separators\n-\n-      Free (Session.Data.Separators);\n-\n       --  Release Filters table\n \n       for F in 1 .. Pattern_Action_Table.Last (Filters) loop"}]}