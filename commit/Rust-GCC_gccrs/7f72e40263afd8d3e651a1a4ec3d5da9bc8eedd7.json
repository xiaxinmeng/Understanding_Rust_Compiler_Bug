{"sha": "7f72e40263afd8d3e651a1a4ec3d5da9bc8eedd7", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6N2Y3MmU0MDI2M2FmZDhkM2U2NTFhMWE0ZWMzZDVkYTliYzhlZWRkNw==", "commit": {"author": {"name": "Jerry DeLisle", "email": "jvdelisle@gcc.gnu.org", "date": "2017-05-17T20:33:20Z"}, "committer": {"name": "Jerry DeLisle", "email": "jvdelisle@gcc.gnu.org", "date": "2017-05-17T20:33:20Z"}, "message": "re PR fortran/80741 ([Regression 7/8] DTIO wrong code causes incorrect behaviour of namelist READ)\n\n2017-05-17  Jerry DeLisle  <jvdelisle@gcc.gnu.org>\n\n\tPR libgfortran/80741\n\t* transfer.c (finalize_transfer): Reset last_char to 'empty'.\n\t* file_pos.c (formatted_backspace): Likewise.\n\t(st_endfile): Likewise.\n\t(st_rewind): Likewise.\n\t(st_flush): Likewise.\n\n\tPR fortran/80741\n\t* trans-io.c (transfer_namelist_element): Change check from\n\tNULL_TREE to null_pointer_node.\n\nFrom-SVN: r248170", "tree": {"sha": "29800b9a3654c094d28b76ab48c3fe336be322ce", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/29800b9a3654c094d28b76ab48c3fe336be322ce"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/7f72e40263afd8d3e651a1a4ec3d5da9bc8eedd7", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/7f72e40263afd8d3e651a1a4ec3d5da9bc8eedd7", "html_url": "https://github.com/Rust-GCC/gccrs/commit/7f72e40263afd8d3e651a1a4ec3d5da9bc8eedd7", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/7f72e40263afd8d3e651a1a4ec3d5da9bc8eedd7/comments", "author": null, "committer": null, "parents": [{"sha": "7ded3472ae5e5eec41909fcefc911e1092479f9b", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/7ded3472ae5e5eec41909fcefc911e1092479f9b", "html_url": "https://github.com/Rust-GCC/gccrs/commit/7ded3472ae5e5eec41909fcefc911e1092479f9b"}], "stats": {"total": 60, "additions": 57, "deletions": 3}, "files": [{"sha": "703060d32ab7b8fc3c23f9c67ddc4b203c10469a", "filename": "gcc/fortran/ChangeLog", "status": "modified", "additions": 6, "deletions": 0, "changes": 6, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/7f72e40263afd8d3e651a1a4ec3d5da9bc8eedd7/gcc%2Ffortran%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/7f72e40263afd8d3e651a1a4ec3d5da9bc8eedd7/gcc%2Ffortran%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ffortran%2FChangeLog?ref=7f72e40263afd8d3e651a1a4ec3d5da9bc8eedd7", "patch": "@@ -1,3 +1,9 @@\n+2017-05-17  Jerry DeLisle  <jvdelisle@gcc.gnu.org>\n+\n+\tPR fortran/80741\n+\t* trans-io.c (transfer_namelist_element): Change check from\n+\tNULL_TREE to null_pointer_node.\n+\n 2017-05-17  Fritz Reese <fritzoreese@gmail.com>\n \n \tPR fortran/80668"}, {"sha": "c557c1140d82bc76ef846ad340511834e576004b", "filename": "gcc/fortran/trans-io.c", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/7f72e40263afd8d3e651a1a4ec3d5da9bc8eedd7/gcc%2Ffortran%2Ftrans-io.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/7f72e40263afd8d3e651a1a4ec3d5da9bc8eedd7/gcc%2Ffortran%2Ftrans-io.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ffortran%2Ftrans-io.c?ref=7f72e40263afd8d3e651a1a4ec3d5da9bc8eedd7", "patch": "@@ -1756,7 +1756,7 @@ transfer_namelist_element (stmtblock_t * block, const char * var_name,\n   else\n     tmp = build_int_cst (gfc_charlen_type_node, 0);\n \n-  if (dtio_proc == NULL_TREE)\n+  if (dtio_proc == null_pointer_node)\n     tmp = build_call_expr_loc (input_location,\n \t\t\t   iocall[IOCALL_SET_NML_VAL], 6,\n \t\t\t   dt_parm_addr, addr_expr, string,"}, {"sha": "7a835b124af42bc67a2b44367b6779843b9a4030", "filename": "gcc/testsuite/gfortran.dg/read_4.f90", "status": "added", "additions": 35, "deletions": 0, "changes": 35, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/7f72e40263afd8d3e651a1a4ec3d5da9bc8eedd7/gcc%2Ftestsuite%2Fgfortran.dg%2Fread_4.f90", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/7f72e40263afd8d3e651a1a4ec3d5da9bc8eedd7/gcc%2Ftestsuite%2Fgfortran.dg%2Fread_4.f90", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgfortran.dg%2Fread_4.f90?ref=7f72e40263afd8d3e651a1a4ec3d5da9bc8eedd7", "patch": "@@ -0,0 +1,35 @@\n+! { dg-do run }\n+! PR80741 wrong code causes incorrect behaviour of namelist READ\n+program p\n+  use, intrinsic :: iso_fortran_env, only: iostat_end\n+  implicit none\n+  integer :: x, y, ios, io\n+  character(10) :: line\n+  namelist /test/ x, y\n+  \n+  x = 10\n+  y = 10\n+  ios = 0\n+  io = 10\n+  open(unit=io, status='scratch')\n+  write(io, test)\n+  write(io, *) 'done'\n+  rewind(io)\n+  x = 0\n+  y = 0\n+  read(io, test)\n+  if (x.ne.10 .or. y.ne.10) call abort\n+  !\n+  read(io, *) line\n+  if (line.ne.'done') call abort\n+  !\n+  read(io, *, iostat=ios) line\n+  if (ios/=iostat_end) call abort\n+  rewind(io)\n+  x = 0\n+  y = 0\n+  read(io, test)\n+  if (x.ne.10 .or. y.ne.10) call abort\n+  read(io, *, iostat=ios) line\n+  if (line.ne.'done') call abort\n+end"}, {"sha": "7fe527dda3e3bc7f8e462150c94725effed1c29e", "filename": "libgfortran/ChangeLog", "status": "modified", "additions": 9, "deletions": 0, "changes": 9, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/7f72e40263afd8d3e651a1a4ec3d5da9bc8eedd7/libgfortran%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/7f72e40263afd8d3e651a1a4ec3d5da9bc8eedd7/libgfortran%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libgfortran%2FChangeLog?ref=7f72e40263afd8d3e651a1a4ec3d5da9bc8eedd7", "patch": "@@ -1,3 +1,12 @@\n+2017-05-17  Jerry DeLisle  <jvdelisle@gcc.gnu.org>\n+\n+\tPR libgfortran/80741\n+\t* transfer.c (finalize_transfer): Reset last_char to 'empty'.\n+\t* file_pos.c (formatted_backspace): Likewise.\n+\t(st_endfile): Likewise.\n+\t(st_rewind): Likewise.\n+\t(st_flush): Likewise.\n+\t\n 2017-05-15  Jerry DeLisle  <jvdelisle@gcc.gnu.org>\n \n \tPR libgfortran/80727"}, {"sha": "771d548ea1d968a7dd0ea22c45f231a872f593ed", "filename": "libgfortran/io/file_pos.c", "status": "modified", "additions": 5, "deletions": 1, "changes": 6, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/7f72e40263afd8d3e651a1a4ec3d5da9bc8eedd7/libgfortran%2Fio%2Ffile_pos.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/7f72e40263afd8d3e651a1a4ec3d5da9bc8eedd7/libgfortran%2Fio%2Ffile_pos.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libgfortran%2Fio%2Ffile_pos.c?ref=7f72e40263afd8d3e651a1a4ec3d5da9bc8eedd7", "patch": "@@ -82,7 +82,7 @@ formatted_backspace (st_parameter_filepos *fpp, gfc_unit *u)\n     goto io_error;\n   u->last_record--;\n   u->endfile = NO_ENDFILE;\n-\n+  u->last_char = EOF - 1;\n   return;\n \n  io_error:\n@@ -322,6 +322,7 @@ st_endfile (st_parameter_filepos *fpp)\n \n       unit_truncate (u, stell (u->s), &fpp->common);\n       u->endfile = AFTER_ENDFILE;\n+      u->last_char = EOF - 1;\n       if (0 == stell (u->s))\n         u->flags.position = POSITION_REWIND;\n     }\n@@ -371,6 +372,7 @@ st_endfile (st_parameter_filepos *fpp)\n \t  if (u == NULL)\n \t    return;\n \t  u->endfile = AFTER_ENDFILE;\n+\t  u->last_char = EOF - 1;\n \t}\n     }\n \n@@ -430,6 +432,7 @@ st_rewind (st_parameter_filepos *fpp)\n \t  u->current_record = 0;\n \t  u->strm_pos = 1;\n \t  u->read_bad = 0;\n+\t  u->last_char = EOF - 1;\n \t}\n       /* Update position for INQUIRE.  */\n       u->flags.position = POSITION_REWIND;\n@@ -458,6 +461,7 @@ st_flush (st_parameter_filepos *fpp)\n         fbuf_flush (u, u->mode);\n \n       sflush (u->s);\n+      u->last_char = EOF - 1;\n       unlock_unit (u);\n     }\n   else"}, {"sha": "298b29e8d3ef2e11ebe49256a42304d59ad2dd8b", "filename": "libgfortran/io/transfer.c", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/7f72e40263afd8d3e651a1a4ec3d5da9bc8eedd7/libgfortran%2Fio%2Ftransfer.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/7f72e40263afd8d3e651a1a4ec3d5da9bc8eedd7/libgfortran%2Fio%2Ftransfer.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libgfortran%2Fio%2Ftransfer.c?ref=7f72e40263afd8d3e651a1a4ec3d5da9bc8eedd7", "patch": "@@ -3977,7 +3977,7 @@ finalize_transfer (st_parameter_dt *dtp)\n       fbuf_seek (dtp->u.p.current_unit, 0, SEEK_END);\n \n   dtp->u.p.current_unit->saved_pos = 0;\n-\n+  dtp->u.p.current_unit->last_char = EOF - 1;\n   next_record (dtp, 1);\n \n  done:"}]}