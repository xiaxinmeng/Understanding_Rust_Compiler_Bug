{"sha": "b4e48861dfd6ec635b252dc13a5b19a2df237cc7", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6YjRlNDg4NjFkZmQ2ZWM2MzViMjUyZGMxM2E1YjE5YTJkZjIzN2NjNw==", "commit": {"author": {"name": "Tom de Vries", "email": "tom@codesourcery.com", "date": "2013-11-14T00:10:42Z"}, "committer": {"name": "Tom de Vries", "email": "vries@gcc.gnu.org", "date": "2013-11-14T00:10:42Z"}, "message": "Handle GIMPLE_ASSIGNs with different vuse in gimple_equal_p\n\n2013-11-14  Tom de Vries  <tom@codesourcery.com>\n\n\t* tree-ssa-tail-merge.c (gimple_equal_p): Add test for structural\n\tequality for GIMPLE_ASSIGN.\n\n\t* gcc.dg/tail-merge-store.c: New test.\n\nFrom-SVN: r204767", "tree": {"sha": "374322382bce0dcc52445ff4261931542fd1ecae", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/374322382bce0dcc52445ff4261931542fd1ecae"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/b4e48861dfd6ec635b252dc13a5b19a2df237cc7", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/b4e48861dfd6ec635b252dc13a5b19a2df237cc7", "html_url": "https://github.com/Rust-GCC/gccrs/commit/b4e48861dfd6ec635b252dc13a5b19a2df237cc7", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/b4e48861dfd6ec635b252dc13a5b19a2df237cc7/comments", "author": null, "committer": null, "parents": [{"sha": "b6366520fa4bdf20c884457f027b5c4701cd3bbe", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/b6366520fa4bdf20c884457f027b5c4701cd3bbe", "html_url": "https://github.com/Rust-GCC/gccrs/commit/b6366520fa4bdf20c884457f027b5c4701cd3bbe"}], "stats": {"total": 44, "additions": 42, "deletions": 2}, "files": [{"sha": "dad20a4bdb51b1fd47a45c77a558a9099482fa63", "filename": "gcc/ChangeLog", "status": "modified", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/b4e48861dfd6ec635b252dc13a5b19a2df237cc7/gcc%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/b4e48861dfd6ec635b252dc13a5b19a2df237cc7/gcc%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2FChangeLog?ref=b4e48861dfd6ec635b252dc13a5b19a2df237cc7", "patch": "@@ -1,3 +1,8 @@\n+2013-11-14  Tom de Vries  <tom@codesourcery.com>\n+\n+\t* tree-ssa-tail-merge.c (gimple_equal_p): Add test for structural\n+\tequality for GIMPLE_ASSIGN.\n+\n 2013-11-14  Tom de Vries  <tom@codesourcery.com>\n \n \t* tree-ssa-tail-merge.c (gimple_operand_equal_value_p): Factor new"}, {"sha": "ddbb62eeb073491f8e2a507b0dec1de86fa7c301", "filename": "gcc/testsuite/ChangeLog", "status": "modified", "additions": 4, "deletions": 0, "changes": 4, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/b4e48861dfd6ec635b252dc13a5b19a2df237cc7/gcc%2Ftestsuite%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/b4e48861dfd6ec635b252dc13a5b19a2df237cc7/gcc%2Ftestsuite%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2FChangeLog?ref=b4e48861dfd6ec635b252dc13a5b19a2df237cc7", "patch": "@@ -1,3 +1,7 @@\n+2013-11-14  Tom de Vries  <tom@codesourcery.com>\n+\n+\t* gcc.dg/tail-merge-store.c: New test.\n+\n 2013-11-13  Andrew MacLeod  <amacleod@redhat.com>\n \n \t* testsuite/g++.dg/plugin/selfassign.c: Include gimple-iterator.h."}, {"sha": "1aefbdc1495f06e11fbf1418494bc9a4c0dd014f", "filename": "gcc/testsuite/gcc.dg/tail-merge-store.c", "status": "added", "additions": 22, "deletions": 0, "changes": 22, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/b4e48861dfd6ec635b252dc13a5b19a2df237cc7/gcc%2Ftestsuite%2Fgcc.dg%2Ftail-merge-store.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/b4e48861dfd6ec635b252dc13a5b19a2df237cc7/gcc%2Ftestsuite%2Fgcc.dg%2Ftail-merge-store.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgcc.dg%2Ftail-merge-store.c?ref=b4e48861dfd6ec635b252dc13a5b19a2df237cc7", "patch": "@@ -0,0 +1,22 @@\n+/* { dg-do compile } */\n+/* { dg-options \"-O2 -ftree-tail-merge -fdump-tree-pre\" } */\n+\n+int z;\n+int x;\n+\n+void\n+f (int c, int d)\n+{\n+  if (c)\n+    z = 5;\n+  else\n+    {\n+      if (d)\n+\tx = 4;\n+      z = 5;\n+    }\n+}\n+\n+/* { dg-final { scan-tree-dump-times \"duplicate of\" 1 \"pre\"} } */\n+/* { dg-final { scan-tree-dump-times \"z = 5\" 1 \"pre\"} } */\n+/* { dg-final { cleanup-tree-dump \"pre\" } } */"}, {"sha": "c97da97f6d3f00ea92421bd56dce68a3dd1bbaf8", "filename": "gcc/tree-ssa-tail-merge.c", "status": "modified", "additions": 11, "deletions": 2, "changes": 13, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/b4e48861dfd6ec635b252dc13a5b19a2df237cc7/gcc%2Ftree-ssa-tail-merge.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/b4e48861dfd6ec635b252dc13a5b19a2df237cc7/gcc%2Ftree-ssa-tail-merge.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftree-ssa-tail-merge.c?ref=b4e48861dfd6ec635b252dc13a5b19a2df237cc7", "patch": "@@ -1142,8 +1142,17 @@ gimple_equal_p (same_succ same_succ, gimple s1, gimple s2)\n       lhs2 = gimple_get_lhs (s2);\n       if (TREE_CODE (lhs1) != SSA_NAME\n \t  && TREE_CODE (lhs2) != SSA_NAME)\n-\treturn (vn_valueize (gimple_vdef (s1))\n-\t\t== vn_valueize (gimple_vdef (s2)));\n+\t{\n+\t  /* If the vdef is the same, it's the same statement.  */\n+\t  if (vn_valueize (gimple_vdef (s1))\n+\t      == vn_valueize (gimple_vdef (s2)))\n+\t    return true;\n+\n+\t  /* Test for structural equality.  */\n+\t  return (operand_equal_p (lhs1, lhs2, 0)\n+\t\t  && gimple_operand_equal_value_p (gimple_assign_rhs1 (s1),\n+\t\t\t\t\t\t   gimple_assign_rhs1 (s2)));\n+\t}\n       else if (TREE_CODE (lhs1) == SSA_NAME\n \t       && TREE_CODE (lhs2) == SSA_NAME)\n \treturn vn_valueize (lhs1) == vn_valueize (lhs2);"}]}