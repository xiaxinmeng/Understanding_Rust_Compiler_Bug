{"sha": "5e9394382251d43eb06f117260fcfb18961ce0c4", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6NWU5Mzk0MzgyMjUxZDQzZWIwNmYxMTcyNjBmY2ZiMTg5NjFjZTBjNA==", "commit": {"author": {"name": "Thomas Schwinge", "email": "thomas@codesourcery.com", "date": "2019-12-11T16:48:44Z"}, "committer": {"name": "Thomas Schwinge", "email": "tschwinge@gcc.gnu.org", "date": "2019-12-11T16:48:44Z"}, "message": "[OpenACC] Initialize 'dynamic_refcount' whenever we initialize 'refcount'\n\nCases missed in r261813 \"Update OpenACC data clause semantics to the 2.5\nbehavior\".\n\n\tlibgomp/\n\t* target.c (gomp_load_image_to_device, omp_target_associate_ptr):\n\tInitialize 'dynamic_refcount' whenever we initialize 'refcount'.\n\nCo-Authored-By: Julian Brown <julian@codesourcery.com>\n\nFrom-SVN: r279230", "tree": {"sha": "88bc251142c911ad1856dc5e2fb3a5b2b68aef32", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/88bc251142c911ad1856dc5e2fb3a5b2b68aef32"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/5e9394382251d43eb06f117260fcfb18961ce0c4", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/5e9394382251d43eb06f117260fcfb18961ce0c4", "html_url": "https://github.com/Rust-GCC/gccrs/commit/5e9394382251d43eb06f117260fcfb18961ce0c4", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/5e9394382251d43eb06f117260fcfb18961ce0c4/comments", "author": {"login": "tschwinge", "id": 21753, "node_id": "MDQ6VXNlcjIxNzUz", "avatar_url": "https://avatars.githubusercontent.com/u/21753?v=4", "gravatar_id": "", "url": "https://api.github.com/users/tschwinge", "html_url": "https://github.com/tschwinge", "followers_url": "https://api.github.com/users/tschwinge/followers", "following_url": "https://api.github.com/users/tschwinge/following{/other_user}", "gists_url": "https://api.github.com/users/tschwinge/gists{/gist_id}", "starred_url": "https://api.github.com/users/tschwinge/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/tschwinge/subscriptions", "organizations_url": "https://api.github.com/users/tschwinge/orgs", "repos_url": "https://api.github.com/users/tschwinge/repos", "events_url": "https://api.github.com/users/tschwinge/events{/privacy}", "received_events_url": "https://api.github.com/users/tschwinge/received_events", "type": "User", "site_admin": false}, "committer": null, "parents": [{"sha": "7c0a61870e0f8fe8ad1e21594f92ab454ca60c0d", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/7c0a61870e0f8fe8ad1e21594f92ab454ca60c0d", "html_url": "https://github.com/Rust-GCC/gccrs/commit/7c0a61870e0f8fe8ad1e21594f92ab454ca60c0d"}], "stats": {"total": 9, "additions": 9, "deletions": 0}, "files": [{"sha": "6635ed7b44bf51c1225fdebbf6e3702f936a8987", "filename": "libgomp/ChangeLog", "status": "modified", "additions": 6, "deletions": 0, "changes": 6, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/5e9394382251d43eb06f117260fcfb18961ce0c4/libgomp%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/5e9394382251d43eb06f117260fcfb18961ce0c4/libgomp%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libgomp%2FChangeLog?ref=5e9394382251d43eb06f117260fcfb18961ce0c4", "patch": "@@ -1,3 +1,9 @@\n+2019-12-11  Thomas Schwinge  <thomas@codesourcery.com>\n+\t    Julian Brown  <julian@codesourcery.com>\n+\n+\t* target.c (gomp_load_image_to_device, omp_target_associate_ptr):\n+\tInitialize 'dynamic_refcount' whenever we initialize 'refcount'.\n+\n 2019-12-11  Tobias Burnus  <tobias@codesourcery.com>\n \n \t* omp_lib.h.in: Fix spelling of function declaration"}, {"sha": "1151debf25665bf7b79d68ecd75a24045b5b686e", "filename": "libgomp/target.c", "status": "modified", "additions": 3, "deletions": 0, "changes": 3, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/5e9394382251d43eb06f117260fcfb18961ce0c4/libgomp%2Ftarget.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/5e9394382251d43eb06f117260fcfb18961ce0c4/libgomp%2Ftarget.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libgomp%2Ftarget.c?ref=5e9394382251d43eb06f117260fcfb18961ce0c4", "patch": "@@ -1334,6 +1334,7 @@ gomp_load_image_to_device (struct gomp_device_descr *devicep, unsigned version,\n       k->tgt = tgt;\n       k->tgt_offset = target_table[i].start;\n       k->refcount = REFCOUNT_INFINITY;\n+      k->dynamic_refcount = 0;\n       k->link_key = NULL;\n       array->left = NULL;\n       array->right = NULL;\n@@ -1366,6 +1367,7 @@ gomp_load_image_to_device (struct gomp_device_descr *devicep, unsigned version,\n       k->tgt = tgt;\n       k->tgt_offset = target_var->start;\n       k->refcount = target_size & link_bit ? REFCOUNT_LINK : REFCOUNT_INFINITY;\n+      k->dynamic_refcount = 0;\n       k->link_key = NULL;\n       array->left = NULL;\n       array->right = NULL;\n@@ -2627,6 +2629,7 @@ omp_target_associate_ptr (const void *host_ptr, const void *device_ptr,\n       k->tgt = tgt;\n       k->tgt_offset = (uintptr_t) device_ptr + device_offset;\n       k->refcount = REFCOUNT_INFINITY;\n+      k->dynamic_refcount = 0;\n       array->left = NULL;\n       array->right = NULL;\n       splay_tree_insert (&devicep->mem_map, array);"}]}