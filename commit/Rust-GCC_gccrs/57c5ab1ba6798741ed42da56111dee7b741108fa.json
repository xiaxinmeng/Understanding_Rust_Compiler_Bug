{"sha": "57c5ab1ba6798741ed42da56111dee7b741108fa", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6NTdjNWFiMWJhNjc5ODc0MWVkNDJkYTU2MTExZGVlN2I3NDExMDhmYQ==", "commit": {"author": {"name": "Richard Henderson", "email": "rth@redhat.com", "date": "2012-01-26T21:48:27Z"}, "committer": {"name": "Richard Henderson", "email": "rth@gcc.gnu.org", "date": "2012-01-26T21:48:27Z"}, "message": "Define __GCC_ATOMIC_TEST_AND_SET_TRUEVAL\n\n        * target.def (TARGET_ATOMIC_TEST_AND_SET_TRUEVAL): New.\n        * c-cppbuiltin.c (cpp_atomic_builtins): Define\n        __GCC_ATOMIC_TEST_AND_SET_TRUEVAL.\n        * doc/tm.texi.in (TARGET_ATOMIC_TEST_AND_SET_TRUEVAL): Add doc hook.\n        * doc/tm.texi: Rebuild.\n\nFrom-SVN: r183581", "tree": {"sha": "17b613fdfa5fcce54d686ed0d50230a877200c9b", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/17b613fdfa5fcce54d686ed0d50230a877200c9b"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/57c5ab1ba6798741ed42da56111dee7b741108fa", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/57c5ab1ba6798741ed42da56111dee7b741108fa", "html_url": "https://github.com/Rust-GCC/gccrs/commit/57c5ab1ba6798741ed42da56111dee7b741108fa", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/57c5ab1ba6798741ed42da56111dee7b741108fa/comments", "author": null, "committer": null, "parents": [{"sha": "15e73e0657a51d046752b513b8087adb4131be65", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/15e73e0657a51d046752b513b8087adb4131be65", "html_url": "https://github.com/Rust-GCC/gccrs/commit/15e73e0657a51d046752b513b8087adb4131be65"}], "stats": {"total": 26, "additions": 26, "deletions": 0}, "files": [{"sha": "bbe300f6f6043686c950fc866abf663fc8efac24", "filename": "gcc/ChangeLog", "status": "modified", "additions": 8, "deletions": 0, "changes": 8, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/57c5ab1ba6798741ed42da56111dee7b741108fa/gcc%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/57c5ab1ba6798741ed42da56111dee7b741108fa/gcc%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2FChangeLog?ref=57c5ab1ba6798741ed42da56111dee7b741108fa", "patch": "@@ -1,3 +1,11 @@\n+2012-01-27  Richard Henderson  <rth@redhat.com>\n+\n+\t* target.def (TARGET_ATOMIC_TEST_AND_SET_TRUEVAL): New.\n+\t* c-cppbuiltin.c (cpp_atomic_builtins): Define\n+\t__GCC_ATOMIC_TEST_AND_SET_TRUEVAL.\n+\t* doc/tm.texi.in (TARGET_ATOMIC_TEST_AND_SET_TRUEVAL): Add doc hook.\n+\t* doc/tm.texi: Rebuild.\n+\n 2012-01-27  Richard Henderson  <rth@redhat.com>\n \n \t* optabs.c (gen_atomic_test_and_set): Remove default."}, {"sha": "608dba6ecd42decc80e87f0fcdbe7959c13df42d", "filename": "gcc/c-family/c-cppbuiltin.c", "status": "modified", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/57c5ab1ba6798741ed42da56111dee7b741108fa/gcc%2Fc-family%2Fc-cppbuiltin.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/57c5ab1ba6798741ed42da56111dee7b741108fa/gcc%2Fc-family%2Fc-cppbuiltin.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fc-family%2Fc-cppbuiltin.c?ref=57c5ab1ba6798741ed42da56111dee7b741108fa", "patch": "@@ -670,6 +670,11 @@ cpp_atomic_builtins (cpp_reader *pfile)\n   builtin_define_with_int_value (\"__GCC_ATOMIC_LLONG_LOCK_FREE\", \n \t\t(have_swap[SWAP_INDEX (long_long_integer_type_node)]? 2 : 1));\n \n+  /* If we're dealing with a \"set\" value that doesn't exactly correspond\n+     to a boolean truth value, let the library work around that.  */\n+  builtin_define_with_int_value (\"__GCC_ATOMIC_TEST_AND_SET_TRUEVAL\",\n+\t\t\t\t targetm.atomic_test_and_set_trueval);\n+\n   /* ptr_type_node can't be used here since ptr_mode is only set when\n      toplev calls backend_init which is not done with -E  or pch.  */\n   psize = POINTER_SIZE / BITS_PER_UNIT;"}, {"sha": "91e4b047fe53465903cdea3f63cbdcd04308f471", "filename": "gcc/doc/tm.texi", "status": "modified", "additions": 4, "deletions": 0, "changes": 4, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/57c5ab1ba6798741ed42da56111dee7b741108fa/gcc%2Fdoc%2Ftm.texi", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/57c5ab1ba6798741ed42da56111dee7b741108fa/gcc%2Fdoc%2Ftm.texi", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fdoc%2Ftm.texi?ref=57c5ab1ba6798741ed42da56111dee7b741108fa", "patch": "@@ -11359,3 +11359,7 @@ value of @code{TARGET_CONST_ANCHOR} is a power of 2.  For example, on\n MIPS, where add-immediate takes a 16-bit signed value,\n @code{TARGET_CONST_ANCHOR} is set to @samp{0x8000}.  The default value\n is zero, which disables this optimization.  @end deftypevr\n+\n+@deftypevr {Target Hook} {unsigned char} TARGET_ATOMIC_TEST_AND_SET_TRUEVAL\n+This value should be set if the result written by @code{atomic_test_and_set} is not exactly 1, i.e. the @code{bool} @code{true}.\n+@end deftypevr"}, {"sha": "0ebc15d5ebfd8a897ae18ac2443cd97ef8f16939", "filename": "gcc/doc/tm.texi.in", "status": "modified", "additions": 2, "deletions": 0, "changes": 2, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/57c5ab1ba6798741ed42da56111dee7b741108fa/gcc%2Fdoc%2Ftm.texi.in", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/57c5ab1ba6798741ed42da56111dee7b741108fa/gcc%2Fdoc%2Ftm.texi.in", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fdoc%2Ftm.texi.in?ref=57c5ab1ba6798741ed42da56111dee7b741108fa", "patch": "@@ -11237,3 +11237,5 @@ value of @code{TARGET_CONST_ANCHOR} is a power of 2.  For example, on\n MIPS, where add-immediate takes a 16-bit signed value,\n @code{TARGET_CONST_ANCHOR} is set to @samp{0x8000}.  The default value\n is zero, which disables this optimization.  @end deftypevr\n+\n+@hook TARGET_ATOMIC_TEST_AND_SET_TRUEVAL"}, {"sha": "6084b21dca54eb76324af79833c2fb490a8063b4", "filename": "gcc/target.def", "status": "modified", "additions": 7, "deletions": 0, "changes": 7, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/57c5ab1ba6798741ed42da56111dee7b741108fa/gcc%2Ftarget.def", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/57c5ab1ba6798741ed42da56111dee7b741108fa/gcc%2Ftarget.def", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftarget.def?ref=57c5ab1ba6798741ed42da56111dee7b741108fa", "patch": "@@ -2667,6 +2667,13 @@ DEFHOOK\n  enum unwind_info_type, (void),\n  default_debug_unwind_info)\n \n+DEFHOOKPOD\n+(atomic_test_and_set_trueval,\n+ \"This value should be set if the result written by\\\n+ @code{atomic_test_and_set} is not exactly 1, i.e. the\\\n+ @code{bool} @code{true}.\",\n+ unsigned char, 1)\n+ \n /* Leave the boolean fields at the end.  */\n \n /* True if we can create zeroed data by switching to a BSS section"}]}