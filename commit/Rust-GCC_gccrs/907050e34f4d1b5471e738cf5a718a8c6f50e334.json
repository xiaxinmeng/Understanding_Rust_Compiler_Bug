{"sha": "907050e34f4d1b5471e738cf5a718a8c6f50e334", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6OTA3MDUwZTM0ZjRkMWI1NDcxZTczOGNmNWE3MThhOGM2ZjUwZTMzNA==", "commit": {"author": {"name": "Martin Liska", "email": "mliska@suse.cz", "date": "2018-11-07T09:33:22Z"}, "committer": {"name": "Martin Liska", "email": "marxin@gcc.gnu.org", "date": "2018-11-07T09:33:22Z"}, "message": "Fix UBSAN in postreload-gcse.c (PR rtl-optimization/87868).\n\n2018-11-07  Martin Liska  <mliska@suse.cz>\n\n\tPR rtl-optimization/87868\n\t* postreload-gcse.c (eliminate_partially_redundant_load): Set\n\tthreshold to max_count if we would overflow.\n\t* profile-count.h: Make max_count a public constant.\n\nFrom-SVN: r265869", "tree": {"sha": "deb77b6e57768a9edb6812fdbddb78321929cfb2", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/deb77b6e57768a9edb6812fdbddb78321929cfb2"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/907050e34f4d1b5471e738cf5a718a8c6f50e334", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/907050e34f4d1b5471e738cf5a718a8c6f50e334", "html_url": "https://github.com/Rust-GCC/gccrs/commit/907050e34f4d1b5471e738cf5a718a8c6f50e334", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/907050e34f4d1b5471e738cf5a718a8c6f50e334/comments", "author": {"login": "marxin", "id": 2658545, "node_id": "MDQ6VXNlcjI2NTg1NDU=", "avatar_url": "https://avatars.githubusercontent.com/u/2658545?v=4", "gravatar_id": "", "url": "https://api.github.com/users/marxin", "html_url": "https://github.com/marxin", "followers_url": "https://api.github.com/users/marxin/followers", "following_url": "https://api.github.com/users/marxin/following{/other_user}", "gists_url": "https://api.github.com/users/marxin/gists{/gist_id}", "starred_url": "https://api.github.com/users/marxin/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/marxin/subscriptions", "organizations_url": "https://api.github.com/users/marxin/orgs", "repos_url": "https://api.github.com/users/marxin/repos", "events_url": "https://api.github.com/users/marxin/events{/privacy}", "received_events_url": "https://api.github.com/users/marxin/received_events", "type": "User", "site_admin": false}, "committer": null, "parents": [{"sha": "9cfc08c0491270417557f00998857722c405f0b3", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/9cfc08c0491270417557f00998857722c405f0b3", "html_url": "https://github.com/Rust-GCC/gccrs/commit/9cfc08c0491270417557f00998857722c405f0b3"}], "stats": {"total": 23, "additions": 20, "deletions": 3}, "files": [{"sha": "cb50bad54ad21a902adfe273fd870862c46e92f1", "filename": "gcc/ChangeLog", "status": "modified", "additions": 7, "deletions": 0, "changes": 7, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/907050e34f4d1b5471e738cf5a718a8c6f50e334/gcc%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/907050e34f4d1b5471e738cf5a718a8c6f50e334/gcc%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2FChangeLog?ref=907050e34f4d1b5471e738cf5a718a8c6f50e334", "patch": "@@ -1,3 +1,10 @@\n+2018-11-07  Martin Liska  <mliska@suse.cz>\n+\n+\tPR rtl-optimization/87868\n+\t* postreload-gcse.c (eliminate_partially_redundant_load): Set\n+\tthreshold to max_count if we would overflow.\n+\t* profile-count.h: Make max_count a public constant.\n+\n 2018-11-07  Martin Liska  <mliska@suse.cz>\n \n \t* mem-stats.h: Fix GNU coding style."}, {"sha": "399970c368ae5ee048f8be31b6e8384880e7ef53", "filename": "gcc/postreload-gcse.c", "status": "modified", "additions": 12, "deletions": 2, "changes": 14, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/907050e34f4d1b5471e738cf5a718a8c6f50e334/gcc%2Fpostreload-gcse.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/907050e34f4d1b5471e738cf5a718a8c6f50e334/gcc%2Fpostreload-gcse.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fpostreload-gcse.c?ref=907050e34f4d1b5471e738cf5a718a8c6f50e334", "patch": "@@ -1170,8 +1170,18 @@ eliminate_partially_redundant_load (basic_block bb, rtx_insn *insn,\n   if (ok_count.to_gcov_type ()\n       < GCSE_AFTER_RELOAD_PARTIAL_FRACTION * not_ok_count.to_gcov_type ())\n     goto cleanup;\n-  if (ok_count.to_gcov_type ()\n-      < GCSE_AFTER_RELOAD_CRITICAL_FRACTION * critical_count.to_gcov_type ())\n+\n+  gcov_type threshold;\n+#if (GCC_VERSION >= 5000)\n+  if (__builtin_mul_overflow (GCSE_AFTER_RELOAD_CRITICAL_FRACTION,\n+\t\t\t      critical_count.to_gcov_type (), &threshold))\n+    threshold = profile_count::max_count;\n+#else\n+  threshold\n+    = GCSE_AFTER_RELOAD_CRITICAL_FRACTION * critical_count.to_gcov_type ();\n+#endif\n+\n+  if (ok_count.to_gcov_type () < threshold)\n     goto cleanup;\n \n   /* Generate moves to the loaded register from where"}, {"sha": "5d3bcc75f6d8374a28b9ca36410a7a890d8b30ff", "filename": "gcc/profile-count.h", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/907050e34f4d1b5471e738cf5a718a8c6f50e334/gcc%2Fprofile-count.h", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/907050e34f4d1b5471e738cf5a718a8c6f50e334/gcc%2Fprofile-count.h", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fprofile-count.h?ref=907050e34f4d1b5471e738cf5a718a8c6f50e334", "patch": "@@ -641,8 +641,8 @@ class GTY(()) profile_count\n      type to hold various extra stages.  */\n \n   static const int n_bits = 61;\n-private:\n   static const uint64_t max_count = ((uint64_t) 1 << n_bits) - 2;\n+private:\n   static const uint64_t uninitialized_count = ((uint64_t) 1 << n_bits) - 1;\n \n   uint64_t m_val : n_bits;"}]}