{"sha": "169e464e66d4b35e80d66781c6aa53fcc1726f65", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6MTY5ZTQ2NGU2NmQ0YjM1ZTgwZDY2NzgxYzZhYTUzZmNjMTcyNmY2NQ==", "commit": {"author": {"name": "Jakub Jelinek", "email": "jakub@redhat.com", "date": "2010-02-17T08:54:59Z"}, "committer": {"name": "Jakub Jelinek", "email": "jakub@gcc.gnu.org", "date": "2010-02-17T08:54:59Z"}, "message": "re PR debug/42918 (\"-fcompare-debug failure\" with \"-O2 -ftracer\" (2))\n\n\tPR debug/42918\n\t* caller-save.c (save_call_clobbered_regs): If BB ends with\n\ta DEBUG_INSN, move any notes in between last real insn and the last\n\tDEBUG_INSN after the last DEBUG_INSN.\n\n\t* gcc.dg/pr42918.c: New test.\n\nFrom-SVN: r156823", "tree": {"sha": "a196fe9766e86407931b220895d3d88ed96745e4", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/a196fe9766e86407931b220895d3d88ed96745e4"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/169e464e66d4b35e80d66781c6aa53fcc1726f65", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/169e464e66d4b35e80d66781c6aa53fcc1726f65", "html_url": "https://github.com/Rust-GCC/gccrs/commit/169e464e66d4b35e80d66781c6aa53fcc1726f65", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/169e464e66d4b35e80d66781c6aa53fcc1726f65/comments", "author": {"login": "jakubjelinek", "id": 9370665, "node_id": "MDQ6VXNlcjkzNzA2NjU=", "avatar_url": "https://avatars.githubusercontent.com/u/9370665?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jakubjelinek", "html_url": "https://github.com/jakubjelinek", "followers_url": "https://api.github.com/users/jakubjelinek/followers", "following_url": "https://api.github.com/users/jakubjelinek/following{/other_user}", "gists_url": "https://api.github.com/users/jakubjelinek/gists{/gist_id}", "starred_url": "https://api.github.com/users/jakubjelinek/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jakubjelinek/subscriptions", "organizations_url": "https://api.github.com/users/jakubjelinek/orgs", "repos_url": "https://api.github.com/users/jakubjelinek/repos", "events_url": "https://api.github.com/users/jakubjelinek/events{/privacy}", "received_events_url": "https://api.github.com/users/jakubjelinek/received_events", "type": "User", "site_admin": false}, "committer": null, "parents": [{"sha": "32ade5590ec9650b24dbd0965831397c7b009314", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/32ade5590ec9650b24dbd0965831397c7b009314", "html_url": "https://github.com/Rust-GCC/gccrs/commit/32ade5590ec9650b24dbd0965831397c7b009314"}], "stats": {"total": 68, "additions": 66, "deletions": 2}, "files": [{"sha": "31f251d2c75c6b5a6802a27c12bbda622fbe91a3", "filename": "gcc/ChangeLog", "status": "modified", "additions": 7, "deletions": 0, "changes": 7, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/169e464e66d4b35e80d66781c6aa53fcc1726f65/gcc%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/169e464e66d4b35e80d66781c6aa53fcc1726f65/gcc%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2FChangeLog?ref=169e464e66d4b35e80d66781c6aa53fcc1726f65", "patch": "@@ -1,3 +1,10 @@\n+2010-02-17  Jakub Jelinek  <jakub@redhat.com>\n+\n+\tPR debug/42918\n+\t* caller-save.c (save_call_clobbered_regs): If BB ends with\n+\ta DEBUG_INSN, move any notes in between last real insn and the last\n+\tDEBUG_INSN after the last DEBUG_INSN.\n+\n 2010-02-16  Joern Rennecke  <joern.rennecke@embecosm.com>\n \n \t* tm.texi (TARGET_SCHED_FIRST_CYCLE_MULTIPASS_DFA_LOOKAHEAD_GUARD_SPEC):"}, {"sha": "dbfd42aa7936d03cadd9d0fc91cb760f02212a2f", "filename": "gcc/caller-save.c", "status": "modified", "additions": 33, "deletions": 2, "changes": 35, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/169e464e66d4b35e80d66781c6aa53fcc1726f65/gcc%2Fcaller-save.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/169e464e66d4b35e80d66781c6aa53fcc1726f65/gcc%2Fcaller-save.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fcaller-save.c?ref=169e464e66d4b35e80d66781c6aa53fcc1726f65", "patch": "@@ -1,6 +1,6 @@\n /* Save and restore call-clobbered registers which are live across a call.\n    Copyright (C) 1989, 1992, 1994, 1995, 1997, 1998, 1999, 2000,\n-   2001, 2002, 2003, 2004, 2005, 2006, 2007, 2008, 2009\n+   2001, 2002, 2003, 2004, 2005, 2006, 2007, 2008, 2009, 2010\n    Free Software Foundation, Inc.\n \n This file is part of GCC.\n@@ -754,7 +754,7 @@ setup_save_areas (void)\n void\n save_call_clobbered_regs (void)\n {\n-  struct insn_chain *chain, *next;\n+  struct insn_chain *chain, *next, *last = NULL;\n   enum machine_mode save_mode [FIRST_PSEUDO_REGISTER];\n \n   /* Computed in mark_set_regs, holds all registers set by the current\n@@ -861,6 +861,7 @@ save_call_clobbered_regs (void)\n \t\tif (TEST_HARD_REG_BIT (hard_regs_saved, regno))\n \t\t  n_regs_saved++;\n \t    }\n+          last = chain;\n \t}\n       else if (DEBUG_INSN_P (insn) && n_regs_saved)\n \tmark_referenced_regs (&PATTERN (insn),\n@@ -874,6 +875,36 @@ save_call_clobbered_regs (void)\n \t     remain saved.  If the last insn in the block is a JUMP_INSN, put\n \t     the restore before the insn, otherwise, put it after the insn.  */\n \n+\t  if (DEBUG_INSN_P (insn) && last && last->block == chain->block)\n+\t    {\n+\t      rtx ins, prev;\n+\t      basic_block bb = BLOCK_FOR_INSN (insn);\n+\n+\t      /* When adding hard reg restores after a DEBUG_INSN, move\n+\t\t all notes between last real insn and this DEBUG_INSN after\n+\t\t the DEBUG_INSN, otherwise we could get code\n+\t\t -g/-g0 differences.  */\n+\t      for (ins = PREV_INSN (insn); ins != last->insn; ins = prev)\n+\t\t{\n+\t\t  prev = PREV_INSN (ins);\n+\t\t  if (NOTE_P (ins))\n+\t\t    {\n+\t\t      NEXT_INSN (prev) = NEXT_INSN (ins);\n+\t\t      PREV_INSN (NEXT_INSN (ins)) = prev;\n+\t\t      PREV_INSN (ins) = insn;\n+\t\t      NEXT_INSN (ins) = NEXT_INSN (insn);\n+\t\t      NEXT_INSN (insn) = ins;\n+\t\t      if (NEXT_INSN (ins))\n+\t\t\tPREV_INSN (NEXT_INSN (ins)) = ins;\n+                      if (BB_END (bb) == insn)\n+\t\t\tBB_END (bb) = ins;\n+\t\t    }\n+\t\t  else\n+\t\t    gcc_assert (DEBUG_INSN_P (ins));\n+\t\t}\n+\t    }\n+\t  last = NULL;\n+\n \t  if (n_regs_saved)\n \t    for (regno = 0; regno < FIRST_PSEUDO_REGISTER; regno++)\n \t      if (TEST_HARD_REG_BIT (hard_regs_saved, regno))"}, {"sha": "7d3f9bdfb47b5749735b86a92630ab69c47f16c5", "filename": "gcc/testsuite/ChangeLog", "status": "modified", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/169e464e66d4b35e80d66781c6aa53fcc1726f65/gcc%2Ftestsuite%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/169e464e66d4b35e80d66781c6aa53fcc1726f65/gcc%2Ftestsuite%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2FChangeLog?ref=169e464e66d4b35e80d66781c6aa53fcc1726f65", "patch": "@@ -1,3 +1,8 @@\n+2010-02-17  Jakub Jelinek  <jakub@redhat.com>\n+\n+\tPR debug/42918\n+\t* gcc.dg/pr42918.c: New test.\n+\n 2010-02-16  H.J. Lu  <hongjiu.lu@intel.com>\n \n \t* g++.dg/ext/attrib36.C: Require ILP32."}, {"sha": "8a3eef5eeecba9de4633a65361ef28cf2d2d564e", "filename": "gcc/testsuite/gcc.dg/pr42918.c", "status": "added", "additions": 21, "deletions": 0, "changes": 21, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/169e464e66d4b35e80d66781c6aa53fcc1726f65/gcc%2Ftestsuite%2Fgcc.dg%2Fpr42918.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/169e464e66d4b35e80d66781c6aa53fcc1726f65/gcc%2Ftestsuite%2Fgcc.dg%2Fpr42918.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgcc.dg%2Fpr42918.c?ref=169e464e66d4b35e80d66781c6aa53fcc1726f65", "patch": "@@ -0,0 +1,21 @@\n+/* PR debug/42918 */\n+/* { dg-do compile } */\n+/* { dg-options \"-O2 -fcompare-debug -ftracer\" } */\n+\n+extern int fi (void);\n+extern void fv (void);\n+\n+int\n+f (int i, int j)\n+{\n+  if (!j)\n+    {\n+      fv ();\n+      goto lab;\n+    }\n+  i = fi ();\n+  if (i == j)\n+    fv ();\n+lab:\n+  return i;\n+}"}]}