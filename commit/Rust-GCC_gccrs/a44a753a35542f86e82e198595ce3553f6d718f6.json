{"sha": "a44a753a35542f86e82e198595ce3553f6d718f6", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6YTQ0YTc1M2EzNTU0MmY4NmU4MmUxOTg1OTVjZTM1NTNmNmQ3MThmNg==", "commit": {"author": {"name": "Jason Merrill", "email": "jason@redhat.com", "date": "2021-04-02T09:45:02Z"}, "committer": {"name": "Jason Merrill", "email": "jason@redhat.com", "date": "2021-04-05T12:25:26Z"}, "message": "c++: Fix print-tree for TEMPLATE_DECL\n\nThe if allows TEMPLATE_DECL, but then checking DECL_MODULE_IMPORT_P crashes\non TEMPLATE_DECL.  Fixed by stripping TEMPLATE_DECL first.\n\ngcc/cp/ChangeLog:\n\n\t* ptree.c (cxx_print_decl): Check DECL_MODULE_IMPORT_P on\n\ttemplate result.", "tree": {"sha": "f51f1d34591c29e5b8119d594c2566ee786d2bf3", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/f51f1d34591c29e5b8119d594c2566ee786d2bf3"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/a44a753a35542f86e82e198595ce3553f6d718f6", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/a44a753a35542f86e82e198595ce3553f6d718f6", "html_url": "https://github.com/Rust-GCC/gccrs/commit/a44a753a35542f86e82e198595ce3553f6d718f6", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/a44a753a35542f86e82e198595ce3553f6d718f6/comments", "author": {"login": "jicama", "id": 266146, "node_id": "MDQ6VXNlcjI2NjE0Ng==", "avatar_url": "https://avatars.githubusercontent.com/u/266146?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jicama", "html_url": "https://github.com/jicama", "followers_url": "https://api.github.com/users/jicama/followers", "following_url": "https://api.github.com/users/jicama/following{/other_user}", "gists_url": "https://api.github.com/users/jicama/gists{/gist_id}", "starred_url": "https://api.github.com/users/jicama/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jicama/subscriptions", "organizations_url": "https://api.github.com/users/jicama/orgs", "repos_url": "https://api.github.com/users/jicama/repos", "events_url": "https://api.github.com/users/jicama/events{/privacy}", "received_events_url": "https://api.github.com/users/jicama/received_events", "type": "User", "site_admin": false}, "committer": {"login": "jicama", "id": 266146, "node_id": "MDQ6VXNlcjI2NjE0Ng==", "avatar_url": "https://avatars.githubusercontent.com/u/266146?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jicama", "html_url": "https://github.com/jicama", "followers_url": "https://api.github.com/users/jicama/followers", "following_url": "https://api.github.com/users/jicama/following{/other_user}", "gists_url": "https://api.github.com/users/jicama/gists{/gist_id}", "starred_url": "https://api.github.com/users/jicama/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jicama/subscriptions", "organizations_url": "https://api.github.com/users/jicama/orgs", "repos_url": "https://api.github.com/users/jicama/repos", "events_url": "https://api.github.com/users/jicama/events{/privacy}", "received_events_url": "https://api.github.com/users/jicama/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "76a7e7e706ac4c01cead3c6514322aaad88f9a63", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/76a7e7e706ac4c01cead3c6514322aaad88f9a63", "html_url": "https://github.com/Rust-GCC/gccrs/commit/76a7e7e706ac4c01cead3c6514322aaad88f9a63"}], "stats": {"total": 18, "additions": 9, "deletions": 9}, "files": [{"sha": "33b73fb24b610b7492881a2d4d5b4b9c0f619829", "filename": "gcc/cp/ptree.c", "status": "modified", "additions": 9, "deletions": 9, "changes": 18, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/a44a753a35542f86e82e198595ce3553f6d718f6/gcc%2Fcp%2Fptree.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/a44a753a35542f86e82e198595ce3553f6d718f6/gcc%2Fcp%2Fptree.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fcp%2Fptree.c?ref=a44a753a35542f86e82e198595ce3553f6d718f6", "patch": "@@ -59,16 +59,16 @@ cxx_print_decl (FILE *file, tree node, int indent)\n \n   bool need_indent = true;\n \n-  if (TREE_CODE (node) == FUNCTION_DECL\n-      || TREE_CODE (node) == VAR_DECL\n-      || TREE_CODE (node) == TYPE_DECL\n-      || TREE_CODE (node) == TEMPLATE_DECL\n-      || TREE_CODE (node) == CONCEPT_DECL\n-      || TREE_CODE (node) == NAMESPACE_DECL)\n+  tree ntnode = STRIP_TEMPLATE (node);\n+  if (TREE_CODE (ntnode) == FUNCTION_DECL\n+      || TREE_CODE (ntnode) == VAR_DECL\n+      || TREE_CODE (ntnode) == TYPE_DECL\n+      || TREE_CODE (ntnode) == CONCEPT_DECL\n+      || TREE_CODE (ntnode) == NAMESPACE_DECL)\n     {\n       unsigned m = 0;\n-      if (DECL_LANG_SPECIFIC (node) && DECL_MODULE_IMPORT_P (node))\n-\tm = get_importing_module (node, true);\n+      if (DECL_LANG_SPECIFIC (ntnode) && DECL_MODULE_IMPORT_P (ntnode))\n+\tm = get_importing_module (ntnode, true);\n \n       if (const char *name = m == ~0u ? \"\" : module_name (m, true))\n \t{\n@@ -78,7 +78,7 @@ cxx_print_decl (FILE *file, tree node, int indent)\n \t  need_indent = false;\n \t}\n \n-      if (DECL_LANG_SPECIFIC (node) && DECL_MODULE_PURVIEW_P (node))\n+      if (DECL_LANG_SPECIFIC (ntnode) && DECL_MODULE_PURVIEW_P (ntnode))\n \t{\n \t  if (need_indent)\n \t    indent_to (file, indent + 3);"}]}