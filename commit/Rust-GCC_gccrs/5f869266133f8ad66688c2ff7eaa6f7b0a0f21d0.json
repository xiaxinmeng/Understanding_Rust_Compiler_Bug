{"sha": "5f869266133f8ad66688c2ff7eaa6f7b0a0f21d0", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6NWY4NjkyNjYxMzNmOGFkNjY2ODhjMmZmN2VhYTZmN2IwYTBmMjFkMA==", "commit": {"author": {"name": "Thomas Koenig", "email": "tkoenig@gcc.gnu.org", "date": "2016-10-10T14:54:26Z"}, "committer": {"name": "Thomas Koenig", "email": "tkoenig@gcc.gnu.org", "date": "2016-10-10T14:54:26Z"}, "message": "re PR fortran/77915 (Internal error for matmul() in forall with optimization)\n\n2016-10-10  Thomas Koenig  <tkoenig@gcc.gnu.org>\n\n\tPR fortran/77915\n\t* frontend-passes.c (inline_matmul_assign):  Return early if\n\tinside a FORALL statement.\n\n2016-10-10  Thomas Koenig  <tkoenig@gcc.gnu.org>\n\n\tPR fortran/77915\n\t* gfortran.dg/matmul_11.f90:  New test.\n\nFrom-SVN: r240928", "tree": {"sha": "81daa01489f3f82ffbbcac8223f78118e1104e64", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/81daa01489f3f82ffbbcac8223f78118e1104e64"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/5f869266133f8ad66688c2ff7eaa6f7b0a0f21d0", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/5f869266133f8ad66688c2ff7eaa6f7b0a0f21d0", "html_url": "https://github.com/Rust-GCC/gccrs/commit/5f869266133f8ad66688c2ff7eaa6f7b0a0f21d0", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/5f869266133f8ad66688c2ff7eaa6f7b0a0f21d0/comments", "author": null, "committer": null, "parents": [{"sha": "df48be86ac5f93b02b639da1a9295411d57c1c28", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/df48be86ac5f93b02b639da1a9295411d57c1c28", "html_url": "https://github.com/Rust-GCC/gccrs/commit/df48be86ac5f93b02b639da1a9295411d57c1c28"}], "stats": {"total": 30, "additions": 30, "deletions": 0}, "files": [{"sha": "0c54c6bdae6a17efbdc088de77a6f902839c3411", "filename": "gcc/fortran/ChangeLog", "status": "modified", "additions": 6, "deletions": 0, "changes": 6, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/5f869266133f8ad66688c2ff7eaa6f7b0a0f21d0/gcc%2Ffortran%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/5f869266133f8ad66688c2ff7eaa6f7b0a0f21d0/gcc%2Ffortran%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ffortran%2FChangeLog?ref=5f869266133f8ad66688c2ff7eaa6f7b0a0f21d0", "patch": "@@ -1,3 +1,9 @@\n+2016-10-10  Thomas Koenig  <tkoenig@gcc.gnu.org>\n+\n+\tPR fortran/77915\n+\t* frontend-passes.c (inline_matmul_assign):  Return early if\n+\tinside a FORALL statement.\n+\n 2016-10-07  Fritz Reese  <fritzoreese@gmail.com>\n \n \t* interface.c (compare_components): Check charlen for BT_CHAR."}, {"sha": "53b3c546f887894586a86e3a2a6553a7498ea0b8", "filename": "gcc/fortran/frontend-passes.c", "status": "modified", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/5f869266133f8ad66688c2ff7eaa6f7b0a0f21d0/gcc%2Ffortran%2Ffrontend-passes.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/5f869266133f8ad66688c2ff7eaa6f7b0a0f21d0/gcc%2Ffortran%2Ffrontend-passes.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ffortran%2Ffrontend-passes.c?ref=5f869266133f8ad66688c2ff7eaa6f7b0a0f21d0", "patch": "@@ -2857,6 +2857,11 @@ inline_matmul_assign (gfc_code **c, int *walk_subtrees,\n   if (in_where)\n     return 0;\n \n+  /* The BLOCKS generated for the temporary variables and FORALL don't\n+     mix.  */\n+  if (forall_level > 0)\n+    return 0;\n+\n   /* For now don't do anything in OpenMP workshare, it confuses\n      its translation, which expects only the allowed statements in there.\n      We should figure out how to parallelize this eventually.  */"}, {"sha": "04966cfbe5cd0b67a46c1d978f65fe8a8e36e3f9", "filename": "gcc/testsuite/ChangeLog", "status": "modified", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/5f869266133f8ad66688c2ff7eaa6f7b0a0f21d0/gcc%2Ftestsuite%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/5f869266133f8ad66688c2ff7eaa6f7b0a0f21d0/gcc%2Ftestsuite%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2FChangeLog?ref=5f869266133f8ad66688c2ff7eaa6f7b0a0f21d0", "patch": "@@ -1,3 +1,8 @@\n+2016-10-10  Thomas Koenig  <tkoenig@gcc.gnu.org>\n+\n+\tPR fortran/77915\n+\t* gfortran.dg/matmul_11.f90:  New test.\n+\n 2016-10-10  Jiong Wang  <jiong.wang@arm.com>\n \n \t* gcc.target/aarch64/advsimd-intrinsics/unary_scalar_op.inc: Support FMT64."}, {"sha": "6907fa14bcd8e55fb2a1b99c79db0ff63c5fb775", "filename": "gcc/testsuite/gfortran.dg/matmul_11.f90", "status": "added", "additions": 14, "deletions": 0, "changes": 14, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/5f869266133f8ad66688c2ff7eaa6f7b0a0f21d0/gcc%2Ftestsuite%2Fgfortran.dg%2Fmatmul_11.f90", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/5f869266133f8ad66688c2ff7eaa6f7b0a0f21d0/gcc%2Ftestsuite%2Fgfortran.dg%2Fmatmul_11.f90", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgfortran.dg%2Fmatmul_11.f90?ref=5f869266133f8ad66688c2ff7eaa6f7b0a0f21d0", "patch": "@@ -0,0 +1,14 @@\n+! { dg-do compile }\n+! { dg-options \"-ffrontend-optimize -fdump-tree-original\" }\n+! PR 77915 - ICE of matmul with forall.\n+program x\n+  integer, parameter :: d = 3\n+  real,dimension(d,d,d) :: cube,xcube\n+  real, dimension(d,d) :: cmatrix\n+  integer :: i,j\n+  forall(i=1:d,j=1:d)\n+     xcube(i,j,:) = matmul(cmatrix,cube(i,j,:))\n+  end forall\n+end program x\n+\n+! { dg-final { scan-tree-dump-times \"_gfortran_matmul\" 1 \"original\" } }"}]}