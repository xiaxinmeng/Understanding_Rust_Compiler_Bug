{"sha": "731ae8dd8e76be10feb5a1286ed45825a59095c9", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6NzMxYWU4ZGQ4ZTc2YmUxMGZlYjVhMTI4NmVkNDU4MjVhNTkwOTVjOQ==", "commit": {"author": {"name": "Roger Sayle", "email": "roger@eyesopen.com", "date": "2003-05-18T22:50:29Z"}, "committer": {"name": "Roger Sayle", "email": "sayle@gcc.gnu.org", "date": "2003-05-18T22:50:29Z"}, "message": "re PR middle-end/10472 (ICE in instantiate_virtual_regs_lossage)\n\n\n\tPR middle-end/10472\n\t* builtins.c (expand_builtin_memcpy):  Call force_operand on\n\texpressions and use simplify_gen_binary to create the addition.\n\n\t* gcc.c-torture/compile/20030518-1.c: New test case.\n\nCo-Authored-By: Kaveh R. Ghazi <ghazi@caip.rutgers.edu>\nCo-Authored-By: Zack Weinberg <zack@codesourcery.com>\n\nFrom-SVN: r66941", "tree": {"sha": "2c5a4fef2fea4ee8851e816f5d8c43eaad5e04f9", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/2c5a4fef2fea4ee8851e816f5d8c43eaad5e04f9"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/731ae8dd8e76be10feb5a1286ed45825a59095c9", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/731ae8dd8e76be10feb5a1286ed45825a59095c9", "html_url": "https://github.com/Rust-GCC/gccrs/commit/731ae8dd8e76be10feb5a1286ed45825a59095c9", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/731ae8dd8e76be10feb5a1286ed45825a59095c9/comments", "author": null, "committer": null, "parents": [{"sha": "d1b3178b37f1930e3e8bdce625bd870107baa37d", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/d1b3178b37f1930e3e8bdce625bd870107baa37d", "html_url": "https://github.com/Rust-GCC/gccrs/commit/d1b3178b37f1930e3e8bdce625bd870107baa37d"}], "stats": {"total": 51, "additions": 45, "deletions": 6}, "files": [{"sha": "96f2290c53f20f7ba09346ca656c6dd16b920f69", "filename": "gcc/ChangeLog", "status": "modified", "additions": 7, "deletions": 0, "changes": 7, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/731ae8dd8e76be10feb5a1286ed45825a59095c9/gcc%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/731ae8dd8e76be10feb5a1286ed45825a59095c9/gcc%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2FChangeLog?ref=731ae8dd8e76be10feb5a1286ed45825a59095c9", "patch": "@@ -1,3 +1,10 @@\n+2003-05-18  Roger Sayle  <roger@eyesopen.com>\n+\t    Zack Weinberg  <zack@codesourcery.com>\n+\n+\tPR middle-end/10472\n+\t* builtins.c (expand_builtin_memcpy):  Call force_operand on\n+\texpressions and use simplify_gen_binary to create the addition.\n+\n 2003-05-18  Andreas Schwab  <schwab@suse.de>\n \n \t* config/m68k/m68k.md: Use define_constants for unspec numbers."}, {"sha": "c3cb06dba3decadf34974f914b61eecc76ebef2b", "filename": "gcc/builtins.c", "status": "modified", "additions": 19, "deletions": 6, "changes": 25, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/731ae8dd8e76be10feb5a1286ed45825a59095c9/gcc%2Fbuiltins.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/731ae8dd8e76be10feb5a1286ed45825a59095c9/gcc%2Fbuiltins.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fbuiltins.c?ref=731ae8dd8e76be10feb5a1286ed45825a59095c9", "patch": "@@ -2311,10 +2311,15 @@ expand_builtin_memcpy (arglist, target, mode, endp)\n #endif\n \t  if (endp)\n \t    {\n-\t      rtx result = gen_rtx_PLUS (GET_MODE (dest_mem), dest_mem, len_rtx);\n+\t      rtx result;\n+\t      rtx delta = len_rtx;\n+\n \t      if (endp == 2)\n-\t\tresult = simplify_gen_binary (MINUS, GET_MODE (result), result, const1_rtx);\n-\t      return result;\n+\t\tdelta = GEN_INT (INTVAL (delta) - 1);\n+\n+\t      result = simplify_gen_binary (PLUS, GET_MODE (dest_mem),\n+\t\t\t\t\t    dest_mem, delta);\n+\t      return force_operand (result, NULL_RTX);\n \t    }\n \t  else\n \t    return dest_mem;\n@@ -2338,10 +2343,18 @@ expand_builtin_memcpy (arglist, target, mode, endp)\n \n       if (endp)\n         {\n-\t  rtx result = gen_rtx_PLUS (GET_MODE (dest_addr), dest_addr, len_rtx);\n+\t  rtx result = force_operand (len_rtx, NULL_RTX);\n+\n \t  if (endp == 2)\n-\t    result = simplify_gen_binary (MINUS, GET_MODE (result), result, const1_rtx);\n-\t  return result;\n+\t    {\n+\t      result = simplify_gen_binary (MINUS, GET_MODE (result),\n+\t\t\t\t\t    result, const1_rtx);\n+\t      result = force_operand (result, NULL_RTX);\n+\t    }\n+\n+\t  result = simplify_gen_binary (PLUS, GET_MODE (dest_addr),\n+\t\t\t\t\tdest_addr, result);\n+\t  return force_operand (result, NULL_RTX);\n \t}\n       else\n \treturn dest_addr;"}, {"sha": "9d036cc5b786eb4f485fb494ca69f4ed041a38dc", "filename": "gcc/testsuite/ChangeLog", "status": "modified", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/731ae8dd8e76be10feb5a1286ed45825a59095c9/gcc%2Ftestsuite%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/731ae8dd8e76be10feb5a1286ed45825a59095c9/gcc%2Ftestsuite%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2FChangeLog?ref=731ae8dd8e76be10feb5a1286ed45825a59095c9", "patch": "@@ -1,3 +1,8 @@\n+2003-05-18  Roger Sayle  <roger@eyesopen.com>\n+\t    Kaveh R. Ghazi  <ghazi@caip.rutgers.edu>\n+\n+\t* gcc.c-torture/compile/20030518-1.c: New test case.\n+\n 2003-05-18  Mark Mitchell  <mark@codesourcery.com>\n \n \t* lib/gcc-dg.exp (gcc-dg-debug-runtest): Add opt_opts parameter."}, {"sha": "8cf2034518f90e5b97980ed01d09f0d6feff6cc5", "filename": "gcc/testsuite/gcc.c-torture/compile/20030518-1.c", "status": "added", "additions": 14, "deletions": 0, "changes": 14, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/731ae8dd8e76be10feb5a1286ed45825a59095c9/gcc%2Ftestsuite%2Fgcc.c-torture%2Fcompile%2F20030518-1.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/731ae8dd8e76be10feb5a1286ed45825a59095c9/gcc%2Ftestsuite%2Fgcc.c-torture%2Fcompile%2F20030518-1.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgcc.c-torture%2Fcompile%2F20030518-1.c?ref=731ae8dd8e76be10feb5a1286ed45825a59095c9", "patch": "@@ -0,0 +1,14 @@\n+/* Test case from PR middle-end/10472  */\n+\n+extern void f (char *);\n+\n+void foo (char *s)\n+{\n+  f (__builtin_stpcpy (s, \"hi\"));\n+}\n+\n+void bar (char *s)\n+{\n+  f (__builtin_mempcpy (s, \"hi\", 3));\n+}\n+"}]}