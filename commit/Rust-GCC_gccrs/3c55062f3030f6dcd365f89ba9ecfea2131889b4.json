{"sha": "3c55062f3030f6dcd365f89ba9ecfea2131889b4", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6M2M1NTA2MmYzMDMwZjZkY2QzNjVmODliYTllY2ZlYTIxMzE4ODliNA==", "commit": {"author": {"name": "Bernard Banner", "email": "banner@adacore.com", "date": "2012-11-06T09:41:56Z"}, "committer": {"name": "Arnaud Charlet", "email": "charlet@gcc.gnu.org", "date": "2012-11-06T09:41:56Z"}, "message": "2012-11-06  Bernard Banner  <banner@adacore.com>\n\n\t* adaint.c Add file macro definitions missing on Android.\n\t* adaint.h Avoid definitions related to task affinity and CPU\n\tsets since this functionality is missing on the Android\n\t* errno.c (__set_errno): Android already contains such a named\n\tprocedure so do include again.\n\t* gsocket.h: Sockets not supported on Android.\n\t* init.c: Avoid linux related code not supported on Android.\n\t* sysdep.c (sigismember, sigaddset, sigdelset, sigemptyset,\n\tsigfillset): wrapper functions since sig routines are defined\n\tas inline macros on Android.\n\t* terminals.c: Add stubs for terminal related functions not\n\tsupported on Android.\n\nFrom-SVN: r193213", "tree": {"sha": "592dfa4c5da0b2f747924e5303aa856760fe858d", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/592dfa4c5da0b2f747924e5303aa856760fe858d"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/3c55062f3030f6dcd365f89ba9ecfea2131889b4", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/3c55062f3030f6dcd365f89ba9ecfea2131889b4", "html_url": "https://github.com/Rust-GCC/gccrs/commit/3c55062f3030f6dcd365f89ba9ecfea2131889b4", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/3c55062f3030f6dcd365f89ba9ecfea2131889b4/comments", "author": null, "committer": null, "parents": [{"sha": "055311ddefe5674b074075c3720e23693370f062", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/055311ddefe5674b074075c3720e23693370f062", "html_url": "https://github.com/Rust-GCC/gccrs/commit/055311ddefe5674b074075c3720e23693370f062"}], "stats": {"total": 101, "additions": 95, "deletions": 6}, "files": [{"sha": "fb23cb399ba0478c63c74599e4bb1c3b0592f780", "filename": "gcc/ada/ChangeLog", "status": "modified", "additions": 15, "deletions": 0, "changes": 15, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/3c55062f3030f6dcd365f89ba9ecfea2131889b4/gcc%2Fada%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/3c55062f3030f6dcd365f89ba9ecfea2131889b4/gcc%2Fada%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fada%2FChangeLog?ref=3c55062f3030f6dcd365f89ba9ecfea2131889b4", "patch": "@@ -1,3 +1,18 @@\n+2012-11-06  Bernard Banner  <banner@adacore.com>\n+\n+\t* adaint.c Add file macro definitions missing on Android.\n+\t* adaint.h Avoid definitions related to task affinity and CPU\n+\tsets since this functionality is missing on the Android\n+\t* errno.c (__set_errno): Android already contains such a named\n+\tprocedure so do include again.\n+\t* gsocket.h: Sockets not supported on Android.\n+\t* init.c: Avoid linux related code not supported on Android.\n+\t* sysdep.c (sigismember, sigaddset, sigdelset, sigemptyset,\n+\tsigfillset): wrapper functions since sig routines are defined\n+\tas inline macros on Android.\n+\t* terminals.c: Add stubs for terminal related functions not\n+\tsupported on Android.\n+\n 2012-11-06  Hristian Kirtchev  <kirtchev@adacore.com>\n \n \t* sem_prag.adb (Analyze_Pragma): Do not"}, {"sha": "eab3ea5fbae84d991309deb71323ec38bd712051", "filename": "gcc/ada/adaint.c", "status": "modified", "additions": 12, "deletions": 3, "changes": 15, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/3c55062f3030f6dcd365f89ba9ecfea2131889b4/gcc%2Fada%2Fadaint.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/3c55062f3030f6dcd365f89ba9ecfea2131889b4/gcc%2Fada%2Fadaint.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fada%2Fadaint.c?ref=3c55062f3030f6dcd365f89ba9ecfea2131889b4", "patch": "@@ -87,8 +87,8 @@ extern \"C\" {\n #include <unixio.h>\n #endif\n \n-#ifdef __vxworks\n-/* S_IREAD and S_IWRITE are not defined in VxWorks */\n+#if defined (__vxworks) || defined (__ANDROID__)\n+/* S_IREAD and S_IWRITE are not defined in VxWorks or Android */\n #ifndef S_IREAD\n #define S_IREAD  (S_IRUSR | S_IRGRP | S_IROTH)\n #endif\n@@ -3763,7 +3763,16 @@ void __main (void) {}\n #endif\n #endif\n \n-#if defined (linux)\n+#if defined (__ANDROID__)\n+\n+#include <pthread.h>\n+\n+void *__gnat_lwp_self (void)\n+{\n+   return (void *) pthread_self ();\n+}\n+\n+#elif defined (linux)\n /* There is no function in the glibc to retrieve the LWP of the current\n    thread. We need to do a system call in order to retrieve this\n    information. */"}, {"sha": "7956e27a709f705d0dd6d0e8d709b9af48226c1c", "filename": "gcc/ada/adaint.h", "status": "modified", "additions": 5, "deletions": 1, "changes": 6, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/3c55062f3030f6dcd365f89ba9ecfea2131889b4/gcc%2Fada%2Fadaint.h", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/3c55062f3030f6dcd365f89ba9ecfea2131889b4/gcc%2Fada%2Fadaint.h", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fada%2Fadaint.h?ref=3c55062f3030f6dcd365f89ba9ecfea2131889b4", "patch": "@@ -250,7 +250,11 @@ extern char * __gnat_locate_executable_file        (char *, char *);\n extern char * __gnat_locate_file_with_predicate    (char *, char *,\n \t\t\t\t\t\t    int (*)(char*));\n \n-#if defined (linux)\n+#if defined (__ANDROID__)\n+#undef linux\n+extern void   *__gnat_lwp_self                     (void);\n+\n+#elif defined (linux)\n extern void   *__gnat_lwp_self\t\t\t   (void);\n \n /* Routines for interface to required CPU set primitives */"}, {"sha": "2fbeacc3ec1c4fc157551c5c6e3c116b7f975d77", "filename": "gcc/ada/errno.c", "status": "modified", "additions": 2, "deletions": 0, "changes": 2, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/3c55062f3030f6dcd365f89ba9ecfea2131889b4/gcc%2Fada%2Ferrno.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/3c55062f3030f6dcd365f89ba9ecfea2131889b4/gcc%2Fada%2Ferrno.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fada%2Ferrno.c?ref=3c55062f3030f6dcd365f89ba9ecfea2131889b4", "patch": "@@ -58,8 +58,10 @@ __get_errno(void)\n   return errno;\n }\n \n+#ifndef __ANDROID__\n void\n __set_errno(int err)\n {\n   errno = err;\n }\n+#endif"}, {"sha": "e21d7142701f71725c4e561f822bc78deaf56034", "filename": "gcc/ada/gsocket.h", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/3c55062f3030f6dcd365f89ba9ecfea2131889b4/gcc%2Fada%2Fgsocket.h", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/3c55062f3030f6dcd365f89ba9ecfea2131889b4/gcc%2Fada%2Fgsocket.h", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fada%2Fgsocket.h?ref=3c55062f3030f6dcd365f89ba9ecfea2131889b4", "patch": "@@ -29,7 +29,7 @@\n  *                                                                          *\n  ****************************************************************************/\n \n-#if defined(__nucleus__) || defined(VTHREADS)\n+#if defined(__nucleus__) || defined(VTHREADS) || defined(__ANDROID__)\n \n #warning Sockets not supported on these platforms\n #undef HAVE_SOCKETS"}, {"sha": "e7283a20146890952789adaaaafb19922d99e951", "filename": "gcc/ada/init.c", "status": "modified", "additions": 4, "deletions": 0, "changes": 4, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/3c55062f3030f6dcd365f89ba9ecfea2131889b4/gcc%2Fada%2Finit.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/3c55062f3030f6dcd365f89ba9ecfea2131889b4/gcc%2Fada%2Finit.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fada%2Finit.c?ref=3c55062f3030f6dcd365f89ba9ecfea2131889b4", "patch": "@@ -52,6 +52,10 @@ extern \"C\" {\n #include \"vxWorks.h\"\n #endif\n \n+#ifdef __ANDROID__\n+#undef linux\n+#endif\n+\n #ifdef IN_RTS\n #include \"tconfig.h\"\n #include \"tsystem.h\""}, {"sha": "62a96ddea55e01708a0d0f964300dd044993d5ba", "filename": "gcc/ada/sysdep.c", "status": "modified", "additions": 54, "deletions": 0, "changes": 54, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/3c55062f3030f6dcd365f89ba9ecfea2131889b4/gcc%2Fada%2Fsysdep.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/3c55062f3030f6dcd365f89ba9ecfea2131889b4/gcc%2Fada%2Fsysdep.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fada%2Fsysdep.c?ref=3c55062f3030f6dcd365f89ba9ecfea2131889b4", "patch": "@@ -44,6 +44,10 @@\n #include \"vxWorks.h\"\n #endif\n \n+#ifdef __ANDROID__\n+#undef linux\n+#endif\n+\n #ifdef IN_RTS\n #define POSIX\n #include \"tconfig.h\"\n@@ -923,3 +927,53 @@ __gnat_is_file_not_found_error (int errno_val) {\n          return 0;\n    }\n }\n+\n+#ifdef __ANDROID__\n+\n+/* Provide extern symbols for sig* as needed by the tasking run-time, instead\n+   of static inline functions.  */\n+\n+#define sigismember android_sigismember\n+#define sigaddset android_sigaddset\n+#define sigdelset android_sigdelset\n+#define sigemptyset android_sigemptyset\n+#define sigfillset android_sigfillset\n+\n+#include <signal.h>\n+\n+#undef sigismember\n+#undef sigaddset\n+#undef sigdelset\n+#undef sigemptyset\n+#undef sigfillset\n+\n+int\n+sigismember (sigset_t *set, int signum)\n+{\n+    return android_sigismember (set, signum);\n+}\n+\n+int\n+sigaddset (sigset_t *set, int signum)\n+{\n+   return android_sigaddset (set, signum);\n+}\n+\n+int\n+sigdelset (sigset_t *set, int signum)\n+{\n+   return android_sigdelset (set, signum);\n+}\n+\n+int\n+sigemptyset (sigset_t *set)\n+{\n+    return android_sigemptyset (set);\n+}\n+\n+int\n+sigfillset(sigset_t *set)\n+{\n+    return android_sigfillset (set);\n+}\n+#endif"}, {"sha": "36b97a6f1a1bd44c40404a349d77e4f947d2d53e", "filename": "gcc/ada/terminals.c", "status": "modified", "additions": 2, "deletions": 1, "changes": 3, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/3c55062f3030f6dcd365f89ba9ecfea2131889b4/gcc%2Fada%2Fterminals.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/3c55062f3030f6dcd365f89ba9ecfea2131889b4/gcc%2Fada%2Fterminals.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fada%2Fterminals.c?ref=3c55062f3030f6dcd365f89ba9ecfea2131889b4", "patch": "@@ -31,7 +31,8 @@\n \n /* First all usupported platforms. Add stubs for exported routines. */\n \n-#if defined (VMS) || defined (__vxworks) || defined (__Lynx__)\n+#if defined (VMS) || defined (__vxworks) || defined (__Lynx__) || \\\n+    defined (__ANDROID__)\n \n void * __gnat_new_tty (void) { return (void*)0; }\n char * __gnat_tty_name (void* t) { return (char*)0; }"}]}