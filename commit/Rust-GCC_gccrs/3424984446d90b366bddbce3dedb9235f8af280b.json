{"sha": "3424984446d90b366bddbce3dedb9235f8af280b", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6MzQyNDk4NDQ0NmQ5MGIzNjZiZGRiY2UzZGVkYjkyMzVmOGFmMjgwYg==", "commit": {"author": {"name": "Nathan Sidwell", "email": "nathan@codesourcery.com", "date": "2000-03-24T16:36:06Z"}, "committer": {"name": "Nathan Sidwell", "email": "nathan@gcc.gnu.org", "date": "2000-03-24T16:36:06Z"}, "message": "decl.c (vtype_decl_p): Use TYPE_POLYMORPHIC_P.\n\n\t* decl.c (vtype_decl_p): Use TYPE_POLYMORPHIC_P.\n\n\t* rtti.c (get_tinfo_decl): Set comdat linkage on new-abi\n\ttinfo object.\n\t(emit_tinfo_decl): Only emit polymorphic tinfo's when emitting\n\tvtable.\n\nFrom-SVN: r32725", "tree": {"sha": "ef6148410f44f484259b58e6e5a04a1f4d517e43", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/ef6148410f44f484259b58e6e5a04a1f4d517e43"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/3424984446d90b366bddbce3dedb9235f8af280b", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/3424984446d90b366bddbce3dedb9235f8af280b", "html_url": "https://github.com/Rust-GCC/gccrs/commit/3424984446d90b366bddbce3dedb9235f8af280b", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/3424984446d90b366bddbce3dedb9235f8af280b/comments", "author": null, "committer": null, "parents": [{"sha": "552cc5b57e4f67cf88c4a90a2191a04b9901339f", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/552cc5b57e4f67cf88c4a90a2191a04b9901339f", "html_url": "https://github.com/Rust-GCC/gccrs/commit/552cc5b57e4f67cf88c4a90a2191a04b9901339f"}], "stats": {"total": 20, "additions": 17, "deletions": 3}, "files": [{"sha": "619d88aca1ec1310d55c391629044be91d479c98", "filename": "gcc/cp/ChangeLog", "status": "modified", "additions": 9, "deletions": 0, "changes": 9, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/3424984446d90b366bddbce3dedb9235f8af280b/gcc%2Fcp%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/3424984446d90b366bddbce3dedb9235f8af280b/gcc%2Fcp%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fcp%2FChangeLog?ref=3424984446d90b366bddbce3dedb9235f8af280b", "patch": "@@ -1,3 +1,12 @@\n+2000-03-24  Nathan Sidwell  <nathan@codesourcery.com>\n+\n+\t* decl.c (vtype_decl_p): Use TYPE_POLYMORPHIC_P.\n+\t\n+\t* rtti.c (get_tinfo_decl): Set comdat linkage on new-abi\n+\ttinfo object.\n+\t(emit_tinfo_decl): Only emit polymorphic tinfo's when emitting\n+\tvtable.\n+\n 2000-03-20 Theodore Papadopoulo <Theodore.Papadopoulo@sophia.inria.fr>\n \n \t* call.c (check_dtor_name,build_new_method_call): Likewise."}, {"sha": "ff2cf407dac451deb6dfee6922e9b539e47dfbd5", "filename": "gcc/cp/decl.c", "status": "modified", "additions": 2, "deletions": 3, "changes": 5, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/3424984446d90b366bddbce3dedb9235f8af280b/gcc%2Fcp%2Fdecl.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/3424984446d90b366bddbce3dedb9235f8af280b/gcc%2Fcp%2Fdecl.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fcp%2Fdecl.c?ref=3424984446d90b366bddbce3dedb9235f8af280b", "patch": "@@ -1764,9 +1764,8 @@ vtype_decl_p (t, data)\n      void *data ATTRIBUTE_UNUSED;\n {\n   return (TREE_CODE (t) == TYPE_DECL\n-\t  && TREE_TYPE (t) != error_mark_node\n-\t  && TYPE_LANG_SPECIFIC (TREE_TYPE (t))\n-\t  && CLASSTYPE_VSIZE (TREE_TYPE (t)));\n+\t  && TREE_CODE (TREE_TYPE (t)) == RECORD_TYPE\n+\t  && TYPE_POLYMORPHIC_P (TREE_TYPE (t)));\n }\n \n /* Return the declarations that are members of the namespace NS.  */"}, {"sha": "5ee1d119418a572b67025865f8baf899873bfd51", "filename": "gcc/cp/rtti.c", "status": "modified", "additions": 6, "deletions": 0, "changes": 6, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/3424984446d90b366bddbce3dedb9235f8af280b/gcc%2Fcp%2Frtti.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/3424984446d90b366bddbce3dedb9235f8af280b/gcc%2Fcp%2Frtti.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fcp%2Frtti.c?ref=3424984446d90b366bddbce3dedb9235f8af280b", "patch": "@@ -413,6 +413,7 @@ get_tinfo_decl (type)\n       TREE_STATIC (d) = 1;\n       DECL_EXTERNAL (d) = 1;\n       TREE_PUBLIC (d) = 1;\n+      comdat_linkage (d);\n       DECL_ASSEMBLER_NAME (d) = DECL_NAME (d);\n       cp_finish_decl (d, NULL_TREE, NULL_TREE, 0);\n \n@@ -1919,6 +1920,11 @@ emit_tinfo_decl (decl_ptr, data)\n   \n   if (!DECL_NEEDED_P (tinfo_decl))\n     return 0;\n+  if (TREE_CODE (tinfo_type) == RECORD_TYPE && TYPE_POLYMORPHIC_P (tinfo_type)\n+      && !CLASSTYPE_VTABLE_NEEDS_WRITING (tinfo_type))\n+    /* A polymorphic type only needs its type_info emitted when the vtable\n+       is.  */\n+    return 0;\n   create_tinfo_types ();\n   decl = synthesize_tinfo_var (tinfo_type, DECL_ASSEMBLER_NAME (tinfo_decl));\n   "}]}