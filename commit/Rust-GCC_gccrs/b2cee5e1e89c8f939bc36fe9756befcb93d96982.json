{"sha": "b2cee5e1e89c8f939bc36fe9756befcb93d96982", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6YjJjZWU1ZTFlODljOGY5MzliYzM2ZmU5NzU2YmVmY2I5M2Q5Njk4Mg==", "commit": {"author": {"name": "Iain Sandoe", "email": "iain@sandoe.co.uk", "date": "2020-12-30T10:36:52Z"}, "committer": {"name": "Iain Sandoe", "email": "iain@sandoe.co.uk", "date": "2021-01-02T19:56:19Z"}, "message": "Darwin : Adjust defaults for current bootstrap constraints.\n\nThe toolchain now requires a C++11 compiler to bootstrap and\nnone of the older Darwin toolchains which were based on stabs\ndebugging are suitable.  We can simplify the debug setup now.\n\ngcc/ChangeLog:\n\n\t* config/darwin.h (DSYMUTIL_SPEC): Default to DWARF\n\t(ASM_DEBUG_SPEC):Only define if the assembler supports\n\tstabs.\n\t(PREFERRED_DEBUGGING_TYPE): Default to DWARF.\n\t(DARWIN_PREFER_DWARF): Define.\n\t* config/darwin9.h (PREFERRED_DEBUGGING_TYPE): Remove.\n\t(DARWIN_PREFER_DWARF): Likewise\n\t(DSYMUTIL_SPEC): Likewise.\n\t(COLLECT_RUN_DSYMUTIL): Likewise.\n\t(ASM_DEBUG_SPEC): Likewise.\n\t(ASM_DEBUG_OPTION_SPEC): Likewise.", "tree": {"sha": "9bae8076e1cc95ecefa860dd599dcf76cb854cff", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/9bae8076e1cc95ecefa860dd599dcf76cb854cff"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/b2cee5e1e89c8f939bc36fe9756befcb93d96982", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/b2cee5e1e89c8f939bc36fe9756befcb93d96982", "html_url": "https://github.com/Rust-GCC/gccrs/commit/b2cee5e1e89c8f939bc36fe9756befcb93d96982", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/b2cee5e1e89c8f939bc36fe9756befcb93d96982/comments", "author": {"login": "iains", "id": 4039407, "node_id": "MDQ6VXNlcjQwMzk0MDc=", "avatar_url": "https://avatars.githubusercontent.com/u/4039407?v=4", "gravatar_id": "", "url": "https://api.github.com/users/iains", "html_url": "https://github.com/iains", "followers_url": "https://api.github.com/users/iains/followers", "following_url": "https://api.github.com/users/iains/following{/other_user}", "gists_url": "https://api.github.com/users/iains/gists{/gist_id}", "starred_url": "https://api.github.com/users/iains/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/iains/subscriptions", "organizations_url": "https://api.github.com/users/iains/orgs", "repos_url": "https://api.github.com/users/iains/repos", "events_url": "https://api.github.com/users/iains/events{/privacy}", "received_events_url": "https://api.github.com/users/iains/received_events", "type": "User", "site_admin": false}, "committer": {"login": "iains", "id": 4039407, "node_id": "MDQ6VXNlcjQwMzk0MDc=", "avatar_url": "https://avatars.githubusercontent.com/u/4039407?v=4", "gravatar_id": "", "url": "https://api.github.com/users/iains", "html_url": "https://github.com/iains", "followers_url": "https://api.github.com/users/iains/followers", "following_url": "https://api.github.com/users/iains/following{/other_user}", "gists_url": "https://api.github.com/users/iains/gists{/gist_id}", "starred_url": "https://api.github.com/users/iains/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/iains/subscriptions", "organizations_url": "https://api.github.com/users/iains/orgs", "repos_url": "https://api.github.com/users/iains/repos", "events_url": "https://api.github.com/users/iains/events{/privacy}", "received_events_url": "https://api.github.com/users/iains/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "ae99b315ba5b9e1ccc221b3c45de323cbc574400", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/ae99b315ba5b9e1ccc221b3c45de323cbc574400", "html_url": "https://github.com/Rust-GCC/gccrs/commit/ae99b315ba5b9e1ccc221b3c45de323cbc574400"}], "stats": {"total": 63, "additions": 26, "deletions": 37}, "files": [{"sha": "93e7796e85063fcceab633d0418b88f7d0b5c3b0", "filename": "gcc/config/darwin.h", "status": "modified", "additions": 26, "deletions": 11, "changes": 37, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/b2cee5e1e89c8f939bc36fe9756befcb93d96982/gcc%2Fconfig%2Fdarwin.h", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/b2cee5e1e89c8f939bc36fe9756befcb93d96982/gcc%2Fconfig%2Fdarwin.h", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fconfig%2Fdarwin.h?ref=b2cee5e1e89c8f939bc36fe9756befcb93d96982", "patch": "@@ -241,12 +241,18 @@ extern GTY(()) int darwin_ms_struct;\n \n #define DSYMUTIL \"\\ndsymutil\"\n \n+/* Spec that controls whether the debug linker is run automatically for\n+   a link step.  This needs to be done if there is a source file on the\n+   command line which will result in a temporary object (and debug is\n+   enabled).  */\n+\n #define DSYMUTIL_SPEC \\\n    \"%{!fdump=*:%{!fsyntax-only:%{!c:%{!M:%{!MM:%{!E:%{!S:\\\n     %{v} \\\n-    %{gdwarf-2:%{!gstabs*:%{%:debug-level-gt(0): -idsym}}}\\\n-    %{.c|.cc|.C|.cpp|.cp|.c++|.cxx|.CPP|.m|.mm: \\\n-    %{gdwarf-2:%{!gstabs*:%{%:debug-level-gt(0): -dsym}}}}}}}}}}}\"\n+    %{g*:%{!gstabs*:%{%:debug-level-gt(0): -idsym}}}\\\n+    %{.c|.cc|.C|.cpp|.cp|.c++|.cxx|.CPP|.m|.mm|.s|.f|.f90|\\\n+      .f95|.f03|.f77|.for|.F|.F90|.F95|.F03: \\\n+    %{g*:%{!gstabs*:%{%:debug-level-gt(0): -dsym}}}}}}}}}}}\"\n \n #define LINK_COMMAND_SPEC LINK_COMMAND_SPEC_A DSYMUTIL_SPEC\n \n@@ -472,22 +478,31 @@ extern GTY(()) int darwin_ms_struct;\n   %{Zforce_cpusubtype_ALL:-force_cpusubtype_ALL} \\\n   %{static}\" ASM_MMACOSX_VERSION_MIN_SPEC\n \n-/* Default ASM_DEBUG_SPEC.  Darwin's as cannot currently produce dwarf\n-   debugging data.  */\n-\n+#ifdef HAVE_AS_STABS_DIRECTIVE\n+/* We only pass a debug option to the assembler if that supports stabs, since\n+   dwarf is not uniformly supported in the assemblers.  */\n #define ASM_DEBUG_SPEC  \"%{g*:%{%:debug-level-gt(0):%{!gdwarf*:--gstabs}}}\"\n-#define ASM_DEBUG_OPTION_SPEC \"\"\n+#else\n+#define ASM_DEBUG_SPEC  \"\"\n+#endif\n+\n+#undef  ASM_DEBUG_OPTION_SPEC\n+#define ASM_DEBUG_OPTION_SPEC\t\"\"\n+\n #define ASM_FINAL_SPEC \\\n   \"%{gsplit-dwarf:%ngsplit-dwarf is not supported on this platform} %<gsplit-dwarf\"\n \n-/* We still allow output of STABS if the assembler supports it.  */\n+/* We now require C++11 to bootstrap and newer tools than those based on\n+   stabs, so require DWARF-2, even if stabs is supported by the assembler.  */\n+\n+#define PREFERRED_DEBUGGING_TYPE DWARF2_DEBUG\n+#define DARWIN_PREFER_DWARF\n+#define DWARF2_DEBUGGING_INFO 1\n+\n #ifdef HAVE_AS_STABS_DIRECTIVE\n #define DBX_DEBUGGING_INFO 1\n-#define PREFERRED_DEBUGGING_TYPE DBX_DEBUG\n #endif\n \n-#define DWARF2_DEBUGGING_INFO 1\n-\n #define DEBUG_FRAME_SECTION\t  \"__DWARF,__debug_frame,regular,debug\"\n #define DEBUG_INFO_SECTION\t  \"__DWARF,__debug_info,regular,debug\"\n #define DEBUG_ABBREV_SECTION\t  \"__DWARF,__debug_abbrev,regular,debug\""}, {"sha": "6576d386c12ee4034fe956b44b3ee2f748789b90", "filename": "gcc/config/darwin9.h", "status": "modified", "additions": 0, "deletions": 26, "changes": 26, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/b2cee5e1e89c8f939bc36fe9756befcb93d96982/gcc%2Fconfig%2Fdarwin9.h", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/b2cee5e1e89c8f939bc36fe9756befcb93d96982/gcc%2Fconfig%2Fdarwin9.h", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fconfig%2Fdarwin9.h?ref=b2cee5e1e89c8f939bc36fe9756befcb93d96982", "patch": "@@ -18,32 +18,6 @@ You should have received a copy of the GNU General Public License\n along with GCC; see the file COPYING3.  If not see\n <http://www.gnu.org/licenses/>.  */\n \n-/* Prefer DWARF2.  */\n-#undef PREFERRED_DEBUGGING_TYPE\n-#define PREFERRED_DEBUGGING_TYPE DWARF2_DEBUG\n-#define DARWIN_PREFER_DWARF\n-\n-/* Since DWARF2 is default, conditions for running dsymutil are different.  */\n-#undef DSYMUTIL_SPEC\n-#define DSYMUTIL_SPEC \\\n-   \"%{!fdump=*:%{!fsyntax-only:%{!c:%{!M:%{!MM:%{!E:%{!S:\\\n-    %{v} \\\n-    %{g*:%{!gstabs*:%{%:debug-level-gt(0): -idsym}}}\\\n-    %{.c|.cc|.C|.cpp|.cp|.c++|.cxx|.CPP|.m|.mm|.s|.f|.f90|.f95|.f03|.f77|.for|.F|.F90|.F95|.F03: \\\n-    %{g*:%{!gstabs*:%{%:debug-level-gt(0): -dsym}}}}}}}}}}}\"\n-\n-/* Tell collect2 to run dsymutil for us as necessary.  */\n-#define COLLECT_RUN_DSYMUTIL 1\n-\n-/* Only ask as for debug data if the debug style is stabs (since as doesn't\n-   yet generate dwarf.)  */\n-\n-#undef  ASM_DEBUG_SPEC\n-#define ASM_DEBUG_SPEC  \"%{g*:%{%:debug-level-gt(0):%{gstabs:--gstabs}}}\"\n-\n-#undef  ASM_DEBUG_OPTION_SPEC\n-#define ASM_DEBUG_OPTION_SPEC\t\"\"\n-\n #undef  ASM_OUTPUT_ALIGNED_COMMON\n #define ASM_OUTPUT_ALIGNED_COMMON(FILE, NAME, SIZE, ALIGN)\t\t\\\n   do {\t\t\t\t\t\t\t\t\t\\"}]}