{"sha": "cd6b4a4bca97657af9e08583ac92f1833f6191eb", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6Y2Q2YjRhNGJjYTk3NjU3YWY5ZTA4NTgzYWM5MmYxODMzZjYxOTFlYg==", "commit": {"author": {"name": "Paolo Carlini", "email": "paolo.carlini@oracle.com", "date": "2010-08-06T08:58:27Z"}, "committer": {"name": "Paolo Carlini", "email": "paolo@gcc.gnu.org", "date": "2010-08-06T08:58:27Z"}, "message": "ratio (ratio_less): Improve, use ratio_divide to avoid more overflows.\n\n2010-08-06  Paolo Carlini  <paolo.carlini@oracle.com>\n\n\t* include/std/ratio (ratio_less): Improve, use ratio_divide to avoid\n\tmore overflows.\n\t* testsuite/20_util/ratio/comparisons/comp1.cc: Extend.\n\t* testsuite/20_util/ratio/comparisons/comp2.cc: Likewise.\n\nFrom-SVN: r162941", "tree": {"sha": "857b8d6248d007126b20d033165a50c38c343781", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/857b8d6248d007126b20d033165a50c38c343781"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/cd6b4a4bca97657af9e08583ac92f1833f6191eb", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/cd6b4a4bca97657af9e08583ac92f1833f6191eb", "html_url": "https://github.com/Rust-GCC/gccrs/commit/cd6b4a4bca97657af9e08583ac92f1833f6191eb", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/cd6b4a4bca97657af9e08583ac92f1833f6191eb/comments", "author": null, "committer": null, "parents": [{"sha": "0af2372948f7d3eec3b71e78acdecbaec8589926", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/0af2372948f7d3eec3b71e78acdecbaec8589926", "html_url": "https://github.com/Rust-GCC/gccrs/commit/0af2372948f7d3eec3b71e78acdecbaec8589926"}], "stats": {"total": 58, "additions": 42, "deletions": 16}, "files": [{"sha": "8cd8bb2efdfbb6ad3f7fbf57d97096f2aef6c787", "filename": "libstdc++-v3/ChangeLog", "status": "modified", "additions": 7, "deletions": 0, "changes": 7, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/cd6b4a4bca97657af9e08583ac92f1833f6191eb/libstdc%2B%2B-v3%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/cd6b4a4bca97657af9e08583ac92f1833f6191eb/libstdc%2B%2B-v3%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libstdc%2B%2B-v3%2FChangeLog?ref=cd6b4a4bca97657af9e08583ac92f1833f6191eb", "patch": "@@ -1,3 +1,10 @@\n+2010-08-06  Paolo Carlini  <paolo.carlini@oracle.com>\n+\n+\t* include/std/ratio (ratio_less): Improve, use ratio_divide to avoid\n+\tmore overflows.\n+\t* testsuite/20_util/ratio/comparisons/comp1.cc: Extend.\n+\t* testsuite/20_util/ratio/comparisons/comp2.cc: Likewise.\n+\n 2010-08-05  Paolo Carlini  <paolo.carlini@oracle.com>\n \n \t* include/tr1_impl/utility (begin, end): Remove per GB 85."}, {"sha": "74806c41d5a58fca00eb9b87f27a6da689a11341", "filename": "libstdc++-v3/include/std/ratio", "status": "modified", "additions": 20, "deletions": 13, "changes": 33, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/cd6b4a4bca97657af9e08583ac92f1833f6191eb/libstdc%2B%2B-v3%2Finclude%2Fstd%2Fratio", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/cd6b4a4bca97657af9e08583ac92f1833f6191eb/libstdc%2B%2B-v3%2Finclude%2Fstd%2Fratio", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libstdc%2B%2B-v3%2Finclude%2Fstd%2Fratio?ref=cd6b4a4bca97657af9e08583ac92f1833f6191eb", "patch": "@@ -233,23 +233,30 @@ namespace std\n     struct ratio_not_equal\n     : integral_constant<bool, !ratio_equal<_R1, _R2>::value>\n     { };\n-  \n+\n+  template<typename _R1>\n+    struct __ratio_less_impl_1\n+    : integral_constant<bool, _R1::num < _R1::den>\n+    { }; \n+\n+  template<typename _R1, typename _R2,\n+\t   bool = (_R1::num == 0 || _R2::num == 0\n+\t\t   || (__static_sign<_R1::num>::value\n+\t\t       != __static_sign<_R2::num>::value)),\n+\t   bool = (__static_sign<_R1::num>::value == -1\n+\t\t   && __static_sign<_R2::num>::value == -1)>\n+    struct __ratio_less_impl\n+    : __ratio_less_impl_1<typename ratio_divide<_R1, _R2>::type>::type\n+    { };\n+\n   template<typename _R1, typename _R2>\n-    struct __ratio_less_simple_impl\n-    : integral_constant<bool,\n-\t\t\t(__safe_multiply<_R1::num, _R2::den>::value\n-\t\t\t < __safe_multiply<_R2::num, _R1::den>::value)>\n+    struct __ratio_less_impl<_R1, _R2, true, false>\n+    : integral_constant<bool, _R1::num < _R2::num>\n     { };\n \n-  // If the denominators are equal or the signs differ, we can just compare\n-  // numerators, otherwise fallback to the simple cross-multiply method.\n   template<typename _R1, typename _R2>\n-    struct __ratio_less_impl\n-    : conditional<(_R1::den == _R2::den\n-\t\t   || (__static_sign<_R1::num>::value\n-\t\t       != __static_sign<_R2::num>::value)),\n-      integral_constant<bool, (_R1::num < _R2::num)>,\n-      __ratio_less_simple_impl<_R1, _R2>>::type\n+    struct __ratio_less_impl<_R1, _R2, false, true>\n+    : __ratio_less_impl_1<typename ratio_divide<_R2, _R1>::type>::type\n     { };\n \n   /// ratio_less"}, {"sha": "eb1bd212f5a5d11a720fb72e5cc0ff893cdd2f54", "filename": "libstdc++-v3/testsuite/20_util/ratio/comparisons/comp1.cc", "status": "modified", "additions": 7, "deletions": 2, "changes": 9, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/cd6b4a4bca97657af9e08583ac92f1833f6191eb/libstdc%2B%2B-v3%2Ftestsuite%2F20_util%2Fratio%2Fcomparisons%2Fcomp1.cc", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/cd6b4a4bca97657af9e08583ac92f1833f6191eb/libstdc%2B%2B-v3%2Ftestsuite%2F20_util%2Fratio%2Fcomparisons%2Fcomp1.cc", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libstdc%2B%2B-v3%2Ftestsuite%2F20_util%2Fratio%2Fcomparisons%2Fcomp1.cc?ref=cd6b4a4bca97657af9e08583ac92f1833f6191eb", "patch": "@@ -1,7 +1,7 @@\n // { dg-options \"-std=gnu++0x\" }\n // { dg-require-cstdint \"\" }\n \n-// Copyright (C) 2008, 2009 Free Software Foundation\n+// Copyright (C) 2008, 2009, 2010 Free Software Foundation\n //\n // This file is part of the GNU ISO C++ Library.  This library is free\n // software; you can redistribute it and/or modify it under the\n@@ -45,7 +45,12 @@ test02()\n   \n   VERIFY( (std::ratio_less<std::ratio<1,3>, std::ratio<1,4>>::value == 0) );\n   VERIFY( (std::ratio_less<std::ratio<1,3>, std::ratio<-1,3>>::value == 0) );\n-      \n+\n+  VERIFY( (std::ratio_less<std::ratio<-1,3>, std::ratio<-1,4>>::value == 1) );\n+  VERIFY( (std::ratio_less<std::ratio<0,4>, std::ratio<0,3>>::value == 0) );\n+  VERIFY( (std::ratio_less<std::ratio<1,3>, std::ratio<0,3>>::value == 0) );\n+  VERIFY( (std::ratio_less<std::ratio<0,3>, std::ratio<-1,4>>::value == 0) );\n+\n   VERIFY( (std::ratio_less_equal<std::ratio<-1,3>, \n            std::ratio<-1,3>>::value == 1) );\n   VERIFY( ( std::ratio_less_equal<std::ratio<1,4>, "}, {"sha": "151dc64450ee865bae1eb872b63380d4f4fff637", "filename": "libstdc++-v3/testsuite/20_util/ratio/comparisons/comp2.cc", "status": "modified", "additions": 8, "deletions": 1, "changes": 9, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/cd6b4a4bca97657af9e08583ac92f1833f6191eb/libstdc%2B%2B-v3%2Ftestsuite%2F20_util%2Fratio%2Fcomparisons%2Fcomp2.cc", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/cd6b4a4bca97657af9e08583ac92f1833f6191eb/libstdc%2B%2B-v3%2Ftestsuite%2F20_util%2Fratio%2Fcomparisons%2Fcomp2.cc", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libstdc%2B%2B-v3%2Ftestsuite%2F20_util%2Fratio%2Fcomparisons%2Fcomp2.cc?ref=cd6b4a4bca97657af9e08583ac92f1833f6191eb", "patch": "@@ -1,7 +1,7 @@\n // { dg-options \"-std=gnu++0x\" }\n // { dg-require-cstdint \"\" }\n \n-// Copyright (C) 2008, 2009 Free Software Foundation\n+// Copyright (C) 2008, 2009, 2010 Free Software Foundation\n //\n // This file is part of the GNU ISO C++ Library.  This library is free\n // software; you can redistribute it and/or modify it under the\n@@ -41,6 +41,13 @@ test01()\n   \n   VERIFY( (std::ratio_less<std::ratio<M - 1, M - 2>,\n            std::ratio<-M, M - 1>>::value == 0) );\n+\n+  // No overflow\n+  VERIFY( (std::ratio_less<std::ratio<M, M - 1>,\n+           std::ratio<M, M - 2>>::value == 1) );\n+\n+  VERIFY( (std::ratio_less<std::ratio<-M, M - 1>,\n+           std::ratio<-M, M - 2>>::value == 0) );\n }\n \n int main()"}]}