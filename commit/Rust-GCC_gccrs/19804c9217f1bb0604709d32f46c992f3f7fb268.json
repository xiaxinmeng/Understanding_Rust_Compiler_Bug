{"sha": "19804c9217f1bb0604709d32f46c992f3f7fb268", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6MTk4MDRjOTIxN2YxYmIwNjA0NzA5ZDMyZjQ2Yzk5MmYzZjdmYjI2OA==", "commit": {"author": {"name": "Mingjie Xing", "email": "mingjie.xing@gmail.com", "date": "2010-11-24T01:44:24Z"}, "committer": {"name": "Mingjie Xing", "email": "xmj@gcc.gnu.org", "date": "2010-11-24T01:44:24Z"}, "message": "Add loongson3a integer mul/div patterns\n\nFrom-SVN: r167107", "tree": {"sha": "8d969a702f5142b55331339ffcd9e3f208003eb0", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/8d969a702f5142b55331339ffcd9e3f208003eb0"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/19804c9217f1bb0604709d32f46c992f3f7fb268", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/19804c9217f1bb0604709d32f46c992f3f7fb268", "html_url": "https://github.com/Rust-GCC/gccrs/commit/19804c9217f1bb0604709d32f46c992f3f7fb268", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/19804c9217f1bb0604709d32f46c992f3f7fb268/comments", "author": {"login": "xingmingjie", "id": 7777963, "node_id": "MDQ6VXNlcjc3Nzc5NjM=", "avatar_url": "https://avatars.githubusercontent.com/u/7777963?v=4", "gravatar_id": "", "url": "https://api.github.com/users/xingmingjie", "html_url": "https://github.com/xingmingjie", "followers_url": "https://api.github.com/users/xingmingjie/followers", "following_url": "https://api.github.com/users/xingmingjie/following{/other_user}", "gists_url": "https://api.github.com/users/xingmingjie/gists{/gist_id}", "starred_url": "https://api.github.com/users/xingmingjie/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/xingmingjie/subscriptions", "organizations_url": "https://api.github.com/users/xingmingjie/orgs", "repos_url": "https://api.github.com/users/xingmingjie/repos", "events_url": "https://api.github.com/users/xingmingjie/events{/privacy}", "received_events_url": "https://api.github.com/users/xingmingjie/received_events", "type": "User", "site_admin": false}, "committer": null, "parents": [{"sha": "299404a1ec3d2dc7e2b19ea79c3e9f3552b6215d", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/299404a1ec3d2dc7e2b19ea79c3e9f3552b6215d", "html_url": "https://github.com/Rust-GCC/gccrs/commit/299404a1ec3d2dc7e2b19ea79c3e9f3552b6215d"}], "stats": {"total": 90, "additions": 77, "deletions": 13}, "files": [{"sha": "20a836aa095796f9ac5ebc6b451e0839f84d21ea", "filename": "gcc/ChangeLog", "status": "modified", "additions": 11, "deletions": 0, "changes": 11, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/19804c9217f1bb0604709d32f46c992f3f7fb268/gcc%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/19804c9217f1bb0604709d32f46c992f3f7fb268/gcc%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2FChangeLog?ref=19804c9217f1bb0604709d32f46c992f3f7fb268", "patch": "@@ -1,3 +1,14 @@\n+2010-11-24  Mingjie Xing  <mingjie.xing@gmail.com>\n+\n+\t* config/mips/loongson.md: Change the description comment of the file\n+\tand update the copyright years.\n+\t(define_insn \"<u>div<mode>3): Add loongson3a support.\n+\t(define_insn \"<u>mod<mode>3\"): Likewise.\n+\t* config/mips/mips.md: Rename mul<mode>3_mul3_ls2ef to\n+\tmul<mode>3_mul3_loongson.\n+\t(define_expand \"mul<mode>3\"): Add TARGET_LOONGSON_3A.\n+\t(define_insn \"mul<mode>3_mul3_loongson\"): Add loongson3a support.\n+\n 2010-11-23  Joseph Myers  <joseph@codesourcery.com>\n \n \t* common.opt (initial_max_fld_align, flag_debug_asm,"}, {"sha": "225f4d16da937d43b195417d4a5334802e51f4f9", "filename": "gcc/config/mips/loongson.md", "status": "modified", "additions": 18, "deletions": 7, "changes": 25, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/19804c9217f1bb0604709d32f46c992f3f7fb268/gcc%2Fconfig%2Fmips%2Floongson.md", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/19804c9217f1bb0604709d32f46c992f3f7fb268/gcc%2Fconfig%2Fmips%2Floongson.md", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fconfig%2Fmips%2Floongson.md?ref=19804c9217f1bb0604709d32f46c992f3f7fb268", "patch": "@@ -1,5 +1,6 @@\n-;; Machine description for ST Microelectronics Loongson-2E/2F.\n-;; Copyright (C) 2008, 2009 Free Software Foundation, Inc.\n+;; Machine description for Loongson-specific patterns, such as\n+;; ST Microelectronics Loongson-2E/2F etc.\n+;; Copyright (C) 2008, 2009, 2010 Free Software Foundation, Inc.\n ;; Contributed by CodeSourcery.\n ;;\n ;; This file is part of GCC.\n@@ -497,22 +498,32 @@\n   \"punpckl<V_stretch_half_suffix>\\t%0,%1,%2\"\n   [(set_attr \"type\" \"fdiv\")])\n \n-;; Integer division and modulus.\n+;; Integer division and modulus.  For integer multiplication, see mips.md.\n \n (define_insn \"<u>div<mode>3\"\n   [(set (match_operand:GPR 0 \"register_operand\" \"=&d\")\n \t(any_div:GPR (match_operand:GPR 1 \"register_operand\" \"d\")\n \t\t     (match_operand:GPR 2 \"register_operand\" \"d\")))]\n-  \"TARGET_LOONGSON_2EF\"\n-  { return mips_output_division (\"<d>div<u>.g\\t%0,%1,%2\", operands); }\n+  \"TARGET_LOONGSON_2EF || TARGET_LOONGSON_3A\"\n+  {\n+    if (TARGET_LOONGSON_2EF)\n+      return mips_output_division (\"<d>div<u>.g\\t%0,%1,%2\", operands);\n+    else\n+      return mips_output_division (\"gs<d>div<u>\\t%0,%1,%2\", operands);\n+  }\n   [(set_attr \"type\" \"idiv3\")\n    (set_attr \"mode\" \"<MODE>\")])\n \n (define_insn \"<u>mod<mode>3\"\n   [(set (match_operand:GPR 0 \"register_operand\" \"=&d\")\n \t(any_mod:GPR (match_operand:GPR 1 \"register_operand\" \"d\")\n \t\t     (match_operand:GPR 2 \"register_operand\" \"d\")))]\n-  \"TARGET_LOONGSON_2EF\"\n-  { return mips_output_division (\"<d>mod<u>.g\\t%0,%1,%2\", operands); }\n+  \"TARGET_LOONGSON_2EF || TARGET_LOONGSON_3A\"\n+  {\n+    if (TARGET_LOONGSON_2EF)\n+      return mips_output_division (\"<d>mod<u>.g\\t%0,%1,%2\", operands);\n+    else\n+      return mips_output_division (\"gs<d>mod<u>\\t%0,%1,%2\", operands);\n+  }\n   [(set_attr \"type\" \"idiv3\")\n    (set_attr \"mode\" \"<MODE>\")])"}, {"sha": "31121f7458d18cef3f7941ee26019384ded6164f", "filename": "gcc/config/mips/mips.md", "status": "modified", "additions": 11, "deletions": 6, "changes": 17, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/19804c9217f1bb0604709d32f46c992f3f7fb268/gcc%2Fconfig%2Fmips%2Fmips.md", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/19804c9217f1bb0604709d32f46c992f3f7fb268/gcc%2Fconfig%2Fmips%2Fmips.md", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fconfig%2Fmips%2Fmips.md?ref=19804c9217f1bb0604709d32f46c992f3f7fb268", "patch": "@@ -1324,9 +1324,9 @@\n \t\t  (match_operand:GPR 2 \"register_operand\")))]\n   \"\"\n {\n-  if (TARGET_LOONGSON_2EF)\n-    emit_insn (gen_mul<mode>3_mul3_ls2ef (operands[0], operands[1],\n-                                          operands[2]));\n+  if (TARGET_LOONGSON_2EF || TARGET_LOONGSON_3A)\n+    emit_insn (gen_mul<mode>3_mul3_loongson (operands[0], operands[1],\n+                                             operands[2]));\n   else if (ISA_HAS_<D>MUL3)\n     emit_insn (gen_mul<mode>3_mul3 (operands[0], operands[1], operands[2]));\n   else if (TARGET_FIX_R4000)\n@@ -1337,12 +1337,17 @@\n   DONE;\n })\n \n-(define_insn \"mul<mode>3_mul3_ls2ef\"\n+(define_insn \"mul<mode>3_mul3_loongson\"\n   [(set (match_operand:GPR 0 \"register_operand\" \"=d\")\n         (mult:GPR (match_operand:GPR 1 \"register_operand\" \"d\")\n                   (match_operand:GPR 2 \"register_operand\" \"d\")))]\n-  \"TARGET_LOONGSON_2EF\"\n-  \"<d>multu.g\\t%0,%1,%2\"\n+  \"TARGET_LOONGSON_2EF || TARGET_LOONGSON_3A\"\n+{\n+  if (TARGET_LOONGSON_2EF)\n+    return \"<d>multu.g\\t%0,%1,%2\";\n+  else\n+    return \"gs<d>multu\\t%0,%1,%2\";\n+}\n   [(set_attr \"type\" \"imul3nc\")\n    (set_attr \"mode\" \"<MODE>\")])\n "}, {"sha": "cc9607e8f9121c9395d62e4450ebe07799a7d885", "filename": "gcc/testsuite/ChangeLog", "status": "modified", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/19804c9217f1bb0604709d32f46c992f3f7fb268/gcc%2Ftestsuite%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/19804c9217f1bb0604709d32f46c992f3f7fb268/gcc%2Ftestsuite%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2FChangeLog?ref=19804c9217f1bb0604709d32f46c992f3f7fb268", "patch": "@@ -1,3 +1,8 @@\n+2010-11-24  Mingjie Xing  <mingjie.xing@gmail.com>\n+\n+\t* gcc.target/mips/loongson3a-muldiv-1.c: New test.\n+\t* gcc.target/mips/loongson3a-muldiv-2.c: New test.\n+\n 2010-11-23  Joseph Myers  <joseph@codesourcery.com>\n \n \t* gcc.dg/opts-5.c: New test."}, {"sha": "cc15b83ab9340b0a6b9f7fa755083f13a7eefae1", "filename": "gcc/testsuite/gcc.target/mips/loongson3a-muldiv-1.c", "status": "added", "additions": 16, "deletions": 0, "changes": 16, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/19804c9217f1bb0604709d32f46c992f3f7fb268/gcc%2Ftestsuite%2Fgcc.target%2Fmips%2Floongson3a-muldiv-1.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/19804c9217f1bb0604709d32f46c992f3f7fb268/gcc%2Ftestsuite%2Fgcc.target%2Fmips%2Floongson3a-muldiv-1.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgcc.target%2Fmips%2Floongson3a-muldiv-1.c?ref=19804c9217f1bb0604709d32f46c992f3f7fb268", "patch": "@@ -0,0 +1,16 @@\n+/* { dg-options \"-O2 -march=loongson3a\" } */\n+\n+typedef int st;\n+typedef unsigned int ut;\n+\n+NOMIPS16 st smul (st x, st y) { return x * y; }\n+NOMIPS16 st sdiv (st x, st y) { return x / y + x % y; }\n+\n+NOMIPS16 ut umul (ut x, ut y) { return x * y; }\n+NOMIPS16 ut udiv (ut x, ut y) { return x / y + x % y; }\n+\n+/* { dg-final { scan-assembler-times \"\\tgsmultu\\t\" 2 } } */\n+/* { dg-final { scan-assembler-times \"\\tgsdivu\\t\" 1 } } */\n+/* { dg-final { scan-assembler-times \"\\tgsmodu\\t\" 1 } } */\n+/* { dg-final { scan-assembler-times \"\\tgsdiv\\t\" 1 } } */\n+/* { dg-final { scan-assembler-times \"\\tgsmod\\t\" 1 } } */"}, {"sha": "592b492c30840bc8792ba4fd0c3b3d1dbc632739", "filename": "gcc/testsuite/gcc.target/mips/loongson3a-muldiv-2.c", "status": "added", "additions": 16, "deletions": 0, "changes": 16, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/19804c9217f1bb0604709d32f46c992f3f7fb268/gcc%2Ftestsuite%2Fgcc.target%2Fmips%2Floongson3a-muldiv-2.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/19804c9217f1bb0604709d32f46c992f3f7fb268/gcc%2Ftestsuite%2Fgcc.target%2Fmips%2Floongson3a-muldiv-2.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgcc.target%2Fmips%2Floongson3a-muldiv-2.c?ref=19804c9217f1bb0604709d32f46c992f3f7fb268", "patch": "@@ -0,0 +1,16 @@\n+/* { dg-options \"-O2 -march=loongson3a -mgp64\" } */\n+\n+typedef long long st;\n+typedef unsigned long long ut;\n+\n+NOMIPS16 st smul (st x, st y) { return x * y; }\n+NOMIPS16 st sdiv (st x, st y) { return x / y + x % y; }\n+\n+NOMIPS16 ut umul (ut x, ut y) { return x * y; }\n+NOMIPS16 ut udiv (ut x, ut y) { return x / y + x % y; }\n+\n+/* { dg-final { scan-assembler-times \"\\tgsdmultu\\t\" 2 } } */\n+/* { dg-final { scan-assembler-times \"\\tgsddivu\\t\" 1 } } */\n+/* { dg-final { scan-assembler-times \"\\tgsdmodu\\t\" 1 } } */\n+/* { dg-final { scan-assembler-times \"\\tgsddiv\\t\" 1 } } */\n+/* { dg-final { scan-assembler-times \"\\tgsdmod\\t\" 1 } } */"}]}