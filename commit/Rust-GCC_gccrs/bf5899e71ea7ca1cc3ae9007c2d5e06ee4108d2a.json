{"sha": "bf5899e71ea7ca1cc3ae9007c2d5e06ee4108d2a", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6YmY1ODk5ZTcxZWE3Y2ExY2MzYWU5MDA3YzJkNWUwNmVlNDEwOGQyYQ==", "commit": {"author": {"name": "Hristian Kirtchev", "email": "kirtchev@adacore.com", "date": "2018-05-25T09:05:15Z"}, "committer": {"name": "Pierre-Marie de Rodat", "email": "pmderodat@gcc.gnu.org", "date": "2018-05-25T09:05:15Z"}, "message": "[Ada] Spurious range check with Initialize_Scalars\n\nThis patch modifies the expansion of default-initialized array objects when\npragma Initialize_Scalars or Normalize_Scalars is in effect to suppress the\ngeneration of checks on the constructed in-place aggregate. The aggregate\nintentionally contains invalid values which may not necessarily fit the\nconstraints of a particular component type. Check suppression ensures that\nno spurious checks are generated, and that the effects of the pragmas are\ncarried out.\n\n------------\n-- Source --\n------------\n\n--  gnat.adc\n\npragma Initialize_Scalars;\n\n--  init_scalar.adb\n\nwith Ada.Text_IO; use Ada.Text_IO;\n\nprocedure Init_Scalar is\n   type Fixed is delta 0.25 range -12.0 .. 1270.0;\n   type Fixed_Array is array (1 .. 1) of Fixed;\n\nbegin\n   begin\n      declare\n         Obj : Fixed;\n         pragma Unreferenced (Obj);\n      begin null; end;\n   exception\n      when others => Put_Line (\"ERROR: Fixed raised exception\");\n   end;\n\n   begin\n      declare\n         Obj : Fixed_Array;\n         pragma Unreferenced (Obj);\n      begin null; end;\n   exception\n      when others => Put_Line (\"ERROR: Fixed_Array raised exception\");\n   end;\nend Init_Scalar;\n\n-----------------\n-- Compilation --\n-----------------\n\n$ gnatmake -q init_scalar.adb\n$ ./init_scalar\n\n2018-05-25  Hristian Kirtchev  <kirtchev@adacore.com>\n\ngcc/ada/\n\n\t* exp_ch3.adb (Default_Initialize_Object): Ensure that the analysis of\n\tthe in-place initialization aggregate created for pragmas\n\tInitialize_Scalars or Normalize_Scalars is performed with checks\n\tsuppressed.\n\nFrom-SVN: r260740", "tree": {"sha": "5839a309bf58d480c43a1065d5ddf6721c4c94ac", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/5839a309bf58d480c43a1065d5ddf6721c4c94ac"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/bf5899e71ea7ca1cc3ae9007c2d5e06ee4108d2a", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/bf5899e71ea7ca1cc3ae9007c2d5e06ee4108d2a", "html_url": "https://github.com/Rust-GCC/gccrs/commit/bf5899e71ea7ca1cc3ae9007c2d5e06ee4108d2a", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/bf5899e71ea7ca1cc3ae9007c2d5e06ee4108d2a/comments", "author": {"login": "kirtchev-adacore", "id": 60669983, "node_id": "MDQ6VXNlcjYwNjY5OTgz", "avatar_url": "https://avatars.githubusercontent.com/u/60669983?v=4", "gravatar_id": "", "url": "https://api.github.com/users/kirtchev-adacore", "html_url": "https://github.com/kirtchev-adacore", "followers_url": "https://api.github.com/users/kirtchev-adacore/followers", "following_url": "https://api.github.com/users/kirtchev-adacore/following{/other_user}", "gists_url": "https://api.github.com/users/kirtchev-adacore/gists{/gist_id}", "starred_url": "https://api.github.com/users/kirtchev-adacore/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/kirtchev-adacore/subscriptions", "organizations_url": "https://api.github.com/users/kirtchev-adacore/orgs", "repos_url": "https://api.github.com/users/kirtchev-adacore/repos", "events_url": "https://api.github.com/users/kirtchev-adacore/events{/privacy}", "received_events_url": "https://api.github.com/users/kirtchev-adacore/received_events", "type": "User", "site_admin": false}, "committer": null, "parents": [{"sha": "f70b01165e6d392a110cb963060ea2a17feebbb7", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/f70b01165e6d392a110cb963060ea2a17feebbb7", "html_url": "https://github.com/Rust-GCC/gccrs/commit/f70b01165e6d392a110cb963060ea2a17feebbb7"}], "stats": {"total": 10, "additions": 9, "deletions": 1}, "files": [{"sha": "ba22139a02bc44c1db1fc96d1db4be9f3121cc31", "filename": "gcc/ada/ChangeLog", "status": "modified", "additions": 7, "deletions": 0, "changes": 7, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/bf5899e71ea7ca1cc3ae9007c2d5e06ee4108d2a/gcc%2Fada%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/bf5899e71ea7ca1cc3ae9007c2d5e06ee4108d2a/gcc%2Fada%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fada%2FChangeLog?ref=bf5899e71ea7ca1cc3ae9007c2d5e06ee4108d2a", "patch": "@@ -1,3 +1,10 @@\n+2018-05-25  Hristian Kirtchev  <kirtchev@adacore.com>\n+\n+\t* exp_ch3.adb (Default_Initialize_Object): Ensure that the analysis of\n+\tthe in-place initialization aggregate created for pragmas\n+\tInitialize_Scalars or Normalize_Scalars is performed with checks\n+\tsuppressed.\n+\n 2018-05-25  Arnaud Charlet  <charlet@adacore.com>\n \n \t* exp_aggr.adb (Convert_To_Positional): Bump default for"}, {"sha": "db93b6453afecf45cb70654abb62bb4693e47117", "filename": "gcc/ada/exp_ch3.adb", "status": "modified", "additions": 2, "deletions": 1, "changes": 3, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/bf5899e71ea7ca1cc3ae9007c2d5e06ee4108d2a/gcc%2Fada%2Fexp_ch3.adb", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/bf5899e71ea7ca1cc3ae9007c2d5e06ee4108d2a/gcc%2Fada%2Fexp_ch3.adb", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fada%2Fexp_ch3.adb?ref=bf5899e71ea7ca1cc3ae9007c2d5e06ee4108d2a", "patch": "@@ -6109,7 +6109,8 @@ package body Exp_Ch3 is\n                        N    => Obj_Def,\n                        Size => Esize (Def_Id)));\n \n-                  Analyze_And_Resolve (Expression (N), Typ);\n+                  Analyze_And_Resolve\n+                    (Expression (N), Typ, Suppress => All_Checks);\n \n                --  Otherwise invoke the type init proc, generate:\n                --    Type_Init_Proc (Obj);"}]}