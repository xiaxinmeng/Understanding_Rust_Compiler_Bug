{"sha": "ca01d2526917ec6e54b30472d3aedfd46d4ca585", "node_id": "C_kwDOANBUbNoAKGNhMDFkMjUyNjkxN2VjNmU1NGIzMDQ3MmQzYWVkZmQ0NmQ0Y2E1ODU", "commit": {"author": {"name": "Stafford Horne", "email": "shorne@gmail.com", "date": "2022-09-29T14:32:39Z"}, "committer": {"name": "Stafford Horne", "email": "shorne@gmail.com", "date": "2022-10-01T09:58:01Z"}, "message": "or1k: Only define TARGET_HAVE_TLS when HAVE_AS_TLS\n\nThis was found when testing buildroot with linuxthreads enabled.  In\nthis case, the build passes --disable-tls to the toolchain during\nconfiguration.  After building the OpenRISC toolchain it was still\ngenerating TLS code sequences and causing linker failures such as:\n\n ..../or1k-buildroot-linux-uclibc-gcc -o gpsd-3.24/gpsctl .... -lusb-1.0 -lm -lrt -lnsl\n ..../ld: ..../sysroot/usr/lib/libusb-1.0.so: undefined reference to `__tls_get_addr'\n\nThis patch fixes this by disabling tls for the OpenRISC target when requested\nvia --disable-tls.\n\ngcc/ChangeLog:\n\n\t* config/or1k/or1k.cc (TARGET_HAVE_TLS): Only define if\n\tHAVE_AS_TLS is defined.\n\nTested-by: Yann E. MORIN <yann.morin@orange.com>", "tree": {"sha": "046f4c7aacbb00d371d9e5aad383d8848672ea8e", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/046f4c7aacbb00d371d9e5aad383d8848672ea8e"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/ca01d2526917ec6e54b30472d3aedfd46d4ca585", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/ca01d2526917ec6e54b30472d3aedfd46d4ca585", "html_url": "https://github.com/Rust-GCC/gccrs/commit/ca01d2526917ec6e54b30472d3aedfd46d4ca585", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/ca01d2526917ec6e54b30472d3aedfd46d4ca585/comments", "author": {"login": "stffrdhrn", "id": 2404255, "node_id": "MDQ6VXNlcjI0MDQyNTU=", "avatar_url": "https://avatars.githubusercontent.com/u/2404255?v=4", "gravatar_id": "", "url": "https://api.github.com/users/stffrdhrn", "html_url": "https://github.com/stffrdhrn", "followers_url": "https://api.github.com/users/stffrdhrn/followers", "following_url": "https://api.github.com/users/stffrdhrn/following{/other_user}", "gists_url": "https://api.github.com/users/stffrdhrn/gists{/gist_id}", "starred_url": "https://api.github.com/users/stffrdhrn/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/stffrdhrn/subscriptions", "organizations_url": "https://api.github.com/users/stffrdhrn/orgs", "repos_url": "https://api.github.com/users/stffrdhrn/repos", "events_url": "https://api.github.com/users/stffrdhrn/events{/privacy}", "received_events_url": "https://api.github.com/users/stffrdhrn/received_events", "type": "User", "site_admin": false}, "committer": {"login": "stffrdhrn", "id": 2404255, "node_id": "MDQ6VXNlcjI0MDQyNTU=", "avatar_url": "https://avatars.githubusercontent.com/u/2404255?v=4", "gravatar_id": "", "url": "https://api.github.com/users/stffrdhrn", "html_url": "https://github.com/stffrdhrn", "followers_url": "https://api.github.com/users/stffrdhrn/followers", "following_url": "https://api.github.com/users/stffrdhrn/following{/other_user}", "gists_url": "https://api.github.com/users/stffrdhrn/gists{/gist_id}", "starred_url": "https://api.github.com/users/stffrdhrn/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/stffrdhrn/subscriptions", "organizations_url": "https://api.github.com/users/stffrdhrn/orgs", "repos_url": "https://api.github.com/users/stffrdhrn/repos", "events_url": "https://api.github.com/users/stffrdhrn/events{/privacy}", "received_events_url": "https://api.github.com/users/stffrdhrn/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "153ca019b7794c97972dcd291021cf074514fb3b", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/153ca019b7794c97972dcd291021cf074514fb3b", "html_url": "https://github.com/Rust-GCC/gccrs/commit/153ca019b7794c97972dcd291021cf074514fb3b"}], "stats": {"total": 2, "additions": 2, "deletions": 0}, "files": [{"sha": "0ce7b234417d7d17fae5339050690cde5e242ccd", "filename": "gcc/config/or1k/or1k.cc", "status": "modified", "additions": 2, "deletions": 0, "changes": 2, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/ca01d2526917ec6e54b30472d3aedfd46d4ca585/gcc%2Fconfig%2For1k%2For1k.cc", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/ca01d2526917ec6e54b30472d3aedfd46d4ca585/gcc%2Fconfig%2For1k%2For1k.cc", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fconfig%2For1k%2For1k.cc?ref=ca01d2526917ec6e54b30472d3aedfd46d4ca585", "patch": "@@ -2206,8 +2206,10 @@ or1k_output_mi_thunk (FILE *file, tree thunk_fndecl,\n #undef  TARGET_LEGITIMATE_ADDRESS_P\n #define TARGET_LEGITIMATE_ADDRESS_P or1k_legitimate_address_p\n \n+#ifdef HAVE_AS_TLS\n #undef  TARGET_HAVE_TLS\n #define TARGET_HAVE_TLS true\n+#endif\n \n #undef  TARGET_HAVE_SPECULATION_SAFE_VALUE\n #define TARGET_HAVE_SPECULATION_SAFE_VALUE speculation_safe_value_not_needed"}]}