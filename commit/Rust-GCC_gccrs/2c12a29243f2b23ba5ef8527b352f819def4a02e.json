{"sha": "2c12a29243f2b23ba5ef8527b352f819def4a02e", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6MmMxMmEyOTI0M2YyYjIzYmE1ZWY4NTI3YjM1MmY4MTlkZWY0YTAyZQ==", "commit": {"author": {"name": "Samuel Tardieu", "email": "sam@rfc1149.net", "date": "2009-10-06T07:20:53Z"}, "committer": {"name": "Samuel Tardieu", "email": "sam@gcc.gnu.org", "date": "2009-10-06T07:20:53Z"}, "message": "re PR ada/41383 (Timing_Events: Event time not cleared after Cancel_Handler)\n\n    gcc/ada/\n\tPR ada/41383\n\t* a-rttiev.adb (Time_Of_Event): Return Time_First for unset event.\n\n    gcc/testsuite/\n\tPR ada/41383\n\t* gnat.dg/timer_cancel.adb: New test.\n\nFrom-SVN: r152487", "tree": {"sha": "73d6d2c0ee6281bab9b079de10675e983b099fb2", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/73d6d2c0ee6281bab9b079de10675e983b099fb2"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/2c12a29243f2b23ba5ef8527b352f819def4a02e", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/2c12a29243f2b23ba5ef8527b352f819def4a02e", "html_url": "https://github.com/Rust-GCC/gccrs/commit/2c12a29243f2b23ba5ef8527b352f819def4a02e", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/2c12a29243f2b23ba5ef8527b352f819def4a02e/comments", "author": {"login": "samueltardieu", "id": 44656, "node_id": "MDQ6VXNlcjQ0NjU2", "avatar_url": "https://avatars.githubusercontent.com/u/44656?v=4", "gravatar_id": "", "url": "https://api.github.com/users/samueltardieu", "html_url": "https://github.com/samueltardieu", "followers_url": "https://api.github.com/users/samueltardieu/followers", "following_url": "https://api.github.com/users/samueltardieu/following{/other_user}", "gists_url": "https://api.github.com/users/samueltardieu/gists{/gist_id}", "starred_url": "https://api.github.com/users/samueltardieu/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/samueltardieu/subscriptions", "organizations_url": "https://api.github.com/users/samueltardieu/orgs", "repos_url": "https://api.github.com/users/samueltardieu/repos", "events_url": "https://api.github.com/users/samueltardieu/events{/privacy}", "received_events_url": "https://api.github.com/users/samueltardieu/received_events", "type": "User", "site_admin": false}, "committer": null, "parents": [{"sha": "6fa30ef2813f3d16e1c7fb97f91cebfb14b8efb0", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/6fa30ef2813f3d16e1c7fb97f91cebfb14b8efb0", "html_url": "https://github.com/Rust-GCC/gccrs/commit/6fa30ef2813f3d16e1c7fb97f91cebfb14b8efb0"}], "stats": {"total": 56, "additions": 55, "deletions": 1}, "files": [{"sha": "d5e34e916ad138ae66ac216374858011d6684b90", "filename": "gcc/ada/ChangeLog", "status": "modified", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/2c12a29243f2b23ba5ef8527b352f819def4a02e/gcc%2Fada%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/2c12a29243f2b23ba5ef8527b352f819def4a02e/gcc%2Fada%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fada%2FChangeLog?ref=2c12a29243f2b23ba5ef8527b352f819def4a02e", "patch": "@@ -1,3 +1,8 @@\n+2009-10-06  Samuel Tardieu  <sam@rfc1149.net>\n+\n+\tPR ada/41383\n+\t* a-rttiev.adb (Time_Of_Event): Return Time_First for unset event.\n+\n 2009-10-06  Samuel Tardieu  <sam@rfc1149.net>\n \n \tPR ada/38333"}, {"sha": "55687ec8f6beb57f04c1d23cf9d65b22e2dcf84e", "filename": "gcc/ada/a-rttiev.adb", "status": "modified", "additions": 7, "deletions": 1, "changes": 8, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/2c12a29243f2b23ba5ef8527b352f819def4a02e/gcc%2Fada%2Fa-rttiev.adb", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/2c12a29243f2b23ba5ef8527b352f819def4a02e/gcc%2Fada%2Fa-rttiev.adb", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fada%2Fa-rttiev.adb?ref=2c12a29243f2b23ba5ef8527b352f819def4a02e", "patch": "@@ -332,7 +332,13 @@ package body Ada.Real_Time.Timing_Events is\n \n    function Time_Of_Event (Event : Timing_Event) return Time is\n    begin\n-      return Event.Timeout;\n+      --  RM D.15(18/2): Time_First must be returned if the event is not set\n+\n+      if Event.Handler = null then\n+         return Time_First;\n+      else\n+         return Event.Timeout;\n+      end if;\n    end Time_Of_Event;\n \n    --------------"}, {"sha": "e9214c2b3b4db31ab603972b6165527e1902cf35", "filename": "gcc/testsuite/ChangeLog", "status": "modified", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/2c12a29243f2b23ba5ef8527b352f819def4a02e/gcc%2Ftestsuite%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/2c12a29243f2b23ba5ef8527b352f819def4a02e/gcc%2Ftestsuite%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2FChangeLog?ref=2c12a29243f2b23ba5ef8527b352f819def4a02e", "patch": "@@ -1,3 +1,8 @@\n+2009-10-06  Samuel Tardieu  <sam@rfc1149.net>\n+\n+\tPR ada/41383\n+\t* gnat.dg/timer_cancel.adb: New test.\n+\n 2009-10-06  Samuel Tardieu  <sam@rfc1149.net>\n \n \tPR ada/38333"}, {"sha": "c300b47a859eb6610482ef56dd0c38552113142f", "filename": "gcc/testsuite/gnat.dg/timer_cancel.adb", "status": "added", "additions": 38, "deletions": 0, "changes": 38, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/2c12a29243f2b23ba5ef8527b352f819def4a02e/gcc%2Ftestsuite%2Fgnat.dg%2Ftimer_cancel.adb", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/2c12a29243f2b23ba5ef8527b352f819def4a02e/gcc%2Ftestsuite%2Fgnat.dg%2Ftimer_cancel.adb", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgnat.dg%2Ftimer_cancel.adb?ref=2c12a29243f2b23ba5ef8527b352f819def4a02e", "patch": "@@ -0,0 +1,38 @@\n+-- { dg-do run }\n+\n+with Ada.Real_Time.Timing_Events;\n+use Ada.Real_Time, Ada.Real_Time.Timing_Events;\n+\n+procedure Timer_Cancel is\n+\n+   E : Timing_Event;\n+   C : Boolean;\n+\n+   protected Dummy is\n+      procedure Trigger (Event : in out Timing_Event);\n+   end Dummy;\n+\n+   protected body Dummy is\n+      procedure Trigger (Event : in out Timing_Event) is\n+      begin\n+         null;\n+      end Trigger;\n+   end Dummy;\n+\n+begin\n+   Set_Handler (E, Time_Last, Dummy.Trigger'Unrestricted_Access);\n+\n+   if Time_Of_Event (E) /= Time_Last then\n+      raise Program_Error with \"Event time not set correctly\";\n+   end if;\n+\n+   Cancel_Handler (E, C);\n+\n+   if not C then\n+      raise Program_Error with \"Event triggered already\";\n+   end if;\n+\n+   if Time_Of_Event (E) /= Time_First then\n+      raise Program_Error with \"Event time not reset correctly\";\n+   end if;\n+end Timer_Cancel;"}]}