{"sha": "215161e20f2d87926fe0778cea032de8dee3c6bd", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6MjE1MTYxZTIwZjJkODc5MjZmZTA3NzhjZWEwMzJkZThkZWUzYzZiZA==", "commit": {"author": {"name": "Roman Zippel", "email": "zippel@linux-m68k.org", "date": "2007-09-07T16:46:23Z"}, "committer": {"name": "Roman Zippel", "email": "zippel@gcc.gnu.org", "date": "2007-09-07T16:46:23Z"}, "message": "function.h (struct function): Rename calls_unwind_init to saves_all_registers.\n\n\t* function.h (struct function): Rename calls_unwind_init\n\tto saves_all_registers.\n\t(current_function_saves_all_registers): Renamed from\n\tcurrent_function_calls_unwind_init.\n\t* reload1.c (reload): Set current_function_saves_all_registers.\n\t* except.c (expand_builtin_unwind_init): Likewise.\n\t* config/m68k/m68k.c (m68k_save_reg): Use\n\tcurrent_function_saves_all_registers to save pic register.\n\nFrom-SVN: r128248", "tree": {"sha": "341f78f63c5c8a8cca70354c3fe2ccdc86964074", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/341f78f63c5c8a8cca70354c3fe2ccdc86964074"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/215161e20f2d87926fe0778cea032de8dee3c6bd", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/215161e20f2d87926fe0778cea032de8dee3c6bd", "html_url": "https://github.com/Rust-GCC/gccrs/commit/215161e20f2d87926fe0778cea032de8dee3c6bd", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/215161e20f2d87926fe0778cea032de8dee3c6bd/comments", "author": null, "committer": null, "parents": [{"sha": "6ef9a246ce971efba493e86ffdba2b49f5045fb9", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/6ef9a246ce971efba493e86ffdba2b49f5045fb9", "html_url": "https://github.com/Rust-GCC/gccrs/commit/6ef9a246ce971efba493e86ffdba2b49f5045fb9"}], "stats": {"total": 34, "additions": 23, "deletions": 11}, "files": [{"sha": "ec6b104d014905eeff82c76c34d3d81146b6ee8c", "filename": "gcc/ChangeLog", "status": "modified", "additions": 11, "deletions": 0, "changes": 11, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/215161e20f2d87926fe0778cea032de8dee3c6bd/gcc%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/215161e20f2d87926fe0778cea032de8dee3c6bd/gcc%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2FChangeLog?ref=215161e20f2d87926fe0778cea032de8dee3c6bd", "patch": "@@ -1,3 +1,14 @@\n+2007-09-07  Roman Zippel <zippel@linux-m68k.org>\n+\n+\t* function.h (struct function): Rename calls_unwind_init\n+\tto saves_all_registers.\n+\t(current_function_saves_all_registers): Renamed from\n+\tcurrent_function_calls_unwind_init.\n+\t* reload1.c (reload): Set current_function_saves_all_registers.\n+\t* except.c (expand_builtin_unwind_init): Likewise.\n+\t* config/m68k/m68k.c (m68k_save_reg): Use\n+\tcurrent_function_saves_all_registers to save pic register.\n+\n 2007-09-07  Janis Johnson  <janis187@us.ibm.com>\n \n \tconfig/m68k/m68k.c (floating_exact_log2): Update call to real_2expN."}, {"sha": "8f7aa34f2286dd3ab1a347f012ec726faea180e3", "filename": "gcc/config/m68k/m68k.c", "status": "modified", "additions": 1, "deletions": 3, "changes": 4, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/215161e20f2d87926fe0778cea032de8dee3c6bd/gcc%2Fconfig%2Fm68k%2Fm68k.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/215161e20f2d87926fe0778cea032de8dee3c6bd/gcc%2Fconfig%2Fm68k%2Fm68k.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fconfig%2Fm68k%2Fm68k.c?ref=215161e20f2d87926fe0778cea032de8dee3c6bd", "patch": "@@ -780,9 +780,7 @@ m68k_save_reg (unsigned int regno, bool interrupt_handler)\n {\n   if (flag_pic && regno == PIC_REG)\n     {\n-      /* A function that receives a nonlocal goto must save all call-saved\n-\t registers.  */\n-      if (current_function_has_nonlocal_label)\n+      if (current_function_saves_all_registers)\n \treturn true;\n       if (current_function_uses_pic_offset_table)\n \treturn true;"}, {"sha": "f3204eb863ace383c23470a7ca854bf7ce4cd742", "filename": "gcc/except.c", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/215161e20f2d87926fe0778cea032de8dee3c6bd/gcc%2Fexcept.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/215161e20f2d87926fe0778cea032de8dee3c6bd/gcc%2Fexcept.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fexcept.c?ref=215161e20f2d87926fe0778cea032de8dee3c6bd", "patch": "@@ -2867,7 +2867,7 @@ expand_builtin_unwind_init (void)\n {\n   /* Set this so all the registers get saved in our frame; we need to be\n      able to copy the saved values for any registers from frames we unwind.  */\n-  current_function_calls_unwind_init = 1;\n+  current_function_saves_all_registers = 1;\n \n #ifdef SETUP_FRAME_ADDRESSES\n   SETUP_FRAME_ADDRESSES ();"}, {"sha": "27bde1c3bd0259838677751901f755fc182e6c26", "filename": "gcc/function.h", "status": "modified", "additions": 5, "deletions": 4, "changes": 9, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/215161e20f2d87926fe0778cea032de8dee3c6bd/gcc%2Ffunction.h", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/215161e20f2d87926fe0778cea032de8dee3c6bd/gcc%2Ffunction.h", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ffunction.h?ref=215161e20f2d87926fe0778cea032de8dee3c6bd", "patch": "@@ -387,9 +387,10 @@ struct function GTY(())\n      from nested functions.  */\n   unsigned int has_nonlocal_label : 1;\n \n-  /* Nonzero if function calls builtin_unwind_init.  */\n-  unsigned int calls_unwind_init : 1;\n-  \n+  /* Nonzero if function saves all registers, e.g. if it has a nonlocal\n+     label that can reach the exit block via non-exceptional paths. */\n+  unsigned int saves_all_registers : 1;\n+\n   /* Nonzero if function being compiled has nonlocal gotos to parent\n      function.  */\n   unsigned int has_nonlocal_goto : 1;\n@@ -503,7 +504,7 @@ extern void pop_cfun (void);\n #define current_function_uses_const_pool (cfun->uses_const_pool)\n #define current_function_epilogue_delay_list (cfun->epilogue_delay_list)\n #define current_function_has_nonlocal_label (cfun->has_nonlocal_label)\n-#define current_function_calls_unwind_init (cfun->calls_unwind_init)\n+#define current_function_saves_all_registers (cfun->saves_all_registers)\n #define current_function_has_nonlocal_goto (cfun->has_nonlocal_goto)\n #define current_function_has_asm_statement (cfun->has_asm_statement)\n "}, {"sha": "270ea0654cf0bf578c8f74d24d13038b185eb4dc", "filename": "gcc/reload1.c", "status": "modified", "additions": 5, "deletions": 3, "changes": 8, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/215161e20f2d87926fe0778cea032de8dee3c6bd/gcc%2Freload1.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/215161e20f2d87926fe0778cea032de8dee3c6bd/gcc%2Freload1.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Freload1.c?ref=215161e20f2d87926fe0778cea032de8dee3c6bd", "patch": "@@ -743,9 +743,11 @@ reload (rtx first, int global)\n   /* A function that has a nonlocal label that can reach the exit\n      block via non-exceptional paths must save all call-saved\n      registers.  */\n-  if (current_function_calls_unwind_init\n-      || (current_function_has_nonlocal_label\n-\t  && has_nonexceptional_receiver ()))\n+  if (current_function_has_nonlocal_label\n+      && has_nonexceptional_receiver ())\n+    current_function_saves_all_registers = 1;\n+\n+  if (current_function_saves_all_registers)\n     for (i = 0; i < FIRST_PSEUDO_REGISTER; i++)\n       if (! call_used_regs[i] && ! fixed_regs[i] && ! LOCAL_REGNO (i))\n \tdf_set_regs_ever_live (i, true);"}]}