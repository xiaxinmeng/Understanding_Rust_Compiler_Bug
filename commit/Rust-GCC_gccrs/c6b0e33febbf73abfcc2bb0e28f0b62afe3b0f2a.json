{"sha": "c6b0e33febbf73abfcc2bb0e28f0b62afe3b0f2a", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6YzZiMGUzM2ZlYmJmNzNhYmZjYzJiYjBlMjhmMGI2MmFmZTNiMGYyYQ==", "commit": {"author": {"name": "Paul Thomas", "email": "pault@gcc.gnu.org", "date": "2021-01-25T10:27:51Z"}, "committer": {"name": "Paul Thomas", "email": "pault@gcc.gnu.org", "date": "2021-01-25T10:27:51Z"}, "message": "Fortran: Fix deferred character lengths in array constructors [PR98517].\n\n2021-01-25  Steve Kargl  <kargl@gcc.gnu.org>\n\ngcc/fortran\n\tPR fortran/98517\n\t* resolve.c (resolve_charlen): Check that length expression is\n\tpresent before testing for scalar/integer..\n\ngcc/testsuite/\n\tPR fortran/98517\n\t* gfortran.dg/charlen_18.f90 : New test.", "tree": {"sha": "938d3c78385f2c7ad4d7deb04a28cbb03855e18c", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/938d3c78385f2c7ad4d7deb04a28cbb03855e18c"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/c6b0e33febbf73abfcc2bb0e28f0b62afe3b0f2a", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/c6b0e33febbf73abfcc2bb0e28f0b62afe3b0f2a", "html_url": "https://github.com/Rust-GCC/gccrs/commit/c6b0e33febbf73abfcc2bb0e28f0b62afe3b0f2a", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/c6b0e33febbf73abfcc2bb0e28f0b62afe3b0f2a/comments", "author": null, "committer": null, "parents": [{"sha": "28229916e1b131ad5d17a73603f65229e0a92f58", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/28229916e1b131ad5d17a73603f65229e0a92f58", "html_url": "https://github.com/Rust-GCC/gccrs/commit/28229916e1b131ad5d17a73603f65229e0a92f58"}], "stats": {"total": 21, "additions": 20, "deletions": 1}, "files": [{"sha": "11b5dbc7a0336595bd9475cb29691b0ff68ae27b", "filename": "gcc/fortran/resolve.c", "status": "modified", "additions": 2, "deletions": 1, "changes": 3, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/c6b0e33febbf73abfcc2bb0e28f0b62afe3b0f2a/gcc%2Ffortran%2Fresolve.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/c6b0e33febbf73abfcc2bb0e28f0b62afe3b0f2a/gcc%2Ffortran%2Fresolve.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ffortran%2Fresolve.c?ref=c6b0e33febbf73abfcc2bb0e28f0b62afe3b0f2a", "patch": "@@ -12446,7 +12446,8 @@ resolve_charlen (gfc_charlen *cl)\n \t}\n \n       /* cl->length has been resolved.  It should have an integer type.  */\n-      if (cl->length->ts.type != BT_INTEGER || cl->length->rank != 0)\n+      if (cl->length\n+\t  && (cl->length->ts.type != BT_INTEGER || cl->length->rank != 0))\n \t{\n \t  gfc_error (\"Scalar INTEGER expression expected at %L\",\n \t\t     &cl->length->where);"}, {"sha": "5ad287448b45dbc8e806bccde6de268af5497d18", "filename": "gcc/testsuite/gfortran.dg/charlen_18.f90", "status": "added", "additions": 18, "deletions": 0, "changes": 18, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/c6b0e33febbf73abfcc2bb0e28f0b62afe3b0f2a/gcc%2Ftestsuite%2Fgfortran.dg%2Fcharlen_18.f90", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/c6b0e33febbf73abfcc2bb0e28f0b62afe3b0f2a/gcc%2Ftestsuite%2Fgfortran.dg%2Fcharlen_18.f90", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgfortran.dg%2Fcharlen_18.f90?ref=c6b0e33febbf73abfcc2bb0e28f0b62afe3b0f2a", "patch": "@@ -0,0 +1,18 @@\n+! { dg-do compile }\n+! { dg-options \"-fdec-structure\" }\n+!\n+! Check fix for PR98517\n+!\n+! Contributed by Eric Reischer  <emr-gnu@hev.psu.edu>\n+!\n+      SUBROUTINE TEST_BUG\n+      IMPLICIT NONE\n+\n+      CHARACTER*(*) DEF_VAL\n+      PARAMETER (DEF_VAL = 'ABCDEFGH')\n+\n+      STRUCTURE /SOME_STRUCT/\n+          CHARACTER*64    SOME_VAR /DEF_VAL/\n+      END STRUCTURE\n+\n+      END"}]}