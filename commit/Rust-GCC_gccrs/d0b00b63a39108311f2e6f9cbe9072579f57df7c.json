{"sha": "d0b00b63a39108311f2e6f9cbe9072579f57df7c", "node_id": "C_kwDOANBUbNoAKGQwYjAwYjYzYTM5MTA4MzExZjJlNmY5Y2JlOTA3MjU3OWY1N2RmN2M", "commit": {"author": {"name": "Stefan Schulze Frielinghaus", "email": "stefansf@linux.ibm.com", "date": "2022-09-28T15:27:11Z"}, "committer": {"name": "Stefan Schulze Frielinghaus", "email": "stefansf@linux.ibm.com", "date": "2022-09-28T15:27:11Z"}, "message": "cselib: Keep track of further subvalue relations\n\nWhenever a new cselib value is created check whether a smaller value\nexists which is contained in the bigger one.  If so add a subreg\nrelation to locs of the smaller one.\n\ngcc/ChangeLog:\n\n\t* cselib.cc (new_cselib_val): Keep track of further subvalue\n\trelations.", "tree": {"sha": "9a919bf5de8444b5e14d1d4e738faa4dc0062312", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/9a919bf5de8444b5e14d1d4e738faa4dc0062312"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/d0b00b63a39108311f2e6f9cbe9072579f57df7c", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/d0b00b63a39108311f2e6f9cbe9072579f57df7c", "html_url": "https://github.com/Rust-GCC/gccrs/commit/d0b00b63a39108311f2e6f9cbe9072579f57df7c", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/d0b00b63a39108311f2e6f9cbe9072579f57df7c/comments", "author": {"login": "stefan-sf-ibm", "id": 73470131, "node_id": "MDQ6VXNlcjczNDcwMTMx", "avatar_url": "https://avatars.githubusercontent.com/u/73470131?v=4", "gravatar_id": "", "url": "https://api.github.com/users/stefan-sf-ibm", "html_url": "https://github.com/stefan-sf-ibm", "followers_url": "https://api.github.com/users/stefan-sf-ibm/followers", "following_url": "https://api.github.com/users/stefan-sf-ibm/following{/other_user}", "gists_url": "https://api.github.com/users/stefan-sf-ibm/gists{/gist_id}", "starred_url": "https://api.github.com/users/stefan-sf-ibm/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/stefan-sf-ibm/subscriptions", "organizations_url": "https://api.github.com/users/stefan-sf-ibm/orgs", "repos_url": "https://api.github.com/users/stefan-sf-ibm/repos", "events_url": "https://api.github.com/users/stefan-sf-ibm/events{/privacy}", "received_events_url": "https://api.github.com/users/stefan-sf-ibm/received_events", "type": "User", "site_admin": false}, "committer": {"login": "stefan-sf-ibm", "id": 73470131, "node_id": "MDQ6VXNlcjczNDcwMTMx", "avatar_url": "https://avatars.githubusercontent.com/u/73470131?v=4", "gravatar_id": "", "url": "https://api.github.com/users/stefan-sf-ibm", "html_url": "https://github.com/stefan-sf-ibm", "followers_url": "https://api.github.com/users/stefan-sf-ibm/followers", "following_url": "https://api.github.com/users/stefan-sf-ibm/following{/other_user}", "gists_url": "https://api.github.com/users/stefan-sf-ibm/gists{/gist_id}", "starred_url": "https://api.github.com/users/stefan-sf-ibm/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/stefan-sf-ibm/subscriptions", "organizations_url": "https://api.github.com/users/stefan-sf-ibm/orgs", "repos_url": "https://api.github.com/users/stefan-sf-ibm/repos", "events_url": "https://api.github.com/users/stefan-sf-ibm/events{/privacy}", "received_events_url": "https://api.github.com/users/stefan-sf-ibm/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "5e9c4ed903c39f82f28362d9411d4dbc491264ec", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/5e9c4ed903c39f82f28362d9411d4dbc491264ec", "html_url": "https://github.com/Rust-GCC/gccrs/commit/5e9c4ed903c39f82f28362d9411d4dbc491264ec"}], "stats": {"total": 20, "additions": 20, "deletions": 0}, "files": [{"sha": "9b582e5d3d6db03dd6e47d331830a5ef04fcae31", "filename": "gcc/cselib.cc", "status": "modified", "additions": 20, "deletions": 0, "changes": 20, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/d0b00b63a39108311f2e6f9cbe9072579f57df7c/gcc%2Fcselib.cc", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/d0b00b63a39108311f2e6f9cbe9072579f57df7c/gcc%2Fcselib.cc", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fcselib.cc?ref=d0b00b63a39108311f2e6f9cbe9072579f57df7c", "patch": "@@ -1569,6 +1569,26 @@ new_cselib_val (unsigned int hash, machine_mode mode, rtx x)\n   e->locs = 0;\n   e->next_containing_mem = 0;\n \n+  scalar_int_mode int_mode;\n+  if (REG_P (x) && is_int_mode (mode, &int_mode)\n+      && REG_VALUES (REGNO (x)) != NULL\n+      && (!cselib_current_insn || !DEBUG_INSN_P (cselib_current_insn)))\n+    {\n+      rtx copy = shallow_copy_rtx (x);\n+      scalar_int_mode narrow_mode_iter;\n+      FOR_EACH_MODE_UNTIL (narrow_mode_iter, int_mode)\n+\t{\n+\t  PUT_MODE_RAW (copy, narrow_mode_iter);\n+\t  cselib_val *v = cselib_lookup (copy, narrow_mode_iter, 0, VOIDmode);\n+\t  if (v)\n+\t    {\n+\t      rtx sub = lowpart_subreg (narrow_mode_iter, e->val_rtx, int_mode);\n+\t      if (sub)\n+\t\tnew_elt_loc_list (v, sub);\n+\t    }\n+\t}\n+    }\n+\n   if (dump_file && (dump_flags & TDF_CSELIB))\n     {\n       fprintf (dump_file, \"cselib value %u:%u \", e->uid, hash);"}]}