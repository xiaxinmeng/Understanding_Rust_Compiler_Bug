{"sha": "ff137b6261c1fdbc2e49a439fb5872ec673e7447", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6ZmYxMzdiNjI2MWMxZmRiYzJlNDlhNDM5ZmI1ODcyZWM2NzNlNzQ0Nw==", "commit": {"author": {"name": "Philip Herron", "email": "philip.herron@embecosm.com", "date": "2021-07-16T08:40:47Z"}, "committer": {"name": "Philip Herron", "email": "philip.herron@embecosm.com", "date": "2021-07-16T12:07:17Z"}, "message": "Keep track of impl blocks via mappings\n\nIf we keep track of the impl blocks within the crate's we can use this\nas another way to stream line looking up of specific HIR::Items. This\nwill be used to find possible bounds for a receiver in a path probe.", "tree": {"sha": "fada843894d31cdefe6ddbcfa973efe9ddd928e8", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/fada843894d31cdefe6ddbcfa973efe9ddd928e8"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/ff137b6261c1fdbc2e49a439fb5872ec673e7447", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/ff137b6261c1fdbc2e49a439fb5872ec673e7447", "html_url": "https://github.com/Rust-GCC/gccrs/commit/ff137b6261c1fdbc2e49a439fb5872ec673e7447", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/ff137b6261c1fdbc2e49a439fb5872ec673e7447/comments", "author": {"login": "philberty", "id": 84585, "node_id": "MDQ6VXNlcjg0NTg1", "avatar_url": "https://avatars.githubusercontent.com/u/84585?v=4", "gravatar_id": "", "url": "https://api.github.com/users/philberty", "html_url": "https://github.com/philberty", "followers_url": "https://api.github.com/users/philberty/followers", "following_url": "https://api.github.com/users/philberty/following{/other_user}", "gists_url": "https://api.github.com/users/philberty/gists{/gist_id}", "starred_url": "https://api.github.com/users/philberty/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/philberty/subscriptions", "organizations_url": "https://api.github.com/users/philberty/orgs", "repos_url": "https://api.github.com/users/philberty/repos", "events_url": "https://api.github.com/users/philberty/events{/privacy}", "received_events_url": "https://api.github.com/users/philberty/received_events", "type": "User", "site_admin": false}, "committer": {"login": "philberty", "id": 84585, "node_id": "MDQ6VXNlcjg0NTg1", "avatar_url": "https://avatars.githubusercontent.com/u/84585?v=4", "gravatar_id": "", "url": "https://api.github.com/users/philberty", "html_url": "https://github.com/philberty", "followers_url": "https://api.github.com/users/philberty/followers", "following_url": "https://api.github.com/users/philberty/following{/other_user}", "gists_url": "https://api.github.com/users/philberty/gists{/gist_id}", "starred_url": "https://api.github.com/users/philberty/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/philberty/subscriptions", "organizations_url": "https://api.github.com/users/philberty/orgs", "repos_url": "https://api.github.com/users/philberty/repos", "events_url": "https://api.github.com/users/philberty/events{/privacy}", "received_events_url": "https://api.github.com/users/philberty/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "f813b3309837f8fea19a0924f22a3f20a3ac8304", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/f813b3309837f8fea19a0924f22a3f20a3ac8304", "html_url": "https://github.com/Rust-GCC/gccrs/commit/f813b3309837f8fea19a0924f22a3f20a3ac8304"}], "stats": {"total": 33, "additions": 33, "deletions": 0}, "files": [{"sha": "5ba591831794e67714b51bda525c83e9bdb15b69", "filename": "gcc/rust/hir/rust-ast-lower-item.h", "status": "modified", "additions": 4, "deletions": 0, "changes": 4, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/ff137b6261c1fdbc2e49a439fb5872ec673e7447/gcc%2Frust%2Fhir%2Frust-ast-lower-item.h", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/ff137b6261c1fdbc2e49a439fb5872ec673e7447/gcc%2Frust%2Fhir%2Frust-ast-lower-item.h", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Frust%2Fhir%2Frust-ast-lower-item.h?ref=ff137b6261c1fdbc2e49a439fb5872ec673e7447", "patch": "@@ -396,6 +396,8 @@ class ASTLoweringItem : public ASTLoweringBase\n     mappings->insert_defid_mapping (mapping.get_defid (), translated);\n     mappings->insert_hir_item (mapping.get_crate_num (), mapping.get_hirid (),\n \t\t\t       translated);\n+    mappings->insert_hir_impl_block (mapping.get_crate_num (),\n+\t\t\t\t     mapping.get_hirid (), hir_impl_block);\n     mappings->insert_location (crate_num, mapping.get_hirid (),\n \t\t\t       impl_block.get_locus ());\n \n@@ -540,6 +542,8 @@ class ASTLoweringItem : public ASTLoweringBase\n     mappings->insert_defid_mapping (mapping.get_defid (), translated);\n     mappings->insert_hir_item (mapping.get_crate_num (), mapping.get_hirid (),\n \t\t\t       translated);\n+    mappings->insert_hir_impl_block (mapping.get_crate_num (),\n+\t\t\t\t     mapping.get_hirid (), hir_impl_block);\n     mappings->insert_location (crate_num, mapping.get_hirid (),\n \t\t\t       impl_block.get_locus ());\n "}, {"sha": "33ba8d0da30a26ecf6d71e1d84efa785f01b768f", "filename": "gcc/rust/util/rust-hir-map.cc", "status": "modified", "additions": 24, "deletions": 0, "changes": 24, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/ff137b6261c1fdbc2e49a439fb5872ec673e7447/gcc%2Frust%2Futil%2Frust-hir-map.cc", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/ff137b6261c1fdbc2e49a439fb5872ec673e7447/gcc%2Frust%2Futil%2Frust-hir-map.cc", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Frust%2Futil%2Frust-hir-map.cc?ref=ff137b6261c1fdbc2e49a439fb5872ec673e7447", "patch": "@@ -259,6 +259,30 @@ Mappings::lookup_hir_item (CrateNum crateNum, HirId id)\n   return iy->second;\n }\n \n+void\n+Mappings::insert_hir_impl_block (CrateNum crateNum, HirId id,\n+\t\t\t\t HIR::ImplBlock *item)\n+{\n+  rust_assert (lookup_hir_impl_block (crateNum, id) == nullptr);\n+\n+  hirImplBlockMappings[crateNum][id] = item;\n+  nodeIdToHirMappings[crateNum][item->get_mappings ().get_nodeid ()] = id;\n+}\n+\n+HIR::ImplBlock *\n+Mappings::lookup_hir_impl_block (CrateNum crateNum, HirId id)\n+{\n+  auto it = hirImplBlockMappings.find (crateNum);\n+  if (it == hirImplBlockMappings.end ())\n+    return nullptr;\n+\n+  auto iy = it->second.find (id);\n+  if (iy == it->second.end ())\n+    return nullptr;\n+\n+  return iy->second;\n+}\n+\n void\n Mappings::insert_hir_implitem (CrateNum crateNum, HirId id,\n \t\t\t       HirId parent_impl_id, HIR::ImplItem *item)"}, {"sha": "98c15a233a66ef4ba6be30d8531304c1473b8901", "filename": "gcc/rust/util/rust-hir-map.h", "status": "modified", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/ff137b6261c1fdbc2e49a439fb5872ec673e7447/gcc%2Frust%2Futil%2Frust-hir-map.h", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/ff137b6261c1fdbc2e49a439fb5872ec673e7447/gcc%2Frust%2Futil%2Frust-hir-map.h", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Frust%2Futil%2Frust-hir-map.h?ref=ff137b6261c1fdbc2e49a439fb5872ec673e7447", "patch": "@@ -128,6 +128,10 @@ class Mappings\n   void insert_hir_item (CrateNum crateNum, HirId id, HIR::Item *item);\n   HIR::Item *lookup_hir_item (CrateNum crateNum, HirId id);\n \n+  void insert_hir_impl_block (CrateNum crateNum, HirId id,\n+\t\t\t      HIR::ImplBlock *item);\n+  HIR::ImplBlock *lookup_hir_impl_block (CrateNum crateNum, HirId id);\n+\n   void insert_hir_implitem (CrateNum crateNum, HirId id, HirId parent_impl_id,\n \t\t\t    HIR::ImplItem *item);\n   HIR::ImplItem *lookup_hir_implitem (CrateNum crateNum, HirId id,\n@@ -227,6 +231,7 @@ class Mappings\n     hirImplItemMappings;\n   std::map<CrateNum, std::map<HirId, HIR::SelfParam *> > hirSelfParamMappings;\n   std::map<HirId, HIR::ImplBlock *> hirImplItemsToImplMappings;\n+  std::map<CrateNum, std::map<HirId, HIR::ImplBlock *> > hirImplBlockMappings;\n \n   // location info\n   std::map<CrateNum, std::map<NodeId, Location> > locations;"}]}