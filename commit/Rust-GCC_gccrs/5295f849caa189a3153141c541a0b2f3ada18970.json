{"sha": "5295f849caa189a3153141c541a0b2f3ada18970", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6NTI5NWY4NDljYWExODlhMzE1MzE0MWM1NDFhMGIyZjNhZGExODk3MA==", "commit": {"author": {"name": "Per Bothner", "email": "per@bothner.com", "date": "2002-03-08T20:59:52Z"}, "committer": {"name": "Per Bothner", "email": "bothner@gcc.gnu.org", "date": "2002-03-08T20:59:52Z"}, "message": "re PR java/5812 (GCJ 3.0.2 segfaults on class file from Sun JDK 1.3 compiler)\n\n\n\tFix for PR java/5812.\n\t* expr.c (build_java_jsr):  Take pc arguments, and do lookup_label\n\tgere instead of in JSR macro.  Likewise with load_type_state call.\n\tDo the latter on if the return_pc has been verified (the jsr returns).\n\t(JSR):  No just call build_java_jsr.\n\nFrom-SVN: r50455", "tree": {"sha": "9db34f3dffa778bcdbf16646952570a8498d6bb3", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/9db34f3dffa778bcdbf16646952570a8498d6bb3"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/5295f849caa189a3153141c541a0b2f3ada18970", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/5295f849caa189a3153141c541a0b2f3ada18970", "html_url": "https://github.com/Rust-GCC/gccrs/commit/5295f849caa189a3153141c541a0b2f3ada18970", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/5295f849caa189a3153141c541a0b2f3ada18970/comments", "author": {"login": "PerBothner", "id": 10293361, "node_id": "MDQ6VXNlcjEwMjkzMzYx", "avatar_url": "https://avatars.githubusercontent.com/u/10293361?v=4", "gravatar_id": "", "url": "https://api.github.com/users/PerBothner", "html_url": "https://github.com/PerBothner", "followers_url": "https://api.github.com/users/PerBothner/followers", "following_url": "https://api.github.com/users/PerBothner/following{/other_user}", "gists_url": "https://api.github.com/users/PerBothner/gists{/gist_id}", "starred_url": "https://api.github.com/users/PerBothner/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/PerBothner/subscriptions", "organizations_url": "https://api.github.com/users/PerBothner/orgs", "repos_url": "https://api.github.com/users/PerBothner/repos", "events_url": "https://api.github.com/users/PerBothner/events{/privacy}", "received_events_url": "https://api.github.com/users/PerBothner/received_events", "type": "User", "site_admin": false}, "committer": null, "parents": [{"sha": "c51d95ecef9cfee1e96789495a5086a84b22ad56", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/c51d95ecef9cfee1e96789495a5086a84b22ad56", "html_url": "https://github.com/Rust-GCC/gccrs/commit/c51d95ecef9cfee1e96789495a5086a84b22ad56"}], "stats": {"total": 28, "additions": 17, "deletions": 11}, "files": [{"sha": "5210c93afaab5007bc14a2d596ddb0bb0216e230", "filename": "gcc/java/ChangeLog", "status": "modified", "additions": 8, "deletions": 0, "changes": 8, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/5295f849caa189a3153141c541a0b2f3ada18970/gcc%2Fjava%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/5295f849caa189a3153141c541a0b2f3ada18970/gcc%2Fjava%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fjava%2FChangeLog?ref=5295f849caa189a3153141c541a0b2f3ada18970", "patch": "@@ -1,3 +1,11 @@\n+2002-03-08  Per Bothner  <per@bothner.com>\n+\n+\tFix for PR java/5812.\n+\t* expr.c (build_java_jsr):  Take pc arguments, and do lookup_label\n+\tgere instead of in JSR macro.  Likewise with load_type_state call.\n+\tDo the latter on if the return_pc has been verified (the jsr returns).\n+\t(JSR):  No just call build_java_jsr.\n+\n 2002-03-07  Jeff Sturm  <jsturm@one-point.com>\n \n \t* java/Make-lang.in (JAVA_TARGET_INSTALL_NAME): Define."}, {"sha": "8eb816e2392cf48845c453b5f40f6a10861dcfb3", "filename": "gcc/java/expr.c", "status": "modified", "additions": 9, "deletions": 11, "changes": 20, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/5295f849caa189a3153141c541a0b2f3ada18970/gcc%2Fjava%2Fexpr.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/5295f849caa189a3153141c541a0b2f3ada18970/gcc%2Fjava%2Fexpr.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fjava%2Fexpr.c?ref=5295f849caa189a3153141c541a0b2f3ada18970", "patch": "@@ -48,7 +48,7 @@ static tree pop_value PARAMS ((tree));\n static void java_stack_swap PARAMS ((void));\n static void java_stack_dup PARAMS ((int, int));\n static void build_java_athrow PARAMS ((tree));\n-static void build_java_jsr PARAMS ((tree, tree));\n+static void build_java_jsr PARAMS ((int, int));\n static void build_java_ret PARAMS ((tree));\n static void expand_java_multianewarray PARAMS ((tree, int));\n static void expand_java_arraystore PARAMS ((tree));\n@@ -607,15 +607,18 @@ build_java_athrow (node)\n /* Implementation for jsr/ret */\n \n static void\n-build_java_jsr (where, ret)\n-    tree where;\n-    tree ret;\n+build_java_jsr (target_pc, return_pc)\n+     int target_pc, return_pc;\n {\n+  tree where =  lookup_label (target_pc);\n+  tree ret = lookup_label (return_pc);\n   tree ret_label = fold (build1 (ADDR_EXPR, return_address_type_node, ret));\n   push_value (ret_label);\n   flush_quick_stack ();\n   emit_jump (label_rtx (where));\n   expand_label (ret);\n+  if (instruction_bits [return_pc] & BCODE_VERIFIED)\n+    load_type_state (ret);\n }\n \n static void\n@@ -2968,13 +2971,8 @@ process_jvm_instruction (PC, byte_ops, length)\n     build_java_ret (find_local_variable (index, ptr_type_node, oldpc));\t\\\n   }\n \n-#define JSR(OPERAND_TYPE, OPERAND_VALUE)\t\t\\\n-  {\t\t\t\t\t\t\t\\\n-    tree where = lookup_label (oldpc+OPERAND_VALUE);\t\\\n-    tree ret   = lookup_label (PC);\t\t\t\\\n-    build_java_jsr (where, ret);\t\t\t\\\n-    load_type_state (ret);\t\t\t\t\\\n-  }\n+#define JSR(OPERAND_TYPE, OPERAND_VALUE) \\\n+  build_java_jsr (oldpc+OPERAND_VALUE, PC);\n \n /* Push a constant onto the stack. */\n #define PUSHC(OPERAND_TYPE, OPERAND_VALUE) \\"}]}