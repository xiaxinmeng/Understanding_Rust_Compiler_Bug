{"sha": "16370fa72fff9ed8f0a65d167e3e5b9f9200180d", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6MTYzNzBmYTcyZmZmOWVkOGYwYTY1ZDE2N2UzZTViOWY5MjAwMTgwZA==", "commit": {"author": {"name": "H.J. Lu", "email": "hongjiu.lu@intel.com", "date": "2014-01-24T03:38:10Z"}, "committer": {"name": "H.J. Lu", "email": "hjl@gcc.gnu.org", "date": "2014-01-24T03:38:10Z"}, "message": "Get stack adjustment from push operand in pushsf splitter\n\npushsf for -m64/-mx32 looks like\n\n(set (mem:SF (pre_modify:SI (reg/f:SI 7 sp)\n\t\t\t    (plus:SI (reg/f:SI 7 sp)\n\t\t\t    (const_int -8))))\n     (reg:SF 22 xmm1 [orig:84 D.1790 ] [84]))\n\nStack adjustment is in push operand and it isn't stack register mode size\nwhich may be 4 bytes for -mx32.  This patch gets stack adjustment from\npush operand if code of push isn't PRE_DEC.\n\ngcc/\n\n\tPR target/59929\n\t* config/i386/i386.md (pushsf splitter): Get stack adjustment\n\tfrom push operand if code of push isn't PRE_DEC.\n\ngcc/testsuite/\n\n\tPR target/59929\n\t* gcc.target/i386/pr59929.c: New test.\n\nFrom-SVN: r207023", "tree": {"sha": "1b60119c165780604b3601e747df63618ab474ea", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/1b60119c165780604b3601e747df63618ab474ea"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/16370fa72fff9ed8f0a65d167e3e5b9f9200180d", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/16370fa72fff9ed8f0a65d167e3e5b9f9200180d", "html_url": "https://github.com/Rust-GCC/gccrs/commit/16370fa72fff9ed8f0a65d167e3e5b9f9200180d", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/16370fa72fff9ed8f0a65d167e3e5b9f9200180d/comments", "author": {"login": "hjl-tools", "id": 1072356, "node_id": "MDQ6VXNlcjEwNzIzNTY=", "avatar_url": "https://avatars.githubusercontent.com/u/1072356?v=4", "gravatar_id": "", "url": "https://api.github.com/users/hjl-tools", "html_url": "https://github.com/hjl-tools", "followers_url": "https://api.github.com/users/hjl-tools/followers", "following_url": "https://api.github.com/users/hjl-tools/following{/other_user}", "gists_url": "https://api.github.com/users/hjl-tools/gists{/gist_id}", "starred_url": "https://api.github.com/users/hjl-tools/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/hjl-tools/subscriptions", "organizations_url": "https://api.github.com/users/hjl-tools/orgs", "repos_url": "https://api.github.com/users/hjl-tools/repos", "events_url": "https://api.github.com/users/hjl-tools/events{/privacy}", "received_events_url": "https://api.github.com/users/hjl-tools/received_events", "type": "User", "site_admin": false}, "committer": null, "parents": [{"sha": "b846c948f29c4b56d6c14a509df4164049dabbd3", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/b846c948f29c4b56d6c14a509df4164049dabbd3", "html_url": "https://github.com/Rust-GCC/gccrs/commit/b846c948f29c4b56d6c14a509df4164049dabbd3"}], "stats": {"total": 81, "additions": 80, "deletions": 1}, "files": [{"sha": "cdbedadc64cbb93764b553d2eff81a9b5f668c2e", "filename": "gcc/ChangeLog", "status": "modified", "additions": 6, "deletions": 0, "changes": 6, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/16370fa72fff9ed8f0a65d167e3e5b9f9200180d/gcc%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/16370fa72fff9ed8f0a65d167e3e5b9f9200180d/gcc%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2FChangeLog?ref=16370fa72fff9ed8f0a65d167e3e5b9f9200180d", "patch": "@@ -1,3 +1,9 @@\n+2014-01-23  H.J. Lu  <hongjiu.lu@intel.com>\n+\n+\tPR target/59929\n+\t* config/i386/i386.md (pushsf splitter): Get stack adjustment\n+\tfrom push operand if code of push isn't PRE_DEC.\n+\n 2014-01-23  Michael Meissner  <meissner@linux.vnet.ibm.com>\n \n \tPR target/59909"}, {"sha": "92e8fd0144cf22ead7cf60cd8a3f11e9644ba0dd", "filename": "gcc/config/i386/i386.md", "status": "modified", "additions": 14, "deletions": 1, "changes": 15, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/16370fa72fff9ed8f0a65d167e3e5b9f9200180d/gcc%2Fconfig%2Fi386%2Fi386.md", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/16370fa72fff9ed8f0a65d167e3e5b9f9200180d/gcc%2Fconfig%2Fi386%2Fi386.md", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fconfig%2Fi386%2Fi386.md?ref=16370fa72fff9ed8f0a65d167e3e5b9f9200180d", "patch": "@@ -2765,7 +2765,20 @@\n   \"reload_completed\"\n   [(set (reg:P SP_REG) (plus:P (reg:P SP_REG) (match_dup 2)))\n    (set (mem:SF (reg:P SP_REG)) (match_dup 1))]\n-  \"operands[2] = GEN_INT (-<P:MODE_SIZE>);\")\n+{\n+  rtx op = XEXP (operands[0], 0);\n+  if (GET_CODE (op) == PRE_DEC)\n+    {\n+      gcc_assert (!TARGET_64BIT);\n+      op = GEN_INT (-4);\n+    }\n+  else\n+    {\n+      op = XEXP (XEXP (op, 1), 1);\n+      gcc_assert (CONST_INT_P (op));\n+    }\n+  operands[2] = op;\n+})\n \n (define_split\n   [(set (match_operand:SF 0 \"push_operand\")"}, {"sha": "91c06d50f3ea24766f8596cff5393d2ebfb9ecea", "filename": "gcc/testsuite/ChangeLog", "status": "modified", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/16370fa72fff9ed8f0a65d167e3e5b9f9200180d/gcc%2Ftestsuite%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/16370fa72fff9ed8f0a65d167e3e5b9f9200180d/gcc%2Ftestsuite%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2FChangeLog?ref=16370fa72fff9ed8f0a65d167e3e5b9f9200180d", "patch": "@@ -1,3 +1,8 @@\n+2014-01-23  H.J. Lu  <hongjiu.lu@intel.com>\n+\n+\tPR target/59929\n+\t* gcc.target/i386/pr59929.c: New test.\n+\n 2014-01-23  Michael Meissner  <meissner@linux.vnet.ibm.com>\n \n \tPR target/59909"}, {"sha": "4591dc4d6016bbe9a4d4f8c921ec60d57b10b69c", "filename": "gcc/testsuite/gcc.target/i386/pr59929.c", "status": "added", "additions": 55, "deletions": 0, "changes": 55, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/16370fa72fff9ed8f0a65d167e3e5b9f9200180d/gcc%2Ftestsuite%2Fgcc.target%2Fi386%2Fpr59929.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/16370fa72fff9ed8f0a65d167e3e5b9f9200180d/gcc%2Ftestsuite%2Fgcc.target%2Fi386%2Fpr59929.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgcc.target%2Fi386%2Fpr59929.c?ref=16370fa72fff9ed8f0a65d167e3e5b9f9200180d", "patch": "@@ -0,0 +1,55 @@\n+/* { dg-do run } */\n+/* { dg-options \"-O0 -mno-accumulate-outgoing-args\" } */\n+/* { dg-options \"-O0 -mno-accumulate-outgoing-args -mx32 -maddress-mode=short\" { target x32 } } */\n+\n+void\n+__attribute__ ((noinline))\n+test (float x1, float x2, float x3, float x4, float x5, float x6,\n+      float x7, float x8, float x9, float x10, float x11, float x12,\n+      float x13, float x14, float x15, float x16)\n+{\n+  if (x1 != 91\n+      || x2 != 92\n+      || x3 != 93\n+      || x4 != 94\n+      || x5 != 95\n+      || x6 != 96\n+      || x7 != 97\n+      || x8 != 98\n+      || x9 != 99\n+      || x10 != 100\n+      || x11 != 101\n+      || x12 != 102\n+      || x13 != 103\n+      || x14 != 104\n+      || x15 != 105\n+      || x16 != 106)\n+    __builtin_abort ();\n+}\n+\n+float x1, x2, x3, x4, x5, x6, x7, x8, x9, x10, x11, x12, x13,\n+      x14, x15, x16;\n+\n+int\n+main ()\n+{\n+  x1 = 91;\n+  x2 = 92;\n+  x3 = 93;\n+  x4 = 94;\n+  x5 = 95;\n+  x6 = 96;\n+  x7 = 97;\n+  x8 = 98;\n+  x9 = 99;\n+  x10 = 100;\n+  x11 = 101;\n+  x12 = 102;\n+  x13 = 103;\n+  x14 = 104;\n+  x15 = 105;\n+  x16 = 106;\n+  test (x1, x2, x3, x4, x5, x6, x7, x8, x9, x10, x11, x12, x13,\n+\tx14, x15, x16);\n+  return 0;\n+}"}]}