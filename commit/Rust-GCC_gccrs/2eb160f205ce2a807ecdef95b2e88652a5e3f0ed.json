{"sha": "2eb160f205ce2a807ecdef95b2e88652a5e3f0ed", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6MmViMTYwZjIwNWNlMmE4MDdlY2RlZjk1YjJlODg2NTJhNWUzZjBlZA==", "commit": {"author": {"name": "Samuel Tardieu", "email": "sam@rfc1149.net", "date": "2007-12-07T14:35:22Z"}, "committer": {"name": "Samuel Tardieu", "email": "sam@gcc.gnu.org", "date": "2007-12-07T14:35:22Z"}, "message": "re PR ada/15805 (Illegal program not detected, allows writing through access to constant)\n\n    gcc/ada/\n\tPR ada/15805\n\t* sem_ch6.adb (Process_Formals): Prevent an access type formal\n\tto be initialized with an access to constant object.\n\n    gcc/testsuite/\n\tPR ada/15805\n\t* gnat.dg/specs/access_constants.ads: New test.\n\nFrom-SVN: r130676", "tree": {"sha": "99ac07d9e57d5b57c2e90cab12cbde419f4ecfb6", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/99ac07d9e57d5b57c2e90cab12cbde419f4ecfb6"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/2eb160f205ce2a807ecdef95b2e88652a5e3f0ed", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/2eb160f205ce2a807ecdef95b2e88652a5e3f0ed", "html_url": "https://github.com/Rust-GCC/gccrs/commit/2eb160f205ce2a807ecdef95b2e88652a5e3f0ed", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/2eb160f205ce2a807ecdef95b2e88652a5e3f0ed/comments", "author": {"login": "samueltardieu", "id": 44656, "node_id": "MDQ6VXNlcjQ0NjU2", "avatar_url": "https://avatars.githubusercontent.com/u/44656?v=4", "gravatar_id": "", "url": "https://api.github.com/users/samueltardieu", "html_url": "https://github.com/samueltardieu", "followers_url": "https://api.github.com/users/samueltardieu/followers", "following_url": "https://api.github.com/users/samueltardieu/following{/other_user}", "gists_url": "https://api.github.com/users/samueltardieu/gists{/gist_id}", "starred_url": "https://api.github.com/users/samueltardieu/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/samueltardieu/subscriptions", "organizations_url": "https://api.github.com/users/samueltardieu/orgs", "repos_url": "https://api.github.com/users/samueltardieu/repos", "events_url": "https://api.github.com/users/samueltardieu/events{/privacy}", "received_events_url": "https://api.github.com/users/samueltardieu/received_events", "type": "User", "site_admin": false}, "committer": null, "parents": [{"sha": "e397a9f1b6dcd66e4d5606588c3e3cdf687cf194", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/e397a9f1b6dcd66e4d5606588c3e3cdf687cf194", "html_url": "https://github.com/Rust-GCC/gccrs/commit/e397a9f1b6dcd66e4d5606588c3e3cdf687cf194"}], "stats": {"total": 38, "additions": 38, "deletions": 0}, "files": [{"sha": "9ddc6da809fdbeb8de6cc292eae176bd7da69856", "filename": "gcc/ada/ChangeLog", "status": "modified", "additions": 6, "deletions": 0, "changes": 6, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/2eb160f205ce2a807ecdef95b2e88652a5e3f0ed/gcc%2Fada%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/2eb160f205ce2a807ecdef95b2e88652a5e3f0ed/gcc%2Fada%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fada%2FChangeLog?ref=2eb160f205ce2a807ecdef95b2e88652a5e3f0ed", "patch": "@@ -1,3 +1,9 @@\n+2007-12-07  Samuel Tardieu  <sam@rfc1149.net>\n+\n+\tPR ada/15805\n+\t* sem_ch6.adb (Process_Formals): Prevent an access type formal\n+\tto be initialized with an access to constant object.\n+\n 2007-12-07  Olivier Hainque  <hainque@adacore.com>\n \n \tPR ada/34173"}, {"sha": "b2451cb5eab8cd0df085a23ea695ac437d2c8f4d", "filename": "gcc/ada/sem_ch6.adb", "status": "modified", "additions": 14, "deletions": 0, "changes": 14, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/2eb160f205ce2a807ecdef95b2e88652a5e3f0ed/gcc%2Fada%2Fsem_ch6.adb", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/2eb160f205ce2a807ecdef95b2e88652a5e3f0ed/gcc%2Fada%2Fsem_ch6.adb", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fada%2Fsem_ch6.adb?ref=2eb160f205ce2a807ecdef95b2e88652a5e3f0ed", "patch": "@@ -6998,6 +6998,20 @@ package body Sem_Ch6 is\n \n             Analyze_Per_Use_Expression (Default, Formal_Type);\n \n+            --  Check that an access to constant is not used with an\n+            --  access type.\n+\n+            if Ekind (Formal_Type) = E_Anonymous_Access_Type\n+              and then not Is_Access_Constant (Formal_Type)\n+              and then Is_Access_Type (Etype (Default))\n+              and then Is_Access_Constant (Etype (Default))\n+            then\n+               Error_Msg_NE (\"parameter of type& cannot be initialized \" &\n+                             \"with an access-to-constant expression\",\n+                             Default,\n+                             Formal_Type);\n+            end if;\n+\n             --  Check that the designated type of an access parameter's default\n             --  is not a class-wide type unless the parameter's designated type\n             --  is also class-wide."}, {"sha": "2342e5e3aed3d8f88bfd77ec1a704e16fddefa01", "filename": "gcc/testsuite/ChangeLog", "status": "modified", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/2eb160f205ce2a807ecdef95b2e88652a5e3f0ed/gcc%2Ftestsuite%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/2eb160f205ce2a807ecdef95b2e88652a5e3f0ed/gcc%2Ftestsuite%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2FChangeLog?ref=2eb160f205ce2a807ecdef95b2e88652a5e3f0ed", "patch": "@@ -1,3 +1,8 @@\n+2007-12-07  Samuel Tardieu  <sam@rfc1149.net>\n+\n+\tPR ada/15805\n+\t* gnat.dg/specs/access_constants.ads: New test.\n+\n 2007-12-07  Olivier Hainque  <hainque@adacore.com>\n \n \tPR ada/34173"}, {"sha": "fa9829e8396b3cb0e5d78b22e131f59009a182f6", "filename": "gcc/testsuite/gnat.dg/specs/access_constant.ads", "status": "added", "additions": 13, "deletions": 0, "changes": 13, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/2eb160f205ce2a807ecdef95b2e88652a5e3f0ed/gcc%2Ftestsuite%2Fgnat.dg%2Fspecs%2Faccess_constant.ads", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/2eb160f205ce2a807ecdef95b2e88652a5e3f0ed/gcc%2Ftestsuite%2Fgnat.dg%2Fspecs%2Faccess_constant.ads", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgnat.dg%2Fspecs%2Faccess_constant.ads?ref=2eb160f205ce2a807ecdef95b2e88652a5e3f0ed", "patch": "@@ -0,0 +1,13 @@\n+-- { dg-do compile }\n+package Access_Constant is\n+\n+   c: aliased constant integer := 3;\n+\n+   type const_ptr is access constant integer;\n+   cp : const_ptr := c'access;\n+\n+   procedure inc (var_ptr: access integer :=\n+     cp)  -- { dg-error \"access-to-constant\" }\n+      is abstract;\n+\n+end Access_Constant;"}]}