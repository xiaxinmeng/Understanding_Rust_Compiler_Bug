{"sha": "6c74788ed7b48f057a9f08bde52944726ced24f5", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6NmM3NDc4OGVkN2I0OGYwNTdhOWYwOGJkZTUyOTQ0NzI2Y2VkMjRmNQ==", "commit": {"author": {"name": "Sebastian Pop", "email": "sebastian.pop@amd.com", "date": "2007-11-14T17:36:01Z"}, "committer": {"name": "Sebastian Pop", "email": "spop@gcc.gnu.org", "date": "2007-11-14T17:36:01Z"}, "message": "tree-ssa-loop-ivcanon.c (try_unroll_loop_completely): Remove unused edges after loop duplication.\n\n2007-11-14  Sebastian Pop  <sebastian.pop@amd.com>\n\n\t* tree-ssa-loop-ivcanon.c (try_unroll_loop_completely): Remove\n\tunused edges after loop duplication.\n\nFrom-SVN: r130182", "tree": {"sha": "60159349fdd36d850bf520c89302db135710dc64", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/60159349fdd36d850bf520c89302db135710dc64"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/6c74788ed7b48f057a9f08bde52944726ced24f5", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/6c74788ed7b48f057a9f08bde52944726ced24f5", "html_url": "https://github.com/Rust-GCC/gccrs/commit/6c74788ed7b48f057a9f08bde52944726ced24f5", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/6c74788ed7b48f057a9f08bde52944726ced24f5/comments", "author": null, "committer": {"login": "sebpop", "id": 568397, "node_id": "MDQ6VXNlcjU2ODM5Nw==", "avatar_url": "https://avatars.githubusercontent.com/u/568397?v=4", "gravatar_id": "", "url": "https://api.github.com/users/sebpop", "html_url": "https://github.com/sebpop", "followers_url": "https://api.github.com/users/sebpop/followers", "following_url": "https://api.github.com/users/sebpop/following{/other_user}", "gists_url": "https://api.github.com/users/sebpop/gists{/gist_id}", "starred_url": "https://api.github.com/users/sebpop/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/sebpop/subscriptions", "organizations_url": "https://api.github.com/users/sebpop/orgs", "repos_url": "https://api.github.com/users/sebpop/repos", "events_url": "https://api.github.com/users/sebpop/events{/privacy}", "received_events_url": "https://api.github.com/users/sebpop/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "1e992e163d7d21027523b764f02836646036e184", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/1e992e163d7d21027523b764f02836646036e184", "html_url": "https://github.com/Rust-GCC/gccrs/commit/1e992e163d7d21027523b764f02836646036e184"}], "stats": {"total": 45, "additions": 22, "deletions": 23}, "files": [{"sha": "cf9b33ed65a873f8d336030c2da91596afbafd7e", "filename": "gcc/ChangeLog", "status": "modified", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/6c74788ed7b48f057a9f08bde52944726ced24f5/gcc%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/6c74788ed7b48f057a9f08bde52944726ced24f5/gcc%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2FChangeLog?ref=6c74788ed7b48f057a9f08bde52944726ced24f5", "patch": "@@ -1,3 +1,8 @@\n+2007-11-14  Sebastian Pop  <sebastian.pop@amd.com>\n+\n+\t* tree-ssa-loop-ivcanon.c (try_unroll_loop_completely): Remove\n+\tunused edges after loop duplication.\n+\n 2007-11-14  Uros Bizjak  <ubizjak@gmail.com>\n \n \t* config/i386/i386.h (TARGET_CPU_DEFAULT_*): Substitute with ..."}, {"sha": "5e9e24827652f0b08477bb577b316bb72f48d212", "filename": "gcc/tree-ssa-loop-ivcanon.c", "status": "modified", "additions": 17, "deletions": 23, "changes": 40, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/6c74788ed7b48f057a9f08bde52944726ced24f5/gcc%2Ftree-ssa-loop-ivcanon.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/6c74788ed7b48f057a9f08bde52944726ced24f5/gcc%2Ftree-ssa-loop-ivcanon.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftree-ssa-loop-ivcanon.c?ref=6c74788ed7b48f057a9f08bde52944726ced24f5", "patch": "@@ -163,7 +163,7 @@ try_unroll_loop_completely (struct loop *loop,\n \t\t\t    enum unroll_level ul)\n {\n   unsigned HOST_WIDE_INT n_unroll, ninsns, max_unroll, unr_insns;\n-  tree old_cond, cond, dont_exit, do_exit;\n+  tree cond;\n \n   if (loop->inner)\n     return false;\n@@ -207,50 +207,44 @@ try_unroll_loop_completely (struct loop *loop,\n \t}\n     }\n \n-  if (exit->flags & EDGE_TRUE_VALUE)\n-    {\n-      dont_exit = boolean_false_node;\n-      do_exit = boolean_true_node;\n-    }\n-  else\n-    {\n-      dont_exit = boolean_true_node;\n-      do_exit = boolean_false_node;\n-    }\n-  cond = last_stmt (exit->src);\n-    \n   if (n_unroll)\n     {\n       sbitmap wont_exit;\n+      edge e;\n+      unsigned i;\n+      VEC (edge, heap) *to_remove = NULL;\n \n-      old_cond = COND_EXPR_COND (cond);\n-      COND_EXPR_COND (cond) = dont_exit;\n-      update_stmt (cond);\n       initialize_original_copy_tables ();\n-\n       wont_exit = sbitmap_alloc (n_unroll + 1);\n       sbitmap_ones (wont_exit);\n       RESET_BIT (wont_exit, 0);\n \n       if (!tree_duplicate_loop_to_header_edge (loop, loop_preheader_edge (loop),\n \t\t\t\t\t       n_unroll, wont_exit,\n-\t\t\t\t\t       exit, NULL,\n+\t\t\t\t\t       exit, &to_remove,\n \t\t\t\t\t       DLTHE_FLAG_UPDATE_FREQ\n \t\t\t\t\t       | DLTHE_FLAG_COMPLETTE_PEEL))\n \t{\n-\t  COND_EXPR_COND (cond) = old_cond;\n-\t  update_stmt (cond);\n           free_original_copy_tables ();\n \t  free (wont_exit);\n \t  return false;\n \t}\n+\n+      for (i = 0; VEC_iterate (edge, to_remove, i, e); i++)\n+\t{\n+\t  bool ok = remove_path (e);\n+\t  gcc_assert (ok);\n+\t}\n+\n+      VEC_free (edge, heap, to_remove);\n       free (wont_exit);\n       free_original_copy_tables ();\n     }\n-  \n-  COND_EXPR_COND (cond) = do_exit;\n-  update_stmt (cond);\n \n+  cond = last_stmt (exit->src);\n+  COND_EXPR_COND (cond) = (exit->flags & EDGE_TRUE_VALUE) ? boolean_true_node\n+    : boolean_false_node;\n+  update_stmt (cond);\n   update_ssa (TODO_update_ssa);\n \n   if (dump_file && (dump_flags & TDF_DETAILS))"}]}