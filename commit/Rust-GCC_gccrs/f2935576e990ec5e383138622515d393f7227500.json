{"sha": "f2935576e990ec5e383138622515d393f7227500", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6ZjI5MzU1NzZlOTkwZWM1ZTM4MzEzODYyMjUxNWQzOTNmNzIyNzUwMA==", "commit": {"author": {"name": "Paolo Carlini", "email": "paolo.carlini@oracle.com", "date": "2018-11-15T18:03:54Z"}, "committer": {"name": "Paolo Carlini", "email": "paolo@gcc.gnu.org", "date": "2018-11-15T18:03:54Z"}, "message": "constexpr.c (ensure_literal_type_for_constexpr_object): Use DECL_SOURCE_LOCATION in error_at calls.\n\n/cp\n2018-11-15  Paolo Carlini  <paolo.carlini@oracle.com>\n\n\t* constexpr.c (ensure_literal_type_for_constexpr_object): Use\n\tDECL_SOURCE_LOCATION in error_at calls.\n\n/testsuite\n2018-11-15  Paolo Carlini  <paolo.carlini@oracle.com>\n\n\t* g++.dg/cpp0x/constexpr-diag3.C: Check locations too.\n\t* g++.dg/cpp0x/constexpr-ice19.C: Likewise.\n\t* g++.dg/cpp0x/constexpr-nonlit2.C: Likewise.\n\t* g++.dg/cpp1z/constexpr-lambda15.C: Likewise.\n\t* g++.dg/ext/constexpr-vla5.C: Likewise.\n\t* g++.dg/gomp/pr85134.C: Likewise.\n\nFrom-SVN: r266192", "tree": {"sha": "6985e4eb0695abf80facd9d4a827adbe790cf449", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/6985e4eb0695abf80facd9d4a827adbe790cf449"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/f2935576e990ec5e383138622515d393f7227500", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/f2935576e990ec5e383138622515d393f7227500", "html_url": "https://github.com/Rust-GCC/gccrs/commit/f2935576e990ec5e383138622515d393f7227500", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/f2935576e990ec5e383138622515d393f7227500/comments", "author": null, "committer": null, "parents": [{"sha": "1ec7f4929a286da7aa03d413a0fe99c9c36be915", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/1ec7f4929a286da7aa03d413a0fe99c9c36be915", "html_url": "https://github.com/Rust-GCC/gccrs/commit/1ec7f4929a286da7aa03d413a0fe99c9c36be915"}], "stats": {"total": 43, "additions": 31, "deletions": 12}, "files": [{"sha": "6d87c293dd60ae000cd3a9efe8603e0f7afdb98d", "filename": "gcc/cp/ChangeLog", "status": "modified", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/f2935576e990ec5e383138622515d393f7227500/gcc%2Fcp%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/f2935576e990ec5e383138622515d393f7227500/gcc%2Fcp%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fcp%2FChangeLog?ref=f2935576e990ec5e383138622515d393f7227500", "patch": "@@ -1,3 +1,8 @@\n+2018-11-15  Paolo Carlini  <paolo.carlini@oracle.com>\n+\n+\t* constexpr.c (ensure_literal_type_for_constexpr_object): Use\n+\tDECL_SOURCE_LOCATION in error_at calls.\n+\n 2018-11-15  Nathan Sidwell  <nathan@acm.org>\n \n \tDR 2336"}, {"sha": "c9e1e0cbdcb387753dfa5d23747ecea04d7b7f5a", "filename": "gcc/cp/constexpr.c", "status": "modified", "additions": 9, "deletions": 6, "changes": 15, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/f2935576e990ec5e383138622515d393f7227500/gcc%2Fcp%2Fconstexpr.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/f2935576e990ec5e383138622515d393f7227500/gcc%2Fcp%2Fconstexpr.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fcp%2Fconstexpr.c?ref=f2935576e990ec5e383138622515d393f7227500", "patch": "@@ -98,8 +98,9 @@ ensure_literal_type_for_constexpr_object (tree decl)\n \t  if (DECL_DECLARED_CONSTEXPR_P (decl))\n \t    {\n \t      auto_diagnostic_group d;\n-\t      error (\"the type %qT of %<constexpr%> variable %qD \"\n-\t\t     \"is not literal\", type, decl);\n+\t      error_at (DECL_SOURCE_LOCATION (decl),\n+\t\t\t\"the type %qT of %<constexpr%> variable %qD \"\n+\t\t\t\"is not literal\", type, decl);\n \t      explain_non_literal_class (type);\n \t      decl = error_mark_node;\n \t    }\n@@ -108,8 +109,9 @@ ensure_literal_type_for_constexpr_object (tree decl)\n \t      if (!is_instantiation_of_constexpr (current_function_decl))\n \t\t{\n \t\t  auto_diagnostic_group d;\n-\t\t  error (\"variable %qD of non-literal type %qT in %<constexpr%> \"\n-\t\t\t \"function\", decl, type);\n+\t\t  error_at (DECL_SOURCE_LOCATION (decl),\n+\t\t\t    \"variable %qD of non-literal type %qT in \"\n+\t\t\t    \"%<constexpr%> function\", decl, type);\n \t\t  explain_non_literal_class (type);\n \t\t  decl = error_mark_node;\n \t\t}\n@@ -119,8 +121,9 @@ ensure_literal_type_for_constexpr_object (tree decl)\n       else if (DECL_DECLARED_CONSTEXPR_P (decl)\n \t       && variably_modified_type_p (type, NULL_TREE))\n \t{\n-\t  error (\"%<constexpr%> variable %qD has variably-modified type %qT\",\n-\t\t decl, type);\n+\t  error_at (DECL_SOURCE_LOCATION (decl),\n+\t\t    \"%<constexpr%> variable %qD has variably-modified \"\n+\t\t    \"type %qT\", decl, type);\n \t  decl = error_mark_node;\n \t}\n     }"}, {"sha": "24ea36ec91242947f61574bad9175d5a8f21cc2c", "filename": "gcc/testsuite/ChangeLog", "status": "modified", "additions": 9, "deletions": 0, "changes": 9, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/f2935576e990ec5e383138622515d393f7227500/gcc%2Ftestsuite%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/f2935576e990ec5e383138622515d393f7227500/gcc%2Ftestsuite%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2FChangeLog?ref=f2935576e990ec5e383138622515d393f7227500", "patch": "@@ -1,3 +1,12 @@\n+2018-11-15  Paolo Carlini  <paolo.carlini@oracle.com>\n+\n+\t* g++.dg/cpp0x/constexpr-diag3.C: Check locations too.\n+\t* g++.dg/cpp0x/constexpr-ice19.C: Likewise.\n+\t* g++.dg/cpp0x/constexpr-nonlit2.C: Likewise.\n+\t* g++.dg/cpp1z/constexpr-lambda15.C: Likewise.\n+\t* g++.dg/ext/constexpr-vla5.C: Likewise.\n+\t* g++.dg/gomp/pr85134.C: Likewise.\n+\n 2018-11-15  Nathan Sidwell  <nathan@acm.org>\n \n \tDR 2336"}, {"sha": "e54b26c7f6afd39138a25f9770655e38c21dad7f", "filename": "gcc/testsuite/g++.dg/cpp0x/constexpr-diag3.C", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/f2935576e990ec5e383138622515d393f7227500/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Fcpp0x%2Fconstexpr-diag3.C", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/f2935576e990ec5e383138622515d393f7227500/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Fcpp0x%2Fconstexpr-diag3.C", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Fcpp0x%2Fconstexpr-diag3.C?ref=f2935576e990ec5e383138622515d393f7227500", "patch": "@@ -24,7 +24,7 @@ private:\n   double im;\n };\n \n-constexpr complex co1(0, 1);\t   // { dg-error \"not literal\" }\n+constexpr complex co1(0, 1);\t   // { dg-error \"19:the type .const complex. of .constexpr. variable .co1. is not literal\" }\n constexpr double dd2 = co1.real(); // { dg-error \"|in .constexpr. expansion of \" }\n \n // --------------------"}, {"sha": "6475c39b806d774a137b440843e0420d48dfff26", "filename": "gcc/testsuite/g++.dg/cpp0x/constexpr-ice19.C", "status": "modified", "additions": 2, "deletions": 1, "changes": 3, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/f2935576e990ec5e383138622515d393f7227500/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Fcpp0x%2Fconstexpr-ice19.C", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/f2935576e990ec5e383138622515d393f7227500/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Fcpp0x%2Fconstexpr-ice19.C", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Fcpp0x%2Fconstexpr-ice19.C?ref=f2935576e990ec5e383138622515d393f7227500", "patch": "@@ -9,5 +9,6 @@ struct A\n \n struct B\n {\n-  static constexpr A a {};  // { dg-error \"not literal|in-class initialization\" }\n+  static constexpr A a {};  // { dg-error \"22:the type .const A. of .constexpr. variable .B::a. is not literal\" }\n+// { dg-error \"in-class initialization\" \"\" { target c++11 } .-1 }\n };"}, {"sha": "0717f06a9779239c2030b822ca62e2cd096e0ed3", "filename": "gcc/testsuite/g++.dg/cpp0x/constexpr-nonlit2.C", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/f2935576e990ec5e383138622515d393f7227500/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Fcpp0x%2Fconstexpr-nonlit2.C", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/f2935576e990ec5e383138622515d393f7227500/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Fcpp0x%2Fconstexpr-nonlit2.C", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Fcpp0x%2Fconstexpr-nonlit2.C?ref=f2935576e990ec5e383138622515d393f7227500", "patch": "@@ -16,4 +16,4 @@ template <class T>\n constexpr W<T> make_w(T& w) { return W<T>(w); }\n \n A a;\n-constexpr auto w = make_w(a);\t// { dg-error \"\" }\n+constexpr auto w = make_w(a);\t// { dg-error \"16:the type .const W<A>. of .constexpr. variable .w. is not literal\" }"}, {"sha": "0420ebb25313e0374079a22c8208a54c7fcec35c", "filename": "gcc/testsuite/g++.dg/cpp1z/constexpr-lambda15.C", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/f2935576e990ec5e383138622515d393f7227500/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Fcpp1z%2Fconstexpr-lambda15.C", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/f2935576e990ec5e383138622515d393f7227500/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Fcpp1z%2Fconstexpr-lambda15.C", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Fcpp1z%2Fconstexpr-lambda15.C?ref=f2935576e990ec5e383138622515d393f7227500", "patch": "@@ -3,7 +3,7 @@\n \n struct S {\n   constexpr S(int i) {\n-    auto f = [i]{};\t\t// { dg-error \"literal\" \"\" { target c++14_only } }\n+    auto f = [i]{};\t\t// { dg-error \"10:variable .f. of non-literal type\" \"\" { target c++14_only } }\n   }\n };\n int main() {}"}, {"sha": "5f19d3c4fd72f33ce3bf77630904d768cb9eee4b", "filename": "gcc/testsuite/g++.dg/ext/constexpr-vla5.C", "status": "modified", "additions": 2, "deletions": 1, "changes": 3, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/f2935576e990ec5e383138622515d393f7227500/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Fext%2Fconstexpr-vla5.C", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/f2935576e990ec5e383138622515d393f7227500/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Fext%2Fconstexpr-vla5.C", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Fext%2Fconstexpr-vla5.C?ref=f2935576e990ec5e383138622515d393f7227500", "patch": "@@ -3,5 +3,6 @@\n \n void foo(int i)\n {\n-  constexpr char x[i] = \"\";\t// { dg-error \"\" }\n+  constexpr char x[i] = \"\";\t// { dg-error \"18:.constexpr. variable .x. has variably-modified type\" }\n+// { dg-error \"ISO C\\\\+\\\\+ forbids variable length array .x\" \"\" { target c++11 } .-1 }  \n }"}, {"sha": "01f5574fcc7a87b99c9f28ca935fb05bd4f775c8", "filename": "gcc/testsuite/g++.dg/gomp/pr85134.C", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/f2935576e990ec5e383138622515d393f7227500/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Fgomp%2Fpr85134.C", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/f2935576e990ec5e383138622515d393f7227500/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Fgomp%2Fpr85134.C", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Fgomp%2Fpr85134.C?ref=f2935576e990ec5e383138622515d393f7227500", "patch": "@@ -5,7 +5,7 @@\n void\n foo (int i)\n {\n-  constexpr int x[i] = {};\t// { dg-error \"'constexpr' variable 'x' has variably-modified type\" }\n+  constexpr int x[i] = {};\t// { dg-error \"17:'constexpr' variable 'x' has variably-modified type\" }\n #pragma omp parallel shared(x)\n   ;\n }"}]}