{"sha": "18fbe394d62371bedaa41ed32c89c659109ae8f5", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6MThmYmUzOTRkNjIzNzFiZWRhYTQxZWQzMmM4OWM2NTkxMDlhZThmNQ==", "commit": {"author": {"name": "Wilco Dijkstra", "email": "wdijkstr@arm.com", "date": "2018-02-08T12:29:28Z"}, "committer": {"name": "Wilco Dijkstra", "email": "wilco@gcc.gnu.org", "date": "2018-02-08T12:29:28Z"}, "message": "PR84068, PR83459: Fix sort order of SCHED_PRESSURE_MODEL\n\nThe comparison function for SCHED_PRESSURE_MODEL is incorrect.  If either\ninstruction is not in target_bb, the ordering is not well defined.  \nSince all instructions outside the target_bb get the highest model_index,\nall we need to do is sort on model_index.  If the model_index is the same\nwe defer to RFS_DEP_COUNT and/or RFS_TIE.\n\n    gcc/\n\tPR rtl-optimization/84068\n\tPR rtl-optimization/83459\n\t* haifa-sched.c (rank_for_schedule): Fix SCHED_PRESSURE_MODEL sorting.\n\n    gcc/testsuite\n\tPR rtl-optimization/84068\n\tPR rtl-optimization/83459\n\t* gcc.dg/pr84068.c: New test.\n\nFrom-SVN: r257481", "tree": {"sha": "abee5c0888e2e05b7ff80a7f92572e3d6df3ecbf", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/abee5c0888e2e05b7ff80a7f92572e3d6df3ecbf"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/18fbe394d62371bedaa41ed32c89c659109ae8f5", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/18fbe394d62371bedaa41ed32c89c659109ae8f5", "html_url": "https://github.com/Rust-GCC/gccrs/commit/18fbe394d62371bedaa41ed32c89c659109ae8f5", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/18fbe394d62371bedaa41ed32c89c659109ae8f5/comments", "author": null, "committer": null, "parents": [{"sha": "eacac712e337690ee21ce37fd06b2fe8b10a58f1", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/eacac712e337690ee21ce37fd06b2fe8b10a58f1", "html_url": "https://github.com/Rust-GCC/gccrs/commit/eacac712e337690ee21ce37fd06b2fe8b10a58f1"}], "stats": {"total": 37, "additions": 33, "deletions": 4}, "files": [{"sha": "c9a9fdb745e3a7d017fa810c50f8111265f6b263", "filename": "gcc/ChangeLog", "status": "modified", "additions": 6, "deletions": 0, "changes": 6, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/18fbe394d62371bedaa41ed32c89c659109ae8f5/gcc%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/18fbe394d62371bedaa41ed32c89c659109ae8f5/gcc%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2FChangeLog?ref=18fbe394d62371bedaa41ed32c89c659109ae8f5", "patch": "@@ -1,3 +1,9 @@\n+2018-02-08  Wilco Dijkstra  <wdijkstr@arm.com>\n+\n+\tPR rtl-optimization/84068\n+\tPR rtl-optimization/83459\n+\t* haifa-sched.c (rank_for_schedule): Fix SCHED_PRESSURE_MODEL sorting.\n+\n 2018-02-08  Aldy Hernandez  <aldyh@redhat.com>\n \n \tPR tree-optimization/84224"}, {"sha": "4a899b56173dd7d67db084ed86d24ad865ccadcd", "filename": "gcc/haifa-sched.c", "status": "modified", "additions": 3, "deletions": 4, "changes": 7, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/18fbe394d62371bedaa41ed32c89c659109ae8f5/gcc%2Fhaifa-sched.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/18fbe394d62371bedaa41ed32c89c659109ae8f5/gcc%2Fhaifa-sched.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fhaifa-sched.c?ref=18fbe394d62371bedaa41ed32c89c659109ae8f5", "patch": "@@ -2783,12 +2783,11 @@ rank_for_schedule (const void *x, const void *y)\n     }\n \n   /* Prefer instructions that occur earlier in the model schedule.  */\n-  if (sched_pressure == SCHED_PRESSURE_MODEL\n-      && INSN_BB (tmp) == target_bb && INSN_BB (tmp2) == target_bb)\n+  if (sched_pressure == SCHED_PRESSURE_MODEL)\n     {\n       diff = model_index (tmp) - model_index (tmp2);\n-      gcc_assert (diff != 0);\n-      return rfs_result (RFS_PRESSURE_INDEX, diff, tmp, tmp2);\n+      if (diff != 0)\n+\treturn rfs_result (RFS_PRESSURE_INDEX, diff, tmp, tmp2);\n     }\n \n   /* Prefer the insn which has more later insns that depend on it."}, {"sha": "c2eb50f453cdeaf76cc60a715de862a42306f543", "filename": "gcc/testsuite/ChangeLog", "status": "modified", "additions": 6, "deletions": 0, "changes": 6, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/18fbe394d62371bedaa41ed32c89c659109ae8f5/gcc%2Ftestsuite%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/18fbe394d62371bedaa41ed32c89c659109ae8f5/gcc%2Ftestsuite%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2FChangeLog?ref=18fbe394d62371bedaa41ed32c89c659109ae8f5", "patch": "@@ -1,3 +1,9 @@\n+2018-02-08  Wilco Dijkstra  <wdijkstr@arm.com>\n+\n+\tPR rtl-optimization/84068\n+\tPR rtl-optimization/83459\n+\t* gcc.dg/pr84068.c: New test.\n+\n 2018-02-08  Richard Biener  <rguenther@suse.de>\n \n \t* g++.dg/vect/slp-pr56812.cc: Allow either basic-block or"}, {"sha": "13110d84455f20edfc50f09efe4074721bd6a7d0", "filename": "gcc/testsuite/gcc.dg/pr84068.c", "status": "added", "additions": 18, "deletions": 0, "changes": 18, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/18fbe394d62371bedaa41ed32c89c659109ae8f5/gcc%2Ftestsuite%2Fgcc.dg%2Fpr84068.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/18fbe394d62371bedaa41ed32c89c659109ae8f5/gcc%2Ftestsuite%2Fgcc.dg%2Fpr84068.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgcc.dg%2Fpr84068.c?ref=18fbe394d62371bedaa41ed32c89c659109ae8f5", "patch": "@@ -0,0 +1,18 @@\n+/* { dg-do compile } */\n+/* { dg-options \"-O2 -fno-sched-critical-path-heuristic -fno-sched-rank-heuristic --param=max-sched-extend-regions-iters=5 --param sched-pressure-algorithm=2\" } */\n+\n+#ifdef __SIZEOF_INT128__\n+typedef __int128 largeint;\n+#else\n+typedef long long largeint;\n+#endif\n+\n+largeint a;\n+int b;\n+\n+largeint\n+foo (char d, short e, int f)\n+{\n+  b = __builtin_sub_overflow_p (b, 1, (unsigned long)0);\n+  return a + f;\n+}"}]}