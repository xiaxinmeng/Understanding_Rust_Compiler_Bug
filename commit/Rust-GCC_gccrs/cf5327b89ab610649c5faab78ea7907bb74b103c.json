{"sha": "cf5327b89ab610649c5faab78ea7907bb74b103c", "node_id": "C_kwDOANBUbNoAKGNmNTMyN2I4OWFiNjEwNjQ5YzVmYWFiNzhlYTc5MDdiYjc0YjEwM2M", "commit": {"author": {"name": "Harald Anlauf", "email": "anlauf@gmx.de", "date": "2022-12-11T22:24:03Z"}, "committer": {"name": "Harald Anlauf", "email": "anlauf@gmx.de", "date": "2022-12-12T19:39:28Z"}, "message": "Fortran: improve checking of assumed-size array spec [PR102180]\n\ngcc/fortran/ChangeLog:\n\n\tPR fortran/102180\n\t* array.cc (match_array_element_spec): Add check for bad\n\tassumed-implied-spec.\n\t(gfc_match_array_spec): Reorder logic so that the first bad array\n\telement spec may trigger an error.\n\ngcc/testsuite/ChangeLog:\n\n\tPR fortran/102180\n\t* gfortran.dg/pr102180.f90: New test.", "tree": {"sha": "a31444cf310113b88eaa7741ae7db7586596dac3", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/a31444cf310113b88eaa7741ae7db7586596dac3"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/cf5327b89ab610649c5faab78ea7907bb74b103c", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/cf5327b89ab610649c5faab78ea7907bb74b103c", "html_url": "https://github.com/Rust-GCC/gccrs/commit/cf5327b89ab610649c5faab78ea7907bb74b103c", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/cf5327b89ab610649c5faab78ea7907bb74b103c/comments", "author": {"login": "harald-anlauf", "id": 90786862, "node_id": "MDQ6VXNlcjkwNzg2ODYy", "avatar_url": "https://avatars.githubusercontent.com/u/90786862?v=4", "gravatar_id": "", "url": "https://api.github.com/users/harald-anlauf", "html_url": "https://github.com/harald-anlauf", "followers_url": "https://api.github.com/users/harald-anlauf/followers", "following_url": "https://api.github.com/users/harald-anlauf/following{/other_user}", "gists_url": "https://api.github.com/users/harald-anlauf/gists{/gist_id}", "starred_url": "https://api.github.com/users/harald-anlauf/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/harald-anlauf/subscriptions", "organizations_url": "https://api.github.com/users/harald-anlauf/orgs", "repos_url": "https://api.github.com/users/harald-anlauf/repos", "events_url": "https://api.github.com/users/harald-anlauf/events{/privacy}", "received_events_url": "https://api.github.com/users/harald-anlauf/received_events", "type": "User", "site_admin": false}, "committer": {"login": "harald-anlauf", "id": 90786862, "node_id": "MDQ6VXNlcjkwNzg2ODYy", "avatar_url": "https://avatars.githubusercontent.com/u/90786862?v=4", "gravatar_id": "", "url": "https://api.github.com/users/harald-anlauf", "html_url": "https://github.com/harald-anlauf", "followers_url": "https://api.github.com/users/harald-anlauf/followers", "following_url": "https://api.github.com/users/harald-anlauf/following{/other_user}", "gists_url": "https://api.github.com/users/harald-anlauf/gists{/gist_id}", "starred_url": "https://api.github.com/users/harald-anlauf/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/harald-anlauf/subscriptions", "organizations_url": "https://api.github.com/users/harald-anlauf/orgs", "repos_url": "https://api.github.com/users/harald-anlauf/repos", "events_url": "https://api.github.com/users/harald-anlauf/events{/privacy}", "received_events_url": "https://api.github.com/users/harald-anlauf/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "9fe7d3debbf60ed9fef8053123ad542a99d62100", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/9fe7d3debbf60ed9fef8053123ad542a99d62100", "html_url": "https://github.com/Rust-GCC/gccrs/commit/9fe7d3debbf60ed9fef8053123ad542a99d62100"}], "stats": {"total": 38, "additions": 35, "deletions": 3}, "files": [{"sha": "10d9e0c5354fa06ac8a7660d2ab02ba6ce11417a", "filename": "gcc/fortran/array.cc", "status": "modified", "additions": 16, "deletions": 3, "changes": 19, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/cf5327b89ab610649c5faab78ea7907bb74b103c/gcc%2Ffortran%2Farray.cc", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/cf5327b89ab610649c5faab78ea7907bb74b103c/gcc%2Ffortran%2Farray.cc", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ffortran%2Farray.cc?ref=cf5327b89ab610649c5faab78ea7907bb74b103c", "patch": "@@ -489,7 +489,20 @@ match_array_element_spec (gfc_array_spec *as)\n     }\n \n   if (gfc_match_char (':') == MATCH_YES)\n-    return AS_DEFERRED;\n+    {\n+      locus old_loc = gfc_current_locus;\n+      if (gfc_match_char ('*') == MATCH_YES)\n+\t{\n+\t  /* F2018:R821: \"assumed-implied-spec  is  [ lower-bound : ] *\".  */\n+\t  gfc_error (\"A lower bound must precede colon in \"\n+\t\t     \"assumed-size array specification at %L\", &old_loc);\n+\t  return AS_UNKNOWN;\n+\t}\n+      else\n+\t{\n+\t  return AS_DEFERRED;\n+\t}\n+    }\n \n   m = gfc_match_expr (upper);\n   if (m == MATCH_NO)\n@@ -591,6 +604,8 @@ gfc_match_array_spec (gfc_array_spec **asp, bool match_dim, bool match_codim)\n     {\n       as->rank++;\n       current_type = match_array_element_spec (as);\n+      if (current_type == AS_UNKNOWN)\n+\tgoto cleanup;\n \n       /* Note that current_type == AS_ASSUMED_SIZE for both assumed-size\n \t and implied-shape specifications.  If the rank is at least 2, we can\n@@ -600,8 +615,6 @@ gfc_match_array_spec (gfc_array_spec **asp, bool match_dim, bool match_codim)\n \n       if (as->rank == 1)\n \t{\n-\t  if (current_type == AS_UNKNOWN)\n-\t    goto cleanup;\n \t  as->type = current_type;\n \t}\n       else"}, {"sha": "cbf3e7299e77ffed60a584b99871d3105e1feb07", "filename": "gcc/testsuite/gfortran.dg/pr102180.f90", "status": "added", "additions": 19, "deletions": 0, "changes": 19, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/cf5327b89ab610649c5faab78ea7907bb74b103c/gcc%2Ftestsuite%2Fgfortran.dg%2Fpr102180.f90", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/cf5327b89ab610649c5faab78ea7907bb74b103c/gcc%2Ftestsuite%2Fgfortran.dg%2Fpr102180.f90", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgfortran.dg%2Fpr102180.f90?ref=cf5327b89ab610649c5faab78ea7907bb74b103c", "patch": "@@ -0,0 +1,19 @@\n+! { dg-do compile }\n+! { dg-options \"-fcoarray=lib\" }\n+! PR fortran/102180 - Improve checking of assumed size array spec\n+\n+subroutine s(x,y)\n+  real :: x(0:*) ! legal\n+  real :: y[0:*] ! legal\n+end\n+\n+subroutine t(x,y)\n+  real :: x(:*) ! { dg-error \"A lower bound must precede colon\" }\n+  real :: y[:*] ! { dg-error \"A lower bound must precede colon\" }\n+end\n+\n+subroutine u(x,y,z)\n+  real :: x(2,*)\n+  real :: y(2,2:*)\n+  real :: z(2,:*) ! { dg-error \"A lower bound must precede colon\" }\n+end"}]}