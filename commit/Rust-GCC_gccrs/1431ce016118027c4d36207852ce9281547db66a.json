{"sha": "1431ce016118027c4d36207852ce9281547db66a", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6MTQzMWNlMDE2MTE4MDI3YzRkMzYyMDc4NTJjZTkyODE1NDdkYjY2YQ==", "commit": {"author": {"name": "Richard Guenther", "email": "rguenther@suse.de", "date": "2012-05-24T09:54:25Z"}, "committer": {"name": "Richard Biener", "email": "rguenth@gcc.gnu.org", "date": "2012-05-24T09:54:25Z"}, "message": "re PR bootstrap/53466 (Bootstrap failure)\n\n2012-05-24  Richard Guenther  <rguenther@suse.de>\n\n\tPR bootstrap/53466\n\t* tree-ssa-live.c (remove_unused_scope_block_p): Properly\n\thandle globals.\n\t(remove_unused_locals): Pass global_unused_vars to\n\tremove_unused_scope_block_p.  Restore code walking all\n\treferenced vars and pruning them.\n\nFrom-SVN: r187824", "tree": {"sha": "532a367627cc9c4b11aca9317937b9fcbd81f735", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/532a367627cc9c4b11aca9317937b9fcbd81f735"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/1431ce016118027c4d36207852ce9281547db66a", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/1431ce016118027c4d36207852ce9281547db66a", "html_url": "https://github.com/Rust-GCC/gccrs/commit/1431ce016118027c4d36207852ce9281547db66a", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/1431ce016118027c4d36207852ce9281547db66a/comments", "author": {"login": "rguenth", "id": 2046526, "node_id": "MDQ6VXNlcjIwNDY1MjY=", "avatar_url": "https://avatars.githubusercontent.com/u/2046526?v=4", "gravatar_id": "", "url": "https://api.github.com/users/rguenth", "html_url": "https://github.com/rguenth", "followers_url": "https://api.github.com/users/rguenth/followers", "following_url": "https://api.github.com/users/rguenth/following{/other_user}", "gists_url": "https://api.github.com/users/rguenth/gists{/gist_id}", "starred_url": "https://api.github.com/users/rguenth/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/rguenth/subscriptions", "organizations_url": "https://api.github.com/users/rguenth/orgs", "repos_url": "https://api.github.com/users/rguenth/repos", "events_url": "https://api.github.com/users/rguenth/events{/privacy}", "received_events_url": "https://api.github.com/users/rguenth/received_events", "type": "User", "site_admin": false}, "committer": null, "parents": [{"sha": "07250f0e288ccfc04002c013a2cbc74c05d13592", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/07250f0e288ccfc04002c013a2cbc74c05d13592", "html_url": "https://github.com/Rust-GCC/gccrs/commit/07250f0e288ccfc04002c013a2cbc74c05d13592"}], "stats": {"total": 30, "additions": 26, "deletions": 4}, "files": [{"sha": "b817c58e5bbf6438b93a14785757bf4e8ead7a61", "filename": "gcc/ChangeLog", "status": "modified", "additions": 9, "deletions": 0, "changes": 9, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/1431ce016118027c4d36207852ce9281547db66a/gcc%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/1431ce016118027c4d36207852ce9281547db66a/gcc%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2FChangeLog?ref=1431ce016118027c4d36207852ce9281547db66a", "patch": "@@ -1,3 +1,12 @@\n+2012-05-24  Richard Guenther  <rguenther@suse.de>\n+\n+\tPR bootstrap/53466\n+\t* tree-ssa-live.c (remove_unused_scope_block_p): Properly\n+\thandle globals.\n+\t(remove_unused_locals): Pass global_unused_vars to\n+\tremove_unused_scope_block_p.  Restore code walking all\n+\treferenced vars and pruning them.\n+\n 2012-05-23  Jan Hubicka  <jh@suse.cz>\n \n \t* tree.h (alias_diag_flags): Remove."}, {"sha": "dfbf110a015d8438f341b091716f71fa8f05a537", "filename": "gcc/tree-ssa-live.c", "status": "modified", "additions": 17, "deletions": 4, "changes": 21, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/1431ce016118027c4d36207852ce9281547db66a/gcc%2Ftree-ssa-live.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/1431ce016118027c4d36207852ce9281547db66a/gcc%2Ftree-ssa-live.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftree-ssa-live.c?ref=1431ce016118027c4d36207852ce9281547db66a", "patch": "@@ -429,7 +429,7 @@ mark_scope_block_unused (tree scope)\n    done by the inliner.  */\n \n static bool\n-remove_unused_scope_block_p (tree scope)\n+remove_unused_scope_block_p (tree scope, bitmap global_unused_vars)\n {\n   tree *t, *next;\n   bool unused = !TREE_USED (scope);\n@@ -472,7 +472,9 @@ remove_unused_scope_block_p (tree scope)\n \t info about optimized-out variables in the scope blocks.\n \t Exception are the scope blocks not containing any instructions\n \t at all so user can't get into the scopes at first place.  */\n-      else if (var_ann (*t) != NULL && is_used_p (*t))\n+      else if ((is_global_var (*t)\n+\t\t&& !bitmap_bit_p (global_unused_vars, DECL_UID (*t)))\n+\t       || (var_ann (*t) != NULL && is_used_p (*t)))\n \tunused = false;\n       else if (TREE_CODE (*t) == LABEL_DECL && TREE_USED (*t))\n \t/* For labels that are still used in the IL, the decision to\n@@ -517,7 +519,7 @@ remove_unused_scope_block_p (tree scope)\n     }\n \n   for (t = &BLOCK_SUBBLOCKS (scope); *t ;)\n-    if (remove_unused_scope_block_p (*t))\n+    if (remove_unused_scope_block_p (*t, global_unused_vars))\n       {\n \tif (BLOCK_SUBBLOCKS (*t))\n \t  {\n@@ -847,9 +849,20 @@ remove_unused_locals (void)\n     }\n   if (dstidx != num)\n     VEC_truncate (tree, cfun->local_decls, dstidx);\n+\n+  /* ???  We end up with decls in referenced-vars that are not in\n+     local-decls.  */\n+  FOR_EACH_REFERENCED_VAR (cfun, t, rvi)\n+    if (TREE_CODE (t) == VAR_DECL\n+\t&& !VAR_DECL_IS_VIRTUAL_OPERAND (t)\n+\t&& !is_used_p (t))\n+      remove_referenced_var (t);\n+\n+  remove_unused_scope_block_p (DECL_INITIAL (current_function_decl),\n+\t\t\t       global_unused_vars);\n+\n   BITMAP_FREE (global_unused_vars);\n \n-  remove_unused_scope_block_p (DECL_INITIAL (current_function_decl));\n   if (dump_file && (dump_flags & TDF_DETAILS))\n     {\n       fprintf (dump_file, \"Scope blocks after cleanups:\\n\");"}]}