{"sha": "a0a10853345a395b64e44df41dbb743661301ef0", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6YTBhMTA4NTMzNDVhMzk1YjY0ZTQ0ZGY0MWRiYjc0MzY2MTMwMWVmMA==", "commit": {"author": {"name": "Arnaud Charlet", "email": "charlet@gcc.gnu.org", "date": "2015-05-12T08:21:47Z"}, "committer": {"name": "Arnaud Charlet", "email": "charlet@gcc.gnu.org", "date": "2015-05-12T08:21:47Z"}, "message": "[multiple changes]\n\n2015-05-12  Tristan Gingold  <gingold@adacore.com>\n\n\t* i-cpoint.adb (Copy_Terminated_Array): Copy nothing if Length is 0.\n\n2015-05-12  Ed Schonberg  <schonberg@adacore.com>\n\n\t* sem_ch3.adb (Complete_Private_Subtype): Propagate\n\tHas_Delayed_Aspects flag from private to full view, to ensure\n\tthat predicate functions are constructed.\n\n2015-05-12  Ed Schonberg  <schonberg@adacore.com>\n\n\t* sem_ch6.adb (Process_Formals): If a tagged formal is an\n\tincomplete class-wide type, the subprogram must have a delayed\n\tfreeze even though the opertation is not a primitive of the\n\ttype. THis ensures that the backend can recover the full view\n\twhen elaborating the subprogram declaration.\n\n2015-05-12  Ed Schonberg  <schonberg@adacore.com>\n\n\t* exp_util.adb (Get_Current_Value_Condition): Nothing to be\n\tdone if an elsif part has been rewritten so that it is not part\n\tof an enclosing if_statement.\n\nFrom-SVN: r223040", "tree": {"sha": "7758316dfe8e369a2ce9f9e4c5ded52a049019d8", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/7758316dfe8e369a2ce9f9e4c5ded52a049019d8"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/a0a10853345a395b64e44df41dbb743661301ef0", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/a0a10853345a395b64e44df41dbb743661301ef0", "html_url": "https://github.com/Rust-GCC/gccrs/commit/a0a10853345a395b64e44df41dbb743661301ef0", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/a0a10853345a395b64e44df41dbb743661301ef0/comments", "author": null, "committer": null, "parents": [{"sha": "e23e04db7b649db2d3f575f883385d0aa83aa64f", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/e23e04db7b649db2d3f575f883385d0aa83aa64f", "html_url": "https://github.com/Rust-GCC/gccrs/commit/e23e04db7b649db2d3f575f883385d0aa83aa64f"}], "stats": {"total": 65, "additions": 54, "deletions": 11}, "files": [{"sha": "29ee945b67ac90de10a6e57c0151d297b1c317cc", "filename": "gcc/ada/ChangeLog", "status": "modified", "additions": 24, "deletions": 0, "changes": 24, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/a0a10853345a395b64e44df41dbb743661301ef0/gcc%2Fada%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/a0a10853345a395b64e44df41dbb743661301ef0/gcc%2Fada%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fada%2FChangeLog?ref=a0a10853345a395b64e44df41dbb743661301ef0", "patch": "@@ -1,3 +1,27 @@\n+2015-05-12  Tristan Gingold  <gingold@adacore.com>\n+\n+\t* i-cpoint.adb (Copy_Terminated_Array): Copy nothing if Length is 0.\n+\n+2015-05-12  Ed Schonberg  <schonberg@adacore.com>\n+\n+\t* sem_ch3.adb (Complete_Private_Subtype): Propagate\n+\tHas_Delayed_Aspects flag from private to full view, to ensure\n+\tthat predicate functions are constructed.\n+\n+2015-05-12  Ed Schonberg  <schonberg@adacore.com>\n+\n+\t* sem_ch6.adb (Process_Formals): If a tagged formal is an\n+\tincomplete class-wide type, the subprogram must have a delayed\n+\tfreeze even though the opertation is not a primitive of the\n+\ttype. THis ensures that the backend can recover the full view\n+\twhen elaborating the subprogram declaration.\n+\n+2015-05-12  Ed Schonberg  <schonberg@adacore.com>\n+\n+\t* exp_util.adb (Get_Current_Value_Condition): Nothing to be\n+\tdone if an elsif part has been rewritten so that it is not part\n+\tof an enclosing if_statement.\n+\n 2015-05-12  Robert Dewar  <dewar@adacore.com>\n \n \t* sem_type.adb, sem_ch10.adb, freeze.adb, sem_ch6.adb, exp_disp.adb:"}, {"sha": "c487b729b69244e03e6566ab96f89d6e2a8448be", "filename": "gcc/ada/exp_util.adb", "status": "modified", "additions": 7, "deletions": 0, "changes": 7, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/a0a10853345a395b64e44df41dbb743661301ef0/gcc%2Fada%2Fexp_util.adb", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/a0a10853345a395b64e44df41dbb743661301ef0/gcc%2Fada%2Fexp_util.adb", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fada%2Fexp_util.adb?ref=a0a10853345a395b64e44df41dbb743661301ef0", "patch": "@@ -3366,6 +3366,13 @@ package body Exp_Util is\n \n             Stm := Parent (CV);\n \n+            --  If the tree has been otherwise rewritten there is nothing\n+            --  else to be done either.\n+\n+            if Nkind (Stm) /= N_If_Statement then\n+               return;\n+            end if;\n+\n             --  Before start of ELSIF part\n \n             if Loc < Sloc (CV) then"}, {"sha": "ddf33dae6fe02195b297d07333fc967c88beb428", "filename": "gcc/ada/i-cpoint.adb", "status": "modified", "additions": 5, "deletions": 4, "changes": 9, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/a0a10853345a395b64e44df41dbb743661301ef0/gcc%2Fada%2Fi-cpoint.adb", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/a0a10853345a395b64e44df41dbb743661301ef0/gcc%2Fada%2Fi-cpoint.adb", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fada%2Fi-cpoint.adb?ref=a0a10853345a395b64e44df41dbb743661301ef0", "patch": "@@ -6,7 +6,7 @@\n --                                                                          --\n --                                 B o d y                                  --\n --                                                                          --\n---          Copyright (C) 1992-2014, Free Software Foundation, Inc.         --\n+--          Copyright (C) 1992-2015, Free Software Foundation, Inc.         --\n --                                                                          --\n -- GNAT is free software;  you can  redistribute it  and/or modify it under --\n -- terms of the  GNU General Public License as published  by the Free Soft- --\n@@ -151,11 +151,12 @@ package body Interfaces.C.Pointers is\n          raise Dereference_Error;\n       end if;\n \n-      --  Compute array length (including the terminator)\n+      --  Compute array limited length (including the terminator)\n \n-      L := 1;\n-      while S.all /= Terminator and then L < Limit loop\n+      L := 0;\n+      while L < Limit loop\n          L := L + 1;\n+         exit when S.all = Terminator;\n          Increment (S);\n       end loop;\n "}, {"sha": "b8a74d122736c47f53228e008886ec182fed861e", "filename": "gcc/ada/sem_ch3.adb", "status": "modified", "additions": 11, "deletions": 2, "changes": 13, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/a0a10853345a395b64e44df41dbb743661301ef0/gcc%2Fada%2Fsem_ch3.adb", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/a0a10853345a395b64e44df41dbb743661301ef0/gcc%2Fada%2Fsem_ch3.adb", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fada%2Fsem_ch3.adb?ref=a0a10853345a395b64e44df41dbb743661301ef0", "patch": "@@ -11625,7 +11625,8 @@ package body Sem_Ch3 is\n       --  Freeze the private subtype entity if its parent is delayed, and not\n       --  already frozen. We skip this processing if the type is an anonymous\n       --  subtype of a record component, or is the corresponding record of a\n-      --  protected type, since ???\n+      --  protected type, since these are processed when the enclosing type\n+      --  is frozen.\n \n       if not Is_Type (Scope (Full)) then\n          Set_Has_Delayed_Freeze (Full,\n@@ -11804,11 +11805,19 @@ package body Sem_Ch3 is\n \n       --  Make sure Has_Predicates is set on full type if it is set on the\n       --  private type. Note that it may already be set on the full type and\n-      --  if so, we don't want to unset it.\n+      --  if so, we don't want to unset it. Similarly, propagate information\n+      --  about delayed aspects, because the corresponding pragmas must be\n+      --  analyzed when one of the views is frozen. This last step is needed\n+      --  in particular when the full type is a scalar type for which an\n+      --  anonymous base type is constructed.\n \n       if Has_Predicates (Priv) then\n          Set_Has_Predicates (Full);\n       end if;\n+\n+      if Has_Delayed_Aspects (Priv) then\n+         Set_Has_Delayed_Aspects (Full);\n+      end if;\n    end Complete_Private_Subtype;\n \n    ----------------------------"}, {"sha": "7d6c706976154c262b3ffba217acbc88aa362e93", "filename": "gcc/ada/sem_ch6.adb", "status": "modified", "additions": 7, "deletions": 5, "changes": 12, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/a0a10853345a395b64e44df41dbb743661301ef0/gcc%2Fada%2Fsem_ch6.adb", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/a0a10853345a395b64e44df41dbb743661301ef0/gcc%2Fada%2Fsem_ch6.adb", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fada%2Fsem_ch6.adb?ref=a0a10853345a395b64e44df41dbb743661301ef0", "patch": "@@ -10206,7 +10206,9 @@ package body Sem_Ch6 is\n                --  it is still the case that untagged incomplete types cannot\n                --  be Taft-amendment types and must be completed in private\n                --  part, so the subprogram must appear in the list of private\n-               --  dependents of the type.\n+               --  dependents of the type. If the type is class-wide, it is\n+               --  not a primitive, but the freezing of the subprogram must\n+               --  also be delayed to force the creation of a freeze node.\n \n                if Is_Tagged_Type (Formal_Type)\n                  or else (Ada_Version >= Ada_2012\n@@ -10215,15 +10217,15 @@ package body Sem_Ch6 is\n                then\n                   if Ekind (Scope (Current_Scope)) = E_Package\n                     and then not Is_Generic_Type (Formal_Type)\n-                    and then not Is_Class_Wide_Type (Formal_Type)\n                   then\n                      if not Nkind_In\n                        (Parent (T), N_Access_Function_Definition,\n                                     N_Access_Procedure_Definition)\n                      then\n-                        Append_Elmt\n-                          (Current_Scope,\n-                           To => Private_Dependents (Base_Type (Formal_Type)));\n+                        if not Is_Class_Wide_Type (Formal_Type) then\n+                           Append_Elmt (Current_Scope,\n+                               Private_Dependents (Base_Type (Formal_Type)));\n+                        end if;\n \n                         --  Freezing is delayed to ensure that Register_Prim\n                         --  will get called for this operation, which is needed"}]}