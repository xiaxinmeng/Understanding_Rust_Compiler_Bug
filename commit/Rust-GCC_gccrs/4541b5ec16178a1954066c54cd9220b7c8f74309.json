{"sha": "4541b5ec16178a1954066c54cd9220b7c8f74309", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6NDU0MWI1ZWMxNjE3OGExOTU0MDY2YzU0Y2Q5MjIwYjdjOGY3NDMwOQ==", "commit": {"author": {"name": "Trevor Saunders", "email": "tbsaunde@tbsaunde.org", "date": "2021-06-12T18:18:05Z"}, "committer": {"name": "Trevor Saunders", "email": "tbsaunde@tbsaunde.org", "date": "2021-06-17T08:43:28Z"}, "message": "make get_domminated_by_region return a auto_vec\n\nThis makes it clear the caller owns the vector, and ensures it is cleaned up.\n\nSigned-off-by: Trevor Saunders <tbsaunde@tbsaunde.org>\n\ngcc/ChangeLog:\n\n\t* dominance.c (get_dominated_by_region): Return auto_vec<basic_block>.\n\t* dominance.h (get_dominated_by_region): Likewise.\n\t* tree-cfg.c (gimple_duplicate_sese_region): Adjust.\n\t(gimple_duplicate_sese_tail): Likewise.\n\t(move_sese_region_to_fn): Likewise.", "tree": {"sha": "7a90e3b9dc1e7a50c178224f091f3d562a287071", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/7a90e3b9dc1e7a50c178224f091f3d562a287071"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/4541b5ec16178a1954066c54cd9220b7c8f74309", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/4541b5ec16178a1954066c54cd9220b7c8f74309", "html_url": "https://github.com/Rust-GCC/gccrs/commit/4541b5ec16178a1954066c54cd9220b7c8f74309", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/4541b5ec16178a1954066c54cd9220b7c8f74309/comments", "author": {"login": "tbsaunde", "id": 349840, "node_id": "MDQ6VXNlcjM0OTg0MA==", "avatar_url": "https://avatars.githubusercontent.com/u/349840?v=4", "gravatar_id": "", "url": "https://api.github.com/users/tbsaunde", "html_url": "https://github.com/tbsaunde", "followers_url": "https://api.github.com/users/tbsaunde/followers", "following_url": "https://api.github.com/users/tbsaunde/following{/other_user}", "gists_url": "https://api.github.com/users/tbsaunde/gists{/gist_id}", "starred_url": "https://api.github.com/users/tbsaunde/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/tbsaunde/subscriptions", "organizations_url": "https://api.github.com/users/tbsaunde/orgs", "repos_url": "https://api.github.com/users/tbsaunde/repos", "events_url": "https://api.github.com/users/tbsaunde/events{/privacy}", "received_events_url": "https://api.github.com/users/tbsaunde/received_events", "type": "User", "site_admin": false}, "committer": {"login": "tbsaunde", "id": 349840, "node_id": "MDQ6VXNlcjM0OTg0MA==", "avatar_url": "https://avatars.githubusercontent.com/u/349840?v=4", "gravatar_id": "", "url": "https://api.github.com/users/tbsaunde", "html_url": "https://github.com/tbsaunde", "followers_url": "https://api.github.com/users/tbsaunde/followers", "following_url": "https://api.github.com/users/tbsaunde/following{/other_user}", "gists_url": "https://api.github.com/users/tbsaunde/gists{/gist_id}", "starred_url": "https://api.github.com/users/tbsaunde/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/tbsaunde/subscriptions", "organizations_url": "https://api.github.com/users/tbsaunde/orgs", "repos_url": "https://api.github.com/users/tbsaunde/repos", "events_url": "https://api.github.com/users/tbsaunde/events{/privacy}", "received_events_url": "https://api.github.com/users/tbsaunde/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "4f899c4298cce9b332248e4f7a42ca81e51d20a5", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/4f899c4298cce9b332248e4f7a42ca81e51d20a5", "html_url": "https://github.com/Rust-GCC/gccrs/commit/4f899c4298cce9b332248e4f7a42ca81e51d20a5"}], "stats": {"total": 24, "additions": 10, "deletions": 14}, "files": [{"sha": "4943102ff1d0db75c9274853021e5ce191034fcf", "filename": "gcc/dominance.c", "status": "modified", "additions": 2, "deletions": 2, "changes": 4, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/4541b5ec16178a1954066c54cd9220b7c8f74309/gcc%2Fdominance.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/4541b5ec16178a1954066c54cd9220b7c8f74309/gcc%2Fdominance.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fdominance.c?ref=4541b5ec16178a1954066c54cd9220b7c8f74309", "patch": "@@ -906,13 +906,13 @@ get_dominated_by (enum cdi_direction dir, basic_block bb)\n    direction DIR) by some block between N_REGION ones stored in REGION,\n    except for blocks in the REGION itself.  */\n \n-vec<basic_block> \n+auto_vec<basic_block> \n get_dominated_by_region (enum cdi_direction dir, basic_block *region,\n \t\t\t unsigned n_region)\n {\n   unsigned i;\n   basic_block dom;\n-  vec<basic_block> doms = vNULL;\n+  auto_vec<basic_block> doms;\n \n   for (i = 0; i < n_region; i++)\n     region[i]->flags |= BB_DUPLICATED;"}, {"sha": "c74ad297c6ad6ab3dbc0fb4f77ad33c8746701ed", "filename": "gcc/dominance.h", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/4541b5ec16178a1954066c54cd9220b7c8f74309/gcc%2Fdominance.h", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/4541b5ec16178a1954066c54cd9220b7c8f74309/gcc%2Fdominance.h", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fdominance.h?ref=4541b5ec16178a1954066c54cd9220b7c8f74309", "patch": "@@ -47,7 +47,7 @@ extern basic_block get_immediate_dominator (enum cdi_direction, basic_block);\n extern void set_immediate_dominator (enum cdi_direction, basic_block,\n \t\t\t\t     basic_block);\n extern auto_vec<basic_block> get_dominated_by (enum cdi_direction, basic_block);\n-extern vec<basic_block> get_dominated_by_region (enum cdi_direction,\n+extern auto_vec<basic_block> get_dominated_by_region (enum cdi_direction,\n \t\t\t\t\t\t\t basic_block *,\n \t\t\t\t\t\t\t unsigned);\n extern vec<basic_block> get_dominated_to_depth (enum cdi_direction,"}, {"sha": "c9403deed19a425bb5d8b752bd9248d115ed9a7b", "filename": "gcc/tree-cfg.c", "status": "modified", "additions": 7, "deletions": 11, "changes": 18, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/4541b5ec16178a1954066c54cd9220b7c8f74309/gcc%2Ftree-cfg.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/4541b5ec16178a1954066c54cd9220b7c8f74309/gcc%2Ftree-cfg.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftree-cfg.c?ref=4541b5ec16178a1954066c54cd9220b7c8f74309", "patch": "@@ -6495,7 +6495,6 @@ gimple_duplicate_sese_region (edge entry, edge exit,\n   bool free_region_copy = false, copying_header = false;\n   class loop *loop = entry->dest->loop_father;\n   edge exit_copy;\n-  vec<basic_block> doms = vNULL;\n   edge redirected;\n   profile_count total_count = profile_count::uninitialized ();\n   profile_count entry_count = profile_count::uninitialized ();\n@@ -6549,9 +6548,9 @@ gimple_duplicate_sese_region (edge entry, edge exit,\n \n   /* Record blocks outside the region that are dominated by something\n      inside.  */\n+  auto_vec<basic_block> doms;\n   if (update_dominance)\n     {\n-      doms.create (0);\n       doms = get_dominated_by_region (CDI_DOMINATORS, region, n_region);\n     }\n \n@@ -6596,7 +6595,6 @@ gimple_duplicate_sese_region (edge entry, edge exit,\n       set_immediate_dominator (CDI_DOMINATORS, entry->dest, entry->src);\n       doms.safe_push (get_bb_original (entry->dest));\n       iterate_fix_dominators (CDI_DOMINATORS, doms, false);\n-      doms.release ();\n     }\n \n   /* Add the other PHI node arguments.  */\n@@ -6662,7 +6660,6 @@ gimple_duplicate_sese_tail (edge entry, edge exit,\n   class loop *loop = exit->dest->loop_father;\n   class loop *orig_loop = entry->dest->loop_father;\n   basic_block switch_bb, entry_bb, nentry_bb;\n-  vec<basic_block> doms;\n   profile_count total_count = profile_count::uninitialized (),\n \t\texit_count = profile_count::uninitialized ();\n   edge exits[2], nexits[2], e;\n@@ -6705,7 +6702,8 @@ gimple_duplicate_sese_tail (edge entry, edge exit,\n \n   /* Record blocks outside the region that are dominated by something\n      inside.  */\n-  doms = get_dominated_by_region (CDI_DOMINATORS, region, n_region);\n+  auto_vec<basic_block> doms = get_dominated_by_region (CDI_DOMINATORS, region,\n+\t\t\t\t\t\t\tn_region);\n \n   total_count = exit->src->count;\n   exit_count = exit->count ();\n@@ -6785,7 +6783,6 @@ gimple_duplicate_sese_tail (edge entry, edge exit,\n   /* Anything that is outside of the region, but was dominated by something\n      inside needs to update dominance info.  */\n   iterate_fix_dominators (CDI_DOMINATORS, doms, false);\n-  doms.release ();\n   /* Update the SSA web.  */\n   update_ssa (TODO_update_ssa);\n \n@@ -7567,7 +7564,7 @@ basic_block\n move_sese_region_to_fn (struct function *dest_cfun, basic_block entry_bb,\n \t\t        basic_block exit_bb, tree orig_block)\n {\n-  vec<basic_block> bbs, dom_bbs;\n+  vec<basic_block> bbs;\n   basic_block dom_entry = get_immediate_dominator (CDI_DOMINATORS, entry_bb);\n   basic_block after, bb, *entry_pred, *exit_succ, abb;\n   struct function *saved_cfun = cfun;\n@@ -7599,9 +7596,9 @@ move_sese_region_to_fn (struct function *dest_cfun, basic_block entry_bb,\n \n   /* The blocks that used to be dominated by something in BBS will now be\n      dominated by the new block.  */\n-  dom_bbs = get_dominated_by_region (CDI_DOMINATORS,\n-\t\t\t\t     bbs.address (),\n-\t\t\t\t     bbs.length ());\n+  auto_vec<basic_block> dom_bbs = get_dominated_by_region (CDI_DOMINATORS,\n+\t\t\t\t\t\t\t   bbs.address (),\n+\t\t\t\t\t\t\t   bbs.length ());\n \n   /* Detach ENTRY_BB and EXIT_BB from CFUN->CFG.  We need to remember\n      the predecessor edges to ENTRY_BB and the successor edges to\n@@ -7937,7 +7934,6 @@ move_sese_region_to_fn (struct function *dest_cfun, basic_block entry_bb,\n   set_immediate_dominator (CDI_DOMINATORS, bb, dom_entry);\n   FOR_EACH_VEC_ELT (dom_bbs, i, abb)\n     set_immediate_dominator (CDI_DOMINATORS, abb, bb);\n-  dom_bbs.release ();\n \n   if (exit_bb)\n     {"}]}