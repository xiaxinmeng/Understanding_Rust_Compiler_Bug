{"sha": "effb8a2646519179909386eccc4bc91dcb85248f", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6ZWZmYjhhMjY0NjUxOTE3OTkwOTM4NmVjY2M0YmM5MWRjYjg1MjQ4Zg==", "commit": {"author": {"name": "Richard Sandiford", "email": "rdsandiford@googlemail.com", "date": "2014-08-28T06:23:18Z"}, "committer": {"name": "Richard Sandiford", "email": "rsandifo@gcc.gnu.org", "date": "2014-08-28T06:23:18Z"}, "message": "final.c: Include rtl-iter.h.\n\ngcc/\n\t* final.c: Include rtl-iter.h.\n\t(mark_symbol_ref_as_used): Delete.\n\t(mark_symbol_refs_as_used): Use FOR_EACH_SUBRTX instead of\n\tfor_each_rtx.\n\nFrom-SVN: r214639", "tree": {"sha": "287bf86853c5d226e0d2219f038c4944eb2c814d", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/287bf86853c5d226e0d2219f038c4944eb2c814d"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/effb8a2646519179909386eccc4bc91dcb85248f", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/effb8a2646519179909386eccc4bc91dcb85248f", "html_url": "https://github.com/Rust-GCC/gccrs/commit/effb8a2646519179909386eccc4bc91dcb85248f", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/effb8a2646519179909386eccc4bc91dcb85248f/comments", "author": {"login": "rsandifo", "id": 4235983, "node_id": "MDQ6VXNlcjQyMzU5ODM=", "avatar_url": "https://avatars.githubusercontent.com/u/4235983?v=4", "gravatar_id": "", "url": "https://api.github.com/users/rsandifo", "html_url": "https://github.com/rsandifo", "followers_url": "https://api.github.com/users/rsandifo/followers", "following_url": "https://api.github.com/users/rsandifo/following{/other_user}", "gists_url": "https://api.github.com/users/rsandifo/gists{/gist_id}", "starred_url": "https://api.github.com/users/rsandifo/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/rsandifo/subscriptions", "organizations_url": "https://api.github.com/users/rsandifo/orgs", "repos_url": "https://api.github.com/users/rsandifo/repos", "events_url": "https://api.github.com/users/rsandifo/events{/privacy}", "received_events_url": "https://api.github.com/users/rsandifo/received_events", "type": "User", "site_admin": false}, "committer": null, "parents": [{"sha": "9021b8ec96cd58324a3cce6a7b756cd964f91aa1", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/9021b8ec96cd58324a3cce6a7b756cd964f91aa1", "html_url": "https://github.com/Rust-GCC/gccrs/commit/9021b8ec96cd58324a3cce6a7b756cd964f91aa1"}], "stats": {"total": 45, "additions": 17, "deletions": 28}, "files": [{"sha": "0384e6ebc703b535476377d4b26ca57cb99863dd", "filename": "gcc/ChangeLog", "status": "modified", "additions": 7, "deletions": 0, "changes": 7, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/effb8a2646519179909386eccc4bc91dcb85248f/gcc%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/effb8a2646519179909386eccc4bc91dcb85248f/gcc%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2FChangeLog?ref=effb8a2646519179909386eccc4bc91dcb85248f", "patch": "@@ -1,3 +1,10 @@\n+2014-08-28  Richard Sandiford  <rdsandiford@googlemail.com>\n+\n+\t* final.c: Include rtl-iter.h.\n+\t(mark_symbol_ref_as_used): Delete.\n+\t(mark_symbol_refs_as_used): Use FOR_EACH_SUBRTX instead of\n+\tfor_each_rtx.\n+\n 2014-08-28  Richard Sandiford  <rdsandiford@googlemail.com>\n \n \t* emit-rtl.c: Include rtl-iter.h."}, {"sha": "3103bacffd1333e9c90b8a2b384876fec42d76a9", "filename": "gcc/final.c", "status": "modified", "additions": 10, "deletions": 28, "changes": 38, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/effb8a2646519179909386eccc4bc91dcb85248f/gcc%2Ffinal.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/effb8a2646519179909386eccc4bc91dcb85248f/gcc%2Ffinal.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ffinal.c?ref=effb8a2646519179909386eccc4bc91dcb85248f", "patch": "@@ -81,6 +81,7 @@ along with GCC; see the file COPYING3.  If not see\n #include \"tree-pretty-print.h\" /* for dump_function_header */\n #include \"asan.h\"\n #include \"wide-int-print.h\"\n+#include \"rtl-iter.h\"\n \n #ifdef XCOFF_DEBUGGING_INFO\n #include \"xcoffout.h\"\t\t/* Needed for external data\n@@ -3778,38 +3779,19 @@ output_asm_label (rtx x)\n   assemble_name (asm_out_file, buf);\n }\n \n-/* Helper rtx-iteration-function for mark_symbol_refs_as_used and\n-   output_operand.  Marks SYMBOL_REFs as referenced through use of\n-   assemble_external.  */\n-\n-static int\n-mark_symbol_ref_as_used (rtx *xp, void *dummy ATTRIBUTE_UNUSED)\n-{\n-  rtx x = *xp;\n-\n-  /* If we have a used symbol, we may have to emit assembly\n-     annotations corresponding to whether the symbol is external, weak\n-     or has non-default visibility.  */\n-  if (GET_CODE (x) == SYMBOL_REF)\n-    {\n-      tree t;\n-\n-      t = SYMBOL_REF_DECL (x);\n-      if (t)\n-\tassemble_external (t);\n-\n-      return -1;\n-    }\n-\n-  return 0;\n-}\n-\n /* Marks SYMBOL_REFs in x as referenced through use of assemble_external.  */\n \n void\n mark_symbol_refs_as_used (rtx x)\n {\n-  for_each_rtx (&x, mark_symbol_ref_as_used, NULL);\n+  subrtx_iterator::array_type array;\n+  FOR_EACH_SUBRTX (iter, array, x, ALL)\n+    {\n+      const_rtx x = *iter;\n+      if (GET_CODE (x) == SYMBOL_REF)\n+\tif (tree t = SYMBOL_REF_DECL (x))\n+\t  assemble_external (t);\n+    }\n }\n \n /* Print operand X using machine-dependent assembler syntax.\n@@ -3835,7 +3817,7 @@ output_operand (rtx x, int code ATTRIBUTE_UNUSED)\n   if (x == NULL_RTX)\n     return;\n \n-  for_each_rtx (&x, mark_symbol_ref_as_used, NULL);\n+  mark_symbol_refs_as_used (x);\n }\n \n /* Print a memory reference operand for address X using"}]}