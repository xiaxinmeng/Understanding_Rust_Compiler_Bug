{"sha": "422ba273d4ee724caa04eb7e1e9c198b4aeb3e1a", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6NDIyYmEyNzNkNGVlNzI0Y2FhMDRlYjdlMWU5YzE5OGI0YWViM2UxYQ==", "commit": {"author": {"name": "Vincent Celier", "email": "celier@adacore.com", "date": "2007-12-13T10:27:32Z"}, "committer": {"name": "Arnaud Charlet", "email": "charlet@gcc.gnu.org", "date": "2007-12-13T10:27:32Z"}, "message": "gnatcmd.adb (GNATCmd): Do not issue -d= switch to gnatmetric when object directory of main project...\n\n2007-12-06  Vincent Celier  <celier@adacore.com>\n\n\t* gnatcmd.adb (GNATCmd): Do not issue -d= switch to gnatmetric when\n\tobject directory of main project does not exist.\n\tOn VMS, correctly set then environment variable for the source\n\tdirectories.\n\nFrom-SVN: r130841", "tree": {"sha": "eae6ad878ebfbd069d4431d465220d08a6a19261", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/eae6ad878ebfbd069d4431d465220d08a6a19261"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/422ba273d4ee724caa04eb7e1e9c198b4aeb3e1a", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/422ba273d4ee724caa04eb7e1e9c198b4aeb3e1a", "html_url": "https://github.com/Rust-GCC/gccrs/commit/422ba273d4ee724caa04eb7e1e9c198b4aeb3e1a", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/422ba273d4ee724caa04eb7e1e9c198b4aeb3e1a/comments", "author": {"login": "vcelier", "id": 8888056, "node_id": "MDQ6VXNlcjg4ODgwNTY=", "avatar_url": "https://avatars.githubusercontent.com/u/8888056?v=4", "gravatar_id": "", "url": "https://api.github.com/users/vcelier", "html_url": "https://github.com/vcelier", "followers_url": "https://api.github.com/users/vcelier/followers", "following_url": "https://api.github.com/users/vcelier/following{/other_user}", "gists_url": "https://api.github.com/users/vcelier/gists{/gist_id}", "starred_url": "https://api.github.com/users/vcelier/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/vcelier/subscriptions", "organizations_url": "https://api.github.com/users/vcelier/orgs", "repos_url": "https://api.github.com/users/vcelier/repos", "events_url": "https://api.github.com/users/vcelier/events{/privacy}", "received_events_url": "https://api.github.com/users/vcelier/received_events", "type": "User", "site_admin": false}, "committer": null, "parents": [{"sha": "7b76e80551f4445f2557d9f20bc29f06adb7b4e1", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/7b76e80551f4445f2557d9f20bc29f06adb7b4e1", "html_url": "https://github.com/Rust-GCC/gccrs/commit/7b76e80551f4445f2557d9f20bc29f06adb7b4e1"}], "stats": {"total": 31, "additions": 19, "deletions": 12}, "files": [{"sha": "c664338ae870e80d0a2b392460a3890fcfb5546c", "filename": "gcc/ada/gnatcmd.adb", "status": "modified", "additions": 19, "deletions": 12, "changes": 31, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/422ba273d4ee724caa04eb7e1e9c198b4aeb3e1a/gcc%2Fada%2Fgnatcmd.adb", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/422ba273d4ee724caa04eb7e1e9c198b4aeb3e1a/gcc%2Fada%2Fgnatcmd.adb", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fada%2Fgnatcmd.adb?ref=422ba273d4ee724caa04eb7e1e9c198b4aeb3e1a", "patch": "@@ -2228,10 +2228,14 @@ begin\n \n          --  For gnatmetric, the generated files should be put in the object\n          --  directory. This must be the first switch, because it may be\n-         --  overriden by a switch in package Metrics in the project file or by\n-         --  a command line option.\n+         --  overriden by a switch in package Metrics in the project file or\n+         --  by a command line option. Note that we don't add the -d= switch\n+         --  if there is no object directory available.\n \n-         if The_Command = Metric then\n+         if The_Command = Metric\n+           and then\n+             Project_Tree.Projects.Table (Project).Object_Directory /= No_Path\n+         then\n             First_Switches.Increment_Last;\n             First_Switches.Table (2 .. First_Switches.Last) :=\n               First_Switches.Table (1 .. First_Switches.Last - 1);\n@@ -2297,26 +2301,29 @@ begin\n          if ASIS_Main /= null then\n             Get_Closure;\n \n-            --  On VMS, set up again the env var for source dirs file. This is\n+            --  On VMS, set up the env var again for source dirs file. This is\n             --  because the call to gnatmake has set this env var to another\n             --  file that has now been deleted.\n \n             if Hostparm.OpenVMS then\n-               Setenv\n-                 (Project_Include_Path_File,\n-                  Prj.Env.Ada_Include_Path\n-                    (Project, Project_Tree, Recursive => True));\n+\n+               --  First make sure that the recorded file names are empty\n+\n+               Prj.Env.Initialize;\n+\n+               Prj.Env.Set_Ada_Paths\n+                 (Project, Project_Tree, Including_Libraries => False);\n             end if;\n \n          --  For gnat check, gnat pretty, gnat metric, gnat list, and gnat\n          --  stack, if no file has been put on the command line, call tool\n          --  with all the sources of the main project.\n \n          elsif The_Command = Check  or else\n-            The_Command = Pretty or else\n-            The_Command = Metric or else\n-            The_Command = List   or else\n-            The_Command = Stack\n+               The_Command = Pretty or else\n+               The_Command = Metric or else\n+               The_Command = List   or else\n+               The_Command = Stack\n          then\n             Check_Files;\n          end if;"}]}