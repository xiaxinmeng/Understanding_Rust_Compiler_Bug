{"sha": "cbfde6ee68dab649e3cf86b0ae569f2fc6ef3900", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6Y2JmZGU2ZWU2OGRhYjY0OWUzY2Y4NmIwYWU1NjlmMmZjNmVmMzkwMA==", "commit": {"author": {"name": "Vladislav Ivanishin", "email": "vlad@ispras.ru", "date": "2019-07-14T13:19:29Z"}, "committer": {"name": "Vladislav Ivanishin", "email": "vlad@gcc.gnu.org", "date": "2019-07-14T13:19:29Z"}, "message": "gdbhooks.py: dump-fn, dot-fn: cast ret values of fopen/fclose\n\nWork around the following\n\n    (gdb) Python Exception <class 'gdb.error'> 'fclose@@GLIBC_2.2.5' has\n    unknown return type; cast the call to its declared return type:\n    (gdb) Error occurred in Python: 'fclose@@GLIBC_2.2.5' has unknown\n    return type; cast the call to its declared return type\n\nThis is due to GDB not being able to pick up and use the return types from\ndebug info for external declarations.\n\n2019-07-14  Vladislav Ivanishin <vlad@ispras.ru>\n\n        * gdbhooks.py (DumpFn.invoke): Add explicit casts of return values of\n        fopen and fclose to their respective types.\n        (DotFn.invoke): Ditto.\n\nFrom-SVN: r273480", "tree": {"sha": "6408bdd7b6dee2f8eb7217f571adce583f53a614", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/6408bdd7b6dee2f8eb7217f571adce583f53a614"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/cbfde6ee68dab649e3cf86b0ae569f2fc6ef3900", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/cbfde6ee68dab649e3cf86b0ae569f2fc6ef3900", "html_url": "https://github.com/Rust-GCC/gccrs/commit/cbfde6ee68dab649e3cf86b0ae569f2fc6ef3900", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/cbfde6ee68dab649e3cf86b0ae569f2fc6ef3900/comments", "author": {"login": "ivladak", "id": 3601329, "node_id": "MDQ6VXNlcjM2MDEzMjk=", "avatar_url": "https://avatars.githubusercontent.com/u/3601329?v=4", "gravatar_id": "", "url": "https://api.github.com/users/ivladak", "html_url": "https://github.com/ivladak", "followers_url": "https://api.github.com/users/ivladak/followers", "following_url": "https://api.github.com/users/ivladak/following{/other_user}", "gists_url": "https://api.github.com/users/ivladak/gists{/gist_id}", "starred_url": "https://api.github.com/users/ivladak/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/ivladak/subscriptions", "organizations_url": "https://api.github.com/users/ivladak/orgs", "repos_url": "https://api.github.com/users/ivladak/repos", "events_url": "https://api.github.com/users/ivladak/events{/privacy}", "received_events_url": "https://api.github.com/users/ivladak/received_events", "type": "User", "site_admin": false}, "committer": null, "parents": [{"sha": "a20f263ba1a76af40eb4e6734529739a2a30ed65", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/a20f263ba1a76af40eb4e6734529739a2a30ed65", "html_url": "https://github.com/Rust-GCC/gccrs/commit/a20f263ba1a76af40eb4e6734529739a2a30ed65"}], "stats": {"total": 16, "additions": 10, "deletions": 6}, "files": [{"sha": "a9887b72e922bdc1f275088f6cac364c6891de58", "filename": "gcc/ChangeLog", "status": "modified", "additions": 6, "deletions": 0, "changes": 6, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/cbfde6ee68dab649e3cf86b0ae569f2fc6ef3900/gcc%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/cbfde6ee68dab649e3cf86b0ae569f2fc6ef3900/gcc%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2FChangeLog?ref=cbfde6ee68dab649e3cf86b0ae569f2fc6ef3900", "patch": "@@ -1,3 +1,9 @@\n+2019-07-14  Vladislav Ivanishin <vlad@ispras.ru>\n+\n+\t* gdbhooks.py (DumpFn.invoke): Add explicit casts of return values of\n+\tfopen and fclose to their respective types.\n+\t(DotFn.invoke): Ditto.\n+\n 2019-07-14  Jan Hubicka  <hubicka@ucw.cz>\n \n \t* ipa-fnsummary.c (ipa_dump_hints): Do not dump array_index."}, {"sha": "09802c9ce2442c2b25f3a6997db4dc49503bc2a1", "filename": "gcc/gdbhooks.py", "status": "modified", "additions": 4, "deletions": 6, "changes": 10, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/cbfde6ee68dab649e3cf86b0ae569f2fc6ef3900/gcc%2Fgdbhooks.py", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/cbfde6ee68dab649e3cf86b0ae569f2fc6ef3900/gcc%2Fgdbhooks.py", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fgdbhooks.py?ref=cbfde6ee68dab649e3cf86b0ae569f2fc6ef3900", "patch": "@@ -740,18 +740,17 @@ def invoke(self, arg, from_tty):\n             f.close()\n \n         # Open file\n-        fp = gdb.parse_and_eval(\"fopen (\\\"%s\\\", \\\"w\\\")\" % filename)\n+        fp = gdb.parse_and_eval(\"(FILE *) fopen (\\\"%s\\\", \\\"w\\\")\" % filename)\n         if fp == 0:\n             print (\"Could not open file: %s\" % filename)\n             return\n-        fp = \"(FILE *)%u\" % fp\n \n         # Dump function to file\n         _ = gdb.parse_and_eval(\"dump_function_to_file (%s, %s, %u)\" %\n                                (func, fp, flags))\n \n         # Close file\n-        ret = gdb.parse_and_eval(\"fclose (%s)\" % fp)\n+        ret = gdb.parse_and_eval(\"(int) fclose (%s)\" % fp)\n         if ret != 0:\n             print (\"Could not close file: %s\" % filename)\n             return\n@@ -810,11 +809,10 @@ def invoke(self, arg, from_tty):\n \n         # Close and reopen temp file to get C FILE*\n         f.close()\n-        fp = gdb.parse_and_eval(\"fopen (\\\"%s\\\", \\\"w\\\")\" % filename)\n+        fp = gdb.parse_and_eval(\"(FILE *) fopen (\\\"%s\\\", \\\"w\\\")\" % filename)\n         if fp == 0:\n             print(\"Cannot open temp file\")\n             return\n-        fp = \"(FILE *)%u\" % fp\n \n         # Write graph to temp file\n         _ = gdb.parse_and_eval(\"start_graph_dump (%s, \\\"<debug>\\\")\" % fp)\n@@ -823,7 +821,7 @@ def invoke(self, arg, from_tty):\n         _ = gdb.parse_and_eval(\"end_graph_dump (%s)\" % fp)\n \n         # Close temp file\n-        ret = gdb.parse_and_eval(\"fclose (%s)\" % fp)\n+        ret = gdb.parse_and_eval(\"(int) fclose (%s)\" % fp)\n         if ret != 0:\n             print(\"Could not close temp file: %s\" % filename)\n             return"}]}