{"sha": "2ea0d750147582b5d7bf405dce36f864618eacbd", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6MmVhMGQ3NTAxNDc1ODJiNWQ3YmY0MDVkY2UzNmY4NjQ2MThlYWNiZA==", "commit": {"author": {"name": "Segher Boessenkool", "email": "segher@kernel.crashing.org", "date": "2017-05-22T21:20:51Z"}, "committer": {"name": "Segher Boessenkool", "email": "segher@gcc.gnu.org", "date": "2017-05-22T21:20:51Z"}, "message": "cfgcleanup: Ignore clobbers in bb_is_just_return\n\nThe function bb_is_just_return finds if the BB it is asked about does\njust a return and nothing else.  It currently does not allow clobbers\nin the block either, which we of course can allow just fine.\n\nThis patch changes that.\n\n\n\t* cfgcleanup.c (bb_is_just_return): Allow CLOBBERs.\n\ngcc/testsuite/\n\nFrom-SVN: r248351", "tree": {"sha": "34cc1dd5be60d131c6db256516f0ff7f4e71c648", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/34cc1dd5be60d131c6db256516f0ff7f4e71c648"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/2ea0d750147582b5d7bf405dce36f864618eacbd", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/2ea0d750147582b5d7bf405dce36f864618eacbd", "html_url": "https://github.com/Rust-GCC/gccrs/commit/2ea0d750147582b5d7bf405dce36f864618eacbd", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/2ea0d750147582b5d7bf405dce36f864618eacbd/comments", "author": {"login": "segher", "id": 417629, "node_id": "MDQ6VXNlcjQxNzYyOQ==", "avatar_url": "https://avatars.githubusercontent.com/u/417629?v=4", "gravatar_id": "", "url": "https://api.github.com/users/segher", "html_url": "https://github.com/segher", "followers_url": "https://api.github.com/users/segher/followers", "following_url": "https://api.github.com/users/segher/following{/other_user}", "gists_url": "https://api.github.com/users/segher/gists{/gist_id}", "starred_url": "https://api.github.com/users/segher/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/segher/subscriptions", "organizations_url": "https://api.github.com/users/segher/orgs", "repos_url": "https://api.github.com/users/segher/repos", "events_url": "https://api.github.com/users/segher/events{/privacy}", "received_events_url": "https://api.github.com/users/segher/received_events", "type": "User", "site_admin": false}, "committer": null, "parents": [{"sha": "25b8168681bb5d1bc5e74c54b8f4cad635636ff1", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/25b8168681bb5d1bc5e74c54b8f4cad635636ff1", "html_url": "https://github.com/Rust-GCC/gccrs/commit/25b8168681bb5d1bc5e74c54b8f4cad635636ff1"}], "stats": {"total": 37, "additions": 31, "deletions": 6}, "files": [{"sha": "713654d8031cd8c25150f5f703f7eeb3d19c236f", "filename": "gcc/ChangeLog", "status": "modified", "additions": 4, "deletions": 0, "changes": 4, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/2ea0d750147582b5d7bf405dce36f864618eacbd/gcc%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/2ea0d750147582b5d7bf405dce36f864618eacbd/gcc%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2FChangeLog?ref=2ea0d750147582b5d7bf405dce36f864618eacbd", "patch": "@@ -1,3 +1,7 @@\n+2017-05-22  Segher Boessenkool  <segher@kernel.crashing.org>\n+\n+\t* cfgcleanup.c (bb_is_just_return): Allow CLOBBERs.\n+\n 2017-05-22  Jakub Jelinek  <jakub@redhat.com>\n \n \tPR middle-end/80809"}, {"sha": "3e1406c114112bf938153428773209d388539bb5", "filename": "gcc/cfgcleanup.c", "status": "modified", "additions": 8, "deletions": 6, "changes": 14, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/2ea0d750147582b5d7bf405dce36f864618eacbd/gcc%2Fcfgcleanup.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/2ea0d750147582b5d7bf405dce36f864618eacbd/gcc%2Fcfgcleanup.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fcfgcleanup.c?ref=2ea0d750147582b5d7bf405dce36f864618eacbd", "patch": "@@ -2666,7 +2666,7 @@ trivially_empty_bb_p (basic_block bb)\n \n /* Return true if BB contains just a return and possibly a USE of the\n    return value.  Fill in *RET and *USE with the return and use insns\n-   if any found, otherwise NULL.  */\n+   if any found, otherwise NULL.  All CLOBBERs are ignored.  */\n \n static bool\n bb_is_just_return (basic_block bb, rtx_insn **ret, rtx_insn **use)\n@@ -2680,13 +2680,15 @@ bb_is_just_return (basic_block bb, rtx_insn **ret, rtx_insn **use)\n   FOR_BB_INSNS (bb, insn)\n     if (NONDEBUG_INSN_P (insn))\n       {\n-\tif (!*ret && ANY_RETURN_P (PATTERN (insn)))\n+\trtx pat = PATTERN (insn);\n+\n+\tif (!*ret && ANY_RETURN_P (pat))\n \t  *ret = insn;\n-\telse if (!*ret && !*use && GET_CODE (PATTERN (insn)) == USE\n-\t    && REG_P (XEXP (PATTERN (insn), 0))\n-\t    && REG_FUNCTION_VALUE_P (XEXP (PATTERN (insn), 0)))\n+\telse if (!*ret && !*use && GET_CODE (pat) == USE\n+\t    && REG_P (XEXP (pat, 0))\n+\t    && REG_FUNCTION_VALUE_P (XEXP (pat, 0)))\n \t  *use = insn;\n-\telse\n+\telse if (GET_CODE (pat) != CLOBBER)\n \t  return false;\n       }\n "}, {"sha": "c55b0eef335ef20539cfadeb8737840163b04887", "filename": "gcc/testsuite/ChangeLog", "status": "modified", "additions": 4, "deletions": 0, "changes": 4, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/2ea0d750147582b5d7bf405dce36f864618eacbd/gcc%2Ftestsuite%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/2ea0d750147582b5d7bf405dce36f864618eacbd/gcc%2Ftestsuite%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2FChangeLog?ref=2ea0d750147582b5d7bf405dce36f864618eacbd", "patch": "@@ -1,3 +1,7 @@\n+2017-05-22  Segher Boessenkool  <segher@kernel.crashing.org>\n+\n+\t* gcc.target/powerpc/conditional-return.c: New testcase.\n+\n 2017-05-22  Bill Schmidt  <wschmidt@linux.vnet.ibm.com>\n \n \t* gcc.target/powerpc/p8-vec-xl-xst.c: Fix target string to"}, {"sha": "6b3ef5f52ca8371a491059cca530e0a7e2085f5d", "filename": "gcc/testsuite/gcc.target/powerpc/conditional-return.c", "status": "added", "additions": 15, "deletions": 0, "changes": 15, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/2ea0d750147582b5d7bf405dce36f864618eacbd/gcc%2Ftestsuite%2Fgcc.target%2Fpowerpc%2Fconditional-return.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/2ea0d750147582b5d7bf405dce36f864618eacbd/gcc%2Ftestsuite%2Fgcc.target%2Fpowerpc%2Fconditional-return.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgcc.target%2Fpowerpc%2Fconditional-return.c?ref=2ea0d750147582b5d7bf405dce36f864618eacbd", "patch": "@@ -0,0 +1,15 @@\n+/* Check that a conditional return is used.  */\n+\n+/* { dg-do compile } */\n+/* { dg-options \"-O2 -w\" } */\n+\n+/* { dg-final { scan-assembler {\\mbeqlr\\M} } } */\n+\n+\n+int f(int x)\n+{\n+\tif (x)\n+\t\treturn x + 31;\n+\n+\treturn;\n+}"}]}