{"sha": "5244089f1518bed96b73dfd52bbdc436f180696d", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6NTI0NDA4OWYxNTE4YmVkOTZiNzNkZmQ1MmJiZGM0MzZmMTgwNjk2ZA==", "commit": {"author": {"name": "Olivier Hainque", "email": "hainque@gcc.gnu.org", "date": "2018-09-21T13:09:51Z"}, "committer": {"name": "Olivier Hainque", "email": "hainque@gcc.gnu.org", "date": "2018-09-21T13:09:51Z"}, "message": "Leverage cacheTextUpdate for __clear_cache on VxWorks\n\n2018-09-21  Alexandre Oliva  <oliva@adacore.com>\n\nlibgcc/\n\t* config/vxcache.c: New file.  Provide __clear_cache, based on\n\tthe cacheTextUpdate VxWorks service.\n\t* config/t-vxworks (LIB2ADD): Add vxcache.c.\n\t(LIB2FUNCS_EXCLUDE): Add _clear_cache.\n\t* config/t-vxwoks7: Likewise.\ngcc/\n\t* config/vxworks.h (CLEAR_INSN_CACHE): #define to 1.\n\nFrom-SVN: r264479", "tree": {"sha": "11df61031d7ba534f20094e2dd43d10fd1ff5b27", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/11df61031d7ba534f20094e2dd43d10fd1ff5b27"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/5244089f1518bed96b73dfd52bbdc436f180696d", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/5244089f1518bed96b73dfd52bbdc436f180696d", "html_url": "https://github.com/Rust-GCC/gccrs/commit/5244089f1518bed96b73dfd52bbdc436f180696d", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/5244089f1518bed96b73dfd52bbdc436f180696d/comments", "author": null, "committer": null, "parents": [{"sha": "8d0ef282099ee0681222631bfb6421e28a177906", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/8d0ef282099ee0681222631bfb6421e28a177906", "html_url": "https://github.com/Rust-GCC/gccrs/commit/8d0ef282099ee0681222631bfb6421e28a177906"}], "stats": {"total": 61, "additions": 61, "deletions": 0}, "files": [{"sha": "b72c326c153887b39505fba4947ac1436d9cf89a", "filename": "gcc/ChangeLog", "status": "modified", "additions": 4, "deletions": 0, "changes": 4, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/5244089f1518bed96b73dfd52bbdc436f180696d/gcc%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/5244089f1518bed96b73dfd52bbdc436f180696d/gcc%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2FChangeLog?ref=5244089f1518bed96b73dfd52bbdc436f180696d", "patch": "@@ -1,3 +1,7 @@\n+2018-09-21  Olivier Hainque  <hainque@adacore.com>\n+\n+\t* config/vxworks.h (CLEAR_INSN_CACHE): #define to 1.\n+\n 2018-09-21  Olivier Hainque  <hainque@adacore.com>\n \n \t* config/vxworks.h (VXWORKS_LIBGCC_SPEC): Remove -lc_internal."}, {"sha": "3ed706e92b3dcfc84a1c2e693b0beda6fb29c8c3", "filename": "gcc/config/vxworks.h", "status": "modified", "additions": 4, "deletions": 0, "changes": 4, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/5244089f1518bed96b73dfd52bbdc436f180696d/gcc%2Fconfig%2Fvxworks.h", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/5244089f1518bed96b73dfd52bbdc436f180696d/gcc%2Fconfig%2Fvxworks.h", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fconfig%2Fvxworks.h?ref=5244089f1518bed96b73dfd52bbdc436f180696d", "patch": "@@ -206,6 +206,10 @@ extern void vxworks_asm_out_destructor (rtx symbol, int priority);\n /* The diab linker does not handle .gnu_attribute sections.  */\n #undef HAVE_AS_GNU_ATTRIBUTE\n \n+/* We provide our own version of __clear_cache in libgcc, using a separate C\n+   file to facilitate #inclusion of VxWorks header files.  */\n+#define CLEAR_INSN_CACHE 1\n+\n /* Default dwarf control values, for non-gdb debuggers that come with\n    VxWorks.  */\n "}, {"sha": "928b5a86ac138d58f76e9f96260994de9a080c16", "filename": "libgcc/ChangeLog", "status": "modified", "additions": 8, "deletions": 0, "changes": 8, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/5244089f1518bed96b73dfd52bbdc436f180696d/libgcc%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/5244089f1518bed96b73dfd52bbdc436f180696d/libgcc%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libgcc%2FChangeLog?ref=5244089f1518bed96b73dfd52bbdc436f180696d", "patch": "@@ -1,3 +1,11 @@\n+2018-09-21  Alexandre Oliva  <oliva@adacore.com>\n+\n+\t* config/vxcache.c: New file.  Provide __clear_cache, based on\n+\tthe cacheTextUpdate VxWorks service.\n+\t* config/t-vxworks (LIB2ADD): Add vxcache.c.\n+\t(LIB2FUNCS_EXCLUDE): Add _clear_cache.\n+\t* config/t-vxwoks7: Likewise.\n+\n 2018-09-21  Martin Liska  <mliska@suse.cz>\n \n \t* libgcov-driver.c (crc32_unsigned): Remove."}, {"sha": "2db8e05966e1056083712af255fdc9da6e0b95b8", "filename": "libgcc/config/t-vxworks", "status": "modified", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/5244089f1518bed96b73dfd52bbdc436f180696d/libgcc%2Fconfig%2Ft-vxworks", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/5244089f1518bed96b73dfd52bbdc436f180696d/libgcc%2Fconfig%2Ft-vxworks", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libgcc%2Fconfig%2Ft-vxworks?ref=5244089f1518bed96b73dfd52bbdc436f180696d", "patch": "@@ -1,6 +1,11 @@\n # Don't build libgcc.a with debug info\n LIBGCC2_DEBUG_CFLAGS =\n \n+# We provide our own implementation for __clear_cache, using a\n+# VxWorks specific entry point.\n+LIB2FUNCS_EXCLUDE += _clear_cache\n+LIB2ADD += $(srcdir)/config/vxcache.c\n+\n # Extra libgcc2 modules used by gthr-vxworks.h functions\n LIB2ADDEH += $(srcdir)/config/vxlib.c $(srcdir)/config/vxlib-tls.c\n "}, {"sha": "054ab7c4091299b3828d7bbf5144aec9f4166ee3", "filename": "libgcc/config/t-vxworks7", "status": "modified", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/5244089f1518bed96b73dfd52bbdc436f180696d/libgcc%2Fconfig%2Ft-vxworks7", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/5244089f1518bed96b73dfd52bbdc436f180696d/libgcc%2Fconfig%2Ft-vxworks7", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libgcc%2Fconfig%2Ft-vxworks7?ref=5244089f1518bed96b73dfd52bbdc436f180696d", "patch": "@@ -1,6 +1,11 @@\n # Don't build libgcc.a with debug info\n LIBGCC2_DEBUG_CFLAGS =\n \n+# We provide our own implementation for __clear_cache, using a\n+# VxWorks specific entry point.\n+LIB2FUNCS_EXCLUDE += _clear_cache\n+LIB2ADD += $(srcdir)/config/vxcache.c\n+\n # Extra libgcc2 modules used by gthr-vxworks.h functions\n LIB2ADDEH += $(srcdir)/config/vxlib.c $(srcdir)/config/vxlib-tls.c\n "}, {"sha": "23c72fbb5f5bed12eade8f13a4b126553f49b496", "filename": "libgcc/config/vxcache.c", "status": "added", "additions": 35, "deletions": 0, "changes": 35, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/5244089f1518bed96b73dfd52bbdc436f180696d/libgcc%2Fconfig%2Fvxcache.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/5244089f1518bed96b73dfd52bbdc436f180696d/libgcc%2Fconfig%2Fvxcache.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libgcc%2Fconfig%2Fvxcache.c?ref=5244089f1518bed96b73dfd52bbdc436f180696d", "patch": "@@ -0,0 +1,35 @@\n+/* Copyright (C) 2018 Free Software Foundation, Inc.\n+   Contributed by Alexandre Oliva <oliva@adacore.com>\n+\n+This file is part of GCC.\n+\n+GCC is free software; you can redistribute it and/or modify it under\n+the terms of the GNU General Public License as published by the Free\n+Software Foundation; either version 3, or (at your option) any later\n+version.\n+\n+GCC is distributed in the hope that it will be useful, but WITHOUT ANY\n+WARRANTY; without even the implied warranty of MERCHANTABILITY or\n+FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License\n+for more details.\n+\n+Under Section 7 of GPL version 3, you are granted additional\n+permissions described in the GCC Runtime Library Exception, version\n+3.1, as published by the Free Software Foundation.\n+\n+You should have received a copy of the GNU General Public License and\n+a copy of the GCC Runtime Library Exception along with this program;\n+see the files COPYING3 and COPYING.RUNTIME respectively.  If not, see\n+<http://www.gnu.org/licenses/>.  */\n+\n+/* Instruction cache invalidation routine using VxWorks' cacheLib.  */\n+\n+#include <vxWorks.h>\n+#include <cacheLib.h>\n+\n+void\n+__clear_cache (char *beg __attribute__((__unused__)),\n+\t       char *end __attribute__((__unused__)))\n+{\n+  cacheTextUpdate (beg, end - beg);\n+}"}]}