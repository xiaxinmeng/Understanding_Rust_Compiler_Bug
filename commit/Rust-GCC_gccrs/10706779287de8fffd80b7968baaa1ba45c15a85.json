{"sha": "10706779287de8fffd80b7968baaa1ba45c15a85", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6MTA3MDY3NzkyODdkZThmZmZkODBiNzk2OGJhYWExYmE0NWMxNWE4NQ==", "commit": {"author": {"name": "Jan Hubicka", "email": "hubicka@ucw.cz", "date": "2015-04-13T14:16:41Z"}, "committer": {"name": "Jan Hubicka", "email": "hubicka@gcc.gnu.org", "date": "2015-04-13T14:16:41Z"}, "message": "nonzero-3.C: New testcase.\n\n\n\t* g++.dg/tree-ssa/nonzero-3.C: New testcase.\n\t* tree-vrp.c (nonnull_arg_p): THIS pointers and references are non-zero.\n\t(gimple_stmt_nonzero_warnv_p): Reference return values are non-zero.\n\nFrom-SVN: r222054", "tree": {"sha": "706cd9ad1492a7ecff6bd5bb390144df2d0690c5", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/706cd9ad1492a7ecff6bd5bb390144df2d0690c5"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/10706779287de8fffd80b7968baaa1ba45c15a85", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/10706779287de8fffd80b7968baaa1ba45c15a85", "html_url": "https://github.com/Rust-GCC/gccrs/commit/10706779287de8fffd80b7968baaa1ba45c15a85", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/10706779287de8fffd80b7968baaa1ba45c15a85/comments", "author": null, "committer": null, "parents": [{"sha": "95d81ba561d69d63c65ac00c059555ce33d6e77a", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/95d81ba561d69d63c65ac00c059555ce33d6e77a", "html_url": "https://github.com/Rust-GCC/gccrs/commit/95d81ba561d69d63c65ac00c059555ce33d6e77a"}], "stats": {"total": 46, "additions": 46, "deletions": 0}, "files": [{"sha": "fe22835447ea63506ac13bf1f08b26f816c236a3", "filename": "gcc/ChangeLog", "status": "modified", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/10706779287de8fffd80b7968baaa1ba45c15a85/gcc%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/10706779287de8fffd80b7968baaa1ba45c15a85/gcc%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2FChangeLog?ref=10706779287de8fffd80b7968baaa1ba45c15a85", "patch": "@@ -1,3 +1,8 @@\n+2015-04-12  Jan Hubicka  <hubicka@ucw.cz>\n+\n+\t* tree-vrp.c (nonnull_arg_p): THIS pointers and references are non-zero.\n+\t(gimple_stmt_nonzero_warnv_p): Reference return values are non-zero.\n+\n 2015-04-12  Jan Hubicka  <hubicka@ucw.cz>\n \n \t* ipa-profie.c (ipa_profile): Check number of parameters"}, {"sha": "18ce31ce12fa3c2494e1eef9abe0bc2a0ab9da25", "filename": "gcc/testsuite/ChangeLog", "status": "modified", "additions": 4, "deletions": 0, "changes": 4, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/10706779287de8fffd80b7968baaa1ba45c15a85/gcc%2Ftestsuite%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/10706779287de8fffd80b7968baaa1ba45c15a85/gcc%2Ftestsuite%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2FChangeLog?ref=10706779287de8fffd80b7968baaa1ba45c15a85", "patch": "@@ -1,3 +1,7 @@\n+2015-04-12  Jan Hubicka  <hubicka@ucw.cz>\n+\n+\t* g++.dg/tree-ssa/nonzero-3.C: New testcase.\n+\n 2015-04-13  Richard Biener  <rguenther@suse.de>\n \n \tPR tree-optimization/65204"}, {"sha": "eaad3e69eb8c2d10940c7d79c9e123bc17d69c9e", "filename": "gcc/testsuite/g++.dg/tree-ssa/nonzero-3.C", "status": "added", "additions": 22, "deletions": 0, "changes": 22, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/10706779287de8fffd80b7968baaa1ba45c15a85/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Ftree-ssa%2Fnonzero-3.C", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/10706779287de8fffd80b7968baaa1ba45c15a85/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Ftree-ssa%2Fnonzero-3.C", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Ftree-ssa%2Fnonzero-3.C?ref=10706779287de8fffd80b7968baaa1ba45c15a85", "patch": "@@ -0,0 +1,22 @@\n+/* { dg-do compile } */\n+/* { dg-options \"-O2 -fdump-tree-vrp1 -fdelete-null-pointer-checks\" } */\n+struct A {int a;};\n+struct B {int b;};\n+struct C:A,B {int c;\n+  void bar();};\n+\n+void foo (struct B *);\n+void C::bar ()\n+{\n+  struct C *d = this;\n+  foo(this);\n+  foo(d);\n+}\n+void bar (struct C &c)\n+{\n+  struct C *d = &c;\n+  foo(&c);\n+  foo(d);\n+}\n+/* { dg-final { scan-tree-dump-not \"if \\\\(\" \"vrp1\"} } */\n+/* { dg-final { cleanup-tree-dump \"vrp1\" } } */"}, {"sha": "23e48b1144d9e1bc1ca898acaa70ecc033141373", "filename": "gcc/tree-vrp.c", "status": "modified", "additions": 15, "deletions": 0, "changes": 15, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/10706779287de8fffd80b7968baaa1ba45c15a85/gcc%2Ftree-vrp.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/10706779287de8fffd80b7968baaa1ba45c15a85/gcc%2Ftree-vrp.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftree-vrp.c?ref=10706779287de8fffd80b7968baaa1ba45c15a85", "patch": "@@ -393,6 +393,17 @@ nonnull_arg_p (const_tree arg)\n   if (arg == cfun->static_chain_decl)\n     return true;\n \n+  /* THIS argument of method is always non-NULL.  */\n+  if (TREE_CODE (TREE_TYPE (current_function_decl)) == METHOD_TYPE\n+      && arg == DECL_ARGUMENTS (current_function_decl)\n+      && flag_delete_null_pointer_checks)\n+    return true;\n+\n+  /* Values passed by reference are always non-NULL.  */\n+  if (TREE_CODE (TREE_TYPE (arg)) == REFERENCE_TYPE\n+      && flag_delete_null_pointer_checks)\n+    return true;\n+\n   fntype = TREE_TYPE (current_function_decl);\n   for (attrs = TYPE_ATTRIBUTES (fntype); attrs; attrs = TREE_CHAIN (attrs))\n     {\n@@ -1216,6 +1227,10 @@ gimple_stmt_nonzero_warnv_p (gimple stmt, bool *strict_overflow_p)\n \t    && DECL_IS_OPERATOR_NEW (fndecl)\n \t    && !TREE_NOTHROW (fndecl))\n \t  return true;\n+\t/* References are always non-NULL.  */\n+\tif (flag_delete_null_pointer_checks\n+\t    && TREE_CODE (TREE_TYPE (fndecl)) == REFERENCE_TYPE)\n+\t  return true;\n \tif (flag_delete_null_pointer_checks && \n \t    lookup_attribute (\"returns_nonnull\",\n \t\t\t      TYPE_ATTRIBUTES (gimple_call_fntype (stmt))))"}]}