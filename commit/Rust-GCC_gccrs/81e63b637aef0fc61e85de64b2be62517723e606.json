{"sha": "81e63b637aef0fc61e85de64b2be62517723e606", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6ODFlNjNiNjM3YWVmMGZjNjFlODVkZTY0YjJiZTYyNTE3NzIzZTYwNg==", "commit": {"author": {"name": "Segher Boessenkool", "email": "segher@kernel.crashing.org", "date": "2017-01-15T17:06:00Z"}, "committer": {"name": "Segher Boessenkool", "email": "segher@gcc.gnu.org", "date": "2017-01-15T17:06:00Z"}, "message": "Make rtl_split_edge work for jumps that fall through (PR72749)\n\nIf a jump always falls through but that cannot be optimised away, like\nis the case with the PowerPC bdnz insn if its jump target is the same as\nthe fallthrough, sched gets confused if it schedules some instructions\nfrom before that jump instruction to behind it: it splits the\nfallthrough branch, but the jump target isn't updated, and things fall\napart as in the PR.  This patch fixes it.\n\nThe second patch fragment makes -fsched-verbose=N work for N>=4; the\ncurrently scheduled fragment can now contain a label.  Everything else\nseems to work fine with that.\n\n\n\tPR target/72749\n\t* cfgrtl.c (rtl_split_edge): Also patch jump insns that jump to the\n\tfallthrough.\n\t* haifa-sched.c (dump_insn_stream): Don't crash if there is a label\n\tin the currently scheduled RTL fragment.\n\nFrom-SVN: r244477", "tree": {"sha": "1bd78fae14e682601ecbd3eb3625b7ca3c4f44f5", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/1bd78fae14e682601ecbd3eb3625b7ca3c4f44f5"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/81e63b637aef0fc61e85de64b2be62517723e606", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/81e63b637aef0fc61e85de64b2be62517723e606", "html_url": "https://github.com/Rust-GCC/gccrs/commit/81e63b637aef0fc61e85de64b2be62517723e606", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/81e63b637aef0fc61e85de64b2be62517723e606/comments", "author": {"login": "segher", "id": 417629, "node_id": "MDQ6VXNlcjQxNzYyOQ==", "avatar_url": "https://avatars.githubusercontent.com/u/417629?v=4", "gravatar_id": "", "url": "https://api.github.com/users/segher", "html_url": "https://github.com/segher", "followers_url": "https://api.github.com/users/segher/followers", "following_url": "https://api.github.com/users/segher/following{/other_user}", "gists_url": "https://api.github.com/users/segher/gists{/gist_id}", "starred_url": "https://api.github.com/users/segher/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/segher/subscriptions", "organizations_url": "https://api.github.com/users/segher/orgs", "repos_url": "https://api.github.com/users/segher/repos", "events_url": "https://api.github.com/users/segher/events{/privacy}", "received_events_url": "https://api.github.com/users/segher/received_events", "type": "User", "site_admin": false}, "committer": null, "parents": [{"sha": "32a8d3f66a4d02b77774a713e5c4ff8d586af4f4", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/32a8d3f66a4d02b77774a713e5c4ff8d586af4f4", "html_url": "https://github.com/Rust-GCC/gccrs/commit/32a8d3f66a4d02b77774a713e5c4ff8d586af4f4"}], "stats": {"total": 13, "additions": 11, "deletions": 2}, "files": [{"sha": "9d079732939004c53106cceb4ea7ac0fedfdbb44", "filename": "gcc/ChangeLog", "status": "modified", "additions": 8, "deletions": 0, "changes": 8, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/81e63b637aef0fc61e85de64b2be62517723e606/gcc%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/81e63b637aef0fc61e85de64b2be62517723e606/gcc%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2FChangeLog?ref=81e63b637aef0fc61e85de64b2be62517723e606", "patch": "@@ -1,3 +1,11 @@\n+2017-01-15  Segher Boessenkool  <segher@kernel.crashing.org>\n+\n+\tPR target/72749\n+\t* cfgrtl.c (rtl_split_edge): Also patch jump insns that jump to the\n+\tfallthrough.\n+\t* haifa-sched.c (dump_insn_stream): Don't crash if there is a label\n+\tin the currently scheduled RTL fragment.\n+\n 2017-01-15  Segher Boessenkool  <segher@kernel.crashing.org>\n \n \tPR rtl-optimization/78751"}, {"sha": "c7e355ec7d4d436a0af4bac4d56364fc37d02f4b", "filename": "gcc/cfgrtl.c", "status": "modified", "additions": 2, "deletions": 1, "changes": 3, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/81e63b637aef0fc61e85de64b2be62517723e606/gcc%2Fcfgrtl.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/81e63b637aef0fc61e85de64b2be62517723e606/gcc%2Fcfgrtl.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fcfgrtl.c?ref=81e63b637aef0fc61e85de64b2be62517723e606", "patch": "@@ -1935,7 +1935,8 @@ rtl_split_edge (edge edge_in)\n \t  if (last\n \t      && JUMP_P (last)\n \t      && edge_in->dest != EXIT_BLOCK_PTR_FOR_FN (cfun)\n-\t      && extract_asm_operands (PATTERN (last)) != NULL_RTX\n+\t      && (extract_asm_operands (PATTERN (last))\n+\t\t  || JUMP_LABEL (last) == before)\n \t      && patch_jump_insn (last, before, bb))\n \t    df_set_bb_dirty (edge_in->src);\n \t}"}, {"sha": "07de1bbbb2391954928d017889ef0aa679aa8d62", "filename": "gcc/haifa-sched.c", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/81e63b637aef0fc61e85de64b2be62517723e606/gcc%2Fhaifa-sched.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/81e63b637aef0fc61e85de64b2be62517723e606/gcc%2Fhaifa-sched.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fhaifa-sched.c?ref=81e63b637aef0fc61e85de64b2be62517723e606", "patch": "@@ -6495,7 +6495,7 @@ dump_insn_stream (rtx_insn *head, rtx_insn *tail)\n \n       if (sched_verbose >= 4)\n \t{\n-\t  if (NOTE_P (insn) || recog_memoized (insn) < 0)\n+\t  if (NOTE_P (insn) || LABEL_P (insn) || recog_memoized (insn) < 0)\n \t    fprintf (sched_dump, \"nothing\");\n \t  else\n \t    print_reservation (sched_dump, insn);"}]}