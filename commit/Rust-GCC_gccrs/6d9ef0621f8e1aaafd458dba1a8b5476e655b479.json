{"sha": "6d9ef0621f8e1aaafd458dba1a8b5476e655b479", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6NmQ5ZWYwNjIxZjhlMWFhYWZkNDU4ZGJhMWE4YjU0NzZlNjU1YjQ3OQ==", "commit": {"author": {"name": "Qian Chao", "email": "qianchao9@huawei.com", "date": "2020-06-10T08:46:56Z"}, "committer": {"name": "Martin Liska", "email": "mliska@suse.cz", "date": "2020-06-10T09:05:06Z"}, "message": "tmmark: verify_ssa failed [PR95569]\n\nThis patch fixes a latent bug exposed by eb72dc663e9070b281be83a80f6f838a3a878822.\nSee the discussion on the bug for details.\n\nBootstrapped and regtested on aarch64-linux-gnu. No new fails introduced.\n\n2020-06-10  Qian Chao  <qianchao9@huawei.com>\n\ngcc/ChangeLog:\n\n\tPR tree-optimization/95569\n\t* trans-mem.c (expand_assign_tm): Ensure that rtmp is marked TREE_ADDRESSABLE.\n\ngcc/testsuite/ChangeLog:\n\n\tPR tree-optimization/95569\n\t* gcc.dg/tm/pr95569.c: New test.", "tree": {"sha": "d635f64b88d771565d485ed2b07af0d11dc0f929", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/d635f64b88d771565d485ed2b07af0d11dc0f929"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/6d9ef0621f8e1aaafd458dba1a8b5476e655b479", "comment_count": 0, "verification": {"verified": false, "reason": "unknown_key", "signature": "-----BEGIN PGP SIGNATURE-----\n\niQEzBAABCAAdFiEE6I4wzqqylQBfXaRhTcGC3A+nN4UFAl7golsACgkQTcGC3A+n\nN4VrNgf/dfPw/vrMNZLfauNmXSzQJrrJVQiIApFKySPh2BcrVBH9vndXxqY1pGHn\nqr2MVqL6AKN6Nj9g4W3h2kcQ8W0c0EdOyse/XvDFNfempxU4fmRscWU1NuDZcGdC\n0PJXzoKbIX0enHe1XiT/GYeRxFBRpz+BuDAujwUhjqUduMHlqlqGHiiFKaQGmnPJ\nlvvs6HHSNBOOMpc0oa6AXdizw0mZKukUrHcF/fTEcl+7Q19l9NGsM3h5IIXVH0kj\nYopbeYBjDhJklaolBYBZ8fRhgcVnmS9wMyUos4q4+bpoImSDeVtt4TSxUQcbDnjg\nTMqorOEEdzB6STrWv/opvEWj0uBi9Q==\n=7FLF\n-----END PGP SIGNATURE-----", "payload": "tree d635f64b88d771565d485ed2b07af0d11dc0f929\nparent dc6d15eaa23cbae1468a6ef92371b1c856c14819\nauthor Qian Chao <qianchao9@huawei.com> 1591778816 -0400\ncommitter Martin Liska <mliska@suse.cz> 1591779906 +0200\n\ntmmark: verify_ssa failed [PR95569]\n\nThis patch fixes a latent bug exposed by eb72dc663e9070b281be83a80f6f838a3a878822.\nSee the discussion on the bug for details.\n\nBootstrapped and regtested on aarch64-linux-gnu. No new fails introduced.\n\n2020-06-10  Qian Chao  <qianchao9@huawei.com>\n\ngcc/ChangeLog:\n\n\tPR tree-optimization/95569\n\t* trans-mem.c (expand_assign_tm): Ensure that rtmp is marked TREE_ADDRESSABLE.\n\ngcc/testsuite/ChangeLog:\n\n\tPR tree-optimization/95569\n\t* gcc.dg/tm/pr95569.c: New test.\n"}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/6d9ef0621f8e1aaafd458dba1a8b5476e655b479", "html_url": "https://github.com/Rust-GCC/gccrs/commit/6d9ef0621f8e1aaafd458dba1a8b5476e655b479", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/6d9ef0621f8e1aaafd458dba1a8b5476e655b479/comments", "author": null, "committer": {"login": "marxin", "id": 2658545, "node_id": "MDQ6VXNlcjI2NTg1NDU=", "avatar_url": "https://avatars.githubusercontent.com/u/2658545?v=4", "gravatar_id": "", "url": "https://api.github.com/users/marxin", "html_url": "https://github.com/marxin", "followers_url": "https://api.github.com/users/marxin/followers", "following_url": "https://api.github.com/users/marxin/following{/other_user}", "gists_url": "https://api.github.com/users/marxin/gists{/gist_id}", "starred_url": "https://api.github.com/users/marxin/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/marxin/subscriptions", "organizations_url": "https://api.github.com/users/marxin/orgs", "repos_url": "https://api.github.com/users/marxin/repos", "events_url": "https://api.github.com/users/marxin/events{/privacy}", "received_events_url": "https://api.github.com/users/marxin/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "dc6d15eaa23cbae1468a6ef92371b1c856c14819", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/dc6d15eaa23cbae1468a6ef92371b1c856c14819", "html_url": "https://github.com/Rust-GCC/gccrs/commit/dc6d15eaa23cbae1468a6ef92371b1c856c14819"}], "stats": {"total": 19, "additions": 19, "deletions": 0}, "files": [{"sha": "f0b0d6f4c24a74148c87b9ab0673c61cb14dbabd", "filename": "gcc/testsuite/gcc.dg/tm/pr95569.c", "status": "added", "additions": 18, "deletions": 0, "changes": 18, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/6d9ef0621f8e1aaafd458dba1a8b5476e655b479/gcc%2Ftestsuite%2Fgcc.dg%2Ftm%2Fpr95569.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/6d9ef0621f8e1aaafd458dba1a8b5476e655b479/gcc%2Ftestsuite%2Fgcc.dg%2Ftm%2Fpr95569.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgcc.dg%2Ftm%2Fpr95569.c?ref=6d9ef0621f8e1aaafd458dba1a8b5476e655b479", "patch": "@@ -0,0 +1,18 @@\n+/* { dg-do compile } */\n+/* { dg-options \"-fgnu-tm -O0\" } */\n+/* { dg-do compile { target aarch64*-*-* } } */\n+\n+typedef int __attribute__ ((vector_size (16))) vectype;\n+vectype v;\n+\n+void\n+foo (int c)\n+{\n+  vectype *p = __builtin_malloc (sizeof (vectype));\n+  __transaction_atomic\n+  {\n+    *p = v;\n+    if (c)\n+      __transaction_cancel;\n+  }\n+}"}, {"sha": "b6b9157006b53926bda25f3bc0841ac2bce161ca", "filename": "gcc/trans-mem.c", "status": "modified", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/6d9ef0621f8e1aaafd458dba1a8b5476e655b479/gcc%2Ftrans-mem.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/6d9ef0621f8e1aaafd458dba1a8b5476e655b479/gcc%2Ftrans-mem.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftrans-mem.c?ref=6d9ef0621f8e1aaafd458dba1a8b5476e655b479", "patch": "@@ -2424,6 +2424,7 @@ expand_assign_tm (struct tm_region *region, gimple_stmt_iterator *gsi)\n       if (is_gimple_reg (rhs))\n \t{\n \t  tree rtmp = create_tmp_var (TREE_TYPE (rhs));\n+\t  TREE_ADDRESSABLE (rtmp) = 1;\n \t  rhs_addr = build_fold_addr_expr (rtmp);\n \t  gcall = gimple_build_assign (rtmp, rhs);\n \t  gsi_insert_before (gsi, gcall, GSI_SAME_STMT);"}]}