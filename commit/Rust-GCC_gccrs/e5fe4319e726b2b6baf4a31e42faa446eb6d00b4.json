{"sha": "e5fe4319e726b2b6baf4a31e42faa446eb6d00b4", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6ZTVmZTQzMTllNzI2YjJiNmJhZjRhMzFlNDJmYWE0NDZlYjZkMDBiNA==", "commit": {"author": {"name": "Joey Ye", "email": "joey.ye@arm.com", "date": "2011-11-21T02:16:12Z"}, "committer": {"name": "Joey Ye", "email": "jye2@gcc.gnu.org", "date": "2011-11-21T02:16:12Z"}, "message": "expr.c (expand_expr_real_1): Correctly handle strict volatile bitfield loads smaller than mode size.\n\n2011-11-20  Joey Ye  <joey.ye@arm.com>\n\n\t* expr.c (expand_expr_real_1): Correctly handle strict volatile\n\tbitfield loads smaller than mode size.\n\ntestsuite:\n\n\t* gcc.dg/volatile-bitfields-1.c: New.\n\nFrom-SVN: r181549", "tree": {"sha": "34dbbd53c18e02cc659b9d899a46473dc5ba47e8", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/34dbbd53c18e02cc659b9d899a46473dc5ba47e8"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/e5fe4319e726b2b6baf4a31e42faa446eb6d00b4", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/e5fe4319e726b2b6baf4a31e42faa446eb6d00b4", "html_url": "https://github.com/Rust-GCC/gccrs/commit/e5fe4319e726b2b6baf4a31e42faa446eb6d00b4", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/e5fe4319e726b2b6baf4a31e42faa446eb6d00b4/comments", "author": {"login": "joeye-arm", "id": 38510878, "node_id": "MDQ6VXNlcjM4NTEwODc4", "avatar_url": "https://avatars.githubusercontent.com/u/38510878?v=4", "gravatar_id": "", "url": "https://api.github.com/users/joeye-arm", "html_url": "https://github.com/joeye-arm", "followers_url": "https://api.github.com/users/joeye-arm/followers", "following_url": "https://api.github.com/users/joeye-arm/following{/other_user}", "gists_url": "https://api.github.com/users/joeye-arm/gists{/gist_id}", "starred_url": "https://api.github.com/users/joeye-arm/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/joeye-arm/subscriptions", "organizations_url": "https://api.github.com/users/joeye-arm/orgs", "repos_url": "https://api.github.com/users/joeye-arm/repos", "events_url": "https://api.github.com/users/joeye-arm/events{/privacy}", "received_events_url": "https://api.github.com/users/joeye-arm/received_events", "type": "User", "site_admin": false}, "committer": null, "parents": [{"sha": "25a96761979b320209f0b513ad364e5d9e5a05d6", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/25a96761979b320209f0b513ad364e5d9e5a05d6", "html_url": "https://github.com/Rust-GCC/gccrs/commit/25a96761979b320209f0b513ad364e5d9e5a05d6"}], "stats": {"total": 43, "additions": 40, "deletions": 3}, "files": [{"sha": "590dba822e27cd520893bdb7e5ab0f07b6b24728", "filename": "gcc/ChangeLog", "status": "modified", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/e5fe4319e726b2b6baf4a31e42faa446eb6d00b4/gcc%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/e5fe4319e726b2b6baf4a31e42faa446eb6d00b4/gcc%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2FChangeLog?ref=e5fe4319e726b2b6baf4a31e42faa446eb6d00b4", "patch": "@@ -1,3 +1,8 @@\n+2011-11-20  Joey Ye  <joey.ye@arm.com>\n+\n+\t* expr.c (expand_expr_real_1): Correctly handle strict volatile\n+\tbitfield loads smaller than mode size.\n+\n 2011-11-20  Richard Henderson  <rth@redhat.com>\n \n \t* config/mips/mips.c (mips_init_libfuncs): Call init_sync_libfuncs."}, {"sha": "8d3a0f671a8a0f4372ca4eb9f7b091ad40b41e88", "filename": "gcc/expr.c", "status": "modified", "additions": 8, "deletions": 3, "changes": 11, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/e5fe4319e726b2b6baf4a31e42faa446eb6d00b4/gcc%2Fexpr.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/e5fe4319e726b2b6baf4a31e42faa446eb6d00b4/gcc%2Fexpr.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fexpr.c?ref=e5fe4319e726b2b6baf4a31e42faa446eb6d00b4", "patch": "@@ -9740,11 +9740,16 @@ expand_expr_real_1 (tree exp, rtx target, enum machine_mode tmode,\n \t\t&& modifier != EXPAND_CONST_ADDRESS\n \t\t&& modifier != EXPAND_INITIALIZER)\n \t    /* If the field is volatile, we always want an aligned\n-\t       access.  Only do this if the access is not already naturally\n+\t       access.  Do this in following two situations:\n+\t       1. the access is not already naturally\n \t       aligned, otherwise \"normal\" (non-bitfield) volatile fields\n-\t       become non-addressable.  */\n+\t       become non-addressable.\n+\t       2. the bitsize is narrower than the access size. Need\n+\t       to extract bitfields from the access.  */\n \t    || (volatilep && flag_strict_volatile_bitfields > 0\n-\t\t&& (bitpos % GET_MODE_ALIGNMENT (mode) != 0))\n+\t\t&& (bitpos % GET_MODE_ALIGNMENT (mode) != 0 \n+\t\t    || (mode1 != BLKmode\n+\t\t        && bitsize < GET_MODE_SIZE (mode1) * BITS_PER_UNIT)))\n \t    /* If the field isn't aligned enough to fetch as a memref,\n \t       fetch it as a bit field.  */\n \t    || (mode1 != BLKmode"}, {"sha": "5c1fb0077d6d69ff7d18282488d06168c88e7a97", "filename": "gcc/testsuite/ChangeLog", "status": "modified", "additions": 4, "deletions": 0, "changes": 4, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/e5fe4319e726b2b6baf4a31e42faa446eb6d00b4/gcc%2Ftestsuite%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/e5fe4319e726b2b6baf4a31e42faa446eb6d00b4/gcc%2Ftestsuite%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2FChangeLog?ref=e5fe4319e726b2b6baf4a31e42faa446eb6d00b4", "patch": "@@ -1,3 +1,7 @@\n+2011-11-20  Joey Ye  <joey.ye@arm.com>\n+\n+\t* gcc.dg/volatile-bitfields-1.c: New.\n+\n 2011-11-20  Jason Merrill  <jason@redhat.com>\n \n \tPR c++/48322"}, {"sha": "6adda27fea4c07beae39b36789bd675064d8963d", "filename": "gcc/testsuite/gcc.dg/volatile-bitfields-1.c", "status": "added", "additions": 23, "deletions": 0, "changes": 23, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/e5fe4319e726b2b6baf4a31e42faa446eb6d00b4/gcc%2Ftestsuite%2Fgcc.dg%2Fvolatile-bitfields-1.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/e5fe4319e726b2b6baf4a31e42faa446eb6d00b4/gcc%2Ftestsuite%2Fgcc.dg%2Fvolatile-bitfields-1.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgcc.dg%2Fvolatile-bitfields-1.c?ref=e5fe4319e726b2b6baf4a31e42faa446eb6d00b4", "patch": "@@ -0,0 +1,23 @@\n+/* { dg-options \"-fstrict-volatile-bitfields\" } */\n+/* { dg-do run } */\n+\n+extern int puts(const char *);\n+extern void abort(void) __attribute__((noreturn));\n+\n+typedef struct {\n+  volatile unsigned short a:8, b:8;\n+} BitStruct;\n+\n+BitStruct bits = {1, 2};\n+\n+void check(int i, int j)\n+{\n+  if (i != 1 || j != 2) puts(\"FAIL\"), abort();\n+}\n+\n+int main ()\n+{\n+  check(bits.a, bits.b);\n+\n+  return 0;\n+}"}]}