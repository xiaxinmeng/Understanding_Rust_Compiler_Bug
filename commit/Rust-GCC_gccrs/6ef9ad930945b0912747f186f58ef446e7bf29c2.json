{"sha": "6ef9ad930945b0912747f186f58ef446e7bf29c2", "node_id": "C_kwDOANBUbNoAKDZlZjlhZDkzMDk0NWIwOTEyNzQ3ZjE4NmY1OGVmNDQ2ZTdiZjI5YzI", "commit": {"author": {"name": "Aldy Hernandez", "email": "aldyh@redhat.com", "date": "2021-10-28T13:54:27Z"}, "committer": {"name": "Aldy Hernandez", "email": "aldyh@redhat.com", "date": "2021-10-28T21:12:03Z"}, "message": "path relation oracle: Remove SSA's being killed from the equivalence list.\n\nSame thing as the relational change.  Walk any equivalences that have\nbeen registered on the path, and remove the name being killed.  The\nonly reason we had added the equivalence with itself earlier is so we\nwouldn't search any further in the equivalency list.  So if we are\nremoving all references to it, then we no longer need to add a \"kill\"\nrecord.\n\nWill push pending tests on x86-64 Linux.\n\nCo-authored-by: Andrew MacLeod <amacleod@redhat.com>\n\ngcc/ChangeLog:\n\n\t* value-relation.cc (path_oracle::killing_def): Walk the\n\tequivalency list and remove SSA from any equivalencies.", "tree": {"sha": "f8eba8329978af8f66513a7247125f36a8abe0e2", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/f8eba8329978af8f66513a7247125f36a8abe0e2"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/6ef9ad930945b0912747f186f58ef446e7bf29c2", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/6ef9ad930945b0912747f186f58ef446e7bf29c2", "html_url": "https://github.com/Rust-GCC/gccrs/commit/6ef9ad930945b0912747f186f58ef446e7bf29c2", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/6ef9ad930945b0912747f186f58ef446e7bf29c2/comments", "author": {"login": "aldyh", "id": 12937877, "node_id": "MDQ6VXNlcjEyOTM3ODc3", "avatar_url": "https://avatars.githubusercontent.com/u/12937877?v=4", "gravatar_id": "", "url": "https://api.github.com/users/aldyh", "html_url": "https://github.com/aldyh", "followers_url": "https://api.github.com/users/aldyh/followers", "following_url": "https://api.github.com/users/aldyh/following{/other_user}", "gists_url": "https://api.github.com/users/aldyh/gists{/gist_id}", "starred_url": "https://api.github.com/users/aldyh/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/aldyh/subscriptions", "organizations_url": "https://api.github.com/users/aldyh/orgs", "repos_url": "https://api.github.com/users/aldyh/repos", "events_url": "https://api.github.com/users/aldyh/events{/privacy}", "received_events_url": "https://api.github.com/users/aldyh/received_events", "type": "User", "site_admin": false}, "committer": {"login": "aldyh", "id": 12937877, "node_id": "MDQ6VXNlcjEyOTM3ODc3", "avatar_url": "https://avatars.githubusercontent.com/u/12937877?v=4", "gravatar_id": "", "url": "https://api.github.com/users/aldyh", "html_url": "https://github.com/aldyh", "followers_url": "https://api.github.com/users/aldyh/followers", "following_url": "https://api.github.com/users/aldyh/following{/other_user}", "gists_url": "https://api.github.com/users/aldyh/gists{/gist_id}", "starred_url": "https://api.github.com/users/aldyh/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/aldyh/subscriptions", "organizations_url": "https://api.github.com/users/aldyh/orgs", "repos_url": "https://api.github.com/users/aldyh/repos", "events_url": "https://api.github.com/users/aldyh/events{/privacy}", "received_events_url": "https://api.github.com/users/aldyh/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "308531d148afa3fd77c0efc82a80b26300f9615a", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/308531d148afa3fd77c0efc82a80b26300f9615a", "html_url": "https://github.com/Rust-GCC/gccrs/commit/308531d148afa3fd77c0efc82a80b26300f9615a"}], "stats": {"total": 20, "additions": 10, "deletions": 10}, "files": [{"sha": "512b51ce02227818ce92889f5f91b5a544c38e72", "filename": "gcc/value-relation.cc", "status": "modified", "additions": 10, "deletions": 10, "changes": 20, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/6ef9ad930945b0912747f186f58ef446e7bf29c2/gcc%2Fvalue-relation.cc", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/6ef9ad930945b0912747f186f58ef446e7bf29c2/gcc%2Fvalue-relation.cc", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fvalue-relation.cc?ref=6ef9ad930945b0912747f186f58ef446e7bf29c2", "patch": "@@ -1298,17 +1298,17 @@ path_oracle::killing_def (tree ssa)\n     }\n \n   unsigned v = SSA_NAME_VERSION (ssa);\n-  bitmap b = BITMAP_ALLOC (&m_bitmaps);\n-  bitmap_set_bit (b, v);\n-  equiv_chain *ptr = (equiv_chain *) obstack_alloc (&m_chain_obstack,\n-\t\t\t\t\t\t    sizeof (equiv_chain));\n-  ptr->m_names = b;\n-  ptr->m_bb = NULL;\n-  ptr->m_next = m_equiv.m_next;\n-  m_equiv.m_next = ptr;\n-  bitmap_ior_into (m_equiv.m_names, b);\n \n-  // Walk the relation list an remove SSA from any relations.\n+  // Walk the equivalency list and remove SSA from any equivalencies.\n+  if (bitmap_bit_p (m_equiv.m_names, v))\n+    {\n+      bitmap_clear_bit (m_equiv.m_names, v);\n+      for (equiv_chain *ptr = m_equiv.m_next; ptr; ptr = ptr->m_next)\n+\tif (bitmap_bit_p (ptr->m_names, v))\n+\t  bitmap_clear_bit (ptr->m_names, v);\n+    }\n+\n+  // Walk the relation list and remove SSA from any relations.\n   if (!bitmap_bit_p (m_relations.m_names, v))\n     return;\n "}]}