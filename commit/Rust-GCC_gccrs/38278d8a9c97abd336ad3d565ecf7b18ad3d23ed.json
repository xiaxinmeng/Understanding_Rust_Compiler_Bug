{"sha": "38278d8a9c97abd336ad3d565ecf7b18ad3d23ed", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6MzgyNzhkOGE5Yzk3YWJkMzM2YWQzZDU2NWVjZjdiMThhZDNkMjNlZA==", "commit": {"author": {"name": "Tom de Vries", "email": "tom@codesourcery.com", "date": "2014-09-22T12:53:12Z"}, "committer": {"name": "Tom de Vries", "email": "vries@gcc.gnu.org", "date": "2014-09-22T12:53:12Z"}, "message": "Add --inline option to contrib/mklog\n\n2014-09-22  Tom de Vries  <tom@codesourcery.com>\n\n\t* mklog: Add --inline option.\n\nFrom-SVN: r215462", "tree": {"sha": "1ae3d197ce1099784db5d7f46d3bb7466904f7e1", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/1ae3d197ce1099784db5d7f46d3bb7466904f7e1"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/38278d8a9c97abd336ad3d565ecf7b18ad3d23ed", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/38278d8a9c97abd336ad3d565ecf7b18ad3d23ed", "html_url": "https://github.com/Rust-GCC/gccrs/commit/38278d8a9c97abd336ad3d565ecf7b18ad3d23ed", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/38278d8a9c97abd336ad3d565ecf7b18ad3d23ed/comments", "author": null, "committer": null, "parents": [{"sha": "931002b26597b93aff99d78043b1e838a59861ce", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/931002b26597b93aff99d78043b1e838a59861ce", "html_url": "https://github.com/Rust-GCC/gccrs/commit/931002b26597b93aff99d78043b1e838a59861ce"}], "stats": {"total": 52, "additions": 49, "deletions": 3}, "files": [{"sha": "f7cb37e9aab785a8cf86ea902d3603d854bb610a", "filename": "contrib/ChangeLog", "status": "modified", "additions": 4, "deletions": 0, "changes": 4, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/38278d8a9c97abd336ad3d565ecf7b18ad3d23ed/contrib%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/38278d8a9c97abd336ad3d565ecf7b18ad3d23ed/contrib%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/contrib%2FChangeLog?ref=38278d8a9c97abd336ad3d565ecf7b18ad3d23ed", "patch": "@@ -1,3 +1,7 @@\n+2014-09-22  Tom de Vries  <tom@codesourcery.com>\n+\n+\t* mklog: Add --inline option.\n+\n 2014-09-19  Segher Boessenkool  <segher@kernel.crashing.org>\n \n \t* dg-extract-results.py (Prog.result_re): Include options in test name."}, {"sha": "6ed4c6e8f51ebbc182cfb9b6bbe59281d1c8f4d9", "filename": "contrib/mklog", "status": "modified", "additions": 45, "deletions": 3, "changes": 48, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/38278d8a9c97abd336ad3d565ecf7b18ad3d23ed/contrib%2Fmklog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/38278d8a9c97abd336ad3d565ecf7b18ad3d23ed/contrib%2Fmklog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/contrib%2Fmklog?ref=38278d8a9c97abd336ad3d565ecf7b18ad3d23ed", "patch": "@@ -26,6 +26,9 @@\n # Author: Diego Novillo <dnovillo@google.com> and\n #         Cary Coutant <ccoutant@google.com>\n \n+use File::Temp;\n+use File::Copy qw(cp mv);\n+\n # Change these settings to reflect your profile.\n $username = $ENV{'USER'};\n $name = `finger $username | grep -o 'Name: .*'`;\n@@ -56,14 +59,22 @@ if (-d \"$gcc_root/.git\") {\n # Program starts here. You should not need to edit anything below this\n # line.\n #-----------------------------------------------------------------------------\n-if ($#ARGV != 0) {\n+$inline = 0;\n+if ($#ARGV == 1 && (\"$ARGV[0]\" eq \"-i\" || \"$ARGV[0]\" eq \"--inline\")) {\n+\tshift;\n+\t$inline = 1;\n+} elsif ($#ARGV != 0) {\n     $prog = `basename $0`; chop ($prog);\n     print <<EOF;\n-usage: $prog file.diff\n+usage: $prog [ -i | --inline ] file.diff\n \n Generate ChangeLog template for file.diff.\n It assumes that patch has been created with -up or -cp.\n+When -i is used, the ChangeLog template is followed by the contents of\n+file.diff.\n When file.diff is -, read standard input.\n+When -i is used and file.diff is not -, it writes to file.diff, otherwise it\n+writes to stdout.\n EOF\n     exit 1;\n }\n@@ -273,8 +284,39 @@ foreach (@diff_lines) {\n # functions.\n $cl_entries{$clname} .= $change_msg ? \"$change_msg\\n\" : \":\\n\";\n \n+if ($inline && $diff ne \"-\") {\n+\t# Get a temp filename, rather than an open filehandle, because we use\n+\t# the open to truncate.\n+\t$tmp = mktemp(\"tmp.XXXXXXXX\") or die \"Could not create temp file: $!\";\n+\n+\t# Copy the permissions to the temp file (in File::Copy module version\n+\t# 2.15 and later).\n+\tcp $diff, $tmp or die \"Could not copy patch file to temp file: $!\";\n+\n+\t# Open the temp file, clearing contents.\n+\topen (OUTPUTFILE, '>', $tmp) or die \"Could not open temp file: $!\";\n+} else {\n+\t*OUTPUTFILE = STDOUT;\n+}\n+\n+# Print the log\n foreach my $clname (keys %cl_entries) {\n-\tprint \"$clname:\\n\\n$hdrline\\n\\n$cl_entries{$clname}\\n\";\n+\tprint OUTPUTFILE \"$clname:\\n\\n$hdrline\\n\\n$cl_entries{$clname}\\n\";\n+}\n+\n+if ($inline) {\n+\t# Append the patch to the log\n+\tforeach (@diff_lines) {\n+\t\tprint OUTPUTFILE \"$_\\n\";\n+\t}\n+}\n+\n+if ($inline && $diff ne \"-\") {\n+\t# Close $tmp\n+\tclose(OUTPUTFILE);\n+\n+\t# Write new contents to $diff atomically\n+\tmv $tmp, $diff or die \"Could not move temp file to patch file: $!\";\n }\n \n exit 0;"}]}