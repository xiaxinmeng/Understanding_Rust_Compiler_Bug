{"sha": "55cc1a0524a460e8b224878114842463100b0e0e", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6NTVjYzFhMDUyNGE0NjBlOGIyMjQ4NzgxMTQ4NDI0NjMxMDBiMGUwZQ==", "commit": {"author": {"name": "Arnaud Charlet", "email": "charlet@gcc.gnu.org", "date": "2009-04-15T10:51:32Z"}, "committer": {"name": "Arnaud Charlet", "email": "charlet@gcc.gnu.org", "date": "2009-04-15T10:51:32Z"}, "message": "[multiple changes]\n\n2009-04-15  Pascal Obry  <obry@adacore.com>\n\n\tAdd support for Win32 native encoding for delete/rename routines.\n\t\n\t* adaint.c (__gnat_unlink): New routine.\n\t(__gnat_rename): New routine.\n\tSimple wrapper routines used to convert to proper encoding on\n\tWindows.\n\n\t* s-os_lib.adb: Use __gnat_unlink and __gnat_rename instead of direct\n\tcall to the C library.\n\n\t* g-sercom-mingw.adb, s-win32.ads: Update Win32 binding.\n\n2009-04-15  Robert Dewar  <dewar@adacore.com>\n\n\t* s-tassta.adb: Minor reformatting\n\nFrom-SVN: r146101", "tree": {"sha": "db6c6af475721d139150f29938adcb6018b85725", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/db6c6af475721d139150f29938adcb6018b85725"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/55cc1a0524a460e8b224878114842463100b0e0e", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/55cc1a0524a460e8b224878114842463100b0e0e", "html_url": "https://github.com/Rust-GCC/gccrs/commit/55cc1a0524a460e8b224878114842463100b0e0e", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/55cc1a0524a460e8b224878114842463100b0e0e/comments", "author": null, "committer": null, "parents": [{"sha": "1f6821b4dcdcc3bf95f6aa4551cc755e113162be", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/1f6821b4dcdcc3bf95f6aa4551cc755e113162be", "html_url": "https://github.com/Rust-GCC/gccrs/commit/1f6821b4dcdcc3bf95f6aa4551cc755e113162be"}], "stats": {"total": 174, "additions": 125, "deletions": 49}, "files": [{"sha": "4f332439a55c8e68f6a8d8ea8560c56d4b10dd50", "filename": "gcc/ada/ChangeLog", "status": "modified", "additions": 18, "deletions": 0, "changes": 18, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/55cc1a0524a460e8b224878114842463100b0e0e/gcc%2Fada%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/55cc1a0524a460e8b224878114842463100b0e0e/gcc%2Fada%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fada%2FChangeLog?ref=55cc1a0524a460e8b224878114842463100b0e0e", "patch": "@@ -1,3 +1,21 @@\n+2009-04-15  Pascal Obry  <obry@adacore.com>\n+\n+\tAdd support for Win32 native encoding for delete/rename routines.\n+\t\n+\t* adaint.c (__gnat_unlink): New routine.\n+\t(__gnat_rename): New routine.\n+\tSimple wrapper routines used to convert to proper encoding on\n+\tWindows.\n+\n+\t* s-os_lib.adb: Use __gnat_unlink and __gnat_rename instead of direct\n+\tcall to the C library.\n+\n+\t* g-sercom-mingw.adb, s-win32.ads: Update Win32 binding.\n+\n+2009-04-15  Robert Dewar  <dewar@adacore.com>\n+\n+\t* s-tassta.adb: Minor reformatting\n+\n 2009-04-15  Robert Dewar  <dewar@adacore.com>\n \n \t* frontend.adb (Frontend): Set proper default for"}, {"sha": "c84cd3ed2dcba4f58600039dede356d0ddd431cf", "filename": "gcc/ada/adaint.c", "status": "modified", "additions": 35, "deletions": 0, "changes": 35, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/55cc1a0524a460e8b224878114842463100b0e0e/gcc%2Fada%2Fadaint.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/55cc1a0524a460e8b224878114842463100b0e0e/gcc%2Fada%2Fadaint.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fada%2Fadaint.c?ref=55cc1a0524a460e8b224878114842463100b0e0e", "patch": "@@ -694,6 +694,41 @@ __gnat_os_filename (char *filename, char *w_filename ATTRIBUTE_UNUSED,\n #endif\n }\n \n+/* Delete a file.  */\n+\n+int\n+__gnat_unlink (char *path)\n+{\n+#if defined (__MINGW32__) && ! defined (__vxworks) && ! defined (CROSS_COMPILE)\n+  {\n+    TCHAR wpath[GNAT_MAX_PATH_LEN];\n+\n+    S2WSU (wpath, path, GNAT_MAX_PATH_LEN);\n+    return _tunlink (wpath);\n+  }\n+#else\n+  return unlink (path);\n+#endif\n+}\n+\n+/* Rename a file.  */\n+\n+int\n+__gnat_rename (char *from, char *to)\n+{\n+#if defined (__MINGW32__) && ! defined (__vxworks) && ! defined (CROSS_COMPILE)\n+  {\n+    TCHAR wfrom[GNAT_MAX_PATH_LEN], wto[GNAT_MAX_PATH_LEN];\n+\n+    S2WSU (wfrom, from, GNAT_MAX_PATH_LEN);\n+    S2WSU (wto, to, GNAT_MAX_PATH_LEN);\n+    return _trename (wfrom, wto);\n+  }\n+#else\n+  return rename (from, to);\n+#endif\n+}\n+\n FILE *\n __gnat_fopen (char *path, char *mode, int encoding ATTRIBUTE_UNUSED)\n {"}, {"sha": "03bd6aba191d851f1485cd0a93826f76eef44f38", "filename": "gcc/ada/g-sercom-mingw.adb", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/55cc1a0524a460e8b224878114842463100b0e0e/gcc%2Fada%2Fg-sercom-mingw.adb", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/55cc1a0524a460e8b224878114842463100b0e0e/gcc%2Fada%2Fg-sercom-mingw.adb", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fada%2Fg-sercom-mingw.adb?ref=55cc1a0524a460e8b224878114842463100b0e0e", "patch": "@@ -106,7 +106,7 @@ package body GNAT.Serial_Communications is\n          Success := CloseHandle (HANDLE (Port.H.all));\n       end if;\n \n-      Port.H.all := CreateFile\n+      Port.H.all := CreateFileA\n         (lpFileName            => C_Name (C_Name'First)'Address,\n          dwDesiredAccess       => GENERIC_READ or GENERIC_WRITE,\n          dwShareMode           => 0,"}, {"sha": "0add64f94d13183e4fb62cfea764bd04d3d9f1fb", "filename": "gcc/ada/s-os_lib.adb", "status": "modified", "additions": 2, "deletions": 2, "changes": 4, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/55cc1a0524a460e8b224878114842463100b0e0e/gcc%2Fada%2Fs-os_lib.adb", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/55cc1a0524a460e8b224878114842463100b0e0e/gcc%2Fada%2Fs-os_lib.adb", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fada%2Fs-os_lib.adb?ref=55cc1a0524a460e8b224878114842463100b0e0e", "patch": "@@ -848,7 +848,7 @@ package body System.OS_Lib is\n       R : Integer;\n \n       function unlink (A : Address) return Integer;\n-      pragma Import (C, unlink, \"unlink\");\n+      pragma Import (C, unlink, \"__gnat_unlink\");\n \n    begin\n       R := unlink (Name);\n@@ -2246,7 +2246,7 @@ package body System.OS_Lib is\n       Success  : out Boolean)\n    is\n       function rename (From, To : Address) return Integer;\n-      pragma Import (C, rename, \"rename\");\n+      pragma Import (C, rename, \"__gnat_rename\");\n       R : Integer;\n    begin\n       R := rename (Old_Name, New_Name);"}, {"sha": "9a5ce9fd8c15cd15a59af0b610c69596755ce68e", "filename": "gcc/ada/s-tassta.adb", "status": "modified", "additions": 2, "deletions": 0, "changes": 2, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/55cc1a0524a460e8b224878114842463100b0e0e/gcc%2Fada%2Fs-tassta.adb", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/55cc1a0524a460e8b224878114842463100b0e0e/gcc%2Fada%2Fs-tassta.adb", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fada%2Fs-tassta.adb?ref=55cc1a0524a460e8b224878114842463100b0e0e", "patch": "@@ -1388,6 +1388,8 @@ package body System.Tasking.Stages is\n       --  unwound. The common notification routine has been called at the\n       --  raise point already.\n \n+      --  Lock to prevent unsynchronized output\n+\n       Initialization.Task_Lock (Self_Id);\n       To_Stderr (\"task \");\n "}, {"sha": "35975919edd36534c0c509fceb7e084fee65c119", "filename": "gcc/ada/s-win32.ads", "status": "modified", "additions": 67, "deletions": 46, "changes": 113, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/55cc1a0524a460e8b224878114842463100b0e0e/gcc%2Fada%2Fs-win32.ads", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/55cc1a0524a460e8b224878114842463100b0e0e/gcc%2Fada%2Fs-win32.ads", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fada%2Fs-win32.ads?ref=55cc1a0524a460e8b224878114842463100b0e0e", "patch": "@@ -82,51 +82,53 @@ package System.Win32 is\n    -- Files --\n    -----------\n \n-   GENERIC_READ  : constant := 16#80000000#;\n-   GENERIC_WRITE : constant := 16#40000000#;\n-\n-   CREATE_NEW        : constant := 1;\n-   CREATE_ALWAYS     : constant := 2;\n-   OPEN_EXISTING     : constant := 3;\n-   OPEN_ALWAYS       : constant := 4;\n-   TRUNCATE_EXISTING : constant := 5;\n-\n-   FILE_SHARE_DELETE : constant := 16#00000004#;\n-   FILE_SHARE_READ   : constant := 16#00000001#;\n-   FILE_SHARE_WRITE  : constant := 16#00000002#;\n-\n-   FILE_BEGIN        : constant := 0;\n-   FILE_CURRENT      : constant := 1;\n-   FILE_END          : constant := 2;\n-\n-   PAGE_NOACCESS       : constant := 16#0001#;\n-   PAGE_READONLY       : constant := 16#0002#;\n-   PAGE_READWRITE      : constant := 16#0004#;\n-   PAGE_WRITECOPY      : constant := 16#0008#;\n-   PAGE_EXECUTE        : constant := 16#0010#;\n-\n-   FILE_MAP_ALL_ACCESS : constant := 16#F001f#;\n-   FILE_MAP_READ       : constant := 4;\n-   FILE_MAP_WRITE      : constant := 2;\n-   FILE_MAP_COPY       : constant := 1;\n-\n-   FILE_ADD_FILE             : constant := 16#0002#;\n-   FILE_ADD_SUBDIRECTORY     : constant := 16#0004#;\n-   FILE_APPEND_DATA          : constant := 16#0004#;\n-   FILE_CREATE_PIPE_INSTANCE : constant := 16#0004#;\n-   FILE_DELETE_CHILD         : constant := 16#0040#;\n-   FILE_EXECUTE              : constant := 16#0020#;\n-   FILE_LIST_DIRECTORY       : constant := 16#0001#;\n-   FILE_READ_ATTRIBUTES      : constant := 16#0080#;\n-   FILE_READ_DATA            : constant := 16#0001#;\n-   FILE_READ_EA              : constant := 16#0008#;\n-   FILE_TRAVERSE             : constant := 16#0020#;\n-   FILE_WRITE_ATTRIBUTES     : constant := 16#0100#;\n-   FILE_WRITE_DATA           : constant := 16#0002#;\n-   FILE_WRITE_EA             : constant := 16#0010#;\n-   STANDARD_RIGHTS_READ      : constant := 16#20000#;\n-   STANDARD_RIGHTS_WRITE     : constant := 16#20000#;\n-   SYNCHRONIZE               : constant := 16#100000#;\n+   CP_UTF8                            : constant := 65001;\n+\n+   GENERIC_READ                       : constant := 16#80000000#;\n+   GENERIC_WRITE                      : constant := 16#40000000#;\n+\n+   CREATE_NEW                         : constant := 1;\n+   CREATE_ALWAYS                      : constant := 2;\n+   OPEN_EXISTING                      : constant := 3;\n+   OPEN_ALWAYS                        : constant := 4;\n+   TRUNCATE_EXISTING                  : constant := 5;\n+\n+   FILE_SHARE_DELETE                  : constant := 16#00000004#;\n+   FILE_SHARE_READ                    : constant := 16#00000001#;\n+   FILE_SHARE_WRITE                   : constant := 16#00000002#;\n+\n+   FILE_BEGIN                         : constant := 0;\n+   FILE_CURRENT                       : constant := 1;\n+   FILE_END                           : constant := 2;\n+\n+   PAGE_NOACCESS                      : constant := 16#0001#;\n+   PAGE_READONLY                      : constant := 16#0002#;\n+   PAGE_READWRITE                     : constant := 16#0004#;\n+   PAGE_WRITECOPY                     : constant := 16#0008#;\n+   PAGE_EXECUTE                       : constant := 16#0010#;\n+\n+   FILE_MAP_ALL_ACCESS                : constant := 16#F001f#;\n+   FILE_MAP_READ                      : constant := 4;\n+   FILE_MAP_WRITE                     : constant := 2;\n+   FILE_MAP_COPY                      : constant := 1;\n+\n+   FILE_ADD_FILE                      : constant := 16#0002#;\n+   FILE_ADD_SUBDIRECTORY              : constant := 16#0004#;\n+   FILE_APPEND_DATA                   : constant := 16#0004#;\n+   FILE_CREATE_PIPE_INSTANCE          : constant := 16#0004#;\n+   FILE_DELETE_CHILD                  : constant := 16#0040#;\n+   FILE_EXECUTE                       : constant := 16#0020#;\n+   FILE_LIST_DIRECTORY                : constant := 16#0001#;\n+   FILE_READ_ATTRIBUTES               : constant := 16#0080#;\n+   FILE_READ_DATA                     : constant := 16#0001#;\n+   FILE_READ_EA                       : constant := 16#0008#;\n+   FILE_TRAVERSE                      : constant := 16#0020#;\n+   FILE_WRITE_ATTRIBUTES              : constant := 16#0100#;\n+   FILE_WRITE_DATA                    : constant := 16#0002#;\n+   FILE_WRITE_EA                      : constant := 16#0010#;\n+   STANDARD_RIGHTS_READ               : constant := 16#20000#;\n+   STANDARD_RIGHTS_WRITE              : constant := 16#20000#;\n+   SYNCHRONIZE                        : constant := 16#100000#;\n \n    FILE_ATTRIBUTE_READONLY            : constant := 16#00000001#;\n    FILE_ATTRIBUTE_HIDDEN              : constant := 16#00000002#;\n@@ -159,6 +161,16 @@ package System.Win32 is\n       bInheritHandle      : BOOL;\n    end record;\n \n+   function CreateFileA\n+     (lpFileName            : Address;\n+      dwDesiredAccess       : DWORD;\n+      dwShareMode           : DWORD;\n+      lpSecurityAttributes  : access SECURITY_ATTRIBUTES;\n+      dwCreationDisposition : DWORD;\n+      dwFlagsAndAttributes  : DWORD;\n+      hTemplateFile         : HANDLE) return HANDLE;\n+   pragma Import (Stdcall, CreateFileA, \"CreateFileA\");\n+\n    function CreateFile\n      (lpFileName            : Address;\n       dwDesiredAccess       : DWORD;\n@@ -167,7 +179,7 @@ package System.Win32 is\n       dwCreationDisposition : DWORD;\n       dwFlagsAndAttributes  : DWORD;\n       hTemplateFile         : HANDLE) return HANDLE;\n-   pragma Import (Stdcall, CreateFile, \"CreateFileA\");\n+   pragma Import (Stdcall, CreateFile, \"CreateFileW\");\n \n    function GetFileSize\n      (hFile          : HANDLE;\n@@ -220,6 +232,15 @@ package System.Win32 is\n    function UnmapViewOfFile (lpBaseAddress : System.Address) return BOOL;\n    pragma Import (Stdcall, UnmapViewOfFile, \"UnmapViewOfFile\");\n \n+   function MultiByteToWideChar\n+     (CodePage       : WORD;\n+      dwFlags        : DWORD;\n+      lpMultiByteStr : System.Address;\n+      cchMultiByte   : WORD;\n+      lpWideCharStr  : System.Address;\n+      cchWideChar    : WORD) return BOOL;\n+   pragma Import (Stdcall, MultiByteToWideChar, \"MultiByteToWideChar\");\n+\n    ------------------------\n    -- System Information --\n    ------------------------"}]}