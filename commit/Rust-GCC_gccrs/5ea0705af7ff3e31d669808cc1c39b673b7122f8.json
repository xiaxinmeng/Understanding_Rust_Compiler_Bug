{"sha": "5ea0705af7ff3e31d669808cc1c39b673b7122f8", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6NWVhMDcwNWFmN2ZmM2UzMWQ2Njk4MDhjYzFjMzliNjczYjcxMjJmOA==", "commit": {"author": {"name": "Janne Blomqvist", "email": "jb@gcc.gnu.org", "date": "2011-06-11T10:19:49Z"}, "committer": {"name": "Janne Blomqvist", "email": "jb@gcc.gnu.org", "date": "2011-06-11T10:19:49Z"}, "message": "Figure out whether a file is seekable with lseek()\n\nFrom-SVN: r174946", "tree": {"sha": "f8dc4399ed8813242826269d056cc2f2039b1304", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/f8dc4399ed8813242826269d056cc2f2039b1304"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/5ea0705af7ff3e31d669808cc1c39b673b7122f8", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/5ea0705af7ff3e31d669808cc1c39b673b7122f8", "html_url": "https://github.com/Rust-GCC/gccrs/commit/5ea0705af7ff3e31d669808cc1c39b673b7122f8", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/5ea0705af7ff3e31d669808cc1c39b673b7122f8/comments", "author": null, "committer": null, "parents": [{"sha": "ba94c7af45cf628c815208b4a961138ef279fe1a", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/ba94c7af45cf628c815208b4a961138ef279fe1a", "html_url": "https://github.com/Rust-GCC/gccrs/commit/ba94c7af45cf628c815208b4a961138ef279fe1a"}], "stats": {"total": 17, "additions": 11, "deletions": 6}, "files": [{"sha": "d54878b189fb59a7d6328f353c813b6ac5fad63e", "filename": "libgfortran/ChangeLog", "status": "modified", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/5ea0705af7ff3e31d669808cc1c39b673b7122f8/libgfortran%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/5ea0705af7ff3e31d669808cc1c39b673b7122f8/libgfortran%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libgfortran%2FChangeLog?ref=5ea0705af7ff3e31d669808cc1c39b673b7122f8", "patch": "@@ -1,3 +1,8 @@\n+2011-06-11  Janne Blomqvist  <jb@gcc.gnu.org>\n+\n+\t* io/unix.c (fd_to_stream): Figure out if a fd is seekable by\n+\ttrying lseek().\n+\n 2011-06-10  Daniel Carrera  <dcarrera@gmail.com>\n \n \t* caf/mpi.c (_gfortran_caf_sync_all,"}, {"sha": "e3ae607229031f843bbaa23e476b4aa4e0b6b37a", "filename": "libgfortran/io/unix.c", "status": "modified", "additions": 6, "deletions": 6, "changes": 12, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/5ea0705af7ff3e31d669808cc1c39b673b7122f8/libgfortran%2Fio%2Funix.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/5ea0705af7ff3e31d669808cc1c39b673b7122f8/libgfortran%2Fio%2Funix.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libgfortran%2Fio%2Funix.c?ref=5ea0705af7ff3e31d669808cc1c39b673b7122f8", "patch": "@@ -952,15 +952,15 @@ fd_to_stream (int fd)\n \n   if (S_ISREG (statbuf.st_mode))\n     s->file_length = statbuf.st_size;\n-  else if (S_ISBLK (statbuf.st_mode))\n+  else\n     {\n-      /* Hopefully more portable than ioctl(fd, BLKGETSIZE64, &size)?  */\n-      gfc_offset cur = lseek (fd, 0, SEEK_CUR);\n+      /* Some character special files are seekable but most are not,\n+\t so figure it out by trying to seek.  On Linux, /dev/null is\n+\t an example of such a special file.  */\n       s->file_length = lseek (fd, 0, SEEK_END);\n-      lseek (fd, cur, SEEK_SET);\n+      if (s->file_length > 0)\n+\tlseek (fd, 0, SEEK_SET);\n     }\n-  else\n-    s->file_length = -1;\n \n   if (!(S_ISREG (statbuf.st_mode) || S_ISBLK (statbuf.st_mode))\n       || options.all_unbuffered"}]}