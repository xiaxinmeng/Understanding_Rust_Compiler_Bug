{"sha": "bf63ef6c22e8d8f972e76dad2b75ef509ddbc062", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6YmY2M2VmNmMyMmU4ZDhmOTcyZTc2ZGFkMmI3NWVmNTA5ZGRiYzA2Mg==", "commit": {"author": {"name": "Uros Bizjak", "email": "ubizjak@gmail.com", "date": "2012-01-15T18:03:46Z"}, "committer": {"name": "Uros Bizjak", "email": "uros@gcc.gnu.org", "date": "2012-01-15T18:03:46Z"}, "message": "re PR rtl-optimization/51821 (64bit > 32bit conversion produces incorrect results with optimizations)\n\n\tPR rtl-optimization/51821\n\t* recog.c (peep2_find_free_register): Determine clobbered registers\n\tfrom insn pattern.\n\ntestsuite/ChangeLog:\n\n\tPR rtl-optimization/51821\n\t* gcc.dg/pr51821.c: New test.\n\nFrom-SVN: r183194", "tree": {"sha": "eca3678227b52e8d12cc35b64e4e604c44c20c09", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/eca3678227b52e8d12cc35b64e4e604c44c20c09"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/bf63ef6c22e8d8f972e76dad2b75ef509ddbc062", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/bf63ef6c22e8d8f972e76dad2b75ef509ddbc062", "html_url": "https://github.com/Rust-GCC/gccrs/commit/bf63ef6c22e8d8f972e76dad2b75ef509ddbc062", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/bf63ef6c22e8d8f972e76dad2b75ef509ddbc062/comments", "author": {"login": "ubizjak", "id": 55479990, "node_id": "MDQ6VXNlcjU1NDc5OTkw", "avatar_url": "https://avatars.githubusercontent.com/u/55479990?v=4", "gravatar_id": "", "url": "https://api.github.com/users/ubizjak", "html_url": "https://github.com/ubizjak", "followers_url": "https://api.github.com/users/ubizjak/followers", "following_url": "https://api.github.com/users/ubizjak/following{/other_user}", "gists_url": "https://api.github.com/users/ubizjak/gists{/gist_id}", "starred_url": "https://api.github.com/users/ubizjak/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/ubizjak/subscriptions", "organizations_url": "https://api.github.com/users/ubizjak/orgs", "repos_url": "https://api.github.com/users/ubizjak/repos", "events_url": "https://api.github.com/users/ubizjak/events{/privacy}", "received_events_url": "https://api.github.com/users/ubizjak/received_events", "type": "User", "site_admin": false}, "committer": null, "parents": [{"sha": "512b60583ea250fb524bb6acabed4de0e7ff416b", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/512b60583ea250fb524bb6acabed4de0e7ff416b", "html_url": "https://github.com/Rust-GCC/gccrs/commit/512b60583ea250fb524bb6acabed4de0e7ff416b"}], "stats": {"total": 46, "additions": 42, "deletions": 4}, "files": [{"sha": "b74e6090546e141114bb3a835e509616036b3268", "filename": "gcc/ChangeLog", "status": "modified", "additions": 6, "deletions": 0, "changes": 6, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/bf63ef6c22e8d8f972e76dad2b75ef509ddbc062/gcc%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/bf63ef6c22e8d8f972e76dad2b75ef509ddbc062/gcc%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2FChangeLog?ref=bf63ef6c22e8d8f972e76dad2b75ef509ddbc062", "patch": "@@ -1,3 +1,9 @@\n+2012-01-15  Uros Bizjak  <ubizjak@gmail.com>\n+\n+\tPR rtl-optimization/51821\n+\t* recog.c (peep2_find_free_register): Determine clobbered registers\n+\tfrom insn pattern.\n+\n 2012-01-14  Denis Chertykov  <chertykov@gmail.com>\n \n \tPR target/50925"}, {"sha": "8f041799e62a65e951b1f79d14641c2833310a00", "filename": "gcc/recog.c", "status": "modified", "additions": 7, "deletions": 4, "changes": 11, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/bf63ef6c22e8d8f972e76dad2b75ef509ddbc062/gcc%2Frecog.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/bf63ef6c22e8d8f972e76dad2b75ef509ddbc062/gcc%2Frecog.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Frecog.c?ref=bf63ef6c22e8d8f972e76dad2b75ef509ddbc062", "patch": "@@ -3038,6 +3038,7 @@ peep2_find_free_register (int from, int to, const char *class_str,\n   static int search_ofs;\n   enum reg_class cl;\n   HARD_REG_SET live;\n+  df_ref *def_rec;\n   int i;\n \n   gcc_assert (from < MAX_INSNS_PER_PEEP2 + 1);\n@@ -3051,12 +3052,14 @@ peep2_find_free_register (int from, int to, const char *class_str,\n \n   while (from != to)\n     {\n-      HARD_REG_SET this_live;\n+      gcc_assert (peep2_insn_data[from].insn != NULL_RTX);\n+\n+      /* Don't use registers set or clobbered by the insn.  */\n+      for (def_rec = DF_INSN_DEFS (peep2_insn_data[from].insn);\n+\t   *def_rec; def_rec++)\n+\tSET_HARD_REG_BIT (live, DF_REF_REGNO (*def_rec));\n \n       from = peep2_buf_position (from + 1);\n-      gcc_assert (peep2_insn_data[from].insn != NULL_RTX);\n-      REG_SET_TO_HARD_REG_SET (this_live, peep2_insn_data[from].live_before);\n-      IOR_HARD_REG_SET (live, this_live);\n     }\n \n   cl = (class_str[0] == 'r' ? GENERAL_REGS"}, {"sha": "8bf1c29ea72873f3a7b7aa71aeef33c8390ff21f", "filename": "gcc/testsuite/ChangeLog", "status": "modified", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/bf63ef6c22e8d8f972e76dad2b75ef509ddbc062/gcc%2Ftestsuite%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/bf63ef6c22e8d8f972e76dad2b75ef509ddbc062/gcc%2Ftestsuite%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2FChangeLog?ref=bf63ef6c22e8d8f972e76dad2b75ef509ddbc062", "patch": "@@ -1,3 +1,8 @@\n+2012-01-15  Uros Bizjak  <ubizjak@gmail.com>\n+\n+\tPR rtl-optimization/51821\n+\t* gcc.dg/pr51821.c: New test.\n+\n 2012-01-15  Andreas Schwab  <schwab@linux-m68k.org>\n \n \t* gcc.dg/torture/pr8081.c: Fix char signedness assumption."}, {"sha": "e7ba409fb70120e8338e603eb57cbea91090fb89", "filename": "gcc/testsuite/gcc.dg/pr51821.c", "status": "added", "additions": 24, "deletions": 0, "changes": 24, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/bf63ef6c22e8d8f972e76dad2b75ef509ddbc062/gcc%2Ftestsuite%2Fgcc.dg%2Fpr51821.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/bf63ef6c22e8d8f972e76dad2b75ef509ddbc062/gcc%2Ftestsuite%2Fgcc.dg%2Fpr51821.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgcc.dg%2Fpr51821.c?ref=bf63ef6c22e8d8f972e76dad2b75ef509ddbc062", "patch": "@@ -0,0 +1,24 @@\n+/* { dg-do run } */\n+/* { dg-options \"-O2 -msse\" { target { i?86-*-* x86_64-*-* } } } */\n+/* { dg-require-effective-target sse_runtime { target { i?86-*-* x86_64-*-* } } } */\n+\n+extern void abort (void);\n+\n+unsigned int  __attribute__((noinline))\n+test (int shift_size)\n+{\n+  unsigned long long res = ~0;\n+\n+  return res << shift_size;\n+}\n+\n+int\n+main ()\n+{\n+  int dst = 32;\n+\n+  if (test (dst) != 0)\n+    abort ();\n+\n+  return 0;\n+}"}]}