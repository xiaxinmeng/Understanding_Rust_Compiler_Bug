{"sha": "1a15a91a0015208eafb797e4de1348c9877fd6d0", "node_id": "C_kwDOANBUbNoAKDFhMTVhOTFhMDAxNTIwOGVhZmI3OTdlNGRlMTM0OGM5ODc3ZmQ2ZDA", "commit": {"author": {"name": "Andrew Pinski", "email": "apinski@marvell.com", "date": "2021-11-16T23:37:08Z"}, "committer": {"name": "Andrew Pinski", "email": "apinski@marvell.com", "date": "2021-11-17T08:04:14Z"}, "message": "Fix PR 103288, ICE after PHI-OPT, move an assigment when still in use for another bb\n\nThe problem is r12-5300-gf98f373dd822b35c allows phiopt to recognize more basic blocks\nbut missed one location where phiopt could move an assignment from the middle block\nto the non-middle one.  This patch fixes that.\n\nOK? Bootstrapped and tested on x86_64-linux-gnu with no regressions.\n\n\tPR tree-optimization/103288\n\ngcc/ChangeLog:\n\n\t* tree-ssa-phiopt.c (value_replacement): Return early if middle\n\tblock has more than one pred.\n\ngcc/testsuite/ChangeLog:\n\n\t* gcc.c-torture/compile/pr103288-1.c: New test.", "tree": {"sha": "96e087c5056cc0dbe5634b06222456ebc4e731c8", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/96e087c5056cc0dbe5634b06222456ebc4e731c8"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/1a15a91a0015208eafb797e4de1348c9877fd6d0", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/1a15a91a0015208eafb797e4de1348c9877fd6d0", "html_url": "https://github.com/Rust-GCC/gccrs/commit/1a15a91a0015208eafb797e4de1348c9877fd6d0", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/1a15a91a0015208eafb797e4de1348c9877fd6d0/comments", "author": {"login": "apinski-cavium", "id": 6335315, "node_id": "MDQ6VXNlcjYzMzUzMTU=", "avatar_url": "https://avatars.githubusercontent.com/u/6335315?v=4", "gravatar_id": "", "url": "https://api.github.com/users/apinski-cavium", "html_url": "https://github.com/apinski-cavium", "followers_url": "https://api.github.com/users/apinski-cavium/followers", "following_url": "https://api.github.com/users/apinski-cavium/following{/other_user}", "gists_url": "https://api.github.com/users/apinski-cavium/gists{/gist_id}", "starred_url": "https://api.github.com/users/apinski-cavium/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/apinski-cavium/subscriptions", "organizations_url": "https://api.github.com/users/apinski-cavium/orgs", "repos_url": "https://api.github.com/users/apinski-cavium/repos", "events_url": "https://api.github.com/users/apinski-cavium/events{/privacy}", "received_events_url": "https://api.github.com/users/apinski-cavium/received_events", "type": "User", "site_admin": false}, "committer": {"login": "apinski-cavium", "id": 6335315, "node_id": "MDQ6VXNlcjYzMzUzMTU=", "avatar_url": "https://avatars.githubusercontent.com/u/6335315?v=4", "gravatar_id": "", "url": "https://api.github.com/users/apinski-cavium", "html_url": "https://github.com/apinski-cavium", "followers_url": "https://api.github.com/users/apinski-cavium/followers", "following_url": "https://api.github.com/users/apinski-cavium/following{/other_user}", "gists_url": "https://api.github.com/users/apinski-cavium/gists{/gist_id}", "starred_url": "https://api.github.com/users/apinski-cavium/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/apinski-cavium/subscriptions", "organizations_url": "https://api.github.com/users/apinski-cavium/orgs", "repos_url": "https://api.github.com/users/apinski-cavium/repos", "events_url": "https://api.github.com/users/apinski-cavium/events{/privacy}", "received_events_url": "https://api.github.com/users/apinski-cavium/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "b8ce19bb1a0592051e8f9a4c3252d12ae605b256", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/b8ce19bb1a0592051e8f9a4c3252d12ae605b256", "html_url": "https://github.com/Rust-GCC/gccrs/commit/b8ce19bb1a0592051e8f9a4c3252d12ae605b256"}], "stats": {"total": 9, "additions": 9, "deletions": 0}, "files": [{"sha": "88d1c67559976eee6ee8e1a3410429da4bae0e62", "filename": "gcc/testsuite/gcc.c-torture/compile/pr103288-1.c", "status": "added", "additions": 6, "deletions": 0, "changes": 6, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/1a15a91a0015208eafb797e4de1348c9877fd6d0/gcc%2Ftestsuite%2Fgcc.c-torture%2Fcompile%2Fpr103288-1.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/1a15a91a0015208eafb797e4de1348c9877fd6d0/gcc%2Ftestsuite%2Fgcc.c-torture%2Fcompile%2Fpr103288-1.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgcc.c-torture%2Fcompile%2Fpr103288-1.c?ref=1a15a91a0015208eafb797e4de1348c9877fd6d0", "patch": "@@ -0,0 +1,6 @@\n+\n+int ui_5;\n+long func_14_uli_8;\n+void func_14() {\n+        ui_5 &= (func_14_uli_8 ? 60 : ui_5) ? 5 : 0;\n+}"}, {"sha": "8984a5e15ab4cbc7689d22bb45bce4fd713958e1", "filename": "gcc/tree-ssa-phiopt.c", "status": "modified", "additions": 3, "deletions": 0, "changes": 3, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/1a15a91a0015208eafb797e4de1348c9877fd6d0/gcc%2Ftree-ssa-phiopt.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/1a15a91a0015208eafb797e4de1348c9877fd6d0/gcc%2Ftree-ssa-phiopt.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftree-ssa-phiopt.c?ref=1a15a91a0015208eafb797e4de1348c9877fd6d0", "patch": "@@ -1381,6 +1381,9 @@ value_replacement (basic_block cond_bb, basic_block middle_bb,\n \t}\n     }\n \n+  if (!single_pred_p (middle_bb))\n+    return 0;\n+\n   /* Now optimize (x != 0) ? x + y : y to just x + y.  */\n   gsi = gsi_last_nondebug_bb (middle_bb);\n   if (gsi_end_p (gsi))"}]}