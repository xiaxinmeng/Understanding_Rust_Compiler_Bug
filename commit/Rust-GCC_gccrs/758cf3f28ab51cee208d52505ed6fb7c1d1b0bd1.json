{"sha": "758cf3f28ab51cee208d52505ed6fb7c1d1b0bd1", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6NzU4Y2YzZjI4YWI1MWNlZTIwOGQ1MjUwNWVkNmZiN2MxZDFiMGJkMQ==", "commit": {"author": {"name": "Richard Guenther", "email": "rguenther@suse.de", "date": "2006-01-05T15:30:44Z"}, "committer": {"name": "Richard Biener", "email": "rguenth@gcc.gnu.org", "date": "2006-01-05T15:30:44Z"}, "message": "re PR tree-optimization/22555 (array in struct disables salias subvars for other fields)\n\n2006-01-05  Richard Guenther  <rguenther@suse.de>\n\n\tPR tree-optimization/22555\n\t* tree-ssa-alias.c (create_overlap_variables_for): Do not give up,\n\tif one structure field is an array.\n\t* tree-ssa-operands.c (get_expr_operands): Continue scanning\n\toperands even if we found a subvar, but ignore VOPs in this\n\tcase.\n\t* tree-ssa-loop-ivopts.c (rewrite_use): Mark new vars in stmt\n\tfor renaming.\n\t* tree-ssa-loop.c (pass_iv_optimize): Schedule TODO_update_ssa.\n\n\t* gcc.dg/tree-ssa/alias-3.c: New testcase.\n\nFrom-SVN: r109381", "tree": {"sha": "1be6d45ed8f38489c81824750e671fab251a6b5a", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/1be6d45ed8f38489c81824750e671fab251a6b5a"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/758cf3f28ab51cee208d52505ed6fb7c1d1b0bd1", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/758cf3f28ab51cee208d52505ed6fb7c1d1b0bd1", "html_url": "https://github.com/Rust-GCC/gccrs/commit/758cf3f28ab51cee208d52505ed6fb7c1d1b0bd1", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/758cf3f28ab51cee208d52505ed6fb7c1d1b0bd1/comments", "author": {"login": "rguenth", "id": 2046526, "node_id": "MDQ6VXNlcjIwNDY1MjY=", "avatar_url": "https://avatars.githubusercontent.com/u/2046526?v=4", "gravatar_id": "", "url": "https://api.github.com/users/rguenth", "html_url": "https://github.com/rguenth", "followers_url": "https://api.github.com/users/rguenth/followers", "following_url": "https://api.github.com/users/rguenth/following{/other_user}", "gists_url": "https://api.github.com/users/rguenth/gists{/gist_id}", "starred_url": "https://api.github.com/users/rguenth/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/rguenth/subscriptions", "organizations_url": "https://api.github.com/users/rguenth/orgs", "repos_url": "https://api.github.com/users/rguenth/repos", "events_url": "https://api.github.com/users/rguenth/events{/privacy}", "received_events_url": "https://api.github.com/users/rguenth/received_events", "type": "User", "site_admin": false}, "committer": null, "parents": [{"sha": "ad0926324df676c7e296d3a3e40c775d5a2b5716", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/ad0926324df676c7e296d3a3e40c775d5a2b5716", "html_url": "https://github.com/Rust-GCC/gccrs/commit/ad0926324df676c7e296d3a3e40c775d5a2b5716"}], "stats": {"total": 57, "additions": 51, "deletions": 6}, "files": [{"sha": "026dade34713197cb962cce8e34a617ffefd2be8", "filename": "gcc/ChangeLog", "status": "modified", "additions": 12, "deletions": 0, "changes": 12, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/758cf3f28ab51cee208d52505ed6fb7c1d1b0bd1/gcc%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/758cf3f28ab51cee208d52505ed6fb7c1d1b0bd1/gcc%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2FChangeLog?ref=758cf3f28ab51cee208d52505ed6fb7c1d1b0bd1", "patch": "@@ -1,3 +1,15 @@\n+2006-01-05  Richard Guenther  <rguenther@suse.de>\n+\n+\tPR tree-optimization/22555\n+\t* tree-ssa-alias.c (create_overlap_variables_for): Do not give up,\n+\tif one structure field is an array.\n+\t* tree-ssa-operands.c (get_expr_operands): Continue scanning\n+\toperands even if we found a subvar, but ignore VOPs in this\n+\tcase.\n+\t* tree-ssa-loop-ivopts.c (rewrite_use): Mark new vars in stmt\n+\tfor renaming.\n+\t* tree-ssa-loop.c (pass_iv_optimize): Schedule TODO_update_ssa.\n+\n 2006-01-05  Richard Earnshaw  <rearnsha@arm.com>\n \n \tPR middle-end/24998"}, {"sha": "640c92605e008c29ec2ba078158df7cb008607e2", "filename": "gcc/testsuite/ChangeLog", "status": "modified", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/758cf3f28ab51cee208d52505ed6fb7c1d1b0bd1/gcc%2Ftestsuite%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/758cf3f28ab51cee208d52505ed6fb7c1d1b0bd1/gcc%2Ftestsuite%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2FChangeLog?ref=758cf3f28ab51cee208d52505ed6fb7c1d1b0bd1", "patch": "@@ -1,3 +1,8 @@\n+2006-01-05  Richard Guenther  <rguenther@suse.de>\n+\n+\tPR tree-optimization/22555\n+\t* gcc.dg/tree-ssa/alias-3.c: New testcase.\n+\n 2006-01-05  Richard Guenther  <rguenther@suse.de>\n \t    Diego Novillo  <dnovillo@redhat.com>\n "}, {"sha": "3d8587da89bd161e832e759d5ae85aac248ba91b", "filename": "gcc/testsuite/gcc.dg/tree-ssa/alias-3.c", "status": "added", "additions": 20, "deletions": 0, "changes": 20, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/758cf3f28ab51cee208d52505ed6fb7c1d1b0bd1/gcc%2Ftestsuite%2Fgcc.dg%2Ftree-ssa%2Falias-3.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/758cf3f28ab51cee208d52505ed6fb7c1d1b0bd1/gcc%2Ftestsuite%2Fgcc.dg%2Ftree-ssa%2Falias-3.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgcc.dg%2Ftree-ssa%2Falias-3.c?ref=758cf3f28ab51cee208d52505ed6fb7c1d1b0bd1", "patch": "@@ -0,0 +1,20 @@\n+/* { dg-do compile } */\n+/* { dg-options \"-O2 -fdump-tree-optimized\" } */\n+\n+struct {\n+\tint i;\n+\tint j;\n+\tint x[2];\n+} a;\n+\n+int foo(void)\n+{\n+\ta.i = 1;\n+\ta.j = 0;\n+\ta.x[0] = 0;\n+\treturn a.i + a.j;\n+}\n+\n+/* { dg-final { scan-tree-dump \"return 1;\" \"optimized\" } } */\n+/* { dg-final { cleanup-tree-dump \"optimized\" } } */\n+"}, {"sha": "ee6a6e6a49ec34159b6c7493d1d0d93aa8343b9d", "filename": "gcc/tree-ssa-alias.c", "status": "modified", "additions": 0, "deletions": 1, "changes": 1, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/758cf3f28ab51cee208d52505ed6fb7c1d1b0bd1/gcc%2Ftree-ssa-alias.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/758cf3f28ab51cee208d52505ed6fb7c1d1b0bd1/gcc%2Ftree-ssa-alias.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftree-ssa-alias.c?ref=758cf3f28ab51cee208d52505ed6fb7c1d1b0bd1", "patch": "@@ -2580,7 +2580,6 @@ create_overlap_variables_for (tree var)\n \t{\n \t  if (!fo->size\n \t      || TREE_CODE (fo->size) != INTEGER_CST\n-\t      || TREE_CODE (fo->type) == ARRAY_TYPE\n \t      || fo->offset < 0)\n \t    {\n \t      notokay = true;"}, {"sha": "4c7d64560c9e0c90e4892de9f806c4f18401d68b", "filename": "gcc/tree-ssa-loop-ivopts.c", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/758cf3f28ab51cee208d52505ed6fb7c1d1b0bd1/gcc%2Ftree-ssa-loop-ivopts.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/758cf3f28ab51cee208d52505ed6fb7c1d1b0bd1/gcc%2Ftree-ssa-loop-ivopts.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftree-ssa-loop-ivopts.c?ref=758cf3f28ab51cee208d52505ed6fb7c1d1b0bd1", "patch": "@@ -5825,7 +5825,7 @@ rewrite_use (struct ivopts_data *data,\n       default:\n \tgcc_unreachable ();\n     }\n-  update_stmt (use->stmt);\n+  mark_new_vars_to_rename (use->stmt);\n }\n \n /* Rewrite the uses using the selected induction variables.  */"}, {"sha": "8565f255223addb667aca9f135394952e54f4144", "filename": "gcc/tree-ssa-loop.c", "status": "modified", "additions": 3, "deletions": 1, "changes": 4, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/758cf3f28ab51cee208d52505ed6fb7c1d1b0bd1/gcc%2Ftree-ssa-loop.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/758cf3f28ab51cee208d52505ed6fb7c1d1b0bd1/gcc%2Ftree-ssa-loop.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftree-ssa-loop.c?ref=758cf3f28ab51cee208d52505ed6fb7c1d1b0bd1", "patch": "@@ -432,7 +432,9 @@ struct tree_opt_pass pass_iv_optimize =\n   0,\t\t\t\t\t/* properties_provided */\n   0,\t\t\t\t\t/* properties_destroyed */\n   0,\t\t\t\t\t/* todo_flags_start */\n-  TODO_dump_func | TODO_verify_loops,\t/* todo_flags_finish */\n+  TODO_dump_func\n+  | TODO_verify_loops\n+  | TODO_update_ssa,\t\t\t/* todo_flags_finish */\n   0\t\t\t\t\t/* letter */\n };\n "}, {"sha": "b7319deffb2d20b88ed5c41a78e5de7bc0f98172", "filename": "gcc/tree-ssa-operands.c", "status": "modified", "additions": 10, "deletions": 3, "changes": 13, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/758cf3f28ab51cee208d52505ed6fb7c1d1b0bd1/gcc%2Ftree-ssa-operands.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/758cf3f28ab51cee208d52505ed6fb7c1d1b0bd1/gcc%2Ftree-ssa-operands.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftree-ssa-operands.c?ref=758cf3f28ab51cee208d52505ed6fb7c1d1b0bd1", "patch": "@@ -1126,6 +1126,7 @@ get_expr_operands (tree stmt, tree *expr_p, int flags)\n       {\n \ttree ref;\n \tHOST_WIDE_INT offset, size, maxsize;\n+\tbool none = true;\n  \t/* This component ref becomes an access to all of the subvariables\n \t   it can touch,  if we can determine that, but *NOT* the real one.\n \t   If we can't determine which fields we could touch, the recursion\n@@ -1143,16 +1144,22 @@ get_expr_operands (tree stmt, tree *expr_p, int flags)\n \t\tif (overlap_subvar (offset, maxsize, sv, &exact))\n \t\t  {\n \t            int subvar_flags = flags;\n+\t\t    none = false;\n \t\t    if (!exact\n \t\t\t|| size != maxsize)\n \t\t      subvar_flags &= ~opf_kill_def;\n \t\t    add_stmt_operand (&sv->var, s_ann, subvar_flags);\n \t\t  }\n \t      }\n+\t    if (!none)\n+\t      flags |= opf_no_vops;\n \t  }\n-\telse\n-\t  get_expr_operands (stmt, &TREE_OPERAND (expr, 0), \n-\t\t\t     flags & ~opf_kill_def);\n+\n+\t/* Even if we found subvars above we need to ensure to see\n+\t   immediate uses for d in s.a[d].  In case of s.a having\n+\t   a subvar we'd miss it otherwise.  */\n+\tget_expr_operands (stmt, &TREE_OPERAND (expr, 0), \n+\t\t\t   flags & ~opf_kill_def);\n \t\n \tif (code == COMPONENT_REF)\n \t  {"}]}