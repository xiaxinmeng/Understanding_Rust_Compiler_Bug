{"sha": "2e43880dbd4cb9722ae99708c01c399f985dc7c3", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6MmU0Mzg4MGRiZDRjYjk3MjJhZTk5NzA4YzAxYzM5OWY5ODVkYzdjMw==", "commit": {"author": {"name": "Jakub Jelinek", "email": "jakub@redhat.com", "date": "2021-01-18T10:28:17Z"}, "committer": {"name": "Jakub Jelinek", "email": "jakub@redhat.com", "date": "2021-01-18T10:29:26Z"}, "message": "libstd++: : Add workaround for as Error: file number less than one error [PR98708]\n\nAs mentioned in the PR, since the switch to DWARF5 by default instead of\nDWARF4, gcc fails to build when configured against recent binutils.\n\nThe problem is that cxx11-ios_failure* is built in separate steps,\n-S compilation (with -g -O2) followed by some sed and followed by\n-c -g -O2 -g0 assembly.  When gcc is configured against recent binutils\nand DWARF5 is the default, we emit .file 0 \"...\" directive on which the\nassembler then fails (unless --gdwarf-5 is passed to it, but we don't want\nthat generally because on the other side older assemblers don't like -g*\npassed to it when invoked on *.s file with compiler generated debug info.\n\nI hope the bug will be fixed soon on the binutils side, but it would be nice\nto have a workaround.\n\nThe following patch is one of the possibilities, another one is to do that\nbut add configure check for whether it is needed,\nessentially\necho 'int main () { return 0; }' > conftest.c\n${CXX} ${CXXFLAGS} -g -O2 -S conftest.c -o conftest.s\n${CXX} ${CXXFLAGS} -g -O2 -g0 -c conftest.s -o conftest.o\nand if the last command fails, we need that -gno-as-loc-support.\nOr yet another option would be I think do a different check, whether\n${CXX} ${CXXFLAGS} -g -O2 -S conftest.c -o conftest.s\n${CXX} ${CXXFLAGS} -g -O2 -c conftest.s -o conftest.o\nworks and if yes, don't add the -g0 to cxx11-ios_failure*.s assembly.\n\n2021-01-18  Jakub Jelinek  <jakub@redhat.com>\n\n\tPR debug/98708\n\t* src/c++11/Makefile.am (cxx11-ios_failure-lt.s, cxx11-ios_failure.s):\n\tCompile with -gno-as-loc-support.\n\t* src/c++11/Makefile.in: Regenerated.", "tree": {"sha": "946af3257ca35779b5f1e5dbdb2b3a03ad69fa3b", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/946af3257ca35779b5f1e5dbdb2b3a03ad69fa3b"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/2e43880dbd4cb9722ae99708c01c399f985dc7c3", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/2e43880dbd4cb9722ae99708c01c399f985dc7c3", "html_url": "https://github.com/Rust-GCC/gccrs/commit/2e43880dbd4cb9722ae99708c01c399f985dc7c3", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/2e43880dbd4cb9722ae99708c01c399f985dc7c3/comments", "author": {"login": "jakubjelinek", "id": 9370665, "node_id": "MDQ6VXNlcjkzNzA2NjU=", "avatar_url": "https://avatars.githubusercontent.com/u/9370665?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jakubjelinek", "html_url": "https://github.com/jakubjelinek", "followers_url": "https://api.github.com/users/jakubjelinek/followers", "following_url": "https://api.github.com/users/jakubjelinek/following{/other_user}", "gists_url": "https://api.github.com/users/jakubjelinek/gists{/gist_id}", "starred_url": "https://api.github.com/users/jakubjelinek/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jakubjelinek/subscriptions", "organizations_url": "https://api.github.com/users/jakubjelinek/orgs", "repos_url": "https://api.github.com/users/jakubjelinek/repos", "events_url": "https://api.github.com/users/jakubjelinek/events{/privacy}", "received_events_url": "https://api.github.com/users/jakubjelinek/received_events", "type": "User", "site_admin": false}, "committer": {"login": "jakubjelinek", "id": 9370665, "node_id": "MDQ6VXNlcjkzNzA2NjU=", "avatar_url": "https://avatars.githubusercontent.com/u/9370665?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jakubjelinek", "html_url": "https://github.com/jakubjelinek", "followers_url": "https://api.github.com/users/jakubjelinek/followers", "following_url": "https://api.github.com/users/jakubjelinek/following{/other_user}", "gists_url": "https://api.github.com/users/jakubjelinek/gists{/gist_id}", "starred_url": "https://api.github.com/users/jakubjelinek/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jakubjelinek/subscriptions", "organizations_url": "https://api.github.com/users/jakubjelinek/orgs", "repos_url": "https://api.github.com/users/jakubjelinek/repos", "events_url": "https://api.github.com/users/jakubjelinek/events{/privacy}", "received_events_url": "https://api.github.com/users/jakubjelinek/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "0f951b3dd34b355579b4c9a9e287d32ac771bc67", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/0f951b3dd34b355579b4c9a9e287d32ac771bc67", "html_url": "https://github.com/Rust-GCC/gccrs/commit/0f951b3dd34b355579b4c9a9e287d32ac771bc67"}], "stats": {"total": 8, "additions": 4, "deletions": 4}, "files": [{"sha": "a26903db6bcc2bdf1217aaf69f098b0d7bedaaaa", "filename": "libstdc++-v3/src/c++11/Makefile.am", "status": "modified", "additions": 2, "deletions": 2, "changes": 4, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/2e43880dbd4cb9722ae99708c01c399f985dc7c3/libstdc%2B%2B-v3%2Fsrc%2Fc%2B%2B11%2FMakefile.am", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/2e43880dbd4cb9722ae99708c01c399f985dc7c3/libstdc%2B%2B-v3%2Fsrc%2Fc%2B%2B11%2FMakefile.am", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libstdc%2B%2B-v3%2Fsrc%2Fc%2B%2B11%2FMakefile.am?ref=2e43880dbd4cb9722ae99708c01c399f985dc7c3", "patch": "@@ -141,12 +141,12 @@ if ENABLE_DUAL_ABI\n rewrite_ios_failure_typeinfo = sed -e '/^_*_ZTISt13__ios_failure:/,/_ZTVN10__cxxabiv120__si_class_type_infoE/s/_ZTVN10__cxxabiv120__si_class_type_infoE/_ZTVSt19__iosfail_type_info/'\n \n cxx11-ios_failure-lt.s: cxx11-ios_failure.cc\n-\t$(LTCXXCOMPILE) -S $< -o tmp-cxx11-ios_failure-lt.s\n+\t$(LTCXXCOMPILE) -gno-as-loc-support -S $< -o tmp-cxx11-ios_failure-lt.s\n \t-test -f tmp-cxx11-ios_failure-lt.o && mv -f tmp-cxx11-ios_failure-lt.o tmp-cxx11-ios_failure-lt.s\n \t$(rewrite_ios_failure_typeinfo) tmp-$@ > $@\n \t-rm -f tmp-$@\n cxx11-ios_failure.s: cxx11-ios_failure.cc\n-\t$(CXXCOMPILE) -S $< -o tmp-$@\n+\t$(CXXCOMPILE) -gno-as-loc-support -S $< -o tmp-$@\n \t$(rewrite_ios_failure_typeinfo) tmp-$@ > $@\n \t-rm -f tmp-$@\n "}, {"sha": "86540509e81a9fa642e0f95a145c38412f6f2bc3", "filename": "libstdc++-v3/src/c++11/Makefile.in", "status": "modified", "additions": 2, "deletions": 2, "changes": 4, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/2e43880dbd4cb9722ae99708c01c399f985dc7c3/libstdc%2B%2B-v3%2Fsrc%2Fc%2B%2B11%2FMakefile.in", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/2e43880dbd4cb9722ae99708c01c399f985dc7c3/libstdc%2B%2B-v3%2Fsrc%2Fc%2B%2B11%2FMakefile.in", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libstdc%2B%2B-v3%2Fsrc%2Fc%2B%2B11%2FMakefile.in?ref=2e43880dbd4cb9722ae99708c01c399f985dc7c3", "patch": "@@ -852,12 +852,12 @@ limits.o: limits.cc\n \t$(CXXCOMPILE) -fchar8_t -c $<\n \n @ENABLE_DUAL_ABI_TRUE@cxx11-ios_failure-lt.s: cxx11-ios_failure.cc\n-@ENABLE_DUAL_ABI_TRUE@\t$(LTCXXCOMPILE) -S $< -o tmp-cxx11-ios_failure-lt.s\n+@ENABLE_DUAL_ABI_TRUE@\t$(LTCXXCOMPILE) -gno-as-loc-support -S $< -o tmp-cxx11-ios_failure-lt.s\n @ENABLE_DUAL_ABI_TRUE@\t-test -f tmp-cxx11-ios_failure-lt.o && mv -f tmp-cxx11-ios_failure-lt.o tmp-cxx11-ios_failure-lt.s\n @ENABLE_DUAL_ABI_TRUE@\t$(rewrite_ios_failure_typeinfo) tmp-$@ > $@\n @ENABLE_DUAL_ABI_TRUE@\t-rm -f tmp-$@\n @ENABLE_DUAL_ABI_TRUE@cxx11-ios_failure.s: cxx11-ios_failure.cc\n-@ENABLE_DUAL_ABI_TRUE@\t$(CXXCOMPILE) -S $< -o tmp-$@\n+@ENABLE_DUAL_ABI_TRUE@\t$(CXXCOMPILE) -gno-as-loc-support -S $< -o tmp-$@\n @ENABLE_DUAL_ABI_TRUE@\t$(rewrite_ios_failure_typeinfo) tmp-$@ > $@\n @ENABLE_DUAL_ABI_TRUE@\t-rm -f tmp-$@\n "}]}