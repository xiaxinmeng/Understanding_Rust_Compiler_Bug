{"sha": "dff125ebb56f4b21a5b40d3aa6f9ccb7446cbdb4", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6ZGZmMTI1ZWJiNTZmNGIyMWE1YjQwZDNhYTZmOWNjYjc0NDZjYmRiNA==", "commit": {"author": {"name": "Segher Boessenkool", "email": "segher@kernel.crashing.org", "date": "2017-12-02T01:20:08Z"}, "committer": {"name": "Segher Boessenkool", "email": "segher@gcc.gnu.org", "date": "2017-12-02T01:20:08Z"}, "message": "final: Improve output for -dp and -fverbose-asm\n\nThis improves the assembler output (for -dp and -fverbose-asm) in\nseveral ways.  It always prints the insn_cost.  It does not print\n\"[length = NN]\" but \"[c=NN l=NN]\", to save space.  It does not add one\nto the instruction alternative number (everything else starts counting\nthose at 0, too).  And finally, it tries to keep things lined up in\ncolumns a bit better.\n\n\n\t* final.c (output_asm_name): Print insn_cost.  Shorten output.  Print\n\twhich_alternative instead of which_alternative + 1.\n\t(output_asm_insn): Print an extra tab if the template is short.\n\nFrom-SVN: r255348", "tree": {"sha": "31d87e26d2663969fcd7eb48c0074ac4c2123afc", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/31d87e26d2663969fcd7eb48c0074ac4c2123afc"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/dff125ebb56f4b21a5b40d3aa6f9ccb7446cbdb4", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/dff125ebb56f4b21a5b40d3aa6f9ccb7446cbdb4", "html_url": "https://github.com/Rust-GCC/gccrs/commit/dff125ebb56f4b21a5b40d3aa6f9ccb7446cbdb4", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/dff125ebb56f4b21a5b40d3aa6f9ccb7446cbdb4/comments", "author": {"login": "segher", "id": 417629, "node_id": "MDQ6VXNlcjQxNzYyOQ==", "avatar_url": "https://avatars.githubusercontent.com/u/417629?v=4", "gravatar_id": "", "url": "https://api.github.com/users/segher", "html_url": "https://github.com/segher", "followers_url": "https://api.github.com/users/segher/followers", "following_url": "https://api.github.com/users/segher/following{/other_user}", "gists_url": "https://api.github.com/users/segher/gists{/gist_id}", "starred_url": "https://api.github.com/users/segher/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/segher/subscriptions", "organizations_url": "https://api.github.com/users/segher/orgs", "repos_url": "https://api.github.com/users/segher/repos", "events_url": "https://api.github.com/users/segher/events{/privacy}", "received_events_url": "https://api.github.com/users/segher/received_events", "type": "User", "site_admin": false}, "committer": null, "parents": [{"sha": "79c9f76563e0c0943c9dc44bd1b892175c3239b9", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/79c9f76563e0c0943c9dc44bd1b892175c3239b9", "html_url": "https://github.com/Rust-GCC/gccrs/commit/79c9f76563e0c0943c9dc44bd1b892175c3239b9"}], "stats": {"total": 28, "additions": 21, "deletions": 7}, "files": [{"sha": "11ccbfb91c25c5ebb9bdc28c648a0fb501c14459", "filename": "gcc/ChangeLog", "status": "modified", "additions": 6, "deletions": 0, "changes": 6, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/dff125ebb56f4b21a5b40d3aa6f9ccb7446cbdb4/gcc%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/dff125ebb56f4b21a5b40d3aa6f9ccb7446cbdb4/gcc%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2FChangeLog?ref=dff125ebb56f4b21a5b40d3aa6f9ccb7446cbdb4", "patch": "@@ -1,3 +1,9 @@\n+2017-12-01  Segher Boessenkool  <segher@kernel.crashing.org>\n+\n+\t* final.c (output_asm_name): Print insn_cost.  Shorten output.  Print\n+\twhich_alternative instead of which_alternative + 1.\n+\t(output_asm_insn): Print an extra tab if the template is short.\n+\n 2017-12-01  Jim Wilson  <jimw@sifive.com>\n \n \t* common.opt (use_gnu_debug_info_extensions): Delete DWARF_DEBUG from"}, {"sha": "afb6906997dabac361dab578e973a3978c1551f1", "filename": "gcc/final.c", "status": "modified", "additions": 15, "deletions": 7, "changes": 22, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/dff125ebb56f4b21a5b40d3aa6f9ccb7446cbdb4/gcc%2Ffinal.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/dff125ebb56f4b21a5b40d3aa6f9ccb7446cbdb4/gcc%2Ffinal.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ffinal.c?ref=dff125ebb56f4b21a5b40d3aa6f9ccb7446cbdb4", "patch": "@@ -3469,16 +3469,20 @@ output_asm_name (void)\n {\n   if (debug_insn)\n     {\n-      int num = INSN_CODE (debug_insn);\n-      fprintf (asm_out_file, \"\\t%s %d\\t%s\",\n-\t       ASM_COMMENT_START, INSN_UID (debug_insn),\n-\t       insn_data[num].name);\n-      if (insn_data[num].n_alternatives > 1)\n-\tfprintf (asm_out_file, \"/%d\", which_alternative + 1);\n+      fprintf (asm_out_file, \"\\t%s %d\\t\",\n+\t       ASM_COMMENT_START, INSN_UID (debug_insn));\n \n+      fprintf (asm_out_file, \"[c=%d\",\n+\t       insn_cost (debug_insn, optimize_insn_for_speed_p ()));\n       if (HAVE_ATTR_length)\n-\tfprintf (asm_out_file, \"\\t[length = %d]\",\n+\tfprintf (asm_out_file, \" l=%d\",\n \t\t get_attr_length (debug_insn));\n+      fprintf (asm_out_file, \"]  \");\n+\n+      int num = INSN_CODE (debug_insn);\n+      fprintf (asm_out_file, \"%s\", insn_data[num].name);\n+      if (insn_data[num].n_alternatives > 1)\n+\tfprintf (asm_out_file, \"/%d\", which_alternative);\n \n       /* Clear this so only the first assembler insn\n \t of any rtl insn will get the special comment for -dp.  */\n@@ -3824,6 +3828,10 @@ output_asm_insn (const char *templ, rtx *operands)\n \tputc (c, asm_out_file);\n       }\n \n+  /* Try to keep the asm a bit more readable.  */\n+  if ((flag_verbose_asm || flag_print_asm_name) && strlen (templ) < 9)\n+    putc ('\\t', asm_out_file);\n+\n   /* Write out the variable names for operands, if we know them.  */\n   if (flag_verbose_asm)\n     output_asm_operand_names (operands, oporder, ops);"}]}