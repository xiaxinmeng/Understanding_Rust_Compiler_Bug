{"sha": "50b56799f728d43ffa0fc941bf6757908bc76f46", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6NTBiNTY3OTlmNzI4ZDQzZmZhMGZjOTQxYmY2NzU3OTA4YmM3NmY0Ng==", "commit": {"author": {"name": "Mark Mitchell", "email": "mark@codesourcery.com", "date": "2005-12-03T01:02:33Z"}, "committer": {"name": "Mark Mitchell", "email": "mmitchel@gcc.gnu.org", "date": "2005-12-03T01:02:33Z"}, "message": "re PR c++/24173 (ICE with garbage collection)\n\n\tPR c++/24173\n\t* decl.c (duplicate_decls): Don't rely on DECL_TEMPLATE_INFO after\n\tclobbering newdecl.\n\tPR c++/24173\n\t* g++.dg/template/friend40.C: New test.\n\nFrom-SVN: r107983", "tree": {"sha": "490c2963de08fb5bab58a5be8baff8aaef7160b7", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/490c2963de08fb5bab58a5be8baff8aaef7160b7"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/50b56799f728d43ffa0fc941bf6757908bc76f46", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/50b56799f728d43ffa0fc941bf6757908bc76f46", "html_url": "https://github.com/Rust-GCC/gccrs/commit/50b56799f728d43ffa0fc941bf6757908bc76f46", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/50b56799f728d43ffa0fc941bf6757908bc76f46/comments", "author": null, "committer": null, "parents": [{"sha": "0889ab4a1a25a1a4e16ba5c09142acf8ace42a76", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/0889ab4a1a25a1a4e16ba5c09142acf8ace42a76", "html_url": "https://github.com/Rust-GCC/gccrs/commit/0889ab4a1a25a1a4e16ba5c09142acf8ace42a76"}], "stats": {"total": 35, "additions": 33, "deletions": 2}, "files": [{"sha": "b2b30097ac75e99c9e8176c56d2eafb2558cb29a", "filename": "gcc/cp/ChangeLog", "status": "modified", "additions": 6, "deletions": 0, "changes": 6, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/50b56799f728d43ffa0fc941bf6757908bc76f46/gcc%2Fcp%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/50b56799f728d43ffa0fc941bf6757908bc76f46/gcc%2Fcp%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fcp%2FChangeLog?ref=50b56799f728d43ffa0fc941bf6757908bc76f46", "patch": "@@ -1,3 +1,9 @@\n+2005-12-02  Mark Mitchell  <mark@codesourcery.com>\n+\n+\tPR c++/24173\n+\t* decl.c (duplicate_decls): Don't rely on DECL_TEMPLATE_INFO after\n+\tclobbering newdecl.\n+\n 2005-12-02  Richard Guenther  <rguenther@suse.de>\n \n \t* semantics.c (simplify_aggr_init_expr): Use buildN instead"}, {"sha": "ca2e221d0f40f54620196220d2b86c3f56002ee1", "filename": "gcc/cp/decl.c", "status": "modified", "additions": 6, "deletions": 2, "changes": 8, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/50b56799f728d43ffa0fc941bf6757908bc76f46/gcc%2Fcp%2Fdecl.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/50b56799f728d43ffa0fc941bf6757908bc76f46/gcc%2Fcp%2Fdecl.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fcp%2Fdecl.c?ref=50b56799f728d43ffa0fc941bf6757908bc76f46", "patch": "@@ -1054,6 +1054,7 @@ duplicate_decls (tree newdecl, tree olddecl, bool newdecl_is_friend)\n   unsigned olddecl_uid = DECL_UID (olddecl);\n   int olddecl_friend = 0, types_match = 0, hidden_friend = 0;\n   int new_defines_function = 0;\n+  tree new_template;\n \n   if (newdecl == olddecl)\n     return olddecl;\n@@ -1690,6 +1691,7 @@ duplicate_decls (tree newdecl, tree olddecl, bool newdecl_is_friend)\n   if (! DECL_EXTERNAL (olddecl))\n     DECL_EXTERNAL (newdecl) = 0;\n \n+  new_template = NULL_TREE;\n   if (DECL_LANG_SPECIFIC (newdecl) && DECL_LANG_SPECIFIC (olddecl))\n     {\n       DECL_INTERFACE_KNOWN (newdecl) |= DECL_INTERFACE_KNOWN (olddecl);\n@@ -1712,6 +1714,8 @@ duplicate_decls (tree newdecl, tree olddecl, bool newdecl_is_friend)\n \tDECL_LANG_SPECIFIC (olddecl)->decl_flags.u2;\n       DECL_NONCONVERTING_P (newdecl) = DECL_NONCONVERTING_P (olddecl);\n       DECL_REPO_AVAILABLE_P (newdecl) = DECL_REPO_AVAILABLE_P (olddecl);\n+      if (DECL_TEMPLATE_INFO (newdecl))\n+\tnew_template = DECL_TI_TEMPLATE (newdecl);\n       DECL_TEMPLATE_INFO (newdecl) = DECL_TEMPLATE_INFO (olddecl);\n       DECL_INITIALIZED_IN_CLASS_P (newdecl)\n \t|= DECL_INITIALIZED_IN_CLASS_P (olddecl);\n@@ -1873,7 +1877,7 @@ duplicate_decls (tree newdecl, tree olddecl, bool newdecl_is_friend)\n       memcpy ((char *) olddecl + sizeof (struct tree_decl_common),\n \t      (char *) newdecl + sizeof (struct tree_decl_common),\n \t      sizeof (struct tree_function_decl) - sizeof (struct tree_decl_common));\n-      if (DECL_TEMPLATE_INFO (newdecl))\n+      if (new_template)\n \t/* If newdecl is a template instantiation, it is possible that\n \t   the following sequence of events has occurred:\n \n@@ -1896,7 +1900,7 @@ duplicate_decls (tree newdecl, tree olddecl, bool newdecl_is_friend)\n \t   instantiations so that if we try to do the instantiation\n \t   again we won't get the clobbered declaration.  */\n \treregister_specialization (newdecl,\n-\t\t\t\t   DECL_TI_TEMPLATE (newdecl),\n+\t\t\t\t   new_template,\n \t\t\t\t   olddecl);\n     }\n   else"}, {"sha": "415cd85679c7e8570dd50870adc031184cd8bc90", "filename": "gcc/testsuite/ChangeLog", "status": "modified", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/50b56799f728d43ffa0fc941bf6757908bc76f46/gcc%2Ftestsuite%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/50b56799f728d43ffa0fc941bf6757908bc76f46/gcc%2Ftestsuite%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2FChangeLog?ref=50b56799f728d43ffa0fc941bf6757908bc76f46", "patch": "@@ -1,3 +1,8 @@\n+2005-12-02  Mark Mitchell  <mark@codesourcery.com>\n+\n+\tPR c++/24173\n+\t* g++.dg/template/friend40.C: New test.\n+\t\n 2005-12-02  Jakub Jelinek  <jakub@redhat.com>\n \n \tPR target/25199"}, {"sha": "39dd994e9d18904b4330ac54fdc7a18fe041bcb4", "filename": "gcc/testsuite/g++.dg/template/friend40.C", "status": "added", "additions": 16, "deletions": 0, "changes": 16, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/50b56799f728d43ffa0fc941bf6757908bc76f46/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Ftemplate%2Ffriend40.C", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/50b56799f728d43ffa0fc941bf6757908bc76f46/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Ftemplate%2Ffriend40.C", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Ftemplate%2Ffriend40.C?ref=50b56799f728d43ffa0fc941bf6757908bc76f46", "patch": "@@ -0,0 +1,16 @@\n+// PR c++/24173\n+// { dg-options \"--param ggc-min-expand=0 --param ggc-min-heapsize=0\" }\n+\n+template <int> struct A;\n+\n+void foo(A<0>);\n+\n+template<int> struct A\n+{\n+  friend void foo(A<0>);\n+};\n+\n+void bar()\n+{\n+  foo(A<0>());\n+}"}]}