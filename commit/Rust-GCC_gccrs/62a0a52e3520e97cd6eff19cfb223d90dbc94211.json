{"sha": "62a0a52e3520e97cd6eff19cfb223d90dbc94211", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6NjJhMGE1MmUzNTIwZTk3Y2Q2ZWZmMTljZmIyMjNkOTBkYmM5NDIxMQ==", "commit": {"author": {"name": "Jan Hubicka", "email": "jh@suse.cz", "date": "2009-11-11T23:45:09Z"}, "committer": {"name": "Jan Hubicka", "email": "hubicka@gcc.gnu.org", "date": "2009-11-11T23:45:09Z"}, "message": "re PR middle-end/41729 (Undefined reference with -fPIC -fwhole-program -flto)\n\n\n\tPR middle-end/41729\n\t* ipa.c (function_and_variable_visibility): Do not privatize COMDAT\n\tand WEAK variables at -fwhole-program.\n\n\tPR middle-end/41735\n\t* ipa.c (whole_program_function_and_variable_visility): COMDAT\n\tfunctions/variables are not needed even if they are externally visible.\n\nFrom-SVN: r154108", "tree": {"sha": "88ca223a07a028e0c9a49394506c73c5de5d0d5a", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/88ca223a07a028e0c9a49394506c73c5de5d0d5a"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/62a0a52e3520e97cd6eff19cfb223d90dbc94211", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/62a0a52e3520e97cd6eff19cfb223d90dbc94211", "html_url": "https://github.com/Rust-GCC/gccrs/commit/62a0a52e3520e97cd6eff19cfb223d90dbc94211", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/62a0a52e3520e97cd6eff19cfb223d90dbc94211/comments", "author": null, "committer": null, "parents": [{"sha": "ef2bbc8c9ae52d39b509cb8687c093e7617fdda3", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/ef2bbc8c9ae52d39b509cb8687c093e7617fdda3", "html_url": "https://github.com/Rust-GCC/gccrs/commit/ef2bbc8c9ae52d39b509cb8687c093e7617fdda3"}], "stats": {"total": 20, "additions": 18, "deletions": 2}, "files": [{"sha": "8c9e6e5b55e6d0c756457d5fc5b391c15a400327", "filename": "gcc/ChangeLog", "status": "modified", "additions": 10, "deletions": 0, "changes": 10, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/62a0a52e3520e97cd6eff19cfb223d90dbc94211/gcc%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/62a0a52e3520e97cd6eff19cfb223d90dbc94211/gcc%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2FChangeLog?ref=62a0a52e3520e97cd6eff19cfb223d90dbc94211", "patch": "@@ -1,3 +1,13 @@\n+2009-11-11  Jan Hubicka  <jh@suse.cz>\n+\n+\tPR middle-end/41729\n+\t* ipa.c (function_and_variable_visibility): Do not privatize COMDAT\n+\tand WEAK variables at -fwhole-program.\n+\n+\tPR middle-end/41735\n+\t* ipa.c (whole_program_function_and_variable_visility): COMDAT\n+\tfunctions/variables are not needed even if they are externally visible.\n+\n 2009-11-11  Jan Hubicka  <jh@suse.cz>\n \n \t(patch by Richard Guenther)"}, {"sha": "1e5f22c8bf439750d66dcfd8c692820072369340", "filename": "gcc/ipa.c", "status": "modified", "additions": 8, "deletions": 2, "changes": 10, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/62a0a52e3520e97cd6eff19cfb223d90dbc94211/gcc%2Fipa.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/62a0a52e3520e97cd6eff19cfb223d90dbc94211/gcc%2Fipa.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fipa.c?ref=62a0a52e3520e97cd6eff19cfb223d90dbc94211", "patch": "@@ -319,6 +319,11 @@ function_and_variable_visibility (bool whole_program)\n       if (vnode->needed\n \t  && (DECL_COMDAT (vnode->decl) || TREE_PUBLIC (vnode->decl))\n \t  && (!whole_program\n+\t      /* We can privatize comdat readonly variables whose address is not taken,\n+\t         but doing so is not going to bring us optimization oppurtunities until\n+\t         we start reordering datastructures.  */\n+\t      || DECL_COMDAT (vnode->decl)\n+\t      || DECL_WEAK (vnode->decl)\n \t      || lookup_attribute (\"externally_visible\",\n \t\t\t\t   DECL_ATTRIBUTES (vnode->decl))))\n \tvnode->externally_visible = true;\n@@ -396,10 +401,11 @@ whole_program_function_and_variable_visibility (void)\n   function_and_variable_visibility (flag_whole_program);\n \n   for (node = cgraph_nodes; node; node = node->next)\n-    if (node->local.externally_visible && node->local.finalized)\n+    if ((node->local.externally_visible && !DECL_COMDAT (node->decl))\n+        && node->local.finalized)\n       cgraph_mark_needed_node (node);\n   for (vnode = varpool_nodes_queue; vnode; vnode = vnode->next_needed)\n-    if (vnode->externally_visible)\n+    if (vnode->externally_visible && !DECL_COMDAT (vnode->decl))\n       varpool_mark_needed_node (vnode);\n   return 0;\n }"}]}