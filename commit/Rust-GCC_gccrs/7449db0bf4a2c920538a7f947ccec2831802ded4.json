{"sha": "7449db0bf4a2c920538a7f947ccec2831802ded4", "node_id": "C_kwDOANBUbNoAKDc0NDlkYjBiZjRhMmM5MjA1MzhhN2Y5NDdjY2VjMjgzMTgwMmRlZDQ", "commit": {"author": {"name": "Arnaud Charlet", "email": "charlet@adacore.com", "date": "2022-07-19T14:58:44Z"}, "committer": {"name": "Marc Poulhi\u00e8s", "email": "poulhies@adacore.com", "date": "2022-09-05T07:21:03Z"}, "message": "[Ada] Secondary stack and i-c*\n\nExtend the previous changes related to Ada.Tags trigerring a\ndependency on the secondary stack to various i-c* packages.\n\ngcc/ada/\n\n\t* ali.adb (Scan_ALI): Special case i-c*.ali when setting\n\tSec_Stack_Used.", "tree": {"sha": "05b6a441733d647142b5b20bb188f57216aff553", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/05b6a441733d647142b5b20bb188f57216aff553"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/7449db0bf4a2c920538a7f947ccec2831802ded4", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/7449db0bf4a2c920538a7f947ccec2831802ded4", "html_url": "https://github.com/Rust-GCC/gccrs/commit/7449db0bf4a2c920538a7f947ccec2831802ded4", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/7449db0bf4a2c920538a7f947ccec2831802ded4/comments", "author": {"login": "ArnaudCharlet", "id": 30291825, "node_id": "MDQ6VXNlcjMwMjkxODI1", "avatar_url": "https://avatars.githubusercontent.com/u/30291825?v=4", "gravatar_id": "", "url": "https://api.github.com/users/ArnaudCharlet", "html_url": "https://github.com/ArnaudCharlet", "followers_url": "https://api.github.com/users/ArnaudCharlet/followers", "following_url": "https://api.github.com/users/ArnaudCharlet/following{/other_user}", "gists_url": "https://api.github.com/users/ArnaudCharlet/gists{/gist_id}", "starred_url": "https://api.github.com/users/ArnaudCharlet/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/ArnaudCharlet/subscriptions", "organizations_url": "https://api.github.com/users/ArnaudCharlet/orgs", "repos_url": "https://api.github.com/users/ArnaudCharlet/repos", "events_url": "https://api.github.com/users/ArnaudCharlet/events{/privacy}", "received_events_url": "https://api.github.com/users/ArnaudCharlet/received_events", "type": "User", "site_admin": false}, "committer": {"login": "dkm", "id": 87603, "node_id": "MDQ6VXNlcjg3NjAz", "avatar_url": "https://avatars.githubusercontent.com/u/87603?v=4", "gravatar_id": "", "url": "https://api.github.com/users/dkm", "html_url": "https://github.com/dkm", "followers_url": "https://api.github.com/users/dkm/followers", "following_url": "https://api.github.com/users/dkm/following{/other_user}", "gists_url": "https://api.github.com/users/dkm/gists{/gist_id}", "starred_url": "https://api.github.com/users/dkm/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/dkm/subscriptions", "organizations_url": "https://api.github.com/users/dkm/orgs", "repos_url": "https://api.github.com/users/dkm/repos", "events_url": "https://api.github.com/users/dkm/events{/privacy}", "received_events_url": "https://api.github.com/users/dkm/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "a0998ca3add191e76f151e541fc18a6d9dd5a1f0", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/a0998ca3add191e76f151e541fc18a6d9dd5a1f0", "html_url": "https://github.com/Rust-GCC/gccrs/commit/a0998ca3add191e76f151e541fc18a6d9dd5a1f0"}], "stats": {"total": 19, "additions": 14, "deletions": 5}, "files": [{"sha": "3febd48104895875804217a420e73ac3e07b7ae1", "filename": "gcc/ada/ali.adb", "status": "modified", "additions": 14, "deletions": 5, "changes": 19, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/7449db0bf4a2c920538a7f947ccec2831802ded4/gcc%2Fada%2Fali.adb", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/7449db0bf4a2c920538a7f947ccec2831802ded4/gcc%2Fada%2Fali.adb", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fada%2Fali.adb?ref=7449db0bf4a2c920538a7f947ccec2831802ded4", "patch": "@@ -2079,15 +2079,24 @@ package body ALI is\n                --  Processing for SS\n \n                elsif C = 'S' then\n-                  --  Special case: a-tags.ali by itself should not set\n+                  --  Special case: a-tags/i-c* by themselves should not set\n                   --  Sec_Stack_Used, only if other code uses the secondary\n                   --  stack should we set this flag. This ensures that we do\n                   --  not bring the secondary stack unnecessarily when using\n-                  --  Ada.Tags and not actually using the secondary stack.\n+                  --  one of these packages and not actually using the\n+                  --  secondary stack.\n \n-                  if Get_Name_String (F) /= \"a-tags.ali\" then\n-                     Opt.Sec_Stack_Used := True;\n-                  end if;\n+                  declare\n+                     File : constant String := Get_Name_String (F);\n+                  begin\n+                     if File /= \"a-tags.ali\"\n+                       and then File /= \"i-c.ali\"\n+                       and then File /= \"i-cstrin.ali\"\n+                       and then File /= \"i-cpoint.ali\"\n+                     then\n+                        Opt.Sec_Stack_Used := True;\n+                     end if;\n+                  end;\n \n                --  Invalid switch starting with S\n "}]}