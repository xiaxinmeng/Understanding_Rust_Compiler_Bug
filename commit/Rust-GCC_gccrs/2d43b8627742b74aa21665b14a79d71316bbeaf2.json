{"sha": "2d43b8627742b74aa21665b14a79d71316bbeaf2", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6MmQ0M2I4NjI3NzQyYjc0YWEyMTY2NWIxNGE3OWQ3MTMxNmJiZWFmMg==", "commit": {"author": {"name": "Tom de Vries", "email": "tdevries@suse.de", "date": "2018-07-01T14:56:09Z"}, "committer": {"name": "Tom de Vries", "email": "vries@gcc.gnu.org", "date": "2018-07-01T14:56:09Z"}, "message": "[testsuite] Fix get-absolute-line error handling\n\n2018-07-01  Tom de Vries  <tdevries@suse.de>\n\n\t* gcc.dg-selftests/dg-final.exp (verify_call_1): Factor out of ...\n\t(verify_call): ... here.  Move to toplevel.\n\t(verify_call_np, dg_final_directive_check_utils): New proc.\n\t(toplevel): Call dg_final_directive_check_utils.\n\t* lib/gcc-dg.exp (get-absolute-line): Fix typo in variable reference.\n\nFrom-SVN: r262284", "tree": {"sha": "2fb550520a39f4564318b399860d9e35d3e3c940", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/2fb550520a39f4564318b399860d9e35d3e3c940"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/2d43b8627742b74aa21665b14a79d71316bbeaf2", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/2d43b8627742b74aa21665b14a79d71316bbeaf2", "html_url": "https://github.com/Rust-GCC/gccrs/commit/2d43b8627742b74aa21665b14a79d71316bbeaf2", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/2d43b8627742b74aa21665b14a79d71316bbeaf2/comments", "author": {"login": "vries", "id": 4057235, "node_id": "MDQ6VXNlcjQwNTcyMzU=", "avatar_url": "https://avatars.githubusercontent.com/u/4057235?v=4", "gravatar_id": "", "url": "https://api.github.com/users/vries", "html_url": "https://github.com/vries", "followers_url": "https://api.github.com/users/vries/followers", "following_url": "https://api.github.com/users/vries/following{/other_user}", "gists_url": "https://api.github.com/users/vries/gists{/gist_id}", "starred_url": "https://api.github.com/users/vries/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/vries/subscriptions", "organizations_url": "https://api.github.com/users/vries/orgs", "repos_url": "https://api.github.com/users/vries/repos", "events_url": "https://api.github.com/users/vries/events{/privacy}", "received_events_url": "https://api.github.com/users/vries/received_events", "type": "User", "site_admin": false}, "committer": null, "parents": [{"sha": "6b150ce95d2b987c33bbc3e6e8bc593f1b2f636b", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/6b150ce95d2b987c33bbc3e6e8bc593f1b2f636b", "html_url": "https://github.com/Rust-GCC/gccrs/commit/6b150ce95d2b987c33bbc3e6e8bc593f1b2f636b"}], "stats": {"total": 76, "additions": 55, "deletions": 21}, "files": [{"sha": "d2939c6fe31f9a722438f11aa428b8e53ff2957b", "filename": "gcc/testsuite/ChangeLog", "status": "modified", "additions": 8, "deletions": 0, "changes": 8, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/2d43b8627742b74aa21665b14a79d71316bbeaf2/gcc%2Ftestsuite%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/2d43b8627742b74aa21665b14a79d71316bbeaf2/gcc%2Ftestsuite%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2FChangeLog?ref=2d43b8627742b74aa21665b14a79d71316bbeaf2", "patch": "@@ -1,3 +1,11 @@\n+2018-07-01  Tom de Vries  <tdevries@suse.de>\n+\n+\t* gcc.dg-selftests/dg-final.exp (verify_call_1): Factor out of ...\n+\t(verify_call): ... here.  Move to toplevel.\n+\t(verify_call_np, dg_final_directive_check_utils): New proc.\n+\t(toplevel): Call dg_final_directive_check_utils.\n+\t* lib/gcc-dg.exp (get-absolute-line): Fix typo in variable reference.\n+\n 2018-06-30  Jim Wilson  <jimw@sifive.com>\n \n \t* gcc.target/riscv/shift-shift-1.c: New."}, {"sha": "1d98666e13730c0b70d664a2b5106c21af79e082", "filename": "gcc/testsuite/gcc.dg-selftests/dg-final.exp", "status": "modified", "additions": 46, "deletions": 20, "changes": 66, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/2d43b8627742b74aa21665b14a79d71316bbeaf2/gcc%2Ftestsuite%2Fgcc.dg-selftests%2Fdg-final.exp", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/2d43b8627742b74aa21665b14a79d71316bbeaf2/gcc%2Ftestsuite%2Fgcc.dg-selftests%2Fdg-final.exp", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgcc.dg-selftests%2Fdg-final.exp?ref=2d43b8627742b74aa21665b14a79d71316bbeaf2", "patch": "@@ -25,29 +25,47 @@ load_lib \"scanasm.exp\"\n load_lib \"scanwpaipa.exp\"\n load_lib \"scanltranstree.exp\"\n load_lib \"scanoffloadtree.exp\"\n+load_lib \"gcc-dg.exp\"\n \n-proc dg_final_directive_check_num_args {} {\n-    proc verify_call { args } {\n-\tset call_name [lindex $args 0]\n-\tset call_args [lindex $args 1]\n-\tset expected_error [lindex $args 2]\n-\n-\tset errMsg \"\"\n-\tcatch {\n-\t    eval $call_name $call_args\n-\t} errMsg\n-\n-\tif { \"$errMsg\" != \"$call_name: $expected_error\" } {\n-\t    send_log \"For call $call_name $call_args\\n\"\n-\t    send_log \"expected: $call_name: $expected_error\\n\"\n-\t    send_log \"but got: $errMsg\\n\"\n-\t    fail \"$call_name: $expected_error\"\n-\t    return\n-\t} else {\n-\t    pass \"$call_name: $expected_error\"\t\n-\t}\n+proc verify_call_1 { args } {\n+    set call_name [lindex $args 0]\n+    set call_args [lindex $args 1]\n+    set expected_error [lindex $args 2]\n+    set testid [lindex $args 3]\n+\n+    set errMsg \"\"\n+    catch {\n+\teval $call_name $call_args\n+    } errMsg\n+\n+    if { \"$errMsg\" != \"$expected_error\" } {\n+\tsend_log \"For call $call_name $call_args\\n\"\n+\tsend_log \"expected: $expected_error\\n\"\n+\tsend_log \"but got: $errMsg\\n\"\n+\tfail \"$testid\"\n+\treturn\n+    } else {\n+\tpass \"$testid\"\t\n     }\n+}\n+\n+proc verify_call { args } {\n+    set call_name [lindex $args 0]\n+    set call_args [lindex $args 1]\n+    set expected_error [lindex $args 2]\n+    verify_call_1 $call_name $call_args \"$call_name: $expected_error\" \\\n+\t\"$call_name: $expected_error\"\n+}\n+\n+proc verify_call_np { args } {\n+    set call_name [lindex $args 0]\n+    set call_args [lindex $args 1]\n+    set expected_error [lindex $args 2]\n+    verify_call_1 $call_name $call_args \"$expected_error\" \\\n+\t\"$call_name: $expected_error\"\n+}\n \n+proc dg_final_directive_check_num_args {} {\n     proc verify_args { args } {\n \tset proc_name [lindex $args 0]\n \tset min [lindex $args 1]\n@@ -98,9 +116,17 @@ proc dg_final_directive_check_num_args {} {\n     unset testname_with_flags\n }\n \n+proc dg_final_directive_check_utils {} {\n+    verify_call_np get-absolute-line [list \"\" bla] \\\n+\t\"dg-line var bla used, but not defined\"\n+    verify_call_np get-absolute-line [list 1 bla] \\\n+\t\"dg-line var bla used at line 1, but not defined\"\n+}\n+\n if ![gcc_parallel_test_run_p dg-final] {\n     return\n }\n gcc_parallel_test_enable 0\n dg_final_directive_check_num_args\n+dg_final_directive_check_utils\n gcc_parallel_test_enable 1"}, {"sha": "4f1796348c3e1f7a00d616e62ac2b0f30bb64fcc", "filename": "gcc/testsuite/lib/gcc-dg.exp", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/2d43b8627742b74aa21665b14a79d71316bbeaf2/gcc%2Ftestsuite%2Flib%2Fgcc-dg.exp", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/2d43b8627742b74aa21665b14a79d71316bbeaf2/gcc%2Ftestsuite%2Flib%2Fgcc-dg.exp", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Flib%2Fgcc-dg.exp?ref=2d43b8627742b74aa21665b14a79d71316bbeaf2", "patch": "@@ -1085,7 +1085,7 @@ proc get-absolute-line { useline line } {\n     eval set var_defined [info exists $varname]\n     if { ! $var_defined } {\n \tif { \"$useline\" != \"\" } {\n-\t    error \"dg-line var $org_varname used at line $uselinenr, but not defined\"\n+\t    error \"dg-line var $org_varname used at line $useline, but not defined\"\n \t} else {\n \t    error \"dg-line var $org_varname used, but not defined\"\n \t}"}]}