{"sha": "c57ddcf1b4642ffda115ac5fedf1088ac891d47d", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6YzU3ZGRjZjFiNDY0MmZmZGExMTVhYzVmZWRmMTA4OGFjODkxZDQ3ZA==", "commit": {"author": {"name": "Roger Sayle", "email": "roger@eyesopen.com", "date": "2003-04-23T02:47:41Z"}, "committer": {"name": "Roger Sayle", "email": "sayle@gcc.gnu.org", "date": "2003-04-23T02:47:41Z"}, "message": "alias.c (mark_constant_function): Check for constancy and purity even of void functions.\n\n\n\t* alias.c (mark_constant_function):  Check for constancy and\n\tpurity even of void functions.  Update both the function decl\n\tand the cgraph RTL info with the results.\n\nFrom-SVN: r65981", "tree": {"sha": "91849aee7f2d1f354083ade4bbcfcb7269367bd8", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/91849aee7f2d1f354083ade4bbcfcb7269367bd8"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/c57ddcf1b4642ffda115ac5fedf1088ac891d47d", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/c57ddcf1b4642ffda115ac5fedf1088ac891d47d", "html_url": "https://github.com/Rust-GCC/gccrs/commit/c57ddcf1b4642ffda115ac5fedf1088ac891d47d", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/c57ddcf1b4642ffda115ac5fedf1088ac891d47d/comments", "author": null, "committer": null, "parents": [{"sha": "c1a19acbfd17a67e79e71cc0d617ba804f0d15d1", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/c1a19acbfd17a67e79e71cc0d617ba804f0d15d1", "html_url": "https://github.com/Rust-GCC/gccrs/commit/c1a19acbfd17a67e79e71cc0d617ba804f0d15d1"}], "stats": {"total": 19, "additions": 15, "deletions": 4}, "files": [{"sha": "c552233cdd04de3d8ad9b5e8332a3af21f0750e6", "filename": "gcc/ChangeLog", "status": "modified", "additions": 6, "deletions": 0, "changes": 6, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/c57ddcf1b4642ffda115ac5fedf1088ac891d47d/gcc%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/c57ddcf1b4642ffda115ac5fedf1088ac891d47d/gcc%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2FChangeLog?ref=c57ddcf1b4642ffda115ac5fedf1088ac891d47d", "patch": "@@ -1,3 +1,9 @@\n+2003-04-22  Roger Sayle  <roger@eyesopen.com>\n+\n+\t* alias.c (mark_constant_function):  Check for constancy and\n+\tpurity even of void functions.  Update both the function decl\n+\tand the cgraph RTL info with the results.\n+\n 2003-04-22  Roger Sayle  <roger@eyesopen.com>\n \n \t* real.c (do_add): Change to return a bool indicating that the"}, {"sha": "4cd51e994f590119632a845d212e79a087c4cd38", "filename": "gcc/alias.c", "status": "modified", "additions": 9, "deletions": 4, "changes": 13, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/c57ddcf1b4642ffda115ac5fedf1088ac891d47d/gcc%2Falias.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/c57ddcf1b4642ffda115ac5fedf1088ac891d47d/gcc%2Falias.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Falias.c?ref=c57ddcf1b4642ffda115ac5fedf1088ac891d47d", "patch": "@@ -2642,7 +2642,7 @@ nonlocal_set_p (x)\n   return for_each_rtx (&x, nonlocal_set_p_1, NULL);\n }\n \n-/* Mark the function if it is constant.  */\n+/* Mark the function if it is pure or constant.  */\n \n void\n mark_constant_function ()\n@@ -2653,7 +2653,6 @@ mark_constant_function ()\n   if (TREE_READONLY (current_function_decl)\n       || DECL_IS_PURE (current_function_decl)\n       || TREE_THIS_VOLATILE (current_function_decl)\n-      || TYPE_MODE (TREE_TYPE (current_function_decl)) == VOIDmode\n       || current_function_has_nonlocal_goto\n       || !(*targetm.binds_local_p) (current_function_decl))\n     return;\n@@ -2688,9 +2687,15 @@ mark_constant_function ()\n   if (insn)\n     ;\n   else if (nonlocal_memory_referenced)\n-    cgraph_rtl_info (current_function_decl)->pure_function = 1;\n+    {\n+      cgraph_rtl_info (current_function_decl)->pure_function = 1;\n+      DECL_IS_PURE (current_function_decl) = 1;\n+    }\n   else\n-    cgraph_rtl_info (current_function_decl)->const_function = 1;\n+    {\n+      cgraph_rtl_info (current_function_decl)->const_function = 1;\n+      TREE_READONLY (current_function_decl) = 1;\n+    }\n }\n \f\n "}]}