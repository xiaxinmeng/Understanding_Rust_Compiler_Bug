{"sha": "253e34040c869ba73d0eca1d48895b147688ab29", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6MjUzZTM0MDQwYzg2OWJhNzNkMGVjYTFkNDg4OTViMTQ3Njg4YWIyOQ==", "commit": {"author": {"name": "Ville Voutilainen", "email": "ville.voutilainen@gmail.com", "date": "2014-08-12T17:06:11Z"}, "committer": {"name": "Jason Merrill", "email": "jason@gcc.gnu.org", "date": "2014-08-12T17:06:11Z"}, "message": "Reject virt-specifiers on friends and member templates\n\n\tReject virt-specifiers on friends and member templates\n\t* friend.c (do_friend): Diagnose virt-specifiers.\n\t* pt.c (push_template_decl_real): Diagnose virt-specifiers.\n\nFrom-SVN: r213874", "tree": {"sha": "388aa403ff91bb1df810e0502a5a6c03a503779d", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/388aa403ff91bb1df810e0502a5a6c03a503779d"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/253e34040c869ba73d0eca1d48895b147688ab29", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/253e34040c869ba73d0eca1d48895b147688ab29", "html_url": "https://github.com/Rust-GCC/gccrs/commit/253e34040c869ba73d0eca1d48895b147688ab29", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/253e34040c869ba73d0eca1d48895b147688ab29/comments", "author": {"login": "villevoutilainen", "id": 963599, "node_id": "MDQ6VXNlcjk2MzU5OQ==", "avatar_url": "https://avatars.githubusercontent.com/u/963599?v=4", "gravatar_id": "", "url": "https://api.github.com/users/villevoutilainen", "html_url": "https://github.com/villevoutilainen", "followers_url": "https://api.github.com/users/villevoutilainen/followers", "following_url": "https://api.github.com/users/villevoutilainen/following{/other_user}", "gists_url": "https://api.github.com/users/villevoutilainen/gists{/gist_id}", "starred_url": "https://api.github.com/users/villevoutilainen/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/villevoutilainen/subscriptions", "organizations_url": "https://api.github.com/users/villevoutilainen/orgs", "repos_url": "https://api.github.com/users/villevoutilainen/repos", "events_url": "https://api.github.com/users/villevoutilainen/events{/privacy}", "received_events_url": "https://api.github.com/users/villevoutilainen/received_events", "type": "User", "site_admin": false}, "committer": null, "parents": [{"sha": "caff45a63534858a06e9a8f4f1d878e25f5be88a", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/caff45a63534858a06e9a8f4f1d878e25f5be88a", "html_url": "https://github.com/Rust-GCC/gccrs/commit/caff45a63534858a06e9a8f4f1d878e25f5be88a"}], "stats": {"total": 23, "additions": 23, "deletions": 0}, "files": [{"sha": "e30dc0e463603e3a6810a6f5487e0afbf001a5fe", "filename": "gcc/cp/ChangeLog", "status": "modified", "additions": 6, "deletions": 0, "changes": 6, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/253e34040c869ba73d0eca1d48895b147688ab29/gcc%2Fcp%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/253e34040c869ba73d0eca1d48895b147688ab29/gcc%2Fcp%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fcp%2FChangeLog?ref=253e34040c869ba73d0eca1d48895b147688ab29", "patch": "@@ -1,3 +1,9 @@\n+2014-08-12  Ville Voutilainen  <ville.voutilainen@gmail.com>\n+\n+\tReject virt-specifiers on friends and member templates\n+\t* friend.c (do_friend): Diagnose virt-specifiers.\n+\t* pt.c (push_template_decl_real): Diagnose virt-specifiers.\n+\n 2014-08-09  Paolo Carlini  <paolo.carlini@oracle.com>\n \n \t* typeck2.c (check_narrowing): Add tsubst_flags_t parameter, change"}, {"sha": "aa66c58568f42b40a028a9b83bd2e699250f5b3d", "filename": "gcc/cp/friend.c", "status": "modified", "additions": 4, "deletions": 0, "changes": 4, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/253e34040c869ba73d0eca1d48895b147688ab29/gcc%2Fcp%2Ffriend.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/253e34040c869ba73d0eca1d48895b147688ab29/gcc%2Fcp%2Ffriend.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fcp%2Ffriend.c?ref=253e34040c869ba73d0eca1d48895b147688ab29", "patch": "@@ -427,6 +427,10 @@ do_friend (tree ctype, tree declarator, tree decl,\n   /* Every decl that gets here is a friend of something.  */\n   DECL_FRIEND_P (decl) = 1;\n \n+  if (DECL_OVERRIDE_P (decl) || DECL_FINAL_P (decl))\n+    error (\"friend declaration %qD may not have virt-specifiers\",\n+\t   decl);\n+\n   /* Unfortunately, we have to handle attributes here.  Normally we would\n      handle them in start_decl_1, but since this is a friend decl start_decl_1\n      never gets to see it.  */"}, {"sha": "90b2720ef9c8e7bec09b6e757dfb31073275dfcc", "filename": "gcc/cp/pt.c", "status": "modified", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/253e34040c869ba73d0eca1d48895b147688ab29/gcc%2Fcp%2Fpt.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/253e34040c869ba73d0eca1d48895b147688ab29/gcc%2Fcp%2Fpt.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fcp%2Fpt.c?ref=253e34040c869ba73d0eca1d48895b147688ab29", "patch": "@@ -4737,6 +4737,11 @@ push_template_decl_real (tree decl, bool is_friend)\n \t}\n       else if (TREE_CODE (decl) == FUNCTION_DECL)\n \t{\n+\t  if (member_template_p)\n+\t    {\n+\t      if (DECL_OVERRIDE_P (decl) || DECL_FINAL_P (decl))\n+\t\terror (\"member template %qD may not have virt-specifiers\", decl);\n+\t    }\n \t  if (DECL_DESTRUCTOR_P (decl))\n \t    {\n \t      /* [temp.mem]"}, {"sha": "05d729084daa0987d0b8f7687350bff69172d605", "filename": "gcc/testsuite/g++.dg/cpp0x/override1.C", "status": "modified", "additions": 8, "deletions": 0, "changes": 8, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/253e34040c869ba73d0eca1d48895b147688ab29/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Fcpp0x%2Foverride1.C", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/253e34040c869ba73d0eca1d48895b147688ab29/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Fcpp0x%2Foverride1.C", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Fcpp0x%2Foverride1.C?ref=253e34040c869ba73d0eca1d48895b147688ab29", "patch": "@@ -52,6 +52,14 @@ struct D5 : B\n void D5::g() override {} // { dg-error \"not allowed outside a class definition\" }\n void g() override {} // { dg-error \"not allowed outside a class definition\" }\n \n+struct B5\n+{\n+  friend void f() final; // { dg-error \"may not have virt-specifiers\" }\n+  friend void g() override; // { dg-error \"may not have virt-specifiers\" }\n+  template <class T> void h() final; // { dg-error \"may not have virt-specifiers\" }\n+  template <class T> void i() override; // { dg-error \"may not have virt-specifiers\" }\n+};\n+\n int main()\n {\n   D2<B> d;"}]}