{"sha": "2e0bffaf8cc85cd8f5dd4a7b31ca354e0017b14e", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6MmUwYmZmYWY4Y2M4NWNkOGY1ZGQ0YTdiMzFjYTM1NGUwMDE3YjE0ZQ==", "commit": {"author": {"name": "Tobias Burnus", "email": "burnus@net-b.de", "date": "2012-01-10T11:22:16Z"}, "committer": {"name": "Tobias Burnus", "email": "burnus@gcc.gnu.org", "date": "2012-01-10T11:22:16Z"}, "message": "re PR fortran/51652 (Allocate with type-spec and source-expr: check whether length type-parameter is the same is lacking)\n\n2012-01-10  Tobias Burnus  <burnus@net-b.de>\n\n        PR fortran/51652\n        * resolve.c (resolve_allocate_expr): For non-deferred char\n        lengths, check whether type-spec matches declaration.\n\n2012-01-10  Tobias Burnus  <burnus@net-b.de>\n\n        PR fortran/51652\n        * gfortran.dg/allocate_with_typespec_5.f90: New.\n\nFrom-SVN: r183061", "tree": {"sha": "6f2b9158f3eb1e9ffed7f3460c26bf0112f5d24c", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/6f2b9158f3eb1e9ffed7f3460c26bf0112f5d24c"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/2e0bffaf8cc85cd8f5dd4a7b31ca354e0017b14e", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/2e0bffaf8cc85cd8f5dd4a7b31ca354e0017b14e", "html_url": "https://github.com/Rust-GCC/gccrs/commit/2e0bffaf8cc85cd8f5dd4a7b31ca354e0017b14e", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/2e0bffaf8cc85cd8f5dd4a7b31ca354e0017b14e/comments", "author": {"login": "tob2", "id": 264461, "node_id": "MDQ6VXNlcjI2NDQ2MQ==", "avatar_url": "https://avatars.githubusercontent.com/u/264461?v=4", "gravatar_id": "", "url": "https://api.github.com/users/tob2", "html_url": "https://github.com/tob2", "followers_url": "https://api.github.com/users/tob2/followers", "following_url": "https://api.github.com/users/tob2/following{/other_user}", "gists_url": "https://api.github.com/users/tob2/gists{/gist_id}", "starred_url": "https://api.github.com/users/tob2/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/tob2/subscriptions", "organizations_url": "https://api.github.com/users/tob2/orgs", "repos_url": "https://api.github.com/users/tob2/repos", "events_url": "https://api.github.com/users/tob2/events{/privacy}", "received_events_url": "https://api.github.com/users/tob2/received_events", "type": "User", "site_admin": false}, "committer": null, "parents": [{"sha": "c9423ca3fa65282b0ca58d33976c150f78e24f23", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/c9423ca3fa65282b0ca58d33976c150f78e24f23", "html_url": "https://github.com/Rust-GCC/gccrs/commit/c9423ca3fa65282b0ca58d33976c150f78e24f23"}], "stats": {"total": 50, "additions": 50, "deletions": 0}, "files": [{"sha": "04c8344870524c8c2bbf4a7dfe5b368d1a9dea41", "filename": "gcc/fortran/ChangeLog", "status": "modified", "additions": 6, "deletions": 0, "changes": 6, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/2e0bffaf8cc85cd8f5dd4a7b31ca354e0017b14e/gcc%2Ffortran%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/2e0bffaf8cc85cd8f5dd4a7b31ca354e0017b14e/gcc%2Ffortran%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ffortran%2FChangeLog?ref=2e0bffaf8cc85cd8f5dd4a7b31ca354e0017b14e", "patch": "@@ -1,3 +1,9 @@\n+2012-01-10  Tobias Burnus  <burnus@net-b.de>\n+\n+\tPR fortran/51652\n+\t* resolve.c (resolve_allocate_expr): For non-deferred char lengths,\n+\tcheck whether type-spec matches declaration.\n+\n 2012-01-10  Tobias Burnus  <burnus@net-b.de>\n \n \t* resolve.c (resolve_ordinary_assign): Improve error wording."}, {"sha": "7f476b8340085b3e7d7908a739c8e16a203d7e24", "filename": "gcc/fortran/resolve.c", "status": "modified", "additions": 13, "deletions": 0, "changes": 13, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/2e0bffaf8cc85cd8f5dd4a7b31ca354e0017b14e/gcc%2Ffortran%2Fresolve.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/2e0bffaf8cc85cd8f5dd4a7b31ca354e0017b14e/gcc%2Ffortran%2Fresolve.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ffortran%2Fresolve.c?ref=2e0bffaf8cc85cd8f5dd4a7b31ca354e0017b14e", "patch": "@@ -6989,6 +6989,19 @@ resolve_allocate_expr (gfc_expr *e, gfc_code *code)\n       goto failure;\n     }\n \n+  if (code->ext.alloc.ts.type == BT_CHARACTER && !e->ts.deferred)\n+    {\n+      int cmp = gfc_dep_compare_expr (e->ts.u.cl->length,\n+\t\t\t\t      code->ext.alloc.ts.u.cl->length);\n+      if (cmp == 1 || cmp == -1 || cmp == -3)\n+\t{\n+\t  gfc_error (\"Allocating %s at %L with type-spec requires the same \"\n+\t\t     \"character-length parameter as in the declaration\",\n+\t\t     sym->name, &e->where);\n+\t  goto failure;\n+\t}\n+    }\n+\n   /* In the variable definition context checks, gfc_expr_attr is used\n      on the expression.  This is fooled by the array specification\n      present in e, thus we have to eliminate that one temporarily.  */"}, {"sha": "1eccbaa7c17e91a3d820123a27df39282ec5790b", "filename": "gcc/testsuite/ChangeLog", "status": "modified", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/2e0bffaf8cc85cd8f5dd4a7b31ca354e0017b14e/gcc%2Ftestsuite%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/2e0bffaf8cc85cd8f5dd4a7b31ca354e0017b14e/gcc%2Ftestsuite%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2FChangeLog?ref=2e0bffaf8cc85cd8f5dd4a7b31ca354e0017b14e", "patch": "@@ -1,3 +1,8 @@\n+2012-01-10  Tobias Burnus  <burnus@net-b.de>\n+\n+\tPR fortran/51652\n+\t* gfortran.dg/allocate_with_typespec_5.f90: New.\n+\n 2012-01-10  Tobias Burnus  <burnus@net-b.de>\n \n \t* gfortran.dg/class_39.f03: Update dg-error string."}, {"sha": "1f8b3d6c4d27d4fb423f23e8b82f02178b397afa", "filename": "gcc/testsuite/gfortran.dg/allocate_with_typespec_5.f90", "status": "added", "additions": 26, "deletions": 0, "changes": 26, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/2e0bffaf8cc85cd8f5dd4a7b31ca354e0017b14e/gcc%2Ftestsuite%2Fgfortran.dg%2Fallocate_with_typespec_5.f90", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/2e0bffaf8cc85cd8f5dd4a7b31ca354e0017b14e/gcc%2Ftestsuite%2Fgfortran.dg%2Fallocate_with_typespec_5.f90", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgfortran.dg%2Fallocate_with_typespec_5.f90?ref=2e0bffaf8cc85cd8f5dd4a7b31ca354e0017b14e", "patch": "@@ -0,0 +1,26 @@\n+! { dg-do compile }\n+!\n+! PR fortran/51652\n+!\n+! Contributed by David Kinniburgh\n+!\n+module settings\n+\n+type keyword\n+  character(60), allocatable :: c(:)\n+end type keyword\n+\n+type(keyword) :: kw(10)\n+\n+contains\n+\n+subroutine save_kw\n+  allocate(character(80) :: kw(1)%c(10)) ! { dg-error \"with type-spec requires the same character-length parameter\" }\n+end subroutine save_kw\n+\n+subroutine foo(n)\n+  character(len=n+2), allocatable :: x\n+  allocate (character(len=n+3) :: x) ! { dg-error \"type-spec requires the same character-length parameter\" }\n+end subroutine foo\n+\n+end module settings"}]}