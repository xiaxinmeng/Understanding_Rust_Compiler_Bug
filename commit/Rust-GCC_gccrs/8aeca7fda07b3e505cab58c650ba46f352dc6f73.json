{"sha": "8aeca7fda07b3e505cab58c650ba46f352dc6f73", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6OGFlY2E3ZmRhMDdiM2U1MDVjYWI1OGM2NTBiYTQ2ZjM1MmRjNmY3Mw==", "commit": {"author": {"name": "Richard Sandiford", "email": "richard@codesourcery.com", "date": "2005-09-08T09:20:07Z"}, "committer": {"name": "Richard Sandiford", "email": "rsandifo@gcc.gnu.org", "date": "2005-09-08T09:20:07Z"}, "message": "re PR fortran/23373 ([4.0 only] Functions returning pointers with pointer argument)\n\n\tPR fortran/23373\n\t* trans-expr.c (gfc_trans_pointer_assignment): Assign to a temporary\n\tdescriptor if the rhs is not a null pointer or variable.\n\nFrom-SVN: r104029", "tree": {"sha": "123f31aa2a984a35b44adc3955d3b717877498f1", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/123f31aa2a984a35b44adc3955d3b717877498f1"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/8aeca7fda07b3e505cab58c650ba46f352dc6f73", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/8aeca7fda07b3e505cab58c650ba46f352dc6f73", "html_url": "https://github.com/Rust-GCC/gccrs/commit/8aeca7fda07b3e505cab58c650ba46f352dc6f73", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/8aeca7fda07b3e505cab58c650ba46f352dc6f73/comments", "author": null, "committer": null, "parents": [{"sha": "5e949d8329bbb0b1bd6df53bff9e645f0518ba0d", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/5e949d8329bbb0b1bd6df53bff9e645f0518ba0d", "html_url": "https://github.com/Rust-GCC/gccrs/commit/5e949d8329bbb0b1bd6df53bff9e645f0518ba0d"}], "stats": {"total": 73, "additions": 67, "deletions": 6}, "files": [{"sha": "e2afd7c55f04e7eb9c0a89636cd2aa8297a12b4a", "filename": "gcc/fortran/ChangeLog", "status": "modified", "additions": 6, "deletions": 0, "changes": 6, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/8aeca7fda07b3e505cab58c650ba46f352dc6f73/gcc%2Ffortran%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/8aeca7fda07b3e505cab58c650ba46f352dc6f73/gcc%2Ffortran%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ffortran%2FChangeLog?ref=8aeca7fda07b3e505cab58c650ba46f352dc6f73", "patch": "@@ -1,3 +1,9 @@\n+2005-09-07  Richard Sandiford  <richard@codesourcery.com>\n+\n+\tPR fortran/23373\n+\t* trans-expr.c (gfc_trans_pointer_assignment): Assign to a temporary\n+\tdescriptor if the rhs is not a null pointer or variable.\n+\n 2005-09-07  Thomas Koenig  <Thomas.Koenig@online.de>\n \n \tPR fortran/20848"}, {"sha": "0d3cb69bf9eaf6eddd409cac35b66c35e83ad150", "filename": "gcc/fortran/trans-expr.c", "status": "modified", "additions": 25, "deletions": 6, "changes": 31, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/8aeca7fda07b3e505cab58c650ba46f352dc6f73/gcc%2Ffortran%2Ftrans-expr.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/8aeca7fda07b3e505cab58c650ba46f352dc6f73/gcc%2Ffortran%2Ftrans-expr.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ffortran%2Ftrans-expr.c?ref=8aeca7fda07b3e505cab58c650ba46f352dc6f73", "patch": "@@ -2041,6 +2041,8 @@ gfc_trans_pointer_assignment (gfc_expr * expr1, gfc_expr * expr2)\n   gfc_ss *lss;\n   gfc_ss *rss;\n   stmtblock_t block;\n+  tree desc;\n+  tree tmp;\n \n   gfc_start_block (&block);\n \n@@ -2068,13 +2070,30 @@ gfc_trans_pointer_assignment (gfc_expr * expr1, gfc_expr * expr2)\n     {\n       /* Array pointer.  */\n       gfc_conv_expr_descriptor (&lse, expr1, lss);\n-      /* Implement Nullify.  */\n-      if (expr2->expr_type == EXPR_NULL)\n-\tgfc_conv_descriptor_data_set (&block, lse.expr, null_pointer_node);\n-      else\n-        {\n+      switch (expr2->expr_type)\n+\t{\n+\tcase EXPR_NULL:\n+\t  /* Just set the data pointer to null.  */\n+\t  gfc_conv_descriptor_data_set (&block, lse.expr, null_pointer_node);\n+\t  break;\n+\n+\tcase EXPR_VARIABLE:\n+\t  /* Assign directly to the pointer's descriptor.  */\n           lse.direct_byref = 1;\n-          gfc_conv_expr_descriptor (&lse, expr2, rss);\n+\t  gfc_conv_expr_descriptor (&lse, expr2, rss);\n+\t  break;\n+\n+\tdefault:\n+\t  /* Assign to a temporary descriptor and then copy that\n+\t     temporary to the pointer.  */\n+\t  desc = lse.expr;\n+\t  tmp = gfc_create_var (TREE_TYPE (desc), \"ptrtemp\");\n+\n+\t  lse.expr = tmp;\n+\t  lse.direct_byref = 1;\n+\t  gfc_conv_expr_descriptor (&lse, expr2, rss);\n+\t  gfc_add_modify_expr (&lse.pre, desc, tmp);\n+\t  break;\n         }\n       gfc_add_block_to_block (&block, &lse.pre);\n       gfc_add_block_to_block (&block, &lse.post);"}, {"sha": "c68a2aebd71931498f7856ed65f33beaad59bd61", "filename": "gcc/testsuite/ChangeLog", "status": "modified", "additions": 6, "deletions": 0, "changes": 6, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/8aeca7fda07b3e505cab58c650ba46f352dc6f73/gcc%2Ftestsuite%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/8aeca7fda07b3e505cab58c650ba46f352dc6f73/gcc%2Ftestsuite%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2FChangeLog?ref=8aeca7fda07b3e505cab58c650ba46f352dc6f73", "patch": "@@ -1,3 +1,9 @@\n+2005-09-07  Richard Sandiford  <richard@codesourcery.com>\n+\n+\tPR fortran/23373\n+\t* gfortran.fortran-torture/execute/pr23373-1.f90,\n+\t* gfortran.fortran-torture/execute/pr23373-1.f90: New tests.\n+\n 2005-09-07  Jerry DeLisle  <jvdelisle@verizon.net>\n \n \tPR libfortran/23760"}, {"sha": "8d5ee658df556cd744345c3c0c11cfefa60d7b15", "filename": "gcc/testsuite/gfortran.fortran-torture/execute/pr23373-1.f90", "status": "added", "additions": 15, "deletions": 0, "changes": 15, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/8aeca7fda07b3e505cab58c650ba46f352dc6f73/gcc%2Ftestsuite%2Fgfortran.fortran-torture%2Fexecute%2Fpr23373-1.f90", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/8aeca7fda07b3e505cab58c650ba46f352dc6f73/gcc%2Ftestsuite%2Fgfortran.fortran-torture%2Fexecute%2Fpr23373-1.f90", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgfortran.fortran-torture%2Fexecute%2Fpr23373-1.f90?ref=8aeca7fda07b3e505cab58c650ba46f352dc6f73", "patch": "@@ -0,0 +1,15 @@\n+program main\n+  implicit none\n+  real, dimension (:), pointer :: x\n+  x => null ()\n+  x => test (x)\n+  if (.not. associated (x)) call abort\n+  if (size (x) .ne. 10) call abort\n+contains\n+  function test (p)\n+    real, dimension (:), pointer :: p, test\n+    if (associated (p)) call abort\n+    allocate (test (10))\n+    if (associated (p)) call abort\n+  end function test\n+end program main"}, {"sha": "c91b270321ed0e814eafb379cec7ea5066b859a3", "filename": "gcc/testsuite/gfortran.fortran-torture/execute/pr23373-2.f90", "status": "added", "additions": 15, "deletions": 0, "changes": 15, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/8aeca7fda07b3e505cab58c650ba46f352dc6f73/gcc%2Ftestsuite%2Fgfortran.fortran-torture%2Fexecute%2Fpr23373-2.f90", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/8aeca7fda07b3e505cab58c650ba46f352dc6f73/gcc%2Ftestsuite%2Fgfortran.fortran-torture%2Fexecute%2Fpr23373-2.f90", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgfortran.fortran-torture%2Fexecute%2Fpr23373-2.f90?ref=8aeca7fda07b3e505cab58c650ba46f352dc6f73", "patch": "@@ -0,0 +1,15 @@\n+program main\n+  implicit none\n+  real, dimension (:), pointer :: x\n+  x => null ()\n+  x => test ()\n+  if (.not. associated (x)) call abort\n+  if (size (x) .ne. 10) call abort\n+contains\n+  function test\n+    real, dimension (:), pointer :: test\n+    if (associated (x)) call abort\n+    allocate (test (10))\n+    if (associated (x)) call abort\n+  end function test\n+end program main"}]}