{"sha": "cadafd1ffdceb92393f7394d763f66faf4598340", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6Y2FkYWZkMWZmZGNlYjkyMzkzZjczOTRkNzYzZjY2ZmFmNDU5ODM0MA==", "commit": {"author": {"name": "Bob Wilson", "email": "bob.wilson@acm.org", "date": "2003-09-15T23:19:21Z"}, "committer": {"name": "Bob Wilson", "email": "bwilson@gcc.gnu.org", "date": "2003-09-15T23:19:21Z"}, "message": "xtensa.c (xtensa_multibss_section_type_flags): Add ATTRIBUTE_UNUSED.\n\n\t* config/xtensa/xtensa.c (xtensa_multibss_section_type_flags): Add\n\tATTRIBUTE_UNUSED.\n\t(call_insn_operand): For PIC, don't allow a direct call to a\n\tfunction in a different section than the current one.\n\nFrom-SVN: r71415", "tree": {"sha": "d1911da1482a3dff567f9d484e6fa20931165cee", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/d1911da1482a3dff567f9d484e6fa20931165cee"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/cadafd1ffdceb92393f7394d763f66faf4598340", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/cadafd1ffdceb92393f7394d763f66faf4598340", "html_url": "https://github.com/Rust-GCC/gccrs/commit/cadafd1ffdceb92393f7394d763f66faf4598340", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/cadafd1ffdceb92393f7394d763f66faf4598340/comments", "author": null, "committer": null, "parents": [{"sha": "fb0317c6ea843e496fafa2fa4054f9982961d3ba", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/fb0317c6ea843e496fafa2fa4054f9982961d3ba", "html_url": "https://github.com/Rust-GCC/gccrs/commit/fb0317c6ea843e496fafa2fa4054f9982961d3ba"}], "stats": {"total": 42, "additions": 39, "deletions": 3}, "files": [{"sha": "5c007028e9a4a2d94a12b95e5e9502aea362097c", "filename": "gcc/ChangeLog", "status": "modified", "additions": 7, "deletions": 0, "changes": 7, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/cadafd1ffdceb92393f7394d763f66faf4598340/gcc%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/cadafd1ffdceb92393f7394d763f66faf4598340/gcc%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2FChangeLog?ref=cadafd1ffdceb92393f7394d763f66faf4598340", "patch": "@@ -1,3 +1,10 @@\n+2003-09-15  Bob Wilson  <bob.wilson@acm.org>\n+\n+\t* config/xtensa/xtensa.c (xtensa_multibss_section_type_flags): Add\n+\tATTRIBUTE_UNUSED.\n+\t(call_insn_operand): For PIC, don't allow a direct call to a\n+\tfunction in a different section than the current one.\n+\n 2003-09-16  Volker Reichelt  <reichelt@igpm.rwth-aachen.de>\n         \n         * doc/invoke.texi (Warning Options): Add missing hyphen before"}, {"sha": "32d5030c239e4e6398031f9ce6058d439ed781a4", "filename": "gcc/config/xtensa/xtensa.c", "status": "modified", "additions": 32, "deletions": 3, "changes": 35, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/cadafd1ffdceb92393f7394d763f66faf4598340/gcc%2Fconfig%2Fxtensa%2Fxtensa.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/cadafd1ffdceb92393f7394d763f66faf4598340/gcc%2Fconfig%2Fxtensa%2Fxtensa.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fconfig%2Fxtensa%2Fxtensa.c?ref=cadafd1ffdceb92393f7394d763f66faf4598340", "patch": "@@ -200,7 +200,7 @@ static struct machine_function * xtensa_init_machine_status PARAMS ((void));\n static void printx PARAMS ((FILE *, signed int));\n static void xtensa_function_epilogue PARAMS ((FILE *, HOST_WIDE_INT));\n static unsigned int xtensa_multibss_section_type_flags\n-  PARAMS ((tree, const char *, int));\n+  PARAMS ((tree, const char *, int)) ATTRIBUTE_UNUSED;\n static void xtensa_select_rtx_section\n   PARAMS ((enum machine_mode, rtx, unsigned HOST_WIDE_INT));\n static bool xtensa_rtx_costs PARAMS ((rtx, int, int, int *));\n@@ -581,8 +581,37 @@ call_insn_operand (op, mode)\n   if (CONSTANT_ADDRESS_P (op))\n     {\n       /* Direct calls only allowed to static functions with PIC.  */\n-      return (!flag_pic\n-\t      || (GET_CODE (op) == SYMBOL_REF && SYMBOL_REF_LOCAL_P (op)));\n+      if (flag_pic)\n+\t{\n+\t  tree callee, callee_sec, caller_sec;\n+\n+\t  if (GET_CODE (op) != SYMBOL_REF || !SYMBOL_REF_LOCAL_P (op))\n+\t    return FALSE;\n+\n+\t  /* Don't attempt a direct call if the callee is known to be in\n+\t     a different section, since there's a good chance it will be\n+\t     out of range.  */\n+\n+\t  if (flag_function_sections\n+\t      || DECL_ONE_ONLY (current_function_decl))\n+\t    return FALSE;\n+\t  caller_sec = DECL_SECTION_NAME (current_function_decl);\n+\t  callee = SYMBOL_REF_DECL (op);\n+\t  if (callee)\n+\t    {\n+\t      if (DECL_ONE_ONLY (callee))\n+\t\treturn FALSE;\n+\t      callee_sec = DECL_SECTION_NAME (callee);\n+\t      if (((caller_sec == NULL_TREE) ^ (callee_sec == NULL_TREE))\n+\t\t  || (caller_sec != NULL_TREE\n+\t\t      && strcmp (TREE_STRING_POINTER (caller_sec),\n+\t\t\t\t TREE_STRING_POINTER (callee_sec)) != 0))\n+\t\treturn FALSE;\n+\t    }\n+\t  else if (caller_sec != NULL_TREE)\n+\t    return FALSE;\n+\t}\n+      return TRUE;\n     }\n \n   return FALSE;"}]}