{"sha": "393525afc3eefc8d29d34b3cf603cb94483b04e0", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6MzkzNTI1YWZjM2VlZmM4ZDI5ZDM0YjNjZjYwM2NiOTQ0ODNiMDRlMA==", "commit": {"author": {"name": "Arnaud Charlet", "email": "charlet@gcc.gnu.org", "date": "2016-10-12T10:33:08Z"}, "committer": {"name": "Arnaud Charlet", "email": "charlet@gcc.gnu.org", "date": "2016-10-12T10:33:08Z"}, "message": "[multiple changes]\n\n2016-10-12  Ed Schonberg  <schonberg@adacore.com>\n\n\t* sem_ch12.adb (Check_Formal_Package_Instance): Handle properly\n\tan instance of a formal package with defaults, when defaulted\n\tparameters include tagged private types and array types.\n\n2016-10-12  Tristan Gingold  <gingold@adacore.com>\n\n\t* restrict.ads, restrict.adb (Restricted_Profile): Adjust\n\tcomment, use Restricted_Tasking to compare restrictions.\n\t* s-rident.ads (Profile_Name): Add Restricted_Tasking and\n\treorder literals.\n\t(Profile_Info): Set restrictions for Restricted_Tasking.\n\n2016-10-12  Ed Schonberg  <schonberg@adacore.com>\n\n\t* sem_ch3.adb (Analyze_Full_Type_Declaration): Set Ghost status\n\tof type before elaborating inherited operations, so that the\n\tGhost status is set properly for them.\n\t* ghost.adb (Check_Ghost_Overriding): A ghost subprogram can\n\toverride an abstract subprogram coming from an interface\n\toperation.\n\nFrom-SVN: r241026", "tree": {"sha": "fe6ae191b55167afc856d5951dd5b082ba9d63e8", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/fe6ae191b55167afc856d5951dd5b082ba9d63e8"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/393525afc3eefc8d29d34b3cf603cb94483b04e0", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/393525afc3eefc8d29d34b3cf603cb94483b04e0", "html_url": "https://github.com/Rust-GCC/gccrs/commit/393525afc3eefc8d29d34b3cf603cb94483b04e0", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/393525afc3eefc8d29d34b3cf603cb94483b04e0/comments", "author": null, "committer": null, "parents": [{"sha": "f40dbd80eb764d7dbab35d3bb7ec871a64db5606", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/f40dbd80eb764d7dbab35d3bb7ec871a64db5606", "html_url": "https://github.com/Rust-GCC/gccrs/commit/f40dbd80eb764d7dbab35d3bb7ec871a64db5606"}], "stats": {"total": 128, "additions": 107, "deletions": 21}, "files": [{"sha": "350fc3ef5fad509bda06eb74b90985e9f7bd7813", "filename": "gcc/ada/ChangeLog", "status": "modified", "additions": 30, "deletions": 0, "changes": 30, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/393525afc3eefc8d29d34b3cf603cb94483b04e0/gcc%2Fada%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/393525afc3eefc8d29d34b3cf603cb94483b04e0/gcc%2Fada%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fada%2FChangeLog?ref=393525afc3eefc8d29d34b3cf603cb94483b04e0", "patch": "@@ -1,3 +1,33 @@\n+2016-10-12  Ed Schonberg  <schonberg@adacore.com>\n+\n+\t* sem_ch12.adb (Check_Formal_Package_Instance): Handle properly\n+\tan instance of a formal package with defaults, when defaulted\n+\tparameters include tagged private types and array types.\n+\n+2016-10-12  Eric Botcazou  <ebotcazou@adacore.com>\n+\n+\tPR ada/64057.\n+\t* exp_ch5.adb (Is_Non_Local_Array): Return true for every array\n+\tthat is not a component or slice of an entity in the current\n+\tscope.\n+\n+2016-10-12  Tristan Gingold  <gingold@adacore.com>\n+\n+\t* restrict.ads, restrict.adb (Restricted_Profile): Adjust\n+\tcomment, use Restricted_Tasking to compare restrictions.\n+\t* s-rident.ads (Profile_Name): Add Restricted_Tasking and\n+\treorder literals.\n+\t(Profile_Info): Set restrictions for Restricted_Tasking.\n+\n+2016-10-12  Ed Schonberg  <schonberg@adacore.com>\n+\n+\t* sem_ch3.adb (Analyze_Full_Type_Declaration): Set Ghost status\n+\tof type before elaborating inherited operations, so that the\n+\tGhost status is set properly for them.\n+\t* ghost.adb (Check_Ghost_Overriding): A ghost subprogram can\n+\toverride an abstract subprogram coming from an interface\n+\toperation.\n+\n 2016-10-11  Eric Botcazou  <ebotcazou@adacore.com>\n \n \t* system-linux-armeb.ads (Backend_Overflow_Checks): Change to True."}, {"sha": "60b3866a905ec21367a0499cb110a6a663e019b0", "filename": "gcc/ada/ghost.adb", "status": "modified", "additions": 2, "deletions": 0, "changes": 2, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/393525afc3eefc8d29d34b3cf603cb94483b04e0/gcc%2Fada%2Fghost.adb", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/393525afc3eefc8d29d34b3cf603cb94483b04e0/gcc%2Fada%2Fghost.adb", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fada%2Fghost.adb?ref=393525afc3eefc8d29d34b3cf603cb94483b04e0", "patch": "@@ -603,6 +603,7 @@ package body Ghost is\n            and then Present (Deriv_Typ)\n            and then not Is_Ghost_Entity (Deriv_Typ)\n            and then not Is_Ghost_Entity (Over_Subp)\n+           and then not Is_Abstract_Subprogram (Over_Subp)\n          then\n             Error_Msg_N (\"incompatible overriding in effect\", Subp);\n \n@@ -617,6 +618,7 @@ package body Ghost is\n          --  inherited Ghost primitive (SPARK RM 6.9(8)).\n \n          if not Is_Ghost_Entity (Subp)\n+           and then not Is_Abstract_Subprogram (Subp)\n            and then Is_Ghost_Entity (Over_Subp)\n          then\n             Error_Msg_N (\"incompatible overriding in effect\", Subp);"}, {"sha": "9d22f854e89b3b0a7c0874911c5e481c0e6489b5", "filename": "gcc/ada/restrict.adb", "status": "modified", "additions": 4, "deletions": 2, "changes": 6, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/393525afc3eefc8d29d34b3cf603cb94483b04e0/gcc%2Fada%2Frestrict.adb", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/393525afc3eefc8d29d34b3cf603cb94483b04e0/gcc%2Fada%2Frestrict.adb", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fada%2Frestrict.adb?ref=393525afc3eefc8d29d34b3cf603cb94483b04e0", "patch": "@@ -1194,8 +1194,10 @@ package body Restrict is\n          Restricted_Profile_Cached := True;\n \n          declare\n-            R : Restriction_Flags  renames Profile_Info (Restricted).Set;\n-            V : Restriction_Values renames Profile_Info (Restricted).Value;\n+            R : Restriction_Flags  renames\n+                   Profile_Info (Restricted_Tasking).Set;\n+            V : Restriction_Values renames\n+                   Profile_Info (Restricted_Tasking).Value;\n          begin\n             for J in R'Range loop\n                if R (J)"}, {"sha": "d725de799a95416e75cde922534616b3d520008a", "filename": "gcc/ada/restrict.ads", "status": "modified", "additions": 5, "deletions": 5, "changes": 10, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/393525afc3eefc8d29d34b3cf603cb94483b04e0/gcc%2Fada%2Frestrict.ads", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/393525afc3eefc8d29d34b3cf603cb94483b04e0/gcc%2Fada%2Frestrict.ads", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fada%2Frestrict.ads?ref=393525afc3eefc8d29d34b3cf603cb94483b04e0", "patch": "@@ -6,7 +6,7 @@\n --                                                                          --\n --                                 S p e c                                  --\n --                                                                          --\n---          Copyright (C) 1992-2015, Free Software Foundation, Inc.         --\n+--          Copyright (C) 1992-2016, Free Software Foundation, Inc.         --\n --                                                                          --\n -- GNAT is free software;  you can  redistribute it  and/or modify it under --\n -- terms of the  GNU General Public License as published  by the Free Soft- --\n@@ -424,10 +424,10 @@ package Restrict is\n    --  executing this code only if needed.\n \n    function Restricted_Profile return Boolean;\n-   --  Tests if set of restrictions corresponding to Profile (Restricted) is\n-   --  currently in effect (set by pragma Profile, or by an appropriate set of\n-   --  individual Restrictions pragmas). Returns True only if all the required\n-   --  restrictions are set.\n+   --  Tests if set of restrictions corresponding to Restricted_Tasking profile\n+   --  is currently in effect (set by pragma Profile, or by an appropriate set\n+   --  of individual Restrictions pragmas). Returns True only if all the\n+   --  required restrictions are set.\n \n    procedure Set_Hidden_Part_In_SPARK (Loc1, Loc2 : Source_Ptr);\n    --  Insert a new hidden region range in the SPARK hides table. The effect"}, {"sha": "9b23b5b763f2fbf3eb6f6edebb9f6b6ad5376ba7", "filename": "gcc/ada/s-rident.ads", "status": "modified", "additions": 39, "deletions": 4, "changes": 43, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/393525afc3eefc8d29d34b3cf603cb94483b04e0/gcc%2Fada%2Fs-rident.ads", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/393525afc3eefc8d29d34b3cf603cb94483b04e0/gcc%2Fada%2Fs-rident.ads", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fada%2Fs-rident.ads?ref=393525afc3eefc8d29d34b3cf603cb94483b04e0", "patch": "@@ -378,15 +378,19 @@ package System.Rident is\n    type Profile_Name is\n      (No_Profile,\n       No_Implementation_Extensions,\n+      Restricted_Tasking,\n+      Restricted,\n       Ravenscar,\n-      GNAT_Extended_Ravenscar,\n-      Restricted);\n+      GNAT_Extended_Ravenscar);\n    --  Names of recognized profiles. No_Profile is used to indicate that a\n    --  restriction came from pragma Restrictions[_Warning], as opposed to\n-   --  pragma Profile[_Warning].\n+   --  pragma Profile[_Warning]. Restricted_Tasking is a non-user profile that\n+   --  contaings the minimal set of restrictions to trigger the user of the\n+   --  restricted tasking runtime. Restricted is the corresponding user profile\n+   --  that also restrict protected types.\n \n    subtype Profile_Name_Actual is Profile_Name\n-     range No_Implementation_Extensions .. Restricted;\n+     range No_Implementation_Extensions .. GNAT_Extended_Ravenscar;\n    --  Actual used profile names\n \n    type Profile_Data is record\n@@ -422,6 +426,37 @@ package System.Rident is\n                         Value =>\n                           (others                          => 0)),\n \n+                     --  Restricted_Tasking Profile\n+\n+                     Restricted_Tasking =>\n+\n+                        --  Restrictions for Restricted_Tasking profile\n+\n+                       (Set   =>\n+                          (No_Abort_Statements             => True,\n+                           No_Asynchronous_Control         => True,\n+                           No_Dynamic_Attachment           => True,\n+                           No_Dynamic_Priorities           => True,\n+                           No_Local_Protected_Objects      => True,\n+                           No_Protected_Type_Allocators    => True,\n+                           No_Requeue_Statements           => True,\n+                           No_Task_Allocators              => True,\n+                           No_Task_Attributes_Package      => True,\n+                           No_Task_Hierarchy               => True,\n+                           No_Terminate_Alternatives       => True,\n+                           Max_Asynchronous_Select_Nesting => True,\n+                           Max_Select_Alternatives         => True,\n+                           Max_Task_Entries                => True,\n+                           others                          => False),\n+\n+                        --  Value settings for Restricted_Tasking profile\n+\n+                        Value =>\n+                          (Max_Asynchronous_Select_Nesting => 0,\n+                           Max_Select_Alternatives         => 0,\n+                           Max_Task_Entries                => 0,\n+                           others                          => 0)),\n+\n                      --  Restricted Profile\n \n                      Restricted =>"}, {"sha": "efeaf4f661c7087be90f74c684adae998c345c66", "filename": "gcc/ada/sem_ch12.adb", "status": "modified", "additions": 20, "deletions": 2, "changes": 22, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/393525afc3eefc8d29d34b3cf603cb94483b04e0/gcc%2Fada%2Fsem_ch12.adb", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/393525afc3eefc8d29d34b3cf603cb94483b04e0/gcc%2Fada%2Fsem_ch12.adb", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fada%2Fsem_ch12.adb?ref=393525afc3eefc8d29d34b3cf603cb94483b04e0", "patch": "@@ -5787,8 +5787,9 @@ package body Sem_Ch12 is\n      (Formal_Pack : Entity_Id;\n       Actual_Pack : Entity_Id)\n    is\n-      E1 : Entity_Id := First_Entity (Actual_Pack);\n-      E2 : Entity_Id := First_Entity (Formal_Pack);\n+      E1      : Entity_Id := First_Entity (Actual_Pack);\n+      E2      : Entity_Id := First_Entity (Formal_Pack);\n+      Prev_E1 : Entity_Id;\n \n       Expr1 : Node_Id;\n       Expr2 : Node_Id;\n@@ -5954,6 +5955,7 @@ package body Sem_Ch12 is\n    --  Start of processing for Check_Formal_Package_Instance\n \n    begin\n+      Prev_E1 := E1;\n       while Present (E1) and then Present (E2) loop\n          exit when Ekind (E1) = E_Package\n            and then Renamed_Entity (E1) = Renamed_Entity (Actual_Pack);\n@@ -5983,13 +5985,28 @@ package body Sem_Ch12 is\n          if No (E1) then\n             return;\n \n+         --  Entities may be declared without full declaration, such as\n+         --  itypes and predefined operators (concatenation for arrays, eg).\n+         --  Skip it and keep the formal entity to find a later match for it.\n+\n+         elsif No (Parent (E2)) then\n+            E1 := Prev_E1;\n+            goto Next_E;\n+\n          --  If the formal entity comes from a formal declaration, it was\n          --  defaulted in the formal package, and no check is needed on it.\n \n          elsif Nkind_In (Original_Node (Parent (E2)),\n                          N_Formal_Object_Declaration,\n                          N_Formal_Type_Declaration)\n          then\n+            --  If the formal is a tagged type the corresponding class-wide\n+            --  type has been generated as well, and it must be skipped.\n+\n+            if Is_Type (E2) and then Is_Tagged_Type (E2) then\n+               Next_Entity (E2);\n+            end if;\n+\n             goto Next_E;\n \n          --  Ditto for defaulted formal subprograms.\n@@ -6144,6 +6161,7 @@ package body Sem_Ch12 is\n          end if;\n \n          <<Next_E>>\n+            Prev_E1 := E1;\n             Next_Entity (E1);\n             Next_Entity (E2);\n       end loop;"}, {"sha": "07f25dcf84666a401e889790a8726d0ed3f66384", "filename": "gcc/ada/sem_ch3.adb", "status": "modified", "additions": 7, "deletions": 8, "changes": 15, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/393525afc3eefc8d29d34b3cf603cb94483b04e0/gcc%2Fada%2Fsem_ch3.adb", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/393525afc3eefc8d29d34b3cf603cb94483b04e0/gcc%2Fada%2Fsem_ch3.adb", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fada%2Fsem_ch3.adb?ref=393525afc3eefc8d29d34b3cf603cb94483b04e0", "patch": "@@ -877,7 +877,6 @@ package body Sem_Ch3 is\n          then\n             Build_Itype_Reference (Anon_Type, Parent (Current_Scope));\n          end if;\n-\n          return Anon_Type;\n       end if;\n \n@@ -2805,6 +2804,13 @@ package body Sem_Ch3 is\n       if not Analyzed (T) then\n          Set_Analyzed (T);\n \n+         --  A type declared within a Ghost region is automatically Ghost\n+         --  (SPARK RM 6.9(2)).\n+\n+         if Ghost_Mode > None then\n+            Set_Is_Ghost_Entity (T);\n+         end if;\n+\n          case Nkind (Def) is\n             when N_Access_To_Subprogram_Definition =>\n                Access_Subprogram_Declaration (T, Def);\n@@ -2887,13 +2893,6 @@ package body Sem_Ch3 is\n          Check_SPARK_05_Restriction (\"controlled type is not allowed\", N);\n       end if;\n \n-      --  A type declared within a Ghost region is automatically Ghost\n-      --  (SPARK RM 6.9(2)).\n-\n-      if Ghost_Mode > None then\n-         Set_Is_Ghost_Entity (T);\n-      end if;\n-\n       --  Some common processing for all types\n \n       Set_Depends_On_Private (T, Has_Private_Component (T));"}]}