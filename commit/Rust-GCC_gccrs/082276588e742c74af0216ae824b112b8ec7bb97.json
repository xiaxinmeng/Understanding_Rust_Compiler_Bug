{"sha": "082276588e742c74af0216ae824b112b8ec7bb97", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6MDgyMjc2NTg4ZTc0MmM3NGFmMDIxNmFlODI0YjExMmI4ZWM3YmI5Nw==", "commit": {"author": {"name": "Mikhail Maltsev", "email": "maltsevm@gmail.com", "date": "2015-03-26T19:51:58Z"}, "committer": {"name": "Jason Merrill", "email": "jason@gcc.gnu.org", "date": "2015-03-26T19:51:58Z"}, "message": "re PR c++/65154 (ICE with {} initialized array with string)\n\n\tPR c++/65154\n\t* init.c (build_vec_init): Fix initializing aggregates\n\twith empty init list.\n\nFrom-SVN: r221704", "tree": {"sha": "4621d4112107ceb1f4cb50bd5eaee486ea48ada4", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/4621d4112107ceb1f4cb50bd5eaee486ea48ada4"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/082276588e742c74af0216ae824b112b8ec7bb97", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/082276588e742c74af0216ae824b112b8ec7bb97", "html_url": "https://github.com/Rust-GCC/gccrs/commit/082276588e742c74af0216ae824b112b8ec7bb97", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/082276588e742c74af0216ae824b112b8ec7bb97/comments", "author": {"login": "miyuki", "id": 4668268, "node_id": "MDQ6VXNlcjQ2NjgyNjg=", "avatar_url": "https://avatars.githubusercontent.com/u/4668268?v=4", "gravatar_id": "", "url": "https://api.github.com/users/miyuki", "html_url": "https://github.com/miyuki", "followers_url": "https://api.github.com/users/miyuki/followers", "following_url": "https://api.github.com/users/miyuki/following{/other_user}", "gists_url": "https://api.github.com/users/miyuki/gists{/gist_id}", "starred_url": "https://api.github.com/users/miyuki/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/miyuki/subscriptions", "organizations_url": "https://api.github.com/users/miyuki/orgs", "repos_url": "https://api.github.com/users/miyuki/repos", "events_url": "https://api.github.com/users/miyuki/events{/privacy}", "received_events_url": "https://api.github.com/users/miyuki/received_events", "type": "User", "site_admin": false}, "committer": null, "parents": [{"sha": "4280698d09e99c6881773d0850f98e4d1662103e", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/4280698d09e99c6881773d0850f98e4d1662103e", "html_url": "https://github.com/Rust-GCC/gccrs/commit/4280698d09e99c6881773d0850f98e4d1662103e"}], "stats": {"total": 58, "additions": 53, "deletions": 5}, "files": [{"sha": "684129b2200cf05abea199dcc8ccd36f04bd869d", "filename": "gcc/cp/ChangeLog", "status": "modified", "additions": 6, "deletions": 0, "changes": 6, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/082276588e742c74af0216ae824b112b8ec7bb97/gcc%2Fcp%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/082276588e742c74af0216ae824b112b8ec7bb97/gcc%2Fcp%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fcp%2FChangeLog?ref=082276588e742c74af0216ae824b112b8ec7bb97", "patch": "@@ -1,3 +1,9 @@\n+2015-03-26  Mikhail Maltsev  <maltsevm@gmail.com>\n+\n+\tPR c++/65154\n+\t* init.c (build_vec_init): Fix initializing aggregates\n+\twith empty init list.\n+\n 2015-03-26  Jason Merrill  <jason@redhat.com>\n \n \tPR c++/65525"}, {"sha": "957a7a4e6e8823096536bb974e95c2208b971a6f", "filename": "gcc/cp/init.c", "status": "modified", "additions": 1, "deletions": 5, "changes": 6, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/082276588e742c74af0216ae824b112b8ec7bb97/gcc%2Fcp%2Finit.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/082276588e742c74af0216ae824b112b8ec7bb97/gcc%2Fcp%2Finit.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fcp%2Finit.c?ref=082276588e742c74af0216ae824b112b8ec7bb97", "patch": "@@ -3716,11 +3716,7 @@ build_vec_init (tree base, tree maxindex, tree init,\n \t{\n \t  if (cxx_dialect >= cxx11 && AGGREGATE_TYPE_P (type))\n \t    {\n-\t      if (BRACE_ENCLOSED_INITIALIZER_P (init)\n-\t\t  && CONSTRUCTOR_NELTS (init) == 0)\n-\t\t/* Reuse it.  */;\n-\t      else\n-\t\tinit = build_constructor (init_list_type_node, NULL);\n+\t      init = build_constructor (init_list_type_node, NULL);\n \t      CONSTRUCTOR_IS_DIRECT_INIT (init) = true;\n \t    }\n \t  else"}, {"sha": "2fd89377162807b4c83de1fd3c6ecfb6b207ae19", "filename": "gcc/testsuite/g++.dg/init/array39.C", "status": "added", "additions": 46, "deletions": 0, "changes": 46, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/082276588e742c74af0216ae824b112b8ec7bb97/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Finit%2Farray39.C", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/082276588e742c74af0216ae824b112b8ec7bb97/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Finit%2Farray39.C", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Finit%2Farray39.C?ref=082276588e742c74af0216ae824b112b8ec7bb97", "patch": "@@ -0,0 +1,46 @@\n+// PR c++/65154\n+// { dg-do run { target c++11 } }\n+\n+int cnt1 = 0,\n+    cnt2 = 0;\n+\n+struct S_empty\n+{\n+    S_empty () {\n+\tcnt1++;\n+    };\n+};\n+\n+struct C1\n+{\n+  S_empty s;\n+};\n+\n+struct S_init\n+{\n+  S_init () : i(42)\n+  {\n+    cnt2++;\n+  };\n+  int i;\n+};\n+\n+struct C2\n+{\n+  S_init a, b;\n+};\n+\n+int\n+main ()\n+{\n+  C1 c1[5]{};\n+  C2 c2[1]{};\n+\n+  if (c2[0].a.i != 42 || c2[0].b.i != 42)\n+    return 1;\n+\n+  if (cnt1 != 5 || cnt2 != 2)\n+    return 1;\n+\n+  return 0;\n+}"}]}