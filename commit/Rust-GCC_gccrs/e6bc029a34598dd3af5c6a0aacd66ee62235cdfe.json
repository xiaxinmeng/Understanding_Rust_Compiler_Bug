{"sha": "e6bc029a34598dd3af5c6a0aacd66ee62235cdfe", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6ZTZiYzAyOWEzNDU5OGRkM2FmNWM2YTBhYWNkNjZlZTYyMjM1Y2RmZQ==", "commit": {"author": {"name": "Hristian Kirtchev", "email": "kirtchev@adacore.com", "date": "2018-07-17T08:07:37Z"}, "committer": {"name": "Pierre-Marie de Rodat", "email": "pmderodat@gcc.gnu.org", "date": "2018-07-17T08:07:37Z"}, "message": "[Ada] Spurious error on Part_Of indicator\n\nThis patch modifies the verification of a missing Part_Of indicator to avoid\nconsidering constants as visible state of a package instantiation because the\ncompiler cannot determine whether their values depend on variable input. This\ndiagnostic is left to GNATprove.\n\n------------\n-- Source --\n------------\n\n--  gnat.adc\n\npragma SPARK_Mode;\n\n--  gen_pack.ads\n\ngeneric\npackage Gen_Pack is\n   Val : constant Integer := 123;\nend Gen_Pack;\n\n--  pack.ads\n\nwith Gen_Pack;\n\npackage Pack\n  with Abstract_State => Pack_State\nis\n   procedure Force_Body;\nprivate\n   package Inst_1 is new Gen_Pack;                                   --  OK\n   package Inst_2 is new Gen_Pack with Part_Of => Pack_State;        --  OK\nend Pack;\n\n--  pack.adb\n\npackage body Pack\n  with Refined_State => (Pack_State => Inst_2.Val)\nis\n   procedure Force_Body is null;\nend Pack;\n\n-----------------\n-- Compilation --\n-----------------\n\n$ gcc -c pack.adb\n\n2018-07-17  Hristian Kirtchev  <kirtchev@adacore.com>\n\ngcc/ada/\n\n\t* sem_prag.adb (Has_Visible_State): Do not consider constants as\n\tvisible state because it is not possible to determine whether a\n\tconstant depends on variable input.\n\t(Propagate_Part_Of): Add comment clarifying the behavior with respect\n\tto constant.\n\nFrom-SVN: r262782", "tree": {"sha": "419525e839b5e749c0c7066c2f022a0daa290b8f", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/419525e839b5e749c0c7066c2f022a0daa290b8f"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/e6bc029a34598dd3af5c6a0aacd66ee62235cdfe", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/e6bc029a34598dd3af5c6a0aacd66ee62235cdfe", "html_url": "https://github.com/Rust-GCC/gccrs/commit/e6bc029a34598dd3af5c6a0aacd66ee62235cdfe", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/e6bc029a34598dd3af5c6a0aacd66ee62235cdfe/comments", "author": {"login": "kirtchev-adacore", "id": 60669983, "node_id": "MDQ6VXNlcjYwNjY5OTgz", "avatar_url": "https://avatars.githubusercontent.com/u/60669983?v=4", "gravatar_id": "", "url": "https://api.github.com/users/kirtchev-adacore", "html_url": "https://github.com/kirtchev-adacore", "followers_url": "https://api.github.com/users/kirtchev-adacore/followers", "following_url": "https://api.github.com/users/kirtchev-adacore/following{/other_user}", "gists_url": "https://api.github.com/users/kirtchev-adacore/gists{/gist_id}", "starred_url": "https://api.github.com/users/kirtchev-adacore/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/kirtchev-adacore/subscriptions", "organizations_url": "https://api.github.com/users/kirtchev-adacore/orgs", "repos_url": "https://api.github.com/users/kirtchev-adacore/repos", "events_url": "https://api.github.com/users/kirtchev-adacore/events{/privacy}", "received_events_url": "https://api.github.com/users/kirtchev-adacore/received_events", "type": "User", "site_admin": false}, "committer": null, "parents": [{"sha": "014eddc6d9cec9d0fd526b1e2d3d9cb4f0674f63", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/014eddc6d9cec9d0fd526b1e2d3d9cb4f0674f63", "html_url": "https://github.com/Rust-GCC/gccrs/commit/014eddc6d9cec9d0fd526b1e2d3d9cb4f0674f63"}], "stats": {"total": 21, "additions": 16, "deletions": 5}, "files": [{"sha": "c98f8d31b8e7a47d5fd970f0d51d3adf6eee00ff", "filename": "gcc/ada/ChangeLog", "status": "modified", "additions": 8, "deletions": 0, "changes": 8, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/e6bc029a34598dd3af5c6a0aacd66ee62235cdfe/gcc%2Fada%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/e6bc029a34598dd3af5c6a0aacd66ee62235cdfe/gcc%2Fada%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fada%2FChangeLog?ref=e6bc029a34598dd3af5c6a0aacd66ee62235cdfe", "patch": "@@ -1,3 +1,11 @@\n+2018-07-17  Hristian Kirtchev  <kirtchev@adacore.com>\n+\n+\t* sem_prag.adb (Has_Visible_State): Do not consider constants as\n+\tvisible state because it is not possible to determine whether a\n+\tconstant depends on variable input.\n+\t(Propagate_Part_Of): Add comment clarifying the behavior with respect\n+\tto constant.\n+\n 2018-07-17  Yannick Moy  <moy@adacore.com>\n \n \t* gnat1drv.adb (Gnat1drv): Do not issue warning about exception not"}, {"sha": "babae30bd60c04f4bbdc38c43707ffcbde7e8822", "filename": "gcc/ada/sem_prag.adb", "status": "modified", "additions": 8, "deletions": 5, "changes": 13, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/e6bc029a34598dd3af5c6a0aacd66ee62235cdfe/gcc%2Fada%2Fsem_prag.adb", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/e6bc029a34598dd3af5c6a0aacd66ee62235cdfe/gcc%2Fada%2Fsem_prag.adb", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fada%2Fsem_prag.adb?ref=e6bc029a34598dd3af5c6a0aacd66ee62235cdfe", "patch": "@@ -19991,6 +19991,9 @@ package body Sem_Prag is\n \n                      --  The Part_Of indicator turns an abstract state or an\n                      --  object into a constituent of the encapsulating state.\n+                     --  Note that constants are considered here even though\n+                     --  they may not depend on variable input. This check is\n+                     --  left to the SPARK prover.\n \n                      elsif Ekind_In (Item_Id, E_Abstract_State,\n                                               E_Constant,\n@@ -28789,12 +28792,12 @@ package body Sem_Prag is\n             elsif Is_Hidden (Item_Id) then\n                null;\n \n-            --  A visible state has been found\n+            --  A visible state has been found. Note that constants are not\n+            --  considered here because it is not possible to determine whether\n+            --  they depend on variable input. This check is left to the SPARK\n+            --  prover.\n \n-            elsif Ekind_In (Item_Id, E_Abstract_State,\n-                                     E_Constant,\n-                                     E_Variable)\n-            then\n+            elsif Ekind_In (Item_Id, E_Abstract_State, E_Variable) then\n                return True;\n \n             --  Recursively peek into nested packages and instantiations"}]}