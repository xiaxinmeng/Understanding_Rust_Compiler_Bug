{"sha": "ed9091b270721c399112c74eb15b7fc27ef127db", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6ZWQ5MDkxYjI3MDcyMWMzOTkxMTJjNzRlYjE1YjdmYzI3ZWYxMjdkYg==", "commit": {"author": {"name": "Tom de Vries", "email": "tom@codesourcery.com", "date": "2017-07-17T07:49:22Z"}, "committer": {"name": "Tom de Vries", "email": "vries@gcc.gnu.org", "date": "2017-07-17T07:49:22Z"}, "message": "Insert diverging jump alap in nvptx_single\n\n2017-07-17  Tom de Vries  <tom@codesourcery.com>\n\n\tPR target/81069\n\t* config/nvptx/nvptx.c (nvptx_single): Insert diverging branch as late\n\tas possible.\n\nFrom-SVN: r250256", "tree": {"sha": "7019227b7ddb7c922f854ef0e4a444bb2f945a00", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/7019227b7ddb7c922f854ef0e4a444bb2f945a00"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/ed9091b270721c399112c74eb15b7fc27ef127db", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/ed9091b270721c399112c74eb15b7fc27ef127db", "html_url": "https://github.com/Rust-GCC/gccrs/commit/ed9091b270721c399112c74eb15b7fc27ef127db", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/ed9091b270721c399112c74eb15b7fc27ef127db/comments", "author": null, "committer": null, "parents": [{"sha": "42ec024baa1bc9de83c8fcefe543f58a6939068d", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/42ec024baa1bc9de83c8fcefe543f58a6939068d", "html_url": "https://github.com/Rust-GCC/gccrs/commit/42ec024baa1bc9de83c8fcefe543f58a6939068d"}], "stats": {"total": 28, "additions": 25, "deletions": 3}, "files": [{"sha": "67b7ff12d95f8208708ef6e8e72645f4a5256328", "filename": "gcc/ChangeLog", "status": "modified", "additions": 6, "deletions": 0, "changes": 6, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/ed9091b270721c399112c74eb15b7fc27ef127db/gcc%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/ed9091b270721c399112c74eb15b7fc27ef127db/gcc%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2FChangeLog?ref=ed9091b270721c399112c74eb15b7fc27ef127db", "patch": "@@ -1,3 +1,9 @@\n+2017-07-17  Tom de Vries  <tom@codesourcery.com>\n+\n+\tPR target/81069\n+\t* config/nvptx/nvptx.c (nvptx_single): Insert diverging branch as late\n+\tas possible.\n+\n 2017-07-17  Sebastian Huber  <sebastian.huber@embedded-brains.de>\n \n \t*  gcc/config/sparc/rtemself.h (TARGET_OS_CPP_BUILTINS): Add"}, {"sha": "78ce12134977d88c084f19fcde4d52fdd87aafa8", "filename": "gcc/config/nvptx/nvptx.c", "status": "modified", "additions": 19, "deletions": 3, "changes": 22, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/ed9091b270721c399112c74eb15b7fc27ef127db/gcc%2Fconfig%2Fnvptx%2Fnvptx.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/ed9091b270721c399112c74eb15b7fc27ef127db/gcc%2Fconfig%2Fnvptx%2Fnvptx.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fconfig%2Fnvptx%2Fnvptx.c?ref=ed9091b270721c399112c74eb15b7fc27ef127db", "patch": "@@ -3886,9 +3886,25 @@ nvptx_single (unsigned mask, basic_block from, basic_block to)\n   rtx_insn *tail = BB_END (to);\n   unsigned skip_mask = mask;\n \n-  /* Find first insn of from block */\n-  while (head != BB_END (from) && !INSN_P (head))\n-    head = NEXT_INSN (head);\n+  while (true)\n+    {\n+      /* Find first insn of from block.  */\n+      while (head != BB_END (from) && !INSN_P (head))\n+\thead = NEXT_INSN (head);\n+\n+      if (from == to)\n+\tbreak;\n+\n+      if (!(JUMP_P (head) && single_succ_p (from)))\n+\tbreak;\n+\n+      basic_block jump_target = single_succ (from);\n+      if (!single_pred_p (jump_target))\n+\tbreak;\n+\n+      from = jump_target;\n+      head = BB_HEAD (from);\n+    }\n \n   /* Find last insn of to block */\n   rtx_insn *limit = from == to ? head : BB_HEAD (to);"}]}