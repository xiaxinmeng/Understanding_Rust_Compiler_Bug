{"sha": "cf3caeaf0ac59e858ff2ae54e59dc5a2bf51961d", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6Y2YzY2FlYWYwYWM1OWU4NThmZjJhZTU0ZTU5ZGM1YTJiZjUxOTYxZA==", "commit": {"author": {"name": "Nicola Pero", "email": "nicola.pero@meta-innovation.com", "date": "2011-04-12T17:37:39Z"}, "committer": {"name": "Nicola Pero", "email": "nicola@gcc.gnu.org", "date": "2011-04-12T17:37:39Z"}, "message": "In gcc/objc/: 2011-04-12 Nicola Pero <nicola.pero@meta-innovation.com>\n\nIn gcc/objc/:\n2011-04-12  Nicola Pero  <nicola.pero@meta-innovation.com>\n\n\t* objc-act.c (printable_ivar_name): New.\n\t(add_instance_variable): Call printable_ivar_name() when an error\n\tmessage needs to be printed.  Do not prepare the instance variable\n\tfor printing unless there is an actual error.\n\nFrom-SVN: r172328", "tree": {"sha": "531915bec0ef305654436c7d88baa27569068158", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/531915bec0ef305654436c7d88baa27569068158"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/cf3caeaf0ac59e858ff2ae54e59dc5a2bf51961d", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/cf3caeaf0ac59e858ff2ae54e59dc5a2bf51961d", "html_url": "https://github.com/Rust-GCC/gccrs/commit/cf3caeaf0ac59e858ff2ae54e59dc5a2bf51961d", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/cf3caeaf0ac59e858ff2ae54e59dc5a2bf51961d/comments", "author": {"login": "Nico-31415", "id": 94470564, "node_id": "U_kgDOBaGBpA", "avatar_url": "https://avatars.githubusercontent.com/u/94470564?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Nico-31415", "html_url": "https://github.com/Nico-31415", "followers_url": "https://api.github.com/users/Nico-31415/followers", "following_url": "https://api.github.com/users/Nico-31415/following{/other_user}", "gists_url": "https://api.github.com/users/Nico-31415/gists{/gist_id}", "starred_url": "https://api.github.com/users/Nico-31415/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Nico-31415/subscriptions", "organizations_url": "https://api.github.com/users/Nico-31415/orgs", "repos_url": "https://api.github.com/users/Nico-31415/repos", "events_url": "https://api.github.com/users/Nico-31415/events{/privacy}", "received_events_url": "https://api.github.com/users/Nico-31415/received_events", "type": "User", "site_admin": false}, "committer": null, "parents": [{"sha": "0d8a2528265c57e2fd0c90f33c38f603db43695a", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/0d8a2528265c57e2fd0c90f33c38f603db43695a", "html_url": "https://github.com/Rust-GCC/gccrs/commit/0d8a2528265c57e2fd0c90f33c38f603db43695a"}], "stats": {"total": 31, "additions": 24, "deletions": 7}, "files": [{"sha": "2c38853fd5706bae16db7908799e53ab4bd9fbc3", "filename": "gcc/objc/ChangeLog", "status": "modified", "additions": 7, "deletions": 0, "changes": 7, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/cf3caeaf0ac59e858ff2ae54e59dc5a2bf51961d/gcc%2Fobjc%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/cf3caeaf0ac59e858ff2ae54e59dc5a2bf51961d/gcc%2Fobjc%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fobjc%2FChangeLog?ref=cf3caeaf0ac59e858ff2ae54e59dc5a2bf51961d", "patch": "@@ -1,3 +1,10 @@\n+2011-04-12  Nicola Pero  <nicola.pero@meta-innovation.com>\n+\n+\t* objc-act.c (printable_ivar_name): New.\n+\t(add_instance_variable): Call printable_ivar_name() when an error\n+\tmessage needs to be printed.  Do not prepare the instance variable\n+\tfor printing unless there is an actual error.\n+\n 2011-04-12  Nicola Pero  <nicola.pero@meta-innovation.com>\n \n \t* objc-act.c (objc_is_class_name, objc_is_id): For efficiency,"}, {"sha": "75e11da97f98badc63484e183e7d94440a0657cd", "filename": "gcc/objc/objc-act.c", "status": "modified", "additions": 17, "deletions": 7, "changes": 24, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/cf3caeaf0ac59e858ff2ae54e59dc5a2bf51961d/gcc%2Fobjc%2Fobjc-act.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/cf3caeaf0ac59e858ff2ae54e59dc5a2bf51961d/gcc%2Fobjc%2Fobjc-act.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fobjc%2Fobjc-act.c?ref=cf3caeaf0ac59e858ff2ae54e59dc5a2bf51961d", "patch": "@@ -5983,6 +5983,17 @@ flexible_array_type_p (tree type)\n }\n #endif\n \n+/* Produce a printable version of an ivar name.  This is only used\n+   inside add_instance_variable.  */\n+static const char *\n+printable_ivar_name (tree field_decl)\n+{\n+  if (DECL_NAME (field_decl))\n+    return identifier_to_locale (IDENTIFIER_POINTER (DECL_NAME (field_decl)));\n+  else\n+    return _(\"<unnamed>\");\n+}\n+\n /* Called after parsing each instance variable declaration. Necessary to\n    preserve typedefs and implement public/private...\n \n@@ -5993,15 +6004,12 @@ add_instance_variable (tree klass, objc_ivar_visibility_kind visibility,\n \t\t       tree field_decl)\n {\n   tree field_type = TREE_TYPE (field_decl);\n-  const char *ivar_name = DECL_NAME (field_decl)\n-\t\t\t  ? identifier_to_locale (IDENTIFIER_POINTER (DECL_NAME (field_decl)))\n-\t\t\t  : _(\"<unnamed>\");\n \n #ifdef OBJCPLUS\n   if (TREE_CODE (field_type) == REFERENCE_TYPE)\n     {\n       error (\"illegal reference type specified for instance variable %qs\",\n-\t     ivar_name);\n+\t     printable_ivar_name (field_decl));\n       /* Return class as is without adding this ivar.  */\n       return klass;\n     }\n@@ -6011,7 +6019,8 @@ add_instance_variable (tree klass, objc_ivar_visibility_kind visibility,\n       || TYPE_SIZE (field_type) == error_mark_node)\n       /* 'type[0]' is allowed, but 'type[]' is not! */\n     {\n-      error (\"instance variable %qs has unknown size\", ivar_name);\n+      error (\"instance variable %qs has unknown size\",\n+\t     printable_ivar_name (field_decl));\n       /* Return class as is without adding this ivar.  */\n       return klass;\n     }\n@@ -6031,7 +6040,8 @@ add_instance_variable (tree klass, objc_ivar_visibility_kind visibility,\n        to calculate the offset of the next instance variable.  */\n   if (flexible_array_type_p (field_type))\n     {\n-      error (\"instance variable %qs uses flexible array member\", ivar_name);\n+      error (\"instance variable %qs uses flexible array member\",\n+\t     printable_ivar_name (field_decl));\n       /* Return class as is without adding this ivar.  */\n       return klass;      \n     }\n@@ -6078,7 +6088,7 @@ add_instance_variable (tree klass, objc_ivar_visibility_kind visibility,\n \t      error (\"type %qE has virtual member functions\", type_name);\n \t      error (\"illegal aggregate type %qE specified \"\n \t\t     \"for instance variable %qs\",\n-\t\t     type_name, ivar_name);\n+\t\t     type_name, printable_ivar_name (field_decl));\n \t      /* Return class as is without adding this ivar.  */\n \t      return klass;\n \t    }"}]}