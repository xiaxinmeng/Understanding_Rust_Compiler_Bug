{"sha": "ee077fcb8cdb4b4b54e4e7363eec401607c08c2c", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6ZWUwNzdmY2I4Y2RiNGI0YjU0ZTRlNzM2M2VlYzQwMTYwN2MwOGMyYw==", "commit": {"author": {"name": "Paul Thomas", "email": "pault@gcc.gnu.org", "date": "2017-10-18T08:55:27Z"}, "committer": {"name": "Paul Thomas", "email": "pault@gcc.gnu.org", "date": "2017-10-18T08:55:27Z"}, "message": "re PR fortran/82550 (program using submodules fails to link)\n\n2017-10-18  Paul Thomas  <pault@gcc.gnu.org>\n\n\tPR fortran/82550\n\t* trans_decl.c (gfc_get_symbol_decl): Procedure symbols that\n\thave the 'used_in_submodule' attribute should be processed by\n\t'gfc_get_extern_function_decl'.\n\n2017-10-18  Paul Thomas  <pault@gcc.gnu.org>\n\n\tPR fortran/82550\n\t* gfortran.dg/submodule_30.f08 : New test.\n\nFrom-SVN: r253848", "tree": {"sha": "fd3c94ed0ddeea9c01879839f77bc413085d7183", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/fd3c94ed0ddeea9c01879839f77bc413085d7183"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/ee077fcb8cdb4b4b54e4e7363eec401607c08c2c", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/ee077fcb8cdb4b4b54e4e7363eec401607c08c2c", "html_url": "https://github.com/Rust-GCC/gccrs/commit/ee077fcb8cdb4b4b54e4e7363eec401607c08c2c", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/ee077fcb8cdb4b4b54e4e7363eec401607c08c2c/comments", "author": null, "committer": null, "parents": [{"sha": "04612f7f8452021ad4eba08f03bc98b196753330", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/04612f7f8452021ad4eba08f03bc98b196753330", "html_url": "https://github.com/Rust-GCC/gccrs/commit/04612f7f8452021ad4eba08f03bc98b196753330"}], "stats": {"total": 58, "additions": 57, "deletions": 1}, "files": [{"sha": "ab2665098791ee93549e0396aedc43a3d99c89b0", "filename": "gcc/fortran/ChangeLog", "status": "modified", "additions": 7, "deletions": 0, "changes": 7, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/ee077fcb8cdb4b4b54e4e7363eec401607c08c2c/gcc%2Ffortran%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/ee077fcb8cdb4b4b54e4e7363eec401607c08c2c/gcc%2Ffortran%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ffortran%2FChangeLog?ref=ee077fcb8cdb4b4b54e4e7363eec401607c08c2c", "patch": "@@ -1,3 +1,10 @@\n+2017-10-18  Paul Thomas  <pault@gcc.gnu.org>\n+\n+\tPR fortran/82550\n+\t* trans_decl.c (gfc_get_symbol_decl): Procedure symbols that\n+\thave the 'used_in_submodule' attribute should be processed by\n+\t'gfc_get_extern_function_decl'.\n+\n 2017-10-16  Fritz Reese <fritzoreese@gmail.com>\n \n \tPR fortran/82511"}, {"sha": "c21611c5d6c874ce5715d8ab5bb9b42c638cf95a", "filename": "gcc/fortran/trans-decl.c", "status": "modified", "additions": 3, "deletions": 1, "changes": 4, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/ee077fcb8cdb4b4b54e4e7363eec401607c08c2c/gcc%2Ffortran%2Ftrans-decl.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/ee077fcb8cdb4b4b54e4e7363eec401607c08c2c/gcc%2Ffortran%2Ftrans-decl.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ffortran%2Ftrans-decl.c?ref=ee077fcb8cdb4b4b54e4e7363eec401607c08c2c", "patch": "@@ -1670,7 +1670,9 @@ gfc_get_symbol_decl (gfc_symbol * sym)\n     {\n       /* Catch functions. Only used for actual parameters,\n \t procedure pointers and procptr initialization targets.  */\n-      if (sym->attr.use_assoc || sym->attr.intrinsic\n+      if (sym->attr.use_assoc\n+\t  || sym->attr.used_in_submodule\n+\t  || sym->attr.intrinsic\n \t  || sym->attr.if_source != IFSRC_DECL)\n \t{\n \t  decl = gfc_get_extern_function_decl (sym);"}, {"sha": "a43894f2ad65057094ced719bfbcff623d4db432", "filename": "gcc/testsuite/ChangeLog", "status": "modified", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/ee077fcb8cdb4b4b54e4e7363eec401607c08c2c/gcc%2Ftestsuite%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/ee077fcb8cdb4b4b54e4e7363eec401607c08c2c/gcc%2Ftestsuite%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2FChangeLog?ref=ee077fcb8cdb4b4b54e4e7363eec401607c08c2c", "patch": "@@ -1,3 +1,8 @@\n+017-10-18  Paul Thomas  <pault@gcc.gnu.org>\n+\n+\tPR fortran/82550\n+\t* gfortran.dg/submodule_30.f08 : New test.\n+\n 2017-10-18  Andreas Krebbel  <krebbel@linux.vnet.ibm.com>\n \n \t* gcc.target/s390/zvector/vec-cmp-2.c"}, {"sha": "25dcbebe6567858611e247dd067863ee2d0505db", "filename": "gcc/testsuite/gfortran.dg/submodule_30.f08", "status": "added", "additions": 42, "deletions": 0, "changes": 42, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/ee077fcb8cdb4b4b54e4e7363eec401607c08c2c/gcc%2Ftestsuite%2Fgfortran.dg%2Fsubmodule_30.f08", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/ee077fcb8cdb4b4b54e4e7363eec401607c08c2c/gcc%2Ftestsuite%2Fgfortran.dg%2Fsubmodule_30.f08", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgfortran.dg%2Fsubmodule_30.f08?ref=ee077fcb8cdb4b4b54e4e7363eec401607c08c2c", "patch": "@@ -0,0 +1,42 @@\n+! { dg-do run }\n+!\n+! Test the fix for PR82550 in which the reference to 'p' in 'foo'\n+! was not being correctly handled.\n+!\n+! Contributed by Reinhold Bader  <Bader@lrz.de>\n+!\n+module m_subm_18_pos\n+  implicit none\n+  integer :: i = 0\n+  interface\n+    module subroutine foo(fun_ptr)\n+      procedure(p), pointer, intent(out) :: fun_ptr\n+    end subroutine\n+  end interface\n+contains\n+  subroutine p()\n+    i = 1\n+  end subroutine p\n+end module m_subm_18_pos\n+submodule (m_subm_18_pos) subm_18_pos\n+    implicit none\n+contains\n+    module subroutine foo(fun_ptr)\n+      procedure(p), pointer, intent(out) :: fun_ptr\n+      fun_ptr => p\n+    end subroutine\n+end submodule\n+program p_18_pos\n+  use m_subm_18_pos\n+  implicit none\n+  procedure(), pointer :: x\n+  call foo(x)\n+  call x()\n+  if (i == 1) then\n+     write(*,*) 'OK'\n+  else\n+     write(*,*) 'FAIL'\n+     call abort\n+  end if\n+end program p_18_pos\n+"}]}