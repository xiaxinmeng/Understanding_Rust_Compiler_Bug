{"sha": "c86a16b07b76604a8e3d556f135babab80e2b747", "node_id": "C_kwDOANBUbNoAKGM4NmExNmIwN2I3NjYwNGE4ZTNkNTU2ZjEzNWJhYmFiODBlMmI3NDc", "commit": {"author": {"name": "Iain Buclaw", "email": "ibuclaw@gdcproject.org", "date": "2021-10-03T14:02:24Z"}, "committer": {"name": "Iain Buclaw", "email": "ibuclaw@gdcproject.org", "date": "2021-10-04T15:07:30Z"}, "message": "d: gdc driver ignores -static-libstdc++ when automatically linking libstdc++ library\n\nAdds handling of `-static-libstc++' in the gdc driver, so that libstdc++\nis appropriately linked if libstdc++ is either needed or seen on the\ncommand-line.\n\n\tPR d/102574\n\ngcc/d/ChangeLog:\n\n\t* d-spec.cc (lang_specific_driver): Link libstdc++ statically if\n\t-static-libstdc++ was given on command-line.", "tree": {"sha": "565a1b89cf65a6ee3dd20e003871f4c54ab702b0", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/565a1b89cf65a6ee3dd20e003871f4c54ab702b0"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/c86a16b07b76604a8e3d556f135babab80e2b747", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/c86a16b07b76604a8e3d556f135babab80e2b747", "html_url": "https://github.com/Rust-GCC/gccrs/commit/c86a16b07b76604a8e3d556f135babab80e2b747", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/c86a16b07b76604a8e3d556f135babab80e2b747/comments", "author": {"login": "ibuclaw", "id": 397929, "node_id": "MDQ6VXNlcjM5NzkyOQ==", "avatar_url": "https://avatars.githubusercontent.com/u/397929?v=4", "gravatar_id": "", "url": "https://api.github.com/users/ibuclaw", "html_url": "https://github.com/ibuclaw", "followers_url": "https://api.github.com/users/ibuclaw/followers", "following_url": "https://api.github.com/users/ibuclaw/following{/other_user}", "gists_url": "https://api.github.com/users/ibuclaw/gists{/gist_id}", "starred_url": "https://api.github.com/users/ibuclaw/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/ibuclaw/subscriptions", "organizations_url": "https://api.github.com/users/ibuclaw/orgs", "repos_url": "https://api.github.com/users/ibuclaw/repos", "events_url": "https://api.github.com/users/ibuclaw/events{/privacy}", "received_events_url": "https://api.github.com/users/ibuclaw/received_events", "type": "User", "site_admin": false}, "committer": {"login": "ibuclaw", "id": 397929, "node_id": "MDQ6VXNlcjM5NzkyOQ==", "avatar_url": "https://avatars.githubusercontent.com/u/397929?v=4", "gravatar_id": "", "url": "https://api.github.com/users/ibuclaw", "html_url": "https://github.com/ibuclaw", "followers_url": "https://api.github.com/users/ibuclaw/followers", "following_url": "https://api.github.com/users/ibuclaw/following{/other_user}", "gists_url": "https://api.github.com/users/ibuclaw/gists{/gist_id}", "starred_url": "https://api.github.com/users/ibuclaw/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/ibuclaw/subscriptions", "organizations_url": "https://api.github.com/users/ibuclaw/orgs", "repos_url": "https://api.github.com/users/ibuclaw/repos", "events_url": "https://api.github.com/users/ibuclaw/events{/privacy}", "received_events_url": "https://api.github.com/users/ibuclaw/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "c4ee0965371c9b243cca1305b443f54c5e4e236a", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/c4ee0965371c9b243cca1305b443f54c5e4e236a", "html_url": "https://github.com/Rust-GCC/gccrs/commit/c4ee0965371c9b243cca1305b443f54c5e4e236a"}], "stats": {"total": 43, "additions": 34, "deletions": 9}, "files": [{"sha": "5adc662c6f2509ce75507c3c704c38989773206a", "filename": "gcc/d/d-spec.cc", "status": "modified", "additions": 34, "deletions": 9, "changes": 43, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/c86a16b07b76604a8e3d556f135babab80e2b747/gcc%2Fd%2Fd-spec.cc", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/c86a16b07b76604a8e3d556f135babab80e2b747/gcc%2Fd%2Fd-spec.cc", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fd%2Fd-spec.cc?ref=c86a16b07b76604a8e3d556f135babab80e2b747", "patch": "@@ -83,6 +83,9 @@ lang_specific_driver (cl_decoded_option **in_decoded_options,\n   /* \"-lstdc++\" if it appears on the command line.  */\n   const cl_decoded_option *saw_libcxx = 0;\n \n+  /* True if we saw `-static-libstdc++'.  */\n+  bool saw_static_libcxx = false;\n+\n   /* Whether we need the C++ STD library.  */\n   bool need_stdcxx = false;\n \n@@ -248,6 +251,11 @@ lang_specific_driver (cl_decoded_option **in_decoded_options,\n \t  shared_libgcc = false;\n \t  break;\n \n+\tcase OPT_static_libstdc__:\n+\t  saw_static_libcxx = true;\n+\t  args[i] |= SKIPOPT;\n+\t  break;\n+\n \tcase OPT_static_libphobos:\n \t  if (phobos_library != PHOBOS_NOLINK)\n \t    phobos_library = PHOBOS_STATIC;\n@@ -452,16 +460,33 @@ lang_specific_driver (cl_decoded_option **in_decoded_options,\n #endif\n     }\n \n-  if (saw_libcxx)\n-    new_decoded_options[j++] = *saw_libcxx;\n-  else if (need_stdcxx)\n+  if (saw_libcxx || need_stdcxx)\n     {\n-      generate_option (OPT_l,\n-\t\t       (saw_profile_flag\n-\t\t\t? LIBSTDCXX_PROFILE\n-\t\t\t: LIBSTDCXX),\n-\t\t       1, CL_DRIVER, &new_decoded_options[j++]);\n-      added_libraries++;\n+#ifdef HAVE_LD_STATIC_DYNAMIC\n+      if (saw_static_libcxx && !static_link)\n+\t{\n+\t  generate_option (OPT_Wl_, LD_STATIC_OPTION, 1, CL_DRIVER,\n+\t\t\t   &new_decoded_options[j++]);\n+\t}\n+#endif\n+      if (saw_libcxx)\n+\tnew_decoded_options[j++] = *saw_libcxx;\n+      else if (need_stdcxx)\n+\t{\n+\t  generate_option (OPT_l,\n+\t\t\t   (saw_profile_flag\n+\t\t\t    ? LIBSTDCXX_PROFILE\n+\t\t\t    : LIBSTDCXX),\n+\t\t\t   1, CL_DRIVER, &new_decoded_options[j++]);\n+\t  added_libraries++;\n+\t}\n+#ifdef HAVE_LD_STATIC_DYNAMIC\n+      if (saw_static_libcxx && !static_link)\n+\t{\n+\t  generate_option (OPT_Wl_, LD_DYNAMIC_OPTION, 1, CL_DRIVER,\n+\t\t\t   &new_decoded_options[j++]);\n+\t}\n+#endif\n     }\n \n   if (shared_libgcc && !static_link)"}]}