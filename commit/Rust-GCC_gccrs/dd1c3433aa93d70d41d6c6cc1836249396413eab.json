{"sha": "dd1c3433aa93d70d41d6c6cc1836249396413eab", "node_id": "C_kwDOANBUbNoAKGRkMWMzNDMzYWE5M2Q3MGQ0MWQ2YzZjYzE4MzYyNDkzOTY0MTNlYWI", "commit": {"author": {"name": "Piotr Trojanek", "email": "trojanek@adacore.com", "date": "2022-06-06T12:01:35Z"}, "committer": {"name": "Pierre-Marie de Rodat", "email": "derodat@adacore.com", "date": "2022-07-05T08:28:19Z"}, "message": "[Ada] Cleanup repeated code for aggregate constraints checks\n\nCode cleanup related to examining uses of Check_Unset_Reference for\nimproved detection of uninitialised scalar objects. Semantics is\nunaffected.\n\ngcc/ada/\n\n\t* sem_util.adb (Aggregate_Constraint_Checks): Fix whitespace;\n\trefactor repeated code; replace a ??? comment with an\n\texplanation based on the comment for the routine spec.", "tree": {"sha": "adc61e157bc29622a2c5b4dd91502688b5c7ad26", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/adc61e157bc29622a2c5b4dd91502688b5c7ad26"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/dd1c3433aa93d70d41d6c6cc1836249396413eab", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/dd1c3433aa93d70d41d6c6cc1836249396413eab", "html_url": "https://github.com/Rust-GCC/gccrs/commit/dd1c3433aa93d70d41d6c6cc1836249396413eab", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/dd1c3433aa93d70d41d6c6cc1836249396413eab/comments", "author": {"login": "ptroja", "id": 161602, "node_id": "MDQ6VXNlcjE2MTYwMg==", "avatar_url": "https://avatars.githubusercontent.com/u/161602?v=4", "gravatar_id": "", "url": "https://api.github.com/users/ptroja", "html_url": "https://github.com/ptroja", "followers_url": "https://api.github.com/users/ptroja/followers", "following_url": "https://api.github.com/users/ptroja/following{/other_user}", "gists_url": "https://api.github.com/users/ptroja/gists{/gist_id}", "starred_url": "https://api.github.com/users/ptroja/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/ptroja/subscriptions", "organizations_url": "https://api.github.com/users/ptroja/orgs", "repos_url": "https://api.github.com/users/ptroja/repos", "events_url": "https://api.github.com/users/ptroja/events{/privacy}", "received_events_url": "https://api.github.com/users/ptroja/received_events", "type": "User", "site_admin": false}, "committer": {"login": "pmderodat", "id": 758452, "node_id": "MDQ6VXNlcjc1ODQ1Mg==", "avatar_url": "https://avatars.githubusercontent.com/u/758452?v=4", "gravatar_id": "", "url": "https://api.github.com/users/pmderodat", "html_url": "https://github.com/pmderodat", "followers_url": "https://api.github.com/users/pmderodat/followers", "following_url": "https://api.github.com/users/pmderodat/following{/other_user}", "gists_url": "https://api.github.com/users/pmderodat/gists{/gist_id}", "starred_url": "https://api.github.com/users/pmderodat/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/pmderodat/subscriptions", "organizations_url": "https://api.github.com/users/pmderodat/orgs", "repos_url": "https://api.github.com/users/pmderodat/repos", "events_url": "https://api.github.com/users/pmderodat/events{/privacy}", "received_events_url": "https://api.github.com/users/pmderodat/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "074e8addc5d8e92d9446357b961c003fe06dcc50", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/074e8addc5d8e92d9446357b961c003fe06dcc50", "html_url": "https://github.com/Rust-GCC/gccrs/commit/074e8addc5d8e92d9446357b961c003fe06dcc50"}], "stats": {"total": 25, "additions": 10, "deletions": 15}, "files": [{"sha": "df9fed1c159209d7739ab47409313076a0084ca4", "filename": "gcc/ada/sem_util.adb", "status": "modified", "additions": 10, "deletions": 15, "changes": 25, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/dd1c3433aa93d70d41d6c6cc1836249396413eab/gcc%2Fada%2Fsem_util.adb", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/dd1c3433aa93d70d41d6c6cc1836249396413eab/gcc%2Fada%2Fsem_util.adb", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fada%2Fsem_util.adb?ref=dd1c3433aa93d70d41d6c6cc1836249396413eab", "patch": "@@ -1153,7 +1153,7 @@ package body Sem_Util is\n      (Exp       : Node_Id;\n       Check_Typ : Entity_Id)\n    is\n-      Exp_Typ : constant Entity_Id  := Etype (Exp);\n+      Exp_Typ : constant Entity_Id := Etype (Exp);\n \n    begin\n       if Raises_Constraint_Error (Exp) then\n@@ -1236,33 +1236,28 @@ package body Sem_Util is\n         and then Is_Scalar_Type (Check_Typ)\n         and then Exp_Typ /= Check_Typ\n       then\n+         --  If expression is a constant, it is worthwhile checking whether it\n+         --  is a bound of the type.\n+\n          if Is_Entity_Name (Exp)\n            and then Ekind (Entity (Exp)) = E_Constant\n          then\n-            --  If expression is a constant, it is worthwhile checking whether\n-            --  it is a bound of the type.\n-\n             if (Is_Entity_Name (Type_Low_Bound (Check_Typ))\n                  and then Entity (Exp) = Entity (Type_Low_Bound (Check_Typ)))\n               or else\n                (Is_Entity_Name (Type_High_Bound (Check_Typ))\n                  and then Entity (Exp) = Entity (Type_High_Bound (Check_Typ)))\n             then\n                return;\n-\n-            else\n-               Rewrite (Exp, Convert_To (Check_Typ, Relocate_Node (Exp)));\n-               Analyze_And_Resolve (Exp, Check_Typ);\n-               Check_Unset_Reference (Exp);\n             end if;\n+         end if;\n \n-         --  Could use a comment on this case ???\n+         --  Change Exp into Check_Typ'(Exp) to ensure that range checks are\n+         --  performed at run time.\n \n-         else\n-            Rewrite (Exp, Convert_To (Check_Typ, Relocate_Node (Exp)));\n-            Analyze_And_Resolve (Exp, Check_Typ);\n-            Check_Unset_Reference (Exp);\n-         end if;\n+         Rewrite (Exp, Convert_To (Check_Typ, Relocate_Node (Exp)));\n+         Analyze_And_Resolve (Exp, Check_Typ);\n+         Check_Unset_Reference (Exp);\n \n       end if;\n    end Aggregate_Constraint_Checks;"}]}