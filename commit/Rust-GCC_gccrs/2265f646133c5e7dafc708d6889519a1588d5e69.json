{"sha": "2265f646133c5e7dafc708d6889519a1588d5e69", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6MjI2NWY2NDYxMzNjNWU3ZGFmYzcwOGQ2ODg5NTE5YTE1ODhkNWU2OQ==", "commit": {"author": {"name": "Andreas Tobler", "email": "a.tobler@schweiz.org", "date": "2009-11-02T21:18:17Z"}, "committer": {"name": "Andreas Tobler", "email": "andreast@gcc.gnu.org", "date": "2009-11-02T21:18:17Z"}, "message": "re PR libffi/41908 (closures fail for some structure arguments containing floats)\n\n2009-11-02  Andreas Tobler  <a.tobler@schweiz.org>\n\n\tPR libffi/41908\n\t* testsuite/libffi.call/testclosure.c: New test.\n\nFrom-SVN: r153824", "tree": {"sha": "95f0b6571234cb212d5311ca22bf669adf744064", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/95f0b6571234cb212d5311ca22bf669adf744064"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/2265f646133c5e7dafc708d6889519a1588d5e69", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/2265f646133c5e7dafc708d6889519a1588d5e69", "html_url": "https://github.com/Rust-GCC/gccrs/commit/2265f646133c5e7dafc708d6889519a1588d5e69", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/2265f646133c5e7dafc708d6889519a1588d5e69/comments", "author": null, "committer": null, "parents": [{"sha": "9d5874cf05b0cabd722dfbc1d5acb8c11f067fc7", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/9d5874cf05b0cabd722dfbc1d5acb8c11f067fc7", "html_url": "https://github.com/Rust-GCC/gccrs/commit/9d5874cf05b0cabd722dfbc1d5acb8c11f067fc7"}], "stats": {"total": 75, "additions": 75, "deletions": 0}, "files": [{"sha": "651a01e0b6ee2a1297fd8cc2cec99dcdb4c2e0c1", "filename": "libffi/ChangeLog", "status": "modified", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/2265f646133c5e7dafc708d6889519a1588d5e69/libffi%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/2265f646133c5e7dafc708d6889519a1588d5e69/libffi%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libffi%2FChangeLog?ref=2265f646133c5e7dafc708d6889519a1588d5e69", "patch": "@@ -1,3 +1,8 @@\n+2009-11-02  Andreas Tobler  <a.tobler@schweiz.org>\n+\n+\tPR libffi/41908\n+\t* testsuite/libffi.call/testclosure.c: New test.\n+\n 2009-09-28  Kai Tietz  <kai.tietz@onevision.com>\n \n \t* src/x86/win64.S (_ffi_call_win64 stack): Remove for gnu"}, {"sha": "161cc891798670dfbe12e7001f72a376cd827bc4", "filename": "libffi/testsuite/libffi.call/testclosure.c", "status": "added", "additions": 70, "deletions": 0, "changes": 70, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/2265f646133c5e7dafc708d6889519a1588d5e69/libffi%2Ftestsuite%2Flibffi.call%2Ftestclosure.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/2265f646133c5e7dafc708d6889519a1588d5e69/libffi%2Ftestsuite%2Flibffi.call%2Ftestclosure.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libffi%2Ftestsuite%2Flibffi.call%2Ftestclosure.c?ref=2265f646133c5e7dafc708d6889519a1588d5e69", "patch": "@@ -0,0 +1,70 @@\n+/* Area:\tclosure_call\n+   Purpose:\tCheck return value float.\n+   Limitations:\tnone.\n+   PR:\t\t41908.\n+   Originator:\t<rfm@gnu.org> 20091102\t */\n+\n+/* { dg-do run } */\n+#include \"ffitest.h\"\n+\n+typedef struct cls_struct_combined {\n+  float a;\n+  float b;\n+  float c;\n+  float d;\n+} cls_struct_combined;\n+\n+void cls_struct_combined_fn(struct cls_struct_combined arg)\n+{\n+  printf(\"%g %g %g %g\\n\",\n+\t arg.a, arg.b,\n+\t arg.c, arg.d);\n+  fflush(stdout);\n+}\n+\n+static void\n+cls_struct_combined_gn(ffi_cif* cif __UNUSED__, void* resp __UNUSED__,\n+        void** args, void* userdata __UNUSED__)\n+{\n+  struct cls_struct_combined a0;\n+\n+  a0 = *(struct cls_struct_combined*)(args[0]);\n+\n+  cls_struct_combined_fn(a0);\n+}\n+\n+\n+int main (void)\n+{\n+  ffi_cif cif;\n+  void *code;\n+  ffi_closure *pcl = ffi_closure_alloc(sizeof(ffi_closure), &code);\n+  ffi_type* cls_struct_fields0[5];\n+  ffi_type cls_struct_type0;\n+  ffi_type* dbl_arg_types[5];\n+\n+  cls_struct_type0.size = 0;\n+  cls_struct_type0.alignment = 0;\n+  cls_struct_type0.type = FFI_TYPE_STRUCT;\n+  cls_struct_type0.elements = cls_struct_fields0;\n+\n+  struct cls_struct_combined g_dbl = {4.0, 5.0, 1.0, 8.0};\n+\n+  cls_struct_fields0[0] = &ffi_type_float;\n+  cls_struct_fields0[1] = &ffi_type_float;\n+  cls_struct_fields0[2] = &ffi_type_float;\n+  cls_struct_fields0[3] = &ffi_type_float;\n+  cls_struct_fields0[4] = NULL;\n+\n+  dbl_arg_types[0] = &cls_struct_type0;\n+  dbl_arg_types[1] = NULL;\n+\n+  CHECK(ffi_prep_cif(&cif, FFI_DEFAULT_ABI, 1, &ffi_type_void,\n+\t\t     dbl_arg_types) == FFI_OK);\n+\n+  CHECK(ffi_prep_closure_loc(pcl, &cif, cls_struct_combined_gn, NULL, code) == FFI_OK);\n+\n+  ((void(*)(cls_struct_combined)) (code))(g_dbl);\n+  /* { dg-output \"4 5 1 8\" } */\n+  exit(0);\n+}"}]}