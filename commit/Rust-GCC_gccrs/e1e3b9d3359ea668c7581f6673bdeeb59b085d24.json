{"sha": "e1e3b9d3359ea668c7581f6673bdeeb59b085d24", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6ZTFlM2I5ZDMzNTllYTY2OGM3NTgxZjY2NzNiZGVlYjU5YjA4NWQyNA==", "commit": {"author": {"name": "Tobias Burnus", "email": "burnus@net-b.de", "date": "2013-04-12T08:54:15Z"}, "committer": {"name": "Tobias Burnus", "email": "burnus@gcc.gnu.org", "date": "2013-04-12T08:54:15Z"}, "message": "re PR fortran/56845 ([OOP] _vptr not set to declared type for CLASS + SAVE)\n\n2013-04-12  Tobias Burnus  <burnus@net-b.de>\n\n        PR fortran/56845\n        * trans-decl.c (gfc_trans_deferred_vars): Restrict\n        static CLASS init to SAVE and -fno-automatic.\n\n2013-04-12  Tobias Burnus  <burnus@net-b.de>\n\n        PR fortran/56845\n        * gfortran.dg/class_allocate_15.f90: New.\n\n        Revert:\n        2013-04-12  Tobias Burnus  <burnus@net-b.de>\n\n        * gfortran.dg/coarray_lib_alloc_2.f90: Update\n        scan-tree-dump-times.\n\nFrom-SVN: r197848", "tree": {"sha": "734b2c409aebc24d8dccec0572fcd7266125edc1", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/734b2c409aebc24d8dccec0572fcd7266125edc1"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/e1e3b9d3359ea668c7581f6673bdeeb59b085d24", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/e1e3b9d3359ea668c7581f6673bdeeb59b085d24", "html_url": "https://github.com/Rust-GCC/gccrs/commit/e1e3b9d3359ea668c7581f6673bdeeb59b085d24", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/e1e3b9d3359ea668c7581f6673bdeeb59b085d24/comments", "author": {"login": "tob2", "id": 264461, "node_id": "MDQ6VXNlcjI2NDQ2MQ==", "avatar_url": "https://avatars.githubusercontent.com/u/264461?v=4", "gravatar_id": "", "url": "https://api.github.com/users/tob2", "html_url": "https://github.com/tob2", "followers_url": "https://api.github.com/users/tob2/followers", "following_url": "https://api.github.com/users/tob2/following{/other_user}", "gists_url": "https://api.github.com/users/tob2/gists{/gist_id}", "starred_url": "https://api.github.com/users/tob2/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/tob2/subscriptions", "organizations_url": "https://api.github.com/users/tob2/orgs", "repos_url": "https://api.github.com/users/tob2/repos", "events_url": "https://api.github.com/users/tob2/events{/privacy}", "received_events_url": "https://api.github.com/users/tob2/received_events", "type": "User", "site_admin": false}, "committer": null, "parents": [{"sha": "06f9b387e517d6f54b6c9b35d4f972bc1542855c", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/06f9b387e517d6f54b6c9b35d4f972bc1542855c", "html_url": "https://github.com/Rust-GCC/gccrs/commit/06f9b387e517d6f54b6c9b35d4f972bc1542855c"}], "stats": {"total": 52, "additions": 49, "deletions": 3}, "files": [{"sha": "616680d3bc4a47a33597cc685deacf544dd7ea3b", "filename": "gcc/fortran/ChangeLog", "status": "modified", "additions": 6, "deletions": 0, "changes": 6, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/e1e3b9d3359ea668c7581f6673bdeeb59b085d24/gcc%2Ffortran%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/e1e3b9d3359ea668c7581f6673bdeeb59b085d24/gcc%2Ffortran%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ffortran%2FChangeLog?ref=e1e3b9d3359ea668c7581f6673bdeeb59b085d24", "patch": "@@ -1,3 +1,9 @@\n+2013-04-12  Tobias Burnus  <burnus@net-b.de>\n+\n+\tPR fortran/56845\n+\t* trans-decl.c (gfc_trans_deferred_vars): Restrict\n+\tstatic CLASS init to SAVE and -fno-automatic.\n+\n 2013-04-12  Tobias Burnus  <burnus@net-b.de>\n \n \tPR fortran/56845"}, {"sha": "f2cf2de4cd3920fa29c8df20bc29ab62fc223ddf", "filename": "gcc/fortran/trans-decl.c", "status": "modified", "additions": 2, "deletions": 1, "changes": 3, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/e1e3b9d3359ea668c7581f6673bdeeb59b085d24/gcc%2Ffortran%2Ftrans-decl.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/e1e3b9d3359ea668c7581f6673bdeeb59b085d24/gcc%2Ffortran%2Ftrans-decl.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ffortran%2Ftrans-decl.c?ref=e1e3b9d3359ea668c7581f6673bdeeb59b085d24", "patch": "@@ -3649,7 +3649,8 @@ gfc_trans_deferred_vars (gfc_symbol * proc_sym, gfc_wrapped_block * block)\n \t\t\t\tNULL_TREE);\n \t}\n \n-      if (sym->ts.type == BT_CLASS && TREE_STATIC (sym->backend_decl)\n+      if (sym->ts.type == BT_CLASS\n+\t  && (sym->attr.save || gfc_option.flag_max_stack_var_size == 0)\n \t  && CLASS_DATA (sym)->attr.allocatable)\n \t{\n \t  tree vptr;"}, {"sha": "6272c49a18d698bac9efbaa3ee0f94db4519d375", "filename": "gcc/testsuite/ChangeLog", "status": "modified", "additions": 11, "deletions": 0, "changes": 11, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/e1e3b9d3359ea668c7581f6673bdeeb59b085d24/gcc%2Ftestsuite%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/e1e3b9d3359ea668c7581f6673bdeeb59b085d24/gcc%2Ftestsuite%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2FChangeLog?ref=e1e3b9d3359ea668c7581f6673bdeeb59b085d24", "patch": "@@ -1,3 +1,14 @@\n+2013-04-12  Tobias Burnus  <burnus@net-b.de>\n+\n+\tPR fortran/56845\n+\t* gfortran.dg/class_allocate_15.f90: New.\n+\n+\tRevert:\n+\t2013-04-12  Tobias Burnus  <burnus@net-b.de>\n+\n+\t* gfortran.dg/coarray_lib_alloc_2.f90: Update\n+\tscan-tree-dump-times.\n+\n 2013-04-12  Jakub Jelinek  <jakub@redhat.com>\n \n \tPR tree-optimization/56918"}, {"sha": "07c1cb49dbc59518e5c536d918c9d2ca25a8e820", "filename": "gcc/testsuite/gfortran.dg/class_allocate_15.f90", "status": "added", "additions": 28, "deletions": 0, "changes": 28, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/e1e3b9d3359ea668c7581f6673bdeeb59b085d24/gcc%2Ftestsuite%2Fgfortran.dg%2Fclass_allocate_15.f90", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/e1e3b9d3359ea668c7581f6673bdeeb59b085d24/gcc%2Ftestsuite%2Fgfortran.dg%2Fclass_allocate_15.f90", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgfortran.dg%2Fclass_allocate_15.f90?ref=e1e3b9d3359ea668c7581f6673bdeeb59b085d24", "patch": "@@ -0,0 +1,28 @@\n+! { dg-do run }\n+! { dg-options \"-fdump-tree-original -fdump-tree-original -fmax-stack-var-size=1\" }\n+!\n+! PR fortran/56845\n+!\n+type t\n+end type t\n+type, extends(t) :: t2\n+end type t2\n+type(t) :: y\n+call foo()\n+call bar()\n+contains\n+  subroutine foo()\n+    class(t), allocatable :: x\n+    if(allocated(x)) call abort()\n+    if(.not.same_type_as(x,y)) call abort()\n+    allocate (t2 :: x)\n+  end\n+  subroutine bar()\n+    class(t), allocatable :: x(:)\n+    if(allocated(x)) call abort()\n+    if(.not.same_type_as(x,y)) call abort()\n+    allocate (t2 :: x(4))\n+  end\n+end\n+! { dg-final { scan-tree-dump-times \"__builtin_free\" 2 \"original\" } }\n+! { dg-final { cleanup-tree-dump \"original\" } }"}, {"sha": "3aaff1e8c3511c5464a2cc12737c3ab5394c63cc", "filename": "gcc/testsuite/gfortran.dg/coarray_lib_alloc_2.f90", "status": "modified", "additions": 2, "deletions": 2, "changes": 4, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/e1e3b9d3359ea668c7581f6673bdeeb59b085d24/gcc%2Ftestsuite%2Fgfortran.dg%2Fcoarray_lib_alloc_2.f90", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/e1e3b9d3359ea668c7581f6673bdeeb59b085d24/gcc%2Ftestsuite%2Fgfortran.dg%2Fcoarray_lib_alloc_2.f90", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgfortran.dg%2Fcoarray_lib_alloc_2.f90?ref=e1e3b9d3359ea668c7581f6673bdeeb59b085d24", "patch": "@@ -18,6 +18,6 @@\n ! { dg-final { scan-tree-dump-times \"_gfortran_caf_register .1, 1, &yy._data.token, &stat.., &errmsg, 200.;\" 1 \"original\" } }\n ! { dg-final { scan-tree-dump-times \"_gfortran_caf_deregister .&xx._data.token, &stat.., &errmsg, 200.;\" 1 \"original\" } }\n ! { dg-final { scan-tree-dump-times \"_gfortran_caf_deregister .&yy._data.token, &stat.., &errmsg, 200.;\" 1 \"original\" } }\n-! { dg-final { scan-tree-dump-times \"_gfortran_caf_deregister .&yy._data.token, 0B, 0B, 0.;\" 0 \"original\" } }\n-! { dg-final { scan-tree-dump-times \"_gfortran_caf_deregister .&xx._data.token, 0B, 0B, 0.;\" 0 \"original\" } }\n+! { dg-final { scan-tree-dump-times \"_gfortran_caf_deregister .&yy._data.token, 0B, 0B, 0.;\" 1 \"original\" } }\n+! { dg-final { scan-tree-dump-times \"_gfortran_caf_deregister .&xx._data.token, 0B, 0B, 0.;\" 1 \"original\" } }\n ! { dg-final { cleanup-tree-dump \"original\" } }"}]}