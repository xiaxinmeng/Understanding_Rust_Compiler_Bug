{"sha": "7b4495d3c4040d8f56c05dd254d76269d4471623", "node_id": "C_kwDOANBUbNoAKDdiNDQ5NWQzYzQwNDBkOGY1NmMwNWRkMjU0ZDc2MjY5ZDQ0NzE2MjM", "commit": {"author": {"name": "Jonathan Wakely", "email": "jwakely@redhat.com", "date": "2022-04-08T17:26:23Z"}, "committer": {"name": "Jonathan Wakely", "email": "jwakely@redhat.com", "date": "2022-04-08T17:30:07Z"}, "message": "libstdc++: Fix constraints on std::expected<void, E> constructor [PR105153]\n\nlibstdc++-v3/ChangeLog:\n\n\tPR libstdc++/105153\n\t* include/std/expected\n\t(expected<void,E>::expected(expected<U,G>&&)): Fix constraints.\n\t* testsuite/20_util/expected/cons.cc: Check constructor.", "tree": {"sha": "b014f6b9019a46e2341f5073506589433cb85467", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/b014f6b9019a46e2341f5073506589433cb85467"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/7b4495d3c4040d8f56c05dd254d76269d4471623", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/7b4495d3c4040d8f56c05dd254d76269d4471623", "html_url": "https://github.com/Rust-GCC/gccrs/commit/7b4495d3c4040d8f56c05dd254d76269d4471623", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/7b4495d3c4040d8f56c05dd254d76269d4471623/comments", "author": {"login": "jwakely", "id": 1254480, "node_id": "MDQ6VXNlcjEyNTQ0ODA=", "avatar_url": "https://avatars.githubusercontent.com/u/1254480?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jwakely", "html_url": "https://github.com/jwakely", "followers_url": "https://api.github.com/users/jwakely/followers", "following_url": "https://api.github.com/users/jwakely/following{/other_user}", "gists_url": "https://api.github.com/users/jwakely/gists{/gist_id}", "starred_url": "https://api.github.com/users/jwakely/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jwakely/subscriptions", "organizations_url": "https://api.github.com/users/jwakely/orgs", "repos_url": "https://api.github.com/users/jwakely/repos", "events_url": "https://api.github.com/users/jwakely/events{/privacy}", "received_events_url": "https://api.github.com/users/jwakely/received_events", "type": "User", "site_admin": false}, "committer": {"login": "jwakely", "id": 1254480, "node_id": "MDQ6VXNlcjEyNTQ0ODA=", "avatar_url": "https://avatars.githubusercontent.com/u/1254480?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jwakely", "html_url": "https://github.com/jwakely", "followers_url": "https://api.github.com/users/jwakely/followers", "following_url": "https://api.github.com/users/jwakely/following{/other_user}", "gists_url": "https://api.github.com/users/jwakely/gists{/gist_id}", "starred_url": "https://api.github.com/users/jwakely/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jwakely/subscriptions", "organizations_url": "https://api.github.com/users/jwakely/orgs", "repos_url": "https://api.github.com/users/jwakely/repos", "events_url": "https://api.github.com/users/jwakely/events{/privacy}", "received_events_url": "https://api.github.com/users/jwakely/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "0dfaf562521ba97c18398d027bf44a15f802f303", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/0dfaf562521ba97c18398d027bf44a15f802f303", "html_url": "https://github.com/Rust-GCC/gccrs/commit/0dfaf562521ba97c18398d027bf44a15f802f303"}], "stats": {"total": 22, "additions": 20, "deletions": 2}, "files": [{"sha": "3446d6dbaed30ba575a436e9ce9f8c56654b706c", "filename": "libstdc++-v3/include/std/expected", "status": "modified", "additions": 2, "deletions": 2, "changes": 4, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/7b4495d3c4040d8f56c05dd254d76269d4471623/libstdc%2B%2B-v3%2Finclude%2Fstd%2Fexpected", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/7b4495d3c4040d8f56c05dd254d76269d4471623/libstdc%2B%2B-v3%2Finclude%2Fstd%2Fexpected", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libstdc%2B%2B-v3%2Finclude%2Fstd%2Fexpected?ref=7b4495d3c4040d8f56c05dd254d76269d4471623", "patch": "@@ -966,8 +966,8 @@ namespace __expected\n \t}\n \n       template<typename _Up, typename _Gr>\n-\trequires is_void_v<_Tp>\n-\t      && is_constructible_v<_Er, const _Gr&>\n+\trequires is_void_v<_Up>\n+\t      && is_constructible_v<_Er, _Gr>\n \t      && (!__cons_from_expected<_Up, _Gr>)\n \tconstexpr explicit(!is_convertible_v<_Gr, _Er>)\n \texpected(expected<_Up, _Gr>&& __x)"}, {"sha": "6946858198c80bc0acf3099efa8f9b4af7300d68", "filename": "libstdc++-v3/testsuite/20_util/expected/cons.cc", "status": "modified", "additions": 18, "deletions": 0, "changes": 18, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/7b4495d3c4040d8f56c05dd254d76269d4471623/libstdc%2B%2B-v3%2Ftestsuite%2F20_util%2Fexpected%2Fcons.cc", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/7b4495d3c4040d8f56c05dd254d76269d4471623/libstdc%2B%2B-v3%2Ftestsuite%2F20_util%2Fexpected%2Fcons.cc", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libstdc%2B%2B-v3%2Ftestsuite%2F20_util%2Fexpected%2Fcons.cc?ref=7b4495d3c4040d8f56c05dd254d76269d4471623", "patch": "@@ -162,6 +162,22 @@ test_copy()\n   return true;\n }\n \n+constexpr bool\n+test_pr105153()\n+{\n+  struct E {\n+    E(int&&) = delete;\n+    E(const int&);\n+  };\n+\n+  std::expected<void, E> e(std::expected<void, int>{});\n+\n+  static_assert( ! std::is_constructible_v<std::expected<void, int>,\n+\t\t\t\t\t   std::expected<int, int>> );\n+\n+  return true;\n+}\n+\n int main()\n {\n   test_default();\n@@ -172,4 +188,6 @@ int main()\n   static_assert( test_err() );\n   test_copy();\n   static_assert( test_copy() );\n+  test_pr105153();\n+  static_assert( test_pr105153() );\n }"}]}