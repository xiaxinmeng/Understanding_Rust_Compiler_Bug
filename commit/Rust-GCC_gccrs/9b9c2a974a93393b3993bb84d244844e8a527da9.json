{"sha": "9b9c2a974a93393b3993bb84d244844e8a527da9", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6OWI5YzJhOTc0YTkzMzkzYjM5OTNiYjg0ZDI0NDg0NGU4YTUyN2RhOQ==", "commit": {"author": {"name": "Tim Shen", "email": "timshen@google.com", "date": "2014-12-04T04:25:12Z"}, "committer": {"name": "Tim Shen", "email": "timshen@gcc.gnu.org", "date": "2014-12-04T04:25:12Z"}, "message": "re PR libstdc++/64140 (match_results.prefix() returns an incorrect result if regex_iterator holds a zero-length match)\n\n\tPR libstdc++/64140\n\t* include/bits/regex.tcc (regex_iterator<>::operator++): Update\n\tprefix.matched after modifying prefix.first.\n\t* testsuite/28_regex/iterators/regex_iterator/char/64140.cc: New\n\ttestcase.\n\nFrom-SVN: r218340", "tree": {"sha": "ea70d254be8eb35eb50f02db8797b7f6e9b63f1e", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/ea70d254be8eb35eb50f02db8797b7f6e9b63f1e"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/9b9c2a974a93393b3993bb84d244844e8a527da9", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/9b9c2a974a93393b3993bb84d244844e8a527da9", "html_url": "https://github.com/Rust-GCC/gccrs/commit/9b9c2a974a93393b3993bb84d244844e8a527da9", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/9b9c2a974a93393b3993bb84d244844e8a527da9/comments", "author": {"login": "timshen91", "id": 1157432, "node_id": "MDQ6VXNlcjExNTc0MzI=", "avatar_url": "https://avatars.githubusercontent.com/u/1157432?v=4", "gravatar_id": "", "url": "https://api.github.com/users/timshen91", "html_url": "https://github.com/timshen91", "followers_url": "https://api.github.com/users/timshen91/followers", "following_url": "https://api.github.com/users/timshen91/following{/other_user}", "gists_url": "https://api.github.com/users/timshen91/gists{/gist_id}", "starred_url": "https://api.github.com/users/timshen91/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/timshen91/subscriptions", "organizations_url": "https://api.github.com/users/timshen91/orgs", "repos_url": "https://api.github.com/users/timshen91/repos", "events_url": "https://api.github.com/users/timshen91/events{/privacy}", "received_events_url": "https://api.github.com/users/timshen91/received_events", "type": "User", "site_admin": false}, "committer": null, "parents": [{"sha": "ddff61d69b48b6962dc925d5835f86aef34da136", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/ddff61d69b48b6962dc925d5835f86aef34da136", "html_url": "https://github.com/Rust-GCC/gccrs/commit/ddff61d69b48b6962dc925d5835f86aef34da136"}], "stats": {"total": 69, "additions": 67, "deletions": 2}, "files": [{"sha": "e03879fbdac26035966482543f7e9832487feabd", "filename": "libstdc++-v3/ChangeLog", "status": "modified", "additions": 8, "deletions": 0, "changes": 8, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/9b9c2a974a93393b3993bb84d244844e8a527da9/libstdc%2B%2B-v3%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/9b9c2a974a93393b3993bb84d244844e8a527da9/libstdc%2B%2B-v3%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libstdc%2B%2B-v3%2FChangeLog?ref=9b9c2a974a93393b3993bb84d244844e8a527da9", "patch": "@@ -1,3 +1,11 @@\n+2014-12-04  Tim Shen  <timshen@google.com>\n+\n+\tPR libstdc++/64140\n+\t* include/bits/regex.tcc (regex_iterator<>::operator++): Update\n+\tprefix.matched after modifying prefix.first.\n+\t* testsuite/28_regex/iterators/regex_iterator/char/64140.cc: New\n+\ttestcase.\n+\n 2014-12-03  Fran\u00e7ois Dumont  <fdumont@gcc.gnu.org>\n \n \tPR libstdc++/13631"}, {"sha": "96924024c906a55da37ab4d4611a0b75c508b023", "filename": "libstdc++-v3/include/bits/regex.tcc", "status": "modified", "additions": 6, "deletions": 2, "changes": 8, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/9b9c2a974a93393b3993bb84d244844e8a527da9/libstdc%2B%2B-v3%2Finclude%2Fbits%2Fregex.tcc", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/9b9c2a974a93393b3993bb84d244844e8a527da9/libstdc%2B%2B-v3%2Finclude%2Fbits%2Fregex.tcc", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libstdc%2B%2B-v3%2Finclude%2Fbits%2Fregex.tcc?ref=9b9c2a974a93393b3993bb84d244844e8a527da9", "patch": "@@ -569,7 +569,9 @@ _GLIBCXX_BEGIN_NAMESPACE_VERSION\n \t\t\t\t   | regex_constants::match_continuous))\n \t\t    {\n \t\t      _GLIBCXX_DEBUG_ASSERT(_M_match[0].matched);\n-\t\t      _M_match.at(_M_match.size()).first = __prefix_first;\n+\t\t      auto& __prefix = _M_match.at(_M_match.size());\n+\t\t      __prefix.first = __prefix_first;\n+\t\t      __prefix.matched = __prefix.first != __prefix.second;\n \t\t      _M_match._M_in_iterator = true;\n \t\t      _M_match._M_begin = _M_begin;\n \t\t      return *this;\n@@ -582,7 +584,9 @@ _GLIBCXX_BEGIN_NAMESPACE_VERSION\n \t  if (regex_search(__start, _M_end, _M_match, *_M_pregex, _M_flags))\n \t    {\n \t      _GLIBCXX_DEBUG_ASSERT(_M_match[0].matched);\n-\t      _M_match.at(_M_match.size()).first = __prefix_first;\n+\t      auto& __prefix = _M_match.at(_M_match.size());\n+\t      __prefix.first = __prefix_first;\n+\t      __prefix.matched = __prefix.first != __prefix.second;\n \t      _M_match._M_in_iterator = true;\n \t      _M_match._M_begin = _M_begin;\n \t    }"}, {"sha": "32b7e241cb0640567f407ad47a4be66011a6cb7d", "filename": "libstdc++-v3/testsuite/28_regex/iterators/regex_iterator/char/64140.cc", "status": "added", "additions": 53, "deletions": 0, "changes": 53, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/9b9c2a974a93393b3993bb84d244844e8a527da9/libstdc%2B%2B-v3%2Ftestsuite%2F28_regex%2Fiterators%2Fregex_iterator%2Fchar%2F64140.cc", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/9b9c2a974a93393b3993bb84d244844e8a527da9/libstdc%2B%2B-v3%2Ftestsuite%2F28_regex%2Fiterators%2Fregex_iterator%2Fchar%2F64140.cc", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libstdc%2B%2B-v3%2Ftestsuite%2F28_regex%2Fiterators%2Fregex_iterator%2Fchar%2F64140.cc?ref=9b9c2a974a93393b3993bb84d244844e8a527da9", "patch": "@@ -0,0 +1,53 @@\n+// { dg-options \"-std=gnu++11\" }\n+\n+//\n+// Copyright (C) 2014 Free Software Foundation, Inc.\n+//\n+// This file is part of the GNU ISO C++ Library.  This library is free\n+// software; you can redistribute it and/or modify it under the\n+// terms of the GNU General Public License as published by the\n+// Free Software Foundation; either version 3, or (at your option)\n+// any later version.\n+//\n+// This library is distributed in the hope that it will be useful,\n+// but WITHOUT ANY WARRANTY; without even the implied warranty of\n+// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n+// GNU General Public License for more details.\n+//\n+// You should have received a copy of the GNU General Public License along\n+// with this library; see the file COPYING3.  If not see\n+// <http://www.gnu.org/licenses/>.\n+\n+// libstdc++/64140\n+\n+#include <regex>\n+#include <testsuite_hooks.h>\n+\n+void\n+test01()\n+{\n+  bool test __attribute__((unused)) = true;\n+\n+  const std::regex e(\"z*\");\n+  const std::string s(\"ab\");\n+\n+  auto it = std::sregex_iterator(s.begin(), s.end(), e);\n+  auto end = std::sregex_iterator();\n+  VERIFY(it != end);\n+  VERIFY(!it->prefix().matched);\n+  ++it;\n+  VERIFY(it != end);\n+  VERIFY(it->prefix().matched);\n+  ++it;\n+  VERIFY(it != end);\n+  VERIFY(it->prefix().matched);\n+  ++it;\n+  VERIFY(it == end);\n+}\n+\n+int\n+main()\n+{\n+  test01();\n+  return 0;\n+}"}]}