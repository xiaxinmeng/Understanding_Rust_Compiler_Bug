{"sha": "0eeb8c81e8cebdf5f719756d6ce5becc5d93b61f", "node_id": "C_kwDOANBUbNoAKDBlZWI4YzgxZThjZWJkZjVmNzE5NzU2ZDZjZTViZWNjNWQ5M2I2MWY", "commit": {"author": {"name": "liuhongt", "email": "hongtao.liu@intel.com", "date": "2020-07-13T08:04:05Z"}, "committer": {"name": "liuhongt", "email": "hongtao.liu@intel.com", "date": "2021-09-22T04:56:31Z"}, "message": "AVX512FP16: Add expander for cstorehf4.\n\ngcc/ChangeLog:\n\n\t* config/i386/i386.md (cstorehf3): New define_expand.\n\ngcc/testsuite/ChangeLog:\n\n\t* gcc.target/i386/avx512fp16-builtin-fpcompare-1.c: New test.\n\t* gcc.target/i386/avx512fp16-builtin-fpcompare-2.c: New test.", "tree": {"sha": "777cfa254ee41294da8358da191557b4081b9fda", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/777cfa254ee41294da8358da191557b4081b9fda"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/0eeb8c81e8cebdf5f719756d6ce5becc5d93b61f", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/0eeb8c81e8cebdf5f719756d6ce5becc5d93b61f", "html_url": "https://github.com/Rust-GCC/gccrs/commit/0eeb8c81e8cebdf5f719756d6ce5becc5d93b61f", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/0eeb8c81e8cebdf5f719756d6ce5becc5d93b61f/comments", "author": {"login": "algebra84", "id": 22926165, "node_id": "MDQ6VXNlcjIyOTI2MTY1", "avatar_url": "https://avatars.githubusercontent.com/u/22926165?v=4", "gravatar_id": "", "url": "https://api.github.com/users/algebra84", "html_url": "https://github.com/algebra84", "followers_url": "https://api.github.com/users/algebra84/followers", "following_url": "https://api.github.com/users/algebra84/following{/other_user}", "gists_url": "https://api.github.com/users/algebra84/gists{/gist_id}", "starred_url": "https://api.github.com/users/algebra84/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/algebra84/subscriptions", "organizations_url": "https://api.github.com/users/algebra84/orgs", "repos_url": "https://api.github.com/users/algebra84/repos", "events_url": "https://api.github.com/users/algebra84/events{/privacy}", "received_events_url": "https://api.github.com/users/algebra84/received_events", "type": "User", "site_admin": false}, "committer": {"login": "algebra84", "id": 22926165, "node_id": "MDQ6VXNlcjIyOTI2MTY1", "avatar_url": "https://avatars.githubusercontent.com/u/22926165?v=4", "gravatar_id": "", "url": "https://api.github.com/users/algebra84", "html_url": "https://github.com/algebra84", "followers_url": "https://api.github.com/users/algebra84/followers", "following_url": "https://api.github.com/users/algebra84/following{/other_user}", "gists_url": "https://api.github.com/users/algebra84/gists{/gist_id}", "starred_url": "https://api.github.com/users/algebra84/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/algebra84/subscriptions", "organizations_url": "https://api.github.com/users/algebra84/orgs", "repos_url": "https://api.github.com/users/algebra84/repos", "events_url": "https://api.github.com/users/algebra84/events{/privacy}", "received_events_url": "https://api.github.com/users/algebra84/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "338abd0bf777f671f4bf48d8ee5fe1f67f3ea3d9", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/338abd0bf777f671f4bf48d8ee5fe1f67f3ea3d9", "html_url": "https://github.com/Rust-GCC/gccrs/commit/338abd0bf777f671f4bf48d8ee5fe1f67f3ea3d9"}], "stats": {"total": 84, "additions": 84, "deletions": 0}, "files": [{"sha": "9bdd671c5bc92bf0cf76266754597b12736813f8", "filename": "gcc/config/i386/i386.md", "status": "modified", "additions": 15, "deletions": 0, "changes": 15, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/0eeb8c81e8cebdf5f719756d6ce5becc5d93b61f/gcc%2Fconfig%2Fi386%2Fi386.md", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/0eeb8c81e8cebdf5f719756d6ce5becc5d93b61f/gcc%2Fconfig%2Fi386%2Fi386.md", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fconfig%2Fi386%2Fi386.md?ref=0eeb8c81e8cebdf5f719756d6ce5becc5d93b61f", "patch": "@@ -1541,6 +1541,21 @@\n   DONE;\n })\n \n+(define_expand \"cstorehf4\"\n+  [(set (reg:CC FLAGS_REG)\n+\t(compare:CC (match_operand:HF 2 \"cmp_fp_expander_operand\")\n+\t\t    (match_operand:HF 3 \"cmp_fp_expander_operand\")))\n+   (set (match_operand:QI 0 \"register_operand\")\n+\t(match_operator 1 \"ix86_fp_comparison_operator\"\n+\t  [(reg:CC FLAGS_REG)\n+\t   (const_int 0)]))]\n+  \"TARGET_AVX512FP16\"\n+{\n+  ix86_expand_setcc (operands[0], GET_CODE (operands[1]),\n+\t\t     operands[2], operands[3]);\n+  DONE;\n+})\n+\n (define_expand \"cstore<mode>4\"\n   [(set (reg:CC FLAGS_REG)\n \t(compare:CC (match_operand:MODEF 2 \"cmp_fp_expander_operand\")"}, {"sha": "62115f15f30852b67de0d007a98e4235e156d9e6", "filename": "gcc/testsuite/gcc.target/i386/avx512fp16-builtin-fpcompare-1.c", "status": "added", "additions": 40, "deletions": 0, "changes": 40, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/0eeb8c81e8cebdf5f719756d6ce5becc5d93b61f/gcc%2Ftestsuite%2Fgcc.target%2Fi386%2Favx512fp16-builtin-fpcompare-1.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/0eeb8c81e8cebdf5f719756d6ce5becc5d93b61f/gcc%2Ftestsuite%2Fgcc.target%2Fi386%2Favx512fp16-builtin-fpcompare-1.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgcc.target%2Fi386%2Favx512fp16-builtin-fpcompare-1.c?ref=0eeb8c81e8cebdf5f719756d6ce5becc5d93b61f", "patch": "@@ -0,0 +1,40 @@\n+/* { dg-do compile } */\n+/* { dg-options \"-Ofast -mavx512fp16\" } */\n+\n+int\n+f1 (_Float16 x, _Float16 y)\n+{\n+  return x > y;\n+}\n+\n+int\n+f2 (_Float16 x, _Float16 y)\n+{\n+  return x < y;\n+}\n+\n+/* { dg-final { scan-assembler-times \"seta\" 2 } } */\n+\n+int\n+f3 (_Float16 x, _Float16 y)\n+{\n+  return x >= y;\n+}\n+\n+int\n+f4 (_Float16 x, _Float16 y)\n+{\n+  return x <= y;\n+}\n+\n+/* { dg-final { scan-assembler-times \"setnb\" 2 } } */\n+\n+int\n+f5 (_Float16 x, _Float16 y)\n+{\n+  return __builtin_isunordered (x, y);\n+}\n+\n+/* { dg-final { scan-assembler-not \"vcvtsh2s\\[sd\\]\" } }  */\n+/* { dg-final { scan-assembler-times \"xorl\" 5 } } */\n+/* { dg-final { scan-assembler-times \"vcomish\\[^\\n\\r\\]*xmm\\[0-9\\]\" 4 } } */"}, {"sha": "150c351e7846a09abfcc1d5437e0020bebb92533", "filename": "gcc/testsuite/gcc.target/i386/avx512fp16-builtin-fpcompare-2.c", "status": "added", "additions": 29, "deletions": 0, "changes": 29, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/0eeb8c81e8cebdf5f719756d6ce5becc5d93b61f/gcc%2Ftestsuite%2Fgcc.target%2Fi386%2Favx512fp16-builtin-fpcompare-2.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/0eeb8c81e8cebdf5f719756d6ce5becc5d93b61f/gcc%2Ftestsuite%2Fgcc.target%2Fi386%2Favx512fp16-builtin-fpcompare-2.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgcc.target%2Fi386%2Favx512fp16-builtin-fpcompare-2.c?ref=0eeb8c81e8cebdf5f719756d6ce5becc5d93b61f", "patch": "@@ -0,0 +1,29 @@\n+/* { dg-do compile } */\n+/* { dg-options \"-O2 -mfpmath=sse -mavx512fp16\" } */\n+\n+int\n+foo (_Float16 y)\n+{\n+  return __builtin_isinf (y);\n+}\n+\n+int\n+foo2 (_Float16 y)\n+{\n+  return __builtin_isfinite (y);\n+}\n+\n+int\n+foo3 (_Float16 y)\n+{\n+  return __builtin_signbit(y);\n+}\n+\n+int\n+foo4 (_Float16 y)\n+{\n+  return __builtin_isnormal (y);\n+}\n+\n+/* { dg-final { scan-assembler-not \"vcvtsh2s\\[sd\\]\" } }  */\n+/* { dg-final { scan-assembler-times \"vucomish\\[^\\n\\r\\]*xmm\\[0-9\\]\" 4 } } */"}]}