{"sha": "0c40d2340abd3c04b3134c0719dbfc79ee871209", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6MGM0MGQyMzQwYWJkM2MwNGIzMTM0YzA3MTlkYmZjNzllZTg3MTIwOQ==", "commit": {"author": {"name": "Janne Blomqvist", "email": "jb@gcc.gnu.org", "date": "2009-06-03T21:07:19Z"}, "committer": {"name": "Janne Blomqvist", "email": "jb@gcc.gnu.org", "date": "2009-06-03T21:07:19Z"}, "message": "re PR libfortran/40330 (incorrect IO)\n\nPR libfortran/40330\n\nUse heap memory for cached format strings.\n\nFrom-SVN: r148149", "tree": {"sha": "b47a5d4594631fea4f6b7a382efb4bab88cddbcd", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/b47a5d4594631fea4f6b7a382efb4bab88cddbcd"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/0c40d2340abd3c04b3134c0719dbfc79ee871209", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/0c40d2340abd3c04b3134c0719dbfc79ee871209", "html_url": "https://github.com/Rust-GCC/gccrs/commit/0c40d2340abd3c04b3134c0719dbfc79ee871209", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/0c40d2340abd3c04b3134c0719dbfc79ee871209/comments", "author": null, "committer": null, "parents": [{"sha": "9e0667cd3a217c480333130a07cdb9641eada30e", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/9e0667cd3a217c480333130a07cdb9641eada30e", "html_url": "https://github.com/Rust-GCC/gccrs/commit/9e0667cd3a217c480333130a07cdb9641eada30e"}], "stats": {"total": 19, "additions": 17, "deletions": 2}, "files": [{"sha": "c1204932abea0f80eccf3114e607ed414bb99d01", "filename": "libgfortran/ChangeLog", "status": "modified", "additions": 6, "deletions": 0, "changes": 6, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/0c40d2340abd3c04b3134c0719dbfc79ee871209/libgfortran%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/0c40d2340abd3c04b3134c0719dbfc79ee871209/libgfortran%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libgfortran%2FChangeLog?ref=0c40d2340abd3c04b3134c0719dbfc79ee871209", "patch": "@@ -1,3 +1,9 @@\n+2009-06-04  Janne Blomqvist  <jb@gcc.gnu.org>\n+\n+\tPR libfortran/40330\n+\t* io/format.c (free_format_hash_table): Also free and nullify hash key.\n+\t(save_parsed_format): Copy string rather than pointer copy.\n+\t\n 2009-05-29  Francois-Xavier Coudert  <fxcoudert@gcc.gnu.org>\n \n \tPR fortran/40019"}, {"sha": "2c116d6fed4045455f663e57074ac411871a45e6", "filename": "libgfortran/io/format.c", "status": "modified", "additions": 11, "deletions": 2, "changes": 13, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/0c40d2340abd3c04b3134c0719dbfc79ee871209/libgfortran%2Fio%2Fformat.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/0c40d2340abd3c04b3134c0719dbfc79ee871209/libgfortran%2Fio%2Fformat.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libgfortran%2Fio%2Fformat.c?ref=0c40d2340abd3c04b3134c0719dbfc79ee871209", "patch": "@@ -87,7 +87,12 @@ free_format_hash_table (gfc_unit *u)\n   for (i = 0; i < FORMAT_HASH_SIZE; i++)\n     {\n       if (u->format_hash_table[i].hashed_fmt != NULL)\n-\tfree_format_data (u->format_hash_table[i].hashed_fmt);\n+\t{\n+\t  free_format_data (u->format_hash_table[i].hashed_fmt);\n+\t  free_mem (u->format_hash_table[i].key);\n+\t}\n+      u->format_hash_table[i].key = NULL;\n+      u->format_hash_table[i].key_len = 0;      \n       u->format_hash_table[i].hashed_fmt = NULL;\n     }\n }\n@@ -164,7 +169,11 @@ save_parsed_format (st_parameter_dt *dtp)\n     free_format_data (u->format_hash_table[hash].hashed_fmt);\n   u->format_hash_table[hash].hashed_fmt = NULL;\n \n-  u->format_hash_table[hash].key = dtp->format;\n+  if (u->format_hash_table[hash].key != NULL)\n+    free_mem (u->format_hash_table[hash].key);\n+  u->format_hash_table[hash].key = get_mem (dtp->format_len);\n+  memcpy (u->format_hash_table[hash].key, dtp->format, dtp->format_len);\n+\n   u->format_hash_table[hash].key_len = dtp->format_len;\n   u->format_hash_table[hash].hashed_fmt = dtp->u.p.fmt;\n }"}]}