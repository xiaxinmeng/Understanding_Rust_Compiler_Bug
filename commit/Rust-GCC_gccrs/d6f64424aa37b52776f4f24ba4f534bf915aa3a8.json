{"sha": "d6f64424aa37b52776f4f24ba4f534bf915aa3a8", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6ZDZmNjQ0MjRhYTM3YjUyNzc2ZjRmMjRiYTRmNTM0YmY5MTVhYTNhOA==", "commit": {"author": {"name": "Jonathan Wakely", "email": "jwakely@redhat.com", "date": "2014-12-10T00:21:37Z"}, "committer": {"name": "Jonathan Wakely", "email": "redi@gcc.gnu.org", "date": "2014-12-10T00:21:37Z"}, "message": "locale_facets.tcc (numpunct::_M_cache): Avoid calling virtual functions twice.\n\n\t* include/bits/locale_facets.tcc (numpunct::_M_cache): Avoid calling\n\tvirtual functions twice. Only update _M_allocated after all\n\tallocations have succeeded.\n\t* include/bits/locale_facets_nonio.tcc (moneypunct::_M_cache):\n\tLikewise.\n\t* include/bits/locale_facets_nonio.h (__timepunct::_M_cache): Remove\n\tunused declaration.\n\nFrom-SVN: r218552", "tree": {"sha": "f8b50d7188a471a871b353a5814e16004c69959a", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/f8b50d7188a471a871b353a5814e16004c69959a"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/d6f64424aa37b52776f4f24ba4f534bf915aa3a8", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/d6f64424aa37b52776f4f24ba4f534bf915aa3a8", "html_url": "https://github.com/Rust-GCC/gccrs/commit/d6f64424aa37b52776f4f24ba4f534bf915aa3a8", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/d6f64424aa37b52776f4f24ba4f534bf915aa3a8/comments", "author": {"login": "jwakely", "id": 1254480, "node_id": "MDQ6VXNlcjEyNTQ0ODA=", "avatar_url": "https://avatars.githubusercontent.com/u/1254480?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jwakely", "html_url": "https://github.com/jwakely", "followers_url": "https://api.github.com/users/jwakely/followers", "following_url": "https://api.github.com/users/jwakely/following{/other_user}", "gists_url": "https://api.github.com/users/jwakely/gists{/gist_id}", "starred_url": "https://api.github.com/users/jwakely/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jwakely/subscriptions", "organizations_url": "https://api.github.com/users/jwakely/orgs", "repos_url": "https://api.github.com/users/jwakely/repos", "events_url": "https://api.github.com/users/jwakely/events{/privacy}", "received_events_url": "https://api.github.com/users/jwakely/received_events", "type": "User", "site_admin": false}, "committer": {"login": "jwakely", "id": 1254480, "node_id": "MDQ6VXNlcjEyNTQ0ODA=", "avatar_url": "https://avatars.githubusercontent.com/u/1254480?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jwakely", "html_url": "https://github.com/jwakely", "followers_url": "https://api.github.com/users/jwakely/followers", "following_url": "https://api.github.com/users/jwakely/following{/other_user}", "gists_url": "https://api.github.com/users/jwakely/gists{/gist_id}", "starred_url": "https://api.github.com/users/jwakely/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jwakely/subscriptions", "organizations_url": "https://api.github.com/users/jwakely/orgs", "repos_url": "https://api.github.com/users/jwakely/repos", "events_url": "https://api.github.com/users/jwakely/events{/privacy}", "received_events_url": "https://api.github.com/users/jwakely/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "9c53a5b42371bbdfab2dac2f6e586762a549e931", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/9c53a5b42371bbdfab2dac2f6e586762a549e931", "html_url": "https://github.com/Rust-GCC/gccrs/commit/9c53a5b42371bbdfab2dac2f6e586762a549e931"}], "stats": {"total": 78, "additions": 46, "deletions": 32}, "files": [{"sha": "320a7617dea6a2d35687f1b591e4995ca667c4ed", "filename": "libstdc++-v3/ChangeLog", "status": "modified", "additions": 10, "deletions": 0, "changes": 10, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/d6f64424aa37b52776f4f24ba4f534bf915aa3a8/libstdc%2B%2B-v3%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/d6f64424aa37b52776f4f24ba4f534bf915aa3a8/libstdc%2B%2B-v3%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libstdc%2B%2B-v3%2FChangeLog?ref=d6f64424aa37b52776f4f24ba4f534bf915aa3a8", "patch": "@@ -1,3 +1,13 @@\n+2014-12-10  Jonathan Wakely  <jwakely@redhat.com>\n+\n+\t* include/bits/locale_facets.tcc (numpunct::_M_cache): Avoid calling\n+\tvirtual functions twice. Only update _M_allocated after all\n+\tallocations have succeeded.\n+\t* include/bits/locale_facets_nonio.tcc (moneypunct::_M_cache):\n+\tLikewise.\n+\t* include/bits/locale_facets_nonio.h (__timepunct::_M_cache): Remove\n+\tunused declaration.\n+\n 2014-12-09  Jonathan Wakely  <jwakely@redhat.com>\n \n \tPR libstdc++/64203"}, {"sha": "200e099b2a53b9488d5f446c12958f859dfd22bc", "filename": "libstdc++-v3/include/bits/locale_facets.tcc", "status": "modified", "additions": 16, "deletions": 13, "changes": 29, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/d6f64424aa37b52776f4f24ba4f534bf915aa3a8/libstdc%2B%2B-v3%2Finclude%2Fbits%2Flocale_facets.tcc", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/d6f64424aa37b52776f4f24ba4f534bf915aa3a8/libstdc%2B%2B-v3%2Finclude%2Fbits%2Flocale_facets.tcc", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libstdc%2B%2B-v3%2Finclude%2Fbits%2Flocale_facets.tcc?ref=d6f64424aa37b52776f4f24ba4f534bf915aa3a8", "patch": "@@ -77,33 +77,31 @@ _GLIBCXX_BEGIN_NAMESPACE_VERSION\n     void\n     __numpunct_cache<_CharT>::_M_cache(const locale& __loc)\n     {\n-      _M_allocated = true;\n-\n       const numpunct<_CharT>& __np = use_facet<numpunct<_CharT> >(__loc);\n \n       char* __grouping = 0;\n       _CharT* __truename = 0;\n       _CharT* __falsename = 0;\n       __try\n \t{\n-\t  _M_grouping_size = __np.grouping().size();\n+\t  const string& __g = __np.grouping();\n+\t  _M_grouping_size = __g.size();\n \t  __grouping = new char[_M_grouping_size];\n-\t  __np.grouping().copy(__grouping, _M_grouping_size);\n-\t  _M_grouping = __grouping;\n+\t  __g.copy(__grouping, _M_grouping_size);\n \t  _M_use_grouping = (_M_grouping_size\n-\t\t\t     && static_cast<signed char>(_M_grouping[0]) > 0\n-\t\t\t     && (_M_grouping[0]\n+\t\t\t     && static_cast<signed char>(__grouping[0]) > 0\n+\t\t\t     && (__grouping[0]\n \t\t\t\t != __gnu_cxx::__numeric_traits<char>::__max));\n \n-\t  _M_truename_size = __np.truename().size();\n+\t  const basic_string<_CharT>& __tn = __np.truename();\n+\t  _M_truename_size = __tn.size();\n \t  __truename = new _CharT[_M_truename_size];\n-\t  __np.truename().copy(__truename, _M_truename_size);\n-\t  _M_truename = __truename;\n+\t  __tn.copy(__truename, _M_truename_size);\n \n-\t  _M_falsename_size = __np.falsename().size();\n+\t  const basic_string<_CharT>& __fn = __np.falsename();\n+\t  _M_falsename_size = __fn.size();\n \t  __falsename = new _CharT[_M_falsename_size];\n-\t  __np.falsename().copy(__falsename, _M_falsename_size);\n-\t  _M_falsename = __falsename;\n+\t  __fn.copy(__falsename, _M_falsename_size);\n \n \t  _M_decimal_point = __np.decimal_point();\n \t  _M_thousands_sep = __np.thousands_sep();\n@@ -115,6 +113,11 @@ _GLIBCXX_BEGIN_NAMESPACE_VERSION\n \t  __ct.widen(__num_base::_S_atoms_in,\n \t\t     __num_base::_S_atoms_in\n \t\t     + __num_base::_S_iend, _M_atoms_in);\n+\n+\t  _M_grouping = __grouping;\n+\t  _M_truename = __truename;\n+\t  _M_falsename = __falsename;\n+\t  _M_allocated = true;\n \t}\n       __catch(...)\n \t{"}, {"sha": "1b0aff9b5c506f1708b7a4bcc9df3f11cc38d621", "filename": "libstdc++-v3/include/bits/locale_facets_nonio.h", "status": "modified", "additions": 0, "deletions": 3, "changes": 3, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/d6f64424aa37b52776f4f24ba4f534bf915aa3a8/libstdc%2B%2B-v3%2Finclude%2Fbits%2Flocale_facets_nonio.h", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/d6f64424aa37b52776f4f24ba4f534bf915aa3a8/libstdc%2B%2B-v3%2Finclude%2Fbits%2Flocale_facets_nonio.h", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libstdc%2B%2B-v3%2Finclude%2Fbits%2Flocale_facets_nonio.h?ref=d6f64424aa37b52776f4f24ba4f534bf915aa3a8", "patch": "@@ -138,9 +138,6 @@ _GLIBCXX_BEGIN_NAMESPACE_VERSION\n \n       ~__timepunct_cache();\n \n-      void\n-      _M_cache(const locale& __loc);\n-\n     private:\n       __timepunct_cache&\n       operator=(const __timepunct_cache&);"}, {"sha": "42c3504667e0d10f3b4c36c486dbaf729b185778", "filename": "libstdc++-v3/include/bits/locale_facets_nonio.tcc", "status": "modified", "additions": 20, "deletions": 16, "changes": 36, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/d6f64424aa37b52776f4f24ba4f534bf915aa3a8/libstdc%2B%2B-v3%2Finclude%2Fbits%2Flocale_facets_nonio.tcc", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/d6f64424aa37b52776f4f24ba4f534bf915aa3a8/libstdc%2B%2B-v3%2Finclude%2Fbits%2Flocale_facets_nonio.tcc", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libstdc%2B%2B-v3%2Finclude%2Fbits%2Flocale_facets_nonio.tcc?ref=d6f64424aa37b52776f4f24ba4f534bf915aa3a8", "patch": "@@ -68,8 +68,6 @@ _GLIBCXX_BEGIN_NAMESPACE_VERSION\n     void\n     __moneypunct_cache<_CharT, _Intl>::_M_cache(const locale& __loc)\n     {\n-      _M_allocated = true;\n-\n       const moneypunct<_CharT, _Intl>& __mp =\n \tuse_facet<moneypunct<_CharT, _Intl> >(__loc);\n \n@@ -83,36 +81,42 @@ _GLIBCXX_BEGIN_NAMESPACE_VERSION\n       _CharT* __negative_sign = 0;     \n       __try\n \t{\n-\t  _M_grouping_size = __mp.grouping().size();\n+\t  const string& __g = __mp.grouping();\n+\t  _M_grouping_size = __g.size();\n \t  __grouping = new char[_M_grouping_size];\n-\t  __mp.grouping().copy(__grouping, _M_grouping_size);\n-\t  _M_grouping = __grouping;\n+\t  __g.copy(__grouping, _M_grouping_size);\n \t  _M_use_grouping = (_M_grouping_size\n-\t\t\t     && static_cast<signed char>(_M_grouping[0]) > 0\n-\t\t\t     && (_M_grouping[0]\n+\t\t\t     && static_cast<signed char>(__grouping[0]) > 0\n+\t\t\t     && (__grouping[0]\n \t\t\t\t != __gnu_cxx::__numeric_traits<char>::__max));\n \n-\t  _M_curr_symbol_size = __mp.curr_symbol().size();\n+\t  const basic_string<_CharT>& __cs = __mp.curr_symbol();\n+\t  _M_curr_symbol_size = __cs.size();\n \t  __curr_symbol = new _CharT[_M_curr_symbol_size];\n-\t  __mp.curr_symbol().copy(__curr_symbol, _M_curr_symbol_size);\n-\t  _M_curr_symbol = __curr_symbol;\n+\t  __cs.copy(__curr_symbol, _M_curr_symbol_size);\n \n-\t  _M_positive_sign_size = __mp.positive_sign().size();\n+\t  const basic_string<_CharT>& __ps = __mp.positive_sign();\n+\t  _M_positive_sign_size = __ps.size();\n \t  __positive_sign = new _CharT[_M_positive_sign_size];\n-\t  __mp.positive_sign().copy(__positive_sign, _M_positive_sign_size);\n-\t  _M_positive_sign = __positive_sign;\n+\t  __ps.copy(__positive_sign, _M_positive_sign_size);\n \n-\t  _M_negative_sign_size = __mp.negative_sign().size();\n+\t  const basic_string<_CharT>& __ns = __mp.negative_sign();\n+\t  _M_negative_sign_size = __ns.size();\n \t  __negative_sign = new _CharT[_M_negative_sign_size];\n-\t  __mp.negative_sign().copy(__negative_sign, _M_negative_sign_size);\n-\t  _M_negative_sign = __negative_sign;\n+\t  __ns.copy(__negative_sign, _M_negative_sign_size);\n \n \t  _M_pos_format = __mp.pos_format();\n \t  _M_neg_format = __mp.neg_format();\n \n \t  const ctype<_CharT>& __ct = use_facet<ctype<_CharT> >(__loc);\n \t  __ct.widen(money_base::_S_atoms,\n \t\t     money_base::_S_atoms + money_base::_S_end, _M_atoms);\n+\n+\t  _M_grouping = __grouping;\n+\t  _M_curr_symbol = __curr_symbol;\n+\t  _M_positive_sign = __positive_sign;\n+\t  _M_negative_sign = __negative_sign;\n+\t  _M_allocated = true;\n \t}\n       __catch(...)\n \t{"}]}