{"sha": "e45de14ec7cfe457637bfea7ad214ab6158eefe5", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6ZTQ1ZGUxNGVjN2NmZTQ1NzYzN2JmZWE3YWQyMTRhYjYxNThlZWZlNQ==", "commit": {"author": {"name": "H.J. Lu", "email": "hongjiu.lu@intel.com", "date": "2013-11-06T21:50:42Z"}, "committer": {"name": "H.J. Lu", "email": "hjl@gcc.gnu.org", "date": "2013-11-06T21:50:42Z"}, "message": "Fix internal_clone for x32\n\n\tPR sanitizer/59018\n\t* sanitizer_common/sanitizer_linux.cc (internal_clone): Allocate\n\t2 64-bit integers to save and restore fn and arg.  Properly load\n\tnewtls/child_tidptr into r8/r10.\n\nFrom-SVN: r204481", "tree": {"sha": "69851a8c1b8b2b57f8cff2a7ff551f6c93367edf", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/69851a8c1b8b2b57f8cff2a7ff551f6c93367edf"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/e45de14ec7cfe457637bfea7ad214ab6158eefe5", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/e45de14ec7cfe457637bfea7ad214ab6158eefe5", "html_url": "https://github.com/Rust-GCC/gccrs/commit/e45de14ec7cfe457637bfea7ad214ab6158eefe5", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/e45de14ec7cfe457637bfea7ad214ab6158eefe5/comments", "author": {"login": "hjl-tools", "id": 1072356, "node_id": "MDQ6VXNlcjEwNzIzNTY=", "avatar_url": "https://avatars.githubusercontent.com/u/1072356?v=4", "gravatar_id": "", "url": "https://api.github.com/users/hjl-tools", "html_url": "https://github.com/hjl-tools", "followers_url": "https://api.github.com/users/hjl-tools/followers", "following_url": "https://api.github.com/users/hjl-tools/following{/other_user}", "gists_url": "https://api.github.com/users/hjl-tools/gists{/gist_id}", "starred_url": "https://api.github.com/users/hjl-tools/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/hjl-tools/subscriptions", "organizations_url": "https://api.github.com/users/hjl-tools/orgs", "repos_url": "https://api.github.com/users/hjl-tools/repos", "events_url": "https://api.github.com/users/hjl-tools/events{/privacy}", "received_events_url": "https://api.github.com/users/hjl-tools/received_events", "type": "User", "site_admin": false}, "committer": null, "parents": [{"sha": "38693e39b6de02d0e868e18a73de39e62fee3936", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/38693e39b6de02d0e868e18a73de39e62fee3936", "html_url": "https://github.com/Rust-GCC/gccrs/commit/38693e39b6de02d0e868e18a73de39e62fee3936"}], "stats": {"total": 23, "additions": 15, "deletions": 8}, "files": [{"sha": "6103d62b3290efbbf61e9b21057d90400ad81f5d", "filename": "libsanitizer/ChangeLog", "status": "modified", "additions": 7, "deletions": 0, "changes": 7, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/e45de14ec7cfe457637bfea7ad214ab6158eefe5/libsanitizer%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/e45de14ec7cfe457637bfea7ad214ab6158eefe5/libsanitizer%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libsanitizer%2FChangeLog?ref=e45de14ec7cfe457637bfea7ad214ab6158eefe5", "patch": "@@ -1,3 +1,10 @@\n+2013-11-05  H.J. Lu  <hongjiu.lu@intel.com>\n+\n+\tPR sanitizer/59018\n+\t* sanitizer_common/sanitizer_linux.cc (internal_clone): Allocate\n+\t2 64-bit integers to save and restore fn and arg.  Properly load\n+\tnewtls/child_tidptr into r8/r10.\n+\n 2013-11-05  H.J. Lu  <hongjiu.lu@intel.com>\n \n \tPR sanitizer/59018"}, {"sha": "2763313015ab27c8b7ae1abf4a2dbfb0136915ab", "filename": "libsanitizer/sanitizer_common/sanitizer_linux.cc", "status": "modified", "additions": 8, "deletions": 8, "changes": 16, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/e45de14ec7cfe457637bfea7ad214ab6158eefe5/libsanitizer%2Fsanitizer_common%2Fsanitizer_linux.cc", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/e45de14ec7cfe457637bfea7ad214ab6158eefe5/libsanitizer%2Fsanitizer_common%2Fsanitizer_linux.cc", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libsanitizer%2Fsanitizer_common%2Fsanitizer_linux.cc?ref=e45de14ec7cfe457637bfea7ad214ab6158eefe5", "patch": "@@ -772,9 +772,11 @@ uptr internal_clone(int (*fn)(void *), void *child_stack, int flags, void *arg,\n   if (!fn || !child_stack)\n     return -EINVAL;\n   CHECK_EQ(0, (uptr)child_stack % 16);\n-  child_stack = (char *)child_stack - 2 * sizeof(void *);\n-  ((void **)child_stack)[0] = (void *)(uptr)fn;\n-  ((void **)child_stack)[1] = arg;\n+  child_stack = (char *)child_stack - 2 * sizeof(unsigned long long);\n+  ((unsigned long long *)child_stack)[0] = (uptr)fn;\n+  ((unsigned long long *)child_stack)[1] = (uptr)arg;\n+  register void *r8 __asm__ (\"r8\") = newtls;\n+  register int *r10 __asm__ (\"r10\") = child_tidptr;\n   __asm__ __volatile__(\n                        /* %rax = syscall(%rax = __NR_clone,\n                         *                %rdi = flags,\n@@ -783,8 +785,6 @@ uptr internal_clone(int (*fn)(void *), void *child_stack, int flags, void *arg,\n                         *                %r8  = new_tls,\n                         *                %r10 = child_tidptr)\n                         */\n-                       \"movq   %6,%%r8\\n\"\n-                       \"movq   %7,%%r10\\n\"\n                        \".cfi_endproc\\n\"\n                        \"syscall\\n\"\n \n@@ -816,9 +816,9 @@ uptr internal_clone(int (*fn)(void *), void *child_stack, int flags, void *arg,\n                          \"S\"(child_stack),\n                          \"D\"(flags),\n                          \"d\"(parent_tidptr),\n-                         \"r\"(newtls),\n-                         \"r\"(child_tidptr)\n-                       : \"rsp\", \"memory\", \"r8\", \"r10\", \"r11\", \"rcx\");\n+                         \"r\"(r8),\n+                         \"r\"(r10)\n+                       : \"rsp\", \"memory\", \"r11\", \"rcx\");\n   return res;\n }\n #endif  // defined(__x86_64__)"}]}