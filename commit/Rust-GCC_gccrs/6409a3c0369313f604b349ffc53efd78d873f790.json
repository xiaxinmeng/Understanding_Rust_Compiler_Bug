{"sha": "6409a3c0369313f604b349ffc53efd78d873f790", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6NjQwOWEzYzAzNjkzMTNmNjA0YjM0OWZmYzUzZWZkNzhkODczZjc5MA==", "commit": {"author": {"name": "Tobias Burnus", "email": "tobias@codesourcery.com", "date": "2019-10-31T10:06:19Z"}, "committer": {"name": "Tobias Burnus", "email": "burnus@gcc.gnu.org", "date": "2019-10-31T10:06:19Z"}, "message": "Fortran] PR92277 - Fix assumed-rank array with bind(C)\n\n        gcc/fortran/\n        PR fortran/92277\n        * trans-expr.c (gfc_conv_gfc_desc_to_cfi_desc): Fix DECL_ARTIFICIAL\n        checking.\n\n        gcc/testsuite/\n        PR fortran/92277\n        * fortran.dg/pr92277.f90: New.\n\nFrom-SVN: r277661", "tree": {"sha": "803e6e75e13969bc7585fbf7a45df074fea510a4", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/803e6e75e13969bc7585fbf7a45df074fea510a4"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/6409a3c0369313f604b349ffc53efd78d873f790", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/6409a3c0369313f604b349ffc53efd78d873f790", "html_url": "https://github.com/Rust-GCC/gccrs/commit/6409a3c0369313f604b349ffc53efd78d873f790", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/6409a3c0369313f604b349ffc53efd78d873f790/comments", "author": {"login": "tob2", "id": 264461, "node_id": "MDQ6VXNlcjI2NDQ2MQ==", "avatar_url": "https://avatars.githubusercontent.com/u/264461?v=4", "gravatar_id": "", "url": "https://api.github.com/users/tob2", "html_url": "https://github.com/tob2", "followers_url": "https://api.github.com/users/tob2/followers", "following_url": "https://api.github.com/users/tob2/following{/other_user}", "gists_url": "https://api.github.com/users/tob2/gists{/gist_id}", "starred_url": "https://api.github.com/users/tob2/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/tob2/subscriptions", "organizations_url": "https://api.github.com/users/tob2/orgs", "repos_url": "https://api.github.com/users/tob2/repos", "events_url": "https://api.github.com/users/tob2/events{/privacy}", "received_events_url": "https://api.github.com/users/tob2/received_events", "type": "User", "site_admin": false}, "committer": null, "parents": [{"sha": "6773658a809fbebcdb68483cb929207150ac7e5f", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/6773658a809fbebcdb68483cb929207150ac7e5f", "html_url": "https://github.com/Rust-GCC/gccrs/commit/6773658a809fbebcdb68483cb929207150ac7e5f"}], "stats": {"total": 50, "additions": 48, "deletions": 2}, "files": [{"sha": "e1771687d16530f4e934368753a0ce0799caf4a6", "filename": "gcc/fortran/ChangeLog", "status": "modified", "additions": 6, "deletions": 0, "changes": 6, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/6409a3c0369313f604b349ffc53efd78d873f790/gcc%2Ffortran%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/6409a3c0369313f604b349ffc53efd78d873f790/gcc%2Ffortran%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ffortran%2FChangeLog?ref=6409a3c0369313f604b349ffc53efd78d873f790", "patch": "@@ -1,3 +1,9 @@\n+2019-10-31  Tobias Burnus  <tobias@codesourcery.com>\n+\n+\tPR fortran/92277\n+\t* trans-expr.c (gfc_conv_gfc_desc_to_cfi_desc): Fix DECL_ARTIFICIAL\n+\tchecking.\n+\n 2019-10-30  Tobias Burnus  <tobias@codesourcery.com>\n \n \tPR fortran/92208"}, {"sha": "381e314a9b56dae5ae86a07121dcab7e703da01c", "filename": "gcc/fortran/trans-expr.c", "status": "modified", "additions": 5, "deletions": 2, "changes": 7, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/6409a3c0369313f604b349ffc53efd78d873f790/gcc%2Ffortran%2Ftrans-expr.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/6409a3c0369313f604b349ffc53efd78d873f790/gcc%2Ffortran%2Ftrans-expr.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ffortran%2Ftrans-expr.c?ref=6409a3c0369313f604b349ffc53efd78d873f790", "patch": "@@ -5239,6 +5239,9 @@ gfc_conv_gfc_desc_to_cfi_desc (gfc_se *parmse, gfc_expr *e, gfc_symbol *fsym)\n       if (POINTER_TYPE_P (TREE_TYPE (parmse->expr)))\n \tparmse->expr = build_fold_indirect_ref_loc (input_location,\n \t\t\t\t\t\t    parmse->expr);\n+      bool is_artificial = (INDIRECT_REF_P (parmse->expr)\n+\t\t\t    ? DECL_ARTIFICIAL (TREE_OPERAND (parmse->expr, 0))\n+\t\t\t    : DECL_ARTIFICIAL (parmse->expr));\n \n       /* Unallocated allocatable arrays and unassociated pointer arrays\n \t need their dtype setting if they are argument associated with\n@@ -5258,7 +5261,7 @@ gfc_conv_gfc_desc_to_cfi_desc (gfc_se *parmse, gfc_expr *e, gfc_symbol *fsym)\n       type = e->ts.type != BT_ASSUMED ? gfc_typenode_for_spec (&e->ts) :\n \t\t\t\t\tNULL_TREE;\n \n-      if (type && DECL_ARTIFICIAL (parmse->expr)\n+      if (type && is_artificial\n \t  && type != gfc_get_element_type (TREE_TYPE (parmse->expr)))\n \t{\n \t  /* Obtain the offset to the data.  */\n@@ -5271,7 +5274,7 @@ gfc_conv_gfc_desc_to_cfi_desc (gfc_se *parmse, gfc_expr *e, gfc_symbol *fsym)\n \t\t\t  gfc_get_dtype_rank_type (e->rank, type));\n \t}\n       else if (type == NULL_TREE\n-\t       || (!is_subref_array (e) && !DECL_ARTIFICIAL (parmse->expr)))\n+\t       || (!is_subref_array (e) && !is_artificial))\n \t{\n \t  /* Make sure that the span is set for expressions where it\n \t     might not have been done already.  */"}, {"sha": "6b9451b8edecc716c5a6e87d48a405bb75808c60", "filename": "gcc/testsuite/ChangeLog", "status": "modified", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/6409a3c0369313f604b349ffc53efd78d873f790/gcc%2Ftestsuite%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/6409a3c0369313f604b349ffc53efd78d873f790/gcc%2Ftestsuite%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2FChangeLog?ref=6409a3c0369313f604b349ffc53efd78d873f790", "patch": "@@ -1,3 +1,8 @@\n+2019-10-31  Tobias Burnus  <tobias@codesourcery.com>\n+\n+\tPR fortran/92277\n+\t* fortran.dg/pr92277.f90: New.\n+\n 2019-10-31  Jakub Jelinek  <jakub@redhat.com>\n \n \tPR middle-end/92231"}, {"sha": "5121063f5f38701939563c792117549f6039e422", "filename": "gcc/testsuite/gfortran.dg/pr92277.f90", "status": "added", "additions": 32, "deletions": 0, "changes": 32, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/6409a3c0369313f604b349ffc53efd78d873f790/gcc%2Ftestsuite%2Fgfortran.dg%2Fpr92277.f90", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/6409a3c0369313f604b349ffc53efd78d873f790/gcc%2Ftestsuite%2Fgfortran.dg%2Fpr92277.f90", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgfortran.dg%2Fpr92277.f90?ref=6409a3c0369313f604b349ffc53efd78d873f790", "patch": "@@ -0,0 +1,32 @@\n+! { dg-do compile }\n+!\n+! PR fortran/92277\n+!\n+! Contributed by Jos\u00e9 Rui Faustino de Sousa\n+!\n+module arr_m\n+  implicit none\n+contains\n+  subroutine arr_set(this, that)\n+    integer, intent(out) :: this(..)\n+    integer, optional, intent(out) :: that(..)\n+\n+    interface\n+      subroutine arr_set_c(this) bind(c)\n+        use, intrinsic :: iso_c_binding, only: c_int\n+        implicit none\n+        integer(kind=c_int), intent(out) :: this(..)\n+      end subroutine arr_set_c\n+      subroutine arr_set_c_opt(this) bind(c)\n+        use, intrinsic :: iso_c_binding, only: c_int\n+        implicit none\n+        integer(kind=c_int), optional, intent(out) :: this(..)\n+      end subroutine arr_set_c_opt\n+    end interface\n+\n+    call arr_set_c(this)\n+    call arr_set_c(that)\n+    call arr_set_c_opt(this)\n+    call arr_set_c_opt(that)\n+  end subroutine arr_set\n+end module arr_m"}]}