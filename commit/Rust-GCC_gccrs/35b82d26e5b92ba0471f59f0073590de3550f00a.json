{"sha": "35b82d26e5b92ba0471f59f0073590de3550f00a", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6MzViODJkMjZlNWI5MmJhMDQ3MWY1OWYwMDczNTkwZGUzNTUwZjAwYQ==", "commit": {"author": {"name": "Nathan Sidwell", "email": "nathan@acm.org", "date": "2017-10-10T18:56:31Z"}, "committer": {"name": "Nathan Sidwell", "email": "nathan@gcc.gnu.org", "date": "2017-10-10T18:56:31Z"}, "message": "[PATCH] preprocessor stringizing raw strings\n\nhttps://gcc.gnu.org/ml/gcc-patches/2017-10/msg00611.html\n\tlibcpp/\n\tPR preprocessor/82506\n\t* macro.c (cpp_quote_string): Escape raw LFs.\n\n\tgcc/testsuite/\n\tPR preprocessor/82506\n\t* g++.dg/cpp/string-3.C: New.\n\nFrom-SVN: r253605", "tree": {"sha": "4fc1cc6080449593ca09e8bd58284591bc52f03a", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/4fc1cc6080449593ca09e8bd58284591bc52f03a"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/35b82d26e5b92ba0471f59f0073590de3550f00a", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/35b82d26e5b92ba0471f59f0073590de3550f00a", "html_url": "https://github.com/Rust-GCC/gccrs/commit/35b82d26e5b92ba0471f59f0073590de3550f00a", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/35b82d26e5b92ba0471f59f0073590de3550f00a/comments", "author": {"login": "urnathan", "id": 13103001, "node_id": "MDQ6VXNlcjEzMTAzMDAx", "avatar_url": "https://avatars.githubusercontent.com/u/13103001?v=4", "gravatar_id": "", "url": "https://api.github.com/users/urnathan", "html_url": "https://github.com/urnathan", "followers_url": "https://api.github.com/users/urnathan/followers", "following_url": "https://api.github.com/users/urnathan/following{/other_user}", "gists_url": "https://api.github.com/users/urnathan/gists{/gist_id}", "starred_url": "https://api.github.com/users/urnathan/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/urnathan/subscriptions", "organizations_url": "https://api.github.com/users/urnathan/orgs", "repos_url": "https://api.github.com/users/urnathan/repos", "events_url": "https://api.github.com/users/urnathan/events{/privacy}", "received_events_url": "https://api.github.com/users/urnathan/received_events", "type": "User", "site_admin": false}, "committer": null, "parents": [{"sha": "eb484969f654680683aa2a419929029c2903d0b7", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/eb484969f654680683aa2a419929029c2903d0b7", "html_url": "https://github.com/Rust-GCC/gccrs/commit/eb484969f654680683aa2a419929029c2903d0b7"}], "stats": {"total": 33, "additions": 30, "deletions": 3}, "files": [{"sha": "0cc5e32bdff4e4e589690f0986f7fff7a8ece9ae", "filename": "gcc/testsuite/ChangeLog", "status": "modified", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/35b82d26e5b92ba0471f59f0073590de3550f00a/gcc%2Ftestsuite%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/35b82d26e5b92ba0471f59f0073590de3550f00a/gcc%2Ftestsuite%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2FChangeLog?ref=35b82d26e5b92ba0471f59f0073590de3550f00a", "patch": "@@ -1,3 +1,8 @@\n+2017-10-10  Nathan Sidwell  <nathan@acm.org>\n+\n+\tPR preprocessor/82506\n+\t* g++.dg/cpp/string-3.C: New.\n+\n 2017-10-10  Will Schmidt  <will_schmidt@vnet.ibm.com>\n \n \t* gcc.target/powerpc/fold-vec-splat-16.c: New"}, {"sha": "92bd930dc261a414099adc8c94aec0d5dd673e56", "filename": "gcc/testsuite/g++.dg/cpp/string-3.C", "status": "added", "additions": 9, "deletions": 0, "changes": 9, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/35b82d26e5b92ba0471f59f0073590de3550f00a/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Fcpp%2Fstring-3.C", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/35b82d26e5b92ba0471f59f0073590de3550f00a/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Fcpp%2Fstring-3.C", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Fcpp%2Fstring-3.C?ref=35b82d26e5b92ba0471f59f0073590de3550f00a", "patch": "@@ -0,0 +1,9 @@\n+// PR c++/82506\n+// { dg-do preprocess { target c++11 } }\n+\n+#define STRINGIZE(A) #A\n+\n+BEGIN STRINGIZE(R\"(\n+)\") END\n+\n+// { dg-final { scan-file string-3.ii \"BEGIN \\\"R\\\\\\\"(\\\\n)\\\\\\\"\\\"\\n END\" } }"}, {"sha": "f2c0d4d63fd897b85f4b307d7fc885e5bffbe81a", "filename": "libcpp/ChangeLog", "status": "modified", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/35b82d26e5b92ba0471f59f0073590de3550f00a/libcpp%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/35b82d26e5b92ba0471f59f0073590de3550f00a/libcpp%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libcpp%2FChangeLog?ref=35b82d26e5b92ba0471f59f0073590de3550f00a", "patch": "@@ -1,3 +1,8 @@\n+2017-10-10  Nathan Sidwell  <nathan@acm.org>\n+\n+\tPR preprocessor/82506\n+\t* macro.c (cpp_quote_string): Escape raw LFs.\n+\n 2017-09-15  Andrew Sutton  <andrew.n.sutton@gmail.com>\n \t    Jakub Jelinek  <jakub@redhat.com>\n "}, {"sha": "fab1cb051dc78569c3adf2661b22c043d8ed09c3", "filename": "libcpp/macro.c", "status": "modified", "additions": 11, "deletions": 3, "changes": 14, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/35b82d26e5b92ba0471f59f0073590de3550f00a/libcpp%2Fmacro.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/35b82d26e5b92ba0471f59f0073590de3550f00a/libcpp%2Fmacro.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libcpp%2Fmacro.c?ref=35b82d26e5b92ba0471f59f0073590de3550f00a", "patch": "@@ -502,13 +502,21 @@ cpp_quote_string (uchar *dest, const uchar *src, unsigned int len)\n     {\n       uchar c = *src++;\n \n-      if (c == '\\\\' || c == '\"')\n+      switch (c)\n \t{\n+\tcase '\\n':\n+\t  /* Naked LF can appear in raw string literals  */\n+\t  c = 'n';\n+\t  /* FALLTHROUGH */\n+\n+\tcase '\\\\':\n+\tcase '\"':\n \t  *dest++ = '\\\\';\n+\t  /* FALLTHROUGH */\n+\n+\tdefault:\n \t  *dest++ = c;\n \t}\n-      else\n-\t  *dest++ = c;\n     }\n \n   return dest;"}]}