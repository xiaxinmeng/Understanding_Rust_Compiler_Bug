{"sha": "51df93ba5be0a0cbc2f38b30caf813d4bc6eece0", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6NTFkZjkzYmE1YmUwYTBjYmMyZjM4YjMwY2FmODEzZDRiYzZlZWNlMA==", "commit": {"author": {"name": "Paul Thomas", "email": "pault@gcc.gnu.org", "date": "2009-01-10T00:15:37Z"}, "committer": {"name": "Paul Thomas", "email": "pault@gcc.gnu.org", "date": "2009-01-10T00:15:37Z"}, "message": "re PR fortran/38763 (TRANSFER ICE due to missing EXPR_NULL case)\n\n2009-01-10  Paul Thomas  <pault@gcc.gnu.org>\n\n\tPR fortran/38763\n\t* target-memory.c (encode_derived): Encode NULL.\n\n2009-01-10  Paul Thomas  <pault@gcc.gnu.org>\n\n\tPR fortran/38763\n\t* gfortran.dg/transfer_null_1.f90: New test.\n\nFrom-SVN: r143238", "tree": {"sha": "bdc9d063c82d482ad2b2dd28eaf839b89621a799", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/bdc9d063c82d482ad2b2dd28eaf839b89621a799"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/51df93ba5be0a0cbc2f38b30caf813d4bc6eece0", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/51df93ba5be0a0cbc2f38b30caf813d4bc6eece0", "html_url": "https://github.com/Rust-GCC/gccrs/commit/51df93ba5be0a0cbc2f38b30caf813d4bc6eece0", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/51df93ba5be0a0cbc2f38b30caf813d4bc6eece0/comments", "author": null, "committer": null, "parents": [{"sha": "9be3684bdd98f40b323958bc5f083c62846fc45b", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/9be3684bdd98f40b323958bc5f083c62846fc45b", "html_url": "https://github.com/Rust-GCC/gccrs/commit/9be3684bdd98f40b323958bc5f083c62846fc45b"}], "stats": {"total": 41, "additions": 38, "deletions": 3}, "files": [{"sha": "b3d179910ccac2265fe62cd215b081517d9449c5", "filename": "gcc/fortran/ChangeLog", "status": "modified", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/51df93ba5be0a0cbc2f38b30caf813d4bc6eece0/gcc%2Ffortran%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/51df93ba5be0a0cbc2f38b30caf813d4bc6eece0/gcc%2Ffortran%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ffortran%2FChangeLog?ref=51df93ba5be0a0cbc2f38b30caf813d4bc6eece0", "patch": "@@ -1,3 +1,8 @@\n+2009-01-10  Paul Thomas  <pault@gcc.gnu.org>\n+\n+\tPR fortran/38763\n+\t* target-memory.c (encode_derived): Encode NULL.\n+\n 2009-01-10  Paul Thomas  <pault@gcc.gnu.org>\n \n \tPR fortran/38765"}, {"sha": "dc10b53d926e7885812d3d56c59a84287954092c", "filename": "gcc/fortran/target-memory.c", "status": "modified", "additions": 8, "deletions": 3, "changes": 11, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/51df93ba5be0a0cbc2f38b30caf813d4bc6eece0/gcc%2Ffortran%2Ftarget-memory.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/51df93ba5be0a0cbc2f38b30caf813d4bc6eece0/gcc%2Ffortran%2Ftarget-memory.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ffortran%2Ftarget-memory.c?ref=51df93ba5be0a0cbc2f38b30caf813d4bc6eece0", "patch": "@@ -1,5 +1,5 @@\n /* Simulate storage of variables into target memory.\n-   Copyright (C) 2007, 2008\n+   Copyright (C) 2007, 2008, 2009\n    Free Software Foundation, Inc.\n    Contributed by Paul Thomas and Brooks Moses\n \n@@ -220,8 +220,13 @@ encode_derived (gfc_expr *source, unsigned char *buffer, size_t buffer_size)\n \tcontinue;\n       ptr = TREE_INT_CST_LOW(DECL_FIELD_OFFSET(cmp->backend_decl))\n \t    + TREE_INT_CST_LOW(DECL_FIELD_BIT_OFFSET(cmp->backend_decl))/8;\n-      gfc_target_encode_expr (ctr->expr, &buffer[ptr],\n-\t\t\t      buffer_size - ptr);\n+\n+      if (ctr->expr->expr_type == EXPR_NULL)\n+ \tmemset (&buffer[ptr], 0,\n+\t\tint_size_in_bytes (TREE_TYPE (cmp->backend_decl)));\n+      else\n+\tgfc_target_encode_expr (ctr->expr, &buffer[ptr],\n+\t\t\t\tbuffer_size - ptr);\n     }\n \n   return int_size_in_bytes (type);"}, {"sha": "4765a8e8abe3a8dfb1b7883080348d0a05e61e5e", "filename": "gcc/testsuite/ChangeLog", "status": "modified", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/51df93ba5be0a0cbc2f38b30caf813d4bc6eece0/gcc%2Ftestsuite%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/51df93ba5be0a0cbc2f38b30caf813d4bc6eece0/gcc%2Ftestsuite%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2FChangeLog?ref=51df93ba5be0a0cbc2f38b30caf813d4bc6eece0", "patch": "@@ -1,3 +1,8 @@\n+2009-01-10  Paul Thomas  <pault@gcc.gnu.org>\n+\n+\tPR fortran/38763\n+\t* gfortran.dg/transfer_null_1.f90: New test.\n+\n 2009-01-10  Paul Thomas  <pault@gcc.gnu.org>\n \n \tPR fortran/38765"}, {"sha": "7201a68b38c86d71150fc69202137cf8434e076f", "filename": "gcc/testsuite/gfortran.dg/transfer_null_1.f90", "status": "added", "additions": 20, "deletions": 0, "changes": 20, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/51df93ba5be0a0cbc2f38b30caf813d4bc6eece0/gcc%2Ftestsuite%2Fgfortran.dg%2Ftransfer_null_1.f90", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/51df93ba5be0a0cbc2f38b30caf813d4bc6eece0/gcc%2Ftestsuite%2Fgfortran.dg%2Ftransfer_null_1.f90", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgfortran.dg%2Ftransfer_null_1.f90?ref=51df93ba5be0a0cbc2f38b30caf813d4bc6eece0", "patch": "@@ -0,0 +1,20 @@\n+! { dg-do compile }\n+! Test fix for pr38763, where NULL was not being encoded.\n+!\n+! Contributed by Steve Kargl <kargl@gcc.gnu.org> from a\n+! posting by James van Buskirk on clf.\n+!\n+program sizetest\n+   use ISO_C_BINDING\n+   implicit none\n+   integer, parameter :: ik1 = selected_int_kind(2)\n+   TYPE vehicle_t1\n+      INTEGER(C_INT), DIMENSION(:), ALLOCATABLE :: sensors\n+   END TYPE vehicle_t1\n+   type(vehicle_t1) gfortran_bug_workaround\n+   integer i\n+   i = size(transfer(vehicle_t1(NULL()),[0_ik1]))\n+   print *, i\n+   i = size(transfer(vehicle_t1([i]),[0_ik1]))\n+   print *, i\n+end program sizetest"}]}