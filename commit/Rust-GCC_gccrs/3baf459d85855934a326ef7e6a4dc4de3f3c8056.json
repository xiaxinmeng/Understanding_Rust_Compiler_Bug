{"sha": "3baf459d85855934a326ef7e6a4dc4de3f3c8056", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6M2JhZjQ1OWQ4NTg1NTkzNGEzMjZlZjdlNmE0ZGM0ZGUzZjNjODA1Ng==", "commit": {"author": {"name": "Diego Novillo", "email": "dnovillo@google.com", "date": "2009-04-19T17:52:03Z"}, "committer": {"name": "Diego Novillo", "email": "dnovillo@gcc.gnu.org", "date": "2009-04-19T17:52:03Z"}, "message": "toplev.c (compile_file): Move call to coverage_finish ...\n\n\n\t* toplev.c (compile_file): Move call to coverage_finish ...\n\t* cgraphunit.c (ipa_passes): ... here.\n\tCall cgraph_process_new_functions.\n\t* ipa-utils.c (get_base_var): Handle CONSTRUCTOR.\n\t* Makefile.in (cgraphunit.o): Add dependency on COVERAGE_H.\n\nFrom-SVN: r146354", "tree": {"sha": "bb5a4b60b2fba01c8f07af7dea9726c29ea518ca", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/bb5a4b60b2fba01c8f07af7dea9726c29ea518ca"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/3baf459d85855934a326ef7e6a4dc4de3f3c8056", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/3baf459d85855934a326ef7e6a4dc4de3f3c8056", "html_url": "https://github.com/Rust-GCC/gccrs/commit/3baf459d85855934a326ef7e6a4dc4de3f3c8056", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/3baf459d85855934a326ef7e6a4dc4de3f3c8056/comments", "author": {"login": "dnovillo", "id": 7295335, "node_id": "MDQ6VXNlcjcyOTUzMzU=", "avatar_url": "https://avatars.githubusercontent.com/u/7295335?v=4", "gravatar_id": "", "url": "https://api.github.com/users/dnovillo", "html_url": "https://github.com/dnovillo", "followers_url": "https://api.github.com/users/dnovillo/followers", "following_url": "https://api.github.com/users/dnovillo/following{/other_user}", "gists_url": "https://api.github.com/users/dnovillo/gists{/gist_id}", "starred_url": "https://api.github.com/users/dnovillo/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/dnovillo/subscriptions", "organizations_url": "https://api.github.com/users/dnovillo/orgs", "repos_url": "https://api.github.com/users/dnovillo/repos", "events_url": "https://api.github.com/users/dnovillo/events{/privacy}", "received_events_url": "https://api.github.com/users/dnovillo/received_events", "type": "User", "site_admin": false}, "committer": null, "parents": [{"sha": "aa50850225d70521ace3948a8e5858425a918f6a", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/aa50850225d70521ace3948a8e5858425a918f6a", "html_url": "https://github.com/Rust-GCC/gccrs/commit/aa50850225d70521ace3948a8e5858425a918f6a"}], "stats": {"total": 30, "additions": 23, "deletions": 7}, "files": [{"sha": "2566ff7e457035f560981a238b2dfe95b359a8a7", "filename": "gcc/ChangeLog", "status": "modified", "additions": 8, "deletions": 0, "changes": 8, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/3baf459d85855934a326ef7e6a4dc4de3f3c8056/gcc%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/3baf459d85855934a326ef7e6a4dc4de3f3c8056/gcc%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2FChangeLog?ref=3baf459d85855934a326ef7e6a4dc4de3f3c8056", "patch": "@@ -1,3 +1,11 @@\n+2009-04-19  Diego Novillo  <dnovillo@google.com>\n+\n+\t* toplev.c (compile_file): Move call to coverage_finish ...\n+\t* cgraphunit.c (ipa_passes): ... here.\n+\tCall cgraph_process_new_functions.\n+\t* ipa-utils.c (get_base_var): Handle CONSTRUCTOR.\n+\t* Makefile.in (cgraphunit.o): Add dependency on COVERAGE_H.\n+\n 2009-04-19  Jan Hubicka  <jh@suse.cz>\n \n \t* cgraph.c (cgraph_create_edge, cgraph_set_call_stmt): Set proper cfun."}, {"sha": "f4f6764aff897d3554ced6a0313b1f28bf6313d4", "filename": "gcc/Makefile.in", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/3baf459d85855934a326ef7e6a4dc4de3f3c8056/gcc%2FMakefile.in", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/3baf459d85855934a326ef7e6a4dc4de3f3c8056/gcc%2FMakefile.in", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2FMakefile.in?ref=3baf459d85855934a326ef7e6a4dc4de3f3c8056", "patch": "@@ -2615,7 +2615,7 @@ cgraphunit.o : cgraphunit.c $(CONFIG_H) $(SYSTEM_H) coretypes.h $(TM_H) \\\n    $(TARGET_H) $(CGRAPH_H) intl.h pointer-set.h $(FUNCTION_H) $(GIMPLE_H) \\\n    $(TREE_FLOW_H) $(TREE_PASS_H) $(C_COMMON_H) debug.h $(DIAGNOSTIC_H) \\\n    $(FIBHEAP_H) output.h $(PARAMS_H) $(RTL_H) $(TIMEVAR_H) $(IPA_PROP_H) \\\n-   gt-cgraphunit.h tree-iterator.h\n+   gt-cgraphunit.h tree-iterator.h $(COVERAGE_H)\n cgraphbuild.o : cgraphbuild.c $(CONFIG_H) $(SYSTEM_H) coretypes.h $(TM_H) \\\n    $(TREE_H) langhooks.h $(CGRAPH_H) intl.h pointer-set.h $(GIMPLE_H) \\\n    $(TREE_FLOW_H) $(TREE_PASS_H)"}, {"sha": "a99b7dfe96d49c3426b80e030a51d611dd75089d", "filename": "gcc/cgraphunit.c", "status": "modified", "additions": 12, "deletions": 0, "changes": 12, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/3baf459d85855934a326ef7e6a4dc4de3f3c8056/gcc%2Fcgraphunit.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/3baf459d85855934a326ef7e6a4dc4de3f3c8056/gcc%2Fcgraphunit.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fcgraphunit.c?ref=3baf459d85855934a326ef7e6a4dc4de3f3c8056", "patch": "@@ -134,6 +134,7 @@ along with GCC; see the file COPYING3.  If not see\n #include \"tree-iterator.h\"\n #include \"tree-pass.h\"\n #include \"output.h\"\n+#include \"coverage.h\"\n \n static void cgraph_expand_all_functions (void);\n static void cgraph_mark_functions_to_output (void);\n@@ -978,6 +979,8 @@ cgraph_finalize_compilation_unit (void)\n   cgraph_analyze_functions ();\n   timevar_pop (TV_CGRAPH);\n }\n+\n+\n /* Figure out what functions we want to assemble.  */\n \n static void\n@@ -1238,6 +1241,15 @@ ipa_passes (void)\n   gimple_register_cfg_hooks ();\n   bitmap_obstack_initialize (NULL);\n   execute_ipa_pass_list (all_ipa_passes);\n+\n+  /* Generate coverage variables and constructors.  */\n+  coverage_finish ();\n+\n+  /* Process new functions added.  */\n+  set_cfun (NULL);\n+  current_function_decl = NULL;\n+  cgraph_process_new_functions ();\n+\n   bitmap_obstack_release (NULL);\n }\n "}, {"sha": "97a2b3c823742ff0fae29e638b1f6e0ae544d381", "filename": "gcc/ipa-utils.c", "status": "modified", "additions": 2, "deletions": 1, "changes": 3, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/3baf459d85855934a326ef7e6a4dc4de3f3c8056/gcc%2Fipa-utils.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/3baf459d85855934a326ef7e6a4dc4de3f3c8056/gcc%2Fipa-utils.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fipa-utils.c?ref=3baf459d85855934a326ef7e6a4dc4de3f3c8056", "patch": "@@ -222,7 +222,8 @@ get_base_var (tree t)\n \t && (!CONSTANT_CLASS_P (t))\n \t && TREE_CODE (t) != LABEL_DECL\n \t && TREE_CODE (t) != FUNCTION_DECL\n-\t && TREE_CODE (t) != CONST_DECL)\n+\t && TREE_CODE (t) != CONST_DECL\n+\t && TREE_CODE (t) != CONSTRUCTOR)\n     {\n       t = TREE_OPERAND (t, 0);\n     }"}, {"sha": "95b5ba3d70d682f319287508f96657e7036a6189", "filename": "gcc/toplev.c", "status": "modified", "additions": 0, "deletions": 5, "changes": 5, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/3baf459d85855934a326ef7e6a4dc4de3f3c8056/gcc%2Ftoplev.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/3baf459d85855934a326ef7e6a4dc4de3f3c8056/gcc%2Ftoplev.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftoplev.c?ref=3baf459d85855934a326ef7e6a4dc4de3f3c8056", "patch": "@@ -993,11 +993,6 @@ compile_file (void)\n   varpool_assemble_pending_decls ();\n   finish_aliases_2 ();\n \n-  /* This must occur after the loop to output deferred functions.\n-     Else the coverage initializer would not be emitted if all the\n-     functions in this compilation unit were deferred.  */\n-  coverage_finish ();\n-\n   /* Likewise for mudflap static object registrations.  */\n   if (flag_mudflap)\n     mudflap_finish_file ();"}]}