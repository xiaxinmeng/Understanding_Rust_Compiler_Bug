{"sha": "f1607c0199cf4c62a27a73d580e5bc25eb46e6ef", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6ZjE2MDdjMDE5OWNmNGM2MmEyN2E3M2Q1ODBlNWJjMjVlYjQ2ZTZlZg==", "commit": {"author": {"name": "Jerry DeLisle", "email": "jvdelisle@gcc.gnu.org", "date": "2007-11-25T22:12:19Z"}, "committer": {"name": "Jerry DeLisle", "email": "jvdelisle@gcc.gnu.org", "date": "2007-11-25T22:12:19Z"}, "message": "re PR fortran/33152 (Initialization/declaration problems in block data)\n\n2007-11-25  Jerry DeLisle  <jvdelisle@gcc.gnu.org>\n\n\tPR fortran/33152\n\t* decl.c (add_init_expr_to_sym): Remove error message.\n\t* resolve.c (check_data_variable): Add new check for a data variable\n\tthat has an array spec, but no ref and issue an error.\n\t* match.c (gfc_match_common): Remove error message.\n\nFrom-SVN: r130415", "tree": {"sha": "9cf8bd0129df397f429356cb278234f8fd226202", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/9cf8bd0129df397f429356cb278234f8fd226202"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/f1607c0199cf4c62a27a73d580e5bc25eb46e6ef", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/f1607c0199cf4c62a27a73d580e5bc25eb46e6ef", "html_url": "https://github.com/Rust-GCC/gccrs/commit/f1607c0199cf4c62a27a73d580e5bc25eb46e6ef", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/f1607c0199cf4c62a27a73d580e5bc25eb46e6ef/comments", "author": null, "committer": null, "parents": [{"sha": "bfd61955ce652ec1c4bb1228fcf43e46424ebf41", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/bfd61955ce652ec1c4bb1228fcf43e46424ebf41", "html_url": "https://github.com/Rust-GCC/gccrs/commit/bfd61955ce652ec1c4bb1228fcf43e46424ebf41"}], "stats": {"total": 39, "additions": 15, "deletions": 24}, "files": [{"sha": "f43d26aee0081bcf25b88584a7c01810292020eb", "filename": "gcc/fortran/ChangeLog", "status": "modified", "additions": 8, "deletions": 0, "changes": 8, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/f1607c0199cf4c62a27a73d580e5bc25eb46e6ef/gcc%2Ffortran%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/f1607c0199cf4c62a27a73d580e5bc25eb46e6ef/gcc%2Ffortran%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ffortran%2FChangeLog?ref=f1607c0199cf4c62a27a73d580e5bc25eb46e6ef", "patch": "@@ -1,3 +1,11 @@\n+2007-11-25  Jerry DeLisle  <jvdelisle@gcc.gnu.org>\n+\n+\tPR fortran/33152\n+\t* decl.c (add_init_expr_to_sym): Remove error message.\n+\t* resolve.c (check_data_variable): Add new check for a data variable\n+\tthat has an array spec, but no ref and issue an error.\n+\t* match.c (gfc_match_common): Remove error message.\n+\n 2007-11-25  Tobias Burnus  <burnus@net-b.de>\n \n \tPR fortran/34079"}, {"sha": "d607435668eda1c242cef7ceb09f1ade734538c5", "filename": "gcc/fortran/decl.c", "status": "modified", "additions": 0, "deletions": 9, "changes": 9, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/f1607c0199cf4c62a27a73d580e5bc25eb46e6ef/gcc%2Ffortran%2Fdecl.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/f1607c0199cf4c62a27a73d580e5bc25eb46e6ef/gcc%2Ffortran%2Fdecl.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ffortran%2Fdecl.c?ref=f1607c0199cf4c62a27a73d580e5bc25eb46e6ef", "patch": "@@ -1176,15 +1176,6 @@ add_init_expr_to_sym (const char *name, gfc_expr **initp, locus *var_locus)\n       return FAILURE;\n     }\n \n-  if (attr.in_common\n-      && !attr.data\n-      && *initp != NULL)\n-    {\n-      gfc_error (\"Initializer not allowed for COMMON variable '%s' at %C\",\n-\t\t sym->name);\n-      return FAILURE;\n-    }\n-\n   if (init == NULL)\n     {\n       /* An initializer is required for PARAMETER declarations.  */"}, {"sha": "f769651c7f945b803a5d1a1fceb027de3e76845e", "filename": "gcc/fortran/match.c", "status": "modified", "additions": 0, "deletions": 15, "changes": 15, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/f1607c0199cf4c62a27a73d580e5bc25eb46e6ef/gcc%2Ffortran%2Fmatch.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/f1607c0199cf4c62a27a73d580e5bc25eb46e6ef/gcc%2Ffortran%2Fmatch.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ffortran%2Fmatch.c?ref=f1607c0199cf4c62a27a73d580e5bc25eb46e6ef", "patch": "@@ -2783,21 +2783,6 @@ gfc_match_common (void)\n \t      goto cleanup;\n \t    }\n \n-\t  if (gfc_add_in_common (&sym->attr, sym->name, NULL) == FAILURE) \n-\t    goto cleanup;\n-\n-\t  if (sym->value != NULL && sym->value->expr_type != EXPR_NULL\n-\t      && (name[0] == '\\0' || !sym->attr.data))\n-\t    {\n-\t      if (name[0] == '\\0')\n-\t\tgfc_error (\"Previously initialized symbol '%s' in \"\n-\t\t\t   \"blank COMMON block at %C\", sym->name);\n-\t      else\n-\t\tgfc_error (\"Previously initialized symbol '%s' in \"\n-\t\t\t   \"COMMON block '%s' at %C\", sym->name, name);\n-\t      goto cleanup;\n-\t    }\n-\n \t  if (gfc_add_in_common (&sym->attr, sym->name, NULL) == FAILURE)\n \t    goto cleanup;\n "}, {"sha": "0fe5d32b6f995b86f2a9c82b0ba8e9f1b9eebbba", "filename": "gcc/fortran/resolve.c", "status": "modified", "additions": 7, "deletions": 0, "changes": 7, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/f1607c0199cf4c62a27a73d580e5bc25eb46e6ef/gcc%2Ffortran%2Fresolve.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/f1607c0199cf4c62a27a73d580e5bc25eb46e6ef/gcc%2Ffortran%2Fresolve.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ffortran%2Fresolve.c?ref=f1607c0199cf4c62a27a73d580e5bc25eb46e6ef", "patch": "@@ -8010,6 +8010,13 @@ check_data_variable (gfc_data_variable *var, locus *where)\n \t\t e->symtree->n.sym->name, &e->symtree->n.sym->declared_at);\n     }\n \n+  if (e->ref == NULL && e->symtree->n.sym->as)\n+    {\n+      gfc_error (\"DATA array '%s' at %L must be specified in a previous\"\n+\t\t \" declaration\", e->symtree->n.sym->name, where);\n+      return FAILURE;\n+    }\n+\n   if (e->rank == 0)\n     {\n       mpz_init_set_ui (size, 1);"}]}