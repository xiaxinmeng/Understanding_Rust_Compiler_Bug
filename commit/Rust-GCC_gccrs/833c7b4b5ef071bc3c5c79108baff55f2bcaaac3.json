{"sha": "833c7b4b5ef071bc3c5c79108baff55f2bcaaac3", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6ODMzYzdiNGI1ZWYwNzFiYzNjNWM3OTEwOGJhZmY1NWYyYmNhYWFjMw==", "commit": {"author": {"name": "Nathan Sidwell", "email": "nathan@acm.org", "date": "2020-05-13T20:11:36Z"}, "committer": {"name": "Nathan Sidwell", "email": "nathan@acm.org", "date": "2020-05-13T20:11:36Z"}, "message": "c++: Simplify canonical_type_parameter\n\nUse a single vec_safe_grow_cleared, rather than that or a vec_alloc.\nUse a for loop that returns early.\n\n\t* pt.c (canonical_type_parameter): Simplify.", "tree": {"sha": "0c49b9f6880d5b7422120645c1d2dd8e307bfab0", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/0c49b9f6880d5b7422120645c1d2dd8e307bfab0"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/833c7b4b5ef071bc3c5c79108baff55f2bcaaac3", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/833c7b4b5ef071bc3c5c79108baff55f2bcaaac3", "html_url": "https://github.com/Rust-GCC/gccrs/commit/833c7b4b5ef071bc3c5c79108baff55f2bcaaac3", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/833c7b4b5ef071bc3c5c79108baff55f2bcaaac3/comments", "author": {"login": "urnathan", "id": 13103001, "node_id": "MDQ6VXNlcjEzMTAzMDAx", "avatar_url": "https://avatars.githubusercontent.com/u/13103001?v=4", "gravatar_id": "", "url": "https://api.github.com/users/urnathan", "html_url": "https://github.com/urnathan", "followers_url": "https://api.github.com/users/urnathan/followers", "following_url": "https://api.github.com/users/urnathan/following{/other_user}", "gists_url": "https://api.github.com/users/urnathan/gists{/gist_id}", "starred_url": "https://api.github.com/users/urnathan/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/urnathan/subscriptions", "organizations_url": "https://api.github.com/users/urnathan/orgs", "repos_url": "https://api.github.com/users/urnathan/repos", "events_url": "https://api.github.com/users/urnathan/events{/privacy}", "received_events_url": "https://api.github.com/users/urnathan/received_events", "type": "User", "site_admin": false}, "committer": {"login": "urnathan", "id": 13103001, "node_id": "MDQ6VXNlcjEzMTAzMDAx", "avatar_url": "https://avatars.githubusercontent.com/u/13103001?v=4", "gravatar_id": "", "url": "https://api.github.com/users/urnathan", "html_url": "https://github.com/urnathan", "followers_url": "https://api.github.com/users/urnathan/followers", "following_url": "https://api.github.com/users/urnathan/following{/other_user}", "gists_url": "https://api.github.com/users/urnathan/gists{/gist_id}", "starred_url": "https://api.github.com/users/urnathan/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/urnathan/subscriptions", "organizations_url": "https://api.github.com/users/urnathan/orgs", "repos_url": "https://api.github.com/users/urnathan/repos", "events_url": "https://api.github.com/users/urnathan/events{/privacy}", "received_events_url": "https://api.github.com/users/urnathan/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "7e6a72cb2eba764e88fa8df1ae8b75827281c92b", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/7e6a72cb2eba764e88fa8df1ae8b75827281c92b", "html_url": "https://github.com/Rust-GCC/gccrs/commit/7e6a72cb2eba764e88fa8df1ae8b75827281c92b"}], "stats": {"total": 26, "additions": 10, "deletions": 16}, "files": [{"sha": "10f212f2e53a14db175233014770a6f35e8f8a2f", "filename": "gcc/cp/ChangeLog", "status": "modified", "additions": 2, "deletions": 0, "changes": 2, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/833c7b4b5ef071bc3c5c79108baff55f2bcaaac3/gcc%2Fcp%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/833c7b4b5ef071bc3c5c79108baff55f2bcaaac3/gcc%2Fcp%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fcp%2FChangeLog?ref=833c7b4b5ef071bc3c5c79108baff55f2bcaaac3", "patch": "@@ -1,5 +1,7 @@\n 2020-05-13  Nathan Sidwell  <nathan@acm.org>\n \n+\t* pt.c (canonical_type_parameter): Simplify.\n+\n \tFormatting fixups & some simplifications.\n \t* pt.c (spec_hash_table): New typedef.\n \t(decl_specializations, type_specializations): Use it."}, {"sha": "ec2ca3e19def7bc9e377e0a554ed9f6bff7b68c1", "filename": "gcc/cp/pt.c", "status": "modified", "additions": 8, "deletions": 16, "changes": 24, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/833c7b4b5ef071bc3c5c79108baff55f2bcaaac3/gcc%2Fcp%2Fpt.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/833c7b4b5ef071bc3c5c79108baff55f2bcaaac3/gcc%2Fcp%2Fpt.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fcp%2Fpt.c?ref=833c7b4b5ef071bc3c5c79108baff55f2bcaaac3", "patch": "@@ -4417,29 +4417,21 @@ build_template_parm_index (int index,\n static tree\n canonical_type_parameter (tree type)\n {\n-  tree list;\n   int idx = TEMPLATE_TYPE_IDX (type);\n \n   gcc_assert (TREE_CODE (type) != TEMPLATE_TEMPLATE_PARM);\n \n-  if (!canonical_template_parms)\n-    vec_alloc (canonical_template_parms, idx + 1);\n-\n-  if (canonical_template_parms->length () <= (unsigned) idx)\n+  if (vec_safe_length (canonical_template_parms) <= (unsigned) idx)\n     vec_safe_grow_cleared (canonical_template_parms, idx + 1);\n \n-  list = (*canonical_template_parms)[idx];\n-  while (list && !comptypes (type, TREE_VALUE (list), COMPARE_STRUCTURAL))\n-    list = TREE_CHAIN (list);\n+  for (tree list = (*canonical_template_parms)[idx];\n+       list; list = TREE_CHAIN (list))\n+    if (comptypes (type, TREE_VALUE (list), COMPARE_STRUCTURAL))\n+      return TREE_VALUE (list);\n \n-  if (list)\n-    return TREE_VALUE (list);\n-  else\n-    {\n-      (*canonical_template_parms)[idx]\n-\t= tree_cons (NULL_TREE, type, (*canonical_template_parms)[idx]);\n-      return type;\n-    }\n+  (*canonical_template_parms)[idx]\n+    = tree_cons (NULL_TREE, type, (*canonical_template_parms)[idx]);\n+  return type;\n }\n \n /* Return a TEMPLATE_PARM_INDEX, similar to INDEX, but whose"}]}