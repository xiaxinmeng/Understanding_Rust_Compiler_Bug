{"sha": "4b48a93e898353dc4bbe1bec80ec56736fc16beb", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6NGI0OGE5M2U4OTgzNTNkYzRiYmUxYmVjODBlYzU2NzM2ZmMxNmJlYg==", "commit": {"author": {"name": "Nathan Sidwell", "email": "nathan@codesourcery.com", "date": "2001-05-01T11:47:49Z"}, "committer": {"name": "Nathan Sidwell", "email": "nathan@gcc.gnu.org", "date": "2001-05-01T11:47:49Z"}, "message": "call.c (build_new_op): Convert args from reference here.\n\ncp:\n\t* call.c (build_new_op): Convert args from reference here.\n\t(build_conditional_expr): Don't convert here.\ntestsuite:\n\t* g++.old-deja/g++.pt/ref4.C: New test.\n\nFrom-SVN: r41721", "tree": {"sha": "29e5979336ab2d00b77103686f6ca6668cc06e01", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/29e5979336ab2d00b77103686f6ca6668cc06e01"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/4b48a93e898353dc4bbe1bec80ec56736fc16beb", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/4b48a93e898353dc4bbe1bec80ec56736fc16beb", "html_url": "https://github.com/Rust-GCC/gccrs/commit/4b48a93e898353dc4bbe1bec80ec56736fc16beb", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/4b48a93e898353dc4bbe1bec80ec56736fc16beb/comments", "author": null, "committer": null, "parents": [{"sha": "1bcea8d764215f8b04d69c5e8a991b715db54304", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/1bcea8d764215f8b04d69c5e8a991b715db54304", "html_url": "https://github.com/Rust-GCC/gccrs/commit/1bcea8d764215f8b04d69c5e8a991b715db54304"}], "stats": {"total": 45, "additions": 40, "deletions": 5}, "files": [{"sha": "b082ce289ac493c4680dc19ed042aac57584cee0", "filename": "gcc/cp/ChangeLog", "status": "modified", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/4b48a93e898353dc4bbe1bec80ec56736fc16beb/gcc%2Fcp%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/4b48a93e898353dc4bbe1bec80ec56736fc16beb/gcc%2Fcp%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fcp%2FChangeLog?ref=4b48a93e898353dc4bbe1bec80ec56736fc16beb", "patch": "@@ -1,3 +1,8 @@\n+2001-05-01  Nathan Sidwell  <nathan@codesourcery.com>\n+\n+\t* call.c (build_new_op): Convert args from reference here.\n+\t(build_conditional_expr): Don't convert here.\n+\n 2001-05-01  Nathan Sidwell  <nathan@codesourcery.com>\n \n \t* spew.c (last_token_id): New static variable."}, {"sha": "d2a1c95fbd8df4275164e4fd0cb6d4b938d43ec4", "filename": "gcc/cp/call.c", "status": "modified", "additions": 6, "deletions": 5, "changes": 11, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/4b48a93e898353dc4bbe1bec80ec56736fc16beb/gcc%2Fcp%2Fcall.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/4b48a93e898353dc4bbe1bec80ec56736fc16beb/gcc%2Fcp%2Fcall.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fcp%2Fcall.c?ref=4b48a93e898353dc4bbe1bec80ec56736fc16beb", "patch": "@@ -2892,11 +2892,6 @@ build_conditional_expr (arg1, arg2, arg3)\n       || TREE_TYPE (arg3) == error_mark_node)\n     return error_mark_node;\n \n-  /* Convert from reference types to ordinary types; no expressions\n-     really have reference type in C++.  */\n-  arg2 = convert_from_reference (arg2);\n-  arg3 = convert_from_reference (arg3);\n-     \n   /* [expr.cond]\n \n      If either the second or the third operand has type (possibly\n@@ -3244,6 +3239,12 @@ build_new_op (code, flags, arg1, arg2, arg3)\n   if (arg3 && TREE_CODE (arg3) == OFFSET_REF)\n     arg3 = resolve_offset_ref (arg3);\n \n+  arg1 = convert_from_reference (arg1);\n+  if (arg2)\n+    arg2 = convert_from_reference (arg2);\n+  if (arg3)\n+    arg3 = convert_from_reference (arg3);\n+  \n   if (code == COND_EXPR)\n     {\n       if (arg2 == NULL_TREE"}, {"sha": "12d5b6e4e215917150343cad8ef87f80f178b2a1", "filename": "gcc/testsuite/ChangeLog", "status": "modified", "additions": 4, "deletions": 0, "changes": 4, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/4b48a93e898353dc4bbe1bec80ec56736fc16beb/gcc%2Ftestsuite%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/4b48a93e898353dc4bbe1bec80ec56736fc16beb/gcc%2Ftestsuite%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2FChangeLog?ref=4b48a93e898353dc4bbe1bec80ec56736fc16beb", "patch": "@@ -1,3 +1,7 @@\n+2001-05-01  Nathan Sidwell  <nathan@codesourcery.com>\n+\n+\t* g++.old-deja/g++.pt/ref4.C: New test.\n+\n 2001-04-30  Richard Henderson  <rth@redhat.com>\n \n \t* gcc.dg/20000724-1.c: Revert last change."}, {"sha": "1291dc1ff2d7b28c8b3a4b0ca2c2ddeedaee8adc", "filename": "gcc/testsuite/g++.old-deja/g++.pt/ref4.C", "status": "added", "additions": 25, "deletions": 0, "changes": 25, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/4b48a93e898353dc4bbe1bec80ec56736fc16beb/gcc%2Ftestsuite%2Fg%2B%2B.old-deja%2Fg%2B%2B.pt%2Fref4.C", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/4b48a93e898353dc4bbe1bec80ec56736fc16beb/gcc%2Ftestsuite%2Fg%2B%2B.old-deja%2Fg%2B%2B.pt%2Fref4.C", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fg%2B%2B.old-deja%2Fg%2B%2B.pt%2Fref4.C?ref=4b48a93e898353dc4bbe1bec80ec56736fc16beb", "patch": "@@ -0,0 +1,25 @@\n+// Build don't link:\n+// \n+// Copyright (C) 2001 Free Software Foundation, Inc.\n+// Contributed by Nathan Sidwell 29 Apr 2001 <nathan@codesourcery.com>\n+\n+// Bug 2664. We failed to convert_from_reference for non-type\n+// template parms.\n+\n+struct cow { };\n+\n+cow c;\n+\n+void func     (cow &c) {}\n+void operator-(cow &c) {}\n+\n+template<cow &C> void test()\n+{\n+  func(C); //OK\n+  -C;      //bogus error\n+}\n+\n+int main()\n+{\n+  test<c> ();\n+}"}]}