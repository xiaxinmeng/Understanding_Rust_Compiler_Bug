{"sha": "96a8b7050beeb1a28d0e2c2a8d3e841ea38d450c", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6OTZhOGI3MDUwYmVlYjFhMjhkMGUyYzJhOGQzZTg0MWVhMzhkNDUwYw==", "commit": {"author": {"name": "Jerome Lambourg", "email": "lambourg@adacore.com", "date": "2019-08-12T08:59:08Z"}, "committer": {"name": "Pierre-Marie de Rodat", "email": "pmderodat@gcc.gnu.org", "date": "2019-08-12T08:59:08Z"}, "message": "[Ada] VxWorks: call s-tpopsp.Self only when needed\n\n2019-08-12  Jerome Lambourg  <lambourg@adacore.com>\n\ngcc/ada/\n\n\t* libgnarl/s-taprop__vxworks.adb (Abort_Handler): Only call\n\ts-tpopsp.Self when actually needed.\n\nFrom-SVN: r274283", "tree": {"sha": "f029116c9099d7dc410720720c4dc94a1ebeb815", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/f029116c9099d7dc410720720c4dc94a1ebeb815"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/96a8b7050beeb1a28d0e2c2a8d3e841ea38d450c", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/96a8b7050beeb1a28d0e2c2a8d3e841ea38d450c", "html_url": "https://github.com/Rust-GCC/gccrs/commit/96a8b7050beeb1a28d0e2c2a8d3e841ea38d450c", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/96a8b7050beeb1a28d0e2c2a8d3e841ea38d450c/comments", "author": {"login": "lambourg", "id": 480233, "node_id": "MDQ6VXNlcjQ4MDIzMw==", "avatar_url": "https://avatars.githubusercontent.com/u/480233?v=4", "gravatar_id": "", "url": "https://api.github.com/users/lambourg", "html_url": "https://github.com/lambourg", "followers_url": "https://api.github.com/users/lambourg/followers", "following_url": "https://api.github.com/users/lambourg/following{/other_user}", "gists_url": "https://api.github.com/users/lambourg/gists{/gist_id}", "starred_url": "https://api.github.com/users/lambourg/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/lambourg/subscriptions", "organizations_url": "https://api.github.com/users/lambourg/orgs", "repos_url": "https://api.github.com/users/lambourg/repos", "events_url": "https://api.github.com/users/lambourg/events{/privacy}", "received_events_url": "https://api.github.com/users/lambourg/received_events", "type": "User", "site_admin": false}, "committer": null, "parents": [{"sha": "43eb2bb6967ffd6d9b9fadfa606c177671c28261", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/43eb2bb6967ffd6d9b9fadfa606c177671c28261", "html_url": "https://github.com/Rust-GCC/gccrs/commit/43eb2bb6967ffd6d9b9fadfa606c177671c28261"}], "stats": {"total": 12, "additions": 11, "deletions": 1}, "files": [{"sha": "b656a026a043879c20012385b5723a82fe6d664e", "filename": "gcc/ada/ChangeLog", "status": "modified", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/96a8b7050beeb1a28d0e2c2a8d3e841ea38d450c/gcc%2Fada%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/96a8b7050beeb1a28d0e2c2a8d3e841ea38d450c/gcc%2Fada%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fada%2FChangeLog?ref=96a8b7050beeb1a28d0e2c2a8d3e841ea38d450c", "patch": "@@ -1,3 +1,8 @@\n+2019-08-12  Jerome Lambourg  <lambourg@adacore.com>\n+\n+\t* libgnarl/s-taprop__vxworks.adb (Abort_Handler): Only call\n+\ts-tpopsp.Self when actually needed.\n+\n 2019-08-12  Eric Botcazou  <ebotcazou@adacore.com>\n \n \t* exp_ch4.adb (Discrete_Range_Check): Return if checks are"}, {"sha": "6ef0a9b4bcf3816044adab8ce9917f616de5f453", "filename": "gcc/ada/libgnarl/s-taprop__vxworks.adb", "status": "modified", "additions": 6, "deletions": 1, "changes": 7, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/96a8b7050beeb1a28d0e2c2a8d3e841ea38d450c/gcc%2Fada%2Flibgnarl%2Fs-taprop__vxworks.adb", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/96a8b7050beeb1a28d0e2c2a8d3e841ea38d450c/gcc%2Fada%2Flibgnarl%2Fs-taprop__vxworks.adb", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fada%2Flibgnarl%2Fs-taprop__vxworks.adb?ref=96a8b7050beeb1a28d0e2c2a8d3e841ea38d450c", "patch": "@@ -192,7 +192,10 @@ package body System.Task_Primitives.Operations is\n    procedure Abort_Handler (signo : Signal) is\n       pragma Unreferenced (signo);\n \n-      Self_ID        : constant Task_Id := Self;\n+      --  Do not call Self at this point as we're in a signal handler\n+      --  and it may not be available, in particular on targets where we\n+      --  support ZCX and where we don't do anything here anyway.\n+      Self_ID        : Task_Id;\n       Old_Set        : aliased sigset_t;\n       Unblocked_Mask : aliased sigset_t;\n       Result         : int;\n@@ -208,6 +211,8 @@ package body System.Task_Primitives.Operations is\n          return;\n       end if;\n \n+      Self_ID := Self;\n+\n       if Self_ID.Deferral_Level = 0\n         and then Self_ID.Pending_ATC_Level < Self_ID.ATC_Nesting_Level\n         and then not Self_ID.Aborting"}]}