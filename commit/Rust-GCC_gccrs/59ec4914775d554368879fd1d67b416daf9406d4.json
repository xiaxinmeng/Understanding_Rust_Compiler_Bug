{"sha": "59ec4914775d554368879fd1d67b416daf9406d4", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6NTllYzQ5MTQ3NzVkNTU0MzY4ODc5ZmQxZDY3YjQxNmRhZjk0MDZkNA==", "commit": {"author": {"name": "Paolo Carlini", "email": "paolo.carlini@oracle.com", "date": "2019-01-16T16:16:54Z"}, "committer": {"name": "Paolo Carlini", "email": "paolo@gcc.gnu.org", "date": "2019-01-16T16:16:54Z"}, "message": "decl.c (grokdeclarator): Use locations[ds_storage_class] in error messages about ill-formed uses of mutable.\n\n/cp\n2019-01-16  Paolo Carlini  <paolo.carlini@oracle.com>\n\n\t* decl.c (grokdeclarator): Use locations[ds_storage_class] in\n\terror messages about ill-formed uses of mutable.\n\n/testsuite\n2019-01-16  Paolo Carlini  <paolo.carlini@oracle.com>\n\n\t* g++.dg/other/pr33558.C: Test location too.\n\t* g++.dg/other/pr33558-2.C: Likewise.\n\t* g++.dg/parse/crash4.C: Likewise.\n\t* g++.old-deja/g++.brendan/err-msg11.C: Likewise.\n\t* g++.old-deja/g++.mike/p7635.C: Likewise.\n\t* g++.old-deja/g++.other/decl6.C: Likewise.\n\nFrom-SVN: r267978", "tree": {"sha": "1d9d4e2d4eb41935df02b412718cc62e7355e86e", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/1d9d4e2d4eb41935df02b412718cc62e7355e86e"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/59ec4914775d554368879fd1d67b416daf9406d4", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/59ec4914775d554368879fd1d67b416daf9406d4", "html_url": "https://github.com/Rust-GCC/gccrs/commit/59ec4914775d554368879fd1d67b416daf9406d4", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/59ec4914775d554368879fd1d67b416daf9406d4/comments", "author": null, "committer": null, "parents": [{"sha": "2ea2a74dceda4b4ddf7433f2c1d9ab72aa2bd0b0", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/2ea2a74dceda4b4ddf7433f2c1d9ab72aa2bd0b0", "html_url": "https://github.com/Rust-GCC/gccrs/commit/2ea2a74dceda4b4ddf7433f2c1d9ab72aa2bd0b0"}], "stats": {"total": 57, "additions": 39, "deletions": 18}, "files": [{"sha": "50f00f2e4c4721c74460261dc95285fb27c2e067", "filename": "gcc/cp/ChangeLog", "status": "modified", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/59ec4914775d554368879fd1d67b416daf9406d4/gcc%2Fcp%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/59ec4914775d554368879fd1d67b416daf9406d4/gcc%2Fcp%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fcp%2FChangeLog?ref=59ec4914775d554368879fd1d67b416daf9406d4", "patch": "@@ -1,3 +1,8 @@\n+2019-01-16  Paolo Carlini  <paolo.carlini@oracle.com>\n+\n+\t* decl.c (grokdeclarator): Use locations[ds_storage_class] in\n+\terror messages about ill-formed uses of mutable.\n+\n 2019-01-16  Marek Polacek  <polacek@redhat.com>\n \n \tPR c++/78244 - narrowing conversion in template not detected."}, {"sha": "9f96ebc19efe36a8f5e9c5de8c2aaa0178bb7e90", "filename": "gcc/cp/decl.c", "status": "modified", "additions": 14, "deletions": 7, "changes": 21, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/59ec4914775d554368879fd1d67b416daf9406d4/gcc%2Fcp%2Fdecl.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/59ec4914775d554368879fd1d67b416daf9406d4/gcc%2Fcp%2Fdecl.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fcp%2Fdecl.c?ref=59ec4914775d554368879fd1d67b416daf9406d4", "patch": "@@ -11902,36 +11902,43 @@ grokdeclarator (const cp_declarator *declarator,\n \n   if (storage_class == sc_mutable)\n     {\n+      location_t sloc = declspecs->locations[ds_storage_class];\n       if (decl_context != FIELD || friendp)\n \t{\n-\t  error (\"non-member %qs cannot be declared %<mutable%>\", name);\n+\t  error_at (sloc, \"non-member %qs cannot be declared %<mutable%>\",\n+\t\t    name);\n \t  storage_class = sc_none;\n \t}\n       else if (decl_context == TYPENAME || typedef_p)\n \t{\n-\t  error (\"non-object member %qs cannot be declared %<mutable%>\", name);\n+\t  error_at (sloc,\n+\t\t    \"non-object member %qs cannot be declared %<mutable%>\",\n+\t\t    name);\n \t  storage_class = sc_none;\n \t}\n       else if (TREE_CODE (type) == FUNCTION_TYPE\n \t       || TREE_CODE (type) == METHOD_TYPE)\n \t{\n-\t  error (\"function %qs cannot be declared %<mutable%>\", name);\n+\t  error_at (sloc, \"function %qs cannot be declared %<mutable%>\",\n+\t\t    name);\n \t  storage_class = sc_none;\n \t}\n       else if (staticp)\n \t{\n-\t  error (\"static %qs cannot be declared %<mutable%>\", name);\n+\t  error_at (sloc, \"%<static%> %qs cannot be declared %<mutable%>\",\n+\t\t    name);\n \t  storage_class = sc_none;\n \t}\n       else if (type_quals & TYPE_QUAL_CONST)\n \t{\n-\t  error (\"const %qs cannot be declared %<mutable%>\", name);\n+\t  error_at (sloc, \"%<const%> %qs cannot be declared %<mutable%>\",\n+\t\t    name);\n \t  storage_class = sc_none;\n \t}\n       else if (TYPE_REF_P (type))\n \t{\n-\t  permerror (input_location, \"reference %qs cannot be declared \"\n-\t             \"%<mutable%>\", name);\n+\t  permerror (sloc, \"reference %qs cannot be declared %<mutable%>\",\n+\t\t     name);\n \t  storage_class = sc_none;\n \t}\n     }"}, {"sha": "6c11b84797eee9de3b1042923ec4910bd96f4ec3", "filename": "gcc/testsuite/ChangeLog", "status": "modified", "additions": 9, "deletions": 0, "changes": 9, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/59ec4914775d554368879fd1d67b416daf9406d4/gcc%2Ftestsuite%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/59ec4914775d554368879fd1d67b416daf9406d4/gcc%2Ftestsuite%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2FChangeLog?ref=59ec4914775d554368879fd1d67b416daf9406d4", "patch": "@@ -1,3 +1,12 @@\n+2019-01-16  Paolo Carlini  <paolo.carlini@oracle.com>\n+\n+\t* g++.dg/other/pr33558.C: Test location too.\n+\t* g++.dg/other/pr33558-2.C: Likewise.\n+\t* g++.dg/parse/crash4.C: Likewise.\n+\t* g++.old-deja/g++.brendan/err-msg11.C: Likewise.\n+\t* g++.old-deja/g++.mike/p7635.C: Likewise.\n+\t* g++.old-deja/g++.other/decl6.C: Likewise.\n+\n 2019-01-16  Marek Polacek  <polacek@redhat.com>\n \n \tPR c++/78244 - narrowing conversion in template not detected."}, {"sha": "4b53977407416541795494061f9f93a32bf61f1f", "filename": "gcc/testsuite/g++.dg/other/pr33558-2.C", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/59ec4914775d554368879fd1d67b416daf9406d4/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Fother%2Fpr33558-2.C", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/59ec4914775d554368879fd1d67b416daf9406d4/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Fother%2Fpr33558-2.C", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Fother%2Fpr33558-2.C?ref=59ec4914775d554368879fd1d67b416daf9406d4", "patch": "@@ -2,5 +2,5 @@\n /* { dg-options \"-fpermissive\" } */\n \n class X {\n-  mutable int &q; /* { dg-warning \"cannot be declared 'mutable'\" } */\n+  mutable int &q; /* { dg-warning \"3:reference .q. cannot be declared .mutable.\" } */\n };"}, {"sha": "2372a5cb0fd64f3769b885e0a8bb75c1d2e1e88b", "filename": "gcc/testsuite/g++.dg/other/pr33558.C", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/59ec4914775d554368879fd1d67b416daf9406d4/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Fother%2Fpr33558.C", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/59ec4914775d554368879fd1d67b416daf9406d4/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Fother%2Fpr33558.C", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Fother%2Fpr33558.C?ref=59ec4914775d554368879fd1d67b416daf9406d4", "patch": "@@ -1,5 +1,5 @@\n /* { dg-do compile } */\n \n class X {\n-  mutable int &q; /* { dg-error \"cannot be declared 'mutable'\" } */\n+  mutable int &q; /* { dg-error \"3:reference .q. cannot be declared .mutable.\" } */\n };"}, {"sha": "e5e95800c803676d50689b7b5919ea91e9a06e11", "filename": "gcc/testsuite/g++.dg/parse/crash4.C", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/59ec4914775d554368879fd1d67b416daf9406d4/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Fparse%2Fcrash4.C", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/59ec4914775d554368879fd1d67b416daf9406d4/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Fparse%2Fcrash4.C", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Fparse%2Fcrash4.C?ref=59ec4914775d554368879fd1d67b416daf9406d4", "patch": "@@ -7,6 +7,6 @@ struct Bar\n  {\n      void func(void)\n      {\n-       mutable Bar::type x; // { dg-error \"\" }\n+       mutable Bar::type x; // { dg-error \"8:non-member .x. cannot be declared .mutable.\" }\n      }\n  };"}, {"sha": "3a405e8ea247954dddeade05935f787408bccd32", "filename": "gcc/testsuite/g++.old-deja/g++.brendan/err-msg11.C", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/59ec4914775d554368879fd1d67b416daf9406d4/gcc%2Ftestsuite%2Fg%2B%2B.old-deja%2Fg%2B%2B.brendan%2Ferr-msg11.C", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/59ec4914775d554368879fd1d67b416daf9406d4/gcc%2Ftestsuite%2Fg%2B%2B.old-deja%2Fg%2B%2B.brendan%2Ferr-msg11.C", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fg%2B%2B.old-deja%2Fg%2B%2B.brendan%2Ferr-msg11.C?ref=59ec4914775d554368879fd1d67b416daf9406d4", "patch": "@@ -1,3 +1,3 @@\n // { dg-do assemble  }\n // GROUPS passed error-messages\n-void foo (mutable int x);// { dg-error \"\" }  non-member `x' cannot be declared `mutable'.*\n+void foo (mutable int x);// { dg-error \"11:non-member .x. cannot be declared .mutable.\" }  non-member `x' cannot be declared `mutable'.*"}, {"sha": "db7c56661c12ea929423205dd734d2ec6e1fdb1e", "filename": "gcc/testsuite/g++.old-deja/g++.mike/p7635.C", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/59ec4914775d554368879fd1d67b416daf9406d4/gcc%2Ftestsuite%2Fg%2B%2B.old-deja%2Fg%2B%2B.mike%2Fp7635.C", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/59ec4914775d554368879fd1d67b416daf9406d4/gcc%2Ftestsuite%2Fg%2B%2B.old-deja%2Fg%2B%2B.mike%2Fp7635.C", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fg%2B%2B.old-deja%2Fg%2B%2B.mike%2Fp7635.C?ref=59ec4914775d554368879fd1d67b416daf9406d4", "patch": "@@ -3,5 +3,5 @@\n \n class DaycountBasis {\n   mutable const int * p;\n-  mutable int * const q;\t// { dg-error \"\" } \n+  mutable int * const q;\t// { dg-error \"3:.const. .q. cannot be declared .mutable.\" } \n };"}, {"sha": "60edc54c564f18455f30790385301a9bdf9c6a07", "filename": "gcc/testsuite/g++.old-deja/g++.other/decl6.C", "status": "modified", "additions": 6, "deletions": 6, "changes": 12, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/59ec4914775d554368879fd1d67b416daf9406d4/gcc%2Ftestsuite%2Fg%2B%2B.old-deja%2Fg%2B%2B.other%2Fdecl6.C", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/59ec4914775d554368879fd1d67b416daf9406d4/gcc%2Ftestsuite%2Fg%2B%2B.old-deja%2Fg%2B%2B.other%2Fdecl6.C", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fg%2B%2B.old-deja%2Fg%2B%2B.other%2Fdecl6.C?ref=59ec4914775d554368879fd1d67b416daf9406d4", "patch": "@@ -11,16 +11,16 @@ struct A\n   friend explicit B::B ();    // { dg-error \"\" } only ctor decls can be explicit\n   int f(const);               // { dg-error \"\" } ansi forbids no type\n   const k;                    // { dg-error \"\" } ansi forbids no type\n-  mutable friend int j1 ();   // { dg-error \"\" } non-member cannot be mutable\n+  mutable friend int j1 ();   // { dg-error \"3:storage class specifiers\" } non-member cannot be mutable\n   mutable typedef int d;      // { dg-error \"\" } non-object cannot be mutable\n-  mutable int fn ();          // { dg-error \"\" } non-object cannot be mutable\n-  void fn (mutable int);      // { dg-error \"\" } non-member cannot be mutable\n+  mutable int fn ();          // { dg-error \"3:function .fn. cannot be declared .mutable.\" } non-object cannot be mutable\n+  void fn (mutable int);      // { dg-error \"12:non-member .parameter. cannot be declared .mutable.\" } non-member cannot be mutable\n   mutable static int s;       // { dg-error \"\" } static cannot be mutable\n-  mutable const int s1;       // { dg-error \"\" } const cannot be mutable\n+  mutable const int s1;       // { dg-error \"3:.const. .s1. cannot be declared .mutable.\" } const cannot be mutable\n   mutable const int *s2;      // ok\n-  mutable int *const s3;      // { dg-error \"\" } const cannot be mutable\n+  mutable int *const s3;      // { dg-error \"3:.const. .s3. cannot be declared .mutable.\" } const cannot be mutable\n   explicit A ();              // ok\n };\n-mutable int g;                // { dg-error \"\" } non-member cannot be mutable\n+mutable int g;                // { dg-error \"1:non-member .g. cannot be declared .mutable.\" } non-member cannot be mutable\n explicit A::A () {}           // { dg-error \"\" } only ctor decls can be explicit\n "}]}