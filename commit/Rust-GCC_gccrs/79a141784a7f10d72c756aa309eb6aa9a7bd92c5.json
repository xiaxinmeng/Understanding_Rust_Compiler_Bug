{"sha": "79a141784a7f10d72c756aa309eb6aa9a7bd92c5", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6NzlhMTQxNzg0YTdmMTBkNzJjNzU2YWEzMDllYjZhYTlhN2JkOTJjNQ==", "commit": {"author": {"name": "Samuel Tardieu", "email": "sam@gcc.gnu.org", "date": "2008-08-18T09:09:24Z"}, "committer": {"name": "Samuel Tardieu", "email": "sam@gcc.gnu.org", "date": "2008-08-18T09:09:24Z"}, "message": "[multiple changes]\n\n2008-08-18  Samuel Tardieu  <sam@rfc1149.net>\n            Robert Dewar  <dewar@adacore.com>\n    gcc/ada/\n\tPR ada/30827\n\t* bindgen.adb (Gen_Output_File_Ada): Zero-terminate the\n\tversion string.\n\tMove comment in the right place.\n\t* g-comver.adb (Version): Look for a zero-termination in\n\taddition to a closing parenthesis.\n\n2008-08-18  Robert Dewar  <dewar@adacore.com>\n    gcc/testsuite/\n\tPR ada/30827\n\t* gnat.dg/test_version.adb: New.\n\nFrom-SVN: r139192", "tree": {"sha": "9fd7f8fc350d3f496ce85d9a1b51f0d288a4d846", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/9fd7f8fc350d3f496ce85d9a1b51f0d288a4d846"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/79a141784a7f10d72c756aa309eb6aa9a7bd92c5", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/79a141784a7f10d72c756aa309eb6aa9a7bd92c5", "html_url": "https://github.com/Rust-GCC/gccrs/commit/79a141784a7f10d72c756aa309eb6aa9a7bd92c5", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/79a141784a7f10d72c756aa309eb6aa9a7bd92c5/comments", "author": null, "committer": null, "parents": [{"sha": "b9b2405ff39ccd696dd1ff825bf81c367a63d3fa", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/b9b2405ff39ccd696dd1ff825bf81c367a63d3fa", "html_url": "https://github.com/Rust-GCC/gccrs/commit/b9b2405ff39ccd696dd1ff825bf81c367a63d3fa"}], "stats": {"total": 49, "additions": 41, "deletions": 8}, "files": [{"sha": "21e3e269a40bd9f3aec31b85a96126fcf8f77594", "filename": "gcc/ada/ChangeLog", "status": "modified", "additions": 10, "deletions": 0, "changes": 10, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/79a141784a7f10d72c756aa309eb6aa9a7bd92c5/gcc%2Fada%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/79a141784a7f10d72c756aa309eb6aa9a7bd92c5/gcc%2Fada%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fada%2FChangeLog?ref=79a141784a7f10d72c756aa309eb6aa9a7bd92c5", "patch": "@@ -1,3 +1,13 @@\n+2008-08-18  Samuel Tardieu  <sam@rfc1149.net>\n+            Robert Dewar  <dewar@adacore.com>\n+\n+\tPR ada/30827\n+\t* bindgen.adb (Gen_Output_File_Ada): Zero-terminate the\n+\tversion string.\n+\tMove comment in the right place.\n+\t* g-comver.adb (Version): Look for a zero-termination in\n+\taddition to a closing parenthesis.\n+\n 2008-08-18  Samuel Tardieu  <sam@rfc1149.net>\n \n \t* exp_ch13.adb, exp_disp.adb, sem_cat.adb, sem_ch10.adb,"}, {"sha": "ccdf3948cb288837aeea927a0ef69a94103ef796", "filename": "gcc/ada/bindgen.adb", "status": "modified", "additions": 8, "deletions": 6, "changes": 14, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/79a141784a7f10d72c756aa309eb6aa9a7bd92c5/gcc%2Fada%2Fbindgen.adb", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/79a141784a7f10d72c756aa309eb6aa9a7bd92c5/gcc%2Fada%2Fbindgen.adb", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fada%2Fbindgen.adb?ref=79a141784a7f10d72c756aa309eb6aa9a7bd92c5", "patch": "@@ -2267,17 +2267,19 @@ package body Bindgen is\n                WBI (\"   gnat_exit_status : Integer;\");\n                WBI (\"   pragma Import (C, gnat_exit_status);\");\n             end if;\n-\n-            --  Generate the GNAT_Version and Ada_Main_Program_Name info only\n-            --  for the main program. Otherwise, it can lead under some\n-            --  circumstances to a symbol duplication during the link (for\n-            --  instance when a C program uses 2 Ada libraries)\n          end if;\n \n+         --  Generate the GNAT_Version and Ada_Main_Program_Name info only for\n+         --  the main program. Otherwise, it can lead under some circumstances\n+         --  to a symbol duplication during the link (for instance when a C\n+         --  program uses two Ada libraries). Also zero terminate the string\n+         --  so that its end can be found reliably at run time.\n+\n          WBI (\"\");\n          WBI (\"   GNAT_Version : constant String :=\");\n          WBI (\"                    \"\"GNAT Version: \" &\n-                                Gnat_Version_String & \"\"\";\");\n+                                   Gnat_Version_String &\n+                                   \"\"\" & ASCII.NUL;\");\n          WBI (\"   pragma Export (C, GNAT_Version, \"\"__gnat_version\"\");\");\n \n          WBI (\"\");"}, {"sha": "ae3bf3bf66cb37b28dd93073e7eb99ffa7523b1d", "filename": "gcc/ada/g-comver.adb", "status": "modified", "additions": 5, "deletions": 2, "changes": 7, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/79a141784a7f10d72c756aa309eb6aa9a7bd92c5/gcc%2Fada%2Fg-comver.adb", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/79a141784a7f10d72c756aa309eb6aa9a7bd92c5/gcc%2Fada%2Fg-comver.adb", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fada%2Fg-comver.adb?ref=79a141784a7f10d72c756aa309eb6aa9a7bd92c5", "patch": "@@ -53,15 +53,18 @@ package body GNAT.Compiler_Version is\n \n    function Version return String is\n    begin\n-      --  Search for terminating right paren\n+      --  Search for terminating right paren or NUL ending the string\n \n       for J in Ver_Prefix'Length + 1 .. GNAT_Version'Last loop\n          if GNAT_Version (J) = ')' then\n             return GNAT_Version (Ver_Prefix'Length + 1 .. J);\n          end if;\n+         if GNAT_Version (J) = Character'Val (0) then\n+            return GNAT_Version (Ver_Prefix'Length + 1 .. J - 1);\n+         end if;\n       end loop;\n \n-      --  This should not happen (no right paren found)\n+      --  This should not happen (no right paren or NUL found)\n \n       return GNAT_Version;\n    end Version;"}, {"sha": "56cd326d7d06e2ca7446a04f96e8597526745105", "filename": "gcc/testsuite/ChangeLog", "status": "modified", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/79a141784a7f10d72c756aa309eb6aa9a7bd92c5/gcc%2Ftestsuite%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/79a141784a7f10d72c756aa309eb6aa9a7bd92c5/gcc%2Ftestsuite%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2FChangeLog?ref=79a141784a7f10d72c756aa309eb6aa9a7bd92c5", "patch": "@@ -1,3 +1,8 @@\n+2008-08-18  Robert Dewar  <dewar@adacore.com>\n+\n+\tPR ada/30827\n+\t* gnat.dg/test_version.adb: New.\n+\n 2008-08-18  Samuel Tardieu  <sam@rfc1149.net>\n \n \tPR ada/15808"}, {"sha": "d7fa2976c56bc0ecaf3686eec16fd256b1faf0df", "filename": "gcc/testsuite/gnat.dg/test_version.adb", "status": "added", "additions": 13, "deletions": 0, "changes": 13, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/79a141784a7f10d72c756aa309eb6aa9a7bd92c5/gcc%2Ftestsuite%2Fgnat.dg%2Ftest_version.adb", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/79a141784a7f10d72c756aa309eb6aa9a7bd92c5/gcc%2Ftestsuite%2Fgnat.dg%2Ftest_version.adb", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgnat.dg%2Ftest_version.adb?ref=79a141784a7f10d72c756aa309eb6aa9a7bd92c5", "patch": "@@ -0,0 +1,13 @@\n+-- { dg-do run }\n+with GNAT.Compiler_Version;\n+procedure Test_Version is\n+   package Vsn is new GNAT.Compiler_Version;\n+   use Vsn;\n+   X : constant String := Version;\n+begin\n+   if X'Length = 46 then\n+      -- 46 = Ver_Len_Max + Ver_Prefix\n+      -- actual version should be shorter than this\n+      raise Program_Error;\n+   end if;\n+end Test_Version;"}]}