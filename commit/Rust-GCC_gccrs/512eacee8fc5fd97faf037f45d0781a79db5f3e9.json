{"sha": "512eacee8fc5fd97faf037f45d0781a79db5f3e9", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6NTEyZWFjZWU4ZmM1ZmQ5N2ZhZjAzN2Y0NWQwNzgxYTc5ZGI1ZjNlOQ==", "commit": {"author": {"name": "Paolo Carlini", "email": "paolo.carlini@oracle.com", "date": "2014-05-20T15:16:48Z"}, "committer": {"name": "Paolo Carlini", "email": "paolo@gcc.gnu.org", "date": "2014-05-20T15:16:48Z"}, "message": "re PR c++/60373 (half warning: visibility attribute ignored because it)\n\n/cp\n2014-05-20  Paolo Carlini  <paolo.carlini@oracle.com>\n\n\tPR c++/60373\n\t* decl.c (duplicate_decls): Replace pair of warning_at with\n\twarning_at + inform.\n\t(maybe_commonize_var): Likewise.\n\n/testsuite\n2014-05-20  Paolo Carlini  <paolo.carlini@oracle.com>\n\n\tPR c++/60373\n\t* g++.dg/cpp0x/Wattributes1.C: New.\n\t* g++.dg/ext/visibility/redecl1.C: Adjust.\n\t* g++.dg/ext/visibility/visibility-7.C: Likewise.\n\nFrom-SVN: r210646", "tree": {"sha": "6b70500cb62c5ae23398ffff2782c8616c885cb7", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/6b70500cb62c5ae23398ffff2782c8616c885cb7"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/512eacee8fc5fd97faf037f45d0781a79db5f3e9", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/512eacee8fc5fd97faf037f45d0781a79db5f3e9", "html_url": "https://github.com/Rust-GCC/gccrs/commit/512eacee8fc5fd97faf037f45d0781a79db5f3e9", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/512eacee8fc5fd97faf037f45d0781a79db5f3e9/comments", "author": null, "committer": null, "parents": [{"sha": "efa72acd629c32e663a54cc1ddfb64742dbe41fd", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/efa72acd629c32e663a54cc1ddfb64742dbe41fd", "html_url": "https://github.com/Rust-GCC/gccrs/commit/efa72acd629c32e663a54cc1ddfb64742dbe41fd"}], "stats": {"total": 48, "additions": 35, "deletions": 13}, "files": [{"sha": "b6d945ff53d126adb66507138fd8ab9377e5ae9a", "filename": "gcc/cp/ChangeLog", "status": "modified", "additions": 7, "deletions": 0, "changes": 7, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/512eacee8fc5fd97faf037f45d0781a79db5f3e9/gcc%2Fcp%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/512eacee8fc5fd97faf037f45d0781a79db5f3e9/gcc%2Fcp%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fcp%2FChangeLog?ref=512eacee8fc5fd97faf037f45d0781a79db5f3e9", "patch": "@@ -1,3 +1,10 @@\n+2014-05-20  Paolo Carlini  <paolo.carlini@oracle.com>\n+\n+\tPR c++/60373\n+\t* decl.c (duplicate_decls): Replace pair of warning_at with\n+\twarning_at + inform.\n+\t(maybe_commonize_var): Likewise.\n+\n 2014-05-20  Richard Sandiford  <rsandifo@linux.vnet.ibm.com>\n \n \tPR bootstrap/61210"}, {"sha": "ab91928cf4294cb52ba5f7ba34b52a84d7d024a6", "filename": "gcc/cp/decl.c", "status": "modified", "additions": 11, "deletions": 11, "changes": 22, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/512eacee8fc5fd97faf037f45d0781a79db5f3e9/gcc%2Fcp%2Fdecl.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/512eacee8fc5fd97faf037f45d0781a79db5f3e9/gcc%2Fcp%2Fdecl.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fcp%2Fdecl.c?ref=512eacee8fc5fd97faf037f45d0781a79db5f3e9", "patch": "@@ -2306,10 +2306,11 @@ duplicate_decls (tree newdecl, tree olddecl, bool newdecl_is_friend)\n       && DECL_VISIBILITY_SPECIFIED (newdecl)\n       && DECL_VISIBILITY (newdecl) != DECL_VISIBILITY (olddecl))\n     {\n-      warning_at (input_location, OPT_Wattributes,\n-\t\t  \"%q+D: visibility attribute ignored because it\", newdecl);\n-      warning_at (DECL_SOURCE_LOCATION (olddecl), OPT_Wattributes,\n-\t\t  \"conflicts with previous declaration here\");\n+      if (warning_at (DECL_SOURCE_LOCATION (newdecl), OPT_Wattributes,\n+\t\t      \"%qD: visibility attribute ignored because it \"\n+\t\t      \"conflicts with previous declaration\", newdecl))\n+\tinform (DECL_SOURCE_LOCATION (olddecl),\n+\t\t\"previous declaration of %qD\", olddecl);\n     }\n   /* Choose the declaration which specified visibility.  */\n   if (DECL_VISIBILITY_SPECIFIED (olddecl))\n@@ -5026,13 +5027,12 @@ maybe_commonize_var (tree decl)\n \t\t be merged.  */\n \t      TREE_PUBLIC (decl) = 0;\n \t      DECL_COMMON (decl) = 0;\n-\t      warning_at (input_location, 0,\n-\t\t\t  \"sorry: semantics of inline function static \"\n-\t\t\t  \"data %q+#D are wrong (you%'ll wind up \"\n-\t\t\t  \"with multiple copies)\", decl);\n-\t      warning_at (DECL_SOURCE_LOCATION (decl), 0, \n-\t\t\t  \"  you can work around this by removing \"\n-\t\t\t  \"the initializer\");\n+\t      if (warning_at (DECL_SOURCE_LOCATION (decl), 0,\n+\t\t\t      \"sorry: semantics of inline function static \"\n+\t\t\t      \"data %q#D are wrong (you%'ll wind up \"\n+\t\t\t      \"with multiple copies)\", decl))\n+\t\tinform (DECL_SOURCE_LOCATION (decl),\n+\t\t\t\"you can work around this by removing the initializer\");\n \t    }\n \t}\n     }"}, {"sha": "be9a7def5c4c1141d20e28e5c95370c081623e0a", "filename": "gcc/testsuite/ChangeLog", "status": "modified", "additions": 7, "deletions": 0, "changes": 7, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/512eacee8fc5fd97faf037f45d0781a79db5f3e9/gcc%2Ftestsuite%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/512eacee8fc5fd97faf037f45d0781a79db5f3e9/gcc%2Ftestsuite%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2FChangeLog?ref=512eacee8fc5fd97faf037f45d0781a79db5f3e9", "patch": "@@ -1,3 +1,10 @@\n+2014-05-20  Paolo Carlini  <paolo.carlini@oracle.com>\n+\n+\tPR c++/60373\n+\t* g++.dg/cpp0x/Wattributes1.C: New.\n+\t* g++.dg/ext/visibility/redecl1.C: Adjust.\n+\t* g++.dg/ext/visibility/visibility-7.C: Likewise.\n+\n 2014-05-20  Bill Schmidt  <wschmidt@linux.vnet.ibm.com>\n \n \t* gcc.target/powerpc/vsxcopy.c: New test."}, {"sha": "4d3c29ce3f150ae74d6ae07c6cca493c9dbee2d4", "filename": "gcc/testsuite/g++.dg/cpp0x/Wattributes1.C", "status": "added", "additions": 8, "deletions": 0, "changes": 8, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/512eacee8fc5fd97faf037f45d0781a79db5f3e9/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Fcpp0x%2FWattributes1.C", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/512eacee8fc5fd97faf037f45d0781a79db5f3e9/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Fcpp0x%2FWattributes1.C", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Fcpp0x%2FWattributes1.C?ref=512eacee8fc5fd97faf037f45d0781a79db5f3e9", "patch": "@@ -0,0 +1,8 @@\n+// PR c++/60373\n+// { dg-do compile { target c++11 } }\n+// { dg-require-visibility \"\" }\n+\n+#include <new>\n+__attribute__((visibility(\"hidden\")))void*operator new(std::size_t); // { dg-warning \"visibility attribute ignored\" }\n+\n+// { dg-message \"previous declaration\" \"\" { target *-*-* } 128 }"}, {"sha": "a85e6c38e952f997ff20a96991e816d5cb2ded1a", "filename": "gcc/testsuite/g++.dg/ext/visibility/redecl1.C", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/512eacee8fc5fd97faf037f45d0781a79db5f3e9/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Fext%2Fvisibility%2Fredecl1.C", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/512eacee8fc5fd97faf037f45d0781a79db5f3e9/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Fext%2Fvisibility%2Fredecl1.C", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Fext%2Fvisibility%2Fredecl1.C?ref=512eacee8fc5fd97faf037f45d0781a79db5f3e9", "patch": "@@ -3,5 +3,5 @@\n struct __attribute((visibility(\"hidden\"))) B;\n struct __attribute((visibility(\"default\"))) B;\t// { dg-error \"visibility\" }\n \n-__attribute ((visibility (\"hidden\"))) void f();\t// { dg-warning \"previous\" }\n+__attribute ((visibility (\"hidden\"))) void f();\t// { dg-message \"previous\" }\n __attribute ((visibility (\"default\"))) void f(); // { dg-warning \"visibility\" }"}, {"sha": "0a6e4ba637b8c36b92e13f8384e60ee364838a6a", "filename": "gcc/testsuite/g++.dg/ext/visibility/visibility-7.C", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/512eacee8fc5fd97faf037f45d0781a79db5f3e9/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Fext%2Fvisibility%2Fvisibility-7.C", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/512eacee8fc5fd97faf037f45d0781a79db5f3e9/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Fext%2Fvisibility%2Fvisibility-7.C", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Fext%2Fvisibility%2Fvisibility-7.C?ref=512eacee8fc5fd97faf037f45d0781a79db5f3e9", "patch": "@@ -4,7 +4,7 @@\n \n extern int \n __attribute__((visibility (\"hidden\")))\n-xyzzy; /* { dg-warning \"previous declaration here\" \"\" } */\n+xyzzy; /* { dg-message \"previous declaration\" \"\" } */\n \n int \n __attribute__((visibility (\"protected\")))"}]}