{"sha": "cdc5524fc8255e6303ae90f3089e93998dc8a626", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6Y2RjNTUyNGZjODI1NWU2MzAzYWU5MGYzMDg5ZTkzOTk4ZGM4YTYyNg==", "commit": {"author": {"name": "Thomas Koenig", "email": "Thomas.Koenig@online.de", "date": "2006-08-01T17:15:04Z"}, "committer": {"name": "Thomas Koenig", "email": "tkoenig@gcc.gnu.org", "date": "2006-08-01T17:15:04Z"}, "message": "re PR libfortran/28452 (__gfortran_random_r10 not found)\n\n2006-08-01  Thomas Koenig  <Thomas.Koenig@online.de>\n\n\tPR libfortran/28542\n\t* Makefile.am:  Remove normalize.c.\n\t* aclocal.m4:  Regenerate using aclocal 1.9.3.\n\t* Makefile.in:  Regenerate using automake 1.9.3.\n\t* libgfortran.h:  #include <float.h>.\n\tDefine GFC_REAL_*_DIGITS and GFC_REAL_*_RADIX.\n\tRemove prototypes for normalize_r4_i4 and normalize_r8_i8.\n\t* intrinsics/random.c (top level): Add prototypes for\n\trandom_r10, arandom_r10, random_r16 and arandom_r16.\n\t(rnumber_4):  New static function.\n\t(rnumber_8):  New static function.\n\t(rnumber_10): New static function.\n\t(rnumber_16): New static function.\n\t(top level):  Set to kiss_size to 12 if we have\n\tREAL(KIND=16), to 8 otherwise.\n\tDefine KISS_DEFAULT_SEED_1, KISS_DEFAULT_SEED_2 and\n\tKISS_DEFAULT_SEED_3.\n\t(kiss_random_kernel):  Take argument to differentiate\n\tbetween different random number generators.\n\t(random_r4):  Add argument to call to kiss_random_kernel,\n\tuse rnumber_*.\n\t(random_r8):  Likewise.\n\t(random_r10):  New function.\n\t(random_r16):  New function.\n\t(arandom_r4):  Add argument to call to kiss_random_kernel,\n\tuse_rnumber_*.\n\t(arandom_r8):  Likewise.\n\t(arandom_r10):  New function.\n\t(arandom_r16):  New function.\n\t* intrinsics/rand.c (rand):  Use shift and mask.\n\t* runtime/normalize.c:  Remove.\n\n2006-08-01  Thomas Koenig  <Thomas.Koenig@online.de>\n\n\tPR libfortran/28542\n\t* gfortran.dg/random_3.f90:  New test.\n\nFrom-SVN: r115858", "tree": {"sha": "2c5173e380e77a7fd222230cb14ad82228f9ce72", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/2c5173e380e77a7fd222230cb14ad82228f9ce72"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/cdc5524fc8255e6303ae90f3089e93998dc8a626", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/cdc5524fc8255e6303ae90f3089e93998dc8a626", "html_url": "https://github.com/Rust-GCC/gccrs/commit/cdc5524fc8255e6303ae90f3089e93998dc8a626", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/cdc5524fc8255e6303ae90f3089e93998dc8a626/comments", "author": null, "committer": null, "parents": [{"sha": "a82f93ac13c4280fdf2b5d48648bfc3f7668406b", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/a82f93ac13c4280fdf2b5d48648bfc3f7668406b", "html_url": "https://github.com/Rust-GCC/gccrs/commit/a82f93ac13c4280fdf2b5d48648bfc3f7668406b"}], "stats": {"total": 1021, "additions": 748, "deletions": 273}, "files": [{"sha": "29b85845529a7066b92a761c0716e766ae7e24d5", "filename": "gcc/testsuite/ChangeLog", "status": "modified", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/cdc5524fc8255e6303ae90f3089e93998dc8a626/gcc%2Ftestsuite%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/cdc5524fc8255e6303ae90f3089e93998dc8a626/gcc%2Ftestsuite%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2FChangeLog?ref=cdc5524fc8255e6303ae90f3089e93998dc8a626", "patch": "@@ -1,3 +1,8 @@\n+2006-08-01  Thomas Koenig  <Thomas.Koenig@online.de>\n+\n+\tPR libfortran/28542\n+\t* gfortran.dg/random_3.f90:  New test.\n+\n 2006-08-01  Steve Ellcey  <sje@cup.hp.com>\n \n \tPR c++/28432"}, {"sha": "8e087c4826771ff6348e26710f93f5df32363027", "filename": "gcc/testsuite/gfortran.dg/random_3.f90", "status": "added", "additions": 29, "deletions": 0, "changes": 29, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/cdc5524fc8255e6303ae90f3089e93998dc8a626/gcc%2Ftestsuite%2Fgfortran.dg%2Frandom_3.f90", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/cdc5524fc8255e6303ae90f3089e93998dc8a626/gcc%2Ftestsuite%2Fgfortran.dg%2Frandom_3.f90", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgfortran.dg%2Frandom_3.f90?ref=cdc5524fc8255e6303ae90f3089e93998dc8a626", "patch": "@@ -0,0 +1,29 @@\n+! { dg-do run }\n+! { dg-require-effective-target fortran_large_real }\n+! Check that the random_seed for real(10) or real(16) exists and that\n+! real(8) and real(10) or real(16) random number generators\n+! return the same sequence of values.\n+! Mostly copied from random_2.f90\n+program random_4\n+  integer,parameter :: k = selected_real_kind (precision (0.0_8) + 1)\n+\n+  integer, dimension(:), allocatable :: seed\n+  real(kind=8), dimension(10) :: r8\n+  real(kind=k), dimension(10) :: r10\n+  real, parameter :: delta = 1.d-10\n+  integer n\n+\n+  call random_seed (size=n)\n+  allocate (seed(n))\n+  call random_seed (get=seed)\n+  ! Test both array valued and scalar routines.\n+  call random_number(r8)\n+  call random_number (r8(10))\n+\n+  ! Reset the seed and get the real(8) values.\n+  call random_seed (put=seed)\n+  call random_number(r10)\n+  call random_number (r10(10))\n+\n+  if (any ((r8 - r10) .gt. delta)) call abort\n+end program random_4"}, {"sha": "6807abf376350ee2b4fa23bad361f0eeba30333e", "filename": "libgfortran/ChangeLog", "status": "modified", "additions": 34, "deletions": 0, "changes": 34, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/cdc5524fc8255e6303ae90f3089e93998dc8a626/libgfortran%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/cdc5524fc8255e6303ae90f3089e93998dc8a626/libgfortran%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libgfortran%2FChangeLog?ref=cdc5524fc8255e6303ae90f3089e93998dc8a626", "patch": "@@ -1,3 +1,37 @@\n+2006-08-01  Thomas Koenig  <Thomas.Koenig@online.de>\n+\n+\tPR libfortran/28542\n+\t* Makefile.am:  Remove normalize.c.\n+\t* aclocal.m4:  Regenerate using aclocal 1.9.3.\n+\t* Makefile.in:  Regenerate using automake 1.9.3.\n+\t* libgfortran.h:  #include <float.h>.\n+\tDefine GFC_REAL_*_DIGITS and GFC_REAL_*_RADIX.\n+\tRemove prototypes for normalize_r4_i4 and normalize_r8_i8.\n+\t* intrinsics/random.c (top level): Add prototypes for\n+\trandom_r10, arandom_r10, random_r16 and arandom_r16.\n+\t(rnumber_4):  New static function.\n+\t(rnumber_8):  New static function.\n+\t(rnumber_10): New static function.\n+\t(rnumber_16): New static function.\n+\t(top level):  Set to kiss_size to 12 if we have\n+\tREAL(KIND=16), to 8 otherwise.\n+\tDefine KISS_DEFAULT_SEED_1, KISS_DEFAULT_SEED_2 and\n+\tKISS_DEFAULT_SEED_3.\n+\t(kiss_random_kernel):  Take argument to differentiate\n+\tbetween different random number generators.\n+\t(random_r4):  Add argument to call to kiss_random_kernel,\n+\tuse rnumber_*.\n+\t(random_r8):  Likewise.\n+\t(random_r10):  New function.\n+\t(random_r16):  New function.\n+\t(arandom_r4):  Add argument to call to kiss_random_kernel,\n+\tuse_rnumber_*.\n+\t(arandom_r8):  Likewise.\n+\t(arandom_r10):  New function.\n+\t(arandom_r16):  New function.\n+\t* intrinsics/rand.c (rand):  Use shift and mask.\n+\t* runtime/normalize.c:  Remove.\n+\n 2006-07-30  Jerry DeLisle  <jvdelisle@gcc.gnu.org>\n \n \tPR libgfortran/28335"}, {"sha": "baf40926c7cea6f7d23239e55b363812d3b540a3", "filename": "libgfortran/Makefile.am", "status": "modified", "additions": 1, "deletions": 2, "changes": 3, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/cdc5524fc8255e6303ae90f3089e93998dc8a626/libgfortran%2FMakefile.am", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/cdc5524fc8255e6303ae90f3089e93998dc8a626/libgfortran%2FMakefile.am", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libgfortran%2FMakefile.am?ref=cdc5524fc8255e6303ae90f3089e93998dc8a626", "patch": "@@ -99,8 +99,7 @@ intrinsics/umask.c \\\n intrinsics/unlink.c \\\n intrinsics/unpack_generic.c \\\n runtime/in_pack_generic.c \\\n-runtime/in_unpack_generic.c \\\n-runtime/normalize.c\n+runtime/in_unpack_generic.c\n \n gfor_src= \\\n runtime/compile_options.c \\"}, {"sha": "918150ebd3b41e805a3afc014bb29335c8c5f1d0", "filename": "libgfortran/Makefile.in", "status": "modified", "additions": 17, "deletions": 15, "changes": 32, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/cdc5524fc8255e6303ae90f3089e93998dc8a626/libgfortran%2FMakefile.in", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/cdc5524fc8255e6303ae90f3089e93998dc8a626/libgfortran%2FMakefile.in", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libgfortran%2FMakefile.in?ref=cdc5524fc8255e6303ae90f3089e93998dc8a626", "patch": "@@ -1,8 +1,8 @@\n-# Makefile.in generated by automake 1.9.6 from Makefile.am.\n+# Makefile.in generated by automake 1.9.3 from Makefile.am.\n # @configure_input@\n \n # Copyright (C) 1994, 1995, 1996, 1997, 1998, 1999, 2000, 2001, 2002,\n-# 2003, 2004, 2005  Free Software Foundation, Inc.\n+# 2003, 2004  Free Software Foundation, Inc.\n # This Makefile.in is free software; the Free Software Foundation\n # gives unlimited permission to copy and/or distribute it,\n # with or without modifications, as long as this notice is preserved.\n@@ -14,6 +14,8 @@\n \n @SET_MAKE@\n \n+SOURCES = $(libgfortran_la_SOURCES) $(libgfortranbegin_la_SOURCES)\n+\n srcdir = @srcdir@\n top_srcdir = @top_srcdir@\n VPATH = @srcdir@\n@@ -45,8 +47,7 @@ DIST_COMMON = $(am__configure_deps) $(srcdir)/../config.guess \\\n \t$(top_srcdir)/configure ChangeLog\n subdir = .\n ACLOCAL_M4 = $(top_srcdir)/aclocal.m4\n-am__aclocal_m4_deps = $(top_srcdir)/../config/lead-dot.m4 \\\n-\t$(top_srcdir)/../config/stdint.m4 $(top_srcdir)/acinclude.m4 \\\n+am__aclocal_m4_deps = $(top_srcdir)/acinclude.m4 \\\n \t$(top_srcdir)/../config/acx.m4 \\\n \t$(top_srcdir)/../config/no-executables.m4 \\\n \t$(top_srcdir)/../libtool.m4 $(top_srcdir)/configure.ac\n@@ -173,7 +174,7 @@ am__objects_30 = associated.lo abort.lo access.lo args.lo bessel.lo \\\n \tselected_int_kind.lo selected_real_kind.lo stat.lo symlnk.lo \\\n \tsystem_clock.lo time.lo transpose_generic.lo tty.lo umask.lo \\\n \tunlink.lo unpack_generic.lo in_pack_generic.lo \\\n-\tin_unpack_generic.lo normalize.lo\n+\tin_unpack_generic.lo\n am__objects_31 =\n am__objects_32 = _abs_c4.lo _abs_c8.lo _abs_c10.lo _abs_c16.lo \\\n \t_abs_i4.lo _abs_i8.lo _abs_i16.lo _abs_r4.lo _abs_r8.lo \\\n@@ -219,7 +220,7 @@ LTPPFCCOMPILE = $(LIBTOOL) --mode=compile $(FC) $(DEFS) \\\n \t$(DEFAULT_INCLUDES) $(INCLUDES) $(AM_CPPFLAGS) $(CPPFLAGS) \\\n \t$(AM_FCFLAGS) $(FCFLAGS)\n FCLD = $(FC)\n-FCLINK = $(LIBTOOL) --mode=link $(FCLD) $(AM_FCFLAGS) $(FCFLAGS) \\\n+FCLINK = $(LIBTOOL) --mode=link $(FCLD) $(AM_FFLAGS) $(FCFLAGS) \\\n \t$(AM_LDFLAGS) $(LDFLAGS) -o $@\n COMPILE = $(CC) $(DEFS) $(DEFAULT_INCLUDES) $(INCLUDES) $(AM_CPPFLAGS) \\\n \t$(CPPFLAGS) $(AM_CFLAGS) $(CFLAGS)\n@@ -264,6 +265,7 @@ AUTOHEADER = @AUTOHEADER@\n AUTOMAKE = @AUTOMAKE@\n AWK = @AWK@\n CC = @CC@\n+CFLAGS = @CFLAGS@\n CPP = @CPP@\n CPPFLAGS = @CPPFLAGS@\n CYGPATH_W = @CYGPATH_W@\n@@ -276,6 +278,7 @@ EXEEXT = @EXEEXT@\n FC = @FC@\n FCFLAGS = @FCFLAGS@\n FPU_HOST_HEADER = @FPU_HOST_HEADER@\n+GREP = @GREP@\n INSTALL_DATA = @INSTALL_DATA@\n INSTALL_PROGRAM = @INSTALL_PROGRAM@\n INSTALL_SCRIPT = @INSTALL_SCRIPT@\n@@ -303,12 +306,8 @@ SET_MAKE = @SET_MAKE@\n SHELL = @SHELL@\n STRIP = @STRIP@\n VERSION = @VERSION@\n-ac_ct_AR = @ac_ct_AR@\n-ac_ct_AS = @ac_ct_AS@\n ac_ct_CC = @ac_ct_CC@\n ac_ct_FC = @ac_ct_FC@\n-ac_ct_RANLIB = @ac_ct_RANLIB@\n-ac_ct_STRIP = @ac_ct_STRIP@\n am__leading_dot = @am__leading_dot@\n am__tar = @am__tar@\n am__untar = @am__untar@\n@@ -321,6 +320,9 @@ build_os = @build_os@\n build_subdir = @build_subdir@\n build_vendor = @build_vendor@\n datadir = @datadir@\n+datarootdir = @datarootdir@\n+docdir = @docdir@\n+dvidir = @dvidir@\n enable_shared = @enable_shared@\n enable_static = @enable_static@\n exec_prefix = @exec_prefix@\n@@ -331,18 +333,22 @@ host_cpu = @host_cpu@\n host_os = @host_os@\n host_subdir = @host_subdir@\n host_vendor = @host_vendor@\n+htmldir = @htmldir@\n includedir = @includedir@\n infodir = @infodir@\n install_sh = @install_sh@\n libdir = @libdir@\n libexecdir = @libexecdir@\n+localedir = @localedir@\n localstatedir = @localstatedir@\n mandir = @mandir@\n mkdir_p = @mkdir_p@\n multi_basedir = @multi_basedir@\n oldincludedir = @oldincludedir@\n+pdfdir = @pdfdir@\n prefix = @prefix@\n program_transform_name = @program_transform_name@\n+psdir = @psdir@\n sbindir = @sbindir@\n sharedstatedir = @sharedstatedir@\n sysconfdir = @sysconfdir@\n@@ -443,8 +449,7 @@ intrinsics/umask.c \\\n intrinsics/unlink.c \\\n intrinsics/unpack_generic.c \\\n runtime/in_pack_generic.c \\\n-runtime/in_unpack_generic.c \\\n-runtime/normalize.c\n+runtime/in_unpack_generic.c\n \n gfor_src = \\\n runtime/compile_options.c \\\n@@ -2377,9 +2382,6 @@ in_pack_generic.lo: runtime/in_pack_generic.c\n in_unpack_generic.lo: runtime/in_unpack_generic.c\n \t$(LIBTOOL) --mode=compile $(CC) $(DEFS) $(DEFAULT_INCLUDES) $(INCLUDES) $(AM_CPPFLAGS) $(CPPFLAGS) $(AM_CFLAGS) $(CFLAGS) -c -o in_unpack_generic.lo `test -f 'runtime/in_unpack_generic.c' || echo '$(srcdir)/'`runtime/in_unpack_generic.c\n \n-normalize.lo: runtime/normalize.c\n-\t$(LIBTOOL) --mode=compile $(CC) $(DEFS) $(DEFAULT_INCLUDES) $(INCLUDES) $(AM_CPPFLAGS) $(CPPFLAGS) $(AM_CFLAGS) $(CFLAGS) -c -o normalize.lo `test -f 'runtime/normalize.c' || echo '$(srcdir)/'`runtime/normalize.c\n-\n .f90.o:\n \t$(FCCOMPILE) -c -o $@ $<\n "}, {"sha": "0111a59f978e2a30ec40a4690215dabb253daf7c", "filename": "libgfortran/aclocal.m4", "status": "modified", "additions": 273, "deletions": 96, "changes": 369, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/cdc5524fc8255e6303ae90f3089e93998dc8a626/libgfortran%2Faclocal.m4", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/cdc5524fc8255e6303ae90f3089e93998dc8a626/libgfortran%2Faclocal.m4", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libgfortran%2Faclocal.m4?ref=cdc5524fc8255e6303ae90f3089e93998dc8a626", "patch": "@@ -1,7 +1,7 @@\n-# generated automatically by aclocal 1.9.6 -*- Autoconf -*-\n+# generated automatically by aclocal 1.9.3 -*- Autoconf -*-\n \n-# Copyright (C) 1996, 1997, 1998, 1999, 2000, 2001, 2002, 2003, 2004,\n-# 2005  Free Software Foundation, Inc.\n+# Copyright (C) 1996, 1997, 1998, 1999, 2000, 2001, 2002, 2003, 2004\n+# Free Software Foundation, Inc.\n # This file is free software; the Free Software Foundation\n # gives unlimited permission to copy and/or distribute it,\n # with or without modifications, as long as this notice is preserved.\n@@ -11,11 +11,23 @@\n # even the implied warranty of MERCHANTABILITY or FITNESS FOR A\n # PARTICULAR PURPOSE.\n \n-# Copyright (C) 2002, 2003, 2005  Free Software Foundation, Inc.\n-#\n-# This file is free software; the Free Software Foundation\n-# gives unlimited permission to copy and/or distribute it,\n-# with or without modifications, as long as this notice is preserved.\n+#                                                        -*- Autoconf -*-\n+# Copyright (C) 2002, 2003  Free Software Foundation, Inc.\n+# Generated from amversion.in; do not edit by hand.\n+\n+# This program is free software; you can redistribute it and/or modify\n+# it under the terms of the GNU General Public License as published by\n+# the Free Software Foundation; either version 2, or (at your option)\n+# any later version.\n+\n+# This program is distributed in the hope that it will be useful,\n+# but WITHOUT ANY WARRANTY; without even the implied warranty of\n+# MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n+# GNU General Public License for more details.\n+\n+# You should have received a copy of the GNU General Public License\n+# along with this program; if not, write to the Free Software\n+# Foundation, Inc., 59 Temple Place - Suite 330, Boston, MA\n \n # AM_AUTOMAKE_VERSION(VERSION)\n # ----------------------------\n@@ -28,15 +40,26 @@ AC_DEFUN([AM_AUTOMAKE_VERSION], [am__api_version=\"1.9\"])\n # Call AM_AUTOMAKE_VERSION so it can be traced.\n # This function is AC_REQUIREd by AC_INIT_AUTOMAKE.\n AC_DEFUN([AM_SET_CURRENT_AUTOMAKE_VERSION],\n-\t [AM_AUTOMAKE_VERSION([1.9.6])])\n+\t [AM_AUTOMAKE_VERSION([1.9.3])])\n \n-# AM_AUX_DIR_EXPAND                                         -*- Autoconf -*-\n+# AM_AUX_DIR_EXPAND\n \n-# Copyright (C) 2001, 2003, 2005  Free Software Foundation, Inc.\n-#\n-# This file is free software; the Free Software Foundation\n-# gives unlimited permission to copy and/or distribute it,\n-# with or without modifications, as long as this notice is preserved.\n+# Copyright (C) 2001, 2003 Free Software Foundation, Inc.\n+\n+# This program is free software; you can redistribute it and/or modify\n+# it under the terms of the GNU General Public License as published by\n+# the Free Software Foundation; either version 2, or (at your option)\n+# any later version.\n+\n+# This program is distributed in the hope that it will be useful,\n+# but WITHOUT ANY WARRANTY; without even the implied warranty of\n+# MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n+# GNU General Public License for more details.\n+\n+# You should have received a copy of the GNU General Public License\n+# along with this program; if not, write to the Free Software\n+# Foundation, Inc., 59 Temple Place - Suite 330, Boston, MA\n+# 02111-1307, USA.\n \n # For projects using AC_CONFIG_AUX_DIR([foo]), Autoconf sets\n # $ac_aux_dir to `$srcdir/foo'.  In other projects, it is set to\n@@ -83,16 +106,26 @@ AC_PREREQ([2.50])dnl\n am_aux_dir=`cd $ac_aux_dir && pwd`\n ])\n \n-# AM_CONDITIONAL                                            -*- Autoconf -*-\n+# AM_CONDITIONAL                                              -*- Autoconf -*-\n \n-# Copyright (C) 1997, 2000, 2001, 2003, 2004, 2005\n-# Free Software Foundation, Inc.\n-#\n-# This file is free software; the Free Software Foundation\n-# gives unlimited permission to copy and/or distribute it,\n-# with or without modifications, as long as this notice is preserved.\n+# Copyright (C) 1997, 2000, 2001, 2003, 2004 Free Software Foundation, Inc.\n \n-# serial 7\n+# This program is free software; you can redistribute it and/or modify\n+# it under the terms of the GNU General Public License as published by\n+# the Free Software Foundation; either version 2, or (at your option)\n+# any later version.\n+\n+# This program is distributed in the hope that it will be useful,\n+# but WITHOUT ANY WARRANTY; without even the implied warranty of\n+# MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n+# GNU General Public License for more details.\n+\n+# You should have received a copy of the GNU General Public License\n+# along with this program; if not, write to the Free Software\n+# Foundation, Inc., 59 Temple Place - Suite 330, Boston, MA\n+# 02111-1307, USA.\n+\n+# serial 6\n \n # AM_CONDITIONAL(NAME, SHELL-CONDITION)\n # -------------------------------------\n@@ -116,19 +149,30 @@ AC_CONFIG_COMMANDS_PRE(\n Usually this means the macro was only invoked conditionally.]])\n fi])])\n \n-# Do all the work for Automake.                             -*- Autoconf -*-\n+# Do all the work for Automake.                            -*- Autoconf -*-\n \n-# Copyright (C) 1996, 1997, 1998, 1999, 2000, 2001, 2002, 2003, 2004, 2005\n+# This macro actually does too much some checks are only needed if\n+# your package does certain things.  But this isn't really a big deal.\n+\n+# Copyright (C) 1996, 1997, 1998, 1999, 2000, 2001, 2002, 2003, 2004\n # Free Software Foundation, Inc.\n-#\n-# This file is free software; the Free Software Foundation\n-# gives unlimited permission to copy and/or distribute it,\n-# with or without modifications, as long as this notice is preserved.\n \n-# serial 12\n+# This program is free software; you can redistribute it and/or modify\n+# it under the terms of the GNU General Public License as published by\n+# the Free Software Foundation; either version 2, or (at your option)\n+# any later version.\n \n-# This macro actually does too much.  Some checks are only needed if\n-# your package does certain things.  But this isn't really a big deal.\n+# This program is distributed in the hope that it will be useful,\n+# but WITHOUT ANY WARRANTY; without even the implied warranty of\n+# MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n+# GNU General Public License for more details.\n+\n+# You should have received a copy of the GNU General Public License\n+# along with this program; if not, write to the Free Software\n+# Foundation, Inc., 59 Temple Place - Suite 330, Boston, MA\n+# 02111-1307, USA.\n+\n+# serial 11\n \n # AM_INIT_AUTOMAKE(PACKAGE, VERSION, [NO-DEFINE])\n # AM_INIT_AUTOMAKE([OPTIONS])\n@@ -230,31 +274,87 @@ for _am_header in $config_headers :; do\n done\n echo \"timestamp for $1\" >`AS_DIRNAME([$1])`/stamp-h[]$_am_stamp_count])\n \n-# Copyright (C) 2001, 2003, 2005  Free Software Foundation, Inc.\n-#\n-# This file is free software; the Free Software Foundation\n-# gives unlimited permission to copy and/or distribute it,\n-# with or without modifications, as long as this notice is preserved.\n-\n # AM_PROG_INSTALL_SH\n # ------------------\n # Define $install_sh.\n+\n+# Copyright (C) 2001, 2003 Free Software Foundation, Inc.\n+\n+# This program is free software; you can redistribute it and/or modify\n+# it under the terms of the GNU General Public License as published by\n+# the Free Software Foundation; either version 2, or (at your option)\n+# any later version.\n+\n+# This program is distributed in the hope that it will be useful,\n+# but WITHOUT ANY WARRANTY; without even the implied warranty of\n+# MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n+# GNU General Public License for more details.\n+\n+# You should have received a copy of the GNU General Public License\n+# along with this program; if not, write to the Free Software\n+# Foundation, Inc., 59 Temple Place - Suite 330, Boston, MA\n+# 02111-1307, USA.\n+\n AC_DEFUN([AM_PROG_INSTALL_SH],\n [AC_REQUIRE([AM_AUX_DIR_EXPAND])dnl\n install_sh=${install_sh-\"$am_aux_dir/install-sh\"}\n AC_SUBST(install_sh)])\n \n-# Add --enable-maintainer-mode option to configure.         -*- Autoconf -*-\n+#                                                          -*- Autoconf -*-\n+# Copyright (C) 2003  Free Software Foundation, Inc.\n+\n+# This program is free software; you can redistribute it and/or modify\n+# it under the terms of the GNU General Public License as published by\n+# the Free Software Foundation; either version 2, or (at your option)\n+# any later version.\n+\n+# This program is distributed in the hope that it will be useful,\n+# but WITHOUT ANY WARRANTY; without even the implied warranty of\n+# MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n+# GNU General Public License for more details.\n+\n+# You should have received a copy of the GNU General Public License\n+# along with this program; if not, write to the Free Software\n+# Foundation, Inc., 59 Temple Place - Suite 330, Boston, MA\n+# 02111-1307, USA.\n+\n+# serial 1\n+\n+# Check whether the underlying file-system supports filenames\n+# with a leading dot.  For instance MS-DOS doesn't.\n+AC_DEFUN([AM_SET_LEADING_DOT],\n+[rm -rf .tst 2>/dev/null\n+mkdir .tst 2>/dev/null\n+if test -d .tst; then\n+  am__leading_dot=.\n+else\n+  am__leading_dot=_\n+fi\n+rmdir .tst 2>/dev/null\n+AC_SUBST([am__leading_dot])])\n+\n+# Add --enable-maintainer-mode option to configure.\n # From Jim Meyering\n \n-# Copyright (C) 1996, 1998, 2000, 2001, 2002, 2003, 2004, 2005\n+# Copyright (C) 1996, 1998, 2000, 2001, 2002, 2003, 2004\n # Free Software Foundation, Inc.\n-#\n-# This file is free software; the Free Software Foundation\n-# gives unlimited permission to copy and/or distribute it,\n-# with or without modifications, as long as this notice is preserved.\n \n-# serial 4\n+# This program is free software; you can redistribute it and/or modify\n+# it under the terms of the GNU General Public License as published by\n+# the Free Software Foundation; either version 2, or (at your option)\n+# any later version.\n+\n+# This program is distributed in the hope that it will be useful,\n+# but WITHOUT ANY WARRANTY; without even the implied warranty of\n+# MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n+# GNU General Public License for more details.\n+\n+# You should have received a copy of the GNU General Public License\n+# along with this program; if not, write to the Free Software\n+# Foundation, Inc., 59 Temple Place - Suite 330, Boston, MA\n+# 02111-1307, USA.\n+\n+# serial 3\n \n AC_DEFUN([AM_MAINTAINER_MODE],\n [AC_MSG_CHECKING([whether to enable maintainer-specific portions of Makefiles])\n@@ -273,16 +373,27 @@ AC_DEFUN([AM_MAINTAINER_MODE],\n \n AU_DEFUN([jm_MAINTAINER_MODE], [AM_MAINTAINER_MODE])\n \n-# Fake the existence of programs that GNU maintainers use.  -*- Autoconf -*-\n+#  -*- Autoconf -*-\n \n-# Copyright (C) 1997, 1999, 2000, 2001, 2003, 2005\n-# Free Software Foundation, Inc.\n-#\n-# This file is free software; the Free Software Foundation\n-# gives unlimited permission to copy and/or distribute it,\n-# with or without modifications, as long as this notice is preserved.\n \n-# serial 4\n+# Copyright (C) 1997, 1999, 2000, 2001, 2003 Free Software Foundation, Inc.\n+\n+# This program is free software; you can redistribute it and/or modify\n+# it under the terms of the GNU General Public License as published by\n+# the Free Software Foundation; either version 2, or (at your option)\n+# any later version.\n+\n+# This program is distributed in the hope that it will be useful,\n+# but WITHOUT ANY WARRANTY; without even the implied warranty of\n+# MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n+# GNU General Public License for more details.\n+\n+# You should have received a copy of the GNU General Public License\n+# along with this program; if not, write to the Free Software\n+# Foundation, Inc., 59 Temple Place - Suite 330, Boston, MA\n+# 02111-1307, USA.\n+\n+# serial 3\n \n # AM_MISSING_PROG(NAME, PROGRAM)\n # ------------------------------\n@@ -308,16 +419,27 @@ else\n fi\n ])\n \n-# Copyright (C) 2003, 2004, 2005  Free Software Foundation, Inc.\n-#\n-# This file is free software; the Free Software Foundation\n-# gives unlimited permission to copy and/or distribute it,\n-# with or without modifications, as long as this notice is preserved.\n-\n # AM_PROG_MKDIR_P\n # ---------------\n # Check whether `mkdir -p' is supported, fallback to mkinstalldirs otherwise.\n-#\n+\n+# Copyright (C) 2003, 2004 Free Software Foundation, Inc.\n+\n+# This program is free software; you can redistribute it and/or modify\n+# it under the terms of the GNU General Public License as published by\n+# the Free Software Foundation; either version 2, or (at your option)\n+# any later version.\n+\n+# This program is distributed in the hope that it will be useful,\n+# but WITHOUT ANY WARRANTY; without even the implied warranty of\n+# MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n+# GNU General Public License for more details.\n+\n+# You should have received a copy of the GNU General Public License\n+# along with this program; if not, write to the Free Software\n+# Foundation, Inc., 59 Temple Place - Suite 330, Boston, MA\n+# 02111-1307, USA.\n+\n # Automake 1.8 used `mkdir -m 0755 -p --' to ensure that directories\n # created by `make install' are always world readable, even if the\n # installer happens to have an overly restrictive umask (e.g. 077).\n@@ -371,14 +493,25 @@ else\n fi\n AC_SUBST([mkdir_p])])\n \n-# Copyright (C) 1998, 1999, 2000, 2001, 2003, 2004, 2005\n+# Copyright (C) 1998, 1999, 2000, 2001, 2003, 2004\n # Free Software Foundation, Inc.\n-#\n-# This file is free software; the Free Software Foundation\n-# gives unlimited permission to copy and/or distribute it,\n-# with or without modifications, as long as this notice is preserved.\n \n-# serial 5\n+# This program is free software; you can redistribute it and/or modify\n+# it under the terms of the GNU General Public License as published by\n+# the Free Software Foundation; either version 2, or (at your option)\n+# any later version.\n+\n+# This program is distributed in the hope that it will be useful,\n+# but WITHOUT ANY WARRANTY; without even the implied warranty of\n+# MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n+# GNU General Public License for more details.\n+\n+# You should have received a copy of the GNU General Public License\n+# along with this program; if not, write to the Free Software\n+# Foundation, Inc., 59 Temple Place - Suite 330, Boston, MA\n+# 02111-1307, USA.\n+\n+# serial 4\n \n # AM_ENABLE_MULTILIB([MAKEFILE], [REL-TO-TOP-SRCDIR])\n # ---------------------------------------------------\n@@ -429,15 +562,26 @@ multi_basedir=\"$multi_basedir\"\n CONFIG_SHELL=${CONFIG_SHELL-/bin/sh}\n CC=\"$CC\"])])dnl\n \n-# Helper functions for option handling.                     -*- Autoconf -*-\n+# Helper functions for option handling.                    -*- Autoconf -*-\n \n-# Copyright (C) 2001, 2002, 2003, 2005  Free Software Foundation, Inc.\n-#\n-# This file is free software; the Free Software Foundation\n-# gives unlimited permission to copy and/or distribute it,\n-# with or without modifications, as long as this notice is preserved.\n+# Copyright (C) 2001, 2002, 2003  Free Software Foundation, Inc.\n \n-# serial 3\n+# This program is free software; you can redistribute it and/or modify\n+# it under the terms of the GNU General Public License as published by\n+# the Free Software Foundation; either version 2, or (at your option)\n+# any later version.\n+\n+# This program is distributed in the hope that it will be useful,\n+# but WITHOUT ANY WARRANTY; without even the implied warranty of\n+# MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n+# GNU General Public License for more details.\n+\n+# You should have received a copy of the GNU General Public License\n+# along with this program; if not, write to the Free Software\n+# Foundation, Inc., 59 Temple Place - Suite 330, Boston, MA\n+# 02111-1307, USA.\n+\n+# serial 2\n \n # _AM_MANGLE_OPTION(NAME)\n # -----------------------\n@@ -462,16 +606,28 @@ AC_DEFUN([_AM_SET_OPTIONS],\n AC_DEFUN([_AM_IF_OPTION],\n [m4_ifset(_AM_MANGLE_OPTION([$1]), [$2], [$3])])\n \n-# Check to make sure that the build environment is sane.    -*- Autoconf -*-\n-\n-# Copyright (C) 1996, 1997, 2000, 2001, 2003, 2005\n-# Free Software Foundation, Inc.\n #\n-# This file is free software; the Free Software Foundation\n-# gives unlimited permission to copy and/or distribute it,\n-# with or without modifications, as long as this notice is preserved.\n+# Check to make sure that the build environment is sane.\n+#\n \n-# serial 4\n+# Copyright (C) 1996, 1997, 2000, 2001, 2003 Free Software Foundation, Inc.\n+\n+# This program is free software; you can redistribute it and/or modify\n+# it under the terms of the GNU General Public License as published by\n+# the Free Software Foundation; either version 2, or (at your option)\n+# any later version.\n+\n+# This program is distributed in the hope that it will be useful,\n+# but WITHOUT ANY WARRANTY; without even the implied warranty of\n+# MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n+# GNU General Public License for more details.\n+\n+# You should have received a copy of the GNU General Public License\n+# along with this program; if not, write to the Free Software\n+# Foundation, Inc., 59 Temple Place - Suite 330, Boston, MA\n+# 02111-1307, USA.\n+\n+# serial 3\n \n # AM_SANITY_CHECK\n # ---------------\n@@ -514,14 +670,25 @@ Check your system clock])\n fi\n AC_MSG_RESULT(yes)])\n \n-# Copyright (C) 2001, 2003, 2005  Free Software Foundation, Inc.\n-#\n-# This file is free software; the Free Software Foundation\n-# gives unlimited permission to copy and/or distribute it,\n-# with or without modifications, as long as this notice is preserved.\n-\n # AM_PROG_INSTALL_STRIP\n-# ---------------------\n+\n+# Copyright (C) 2001, 2003 Free Software Foundation, Inc.\n+\n+# This program is free software; you can redistribute it and/or modify\n+# it under the terms of the GNU General Public License as published by\n+# the Free Software Foundation; either version 2, or (at your option)\n+# any later version.\n+\n+# This program is distributed in the hope that it will be useful,\n+# but WITHOUT ANY WARRANTY; without even the implied warranty of\n+# MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n+# GNU General Public License for more details.\n+\n+# You should have received a copy of the GNU General Public License\n+# along with this program; if not, write to the Free Software\n+# Foundation, Inc., 59 Temple Place - Suite 330, Boston, MA\n+# 02111-1307, USA.\n+\n # One issue with vendor `install' (even GNU) is that you can't\n # specify the program used to strip binaries.  This is especially\n # annoying in cross-compiling environments, where the build's strip\n@@ -544,13 +711,25 @@ AC_SUBST([INSTALL_STRIP_PROGRAM])])\n \n # Check how to create a tarball.                            -*- Autoconf -*-\n \n-# Copyright (C) 2004, 2005  Free Software Foundation, Inc.\n-#\n-# This file is free software; the Free Software Foundation\n-# gives unlimited permission to copy and/or distribute it,\n-# with or without modifications, as long as this notice is preserved.\n+# Copyright (C) 2004  Free Software Foundation, Inc.\n+\n+# This program is free software; you can redistribute it and/or modify\n+# it under the terms of the GNU General Public License as published by\n+# the Free Software Foundation; either version 2, or (at your option)\n+# any later version.\n+\n+# This program is distributed in the hope that it will be useful,\n+# but WITHOUT ANY WARRANTY; without even the implied warranty of\n+# MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n+# GNU General Public License for more details.\n+\n+# You should have received a copy of the GNU General Public License\n+# along with this program; if not, write to the Free Software\n+# Foundation, Inc., 59 Temple Place - Suite 330, Boston, MA\n+# 02111-1307, USA.\n+\n+# serial 1\n \n-# serial 2\n \n # _AM_PROG_TAR(FORMAT)\n # --------------------\n@@ -638,6 +817,4 @@ AC_SUBST([am__tar])\n AC_SUBST([am__untar])\n ]) # _AM_PROG_TAR\n \n-m4_include([../config/lead-dot.m4])\n-m4_include([../config/stdint.m4])\n m4_include([acinclude.m4])"}, {"sha": "e6a11b2e4d704a05029d1eb2c63b596e96823a86", "filename": "libgfortran/intrinsics/rand.c", "status": "modified", "additions": 9, "deletions": 1, "changes": 10, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/cdc5524fc8255e6303ae90f3089e93998dc8a626/libgfortran%2Fintrinsics%2Frand.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/cdc5524fc8255e6303ae90f3089e93998dc8a626/libgfortran%2Fintrinsics%2Frand.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libgfortran%2Fintrinsics%2Frand.c?ref=cdc5524fc8255e6303ae90f3089e93998dc8a626", "patch": "@@ -122,7 +122,15 @@ export_proto_np(PREFIX(rand));\n GFC_REAL_4\n PREFIX(rand) (GFC_INTEGER_4 *i)\n {\n-  return normalize_r4_i4 (irand (i) - 1, GFC_RAND_M1 - 1);\n+  GFC_UINTEGER_4 mask;\n+#if GFC_REAL_4_RADIX == 2\n+  mask = ~ (GFC_UINTEGER_4) 0u << (32 - GFC_REAL_4_DIGITS + 1);\n+#elif GFC_REAL_4_RADIX == 16\n+  mask = ~ (GFC_UINTEGER_4) 0u << ((8 - GFC_REAL_4_DIGITS) * 4 + 1);\n+#else\n+#error \"GFC_REAL_4_RADIX has unknown value\"\n+#endif\n+  return ((GFC_UINTEGER_4) (irand(i) -1) & mask) * (GFC_REAL_4) 0x1.p-31f;\n }\n \n #ifndef __GTHREAD_MUTEX_INIT"}, {"sha": "9a31a0e2995ffe8e766fdfc98013125e48538d41", "filename": "libgfortran/intrinsics/random.c", "status": "modified", "additions": 361, "deletions": 31, "changes": 392, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/cdc5524fc8255e6303ae90f3089e93998dc8a626/libgfortran%2Fintrinsics%2Frandom.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/cdc5524fc8255e6303ae90f3089e93998dc8a626/libgfortran%2Fintrinsics%2Frandom.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libgfortran%2Fintrinsics%2Frandom.c?ref=cdc5524fc8255e6303ae90f3089e93998dc8a626", "patch": "@@ -45,13 +45,108 @@ export_proto(arandom_r4);\n extern void arandom_r8 (gfc_array_r8 *);\n export_proto(arandom_r8);\n \n+#ifdef HAVE_GFC_REAL_10\n+\n+extern void random_r10 (GFC_REAL_10 *);\n+iexport_proto(random_r10);\n+\n+extern void arandom_r10 (gfc_array_r10 *);\n+export_proto(arandom_r10);\n+\n+#endif\n+\n+#ifdef HAVE_GFC_REAL_16\n+\n+extern void random_r16 (GFC_REAL_16 *);\n+iexport_proto(random_r16);\n+\n+extern void arandom_r16 (gfc_array_r16 *);\n+export_proto(arandom_r16);\n+\n+#endif\n+\n #ifdef __GTHREAD_MUTEX_INIT\n static __gthread_mutex_t random_lock = __GTHREAD_MUTEX_INIT;\n #else\n static __gthread_mutex_t random_lock;\n #endif\n \n+/* Helper routines to map a GFC_UINTEGER_* to the corresponding\n+   GFC_REAL_* types in the range of [0,1).  If GFC_REAL_*_RADIX are 2\n+   or 16, respectively, we mask off the bits that don't fit into the\n+   correct GFC_REAL_*, convert to the real type, then multiply by the\n+   correct offset.\n+*/\n+\n+\n+static inline void\n+rnumber_4 (GFC_REAL_4 *f, GFC_UINTEGER_4 v)\n+{\n+  GFC_UINTEGER_4 mask;\n+#if GFC_REAL_4_RADIX == 2\n+  mask = ~ (GFC_UINTEGER_4) 0u << (32 - GFC_REAL_4_DIGITS);\n+#elif GFC_REAL_4_RADIX == 16\n+  mask = ~ (GFC_UINTEGER_4) 0u << ((8 - GFC_REAL_4_DIGITS) * 4);\n+#else\n+#error \"GFC_REAL_4_RADIX has unknown value\"\n+#endif\n+  v = v & mask;\n+  *f = (GFC_REAL_4) v * (GFC_REAL_4) 0x1.p-32f;\n+}\n+\n+static inline void\n+rnumber_8 (GFC_REAL_8 *f, GFC_UINTEGER_8 v)\n+{\n+  GFC_UINTEGER_8 mask;\n+#if GFC_REAL_8_RADIX == 2\n+  mask = ~ (GFC_UINTEGER_8) 0u << (64 - GFC_REAL_8_DIGITS);\n+#elif GFC_REAL_8_RADIX == 16\n+  mask = ~ (GFC_UINTEGER_8) 0u << (16 - GFC_REAL_8_DIGITS) * 4);\n+#else\n+#error \"GFC_REAL_8_RADIX has unknown value\"\n+#endif\n+  v = v & mask;\n+  *f = (GFC_REAL_8) v * (GFC_REAL_8) 0x1.p-64;\n+}\n+\n+#ifdef HAVE_GFC_REAL_10\n \n+static inline void\n+rnumber_10 (GFC_REAL_10 *f, GFC_UINTEGER_8 v)\n+{\n+  GFC_UINTEGER_8 mask;\n+#if GFC_REAL_10_RADIX == 2\n+  mask = ~ (GFC_UINTEGER_8) 0u << (64 - GFC_REAL_10_DIGITS);\n+#elif GFC_REAL_10_RADIX == 16\n+  mask = ~ (GFC_UINTEGER_10) 0u << ((16 - GFC_REAL_10_DIGITS) * 4);\n+#else\n+#error \"GFC_REAL_10_RADIX has unknown value\"\n+#endif\n+  v = v & mask;\n+  *f = (GFC_REAL_10) v * (GFC_REAL_10) 0x1.p-64;\n+}\n+#endif\n+\n+#ifdef HAVE_GFC_REAL_16\n+\n+/* For REAL(KIND=16), we only need to mask off the lower bits.  */\n+\n+static inline void\n+rnumber_16 (GFC_REAL_16 *f, GFC_UINTEGER_8 v1, GFC_UINTEGER_8 v2)\n+{\n+  GFC_UINTEGER_8 mask;\n+#if GFC_REAL_16_RADIX == 2\n+  mask = ~ (GFC_UINTEGER_8) 0u << (128 - GFC_REAL_16_DIGITS);\n+#elif GFC_REAL_16_RADIX == 16\n+  mask = ~ (GFC_UINTEGER_8) 0u << ((32 - GFC_REAL_16_DIGITS) * 4);\n+#else\n+#error \"GFC_REAL_16_RADIX has unknown value\"\n+#endif\n+  v2 = v2 & mask;\n+  *f = (GFC_REAL_16) v1 * (GFC_REAL_16) 0x1.p-64\n+    + (GFC_REAL_16) v2 * (GFC_REAL_16) 0x1.p-128;\n+}\n+#endif\n /* libgfortran previously had a Mersenne Twister, taken from the paper:\n   \n \tMersenne Twister:\t623-dimensionally equidistributed\n@@ -111,28 +206,77 @@ static __gthread_mutex_t random_lock;\n \"There is no copyright on the code below.\" included the original\n KISS algorithm.  */\n \n+/* We use three KISS random number generators, with different\n+   seeds.\n+   As a matter of Quality of Implementation, the random numbers\n+   we generate for different REAL kinds, starting from the same\n+   seed, are always the same up to the precision of these types.\n+   We do this by using three generators with different seeds, the\n+   first one always for the most significant bits, the second one\n+   for bits 33..64 (if present in the REAL kind), and the third one\n+   (called twice) for REAL(16).\n+*/\n+\n #define GFC_SL(k, n)\t((k)^((k)<<(n)))\n #define GFC_SR(k, n)\t((k)^((k)>>(n)))\n \n-static const GFC_INTEGER_4 kiss_size = 4;\n-#define KISS_DEFAULT_SEED {123456789, 362436069, 521288629, 916191069}\n-static const GFC_UINTEGER_4 kiss_default_seed[4] = KISS_DEFAULT_SEED;\n-static GFC_UINTEGER_4 kiss_seed[4] = KISS_DEFAULT_SEED;\n+/*   Reference for the seed:\n+   From: \"George Marsaglia\" <g...@stat.fsu.edu>\n+   Newsgroups: sci.math\n+   Message-ID: <e7CcnWxczriWssCjXTWc3A@comcast.com>\n+  \n+   The KISS RNG uses four seeds, x, y, z, c,\n+   with 0<=x<2^32, 0<y<2^32, 0<=z<2^32, 0<=c<698769069\n+   except that the two pairs\n+   z=0,c=0 and z=2^32-1,c=698769068\n+   should be avoided.\n+*/\n+\n+#define KISS_DEFAULT_SEED_1 123456789, 362436069, 521288629, 316191069\n+#define KISS_DEFAULT_SEED_2 987654321, 458629013, 582859209, 438195021\n+#ifdef HAVE_GFC_REAL_16\n+#define KISS_DEFAULT_SEED_3 573658661, 185639104, 582619469, 296736107\n+#endif\n+\n+static GFC_UINTEGER_4 kiss_seed[] = {\n+  KISS_DEFAULT_SEED_1,\n+  KISS_DEFAULT_SEED_2,\n+#ifdef HAVE_GFC_REAL_16\n+  KISS_DEFAULT_SEED_3\n+#endif\n+};\n+\n+static GFC_UINTEGER_4 kiss_default_seed[] = {\n+  KISS_DEFAULT_SEED_1,\n+  KISS_DEFAULT_SEED_2,\n+#ifdef HAVE_GFC_REAL_16\n+  KISS_DEFAULT_SEED_3\n+#endif\n+};\n+\n+static const GFC_INTEGER_4 kiss_size = sizeof(kiss_seed)/sizeof(kiss_seed[0]);\n+\n+static GFC_UINTEGER_4 * const kiss_seed_1 = kiss_seed;\n+static GFC_UINTEGER_4 * const kiss_seed_2 = kiss_seed + 4;\n+\n+#ifdef HAVE_GFC_REAL_16\n+static GFC_UINTEGER_4 * const kiss_seed_3 = kiss_seed + 8;\n+#endif\n \n /* kiss_random_kernel() returns an integer value in the range of\n    (0, GFC_UINTEGER_4_HUGE].  The distribution of pseudorandom numbers\n    should be uniform.  */\n \n static GFC_UINTEGER_4\n-kiss_random_kernel(void)\n+kiss_random_kernel(GFC_UINTEGER_4 * seed)\n {\n   GFC_UINTEGER_4 kiss;\n \n-  kiss_seed[0] = 69069 * kiss_seed[0] + 1327217885;\n-  kiss_seed[1] = GFC_SL(GFC_SR(GFC_SL(kiss_seed[1],13),17),5);\n-  kiss_seed[2] = 18000 * (kiss_seed[2] & 65535) + (kiss_seed[2] >> 16);\n-  kiss_seed[3] = 30903 * (kiss_seed[3] & 65535) + (kiss_seed[3] >> 16);\n-  kiss = kiss_seed[0] + kiss_seed[1] + (kiss_seed[2] << 16) + kiss_seed[3];\n+  seed[0] = 69069 * seed[0] + 1327217885;\n+  seed[1] = GFC_SL(GFC_SR(GFC_SL(seed[1],13),17),5);\n+  seed[2] = 18000 * (seed[2] & 65535) + (seed[2] >> 16);\n+  seed[3] = 30903 * (seed[3] & 65535) + (seed[3] >> 16);\n+  kiss = seed[0] + seed[1] + (seed[2] << 16) + seed[3];\n \n   return kiss;\n }\n@@ -146,11 +290,8 @@ random_r4 (GFC_REAL_4 *x)\n   GFC_UINTEGER_4 kiss;\n \n   __gthread_mutex_lock (&random_lock);\n-  kiss = kiss_random_kernel ();\n-  /* Burn a random number, so the REAL*4 and REAL*8 functions\n-     produce similar sequences of random numbers.  */\n-  kiss_random_kernel ();\n-  *x = normalize_r4_i4 (kiss, ~(GFC_UINTEGER_4) 0);\n+  kiss = kiss_random_kernel (kiss_seed_1);\n+  rnumber_4 (x, kiss);\n   __gthread_mutex_unlock (&random_lock);\n }\n iexport(random_r4);\n@@ -164,13 +305,57 @@ random_r8 (GFC_REAL_8 *x)\n   GFC_UINTEGER_8 kiss;\n \n   __gthread_mutex_lock (&random_lock);\n-  kiss = ((GFC_UINTEGER_8)kiss_random_kernel ()) << 32;\n-  kiss += kiss_random_kernel ();\n-  *x = normalize_r8_i8 (kiss, ~(GFC_UINTEGER_8) 0);\n+  kiss = ((GFC_UINTEGER_8) kiss_random_kernel (kiss_seed_1)) << 32;\n+  kiss += kiss_random_kernel (kiss_seed_2);\n+  rnumber_8 (x, kiss);\n   __gthread_mutex_unlock (&random_lock);\n }\n iexport(random_r8);\n \n+#ifdef HAVE_GFC_REAL_10\n+\n+/*  This function produces a REAL(10) value from the uniform distribution\n+    with range [0,1).  */\n+\n+void\n+random_r10 (GFC_REAL_10 *x)\n+{\n+  GFC_UINTEGER_8 kiss;\n+\n+  __gthread_mutex_lock (&random_lock);\n+  kiss = ((GFC_UINTEGER_8) kiss_random_kernel (kiss_seed_1)) << 32;\n+  kiss += kiss_random_kernel (kiss_seed_2);\n+  rnumber_10 (x, kiss);\n+  __gthread_mutex_unlock (&random_lock);\n+}\n+iexport(random_r10);\n+\n+#endif\n+\n+/*  This function produces a REAL(16) value from the uniform distribution\n+    with range [0,1).  */\n+\n+#ifdef HAVE_GFC_REAL_16\n+\n+void\n+random_r16 (GFC_REAL_16 *x)\n+{\n+  GFC_UINTEGER_8 kiss1, kiss2;\n+\n+  __gthread_mutex_lock (&random_lock);\n+  kiss1 = ((GFC_UINTEGER_8) kiss_random_kernel (kiss_seed_1)) << 32;\n+  kiss1 += kiss_random_kernel (kiss_seed_2);\n+\n+  kiss2 = ((GFC_UINTEGER_8) kiss_random_kernel (kiss_seed_3)) << 32;\n+  kiss2 += kiss_random_kernel (kiss_seed_3);\n+\n+  rnumber_16 (x, kiss1, kiss2);\n+  __gthread_mutex_unlock (&random_lock);\n+}\n+iexport(random_r16);\n+\n+\n+#endif\n /*  This function fills a REAL(4) array with values from the uniform\n     distribution with range [0,1).  */\n \n@@ -206,11 +391,8 @@ arandom_r4 (gfc_array_r4 *x)\n   while (dest)\n     {\n       /* random_r4 (dest); */\n-      kiss = kiss_random_kernel ();\n-      /* Burn a random number, so the REAL*4 and REAL*8 functions\n-\t produce similar sequences of random numbers.  */\n-      kiss_random_kernel ();\n-      *dest = normalize_r4_i4 (kiss, ~(GFC_UINTEGER_4) 0);\n+      kiss = kiss_random_kernel (kiss_seed_1);\n+      rnumber_4 (dest, kiss);\n \n       /* Advance to the next element.  */\n       dest += stride0;\n@@ -276,9 +458,155 @@ arandom_r8 (gfc_array_r8 *x)\n   while (dest)\n     {\n       /* random_r8 (dest); */\n-      kiss = ((GFC_UINTEGER_8)kiss_random_kernel ()) << 32;\n-      kiss += kiss_random_kernel ();\n-      *dest = normalize_r8_i8 (kiss, ~(GFC_UINTEGER_8) 0);\n+      kiss = ((GFC_UINTEGER_8) kiss_random_kernel (kiss_seed_1)) << 32;\n+      kiss += kiss_random_kernel (kiss_seed_2);\n+      rnumber_8 (dest, kiss);\n+\n+      /* Advance to the next element.  */\n+      dest += stride0;\n+      count[0]++;\n+      /* Advance to the next source element.  */\n+      n = 0;\n+      while (count[n] == extent[n])\n+        {\n+          /* When we get to the end of a dimension, reset it and increment\n+             the next dimension.  */\n+          count[n] = 0;\n+          /* We could precalculate these products, but this is a less\n+             frequently used path so probably not worth it.  */\n+          dest -= stride[n] * extent[n];\n+          n++;\n+          if (n == dim)\n+            {\n+              dest = NULL;\n+              break;\n+            }\n+          else\n+            {\n+              count[n]++;\n+              dest += stride[n];\n+            }\n+        }\n+    }\n+  __gthread_mutex_unlock (&random_lock);\n+}\n+\n+#ifdef HAVE_GFC_REAL_10\n+\n+/*  This function fills a REAL(10) array with values from the uniform\n+    distribution with range [0,1).  */\n+\n+void\n+arandom_r10 (gfc_array_r10 *x)\n+{\n+  index_type count[GFC_MAX_DIMENSIONS];\n+  index_type extent[GFC_MAX_DIMENSIONS];\n+  index_type stride[GFC_MAX_DIMENSIONS];\n+  index_type stride0;\n+  index_type dim;\n+  GFC_REAL_10 *dest;\n+  GFC_UINTEGER_8 kiss;\n+  int n;\n+\n+  dest = x->data;\n+\n+  dim = GFC_DESCRIPTOR_RANK (x);\n+\n+  for (n = 0; n < dim; n++)\n+    {\n+      count[n] = 0;\n+      stride[n] = x->dim[n].stride;\n+      extent[n] = x->dim[n].ubound + 1 - x->dim[n].lbound;\n+      if (extent[n] <= 0)\n+        return;\n+    }\n+\n+  stride0 = stride[0];\n+\n+  __gthread_mutex_lock (&random_lock);\n+\n+  while (dest)\n+    {\n+      /* random_r10 (dest); */\n+      kiss = ((GFC_UINTEGER_8) kiss_random_kernel (kiss_seed_1)) << 32;\n+      kiss += kiss_random_kernel (kiss_seed_2);\n+      rnumber_10 (dest, kiss);\n+\n+      /* Advance to the next element.  */\n+      dest += stride0;\n+      count[0]++;\n+      /* Advance to the next source element.  */\n+      n = 0;\n+      while (count[n] == extent[n])\n+        {\n+          /* When we get to the end of a dimension, reset it and increment\n+             the next dimension.  */\n+          count[n] = 0;\n+          /* We could precalculate these products, but this is a less\n+             frequently used path so probably not worth it.  */\n+          dest -= stride[n] * extent[n];\n+          n++;\n+          if (n == dim)\n+            {\n+              dest = NULL;\n+              break;\n+            }\n+          else\n+            {\n+              count[n]++;\n+              dest += stride[n];\n+            }\n+        }\n+    }\n+  __gthread_mutex_unlock (&random_lock);\n+}\n+\n+#endif\n+\n+#ifdef HAVE_GFC_REAL_16\n+\n+/*  This function fills a REAL(16) array with values from the uniform\n+    distribution with range [0,1).  */\n+\n+void\n+arandom_r16 (gfc_array_r16 *x)\n+{\n+  index_type count[GFC_MAX_DIMENSIONS];\n+  index_type extent[GFC_MAX_DIMENSIONS];\n+  index_type stride[GFC_MAX_DIMENSIONS];\n+  index_type stride0;\n+  index_type dim;\n+  GFC_REAL_16 *dest;\n+  GFC_UINTEGER_8 kiss1, kiss2;\n+  int n;\n+\n+  dest = x->data;\n+\n+  dim = GFC_DESCRIPTOR_RANK (x);\n+\n+  for (n = 0; n < dim; n++)\n+    {\n+      count[n] = 0;\n+      stride[n] = x->dim[n].stride;\n+      extent[n] = x->dim[n].ubound + 1 - x->dim[n].lbound;\n+      if (extent[n] <= 0)\n+        return;\n+    }\n+\n+  stride0 = stride[0];\n+\n+  __gthread_mutex_lock (&random_lock);\n+\n+  while (dest)\n+    {\n+      /* random_r16 (dest); */\n+      kiss1 = ((GFC_UINTEGER_8) kiss_random_kernel (kiss_seed_1)) << 32;\n+      kiss1 += kiss_random_kernel (kiss_seed_2);\n+\n+      kiss2 = ((GFC_UINTEGER_8) kiss_random_kernel (kiss_seed_3)) << 32;\n+      kiss2 += kiss_random_kernel (kiss_seed_3);\n+\n+      rnumber_16 (dest, kiss1, kiss2);\n \n       /* Advance to the next element.  */\n       dest += stride0;\n@@ -309,6 +637,8 @@ arandom_r8 (gfc_array_r8 *x)\n   __gthread_mutex_unlock (&random_lock);\n }\n \n+#endif\n+\n /* random_seed is used to seed the PRNG with either a default\n    set of seeds or user specified set of seeds.  random_seed\n    must be called with no argument or exactly one argument.  */\n@@ -324,10 +654,10 @@ random_seed (GFC_INTEGER_4 *size, gfc_array_i4 *put, gfc_array_i4 *get)\n     {\n       /* From the standard: \"If no argument is present, the processor assigns\n          a processor-dependent value to the seed.\"  */\n-      kiss_seed[0] = kiss_default_seed[0];\n-      kiss_seed[1] = kiss_default_seed[1];\n-      kiss_seed[2] = kiss_default_seed[2];\n-      kiss_seed[3] = kiss_default_seed[3];\n+\n+      for (i=0; i<kiss_size; i++)\n+\tkiss_seed[i] = kiss_default_seed[i];\n+\n     }\n \n   if (size != NULL)\n@@ -345,7 +675,7 @@ random_seed (GFC_INTEGER_4 *size, gfc_array_i4 *put, gfc_array_i4 *get)\n \n       /*  This code now should do correct strides.  */\n       for (i = 0; i < kiss_size; i++)\n-        kiss_seed[i] =(GFC_UINTEGER_4) put->data[i * put->dim[0].stride];\n+\tkiss_seed[i] =(GFC_UINTEGER_4) put->data[i * put->dim[0].stride];\n     }\n \n   /* Return the seed to GET data.  */"}, {"sha": "4d27b65923340309630eb251f8421913f36b1080", "filename": "libgfortran/libgfortran.h", "status": "modified", "additions": 19, "deletions": 8, "changes": 27, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/cdc5524fc8255e6303ae90f3089e93998dc8a626/libgfortran%2Flibgfortran.h", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/cdc5524fc8255e6303ae90f3089e93998dc8a626/libgfortran%2Flibgfortran.h", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libgfortran%2Flibgfortran.h?ref=cdc5524fc8255e6303ae90f3089e93998dc8a626", "patch": "@@ -33,6 +33,7 @@ Boston, MA 02110-1301, USA.  */\n \n #include <math.h>\n #include <stddef.h>\n+#include <float.h>\n \n #ifndef M_PI\n #define M_PI 3.14159265358979323846264338327\n@@ -240,6 +241,24 @@ internal_proto(l8_to_l4_offset);\n #define GFC_REAL_16_HUGE LDBL_MAX\n #endif\n \n+#define GFC_REAL_4_DIGITS FLT_MANT_DIG\n+#define GFC_REAL_8_DIGITS DBL_MANT_DIG\n+#ifdef HAVE_GFC_REAL_10\n+#define GFC_REAL_10_DIGITS LDBL_MANT_DIG\n+#endif\n+#ifdef HAVE_GFC_REAL_16\n+#define GFC_REAL_16_DIGITS LDBL_MANT_DIG\n+#endif\n+\n+#define GFC_REAL_4_RADIX FLT_RADIX\n+#define GFC_REAL_8_RADIX FLT_RADIX\n+#ifdef HAVE_GFC_REAL_10\n+#define GFC_REAL_10_RADIX FLT_RADIX\n+#endif\n+#ifdef HAVE_GFC_REAL_16\n+#define GFC_REAL_16_RADIX FLT_RADIX\n+#endif\n+\n #ifndef GFC_MAX_DIMENSIONS\n #define GFC_MAX_DIMENSIONS 7\n #endif\n@@ -639,14 +658,6 @@ extern void random_seed (GFC_INTEGER_4 * size, gfc_array_i4 * put,\n \t\t\t gfc_array_i4 * get);\n iexport_proto(random_seed);\n \n-/* normalize.c */\n-\n-extern GFC_REAL_4 normalize_r4_i4 (GFC_UINTEGER_4, GFC_UINTEGER_4);\n-internal_proto(normalize_r4_i4);\n-\n-extern GFC_REAL_8 normalize_r8_i8 (GFC_UINTEGER_8, GFC_UINTEGER_8);\n-internal_proto(normalize_r8_i8);\n-\n /* size.c */\n \n typedef GFC_ARRAY_DESCRIPTOR (GFC_MAX_DIMENSIONS, void) array_t;"}, {"sha": "7bc90033ef39a7169424184f28edb851f240b4e8", "filename": "libgfortran/runtime/normalize.c", "status": "removed", "additions": 0, "deletions": 120, "changes": 120, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/a82f93ac13c4280fdf2b5d48648bfc3f7668406b/libgfortran%2Fruntime%2Fnormalize.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/a82f93ac13c4280fdf2b5d48648bfc3f7668406b/libgfortran%2Fruntime%2Fnormalize.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libgfortran%2Fruntime%2Fnormalize.c?ref=a82f93ac13c4280fdf2b5d48648bfc3f7668406b", "patch": "@@ -1,120 +0,0 @@\n-/* Nelper routines to convert from integer to real.\n-   Copyright 2004, 2005 Free Software Foundation, Inc.\n-   Contributed by Paul Brook.\n-\n-This file is part of the GNU Fortran 95 runtime library (libgfortran).\n-\n-Libgfortran is free software; you can redistribute it and/or\n-modify it under the terms of the GNU General Public\n-License as published by the Free Software Foundation; either\n-version 2 of the License, or (at your option) any later version.\n-\n-In addition to the permissions in the GNU General Public License, the\n-Free Software Foundation gives you unlimited permission to link the\n-compiled version of this file into combinations with other programs,\n-and to distribute those combinations without any restriction coming\n-from the use of this file.  (The General Public License restrictions\n-do apply in other respects; for example, they cover modification of\n-the file, and distribution when not linked into a combine\n-executable.)\n-\n-Ligbfortran is distributed in the hope that it will be useful,\n-but WITHOUT ANY WARRANTY; without even the implied warranty of\n-MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n-GNU General Public License for more details.\n-\n-You should have received a copy of the GNU General Public\n-License along with libgfortran; see the file COPYING.  If not,\n-write to the Free Software Foundation, Inc., 51 Franklin Street, Fifth Floor,\n-Boston, MA 02110-1301, USA.  */\n-#include <math.h>\n-#include \"libgfortran.h\"\n-\n-/* These routines can be sensitive to excess precision, so should really be\n-   compiled with -ffloat-store.  */\n-\n-/* Return the largest value less than one representable in a REAL*4.  */\n-\n-static inline GFC_REAL_4\n-almostone_r4 (void)\n-{\n-#ifdef HAVE_NEXTAFTERF\n-  return nextafterf (1.0f, 0.0f);\n-#else\n-  /* The volatile is a hack to prevent excess precision on x86.  */\n-  static volatile GFC_REAL_4 val = 0.0f;\n-  GFC_REAL_4 x;\n-\n-  if (val != 0.0f)\n-    return val;\n-\n-  val = 0.9999f;\n-  do\n-    {\n-      x = val;\n-      val = (val + 1.0f) / 2.0f;\n-    }\n-  while (val > x && val < 1.0f);\n-  if (val == 1.0f)\n-    val = x;\n-  return val;\n-#endif\n-}\n-\n-\n-/* Return the largest value less than one representable in a REAL*8.  */\n-\n-static inline GFC_REAL_8\n-almostone_r8 (void)\n-{\n-#ifdef HAVE_NEXTAFTER\n-  return nextafter (1.0, 0.0);\n-#else\n-  static volatile GFC_REAL_8 val = 0.0;\n-  GFC_REAL_8 x;\n-\n-  if (val != 0.0)\n-    return val;\n-\n-  val = 0.9999;\n-  do\n-    {\n-      x = val;\n-      val = (val + 1.0) / 2.0;\n-    }\n-  while (val > x && val < 1.0);\n-  if (val == 1.0)\n-    val = x;\n-  return val;\n-#endif\n-}\n-\n-\n-/* Convert an unsigned integer in the range [0..x] into a\n-   real the range [0..1).  */\n-\n-GFC_REAL_4\n-normalize_r4_i4 (GFC_UINTEGER_4 i, GFC_UINTEGER_4 x)\n-{\n-  GFC_REAL_4 r;\n-\n-  r = (GFC_REAL_4) i / (GFC_REAL_4) x;\n-  if (r == 1.0f)\n-    r = almostone_r4 ();\n-  return r;\n-}\n-\n-\n-/* Convert an unsigned integer in the range [0..x] into a\n-   real the range [0..1).  */\n-\n-GFC_REAL_8\n-normalize_r8_i8 (GFC_UINTEGER_8 i, GFC_UINTEGER_8 x)\n-{\n-  GFC_REAL_8 r;\n-\n-  r = (GFC_REAL_8) i / (GFC_REAL_8) x;\n-  if (r == 1.0)\n-    r = almostone_r8 ();\n-  return r;\n-}"}]}