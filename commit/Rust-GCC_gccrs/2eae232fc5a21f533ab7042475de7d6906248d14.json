{"sha": "2eae232fc5a21f533ab7042475de7d6906248d14", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6MmVhZTIzMmZjNWEyMWY1MzNhYjcwNDI0NzVkZTdkNjkwNjI0OGQxNA==", "commit": {"author": {"name": "Sandra Loosemore", "email": "sandra@codesourcery.com", "date": "2018-11-03T18:12:44Z"}, "committer": {"name": "Sandra Loosemore", "email": "sandra@gcc.gnu.org", "date": "2018-11-03T18:12:44Z"}, "message": "re PR target/87079 (nios2 optimization for size - case of regression relatively to 5.3.0)\n\n2018-11-03  Sandra Loosemore  <sandra@codesourcery.com>\n\n\tPR target/87079\n\n\tgcc/\n\t* config/nios2/nios2.c (nios2_rtx_costs): Recognize <mul>sidi3\n\tpattern.\n\n\tgcc/testsuite/\n\t* gcc.target/nios2/pr87079-1.c: New.\t\n\t* gcc.target/nios2/pr87079-2.c: New.\n\nFrom-SVN: r265770", "tree": {"sha": "9b27591c63fb419a97dfbeffca2b69a0eab218b8", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/9b27591c63fb419a97dfbeffca2b69a0eab218b8"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/2eae232fc5a21f533ab7042475de7d6906248d14", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/2eae232fc5a21f533ab7042475de7d6906248d14", "html_url": "https://github.com/Rust-GCC/gccrs/commit/2eae232fc5a21f533ab7042475de7d6906248d14", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/2eae232fc5a21f533ab7042475de7d6906248d14/comments", "author": {"login": "SandraLoosemore", "id": 104087111, "node_id": "U_kgDOBjQ-Rw", "avatar_url": "https://avatars.githubusercontent.com/u/104087111?v=4", "gravatar_id": "", "url": "https://api.github.com/users/SandraLoosemore", "html_url": "https://github.com/SandraLoosemore", "followers_url": "https://api.github.com/users/SandraLoosemore/followers", "following_url": "https://api.github.com/users/SandraLoosemore/following{/other_user}", "gists_url": "https://api.github.com/users/SandraLoosemore/gists{/gist_id}", "starred_url": "https://api.github.com/users/SandraLoosemore/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/SandraLoosemore/subscriptions", "organizations_url": "https://api.github.com/users/SandraLoosemore/orgs", "repos_url": "https://api.github.com/users/SandraLoosemore/repos", "events_url": "https://api.github.com/users/SandraLoosemore/events{/privacy}", "received_events_url": "https://api.github.com/users/SandraLoosemore/received_events", "type": "User", "site_admin": false}, "committer": null, "parents": [{"sha": "b15ed67b3d103397393ebf07c92b0b3188d191cd", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/b15ed67b3d103397393ebf07c92b0b3188d191cd", "html_url": "https://github.com/Rust-GCC/gccrs/commit/b15ed67b3d103397393ebf07c92b0b3188d191cd"}], "stats": {"total": 95, "additions": 95, "deletions": 0}, "files": [{"sha": "d10c48895d3459df7e245e425f83d8ad1d39f7fd", "filename": "gcc/ChangeLog", "status": "modified", "additions": 7, "deletions": 0, "changes": 7, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/2eae232fc5a21f533ab7042475de7d6906248d14/gcc%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/2eae232fc5a21f533ab7042475de7d6906248d14/gcc%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2FChangeLog?ref=2eae232fc5a21f533ab7042475de7d6906248d14", "patch": "@@ -1,3 +1,10 @@\n+2018-11-03  Sandra Loosemore  <sandra@codesourcery.com>\n+\n+\tPR target/87079\n+\n+\t* config/nios2/nios2.c (nios2_rtx_costs): Recognize <mul>sidi3\n+\tpattern.\n+\n 2018-11-02  Aaron Sawdey  <acsawdey@linux.ibm.com>\n \n \t* config/rs6000/rs6000-string.c (expand_strncmp_gpr_sequence): Pay"}, {"sha": "e266924cfdb417f9631d68c8b973e5f2f9af101b", "filename": "gcc/config/nios2/nios2.c", "status": "modified", "additions": 13, "deletions": 0, "changes": 13, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/2eae232fc5a21f533ab7042475de7d6906248d14/gcc%2Fconfig%2Fnios2%2Fnios2.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/2eae232fc5a21f533ab7042475de7d6906248d14/gcc%2Fconfig%2Fnios2%2Fnios2.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fconfig%2Fnios2%2Fnios2.c?ref=2eae232fc5a21f533ab7042475de7d6906248d14", "patch": "@@ -1539,6 +1539,19 @@ nios2_rtx_costs (rtx x, machine_mode mode,\n \t    *total = COSTS_N_INSNS (2);  /* Latency adjustment.  */\n \t  else \n \t    *total = COSTS_N_INSNS (1);\n+\t  if (TARGET_HAS_MULX && GET_MODE (x) == DImode)\n+\t    {\n+\t      enum rtx_code c0 = GET_CODE (XEXP (x, 0));\n+\t      enum rtx_code c1 = GET_CODE (XEXP (x, 1));\n+\t      if ((c0 == SIGN_EXTEND && c1 == SIGN_EXTEND)\n+\t\t  || (c0 == ZERO_EXTEND && c1 == ZERO_EXTEND))\n+\t\t/* This is the <mul>sidi3 pattern, which expands into 4 insns,\n+\t\t   2 multiplies and 2 moves.  */\n+\t\t{\n+\t\t  *total = *total * 2 + COSTS_N_INSNS (2);\n+\t\t  return true;\n+\t\t}\n+\t    }\n           return false;\n         }\n "}, {"sha": "e728c1f67506bc1919af88e4a5a6d248ede84c12", "filename": "gcc/testsuite/ChangeLog", "status": "modified", "additions": 7, "deletions": 0, "changes": 7, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/2eae232fc5a21f533ab7042475de7d6906248d14/gcc%2Ftestsuite%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/2eae232fc5a21f533ab7042475de7d6906248d14/gcc%2Ftestsuite%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2FChangeLog?ref=2eae232fc5a21f533ab7042475de7d6906248d14", "patch": "@@ -1,3 +1,10 @@\n+2018-11-03  Sandra Loosemore  <sandra@codesourcery.com>\n+\n+\tPR target/87079\n+\n+\t* gcc.target/nios2/pr87079-1.c: New.\t\n+\t* gcc.target/nios2/pr87079-2.c: New.\t\n+\n 2018-11-02  Rainer Orth  <ro@CeBiTec.Uni-Bielefeld.DE>\n \n \t* gcc.dg/compat/pr83487-1_y.c: Move dg-skip-if ..."}, {"sha": "67d5caad277b6be4986b86fc179696a2929d8fa4", "filename": "gcc/testsuite/gcc.target/nios2/pr87079-1.c", "status": "added", "additions": 34, "deletions": 0, "changes": 34, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/2eae232fc5a21f533ab7042475de7d6906248d14/gcc%2Ftestsuite%2Fgcc.target%2Fnios2%2Fpr87079-1.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/2eae232fc5a21f533ab7042475de7d6906248d14/gcc%2Ftestsuite%2Fgcc.target%2Fnios2%2Fpr87079-1.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgcc.target%2Fnios2%2Fpr87079-1.c?ref=2eae232fc5a21f533ab7042475de7d6906248d14", "patch": "@@ -0,0 +1,34 @@\n+/* { dg-do compile } */\n+/* { dg-options \"-Os -mhw-div -mhw-mul -mhw-mulx\" } */\n+\n+#include <stdint.h>\n+#include <stddef.h>\n+\n+void foo(const uint8_t* str, uint32_t* res)\n+{\n+  uint32_t rdVal0, rdVal1, rdVal2;\n+  rdVal0 = rdVal1 = rdVal2 = 0;\n+  unsigned c;\n+  for (;;) {\n+    c = *str++;\n+    unsigned dig = c - '0';\n+    if (dig > 9)\n+      break; // non-digit\n+    uint64_t x10;\n+\n+    x10 = (uint64_t)rdVal0*10 + dig;\n+    rdVal0 = (uint32_t)x10;\n+    dig = (uint32_t)(x10 >> 32);\n+\n+    x10 = (uint64_t)rdVal1*10 + dig;\n+    rdVal1 = (uint32_t)x10;\n+    dig = (uint32_t)(x10 >> 32);\n+\n+    rdVal2 = rdVal2*10 + dig;\n+  }\n+  res[0] = rdVal0;\n+  res[1] = rdVal1;\n+  res[2] = rdVal2;\n+}\n+\n+/* { dg-final { scan-assembler-times \"mulxuu\\t\" 2 } } */"}, {"sha": "db2100ad33d417bce50dec449f577994418f7484", "filename": "gcc/testsuite/gcc.target/nios2/pr87079-2.c", "status": "added", "additions": 34, "deletions": 0, "changes": 34, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/2eae232fc5a21f533ab7042475de7d6906248d14/gcc%2Ftestsuite%2Fgcc.target%2Fnios2%2Fpr87079-2.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/2eae232fc5a21f533ab7042475de7d6906248d14/gcc%2Ftestsuite%2Fgcc.target%2Fnios2%2Fpr87079-2.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgcc.target%2Fnios2%2Fpr87079-2.c?ref=2eae232fc5a21f533ab7042475de7d6906248d14", "patch": "@@ -0,0 +1,34 @@\n+/* { dg-do compile } */\n+/* { dg-options \"-O2 -mhw-div -mhw-mul -mhw-mulx\" } */\n+\n+#include <stdint.h>\n+#include <stddef.h>\n+\n+void foo(const uint8_t* str, uint32_t* res)\n+{\n+  uint32_t rdVal0, rdVal1, rdVal2;\n+  rdVal0 = rdVal1 = rdVal2 = 0;\n+  unsigned c;\n+  for (;;) {\n+    c = *str++;\n+    unsigned dig = c - '0';\n+    if (dig > 9)\n+      break; // non-digit\n+    uint64_t x10;\n+\n+    x10 = (uint64_t)rdVal0*10 + dig;\n+    rdVal0 = (uint32_t)x10;\n+    dig = (uint32_t)(x10 >> 32);\n+\n+    x10 = (uint64_t)rdVal1*10 + dig;\n+    rdVal1 = (uint32_t)x10;\n+    dig = (uint32_t)(x10 >> 32);\n+\n+    rdVal2 = rdVal2*10 + dig;\n+  }\n+  res[0] = rdVal0;\n+  res[1] = rdVal1;\n+  res[2] = rdVal2;\n+}\n+\n+/* { dg-final { scan-assembler-times \"mulxuu\\t\" 2 } } */"}]}