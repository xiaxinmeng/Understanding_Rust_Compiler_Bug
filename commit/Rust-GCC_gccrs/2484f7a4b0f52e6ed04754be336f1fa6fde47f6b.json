{"sha": "2484f7a4b0f52e6ed04754be336f1fa6fde47f6b", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6MjQ4NGY3YTRiMGY1MmU2ZWQwNDc1NGJlMzM2ZjFmYTZmZGU0N2Y2Yg==", "commit": {"author": {"name": "Segher Boessenkool", "email": "segher@kernel.crashing.org", "date": "2021-09-02T16:38:24Z"}, "committer": {"name": "Segher Boessenkool", "email": "segher@kernel.crashing.org", "date": "2021-09-03T21:04:23Z"}, "message": "rs6000: Don't use r12 for CR save on ELFv2 (PR102107)\n\nCR is saved and/or restored on some paths where GPR12 is already live\nsince it has a meaning in the calling convention in the ELFv2 ABI.\n\nIt is not completely clear to me that we can always use r11 here, but\nit does seem save, there is checking code (to detect conflicts here),\nand it is stage 1.  So here goes.\n\n2021-09-03  Segher Boessenkool <segher@kernel.crashing.org>\n\n\tPR target/102107\n\t* config/rs6000/rs6000-logue.c (rs6000_emit_prologue): On ELFv2 use r11\n\tinstead of r12 for CR save, in all cases.", "tree": {"sha": "81e221c51e4109e17eeea33f6498e3aba86eb05e", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/81e221c51e4109e17eeea33f6498e3aba86eb05e"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/2484f7a4b0f52e6ed04754be336f1fa6fde47f6b", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/2484f7a4b0f52e6ed04754be336f1fa6fde47f6b", "html_url": "https://github.com/Rust-GCC/gccrs/commit/2484f7a4b0f52e6ed04754be336f1fa6fde47f6b", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/2484f7a4b0f52e6ed04754be336f1fa6fde47f6b/comments", "author": {"login": "segher", "id": 417629, "node_id": "MDQ6VXNlcjQxNzYyOQ==", "avatar_url": "https://avatars.githubusercontent.com/u/417629?v=4", "gravatar_id": "", "url": "https://api.github.com/users/segher", "html_url": "https://github.com/segher", "followers_url": "https://api.github.com/users/segher/followers", "following_url": "https://api.github.com/users/segher/following{/other_user}", "gists_url": "https://api.github.com/users/segher/gists{/gist_id}", "starred_url": "https://api.github.com/users/segher/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/segher/subscriptions", "organizations_url": "https://api.github.com/users/segher/orgs", "repos_url": "https://api.github.com/users/segher/repos", "events_url": "https://api.github.com/users/segher/events{/privacy}", "received_events_url": "https://api.github.com/users/segher/received_events", "type": "User", "site_admin": false}, "committer": {"login": "segher", "id": 417629, "node_id": "MDQ6VXNlcjQxNzYyOQ==", "avatar_url": "https://avatars.githubusercontent.com/u/417629?v=4", "gravatar_id": "", "url": "https://api.github.com/users/segher", "html_url": "https://github.com/segher", "followers_url": "https://api.github.com/users/segher/followers", "following_url": "https://api.github.com/users/segher/following{/other_user}", "gists_url": "https://api.github.com/users/segher/gists{/gist_id}", "starred_url": "https://api.github.com/users/segher/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/segher/subscriptions", "organizations_url": "https://api.github.com/users/segher/orgs", "repos_url": "https://api.github.com/users/segher/repos", "events_url": "https://api.github.com/users/segher/events{/privacy}", "received_events_url": "https://api.github.com/users/segher/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "addf167a23f61c0ec97f6e71577a0623f3fc13e7", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/addf167a23f61c0ec97f6e71577a0623f3fc13e7", "html_url": "https://github.com/Rust-GCC/gccrs/commit/addf167a23f61c0ec97f6e71577a0623f3fc13e7"}], "stats": {"total": 11, "additions": 7, "deletions": 4}, "files": [{"sha": "e363d56ecec0cbfe7edf70baa2445f6ff1695a81", "filename": "gcc/config/rs6000/rs6000-logue.c", "status": "modified", "additions": 7, "deletions": 4, "changes": 11, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/2484f7a4b0f52e6ed04754be336f1fa6fde47f6b/gcc%2Fconfig%2Frs6000%2Frs6000-logue.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/2484f7a4b0f52e6ed04754be336f1fa6fde47f6b/gcc%2Fconfig%2Frs6000%2Frs6000-logue.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fconfig%2Frs6000%2Frs6000-logue.c?ref=2484f7a4b0f52e6ed04754be336f1fa6fde47f6b", "patch": "@@ -3293,10 +3293,13 @@ rs6000_emit_prologue (void)\n \n   /* If we need to save CR, put it into r12 or r11.  Choose r12 except when\n      r12 will be needed by out-of-line gpr save.  */\n-  cr_save_regno = ((DEFAULT_ABI == ABI_AIX || DEFAULT_ABI == ABI_ELFv2)\n-\t\t   && !(strategy & (SAVE_INLINE_GPRS\n-\t\t\t\t    | SAVE_NOINLINE_GPRS_SAVES_LR))\n-\t\t   ? 11 : 12);\n+  if (DEFAULT_ABI == ABI_AIX\n+      && !(strategy & (SAVE_INLINE_GPRS | SAVE_NOINLINE_GPRS_SAVES_LR)))\n+    cr_save_regno = 11;\n+  else if (DEFAULT_ABI == ABI_ELFv2)\n+    cr_save_regno = 11;\n+  else\n+    cr_save_regno = 12;\n   if (!WORLD_SAVE_P (info)\n       && info->cr_save_p\n       && REGNO (frame_reg_rtx) != cr_save_regno"}]}