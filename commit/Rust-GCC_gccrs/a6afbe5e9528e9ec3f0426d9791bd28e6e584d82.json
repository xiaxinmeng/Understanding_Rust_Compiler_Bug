{"sha": "a6afbe5e9528e9ec3f0426d9791bd28e6e584d82", "node_id": "C_kwDOANBUbNoAKGE2YWZiZTVlOTUyOGU5ZWMzZjA0MjZkOTc5MWJkMjhlNmU1ODRkODI", "commit": {"author": {"name": "Tobias Burnus", "email": "tobias@codesourcery.com", "date": "2022-07-29T10:36:07Z"}, "committer": {"name": "Tobias Burnus", "email": "tobias@codesourcery.com", "date": "2022-07-29T10:36:07Z"}, "message": "OpenMP/Fortran: Permit assumed-size arrays in uniform clause\n\ngcc/fortran/ChangeLog:\n\n\t* openmp.cc (resolve_omp_clauses): Permit assumed-size arrays\n\tin uniform clause.\n\ngcc/testsuite/ChangeLog:\n\n\t* gfortran.dg/gomp/declare-simd-3.f90: New test.", "tree": {"sha": "311d37453278d7c8cf766d156113b4cc3d2084ca", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/311d37453278d7c8cf766d156113b4cc3d2084ca"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/a6afbe5e9528e9ec3f0426d9791bd28e6e584d82", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/a6afbe5e9528e9ec3f0426d9791bd28e6e584d82", "html_url": "https://github.com/Rust-GCC/gccrs/commit/a6afbe5e9528e9ec3f0426d9791bd28e6e584d82", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/a6afbe5e9528e9ec3f0426d9791bd28e6e584d82/comments", "author": {"login": "tob2", "id": 264461, "node_id": "MDQ6VXNlcjI2NDQ2MQ==", "avatar_url": "https://avatars.githubusercontent.com/u/264461?v=4", "gravatar_id": "", "url": "https://api.github.com/users/tob2", "html_url": "https://github.com/tob2", "followers_url": "https://api.github.com/users/tob2/followers", "following_url": "https://api.github.com/users/tob2/following{/other_user}", "gists_url": "https://api.github.com/users/tob2/gists{/gist_id}", "starred_url": "https://api.github.com/users/tob2/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/tob2/subscriptions", "organizations_url": "https://api.github.com/users/tob2/orgs", "repos_url": "https://api.github.com/users/tob2/repos", "events_url": "https://api.github.com/users/tob2/events{/privacy}", "received_events_url": "https://api.github.com/users/tob2/received_events", "type": "User", "site_admin": false}, "committer": {"login": "tob2", "id": 264461, "node_id": "MDQ6VXNlcjI2NDQ2MQ==", "avatar_url": "https://avatars.githubusercontent.com/u/264461?v=4", "gravatar_id": "", "url": "https://api.github.com/users/tob2", "html_url": "https://github.com/tob2", "followers_url": "https://api.github.com/users/tob2/followers", "following_url": "https://api.github.com/users/tob2/following{/other_user}", "gists_url": "https://api.github.com/users/tob2/gists{/gist_id}", "starred_url": "https://api.github.com/users/tob2/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/tob2/subscriptions", "organizations_url": "https://api.github.com/users/tob2/orgs", "repos_url": "https://api.github.com/users/tob2/repos", "events_url": "https://api.github.com/users/tob2/events{/privacy}", "received_events_url": "https://api.github.com/users/tob2/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "49ba4fdeb648c149fa7d964ba812084262c3d06f", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/49ba4fdeb648c149fa7d964ba812084262c3d06f", "html_url": "https://github.com/Rust-GCC/gccrs/commit/49ba4fdeb648c149fa7d964ba812084262c3d06f"}], "stats": {"total": 33, "additions": 32, "deletions": 1}, "files": [{"sha": "a7eb6c3e8f42a8d0c40dea865802b23322feb54e", "filename": "gcc/fortran/openmp.cc", "status": "modified", "additions": 2, "deletions": 1, "changes": 3, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/a6afbe5e9528e9ec3f0426d9791bd28e6e584d82/gcc%2Ffortran%2Fopenmp.cc", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/a6afbe5e9528e9ec3f0426d9791bd28e6e584d82/gcc%2Ffortran%2Fopenmp.cc", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ffortran%2Fopenmp.cc?ref=a6afbe5e9528e9ec3f0426d9791bd28e6e584d82", "patch": "@@ -7386,7 +7386,8 @@ resolve_omp_clauses (gfc_code *code, gfc_omp_clauses *omp_clauses,\n \t\t\t|| code->op == EXEC_OACC_PARALLEL\n \t\t\t|| code->op == EXEC_OACC_SERIAL))\n \t\t  check_array_not_assumed (n->sym, n->where, name);\n-\t\telse if (n->sym->as && n->sym->as->type == AS_ASSUMED_SIZE)\n+\t\telse if (list != OMP_LIST_UNIFORM\n+\t\t\t && n->sym->as && n->sym->as->type == AS_ASSUMED_SIZE)\n \t\t  gfc_error (\"Assumed size array %qs in %s clause at %L\",\n \t\t\t     n->sym->name, name, &n->where);\n \t\tif (n->sym->attr.in_namelist && !is_reduction)"}, {"sha": "b94587ef35a1c041ae3018972b6627fb456c8d97", "filename": "gcc/testsuite/gfortran.dg/gomp/declare-simd-3.f90", "status": "added", "additions": 30, "deletions": 0, "changes": 30, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/a6afbe5e9528e9ec3f0426d9791bd28e6e584d82/gcc%2Ftestsuite%2Fgfortran.dg%2Fgomp%2Fdeclare-simd-3.f90", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/a6afbe5e9528e9ec3f0426d9791bd28e6e584d82/gcc%2Ftestsuite%2Fgfortran.dg%2Fgomp%2Fdeclare-simd-3.f90", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgfortran.dg%2Fgomp%2Fdeclare-simd-3.f90?ref=a6afbe5e9528e9ec3f0426d9791bd28e6e584d82", "patch": "@@ -0,0 +1,30 @@\n+! { dg-do compile }\n+\n+module m\n+  implicit none (type, external)\n+contains\n+  real function add(x, y, j) result(res)\n+    !$omp declare simd(add) uniform(x, y) linear(j : 1) simdlen(4)\n+    integer, value :: j\n+    real, intent(in) :: x(*), y(*)\n+    res = x(j) + y(j)\n+  end function\n+end module m\n+\n+program main\n+  use m\n+  implicit none (type, external)\n+  real, allocatable :: A(:), B(:), C(:)\n+  integer :: i, N\n+  N = 128\n+  A = [(3*i, i = 1, N)]\n+  B = [(7*i, i = 1, N)]\n+  allocate (C(N))\n+\n+  !$omp simd\n+  do i = 1, N\n+    C(i) = add(A, B, i)\n+  end do\n+\n+  if (any (C /= [(10*i, i = 1, N)])) error stop\n+end program main"}]}