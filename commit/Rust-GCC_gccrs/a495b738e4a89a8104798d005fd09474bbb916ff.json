{"sha": "a495b738e4a89a8104798d005fd09474bbb916ff", "node_id": "C_kwDOANBUbNoAKGE0OTViNzM4ZTRhODlhODEwNDc5OGQwMDVmZDA5NDc0YmJiOTE2ZmY", "commit": {"author": {"name": "Jonathan Wakely", "email": "jwakely@redhat.com", "date": "2023-03-22T21:54:24Z"}, "committer": {"name": "Jonathan Wakely", "email": "jwakely@redhat.com", "date": "2023-03-22T23:13:40Z"}, "message": "libstdc++: Fix assigning nullptr to std::atomic<shared_ptr<T>> (LWG 3893)\n\nLWG voted this to Tentatively Ready recently.\n\nlibstdc++-v3/ChangeLog:\n\n\t* include/bits/shared_ptr_atomic.h (atomic::operator=(nullptr_t)):\n\tAdd overload, as per LWG 3893.\n\t* testsuite/20_util/shared_ptr/atomic/atomic_shared_ptr.cc:\n\tCheck assignment from nullptr.", "tree": {"sha": "0bc1a5f1432c4f6c3ff07be78a3024efc912cb7d", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/0bc1a5f1432c4f6c3ff07be78a3024efc912cb7d"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/a495b738e4a89a8104798d005fd09474bbb916ff", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/a495b738e4a89a8104798d005fd09474bbb916ff", "html_url": "https://github.com/Rust-GCC/gccrs/commit/a495b738e4a89a8104798d005fd09474bbb916ff", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/a495b738e4a89a8104798d005fd09474bbb916ff/comments", "author": {"login": "jwakely", "id": 1254480, "node_id": "MDQ6VXNlcjEyNTQ0ODA=", "avatar_url": "https://avatars.githubusercontent.com/u/1254480?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jwakely", "html_url": "https://github.com/jwakely", "followers_url": "https://api.github.com/users/jwakely/followers", "following_url": "https://api.github.com/users/jwakely/following{/other_user}", "gists_url": "https://api.github.com/users/jwakely/gists{/gist_id}", "starred_url": "https://api.github.com/users/jwakely/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jwakely/subscriptions", "organizations_url": "https://api.github.com/users/jwakely/orgs", "repos_url": "https://api.github.com/users/jwakely/repos", "events_url": "https://api.github.com/users/jwakely/events{/privacy}", "received_events_url": "https://api.github.com/users/jwakely/received_events", "type": "User", "site_admin": false}, "committer": {"login": "jwakely", "id": 1254480, "node_id": "MDQ6VXNlcjEyNTQ0ODA=", "avatar_url": "https://avatars.githubusercontent.com/u/1254480?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jwakely", "html_url": "https://github.com/jwakely", "followers_url": "https://api.github.com/users/jwakely/followers", "following_url": "https://api.github.com/users/jwakely/following{/other_user}", "gists_url": "https://api.github.com/users/jwakely/gists{/gist_id}", "starred_url": "https://api.github.com/users/jwakely/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jwakely/subscriptions", "organizations_url": "https://api.github.com/users/jwakely/orgs", "repos_url": "https://api.github.com/users/jwakely/repos", "events_url": "https://api.github.com/users/jwakely/events{/privacy}", "received_events_url": "https://api.github.com/users/jwakely/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "6b2740946d26ffde7e1318f24bae00443ece387d", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/6b2740946d26ffde7e1318f24bae00443ece387d", "html_url": "https://github.com/Rust-GCC/gccrs/commit/6b2740946d26ffde7e1318f24bae00443ece387d"}], "stats": {"total": 15, "additions": 15, "deletions": 0}, "files": [{"sha": "2295b48e7326cbc4cc09b08c9d732e9965b51af8", "filename": "libstdc++-v3/include/bits/shared_ptr_atomic.h", "status": "modified", "additions": 6, "deletions": 0, "changes": 6, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/a495b738e4a89a8104798d005fd09474bbb916ff/libstdc%2B%2B-v3%2Finclude%2Fbits%2Fshared_ptr_atomic.h", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/a495b738e4a89a8104798d005fd09474bbb916ff/libstdc%2B%2B-v3%2Finclude%2Fbits%2Fshared_ptr_atomic.h", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libstdc%2B%2B-v3%2Finclude%2Fbits%2Fshared_ptr_atomic.h?ref=a495b738e4a89a8104798d005fd09474bbb916ff", "patch": "@@ -650,6 +650,12 @@ _GLIBCXX_BEGIN_NAMESPACE_VERSION\n       operator=(shared_ptr<_Tp> __desired) noexcept\n       { _M_impl.swap(__desired, memory_order_seq_cst); }\n \n+      // _GLIBCXX_RESOLVE_LIB_DEFECTS\n+      // 3893. LWG 3661 broke atomic<shared_ptr<T>> a; a = nullptr;\n+      void\n+      operator=(nullptr_t) noexcept\n+      { store(nullptr); }\n+\n       shared_ptr<_Tp>\n       exchange(shared_ptr<_Tp> __desired,\n \t       memory_order __o = memory_order_seq_cst) noexcept"}, {"sha": "54cf2621ea1d26ea3e9d7e1c977834306ea0ef0d", "filename": "libstdc++-v3/testsuite/20_util/shared_ptr/atomic/atomic_shared_ptr.cc", "status": "modified", "additions": 9, "deletions": 0, "changes": 9, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/a495b738e4a89a8104798d005fd09474bbb916ff/libstdc%2B%2B-v3%2Ftestsuite%2F20_util%2Fshared_ptr%2Fatomic%2Fatomic_shared_ptr.cc", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/a495b738e4a89a8104798d005fd09474bbb916ff/libstdc%2B%2B-v3%2Ftestsuite%2F20_util%2Fshared_ptr%2Fatomic%2Fatomic_shared_ptr.cc", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libstdc%2B%2B-v3%2Ftestsuite%2F20_util%2Fshared_ptr%2Fatomic%2Fatomic_shared_ptr.cc?ref=a495b738e4a89a8104798d005fd09474bbb916ff", "patch": "@@ -145,11 +145,20 @@ test_counting()\n   VERIFY( counter == 2 );\n }\n \n+void\n+test_lwg3893()\n+{\n+  // LWG 3893. LWG 3661 broke atomic<shared_ptr<T>> a; a = nullptr;\n+  std::atomic<std::shared_ptr<int>> a;\n+  a = nullptr;\n+}\n+\n int\n main()\n {\n   test_is_lock_free();\n   test_atomic_shared_ptr();\n   test_wait_notify();\n   test_counting();\n+  test_lwg3893();\n }"}]}