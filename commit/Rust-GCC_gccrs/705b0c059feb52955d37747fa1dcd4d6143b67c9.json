{"sha": "705b0c059feb52955d37747fa1dcd4d6143b67c9", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6NzA1YjBjMDU5ZmViNTI5NTVkMzc3NDdmYTFkY2Q0ZDYxNDNiNjdjOQ==", "commit": {"author": {"name": "Nathan Sidwell", "email": "nathan@acm.org", "date": "2018-10-31T15:03:04Z"}, "committer": {"name": "Nathan Sidwell", "email": "nathan@gcc.gnu.org", "date": "2018-10-31T15:03:04Z"}, "message": "[5/6] Preprocessor include\n\nhttps://gcc.gnu.org/ml/gcc-patches/2018-10/msg02041.html\n\t* directives.c (do_include_common): Commonize cleanup path.\n\t(_cpp_pop_buffer): Fix leak.\n\nFrom-SVN: r265690", "tree": {"sha": "a747fdfe3dc4d33b8ea1067a3d988a664aaaaeb8", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/a747fdfe3dc4d33b8ea1067a3d988a664aaaaeb8"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/705b0c059feb52955d37747fa1dcd4d6143b67c9", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/705b0c059feb52955d37747fa1dcd4d6143b67c9", "html_url": "https://github.com/Rust-GCC/gccrs/commit/705b0c059feb52955d37747fa1dcd4d6143b67c9", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/705b0c059feb52955d37747fa1dcd4d6143b67c9/comments", "author": {"login": "urnathan", "id": 13103001, "node_id": "MDQ6VXNlcjEzMTAzMDAx", "avatar_url": "https://avatars.githubusercontent.com/u/13103001?v=4", "gravatar_id": "", "url": "https://api.github.com/users/urnathan", "html_url": "https://github.com/urnathan", "followers_url": "https://api.github.com/users/urnathan/followers", "following_url": "https://api.github.com/users/urnathan/following{/other_user}", "gists_url": "https://api.github.com/users/urnathan/gists{/gist_id}", "starred_url": "https://api.github.com/users/urnathan/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/urnathan/subscriptions", "organizations_url": "https://api.github.com/users/urnathan/orgs", "repos_url": "https://api.github.com/users/urnathan/repos", "events_url": "https://api.github.com/users/urnathan/events{/privacy}", "received_events_url": "https://api.github.com/users/urnathan/received_events", "type": "User", "site_admin": false}, "committer": null, "parents": [{"sha": "87bacc2b392f48951491bf6454d7d6bcde127c90", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/87bacc2b392f48951491bf6454d7d6bcde127c90", "html_url": "https://github.com/Rust-GCC/gccrs/commit/87bacc2b392f48951491bf6454d7d6bcde127c90"}], "stats": {"total": 27, "additions": 13, "deletions": 14}, "files": [{"sha": "c5a0285b57f174eeb4a540fcdcea2db2e1a0cef2", "filename": "libcpp/ChangeLog", "status": "modified", "additions": 3, "deletions": 0, "changes": 3, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/705b0c059feb52955d37747fa1dcd4d6143b67c9/libcpp%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/705b0c059feb52955d37747fa1dcd4d6143b67c9/libcpp%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libcpp%2FChangeLog?ref=705b0c059feb52955d37747fa1dcd4d6143b67c9", "patch": "@@ -1,5 +1,8 @@\n 2018-10-31  Nathan Sidwell  <nathan@acm.org>\n \n+\t* directives.c (do_include_common): Commonize cleanup path.\n+\t(_cpp_pop_buffer): Fix leak.\n+\n \t* include/line-map.h (IS_ORDINARY_LOC, IS_MACRO_LOC): New\n \tpredicates.\n \t(IS_ADHOC_LOC): Move earlier."}, {"sha": "a76631d93663808b8ee6d9f66cbde9825265c20f", "filename": "libcpp/directives.c", "status": "modified", "additions": 10, "deletions": 14, "changes": 24, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/705b0c059feb52955d37747fa1dcd4d6143b67c9/libcpp%2Fdirectives.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/705b0c059feb52955d37747fa1dcd4d6143b67c9/libcpp%2Fdirectives.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libcpp%2Fdirectives.c?ref=705b0c059feb52955d37747fa1dcd4d6143b67c9", "patch": "@@ -822,22 +822,15 @@ do_include_common (cpp_reader *pfile, enum include_type type)\n \n   fname = parse_include (pfile, &angle_brackets, &buf, &location);\n   if (!fname)\n-    {\n-      if (buf)\n-\tXDELETEVEC (buf);\n-      return;\n-    }\n+    goto done;\n \n   if (!*fname)\n-  {\n-    cpp_error_with_line (pfile, CPP_DL_ERROR, location, 0,\n-\t\t\t \"empty filename in #%s\",\n-\t\t\t pfile->directive->name);\n-    XDELETEVEC (fname);\n-    if (buf)\n-      XDELETEVEC (buf);\n-    return;\n-  }\n+    {\n+      cpp_error_with_line (pfile, CPP_DL_ERROR, location, 0,\n+\t\t\t   \"empty filename in #%s\",\n+\t\t\t   pfile->directive->name);\n+      goto done;\n+    }\n \n   /* Prevent #include recursion.  */\n   if (pfile->line_table->depth >= CPP_STACK_MAX)\n@@ -855,6 +848,7 @@ do_include_common (cpp_reader *pfile, enum include_type type)\n       _cpp_stack_include (pfile, fname, angle_brackets, type, location);\n     }\n \n+ done:\n   XDELETEVEC (fname);\n   if (buf)\n     XDELETEVEC (buf);\n@@ -2613,6 +2607,8 @@ _cpp_pop_buffer (cpp_reader *pfile)\n \n       _cpp_do_file_change (pfile, LC_LEAVE, 0, 0, 0);\n     }\n+  else if (to_free)\n+    free ((void *)to_free);\n }\n \n /* Enter all recognized directives in the hash table.  */"}]}