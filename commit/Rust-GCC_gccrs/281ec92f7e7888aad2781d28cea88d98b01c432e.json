{"sha": "281ec92f7e7888aad2781d28cea88d98b01c432e", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6MjgxZWM5MmY3ZTc4ODhhYWQyNzgxZDI4Y2VhODhkOThiMDFjNDMyZQ==", "commit": {"author": {"name": "Richard Stallman", "email": "rms@gnu.org", "date": "1993-10-27T21:42:09Z"}, "committer": {"name": "Richard Stallman", "email": "rms@gnu.org", "date": "1993-10-27T21:42:09Z"}, "message": "(output_pending_init_elements): Don't crash if\nconstructor_unfilled_fields is 0.\n\n(build_c_cast): When making union constructor,\ncopy TREE_CONSTANT from the given value.\n(initializer_constant_valid_p): Special handling for \"constant\"\nunion constructor.\n\nFrom-SVN: r5921", "tree": {"sha": "0ce4a17ec5169721cb9ea1ab6898d915124e212d", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/0ce4a17ec5169721cb9ea1ab6898d915124e212d"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/281ec92f7e7888aad2781d28cea88d98b01c432e", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/281ec92f7e7888aad2781d28cea88d98b01c432e", "html_url": "https://github.com/Rust-GCC/gccrs/commit/281ec92f7e7888aad2781d28cea88d98b01c432e", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/281ec92f7e7888aad2781d28cea88d98b01c432e/comments", "author": null, "committer": null, "parents": [{"sha": "b73d04f2fd8deea3df7920e69710a7accfdca162", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/b73d04f2fd8deea3df7920e69710a7accfdca162", "html_url": "https://github.com/Rust-GCC/gccrs/commit/b73d04f2fd8deea3df7920e69710a7accfdca162"}], "stats": {"total": 19, "additions": 13, "deletions": 6}, "files": [{"sha": "11ed850db47970e0469a28a7e957d633def49fbb", "filename": "gcc/c-typeck.c", "status": "modified", "additions": 13, "deletions": 6, "changes": 19, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/281ec92f7e7888aad2781d28cea88d98b01c432e/gcc%2Fc-typeck.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/281ec92f7e7888aad2781d28cea88d98b01c432e/gcc%2Fc-typeck.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fc-typeck.c?ref=281ec92f7e7888aad2781d28cea88d98b01c432e", "patch": "@@ -3469,7 +3469,7 @@ build_c_cast (type, expr)\n       if (field)\n \t{\n \t  char *name;\n-\t  tree nvalue;\n+\t  tree t;\n \n \t  if (pedantic)\n \t    pedwarn (\"ANSI C forbids casts to union type\");\n@@ -3482,9 +3482,11 @@ build_c_cast (type, expr)\n \t    }\n \t  else\n \t    name = \"\";\n-\t  return digest_init (type, build (CONSTRUCTOR, type, NULL_TREE,\n-\t\t\t\t\t   build_tree_list (field, value)),\n-\t\t\t      0, 0);\n+\t  t = digest_init (type, build (CONSTRUCTOR, type, NULL_TREE,\n+\t\t\t\t\tbuild_tree_list (field, value)),\n+\t\t\t   0, 0);\n+\t  TREE_CONSTANT (t) = TREE_CONSTANT (value);\n+\t  return t;\n \t}\n       error (\"cast to union type from type not present in union\");\n       return error_mark_node;\n@@ -4033,6 +4035,10 @@ initializer_constant_valid_p (value, endtype)\n   switch (TREE_CODE (value))\n     {\n     case CONSTRUCTOR:\n+      if (TREE_CODE (TREE_TYPE (value)) == UNION_TYPE\n+\t  && TREE_CONSTANT (value))\n+\treturn initializer_constant_valid_p (TREE_VALUE (CONSTRUCTOR_ELTS (value)));\n+\t\n       return TREE_STATIC (value) ? null_pointer_node : 0;\n \n     case INTEGER_CST:\n@@ -5688,8 +5694,9 @@ output_pending_init_elements (all)\n \t\t\t\t   0);\n \t      goto retry;\n \t    }\n-\t  else if (tree_int_cst_lt (DECL_FIELD_BITPOS (TREE_PURPOSE (tail)),\n-\t\t\t\t    DECL_FIELD_BITPOS (constructor_unfilled_fields)))\n+\t  else if (constructor_unfilled_fields == 0\n+\t\t   || tree_int_cst_lt (DECL_FIELD_BITPOS (TREE_PURPOSE (tail)),\n+\t\t\t\t       DECL_FIELD_BITPOS (constructor_unfilled_fields)))\n \t    ;\n \t  else if (next == 0\n \t\t   || tree_int_cst_lt (DECL_FIELD_BITPOS (TREE_PURPOSE (tail)),"}]}