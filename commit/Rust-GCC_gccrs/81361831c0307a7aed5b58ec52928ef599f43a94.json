{"sha": "81361831c0307a7aed5b58ec52928ef599f43a94", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6ODEzNjE4MzFjMDMwN2E3YWVkNWI1OGVjNTI5MjhlZjU5OWY0M2E5NA==", "commit": {"author": {"name": "Martin Jambor", "email": "mjambor@suse.cz", "date": "2011-07-07T18:08:00Z"}, "committer": {"name": "Martin Jambor", "email": "jamborm@gcc.gnu.org", "date": "2011-07-07T18:08:00Z"}, "message": "re PR middle-end/49495 (-O3 causes error message \"edge points to wrong declaration:\")\n\n2011-07-07  Martin Jambor  <mjambor@suse.cz>\n\n\tPR middle-end/49495\n\t* cgraphunit.c (verify_edge_corresponds_to_fndecl): New function.\n\t(verify_cgraph_node): Some functinality moved to\n\tverify_edge_corresponds_to_fndecl, call it.\n\nFrom-SVN: r175998", "tree": {"sha": "8159ccb5866dbd028e5b0afeb4995c90cc5024a0", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/8159ccb5866dbd028e5b0afeb4995c90cc5024a0"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/81361831c0307a7aed5b58ec52928ef599f43a94", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/81361831c0307a7aed5b58ec52928ef599f43a94", "html_url": "https://github.com/Rust-GCC/gccrs/commit/81361831c0307a7aed5b58ec52928ef599f43a94", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/81361831c0307a7aed5b58ec52928ef599f43a94/comments", "author": {"login": "jamborm", "id": 2180070, "node_id": "MDQ6VXNlcjIxODAwNzA=", "avatar_url": "https://avatars.githubusercontent.com/u/2180070?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jamborm", "html_url": "https://github.com/jamborm", "followers_url": "https://api.github.com/users/jamborm/followers", "following_url": "https://api.github.com/users/jamborm/following{/other_user}", "gists_url": "https://api.github.com/users/jamborm/gists{/gist_id}", "starred_url": "https://api.github.com/users/jamborm/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jamborm/subscriptions", "organizations_url": "https://api.github.com/users/jamborm/orgs", "repos_url": "https://api.github.com/users/jamborm/repos", "events_url": "https://api.github.com/users/jamborm/events{/privacy}", "received_events_url": "https://api.github.com/users/jamborm/received_events", "type": "User", "site_admin": false}, "committer": null, "parents": [{"sha": "1797adbd71ae2b421f741840fe24baf4640ea6fa", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/1797adbd71ae2b421f741840fe24baf4640ea6fa", "html_url": "https://github.com/Rust-GCC/gccrs/commit/1797adbd71ae2b421f741840fe24baf4640ea6fa"}], "stats": {"total": 41, "additions": 30, "deletions": 11}, "files": [{"sha": "dbeb8e68cd6a55a9b409a8afd4f8006623d78e6a", "filename": "gcc/ChangeLog", "status": "modified", "additions": 7, "deletions": 0, "changes": 7, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/81361831c0307a7aed5b58ec52928ef599f43a94/gcc%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/81361831c0307a7aed5b58ec52928ef599f43a94/gcc%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2FChangeLog?ref=81361831c0307a7aed5b58ec52928ef599f43a94", "patch": "@@ -1,3 +1,10 @@\n+2011-07-07  Martin Jambor  <mjambor@suse.cz>\n+\n+\tPR middle-end/49495\n+\t* cgraphunit.c (verify_edge_corresponds_to_fndecl): New function.\n+\t(verify_cgraph_node): Some functinality moved to\n+\tverify_edge_corresponds_to_fndecl, call it.\n+\n 2011-07-07  Joseph Myers  <joseph@codesourcery.com>\n \n \t* config.gcc (*local*): Remove."}, {"sha": "2414d86695f3a1d7e160d45a243b73ba2384b448", "filename": "gcc/cgraphunit.c", "status": "modified", "additions": 23, "deletions": 11, "changes": 34, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/81361831c0307a7aed5b58ec52928ef599f43a94/gcc%2Fcgraphunit.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/81361831c0307a7aed5b58ec52928ef599f43a94/gcc%2Fcgraphunit.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fcgraphunit.c?ref=81361831c0307a7aed5b58ec52928ef599f43a94", "patch": "@@ -450,6 +450,28 @@ cgraph_debug_gimple_stmt (struct function *this_cfun, gimple stmt)\n   debug_gimple_stmt (stmt);\n }\n \n+/* Verify that call graph edge E corresponds to DECL from the associated\n+   statement.  Return true if the verification should fail.  */\n+\n+static bool\n+verify_edge_corresponds_to_fndecl (struct cgraph_edge *e, tree decl)\n+{\n+  if (!e->callee->global.inlined_to\n+      && decl\n+      && cgraph_get_node (decl)\n+      && (e->callee->former_clone_of\n+\t  != cgraph_function_or_thunk_node (cgraph_get_node (decl), NULL)->decl)\n+      /* IPA-CP sometimes redirect edge to clone and then back to the former\n+\t function.  This ping-pong has to go, eventaully.  */\n+      && (cgraph_function_or_thunk_node (cgraph_get_node (decl), NULL)\n+\t  != cgraph_function_or_thunk_node (e->callee, NULL))\n+      && !clone_of_p (cgraph_get_node (decl),\n+\t\t      e->callee))\n+    return true;\n+  else\n+    return false;\n+}\n+\n /* Verify cgraph nodes of given cgraph node.  */\n DEBUG_FUNCTION void\n verify_cgraph_node (struct cgraph_node *node)\n@@ -702,17 +724,7 @@ verify_cgraph_node (struct cgraph_node *node)\n \t\t\t  }\n \t\t\tif (!e->indirect_unknown_callee)\n \t\t\t  {\n-\t\t\t    if (!e->callee->global.inlined_to\n-\t\t\t        && decl\n-\t\t\t        && cgraph_get_node (decl)\n-\t\t\t        && (e->callee->former_clone_of\n-\t\t\t\t    != cgraph_get_node (decl)->decl)\n-\t\t\t\t/* IPA-CP sometimes redirect edge to clone and then back to the former\n-\t\t\t\t   function.  This ping-pong has to go, eventaully.  */\n-\t\t\t\t&& (cgraph_function_or_thunk_node (cgraph_get_node (decl), NULL)\n-\t\t\t\t    != cgraph_function_or_thunk_node (e->callee, NULL))\n-\t\t\t\t&& !clone_of_p (cgraph_get_node (decl),\n-\t\t\t\t\t        e->callee))\n+\t\t\t    if (verify_edge_corresponds_to_fndecl (e, decl))\n \t\t\t      {\n \t\t\t\terror (\"edge points to wrong declaration:\");\n \t\t\t\tdebug_tree (e->callee->decl);"}]}