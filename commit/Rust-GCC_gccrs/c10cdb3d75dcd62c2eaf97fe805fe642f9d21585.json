{"sha": "c10cdb3d75dcd62c2eaf97fe805fe642f9d21585", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6YzEwY2RiM2Q3NWRjZDYyYzJlYWY5N2ZlODA1ZmU2NDJmOWQyMTU4NQ==", "commit": {"author": {"name": "Mark Mitchell", "email": "mark@codesourcery.com", "date": "2003-01-07T02:38:32Z"}, "committer": {"name": "Mark Mitchell", "email": "mmitchel@gcc.gnu.org", "date": "2003-01-07T02:38:32Z"}, "message": "re PR c++/9165 (false \"defined but not used\" warnings)\n\n\tPR c++/9165\n\t* decl2.c (build_cleanup): Mark the object as used.\n\n\tPR c++/9165\n\t* g++.dg/warn/Wunused-3.C: New test.\n\nFrom-SVN: r60972", "tree": {"sha": "a93ea5a939facd41940dce73c3b3ff15a67d5079", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/a93ea5a939facd41940dce73c3b3ff15a67d5079"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/c10cdb3d75dcd62c2eaf97fe805fe642f9d21585", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/c10cdb3d75dcd62c2eaf97fe805fe642f9d21585", "html_url": "https://github.com/Rust-GCC/gccrs/commit/c10cdb3d75dcd62c2eaf97fe805fe642f9d21585", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/c10cdb3d75dcd62c2eaf97fe805fe642f9d21585/comments", "author": null, "committer": null, "parents": [{"sha": "69f794a7090bf4bc4c0d902def487e2fb5c37ebc", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/69f794a7090bf4bc4c0d902def487e2fb5c37ebc", "html_url": "https://github.com/Rust-GCC/gccrs/commit/69f794a7090bf4bc4c0d902def487e2fb5c37ebc"}], "stats": {"total": 31, "additions": 30, "deletions": 1}, "files": [{"sha": "2ebbbf72f9c536569b8dffeb377d52babf6d3caa", "filename": "gcc/cp/ChangeLog", "status": "modified", "additions": 3, "deletions": 0, "changes": 3, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/c10cdb3d75dcd62c2eaf97fe805fe642f9d21585/gcc%2Fcp%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/c10cdb3d75dcd62c2eaf97fe805fe642f9d21585/gcc%2Fcp%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fcp%2FChangeLog?ref=c10cdb3d75dcd62c2eaf97fe805fe642f9d21585", "patch": "@@ -1,5 +1,8 @@\n 2003-01-06  Mark Mitchell  <mark@codesourcery.com>\n \n+\tPR c++/9165\n+\t* decl2.c (build_cleanup): Mark the object as used.\n+\n \t* pt.c (retrieve_local_specialization): Revert 2003-01-05 change.\n \t(hash_local_specialization): New function.\n \t(register_local_specialization): Revert 2003-01-05 change."}, {"sha": "6363007b4ef466c34213783fb04ae1143c059c02", "filename": "gcc/cp/decl2.c", "status": "modified", "additions": 12, "deletions": 0, "changes": 12, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/c10cdb3d75dcd62c2eaf97fe805fe642f9d21585/gcc%2Fcp%2Fdecl2.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/c10cdb3d75dcd62c2eaf97fe805fe642f9d21585/gcc%2Fcp%2Fdecl2.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fcp%2Fdecl2.c?ref=c10cdb3d75dcd62c2eaf97fe805fe642f9d21585", "patch": "@@ -1865,12 +1865,24 @@ import_export_tinfo (tree decl, tree type, bool is_in_library)\n   DECL_INTERFACE_KNOWN (decl) = 1;\n }\n \n+/* Return an expression that performs the destruction of DECL, which\n+   must be a VAR_DECL whose type has a non-trivial destructor, or is\n+   an array whose (innermost) elements have a non-trivial destructor.  */\n+\n tree\n build_cleanup (tree decl)\n {\n   tree temp;\n   tree type = TREE_TYPE (decl);\n \n+  /* This function should only be called for declarations that really\n+     require cleanups.  */\n+  my_friendly_assert (!TYPE_HAS_TRIVIAL_DESTRUCTOR (type), 20030106);\n+\n+  /* Treat all objects with destructors as used; the destructor may do\n+     something substantive.  */\n+  mark_used (decl);\n+\n   if (TREE_CODE (type) == ARRAY_TYPE)\n     temp = decl;\n   else"}, {"sha": "2ae706048873ad06f5bb2b3857d49c1d3688655f", "filename": "gcc/testsuite/ChangeLog", "status": "modified", "additions": 4, "deletions": 1, "changes": 5, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/c10cdb3d75dcd62c2eaf97fe805fe642f9d21585/gcc%2Ftestsuite%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/c10cdb3d75dcd62c2eaf97fe805fe642f9d21585/gcc%2Ftestsuite%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2FChangeLog?ref=c10cdb3d75dcd62c2eaf97fe805fe642f9d21585", "patch": "@@ -1,6 +1,9 @@\n 2003-01-06  Mark Mitchell  <mark@codesourcery.com>\n \n-\t* testsuite/g++.dg/abi/bitfield9.C: New test.\n+\tPR c++/9165\n+\t* g++.dg/warn/Wunused-3.C: New test.\n+\n+\t* g++.dg/abi/bitfield9.C: New test.\n \n \tPR c++/9189\n \t* g++.dg/parse/defarg3.C: New test."}, {"sha": "31009094352b39042218c9339b021abcc2a4d547", "filename": "gcc/testsuite/g++.dg/warn/Wunused-3.C", "status": "added", "additions": 11, "deletions": 0, "changes": 11, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/c10cdb3d75dcd62c2eaf97fe805fe642f9d21585/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Fwarn%2FWunused-3.C", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/c10cdb3d75dcd62c2eaf97fe805fe642f9d21585/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Fwarn%2FWunused-3.C", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Fwarn%2FWunused-3.C?ref=c10cdb3d75dcd62c2eaf97fe805fe642f9d21585", "patch": "@@ -0,0 +1,11 @@\n+// { dg-do compile }\n+// { dg-options \"-Wunused -O\" }\n+\n+void do_cleanups();\n+\n+class Cleanup {\n+public:\n+    ~Cleanup() { do_cleanups();}\n+};\n+\n+static Cleanup dummy;"}]}