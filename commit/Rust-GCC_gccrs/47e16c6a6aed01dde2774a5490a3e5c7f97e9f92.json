{"sha": "47e16c6a6aed01dde2774a5490a3e5c7f97e9f92", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6NDdlMTZjNmE2YWVkMDFkZGUyNzc0YTU0OTBhM2U1YzdmOTdlOWY5Mg==", "commit": {"author": {"name": "Bernd Schmidt", "email": "bernds@redhat.com", "date": "2015-12-03T14:17:35Z"}, "committer": {"name": "Bernd Schmidt", "email": "bernds@gcc.gnu.org", "date": "2015-12-03T14:17:35Z"}, "message": "Fix some issues with the ROP patch (PR 68471, 68472)\n\n\tPR target/68471\n\tPR target/68472\n\t* config/i386/i386.c (ix86_mitigate_rop): Don't call\n\tcompute_bb_for_insn again.  Call df_insn_rescan_all.\n\t* config/i386/i386.md (set_got_rex64): Override modrm_class.\n\n\t* regrename.c (build_def_use): Ignore stack regs if regstack_completed.\n\ntestsuite/\n\t* gcc.target/i386/rop1.c: New test.\n\nFrom-SVN: r231228", "tree": {"sha": "1a704a39609e4dd7faea72ad422cfe306701f3fa", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/1a704a39609e4dd7faea72ad422cfe306701f3fa"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/47e16c6a6aed01dde2774a5490a3e5c7f97e9f92", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/47e16c6a6aed01dde2774a5490a3e5c7f97e9f92", "html_url": "https://github.com/Rust-GCC/gccrs/commit/47e16c6a6aed01dde2774a5490a3e5c7f97e9f92", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/47e16c6a6aed01dde2774a5490a3e5c7f97e9f92/comments", "author": null, "committer": null, "parents": [{"sha": "9a863523b43ee0ddbfbbb4ce82edc577b6f372de", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/9a863523b43ee0ddbfbbb4ce82edc577b6f372de", "html_url": "https://github.com/Rust-GCC/gccrs/commit/9a863523b43ee0ddbfbbb4ce82edc577b6f372de"}], "stats": {"total": 25, "additions": 24, "deletions": 1}, "files": [{"sha": "6e9c823d3aa4ee0679bbf95b1680a23af276fe03", "filename": "gcc/ChangeLog", "status": "modified", "additions": 10, "deletions": 0, "changes": 10, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/47e16c6a6aed01dde2774a5490a3e5c7f97e9f92/gcc%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/47e16c6a6aed01dde2774a5490a3e5c7f97e9f92/gcc%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2FChangeLog?ref=47e16c6a6aed01dde2774a5490a3e5c7f97e9f92", "patch": "@@ -1,3 +1,13 @@\n+2015-12-03  Bernd Schmidt  <bschmidt@redhat.com>\n+\n+\tPR target/68471\n+\tPR target/68472\n+\t* config/i386/i386.c (ix86_mitigate_rop): Don't call\n+\tcompute_bb_for_insn again.  Call df_insn_rescan_all.\n+\t* config/i386/i386.md (set_got_rex64): Override modrm_class.\n+\n+\t* regrename.c (build_def_use): Ignore stack regs if regstack_completed.\n+\n 2015-12-03  Nathan Sidwell  <nathan@acm.org>\n \n \t* config/nvptx/nvptx-protos.h (npvptx_section_from_addr_space):\tDelete."}, {"sha": "96d6c98d93559fe88e35d06c97822c7125c2a0dd", "filename": "gcc/config/i386/i386.c", "status": "modified", "additions": 2, "deletions": 1, "changes": 3, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/47e16c6a6aed01dde2774a5490a3e5c7f97e9f92/gcc%2Fconfig%2Fi386%2Fi386.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/47e16c6a6aed01dde2774a5490a3e5c7f97e9f92/gcc%2Fconfig%2Fi386%2Fi386.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fconfig%2Fi386%2Fi386.c?ref=47e16c6a6aed01dde2774a5490a3e5c7f97e9f92", "patch": "@@ -45267,8 +45267,9 @@ ix86_mitigate_rop (void)\n   COPY_HARD_REG_SET (inout_risky, input_risky);\n   IOR_HARD_REG_SET (inout_risky, output_risky);\n \n-  compute_bb_for_insn ();\n   df_note_add_problem ();\n+  /* Fix up what stack-regs did.  */\n+  df_insn_rescan_all ();\n   df_analyze ();\n \n   regrename_init (true);"}, {"sha": "f2b20412137e9f19f275fdec347cd6a87f0ec33e", "filename": "gcc/config/i386/i386.md", "status": "modified", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/47e16c6a6aed01dde2774a5490a3e5c7f97e9f92/gcc%2Fconfig%2Fi386%2Fi386.md", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/47e16c6a6aed01dde2774a5490a3e5c7f97e9f92/gcc%2Fconfig%2Fi386%2Fi386.md", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fconfig%2Fi386%2Fi386.md?ref=47e16c6a6aed01dde2774a5490a3e5c7f97e9f92", "patch": "@@ -12421,6 +12421,7 @@\n   \"lea{q}\\t{_GLOBAL_OFFSET_TABLE_(%%rip), %0|%0, _GLOBAL_OFFSET_TABLE_[rip]}\"\n   [(set_attr \"type\" \"lea\")\n    (set_attr \"length_address\" \"4\")\n+   (set_attr \"modrm_class\" \"unknown\")\n    (set_attr \"mode\" \"DI\")])\n \n (define_insn \"set_rip_rex64\""}, {"sha": "701e0789955eddad289468dcb7269d34328725dd", "filename": "gcc/regrename.c", "status": "modified", "additions": 6, "deletions": 0, "changes": 6, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/47e16c6a6aed01dde2774a5490a3e5c7f97e9f92/gcc%2Fregrename.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/47e16c6a6aed01dde2774a5490a3e5c7f97e9f92/gcc%2Fregrename.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fregrename.c?ref=47e16c6a6aed01dde2774a5490a3e5c7f97e9f92", "patch": "@@ -1677,6 +1677,12 @@ build_def_use (basic_block bb)\n \t\t      untracked_operands |= 1 << matches;\n \t\t    }\n \t\t}\n+#ifdef STACK_REGS\n+\t      if (regstack_completed\n+\t\t  && REG_P (op)\n+\t\t  && IN_RANGE (REGNO (op), FIRST_STACK_REG, LAST_STACK_REG))\n+\t\tuntracked_operands |= 1 << i;\n+#endif\n \t      /* If there's an in-out operand with a register that is not\n \t\t being tracked at all yet, open a chain.  */\n \t      if (recog_data.operand_type[i] == OP_INOUT"}, {"sha": "9cbd390a803df77359c9ac0d73b7aa26d6a21fef", "filename": "gcc/testsuite/ChangeLog", "status": "modified", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/47e16c6a6aed01dde2774a5490a3e5c7f97e9f92/gcc%2Ftestsuite%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/47e16c6a6aed01dde2774a5490a3e5c7f97e9f92/gcc%2Ftestsuite%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2FChangeLog?ref=47e16c6a6aed01dde2774a5490a3e5c7f97e9f92", "patch": "@@ -1,3 +1,8 @@\n+2015-12-03  Bernd Schmidt  <bschmidt@redhat.com>\n+\n+\tPR target/68472\n+\t* gcc.target/i386/rop1.c: New test.\n+\n 2015-12-03  Nathan Sidwell  <nathan@acm.org>\n \n \t* gcc.target/nvptx/decl.c: New."}]}