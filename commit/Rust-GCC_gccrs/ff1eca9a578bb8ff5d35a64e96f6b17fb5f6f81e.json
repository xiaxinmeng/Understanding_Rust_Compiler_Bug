{"sha": "ff1eca9a578bb8ff5d35a64e96f6b17fb5f6f81e", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6ZmYxZWNhOWE1NzhiYjhmZjVkMzVhNjRlOTZmNmIxN2ZiNWY2ZjgxZQ==", "commit": {"author": {"name": "CohenArthur", "email": "arthur.cohen@epita.fr", "date": "2021-03-29T19:08:21Z"}, "committer": {"name": "GitHub", "email": "noreply@github.com", "date": "2021-03-29T19:08:21Z"}, "message": "Fix infinite loop when expanding cfg attributes (#319)\n\nrust-macro-expand: Fix infinite loop in cfg_attr expansion\r\n\r\nExpanding the cfg_attrs wasn't incrementing the index at which to access\r\nthe attribute to expand, so the compiler was stuck in expanding the same\r\nattribute over and over again in some cases.\r\n\r\nFixes #320", "tree": {"sha": "498202910e11fd250591dd590b5cb1149d1dc200", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/498202910e11fd250591dd590b5cb1149d1dc200"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/ff1eca9a578bb8ff5d35a64e96f6b17fb5f6f81e", "comment_count": 0, "verification": {"verified": true, "reason": "valid", "signature": "-----BEGIN PGP SIGNATURE-----\n\nwsBcBAABCAAQBQJgYiWlCRBK7hj4Ov3rIwAAdHIIAGA7sNU5q1H+ZtiHo8PHeQ4F\nO+0zsrIrkq5zxP4F/MgwroFSKT94u1KsjIu8/XuzvTSEqUnrxRWdZ6BTHKitw4pZ\nf1foc4FyW550TgSMgmskl/0Q/ihQQZBDJ4RrYcyT9I5azTgK5M+tBXuow/r6R+MM\n+0KBOwtupWXvvI0ERhPXd0tu5zr65cPdUI9brh+M5gHayi0CCVEbUqOUKKevQklT\nqx/fcFKS5JiCoPDZn5wO/Oz6oxe8cMSizRBQ0+Tu2OQpBj+YFyscHFmsa6P3TrEZ\ncsDN82L80udNR4uy+eRiCIzIME8A6qWlC6kuJrWucUo6mQUrhuw6LoxJ3QT84Js=\n=yuZL\n-----END PGP SIGNATURE-----\n", "payload": "tree 498202910e11fd250591dd590b5cb1149d1dc200\nparent 099fcbd107ad6139de2c387c62327d0d189a5261\nauthor CohenArthur <arthur.cohen@epita.fr> 1617044901 +0200\ncommitter GitHub <noreply@github.com> 1617044901 +0100\n\nFix infinite loop when expanding cfg attributes (#319)\n\nrust-macro-expand: Fix infinite loop in cfg_attr expansion\r\n\r\nExpanding the cfg_attrs wasn't incrementing the index at which to access\r\nthe attribute to expand, so the compiler was stuck in expanding the same\r\nattribute over and over again in some cases.\r\n\r\nFixes #320 "}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/ff1eca9a578bb8ff5d35a64e96f6b17fb5f6f81e", "html_url": "https://github.com/Rust-GCC/gccrs/commit/ff1eca9a578bb8ff5d35a64e96f6b17fb5f6f81e", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/ff1eca9a578bb8ff5d35a64e96f6b17fb5f6f81e/comments", "author": {"login": "CohenArthur", "id": 43524065, "node_id": "MDQ6VXNlcjQzNTI0MDY1", "avatar_url": "https://avatars.githubusercontent.com/u/43524065?v=4", "gravatar_id": "", "url": "https://api.github.com/users/CohenArthur", "html_url": "https://github.com/CohenArthur", "followers_url": "https://api.github.com/users/CohenArthur/followers", "following_url": "https://api.github.com/users/CohenArthur/following{/other_user}", "gists_url": "https://api.github.com/users/CohenArthur/gists{/gist_id}", "starred_url": "https://api.github.com/users/CohenArthur/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/CohenArthur/subscriptions", "organizations_url": "https://api.github.com/users/CohenArthur/orgs", "repos_url": "https://api.github.com/users/CohenArthur/repos", "events_url": "https://api.github.com/users/CohenArthur/events{/privacy}", "received_events_url": "https://api.github.com/users/CohenArthur/received_events", "type": "User", "site_admin": false}, "committer": {"login": "web-flow", "id": 19864447, "node_id": "MDQ6VXNlcjE5ODY0NDQ3", "avatar_url": "https://avatars.githubusercontent.com/u/19864447?v=4", "gravatar_id": "", "url": "https://api.github.com/users/web-flow", "html_url": "https://github.com/web-flow", "followers_url": "https://api.github.com/users/web-flow/followers", "following_url": "https://api.github.com/users/web-flow/following{/other_user}", "gists_url": "https://api.github.com/users/web-flow/gists{/gist_id}", "starred_url": "https://api.github.com/users/web-flow/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/web-flow/subscriptions", "organizations_url": "https://api.github.com/users/web-flow/orgs", "repos_url": "https://api.github.com/users/web-flow/repos", "events_url": "https://api.github.com/users/web-flow/events{/privacy}", "received_events_url": "https://api.github.com/users/web-flow/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "099fcbd107ad6139de2c387c62327d0d189a5261", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/099fcbd107ad6139de2c387c62327d0d189a5261", "html_url": "https://github.com/Rust-GCC/gccrs/commit/099fcbd107ad6139de2c387c62327d0d189a5261"}], "stats": {"total": 9, "additions": 8, "deletions": 1}, "files": [{"sha": "496b451bb8024c0893e3f692c79ea277b4325f65", "filename": "gcc/rust/expand/rust-macro-expand.cc", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/ff1eca9a578bb8ff5d35a64e96f6b17fb5f6f81e/gcc%2Frust%2Fexpand%2Frust-macro-expand.cc", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/ff1eca9a578bb8ff5d35a64e96f6b17fb5f6f81e/gcc%2Frust%2Fexpand%2Frust-macro-expand.cc", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Frust%2Fexpand%2Frust-macro-expand.cc?ref=ff1eca9a578bb8ff5d35a64e96f6b17fb5f6f81e", "patch": "@@ -3330,7 +3330,7 @@ MacroExpander::fails_cfg_with_expand (std::vector<AST::Attribute> &attrs) const\n void\n MacroExpander::expand_cfg_attrs (std::vector<AST::Attribute> &attrs)\n {\n-  for (std::size_t i = 0; i < attrs.size ();)\n+  for (std::size_t i = 0; i < attrs.size (); i++)\n     {\n       auto &attr = attrs[i];\n       if (attr.get_path () == \"cfg_attr\")"}, {"sha": "95e636befe21772a7163f1fdfa1a844283f1ed16", "filename": "gcc/testsuite/rust.test/xfail_compile/cfg_attr.rs", "status": "added", "additions": 7, "deletions": 0, "changes": 7, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/ff1eca9a578bb8ff5d35a64e96f6b17fb5f6f81e/gcc%2Ftestsuite%2Frust.test%2Fxfail_compile%2Fcfg_attr.rs", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/ff1eca9a578bb8ff5d35a64e96f6b17fb5f6f81e/gcc%2Ftestsuite%2Frust.test%2Fxfail_compile%2Fcfg_attr.rs", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Frust.test%2Fxfail_compile%2Fcfg_attr.rs?ref=ff1eca9a578bb8ff5d35a64e96f6b17fb5f6f81e", "patch": "@@ -0,0 +1,7 @@\n+use std::env; // Add one line so gccrs doesn't believe we're parsing a shebang\n+\n+#[cfg_attr(feature = \"somefeature\", attribute = \"someattr\")]\n+struct Feature;\n+\n+fn main() {\n+}"}]}