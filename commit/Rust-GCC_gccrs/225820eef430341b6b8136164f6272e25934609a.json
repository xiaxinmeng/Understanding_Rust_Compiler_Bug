{"sha": "225820eef430341b6b8136164f6272e25934609a", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6MjI1ODIwZWVmNDMwMzQxYjZiODEzNjE2NGY2MjcyZTI1OTM0NjA5YQ==", "commit": {"author": {"name": "Richard Guenther", "email": "rguenther@suse.de", "date": "2012-04-02T11:59:47Z"}, "committer": {"name": "Richard Biener", "email": "rguenth@gcc.gnu.org", "date": "2012-04-02T11:59:47Z"}, "message": "re PR rtl-optimization/52803 (ICE: in ira, at ira.c:3616 with -fno-move-loop-invariants on almost any code)\n\n2012-04-02  Richard Guenther  <rguenther@suse.de>\n\n\tPR middle-end/52803\n\t* loop-init.c (gate_handle_loop2): Destroy loops here if\n\twe don't enter RTL loop optimizers.\n\n\t* gcc.dg/pr52803.c: New testcase.\n\nFrom-SVN: r186080", "tree": {"sha": "2530310032c7350590cc31435d505a64dae7572b", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/2530310032c7350590cc31435d505a64dae7572b"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/225820eef430341b6b8136164f6272e25934609a", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/225820eef430341b6b8136164f6272e25934609a", "html_url": "https://github.com/Rust-GCC/gccrs/commit/225820eef430341b6b8136164f6272e25934609a", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/225820eef430341b6b8136164f6272e25934609a/comments", "author": {"login": "rguenth", "id": 2046526, "node_id": "MDQ6VXNlcjIwNDY1MjY=", "avatar_url": "https://avatars.githubusercontent.com/u/2046526?v=4", "gravatar_id": "", "url": "https://api.github.com/users/rguenth", "html_url": "https://github.com/rguenth", "followers_url": "https://api.github.com/users/rguenth/followers", "following_url": "https://api.github.com/users/rguenth/following{/other_user}", "gists_url": "https://api.github.com/users/rguenth/gists{/gist_id}", "starred_url": "https://api.github.com/users/rguenth/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/rguenth/subscriptions", "organizations_url": "https://api.github.com/users/rguenth/orgs", "repos_url": "https://api.github.com/users/rguenth/repos", "events_url": "https://api.github.com/users/rguenth/events{/privacy}", "received_events_url": "https://api.github.com/users/rguenth/received_events", "type": "User", "site_admin": false}, "committer": null, "parents": [{"sha": "cf5ba8a881c32483bc11e05cc1ee3bcc990d32c6", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/cf5ba8a881c32483bc11e05cc1ee3bcc990d32c6", "html_url": "https://github.com/Rust-GCC/gccrs/commit/cf5ba8a881c32483bc11e05cc1ee3bcc990d32c6"}], "stats": {"total": 38, "additions": 31, "deletions": 7}, "files": [{"sha": "ef6425cfe601183b762409e5e5f84bd8c4b53f32", "filename": "gcc/ChangeLog", "status": "modified", "additions": 6, "deletions": 0, "changes": 6, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/225820eef430341b6b8136164f6272e25934609a/gcc%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/225820eef430341b6b8136164f6272e25934609a/gcc%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2FChangeLog?ref=225820eef430341b6b8136164f6272e25934609a", "patch": "@@ -1,3 +1,9 @@\n+2012-04-02  Richard Guenther  <rguenther@suse.de>\n+\n+\tPR middle-end/52803\n+\t* loop-init.c (gate_handle_loop2): Destroy loops here if\n+\twe don't enter RTL loop optimizers.\n+\n 2012-04-02  Uros Bizjak  <ubizjak@gmail.com>\n \n \tPartially revert:"}, {"sha": "03f8f610c97fe8bc5eda3531ffc30d2921290f33", "filename": "gcc/loop-init.c", "status": "modified", "additions": 16, "deletions": 7, "changes": 23, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/225820eef430341b6b8136164f6272e25934609a/gcc%2Floop-init.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/225820eef430341b6b8136164f6272e25934609a/gcc%2Floop-init.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Floop-init.c?ref=225820eef430341b6b8136164f6272e25934609a", "patch": "@@ -158,15 +158,24 @@ loop_optimizer_finalize (void)\n static bool\n gate_handle_loop2 (void)\n {\n-  return (optimize > 0\n-  \t  && (flag_move_loop_invariants\n-              || flag_unswitch_loops\n-              || flag_peel_loops\n-              || flag_unroll_loops\n+  if (optimize > 0\n+      && (flag_move_loop_invariants\n+\t  || flag_unswitch_loops\n+\t  || flag_peel_loops\n+\t  || flag_unroll_loops\n #ifdef HAVE_doloop_end\n-\t      || (flag_branch_on_count_reg && HAVE_doloop_end)\n+\t  || (flag_branch_on_count_reg && HAVE_doloop_end)\n #endif\n-\t      ));\n+\t ))\n+    return true;\n+  else\n+    {\n+      /* No longer preserve loops, remove them now.  */\n+      cfun->curr_properties &= ~PROP_loops;\n+      if (current_loops)\n+\tloop_optimizer_finalize ();\n+      return false;\n+    } \n }\n \n struct rtl_opt_pass pass_loop2 ="}, {"sha": "2d95e0ed0d9db89e1c64a8cad567bb0e26105a88", "filename": "gcc/testsuite/ChangeLog", "status": "modified", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/225820eef430341b6b8136164f6272e25934609a/gcc%2Ftestsuite%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/225820eef430341b6b8136164f6272e25934609a/gcc%2Ftestsuite%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2FChangeLog?ref=225820eef430341b6b8136164f6272e25934609a", "patch": "@@ -1,3 +1,8 @@\n+2012-04-02  Richard Guenther  <rguenther@suse.de>\n+\n+\tPR middle-end/52803\n+\t* gcc.dg/pr52803.c: New testcase.\n+\n 2012-04-02  Dodji Seketeli  <dodji@redhat.com>\n \n \tPR c++/40942"}, {"sha": "6774b0c6d21cd4c338af5b84c510193c17ec8904", "filename": "gcc/testsuite/gcc.dg/pr52803.c", "status": "added", "additions": 4, "deletions": 0, "changes": 4, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/225820eef430341b6b8136164f6272e25934609a/gcc%2Ftestsuite%2Fgcc.dg%2Fpr52803.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/225820eef430341b6b8136164f6272e25934609a/gcc%2Ftestsuite%2Fgcc.dg%2Fpr52803.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgcc.dg%2Fpr52803.c?ref=225820eef430341b6b8136164f6272e25934609a", "patch": "@@ -0,0 +1,4 @@\n+/* { dg-do compile } */\n+/* { dg-options \"-O -fno-move-loop-invariants\" } */\n+\n+int main () { return 0; }"}]}