{"sha": "35cf3c55165efe8226cb9e5397ab0620130396ea", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6MzVjZjNjNTUxNjVlZmU4MjI2Y2I5ZTUzOTdhYjA2MjAxMzAzOTZlYQ==", "commit": {"author": {"name": "Kaipeng Zhou", "email": "zhoukaipeng3@huawei.com", "date": "2020-06-24T14:48:45Z"}, "committer": {"name": "Richard Biener", "email": "rguenther@suse.de", "date": "2020-06-29T10:58:10Z"}, "message": "store-merging: ICE in find_bswap_or_nop_1 PR95854.\n\nThe patch add a judgement in find_bswap_or_nop_1 to make sure both\noperand1 and operand2 cannot be converted to unsigned HOST_WIDE_INT.\nIf not, return NULL.\n\ngcc/ChangeLog:\n\n2020-06-24  Kaipeng Zhou  <zhoukaipeng3@huawei.com>\n\n\tPR tree-optimization/95854\n\t* gimple-ssa-store-merging.c (find_bswap_or_nop_1): Return NULL\n\tif operand 1 or 2 of a BIT_FIELD_REF cannot be converted to\n\tunsigned HOST_WIDE_INT.\n\ngcc/testsuite/ChangeLog:\n\n2020-06-24  Kaipeng Zhou  <zhoukaipeng3@huawei.com>\n\n\tPR tree-optimization/95854\n\t* gcc.dg/pr95854.c: New test.", "tree": {"sha": "6404e7a6bc193240061ded0cc903a996b4fb9cb8", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/6404e7a6bc193240061ded0cc903a996b4fb9cb8"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/35cf3c55165efe8226cb9e5397ab0620130396ea", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/35cf3c55165efe8226cb9e5397ab0620130396ea", "html_url": "https://github.com/Rust-GCC/gccrs/commit/35cf3c55165efe8226cb9e5397ab0620130396ea", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/35cf3c55165efe8226cb9e5397ab0620130396ea/comments", "author": null, "committer": {"login": "rguenth", "id": 2046526, "node_id": "MDQ6VXNlcjIwNDY1MjY=", "avatar_url": "https://avatars.githubusercontent.com/u/2046526?v=4", "gravatar_id": "", "url": "https://api.github.com/users/rguenth", "html_url": "https://github.com/rguenth", "followers_url": "https://api.github.com/users/rguenth/followers", "following_url": "https://api.github.com/users/rguenth/following{/other_user}", "gists_url": "https://api.github.com/users/rguenth/gists{/gist_id}", "starred_url": "https://api.github.com/users/rguenth/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/rguenth/subscriptions", "organizations_url": "https://api.github.com/users/rguenth/orgs", "repos_url": "https://api.github.com/users/rguenth/repos", "events_url": "https://api.github.com/users/rguenth/events{/privacy}", "received_events_url": "https://api.github.com/users/rguenth/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "ceac3edb42e1090be8cee895a5659fe847a4050a", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/ceac3edb42e1090be8cee895a5659fe847a4050a", "html_url": "https://github.com/Rust-GCC/gccrs/commit/ceac3edb42e1090be8cee895a5659fe847a4050a"}], "stats": {"total": 24, "additions": 24, "deletions": 0}, "files": [{"sha": "5cb71019d65eff68b307778376378a55353707de", "filename": "gcc/gimple-ssa-store-merging.c", "status": "modified", "additions": 4, "deletions": 0, "changes": 4, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/35cf3c55165efe8226cb9e5397ab0620130396ea/gcc%2Fgimple-ssa-store-merging.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/35cf3c55165efe8226cb9e5397ab0620130396ea/gcc%2Fgimple-ssa-store-merging.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fgimple-ssa-store-merging.c?ref=35cf3c55165efe8226cb9e5397ab0620130396ea", "patch": "@@ -598,6 +598,10 @@ find_bswap_or_nop_1 (gimple *stmt, struct symbolic_number *n, int limit)\n   if (TREE_CODE (rhs1) == BIT_FIELD_REF\n       && TREE_CODE (TREE_OPERAND (rhs1, 0)) == SSA_NAME)\n     {\n+      if (!tree_fits_uhwi_p (TREE_OPERAND (rhs1, 1))\n+\t  || !tree_fits_uhwi_p (TREE_OPERAND (rhs1, 2)))\n+\treturn NULL;\n+\n       unsigned HOST_WIDE_INT bitsize = tree_to_uhwi (TREE_OPERAND (rhs1, 1));\n       unsigned HOST_WIDE_INT bitpos = tree_to_uhwi (TREE_OPERAND (rhs1, 2));\n       if (bitpos % BITS_PER_UNIT == 0"}, {"sha": "db45d6aaf4250e986c04044096aeaf5ddb76a603", "filename": "gcc/testsuite/gcc.dg/pr95854.c", "status": "added", "additions": 20, "deletions": 0, "changes": 20, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/35cf3c55165efe8226cb9e5397ab0620130396ea/gcc%2Ftestsuite%2Fgcc.dg%2Fpr95854.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/35cf3c55165efe8226cb9e5397ab0620130396ea/gcc%2Ftestsuite%2Fgcc.dg%2Fpr95854.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgcc.dg%2Fpr95854.c?ref=35cf3c55165efe8226cb9e5397ab0620130396ea", "patch": "@@ -0,0 +1,20 @@\n+/* { dg-do compile } */\n+/* { dg-options \"-O3 -fno-vect-cost-model -fno-tree-scev-cprop -ftracer\" } */\n+/* { dg-additional-options \"-march=armv8.5-a+sve2\" { target aarch64*-*-* } } */\n+\n+extern void abort (void);\n+int c, d;\n+int main()\n+{\n+  int e[] = {4, 4, 4, 4, 4, 4, 4, 4, 4};\n+  d = 8;\n+  for (; d; d--)\n+    for (int a = 0; a <= 8; a++)\n+      {\n+\tc = e[1];\n+\te[d] = 0;\n+      }\n+  if (c != 0)\n+    abort ();\n+  return 0;\n+}"}]}