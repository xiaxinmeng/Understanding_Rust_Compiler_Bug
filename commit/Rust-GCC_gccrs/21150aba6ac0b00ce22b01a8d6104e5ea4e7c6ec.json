{"sha": "21150aba6ac0b00ce22b01a8d6104e5ea4e7c6ec", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6MjExNTBhYmE2YWMwYjAwY2UyMmIwMWE4ZDYxMDRlNWVhNGU3YzZlYw==", "commit": {"author": {"name": "Jakub Jelinek", "email": "jakub@redhat.com", "date": "2018-11-23T09:12:16Z"}, "committer": {"name": "Jakub Jelinek", "email": "jakub@gcc.gnu.org", "date": "2018-11-23T09:12:16Z"}, "message": "re PR tree-optimization/86614 (duplicate -Warray-bounds for a strncpy  call with out-of-bounds offset)\n\n\tPR tree-optimization/86614\n\t* gimple-ssa-warn-restrict.c (maybe_diag_offset_bounds): Return early\n\tif TREE_NO_WARNING is set on ref.ref.\n\n\t* c-c++-common/Warray-bounds-2.c (wrap_strncpy_dstarray_diff_neg,\n\tcall_strncpy_dstarray_diff_neg): Don't expect late -Warray-bounds\n\twarnings, just early ones from FE.  Remove dg-prune-output.\n\t* c-c++-common/Warray-bounds-6.c: New test.\n\nFrom-SVN: r266403", "tree": {"sha": "ae6888cf4f54bb5e51d98fccdefbd48761ace20a", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/ae6888cf4f54bb5e51d98fccdefbd48761ace20a"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/21150aba6ac0b00ce22b01a8d6104e5ea4e7c6ec", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/21150aba6ac0b00ce22b01a8d6104e5ea4e7c6ec", "html_url": "https://github.com/Rust-GCC/gccrs/commit/21150aba6ac0b00ce22b01a8d6104e5ea4e7c6ec", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/21150aba6ac0b00ce22b01a8d6104e5ea4e7c6ec/comments", "author": {"login": "jakubjelinek", "id": 9370665, "node_id": "MDQ6VXNlcjkzNzA2NjU=", "avatar_url": "https://avatars.githubusercontent.com/u/9370665?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jakubjelinek", "html_url": "https://github.com/jakubjelinek", "followers_url": "https://api.github.com/users/jakubjelinek/followers", "following_url": "https://api.github.com/users/jakubjelinek/following{/other_user}", "gists_url": "https://api.github.com/users/jakubjelinek/gists{/gist_id}", "starred_url": "https://api.github.com/users/jakubjelinek/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jakubjelinek/subscriptions", "organizations_url": "https://api.github.com/users/jakubjelinek/orgs", "repos_url": "https://api.github.com/users/jakubjelinek/repos", "events_url": "https://api.github.com/users/jakubjelinek/events{/privacy}", "received_events_url": "https://api.github.com/users/jakubjelinek/received_events", "type": "User", "site_admin": false}, "committer": null, "parents": [{"sha": "e0a35f9be5e08b33465999c90a0a3f09d4676da6", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/e0a35f9be5e08b33465999c90a0a3f09d4676da6", "html_url": "https://github.com/Rust-GCC/gccrs/commit/e0a35f9be5e08b33465999c90a0a3f09d4676da6"}], "stats": {"total": 43, "additions": 37, "deletions": 6}, "files": [{"sha": "29ac649d6789dfc07120a02a7422fcacfbfcebcd", "filename": "gcc/ChangeLog", "status": "modified", "additions": 6, "deletions": 0, "changes": 6, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/21150aba6ac0b00ce22b01a8d6104e5ea4e7c6ec/gcc%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/21150aba6ac0b00ce22b01a8d6104e5ea4e7c6ec/gcc%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2FChangeLog?ref=21150aba6ac0b00ce22b01a8d6104e5ea4e7c6ec", "patch": "@@ -1,3 +1,9 @@\n+2018-11-23  Jakub Jelinek  <jakub@redhat.com>\n+\n+\tPR tree-optimization/86614\n+\t* gimple-ssa-warn-restrict.c (maybe_diag_offset_bounds): Return early\n+\tif TREE_NO_WARNING is set on ref.ref.\n+\n 2018-11-22  Sandra Loosemore  <sandra@codesourcery.com>\n \t    Alan Coopersmith  <alan.coopersmith@oracle.com>\n "}, {"sha": "035fbf88c116e2e681d46c59b900fe2d254aa6d9", "filename": "gcc/gimple-ssa-warn-restrict.c", "status": "modified", "additions": 3, "deletions": 0, "changes": 3, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/21150aba6ac0b00ce22b01a8d6104e5ea4e7c6ec/gcc%2Fgimple-ssa-warn-restrict.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/21150aba6ac0b00ce22b01a8d6104e5ea4e7c6ec/gcc%2Fgimple-ssa-warn-restrict.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fgimple-ssa-warn-restrict.c?ref=21150aba6ac0b00ce22b01a8d6104e5ea4e7c6ec", "patch": "@@ -1582,6 +1582,9 @@ maybe_diag_offset_bounds (location_t loc, gimple *call, tree func, int strict,\n   if (!warn_array_bounds)\n     return false;\n \n+  if (ref.ref && TREE_NO_WARNING (ref.ref))\n+    return false;\n+\n   offset_int ooboff[] = { ref.offrange[0], ref.offrange[1] };\n   tree oobref = ref.offset_out_of_bounds (strict, ooboff);\n   if (!oobref)"}, {"sha": "355221c3812b02ff4b44802f71f052f6c08ad957", "filename": "gcc/testsuite/ChangeLog", "status": "modified", "additions": 6, "deletions": 0, "changes": 6, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/21150aba6ac0b00ce22b01a8d6104e5ea4e7c6ec/gcc%2Ftestsuite%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/21150aba6ac0b00ce22b01a8d6104e5ea4e7c6ec/gcc%2Ftestsuite%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2FChangeLog?ref=21150aba6ac0b00ce22b01a8d6104e5ea4e7c6ec", "patch": "@@ -1,5 +1,11 @@\n 2018-11-23  Jakub Jelinek  <jakub@redhat.com>\n \n+\tPR tree-optimization/86614\n+\t* c-c++-common/Warray-bounds-2.c (wrap_strncpy_dstarray_diff_neg,\n+\tcall_strncpy_dstarray_diff_neg): Don't expect late -Warray-bounds\n+\twarnings, just early ones from FE.  Remove dg-prune-output.\n+\t* c-c++-common/Warray-bounds-6.c: New test.\n+\n \t* gfortran.dg/pad_source_1.f: New test.\n \t* gfortran.dg/pad_source_2.f: New test.\n \t* gfortran.dg/pad_source_3.f: New test."}, {"sha": "aee35617bacf8ac3a7b6b822c77cae9d95817939", "filename": "gcc/testsuite/c-c++-common/Warray-bounds-2.c", "status": "modified", "additions": 4, "deletions": 6, "changes": 10, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/21150aba6ac0b00ce22b01a8d6104e5ea4e7c6ec/gcc%2Ftestsuite%2Fc-c%2B%2B-common%2FWarray-bounds-2.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/21150aba6ac0b00ce22b01a8d6104e5ea4e7c6ec/gcc%2Ftestsuite%2Fc-c%2B%2B-common%2FWarray-bounds-2.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fc-c%2B%2B-common%2FWarray-bounds-2.c?ref=21150aba6ac0b00ce22b01a8d6104e5ea4e7c6ec", "patch": "@@ -201,18 +201,16 @@ void call_strncpy_dst_diff_max (const char *s, size_t n)\n static void\n wrap_strncpy_dstarray_diff_neg (char *d, const char *s, ptrdiff_t i, size_t n)\n {\n-  strncpy (d + i, s, n);   /* { dg-warning \"offset -\\[0-9\\]+ is out of the bounds \\\\\\[0, 90] of object .ar10. with type .(struct )?Array ?\\\\\\[2].\" \"strncpy\" } */\n-}\n+  strncpy (d + i, s, n);   /* { dg-bogus \"offset -\\[0-9\\]+ is out of the bounds \\\\\\[0, 90] of object .ar10. with type .(struct )?Array ?\\\\\\[2].\" \"strncpy\" } */\n+}\t\t\t   /* { dg-warning \"array subscript -1 is outside array bounds\" \"\" { target *-*-* } .-1 } */\n \n void call_strncpy_dstarray_diff_neg (const char *s, size_t n)\n {\n-  struct Array ar10[2];    /* { dg-message \".ar10. declared here\" } */\n-  sink (&ar10);\n+  struct Array ar10[2];    /* { dg-bogus \".ar10. declared here\" } */\n+  sink (&ar10);\t\t   /* { dg-message \"while referencing\" \"\" { target *-*-* } .-1 } */\n \n   int off = (char*)ar10[1].a17 - (char*)ar10 + 1;\n   wrap_strncpy_dstarray_diff_neg (ar10[1].a17, s, -off, n);\n \n   sink (&ar10);\n }\n-\n-/* { dg-prune-output \"outside array bounds\" } */"}, {"sha": "6611d5cd916a9d9ef2ad9c0733491ddae9955ebc", "filename": "gcc/testsuite/c-c++-common/Warray-bounds-6.c", "status": "added", "additions": 18, "deletions": 0, "changes": 18, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/21150aba6ac0b00ce22b01a8d6104e5ea4e7c6ec/gcc%2Ftestsuite%2Fc-c%2B%2B-common%2FWarray-bounds-6.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/21150aba6ac0b00ce22b01a8d6104e5ea4e7c6ec/gcc%2Ftestsuite%2Fc-c%2B%2B-common%2FWarray-bounds-6.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fc-c%2B%2B-common%2FWarray-bounds-6.c?ref=21150aba6ac0b00ce22b01a8d6104e5ea4e7c6ec", "patch": "@@ -0,0 +1,18 @@\n+/* PR tree-optimization/86614 */\n+/* { dg-do compile } */\n+/* { dg-options \"-O2 -Warray-bounds\" } */\n+\n+extern char *strncpy (char *, const char *, __SIZE_TYPE__);\n+\n+void sink (void *);\n+\n+struct A { char b[17]; } a[2];\n+\n+void g (const char *s, unsigned n)\n+{\n+  int i = (char *)a[1].b - (char *)a + 1;\n+  char *d = a[1].b;\n+  /* Ensure the same bug is not diagnosed more than once.  */\n+  strncpy (d + i, s, n);\t/* { dg-warning \"array subscript \\[0-9]+ is outside array bounds of\" } */\n+\t\t\t\t/* { dg-bogus \"offset \\[0-9]+ is out of the bounds \\\\\\[0, \\[0-9]+\\\\\\] of object 'a' with type\" \"\" { target *-*-* } .-1 } */\n+}"}]}