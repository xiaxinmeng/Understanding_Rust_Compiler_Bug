{"sha": "b6bca2e631b54f992c058ca8e445b45e9816690b", "node_id": "C_kwDOANBUbNoAKGI2YmNhMmU2MzFiNTRmOTkyYzA1OGNhOGU0NDViNDVlOTgxNjY5MGI", "commit": {"author": {"name": "Patrick Palka", "email": "ppalka@redhat.com", "date": "2021-09-30T21:29:05Z"}, "committer": {"name": "Patrick Palka", "email": "ppalka@redhat.com", "date": "2021-09-30T21:29:05Z"}, "message": "c++: defaulted comparisons and vptr fields [PR95567]\n\nWe need to explicitly skip over vptr fields when synthesizing a\ndefaulted comparison operator, because next_initializable_field\ndoesn't do so for us.\n\n\tPR c++/95567\n\ngcc/cp/ChangeLog:\n\n\t* method.c (build_comparison_op): Skip DECL_VIRTUAL_P fields.\n\ngcc/testsuite/ChangeLog:\n\n\t* g++.dg/cpp2a/spaceship-virtual1.C: New test.", "tree": {"sha": "ac911b7f42efb7d6176ed747a1a2ed699a7a7937", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/ac911b7f42efb7d6176ed747a1a2ed699a7a7937"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/b6bca2e631b54f992c058ca8e445b45e9816690b", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/b6bca2e631b54f992c058ca8e445b45e9816690b", "html_url": "https://github.com/Rust-GCC/gccrs/commit/b6bca2e631b54f992c058ca8e445b45e9816690b", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/b6bca2e631b54f992c058ca8e445b45e9816690b/comments", "author": null, "committer": null, "parents": [{"sha": "bffb580d6f0e8b6f9623128d38ea653a99a58d49", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/bffb580d6f0e8b6f9623128d38ea653a99a58d49", "html_url": "https://github.com/Rust-GCC/gccrs/commit/bffb580d6f0e8b6f9623128d38ea653a99a58d49"}], "stats": {"total": 24, "additions": 24, "deletions": 0}, "files": [{"sha": "3c3495227ce36ae3efc2ce345adc35102e00a413", "filename": "gcc/cp/method.c", "status": "modified", "additions": 4, "deletions": 0, "changes": 4, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/b6bca2e631b54f992c058ca8e445b45e9816690b/gcc%2Fcp%2Fmethod.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/b6bca2e631b54f992c058ca8e445b45e9816690b/gcc%2Fcp%2Fmethod.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fcp%2Fmethod.c?ref=b6bca2e631b54f992c058ca8e445b45e9816690b", "patch": "@@ -1426,6 +1426,10 @@ build_comparison_op (tree fndecl, tsubst_flags_t complain)\n \t   field;\n \t   field = next_initializable_field (DECL_CHAIN (field)))\n \t{\n+\t  if (DECL_VIRTUAL_P (field))\n+\t    /* Don't compare vptr fields.  */\n+\t    continue;\n+\n \t  tree expr_type = TREE_TYPE (field);\n \n \t  location_t field_loc = DECL_SOURCE_LOCATION (field);"}, {"sha": "8067d3cd9d1e249479ed9cca7526e8eb4bf5a810", "filename": "gcc/testsuite/g++.dg/cpp2a/spaceship-virtual1.C", "status": "added", "additions": 20, "deletions": 0, "changes": 20, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/b6bca2e631b54f992c058ca8e445b45e9816690b/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Fcpp2a%2Fspaceship-virtual1.C", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/b6bca2e631b54f992c058ca8e445b45e9816690b/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Fcpp2a%2Fspaceship-virtual1.C", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Fcpp2a%2Fspaceship-virtual1.C?ref=b6bca2e631b54f992c058ca8e445b45e9816690b", "patch": "@@ -0,0 +1,20 @@\n+// PR c++/95567\n+// { dg-do run { target c++20 } }\n+\n+struct B {\n+  B(int i) : i(i) {}\n+  virtual ~B() = default;\n+\n+  bool operator==(B const&) const = default;\n+  int i;\n+};\n+\n+struct D : B {\n+  D(int i, int j) : B(i), j(j) {}\n+  int j;\n+};\n+\n+int main() {\n+  if (B(2) != D(2, 3))\n+    __builtin_abort();\n+}"}]}