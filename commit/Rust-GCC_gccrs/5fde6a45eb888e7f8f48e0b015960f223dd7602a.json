{"sha": "5fde6a45eb888e7f8f48e0b015960f223dd7602a", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6NWZkZTZhNDVlYjg4OGU3ZjhmNDhlMGIwMTU5NjBmMjIzZGQ3NjAyYQ==", "commit": {"author": {"name": "Marek Polacek", "email": "polacek@redhat.com", "date": "2016-03-31T14:29:15Z"}, "committer": {"name": "Marek Polacek", "email": "mpolacek@gcc.gnu.org", "date": "2016-03-31T14:29:15Z"}, "message": "re PR c/70297 (GCC Segfaults when using -g3)\n\n\tPR c/70297\n\t* c-decl.c (merge_decls): Also set TYPE_ALIGN and TYPE_USER_ALIGN.\n\n\t* decl.c (duplicate_decls): Also set TYPE_ALIGN and TYPE_USER_ALIGN.\n\n\t* c-c++-common/pr70297.c: New test.\n\t* g++.dg/cpp0x/typedef-redecl.C: New test.\n\t* gcc.dg/typedef-redecl2.c: New test.\n\nFrom-SVN: r234626", "tree": {"sha": "da1c9585f557c7e34eea4677a004d3d1368dc0de", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/da1c9585f557c7e34eea4677a004d3d1368dc0de"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/5fde6a45eb888e7f8f48e0b015960f223dd7602a", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/5fde6a45eb888e7f8f48e0b015960f223dd7602a", "html_url": "https://github.com/Rust-GCC/gccrs/commit/5fde6a45eb888e7f8f48e0b015960f223dd7602a", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/5fde6a45eb888e7f8f48e0b015960f223dd7602a/comments", "author": {"login": "mpolacek", "id": 10496300, "node_id": "MDQ6VXNlcjEwNDk2MzAw", "avatar_url": "https://avatars.githubusercontent.com/u/10496300?v=4", "gravatar_id": "", "url": "https://api.github.com/users/mpolacek", "html_url": "https://github.com/mpolacek", "followers_url": "https://api.github.com/users/mpolacek/followers", "following_url": "https://api.github.com/users/mpolacek/following{/other_user}", "gists_url": "https://api.github.com/users/mpolacek/gists{/gist_id}", "starred_url": "https://api.github.com/users/mpolacek/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/mpolacek/subscriptions", "organizations_url": "https://api.github.com/users/mpolacek/orgs", "repos_url": "https://api.github.com/users/mpolacek/repos", "events_url": "https://api.github.com/users/mpolacek/events{/privacy}", "received_events_url": "https://api.github.com/users/mpolacek/received_events", "type": "User", "site_admin": false}, "committer": null, "parents": [{"sha": "97eb24c42a5d82617e576165867dd6678b6b1262", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/97eb24c42a5d82617e576165867dd6678b6b1262", "html_url": "https://github.com/Rust-GCC/gccrs/commit/97eb24c42a5d82617e576165867dd6678b6b1262"}], "stats": {"total": 89, "additions": 89, "deletions": 0}, "files": [{"sha": "b52b414478fd845be3ee9a2e7a73c655e28cd10a", "filename": "gcc/c/ChangeLog", "status": "modified", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/5fde6a45eb888e7f8f48e0b015960f223dd7602a/gcc%2Fc%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/5fde6a45eb888e7f8f48e0b015960f223dd7602a/gcc%2Fc%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fc%2FChangeLog?ref=5fde6a45eb888e7f8f48e0b015960f223dd7602a", "patch": "@@ -1,3 +1,8 @@\n+2016-03-31  Marek Polacek  <polacek@redhat.com>\n+\n+\tPR c/70297\n+\t* c-decl.c (merge_decls): Also set TYPE_ALIGN and TYPE_USER_ALIGN.\n+\n 2016-03-18  David Malcolm  <dmalcolm@redhat.com>\n \n \tPR c/70281"}, {"sha": "0dd2121b86832155a404d7fa57044d8ed6b0fd4f", "filename": "gcc/c/c-decl.c", "status": "modified", "additions": 29, "deletions": 0, "changes": 29, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/5fde6a45eb888e7f8f48e0b015960f223dd7602a/gcc%2Fc%2Fc-decl.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/5fde6a45eb888e7f8f48e0b015960f223dd7602a/gcc%2Fc%2Fc-decl.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fc%2Fc-decl.c?ref=5fde6a45eb888e7f8f48e0b015960f223dd7602a", "patch": "@@ -2358,6 +2358,35 @@ merge_decls (tree newdecl, tree olddecl, tree newtype, tree oldtype)\n   DECL_ATTRIBUTES (newdecl)\n     = targetm.merge_decl_attributes (olddecl, newdecl);\n \n+  /* For typedefs use the old type, as the new type's DECL_NAME points\n+     at newdecl, which will be ggc_freed.  */\n+  if (TREE_CODE (newdecl) == TYPE_DECL)\n+    {\n+      /* But NEWTYPE might have an attribute, honor that.  */\n+      tree tem = newtype;\n+      newtype = oldtype;\n+\n+      if (TYPE_USER_ALIGN (tem))\n+\t{\n+\t  if (TYPE_ALIGN (tem) > TYPE_ALIGN (newtype))\n+\t    TYPE_ALIGN (newtype) = TYPE_ALIGN (tem);\n+\t  TYPE_USER_ALIGN (newtype) = true;\n+\t}\n+\n+      /* And remove the new type from the variants list.  */\n+      if (TYPE_NAME (TREE_TYPE (newdecl)) == newdecl)\n+\t{\n+\t  tree remove = TREE_TYPE (newdecl);\n+\t  for (tree t = TYPE_MAIN_VARIANT (remove); ;\n+\t       t = TYPE_NEXT_VARIANT (t))\n+\t    if (TYPE_NEXT_VARIANT (t) == remove)\n+\t      {\n+\t\tTYPE_NEXT_VARIANT (t) = TYPE_NEXT_VARIANT (remove);\n+\t\tbreak;\n+\t      }\n+\t}\n+    }\n+\n   /* Merge the data types specified in the two decls.  */\n   TREE_TYPE (newdecl)\n     = TREE_TYPE (olddecl)"}, {"sha": "8aad906fc127ac4c9d0f0326462dbefdaf0ec7d6", "filename": "gcc/cp/ChangeLog", "status": "modified", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/5fde6a45eb888e7f8f48e0b015960f223dd7602a/gcc%2Fcp%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/5fde6a45eb888e7f8f48e0b015960f223dd7602a/gcc%2Fcp%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fcp%2FChangeLog?ref=5fde6a45eb888e7f8f48e0b015960f223dd7602a", "patch": "@@ -1,3 +1,8 @@\n+2016-03-31  Marek Polacek  <polacek@redhat.com>\n+\n+\tPR c/70297\n+\t* decl.c (duplicate_decls): Also set TYPE_ALIGN and TYPE_USER_ALIGN.\n+\n 2016-03-31  Richard Biener  <rguenther@suse.de>\n \n \tPR c++/70430"}, {"sha": "4730093da99f13584a6a1cfbb4a3d1d0e14af834", "filename": "gcc/cp/decl.c", "status": "modified", "additions": 9, "deletions": 0, "changes": 9, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/5fde6a45eb888e7f8f48e0b015960f223dd7602a/gcc%2Fcp%2Fdecl.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/5fde6a45eb888e7f8f48e0b015960f223dd7602a/gcc%2Fcp%2Fdecl.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fcp%2Fdecl.c?ref=5fde6a45eb888e7f8f48e0b015960f223dd7602a", "patch": "@@ -2028,8 +2028,17 @@ duplicate_decls (tree newdecl, tree olddecl, bool newdecl_is_friend)\n \t at newdecl, which will be ggc_freed.  */\n       if (TREE_CODE (newdecl) == TYPE_DECL)\n \t{\n+\t  /* But NEWTYPE might have an attribute, honor that.  */\n+\t  tree tem = TREE_TYPE (newdecl);\n \t  newtype = oldtype;\n \n+\t  if (TYPE_USER_ALIGN (tem))\n+\t    {\n+\t      if (TYPE_ALIGN (tem) > TYPE_ALIGN (newtype))\n+\t\tTYPE_ALIGN (newtype) = TYPE_ALIGN (tem);\n+\t      TYPE_USER_ALIGN (newtype) = true;\n+\t    }\n+\n \t  /* And remove the new type from the variants list.  */\n \t  if (TYPE_NAME (TREE_TYPE (newdecl)) == newdecl)\n \t    {"}, {"sha": "d1dd5ea7680e1a7bad07bc93914044e2c8029b46", "filename": "gcc/testsuite/ChangeLog", "status": "modified", "additions": 7, "deletions": 0, "changes": 7, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/5fde6a45eb888e7f8f48e0b015960f223dd7602a/gcc%2Ftestsuite%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/5fde6a45eb888e7f8f48e0b015960f223dd7602a/gcc%2Ftestsuite%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2FChangeLog?ref=5fde6a45eb888e7f8f48e0b015960f223dd7602a", "patch": "@@ -1,3 +1,10 @@\n+2016-03-31  Marek Polacek  <polacek@redhat.com>\n+\n+\tPR c/70297\n+\t* c-c++-common/pr70297.c: New test.\n+\t* g++.dg/cpp0x/typedef-redecl.C: New test.\n+\t* gcc.dg/typedef-redecl2.c: New test.\n+\n 2016-03-31  Jakub Jelinek  <jakub@redhat.com>\n \n \tPR rtl-optimization/70460"}, {"sha": "70a4f15cd22ae9e3e87fccf73640800e013e56c0", "filename": "gcc/testsuite/c-c++-common/pr70297.c", "status": "added", "additions": 9, "deletions": 0, "changes": 9, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/5fde6a45eb888e7f8f48e0b015960f223dd7602a/gcc%2Ftestsuite%2Fc-c%2B%2B-common%2Fpr70297.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/5fde6a45eb888e7f8f48e0b015960f223dd7602a/gcc%2Ftestsuite%2Fc-c%2B%2B-common%2Fpr70297.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fc-c%2B%2B-common%2Fpr70297.c?ref=5fde6a45eb888e7f8f48e0b015960f223dd7602a", "patch": "@@ -0,0 +1,9 @@\n+/* PR c/70297 */\n+/* { dg-do compile } */\n+/* { dg-options \"-g\" } */\n+\n+typedef int T;\n+typedef int T __attribute__((aligned (4)));\n+struct S {\n+  T *t;\n+};"}, {"sha": "576c7ce03323d4a0d73a0a25783f327fc1870c48", "filename": "gcc/testsuite/g++.dg/cpp0x/typedef-redecl.C", "status": "added", "additions": 12, "deletions": 0, "changes": 12, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/5fde6a45eb888e7f8f48e0b015960f223dd7602a/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Fcpp0x%2Ftypedef-redecl.C", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/5fde6a45eb888e7f8f48e0b015960f223dd7602a/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Fcpp0x%2Ftypedef-redecl.C", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Fcpp0x%2Ftypedef-redecl.C?ref=5fde6a45eb888e7f8f48e0b015960f223dd7602a", "patch": "@@ -0,0 +1,12 @@\n+// PR c/70297\n+// { dg-do compile { target c++11 } }\n+\n+#define N 64\n+\n+typedef int T;\n+typedef int T __attribute__((aligned (N)));\n+typedef int T __attribute__((aligned (N * 2)));\n+typedef int T __attribute__((aligned (N)));\n+typedef int T;\n+\n+static_assert (alignof (T) == N * 2, \"N * 2\");"}, {"sha": "c2314c78eaa4ee0fe866d66140adafd16f3e9ecd", "filename": "gcc/testsuite/gcc.dg/typedef-redecl2.c", "status": "added", "additions": 13, "deletions": 0, "changes": 13, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/5fde6a45eb888e7f8f48e0b015960f223dd7602a/gcc%2Ftestsuite%2Fgcc.dg%2Ftypedef-redecl2.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/5fde6a45eb888e7f8f48e0b015960f223dd7602a/gcc%2Ftestsuite%2Fgcc.dg%2Ftypedef-redecl2.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgcc.dg%2Ftypedef-redecl2.c?ref=5fde6a45eb888e7f8f48e0b015960f223dd7602a", "patch": "@@ -0,0 +1,13 @@\n+/* PR c/70297 */\n+/* { dg-do compile } */\n+/* { dg-options \"\" } */\n+\n+#define N 64\n+\n+typedef int T;\n+typedef int T __attribute__((aligned (N)));\n+typedef int T __attribute__((aligned (N * 2)));\n+typedef int T __attribute__((aligned (N)));\n+typedef int T;\n+\n+_Static_assert (_Alignof (T) == N * 2, \"N * 2\");"}]}