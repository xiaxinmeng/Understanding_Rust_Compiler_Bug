{"sha": "a7ac3e92ecf251d5528eea4b46b5f42fd0168e43", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6YTdhYzNlOTJlY2YyNTFkNTUyOGVlYTRiNDZiNWY0MmZkMDE2OGU0Mw==", "commit": {"author": {"name": "Martin Liska", "email": "mliska@suse.cz", "date": "2021-03-12T08:08:36Z"}, "committer": {"name": "Martin Liska", "email": "mliska@suse.cz", "date": "2021-03-12T08:29:05Z"}, "message": "gcc-changelog: allow ChangeLog deletion in a commit\n\ncontrib/ChangeLog:\n\n\t* gcc-changelog/git_commit.py: Allow deletion of ChangeLog\n\tfiles.\n\t* gcc-changelog/setup.cfg: Set line limit to 120 characters.\n\t* gcc-changelog/test_email.py: Add test.\n\t* gcc-changelog/test_patches.txt: Likewise.\n\t* gcc-changelog/git_email.py: Fix parsing of deleted files.", "tree": {"sha": "3264049111e29ecd94f5dc809a1bbc71c96b5c5a", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/3264049111e29ecd94f5dc809a1bbc71c96b5c5a"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/a7ac3e92ecf251d5528eea4b46b5f42fd0168e43", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/a7ac3e92ecf251d5528eea4b46b5f42fd0168e43", "html_url": "https://github.com/Rust-GCC/gccrs/commit/a7ac3e92ecf251d5528eea4b46b5f42fd0168e43", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/a7ac3e92ecf251d5528eea4b46b5f42fd0168e43/comments", "author": {"login": "marxin", "id": 2658545, "node_id": "MDQ6VXNlcjI2NTg1NDU=", "avatar_url": "https://avatars.githubusercontent.com/u/2658545?v=4", "gravatar_id": "", "url": "https://api.github.com/users/marxin", "html_url": "https://github.com/marxin", "followers_url": "https://api.github.com/users/marxin/followers", "following_url": "https://api.github.com/users/marxin/following{/other_user}", "gists_url": "https://api.github.com/users/marxin/gists{/gist_id}", "starred_url": "https://api.github.com/users/marxin/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/marxin/subscriptions", "organizations_url": "https://api.github.com/users/marxin/orgs", "repos_url": "https://api.github.com/users/marxin/repos", "events_url": "https://api.github.com/users/marxin/events{/privacy}", "received_events_url": "https://api.github.com/users/marxin/received_events", "type": "User", "site_admin": false}, "committer": {"login": "marxin", "id": 2658545, "node_id": "MDQ6VXNlcjI2NTg1NDU=", "avatar_url": "https://avatars.githubusercontent.com/u/2658545?v=4", "gravatar_id": "", "url": "https://api.github.com/users/marxin", "html_url": "https://github.com/marxin", "followers_url": "https://api.github.com/users/marxin/followers", "following_url": "https://api.github.com/users/marxin/following{/other_user}", "gists_url": "https://api.github.com/users/marxin/gists{/gist_id}", "starred_url": "https://api.github.com/users/marxin/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/marxin/subscriptions", "organizations_url": "https://api.github.com/users/marxin/orgs", "repos_url": "https://api.github.com/users/marxin/repos", "events_url": "https://api.github.com/users/marxin/events{/privacy}", "received_events_url": "https://api.github.com/users/marxin/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "48ff383f0d9e917bcb7bcc091af413bcae07b440", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/48ff383f0d9e917bcb7bcc091af413bcae07b440", "html_url": "https://github.com/Rust-GCC/gccrs/commit/48ff383f0d9e917bcb7bcc091af413bcae07b440"}], "stats": {"total": 42, "additions": 40, "deletions": 2}, "files": [{"sha": "43fa7f40e4edf3880e72ceafc792fdf9f509de5b", "filename": "contrib/gcc-changelog/git_commit.py", "status": "modified", "additions": 2, "deletions": 1, "changes": 3, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/a7ac3e92ecf251d5528eea4b46b5f42fd0168e43/contrib%2Fgcc-changelog%2Fgit_commit.py", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/a7ac3e92ecf251d5528eea4b46b5f42fd0168e43/contrib%2Fgcc-changelog%2Fgit_commit.py", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/contrib%2Fgcc-changelog%2Fgit_commit.py?ref=a7ac3e92ecf251d5528eea4b46b5f42fd0168e43", "patch": "@@ -314,8 +314,9 @@ def __init__(self, info, strict=True, commit_to_info_hook=None):\n         if self.revert_commit:\n             self.info = self.commit_to_info_hook(self.revert_commit)\n \n+        # Allow complete deletion of ChangeLog files in a commit\n         project_files = [f for f in self.info.modified_files\n-                         if self.is_changelog_filename(f[0], allow_suffix=True)\n+                         if (self.is_changelog_filename(f[0], allow_suffix=True) and f[1] != 'D')\n                          or f[0] in misc_files]\n         ignored_files = [f for f in self.info.modified_files\n                          if self.in_ignored_location(f[0])]"}, {"sha": "b0547b363aa30c61173998d993330cf38b10be39", "filename": "contrib/gcc-changelog/git_email.py", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/a7ac3e92ecf251d5528eea4b46b5f42fd0168e43/contrib%2Fgcc-changelog%2Fgit_email.py", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/a7ac3e92ecf251d5528eea4b46b5f42fd0168e43/contrib%2Fgcc-changelog%2Fgit_email.py", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/contrib%2Fgcc-changelog%2Fgit_email.py?ref=a7ac3e92ecf251d5528eea4b46b5f42fd0168e43", "patch": "@@ -66,7 +66,7 @@ def __init__(self, filename, strict=False):\n                 t = 'A'\n             else:\n                 t = 'M'\n-            modified_files.append((target, t))\n+            modified_files.append((target if t != 'D' else source, t))\n         git_info = GitInfo(None, date, author, body, modified_files)\n         super().__init__(git_info, strict=strict,\n                          commit_to_info_hook=lambda x: None)"}, {"sha": "efc313f6d526e31412bdf993347da88105ebadbb", "filename": "contrib/gcc-changelog/setup.cfg", "status": "modified", "additions": 3, "deletions": 0, "changes": 3, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/a7ac3e92ecf251d5528eea4b46b5f42fd0168e43/contrib%2Fgcc-changelog%2Fsetup.cfg", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/a7ac3e92ecf251d5528eea4b46b5f42fd0168e43/contrib%2Fgcc-changelog%2Fsetup.cfg", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/contrib%2Fgcc-changelog%2Fsetup.cfg?ref=a7ac3e92ecf251d5528eea4b46b5f42fd0168e43", "patch": "@@ -1,2 +1,5 @@\n+[flake8]\n+max-line-length = 120\n+\n [tool:pytest]\n addopts = -vv --flake8"}, {"sha": "9d052e06467e45aa3fa5fdda2816f9d6c94101bc", "filename": "contrib/gcc-changelog/test_email.py", "status": "modified", "additions": 4, "deletions": 0, "changes": 4, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/a7ac3e92ecf251d5528eea4b46b5f42fd0168e43/contrib%2Fgcc-changelog%2Ftest_email.py", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/a7ac3e92ecf251d5528eea4b46b5f42fd0168e43/contrib%2Fgcc-changelog%2Ftest_email.py", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/contrib%2Fgcc-changelog%2Ftest_email.py?ref=a7ac3e92ecf251d5528eea4b46b5f42fd0168e43", "patch": "@@ -416,3 +416,7 @@ def test_multiline_parentheses(self):\n     def test_multiline_bad_parentheses(self):\n         email = self.from_patch_glob('0002-Wrong-macro-changelog.patch')\n         assert email.errors[0].message == 'bad parentheses wrapping'\n+\n+    def test_changelog_removal(self):\n+        email = self.from_patch_glob('0001-ChangeLog-removal.patch', strict=True)\n+        assert not email.errors"}, {"sha": "012573b48453ad3c40bf64a19d8489a1acef9d6f", "filename": "contrib/gcc-changelog/test_patches.txt", "status": "modified", "additions": 30, "deletions": 0, "changes": 30, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/a7ac3e92ecf251d5528eea4b46b5f42fd0168e43/contrib%2Fgcc-changelog%2Ftest_patches.txt", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/a7ac3e92ecf251d5528eea4b46b5f42fd0168e43/contrib%2Fgcc-changelog%2Ftest_patches.txt", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/contrib%2Fgcc-changelog%2Ftest_patches.txt?ref=a7ac3e92ecf251d5528eea4b46b5f42fd0168e43", "patch": "@@ -3481,3 +3481,33 @@ index ac63591b33f..ff4d61764e7 100644\n +\n -- \n 2.29.2\n+\n+=== 0001-ChangeLog-removal.patch ===\n+From b39fadf9df1a9510afcab0a391182da7dc68de24 Mon Sep 17 00:00:00 2001\n+From: Martin Liska <mliska@suse.cz>\n+Date: Fri, 12 Mar 2021 09:10:55 +0100\n+Subject: [PATCH] Test ChangeLog removal.\n+\n+gcc/ChangeLog:\n+\n+\t* ipa-icf.c (make_pass_ipa_icf): Add line.\n+---\n+diff --git a/gcc/analyzer/ChangeLog b/gcc/analyzer/ChangeLog\n+deleted file mode 100644\n+index 94e87f6bcde..00000000000\n+--- a/gcc/analyzer/ChangeLog\n++++ /dev/null\n+@@ -1,1 +0,0 @@\n+- foo\n+diff --git a/gcc/ipa-icf.c b/gcc/ipa-icf.c\n+index 5dd33a75c3a..c4ce432cb98 100644\n+--- a/gcc/ipa-icf.c\n++++ b/gcc/ipa-icf.c\n+@@ -3655,3 +3655,4 @@ make_pass_ipa_icf (gcc::context *ctxt)\n+ {\n+   return new ipa_icf::pass_ipa_icf (ctxt);\n+ }\n++\n+-- \n+2.30.1\n+"}]}