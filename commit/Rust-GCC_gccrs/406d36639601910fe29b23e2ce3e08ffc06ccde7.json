{"sha": "406d36639601910fe29b23e2ce3e08ffc06ccde7", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6NDA2ZDM2NjM5NjAxOTEwZmUyOWIyM2UyY2UzZTA4ZmZjMDZjY2RlNw==", "commit": {"author": {"name": "Richard Biener", "email": "rguenther@suse.de", "date": "2014-06-05T17:34:48Z"}, "committer": {"name": "Paolo Carlini", "email": "paolo@gcc.gnu.org", "date": "2014-06-05T17:34:48Z"}, "message": "re PR c++/56961 (stack overflow in gimplifier with volatile field)\n\n/cp\n2014-06-05  Richard Biener  <rguenther@suse.de>\n\t    Paolo Carlini  <paolo.carlini@oracle.com>\n\n\tPR c++/56961\n\t* cp-gimplify.c (cp_gimplify_expr, [MODIFY_EXPR]): Rework\n\thandling of empty classes.\n\n/testsuite\n2014-06-05  Richard Biener  <rguenther@suse.de>\n\t    Paolo Carlini  <paolo.carlini@oracle.com>\n\n\tPR c++/56961\n\t* g++.dg/parse/pr56961.C: New.\n\nCo-Authored-By: Paolo Carlini <paolo.carlini@oracle.com>\n\nFrom-SVN: r211286", "tree": {"sha": "c27d51fa4c3f27fb65af1ff9e5f82b3521ba6ede", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/c27d51fa4c3f27fb65af1ff9e5f82b3521ba6ede"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/406d36639601910fe29b23e2ce3e08ffc06ccde7", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/406d36639601910fe29b23e2ce3e08ffc06ccde7", "html_url": "https://github.com/Rust-GCC/gccrs/commit/406d36639601910fe29b23e2ce3e08ffc06ccde7", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/406d36639601910fe29b23e2ce3e08ffc06ccde7/comments", "author": {"login": "rguenth", "id": 2046526, "node_id": "MDQ6VXNlcjIwNDY1MjY=", "avatar_url": "https://avatars.githubusercontent.com/u/2046526?v=4", "gravatar_id": "", "url": "https://api.github.com/users/rguenth", "html_url": "https://github.com/rguenth", "followers_url": "https://api.github.com/users/rguenth/followers", "following_url": "https://api.github.com/users/rguenth/following{/other_user}", "gists_url": "https://api.github.com/users/rguenth/gists{/gist_id}", "starred_url": "https://api.github.com/users/rguenth/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/rguenth/subscriptions", "organizations_url": "https://api.github.com/users/rguenth/orgs", "repos_url": "https://api.github.com/users/rguenth/repos", "events_url": "https://api.github.com/users/rguenth/events{/privacy}", "received_events_url": "https://api.github.com/users/rguenth/received_events", "type": "User", "site_admin": false}, "committer": null, "parents": [{"sha": "da4e26be993775444e460edd68c88a1ae6a6a16e", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/da4e26be993775444e460edd68c88a1ae6a6a16e", "html_url": "https://github.com/Rust-GCC/gccrs/commit/da4e26be993775444e460edd68c88a1ae6a6a16e"}], "stats": {"total": 46, "additions": 34, "deletions": 12}, "files": [{"sha": "45e10129a98645a0582f8e809a317f7fd6acea51", "filename": "gcc/cp/ChangeLog", "status": "modified", "additions": 7, "deletions": 0, "changes": 7, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/406d36639601910fe29b23e2ce3e08ffc06ccde7/gcc%2Fcp%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/406d36639601910fe29b23e2ce3e08ffc06ccde7/gcc%2Fcp%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fcp%2FChangeLog?ref=406d36639601910fe29b23e2ce3e08ffc06ccde7", "patch": "@@ -1,3 +1,10 @@\n+2014-06-05  Richard Biener  <rguenther@suse.de>\n+\t    Paolo Carlini  <paolo.carlini@oracle.com>\n+\n+\tPR c++/56961\n+\t* cp-gimplify.c (cp_gimplify_expr, [MODIFY_EXPR]): Rework\n+\thandling of empty classes.\n+\n 2014-06-04  Jason Merrill  <jason@redhat.com>\n \n \t* parser.c (cp_parser_diagnose_invalid_type_name): Give helpful note"}, {"sha": "2798358be6b1bc29105c036d514ba81cf3a7f112", "filename": "gcc/cp/cp-gimplify.c", "status": "modified", "additions": 5, "deletions": 12, "changes": 17, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/406d36639601910fe29b23e2ce3e08ffc06ccde7/gcc%2Fcp%2Fcp-gimplify.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/406d36639601910fe29b23e2ce3e08ffc06ccde7/gcc%2Fcp%2Fcp-gimplify.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fcp%2Fcp-gimplify.c?ref=406d36639601910fe29b23e2ce3e08ffc06ccde7", "patch": "@@ -629,19 +629,12 @@ cp_gimplify_expr (tree *expr_p, gimple_seq *pre_p, gimple_seq *post_p)\n \n \t       Also drop volatile variables on the RHS to avoid infinite\n \t       recursion from gimplify_expr trying to load the value.  */\n-\t    if (!TREE_SIDE_EFFECTS (op1)\n-\t\t|| (DECL_P (op1) && TREE_THIS_VOLATILE (op1)))\n+\t    if (!TREE_SIDE_EFFECTS (op1))\n \t      *expr_p = op0;\n-\t    else if (TREE_CODE (op1) == MEM_REF\n-\t\t     && TREE_THIS_VOLATILE (op1))\n-\t      {\n-\t\t/* Similarly for volatile MEM_REFs on the RHS.  */\n-\t\tif (!TREE_SIDE_EFFECTS (TREE_OPERAND (op1, 0)))\n-\t\t  *expr_p = op0;\n-\t\telse\n-\t\t  *expr_p = build2 (COMPOUND_EXPR, TREE_TYPE (*expr_p),\n-\t\t\t\t    TREE_OPERAND (op1, 0), op0);\n-\t      }\n+\t    else if (TREE_THIS_VOLATILE (op1)\n+\t\t     && (REFERENCE_CLASS_P (op1) || DECL_P (op1)))\n+\t      *expr_p = build2 (COMPOUND_EXPR, TREE_TYPE (*expr_p),\n+\t\t\t\tbuild_fold_addr_expr (op1), op0);\n \t    else\n \t      *expr_p = build2 (COMPOUND_EXPR, TREE_TYPE (*expr_p),\n \t\t\t\top0, op1);"}, {"sha": "54a4026d39ee319e4c8a59e2875f8fabdac3c171", "filename": "gcc/testsuite/ChangeLog", "status": "modified", "additions": 6, "deletions": 0, "changes": 6, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/406d36639601910fe29b23e2ce3e08ffc06ccde7/gcc%2Ftestsuite%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/406d36639601910fe29b23e2ce3e08ffc06ccde7/gcc%2Ftestsuite%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2FChangeLog?ref=406d36639601910fe29b23e2ce3e08ffc06ccde7", "patch": "@@ -1,3 +1,9 @@\n+2014-06-05  Richard Biener  <rguenther@suse.de>\n+\t    Paolo Carlini  <paolo.carlini@oracle.com>\n+\n+\tPR c++/56961\n+\t* g++.dg/parse/pr56961.C: New.\n+\n 2014-06-05  Kai Tietz  <ktietz@redhat.com>\n \n \tPR target/46219"}, {"sha": "c60cfdb17cd9bfde9a72caf6a4123960a046d09d", "filename": "gcc/testsuite/g++.dg/parse/pr56961.C", "status": "added", "additions": 16, "deletions": 0, "changes": 16, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/406d36639601910fe29b23e2ce3e08ffc06ccde7/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Fparse%2Fpr56961.C", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/406d36639601910fe29b23e2ce3e08ffc06ccde7/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Fparse%2Fpr56961.C", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Fparse%2Fpr56961.C?ref=406d36639601910fe29b23e2ce3e08ffc06ccde7", "patch": "@@ -0,0 +1,16 @@\n+// PR c++/56961\n+\n+struct foo { };\n+\n+typedef struct\n+{\n+  volatile foo fields;\n+} CSPHandleState;\n+ \n+CSPHandleState a;\n+\n+void fn1 ()\n+{\n+  CSPHandleState b;\n+  b.fields = foo();  // { dg-error \"discards qualifiers\" }\n+}"}]}