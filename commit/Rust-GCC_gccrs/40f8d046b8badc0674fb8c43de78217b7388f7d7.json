{"sha": "40f8d046b8badc0674fb8c43de78217b7388f7d7", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6NDBmOGQwNDZiOGJhZGMwNjc0ZmI4YzQzZGU3ODIxN2I3Mzg4ZjdkNw==", "commit": {"author": {"name": "Jim Wilson", "email": "wilson@gcc.gnu.org", "date": "1995-05-23T21:59:19Z"}, "committer": {"name": "Jim Wilson", "email": "wilson@gcc.gnu.org", "date": "1995-05-23T21:59:19Z"}, "message": "(embedded_pic_offset): Output RTL to initialize embedded_pic_fnaddr_rtx.\n\n(embedded_pic_offset): Output RTL to initialize\nembedded_pic_fnaddr_rtx.\n(mips_finalize_pic): Delete.\n\nFrom-SVN: r9785", "tree": {"sha": "5f7d61882e6f7bffed3ccfb015579afd48e8f828", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/5f7d61882e6f7bffed3ccfb015579afd48e8f828"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/40f8d046b8badc0674fb8c43de78217b7388f7d7", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/40f8d046b8badc0674fb8c43de78217b7388f7d7", "html_url": "https://github.com/Rust-GCC/gccrs/commit/40f8d046b8badc0674fb8c43de78217b7388f7d7", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/40f8d046b8badc0674fb8c43de78217b7388f7d7/comments", "author": null, "committer": null, "parents": [{"sha": "1d3534c0e71bac66e3ac1ec7d7a8071643c2bd1c", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/1d3534c0e71bac66e3ac1ec7d7a8071643c2bd1c", "html_url": "https://github.com/Rust-GCC/gccrs/commit/1d3534c0e71bac66e3ac1ec7d7a8071643c2bd1c"}], "stats": {"total": 52, "additions": 23, "deletions": 29}, "files": [{"sha": "d959a2ecf198f43f0c4c313a85dea115ba604952", "filename": "gcc/config/mips/mips.c", "status": "modified", "additions": 23, "deletions": 29, "changes": 52, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/40f8d046b8badc0674fb8c43de78217b7388f7d7/gcc%2Fconfig%2Fmips%2Fmips.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/40f8d046b8badc0674fb8c43de78217b7388f7d7/gcc%2Fconfig%2Fmips%2Fmips.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fconfig%2Fmips%2Fmips.c?ref=40f8d046b8badc0674fb8c43de78217b7388f7d7", "patch": "@@ -868,7 +868,29 @@ embedded_pic_offset (x)\n      rtx x;\n {\n   if (embedded_pic_fnaddr_rtx == NULL)\n-    embedded_pic_fnaddr_rtx = gen_reg_rtx (Pmode);\n+    {\n+      rtx seq;\n+\n+      embedded_pic_fnaddr_rtx = gen_reg_rtx (Pmode);\n+      \n+      /* Output code at function start to initialize the psuedo-reg.  */\n+      /* ??? We used to do this in FINALIZE_PIC, but that does not work for\n+\t inline functions, because it is called after RTL for the function\n+\t has been copied.  The pseudo-reg in embedded_pic_fnaddr_rtx however\n+\t does not get copied, and ends up not matching the rest of the RTL.\n+\t This solution works, but means that we get unnecessary code to\n+\t initialize this value everytime a function is inlined into another\n+\t function.  */\n+      start_sequence ();\n+      emit_insn (gen_get_fnaddr (embedded_pic_fnaddr_rtx,\n+\t\t\t\t XEXP (DECL_RTL (current_function_decl), 0)));\n+      seq = gen_sequence ();\n+      end_sequence ();\n+      push_topmost_sequence ();\n+      emit_insn_after (seq, get_insns ());\n+      pop_topmost_sequence ();\n+    }\n+\n   return gen_rtx (CONST, Pmode,\n \t\t  gen_rtx (MINUS, Pmode, x,\n \t\t\t   XEXP (DECL_RTL (current_function_decl), 0)));\n@@ -4362,34 +4384,6 @@ epilogue_reg_mentioned_p (insn)\n \n   return 0;\n }\n-\n-\f\n-/* When generating embedded PIC code we may need to get the address of\n-   the current function.  We will need it if we take the address of\n-   any symbol in the .text section.  */\n-\n-void\n-mips_finalize_pic ()\n-{\n-  rtx seq;\n-\n-  if (! TARGET_EMBEDDED_PIC)\n-    return;\n-  if (embedded_pic_fnaddr_rtx == NULL)\n-    return;\n-\n-  start_sequence ();\n-\n-  emit_insn (gen_get_fnaddr (embedded_pic_fnaddr_rtx,\n-\t\t\t     XEXP (DECL_RTL (current_function_decl), 0)));\n-\n-  seq = gen_sequence ();\n-  end_sequence ();\n-  emit_insn_after (seq, get_insns ());\n-\n-  embedded_pic_fnaddr_rtx = NULL;\n-}\n-\n \f\n /* Return the bytes needed to compute the frame pointer from the current\n    stack pointer."}]}