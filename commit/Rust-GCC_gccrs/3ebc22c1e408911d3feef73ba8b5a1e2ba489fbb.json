{"sha": "3ebc22c1e408911d3feef73ba8b5a1e2ba489fbb", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6M2ViYzIyYzFlNDA4OTExZDNmZWVmNzNiYThiNWExZTJiYTQ4OWZiYg==", "commit": {"author": {"name": "Jason Merrill", "email": "jason@redhat.com", "date": "2012-07-20T16:11:42Z"}, "committer": {"name": "Jason Merrill", "email": "jason@gcc.gnu.org", "date": "2012-07-20T16:11:42Z"}, "message": "re PR c++/54038 (finalize_type_size enters infinite loop becasue TYPE_NEXT_VARIANT (variant) == variant)\n\n\tPR c++/54038\n\t* tree.c (build_cplus_array_type): Use build_cplus_array_type to build\n\tcanonical array type rather than mess with its TYPE_*_VARIANT.\n\nFrom-SVN: r189719", "tree": {"sha": "c50f09207e4e60b41c1786f4e6a950f99331fae3", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/c50f09207e4e60b41c1786f4e6a950f99331fae3"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/3ebc22c1e408911d3feef73ba8b5a1e2ba489fbb", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/3ebc22c1e408911d3feef73ba8b5a1e2ba489fbb", "html_url": "https://github.com/Rust-GCC/gccrs/commit/3ebc22c1e408911d3feef73ba8b5a1e2ba489fbb", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/3ebc22c1e408911d3feef73ba8b5a1e2ba489fbb/comments", "author": {"login": "jicama", "id": 266146, "node_id": "MDQ6VXNlcjI2NjE0Ng==", "avatar_url": "https://avatars.githubusercontent.com/u/266146?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jicama", "html_url": "https://github.com/jicama", "followers_url": "https://api.github.com/users/jicama/followers", "following_url": "https://api.github.com/users/jicama/following{/other_user}", "gists_url": "https://api.github.com/users/jicama/gists{/gist_id}", "starred_url": "https://api.github.com/users/jicama/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jicama/subscriptions", "organizations_url": "https://api.github.com/users/jicama/orgs", "repos_url": "https://api.github.com/users/jicama/repos", "events_url": "https://api.github.com/users/jicama/events{/privacy}", "received_events_url": "https://api.github.com/users/jicama/received_events", "type": "User", "site_admin": false}, "committer": null, "parents": [{"sha": "824f71b9ff74b82e1c125d98a946ffe9fb4ab319", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/824f71b9ff74b82e1c125d98a946ffe9fb4ab319", "html_url": "https://github.com/Rust-GCC/gccrs/commit/824f71b9ff74b82e1c125d98a946ffe9fb4ab319"}], "stats": {"total": 43, "additions": 32, "deletions": 11}, "files": [{"sha": "07ed0a0a5eb306fd07dc7f330290211c750465b6", "filename": "gcc/cp/ChangeLog", "status": "modified", "additions": 6, "deletions": 0, "changes": 6, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/3ebc22c1e408911d3feef73ba8b5a1e2ba489fbb/gcc%2Fcp%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/3ebc22c1e408911d3feef73ba8b5a1e2ba489fbb/gcc%2Fcp%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fcp%2FChangeLog?ref=3ebc22c1e408911d3feef73ba8b5a1e2ba489fbb", "patch": "@@ -1,3 +1,9 @@\n+2012-07-20  Jason Merrill  <jason@redhat.com>\n+\n+\tPR c++/54038\n+\t* tree.c (build_cplus_array_type): Use build_cplus_array_type to build\n+\tcanonical array type rather than mess with its TYPE_*_VARIANT.\n+\n 2012-07-19  Jason Merrill  <jason@redhat.com>\n \n \tPR c++/54026"}, {"sha": "83b8ca7ad1c2a98de5910b1a2cc8274ee8dd363e", "filename": "gcc/cp/tree.c", "status": "modified", "additions": 12, "deletions": 11, "changes": 23, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/3ebc22c1e408911d3feef73ba8b5a1e2ba489fbb/gcc%2Fcp%2Ftree.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/3ebc22c1e408911d3feef73ba8b5a1e2ba489fbb/gcc%2Fcp%2Ftree.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fcp%2Ftree.c?ref=3ebc22c1e408911d3feef73ba8b5a1e2ba489fbb", "patch": "@@ -795,31 +795,32 @@ build_cplus_array_type (tree elt_type, tree index_type)\n \t}\n     }\n   else\n-    t = build_array_type (elt_type, index_type);\n+    {\n+      if (!TYPE_STRUCTURAL_EQUALITY_P (elt_type)\n+\t  && !(index_type && TYPE_STRUCTURAL_EQUALITY_P (index_type))\n+\t  && (TYPE_CANONICAL (elt_type) != elt_type\n+\t      || (index_type && TYPE_CANONICAL (index_type) != index_type)))\n+\t/* Make sure that the canonical type is on the appropriate\n+\t   variants list.  */\n+\tbuild_cplus_array_type\n+\t  (TYPE_CANONICAL (elt_type),\n+\t   index_type ? TYPE_CANONICAL (index_type) : index_type);\n+      t = build_array_type (elt_type, index_type);\n+    }\n \n   /* We want TYPE_MAIN_VARIANT of an array to strip cv-quals from the\n      element type as well, so fix it up if needed.  */\n   if (elt_type != TYPE_MAIN_VARIANT (elt_type))\n     {\n       tree m = build_cplus_array_type (TYPE_MAIN_VARIANT (elt_type),\n \t\t\t\t       index_type);\n-      tree c = TYPE_CANONICAL (t);\n \n       if (TYPE_MAIN_VARIANT (t) != m)\n \t{\n \t  TYPE_MAIN_VARIANT (t) = m;\n \t  TYPE_NEXT_VARIANT (t) = TYPE_NEXT_VARIANT (m);\n \t  TYPE_NEXT_VARIANT (m) = t;\n \t}\n-\n-      /* If we built a new array type for TYPE_CANONICAL, add\n-\t that to the list of variants as well.  */\n-      if (c && c != t && TYPE_MAIN_VARIANT (c) != m)\n-\t{\n-\t  TYPE_MAIN_VARIANT (c) = m;\n-\t  TYPE_NEXT_VARIANT (c) = t;\n-\t  TYPE_NEXT_VARIANT (m) = c;\n-\t}\n     }\n \n   /* Push these needs up so that initialization takes place"}, {"sha": "6759427b466a944b2e479da39d18dec0602d14e7", "filename": "gcc/testsuite/ChangeLog", "status": "modified", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/3ebc22c1e408911d3feef73ba8b5a1e2ba489fbb/gcc%2Ftestsuite%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/3ebc22c1e408911d3feef73ba8b5a1e2ba489fbb/gcc%2Ftestsuite%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2FChangeLog?ref=3ebc22c1e408911d3feef73ba8b5a1e2ba489fbb", "patch": "@@ -1,3 +1,8 @@\n+2012-07-20  Jason Merrill  <jason@redhat.com>\n+\n+\tPR c++/54038\n+\t* g++.dg/other/array7.C: New.\n+\n 2012-07-20  Steven Bosscher  <steven@gcc.gnu.org>\n \n \t* gcc.dg/tree-prof/update-loopch.c: Look for counts on the dumps of"}, {"sha": "72322f06308bc56e837281e153d5a9b3d4f588ea", "filename": "gcc/testsuite/g++.dg/other/array7.C", "status": "added", "additions": 9, "deletions": 0, "changes": 9, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/3ebc22c1e408911d3feef73ba8b5a1e2ba489fbb/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Fother%2Farray7.C", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/3ebc22c1e408911d3feef73ba8b5a1e2ba489fbb/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Fother%2Farray7.C", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Fother%2Farray7.C?ref=3ebc22c1e408911d3feef73ba8b5a1e2ba489fbb", "patch": "@@ -0,0 +1,9 @@\n+// PR c++/54038\n+\n+extern const char *const v[];\n+typedef char T;\n+void foo (const T *const[]);\n+struct A\n+{\n+  static const char *const a[];\n+};"}]}