{"sha": "c83faba13da6d67e6784b3781419cd0605700daf", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6YzgzZmFiYTEzZGE2ZDY3ZTY3ODRiMzc4MTQxOWNkMDYwNTcwMGRhZg==", "commit": {"author": {"name": "Segher Boessenkool", "email": "segher@kernel.crashing.org", "date": "2019-07-08T21:14:33Z"}, "committer": {"name": "Segher Boessenkool", "email": "segher@gcc.gnu.org", "date": "2019-07-08T21:14:33Z"}, "message": "rs6000: Ignore GFXOPT (and GPOPT) for choosing machine\n\nThe function rs6000_machine_from_flags chooses what .machine string to\nused based on the rs6000_isa_flags flags.  For that it checks for each\nISA level if something for its ISA_*_MASKS is selected.\n\nThis does not work for GFXOPT and GPOPT: these are set as flags in\nISA_2_5_MASKS_SERVER, but they aren't actually new there, they just\nare not selected by default for older ISAs (they were optional).\n\nThis patch makes OPTION_MASK_PPC_GFXOPT and OPTION_MASK_PPC_GPOPT not\ninfluence the .machine selection.\n\n\n\t* config/rs6000/rs6000.c (rs6000_machine_from_flags): Ignore\n\tOPTION_MASK_PPC_GFXOPT and OPTION_MASK_PPC_GPOPT for selecting the\n\t.machine string.\n\nFrom-SVN: r273246", "tree": {"sha": "7f72d03e9ff5409df427379540cd6774fcb7e799", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/7f72d03e9ff5409df427379540cd6774fcb7e799"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/c83faba13da6d67e6784b3781419cd0605700daf", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/c83faba13da6d67e6784b3781419cd0605700daf", "html_url": "https://github.com/Rust-GCC/gccrs/commit/c83faba13da6d67e6784b3781419cd0605700daf", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/c83faba13da6d67e6784b3781419cd0605700daf/comments", "author": {"login": "segher", "id": 417629, "node_id": "MDQ6VXNlcjQxNzYyOQ==", "avatar_url": "https://avatars.githubusercontent.com/u/417629?v=4", "gravatar_id": "", "url": "https://api.github.com/users/segher", "html_url": "https://github.com/segher", "followers_url": "https://api.github.com/users/segher/followers", "following_url": "https://api.github.com/users/segher/following{/other_user}", "gists_url": "https://api.github.com/users/segher/gists{/gist_id}", "starred_url": "https://api.github.com/users/segher/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/segher/subscriptions", "organizations_url": "https://api.github.com/users/segher/orgs", "repos_url": "https://api.github.com/users/segher/repos", "events_url": "https://api.github.com/users/segher/events{/privacy}", "received_events_url": "https://api.github.com/users/segher/received_events", "type": "User", "site_admin": false}, "committer": null, "parents": [{"sha": "9d9171550a399cac1d1717cf1bd31ec3750b0dfd", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/9d9171550a399cac1d1717cf1bd31ec3750b0dfd", "html_url": "https://github.com/Rust-GCC/gccrs/commit/9d9171550a399cac1d1717cf1bd31ec3750b0dfd"}], "stats": {"total": 28, "additions": 19, "deletions": 9}, "files": [{"sha": "db0cf7e0508b67f25ebe3f7372485ea61297bd5c", "filename": "gcc/ChangeLog", "status": "modified", "additions": 6, "deletions": 0, "changes": 6, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/c83faba13da6d67e6784b3781419cd0605700daf/gcc%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/c83faba13da6d67e6784b3781419cd0605700daf/gcc%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2FChangeLog?ref=c83faba13da6d67e6784b3781419cd0605700daf", "patch": "@@ -1,3 +1,9 @@\n+2019-07-08  Segher Boessenkool  <segher@kernel.crashing.org>\n+\n+\t* config/rs6000/rs6000.c (rs6000_machine_from_flags): Ignore\n+\tOPTION_MASK_PPC_GFXOPT and OPTION_MASK_PPC_GPOPT for selecting the\n+\t.machine string.\n+\n 2019-07-08  Segher Boessenkool  <segher@kernel.crashing.org>\n \n \tPR rtl-optimization/88233"}, {"sha": "bec3436ffc5bee8c9ee9b80aabc8650b1b7e74c2", "filename": "gcc/config/rs6000/rs6000.c", "status": "modified", "additions": 13, "deletions": 9, "changes": 22, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/c83faba13da6d67e6784b3781419cd0605700daf/gcc%2Fconfig%2Frs6000%2Frs6000.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/c83faba13da6d67e6784b3781419cd0605700daf/gcc%2Fconfig%2Frs6000%2Frs6000.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fconfig%2Frs6000%2Frs6000.c?ref=c83faba13da6d67e6784b3781419cd0605700daf", "patch": "@@ -5547,22 +5547,26 @@ const char *rs6000_machine;\n const char *\n rs6000_machine_from_flags (void)\n {\n-  if ((rs6000_isa_flags & (ISA_FUTURE_MASKS_SERVER & ~ISA_3_0_MASKS_SERVER))\n-      != 0)\n+  HOST_WIDE_INT flags = rs6000_isa_flags;\n+\n+  /* Disable the flags that should never influence the .machine selection.  */\n+  flags &= ~(OPTION_MASK_PPC_GFXOPT | OPTION_MASK_PPC_GPOPT);\n+\n+  if ((flags & (ISA_FUTURE_MASKS_SERVER & ~ISA_3_0_MASKS_SERVER)) != 0)\n     return \"future\";\n-  if ((rs6000_isa_flags & (ISA_3_0_MASKS_SERVER & ~ISA_2_7_MASKS_SERVER)) != 0)\n+  if ((flags & (ISA_3_0_MASKS_SERVER & ~ISA_2_7_MASKS_SERVER)) != 0)\n     return \"power9\";\n-  if ((rs6000_isa_flags & (ISA_2_7_MASKS_SERVER & ~ISA_2_6_MASKS_SERVER)) != 0)\n+  if ((flags & (ISA_2_7_MASKS_SERVER & ~ISA_2_6_MASKS_SERVER)) != 0)\n     return \"power8\";\n-  if ((rs6000_isa_flags & (ISA_2_6_MASKS_SERVER & ~ISA_2_5_MASKS_SERVER)) != 0)\n+  if ((flags & (ISA_2_6_MASKS_SERVER & ~ISA_2_5_MASKS_SERVER)) != 0)\n     return \"power7\";\n-  if ((rs6000_isa_flags & (ISA_2_5_MASKS_SERVER & ~ISA_2_4_MASKS)) != 0)\n+  if ((flags & (ISA_2_5_MASKS_SERVER & ~ISA_2_4_MASKS)) != 0)\n     return \"power6\";\n-  if ((rs6000_isa_flags & (ISA_2_4_MASKS & ~ISA_2_1_MASKS)) != 0)\n+  if ((flags & (ISA_2_4_MASKS & ~ISA_2_1_MASKS)) != 0)\n     return \"power5\";\n-  if ((rs6000_isa_flags & ISA_2_1_MASKS) != 0)\n+  if ((flags & ISA_2_1_MASKS) != 0)\n     return \"power4\";\n-  if ((rs6000_isa_flags & OPTION_MASK_POWERPC64) != 0)\n+  if ((flags & OPTION_MASK_POWERPC64) != 0)\n     return \"ppc64\";\n   return \"ppc\";\n }"}]}