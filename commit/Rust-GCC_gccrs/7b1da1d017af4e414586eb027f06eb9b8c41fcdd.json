{"sha": "7b1da1d017af4e414586eb027f06eb9b8c41fcdd", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6N2IxZGExZDAxN2FmNGU0MTQ1ODZlYjAyN2YwNmViOWI4YzQxZmNkZA==", "commit": {"author": {"name": "Javier Miranda", "email": "miranda@adacore.com", "date": "2005-03-18T11:48:05Z"}, "committer": {"name": "Arnaud Charlet", "email": "charlet@gcc.gnu.org", "date": "2005-03-18T11:48:05Z"}, "message": "einfo.adb (First_Private_Entity, [...]): Addition of one barrier to avoid wrong usage of this attribute.\n\n2005-03-17  Javier Miranda  <miranda@adacore.com>\n\n\t* einfo.adb (First_Private_Entity, Set_First_Private_Entity): Addition\n\tof one barrier to avoid wrong usage of this attribute.\n\n\t* sem_ch12.adb (Formal_Entity): Fix erroneous usage of the attribute\n\tFirst_Private_Entity.\n\n\t* sem_ch7.adb (Install_Visible_Declarations): Add a barrier to protect\n\tthe subprogram against wrong usage.\n\tAdapt the code to traverse the entities in the\n\tscope of a record_type because in addition to its usage regarding\n\tpackages, this subprogram is also called by Expand_N_Freeze_Entity\n\tto install the visible declarations of the enclosing scope of a\n\trecord_type_with_private to establish the proper visibility before\n\tfreezing the entity and related subprograms.\n\nFrom-SVN: r96664", "tree": {"sha": "d2cdf3aa14acc3f051135a94e65cead5681dcdf6", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/d2cdf3aa14acc3f051135a94e65cead5681dcdf6"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/7b1da1d017af4e414586eb027f06eb9b8c41fcdd", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/7b1da1d017af4e414586eb027f06eb9b8c41fcdd", "html_url": "https://github.com/Rust-GCC/gccrs/commit/7b1da1d017af4e414586eb027f06eb9b8c41fcdd", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/7b1da1d017af4e414586eb027f06eb9b8c41fcdd/comments", "author": {"login": "miranda-adacore", "id": 54413934, "node_id": "MDQ6VXNlcjU0NDEzOTM0", "avatar_url": "https://avatars.githubusercontent.com/u/54413934?v=4", "gravatar_id": "", "url": "https://api.github.com/users/miranda-adacore", "html_url": "https://github.com/miranda-adacore", "followers_url": "https://api.github.com/users/miranda-adacore/followers", "following_url": "https://api.github.com/users/miranda-adacore/following{/other_user}", "gists_url": "https://api.github.com/users/miranda-adacore/gists{/gist_id}", "starred_url": "https://api.github.com/users/miranda-adacore/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/miranda-adacore/subscriptions", "organizations_url": "https://api.github.com/users/miranda-adacore/orgs", "repos_url": "https://api.github.com/users/miranda-adacore/repos", "events_url": "https://api.github.com/users/miranda-adacore/events{/privacy}", "received_events_url": "https://api.github.com/users/miranda-adacore/received_events", "type": "User", "site_admin": false}, "committer": null, "parents": [{"sha": "5e77b60afdb1ef7b0a6b3a711bd71560dc7c00d4", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/5e77b60afdb1ef7b0a6b3a711bd71560dc7c00d4", "html_url": "https://github.com/Rust-GCC/gccrs/commit/5e77b60afdb1ef7b0a6b3a711bd71560dc7c00d4"}], "stats": {"total": 28, "additions": 24, "deletions": 4}, "files": [{"sha": "20327cb6d4bf9b55509ac9e985be4da814436901", "filename": "gcc/ada/einfo.adb", "status": "modified", "additions": 12, "deletions": 1, "changes": 13, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/7b1da1d017af4e414586eb027f06eb9b8c41fcdd/gcc%2Fada%2Feinfo.adb", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/7b1da1d017af4e414586eb027f06eb9b8c41fcdd/gcc%2Fada%2Feinfo.adb", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fada%2Feinfo.adb?ref=7b1da1d017af4e414586eb027f06eb9b8c41fcdd", "patch": "@@ -1003,6 +1003,12 @@ package body Einfo is\n \n    function First_Private_Entity (Id : E) return E is\n    begin\n+      pragma Assert (Ekind (Id) = E_Package\n+                       or else Ekind (Id) = E_Generic_Package\n+                       or else Ekind (Id) = E_Protected_Type\n+                       or else Ekind (Id) = E_Protected_Subtype\n+                       or else Ekind (Id) = E_Task_Type\n+                       or else Ekind (Id) = E_Task_Subtype);\n       return Node16 (Id);\n    end First_Private_Entity;\n \n@@ -2981,7 +2987,12 @@ package body Einfo is\n \n    procedure Set_First_Private_Entity (Id : E; V : E) is\n    begin\n-      pragma Assert (Nkind (Id) in N_Entity);\n+      pragma Assert (Ekind (Id) = E_Package\n+                       or else Ekind (Id) = E_Generic_Package\n+                       or else Ekind (Id) = E_Protected_Type\n+                       or else Ekind (Id) = E_Protected_Subtype\n+                       or else Ekind (Id) = E_Task_Type\n+                       or else Ekind (Id) = E_Task_Subtype);\n       Set_Node16 (Id, V);\n    end Set_First_Private_Entity;\n "}, {"sha": "661ac7651bc45d0d1dbcc8ba4dd1e08a77ab4580", "filename": "gcc/ada/sem_ch12.adb", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/7b1da1d017af4e414586eb027f06eb9b8c41fcdd/gcc%2Fada%2Fsem_ch12.adb", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/7b1da1d017af4e414586eb027f06eb9b8c41fcdd/gcc%2Fada%2Fsem_ch12.adb", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fada%2Fsem_ch12.adb?ref=7b1da1d017af4e414586eb027f06eb9b8c41fcdd", "patch": "@@ -6518,7 +6518,7 @@ package body Sem_Ch12 is\n \n                   while Present (Actual_Ent)\n                     and then Present (Formal_Node)\n-                    and then Actual_Ent /= First_Private_Entity (Act_Ent)\n+                    and then Actual_Ent /= First_Private_Entity (Act_Pkg)\n                   loop\n                      --  ???  Are the following calls also needed here:\n                      --"}, {"sha": "5660b1555a4c9c6d791f200047c1cd80f83b0653", "filename": "gcc/ada/sem_ch7.adb", "status": "modified", "additions": 11, "deletions": 2, "changes": 13, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/7b1da1d017af4e414586eb027f06eb9b8c41fcdd/gcc%2Fada%2Fsem_ch7.adb", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/7b1da1d017af4e414586eb027f06eb9b8c41fcdd/gcc%2Fada%2Fsem_ch7.adb", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fada%2Fsem_ch7.adb?ref=7b1da1d017af4e414586eb027f06eb9b8c41fcdd", "patch": "@@ -1506,12 +1506,21 @@ package body Sem_Ch7 is\n    ----------------------------------\n \n    procedure Install_Visible_Declarations (P : Entity_Id) is\n-      Id : Entity_Id;\n+      Id          : Entity_Id;\n+      Last_Entity : Entity_Id;\n \n    begin\n+      pragma Assert (Is_Package (P) or else Is_Record_Type (P));\n+\n+      if Is_Package (P) then\n+         Last_Entity := First_Private_Entity (P);\n+      else\n+         Last_Entity := Empty;\n+      end if;\n+\n       Id := First_Entity (P);\n \n-      while Present (Id) and then Id /= First_Private_Entity (P) loop\n+      while Present (Id) and then Id /= Last_Entity loop\n          Install_Package_Entity (Id);\n          Next_Entity (Id);\n       end loop;"}]}