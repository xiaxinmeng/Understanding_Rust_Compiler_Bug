{"sha": "c39276b8d6b5046e860625202dbc94b8be5ce093", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6YzM5Mjc2YjhkNmI1MDQ2ZTg2MDYyNTIwMmRiYzk0YjhiZTVjZTA5Mw==", "commit": {"author": {"name": "Richard Biener", "email": "rguenther@suse.de", "date": "2014-02-04T14:53:24Z"}, "committer": {"name": "Richard Biener", "email": "rguenth@gcc.gnu.org", "date": "2014-02-04T14:53:24Z"}, "message": "re PR lto/59723 (ICE: in lto_output_tree, at lto-streamer-out.c:1390 when compiling some Fortran tests with -flto)\n\n2014-02-04  Richard Biener  <rguenther@suse.de>\n\n\tPR lto/59723\n\t* lto-streamer-out.c (tree_is_indexable): Force NAMELIST_DECLs\n\tin function context local.\n\t(lto_output_tree_ref): Do not write trees from lto_output_tree_ref.\n\t* lto-streamer-in.c (lto_input_tree_ref): Handle LTO_namelist_decl_ref\n\tsimilar to LTO_imported_decl_ref.\n\n\tlto/\n\t* lto.c (mentions_vars_p): Handle NAMELIST_DECL.\n\t(lto_fixup_prevailing_decls): Handle fixing up CONSTRUCTOR values.\n\nFrom-SVN: r207471", "tree": {"sha": "24390526b3202113732fbbc802698a5f6e95ed74", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/24390526b3202113732fbbc802698a5f6e95ed74"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/c39276b8d6b5046e860625202dbc94b8be5ce093", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/c39276b8d6b5046e860625202dbc94b8be5ce093", "html_url": "https://github.com/Rust-GCC/gccrs/commit/c39276b8d6b5046e860625202dbc94b8be5ce093", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/c39276b8d6b5046e860625202dbc94b8be5ce093/comments", "author": {"login": "rguenth", "id": 2046526, "node_id": "MDQ6VXNlcjIwNDY1MjY=", "avatar_url": "https://avatars.githubusercontent.com/u/2046526?v=4", "gravatar_id": "", "url": "https://api.github.com/users/rguenth", "html_url": "https://github.com/rguenth", "followers_url": "https://api.github.com/users/rguenth/followers", "following_url": "https://api.github.com/users/rguenth/following{/other_user}", "gists_url": "https://api.github.com/users/rguenth/gists{/gist_id}", "starred_url": "https://api.github.com/users/rguenth/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/rguenth/subscriptions", "organizations_url": "https://api.github.com/users/rguenth/orgs", "repos_url": "https://api.github.com/users/rguenth/repos", "events_url": "https://api.github.com/users/rguenth/events{/privacy}", "received_events_url": "https://api.github.com/users/rguenth/received_events", "type": "User", "site_admin": false}, "committer": null, "parents": [{"sha": "3e247e586cb2b7cdc3519b3dddd1c50749a810ce", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/3e247e586cb2b7cdc3519b3dddd1c50749a810ce", "html_url": "https://github.com/Rust-GCC/gccrs/commit/3e247e586cb2b7cdc3519b3dddd1c50749a810ce"}], "stats": {"total": 67, "additions": 30, "deletions": 37}, "files": [{"sha": "99a153bda842c2c35cf45878dc3acbd4c2144637", "filename": "gcc/ChangeLog", "status": "modified", "additions": 9, "deletions": 0, "changes": 9, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/c39276b8d6b5046e860625202dbc94b8be5ce093/gcc%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/c39276b8d6b5046e860625202dbc94b8be5ce093/gcc%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2FChangeLog?ref=c39276b8d6b5046e860625202dbc94b8be5ce093", "patch": "@@ -1,3 +1,12 @@\n+2014-02-04  Richard Biener  <rguenther@suse.de>\n+\n+\tPR lto/59723\n+\t* lto-streamer-out.c (tree_is_indexable): Force NAMELIST_DECLs\n+\tin function context local.\n+\t(lto_output_tree_ref): Do not write trees from lto_output_tree_ref.\n+\t* lto-streamer-in.c (lto_input_tree_ref): Handle LTO_namelist_decl_ref\n+\tsimilar to LTO_imported_decl_ref.\n+\n 2014-02-04  Jakub Jelinek  <jakub@redhat.com>\n \n \tPR tree-optimization/60002"}, {"sha": "68d3cdac41f5ee499bfbc4d54b581f0a34d0b580", "filename": "gcc/lto-streamer-in.c", "status": "modified", "additions": 1, "deletions": 22, "changes": 23, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/c39276b8d6b5046e860625202dbc94b8be5ce093/gcc%2Flto-streamer-in.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/c39276b8d6b5046e860625202dbc94b8be5ce093/gcc%2Flto-streamer-in.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Flto-streamer-in.c?ref=c39276b8d6b5046e860625202dbc94b8be5ce093", "patch": "@@ -244,32 +244,11 @@ lto_input_tree_ref (struct lto_input_block *ib, struct data_in *data_in,\n     case LTO_imported_decl_ref:\n     case LTO_label_decl_ref:\n     case LTO_translation_unit_decl_ref:\n+    case LTO_namelist_decl_ref:\n       ix_u = streamer_read_uhwi (ib);\n       result = lto_file_decl_data_get_var_decl (data_in->file_data, ix_u);\n       break;\n \n-    case LTO_namelist_decl_ref:\n-      {\n-\ttree tmp;\n-\tvec<constructor_elt, va_gc> *nml_decls = NULL;\n-\tunsigned i, n;\n-\n-\tresult = make_node (NAMELIST_DECL);\n-\tTREE_TYPE (result) = void_type_node;\n-\tDECL_NAME (result) = stream_read_tree (ib, data_in);\n-\tn = streamer_read_uhwi (ib);\n-\tfor (i = 0; i < n; i++)\n-\t  {\n-\t    ix_u = streamer_read_uhwi (ib);\n-\t    tmp = lto_file_decl_data_get_var_decl (data_in->file_data, ix_u);\n-\t    gcc_assert (tmp != NULL_TREE);\n-\t    CONSTRUCTOR_APPEND_ELT (nml_decls, NULL_TREE, tmp);\n-\t  }\n-\tNAMELIST_DECL_ASSOCIATED_DECL (result) = build_constructor (NULL_TREE,\n-\t\t\t\t\t\t\t\t    nml_decls);\n-\tbreak;\n-      }\n-\n     default:\n       gcc_unreachable ();\n     }"}, {"sha": "94d2aa73dddd391fd99f84a8ecbfcc7ac322af9a", "filename": "gcc/lto-streamer-out.c", "status": "modified", "additions": 5, "deletions": 14, "changes": 19, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/c39276b8d6b5046e860625202dbc94b8be5ce093/gcc%2Flto-streamer-out.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/c39276b8d6b5046e860625202dbc94b8be5ce093/gcc%2Flto-streamer-out.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Flto-streamer-out.c?ref=c39276b8d6b5046e860625202dbc94b8be5ce093", "patch": "@@ -139,7 +139,8 @@ tree_is_indexable (tree t)\n     return variably_modified_type_p (TREE_TYPE (DECL_CONTEXT (t)), NULL_TREE);\n   else if (((TREE_CODE (t) == VAR_DECL && !TREE_STATIC (t))\n \t    || TREE_CODE (t) == TYPE_DECL\n-\t    || TREE_CODE (t) == CONST_DECL)\n+\t    || TREE_CODE (t) == CONST_DECL\n+\t    || TREE_CODE (t) == NAMELIST_DECL)\n \t   && decl_function_context (t))\n     return false;\n   else if (TREE_CODE (t) == DEBUG_EXPR_DECL)\n@@ -255,19 +256,9 @@ lto_output_tree_ref (struct output_block *ob, tree expr)\n       break;\n \n     case NAMELIST_DECL:\n-      {\n-\tunsigned i;\n-\ttree value, tmp;\n-\n-\tstreamer_write_record_start (ob, LTO_namelist_decl_ref);\n-\tstream_write_tree (ob, DECL_NAME (expr), true);\n-\ttmp = NAMELIST_DECL_ASSOCIATED_DECL (expr);\n-\tgcc_assert (tmp != NULL_TREE);\n-\tstreamer_write_uhwi (ob, CONSTRUCTOR_ELTS (tmp)->length());\n-\tFOR_EACH_CONSTRUCTOR_VALUE (CONSTRUCTOR_ELTS (tmp), i, value)\n-\t  lto_output_var_decl_index (ob->decl_state, ob->main_stream, value);\n-\tbreak;\n-      }\n+      streamer_write_record_start (ob, LTO_namelist_decl_ref);\n+      lto_output_var_decl_index (ob->decl_state, ob->main_stream, expr);\n+      break;\n \n     case NAMESPACE_DECL:\n       streamer_write_record_start (ob, LTO_namespace_decl_ref);"}, {"sha": "437e97e99f828fbc25000f64210a95d3c66f3eeb", "filename": "gcc/lto/ChangeLog", "status": "modified", "additions": 6, "deletions": 0, "changes": 6, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/c39276b8d6b5046e860625202dbc94b8be5ce093/gcc%2Flto%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/c39276b8d6b5046e860625202dbc94b8be5ce093/gcc%2Flto%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Flto%2FChangeLog?ref=c39276b8d6b5046e860625202dbc94b8be5ce093", "patch": "@@ -1,3 +1,9 @@\n+2014-02-04  Richard Biener  <rguenther@suse.de>\n+\n+\tPR lto/59723\n+\t* lto.c (mentions_vars_p): Handle NAMELIST_DECL.\n+\t(lto_fixup_prevailing_decls): Handle fixing up CONSTRUCTOR values.\n+\n 2014-02-04  Jan Hubicka  <hubicka@ucw.cz>\n \t    Markus Trippelsdorf\n "}, {"sha": "a769f25a21488192568cbd997e4efaf287e8c8bb", "filename": "gcc/lto/lto.c", "status": "modified", "additions": 9, "deletions": 1, "changes": 10, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/c39276b8d6b5046e860625202dbc94b8be5ce093/gcc%2Flto%2Flto.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/c39276b8d6b5046e860625202dbc94b8be5ce093/gcc%2Flto%2Flto.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Flto%2Flto.c?ref=c39276b8d6b5046e860625202dbc94b8be5ce093", "patch": "@@ -926,6 +926,7 @@ mentions_vars_p (tree t)\n     case RESULT_DECL:\n     case IMPORTED_DECL:\n     case NAMESPACE_DECL:\n+    case NAMELIST_DECL:\n       return mentions_vars_p_decl_common (t);\n \n     case VAR_DECL:\n@@ -2597,7 +2598,7 @@ lto_fixup_prevailing_decls (tree t)\n   enum tree_code code = TREE_CODE (t);\n   bool fixed = false;\n \n-  gcc_checking_assert (code != CONSTRUCTOR && code != TREE_BINFO);\n+  gcc_checking_assert (code != TREE_BINFO);\n   LTO_NO_PREVAIL (TREE_TYPE (t));\n   if (CODE_CONTAINS_STRUCT (code, TS_COMMON))\n     LTO_NO_PREVAIL (TREE_CHAIN (t));\n@@ -2659,6 +2660,13 @@ lto_fixup_prevailing_decls (tree t)\n       for (i = TREE_OPERAND_LENGTH (t) - 1; i >= 0; --i)\n \tLTO_SET_PREVAIL (TREE_OPERAND (t, i));\n     }\n+  else if (TREE_CODE (t) == CONSTRUCTOR)\n+    {\n+      unsigned i;\n+      tree val;\n+      FOR_EACH_CONSTRUCTOR_VALUE (CONSTRUCTOR_ELTS (t), i, val)\n+\tLTO_SET_PREVAIL (val);\n+    }\n   else\n     {\n       switch (code)"}]}