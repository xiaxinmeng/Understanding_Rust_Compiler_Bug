{"sha": "be771f25275b5d4d1c7033d4d66f1412733f7046", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6YmU3NzFmMjUyNzViNWQ0ZDFjNzAzM2Q0ZDY2ZjE0MTI3MzNmNzA0Ng==", "commit": {"author": {"name": "Jason Merrill", "email": "jason@redhat.com", "date": "2011-02-10T16:30:20Z"}, "committer": {"name": "Jason Merrill", "email": "jason@gcc.gnu.org", "date": "2011-02-10T16:30:20Z"}, "message": "decl.c (cp_make_fname_decl): Set DECL_THIS_STATIC at toplevel.\n\n\t* decl.c (cp_make_fname_decl): Set DECL_THIS_STATIC at toplevel.\n\t* semantics.c (finish_fname): Only return the name if we're in\n\ta function.\n\nFrom-SVN: r170009", "tree": {"sha": "0d506bb1580f9a18d55f23dc2e50ed7ef40b9abc", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/0d506bb1580f9a18d55f23dc2e50ed7ef40b9abc"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/be771f25275b5d4d1c7033d4d66f1412733f7046", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/be771f25275b5d4d1c7033d4d66f1412733f7046", "html_url": "https://github.com/Rust-GCC/gccrs/commit/be771f25275b5d4d1c7033d4d66f1412733f7046", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/be771f25275b5d4d1c7033d4d66f1412733f7046/comments", "author": {"login": "jicama", "id": 266146, "node_id": "MDQ6VXNlcjI2NjE0Ng==", "avatar_url": "https://avatars.githubusercontent.com/u/266146?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jicama", "html_url": "https://github.com/jicama", "followers_url": "https://api.github.com/users/jicama/followers", "following_url": "https://api.github.com/users/jicama/following{/other_user}", "gists_url": "https://api.github.com/users/jicama/gists{/gist_id}", "starred_url": "https://api.github.com/users/jicama/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jicama/subscriptions", "organizations_url": "https://api.github.com/users/jicama/orgs", "repos_url": "https://api.github.com/users/jicama/repos", "events_url": "https://api.github.com/users/jicama/events{/privacy}", "received_events_url": "https://api.github.com/users/jicama/received_events", "type": "User", "site_admin": false}, "committer": null, "parents": [{"sha": "c51dc544b1c7f64888f9c3023700a5793e427aba", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/c51dc544b1c7f64888f9c3023700a5793e427aba", "html_url": "https://github.com/Rust-GCC/gccrs/commit/c51dc544b1c7f64888f9c3023700a5793e427aba"}], "stats": {"total": 50, "additions": 44, "deletions": 6}, "files": [{"sha": "c3f780abe0494e11994312330d4f25e0d9680f04", "filename": "gcc/cp/ChangeLog", "status": "modified", "additions": 4, "deletions": 0, "changes": 4, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/be771f25275b5d4d1c7033d4d66f1412733f7046/gcc%2Fcp%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/be771f25275b5d4d1c7033d4d66f1412733f7046/gcc%2Fcp%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fcp%2FChangeLog?ref=be771f25275b5d4d1c7033d4d66f1412733f7046", "patch": "@@ -1,5 +1,9 @@\n 2011-02-09  Jason Merrill  <jason@redhat.com>\n \n+\t* decl.c (cp_make_fname_decl): Set DECL_THIS_STATIC at toplevel.\n+\t* semantics.c (finish_fname): Only return the name if we're in\n+\ta function.\n+\n \t* decl.c (build_enumerator): Don't perform integral promotions on\n \tnon-integral constants.\n "}, {"sha": "663ca8f32aa8f65d05e4df664410807cdecbfadf", "filename": "gcc/cp/decl.c", "status": "modified", "additions": 4, "deletions": 1, "changes": 5, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/be771f25275b5d4d1c7033d4d66f1412733f7046/gcc%2Fcp%2Fdecl.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/be771f25275b5d4d1c7033d4d66f1412733f7046/gcc%2Fcp%2Fdecl.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fcp%2Fdecl.c?ref=be771f25275b5d4d1c7033d4d66f1412733f7046", "patch": "@@ -3706,7 +3706,10 @@ cp_make_fname_decl (location_t loc, tree id, int type_dep)\n \t\t      LOOKUP_ONLYCONVERTING);\n     }\n   else\n-    pushdecl_top_level_and_finish (decl, init);\n+    {\n+      DECL_THIS_STATIC (decl) = true;\n+      pushdecl_top_level_and_finish (decl, init);\n+    }\n \n   return decl;\n }"}, {"sha": "58a59eecacf9b40edf5f74d503b3ed25fcfd1968", "filename": "gcc/cp/semantics.c", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/be771f25275b5d4d1c7033d4d66f1412733f7046/gcc%2Fcp%2Fsemantics.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/be771f25275b5d4d1c7033d4d66f1412733f7046/gcc%2Fcp%2Fsemantics.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fcp%2Fsemantics.c?ref=be771f25275b5d4d1c7033d4d66f1412733f7046", "patch": "@@ -2324,7 +2324,7 @@ finish_fname (tree id)\n   tree decl;\n \n   decl = fname_decl (input_location, C_RID_CODE (id), id);\n-  if (processing_template_decl)\n+  if (processing_template_decl && current_function_decl)\n     decl = DECL_NAME (decl);\n   return decl;\n }"}, {"sha": "a43f34c87089b6a8632ed9ca8a8bd687e76ac820", "filename": "gcc/testsuite/ChangeLog", "status": "modified", "additions": 3, "deletions": 0, "changes": 3, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/be771f25275b5d4d1c7033d4d66f1412733f7046/gcc%2Ftestsuite%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/be771f25275b5d4d1c7033d4d66f1412733f7046/gcc%2Ftestsuite%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2FChangeLog?ref=be771f25275b5d4d1c7033d4d66f1412733f7046", "patch": "@@ -1,5 +1,8 @@\n 2011-02-09  Jason Merrill  <jason@redhat.com>\n \n+\t* g++.dg/template/function1.C: Adjust for C++0x mode.\n+\t* g++.dg/cpp0x/regress/template-function1.C: Copy it.\n+\n \t* g++.dg/ext/label10.C: Adjust for C++0x mode.\n \t* g++.dg/cpp0x/regress/ext-label10.C: Copy it.\n "}, {"sha": "ec686eec456f46ae0b536e9c364a187feab826f9", "filename": "gcc/testsuite/g++.dg/cpp0x/regress/template-function1.C", "status": "added", "additions": 28, "deletions": 0, "changes": 28, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/be771f25275b5d4d1c7033d4d66f1412733f7046/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Fcpp0x%2Fregress%2Ftemplate-function1.C", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/be771f25275b5d4d1c7033d4d66f1412733f7046/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Fcpp0x%2Fregress%2Ftemplate-function1.C", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Fcpp0x%2Fregress%2Ftemplate-function1.C?ref=be771f25275b5d4d1c7033d4d66f1412733f7046", "patch": "@@ -0,0 +1,28 @@\n+// PR c++/38647\n+// { dg-do compile }\n+// { dg-options \"-std=c++0x\" }\n+\n+template<const char *, int> struct A {};\n+const char func[] = \"abc\";\n+template<int N> struct A<func, N> {};\t// { dg-error \"cannot appear|is invalid|not a valid\" }\n+\n+char a1[1];\n+A<a1, 0> a;\n+\n+template<const char *, int> struct B {};\n+template<int N> struct B<__FUNCTION__, N> {};\t// { dg-error \"cannot appear|is invalid|is not a valid\" }\n+\n+char b1[1];\n+B<b1, 0> b;\n+\n+template<const char *, int> struct C {};\n+template<int N> struct C<__PRETTY_FUNCTION__, N> {};\t// { dg-error \"cannot appear|is invalid|is not a valid\" }\n+\n+char c1[1];\n+C<c1, 0> c;\n+\n+template<const char *, int> struct D {};\n+template<int N> struct D<__func__, N> {};\t// { dg-error \"cannot appear|is invalid|is not a valid|function scope\" }\n+\n+char d1[1];\n+D<d1, 0> d;"}, {"sha": "3f82d5326f69adcddfd96c4c7b19fcd80bb081fc", "filename": "gcc/testsuite/g++.dg/template/function1.C", "status": "modified", "additions": 4, "deletions": 4, "changes": 8, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/be771f25275b5d4d1c7033d4d66f1412733f7046/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Ftemplate%2Ffunction1.C", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/be771f25275b5d4d1c7033d4d66f1412733f7046/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Ftemplate%2Ffunction1.C", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Ftemplate%2Ffunction1.C?ref=be771f25275b5d4d1c7033d4d66f1412733f7046", "patch": "@@ -3,25 +3,25 @@\n \n template<const char *, int> struct A {};\n const char func[] = \"abc\";\n-template<int N> struct A<func, N> {};\t// { dg-error \"cannot appear|is invalid\" }\n+template<int N> struct A<func, N> {};\t// { dg-error \"cannot appear|is invalid|not a valid\" }\n \n char a1[1];\n A<a1, 0> a;\n \n template<const char *, int> struct B {};\n-template<int N> struct B<__FUNCTION__, N> {};\t// { dg-error \"cannot appear|is invalid\" }\n+template<int N> struct B<__FUNCTION__, N> {};\t// { dg-error \"cannot appear|is invalid|is not a valid\" }\n \n char b1[1];\n B<b1, 0> b;\n \n template<const char *, int> struct C {};\n-template<int N> struct C<__PRETTY_FUNCTION__, N> {};\t// { dg-error \"cannot appear|is invalid\" }\n+template<int N> struct C<__PRETTY_FUNCTION__, N> {};\t// { dg-error \"cannot appear|is invalid|is not a valid\" }\n \n char c1[1];\n C<c1, 0> c;\n \n template<const char *, int> struct D {};\n-template<int N> struct D<__func__, N> {};\t// { dg-error \"cannot appear|is invalid\" }\n+template<int N> struct D<__func__, N> {};\t// { dg-error \"cannot appear|is invalid|is not a valid|function scope\" }\n \n char d1[1];\n D<d1, 0> d;"}]}