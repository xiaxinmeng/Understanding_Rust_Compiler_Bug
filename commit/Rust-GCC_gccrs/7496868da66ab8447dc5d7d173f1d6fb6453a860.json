{"sha": "7496868da66ab8447dc5d7d173f1d6fb6453a860", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6NzQ5Njg2OGRhNjZhYjg0NDdkYzVkN2QxNzNmMWQ2ZmI2NDUzYTg2MA==", "commit": {"author": {"name": "Jan Hubicka", "email": "jh@suse.cz", "date": "2011-06-18T10:48:08Z"}, "committer": {"name": "Jan Hubicka", "email": "hubicka@gcc.gnu.org", "date": "2011-06-18T10:48:08Z"}, "message": "re PR lto/48246 (ICE in lto_wpa_write_files)\n\n\tPR lto/23754\n\t* lto.c (lto_1_to_1_map): Don't create empty partitions.\n\t(lto_balanced_map): Likewise.\n\nFrom-SVN: r175174", "tree": {"sha": "c6a80631779e3b69a52e0c1027c4cbc0d2195e7b", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/c6a80631779e3b69a52e0c1027c4cbc0d2195e7b"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/7496868da66ab8447dc5d7d173f1d6fb6453a860", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/7496868da66ab8447dc5d7d173f1d6fb6453a860", "html_url": "https://github.com/Rust-GCC/gccrs/commit/7496868da66ab8447dc5d7d173f1d6fb6453a860", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/7496868da66ab8447dc5d7d173f1d6fb6453a860/comments", "author": null, "committer": null, "parents": [{"sha": "96769d3294ec0e7f78e6f4e79b308bc249cef86a", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/96769d3294ec0e7f78e6f4e79b308bc249cef86a", "html_url": "https://github.com/Rust-GCC/gccrs/commit/96769d3294ec0e7f78e6f4e79b308bc249cef86a"}], "stats": {"total": 25, "additions": 17, "deletions": 8}, "files": [{"sha": "ee054b00ea17672dc5b576a9777a0feb04c6cedb", "filename": "gcc/lto/ChangeLog", "status": "modified", "additions": 6, "deletions": 0, "changes": 6, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/7496868da66ab8447dc5d7d173f1d6fb6453a860/gcc%2Flto%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/7496868da66ab8447dc5d7d173f1d6fb6453a860/gcc%2Flto%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Flto%2FChangeLog?ref=7496868da66ab8447dc5d7d173f1d6fb6453a860", "patch": "@@ -1,3 +1,9 @@\n+2011-06-11  Jan Hubicka  <jh@suse.cz>\n+\n+\tPR lto/23754\n+\t* lto.c (lto_1_to_1_map): Don't create empty partitions.\n+\t(lto_balanced_map): Likewise.\n+\n 2011-06-11  Jan Hubicka  <jh@suse.cz>\n \n \t* lto.c (add_cgraph_node_to_partition_1): Break out from ..."}, {"sha": "4323c4fa6f4ff38d31e538cc91f9f75f3d92e5a2", "filename": "gcc/lto/lto.c", "status": "modified", "additions": 11, "deletions": 8, "changes": 19, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/7496868da66ab8447dc5d7d173f1d6fb6453a860/gcc%2Flto%2Flto.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/7496868da66ab8447dc5d7d173f1d6fb6453a860/gcc%2Flto%2Flto.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Flto%2Flto.c?ref=7496868da66ab8447dc5d7d173f1d6fb6453a860", "patch": "@@ -1516,7 +1516,8 @@ lto_1_to_1_map (void)\n \n   for (node = cgraph_nodes; node; node = node->next)\n     {\n-      if (!partition_cgraph_node_p (node))\n+      if (!partition_cgraph_node_p (node)\n+\t  || node->aux)\n \tcontinue;\n \n       file_data = node->local.lto_file_data;\n@@ -1545,13 +1546,13 @@ lto_1_to_1_map (void)\n \t  npartitions++;\n \t}\n \n-      if (!node->aux)\n-        add_cgraph_node_to_partition (partition, node);\n+      add_cgraph_node_to_partition (partition, node);\n     }\n \n   for (vnode = varpool_nodes; vnode; vnode = vnode->next)\n     {\n-      if (!partition_varpool_node_p (vnode))\n+      if (!partition_varpool_node_p (vnode)\n+\t  || vnode->aux)\n \tcontinue;\n       file_data = vnode->lto_file_data;\n       slot = pointer_map_contains (pmap, file_data);\n@@ -1565,8 +1566,7 @@ lto_1_to_1_map (void)\n \t  npartitions++;\n \t}\n \n-      if (!vnode->aux)\n-        add_varpool_node_to_partition (partition, vnode);\n+      add_varpool_node_to_partition (partition, vnode);\n     }\n   for (node = cgraph_nodes; node; node = node->next)\n     node->aux = NULL;\n@@ -1675,8 +1675,9 @@ lto_balanced_map (void)\n \n   for (i = 0; i < n_nodes; i++)\n     {\n-      if (!order[i]->aux)\n-        add_cgraph_node_to_partition (partition, order[i]);\n+      if (order[i]->aux)\n+\tcontinue;\n+      add_cgraph_node_to_partition (partition, order[i]);\n       total_size -= inline_summary (order[i])->size;\n \n       /* Once we added a new node to the partition, we also want to add\n@@ -1856,6 +1857,8 @@ lto_balanced_map (void)\n \t    }\n \t  i = best_i;\n  \t  /* When we are finished, avoid creating empty partition.  */\n+\t  while (i < n_nodes - 1 && order[i + 1]->aux)\n+\t    i++;\n \t  if (i == n_nodes - 1)\n \t    break;\n \t  partition = new_partition (\"\");"}]}