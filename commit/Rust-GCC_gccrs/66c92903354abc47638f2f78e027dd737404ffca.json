{"sha": "66c92903354abc47638f2f78e027dd737404ffca", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6NjZjOTI5MDMzNTRhYmM0NzYzOGYyZjc4ZTAyN2RkNzM3NDA0ZmZjYQ==", "commit": {"author": {"name": "Jan Hubicka", "email": "hubicka@ucw.cz", "date": "2017-11-19T18:52:54Z"}, "committer": {"name": "Jan Hubicka", "email": "hubicka@gcc.gnu.org", "date": "2017-11-19T18:52:54Z"}, "message": "re PR target/82713 (ICE in ix86_builtin_vectorization_cost, at config/i386/i386.c:44475)\n\n\n\tPR target/82713\n\t* i386.c (ix86_builtin_vectorization_cost): Be ready for insane\n\ttypes.\n\nFrom-SVN: r254933", "tree": {"sha": "0d5e0c6767f7be0be2154f81b7a673276f8c5599", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/0d5e0c6767f7be0be2154f81b7a673276f8c5599"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/66c92903354abc47638f2f78e027dd737404ffca", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/66c92903354abc47638f2f78e027dd737404ffca", "html_url": "https://github.com/Rust-GCC/gccrs/commit/66c92903354abc47638f2f78e027dd737404ffca", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/66c92903354abc47638f2f78e027dd737404ffca/comments", "author": null, "committer": null, "parents": [{"sha": "f9c59f7e9511856bd6dc13d2d4904ebd9249c095", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/f9c59f7e9511856bd6dc13d2d4904ebd9249c095", "html_url": "https://github.com/Rust-GCC/gccrs/commit/f9c59f7e9511856bd6dc13d2d4904ebd9249c095"}], "stats": {"total": 43, "additions": 42, "deletions": 1}, "files": [{"sha": "17aa792a75f9bfaa2764a3b9a042660fda03cd23", "filename": "gcc/ChangeLog", "status": "modified", "additions": 6, "deletions": 0, "changes": 6, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/66c92903354abc47638f2f78e027dd737404ffca/gcc%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/66c92903354abc47638f2f78e027dd737404ffca/gcc%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2FChangeLog?ref=66c92903354abc47638f2f78e027dd737404ffca", "patch": "@@ -1,3 +1,9 @@\n+2017-11-19  Jan Hubicka  <hubicka@ucw.cz>\n+\n+\tPR target/82713\n+\t* i386.c (ix86_builtin_vectorization_cost): Be ready for insane\n+\ttypes.\n+\n 2017-11-19  Tom de Vries  <tom@codesourcery.com>\n \n \t* config/arc/arc.h (FUNCTION_PROFILER): Remove semicolon after"}, {"sha": "339932e19eeae8716a2772ac6df3c0bdd004f417", "filename": "gcc/config/i386/i386.c", "status": "modified", "additions": 12, "deletions": 1, "changes": 13, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/66c92903354abc47638f2f78e027dd737404ffca/gcc%2Fconfig%2Fi386%2Fi386.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/66c92903354abc47638f2f78e027dd737404ffca/gcc%2Fconfig%2Fi386%2Fi386.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fconfig%2Fi386%2Fi386.c?ref=66c92903354abc47638f2f78e027dd737404ffca", "patch": "@@ -44628,13 +44628,18 @@ ix86_builtin_vectorization_cost (enum vect_cost_for_stmt type_of_cost,\n \n       case vector_load:\n \tindex = sse_store_index (mode);\n-\tgcc_assert (index >= 0);\n+\t/* See PR82713 - we may end up being called on non-vector type.  */\n+\tif (index < 0)\n+\t  index = 2;\n         return ix86_vec_cost (mode,\n \t\t\t      COSTS_N_INSNS (ix86_cost->sse_load[index]) / 2,\n \t\t\t      true);\n \n       case vector_store:\n \tindex = sse_store_index (mode);\n+\t/* See PR82713 - we may end up being called on non-vector type.  */\n+\tif (index < 0)\n+\t  index = 2;\n         return ix86_vec_cost (mode,\n \t\t\t      COSTS_N_INSNS (ix86_cost->sse_store[index]) / 2,\n \t\t\t      true);\n@@ -44647,13 +44652,19 @@ ix86_builtin_vectorization_cost (enum vect_cost_for_stmt type_of_cost,\n \t Do that incrementally.  */\n       case unaligned_load:\n \tindex = sse_store_index (mode);\n+\t/* See PR82713 - we may end up being called on non-vector type.  */\n+\tif (index < 0)\n+\t  index = 2;\n         return ix86_vec_cost (mode,\n \t\t\t      COSTS_N_INSNS\n \t\t\t\t (ix86_cost->sse_unaligned_load[index]) / 2,\n \t\t\t      true);\n \n       case unaligned_store:\n \tindex = sse_store_index (mode);\n+\t/* See PR82713 - we may end up being called on non-vector type.  */\n+\tif (index < 0)\n+\t  index = 2;\n         return ix86_vec_cost (mode,\n \t\t\t      COSTS_N_INSNS\n \t\t\t\t (ix86_cost->sse_unaligned_store[index]) / 2,"}, {"sha": "fe7a5284689f03c6507dcd703bfb8a34c0e4803b", "filename": "gcc/testsuite/ChangeLog", "status": "modified", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/66c92903354abc47638f2f78e027dd737404ffca/gcc%2Ftestsuite%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/66c92903354abc47638f2f78e027dd737404ffca/gcc%2Ftestsuite%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2FChangeLog?ref=66c92903354abc47638f2f78e027dd737404ffca", "patch": "@@ -1,3 +1,8 @@\n+2017-11-19  Jan Hubicka  <hubicka@ucw.cz>\n+\n+\tPR target/82713\n+\t* gcc.target/i386/pr82713.c: New testcase.\n+\n 2017-11-19  Jakub Jelinek  <jakub@redhat.com>\n \n \tPR c/66618"}, {"sha": "2c2295efa602e0f3776400f44eb7f12822d25bba", "filename": "gcc/testsuite/gcc.target/i386/pr82713.c", "status": "added", "additions": 19, "deletions": 0, "changes": 19, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/66c92903354abc47638f2f78e027dd737404ffca/gcc%2Ftestsuite%2Fgcc.target%2Fi386%2Fpr82713.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/66c92903354abc47638f2f78e027dd737404ffca/gcc%2Ftestsuite%2Fgcc.target%2Fi386%2Fpr82713.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgcc.target%2Fi386%2Fpr82713.c?ref=66c92903354abc47638f2f78e027dd737404ffca", "patch": "@@ -0,0 +1,19 @@\n+/* { dg-do compile } */\n+* { dg-options \"-O3 -mavx512bw\" } */\n+\n+_Bool a[2048];\n+int b[2048];\n+\n+void\n+foo ()\n+{\n+  int i;\n+  for (i = 0; i < 2048; i += 4)\n+    {\n+      a[i] = b[i] <= 10;\n+      a[i + 3] = b[i + 1] <= 10;\n+      a[i + 2] = b[i + 2] <= 10;\n+      a[i + 1] = b[i + 3] <= 10;\n+    }\n+}\n+"}]}