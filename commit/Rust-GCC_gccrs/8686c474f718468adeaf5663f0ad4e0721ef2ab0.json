{"sha": "8686c474f718468adeaf5663f0ad4e0721ef2ab0", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6ODY4NmM0NzRmNzE4NDY4YWRlYWY1NjYzZjBhZDRlMDcyMWVmMmFiMA==", "commit": {"author": {"name": "Richard Guenther", "email": "rguenther@suse.de", "date": "2010-10-08T15:20:13Z"}, "committer": {"name": "Richard Biener", "email": "rguenth@gcc.gnu.org", "date": "2010-10-08T15:20:13Z"}, "message": "lto-streamer-out.c (lto_output_ts_block_tree_pointers): Do not output BLOCK_SUBBLOCKS.\n\n2010-10-08  Richard Guenther  <rguenther@suse.de>\n\n\t* lto-streamer-out.c (lto_output_ts_block_tree_pointers):\n\tDo not output BLOCK_SUBBLOCKS.\n\t* lto-streamer-in.c (lto_input_ts_block_tree_pointers):\n\tReserve exact space needed for BLOCK_NONLOCALIZED_VARS.\n\tRe-construct BLOCK_SUBBLOCKS of parent block.\n\t(lto_input_ts_binfo_tree_pointers): Reserve exact space needed\n\tfor BINFO_BASE_ACCESSES.\n\nFrom-SVN: r165190", "tree": {"sha": "d62ad1cfdc8e1a0d094175d74989ff5a8b3d7e5b", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/d62ad1cfdc8e1a0d094175d74989ff5a8b3d7e5b"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/8686c474f718468adeaf5663f0ad4e0721ef2ab0", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/8686c474f718468adeaf5663f0ad4e0721ef2ab0", "html_url": "https://github.com/Rust-GCC/gccrs/commit/8686c474f718468adeaf5663f0ad4e0721ef2ab0", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/8686c474f718468adeaf5663f0ad4e0721ef2ab0/comments", "author": {"login": "rguenth", "id": 2046526, "node_id": "MDQ6VXNlcjIwNDY1MjY=", "avatar_url": "https://avatars.githubusercontent.com/u/2046526?v=4", "gravatar_id": "", "url": "https://api.github.com/users/rguenth", "html_url": "https://github.com/rguenth", "followers_url": "https://api.github.com/users/rguenth/followers", "following_url": "https://api.github.com/users/rguenth/following{/other_user}", "gists_url": "https://api.github.com/users/rguenth/gists{/gist_id}", "starred_url": "https://api.github.com/users/rguenth/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/rguenth/subscriptions", "organizations_url": "https://api.github.com/users/rguenth/orgs", "repos_url": "https://api.github.com/users/rguenth/repos", "events_url": "https://api.github.com/users/rguenth/events{/privacy}", "received_events_url": "https://api.github.com/users/rguenth/received_events", "type": "User", "site_admin": false}, "committer": null, "parents": [{"sha": "a75bfaa6cdea2dd7c2e8ac2aa4f52267b3213362", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/a75bfaa6cdea2dd7c2e8ac2aa4f52267b3213362", "html_url": "https://github.com/Rust-GCC/gccrs/commit/a75bfaa6cdea2dd7c2e8ac2aa4f52267b3213362"}], "stats": {"total": 43, "additions": 35, "deletions": 8}, "files": [{"sha": "f713eff763e57a63862cb1acf7030bf0bd62cc11", "filename": "gcc/ChangeLog", "status": "modified", "additions": 10, "deletions": 0, "changes": 10, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/8686c474f718468adeaf5663f0ad4e0721ef2ab0/gcc%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/8686c474f718468adeaf5663f0ad4e0721ef2ab0/gcc%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2FChangeLog?ref=8686c474f718468adeaf5663f0ad4e0721ef2ab0", "patch": "@@ -1,3 +1,13 @@\n+2010-10-08  Richard Guenther  <rguenther@suse.de>\n+\n+\t* lto-streamer-out.c (lto_output_ts_block_tree_pointers):\n+\tDo not output BLOCK_SUBBLOCKS.\n+\t* lto-streamer-in.c (lto_input_ts_block_tree_pointers):\n+\tReserve exact space needed for BLOCK_NONLOCALIZED_VARS.\n+\tRe-construct BLOCK_SUBBLOCKS of parent block.\n+\t(lto_input_ts_binfo_tree_pointers): Reserve exact space needed\n+\tfor BINFO_BASE_ACCESSES.\n+\n 2010-10-08  Joseph Myers  <joseph@codesourcery.com>\n \n \t* Makefile.in (TM_H): Include $(FLAGS_H) instead of options.h."}, {"sha": "8061fe34551472f58512933b58d64685986e5159", "filename": "gcc/lto-streamer-in.c", "status": "modified", "additions": 23, "deletions": 7, "changes": 30, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/8686c474f718468adeaf5663f0ad4e0721ef2ab0/gcc%2Flto-streamer-in.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/8686c474f718468adeaf5663f0ad4e0721ef2ab0/gcc%2Flto-streamer-in.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Flto-streamer-in.c?ref=8686c474f718468adeaf5663f0ad4e0721ef2ab0", "patch": "@@ -2139,17 +2139,29 @@ lto_input_ts_block_tree_pointers (struct lto_input_block *ib,\n   BLOCK_VARS (expr) = lto_input_chain (ib, data_in);\n \n   len = lto_input_uleb128 (ib);\n-  for (i = 0; i < len; i++)\n+  if (len > 0)\n     {\n-      tree t = lto_input_tree (ib, data_in);\n-      VEC_safe_push (tree, gc, BLOCK_NONLOCALIZED_VARS (expr), t);\n+      VEC_reserve_exact (tree, gc, BLOCK_NONLOCALIZED_VARS (expr), len);\n+      for (i = 0; i < len; i++)\n+\t{\n+\t  tree t = lto_input_tree (ib, data_in);\n+\t  VEC_quick_push (tree, BLOCK_NONLOCALIZED_VARS (expr), t);\n+\t}\n     }\n \n   BLOCK_SUPERCONTEXT (expr) = lto_input_tree (ib, data_in);\n   BLOCK_ABSTRACT_ORIGIN (expr) = lto_input_tree (ib, data_in);\n   BLOCK_FRAGMENT_ORIGIN (expr) = lto_input_tree (ib, data_in);\n   BLOCK_FRAGMENT_CHAIN (expr) = lto_input_tree (ib, data_in);\n-  BLOCK_SUBBLOCKS (expr) = lto_input_chain (ib, data_in);\n+  /* We re-compute BLOCK_SUBBLOCKS of our parent here instead\n+     of streaming it.  For non-BLOCK BLOCK_SUPERCONTEXTs we still\n+     stream the child relationship explicitly.  */\n+  if (BLOCK_SUPERCONTEXT (expr)\n+      && TREE_CODE (BLOCK_SUPERCONTEXT (expr)) == BLOCK)\n+    {\n+      BLOCK_CHAIN (expr) = BLOCK_SUBBLOCKS (BLOCK_SUPERCONTEXT (expr));\n+      BLOCK_SUBBLOCKS (BLOCK_SUPERCONTEXT (expr)) = expr;\n+    }\n }\n \n \n@@ -2183,10 +2195,14 @@ lto_input_ts_binfo_tree_pointers (struct lto_input_block *ib,\n   BINFO_VPTR_FIELD (expr) = lto_input_tree (ib, data_in);\n \n   len = lto_input_uleb128 (ib);\n-  for (i = 0; i < len; i++)\n+  if (len > 0)\n     {\n-      tree a = lto_input_tree (ib, data_in);\n-      VEC_safe_push (tree, gc, BINFO_BASE_ACCESSES (expr), a);\n+      VEC_reserve_exact (tree, gc, BINFO_BASE_ACCESSES (expr), len);\n+      for (i = 0; i < len; i++)\n+\t{\n+\t  tree a = lto_input_tree (ib, data_in);\n+\t  VEC_quick_push (tree, BINFO_BASE_ACCESSES (expr), a);\n+\t}\n     }\n \n   BINFO_INHERITANCE_CHAIN (expr) = lto_input_tree (ib, data_in);"}, {"sha": "0ece96b8112b90dd9b71bc841f40cc9feb228c36", "filename": "gcc/lto-streamer-out.c", "status": "modified", "additions": 2, "deletions": 1, "changes": 3, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/8686c474f718468adeaf5663f0ad4e0721ef2ab0/gcc%2Flto-streamer-out.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/8686c474f718468adeaf5663f0ad4e0721ef2ab0/gcc%2Flto-streamer-out.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Flto-streamer-out.c?ref=8686c474f718468adeaf5663f0ad4e0721ef2ab0", "patch": "@@ -1065,7 +1065,8 @@ lto_output_ts_block_tree_pointers (struct output_block *ob, tree expr,\n   lto_output_tree_or_ref (ob, BLOCK_ABSTRACT_ORIGIN (expr), ref_p);\n   lto_output_tree_or_ref (ob, BLOCK_FRAGMENT_ORIGIN (expr), ref_p);\n   lto_output_tree_or_ref (ob, BLOCK_FRAGMENT_CHAIN (expr), ref_p);\n-  lto_output_chain (ob, BLOCK_SUBBLOCKS (expr), ref_p);\n+  /* Do not output BLOCK_SUBBLOCKS.  Instead on streaming-in this\n+     list is re-constructed from BLOCK_SUPERCONTEXT.  */\n }\n \n "}]}