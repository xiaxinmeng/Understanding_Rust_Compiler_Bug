{"sha": "5b900a4520087e5e38fe938e55932e6bd779d1e9", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6NWI5MDBhNDUyMDA4N2U1ZTM4ZmU5MzhlNTU5MzJlNmJkNzc5ZDFlOQ==", "commit": {"author": {"name": "Arnaud Charlet", "email": "charlet@gcc.gnu.org", "date": "2009-06-25T09:18:43Z"}, "committer": {"name": "Arnaud Charlet", "email": "charlet@gcc.gnu.org", "date": "2009-06-25T09:18:43Z"}, "message": "[multiple changes]\n\n2009-06-25  Vincent Celier  <celier@adacore.com>\n\n\t* s-os_lib.adb (Normalize_Pathname.Get_Directory): If directory\n\tprovided, on Windows change all '/' to '\\'.\n\n\t* fmap.ads, fmap.adb (Remove_Forbidden_File_Name): Remove, no longer\n\tused. Minor comment changes\n\n\t* prj-nmsc.adb: Do not call Fmap.Add_Forbidden_File_Name or\n\tRemove_Forbidden_File_Name.\n\n2009-06-25  Quentin Ochem  <ochem@adacore.com>\n\n\t* prj.ads (Unit_Index): Now general access type.\n\nFrom-SVN: r148936", "tree": {"sha": "9985a90114e8cc5c0d37f35599fac92a57c4698b", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/9985a90114e8cc5c0d37f35599fac92a57c4698b"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/5b900a4520087e5e38fe938e55932e6bd779d1e9", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/5b900a4520087e5e38fe938e55932e6bd779d1e9", "html_url": "https://github.com/Rust-GCC/gccrs/commit/5b900a4520087e5e38fe938e55932e6bd779d1e9", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/5b900a4520087e5e38fe938e55932e6bd779d1e9/comments", "author": null, "committer": null, "parents": [{"sha": "a2b62f99d5c193d5d6e6b16777501338cc519789", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/a2b62f99d5c193d5d6e6b16777501338cc519789", "html_url": "https://github.com/Rust-GCC/gccrs/commit/a2b62f99d5c193d5d6e6b16777501338cc519789"}], "stats": {"total": 112, "additions": 59, "deletions": 53}, "files": [{"sha": "63550a62b93782fda57a9eecca4a64447c96efad", "filename": "gcc/ada/ChangeLog", "status": "modified", "additions": 14, "deletions": 0, "changes": 14, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/5b900a4520087e5e38fe938e55932e6bd779d1e9/gcc%2Fada%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/5b900a4520087e5e38fe938e55932e6bd779d1e9/gcc%2Fada%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fada%2FChangeLog?ref=5b900a4520087e5e38fe938e55932e6bd779d1e9", "patch": "@@ -1,3 +1,17 @@\n+2009-06-25  Vincent Celier  <celier@adacore.com>\n+\n+\t* s-os_lib.adb (Normalize_Pathname.Get_Directory): If directory\n+\tprovided, on Windows change all '/' to '\\'.\n+\n+\t* fmap.ads, fmap.adb (Remove_Forbidden_File_Name): Remove, no longer\n+\tused. Minor comment changes\n+\n+\t* prj-nmsc.adb: Do not call Fmap.Add_Forbidden_File_Name or\n+\tRemove_Forbidden_File_Name.\n+\n+2009-06-25  Quentin Ochem  <ochem@adacore.com>\n+\n+\t* prj.ads (Unit_Index): Now general access type.\n 2009-06-25  Pascal Obry  <obry@adacore.com>\n \n \t* a-stwise.adb, a-stzsea.adb: Fix confusion between 'Length and 'Last."}, {"sha": "8de27ec6b7efcb87c9b8d2189bd4fe147494f989", "filename": "gcc/ada/fmap.adb", "status": "modified", "additions": 14, "deletions": 19, "changes": 33, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/5b900a4520087e5e38fe938e55932e6bd779d1e9/gcc%2Fada%2Ffmap.adb", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/5b900a4520087e5e38fe938e55932e6bd779d1e9/gcc%2Fada%2Ffmap.adb", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fada%2Ffmap.adb?ref=5b900a4520087e5e38fe938e55932e6bd779d1e9", "patch": "@@ -6,7 +6,7 @@\n --                                                                          --\n --                                 B o d y                                  --\n --                                                                          --\n---          Copyright (C) 2001-2008, Free Software Foundation, Inc.         --\n+--          Copyright (C) 2001-2009, Free Software Foundation, Inc.         --\n --                                                                          --\n -- GNAT is free software;  you can  redistribute it  and/or modify it under --\n -- terms of the  GNU General Public License as published  by the Free Soft- --\n@@ -191,16 +191,17 @@ package body Fmap is\n       --  Remove all entries in case of incorrect mapping file\n \n       function Find_File_Name return File_Name_Type;\n-      --  Return Error_File_Name for \"/\", otherwise call Name_Find\n-      --  What is this about, explanation required ???\n+      --  Return Error_File_Name if the name buffer contains \"/\", otherwise\n+      --  call Name_Find. \"/\" is the path name in the mapping file to indicate\n+      --  that a source has been suppressed, and thus should not be found by\n+      --  the compiler.\n \n       function Find_Unit_Name return Unit_Name_Type;\n-      --  Return Error_Unit_Name for \"/\", otherwise call Name_Find\n-      --  Even more mysterious??? function appeared when Find_Name was split\n-      --  for the two types, but this routine is definitely called!\n+      --  Return the unit name in the name buffer. Return Error_Unit_Name if\n+      --  the name buffer contains \"/\".\n \n       procedure Get_Line;\n-      --  Get a line from the mapping file\n+      --  Get a line from the mapping file, where a line is SP (First .. Last)\n \n       procedure Report_Truncated;\n       --  Report a warning when the mapping file is truncated\n@@ -223,12 +224,16 @@ package body Fmap is\n       -- Find_File_Name --\n       --------------------\n \n-      --  Why is only / illegal, why not \\ on windows ???\n-\n       function Find_File_Name return File_Name_Type is\n       begin\n          if Name_Buffer (1 .. Name_Len) = \"/\" then\n+\n+            --  A path name of \"/\" is the indication that the source has been\n+            --  \"suppressed\". Return Error_File_Name so that the compiler does\n+            --  not find the source, even if it is in the include path.\n+\n             return Error_File_Name;\n+\n          else\n             return Name_Find;\n          end if;\n@@ -241,7 +246,6 @@ package body Fmap is\n       function Find_Unit_Name return Unit_Name_Type is\n       begin\n          return Unit_Name_Type (Find_File_Name);\n-         --  very odd ???\n       end Find_Unit_Name;\n \n       --------------\n@@ -413,15 +417,6 @@ package body Fmap is\n       end if;\n    end Mapped_Path_Name;\n \n-   --------------------------------\n-   -- Remove_Forbidden_File_Name --\n-   --------------------------------\n-\n-   procedure Remove_Forbidden_File_Name (Name : File_Name_Type) is\n-   begin\n-      Forbidden_Names.Set (Name, False);\n-   end Remove_Forbidden_File_Name;\n-\n    ------------------\n    -- Reset_Tables --\n    ------------------"}, {"sha": "f1d54db47338edeb5336ff70656b13fc1d2eca59", "filename": "gcc/ada/fmap.ads", "status": "modified", "additions": 3, "deletions": 8, "changes": 11, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/5b900a4520087e5e38fe938e55932e6bd779d1e9/gcc%2Fada%2Ffmap.ads", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/5b900a4520087e5e38fe938e55932e6bd779d1e9/gcc%2Fada%2Ffmap.ads", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fada%2Ffmap.ads?ref=5b900a4520087e5e38fe938e55932e6bd779d1e9", "patch": "@@ -74,13 +74,8 @@ package Fmap is\n    --  compilation.\n \n    procedure Add_Forbidden_File_Name (Name : File_Name_Type);\n-   --  Indicate that a source file name is forbidden.\n-   --  This is used by gnatmake when there are excluded sources in projects\n-   --  (attributes Excluded_Source_Files or Locally_Removed_Files).\n-\n-   procedure Remove_Forbidden_File_Name (Name : File_Name_Type);\n-   --  Indicate that a source file name that was forbidden is no longer\n-   --  forbidden. Used by gnatmake when an excluded source is redefined\n-   --  in another extending project.\n+   --  Indicate that a source file name is forbidden. This is used when there\n+   --  are excluded sources in projects (attributes Excluded_Source_Files or\n+   --  Locally_Removed_Files).\n \n end Fmap;"}, {"sha": "3c2a7ebb78c42d6a8704713b2034d193e4423cc8", "filename": "gcc/ada/prj-nmsc.adb", "status": "modified", "additions": 4, "deletions": 14, "changes": 18, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/5b900a4520087e5e38fe938e55932e6bd779d1e9/gcc%2Fada%2Fprj-nmsc.adb", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/5b900a4520087e5e38fe938e55932e6bd779d1e9/gcc%2Fada%2Fprj-nmsc.adb", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fada%2Fprj-nmsc.adb?ref=5b900a4520087e5e38fe938e55932e6bd779d1e9", "patch": "@@ -28,7 +28,6 @@ with GNAT.Directory_Operations;  use GNAT.Directory_Operations;\n with GNAT.HTable;\n \n with Err_Vars; use Err_Vars;\n-with Fmap;     use Fmap;\n with Hostparm;\n with MLib.Tgt;\n with Opt;      use Opt;\n@@ -4569,9 +4568,9 @@ package body Prj.Nmsc is\n                              (UData.File_Names (Impl).Project,\n                               Project, Extending)\n                            then\n-                              --  There is a body for this unit.\n-                              --  If there is no spec, we need to check that it\n-                              --  is not a subunit.\n+                              --  There is a body for this unit. If there is\n+                              --  no spec, we need to check that it is not a\n+                              --  subunit.\n \n                               if UData.File_Names (Spec) = null then\n                                  declare\n@@ -7327,7 +7326,7 @@ package body Prj.Nmsc is\n       then\n          --  If we had another file referencing the same unit (for instance it\n          --  was in an extended project), that source file is in fact invisible\n-         --  from now on, and in particular doesn't belong to the same unit\n+         --  from now on, and in particular doesn't belong to the same unit.\n \n          if Source.Unit.File_Names (Source.Kind) /= Source then\n             Source.Unit.File_Names (Source.Kind).Unit := No_Unit_Index;\n@@ -7831,8 +7830,6 @@ package body Prj.Nmsc is\n                         Write_Line (Get_Name_String (Excluded.File));\n                      end if;\n \n-                     Add_Forbidden_File_Name (Excluded.File);\n-\n                   else\n                      Error_Msg\n                        (Project, In_Tree,\n@@ -8121,13 +8118,6 @@ package body Prj.Nmsc is\n               or else Is_Extending\n                 (Project.Extends, UData.File_Names (Unit_Kind).Project)\n             then\n-               if UData.File_Names (Unit_Kind) /= null\n-                 and then UData.File_Names (Unit_Kind).Locally_Removed\n-               then\n-                  Remove_Forbidden_File_Name\n-                    (UData.File_Names (Unit_Kind).File);\n-               end if;\n-\n                To_Record       := True;\n \n             --  If the same file is already in the list, do not add it again"}, {"sha": "ebb45782a2c35c88d78aa28e66e061a03a87d2a6", "filename": "gcc/ada/prj.ads", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/5b900a4520087e5e38fe938e55932e6bd779d1e9/gcc%2Fada%2Fprj.ads", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/5b900a4520087e5e38fe938e55932e6bd779d1e9/gcc%2Fada%2Fprj.ads", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fada%2Fprj.ads?ref=5b900a4520087e5e38fe938e55932e6bd779d1e9", "patch": "@@ -640,7 +640,7 @@ package Prj is\n       Name       : Name_Id := No_Name;\n       File_Names : File_Names_Data;\n    end record;\n-   type Unit_Index is access Unit_Data;\n+   type Unit_Index is access all Unit_Data;\n    No_Unit_Index : constant Unit_Index := null;\n    --  Name and File and Path names of a unit, with a reference to its\n    --  GNAT Project File(s)."}, {"sha": "0f2081a0e874a9b132fbb07cadbbd49cde08a230", "filename": "gcc/ada/s-os_lib.adb", "status": "modified", "additions": 23, "deletions": 11, "changes": 34, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/5b900a4520087e5e38fe938e55932e6bd779d1e9/gcc%2Fada%2Fs-os_lib.adb", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/5b900a4520087e5e38fe938e55932e6bd779d1e9/gcc%2Fada%2Fs-os_lib.adb", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fada%2Fs-os_lib.adb?ref=5b900a4520087e5e38fe938e55932e6bd779d1e9", "patch": "@@ -6,7 +6,7 @@\n --                                                                          --\n --                                 B o d y                                  --\n --                                                                          --\n---                     Copyright (C) 1995-2008, AdaCore                     --\n+--                     Copyright (C) 1995-2009, AdaCore                     --\n --                                                                          --\n -- GNAT is free software;  you can  redistribute it  and/or modify it under --\n -- terms of the  GNU General Public License as published  by the Free Soft- --\n@@ -1800,20 +1800,32 @@ package body System.OS_Lib is\n       -------------------\n \n       function Get_Directory (Dir : String) return String is\n+         Result : String (1 .. Dir'Length + 1);\n+         Length : constant Natural := Dir'Length;\n+\n       begin\n          --  Directory given, add directory separator if needed\n \n-         if Dir'Length > 0 then\n-            if Dir (Dir'Last) = Directory_Separator then\n-               return Dir;\n+         if Length > 0 then\n+            Result (1 .. Length) := Dir;\n+\n+            --  On Windows, change all '/' to '\\'\n+\n+            if On_Windows then\n+               for J in 1 .. Length loop\n+                  if Result (J) = '/' then\n+                     Result (J) := Directory_Separator;\n+                  end if;\n+               end loop;\n+            end if;\n+\n+            --  Add directory separator, if needed\n+\n+            if Result (Length) = Directory_Separator then\n+               return Result (1 .. Length);\n             else\n-               declare\n-                  Result : String (1 .. Dir'Length + 1);\n-               begin\n-                  Result (1 .. Dir'Length) := Dir;\n-                  Result (Result'Length) := Directory_Separator;\n-                  return Result;\n-               end;\n+               Result (Result'Length) := Directory_Separator;\n+               return Result;\n             end if;\n \n          --  Directory name not given, get current directory"}]}