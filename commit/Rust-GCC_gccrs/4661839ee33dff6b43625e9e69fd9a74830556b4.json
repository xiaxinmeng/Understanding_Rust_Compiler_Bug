{"sha": "4661839ee33dff6b43625e9e69fd9a74830556b4", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6NDY2MTgzOWVlMzNkZmY2YjQzNjI1ZTllNjlmZDlhNzQ4MzA1NTZiNA==", "commit": {"author": {"name": "Martin Liska", "email": "mliska@suse.cz", "date": "2016-07-12T15:27:36Z"}, "committer": {"name": "Martin Liska", "email": "marxin@gcc.gnu.org", "date": "2016-07-12T15:27:36Z"}, "message": "Introduce new param: AVG_LOOP_NITER\n\n\t* params.def: Add avg-loop niter.\n\t* tree-ssa-loop-ivopts.c (avg_loop_niter): Use the param.\n\t* cfgloopanal.c (expected_loop_iterations_unbounded): Likewise.\n\t* doc/invoke.texi: Document the new parameter.\n\nFrom-SVN: r238252", "tree": {"sha": "70856e5c2b14b375399cf75b6678131352b177dd", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/70856e5c2b14b375399cf75b6678131352b177dd"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/4661839ee33dff6b43625e9e69fd9a74830556b4", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/4661839ee33dff6b43625e9e69fd9a74830556b4", "html_url": "https://github.com/Rust-GCC/gccrs/commit/4661839ee33dff6b43625e9e69fd9a74830556b4", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/4661839ee33dff6b43625e9e69fd9a74830556b4/comments", "author": {"login": "marxin", "id": 2658545, "node_id": "MDQ6VXNlcjI2NTg1NDU=", "avatar_url": "https://avatars.githubusercontent.com/u/2658545?v=4", "gravatar_id": "", "url": "https://api.github.com/users/marxin", "html_url": "https://github.com/marxin", "followers_url": "https://api.github.com/users/marxin/followers", "following_url": "https://api.github.com/users/marxin/following{/other_user}", "gists_url": "https://api.github.com/users/marxin/gists{/gist_id}", "starred_url": "https://api.github.com/users/marxin/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/marxin/subscriptions", "organizations_url": "https://api.github.com/users/marxin/orgs", "repos_url": "https://api.github.com/users/marxin/repos", "events_url": "https://api.github.com/users/marxin/events{/privacy}", "received_events_url": "https://api.github.com/users/marxin/received_events", "type": "User", "site_admin": false}, "committer": null, "parents": [{"sha": "f507d20235bb7c05ce24c92f65b8aead2594e797", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/f507d20235bb7c05ce24c92f65b8aead2594e797", "html_url": "https://github.com/Rust-GCC/gccrs/commit/f507d20235bb7c05ce24c92f65b8aead2594e797"}], "stats": {"total": 31, "additions": 22, "deletions": 9}, "files": [{"sha": "03040052fb37bde04117bb22d64171d39e13ab00", "filename": "gcc/ChangeLog", "status": "modified", "additions": 7, "deletions": 0, "changes": 7, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/4661839ee33dff6b43625e9e69fd9a74830556b4/gcc%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/4661839ee33dff6b43625e9e69fd9a74830556b4/gcc%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2FChangeLog?ref=4661839ee33dff6b43625e9e69fd9a74830556b4", "patch": "@@ -1,3 +1,10 @@\n+2016-07-12  Martin Liska  <mliska@suse.cz>\n+\n+\t* params.def: Add avg-loop niter.\n+\t* tree-ssa-loop-ivopts.c (avg_loop_niter): Use the param.\n+\t* cfgloopanal.c (expected_loop_iterations_unbounded): Likewise.\n+\t* doc/invoke.texi: Document the new parameter.\n+\n 2016-07-12  Kyrylo Tkachov  <kyrylo.tkachov@arm.com>\n \n \tPR middle-end/71700"}, {"sha": "2739f44a3a62489faa8b9a0c4e7025253cabed1e", "filename": "gcc/cfgloopanal.c", "status": "modified", "additions": 4, "deletions": 5, "changes": 9, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/4661839ee33dff6b43625e9e69fd9a74830556b4/gcc%2Fcfgloopanal.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/4661839ee33dff6b43625e9e69fd9a74830556b4/gcc%2Fcfgloopanal.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fcfgloopanal.c?ref=4661839ee33dff6b43625e9e69fd9a74830556b4", "patch": "@@ -241,10 +241,9 @@ expected_loop_iterations_unbounded (const struct loop *loop,\n   if (read_profile_p)\n     *read_profile_p = false;\n \n-  /* Average loop rolls about 3 times. If we have no profile at all, it is\n-     best we can do.  */\n+  /* If we have no profile at all, use AVG_LOOP_NITER.  */\n   if (profile_status_for_fn (cfun) == PROFILE_ABSENT)\n-    expected = 3;\n+    expected = PARAM_VALUE (PARAM_AVG_LOOP_NITER);\n   else if (loop->latch->count || loop->header->count)\n     {\n       gcov_type count_in, count_latch;\n@@ -282,9 +281,9 @@ expected_loop_iterations_unbounded (const struct loop *loop,\n \n       if (freq_in == 0)\n \t{\n-\t  /* If we have no profile at all, expect 3 iterations.  */\n+\t  /* If we have no profile at all, use AVG_LOOP_NITER iterations.  */\n \t  if (!freq_latch)\n-\t    expected = 3;\n+\t    expected = PARAM_VALUE (PARAM_AVG_LOOP_NITER);\n \t  else\n \t    expected = freq_latch * 2;\n \t}"}, {"sha": "88fff0581f857eb6d671c2bb84ebc6c48103406f", "filename": "gcc/doc/invoke.texi", "status": "modified", "additions": 3, "deletions": 0, "changes": 3, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/4661839ee33dff6b43625e9e69fd9a74830556b4/gcc%2Fdoc%2Finvoke.texi", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/4661839ee33dff6b43625e9e69fd9a74830556b4/gcc%2Fdoc%2Finvoke.texi", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fdoc%2Finvoke.texi?ref=4661839ee33dff6b43625e9e69fd9a74830556b4", "patch": "@@ -9150,6 +9150,9 @@ If the number of candidates in the set is smaller than this value,\n always try to remove unnecessary ivs from the set\n when adding a new one.\n \n+@item avg-loop-niter\n+Average number of iterations of a loop.\n+\n @item scev-max-expr-size\n Bound on size of expressions used in the scalar evolutions analyzer.\n Large expressions slow the analyzer."}, {"sha": "b86d592d81db35fa3c41f640ea25530dd5abdd97", "filename": "gcc/params.def", "status": "modified", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/4661839ee33dff6b43625e9e69fd9a74830556b4/gcc%2Fparams.def", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/4661839ee33dff6b43625e9e69fd9a74830556b4/gcc%2Fparams.def", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fparams.def?ref=4661839ee33dff6b43625e9e69fd9a74830556b4", "patch": "@@ -527,6 +527,11 @@ DEFPARAM(PARAM_IV_ALWAYS_PRUNE_CAND_SET_BOUND,\n \t \"If number of candidates in the set is smaller, we always try to remove unused ivs during its optimization.\",\n \t 10, 0, 0)\n \n+DEFPARAM(PARAM_AVG_LOOP_NITER,\n+\t \"avg-loop-niter\",\n+\t \"Average number of iterations of a loop.\",\n+\t 10, 1, 0)\n+\n DEFPARAM(PARAM_SCEV_MAX_EXPR_SIZE,\n  \t \"scev-max-expr-size\",\n \t \"Bound on size of expressions used in the scalar evolutions analyzer.\","}, {"sha": "20cf9ef0279c3d23c25c94c2513b6d18f66f4010", "filename": "gcc/tree-ssa-loop-ivopts.c", "status": "modified", "additions": 3, "deletions": 4, "changes": 7, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/4661839ee33dff6b43625e9e69fd9a74830556b4/gcc%2Ftree-ssa-loop-ivopts.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/4661839ee33dff6b43625e9e69fd9a74830556b4/gcc%2Ftree-ssa-loop-ivopts.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftree-ssa-loop-ivopts.c?ref=4661839ee33dff6b43625e9e69fd9a74830556b4", "patch": "@@ -115,8 +115,6 @@ along with GCC; see the file COPYING3.  If not see\n /* The infinite cost.  */\n #define INFTY 10000000\n \n-#define AVG_LOOP_NITER(LOOP) 5\n-\n /* Returns the expected number of loop iterations for LOOP.\n    The average trip count is computed from profile data if it\n    exists. */\n@@ -128,8 +126,9 @@ avg_loop_niter (struct loop *loop)\n   if (niter == -1)\n     {\n       niter = likely_max_stmt_executions_int (loop);\n-      if (niter == -1 || niter > AVG_LOOP_NITER (loop))\n-\treturn AVG_LOOP_NITER (loop);\n+\n+      if (niter == -1 || niter > PARAM_VALUE (PARAM_AVG_LOOP_NITER))\n+\treturn PARAM_VALUE (PARAM_AVG_LOOP_NITER);\n     }\n \n   return niter;"}]}