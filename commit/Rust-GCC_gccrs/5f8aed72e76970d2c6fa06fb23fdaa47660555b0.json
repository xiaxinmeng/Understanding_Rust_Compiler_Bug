{"sha": "5f8aed72e76970d2c6fa06fb23fdaa47660555b0", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6NWY4YWVkNzJlNzY5NzBkMmM2ZmEwNmZiMjNmZGFhNDc2NjA1NTViMA==", "commit": {"author": {"name": "Patrick Palka", "email": "ppalka@redhat.com", "date": "2021-04-23T12:28:58Z"}, "committer": {"name": "Patrick Palka", "email": "ppalka@redhat.com", "date": "2021-04-23T12:28:58Z"}, "message": "c++: Refine enum direct-list-initialization [CWG2374]\n\nThis implements the wording changes of CWG2374, which clarifies the\nwording of P0138 to forbid e.g. direct-list-initialization of a scoped\nenumeration from a different scoped enumeration.\n\ngcc/cp/ChangeLog:\n\n\tDR 2374\n\t* decl.c (is_direct_enum_init): Check the implicit\n\tconvertibility requirement added by CWG 2374.\n\ngcc/testsuite/ChangeLog:\n\n\tDR 2374\n\t* g++.dg/cpp1z/direct-enum-init2.C: New test.", "tree": {"sha": "17888290d6de3fa35ec098cd55538bf4b16366ba", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/17888290d6de3fa35ec098cd55538bf4b16366ba"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/5f8aed72e76970d2c6fa06fb23fdaa47660555b0", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/5f8aed72e76970d2c6fa06fb23fdaa47660555b0", "html_url": "https://github.com/Rust-GCC/gccrs/commit/5f8aed72e76970d2c6fa06fb23fdaa47660555b0", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/5f8aed72e76970d2c6fa06fb23fdaa47660555b0/comments", "author": null, "committer": null, "parents": [{"sha": "35b2be219fc1934ae040d045e355680a83d839c4", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/35b2be219fc1934ae040d045e355680a83d839c4", "html_url": "https://github.com/Rust-GCC/gccrs/commit/35b2be219fc1934ae040d045e355680a83d839c4"}], "stats": {"total": 16, "additions": 15, "deletions": 1}, "files": [{"sha": "60dc2bf182d9ba9208275e17d912d8f673253010", "filename": "gcc/cp/decl.c", "status": "modified", "additions": 7, "deletions": 1, "changes": 8, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/5f8aed72e76970d2c6fa06fb23fdaa47660555b0/gcc%2Fcp%2Fdecl.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/5f8aed72e76970d2c6fa06fb23fdaa47660555b0/gcc%2Fcp%2Fdecl.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fcp%2Fdecl.c?ref=5f8aed72e76970d2c6fa06fb23fdaa47660555b0", "patch": "@@ -6191,7 +6191,13 @@ is_direct_enum_init (tree type, tree init)\n       && ENUM_FIXED_UNDERLYING_TYPE_P (type)\n       && TREE_CODE (init) == CONSTRUCTOR\n       && CONSTRUCTOR_IS_DIRECT_INIT (init)\n-      && CONSTRUCTOR_NELTS (init) == 1)\n+      && CONSTRUCTOR_NELTS (init) == 1\n+      /* DR 2374: The single element needs to be implicitly\n+\t convertible to the underlying type of the enum.  */\n+      && can_convert_arg (ENUM_UNDERLYING_TYPE (type),\n+\t\t\t  TREE_TYPE (CONSTRUCTOR_ELT (init, 0)->value),\n+\t\t\t  CONSTRUCTOR_ELT (init, 0)->value,\n+\t\t\t  LOOKUP_IMPLICIT, tf_none))\n     return true;\n   return false;\n }"}, {"sha": "5b94a8d00fea12cc587a50f9c41765c70144da5c", "filename": "gcc/testsuite/g++.dg/cpp1z/direct-enum-init2.C", "status": "added", "additions": 8, "deletions": 0, "changes": 8, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/5f8aed72e76970d2c6fa06fb23fdaa47660555b0/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Fcpp1z%2Fdirect-enum-init2.C", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/5f8aed72e76970d2c6fa06fb23fdaa47660555b0/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Fcpp1z%2Fdirect-enum-init2.C", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Fcpp1z%2Fdirect-enum-init2.C?ref=5f8aed72e76970d2c6fa06fb23fdaa47660555b0", "patch": "@@ -0,0 +1,8 @@\n+// DR 2374\n+// { dg-do compile { target c++17 } }\n+\n+enum class Orange;\n+enum class Apple;\n+\n+extern Orange o;\n+Apple a{o}; // { dg-error \"cannot convert\" }"}]}