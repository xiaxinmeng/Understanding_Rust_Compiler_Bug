{"sha": "9c8e65c30f22cfa6556f9431c35ec326a8088854", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6OWM4ZTY1YzMwZjIyY2ZhNjU1NmY5NDMxYzM1ZWMzMjZhODA4ODg1NA==", "commit": {"author": {"name": "Olatunji Ruwase", "email": "tjruwase@google.com", "date": "2009-07-20T19:28:05Z"}, "committer": {"name": "Ian Lance Taylor", "email": "ian@gcc.gnu.org", "date": "2009-07-20T19:28:05Z"}, "message": "toplev.c: Invoke FINISH_UNIT callbacks before call to finalize().\n\n./:\t* toplev.c: Invoke FINISH_UNIT callbacks before call to\n\tfinalize().\ntestsuite/:\n\t* gcc.dg/plugin/finish_unit_plugin.c: New test.\n\t* gcc.dg/plugin/finish_unit-test-1.c: New test.\n\t* gcc.dg/plugin/plugin.exp: Added finish_unit_plugin.c test.\n\nFrom-SVN: r149833", "tree": {"sha": "7541d5c6e267f3aaeb0dfc0038a90a3083dfe75f", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/7541d5c6e267f3aaeb0dfc0038a90a3083dfe75f"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/9c8e65c30f22cfa6556f9431c35ec326a8088854", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/9c8e65c30f22cfa6556f9431c35ec326a8088854", "html_url": "https://github.com/Rust-GCC/gccrs/commit/9c8e65c30f22cfa6556f9431c35ec326a8088854", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/9c8e65c30f22cfa6556f9431c35ec326a8088854/comments", "author": null, "committer": null, "parents": [{"sha": "3e014341f8eb395bdb2b9d727dab4a095bc09e66", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/3e014341f8eb395bdb2b9d727dab4a095bc09e66", "html_url": "https://github.com/Rust-GCC/gccrs/commit/3e014341f8eb395bdb2b9d727dab4a095bc09e66"}], "stats": {"total": 53, "additions": 50, "deletions": 3}, "files": [{"sha": "43ea2b7a04cec33425d55374ffb108b73fc93ef2", "filename": "gcc/ChangeLog", "status": "modified", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/9c8e65c30f22cfa6556f9431c35ec326a8088854/gcc%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/9c8e65c30f22cfa6556f9431c35ec326a8088854/gcc%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2FChangeLog?ref=9c8e65c30f22cfa6556f9431c35ec326a8088854", "patch": "@@ -1,3 +1,8 @@\n+2009-07-20  Olatunji Ruwase  <tjruwase@google.com>\n+\n+\t* toplev.c: Invoke FINISH_UNIT callbacks before call to\n+\tfinalize().\n+\n 2009-07-20  Shujing Zhao  <pearly.zhao@oracle.com>\n \n \t* Makefile.in (TREE_INLINE_H, tree-inline.o, cgraph.o): Remove"}, {"sha": "5faeb99bf237e8835f62300f2514a41327e12bd5", "filename": "gcc/testsuite/ChangeLog", "status": "modified", "additions": 6, "deletions": 0, "changes": 6, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/9c8e65c30f22cfa6556f9431c35ec326a8088854/gcc%2Ftestsuite%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/9c8e65c30f22cfa6556f9431c35ec326a8088854/gcc%2Ftestsuite%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2FChangeLog?ref=9c8e65c30f22cfa6556f9431c35ec326a8088854", "patch": "@@ -1,3 +1,9 @@\n+2009-07-20  Olatunji Ruwase  <tjruwase@google.com>\n+\n+\t* gcc.dg/plugin/finish_unit_plugin.c: New test.\n+\t* gcc.dg/plugin/finish_unit-test-1.c: New test.\n+\t* gcc.dg/plugin/plugin.exp: Added finish_unit_plugin.c test.\n+\n 2009-07-20  Adam Nemet  <anemet@caviumnetworks.com>\n \n \t* gcc.target/mips/ext-3.c: New test."}, {"sha": "4cd8a40f44156d3b069d93368f846b57650d5d70", "filename": "gcc/testsuite/gcc.dg/plugin/finish_unit-test-1.c", "status": "added", "additions": 7, "deletions": 0, "changes": 7, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/9c8e65c30f22cfa6556f9431c35ec326a8088854/gcc%2Ftestsuite%2Fgcc.dg%2Fplugin%2Ffinish_unit-test-1.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/9c8e65c30f22cfa6556f9431c35ec326a8088854/gcc%2Ftestsuite%2Fgcc.dg%2Fplugin%2Ffinish_unit-test-1.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgcc.dg%2Fplugin%2Ffinish_unit-test-1.c?ref=9c8e65c30f22cfa6556f9431c35ec326a8088854", "patch": "@@ -0,0 +1,7 @@\n+/* { dg-do compile } */\n+/* { dg-options \"-O\" } */\n+\n+int main (int argc, char **argv) \n+{ \n+  return 0;  \n+}"}, {"sha": "634daeeda135f9d427c6768d9dc458689ddfed89", "filename": "gcc/testsuite/gcc.dg/plugin/finish_unit_plugin.c", "status": "added", "additions": 28, "deletions": 0, "changes": 28, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/9c8e65c30f22cfa6556f9431c35ec326a8088854/gcc%2Ftestsuite%2Fgcc.dg%2Fplugin%2Ffinish_unit_plugin.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/9c8e65c30f22cfa6556f9431c35ec326a8088854/gcc%2Ftestsuite%2Fgcc.dg%2Fplugin%2Ffinish_unit_plugin.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgcc.dg%2Fplugin%2Ffinish_unit_plugin.c?ref=9c8e65c30f22cfa6556f9431c35ec326a8088854", "patch": "@@ -0,0 +1,28 @@\n+/* This plugin creates a fake function in the FINISH_UNIT callback, in\n+ * other words right after compilation of the translation unit. \n+*/\n+#include \"gcc-plugin.h\"\n+#include \"config.h\"\n+#include \"system.h\"\n+#include \"coretypes.h\"\n+#include \"tm.h\"\n+#include \"toplev.h\"\n+#include \"basic-block.h\"\n+#include \"gimple.h\"\n+#include \"tree.h\"\n+#include \"tree-pass.h\"\n+#include \"intl.h\"\n+\n+int plugin_is_GPL_compatible;\n+\n+static void finish_unit_callback (void *gcc_data, void *user_data)\n+{\n+  cgraph_build_static_cdtor ('I', NULL, DEFAULT_INIT_PRIORITY);\n+}\n+\n+int plugin_init (struct plugin_name_args *plugin_info,\n+                 struct plugin_gcc_version *version)\n+{\n+  register_callback (\"finish_unit\", PLUGIN_FINISH_UNIT, &finish_unit_callback, NULL);\n+  return 0;\n+}"}, {"sha": "872a0ea8c3c4bc64541b7c5d3311d616ea247c81", "filename": "gcc/testsuite/gcc.dg/plugin/plugin.exp", "status": "modified", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/9c8e65c30f22cfa6556f9431c35ec326a8088854/gcc%2Ftestsuite%2Fgcc.dg%2Fplugin%2Fplugin.exp", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/9c8e65c30f22cfa6556f9431c35ec326a8088854/gcc%2Ftestsuite%2Fgcc.dg%2Fplugin%2Fplugin.exp", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgcc.dg%2Fplugin%2Fplugin.exp?ref=9c8e65c30f22cfa6556f9431c35ec326a8088854", "patch": "@@ -51,6 +51,7 @@ set plugin_test_list [list \\\n     { ggcplug.c ggcplug-test-1.c } \\\n     { one_time_plugin.c one_time-test-1.c } \\\n     { start_unit_plugin.c start_unit-test-1.c } \\\n+    { finish_unit_plugin.c finish_unit-test-1.c } \\\n ]\n \n foreach plugin_test $plugin_test_list {"}, {"sha": "81d55f3a5b8393c79c3d7b20d4e5aceadfad7be3", "filename": "gcc/toplev.c", "status": "modified", "additions": 3, "deletions": 3, "changes": 6, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/9c8e65c30f22cfa6556f9431c35ec326a8088854/gcc%2Ftoplev.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/9c8e65c30f22cfa6556f9431c35ec326a8088854/gcc%2Ftoplev.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftoplev.c?ref=9c8e65c30f22cfa6556f9431c35ec326a8088854", "patch": "@@ -1091,6 +1091,9 @@ compile_file (void)\n     }\n #endif\n \n+  /* Invoke registered plugin callbacks.  */\n+  invoke_plugin_callbacks (PLUGIN_FINISH_UNIT, NULL);\n+  \n   /* This must be at the end.  Some target ports emit end of file directives\n      into the assembly file here, and hence we can not output anything to the\n      assembly file after this point.  */\n@@ -2348,9 +2351,6 @@ do_compile (void)\n \tcompile_file ();\n \n       finalize ();\n-\n-      /* Invoke registered plugin callbacks.  */\n-      invoke_plugin_callbacks (PLUGIN_FINISH_UNIT, NULL);\n     }\n \n   /* Stop timing and print the times.  */"}]}