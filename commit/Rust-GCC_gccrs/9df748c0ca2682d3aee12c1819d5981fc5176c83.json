{"sha": "9df748c0ca2682d3aee12c1819d5981fc5176c83", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6OWRmNzQ4YzBjYTI2ODJkM2FlZTEyYzE4MTlkNTk4MWZjNTE3NmM4Mw==", "commit": {"author": {"name": "Anthony Green", "email": "green@moxielogic.com", "date": "2009-07-02T01:18:42Z"}, "committer": {"name": "Anthony Green", "email": "green@gcc.gnu.org", "date": "2009-07-02T01:18:42Z"}, "message": "Tweak moxie prologue and epilogue code.\n\nFrom-SVN: r149163", "tree": {"sha": "d81d23335fb74f88ae451168cbb38a8234ab7fb3", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/d81d23335fb74f88ae451168cbb38a8234ab7fb3"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/9df748c0ca2682d3aee12c1819d5981fc5176c83", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/9df748c0ca2682d3aee12c1819d5981fc5176c83", "html_url": "https://github.com/Rust-GCC/gccrs/commit/9df748c0ca2682d3aee12c1819d5981fc5176c83", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/9df748c0ca2682d3aee12c1819d5981fc5176c83/comments", "author": {"login": "atgreen", "id": 89993, "node_id": "MDQ6VXNlcjg5OTkz", "avatar_url": "https://avatars.githubusercontent.com/u/89993?v=4", "gravatar_id": "", "url": "https://api.github.com/users/atgreen", "html_url": "https://github.com/atgreen", "followers_url": "https://api.github.com/users/atgreen/followers", "following_url": "https://api.github.com/users/atgreen/following{/other_user}", "gists_url": "https://api.github.com/users/atgreen/gists{/gist_id}", "starred_url": "https://api.github.com/users/atgreen/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/atgreen/subscriptions", "organizations_url": "https://api.github.com/users/atgreen/orgs", "repos_url": "https://api.github.com/users/atgreen/repos", "events_url": "https://api.github.com/users/atgreen/events{/privacy}", "received_events_url": "https://api.github.com/users/atgreen/received_events", "type": "User", "site_admin": false}, "committer": null, "parents": [{"sha": "b0f0c817838b52f1c5a769d6a6b38be9669e7988", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/b0f0c817838b52f1c5a769d6a6b38be9669e7988", "html_url": "https://github.com/Rust-GCC/gccrs/commit/b0f0c817838b52f1c5a769d6a6b38be9669e7988"}], "stats": {"total": 73, "additions": 46, "deletions": 27}, "files": [{"sha": "ea47ebd37906e8cf2b43a29dfef245655419affb", "filename": "gcc/ChangeLog", "status": "modified", "additions": 9, "deletions": 0, "changes": 9, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/9df748c0ca2682d3aee12c1819d5981fc5176c83/gcc%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/9df748c0ca2682d3aee12c1819d5981fc5176c83/gcc%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2FChangeLog?ref=9df748c0ca2682d3aee12c1819d5981fc5176c83", "patch": "@@ -1,3 +1,12 @@\n+2009-07-01  Anthony Green  <green@moxielogic.com>\n+\n+\t* config/moxie/moxie.c (moxie_expand_prologue): Use dec\n+\tinstruction when possible.\n+\t(moxie_expand_prologue): Ditto.  Also, save an instruction and\n+\tsome complexity by popping off of $r12 instead of $sp.  \n+\t* config/moxie/moxie.md (movsi_pop): Don't assume $sp.  Take two\n+\toperands.\n+\t\n 2009-07-01  Richard Henderson  <rth@redhat.com>\n \n \tPR bootstrap/40347"}, {"sha": "897717b40dfd7580c691ad2d079b169094554f25", "filename": "gcc/config/moxie/moxie.c", "status": "modified", "additions": 34, "deletions": 24, "changes": 58, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/9df748c0ca2682d3aee12c1819d5981fc5176c83/gcc%2Fconfig%2Fmoxie%2Fmoxie.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/9df748c0ca2682d3aee12c1819d5981fc5176c83/gcc%2Fconfig%2Fmoxie%2Fmoxie.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fconfig%2Fmoxie%2Fmoxie.c?ref=9df748c0ca2682d3aee12c1819d5981fc5176c83", "patch": "@@ -273,14 +273,25 @@ moxie_expand_prologue (void)\n \n   if (cfun->machine->size_for_adjusting_sp > 0)\n     {\n-      insn = \n-\temit_insn (gen_movsi (gen_rtx_REG (Pmode, MOXIE_R12), \n-\t\t\t      GEN_INT (-cfun->machine->size_for_adjusting_sp)));\n-      RTX_FRAME_RELATED_P (insn) = 1;\n-      insn = emit_insn (gen_addsi3 (stack_pointer_rtx, \n-\t\t\t\t    stack_pointer_rtx, \n-\t\t\t\t    gen_rtx_REG (Pmode, MOXIE_R12)));\n-      RTX_FRAME_RELATED_P (insn) = 1;\n+      if (cfun->machine->size_for_adjusting_sp <= 255)\n+\t{\n+\t  insn = emit_insn (gen_subsi3 (stack_pointer_rtx, \n+\t\t\t\t\tstack_pointer_rtx, \n+\t\t\t\t\tGEN_INT (cfun->machine->size_for_adjusting_sp)));\n+\t  RTX_FRAME_RELATED_P (insn) = 1;\n+\t}\n+      else\n+\t{\n+\t  insn = \n+\t    emit_insn (gen_movsi \n+\t\t       (gen_rtx_REG (Pmode, MOXIE_R12), \n+\t\t\tGEN_INT (-cfun->machine->size_for_adjusting_sp)));\n+\t  RTX_FRAME_RELATED_P (insn) = 1;\n+\t  insn = emit_insn (gen_addsi3 (stack_pointer_rtx, \n+\t\t\t\t\tstack_pointer_rtx, \n+\t\t\t\t\tgen_rtx_REG (Pmode, MOXIE_R12)));\n+\t  RTX_FRAME_RELATED_P (insn) = 1;\n+\t}\t\n     }\n }\n \n@@ -293,26 +304,25 @@ moxie_expand_epilogue (void)\n   if (cfun->machine->callee_saved_reg_size != 0)\n     {\n       reg = gen_rtx_REG (Pmode, MOXIE_R12);\n-      emit_move_insn (reg,\n-\t\t      GEN_INT (-cfun->machine->callee_saved_reg_size));\n-      emit_insn (gen_addsi3 (reg, reg, hard_frame_pointer_rtx));\n-      insn = emit_move_insn (stack_pointer_rtx, reg);\n-      RTX_FRAME_RELATED_P (insn) = 1;\n-      add_reg_note (insn, REG_CFA_DEF_CFA,\n-\t\t    plus_constant (stack_pointer_rtx,\n-\t\t\t\t   cfun->machine->callee_saved_reg_size));\n+      if (cfun->machine->callee_saved_reg_size <= 255)\n+\t{\n+\t  emit_move_insn (reg, hard_frame_pointer_rtx);\n+\t  emit_insn (gen_subsi3 \n+\t\t     (reg, reg, \n+\t\t      GEN_INT (cfun->machine->callee_saved_reg_size)));\n+\t}\n+      else\n+\t{\n+\t  emit_move_insn (reg,\n+\t\t\t  GEN_INT (-cfun->machine->callee_saved_reg_size));\n+\t  emit_insn (gen_addsi3 (reg, reg, hard_frame_pointer_rtx));\n+\t}\n       for (regno = FIRST_PSEUDO_REGISTER; regno-- > 0; )\n \tif (!fixed_regs[regno] && !call_used_regs[regno]\n \t    && df_regs_ever_live_p (regno))\n \t  {\n-\t    reg = gen_rtx_REG (Pmode, regno);\n-\t    insn = emit_insn (gen_movsi_pop (reg));\n-\t    RTX_FRAME_RELATED_P (insn) = 1;\n-\t    add_reg_note (insn, REG_CFA_ADJUST_CFA,\n-\t\t\t  gen_rtx_SET (VOIDmode, stack_pointer_rtx,\n-\t\t\t\t       plus_constant (stack_pointer_rtx,\n-\t\t\t\t\t\t      UNITS_PER_WORD)));\n-\t    add_reg_note (insn, REG_CFA_RESTORE, reg);\n+\t    rtx preg = gen_rtx_REG (Pmode, regno);\n+\t    insn = emit_insn (gen_movsi_pop (reg, preg));\n \t  }\n     }\n "}, {"sha": "02072f48388bb0384f1ae7f63fbef34fc34627fe", "filename": "gcc/config/moxie/moxie.md", "status": "modified", "additions": 3, "deletions": 3, "changes": 6, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/9df748c0ca2682d3aee12c1819d5981fc5176c83/gcc%2Fconfig%2Fmoxie%2Fmoxie.md", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/9df748c0ca2682d3aee12c1819d5981fc5176c83/gcc%2Fconfig%2Fmoxie%2Fmoxie.md", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fconfig%2Fmoxie%2Fmoxie.md?ref=9df748c0ca2682d3aee12c1819d5981fc5176c83", "patch": "@@ -195,10 +195,10 @@\n \n ;; Pop a register from the stack\n (define_insn \"movsi_pop\"\n-  [(set:SI (match_operand:SI 0 \"register_operand\" \"=r\")\n-\t(mem:SI (post_inc:SI (reg:SI 1))))]\n+  [(set:SI (match_operand:SI 1 \"register_operand\" \"=r\")\n+\t(mem:SI (post_inc:SI (match_operand:SI 0 \"register_operand\" \"r\"))))]\n   \"\"\n-  \"pop    $sp, %0\")\n+  \"pop    %0, %1\")\n \n (define_expand \"movsi\"\n    [(set (match_operand:SI 0 \"general_operand\" \"\")"}]}