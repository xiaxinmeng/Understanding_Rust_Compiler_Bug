{"sha": "6f334f4405d90f7d34f6354ca59bcd3f2579aae9", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6NmYzMzRmNDQwNWQ5MGY3ZDM0ZjYzNTRjYTU5YmNkM2YyNTc5YWFlOQ==", "commit": {"author": {"name": "Doug Evans", "email": "dje@gnu.org", "date": "1996-03-29T20:45:31Z"}, "committer": {"name": "Doug Evans", "email": "dje@gnu.org", "date": "1996-03-29T20:45:31Z"}, "message": "sparc.h (FUNCTION_PROFILER): Save/restore %g2 around call to mcount.\n\n\t* sparc/sparc.h (FUNCTION_PROFILER): Save/restore %g2 around call\n\tto mcount.\n\nFrom-SVN: r11644", "tree": {"sha": "39cbff4c515175579f623f86fd339d62e9400f91", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/39cbff4c515175579f623f86fd339d62e9400f91"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/6f334f4405d90f7d34f6354ca59bcd3f2579aae9", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/6f334f4405d90f7d34f6354ca59bcd3f2579aae9", "html_url": "https://github.com/Rust-GCC/gccrs/commit/6f334f4405d90f7d34f6354ca59bcd3f2579aae9", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/6f334f4405d90f7d34f6354ca59bcd3f2579aae9/comments", "author": null, "committer": null, "parents": [{"sha": "0a78e86253db82240953e120ea10084870697d61", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/0a78e86253db82240953e120ea10084870697d61", "html_url": "https://github.com/Rust-GCC/gccrs/commit/0a78e86253db82240953e120ea10084870697d61"}], "stats": {"total": 12, "additions": 10, "deletions": 2}, "files": [{"sha": "c2b136b4776c1698108a137dbf57729d31c9e9d4", "filename": "gcc/config/sparc/sparc.h", "status": "modified", "additions": 10, "deletions": 2, "changes": 12, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/6f334f4405d90f7d34f6354ca59bcd3f2579aae9/gcc%2Fconfig%2Fsparc%2Fsparc.h", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/6f334f4405d90f7d34f6354ca59bcd3f2579aae9/gcc%2Fconfig%2Fsparc%2Fsparc.h", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fconfig%2Fsparc%2Fsparc.h?ref=6f334f4405d90f7d34f6354ca59bcd3f2579aae9", "patch": "@@ -1657,10 +1657,17 @@ extern int leaf_function;\n    : output_function_prologue (FILE, SIZE, leaf_function))\n \f\n /* Output assembler code to FILE to increment profiler label # LABELNO\n-   for profiling a function entry.  */\n+   for profiling a function entry.\n+\n+   32 bit sparc uses %g2 as the STATIC_CHAIN_REGNUM which gets clobbered\n+   during profiling so we need to save/restore it around the call to mcount.\n+   We're guaranteed that a save has just been done, and we use the space\n+   allocated for intreg/fpreg value passing.  */\n \n #define FUNCTION_PROFILER(FILE, LABELNO)  \t\t\t\\\n   do {\t\t\t\t\t\t\t\t\\\n+    if (! TARGET_ARCH64)\t\t\t\t\t\\\n+      fputs (\"\\tst %g2,[%fp-4]\\n\", FILE);\t\t\t\\\n     fputs (\"\\tsethi %hi(\", (FILE));\t\t\t\t\\\n     ASM_OUTPUT_INTERNAL_LABELREF (FILE, \"LP\", LABELNO);\t\t\\\n     fputs (\"),%o0\\n\", (FILE));\t\t\t\t\t\\\n@@ -1670,9 +1677,10 @@ extern int leaf_function;\n     fputs (\"\\tcall mcount\\n\\tadd %lo(\", (FILE));\t\t\\\n     ASM_OUTPUT_INTERNAL_LABELREF (FILE, \"LP\", LABELNO);\t\t\\\n     fputs (\"),%o0,%o0\\n\", (FILE));\t\t\t\t\\\n+    if (! TARGET_ARCH64)\t\t\t\t\t\\\n+      fputs (\"\\tld [%fp-4],%g2\\n\", FILE);\t\t\t\\\n   } while (0)\n \n-\n /* There are three profiling modes for basic blocks available.\n    The modes are selected at compile time by using the options\n    -a or -ax of the gnu compiler."}]}