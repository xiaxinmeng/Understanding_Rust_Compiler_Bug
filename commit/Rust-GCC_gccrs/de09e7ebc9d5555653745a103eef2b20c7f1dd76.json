{"sha": "de09e7ebc9d5555653745a103eef2b20c7f1dd76", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6ZGUwOWU3ZWJjOWQ1NTU1NjUzNzQ1YTEwM2VlZjJiMjBjN2YxZGQ3Ng==", "commit": {"author": {"name": "Mark Eggleston", "email": "markeggleston@gcc.gnu.org", "date": "2020-08-10T07:07:39Z"}, "committer": {"name": "Mark Eggleston", "email": "markeggleston@gcc.gnu.org", "date": "2020-08-24T10:13:11Z"}, "message": "Fortran  :  get_environment_variable runtime error PR96486\n\nRuntime error occurs when the type of the value argument is\ncharacter(0):  \"Zero-length string passed as value...\".\nThe status argument, intent(out), will contain -1 if the value\nof the environment is too large to fit in the value argument, this\nis the case if the type is character(0) so there is no reason to\nproduce a runtime error if the value argument is zero length.\n\n2020-08-24  Mark Eggleston  <markeggleston@gcc.gnu.org>\n\nlibgfortran/\n\n\tPR fortran/96486\n\t* intrinsics/env.c: If value_len is > 0 blank the string.\n\tCopy the result only if its length is > 0.\n\n2020-08-24  Mark Eggleston  <markeggleston@gcc.gnu.org>\n\ngcc/testsuite/\n\n\tPR fortran/96486\n\t* gfortran.dg/pr96486.f90: New test.", "tree": {"sha": "bbf7e02b3cd07e5352e74e4fd97f3d2e69178fa9", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/bbf7e02b3cd07e5352e74e4fd97f3d2e69178fa9"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/de09e7ebc9d5555653745a103eef2b20c7f1dd76", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/de09e7ebc9d5555653745a103eef2b20c7f1dd76", "html_url": "https://github.com/Rust-GCC/gccrs/commit/de09e7ebc9d5555653745a103eef2b20c7f1dd76", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/de09e7ebc9d5555653745a103eef2b20c7f1dd76/comments", "author": null, "committer": null, "parents": [{"sha": "259d072067997ab8f55afcf735c91b6740fd0425", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/259d072067997ab8f55afcf735c91b6740fd0425", "html_url": "https://github.com/Rust-GCC/gccrs/commit/259d072067997ab8f55afcf735c91b6740fd0425"}], "stats": {"total": 16, "additions": 11, "deletions": 5}, "files": [{"sha": "fdc7025d61c35d8f0fe5a134905b02b4968d170e", "filename": "gcc/testsuite/gfortran.dg/pr96486.f90", "status": "added", "additions": 9, "deletions": 0, "changes": 9, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/de09e7ebc9d5555653745a103eef2b20c7f1dd76/gcc%2Ftestsuite%2Fgfortran.dg%2Fpr96486.f90", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/de09e7ebc9d5555653745a103eef2b20c7f1dd76/gcc%2Ftestsuite%2Fgfortran.dg%2Fpr96486.f90", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgfortran.dg%2Fpr96486.f90?ref=de09e7ebc9d5555653745a103eef2b20c7f1dd76", "patch": "@@ -0,0 +1,9 @@\n+! { dg-do run }\n+\n+program test\n+  implicit none\n+  character(0) :: value\n+  integer :: l, stat\n+  call get_environment_variable(\"HOME\",value,length=l,status=stat)\n+  if (stat.ne.-1) stop 1\n+end program test"}, {"sha": "7ab0b44389707e60797f47aee94c965acf74ba88", "filename": "libgfortran/intrinsics/env.c", "status": "modified", "additions": 2, "deletions": 5, "changes": 7, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/de09e7ebc9d5555653745a103eef2b20c7f1dd76/libgfortran%2Fintrinsics%2Fenv.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/de09e7ebc9d5555653745a103eef2b20c7f1dd76/libgfortran%2Fintrinsics%2Fenv.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libgfortran%2Fintrinsics%2Fenv.c?ref=de09e7ebc9d5555653745a103eef2b20c7f1dd76", "patch": "@@ -110,10 +110,7 @@ get_environment_variable_i4 (char *name, char *value, GFC_INTEGER_4 *length,\n \n   if (value != NULL)\n     { \n-      if (value_len < 1)\n-\truntime_error (\"Zero-length string passed as value to \"\n-\t\t       \"get_environment_variable.\");\n-      else\n+      if (value_len > 0)\n \tmemset (value, ' ', value_len); /* Blank the string.  */\n     }\n \n@@ -138,7 +135,7 @@ get_environment_variable_i4 (char *name, char *value, GFC_INTEGER_4 *length,\n \t      memcpy (value, res, value_len);\n \t      stat = GFC_VALUE_TOO_SHORT;\n \t    }\n-\t  else\n+\t  else if (res_len > 0)\n \t    memcpy (value, res, res_len);\n \t}\n     }"}]}