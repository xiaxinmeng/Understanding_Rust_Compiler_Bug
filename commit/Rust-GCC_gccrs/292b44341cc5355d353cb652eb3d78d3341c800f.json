{"sha": "292b44341cc5355d353cb652eb3d78d3341c800f", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6MjkyYjQ0MzQxY2M1MzU1ZDM1M2NiNjUyZWIzZDc4ZDMzNDFjODAwZg==", "commit": {"author": {"name": "Jakub Jelinek", "email": "jakub@redhat.com", "date": "2011-11-11T19:58:10Z"}, "committer": {"name": "Jakub Jelinek", "email": "jakub@gcc.gnu.org", "date": "2011-11-11T19:58:10Z"}, "message": "i386-protos.h (ix86_maybe_emit_epilogue_vzeroupper): New prototype.\n\n\t* config/i386/i386-protos.h (ix86_maybe_emit_epilogue_vzeroupper):\n\tNew prototype.\n\t* config/i386/i386.c (ix86_maybe_emit_epilogue_vzeroupper): New\n\tfunction.\n\t(ix86_expand_epilogue): Use it.\n\t* config/i386/i386.md (return, simple_return): Call it in the\n\texpanders.\n\nFrom-SVN: r181300", "tree": {"sha": "34ca32b4788aa4ec46896e1926f4075511d16fc2", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/34ca32b4788aa4ec46896e1926f4075511d16fc2"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/292b44341cc5355d353cb652eb3d78d3341c800f", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/292b44341cc5355d353cb652eb3d78d3341c800f", "html_url": "https://github.com/Rust-GCC/gccrs/commit/292b44341cc5355d353cb652eb3d78d3341c800f", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/292b44341cc5355d353cb652eb3d78d3341c800f/comments", "author": {"login": "jakubjelinek", "id": 9370665, "node_id": "MDQ6VXNlcjkzNzA2NjU=", "avatar_url": "https://avatars.githubusercontent.com/u/9370665?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jakubjelinek", "html_url": "https://github.com/jakubjelinek", "followers_url": "https://api.github.com/users/jakubjelinek/followers", "following_url": "https://api.github.com/users/jakubjelinek/following{/other_user}", "gists_url": "https://api.github.com/users/jakubjelinek/gists{/gist_id}", "starred_url": "https://api.github.com/users/jakubjelinek/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jakubjelinek/subscriptions", "organizations_url": "https://api.github.com/users/jakubjelinek/orgs", "repos_url": "https://api.github.com/users/jakubjelinek/repos", "events_url": "https://api.github.com/users/jakubjelinek/events{/privacy}", "received_events_url": "https://api.github.com/users/jakubjelinek/received_events", "type": "User", "site_admin": false}, "committer": null, "parents": [{"sha": "bad2545327c95d91221ad5ad546b0ee0fc706ef3", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/bad2545327c95d91221ad5ad546b0ee0fc706ef3", "html_url": "https://github.com/Rust-GCC/gccrs/commit/bad2545327c95d91221ad5ad546b0ee0fc706ef3"}], "stats": {"total": 27, "additions": 23, "deletions": 4}, "files": [{"sha": "73bec2249f271d1e55b9108a693b7b3968ef1182", "filename": "gcc/ChangeLog", "status": "modified", "additions": 8, "deletions": 0, "changes": 8, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/292b44341cc5355d353cb652eb3d78d3341c800f/gcc%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/292b44341cc5355d353cb652eb3d78d3341c800f/gcc%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2FChangeLog?ref=292b44341cc5355d353cb652eb3d78d3341c800f", "patch": "@@ -1,5 +1,13 @@\n 2011-11-11  Jakub Jelinek  <jakub@redhat.com>\n \n+\t* config/i386/i386-protos.h (ix86_maybe_emit_epilogue_vzeroupper):\n+\tNew prototype.\n+\t* config/i386/i386.c (ix86_maybe_emit_epilogue_vzeroupper): New\n+\tfunction.\n+\t(ix86_expand_epilogue): Use it.\n+\t* config/i386/i386.md (return, simple_return): Call it in the\n+\texpanders.\n+\n \tPR tree-optimization/51091\n \t* tree-stdarg.c (execute_optimize_stdarg): Ignore TREE_CLOBBER_P\n \trhs also in the va_list_simple_ptr case."}, {"sha": "630112f625d96266a5a6179552d02a2ecd5948e9", "filename": "gcc/config/i386/i386-protos.h", "status": "modified", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/292b44341cc5355d353cb652eb3d78d3341c800f/gcc%2Fconfig%2Fi386%2Fi386-protos.h", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/292b44341cc5355d353cb652eb3d78d3341c800f/gcc%2Fconfig%2Fi386%2Fi386-protos.h", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fconfig%2Fi386%2Fi386-protos.h?ref=292b44341cc5355d353cb652eb3d78d3341c800f", "patch": "@@ -32,6 +32,7 @@ extern void ix86_setup_frame_addresses (void);\n \n extern HOST_WIDE_INT ix86_initial_elimination_offset (int, int);\n extern void ix86_expand_prologue (void);\n+extern void ix86_maybe_emit_epilogue_vzeroupper (void);\n extern void ix86_expand_epilogue (int);\n extern void ix86_expand_split_stack_prologue (void);\n "}, {"sha": "7c5814f21c309f7191b8c2b4c7ab39e4dca7f331", "filename": "gcc/config/i386/i386.c", "status": "modified", "additions": 12, "deletions": 4, "changes": 16, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/292b44341cc5355d353cb652eb3d78d3341c800f/gcc%2Fconfig%2Fi386%2Fi386.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/292b44341cc5355d353cb652eb3d78d3341c800f/gcc%2Fconfig%2Fi386%2Fi386.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fconfig%2Fi386%2Fi386.c?ref=292b44341cc5355d353cb652eb3d78d3341c800f", "patch": "@@ -10614,6 +10614,17 @@ ix86_emit_restore_sse_regs_using_mov (HOST_WIDE_INT cfa_offset,\n       }\n }\n \n+/* Emit vzeroupper if needed.  */\n+\n+void\n+ix86_maybe_emit_epilogue_vzeroupper (void)\n+{\n+  if (TARGET_VZEROUPPER\n+      && !TREE_THIS_VOLATILE (cfun->decl)\n+      && !cfun->machine->caller_return_avx256_p)\n+    emit_insn (gen_avx_vzeroupper (GEN_INT (call_no_avx256)));\n+}\n+\n /* Restore function stack, frame, and registers.  */\n \n void\n@@ -10911,10 +10922,7 @@ ix86_expand_epilogue (int style)\n     }\n \n   /* Emit vzeroupper if needed.  */\n-  if (TARGET_VZEROUPPER\n-      && !TREE_THIS_VOLATILE (cfun->decl)\n-      && !cfun->machine->caller_return_avx256_p)\n-    emit_insn (gen_avx_vzeroupper (GEN_INT (call_no_avx256)));\n+  ix86_maybe_emit_epilogue_vzeroupper ();\n \n   if (crtl->args.pops_args && crtl->args.size)\n     {"}, {"sha": "bc6025323047a54936931528c09d55f4288010f6", "filename": "gcc/config/i386/i386.md", "status": "modified", "additions": 2, "deletions": 0, "changes": 2, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/292b44341cc5355d353cb652eb3d78d3341c800f/gcc%2Fconfig%2Fi386%2Fi386.md", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/292b44341cc5355d353cb652eb3d78d3341c800f/gcc%2Fconfig%2Fi386%2Fi386.md", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fconfig%2Fi386%2Fi386.md?ref=292b44341cc5355d353cb652eb3d78d3341c800f", "patch": "@@ -11736,6 +11736,7 @@\n   [(simple_return)]\n   \"ix86_can_use_return_insn_p ()\"\n {\n+  ix86_maybe_emit_epilogue_vzeroupper ();\n   if (crtl->args.pops_args)\n     {\n       rtx popc = GEN_INT (crtl->args.pops_args);\n@@ -11752,6 +11753,7 @@\n   [(simple_return)]\n   \"!TARGET_SEH\"\n {\n+  ix86_maybe_emit_epilogue_vzeroupper ();\n   if (crtl->args.pops_args)\n     {\n       rtx popc = GEN_INT (crtl->args.pops_args);"}]}