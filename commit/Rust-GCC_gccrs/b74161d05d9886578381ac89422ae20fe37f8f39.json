{"sha": "b74161d05d9886578381ac89422ae20fe37f8f39", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6Yjc0MTYxZDA1ZDk4ODY1NzgzODFhYzg5NDIyYWUyMGZlMzdmOGYzOQ==", "commit": {"author": {"name": "Prachi Godbole", "email": "prachi.godbole@imgtec.com", "date": "2018-06-12T10:35:46Z"}, "committer": {"name": "Robert Suchanek", "email": "rts@gcc.gnu.org", "date": "2018-06-12T10:35:46Z"}, "message": "MIPS: Update I6400 scheduler.\n\ngcc/ChangeLog:\n\n2018-06-12  Prachi Godbole  <prachi.godbole@imgtec.com>\n\n\t* config/mips/i6400.md (i6400_gpmuldiv): Remove cpu_unit.\n\t(i6400_gpmul): Add cpu_unit.\n\t(i6400_gpdiv): Likewise.\n\t(i6400_msa_add_d): Update reservations.\n\t(i6400_msa_int_add) Likewise.\n\t(i6400_msa_short_logic3) Likewise.\n\t(i6400_msa_short_logic2) Likewise.\n\t(i6400_msa_short_logic) Likewise.\n\t(i6400_msa_move) Likewise.\n\t(i6400_msa_cmp) Likewise.\n\t(i6400_msa_short_float2) Likewise.\n\t(i6400_msa_div_d) Likewise.\n\t(i6400_msa_long_logic1) Likewise.\n\t(i6400_msa_long_logic2) Likewise.\n\t(i6400_msa_mult) Likewise.\n\t(i6400_msa_long_float2) Likewise.\n\t(i6400_msa_long_float4) Likewise.\n\t(i6400_msa_long_float5) Likewise.\n\t(i6400_msa_long_float8) Likewise.\n\t(i6400_fpu_fadd): Include frint type.\n\t(i6400_fpu_store): New define_insn_reservation.\n\t(i6400_fpu_load): Likewise.\n\t(i6400_fpu_move): Likewise.\n\t(i6400_fpu_fcmp): Likewise.\n\t(i6400_fpu_fmadd): Likewise.\n\t(i6400_int_mult): Include imul3nc type and update reservation.\n\t(i6400_int_div): Include idiv3 type and update reservation.\n\t(i6400_int_load): Update to check type not move_type.\n\t(i6400_int_store): Likewise.\n\t(i6400_int_prefetch): Set zero latency.\n\nFrom-SVN: r261489", "tree": {"sha": "1202af79e85660ce7c8ef1012ea4ecc46ca17b6c", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/1202af79e85660ce7c8ef1012ea4ecc46ca17b6c"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/b74161d05d9886578381ac89422ae20fe37f8f39", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/b74161d05d9886578381ac89422ae20fe37f8f39", "html_url": "https://github.com/Rust-GCC/gccrs/commit/b74161d05d9886578381ac89422ae20fe37f8f39", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/b74161d05d9886578381ac89422ae20fe37f8f39/comments", "author": null, "committer": null, "parents": [{"sha": "57d0f7c6d7da4607f61478fde993b225c7214904", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/57d0f7c6d7da4607f61478fde993b225c7214904", "html_url": "https://github.com/Rust-GCC/gccrs/commit/57d0f7c6d7da4607f61478fde993b225c7214904"}], "stats": {"total": 113, "additions": 88, "deletions": 25}, "files": [{"sha": "afec6b93106cd60c455e54ad25b34ec6dc7f9be3", "filename": "gcc/ChangeLog", "status": "modified", "additions": 33, "deletions": 0, "changes": 33, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/b74161d05d9886578381ac89422ae20fe37f8f39/gcc%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/b74161d05d9886578381ac89422ae20fe37f8f39/gcc%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2FChangeLog?ref=b74161d05d9886578381ac89422ae20fe37f8f39", "patch": "@@ -1,3 +1,36 @@\n+2018-06-12  Prachi Godbole  <prachi.godbole@imgtec.com>\n+\n+\t* config/mips/i6400.md (i6400_gpmuldiv): Remove cpu_unit.\n+\t(i6400_gpmul): Add cpu_unit.\n+\t(i6400_gpdiv): Likewise.\n+\t(i6400_msa_add_d): Update reservations.\n+\t(i6400_msa_int_add) Likewise.\n+\t(i6400_msa_short_logic3) Likewise.\n+\t(i6400_msa_short_logic2) Likewise.\n+\t(i6400_msa_short_logic) Likewise.\n+\t(i6400_msa_move) Likewise.\n+\t(i6400_msa_cmp) Likewise.\n+\t(i6400_msa_short_float2) Likewise.\n+\t(i6400_msa_div_d) Likewise.\n+\t(i6400_msa_long_logic1) Likewise.\n+\t(i6400_msa_long_logic2) Likewise.\n+\t(i6400_msa_mult) Likewise.\n+\t(i6400_msa_long_float2) Likewise.\n+\t(i6400_msa_long_float4) Likewise.\n+\t(i6400_msa_long_float5) Likewise.\n+\t(i6400_msa_long_float8) Likewise.\n+\t(i6400_fpu_fadd): Include frint type.\n+\t(i6400_fpu_store): New define_insn_reservation.\n+\t(i6400_fpu_load): Likewise.\n+\t(i6400_fpu_move): Likewise.\n+\t(i6400_fpu_fcmp): Likewise.\n+\t(i6400_fpu_fmadd): Likewise.\n+\t(i6400_int_mult): Include imul3nc type and update reservation.\n+\t(i6400_int_div): Include idiv3 type and update reservation.\n+\t(i6400_int_load): Update to check type not move_type.\n+\t(i6400_int_store): Likewise.\n+\t(i6400_int_prefetch): Set zero latency.\n+\n 2018-06-12  Eric Botcazou  <ebotcazou@adacore.com>\n \n \t* gcc.c: Document new %@{...} sequence."}, {"sha": "8058a8dd8070f4d03fc45512f144e3f3866d4f16", "filename": "gcc/config/mips/i6400.md", "status": "modified", "additions": 55, "deletions": 25, "changes": 80, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/b74161d05d9886578381ac89422ae20fe37f8f39/gcc%2Fconfig%2Fmips%2Fi6400.md", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/b74161d05d9886578381ac89422ae20fe37f8f39/gcc%2Fconfig%2Fmips%2Fi6400.md", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fconfig%2Fmips%2Fi6400.md?ref=b74161d05d9886578381ac89422ae20fe37f8f39", "patch": "@@ -21,7 +21,7 @@\n (define_automaton \"i6400_int_pipe, i6400_mdu_pipe, i6400_fpu_short_pipe,\n \t\t   i6400_fpu_long_pipe\")\n \n-(define_cpu_unit \"i6400_gpmuldiv\" \"i6400_mdu_pipe\")\n+(define_cpu_unit \"i6400_gpmul, i6400_gpdiv\" \"i6400_mdu_pipe\")\n (define_cpu_unit \"i6400_agen, i6400_alu1, i6400_lsu\" \"i6400_int_pipe\")\n (define_cpu_unit \"i6400_control, i6400_ctu, i6400_alu0\" \"i6400_int_pipe\")\n \n@@ -50,49 +50,49 @@\n   (and (eq_attr \"cpu\" \"i6400\")\n        (and (eq_attr \"mode\" \"!V2DI\")\n \t    (eq_attr \"alu_type\" \"simd_add\")))\n-  \"i6400_fpu_short, i6400_fpu_intadd\")\n+  \"i6400_fpu_short+i6400_fpu_intadd*2\")\n \n ;; add, hadd, sub, hsub, average, min, max, compare\n (define_insn_reservation \"i6400_msa_int_add\" 2\n   (and (eq_attr \"cpu\" \"i6400\")\n        (eq_attr \"type\" \"simd_int_arith\"))\n-  \"i6400_fpu_short, i6400_fpu_intadd\")\n+  \"i6400_fpu_short+i6400_fpu_intadd*2\")\n \n ;; sat, pcnt\n (define_insn_reservation \"i6400_msa_short_logic3\" 3\n   (and (eq_attr \"cpu\" \"i6400\")\n        (eq_attr \"type\" \"simd_sat,simd_pcnt\"))\n-  \"i6400_fpu_short, i6400_fpu_logic\")\n+  \"i6400_fpu_short+i6400_fpu_logic*2\")\n \n ;; shifts, nloc, nlzc, bneg, bclr, shf\n (define_insn_reservation \"i6400_msa_short_logic2\" 2\n   (and (eq_attr \"cpu\" \"i6400\")\n        (eq_attr \"type\" \"simd_shift,simd_shf,simd_bit\"))\n-  \"i6400_fpu_short, i6400_fpu_logic\")\n+  \"i6400_fpu_short+i6400_fpu_logic*2\")\n \n ;; and, or, xor, ilv, pck, fill, splat\n (define_insn_reservation \"i6400_msa_short_logic\" 1\n   (and (eq_attr \"cpu\" \"i6400\")\n        (eq_attr \"type\" \"simd_permute,simd_logic,simd_splat,simd_fill\"))\n-  \"i6400_fpu_short, i6400_fpu_logic\")\n+  \"i6400_fpu_short+i6400_fpu_logic*2\")\n \n ;; move.v, ldi\n (define_insn_reservation \"i6400_msa_move\" 1\n   (and (eq_attr \"cpu\" \"i6400\")\n        (eq_attr \"type\" \"simd_move\"))\n-  \"i6400_fpu_short, i6400_fpu_logic\")\n+  \"i6400_fpu_short+i6400_fpu_logic*2\")\n \n ;; Float compare New: CMP.cond.fmt\n (define_insn_reservation \"i6400_msa_cmp\" 2\n   (and (eq_attr \"cpu\" \"i6400\")\n        (eq_attr \"type\" \"simd_fcmp\"))\n-  \"i6400_fpu_short, i6400_fpu_cmp\")\n+  \"i6400_fpu_short+i6400_fpu_cmp*2\")\n \n ;; Float min, max, class\n (define_insn_reservation \"i6400_msa_short_float2\" 2\n   (and (eq_attr \"cpu\" \"i6400\")\n        (eq_attr \"type\" \"simd_fminmax,simd_fclass\"))\n-  \"i6400_fpu_short, i6400_fpu_float\")\n+  \"i6400_fpu_short+i6400_fpu_float*2\")\n \n ;; div.d, mod.d (non-pipelined)\n (define_insn_reservation \"i6400_msa_div_d\" 36\n@@ -158,43 +158,43 @@\n (define_insn_reservation \"i6400_msa_long_logic1\" 1\n   (and (eq_attr \"cpu\" \"i6400\")\n        (eq_attr \"type\" \"simd_bitmov,simd_insert\"))\n-  \"i6400_fpu_long, i6400_fpu_logic_l\")\n+  \"i6400_fpu_long+i6400_fpu_logic_l*2\")\n \n ;; binsl, binsr, vshf, sld\n (define_insn_reservation \"i6400_msa_long_logic2\" 2\n   (and (eq_attr \"cpu\" \"i6400\")\n        (eq_attr \"type\" \"simd_bitins,simd_sld\"))\n-  \"i6400_fpu_long, i6400_fpu_logic_l\")\n+  \"i6400_fpu_long+i6400_fpu_logic_l*2\")\n \n ;; Vector mul, dotp, madd, msub\n (define_insn_reservation \"i6400_msa_mult\" 5\n   (and (eq_attr \"cpu\" \"i6400\")\n        (eq_attr \"type\" \"simd_mul\"))\n-  \"i6400_fpu_long, i6400_fpu_mult\")\n+  \"i6400_fpu_long+i6400_fpu_mult*2\")\n \n ;; Float flog2\n (define_insn_reservation \"i6400_msa_long_float2\" 2\n   (and (eq_attr \"cpu\" \"i6400\")\n        (eq_attr \"type\" \"simd_flog2\"))\n-  \"i6400_fpu_long, i6400_fpu_float_l\")\n+  \"i6400_fpu_long+i6400_fpu_float_l*2\")\n \n ;; fadd, fsub\n (define_insn_reservation \"i6400_msa_long_float4\" 4\n   (and (eq_attr \"cpu\" \"i6400\")\n        (eq_attr \"type\" \"simd_fadd,simd_fcvt\"))\n-  \"i6400_fpu_long, i6400_fpu_float_l\")\n+  \"i6400_fpu_long+i6400_fpu_float_l*2\")\n \n ;; fmul, fexp2\n (define_insn_reservation \"i6400_msa_long_float5\" 5\n   (and (eq_attr \"cpu\" \"i6400\")\n        (eq_attr \"type\" \"simd_fmul,simd_fexp2\"))\n-  \"i6400_fpu_long, i6400_fpu_float_l\")\n+  \"i6400_fpu_long+i6400_fpu_float_l*2\")\n \n ;; fmadd, fmsub\n (define_insn_reservation \"i6400_msa_long_float8\" 8\n   (and (eq_attr \"cpu\" \"i6400\")\n        (eq_attr \"type\" \"simd_fmadd\"))\n-  \"i6400_fpu_long, i6400_fpu_float_l\")\n+  \"i6400_fpu_long+i6400_fpu_float_l*2\")\n \n ;; fdiv.d\n (define_insn_reservation \"i6400_msa_fdiv_df\" 30\n@@ -222,7 +222,7 @@\n ;; fadd, fsub, fcvt\n (define_insn_reservation \"i6400_fpu_fadd\" 4\n   (and (eq_attr \"cpu\" \"i6400\")\n-       (eq_attr \"type\" \"fadd, fcvt\"))\n+       (eq_attr \"type\" \"fadd, fcvt, frint\"))\n   \"i6400_fpu_long, i6400_fpu_apu\")\n \n ;; fmul\n@@ -244,6 +244,36 @@\n        (eq_attr \"type\" \"fdiv,frdiv,fsqrt,frsqrt\"))\n   \"i6400_fpu_long+i6400_fpu_apu*22\")\n \n+;; sdc1, swc1\n+(define_insn_reservation \"i6400_fpu_store\" 1\n+  (and (eq_attr \"cpu\" \"i6400\")\n+       (eq_attr \"type\" \"fpstore\"))\n+  \"i6400_agen_lsu\")\n+\n+;; ldc1, lwc1\n+(define_insn_reservation \"i6400_fpu_load\" 3\n+  (and (eq_attr \"cpu\" \"i6400\")\n+       (eq_attr \"type\" \"fpload\"))\n+  \"i6400_agen_lsu\")\n+\n+;; mfc, mtc\n+(define_insn_reservation \"i6400_fpu_move\" 1\n+  (and (eq_attr \"cpu\" \"i6400\")\n+       (eq_attr \"move_type\" \"mfc, mtc\"))\n+  \"i6400_control_alu0 | i6400_agen_alu1\")\n+\n+;; fcmp\n+(define_insn_reservation \"i6400_fpu_fcmp\" 2\n+  (and (eq_attr \"cpu\" \"i6400\")\n+       (eq_attr \"type\" \"fcmp\"))\n+  \"i6400_fpu_short, i6400_fpu_apu\")\n+\n+;; fmadd\n+(define_insn_reservation \"i6400_fpu_fmadd\" 8\n+  (and (eq_attr \"cpu\" \"i6400\")\n+       (eq_attr \"type\" \"fmadd\"))\n+  \"i6400_fpu_long, i6400_fpu_apu\")\n+\n ;;\n ;; Integer pipe\n ;;\n@@ -272,32 +302,32 @@\n        (eq_attr \"type\" \"nop\"))\n   \"nothing\")\n \n-;; mult, multu, mul\n+;; mul, mulu, muh, muhu\n (define_insn_reservation \"i6400_int_mult\" 4\n   (and (eq_attr \"cpu\" \"i6400\")\n-       (eq_attr \"type\" \"imul3,imul\"))\n-  \"i6400_gpmuldiv\")\n+       (eq_attr \"type\" \"imul3,imul,imul3nc\"))\n+  \"i6400_gpmul\")\n \n ;; divide\n (define_insn_reservation \"i6400_int_div\" 32\n   (and (eq_attr \"cpu\" \"i6400\")\n-       (eq_attr \"type\" \"idiv\"))\n-  \"i6400_gpmuldiv*32\")\n+       (eq_attr \"type\" \"idiv,idiv3\"))\n+  \"i6400_gpdiv*32\")\n \n ;; Load lb, lbu, lh, lhu, lq, lw, lw_i2f, lwxs\n (define_insn_reservation \"i6400_int_load\" 3\n   (and (eq_attr \"cpu\" \"i6400\")\n-       (eq_attr \"move_type\" \"load\"))\n+       (eq_attr \"type\" \"load\"))\n   \"i6400_agen_lsu\")\n \n ;; store\n (define_insn_reservation \"i6400_int_store\" 1\n   (and (eq_attr \"cpu\" \"i6400\")\n-       (eq_attr \"move_type\" \"store\"))\n+       (eq_attr \"type\" \"store\"))\n   \"i6400_agen_lsu\")\n \n ;; prefetch\n-(define_insn_reservation \"i6400_int_prefetch\" 3\n+(define_insn_reservation \"i6400_int_prefetch\" 0\n   (and (eq_attr \"cpu\" \"i6400\")\n        (eq_attr \"type\" \"prefetch\"))\n   \"i6400_agen_lsu\")"}]}