{"sha": "627b6fe2df0c59eb723dae340fa8d746aa7ce703", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6NjI3YjZmZTJkZjBjNTllYjcyM2RhZTM0MGZhOGQ3NDZhYTdjZTcwMw==", "commit": {"author": {"name": "Dale Johannesen", "email": "dalej@apple.com", "date": "2004-08-20T19:07:10Z"}, "committer": {"name": "Dale Johannesen", "email": "dalej@gcc.gnu.org", "date": "2004-08-20T19:07:10Z"}, "message": "rs6000.c (rs6000_rtx_costs): Improve DIV/MOD.\n\n\n2004-08-20  Dale Johannesen  <dalej@apple.com>\n\n        * config/rs6000/rs6000.c (rs6000_rtx_costs): Improve DIV/MOD.\n\nFrom-SVN: r86334", "tree": {"sha": "0920c57a4ea94aaafb2b2c13f4c28274d6ab18ba", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/0920c57a4ea94aaafb2b2c13f4c28274d6ab18ba"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/627b6fe2df0c59eb723dae340fa8d746aa7ce703", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/627b6fe2df0c59eb723dae340fa8d746aa7ce703", "html_url": "https://github.com/Rust-GCC/gccrs/commit/627b6fe2df0c59eb723dae340fa8d746aa7ce703", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/627b6fe2df0c59eb723dae340fa8d746aa7ce703/comments", "author": null, "committer": null, "parents": [{"sha": "b7d9c3aefea68d107ba21cf03aae88153dacf18f", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/b7d9c3aefea68d107ba21cf03aae88153dacf18f", "html_url": "https://github.com/Rust-GCC/gccrs/commit/b7d9c3aefea68d107ba21cf03aae88153dacf18f"}], "stats": {"total": 37, "additions": 27, "deletions": 10}, "files": [{"sha": "5a4c7c50c6baf37084bdefa9a28cf8b9a846ee4b", "filename": "gcc/ChangeLog", "status": "modified", "additions": 4, "deletions": 0, "changes": 4, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/627b6fe2df0c59eb723dae340fa8d746aa7ce703/gcc%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/627b6fe2df0c59eb723dae340fa8d746aa7ce703/gcc%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2FChangeLog?ref=627b6fe2df0c59eb723dae340fa8d746aa7ce703", "patch": "@@ -1,3 +1,7 @@\n+2004-08-20  Dale Johannesen  <dalej@apple.com>\n+\n+        * config/rs6000/rs6000.c (rs6000_rtx_costs): Improve DIV/MOD.\n+\n 2004-08-20  Daniel Jacobowitz  <dan@debian.org>\n \n \t* regrename.c (kill_value_one_regno): Renamed from kill_value_regno."}, {"sha": "3d788442a271e312eb0fab24aba1b2e62ed68a93", "filename": "gcc/config/rs6000/rs6000.c", "status": "modified", "additions": 23, "deletions": 10, "changes": 33, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/627b6fe2df0c59eb723dae340fa8d746aa7ce703/gcc%2Fconfig%2Frs6000%2Frs6000.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/627b6fe2df0c59eb723dae340fa8d746aa7ce703/gcc%2Fconfig%2Frs6000%2Frs6000.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fconfig%2Frs6000%2Frs6000.c?ref=627b6fe2df0c59eb723dae340fa8d746aa7ce703", "patch": "@@ -17064,6 +17064,9 @@ rs6000_rtx_costs (rtx x, int code, int outer_code ATTRIBUTE_UNUSED,\n \t  || ((outer_code == IOR || outer_code == XOR)\n \t      && (CONST_OK_FOR_LETTER_P (INTVAL (x), 'K')\n \t\t  || CONST_OK_FOR_LETTER_P (INTVAL (x), 'L')))\n+\t  || ((outer_code == DIV || outer_code == UDIV\n+\t       || outer_code == MOD || outer_code == UMOD)\n+\t      && exact_log2 (INTVAL (x)) >= 0)\n \t  || (outer_code == AND\n \t      && (CONST_OK_FOR_LETTER_P (INTVAL (x), 'K')\n \t\t  || CONST_OK_FOR_LETTER_P (INTVAL (x), 'L')\n@@ -17232,20 +17235,30 @@ rs6000_rtx_costs (rtx x, int code, int outer_code ATTRIBUTE_UNUSED,\n \t\t\t\t  : rs6000_cost->sdiv;\n \t  return false;\n \t}\n-      if (GET_CODE (XEXP (x, 1)) == CONST_INT\n-\t  && exact_log2 (INTVAL (XEXP (x, 1))) >= 0)\n-\t{\n-\t  *total = COSTS_N_INSNS (2);\n-\t  return false;\n-\t}\n       /* FALLTHRU */\n \n     case UDIV:\n     case UMOD:\n-      if (GET_MODE (XEXP (x, 1)) == DImode)\n-\t*total = rs6000_cost->divdi;\n-      else\n-\t*total = rs6000_cost->divsi;\n+      if (GET_CODE (XEXP (x, 1)) == CONST_INT\n+\t  && exact_log2 (INTVAL (XEXP (x, 1))) >= 0)\n+\t{\n+\t  if (code == DIV || code == MOD)\n+\t    /* Shift, addze */\n+\t    *total = COSTS_N_INSNS (2);\n+\t  else\n+\t    /* Shift */\n+\t    *total = COSTS_N_INSNS (1);\n+\t}\n+      else \n+\t{\n+\t  if (GET_MODE (XEXP (x, 1)) == DImode)\n+\t    *total = rs6000_cost->divdi;\n+\t  else\n+\t    *total = rs6000_cost->divsi;\n+\t}\n+      /* Add in shift and subtract for MOD. */\n+      if (code == MOD || code == UMOD)\n+\t*total += COSTS_N_INSNS (2);\n       return false;\n \n     case FFS:"}]}