{"sha": "d2ad2c8a9cea5cc01db606f39b73b1cbfd0622d6", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6ZDJhZDJjOGE5Y2VhNWNjMDFkYjYwNmYzOWI3M2IxY2JmZDA2MjJkNg==", "commit": {"author": {"name": "Jan Hubicka", "email": "jh@suse.cz", "date": "2005-01-05T20:29:06Z"}, "committer": {"name": "Richard Henderson", "email": "rth@gcc.gnu.org", "date": "2005-01-05T20:29:06Z"}, "message": "re PR target/18910 (unrecognisable insn in regclass on x86/amd64)\n\n        PR target/18910\n        * config/i386/i386.c (ix86_expand_move): Handle tls symbols\n        with an offset.\n\nCo-Authored-By: Richard Henderson <rth@redhat.com>\n\nFrom-SVN: r92968", "tree": {"sha": "0afab63e815744564a65ada194bc5bd5d65e5f3f", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/0afab63e815744564a65ada194bc5bd5d65e5f3f"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/d2ad2c8a9cea5cc01db606f39b73b1cbfd0622d6", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/d2ad2c8a9cea5cc01db606f39b73b1cbfd0622d6", "html_url": "https://github.com/Rust-GCC/gccrs/commit/d2ad2c8a9cea5cc01db606f39b73b1cbfd0622d6", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/d2ad2c8a9cea5cc01db606f39b73b1cbfd0622d6/comments", "author": null, "committer": null, "parents": [{"sha": "2cdb31489836779b7316f60cb49c5eb83de88adb", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/2cdb31489836779b7316f60cb49c5eb83de88adb", "html_url": "https://github.com/Rust-GCC/gccrs/commit/2cdb31489836779b7316f60cb49c5eb83de88adb"}], "stats": {"total": 51, "additions": 45, "deletions": 6}, "files": [{"sha": "7797ffc5f4743eca2ca88fc1a6f6037a9e630bf6", "filename": "gcc/ChangeLog", "status": "modified", "additions": 7, "deletions": 0, "changes": 7, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/d2ad2c8a9cea5cc01db606f39b73b1cbfd0622d6/gcc%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/d2ad2c8a9cea5cc01db606f39b73b1cbfd0622d6/gcc%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2FChangeLog?ref=d2ad2c8a9cea5cc01db606f39b73b1cbfd0622d6", "patch": "@@ -1,3 +1,10 @@\n+2005-01-05  Jan Hubicka  <jh@suse.cz>\n+\t    Richard Henderson  <rth@redhat.com>\n+\n+\tPR target/18910\n+\t* config/i386/i386.c (ix86_expand_move): Handle tls symbols \n+\twith an offset.\n+\n 2005-01-05  Richard Henderson  <rth@redhat.com>\n \n \tPR target/12902"}, {"sha": "ca1f1f7f00d511e9174acd2d70c4a72d5cf95d11", "filename": "gcc/config/i386/i386.c", "status": "modified", "additions": 25, "deletions": 6, "changes": 31, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/d2ad2c8a9cea5cc01db606f39b73b1cbfd0622d6/gcc%2Fconfig%2Fi386%2Fi386.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/d2ad2c8a9cea5cc01db606f39b73b1cbfd0622d6/gcc%2Fconfig%2Fi386%2Fi386.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fconfig%2Fi386%2Fi386.c?ref=d2ad2c8a9cea5cc01db606f39b73b1cbfd0622d6", "patch": "@@ -7472,13 +7472,32 @@ ix86_expand_move (enum machine_mode mode, rtx operands[])\n   op0 = operands[0];\n   op1 = operands[1];\n \n-  model = GET_CODE (op1) == SYMBOL_REF ? SYMBOL_REF_TLS_MODEL (op1) : 0;\n-  if (model)\n+  if (GET_CODE (op1) == SYMBOL_REF)\n     {\n-      op1 = legitimize_tls_address (op1, model, true);\n-      op1 = force_operand (op1, op0);\n-      if (op1 == op0)\n-\treturn;\n+      model = SYMBOL_REF_TLS_MODEL (op1);\n+      if (model)\n+\t{\n+\t  op1 = legitimize_tls_address (op1, model, true);\n+\t  op1 = force_operand (op1, op0);\n+\t  if (op1 == op0)\n+\t    return;\n+\t}\n+    }\n+  else if (GET_CODE (op1) == CONST\n+\t   && GET_CODE (XEXP (op1, 0)) == PLUS\n+\t   && GET_CODE (XEXP (XEXP (op1, 0), 0)) == SYMBOL_REF)\n+    {\n+      model = SYMBOL_REF_TLS_MODEL (XEXP (XEXP (op1, 0), 0));\n+      if (model)\n+\t{\n+\t  rtx addend = XEXP (XEXP (op1, 0), 1);\n+\t  op1 = legitimize_tls_address (XEXP (XEXP (op1, 0), 0), model, true);\n+\t  op1 = force_operand (op1, NULL);\n+\t  op1 = expand_simple_binop (Pmode, PLUS, op1, addend,\n+\t\t\t\t     op0, 1, OPTAB_DIRECT);\n+\t  if (op1 == op0)\n+\t    return;\n+\t}\n     }\n \n   if (flag_pic && mode == Pmode && symbolic_operand (op1, Pmode))"}, {"sha": "dec0eabcb4ce749ebeb4dbb356cc3113bbc800eb", "filename": "gcc/testsuite/gcc.dg/tls/opt-8.c", "status": "added", "additions": 13, "deletions": 0, "changes": 13, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/d2ad2c8a9cea5cc01db606f39b73b1cbfd0622d6/gcc%2Ftestsuite%2Fgcc.dg%2Ftls%2Fopt-8.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/d2ad2c8a9cea5cc01db606f39b73b1cbfd0622d6/gcc%2Ftestsuite%2Fgcc.dg%2Ftls%2Fopt-8.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgcc.dg%2Ftls%2Fopt-8.c?ref=d2ad2c8a9cea5cc01db606f39b73b1cbfd0622d6", "patch": "@@ -0,0 +1,13 @@\n+/* PR 18910 */\n+/* { dg-do compile } */\n+/* { dg-options \"-O2\" } */\n+\n+static __thread void *foo [2];\n+void\n+test1 (void)\n+{\n+  unsigned int s;\n+\n+  for (s = 0; s < 2; ++s)\n+    foo [s] = &foo[s];\n+}"}]}