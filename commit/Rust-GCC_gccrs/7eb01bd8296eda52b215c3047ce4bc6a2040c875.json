{"sha": "7eb01bd8296eda52b215c3047ce4bc6a2040c875", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6N2ViMDFiZDgyOTZlZGE1MmIyMTVjMzA0N2NlNGJjNmEyMDQwYzg3NQ==", "commit": {"author": {"name": "Joseph Myers", "email": "jsm@polyomino.org.uk", "date": "2004-07-23T19:22:13Z"}, "committer": {"name": "Joseph Myers", "email": "jsm28@gcc.gnu.org", "date": "2004-07-23T19:22:13Z"}, "message": "c-decl.c (start_function): Form composite type of function types rather than copying type from previous...\n\n\t* c-decl.c (start_function): Form composite type of function types\n\trather than copying type from previous prototype declaration.\n\ntestsuite:\n\t* gcc.dg/comp-return-1.c: New test\n\nFrom-SVN: r85093", "tree": {"sha": "679296ae674e05a9bc0acd3399eb16f236fe81f9", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/679296ae674e05a9bc0acd3399eb16f236fe81f9"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/7eb01bd8296eda52b215c3047ce4bc6a2040c875", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/7eb01bd8296eda52b215c3047ce4bc6a2040c875", "html_url": "https://github.com/Rust-GCC/gccrs/commit/7eb01bd8296eda52b215c3047ce4bc6a2040c875", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/7eb01bd8296eda52b215c3047ce4bc6a2040c875/comments", "author": {"login": "jsm28", "id": 10537793, "node_id": "MDQ6VXNlcjEwNTM3Nzkz", "avatar_url": "https://avatars.githubusercontent.com/u/10537793?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jsm28", "html_url": "https://github.com/jsm28", "followers_url": "https://api.github.com/users/jsm28/followers", "following_url": "https://api.github.com/users/jsm28/following{/other_user}", "gists_url": "https://api.github.com/users/jsm28/gists{/gist_id}", "starred_url": "https://api.github.com/users/jsm28/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jsm28/subscriptions", "organizations_url": "https://api.github.com/users/jsm28/orgs", "repos_url": "https://api.github.com/users/jsm28/repos", "events_url": "https://api.github.com/users/jsm28/events{/privacy}", "received_events_url": "https://api.github.com/users/jsm28/received_events", "type": "User", "site_admin": false}, "committer": {"login": "jsm28", "id": 10537793, "node_id": "MDQ6VXNlcjEwNTM3Nzkz", "avatar_url": "https://avatars.githubusercontent.com/u/10537793?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jsm28", "html_url": "https://github.com/jsm28", "followers_url": "https://api.github.com/users/jsm28/followers", "following_url": "https://api.github.com/users/jsm28/following{/other_user}", "gists_url": "https://api.github.com/users/jsm28/gists{/gist_id}", "starred_url": "https://api.github.com/users/jsm28/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jsm28/subscriptions", "organizations_url": "https://api.github.com/users/jsm28/orgs", "repos_url": "https://api.github.com/users/jsm28/repos", "events_url": "https://api.github.com/users/jsm28/events{/privacy}", "received_events_url": "https://api.github.com/users/jsm28/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "f67376e4ba0e45670eac3d3f0ace808a576ef2f0", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/f67376e4ba0e45670eac3d3f0ace808a576ef2f0", "html_url": "https://github.com/Rust-GCC/gccrs/commit/f67376e4ba0e45670eac3d3f0ace808a576ef2f0"}], "stats": {"total": 43, "additions": 42, "deletions": 1}, "files": [{"sha": "ce98498f3e99c1a4f735418cbc34a42286bb1d0c", "filename": "gcc/ChangeLog", "status": "modified", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/7eb01bd8296eda52b215c3047ce4bc6a2040c875/gcc%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/7eb01bd8296eda52b215c3047ce4bc6a2040c875/gcc%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2FChangeLog?ref=7eb01bd8296eda52b215c3047ce4bc6a2040c875", "patch": "@@ -1,3 +1,8 @@\n+2004-07-23  Joseph S. Myers  <jsm@polyomino.org.uk>\n+\n+\t* c-decl.c (start_function): Form composite type of function types\n+\trather than copying type from previous prototype declaration.\n+\n 2004-07-23  Janis Johnson  <janis187@us.ibm.com>\n \n \t* config/rs6000/altivec.h (vec_lvewx, vec_lvehx, vec_lvwbx): Remove"}, {"sha": "93469d9885f0ea0f0f4f55b486fe89ce91869c4c", "filename": "gcc/c-decl.c", "status": "modified", "additions": 2, "deletions": 1, "changes": 3, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/7eb01bd8296eda52b215c3047ce4bc6a2040c875/gcc%2Fc-decl.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/7eb01bd8296eda52b215c3047ce4bc6a2040c875/gcc%2Fc-decl.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fc-decl.c?ref=7eb01bd8296eda52b215c3047ce4bc6a2040c875", "patch": "@@ -5712,7 +5712,8 @@ start_function (tree declspecs, tree declarator, tree attributes)\n \t\t    TREE_TYPE (TREE_TYPE (old_decl)))\n       && TYPE_ARG_TYPES (TREE_TYPE (decl1)) == 0)\n     {\n-      TREE_TYPE (decl1) = TREE_TYPE (old_decl);\n+      TREE_TYPE (decl1) = composite_type (TREE_TYPE (old_decl),\n+\t\t\t\t\t  TREE_TYPE (decl1));\n       current_function_prototype_locus = DECL_SOURCE_LOCATION (old_decl);\n     }\n "}, {"sha": "ad8aacf17a9e2ba6afb0fc3f9c9a8a6d5c065a0f", "filename": "gcc/testsuite/ChangeLog", "status": "modified", "additions": 4, "deletions": 0, "changes": 4, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/7eb01bd8296eda52b215c3047ce4bc6a2040c875/gcc%2Ftestsuite%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/7eb01bd8296eda52b215c3047ce4bc6a2040c875/gcc%2Ftestsuite%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2FChangeLog?ref=7eb01bd8296eda52b215c3047ce4bc6a2040c875", "patch": "@@ -1,3 +1,7 @@\n+2004-07-23  Joseph S. Myers  <jsm@polyomino.org.uk>\n+\n+\t* gcc.dg/comp-return-1.c: New test\n+\n 2004-07-23  Janis Johnson  <janis187@us.ibm.com>\n \n \t* gcc.dg/vmx/8-02a.c: Fix typo."}, {"sha": "82c398355d0f472e1c3262e8e4c5ec520c2dd45e", "filename": "gcc/testsuite/gcc.dg/comp-return-1.c", "status": "added", "additions": 31, "deletions": 0, "changes": 31, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/7eb01bd8296eda52b215c3047ce4bc6a2040c875/gcc%2Ftestsuite%2Fgcc.dg%2Fcomp-return-1.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/7eb01bd8296eda52b215c3047ce4bc6a2040c875/gcc%2Ftestsuite%2Fgcc.dg%2Fcomp-return-1.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgcc.dg%2Fcomp-return-1.c?ref=7eb01bd8296eda52b215c3047ce4bc6a2040c875", "patch": "@@ -0,0 +1,31 @@\n+/* When merging a nonprototype definition of a function with a prior\n+   prototype declaration, the composite type of the return types must\n+   be formed rather than just copying the function type.  */\n+/* Origin: Joseph Myers <jsm@polyomino.org.uk> */\n+/* { dg-do compile } */\n+\n+typedef int a[];\n+typedef int a5[5];\n+typedef int a10[10];\n+\n+a *f1 ();\n+a5 *f1 () { return 0; }\n+\n+a *f2 (void);\n+a5 *f2 () { return 0; }\n+\n+a *f3 ();\n+a5 *f3 (void) { return 0; }\n+\n+a *f4 (void);\n+a5 *f4 (void) { return 0; }\n+\n+void\n+g (void)\n+{\n+  a10 *x;\n+  x = f1 (); /* { dg-error \"incompatible\" \"f1\" } */\n+  x = f2 (); /* { dg-error \"incompatible\" \"f2\" } */\n+  x = f3 (); /* { dg-error \"incompatible\" \"f3\" } */\n+  x = f4 (); /* { dg-error \"incompatible\" \"f4\" } */\n+}"}]}