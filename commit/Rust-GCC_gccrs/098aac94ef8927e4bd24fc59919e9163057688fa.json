{"sha": "098aac94ef8927e4bd24fc59919e9163057688fa", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6MDk4YWFjOTRlZjg5MjdlNGJkMjRmYzU5OTE5ZTkxNjMwNTc2ODhmYQ==", "commit": {"author": {"name": "Jonathan Wakely", "email": "jwakely@redhat.com", "date": "2015-05-13T16:42:18Z"}, "committer": {"name": "Jonathan Wakely", "email": "redi@gcc.gnu.org", "date": "2015-05-13T16:42:18Z"}, "message": "shared_ptr_base.h (__shared_count(unique_ptr&&)): Check for nullptr (LWG 2415).\n\n\t* include/bits/shared_ptr_base.h (__shared_count(unique_ptr&&)): Check\n\tfor nullptr (LWG 2415).\n\t* testsuite/20_util/shared_ptr/cons/unique_ptr_deleter.cc: Test\n\tconstruction from empty unique_ptr.\n\t* testsuite/20_util/shared_ptr/cons/43820_neg.cc: Adjust dg-error.\n\t* testsuite/20_util/shared_ptr/cons/void_neg.cc: Likewise.\n\nFrom-SVN: r223170", "tree": {"sha": "cebeabdc23452f12716aa0864ea56906dcc360f7", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/cebeabdc23452f12716aa0864ea56906dcc360f7"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/098aac94ef8927e4bd24fc59919e9163057688fa", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/098aac94ef8927e4bd24fc59919e9163057688fa", "html_url": "https://github.com/Rust-GCC/gccrs/commit/098aac94ef8927e4bd24fc59919e9163057688fa", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/098aac94ef8927e4bd24fc59919e9163057688fa/comments", "author": {"login": "jwakely", "id": 1254480, "node_id": "MDQ6VXNlcjEyNTQ0ODA=", "avatar_url": "https://avatars.githubusercontent.com/u/1254480?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jwakely", "html_url": "https://github.com/jwakely", "followers_url": "https://api.github.com/users/jwakely/followers", "following_url": "https://api.github.com/users/jwakely/following{/other_user}", "gists_url": "https://api.github.com/users/jwakely/gists{/gist_id}", "starred_url": "https://api.github.com/users/jwakely/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jwakely/subscriptions", "organizations_url": "https://api.github.com/users/jwakely/orgs", "repos_url": "https://api.github.com/users/jwakely/repos", "events_url": "https://api.github.com/users/jwakely/events{/privacy}", "received_events_url": "https://api.github.com/users/jwakely/received_events", "type": "User", "site_admin": false}, "committer": {"login": "jwakely", "id": 1254480, "node_id": "MDQ6VXNlcjEyNTQ0ODA=", "avatar_url": "https://avatars.githubusercontent.com/u/1254480?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jwakely", "html_url": "https://github.com/jwakely", "followers_url": "https://api.github.com/users/jwakely/followers", "following_url": "https://api.github.com/users/jwakely/following{/other_user}", "gists_url": "https://api.github.com/users/jwakely/gists{/gist_id}", "starred_url": "https://api.github.com/users/jwakely/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jwakely/subscriptions", "organizations_url": "https://api.github.com/users/jwakely/orgs", "repos_url": "https://api.github.com/users/jwakely/repos", "events_url": "https://api.github.com/users/jwakely/events{/privacy}", "received_events_url": "https://api.github.com/users/jwakely/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "b7dce216c7aabe73aae567e6565f44676246a518", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/b7dce216c7aabe73aae567e6565f44676246a518", "html_url": "https://github.com/Rust-GCC/gccrs/commit/b7dce216c7aabe73aae567e6565f44676246a518"}], "stats": {"total": 32, "additions": 28, "deletions": 4}, "files": [{"sha": "b9a0ad7f8dc726861d53000a9f79c600a0cc1336", "filename": "libstdc++-v3/ChangeLog", "status": "modified", "additions": 7, "deletions": 0, "changes": 7, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/098aac94ef8927e4bd24fc59919e9163057688fa/libstdc%2B%2B-v3%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/098aac94ef8927e4bd24fc59919e9163057688fa/libstdc%2B%2B-v3%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libstdc%2B%2B-v3%2FChangeLog?ref=098aac94ef8927e4bd24fc59919e9163057688fa", "patch": "@@ -1,5 +1,12 @@\n 2015-05-13  Jonathan Wakely  <jwakely@redhat.com>\n \n+\t* include/bits/shared_ptr_base.h (__shared_count(unique_ptr&&)): Check\n+\tfor nullptr (LWG 2415).\n+\t* testsuite/20_util/shared_ptr/cons/unique_ptr_deleter.cc: Test\n+\tconstruction from empty unique_ptr.\n+\t* testsuite/20_util/shared_ptr/cons/43820_neg.cc: Adjust dg-error.\n+\t* testsuite/20_util/shared_ptr/cons/void_neg.cc: Likewise.\n+\n \t* include/bits/stl_raw_storage_iter.h (raw_storage_iterator::base()):\n \tDefine (LWG 2454).\n \t* testsuite/20_util/raw_storage_iterator/base.cc: New."}, {"sha": "081df8781a3702895509bd950685907c32f669e9", "filename": "libstdc++-v3/include/bits/shared_ptr_base.h", "status": "modified", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/098aac94ef8927e4bd24fc59919e9163057688fa/libstdc%2B%2B-v3%2Finclude%2Fbits%2Fshared_ptr_base.h", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/098aac94ef8927e4bd24fc59919e9163057688fa/libstdc%2B%2B-v3%2Finclude%2Fbits%2Fshared_ptr_base.h", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libstdc%2B%2B-v3%2Finclude%2Fbits%2Fshared_ptr_base.h?ref=098aac94ef8927e4bd24fc59919e9163057688fa", "patch": "@@ -632,6 +632,11 @@ _GLIBCXX_BEGIN_NAMESPACE_VERSION\n         explicit\n \t__shared_count(std::unique_ptr<_Tp, _Del>&& __r) : _M_pi(0)\n \t{\n+\t  // _GLIBCXX_RESOLVE_LIB_DEFECTS\n+\t  // 2415. Inconsistency between unique_ptr and shared_ptr\n+\t  if (__r.get() == nullptr)\n+\t    return;\n+\n \t  using _Ptr = typename unique_ptr<_Tp, _Del>::pointer;\n \t  using _Del2 = typename conditional<is_reference<_Del>::value,\n \t      reference_wrapper<typename remove_reference<_Del>::type>,"}, {"sha": "62555225432e4ac6202511dd413e94057c3982c7", "filename": "libstdc++-v3/testsuite/20_util/shared_ptr/cons/43820_neg.cc", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/098aac94ef8927e4bd24fc59919e9163057688fa/libstdc%2B%2B-v3%2Ftestsuite%2F20_util%2Fshared_ptr%2Fcons%2F43820_neg.cc", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/098aac94ef8927e4bd24fc59919e9163057688fa/libstdc%2B%2B-v3%2Ftestsuite%2F20_util%2Fshared_ptr%2Fcons%2F43820_neg.cc", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libstdc%2B%2B-v3%2Ftestsuite%2F20_util%2Fshared_ptr%2Fcons%2F43820_neg.cc?ref=098aac94ef8927e4bd24fc59919e9163057688fa", "patch": "@@ -32,7 +32,7 @@ void test01()\n {\n   X* px = 0;\n   std::shared_ptr<X> p1(px);   // { dg-error \"here\" }\n-  // { dg-error \"incomplete\" \"\" { target *-*-* } 886 }\n+  // { dg-error \"incomplete\" \"\" { target *-*-* } 891 }\n \n   std::shared_ptr<X> p9(ap());  // { dg-error \"here\" }\n   // { dg-error \"incomplete\" \"\" { target *-*-* } 307 }"}, {"sha": "e0109777eddb6f8b235613204d006dad0856577c", "filename": "libstdc++-v3/testsuite/20_util/shared_ptr/cons/unique_ptr_deleter.cc", "status": "modified", "additions": 14, "deletions": 2, "changes": 16, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/098aac94ef8927e4bd24fc59919e9163057688fa/libstdc%2B%2B-v3%2Ftestsuite%2F20_util%2Fshared_ptr%2Fcons%2Funique_ptr_deleter.cc", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/098aac94ef8927e4bd24fc59919e9163057688fa/libstdc%2B%2B-v3%2Ftestsuite%2F20_util%2Fshared_ptr%2Fcons%2Funique_ptr_deleter.cc", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libstdc%2B%2B-v3%2Ftestsuite%2F20_util%2Fshared_ptr%2Fcons%2Funique_ptr_deleter.cc?ref=098aac94ef8927e4bd24fc59919e9163057688fa", "patch": "@@ -34,7 +34,7 @@ int D::count = 0;\n // 20.7.12.2.1 shared_ptr constructors [util.smartptr.shared.const]\n \n // Construction from unique_ptr\n-int\n+void\n test01()\n {\n   bool test __attribute__((unused)) = true;\n@@ -47,13 +47,25 @@ test01()\n       VERIFY( sp.use_count() == 1 );\n   }\n   VERIFY( D::count == 1 );\n+}\n \n-  return 0;\n+void\n+test02()\n+{\n+  bool test __attribute__((unused)) = true;\n+\n+  D::count = 0;\n+  std::unique_ptr<A, D> up;\n+  {\n+    std::shared_ptr<A> sp = std::move(up);\n+  }\n+  VERIFY( D::count == 0 ); // LWG 2415\n }\n \n int\n main()\n {\n   test01();\n+  test02();\n   return 0;\n }"}, {"sha": "3f6c4ae97fc18cdbb068afa2f48b023fe9fa1620", "filename": "libstdc++-v3/testsuite/20_util/shared_ptr/cons/void_neg.cc", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/098aac94ef8927e4bd24fc59919e9163057688fa/libstdc%2B%2B-v3%2Ftestsuite%2F20_util%2Fshared_ptr%2Fcons%2Fvoid_neg.cc", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/098aac94ef8927e4bd24fc59919e9163057688fa/libstdc%2B%2B-v3%2Ftestsuite%2F20_util%2Fshared_ptr%2Fcons%2Fvoid_neg.cc", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libstdc%2B%2B-v3%2Ftestsuite%2F20_util%2Fshared_ptr%2Fcons%2Fvoid_neg.cc?ref=098aac94ef8927e4bd24fc59919e9163057688fa", "patch": "@@ -25,5 +25,5 @@\n void test01()\n {\n   std::shared_ptr<void> p((void*)nullptr);   // { dg-error \"here\" }\n-  // { dg-error \"incomplete\" \"\" { target *-*-* } 885 }\n+  // { dg-error \"incomplete\" \"\" { target *-*-* } 890 }\n }"}]}