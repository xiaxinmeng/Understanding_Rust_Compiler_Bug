{"sha": "dae8b9e2bbb6017bf90d68c7b720c500125c8295", "node_id": "C_kwDOANBUbNoAKGRhZThiOWUyYmJiNjAxN2JmOTBkNjhjN2I3MjBjNTAwMTI1YzgyOTU", "commit": {"author": {"name": "Aldy Hernandez", "email": "aldyh@redhat.com", "date": "2022-09-03T13:41:06Z"}, "committer": {"name": "Aldy Hernandez", "email": "aldyh@redhat.com", "date": "2022-09-03T15:37:29Z"}, "message": "[PR/middle-end 106819] NANs can never be a singleton\n\nPossible NANs can never be a singleton, so they will never be\npropagated.  This was the intent, and then the signed zero code crept\nin, and was mistakenly checked before the NAN.\n\n\tPR/middle-end 106819\n\ngcc/ChangeLog:\n\n\t* value-range.cc (frange::singleton_p): Move NAN check to the top.\n\ngcc/testsuite/ChangeLog:\n\n\t* gcc.dg/tree-ssa/pr106819.c: New test.", "tree": {"sha": "7f82ff761e84280258ffc14750b36f84cba718f0", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/7f82ff761e84280258ffc14750b36f84cba718f0"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/dae8b9e2bbb6017bf90d68c7b720c500125c8295", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/dae8b9e2bbb6017bf90d68c7b720c500125c8295", "html_url": "https://github.com/Rust-GCC/gccrs/commit/dae8b9e2bbb6017bf90d68c7b720c500125c8295", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/dae8b9e2bbb6017bf90d68c7b720c500125c8295/comments", "author": {"login": "aldyh", "id": 12937877, "node_id": "MDQ6VXNlcjEyOTM3ODc3", "avatar_url": "https://avatars.githubusercontent.com/u/12937877?v=4", "gravatar_id": "", "url": "https://api.github.com/users/aldyh", "html_url": "https://github.com/aldyh", "followers_url": "https://api.github.com/users/aldyh/followers", "following_url": "https://api.github.com/users/aldyh/following{/other_user}", "gists_url": "https://api.github.com/users/aldyh/gists{/gist_id}", "starred_url": "https://api.github.com/users/aldyh/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/aldyh/subscriptions", "organizations_url": "https://api.github.com/users/aldyh/orgs", "repos_url": "https://api.github.com/users/aldyh/repos", "events_url": "https://api.github.com/users/aldyh/events{/privacy}", "received_events_url": "https://api.github.com/users/aldyh/received_events", "type": "User", "site_admin": false}, "committer": {"login": "aldyh", "id": 12937877, "node_id": "MDQ6VXNlcjEyOTM3ODc3", "avatar_url": "https://avatars.githubusercontent.com/u/12937877?v=4", "gravatar_id": "", "url": "https://api.github.com/users/aldyh", "html_url": "https://github.com/aldyh", "followers_url": "https://api.github.com/users/aldyh/followers", "following_url": "https://api.github.com/users/aldyh/following{/other_user}", "gists_url": "https://api.github.com/users/aldyh/gists{/gist_id}", "starred_url": "https://api.github.com/users/aldyh/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/aldyh/subscriptions", "organizations_url": "https://api.github.com/users/aldyh/orgs", "repos_url": "https://api.github.com/users/aldyh/repos", "events_url": "https://api.github.com/users/aldyh/events{/privacy}", "received_events_url": "https://api.github.com/users/aldyh/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "08de065293f8b08158e1089fbacce9dbaba95077", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/08de065293f8b08158e1089fbacce9dbaba95077", "html_url": "https://github.com/Rust-GCC/gccrs/commit/08de065293f8b08158e1089fbacce9dbaba95077"}], "stats": {"total": 33, "additions": 28, "deletions": 5}, "files": [{"sha": "1272d4b5805ed6eefdf1193e8d0e5c90f6ed297d", "filename": "gcc/testsuite/gcc.dg/tree-ssa/pr106819.c", "status": "added", "additions": 24, "deletions": 0, "changes": 24, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/dae8b9e2bbb6017bf90d68c7b720c500125c8295/gcc%2Ftestsuite%2Fgcc.dg%2Ftree-ssa%2Fpr106819.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/dae8b9e2bbb6017bf90d68c7b720c500125c8295/gcc%2Ftestsuite%2Fgcc.dg%2Ftree-ssa%2Fpr106819.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgcc.dg%2Ftree-ssa%2Fpr106819.c?ref=dae8b9e2bbb6017bf90d68c7b720c500125c8295", "patch": "@@ -0,0 +1,24 @@\n+// { dg-do compile }\n+// { dg-options \"-O2 -fdump-tree-evrp-details\" }\n+\n+static int isNaN(double x)\n+{\n+    return x != x;\n+}\n+\n+static double opCmpProper(int lhs, double rhs)\n+{\n+  return lhs < rhs ? -1.0\n+       : lhs > rhs ? 1.0\n+       : lhs == rhs ? 0.0\n+       : __builtin_nan(\"\");\n+}\n+\n+int main()\n+{\n+    if (!isNaN(opCmpProper(41, __builtin_nan(\"\"))))\n+      __builtin_abort();\n+    return 0;\n+}\n+\n+// { dg-final {scan-tree-dump-not \"Folds to: 0.0\" \"evrp\" } }"}, {"sha": "a1c29f7bd0b5a852625da980c0d620ca84ca1ada", "filename": "gcc/value-range.cc", "status": "modified", "additions": 4, "deletions": 5, "changes": 9, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/dae8b9e2bbb6017bf90d68c7b720c500125c8295/gcc%2Fvalue-range.cc", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/dae8b9e2bbb6017bf90d68c7b720c500125c8295/gcc%2Fvalue-range.cc", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fvalue-range.cc?ref=dae8b9e2bbb6017bf90d68c7b720c500125c8295", "patch": "@@ -632,6 +632,10 @@ frange::singleton_p (tree *result) const\n {\n   if (m_kind == VR_RANGE && real_identical (&m_min, &m_max))\n     {\n+      // Return false for any singleton that may be a NAN.\n+      if (HONOR_NANS (m_type) && !get_nan ().no_p ())\n+\treturn false;\n+\n       // Return the appropriate zero if known.\n       if (HONOR_SIGNED_ZEROS (m_type) && zero_p ())\n \t{\n@@ -649,11 +653,6 @@ frange::singleton_p (tree *result) const\n \t    }\n \t  return false;\n \t}\n-\n-      // Return false for any singleton that may be a NAN.\n-      if (HONOR_NANS (m_type) && !get_nan ().no_p ())\n-\treturn false;\n-\n       if (result)\n \t*result = build_real (m_type, m_min);\n       return true;"}]}