{"sha": "916bd5f07f8a76e05c7f08d5a9b8ac5a21be23d5", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6OTE2YmQ1ZjA3ZjhhNzZlMDVjN2YwOGQ1YTliOGFjNWEyMWJlMjNkNQ==", "commit": {"author": {"name": "Daniel Kraft", "email": "d@domob.eu", "date": "2009-10-05T13:15:35Z"}, "committer": {"name": "Daniel Kraft", "email": "domob@gcc.gnu.org", "date": "2009-10-05T13:15:35Z"}, "message": "re PR fortran/41403 (miscompilation of goto/label using code)\n\n2009-10-05  Daniel Kraft  <d@domob.eu>\n\n\tPR fortran/41403\n\t* trans-stmt.c (gfc_trans_goto): Ignore statement list on assigned goto\n\tif it is present.\n\n2009-10-05  Daniel Kraft  <d@domob.eu>\n\n\tPR fortran/41403\n\t* gfortran.dg/goto_6.f: New test.\n\t* gfortran.dg/goto_7.f: New test.\n\nFrom-SVN: r152448", "tree": {"sha": "d26b2189c89134d7ebe326b93c26899943c204b8", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/d26b2189c89134d7ebe326b93c26899943c204b8"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/916bd5f07f8a76e05c7f08d5a9b8ac5a21be23d5", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/916bd5f07f8a76e05c7f08d5a9b8ac5a21be23d5", "html_url": "https://github.com/Rust-GCC/gccrs/commit/916bd5f07f8a76e05c7f08d5a9b8ac5a21be23d5", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/916bd5f07f8a76e05c7f08d5a9b8ac5a21be23d5/comments", "author": {"login": "domob1812", "id": 4943644, "node_id": "MDQ6VXNlcjQ5NDM2NDQ=", "avatar_url": "https://avatars.githubusercontent.com/u/4943644?v=4", "gravatar_id": "", "url": "https://api.github.com/users/domob1812", "html_url": "https://github.com/domob1812", "followers_url": "https://api.github.com/users/domob1812/followers", "following_url": "https://api.github.com/users/domob1812/following{/other_user}", "gists_url": "https://api.github.com/users/domob1812/gists{/gist_id}", "starred_url": "https://api.github.com/users/domob1812/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/domob1812/subscriptions", "organizations_url": "https://api.github.com/users/domob1812/orgs", "repos_url": "https://api.github.com/users/domob1812/repos", "events_url": "https://api.github.com/users/domob1812/events{/privacy}", "received_events_url": "https://api.github.com/users/domob1812/received_events", "type": "User", "site_admin": false}, "committer": null, "parents": [{"sha": "114bbac6ff31e56fe1df19f2aa88947ae1b4ac62", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/114bbac6ff31e56fe1df19f2aa88947ae1b4ac62", "html_url": "https://github.com/Rust-GCC/gccrs/commit/114bbac6ff31e56fe1df19f2aa88947ae1b4ac62"}], "stats": {"total": 84, "additions": 59, "deletions": 25}, "files": [{"sha": "a844ed655d5eb65372be1751d76404f38183a6b6", "filename": "gcc/fortran/ChangeLog", "status": "modified", "additions": 6, "deletions": 0, "changes": 6, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/916bd5f07f8a76e05c7f08d5a9b8ac5a21be23d5/gcc%2Ffortran%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/916bd5f07f8a76e05c7f08d5a9b8ac5a21be23d5/gcc%2Ffortran%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ffortran%2FChangeLog?ref=916bd5f07f8a76e05c7f08d5a9b8ac5a21be23d5", "patch": "@@ -1,3 +1,9 @@\n+2009-10-05  Daniel Kraft  <d@domob.eu>\n+\n+\tPR fortran/41403\n+\t* trans-stmt.c (gfc_trans_goto): Ignore statement list on assigned goto\n+\tif it is present.\n+\n 2009-10-03  Richard Guenther  <rguenther@suse.de>\n \n \t* options.c (gfc_post_options): Handle -flto and -fwhopr."}, {"sha": "05ed23e4c05f0fdb1e45070fb9697504cd80f5ef", "filename": "gcc/fortran/trans-stmt.c", "status": "modified", "additions": 9, "deletions": 25, "changes": 34, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/916bd5f07f8a76e05c7f08d5a9b8ac5a21be23d5/gcc%2Ffortran%2Ftrans-stmt.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/916bd5f07f8a76e05c7f08d5a9b8ac5a21be23d5/gcc%2Ffortran%2Ftrans-stmt.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ffortran%2Ftrans-stmt.c?ref=916bd5f07f8a76e05c7f08d5a9b8ac5a21be23d5", "patch": "@@ -159,31 +159,15 @@ gfc_trans_goto (gfc_code * code)\n \n   assigned_goto = GFC_DECL_ASSIGN_ADDR (se.expr);\n \n-  code = code->block;\n-  if (code == NULL)\n-    {\n-      target = fold_build1 (GOTO_EXPR, void_type_node, assigned_goto);\n-      gfc_add_expr_to_block (&se.pre, target);\n-      return gfc_finish_block (&se.pre);\n-    }\n-\n-  /* Check the label list.  */\n-  do\n-    {\n-      target = gfc_get_label_decl (code->label1);\n-      tmp = gfc_build_addr_expr (pvoid_type_node, target);\n-      tmp = fold_build2 (EQ_EXPR, boolean_type_node, tmp, assigned_goto);\n-      tmp = build3_v (COND_EXPR, tmp,\n-\t\t      fold_build1 (GOTO_EXPR, void_type_node, target),\n-\t\t      build_empty_stmt (input_location));\n-      gfc_add_expr_to_block (&se.pre, tmp);\n-      code = code->block;\n-    }\n-  while (code != NULL);\n-  gfc_trans_runtime_check (true, false, boolean_true_node, &se.pre, &loc,\n-\t\t\t   \"Assigned label is not in the list\");\n-\n-  return gfc_finish_block (&se.pre); \n+  /* We're going to ignore a label list.  It does not really change the\n+     statement's semantics (because it is just a further restriction on\n+     what's legal code); before, we were comparing label addresses here, but\n+     that's a very fragile business and may break with optimization.  So\n+     just ignore it.  */\n+\n+  target = fold_build1 (GOTO_EXPR, void_type_node, assigned_goto);\n+  gfc_add_expr_to_block (&se.pre, target);\n+  return gfc_finish_block (&se.pre);\n }\n \n "}, {"sha": "2631d12c7202c42c0867f77380a6ab79b059846b", "filename": "gcc/testsuite/ChangeLog", "status": "modified", "additions": 6, "deletions": 0, "changes": 6, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/916bd5f07f8a76e05c7f08d5a9b8ac5a21be23d5/gcc%2Ftestsuite%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/916bd5f07f8a76e05c7f08d5a9b8ac5a21be23d5/gcc%2Ftestsuite%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2FChangeLog?ref=916bd5f07f8a76e05c7f08d5a9b8ac5a21be23d5", "patch": "@@ -1,3 +1,9 @@\n+2009-10-05  Daniel Kraft  <d@domob.eu>\n+\n+\tPR fortran/41403\n+\t* gfortran.dg/goto_6.f: New test.\n+\t* gfortran.dg/goto_7.f: New test.\n+\n 2009-10-03  Ben Elliston  <bje@au.ibm.com>\n \t    Bill Maddox  <maddox@google.com>\n \t    Cary Coutant  <ccoutant@google.com>"}, {"sha": "5b054b636bcec412a27ab774fc3ca0225925ac0a", "filename": "gcc/testsuite/gfortran.dg/goto_6.f", "status": "added", "additions": 24, "deletions": 0, "changes": 24, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/916bd5f07f8a76e05c7f08d5a9b8ac5a21be23d5/gcc%2Ftestsuite%2Fgfortran.dg%2Fgoto_6.f", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/916bd5f07f8a76e05c7f08d5a9b8ac5a21be23d5/gcc%2Ftestsuite%2Fgfortran.dg%2Fgoto_6.f", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgfortran.dg%2Fgoto_6.f?ref=916bd5f07f8a76e05c7f08d5a9b8ac5a21be23d5", "patch": "@@ -0,0 +1,24 @@\n+! { dg-do run }\n+! { dg-options \"-w\" }\n+\n+! PR fortran/41403\n+! Assigned-goto with label list used to compare label addresses which\n+! failed with optimization.  Check this works correctly now.\n+! This is the most reduced Fortran code from the PR.\n+\n+      IVFAIL=0\n+      ASSIGN 1263 TO I\n+      GO TO I, (1262,1263,1264)\n+ 1262 ICON01 = 1262\n+      GO TO 1265\n+ 1263 ICON01 = 1263\n+      GO TO 1265\n+ 1264 ICON01 = 1264\n+ 1265 CONTINUE\n+41260 IF ( ICON01 - 1263 )  21260, 11260, 21260\n+11260 IVPASS = IVPASS + 1\n+      GO TO 1271\n+21260 IVFAIL = IVFAIL + 1\n+ 1271 CONTINUE\n+      IF (IVFAIL /= 0) CALL abort ()\n+      END"}, {"sha": "e230b7b6f14e2527e311607bdb5845dab689d089", "filename": "gcc/testsuite/gfortran.dg/goto_7.f", "status": "added", "additions": 14, "deletions": 0, "changes": 14, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/916bd5f07f8a76e05c7f08d5a9b8ac5a21be23d5/gcc%2Ftestsuite%2Fgfortran.dg%2Fgoto_7.f", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/916bd5f07f8a76e05c7f08d5a9b8ac5a21be23d5/gcc%2Ftestsuite%2Fgfortran.dg%2Fgoto_7.f", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgfortran.dg%2Fgoto_7.f?ref=916bd5f07f8a76e05c7f08d5a9b8ac5a21be23d5", "patch": "@@ -0,0 +1,14 @@\n+! { dg-do compile }\n+! { dg-options \"-std=legacy\" }\n+\n+! Check for error message when computed and assigned gotos reference\n+! illegal label numbers.\n+\n+      ASSIGN 1 TO I\n+      GOTO (1, 2, 3, 42), 2 ! { dg-error \"is never defined\" }\n+      GOTO I, (1, 2, 3, 43) ! { dg-error \"is never defined\" }\n+ 1    CONTINUE\n+ 2    CONTINUE\n+ 3    CONTINUE\n+c     No label 42 or 43.\n+      END"}]}