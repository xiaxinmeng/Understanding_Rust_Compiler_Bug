
// replace
let inv_shift_bits = (width_bits - raw_shift_bits) % width_bits;
// with
let inv_shift_bits = (width_bits - shift_bits) % width_bits;
