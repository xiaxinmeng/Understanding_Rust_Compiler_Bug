
# Build a cdylib, `native-staticlib` will not appear on the linker line because it was bundled previously
# The cdylib will contain the `native_func` symbol in the end
LD_LIBRARY_PATH="/tmp/rust/build/x86_64-unknown-linux-gnu/test/run-make/native-link-modifier-bundle/native-link-modifier-bundle:/tmp/rust/build/x86_64-unknown-linux-gnu/stage1/lib:/tmp/rust/build/x86_64-unknown-linux-gnu/stage0-bootstrap-tools/x86_64-unknown-linux-gnu/release/deps:/tmp/rust/build/x86_64-unknown-linux-gnu/stage0/lib" '/tmp/rust/build/x86_64-unknown-linux-gnu/stage1/bin/rustc' --out-dir /tmp/rust/build/x86_64-unknown-linux-gnu/test/run-make/native-link-modifier-bundle/native-link-modifier-bundle -L /tmp/rust/build/x86_64-unknown-linux-gnu/test/run-make/native-link-modifier-bundle/native-link-modifier-bundle  cdylib-bundled.rs --crate-type=cdylib --print link-args | "/tmp/rust/src/etc/cat-and-grep.sh" -ve '-l[" ]*native-staticlib'
[[[ begin stdout ]]]
"cc" "-Wl,--version-script=/tmp/rust/build/x86_64-unknown-linux-gnu/test/run-make/native-link-modifier-bundle/native-link-modifier-bundle/rustcN7l4Es/list" "-m64" "/tmp/rust/build/x86_64-unknown-linux-gnu/test/run-make/native-link-modifier-bundle/native-link-modifier-bundle/rustcN7l4Es/symbols.o" "/tmp/rust/build/x86_64-unknown-linux-gnu/test/run-make/native-link-modifier-bundle/native-link-modifier-bundle/cdylib-bundled.cdylib_bundled.fec11cde-cgu.0.rcgu.o" "/tmp/rust/build/x86_64-unknown-linux-gnu/test/run-make/native-link-modifier-bundle/native-link-modifier-bundle/cdylib-bundled.36zfynnmdkuikfvj.rcgu.o" "-Wl,--as-needed" "-L" "/tmp/rust/build/x86_64-unknown-linux-gnu/test/run-make/native-link-modifier-bundle/native-link-modifier-bundle" "-L" "/tmp/rust/build/x86_64-unknown-linux-gnu/stage1/lib/rustlib/x86_64-unknown-linux-gnu/lib" "-Wl,-Bstatic" "/tmp/rust/build/x86_64-unknown-linux-gnu/test/run-make/native-link-modifier-bundle/native-link-modifier-bundle/libbundled.rlib" "-Wl,--start-group" "/tmp/rust/build/x86_64-unknown-linux-gnu/stage1/lib/rustlib/x86_64-unknown-linux-gnu/lib/libstd-40d3ab217333ea6f.rlib" "/tmp/rust/build/x86_64-unknown-linux-gnu/stage1/lib/rustlib/x86_64-unknown-linux-gnu/lib/libpanic_unwind-342e0c7e58b758c7.rlib" "/tmp/rust/build/x86_64-unknown-linux-gnu/stage1/lib/rustlib/x86_64-unknown-linux-gnu/lib/libobject-fd0cbe7355ea90fe.rlib" "/tmp/rust/build/x86_64-unknown-linux-gnu/stage1/lib/rustlib/x86_64-unknown-linux-gnu/lib/libmemchr-5d909f05bea8a2ec.rlib" "/tmp/rust/build/x86_64-unknown-linux-gnu/stage1/lib/rustlib/x86_64-unknown-linux-gnu/lib/libaddr2line-c1f0f7998b5f4f34.rlib" "/tmp/rust/build/x86_64-unknown-linux-gnu/stage1/lib/rustlib/x86_64-unknown-linux-gnu/lib/libgimli-473b04228aa37014.rlib" "/tmp/rust/build/x86_64-unknown-linux-gnu/stage1/lib/rustlib/x86_64-unknown-linux-gnu/lib/librustc_demangle-7b1987a043416988.rlib" "/tmp/rust/build/x86_64-unknown-linux-gnu/stage1/lib/rustlib/x86_64-unknown-linux-gnu/lib/libstd_detect-fbee7d804fb3998f.rlib" "/tmp/rust/build/x86_64-unknown-linux-gnu/stage1/lib/rustlib/x86_64-unknown-linux-gnu/lib/libhashbrown-38718f5bda60de40.rlib" "/tmp/rust/build/x86_64-unknown-linux-gnu/stage1/lib/rustlib/x86_64-unknown-linux-gnu/lib/libminiz_oxide-88996712221b1d70.rlib" "/tmp/rust/build/x86_64-unknown-linux-gnu/stage1/lib/rustlib/x86_64-unknown-linux-gnu/lib/libadler-92eab706e4a4b72f.rlib" "/tmp/rust/build/x86_64-unknown-linux-gnu/stage1/lib/rustlib/x86_64-unknown-linux-gnu/lib/librustc_std_workspace_alloc-07e0250875d0f6c4.rlib" "/tmp/rust/build/x86_64-unknown-linux-gnu/stage1/lib/rustlib/x86_64-unknown-linux-gnu/lib/libunwind-2f0fbed83b3fc1be.rlib" "/tmp/rust/build/x86_64-unknown-linux-gnu/stage1/lib/rustlib/x86_64-unknown-linux-gnu/lib/libcfg_if-3dff4abc544e5a9d.rlib" "/tmp/rust/build/x86_64-unknown-linux-gnu/stage1/lib/rustlib/x86_64-unknown-linux-gnu/lib/liblibc-fbab093adeb72d7e.rlib" "/tmp/rust/build/x86_64-unknown-linux-gnu/stage1/lib/rustlib/x86_64-unknown-linux-gnu/lib/liballoc-59934a55b0d5ed1e.rlib" "/tmp/rust/build/x86_64-unknown-linux-gnu/stage1/lib/rustlib/x86_64-unknown-linux-gnu/lib/librustc_std_workspace_core-023ef326799aa915.rlib" "/tmp/rust/build/x86_64-unknown-linux-gnu/stage1/lib/rustlib/x86_64-unknown-linux-gnu/lib/libcore-8808ef886908ca43.rlib" "-Wl,--end-group" "/tmp/rust/build/x86_64-unknown-linux-gnu/stage1/lib/rustlib/x86_64-unknown-linux-gnu/lib/libcompiler_builtins-4ca2eb6a42de4f5d.rlib" "-Wl,-Bdynamic" "-lgcc_s" "-lutil" "-lrt" "-lpthread" "-lm" "-ldl" "-lc" "-Wl,--eh-frame-hdr" "-Wl,-znoexecstack" "-L" "/tmp/rust/build/x86_64-unknown-linux-gnu/stage1/lib/rustlib/x86_64-unknown-linux-gnu/lib" "-o" "/tmp/rust/build/x86_64-unknown-linux-gnu/test/run-make/native-link-modifier-bundle/native-link-modifier-bundle/libcdylib_bundled.so" "-Wl,--gc-sections" "-shared" "-Wl,-zrelro,-znow" "-nodefaultlibs"

[[[ end stdout ]]]
nm -g /tmp/rust/build/x86_64-unknown-linux-gnu/test/run-make/native-link-modifier-bundle/native-link-modifier-bundle/libcdylib_bundled.so | "/tmp/rust/src/etc/cat-and-grep.sh" -e "T _*native_func"
[[[ begin stdout ]]]
                 w _ITM_deregisterTMCloneTable
                 w _ITM_registerTMCloneTable
                 w __cxa_finalize@@GLIBC_2.2.5
                 w __gmon_start__
0000000000001100 T wrapped_func

[[[ end stdout ]]]
Error: cannot match: T _*native_func
rm /tmp/rust/build/x86_64-unknown-linux-gnu/test/run-make/native-link-modifier-bundle/native-link-modifier-bundle/libnative-staticlib.o
------------------------------------------
