
# Create a library with a trait with one associated function
echo '
pub struct MyStruct;
' > a.rs

# Create another library that depends on the first library
echo '
pub use a::*;
' > b.rs

toolchain="nightly"

mkdir $toolchain

# Compile the library
rustc +$toolchain --edition=2021 \
        --crate-type rlib -o $toolchain/liba.rlib a.rs

# Generate rustdoc JSON for both libraries
rustdoc +$toolchain --edition=2021 \
        --extern a=$toolchain/liba.rlib \
        -Z unstable-options --output-format json \
        -o $toolchain b.rs

# See if rustdoc JSON for `trait_a_fn` was generated
grep --silent MyStruct $toolchain/b.json && echo "rustdoc JSON for 'MyStruct' was generated by '$toolchain'"
