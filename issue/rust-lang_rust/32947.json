{"url": "https://api.github.com/repos/rust-lang/rust/issues/32947", "repository_url": "https://api.github.com/repos/rust-lang/rust", "labels_url": "https://api.github.com/repos/rust-lang/rust/issues/32947/labels{/name}", "comments_url": "https://api.github.com/repos/rust-lang/rust/issues/32947/comments", "events_url": "https://api.github.com/repos/rust-lang/rust/issues/32947/events", "html_url": "https://github.com/rust-lang/rust/issues/32947", "id": 148306701, "node_id": "MDU6SXNzdWUxNDgzMDY3MDE=", "number": 32947, "title": "Segmentation fault when transmuting simd vector temporary", "user": {"login": "ruuda", "id": 506953, "node_id": "MDQ6VXNlcjUwNjk1Mw==", "avatar_url": "https://avatars.githubusercontent.com/u/506953?v=4", "gravatar_id": "", "url": "https://api.github.com/users/ruuda", "html_url": "https://github.com/ruuda", "followers_url": "https://api.github.com/users/ruuda/followers", "following_url": "https://api.github.com/users/ruuda/following{/other_user}", "gists_url": "https://api.github.com/users/ruuda/gists{/gist_id}", "starred_url": "https://api.github.com/users/ruuda/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/ruuda/subscriptions", "organizations_url": "https://api.github.com/users/ruuda/orgs", "repos_url": "https://api.github.com/users/ruuda/repos", "events_url": "https://api.github.com/users/ruuda/events{/privacy}", "received_events_url": "https://api.github.com/users/ruuda/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 211668019, "node_id": "MDU6TGFiZWwyMTE2NjgwMTk=", "url": "https://api.github.com/repos/rust-lang/rust/labels/T-lang", "name": "T-lang", "color": "bfd4f2", "default": false, "description": "Relevant to the language team, which will review and decide on the PR/issue."}, {"id": 211668100, "node_id": "MDU6TGFiZWwyMTE2NjgxMDA=", "url": "https://api.github.com/repos/rust-lang/rust/labels/T-compiler", "name": "T-compiler", "color": "bfd4f2", "default": false, "description": "Relevant to the compiler team, which will review and decide on the PR/issue."}], "state": "closed", "locked": false, "assignee": {"login": "dotdash", "id": 230962, "node_id": "MDQ6VXNlcjIzMDk2Mg==", "avatar_url": "https://avatars.githubusercontent.com/u/230962?v=4", "gravatar_id": "", "url": "https://api.github.com/users/dotdash", "html_url": "https://github.com/dotdash", "followers_url": "https://api.github.com/users/dotdash/followers", "following_url": "https://api.github.com/users/dotdash/following{/other_user}", "gists_url": "https://api.github.com/users/dotdash/gists{/gist_id}", "starred_url": "https://api.github.com/users/dotdash/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/dotdash/subscriptions", "organizations_url": "https://api.github.com/users/dotdash/orgs", "repos_url": "https://api.github.com/users/dotdash/repos", "events_url": "https://api.github.com/users/dotdash/events{/privacy}", "received_events_url": "https://api.github.com/users/dotdash/received_events", "type": "User", "site_admin": false}, "assignees": [{"login": "dotdash", "id": 230962, "node_id": "MDQ6VXNlcjIzMDk2Mg==", "avatar_url": "https://avatars.githubusercontent.com/u/230962?v=4", "gravatar_id": "", "url": "https://api.github.com/users/dotdash", "html_url": "https://github.com/dotdash", "followers_url": "https://api.github.com/users/dotdash/followers", "following_url": "https://api.github.com/users/dotdash/following{/other_user}", "gists_url": "https://api.github.com/users/dotdash/gists{/gist_id}", "starred_url": "https://api.github.com/users/dotdash/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/dotdash/subscriptions", "organizations_url": "https://api.github.com/users/dotdash/orgs", "repos_url": "https://api.github.com/users/dotdash/repos", "events_url": "https://api.github.com/users/dotdash/events{/privacy}", "received_events_url": "https://api.github.com/users/dotdash/received_events", "type": "User", "site_admin": false}], "milestone": null, "comments": 6, "created_at": "2016-04-14T09:43:55Z", "updated_at": "2017-03-24T19:20:53Z", "closed_at": "2017-01-04T16:31:57Z", "author_association": "CONTRIBUTOR", "active_lock_reason": null, "body": "This is a pretty subtle interaction of several things that produces code which causes a segmentation fault:\n- A struct with `#[repr(simd)]`.\n- A struct with a member.\n- A method on that struct.\n- Transmuting the result of a method call.\n\n``` rust\n#![feature(repr_simd)]\n\n#[repr(simd)] // Without #[repr(simd)], it works fine.\npub struct Mu64(pub u64, pub u64, pub u64, pub u64);\n\npub struct Trouble {\n    state: Mu64, // Without this field, it works fine.\n}\n\nimpl Trouble {\n    pub fn new() -> Trouble {\n        Trouble {\n            state: Mu64(1, 2, 3, 4),\n        }\n    }\n\n    fn next(&self) -> Mu64 {\n        Mu64(1, 2, 3, 4)\n    }\n\n    pub fn invoke_doom(&self) -> [u32; 8] {\n        use std::mem::transmute;\n        // transmute(Mu64(1, 2, 3, 4)) instead of transmute(self.next()) works\n        // fine.\n        unsafe { transmute(self.next()) }\n    }\n}\n\n#[test]\nfn this_causes_sigsegv() {\n    let mut trouble = Trouble::new();\n    println!(\"{}\", trouble.invoke_doom()[0]);\n}\n```\n\nNow `cargo test` crashes with a segmentation fault. (The test program that is, not Cargo.) `cargo test --release` runs fine. It could be that this is working as intended, and this is what I get for using unsafe code, but it certainly surprises me.\n\nWorkaround for now: use `transmute_copy` instead of `transmute`.\n\nVersion: rustc 1.9.0-nightly (a43eb4e77 2016-04-12). It also happened on an older nightly.\n", "closed_by": {"login": "bors", "id": 3372342, "node_id": "MDQ6VXNlcjMzNzIzNDI=", "avatar_url": "https://avatars.githubusercontent.com/u/3372342?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors", "html_url": "https://github.com/bors", "followers_url": "https://api.github.com/users/bors/followers", "following_url": "https://api.github.com/users/bors/following{/other_user}", "gists_url": "https://api.github.com/users/bors/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors/subscriptions", "organizations_url": "https://api.github.com/users/bors/orgs", "repos_url": "https://api.github.com/users/bors/repos", "events_url": "https://api.github.com/users/bors/events{/privacy}", "received_events_url": "https://api.github.com/users/bors/received_events", "type": "User", "site_admin": false}, "reactions": {"url": "https://api.github.com/repos/rust-lang/rust/issues/32947/reactions", "total_count": 1, "+1": 1, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rust-lang/rust/issues/32947/timeline", "performed_via_github_app": null, "state_reason": "completed"}