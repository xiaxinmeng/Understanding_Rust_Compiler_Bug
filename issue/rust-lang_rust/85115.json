{"url": "https://api.github.com/repos/rust-lang/rust/issues/85115", "repository_url": "https://api.github.com/repos/rust-lang/rust", "labels_url": "https://api.github.com/repos/rust-lang/rust/issues/85115/labels{/name}", "comments_url": "https://api.github.com/repos/rust-lang/rust/issues/85115/comments", "events_url": "https://api.github.com/repos/rust-lang/rust/issues/85115/events", "html_url": "https://github.com/rust-lang/rust/issues/85115", "id": 882583194, "node_id": "MDU6SXNzdWU4ODI1ODMxOTQ=", "number": 85115, "title": "Decide on generic-ness of functions like `Iterator::try_find` and `array::try_map`", "user": {"login": "scottmcm", "id": 18526288, "node_id": "MDQ6VXNlcjE4NTI2Mjg4", "avatar_url": "https://avatars.githubusercontent.com/u/18526288?v=4", "gravatar_id": "", "url": "https://api.github.com/users/scottmcm", "html_url": "https://github.com/scottmcm", "followers_url": "https://api.github.com/users/scottmcm/followers", "following_url": "https://api.github.com/users/scottmcm/following{/other_user}", "gists_url": "https://api.github.com/users/scottmcm/gists{/gist_id}", "starred_url": "https://api.github.com/users/scottmcm/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/scottmcm/subscriptions", "organizations_url": "https://api.github.com/users/scottmcm/orgs", "repos_url": "https://api.github.com/users/scottmcm/repos", "events_url": "https://api.github.com/users/scottmcm/events{/privacy}", "received_events_url": "https://api.github.com/users/scottmcm/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 211668062, "node_id": "MDU6TGFiZWwyMTE2NjgwNjI=", "url": "https://api.github.com/repos/rust-lang/rust/labels/T-libs-api", "name": "T-libs-api", "color": "bfd4f2", "default": false, "description": "Relevant to the library API team, which will review and decide on the PR/issue."}], "state": "closed", "locked": false, "assignee": {"login": "scottmcm", "id": 18526288, "node_id": "MDQ6VXNlcjE4NTI2Mjg4", "avatar_url": "https://avatars.githubusercontent.com/u/18526288?v=4", "gravatar_id": "", "url": "https://api.github.com/users/scottmcm", "html_url": "https://github.com/scottmcm", "followers_url": "https://api.github.com/users/scottmcm/followers", "following_url": "https://api.github.com/users/scottmcm/following{/other_user}", "gists_url": "https://api.github.com/users/scottmcm/gists{/gist_id}", "starred_url": "https://api.github.com/users/scottmcm/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/scottmcm/subscriptions", "organizations_url": "https://api.github.com/users/scottmcm/orgs", "repos_url": "https://api.github.com/users/scottmcm/repos", "events_url": "https://api.github.com/users/scottmcm/events{/privacy}", "received_events_url": "https://api.github.com/users/scottmcm/received_events", "type": "User", "site_admin": false}, "assignees": [{"login": "scottmcm", "id": 18526288, "node_id": "MDQ6VXNlcjE4NTI2Mjg4", "avatar_url": "https://avatars.githubusercontent.com/u/18526288?v=4", "gravatar_id": "", "url": "https://api.github.com/users/scottmcm", "html_url": "https://github.com/scottmcm", "followers_url": "https://api.github.com/users/scottmcm/followers", "following_url": "https://api.github.com/users/scottmcm/following{/other_user}", "gists_url": "https://api.github.com/users/scottmcm/gists{/gist_id}", "starred_url": "https://api.github.com/users/scottmcm/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/scottmcm/subscriptions", "organizations_url": "https://api.github.com/users/scottmcm/orgs", "repos_url": "https://api.github.com/users/scottmcm/repos", "events_url": "https://api.github.com/users/scottmcm/events{/privacy}", "received_events_url": "https://api.github.com/users/scottmcm/received_events", "type": "User", "site_admin": false}], "milestone": null, "comments": 1, "created_at": "2021-05-09T17:34:14Z", "updated_at": "2021-12-04T05:08:30Z", "closed_at": "2021-12-03T13:20:11Z", "author_association": "MEMBER", "active_lock_reason": null, "body": "`array::try_map` tracking issue: https://github.com/rust-lang/rust/issues/79711\r\n`Iterator::try_find` tracking issue: https://github.com/rust-lang/rust/issues/63178\r\n\r\n`try_map` only allows the closure to return a `Result`, and has the function also return a `Result`.\r\n`try_find` was added in https://github.com/rust-lang/rust/pull/63177 allowing the closure to return any `Try` (v1), but the function itself always returned a `Result`.\r\n\r\nWith `Try` v2, there's no longer an associated type for the `Error` type, so `try_find` needs a different approach.  https://github.com/rust-lang/rust/pull/84767 changed it to a bit of a hacky version that's probably not what should be stabilized.  And whatever solution is picked should probably be used for `try_map` as well.\r\n\r\nI think there are two main options:\r\n1. Support only `Result`.  This is certainly the easiest option.  It's unclear how important supporting other types would be -- this might depend on the error handling WG's work.  If it ends up having a not-really-`Result` type that's used in some situations, this might be suboptimal.\r\n2. Treat residuals as a \"family\", and offer a trait that can be used to get the correct output type.  There's a sketch of how this could look in https://rust-lang.github.io/rfcs/3058-try-trait-v2.html#possibilities-for-try_find, with a prototype implementation in https://github.com/scottmcm/rust/commit/0b12d0dac78617040b38c35175364ab43fb4998d#diff-c552b2bf18fb3212fe93dd601ce487badf5e50faf9aeed4db7b0f6c22571ef01R2442  This is more complicated and may need an RFC, but is also the most general, with additional benefits elsewhere.\r\n3. Make the return type of the methods generic, so they're picked by the context of the caller.  While this would work, I think the annotation burden would be frustrating -- `.try_find(...)?` wouldn't work, as `?` isn't a strong enough context to force any particular family of types.\r\n", "closed_by": {"login": "bors", "id": 3372342, "node_id": "MDQ6VXNlcjMzNzIzNDI=", "avatar_url": "https://avatars.githubusercontent.com/u/3372342?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors", "html_url": "https://github.com/bors", "followers_url": "https://api.github.com/users/bors/followers", "following_url": "https://api.github.com/users/bors/following{/other_user}", "gists_url": "https://api.github.com/users/bors/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors/subscriptions", "organizations_url": "https://api.github.com/users/bors/orgs", "repos_url": "https://api.github.com/users/bors/repos", "events_url": "https://api.github.com/users/bors/events{/privacy}", "received_events_url": "https://api.github.com/users/bors/received_events", "type": "User", "site_admin": false}, "reactions": {"url": "https://api.github.com/repos/rust-lang/rust/issues/85115/reactions", "total_count": 1, "+1": 1, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rust-lang/rust/issues/85115/timeline", "performed_via_github_app": null, "state_reason": "completed"}