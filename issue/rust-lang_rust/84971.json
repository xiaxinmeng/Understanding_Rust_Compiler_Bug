{"url": "https://api.github.com/repos/rust-lang/rust/issues/84971", "repository_url": "https://api.github.com/repos/rust-lang/rust", "labels_url": "https://api.github.com/repos/rust-lang/rust/issues/84971/labels{/name}", "comments_url": "https://api.github.com/repos/rust-lang/rust/issues/84971/comments", "events_url": "https://api.github.com/repos/rust-lang/rust/issues/84971/events", "html_url": "https://github.com/rust-lang/rust/issues/84971", "id": 877028394, "node_id": "MDU6SXNzdWU4NzcwMjgzOTQ=", "number": 84971, "title": "Unhelpful error message and cycles with `const_evaluatable_checked`", "user": {"login": "WorldSEnder", "id": 6527051, "node_id": "MDQ6VXNlcjY1MjcwNTE=", "avatar_url": "https://avatars.githubusercontent.com/u/6527051?v=4", "gravatar_id": "", "url": "https://api.github.com/users/WorldSEnder", "html_url": "https://github.com/WorldSEnder", "followers_url": "https://api.github.com/users/WorldSEnder/followers", "following_url": "https://api.github.com/users/WorldSEnder/following{/other_user}", "gists_url": "https://api.github.com/users/WorldSEnder/gists{/gist_id}", "starred_url": "https://api.github.com/users/WorldSEnder/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/WorldSEnder/subscriptions", "organizations_url": "https://api.github.com/users/WorldSEnder/orgs", "repos_url": "https://api.github.com/users/WorldSEnder/repos", "events_url": "https://api.github.com/users/WorldSEnder/events{/privacy}", "received_events_url": "https://api.github.com/users/WorldSEnder/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 235791, "node_id": "MDU6TGFiZWwyMzU3OTE=", "url": "https://api.github.com/repos/rust-lang/rust/labels/A-diagnostics", "name": "A-diagnostics", "color": "f7e101", "default": false, "description": "Area: Messages for errors, warnings, and lints"}, {"id": 211668100, "node_id": "MDU6TGFiZWwyMTE2NjgxMDA=", "url": "https://api.github.com/repos/rust-lang/rust/labels/T-compiler", "name": "T-compiler", "color": "bfd4f2", "default": false, "description": "Relevant to the compiler team, which will review and decide on the PR/issue."}, {"id": 1472563007, "node_id": "MDU6TGFiZWwxNDcyNTYzMDA3", "url": "https://api.github.com/repos/rust-lang/rust/labels/requires-nightly", "name": "requires-nightly", "color": "76dcde", "default": false, "description": "This issue requires a nightly compiler in some way."}, {"id": 2341291797, "node_id": "MDU6TGFiZWwyMzQxMjkxNzk3", "url": "https://api.github.com/repos/rust-lang/rust/labels/F-generic_const_exprs", "name": "F-generic_const_exprs", "color": "f9c0cc", "default": false, "description": "`#![feature(generic_const_exprs)]`"}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 3, "created_at": "2021-05-06T03:05:57Z", "updated_at": "2022-06-24T15:09:47Z", "closed_at": "2022-06-24T15:09:46Z", "author_association": "NONE", "active_lock_reason": null, "body": "\r\nGiven the following code: [playground link](https://play.rust-lang.org/?version=nightly&mode=debug&edition=2018&gist=7d1e0970edea37e3b65923ecc8a81a57)\r\n\r\n```rust\r\n#![feature(const_generics, const_evaluatable_checked)]\r\n\r\ntrait FiniteGroup : Sized {\r\n    const group_size: usize;\r\n    const elems: [Self; Self::group_size];\r\n}\r\n\r\nimpl FiniteGroup for () {\r\n    const group_size: usize = 1;\r\n    const elems: [Self; Self::group_size] = [()];\r\n}\r\n```\r\n\r\nCurrently the compiler complains\r\n\r\n```\r\nerror: unconstrained generic constant\r\n --> src/lib.rs:5:5\r\n  |\r\n5 |     const elems: [Self; Self::group_size];\r\n  |     ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\r\n  |\r\n  = help: try adding a `where` bound using this expression: `where [(); Self::group_size]:`\r\n```\r\n\r\nThis is problematic:\r\n- it is not clear where to put the suggested `where` bound. The parser errors when put behind `elems:` or before the final `;`. Maybe I'm missing something obvious?\r\n- the suggested expression is incomplete, and most likely missing a `: Sized`\r\n\r\nPossible related to #80976, #82934 and #82509 but additionally, the bound is required on the trait's *own* associated constant, not in an impl, a struct or construction related to the trait.\r\n\r\nNote: I believe correct code would look like\r\n\r\n```rust\r\ntrait FiniteGroup : Sized where [Self; Self::group_size]: Sized {\r\n    const group_size: usize;\r\n    const elems: [Self; Self::group_size];\r\n}\r\n```\r\nbut this leads to\r\n```\r\ncycle detected when building an abstract representation for FiniteGroup::{constant#0}\r\n\r\nnote: ...which requires processing MIR for `FiniteGroup::{constant#0}`...\r\nnote: ...which requires unsafety-checking `FiniteGroup::{constant#0}`...\r\nnote: ...which requires building MIR for `FiniteGroup::{constant#0}`...\r\nnote: ...which requires type-checking `FiniteGroup::{constant#0}`...\r\nnote: ...which again requires building an abstract representation for FiniteGroup::{constant#0}, completing the cycle\r\n```\r\n", "closed_by": {"login": "lcnr", "id": 29864074, "node_id": "MDQ6VXNlcjI5ODY0MDc0", "avatar_url": "https://avatars.githubusercontent.com/u/29864074?v=4", "gravatar_id": "", "url": "https://api.github.com/users/lcnr", "html_url": "https://github.com/lcnr", "followers_url": "https://api.github.com/users/lcnr/followers", "following_url": "https://api.github.com/users/lcnr/following{/other_user}", "gists_url": "https://api.github.com/users/lcnr/gists{/gist_id}", "starred_url": "https://api.github.com/users/lcnr/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/lcnr/subscriptions", "organizations_url": "https://api.github.com/users/lcnr/orgs", "repos_url": "https://api.github.com/users/lcnr/repos", "events_url": "https://api.github.com/users/lcnr/events{/privacy}", "received_events_url": "https://api.github.com/users/lcnr/received_events", "type": "User", "site_admin": false}, "reactions": {"url": "https://api.github.com/repos/rust-lang/rust/issues/84971/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rust-lang/rust/issues/84971/timeline", "performed_via_github_app": null, "state_reason": "completed"}