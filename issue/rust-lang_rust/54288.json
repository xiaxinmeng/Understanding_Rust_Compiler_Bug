{"url": "https://api.github.com/repos/rust-lang/rust/issues/54288", "repository_url": "https://api.github.com/repos/rust-lang/rust", "labels_url": "https://api.github.com/repos/rust-lang/rust/issues/54288/labels{/name}", "comments_url": "https://api.github.com/repos/rust-lang/rust/issues/54288/comments", "events_url": "https://api.github.com/repos/rust-lang/rust/issues/54288/events", "html_url": "https://github.com/rust-lang/rust/issues/54288", "id": 360801349, "node_id": "MDU6SXNzdWUzNjA4MDEzNDk=", "number": 54288, "title": "unused_must_use lint after `write!` fails to note its origin", "user": {"login": "pnkfelix", "id": 173127, "node_id": "MDQ6VXNlcjE3MzEyNw==", "avatar_url": "https://avatars.githubusercontent.com/u/173127?v=4", "gravatar_id": "", "url": "https://api.github.com/users/pnkfelix", "html_url": "https://github.com/pnkfelix", "followers_url": "https://api.github.com/users/pnkfelix/followers", "following_url": "https://api.github.com/users/pnkfelix/following{/other_user}", "gists_url": "https://api.github.com/users/pnkfelix/gists{/gist_id}", "starred_url": "https://api.github.com/users/pnkfelix/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/pnkfelix/subscriptions", "organizations_url": "https://api.github.com/users/pnkfelix/orgs", "repos_url": "https://api.github.com/users/pnkfelix/repos", "events_url": "https://api.github.com/users/pnkfelix/events{/privacy}", "received_events_url": "https://api.github.com/users/pnkfelix/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 235137, "node_id": "MDU6TGFiZWwyMzUxMzc=", "url": "https://api.github.com/repos/rust-lang/rust/labels/A-lint", "name": "A-lint", "color": "f7e101", "default": false, "description": "Area: Lints (warnings about flaws in source code) such as unused_mut."}, {"id": 211668100, "node_id": "MDU6TGFiZWwyMTE2NjgxMDA=", "url": "https://api.github.com/repos/rust-lang/rust/labels/T-compiler", "name": "T-compiler", "color": "bfd4f2", "default": false, "description": "Relevant to the compiler team, which will review and decide on the PR/issue."}], "state": "open", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 1, "created_at": "2018-09-17T10:12:15Z", "updated_at": "2018-09-19T11:03:36Z", "closed_at": null, "author_association": "MEMBER", "active_lock_reason": null, "body": "Consider the following code ([play](https://play.rust-lang.org/?gist=411e153d8d1bc1a04a7538575aa02d31&version=nightly&mode=debug&edition=2015)):\r\n\r\n```rust\r\n// Uncomment the `cfg` to see expected output noting `#[warn(unused_must_use)]`\r\n// #[cfg(without_write)]\r\npub fn encode_json<T: std::fmt::Display>(val: &T, wr: &mut Vec<u8>) {\r\n    use std::io::Write;\r\n    write!(wr, \"{}\", val);\r\n}\r\n\r\npub fn after_write_macro() {\r\n    Result::Ok::<_, ()>(());\r\n}\r\n\r\nfn main() {\r\n}\r\n```\r\n\r\nIt generates the following warning:\r\n\r\n```\r\nwarning: unused `std::result::Result` which must be used\r\n --> src/main.rs:9:5\r\n  |\r\n9 |     Result::Ok::<_, ()>(());\r\n  |     ^^^^^^^^^^^^^^^^^^^^^^^^\r\n  |\r\n  = note: this `Result` may be an `Err` variant, which should be handled\r\n```\r\n\r\nwhich is *almost*, but not quite, what I expect to see.\r\n\r\nNamely, I expect to see this:\r\n\r\n```\r\nwarning: unused `std::result::Result` which must be used\r\n --> src/main.rs:9:5\r\n  |\r\n9 |     Result::Ok::<_, ()>(());\r\n  |     ^^^^^^^^^^^^^^^^^^^^^^^^\r\n  |\r\n  = note: #[warn(unused_must_use)] on by default\r\n  = note: this `Result` may be an `Err` variant, which should be handled\r\n```\r\n\r\nwhich includes the useful `note: #[warn(unused_must_use)] on by default`\r\n\r\nAs far as I can tell, the choice whether or not to include that note is based on the presence/absence of the earlier `write!` invocation.\r\n\r\n(Hypothesis: perhaps there is an occurrence of an unused must_use within that macros expansion that we are silencing, but even though it is silenced, it is erroneously counted in whatever mechanism we are using to avoid printing out multiple redundant instances of notes like `note: #[warn(unused_must_use)] on by default`?)", "closed_by": null, "reactions": {"url": "https://api.github.com/repos/rust-lang/rust/issues/54288/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rust-lang/rust/issues/54288/timeline", "performed_via_github_app": null, "state_reason": null}