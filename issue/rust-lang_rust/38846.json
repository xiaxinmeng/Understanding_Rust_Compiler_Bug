{"url": "https://api.github.com/repos/rust-lang/rust/issues/38846", "repository_url": "https://api.github.com/repos/rust-lang/rust", "labels_url": "https://api.github.com/repos/rust-lang/rust/issues/38846/labels{/name}", "comments_url": "https://api.github.com/repos/rust-lang/rust/issues/38846/comments", "events_url": "https://api.github.com/repos/rust-lang/rust/issues/38846/events", "html_url": "https://github.com/rust-lang/rust/issues/38846", "id": 198931457, "node_id": "MDU6SXNzdWUxOTg5MzE0NTc=", "number": 38846, "title": "Mut borrow lifetime expanded to the enclosing function", "user": {"login": "Ereski", "id": 92037, "node_id": "MDQ6VXNlcjkyMDM3", "avatar_url": "https://avatars.githubusercontent.com/u/92037?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Ereski", "html_url": "https://github.com/Ereski", "followers_url": "https://api.github.com/users/Ereski/followers", "following_url": "https://api.github.com/users/Ereski/following{/other_user}", "gists_url": "https://api.github.com/users/Ereski/gists{/gist_id}", "starred_url": "https://api.github.com/users/Ereski/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Ereski/subscriptions", "organizations_url": "https://api.github.com/users/Ereski/orgs", "repos_url": "https://api.github.com/users/Ereski/repos", "events_url": "https://api.github.com/users/Ereski/events{/privacy}", "received_events_url": "https://api.github.com/users/Ereski/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 234902, "node_id": "MDU6TGFiZWwyMzQ5MDI=", "url": "https://api.github.com/repos/rust-lang/rust/labels/C-enhancement", "name": "C-enhancement", "color": "f5f1fd", "default": false, "description": "Category: An issue proposing an enhancement or a PR with one."}, {"id": 171502053, "node_id": "MDU6TGFiZWwxNzE1MDIwNTM=", "url": "https://api.github.com/repos/rust-lang/rust/labels/A-borrow-checker", "name": "A-borrow-checker", "color": "f7e101", "default": false, "description": "Area: The borrow checker"}, {"id": 211668100, "node_id": "MDU6TGFiZWwyMTE2NjgxMDA=", "url": "https://api.github.com/repos/rust-lang/rust/labels/T-compiler", "name": "T-compiler", "color": "bfd4f2", "default": false, "description": "Relevant to the compiler team, which will review and decide on the PR/issue."}], "state": "open", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 1, "created_at": "2017-01-05T11:12:08Z", "updated_at": "2020-06-11T18:05:22Z", "closed_at": null, "author_association": "NONE", "active_lock_reason": null, "body": "Both Rust stable (v1.14) and nightly (468227129 2017-01-03), regardless of optimization flags, will expand the lifetime of an `&mut` borrow to the enclosing function in a fairly specific case. Here's a minimal snippet that will trigger the bug:\r\n\r\n```\r\nfn foo<'a>(_: &'a mut [&'a str; 0]) {}\r\n\r\nfn bar(_: &mut [&str; 0]) {}\r\n\r\nfn main() {\r\n    let mut a = [];\r\n    foo(&mut a);\r\n    bar(&mut a);\r\n}\r\n```\r\n\r\nrustc fails with `cannot borrow 'a' as mutable more than once at a time`. This bug still happens if the array is replaced by at least `Vec`s and `HashMap`s. However, it compiles fine if `foo` takes a slice instead of an array, or if either or both inner and outer lifetime constraints are removed from `foo`'s argument.\r\n\r\nI don't know if this is relevant or not, but I compiled my original code with `-Z dump-mir` both before and after the commit that hit this bug, with both stable and nightly, and the dumped mir for the function that does the borrows is the same in all instances.", "closed_by": null, "reactions": {"url": "https://api.github.com/repos/rust-lang/rust/issues/38846/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rust-lang/rust/issues/38846/timeline", "performed_via_github_app": null, "state_reason": null}