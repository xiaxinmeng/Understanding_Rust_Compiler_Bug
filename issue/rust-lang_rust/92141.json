{"url": "https://api.github.com/repos/rust-lang/rust/issues/92141", "repository_url": "https://api.github.com/repos/rust-lang/rust", "labels_url": "https://api.github.com/repos/rust-lang/rust/issues/92141/labels{/name}", "comments_url": "https://api.github.com/repos/rust-lang/rust/issues/92141/comments", "events_url": "https://api.github.com/repos/rust-lang/rust/issues/92141/events", "html_url": "https://github.com/rust-lang/rust/issues/92141", "id": 1085225796, "node_id": "I_kwDOAAsO6M5ArztE", "number": 92141, "title": "rustc `-Clink-dead-code` causes MSVC linker to produce invalid binaries with 'found invalid metadata files for crate' error", "user": {"login": "fadeevab", "id": 5967447, "node_id": "MDQ6VXNlcjU5Njc0NDc=", "avatar_url": "https://avatars.githubusercontent.com/u/5967447?v=4", "gravatar_id": "", "url": "https://api.github.com/users/fadeevab", "html_url": "https://github.com/fadeevab", "followers_url": "https://api.github.com/users/fadeevab/followers", "following_url": "https://api.github.com/users/fadeevab/following{/other_user}", "gists_url": "https://api.github.com/users/fadeevab/gists{/gist_id}", "starred_url": "https://api.github.com/users/fadeevab/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/fadeevab/subscriptions", "organizations_url": "https://api.github.com/users/fadeevab/orgs", "repos_url": "https://api.github.com/users/fadeevab/repos", "events_url": "https://api.github.com/users/fadeevab/events{/privacy}", "received_events_url": "https://api.github.com/users/fadeevab/received_events", "type": "User", "site_admin": false}, "labels": [], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 1, "created_at": "2021-12-20T21:38:13Z", "updated_at": "2022-01-09T22:10:48Z", "closed_at": "2022-01-09T22:10:48Z", "author_association": "NONE", "active_lock_reason": null, "body": "**Error**: `error[E0786]: found invalid metadata files for crate ....`\r\n**MSVC**: Visual Studio 2019, Visual Studio 2022.\r\n**RUSTFLAGS**: `\"-Zprofile -Ccodegen-units=1 -Copt-level=0 -Clink-dead-code -Coverflow-checks=off \r\n-Zpanic_abort_tests -Cpanic=abort\"`\r\n\r\nThe flag `-Clink-dead-code` is used with `-Zprofile` to produce a code coverage using `nightly-msvc` toolchain.\r\n\r\nI get the following error on random crates during `cargo build`:\r\n\r\n```rust\r\nerror[E0786]: found invalid metadata files for crate `serde_derive`\r\n   --> ~\\.cargo\\registry\\src\\github.com-1ecc6299db9ec823\\serde-1.0.118\\src\\lib.rs:286:1\r\n    |\r\n286 | extern crate serde_derive;\r\n    | ^^^^^^^^^^^^^^^^^^^^^^^^^^\r\n    |\r\n    = note: failed to decompress metadata: \\\\?\\<my local dir>\\target\\debug\\deps\\serde_derive-961e5eaa49da36c1.dll   \r\n\r\nerror[E0432]: unresolved import `ser`\r\n  --> ~\\.cargo\\registry\\src\\github.com-1ecc6299db9ec823\\serde-1.0.118\\src\\de\\value.rs:29:5\r\n   |\r\n29 | use ser;\r\n   |     ^^^\r\n\r\nSome errors have detailed explanations: E0432, E0786.\r\nFor more information about an error, try `rustc --explain E0432`.\r\nerror: could not compile `serde` due to 2 previous errors\r\n```\r\n\r\nThe error is not reproduced with the GNU toolchain.\r\n", "closed_by": {"login": "ehuss", "id": 43198, "node_id": "MDQ6VXNlcjQzMTk4", "avatar_url": "https://avatars.githubusercontent.com/u/43198?v=4", "gravatar_id": "", "url": "https://api.github.com/users/ehuss", "html_url": "https://github.com/ehuss", "followers_url": "https://api.github.com/users/ehuss/followers", "following_url": "https://api.github.com/users/ehuss/following{/other_user}", "gists_url": "https://api.github.com/users/ehuss/gists{/gist_id}", "starred_url": "https://api.github.com/users/ehuss/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/ehuss/subscriptions", "organizations_url": "https://api.github.com/users/ehuss/orgs", "repos_url": "https://api.github.com/users/ehuss/repos", "events_url": "https://api.github.com/users/ehuss/events{/privacy}", "received_events_url": "https://api.github.com/users/ehuss/received_events", "type": "User", "site_admin": false}, "reactions": {"url": "https://api.github.com/repos/rust-lang/rust/issues/92141/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rust-lang/rust/issues/92141/timeline", "performed_via_github_app": null, "state_reason": "completed"}