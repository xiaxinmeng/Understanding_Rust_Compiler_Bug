{"url": "https://api.github.com/repos/rust-lang/rust/issues/24984", "repository_url": "https://api.github.com/repos/rust-lang/rust", "labels_url": "https://api.github.com/repos/rust-lang/rust/issues/24984/labels{/name}", "comments_url": "https://api.github.com/repos/rust-lang/rust/issues/24984/comments", "events_url": "https://api.github.com/repos/rust-lang/rust/issues/24984/events", "html_url": "https://github.com/rust-lang/rust/issues/24984", "id": 72193482, "node_id": "MDU6SXNzdWU3MjE5MzQ4Mg==", "number": 24984, "title": "ICE: Trait in an Rc", "user": {"login": "vojtechkral", "id": 424891, "node_id": "MDQ6VXNlcjQyNDg5MQ==", "avatar_url": "https://avatars.githubusercontent.com/u/424891?v=4", "gravatar_id": "", "url": "https://api.github.com/users/vojtechkral", "html_url": "https://github.com/vojtechkral", "followers_url": "https://api.github.com/users/vojtechkral/followers", "following_url": "https://api.github.com/users/vojtechkral/following{/other_user}", "gists_url": "https://api.github.com/users/vojtechkral/gists{/gist_id}", "starred_url": "https://api.github.com/users/vojtechkral/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/vojtechkral/subscriptions", "organizations_url": "https://api.github.com/users/vojtechkral/orgs", "repos_url": "https://api.github.com/users/vojtechkral/repos", "events_url": "https://api.github.com/users/vojtechkral/events{/privacy}", "received_events_url": "https://api.github.com/users/vojtechkral/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 9618520, "node_id": "MDU6TGFiZWw5NjE4NTIw", "url": "https://api.github.com/repos/rust-lang/rust/labels/I-ICE", "name": "I-ICE", "color": "e10c02", "default": false, "description": "Issue: The compiler panicked, giving an Internal Compilation Error (ICE) \u2744\ufe0f"}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 7, "created_at": "2015-04-30T15:23:05Z", "updated_at": "2015-09-16T08:54:07Z", "closed_at": "2015-09-16T08:54:07Z", "author_association": "CONTRIBUTOR", "active_lock_reason": null, "body": "Code:\n\n```\nuse std::rc::Rc;\n\nstruct Foo;\n\ntrait Bar {}\n\nimpl Foo\n{\n    fn new(_: Rc<Bar>) {}\n}\n\nfn main() {}\n```\n\nBacktrace:\n\n```\n$ RUST_BACKTRACE=1 rustc ice.rs\nice.rs:3:1: 3:12 warning: struct is never used: `Foo`, #[warn(dead_code)] on by default\nice.rs:3 struct Foo;\n         ^~~~~~~~~~~\nice.rs:9:2: 9:23 warning: method is never used: `new`, #[warn(dead_code)] on by default\nice.rs:9        fn new(_: Rc<Bar>) {}\n                ^~~~~~~~~~~~~~~~~~~~~\nerror: internal compiler error: unexpected panic\nnote: the compiler unexpectedly panicked. this is a bug.\nnote: we would appreciate a bug report: https://github.com/rust-lang/rust/blob/master/CONTRIBUTING.md#bug-reports\nnote: run with `RUST_BACKTRACE=1` for a backtrace\nthread 'rustc' panicked at 'Unexpected type returned from struct_tail: usize for ty=alloc::rc::RcBox<Bar>', /home/rustbuild/src/rust-buildbot/slave/nightly-dist-rustc-linux/build/src/librustc_trans/trans/type_of.rs:366\n\nstack backtrace:\n   1:     0x7f57e2b50429 - sys::backtrace::write::h0310b8a8758e1499qYr\n   2:     0x7f57e2b58199 - panicking::on_panic::hbad58b50e2163063low\n   3:     0x7f57e2b19e72 - rt::unwind::begin_unwind_inner::h64a2ef53e7d2411bv3v\n   4:     0x7f57e2b1ac37 - rt::unwind::begin_unwind_fmt::h9c5772ad7a47f90bB2v\n   5:     0x7f57e1917dae - trans::type_of::in_memory_type_of::h188c1c7c41bc9d7f7tL\n   6:     0x7f57e19172bb - vec::Vec<T>.FromIterator<T>::from_iter::h14269379071952906095\n   7:     0x7f57e1917ed0 - trans::type_of::in_memory_type_of::h188c1c7c41bc9d7f7tL\n   8:     0x7f57e19172bb - vec::Vec<T>.FromIterator<T>::from_iter::h14269379071952906095\n   9:     0x7f57e1917ed0 - trans::type_of::in_memory_type_of::h188c1c7c41bc9d7f7tL\n  10:     0x7f57e19e4e64 - trans::type_of::type_of_rust_fn::hfb2f3fddb3e82849QhL\n  11:     0x7f57e1924c0e - trans::declare::declare_rust_fn::h9bf6d0da36152a67VLz\n  12:     0x7f57e194a7f7 - trans::base::register_fn::he474a7f56ecf391fSpi\n  13:     0x7f57e194daa8 - trans::base::register_method::h957a1d7bf5a0608eCSi\n  14:     0x7f57e19456a5 - trans::base::get_item_val::hc16030242241a466ACi\n  15:     0x7f57e1942771 - trans::base::trans_item::h3179c4631dcee2ebCei\n  16:     0x7f57e194fd44 - trans::base::trans_crate::hade7d63770de815bp3i\n  17:     0x7f57e309c73a - driver::phase_4_translate_to_llvm::h00417005a319753enOa\n  18:     0x7f57e3074c86 - driver::compile_input::hfaa649c14fe92e11Qba\n  19:     0x7f57e312deb1 - run_compiler::h975f4126834a7e6a65b\n  20:     0x7f57e312b702 - boxed::F.FnBox<A>::call_box::h13703319857629066322\n  21:     0x7f57e312aca9 - rt::unwind::try::try_fn::h2284512932531354838\n  22:     0x7f57e2bcba58 - rust_try_inner\n  23:     0x7f57e2bcba45 - rust_try\n  24:     0x7f57e312af50 - boxed::F.FnBox<A>::call_box::h8871555247671848559\n  25:     0x7f57e2b56f31 - sys::thread::Thread::new::thread_start::h051fcff982868631R9u\n  26:     0x7f57dcc05373 - start_thread\n  27:     0x7f57e27ae27c - clone\n  28:                0x0 - <unknown>\n```\n\nPlatform:\n\n```\n$ rustc --version --verbose\nrustc 1.1.0-nightly (c4b23aec4 2015-04-29) (built 2015-04-29)\nbinary: rustc\ncommit-hash: c4b23aec4c5ddf32df1e0ba3cc23212327cd8b1f\ncommit-date: 2015-04-29\nbuild-date: 2015-04-29\nhost: x86_64-unknown-linux-gnu\nrelease: 1.1.0-nightly\n```\n\nNote that using `Arc` instead of `Rc` generates an ICE too.\nHope this is not a dupe - it's kind of hard to tell which ICE is equivalent...\n", "closed_by": {"login": "vojtechkral", "id": 424891, "node_id": "MDQ6VXNlcjQyNDg5MQ==", "avatar_url": "https://avatars.githubusercontent.com/u/424891?v=4", "gravatar_id": "", "url": "https://api.github.com/users/vojtechkral", "html_url": "https://github.com/vojtechkral", "followers_url": "https://api.github.com/users/vojtechkral/followers", "following_url": "https://api.github.com/users/vojtechkral/following{/other_user}", "gists_url": "https://api.github.com/users/vojtechkral/gists{/gist_id}", "starred_url": "https://api.github.com/users/vojtechkral/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/vojtechkral/subscriptions", "organizations_url": "https://api.github.com/users/vojtechkral/orgs", "repos_url": "https://api.github.com/users/vojtechkral/repos", "events_url": "https://api.github.com/users/vojtechkral/events{/privacy}", "received_events_url": "https://api.github.com/users/vojtechkral/received_events", "type": "User", "site_admin": false}, "reactions": {"url": "https://api.github.com/repos/rust-lang/rust/issues/24984/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rust-lang/rust/issues/24984/timeline", "performed_via_github_app": null, "state_reason": "completed"}