{"url": "https://api.github.com/repos/rust-lang/rust/issues/104390", "repository_url": "https://api.github.com/repos/rust-lang/rust", "labels_url": "https://api.github.com/repos/rust-lang/rust/issues/104390/labels{/name}", "comments_url": "https://api.github.com/repos/rust-lang/rust/issues/104390/comments", "events_url": "https://api.github.com/repos/rust-lang/rust/issues/104390/events", "html_url": "https://github.com/rust-lang/rust/issues/104390", "id": 1447423770, "node_id": "I_kwDOAAsO6M5WRe8a", "number": 104390, "title": "ICE: expected ConstKind::Param here, found Const { ty: f64, kind: Error(ErrorGuaranteed(())) }: not fully fixed", "user": {"login": "Rageking8", "id": 106309953, "node_id": "U_kgDOBlYpQQ", "avatar_url": "https://avatars.githubusercontent.com/u/106309953?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Rageking8", "html_url": "https://github.com/Rageking8", "followers_url": "https://api.github.com/users/Rageking8/followers", "following_url": "https://api.github.com/users/Rageking8/following{/other_user}", "gists_url": "https://api.github.com/users/Rageking8/gists{/gist_id}", "starred_url": "https://api.github.com/users/Rageking8/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Rageking8/subscriptions", "organizations_url": "https://api.github.com/users/Rageking8/orgs", "repos_url": "https://api.github.com/users/Rageking8/repos", "events_url": "https://api.github.com/users/Rageking8/events{/privacy}", "received_events_url": "https://api.github.com/users/Rageking8/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 36996, "node_id": "MDU6TGFiZWwzNjk5Ng==", "url": "https://api.github.com/repos/rust-lang/rust/labels/E-easy", "name": "E-easy", "color": "02e10c", "default": false, "description": "Call for participation: Experience needed to fix: Easy / not much (good first issue)"}, {"id": 9618520, "node_id": "MDU6TGFiZWw5NjE4NTIw", "url": "https://api.github.com/repos/rust-lang/rust/labels/I-ICE", "name": "I-ICE", "color": "e10c02", "default": false, "description": "Issue: The compiler panicked, giving an Internal Compilation Error (ICE) \u2744\ufe0f"}, {"id": 211668100, "node_id": "MDU6TGFiZWwyMTE2NjgxMDA=", "url": "https://api.github.com/repos/rust-lang/rust/labels/T-compiler", "name": "T-compiler", "color": "bfd4f2", "default": false, "description": "Relevant to the compiler team, which will review and decide on the PR/issue."}, {"id": 650731663, "node_id": "MDU6TGFiZWw2NTA3MzE2NjM=", "url": "https://api.github.com/repos/rust-lang/rust/labels/C-bug", "name": "C-bug", "color": "f5f1fd", "default": false, "description": "Category: This is a bug."}], "state": "closed", "locked": false, "assignee": {"login": "chenyukang", "id": 230646, "node_id": "MDQ6VXNlcjIzMDY0Ng==", "avatar_url": "https://avatars.githubusercontent.com/u/230646?v=4", "gravatar_id": "", "url": "https://api.github.com/users/chenyukang", "html_url": "https://github.com/chenyukang", "followers_url": "https://api.github.com/users/chenyukang/followers", "following_url": "https://api.github.com/users/chenyukang/following{/other_user}", "gists_url": "https://api.github.com/users/chenyukang/gists{/gist_id}", "starred_url": "https://api.github.com/users/chenyukang/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/chenyukang/subscriptions", "organizations_url": "https://api.github.com/users/chenyukang/orgs", "repos_url": "https://api.github.com/users/chenyukang/repos", "events_url": "https://api.github.com/users/chenyukang/events{/privacy}", "received_events_url": "https://api.github.com/users/chenyukang/received_events", "type": "User", "site_admin": false}, "assignees": [{"login": "chenyukang", "id": 230646, "node_id": "MDQ6VXNlcjIzMDY0Ng==", "avatar_url": "https://avatars.githubusercontent.com/u/230646?v=4", "gravatar_id": "", "url": "https://api.github.com/users/chenyukang", "html_url": "https://github.com/chenyukang", "followers_url": "https://api.github.com/users/chenyukang/followers", "following_url": "https://api.github.com/users/chenyukang/following{/other_user}", "gists_url": "https://api.github.com/users/chenyukang/gists{/gist_id}", "starred_url": "https://api.github.com/users/chenyukang/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/chenyukang/subscriptions", "organizations_url": "https://api.github.com/users/chenyukang/orgs", "repos_url": "https://api.github.com/users/chenyukang/repos", "events_url": "https://api.github.com/users/chenyukang/events{/privacy}", "received_events_url": "https://api.github.com/users/chenyukang/received_events", "type": "User", "site_admin": false}], "milestone": null, "comments": 4, "created_at": "2022-11-14T05:37:45Z", "updated_at": "2022-11-18T13:12:16Z", "closed_at": "2022-11-18T13:12:16Z", "author_association": "CONTRIBUTOR", "active_lock_reason": null, "body": "<!--\nThank you for finding an Internal Compiler Error! \ud83e\uddca  If possible, try to provide\na minimal verifiable example. You can read \"Rust Bug Minimization Patterns\" for\nhow to create smaller examples.\n\nhttp://blog.pnkfx.org/blog/2019/11/18/rust-bug-minimization-patterns/\n\n-->\n\n### Codes that reproduce the ICE (found using custom DIY fuzzer)\n\n```Rust\nfn f() -> impl Sized { & 2E }\nfn main() {}\n```\n```rust\nfn f() -> impl Sized { && 2E }\nfn main() {}\n```\n```rust\nfn f() -> impl Sized { &'a 2E }\nfn main() {}\n```\n```rust\nfn f() -> impl Sized { &'static 2E }\nfn main() {}\n```\n```rust\nfn f() -> impl Sized { *& 2E }\nfn main() {}\n```\n```rust\nfn f() -> impl Sized { &'_ 2E }\nfn main() {}\n```\n\n### Meta\n<!--\nIf you're using the stable version of the compiler, you should also check if the\nbug also exists in the beta or nightly versions.\n-->\n\n`rustc --version --verbose`:\n```\nrustc 1.67.0-nightly (e631891f7 2022-11-13)\nbinary: rustc\ncommit-hash: e631891f7ad40eac3ef58ec3c2b57ecd81e40615\ncommit-date: 2022-11-13\nhost: x86_64-pc-windows-msvc\nrelease: 1.67.0-nightly\nLLVM version: 15.0.4\n```\n\n### Sample error output\n\n```\nerror: expected at least one digit in exponent\n --> src\\main.rs:1:26\n  |\n1 | fn f() -> impl Sized { & 2E }\n  |                          ^^\n```\n\n<!--\nInclude a backtrace in the code block by setting `RUST_BACKTRACE=1` in your\nenvironment. E.g. `RUST_BACKTRACE=1 cargo build`.\n-->\n<details><summary><strong>Sample Backtrace</strong></summary>\n<p>\n\n```\nerror: internal compiler error: compiler\\rustc_const_eval\\src\\transform\\check_consts\\qualifs.rs:355:32: expected ConstKind::Param here, found Const { ty: f64, kind: Error(ErrorGuaranteed(())) }\n\nthread 'rustc' panicked at 'Box<dyn Any>', /rustc/e631891f7ad40eac3ef58ec3c2b57ecd81e40615\\compiler\\rustc_errors\\src\\lib.rs:1551:9\nstack backtrace:\n   0:     0x7ffcbccc9a72 - <std::sys_common::backtrace::_print::DisplayBacktrace as core::fmt::Display>::fmt::h8461253d72bb7f66\n   1:     0x7ffcbcd05aeb - core::fmt::write::h1f6457170e7bab5f\n   2:     0x7ffcbccbc4da - <std::io::IoSliceMut as core::fmt::Debug>::fmt::h0eb90b1078016b04\n   3:     0x7ffcbccc97bb - std::sys::common::alloc::realloc_fallback::hdd8f739402e5ca67\n   4:     0x7ffcbcccd0e9 - std::panicking::default_hook::h7c974d3bb0475c0c\n   5:     0x7ffcbccccd6a - std::panicking::default_hook::h7c974d3bb0475c0c\n   6:     0x7ffca9172bdb - rustc_driver[8125f59cac749731]::describe_lints\n   7:     0x7ffcbcccda40 - std::panicking::rust_panic_with_hook::h80416c3fb7a5a375\n   8:     0x7ffcab484c03 - <rustc_middle[ba6a056fa51202ca]::ty::rvalue_scopes::RvalueScopes as core[cb643aa3b6b12595]::fmt::Debug>::fmt\n   9:     0x7ffcab482299 - <rustc_middle[ba6a056fa51202ca]::ty::rvalue_scopes::RvalueScopes as core[cb643aa3b6b12595]::fmt::Debug>::fmt\n  10:     0x7ffcab4368d9 - <&rustc_middle[ba6a056fa51202ca]::ty::list::List<rustc_middle[ba6a056fa51202ca]::ty::subst::GenericArg> as rustc_middle[ba6a056fa51202ca]::ty::context::Lift>::lift_to_tcx\n  11:     0x7ffcab4368c9 - <&rustc_middle[ba6a056fa51202ca]::ty::list::List<rustc_middle[ba6a056fa51202ca]::ty::subst::GenericArg> as rustc_middle[ba6a056fa51202ca]::ty::context::Lift>::lift_to_tcx\n  12:     0x7ffcab4355e0 - <&rustc_middle[ba6a056fa51202ca]::ty::list::List<rustc_middle[ba6a056fa51202ca]::ty::subst::GenericArg> as rustc_middle[ba6a056fa51202ca]::ty::context::Lift>::lift_to_tcx\n  13:     0x7ffcab4350d2 - <&rustc_middle[ba6a056fa51202ca]::ty::list::List<rustc_middle[ba6a056fa51202ca]::ty::subst::GenericArg> as rustc_middle[ba6a056fa51202ca]::ty::context::Lift>::lift_to_tcx\n  14:     0x7ffcab42e357 - <&rustc_middle[ba6a056fa51202ca]::ty::list::List<rustc_middle[ba6a056fa51202ca]::ty::Ty> as rustc_middle[ba6a056fa51202ca]::ty::context::Lift>::lift_to_tcx\n  15:     0x7ffcab42e4e8 - rustc_middle[ba6a056fa51202ca]::util::bug::bug_fmt\n  16:     0x7ffcab42e465 - rustc_middle[ba6a056fa51202ca]::util::bug::bug_fmt\n  17:     0x7ffca8a11acf - <rustc_const_eval[6f5abca75124bc59]::transform::check_consts::qualifs::CustomEq as rustc_const_eval[6f5abca75124bc59]::transform::check_consts::qualifs::Qualif>::in_any_value_of_ty\n  18:     0x7ffca89eca27 - rustc_const_eval[6f5abca75124bc59]::const_eval::eval_queries::eval_to_allocation_raw_provider\n  19:     0x7ffca8a0092b - <rustc_const_eval[6f5abca75124bc59]::transform::promote_consts::PromoteTemps as rustc_middle[ba6a056fa51202ca]::mir::MirPass>::run_pass\n  20:     0x7ffca8508b19 - <rustc_mir_transform[1ce5552845ca28f8]::simplify::UsedLocals as rustc_middle[ba6a056fa51202ca]::mir::visit::Visitor>::visit_statement\n  21:     0x7ffca7385672 - <rustc_const_eval[6f5abca75124bc59]::transform::check_consts::resolver::State as core[cb643aa3b6b12595]::clone::Clone>::clone_from\n  22:     0x7ffca73ff32d - <&rustc_index[c071b730a019c59f]::vec::IndexVec<rustc_middle[ba6a056fa51202ca]::mir::Promoted, rustc_middle[ba6a056fa51202ca]::mir::Body> as rustc_serialize[14de8ce5e9575a25]::serialize::Decodable<rustc_query_impl[957941462a4e4b76]::on_disk_cache::CacheDecoder>>::decode\n  23:     0x7ffca8b34860 - <rustc_span[4f1f30e4e7ab5eca]::def_id::DefId as rustc_serialize[14de8ce5e9575a25]::serialize::Encodable<rustc_query_impl[957941462a4e4b76]::on_disk_cache::CacheEncoder>>::encode\n  24:     0x7ffca8a5e030 - <rustc_query_impl[957941462a4e4b76]::Queries as rustc_middle[ba6a056fa51202ca]::ty::query::QueryEngine>::as_any\n  25:     0x7ffca87d1491 - <rustc_mir_build[34df0801c3a8c92]::build::expr::as_place::PlaceBuilder as core[cb643aa3b6b12595]::convert::From<rustc_middle[ba6a056fa51202ca]::mir::Local>>::from\n  26:     0x7ffca87d0e78 - <rustc_mir_build[34df0801c3a8c92]::build::expr::as_place::PlaceBuilder as core[cb643aa3b6b12595]::convert::From<rustc_middle[ba6a056fa51202ca]::mir::Local>>::from\n  27:     0x7ffca7386d18 - <rustc_const_eval[6f5abca75124bc59]::transform::check_consts::resolver::State as core[cb643aa3b6b12595]::clone::Clone>::clone_from\n  28:     0x7ffca7408725 - <&rustc_index[c071b730a019c59f]::vec::IndexVec<rustc_middle[ba6a056fa51202ca]::mir::Promoted, rustc_middle[ba6a056fa51202ca]::mir::Body> as rustc_serialize[14de8ce5e9575a25]::serialize::Decodable<rustc_query_impl[957941462a4e4b76]::on_disk_cache::CacheDecoder>>::decode\n  29:     0x7ffca8b4269c - <rustc_span[4f1f30e4e7ab5eca]::def_id::DefId as rustc_serialize[14de8ce5e9575a25]::serialize::Encodable<rustc_query_impl[957941462a4e4b76]::on_disk_cache::CacheEncoder>>::encode\n  30:     0x7ffca8a5fcb5 - <rustc_query_impl[957941462a4e4b76]::Queries as rustc_middle[ba6a056fa51202ca]::ty::query::QueryEngine>::as_any\n  31:     0x7ffca8445208 - <dyn rustc_hir_analysis[ef55755694313895]::astconv::AstConv>::ty_of_fn\n  32:     0x7ffca8b04c02 - <rustc_span[4f1f30e4e7ab5eca]::def_id::DefId as rustc_serialize[14de8ce5e9575a25]::serialize::Encodable<rustc_query_impl[957941462a4e4b76]::on_disk_cache::CacheEncoder>>::encode\n  33:     0x7ffca8bc2ce0 - <rustc_span[4f1f30e4e7ab5eca]::def_id::DefId as rustc_serialize[14de8ce5e9575a25]::serialize::Encodable<rustc_query_impl[957941462a4e4b76]::on_disk_cache::CacheEncoder>>::encode\n  34:     0x7ffca7109903 - rustc_hir_analysis[ef55755694313895]::check::provide\n  35:     0x7ffca847176a - rustc_hir_analysis[ef55755694313895]::check::check::check_abi\n  36:     0x7ffca7385c18 - <rustc_const_eval[6f5abca75124bc59]::transform::check_consts::resolver::State as core[cb643aa3b6b12595]::clone::Clone>::clone_from\n  37:     0x7ffca740ac85 - <&rustc_index[c071b730a019c59f]::vec::IndexVec<rustc_middle[ba6a056fa51202ca]::mir::Promoted, rustc_middle[ba6a056fa51202ca]::mir::Body> as rustc_serialize[14de8ce5e9575a25]::serialize::Decodable<rustc_query_impl[957941462a4e4b76]::on_disk_cache::CacheDecoder>>::decode\n  38:     0x7ffca8b47658 - <rustc_span[4f1f30e4e7ab5eca]::def_id::DefId as rustc_serialize[14de8ce5e9575a25]::serialize::Encodable<rustc_query_impl[957941462a4e4b76]::on_disk_cache::CacheEncoder>>::encode\n  39:     0x7ffca75498ec - <&rustc_index[c071b730a019c59f]::vec::IndexVec<rustc_middle[ba6a056fa51202ca]::mir::Promoted, rustc_middle[ba6a056fa51202ca]::mir::Body> as rustc_serialize[14de8ce5e9575a25]::serialize::Decodable<rustc_query_impl[957941462a4e4b76]::on_disk_cache::CacheDecoder>>::decode\n  40:     0x7ffca70dfc8c - <<dyn rustc_hir_analysis[ef55755694313895]::astconv::AstConv>::create_substs_for_ast_path::{closure#0}::SubstsForAstPathCtxt as rustc_hir_analysis[ef55755694313895]::astconv::CreateSubstsForGenericArgsCtxt>::inferred_kind\n  41:     0x7ffca70d7618 - rustc_hir_analysis[ef55755694313895]::check_crate\n  42:     0x7ffca69b9105 - rustc_interface[a7155063fa577084]::passes::analysis\n  43:     0x7ffca73885be - <rustc_const_eval[6f5abca75124bc59]::transform::check_consts::resolver::State as core[cb643aa3b6b12595]::clone::Clone>::clone_from\n  44:     0x7ffca7428f19 - <&rustc_index[c071b730a019c59f]::vec::IndexVec<rustc_middle[ba6a056fa51202ca]::mir::Promoted, rustc_middle[ba6a056fa51202ca]::mir::Body> as rustc_serialize[14de8ce5e9575a25]::serialize::Decodable<rustc_query_impl[957941462a4e4b76]::on_disk_cache::CacheDecoder>>::decode\n  45:     0x7ffca750074e - <&rustc_index[c071b730a019c59f]::vec::IndexVec<rustc_middle[ba6a056fa51202ca]::mir::Promoted, rustc_middle[ba6a056fa51202ca]::mir::Body> as rustc_serialize[14de8ce5e9575a25]::serialize::Decodable<rustc_query_impl[957941462a4e4b76]::on_disk_cache::CacheDecoder>>::decode\n  46:     0x7ffca7550336 - <&rustc_index[c071b730a019c59f]::vec::IndexVec<rustc_middle[ba6a056fa51202ca]::mir::Promoted, rustc_middle[ba6a056fa51202ca]::mir::Body> as rustc_serialize[14de8ce5e9575a25]::serialize::Decodable<rustc_query_impl[957941462a4e4b76]::on_disk_cache::CacheDecoder>>::decode\n  47:     0x7ffca696bd54 - <unknown>\n  48:     0x7ffca697bf98 - rustc_driver[8125f59cac749731]::args::arg_expand_all\n  49:     0x7ffca6997c2a - <rustc_middle[ba6a056fa51202ca]::ty::SymbolName as core[cb643aa3b6b12595]::fmt::Debug>::fmt\n  50:     0x7ffca697b3cd - rustc_driver[8125f59cac749731]::args::arg_expand_all\n  51:     0x7ffca696c819 - <unknown>\n  52:     0x7ffca69639b0 - <unknown>\n  53:     0x7ffcbccdfaec - std::sys::windows::thread::Thread::new::hdfa7fc2667a94846\n  54:     0x7ffd9f2554e0 - BaseThreadInitThunk\n  55:     0x7ffda0be485b - RtlUserThreadStart\n\nnote: the compiler unexpectedly panicked. this is a bug.\n\nnote: we would appreciate a bug report: https://github.com/rust-lang/rust/issues/new?labels=C-bug%2C+I-ICE%2C+T-compiler&template=ice.md\n\nnote: rustc 1.67.0-nightly (e631891f7 2022-11-13) running on x86_64-pc-windows-msvc\n\nnote: compiler flags: --crate-type bin -C embed-bitcode=no -C debuginfo=2 -C incremental=[REDACTED]\n\nnote: some of the compiler flags provided by cargo are hidden\n\nquery stack during panic:\n#0 [mir_promoted] processing MIR for `f`\n#1 [mir_borrowck] borrow-checking `f`\n#2 [type_of] computing type of `f::{opaque#0}`\n#3 [check_mod_item_types] checking item types in top-level module\n#4 [analysis] running analysis passes on this crate\nend of query stack\nerror: could not compile `tmpice` due to previous error\n```\n\n</p>\n</details>\n\nThe original code (#104209) is already fixed by #104233, however some other mutations of the original code still ICEs with the same backtrace and error. Thanks.\n<br>\nCC @compiler-errors @jruderman\n\n\n\n<!-- TRIAGEBOT_START -->\n\n<!-- TRIAGEBOT_ASSIGN_START -->\n\n<!-- TRIAGEBOT_ASSIGN_DATA_START$${\"user\":\"chenyukang\"}$$TRIAGEBOT_ASSIGN_DATA_END -->\n\n<!-- TRIAGEBOT_ASSIGN_END -->\n<!-- TRIAGEBOT_END -->", "closed_by": {"login": "bors", "id": 3372342, "node_id": "MDQ6VXNlcjMzNzIzNDI=", "avatar_url": "https://avatars.githubusercontent.com/u/3372342?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors", "html_url": "https://github.com/bors", "followers_url": "https://api.github.com/users/bors/followers", "following_url": "https://api.github.com/users/bors/following{/other_user}", "gists_url": "https://api.github.com/users/bors/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors/subscriptions", "organizations_url": "https://api.github.com/users/bors/orgs", "repos_url": "https://api.github.com/users/bors/repos", "events_url": "https://api.github.com/users/bors/events{/privacy}", "received_events_url": "https://api.github.com/users/bors/received_events", "type": "User", "site_admin": false}, "reactions": {"url": "https://api.github.com/repos/rust-lang/rust/issues/104390/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rust-lang/rust/issues/104390/timeline", "performed_via_github_app": null, "state_reason": "completed"}