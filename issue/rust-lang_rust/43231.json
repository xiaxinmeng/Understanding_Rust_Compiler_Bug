{"url": "https://api.github.com/repos/rust-lang/rust/issues/43231", "repository_url": "https://api.github.com/repos/rust-lang/rust", "labels_url": "https://api.github.com/repos/rust-lang/rust/issues/43231/labels{/name}", "comments_url": "https://api.github.com/repos/rust-lang/rust/issues/43231/comments", "events_url": "https://api.github.com/repos/rust-lang/rust/issues/43231/events", "html_url": "https://github.com/rust-lang/rust/issues/43231", "id": 242901613, "node_id": "MDU6SXNzdWUyNDI5MDE2MTM=", "number": 43231, "title": "\"git commit\" or just waiting a night results in bad stage2: \"`std` compiled by an incompatible version of rustc\"", "user": {"login": "RalfJung", "id": 330628, "node_id": "MDQ6VXNlcjMzMDYyOA==", "avatar_url": "https://avatars.githubusercontent.com/u/330628?v=4", "gravatar_id": "", "url": "https://api.github.com/users/RalfJung", "html_url": "https://github.com/RalfJung", "followers_url": "https://api.github.com/users/RalfJung/followers", "following_url": "https://api.github.com/users/RalfJung/following{/other_user}", "gists_url": "https://api.github.com/users/RalfJung/gists{/gist_id}", "starred_url": "https://api.github.com/users/RalfJung/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/RalfJung/subscriptions", "organizations_url": "https://api.github.com/users/RalfJung/orgs", "repos_url": "https://api.github.com/users/RalfJung/repos", "events_url": "https://api.github.com/users/RalfJung/events{/privacy}", "received_events_url": "https://api.github.com/users/RalfJung/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 325438536, "node_id": "MDU6TGFiZWwzMjU0Mzg1MzY=", "url": "https://api.github.com/repos/rust-lang/rust/labels/T-bootstrap", "name": "T-bootstrap", "color": "bfd4f2", "default": false, "description": "Relevant to the bootstrap subteam: Rust's build system (x.py and src/bootstrap)"}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 4, "created_at": "2017-07-14T05:33:32Z", "updated_at": "2017-07-28T00:13:39Z", "closed_at": "2017-07-28T00:13:39Z", "author_association": "MEMBER", "active_lock_reason": null, "body": "# Steps to reproduce\r\n\r\n* Get a clean full build directory: `./x.py clean && ./x.py build`\r\n* Do some edits `src/librustc_mir`\r\n* Do *either* `git commit -a` *or* wait until it is the next day\r\n* `./x.py build`\r\n\r\n# Expected behavior\r\n\r\nI should get a working compiler both in stage1 and stage2.\r\n\r\n# Actual behavior\r\n\r\nThe stage1 compiler is fine, but using the stage2 compiler results in\r\n```\r\nerror[E0514]: found crate `std` compiled by an incompatible version of rustc\r\n  |\r\n  = help: please recompile that crate using this compiler (rustc 1.20.0-dev (2ea782c9b 2017-07-13))\r\n  = note: crate `std` path #1: /home/r/src/rust/rustc/build/x86_64-unknown-linux-gnu/stage2/lib/rustlib/x86_64-unknown-linux-gnu/lib/libstd_unicode-4a6846d7d8ce6979.rlib compiled by \"rustc 1.20.0-dev (8a60e8605 2017-07-13)\"\r\n  = note: crate `std` path #2: /home/r/src/rust/rustc/build/x86_64-unknown-linux-gnu/stage2/lib/rustlib/x86_64-unknown-linux-gnu/lib/libstd-8bdeae220109d9a1.rlib compiled by \"rustc 1.20.0-dev (8a60e8605 2017-07-13)\"\r\n  = note: crate `std` path #3: /home/r/src/rust/rustc/build/x86_64-unknown-linux-gnu/stage2/lib/rustlib/x86_64-unknown-linux-gnu/lib/libstd-8bdeae220109d9a1.so compiled by \"rustc 1.20.0-dev (8a60e8605 2017-07-13)\"\r\n```\r\n\r\nThe fact that this also happens when waiting until the next day makes this particularly annoying, it means I have to remember to always do a full build of all stages when I did some patching some day.\r\n\r\nAlso, \"git commit\" cannot be entirely avoided when doing compiler development, not everything you do is one huge commit that you can commit and push after testing everything.", "closed_by": {"login": "Mark-Simulacrum", "id": 5047365, "node_id": "MDQ6VXNlcjUwNDczNjU=", "avatar_url": "https://avatars.githubusercontent.com/u/5047365?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Mark-Simulacrum", "html_url": "https://github.com/Mark-Simulacrum", "followers_url": "https://api.github.com/users/Mark-Simulacrum/followers", "following_url": "https://api.github.com/users/Mark-Simulacrum/following{/other_user}", "gists_url": "https://api.github.com/users/Mark-Simulacrum/gists{/gist_id}", "starred_url": "https://api.github.com/users/Mark-Simulacrum/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Mark-Simulacrum/subscriptions", "organizations_url": "https://api.github.com/users/Mark-Simulacrum/orgs", "repos_url": "https://api.github.com/users/Mark-Simulacrum/repos", "events_url": "https://api.github.com/users/Mark-Simulacrum/events{/privacy}", "received_events_url": "https://api.github.com/users/Mark-Simulacrum/received_events", "type": "User", "site_admin": false}, "reactions": {"url": "https://api.github.com/repos/rust-lang/rust/issues/43231/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rust-lang/rust/issues/43231/timeline", "performed_via_github_app": null, "state_reason": "completed"}