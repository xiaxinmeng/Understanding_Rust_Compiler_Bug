{"url": "https://api.github.com/repos/rust-lang/rust/issues/30216", "repository_url": "https://api.github.com/repos/rust-lang/rust", "labels_url": "https://api.github.com/repos/rust-lang/rust/issues/30216/labels{/name}", "comments_url": "https://api.github.com/repos/rust-lang/rust/issues/30216/comments", "events_url": "https://api.github.com/repos/rust-lang/rust/issues/30216/events", "html_url": "https://github.com/rust-lang/rust/issues/30216", "id": 120513076, "node_id": "MDU6SXNzdWUxMjA1MTMwNzY=", "number": 30216, "title": "ICE in librustc/middle/const_eval.rs", "user": {"login": "ia0", "id": 969295, "node_id": "MDQ6VXNlcjk2OTI5NQ==", "avatar_url": "https://avatars.githubusercontent.com/u/969295?v=4", "gravatar_id": "", "url": "https://api.github.com/users/ia0", "html_url": "https://github.com/ia0", "followers_url": "https://api.github.com/users/ia0/followers", "following_url": "https://api.github.com/users/ia0/following{/other_user}", "gists_url": "https://api.github.com/users/ia0/gists{/gist_id}", "starred_url": "https://api.github.com/users/ia0/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/ia0/subscriptions", "organizations_url": "https://api.github.com/users/ia0/orgs", "repos_url": "https://api.github.com/users/ia0/repos", "events_url": "https://api.github.com/users/ia0/events{/privacy}", "received_events_url": "https://api.github.com/users/ia0/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 9618520, "node_id": "MDU6TGFiZWw5NjE4NTIw", "url": "https://api.github.com/repos/rust-lang/rust/labels/I-ICE", "name": "I-ICE", "color": "e10c02", "default": false, "description": "Issue: The compiler panicked, giving an Internal Compilation Error (ICE) \u2744\ufe0f"}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 5, "created_at": "2015-12-05T00:20:42Z", "updated_at": "2015-12-06T21:01:54Z", "closed_at": "2015-12-05T15:32:32Z", "author_association": "CONTRIBUTOR", "active_lock_reason": null, "body": "The compiler unexpectedly panicked.\n\nI was working on a crate when `cargo build` gave an ICE. I tried to reduce the code and command-line.\n\nContent of `ice.rs`:\n\n```\nfn div_ceil(x: usize, m: usize) -> usize { (x + m - 1) / m }\nfn f1(x: &[u8], n: usize, i: usize) {}\nfn f2(x: &[u8], n: usize, i: usize) {}\nfn f3<B: Foo>(x: &B) {}\nfn f4<B: Foo>(x: &B) { unreachable!() }\nfn f5<B: Foo>(_: &B) -> usize { 0 }\npub trait Foo {}\npub fn entry<F: Foo>(x: &F) -> u64 { 0u64 << f5(x) }\nfn main() {}\n```\n\n`rustc --version --verbose`:\n\n```\nrustc 1.6.0-nightly (abfadfeee 2015-12-02)\nbinary: rustc\ncommit-hash: abfadfeee691f832b3b47ebd334ec119b0a8379d\ncommit-date: 2015-12-02\nhost: x86_64-unknown-linux-gnu\nrelease: 1.6.0-nightly\n```\n\n`RUST_BACKTRACE=1 rustc ice.rs`:\n\n```\nice.rs:1:1: 1:61 warning: function is never used: `div_ceil`, #[warn(dead_code)] on by default\nice.rs:1 fn div_ceil(x: usize, m: usize) -> usize { (x + m - 1) / m }\n         ^~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~\nice.rs:2:1: 2:39 warning: function is never used: `f1`, #[warn(dead_code)] on by default\nice.rs:2 fn f1(x: &[u8], n: usize, i: usize) {}\n         ^~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~\nice.rs:2:7: 2:8 warning: unused variable: `x`, #[warn(unused_variables)] on by default\nice.rs:2 fn f1(x: &[u8], n: usize, i: usize) {}\n               ^\nice.rs:2:17: 2:18 warning: unused variable: `n`, #[warn(unused_variables)] on by default\nice.rs:2 fn f1(x: &[u8], n: usize, i: usize) {}\n                         ^\nice.rs:2:27: 2:28 warning: unused variable: `i`, #[warn(unused_variables)] on by default\nice.rs:2 fn f1(x: &[u8], n: usize, i: usize) {}\n                                   ^\nice.rs:3:1: 3:39 warning: function is never used: `f2`, #[warn(dead_code)] on by default\nice.rs:3 fn f2(x: &[u8], n: usize, i: usize) {}\n         ^~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~\nice.rs:3:7: 3:8 warning: unused variable: `x`, #[warn(unused_variables)] on by default\nice.rs:3 fn f2(x: &[u8], n: usize, i: usize) {}\n               ^\nice.rs:3:17: 3:18 warning: unused variable: `n`, #[warn(unused_variables)] on by default\nice.rs:3 fn f2(x: &[u8], n: usize, i: usize) {}\n                         ^\nice.rs:3:27: 3:28 warning: unused variable: `i`, #[warn(unused_variables)] on by default\nice.rs:3 fn f2(x: &[u8], n: usize, i: usize) {}\n                                   ^\nice.rs:4:1: 4:24 warning: function is never used: `f3`, #[warn(dead_code)] on by default\nice.rs:4 fn f3<B: Foo>(x: &B) {}\n         ^~~~~~~~~~~~~~~~~~~~~~~\nice.rs:4:15: 4:16 warning: unused variable: `x`, #[warn(unused_variables)] on by default\nice.rs:4 fn f3<B: Foo>(x: &B) {}\n                       ^\nice.rs:5:1: 5:40 warning: function is never used: `f4`, #[warn(dead_code)] on by default\nice.rs:5 fn f4<B: Foo>(x: &B) { unreachable!() }\n         ^~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~\nice.rs:5:15: 5:16 warning: unused variable: `x`, #[warn(unused_variables)] on by default\nice.rs:5 fn f4<B: Foo>(x: &B) { unreachable!() }\n                       ^\nerror: internal compiler error: unexpected panic\nnote: the compiler unexpectedly panicked. this is a bug.\nnote: we would appreciate a bug report: https://github.com/rust-lang/rust/blob/master/CONTRIBUTING.md#bug-reports\nthread 'rustc' panicked at 'assertion failed: `(left == right)` (left: `3`, right: `1`)', ../src/librustc/middle/const_eval.rs:1110\nstack backtrace:\n   1:     0x7f3279f1b1f0 - sys::backtrace::tracing::imp::write::ha5f3f0d9df3eccc0xXt\n   2:     0x7f3279f21e75 - panicking::log_panic::_<closure>::closure.41172\n   3:     0x7f3279f2190f - panicking::log_panic::hb6d5879621a98ec062x\n   4:     0x7f3279eea7f3 - sys_common::unwind::begin_unwind_inner::h56feb86a7746f2474Ps\n   5:     0x7f3279eeb158 - sys_common::unwind::begin_unwind_fmt::hbd638ea70768c304aPs\n   6:     0x7f327784d3f0 - middle::const_eval::eval_const_expr_partial::h2533bfe6c1962b66I9l\n   7:     0x7f32786485f7 - types::_<impl>::check_expr::hfc38773ffed22370aLb\n   8:     0x7f3277a3aeef - lint::context::_<impl>::visit_expr::h8b9870a4ad638ad0DRp\n   9:     0x7f3277a3b7ab - lint::context::_<impl>::visit_fn::h8832c50f3c478cc15Sp\n  10:     0x7f3277a36c5b - lint::context::_<impl>::visit_item::h4cb67b33f26f536fTOp\n  11:     0x7f3277a3ba8b - lint::context::_<impl>::visit_mod::h08bcb71d52cb2f19EZp\n  12:     0x7f3277a57131 - lint::context::check_crate::h2219a7117ade41ab7Bq\n  13:     0x7f327a42396c - driver::phase_3_run_analysis_passes::_<closure>::closure.25592\n  14:     0x7f327a402e43 - middle::ty::context::_<impl>::create_and_enter::create_and_enter::h11817769863191690492\n  15:     0x7f327a3fe1fb - driver::phase_3_run_analysis_passes::h5750652185230913258\n  16:     0x7f327a3d04a9 - driver::compile_input::hc44b9e449347f9a1jca\n  17:     0x7f327a3c261b - run_compiler::he3da9dd626b2ff2a0wc\n  18:     0x7f327a3bf2d6 - sys_common::unwind::try::try_fn::try_fn::h16654195298631707248\n  19:     0x7f3279f18e88 - __rust_try\n  20:     0x7f3279f1078b - sys_common::unwind::try::inner_try::hb614b0fa85d9fb24CMs\n  21:     0x7f327a3bf630 - boxed::_<impl>::call_box::call_box::h11236117354921040822\n  22:     0x7f3279f20393 - sys::thread::_<impl>::new::thread_start::h73d591f2e83d6559I5w\n  23:     0x7f32731d0181 - start_thread\n  24:     0x7f3279b9e47c - __clone\n  25:                0x0 - <unknown>\n\n```\n", "closed_by": {"login": "Manishearth", "id": 1617736, "node_id": "MDQ6VXNlcjE2MTc3MzY=", "avatar_url": "https://avatars.githubusercontent.com/u/1617736?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Manishearth", "html_url": "https://github.com/Manishearth", "followers_url": "https://api.github.com/users/Manishearth/followers", "following_url": "https://api.github.com/users/Manishearth/following{/other_user}", "gists_url": "https://api.github.com/users/Manishearth/gists{/gist_id}", "starred_url": "https://api.github.com/users/Manishearth/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Manishearth/subscriptions", "organizations_url": "https://api.github.com/users/Manishearth/orgs", "repos_url": "https://api.github.com/users/Manishearth/repos", "events_url": "https://api.github.com/users/Manishearth/events{/privacy}", "received_events_url": "https://api.github.com/users/Manishearth/received_events", "type": "User", "site_admin": false}, "reactions": {"url": "https://api.github.com/repos/rust-lang/rust/issues/30216/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rust-lang/rust/issues/30216/timeline", "performed_via_github_app": null, "state_reason": "completed"}