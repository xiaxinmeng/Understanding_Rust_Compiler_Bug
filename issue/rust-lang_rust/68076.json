{"url": "https://api.github.com/repos/rust-lang/rust/issues/68076", "repository_url": "https://api.github.com/repos/rust-lang/rust", "labels_url": "https://api.github.com/repos/rust-lang/rust/issues/68076/labels{/name}", "comments_url": "https://api.github.com/repos/rust-lang/rust/issues/68076/comments", "events_url": "https://api.github.com/repos/rust-lang/rust/issues/68076/events", "html_url": "https://github.com/rust-lang/rust/issues/68076", "id": 547789836, "node_id": "MDU6SXNzdWU1NDc3ODk4MzY=", "number": 68076, "title": "Support Visual Studio heap profiler in MSVC targets", "user": {"login": "jdm", "id": 27658, "node_id": "MDQ6VXNlcjI3NjU4", "avatar_url": "https://avatars.githubusercontent.com/u/27658?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jdm", "html_url": "https://github.com/jdm", "followers_url": "https://api.github.com/users/jdm/followers", "following_url": "https://api.github.com/users/jdm/following{/other_user}", "gists_url": "https://api.github.com/users/jdm/gists{/gist_id}", "starred_url": "https://api.github.com/users/jdm/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jdm/subscriptions", "organizations_url": "https://api.github.com/users/jdm/orgs", "repos_url": "https://api.github.com/users/jdm/repos", "events_url": "https://api.github.com/users/jdm/events{/privacy}", "received_events_url": "https://api.github.com/users/jdm/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 203130, "node_id": "MDU6TGFiZWwyMDMxMzA=", "url": "https://api.github.com/repos/rust-lang/rust/labels/A-debuginfo", "name": "A-debuginfo", "color": "f7e101", "default": false, "description": "Area: Debugging information in compiled programs (DWARF, PDB, etc.)"}, {"id": 211668100, "node_id": "MDU6TGFiZWwyMTE2NjgxMDA=", "url": "https://api.github.com/repos/rust-lang/rust/labels/T-compiler", "name": "T-compiler", "color": "bfd4f2", "default": false, "description": "Relevant to the compiler team, which will review and decide on the PR/issue."}, {"id": 266005765, "node_id": "MDU6TGFiZWwyNjYwMDU3NjU=", "url": "https://api.github.com/repos/rust-lang/rust/labels/O-windows-msvc", "name": "O-windows-msvc", "color": "6e6ec0", "default": false, "description": "Toolchain: MSVC, Operating system: Windows"}], "state": "open", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 4, "created_at": "2020-01-09T23:59:52Z", "updated_at": "2023-04-05T17:43:49Z", "closed_at": null, "author_association": "CONTRIBUTOR", "active_lock_reason": null, "body": "Cland and MSVC support adding special debug info that can be recognized by the MSVC debugging tools for performing heap profiling. Right now all of the allocations from Rust code are put into an \"Unresolved allocations\" bucket with no stack frames attached to them, which makes them quite useless. Since LLVM 9 the backend supports generating the appropriate codeview information if the frontend creates the right metadata, so it would be great to allow rustc to generate that metadata.\r\n\r\nBased on:\r\n* https://releases.llvm.org/9.0.0/tools/clang/docs/ReleaseNotes.html#windows-support\r\n* https://clang.llvm.org/docs/AttributeReference.html#allocator\r\n* https://bugs.llvm.org/show_bug.cgi?id=38491\r\n* https://reviews.llvm.org/rL368230\r\n\r\nClang frontend work:\r\n* https://github.com/llvm-mirror/clang/blob/e3b053c27cfd74468e946437526d061c7d88bd27/lib/Sema/SemaDeclAttr.cpp#L6395-L6407\r\n* https://github.com/llvm-mirror/clang/blob/8b10d16729147455fc92b35d180968be9792b880/lib/CodeGen/CGCall.cpp#L4402-L4405\r\n* https://github.com/llvm-mirror/clang/blob/05441b0db7bf23d206dfc865b5c5bde17da1dab0/lib/CodeGen/CGExprScalar.cpp#L2029-L2033\r\n* https://github.com/llvm-mirror/clang/blob/14947e8df1c27d3babf2c01b53c0c2bf2bfb9bd1/lib/CodeGen/CGDebugInfo.cpp#L2050-L2062\r\n\r\nWe might be able to tie this into the existing GlobalAllocator support. This work may need to wait until https://github.com/rust-lang/rust/pull/67759 has merged, however.", "closed_by": null, "reactions": {"url": "https://api.github.com/repos/rust-lang/rust/issues/68076/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rust-lang/rust/issues/68076/timeline", "performed_via_github_app": null, "state_reason": null}