{"url": "https://api.github.com/repos/rust-lang/rust/issues/103871", "repository_url": "https://api.github.com/repos/rust-lang/rust", "labels_url": "https://api.github.com/repos/rust-lang/rust/issues/103871/labels{/name}", "comments_url": "https://api.github.com/repos/rust-lang/rust/issues/103871/comments", "events_url": "https://api.github.com/repos/rust-lang/rust/issues/103871/events", "html_url": "https://github.com/rust-lang/rust/issues/103871", "id": 1432547472, "node_id": "I_kwDOAAsO6M5VYvCQ", "number": 103871, "title": "ICE with if let chain and optimization", "user": {"login": "rgreenblatt", "id": 8813096, "node_id": "MDQ6VXNlcjg4MTMwOTY=", "avatar_url": "https://avatars.githubusercontent.com/u/8813096?v=4", "gravatar_id": "", "url": "https://api.github.com/users/rgreenblatt", "html_url": "https://github.com/rgreenblatt", "followers_url": "https://api.github.com/users/rgreenblatt/followers", "following_url": "https://api.github.com/users/rgreenblatt/following{/other_user}", "gists_url": "https://api.github.com/users/rgreenblatt/gists{/gist_id}", "starred_url": "https://api.github.com/users/rgreenblatt/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/rgreenblatt/subscriptions", "organizations_url": "https://api.github.com/users/rgreenblatt/orgs", "repos_url": "https://api.github.com/users/rgreenblatt/repos", "events_url": "https://api.github.com/users/rgreenblatt/events{/privacy}", "received_events_url": "https://api.github.com/users/rgreenblatt/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 9618520, "node_id": "MDU6TGFiZWw5NjE4NTIw", "url": "https://api.github.com/repos/rust-lang/rust/labels/I-ICE", "name": "I-ICE", "color": "e10c02", "default": false, "description": "Issue: The compiler panicked, giving an Internal Compilation Error (ICE) \u2744\ufe0f"}, {"id": 211668100, "node_id": "MDU6TGFiZWwyMTE2NjgxMDA=", "url": "https://api.github.com/repos/rust-lang/rust/labels/T-compiler", "name": "T-compiler", "color": "bfd4f2", "default": false, "description": "Relevant to the compiler team, which will review and decide on the PR/issue."}, {"id": 650731663, "node_id": "MDU6TGFiZWw2NTA3MzE2NjM=", "url": "https://api.github.com/repos/rust-lang/rust/labels/C-bug", "name": "C-bug", "color": "f5f1fd", "default": false, "description": "Category: This is a bug."}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 1, "created_at": "2022-11-02T06:00:20Z", "updated_at": "2022-11-02T17:53:35Z", "closed_at": "2022-11-02T17:53:35Z", "author_association": "NONE", "active_lock_reason": null, "body": "This occurs with latest nightly and `--release`\r\n\r\n### Code\r\n\r\n```Rust\r\n#![feature(let_chains)]\r\n\r\npub fn main() {\r\n  if let Some(_) = Some(0) && let Some(_must_have_name) = Some(vec![0]) {}\r\n}\r\n```\r\n\r\n\r\n\r\n\r\n### Error output\r\n\r\n```\r\nerror: internal compiler error: no errors encountered even though `delay_span_bug` issued\r\n\r\nerror: internal compiler error: broken MIR in Item(WithOptConstParam { did: DefId(0:3 ~ temp[7c1c]::main), const_param_did: None }) (after pass PhaseChange-Runtime(Optimized)) at bb8[0]:\r\n                                use of local _10, which has no storage here\r\n --> src/main.rs:4:74\r\n  |\r\n4 |   if let Some(_) = Some(0) && let Some(_must_have_name) = Some(vec![0]) {}\r\n  |                                                                          ^\r\n  |\r\n  = note: delayed at compiler/rustc_const_eval/src/transform/validate.rs:129:36\r\n\r\nthread 'rustc' panicked at 'Box<dyn Any>', compiler/rustc_errors/src/lib.rs:1496:13\r\nstack backtrace:\r\n   0:     0x7f52c9f6dd50 - std::backtrace_rs::backtrace::libunwind::trace::h3857ef565af39398\r\n                               at /rustc/a37499ae66ec5fc52a93d71493b78fb141c32f6b/library/std/src/../../backtrace/src/backtrace/mod.rs:66:5\r\n   1:     0x7f52c9f6dd50 - std::backtrace_rs::backtrace::trace_unsynchronized::hbdcd051de7f77d0f\r\n                               at /rustc/a37499ae66ec5fc52a93d71493b78fb141c32f6b/library/std/src/../../backtrace/src/backtrace/mod.rs:66:5\r\n   2:     0x7f52c9f6dd50 - std::sys_common::backtrace::_print_fmt::h23be2adc86b0a876\r\n                               at /rustc/a37499ae66ec5fc52a93d71493b78fb141c32f6b/library/std/src/sys_common/backtrace.rs:66:5\r\n   3:     0x7f52c9f6dd50 - <std::sys_common::backtrace::_print::DisplayBacktrace as core::fmt::Display>::fmt::h4b060ccd6bd6b034\r\n                               at /rustc/a37499ae66ec5fc52a93d71493b78fb141c32f6b/library/std/src/sys_common/backtrace.rs:45:22\r\n   4:     0x7f52c9fc8aae - core::fmt::write::h8c66ea5bcce6741d\r\n                               at /rustc/a37499ae66ec5fc52a93d71493b78fb141c32f6b/library/core/src/fmt/mod.rs:1202:17\r\n   5:     0x7f52c9f5e865 - std::io::Write::write_fmt::h4eb4d78dd880f1b9\r\n                               at /rustc/a37499ae66ec5fc52a93d71493b78fb141c32f6b/library/std/src/io/mod.rs:1679:15\r\n   6:     0x7f52c9f70a03 - std::sys_common::backtrace::_print::h95ae1478fe0e51b5\r\n                               at /rustc/a37499ae66ec5fc52a93d71493b78fb141c32f6b/library/std/src/sys_common/backtrace.rs:48:5\r\n   7:     0x7f52c9f70a03 - std::sys_common::backtrace::print::h14585209d1e15fd7\r\n                               at /rustc/a37499ae66ec5fc52a93d71493b78fb141c32f6b/library/std/src/sys_common/backtrace.rs:35:9\r\n   8:     0x7f52c9f70a03 - std::panicking::default_hook::{{closure}}::h8113d7aba344b100\r\n                               at /rustc/a37499ae66ec5fc52a93d71493b78fb141c32f6b/library/std/src/panicking.rs:295:22\r\n   9:     0x7f52c9f706ef - std::panicking::default_hook::hc8f6609e883c8b5a\r\n                               at /rustc/a37499ae66ec5fc52a93d71493b78fb141c32f6b/library/std/src/panicking.rs:314:9\r\n  10:     0x7f52cc7637d1 - <rustc_driver[5d611abbc2f17d9d]::DEFAULT_HOOK::{closure#0}::{closure#0} as core[db135c73114314af]::ops::function::FnOnce<(&core[db135c73114314af]::panic::panic_info::PanicInfo,)>>::call_once::{shim:vtable#0}\r\n  11:     0x7f52c9f7123d - std::panicking::rust_panic_with_hook::h3db30b700f89d22f\r\n                               at /rustc/a37499ae66ec5fc52a93d71493b78fb141c32f6b/library/std/src/panicking.rs:702:17\r\n  12:     0x7f52cd87fc11 - std[57446eb6c28e7555]::panicking::begin_panic::<rustc_errors[8c4755de5347ab4f]::ExplicitBug>::{closure#0}\r\n  13:     0x7f52cd87f976 - std[57446eb6c28e7555]::sys_common::backtrace::__rust_end_short_backtrace::<std[57446eb6c28e7555]::panicking::begin_panic<rustc_errors[8c4755de5347ab4f]::ExplicitBug>::{closure#0}, !>\r\n  14:     0x7f52cd87f616 - std[57446eb6c28e7555]::panicking::begin_panic::<rustc_errors[8c4755de5347ab4f]::ExplicitBug>\r\n  15:     0x7f52cd87cdf6 - std[57446eb6c28e7555]::panic::panic_any::<rustc_errors[8c4755de5347ab4f]::ExplicitBug>\r\n  16:     0x7f52cc250b4b - <rustc_errors[8c4755de5347ab4f]::HandlerInner as core[db135c73114314af]::ops::drop::Drop>::drop\r\n  17:     0x7f52cb554168 - core[db135c73114314af]::ptr::drop_in_place::<rustc_session[3445cbfd28f83aee]::parse::ParseSess>\r\n  18:     0x7f52cb511b18 - <alloc[12cf8e0601d39fe3]::rc::Rc<rustc_session[3445cbfd28f83aee]::session::Session> as core[db135c73114314af]::ops::drop::Drop>::drop\r\n  19:     0x7f52cb50eadd - core[db135c73114314af]::ptr::drop_in_place::<rustc_interface[2ab31e4d01a50aaf]::interface::Compiler>\r\n  20:     0x7f52cb50c34c - rustc_interface[2ab31e4d01a50aaf]::interface::create_compiler_and_run::<core[db135c73114314af]::result::Result<(), rustc_errors[8c4755de5347ab4f]::ErrorGuaranteed>, rustc_driver[5d611abbc2f17d9d]::run_compiler::{closure#1}>\r\n  21:     0x7f52cb50a842 - <scoped_tls[f9dca722f455ede3]::ScopedKey<rustc_span[a0f10a6f74d9595c]::SessionGlobals>>::set::<rustc_interface[2ab31e4d01a50aaf]::interface::run_compiler<core[db135c73114314af]::result::Result<(), rustc_errors[8c4755de5347ab4f]::ErrorGuaranteed>, rustc_driver[5d611abbc2f17d9d]::run_compiler::{closure#1}>::{closure#0}, core[db135c73114314af]::result::Result<(), rustc_errors[8c4755de5347ab4f]::ErrorGuaranteed>>\r\n  22:     0x7f52cb50a52f - std[57446eb6c28e7555]::sys_common::backtrace::__rust_begin_short_backtrace::<rustc_interface[2ab31e4d01a50aaf]::util::run_in_thread_pool_with_globals<rustc_interface[2ab31e4d01a50aaf]::interface::run_compiler<core[db135c73114314af]::result::Result<(), rustc_errors[8c4755de5347ab4f]::ErrorGuaranteed>, rustc_driver[5d611abbc2f17d9d]::run_compiler::{closure#1}>::{closure#0}, core[db135c73114314af]::result::Result<(), rustc_errors[8c4755de5347ab4f]::ErrorGuaranteed>>::{closure#0}, core[db135c73114314af]::result::Result<(), rustc_errors[8c4755de5347ab4f]::ErrorGuaranteed>>\r\n  23:     0x7f52cc5d51c0 - <<std[57446eb6c28e7555]::thread::Builder>::spawn_unchecked_<rustc_interface[2ab31e4d01a50aaf]::util::run_in_thread_pool_with_globals<rustc_interface[2ab31e4d01a50aaf]::interface::run_compiler<core[db135c73114314af]::result::Result<(), rustc_errors[8c4755de5347ab4f]::ErrorGuaranteed>, rustc_driver[5d611abbc2f17d9d]::run_compiler::{closure#1}>::{closure#0}, core[db135c73114314af]::result::Result<(), rustc_errors[8c4755de5347ab4f]::ErrorGuaranteed>>::{closure#0}, core[db135c73114314af]::result::Result<(), rustc_errors[8c4755de5347ab4f]::ErrorGuaranteed>>::{closure#1} as core[db135c73114314af]::ops::function::FnOnce<()>>::call_once::{shim:vtable#0}\r\n  24:     0x7f52c9f7b013 - <alloc::boxed::Box<F,A> as core::ops::function::FnOnce<Args>>::call_once::h444ca4f495d8afb9\r\n                               at /rustc/a37499ae66ec5fc52a93d71493b78fb141c32f6b/library/alloc/src/boxed.rs:1940:9\r\n  25:     0x7f52c9f7b013 - <alloc::boxed::Box<F,A> as core::ops::function::FnOnce<Args>>::call_once::h73ae8bee2b70403b\r\n                               at /rustc/a37499ae66ec5fc52a93d71493b78fb141c32f6b/library/alloc/src/boxed.rs:1940:9\r\n  26:     0x7f52c9f7b013 - std::sys::unix::thread::Thread::new::thread_start::h2dd9b6f640aa1270\r\n                               at /rustc/a37499ae66ec5fc52a93d71493b78fb141c32f6b/library/std/src/sys/unix/thread.rs:108:17\r\n  27:     0x7f52c9d1c8fd - <unknown>\r\n  28:     0x7f52c9d9ea60 - <unknown>\r\n  29:                0x0 - <unknown>\r\n\r\nnote: the compiler unexpectedly panicked. this is a bug.\r\n\r\nnote: we would appreciate a bug report: https://github.com/rust-lang/rust/issues/new?labels=C-bug%2C+I-ICE%2C+T-compiler&template=ice.md\r\n\r\nnote: rustc 1.66.0-nightly (a37499ae6 2022-09-18) running on x86_64-unknown-linux-gnu\r\n\r\nnote: compiler flags: --crate-type bin -C opt-level=3 -C embed-bitcode=no\r\n\r\nnote: some of the compiler flags provided by cargo are hidden\r\n\r\n```\r\n\r\nhttps://rust.godbolt.org/z/Kzc98jKnM", "closed_by": {"login": "rgreenblatt", "id": 8813096, "node_id": "MDQ6VXNlcjg4MTMwOTY=", "avatar_url": "https://avatars.githubusercontent.com/u/8813096?v=4", "gravatar_id": "", "url": "https://api.github.com/users/rgreenblatt", "html_url": "https://github.com/rgreenblatt", "followers_url": "https://api.github.com/users/rgreenblatt/followers", "following_url": "https://api.github.com/users/rgreenblatt/following{/other_user}", "gists_url": "https://api.github.com/users/rgreenblatt/gists{/gist_id}", "starred_url": "https://api.github.com/users/rgreenblatt/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/rgreenblatt/subscriptions", "organizations_url": "https://api.github.com/users/rgreenblatt/orgs", "repos_url": "https://api.github.com/users/rgreenblatt/repos", "events_url": "https://api.github.com/users/rgreenblatt/events{/privacy}", "received_events_url": "https://api.github.com/users/rgreenblatt/received_events", "type": "User", "site_admin": false}, "reactions": {"url": "https://api.github.com/repos/rust-lang/rust/issues/103871/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rust-lang/rust/issues/103871/timeline", "performed_via_github_app": null, "state_reason": "completed"}