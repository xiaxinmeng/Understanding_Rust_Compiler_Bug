{"url": "https://api.github.com/repos/rust-lang/rust/issues/67391", "repository_url": "https://api.github.com/repos/rust-lang/rust", "labels_url": "https://api.github.com/repos/rust-lang/rust/issues/67391/labels{/name}", "comments_url": "https://api.github.com/repos/rust-lang/rust/issues/67391/comments", "events_url": "https://api.github.com/repos/rust-lang/rust/issues/67391/events", "html_url": "https://github.com/rust-lang/rust/issues/67391", "id": 539580883, "node_id": "MDU6SXNzdWU1Mzk1ODA4ODM=", "number": 67391, "title": "`Command::new(&path).output()` returns incorrect data when child program segfaults", "user": {"login": "jaseemabid", "id": 601714, "node_id": "MDQ6VXNlcjYwMTcxNA==", "avatar_url": "https://avatars.githubusercontent.com/u/601714?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jaseemabid", "html_url": "https://github.com/jaseemabid", "followers_url": "https://api.github.com/users/jaseemabid/followers", "following_url": "https://api.github.com/users/jaseemabid/following{/other_user}", "gists_url": "https://api.github.com/users/jaseemabid/gists{/gist_id}", "starred_url": "https://api.github.com/users/jaseemabid/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jaseemabid/subscriptions", "organizations_url": "https://api.github.com/users/jaseemabid/orgs", "repos_url": "https://api.github.com/users/jaseemabid/repos", "events_url": "https://api.github.com/users/jaseemabid/events{/privacy}", "received_events_url": "https://api.github.com/users/jaseemabid/received_events", "type": "User", "site_admin": false}, "labels": [], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 2, "created_at": "2019-12-18T10:08:52Z", "updated_at": "2019-12-21T06:15:28Z", "closed_at": "2019-12-18T11:04:35Z", "author_association": "NONE", "active_lock_reason": null, "body": "When a child program segfaults, I'd expect `.output()` to return an `Err(..)` instead of `Ok(..)`.\r\n\r\nMinimal reproduction example: \r\n\r\n\r\n**segfault.c**:\r\n```c\r\n#include <stdio.h>\r\n\r\nint main() {\r\n    int *p = NULL;\r\n    *p = 1;\r\n}\r\n```\r\n**run.rs**:\r\n```rust\r\nuse std::os::unix::process::ExitStatusExt;\r\nuse std::process::Command;\r\n\r\nfn main() -> Result<(), std::io::Error> {\r\n    let exe = Command::new(\"./a.out\").output()?;\r\n\r\n    println!(\r\n        \"status: `{}`, code: `{:?}`, success: `{}`, signal: {:?}\",\r\n        exe.status,\r\n        exe.status.code(),\r\n        exe.status.success(),\r\n        exe.status.signal()\r\n    );\r\n\r\n    Ok(())\r\n}\r\n```\r\nI'd expect command's behaviour to match that of executing the program directly.\r\n\r\n```\r\n$ clang segfault.c\r\n$ ./a.out\r\n[1]    89887 segmentation fault (core dumped)  ./a.out\r\n$ echo $?\r\n139\r\n\r\n$ rustc run.rs\r\n$ ./run\r\nstatus: `signal: 11`, code: `None`, success: `false`, signal: Some(11)\r\n```\r\n\r\nThis program must exit with a non zero code and report an error instead of silently returning `Ok()` with empty stderr and stdout. `Command` seems to handle other kind of errors fine, for example non existent binaries correctly report an error:\r\n\r\n```\r\n./run\r\nError: Os { code: 2, kind: NotFound, message: \"No such file or directory\" }\r\n```", "closed_by": {"login": "jonas-schievink", "id": 1786438, "node_id": "MDQ6VXNlcjE3ODY0Mzg=", "avatar_url": "https://avatars.githubusercontent.com/u/1786438?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jonas-schievink", "html_url": "https://github.com/jonas-schievink", "followers_url": "https://api.github.com/users/jonas-schievink/followers", "following_url": "https://api.github.com/users/jonas-schievink/following{/other_user}", "gists_url": "https://api.github.com/users/jonas-schievink/gists{/gist_id}", "starred_url": "https://api.github.com/users/jonas-schievink/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jonas-schievink/subscriptions", "organizations_url": "https://api.github.com/users/jonas-schievink/orgs", "repos_url": "https://api.github.com/users/jonas-schievink/repos", "events_url": "https://api.github.com/users/jonas-schievink/events{/privacy}", "received_events_url": "https://api.github.com/users/jonas-schievink/received_events", "type": "User", "site_admin": false}, "reactions": {"url": "https://api.github.com/repos/rust-lang/rust/issues/67391/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rust-lang/rust/issues/67391/timeline", "performed_via_github_app": null, "state_reason": "completed"}