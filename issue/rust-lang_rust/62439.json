{"url": "https://api.github.com/repos/rust-lang/rust/issues/62439", "repository_url": "https://api.github.com/repos/rust-lang/rust", "labels_url": "https://api.github.com/repos/rust-lang/rust/issues/62439/labels{/name}", "comments_url": "https://api.github.com/repos/rust-lang/rust/issues/62439/comments", "events_url": "https://api.github.com/repos/rust-lang/rust/issues/62439/events", "html_url": "https://github.com/rust-lang/rust/issues/62439", "id": 464843881, "node_id": "MDU6SXNzdWU0NjQ4NDM4ODE=", "number": 62439, "title": "1.65x performance regression from 1.35.0 to 1.36.0", "user": {"login": "utterstep", "id": 829944, "node_id": "MDQ6VXNlcjgyOTk0NA==", "avatar_url": "https://avatars.githubusercontent.com/u/829944?v=4", "gravatar_id": "", "url": "https://api.github.com/users/utterstep", "html_url": "https://github.com/utterstep", "followers_url": "https://api.github.com/users/utterstep/followers", "following_url": "https://api.github.com/users/utterstep/following{/other_user}", "gists_url": "https://api.github.com/users/utterstep/gists{/gist_id}", "starred_url": "https://api.github.com/users/utterstep/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/utterstep/subscriptions", "organizations_url": "https://api.github.com/users/utterstep/orgs", "repos_url": "https://api.github.com/users/utterstep/repos", "events_url": "https://api.github.com/users/utterstep/events{/privacy}", "received_events_url": "https://api.github.com/users/utterstep/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 113376, "node_id": "MDU6TGFiZWwxMTMzNzY=", "url": "https://api.github.com/repos/rust-lang/rust/labels/I-slow", "name": "I-slow", "color": "e10c02", "default": false, "description": "Problems and improvements with respect to performance of generated code."}, {"id": 211668100, "node_id": "MDU6TGFiZWwyMTE2NjgxMDA=", "url": "https://api.github.com/repos/rust-lang/rust/labels/T-compiler", "name": "T-compiler", "color": "bfd4f2", "default": false, "description": "Relevant to the compiler team, which will review and decide on the PR/issue."}, {"id": 262252840, "node_id": "MDU6TGFiZWwyNjIyNTI4NDA=", "url": "https://api.github.com/repos/rust-lang/rust/labels/regression-from-stable-to-stable", "name": "regression-from-stable-to-stable", "color": "e4008a", "default": false, "description": "Performance or correctness regression from one stable version to another."}, {"id": 2011781731, "node_id": "MDU6TGFiZWwyMDExNzgxNzMx", "url": "https://api.github.com/repos/rust-lang/rust/labels/T-libs", "name": "T-libs", "color": "bfd4f2", "default": false, "description": "Relevant to the library team, which will review and decide on the PR/issue."}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 5, "created_at": "2019-07-06T11:10:52Z", "updated_at": "2021-07-14T19:03:21Z", "closed_at": "2021-07-14T19:03:21Z", "author_association": "NONE", "active_lock_reason": null, "body": "Seeing ~2x (46ms vs 28ms) performance regression after updating 1.35.0 to 1.36.0 (probably due to new HashMap implementation?).\r\n\r\n**Steps to reproduce**\r\n\r\n1. Clone this repo: https://github.com/utter-step/advent-2018\r\n2. `rustup override set 1.35.0 && cargo build -p day-6 --release`\r\n3. measure `APP_PART=one APP_INPUT_FILE=day-6/full.txt target/release/day-6`, `APP_PART=two APP_INPUT_FILE=day-6/full.txt APP_MAX_DISTANCE=10000 target/release/day-6`. I used ipython for this, for example: \r\n    1. `import os`\r\n    2. `%timeit os.system('APP_PART=one APP_INPUT_FILE=day-6/full.txt target/release/day-6 > /dev/null')`\r\n    3. `%timeit os.system('APP_PART=two APP_INPUT_FILE=day-6/full.txt APP_MAX_DISTANCE=10000 target/release/day-6 > /dev/null')`\r\n4. `rustup override set 1.36.0 && cargo build -p day-6 --release`\r\n5. repeat step 3 measurements\r\n\r\n**My system specs**\r\n- Ubuntu 18.04 x86-64\r\n- Intel Core i7-8750H (2.2GHz / 4.1GHz Turbo), cpu governor set to `performance` for time estimation purposes\r\n\r\n**Results**\r\n1.35.0: \r\n* part one: `15.8 ms \u00b1 50.8 \u00b5s per loop (mean \u00b1 std. dev. of 7 runs, 100 loops each)`\r\n* part two: `11.7 ms \u00b1 857 \u00b5s per loop (mean \u00b1 std. dev. of 7 runs, 100 loops each)`\r\n\r\n1.36.0:\r\n* part one: `23 ms \u00b1 191 \u00b5s per loop (mean \u00b1 std. dev. of 7 runs, 10 loops each)`\r\n* part two: `22.6 ms \u00b1 156 \u00b5s per loop (mean \u00b1 std. dev. of 7 runs, 10 loops each)`\r\n\r\nMain logic is in this file: https://github.com/utter-step/advent-2018/blob/master/day-6/src/world/mod.rs, it's a solution to Advent of Code 2018 [day 6 problem](https://adventofcode.com/2018/day/6).\r\n\r\nPart one is using `HashMap::iter_mut` a lot: https://github.com/utter-step/advent-2018/blob/master/day-6/src/world/mod.rs#L46\r\nPart two is using `HashMap::keys` a lot: https://github.com/utter-step/advent-2018/blob/master/day-6/src/world/mod.rs#L83\r\n\r\n**Meta**\r\n1.35.0:\r\n```\r\nrustc --version\r\nrustc 1.35.0 (3c235d560 2019-05-20)\r\n```\r\n\r\n1.36.0:\r\n```\r\nrustc --version\r\nrustc 1.36.0 (a53f9df32 2019-07-03)\r\n```\r\n\r\nHope that info I provided would be useful!\r\n\r\nVlad", "closed_by": {"login": "Amanieu", "id": 278509, "node_id": "MDQ6VXNlcjI3ODUwOQ==", "avatar_url": "https://avatars.githubusercontent.com/u/278509?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Amanieu", "html_url": "https://github.com/Amanieu", "followers_url": "https://api.github.com/users/Amanieu/followers", "following_url": "https://api.github.com/users/Amanieu/following{/other_user}", "gists_url": "https://api.github.com/users/Amanieu/gists{/gist_id}", "starred_url": "https://api.github.com/users/Amanieu/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Amanieu/subscriptions", "organizations_url": "https://api.github.com/users/Amanieu/orgs", "repos_url": "https://api.github.com/users/Amanieu/repos", "events_url": "https://api.github.com/users/Amanieu/events{/privacy}", "received_events_url": "https://api.github.com/users/Amanieu/received_events", "type": "User", "site_admin": false}, "reactions": {"url": "https://api.github.com/repos/rust-lang/rust/issues/62439/reactions", "total_count": 1, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 1, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rust-lang/rust/issues/62439/timeline", "performed_via_github_app": null, "state_reason": "completed"}