{"url": "https://api.github.com/repos/rust-lang/rust/issues/94230", "repository_url": "https://api.github.com/repos/rust-lang/rust", "labels_url": "https://api.github.com/repos/rust-lang/rust/issues/94230/labels{/name}", "comments_url": "https://api.github.com/repos/rust-lang/rust/issues/94230/comments", "events_url": "https://api.github.com/repos/rust-lang/rust/issues/94230/events", "html_url": "https://github.com/rust-lang/rust/issues/94230", "id": 1146242208, "node_id": "I_kwDOAAsO6M5EUkSg", "number": 94230, "title": "Compiler index out of bounds error while typechecking function with const generic", "user": {"login": "jlogan03", "id": 1596770, "node_id": "MDQ6VXNlcjE1OTY3NzA=", "avatar_url": "https://avatars.githubusercontent.com/u/1596770?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jlogan03", "html_url": "https://github.com/jlogan03", "followers_url": "https://api.github.com/users/jlogan03/followers", "following_url": "https://api.github.com/users/jlogan03/following{/other_user}", "gists_url": "https://api.github.com/users/jlogan03/gists{/gist_id}", "starred_url": "https://api.github.com/users/jlogan03/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jlogan03/subscriptions", "organizations_url": "https://api.github.com/users/jlogan03/orgs", "repos_url": "https://api.github.com/users/jlogan03/repos", "events_url": "https://api.github.com/users/jlogan03/events{/privacy}", "received_events_url": "https://api.github.com/users/jlogan03/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 9618520, "node_id": "MDU6TGFiZWw5NjE4NTIw", "url": "https://api.github.com/repos/rust-lang/rust/labels/I-ICE", "name": "I-ICE", "color": "e10c02", "default": false, "description": "Issue: The compiler panicked, giving an Internal Compilation Error (ICE) \u2744\ufe0f"}, {"id": 211668100, "node_id": "MDU6TGFiZWwyMTE2NjgxMDA=", "url": "https://api.github.com/repos/rust-lang/rust/labels/T-compiler", "name": "T-compiler", "color": "bfd4f2", "default": false, "description": "Relevant to the compiler team, which will review and decide on the PR/issue."}, {"id": 650731663, "node_id": "MDU6TGFiZWw2NTA3MzE2NjM=", "url": "https://api.github.com/repos/rust-lang/rust/labels/C-bug", "name": "C-bug", "color": "f5f1fd", "default": false, "description": "Category: This is a bug."}, {"id": 1472563007, "node_id": "MDU6TGFiZWwxNDcyNTYzMDA3", "url": "https://api.github.com/repos/rust-lang/rust/labels/requires-nightly", "name": "requires-nightly", "color": "76dcde", "default": false, "description": "This issue requires a nightly compiler in some way."}, {"id": 2341291797, "node_id": "MDU6TGFiZWwyMzQxMjkxNzk3", "url": "https://api.github.com/repos/rust-lang/rust/labels/F-generic_const_exprs", "name": "F-generic_const_exprs", "color": "f9c0cc", "default": false, "description": "`#![feature(generic_const_exprs)]`"}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 3, "created_at": "2022-02-21T21:30:23Z", "updated_at": "2022-02-26T22:22:39Z", "closed_at": "2022-02-26T22:22:39Z", "author_association": "NONE", "active_lock_reason": null, "body": "<!--\r\nCompiler experiences an internal error while typechecking the function at https://github.com/jlogan03/catnip/blob/e10eb1e02c1d3bed2d71b9d8c4e50bd9190d4333/catnip/src/enet.rs#L113 .\r\n\r\nThe error is notably different when compiled with --release .\r\n-->\r\n\r\n### Code\r\nSee https://github.com/jlogan03/catnip/blob/e10eb1e02c1d3bed2d71b9d8c4e50bd9190d4333/catnip/src/enet.rs#L113\r\n\r\n```Rust\r\n/// Ethernet II frame (variable parts of a packet)\r\n/// \r\n/// P is length of data's byte representation\r\n#[derive(Clone, Copy, Debug)]\r\npub struct EthernetFrame<const P: usize>\r\n{\r\n    /// Ethernet frame header\r\n    pub header: EthernetHeader,\r\n    /// Ethernet payload (likely some kind of IP packet)\r\n    pub data: [u8; P],\r\n}\r\n\r\nimpl<const P: usize> EthernetFrame<P> {\r\n    /// Generate new, complete frame from components\r\n    pub fn new(header: EthernetHeader, data: [u8; P]) -> Self {\r\n        let enetframe: EthernetFrame<P> = EthernetFrame {\r\n            header: header,\r\n            data: data\r\n        };\r\n\r\n        enetframe\r\n    }\r\n}\r\n```\r\n\r\n### Meta\r\n<!--\r\nIf you're using the stable version of the compiler, you should also check if the\r\nbug also exists in the beta or nightly versions.\r\n-->\r\n\r\n`rustc --version --verbose`:\r\n```\r\nrustc 1.59.0-nightly (cfa3fe5af 2021-12-31)\r\nbinary: rustc\r\ncommit-hash: cfa3fe5af339e724209b25715282adae0c61628f\r\ncommit-date: 2021-12-31\r\nhost: x86_64-apple-darwin\r\nrelease: 1.59.0-nightly\r\nLLVM version: 13.0.0\r\n```\r\n\r\n### Error output\r\n\r\n```\r\nerror: internal compiler error: unexpected panic\r\n```\r\n\r\n<!--\r\nInclude a backtrace in the code block by setting `RUST_BACKTRACE=1` in your\r\nenvironment. E.g. `RUST_BACKTRACE=1 cargo build`.\r\n-->\r\n<details><summary><strong>Backtrace</strong></summary>\r\n<p>\r\n\r\n```\r\nJamess-MacBook-Pro:catnip jlogan$ RUST_BACKTRACE=full cargo run --example packet\r\n   Compiling catnip v0.1.1 (/Users/jlogan/git/catnip/catnip)\r\nwarning: the feature `generic_const_exprs` is incomplete and may not be safe to use and/or cause compiler crashes\r\n --> src/lib.rs:6:12\r\n  |\r\n6 | #![feature(generic_const_exprs)]\r\n  |            ^^^^^^^^^^^^^^^^^^^\r\n  |\r\n  = note: `#[warn(incomplete_features)]` on by default\r\n  = note: see issue #76560 <https://github.com/rust-lang/rust/issues/76560> for more information\r\n\r\nthread 'rustc' panicked at 'index out of bounds: the len is 205 but the index is 205', compiler/rustc_query_impl/src/on_disk_cache.rs:726:18\r\nstack backtrace:\r\n   0:        0x10b597ea1 - <std::sys_common::backtrace::_print::DisplayBacktrace as core::fmt::Display>::fmt::h85d27a8e284fe0bc\r\n   1:        0x10b5ee55b - core::fmt::write::h811afcfb2cc9fb5f\r\n   2:        0x10b588c9a - std::io::Write::write_fmt::hfcd83cc2a0eab4db\r\n   3:        0x10b59c1c5 - std::panicking::default_hook::{{closure}}::hdeec781c17ec77d4\r\n   4:        0x10b59bdac - std::panicking::default_hook::hde700d0e25c42b00\r\n   5:        0x11a24db3d - rustc_driver[44cf0a46dc43c607]::DEFAULT_HOOK::{closure#0}::{closure#0}\r\n   6:        0x10b59c98a - std::panicking::rust_panic_with_hook::h9eabc51596fbd5ca\r\n   7:        0x10b59c6de - std::panicking::begin_panic_handler::{{closure}}::h3b61bac0ee43ec1a\r\n   8:        0x10b598307 - std::sys_common::backtrace::__rust_end_short_backtrace::hae0de2227c9289b6\r\n   9:        0x10b59c3ea - _rust_begin_unwind\r\n  10:        0x10b61722f - core::panicking::panic_fmt::hf448e2fe515dc44f\r\n  11:        0x10b6171f6 - core::panicking::panic_bounds_check::hc0bbbf1c2464d212\r\n  12:        0x11db3bc21 - <rustc_span[6b62af7a7a91e72]::span_encoding::Span as rustc_serialize[2e331eae6851527f]::serialize::Decodable<rustc_query_impl[da9c462a956b02f]::on_disk_cache::CacheDecoder>>::decode\r\n  13:        0x11daf0320 - <rustc_middle[5cac8dea76602c43]::ty::VariantDef as rustc_serialize[2e331eae6851527f]::serialize::Decodable<rustc_query_impl[da9c462a956b02f]::on_disk_cache::CacheDecoder>>::decode\r\n  14:        0x11d99ae72 - <rustc_query_impl[da9c462a956b02f]::on_disk_cache::CacheDecoder as rustc_serialize[2e331eae6851527f]::serialize::Decoder>::read_seq::<alloc[f1a859187e893214]::vec::Vec<rustc_middle[5cac8dea76602c43]::ty::VariantDef>, <alloc[f1a859187e893214]::vec::Vec<rustc_middle[5cac8dea76602c43]::ty::VariantDef> as rustc_serialize[2e331eae6851527f]::serialize::Decodable<rustc_query_impl[da9c462a956b02f]::on_disk_cache::CacheDecoder>>::decode::{closure#0}>\r\n  15:        0x11d93a304 - <rustc_middle[5cac8dea76602c43]::ty::adt::AdtDef as rustc_serialize[2e331eae6851527f]::serialize::Decodable<rustc_query_impl[da9c462a956b02f]::on_disk_cache::CacheDecoder>>::decode\r\n  16:        0x11d901b1e - <rustc_middle[5cac8dea76602c43]::ty::sty::TyKind as rustc_serialize[2e331eae6851527f]::serialize::Decodable<rustc_query_impl[da9c462a956b02f]::on_disk_cache::CacheDecoder>>::decode\r\n  17:        0x11dae3d8c - <&rustc_middle[5cac8dea76602c43]::ty::TyS as rustc_serialize[2e331eae6851527f]::serialize::Decodable<rustc_query_impl[da9c462a956b02f]::on_disk_cache::CacheDecoder>>::decode\r\n  18:        0x11d9ae81d - <rustc_query_impl[da9c462a956b02f]::on_disk_cache::CacheDecoder as rustc_middle[5cac8dea76602c43]::ty::codec::TyDecoder>::cached_ty_for_shorthand::<<&rustc_middle[5cac8dea76602c43]::ty::TyS as rustc_serialize[2e331eae6851527f]::serialize::Decodable<rustc_query_impl[da9c462a956b02f]::on_disk_cache::CacheDecoder>>::decode::{closure#0}>\r\n  19:        0x11dae3e95 - <&rustc_middle[5cac8dea76602c43]::ty::TyS as rustc_serialize[2e331eae6851527f]::serialize::Decodable<rustc_query_impl[da9c462a956b02f]::on_disk_cache::CacheDecoder>>::decode\r\n  20:        0x11d9a3440 - <rustc_query_impl[da9c462a956b02f]::on_disk_cache::CacheDecoder as rustc_serialize[2e331eae6851527f]::serialize::Decoder>::read_map::<std[ab968d190f62ef24]::collections::hash::map::HashMap<rustc_hir[c96fb5e8bf20d864]::hir_id::ItemLocalId, &rustc_middle[5cac8dea76602c43]::ty::TyS, core[313838a0196ec485]::hash::BuildHasherDefault<rustc_hash[8b3c6192063bb94c]::FxHasher>>, <std[ab968d190f62ef24]::collections::hash::map::HashMap<rustc_hir[c96fb5e8bf20d864]::hir_id::ItemLocalId, &rustc_middle[5cac8dea76602c43]::ty::TyS, core[313838a0196ec485]::hash::BuildHasherDefault<rustc_hash[8b3c6192063bb94c]::FxHasher>> as rustc_serialize[2e331eae6851527f]::serialize::Decodable<rustc_query_impl[da9c462a956b02f]::on_disk_cache::CacheDecoder>>::decode::{closure#0}>\r\n  21:        0x11d96a0f9 - <rustc_middle[5cac8dea76602c43]::ty::context::TypeckResults as rustc_serialize[2e331eae6851527f]::serialize::Decodable<rustc_query_impl[da9c462a956b02f]::on_disk_cache::CacheDecoder>>::decode::{closure#0}\r\n  22:        0x11d9ad4da - <rustc_query_impl[da9c462a956b02f]::on_disk_cache::OnDiskCache>::try_load_query_result::<&rustc_middle[5cac8dea76602c43]::ty::context::TypeckResults>\r\n  23:        0x11d806ea3 - rustc_query_system[796c4cfc3e0bdbdb]::query::plumbing::try_load_from_disk_and_cache_in_memory::<rustc_query_impl[da9c462a956b02f]::plumbing::QueryCtxt, rustc_span[6b62af7a7a91e72]::def_id::LocalDefId, &rustc_middle[5cac8dea76602c43]::ty::context::TypeckResults>\r\n  24:        0x11d79bc67 - rustc_query_system[796c4cfc3e0bdbdb]::query::plumbing::try_execute_query::<rustc_query_impl[da9c462a956b02f]::plumbing::QueryCtxt, rustc_query_system[796c4cfc3e0bdbdb]::query::caches::DefaultCache<rustc_span[6b62af7a7a91e72]::def_id::LocalDefId, &rustc_middle[5cac8dea76602c43]::ty::context::TypeckResults>>\r\n  25:        0x11d871c6e - rustc_query_system[796c4cfc3e0bdbdb]::query::plumbing::get_query::<rustc_query_impl[da9c462a956b02f]::queries::typeck, rustc_query_impl[da9c462a956b02f]::plumbing::QueryCtxt>\r\n  26:        0x11d16736b - <rustc_passes[ccb603ec64afb49a]::liveness::IrMaps as rustc_hir[c96fb5e8bf20d864]::intravisit::Visitor>::visit_body\r\n  27:        0x11d0cab9f - rustc_hir[c96fb5e8bf20d864]::intravisit::walk_impl_item::<rustc_passes[ccb603ec64afb49a]::liveness::IrMaps>\r\n  28:        0x11d15c877 - <rustc_middle[5cac8dea76602c43]::hir::map::Map>::visit_item_likes_in_module::<rustc_hir[c96fb5e8bf20d864]::intravisit::DeepVisitor<rustc_passes[ccb603ec64afb49a]::liveness::IrMaps>>\r\n  29:        0x11d166443 - rustc_passes[ccb603ec64afb49a]::liveness::check_mod_liveness\r\n  30:        0x11da42858 - <rustc_query_system[796c4cfc3e0bdbdb]::dep_graph::graph::DepGraph<rustc_middle[5cac8dea76602c43]::dep_graph::dep_node::DepKind>>::with_task::<rustc_middle[5cac8dea76602c43]::ty::context::TyCtxt, rustc_span[6b62af7a7a91e72]::def_id::LocalDefId, ()>\r\n  31:        0x11d8e4bca - rustc_data_structures[b33c0aa32de24999]::stack::ensure_sufficient_stack::<((), rustc_query_system[796c4cfc3e0bdbdb]::dep_graph::graph::DepNodeIndex), rustc_query_system[796c4cfc3e0bdbdb]::query::plumbing::execute_job<rustc_query_impl[da9c462a956b02f]::plumbing::QueryCtxt, rustc_span[6b62af7a7a91e72]::def_id::LocalDefId, ()>::{closure#3}>\r\n  32:        0x11d79f596 - rustc_query_system[796c4cfc3e0bdbdb]::query::plumbing::try_execute_query::<rustc_query_impl[da9c462a956b02f]::plumbing::QueryCtxt, rustc_query_system[796c4cfc3e0bdbdb]::query::caches::DefaultCache<rustc_span[6b62af7a7a91e72]::def_id::LocalDefId, ()>>\r\n  33:        0x11d84f13b - rustc_query_system[796c4cfc3e0bdbdb]::query::plumbing::get_query::<rustc_query_impl[da9c462a956b02f]::queries::check_mod_liveness, rustc_query_impl[da9c462a956b02f]::plumbing::QueryCtxt>\r\n  34:        0x11a43c192 - <core[313838a0196ec485]::panic::unwind_safe::AssertUnwindSafe<rustc_interface[1658e7de0f71f99e]::passes::analysis::{closure#1}::{closure#1}> as core[313838a0196ec485]::ops::function::FnOnce<()>>::call_once\r\n  35:        0x11a433c59 - <rustc_session[a3ed5af2e8657d44]::session::Session>::time::<(), rustc_interface[1658e7de0f71f99e]::passes::analysis::{closure#1}>\r\n  36:        0x11a39208c - rustc_interface[1658e7de0f71f99e]::passes::analysis\r\n  37:        0x11da6ea9c - <rustc_query_system[796c4cfc3e0bdbdb]::dep_graph::graph::DepGraph<rustc_middle[5cac8dea76602c43]::dep_graph::dep_node::DepKind>>::with_task::<rustc_middle[5cac8dea76602c43]::ty::context::TyCtxt, (), core[313838a0196ec485]::result::Result<(), rustc_errors[58bfe2a0b1d83843]::ErrorReported>>\r\n  38:        0x11d8d62b5 - rustc_data_structures[b33c0aa32de24999]::stack::ensure_sufficient_stack::<(core[313838a0196ec485]::result::Result<(), rustc_errors[58bfe2a0b1d83843]::ErrorReported>, rustc_query_system[796c4cfc3e0bdbdb]::dep_graph::graph::DepNodeIndex), rustc_query_system[796c4cfc3e0bdbdb]::query::plumbing::execute_job<rustc_query_impl[da9c462a956b02f]::plumbing::QueryCtxt, (), core[313838a0196ec485]::result::Result<(), rustc_errors[58bfe2a0b1d83843]::ErrorReported>>::{closure#3}>\r\n  39:        0x11d7f12e5 - rustc_query_system[796c4cfc3e0bdbdb]::query::plumbing::try_execute_query::<rustc_query_impl[da9c462a956b02f]::plumbing::QueryCtxt, rustc_query_system[796c4cfc3e0bdbdb]::query::caches::DefaultCache<(), core[313838a0196ec485]::result::Result<(), rustc_errors[58bfe2a0b1d83843]::ErrorReported>>>\r\n  40:        0x11d872065 - rustc_query_system[796c4cfc3e0bdbdb]::query::plumbing::get_query::<rustc_query_impl[da9c462a956b02f]::queries::analysis, rustc_query_impl[da9c462a956b02f]::plumbing::QueryCtxt>\r\n  41:        0x11a2ba49b - <rustc_interface[1658e7de0f71f99e]::passes::QueryContext>::enter::<rustc_driver[44cf0a46dc43c607]::run_compiler::{closure#1}::{closure#2}::{closure#3}, core[313838a0196ec485]::result::Result<(), rustc_errors[58bfe2a0b1d83843]::ErrorReported>>\r\n  42:        0x11a2b0911 - <rustc_interface[1658e7de0f71f99e]::interface::Compiler>::enter::<rustc_driver[44cf0a46dc43c607]::run_compiler::{closure#1}::{closure#2}, core[313838a0196ec485]::result::Result<core[313838a0196ec485]::option::Option<rustc_interface[1658e7de0f71f99e]::queries::Linker>, rustc_errors[58bfe2a0b1d83843]::ErrorReported>>\r\n  43:        0x11a25d848 - rustc_span[6b62af7a7a91e72]::with_source_map::<core[313838a0196ec485]::result::Result<(), rustc_errors[58bfe2a0b1d83843]::ErrorReported>, rustc_interface[1658e7de0f71f99e]::interface::create_compiler_and_run<core[313838a0196ec485]::result::Result<(), rustc_errors[58bfe2a0b1d83843]::ErrorReported>, rustc_driver[44cf0a46dc43c607]::run_compiler::{closure#1}>::{closure#1}>\r\n  44:        0x11a2af15f - rustc_interface[1658e7de0f71f99e]::interface::create_compiler_and_run::<core[313838a0196ec485]::result::Result<(), rustc_errors[58bfe2a0b1d83843]::ErrorReported>, rustc_driver[44cf0a46dc43c607]::run_compiler::{closure#1}>\r\n  45:        0x11a26aa9e - std[ab968d190f62ef24]::sys_common::backtrace::__rust_begin_short_backtrace::<rustc_interface[1658e7de0f71f99e]::util::setup_callbacks_and_run_in_thread_pool_with_globals<rustc_interface[1658e7de0f71f99e]::interface::run_compiler<core[313838a0196ec485]::result::Result<(), rustc_errors[58bfe2a0b1d83843]::ErrorReported>, rustc_driver[44cf0a46dc43c607]::run_compiler::{closure#1}>::{closure#0}, core[313838a0196ec485]::result::Result<(), rustc_errors[58bfe2a0b1d83843]::ErrorReported>>::{closure#0}, core[313838a0196ec485]::result::Result<(), rustc_errors[58bfe2a0b1d83843]::ErrorReported>>\r\n  46:        0x11a2c9105 - <<std[ab968d190f62ef24]::thread::Builder>::spawn_unchecked<rustc_interface[1658e7de0f71f99e]::util::setup_callbacks_and_run_in_thread_pool_with_globals<rustc_interface[1658e7de0f71f99e]::interface::run_compiler<core[313838a0196ec485]::result::Result<(), rustc_errors[58bfe2a0b1d83843]::ErrorReported>, rustc_driver[44cf0a46dc43c607]::run_compiler::{closure#1}>::{closure#0}, core[313838a0196ec485]::result::Result<(), rustc_errors[58bfe2a0b1d83843]::ErrorReported>>::{closure#0}, core[313838a0196ec485]::result::Result<(), rustc_errors[58bfe2a0b1d83843]::ErrorReported>>::{closure#1} as core[313838a0196ec485]::ops::function::FnOnce<()>>::call_once::{shim:vtable#0}\r\n  47:        0x10b5a9397 - std::sys::unix::thread::Thread::new::thread_start::h04ec690274cf9f89\r\n  48:     0x7ff8067464f4 - __pthread_start\r\n\r\nerror: internal compiler error: unexpected panic\r\n\r\nnote: the compiler unexpectedly panicked. this is a bug.\r\n\r\nnote: we would appreciate a bug report: https://github.com/rust-lang/rust/issues/new?labels=C-bug%2C+I-ICE%2C+T-compiler&template=ice.md\r\n\r\nnote: rustc 1.59.0-nightly (cfa3fe5af 2021-12-31) running on x86_64-apple-darwin\r\n\r\nnote: compiler flags: -C embed-bitcode=no -C split-debuginfo=unpacked -C debuginfo=2 -C incremental --crate-type lib\r\n\r\nnote: some of the compiler flags provided by cargo are hidden\r\n\r\nquery stack during panic:\r\n#0 [typeck] type-checking `enet::<impl at src/enet.rs:34:1: 90:2>::new`\r\n#1 [check_mod_liveness] checking liveness of variables in module `enet`\r\n#2 [analysis] running analysis passes on this crate\r\nend of query stack\r\nwarning: `catnip` (lib) generated 1 warning\r\nerror: could not compile `catnip`; 1 warning emitted\r\n```\r\n\r\n</p>\r\n</details>\r\n\r\n", "closed_by": {"login": "jlogan03", "id": 1596770, "node_id": "MDQ6VXNlcjE1OTY3NzA=", "avatar_url": "https://avatars.githubusercontent.com/u/1596770?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jlogan03", "html_url": "https://github.com/jlogan03", "followers_url": "https://api.github.com/users/jlogan03/followers", "following_url": "https://api.github.com/users/jlogan03/following{/other_user}", "gists_url": "https://api.github.com/users/jlogan03/gists{/gist_id}", "starred_url": "https://api.github.com/users/jlogan03/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jlogan03/subscriptions", "organizations_url": "https://api.github.com/users/jlogan03/orgs", "repos_url": "https://api.github.com/users/jlogan03/repos", "events_url": "https://api.github.com/users/jlogan03/events{/privacy}", "received_events_url": "https://api.github.com/users/jlogan03/received_events", "type": "User", "site_admin": false}, "reactions": {"url": "https://api.github.com/repos/rust-lang/rust/issues/94230/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rust-lang/rust/issues/94230/timeline", "performed_via_github_app": null, "state_reason": "completed"}