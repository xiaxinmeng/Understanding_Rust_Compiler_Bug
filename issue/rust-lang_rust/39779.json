{"url": "https://api.github.com/repos/rust-lang/rust/issues/39779", "repository_url": "https://api.github.com/repos/rust-lang/rust", "labels_url": "https://api.github.com/repos/rust-lang/rust/issues/39779/labels{/name}", "comments_url": "https://api.github.com/repos/rust-lang/rust/issues/39779/comments", "events_url": "https://api.github.com/repos/rust-lang/rust/issues/39779/events", "html_url": "https://github.com/rust-lang/rust/issues/39779", "id": 207111805, "node_id": "MDU6SXNzdWUyMDcxMTE4MDU=", "number": 39779, "title": "ICE: OutputTypeParameterMismatch using HRTB + associated types", "user": {"login": "Rufflewind", "id": 6571068, "node_id": "MDQ6VXNlcjY1NzEwNjg=", "avatar_url": "https://avatars.githubusercontent.com/u/6571068?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Rufflewind", "html_url": "https://github.com/Rufflewind", "followers_url": "https://api.github.com/users/Rufflewind/followers", "following_url": "https://api.github.com/users/Rufflewind/following{/other_user}", "gists_url": "https://api.github.com/users/Rufflewind/gists{/gist_id}", "starred_url": "https://api.github.com/users/Rufflewind/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Rufflewind/subscriptions", "organizations_url": "https://api.github.com/users/Rufflewind/orgs", "repos_url": "https://api.github.com/users/Rufflewind/repos", "events_url": "https://api.github.com/users/Rufflewind/events{/privacy}", "received_events_url": "https://api.github.com/users/Rufflewind/received_events", "type": "User", "site_admin": false}, "labels": [], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 1, "created_at": "2017-02-13T03:05:25Z", "updated_at": "2017-05-22T21:02:50Z", "closed_at": "2017-05-22T21:02:50Z", "author_association": "CONTRIBUTOR", "active_lock_reason": null, "body": "This seems to [cause rustc to crash](https://is.gd/jEgny0) (link shows a slightly more complicated example than the reduced example below):\r\n\r\n~~~rust\r\ntrait Fun<'a> { type Output; }\r\n\r\nimpl<'a> Fun<'a> for () { type Output = &'a str; }\r\n\r\nfn with<F, G>(x: <F as Fun<'static>>::Output, g: G)\r\n    where F: for<'a> Fun<'a>,\r\n          G: for<'a> FnOnce(<F as Fun<'a>>::Output) {\r\n    g(x)\r\n}\r\n\r\nfn main() {\r\n    with::<(), _>(\"\", |_| ());\r\n}\r\n~~~\r\n\r\nIt looks like it forgot to normalize `<() as Fun<'a>>::Output` to `&'a str`?\r\n\r\n    error: internal compiler error:\r\n        src/librustc_trans/common.rs:473:\r\n        Encountered error\r\n            OutputTypeParameterMismatch(\r\n               Binder(<[closure] as FnOnce(<() as Fun<'a>>::Output))>,\r\n               Binder(<[closure] as FnOnce(&str))>,\r\n               Sorts(ExpectedFound {\r\n                   expected: &str,\r\n                   found: <() as Fun<'_>>::Output\r\n               })\r\n            )\r\n        selecting\r\n            Binder(<[closure] as FnOnce(&str)>)\r\n        during trans\r\n\r\n<details><summary>Crash log for 1.15.0-stable (10893a9a3 2017-01-19)</summary>\r\n\r\n```\r\nerror: internal compiler error: /buildslave/rust-buildbot/slave/nightly-dist-rustc-linux/build/src/librustc_trans/common.rs:473: Encountered error `OutputTypeParameterMismatch(Binder(<[closure@/tmp/bug.rs:12:23: 12:29] as std::ops::FnOnce<(<() as Fun<'a>>::Output,)>>), Binder(<[closure@/tmp/bug.rs:12:23: 12:29] as std::ops::FnOnce<(&str,)>>), Sorts(ExpectedFound { expected: &str, found: <() as Fun<'_>>::Output }))` selecting `Binder(<[closure@/tmp/bug.rs:12:23: 12:29] as std::ops::FnOnce<(&str,)>>)` during trans\r\n\r\nnote: the compiler unexpectedly panicked. this is a bug.\r\n\r\nnote: we would appreciate a bug report: https://github.com/rust-lang/rust/blob/master/CONTRIBUTING.md#bug-reports\r\n\r\nnote: run with `RUST_BACKTRACE=1` for a backtrace\r\n\r\nthread 'rustc' panicked at 'Box<Any>', /buildslave/rust-buildbot/slave/nightly-dist-rustc-linux/build/src/librustc_errors/lib.rs:376\r\nstack backtrace:\r\n   1:     0x7f867e11e52c - std::sys::imp::backtrace::tracing::imp::write::h1d59ca58eb86a1e2\r\n                        at /buildslave/rust-buildbot/slave/nightly-dist-rustc-linux/build/src/libstd/sys/unix/backtrace/tracing/gcc_s.rs:42\r\n   2:     0x7f867e12cb1e - std::panicking::default_hook::{{closure}}::hc8550e2dc230bf9b\r\n                        at /buildslave/rust-buildbot/slave/nightly-dist-rustc-linux/build/src/libstd/panicking.rs:351\r\n   3:     0x7f867e12c6c3 - std::panicking::default_hook::he85ae9e5c9867198\r\n                        at /buildslave/rust-buildbot/slave/nightly-dist-rustc-linux/build/src/libstd/panicking.rs:361\r\n   4:     0x7f867e12cfbb - std::panicking::rust_panic_with_hook::h319375f6b98710b0\r\n                        at /buildslave/rust-buildbot/slave/nightly-dist-rustc-linux/build/src/libstd/panicking.rs:555\r\n   5:     0x7f867ca6fa78 - std::panicking::begin_panic::hcffa9fd2a04ec06f\r\n   6:     0x7f867ca8d595 - rustc::session::opt_span_bug_fmt::{{closure}}::h614c6fe11c4465e9\r\n   7:     0x7f867ca8d3aa - rustc::session::span_bug_fmt::h8b2f72c913194199\r\n   8:     0x7f867cb02fa7 - rustc_trans::common::fulfill_obligation::{{closure}}::{{closure}}::h765609b5f897b16b\r\n   9:     0x7f867caff22c - rustc_trans::common::fulfill_obligation::h5accac95e8a401b5\r\n  10:     0x7f867cafb98b - rustc_trans::collector::do_static_dispatch::hce598ea3ab1ce3a5\r\n  11:     0x7f867cafb00d - <rustc_trans::collector::MirNeighborCollector<'a, 'tcx> as rustc::mir::visit::Visitor<'tcx>>::visit_operand::hd92120f4e6379a7e\r\n  12:     0x7f867cafb58a - <rustc_trans::collector::MirNeighborCollector<'a, 'tcx> as rustc::mir::visit::Visitor<'tcx>>::visit_terminator_kind::hccb2193f3818a450\r\n  13:     0x7f867ca88286 - rustc::mir::visit::Visitor::visit_mir::hfb8959f7b6b5ba95\r\n  14:     0x7f867cafd449 - rustc_trans::collector::collect_neighbours::he1db279e25d9c10d\r\n  15:     0x7f867caf9522 - rustc_trans::collector::collect_items_rec::hbbb361a730e6b0d3\r\n  16:     0x7f867caf9844 - rustc_trans::collector::collect_items_rec::hbbb361a730e6b0d3\r\n  17:     0x7f867cae64d8 - rustc_trans::base::collect_and_partition_translation_items::{{closure}}::h742429e3883a12cb\r\n  18:     0x7f867cae1bc2 - rustc_trans::base::collect_and_partition_translation_items::hac7e8bb398fe3219\r\n  19:     0x7f867cad4e52 - rustc_trans::base::trans_crate::hf153b22edafcd3f0\r\n  20:     0x7f867e4e0e80 - rustc_driver::driver::phase_4_translate_to_llvm::h6ba7de0cd156758c\r\n  21:     0x7f867e4ad282 - rustc_driver::driver::compile_input::{{closure}}::h40e96e4888acf56e\r\n  22:     0x7f867e4df551 - rustc_driver::driver::phase_3_run_analysis_passes::{{closure}}::hfacc2eff9ff79a87\r\n  23:     0x7f867e4bd516 - rustc_driver::driver::phase_3_run_analysis_passes::h40916decd3c5ea98\r\n  24:     0x7f867e4ab220 - rustc_driver::driver::compile_input::hce31fd38e3368b28\r\n  25:     0x7f867e4f5ba4 - rustc_driver::run_compiler::hf9be2d0376d35b2a\r\n  26:     0x7f867e401f1b - std::panicking::try::do_call::h996393a0ecaa9347\r\n  27:     0x7f867e135dfa - __rust_maybe_catch_panic\r\n                        at /buildslave/rust-buildbot/slave/nightly-dist-rustc-linux/build/src/libpanic_unwind/lib.rs:98\r\n  28:     0x7f867e42a292 - <F as alloc::boxed::FnBox<A>>::call_box::h70b5304598a75c7d\r\n  29:     0x7f867e12b974 - std::sys::imp::thread::Thread::new::thread_start::hc16926852e47c008\r\n                        at /buildslave/rust-buildbot/slave/nightly-dist-rustc-linux/build/src/liballoc/boxed.rs:623\r\n                        at /buildslave/rust-buildbot/slave/nightly-dist-rustc-linux/build/src/libstd/sys_common/thread.rs:21\r\n                        at /buildslave/rust-buildbot/slave/nightly-dist-rustc-linux/build/src/libstd/sys/unix/thread.rs:84\r\n  30:     0x7f8675f14453 - start_thread\r\n  31:     0x7f867ddee7de - __GI___clone\r\n  32:                0x0 - <unknown>\r\n```\r\n\r\n</details>\r\n\r\n<details><summary>Crash log for 1.17.0-nightly (c49d10207 2017-02-07)</summary>\r\n<pre><code>\r\n\r\n```\r\nerror: internal compiler error: /buildslave/rust-buildbot/slave/nightly-dist-rustc-linux/build/src/librustc_trans/common.rs:473: Encountered error `OutputTypeParameterMismatch(Binder(<[closure@/tmp/bug.rs:12:23: 12:29] as std::ops::FnOnce<(<() as Fun<'a>>::Output,)>>), Binder(<[closure@/tmp/bug.rs:12:23: 12:29] as std::ops::FnOnce<(&str,)>>), Sorts(ExpectedFound { expected: &str, found: <() as Fun<'_>>::Output }))` selecting `Binder(<[closure@/tmp/bug.rs:12:23: 12:29] as std::ops::FnOnce<(&str,)>>)` during trans\r\n\r\nnote: the compiler unexpectedly panicked. this is a bug.\r\n\r\nnote: we would appreciate a bug report: https://github.com/rust-lang/rust/blob/master/CONTRIBUTING.md#bug-reports\r\n\r\nnote: run with `RUST_BACKTRACE=1` for a backtrace\r\n\r\nthread 'rustc' panicked at 'Box<Any>', /buildslave/rust-buildbot/slave/nightly-dist-rustc-linux/build/src/librustc_errors/lib.rs:376\r\nstack backtrace:\r\n   1:     0x7f867e11e52c - std::sys::imp::backtrace::tracing::imp::write::h1d59ca58eb86a1e2\r\n                        at /buildslave/rust-buildbot/slave/nightly-dist-rustc-linux/build/src/libstd/sys/unix/backtrace/tracing/gcc_s.rs:42\r\n   2:     0x7f867e12cb1e - std::panicking::default_hook::{{closure}}::hc8550e2dc230bf9b\r\n                        at /buildslave/rust-buildbot/slave/nightly-dist-rustc-linux/build/src/libstd/panicking.rs:351\r\n   3:     0x7f867e12c6c3 - std::panicking::default_hook::he85ae9e5c9867198\r\n                        at /buildslave/rust-buildbot/slave/nightly-dist-rustc-linux/build/src/libstd/panicking.rs:361\r\n   4:     0x7f867e12cfbb - std::panicking::rust_panic_with_hook::h319375f6b98710b0\r\n                        at /buildslave/rust-buildbot/slave/nightly-dist-rustc-linux/build/src/libstd/panicking.rs:555\r\n   5:     0x7f867ca6fa78 - std::panicking::begin_panic::hcffa9fd2a04ec06f\r\n   6:     0x7f867ca8d595 - rustc::session::opt_span_bug_fmt::{{closure}}::h614c6fe11c4465e9\r\n   7:     0x7f867ca8d3aa - rustc::session::span_bug_fmt::h8b2f72c913194199\r\n   8:     0x7f867cb02fa7 - rustc_trans::common::fulfill_obligation::{{closure}}::{{closure}}::h765609b5f897b16b\r\n   9:     0x7f867caff22c - rustc_trans::common::fulfill_obligation::h5accac95e8a401b5\r\n  10:     0x7f867cafb98b - rustc_trans::collector::do_static_dispatch::hce598ea3ab1ce3a5\r\n  11:     0x7f867cafb00d - <rustc_trans::collector::MirNeighborCollector<'a, 'tcx> as rustc::mir::visit::Visitor<'tcx>>::visit_operand::hd92120f4e6379a7e\r\n  12:     0x7f867cafb58a - <rustc_trans::collector::MirNeighborCollector<'a, 'tcx> as rustc::mir::visit::Visitor<'tcx>>::visit_terminator_kind::hccb2193f3818a450\r\n  13:     0x7f867ca88286 - rustc::mir::visit::Visitor::visit_mir::hfb8959f7b6b5ba95\r\n  14:     0x7f867cafd449 - rustc_trans::collector::collect_neighbours::he1db279e25d9c10d\r\n  15:     0x7f867caf9522 - rustc_trans::collector::collect_items_rec::hbbb361a730e6b0d3\r\n  16:     0x7f867caf9844 - rustc_trans::collector::collect_items_rec::hbbb361a730e6b0d3\r\n  17:     0x7f867cae64d8 - rustc_trans::base::collect_and_partition_translation_items::{{closure}}::h742429e3883a12cb\r\n  18:     0x7f867cae1bc2 - rustc_trans::base::collect_and_partition_translation_items::hac7e8bb398fe3219\r\n  19:     0x7f867cad4e52 - rustc_trans::base::trans_crate::hf153b22edafcd3f0\r\n  20:     0x7f867e4e0e80 - rustc_driver::driver::phase_4_translate_to_llvm::h6ba7de0cd156758c\r\n  21:     0x7f867e4ad282 - rustc_driver::driver::compile_input::{{closure}}::h40e96e4888acf56e\r\n  22:     0x7f867e4df551 - rustc_driver::driver::phase_3_run_analysis_passes::{{closure}}::hfacc2eff9ff79a87\r\n  23:     0x7f867e4bd516 - rustc_driver::driver::phase_3_run_analysis_passes::h40916decd3c5ea98\r\n  24:     0x7f867e4ab220 - rustc_driver::driver::compile_input::hce31fd38e3368b28\r\n  25:     0x7f867e4f5ba4 - rustc_driver::run_compiler::hf9be2d0376d35b2a\r\n  26:     0x7f867e401f1b - std::panicking::try::do_call::h996393a0ecaa9347\r\n  27:     0x7f867e135dfa - __rust_maybe_catch_panic\r\n                        at /buildslave/rust-buildbot/slave/nightly-dist-rustc-linux/build/src/libpanic_unwind/lib.rs:98\r\n  28:     0x7f867e42a292 - <F as alloc::boxed::FnBox<A>>::call_box::h70b5304598a75c7d\r\n  29:     0x7f867e12b974 - std::sys::imp::thread::Thread::new::thread_start::hc16926852e47c008\r\n                        at /buildslave/rust-buildbot/slave/nightly-dist-rustc-linux/build/src/liballoc/boxed.rs:623\r\n                        at /buildslave/rust-buildbot/slave/nightly-dist-rustc-linux/build/src/libstd/sys_common/thread.rs:21\r\n                        at /buildslave/rust-buildbot/slave/nightly-dist-rustc-linux/build/src/libstd/sys/unix/thread.rs:84\r\n  30:     0x7f8675f14453 - start_thread\r\n  31:     0x7f867ddee7de - __GI___clone\r\n  32:                0x0 - <unknown>\r\n```\r\n\r\n</code></pre>\r\n</details>\r\n", "closed_by": {"login": "Mark-Simulacrum", "id": 5047365, "node_id": "MDQ6VXNlcjUwNDczNjU=", "avatar_url": "https://avatars.githubusercontent.com/u/5047365?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Mark-Simulacrum", "html_url": "https://github.com/Mark-Simulacrum", "followers_url": "https://api.github.com/users/Mark-Simulacrum/followers", "following_url": "https://api.github.com/users/Mark-Simulacrum/following{/other_user}", "gists_url": "https://api.github.com/users/Mark-Simulacrum/gists{/gist_id}", "starred_url": "https://api.github.com/users/Mark-Simulacrum/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Mark-Simulacrum/subscriptions", "organizations_url": "https://api.github.com/users/Mark-Simulacrum/orgs", "repos_url": "https://api.github.com/users/Mark-Simulacrum/repos", "events_url": "https://api.github.com/users/Mark-Simulacrum/events{/privacy}", "received_events_url": "https://api.github.com/users/Mark-Simulacrum/received_events", "type": "User", "site_admin": false}, "reactions": {"url": "https://api.github.com/repos/rust-lang/rust/issues/39779/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rust-lang/rust/issues/39779/timeline", "performed_via_github_app": null, "state_reason": "completed"}