{"url": "https://api.github.com/repos/rust-lang/rust/issues/28267", "repository_url": "https://api.github.com/repos/rust-lang/rust", "labels_url": "https://api.github.com/repos/rust-lang/rust/issues/28267/labels{/name}", "comments_url": "https://api.github.com/repos/rust-lang/rust/issues/28267/comments", "events_url": "https://api.github.com/repos/rust-lang/rust/issues/28267/events", "html_url": "https://github.com/rust-lang/rust/issues/28267", "id": 105068506, "node_id": "MDU6SXNzdWUxMDUwNjg1MDY=", "number": 28267, "title": "ICE returning arrays with length specified by an associated constant", "user": {"login": "dcrewi", "id": 1852207, "node_id": "MDQ6VXNlcjE4NTIyMDc=", "avatar_url": "https://avatars.githubusercontent.com/u/1852207?v=4", "gravatar_id": "", "url": "https://api.github.com/users/dcrewi", "html_url": "https://github.com/dcrewi", "followers_url": "https://api.github.com/users/dcrewi/followers", "following_url": "https://api.github.com/users/dcrewi/following{/other_user}", "gists_url": "https://api.github.com/users/dcrewi/gists{/gist_id}", "starred_url": "https://api.github.com/users/dcrewi/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/dcrewi/subscriptions", "organizations_url": "https://api.github.com/users/dcrewi/orgs", "repos_url": "https://api.github.com/users/dcrewi/repos", "events_url": "https://api.github.com/users/dcrewi/events{/privacy}", "received_events_url": "https://api.github.com/users/dcrewi/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 9618520, "node_id": "MDU6TGFiZWw5NjE4NTIw", "url": "https://api.github.com/repos/rust-lang/rust/labels/I-ICE", "name": "I-ICE", "color": "e10c02", "default": false, "description": "Issue: The compiler panicked, giving an Internal Compilation Error (ICE) \u2744\ufe0f"}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 9, "created_at": "2015-09-06T03:21:01Z", "updated_at": "2015-09-08T17:23:54Z", "closed_at": "2015-09-08T17:23:54Z", "author_association": "CONTRIBUTOR", "active_lock_reason": null, "body": "### code\n\n``` rust\n#![feature(associated_consts)]\n\ntrait Trait {\n    const SIZE: usize;\n}\n\npub fn cause_compiler_to_panic<T: Trait>() -> [u8; T::SIZE] {\n    unimplemented!()\n}\n\n```\n### compiler output\n\n```\n$ RUST_BACKTRACE=1 rustc --crate-type rlib compiler_panic.rs\nerror: internal compiler error: unexpected panic\nnote: the compiler unexpectedly panicked. this is a bug.\nnote: we would appreciate a bug report: https://github.com/rust-lang/rust/blob/master/CONTRIBUTING.md#bug-reports\nthread 'rustc' panicked at 'no path elem for NodeTyParam(TyParam { ident: T#0, id: 12, bounds: [TraitTyParamBound(PolyTraitRef { bound_lifetimes: [], trait_ref: TraitRef { path: path(Trait), ref_id: 13 }, span: compiler_panic.rs:15:35: 15:40 }, None)], default: None, span: compiler_panic.rs:15:32: 15:33 })', src/librustc/front/map/mod.rs:488\n\nstack backtrace:\n   1:     0x7f49381bbc99 - sys::backtrace::tracing::imp::write::hbc14f1d64893fa38REs\n   2:     0x7f49381c2946 - panicking::on_panic::h2f9a11502875a3547ox\n   3:     0x7f493818641e - rt::unwind::begin_unwind_inner::h9f15d88ec266cbe3DRw\n   4:     0x7f4938187167 - rt::unwind::begin_unwind_fmt::h7bb2b8a52c6074abJQw\n   5:     0x7f49360c9214 - front::map::Map<'ast>::get_path_elem::h810c6a17cb85afb1jeb\n   6:     0x7f493637aee7 - front::map::Map<'ast>::with_path_next::h6183113809238491628\n   7:     0x7f49362268f9 - middle::ty::ctxt<'tcx>::item_path_str::h29769059e7d6586b5Vb\n   8:     0x7f49362256bb - middle::def_id::DefId.fmt..Debug::fmt::h6e39007ab82770f3Oap\n   9:     0x7f4938232e65 - fmt::write::ha67db0db2f6a096ce8Q\n  10:     0x7f493820f7a0 - fmt::builders::DebugTuple<'a, 'b>::field::h2ce8d9f33236cafaDwQ\n  11:     0x7f49361b5115 - middle::def::Def...std..fmt..Debug::fmt::h938391f0b3e7112dsJn\n  12:     0x7f4938232e65 - fmt::write::ha67db0db2f6a096ce8Q\n  13:     0x7f493820f274 - fmt::builders::DebugStruct<'a, 'b>::field::haef609d3419cdbd2JrQ\n  14:     0x7f49362265b1 - fmt::_&'a T.Debug::fmt::h17657018559682767623\n  15:     0x7f4938232e65 - fmt::write::ha67db0db2f6a096ce8Q\n  16:     0x7f49381870ea - rt::unwind::begin_unwind_fmt::h7bb2b8a52c6074abJQw\n  17:     0x7f49361c70c5 - middle::const_eval::eval_const_expr_partial::hbec1acc1da716a81GTk\n  18:     0x7f493754f37c - astconv::ast_ty_to_ty::h7a1c0c0cca136ce6Cjx\n  19:     0x7f493759718d - astconv::convert_ty_with_lifetime_elision::h62c494c14aa9de2fthw\n  20:     0x7f493759fc8e - astconv::ty_of_method_or_bare_fn::hcabe6144b8119a6eHBx\n  21:     0x7f49375c1a60 - collect::type_scheme_of_item::he0f646ae1f45c0d9X9z\n  22:     0x7f49375b9e29 - collect::convert_typed_item::hed81c40d50d02aa4HeA\n  23:     0x7f49375a55ce - collect::convert_item::h415e2accc707fad518y\n  24:     0x7f49375a2577 - collect::collect_item_types::h2934ed33155c9781xky\n  25:     0x7f49375edc2b - check_crate::hfe64eeb39daabb000BE\n  26:     0x7f49386f027d - driver::phase_3_run_analysis_passes::closure.21698\n  27:     0x7f49386d28a3 - middle::ty::ctxt<'tcx>::create_and_enter::h17134548426382567756\n  28:     0x7f49386cdd7e - driver::phase_3_run_analysis_passes::h13764670269333747744\n  29:     0x7f49386ad6fd - driver::compile_input::h3c82c6370b45f42aYba\n  30:     0x7f49388154fb - run_compiler::h551ac01c07dc0a95eqc\n  31:     0x7f4938812e17 - boxed::F.FnBox<A>::call_box::h12386432182602546056\n  32:     0x7f4938812884 - rt::unwind::try::try_fn::h15469726732675206848\n  33:     0x7f49381c24e8 - __rust_try\n  34:     0x7f49381ae5e2 - rt::unwind::try::inner_try::h58375fb23cadeb38wNw\n  35:     0x7f4938812a18 - boxed::F.FnBox<A>::call_box::h11817215854212583186\n  36:     0x7f49381c1933 - sys::thread::Thread::new::thread_start::h255e2285f2cbfbcekXv\n  37:     0x7f49324c86a9 - start_thread\n  38:     0x7f4937e40eec - clone\n  39:                0x0 - <unknown>\n```\n### verbose compiler info\n\n```\n$ rustc --version --verbose\nrustc 1.4.0-dev (205c356ac 2015-09-05)\nbinary: rustc\ncommit-hash: 205c356ace559f511d5b7e51fd6b8c46bb4cc1ea\ncommit-date: 2015-09-05\nhost: x86_64-unknown-linux-gnu\nrelease: 1.4.0-dev\n```\n### other thoughts\n\nI would have expected the accepted way to write the array size would be `<T as Trait>::SIZE`, but that fails to compile with this error message:\n\n```\ncompiler_panic.rs:7:52: 7:70 error: array length constant evaluation error: non-constant path in constant expr [E0250]\ncompiler_panic.rs:7 pub fn cause_compiler_to_panic<T: Trait>() -> [u8; <T as Trait>::SIZE] {\n                                                                       ^~~~~~~~~~~~~~~~~~\ncompiler_panic.rs:7:52: 7:70 help: run `rustc --explain E0250` to see a detailed explanation\nerror: aborting due to previous error\n```\n", "closed_by": {"login": "alexcrichton", "id": 64996, "node_id": "MDQ6VXNlcjY0OTk2", "avatar_url": "https://avatars.githubusercontent.com/u/64996?v=4", "gravatar_id": "", "url": "https://api.github.com/users/alexcrichton", "html_url": "https://github.com/alexcrichton", "followers_url": "https://api.github.com/users/alexcrichton/followers", "following_url": "https://api.github.com/users/alexcrichton/following{/other_user}", "gists_url": "https://api.github.com/users/alexcrichton/gists{/gist_id}", "starred_url": "https://api.github.com/users/alexcrichton/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/alexcrichton/subscriptions", "organizations_url": "https://api.github.com/users/alexcrichton/orgs", "repos_url": "https://api.github.com/users/alexcrichton/repos", "events_url": "https://api.github.com/users/alexcrichton/events{/privacy}", "received_events_url": "https://api.github.com/users/alexcrichton/received_events", "type": "User", "site_admin": false}, "reactions": {"url": "https://api.github.com/repos/rust-lang/rust/issues/28267/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rust-lang/rust/issues/28267/timeline", "performed_via_github_app": null, "state_reason": "completed"}