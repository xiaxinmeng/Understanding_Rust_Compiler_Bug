{"url": "https://api.github.com/repos/rust-lang/rust/issues/10461", "repository_url": "https://api.github.com/repos/rust-lang/rust", "labels_url": "https://api.github.com/repos/rust-lang/rust/issues/10461/labels{/name}", "comments_url": "https://api.github.com/repos/rust-lang/rust/issues/10461/comments", "events_url": "https://api.github.com/repos/rust-lang/rust/issues/10461/events", "html_url": "https://github.com/rust-lang/rust/issues/10461", "id": 22595066, "node_id": "MDU6SXNzdWUyMjU5NTA2Ng==", "number": 10461, "title": "extra::workcache is not 100% re-entrant, but rustpkg acts like it is", "user": {"login": "pnkfelix", "id": 173127, "node_id": "MDQ6VXNlcjE3MzEyNw==", "avatar_url": "https://avatars.githubusercontent.com/u/173127?v=4", "gravatar_id": "", "url": "https://api.github.com/users/pnkfelix", "html_url": "https://github.com/pnkfelix", "followers_url": "https://api.github.com/users/pnkfelix/followers", "following_url": "https://api.github.com/users/pnkfelix/following{/other_user}", "gists_url": "https://api.github.com/users/pnkfelix/gists{/gist_id}", "starred_url": "https://api.github.com/users/pnkfelix/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/pnkfelix/subscriptions", "organizations_url": "https://api.github.com/users/pnkfelix/orgs", "repos_url": "https://api.github.com/users/pnkfelix/repos", "events_url": "https://api.github.com/users/pnkfelix/events{/privacy}", "received_events_url": "https://api.github.com/users/pnkfelix/received_events", "type": "User", "site_admin": false}, "labels": [], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 3, "created_at": "2013-11-13T14:40:05Z", "updated_at": "2014-04-20T14:59:08Z", "closed_at": "2014-04-20T14:59:08Z", "author_association": "MEMBER", "active_lock_reason": null, "body": "From what I can tell via my instrumentation of workcache.rs and rustpkg, it appears like the workcache will blithely overwrite the backing database file if you have two simultaneous instances with the same backing store.\n\nI should be clear here: If a client is _aware_ of this behavior, and does not assume anything about whether cache results survive from run to run, then maybe they will be fine.  (So whether or not the workcache is strictly speaking \"re-entrant\" depends on how strong a specification we are expected it to satisfy.)\n\nAs in, consider this order of events:\n\nNo initial file.  WC1 and WC1 will both be setup with the same non-existing path.\nWC1 starts; no file to load\nWC2 starts; no file to load\neach gathers its own local data\nWC2 dropped: it outputs its database\nWC1 dropped: it outputs its database, and overwrites WC2 results.\n\nThis means that you cannot treat the cache results as something you can rely upon being there.\n\nFrom what I can tell, one or more of the rustpkg tests has one invocation of rustpkg nested within another one, analogous to the WC1/WC2 outline above.\n\nI believe this, perhaps among other things, is what is causing tests::test_c_dependency_no_rebuilding to fail on my platform.\n", "closed_by": {"login": "jdm", "id": 27658, "node_id": "MDQ6VXNlcjI3NjU4", "avatar_url": "https://avatars.githubusercontent.com/u/27658?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jdm", "html_url": "https://github.com/jdm", "followers_url": "https://api.github.com/users/jdm/followers", "following_url": "https://api.github.com/users/jdm/following{/other_user}", "gists_url": "https://api.github.com/users/jdm/gists{/gist_id}", "starred_url": "https://api.github.com/users/jdm/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jdm/subscriptions", "organizations_url": "https://api.github.com/users/jdm/orgs", "repos_url": "https://api.github.com/users/jdm/repos", "events_url": "https://api.github.com/users/jdm/events{/privacy}", "received_events_url": "https://api.github.com/users/jdm/received_events", "type": "User", "site_admin": false}, "reactions": {"url": "https://api.github.com/repos/rust-lang/rust/issues/10461/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rust-lang/rust/issues/10461/timeline", "performed_via_github_app": null, "state_reason": "completed"}