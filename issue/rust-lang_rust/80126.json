{"url": "https://api.github.com/repos/rust-lang/rust/issues/80126", "repository_url": "https://api.github.com/repos/rust-lang/rust", "labels_url": "https://api.github.com/repos/rust-lang/rust/issues/80126/labels{/name}", "comments_url": "https://api.github.com/repos/rust-lang/rust/issues/80126/comments", "events_url": "https://api.github.com/repos/rust-lang/rust/issues/80126/events", "html_url": "https://github.com/rust-lang/rust/issues/80126", "id": 770241697, "node_id": "MDU6SXNzdWU3NzAyNDE2OTc=", "number": 80126, "title": "Opt-out of std linking system libraries", "user": {"login": "MarnixKuijs", "id": 44985093, "node_id": "MDQ6VXNlcjQ0OTg1MDkz", "avatar_url": "https://avatars.githubusercontent.com/u/44985093?v=4", "gravatar_id": "", "url": "https://api.github.com/users/MarnixKuijs", "html_url": "https://github.com/MarnixKuijs", "followers_url": "https://api.github.com/users/MarnixKuijs/followers", "following_url": "https://api.github.com/users/MarnixKuijs/following{/other_user}", "gists_url": "https://api.github.com/users/MarnixKuijs/gists{/gist_id}", "starred_url": "https://api.github.com/users/MarnixKuijs/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/MarnixKuijs/subscriptions", "organizations_url": "https://api.github.com/users/MarnixKuijs/orgs", "repos_url": "https://api.github.com/users/MarnixKuijs/repos", "events_url": "https://api.github.com/users/MarnixKuijs/events{/privacy}", "received_events_url": "https://api.github.com/users/MarnixKuijs/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 37547, "node_id": "MDU6TGFiZWwzNzU0Nw==", "url": "https://api.github.com/repos/rust-lang/rust/labels/A-linkage", "name": "A-linkage", "color": "f7e101", "default": false, "description": "Area: linking into static, shared libraries and binaries"}, {"id": 211668062, "node_id": "MDU6TGFiZWwyMTE2NjgwNjI=", "url": "https://api.github.com/repos/rust-lang/rust/labels/T-libs-api", "name": "T-libs-api", "color": "bfd4f2", "default": false, "description": "Relevant to the library API team, which will review and decide on the PR/issue."}, {"id": 630652267, "node_id": "MDU6TGFiZWw2MzA2NTIyNjc=", "url": "https://api.github.com/repos/rust-lang/rust/labels/C-feature-request", "name": "C-feature-request", "color": "f5f1fd", "default": false, "description": "Category: A feature request, i.e: not implemented / a PR."}], "state": "open", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 3, "created_at": "2020-12-17T17:39:41Z", "updated_at": "2020-12-18T03:33:02Z", "closed_at": null, "author_association": "NONE", "active_lock_reason": null, "body": "In `library/std/src/sys/windows/mod.rs` some libraries, for either uwp or win32, get linked. The block that follows these linking statements contain no declarations, so to me it seems that these libraries are just linked for the sake of linking them, but it doesn't look like anything depends on them.\r\n\r\n```rust\r\ncfg_if::cfg_if! {\r\n    if #[cfg(target_vendor = \"uwp\")] {\r\n        #[link(name = \"ws2_32\")]\r\n        // For BCryptGenRandom\r\n        #[link(name = \"bcrypt\")]\r\n        extern \"C\" {}\r\n    } else {\r\n        #[link(name = \"advapi32\")]\r\n        #[link(name = \"ws2_32\")]\r\n        #[link(name = \"userenv\")]\r\n        extern \"C\" {}\r\n    }\r\n}\r\n```  \r\n\r\nEven when `no-default-libraries` is set to true in a target config they are still getting linked. This is very unfortunate, because I have to make something that relies on `/NODEFAULTLIB` to exclude the linking of these libraries. The [commit](https://github.com/rust-lang/rust/commit/6f3872a14c73a74c55e0854641f4dfe5e3b7000e) that made this change was to clean up the build script. The build script where they got originally linked also didn't have a way to opt-out of them, but I would like to have a method to opt-out of the linking of these libs, so that I can provide my own set of windows libraries.", "closed_by": null, "reactions": {"url": "https://api.github.com/repos/rust-lang/rust/issues/80126/reactions", "total_count": 2, "+1": 2, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rust-lang/rust/issues/80126/timeline", "performed_via_github_app": null, "state_reason": null}