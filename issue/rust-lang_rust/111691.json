{"url": "https://api.github.com/repos/rust-lang/rust/issues/111691", "repository_url": "https://api.github.com/repos/rust-lang/rust", "labels_url": "https://api.github.com/repos/rust-lang/rust/issues/111691/labels{/name}", "comments_url": "https://api.github.com/repos/rust-lang/rust/issues/111691/comments", "events_url": "https://api.github.com/repos/rust-lang/rust/issues/111691/events", "html_url": "https://github.com/rust-lang/rust/issues/111691", "id": 1714519131, "node_id": "I_kwDOAAsO6M5mMXxb", "number": 111691, "title": "\"error[E0519]: the current crate is indistinguishable from one of its dependencies\" does not always accurately describe the problem", "user": {"login": "bridiver", "id": 34129, "node_id": "MDQ6VXNlcjM0MTI5", "avatar_url": "https://avatars.githubusercontent.com/u/34129?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bridiver", "html_url": "https://github.com/bridiver", "followers_url": "https://api.github.com/users/bridiver/followers", "following_url": "https://api.github.com/users/bridiver/following{/other_user}", "gists_url": "https://api.github.com/users/bridiver/gists{/gist_id}", "starred_url": "https://api.github.com/users/bridiver/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bridiver/subscriptions", "organizations_url": "https://api.github.com/users/bridiver/orgs", "repos_url": "https://api.github.com/users/bridiver/repos", "events_url": "https://api.github.com/users/bridiver/events{/privacy}", "received_events_url": "https://api.github.com/users/bridiver/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 235791, "node_id": "MDU6TGFiZWwyMzU3OTE=", "url": "https://api.github.com/repos/rust-lang/rust/labels/A-diagnostics", "name": "A-diagnostics", "color": "f7e101", "default": false, "description": "Area: Messages for errors, warnings, and lints"}, {"id": 13242248, "node_id": "MDU6TGFiZWwxMzI0MjI0OA==", "url": "https://api.github.com/repos/rust-lang/rust/labels/A-metadata", "name": "A-metadata", "color": "f7e101", "default": false, "description": "Area: crate metadata"}, {"id": 650731663, "node_id": "MDU6TGFiZWw2NTA3MzE2NjM=", "url": "https://api.github.com/repos/rust-lang/rust/labels/C-bug", "name": "C-bug", "color": "f5f1fd", "default": false, "description": "Category: This is a bug."}], "state": "open", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 4, "created_at": "2023-05-17T19:15:06Z", "updated_at": "2023-06-19T14:09:20Z", "closed_at": null, "author_association": "NONE", "active_lock_reason": null, "body": "We were seeing `error[E0519]: the current crate is indistinguishable from one of its dependencies` in our build and couldn't really make sense of it because it was complaining about things like `log` crate inside `html5ever`. It turns out that chromium added https://source.chromium.org/chromium/chromium/src/+/main:build/rust/cargo_crate.gni;l=102?q=rustc_metadata&ss=chromium\r\n```\r\n_rustc_metadata = \"\"\r\n  if (defined(invoker.rustc_metadata)) {\r\n    _rustc_metadata = invoker.rustc_metadata\r\n  } else if (defined(invoker.epoch)) {\r\n    _rustc_metadata = invoker.epoch\r\n  }\r\n```\r\nwhich defaults to using the epoch in `-Cmetadata=${_rustc_metadata}`\r\nIf you happen to have two different crates with the same symbol and same epoch (but different crate names), you'll get this error, but the description of the problem is confusing because it actually has nothing to do with crate names in this case `it has the same crate-name log and was compiled with the same -C metadata arguments` \r\nThe crate name appears to be irrelevant if you supply the same metadata arguments because we fixed it with this\r\n```\r\n_metadata = \"0\"\r\n  if (defined(invoker.epoch)) {\r\n    _metadata = invoker.epoch\r\n  }\r\n  if (defined(invoker.crate_name)) {\r\n    _metadata += invoker.crate_name\r\n  }\r\n```", "closed_by": null, "reactions": {"url": "https://api.github.com/repos/rust-lang/rust/issues/111691/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rust-lang/rust/issues/111691/timeline", "performed_via_github_app": null, "state_reason": null}