{"url": "https://api.github.com/repos/rust-lang/rust/issues/43141", "repository_url": "https://api.github.com/repos/rust-lang/rust", "labels_url": "https://api.github.com/repos/rust-lang/rust/issues/43141/labels{/name}", "comments_url": "https://api.github.com/repos/rust-lang/rust/issues/43141/comments", "events_url": "https://api.github.com/repos/rust-lang/rust/issues/43141/events", "html_url": "https://github.com/rust-lang/rust/issues/43141", "id": 241675999, "node_id": "MDU6SXNzdWUyNDE2NzU5OTk=", "number": 43141, "title": "Compile time regression", "user": {"login": "Boddlnagg", "id": 1024333, "node_id": "MDQ6VXNlcjEwMjQzMzM=", "avatar_url": "https://avatars.githubusercontent.com/u/1024333?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Boddlnagg", "html_url": "https://github.com/Boddlnagg", "followers_url": "https://api.github.com/users/Boddlnagg/followers", "following_url": "https://api.github.com/users/Boddlnagg/following{/other_user}", "gists_url": "https://api.github.com/users/Boddlnagg/gists{/gist_id}", "starred_url": "https://api.github.com/users/Boddlnagg/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Boddlnagg/subscriptions", "organizations_url": "https://api.github.com/users/Boddlnagg/orgs", "repos_url": "https://api.github.com/users/Boddlnagg/repos", "events_url": "https://api.github.com/users/Boddlnagg/events{/privacy}", "received_events_url": "https://api.github.com/users/Boddlnagg/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 234902, "node_id": "MDU6TGFiZWwyMzQ5MDI=", "url": "https://api.github.com/repos/rust-lang/rust/labels/C-enhancement", "name": "C-enhancement", "color": "f5f1fd", "default": false, "description": "Category: An issue proposing an enhancement or a PR with one."}, {"id": 64037154, "node_id": "MDU6TGFiZWw2NDAzNzE1NA==", "url": "https://api.github.com/repos/rust-lang/rust/labels/I-compiletime", "name": "I-compiletime", "color": "e11d21", "default": false, "description": "Problems and improvements with respect to compile times."}, {"id": 203429200, "node_id": "MDU6TGFiZWwyMDM0MjkyMDA=", "url": "https://api.github.com/repos/rust-lang/rust/labels/P-high", "name": "P-high", "color": "eb6420", "default": false, "description": "High priority"}, {"id": 211668100, "node_id": "MDU6TGFiZWwyMTE2NjgxMDA=", "url": "https://api.github.com/repos/rust-lang/rust/labels/T-compiler", "name": "T-compiler", "color": "bfd4f2", "default": false, "description": "Relevant to the compiler team, which will review and decide on the PR/issue."}, {"id": 262252840, "node_id": "MDU6TGFiZWwyNjIyNTI4NDA=", "url": "https://api.github.com/repos/rust-lang/rust/labels/regression-from-stable-to-stable", "name": "regression-from-stable-to-stable", "color": "e4008a", "default": false, "description": "Performance or correctness regression from one stable version to another."}], "state": "closed", "locked": false, "assignee": {"login": "arielb1", "id": 1830974, "node_id": "MDQ6VXNlcjE4MzA5NzQ=", "avatar_url": "https://avatars.githubusercontent.com/u/1830974?v=4", "gravatar_id": "", "url": "https://api.github.com/users/arielb1", "html_url": "https://github.com/arielb1", "followers_url": "https://api.github.com/users/arielb1/followers", "following_url": "https://api.github.com/users/arielb1/following{/other_user}", "gists_url": "https://api.github.com/users/arielb1/gists{/gist_id}", "starred_url": "https://api.github.com/users/arielb1/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/arielb1/subscriptions", "organizations_url": "https://api.github.com/users/arielb1/orgs", "repos_url": "https://api.github.com/users/arielb1/repos", "events_url": "https://api.github.com/users/arielb1/events{/privacy}", "received_events_url": "https://api.github.com/users/arielb1/received_events", "type": "User", "site_admin": false}, "assignees": [{"login": "arielb1", "id": 1830974, "node_id": "MDQ6VXNlcjE4MzA5NzQ=", "avatar_url": "https://avatars.githubusercontent.com/u/1830974?v=4", "gravatar_id": "", "url": "https://api.github.com/users/arielb1", "html_url": "https://github.com/arielb1", "followers_url": "https://api.github.com/users/arielb1/followers", "following_url": "https://api.github.com/users/arielb1/following{/other_user}", "gists_url": "https://api.github.com/users/arielb1/gists{/gist_id}", "starred_url": "https://api.github.com/users/arielb1/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/arielb1/subscriptions", "organizations_url": "https://api.github.com/users/arielb1/orgs", "repos_url": "https://api.github.com/users/arielb1/repos", "events_url": "https://api.github.com/users/arielb1/events{/privacy}", "received_events_url": "https://api.github.com/users/arielb1/received_events", "type": "User", "site_admin": false}], "milestone": null, "comments": 15, "created_at": "2017-07-10T11:04:01Z", "updated_at": "2017-08-08T14:39:36Z", "closed_at": "2017-08-08T14:39:36Z", "author_association": "CONTRIBUTOR", "active_lock_reason": null, "body": "There was a major compile time (and memory consumption) regression when I compare building [winrt-rust](https://github.com/contextfree/winrt-rust/tree/beb10a5b586b259d16b110a5116e4dd71fe5f0a9) on Rust 1.18 stable and current 1.20 nightly. (I couldn't test on beta because `error: the option `Z` is only accepted on the nightly compiler`.)\r\n\r\n<details> \r\n  <summary>rustc 1.18.0 (03fc9d622 2017-06-06): 137.31 secs, 2873 MB peak memory</summary>\r\n\r\n   ```\r\n   Compiling winrt v0.2.1 (file:///D:/Code/Rust/winrt-rust)\r\nwarning: the option `Z` is unstable and should only be used on the nightly compiler, but it is currently accepted for backwards compatibility; this will soon change, see issue #31847 for more details\r\n\r\ntime: 2.145; rss: 449MB parsing\r\ntime: 0.000; rss: 449MB recursion limit\r\ntime: 0.000; rss: 449MB crate injection\r\ntime: 0.000; rss: 449MB plugin loading\r\ntime: 0.000; rss: 449MB plugin registration\r\ntime: 12.711; rss: 808MB        expansion\r\ntime: 0.000; rss: 808MB maybe building test harness\r\ntime: 0.129; rss: 808MB maybe creating a macro crate\r\ntime: 0.000; rss: 808MB checking for inline asm in case the target doesn't support it\r\ntime: 0.537; rss: 808MB early lint checks\r\ntime: 0.158; rss: 808MB AST validation\r\ntime: 1.477; rss: 935MB name resolution\r\ntime: 0.710; rss: 935MB complete gated feature checking\r\ntime: 2.102; rss: 1453MB        lowering ast -> hir\r\ntime: 0.642; rss: 1361MB        indexing hir\r\ntime: 0.142; rss: 1361MB        attribute checking\r\ntime: 0.088; rss: 948MB language item collection\r\ntime: 0.451; rss: 954MB lifetime resolution\r\ntime: 0.000; rss: 954MB looking for entry point\r\ntime: 0.004; rss: 954MB looking for plugin registrar\r\ntime: 0.858; rss: 1095MB        region resolution\r\ntime: 0.194; rss: 1095MB        loop checking\r\ntime: 0.102; rss: 1095MB        static item recursion checking\r\ntime: 1.601; rss: 1110MB        compute_incremental_hashes_map\r\ntime: 0.000; rss: 1110MB        load_dep_graph\r\ntime: 0.248; rss: 1110MB        stability index\r\ntime: 0.437; rss: 1123MB        stability checking\r\ntime: 1.905; rss: 1292MB        type collecting\r\ntime: 0.122; rss: 1293MB        variance inference\r\ntime: 0.236; rss: 1307MB        impl wf inference\r\ntime: 3.658; rss: 1328MB        coherence checking\r\ntime: 8.390; rss: 1419MB        wf checking\r\ntime: 5.613; rss: 1477MB        item-types checking\r\ntime: 48.962; rss: 2098MB       item-bodies checking\r\ntime: 3.430; rss: 2164MB        const checking\r\ntime: 2.696; rss: 2174MB        privacy checking\r\ntime: 0.700; rss: 2174MB        intrinsic checking\r\ntime: 0.257; rss: 2174MB        effect checking\r\ntime: 0.880; rss: 2175MB        match checking\r\ntime: 0.513; rss: 2175MB        liveness checking\r\ntime: 3.851; rss: 2589MB        MIR dump\r\n  time: 0.499; rss: 2645MB      SimplifyCfg\r\n  time: 1.689; rss: 2645MB      TypeckMir\r\n  time: 1.294; rss: 2648MB      QualifyAndPromoteConstants\r\n  time: 0.087; rss: 2648MB      SimplifyBranches\r\n  time: 0.344; rss: 2648MB      SimplifyCfg\r\ntime: 3.914; rss: 2648MB        MIR cleanup and validation\r\ntime: 5.023; rss: 2655MB        borrow checking\r\ntime: 0.471; rss: 2662MB        reachability checking\r\ntime: 1.121; rss: 2662MB        death checking\r\ntime: 0.000; rss: 2662MB        unused lib feature checking\r\ntime: 3.540; rss: 2662MB        lint checking\r\ntime: 0.000; rss: 2662MB        resolving dependency formats\r\n  time: 0.085; rss: 2662MB      NoLandingPads\r\n  time: 0.349; rss: 2662MB      SimplifyCfg\r\n  time: 0.579; rss: 2677MB      EraseRegions\r\n  time: 0.168; rss: 2677MB      AddCallGuards\r\n  time: 1.869; rss: 2679MB      ElaborateDrops\r\n  time: 0.084; rss: 2679MB      NoLandingPads\r\n  time: 0.388; rss: 2679MB      SimplifyCfg\r\n  time: 0.000; rss: 2679MB      Inline\r\n  time: 0.307; rss: 2679MB      InstCombine\r\n  time: 0.533; rss: 2679MB      Deaggregator\r\n  time: 0.100; rss: 2679MB      CopyPropagation\r\n  time: 0.357; rss: 2681MB      SimplifyLocals\r\n  time: 0.168; rss: 2681MB      AddCallGuards\r\n  time: 0.093; rss: 2681MB      PreTrans\r\ntime: 5.084; rss: 2681MB        MIR optimisations\r\n  time: 2.501; rss: 2802MB      write metadata\r\n  time: 0.991; rss: 2831MB      translation item collection\r\n  time: 0.115; rss: 2873MB      codegen unit partitioning\r\n  time: 0.134; rss: 2866MB      internalize symbols\r\ntime: 6.013; rss: 2836MB        translation\r\ntime: 0.000; rss: 2836MB        assert dep graph\r\ntime: 0.000; rss: 2836MB        serialize dep graph\r\n  time: 0.204; rss: 357MB       llvm function passes [0]\r\n  time: 1.705; rss: 361MB       llvm module passes [0]\r\n  time: 1.634; rss: 371MB       codegen passes [0]\r\n  time: 0.002; rss: 371MB       codegen passes [0]\r\ntime: 3.600; rss: 371MB LLVM passes\r\ntime: 0.000; rss: 371MB serialize work products\r\ntime: 0.639; rss: 358MB linking\r\n    Finished release [optimized] target(s) in 137.31 secs\r\n```\r\n</details>\r\n\r\n<details> \r\n  <summary>rustc 1.20.0-nightly (d84693b93 2017-07-09): 262.64 secs, 3346 MB peak memory</summary>\r\n\r\n   ```\r\n   Compiling winrt v0.2.1 (file:///D:/Code/Rust/winrt-rust)\r\ntime: 2.448; rss: 449MB parsing\r\ntime: 0.000; rss: 449MB recursion limit\r\ntime: 0.000; rss: 449MB crate injection\r\ntime: 0.000; rss: 449MB plugin loading\r\ntime: 0.000; rss: 449MB plugin registration\r\ntime: 12.485; rss: 782MB        expansion\r\ntime: 0.000; rss: 782MB maybe building test harness\r\ntime: 0.142; rss: 782MB maybe creating a macro crate\r\ntime: 0.593; rss: 782MB creating allocators\r\ntime: 0.000; rss: 782MB checking for inline asm in case the target doesn't support it\r\ntime: 0.602; rss: 782MB early lint checks\r\ntime: 0.162; rss: 782MB AST validation\r\ntime: 2.673; rss: 982MB name resolution\r\ntime: 0.825; rss: 982MB complete gated feature checking\r\ntime: 2.580; rss: 1538MB        lowering ast -> hir\r\ntime: 0.728; rss: 1391MB        indexing hir\r\ntime: 0.166; rss: 1391MB        attribute checking\r\ntime: 0.105; rss: 964MB language item collection\r\ntime: 0.536; rss: 971MB lifetime resolution\r\ntime: 0.000; rss: 971MB looking for entry point\r\ntime: 0.005; rss: 971MB looking for plugin registrar\r\ntime: 0.228; rss: 971MB loop checking\r\ntime: 0.124; rss: 971MB static item recursion checking\r\ntime: 1.963; rss: 986MB compute_incremental_hashes_map\r\ntime: 0.000; rss: 986MB load_dep_graph\r\ntime: 0.271; rss: 987MB stability index\r\ntime: 0.490; rss: 1000MB        stability checking\r\ntime: 2.389; rss: 1163MB        type collecting\r\ntime: 0.327; rss: 1178MB        impl wf inference\r\ntime: 5.498; rss: 1195MB        coherence checking\r\ntime: 0.042; rss: 1195MB        variance testing\r\ntime: 96.245; rss: 1580MB       wf checking\r\ntime: 6.401; rss: 1634MB        item-types checking\r\ntime: 52.552; rss: 2229MB       item-bodies checking\r\ntime: 9.095; rss: 2350MB        const checking\r\ntime: 4.262; rss: 2360MB        privacy checking\r\ntime: 0.352; rss: 2363MB        intrinsic checking\r\ntime: 0.364; rss: 2363MB        effect checking\r\ntime: 0.638; rss: 2363MB        match checking\r\ntime: 0.607; rss: 2363MB        liveness checking\r\ntime: 15.272; rss: 3014MB       borrow checking\r\ntime: 0.499; rss: 3022MB        reachability checking\r\ntime: 1.118; rss: 3023MB        death checking\r\ntime: 0.000; rss: 3023MB        unused lib feature checking\r\ntime: 6.384; rss: 3023MB        lint checking\r\ntime: 0.000; rss: 3023MB        resolving dependency formats\r\n  time: 21.937; rss: 3226MB     write metadata\r\n  time: 1.238; rss: 3254MB      translation item collection\r\n  time: 0.119; rss: 3309MB      codegen unit partitioning\r\n  time: 0.187; rss: 3346MB      internalize symbols\r\ntime: 26.257; rss: 3338MB       translation\r\ntime: 0.000; rss: 3338MB        assert dep graph\r\ntime: 0.000; rss: 3338MB        serialize dep graph\r\n  time: 0.003; rss: 430MB       codegen passes [0]\r\n  time: 0.226; rss: 432MB       llvm function passes [1]\r\n  time: 1.994; rss: 436MB       llvm module passes [1]\r\n  time: 1.853; rss: 445MB       codegen passes [1]\r\ntime: 4.135; rss: 445MB LLVM passes\r\ntime: 0.000; rss: 445MB serialize work products\r\ntime: 0.597; rss: 431MB linking\r\n    Finished release [optimized] target(s) in 262.64 secs\r\n```\r\n</details>&nbsp;\r\n\r\nwinrt-rust certainly is a rather exotic crate in that it mainly consists of a > 200k LOC generated file that wraps Windows COM APIs, but something seems to be wrong here, especially in the `wf checking` pass, which went from 8.4 seconds to 96.2 seconds.\r\n\r\nTo reproduce the numbers, you can run `cargo rustc --release --features all -- -Z time-passes` (`--features all` is important, otherwise only part of the crate is being built).", "closed_by": {"login": "bors", "id": 3372342, "node_id": "MDQ6VXNlcjMzNzIzNDI=", "avatar_url": "https://avatars.githubusercontent.com/u/3372342?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors", "html_url": "https://github.com/bors", "followers_url": "https://api.github.com/users/bors/followers", "following_url": "https://api.github.com/users/bors/following{/other_user}", "gists_url": "https://api.github.com/users/bors/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors/subscriptions", "organizations_url": "https://api.github.com/users/bors/orgs", "repos_url": "https://api.github.com/users/bors/repos", "events_url": "https://api.github.com/users/bors/events{/privacy}", "received_events_url": "https://api.github.com/users/bors/received_events", "type": "User", "site_admin": false}, "reactions": {"url": "https://api.github.com/repos/rust-lang/rust/issues/43141/reactions", "total_count": 2, "+1": 0, "-1": 0, "laugh": 1, "hooray": 0, "confused": 1, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rust-lang/rust/issues/43141/timeline", "performed_via_github_app": null, "state_reason": "completed"}