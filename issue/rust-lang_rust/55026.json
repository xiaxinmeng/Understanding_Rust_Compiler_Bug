{"url": "https://api.github.com/repos/rust-lang/rust/issues/55026", "repository_url": "https://api.github.com/repos/rust-lang/rust", "labels_url": "https://api.github.com/repos/rust-lang/rust/issues/55026/labels{/name}", "comments_url": "https://api.github.com/repos/rust-lang/rust/issues/55026/comments", "events_url": "https://api.github.com/repos/rust-lang/rust/issues/55026/events", "html_url": "https://github.com/rust-lang/rust/issues/55026", "id": 369755504, "node_id": "MDU6SXNzdWUzNjk3NTU1MDQ=", "number": 55026, "title": "'error[E0405]: cannot find trait 'trait_name' in the crate root' while custom a derive", "user": {"login": "fpcsong", "id": 8133070, "node_id": "MDQ6VXNlcjgxMzMwNzA=", "avatar_url": "https://avatars.githubusercontent.com/u/8133070?v=4", "gravatar_id": "", "url": "https://api.github.com/users/fpcsong", "html_url": "https://github.com/fpcsong", "followers_url": "https://api.github.com/users/fpcsong/followers", "following_url": "https://api.github.com/users/fpcsong/following{/other_user}", "gists_url": "https://api.github.com/users/fpcsong/gists{/gist_id}", "starred_url": "https://api.github.com/users/fpcsong/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/fpcsong/subscriptions", "organizations_url": "https://api.github.com/users/fpcsong/orgs", "repos_url": "https://api.github.com/users/fpcsong/repos", "events_url": "https://api.github.com/users/fpcsong/events{/privacy}", "received_events_url": "https://api.github.com/users/fpcsong/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 941498014, "node_id": "MDU6TGFiZWw5NDE0OTgwMTQ=", "url": "https://api.github.com/repos/rust-lang/rust/labels/A-macros-1.2", "name": "A-macros-1.2", "color": "f7e101", "default": false, "description": "Issues which affect macros 1.2"}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 4, "created_at": "2018-10-13T01:46:48Z", "updated_at": "2018-10-30T04:29:15Z", "closed_at": "2018-10-30T04:29:15Z", "author_association": "NONE", "active_lock_reason": null, "body": "I write a test on costom derives with rust version  **rustc 1.31.0-nightly (77af31408 2018-10-11)**, here is my project structure:\r\n```\r\n\u251c\u2500\u2500 countable_macro\r\n\u2502   \u251c\u2500\u2500 Cargo.toml\r\n\u2502   \u2514\u2500\u2500 src\r\n\u2502       \u2514\u2500\u2500 lib.rs\r\n\u251c\u2500\u2500 countable_trait\r\n\u2502   \u251c\u2500\u2500 Cargo.toml\r\n\u2502   \u2514\u2500\u2500 src\r\n\u2502       \u2514\u2500\u2500 lib.rs\r\n\u2514\u2500\u2500 test_macro\r\n    \u251c\u2500\u2500 Cargo.lock\r\n    \u251c\u2500\u2500 Cargo.toml\r\n    \u2514\u2500\u2500 src\r\n        \u2514\u2500\u2500 main.rs\r\n```\r\ndependencies was set correctly so that I can call function in **countablr_trait/src/lib.rs** in **test_macro/src/main.rs**, and I can compile **countable_macro** correctly, but when I try to derive a trait in **countablr_trait/src/lib.rs**, I got a error \"cannot find trait `Countable` in the crate root'\".\r\n**countable_macro/src/lib.rs**\r\n```rust\r\nextern crate proc_macro;\r\nextern crate syn;\r\n#[macro_use]\r\nextern crate quote;\r\nuse crate::proc_macro::TokenStream;\r\n\r\n#[proc_macro_derive(Countable)]\r\npub fn summable_fields(input: TokenStream) -> TokenStream {\r\n    let ast = syn::parse(input).unwrap();\r\n    let expanded = expand_summable_fields(&ast);\r\n    expanded\r\n}\r\nfn expand_summable_fields(ast: &syn::DeriveInput) -> TokenStream {\r\n    \r\n    let n = ast.attrs.len();\r\n    let name = &ast.ident;\r\n    let (impl_generics, ty_generics, where_clause) = ast.generics.split_for_impl();\r\n    let gen = quote! {\r\n        impl #impl_generics ::Countable for #name #ty_generics #where_clause {\r\n            fn count_fields(&self) -> usize {\r\n                #n\r\n            }\r\n        }\r\n    };\r\n    gen.into()\r\n}\r\n\r\n```\r\n\r\n**countable_trait/src/lib.rs**\r\n```rust\r\npub trait Countable {\r\n\tfn count_fields(&self) -> usize;\r\n}\r\npub fn add_one(x : i32)->i32{\r\n    x+1\r\n}\r\n```\r\n**test_macro/src/main.rs**\r\n```rust\r\n#![feature(proc_macro)]\r\n#[macro_use]\r\nextern crate countable_macro;\r\nextern crate countable_trait;\r\nuse countable_trait::Countable;\r\n\r\n#[derive(Countable)]\r\nstruct S1 {\r\n    x: u32,\r\n    y: u8,\r\n}\r\n#[derive(Countable)]\r\nstruct S2 {\r\n    s: String,\r\n    x: u64,\r\n    y: i64,\r\n}\r\n#[derive(Countable)]\r\nstruct S3 {\r\n    s: String,\r\n}\r\nfn main() {\r\n    countable_trait::add_one(4);\r\n    let s1 = S1 { x: 32, y: 8 };\r\n    let s2 = S2 {\r\n        s: \"test\".into(),\r\n        x: 1,\r\n        y: 2,\r\n    };\r\n    let s3 = S3 { s: \"test3\".into() };\r\n}\r\n\r\n```\r\n\r\nbuild got error:\r\n```\r\nerror[E0405]: cannot find trait `Countable` in the crate root\r\n --> src/main.rs:7:10\r\n  |\r\n7 | #[derive(Countable)]\r\n  |          ^^^^^^^^^ not found in the crate root\r\nhelp: possible candidate is found in another module, you can import it into scope\r\n  |\r\n5 | use countable_trait::Countable;\r\n  |\r\n\r\n```", "closed_by": {"login": "fpcsong", "id": 8133070, "node_id": "MDQ6VXNlcjgxMzMwNzA=", "avatar_url": "https://avatars.githubusercontent.com/u/8133070?v=4", "gravatar_id": "", "url": "https://api.github.com/users/fpcsong", "html_url": "https://github.com/fpcsong", "followers_url": "https://api.github.com/users/fpcsong/followers", "following_url": "https://api.github.com/users/fpcsong/following{/other_user}", "gists_url": "https://api.github.com/users/fpcsong/gists{/gist_id}", "starred_url": "https://api.github.com/users/fpcsong/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/fpcsong/subscriptions", "organizations_url": "https://api.github.com/users/fpcsong/orgs", "repos_url": "https://api.github.com/users/fpcsong/repos", "events_url": "https://api.github.com/users/fpcsong/events{/privacy}", "received_events_url": "https://api.github.com/users/fpcsong/received_events", "type": "User", "site_admin": false}, "reactions": {"url": "https://api.github.com/repos/rust-lang/rust/issues/55026/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rust-lang/rust/issues/55026/timeline", "performed_via_github_app": null, "state_reason": "completed"}