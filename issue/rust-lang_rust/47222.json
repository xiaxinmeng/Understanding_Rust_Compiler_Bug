{"url": "https://api.github.com/repos/rust-lang/rust/issues/47222", "repository_url": "https://api.github.com/repos/rust-lang/rust", "labels_url": "https://api.github.com/repos/rust-lang/rust/issues/47222/labels{/name}", "comments_url": "https://api.github.com/repos/rust-lang/rust/issues/47222/comments", "events_url": "https://api.github.com/repos/rust-lang/rust/issues/47222/events", "html_url": "https://github.com/rust-lang/rust/issues/47222", "id": 286370759, "node_id": "MDU6SXNzdWUyODYzNzA3NTk=", "number": 47222, "title": "Incremental compilation + case insensitive filesystems == sadness", "user": {"login": "alexcrichton", "id": 64996, "node_id": "MDQ6VXNlcjY0OTk2", "avatar_url": "https://avatars.githubusercontent.com/u/64996?v=4", "gravatar_id": "", "url": "https://api.github.com/users/alexcrichton", "html_url": "https://github.com/alexcrichton", "followers_url": "https://api.github.com/users/alexcrichton/followers", "following_url": "https://api.github.com/users/alexcrichton/following{/other_user}", "gists_url": "https://api.github.com/users/alexcrichton/gists{/gist_id}", "starred_url": "https://api.github.com/users/alexcrichton/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/alexcrichton/subscriptions", "organizations_url": "https://api.github.com/users/alexcrichton/orgs", "repos_url": "https://api.github.com/users/alexcrichton/repos", "events_url": "https://api.github.com/users/alexcrichton/events{/privacy}", "received_events_url": "https://api.github.com/users/alexcrichton/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 211668100, "node_id": "MDU6TGFiZWwyMTE2NjgxMDA=", "url": "https://api.github.com/repos/rust-lang/rust/labels/T-compiler", "name": "T-compiler", "color": "bfd4f2", "default": false, "description": "Relevant to the compiler team, which will review and decide on the PR/issue."}, {"id": 307747675, "node_id": "MDU6TGFiZWwzMDc3NDc2NzU=", "url": "https://api.github.com/repos/rust-lang/rust/labels/A-incr-comp", "name": "A-incr-comp", "color": "f7e101", "default": false, "description": "Area: Incremental compilation"}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 9, "created_at": "2018-01-05T18:41:54Z", "updated_at": "2018-01-10T15:45:14Z", "closed_at": "2018-01-10T15:06:29Z", "author_association": "MEMBER", "active_lock_reason": null, "body": "Given this code\r\n\r\n```rust\r\nmod a { pub fn foo() {} }\r\nmod A { pub fn foo() {} }\r\n\r\npub fn main() {\r\n    a::foo();\r\n    A::foo();\r\n}\r\n```\r\n\r\nwhen compiled on (for example) Windows:\r\n\r\n```\r\n$ rustc +nightly -C incremental=incr foo.rs --crate-type rlib\r\nwarning: module `A` should have a snake case name such as `a`\r\n --> foo.rs:2:1\r\n  |\r\n2 | mod A { pub fn foo() {} }\r\n  | ^^^^^^^^^^^^^^^^^^^^^^^^^\r\n  |\r\n  = note: #[warn(non_snake_case)] on by default\r\n\r\nerror: failed to remove foo.foo-a.rcgu.o: The system cannot find the file specified. (os error 2)\r\n\r\nerror: failed to remove foo.foo-a.rcgu.bytecode.encoded: The system cannot find the file specified. (os error 2)\r\n\r\nwarning: Error finalizing incremental compilation session directory `\\\\?\\C:\\msys64\\home\\alex\\incr\\foo-2274d9nt8ooh9\\s-ex32xyt5c1-1f7ubw8-working`: The system cannot find the file specified. (os error 2)\r\n\r\nerror: internal compiler error: unexpected panic\r\n\r\nnote: the compiler unexpectedly panicked. this is a bug.\r\n\r\nnote: we would appreciate a bug report: https://github.com/rust-lang/rust/blob/master/CONTRIBUTING.md#bug-reports\r\n\r\nnote: rustc 1.24.0-nightly (0a3761e63 2018-01-03) running on x86_64-pc-windows-msvc\r\n\r\nthread 'rustc' panicked at 'src\\librustc\\session\\mod.rs:645: Trying to invalidate IncrCompSession `InvalidBecauseOfErrors { session_directory: \"\\\\\\\\?\\\\C:\\\\msys64\\\\home\\\\alex\\\\incr\\\\foo-2274d9nt8ooh9\\\\s-ex32xyt5c1-1f7ubw8-working\" }`', src\\librustc\\session\\mod.rs:1130:26\r\nnote: Run with `RUST_BACKTRACE=1` for a backtrace.\r\n```\r\n\r\nI'll be fixing the ICE as part of https://github.com/rust-lang/rust/pull/47141 as it's preventing it from landing (the ICE isn't really the issue here anyway, it's the \"failed to remove\" business). This is also a serious problem for linking artifacts!\r\n\r\n\r\n```\r\n$ rustc +nightly -C incremental=incr foo.rs\r\nwarning: module `A` should have a snake case name such as `a`\r\n --> foo.rs:2:1\r\n  |\r\n2 | mod A { pub fn foo() {} }\r\n  | ^^^^^^^^^^^^^^^^^^^^^^^^^\r\n  |\r\n  = note: #[warn(non_snake_case)] on by default\r\n\r\nerror: linking with `link.exe` failed: exit code: 1120\r\n  |\r\n  = note: \"C:\\\\Program Files (x86)\\\\Microsoft Visual Studio\\\\2017\\\\Community\\\\VC\\\\Tools\\\\MSVC\\\\14.10.25017\\\\bin\\\\HostX64\\\\x64\\\\link.exe\" \"/NOLOGO\" \"/NXCOMPAT\" \"/LIBPATH:C:\\\\Users\\\\alex\\\\.rustup\\\\toolchains\\\\nightly-x86_64-pc-windows-msvc\\\\lib\\\\rustlib\\\\x86_64-pc-windows-msvc\\\\lib\" \"foo.__rustc_fallback_codegen_unit.rcgu.o\" \"foo.foo.rcgu.o\" \"foo.foo-A.rcgu.o\" \"foo.foo-a.rcgu.o\" \"foo.std-rt.volatile.rcgu.o\" \"/OUT:foo.exe\" \"foo.crate.allocator.rcgu.o\" \"/OPT:REF,NOICF\" \"/DEBUG\" \"/NATVIS:C:\\\\Users\\\\alex\\\\.rustup\\\\toolchains\\\\nightly-x86_64-pc-windows-msvc\\\\lib\\\\rustlib\\\\etc\\\\intrinsic.natvis\" \"/NATVIS:C:\\\\Users\\\\alex\\\\.rustup\\\\toolchains\\\\nightly-x86_64-pc-windows-msvc\\\\lib\\\\rustlib\\\\etc\\\\liballoc.natvis\" \"/NATVIS:C:\\\\Users\\\\alex\\\\.rustup\\\\toolchains\\\\nightly-x86_64-pc-windows-msvc\\\\lib\\\\rustlib\\\\etc\\\\libcore.natvis\" \"/LIBPATH:C:\\\\Users\\\\alex\\\\.rustup\\\\toolchains\\\\nightly-x86_64-pc-windows-msvc\\\\lib\\\\rustlib\\\\x86_64-pc-windows-msvc\\\\lib\" \"C:\\\\Users\\\\alex\\\\.rustup\\\\toolchains\\\\nightly-x86_64-pc-windows-msvc\\\\lib\\\\rustlib\\\\x86_64-pc-windows-msvc\\\\lib\\\\libstd-86003fe2ba26724d.rlib\" \"C:\\\\Users\\\\alex\\\\.rustup\\\\toolchains\\\\nightly-x86_64-pc-windows-msvc\\\\lib\\\\rustlib\\\\x86_64-pc-windows-msvc\\\\lib\\\\libpanic_unwind-bb826b401e977c60.rlib\" \"C:\\\\Users\\\\alex\\\\.rustup\\\\toolchains\\\\nightly-x86_64-pc-windows-msvc\\\\lib\\\\rustlib\\\\x86_64-pc-windows-msvc\\\\lib\\\\libunwind-d08d48f09a9d2f10.rlib\" \"C:\\\\Users\\\\alex\\\\.rustup\\\\toolchains\\\\nightly-x86_64-pc-windows-msvc\\\\lib\\\\rustlib\\\\x86_64-pc-windows-msvc\\\\lib\\\\liblibc-2641bedcb07f8f2a.rlib\" \"C:\\\\Users\\\\alex\\\\.rustup\\\\toolchains\\\\nightly-x86_64-pc-windows-msvc\\\\lib\\\\rustlib\\\\x86_64-pc-windows-msvc\\\\lib\\\\liballoc_system-d4cd645fbdb93df8.rlib\" \"C:\\\\Users\\\\alex\\\\.rustup\\\\toolchains\\\\nightly-x86_64-pc-windows-msvc\\\\lib\\\\rustlib\\\\x86_64-pc-windows-msvc\\\\lib\\\\liballoc-9fb3c940ca5fe920.rlib\" \"C:\\\\Users\\\\alex\\\\.rustup\\\\toolchains\\\\nightly-x86_64-pc-windows-msvc\\\\lib\\\\rustlib\\\\x86_64-pc-windows-msvc\\\\lib\\\\libstd_unicode-e033f95dfa73709c.rlib\" \"C:\\\\Users\\\\alex\\\\.rustup\\\\toolchains\\\\nightly-x86_64-pc-windows-msvc\\\\lib\\\\rustlib\\\\x86_64-pc-windows-msvc\\\\lib\\\\libcore-b24b1226646be575.rlib\" \"C:\\\\Users\\\\alex\\\\.rustup\\\\toolchains\\\\nightly-x86_64-pc-windows-msvc\\\\lib\\\\rustlib\\\\x86_64-pc-windows-msvc\\\\lib\\\\libcompiler_builtins-98237266b8364c3b.rlib\" \"advapi32.lib\" \"ws2_32.lib\" \"userenv.lib\" \"shell32.lib\" \"msvcrt.lib\"\r\n  = note: foo.foo-a.rcgu.o : warning LNK4042: object specified more than once; extras ignored\r\n          foo.foo.rcgu.o : error LNK2019: unresolved external symbol _ZN3foo1A3foo17hcc8ef77d474fdbcdE referenced in function _ZN3foo4main17hdc141899c6b702c7E\r\n          foo.exe : fatal error LNK1120: 1 unresolved externals\r\n\r\n\r\nerror: aborting due to previous error\r\n```\r\n\r\ncc @michaelwoerister ", "closed_by": {"login": "alexcrichton", "id": 64996, "node_id": "MDQ6VXNlcjY0OTk2", "avatar_url": "https://avatars.githubusercontent.com/u/64996?v=4", "gravatar_id": "", "url": "https://api.github.com/users/alexcrichton", "html_url": "https://github.com/alexcrichton", "followers_url": "https://api.github.com/users/alexcrichton/followers", "following_url": "https://api.github.com/users/alexcrichton/following{/other_user}", "gists_url": "https://api.github.com/users/alexcrichton/gists{/gist_id}", "starred_url": "https://api.github.com/users/alexcrichton/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/alexcrichton/subscriptions", "organizations_url": "https://api.github.com/users/alexcrichton/orgs", "repos_url": "https://api.github.com/users/alexcrichton/repos", "events_url": "https://api.github.com/users/alexcrichton/events{/privacy}", "received_events_url": "https://api.github.com/users/alexcrichton/received_events", "type": "User", "site_admin": false}, "reactions": {"url": "https://api.github.com/repos/rust-lang/rust/issues/47222/reactions", "total_count": 6, "+1": 1, "-1": 0, "laugh": 5, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rust-lang/rust/issues/47222/timeline", "performed_via_github_app": null, "state_reason": "completed"}