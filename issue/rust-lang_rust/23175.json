{"url": "https://api.github.com/repos/rust-lang/rust/issues/23175", "repository_url": "https://api.github.com/repos/rust-lang/rust", "labels_url": "https://api.github.com/repos/rust-lang/rust/issues/23175/labels{/name}", "comments_url": "https://api.github.com/repos/rust-lang/rust/issues/23175/comments", "events_url": "https://api.github.com/repos/rust-lang/rust/issues/23175/events", "html_url": "https://github.com/rust-lang/rust/issues/23175", "id": 60250745, "node_id": "MDU6SXNzdWU2MDI1MDc0NQ==", "number": 23175, "title": "ICE (failed assertion) when taking mutable references to enum contents", "user": {"login": "bluecube", "id": 206187, "node_id": "MDQ6VXNlcjIwNjE4Nw==", "avatar_url": "https://avatars.githubusercontent.com/u/206187?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bluecube", "html_url": "https://github.com/bluecube", "followers_url": "https://api.github.com/users/bluecube/followers", "following_url": "https://api.github.com/users/bluecube/following{/other_user}", "gists_url": "https://api.github.com/users/bluecube/gists{/gist_id}", "starred_url": "https://api.github.com/users/bluecube/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bluecube/subscriptions", "organizations_url": "https://api.github.com/users/bluecube/orgs", "repos_url": "https://api.github.com/users/bluecube/repos", "events_url": "https://api.github.com/users/bluecube/events{/privacy}", "received_events_url": "https://api.github.com/users/bluecube/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 9618520, "node_id": "MDU6TGFiZWw5NjE4NTIw", "url": "https://api.github.com/repos/rust-lang/rust/labels/I-ICE", "name": "I-ICE", "color": "e10c02", "default": false, "description": "Issue: The compiler panicked, giving an Internal Compilation Error (ICE) \u2744\ufe0f"}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 2, "created_at": "2015-03-08T10:29:18Z", "updated_at": "2016-06-11T13:42:46Z", "closed_at": "2016-06-11T13:42:46Z", "author_association": "NONE", "active_lock_reason": null, "body": "I tried this code:\n\n``` rust\nenum Foo {\n    NotLast(Box<Foo>),\n    Last(u32)\n}\n\nfn x(tree: &mut Foo) {\n    let mut current = tree;\n\n    loop {\n        match current {\n            &mut Foo::NotLast(ref mut inner) => {\n                current = &mut *inner;\n            },\n            &mut Foo::Last(ref mut val) => {\n                *val = 1;\n            },\n        }\n    }\n}\n\nfn main() {}\n```\n\nAnd got the following message:\n\n```\nerror.rs:11:31: 11:44 error: cannot borrow `current.0` as mutable more than once at a time\nerror.rs:11             &mut Foo::NotLast(ref mut inner) => {\n                                          ^~~~~~~~~~~~~\nerror.rs:11:31: 11:44 note: previous borrow of `current.0` occurs here; the mutable borrow prevents subsequent moves, borrows, or modification of `current.0` until the borrow ends\nerror.rs:11             &mut Foo::NotLast(ref mut inner) => {\n                                          ^~~~~~~~~~~~~\nerror.rs:19:2: 19:2 note: previous borrow ends here\nerror.rs:6 fn x(tree: &mut Foo) {\n...\nerror.rs:19 }\n            ^\nerror.rs:12:17: 12:38 error: cannot assign to `current` because it is borrowed\nerror.rs:12                 current = &mut *inner;\n                            ^~~~~~~~~~~~~~~~~~~~~\nerror.rs:11:31: 11:44 note: borrow of `current` occurs here\nerror.rs:11             &mut Foo::NotLast(ref mut inner) => {\n                                          ^~~~~~~~~~~~~\nerror: internal compiler error: unexpected panic\nnote: the compiler unexpectedly panicked. this is a bug.\nnote: we would appreciate a bug report: https://github.com/rust-lang/rust/blob/master/CONTRIBUTING.md#bug-reports\nnote: run with `RUST_BACKTRACE=1` for a backtrace\nthread 'rustc' panicked at 'assertion failed: `(left == right) && (right == left)` (left: `TyS { sty: ty_uint(u32), flags: 0, region_depth: 0 }`, right: `TyS { sty: ty_uniq(TyS { sty: ty_enum(DefId { krate: 0, node: 4 }, Substs { types: VecPerParamSpace {TypeSpace: [], SelfSpace: [], FnSpace: [], }, regions: NonerasedRegions(VecPerParamSpace {TypeSpace: [], SelfSpace: [], FnSpace: [], }) }), flags: 0, region_depth: 0 }), flags: 0, region_depth: 0 }`)', /tmp/portage/dev-lang/rust-1.0.0_alpha2/work/rustc-1.0.0-alpha.2/src/librustc_borrowck/borrowck/mod.rs:402\n```\n\nThe snippet is probably wrong, but the assert should not fail\n## Meta\n\n```\nrustc 1.0.0-dev (built 2015-02-28)\nbinary: rustc\ncommit-hash: unknown\ncommit-date: unknown\nbuild-date: 2015-02-28\nhost: x86_64-unknown-linux-gnu\nrelease: 1.0.0-dev\n```\n\nBacktrace:\n\n```\n   1:     0x7fe4742d3c20 - sys::backtrace::write::h6db1343660ca93a2KlC\n   2:     0x7fe4742f9900 - <unknown>\n   3:     0x7fe474244d80 - rt::unwind::begin_unwind_inner::h734e583390472682RBL\n   4:     0x7fe474245220 - rt::unwind::begin_unwind_fmt::hdaef33c302b47274nAL\n   5:     0x7fe473478670 - <unknown>\n   6:     0x7fe473476f70 - <unknown>\n   7:     0x7fe473476e90 - <unknown>\n   8:     0x7fe473463640 - borrowck::check_loans::CheckLoanCtxt<'a, 'tcx>.euv..Delegate<'tcx>::borrow::h2a13ad241eee66d6cja\n   9:     0x7fe47346e160 - <unknown>\n  10:     0x7fe47346e160 - <unknown>\n  11:     0x7fe47346e160 - <unknown>\n  12:     0x7fe47346dff0 - <unknown>\n  13:     0x7fe473472670 - <unknown>\n  14:     0x7fe4734761d0 - <unknown>\n  15:     0x7fe473472670 - <unknown>\n  16:     0x7fe4734761d0 - <unknown>\n  17:     0x7fe47348e560 - <unknown>\n  18:     0x7fe47348fa00 - <unknown>\n  19:     0x7fe47348f450 - borrowck::check_crate::hdf41b3c11cb3508fzRe\n  20:     0x7fe4748df1b0 - driver::phase_3_run_analysis_passes::h025b35dbe058134fgHa\n  21:     0x7fe4748c5610 - driver::compile_input::ha5d27daf21872ba2Gba\n  22:     0x7fe474993b50 - run_compiler::he50deb5aedf688fcZbc\n  23:     0x7fe474992480 - <unknown>\n  24:     0x7fe474991370 - <unknown>\n  25:     0x7fe474356bc0 - <unknown>\n  26:     0x7fe474356bb0 - rust_try\n  27:     0x7fe474991670 - <unknown>\n  28:     0x7fe4742e7650 - <unknown>\n  29:     0x7fe46ef4bf40 - <unknown>\n  30:     0x7fe473eca7d9 - clone\n  31:                0x0 - <unknown>\n```\n", "closed_by": {"login": "arielb1", "id": 1830974, "node_id": "MDQ6VXNlcjE4MzA5NzQ=", "avatar_url": "https://avatars.githubusercontent.com/u/1830974?v=4", "gravatar_id": "", "url": "https://api.github.com/users/arielb1", "html_url": "https://github.com/arielb1", "followers_url": "https://api.github.com/users/arielb1/followers", "following_url": "https://api.github.com/users/arielb1/following{/other_user}", "gists_url": "https://api.github.com/users/arielb1/gists{/gist_id}", "starred_url": "https://api.github.com/users/arielb1/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/arielb1/subscriptions", "organizations_url": "https://api.github.com/users/arielb1/orgs", "repos_url": "https://api.github.com/users/arielb1/repos", "events_url": "https://api.github.com/users/arielb1/events{/privacy}", "received_events_url": "https://api.github.com/users/arielb1/received_events", "type": "User", "site_admin": false}, "reactions": {"url": "https://api.github.com/repos/rust-lang/rust/issues/23175/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rust-lang/rust/issues/23175/timeline", "performed_via_github_app": null, "state_reason": "completed"}