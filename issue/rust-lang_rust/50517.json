{"url": "https://api.github.com/repos/rust-lang/rust/issues/50517", "repository_url": "https://api.github.com/repos/rust-lang/rust", "labels_url": "https://api.github.com/repos/rust-lang/rust/issues/50517/labels{/name}", "comments_url": "https://api.github.com/repos/rust-lang/rust/issues/50517/comments", "events_url": "https://api.github.com/repos/rust-lang/rust/issues/50517/events", "html_url": "https://github.com/rust-lang/rust/issues/50517", "id": 320934189, "node_id": "MDU6SXNzdWUzMjA5MzQxODk=", "number": 50517, "title": "Unhelpful borrowck error when wrong lifetimes are used", "user": {"login": "jonhoo", "id": 176295, "node_id": "MDQ6VXNlcjE3NjI5NQ==", "avatar_url": "https://avatars.githubusercontent.com/u/176295?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jonhoo", "html_url": "https://github.com/jonhoo", "followers_url": "https://api.github.com/users/jonhoo/followers", "following_url": "https://api.github.com/users/jonhoo/following{/other_user}", "gists_url": "https://api.github.com/users/jonhoo/gists{/gist_id}", "starred_url": "https://api.github.com/users/jonhoo/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jonhoo/subscriptions", "organizations_url": "https://api.github.com/users/jonhoo/orgs", "repos_url": "https://api.github.com/users/jonhoo/repos", "events_url": "https://api.github.com/users/jonhoo/events{/privacy}", "received_events_url": "https://api.github.com/users/jonhoo/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 234902, "node_id": "MDU6TGFiZWwyMzQ5MDI=", "url": "https://api.github.com/repos/rust-lang/rust/labels/C-enhancement", "name": "C-enhancement", "color": "f5f1fd", "default": false, "description": "Category: An issue proposing an enhancement or a PR with one."}, {"id": 235791, "node_id": "MDU6TGFiZWwyMzU3OTE=", "url": "https://api.github.com/repos/rust-lang/rust/labels/A-diagnostics", "name": "A-diagnostics", "color": "f7e101", "default": false, "description": "Area: Messages for errors, warnings, and lints"}, {"id": 1775993, "node_id": "MDU6TGFiZWwxNzc1OTkz", "url": "https://api.github.com/repos/rust-lang/rust/labels/A-lifetimes", "name": "A-lifetimes", "color": "f7e101", "default": false, "description": "Area: lifetime related"}, {"id": 171502053, "node_id": "MDU6TGFiZWwxNzE1MDIwNTM=", "url": "https://api.github.com/repos/rust-lang/rust/labels/A-borrow-checker", "name": "A-borrow-checker", "color": "f7e101", "default": false, "description": "Area: The borrow checker"}, {"id": 211668019, "node_id": "MDU6TGFiZWwyMTE2NjgwMTk=", "url": "https://api.github.com/repos/rust-lang/rust/labels/T-lang", "name": "T-lang", "color": "bfd4f2", "default": false, "description": "Relevant to the language team, which will review and decide on the PR/issue."}, {"id": 1596121013, "node_id": "MDU6TGFiZWwxNTk2MTIxMDEz", "url": "https://api.github.com/repos/rust-lang/rust/labels/D-confusing", "name": "D-confusing", "color": "c9f7a3", "default": false, "description": "Confusing diagnostic error that should be reworked"}], "state": "open", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 1, "created_at": "2018-05-07T19:54:59Z", "updated_at": "2021-10-02T22:35:23Z", "closed_at": null, "author_association": "CONTRIBUTOR", "active_lock_reason": null, "body": "Consider the following code:\r\n```rust\r\nfn run() -> () {\r\n    let mut buf = [0u8; 1];\r\n    let mut foo = Foo(&mut buf[..]);\r\n    let _bar = foo.bar();\r\n    foo.next();\r\n}\r\n\r\npub struct Foo<'a>(&'a mut [u8]);\r\nimpl<'a> Foo<'a> {\r\n    pub fn bar(&self) -> bool { true }\r\n    pub fn next(&'a mut self) -> &'a () { unimplemented!(); }\r\n}\r\n\r\nimpl<'a> Drop for Foo<'a> {\r\n    fn drop(&mut self) { unimplemented!(); }\r\n}\r\n```\r\n\r\nIt does not currently compile. With NLL, it yields:\r\n```\r\nerror[E0597]: `foo` does not live long enough\r\n --> x.rs:5:5\r\n  |\r\n5 |     foo.next();\r\n  |     ^^^ borrowed value does not live long enough\r\n6 | }\r\n  | -\r\n  | |\r\n  | borrowed value only lives until here\r\n  | borrow later used here, when `foo` is dropped\r\n```\r\nWithout, it gives\r\n```\r\nerror[E0597]: `foo` does not live long enough\r\n --> x.rs:5:5\r\n  |\r\n5 |     foo.next();\r\n  |     ^^^ borrowed value does not live long enough\r\n6 | }\r\n  | - `foo` dropped here while still borrowed\r\n  |\r\n  = note: values in a scope are dropped in the opposite order they are created\r\n```\r\n\r\nBoth of them also give a warning that `foo` does not need to be mutable, even though it does...\r\n\r\nMore importantly though, neither of these are particularly helpful in describing what the user did wrong. In particular, in this case, that `next` should have been\r\n```rust\r\nfn next<'b>(&'b mut self) -> &'b ()\r\n```\r\nThe error is quite confusing, and it's not at all clear to the user that this error is related to the lifetime of `buf`!\r\n\r\nNote that the error changes if either the `foo.bar()` or the `impl Drop for Foo` is removed.", "closed_by": null, "reactions": {"url": "https://api.github.com/repos/rust-lang/rust/issues/50517/reactions", "total_count": 2, "+1": 2, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rust-lang/rust/issues/50517/timeline", "performed_via_github_app": null, "state_reason": null}