{"url": "https://api.github.com/repos/rust-lang/rust/issues/88590", "repository_url": "https://api.github.com/repos/rust-lang/rust", "labels_url": "https://api.github.com/repos/rust-lang/rust/issues/88590/labels{/name}", "comments_url": "https://api.github.com/repos/rust-lang/rust/issues/88590/comments", "events_url": "https://api.github.com/repos/rust-lang/rust/issues/88590/events", "html_url": "https://github.com/rust-lang/rust/issues/88590", "id": 986780730, "node_id": "MDU6SXNzdWU5ODY3ODA3MzA=", "number": 88590, "title": "doctests: unhelpful error messages for non-Rust code blocks", "user": {"login": "torfsen", "id": 2877717, "node_id": "MDQ6VXNlcjI4Nzc3MTc=", "avatar_url": "https://avatars.githubusercontent.com/u/2877717?v=4", "gravatar_id": "", "url": "https://api.github.com/users/torfsen", "html_url": "https://github.com/torfsen", "followers_url": "https://api.github.com/users/torfsen/followers", "following_url": "https://api.github.com/users/torfsen/following{/other_user}", "gists_url": "https://api.github.com/users/torfsen/gists{/gist_id}", "starred_url": "https://api.github.com/users/torfsen/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/torfsen/subscriptions", "organizations_url": "https://api.github.com/users/torfsen/orgs", "repos_url": "https://api.github.com/users/torfsen/repos", "events_url": "https://api.github.com/users/torfsen/events{/privacy}", "received_events_url": "https://api.github.com/users/torfsen/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 203738, "node_id": "MDU6TGFiZWwyMDM3Mzg=", "url": "https://api.github.com/repos/rust-lang/rust/labels/T-rustdoc", "name": "T-rustdoc", "color": "bfd4f2", "default": false, "description": "Relevant to the rustdoc team, which will review and decide on the PR/issue."}, {"id": 235791, "node_id": "MDU6TGFiZWwyMzU3OTE=", "url": "https://api.github.com/repos/rust-lang/rust/labels/A-diagnostics", "name": "A-diagnostics", "color": "f7e101", "default": false, "description": "Area: Messages for errors, warnings, and lints"}, {"id": 1118559391, "node_id": "MDU6TGFiZWwxMTE4NTU5Mzkx", "url": "https://api.github.com/repos/rust-lang/rust/labels/A-doctests", "name": "A-doctests", "color": "f7e101", "default": false, "description": "Area: Documentation tests, run by rustdoc"}], "state": "open", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 0, "created_at": "2021-09-02T14:07:24Z", "updated_at": "2021-09-03T14:16:25Z", "closed_at": null, "author_association": "NONE", "active_lock_reason": null, "body": "I recently added the a docstring to one of my functions that looked similar to this:\r\n\r\n```rust\r\n/**\r\nThis function does the following:\r\n\r\n    1. Print `foo`\r\n    2. Return\r\n*/\r\npub fn foo() {\r\n    println!(\"foo\");\r\n}\r\n``` \r\nWhen I then ran `cargo test` to execute tests defined in other parts of the project, I got the error messages\r\n\r\n```none\r\n---- src/lib.rs - foo (line 4) stdout ----\r\nerror: unknown start of token: `\r\n --> src/lib.rs:5:10\r\n  |\r\n3 | 1. Print `foo`\r\n  |          ^\r\n  |\r\nhelp: Unicode character '`' (Grave Accent) looks like ''' (Single Quote), but it is not\r\n  |\r\n3 | 1. Print 'foo`\r\n  |          ^\r\n\r\nerror: unknown start of token: `\r\n --> src/lib.rs:5:14\r\n  |\r\n3 | 1. Print `foo`\r\n  |              ^\r\n  |\r\nhelp: Unicode character '`' (Grave Accent) looks like ''' (Single Quote), but it is not\r\n  |\r\n3 | 1. Print `foo'\r\n  |              ^\r\n\r\nerror: expected one of `.`, `;`, `?`, `}`, or an operator, found `Print`\r\n --> src/lib.rs:5:4\r\n  |\r\n3 | 1. Print `foo`\r\n  |    ^^^^^ expected one of `.`, `;`, `?`, `}`, or an operator\r\n\r\nerror: aborting due to 3 previous errors\r\n```\r\nIt took me a while to figure out the issue: the list items shouldn't be indented, because the indentation makes them a code block instead of a list. With the indentation, Rust tries to run the list as a doctest, and the error messages are due to the list content not being valid Rust code.\r\n\r\n`cargo check` didn't yield any insights, either -- in fact it did not produce any warning at all.\r\n\r\n`cargo doc`, on the other hand, produced the following very helpful output:\r\n```none\r\nwarning: could not parse code block as Rust code\r\n --> src/lib.rs:4:5\r\n  |\r\n4 | /     1. Print `foo`\r\n5 | |     2. Return\r\n  | |_____________^\r\n  |\r\n  = note: error from rustc: unknown start of token: `\r\n  = note: error from rustc: unknown start of token: `\r\n```\r\nThis pointed me directly in the right direction of something being parsed as Rust code.\r\n\r\nI know that this is a minor issue, but so far I have been amazed by the incredibly helpful error message in the Rust eco system, and this was one of the few times where the original message was of little help. I don't know anything about how `cargo test` and `cargo doc` differ in their parsing, but the helpful output of `cargo doc` shows that a similar message should be possible for `cargo test`.\r\n\r\nThis is with Cargo `1.50.0 (f04e7fab7 2021-02-04)`.", "closed_by": null, "reactions": {"url": "https://api.github.com/repos/rust-lang/rust/issues/88590/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rust-lang/rust/issues/88590/timeline", "performed_via_github_app": null, "state_reason": null}