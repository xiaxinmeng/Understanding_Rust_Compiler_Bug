{"url": "https://api.github.com/repos/rust-lang/rust/issues/23472", "repository_url": "https://api.github.com/repos/rust-lang/rust", "labels_url": "https://api.github.com/repos/rust-lang/rust/issues/23472/labels{/name}", "comments_url": "https://api.github.com/repos/rust-lang/rust/issues/23472/comments", "events_url": "https://api.github.com/repos/rust-lang/rust/issues/23472/events", "html_url": "https://github.com/rust-lang/rust/issues/23472", "id": 62632803, "node_id": "MDU6SXNzdWU2MjYzMjgwMw==", "number": 23472, "title": "debuginfo: Enable LLVM's debuginfo verifier for debuginfo auto-tests", "user": {"login": "michaelwoerister", "id": 1825894, "node_id": "MDQ6VXNlcjE4MjU4OTQ=", "avatar_url": "https://avatars.githubusercontent.com/u/1825894?v=4", "gravatar_id": "", "url": "https://api.github.com/users/michaelwoerister", "html_url": "https://github.com/michaelwoerister", "followers_url": "https://api.github.com/users/michaelwoerister/followers", "following_url": "https://api.github.com/users/michaelwoerister/following{/other_user}", "gists_url": "https://api.github.com/users/michaelwoerister/gists{/gist_id}", "starred_url": "https://api.github.com/users/michaelwoerister/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/michaelwoerister/subscriptions", "organizations_url": "https://api.github.com/users/michaelwoerister/orgs", "repos_url": "https://api.github.com/users/michaelwoerister/repos", "events_url": "https://api.github.com/users/michaelwoerister/events{/privacy}", "received_events_url": "https://api.github.com/users/michaelwoerister/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 203130, "node_id": "MDU6TGFiZWwyMDMxMzA=", "url": "https://api.github.com/repos/rust-lang/rust/labels/A-debuginfo", "name": "A-debuginfo", "color": "f7e101", "default": false, "description": "Area: Debugging information in compiled programs (DWARF, PDB, etc.)"}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 3, "created_at": "2015-03-18T09:13:30Z", "updated_at": "2016-07-07T21:46:00Z", "closed_at": "2016-07-07T21:46:00Z", "author_association": "MEMBER", "active_lock_reason": null, "body": "LLVM supports a nifty debuginfo verification pass that checks whether the debuginfo in the IR is well-formed. This can easily be enabled via `-Cllvm-args=-verify-debug-info`.\n\nUnfortunately, at the moment we do one thing that LLVM considers ill-formed: The debuginfo verifier expects all struct-based types (and their members) to be linked to a source file (i.e. to the file where the type is defined). Rust unfortunately contains some kinds of types where this is not possible, most prominently tuples. Consequently, most Rust code fails the verification pass.\n\nThe clean way to handle this, in my opinion, is to mark these kinds of types (tuples, `Box`, slices) with the `DW_AT_artificial` attribute, which is the DWARF way of saying \"this thing is compiler generated\", and then modify the LLVM debuginfo verifier so it allows artificial objects to not have an associated source location. Unfortunately, for reasons unknown to me, LLDB completely ignores some things that are marked as artificial, which would make using LLDB with Rust impossible.\n\nTwo other options I see for dealing with this:\n1. Completely remove the source-location-condition from LLVM's debuginfo verifier. However, that's something that is unlikely to ever be merged upstream, which is not good.\n2. Add some dummy source location like `<unknown>:0:0` to anything where we don't have a real location. I consider this kind of a hack but since source locations associated with types are rarely used in debuggers, this would go mostly unnoticed I guess. However, it would increase the size of binaries with debuginfo in them (a few bytes for every type and every field).\n", "closed_by": {"login": "michaelwoerister", "id": 1825894, "node_id": "MDQ6VXNlcjE4MjU4OTQ=", "avatar_url": "https://avatars.githubusercontent.com/u/1825894?v=4", "gravatar_id": "", "url": "https://api.github.com/users/michaelwoerister", "html_url": "https://github.com/michaelwoerister", "followers_url": "https://api.github.com/users/michaelwoerister/followers", "following_url": "https://api.github.com/users/michaelwoerister/following{/other_user}", "gists_url": "https://api.github.com/users/michaelwoerister/gists{/gist_id}", "starred_url": "https://api.github.com/users/michaelwoerister/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/michaelwoerister/subscriptions", "organizations_url": "https://api.github.com/users/michaelwoerister/orgs", "repos_url": "https://api.github.com/users/michaelwoerister/repos", "events_url": "https://api.github.com/users/michaelwoerister/events{/privacy}", "received_events_url": "https://api.github.com/users/michaelwoerister/received_events", "type": "User", "site_admin": false}, "reactions": {"url": "https://api.github.com/repos/rust-lang/rust/issues/23472/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rust-lang/rust/issues/23472/timeline", "performed_via_github_app": null, "state_reason": "completed"}