{"url": "https://api.github.com/repos/rust-lang/rust/issues/83838", "repository_url": "https://api.github.com/repos/rust-lang/rust", "labels_url": "https://api.github.com/repos/rust-lang/rust/issues/83838/labels{/name}", "comments_url": "https://api.github.com/repos/rust-lang/rust/issues/83838/comments", "events_url": "https://api.github.com/repos/rust-lang/rust/issues/83838/events", "html_url": "https://github.com/rust-lang/rust/issues/83838", "id": 849794263, "node_id": "MDU6SXNzdWU4NDk3OTQyNjM=", "number": 83838, "title": "UI tests `linkage-detect-local-generated-name-collision.rs` and `linkage-detect-extern-generated-name-collision.rs` trigger LLVM asserts when compiled with CGUs = 1", "user": {"login": "the8472", "id": 1065730, "node_id": "MDQ6VXNlcjEwNjU3MzA=", "avatar_url": "https://avatars.githubusercontent.com/u/1065730?v=4", "gravatar_id": "", "url": "https://api.github.com/users/the8472", "html_url": "https://github.com/the8472", "followers_url": "https://api.github.com/users/the8472/followers", "following_url": "https://api.github.com/users/the8472/following{/other_user}", "gists_url": "https://api.github.com/users/the8472/gists{/gist_id}", "starred_url": "https://api.github.com/users/the8472/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/the8472/subscriptions", "organizations_url": "https://api.github.com/users/the8472/orgs", "repos_url": "https://api.github.com/users/the8472/repos", "events_url": "https://api.github.com/users/the8472/events{/privacy}", "received_events_url": "https://api.github.com/users/the8472/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 37547, "node_id": "MDU6TGFiZWwzNzU0Nw==", "url": "https://api.github.com/repos/rust-lang/rust/labels/A-linkage", "name": "A-linkage", "color": "f7e101", "default": false, "description": "Area: linking into static, shared libraries and binaries"}, {"id": 100522, "node_id": "MDU6TGFiZWwxMDA1MjI=", "url": "https://api.github.com/repos/rust-lang/rust/labels/I-crash", "name": "I-crash", "color": "e10c02", "default": false, "description": "Issue: The compiler crashes (SIGSEGV, SIGABRT, etc). Use I-ICE instead when the compiler panics."}, {"id": 108333, "node_id": "MDU6TGFiZWwxMDgzMzM=", "url": "https://api.github.com/repos/rust-lang/rust/labels/A-LLVM", "name": "A-LLVM", "color": "f7e101", "default": false, "description": "Area: Code generation parts specific to LLVM. Both correctness bugs and optimization-related issues."}, {"id": 211668100, "node_id": "MDU6TGFiZWwyMTE2NjgxMDA=", "url": "https://api.github.com/repos/rust-lang/rust/labels/T-compiler", "name": "T-compiler", "color": "bfd4f2", "default": false, "description": "Relevant to the compiler team, which will review and decide on the PR/issue."}, {"id": 650731663, "node_id": "MDU6TGFiZWw2NTA3MzE2NjM=", "url": "https://api.github.com/repos/rust-lang/rust/labels/C-bug", "name": "C-bug", "color": "f5f1fd", "default": false, "description": "Category: This is a bug."}], "state": "open", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 1, "created_at": "2021-04-04T04:18:58Z", "updated_at": "2023-06-19T16:20:50Z", "closed_at": null, "author_association": "MEMBER", "active_lock_reason": null, "body": "This was discovered in https://github.com/rust-lang/rust/pull/81942#issuecomment-812958466 which lowers the default CGU count to 1. The tests were modified to explicitly request 16CGUs to make them pass, but the underlying issue remains.\r\n\r\nThis should be reproducible by setting `assertions = true` in config.toml and running `./x.py test --stage 1 src/test/ui` on commit 01c682043d3632dab421c263b8a2263b08b01bab (base commit aef11409b43) or by adding `// compile-flags: -Ccodegen-units=1` to the tests.\r\n\r\n```\r\n---- [ui] ui/linkage-attr/linkage-detect-local-generated-name-collision.rs stdout ----\r\n\r\nerror: Error: expected failure status (Some(1)) but received status None.\r\nstatus: signal: 6 (core dumped)\r\ncommand: \"/home/the8472/workspace/rust/build/x86_64-unknown-linux-gnu/stage1/bin/rustc\" \"/home/the8472/workspace/rust/src/test/ui/linkage-attr/linkage-detect-local-generated-name-collision.rs\" \"-Zthreads=1\" \"--target=x86_64-unknown-linux-gnu\" \"--error-format\" \"json\" \"-Ccodegen-units=1\" \"-Zui-testing\" \"-Zdeduplicate-diagnostics=no\" \"-Zemit-future-incompat-report\" \"-C\" \"prefer-dynamic\" \"--out-dir\" \"/home/the8472/workspace/rust/build/x86_64-unknown-linux-gnu/test/ui/linkage-attr/linkage-detect-local-generated-name-collision\" \"-A\" \"unused\" \"-Crpath\" \"-O\" \"-Cdebuginfo=0\" \"-Zunstable-options\" \"-Lnative=/home/the8472/workspace/rust/build/x86_64-unknown-linux-gnu/native/rust-test-helpers\" \"-Clink-args=-fuse-ld=lld\" \"-Clink-arg=-Wl,--threads=1\" \"-Ccodegen-units=2\" \"-L\" \"/home/the8472/workspace/rust/build/x86_64-unknown-linux-gnu/test/ui/linkage-attr/linkage-detect-local-generated-name-collision/auxiliary\"\r\nstdout:\r\n------------------------------------------\r\n\r\n------------------------------------------\r\nstderr:\r\n------------------------------------------\r\nrustc: /home/the8472/workspace/rust/src/llvm-project/llvm/include/llvm/Support/Casting.h:269: typename llvm::cast_retty<X, Y*>::ret_type llvm::cast(Y*) [with X = llvm::GlobalValue; Y = llvm::Value; typename llvm::cast_retty<X, Y*>::ret_type = llvm::GlobalValue*]: Assertion `isa<X>(Val) && \"cast<Ty>() argument of incompatible type!\"' failed.\r\n\r\n------------------------------------------\r\n\r\n\r\n---- [ui] ui/linkage-attr/linkage-detect-extern-generated-name-collision.rs stdout ----\r\n\r\nerror: Error: expected failure status (Some(1)) but received status None.\r\nstatus: signal: 6 (core dumped)\r\ncommand: \"/home/the8472/workspace/rust/build/x86_64-unknown-linux-gnu/stage1/bin/rustc\" \"/home/the8472/workspace/rust/src/test/ui/linkage-attr/linkage-detect-extern-generated-name-collision.rs\" \"-Zthreads=1\" \"--target=x86_64-unknown-linux-gnu\" \"--error-format\" \"json\" \"-Ccodegen-units=1\" \"-Zui-testing\" \"-Zdeduplicate-diagnostics=no\" \"-Zemit-future-incompat-report\" \"-C\" \"prefer-dynamic\" \"--out-dir\" \"/home/the8472/workspace/rust/build/x86_64-unknown-linux-gnu/test/ui/linkage-attr/linkage-detect-extern-generated-name-collision\" \"-A\" \"unused\" \"-Crpath\" \"-O\" \"-Cdebuginfo=0\" \"-Zunstable-options\" \"-Lnative=/home/the8472/workspace/rust/build/x86_64-unknown-linux-gnu/native/rust-test-helpers\" \"-Clink-args=-fuse-ld=lld\" \"-Clink-arg=-Wl,--threads=1\" \"-Ccodegen-units=2\" \"-L\" \"/home/the8472/workspace/rust/build/x86_64-unknown-linux-gnu/test/ui/linkage-attr/linkage-detect-extern-generated-name-collision/auxiliary\"\r\nstdout:\r\n------------------------------------------\r\n\r\n------------------------------------------\r\nstderr:\r\n------------------------------------------\r\nrustc: /home/the8472/workspace/rust/src/llvm-project/llvm/include/llvm/Support/Casting.h:269: typename llvm::cast_retty<X, Y*>::ret_type llvm::cast(Y*) [with X = llvm::GlobalValue; Y = llvm::Value; typename llvm::cast_retty<X, Y*>::ret_type = llvm::GlobalValue*]: Assertion `isa<X>(Val) && \"cast<Ty>() argument of incompatible type!\"' failed.\r\n\r\n------------------------------------------\r\n\r\n\r\n\r\nfailures:\r\n    [ui] ui/linkage-attr/linkage-detect-extern-generated-name-collision.rs\r\n    [ui] ui/linkage-attr/linkage-detect-local-generated-name-collision.rs\r\n```", "closed_by": null, "reactions": {"url": "https://api.github.com/repos/rust-lang/rust/issues/83838/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rust-lang/rust/issues/83838/timeline", "performed_via_github_app": null, "state_reason": null}