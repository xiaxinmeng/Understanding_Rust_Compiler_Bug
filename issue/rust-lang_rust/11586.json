{"url": "https://api.github.com/repos/rust-lang/rust/issues/11586", "repository_url": "https://api.github.com/repos/rust-lang/rust", "labels_url": "https://api.github.com/repos/rust-lang/rust/issues/11586/labels{/name}", "comments_url": "https://api.github.com/repos/rust-lang/rust/issues/11586/comments", "events_url": "https://api.github.com/repos/rust-lang/rust/issues/11586/events", "html_url": "https://github.com/rust-lang/rust/issues/11586", "id": 25694731, "node_id": "MDU6SXNzdWUyNTY5NDczMQ==", "number": 11586, "title": "Remove special rooting for `@T`", "user": {"login": "nikomatsakis", "id": 155238, "node_id": "MDQ6VXNlcjE1NTIzOA==", "avatar_url": "https://avatars.githubusercontent.com/u/155238?v=4", "gravatar_id": "", "url": "https://api.github.com/users/nikomatsakis", "html_url": "https://github.com/nikomatsakis", "followers_url": "https://api.github.com/users/nikomatsakis/followers", "following_url": "https://api.github.com/users/nikomatsakis/following{/other_user}", "gists_url": "https://api.github.com/users/nikomatsakis/gists{/gist_id}", "starred_url": "https://api.github.com/users/nikomatsakis/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/nikomatsakis/subscriptions", "organizations_url": "https://api.github.com/users/nikomatsakis/orgs", "repos_url": "https://api.github.com/users/nikomatsakis/repos", "events_url": "https://api.github.com/users/nikomatsakis/events{/privacy}", "received_events_url": "https://api.github.com/users/nikomatsakis/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 60344715, "node_id": "MDU6TGFiZWw2MDM0NDcxNQ==", "url": "https://api.github.com/repos/rust-lang/rust/labels/P-medium", "name": "P-medium", "color": "eb6420", "default": false, "description": "Medium priority"}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 7, "created_at": "2014-01-16T00:40:15Z", "updated_at": "2014-06-16T21:56:30Z", "closed_at": "2014-04-24T14:01:34Z", "author_association": "CONTRIBUTOR", "active_lock_reason": null, "body": "`@T` types currently have two rules: either the compiler can insert a root automatically, or else the borrow checker can try to take advantage of an existing root. The latter is more efficient and more flexible but occasionally less convenient, since users may have to insert a temporary by hand.\n\nWith `@` moving into a library, we won't support the special auto-rooting behavior anymore. This simplifies the borrow checker and trans, but also will fix a weird case I discovered where the region inferencer fails to infer a proper lifetime:\n\n```\n            match expr.node {\n                ast::ExprAddrOf(_, ref subexpr) |\n                ast::ExprUnary(_, ast::UnDeref, ref subexpr) |\n                ast::ExprField(ref subexpr, _, _) |\n                ast::ExprIndex(_, ref subexpr, _) |\n                ast::ExprParen(ref subexpr) => {\n                    let subexpr: &'a @Expr = subexpr; // Should not be necessary\n                    expr = &**subexpr;\n                }\n                _ => {\n                    return;\n                }\n            }\n```\n\nThe problem is that the region inferencer doesn't add a constraint indicating that the lifetime of `&**subexpr` is dependent on the region assigned to `subexpr`. `subexpr` has type `&'b @Foo`, and for this code to work, the region inferencer must ensure that `'b` is a big enough region -- but it doesn't add the required constraint, because it thinks that the compiler will be able to root the `@` box long enough.\n", "closed_by": {"login": "flaper87", "id": 13816, "node_id": "MDQ6VXNlcjEzODE2", "avatar_url": "https://avatars.githubusercontent.com/u/13816?v=4", "gravatar_id": "", "url": "https://api.github.com/users/flaper87", "html_url": "https://github.com/flaper87", "followers_url": "https://api.github.com/users/flaper87/followers", "following_url": "https://api.github.com/users/flaper87/following{/other_user}", "gists_url": "https://api.github.com/users/flaper87/gists{/gist_id}", "starred_url": "https://api.github.com/users/flaper87/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/flaper87/subscriptions", "organizations_url": "https://api.github.com/users/flaper87/orgs", "repos_url": "https://api.github.com/users/flaper87/repos", "events_url": "https://api.github.com/users/flaper87/events{/privacy}", "received_events_url": "https://api.github.com/users/flaper87/received_events", "type": "User", "site_admin": false}, "reactions": {"url": "https://api.github.com/repos/rust-lang/rust/issues/11586/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rust-lang/rust/issues/11586/timeline", "performed_via_github_app": null, "state_reason": "completed"}