{"url": "https://api.github.com/repos/rust-lang/rust/issues/57277", "repository_url": "https://api.github.com/repos/rust-lang/rust", "labels_url": "https://api.github.com/repos/rust-lang/rust/issues/57277/labels{/name}", "comments_url": "https://api.github.com/repos/rust-lang/rust/issues/57277/comments", "events_url": "https://api.github.com/repos/rust-lang/rust/issues/57277/events", "html_url": "https://github.com/rust-lang/rust/issues/57277", "id": 395344582, "node_id": "MDU6SXNzdWUzOTUzNDQ1ODI=", "number": 57277, "title": "format! parse error expectations are sometimes inaccurate", "user": {"login": "euclio", "id": 1372438, "node_id": "MDQ6VXNlcjEzNzI0Mzg=", "avatar_url": "https://avatars.githubusercontent.com/u/1372438?v=4", "gravatar_id": "", "url": "https://api.github.com/users/euclio", "html_url": "https://github.com/euclio", "followers_url": "https://api.github.com/users/euclio/followers", "following_url": "https://api.github.com/users/euclio/following{/other_user}", "gists_url": "https://api.github.com/users/euclio/gists{/gist_id}", "starred_url": "https://api.github.com/users/euclio/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/euclio/subscriptions", "organizations_url": "https://api.github.com/users/euclio/orgs", "repos_url": "https://api.github.com/users/euclio/repos", "events_url": "https://api.github.com/users/euclio/events{/privacy}", "received_events_url": "https://api.github.com/users/euclio/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 235791, "node_id": "MDU6TGFiZWwyMzU3OTE=", "url": "https://api.github.com/repos/rust-lang/rust/labels/A-diagnostics", "name": "A-diagnostics", "color": "f7e101", "default": false, "description": "Area: Messages for errors, warnings, and lints"}, {"id": 27424086, "node_id": "MDU6TGFiZWwyNzQyNDA4Ng==", "url": "https://api.github.com/repos/rust-lang/rust/labels/A-parser", "name": "A-parser", "color": "f7e101", "default": false, "description": "Area: The parsing of Rust source code to an AST."}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 0, "created_at": "2019-01-02T18:57:43Z", "updated_at": "2019-09-14T10:13:34Z", "closed_at": "2019-09-14T10:13:34Z", "author_association": "CONTRIBUTOR", "active_lock_reason": null, "body": "See https://github.com/rust-lang/rust/pull/56897#discussion_r244218805.\r\n\r\nThe `format!` macro claims that it expects `,` when failing to parse a format string argument, but it actually accepts all tokens that make up expressions in that position. The simplest fix would be to use `expect(&token::Comma)`, but that causes parsing errors directly after the format string to claim that expression tokens are expected in that position are accepted, when they are not.\r\n\r\nIn other words, it would be nice to get diagnostics like this: \r\n\r\n```\r\n-error: expected token: `,`\r\n+error: expected one of `,`, `.`, `?`, or an operator, found `1`\r\n   --> $DIR/bad-format-args.rs:4:19\r\n    |\r\n LL |     format!(\"\", 1 1); //~ ERROR expected token: `,`\r\n-   |                   ^\r\n+   |                   ^ expected one of `,`, `.`, `?`, or an operator here\r\n```\r\n\r\nwhile avoiding getting diagnostics like this:\r\n\r\n```\r\n-error: expected token: `,`\r\n+error: expected one of `,`, `.`, `?`, or an operator, found `1`\r\n   --> $DIR/bad-format-args.rs:3:16\r\n    |\r\n LL |     format!(\"\" 1); //~ ERROR expected token: `,`\r\n-   |                ^\r\n+   |                ^ expected one of `,`, `.`, `?`, or an operator here\r\n```", "closed_by": {"login": "bors", "id": 3372342, "node_id": "MDQ6VXNlcjMzNzIzNDI=", "avatar_url": "https://avatars.githubusercontent.com/u/3372342?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors", "html_url": "https://github.com/bors", "followers_url": "https://api.github.com/users/bors/followers", "following_url": "https://api.github.com/users/bors/following{/other_user}", "gists_url": "https://api.github.com/users/bors/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors/subscriptions", "organizations_url": "https://api.github.com/users/bors/orgs", "repos_url": "https://api.github.com/users/bors/repos", "events_url": "https://api.github.com/users/bors/events{/privacy}", "received_events_url": "https://api.github.com/users/bors/received_events", "type": "User", "site_admin": false}, "reactions": {"url": "https://api.github.com/repos/rust-lang/rust/issues/57277/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rust-lang/rust/issues/57277/timeline", "performed_via_github_app": null, "state_reason": "completed"}