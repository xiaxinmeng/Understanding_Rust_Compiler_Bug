{"url": "https://api.github.com/repos/rust-lang/rust/issues/52684", "repository_url": "https://api.github.com/repos/rust-lang/rust", "labels_url": "https://api.github.com/repos/rust-lang/rust/issues/52684/labels{/name}", "comments_url": "https://api.github.com/repos/rust-lang/rust/issues/52684/comments", "events_url": "https://api.github.com/repos/rust-lang/rust/issues/52684/events", "html_url": "https://github.com/rust-lang/rust/issues/52684", "id": 344283842, "node_id": "MDU6SXNzdWUzNDQyODM4NDI=", "number": 52684, "title": "\"ld: unknown option: --as-needed\" when trying to cross-compile on macOS High Sierra", "user": {"login": "parasyte", "id": 456942, "node_id": "MDQ6VXNlcjQ1Njk0Mg==", "avatar_url": "https://avatars.githubusercontent.com/u/456942?v=4", "gravatar_id": "", "url": "https://api.github.com/users/parasyte", "html_url": "https://github.com/parasyte", "followers_url": "https://api.github.com/users/parasyte/followers", "following_url": "https://api.github.com/users/parasyte/following{/other_user}", "gists_url": "https://api.github.com/users/parasyte/gists{/gist_id}", "starred_url": "https://api.github.com/users/parasyte/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/parasyte/subscriptions", "organizations_url": "https://api.github.com/users/parasyte/orgs", "repos_url": "https://api.github.com/users/parasyte/repos", "events_url": "https://api.github.com/users/parasyte/events{/privacy}", "received_events_url": "https://api.github.com/users/parasyte/received_events", "type": "User", "site_admin": false}, "labels": [], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 5, "created_at": "2018-07-25T03:58:58Z", "updated_at": "2019-02-11T10:28:28Z", "closed_at": "2018-10-20T02:32:26Z", "author_association": "NONE", "active_lock_reason": null, "body": "```\r\n$ rustc --version\r\nrustc 1.29.0-nightly (6a1c0637c 2018-07-23)\r\n$ cargo --version\r\ncargo 1.29.0-nightly (506eea76e 2018-07-17)\r\n$ system_profiler SPSoftwareDataType | grep Version\r\n      System Version: macOS 10.13.6 (17G65)\r\n      Kernel Version: Darwin 17.7.0\r\n```\r\n\r\nTrying to cross-compile an empty project produces the following error:\r\n\r\n```\r\n$ cargo xbuild --target arm-unknown-linux-gnueabi\r\n   Compiling core v0.0.0 (file:///Users/parasyte/.rustup/toolchains/nightly-x86_64-apple-darwin/lib/rustlib/src/rust/src/libcore)\r\n    Finished release [optimized] target(s) in 14.30s\r\n   Compiling compiler_builtins v0.1.0 (file:///Users/parasyte/.rustup/toolchains/nightly-x86_64-apple-darwin/lib/rustlib/src/rust/src/libcompiler_builtins)\r\n    Finished release [optimized] target(s) in 2.35s\r\n   Compiling alloc v0.0.0 (file:///var/folders/f0/yjjsr3hj2418r3lpmkk9gnt40000gn/T/xargo.udCKkKuWiteB)\r\n    Finished release [optimized] target(s) in 3.63s\r\n   Compiling hello v0.1.0 (file:///Users/parasyte/projects/hello)\r\nerror: linking with `cc` failed: exit code: 1\r\n  |\r\n  = note: \"cc\" \"-Wl,--as-needed\" \"-Wl,-z,noexecstack\" \"-L\" \"/Users/parasyte/projects/hello/target/sysroot/lib/rustlib/arm-unknown-linux-gnueabi/lib\" \"/Users/parasyte/projects/hello/target/arm-unknown-linux-gnueabi/debug/deps/hello-340ef4d54d297181.3t4xfi2w3lflthfy.rcgu.o\" \"-o\" \"/Users/parasyte/projects/hello/target/arm-unknown-linux-gnueabi/debug/deps/hello-340ef4d54d297181\" \"-Wl,--gc-sections\" \"-pie\" \"-Wl,-z,relro,-z,now\" \"-nodefaultlibs\" \"-L\" \"/Users/parasyte/projects/hello/target/arm-unknown-linux-gnueabi/debug/deps\" \"-L\" \"/Users/parasyte/projects/hello/target/debug/deps\" \"-L\" \"/Users/parasyte/projects/hello/target/sysroot/lib/rustlib/arm-unknown-linux-gnueabi/lib\" \"-Wl,-Bstatic\" \"/Users/parasyte/projects/hello/target/sysroot/lib/rustlib/arm-unknown-linux-gnueabi/lib/libcore-74a284b34eb3c484.rlib\" \"/Users/parasyte/projects/hello/target/sysroot/lib/rustlib/arm-unknown-linux-gnueabi/lib/libcompiler_builtins-15e6f22f9525c765.rlib\" \"-Wl,-Bdynamic\"\r\n  = note: clang: warning: argument unused during compilation: '-pie' [-Wunused-command-line-argument]\r\n          ld: unknown option: --as-needed\r\n          clang: error: linker command failed with exit code 1 (use -v to see invocation)\r\n```\r\n\r\nSame failure with the `mips-unknown-linux-gnu` target triple, as well.\r\n\r\nHere's the project source:\r\n\r\n```rust\r\n// src/main.rs\r\n\r\n#![feature(panic_implementation)]\r\n#![no_std]\r\n#![no_main]\r\n\r\nuse core::panic::PanicInfo;\r\n\r\n#[no_mangle]\r\npub extern \"C\" fn _start() -> ! {\r\n    loop {}\r\n}\r\n\r\n/// This function is called on panic.\r\n#[panic_implementation]\r\n#[no_mangle]\r\npub fn panic(_info: &PanicInfo) -> ! {\r\n    loop {}\r\n}\r\n```\r\n\r\n```toml\r\n# Cargo.toml\r\n\r\n[package]\r\nname = \"hello\"\r\nversion = \"0.1.0\"\r\nauthors = [\"Jay Oster <jay@kodewerx.org>\"]\r\n\r\n[profile.dev]\r\npanic = \"abort\"\r\n\r\n[profile.release]\r\npanic = \"abort\"\r\n\r\n[dependencies]\r\n```", "closed_by": {"login": "alexcrichton", "id": 64996, "node_id": "MDQ6VXNlcjY0OTk2", "avatar_url": "https://avatars.githubusercontent.com/u/64996?v=4", "gravatar_id": "", "url": "https://api.github.com/users/alexcrichton", "html_url": "https://github.com/alexcrichton", "followers_url": "https://api.github.com/users/alexcrichton/followers", "following_url": "https://api.github.com/users/alexcrichton/following{/other_user}", "gists_url": "https://api.github.com/users/alexcrichton/gists{/gist_id}", "starred_url": "https://api.github.com/users/alexcrichton/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/alexcrichton/subscriptions", "organizations_url": "https://api.github.com/users/alexcrichton/orgs", "repos_url": "https://api.github.com/users/alexcrichton/repos", "events_url": "https://api.github.com/users/alexcrichton/events{/privacy}", "received_events_url": "https://api.github.com/users/alexcrichton/received_events", "type": "User", "site_admin": false}, "reactions": {"url": "https://api.github.com/repos/rust-lang/rust/issues/52684/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rust-lang/rust/issues/52684/timeline", "performed_via_github_app": null, "state_reason": "completed"}