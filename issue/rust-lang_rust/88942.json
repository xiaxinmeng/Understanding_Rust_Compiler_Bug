{"url": "https://api.github.com/repos/rust-lang/rust/issues/88942", "repository_url": "https://api.github.com/repos/rust-lang/rust", "labels_url": "https://api.github.com/repos/rust-lang/rust/issues/88942/labels{/name}", "comments_url": "https://api.github.com/repos/rust-lang/rust/issues/88942/comments", "events_url": "https://api.github.com/repos/rust-lang/rust/issues/88942/events", "html_url": "https://github.com/rust-lang/rust/issues/88942", "id": 996386418, "node_id": "I_kwDOAAsO6M47Y6Zy", "number": 88942, "title": "mips64-unknown-linux-gnuabi64 rustc unable to produce mips4 binary", "user": {"login": "cyborgyn", "id": 29096248, "node_id": "MDQ6VXNlcjI5MDk2MjQ4", "avatar_url": "https://avatars.githubusercontent.com/u/29096248?v=4", "gravatar_id": "", "url": "https://api.github.com/users/cyborgyn", "html_url": "https://github.com/cyborgyn", "followers_url": "https://api.github.com/users/cyborgyn/followers", "following_url": "https://api.github.com/users/cyborgyn/following{/other_user}", "gists_url": "https://api.github.com/users/cyborgyn/gists{/gist_id}", "starred_url": "https://api.github.com/users/cyborgyn/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/cyborgyn/subscriptions", "organizations_url": "https://api.github.com/users/cyborgyn/orgs", "repos_url": "https://api.github.com/users/cyborgyn/repos", "events_url": "https://api.github.com/users/cyborgyn/events{/privacy}", "received_events_url": "https://api.github.com/users/cyborgyn/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 106552066, "node_id": "MDU6TGFiZWwxMDY1NTIwNjY=", "url": "https://api.github.com/repos/rust-lang/rust/labels/O-MIPS", "name": "O-MIPS", "color": "6e6ec0", "default": false, "description": "Target: MIPS processors"}, {"id": 632453790, "node_id": "MDU6TGFiZWw2MzI0NTM3OTA=", "url": "https://api.github.com/repos/rust-lang/rust/labels/A-target-specs", "name": "A-target-specs", "color": "f7e101", "default": false, "description": "Area: compile-target specifications"}, {"id": 650731663, "node_id": "MDU6TGFiZWw2NTA3MzE2NjM=", "url": "https://api.github.com/repos/rust-lang/rust/labels/C-bug", "name": "C-bug", "color": "f5f1fd", "default": false, "description": "Category: This is a bug."}], "state": "open", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 6, "created_at": "2021-09-14T20:03:22Z", "updated_at": "2021-11-18T11:59:34Z", "closed_at": null, "author_association": "NONE", "active_lock_reason": null, "body": "I am trying to compile rustc, and some applications written in rust for my SGI R10000 workstation, with 64 bit Linux on it.\r\nFound out, that even though I specify -Ctarget-cpu=mips4 for rustc, it always produces MIPS64r2 binaries.\r\nR8000 and later mips CPUs implement MIPS4 architecture, which is a subset of MIPS64 ISA and subset of MIPS32 ISA.\r\n\r\nI found, that the default settings in https://github.com/rust-lang/rust/blob/master/compiler/rustc_target/src/spec/mips64_unknown_linux_gnuabi64.rs is too restrictive, and it seems one can not downgrade by passing target-cpu parameter, what is defined in this file (even though, mips3 was the first ISA to support 64bit instructions), and by passing, it silently ignores, and generates executables:\r\n```\r\nELF 64-bit MSB pie executable, MIPS, MIPS64 rel2 version 1 (SYSV), dynamically linked, interpreter /lib64/ld.so.1, for GNU/Linux 3.2.0, not stripped\u000f\r\n```\r\nBy applying a simple patch like this:\r\n```\r\n--- compiler/rustc_target/src/spec/mips64_unknown_linux_gnuabi64.rs.old        2021-09-14 16:20:48.323014516 +0200\r\n+++ compiler/rustc_target/src/spec/mips64_unknown_linux_gnuabi64.rs    2021-09-14 16:21:43.482314818 +0200\r\n@@ -10,8 +10,8 @@\r\n         options: TargetOptions {\r\n             endian: Endian::Big,\r\n             // NOTE(mips64r2) matches C toolchain\r\n-            cpu: \"mips64r2\".to_string(),\r\n-            features: \"+mips64r2\".to_string(),\r\n+            cpu: \"mips4\".to_string(),\r\n+            features: \"+mips4\".to_string(),\r\n             max_atomic_width: Some(64),\r\n             mcount: \"_mcount\".to_string(),\r\n```\r\nI was able to finally compile executables for R10000 CPU:\r\n```\r\nELF 64-bit MSB pie executable, MIPS, MIPS-IV version 1 (SYSV), dynamically linked, interpreter /lib64/ld.so.1, for GNU/Linux 3.2.0, not stripped\r\n```\r\nAnd the -Ctarget-cpu=mips64r2 also worked, to generate what was before the default.\r\n\r\nI propose to lower the default / minimum required CPU from mips64r2 to mips3, or mips4.\r\n", "closed_by": null, "reactions": {"url": "https://api.github.com/repos/rust-lang/rust/issues/88942/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rust-lang/rust/issues/88942/timeline", "performed_via_github_app": null, "state_reason": null}