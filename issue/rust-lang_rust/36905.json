{"url": "https://api.github.com/repos/rust-lang/rust/issues/36905", "repository_url": "https://api.github.com/repos/rust-lang/rust", "labels_url": "https://api.github.com/repos/rust-lang/rust/issues/36905/labels{/name}", "comments_url": "https://api.github.com/repos/rust-lang/rust/issues/36905/comments", "events_url": "https://api.github.com/repos/rust-lang/rust/issues/36905/events", "html_url": "https://github.com/rust-lang/rust/issues/36905", "id": 180499401, "node_id": "MDU6SXNzdWUxODA0OTk0MDE=", "number": 36905, "title": "performance regression and occasionnal dead-lock when linking with llvm 3.9", "user": {"login": "semarie", "id": 8948701, "node_id": "MDQ6VXNlcjg5NDg3MDE=", "avatar_url": "https://avatars.githubusercontent.com/u/8948701?v=4", "gravatar_id": "", "url": "https://api.github.com/users/semarie", "html_url": "https://github.com/semarie", "followers_url": "https://api.github.com/users/semarie/followers", "following_url": "https://api.github.com/users/semarie/following{/other_user}", "gists_url": "https://api.github.com/users/semarie/gists{/gist_id}", "starred_url": "https://api.github.com/users/semarie/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/semarie/subscriptions", "organizations_url": "https://api.github.com/users/semarie/orgs", "repos_url": "https://api.github.com/users/semarie/repos", "events_url": "https://api.github.com/users/semarie/events{/privacy}", "received_events_url": "https://api.github.com/users/semarie/received_events", "type": "User", "site_admin": false}, "labels": [], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 7, "created_at": "2016-10-02T07:11:16Z", "updated_at": "2016-10-04T16:11:21Z", "closed_at": "2016-10-04T16:11:21Z", "author_association": "CONTRIBUTOR", "active_lock_reason": null, "body": "I experiment some problems with rustc 1.12.0 (under OpenBSD):\n- when builded with system LLVM 3.8.1 : seems ok\n- when builded with system LLVM 3.9.0 (with additionnal patch rL281650 for #36474) : problems\n- when builded with embedded LLVM: still problems\n\nThere are two kind of problems:\n- performance regression from stable to stable : I saw lot of `xxx has been running for over 60 seconds` messages in make check\n- occasionnally rustc compiler dead-lock: all threads are in `thrslee` state.\n\nFor the performance problem, by tracing the syscalls I saw lot of `__thrsleep()`, `__thrwakeup()` and `sched_yield()` dance: the process makes high usage of thread-syscalls, and it slows down.\n\nSome stats for 1 second, I have 16314 syscalls:\n- 7344 __thrwakeup\n- 7343 __thrsleep\n- 1605 sched_yield\n-   11 mmap\n-    4 write\n-    4 mquery\n-    2 munmap\n-   1 fstat\n\nFor this second, by thread:\n- thread 1031567:\n  - 1850 __thrsleep\n  - 1850 __thrwakeup\n  - 443 sched_yield\n- thread 1048099\n  - 1848  __thrsleep\n  - 1848 __thrwakeup\n  -  298 sched_yield\n- thread 1056179:\n  - 1844  __thrsleep\n  - 1844  __thrwakeup\n  - 483  sched_yield\n  - 4  write\n  -   3  mmap\n  -    2  mquery\n  -  1  munmap\n  -    1  fstat\n- thread 1065035:\n  - 1801  __thrsleep\n  - 1802  __thrwakeup\n  -  381  sched_yield\n  - 8  mmap\n  - 2  mquery\n  - 1  munmap\n\nI am unsure about the way to better describe the problem or reduce it.\n", "closed_by": {"login": "semarie", "id": 8948701, "node_id": "MDQ6VXNlcjg5NDg3MDE=", "avatar_url": "https://avatars.githubusercontent.com/u/8948701?v=4", "gravatar_id": "", "url": "https://api.github.com/users/semarie", "html_url": "https://github.com/semarie", "followers_url": "https://api.github.com/users/semarie/followers", "following_url": "https://api.github.com/users/semarie/following{/other_user}", "gists_url": "https://api.github.com/users/semarie/gists{/gist_id}", "starred_url": "https://api.github.com/users/semarie/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/semarie/subscriptions", "organizations_url": "https://api.github.com/users/semarie/orgs", "repos_url": "https://api.github.com/users/semarie/repos", "events_url": "https://api.github.com/users/semarie/events{/privacy}", "received_events_url": "https://api.github.com/users/semarie/received_events", "type": "User", "site_admin": false}, "reactions": {"url": "https://api.github.com/repos/rust-lang/rust/issues/36905/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rust-lang/rust/issues/36905/timeline", "performed_via_github_app": null, "state_reason": "completed"}