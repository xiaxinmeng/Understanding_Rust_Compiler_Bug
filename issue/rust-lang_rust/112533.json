{"url": "https://api.github.com/repos/rust-lang/rust/issues/112533", "repository_url": "https://api.github.com/repos/rust-lang/rust", "labels_url": "https://api.github.com/repos/rust-lang/rust/issues/112533/labels{/name}", "comments_url": "https://api.github.com/repos/rust-lang/rust/issues/112533/comments", "events_url": "https://api.github.com/repos/rust-lang/rust/issues/112533/events", "html_url": "https://github.com/rust-lang/rust/issues/112533", "id": 1751563127, "node_id": "I_kwDOAAsO6M5oZrt3", "number": 112533, "title": "Unused symbols being exported", "user": {"login": "p2jason", "id": 53956120, "node_id": "MDQ6VXNlcjUzOTU2MTIw", "avatar_url": "https://avatars.githubusercontent.com/u/53956120?v=4", "gravatar_id": "", "url": "https://api.github.com/users/p2jason", "html_url": "https://github.com/p2jason", "followers_url": "https://api.github.com/users/p2jason/followers", "following_url": "https://api.github.com/users/p2jason/following{/other_user}", "gists_url": "https://api.github.com/users/p2jason/gists{/gist_id}", "starred_url": "https://api.github.com/users/p2jason/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/p2jason/subscriptions", "organizations_url": "https://api.github.com/users/p2jason/orgs", "repos_url": "https://api.github.com/users/p2jason/repos", "events_url": "https://api.github.com/users/p2jason/events{/privacy}", "received_events_url": "https://api.github.com/users/p2jason/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 37547, "node_id": "MDU6TGFiZWwzNzU0Nw==", "url": "https://api.github.com/repos/rust-lang/rust/labels/A-linkage", "name": "A-linkage", "color": "f7e101", "default": false, "description": "Area: linking into static, shared libraries and binaries"}, {"id": 1049491442, "node_id": "MDU6TGFiZWwxMDQ5NDkxNDQy", "url": "https://api.github.com/repos/rust-lang/rust/labels/I-heavy", "name": "I-heavy", "color": "e10c02", "default": false, "description": "Problems and improvements with respect to binary size of generated code."}, {"id": 1472563007, "node_id": "MDU6TGFiZWwxNDcyNTYzMDA3", "url": "https://api.github.com/repos/rust-lang/rust/labels/requires-nightly", "name": "requires-nightly", "color": "76dcde", "default": false, "description": "This issue requires a nightly compiler in some way."}, {"id": 5257912668, "node_id": "LA_kwDOAAsO6M8AAAABOWVhXA", "url": "https://api.github.com/repos/rust-lang/rust/labels/-Zbuild-std", "name": "-Zbuild-std", "color": "382EF0", "default": false, "description": ""}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 5, "created_at": "2023-06-11T19:01:38Z", "updated_at": "2023-06-17T21:48:54Z", "closed_at": "2023-06-17T21:48:54Z", "author_association": "NONE", "active_lock_reason": null, "body": "Hi there,\r\n\r\nI am writing a small library (`staticlib`) for an OS project. This library only needs to export one function and is linked with a program written in assembly that ends up calling that function. Unfortunately, rustc is exporting way too many functions and the final binary ends up being way larger than it needs to be.\r\n\r\nI know this is an issue that others have had before, such as #18541 and #37530, but none of the solutions I've found so far have workws for me. I've also tried using [version scripts](https://www.gnu.org/software/gnulib/manual/html_node/LD-Version-Scripts.html) and I've tried stripping the library, but those either didn't work or broke something in the process.\r\n\r\nHere is a small reproducible setup:\r\n\r\nFile `.cargo/config.toml`:\r\n\r\n\t[unstable]\r\n\tbuild-std-features = [\"compiler-builtins-mem\"]\r\n\tbuild-std = [\"core\", \"compiler_builtins\"]\r\n\r\nFile `src/lib.rs`:\r\n\r\n\t#![no_std]\r\n\t#![no_main]\r\n\r\n\t#[panic_handler]\r\n\tfn panic(_info: &core::panic::PanicInfo) -> ! { loop {} }\r\n\r\n\t#[no_mangle]\r\n\tpub extern \"C\" fn _test_start() {\r\n\t\t\r\n\t}\r\n\r\nFile `Cargo.toml`:\r\n\r\n\t[package]\r\n\tname = \"test\"\r\n\tversion = \"0.1.0\"\r\n\r\n\t[lib]\r\n\tcrate-type = [\"staticlib\"]\r\n\r\n\t[profile.release]\r\n\tpanic = \"abort\"\r\n\r\n\t[profile.dev]\r\n\tpanic = \"abort\"\r\n\r\nI am also using the nightly version of rust.\r\n\r\nIs there a way to get the rust compiler to export only the functions I need?", "closed_by": {"login": "p2jason", "id": 53956120, "node_id": "MDQ6VXNlcjUzOTU2MTIw", "avatar_url": "https://avatars.githubusercontent.com/u/53956120?v=4", "gravatar_id": "", "url": "https://api.github.com/users/p2jason", "html_url": "https://github.com/p2jason", "followers_url": "https://api.github.com/users/p2jason/followers", "following_url": "https://api.github.com/users/p2jason/following{/other_user}", "gists_url": "https://api.github.com/users/p2jason/gists{/gist_id}", "starred_url": "https://api.github.com/users/p2jason/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/p2jason/subscriptions", "organizations_url": "https://api.github.com/users/p2jason/orgs", "repos_url": "https://api.github.com/users/p2jason/repos", "events_url": "https://api.github.com/users/p2jason/events{/privacy}", "received_events_url": "https://api.github.com/users/p2jason/received_events", "type": "User", "site_admin": false}, "reactions": {"url": "https://api.github.com/repos/rust-lang/rust/issues/112533/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rust-lang/rust/issues/112533/timeline", "performed_via_github_app": null, "state_reason": "completed"}