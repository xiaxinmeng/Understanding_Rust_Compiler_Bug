{"url": "https://api.github.com/repos/rust-lang/rust/issues/40406", "repository_url": "https://api.github.com/repos/rust-lang/rust", "labels_url": "https://api.github.com/repos/rust-lang/rust/issues/40406/labels{/name}", "comments_url": "https://api.github.com/repos/rust-lang/rust/issues/40406/comments", "events_url": "https://api.github.com/repos/rust-lang/rust/issues/40406/events", "html_url": "https://github.com/rust-lang/rust/issues/40406", "id": 213209020, "node_id": "MDU6SXNzdWUyMTMyMDkwMjA=", "number": 40406, "title": "'fma' is missing in target-feature ", "user": {"login": "fsasm", "id": 4449071, "node_id": "MDQ6VXNlcjQ0NDkwNzE=", "avatar_url": "https://avatars.githubusercontent.com/u/4449071?v=4", "gravatar_id": "", "url": "https://api.github.com/users/fsasm", "html_url": "https://github.com/fsasm", "followers_url": "https://api.github.com/users/fsasm/followers", "following_url": "https://api.github.com/users/fsasm/following{/other_user}", "gists_url": "https://api.github.com/users/fsasm/gists{/gist_id}", "starred_url": "https://api.github.com/users/fsasm/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/fsasm/subscriptions", "organizations_url": "https://api.github.com/users/fsasm/orgs", "repos_url": "https://api.github.com/users/fsasm/repos", "events_url": "https://api.github.com/users/fsasm/events{/privacy}", "received_events_url": "https://api.github.com/users/fsasm/received_events", "type": "User", "site_admin": false}, "labels": [], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 2, "created_at": "2017-03-10T00:35:58Z", "updated_at": "2017-03-12T05:27:41Z", "closed_at": "2017-03-12T05:27:41Z", "author_association": "CONTRIBUTOR", "active_lock_reason": null, "body": "When setting `target-feature=+fma` and printing the features via `--print cfg` only avx and sse* are listed as target features. Also queries like `#[cfg(target_feature = \"fma\")]` do not detect fma. FMA instructions like `x86_mm256_fmadd_ps` are only usable when fma is enable via target-feature as expected. \r\n\r\nThe output of `rustc -C target-feature=+fma --print cfg` is \r\n```\r\ndebug_assertions\r\ntarget_arch=\"x86_64\"\r\ntarget_endian=\"little\"\r\ntarget_env=\"gnu\"\r\ntarget_family=\"unix\"\r\ntarget_feature=\"avx\"\r\ntarget_feature=\"sse\"\r\ntarget_feature=\"sse2\"\r\ntarget_feature=\"sse3\"\r\ntarget_feature=\"sse4.1\"\r\ntarget_feature=\"sse4.2\"\r\ntarget_feature=\"ssse3\"\r\ntarget_has_atomic=\"16\"\r\ntarget_has_atomic=\"32\"\r\ntarget_has_atomic=\"64\"\r\ntarget_has_atomic=\"8\"\r\ntarget_has_atomic=\"ptr\"\r\ntarget_os=\"linux\"\r\ntarget_pointer_width=\"64\"\r\ntarget_thread_local\r\ntarget_vendor=\"unknown\"\r\nunix\r\n```\r\nand the expected output is\r\n```\r\n[...]\r\ntarget_feature=\"fma\"\r\ntarget_feature=\"avx\"\r\ntarget_feature=\"sse\"\r\ntarget_feature=\"sse2\"\r\ntarget_feature=\"sse3\"\r\ntarget_feature=\"sse4.1\"\r\ntarget_feature=\"sse4.2\"\r\ntarget_feature=\"ssse3\"\r\n[...]\r\n```\r\nAlso this example\r\n```\r\n#![feature(cfg_target_feature)]\r\n\r\nfn main() {\r\n    #[cfg(target_feature = \"fma\")]\r\n    println!(\"FMA is supported\");\r\n\r\n    #[cfg(not(target_feature = \"fma\"))]\r\n    println!(\"FMA is not supported\");\r\n}\r\n```\r\noutputs `FMA is not supported` even if it was enabled.\r\n\r\n## Meta\r\n`rustc --version --verbose`:\r\nrustc 1.17.0-nightly (b1e31766d 2017-03-03)\r\nbinary: rustc\r\ncommit-hash: b1e31766da75b188062c59f38cd6e8544b902afd\r\ncommit-date: 2017-03-03\r\nhost: x86_64-unknown-linux-gnu\r\nrelease: 1.17.0-nightly\r\nLLVM version: 3.9\r\n\r\n", "closed_by": {"login": "bors", "id": 3372342, "node_id": "MDQ6VXNlcjMzNzIzNDI=", "avatar_url": "https://avatars.githubusercontent.com/u/3372342?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors", "html_url": "https://github.com/bors", "followers_url": "https://api.github.com/users/bors/followers", "following_url": "https://api.github.com/users/bors/following{/other_user}", "gists_url": "https://api.github.com/users/bors/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors/subscriptions", "organizations_url": "https://api.github.com/users/bors/orgs", "repos_url": "https://api.github.com/users/bors/repos", "events_url": "https://api.github.com/users/bors/events{/privacy}", "received_events_url": "https://api.github.com/users/bors/received_events", "type": "User", "site_admin": false}, "reactions": {"url": "https://api.github.com/repos/rust-lang/rust/issues/40406/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rust-lang/rust/issues/40406/timeline", "performed_via_github_app": null, "state_reason": "completed"}