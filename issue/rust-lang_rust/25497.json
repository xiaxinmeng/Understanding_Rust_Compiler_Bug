{"url": "https://api.github.com/repos/rust-lang/rust/issues/25497", "repository_url": "https://api.github.com/repos/rust-lang/rust", "labels_url": "https://api.github.com/repos/rust-lang/rust/issues/25497/labels{/name}", "comments_url": "https://api.github.com/repos/rust-lang/rust/issues/25497/comments", "events_url": "https://api.github.com/repos/rust-lang/rust/issues/25497/events", "html_url": "https://github.com/rust-lang/rust/issues/25497", "id": 77102620, "node_id": "MDU6SXNzdWU3NzEwMjYyMA==", "number": 25497, "title": "rustc fails with: LLVM ERROR: Broken function found, compilation aborted!", "user": {"login": "niconiconico9", "id": 12476015, "node_id": "MDQ6VXNlcjEyNDc2MDE1", "avatar_url": "https://avatars.githubusercontent.com/u/12476015?v=4", "gravatar_id": "", "url": "https://api.github.com/users/niconiconico9", "html_url": "https://github.com/niconiconico9", "followers_url": "https://api.github.com/users/niconiconico9/followers", "following_url": "https://api.github.com/users/niconiconico9/following{/other_user}", "gists_url": "https://api.github.com/users/niconiconico9/gists{/gist_id}", "starred_url": "https://api.github.com/users/niconiconico9/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/niconiconico9/subscriptions", "organizations_url": "https://api.github.com/users/niconiconico9/orgs", "repos_url": "https://api.github.com/users/niconiconico9/repos", "events_url": "https://api.github.com/users/niconiconico9/events{/privacy}", "received_events_url": "https://api.github.com/users/niconiconico9/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 108333, "node_id": "MDU6TGFiZWwxMDgzMzM=", "url": "https://api.github.com/repos/rust-lang/rust/labels/A-LLVM", "name": "A-LLVM", "color": "f7e101", "default": false, "description": "Area: Code generation parts specific to LLVM. Both correctness bugs and optimization-related issues."}, {"id": 234956, "node_id": "MDU6TGFiZWwyMzQ5NTY=", "url": "https://api.github.com/repos/rust-lang/rust/labels/A-codegen", "name": "A-codegen", "color": "f7e101", "default": false, "description": "Area: Code generation"}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 7, "created_at": "2015-05-16T18:50:01Z", "updated_at": "2015-05-20T15:33:05Z", "closed_at": "2015-05-20T15:33:05Z", "author_association": "NONE", "active_lock_reason": null, "body": "Rust compiler (rustc 1.1.0-nightly (e5394240a 2015-05-14) (built 2015-05-14) fails to compile this source:\n\n``` rust\n#![feature(box_patterns)]\n\nmod test {\n    #[derive(Debug)]\n    #[derive(Clone)]\n    pub enum Expression {\n        Var(String),\n        Const(i64),\n        Add(Box<Expression>, Box<Expression>),\n        Mul(Box<Expression>, Box<Expression>)\n    }\n\n    pub use self::Expression::*;\n\n    fn simplify1(exp: &Expression) -> Expression {\n        match *exp {\n            Add(box Const(0), ref n) | Add(ref n, box Const(0)) => *n.clone(),\n            Mul(box Const(1), ref n) | Mul(ref n, box Const(1)) => *n.clone(),\n            Mul(box Const(0), _) | Mul(_, box Const(0)) => Const(0),\n            Add(box Const(n), box Const(m)) => Const(n + m),\n            Mul(box Const(n), box Const(m)) => Const(n * m),\n            _ => exp.clone()\n        }\n    }\n\n    pub fn simplify(exp: &Expression) -> Expression {\n        match *exp {\n            Add(ref n, ref m) => simplify1(&(Add(Box::new(simplify1(n)), Box::new(simplify1(m))))),\n            Mul(ref n, ref m) => simplify1(&(Add(Box::new(simplify1(n)), Box::new(simplify1(m))))),\n            _ => exp.clone()\n        }\n    }\n}\nfn main() {\n    use test::*;\n    let e = Add(Box::new(Const(1)), Box::new(Const(29)));\n    let e1 = simplify(&e);\n    println!(\"{:?}\", e1);\n}\n```\n\nWith the error:\n\n```\nInstruction does not dominate all uses!\n  %10 = load %\"test::Expression\"** %2, align 8, !nonnull !0\n  %96 = bitcast %\"test::Expression\"* %10 to i8*\nInstruction does not dominate all uses!\n  %91 = load %\"test::Expression\"** %3, align 8, !nonnull !0\n  %99 = bitcast %\"test::Expression\"* %91 to i8*\nInstruction does not dominate all uses!\n  %10 = load %\"test::Expression\"** %2, align 8, !nonnull !0\n  %100 = bitcast %\"test::Expression\"* %10 to i8*\nInstruction does not dominate all uses!\n  %91 = load %\"test::Expression\"** %3, align 8, !nonnull !0\n  %102 = bitcast %\"test::Expression\"* %91 to i8*\nInstruction does not dominate all uses!\n  %10 = load %\"test::Expression\"** %2, align 8, !nonnull !0\n  %103 = bitcast %\"test::Expression\"* %10 to i8*\nLLVM ERROR: Broken function found, compilation aborted!\n```\n\nI can reproduce this ICE also on play.rust-lang.org\n", "closed_by": {"login": "bors", "id": 3372342, "node_id": "MDQ6VXNlcjMzNzIzNDI=", "avatar_url": "https://avatars.githubusercontent.com/u/3372342?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors", "html_url": "https://github.com/bors", "followers_url": "https://api.github.com/users/bors/followers", "following_url": "https://api.github.com/users/bors/following{/other_user}", "gists_url": "https://api.github.com/users/bors/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors/subscriptions", "organizations_url": "https://api.github.com/users/bors/orgs", "repos_url": "https://api.github.com/users/bors/repos", "events_url": "https://api.github.com/users/bors/events{/privacy}", "received_events_url": "https://api.github.com/users/bors/received_events", "type": "User", "site_admin": false}, "reactions": {"url": "https://api.github.com/repos/rust-lang/rust/issues/25497/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rust-lang/rust/issues/25497/timeline", "performed_via_github_app": null, "state_reason": "completed"}