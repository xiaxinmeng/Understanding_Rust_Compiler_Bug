{"url": "https://api.github.com/repos/rust-lang/rust/issues/59907", "repository_url": "https://api.github.com/repos/rust-lang/rust", "labels_url": "https://api.github.com/repos/rust-lang/rust/issues/59907/labels{/name}", "comments_url": "https://api.github.com/repos/rust-lang/rust/issues/59907/comments", "events_url": "https://api.github.com/repos/rust-lang/rust/issues/59907/events", "html_url": "https://github.com/rust-lang/rust/issues/59907", "id": 432390792, "node_id": "MDU6SXNzdWU0MzIzOTA3OTI=", "number": 59907, "title": "Unable to resolve breakpoints when debugging a unit test in a lib target", "user": {"login": "mchernyavsky", "id": 6079006, "node_id": "MDQ6VXNlcjYwNzkwMDY=", "avatar_url": "https://avatars.githubusercontent.com/u/6079006?v=4", "gravatar_id": "", "url": "https://api.github.com/users/mchernyavsky", "html_url": "https://github.com/mchernyavsky", "followers_url": "https://api.github.com/users/mchernyavsky/followers", "following_url": "https://api.github.com/users/mchernyavsky/following{/other_user}", "gists_url": "https://api.github.com/users/mchernyavsky/gists{/gist_id}", "starred_url": "https://api.github.com/users/mchernyavsky/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/mchernyavsky/subscriptions", "organizations_url": "https://api.github.com/users/mchernyavsky/orgs", "repos_url": "https://api.github.com/users/mchernyavsky/repos", "events_url": "https://api.github.com/users/mchernyavsky/events{/privacy}", "received_events_url": "https://api.github.com/users/mchernyavsky/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 123111, "node_id": "MDU6TGFiZWwxMjMxMTE=", "url": "https://api.github.com/repos/rust-lang/rust/labels/O-macos", "name": "O-macos", "color": "6e6ec0", "default": false, "description": "Operating system: macOS"}, {"id": 203130, "node_id": "MDU6TGFiZWwyMDMxMzA=", "url": "https://api.github.com/repos/rust-lang/rust/labels/A-debuginfo", "name": "A-debuginfo", "color": "f7e101", "default": false, "description": "Area: Debugging information in compiled programs (DWARF, PDB, etc.)"}, {"id": 211668100, "node_id": "MDU6TGFiZWwyMTE2NjgxMDA=", "url": "https://api.github.com/repos/rust-lang/rust/labels/T-compiler", "name": "T-compiler", "color": "bfd4f2", "default": false, "description": "Relevant to the compiler team, which will review and decide on the PR/issue."}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 5, "created_at": "2019-04-12T05:15:52Z", "updated_at": "2020-04-23T20:01:27Z", "closed_at": "2020-04-21T18:30:12Z", "author_association": "NONE", "active_lock_reason": null, "body": "## Environment\r\n\r\n* **Operating system:** macOS Mojave 10.14.4\r\n* **Rust toolchain:** nightly-x86_64-apple-darwin\r\n* **Rustc version:** 1.35.0-nightly (96d700f1b 2019-04-10)\r\n\r\n## Problem description\r\n\r\nOn macOS, when you build tests (with `cargo test --no-run`) in a lib target, and right after that run LLDB on the test binary, the debugger unable to resolve breakpoints.\r\n\r\n## Steps to reproduce:\r\n### Example project:\r\n* `Cargo.toml`:\r\n```toml\r\n[package]\r\nname = \"sandbox\"\r\nversion = \"0.1.0\"\r\nedition = \"2018\"\r\n```\r\n* `src/main.rs`:\r\n```rust\r\nfn main() {}\r\n\r\n#[test]\r\nfn test() { assert_eq!(2 + 2, 5) }\r\n```\r\n* `src/lib.rs`:\r\n```rust\r\n#[test]\r\nfn test() { assert_eq!(2 + 2, 4) }\r\n```\r\n### Test script (bash):\r\n* `test.sh`:\r\n```bash\r\n#!/usr/bin/env bash\r\nrm -rf target\r\nEXE=\"$(cargo test --no-run --message-format=json --lib test 2>/dev/null | jq -r '.executable')\"\r\nsleep \"$1\"\r\nlldb \"$EXE\" <<< \"b test\"\r\n```\r\n\r\n* Delay 1 second before running the LLDB:\r\n```bash\r\n> ./test.sh 1\r\n(lldb) target create \"/Users/mikhail.chernyavsky/Workspace/rust-sandbox/target/debug/sandbox-5d25a79faaa6e465\"\r\nCurrent executable set to '/Users/mikhail.chernyavsky/Workspace/rust-sandbox/target/debug/sandbox-5d25a79faaa6e465' (x86_64).\r\n(lldb) b test\r\nBreakpoint 1: no locations (pending).\r\nWARNING:  Unable to resolve breakpoint to any actual locations.\r\n```\r\n\r\n* Delay 2 seconds before running the LLDB:\r\n```bash\r\n> ./test.sh 2\r\n(lldb) target create \"/Users/mikhail.chernyavsky/Workspace/rust-sandbox/target/debug/sandbox-5d25a79faaa6e465\"\r\nCurrent executable set to '/Users/mikhail.chernyavsky/Workspace/rust-sandbox/target/debug/sandbox-5d25a79faaa6e465' (x86_64).\r\n(lldb) b test\r\nBreakpoint 1: where = sandbox-5d25a79faaa6e465`sandbox::test::h95a153b117ba44e2 + 11 at lib.rs:2:23, address = 0x00000001000017bb\r\n```\r\n\r\n## P.S.\r\nI also noticed that the `*.dSYM` file is not listed in the `filenames` field:\r\n```bash\r\n> cargo test --no-run --message-format=json --lib test 2>/dev/null | jq -r '.filenames'\r\n[\r\n  \"/Users/mikhail.chernyavsky/Workspace/rust-sandbox/target/debug/sandbox-5d25a79faaa6e465\"\r\n]\r\n```\r\n\r\nFor example, build unit tests in bin target:\r\n```bash\r\n> cargo test --no-run --message-format=json --bin sandbox 2>/dev/null | jq -r '.filenames'\r\n[\r\n  \"/Users/mikhail.chernyavsky/Workspace/rust-sandbox/target/debug/deps/libsandbox-006b5c7138cbbb04.rlib\"\r\n]\r\n[\r\n  \"/Users/mikhail.chernyavsky/Workspace/rust-sandbox/target/debug/sandbox-94b9126e8bd84c57\",\r\n  \"/Users/mikhail.chernyavsky/Workspace/rust-sandbox/target/debug/sandbox-94b9126e8bd84c57.dSYM\"\r\n]\r\n```", "closed_by": {"login": "mchernyavsky", "id": 6079006, "node_id": "MDQ6VXNlcjYwNzkwMDY=", "avatar_url": "https://avatars.githubusercontent.com/u/6079006?v=4", "gravatar_id": "", "url": "https://api.github.com/users/mchernyavsky", "html_url": "https://github.com/mchernyavsky", "followers_url": "https://api.github.com/users/mchernyavsky/followers", "following_url": "https://api.github.com/users/mchernyavsky/following{/other_user}", "gists_url": "https://api.github.com/users/mchernyavsky/gists{/gist_id}", "starred_url": "https://api.github.com/users/mchernyavsky/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/mchernyavsky/subscriptions", "organizations_url": "https://api.github.com/users/mchernyavsky/orgs", "repos_url": "https://api.github.com/users/mchernyavsky/repos", "events_url": "https://api.github.com/users/mchernyavsky/events{/privacy}", "received_events_url": "https://api.github.com/users/mchernyavsky/received_events", "type": "User", "site_admin": false}, "reactions": {"url": "https://api.github.com/repos/rust-lang/rust/issues/59907/reactions", "total_count": 14, "+1": 14, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rust-lang/rust/issues/59907/timeline", "performed_via_github_app": null, "state_reason": "completed"}