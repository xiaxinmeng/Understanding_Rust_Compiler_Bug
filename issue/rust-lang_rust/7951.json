{"url": "https://api.github.com/repos/rust-lang/rust/issues/7951", "repository_url": "https://api.github.com/repos/rust-lang/rust", "labels_url": "https://api.github.com/repos/rust-lang/rust/issues/7951/labels{/name}", "comments_url": "https://api.github.com/repos/rust-lang/rust/issues/7951/comments", "events_url": "https://api.github.com/repos/rust-lang/rust/issues/7951/events", "html_url": "https://github.com/rust-lang/rust/issues/7951", "id": 17027433, "node_id": "MDU6SXNzdWUxNzAyNzQzMw==", "number": 7951, "title": "test/run-pass/core-rt-smoke crashes on Windows", "user": {"login": "crnobog", "id": 791661, "node_id": "MDQ6VXNlcjc5MTY2MQ==", "avatar_url": "https://avatars.githubusercontent.com/u/791661?v=4", "gravatar_id": "", "url": "https://api.github.com/users/crnobog", "html_url": "https://github.com/crnobog", "followers_url": "https://api.github.com/users/crnobog/followers", "following_url": "https://api.github.com/users/crnobog/following{/other_user}", "gists_url": "https://api.github.com/users/crnobog/gists{/gist_id}", "starred_url": "https://api.github.com/users/crnobog/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/crnobog/subscriptions", "organizations_url": "https://api.github.com/users/crnobog/orgs", "repos_url": "https://api.github.com/users/crnobog/repos", "events_url": "https://api.github.com/users/crnobog/events{/privacy}", "received_events_url": "https://api.github.com/users/crnobog/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 36996, "node_id": "MDU6TGFiZWwzNjk5Ng==", "url": "https://api.github.com/repos/rust-lang/rust/labels/E-easy", "name": "E-easy", "color": "02e10c", "default": false, "description": "Call for participation: Experience needed to fix: Easy / not much (good first issue)"}, {"id": 123109, "node_id": "MDU6TGFiZWwxMjMxMDk=", "url": "https://api.github.com/repos/rust-lang/rust/labels/O-windows", "name": "O-windows", "color": "6e6ec0", "default": false, "description": "Operating system: Windows"}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 4, "created_at": "2013-07-22T01:08:28Z", "updated_at": "2014-05-06T04:43:18Z", "closed_at": "2014-05-06T04:43:18Z", "author_association": "NONE", "active_lock_reason": null, "body": "Starting program: c:\\code\\rust\\i686-pc-mingw32\\test\\run-pass\\core-rt-smoke.stage2-i686-pc-mingw32.exe\n[New Thread 8284.0x2488]\n\nProgram received signal SIGSEGV, Segmentation fault.\n\n``` asm\n0x680d04d3 in rt::args::load_argc_and_argv::_2199da865b9a2acc::_0$x2e8$x2dpre () from c:\\code\\rust\\install\\bin\\std-6c65cf4b443341b1-0.8-pre.dll\n```\n\n(gdb) disassemble\nDump of assembler code for function \n\n``` asm\n_ZN2rt4args18load_argc_and_argv17_2199da865b9a2acc14_0$x2e8$x2dpreE:\n   0x680d0470 <+0>:     cmp    %fs:0x14,%esp\n   0x680d0477 <+7>:     ja     0x680d0489 <_ZN2rt4args18load_argc_and_argv17_2199da865b9a2acc14_0$x2e8$x2dpreE+25>\n   0x680d0479 <+9>:     push   $0xc\n   0x680d047e <+14>:    push   $0x24\n   0x680d0483 <+19>:    call   0x680d42c8 <__morestack>\n   0x680d0488 <+24>:    ret\n   0x680d0489 <+25>:    push   %ebp\n   0x680d048a <+26>:    mov    %esp,%ebp\n   0x680d048c <+28>:    push   %ebx\n   0x680d048d <+29>:    push   %edi\n   0x680d048e <+30>:    push   %esi\n   0x680d048f <+31>:    sub    $0x14,%esp\n   0x680d0492 <+34>:    movl   $0x18,0x4(%esp)\n   0x680d049a <+42>:    call   0x6803acd0 <_ZN4libc5funcs3c956stdlib6malloc16_54e7a493f6e1cfe14_0$x2e8$x2dpreE>\n   0x680d049f <+47>:    mov    %eax,%esi\n   0x680d04a1 <+49>:    test   %esi,%esi\n   0x680d04a3 <+51>:    jne    0x680d04aa <_ZN2rt4args18load_argc_and_argv17_2199da865b9a2acc14_0$x2e8$x2dpreE+58>\n   0x680d04a5 <+53>:    call   0x680dc328 <abort>\n   0x680d04aa <+58>:    movl   $0x0,(%esi)\n   0x680d04b0 <+64>:    movl   $0x10,0x4(%esi)\n   0x680d04b7 <+71>:    mov    %esi,-0x10(%ebp)\n   0x680d04ba <+74>:    cmpl   $0x0,0xc(%ebp)\n   0x680d04be <+78>:    je     0x680d055f <_ZN2rt4args18load_argc_and_argv17_2199da865b9a2acc14_0$x2e8$x2dpreE+239>\n   0x680d04c4 <+84>:    xor    %ebx,%ebx\n   0x680d04c6 <+86>:    lea    -0x10(%ebp),%esi\n   0x680d04c9 <+89>:    nop\n   0x680d04ca <+90>:    nop\n   0x680d04cb <+91>:    nop\n   0x680d04cc <+92>:    nop\n   0x680d04cd <+93>:    nop\n   0x680d04ce <+94>:    nop\n   0x680d04cf <+95>:    nop\n   0x680d04d0 <+96>:    mov    0x10(%ebp),%eax\n=> 0x680d04d3 <+99>:    mov    (%eax,%ebx,4),%eax\n   0x680d04d6 <+102>:   cmpb   $0x0,(%eax)\n   0x680d04d9 <+105>:   mov    $0x0,%ecx\n   0x680d04de <+110>:   je     0x680d04fa <_ZN2rt4args18load_argc_and_argv17_2199da865b9a2acc14_0$x2e8$x2dpreE+138>\n   0x680d04e0 <+112>:   xor    %ecx,%ecx\n```\n\nThe code before the call above:\n\n``` asm\nDump of assembler code for function _ZN2rt5start15_98ebfd32a7b8f114_0$x2e8$x2dpreE:\n=> 0x68082e80 <+0>:     cmp    %fs:0x14,%esp\n   0x68082e87 <+7>:     ja     0x68082e99 <_ZN2rt5start15_98ebfd32a7b8f114_0$x2e8$x2dpreE+25>\n   0x68082e89 <+9>:     push   $0x14\n   0x68082e8e <+14>:    push   $0x2c\n   0x68082e93 <+19>:    call   0x680d42c8 <__morestack>\n   0x68082e98 <+24>:    ret\n   0x68082e99 <+25>:    push   %ebp\n   0x68082e9a <+26>:    mov    %esp,%ebp\n   0x68082e9c <+28>:    push   %edi\n   0x68082e9d <+29>:    push   %esi\n   0x68082e9e <+30>:    and    $0xfffffff8,%esp\n   0x68082ea4 <+36>:    sub    $0x20,%esp\n   0x68082ea7 <+39>:    mov    0x18(%ebp),%edi\n   0x68082eaa <+42>:    mov    0x14(%ebp),%esi\n   0x68082ead <+45>:    mov    0x10(%ebp),%eax\n   0x68082eb0 <+48>:    mov    %eax,0x8(%esp)\n   0x68082eb4 <+52>:    mov    0xc(%ebp),%eax\n   0x68082eb7 <+55>:    mov    %eax,0x4(%esp)\n   0x68082ebb <+59>:    call   0x680d0470 <_ZN2rt4args18load_argc_and_argv17_2199da865b9a2acc14_0$x2e8$x2dpreE>\n   0x68082ec0 <+64>:    mov    %eax,0x4(%esp)\n```\n\n(gdb) x/8xw $ebp\n\n``` asm\n0x28fe40:       0x0028fe70      0x68082ec0      0x00480000      0x00400000\n0x28fe50:       0x00000000      0x30e6b812      0xfffffffe      0x770e6b96\n```\n\nThe instruction mov 0x10(%ebp),%eax looks like it's trying to load argv which is a null. But the value before that doesn't look like a sensible value of argc, so the failure must have happened earlier in the initialisation of the process or the runtime.\n", "closed_by": {"login": "alexcrichton", "id": 64996, "node_id": "MDQ6VXNlcjY0OTk2", "avatar_url": "https://avatars.githubusercontent.com/u/64996?v=4", "gravatar_id": "", "url": "https://api.github.com/users/alexcrichton", "html_url": "https://github.com/alexcrichton", "followers_url": "https://api.github.com/users/alexcrichton/followers", "following_url": "https://api.github.com/users/alexcrichton/following{/other_user}", "gists_url": "https://api.github.com/users/alexcrichton/gists{/gist_id}", "starred_url": "https://api.github.com/users/alexcrichton/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/alexcrichton/subscriptions", "organizations_url": "https://api.github.com/users/alexcrichton/orgs", "repos_url": "https://api.github.com/users/alexcrichton/repos", "events_url": "https://api.github.com/users/alexcrichton/events{/privacy}", "received_events_url": "https://api.github.com/users/alexcrichton/received_events", "type": "User", "site_admin": false}, "reactions": {"url": "https://api.github.com/repos/rust-lang/rust/issues/7951/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rust-lang/rust/issues/7951/timeline", "performed_via_github_app": null, "state_reason": "completed"}