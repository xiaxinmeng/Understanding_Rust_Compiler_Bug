{"url": "https://api.github.com/repos/rust-lang/rust/issues/74494", "repository_url": "https://api.github.com/repos/rust-lang/rust", "labels_url": "https://api.github.com/repos/rust-lang/rust/issues/74494/labels{/name}", "comments_url": "https://api.github.com/repos/rust-lang/rust/issues/74494/comments", "events_url": "https://api.github.com/repos/rust-lang/rust/issues/74494/events", "html_url": "https://github.com/rust-lang/rust/issues/74494", "id": 660503924, "node_id": "MDU6SXNzdWU2NjA1MDM5MjQ=", "number": 74494, "title": "target wasm32-unknown-emscripten fails to compile in debug mode and external dependencies", "user": {"login": "eloraiby", "id": 1127262, "node_id": "MDQ6VXNlcjExMjcyNjI=", "avatar_url": "https://avatars.githubusercontent.com/u/1127262?v=4", "gravatar_id": "", "url": "https://api.github.com/users/eloraiby", "html_url": "https://github.com/eloraiby", "followers_url": "https://api.github.com/users/eloraiby/followers", "following_url": "https://api.github.com/users/eloraiby/following{/other_user}", "gists_url": "https://api.github.com/users/eloraiby/gists{/gist_id}", "starred_url": "https://api.github.com/users/eloraiby/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/eloraiby/subscriptions", "organizations_url": "https://api.github.com/users/eloraiby/orgs", "repos_url": "https://api.github.com/users/eloraiby/repos", "events_url": "https://api.github.com/users/eloraiby/events{/privacy}", "received_events_url": "https://api.github.com/users/eloraiby/received_events", "type": "User", "site_admin": false}, "labels": [], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 1, "created_at": "2020-07-19T01:33:43Z", "updated_at": "2020-07-19T09:58:07Z", "closed_at": "2020-07-19T09:58:07Z", "author_association": "NONE", "active_lock_reason": null, "body": "Using `https://github.com/NeoCogi/rs-glfw3-gles2-test`:\r\nWhen compiling with:\r\n```\r\n$ cargo build --target wasm32-unknown-emscripten --verbose\r\n```\r\nfails with\r\n```\r\n     Running `rustc --crate-name rs_glfw3_gles2_test --edition=2018 src/main.rs --error-format=json --json=diagnostic-rendered-ansi --crate-type bin --emit=dep-info,link -C panic=abort -C lto -C debuginfo=2 -C debug-assertions=off -C metadata=97a9337055a5b96e --out-dir neocogi/rs-glfw3-gles2-test/target/wasm32-unknown-emscripten/debug/deps --target wasm32-unknown-emscripten -L dependency=neocogi/rs-glfw3-gles2-test/target/wasm32-unknown-emscripten/debug/deps -L dependency=neocogi/rs-glfw3-gles2-test/target/debug/deps --extern libc=neocogi/rs-glfw3-gles2-test/target/wasm32-unknown-emscripten/debug/deps/liblibc-276df9372c8d9b83.rlib --extern rs_ctypes=neocogi/rs-glfw3-gles2-test/target/wasm32-unknown-emscripten/debug/deps/librs_ctypes-417c43734f294198.rlib --extern rs_gles2=neocogi/rs-glfw3-gles2-test/target/wasm32-unknown-emscripten/debug/deps/librs_gles2-4ec28345538bd4dd.rlib --extern rs_glfw3=neocogi/rs-glfw3-gles2-test/target/wasm32-unknown-emscripten/debug/deps/librs_glfw3-cb26d159602259f1.rlib --extern rs_math3d=neocogi/rs-glfw3-gles2-test/target/wasm32-unknown-emscripten/debug/deps/librs_math3d-40cb2616c2691e7c.rlib -C 'link-args=-s USE_GLFW=3' -l c -L .cargo/registry/src/github.com-1ecc6299db9ec823/rs-gles2-0.1.2 -L .cargo/registry/src/github.com-1ecc6299db9ec823/rs-glfw3-0.1.4`\r\nerror: linking with `emcc` failed: exit code: 1\r\n  |\r\n  = note: \"emcc\" \"-s\" \"DISABLE_EXCEPTION_CATCHING=1\" \"-L\" \".rustup/toolchains/stable-x86_64-unknown-linux-gnu/lib/rustlib/wasm32-unknown-emscripten/lib\" \"neocogi/rs-glfw3-gles2-test/target/wasm32-unknown-emscripten/debug/deps/rs_glfw3_gles2_test.rs_glfw3_gles2_test.6qy0vsds-cgu.8.rcgu.o\" \"-o\" \"neocogi/rs-glfw3-gles2-test/target/wasm32-unknown-emscripten/debug/deps/rs_glfw3_gles2_test.js\" \"-s\" \"EXPORTED_FUNCTIONS=[\\\"_main\\\"]\" \"-O0\" \"--memory-init-file\" \"0\" \"-g4\" \"-s\" \"DEFAULT_LIBRARY_FUNCS_TO_INCLUDE=[]\" \"-L\" \"neocogi/rs-glfw3-gles2-test/target/wasm32-unknown-emscripten/debug/deps\" \"-L\" \"neocogi/rs-glfw3-gles2-test/target/debug/deps\" \"-L\" \".cargo/registry/src/github.com-1ecc6299db9ec823/rs-gles2-0.1.2\" \"-L\" \".cargo/registry/src/github.com-1ecc6299db9ec823/rs-glfw3-0.1.4\" \"-L\" \".rustup/toolchains/stable-x86_64-unknown-linux-gnu/lib/rustlib/wasm32-unknown-emscripten/lib\" \"-l\" \"c\" \".rustup/toolchains/stable-x86_64-unknown-linux-gnu/lib/rustlib/wasm32-unknown-emscripten/lib/libcompiler_builtins-a32337d34662dcf6.rlib\" \"-s\" \"USE_GLFW=3\" \"-s\" \"ERROR_ON_UNDEFINED_SYMBOLS=1\" \"-s\" \"ASSERTIONS=1\" \"-s\" \"ABORTING_MALLOC=0\" \"-Wl,--fatal-warnings\"\r\n  = note: emcc: error: 'emsdk/upstream/bin/wasm-emscripten-finalize --detect-features --output-source-map-url=rs_glfw3_gles2_test.wasm.map -g --global-base=1024 --check-stack-overflow --dwarf /tmp/emscripten_temp_j1x9ucok/rs_glfw3_gles2_test.wasm -o /tmp/emscripten_temp_j1x9ucok/rs_glfw3_gles2_test.wasm.o.wasm --input-source-map=/tmp/emscripten_temp_j1x9ucok/rs_glfw3_gles2_test.wasm.map --output-source-map=/tmp/emscripten_temp_j1x9ucok/rs_glfw3_gles2_test.wasm.o.wasm.map' failed (-6)\r\n          \r\n\r\nerror: aborting due to previous error\r\n\r\nThe following warnings were emitted during compilation:\r\n\r\nwarning: Building for Ok(\"wasm32-unknown-emscripten\") target!\r\n\r\nerror: could not compile `rs-glfw3-gles2-test`.\r\n\r\nCaused by:\r\n  process didn't exit successfully: `rustc --crate-name rs_glfw3_gles2_test --edition=2018 src/main.rs --error-format=json --json=diagnostic-rendered-ansi --crate-type bin --emit=dep-info,link -C panic=abort -C lto -C debuginfo=2 -C debug-assertions=off -C metadata=97a9337055a5b96e --out-dir neocogi/rs-glfw3-gles2-test/target/wasm32-unknown-emscripten/debug/deps --target wasm32-unknown-emscripten -L dependency=neocogi/rs-glfw3-gles2-test/target/wasm32-unknown-emscripten/debug/deps -L dependency=neocogi/rs-glfw3-gles2-test/target/debug/deps --extern libc=neocogi/rs-glfw3-gles2-test/target/wasm32-unknown-emscripten/debug/deps/liblibc-276df9372c8d9b83.rlib --extern rs_ctypes=neocogi/rs-glfw3-gles2-test/target/wasm32-unknown-emscripten/debug/deps/librs_ctypes-417c43734f294198.rlib --extern rs_gles2=neocogi/rs-glfw3-gles2-test/target/wasm32-unknown-emscripten/debug/deps/librs_gles2-4ec28345538bd4dd.rlib --extern rs_glfw3=neocogi/rs-glfw3-gles2-test/target/wasm32-unknown-emscripten/debug/deps/librs_glfw3-cb26d159602259f1.rlib --extern rs_math3d=neocogi/rs-glfw3-gles2-test/target/wasm32-unknown-emscripten/debug/deps/librs_math3d-40cb2616c2691e7c.rlib -C 'link-args=-s USE_GLFW=3' -l c -L .cargo/registry/src/github.com-1ecc6299db9ec823/rs-gles2-0.1.2 -L .cargo/registry/src/github.com-1ecc6299db9ec823/rs-glfw3-0.1.4` (exit code: 1)\r\n```\r\nI tracked it down to this:\r\n```\r\n-C debuginfo=2\r\n```\r\nRemoving it, or compiling it with `--release` causes the compilation to succeed!:\r\n```\r\n$ cargo build --target wasm32-unknown-emscripten --verbose --release\r\n``` \r\n\r\n", "closed_by": {"login": "eloraiby", "id": 1127262, "node_id": "MDQ6VXNlcjExMjcyNjI=", "avatar_url": "https://avatars.githubusercontent.com/u/1127262?v=4", "gravatar_id": "", "url": "https://api.github.com/users/eloraiby", "html_url": "https://github.com/eloraiby", "followers_url": "https://api.github.com/users/eloraiby/followers", "following_url": "https://api.github.com/users/eloraiby/following{/other_user}", "gists_url": "https://api.github.com/users/eloraiby/gists{/gist_id}", "starred_url": "https://api.github.com/users/eloraiby/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/eloraiby/subscriptions", "organizations_url": "https://api.github.com/users/eloraiby/orgs", "repos_url": "https://api.github.com/users/eloraiby/repos", "events_url": "https://api.github.com/users/eloraiby/events{/privacy}", "received_events_url": "https://api.github.com/users/eloraiby/received_events", "type": "User", "site_admin": false}, "reactions": {"url": "https://api.github.com/repos/rust-lang/rust/issues/74494/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rust-lang/rust/issues/74494/timeline", "performed_via_github_app": null, "state_reason": "completed"}