{"url": "https://api.github.com/repos/rust-lang/rust/issues/79187", "repository_url": "https://api.github.com/repos/rust-lang/rust", "labels_url": "https://api.github.com/repos/rust-lang/rust/issues/79187/labels{/name}", "comments_url": "https://api.github.com/repos/rust-lang/rust/issues/79187/comments", "events_url": "https://api.github.com/repos/rust-lang/rust/issues/79187/events", "html_url": "https://github.com/rust-lang/rust/issues/79187", "id": 746122182, "node_id": "MDU6SXNzdWU3NDYxMjIxODI=", "number": 79187, "title": "Closure seemingly both implements and doesn't implement a trait", "user": {"login": "alexcrichton", "id": 64996, "node_id": "MDQ6VXNlcjY0OTk2", "avatar_url": "https://avatars.githubusercontent.com/u/64996?v=4", "gravatar_id": "", "url": "https://api.github.com/users/alexcrichton", "html_url": "https://github.com/alexcrichton", "followers_url": "https://api.github.com/users/alexcrichton/followers", "following_url": "https://api.github.com/users/alexcrichton/following{/other_user}", "gists_url": "https://api.github.com/users/alexcrichton/gists{/gist_id}", "starred_url": "https://api.github.com/users/alexcrichton/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/alexcrichton/subscriptions", "organizations_url": "https://api.github.com/users/alexcrichton/orgs", "repos_url": "https://api.github.com/users/alexcrichton/repos", "events_url": "https://api.github.com/users/alexcrichton/events{/privacy}", "received_events_url": "https://api.github.com/users/alexcrichton/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 122406831, "node_id": "MDU6TGFiZWwxMjI0MDY4MzE=", "url": "https://api.github.com/repos/rust-lang/rust/labels/A-closures", "name": "A-closures", "color": "f7e101", "default": false, "description": "Area: closures (`|args| { .. }`)"}, {"id": 650731663, "node_id": "MDU6TGFiZWw2NTA3MzE2NjM=", "url": "https://api.github.com/repos/rust-lang/rust/labels/C-bug", "name": "C-bug", "color": "f5f1fd", "default": false, "description": "Category: This is a bug."}], "state": "open", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 6, "created_at": "2020-11-18T23:31:04Z", "updated_at": "2021-01-16T23:34:11Z", "closed_at": null, "author_association": "MEMBER", "active_lock_reason": null, "body": "This is a bit of an odd issue that I ran into today, and one that I think is a bug in rustc but I'm not 100% certain. Given [this code](https://play.rust-lang.org/?version=stable&mode=debug&edition=2018&gist=a11f940ef5416e8f6ac664d98cf1d5c5):\r\n\r\n```rust\r\ntrait Foo {}\r\n\r\nimpl<F> Foo for F where F: Fn(&i32) -> &i32 {}\r\n\r\nfn take_foo(_: impl Foo) {}\r\n\r\nfn main() {\r\n    // Does not compile\r\n    // take_foo(|a| a);\r\n    // take_foo(|a: &i32| a);\r\n    take_foo(|a: &i32| -> &i32 { a });\r\n\r\n    // Does compile\r\n    take_foo(identity(|a| a));\r\n    take_foo(identity(|a: &i32| a));\r\n    take_foo(identity(|a: &i32| -> &i32 { a }));\r\n\r\n    fn identity<F>(t: F) -> F\r\n    where\r\n        F: Fn(&i32) -> &i32,\r\n    {\r\n        t\r\n    }\r\n}\r\n```\r\n\r\nthis fails to compile with:\r\n\r\n```\r\nerror[E0308]: mismatched types\r\n  --> src/main.rs:11:5\r\n   |\r\n11 |     take_foo(|a: &i32| -> &i32 { a });\r\n   |     ^^^^^^^^ one type is more general than the other\r\n   |\r\n   = note: expected reference `&i32`\r\n              found reference `&i32`\r\n\r\nerror: aborting due to previous error\r\n```\r\n\r\nThe perplexing part to me is that both calls to `take_foo` seem pretty equivalent, but the second compiles while the first does not. I've managed to get a variety of error messages trying to reduce this, the original project had a much more opaque \"the trait bound is not satisfied\" error. It may be the case though that the fix for the above snippet is the fix for the original snippet too though.\r\n\r\n", "closed_by": null, "reactions": {"url": "https://api.github.com/repos/rust-lang/rust/issues/79187/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rust-lang/rust/issues/79187/timeline", "performed_via_github_app": null, "state_reason": null}