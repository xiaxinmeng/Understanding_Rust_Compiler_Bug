{"url": "https://api.github.com/repos/rust-lang/rust/issues/14287", "repository_url": "https://api.github.com/repos/rust-lang/rust", "labels_url": "https://api.github.com/repos/rust-lang/rust/issues/14287/labels{/name}", "comments_url": "https://api.github.com/repos/rust-lang/rust/issues/14287/comments", "events_url": "https://api.github.com/repos/rust-lang/rust/issues/14287/events", "html_url": "https://github.com/rust-lang/rust/issues/14287", "id": 33768715, "node_id": "MDU6SXNzdWUzMzc2ODcxNQ==", "number": 14287, "title": "Add a lint for calling any safe functions at all within an unsafe block", "user": {"login": "bstrie", "id": 865233, "node_id": "MDQ6VXNlcjg2NTIzMw==", "avatar_url": "https://avatars.githubusercontent.com/u/865233?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bstrie", "html_url": "https://github.com/bstrie", "followers_url": "https://api.github.com/users/bstrie/followers", "following_url": "https://api.github.com/users/bstrie/following{/other_user}", "gists_url": "https://api.github.com/users/bstrie/gists{/gist_id}", "starred_url": "https://api.github.com/users/bstrie/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bstrie/subscriptions", "organizations_url": "https://api.github.com/users/bstrie/orgs", "repos_url": "https://api.github.com/users/bstrie/repos", "events_url": "https://api.github.com/users/bstrie/events{/privacy}", "received_events_url": "https://api.github.com/users/bstrie/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 235137, "node_id": "MDU6TGFiZWwyMzUxMzc=", "url": "https://api.github.com/repos/rust-lang/rust/labels/A-lint", "name": "A-lint", "color": "f7e101", "default": false, "description": "Area: Lints (warnings about flaws in source code) such as unused_mut."}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 5, "created_at": "2014-05-19T03:21:48Z", "updated_at": "2016-02-11T20:01:24Z", "closed_at": "2016-02-11T20:01:24Z", "author_association": "CONTRIBUTOR", "active_lock_reason": null, "body": "In today's Rust we warn if your `unsafe` block contains no unsafe code whatsoever:\n\n``` rust\nfn main() {\n    unsafe {\n        std::io::println(\"Hello?\");\n    }\n}\n```\n\n```\nun.rs:2:5: 4:6 warning: unnecessary `unsafe` block, #[warn(unused_unsafe)] on by default\nun.rs:2     unsafe {\nun.rs:3         std::io::println(\"Hello?\");\nun.rs:4     }\n```\n\nThis is really great. However, the following program produces no warning:\n\n``` rust\nfn main() {\n    let x = &[\"One\", \"Two\", \"Three\"];\n    unsafe {\n        std::io::println(*x.unsafe_ref(0));\n    }\n}\n```\n\n...despite the fact that `std::io::println` is not an unsafe function. In the interest of reducing the scope of unsafe code, I propose a lint that would warn on the above program. And yes, satisfying it would require uglifying the code like so:\n\n``` rust\nfn main() {\n    let x = &[\"One\", \"Two\", \"Three\"];\n    let y;\n    unsafe {\n        y = *x.unsafe_ref(0);\n    }\n    std::io::println(y);\n}\n```\n\n...but who ever said that we had an obligation to make unsafe code pretty?\n\n---\n\n**As an alternative**, if people find the above proposal to be too extreme, then I would ask them to consider a weaker lint that merely warned if an entire statement within an unsafe block contained no unsafe code. This weaker lint would warn on the following program which compiles without warning today:\n\n``` rust\nfn main() {\n    let x = &[\"One\", \"Two\", \"Three\"];\n    unsafe {\n        std::io::println(\"Hello?\");  // warn on this line, if you want a weaker lint\n        std::io::println(*x.unsafe_ref(0));\n    }\n}\n```\n", "closed_by": {"login": "steveklabnik", "id": 27786, "node_id": "MDQ6VXNlcjI3Nzg2", "avatar_url": "https://avatars.githubusercontent.com/u/27786?v=4", "gravatar_id": "", "url": "https://api.github.com/users/steveklabnik", "html_url": "https://github.com/steveklabnik", "followers_url": "https://api.github.com/users/steveklabnik/followers", "following_url": "https://api.github.com/users/steveklabnik/following{/other_user}", "gists_url": "https://api.github.com/users/steveklabnik/gists{/gist_id}", "starred_url": "https://api.github.com/users/steveklabnik/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/steveklabnik/subscriptions", "organizations_url": "https://api.github.com/users/steveklabnik/orgs", "repos_url": "https://api.github.com/users/steveklabnik/repos", "events_url": "https://api.github.com/users/steveklabnik/events{/privacy}", "received_events_url": "https://api.github.com/users/steveklabnik/received_events", "type": "User", "site_admin": false}, "reactions": {"url": "https://api.github.com/repos/rust-lang/rust/issues/14287/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rust-lang/rust/issues/14287/timeline", "performed_via_github_app": null, "state_reason": "completed"}