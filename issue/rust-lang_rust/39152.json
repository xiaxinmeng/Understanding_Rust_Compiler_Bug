{"url": "https://api.github.com/repos/rust-lang/rust/issues/39152", "repository_url": "https://api.github.com/repos/rust-lang/rust", "labels_url": "https://api.github.com/repos/rust-lang/rust/issues/39152/labels{/name}", "comments_url": "https://api.github.com/repos/rust-lang/rust/issues/39152/comments", "events_url": "https://api.github.com/repos/rust-lang/rust/issues/39152/events", "html_url": "https://github.com/rust-lang/rust/issues/39152", "id": 201496968, "node_id": "MDU6SXNzdWUyMDE0OTY5Njg=", "number": 39152, "title": "Make suggestion include the line number when the suggestion span is ambiguous", "user": {"login": "estebank", "id": 1606434, "node_id": "MDQ6VXNlcjE2MDY0MzQ=", "avatar_url": "https://avatars.githubusercontent.com/u/1606434?v=4", "gravatar_id": "", "url": "https://api.github.com/users/estebank", "html_url": "https://github.com/estebank", "followers_url": "https://api.github.com/users/estebank/followers", "following_url": "https://api.github.com/users/estebank/following{/other_user}", "gists_url": "https://api.github.com/users/estebank/gists{/gist_id}", "starred_url": "https://api.github.com/users/estebank/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/estebank/subscriptions", "organizations_url": "https://api.github.com/users/estebank/orgs", "repos_url": "https://api.github.com/users/estebank/repos", "events_url": "https://api.github.com/users/estebank/events{/privacy}", "received_events_url": "https://api.github.com/users/estebank/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 235791, "node_id": "MDU6TGFiZWwyMzU3OTE=", "url": "https://api.github.com/repos/rust-lang/rust/labels/A-diagnostics", "name": "A-diagnostics", "color": "f7e101", "default": false, "description": "Area: Messages for errors, warnings, and lints"}, {"id": 211668100, "node_id": "MDU6TGFiZWwyMTE2NjgxMDA=", "url": "https://api.github.com/repos/rust-lang/rust/labels/T-compiler", "name": "T-compiler", "color": "bfd4f2", "default": false, "description": "Relevant to the compiler team, which will review and decide on the PR/issue."}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 0, "created_at": "2017-01-18T07:18:13Z", "updated_at": "2017-07-07T00:58:22Z", "closed_at": "2017-07-07T00:58:22Z", "author_association": "CONTRIBUTOR", "active_lock_reason": null, "body": "Given a diagnostic builder using `span_label`s with the following output:\r\n\r\n```\r\nerror: cannot borrow immutable borrowed content `*self.s` as mutable\r\n  --> $DIR/issue-38147-3.rs:17:9\r\n   |\r\n12 |     s: &'a String\r\n   |     ------------- this field should be `&mut`\r\n...|\r\n16 |     fn f(&self) {\r\n   |          -----  use `&mut self` here to make mutable\r\n17 |         self.s.push('x');\r\n   |         ^^^^^^\r\n```\r\n\r\nIf it is changed to use `span_suggestion`s (as I believe is the intention going forward), I see a couple of problems:\r\n\r\n```\r\nerror: cannot borrow immutable borrowed content `*self.s` as mutable\r\n  --> $DIR/issue-38147-3.rs:17:9\r\n   |\r\n12 |     s: &'a String\r\n   |     ------------- this field should be `&mut`\r\n...\r\n17 |         self.s.push('x');\r\n   |         ^^^^^^\r\n   |\r\nhelp: try making this a mutable borrow\r\n   |     fn f(&mut self) {\r\n```\r\n\r\nThe span being replaced in the suggestion is not part of the main body of the diagnostic and the line number where the change is suggested is not present. Because of this, it obscures where the suggested code should be written. This is exacerbated by the out of order presentation.\r\n\r\nThere're a few possible solutions:\r\n\r\n* If the `span_suggestion` contains a span not in the main body or there're more than one `span_label`s in the diagnostic, show the line number\r\n* Change the suggestion helps to appear inline with the original code above it:\r\n```\r\nerror: cannot borrow immutable borrowed content `*self.s` as mutable\r\n  --> $DIR/issue-38147-3.rs:17:9\r\n   |\r\n12 |     s: &'a String\r\n   |     ------------- this field should be `&mut`\r\n...\r\n16 |    fn f(&self) {\r\n   |         ----- try making this a mutable borrow as follows:\r\n   |    fn f(&mut self) {\r\n   |         --------- \r\n17 |         self.s.push('x');\r\n   |         ^^^^^^\r\n```\r\n* Change the suggestion helps to appear inline:\r\n```\r\nerror: cannot borrow immutable borrowed content `*self.s` as mutable\r\n  --> $DIR/issue-38147-3.rs:17:9\r\n   |\r\n12 |     s: &'a String\r\n   |     ------------- this field should be `&mut`\r\n...\r\n16 |    fn f(&mut self) {\r\n   |         --------- try making this a mutable borrow\r\n17 |         self.s.push('x');\r\n   |         ^^^^^^\r\n```\r\n", "closed_by": {"login": "bors", "id": 3372342, "node_id": "MDQ6VXNlcjMzNzIzNDI=", "avatar_url": "https://avatars.githubusercontent.com/u/3372342?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors", "html_url": "https://github.com/bors", "followers_url": "https://api.github.com/users/bors/followers", "following_url": "https://api.github.com/users/bors/following{/other_user}", "gists_url": "https://api.github.com/users/bors/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors/subscriptions", "organizations_url": "https://api.github.com/users/bors/orgs", "repos_url": "https://api.github.com/users/bors/repos", "events_url": "https://api.github.com/users/bors/events{/privacy}", "received_events_url": "https://api.github.com/users/bors/received_events", "type": "User", "site_admin": false}, "reactions": {"url": "https://api.github.com/repos/rust-lang/rust/issues/39152/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rust-lang/rust/issues/39152/timeline", "performed_via_github_app": null, "state_reason": "completed"}