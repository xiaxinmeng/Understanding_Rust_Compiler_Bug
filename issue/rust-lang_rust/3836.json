{"url": "https://api.github.com/repos/rust-lang/rust/issues/3836", "repository_url": "https://api.github.com/repos/rust-lang/rust", "labels_url": "https://api.github.com/repos/rust-lang/rust/issues/3836/labels{/name}", "comments_url": "https://api.github.com/repos/rust-lang/rust/issues/3836/comments", "events_url": "https://api.github.com/repos/rust-lang/rust/issues/3836/events", "html_url": "https://github.com/rust-lang/rust/issues/3836", "id": 7783853, "node_id": "MDU6SXNzdWU3NzgzODUz", "number": 3836, "title": "RFC: moving managed pointers across tasks", "user": {"login": "erickt", "id": 84711, "node_id": "MDQ6VXNlcjg0NzEx", "avatar_url": "https://avatars.githubusercontent.com/u/84711?v=4", "gravatar_id": "", "url": "https://api.github.com/users/erickt", "html_url": "https://github.com/erickt", "followers_url": "https://api.github.com/users/erickt/followers", "following_url": "https://api.github.com/users/erickt/following{/other_user}", "gists_url": "https://api.github.com/users/erickt/gists{/gist_id}", "starred_url": "https://api.github.com/users/erickt/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/erickt/subscriptions", "organizations_url": "https://api.github.com/users/erickt/orgs", "repos_url": "https://api.github.com/users/erickt/repos", "events_url": "https://api.github.com/users/erickt/events{/privacy}", "received_events_url": "https://api.github.com/users/erickt/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 37544, "node_id": "MDU6TGFiZWwzNzU0NA==", "url": "https://api.github.com/repos/rust-lang/rust/labels/A-typesystem", "name": "A-typesystem", "color": "f7e101", "default": false, "description": "Area: The type system"}, {"id": 9695584, "node_id": "MDU6TGFiZWw5Njk1NTg0", "url": "https://api.github.com/repos/rust-lang/rust/labels/A-concurrency", "name": "A-concurrency", "color": "f7e101", "default": false, "description": "Area: Concurrency related issues."}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 2, "created_at": "2012-10-22T23:53:14Z", "updated_at": "2013-01-10T21:45:26Z", "closed_at": "2013-01-10T21:45:26Z", "author_association": "CONTRIBUTOR", "active_lock_reason": null, "body": "@graydon and I were talking on IRC about using conditions for serializations error handling today. He convinced me to try out using subtasks to parse and catch failures, but unfortunately doing this means that we can't use serialization error handling on types with managed pointers.\n\nThis problem would go away if we could somehow move managed pointers from task A to task B. Even though it's generally unsafe to send a managed pointer across tasks, it's theoretically safe if it's the last thing a task does before it dies.\n\nHere's an obviously wrong, only-works-for-ints example function:\n\n```\nfn try_managed<T>(f: fn~() -> @T) -> Result<@T, ()> {\n    let result: Result<*libc::c_void, ()> = do task::try {\n        unsafe { \n            let v = f();\n            cast::forget(v);\n            cast::reinterpret_cast::<@T, *libc::c_void>(&v)\n        }\n    };\n\n    match move result {\n        Ok(move v) => {\n            unsafe {\n                let v = cast::reinterpret_cast::<*libc::c_void, @T>(&v);\n                cast::bump_box_refcount(v);\n                Ok(move v)\n            }\n        }\n        Err(move e) => Err(e),\n    }\n}\n\nfn main() {\n    let r = do try_managed {\n        @5\n    };\n\n    match r {\n        Err(_) => io::println(\"err\"),\n        Ok(x) => io::println(fmt!(\"%?\", *x)),\n    }\n}\n```\n\nIt segfaults for more complicated data structures, like `~str`s.\n", "closed_by": {"login": "catamorphism", "id": 427212, "node_id": "MDQ6VXNlcjQyNzIxMg==", "avatar_url": "https://avatars.githubusercontent.com/u/427212?v=4", "gravatar_id": "", "url": "https://api.github.com/users/catamorphism", "html_url": "https://github.com/catamorphism", "followers_url": "https://api.github.com/users/catamorphism/followers", "following_url": "https://api.github.com/users/catamorphism/following{/other_user}", "gists_url": "https://api.github.com/users/catamorphism/gists{/gist_id}", "starred_url": "https://api.github.com/users/catamorphism/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/catamorphism/subscriptions", "organizations_url": "https://api.github.com/users/catamorphism/orgs", "repos_url": "https://api.github.com/users/catamorphism/repos", "events_url": "https://api.github.com/users/catamorphism/events{/privacy}", "received_events_url": "https://api.github.com/users/catamorphism/received_events", "type": "User", "site_admin": false}, "reactions": {"url": "https://api.github.com/repos/rust-lang/rust/issues/3836/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rust-lang/rust/issues/3836/timeline", "performed_via_github_app": null, "state_reason": "completed"}