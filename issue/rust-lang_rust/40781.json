{"url": "https://api.github.com/repos/rust-lang/rust/issues/40781", "repository_url": "https://api.github.com/repos/rust-lang/rust", "labels_url": "https://api.github.com/repos/rust-lang/rust/issues/40781/labels{/name}", "comments_url": "https://api.github.com/repos/rust-lang/rust/issues/40781/comments", "events_url": "https://api.github.com/repos/rust-lang/rust/issues/40781/events", "html_url": "https://github.com/rust-lang/rust/issues/40781", "id": 216608040, "node_id": "MDU6SXNzdWUyMTY2MDgwNDA=", "number": 40781, "title": "Exclude internal benches from rustc test harness", "user": {"login": "Robbepop", "id": 8193155, "node_id": "MDQ6VXNlcjgxOTMxNTU=", "avatar_url": "https://avatars.githubusercontent.com/u/8193155?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Robbepop", "html_url": "https://github.com/Robbepop", "followers_url": "https://api.github.com/users/Robbepop/followers", "following_url": "https://api.github.com/users/Robbepop/following{/other_user}", "gists_url": "https://api.github.com/users/Robbepop/gists{/gist_id}", "starred_url": "https://api.github.com/users/Robbepop/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Robbepop/subscriptions", "organizations_url": "https://api.github.com/users/Robbepop/orgs", "repos_url": "https://api.github.com/users/Robbepop/repos", "events_url": "https://api.github.com/users/Robbepop/events{/privacy}", "received_events_url": "https://api.github.com/users/Robbepop/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 630652267, "node_id": "MDU6TGFiZWw2MzA2NTIyNjc=", "url": "https://api.github.com/repos/rust-lang/rust/labels/C-feature-request", "name": "C-feature-request", "color": "f5f1fd", "default": false, "description": "Category: A feature request, i.e: not implemented / a PR."}, {"id": 630810559, "node_id": "MDU6TGFiZWw2MzA4MTA1NTk=", "url": "https://api.github.com/repos/rust-lang/rust/labels/A-libtest", "name": "A-libtest", "color": "f7e101", "default": false, "description": "Area: #[test] related"}], "state": "open", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 0, "created_at": "2017-03-24T00:05:47Z", "updated_at": "2017-07-27T18:51:51Z", "closed_at": null, "author_association": "CONTRIBUTOR", "active_lock_reason": null, "body": "This is a re-post from [this](https://github.com/rust-lang/cargo/issues/3853) Cargo issue as [alex c.](https://github.com/alexcrichton) pointed me to file an issue here.  \r\n\r\n**The Problem**\r\n\r\nCurrently `rustc --test` excludes benches in the `benches/` folder and includes internal benches within the crate.\r\n\r\nBesides this assymetric behaviour functions annotated with `#[bench]` may be very compute intense, by definition and should be excluded from cargo test by default since they add high overhead whenever the test suite is running.\r\n\r\n**Conflicting ...**\r\n\r\nThis issue conflicts with [#2984](https://github.com/rust-lang/cargo/issues/2984) that proposes to include benches in the `benches/` directory for cargo test which I am strictly against! To solve the problems issue [#2984](https://github.com/rust-lang/cargo/issues/2984) tries to target it should be possible to mark `#[bench]` tests with an additional `#[test]` attribute in order to include them for cargo test:\r\n\r\n```rust\r\n#[bench] #[test]\r\nfn foo(b: &mut Bencher) { .. }\r\n```\r\n\r\nA current ugly work around to exclude benches from running with `cargo test` is to add a crate feature (e.g. a feature called `run_internal_benches`) and invoke `cargo bench` as `cargo bench --features run_internal_benches`. This works as intended but is ugly. An example crate can be found [here](https://github.com/Robbepop/prophet).\r\n\r\n**Alternative**\r\n\r\nAnother thing we could think about is to introduce a flag for cargo test to include benches while the default should be set to exclude them.\r\n\r\n **Do not confuse testing with benchmarking:**\r\n\r\n- Tests are for testing the functionality of the system and should be performed often and should be as low-overhead as possible.\r\n- Benchmarks are often high-overhead and should be run whenever performance critical changes have been made.\r\n", "closed_by": null, "reactions": {"url": "https://api.github.com/repos/rust-lang/rust/issues/40781/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rust-lang/rust/issues/40781/timeline", "performed_via_github_app": null, "state_reason": null}