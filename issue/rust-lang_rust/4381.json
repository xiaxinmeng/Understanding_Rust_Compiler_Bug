{"url": "https://api.github.com/repos/rust-lang/rust/issues/4381", "repository_url": "https://api.github.com/repos/rust-lang/rust", "labels_url": "https://api.github.com/repos/rust-lang/rust/issues/4381/labels{/name}", "comments_url": "https://api.github.com/repos/rust-lang/rust/issues/4381/comments", "events_url": "https://api.github.com/repos/rust-lang/rust/issues/4381/events", "html_url": "https://github.com/rust-lang/rust/issues/4381", "id": 9767726, "node_id": "MDU6SXNzdWU5NzY3NzI2", "number": 4381, "title": "Spurious \"value assigned is never read\" warnings during macro expansion", "user": {"login": "bstrie", "id": 865233, "node_id": "MDQ6VXNlcjg2NTIzMw==", "avatar_url": "https://avatars.githubusercontent.com/u/865233?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bstrie", "html_url": "https://github.com/bstrie", "followers_url": "https://api.github.com/users/bstrie/followers", "following_url": "https://api.github.com/users/bstrie/following{/other_user}", "gists_url": "https://api.github.com/users/bstrie/gists{/gist_id}", "starred_url": "https://api.github.com/users/bstrie/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bstrie/subscriptions", "organizations_url": "https://api.github.com/users/bstrie/orgs", "repos_url": "https://api.github.com/users/bstrie/repos", "events_url": "https://api.github.com/users/bstrie/events{/privacy}", "received_events_url": "https://api.github.com/users/bstrie/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 235137, "node_id": "MDU6TGFiZWwyMzUxMzc=", "url": "https://api.github.com/repos/rust-lang/rust/labels/A-lint", "name": "A-lint", "color": "f7e101", "default": false, "description": "Area: Lints (warnings about flaws in source code) such as unused_mut."}, {"id": 235146, "node_id": "MDU6TGFiZWwyMzUxNDY=", "url": "https://api.github.com/repos/rust-lang/rust/labels/A-syntaxext", "name": "A-syntaxext", "color": "f7e101", "default": false, "description": "Area: Syntax extensions"}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 4, "created_at": "2013-01-08T13:19:53Z", "updated_at": "2013-07-23T18:28:07Z", "closed_at": "2013-07-23T18:28:07Z", "author_association": "CONTRIBUTOR", "active_lock_reason": null, "body": "The following program uses a macro (`mlet!`) to abstract away the declaration of several variables:\n\n```\nuse task::spawn;\n\nfn main() {\n    macro_rules! mlet(\n        ($($var:ident),+ = $val:expr) => (\n            let $($var = $val),+;\n        );\n    );\n\n    let (port, chan) = pipes::stream();\n    let chan = pipes::SharedChan(chan);\n\n    mlet!(s1, s2, s3 = chan.clone());\n    // The above line expands to the following, which doesn't throw any\n    // warnings when it's inserted manually rather than generated by the macro:\n    //let s1 = chan.clone(), s2 = chan.clone(), s3 = chan.clone();\n    do spawn { s1.send( (|a: int| a*2)(10) ) }\n    do spawn { s2.send( (|a: int| a*2)(20) ) }\n    do spawn { s3.send( (|a: int, b: int| a+b)(30, 40) ) }\n\n    mlet!(x, y, z = port.recv());\n    // The above line expands to the following, which doesn't throw any\n    // warnings when it's inserted manually rather than generated by the macro:\n    //let x = port.recv(), y = port.recv(), z = port.recv();\n    io::println(fmt!(\"%d + %d + %d = %d\", x, y, z, x+y+z));\n}\n```\n\nWhen compiling this code, I receive this output:\n\n```\nmacro3.rs:6:19: 6:24 warning: value assigned to `s2` is never read\nmacro3.rs:6             let $($var = $val),+;\n                               ^~~~~\nmacro3.rs:4:4: 8:6 note: in expansion of mlet!\nmacro3.rs:13:4: 13:37 note: expansion site\nmacro3.rs:6:19: 6:24 warning: value assigned to `s3` is never read\nmacro3.rs:6             let $($var = $val),+;\n                               ^~~~~\nmacro3.rs:4:4: 8:6 note: in expansion of mlet!\nmacro3.rs:13:4: 13:37 note: expansion site\nmacro3.rs:6:19: 6:24 warning: value assigned to `y` is never read\nmacro3.rs:6             let $($var = $val),+;\n                               ^~~~~\nmacro3.rs:4:4: 8:6 note: in expansion of mlet!\nmacro3.rs:21:4: 21:33 note: expansion site\nmacro3.rs:6:19: 6:24 warning: value assigned to `z` is never read\nmacro3.rs:6             let $($var = $val),+;\n                               ^~~~~\nmacro3.rs:4:4: 8:6 note: in expansion of mlet!\nmacro3.rs:21:4: 21:33 note: expansion site\n```\n\nThese warnings _only_ appear when using the macros to generate the code. If you run the macro expansion pass (`rustc --pretty expanded`) you see that the `mlet!` lines turn into the following:\n\n```\nlet s1 = chan.clone(), s2 = chan.clone(), s3 = chan.clone();\nlet x = port.recv(), y = port.recv(), z = port.recv();\n```\n\nManually replacing the macro lines with these expanded lines does not cause the warnings to be printed upon compilation. Fix the compiler so that these spurious warnings do not occur during macro expansion.\n", "closed_by": {"login": "bstrie", "id": 865233, "node_id": "MDQ6VXNlcjg2NTIzMw==", "avatar_url": "https://avatars.githubusercontent.com/u/865233?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bstrie", "html_url": "https://github.com/bstrie", "followers_url": "https://api.github.com/users/bstrie/followers", "following_url": "https://api.github.com/users/bstrie/following{/other_user}", "gists_url": "https://api.github.com/users/bstrie/gists{/gist_id}", "starred_url": "https://api.github.com/users/bstrie/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bstrie/subscriptions", "organizations_url": "https://api.github.com/users/bstrie/orgs", "repos_url": "https://api.github.com/users/bstrie/repos", "events_url": "https://api.github.com/users/bstrie/events{/privacy}", "received_events_url": "https://api.github.com/users/bstrie/received_events", "type": "User", "site_admin": false}, "reactions": {"url": "https://api.github.com/repos/rust-lang/rust/issues/4381/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rust-lang/rust/issues/4381/timeline", "performed_via_github_app": null, "state_reason": "completed"}