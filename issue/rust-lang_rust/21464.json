{"url": "https://api.github.com/repos/rust-lang/rust/issues/21464", "repository_url": "https://api.github.com/repos/rust-lang/rust", "labels_url": "https://api.github.com/repos/rust-lang/rust/issues/21464/labels{/name}", "comments_url": "https://api.github.com/repos/rust-lang/rust/issues/21464/comments", "events_url": "https://api.github.com/repos/rust-lang/rust/issues/21464/events", "html_url": "https://github.com/rust-lang/rust/issues/21464", "id": 55016044, "node_id": "MDU6SXNzdWU1NTAxNjA0NA==", "number": 21464, "title": "Compile error messages related to inferring closure types can be hard to debug", "user": {"login": "nical", "id": 264854, "node_id": "MDQ6VXNlcjI2NDg1NA==", "avatar_url": "https://avatars.githubusercontent.com/u/264854?v=4", "gravatar_id": "", "url": "https://api.github.com/users/nical", "html_url": "https://github.com/nical", "followers_url": "https://api.github.com/users/nical/followers", "following_url": "https://api.github.com/users/nical/following{/other_user}", "gists_url": "https://api.github.com/users/nical/gists{/gist_id}", "starred_url": "https://api.github.com/users/nical/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/nical/subscriptions", "organizations_url": "https://api.github.com/users/nical/orgs", "repos_url": "https://api.github.com/users/nical/repos", "events_url": "https://api.github.com/users/nical/events{/privacy}", "received_events_url": "https://api.github.com/users/nical/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 235791, "node_id": "MDU6TGFiZWwyMzU3OTE=", "url": "https://api.github.com/repos/rust-lang/rust/labels/A-diagnostics", "name": "A-diagnostics", "color": "f7e101", "default": false, "description": "Area: Messages for errors, warnings, and lints"}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 2, "created_at": "2015-01-21T13:09:24Z", "updated_at": "2015-11-04T16:23:20Z", "closed_at": "2015-11-04T16:23:20Z", "author_association": "CONTRIBUTOR", "active_lock_reason": null, "body": "Sample code to illustrate the issue:  http://is.gd/qzkZ5k\n\n```\nfn foo(_callback: &Fn()) {\n    // ...\n}\n\nfn main() {\n    let captured_var = 42;\n\n    foo(&||{\n        println!(\"{}\", captured_var);\n    });\n}\n```\n\nerror message:\n\n```\n<anon>:8:9: 10:6 error: unable to infer enough type information about `closure[<anon>:8:10: 10:6]`; type annotations required\n<anon>:8     foo(&||{\n<anon>:9         println!(\"{}\", captured_var);\n<anon>:10     });\n```\n\nWhat happens here is that captured_var's type isn't fully defined at the moment the closure is created and rustc doesn't know what type to put in the environment of the closure. It does make sense but the confusing part it can actually take a while to figure out that the issue is not with the visible part of the closure (it's signature), but with the invisible part (the environment). The error message points to the first line of the closure (the one with the \"&|args| {\" part which is the visible \"signature\" part) \nI ran into this issue with a much bigger closure, so the usage of the captured variable was much farther than the signature line pointed in the error message. Rustc does a lot of inference around the signature of closures so it encourages the developer to spend time looking there when the compiler isn't given enough info to infer the type.\n\nMy suggestion is that there should be a different error messages when the missing type information is related to the captured environment of the closure, and that this error message should have words like \"captured\" and \"environment\" in them to let the developer know that it's not about inferring the signature of the closure.\n", "closed_by": {"login": "steveklabnik", "id": 27786, "node_id": "MDQ6VXNlcjI3Nzg2", "avatar_url": "https://avatars.githubusercontent.com/u/27786?v=4", "gravatar_id": "", "url": "https://api.github.com/users/steveklabnik", "html_url": "https://github.com/steveklabnik", "followers_url": "https://api.github.com/users/steveklabnik/followers", "following_url": "https://api.github.com/users/steveklabnik/following{/other_user}", "gists_url": "https://api.github.com/users/steveklabnik/gists{/gist_id}", "starred_url": "https://api.github.com/users/steveklabnik/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/steveklabnik/subscriptions", "organizations_url": "https://api.github.com/users/steveklabnik/orgs", "repos_url": "https://api.github.com/users/steveklabnik/repos", "events_url": "https://api.github.com/users/steveklabnik/events{/privacy}", "received_events_url": "https://api.github.com/users/steveklabnik/received_events", "type": "User", "site_admin": false}, "reactions": {"url": "https://api.github.com/repos/rust-lang/rust/issues/21464/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rust-lang/rust/issues/21464/timeline", "performed_via_github_app": null, "state_reason": "completed"}