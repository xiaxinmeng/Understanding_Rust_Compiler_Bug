{"url": "https://api.github.com/repos/rust-lang/rust/issues/35829", "repository_url": "https://api.github.com/repos/rust-lang/rust", "labels_url": "https://api.github.com/repos/rust-lang/rust/issues/35829/labels{/name}", "comments_url": "https://api.github.com/repos/rust-lang/rust/issues/35829/comments", "events_url": "https://api.github.com/repos/rust-lang/rust/issues/35829/events", "html_url": "https://github.com/rust-lang/rust/issues/35829", "id": 172171693, "node_id": "MDU6SXNzdWUxNzIxNzE2OTM=", "number": 35829, "title": "ICE: unhandled token in quote!", "user": {"login": "mrhota", "id": 403641, "node_id": "MDQ6VXNlcjQwMzY0MQ==", "avatar_url": "https://avatars.githubusercontent.com/u/403641?v=4", "gravatar_id": "", "url": "https://api.github.com/users/mrhota", "html_url": "https://github.com/mrhota", "followers_url": "https://api.github.com/users/mrhota/followers", "following_url": "https://api.github.com/users/mrhota/following{/other_user}", "gists_url": "https://api.github.com/users/mrhota/gists{/gist_id}", "starred_url": "https://api.github.com/users/mrhota/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/mrhota/subscriptions", "organizations_url": "https://api.github.com/users/mrhota/orgs", "repos_url": "https://api.github.com/users/mrhota/repos", "events_url": "https://api.github.com/users/mrhota/events{/privacy}", "received_events_url": "https://api.github.com/users/mrhota/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 9618520, "node_id": "MDU6TGFiZWw5NjE4NTIw", "url": "https://api.github.com/repos/rust-lang/rust/labels/I-ICE", "name": "I-ICE", "color": "e10c02", "default": false, "description": "Issue: The compiler panicked, giving an Internal Compilation Error (ICE) \u2744\ufe0f"}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 2, "created_at": "2016-08-19T16:39:02Z", "updated_at": "2017-05-17T10:50:29Z", "closed_at": "2017-05-17T10:50:29Z", "author_association": "CONTRIBUTOR", "active_lock_reason": null, "body": "In trying to repro #16935 I discovered this ICE in `quote!`:\n\n```\nthread 'rustc' panicked at 'unhandled token in quote!', ../src/libsyntax/ext/quote.rs:707\nstack backtrace:\n   1:        0x111037e79 - std::sys::backtrace::tracing::imp::write::h482d45d91246faa2\n   2:        0x111046b70 - std::panicking::default_hook::_{{closure}}::h89158f66286b674e\n   3:        0x111044e9f - std::panicking::default_hook::h9e30d428ee3b0c43\n   4:        0x1110455a6 - std::panicking::rust_panic_with_hook::h2224f33fb7bf2f4c\n   5:        0x1107fd4d4 - std::panicking::begin_panic::h6da27a7ee15843ce\n   6:        0x1109e95f3 - syntax::ext::quote::expr_mk_token::h7c3422b80bef3bd5\n   7:        0x1109ebdb0 - syntax::ext::quote::statements_mk_tt::he0f33941b94e20bb\n   8:        0x1108203af - _<core..iter..FlatMap<I, U, F> as core..iter..iterator..Iterator>::next::hb7943eed4d804bfc\n   9:        0x11081918f - _<core..iter..Chain<A, B> as core..iter..iterator..Iterator>::next::hf66dec9ac7ebfd3e\n  10:        0x11081e49a - _<collections..vec..Vec<T> as core..iter..traits..FromIterator<T>>::from_iter::hb6ba9a4116122593\n  11:        0x1109ea625 - syntax::ext::quote::statements_mk_tt::he0f33941b94e20bb\n  12:        0x1109ed8e2 - syntax::ext::quote::statements_mk_tts::hc942124e7cb85dbc\n  13:        0x1109eda54 - syntax::ext::quote::expand_tts::h25510a66e2e03c00\n  14:        0x1109eefa4 - syntax::ext::quote::expand_parse_call::h362dceaee0d8b0c6\n  15:        0x1109e4c6a - syntax::ext::quote::expand_quote_expr::h7f4c2771cabcf421\n  16:        0x1109b07d5 - _<F as syntax..ext..base..TTMacroExpander>::expand::h2cbfb95c85d07886\n  17:        0x1109cb75b - syntax::ext::expand::expand_mac_invoc::mac_result::ha3a8dfd05d9eecb6\n  18:        0x11096d850 - _<syntax..ptr..P<T>>::and_then::h53ce1d732b16c30f\n  19:        0x11088da64 - syntax::fold::Folder::fold_exprs::haec82b8e9fe75416\n  20:        0x1108f0234 - syntax::fold::noop_fold_expr::hab84161d928c2074\n  21:        0x1109c6d85 - syntax::ext::expand::expand_expr::hd4de34daa0a5a90a\n  22:        0x11096d963 - _<syntax..ptr..P<T>>::and_then::h53ce1d732b16c30f\n  23:        0x1109cd0de - syntax::ext::expand::expand_stmt::hf1246bdbc447b35b\n  24:        0x11083d0c2 - _<collections..vec..Vec<T> as syntax..util..move_map..MoveMap<T>>::move_flat_map::h95ab7180e0970e65\n  25:        0x1109dc77f - _<syntax..ext..expand..MacroExpander<'a, 'b> as syntax..fold..Folder>::fold_block::h84ca09e1246a6f7f\n  26:        0x1108b2c3f - syntax::fold::noop_fold_item_kind::he96b2686f10d5f9d\n  27:        0x1108bee78 - syntax::fold::noop_fold_item_simple::hb58741bcf641e653\n  28:        0x1109d0d40 - syntax::ext::expand::expand_annotatable::hd731ac0c7a5098e1\n  29:        0x1109cc7cf - syntax::ext::expand::expand_item::h34a68666bcb77b42\n  30:        0x1109dc20a - _<syntax..ext..expand..MacroExpander<'a, 'b> as syntax..fold..Folder>::fold_item::h11dc20d6fdb44d60\n  31:        0x1108bd942 - syntax::fold::noop_fold_mod::h7ccd83e899e81c3c\n  32:        0x1108b26b2 - syntax::fold::noop_fold_item_kind::he96b2686f10d5f9d\n  33:        0x1108bee78 - syntax::fold::noop_fold_item_simple::hb58741bcf641e653\n  34:        0x1109d102b - syntax::ext::expand::expand_annotatable::hd731ac0c7a5098e1\n  35:        0x1109cc7cf - syntax::ext::expand::expand_item::h34a68666bcb77b42\n  36:        0x1109dc342 - _<syntax..ext..expand..MacroExpander<'a, 'b> as syntax..fold..Folder>::fold_item::h11dc20d6fdb44d60\n  37:        0x1109db30e - _<syntax..ext..expand..MacroExpander<'a, 'b> as syntax..fold..Folder>::fold_crate::hb0a12b0d8df69afd\n  38:        0x1109dda1e - syntax::ext::expand::expand_crate_with_expander::h77575f1d1b34ae40\n  39:        0x1109dd4ba - syntax::ext::expand::expand_crate::h72ec18c6565094c4\n  40:        0x10c3d668b - rustc_driver::driver::phase_2_configure_and_expand::_{{closure}}::hae7f286174f41285\n  41:        0x10c389133 - rustc_driver::driver::phase_2_configure_and_expand::h7a450d24678fc450\n  42:        0x10c38089c - rustc_driver::driver::compile_input::hd9ecc57abd3cba85\n  43:        0x10c3b2579 - rustc_driver::run_compiler::h184264500271cc39\n  44:        0x10c2fdc94 - std::panicking::try::do_call::h17a7a17ad7240c5c\n  45:        0x11104d8aa - __rust_maybe_catch_panic\n  46:        0x10c317d57 - _<F as alloc..boxed..FnBox<A>>::call_box::h93f9128277b2964a\n  47:        0x111043c65 - std::sys::thread::Thread::new::thread_start::he0bf102845911132\n  48:     0x7fff89ecf99c - _pthread_body\n  49:     0x7fff89ecf919 - _pthread_start\n```\n\ncaused by the following code:\n\n``` rust\n#![feature(plugin_registrar, quote, rustc_private)]\n#![crate_name = \"synext\"]\n#![crate_type = \"dylib\"]\n\nextern crate syntax;\nextern crate rustc_plugin;\nuse rustc_plugin::Registry;\n\nuse syntax::ext::base::{MacResult, MacEager};\nuse syntax::tokenstream;\nuse syntax::codemap::Span;\nuse syntax::ext::base::ExtCtxt;\n\n#[plugin_registrar]\npub fn registrar(reg: &mut Registry) {\n    reg.register_macro(\"test\", expand);\n}\n\nfn expand(cx: &mut ExtCtxt, _sp: Span,\n          _tts: &[tokenstream::TokenTree]) -> Box<MacResult + 'static> {\n    MacEager::expr(quote_expr!(cx,\n                               std::io::stdout().write(b\"one\"); // <-- it doesn't like b\"\"\n    ))\n}\n```\n", "closed_by": {"login": "bors", "id": 3372342, "node_id": "MDQ6VXNlcjMzNzIzNDI=", "avatar_url": "https://avatars.githubusercontent.com/u/3372342?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors", "html_url": "https://github.com/bors", "followers_url": "https://api.github.com/users/bors/followers", "following_url": "https://api.github.com/users/bors/following{/other_user}", "gists_url": "https://api.github.com/users/bors/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors/subscriptions", "organizations_url": "https://api.github.com/users/bors/orgs", "repos_url": "https://api.github.com/users/bors/repos", "events_url": "https://api.github.com/users/bors/events{/privacy}", "received_events_url": "https://api.github.com/users/bors/received_events", "type": "User", "site_admin": false}, "reactions": {"url": "https://api.github.com/repos/rust-lang/rust/issues/35829/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rust-lang/rust/issues/35829/timeline", "performed_via_github_app": null, "state_reason": "completed"}