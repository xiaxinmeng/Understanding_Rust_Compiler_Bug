{"url": "https://api.github.com/repos/rust-lang/rust/issues/22731", "repository_url": "https://api.github.com/repos/rust-lang/rust", "labels_url": "https://api.github.com/repos/rust-lang/rust/issues/22731/labels{/name}", "comments_url": "https://api.github.com/repos/rust-lang/rust/issues/22731/comments", "events_url": "https://api.github.com/repos/rust-lang/rust/issues/22731/events", "html_url": "https://github.com/rust-lang/rust/issues/22731", "id": 58650167, "node_id": "MDU6SXNzdWU1ODY1MDE2Nw==", "number": 22731, "title": "Projecting `<Type as Trait>::N` should check that `N` is part of `Trait`", "user": {"login": "pnkfelix", "id": 173127, "node_id": "MDQ6VXNlcjE3MzEyNw==", "avatar_url": "https://avatars.githubusercontent.com/u/173127?v=4", "gravatar_id": "", "url": "https://api.github.com/users/pnkfelix", "html_url": "https://github.com/pnkfelix", "followers_url": "https://api.github.com/users/pnkfelix/followers", "following_url": "https://api.github.com/users/pnkfelix/following{/other_user}", "gists_url": "https://api.github.com/users/pnkfelix/gists{/gist_id}", "starred_url": "https://api.github.com/users/pnkfelix/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/pnkfelix/subscriptions", "organizations_url": "https://api.github.com/users/pnkfelix/orgs", "repos_url": "https://api.github.com/users/pnkfelix/repos", "events_url": "https://api.github.com/users/pnkfelix/events{/privacy}", "received_events_url": "https://api.github.com/users/pnkfelix/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 37544, "node_id": "MDU6TGFiZWwzNzU0NA==", "url": "https://api.github.com/repos/rust-lang/rust/labels/A-typesystem", "name": "A-typesystem", "color": "f7e101", "default": false, "description": "Area: The type system"}, {"id": 13836860, "node_id": "MDU6TGFiZWwxMzgzNjg2MA==", "url": "https://api.github.com/repos/rust-lang/rust/labels/A-traits", "name": "A-traits", "color": "f7e101", "default": false, "description": "Area: Trait system"}], "state": "closed", "locked": false, "assignee": {"login": "pnkfelix", "id": 173127, "node_id": "MDQ6VXNlcjE3MzEyNw==", "avatar_url": "https://avatars.githubusercontent.com/u/173127?v=4", "gravatar_id": "", "url": "https://api.github.com/users/pnkfelix", "html_url": "https://github.com/pnkfelix", "followers_url": "https://api.github.com/users/pnkfelix/followers", "following_url": "https://api.github.com/users/pnkfelix/following{/other_user}", "gists_url": "https://api.github.com/users/pnkfelix/gists{/gist_id}", "starred_url": "https://api.github.com/users/pnkfelix/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/pnkfelix/subscriptions", "organizations_url": "https://api.github.com/users/pnkfelix/orgs", "repos_url": "https://api.github.com/users/pnkfelix/repos", "events_url": "https://api.github.com/users/pnkfelix/events{/privacy}", "received_events_url": "https://api.github.com/users/pnkfelix/received_events", "type": "User", "site_admin": false}, "assignees": [{"login": "pnkfelix", "id": 173127, "node_id": "MDQ6VXNlcjE3MzEyNw==", "avatar_url": "https://avatars.githubusercontent.com/u/173127?v=4", "gravatar_id": "", "url": "https://api.github.com/users/pnkfelix", "html_url": "https://github.com/pnkfelix", "followers_url": "https://api.github.com/users/pnkfelix/followers", "following_url": "https://api.github.com/users/pnkfelix/following{/other_user}", "gists_url": "https://api.github.com/users/pnkfelix/gists{/gist_id}", "starred_url": "https://api.github.com/users/pnkfelix/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/pnkfelix/subscriptions", "organizations_url": "https://api.github.com/users/pnkfelix/orgs", "repos_url": "https://api.github.com/users/pnkfelix/repos", "events_url": "https://api.github.com/users/pnkfelix/events{/privacy}", "received_events_url": "https://api.github.com/users/pnkfelix/received_events", "type": "User", "site_admin": false}], "milestone": null, "comments": 6, "created_at": "2015-02-23T21:19:56Z", "updated_at": "2015-07-07T11:37:14Z", "closed_at": "2015-07-07T11:37:14Z", "author_association": "MEMBER", "active_lock_reason": null, "body": "spawned off of #21259 \n\ntest case\n\n``` rust\nuse std::default::Default;\n\ntrait Impled { fn f(&self) {} }\ntrait Vr: Impled {\n    type Y: Default + Par<<Self as Impled>::Noexist>; fn g(&self) {}\n}\ntrait Par<X:Default> {\n    fn h(&self) -> (X, String) { (Default::default(), format!(\"Par::h\")) }\n}\n\nstruct S1;\nimpl Impled for S1 {}\nimpl Vr for S1 { type Y = (); }\nimpl Par<()> for () { }\n\nfn main() {\n    let y: <S1 as Vr>::Y = Default::default();\n    let (_, s) = Par::h(&y);\n    println!(\"{}\", s);\n}\n```\n\nThe above code should be rejected by the compiler, because `<Self as Impled>::Noexist` is not a well-formed projection of an associated item.  Instead, it currently runs.\n\n---\n\n(This bug is not quite as bad as it might seem, since one easily runs into problems if one actually attempts to program generically with this trait and associated item, as shown in the below modification to the last three lines above.  This new program is correctly rejected by the compiler, though perhaps with messages that are ... subpar:)\n\n``` rust\nfn foo<V:Vr>(v: V) {\n    let y: <V as Vr>::Y = Default::default();\n    let (_, s) = Par::h(&y);\n    println!(\"{}\", s);\n}\nfn main() {\n    foo(S1);\n}\n```\n\nTranscript of error output:\n\n```\n../src/test/compile-fail/issue-21259-e.rs:18:18: 18:24 error: the trait `core::marker::Sized` is not implemented for the type `<V as Impled>::Noexist` [E0277]\n../src/test/compile-fail/issue-21259-e.rs:18     let (_, s) = Par::h(&y);\n                                                              ^~~~~~\n../src/test/compile-fail/issue-21259-e.rs:18:18: 18:24 note: `<V as Impled>::Noexist` does not have a constant size known at compile-time\n../src/test/compile-fail/issue-21259-e.rs:18     let (_, s) = Par::h(&y);\n                                                              ^~~~~~\n../src/test/compile-fail/issue-21259-e.rs:18:18: 18:24 error: the trait `core::default::Default` is not implemented for the type `<V as Impled>::Noexist` [E0277]\n../src/test/compile-fail/issue-21259-e.rs:18     let (_, s) = Par::h(&y);\n                                                              ^~~~~~\nerror: aborting due to 2 previous errors\n```\n", "closed_by": {"login": "arielb1", "id": 1830974, "node_id": "MDQ6VXNlcjE4MzA5NzQ=", "avatar_url": "https://avatars.githubusercontent.com/u/1830974?v=4", "gravatar_id": "", "url": "https://api.github.com/users/arielb1", "html_url": "https://github.com/arielb1", "followers_url": "https://api.github.com/users/arielb1/followers", "following_url": "https://api.github.com/users/arielb1/following{/other_user}", "gists_url": "https://api.github.com/users/arielb1/gists{/gist_id}", "starred_url": "https://api.github.com/users/arielb1/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/arielb1/subscriptions", "organizations_url": "https://api.github.com/users/arielb1/orgs", "repos_url": "https://api.github.com/users/arielb1/repos", "events_url": "https://api.github.com/users/arielb1/events{/privacy}", "received_events_url": "https://api.github.com/users/arielb1/received_events", "type": "User", "site_admin": false}, "reactions": {"url": "https://api.github.com/repos/rust-lang/rust/issues/22731/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rust-lang/rust/issues/22731/timeline", "performed_via_github_app": null, "state_reason": "completed"}