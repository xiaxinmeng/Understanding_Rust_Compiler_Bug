{"url": "https://api.github.com/repos/rust-lang/rust/issues/18650", "repository_url": "https://api.github.com/repos/rust-lang/rust", "labels_url": "https://api.github.com/repos/rust-lang/rust/issues/18650/labels{/name}", "comments_url": "https://api.github.com/repos/rust-lang/rust/issues/18650/comments", "events_url": "https://api.github.com/repos/rust-lang/rust/issues/18650/events", "html_url": "https://github.com/rust-lang/rust/issues/18650", "id": 47824352, "node_id": "MDU6SXNzdWU0NzgyNDM1Mg==", "number": 18650, "title": "ld: archive has no table of contents file", "user": {"login": "benanders", "id": 2859898, "node_id": "MDQ6VXNlcjI4NTk4OTg=", "avatar_url": "https://avatars.githubusercontent.com/u/2859898?v=4", "gravatar_id": "", "url": "https://api.github.com/users/benanders", "html_url": "https://github.com/benanders", "followers_url": "https://api.github.com/users/benanders/followers", "following_url": "https://api.github.com/users/benanders/following{/other_user}", "gists_url": "https://api.github.com/users/benanders/gists{/gist_id}", "starred_url": "https://api.github.com/users/benanders/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/benanders/subscriptions", "organizations_url": "https://api.github.com/users/benanders/orgs", "repos_url": "https://api.github.com/users/benanders/repos", "events_url": "https://api.github.com/users/benanders/events{/privacy}", "received_events_url": "https://api.github.com/users/benanders/received_events", "type": "User", "site_admin": false}, "labels": [], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 6, "created_at": "2014-11-05T11:10:16Z", "updated_at": "2014-11-16T08:20:12Z", "closed_at": "2014-11-16T08:20:12Z", "author_association": "NONE", "active_lock_reason": null, "body": "Hi, I'm trying to make a really really simple hello world program in Rust using a custom library through Cargo, and I'm getting the error:\n\n```\n   Compiling rstestlib v0.0.1 (file:///Users/benanderson/Desktop/rstest)\n   Compiling rstest v0.0.1 (file:///Users/benanderson/Desktop/rstest)\nerror: linking with `cc` failed: exit code: 1\nnote: cc '-m64' '-L' '/usr/local/lib/rustlib/x86_64-apple-darwin/lib' '-o' '/Users/benanderson/Desktop/rstest/target/rstest' '/Users/benanderson/Desktop/rstest/target/rstest.o' '-Wl,-force_load,/usr/local/lib/rustlib/x86_64-apple-darwin/lib/libmorestack.a' '-nodefaultlibs' '-fno-lto' '-Wl,-dead_strip' '/usr/local/lib/rustlib/x86_64-apple-darwin/lib/libnative-4e7c5e5c.rlib' '/Users/benanderson/Desktop/rstest/target/deps/librstestlib-1806f5315b450877.rlib' '/usr/local/lib/rustlib/x86_64-apple-darwin/lib/libstd-4e7c5e5c.rlib' '/usr/local/lib/rustlib/x86_64-apple-darwin/lib/librand-4e7c5e5c.rlib' '/usr/local/lib/rustlib/x86_64-apple-darwin/lib/libsync-4e7c5e5c.rlib' '/usr/local/lib/rustlib/x86_64-apple-darwin/lib/librustrt-4e7c5e5c.rlib' '/usr/local/lib/rustlib/x86_64-apple-darwin/lib/libcollections-4e7c5e5c.rlib' '/usr/local/lib/rustlib/x86_64-apple-darwin/lib/libunicode-4e7c5e5c.rlib' '/usr/local/lib/rustlib/x86_64-apple-darwin/lib/liballoc-4e7c5e5c.rlib' '/usr/local/lib/rustlib/x86_64-apple-darwin/lib/liblibc-4e7c5e5c.rlib' '/usr/local/lib/rustlib/x86_64-apple-darwin/lib/libcore-4e7c5e5c.rlib' '-L' '/Users/benanderson/Desktop/rstest/target' '-L' '/Users/benanderson/Desktop/rstest/target/deps' '-L' '/Users/benanderson/Desktop/rstest/.rust' '-L' '/Users/benanderson/Desktop/rstest' '-lSystem' '-lpthread' '-lc' '-lm' '-lcompiler-rt'\nnote: ld: warning: directory not found for option '-L/Users/benanderson/Desktop/rstest/.rust'\nld: archive has no table of contents file '/Users/benanderson/Desktop/rstest/target/deps/librstestlib-1806f5315b450877.rlib' for architecture x86_64\nclang: error: linker command failed with exit code 1 (use -v to see invocation)\n\nerror: aborting due to previous error\nCould not compile `rstest`.\n```\n\nI have a lib rstestlib, containing a lib.rs with this inside it:\n\n``` rust\npub fn test() {\n    println!(\"Test\");\n}\n```\n\nAnd the rstest program has a main.rs with:\n\n``` rust\nextern crate rstestlib;\nfn main() {\n    rstestlib::test();\n}\n```\n\nThe rstest program has this as a Cargo.toml file:\n\n```\n[package]\nname = \"rstest\"\nversion = \"0.0.1\"\nauthors = [\"GravityScore <gravityscore@gmail.com>\"]\n\n[dependencies.rstestlib]\npath = \"../rstestlib\"\n```\n\nAnd the rstestlib program has this as a Cargo.toml:\n\n```\n[package]\nname = \"rstestlib\"\nversion = \"0.0.1\"\nauthors = [\"GravityScore <gravityscore@gmail.com>\"]\n```\n\nI've just reinstalled rust using the 1 line console command from the Cargo website. The output of rustc -v is `rustc 0.13.0-nightly (0a5e7f359 2014-11-03 23:16:55 +0000)`. I've had this problem for a while now, and it's really disappointing because I love rust so much, but I can't use it at all anymore. \n\nI've tried running `ranlib target/deps/librstestlib*` as some internet sources (eg. [here](http://stackoverflow.com/questions/4445735/why-do-i-get-ld-in-libunittest-a-archive-has-no-table-of-contents-when-bui)) suggest, but when I do this I get a bunch of undefined symbols for architecture, and a note saying the .rlib file was not built for the current architecture I'm trying to build for (which is x86_64):\n\n```\nBens-MacBook-Pro-4:rstest benanderson$ ranlib target/deps/librstestlib*\nBens-MacBook-Pro-4:rstest benanderson$ cargo build\n   Compiling rstest v0.0.1 (file:///Users/benanderson/Desktop/rstest)\nerror: linking with `cc` failed: exit code: 1\nnote: cc '-m64' '-L' '/usr/local/lib/rustlib/x86_64-apple-darwin/lib' '-o' '/Users/benanderson/Desktop/rstest/target/rstest' '/Users/benanderson/Desktop/rstest/target/rstest.o' '-Wl,-force_load,/usr/local/lib/rustlib/x86_64-apple-darwin/lib/libmorestack.a' '-nodefaultlibs' '-fno-lto' '-Wl,-dead_strip' '/usr/local/lib/rustlib/x86_64-apple-darwin/lib/libnative-4e7c5e5c.rlib' '/Users/benanderson/Desktop/rstest/target/deps/librstestlib-1806f5315b450877.rlib' '/usr/local/lib/rustlib/x86_64-apple-darwin/lib/libstd-4e7c5e5c.rlib' '/usr/local/lib/rustlib/x86_64-apple-darwin/lib/libsync-4e7c5e5c.rlib' '/usr/local/lib/rustlib/x86_64-apple-darwin/lib/librustrt-4e7c5e5c.rlib' '/usr/local/lib/rustlib/x86_64-apple-darwin/lib/libcollections-4e7c5e5c.rlib' '/usr/local/lib/rustlib/x86_64-apple-darwin/lib/libunicode-4e7c5e5c.rlib' '/usr/local/lib/rustlib/x86_64-apple-darwin/lib/liballoc-4e7c5e5c.rlib' '/usr/local/lib/rustlib/x86_64-apple-darwin/lib/liblibc-4e7c5e5c.rlib' '/usr/local/lib/rustlib/x86_64-apple-darwin/lib/librand-4e7c5e5c.rlib' '/usr/local/lib/rustlib/x86_64-apple-darwin/lib/libcore-4e7c5e5c.rlib' '-L' '/Users/benanderson/Desktop/rstest/target' '-L' '/Users/benanderson/Desktop/rstest/target/deps' '-L' '/Users/benanderson/Desktop/rstest/.rust' '-L' '/Users/benanderson/Desktop/rstest' '-lSystem' '-lpthread' '-lc' '-lm' '-lcompiler-rt'\nnote: ld: warning: directory not found for option '-L/Users/benanderson/Desktop/rstest/.rust'\n\nld: warning: ignoring file /Users/benanderson/Desktop/rstest/target/deps/librstestlib-1806f5315b450877.rlib, file was built for archive which is not the architecture being linked (x86_64): /Users/benanderson/Desktop/rstest/target/deps/librstestlib-1806f5315b450877.rlib\n\nUndefined symbols for architecture x86_64:\n  \"test::hb3734900dfb5a78ddaa\", referenced from:\n      main::h7d8e0789b2179c99faa in rstest.o\nld: symbol(s) not found for architecture x86_64\nclang: error: linker command failed with exit code 1 (use -v to see invocation)\n\nerror: aborting due to previous error\nCould not compile `rstest`.\n```\n\nBut, if I run `lipo -info target/deps/librstestlib*`, it says the archive file was built for x86_64:\n\n```\ninput file target/deps/librstestlib-1806f5315b450877.rlib is not a fat file\nNon-fat file: target/deps/librstestlib-1806f5315b450877.rlib is architecture: x86_64\n```\n\nThis happens with any library I try and link, ones from GitHub or locally. I'm running OSX Yosemite (10.10), with the latest Xcode (6.1) and OSX SDKs installed. I get the same problem if I bypass Cargo and compile using rustc directly as well, so it's not a Cargo problem. I used the command `rustc -L\"../rstestlib/target\" src/main.rs`.\n\nDoes someone know what's going on here? I'm really stuck and can't figure out why this is happening. I really love Rust and really appreciate all the hard work that's gone into making it - it is fantastic. But it's not working at the moment, which is really disappointing and very limiting if I can't link against libraries. \n", "closed_by": {"login": "benanders", "id": 2859898, "node_id": "MDQ6VXNlcjI4NTk4OTg=", "avatar_url": "https://avatars.githubusercontent.com/u/2859898?v=4", "gravatar_id": "", "url": "https://api.github.com/users/benanders", "html_url": "https://github.com/benanders", "followers_url": "https://api.github.com/users/benanders/followers", "following_url": "https://api.github.com/users/benanders/following{/other_user}", "gists_url": "https://api.github.com/users/benanders/gists{/gist_id}", "starred_url": "https://api.github.com/users/benanders/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/benanders/subscriptions", "organizations_url": "https://api.github.com/users/benanders/orgs", "repos_url": "https://api.github.com/users/benanders/repos", "events_url": "https://api.github.com/users/benanders/events{/privacy}", "received_events_url": "https://api.github.com/users/benanders/received_events", "type": "User", "site_admin": false}, "reactions": {"url": "https://api.github.com/repos/rust-lang/rust/issues/18650/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rust-lang/rust/issues/18650/timeline", "performed_via_github_app": null, "state_reason": "completed"}