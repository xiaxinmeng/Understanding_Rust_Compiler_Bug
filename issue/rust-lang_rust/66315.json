{"url": "https://api.github.com/repos/rust-lang/rust/issues/66315", "repository_url": "https://api.github.com/repos/rust-lang/rust", "labels_url": "https://api.github.com/repos/rust-lang/rust/issues/66315/labels{/name}", "comments_url": "https://api.github.com/repos/rust-lang/rust/issues/66315/comments", "events_url": "https://api.github.com/repos/rust-lang/rust/issues/66315/events", "html_url": "https://github.com/rust-lang/rust/issues/66315", "id": 521206211, "node_id": "MDU6SXNzdWU1MjEyMDYyMTE=", "number": 66315, "title": "LLVM assertion from pointer arithmetic on i686-pc-windows-gnu", "user": {"login": "matthewjasper", "id": 20113453, "node_id": "MDQ6VXNlcjIwMTEzNDUz", "avatar_url": "https://avatars.githubusercontent.com/u/20113453?v=4", "gravatar_id": "", "url": "https://api.github.com/users/matthewjasper", "html_url": "https://github.com/matthewjasper", "followers_url": "https://api.github.com/users/matthewjasper/followers", "following_url": "https://api.github.com/users/matthewjasper/following{/other_user}", "gists_url": "https://api.github.com/users/matthewjasper/gists{/gist_id}", "starred_url": "https://api.github.com/users/matthewjasper/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/matthewjasper/subscriptions", "organizations_url": "https://api.github.com/users/matthewjasper/orgs", "repos_url": "https://api.github.com/users/matthewjasper/repos", "events_url": "https://api.github.com/users/matthewjasper/events{/privacy}", "received_events_url": "https://api.github.com/users/matthewjasper/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 100522, "node_id": "MDU6TGFiZWwxMDA1MjI=", "url": "https://api.github.com/repos/rust-lang/rust/labels/I-crash", "name": "I-crash", "color": "e10c02", "default": false, "description": "Issue: The compiler crashes (SIGSEGV, SIGABRT, etc). Use I-ICE instead when the compiler panics."}, {"id": 108333, "node_id": "MDU6TGFiZWwxMDgzMzM=", "url": "https://api.github.com/repos/rust-lang/rust/labels/A-LLVM", "name": "A-LLVM", "color": "f7e101", "default": false, "description": "Area: Code generation parts specific to LLVM. Both correctness bugs and optimization-related issues."}, {"id": 55301991, "node_id": "MDU6TGFiZWw1NTMwMTk5MQ==", "url": "https://api.github.com/repos/rust-lang/rust/labels/O-x86", "name": "O-x86", "color": "6e6ec0", "default": false, "description": "Target: x86 processors"}, {"id": 266005714, "node_id": "MDU6TGFiZWwyNjYwMDU3MTQ=", "url": "https://api.github.com/repos/rust-lang/rust/labels/O-windows-gnu", "name": "O-windows-gnu", "color": "6e6ec0", "default": false, "description": "Toolchain: GNU, Operating system: Windows"}, {"id": 650731663, "node_id": "MDU6TGFiZWw2NTA3MzE2NjM=", "url": "https://api.github.com/repos/rust-lang/rust/labels/C-bug", "name": "C-bug", "color": "f5f1fd", "default": false, "description": "Category: This is a bug."}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 2, "created_at": "2019-11-11T21:49:00Z", "updated_at": "2019-11-12T15:56:12Z", "closed_at": "2019-11-12T15:56:12Z", "author_association": "CONTRIBUTOR", "active_lock_reason": null, "body": "The following code, when compiled with opt level of 2 or higher results in an llvm assertion (if they're enabled) on i686-pc-windows-gnu.\r\n\r\n```rust\r\n#![crate_type=\"lib\"]\r\n\r\npub fn check_overlap(ext: &i32) -> usize {\r\n    let src_usize = &1 as *const _ as usize;\r\n    let dst_usize = ext as *const _ as usize;\r\n    let mut diff = src_usize.wrapping_sub(dst_usize);\r\n    if src_usize > dst_usize {\r\n        diff = diff.wrapping_neg();\r\n    };\r\n\r\n    diff\r\n}\r\n```\r\n\r\n<details>\r\n\r\n<summary>llc backtrace when compiling the --emit llvm-ir output</summary>\r\n\r\n```text\r\nllc: ./src/llvm-project/llvm/include/llvm/CodeGen/MachineOperand.h:527: int64_t llvm::MachineOperand::getImm() const: Assertion `isImm() && \"Wrong MachineOperand accessor\"' failed.\r\nStack dump:\r\n0.\tProgram arguments: ./build/x86_64-unknown-linux-gnu/llvm/bin/llc -O1 /media/matthew/Data1/Matthew/dev/proc-macro2/lib.ll -o - \r\n1.\tRunning pass 'Function Pass Manager' on module '/media/matthew/Data1/Matthew/dev/proc-macro2/lib.ll'.\r\n2.\tRunning pass 'Two-Address instruction pass' on function '@check_overlap'\r\n #0 0x00007f4aaa65a2de llvm::sys::PrintStackTrace(llvm::raw_ostream&) (./build/x86_64-unknown-linux-gnu/llvm/bin/../lib/libLLVM-9-rust-1.40.0-dev-14a3b1230.so+0xa5f2de)\r\n #1 0x00007f4aaa6580f4 llvm::sys::RunSignalHandlers() (./build/x86_64-unknown-linux-gnu/llvm/bin/../lib/libLLVM-9-rust-1.40.0-dev-14a3b1230.so+0xa5d0f4)\r\n #2 0x00007f4aaa658275 SignalHandler(int) (./build/x86_64-unknown-linux-gnu/llvm/bin/../lib/libLLVM-9-rust-1.40.0-dev-14a3b1230.so+0xa5d275)\r\n #3 0x00007f4aa9845470 (/lib/x86_64-linux-gnu/libc.so.6+0x46470)\r\n #4 0x00007f4aa98453eb raise /build/glibc-4WA41p/glibc-2.30/signal/../sysdeps/unix/sysv/linux/raise.c:51:1\r\n #5 0x00007f4aa9824899 abort /build/glibc-4WA41p/glibc-2.30/stdlib/abort.c:81:7\r\n #6 0x00007f4aa9824769 get_sysdep_segment_value /build/glibc-4WA41p/glibc-2.30/intl/loadmsgcat.c:509:8\r\n #7 0x00007f4aa9824769 _nl_load_domain /build/glibc-4WA41p/glibc-2.30/intl/loadmsgcat.c:970:34\r\n #8 0x00007f4aa9836006 (/lib/x86_64-linux-gnu/libc.so.6+0x37006)\r\n #9 0x00007f4aaccc4c86 llvm::X86InstrInfo::convertToThreeAddress(llvm::ilist_iterator<llvm::ilist_detail::node_options<llvm::MachineBasicBlock, true, false, void>, false, false>&, llvm::MachineInstr&, llvm::LiveVariables*) const (./build/x86_64-unknown-linux-gnu/llvm/bin/../lib/libLLVM-9-rust-1.40.0-dev-14a3b1230.so+0x30c9c86)\r\n#10 0x00007f4aaac50916 (anonymous namespace)::TwoAddressInstructionPass::convertInstTo3Addr(llvm::MachineInstrBundleIterator<llvm::MachineInstr, false>&, llvm::MachineInstrBundleIterator<llvm::MachineInstr, false>&, unsigned int, unsigned int, unsigned int) (./build/x86_64-unknown-linux-gnu/llvm/bin/../lib/libLLVM-9-rust-1.40.0-dev-14a3b1230.so+0x1055916)\r\n#11 0x00007f4aaac527e8 (anonymous namespace)::TwoAddressInstructionPass::tryInstructionTransform(llvm::MachineInstrBundleIterator<llvm::MachineInstr, false>&, llvm::MachineInstrBundleIterator<llvm::MachineInstr, false>&, unsigned int, unsigned int, unsigned int, bool) (./build/x86_64-unknown-linux-gnu/llvm/bin/../lib/libLLVM-9-rust-1.40.0-dev-14a3b1230.so+0x10577e8)\r\n#12 0x00007f4aaac57155 (anonymous namespace)::TwoAddressInstructionPass::runOnMachineFunction(llvm::MachineFunction&) (./build/x86_64-unknown-linux-gnu/llvm/bin/../lib/libLLVM-9-rust-1.40.0-dev-14a3b1230.so+0x105c155)\r\n#13 0x00007f4aaaa04459 llvm::MachineFunctionPass::runOnFunction(llvm::Function&) (./build/x86_64-unknown-linux-gnu/llvm/bin/../lib/libLLVM-9-rust-1.40.0-dev-14a3b1230.so+0xe09459)\r\n#14 0x00007f4aaa7a5688 llvm::FPPassManager::runOnFunction(llvm::Function&) (./build/x86_64-unknown-linux-gnu/llvm/bin/../lib/libLLVM-9-rust-1.40.0-dev-14a3b1230.so+0xbaa688)\r\n#15 0x00007f4aaa7a57c1 llvm::FPPassManager::runOnModule(llvm::Module&) (./build/x86_64-unknown-linux-gnu/llvm/bin/../lib/libLLVM-9-rust-1.40.0-dev-14a3b1230.so+0xbaa7c1)\r\n#16 0x00007f4aaa7a4a19 llvm::legacy::PassManagerImpl::run(llvm::Module&) (./build/x86_64-unknown-linux-gnu/llvm/bin/../lib/libLLVM-9-rust-1.40.0-dev-14a3b1230.so+0xba9a19)\r\n#17 0x00005577274b31ec compileModule(char**, llvm::LLVMContext&) (./build/x86_64-unknown-linux-gnu/llvm/bin/llc+0x1e1ec)\r\n#18 0x00005577274a4dfa main (./build/x86_64-unknown-linux-gnu/llvm/bin/llc+0xfdfa)\r\n#19 0x00007f4aa98261e3 __libc_start_main /build/glibc-4WA41p/glibc-2.30/csu/../csu/libc-start.c:342:3\r\n#20 0x00005577274a4f4e _start (./build/x86_64-unknown-linux-gnu/llvm/bin/llc+0xff4e)\r\nAborted (core dumped)\r\n```\r\n\r\n</details>\r\n\r\n", "closed_by": {"login": "bors", "id": 3372342, "node_id": "MDQ6VXNlcjMzNzIzNDI=", "avatar_url": "https://avatars.githubusercontent.com/u/3372342?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors", "html_url": "https://github.com/bors", "followers_url": "https://api.github.com/users/bors/followers", "following_url": "https://api.github.com/users/bors/following{/other_user}", "gists_url": "https://api.github.com/users/bors/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors/subscriptions", "organizations_url": "https://api.github.com/users/bors/orgs", "repos_url": "https://api.github.com/users/bors/repos", "events_url": "https://api.github.com/users/bors/events{/privacy}", "received_events_url": "https://api.github.com/users/bors/received_events", "type": "User", "site_admin": false}, "reactions": {"url": "https://api.github.com/repos/rust-lang/rust/issues/66315/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rust-lang/rust/issues/66315/timeline", "performed_via_github_app": null, "state_reason": "completed"}