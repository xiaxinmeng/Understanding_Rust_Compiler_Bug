{"url": "https://api.github.com/repos/rust-lang/rust/issues/53709", "repository_url": "https://api.github.com/repos/rust-lang/rust", "labels_url": "https://api.github.com/repos/rust-lang/rust/issues/53709/labels{/name}", "comments_url": "https://api.github.com/repos/rust-lang/rust/issues/53709/comments", "events_url": "https://api.github.com/repos/rust-lang/rust/issues/53709/events", "html_url": "https://github.com/rust-lang/rust/issues/53709", "id": 354046389, "node_id": "MDU6SXNzdWUzNTQwNDYzODk=", "number": 53709, "title": "Compilation fail with #![cfg(test)] in lib.rs on last nightly, edition 2018", "user": {"login": "ghost", "id": 10137, "node_id": "MDQ6VXNlcjEwMTM3", "avatar_url": "https://avatars.githubusercontent.com/u/10137?v=4", "gravatar_id": "", "url": "https://api.github.com/users/ghost", "html_url": "https://github.com/ghost", "followers_url": "https://api.github.com/users/ghost/followers", "following_url": "https://api.github.com/users/ghost/following{/other_user}", "gists_url": "https://api.github.com/users/ghost/gists{/gist_id}", "starred_url": "https://api.github.com/users/ghost/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/ghost/subscriptions", "organizations_url": "https://api.github.com/users/ghost/orgs", "repos_url": "https://api.github.com/users/ghost/repos", "events_url": "https://api.github.com/users/ghost/events{/privacy}", "received_events_url": "https://api.github.com/users/ghost/received_events", "type": "User", "site_admin": false}, "labels": [], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 5, "created_at": "2018-08-25T21:57:27Z", "updated_at": "2023-02-22T11:15:13Z", "closed_at": "2023-02-22T11:15:13Z", "author_association": "NONE", "active_lock_reason": null, "body": "I tried to test bits of code in the `lib.rs` file and inserted the traditional `#![cfg(test)]` at the top, however when I ran `cargo test` or `cargo build`, it failed to compile.\r\n\r\n## Example code\r\n### Cargo.toml\r\n```toml\r\ncargo-features = [\"edition\"]\r\n\r\n[package]\r\nedition = '2018'\r\nname = \"test\"\r\nversion = \"0.1.0\"\r\n```\r\n### lib.rs\r\n```rust\r\n#![cfg(test)]\r\n\r\n#[test]\r\nfn test() {}\r\n```\r\n## Cargo output\r\n```rust\r\nerror[E0433]: failed to resolve. Maybe a missing `extern crate std;`?\r\n\r\nerror: aborting due to previous error\r\n\r\nFor more information about this error, try `rustc --explain E0433`.\r\nerror: Could not compile `test`.\r\nwarning: build failed, waiting for other jobs to finish...\r\nerror: build failed\r\n```\r\n\r\n## rustc --version --verbose\r\n```\r\nrustc 1.30.0-nightly (d41f21f11 2018-08-24)\r\nbinary: rustc\r\ncommit-hash: d41f21f11a249ad78990eb9a1ec899ec123c7136\r\ncommit-date: 2018-08-24\r\nhost: x86_64-unknown-linux-gnu\r\nrelease: 1.30.0-nightly\r\nLLVM version: 7.0\r\n```\r\n\r\n## Compilation status on other versions\r\n- **nightly-2018-07-07**: :heavy_check_mark: \r\n- **nightly-2018-08-06**: :heavy_check_mark: \r\n- **nightly-2018-08-14**: :heavy_check_mark: \r\n- **nightly-2018-08-15**: :x: \r\n- **nightly-2018-08-17**: :x: \r\n- **nightly-2018-08-18**: :x:\r\n- **nightly-2018-08-24**: :x:\r\n\r\n## Other infos\r\n- It compiles on edition 2015\r\n- It compiles on a binary project (fails on a library)\r\n- Inserting `extern crate std;` does not resolve the problem\r\n- Removing the `test` function does not resolve the problem\r\n\r\nI am not aware of such code being problematic in the edition 2018 so I think it should compile (or at least give a better error message).\r\n\r\nPS: First time contributing to Rust, hopefully the first of many more :smile:", "closed_by": {"login": "Dylan-DPC", "id": 99973273, "node_id": "U_kgDOBfV4mQ", "avatar_url": "https://avatars.githubusercontent.com/u/99973273?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Dylan-DPC", "html_url": "https://github.com/Dylan-DPC", "followers_url": "https://api.github.com/users/Dylan-DPC/followers", "following_url": "https://api.github.com/users/Dylan-DPC/following{/other_user}", "gists_url": "https://api.github.com/users/Dylan-DPC/gists{/gist_id}", "starred_url": "https://api.github.com/users/Dylan-DPC/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Dylan-DPC/subscriptions", "organizations_url": "https://api.github.com/users/Dylan-DPC/orgs", "repos_url": "https://api.github.com/users/Dylan-DPC/repos", "events_url": "https://api.github.com/users/Dylan-DPC/events{/privacy}", "received_events_url": "https://api.github.com/users/Dylan-DPC/received_events", "type": "User", "site_admin": false}, "reactions": {"url": "https://api.github.com/repos/rust-lang/rust/issues/53709/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rust-lang/rust/issues/53709/timeline", "performed_via_github_app": null, "state_reason": "not_planned"}