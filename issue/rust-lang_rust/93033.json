{"url": "https://api.github.com/repos/rust-lang/rust/issues/93033", "repository_url": "https://api.github.com/repos/rust-lang/rust", "labels_url": "https://api.github.com/repos/rust-lang/rust/issues/93033/labels{/name}", "comments_url": "https://api.github.com/repos/rust-lang/rust/issues/93033/comments", "events_url": "https://api.github.com/repos/rust-lang/rust/issues/93033/events", "html_url": "https://github.com/rust-lang/rust/issues/93033", "id": 1107004035, "node_id": "I_kwDOAAsO6M5B-4qD", "number": 93033, "title": "`x.py dist` builds tools twice due to dependency vendoring?", "user": {"login": "matthiaskrgr", "id": 476013, "node_id": "MDQ6VXNlcjQ3NjAxMw==", "avatar_url": "https://avatars.githubusercontent.com/u/476013?v=4", "gravatar_id": "", "url": "https://api.github.com/users/matthiaskrgr", "html_url": "https://github.com/matthiaskrgr", "followers_url": "https://api.github.com/users/matthiaskrgr/followers", "following_url": "https://api.github.com/users/matthiaskrgr/following{/other_user}", "gists_url": "https://api.github.com/users/matthiaskrgr/gists{/gist_id}", "starred_url": "https://api.github.com/users/matthiaskrgr/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/matthiaskrgr/subscriptions", "organizations_url": "https://api.github.com/users/matthiaskrgr/orgs", "repos_url": "https://api.github.com/users/matthiaskrgr/repos", "events_url": "https://api.github.com/users/matthiaskrgr/events{/privacy}", "received_events_url": "https://api.github.com/users/matthiaskrgr/received_events", "type": "User", "site_admin": false}, "labels": [], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 5, "created_at": "2022-01-18T14:54:25Z", "updated_at": "2022-01-25T17:21:33Z", "closed_at": "2022-01-23T15:37:42Z", "author_association": "MEMBER", "active_lock_reason": null, "body": "There is this problem that `x.py dist` builds most of the tools twice.\r\n\r\nIt seems that during the initial build (which is the same as `x.py build`) we take the normal sources from `$CARGO_HOME`, but then there is some dependency vendoring taking place which seems to override some of the dependency paths to the vendored ones.\r\n\r\nThis causes fingerprints to change and some of the tools to be rebuilt:\r\n\r\n````\r\n   Vendoring xz2 v0.1.6 (/home/matthias/.cargo/registry/src/github.com-1ecc6299db9ec823/xz2-0.1.6) to vendor/xz2\r\n   Vendoring yaml-merge-keys v0.4.1 (/home/matthias/.cargo/registry/src/github.com-1ecc6299db9ec823/yaml-merge-keys-0.4.1) to vendor/yaml-merge-keys\r\n   Vendoring yaml-rust v0.3.5 (/home/matthias/.cargo/registry/src/github.com-1ecc6299db9ec823/yaml-rust-0.3.5) to vendor/yaml-rust-0.3.5\r\n   Vendoring yaml-rust v0.4.4 (/home/matthias/.cargo/registry/src/github.com-1ecc6299db9ec823/yaml-rust-0.4.4) to vendor/yaml-rust\r\n   Vendoring yansi-term v0.1.2 (/home/matthias/.cargo/registry/src/github.com-1ecc6299db9ec823/yansi-term-0.1.2) to vendor/yansi-term\r\nTo use vendored sources, add this to your .cargo/config.toml for this project:\r\n\r\n[source.crates-io]\r\nreplace-with = \"vendored-sources\"\r\n\r\n[source.\"https://github.com/bjorn3/rust-ar.git\"]\r\ngit = \"https://github.com/bjorn3/rust-ar.git\"\r\nbranch = \"do_not_remove_cg_clif_ranlib\"\r\nreplace-with = \"vendored-sources\"\r\n\r\n[source.vendored-sources]\r\ndirectory = \"vendor\"\r\nDist rustc-1.60.0-dev-src\r\n\tfinished in 283.091 seconds\r\nBuilding stage1 tool cargo (x86_64-unknown-linux-gnu)\r\n[2022-01-18T14:45:58Z INFO  cargo::core::compiler::fingerprint] stale: changed \"/home/matthias/.cargo/registry/src/github.com-1ecc6299db9ec823/curl-sys-0.4.51+curl-7.80.0/curl\"\r\n[2022-01-18T14:45:58Z INFO  cargo::core::compiler::fingerprint]           (vs) \"/home/matthias/vcs/github/rust/build/x86_64-unknown-linux-gnu/stage1-tools/x86_64-unknown-linux-gnu/release/build/curl-sys-92c84ce359fc681e/output\"\r\n[2022-01-18T14:45:58Z INFO  cargo::core::compiler::fingerprint]                FileTime { seconds: 1642516164, nanos: 851099564 } != FileTime { seconds: 1642516869, nanos: 931076291 }\r\n[2022-01-18T14:45:58Z INFO  cargo::core::compiler::fingerprint] fingerprint error for cargo v0.60.0 (/home/matthias/vcs/github/rust/src/tools/cargo)/Build/TargetInner { ..: lib_target(\"cargo\", [\"lib\"], \"/home/matthias/vcs/github/rust/src/tools/cargo/src/cargo/lib.rs\", Edition2021) }\r\n[2022-01-18T14:45:58Z INFO  cargo::core::compiler::fingerprint]     err: current filesystem status shows we're outdated\r\n[2022-01-18T14:45:58Z INFO  cargo::core::compiler::fingerprint] fingerprint error for cargo v0.60.0 (/home/matthias/vcs/github/rust/src/tools/cargo)/RunCustomBuild/TargetInner { ..: custom_build_target(\"build-script-build\", \"/home/matthias/vcs/github/rust/src/tools/cargo/build.rs\", Edition2021) }\r\n[2022-01-18T14:45:58Z INFO  cargo::core::compiler::fingerprint]     err: current filesystem status shows we're outdated\r\n[2022-01-18T14:45:58Z INFO  cargo::core::compiler::fingerprint] fingerprint error for curl-sys v0.4.51+curl-7.80.0/RunCustomBuild/TargetInner { ..: custom_build_target(\"build-script-build\", \"/home/matthias/.cargo/registry/src/github.com-1ecc6299db9ec823/curl-sys-0.4.51+curl-7.80.0/build.rs\", Edition2018) }\r\n[2022-01-18T14:45:58Z INFO  cargo::core::compiler::fingerprint]     err: current filesystem status shows we're outdated\r\n[2022-01-18T14:45:58Z INFO  cargo::core::compiler::fingerprint] fingerprint error for crates-io v0.33.1 (/home/matthias/vcs/github/rust/src/tools/cargo/crates/crates-io)/Build/TargetInner { ..: lib_target(\"crates_io\", [\"lib\"], \"/home/matthias/vcs/github/rust/src/tools/cargo/crates/crates-io/lib.rs\", Edition2021) }\r\n[2022-01-18T14:45:58Z INFO  cargo::core::compiler::fingerprint]     err: current filesystem status shows we're outdated\r\n[2022-01-18T14:45:58Z INFO  cargo::core::compiler::fingerprint] fingerprint error for curl v0.4.41/Build/TargetInner { ..: lib_target(\"curl\", [\"lib\"], \"/home/matthias/.cargo/registry/src/github.com-1ecc6299db9ec823/curl-0.4.41/src/lib.rs\", Edition2018) }\r\n[2022-01-18T14:45:58Z INFO  cargo::core::compiler::fingerprint]     err: current filesystem status shows we're outdated\r\n[2022-01-18T14:45:58Z INFO  cargo::core::compiler::fingerprint] fingerprint error for curl v0.4.41/RunCustomBuild/TargetInner { ..: custom_build_target(\"build-script-build\", \"/home/matthias/.cargo/registry/src/github.com-1ecc6299db9ec823/curl-0.4.41/build.rs\", Edition2018) }\r\n[2022-01-18T14:45:58Z INFO  cargo::core::compiler::fingerprint]     err: current filesystem status shows we're outdated\r\n[2022-01-18T14:45:58Z INFO  cargo::core::compiler::fingerprint] fingerprint error for curl-sys v0.4.51+curl-7.80.0/Build/TargetInner { ..: lib_target(\"curl_sys\", [\"lib\"], \"/home/matthias/.cargo/registry/src/github.com-1ecc6299db9ec823/curl-sys-0.4.51+curl-7.80.0/lib.rs\", Edition2018) }\r\n[2022-01-18T14:45:58Z INFO  cargo::core::compiler::fingerprint]     err: current filesystem status shows we're outdated\r\n[2022-01-18T14:45:58Z INFO  cargo::core::compiler::fingerprint] fingerprint error for git2-curl v0.14.1/Build/TargetInner { ..: lib_target(\"git2-curl\", [\"lib\"], \"/home/matthias/.cargo/registry/src/github.com-1ecc6299db9ec823/git2-curl-0.14.1/src/lib.rs\", Edition2018) }\r\n[2022-01-18T14:45:58Z INFO  cargo::core::compiler::fingerprint]     err: current filesystem status shows we're outdated\r\n[2022-01-18T14:45:58Z INFO  cargo::core::compiler::fingerprint] fingerprint error for cargo v0.60.0 (/home/matthias/vcs/github/rust/src/tools/cargo)/Build/TargetInner { name: \"cargo\", tested: false, ..: with_path(\"/home/matthias/vcs/github/rust/src/tools/cargo/src/bin/cargo/main.rs\", Edition2021) }\r\n[2022-01-18T14:45:58Z INFO  cargo::core::compiler::fingerprint]     err: current filesystem status shows we're outdated\r\n   Compiling curl-sys v0.4.51+curl-7.80.0\r\n   Compiling curl v0.4.41\r\n   Compiling cargo v0.60.0 (/home/matthias/vcs/github/rust/src/tools/cargo)\r\n   Compiling crates-io v0.33.1 (/home/matthias/vcs/github/rust/src/tools/cargo/crates/crates-io)\r\n   Compiling git2-curl v0.14.1\r\n    Finished release [optimized] target(s) in 3m 17s\r\nBuilding stage1 tool cargo-credential-1password (x86_64-unknown-linux-gnu)\r\n````\r\n", "closed_by": {"login": "bors", "id": 3372342, "node_id": "MDQ6VXNlcjMzNzIzNDI=", "avatar_url": "https://avatars.githubusercontent.com/u/3372342?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors", "html_url": "https://github.com/bors", "followers_url": "https://api.github.com/users/bors/followers", "following_url": "https://api.github.com/users/bors/following{/other_user}", "gists_url": "https://api.github.com/users/bors/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors/subscriptions", "organizations_url": "https://api.github.com/users/bors/orgs", "repos_url": "https://api.github.com/users/bors/repos", "events_url": "https://api.github.com/users/bors/events{/privacy}", "received_events_url": "https://api.github.com/users/bors/received_events", "type": "User", "site_admin": false}, "reactions": {"url": "https://api.github.com/repos/rust-lang/rust/issues/93033/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rust-lang/rust/issues/93033/timeline", "performed_via_github_app": null, "state_reason": "completed"}