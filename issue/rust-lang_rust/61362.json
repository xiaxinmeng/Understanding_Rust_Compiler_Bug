{"url": "https://api.github.com/repos/rust-lang/rust/issues/61362", "repository_url": "https://api.github.com/repos/rust-lang/rust", "labels_url": "https://api.github.com/repos/rust-lang/rust/issues/61362/labels{/name}", "comments_url": "https://api.github.com/repos/rust-lang/rust/issues/61362/comments", "events_url": "https://api.github.com/repos/rust-lang/rust/issues/61362/events", "html_url": "https://github.com/rust-lang/rust/issues/61362", "id": 450420919, "node_id": "MDU6SXNzdWU0NTA0MjA5MTk=", "number": 61362, "title": "Missed optimization of non-public struct members", "user": {"login": "jfrimmel", "id": 31166235, "node_id": "MDQ6VXNlcjMxMTY2MjM1", "avatar_url": "https://avatars.githubusercontent.com/u/31166235?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jfrimmel", "html_url": "https://github.com/jfrimmel", "followers_url": "https://api.github.com/users/jfrimmel/followers", "following_url": "https://api.github.com/users/jfrimmel/following{/other_user}", "gists_url": "https://api.github.com/users/jfrimmel/gists{/gist_id}", "starred_url": "https://api.github.com/users/jfrimmel/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jfrimmel/subscriptions", "organizations_url": "https://api.github.com/users/jfrimmel/orgs", "repos_url": "https://api.github.com/users/jfrimmel/repos", "events_url": "https://api.github.com/users/jfrimmel/events{/privacy}", "received_events_url": "https://api.github.com/users/jfrimmel/received_events", "type": "User", "site_admin": false}, "labels": [], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 1, "created_at": "2019-05-30T17:32:16Z", "updated_at": "2019-05-30T18:39:30Z", "closed_at": "2019-05-30T18:39:30Z", "author_association": "CONTRIBUTOR", "active_lock_reason": null, "body": "The following source generates unnecessary instructions:\r\n```rust\r\npub struct S {\r\n    initialized: bool,\r\n}\r\nimpl S {\r\n    pub fn new() -> S {\r\n        S { initialized: false }\r\n    }\r\n\r\n    pub fn do_sth(&mut self) {\r\n        if !self.initialized {\r\n            self.initialized = true;\r\n        }\r\n    }\r\n}\r\n```\r\nThe generated assembly (with `-C opt-level=3`, see [compiler explorer](https://godbolt.org/z/rdYdz_))  includes the branching to set the `initialized` variable to `1` if it isn't already set. I think, that the compiler should be able to prove, that, although it is read and written, the struct member is unused (in the sense of: has no side effect) and thus could be removed completely (I'm not sure, whether the compiler is allowed to remove the struct member itself, but at least the compare can be eliminated).\r\n\r\nAre such missed optimizations worth mentioning and investigating in general or do they fall in the category of _micro-optimizations_?", "closed_by": {"login": "jfrimmel", "id": 31166235, "node_id": "MDQ6VXNlcjMxMTY2MjM1", "avatar_url": "https://avatars.githubusercontent.com/u/31166235?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jfrimmel", "html_url": "https://github.com/jfrimmel", "followers_url": "https://api.github.com/users/jfrimmel/followers", "following_url": "https://api.github.com/users/jfrimmel/following{/other_user}", "gists_url": "https://api.github.com/users/jfrimmel/gists{/gist_id}", "starred_url": "https://api.github.com/users/jfrimmel/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jfrimmel/subscriptions", "organizations_url": "https://api.github.com/users/jfrimmel/orgs", "repos_url": "https://api.github.com/users/jfrimmel/repos", "events_url": "https://api.github.com/users/jfrimmel/events{/privacy}", "received_events_url": "https://api.github.com/users/jfrimmel/received_events", "type": "User", "site_admin": false}, "reactions": {"url": "https://api.github.com/repos/rust-lang/rust/issues/61362/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rust-lang/rust/issues/61362/timeline", "performed_via_github_app": null, "state_reason": "completed"}