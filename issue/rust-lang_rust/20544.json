{"url": "https://api.github.com/repos/rust-lang/rust/issues/20544", "repository_url": "https://api.github.com/repos/rust-lang/rust", "labels_url": "https://api.github.com/repos/rust-lang/rust/issues/20544/labels{/name}", "comments_url": "https://api.github.com/repos/rust-lang/rust/issues/20544/comments", "events_url": "https://api.github.com/repos/rust-lang/rust/issues/20544/events", "html_url": "https://github.com/rust-lang/rust/issues/20544", "id": 53352365, "node_id": "MDU6SXNzdWU1MzM1MjM2NQ==", "number": 20544, "title": "ICE(?): LLVM ERROR: Broken module found, compilation aborted!", "user": {"login": "tikue", "id": 2915777, "node_id": "MDQ6VXNlcjI5MTU3Nzc=", "avatar_url": "https://avatars.githubusercontent.com/u/2915777?v=4", "gravatar_id": "", "url": "https://api.github.com/users/tikue", "html_url": "https://github.com/tikue", "followers_url": "https://api.github.com/users/tikue/followers", "following_url": "https://api.github.com/users/tikue/following{/other_user}", "gists_url": "https://api.github.com/users/tikue/gists{/gist_id}", "starred_url": "https://api.github.com/users/tikue/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/tikue/subscriptions", "organizations_url": "https://api.github.com/users/tikue/orgs", "repos_url": "https://api.github.com/users/tikue/repos", "events_url": "https://api.github.com/users/tikue/events{/privacy}", "received_events_url": "https://api.github.com/users/tikue/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 108333, "node_id": "MDU6TGFiZWwxMDgzMzM=", "url": "https://api.github.com/repos/rust-lang/rust/labels/A-LLVM", "name": "A-LLVM", "color": "f7e101", "default": false, "description": "Area: Code generation parts specific to LLVM. Both correctness bugs and optimization-related issues."}, {"id": 9618520, "node_id": "MDU6TGFiZWw5NjE4NTIw", "url": "https://api.github.com/repos/rust-lang/rust/labels/I-ICE", "name": "I-ICE", "color": "e10c02", "default": false, "description": "Issue: The compiler panicked, giving an Internal Compilation Error (ICE) \u2744\ufe0f"}, {"id": 46741598, "node_id": "MDU6TGFiZWw0Njc0MTU5OA==", "url": "https://api.github.com/repos/rust-lang/rust/labels/E-needs-test", "name": "E-needs-test", "color": "02e10c", "default": false, "description": "Call for participation: writing correctness tests"}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 8, "created_at": "2015-01-04T23:08:57Z", "updated_at": "2015-07-17T08:03:40Z", "closed_at": "2015-07-17T08:03:40Z", "author_association": "CONTRIBUTOR", "active_lock_reason": null, "body": "Sorry that this example isn't very minimal. I was basically just trying to use the Mul operator (*) as function composition.\n\n```\n#![feature(associated_types)]\n#![feature(unboxed_closures)]\n#![feature(default_type_params)]\n\nuse std::ops::Mul;\n\nstruct Fun<F: Fn(T) -> T, T>(F);\n\nimpl<F, T> Fn(T) -> T for Fun<F, T>\nwhere \n    F: Fn(T) -> T {\n\n    extern \"rust-call\" fn call(&self, (t,): (T,)) -> T {\n        (self.0)(t)\n    }\n}\n\nimpl<T, F1, F2> Mul<Fun<F2, T>> for Fun<F1, T>\nwhere \n    F1: Fn(T) -> T, \n    F2: Fn(T) -> T {\n\n    type Output = Compose<Fun<F1, T>, Fun<F2, T>, T>;\n    fn mul(self, rhs: Fun<F2, T>) -> Compose<Fun<F1, T>, Fun<F2, T>, T> {\n        Compose{f1: self, f2: rhs}\n    }\n}\n\n\nstruct Compose<F1, F2, T> where F1: Fn(T) -> T, F2: Fn(T) -> T {\n    f1: F1,\n    f2: F2\n}\n\nimpl<T, F1, F2> Fn(T) -> T for Compose<F1, F2, T> \nwhere\n    F1: Fn(T) -> T,\n    F2: Fn(T) -> T {\n\n    extern \"rust-call\" fn call(&self, (t,): (T,)) -> T {\n        (self.f1)((self.f2)(t))\n    }\n}\n\nfn main() {\n    let f1 = Fun(|i: int| i * 2);\n    let f2 = Fun(|i: int| i - 1);\n    let f3 = f1 * f2;\n    println!(\"{}\", f3(3));\n}\n```\n\nThe error when compiling:\n\n```\nGlobal is external, but doesn't have external or weak linkage!\ni64 (%closure*, i64)* @_ZN4main20unboxed_closure.1371E\ninvalid linkage type for function declaration\ni64 (%closure*, i64)* @_ZN4main20unboxed_closure.1371E\nGlobal is external, but doesn't have external or weak linkage!\ni64 (%closure.1*, i64)* @_ZN4main20unboxed_closure.1373E\ninvalid linkage type for function declaration\ni64 (%closure.1*, i64)* @_ZN4main20unboxed_closure.1373E\nLLVM ERROR: Broken module found, compilation aborted!\n```\n", "closed_by": {"login": "bors", "id": 3372342, "node_id": "MDQ6VXNlcjMzNzIzNDI=", "avatar_url": "https://avatars.githubusercontent.com/u/3372342?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors", "html_url": "https://github.com/bors", "followers_url": "https://api.github.com/users/bors/followers", "following_url": "https://api.github.com/users/bors/following{/other_user}", "gists_url": "https://api.github.com/users/bors/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors/subscriptions", "organizations_url": "https://api.github.com/users/bors/orgs", "repos_url": "https://api.github.com/users/bors/repos", "events_url": "https://api.github.com/users/bors/events{/privacy}", "received_events_url": "https://api.github.com/users/bors/received_events", "type": "User", "site_admin": false}, "reactions": {"url": "https://api.github.com/repos/rust-lang/rust/issues/20544/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rust-lang/rust/issues/20544/timeline", "performed_via_github_app": null, "state_reason": "completed"}