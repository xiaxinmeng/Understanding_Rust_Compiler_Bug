{"url": "https://api.github.com/repos/rust-lang/rust/issues/65031", "repository_url": "https://api.github.com/repos/rust-lang/rust", "labels_url": "https://api.github.com/repos/rust-lang/rust/issues/65031/labels{/name}", "comments_url": "https://api.github.com/repos/rust-lang/rust/issues/65031/comments", "events_url": "https://api.github.com/repos/rust-lang/rust/issues/65031/events", "html_url": "https://github.com/rust-lang/rust/issues/65031", "id": 501780794, "node_id": "MDU6SXNzdWU1MDE3ODA3OTQ=", "number": 65031, "title": "The `rustc_query_impl` crate is too big, which hurts compile times for the compiler itself", "user": {"login": "nnethercote", "id": 1940286, "node_id": "MDQ6VXNlcjE5NDAyODY=", "avatar_url": "https://avatars.githubusercontent.com/u/1940286?v=4", "gravatar_id": "", "url": "https://api.github.com/users/nnethercote", "html_url": "https://github.com/nnethercote", "followers_url": "https://api.github.com/users/nnethercote/followers", "following_url": "https://api.github.com/users/nnethercote/following{/other_user}", "gists_url": "https://api.github.com/users/nnethercote/gists{/gist_id}", "starred_url": "https://api.github.com/users/nnethercote/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/nnethercote/subscriptions", "organizations_url": "https://api.github.com/users/nnethercote/orgs", "repos_url": "https://api.github.com/users/nnethercote/repos", "events_url": "https://api.github.com/users/nnethercote/events{/privacy}", "received_events_url": "https://api.github.com/users/nnethercote/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 234902, "node_id": "MDU6TGFiZWwyMzQ5MDI=", "url": "https://api.github.com/repos/rust-lang/rust/labels/C-enhancement", "name": "C-enhancement", "color": "f5f1fd", "default": false, "description": "Category: An issue proposing an enhancement or a PR with one."}, {"id": 64037154, "node_id": "MDU6TGFiZWw2NDAzNzE1NA==", "url": "https://api.github.com/repos/rust-lang/rust/labels/I-compiletime", "name": "I-compiletime", "color": "e11d21", "default": false, "description": "Problems and improvements with respect to compile times."}, {"id": 211668100, "node_id": "MDU6TGFiZWwyMTE2NjgxMDA=", "url": "https://api.github.com/repos/rust-lang/rust/labels/T-compiler", "name": "T-compiler", "color": "bfd4f2", "default": false, "description": "Relevant to the compiler team, which will review and decide on the PR/issue."}, {"id": 2345380158, "node_id": "MDU6TGFiZWwyMzQ1MzgwMTU4", "url": "https://api.github.com/repos/rust-lang/rust/labels/A-contributor-roadblock", "name": "A-contributor-roadblock", "color": "f7e101", "default": false, "description": "Area: Makes things more difficult for new contributors to rust itself"}, {"id": 2420759390, "node_id": "MDU6TGFiZWwyNDIwNzU5Mzkw", "url": "https://api.github.com/repos/rust-lang/rust/labels/A-query-system", "name": "A-query-system", "color": "f7e101", "default": false, "description": "Area: The rustc query system (https://rustc-dev-guide.rust-lang.org/query.html)"}], "state": "open", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 38, "created_at": "2019-10-02T23:49:33Z", "updated_at": "2023-05-27T14:33:46Z", "closed_at": null, "author_association": "CONTRIBUTOR", "active_lock_reason": null, "body": "EDIT(Centril): The crate was renamed to `rustc_middle` in https://github.com/rust-lang/rust/pull/70536.\r\nEDIT(jyn514): Most of rustc_middle was split into `rustc_query_impl` in https://github.com/rust-lang/rust/pull/70951.\r\n\r\nThe [results](http://gistpreview.github.io/?74d799739504232991c49607d5ce748a) from @ehuss's new `cargo -Ztimings` feature really drive home how the size of the `rustc` crate hurts compile times for the compiler. Here's a picture:\r\n![a](https://user-images.githubusercontent.com/1940286/66088923-64d9fd00-e5c0-11e9-9b9d-5508ace23331.jpeg)\r\nThings to note.\r\n- The `rustc` crate takes about twice as long to compile as the `rustc_mir` crate, which is the second-biggest crate.\r\n- Sixteen dependent crates start and finish their entire compilation while the `rustc` crate's codegen is happening. (Thank goodness for pipelining, it really makes a difference in this case.)\r\n- Almost 1/3 of the total build time occurs while building the `rustc` crate without anything else happening in parallel (from 42-67s, and from 141-174s).\r\n\r\nAlso, even doing `check` builds on `rustc` code is painful. On my fast 28-core Linux box it takes 10-15 seconds even for the first compile error to come up. This is much longer than other crates. Refactorings within the `rustc` crate that require many edit/compile cycles are painful.\r\n\r\nI've been told that `rustc` is quite tangled and splitting it up could be difficult. That may well be true. The good news is that the picture shows we don't need to split it into 10 equal-sized pieces to get benefits. Even splitting off small chunks into separate crates will have an outsized effect on compilation times.\r\n", "closed_by": {"login": "jyn514", "id": 23638587, "node_id": "MDQ6VXNlcjIzNjM4NTg3", "avatar_url": "https://avatars.githubusercontent.com/u/23638587?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jyn514", "html_url": "https://github.com/jyn514", "followers_url": "https://api.github.com/users/jyn514/followers", "following_url": "https://api.github.com/users/jyn514/following{/other_user}", "gists_url": "https://api.github.com/users/jyn514/gists{/gist_id}", "starred_url": "https://api.github.com/users/jyn514/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jyn514/subscriptions", "organizations_url": "https://api.github.com/users/jyn514/orgs", "repos_url": "https://api.github.com/users/jyn514/repos", "events_url": "https://api.github.com/users/jyn514/events{/privacy}", "received_events_url": "https://api.github.com/users/jyn514/received_events", "type": "User", "site_admin": false}, "reactions": {"url": "https://api.github.com/repos/rust-lang/rust/issues/65031/reactions", "total_count": 20, "+1": 1, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 19, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rust-lang/rust/issues/65031/timeline", "performed_via_github_app": null, "state_reason": "reopened"}