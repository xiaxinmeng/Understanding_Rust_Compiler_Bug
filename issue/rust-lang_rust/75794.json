{"url": "https://api.github.com/repos/rust-lang/rust/issues/75794", "repository_url": "https://api.github.com/repos/rust-lang/rust", "labels_url": "https://api.github.com/repos/rust-lang/rust/issues/75794/labels{/name}", "comments_url": "https://api.github.com/repos/rust-lang/rust/issues/75794/comments", "events_url": "https://api.github.com/repos/rust-lang/rust/issues/75794/events", "html_url": "https://github.com/rust-lang/rust/issues/75794", "id": 683877414, "node_id": "MDU6SXNzdWU2ODM4Nzc0MTQ=", "number": 75794, "title": "Incorrect effect of stability attribute on calling private const fn", "user": {"login": "dtolnay", "id": 1940490, "node_id": "MDQ6VXNlcjE5NDA0OTA=", "avatar_url": "https://avatars.githubusercontent.com/u/1940490?v=4", "gravatar_id": "", "url": "https://api.github.com/users/dtolnay", "html_url": "https://github.com/dtolnay", "followers_url": "https://api.github.com/users/dtolnay/followers", "following_url": "https://api.github.com/users/dtolnay/following{/other_user}", "gists_url": "https://api.github.com/users/dtolnay/gists{/gist_id}", "starred_url": "https://api.github.com/users/dtolnay/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/dtolnay/subscriptions", "organizations_url": "https://api.github.com/users/dtolnay/orgs", "repos_url": "https://api.github.com/users/dtolnay/repos", "events_url": "https://api.github.com/users/dtolnay/events{/privacy}", "received_events_url": "https://api.github.com/users/dtolnay/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 201852178, "node_id": "MDU6TGFiZWwyMDE4NTIxNzg=", "url": "https://api.github.com/repos/rust-lang/rust/labels/A-stability", "name": "A-stability", "color": "f7e101", "default": false, "description": "Area: issues related to #[stable] and #[unstable] attributes themselves."}, {"id": 211668100, "node_id": "MDU6TGFiZWwyMTE2NjgxMDA=", "url": "https://api.github.com/repos/rust-lang/rust/labels/T-compiler", "name": "T-compiler", "color": "bfd4f2", "default": false, "description": "Relevant to the compiler team, which will review and decide on the PR/issue."}, {"id": 268744493, "node_id": "MDU6TGFiZWwyNjg3NDQ0OTM=", "url": "https://api.github.com/repos/rust-lang/rust/labels/A-const-fn", "name": "A-const-fn", "color": "f7e101", "default": false, "description": "Area: const fn foo(..) {..}. Pure functions which can be applied at compile time."}, {"id": 650731663, "node_id": "MDU6TGFiZWw2NTA3MzE2NjM=", "url": "https://api.github.com/repos/rust-lang/rust/labels/C-bug", "name": "C-bug", "color": "f5f1fd", "default": false, "description": "Category: This is a bug."}], "state": "open", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 19, "created_at": "2020-08-21T23:37:36Z", "updated_at": "2020-09-12T19:04:38Z", "closed_at": null, "author_association": "MEMBER", "active_lock_reason": null, "body": "In general we don't require private functions to have stability attributes. Stable functions are free to call private functions, and stable const functions are free to call private const functions that have no stability attribute.\r\n\r\nBut when a private const function inherits a stability attribute from an enclosing module, it currently can no longer be called from stable const functions. I think this behavior is not correct. For a *private* function, I would think stability attributes should be irrelevant.\r\n\r\nThis is causing trouble in https://github.com/rust-lang/rust/pull/75772#discussion_r474918624. \r\n\r\n```rust\r\n#![feature(staged_api, const_fn)]\r\n#![stable(feature = \"repro\", since = \"0\")]\r\n\r\nmod detail {\r\n    #![unstable(feature = \"detail\", issue = \"none\")]  // works if removed\r\n\r\n    pub(crate) const fn f() {}\r\n\r\n    // presumably other public stable things\r\n}\r\n\r\n#[stable(feature = \"repro\", since = \"0\")]\r\n#[rustc_const_stable(feature = \"repro\", since = \"0\")]\r\npub const fn f() {\r\n    detail::f();\r\n}\r\n```\r\n\r\n```console\r\nerror[E0723]: can only call other `const fn` within a `const fn`, but `const detail::f` is not stable as `const fn`\r\n  --> src/lib.rs:15:5\r\n   |\r\n15 |     detail::f();\r\n   |     ^^^^^^^^^^^\r\n   |\r\n   = note: see issue #57563 <https://github.com/rust-lang/rust/issues/57563> for more information\r\n   = help: add `#![feature(const_fn)]` to the crate attributes to enable\r\n```\r\n\r\nCross referencing `const fn` tracking issue #57563.", "closed_by": null, "reactions": {"url": "https://api.github.com/repos/rust-lang/rust/issues/75794/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rust-lang/rust/issues/75794/timeline", "performed_via_github_app": null, "state_reason": null}