{"url": "https://api.github.com/repos/rust-lang/rust/issues/20450", "repository_url": "https://api.github.com/repos/rust-lang/rust", "labels_url": "https://api.github.com/repos/rust-lang/rust/issues/20450/labels{/name}", "comments_url": "https://api.github.com/repos/rust-lang/rust/issues/20450/comments", "events_url": "https://api.github.com/repos/rust-lang/rust/issues/20450/events", "html_url": "https://github.com/rust-lang/rust/issues/20450", "id": 53288935, "node_id": "MDU6SXNzdWU1MzI4ODkzNQ==", "number": 20450, "title": "Stop using first class aggregates", "user": {"login": "dotdash", "id": 230962, "node_id": "MDQ6VXNlcjIzMDk2Mg==", "avatar_url": "https://avatars.githubusercontent.com/u/230962?v=4", "gravatar_id": "", "url": "https://api.github.com/users/dotdash", "html_url": "https://github.com/dotdash", "followers_url": "https://api.github.com/users/dotdash/followers", "following_url": "https://api.github.com/users/dotdash/following{/other_user}", "gists_url": "https://api.github.com/users/dotdash/gists{/gist_id}", "starred_url": "https://api.github.com/users/dotdash/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/dotdash/subscriptions", "organizations_url": "https://api.github.com/users/dotdash/orgs", "repos_url": "https://api.github.com/users/dotdash/repos", "events_url": "https://api.github.com/users/dotdash/events{/privacy}", "received_events_url": "https://api.github.com/users/dotdash/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 234956, "node_id": "MDU6TGFiZWwyMzQ5NTY=", "url": "https://api.github.com/repos/rust-lang/rust/labels/A-codegen", "name": "A-codegen", "color": "f7e101", "default": false, "description": "Area: Code generation"}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 4, "created_at": "2015-01-03T00:57:12Z", "updated_at": "2015-01-11T08:55:55Z", "closed_at": "2015-01-11T08:55:55Z", "author_association": "CONTRIBUTOR", "active_lock_reason": null, "body": "For small structs/enums (size <= `uint`) we currently prefer to pass them as immediate values (good) but unlike clang we don't \"cast\" them to an appropriately sized integer type but pass them around as first class aggregates (not so good).\n\nWhile LLVM supports the usage of FCAs, the optimizations largely depend on them being torn apart again, and that doesn't always work so great. The latest issue about that was #20149 for which I opted to patch LLVM to have it handle some basic store-to-load that involves FCA.\n\nThat led to the following email, in which Chandler Carruth suggests that we move away from using FCAs as much as possible: http://lists.cs.uiuc.edu/pipermail/llvm-commits/Week-of-Mon-20141229/250758.html\n\nAFAICT this would leave us with two choices:\n- Make all type that end up as structs or arrays in LLVM IR non-immediate\n\nor\n- Do as clang does and convert small structs to an appropriately sized integer type when using them as SSA values\n\n(Some) Related tickets are #20149 #16506 #13927\nCc @alexcrichton @thestinger @eddyb @erickt @Aatch @luqmana \n", "closed_by": {"login": "bors", "id": 3372342, "node_id": "MDQ6VXNlcjMzNzIzNDI=", "avatar_url": "https://avatars.githubusercontent.com/u/3372342?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors", "html_url": "https://github.com/bors", "followers_url": "https://api.github.com/users/bors/followers", "following_url": "https://api.github.com/users/bors/following{/other_user}", "gists_url": "https://api.github.com/users/bors/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors/subscriptions", "organizations_url": "https://api.github.com/users/bors/orgs", "repos_url": "https://api.github.com/users/bors/repos", "events_url": "https://api.github.com/users/bors/events{/privacy}", "received_events_url": "https://api.github.com/users/bors/received_events", "type": "User", "site_admin": false}, "reactions": {"url": "https://api.github.com/repos/rust-lang/rust/issues/20450/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rust-lang/rust/issues/20450/timeline", "performed_via_github_app": null, "state_reason": "completed"}