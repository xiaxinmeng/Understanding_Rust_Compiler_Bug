{"url": "https://api.github.com/repos/rust-lang/rust/issues/17959", "repository_url": "https://api.github.com/repos/rust-lang/rust", "labels_url": "https://api.github.com/repos/rust-lang/rust/issues/17959/labels{/name}", "comments_url": "https://api.github.com/repos/rust-lang/rust/issues/17959/comments", "events_url": "https://api.github.com/repos/rust-lang/rust/issues/17959/events", "html_url": "https://github.com/rust-lang/rust/issues/17959", "id": 45562968, "node_id": "MDU6SXNzdWU0NTU2Mjk2OA==", "number": 17959, "title": "ICE: unsafe_destructor and pointer to Sized? T", "user": {"login": "little-arhat", "id": 240531, "node_id": "MDQ6VXNlcjI0MDUzMQ==", "avatar_url": "https://avatars.githubusercontent.com/u/240531?v=4", "gravatar_id": "", "url": "https://api.github.com/users/little-arhat", "html_url": "https://github.com/little-arhat", "followers_url": "https://api.github.com/users/little-arhat/followers", "following_url": "https://api.github.com/users/little-arhat/following{/other_user}", "gists_url": "https://api.github.com/users/little-arhat/gists{/gist_id}", "starred_url": "https://api.github.com/users/little-arhat/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/little-arhat/subscriptions", "organizations_url": "https://api.github.com/users/little-arhat/orgs", "repos_url": "https://api.github.com/users/little-arhat/repos", "events_url": "https://api.github.com/users/little-arhat/events{/privacy}", "received_events_url": "https://api.github.com/users/little-arhat/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 9618520, "node_id": "MDU6TGFiZWw5NjE4NTIw", "url": "https://api.github.com/repos/rust-lang/rust/labels/I-ICE", "name": "I-ICE", "color": "e10c02", "default": false, "description": "Issue: The compiler panicked, giving an Internal Compilation Error (ICE) \u2744\ufe0f"}, {"id": 46741598, "node_id": "MDU6TGFiZWw0Njc0MTU5OA==", "url": "https://api.github.com/repos/rust-lang/rust/labels/E-needs-test", "name": "E-needs-test", "color": "02e10c", "default": false, "description": "Call for participation: writing correctness tests"}, {"id": 125141240, "node_id": "MDU6TGFiZWwxMjUxNDEyNDA=", "url": "https://api.github.com/repos/rust-lang/rust/labels/A-dst", "name": "A-dst", "color": "f7e101", "default": false, "description": "Area: Dynamically Sized Types"}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 4, "created_at": "2014-10-11T21:41:27Z", "updated_at": "2015-05-04T20:48:56Z", "closed_at": "2015-05-04T20:48:56Z", "author_association": "NONE", "active_lock_reason": null, "body": "Hit this while trying to get Rc to work with Traits inside, here is error and trace:\n\n```\nRUST_BACKTRACE=1 rustc x.rs\nx.rs:23:9: 23:10 warning: unused variable: `x`, #[warn(unused_variable)] on by default\nx.rs:23     let x:G<Bar>;\n                ^\nx.rs:1:1: 1:1 error: internal compiler error: Encountered error `Unimplemented` selecting `<*const Bar+'static as core::ptr::RawPtr<Bar+'static>>` during trans\nx.rs:1 #![feature(unsafe_destructor)]\n       ^\nnote: the compiler hit an unexpected failure path. this is a bug.\nnote: we would appreciate a bug report: http://doc.rust-lang.org/complement-bugreport.html\nnote: run with `RUST_BACKTRACE=1` for a backtrace\ntask 'rustc' failed at 'Box<Any>', /private/tmp/rust-jaR1Yf/src/libsyntax/diagnostic.rs:113\n\nstack backtrace:\n   1:        0x108514d99 - rt::backtrace::imp::write::h273044213f8a2894OLq\n   2:        0x1085180b1 - failure::on_fail::h0c4f1dedf6e42b45n2q\n   3:        0x108788a55 - unwind::begin_unwind_inner::hf294fceb7364c35dJud\n   4:        0x107c496a7 - unwind::begin_unwind::h15760749405991757620\n   5:        0x107c49640 - unwind::begin_unwind::h15760749405991757620\n   6:        0x10564fbbd - driver::session::Session::span_bug::h77f162e9927192568sy\n   7:        0x1058af248 - middle::trans::common::fulfill_obligation::hc2c86e36ef61e3720p7\n   8:        0x10587413c - middle::trans::meth::trans_static_method_callee::hd78422dcc619c285H1k\n   9:        0x10587c56a - middle::trans::callee::trans_call::closure.124198\n  10:        0x105853b64 - middle::trans::callee::trans_call_inner::h7083ee476552c80bJM2\n  11:        0x10587bdc7 - middle::trans::callee::trans_call::hbcd3295eac45cd284G2\n  12:        0x10588b621 - middle::trans::expr::trans_rvalue_dps_unadjusted::h091faa7fa9ae748diV4\n  13:        0x105889846 - middle::trans::expr::trans_unadjusted::h4687b5440f9f001cOh4\n  14:        0x10584d466 - middle::trans::expr::trans::h37ac91f8a5ab7eceKA3\n  15:        0x10589361a - middle::trans::expr::trans_binary::hc03bfcc1c44bed1euW5\n  16:        0x105889a66 - middle::trans::expr::trans_unadjusted::h4687b5440f9f001cOh4\n  17:        0x10584bfcd - middle::trans::expr::trans_into::h49532942979d7e36Qw3\n  18:        0x10584c30d - middle::trans::controlflow::trans_block::hb62bfc3bd29145ddlKZ\n  19:        0x1058fcf3e - middle::trans::base::trans_closure::h6516d41fe619fb89MFf\n  20:        0x10583e49a - middle::trans::base::trans_fn::h03123addb07e0c84aRf\n  21:        0x10584036e - middle::trans::monomorphize::monomorphic_fn::hae161eb11b7b9b092bZ\n  22:        0x105876fef - middle::trans::callee::trans_fn_ref_with_substs::h1c89324ccde73d421q2\n  23:        0x1058737cb - middle::trans::callee::trans_fn_ref::h08bb22de61cc16afzf2\n  24:        0x10585565d - middle::trans::meth::trans_method_callee::h929a999be88dbc4bhXk\n  25:        0x10587cddb - middle::trans::callee::trans_method_call::closure.124210\n  26:        0x105853b64 - middle::trans::callee::trans_call_inner::h7083ee476552c80bJM2\n  27:        0x10587cc34 - middle::trans::callee::trans_method_call::h56051e89a394e3d5cI2\n  28:        0x10588aa66 - middle::trans::expr::trans_rvalue_dps_unadjusted::h091faa7fa9ae748diV4\n  29:        0x105889846 - middle::trans::expr::trans_unadjusted::h4687b5440f9f001cOh4\n  30:        0x10584d466 - middle::trans::expr::trans::h37ac91f8a5ab7eceKA3\n  31:        0x105893c5f - middle::trans::expr::trans_unary::h06cacce96bad061fdC5\n  32:        0x105889a88 - middle::trans::expr::trans_unadjusted::h4687b5440f9f001cOh4\n  33:        0x10584d466 - middle::trans::expr::trans::h37ac91f8a5ab7eceKA3\n  34:        0x10584c7ce - middle::trans::controlflow::trans_if::h6aaf3e0e1595058b2MZ\n  35:        0x10588af00 - middle::trans::expr::trans_rvalue_dps_unadjusted::h091faa7fa9ae748diV4\n  36:        0x10584bfad - middle::trans::expr::trans_into::h49532942979d7e36Qw3\n  37:        0x10584c30d - middle::trans::controlflow::trans_block::hb62bfc3bd29145ddlKZ\n  38:        0x1058fcf3e - middle::trans::base::trans_closure::h6516d41fe619fb89MFf\n  39:        0x10583e49a - middle::trans::base::trans_fn::h03123addb07e0c84aRf\n  40:        0x10584036e - middle::trans::monomorphize::monomorphic_fn::hae161eb11b7b9b092bZ\n  41:        0x105866716 - middle::trans::base::get_res_dtor::h86daf3abd2d4c636VZd\n  42:        0x1058658c2 - middle::trans::glue::trans_struct_drop::h2f0ef3a8eaf46f60NG0\n  43:        0x10586580a - middle::trans::glue::trans_struct_drop_flag::closure.123855\n  44:        0x10586571e - middle::trans::base::with_cond::hd938d2ce54028d64eRe\n  45:        0x105863731 - middle::trans::glue::make_drop_glue::as_closure.123819\n  46:        0x1058624a6 - middle::trans::glue::make_generic_glue::h829e06c9ca5f1e5dji1\n  47:        0x105860881 - middle::trans::glue::get_drop_glue::hf9d8897b2193e2915q0\n  48:        0x10585fe68 - middle::trans::glue::drop_ty::h4fc02bdea2206c15Bm0\n  49:        0x105977e34 - middle::trans::cleanup::DropValue.Cleanup::trans::h29d99c7be18fce65Q9x\n  50:        0x10584b8ec - middle::trans::cleanup::FunctionContext<'blk, 'tcx>.CleanupMethods<'blk, 'tcx>::pop_and_trans_ast_cleanup_scope::hf5d8b4a67ca0650deWw\n  51:        0x10584c321 - middle::trans::controlflow::trans_block::hb62bfc3bd29145ddlKZ\n  52:        0x1058fcf3e - middle::trans::base::trans_closure::h6516d41fe619fb89MFf\n  53:        0x10583e49a - middle::trans::base::trans_fn::h03123addb07e0c84aRf\n  54:        0x10583bc15 - middle::trans::base::trans_item::h3a59f9835edac94etag\n  55:        0x105906a78 - middle::trans::base::trans_crate::h82fc9db67d8fc02dZ8g\n  56:        0x105d441b5 - driver::driver::phase_4_translate_to_llvm::he6e636df9afeed0b5Tx\n  57:        0x105d3c2b8 - driver::driver::compile_input::h368552c9534b42730qx\n  58:        0x105dc4e34 - driver::run_compiler::h06d188804fcb3e77jfB\n  59:        0x105dc2f66 - driver::run::closure.147679\n  60:        0x1054a83cb - task::TaskBuilder<S>::try_future::closure.101752\n  61:        0x1054a82b3 - task::TaskBuilder<S>::spawn_internal::closure.101723\n  62:        0x1054208ad - task::spawn_opts::closure.8528\n  63:        0x1087ee1fc - rust_try_inner\n  64:        0x1087ee1e6 - rust_try\n  65:        0x1087860c7 - unwind::try::h84e3668876f753a7rjd\n  66:        0x108785f4c - task::Task::run::h6ffe7aca8c2f2a9aCzc\n  67:        0x1054206d2 - task::spawn_opts::closure.8467\n  68:        0x10878790a - thread::thread_start::h0f961398128da0abNTc\n  69:     0x7fff8df4f899 - _pthread_body\n  70:     0x7fff8df4f72a - _pthread_struct_init\n```\n\nHere is minimal example that produces error:\n\n```\n#![feature(unsafe_destructor)]\n\nextern crate core;\n\nuse core::ops::Drop;\n\ntrait Bar {}\n\nstruct G<Sized? T> {\n    _ptr: *const T\n}\n\n#[unsafe_destructor]\nimpl<T> Drop for G<T> {\n    fn drop(&mut self) {\n        if !self._ptr.is_null() {\n        }\n    }\n}\n\nfn main() {\n    let x:G<Bar>;\n}\n```\n\nI'm using rust from master installed via `brew install --HEAD rust`, version: `rustc 0.13.0-dev`. \n", "closed_by": {"login": "bors", "id": 3372342, "node_id": "MDQ6VXNlcjMzNzIzNDI=", "avatar_url": "https://avatars.githubusercontent.com/u/3372342?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors", "html_url": "https://github.com/bors", "followers_url": "https://api.github.com/users/bors/followers", "following_url": "https://api.github.com/users/bors/following{/other_user}", "gists_url": "https://api.github.com/users/bors/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors/subscriptions", "organizations_url": "https://api.github.com/users/bors/orgs", "repos_url": "https://api.github.com/users/bors/repos", "events_url": "https://api.github.com/users/bors/events{/privacy}", "received_events_url": "https://api.github.com/users/bors/received_events", "type": "User", "site_admin": false}, "reactions": {"url": "https://api.github.com/repos/rust-lang/rust/issues/17959/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rust-lang/rust/issues/17959/timeline", "performed_via_github_app": null, "state_reason": "completed"}