{"url": "https://api.github.com/repos/rust-lang/rust/issues/62087", "repository_url": "https://api.github.com/repos/rust-lang/rust", "labels_url": "https://api.github.com/repos/rust-lang/rust/issues/62087/labels{/name}", "comments_url": "https://api.github.com/repos/rust-lang/rust/issues/62087/comments", "events_url": "https://api.github.com/repos/rust-lang/rust/issues/62087/events", "html_url": "https://github.com/rust-lang/rust/issues/62087", "id": 459614433, "node_id": "MDU6SXNzdWU0NTk2MTQ0MzM=", "number": 62087, "title": "Async/Await rustc assertion panic", "user": {"login": "Proximyst", "id": 19861299, "node_id": "MDQ6VXNlcjE5ODYxMjk5", "avatar_url": "https://avatars.githubusercontent.com/u/19861299?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Proximyst", "html_url": "https://github.com/Proximyst", "followers_url": "https://api.github.com/users/Proximyst/followers", "following_url": "https://api.github.com/users/Proximyst/following{/other_user}", "gists_url": "https://api.github.com/users/Proximyst/gists{/gist_id}", "starred_url": "https://api.github.com/users/Proximyst/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Proximyst/subscriptions", "organizations_url": "https://api.github.com/users/Proximyst/orgs", "repos_url": "https://api.github.com/users/Proximyst/repos", "events_url": "https://api.github.com/users/Proximyst/events{/privacy}", "received_events_url": "https://api.github.com/users/Proximyst/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 9618520, "node_id": "MDU6TGFiZWw5NjE4NTIw", "url": "https://api.github.com/repos/rust-lang/rust/labels/I-ICE", "name": "I-ICE", "color": "e10c02", "default": false, "description": "Issue: The compiler panicked, giving an Internal Compilation Error (ICE) \u2744\ufe0f"}, {"id": 211668100, "node_id": "MDU6TGFiZWwyMTE2NjgxMDA=", "url": "https://api.github.com/repos/rust-lang/rust/labels/T-compiler", "name": "T-compiler", "color": "bfd4f2", "default": false, "description": "Relevant to the compiler team, which will review and decide on the PR/issue."}, {"id": 650731663, "node_id": "MDU6TGFiZWw2NTA3MzE2NjM=", "url": "https://api.github.com/repos/rust-lang/rust/labels/C-bug", "name": "C-bug", "color": "f5f1fd", "default": false, "description": "Category: This is a bug."}, {"id": 1049510487, "node_id": "MDU6TGFiZWwxMDQ5NTEwNDg3", "url": "https://api.github.com/repos/rust-lang/rust/labels/A-async-await", "name": "A-async-await", "color": "f7e101", "default": false, "description": "Area: Async & Await"}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 3, "created_at": "2019-06-23T20:28:08Z", "updated_at": "2019-06-24T08:49:50Z", "closed_at": "2019-06-24T08:49:50Z", "author_association": "NONE", "active_lock_reason": null, "body": "When trying to pass on my server functionality to the API instead of the binary, rustc panics with `assertion failed: target_offset >= offset` found in `src/librustc_codegen_llvm/type_of.rs:130:9`.\r\n\r\nI tried this code:\r\n\r\nThere is no small piece of code for this, sadly.\r\nThe source is here: https://gitlab.com/Moscovium/moscovium/blob/f295a097860af31be68c8374eed05cf6a58ab93e/impl/main.rs#L61-63\r\n\r\nI expected to see this happen: flawless execution, or at least just a good ol' rustc error with a trillion `futures` generics\r\n\r\nInstead, this happened: rustc panicked about LLVM code gen\r\n\r\n## Meta\r\n\r\n```console\r\n$ rustc --version --verbose\r\nrustc 1.37.0-nightly (0e4a56b4b 2019-06-13)\r\nbinary: rustc\r\ncommit-hash: 0e4a56b4b04ea98bb16caada30cb2418dd06e250\r\ncommit-date: 2019-06-13\r\nhost: x86_64-unknown-linux-gnu\r\nrelease: 1.37.0-nightly\r\nLLVM version: 8.0\r\n\r\n$ RUST_BACKTRACE=full cargo run            \r\n   Compiling moscovium v0.1.0 (/hdd1/Work/minecraft/moscovium)\r\nwarning: Hard linking files in the incremental compilation cache failed. Copying files instead. Consider moving the cache directory to a file system which supports hard linking in session dir `/hdd1/Work/minecraft/moscovium/target/debug/incremental/moscovium-15d9p06c5csz7/s-fdfx9m9gza-s7b2sh-working`\r\n\r\nwarning: unused import: `event::Cancellable as _`\r\n --> impl/main.rs:5:11\r\n  |\r\n5 | use api::{event::Cancellable as _, prelude::*};\r\n  |           ^^^^^^^^^^^^^^^^^^^^^^^\r\n  |\r\n  = note: #[warn(unused_imports)] on by default\r\n\r\nthread 'rustc' panicked at 'assertion failed: target_offset >= offset', src/librustc_codegen_llvm/type_of.rs:130:9\r\nstack backtrace:\r\n   0:     0x7f589a54918b - backtrace::backtrace::libunwind::trace::h41595b2657878dbc\r\n                               at /cargo/registry/src/github.com-1ecc6299db9ec823/backtrace-0.3.29/src/backtrace/libunwind.rs:88\r\n   1:     0x7f589a54918b - backtrace::backtrace::trace_unsynchronized::h4efe511900bf5e12\r\n                               at /cargo/registry/src/github.com-1ecc6299db9ec823/backtrace-0.3.29/src/backtrace/mod.rs:66\r\n   2:     0x7f589a54918b - std::sys_common::backtrace::_print::h7275b63687b21f98\r\n                               at src/libstd/sys_common/backtrace.rs:47\r\n   3:     0x7f589a54918b - std::sys_common::backtrace::print::h790c12384440cac4\r\n                               at src/libstd/sys_common/backtrace.rs:36\r\n   4:     0x7f589a54918b - std::panicking::default_hook::{{closure}}::he6cba1bdf748f1c3\r\n                               at src/libstd/panicking.rs:198\r\n   5:     0x7f589a548e8c - std::panicking::default_hook::h1296d9a476e7a9c2\r\n                               at src/libstd/panicking.rs:212\r\n   6:     0x7f589829b3f1 - rustc::util::common::panic_hook::ha2e96a0b919e5a1a\r\n   7:     0x7f589a5499e9 - std::panicking::rust_panic_with_hook::h8d2408723e9a2bd4\r\n                               at src/libstd/panicking.rs:479\r\n   8:     0x7f58902f44b5 - std::panicking::begin_panic::h74637358fcbcf49a\r\n   9:     0x7f589043919c - rustc_codegen_llvm::type_of::struct_llfields::h61dc16133d19abaa\r\n  10:     0x7f5890418895 - <rustc_target::abi::TyLayout<&rustc::ty::TyS> as rustc_codegen_llvm::type_of::LayoutLlvmExt>::llvm_type::hd0eea50cae39777c\r\n  11:     0x7f5890438dd9 - rustc_codegen_llvm::type_of::struct_llfields::h61dc16133d19abaa\r\n  12:     0x7f5890418895 - <rustc_target::abi::TyLayout<&rustc::ty::TyS> as rustc_codegen_llvm::type_of::LayoutLlvmExt>::llvm_type::hd0eea50cae39777c\r\n  13:     0x7f58902da58f - <rustc_target::abi::call::FnType<&rustc::ty::TyS> as rustc_codegen_llvm::abi::FnTypeLlvmExt>::llvm_type::h0d0aa59294abb94c\r\n  14:     0x7f5890327a26 - rustc_codegen_llvm::declare::<impl rustc_codegen_ssa::traits::declare::DeclareMethods for rustc_codegen_llvm::context::CodegenCx>::declare_fn::hfd002e9de8564d19\r\n  15:     0x7f589032807f - rustc_codegen_llvm::mono_item::<impl rustc_codegen_ssa::traits::declare::PreDefineMethods for rustc_codegen_llvm::context::CodegenCx>::predefine_fn::h158b31f162921281\r\n  16:     0x7f589034e5d6 - <rustc::mir::mono::MonoItem as rustc_codegen_ssa::mono_item::MonoItemExt>::predefine::hf5e95d5c0693b901\r\n  17:     0x7f58902dba8b - rustc_codegen_llvm::base::compile_codegen_unit::module_codegen::h3dfd41b76a21d604\r\n  18:     0x7f589031a28c - rustc::dep_graph::graph::DepGraph::with_task::h9223b093287413d7\r\n  19:     0x7f58902db8b2 - rustc_codegen_llvm::base::compile_codegen_unit::h84cbcc9f84ef685b\r\n  20:     0x7f58904203d3 - rustc_codegen_ssa::base::codegen_crate::h74b58a2ac9b23913\r\n  21:     0x7f589041cc8a - <rustc_codegen_llvm::LlvmCodegenBackend as rustc_codegen_utils::codegen_backend::CodegenBackend>::codegen_crate::h50e9412946ee1e63\r\n  22:     0x7f5899f7bd67 - rustc::util::common::time::haa32cafeeb3d54cb\r\n  23:     0x7f5899f2713b - rustc_interface::passes::start_codegen::hcdb1e9299570ccd1\r\n  24:     0x7f5899f0e317 - rustc::ty::context::tls::enter_global::h5d834d2634f7fc92\r\n  25:     0x7f5899f27941 - rustc_interface::passes::BoxedGlobalCtxt::access::{{closure}}::h10a967fa77f2b087\r\n  26:     0x7f5899f83b05 - rustc_interface::passes::create_global_ctxt::{{closure}}::h7a059b6cf199597d\r\n  27:     0x7f5899f26496 - rustc_interface::passes::BoxedGlobalCtxt::enter::h4a247e90412a9579\r\n  28:     0x7f5899f10740 - rustc_interface::queries::Query<T>::compute::h595d6a8dccab9742\r\n  29:     0x7f5899ffa7e4 - rustc_interface::queries::<impl rustc_interface::interface::Compiler>::ongoing_codegen::h93f94310b1d268e6\r\n  30:     0x7f589a83d840 - rustc_interface::interface::run_compiler_in_existing_thread_pool::h35eddbfcfbbe0eb4\r\n  31:     0x7f589a8af5f6 - std::thread::local::LocalKey<T>::with::hea85159711765771\r\n  32:     0x7f589a847fb5 - scoped_tls::ScopedKey<T>::set::he08d6211f459724f\r\n  33:     0x7f589a87aad4 - syntax::with_globals::h2c63be024f0c1f38\r\n  34:     0x7f589a89989d - std::sys_common::backtrace::__rust_begin_short_backtrace::hfc7fb053a9ed90ec\r\n  35:     0x7f589a55a8da - __rust_maybe_catch_panic\r\n                               at src/libpanic_unwind/lib.rs:82\r\n  36:     0x7f589a8256d9 - core::ops::function::FnOnce::call_once{{vtable.shim}}::h0cd7d8fc1b0a39a3\r\n  37:     0x7f589a52ceef - <alloc::boxed::Box<F> as core::ops::function::FnOnce<A>>::call_once::he71721d2d956d451\r\n                               at /rustc/0e4a56b4b04ea98bb16caada30cb2418dd06e250/src/liballoc/boxed.rs:746\r\n  38:     0x7f589a5595b0 - <alloc::boxed::Box<F> as core::ops::function::FnOnce<A>>::call_once::he520045b8d28ce5c\r\n                               at /rustc/0e4a56b4b04ea98bb16caada30cb2418dd06e250/src/liballoc/boxed.rs:746\r\n  39:     0x7f589a5595b0 - std::sys_common::thread::start_thread::h2e98d1272dc6d74b\r\n                               at src/libstd/sys_common/thread.rs:13\r\n  40:     0x7f589a5595b0 - std::sys::unix::thread::Thread::new::thread_start::h18485805666ccd3c\r\n                               at src/libstd/sys/unix/thread.rs:79\r\n  41:     0x7f589a49d57f - start_thread\r\n  42:     0x7f589a3bcf13 - __clone\r\n  43:                0x0 - <unknown>\r\nquery stack during panic:\r\nend of query stack\r\n\r\nerror: internal compiler error: unexpected panic\r\n\r\nnote: the compiler unexpectedly panicked. this is a bug.\r\n\r\nnote: we would appreciate a bug report: https://github.com/rust-lang/rust/blob/master/CONTRIBUTING.md#bug-reports\r\n\r\nnote: rustc 1.37.0-nightly (0e4a56b4b 2019-06-13) running on x86_64-unknown-linux-gnu\r\n\r\nnote: compiler flags: -C debuginfo=2 -C incremental --crate-type bin\r\n\r\nnote: some of the compiler flags provided by cargo are hidden\r\n\r\nerror: Could not compile `moscovium`.\r\n\r\nTo learn more, run the command again with --verbose.\r\n```", "closed_by": {"login": "Proximyst", "id": 19861299, "node_id": "MDQ6VXNlcjE5ODYxMjk5", "avatar_url": "https://avatars.githubusercontent.com/u/19861299?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Proximyst", "html_url": "https://github.com/Proximyst", "followers_url": "https://api.github.com/users/Proximyst/followers", "following_url": "https://api.github.com/users/Proximyst/following{/other_user}", "gists_url": "https://api.github.com/users/Proximyst/gists{/gist_id}", "starred_url": "https://api.github.com/users/Proximyst/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Proximyst/subscriptions", "organizations_url": "https://api.github.com/users/Proximyst/orgs", "repos_url": "https://api.github.com/users/Proximyst/repos", "events_url": "https://api.github.com/users/Proximyst/events{/privacy}", "received_events_url": "https://api.github.com/users/Proximyst/received_events", "type": "User", "site_admin": false}, "reactions": {"url": "https://api.github.com/repos/rust-lang/rust/issues/62087/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rust-lang/rust/issues/62087/timeline", "performed_via_github_app": null, "state_reason": "completed"}