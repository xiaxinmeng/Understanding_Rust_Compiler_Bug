{"url": "https://api.github.com/repos/rust-lang/rust/issues/93054", "repository_url": "https://api.github.com/repos/rust-lang/rust", "labels_url": "https://api.github.com/repos/rust-lang/rust/issues/93054/labels{/name}", "comments_url": "https://api.github.com/repos/rust-lang/rust/issues/93054/comments", "events_url": "https://api.github.com/repos/rust-lang/rust/issues/93054/events", "html_url": "https://github.com/rust-lang/rust/issues/93054", "id": 1107488531, "node_id": "I_kwDOAAsO6M5CAu8T", "number": 93054, "title": "LLVM coverage regression in nightly-2022-01-15", "user": {"login": "ecton", "id": 50053, "node_id": "MDQ6VXNlcjUwMDUz", "avatar_url": "https://avatars.githubusercontent.com/u/50053?v=4", "gravatar_id": "", "url": "https://api.github.com/users/ecton", "html_url": "https://github.com/ecton", "followers_url": "https://api.github.com/users/ecton/followers", "following_url": "https://api.github.com/users/ecton/following{/other_user}", "gists_url": "https://api.github.com/users/ecton/gists{/gist_id}", "starred_url": "https://api.github.com/users/ecton/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/ecton/subscriptions", "organizations_url": "https://api.github.com/users/ecton/orgs", "repos_url": "https://api.github.com/users/ecton/repos", "events_url": "https://api.github.com/users/ecton/events{/privacy}", "received_events_url": "https://api.github.com/users/ecton/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 211668100, "node_id": "MDU6TGFiZWwyMTE2NjgxMDA=", "url": "https://api.github.com/repos/rust-lang/rust/labels/T-compiler", "name": "T-compiler", "color": "bfd4f2", "default": false, "description": "Relevant to the compiler team, which will review and decide on the PR/issue."}, {"id": 650731663, "node_id": "MDU6TGFiZWw2NTA3MzE2NjM=", "url": "https://api.github.com/repos/rust-lang/rust/labels/C-bug", "name": "C-bug", "color": "f5f1fd", "default": false, "description": "Category: This is a bug."}, {"id": 1472563007, "node_id": "MDU6TGFiZWwxNDcyNTYzMDA3", "url": "https://api.github.com/repos/rust-lang/rust/labels/requires-nightly", "name": "requires-nightly", "color": "76dcde", "default": false, "description": "This issue requires a nightly compiler in some way."}, {"id": 2413861294, "node_id": "MDU6TGFiZWwyNDEzODYxMjk0", "url": "https://api.github.com/repos/rust-lang/rust/labels/regression-untriaged", "name": "regression-untriaged", "color": "e4008a", "default": false, "description": "Untriaged performance or correctness regression."}, {"id": 2483744621, "node_id": "MDU6TGFiZWwyNDgzNzQ0NjIx", "url": "https://api.github.com/repos/rust-lang/rust/labels/A-code-coverage", "name": "A-code-coverage", "color": "f7e101", "default": false, "description": "Area: Source-based code coverage (-Cinstrument-coverage)"}], "state": "closed", "locked": false, "assignee": {"login": "wesleywiser", "id": 831192, "node_id": "MDQ6VXNlcjgzMTE5Mg==", "avatar_url": "https://avatars.githubusercontent.com/u/831192?v=4", "gravatar_id": "", "url": "https://api.github.com/users/wesleywiser", "html_url": "https://github.com/wesleywiser", "followers_url": "https://api.github.com/users/wesleywiser/followers", "following_url": "https://api.github.com/users/wesleywiser/following{/other_user}", "gists_url": "https://api.github.com/users/wesleywiser/gists{/gist_id}", "starred_url": "https://api.github.com/users/wesleywiser/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/wesleywiser/subscriptions", "organizations_url": "https://api.github.com/users/wesleywiser/orgs", "repos_url": "https://api.github.com/users/wesleywiser/repos", "events_url": "https://api.github.com/users/wesleywiser/events{/privacy}", "received_events_url": "https://api.github.com/users/wesleywiser/received_events", "type": "User", "site_admin": false}, "assignees": [{"login": "wesleywiser", "id": 831192, "node_id": "MDQ6VXNlcjgzMTE5Mg==", "avatar_url": "https://avatars.githubusercontent.com/u/831192?v=4", "gravatar_id": "", "url": "https://api.github.com/users/wesleywiser", "html_url": "https://github.com/wesleywiser", "followers_url": "https://api.github.com/users/wesleywiser/followers", "following_url": "https://api.github.com/users/wesleywiser/following{/other_user}", "gists_url": "https://api.github.com/users/wesleywiser/gists{/gist_id}", "starred_url": "https://api.github.com/users/wesleywiser/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/wesleywiser/subscriptions", "organizations_url": "https://api.github.com/users/wesleywiser/orgs", "repos_url": "https://api.github.com/users/wesleywiser/repos", "events_url": "https://api.github.com/users/wesleywiser/events{/privacy}", "received_events_url": "https://api.github.com/users/wesleywiser/received_events", "type": "User", "site_admin": false}], "milestone": null, "comments": 5, "created_at": "2022-01-19T00:09:27Z", "updated_at": "2022-01-25T19:23:00Z", "closed_at": "2022-01-25T08:18:24Z", "author_association": "NONE", "active_lock_reason": null, "body": "Between nightly versions 2022-01-14 and 2022-01-15, [grcov](https://github.com/mozilla/grcov) 0.8.2 lost track of 82% of the coverage of [BonsaiDb](https://github.com/khonsulabs/bonsaidb) when using the LLVM coverage option (`-Zinstrument-coverage`).\r\n\r\nOther projects of mine continue to have code coverage correctly measured. I'm not where to start narrowing this down, as I'm not getting any errors or warnings printed.\r\n\r\nHere are the steps to get good code coverage reports out of 2022-01-14:\r\n\r\n```bash\r\ngit clone https://github.com/khonsulabs/bonsaidb.git\r\ncd bonsaidb\r\n\r\nrustup toolchain install nightly-2022-01-14 --component llvm-tools-preview\r\nLLVM_PROFILE_FILE=%m.profraw RUSTFLAGS=\"-Zinstrument-coverage\" cargo +nightly-2022-01-14 test --workspace --all-features --all-targets\r\nRUST_TOOLCHAIN=nightly-2022-01-14 grcov . --binary-path ./target/debug/ -s . -t html --branch --ignore-not-existing --llvm -o coverage/ --ignore \"target/*\" --ignore \"xtask/*\"\r\n```\r\n\r\nIf you look at the report in the coverage folder, the html report will show >80% coverage. Now, test with the next nightly:\r\n\r\n```bash\r\n# Clean up files\r\nfind . -name \"*.profraw\" -exec rm \\{\\} \\;\r\nrm -rf **/*.bonsaidb\r\n\r\nrustup toolchain install nightly-2022-01-15 --component llvm-tools-preview\r\ncargo clean\r\nLLVM_PROFILE_FILE=%m.profraw RUSTFLAGS=\"-Zinstrument-coverage\" cargo +nightly-2022-01-15 test --workspace --all-features --all-targets\r\nRUST_TOOLCHAIN=nightly-2022-01-15 grcov . --binary-path ./target/debug/ -s . -t html --branch --ignore-not-existing --llvm -o coverage/ --ignore \"target/*\" --ignore \"xtask/*\"\r\n```\r\n\r\nIf you look at the report again, the html report now shows < 1% coverage. \r\n\r\nThe quantity of profraw files are the same, and the sizes of the files are more or less equivalent. I'm not quite sure where to start narrowing this down since it's a unique issue to this project of mine -- but the only unique part I'm aware of is its size :sweat_smile:.\r\n\r\nFor now I'll pin our CI to the last working nightly. Thank you in advance for any suggestions or help!", "closed_by": {"login": "bors", "id": 3372342, "node_id": "MDQ6VXNlcjMzNzIzNDI=", "avatar_url": "https://avatars.githubusercontent.com/u/3372342?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors", "html_url": "https://github.com/bors", "followers_url": "https://api.github.com/users/bors/followers", "following_url": "https://api.github.com/users/bors/following{/other_user}", "gists_url": "https://api.github.com/users/bors/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors/subscriptions", "organizations_url": "https://api.github.com/users/bors/orgs", "repos_url": "https://api.github.com/users/bors/repos", "events_url": "https://api.github.com/users/bors/events{/privacy}", "received_events_url": "https://api.github.com/users/bors/received_events", "type": "User", "site_admin": false}, "reactions": {"url": "https://api.github.com/repos/rust-lang/rust/issues/93054/reactions", "total_count": 4, "+1": 2, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 2}, "timeline_url": "https://api.github.com/repos/rust-lang/rust/issues/93054/timeline", "performed_via_github_app": null, "state_reason": "completed"}