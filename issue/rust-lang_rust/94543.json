{"url": "https://api.github.com/repos/rust-lang/rust/issues/94543", "repository_url": "https://api.github.com/repos/rust-lang/rust", "labels_url": "https://api.github.com/repos/rust-lang/rust/issues/94543/labels{/name}", "comments_url": "https://api.github.com/repos/rust-lang/rust/issues/94543/comments", "events_url": "https://api.github.com/repos/rust-lang/rust/issues/94543/events", "html_url": "https://github.com/rust-lang/rust/issues/94543", "id": 1157882895, "node_id": "I_kwDOAAsO6M5FA-QP", "number": 94543, "title": "Unary operators do not add bounds to closure, instead just errors", "user": {"login": "OleStrohm", "id": 6892524, "node_id": "MDQ6VXNlcjY4OTI1MjQ=", "avatar_url": "https://avatars.githubusercontent.com/u/6892524?v=4", "gravatar_id": "", "url": "https://api.github.com/users/OleStrohm", "html_url": "https://github.com/OleStrohm", "followers_url": "https://api.github.com/users/OleStrohm/followers", "following_url": "https://api.github.com/users/OleStrohm/following{/other_user}", "gists_url": "https://api.github.com/users/OleStrohm/gists{/gist_id}", "starred_url": "https://api.github.com/users/OleStrohm/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/OleStrohm/subscriptions", "organizations_url": "https://api.github.com/users/OleStrohm/orgs", "repos_url": "https://api.github.com/users/OleStrohm/repos", "events_url": "https://api.github.com/users/OleStrohm/events{/privacy}", "received_events_url": "https://api.github.com/users/OleStrohm/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 650731663, "node_id": "MDU6TGFiZWw2NTA3MzE2NjM=", "url": "https://api.github.com/repos/rust-lang/rust/labels/C-bug", "name": "C-bug", "color": "f5f1fd", "default": false, "description": "Category: This is a bug."}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 2, "created_at": "2022-03-03T02:02:49Z", "updated_at": "2022-04-05T17:58:09Z", "closed_at": "2022-04-05T17:58:09Z", "author_association": "CONTRIBUTOR", "active_lock_reason": null, "body": "I tried this code:\r\r\n```rust\r\n(|a| -a)(42)\r\n```\r\nHowevery this unexpectedly fails, requiring the type to be specified in the closure definition. `(|a| a + a)(42)` on the other hand works just fine.\r\n\r\nDigging a little deeper I discovered this related problem. It seems that the unary operator doesn't add an implicit trait bound to the closure, and instead just gives an error immediately.\nThis seems to be the behaviour for all unary operators, not just the unary minus.\r\n\r\n```rust\r\nfn closure_unary<T>() -> impl Fn(T) -> T {\r\n    |a| -a\r\n}\r\n\r\nfn closure_binary<T>() -> impl Fn(T) -> T {\r\n    |a| a+a\r\n}\r\n```\r\n\r\nI expected to see this happen:\r\nI expected both of these to have errors like closure_binary:\r\n```\r\nerror[E0369]: cannot add `T` to `T`\r\n --> src/main.rs:6:10\r\n  |\r\n6 |     |a| a+a\r\n  |         -^- T\r\n  |         |\r\n  |         T\r\n  |\r\nhelp: consider restricting type parameter `T`\r\n  |\r\n5 | fn closure_binary<T: std::ops::Add<Output = T>>() -> impl Fn(T) -> T {\r\n  |                    +++++++++++++++++++++++++++\r\n```\r\n\r\nInstead, this happened:\r\nOnly closure_binary has such an error. Instead closure_unary has:\r\n```\r\nerror[E0600]: cannot apply unary operator `-` to type `T`\r\n --> src/main.rs:2:9\r\n  |\r\n2 |     |a| -a\r\n  |         ^^ cannot apply unary operator `-`\r\n```\r\n\r\n### Meta\r\n`rustc --version --verbose`:\r\n```\r\nrustc 1.59.0 (9d1b2106e 2022-02-23)\r\nbinary: rustc\r\ncommit-hash: 9d1b2106e23b1abd32fce1f17267604a5102f57a\r\ncommit-date: 2022-02-23\r\nhost: x86_64-unknown-linux-gnu\r\nrelease: 1.59.0\r\nLLVM version: 13.0.0\r\n```", "closed_by": {"login": "OleStrohm", "id": 6892524, "node_id": "MDQ6VXNlcjY4OTI1MjQ=", "avatar_url": "https://avatars.githubusercontent.com/u/6892524?v=4", "gravatar_id": "", "url": "https://api.github.com/users/OleStrohm", "html_url": "https://github.com/OleStrohm", "followers_url": "https://api.github.com/users/OleStrohm/followers", "following_url": "https://api.github.com/users/OleStrohm/following{/other_user}", "gists_url": "https://api.github.com/users/OleStrohm/gists{/gist_id}", "starred_url": "https://api.github.com/users/OleStrohm/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/OleStrohm/subscriptions", "organizations_url": "https://api.github.com/users/OleStrohm/orgs", "repos_url": "https://api.github.com/users/OleStrohm/repos", "events_url": "https://api.github.com/users/OleStrohm/events{/privacy}", "received_events_url": "https://api.github.com/users/OleStrohm/received_events", "type": "User", "site_admin": false}, "reactions": {"url": "https://api.github.com/repos/rust-lang/rust/issues/94543/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rust-lang/rust/issues/94543/timeline", "performed_via_github_app": null, "state_reason": "completed"}