{"url": "https://api.github.com/repos/rust-lang/rust/issues/37555", "repository_url": "https://api.github.com/repos/rust-lang/rust", "labels_url": "https://api.github.com/repos/rust-lang/rust/issues/37555/labels{/name}", "comments_url": "https://api.github.com/repos/rust-lang/rust/issues/37555/comments", "events_url": "https://api.github.com/repos/rust-lang/rust/issues/37555/events", "html_url": "https://github.com/rust-lang/rust/issues/37555", "id": 186996474, "node_id": "MDU6SXNzdWUxODY5OTY0NzQ=", "number": 37555, "title": "binaryen fails to validate wasm in asm2wasm", "user": {"login": "m4b", "id": 1920204, "node_id": "MDQ6VXNlcjE5MjAyMDQ=", "avatar_url": "https://avatars.githubusercontent.com/u/1920204?v=4", "gravatar_id": "", "url": "https://api.github.com/users/m4b", "html_url": "https://github.com/m4b", "followers_url": "https://api.github.com/users/m4b/followers", "following_url": "https://api.github.com/users/m4b/following{/other_user}", "gists_url": "https://api.github.com/users/m4b/gists{/gist_id}", "starred_url": "https://api.github.com/users/m4b/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/m4b/subscriptions", "organizations_url": "https://api.github.com/users/m4b/orgs", "repos_url": "https://api.github.com/users/m4b/repos", "events_url": "https://api.github.com/users/m4b/events{/privacy}", "received_events_url": "https://api.github.com/users/m4b/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 474645165, "node_id": "MDU6TGFiZWw0NzQ2NDUxNjU=", "url": "https://api.github.com/repos/rust-lang/rust/labels/O-wasm", "name": "O-wasm", "color": "6e6ec0", "default": false, "description": "Target: WASM (WebAssembly), http://webassembly.org/"}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 7, "created_at": "2016-11-03T07:59:43Z", "updated_at": "2017-01-27T22:48:41Z", "closed_at": "2017-01-27T22:48:41Z", "author_association": "CONTRIBUTOR", "active_lock_reason": null, "body": "I receive compile errors w.r.t. invalid wasm being generated unless I turn off the `archive` and `mach64` features in [goblin](http://github.com/m4b/goblin).\r\n\r\nDump:\r\n```\r\nasm2wasm: /home/m4b/.emscripten_ports/binaryen/binaryen-version_18/src/asm2wasm.h:1111: void wasm::Asm2WasmBuilder::processAsm(cashew::Ref): Assertion `WasmValidator().validate(wasm)' failed.\r\nTraceback (most recent call last):\r\n  File \"/home/m4b/lib/emsdk_portable/emscripten/incoming/emcc\", line 13, in <module>\r\n    emcc.run()\r\n  File \"/home/m4b/lib/emsdk_portable/emscripten/incoming/emcc.py\", line 2028, in run\r\n    subprocess.check_call(cmd, stdout=open(wasm_text_target, 'w'))\r\n  File \"/usr/lib64/python2.7/subprocess.py\", line 541, in check_call\r\n    raise CalledProcessError(retcode, cmd)\r\nsubprocess.CalledProcessError: Command '[u'/home/m4b/.emscripten_ports/binaryen/binaryen-version_18/bin/asm2wasm', '/home/m4b/projects/goblin/target/wasm32-unknown-emscripten/debug/examples/rdr.asm.js', '--total-memory=16777216', '--mem-init=/home/m4b/projects/goblin/target/wasm32-unknown-emscripten/debug/examples/rdr.js.mem', '--wasm-only']' returned non-zero exit status -6\r\n\r\n\r\nerror: aborting due to previous error\r\n\r\nerror: Could not compile `goblin`.\r\n\r\nCaused by:\r\n  process didn't exit successfully: `rustc examples/rdr.rs --crate-name rdr --crate-type bin -g --cfg feature=\"archive\" --cfg feature=\"byteorder\" --cfg feature=\"pe64\" --cfg feature=\"goblin\" --cfg feature=\"std\" --cfg feature=\"elf32\" --cfg feature=\"endian_fd\" --cfg feature=\"default\" --cfg feature=\"mach64\" --cfg feature=\"pe32\" --cfg feature=\"mach32\" --cfg feature=\"elf64\" -C metadata=17b052e017a24401 --out-dir /home/m4b/projects/goblin/target/wasm32-unknown-emscripten/debug/examples --emit=dep-info,link --target wasm32-unknown-emscripten -L dependency=/home/m4b/projects/goblin/target/wasm32-unknown-emscripten/debug/deps --extern byteorder=/home/m4b/projects/goblin/target/wasm32-unknown-emscripten/debug/deps/libbyteorder-e4fc6ea0c49cabcf.rlib --extern goblin=/home/m4b/projects/goblin/target/wasm32-unknown-emscripten/debug/deps/libgoblin.rlib` (exit code: 101)\r\n```\r\n\r\nis what I receive after it outputs an inappropriately large s-expression to stdout.\r\n\r\nAlso, it looks like file access is broken (maybe this never worked, in which case shouldn't it throw unsupported function?):\r\n\r\n```\r\nnode rdr.js /bin/ls\r\ntrying binaryen method: native-wasm\r\nno native wasm support detected\r\ntrying binaryen method: interpret-binary\r\nbinaryen method succeeded.\r\nNot an ELF: Error { repr: Os { code: 2, message: \"No such file or directory\" } }\r\n```\r\n\r\nIf I print the path, it is correct; it just can't find any files seemingly.  Testing with simple crate with file access has similar results.", "closed_by": {"login": "brson", "id": 147214, "node_id": "MDQ6VXNlcjE0NzIxNA==", "avatar_url": "https://avatars.githubusercontent.com/u/147214?v=4", "gravatar_id": "", "url": "https://api.github.com/users/brson", "html_url": "https://github.com/brson", "followers_url": "https://api.github.com/users/brson/followers", "following_url": "https://api.github.com/users/brson/following{/other_user}", "gists_url": "https://api.github.com/users/brson/gists{/gist_id}", "starred_url": "https://api.github.com/users/brson/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/brson/subscriptions", "organizations_url": "https://api.github.com/users/brson/orgs", "repos_url": "https://api.github.com/users/brson/repos", "events_url": "https://api.github.com/users/brson/events{/privacy}", "received_events_url": "https://api.github.com/users/brson/received_events", "type": "User", "site_admin": false}, "reactions": {"url": "https://api.github.com/repos/rust-lang/rust/issues/37555/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rust-lang/rust/issues/37555/timeline", "performed_via_github_app": null, "state_reason": "completed"}