{"url": "https://api.github.com/repos/rust-lang/rust/issues/50008", "repository_url": "https://api.github.com/repos/rust-lang/rust", "labels_url": "https://api.github.com/repos/rust-lang/rust/issues/50008/labels{/name}", "comments_url": "https://api.github.com/repos/rust-lang/rust/issues/50008/comments", "events_url": "https://api.github.com/repos/rust-lang/rust/issues/50008/events", "html_url": "https://github.com/rust-lang/rust/issues/50008", "id": 314798007, "node_id": "MDU6SXNzdWUzMTQ3OTgwMDc=", "number": 50008, "title": "How to move out selected pattern constituents while keeping the others as implicit refs with match_default_bindings?", "user": {"login": "Boscop", "id": 535593, "node_id": "MDQ6VXNlcjUzNTU5Mw==", "avatar_url": "https://avatars.githubusercontent.com/u/535593?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Boscop", "html_url": "https://github.com/Boscop", "followers_url": "https://api.github.com/users/Boscop/followers", "following_url": "https://api.github.com/users/Boscop/following{/other_user}", "gists_url": "https://api.github.com/users/Boscop/gists{/gist_id}", "starred_url": "https://api.github.com/users/Boscop/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Boscop/subscriptions", "organizations_url": "https://api.github.com/users/Boscop/orgs", "repos_url": "https://api.github.com/users/Boscop/repos", "events_url": "https://api.github.com/users/Boscop/events{/privacy}", "received_events_url": "https://api.github.com/users/Boscop/received_events", "type": "User", "site_admin": false}, "labels": [], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 2, "created_at": "2018-04-16T20:04:29Z", "updated_at": "2020-04-13T07:40:03Z", "closed_at": "2018-05-03T17:12:27Z", "author_association": "NONE", "active_lock_reason": null, "body": "Consider this story / situation:\r\n\r\nIt starts with:\r\n```rust\r\n#![feature(match_default_bindings)]\r\n\r\nv: Vec<(usize, Foo)>\r\nfn f(i: usize) {}\r\n```\r\n---\r\nNow I want to do this:\r\n```rust\r\nfor (i, foo) in &v { f(i); }\r\n```\r\nThis results in the following errors (of course, because `i` is `&usize`):\r\n```\r\nerror: mismatched types\r\nerror: expected usize, found &usize\r\nnote: expected type `usize`, found type `&usize`\r\n```\r\n---\r\nNow, I want to move `i` out, but keep using the convenience of `match_default_bindings` for **all other pattern constituents**.\r\nSo I change it to this:\r\n```rust\r\nfor (&i, foo) in &v { f(i); }\r\n```\r\nBut now I get these errors:\r\n```\r\nerror: mismatched types\r\nerror: expected usize, found reference\r\nnote: expected type `usize`, found type `&_`\r\nhelp: did you mean `i: &usize`?\r\n```\r\nWith `match_default_bindings` enabled, matching with `(i, foo)` (instead of `&(i, foo)`) turns it into `(ref i, ref foo)`.\r\n**Why doesn't it let me cancel out the implicit `ref i` by writing explicit `&i`, like a reasonable human would expect?**\r\nEspecially people who are new to Rust and would expect this to work, and isn't the whole point of the `match_default_bindings` ergonomics change to make Rust easier to use for newbies?\r\nSo with `match_default_bindings` enabled, it should be allowed to explicitly move out selected constituents (while still retaining the implicit `ref`s for the other pattern constituents), by cancelling out the `ref` with a `&`!\r\n\r\nOr is there already an existing way to explicitly move out selected constituents while keeping the implicit `ref`s for the others? \r\nIf so, that way is not intuitive, but please tell me :)\r\n(And I know, in *this* case, the only other constituent is `foo` so it wouldn't be very inconvenient to write `&(i, ref foo)` but it's just in this small example; I'm asking for situations where I want **ALL** other constituents to stay implicit `ref`s, when there are many, such as in my real-world code that brought this up, where I often have many pattern constituents that I want to take by implicit ref and just move out a few.)\r\n\r\nIMO, There should **definitely** be a way to only move out selected constituents while keeping the others as implicity `ref`s.\r\n\r\n(Btw, the \"help\" message is not correct and thus not helpful in the last situation!)\r\n", "closed_by": {"login": "nikomatsakis", "id": 155238, "node_id": "MDQ6VXNlcjE1NTIzOA==", "avatar_url": "https://avatars.githubusercontent.com/u/155238?v=4", "gravatar_id": "", "url": "https://api.github.com/users/nikomatsakis", "html_url": "https://github.com/nikomatsakis", "followers_url": "https://api.github.com/users/nikomatsakis/followers", "following_url": "https://api.github.com/users/nikomatsakis/following{/other_user}", "gists_url": "https://api.github.com/users/nikomatsakis/gists{/gist_id}", "starred_url": "https://api.github.com/users/nikomatsakis/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/nikomatsakis/subscriptions", "organizations_url": "https://api.github.com/users/nikomatsakis/orgs", "repos_url": "https://api.github.com/users/nikomatsakis/repos", "events_url": "https://api.github.com/users/nikomatsakis/events{/privacy}", "received_events_url": "https://api.github.com/users/nikomatsakis/received_events", "type": "User", "site_admin": false}, "reactions": {"url": "https://api.github.com/repos/rust-lang/rust/issues/50008/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rust-lang/rust/issues/50008/timeline", "performed_via_github_app": null, "state_reason": "completed"}