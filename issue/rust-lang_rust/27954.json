{"url": "https://api.github.com/repos/rust-lang/rust/issues/27954", "repository_url": "https://api.github.com/repos/rust-lang/rust", "labels_url": "https://api.github.com/repos/rust-lang/rust/issues/27954/labels{/name}", "comments_url": "https://api.github.com/repos/rust-lang/rust/issues/27954/comments", "events_url": "https://api.github.com/repos/rust-lang/rust/issues/27954/events", "html_url": "https://github.com/rust-lang/rust/issues/27954", "id": 102588880, "node_id": "MDU6SXNzdWUxMDI1ODg4ODA=", "number": 27954, "title": "ICE: creating trait object with function that has stricter bounds on associated type.", "user": {"login": "rphmeier", "id": 10121380, "node_id": "MDQ6VXNlcjEwMTIxMzgw", "avatar_url": "https://avatars.githubusercontent.com/u/10121380?v=4", "gravatar_id": "", "url": "https://api.github.com/users/rphmeier", "html_url": "https://github.com/rphmeier", "followers_url": "https://api.github.com/users/rphmeier/followers", "following_url": "https://api.github.com/users/rphmeier/following{/other_user}", "gists_url": "https://api.github.com/users/rphmeier/gists{/gist_id}", "starred_url": "https://api.github.com/users/rphmeier/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/rphmeier/subscriptions", "organizations_url": "https://api.github.com/users/rphmeier/orgs", "repos_url": "https://api.github.com/users/rphmeier/repos", "events_url": "https://api.github.com/users/rphmeier/events{/privacy}", "received_events_url": "https://api.github.com/users/rphmeier/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 9618520, "node_id": "MDU6TGFiZWw5NjE4NTIw", "url": "https://api.github.com/repos/rust-lang/rust/labels/I-ICE", "name": "I-ICE", "color": "e10c02", "default": false, "description": "Issue: The compiler panicked, giving an Internal Compilation Error (ICE) \u2744\ufe0f"}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 6, "created_at": "2015-08-23T05:13:42Z", "updated_at": "2016-09-29T21:10:16Z", "closed_at": "2016-09-29T19:04:02Z", "author_association": "CONTRIBUTOR", "active_lock_reason": null, "body": "``` rust\nuse std::marker::PhantomData;\n\npub trait Filterable {\n    type Filter;\n}\n\npub trait ComponentMapper {\n    type Component;\n    fn entities_filtered(&self, <Self::Component as Filterable>::Filter)\n        where Self::Component: Filterable;\n}\n\npub struct VecMapper<T> {\n    _marker: ::std::marker::PhantomData<T>\n}\n\nimpl<T> VecMapper<T> {\n    pub fn new() -> VecMapper<T> {\n        VecMapper { _marker: PhantomData }\n    }\n}\n\nimpl<T> ComponentMapper for VecMapper<T> {\n    type Component = T;\n    fn entities_filtered(&self, _filter: T::Filter) where T: Filterable {}\n}\n\nfn main() { \n    let _m: &ComponentMapper<Component=()> = &VecMapper::<()>::new();\n}\n```\n\nError message and backtrace:\n\n```\nsrc/lib.rs:1:1: 1:1 error: internal compiler error: Encountered errors `[FulfillmentError(Obligation(predicate=Binder(TraitPredicate(<() as Filterable>)),depth=0),Unimplemented)]` fulfilling during trans\nsrc/lib.rs:1 use std::marker::PhantomData;\n             ^\nnote: the compiler unexpectedly panicked. this is a bug.\nnote: we would appreciate a bug report: https://github.com/rust-lang/rust/blob/master/CONTRIBUTING.md#bug-reports\nthread 'rustc' panicked at 'Box<Any>', ../src/libsyntax/diagnostic.rs:176\n\nstack backtrace:\n   1:     0x7fc6bff26e59 - sys::backtrace::write::h6cef21c2739be89enbs\n   2:     0x7fc6bff2eca6 - panicking::on_panic::hc7719c42798f79557bx\n   3:     0x7fc6bfef4d8e - rt::unwind::begin_unwind_inner::h1f260ccb571cc205LEw\n   4:     0x7fc6bcede5a7 - rt::unwind::begin_unwind::h10655059149932040525\n   5:     0x7fc6bcede566 - diagnostic::SpanHandler::span_bug::h418d05ddae4888f6u0A\n   6:     0x7fc6bddc0093 - session::Session::span_bug::he61831a7b1a0d90dX4v\n   7:     0x7fc6bf6454c8 - trans::monomorphize::normalize_associated_type::h2725703829457067863\n   8:     0x7fc6bf696cd4 - trans::monomorphize::monomorphic_fn::hf2ca16370d279d38YOM\n   9:     0x7fc6bf686fde - trans::callee::trans_fn_ref_with_substs::h855cd08e84e1dcecrRo\n  10:     0x7fc6bf76eebe - trans::meth::emit_vtable_methods::closure.57489\n  11:     0x7fc6bf76e717 - vec::Vec<T>.FromIterator<T>::from_iter::h56270794109279346\n  12:     0x7fc6bf76ca3e - trans::meth::get_vtable::closure.57435\n  13:     0x7fc6bf76e142 - iter::FlatMap<I, U, F>.Iterator::next::h12876249173377246673\n  14:     0x7fc6bf76e340 - vec::Vec<T>::extend_desugared::h1051564765688794204\n  15:     0x7fc6bf76d493 - iter::Iterator::collect::h11535940037352979281\n  16:     0x7fc6bf6c287e - trans::expr::unsized_info::h0bc39e6848f6110aiYB\n  17:     0x7fc6bf711951 - trans::expr::coerce_unsized::h8e89613ca17d7dbfV8B\n  18:     0x7fc6bf630370 - trans::expr::trans::h03a0bd43be9e4742XQB\n  19:     0x7fc6bf6d9d28 - trans::expr::trans_into::h662ed888b6e8c1b0HKB\n  20:     0x7fc6bf753396 - trans::_match::mk_binding_alloca::h10679163847645854849\n  21:     0x7fc6bf63cd97 - trans::base::init_local::h02dc2b39e6ae81bbV4h\n  22:     0x7fc6bf6596e6 - trans::controlflow::trans_block::h585e8da605e23045Mnw\n  23:     0x7fc6bf658866 - trans::base::trans_closure::he2605a1779eef7004Si\n  24:     0x7fc6bf659fd4 - trans::base::trans_fn::h74b850e8a7063830R2i\n  25:     0x7fc6bf65d268 - trans::base::trans_item::h0626e4f7c3d136c3Tsj\n  26:     0x7fc6bf66a0ad - trans::base::trans_crate::h484196896109b43fMek\n  27:     0x7fc6c047c7fd - driver::phase_4_translate_to_llvm::he6fb5be0cc962bd8CNa\n  28:     0x7fc6c0476d1f - driver::phase_3_run_analysis_passes::closure.20607\n  29:     0x7fc6c0450e25 - middle::ty::ctxt<'tcx>::create_and_enter::h8359765683570227848\n  30:     0x7fc6c044bf8d - driver::phase_3_run_analysis_passes::h11291711653950599435\n  31:     0x7fc6c042f6a6 - driver::compile_input::heca4840d0344a3e0Tba\n  32:     0x7fc6c059a43b - run_compiler::h649c0dbc32ddf7b3Obc\n  33:     0x7fc6c0597d07 - boxed::F.FnBox<A>::call_box::h2938814597307836325\n  34:     0x7fc6c0597774 - rt::unwind::try::try_fn::h12878677813726277739\n  35:     0x7fc6bff2e848 - __rust_try\n  36:     0x7fc6bff1b1a2 - rt::unwind::try::inner_try::h3201fe634cf03d94EAw\n  37:     0x7fc6c0597908 - boxed::F.FnBox<A>::call_box::h3379161078959787353\n  38:     0x7fc6bff2dc93 - sys::thread::Thread::new::thread_start::h124abd3234105a89rKv\n  39:     0x7fc6b9b1c181 - start_thread\n  40:     0x7fc6bfba947c - __clone\n  41:                0x0 - <unknown>\n```\n\nThe expected behavior is for the entities_filtered function to not exist or not be callable when ComponentMapper::Component does not implement filterable. ICE on Stable, Beta, and Nightly.\n", "closed_by": {"login": "steveklabnik", "id": 27786, "node_id": "MDQ6VXNlcjI3Nzg2", "avatar_url": "https://avatars.githubusercontent.com/u/27786?v=4", "gravatar_id": "", "url": "https://api.github.com/users/steveklabnik", "html_url": "https://github.com/steveklabnik", "followers_url": "https://api.github.com/users/steveklabnik/followers", "following_url": "https://api.github.com/users/steveklabnik/following{/other_user}", "gists_url": "https://api.github.com/users/steveklabnik/gists{/gist_id}", "starred_url": "https://api.github.com/users/steveklabnik/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/steveklabnik/subscriptions", "organizations_url": "https://api.github.com/users/steveklabnik/orgs", "repos_url": "https://api.github.com/users/steveklabnik/repos", "events_url": "https://api.github.com/users/steveklabnik/events{/privacy}", "received_events_url": "https://api.github.com/users/steveklabnik/received_events", "type": "User", "site_admin": false}, "reactions": {"url": "https://api.github.com/repos/rust-lang/rust/issues/27954/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rust-lang/rust/issues/27954/timeline", "performed_via_github_app": null, "state_reason": "completed"}