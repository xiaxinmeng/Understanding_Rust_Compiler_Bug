{"url": "https://api.github.com/repos/rust-lang/rust/issues/73493", "repository_url": "https://api.github.com/repos/rust-lang/rust", "labels_url": "https://api.github.com/repos/rust-lang/rust/issues/73493/labels{/name}", "comments_url": "https://api.github.com/repos/rust-lang/rust/issues/73493/comments", "events_url": "https://api.github.com/repos/rust-lang/rust/issues/73493/events", "html_url": "https://github.com/rust-lang/rust/issues/73493", "id": 641669861, "node_id": "MDU6SXNzdWU2NDE2Njk4NjE=", "number": 73493, "title": "linking with `cc` failed on AArch64 with `aarch64-unknown-linux-musl` target", "user": {"login": "MrXinWang", "id": 38582160, "node_id": "MDQ6VXNlcjM4NTgyMTYw", "avatar_url": "https://avatars.githubusercontent.com/u/38582160?v=4", "gravatar_id": "", "url": "https://api.github.com/users/MrXinWang", "html_url": "https://github.com/MrXinWang", "followers_url": "https://api.github.com/users/MrXinWang/followers", "following_url": "https://api.github.com/users/MrXinWang/following{/other_user}", "gists_url": "https://api.github.com/users/MrXinWang/gists{/gist_id}", "starred_url": "https://api.github.com/users/MrXinWang/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/MrXinWang/subscriptions", "organizations_url": "https://api.github.com/users/MrXinWang/orgs", "repos_url": "https://api.github.com/users/MrXinWang/repos", "events_url": "https://api.github.com/users/MrXinWang/events{/privacy}", "received_events_url": "https://api.github.com/users/MrXinWang/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 37547, "node_id": "MDU6TGFiZWwzNzU0Nw==", "url": "https://api.github.com/repos/rust-lang/rust/labels/A-linkage", "name": "A-linkage", "color": "f7e101", "default": false, "description": "Area: linking into static, shared libraries and binaries"}, {"id": 55301954, "node_id": "MDU6TGFiZWw1NTMwMTk1NA==", "url": "https://api.github.com/repos/rust-lang/rust/labels/O-Arm", "name": "O-Arm", "color": "6e6ec0", "default": false, "description": "Target: 32-bit Arm processors (armv6, armv7, thumb...), including 64-bit Arm in AArch32 state"}, {"id": 630662867, "node_id": "MDU6TGFiZWw2MzA2NjI4Njc=", "url": "https://api.github.com/repos/rust-lang/rust/labels/O-musl", "name": "O-musl", "color": "6e6ec0", "default": false, "description": "Target: The musl libc"}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 4, "created_at": "2020-06-19T03:02:16Z", "updated_at": "2020-07-01T04:09:17Z", "closed_at": "2020-07-01T04:08:59Z", "author_association": "NONE", "active_lock_reason": null, "body": "I was trying to build a rust-based binary with cargo in docker container on AArch64, however an `undefined reference to symbol` error occurs when using musl target. Any help would be greatly appreciated, thanks!\r\n\r\nNote that the binary can be successfully built with GNU toolchain on AArch64, and also the AArch64 binary can be successfully [cross-built](https://github.com/cloud-hypervisor/cloud-hypervisor/blob/master/.github/workflows/cross-build.yaml) with both GNU and musl toolchain on x86_64.\r\n\r\n**Building Environment:**\r\nA docker container from this [Dockerfile](https://github.com/cloud-hypervisor/cloud-hypervisor/blob/master/resources/Dockerfile).\r\n\r\n```\r\n# git clone https://github.com/cloud-hypervisor/cloud-hypervisor.git\r\n\r\n# cd cloud-hypervisor\r\n\r\n# git checkout 096ffe08f244fa0d35bc44a3987a671ffe5b83a4\r\n\r\n# ./scripts/dev_cli.sh build --release --libc musl\r\n```\r\n\r\n**Rust toolchain version:**\r\n1.43.0\r\n\r\n**Building command:**\r\n`RUSTFLAGS=\"-C link_arg=-lgcc\" cargo build --release --target aarch64-unknown-linux-musl --no-default-features --features mmio`\r\n\r\nThe reason why adding `link_arg=-lgcc` is to resolve https://github.com/rust-lang/rust/issues/46651#issuecomment-402850885\r\n\r\n**Error log:**\r\n```\r\nerror: linking with `cc` failed: exit code: 1\r\n  |\r\n  = note: \"cc\" \"-Wl,--as-needed\" \"-Wl,-z,noexecstack\" \"-Wl,--eh-frame-hdr\" \"-nostdlib\" \"/root/.rustup/toolchains/1.42.0-aarch64-unknown-linux-gnu/lib/rustlib/aarch64-unknown-linux-musl/lib/crt1.o\" \"/root/.rustup/toolchains/1.42.0-aarch64-unknown-linux-gnu/lib/rustlib/aarch64-unknown-linux-musl/lib/crti.o\" \"-L\" \"/root/.rustup/toolchains/1.42.0-aarch64-unknown-linux-gnu/lib/rustlib/aarch64-unknown-linux-musl/lib\" \"/root/cloud-hypervisor-dev/cloud-hypervisor-ci/target/aarch64-unknown-linux-musl/release/deps/cloud_hypervisor-7337885b601979f6.cloud_hypervisor.4uvd3xas-cgu.0.rcgu.o\" \"-o\" \"/root/cloud-hypervisor-dev/cloud-hypervisor-ci/target/aarch64-unknown-linux-musl/release/deps/cloud_hypervisor-7337885b601979f6\" \"-Wl,--gc-sections\" \"-no-pie\" \"-Wl,-zrelro\" \"-Wl,-znow\" \"-Wl,-O1\" \"-nodefaultlibs\" \"-L\" \"/root/cloud-hypervisor-dev/cloud-hypervisor-ci/target/aarch64-unknown-linux-musl/release/deps\" \"-L\" \"/root/cloud-hypervisor-dev/cloud-hypervisor-ci/target/release/deps\" \"-L\" \"/root/.rustup/toolchains/1.42.0-aarch64-unknown-linux-gnu/lib/rustlib/aarch64-unknown-linux-musl/lib\" \"-Wl,-Bstatic\" \"/tmp/rustcQSeDtF/libbacktrace_sys-f3af7a69ff7b3bd7.rlib\" \"/tmp/rustcQSeDtF/libunwind-3ab3605e5327960d.rlib\" \"/tmp/rustcQSeDtF/liblibc-1170e40c1719a823.rlib\" \"/root/.rustup/toolchains/1.42.0-aarch64-unknown-linux-gnu/lib/rustlib/aarch64-unknown-linux-musl/lib/libcompiler_builtins-cb2050f8f4e1771d.rlib\" \"-Wl,-Bdynamic\" \"-lfdt\" \"-static\" \"-lgcc\" \"/root/.rustup/toolchains/1.42.0-aarch64-unknown-linux-gnu/lib/rustlib/aarch64-unknown-linux-musl/lib/crtn.o\"\r\n  = note: /usr/bin/ld: /tmp/rustcQSeDtF/liblibc-1170e40c1719a823.rlib(__stack_chk_fail.lo): undefined reference to symbol '__stack_chk_guard@@GLIBC_2.17'\r\n          /usr/bin/ld: /lib/aarch64-linux-gnu/ld-linux-aarch64.so.1: error adding symbols: DSO missing from command line\r\n          collect2: error: ld returned 1 exit status\r\n\r\n\r\nerror: aborting due to previous error\r\n```", "closed_by": {"login": "MrXinWang", "id": 38582160, "node_id": "MDQ6VXNlcjM4NTgyMTYw", "avatar_url": "https://avatars.githubusercontent.com/u/38582160?v=4", "gravatar_id": "", "url": "https://api.github.com/users/MrXinWang", "html_url": "https://github.com/MrXinWang", "followers_url": "https://api.github.com/users/MrXinWang/followers", "following_url": "https://api.github.com/users/MrXinWang/following{/other_user}", "gists_url": "https://api.github.com/users/MrXinWang/gists{/gist_id}", "starred_url": "https://api.github.com/users/MrXinWang/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/MrXinWang/subscriptions", "organizations_url": "https://api.github.com/users/MrXinWang/orgs", "repos_url": "https://api.github.com/users/MrXinWang/repos", "events_url": "https://api.github.com/users/MrXinWang/events{/privacy}", "received_events_url": "https://api.github.com/users/MrXinWang/received_events", "type": "User", "site_admin": false}, "reactions": {"url": "https://api.github.com/repos/rust-lang/rust/issues/73493/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rust-lang/rust/issues/73493/timeline", "performed_via_github_app": null, "state_reason": "completed"}