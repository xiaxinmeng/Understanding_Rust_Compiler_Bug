{"url": "https://api.github.com/repos/rust-lang/rust/issues/37809", "repository_url": "https://api.github.com/repos/rust-lang/rust", "labels_url": "https://api.github.com/repos/rust-lang/rust/issues/37809/labels{/name}", "comments_url": "https://api.github.com/repos/rust-lang/rust/issues/37809/comments", "events_url": "https://api.github.com/repos/rust-lang/rust/issues/37809/events", "html_url": "https://github.com/rust-lang/rust/issues/37809", "id": 189854405, "node_id": "MDU6SXNzdWUxODk4NTQ0MDU=", "number": 37809, "title": "rustc crash: thread 'rustc' panicked at 'Box<Any>', rust/1.13/src/rust/src/librustc_errors/lib.rs:602", "user": {"login": "jsgf", "id": 147966, "node_id": "MDQ6VXNlcjE0Nzk2Ng==", "avatar_url": "https://avatars.githubusercontent.com/u/147966?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jsgf", "html_url": "https://github.com/jsgf", "followers_url": "https://api.github.com/users/jsgf/followers", "following_url": "https://api.github.com/users/jsgf/following{/other_user}", "gists_url": "https://api.github.com/users/jsgf/gists{/gist_id}", "starred_url": "https://api.github.com/users/jsgf/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jsgf/subscriptions", "organizations_url": "https://api.github.com/users/jsgf/orgs", "repos_url": "https://api.github.com/users/jsgf/repos", "events_url": "https://api.github.com/users/jsgf/events{/privacy}", "received_events_url": "https://api.github.com/users/jsgf/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 9618520, "node_id": "MDU6TGFiZWw5NjE4NTIw", "url": "https://api.github.com/repos/rust-lang/rust/labels/I-ICE", "name": "I-ICE", "color": "e10c02", "default": false, "description": "Issue: The compiler panicked, giving an Internal Compilation Error (ICE) \u2744\ufe0f"}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 1, "created_at": "2016-11-16T21:39:15Z", "updated_at": "2017-05-16T12:43:33Z", "closed_at": "2017-05-16T12:43:33Z", "author_association": "CONTRIBUTOR", "active_lock_reason": null, "body": "rustc 1.13 crashed with:\r\n```\r\nthread 'rustc' panicked at 'Box<Any>', rust/1.13/src/rust/src/librustc_errors/lib.rs:602\r\nstack backtrace:\r\n   1:     0x7f3e4917aa8f - std::sys::backtrace::tracing::imp::write::h6f1d53a70916b90d\r\n   2:     0x7f3e49189fed - std::panicking::default_hook::{{closure}}::h137e876f7d3b5850\r\n   3:     0x7f3e4918745e - std::panicking::default_hook::h0ac3811ec7cee78c\r\n   4:     0x7f3e49187b48 - std::panicking::rust_panic_with_hook::hc303199e04562edf\r\n   5:     0x7f3e489d4628 - std::panicking::begin_panic::hf3c77cb5fd5814c4\r\n   6:     0x7f3e48b01575 - rustc::session::opt_span_bug_fmt::{{closure}}::hf0e25c590c479ec5\r\n   7:     0x7f3e48a197ca - rustc::session::span_bug_fmt::h42d4c0a219d5e4ec\r\n   8:     0x7f3e48ac8457 - rustc_typeck::check::FnCtxt::check_path_parameter_count::hc2ad181f3f777040\r\n   9:     0x7f3e48ac6825 - rustc_typeck::check::FnCtxt::instantiate_value_path::hfa5d7d83b8353970\r\n  10:     0x7f3e48ab94d0 - rustc_typeck::check::FnCtxt::check_expr_kind::h2bc479cd1fbdeadf\r\n  11:     0x7f3e48ab6a6a - rustc_typeck::check::FnCtxt::check_expr_with_expectation_and_lvalue_pref::h681fafa88c40b2ba\r\n  12:     0x7f3e48ab1213 - rustc_typeck::check::FnCtxt::check_argument_types::hed35c9823eddf317\r\n  13:     0x7f3e48a82ca6 - rustc_typeck::check::callee::<impl rustc_typeck::check::FnCtxt<'a, 'gcx, 'tcx>>::confirm_builtin_call::h2a6f0d42e9460044\r\n  14:     0x7f3e48a81dbf - rustc_typeck::check::callee::<impl rustc_typeck::check::FnCtxt<'a, 'gcx, 'tcx>>::check_call::h2eb88b075d26016a\r\n  15:     0x7f3e48ab79ed - rustc_typeck::check::FnCtxt::check_expr_kind::h2bc479cd1fbdeadf\r\n  16:     0x7f3e48ab6a6a - rustc_typeck::check::FnCtxt::check_expr_with_expectation_and_lvalue_pref::h681fafa88c40b2ba\r\n  17:     0x7f3e48a41aab - rustc_typeck::check::_match::<impl rustc_typeck::check::FnCtxt<'a, 'gcx, 'tcx>>::check_match::h883631eee69589e9\r\n  18:     0x7f3e48ab6edf - rustc_typeck::check::FnCtxt::check_expr_kind::h2bc479cd1fbdeadf\r\n  19:     0x7f3e48ab6a6a - rustc_typeck::check::FnCtxt::check_expr_with_expectation_and_lvalue_pref::h681fafa88c40b2ba\r\n  20:     0x7f3e48ac620c - rustc_typeck::check::FnCtxt::check_block_with_expected::hbd45bbda86915d07\r\n  21:     0x7f3e48a953cb - rustc_typeck::check::check_fn::h12c0d05f83ad8556\r\n  22:     0x7f3e48a93cb7 - rustc_typeck::check::check_bare_fn::hb4550dd2ea96340d\r\n  23:     0x7f3e48a96e95 - rustc_typeck::check::check_item_body::h3f1f413025e17499\r\n  24:     0x7f3e48a9138e - rustc_typeck::check::check_item_bodies::h3fa451d8a8774470\r\n  25:     0x7f3e48afd56e - rustc_typeck::check_crate::h54ff5b2dd08c0691\r\n  26:     0x7f3e49536365 - rustc_driver::driver::phase_3_run_analysis_passes::{{closure}}::h4091eeab6f271a29\r\n  27:     0x7f3e4951149d - rustc_driver::driver::phase_3_run_analysis_passes::hff1c31d493acfd09\r\n  28:     0x7f3e494fdb29 - rustc_driver::driver::compile_input::hef221f9f618e92f5\r\n  29:     0x7f3e495282f6 - rustc_driver::run_compiler::h7dddd4089f8330b4\r\n  30:     0x7f3e494643b3 - std::panicking::try::do_call::h1e3ece12e3f812df\r\n  31:     0x7f3e491931b6 - __rust_maybe_catch_panic\r\n  32:     0x7f3e494825e9 - <F as alloc::boxed::FnBox<A>>::call_box::h05b222e46803eb30\r\n  33:     0x7f3e49185eb0 - std::sys::thread::Thread::new::thread_start::h759e10bc4abc7e72\r\n  34:     0x7f3e41fd1dc4 - start_thread\r\n  35:     0x7f3e48e40cec - clone\r\n  36:                0x0 - <unknown>\r\n\r\n\r\nerror[E0533]: `Flag::Unknown(_)` does not name a unit variant, unit struct or a constant\r\n   --> src/mercurial/manifest/manifest.rs:141:1\r\n    |\r\n141 | graphql_enum!(Flag {\r\n    | ^\r\n    |\r\n    = note: this error originates in a macro outside of the current crate\r\n\r\nerror: internal compiler error: rust/1.13/src/rust/src/librustc_typeck/check/mod.rs:4366: parenthesized parameters cannot appear in ExprPath\r\n   --> src/mercurial/manifest/manifest.rs:141:1\r\n    |\r\n141 | graphql_enum!(Flag {\r\n    | ^\r\n    |\r\n    = note: this error originates in a macro outside of the current crate\r\n\r\nnote: the compiler unexpectedly panicked. this is a bug.\r\n\r\nnote: we would appreciate a bug report: https://github.com/rust-lang/rust/blob/master/CONTRIBUTING.md#bug-reports\r\n\r\nnote: run with `RUST_BACKTRACE=1` for a backtrace\r\n\r\n```\r\n\r\nThe code in question is using the `graphql_enum` macro from the [juniper crate](https://github.com/mhallin/juniper). I'm trying to get a smaller repro case.\r\n\r\nThe enum in question is basically:\r\n```\r\nenum Flag {\r\n  Unknown(u8),\r\n  Foo,\r\n  Bar,\r\n  Blatt,\r\n};\r\n```\r\n\r\nwhich I tried to (incorrectly) use with `graphql_enum` as:\r\n```\r\ngraphql_enum!(Flag {\r\n  Flag::Unknown(_) => \"UNKNOWN\",\r\n  Flag::Foo => \"FOO\",\r\n  Flag::Bar => \"BAR\",\r\n  Flag::Blatt => \"BLATT\",\r\n});\r\n```\r\n\r\nwhich expands to expressions of the form `&Foo::Unknown::(_)`, which seems to be what's making the compiler upset. But when I do a much simpler example with these same elements, the compiler doesn't crash (just fails with lots of reasonable-looking errors).", "closed_by": {"login": "Mark-Simulacrum", "id": 5047365, "node_id": "MDQ6VXNlcjUwNDczNjU=", "avatar_url": "https://avatars.githubusercontent.com/u/5047365?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Mark-Simulacrum", "html_url": "https://github.com/Mark-Simulacrum", "followers_url": "https://api.github.com/users/Mark-Simulacrum/followers", "following_url": "https://api.github.com/users/Mark-Simulacrum/following{/other_user}", "gists_url": "https://api.github.com/users/Mark-Simulacrum/gists{/gist_id}", "starred_url": "https://api.github.com/users/Mark-Simulacrum/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Mark-Simulacrum/subscriptions", "organizations_url": "https://api.github.com/users/Mark-Simulacrum/orgs", "repos_url": "https://api.github.com/users/Mark-Simulacrum/repos", "events_url": "https://api.github.com/users/Mark-Simulacrum/events{/privacy}", "received_events_url": "https://api.github.com/users/Mark-Simulacrum/received_events", "type": "User", "site_admin": false}, "reactions": {"url": "https://api.github.com/repos/rust-lang/rust/issues/37809/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rust-lang/rust/issues/37809/timeline", "performed_via_github_app": null, "state_reason": "completed"}