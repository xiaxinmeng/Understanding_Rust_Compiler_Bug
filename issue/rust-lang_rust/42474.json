{"url": "https://api.github.com/repos/rust-lang/rust/issues/42474", "repository_url": "https://api.github.com/repos/rust-lang/rust", "labels_url": "https://api.github.com/repos/rust-lang/rust/issues/42474/labels{/name}", "comments_url": "https://api.github.com/repos/rust-lang/rust/issues/42474/comments", "events_url": "https://api.github.com/repos/rust-lang/rust/issues/42474/events", "html_url": "https://github.com/rust-lang/rust/issues/42474", "id": 233811087, "node_id": "MDU6SXNzdWUyMzM4MTEwODc=", "number": 42474, "title": "`cargo test` doesn't capture print from threads", "user": {"login": "kpcyrd", "id": 7763184, "node_id": "MDQ6VXNlcjc3NjMxODQ=", "avatar_url": "https://avatars.githubusercontent.com/u/7763184?v=4", "gravatar_id": "", "url": "https://api.github.com/users/kpcyrd", "html_url": "https://github.com/kpcyrd", "followers_url": "https://api.github.com/users/kpcyrd/followers", "following_url": "https://api.github.com/users/kpcyrd/following{/other_user}", "gists_url": "https://api.github.com/users/kpcyrd/gists{/gist_id}", "starred_url": "https://api.github.com/users/kpcyrd/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/kpcyrd/subscriptions", "organizations_url": "https://api.github.com/users/kpcyrd/orgs", "repos_url": "https://api.github.com/users/kpcyrd/repos", "events_url": "https://api.github.com/users/kpcyrd/events{/privacy}", "received_events_url": "https://api.github.com/users/kpcyrd/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 60329014, "node_id": "MDU6TGFiZWw2MDMyOTAxNA==", "url": "https://api.github.com/repos/rust-lang/rust/labels/P-low", "name": "P-low", "color": "eb6420", "default": false, "description": "Low priority"}, {"id": 211668062, "node_id": "MDU6TGFiZWwyMTE2NjgwNjI=", "url": "https://api.github.com/repos/rust-lang/rust/labels/T-libs-api", "name": "T-libs-api", "color": "bfd4f2", "default": false, "description": "Relevant to the library API team, which will review and decide on the PR/issue."}, {"id": 630810559, "node_id": "MDU6TGFiZWw2MzA4MTA1NTk=", "url": "https://api.github.com/repos/rust-lang/rust/labels/A-libtest", "name": "A-libtest", "color": "f7e101", "default": false, "description": "Area: #[test] related"}, {"id": 657353545, "node_id": "MDU6TGFiZWw2NTczNTM1NDU=", "url": "https://api.github.com/repos/rust-lang/rust/labels/C-feature-accepted", "name": "C-feature-accepted", "color": "f5f1fd", "default": false, "description": "Category: A feature request that has been accepted pending implementation."}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 9, "created_at": "2017-06-06T08:07:55Z", "updated_at": "2023-02-02T03:37:15Z", "closed_at": "2020-10-27T13:57:51Z", "author_association": "NONE", "active_lock_reason": null, "body": "I've filed this bug in [rust-lang/cargo](https://github.com/rust-lang/cargo/issues/4129) but I'm afraid rust-lang/rust is the correct repo for this.\r\n\r\nI ran the tests for one of my crates that uses threads in its example code. I've noticed it printed some lines to stdout, even though `--nocapture` wasn't set, but not all of them. It appears that text printed from new threads are not correctly captured, I think this is not intended.\r\n\r\n## Reproduce\r\n```\r\n#[cfg(test)]\r\nmod tests {\r\n    use std::thread;\r\n    use std::time::Duration;\r\n\r\n    #[test]\r\n    fn it_works() {\r\n        thread::spawn(move || {\r\n            println!(\"request: {:?}\", 123);\r\n        });\r\n\r\n        thread::sleep(Duration::from_secs(1));\r\n        println!(\"response: {:?}\", 456);\r\n    }\r\n```\r\n\r\n## Output\r\n```\r\nrunning 2 tests\r\nrequest: 123\r\ntest tests::it_works ... ok\r\n[...]\r\n```\r\n\r\n## Meta\r\n\r\n`rustc --version --verbose`:\r\n\r\n```\r\nrustc 1.17.0\r\nbinary: rustc\r\ncommit-hash: unknown\r\ncommit-date: unknown\r\nhost: x86_64-unknown-linux-gnu\r\nrelease: 1.17.0\r\nLLVM version: 4.0\r\n```", "closed_by": {"login": "bors", "id": 3372342, "node_id": "MDQ6VXNlcjMzNzIzNDI=", "avatar_url": "https://avatars.githubusercontent.com/u/3372342?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors", "html_url": "https://github.com/bors", "followers_url": "https://api.github.com/users/bors/followers", "following_url": "https://api.github.com/users/bors/following{/other_user}", "gists_url": "https://api.github.com/users/bors/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors/subscriptions", "organizations_url": "https://api.github.com/users/bors/orgs", "repos_url": "https://api.github.com/users/bors/repos", "events_url": "https://api.github.com/users/bors/events{/privacy}", "received_events_url": "https://api.github.com/users/bors/received_events", "type": "User", "site_admin": false}, "reactions": {"url": "https://api.github.com/repos/rust-lang/rust/issues/42474/reactions", "total_count": 10, "+1": 10, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rust-lang/rust/issues/42474/timeline", "performed_via_github_app": null, "state_reason": "completed"}