{"url": "https://api.github.com/repos/rust-lang/rust/issues/89688", "repository_url": "https://api.github.com/repos/rust-lang/rust", "labels_url": "https://api.github.com/repos/rust-lang/rust/issues/89688/labels{/name}", "comments_url": "https://api.github.com/repos/rust-lang/rust/issues/89688/comments", "events_url": "https://api.github.com/repos/rust-lang/rust/issues/89688/events", "html_url": "https://github.com/rust-lang/rust/issues/89688", "id": 1021507645, "node_id": "I_kwDOAAsO6M484vg9", "number": 89688, "title": "Let-else source expression move behavior", "user": {"login": "phaylon", "id": 41822, "node_id": "MDQ6VXNlcjQxODIy", "avatar_url": "https://avatars.githubusercontent.com/u/41822?v=4", "gravatar_id": "", "url": "https://api.github.com/users/phaylon", "html_url": "https://github.com/phaylon", "followers_url": "https://api.github.com/users/phaylon/followers", "following_url": "https://api.github.com/users/phaylon/following{/other_user}", "gists_url": "https://api.github.com/users/phaylon/gists{/gist_id}", "starred_url": "https://api.github.com/users/phaylon/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/phaylon/subscriptions", "organizations_url": "https://api.github.com/users/phaylon/orgs", "repos_url": "https://api.github.com/users/phaylon/repos", "events_url": "https://api.github.com/users/phaylon/events{/privacy}", "received_events_url": "https://api.github.com/users/phaylon/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 650731663, "node_id": "MDU6TGFiZWw2NTA3MzE2NjM=", "url": "https://api.github.com/repos/rust-lang/rust/labels/C-bug", "name": "C-bug", "color": "f5f1fd", "default": false, "description": "Category: This is a bug."}, {"id": 3186331060, "node_id": "MDU6TGFiZWwzMTg2MzMxMDYw", "url": "https://api.github.com/repos/rust-lang/rust/labels/F-let-else", "name": "F-let-else", "color": "f9c0cc", "default": false, "description": "Issues related to let-else statements (RFC 3137)"}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 13, "created_at": "2021-10-08T22:19:05Z", "updated_at": "2021-12-18T01:12:10Z", "closed_at": "2021-12-18T01:12:10Z", "author_association": "CONTRIBUTOR", "active_lock_reason": null, "body": "The move behavior on non-matching of expressions by `feature(let_else)` seems currently inconsistent with behavior of, for example, `if let`.\r\n\r\nAn `if-let` construct does not move from the matched expression if the pattern doesn't match:\r\n\r\n```rust\r\nfn example_if_let(value: Option<String>) {\r\n    if let Some(inner) = value {\r\n        println!(\"inner: {}\", inner);\r\n    } else {\r\n        println!(\"other: {:?}\", value);\r\n    }\r\n}\r\n\r\nfn main() {\r\n    example_if_let(Some(\"foo\".into()));\r\n    example_if_let(None);\r\n}\r\n```\r\ncompiles and prints\r\n```\r\ninner: foo\r\nother: None\r\n```\r\n\r\nHowever, `let-else` seems to unconditionally move from the matched expression:\r\n```rust\r\n#![feature(let_else)]\r\n\r\nfn example_let_else(value: Option<String>) {\r\n    let Some(inner) = value else {\r\n        println!(\"other: {:?}\", value);\r\n        return;\r\n    };\r\n    println!(\"inner: {}\", inner);\r\n}\r\n\r\nfn main() {\r\n    example_let_else(Some(\"foo\".into()));\r\n    example_let_else(None);\r\n}\r\n```\r\nfails to compile:\r\n```\r\nerror[E0382]: borrow of moved value: `value`\r\n --> src/main.rs:5:33\r\n  |\r\n3 | fn example_let_else(value: Option<String>) {\r\n  |                     ----- move occurs because `value` has type `Option<String>`, which does not implement the `Copy` trait\r\n4 |     let Some(inner) = value else {\r\n  |                       ----- value moved here\r\n5 |         println!(\"other: {:?}\", value);\r\n  |                                 ^^^^^ value borrowed here after move\r\n```\r\n\r\nI'm wondering if this is intentional, as it would seem to make it impossible to use the original unmatched value in an panic message (or diverge otherwise with the value or any value based on it).\r\n\r\n```\r\nrustc 1.57.0-nightly (485ced56b 2021-10-07)\r\nbinary: rustc\r\ncommit-hash: 485ced56b8753ec86936903f2a8c95e9be8996a1\r\ncommit-date: 2021-10-07\r\nhost: x86_64-unknown-linux-gnu\r\nrelease: 1.57.0-nightly\r\nLLVM version: 13.0.0\r\n```\r\n\r\nProposed Label: F-let-else", "closed_by": {"login": "bors", "id": 3372342, "node_id": "MDQ6VXNlcjMzNzIzNDI=", "avatar_url": "https://avatars.githubusercontent.com/u/3372342?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors", "html_url": "https://github.com/bors", "followers_url": "https://api.github.com/users/bors/followers", "following_url": "https://api.github.com/users/bors/following{/other_user}", "gists_url": "https://api.github.com/users/bors/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors/subscriptions", "organizations_url": "https://api.github.com/users/bors/orgs", "repos_url": "https://api.github.com/users/bors/repos", "events_url": "https://api.github.com/users/bors/events{/privacy}", "received_events_url": "https://api.github.com/users/bors/received_events", "type": "User", "site_admin": false}, "reactions": {"url": "https://api.github.com/repos/rust-lang/rust/issues/89688/reactions", "total_count": 1, "+1": 1, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rust-lang/rust/issues/89688/timeline", "performed_via_github_app": null, "state_reason": "completed"}