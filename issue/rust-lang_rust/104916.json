{"url": "https://api.github.com/repos/rust-lang/rust/issues/104916", "repository_url": "https://api.github.com/repos/rust-lang/rust", "labels_url": "https://api.github.com/repos/rust-lang/rust/issues/104916/labels{/name}", "comments_url": "https://api.github.com/repos/rust-lang/rust/issues/104916/comments", "events_url": "https://api.github.com/repos/rust-lang/rust/issues/104916/events", "html_url": "https://github.com/rust-lang/rust/issues/104916", "id": 1464984199, "node_id": "I_kwDOAAsO6M5XUeKH", "number": 104916, "title": "ICE \"Not enough bound vars\"", "user": {"login": "jruderman", "id": 692547, "node_id": "MDQ6VXNlcjY5MjU0Nw==", "avatar_url": "https://avatars.githubusercontent.com/u/692547?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jruderman", "html_url": "https://github.com/jruderman", "followers_url": "https://api.github.com/users/jruderman/followers", "following_url": "https://api.github.com/users/jruderman/following{/other_user}", "gists_url": "https://api.github.com/users/jruderman/gists{/gist_id}", "starred_url": "https://api.github.com/users/jruderman/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jruderman/subscriptions", "organizations_url": "https://api.github.com/users/jruderman/orgs", "repos_url": "https://api.github.com/users/jruderman/repos", "events_url": "https://api.github.com/users/jruderman/events{/privacy}", "received_events_url": "https://api.github.com/users/jruderman/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 9618520, "node_id": "MDU6TGFiZWw5NjE4NTIw", "url": "https://api.github.com/repos/rust-lang/rust/labels/I-ICE", "name": "I-ICE", "color": "e10c02", "default": false, "description": "Issue: The compiler panicked, giving an Internal Compilation Error (ICE) \u2744\ufe0f"}, {"id": 46741598, "node_id": "MDU6TGFiZWw0Njc0MTU5OA==", "url": "https://api.github.com/repos/rust-lang/rust/labels/E-needs-test", "name": "E-needs-test", "color": "02e10c", "default": false, "description": "Call for participation: writing correctness tests"}, {"id": 211668100, "node_id": "MDU6TGFiZWwyMTE2NjgxMDA=", "url": "https://api.github.com/repos/rust-lang/rust/labels/T-compiler", "name": "T-compiler", "color": "bfd4f2", "default": false, "description": "Relevant to the compiler team, which will review and decide on the PR/issue."}, {"id": 650731663, "node_id": "MDU6TGFiZWw2NTA3MzE2NjM=", "url": "https://api.github.com/repos/rust-lang/rust/labels/C-bug", "name": "C-bug", "color": "f5f1fd", "default": false, "description": "Category: This is a bug."}, {"id": 1476769455, "node_id": "MDU6TGFiZWwxNDc2NzY5NDU1", "url": "https://api.github.com/repos/rust-lang/rust/labels/F-associated_type_bounds", "name": "F-associated_type_bounds", "color": "f9c0cc", "default": false, "description": "`#![feature(associated_type_bounds)]`"}, {"id": 4199206102, "node_id": "LA_kwDOAAsO6M76SszW", "url": "https://api.github.com/repos/rust-lang/rust/labels/requires-debug-assertions", "name": "requires-debug-assertions", "color": "76dcde", "default": false, "description": "This issue requires debug-assertions in some way"}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 3, "created_at": "2022-11-25T23:38:14Z", "updated_at": "2023-04-11T08:11:45Z", "closed_at": "2023-04-11T08:11:45Z", "author_association": "CONTRIBUTOR", "active_lock_reason": null, "body": "Found with a [modified fuzz-rustc](https://github.com/jruderman/fuzz-rustc)\r\n\r\n### Code\r\n\r\n```Rust\r\n#![feature(associated_type_bounds)]\r\n\r\ntrait B {\r\n    type AssocType;\r\n}\r\n\r\nfn f()\r\nwhere\r\n    dyn for<'j> B<AssocType: 'j>:,\r\n{\r\n}\r\n\r\nfn main() {}\r\n```\r\n\r\n### ICE (with debug assertions enabled)\r\n\r\nerror: internal compiler error: [compiler/rustc_middle/src/ty/visit.rs:415](https://github.com/rust-lang/rust/blob/8681d4cffcd23bbe619984ab62772a91827a40dc/compiler/rustc_middle/src/ty/visit.rs#L415): Not enough bound vars: `BoundRegion { var: 0, kind: BrNamed(DefId(0:6 ~ hy[af0c]::f::'j), 'j) }` not found in `[]`\r\n\r\n<!--\r\nInclude a backtrace in the code block by setting `RUST_BACKTRACE=1` in your\r\nenvironment. E.g. `RUST_BACKTRACE=1 cargo build`.\r\n-->\r\n<details><summary><strong>Backtrace</strong></summary>\r\n<p>\r\n\r\n```\r\nerror: internal compiler error: compiler/rustc_middle/src/ty/visit.rs:415:21: Not enough bound vars: BoundRegion { var: 0, kind: BrNamed(DefId(0:6 ~ hy[af0c]::f::'j), 'j) } not found in []\r\n\r\nthread 'rustc' panicked at 'Box<dyn Any>', /Users/jruderman/code/rust/compiler/rustc_errors/src/lib.rs:1575:9\r\nstack backtrace:\r\n   0:        0x106455f21 - <std::sys_common::backtrace::_print::DisplayBacktrace as core::fmt::Display>::fmt::hcf5aac4d53eab431\r\n   1:        0x106513818 - core::fmt::write::hed31846cddb4e13c\r\n   2:        0x1064b8ec8 - std::io::Write::write_fmt::h01887004f97cedc7\r\n   3:        0x106455d12 - std::sys_common::backtrace::print::h2141c6543b5865e5\r\n   4:        0x1064b9e45 - std::panicking::default_hook::{{closure}}::hfe93a58a10a72158\r\n   5:        0x1064b9c2e - std::panicking::default_hook::hafca10424d622dfb\r\n   6:        0x115a11398 - rustc_driver[b73731b7ed8e79fd]::DEFAULT_HOOK::{closure#0}::{closure#0}\r\n   7:        0x1064ba636 - std::panicking::rust_panic_with_hook::hafe3bb82e805c420\r\n   8:        0x11a9a8337 - std[e4564114326e8c6]::panicking::begin_panic::<rustc_errors[9121627fb7cf2262]::ExplicitBug>::{closure#0}\r\n   9:        0x11a9a82a9 - std[e4564114326e8c6]::sys_common::backtrace::__rust_end_short_backtrace::<std[e4564114326e8c6]::panicking::begin_panic<rustc_errors[9121627fb7cf2262]::ExplicitBug>::{closure#0}, !>\r\n  10:        0x11b0a9b89 - std[e4564114326e8c6]::panicking::begin_panic::<rustc_errors[9121627fb7cf2262]::ExplicitBug>\r\n  11:        0x11a8c9f69 - std[e4564114326e8c6]::panic::panic_any::<rustc_errors[9121627fb7cf2262]::ExplicitBug>\r\n  12:        0x11a8c9e9d - <rustc_errors[9121627fb7cf2262]::HandlerInner>::bug::<&alloc[fd2a8df82bfdc6c8]::string::String>\r\n  13:        0x11a8c99d1 - <rustc_errors[9121627fb7cf2262]::Handler>::bug::<&alloc[fd2a8df82bfdc6c8]::string::String>\r\n  14:        0x11aa1e0c2 - rustc_middle[db449b3460385d6f]::ty::context::tls::with_opt::<rustc_middle[db449b3460385d6f]::util::bug::opt_span_bug_fmt<rustc_span[3733f809f3ebe388]::span_encoding::Span>::{closure#0}, ()>\r\n  15:        0x11aa1e141 - rustc_middle[db449b3460385d6f]::util::bug::opt_span_bug_fmt::<rustc_span[3733f809f3ebe388]::span_encoding::Span>\r\n  16:        0x11b097f61 - rustc_middle[db449b3460385d6f]::util::bug::bug_fmt\r\n  17:        0x11a941b49 - <rustc_middle[db449b3460385d6f]::ty::visit::ValidateBoundVars as rustc_middle[db449b3460385d6f]::ty::visit::TypeVisitor>::visit_region\r\n  18:        0x118668e00 - <rustc_middle[db449b3460385d6f]::ty::sty::Binder<rustc_middle[db449b3460385d6f]::ty::sty::Region>>::bind_with_vars\r\n  19:        0x1185e33bf - <dyn rustc_hir_analysis[50d2e10c526ac435]::astconv::AstConv>::add_bounds::<core[95bb6d661b676f4d]::slice::iter::Iter<rustc_hir[2c9fd968c67d70e3]::hir::GenericBound>>\r\n  20:        0x1186cda4e - <dyn rustc_hir_analysis[50d2e10c526ac435]::astconv::AstConv>::compute_bounds_inner\r\n  21:        0x1184efd1d - rustc_hir_analysis[50d2e10c526ac435]::collect::item_bounds::explicit_item_bounds\r\n  22:        0x1196a6306 - rustc_query_system[e535d6d94a1ab2a4]::query::plumbing::try_execute_query::<rustc_query_impl[c1f689d635a76408]::plumbing::QueryCtxt, rustc_query_system[e535d6d94a1ab2a4]::query::caches::DefaultCache<rustc_span[3733f809f3ebe388]::def_id::DefId, &[(rustc_middle[db449b3460385d6f]::ty::Predicate, rustc_span[3733f809f3ebe388]::span_encoding::Span)]>>\r\n  23:        0x1197952e9 - rustc_query_system[e535d6d94a1ab2a4]::query::plumbing::get_query::<rustc_query_impl[c1f689d635a76408]::queries::explicit_item_bounds, rustc_query_impl[c1f689d635a76408]::plumbing::QueryCtxt>\r\n  24:        0x1199245d7 - <rustc_query_impl[c1f689d635a76408]::Queries as rustc_middle[db449b3460385d6f]::ty::query::QueryEngine>::explicit_item_bounds\r\n  25:        0x11869b285 - rustc_hir_analysis[50d2e10c526ac435]::collect::convert_item\r\n  26:        0x11869790c - <rustc_hir_analysis[50d2e10c526ac435]::collect::CollectItemTypesVisitor as rustc_hir[2c9fd968c67d70e3]::intravisit::Visitor>::visit_item\r\n  27:        0x11857e855 - <rustc_middle[db449b3460385d6f]::hir::map::Map>::visit_item_likes_in_module::<rustc_hir_analysis[50d2e10c526ac435]::collect::CollectItemTypesVisitor>\r\n  28:        0x118696c15 - rustc_hir_analysis[50d2e10c526ac435]::collect::collect_mod_item_types\r\n  29:        0x1196e107b - rustc_query_system[e535d6d94a1ab2a4]::query::plumbing::try_execute_query::<rustc_query_impl[c1f689d635a76408]::plumbing::QueryCtxt, rustc_query_system[e535d6d94a1ab2a4]::query::caches::VecCache<rustc_span[3733f809f3ebe388]::def_id::LocalDefId, ()>>\r\n  30:        0x11979cc03 - rustc_query_system[e535d6d94a1ab2a4]::query::plumbing::get_query::<rustc_query_impl[c1f689d635a76408]::queries::collect_mod_item_types, rustc_query_impl[c1f689d635a76408]::plumbing::QueryCtxt>\r\n  31:        0x119945ebf - <rustc_query_impl[c1f689d635a76408]::Queries as rustc_middle[db449b3460385d6f]::ty::query::QueryEngine>::collect_mod_item_types\r\n  32:        0x11857e153 - <rustc_middle[db449b3460385d6f]::hir::map::Map>::for_each_module::<rustc_hir_analysis[50d2e10c526ac435]::check_crate::{closure#0}::{closure#0}::{closure#0}>\r\n  33:        0x11867a71b - <rustc_session[eed39e6e03b50785]::session::Session>::track_errors::<rustc_hir_analysis[50d2e10c526ac435]::check_crate::{closure#0}, ()>\r\n  34:        0x1185b4a8c - rustc_hir_analysis[50d2e10c526ac435]::check_crate\r\n  35:        0x115b70faa - rustc_interface[9ed52e10726157d]::passes::analysis\r\n  36:        0x1196acd8f - rustc_query_system[e535d6d94a1ab2a4]::query::plumbing::try_execute_query::<rustc_query_impl[c1f689d635a76408]::plumbing::QueryCtxt, rustc_query_system[e535d6d94a1ab2a4]::query::caches::DefaultCache<(), core[95bb6d661b676f4d]::result::Result<(), rustc_errors[9121627fb7cf2262]::ErrorGuaranteed>>>\r\n  37:        0x1197cf0f9 - rustc_query_system[e535d6d94a1ab2a4]::query::plumbing::get_query::<rustc_query_impl[c1f689d635a76408]::queries::analysis, rustc_query_impl[c1f689d635a76408]::plumbing::QueryCtxt>\r\n  38:        0x119922ba7 - <rustc_query_impl[c1f689d635a76408]::Queries as rustc_middle[db449b3460385d6f]::ty::query::QueryEngine>::analysis\r\n  39:        0x115a25aab - <rustc_interface[9ed52e10726157d]::passes::QueryContext>::enter::<rustc_driver[b73731b7ed8e79fd]::run_compiler::{closure#1}::{closure#2}::{closure#2}, core[95bb6d661b676f4d]::result::Result<(), rustc_errors[9121627fb7cf2262]::ErrorGuaranteed>>\r\n  40:        0x11598cba5 - <rustc_interface[9ed52e10726157d]::interface::Compiler>::enter::<rustc_driver[b73731b7ed8e79fd]::run_compiler::{closure#1}::{closure#2}, core[95bb6d661b676f4d]::result::Result<core[95bb6d661b676f4d]::option::Option<rustc_interface[9ed52e10726157d]::queries::Linker>, rustc_errors[9121627fb7cf2262]::ErrorGuaranteed>>\r\n  41:        0x115a200cb - rustc_span[3733f809f3ebe388]::with_source_map::<core[95bb6d661b676f4d]::result::Result<(), rustc_errors[9121627fb7cf2262]::ErrorGuaranteed>, rustc_interface[9ed52e10726157d]::interface::run_compiler<core[95bb6d661b676f4d]::result::Result<(), rustc_errors[9121627fb7cf2262]::ErrorGuaranteed>, rustc_driver[b73731b7ed8e79fd]::run_compiler::{closure#1}>::{closure#0}::{closure#0}>\r\n  42:        0x11598849a - <scoped_tls[c451c38e2ed76225]::ScopedKey<rustc_span[3733f809f3ebe388]::SessionGlobals>>::set::<rustc_interface[9ed52e10726157d]::interface::run_compiler<core[95bb6d661b676f4d]::result::Result<(), rustc_errors[9121627fb7cf2262]::ErrorGuaranteed>, rustc_driver[b73731b7ed8e79fd]::run_compiler::{closure#1}>::{closure#0}, core[95bb6d661b676f4d]::result::Result<(), rustc_errors[9121627fb7cf2262]::ErrorGuaranteed>>\r\n  43:        0x1159ee870 - std[e4564114326e8c6]::sys_common::backtrace::__rust_begin_short_backtrace::<rustc_interface[9ed52e10726157d]::util::run_in_thread_pool_with_globals<rustc_interface[9ed52e10726157d]::interface::run_compiler<core[95bb6d661b676f4d]::result::Result<(), rustc_errors[9121627fb7cf2262]::ErrorGuaranteed>, rustc_driver[b73731b7ed8e79fd]::run_compiler::{closure#1}>::{closure#0}, core[95bb6d661b676f4d]::result::Result<(), rustc_errors[9121627fb7cf2262]::ErrorGuaranteed>>::{closure#0}::{closure#0}, core[95bb6d661b676f4d]::result::Result<(), rustc_errors[9121627fb7cf2262]::ErrorGuaranteed>>\r\n  44:        0x115a30900 - std[e4564114326e8c6]::panicking::try::<core[95bb6d661b676f4d]::result::Result<(), rustc_errors[9121627fb7cf2262]::ErrorGuaranteed>, core[95bb6d661b676f4d]::panic::unwind_safe::AssertUnwindSafe<<std[e4564114326e8c6]::thread::Builder>::spawn_unchecked_<rustc_interface[9ed52e10726157d]::util::run_in_thread_pool_with_globals<rustc_interface[9ed52e10726157d]::interface::run_compiler<core[95bb6d661b676f4d]::result::Result<(), rustc_errors[9121627fb7cf2262]::ErrorGuaranteed>, rustc_driver[b73731b7ed8e79fd]::run_compiler::{closure#1}>::{closure#0}, core[95bb6d661b676f4d]::result::Result<(), rustc_errors[9121627fb7cf2262]::ErrorGuaranteed>>::{closure#0}::{closure#0}, core[95bb6d661b676f4d]::result::Result<(), rustc_errors[9121627fb7cf2262]::ErrorGuaranteed>>::{closure#1}::{closure#0}>>\r\n  45:        0x1159901e1 - <<std[e4564114326e8c6]::thread::Builder>::spawn_unchecked_<rustc_interface[9ed52e10726157d]::util::run_in_thread_pool_with_globals<rustc_interface[9ed52e10726157d]::interface::run_compiler<core[95bb6d661b676f4d]::result::Result<(), rustc_errors[9121627fb7cf2262]::ErrorGuaranteed>, rustc_driver[b73731b7ed8e79fd]::run_compiler::{closure#1}>::{closure#0}, core[95bb6d661b676f4d]::result::Result<(), rustc_errors[9121627fb7cf2262]::ErrorGuaranteed>>::{closure#0}::{closure#0}, core[95bb6d661b676f4d]::result::Result<(), rustc_errors[9121627fb7cf2262]::ErrorGuaranteed>>::{closure#1} as core[95bb6d661b676f4d]::ops::function::FnOnce<()>>::call_once::{shim:vtable#0}\r\n  46:        0x10646fb5b - <alloc::boxed::Box<F,A> as core::ops::function::FnOnce<Args>>::call_once::hd10a5c38d6c64916\r\n  47:        0x10645a19f - std::sys::unix::thread::Thread::new::thread_start::he793914283faf21a\r\n  48:     0x7ff807a764e1 - __pthread_start\r\n\r\nnote: the compiler unexpectedly panicked. this is a bug.\r\n\r\nnote: we would appreciate a bug report: https://github.com/rust-lang/rust/issues/new?labels=C-bug%2C+I-ICE%2C+T-compiler&template=ice.md\r\n\r\nnote: rustc 1.67.0-dev running on x86_64-apple-darwin\r\n\r\nquery stack during panic:\r\n#0 [explicit_item_bounds] finding item bounds for `f::{opaque#0}`\r\n#1 [collect_mod_item_types] collecting item types in top-level module\r\n#2 [analysis] running analysis passes on this crate\r\nend of query stack\r\nerror: aborting due to previous error\r\n```\r\n\r\n</p>\r\n</details>\r\n\r\n### Version\r\n\r\nstage1 built from 8681d4cffcd23bbe619984ab62772a91827a40dc with debug assertions\r\n\r\n<details><summary>config.toml</summary>\r\n\r\n```toml\r\n# Includes one of the default files in src/bootstrap/defaults\r\nprofile = \"compiler\"\r\nchangelog-seen = 2\r\n\r\n[llvm]\r\ndownload-ci-llvm = true     # Download a pre-built LLVM?\r\nassertions = true           # LLVM assertions on?\r\n\r\n[rust]\r\nincremental = true          # Build rustc with incremental compilation?\r\ndebug-assertions = true\r\noverflow-checks = true\r\n```\r\n\r\n</details>\r\n\r\n@rustbot label +F-associated_type_bounds +requires-debug-assertions ", "closed_by": {"login": "bors", "id": 3372342, "node_id": "MDQ6VXNlcjMzNzIzNDI=", "avatar_url": "https://avatars.githubusercontent.com/u/3372342?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors", "html_url": "https://github.com/bors", "followers_url": "https://api.github.com/users/bors/followers", "following_url": "https://api.github.com/users/bors/following{/other_user}", "gists_url": "https://api.github.com/users/bors/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors/subscriptions", "organizations_url": "https://api.github.com/users/bors/orgs", "repos_url": "https://api.github.com/users/bors/repos", "events_url": "https://api.github.com/users/bors/events{/privacy}", "received_events_url": "https://api.github.com/users/bors/received_events", "type": "User", "site_admin": false}, "reactions": {"url": "https://api.github.com/repos/rust-lang/rust/issues/104916/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rust-lang/rust/issues/104916/timeline", "performed_via_github_app": null, "state_reason": "completed"}