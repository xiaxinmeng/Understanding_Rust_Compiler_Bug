{"url": "https://api.github.com/repos/rust-lang/rust/issues/39665", "repository_url": "https://api.github.com/repos/rust-lang/rust", "labels_url": "https://api.github.com/repos/rust-lang/rust/issues/39665/labels{/name}", "comments_url": "https://api.github.com/repos/rust-lang/rust/issues/39665/comments", "events_url": "https://api.github.com/repos/rust-lang/rust/issues/39665/events", "html_url": "https://github.com/rust-lang/rust/issues/39665", "id": 206372198, "node_id": "MDU6SXNzdWUyMDYzNzIxOTg=", "number": 39665, "title": "ICE: \"cannot relate bound region\" when using conservative_impl_trait", "user": {"login": "kryptan", "id": 11528855, "node_id": "MDQ6VXNlcjExNTI4ODU1", "avatar_url": "https://avatars.githubusercontent.com/u/11528855?v=4", "gravatar_id": "", "url": "https://api.github.com/users/kryptan", "html_url": "https://github.com/kryptan", "followers_url": "https://api.github.com/users/kryptan/followers", "following_url": "https://api.github.com/users/kryptan/following{/other_user}", "gists_url": "https://api.github.com/users/kryptan/gists{/gist_id}", "starred_url": "https://api.github.com/users/kryptan/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/kryptan/subscriptions", "organizations_url": "https://api.github.com/users/kryptan/orgs", "repos_url": "https://api.github.com/users/kryptan/repos", "events_url": "https://api.github.com/users/kryptan/events{/privacy}", "received_events_url": "https://api.github.com/users/kryptan/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 9618520, "node_id": "MDU6TGFiZWw5NjE4NTIw", "url": "https://api.github.com/repos/rust-lang/rust/labels/I-ICE", "name": "I-ICE", "color": "e10c02", "default": false, "description": "Issue: The compiler panicked, giving an Internal Compilation Error (ICE) \u2744\ufe0f"}, {"id": 650731663, "node_id": "MDU6TGFiZWw2NTA3MzE2NjM=", "url": "https://api.github.com/repos/rust-lang/rust/labels/C-bug", "name": "C-bug", "color": "f5f1fd", "default": false, "description": "Category: This is a bug."}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 1, "created_at": "2017-02-09T00:50:22Z", "updated_at": "2017-12-31T07:28:11Z", "closed_at": "2017-12-31T07:28:11Z", "author_association": "CONTRIBUTOR", "active_lock_reason": null, "body": "[Playground](https://play.rust-lang.org/?gist=579ebe1a197a5f1db24990a41c7117a7&version=nightly&backtrace=0\r\n)\r\n```Rust\r\n#![feature(conservative_impl_trait)]\r\n\r\nfn batches(n: &u32) -> impl Iterator<Item=&u32> {\r\n    std::iter::once(n)\r\n}\r\n\r\nfn main() {}\r\n```\r\n\r\nOutput:\r\n```\r\nE:\\mega3\\projects\\ice\\ice>cargo build\r\n   Compiling ice v0.1.0 (file:///E:/mega3/projects/ice/ice)\r\nerror: internal compiler error: C:\\bot\\slave\\nightly-dist-rustc-win-msvc-64\\build\\src\\librustc\\infer\\region_inference/mod.rs:744: cannot relate bound region: '_#1r <= ReLateBound(DebruijnIndex { depth: 2 }, BrAnon(0))\r\n --> src\\main.rs:3:24\r\n  |\r\n3 | fn batches(n: &u32) -> impl Iterator<Item=&u32> {\r\n  |                        ^^^^^^^^^^^^^^^^^^^^^^^^\r\n\r\nnote: the compiler unexpectedly panicked. this is a bug.\r\n\r\nnote: we would appreciate a bug report: https://github.com/rust-lang/rust/blob/master/CONTRIBUTING.md#bug-reports\r\n\r\nnote: run with `RUST_BACKTRACE=1` for a backtrace\r\n\r\nthread 'rustc' panicked at 'Box<Any>', C:\\bot\\slave\\nightly-dist-rustc-win-msvc-64\\build\\src\\librustc_errors\\lib.rs:376\r\nstack backtrace:\r\n   0:     0x7ffbf9a60d58 - std::panicking::Location::line::ha91c35bc276d0b51\r\n   1:     0x7ffbf9a601e2 - std::panicking::Location::line::ha91c35bc276d0b51\r\n   2:     0x7ffbf9a63c1d - std::panicking::rust_panic_with_hook::hf12525c539cafb95\r\n   3:     0x7ffbf6d1288b - <unknown>\r\n   4:     0x7ffbf6efbd99 - rustc::session::bug_fmt::h2b4624f40b53342d\r\n   5:     0x7ffbf6efb7e2 - rustc::session::bug_fmt::h2b4624f40b53342d\r\n   6:     0x7ffbf6efaf54 - rustc::session::bug_fmt::h2b4624f40b53342d\r\n   7:     0x7ffbf6e378a4 - rustc::infer::region_inference::RegionVarBindings::make_subregion::h7d1c928b417a379e\r\n   8:     0x7ffbf6e37177 - rustc::infer::region_inference::RegionVarBindings::make_eqregion::h7aba2537086b9605\r\n   9:     0x7ffbf6e18347 - <rustc::infer::equate::Equate<'combine, 'infcx, 'gcx, 'tcx> as rustc::ty::relate::TypeRelation<'infcx, 'gcx, 'tcx>>::regions::h3e5abdb2851963c5\r\n  10:     0x7ffbf6f66209 - rustc::ty::outlives::<impl rustc::ty::context::TyCtxt<'a, 'gcx, 'tcx>>::outlives_components::h006225a62a2484ea\r\n  11:     0x7ffbf6e17a98 - <rustc::infer::equate::Equate<'combine, 'infcx, 'gcx, 'tcx> as rustc::ty::relate::TypeRelation<'infcx, 'gcx, 'tcx>>::tys::h0e345c52eceb6db5\r\n  12:     0x7ffbf6e4ce89 - rustc::infer::InferCtxt::combine_fields::h8d78780cd9bc1f89\r\n  13:     0x7ffbf6e537c4 - rustc::infer::InferCtxt::eq_types::h341a931021d55886\r\n  14:     0x7ffbf6f15081 - rustc::traits::fulfill::GlobalFulfilledPredicates::check_duplicate_trait::h93cb52b260fb1258\r\n  15:     0x7ffbf6e51365 - rustc::infer::InferCtxt::commit_from::h79f349c198c8b4f0\r\n  16:     0x7ffbf6f12969 - <rustc::traits::fulfill::FulfillProcessor<'a, 'b, 'gcx, 'tcx> as rustc_data_structures::obligation_forest::ObligationProcessor>::process_obligation::h80789c9225e6da16\r\n  17:     0x7ffbf6f104a4 - rustc::traits::fulfill::FulfillmentContext::take_deferred_obligations::h59157437f621c52e\r\n  18:     0x7ffbf6f0fdb7 - rustc::traits::fulfill::FulfillmentContext::select_where_possible::hedb3ea6dfe818e1e\r\n  19:     0x7ffbf79ef1a5 - rustc_typeck::check::FnCtxt::field_ty::h387f0899108f3c54\r\n  20:     0x7ffbf79edfac - rustc_typeck::check::FnCtxt::field_ty::h387f0899108f3c54\r\n  21:     0x7ffbf79dd506 - rustc_typeck::check::check_drop_impls::h632d17e4d693e43d\r\n  22:     0x7ffbf79d9db0 - rustc_typeck::check::check_item_bodies::h9a3914a42542ad06\r\n  23:     0x7ffbf7a5d7a0 - rustc_typeck::check_crate::h26811b192a872b84\r\n  24:     0x7ffbf9e15c7e - rustc_driver::driver::count_nodes::h80b2ce48c34d37f0\r\n  25:     0x7ffbf9d663c6 - <unknown>\r\n  26:     0x7ffbf9df13f6 - rustc_driver::driver::compile_input::hc2e887bda4c69183\r\n  27:     0x7ffbf9e42dfb - rustc_driver::run_compiler::h94efe000e99b91da\r\n  28:     0x7ffbf9d1efbe - <unknown>\r\n  29:     0x7ffbf9a66c51 - _rust_maybe_catch_panic\r\n  30:     0x7ffbf9d4c806 - <unknown>\r\n  31:     0x7ffbf9a5e1ce - std::sys::imp::thread::Thread::new::hd3ea3fbc2b0bf083\r\n  32:     0x7ffc1abd8363 - BaseThreadInitThunk\r\n\r\nerror: Could not compile `ice`.\r\n\r\nTo learn more, run the command again with --verbose.\r\n```\r\n\r\nOther example (possibly different bug):\r\n\r\n```Rust\r\n#![feature(conservative_impl_trait)]\r\n\r\nfn batches(n: &u32) -> impl Iterator<Item=&u32> {\r\n    std::iter::empty()\r\n}\r\n\r\nfn main() {}\r\n```\r\nOutput:\r\n```\r\nE:\\mega3\\projects\\ice\\ice>cargo build\r\n   Compiling ice v0.1.0 (file:///E:/mega3/projects/ice/ice)\r\nerror: internal compiler error: unexpected panic\r\n\r\nnote: the compiler unexpectedly panicked. this is a bug.\r\n\r\nnote: we would appreciate a bug report: https://github.com/rust-lang/rust/blob/master/CONTRIBUTING.md#bug-reports\r\n\r\nnote: run with `RUST_BACKTRACE=1` for a backtrace\r\n\r\nthread 'rustc' panicked at 'assertion failed: !obligation.predicate.has_escaping_regions()', C:\\bot\\slave\\nightly-dist-rustc-win-msvc-64\\build\\src\\librustc\\traits\\select.rs:409\r\nstack backtrace:\r\n   0:     0x7ffbf9a60d58 - std::panicking::Location::line::ha91c35bc276d0b51\r\n   1:     0x7ffbf9a601e2 - std::panicking::Location::line::ha91c35bc276d0b51\r\n   2:     0x7ffbf9a63c1d - std::panicking::rust_panic_with_hook::hf12525c539cafb95\r\n   3:     0x7ffbf6d12843 - <unknown>\r\n   4:     0x7ffbf6f2236a - rustc::traits::select::SelectionContext::select::h1761016ce8ef2f1e\r\n   5:     0x7ffbf6f1268d - <rustc::traits::fulfill::FulfillProcessor<'a, 'b, 'gcx, 'tcx> as rustc_data_structures::obligation_forest::ObligationProcessor>::process_obligation::h80789c9225e6da16\r\n   6:     0x7ffbf6f104a4 - rustc::traits::fulfill::FulfillmentContext::take_deferred_obligations::h59157437f621c52e\r\n   7:     0x7ffbf6f0fdb7 - rustc::traits::fulfill::FulfillmentContext::select_where_possible::hedb3ea6dfe818e1e\r\n   8:     0x7ffbf783f1a5 - rustc_typeck::check::FnCtxt::field_ty::h387f0899108f3c54\r\n   9:     0x7ffbf7838ea8 - rustc_typeck::check::FnCtxt::resolve_type_vars_with_obligations::h09ff96390f67faf0\r\n  10:     0x7ffbf77de126 - rustc_typeck::check::demand::<impl rustc_typeck::check::FnCtxt<'a, 'gcx, 'tcx>>::demand_coerce::h839b40a8b211aade\r\n  11:     0x7ffbf782ebba - <rustc_typeck::check::GatherLocalsVisitor<'a, 'gcx, 'tcx> as rustc::hir::intravisit::Visitor<'gcx>>::visit_pat::h8fcdbeae3dbc14f2\r\n  12:     0x7ffbf782d4f3 - rustc_typeck::check::check_drop_impls::h632d17e4d693e43d\r\n  13:     0x7ffbf7829db0 - rustc_typeck::check::check_item_bodies::h9a3914a42542ad06\r\n  14:     0x7ffbf78ad7a0 - rustc_typeck::check_crate::h26811b192a872b84\r\n  15:     0x7ffbf9e15c7e - rustc_driver::driver::count_nodes::h80b2ce48c34d37f0\r\n  16:     0x7ffbf9d663c6 - <unknown>\r\n  17:     0x7ffbf9df13f6 - rustc_driver::driver::compile_input::hc2e887bda4c69183\r\n  18:     0x7ffbf9e42dfb - rustc_driver::run_compiler::h94efe000e99b91da\r\n  19:     0x7ffbf9d1efbe - <unknown>\r\n  20:     0x7ffbf9a66c51 - _rust_maybe_catch_panic\r\n  21:     0x7ffbf9d4c806 - <unknown>\r\n  22:     0x7ffbf9a5e1ce - std::sys::imp::thread::Thread::new::hd3ea3fbc2b0bf083\r\n  23:     0x7ffc1abd8363 - BaseThreadInitThunk\r\n\r\nerror: Could not compile `ice`.\r\n\r\nTo learn more, run the command again with --verbose.\r\n```\r\n\r\n## Meta\r\n\r\n```\r\nrustc 1.17.0-nightly (c49d10207 2017-02-07)\r\nbinary: rustc\r\ncommit-hash: c49d10207a7e105525fb3bd71c18fde6fc2f5aed\r\ncommit-date: 2017-02-07\r\nhost: x86_64-pc-windows-msvc\r\nrelease: 1.17.0-nightly\r\nLLVM version: 3.9\r\n```\r\n", "closed_by": {"login": "bors", "id": 3372342, "node_id": "MDQ6VXNlcjMzNzIzNDI=", "avatar_url": "https://avatars.githubusercontent.com/u/3372342?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors", "html_url": "https://github.com/bors", "followers_url": "https://api.github.com/users/bors/followers", "following_url": "https://api.github.com/users/bors/following{/other_user}", "gists_url": "https://api.github.com/users/bors/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors/subscriptions", "organizations_url": "https://api.github.com/users/bors/orgs", "repos_url": "https://api.github.com/users/bors/repos", "events_url": "https://api.github.com/users/bors/events{/privacy}", "received_events_url": "https://api.github.com/users/bors/received_events", "type": "User", "site_admin": false}, "reactions": {"url": "https://api.github.com/repos/rust-lang/rust/issues/39665/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rust-lang/rust/issues/39665/timeline", "performed_via_github_app": null, "state_reason": "completed"}