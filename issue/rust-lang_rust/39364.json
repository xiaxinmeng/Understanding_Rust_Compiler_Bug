{"url": "https://api.github.com/repos/rust-lang/rust/issues/39364", "repository_url": "https://api.github.com/repos/rust-lang/rust", "labels_url": "https://api.github.com/repos/rust-lang/rust/issues/39364/labels{/name}", "comments_url": "https://api.github.com/repos/rust-lang/rust/issues/39364/comments", "events_url": "https://api.github.com/repos/rust-lang/rust/issues/39364/events", "html_url": "https://github.com/rust-lang/rust/issues/39364", "id": 203814226, "node_id": "MDU6SXNzdWUyMDM4MTQyMjY=", "number": 39364, "title": "Panic in Receiver::recv()", "user": {"login": "jamespharaoh", "id": 230005, "node_id": "MDQ6VXNlcjIzMDAwNQ==", "avatar_url": "https://avatars.githubusercontent.com/u/230005?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jamespharaoh", "html_url": "https://github.com/jamespharaoh", "followers_url": "https://api.github.com/users/jamespharaoh/followers", "following_url": "https://api.github.com/users/jamespharaoh/following{/other_user}", "gists_url": "https://api.github.com/users/jamespharaoh/gists{/gist_id}", "starred_url": "https://api.github.com/users/jamespharaoh/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jamespharaoh/subscriptions", "organizations_url": "https://api.github.com/users/jamespharaoh/orgs", "repos_url": "https://api.github.com/users/jamespharaoh/repos", "events_url": "https://api.github.com/users/jamespharaoh/events{/privacy}", "received_events_url": "https://api.github.com/users/jamespharaoh/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 211668062, "node_id": "MDU6TGFiZWwyMTE2NjgwNjI=", "url": "https://api.github.com/repos/rust-lang/rust/labels/T-libs-api", "name": "T-libs-api", "color": "bfd4f2", "default": false, "description": "Relevant to the library API team, which will review and decide on the PR/issue."}, {"id": 650731663, "node_id": "MDU6TGFiZWw2NTA3MzE2NjM=", "url": "https://api.github.com/repos/rust-lang/rust/labels/C-bug", "name": "C-bug", "color": "f5f1fd", "default": false, "description": "Category: This is a bug."}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 61, "created_at": "2017-01-28T15:55:37Z", "updated_at": "2022-11-13T15:02:07Z", "closed_at": "2022-11-13T15:02:07Z", "author_association": "NONE", "active_lock_reason": null, "body": "I'm having a problem using a channel to send notifications to a background thread... As I understand it, this shouldn't be possible? Receiver::recv() is not supposed to panic, is it? I'm not doing anything unsafe...\r\n\r\nMentioned this on [reddit](https://www.reddit.com/r/rust/comments/5qnxmz/panic_in_mpscchannel_receiverrecv/) and [burntsushi](https://www.reddit.com/user/burntsushi) has confirmed that this looks like a bug. I will try and produce some simpler code to reproduce this but don't have time at the moment. (edit - please nag me if i don't produce an example, I have a vague idea what will do it)\r\n\r\nI've tried this with stable (1.14) and nightly and get the same result.\r\n\r\nA copy of the code which generates the error is available here:\r\n\r\nhttps://github.com/jamespharaoh/rust-output/tree/channel_recv_panic\r\n\r\n```\r\nthread '<unnamed>' panicked at 'internal error: entered unreachable code', ../src/libstd/sync/mpsc/mod.rs:879\r\nstack backtrace:\r\n   1:     0x55ab04830c1a - std::sys::imp::backtrace::tracing::imp::write::h917062bce4ff48c3\r\n                        at /buildslave/rust-buildbot/slave/stable-dist-rustc-linux/build/obj/../src/libstd/sys/unix/backtrace/tracing/gcc_s.rs:42\r\n   2:     0x55ab0483672f - std::panicking::default_hook::{{closure}}::h0bacac31b5ed1870\r\n                        at /buildslave/rust-buildbot/slave/stable-dist-rustc-linux/build/obj/../src/libstd/panicking.rs:247\r\n   3:     0x55ab04834666 - std::panicking::default_hook::h5897799da33ece67\r\n                        at /buildslave/rust-buildbot/slave/stable-dist-rustc-linux/build/obj/../src/libstd/panicking.rs:263\r\n   4:     0x55ab04834d17 - std::panicking::rust_panic_with_hook::h109e116a3a861224\r\n                        at /buildslave/rust-buildbot/slave/stable-dist-rustc-linux/build/obj/../src/libstd/panicking.rs:451\r\n   5:     0x55ab045b4d73 - std::panicking::begin_panic::h634e2b37a96f78d4\r\n                        at /buildslave/rust-buildbot/slave/stable-dist-rustc-linux/build/obj/../src/libstd/panicking.rs:413\r\n   6:     0x55ab045b9ce0 - <std::sync::mpsc::Receiver<T>>::recv::h59b94a6df5881f84\r\n                        at /buildslave/rust-buildbot/slave/stable-dist-rustc-linux/build/obj/../src/libstd/macros.rs:44\r\n   7:     0x55ab045e5ff3 - output::output_state::OutputState::background_thread::h8aaba65c8ed499f1\r\n                        at /home/james/projects/storage/rust-output/src/output_state.rs:261\r\n   8:     0x55ab045ea743 - output::output_state::OutputState::new::{{closure}}::hf69a0505c40cdaf3\r\n                        at /home/james/projects/storage/rust-output/src/output_state.rs:79\r\n   9:     0x55ab045dfeda - <std::panic::AssertUnwindSafe<F> as core::ops::FnOnce<()>>::call_once::hb24d824e514ccbad\r\n                        at /buildslave/rust-buildbot/slave/stable-dist-rustc-linux/build/obj/../src/libstd/panic.rs:295\r\n  10:     0x55ab045b53d7 - std::panicking::try::do_call::h3a6460a838b6cf70\r\n                        at /buildslave/rust-buildbot/slave/stable-dist-rustc-linux/build/obj/../src/libstd/panicking.rs:356\r\n  11:     0x55ab0483e20a - __rust_maybe_catch_panic\r\n                        at /buildslave/rust-buildbot/slave/stable-dist-rustc-linux/build/obj/../src/libpanic_unwind/lib.rs:97\r\n  12:     0x55ab045b4eb6 - std::panicking::try::h3133aaaba181f2ff\r\n                        at /buildslave/rust-buildbot/slave/stable-dist-rustc-linux/build/obj/../src/libstd/panicking.rs:332\r\n  13:     0x55ab045b389e - std::panic::catch_unwind::h0d4cf58b5fb1c352\r\n                        at /buildslave/rust-buildbot/slave/stable-dist-rustc-linux/build/obj/../src/libstd/panic.rs:351\r\n  14:     0x55ab045ea000 - std::thread::Builder::spawn::{{closure}}::h4fae90249c97a5c1\r\n                        at /buildslave/rust-buildbot/slave/stable-dist-rustc-linux/build/obj/../src/libstd/thread/mod.rs:287\r\n  15:     0x55ab045ce9fe - <F as alloc::boxed::FnBox<A>>::call_box::hef839d7658cc4ef9\r\n                        at /buildslave/rust-buildbot/slave/stable-dist-rustc-linux/build/obj/../src/liballoc/boxed.rs:595\r\n  16:     0x55ab04833d64 - std::sys::imp::thread::Thread::new::thread_start::ha102a6120fc52763\r\n                        at /buildslave/rust-buildbot/slave/stable-dist-rustc-linux/build/obj/../src/liballoc/boxed.rs:605\r\n                        at /buildslave/rust-buildbot/slave/stable-dist-rustc-linux/build/obj/../src/libstd/sys_common/thread.rs:21\r\n                        at /buildslave/rust-buildbot/slave/stable-dist-rustc-linux/build/obj/../src/libstd/sys/unix/thread.rs:84\r\n  17:     0x7fc0c43506b9 - start_thread\r\n  18:     0x7fc0c3e7082c - clone\r\n  19:                0x0 - <unknown>\r\n```\r\n", "closed_by": {"login": "bors", "id": 3372342, "node_id": "MDQ6VXNlcjMzNzIzNDI=", "avatar_url": "https://avatars.githubusercontent.com/u/3372342?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors", "html_url": "https://github.com/bors", "followers_url": "https://api.github.com/users/bors/followers", "following_url": "https://api.github.com/users/bors/following{/other_user}", "gists_url": "https://api.github.com/users/bors/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors/subscriptions", "organizations_url": "https://api.github.com/users/bors/orgs", "repos_url": "https://api.github.com/users/bors/repos", "events_url": "https://api.github.com/users/bors/events{/privacy}", "received_events_url": "https://api.github.com/users/bors/received_events", "type": "User", "site_admin": false}, "reactions": {"url": "https://api.github.com/repos/rust-lang/rust/issues/39364/reactions", "total_count": 19, "+1": 15, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 4}, "timeline_url": "https://api.github.com/repos/rust-lang/rust/issues/39364/timeline", "performed_via_github_app": null, "state_reason": "completed"}