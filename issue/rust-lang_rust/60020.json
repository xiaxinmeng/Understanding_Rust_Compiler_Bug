{"url": "https://api.github.com/repos/rust-lang/rust/issues/60020", "repository_url": "https://api.github.com/repos/rust-lang/rust", "labels_url": "https://api.github.com/repos/rust-lang/rust/issues/60020/labels{/name}", "comments_url": "https://api.github.com/repos/rust-lang/rust/issues/60020/comments", "events_url": "https://api.github.com/repos/rust-lang/rust/issues/60020/events", "html_url": "https://github.com/rust-lang/rust/issues/60020", "id": 433976137, "node_id": "MDU6SXNzdWU0MzM5NzYxMzc=", "number": 60020, "title": "Rust 1.34 generates significantly less debug information for libstd functions vs. Rust 1.33", "user": {"login": "froydnj", "id": 151096, "node_id": "MDQ6VXNlcjE1MTA5Ng==", "avatar_url": "https://avatars.githubusercontent.com/u/151096?v=4", "gravatar_id": "", "url": "https://api.github.com/users/froydnj", "html_url": "https://github.com/froydnj", "followers_url": "https://api.github.com/users/froydnj/followers", "following_url": "https://api.github.com/users/froydnj/following{/other_user}", "gists_url": "https://api.github.com/users/froydnj/gists{/gist_id}", "starred_url": "https://api.github.com/users/froydnj/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/froydnj/subscriptions", "organizations_url": "https://api.github.com/users/froydnj/orgs", "repos_url": "https://api.github.com/users/froydnj/repos", "events_url": "https://api.github.com/users/froydnj/events{/privacy}", "received_events_url": "https://api.github.com/users/froydnj/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 203130, "node_id": "MDU6TGFiZWwyMDMxMzA=", "url": "https://api.github.com/repos/rust-lang/rust/labels/A-debuginfo", "name": "A-debuginfo", "color": "f7e101", "default": false, "description": "Area: Debugging information in compiled programs (DWARF, PDB, etc.)"}, {"id": 203429200, "node_id": "MDU6TGFiZWwyMDM0MjkyMDA=", "url": "https://api.github.com/repos/rust-lang/rust/labels/P-high", "name": "P-high", "color": "eb6420", "default": false, "description": "High priority"}, {"id": 211668100, "node_id": "MDU6TGFiZWwyMTE2NjgxMDA=", "url": "https://api.github.com/repos/rust-lang/rust/labels/T-compiler", "name": "T-compiler", "color": "bfd4f2", "default": false, "description": "Relevant to the compiler team, which will review and decide on the PR/issue."}, {"id": 262252840, "node_id": "MDU6TGFiZWwyNjIyNTI4NDA=", "url": "https://api.github.com/repos/rust-lang/rust/labels/regression-from-stable-to-stable", "name": "regression-from-stable-to-stable", "color": "e4008a", "default": false, "description": "Performance or correctness regression from one stable version to another."}], "state": "closed", "locked": false, "assignee": {"login": "michaelwoerister", "id": 1825894, "node_id": "MDQ6VXNlcjE4MjU4OTQ=", "avatar_url": "https://avatars.githubusercontent.com/u/1825894?v=4", "gravatar_id": "", "url": "https://api.github.com/users/michaelwoerister", "html_url": "https://github.com/michaelwoerister", "followers_url": "https://api.github.com/users/michaelwoerister/followers", "following_url": "https://api.github.com/users/michaelwoerister/following{/other_user}", "gists_url": "https://api.github.com/users/michaelwoerister/gists{/gist_id}", "starred_url": "https://api.github.com/users/michaelwoerister/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/michaelwoerister/subscriptions", "organizations_url": "https://api.github.com/users/michaelwoerister/orgs", "repos_url": "https://api.github.com/users/michaelwoerister/repos", "events_url": "https://api.github.com/users/michaelwoerister/events{/privacy}", "received_events_url": "https://api.github.com/users/michaelwoerister/received_events", "type": "User", "site_admin": false}, "assignees": [{"login": "michaelwoerister", "id": 1825894, "node_id": "MDQ6VXNlcjE4MjU4OTQ=", "avatar_url": "https://avatars.githubusercontent.com/u/1825894?v=4", "gravatar_id": "", "url": "https://api.github.com/users/michaelwoerister", "html_url": "https://github.com/michaelwoerister", "followers_url": "https://api.github.com/users/michaelwoerister/followers", "following_url": "https://api.github.com/users/michaelwoerister/following{/other_user}", "gists_url": "https://api.github.com/users/michaelwoerister/gists{/gist_id}", "starred_url": "https://api.github.com/users/michaelwoerister/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/michaelwoerister/subscriptions", "organizations_url": "https://api.github.com/users/michaelwoerister/orgs", "repos_url": "https://api.github.com/users/michaelwoerister/repos", "events_url": "https://api.github.com/users/michaelwoerister/events{/privacy}", "received_events_url": "https://api.github.com/users/michaelwoerister/received_events", "type": "User", "site_admin": false}], "milestone": null, "comments": 23, "created_at": "2019-04-16T20:43:43Z", "updated_at": "2019-09-12T13:04:04Z", "closed_at": "2019-09-12T13:04:04Z", "author_association": "CONTRIBUTOR", "active_lock_reason": null, "body": "A Firefox developer filed [a bug report](https://bugzilla.mozilla.org/show_bug.cgi?id=1544416) about Rust symbols not being correctly represented in crash reports:\r\n\r\n```\r\n0 \tXUL \tGeckoCrash \ttoolkit/xre/nsAppRunner.cpp:5093 \tcontext\r\n1 \tXUL \tgkrust_shared::panic_hook \ttoolkit/library/rust/shared/lib.rs:240 \tframe_pointer\r\n2 \tXUL \tcore::ops::function::Fn::call \tsrc/libcore/ops/function.rs:69 \tcfi\r\n3 \tXUL \trust_panic_with_hook \tsrc/libstd/panicking.rs:482 \tcfi\r\n4 \tXUL \tcontinue_panic_fmt \tsrc/libstd/panicking.rs:385 \tcfi\r\n5 \tXUL \trust_begin_panic \tsrc/libstd/panicking.rs:312 \tcfi\r\n6 \tXUL \tpanic_fmt \tsrc/libcore/panicking.rs:85 \tcfi\r\n7 \tXUL \tpanic \tsrc/libcore/panicking.rs:49 \tcfi\r\n```\r\n\r\nThe expectation was that, e.g. `rust_panic_with_hook` would have been `std::panicking::rust_panic_with_hook`.\r\n\r\nWe had recently upgraded to Rust 1.34, which led to comparing object files before and after the upgrade.  I compared Linux x86-64 binaries; I don't see why the analysis doesn't apply to OS X's Mach-O files, but it's possible the results are different there.  (The above crash is from OS X, and we have crashes using Rust 1.33 that do display `std::panicking::rust_panic_with_hook` and similar.)  The ELF symbol table in both cases lists `rust_panic_with_hook` as `_ZN3std9panicking20rust_panic_with_hook$UNIQUE_ID`, so that wasn't the problem.\r\n\r\nWe then looked at the debug information.  Rust 1.33 generated, according to `readelf --debug-dump=info`:\r\n\r\n```\r\n <3><2155a724>: Abbrev Number: 301 (DW_TAG_subprogram)\r\n    <2155a726>   DW_AT_low_pc      : 0x5738510\r\n    <2155a72a>   DW_AT_high_pc     : 0x6b2\r\n    <2155a72e>   DW_AT_frame_base  : 1 byte block: 54 \t(DW_OP_reg4 (esp))\r\n    <2155a730>   DW_AT_linkage_name: (indirect string, offset: 0x9d7fc09): _ZN3std9panicking20rust_panic_with_hook17he447c38467745511E\r\n    <2155a734>   DW_AT_name        : (indirect string, offset: 0x9d7fc45): rust_panic_with_hook\r\n    <2155a738>   DW_AT_decl_file   : 11\r\n    <2155a739>   DW_AT_decl_line   : 447\r\n    <2155a73b>   DW_AT_external    : 1\r\n    <2155a73b>   DW_AT_noreturn    : 1\r\n```\r\n\r\nNotice the existence of both `DW_AT_name` and `DW_AT_linkage_name`.  Rust 1.34, in contrast, generated:\r\n\r\n```\r\n <1><216d7afa>: Abbrev Number: 293 (DW_TAG_subprogram)\r\n    <216d7afc>   DW_AT_low_pc      : 0x5734990\r\n    <216d7b00>   DW_AT_high_pc     : 0x6ae\r\n    <216d7b04>   DW_AT_name        : (indirect string, offset: 0x9db1282): rust_panic_with_hook\r\n```\r\n\r\nwhich drops the `DW_AT_linkage_name` and is also significantly less informative than its predecessor.\r\n\r\nI'm not familiar enough with `rustc` to know what might have caused this regression.  One of my colleagues pointed out #58208, which changed how various bits of panic infrastructure are imported into `libstd`.  It's not clear to me whether it's that specific change, or how the compiler internally describes `crate::` symbols to LLVM, or something else entirely.\r\n\r\ncc @glandium @michaelwoerister ", "closed_by": {"login": "michaelwoerister", "id": 1825894, "node_id": "MDQ6VXNlcjE4MjU4OTQ=", "avatar_url": "https://avatars.githubusercontent.com/u/1825894?v=4", "gravatar_id": "", "url": "https://api.github.com/users/michaelwoerister", "html_url": "https://github.com/michaelwoerister", "followers_url": "https://api.github.com/users/michaelwoerister/followers", "following_url": "https://api.github.com/users/michaelwoerister/following{/other_user}", "gists_url": "https://api.github.com/users/michaelwoerister/gists{/gist_id}", "starred_url": "https://api.github.com/users/michaelwoerister/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/michaelwoerister/subscriptions", "organizations_url": "https://api.github.com/users/michaelwoerister/orgs", "repos_url": "https://api.github.com/users/michaelwoerister/repos", "events_url": "https://api.github.com/users/michaelwoerister/events{/privacy}", "received_events_url": "https://api.github.com/users/michaelwoerister/received_events", "type": "User", "site_admin": false}, "reactions": {"url": "https://api.github.com/repos/rust-lang/rust/issues/60020/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rust-lang/rust/issues/60020/timeline", "performed_via_github_app": null, "state_reason": "completed"}