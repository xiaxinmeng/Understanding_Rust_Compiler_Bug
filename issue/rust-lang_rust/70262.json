{"url": "https://api.github.com/repos/rust-lang/rust/issues/70262", "repository_url": "https://api.github.com/repos/rust-lang/rust", "labels_url": "https://api.github.com/repos/rust-lang/rust/issues/70262/labels{/name}", "comments_url": "https://api.github.com/repos/rust-lang/rust/issues/70262/comments", "events_url": "https://api.github.com/repos/rust-lang/rust/issues/70262/events", "html_url": "https://github.com/rust-lang/rust/issues/70262", "id": 585667334, "node_id": "MDU6SXNzdWU1ODU2NjczMzQ=", "number": 70262, "title": "HRTBs: lifetime \"does not appear in the trait input types\"", "user": {"login": "comex", "id": 47517, "node_id": "MDQ6VXNlcjQ3NTE3", "avatar_url": "https://avatars.githubusercontent.com/u/47517?v=4", "gravatar_id": "", "url": "https://api.github.com/users/comex", "html_url": "https://github.com/comex", "followers_url": "https://api.github.com/users/comex/followers", "following_url": "https://api.github.com/users/comex/following{/other_user}", "gists_url": "https://api.github.com/users/comex/gists{/gist_id}", "starred_url": "https://api.github.com/users/comex/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/comex/subscriptions", "organizations_url": "https://api.github.com/users/comex/orgs", "repos_url": "https://api.github.com/users/comex/repos", "events_url": "https://api.github.com/users/comex/events{/privacy}", "received_events_url": "https://api.github.com/users/comex/received_events", "type": "User", "site_admin": false}, "labels": [], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 1, "created_at": "2020-03-22T08:14:45Z", "updated_at": "2020-03-22T08:29:26Z", "closed_at": "2020-03-22T08:29:26Z", "author_association": "CONTRIBUTOR", "active_lock_reason": null, "body": "Consider this code:\r\n```rust\r\n#![feature(unboxed_closures)]\r\nfn foo<F>(f: F) where\r\n    for<'a> F: FnOnce<&'a i32>,\r\n    for<'a> <F as FnOnce<&'a i32>>::Output: Iterator<Item=&'a i64> {}\r\n```\r\nThe bound is intended to match functions roughly of the form\r\n```rust\r\nfn callback<'a>(x: &'a i32) -> impl Iterator<Item=&'a i64> { ... }\r\n```\r\nHowever, rustc rejects `foo` with this error:\r\n```\r\nerror[E0582]: binding for associated type `Item` references lifetime `'a`, which does not appear in the trait input types\r\n --> src/lib.rs:4:54\r\n  |\r\n4 |     for<'a> <F as FnOnce<&'a i32>>::Output: Iterator<Item=&'a i64> {}\r\n  |                                                      ^^^^^^^^^^^^\r\n```\r\n\r\nThe `rustc --explain` output points to issue #33685, which had to do with declarations where a lifetime appeared in a function's return type and nowhere else, like:\r\n```rust\r\nfn foo<'a>() -> &'a u32 { .. }\r\n```\r\nIn that issue, @nikomatsakis wrote:\r\n> These constructs are being rejected as part of the fix for issue #32330. This is a soundness bug that concerns cases like these.\r\n> [..]\r\n> These sorts of where-clauses and types are not only ill-formed, they are useless. For example, now that #32330 is fixed, there are no types that could satisfy such a where-clause, nor are there any functions with a type like `for<'a> fn() -> &'a i32` (see next section for more details).\r\n> [..]\r\n> The crux of the problem concerns lifetime parameters that only appear in the return type of a fn declaration -- these are changing to no longer be considered \"higher-ranked\" (or \"late-bound\").\r\n\r\nMy example is different, though, in that the lifetime does appear in the function's arguments.  Thus, while I don't know whether allowing the bound would implicate the same soundness issue, I'm pretty sure the bound is not useless: it seems like it should be possible to satisfy.", "closed_by": {"login": "comex", "id": 47517, "node_id": "MDQ6VXNlcjQ3NTE3", "avatar_url": "https://avatars.githubusercontent.com/u/47517?v=4", "gravatar_id": "", "url": "https://api.github.com/users/comex", "html_url": "https://github.com/comex", "followers_url": "https://api.github.com/users/comex/followers", "following_url": "https://api.github.com/users/comex/following{/other_user}", "gists_url": "https://api.github.com/users/comex/gists{/gist_id}", "starred_url": "https://api.github.com/users/comex/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/comex/subscriptions", "organizations_url": "https://api.github.com/users/comex/orgs", "repos_url": "https://api.github.com/users/comex/repos", "events_url": "https://api.github.com/users/comex/events{/privacy}", "received_events_url": "https://api.github.com/users/comex/received_events", "type": "User", "site_admin": false}, "reactions": {"url": "https://api.github.com/repos/rust-lang/rust/issues/70262/reactions", "total_count": 2, "+1": 2, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rust-lang/rust/issues/70262/timeline", "performed_via_github_app": null, "state_reason": "completed"}