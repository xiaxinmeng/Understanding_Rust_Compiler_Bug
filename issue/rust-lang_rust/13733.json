{"url": "https://api.github.com/repos/rust-lang/rust/issues/13733", "repository_url": "https://api.github.com/repos/rust-lang/rust", "labels_url": "https://api.github.com/repos/rust-lang/rust/issues/13733/labels{/name}", "comments_url": "https://api.github.com/repos/rust-lang/rust/issues/13733/comments", "events_url": "https://api.github.com/repos/rust-lang/rust/issues/13733/events", "html_url": "https://github.com/rust-lang/rust/issues/13733", "id": 32175652, "node_id": "MDU6SXNzdWUzMjE3NTY1Mg==", "number": 13733, "title": "Cannot link to third-party Rust libraries in the same prefix `rustc` was installed to", "user": {"login": "ghost", "id": 10137, "node_id": "MDQ6VXNlcjEwMTM3", "avatar_url": "https://avatars.githubusercontent.com/u/10137?v=4", "gravatar_id": "", "url": "https://api.github.com/users/ghost", "html_url": "https://github.com/ghost", "followers_url": "https://api.github.com/users/ghost/followers", "following_url": "https://api.github.com/users/ghost/following{/other_user}", "gists_url": "https://api.github.com/users/ghost/gists{/gist_id}", "starred_url": "https://api.github.com/users/ghost/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/ghost/subscriptions", "organizations_url": "https://api.github.com/users/ghost/orgs", "repos_url": "https://api.github.com/users/ghost/repos", "events_url": "https://api.github.com/users/ghost/events{/privacy}", "received_events_url": "https://api.github.com/users/ghost/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 60329014, "node_id": "MDU6TGFiZWw2MDMyOTAxNA==", "url": "https://api.github.com/repos/rust-lang/rust/labels/P-low", "name": "P-low", "color": "eb6420", "default": false, "description": "Low priority"}, {"id": 602425123, "node_id": "MDU6TGFiZWw2MDI0MjUxMjM=", "url": "https://api.github.com/repos/rust-lang/rust/labels/T-dev-tools", "name": "T-dev-tools", "color": "bfd4f2", "default": false, "description": "Relevant to the dev-tools subteam, which will review and decide on the PR/issue."}, {"id": 650731663, "node_id": "MDU6TGFiZWw2NTA3MzE2NjM=", "url": "https://api.github.com/repos/rust-lang/rust/labels/C-bug", "name": "C-bug", "color": "f5f1fd", "default": false, "description": "Category: This is a bug."}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 26, "created_at": "2014-04-24T18:55:45Z", "updated_at": "2018-07-28T18:48:11Z", "closed_at": "2018-07-28T18:48:11Z", "author_association": "NONE", "active_lock_reason": null, "body": "I'm working on a repository for the Paludis package manager, and Rust has trouble with the standard system paths.\n\n```\n<snip for clarity>\nroot@jurily ~# cave contents dev-rust/sdl\n/usr/lib64/libsdl-e351513a-0.3.2.so\n\nroot@jurily ~# cave contents dev-lang/rust\n/usr/lib64/rustlib/x86_64-unknown-linux-gnu/lib/liblibc-3574b280-0.11-pre.so\n/usr/lib64/rustlib/x86_64-unknown-linux-gnu/lib/libstd-aad93cea-0.11-pre.so\n/usr/lib64/liblibc-3574b280-0.11-pre.so\n/usr/lib64/libstd-aad93cea-0.11-pre.so\n```\n\nWith standard invocation:\n\n```\nrustc --opt-level=3 --out-dir /var/tmp/paludis/build/dev-rust-sprocketnes-scm/work/sprocketnes-scm -L /var/tmp/paludis/build/dev-rust-sprocketnes-scm/work/sprocketnes-scm nes.rs\nnes.rs:11:1: 11:18 error: can't find crate for `sdl`\nnes.rs:11 extern crate sdl;\n          ^~~~~~~~~~~~~~~~~\n```\n\nSo then I had the wonderful idea to feed it `$LDPATH` manually:\n\n``` sh\nerustc () { # happy fun times\n    OIFS=\"$IFS\"\n    IFS=\":\"\n    local LDHACK=\"\"\n    local LDTOKENS=\"\"\n    read -a LDTOKENS <<< \"${LDPATH}\"\n    for i in \"${LDTOKENS[@]}\"; do\n        LDHACK=\"$LDHACK -L $i\"\n    done\n\n    IFS=\"$OIFS\"\n    edo rustc --opt-level=3 --out-dir \"${WORK}\" -L \"${WORK}\" \"${@}\" ${LDHACK}\n}\n```\n\n---\n\n```\nrustc --opt-level=3 --out-dir /var/tmp/paludis/build/dev-rust-sprocketnes-scm/work/sprocketnes-scm -L /var/tmp/paludis/build/dev-rust-sprocketnes-scm/work/sprocketnes-scm nes.rs -L /usr/local/lib -L /usr/lib64 -L /lib64 -L /usr/lib64/nss -L /usr/lib64/qt4 -L /usr/lib64/mysql -L /usr/lib64/xulrunner\nnes.rs:1:1: 1:1 error: multiple dylib candidates for `std` found\nnes.rs:1 //\n         ^\nnes.rs:1:1: 1:1 note: candidate #1: /usr/lib64/rustlib/x86_64-unknown-linux-gnu/lib/libstd-aad93cea-0.11-pre.so\nnes.rs:1 //\n         ^\nnes.rs:1:1: 1:1 note: candidate #2: /usr/lib64/libstd-aad93cea-0.11-pre.so\nnes.rs:1 //\n         ^\nnes.rs:1:1: 1:1 error: multiple dylib candidates for `libc` found\nnes.rs:1 //\n         ^\nnes.rs:1:1: 1:1 note: candidate #1: /usr/lib64/liblibc-3574b280-0.11-pre.so\nnes.rs:1 //\n         ^\nnes.rs:1:1: 1:1 note: candidate #2: /usr/lib64/rustlib/x86_64-unknown-linux-gnu/lib/liblibc-3574b280-0.11-pre.so\nnes.rs:1 //\n```\n\nLose-lose. I assume there are valid reasons for this, but it's still confusing:\n1. Why are there multiple _shared_ libraries installed? If `rustc` needs its own set, wouldn't it make sense to link them statically?\n2. Why can't `rustc` figure out which one to use?\n3. Would it actually make a difference? They're the same version, right down to the hash.\n4. If I put everything next to the \"good\" libstd, will it keep working? Can I count on that path to not change?\n\nI could use a completely different directory of course, but that's an ugly workaround and would likely hurt upstream chances.\n", "closed_by": {"login": "steveklabnik", "id": 27786, "node_id": "MDQ6VXNlcjI3Nzg2", "avatar_url": "https://avatars.githubusercontent.com/u/27786?v=4", "gravatar_id": "", "url": "https://api.github.com/users/steveklabnik", "html_url": "https://github.com/steveklabnik", "followers_url": "https://api.github.com/users/steveklabnik/followers", "following_url": "https://api.github.com/users/steveklabnik/following{/other_user}", "gists_url": "https://api.github.com/users/steveklabnik/gists{/gist_id}", "starred_url": "https://api.github.com/users/steveklabnik/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/steveklabnik/subscriptions", "organizations_url": "https://api.github.com/users/steveklabnik/orgs", "repos_url": "https://api.github.com/users/steveklabnik/repos", "events_url": "https://api.github.com/users/steveklabnik/events{/privacy}", "received_events_url": "https://api.github.com/users/steveklabnik/received_events", "type": "User", "site_admin": false}, "reactions": {"url": "https://api.github.com/repos/rust-lang/rust/issues/13733/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rust-lang/rust/issues/13733/timeline", "performed_via_github_app": null, "state_reason": "completed"}