{"url": "https://api.github.com/repos/rust-lang/rust/issues/60875", "repository_url": "https://api.github.com/repos/rust-lang/rust", "labels_url": "https://api.github.com/repos/rust-lang/rust/issues/60875/labels{/name}", "comments_url": "https://api.github.com/repos/rust-lang/rust/issues/60875/comments", "events_url": "https://api.github.com/repos/rust-lang/rust/issues/60875/events", "html_url": "https://github.com/rust-lang/rust/issues/60875", "id": 444762031, "node_id": "MDU6SXNzdWU0NDQ3NjIwMzE=", "number": 60875, "title": "type lacking clone on container has misleading/incorrect error message", "user": {"login": "m4b", "id": 1920204, "node_id": "MDQ6VXNlcjE5MjAyMDQ=", "avatar_url": "https://avatars.githubusercontent.com/u/1920204?v=4", "gravatar_id": "", "url": "https://api.github.com/users/m4b", "html_url": "https://github.com/m4b", "followers_url": "https://api.github.com/users/m4b/followers", "following_url": "https://api.github.com/users/m4b/following{/other_user}", "gists_url": "https://api.github.com/users/m4b/gists{/gist_id}", "starred_url": "https://api.github.com/users/m4b/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/m4b/subscriptions", "organizations_url": "https://api.github.com/users/m4b/orgs", "repos_url": "https://api.github.com/users/m4b/repos", "events_url": "https://api.github.com/users/m4b/events{/privacy}", "received_events_url": "https://api.github.com/users/m4b/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 235791, "node_id": "MDU6TGFiZWwyMzU3OTE=", "url": "https://api.github.com/repos/rust-lang/rust/labels/A-diagnostics", "name": "A-diagnostics", "color": "f7e101", "default": false, "description": "Area: Messages for errors, warnings, and lints"}, {"id": 211668100, "node_id": "MDU6TGFiZWwyMTE2NjgxMDA=", "url": "https://api.github.com/repos/rust-lang/rust/labels/T-compiler", "name": "T-compiler", "color": "bfd4f2", "default": false, "description": "Relevant to the compiler team, which will review and decide on the PR/issue."}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 2, "created_at": "2019-05-16T05:34:27Z", "updated_at": "2019-05-17T01:10:59Z", "closed_at": "2019-05-17T01:10:59Z", "author_association": "CONTRIBUTOR", "active_lock_reason": null, "body": "Consider:\r\n```rust\r\nuse std::collections::HashMap;\r\n\r\n#[derive(Clone, Debug)]\r\nstruct Foo;\r\n\r\n#[derive(Debug)]\r\nstruct Bar;\r\n\r\ntype H = HashMap<String, Vec<(Foo, Bar)>>;\r\n\r\nfn wat(h: &H) -> H {\r\n    let h: H = h.clone();\r\n    h\r\n}\r\n\r\nfn main() {\r\n    let h = H::new();\r\n    println!(\"{:?}\", wat(&h));\r\n}\r\n```\r\nThis reports:\r\n```error[E0308]: mismatched types\r\n  --> src/main.rs:12:16\r\n   |\r\n12 |     let h: H = h.clone();\r\n   |                ^^^^^^^^^ expected struct `std::collections::HashMap`, found reference\r\n   |\r\n   = note: expected type `std::collections::HashMap<std::string::String, std::vec::Vec<(Foo, Bar)>>`\r\n              found type `&std::collections::HashMap<std::string::String, std::vec::Vec<(Foo, Bar)>>`\r\n\r\nerror: aborting due to previous error\r\n```\r\nThis is extremely misleading at best (I would expect it to effectively say that one or more types did not implement clone), and debatebly, miscompilation at worst.\r\n\r\nI don't want to really argue about the latter, but opening this here so maybe the diagnostics could be improved since I don't think its controversial to say this is really, really misleading, and having programmed for about 3ish years now, I was caught off-guard by this and lost about 20 minutes unncessarily...", "closed_by": {"login": "estebank", "id": 1606434, "node_id": "MDQ6VXNlcjE2MDY0MzQ=", "avatar_url": "https://avatars.githubusercontent.com/u/1606434?v=4", "gravatar_id": "", "url": "https://api.github.com/users/estebank", "html_url": "https://github.com/estebank", "followers_url": "https://api.github.com/users/estebank/followers", "following_url": "https://api.github.com/users/estebank/following{/other_user}", "gists_url": "https://api.github.com/users/estebank/gists{/gist_id}", "starred_url": "https://api.github.com/users/estebank/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/estebank/subscriptions", "organizations_url": "https://api.github.com/users/estebank/orgs", "repos_url": "https://api.github.com/users/estebank/repos", "events_url": "https://api.github.com/users/estebank/events{/privacy}", "received_events_url": "https://api.github.com/users/estebank/received_events", "type": "User", "site_admin": false}, "reactions": {"url": "https://api.github.com/repos/rust-lang/rust/issues/60875/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rust-lang/rust/issues/60875/timeline", "performed_via_github_app": null, "state_reason": "completed"}