{"url": "https://api.github.com/repos/rust-lang/rust/issues/78406", "repository_url": "https://api.github.com/repos/rust-lang/rust", "labels_url": "https://api.github.com/repos/rust-lang/rust/issues/78406/labels{/name}", "comments_url": "https://api.github.com/repos/rust-lang/rust/issues/78406/comments", "events_url": "https://api.github.com/repos/rust-lang/rust/issues/78406/events", "html_url": "https://github.com/rust-lang/rust/issues/78406", "id": 729820666, "node_id": "MDU6SXNzdWU3Mjk4MjA2NjY=", "number": 78406, "title": "rust build of 1.47.0: rustdoc fails when cross-building for NetBSD/sparc64", "user": {"login": "he32", "id": 1199501, "node_id": "MDQ6VXNlcjExOTk1MDE=", "avatar_url": "https://avatars.githubusercontent.com/u/1199501?v=4", "gravatar_id": "", "url": "https://api.github.com/users/he32", "html_url": "https://github.com/he32", "followers_url": "https://api.github.com/users/he32/followers", "following_url": "https://api.github.com/users/he32/following{/other_user}", "gists_url": "https://api.github.com/users/he32/gists{/gist_id}", "starred_url": "https://api.github.com/users/he32/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/he32/subscriptions", "organizations_url": "https://api.github.com/users/he32/orgs", "repos_url": "https://api.github.com/users/he32/repos", "events_url": "https://api.github.com/users/he32/events{/privacy}", "received_events_url": "https://api.github.com/users/he32/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 36996, "node_id": "MDU6TGFiZWwzNjk5Ng==", "url": "https://api.github.com/repos/rust-lang/rust/labels/E-easy", "name": "E-easy", "color": "02e10c", "default": false, "description": "Call for participation: Experience needed to fix: Easy / not much (good first issue)"}, {"id": 67766349, "node_id": "MDU6TGFiZWw2Nzc2NjM0OQ==", "url": "https://api.github.com/repos/rust-lang/rust/labels/E-mentor", "name": "E-mentor", "color": "02E10C", "default": false, "description": "Call for participation: This issue has a mentor. Use RustcContributor::new on Zulip for discussion."}, {"id": 167285428, "node_id": "MDU6TGFiZWwxNjcyODU0Mjg=", "url": "https://api.github.com/repos/rust-lang/rust/labels/A-cross", "name": "A-cross", "color": "f7e101", "default": false, "description": "Area: Cross compilation"}, {"id": 211668062, "node_id": "MDU6TGFiZWwyMTE2NjgwNjI=", "url": "https://api.github.com/repos/rust-lang/rust/labels/T-libs-api", "name": "T-libs-api", "color": "bfd4f2", "default": false, "description": "Relevant to the library API team, which will review and decide on the PR/issue."}, {"id": 311417590, "node_id": "MDU6TGFiZWwzMTE0MTc1OTA=", "url": "https://api.github.com/repos/rust-lang/rust/labels/O-netbsd", "name": "O-netbsd", "color": "6e6ec0", "default": false, "description": "Operating system: NetBSD"}, {"id": 650731663, "node_id": "MDU6TGFiZWw2NTA3MzE2NjM=", "url": "https://api.github.com/repos/rust-lang/rust/labels/C-bug", "name": "C-bug", "color": "f5f1fd", "default": false, "description": "Category: This is a bug."}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 10, "created_at": "2020-10-26T18:51:32Z", "updated_at": "2020-10-28T21:08:47Z", "closed_at": "2020-10-28T20:58:49Z", "author_association": "CONTRIBUTOR", "active_lock_reason": null, "body": "<!--\r\nThank you for filing a bug report! \ud83d\udc1b Please provide a short summary of the bug,\r\nalong with any information you feel relevant to replicating the bug.\r\n-->\r\n\r\nWhile building for NetBSD/sparc64 with NetBSD/amd64 as host, I reproducibly encounter this error:\r\n\r\n```\r\n Documenting std v0.0.0 (/usr/pkgsrc/lang/rust/work/rustc-1.47.0-src/library/std)\r\nerror: `crate::os::linux::raw::stat` is both a struct and a function\r\n  --> library/std/src/os/linux/fs.rs:21:19\r\n   |\r\n21 |     /// [`stat`]: crate::os::linux::raw::stat\r\n   |                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^ ambiguous link\r\n   |\r\n   = note: `-D broken-intra-doc-links` implied by `-D warnings`\r\nhelp: to link to the struct, prefix with the item type\r\n   |\r\n21 |     /// [`stat`]: struct@crate::os::linux::raw::stat\r\n   |                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\r\nhelp: to link to the function, add parentheses\r\n   |\r\n21 |     /// [`stat`]: crate::os::linux::raw::stat()\r\n   |                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\r\n\r\nerror: aborting due to previous error\r\n\r\nerror: Could not document `std`.\r\n```\r\n\r\n...and since this is an error, the whole build fails.  Trying to append `()` to the\r\nstring as suggested just produces another error, so is obviously not the right thing to do.\r\n\r\nOddly, when building natively on NetBSD/amd64, this error is not flagged.\r\nAlso, when cross-building for NetBSD/macppc or NetBSD/armv7 on NetBSD/amd64,\r\nthis error is also not flagged.\r\n\r\nI expected to see the build complete without errors; 1.46.0 certainly did.\r\n\r\nYes, we carry a number of patches to rust in pkgsrc, not all of them up-streamable...\r\n\r\nStill, hints for what might be the root cause of this failure are most welcome,\r\nor how I might work around this issue.\r\n\r\nIt seems odd that it's complaining about what on the face of it appears to be a \r\nLinux-specific function when this isn't run on or being built for Linux...\r\n\r\n### Meta\r\n<!--\r\nIf you're using the stable version of the compiler, you should also check if the\r\nbug also exists in the beta or nightly versions.\r\n-->\r\n\r\n`rustc --version --verbose`:\r\n```\r\nrustc 1.46.0 (04488afe3 2020-08-24)\r\nbinary: rustc\r\ncommit-hash: 04488afe34512aa4c33566eb16d8c912a3ae04f9\r\ncommit-date: 2020-08-24\r\nhost: x86_64-unknown-netbsd\r\nrelease: 1.46.0\r\nLLVM version: 10.0\r\n```\r\n\r\n(That's the bootstrap version used.)\r\n\r\n<!--\r\nInclude a backtrace in the code block by setting `RUST_BACKTRACE=1` in your\r\nenvironment. E.g. `RUST_BACKTRACE=1 cargo build`.\r\n-->\r\n<details><summary>Backtrace</summary>\r\n<p>\r\n\r\n```\r\nCaused by:\r\n  process didn't exit successfully: `/usr/pkgsrc/lang/rust/work/rustc-1.47.0-src/build/bootstrap/debug/rustdoc --edition=2018 --crate-type dylib --crate-type rlib --crate-name std library/std/src/lib.rs --target sparc64-unknown-netbsd -o /usr/pkgsrc/lang/rust/work/rustc-1.47.0-src/build/x86_64-unknown-netbsd/stage2-std/sparc64-unknown-netbsd/doc --cfg 'feature=\"addr2line\"' --cfg 'feature=\"backtrace\"' --cfg 'feature=\"compiler-builtins-c\"' --cfg 'feature=\"gimli-symbolize\"' --cfg 'feature=\"miniz_oxide\"' --cfg 'feature=\"object\"' --cfg 'feature=\"panic_unwind\"' --cfg 'feature=\"std_detect_dlsym_getauxval\"' --cfg 'feature=\"std_detect_file_io\"' --error-format=json --json=diagnostic-rendered-ansi --markdown-css rust.css --markdown-no-toc -Z unstable-options --resource-suffix 1.47.0 --index-page /usr/pkgsrc/lang/rust/work/rustc-1.47.0-src/src/doc/index.md -L dependency=/usr/pkgsrc/lang/rust/work/rustc-1.47.0-src/build/x86_64-unknown-netbsd/stage2-std/sparc64-unknown-netbsd/release/deps -L dependency=/usr/pkgsrc/lang/rust/work/rustc-1.47.0-src/build/x86_64-unknown-netbsd/stage2-std/release/deps --extern addr2line=/usr/pkgsrc/lang/rust/work/rustc-1.47.0-src/build/x86_64-unknown-netbsd/stage2-std/sparc64-unknown-netbsd/release/deps/libaddr2line-03cb55b7425d7dbb.rmeta --extern alloc=/usr/pkgsrc/lang/rust/work/rustc-1.47.0-src/build/x86_64-unknown-netbsd/stage2-std/sparc64-unknown-netbsd/release/deps/liballoc-455bc16b9b6b4424.rmeta --extern cfg_if=/usr/pkgsrc/lang/rust/work/rustc-1.47.0-src/build/x86_64-unknown-netbsd/stage2-std/sparc64-unknown-netbsd/release/deps/libcfg_if-7fc54f1c23911eb1.rmeta --extern compiler_builtins=/usr/pkgsrc/lang/rust/work/rustc-1.47.0-src/build/x86_64-unknown-netbsd/stage2-std/sparc64-unknown-netbsd/release/deps/libcompiler_builtins-317780efb78c97c5.rmeta --extern core=/usr/pkgsrc/lang/rust/work/rustc-1.47.0-src/build/x86_64-unknown-netbsd/stage2-std/sparc64-unknown-netbsd/release/deps/libcore-0f5f9e2fc8fc9f24.rmeta --extern hashbrown=/usr/pkgsrc/lang/rust/work/rustc-1.47.0-src/build/x86_64-unknown-netbsd/stage2-std/sparc64-unknown-netbsd/release/deps/libhashbrown-943e711081285abb.rmeta --extern libc=/usr/pkgsrc/lang/rust/work/rustc-1.47.0-src/build/x86_64-unknown-netbsd/stage2-std/sparc64-unknown-netbsd/release/deps/liblibc-3b8680b5a3769d54.rmeta --extern miniz_oxide=/usr/pkgsrc/lang/rust/work/rustc-1.47.0-src/build/x86_64-unknown-netbsd/stage2-std/sparc64-unknown-netbsd/release/deps/libminiz_oxide-3fbd2f81c64e7314.rmeta --extern object=/usr/pkgsrc/lang/rust/work/rustc-1.47.0-src/build/x86_64-unknown-netbsd/stage2-std/sparc64-unknown-netbsd/release/deps/libobject-b55e8f81947c9d81.rmeta --extern panic_abort=/usr/pkgsrc/lang/rust/work/rustc-1.47.0-src/build/x86_64-unknown-netbsd/stage2-std/sparc64-unknown-netbsd/release/deps/libpanic_abort-83aafb0d29c77dec.rmeta --extern panic_unwind=/usr/pkgsrc/lang/rust/work/rustc-1.47.0-src/build/x86_64-unknown-netbsd/stage2-std/sparc64-unknown-netbsd/release/deps/libpanic_unwind-5427c3db55291636.rmeta --extern rustc_demangle=/usr/pkgsrc/lang/rust/work/rustc-1.47.0-src/build/x86_64-unknown-netbsd/stage2-std/sparc64-unknown-netbsd/release/deps/librustc_demangle-de5e000b109f02c7.rmeta --extern unwind=/usr/pkgsrc/lang/rust/work/rustc-1.47.0-src/build/x86_64-unknown-netbsd/stage2-std/sparc64-unknown-netbsd/release/deps/libunwind-478e4996ad0d78a7.rmeta -Dwarnings -Winvalid_codeblock_attributes --crate-version 1.47.0 --cfg backtrace_in_libstd` (exit code: 1)\r\n\r\n\r\ncommand did not execute successfully: \"/usr/pkgsrc/lang/rust/work/rust-bootstrap/bin/cargo\" \"rustdoc\" \"--target\" \"sparc64-unknown-netbsd\" \"-Zbinary-dep-depinfo\" \"-j\" \"4\" \"--release\" \"--frozen\" \"--features\" \"panic-unwind backtrace compiler-builtins-c\" \"--manifest-path\" \"/usr/pkgsrc/lang/rust/work/rustc-1.47.0-src/library/test/Cargo.toml\" \"-p\" \"std\" \"--\" \"--markdown-css\" \"rust.css\" \"--markdown-no-toc\" \"-Z\" \"unstable-options\" \"--resource-suffix\" \"1.47.0\" \"--index-page\" \"/usr/pkgsrc/lang/rust/work/rustc-1.47.0-src/src/doc/index.md\"\r\nexpected success, got: exit code: 101\r\n\r\n\r\nTraceback (most recent call last):\r\n  File \"./x.py\", line 11, in <module>\r\n    bootstrap.main()\r\n  File \"/usr/pkgsrc/lang/rust/work/rustc-1.47.0-src/src/bootstrap/bootstrap.py\", line 1016, in main\r\n    bootstrap(help_triggered)\r\n  File \"/usr/pkgsrc/lang/rust/work/rustc-1.47.0-src/src/bootstrap/bootstrap.py\", line 1002, in bootstrap\r\n    run(args, env=env, verbose=build.verbose)\r\n  File \"/usr/pkgsrc/lang/rust/work/rustc-1.47.0-src/src/bootstrap/bootstrap.py\", line 143, in run\r\n    raise RuntimeError(err)\r\nRuntimeError: failed to run: /usr/pkgsrc/lang/rust/work/rustc-1.47.0-src/build/bootstrap/debug/bootstrap -v dist -j 4\r\n```\r\n\r\n</p>\r\n</details>\r\n", "closed_by": {"login": "jyn514", "id": 23638587, "node_id": "MDQ6VXNlcjIzNjM4NTg3", "avatar_url": "https://avatars.githubusercontent.com/u/23638587?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jyn514", "html_url": "https://github.com/jyn514", "followers_url": "https://api.github.com/users/jyn514/followers", "following_url": "https://api.github.com/users/jyn514/following{/other_user}", "gists_url": "https://api.github.com/users/jyn514/gists{/gist_id}", "starred_url": "https://api.github.com/users/jyn514/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jyn514/subscriptions", "organizations_url": "https://api.github.com/users/jyn514/orgs", "repos_url": "https://api.github.com/users/jyn514/repos", "events_url": "https://api.github.com/users/jyn514/events{/privacy}", "received_events_url": "https://api.github.com/users/jyn514/received_events", "type": "User", "site_admin": false}, "reactions": {"url": "https://api.github.com/repos/rust-lang/rust/issues/78406/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rust-lang/rust/issues/78406/timeline", "performed_via_github_app": null, "state_reason": "completed"}