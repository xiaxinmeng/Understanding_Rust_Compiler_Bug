{"url": "https://api.github.com/repos/rust-lang/rust/issues/45284", "repository_url": "https://api.github.com/repos/rust-lang/rust", "labels_url": "https://api.github.com/repos/rust-lang/rust/issues/45284/labels{/name}", "comments_url": "https://api.github.com/repos/rust-lang/rust/issues/45284/comments", "events_url": "https://api.github.com/repos/rust-lang/rust/issues/45284/events", "html_url": "https://github.com/rust-lang/rust/issues/45284", "id": 265498332, "node_id": "MDU6SXNzdWUyNjU0OTgzMzI=", "number": 45284, "title": "arm-unknown-linux-gnueabihf generates armv7 instructions", "user": {"login": "ddemarco5", "id": 1832038, "node_id": "MDQ6VXNlcjE4MzIwMzg=", "avatar_url": "https://avatars.githubusercontent.com/u/1832038?v=4", "gravatar_id": "", "url": "https://api.github.com/users/ddemarco5", "html_url": "https://github.com/ddemarco5", "followers_url": "https://api.github.com/users/ddemarco5/followers", "following_url": "https://api.github.com/users/ddemarco5/following{/other_user}", "gists_url": "https://api.github.com/users/ddemarco5/gists{/gist_id}", "starred_url": "https://api.github.com/users/ddemarco5/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/ddemarco5/subscriptions", "organizations_url": "https://api.github.com/users/ddemarco5/orgs", "repos_url": "https://api.github.com/users/ddemarco5/repos", "events_url": "https://api.github.com/users/ddemarco5/events{/privacy}", "received_events_url": "https://api.github.com/users/ddemarco5/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 234956, "node_id": "MDU6TGFiZWwyMzQ5NTY=", "url": "https://api.github.com/repos/rust-lang/rust/labels/A-codegen", "name": "A-codegen", "color": "f7e101", "default": false, "description": "Area: Code generation"}, {"id": 55301954, "node_id": "MDU6TGFiZWw1NTMwMTk1NA==", "url": "https://api.github.com/repos/rust-lang/rust/labels/O-Arm", "name": "O-Arm", "color": "6e6ec0", "default": false, "description": "Target: 32-bit Arm processors (armv6, armv7, thumb...), including 64-bit Arm in AArch32 state"}, {"id": 650731663, "node_id": "MDU6TGFiZWw2NTA3MzE2NjM=", "url": "https://api.github.com/repos/rust-lang/rust/labels/C-bug", "name": "C-bug", "color": "f5f1fd", "default": false, "description": "Category: This is a bug."}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 19, "created_at": "2017-10-14T15:17:12Z", "updated_at": "2019-02-27T22:29:21Z", "closed_at": "2017-10-15T21:12:39Z", "author_association": "NONE", "active_lock_reason": null, "body": "I'm working on a dual platform embedded project. One is running an ARMv7 processor, and one is running on ARMv6 (RPI1 B+).\r\nThe ARMv7 platform runs without issue, however, trying to get ARMv6 code generated has caused problems.\r\nWhen running the binary on the ARMv6 target, I fail with an illegal instruction.\r\nTracing on it reveals `cbz    r3, 0x7f55a264`, a compare and branch on 0... an ARMv7 instruction, absent from the ARMv6 instruction set.\r\n\r\nHere is my target in the cargo config:\r\n```rust[target.arm-unknown-linux-gnueabihf]\r\nlinker = \"arm-linux-gnueabihf-gcc\"\r\nrustflags = [\r\n\t#\"-Ctarget-cpu=generic\",\r\n\t\"-Ctarget-feature=+armv6\",\r\n\t\"-Clink-args=-march=armv6\"\r\n\t]\r\n```\r\nThe broadcom SOC isn't an available target-cpu (oddly, all the cpus in the target list are armv7 processors), so I tried generic, I've tried enabling the armv6 feature and disabling a handful of armv7 features, but had no luck. I've passed args to the linker to ensure the target arch is indeed armv6 as far as it's concerned, but armv7 instructions are still getting through.\r\n\r\nI've tried a couple options, but the supported targets list at https://forge.rust-lang.org/platform-support.html\r\n`arm-unknown-linux-gnueabihf | \u2713 | \u2713 | \u2713 | ARMv6 Linux, hardfloat`\r\nis misleading.\r\n\r\nIs there a way to disable all target-features except the ones you explicitly enable? That might be a possible workaround for the time being.", "closed_by": {"login": "ddemarco5", "id": 1832038, "node_id": "MDQ6VXNlcjE4MzIwMzg=", "avatar_url": "https://avatars.githubusercontent.com/u/1832038?v=4", "gravatar_id": "", "url": "https://api.github.com/users/ddemarco5", "html_url": "https://github.com/ddemarco5", "followers_url": "https://api.github.com/users/ddemarco5/followers", "following_url": "https://api.github.com/users/ddemarco5/following{/other_user}", "gists_url": "https://api.github.com/users/ddemarco5/gists{/gist_id}", "starred_url": "https://api.github.com/users/ddemarco5/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/ddemarco5/subscriptions", "organizations_url": "https://api.github.com/users/ddemarco5/orgs", "repos_url": "https://api.github.com/users/ddemarco5/repos", "events_url": "https://api.github.com/users/ddemarco5/events{/privacy}", "received_events_url": "https://api.github.com/users/ddemarco5/received_events", "type": "User", "site_admin": false}, "reactions": {"url": "https://api.github.com/repos/rust-lang/rust/issues/45284/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rust-lang/rust/issues/45284/timeline", "performed_via_github_app": null, "state_reason": "completed"}