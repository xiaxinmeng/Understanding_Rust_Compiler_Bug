{"url": "https://api.github.com/repos/rust-lang/rust/issues/91168", "repository_url": "https://api.github.com/repos/rust-lang/rust", "labels_url": "https://api.github.com/repos/rust-lang/rust/issues/91168/labels{/name}", "comments_url": "https://api.github.com/repos/rust-lang/rust/issues/91168/comments", "events_url": "https://api.github.com/repos/rust-lang/rust/issues/91168/events", "html_url": "https://github.com/rust-lang/rust/issues/91168", "id": 1061910540, "node_id": "I_kwDOAAsO6M4_S3gM", "number": 91168, "title": "nondeterministic LLVM-IR with `@anon.HASH.number`", "user": {"login": "fangism", "id": 607886, "node_id": "MDQ6VXNlcjYwNzg4Ng==", "avatar_url": "https://avatars.githubusercontent.com/u/607886?v=4", "gravatar_id": "", "url": "https://api.github.com/users/fangism", "html_url": "https://github.com/fangism", "followers_url": "https://api.github.com/users/fangism/followers", "following_url": "https://api.github.com/users/fangism/following{/other_user}", "gists_url": "https://api.github.com/users/fangism/gists{/gist_id}", "starred_url": "https://api.github.com/users/fangism/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/fangism/subscriptions", "organizations_url": "https://api.github.com/users/fangism/orgs", "repos_url": "https://api.github.com/users/fangism/repos", "events_url": "https://api.github.com/users/fangism/events{/privacy}", "received_events_url": "https://api.github.com/users/fangism/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 650731663, "node_id": "MDU6TGFiZWw2NTA3MzE2NjM=", "url": "https://api.github.com/repos/rust-lang/rust/labels/C-bug", "name": "C-bug", "color": "f5f1fd", "default": false, "description": "Category: This is a bug."}, {"id": 1508600909, "node_id": "MDU6TGFiZWwxNTA4NjAwOTA5", "url": "https://api.github.com/repos/rust-lang/rust/labels/A-reproducibility", "name": "A-reproducibility", "color": "f7e101", "default": false, "description": "Area: Reproducible / Deterministic builds"}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 6, "created_at": "2021-11-24T02:06:21Z", "updated_at": "2021-12-06T21:48:36Z", "closed_at": "2021-12-06T21:48:36Z", "author_association": "NONE", "active_lock_reason": null, "body": "I am observing that repeating the same command twice with `--emit=llvm-ir` gives non-deterministic .rlib and .ll outputs.\r\n\r\n[I apologize in advance for not providing a full set of repro inputs and commands right now, but I will work with my team on this.]\r\n\r\nLLVM-IR differences look like this:\r\n\r\n```diff\r\n--- /home/me/run-1/libfoo_rust.ll.local  2021-11-24 01:39:16.232960224 +0000\r\n+++ /home/me/run-2/libfoo_rust.ll.local  2021-11-24 01:41:24.957404136 +0000\r\n@@ -864,8 +864,8 @@\r\n @alloc4102 = private unnamed_addr constant <{ [32 x i8] }> <{ [32 x i8] c\"assertion failed: idx < CAPACITY\" }>, align 1\r\n @alloc4103 = private unnamed_addr constant <{ [62 x i8] }> <{ [62 x i8] c\"/b/s/w/ir/x/w/rust/library/alloc/src/collections/btree/node.rs\" }>, align 1\r\n @alloc4104 = private unnamed_addr constant <{ i8*, [16 x i8] }> <{ i8* getelementptr inbounds (<{ [62 x i8] }>, <{ [62 x i8] }>* @alloc4103, i32 0, i32 0, i32 0), [16 x i8] c\">\\00\\00\\00\\00\\00\\00\\00r\\02\\00\\00\\09\\00\\00\\00\" }>, align 8\r\n-@anon.15741daeb2a46d45fc5cbefe41b02e6d.0 = private unnamed_addr constant <{ [16 x i8] }> <{ [16 x i8] c\"\\08\\00\\00\\00\\00\\00\\00\\00\\00\\00\\00\\00\\00\\00\\00\\00\" }>, align 8\r\n-@anon.15741daeb2a46d45fc5cbefe41b02e6d.1 = private unnamed_addr constant <{ [16 x i8] }> <{ [16 x i8] c\"\\01\\00\\00\\00\\00\\00\\00\\00\\00\\00\\00\\00\\00\\00\\00\\00\" }>, align 8\r\n+@anon.95861573866d15199b79d9f6e49b68ab.0 = private unnamed_addr constant <{ [16 x i8] }> <{ [16 x i8] c\"\\08\\00\\00\\00\\00\\00\\00\\00\\00\\00\\00\\00\\00\\00\\00\\00\" }>, align 8\r\n+@anon.95861573866d15199b79d9f6e49b68ab.1 = private unnamed_addr constant <{ [16 x i8] }> <{ [16 x i8] c\"\\01\\00\\00\\00\\00\\00\\00\\00\\00\\00\\00\\00\\00\\00\\00\\00\" }>, align 8\r\n @alloc868 = private unnamed_addr constant <{ [0 x i8] }> zeroinitializer, align 1\r\n @alloc4131 = private unnamed_addr constant <{ [4 x i8] }> <{ [4 x i8] c\"Some\" }>, align 1\r\n @vtable.y = private unnamed_addr constant <{ i8*, [16 x i8], i8*, [0 x i8] }> <{ i8* bitcast (void (%CapabilityName**)* @\"_ZN4core3ptr48drop_in_place$LT$$RF$cm_rust..CapabilityName$GT$17he39a5a06256363e9E\" to i8*), [16 x i8] c\"\\08\\00\\00\\00\\00\\00\\00\\00\\08\\00\\00\\00\\00\\00\\00\\00\", i8* bitcast (i1 (%CapabilityName**, %\"core::fmt::Formatter\"*)* @\"_ZN42_$LT$$RF$T$u20$as$u20$core..fmt..Debug$GT$3fmt17h6a74665eeacccadaE\" to i8*), [0 x i8] zeroinitializer }>, align 8, !dbg !61\r\n```\r\n\r\nDo we know why the hash value in `@anon.HASH.n` generated by `rustc` is non-deterministic? and what language construct is producing such anonymous symbols?\r\n\r\n### Meta\r\n\r\n`rustc --version --verbose`:\r\n\r\n```\r\nrustc 1.58.0-nightly (c9c4b5d72 2021-11-17)\r\n```\r\n\r\n", "closed_by": {"login": "fangism", "id": 607886, "node_id": "MDQ6VXNlcjYwNzg4Ng==", "avatar_url": "https://avatars.githubusercontent.com/u/607886?v=4", "gravatar_id": "", "url": "https://api.github.com/users/fangism", "html_url": "https://github.com/fangism", "followers_url": "https://api.github.com/users/fangism/followers", "following_url": "https://api.github.com/users/fangism/following{/other_user}", "gists_url": "https://api.github.com/users/fangism/gists{/gist_id}", "starred_url": "https://api.github.com/users/fangism/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/fangism/subscriptions", "organizations_url": "https://api.github.com/users/fangism/orgs", "repos_url": "https://api.github.com/users/fangism/repos", "events_url": "https://api.github.com/users/fangism/events{/privacy}", "received_events_url": "https://api.github.com/users/fangism/received_events", "type": "User", "site_admin": false}, "reactions": {"url": "https://api.github.com/repos/rust-lang/rust/issues/91168/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rust-lang/rust/issues/91168/timeline", "performed_via_github_app": null, "state_reason": "completed"}