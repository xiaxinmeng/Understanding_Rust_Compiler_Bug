{"url": "https://api.github.com/repos/rust-lang/rust/issues/20989", "repository_url": "https://api.github.com/repos/rust-lang/rust", "labels_url": "https://api.github.com/repos/rust-lang/rust/issues/20989/labels{/name}", "comments_url": "https://api.github.com/repos/rust-lang/rust/issues/20989/comments", "events_url": "https://api.github.com/repos/rust-lang/rust/issues/20989/events", "html_url": "https://github.com/rust-lang/rust/issues/20989", "id": 54033999, "node_id": "MDU6SXNzdWU1NDAzMzk5OQ==", "number": 20989, "title": "LLVM assertion failure while compiling boxed iterator", "user": {"login": "ebfull", "id": 3794471, "node_id": "MDQ6VXNlcjM3OTQ0NzE=", "avatar_url": "https://avatars.githubusercontent.com/u/3794471?v=4", "gravatar_id": "", "url": "https://api.github.com/users/ebfull", "html_url": "https://github.com/ebfull", "followers_url": "https://api.github.com/users/ebfull/followers", "following_url": "https://api.github.com/users/ebfull/following{/other_user}", "gists_url": "https://api.github.com/users/ebfull/gists{/gist_id}", "starred_url": "https://api.github.com/users/ebfull/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/ebfull/subscriptions", "organizations_url": "https://api.github.com/users/ebfull/orgs", "repos_url": "https://api.github.com/users/ebfull/repos", "events_url": "https://api.github.com/users/ebfull/events{/privacy}", "received_events_url": "https://api.github.com/users/ebfull/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 9618520, "node_id": "MDU6TGFiZWw5NjE4NTIw", "url": "https://api.github.com/repos/rust-lang/rust/labels/I-ICE", "name": "I-ICE", "color": "e10c02", "default": false, "description": "Issue: The compiler panicked, giving an Internal Compilation Error (ICE) \u2744\ufe0f"}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 1, "created_at": "2015-01-12T09:33:00Z", "updated_at": "2015-01-31T07:20:44Z", "closed_at": "2015-01-31T07:20:44Z", "author_association": "CONTRIBUTOR", "active_lock_reason": null, "body": "``` rust\n#![allow(dead_code)]\n\n#[derive(Show)]\nstruct Cell;\n\nstruct Grid {\n    cols: [[Cell; 6]; 6]\n}\n\nimpl Grid {\n    fn iter(&self) -> Box<Iterator<Item = &Cell>> {\n        Box::new(self.cols.iter().flat_map(|x| x.iter()))\n    }\n    fn fill(&mut self) {\n        for cell in *self.iter() {\n            println!(\"here's a cell: {:?}\", cell);\n        }\n    }\n}\n\nfn main() {\n}\n```\n\nError and backtrace:\n\n`rustc: /home/rustbuild/src/rust-buildbot/slave/nightly-dist-rustc-linux/build/src/llvm/lib/IR/Instructions.cpp:550: void llvm::InvokeInst::init(llvm::Value*, llvm::BasicBlock*, llvm::BasicBlock*, llvm::ArrayRef<llvm::Value*>, const llvm::Twine&): Assertion `(i >= FTy->getNumParams() || FTy->getParamType(i) == Args[i]->getType()) && \"Invoking a function with a bad signature!\"' failed.`\n\n```\nProgram received signal SIGABRT, Aborted.\n[Switching to Thread 0x7fffefbff700 (LWP 4538)]\n0x00007ffff711e107 in __GI_raise (sig=sig@entry=6) at ../nptl/sysdeps/unix/sysv/linux/raise.c:56\n56      ../nptl/sysdeps/unix/sysv/linux/raise.c: No such file or directory.\n(gdb) bt\n#0  0x00007ffff711e107 in __GI_raise (sig=sig@entry=6) at ../nptl/sysdeps/unix/sysv/linux/raise.c:56\n#1  0x00007ffff711f4e8 in __GI_abort () at abort.c:89\n#2  0x00007ffff7117226 in __assert_fail_base (fmt=0x7ffff724d968 \"%s%s%s:%u: %s%sAssertion `%s' failed.\\n%n\",\n    assertion=assertion@entry=0x7ffff4bec220 \"(i >= FTy->getNumParams() || FTy->getParamType(i) == Args[i]->getType()) && \\\"Invoking a function with a bad signature!\\\"\",\n    file=file@entry=0x7ffff4bea228 \"/home/rustbuild/src/rust-buildbot/slave/nightly-dist-rustc-linux/build/src/llvm/lib/IR/Instructions.cpp\", line=line@entry=550,\n    function=function@entry=0x7ffff4beda20 <llvm::InvokeInst::init(llvm::Value*, llvm::BasicBlock*, llvm::BasicBlock*, llvm::ArrayRef<llvm::Value*>, llvm::Twine const&)::__PRETTY_FUNCTION__> \"void llvm::InvokeInst::init(llvm::Value*, llvm::BasicBlock*, llvm::BasicBlock*, llvm::ArrayRef<llvm::Value*>, const llvm::Twine&)\") at assert.c:92\n#3  0x00007ffff71172d2 in __GI___assert_fail (assertion=0x7ffff4bec220 \"(i >= FTy->getNumParams() || FTy->getParamType(i) == Args[i]->getType()) && \\\"Invoking a function with a bad signature!\\\"\",\n    file=0x7ffff4bea228 \"/home/rustbuild/src/rust-buildbot/slave/nightly-dist-rustc-linux/build/src/llvm/lib/IR/Instructions.cpp\", line=550,\n    function=0x7ffff4beda20 <llvm::InvokeInst::init(llvm::Value*, llvm::BasicBlock*, llvm::BasicBlock*, llvm::ArrayRef<llvm::Value*>, llvm::Twine const&)::__PRETTY_FUNCTION__> \"void llvm::InvokeInst::init(llvm::Value*, llvm::BasicBlock*, llvm::BasicBlock*, llvm::ArrayRef<llvm::Value*>, const llvm::Twine&)\") at assert.c:101\n#4  0x00007ffff419be6d in llvm::InvokeInst::init(llvm::Value*, llvm::BasicBlock*, llvm::BasicBlock*, llvm::ArrayRef<llvm::Value*>, llvm::Twine const&) () from /usr/local/lib/librustc_llvm-4e7c5e5c.so\n#5  0x00007ffff319a6e1 in llvm::IRBuilder<true, llvm::ConstantFolder, llvm::IRBuilderDefaultInserter<true> >::CreateInvoke(llvm::Value*, llvm::BasicBlock*, llvm::BasicBlock*, llvm::ArrayRef<llvm::Value*>, llvm::Twine const&) ()\n   from /usr/local/lib/librustc_llvm-4e7c5e5c.so\n#6  0x00007ffff40e28ce in LLVMBuildInvoke () from /usr/local/lib/librustc_llvm-4e7c5e5c.so\n#7  0x00007ffff6569050 in trans::base::invoke::h4cd8ec174fe38a29DTs () from /usr/local/lib/librustc_trans-4e7c5e5c.so\n#8  0x00007ffff65dcba1 in trans::callee::trans_call_inner::h2302436840455011871 () from /usr/local/lib/librustc_trans-4e7c5e5c.so\n#9  0x00007ffff65a4bc0 in trans::expr::trans_rvalue_stmt_unadjusted::h3e17f3a20f297c29BMi () from /usr/local/lib/librustc_trans-4e7c5e5c.so\n#10 0x00007ffff6553bbe in trans::expr::trans_into::ha60adcbe08fa3bdbKyh () from /usr/local/lib/librustc_trans-4e7c5e5c.so\n#11 0x00007ffff65545d1 in trans::controlflow::trans_block::hdd6a1a94b7524b90B3d () from /usr/local/lib/librustc_trans-4e7c5e5c.so\n#12 0x00007ffff66226ad in trans::base::trans_closure::h1947fd5123bfe895EYt () from /usr/local/lib/librustc_trans-4e7c5e5c.so\n#13 0x00007ffff653ede7 in trans::base::trans_fn::h5d061f11fc4ac1e7j9t () from /usr/local/lib/librustc_trans-4e7c5e5c.so\n#14 0x00007ffff653b00f in trans::base::trans_item::h34ec82732f0498f3Ewu () from /usr/local/lib/librustc_trans-4e7c5e5c.so\n#15 0x00007ffff6628dad in trans::base::trans_crate::he5ffa45aaa619f67lsv () from /usr/local/lib/librustc_trans-4e7c5e5c.so\n#16 0x00007ffff7aef844 in driver::phase_4_translate_to_llvm::h98aea3c7bb04643bPFa () from /usr/local/lib/librustc_driver-4e7c5e5c.so\n#17 0x00007ffff7acb49d in driver::compile_input::h04aea004c559b910xba () from /usr/local/lib/librustc_driver-4e7c5e5c.so\n#18 0x00007ffff7b9a96a in monitor::unboxed_closure.22497 () from /usr/local/lib/librustc_driver-4e7c5e5c.so\n#19 0x00007ffff7b98f82 in thunk::F.Invoke$LT$A$C$$u{20}R$GT$::invoke::h11849311349984608396 () from /usr/local/lib/librustc_driver-4e7c5e5c.so\n#20 0x00007ffff7b97c6f in rt::unwind::try::try_fn::h13617610205470131813 () from /usr/local/lib/librustc_driver-4e7c5e5c.so\n#21 0x00007ffff76196c9 in rust_try_inner () from /usr/local/lib/libstd-4e7c5e5c.so\n#22 0x00007ffff76196b6 in rust_try () from /usr/local/lib/libstd-4e7c5e5c.so\n#23 0x00007ffff7b98386 in thunk::F.Invoke$LT$A$C$$u{20}R$GT$::invoke::h14452289732390470265 () from /usr/local/lib/librustc_driver-4e7c5e5c.so\n#24 0x00007ffff75a19b2 in sys::thread::thread_start::h93b0d38960a9fcacqrw () from /usr/local/lib/libstd-4e7c5e5c.so\n#25 0x00007ffff1b510a4 in start_thread (arg=0x7fffefbff700) at pthread_create.c:309\n#26 0x00007ffff71ceccd in clone () at ../sysdeps/unix/sysv/linux/x86_64/clone.S:111\n```\n\n```\nrustc 1.0.0-nightly (44a287e6e 2015-01-08 17:03:40 -0800)\nbinary: rustc\ncommit-hash: 44a287e6eb22ec3c2a687fc156813577464017f7\ncommit-date: 2015-01-08 17:03:40 -0800\nhost: x86_64-unknown-linux-gnu\nrelease: 1.0.0-nightly\n```\n", "closed_by": {"login": "alexcrichton", "id": 64996, "node_id": "MDQ6VXNlcjY0OTk2", "avatar_url": "https://avatars.githubusercontent.com/u/64996?v=4", "gravatar_id": "", "url": "https://api.github.com/users/alexcrichton", "html_url": "https://github.com/alexcrichton", "followers_url": "https://api.github.com/users/alexcrichton/followers", "following_url": "https://api.github.com/users/alexcrichton/following{/other_user}", "gists_url": "https://api.github.com/users/alexcrichton/gists{/gist_id}", "starred_url": "https://api.github.com/users/alexcrichton/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/alexcrichton/subscriptions", "organizations_url": "https://api.github.com/users/alexcrichton/orgs", "repos_url": "https://api.github.com/users/alexcrichton/repos", "events_url": "https://api.github.com/users/alexcrichton/events{/privacy}", "received_events_url": "https://api.github.com/users/alexcrichton/received_events", "type": "User", "site_admin": false}, "reactions": {"url": "https://api.github.com/repos/rust-lang/rust/issues/20989/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rust-lang/rust/issues/20989/timeline", "performed_via_github_app": null, "state_reason": "completed"}