{"url": "https://api.github.com/repos/rust-lang/rust/issues/8870", "repository_url": "https://api.github.com/repos/rust-lang/rust", "labels_url": "https://api.github.com/repos/rust-lang/rust/issues/8870/labels{/name}", "comments_url": "https://api.github.com/repos/rust-lang/rust/issues/8870/comments", "events_url": "https://api.github.com/repos/rust-lang/rust/issues/8870/events", "html_url": "https://github.com/rust-lang/rust/issues/8870", "id": 18768929, "node_id": "MDU6SXNzdWUxODc2ODkyOQ==", "number": 8870, "title": "rust --version may trip a pthreads assertion", "user": {"login": "alexcrichton", "id": 64996, "node_id": "MDQ6VXNlcjY0OTk2", "avatar_url": "https://avatars.githubusercontent.com/u/64996?v=4", "gravatar_id": "", "url": "https://api.github.com/users/alexcrichton", "html_url": "https://github.com/alexcrichton", "followers_url": "https://api.github.com/users/alexcrichton/followers", "following_url": "https://api.github.com/users/alexcrichton/following{/other_user}", "gists_url": "https://api.github.com/users/alexcrichton/gists{/gist_id}", "starred_url": "https://api.github.com/users/alexcrichton/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/alexcrichton/subscriptions", "organizations_url": "https://api.github.com/users/alexcrichton/orgs", "repos_url": "https://api.github.com/users/alexcrichton/repos", "events_url": "https://api.github.com/users/alexcrichton/events{/privacy}", "received_events_url": "https://api.github.com/users/alexcrichton/received_events", "type": "User", "site_admin": false}, "labels": [], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 8, "created_at": "2013-08-30T03:04:59Z", "updated_at": "2013-09-26T22:44:48Z", "closed_at": "2013-09-26T22:43:29Z", "author_association": "MEMBER", "active_lock_reason": null, "body": "```\n$ gdb --args rust --version\n(gdb) r\nStarting program: /Users/alex/code/rust/bin/rust --version\n/Users/alex/code/rust/bin/rust 0.8-pre (578e680 2013-08-27 19:35:44 -0700)\nhost: x86_64-apple-darwin\npthread_mutex_lock(&_mutex) failed in src/rt/sync/lock_and_signal.cpp at line 79, result = 22 (Invalid argument) \n\nProgram received signal SIGABRT, Aborted.\n[Switching to process 27750 thread 0x4b03]\n0x00007fff81171212 in __pthread_kill ()\n(gdb) bt\n#0  0x00007fff81171212 in __pthread_kill ()\n#1  0x00007fff8d110b54 in pthread_kill ()\n#2  0x00007fff8d154dce in abort ()\n#3  0x00000001032389a9 in lock_and_signal::lock (this=<value temporarily unavailable, due to optimizations>) at lock_and_signal.cpp:79\n#4  0x00000001032393b2 in rust_initialize_rt_tls_key (key=0x4b03) at rust_builtin.cpp:462\n#5  0x00000001000770d3 in rt::sched::__extensions__::meth_23615::bootstrap::_1eead8453d4ed64c::_0$x2e8$x2dpre ()\n#6  0x00007fff8d10f7a2 in _pthread_start ()\n#7  0x00007fff8d0fc1e1 in thread_start ()\n(gdb) The program is running.  Exit anyway? (y or n) n\nNot confirmed.\n(gdb) info threads\n* 17                         0x00007fff81171212 in __pthread_kill ()\n  16                         0x00007fff81171d16 in kevent ()\n  15                         0x00007fff81171d16 in kevent ()\n  14                         0x00007fff81171d16 in kevent ()\n  13                         0x00007fff81171d16 in kevent ()\n  12                         0x00007fff81171d16 in kevent ()\n  11                         0x00007fff81171d16 in kevent ()\n  10                         0x00007fff8d110284 in pthread_threadid_np ()\n   9                         0x00007fff8116f686 in mach_msg_trap ()\n   8                         0x00007fff8116f686 in mach_msg_trap ()\n   7                         0x00007fff8116f686 in mach_msg_trap ()\n   6                         0x00007fff8116f686 in mach_msg_trap ()\n   5                         0x00007fff8116f686 in mach_msg_trap ()\n   4                         0x00007fff8116f686 in mach_msg_trap ()\n   3                         0x00007fff8116f686 in mach_msg_trap ()\n   2                         0x00007fff8116f686 in mach_msg_trap ()\n   1 \"com.apple.main-thread\" 0x00007fff81171386 in __semwait_signal ()\n(gdb)                                                                                                                                                   \n```\n\nThere's a few interesting things going on here. First, why does rust spawn 17 threads for a simple program which will immediately return? Second, it seems odd that we're tripping the assertion in the first place...\n\ncc @brson\n", "closed_by": {"login": "alexcrichton", "id": 64996, "node_id": "MDQ6VXNlcjY0OTk2", "avatar_url": "https://avatars.githubusercontent.com/u/64996?v=4", "gravatar_id": "", "url": "https://api.github.com/users/alexcrichton", "html_url": "https://github.com/alexcrichton", "followers_url": "https://api.github.com/users/alexcrichton/followers", "following_url": "https://api.github.com/users/alexcrichton/following{/other_user}", "gists_url": "https://api.github.com/users/alexcrichton/gists{/gist_id}", "starred_url": "https://api.github.com/users/alexcrichton/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/alexcrichton/subscriptions", "organizations_url": "https://api.github.com/users/alexcrichton/orgs", "repos_url": "https://api.github.com/users/alexcrichton/repos", "events_url": "https://api.github.com/users/alexcrichton/events{/privacy}", "received_events_url": "https://api.github.com/users/alexcrichton/received_events", "type": "User", "site_admin": false}, "reactions": {"url": "https://api.github.com/repos/rust-lang/rust/issues/8870/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rust-lang/rust/issues/8870/timeline", "performed_via_github_app": null, "state_reason": "completed"}