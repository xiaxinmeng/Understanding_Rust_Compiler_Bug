{"url": "https://api.github.com/repos/rust-lang/rust/issues/30861", "repository_url": "https://api.github.com/repos/rust-lang/rust", "labels_url": "https://api.github.com/repos/rust-lang/rust/issues/30861/labels{/name}", "comments_url": "https://api.github.com/repos/rust-lang/rust/issues/30861/comments", "events_url": "https://api.github.com/repos/rust-lang/rust/issues/30861/events", "html_url": "https://github.com/rust-lang/rust/issues/30861", "id": 126287597, "node_id": "MDU6SXNzdWUxMjYyODc1OTc=", "number": 30861, "title": "rustc panics when adding #[derive(Deserialize)] to pub type declaration", "user": {"login": "anp", "id": 6812281, "node_id": "MDQ6VXNlcjY4MTIyODE=", "avatar_url": "https://avatars.githubusercontent.com/u/6812281?v=4", "gravatar_id": "", "url": "https://api.github.com/users/anp", "html_url": "https://github.com/anp", "followers_url": "https://api.github.com/users/anp/followers", "following_url": "https://api.github.com/users/anp/following{/other_user}", "gists_url": "https://api.github.com/users/anp/gists{/gist_id}", "starred_url": "https://api.github.com/users/anp/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/anp/subscriptions", "organizations_url": "https://api.github.com/users/anp/orgs", "repos_url": "https://api.github.com/users/anp/repos", "events_url": "https://api.github.com/users/anp/events{/privacy}", "received_events_url": "https://api.github.com/users/anp/received_events", "type": "User", "site_admin": false}, "labels": [], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 4, "created_at": "2016-01-12T22:01:36Z", "updated_at": "2016-01-16T22:56:05Z", "closed_at": "2016-01-16T22:56:05Z", "author_association": "MEMBER", "active_lock_reason": null, "body": "## Summary\n\nI accidentally added a `#[derive(Deserialize)]` (from serde_macros) to a `pub type _ = _;` declaration instead a struct, which then caused the compiler to panic. I reproduced it with this toy example on the 2016-01-04 nightly (the 01-11 nightly isn't compiling a dependency of `serde_macros` right now):\n## Repro\n\n``` bash\nadam@ARD155-01 ~/rust-projects $ cargo new demo --bin\nadam@ARD155-01 ~/rust-projects/demo $ multirust override nightly-2016-01-04\nmultirust: using existing install for 'nightly-2016-01-04'\nmultirust: override toolchain for '/home/adam/rust-projects/demo' set to 'nightly-2016-01-04'\n```\n\nCargo.toml:\n\n``` toml\n[package]\nname = \"demo\"\nversion = \"0.1.0\"\nauthors = [\"Adam Perry <adam.n.perry@gmail.com>\"]\n\n[dependencies]\nserde_macros = \"0.6\"\n```\n\nmain.rs:\n\n``` rust\n#![feature(custom_derive, plugin)]\n#![plugin(serde_macros)]\n\n#[derive(Deserialize)]\npub type NewType = Vec<u8>;\n\nfn main() {\n    println!(\"Hello, world!\");\n}\n```\n\nI expected to see this happen:\n\n`Don't do that stupid, here's a compiler (plugin) error.`\n\nInstead, this happened:\n\n``` bash\nerror: internal compiler error: expected ItemStruct or ItemEnum in #[derive(Deserialize)]\nnote: the compiler unexpectedly panicked. this is a bug.\nnote: we would appreciate a bug report: https://github.com/rust-lang/rust/blob/master/CONTRIBUTING.md#bug-reports\nthread 'rustc' panicked at 'Box<Any>', ../src/libsyntax/errors/mod.rs:469\n```\n## Meta\n\n``` bash\nadam@ARD155-01 ~/rust-projects/demo $ rustc --version --verbose\nrustc 1.7.0-nightly (8f11a9ef4 2016-01-03)\nbinary: rustc\ncommit-hash: 8f11a9ef4e23db189676c57c91c2675e97a74fea\ncommit-date: 2016-01-03\nhost: x86_64-unknown-linux-gnu\nrelease: 1.7.0-nightly\n```\n\n``` bash\nadam@ARD155-01 ~/rust-projects/demo $ RUST_BACKTRACE=1 cargo build --verbose\n       Fresh quasi v0.3.12\n       Fresh aster v0.9.3\n       Fresh quasi_codegen v0.3.12\n       Fresh quasi_macros v0.3.12\n       Fresh serde_codegen v0.6.8\n       Fresh serde_macros v0.6.5\n   Compiling demo v0.1.0 (file:///home/adam/rust-projects/demo)\n     Running `rustc src/main.rs --crate-name demo --crate-type bin -g --out-dir /home/adam/rust-projects/demo/target/debug --emit=dep-info,link -L dependency=/home/adam/rust-projects/demo/target/debug -L dependency=/home/adam/rust-projects/demo/target/debug/deps --extern serde_macros=/home/adam/rust-projects/demo/target/debug/deps/libserde_macros-cc8fd08d94a4bbe6.so`\nerror: internal compiler error: expected ItemStruct or ItemEnum in #[derive(Deserialize)]\nnote: the compiler unexpectedly panicked. this is a bug.\nnote: we would appreciate a bug report: https://github.com/rust-lang/rust/blob/master/CONTRIBUTING.md#bug-reports\nthread 'rustc' panicked at 'Box<Any>', ../src/libsyntax/errors/mod.rs:469\nstack backtrace:\n   1:     0x7f8ded2b9ae0 - sys::backtrace::tracing::imp::write::h83c931a57293be64Afu\n   2:     0x7f8ded2c0925 - panicking::default_handler::_<closure>::closure.42389\n   3:     0x7f8ded2c038e - panicking::default_handler::hf06b6e142d791340Eqy\n   4:     0x7f8ded2896a6 - sys_common::unwind::begin_unwind_inner::h1f0575245cf3d0d097s\n   5:     0x7f8de94a3c57 - sys_common::unwind::begin_unwind::h12034783770677981522\n   6:     0x7f8de94a4094 - errors::Handler::bug::hdf0210fa875065449ed\n   7:     0x7f8de9700a98 - ext::base::ExtCtxt<'a>::bug::h7e5b95135edda145nY7\n   8:     0x7f8de1cd578e - de::expand_derive_deserialize::hd8e126252fab8683hra\n                        at /home/adam/.multirust/toolchains/nightly-2016-01-04/cargo/registry/src/github.com-88ac128001ac3a9a/serde_codegen-0.6.8/src/de.rs:42\n   9:     0x7f8de1cd7a71 - fn(&mut syntax..ext..base..ExtCtxt, syntax..codemap..Span, &syntax..codemap..Spanned<syntax..ast..MetaItem_>, &syntax..ext..base..Annotatable, &mut core..ops..FnMut(syntax..ext..base..Annotatable)) $u7b$de..expand_derive_deserialize$u7d$::fn_pointer_shim.11656::h4bad183350a0218a\n  10:     0x7f8de1cd7a3d - ext::base::F.MultiItemDecorator::expand::h17106332544396698413\n                        at ../src/libsyntax/ext/base.rs:119\n  11:     0x7f8de97414cb - ext::expand::expand_annotatable::h8c7d426b1e137197Zua\n  12:     0x7f8de973f4a8 - ext::expand::expand_item::h39bd2724f5135651IX9\n  13:     0x7f8de974b325 - fold::noop_fold_mod::h5906434227193000799\n  14:     0x7f8de9744ec9 - ext::expand::expand_item_underscore::h21fd83f940aaf048jY9\n  15:     0x7f8de977a2be - fold::noop_fold_item_simple::h14303000504543087339\n  16:     0x7f8de9779e20 - fold::noop_fold_item::h6885099739504352802\n  17:     0x7f8de9743559 - ext::expand::expand_annotatable::h8c7d426b1e137197Zua\n  18:     0x7f8de973f4a8 - ext::expand::expand_item::h39bd2724f5135651IX9\n  19:     0x7f8de9783abb - ext::expand::expand_crate::h11ede8e6c601d3973Sa\n  20:     0x7f8ded8138d2 - driver::phase_2_configure_and_expand::_<closure>::closure.31650\n  21:     0x7f8ded7a5b55 - driver::phase_2_configure_and_expand::hb11cfa87638fbd7ekya\n  22:     0x7f8ded7852f5 - driver::compile_input::h7886c8c232de8c7bjca\n  23:     0x7f8ded778a1b - run_compiler::hfed1b58f3d8ec3b4Lwc\n  24:     0x7f8ded7757e1 - sys_common::unwind::try::try_fn::h2798711789016417359\n  25:     0x7f8ded2b7778 - __rust_try\n  26:     0x7f8ded2aef6b - sys_common::unwind::try::inner_try::hfe5be09170a408dfH4s\n  27:     0x7f8ded775b40 - boxed::F.FnBox<A>::call_box::h4070559527455171401\n  28:     0x7f8ded2beb33 - sys::thread::Thread::new::thread_start::he835c8386c59daa96nx\n  29:     0x7f8de616e4a3 - start_thread\n  30:     0x7f8decf4513c - clone\n  31:                0x0 - <unknown>\n\nCould not compile `demo`.\n\nCaused by:\n  Process didn't exit successfully: `rustc src/main.rs --crate-name demo --crate-type bin -g --out-dir /home/adam/rust-projects/demo/target/debug --emit=dep-info,link -L dependency=/home/adam/rust-projects/demo/target/debug -L dependency=/home/adam/rust-projects/demo/target/debug/deps --extern serde_macros=/home/adam/rust-projects/demo/target/debug/deps/libserde_macros-cc8fd08d94a4bbe6.so` (exit code: 101)\n```\n", "closed_by": {"login": "erickt", "id": 84711, "node_id": "MDQ6VXNlcjg0NzEx", "avatar_url": "https://avatars.githubusercontent.com/u/84711?v=4", "gravatar_id": "", "url": "https://api.github.com/users/erickt", "html_url": "https://github.com/erickt", "followers_url": "https://api.github.com/users/erickt/followers", "following_url": "https://api.github.com/users/erickt/following{/other_user}", "gists_url": "https://api.github.com/users/erickt/gists{/gist_id}", "starred_url": "https://api.github.com/users/erickt/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/erickt/subscriptions", "organizations_url": "https://api.github.com/users/erickt/orgs", "repos_url": "https://api.github.com/users/erickt/repos", "events_url": "https://api.github.com/users/erickt/events{/privacy}", "received_events_url": "https://api.github.com/users/erickt/received_events", "type": "User", "site_admin": false}, "reactions": {"url": "https://api.github.com/repos/rust-lang/rust/issues/30861/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rust-lang/rust/issues/30861/timeline", "performed_via_github_app": null, "state_reason": "completed"}