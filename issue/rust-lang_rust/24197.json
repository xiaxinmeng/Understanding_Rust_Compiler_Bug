{"url": "https://api.github.com/repos/rust-lang/rust/issues/24197", "repository_url": "https://api.github.com/repos/rust-lang/rust", "labels_url": "https://api.github.com/repos/rust-lang/rust/issues/24197/labels{/name}", "comments_url": "https://api.github.com/repos/rust-lang/rust/issues/24197/comments", "events_url": "https://api.github.com/repos/rust-lang/rust/issues/24197/events", "html_url": "https://github.com/rust-lang/rust/issues/24197", "id": 67175547, "node_id": "MDU6SXNzdWU2NzE3NTU0Nw==", "number": 24197, "title": "ICE - rustc panic on using let to assign to already initialized array", "user": {"login": "impo", "id": 4788972, "node_id": "MDQ6VXNlcjQ3ODg5NzI=", "avatar_url": "https://avatars.githubusercontent.com/u/4788972?v=4", "gravatar_id": "", "url": "https://api.github.com/users/impo", "html_url": "https://github.com/impo", "followers_url": "https://api.github.com/users/impo/followers", "following_url": "https://api.github.com/users/impo/following{/other_user}", "gists_url": "https://api.github.com/users/impo/gists{/gist_id}", "starred_url": "https://api.github.com/users/impo/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/impo/subscriptions", "organizations_url": "https://api.github.com/users/impo/orgs", "repos_url": "https://api.github.com/users/impo/repos", "events_url": "https://api.github.com/users/impo/events{/privacy}", "received_events_url": "https://api.github.com/users/impo/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 9618520, "node_id": "MDU6TGFiZWw5NjE4NTIw", "url": "https://api.github.com/repos/rust-lang/rust/labels/I-ICE", "name": "I-ICE", "color": "e10c02", "default": false, "description": "Issue: The compiler panicked, giving an Internal Compilation Error (ICE) \u2744\ufe0f"}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 3, "created_at": "2015-04-08T17:09:20Z", "updated_at": "2015-04-16T01:17:11Z", "closed_at": "2015-04-16T01:17:11Z", "author_association": "NONE", "active_lock_reason": null, "body": "I accidentally used let statements when I was trying to assign to elements of a bytearray instead of just the equals sign. An ICE resulted. \n\nI tried this code:\n\n``` rust\nfn to_size(tag_size: u32) -> [u8; 4] {\n    let mut bytes: [u8; 4] = [0; 4];\n    assert!(tag_size < 2.pow(28), \"to_size: Number too big to convert!\");\n    let bytes[0] = (tag_size & 0x0FE00000 >> 21) as u8;\n    let bytes[1] = (tag_size & 0x001FC000 >> 14) as u8;\n    let bytes[2] = (tag_size & 0x00003F80 >> 7) as u8;\n    let bytes[3] = (tag_size & 0x0000007F >> 0) as u8;\n    bytes\n}\n\nfn main() {\n    println!(\"{:?}\", to_size(257));\n}\n```\n\nI expected the compiler to recognize those lets as errors, but instead it panicked with:\n\n```\nsrc/main.rs:12:9: 12:14 error: internal compiler error: ident only path should have been covered already\nsrc/main.rs:12     let bytes[0] = (tag_size & 0x0FE00000 >> 21) as u8;\n                       ^~~~~\nnote: the compiler unexpectedly panicked. this is a bug.\nnote: we would appreciate a bug report: https://github.com/rust-lang/rust/blob/master/CONTRIBUTING.md#bug-reports\nnote: run with `RUST_BACKTRACE=1` for a backtrace\nthread 'rustc' panicked at 'Box<Any>', /home/rustbuild/src/rust-buildbot/slave/beta-dist-rustc-linux/build/src/libsyntax/diagnostic.rs:130\n\n```\n## Meta\n\n`rustc --version --verbose`:\nrustc 1.0.0-beta (9854143cb 2015-04-02) (built 2015-04-02)\nbinary: rustc\ncommit-hash: 9854143cba679834bc4ef932858cd5303f015a0e\ncommit-date: 2015-04-02\nbuild-date: 2015-04-02\nhost: x86_64-unknown-linux-gnu\nrelease: 1.0.0-beta\n\nBacktrace:\n\n```\nstack backtrace:\n   1:     0x7fea622273c8 - sys::backtrace::write::h179e141147f9ee14IJC\n   2:     0x7fea62252770 - panicking::on_panic::h6aa569d33389f0cfsXI\n   3:     0x7fea6218a4a3 - rt::unwind::begin_unwind_inner::h082f07869f4b9731ACI\n   4:     0x7fea5f55004d - rt::unwind::begin_unwind::h13428428822164950735\n   5:     0x7fea5f54fff3 - diagnostic::SpanHandler::span_bug::he82cb6427e6a50a8jnB\n   6:     0x7fea5f57779a - parse::parser::Parser<'a>::parse_pat::ha10816fc85a711f2ADH\n   7:     0x7fea5f58c08a - parse::parser::Parser<'a>::parse_local::h7a4b73a54cfe440eUUH\n   8:     0x7fea5f58c8af - parse::parser::Parser<'a>::parse_stmt_::hc177f9743625a47b1XH\n   9:     0x7fea5f585a5a - parse::parser::Parser<'a>::parse_block_tail::h39c4a68e017bc6c6l8H\n  10:     0x7fea5f570e6d - parse::parser::Parser<'a>::parse_inner_attrs_and_block::h11a14d825d017327e7H\n  11:     0x7fea5f5996da - parse::parser::Parser<'a>::parse_item_fn::h5e181fed3ab83833pII\n  12:     0x7fea5f5902a6 - parse::parser::Parser<'a>::parse_item_::h400393f2ccce4b57jyJ\n  13:     0x7fea5f59f3ea - parse::parser::Parser<'a>::parse_mod_items::h9961b2bcefd3983fo4I\n  14:     0x7fea5f5a5a75 - parse::parser::Parser<'a>::parse_crate_mod::hb6ea15a6eba26ddd7WJ\n  15:     0x7fea5f5ba8f5 - parse::parse_crate_from_file::h4c866de8bdd6168diMQ\n  16:     0x7fea628b5a48 - driver::phase_1_parse_input::closure.15614\n  17:     0x7fea6288cc63 - driver::phase_1_parse_input::hddfc72484068c586Nqa\n  18:     0x7fea62888fa7 - driver::compile_input::h7c62c2870ff901f6Qba\n  19:     0x7fea62941a25 - run_compiler::hc815b49ce638c28eV4b\n  20:     0x7fea6293f33d - boxed::F.FnBox<A>::call_box::h4290333406520961126\n  21:     0x7fea6293e879 - rt::unwind::try::try_fn::h13999576404798567721\n  22:     0x7fea622cec68 - rust_try_inner\n  23:     0x7fea622cec55 - rust_try\n  24:     0x7fea6293eb4b - boxed::F.FnBox<A>::call_box::h14489442628055152240\n  25:     0x7fea6223d781 - sys::thread::create::thread_start::h02b7da32b4d7a4aaExH\n  26:     0x7fea5c02e373 - start_thread\n  27:     0x7fea61dfd27c - __clone\n  28:                0x0 - <unknown>\n```\n", "closed_by": {"login": "bors", "id": 3372342, "node_id": "MDQ6VXNlcjMzNzIzNDI=", "avatar_url": "https://avatars.githubusercontent.com/u/3372342?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors", "html_url": "https://github.com/bors", "followers_url": "https://api.github.com/users/bors/followers", "following_url": "https://api.github.com/users/bors/following{/other_user}", "gists_url": "https://api.github.com/users/bors/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors/subscriptions", "organizations_url": "https://api.github.com/users/bors/orgs", "repos_url": "https://api.github.com/users/bors/repos", "events_url": "https://api.github.com/users/bors/events{/privacy}", "received_events_url": "https://api.github.com/users/bors/received_events", "type": "User", "site_admin": false}, "reactions": {"url": "https://api.github.com/repos/rust-lang/rust/issues/24197/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rust-lang/rust/issues/24197/timeline", "performed_via_github_app": null, "state_reason": "completed"}