{"url": "https://api.github.com/repos/rust-lang/rust/issues/42775", "repository_url": "https://api.github.com/repos/rust-lang/rust", "labels_url": "https://api.github.com/repos/rust-lang/rust/issues/42775/labels{/name}", "comments_url": "https://api.github.com/repos/rust-lang/rust/issues/42775/comments", "events_url": "https://api.github.com/repos/rust-lang/rust/issues/42775/events", "html_url": "https://github.com/rust-lang/rust/issues/42775", "id": 237252519, "node_id": "MDU6SXNzdWUyMzcyNTI1MTk=", "number": 42775, "title": "A specialized position()?", "user": {"login": "leonardo-m", "id": 22328461, "node_id": "MDQ6VXNlcjIyMzI4NDYx", "avatar_url": "https://avatars.githubusercontent.com/u/22328461?v=4", "gravatar_id": "", "url": "https://api.github.com/users/leonardo-m", "html_url": "https://github.com/leonardo-m", "followers_url": "https://api.github.com/users/leonardo-m/followers", "following_url": "https://api.github.com/users/leonardo-m/following{/other_user}", "gists_url": "https://api.github.com/users/leonardo-m/gists{/gist_id}", "starred_url": "https://api.github.com/users/leonardo-m/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/leonardo-m/subscriptions", "organizations_url": "https://api.github.com/users/leonardo-m/orgs", "repos_url": "https://api.github.com/users/leonardo-m/repos", "events_url": "https://api.github.com/users/leonardo-m/events{/privacy}", "received_events_url": "https://api.github.com/users/leonardo-m/received_events", "type": "User", "site_admin": false}, "labels": [], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 2, "created_at": "2017-06-20T15:29:23Z", "updated_at": "2017-06-20T16:32:06Z", "closed_at": "2017-06-20T16:32:06Z", "author_association": "NONE", "active_lock_reason": null, "body": "The default implementation of iterator::position:\r\n\r\nhttps://doc.rust-lang.org/src/core/iter/iterator.rs.html#1548\r\n\r\n```\r\nfn position<P>(&mut self, mut predicate: P) -> Option<usize> where\r\n    Self: Sized,\r\n    P: FnMut(Self::Item) -> bool,\r\n{\r\n    for (i, x) in self.enumerate() {\r\n        if predicate(x) {\r\n            return Some(i);\r\n        }\r\n    }\r\n    None\r\n}\r\n```\r\n\r\nThe C++ STL has code like this for find_if() on random access iterators:\r\n\r\n```\r\nfind_if(RandomAccessIterator first, RandomAccessIterator last,\r\n        Predicate pred, random_access_iterator_tag) {\r\n    iterator_traits<RandomAccessIterator>::difference_type\r\n        n_blocks = (last - first) >> 2;\r\n\r\n    for (; n_blocks > 0; n_blocks -= 1) {\r\n        if (pred(first)) { return first; }\r\n        first += 1;\r\n\r\n        if (pred(first)) { return first; }\r\n        first += 1;\r\n\r\n        if (pred(first)) { return first; }\r\n        first += 1;\r\n\r\n        if (pred(first)) { return first; }\r\n        first += 1;\r\n    }\r\n\r\n    switch (last - first) {\r\n        case 3:\r\n            if (pred(first)) { return first; }\r\n            first += 1;\r\n\r\n        case 2:\r\n            if (pred(first)) { return first; }\r\n            first += 1;\r\n\r\n        case 1:\r\n            if (pred(first)) { return first; }\r\n            first += 1;\r\n\r\n        case 0:\r\n        default:\r\n            return last;\r\n    }\r\n}\r\n```\r\nSo perhaps it's worth adding a similar optimization for position() on slices.", "closed_by": {"login": "leonardo-m", "id": 22328461, "node_id": "MDQ6VXNlcjIyMzI4NDYx", "avatar_url": "https://avatars.githubusercontent.com/u/22328461?v=4", "gravatar_id": "", "url": "https://api.github.com/users/leonardo-m", "html_url": "https://github.com/leonardo-m", "followers_url": "https://api.github.com/users/leonardo-m/followers", "following_url": "https://api.github.com/users/leonardo-m/following{/other_user}", "gists_url": "https://api.github.com/users/leonardo-m/gists{/gist_id}", "starred_url": "https://api.github.com/users/leonardo-m/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/leonardo-m/subscriptions", "organizations_url": "https://api.github.com/users/leonardo-m/orgs", "repos_url": "https://api.github.com/users/leonardo-m/repos", "events_url": "https://api.github.com/users/leonardo-m/events{/privacy}", "received_events_url": "https://api.github.com/users/leonardo-m/received_events", "type": "User", "site_admin": false}, "reactions": {"url": "https://api.github.com/repos/rust-lang/rust/issues/42775/reactions", "total_count": 1, "+1": 0, "-1": 1, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rust-lang/rust/issues/42775/timeline", "performed_via_github_app": null, "state_reason": "completed"}