{"url": "https://api.github.com/repos/rust-lang/rust/issues/45363", "repository_url": "https://api.github.com/repos/rust-lang/rust", "labels_url": "https://api.github.com/repos/rust-lang/rust/issues/45363/labels{/name}", "comments_url": "https://api.github.com/repos/rust-lang/rust/issues/45363/comments", "events_url": "https://api.github.com/repos/rust-lang/rust/issues/45363/events", "html_url": "https://github.com/rust-lang/rust/issues/45363", "id": 266523091, "node_id": "MDU6SXNzdWUyNjY1MjMwOTE=", "number": 45363, "title": "MIR-borrowck: should distinguish \"uninitalized\" from \"moved out of\"", "user": {"login": "pnkfelix", "id": 173127, "node_id": "MDQ6VXNlcjE3MzEyNw==", "avatar_url": "https://avatars.githubusercontent.com/u/173127?v=4", "gravatar_id": "", "url": "https://api.github.com/users/pnkfelix", "html_url": "https://github.com/pnkfelix", "followers_url": "https://api.github.com/users/pnkfelix/followers", "following_url": "https://api.github.com/users/pnkfelix/following{/other_user}", "gists_url": "https://api.github.com/users/pnkfelix/gists{/gist_id}", "starred_url": "https://api.github.com/users/pnkfelix/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/pnkfelix/subscriptions", "organizations_url": "https://api.github.com/users/pnkfelix/orgs", "repos_url": "https://api.github.com/users/pnkfelix/repos", "events_url": "https://api.github.com/users/pnkfelix/events{/privacy}", "received_events_url": "https://api.github.com/users/pnkfelix/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 171502053, "node_id": "MDU6TGFiZWwxNzE1MDIwNTM=", "url": "https://api.github.com/repos/rust-lang/rust/labels/A-borrow-checker", "name": "A-borrow-checker", "color": "f7e101", "default": false, "description": "Area: The borrow checker"}, {"id": 211668100, "node_id": "MDU6TGFiZWwyMTE2NjgxMDA=", "url": "https://api.github.com/repos/rust-lang/rust/labels/T-compiler", "name": "T-compiler", "color": "bfd4f2", "default": false, "description": "Relevant to the compiler team, which will review and decide on the PR/issue."}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 1, "created_at": "2017-10-18T14:51:16Z", "updated_at": "2017-11-11T15:49:45Z", "closed_at": "2017-11-11T15:49:45Z", "author_association": "MEMBER", "active_lock_reason": null, "body": "The AST-borrowck is often able to distinguish a path that was never assigned into (i.e. \"uninitialized\") from a path that had previously held a value but that value was subsequently moved elsewhere (i.e. \"moved out of\").\r\n\r\nThe MIR-borrowck currently uniformly reports both cases as instances of \"uninitialized\" state.\r\n\r\nAs an example: for the test `src/test/compile-fail/borrowck/borrowck-loan-in-overloaded-op.rs`, we have these diagnostics emitted:\r\n\r\n```\r\n% ./build/x86_64-unknown-l\\\r\ninux-gnu/stage1/bin/rustc -Z borrowck-mir ../src/test/compile-fail/borrowck/borrowck-loan-in-overloaded-op.rs\r\nerror[E0382]: use of moved value: `x` (Ast)\r\n  --> ../src/test/compile-fail/borrowck/borrowck-loan-in-overloaded-op.rs:31:20\r\n   |\r\n31 |     let _y = {x} + x.clone(); // the `{x}` forces a move to occur\r\n   |               -    ^ value used here after move\r\n   |               |\r\n   |               value moved here\r\n   |\r\n   = note: move occurs because `x` has type `foo`, which does not implement the `Copy` trait\r\n\r\nerror[E0381]: borrow of possibly uninitialized variable: `x` (Mir)\r\n  --> ../src/test/compile-fail/borrowck/borrowck-loan-in-overloaded-op.rs:31:20\r\n   |\r\n31 |     let _y = {x} + x.clone(); // the `{x}` forces a move to occur\r\n   |                    ^ use of possibly uninitialized `x`\r\n\r\nerror: aborting due to 2 previous errors\r\n```\r\n\r\nThe first one is AST-borrowck, the second one MIR-borrowck.\r\n\r\nNote in particular that AST-borrowck not only uses more precise language, but more importantly, it reports the specific span where the preceding move out occurred. This is perhaps the most important aspect of the diagnostic (especially for new-comers to Rust and move-semantics).", "closed_by": {"login": "bors", "id": 3372342, "node_id": "MDQ6VXNlcjMzNzIzNDI=", "avatar_url": "https://avatars.githubusercontent.com/u/3372342?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors", "html_url": "https://github.com/bors", "followers_url": "https://api.github.com/users/bors/followers", "following_url": "https://api.github.com/users/bors/following{/other_user}", "gists_url": "https://api.github.com/users/bors/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors/subscriptions", "organizations_url": "https://api.github.com/users/bors/orgs", "repos_url": "https://api.github.com/users/bors/repos", "events_url": "https://api.github.com/users/bors/events{/privacy}", "received_events_url": "https://api.github.com/users/bors/received_events", "type": "User", "site_admin": false}, "reactions": {"url": "https://api.github.com/repos/rust-lang/rust/issues/45363/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rust-lang/rust/issues/45363/timeline", "performed_via_github_app": null, "state_reason": "completed"}