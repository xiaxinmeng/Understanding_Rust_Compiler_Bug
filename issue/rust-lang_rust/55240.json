{"url": "https://api.github.com/repos/rust-lang/rust/issues/55240", "repository_url": "https://api.github.com/repos/rust-lang/rust", "labels_url": "https://api.github.com/repos/rust-lang/rust/issues/55240/labels{/name}", "comments_url": "https://api.github.com/repos/rust-lang/rust/issues/55240/comments", "events_url": "https://api.github.com/repos/rust-lang/rust/issues/55240/events", "html_url": "https://github.com/rust-lang/rust/issues/55240", "id": 372280417, "node_id": "MDU6SXNzdWUzNzIyODA0MTc=", "number": 55240, "title": "Missing unused_must_use warning for macro calls", "user": {"login": "snoyberg", "id": 49415, "node_id": "MDQ6VXNlcjQ5NDE1", "avatar_url": "https://avatars.githubusercontent.com/u/49415?v=4", "gravatar_id": "", "url": "https://api.github.com/users/snoyberg", "html_url": "https://github.com/snoyberg", "followers_url": "https://api.github.com/users/snoyberg/followers", "following_url": "https://api.github.com/users/snoyberg/following{/other_user}", "gists_url": "https://api.github.com/users/snoyberg/gists{/gist_id}", "starred_url": "https://api.github.com/users/snoyberg/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/snoyberg/subscriptions", "organizations_url": "https://api.github.com/users/snoyberg/orgs", "repos_url": "https://api.github.com/users/snoyberg/repos", "events_url": "https://api.github.com/users/snoyberg/events{/privacy}", "received_events_url": "https://api.github.com/users/snoyberg/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 235137, "node_id": "MDU6TGFiZWwyMzUxMzc=", "url": "https://api.github.com/repos/rust-lang/rust/labels/A-lint", "name": "A-lint", "color": "f7e101", "default": false, "description": "Area: Lints (warnings about flaws in source code) such as unused_mut."}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 2, "created_at": "2018-10-21T05:12:24Z", "updated_at": "2020-01-26T07:36:13Z", "closed_at": "2020-01-26T07:36:13Z", "author_association": "CONTRIBUTOR", "active_lock_reason": null, "body": "This code is pretty close to [my original code](https://gist.github.com/snoyberg/5307d493750d7b48c1c5281961bc31d0):\r\n\r\n```rust\r\nuse std::fmt::{Formatter, Display, self};\r\n\r\nstruct Foo;\r\n\r\nimpl Display for Foo {\r\n    fn fmt(&self, fmt: &mut Formatter) -> fmt::Result {\r\n        write!(fmt, \"ignored result\\n\");\r\n\r\n        let mut closure = || {\r\n            write!(fmt, \"not ignoring result\\n\")\r\n        };\r\n\r\n        closure(); // also ignoring here\r\n\r\n        Ok(())\r\n    }\r\n}\r\n\r\nfn main() {\r\n    println!(\"{}\", Foo);\r\n}\r\n```\r\n\r\nExpected: a warning on the first `write!` call and the call to `closure` about an ignored `Result` value.\r\n\r\nActual: I get the warning on the `closure` call, but not on the first `write!` call.\r\n\r\nMy best guess is that for some reason `Result`s returned from a macro do not trigger this warning, so I came up with a smaller attempted repro. However, this shows a slightly different result:\r\n\r\n```rust\r\nmacro_rules! err_macro {\r\n    () => (Err(String::from(\"error from macro\")) as Result<(), String>)\r\n}\r\n\r\nfn err_function() -> Result<(), String> {\r\n    Err(String::from(\"error from function\"))\r\n}\r\n\r\nfn main() {\r\n    err_function();\r\n    err_macro!();\r\n}\r\n```\r\n\r\nAs expected, I get a warning on the call to `err_function()`. I also get a warning for the macro call, in both the definition and use locations:\r\n\r\n```\r\nwarning: unused `std::result::Result` which must be used\r\n  --> where-da-warning-2.rs:2:12\r\n   |\r\n2  |     () => (Err(String::from(\"error from macro\")) as Result<(), String>)\r\n   |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\r\n...\r\n11 |     err_macro!();\r\n   |     ------------- in this macro invocation\r\n   |\r\n   = note: this `Result` may be an `Err` variant, which should be handled\r\n```\r\n\r\nPerhaps the reason the `write!` macro doesn't generate a warning is because the its a macro being pulled in from a different library, not being defined locally.\r\n\r\n## Meta\r\n\r\n```\r\n$ rustc --version --verbose\r\nrustc 1.31.0-nightly (96cafc53c 2018-10-09)\r\nbinary: rustc\r\ncommit-hash: 96cafc53cfc6667a03c8e77d8e0a2fc96555ff6b\r\ncommit-date: 2018-10-09\r\nhost: x86_64-apple-darwin\r\nrelease: 1.31.0-nightly\r\nLLVM version: 8.0\r\n```", "closed_by": {"login": "snoyberg", "id": 49415, "node_id": "MDQ6VXNlcjQ5NDE1", "avatar_url": "https://avatars.githubusercontent.com/u/49415?v=4", "gravatar_id": "", "url": "https://api.github.com/users/snoyberg", "html_url": "https://github.com/snoyberg", "followers_url": "https://api.github.com/users/snoyberg/followers", "following_url": "https://api.github.com/users/snoyberg/following{/other_user}", "gists_url": "https://api.github.com/users/snoyberg/gists{/gist_id}", "starred_url": "https://api.github.com/users/snoyberg/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/snoyberg/subscriptions", "organizations_url": "https://api.github.com/users/snoyberg/orgs", "repos_url": "https://api.github.com/users/snoyberg/repos", "events_url": "https://api.github.com/users/snoyberg/events{/privacy}", "received_events_url": "https://api.github.com/users/snoyberg/received_events", "type": "User", "site_admin": false}, "reactions": {"url": "https://api.github.com/repos/rust-lang/rust/issues/55240/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rust-lang/rust/issues/55240/timeline", "performed_via_github_app": null, "state_reason": "completed"}