{"url": "https://api.github.com/repos/rust-lang/rust/issues/38025", "repository_url": "https://api.github.com/repos/rust-lang/rust", "labels_url": "https://api.github.com/repos/rust-lang/rust/issues/38025/labels{/name}", "comments_url": "https://api.github.com/repos/rust-lang/rust/issues/38025/comments", "events_url": "https://api.github.com/repos/rust-lang/rust/issues/38025/events", "html_url": "https://github.com/rust-lang/rust/issues/38025", "id": 191854729, "node_id": "MDU6SXNzdWUxOTE4NTQ3Mjk=", "number": 38025, "title": "`--emit dep-info` does not stop after parsing", "user": {"login": "fmdkdd", "id": 340129, "node_id": "MDQ6VXNlcjM0MDEyOQ==", "avatar_url": "https://avatars.githubusercontent.com/u/340129?v=4", "gravatar_id": "", "url": "https://api.github.com/users/fmdkdd", "html_url": "https://github.com/fmdkdd", "followers_url": "https://api.github.com/users/fmdkdd/followers", "following_url": "https://api.github.com/users/fmdkdd/following{/other_user}", "gists_url": "https://api.github.com/users/fmdkdd/gists{/gist_id}", "starred_url": "https://api.github.com/users/fmdkdd/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/fmdkdd/subscriptions", "organizations_url": "https://api.github.com/users/fmdkdd/orgs", "repos_url": "https://api.github.com/users/fmdkdd/repos", "events_url": "https://api.github.com/users/fmdkdd/events{/privacy}", "received_events_url": "https://api.github.com/users/fmdkdd/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 36956, "node_id": "MDU6TGFiZWwzNjk1Ng==", "url": "https://api.github.com/repos/rust-lang/rust/labels/A-frontend", "name": "A-frontend", "color": "f7e101", "default": false, "description": "Area: frontend (errors, parsing and HIR)"}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 1, "created_at": "2016-11-27T10:50:41Z", "updated_at": "2017-05-16T16:28:19Z", "closed_at": "2017-05-16T16:28:19Z", "author_association": "NONE", "active_lock_reason": null, "body": "According to @alexcrichton and the discussion at rust-lang/cargo#3211, with `--emit dep-info` the compiler should exit as soon as the dependencies are written to a file.  This is currently not the case. \r\n\r\nI have one file `src/lib.rs` that contains only the line: `mod a;`, and in `src/a.rs` I have a syntactically correct function with a borrowing error:\r\n```\r\nfn foo() {\r\n  let mut a = 0;\r\n  let b = &mut a;\r\n  let c = &mut a; \r\n}\r\n```\r\nInvoking:\r\n```\r\nrustc --crate-type lib --emit dep-info src/lib.rs\r\n```\r\ncreates the file `lib.d` (and nothing in `target/`):\r\n```\r\nlib.d: src/lib.rs src/a.rs\r\n\r\nsrc/lib.rs:\r\nsrc/a.rs:\r\n```\r\nBut the output also reports the borrow error:\r\n```\r\nerror[E0499]: cannot borrow `a` as mutable more than once at a time\r\n --> src/a.rs:4:16\r\n  |\r\n3 |   let b = &mut a;\r\n  |                - first mutable borrow occurs here\r\n4 |   let c = &mut a;\r\n  |                ^ second mutable borrow occurs here\r\n5 | }\r\n  | - first borrow ends here\r\n\r\nerror: aborting due to previous error\r\n```\r\n\r\nIn a possibly related issue #23165, `-Z no-analysis` is suggested.  Using it on this example makes the compiler indeed exit sooner (no borrow error reporting), but maybe not as soon as it could.  Here's the output with `-Z no-analysis -Z time-passes`:\r\n\r\n```\r\ntime: 0.000; rss: 45MB\tparsing\r\ntime: 0.000; rss: 45MB\trecursion limit\r\ntime: 0.000; rss: 45MB\tcrate injection\r\ntime: 0.000; rss: 45MB\tplugin loading\r\ntime: 0.000; rss: 45MB\tplugin registration\r\ntime: 0.014; rss: 65MB\texpansion\r\ntime: 0.000; rss: 65MB\tmaybe building test harness\r\ntime: 0.000; rss: 65MB\tmaybe creating a macro crate\r\ntime: 0.000; rss: 65MB\tchecking for inline asm in case the target doesn't support it\r\ntime: 0.000; rss: 65MB\tcomplete gated feature checking\r\ntime: 0.000; rss: 65MB\tcollecting defs\r\ntime: 0.000; rss: 65MB\tearly lint checks\r\ntime: 0.000; rss: 65MB\tAST validation\r\ntime: 0.001; rss: 65MB\tname resolution\r\ntime: 0.000; rss: 65MB\tlowering ast -> hir\r\ntime: 0.000; rss: 65MB\tindexing hir\r\n```", "closed_by": {"login": "Mark-Simulacrum", "id": 5047365, "node_id": "MDQ6VXNlcjUwNDczNjU=", "avatar_url": "https://avatars.githubusercontent.com/u/5047365?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Mark-Simulacrum", "html_url": "https://github.com/Mark-Simulacrum", "followers_url": "https://api.github.com/users/Mark-Simulacrum/followers", "following_url": "https://api.github.com/users/Mark-Simulacrum/following{/other_user}", "gists_url": "https://api.github.com/users/Mark-Simulacrum/gists{/gist_id}", "starred_url": "https://api.github.com/users/Mark-Simulacrum/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Mark-Simulacrum/subscriptions", "organizations_url": "https://api.github.com/users/Mark-Simulacrum/orgs", "repos_url": "https://api.github.com/users/Mark-Simulacrum/repos", "events_url": "https://api.github.com/users/Mark-Simulacrum/events{/privacy}", "received_events_url": "https://api.github.com/users/Mark-Simulacrum/received_events", "type": "User", "site_admin": false}, "reactions": {"url": "https://api.github.com/repos/rust-lang/rust/issues/38025/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rust-lang/rust/issues/38025/timeline", "performed_via_github_app": null, "state_reason": "completed"}