{"url": "https://api.github.com/repos/rust-lang/rust/issues/80735", "repository_url": "https://api.github.com/repos/rust-lang/rust", "labels_url": "https://api.github.com/repos/rust-lang/rust/issues/80735/labels{/name}", "comments_url": "https://api.github.com/repos/rust-lang/rust/issues/80735/comments", "events_url": "https://api.github.com/repos/rust-lang/rust/issues/80735/events", "html_url": "https://github.com/rust-lang/rust/issues/80735", "id": 779738612, "node_id": "MDU6SXNzdWU3Nzk3Mzg2MTI=", "number": 80735, "title": "Unable to run any binary with riscv64gc-unknown-linux-gnu (target-feature=+crt-static) (segmentation fault)", "user": {"login": "addisoncrump", "id": 10711159, "node_id": "MDQ6VXNlcjEwNzExMTU5", "avatar_url": "https://avatars.githubusercontent.com/u/10711159?v=4", "gravatar_id": "", "url": "https://api.github.com/users/addisoncrump", "html_url": "https://github.com/addisoncrump", "followers_url": "https://api.github.com/users/addisoncrump/followers", "following_url": "https://api.github.com/users/addisoncrump/following{/other_user}", "gists_url": "https://api.github.com/users/addisoncrump/gists{/gist_id}", "starred_url": "https://api.github.com/users/addisoncrump/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/addisoncrump/subscriptions", "organizations_url": "https://api.github.com/users/addisoncrump/orgs", "repos_url": "https://api.github.com/users/addisoncrump/repos", "events_url": "https://api.github.com/users/addisoncrump/events{/privacy}", "received_events_url": "https://api.github.com/users/addisoncrump/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 650731663, "node_id": "MDU6TGFiZWw2NTA3MzE2NjM=", "url": "https://api.github.com/repos/rust-lang/rust/labels/C-bug", "name": "C-bug", "color": "f5f1fd", "default": false, "description": "Category: This is a bug."}, {"id": 1210355734, "node_id": "MDU6TGFiZWwxMjEwMzU1NzM0", "url": "https://api.github.com/repos/rust-lang/rust/labels/O-riscv", "name": "O-riscv", "color": "6e6ec0", "default": false, "description": "Target: RISC-V architecture"}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 15, "created_at": "2021-01-05T23:44:02Z", "updated_at": "2021-02-13T04:31:01Z", "closed_at": "2021-02-13T04:31:01Z", "author_association": "NONE", "active_lock_reason": null, "body": "Using an empty program:\r\n\r\n```rust\r\nfn main() {\r\n}\r\n```\r\n\r\nUsing the following `.cargo/config`:\r\n\r\n```toml\r\n[build]\r\ntarget = \"riscv64gc-unknown-linux-gnu\"\r\n\r\n[target.riscv64gc-unknown-linux-gnu]\r\nlinker = \"/usr/bin/riscv64-linux-gnu-ld\"\r\nrustflags = [\"-C\", \"target-feature=+crt-static\", \"-C\", \"link-arg=--library-path=/usr/lib/gcc-cross/riscv64-linux-gnu/9\"]\r\n\r\n#linker = \"/opt/riscv/bin/riscv64-unknown-linux-gnu-ld\"\r\n#rustflags = [\"-C\", \"target-feature=+crt-static\", \"-C\", \"link-arg=--library-path=/opt/riscv/lib/gcc/riscv64-unknown-linux-gnu/10.2.0\"]\r\n\r\n#rustflags = [\"-C\", \"target-feature=+crt-static\"]\r\n```\r\n\r\n- `/usr/bin/riscv64-linux-gnu-*` is provided by: https://packages.ubuntu.com/search?keywords=gcc-riscv64-linux-gnu\r\n- `/opt/riscv/bin/riscv64-unknown-linux-gnu-*` is provided by: https://github.com/riscv/riscv-gnu-toolchain\r\n\r\nI have tried building with each of the grouped combinations under `[target.riscv64gc-unknown-linux-gnu]` with both nightly and stable to no avail. It appears that (attempting to) statically compile always results with the program suffering a segfault.\r\n\r\nWith [Spike](https://github.com/riscv/riscv-isa-sim):\r\n\r\n```\r\n$ spike pk target/riscv64gc-unknown-linux-gnu/debug/riscv-check\r\nbbl loader\r\nz  0000000000000000 ra 0000000000000000 sp 000000007f7e89d0 gp 0000000000000000\r\ntp 0000000000000000 t0 0000000000000000 t1 0000000000000000 t2 0000000000000000\r\ns0 0000000000070818 s1 fffffffffffff8f0 a0 0000000000000000 a1 0000000000000000\r\na2 0000000000000000 a3 0000000000000000 a4 0000000000000001 a5 0000000000000000\r\na6 0000000000000000 a7 0000000000000000 s2 0000000000071000 s3 0000000000000000\r\ns4 0000000000000000 s5 0000000000000000 s6 0000000000000000 s7 0000000000000000\r\ns8 0000000000000000 s9 0000000000000000 sA 0000000000000000 sB 0000000000000000\r\nt3 0000000000000000 t4 0000000000000000 t5 0000000000000000 t6 0000000000000000\r\npc 00000000000102d8 va fffffffffffffac8 insn       ffffffff sr 8000000200046020\r\nUser load segfault @ 0xfffffffffffffac8\r\n```\r\n\r\nWith QEMU:\r\n\r\n```\r\n$ qemu-riscv64 target/riscv64gc-unknown-linux-gnu/debug/riscv-check\r\nSegmentation fault (core dumped)\r\n```\r\n\r\n### Meta\r\n\r\n(stable):\r\n\r\n`rustc --version --verbose`:\r\n```\r\nrustc 1.49.0 (e1884a8e3 2020-12-29)\r\nbinary: rustc\r\ncommit-hash: e1884a8e3c3e813aada8254edfa120e85bf5ffca\r\ncommit-date: 2020-12-29\r\nhost: x86_64-unknown-linux-gnu\r\nrelease: 1.49.0\r\n```\r\n\r\n(nightly):\r\n\r\n`rustc --version --verbose`:\r\n```\r\nrustc 1.51.0-nightly (61f5a0092 2021-01-04)\r\nbinary: rustc\r\ncommit-hash: 61f5a0092364061ec5649ca98d5e3e9b927880fe\r\ncommit-date: 2021-01-04\r\nhost: x86_64-unknown-linux-gnu\r\nrelease: 1.51.0-nightly\r\n```\r\n\r\nNo backtrace is available.\r\n\r\nI am unfortunately not as skilled with Rust internals as I would like to be, so I am uncertain as to how to approach this. Willing to try some suggested solutions!", "closed_by": {"login": "addisoncrump", "id": 10711159, "node_id": "MDQ6VXNlcjEwNzExMTU5", "avatar_url": "https://avatars.githubusercontent.com/u/10711159?v=4", "gravatar_id": "", "url": "https://api.github.com/users/addisoncrump", "html_url": "https://github.com/addisoncrump", "followers_url": "https://api.github.com/users/addisoncrump/followers", "following_url": "https://api.github.com/users/addisoncrump/following{/other_user}", "gists_url": "https://api.github.com/users/addisoncrump/gists{/gist_id}", "starred_url": "https://api.github.com/users/addisoncrump/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/addisoncrump/subscriptions", "organizations_url": "https://api.github.com/users/addisoncrump/orgs", "repos_url": "https://api.github.com/users/addisoncrump/repos", "events_url": "https://api.github.com/users/addisoncrump/events{/privacy}", "received_events_url": "https://api.github.com/users/addisoncrump/received_events", "type": "User", "site_admin": false}, "reactions": {"url": "https://api.github.com/repos/rust-lang/rust/issues/80735/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rust-lang/rust/issues/80735/timeline", "performed_via_github_app": null, "state_reason": "completed"}