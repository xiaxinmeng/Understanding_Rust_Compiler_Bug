{"url": "https://api.github.com/repos/rust-lang/rust/issues/79246", "repository_url": "https://api.github.com/repos/rust-lang/rust", "labels_url": "https://api.github.com/repos/rust-lang/rust/issues/79246/labels{/name}", "comments_url": "https://api.github.com/repos/rust-lang/rust/issues/79246/comments", "events_url": "https://api.github.com/repos/rust-lang/rust/issues/79246/events", "html_url": "https://github.com/rust-lang/rust/issues/79246", "id": 747801966, "node_id": "MDU6SXNzdWU3NDc4MDE5NjY=", "number": 79246, "title": "Performance regression in `1.48.0`", "user": {"login": "marmeladema", "id": 1629419, "node_id": "MDQ6VXNlcjE2Mjk0MTk=", "avatar_url": "https://avatars.githubusercontent.com/u/1629419?v=4", "gravatar_id": "", "url": "https://api.github.com/users/marmeladema", "html_url": "https://github.com/marmeladema", "followers_url": "https://api.github.com/users/marmeladema/followers", "following_url": "https://api.github.com/users/marmeladema/following{/other_user}", "gists_url": "https://api.github.com/users/marmeladema/gists{/gist_id}", "starred_url": "https://api.github.com/users/marmeladema/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/marmeladema/subscriptions", "organizations_url": "https://api.github.com/users/marmeladema/orgs", "repos_url": "https://api.github.com/users/marmeladema/repos", "events_url": "https://api.github.com/users/marmeladema/events{/privacy}", "received_events_url": "https://api.github.com/users/marmeladema/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 113376, "node_id": "MDU6TGFiZWwxMTMzNzY=", "url": "https://api.github.com/repos/rust-lang/rust/labels/I-slow", "name": "I-slow", "color": "e10c02", "default": false, "description": "Problems and improvements with respect to performance of generated code."}, {"id": 211668100, "node_id": "MDU6TGFiZWwyMTE2NjgxMDA=", "url": "https://api.github.com/repos/rust-lang/rust/labels/T-compiler", "name": "T-compiler", "color": "bfd4f2", "default": false, "description": "Relevant to the compiler team, which will review and decide on the PR/issue."}, {"id": 262252840, "node_id": "MDU6TGFiZWwyNjIyNTI4NDA=", "url": "https://api.github.com/repos/rust-lang/rust/labels/regression-from-stable-to-stable", "name": "regression-from-stable-to-stable", "color": "e4008a", "default": false, "description": "Performance or correctness regression from one stable version to another."}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 19, "created_at": "2020-11-20T21:22:56Z", "updated_at": "2022-09-07T17:38:28Z", "closed_at": "2022-09-07T17:38:27Z", "author_association": "CONTRIBUTOR", "active_lock_reason": null, "body": "Hello everyone!\r\n\r\nWe detected a performance regression on a closed-source project after an upgrade of rust from version `1.47.0` to version `1.48.0`.\r\nThe benchmark we run internally are using the low-level `perf_event_open` Linux API to measure various hardware performance counters on specific code section.\r\nThe most stable and reliable counter we care about is the number of retired instructions, corresponding to `instructions:u` in classic `perf` output.\r\n\r\nOn certain datasets, the regressions are up to +16% in the number of instructions executed.\r\n\r\nI used `cargo-bisect-rustc` as instructed on https://rust-lang.zulipchat.com/#narrow/stream/122651-general/topic/Performance.20regressions.20in.201.2E48.2E0 in order to search for the commit that introduced the regression:\r\n\r\n> searched nightlies: from nightly-2020-09-03 to nightly-2020-11-20\r\n> regressed nightly: nightly-2020-09-04\r\n> searched commits: from https://github.com/rust-lang/rust/commit/80fc9b0ecb29050d45b17c64af004200afd3cfc2 to https://github.com/rust-lang/rust/commit/0d0f6b113047b2cf9afbde990cee30fd5b866469\r\n> regressed commit: https://github.com/rust-lang/rust/commit/0d0f6b113047b2cf9afbde990cee30fd5b866469\r\n> \r\n\r\n<details>\r\n<summary>bisected with <a href='https://github.com/rust-lang/cargo-bisect-rustc'>cargo-bisect-rustc</a> v0.6.0</summary>\r\n\r\n\r\nHost triple: x86_64-unknown-linux-gnu\r\nReproduce with:\r\n```bash\r\ncargo bisect-rustc --script=./bisect.sh \r\n```\r\n</details>\r\n\r\nThe bisection points to https://github.com/rust-lang/rust/pull/70793\r\n\r\nI was able to reproduce the regression on two different machines.\r\nI will also try to provide a minimized code example to reproduce the issue but that will take some time as the code being measured is quite big.\r\n\r\nIf anyone else has noticed this regression and could help me towards tools / ideas / whatever that could be of help to reproduce the issue would greatly appreciated!\r\n\r\nEDIT:\r\nMCVE at https://github.com/marmeladema/bitvec-perf-regression\r\n", "closed_by": {"login": "marmeladema", "id": 1629419, "node_id": "MDQ6VXNlcjE2Mjk0MTk=", "avatar_url": "https://avatars.githubusercontent.com/u/1629419?v=4", "gravatar_id": "", "url": "https://api.github.com/users/marmeladema", "html_url": "https://github.com/marmeladema", "followers_url": "https://api.github.com/users/marmeladema/followers", "following_url": "https://api.github.com/users/marmeladema/following{/other_user}", "gists_url": "https://api.github.com/users/marmeladema/gists{/gist_id}", "starred_url": "https://api.github.com/users/marmeladema/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/marmeladema/subscriptions", "organizations_url": "https://api.github.com/users/marmeladema/orgs", "repos_url": "https://api.github.com/users/marmeladema/repos", "events_url": "https://api.github.com/users/marmeladema/events{/privacy}", "received_events_url": "https://api.github.com/users/marmeladema/received_events", "type": "User", "site_admin": false}, "reactions": {"url": "https://api.github.com/repos/rust-lang/rust/issues/79246/reactions", "total_count": 1, "+1": 1, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rust-lang/rust/issues/79246/timeline", "performed_via_github_app": null, "state_reason": "completed"}