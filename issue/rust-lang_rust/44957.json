{"url": "https://api.github.com/repos/rust-lang/rust/issues/44957", "repository_url": "https://api.github.com/repos/rust-lang/rust", "labels_url": "https://api.github.com/repos/rust-lang/rust/issues/44957/labels{/name}", "comments_url": "https://api.github.com/repos/rust-lang/rust/issues/44957/comments", "events_url": "https://api.github.com/repos/rust-lang/rust/issues/44957/events", "html_url": "https://github.com/rust-lang/rust/issues/44957", "id": 261919842, "node_id": "MDU6SXNzdWUyNjE5MTk4NDI=", "number": 44957, "title": "ICE on nightly: src/librustc_typeck/check/mod.rs:2015: no type for node", "user": {"login": "lwe", "id": 83660, "node_id": "MDQ6VXNlcjgzNjYw", "avatar_url": "https://avatars.githubusercontent.com/u/83660?v=4", "gravatar_id": "", "url": "https://api.github.com/users/lwe", "html_url": "https://github.com/lwe", "followers_url": "https://api.github.com/users/lwe/followers", "following_url": "https://api.github.com/users/lwe/following{/other_user}", "gists_url": "https://api.github.com/users/lwe/gists{/gist_id}", "starred_url": "https://api.github.com/users/lwe/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/lwe/subscriptions", "organizations_url": "https://api.github.com/users/lwe/orgs", "repos_url": "https://api.github.com/users/lwe/repos", "events_url": "https://api.github.com/users/lwe/events{/privacy}", "received_events_url": "https://api.github.com/users/lwe/received_events", "type": "User", "site_admin": false}, "labels": [], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 2, "created_at": "2017-10-01T14:26:33Z", "updated_at": "2017-10-01T16:32:04Z", "closed_at": "2017-10-01T16:32:04Z", "author_association": "NONE", "active_lock_reason": null, "body": "When trying to use modules (while learning rust at RustBridge, thanks for RustFest/R\u00f6stiFest ZH), I run into an internal compiler error that used Hmac + SHA256, when placing the `use` statements in the wrong place.\r\n\r\nI tried this code:\r\n\r\n```rust\r\nextern crate sha2;\r\nextern crate hmac;\r\nextern crate base64;\r\n\r\n// Placing the use here is actually a compile error on Rust stable, with\r\n// a fine error message. Moving it to the right place (i.e. inside mod foo) it\r\n// works properly and gives the right error message and not an internal compiler error\r\nuse hmac::{Hmac, Mac};\r\nuse sha2::Sha256;\r\nuse base64::encode;\r\n\r\nmod foo {\r\n    pub fn hmac256(input: String, secret: &[u8]) -> String {\r\n        let mut mac = Hmac::<Sha256>::new(secret);\r\n        mac.input(input.as_bytes());\r\n        let result = mac.result();\r\n        let bytes = result.code();\r\n\r\n        encode(bytes)\r\n    }\r\n}\r\n```\r\n\r\n### I expected to see this happen:\r\n\r\n```text\r\nerror[E0433]: failed to resolve. Use of undeclared type or module `Hmac`\r\n  --> src/lib.rs:12:23\r\n   |\r\n12 |         let mut mac = Hmac::<Sha256>::new(secret);\r\n   |                       ^^^^^^^^^^^^^^^^^^^ Use of undeclared type or module `Hmac`\r\n\r\nerror[E0433]: failed to resolve. Use of undeclared type or module `Hmac`\r\n  --> src/lib.rs:12:23\r\n   |\r\n12 |         let mut mac = Hmac::<Sha256>::new(secret);\r\n   |                       ^^^^^^^^^^^^^^^^^^^ Use of undeclared type or module `Hmac`\r\n\r\nerror[E0412]: cannot find type `Sha256` in this scope\r\n  --> src/lib.rs:12:30\r\n   |\r\n12 |         let mut mac = Hmac::<Sha256>::new(secret);\r\n   |                              ^^^^^^ not found in this scope\r\n   |\r\nhelp: possible candidate is found in another module, you can import it into scope\r\n   |\r\n9  | use sha2::Sha256;\r\n\r\n...and more like these\r\n\r\nerror: aborting due to 3 previous errors\r\n```\r\n\r\n### Instead, this happened: \r\n\r\n```text\r\nerror[E0433]: failed to resolve. Use of undeclared type or module `Hmac`\r\n  --> src/lib.rs:12:23\r\n   |\r\n12 |         let mut mac = Hmac::<Sha256>::new(secret);\r\n   |                       ^^^^ Use of undeclared type or module `Hmac`\r\n\r\nerror[E0433]: failed to resolve. Use of undeclared type or module `Hmac`\r\n  --> src/lib.rs:12:23\r\n   |\r\n12 |         let mut mac = Hmac::<Sha256>::new(secret);\r\n   |                       ^^^^ Use of undeclared type or module `Hmac`\r\n\r\nerror[E0412]: cannot find type `Sha256` in this scope\r\n  --> src/lib.rs:12:30\r\n   |\r\n12 |         let mut mac = Hmac::<Sha256>::new(secret);\r\n   |                              ^^^^^^ not found in this scope\r\n   |\r\nhelp: possible candidate is found in another module, you can import it into scope\r\n   |\r\n11 |     use sha2::Sha256;\r\n   |\r\n\r\nerror[E0425]: cannot find function `encode` in this scope\r\n  --> src/lib.rs:17:9\r\n   |\r\n17 |         encode(bytes)\r\n   |         ^^^^^^ not found in this scope\r\n   |\r\nhelp: possible candidate is found in another module, you can import it into scope\r\n   |\r\n11 |     use base64::encode;\r\n   |\r\n\r\nwarning: unused imports: `Hmac`, `Mac`\r\n --> src/lib.rs:5:12\r\n  |\r\n5 | use hmac::{Hmac, Mac};\r\n  |            ^^^^  ^^^\r\n  |\r\n  = note: #[warn(unused_imports)] on by default\r\n\r\nwarning: unused import: `sha2::Sha256`\r\n --> src/lib.rs:6:5\r\n  |\r\n6 | use sha2::Sha256;\r\n  |     ^^^^^^^^^^^^\r\n\r\nwarning: unused import: `base64::encode`\r\n --> src/lib.rs:7:5\r\n  |\r\n7 | use base64::encode;\r\n  |     ^^^^^^^^^^^^^^\r\n\r\nerror[E0412]: cannot find type `Sha256` in this scope\r\n  --> src/lib.rs:12:30\r\n   |\r\n12 |         let mut mac = Hmac::<Sha256>::new(secret);\r\n   |                              ^^^^^^ not found in this scope\r\n   |\r\nhelp: possible candidate is found in another module, you can import it into scope\r\n   |\r\n11 |     use sha2::Sha256;\r\n   |\r\n\r\nerror[E0425]: cannot find function `encode` in this scope\r\n  --> src/lib.rs:17:9\r\n   |\r\n17 |         encode(bytes)\r\n   |         ^^^^^^ not found in this scope\r\n   |\r\nhelp: possible candidate is found in another module, you can import it into scope\r\n   |\r\n11 |     use base64::encode;\r\n   |\r\n\r\nwarning: unused imports: `Hmac`, `Mac`\r\n --> src/lib.rs:5:12\r\n  |\r\n5 | use hmac::{Hmac, Mac};\r\n  |            ^^^^  ^^^\r\n  |\r\n  = note: #[warn(unused_imports)] on by default\r\n\r\nwarning: unused import: `sha2::Sha256`\r\n --> src/lib.rs:6:5\r\n  |\r\n6 | use sha2::Sha256;\r\n  |     ^^^^^^^^^^^^\r\n\r\nwarning: unused import: `base64::encode`\r\n --> src/lib.rs:7:5\r\n  |\r\n7 | use base64::encode;\r\n  |     ^^^^^^^^^^^^^^\r\n\r\nerror: internal compiler error: src/librustc_typeck/check/mod.rs:2015: no type for node 27: type Sha256 (id=27) in fcx 0x700007762468\r\n\r\nerror: internal compiler error: src/librustc_typeck/check/mod.rs:2015: no type for node 27: type Sha256 (id=27) in fcx 0x700005c7c468\r\n\r\nnote: the compiler unexpectedly panicked. this is a bug.\r\n\r\nnote: we would appreciate a bug report: https://github.com/rust-lang/rust/blob/master/CONTRIBUTING.md#bug-reports\r\n\r\nnote: rustc 1.22.0-nightly (6f87d20a7 2017-09-29) running on x86_64-apple-darwin\r\n\r\nthread 'rustc' panicked at 'Box<Any>', src/librustc_errors/lib.rs:492:8\r\nnote: Run with `RUST_BACKTRACE=1` for a backtrace.\r\n\r\nnote: the compiler unexpectedly panicked. this is a bug.\r\n\r\nnote: we would appreciate a bug report: https://github.com/rust-lang/rust/blob/master/CONTRIBUTING.md#bug-reports\r\n\r\nnote: rustc 1.22.0-nightly (6f87d20a7 2017-09-29) running on x86_64-apple-darwin\r\n```\r\n\r\n### Meta\r\n\r\n```\r\nrustc 1.22.0-nightly (6f87d20a7 2017-09-29)\r\nbinary: rustc\r\ncommit-hash: 6f87d20a7cce70b8cc59a1adf3037d14bc83f237\r\ncommit-date: 2017-09-29\r\nhost: x86_64-apple-darwin\r\nrelease: 1.22.0-nightly\r\nLLVM version: 4.0\r\n```", "closed_by": {"login": "petrochenkov", "id": 5751617, "node_id": "MDQ6VXNlcjU3NTE2MTc=", "avatar_url": "https://avatars.githubusercontent.com/u/5751617?v=4", "gravatar_id": "", "url": "https://api.github.com/users/petrochenkov", "html_url": "https://github.com/petrochenkov", "followers_url": "https://api.github.com/users/petrochenkov/followers", "following_url": "https://api.github.com/users/petrochenkov/following{/other_user}", "gists_url": "https://api.github.com/users/petrochenkov/gists{/gist_id}", "starred_url": "https://api.github.com/users/petrochenkov/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/petrochenkov/subscriptions", "organizations_url": "https://api.github.com/users/petrochenkov/orgs", "repos_url": "https://api.github.com/users/petrochenkov/repos", "events_url": "https://api.github.com/users/petrochenkov/events{/privacy}", "received_events_url": "https://api.github.com/users/petrochenkov/received_events", "type": "User", "site_admin": false}, "reactions": {"url": "https://api.github.com/repos/rust-lang/rust/issues/44957/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rust-lang/rust/issues/44957/timeline", "performed_via_github_app": null, "state_reason": "completed"}