{"url": "https://api.github.com/repos/rust-lang/rust/issues/26233", "repository_url": "https://api.github.com/repos/rust-lang/rust", "labels_url": "https://api.github.com/repos/rust-lang/rust/issues/26233/labels{/name}", "comments_url": "https://api.github.com/repos/rust-lang/rust/issues/26233/comments", "events_url": "https://api.github.com/repos/rust-lang/rust/issues/26233/events", "html_url": "https://github.com/rust-lang/rust/issues/26233", "id": 87576919, "node_id": "MDU6SXNzdWU4NzU3NjkxOQ==", "number": 26233, "title": "Internal compiler error", "user": {"login": "maurizi", "id": 4432106, "node_id": "MDQ6VXNlcjQ0MzIxMDY=", "avatar_url": "https://avatars.githubusercontent.com/u/4432106?v=4", "gravatar_id": "", "url": "https://api.github.com/users/maurizi", "html_url": "https://github.com/maurizi", "followers_url": "https://api.github.com/users/maurizi/followers", "following_url": "https://api.github.com/users/maurizi/following{/other_user}", "gists_url": "https://api.github.com/users/maurizi/gists{/gist_id}", "starred_url": "https://api.github.com/users/maurizi/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/maurizi/subscriptions", "organizations_url": "https://api.github.com/users/maurizi/orgs", "repos_url": "https://api.github.com/users/maurizi/repos", "events_url": "https://api.github.com/users/maurizi/events{/privacy}", "received_events_url": "https://api.github.com/users/maurizi/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 9618520, "node_id": "MDU6TGFiZWw5NjE4NTIw", "url": "https://api.github.com/repos/rust-lang/rust/labels/I-ICE", "name": "I-ICE", "color": "e10c02", "default": false, "description": "Issue: The compiler panicked, giving an Internal Compilation Error (ICE) \u2744\ufe0f"}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 3, "created_at": "2015-06-12T02:19:58Z", "updated_at": "2017-05-13T19:35:15Z", "closed_at": "2017-05-13T19:35:15Z", "author_association": "NONE", "active_lock_reason": null, "body": "I'm using an MSYS2 shell on Windows 7 64bit.  I tested this on 1.0, the 1.1 beta, and the latest nightly (`rustc 1.1.0-nightly (21f278a68 2015-04-23) (built 2015-04-24)`).\n\nWhen I try to compile https://github.com/maurizi/rsnotify/commit/68db23b90b1d0ec27c2eaca8776049f527535c45 using `cargo build --verbose` I get the following error:\n\n```\n$ cargo build --verbose\n       Fresh libc v0.1.8\n       Fresh walker v1.0.0\n       Fresh gcc v0.3.8\n       Fresh bitflags v0.2.1\n       Fresh log v0.3.1\n       Fresh winapi v0.1.20\n       Fresh kernel32-sys v0.1.0\n   Compiling notify v2.0.0 (file:///C:/Users/Mike/Documents/code/rsnotify)\n     Running `rustc src\\lib.rs --crate-name notify --crate-type lib -g -C metadata=680f9051ec03eca4 -C extra-filename=-680f9051ec03eca4 --out-dir C:\\Users\\Mike\\Documents\\code\\rsnotify\\target\\debug --emit=dep-info,link -L dependency=C:\\Users\\Mike\\Documents\\code\\rsnotify\\target\\debug -L dependency=C:\\Users\\Mike\\Documents\\code\\rsnotify\\target\\debug\\deps --extern libc=C:\\Users\\Mike\\Documents\\code\\rsnotify\\target\\debug\\deps\\liblibc-2eda841eb12a3090.rlib --extern time=C:\\Users\\Mike\\Documents\\code\\rsnotify\\target\\debug\\deps\\libtime-f08bec52f4924e95.rlib --extern kernel32=C:\\Users\\Mike\\Documents\\code\\rsnotify\\target\\debug\\deps\\libkernel32-852914e74bb6c4c5.rlib --extern bitflags=C:\\Users\\Mike\\Documents\\code\\rsnotify\\target\\debug\\deps\\libbitflags-6ad6262463ad8b4b.rlib --extern walker=C:\\Users\\Mike\\Documents\\code\\rsnotify\\target\\debug\\deps\\libwalker-80db320aa147f996.rlib --extern log=C:\\Users\\Mike\\Documents\\code\\rsnotify\\target\\debug\\deps\\liblog-54cf393d3c69686f.rlib --extern winapi=C:\\Users\\Mike\\Documents\\code\\rsnotify\\target\\debug\\deps\\libwinapi-529c97af7e4635ff.rlib -L native=C:\\Users\\Mike\\Documents\\code\\rsnotify\\target\\debug\\build\\time-f08bec52f4924e95\\out`\n       Fresh time v0.1.26\nsrc\\windows.rs:19:27: 19:29 warning: unused import, #[warn(unused_imports)] on by default\nsrc\\windows.rs:19 use super::{Event, Error, op, Op, Watcher};\n                                            ^~\nsrc\\windows.rs:19:31: 19:33 warning: unused import, #[warn(unused_imports)] on by default\nsrc\\windows.rs:19 use super::{Event, Error, op, Op, Watcher};\n                                                ^~\nsrc\\windows.rs:31:5: 31:22 warning: struct field is never used: `tx`, #[warn(dead_code)] on by default\nsrc\\windows.rs:31     tx: Sender<Event>,\n                      ^~~~~~~~~~~~~~~~~\nsrc\\windows.rs:33:5: 33:19 warning: struct field is never used: `handle`, #[warn(dead_code)] on by default\nsrc\\windows.rs:33     handle: HANDLE\n                      ^~~~~~~~~~~~~~\nsrc\\windows.rs:82:17: 86:20 warning: unused result which must be used, #[warn(unused_must_use)] on by default\nsrc\\windows.rs:82                 self.tx.send(Event {\nsrc\\windows.rs:83                     path: None,\nsrc\\windows.rs:84                     // TODO: Call GetLastError for better error info?\nsrc\\windows.rs:85                     op: Err(Error::WatchNotFound)\nsrc\\windows.rs:86                 });\nsrc\\windows.rs:118:17: 118:24 warning: unused variable: `success`, #[warn(unused_variables)] on by default\nsrc\\windows.rs:118             let success = kernel32::ReadDirectoryChangesW(\n                                   ^~~~~~~\nsrc\\windows.rs:144:56: 144:61 warning: unused variable: `bytes`, #[warn(unused_variables)] on by default\nsrc\\windows.rs:144 unsafe extern \"system\" fn handle_event(errorCode: u32, bytes: u32, overlapped: LPOVERLAPPED) {\n                                                                          ^~~~~\nsrc\\windows.rs:151:9: 151:16 warning: unused variable: `request`, #[warn(unused_variables)] on by default\nsrc\\windows.rs:151     let request: Box<ReadDirectoryRequest> = mem::transmute((*overlapped).hEvent);\n                           ^~~~~~~\nsrc\\windows.rs:144:40: 144:49 warning: variable `errorCode` should have a snake case name such as `error_code`, #[warn(non_snake_case)] on by default\nsrc\\windows.rs:144 unsafe extern \"system\" fn handle_event(errorCode: u32, bytes: u32, overlapped: LPOVERLAPPED) {\n                                                          ^~~~~~~~~\nsrc\\windows.rs:168:9: 168:57 warning: unused result which must be used, #[warn(unused_must_use)] on by default\nsrc\\windows.rs:168         self.tx.send(Action::Watch(path.to_path_buf()));\n                           ^~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~\nsrc\\windows.rs:173:9: 173:59 warning: unused result which must be used, #[warn(unused_must_use)] on by default\nsrc\\windows.rs:173         self.tx.send(Action::Unwatch(path.to_path_buf()));\n                           ^~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~\nsrc\\windows.rs:180:9: 180:36 warning: unused result which must be used, #[warn(unused_must_use)] on by default\nsrc\\windows.rs:180         self.tx.send(Action::Stop);\n                           ^~~~~~~~~~~~~~~~~~~~~~~~~~~\n\nThis application has requested the Runtime to terminate it in an unusual way.\nPlease contact the application's support team for more information.\nAssertion failed!\n\nProgram: C:\\Programs\\Rust\\bin\\rustc.exe\nFile: C:/bot/slave/nightly-dist-rustc-win-64/build/src/llvm/include/llvm/IR/Instructions.h, Line 782\n\nExpression: Ty && \"Invalid GetElementPtrInst indices for type!\"\nCould not compile `notify`.\n\nCaused by:\n  Process didn't exit successfully: `rustc src\\lib.rs --crate-name notify --crate-type lib -g -C metadata=680f9051ec03eca4 -C extra-filename=-680f9051ec03eca4 --out-dir C:\\Users\\Mike\\Documents\\code\\rsnotify\\target\\debug --emit=dep-info,link -L dependency=C:\\Users\\Mike\\Documents\\code\\rsnotify\\target\\debug -L dependency=C:\\Users\\Mike\\Documents\\code\\rsnotify\\target\\debug\\deps --extern libc=C:\\Users\\Mike\\Documents\\code\\rsnotify\\target\\debug\\deps\\liblibc-2eda841eb12a3090.rlib --extern time=C:\\Users\\Mike\\Documents\\code\\rsnotify\\target\\debug\\deps\\libtime-f08bec52f4924e95.rlib --extern kernel32=C:\\Users\\Mike\\Documents\\code\\rsnotify\\target\\debug\\deps\\libkernel32-852914e74bb6c4c5.rlib --extern bitflags=C:\\Users\\Mike\\Documents\\code\\rsnotify\\target\\debug\\deps\\libbitflags-6ad6262463ad8b4b.rlib --extern walker=C:\\Users\\Mike\\Documents\\code\\rsnotify\\target\\debug\\deps\\libwalker-80db320aa147f996.rlib --extern log=C:\\Users\\Mike\\Documents\\code\\rsnotify\\target\\debug\\deps\\liblog-54cf393d3c69686f.rlib --extern winapi=C:\\Users\\Mike\\Documents\\code\\rsnotify\\target\\debug\\deps\\libwinapi-529c97af7e4635ff.rlib -L native=C:\\Users\\Mike\\Documents\\code\\rsnotify\\target\\debug\\build\\time-f08bec52f4924e95\\out` (exit code: 3)\n```\n\nIf I comment out the body of this function it will successfully compile https://github.com/maurizi/rsnotify/commit/fc287780b8c496c45dd26f8131cff8e6acd91be7.  Though it seems to be the `if let` statement causing the issue: if I leave out the `unsafe` body in the `if let` block, I still get an ICE\n", "closed_by": {"login": "Mark-Simulacrum", "id": 5047365, "node_id": "MDQ6VXNlcjUwNDczNjU=", "avatar_url": "https://avatars.githubusercontent.com/u/5047365?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Mark-Simulacrum", "html_url": "https://github.com/Mark-Simulacrum", "followers_url": "https://api.github.com/users/Mark-Simulacrum/followers", "following_url": "https://api.github.com/users/Mark-Simulacrum/following{/other_user}", "gists_url": "https://api.github.com/users/Mark-Simulacrum/gists{/gist_id}", "starred_url": "https://api.github.com/users/Mark-Simulacrum/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Mark-Simulacrum/subscriptions", "organizations_url": "https://api.github.com/users/Mark-Simulacrum/orgs", "repos_url": "https://api.github.com/users/Mark-Simulacrum/repos", "events_url": "https://api.github.com/users/Mark-Simulacrum/events{/privacy}", "received_events_url": "https://api.github.com/users/Mark-Simulacrum/received_events", "type": "User", "site_admin": false}, "reactions": {"url": "https://api.github.com/repos/rust-lang/rust/issues/26233/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rust-lang/rust/issues/26233/timeline", "performed_via_github_app": null, "state_reason": "completed"}