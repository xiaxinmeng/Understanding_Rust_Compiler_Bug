{"url": "https://api.github.com/repos/rust-lang/rust/issues/43080", "repository_url": "https://api.github.com/repos/rust-lang/rust", "labels_url": "https://api.github.com/repos/rust-lang/rust/issues/43080/labels{/name}", "comments_url": "https://api.github.com/repos/rust-lang/rust/issues/43080/comments", "events_url": "https://api.github.com/repos/rust-lang/rust/issues/43080/events", "html_url": "https://github.com/rust-lang/rust/issues/43080", "id": 240820852, "node_id": "MDU6SXNzdWUyNDA4MjA4NTI=", "number": 43080, "title": "Rustc does not emit assembly for msp430 backend", "user": {"login": "cr1901", "id": 6418027, "node_id": "MDQ6VXNlcjY0MTgwMjc=", "avatar_url": "https://avatars.githubusercontent.com/u/6418027?v=4", "gravatar_id": "", "url": "https://api.github.com/users/cr1901", "html_url": "https://github.com/cr1901", "followers_url": "https://api.github.com/users/cr1901/followers", "following_url": "https://api.github.com/users/cr1901/following{/other_user}", "gists_url": "https://api.github.com/users/cr1901/gists{/gist_id}", "starred_url": "https://api.github.com/users/cr1901/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/cr1901/subscriptions", "organizations_url": "https://api.github.com/users/cr1901/orgs", "repos_url": "https://api.github.com/users/cr1901/repos", "events_url": "https://api.github.com/users/cr1901/events{/privacy}", "received_events_url": "https://api.github.com/users/cr1901/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 211668100, "node_id": "MDU6TGFiZWwyMTE2NjgxMDA=", "url": "https://api.github.com/repos/rust-lang/rust/labels/T-compiler", "name": "T-compiler", "color": "bfd4f2", "default": false, "description": "Relevant to the compiler team, which will review and decide on the PR/issue."}, {"id": 650731663, "node_id": "MDU6TGFiZWw2NTA3MzE2NjM=", "url": "https://api.github.com/repos/rust-lang/rust/labels/C-bug", "name": "C-bug", "color": "f5f1fd", "default": false, "description": "Category: This is a bug."}, {"id": 4434140250, "node_id": "LA_kwDOAAsO6M8AAAABCEucWg", "url": "https://api.github.com/repos/rust-lang/rust/labels/O-msp430", "name": "O-msp430", "color": "6e6ec0", "default": false, "description": ""}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 3, "created_at": "2017-07-06T01:37:39Z", "updated_at": "2022-08-18T20:17:10Z", "closed_at": "2022-08-18T20:17:10Z", "author_association": "CONTRIBUTOR", "active_lock_reason": null, "body": "I had a need to check the generated assembly for a project I'm working on using the msp430 backend, but I am unable to get rustc to generate an assembly file with certain flags.\r\n\r\n## Problem\r\n\r\nUsing `rustc` to emit assembly causes the following error on the msp430 backend:\r\n\r\n```\r\nWilliam@William-THINK MINGW32 ~/prj/Legacy/PC/HARDWARE/AT2XT\r\n$ xargo rustc --release --target msp430 -v -- --emit=asm\r\n+ \"rustc\" \"--print\" \"sysroot\"\r\n+ \"rustc\" \"--print\" \"target-list\"\r\n+ \"cargo\" \"rustc\" \"--release\" \"--target\" \"msp430\" \"-v\" \"--\" \"--emit=asm\"\r\n       Fresh volatile-register v0.1.2\r\n       Fresh bit_reverse v0.1.6-pre (https://github.com/cr1901/bit_reverse?branch=patch-1#ea57cab8)\r\n   Compiling at2xt v0.1.0 (file:///C:/msys64/home/William/prj/Legacy/PC/HARDWARE/AT2XT)\r\n     Running `rustc --crate-name at2xt 'src\\main.rs' --crate-type bin --emit=dep-info,link -C opt-level=3 -C lto -C debuginfo=2 --emit=asm -C metadata=2cff10aa3a17e8e8 -C extra-filename=-2cff10aa3a17e8e8 --out-dir 'C:\\msys64\\home\\William\\prj\\Legacy\\PC\\HARDWARE\\AT2XT\\target\\msp430\\release\\deps' --target msp430 -L 'dependency=C:\\msys64\\home\\William\\prj\\Legacy\\PC\\HARDWARE\\AT2XT\\target\\msp430\\release\\deps' -L 'dependency=C:\\msys64\\home\\William\\prj\\Legacy\\PC\\HARDWARE\\AT2XT\\target\\release\\deps' --extern 'volatile_register=C:\\msys64\\home\\William\\prj\\Legacy\\PC\\HARDWARE\\AT2XT\\target\\msp430\\release\\deps\\libvolatile_register-6cd680bd4718bf91.rlib' --extern 'bit_reverse=C:\\msys64\\home\\William\\prj\\Legacy\\PC\\HARDWARE\\AT2XT\\target\\msp430\\release\\deps\\libbit_reverse-f0ca07b3a5660ef3.rlib' -C link-arg=-Tmsp430g2211.ld -C link-arg=-mmcu=msp430g2211 -C link-arg=-nostartfiles --sysroot 'C:\\msys64\\home\\William\\.xargo' -L 'C:\\msys64\\home\\William\\prj\\Legacy\\PC\\HARDWARE\\AT2XT\\target\\msp430\\release\\build\\at2xt-68587409a68b5cea\\out'`\r\n\r\nsnip a bunch of warnings...\r\n\r\nerror: failed to remove C:\\msys64\\home\\William\\prj\\Legacy\\PC\\HARDWARE\\AT2XT\\target\\msp430\\release\\deps\\at2xt-2cff10aa3a17e8e8.crate.metadata.o: The system cannot find the file specified. (os error 2)\r\n\r\n    Finished release [optimized + debuginfo] target(s) in 1.55 secs\r\n```\r\n\r\nSubsequent runs of `xargo` or `cargo` succeed, but no output assembly file is generated. Running `rustc` directly always results in a file not found error.\r\n\r\n@japaric encountered the same issue with missing crate metadata when compiling his [msp430-quickstart](https://github.com/japaric/msp430-quickstart) repository with the following settings (I am unable to compile the linked repo for unrelated reasons, currently):\r\n\r\n`xargo rustc --release --example blinky -- --emit=asm`\r\n\r\nHowever, an assembly file is successfully generated with the following command line:\r\n`rustc --target msp430-none-elf --emit=asm empty.rs --sysroot ~/.xargo -g`\r\n\r\n## Expected\r\n\r\nI would expect the output assembly file to be under the target directory (when using `cargo`), regardless of the flags beside --emit=asm I pass `rustc`.\r\n\r\n## Meta \r\n\r\n```\r\nrustc --version --verbose\r\nrustc 1.19.0-nightly (e2eaef849 2017-06-11)\r\nbinary: rustc\r\ncommit-hash: e2eaef8497bd212694840515a568d592b17d0e07\r\ncommit-date: 2017-06-11\r\nhost: x86_64-pc-windows-gnu\r\nrelease: 1.19.0-nightly\r\nLLVM version: 4.0\r\n```\r\n\r\nBacktrace does not print any extra information.", "closed_by": {"login": "workingjubilee", "id": 46493976, "node_id": "MDQ6VXNlcjQ2NDkzOTc2", "avatar_url": "https://avatars.githubusercontent.com/u/46493976?v=4", "gravatar_id": "", "url": "https://api.github.com/users/workingjubilee", "html_url": "https://github.com/workingjubilee", "followers_url": "https://api.github.com/users/workingjubilee/followers", "following_url": "https://api.github.com/users/workingjubilee/following{/other_user}", "gists_url": "https://api.github.com/users/workingjubilee/gists{/gist_id}", "starred_url": "https://api.github.com/users/workingjubilee/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/workingjubilee/subscriptions", "organizations_url": "https://api.github.com/users/workingjubilee/orgs", "repos_url": "https://api.github.com/users/workingjubilee/repos", "events_url": "https://api.github.com/users/workingjubilee/events{/privacy}", "received_events_url": "https://api.github.com/users/workingjubilee/received_events", "type": "User", "site_admin": false}, "reactions": {"url": "https://api.github.com/repos/rust-lang/rust/issues/43080/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rust-lang/rust/issues/43080/timeline", "performed_via_github_app": null, "state_reason": "completed"}