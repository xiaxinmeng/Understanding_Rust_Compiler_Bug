{"url": "https://api.github.com/repos/rust-lang/rust/issues/26422", "repository_url": "https://api.github.com/repos/rust-lang/rust", "labels_url": "https://api.github.com/repos/rust-lang/rust/issues/26422/labels{/name}", "comments_url": "https://api.github.com/repos/rust-lang/rust/issues/26422/comments", "events_url": "https://api.github.com/repos/rust-lang/rust/issues/26422/events", "html_url": "https://github.com/rust-lang/rust/issues/26422", "id": 89477428, "node_id": "MDU6SXNzdWU4OTQ3NzQyOA==", "number": 26422, "title": "Simplest rust program fails DRD testing", "user": {"login": "jethrogb", "id": 1132307, "node_id": "MDQ6VXNlcjExMzIzMDc=", "avatar_url": "https://avatars.githubusercontent.com/u/1132307?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jethrogb", "html_url": "https://github.com/jethrogb", "followers_url": "https://api.github.com/users/jethrogb/followers", "following_url": "https://api.github.com/users/jethrogb/following{/other_user}", "gists_url": "https://api.github.com/users/jethrogb/gists{/gist_id}", "starred_url": "https://api.github.com/users/jethrogb/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jethrogb/subscriptions", "organizations_url": "https://api.github.com/users/jethrogb/orgs", "repos_url": "https://api.github.com/users/jethrogb/repos", "events_url": "https://api.github.com/users/jethrogb/events{/privacy}", "received_events_url": "https://api.github.com/users/jethrogb/received_events", "type": "User", "site_admin": false}, "labels": [], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 2, "created_at": "2015-06-19T06:05:10Z", "updated_at": "2015-06-19T06:46:21Z", "closed_at": "2015-06-19T06:27:07Z", "author_association": "CONTRIBUTOR", "active_lock_reason": null, "body": "Running this program with [DRD](http://valgrind.org/docs/manual/drd-manual.html) always fails:\n\n``` rust\nfn main() {}\n```\n\nThis makes debugging Rust programs with Valgrind rather difficult.\n\n> DRD is a Valgrind tool for detecting errors in multithreaded ... programs. The tool works for any program that uses the POSIX threading primitives or that uses threading concepts built on top of the POSIX threading primitives.\n\nRun like this:\n\n```\n$ rustc --crate-name drd_test <(echo 'fn main() {}')\n$ valgrind --tool=drd ./drd_test\n==17924== drd, a thread error detector\n==17924== Copyright (C) 2006-2013, and GNU GPL'd, by Bart Van Assche.\n==17924== Using Valgrind-3.10.0.SVN and LibVEX; rerun with -h for copyright info\n==17924== Command: ./drd_test\n==17924== \n==17924== The object at address 0x681d000 is not a mutex.\n==17924==    at 0x4C33490: pthread_mutex_destroy (in /usr/lib/valgrind/vgpreload_drd-amd64-linux.so)\n==17924==    by 0x10ED41: thread..Inner::drop.31331::h7fa8699801e80eb9 (in /tmp/vgt/drd_test)\n==17924==    by 0x10EC9F: arc::Arc$LT$T$GT$::drop_slow::h13699404093858071360 (in /tmp/vgt/drd_test)\n==17924==    by 0x1108B8: thread::local::imp::destroy_value::h10583414996118204401 (in /tmp/vgt/drd_test)\n==17924==    by 0x56C38D5: __call_tls_dtors (cxa_thread_atexit_impl.c:88)\n==17924==    by 0x56C3196: __run_exit_handlers (exit.c:40)\n==17924==    by 0x56C32A4: exit (exit.c:104)\n==17924==    by 0x56A8ECB: (below main) (libc-start.c:321)\n==17924== \n==17924== not a condition variable: cond 0x6820000\n==17924==    at 0x4C34F97: pthread_cond_destroy@* (in /usr/lib/valgrind/vgpreload_drd-amd64-linux.so)\n==17924==    by 0x10ED6A: thread..Inner::drop.31331::h7fa8699801e80eb9 (in /tmp/vgt/drd_test)\n==17924==    by 0x10EC9F: arc::Arc$LT$T$GT$::drop_slow::h13699404093858071360 (in /tmp/vgt/drd_test)\n==17924==    by 0x1108B8: thread::local::imp::destroy_value::h10583414996118204401 (in /tmp/vgt/drd_test)\n==17924==    by 0x56C38D5: __call_tls_dtors (cxa_thread_atexit_impl.c:88)\n==17924==    by 0x56C3196: __run_exit_handlers (exit.c:40)\n==17924==    by 0x56C32A4: exit (exit.c:104)\n==17924==    by 0x56A8ECB: (below main) (libc-start.c:321)\n==17924== \n==17924== \n==17924== For counts of detected and suppressed errors, rerun with: -v\n==17924== ERROR SUMMARY: 2 errors from 2 contexts (suppressed: 0 from 0)\n```\n\nTested on stable (Linux) and nightly (unknown OS).\n", "closed_by": {"login": "alexcrichton", "id": 64996, "node_id": "MDQ6VXNlcjY0OTk2", "avatar_url": "https://avatars.githubusercontent.com/u/64996?v=4", "gravatar_id": "", "url": "https://api.github.com/users/alexcrichton", "html_url": "https://github.com/alexcrichton", "followers_url": "https://api.github.com/users/alexcrichton/followers", "following_url": "https://api.github.com/users/alexcrichton/following{/other_user}", "gists_url": "https://api.github.com/users/alexcrichton/gists{/gist_id}", "starred_url": "https://api.github.com/users/alexcrichton/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/alexcrichton/subscriptions", "organizations_url": "https://api.github.com/users/alexcrichton/orgs", "repos_url": "https://api.github.com/users/alexcrichton/repos", "events_url": "https://api.github.com/users/alexcrichton/events{/privacy}", "received_events_url": "https://api.github.com/users/alexcrichton/received_events", "type": "User", "site_admin": false}, "reactions": {"url": "https://api.github.com/repos/rust-lang/rust/issues/26422/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rust-lang/rust/issues/26422/timeline", "performed_via_github_app": null, "state_reason": "completed"}