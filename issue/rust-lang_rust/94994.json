{"url": "https://api.github.com/repos/rust-lang/rust/issues/94994", "repository_url": "https://api.github.com/repos/rust-lang/rust", "labels_url": "https://api.github.com/repos/rust-lang/rust/issues/94994/labels{/name}", "comments_url": "https://api.github.com/repos/rust-lang/rust/issues/94994/comments", "events_url": "https://api.github.com/repos/rust-lang/rust/issues/94994/events", "html_url": "https://github.com/rust-lang/rust/issues/94994", "id": 1170726331, "node_id": "I_kwDOAAsO6M5Fx927", "number": 94994, "title": "removal of #![feature(rustc_private)] from library/std/src/lib.rs", "user": {"login": "krasimirgg", "id": 29306214, "node_id": "MDQ6VXNlcjI5MzA2MjE0", "avatar_url": "https://avatars.githubusercontent.com/u/29306214?v=4", "gravatar_id": "", "url": "https://api.github.com/users/krasimirgg", "html_url": "https://github.com/krasimirgg", "followers_url": "https://api.github.com/users/krasimirgg/followers", "following_url": "https://api.github.com/users/krasimirgg/following{/other_user}", "gists_url": "https://api.github.com/users/krasimirgg/gists{/gist_id}", "starred_url": "https://api.github.com/users/krasimirgg/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/krasimirgg/subscriptions", "organizations_url": "https://api.github.com/users/krasimirgg/orgs", "repos_url": "https://api.github.com/users/krasimirgg/repos", "events_url": "https://api.github.com/users/krasimirgg/events{/privacy}", "received_events_url": "https://api.github.com/users/krasimirgg/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 650731663, "node_id": "MDU6TGFiZWw2NTA3MzE2NjM=", "url": "https://api.github.com/repos/rust-lang/rust/labels/C-bug", "name": "C-bug", "color": "f5f1fd", "default": false, "description": "Category: This is a bug."}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 4, "created_at": "2022-03-16T09:01:13Z", "updated_at": "2022-03-17T15:11:47Z", "closed_at": "2022-03-17T15:11:47Z", "author_association": "CONTRIBUTOR", "active_lock_reason": null, "body": "`#![feature(rustc_private)]` was removed from from library/std/src/lib.rs:\r\n https://github.com/rust-lang/rust/commit/9b952b7d3a9dc7961f14257c3fe20955ca4d2a50#diff-317b30ba653f20600042781487d517ae7d07547466b074d09d521f0b9b6ccc52L322 \r\n\r\nWith this removal we're hitting some errors while trying to build std in a non-standard way (we're using a build system not based on cargo that directly invokes rustc).\r\n\r\nE.g., the first error is with\r\nhttps://github.com/rust-lang/rust/blob/040703018c51409ea8c9a0cfb8f829a138d2a411/library/std/src/lib.rs#L342\r\n\r\n```use of unstable library feature 'rustc_private': this crate is being loaded from the sysroot, an unstable location; did you mean to load this crate from crates.io via Cargo.toml instead?```\r\n\r\nIn the rustc invocation used to build std, we pass the freshly built `liblibc-hash.rlib` explicitly as `--extern=libc=/path/to/liblibc-hash.rlib` (so we don't fall back to the one shipped in sysroot). It looks something like this:\r\n```\r\nrustc library/std/src/lib.rs '--crate-name=std' '--crate-type=rlib' '--codegen=metadata=-3081440274' '--out-dir=out/library' '--codegen=extra-filename=-3081440274' '--codegen=opt-level=0' '--codegen=debuginfo=0' '--emit=dep-info,link' '--target=x86_64-unknown-linux-gnu' --cfg 'feature=\"panic-unwind\"' --cfg 'feature=\"panic_unwind\"' -L out/sysroot/lib/rustlib/x86_64-unknown-linux-gnu/lib '--cap-lints=allow' '--cfg=backtrace_in_libstd' '--edition=2021' '--extern=alloc=out/library/liballoc-920149358.rlib' '--extern=cfg_if=out/library/libcfg_if-758618211.rlib' '--extern=compiler_builtins=out/library/libcompiler_builtins-1222639411.rlib' '--extern=core=out/library/libcore-2654552028.rlib' '--extern=hashbrown=out/library/libhashbrown-1695356372.rlib' '--extern=libc=out/library/liblibc-1897545208.rlib' '--extern=panic_abort=out/library/libpanic_abort-1221776718.rlib' '--extern=panic_unwind=out/library/libpanic_unwind-3508143516.rlib' '--extern=rustc_demangle=out/library/librustc_demangle-49950267.rlib' '--extern=std_detect=out/library/libstd_detect-610578543.rlib' '--extern=unwind=out/library/libunwind-179902500.rlib' '-Ldependency=out/library'\r\n```\r\n\r\nDoes it make sense to add rustc_private back, or alternatively do you have suggestions how to adapt the rustc invocation to avoid the unstable library feature rustc_private error?", "closed_by": {"login": "krasimirgg", "id": 29306214, "node_id": "MDQ6VXNlcjI5MzA2MjE0", "avatar_url": "https://avatars.githubusercontent.com/u/29306214?v=4", "gravatar_id": "", "url": "https://api.github.com/users/krasimirgg", "html_url": "https://github.com/krasimirgg", "followers_url": "https://api.github.com/users/krasimirgg/followers", "following_url": "https://api.github.com/users/krasimirgg/following{/other_user}", "gists_url": "https://api.github.com/users/krasimirgg/gists{/gist_id}", "starred_url": "https://api.github.com/users/krasimirgg/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/krasimirgg/subscriptions", "organizations_url": "https://api.github.com/users/krasimirgg/orgs", "repos_url": "https://api.github.com/users/krasimirgg/repos", "events_url": "https://api.github.com/users/krasimirgg/events{/privacy}", "received_events_url": "https://api.github.com/users/krasimirgg/received_events", "type": "User", "site_admin": false}, "reactions": {"url": "https://api.github.com/repos/rust-lang/rust/issues/94994/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rust-lang/rust/issues/94994/timeline", "performed_via_github_app": null, "state_reason": "completed"}