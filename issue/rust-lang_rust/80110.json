{"url": "https://api.github.com/repos/rust-lang/rust/issues/80110", "repository_url": "https://api.github.com/repos/rust-lang/rust", "labels_url": "https://api.github.com/repos/rust-lang/rust/issues/80110/labels{/name}", "comments_url": "https://api.github.com/repos/rust-lang/rust/issues/80110/comments", "events_url": "https://api.github.com/repos/rust-lang/rust/issues/80110/events", "html_url": "https://github.com/rust-lang/rust/issues/80110", "id": 769741458, "node_id": "MDU6SXNzdWU3Njk3NDE0NTg=", "number": 80110, "title": "Unsoundness with subtyping of function types", "user": {"login": "jhjourdan", "id": 1917144, "node_id": "MDQ6VXNlcjE5MTcxNDQ=", "avatar_url": "https://avatars.githubusercontent.com/u/1917144?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jhjourdan", "html_url": "https://github.com/jhjourdan", "followers_url": "https://api.github.com/users/jhjourdan/followers", "following_url": "https://api.github.com/users/jhjourdan/following{/other_user}", "gists_url": "https://api.github.com/users/jhjourdan/gists{/gist_id}", "starred_url": "https://api.github.com/users/jhjourdan/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jhjourdan/subscriptions", "organizations_url": "https://api.github.com/users/jhjourdan/orgs", "repos_url": "https://api.github.com/users/jhjourdan/repos", "events_url": "https://api.github.com/users/jhjourdan/events{/privacy}", "received_events_url": "https://api.github.com/users/jhjourdan/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 650731663, "node_id": "MDU6TGFiZWw2NTA3MzE2NjM=", "url": "https://api.github.com/repos/rust-lang/rust/labels/C-bug", "name": "C-bug", "color": "f5f1fd", "default": false, "description": "Category: This is a bug."}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 2, "created_at": "2020-12-17T09:13:46Z", "updated_at": "2020-12-17T09:55:07Z", "closed_at": "2020-12-17T09:55:07Z", "author_association": "CONTRIBUTOR", "active_lock_reason": null, "body": "Consider this piece of Rust code:\r\n\r\n```rust\r\nfn f<'a, 'b>(_ : &'b &'a (), r : &'a i32) -> &'b i32 {\r\n    r\r\n}\r\n\r\nconst R : &'static () = &();\r\n\r\nfn evil<'a, 'b>(x : &'a i32) -> &'b i32 {\r\n    let f2 : fn(&'b &'static (), &'a i32) -> &'b i32 = f;\r\n\r\n    // variant :\r\n    // let f2 : for<'fa, 'fb> fn(&'fb &'static (), &'fa i32) -> &'fb i32 = f;\r\n\r\n    f2(&R, x)\r\n}\r\n\r\nfn main() {}\r\n\r\n```\r\n\r\nThe function evil let's us change the lifetime of a borrow /without/ any constraint of the old and new lifetimes. This is clearly unsound. I tried with the current nightly version of Rust, which compiles this piece of code without error (only warnings).\r\n\r\nThe core idea of the bug is that the function `f` coerces the borrow r using the implicit constraint `'a : `'b` coming from the type of the other parameter. When coercing the type of the function `f` to `f2`, this implicit constraint is lost, so that we can call it with two unrelated lifetimes.\r\n\r\nI found this bug while trying to properly formalize subtyping for function types in the context of the RustBelt project.\r\n\r\nCc @RalfJung ", "closed_by": {"login": "jhjourdan", "id": 1917144, "node_id": "MDQ6VXNlcjE5MTcxNDQ=", "avatar_url": "https://avatars.githubusercontent.com/u/1917144?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jhjourdan", "html_url": "https://github.com/jhjourdan", "followers_url": "https://api.github.com/users/jhjourdan/followers", "following_url": "https://api.github.com/users/jhjourdan/following{/other_user}", "gists_url": "https://api.github.com/users/jhjourdan/gists{/gist_id}", "starred_url": "https://api.github.com/users/jhjourdan/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jhjourdan/subscriptions", "organizations_url": "https://api.github.com/users/jhjourdan/orgs", "repos_url": "https://api.github.com/users/jhjourdan/repos", "events_url": "https://api.github.com/users/jhjourdan/events{/privacy}", "received_events_url": "https://api.github.com/users/jhjourdan/received_events", "type": "User", "site_admin": false}, "reactions": {"url": "https://api.github.com/repos/rust-lang/rust/issues/80110/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rust-lang/rust/issues/80110/timeline", "performed_via_github_app": null, "state_reason": "completed"}