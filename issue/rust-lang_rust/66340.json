{"url": "https://api.github.com/repos/rust-lang/rust/issues/66340", "repository_url": "https://api.github.com/repos/rust-lang/rust", "labels_url": "https://api.github.com/repos/rust-lang/rust/issues/66340/labels{/name}", "comments_url": "https://api.github.com/repos/rust-lang/rust/issues/66340/comments", "events_url": "https://api.github.com/repos/rust-lang/rust/issues/66340/events", "html_url": "https://github.com/rust-lang/rust/issues/66340", "id": 521736858, "node_id": "MDU6SXNzdWU1MjE3MzY4NTg=", "number": 66340, "title": "Attribute \"[deprecated()]\": thread 'rustc' panicked at 'called `Option::unwrap()` on a `None` value'", "user": {"login": "lucidBrot", "id": 4920691, "node_id": "MDQ6VXNlcjQ5MjA2OTE=", "avatar_url": "https://avatars.githubusercontent.com/u/4920691?v=4", "gravatar_id": "", "url": "https://api.github.com/users/lucidBrot", "html_url": "https://github.com/lucidBrot", "followers_url": "https://api.github.com/users/lucidBrot/followers", "following_url": "https://api.github.com/users/lucidBrot/following{/other_user}", "gists_url": "https://api.github.com/users/lucidBrot/gists{/gist_id}", "starred_url": "https://api.github.com/users/lucidBrot/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/lucidBrot/subscriptions", "organizations_url": "https://api.github.com/users/lucidBrot/orgs", "repos_url": "https://api.github.com/users/lucidBrot/repos", "events_url": "https://api.github.com/users/lucidBrot/events{/privacy}", "received_events_url": "https://api.github.com/users/lucidBrot/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 234948, "node_id": "MDU6TGFiZWwyMzQ5NDg=", "url": "https://api.github.com/repos/rust-lang/rust/labels/A-attributes", "name": "A-attributes", "color": "f7e101", "default": false, "description": "Area: #[attributes(..)]"}, {"id": 9618520, "node_id": "MDU6TGFiZWw5NjE4NTIw", "url": "https://api.github.com/repos/rust-lang/rust/labels/I-ICE", "name": "I-ICE", "color": "e10c02", "default": false, "description": "Issue: The compiler panicked, giving an Internal Compilation Error (ICE) \u2744\ufe0f"}, {"id": 211668100, "node_id": "MDU6TGFiZWwyMTE2NjgxMDA=", "url": "https://api.github.com/repos/rust-lang/rust/labels/T-compiler", "name": "T-compiler", "color": "bfd4f2", "default": false, "description": "Relevant to the compiler team, which will review and decide on the PR/issue."}, {"id": 650731663, "node_id": "MDU6TGFiZWw2NTA3MzE2NjM=", "url": "https://api.github.com/repos/rust-lang/rust/labels/C-bug", "name": "C-bug", "color": "f5f1fd", "default": false, "description": "Category: This is a bug."}, {"id": 1615551553, "node_id": "MDU6TGFiZWwxNjE1NTUxNTUz", "url": "https://api.github.com/repos/rust-lang/rust/labels/glacier", "name": "glacier", "color": "a5e2ff", "default": false, "description": "ICE tracked in rust-lang/glacier"}], "state": "closed", "locked": false, "assignee": {"login": "Centril", "id": 855702, "node_id": "MDQ6VXNlcjg1NTcwMg==", "avatar_url": "https://avatars.githubusercontent.com/u/855702?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Centril", "html_url": "https://github.com/Centril", "followers_url": "https://api.github.com/users/Centril/followers", "following_url": "https://api.github.com/users/Centril/following{/other_user}", "gists_url": "https://api.github.com/users/Centril/gists{/gist_id}", "starred_url": "https://api.github.com/users/Centril/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Centril/subscriptions", "organizations_url": "https://api.github.com/users/Centril/orgs", "repos_url": "https://api.github.com/users/Centril/repos", "events_url": "https://api.github.com/users/Centril/events{/privacy}", "received_events_url": "https://api.github.com/users/Centril/received_events", "type": "User", "site_admin": false}, "assignees": [{"login": "Centril", "id": 855702, "node_id": "MDQ6VXNlcjg1NTcwMg==", "avatar_url": "https://avatars.githubusercontent.com/u/855702?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Centril", "html_url": "https://github.com/Centril", "followers_url": "https://api.github.com/users/Centril/followers", "following_url": "https://api.github.com/users/Centril/following{/other_user}", "gists_url": "https://api.github.com/users/Centril/gists{/gist_id}", "starred_url": "https://api.github.com/users/Centril/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Centril/subscriptions", "organizations_url": "https://api.github.com/users/Centril/orgs", "repos_url": "https://api.github.com/users/Centril/repos", "events_url": "https://api.github.com/users/Centril/events{/privacy}", "received_events_url": "https://api.github.com/users/Centril/received_events", "type": "User", "site_admin": false}], "milestone": null, "comments": 0, "created_at": "2019-11-12T18:52:42Z", "updated_at": "2019-11-24T12:17:22Z", "closed_at": "2019-11-17T07:44:35Z", "author_association": "NONE", "active_lock_reason": null, "body": "### Steps to Reproduce\r\n```\r\n$ cargo new deprecate_crash\r\n     Created binary (application) `deprecate_crash` package\r\nFriendly_Name /cygdrive/c/Users/eric/Documents/projects/cevi-versand (master)\r\n$ vim deprecate_crash/src/main.rs\r\n```\r\n\r\n```rust\r\nfn main() {\r\n    println!(\"main.\");\r\n    foo(); // remove this line for compiler output A\r\n}\r\n\r\n#[deprecated(note=test)]\r\nfn foo(){\r\n    println!(\"Hello, world\");\r\n}\r\n```\r\n\r\n### Compiler Output A\r\nThis happens when you run above code without calling `foo();`.\r\n```\r\n$ cargo run\r\n   Compiling deprecate_crash v0.1.0 (C:\\Users\\eric\\Documents\\projects\\cevi-versand\\deprecate_crash)\r\nerror: expected unsuffixed literal or identifier, found `test`\r\n --> src\\main.rs:5:19\r\n  |\r\n5 | #[deprecated(note=test)]\r\n  |                   ^^^^\r\n\r\nerror: aborting due to previous error\r\n\r\nerror: Could not compile `deprecate_crash`.\r\n\r\nTo learn more, run the command again with --verbose.\r\n```\r\n\r\n### Compiler Output B\r\nThis happens when you run above code verbatim.\r\n```\r\n$ cargo run\r\n   Compiling deprecate_crash v0.1.0 (C:\\Users\\eric\\Documents\\projects\\cevi-versand\\deprecate_crash)\r\nerror: expected unsuffixed literal or identifier, found `test`\r\n --> src\\main.rs:6:19\r\n  |\r\n6 | #[deprecated(note=test)]\r\n  |                   ^^^^\r\n\r\nthread 'rustc' panicked at 'called `Option::unwrap()` on a `None` value', src\\libcore\\option.rs:347:21\r\nnote: run with `RUST_BACKTRACE=1` environment variable to display a backtrace.\r\nerror: aborting due to previous error\r\n\r\n\r\nerror: internal compiler error: unexpected panic\r\n\r\nnote: the compiler unexpectedly panicked. this is a bug.\r\n\r\nnote: we would appreciate a bug report: https://github.com/rust-lang/rust/blob/master/CONTRIBUTING.md#bug-reports\r\n\r\nnote: rustc 1.37.0 (eae3437df 2019-08-13) running on x86_64-pc-windows-msvc\r\n\r\nnote: compiler flags: -C debuginfo=2 -C incremental --crate-type bin\r\n\r\nnote: some of the compiler flags provided by cargo are hidden\r\n\r\nerror: Could not compile `deprecate_crash`.\r\n\r\nTo learn more, run the command again with --verbose.\r\n```\r\n\r\n### Expected Behaviour\r\nI would expect Compiler Output A in both cases.\r\n\r\n### Backtrace\r\n```\r\n$ cargo run\r\n   Compiling deprecate_crash v0.1.0 (C:\\Users\\eric\\Documents\\projects\\cevi-versand\\deprecate_crash)\r\nerror: expected unsuffixed literal or identifier, found `test`\r\n --> src\\main.rs:6:19\r\n  |\r\n6 | #[deprecated(note=test)]\r\n  |                   ^^^^\r\n\r\nthread 'rustc' panicked at 'called `Option::unwrap()` on a `None` value', src\\libcore\\option.rs:347:21\r\nstack backtrace:\r\n   0: std::sys_common::alloc::realloc_fallback\r\n   1: std::panicking::take_hook\r\n   2: std::panicking::take_hook\r\n   3: <(rustc::hir::def_id::DefId, rustc::hir::def_id::DefId) as rustc::ty::query::keys::Key>::default_span\r\n   4: std::panicking::rust_panic_with_hook\r\n   5: std::panicking::begin_panic_fmt\r\n   6: rust_begin_unwind\r\n   7: core::panicking::panic_fmt\r\n   8: core::panicking::panic\r\n   9: syntax::attr::builtin::find_deprecation\r\n  10: <rustc::middle::stability::Annotator as rustc::hir::intravisit::Visitor>::visit_item\r\n  11: rustc::middle::stability::Index::new\r\n  12: rustc::ty::structural_impls::<impl rustc::ty::context::Lift for syntax_pos::span_encoding::Span>::lift_to_tcx\r\n  13: rustc::middle::weak_lang_items::<impl rustc::ty::context::TyCtxt>::is_weak_lang_item\r\n  14: rustc::dep_graph::graph::DepGraph::assert_ignored\r\n  15: rustc::ty::query::plumbing::<impl rustc::ty::context::TyCtxt>::try_print_query_stack\r\n  16: rustc::ty::structural_impls::<impl rustc::ty::context::Lift for syntax_pos::span_encoding::Span>::lift_to_tcx\r\n  17: rustc::ty::print::pretty::<impl core::fmt::Display for rustc::ty::subst::Kind>::fmt\r\n  18: rustc::middle::weak_lang_items::<impl rustc::ty::context::TyCtxt>::is_weak_lang_item\r\n  19: rustc::dep_graph::graph::DepGraph::assert_ignored\r\n  20: rustc::ty::query::plumbing::<impl rustc::ty::context::TyCtxt>::try_print_query_stack\r\n  21: rustc::middle::stability::<impl rustc::ty::context::TyCtxt>::eval_stability\r\n  22: rustc::middle::stability::<impl rustc::ty::context::TyCtxt>::check_stability\r\n  23: rustc::hir::intravisit::NestedVisitorMap::inter\r\n  24: rustc::hir::intravisit::NestedVisitorMap::inter\r\n  25: rustc::hir::intravisit::NestedVisitorMap::inter\r\n  26: rustc::hir::intravisit::NestedVisitorMap::inter\r\n  27: rustc::dep_graph::cgu_reuse_tracker::CguReuseTracker::check_expected_reuse\r\n  28: rustc::hir::intravisit::NestedVisitorMap::inter\r\n  29: <rustc::middle::stability::Checker as rustc::hir::intravisit::Visitor>::visit_item\r\n  30: rustc::hir::map::Map::get_module\r\n  31: rustc::middle::stability::Index::local_deprecation_entry\r\n  32: <rustc_interface::util::ReplaceBodyWithLoop as syntax::mut_visit::MutVisitor>::visit_mac\r\n  33: <rustc_interface::proc_macro_decls::Finder as rustc::hir::itemlikevisit::ItemLikeVisitor>::visit_item\r\n  34: <rustc_interface::proc_macro_decls::Finder as rustc::hir::itemlikevisit::ItemLikeVisitor>::visit_item\r\n  35: <rustc_interface::proc_macro_decls::Finder as rustc::hir::itemlikevisit::ItemLikeVisitor>::visit_item\r\n  36: <rustc_interface::proc_macro_decls::Finder as rustc::hir::itemlikevisit::ItemLikeVisitor>::visit_trait_item\r\n  37: _rust_maybe_catch_panic\r\n  38: <rustc_interface::profile::trace::Query as core::fmt::Debug>::fmt\r\n  39: <rustc_interface::profile::trace::Query as core::fmt::Debug>::fmt\r\n  40: rustc_interface::passes::BoxedResolver::to_expansion_result\r\n  41: rustc_driver::set_sigpipe_handler\r\n  42: rustc_driver::set_sigpipe_handler\r\n  43: <rustc_driver::pretty::UserIdentifiedItem as core::fmt::Debug>::fmt\r\n  44: rustc_driver::set_sigpipe_handler\r\n  45: rustc_driver::set_sigpipe_handler\r\n  46: rustc_driver::set_sigpipe_handler\r\n  47: <rustc_interface::util::ReplaceBodyWithLoop as syntax::mut_visit::MutVisitor>::visit_mac\r\n  48: rustc_driver::set_sigpipe_handler\r\n  49: <env_logger::filter::inner::Filter as core::fmt::Display>::fmt\r\n  50: <env_logger::filter::inner::Filter as core::fmt::Display>::fmt\r\n  51: <rustc_driver::Compilation as core::fmt::Debug>::fmt\r\n  52: <rustc_driver::pretty::UserIdentifiedItem as core::fmt::Debug>::fmt\r\n  53: _rust_maybe_catch_panic\r\n  54: rustc_driver::set_sigpipe_handler\r\n  55: ZN244_$LT$std..error..$LT$impl$u20$core..convert..From$LT$alloc..string..String$GT$$u20$for$u20$alloc..boxed..Box$LT$dyn$u20$std..error..Error$u2b$core..marker..Send$u2b$core..marker..Sync$GT$$GT$..from..StringError$u20$as$u20$core..fmt..Display$GT$3fmt17\r\n  56: std::sys::windows::thread::Thread::new\r\n  57: BaseThreadInitThunk\r\n  58: RtlUserThreadStart\r\nquery stack during panic:\r\n#0 [stability_index] calculating the stability index for the local crate\r\n#1 [lookup_deprecation_entry] processing `foo`\r\n#2 [check_mod_unstable_api_usage] checking for unstable API usage in top-level module\r\n#3 [analysis] running analysis passes on this crate\r\nend of query stack\r\nerror: aborting due to previous error\r\n\r\n\r\nerror: internal compiler error: unexpected panic\r\n\r\nnote: the compiler unexpectedly panicked. this is a bug.\r\n\r\nnote: we would appreciate a bug report: https://github.com/rust-lang/rust/blob/master/CONTRIBUTING.md#bug-reports\r\n\r\nnote: rustc 1.37.0 (eae3437df 2019-08-13) running on x86_64-pc-windows-msvc\r\n\r\nnote: compiler flags: -C debuginfo=2 -C incremental --crate-type bin\r\n\r\nnote: some of the compiler flags provided by cargo are hidden\r\n\r\nerror: Could not compile `deprecate_crash`.\r\n\r\nTo learn more, run the command again with --verbose.\r\n\r\n```\r\n\r\n### Environment\r\nWin10, cygwin\r\n```\r\n$ cargo --version\r\ncargo 1.37.0 (9edd08916 2019-08-02)\r\n$ rustc --version --verbose\r\nrustc 1.37.0 (eae3437df 2019-08-13)\r\nbinary: rustc\r\ncommit-hash: eae3437dfe991621e8afdc82734f4a172d7ddf9b\r\ncommit-date: 2019-08-13\r\nhost: x86_64-pc-windows-msvc\r\nrelease: 1.37.0\r\nLLVM version: 8.0\r\n```\r\n\r\n### Why Would You Even Do This?\r\nI had no internet connection at the time and was trying to achieve `#[deprecated(note=\"test\")]`\r\n\r\nI don't find that crash annoying, but since the message asked me to report it, here I am. Enjoy :)", "closed_by": {"login": "bors", "id": 3372342, "node_id": "MDQ6VXNlcjMzNzIzNDI=", "avatar_url": "https://avatars.githubusercontent.com/u/3372342?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors", "html_url": "https://github.com/bors", "followers_url": "https://api.github.com/users/bors/followers", "following_url": "https://api.github.com/users/bors/following{/other_user}", "gists_url": "https://api.github.com/users/bors/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors/subscriptions", "organizations_url": "https://api.github.com/users/bors/orgs", "repos_url": "https://api.github.com/users/bors/repos", "events_url": "https://api.github.com/users/bors/events{/privacy}", "received_events_url": "https://api.github.com/users/bors/received_events", "type": "User", "site_admin": false}, "reactions": {"url": "https://api.github.com/repos/rust-lang/rust/issues/66340/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rust-lang/rust/issues/66340/timeline", "performed_via_github_app": null, "state_reason": "completed"}