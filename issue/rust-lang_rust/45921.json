{"url": "https://api.github.com/repos/rust-lang/rust/issues/45921", "repository_url": "https://api.github.com/repos/rust-lang/rust", "labels_url": "https://api.github.com/repos/rust-lang/rust/issues/45921/labels{/name}", "comments_url": "https://api.github.com/repos/rust-lang/rust/issues/45921/comments", "events_url": "https://api.github.com/repos/rust-lang/rust/issues/45921/events", "html_url": "https://github.com/rust-lang/rust/issues/45921", "id": 273051708, "node_id": "MDU6SXNzdWUyNzMwNTE3MDg=", "number": 45921, "title": "a type error in a nested macro leads to a confusing compiler error message", "user": {"login": "oconnor663", "id": 860932, "node_id": "MDQ6VXNlcjg2MDkzMg==", "avatar_url": "https://avatars.githubusercontent.com/u/860932?v=4", "gravatar_id": "", "url": "https://api.github.com/users/oconnor663", "html_url": "https://github.com/oconnor663", "followers_url": "https://api.github.com/users/oconnor663/followers", "following_url": "https://api.github.com/users/oconnor663/following{/other_user}", "gists_url": "https://api.github.com/users/oconnor663/gists{/gist_id}", "starred_url": "https://api.github.com/users/oconnor663/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/oconnor663/subscriptions", "organizations_url": "https://api.github.com/users/oconnor663/orgs", "repos_url": "https://api.github.com/users/oconnor663/repos", "events_url": "https://api.github.com/users/oconnor663/events{/privacy}", "received_events_url": "https://api.github.com/users/oconnor663/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 234902, "node_id": "MDU6TGFiZWwyMzQ5MDI=", "url": "https://api.github.com/repos/rust-lang/rust/labels/C-enhancement", "name": "C-enhancement", "color": "f5f1fd", "default": false, "description": "Category: An issue proposing an enhancement or a PR with one."}, {"id": 235791, "node_id": "MDU6TGFiZWwyMzU3OTE=", "url": "https://api.github.com/repos/rust-lang/rust/labels/A-diagnostics", "name": "A-diagnostics", "color": "f7e101", "default": false, "description": "Area: Messages for errors, warnings, and lints"}, {"id": 132910982, "node_id": "MDU6TGFiZWwxMzI5MTA5ODI=", "url": "https://api.github.com/repos/rust-lang/rust/labels/A-macros", "name": "A-macros", "color": "f7e101", "default": false, "description": "Area: All kinds of macros (custom derive, macro_rules!, proc macros, ..)"}, {"id": 211668100, "node_id": "MDU6TGFiZWwyMTE2NjgxMDA=", "url": "https://api.github.com/repos/rust-lang/rust/labels/T-compiler", "name": "T-compiler", "color": "bfd4f2", "default": false, "description": "Relevant to the compiler team, which will review and decide on the PR/issue."}, {"id": 693665463, "node_id": "MDU6TGFiZWw2OTM2NjU0NjM=", "url": "https://api.github.com/repos/rust-lang/rust/labels/WG-diagnostics", "name": "WG-diagnostics", "color": "c2e0c6", "default": false, "description": "Working group: diagnostics"}], "state": "open", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 1, "created_at": "2017-11-10T20:35:46Z", "updated_at": "2020-04-29T23:17:32Z", "closed_at": null, "author_association": "CONTRIBUTOR", "active_lock_reason": null, "body": "Here's a toy program demonstrating the problem:\r\n\r\n```rust\r\nmacro_rules! my_macro {\r\n    () => {\r\n        fn my_func() {\r\n            // An intentional type error here. The compiler doesn't do a good\r\n            // job of saying what line is causing it.\r\n            assert_eq!(0u8, 0u16);\r\n        }\r\n    }\r\n}\r\n\r\nmy_macro!();\r\n\r\nfn main() {\r\n    my_func();\r\n}\r\n```\r\n\r\nCompiling it (current stable rustc, 1.21) gives the following error:\r\n\r\n```\r\nerror[E0308]: mismatched types\r\n  --> src/main.rs:11:1\r\n   |\r\n11 | my_macro!();\r\n   | ^^^^^^^^^^^^\r\n   | |\r\n   | expected u8, found u16\r\n   | in this macro invocation\r\n   |\r\n   = note: this error originates in a macro outside of the current crate\r\n```\r\n\r\nAll the compiler is telling me is that \"something inside the macro generates this type error\". In particular, it's not able to tell me that the problem is on line 6. I wouldn't be surprised if this was a known problem somewhere, but I wanted to make sure to report it, since it's probably super confusing for new developers. (For example, I expect you could run into this easily by combining `assert!` with another common macro like `lazy_static!`.)", "closed_by": null, "reactions": {"url": "https://api.github.com/repos/rust-lang/rust/issues/45921/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rust-lang/rust/issues/45921/timeline", "performed_via_github_app": null, "state_reason": null}