{"url": "https://api.github.com/repos/rust-lang/rust/issues/85267", "repository_url": "https://api.github.com/repos/rust-lang/rust", "labels_url": "https://api.github.com/repos/rust-lang/rust/issues/85267/labels{/name}", "comments_url": "https://api.github.com/repos/rust-lang/rust/issues/85267/comments", "events_url": "https://api.github.com/repos/rust-lang/rust/issues/85267/events", "html_url": "https://github.com/rust-lang/rust/issues/85267", "id": 891226477, "node_id": "MDU6SXNzdWU4OTEyMjY0Nzc=", "number": 85267, "title": "gdb pretty-printers not working for struct fields with gdb 10.x", "user": {"login": "mullr", "id": 24409, "node_id": "MDQ6VXNlcjI0NDA5", "avatar_url": "https://avatars.githubusercontent.com/u/24409?v=4", "gravatar_id": "", "url": "https://api.github.com/users/mullr", "html_url": "https://github.com/mullr", "followers_url": "https://api.github.com/users/mullr/followers", "following_url": "https://api.github.com/users/mullr/following{/other_user}", "gists_url": "https://api.github.com/users/mullr/gists{/gist_id}", "starred_url": "https://api.github.com/users/mullr/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/mullr/subscriptions", "organizations_url": "https://api.github.com/users/mullr/orgs", "repos_url": "https://api.github.com/users/mullr/repos", "events_url": "https://api.github.com/users/mullr/events{/privacy}", "received_events_url": "https://api.github.com/users/mullr/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 650731663, "node_id": "MDU6TGFiZWw2NTA3MzE2NjM=", "url": "https://api.github.com/repos/rust-lang/rust/labels/C-bug", "name": "C-bug", "color": "f5f1fd", "default": false, "description": "Category: This is a bug."}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 7, "created_at": "2021-05-13T17:28:38Z", "updated_at": "2022-03-18T00:50:47Z", "closed_at": "2022-03-18T00:50:47Z", "author_association": "NONE", "active_lock_reason": null, "body": "Hi! I'm trying to get pretty printing to work smoothly for rust in gdb. For a long time I was pretty sure nothing was working at all, but after liberal amounts of print(...) debugging in the associated python scripts, it appears that the pretty printing only kicks in when directly printing out one of the special structs, and not when they appear as members of something else. \r\n\r\nFor example, if I have a Vec<u8> and print that directly from gdb, I see the result of the pretty printers. But if I have a struct TrivialNewtype(Vec<u8>) and try to print that from gdb, I see all the guts of the Vec (the pretty printer is not active). \r\n\r\nI made a small repro: https://github.com/mullr/gdb-pretty-test\r\n\r\nFor convenience, the code is: \r\n```rust\r\nstruct TrivialNewtype(Vec<u8>);\r\n\r\nfn test() {\r\n    let bare_vec = vec![1u8, 2, 3];\r\n    let newtype_vec = TrivialNewtype(vec![1u8, 2, 3]);\r\n    let placeholder = 12;\r\n}\r\n\r\nfn main() {\r\n    test()\r\n}\r\n```\r\nI am building and debugging like this:\r\n```\r\ncargo build\r\nrust-gdb target/debug/gdb-pretty-test -ex 'b test' -ex 'r' -ex 'n' -ex 'n' -ex 'p bare_vec' -ex 'p newtype_vec'\r\n```\r\n\r\nI expected that when I print `newtype_vec`, the pretty printer for Vec would be used in a nested way. \r\n\r\nInstead, this was printed: \r\n```\r\nBreakpoint 1, gdb_pretty_test::test () at src/main.rs:5\r\n5           let bare_vec = vec![1u8, 2, 3];\r\n6           let newtype_vec = TrivialNewtype(vec![1u8, 2, 3]);\r\n7           let placeholder = 12;\r\n$1 = Vec(size=3) = {1, 2, 3}\r\n$2 = gdb_pretty_test::TrivialNewtype (alloc::vec::Vec<u8, alloc::alloc::Global> {buf: alloc::raw_vec::RawVec<u8, alloc::alloc::Global> {ptr: core::ptr::unique::Unique<u8> {pointer: 0x55555559abc0, _marker: core::marker::PhantomData<u8>}, cap: 3, alloc: alloc::alloc::Global}, len: 3})\r\n```\r\n\r\n### Meta\r\n`rustc --version --verbose`:\r\n```\r\nrustc 1.52.1 (9bc8c42bb 2021-05-09)\r\nbinary: rustc\r\ncommit-hash: 9bc8c42bb2f19e745a63f3445f1ac248fb015e53\r\ncommit-date: 2021-05-09\r\nhost: x86_64-unknown-linux-gnu\r\nrelease: 1.52.1\r\nLLVM version: 12.0.0\r\n```\r\nThis happens for nightly as well (rustc 1.54.0-nightly (5c0292654 2021-05-11) (from rustc 1.54.0-nightly (ca82264ec 2021-05-09))\r\n\r\n\r\n`gdb --version`:\r\n```\r\nGNU gdb (Ubuntu 10.1-2ubuntu2) 10.1.90.20210411-git\r\nCopyright (C) 2021 Free Software Foundation, Inc.\r\nLicense GPLv3+: GNU GPL version 3 or later <http://gnu.org/licenses/gpl.html>\r\nThis is free software: you are free to change and redistribute it.\r\nThere is NO WARRANTY, to the extent permitted by law.\r\n```", "closed_by": {"login": "tromey", "id": 1557670, "node_id": "MDQ6VXNlcjE1NTc2NzA=", "avatar_url": "https://avatars.githubusercontent.com/u/1557670?v=4", "gravatar_id": "", "url": "https://api.github.com/users/tromey", "html_url": "https://github.com/tromey", "followers_url": "https://api.github.com/users/tromey/followers", "following_url": "https://api.github.com/users/tromey/following{/other_user}", "gists_url": "https://api.github.com/users/tromey/gists{/gist_id}", "starred_url": "https://api.github.com/users/tromey/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/tromey/subscriptions", "organizations_url": "https://api.github.com/users/tromey/orgs", "repos_url": "https://api.github.com/users/tromey/repos", "events_url": "https://api.github.com/users/tromey/events{/privacy}", "received_events_url": "https://api.github.com/users/tromey/received_events", "type": "User", "site_admin": false}, "reactions": {"url": "https://api.github.com/repos/rust-lang/rust/issues/85267/reactions", "total_count": 5, "+1": 5, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rust-lang/rust/issues/85267/timeline", "performed_via_github_app": null, "state_reason": "completed"}