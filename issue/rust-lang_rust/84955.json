{"url": "https://api.github.com/repos/rust-lang/rust/issues/84955", "repository_url": "https://api.github.com/repos/rust-lang/rust", "labels_url": "https://api.github.com/repos/rust-lang/rust/issues/84955/labels{/name}", "comments_url": "https://api.github.com/repos/rust-lang/rust/issues/84955/comments", "events_url": "https://api.github.com/repos/rust-lang/rust/issues/84955/events", "html_url": "https://github.com/rust-lang/rust/issues/84955", "id": 876597231, "node_id": "MDU6SXNzdWU4NzY1OTcyMzE=", "number": 84955, "title": "Unsound overlaps being accepted, and incr-comp issues from whitespace changes, with #[marker] traits", "user": {"login": "steffahn", "id": 3986214, "node_id": "MDQ6VXNlcjM5ODYyMTQ=", "avatar_url": "https://avatars.githubusercontent.com/u/3986214?v=4", "gravatar_id": "", "url": "https://api.github.com/users/steffahn", "html_url": "https://github.com/steffahn", "followers_url": "https://api.github.com/users/steffahn/followers", "following_url": "https://api.github.com/users/steffahn/following{/other_user}", "gists_url": "https://api.github.com/users/steffahn/gists{/gist_id}", "starred_url": "https://api.github.com/users/steffahn/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/steffahn/subscriptions", "organizations_url": "https://api.github.com/users/steffahn/orgs", "repos_url": "https://api.github.com/users/steffahn/repos", "events_url": "https://api.github.com/users/steffahn/events{/privacy}", "received_events_url": "https://api.github.com/users/steffahn/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 37544, "node_id": "MDU6TGFiZWwzNzU0NA==", "url": "https://api.github.com/repos/rust-lang/rust/labels/A-typesystem", "name": "A-typesystem", "color": "f7e101", "default": false, "description": "Area: The type system"}, {"id": 13836860, "node_id": "MDU6TGFiZWwxMzgzNjg2MA==", "url": "https://api.github.com/repos/rust-lang/rust/labels/A-traits", "name": "A-traits", "color": "f7e101", "default": false, "description": "Area: Trait system"}, {"id": 211668100, "node_id": "MDU6TGFiZWwyMTE2NjgxMDA=", "url": "https://api.github.com/repos/rust-lang/rust/labels/T-compiler", "name": "T-compiler", "color": "bfd4f2", "default": false, "description": "Relevant to the compiler team, which will review and decide on the PR/issue."}, {"id": 267612997, "node_id": "MDU6TGFiZWwyNjc2MTI5OTc=", "url": "https://api.github.com/repos/rust-lang/rust/labels/I-unsound", "name": "I-unsound", "color": "e11d21", "default": false, "description": "Issue: A soundness hole (worst kind of bug), see: https://en.wikipedia.org/wiki/Soundness"}, {"id": 307747675, "node_id": "MDU6TGFiZWwzMDc3NDc2NzU=", "url": "https://api.github.com/repos/rust-lang/rust/labels/A-incr-comp", "name": "A-incr-comp", "color": "f7e101", "default": false, "description": "Area: Incremental compilation"}, {"id": 650731663, "node_id": "MDU6TGFiZWw2NTA3MzE2NjM=", "url": "https://api.github.com/repos/rust-lang/rust/labels/C-bug", "name": "C-bug", "color": "f5f1fd", "default": false, "description": "Category: This is a bug."}, {"id": 1472563007, "node_id": "MDU6TGFiZWwxNDcyNTYzMDA3", "url": "https://api.github.com/repos/rust-lang/rust/labels/requires-nightly", "name": "requires-nightly", "color": "76dcde", "default": false, "description": "This issue requires a nightly compiler in some way."}, {"id": 1778490056, "node_id": "MDU6TGFiZWwxNzc4NDkwMDU2", "url": "https://api.github.com/repos/rust-lang/rust/labels/F-marker_trait_attr", "name": "F-marker_trait_attr", "color": "f9c0cc", "default": false, "description": "`#![feature(marker_trait_attr)]`"}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 2, "created_at": "2021-05-05T15:50:11Z", "updated_at": "2021-08-22T13:26:29Z", "closed_at": "2021-08-22T13:26:29Z", "author_association": "MEMBER", "active_lock_reason": null, "body": "```rust\r\n#![feature(marker_trait_attr)]\r\n\r\n#[marker]\r\ntrait A {}\r\n\r\ntrait B {}\r\n\r\nimpl<T: A> B for T {}\r\nimpl<T: B> A for T {}\r\nimpl A for &str {}\r\nimpl<T: A + B> A for (T,) {}\r\n// insert another line break around here and it stops compiling on nightly-2021-04-25\r\ntrait TraitWithAssoc {\r\n    type Assoc;\r\n}\r\n\r\nimpl<T: A> TraitWithAssoc for T {\r\n    type Assoc = T;\r\n}\r\n// ^^^ vvv  these two impls should be overlapping\r\nimpl TraitWithAssoc for ((&str,),) {\r\n    type Assoc = ((&'static str,),);\r\n}\r\n\r\nfn g<T: TraitWithAssoc<Assoc = ((&'static str,),)>>(x: T::Assoc) -> ((&'static str,),) {\r\n    x\r\n}\r\n\r\nfn j<T: A + B>(\r\n    x: (T,),\r\n    f: fn(<(T,) as TraitWithAssoc>::Assoc) -> ((&'static str,),),\r\n) -> ((&'static str,),) {\r\n    f(x)\r\n}\r\n\r\nfn main() {\r\n    let y;\r\n    {\r\n        let hello = \"Hello World!\".to_owned();\r\n        y = j::<(&str,)>(((&hello,),), g::<((&str,),)>).0 .0;\r\n    }\r\n    println!(\"{}\", y);\r\n}\r\n```\r\n```\r\n\u00100X\ufffd\r\n```\r\n([playground](https://play.rust-lang.org/?version=nightly&mode=debug&edition=2018&gist=a96080f93f75cf673a3d5daf5080c2d5))\r\n\r\nsame code with an additional line of whitespace/comments where indicated:\r\n```\r\nerror[E0277]: the trait bound `(&str,): A` is not satisfied\r\n  --> src/main.rs:39:26\r\n   |\r\n31 | fn j<T: A + B>(x: (T,), f: fn(<(T,) as TraitWithAssoc>::Assoc) -> &'static str) -> &'static str {\r\n   |         - required by this bound in `j`\r\n...\r\n39 |         y = j::<(&str,)>(((&hello,),), g::<((&str,),)>);\r\n   |                          ^^^^^^^^^^^^ the trait `A` is not implemented for `(&str,)`\r\n   |\r\n   = help: the following implementations were found:\r\n             <(T,) as A>\r\n```\r\nhowever, the playground seems to behave different from my local nightly here\r\n\r\nTested on\r\n```\r\n$ rustc +nightly-2021-04-25 --version\r\nrustc 1.53.0-nightly (42816d61e 2021-04-24)\r\n```\r\n\r\n@rustbot label T-compiler requires-nightly F-marker_trait_attr A-traits A-typesystem\r\nand someone please add \u201cI-unsound \ud83d\udca5\u201d", "closed_by": {"login": "bors", "id": 3372342, "node_id": "MDQ6VXNlcjMzNzIzNDI=", "avatar_url": "https://avatars.githubusercontent.com/u/3372342?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors", "html_url": "https://github.com/bors", "followers_url": "https://api.github.com/users/bors/followers", "following_url": "https://api.github.com/users/bors/following{/other_user}", "gists_url": "https://api.github.com/users/bors/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors/subscriptions", "organizations_url": "https://api.github.com/users/bors/orgs", "repos_url": "https://api.github.com/users/bors/repos", "events_url": "https://api.github.com/users/bors/events{/privacy}", "received_events_url": "https://api.github.com/users/bors/received_events", "type": "User", "site_admin": false}, "reactions": {"url": "https://api.github.com/repos/rust-lang/rust/issues/84955/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rust-lang/rust/issues/84955/timeline", "performed_via_github_app": null, "state_reason": "completed"}