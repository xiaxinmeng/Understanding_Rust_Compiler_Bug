{"url": "https://api.github.com/repos/rust-lang/rust/issues/73713", "repository_url": "https://api.github.com/repos/rust-lang/rust", "labels_url": "https://api.github.com/repos/rust-lang/rust/issues/73713/labels{/name}", "comments_url": "https://api.github.com/repos/rust-lang/rust/issues/73713/comments", "events_url": "https://api.github.com/repos/rust-lang/rust/issues/73713/events", "html_url": "https://github.com/rust-lang/rust/issues/73713", "id": 645098082, "node_id": "MDU6SXNzdWU2NDUwOTgwODI=", "number": 73713, "title": "Support for the armv7l-unknown-linux-gnueabi platform", "user": {"login": "YuGiOhJCJ", "id": 2247896, "node_id": "MDQ6VXNlcjIyNDc4OTY=", "avatar_url": "https://avatars.githubusercontent.com/u/2247896?v=4", "gravatar_id": "", "url": "https://api.github.com/users/YuGiOhJCJ", "html_url": "https://github.com/YuGiOhJCJ", "followers_url": "https://api.github.com/users/YuGiOhJCJ/followers", "following_url": "https://api.github.com/users/YuGiOhJCJ/following{/other_user}", "gists_url": "https://api.github.com/users/YuGiOhJCJ/gists{/gist_id}", "starred_url": "https://api.github.com/users/YuGiOhJCJ/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/YuGiOhJCJ/subscriptions", "organizations_url": "https://api.github.com/users/YuGiOhJCJ/orgs", "repos_url": "https://api.github.com/users/YuGiOhJCJ/repos", "events_url": "https://api.github.com/users/YuGiOhJCJ/events{/privacy}", "received_events_url": "https://api.github.com/users/YuGiOhJCJ/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 55301954, "node_id": "MDU6TGFiZWw1NTMwMTk1NA==", "url": "https://api.github.com/repos/rust-lang/rust/labels/O-Arm", "name": "O-Arm", "color": "6e6ec0", "default": false, "description": "Target: 32-bit Arm processors (armv6, armv7, thumb...), including 64-bit Arm in AArch32 state"}, {"id": 650731663, "node_id": "MDU6TGFiZWw2NTA3MzE2NjM=", "url": "https://api.github.com/repos/rust-lang/rust/labels/C-bug", "name": "C-bug", "color": "f5f1fd", "default": false, "description": "Category: This is a bug."}], "state": "open", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 0, "created_at": "2020-06-25T02:29:30Z", "updated_at": "2020-10-20T20:56:04Z", "closed_at": null, "author_association": "NONE", "active_lock_reason": null, "body": "Hello,\r\n\r\nI am on the Raspberry Pi 4 board with the Slackware ARM 14.2 operating system.\r\nThis platform is: ```armv7l-unknown-linux-gnueabi```.\r\nSo, I downloaded:\r\n- https://static.rust-lang.org/dist/rustc-1.43.1-src.tar.xz\r\n- https://static.rust-lang.org/dist/rustc-1.43.1-arm-unknown-linux-gnueabi.tar.xz\r\n- https://static.rust-lang.org/dist/cargo-0.43.0-arm-unknown-linux-gnueabi.tar.xz\r\n- https://static.rust-lang.org/dist/rust-std-1.43.1-arm-unknown-linux-gnueabi.tar.xz\r\n\r\nAnd here is what happens when I try to build rustc:\r\n```\r\n$ tar xf rustc-1.43.1-src.tar.xz                                                                                            \r\n$ tar -C rustc-1.43.1-src --strip=1 -xf rustc-1.43.1-arm-unknown-linux-gnueabi.tar.xz rustc-1.43.1-arm-unknown-linux-gnueabi/rustc  \r\n$ tar -C rustc-1.43.1-src/rustc --strip=2 -xf cargo-0.43.0-arm-unknown-linux-gnueabi.tar.xz cargo-0.43.0-arm-unknown-linux-gnueabi/cargo/bin/cargo            \r\n$ tar -C rustc-1.43.1-src/rustc --strip=2 -xf rust-std-1.43.1-arm-unknown-linux-gnueabi.tar.xz rust-std-1.43.1-arm-unknown-linux-gnueabi/rust-std-arm-unknown-linux-gnueabi/lib                                             \r\n$ export PATH=\"${PWD}/rustc-1.43.1-src/rustc/bin:${PATH}\"\r\n$ cd rustc-1.43.1-src\r\n$ CFLAGS=\"-O2 -march=armv8-a -mtune=cortex-a53 -mfloat-abi=softfp -mfpu=neon-vfpv4\" CXXFLAGS=\"-O2 -march=armv8-a -mtune=cortex-a53 -mfloat-abi=softfp -mfpu=neon-vfpv4\" ./configure --prefix=/usr --libdir=/usr/lib --enable-local-rust                                  \r\nconfigure: processing command line\r\nconfigure: \r\nconfigure: install.prefix       := /usr\r\nconfigure: install.libdir       := /usr/lib\r\nconfigure: build.rustc          := /tmp/build/firefox/rustc-1.43.1-src/rustc/bin/ ...\r\nconfigure: build.cargo          := /tmp/build/firefox/rustc-1.43.1-src/rustc/bin/ ...\r\nconfigure: build.configure-args := ['--prefix=/usr', '--libdir=/usr/lib', '--enab ...\r\nconfigure: \r\nconfigure: writing `config.toml` in current directory\r\nconfigure: \r\nconfigure: run `python /tmp/build/firefox/rustc-1.43.1-src/x.py --help`\r\nconfigure: \r\n$ make -j 4\r\n   Compiling proc-macro2 v0.4.30\r\n   Compiling unicode-xid v0.1.0\r\n   Compiling lazy_static v1.4.0\r\n   Compiling memchr v2.3.2\r\n   Compiling syn v0.15.35\r\n   Compiling cfg-if v0.1.10\r\n   Compiling libc v0.2.66\r\n   Compiling autocfg v0.1.7\r\n   Compiling regex v1.1.6\r\n   Compiling ucd-util v0.1.3\r\n   Compiling log v0.4.8\r\n   Compiling serde v1.0.99\r\n   Compiling utf8-ranges v1.0.2\r\n   Compiling ryu v1.0.0\r\n   Compiling fnv v1.0.6\r\n   Compiling same-file v1.0.4\r\n   Compiling cc v1.0.50\r\n   Compiling itoa v0.4.4\r\n   Compiling unicode-width v0.1.6\r\n   Compiling build_helper v0.1.0 (/tmp/build/firefox/rustc-1.43.1-src/src/build_helper)\r\n   Compiling thread_local v0.3.6\r\n   Compiling thread_local v1.0.1\r\n   Compiling regex-syntax v0.6.6\r\n   Compiling crossbeam-utils v0.7.0\r\n   Compiling walkdir v2.2.7\r\n   Compiling cmake v0.1.42\r\n   Compiling getopts v0.2.21\r\n   Compiling aho-corasick v0.7.3\r\n   Compiling bstr v0.1.3\r\n   Compiling quote v0.6.12\r\n   Compiling time v0.1.42\r\n   Compiling filetime v0.2.8\r\n   Compiling num_cpus v1.10.1\r\n   Compiling crossbeam-channel v0.4.0\r\n   Compiling globset v0.4.3\r\n   Compiling ignore v0.4.11\r\n   Compiling serde_derive v1.0.81\r\n   Compiling serde_json v1.0.40\r\n   Compiling toml v0.5.3\r\n   Compiling bootstrap v0.0.0 (/tmp/build/firefox/rustc-1.43.1-src/src/bootstrap)\r\n    Finished dev [unoptimized] target(s) in 5m 47s\r\nBuilding stage0 std artifacts (armv7-unknown-linux-gnueabihf -> armv7-unknown-linux-gnueabihf)\r\nwarning: config profiles require the `-Z config-profile` command-line option (found profile `release` in environment variable `CARGO_PROFILE_RELEASE`)\r\n   Compiling cc v1.0.50\r\n   Compiling core v0.0.0 (/tmp/build/firefox/rustc-1.43.1-src/src/libcore)\r\n   Compiling libc v0.2.66\r\n   Compiling autocfg v0.1.7\r\nerror: could not compile `libc`.\r\n\r\nCaused by:\r\n  process didn't exit successfully: `/tmp/build/firefox/rustc-1.43.1-src/build/bootstrap/debug/rustc --crate-name build_script_build /home/yugiohjcj/.cargo/registry/src/github.com-1ecc6299db9ec823/libc-0.2.66/build.rs --error-format=json --json=diagnostic-rendered-ansi --crate-type bin --emit=dep-info,link -C opt-level=3 --cfg 'feature=\"align\"' --cfg 'feature=\"rustc-dep-of-std\"' --cfg 'feature=\"rustc-std-workspace-core\"' -C metadata=f36d1b32dec4e3d4 -C extra-filename=-f36d1b32dec4e3d4 --out-dir /tmp/build/firefox/rustc-1.43.1-src/build/armv7-unknown-linux-gnueabihf/stage0-std/release/build/libc-f36d1b32dec4e3d4 -L dependency=/tmp/build/firefox/rustc-1.43.1-src/build/armv7-unknown-linux-gnueabihf/stage0-std/release/deps --cap-lints allow -Zbinary-dep-depinfo` (signal: 11, SIGSEGV: invalid memory reference)\r\nwarning: build failed, waiting for other jobs to finish...\r\nerror: could not compile `autocfg`.\r\n\r\nCaused by:\r\n  process didn't exit successfully: `/tmp/build/firefox/rustc-1.43.1-src/build/bootstrap/debug/rustc --crate-name autocfg /home/yugiohjcj/.cargo/registry/src/github.com-1ecc6299db9ec823/autocfg-0.1.7/src/lib.rs --error-format=json --json=diagnostic-rendered-ansi --crate-type lib --emit=dep-info,metadata,link -C opt-level=3 -C metadata=81380527f284506a -C extra-filename=-81380527f284506a --out-dir /tmp/build/firefox/rustc-1.43.1-src/build/armv7-unknown-linux-gnueabihf/stage0-std/release/deps -L dependency=/tmp/build/firefox/rustc-1.43.1-src/build/armv7-unknown-linux-gnueabihf/stage0-std/release/deps --cap-lints allow -Zbinary-dep-depinfo` (signal: 11, SIGSEGV: invalid memory reference)\r\nwarning: build failed, waiting for other jobs to finish...\r\nerror: failed to prepare thin LTO module: file doesn't start with bitcode header\r\n\r\nerror: aborting due to previous error\r\n\r\nerror: could not compile `cc`.\r\nwarning: build failed, waiting for other jobs to finish...\r\nerror: could not compile `core`.\r\n\r\nCaused by:\r\n  process didn't exit successfully: `/tmp/build/firefox/rustc-1.43.1-src/build/bootstrap/debug/rustc --crate-name core --edition=2018 src/libcore/lib.rs --error-format=json --json=diagnostic-rendered-ansi,artifacts --crate-type lib --emit=dep-info,metadata,link -C opt-level=3 -C metadata=cb92643d31cc5d69 -C extra-filename=-cb92643d31cc5d69 --out-dir /tmp/build/firefox/rustc-1.43.1-src/build/armv7-unknown-linux-gnueabihf/stage0-std/armv7-unknown-linux-gnueabihf/release/deps --target armv7-unknown-linux-gnueabihf -L dependency=/tmp/build/firefox/rustc-1.43.1-src/build/armv7-unknown-linux-gnueabihf/stage0-std/armv7-unknown-linux-gnueabihf/release/deps -L dependency=/tmp/build/firefox/rustc-1.43.1-src/build/armv7-unknown-linux-gnueabihf/stage0-std/release/deps -Zmacro-backtrace '-Clink-args=-Wl,-rpath,$ORIGIN/../lib' -Wrust_2018_idioms -Wunused_lifetimes -Dwarnings -Cprefer-dynamic -Zbinary-dep-depinfo` (signal: 11, SIGSEGV: invalid memory reference)\r\ncommand did not execute successfully: \"/tmp/build/firefox/rustc-1.43.1-src/rustc/bin/cargo\" \"build\" \"--target\" \"armv7-unknown-linux-gnueabihf\" \"-Zbinary-dep-depinfo\" \"-j\" \"4\" \"--release\" \"--features\" \"panic-unwind backtrace compiler-builtins-c\" \"--manifest-path\" \"/tmp/build/firefox/rustc-1.43.1-src/src/libtest/Cargo.toml\" \"--message-format\" \"json-render-diagnostics\"\r\nexpected success, got: exit code: 101\r\nfailed to run: /tmp/build/firefox/rustc-1.43.1-src/build/bootstrap/debug/bootstrap build\r\nBuild completed unsuccessfully in 0:06:53\r\nMakefile:18: recipe for target 'all' failed\r\nmake: *** [all] Error 1\r\n```\r\n\r\nDuring the build process, I think that the problem comes from this line:\r\n```\r\nBuilding stage0 std artifacts (armv7-unknown-linux-gnueabihf -> armv7-unknown-linux-gnueabihf)\r\n```\r\nI don't know why but the `armv7-unknown-linux-gnueabihf` platform is automatically selected at this point whereas it should be `armv7l-unknown-linux-gnueabi` (or eventually `arm-unknown-linux-gnueabi`).\r\n\r\nDo you know how can I fix that please?\r\n\r\nThank you.\r\nBest regards.\r\n\r\nEdit: I also tested with ```--build=arm-unknown-linux-gnueabi --host=arm-unknown-linux-gnueabi --target=arm-unknown-linux-gnueabi``` and now the platform is selected manually and not guessed automatically, but the build is still a failure:\r\n```\r\n$ tar xf rustc-1.43.1-src.tar.xz                                                                                            \r\n$ tar -C rustc-1.43.1-src --strip=1 -xf rustc-1.43.1-arm-unknown-linux-gnueabi.tar.xz rustc-1.43.1-arm-unknown-linux-gnueabi/rustc  \r\n$ tar -C rustc-1.43.1-src/rustc --strip=2 -xf cargo-0.43.0-arm-unknown-linux-gnueabi.tar.xz cargo-0.43.0-arm-unknown-linux-gnueabi/cargo/bin/cargo            \r\n$ tar -C rustc-1.43.1-src/rustc --strip=2 -xf rust-std-1.43.1-arm-unknown-linux-gnueabi.tar.xz rust-std-1.43.1-arm-unknown-linux-gnueabi/rust-std-arm-unknown-linux-gnueabi/lib                                             \r\n$ export PATH=\"${PWD}/rustc-1.43.1-src/rustc/bin:${PATH}\"\r\n$ cd rustc-1.43.1-src\r\n$ CFLAGS=\"-O2 -march=armv8-a -mtune=cortex-a53 -mfloat-abi=softfp -mfpu=neon-vfpv4\" CXXFLAGS=\"-O2 -march=armv8-a -mtune=cortex-a53 -mfloat-abi=softfp -mfpu=neon-vfpv4\" ./configure --prefix=/usr --libdir=/usr/lib --enable-local-rust --build=arm-unknown-linux-gnueabi --host=arm-unknown-linux-gnueabi --target=arm-unknown-linux-gnueabi\r\nconfigure: processing command line\r\nconfigure: \r\nconfigure: build.target         := ['arm-unknown-linux-gnueabi']\r\nconfigure: install.libdir       := /usr/lib\r\nconfigure: install.prefix       := /usr\r\nconfigure: build.host           := ['arm-unknown-linux-gnueabi']\r\nconfigure: build.build          := arm-unknown-linux-gnueabi\r\nconfigure: build.rustc          := /tmp/build/firefox/rustc-1.43.1-src/rustc/bin/ ...\r\nconfigure: build.cargo          := /tmp/build/firefox/rustc-1.43.1-src/rustc/bin/ ...\r\nconfigure: build.configure-args := ['--prefix=/usr', '--libdir=/usr/lib', '--enab ...\r\nconfigure: \r\nconfigure: writing `config.toml` in current directory\r\nconfigure: \r\nconfigure: run `python /tmp/build/firefox/rustc-1.43.1-src/x.py --help`\r\n$ make -j 4\r\n   Compiling proc-macro2 v0.4.30\r\n   Compiling unicode-xid v0.1.0\r\n   Compiling memchr v2.3.2\r\n   Compiling lazy_static v1.4.0\r\n   Compiling syn v0.15.35\r\n   Compiling cfg-if v0.1.10\r\n   Compiling autocfg v0.1.7\r\n   Compiling libc v0.2.66\r\n   Compiling serde v1.0.99\r\n   Compiling regex v1.1.6\r\n   Compiling log v0.4.8\r\n   Compiling ucd-util v0.1.3\r\n   Compiling ryu v1.0.0\r\n   Compiling utf8-ranges v1.0.2\r\n   Compiling same-file v1.0.4\r\n   Compiling fnv v1.0.6\r\n   Compiling itoa v0.4.4\r\n   Compiling unicode-width v0.1.6\r\n   Compiling cc v1.0.50\r\n   Compiling build_helper v0.1.0 (/tmp/build/firefox/rustc-1.43.1-src/src/build_helper)\r\n   Compiling thread_local v0.3.6\r\n   Compiling thread_local v1.0.1\r\n   Compiling crossbeam-utils v0.7.0\r\n   Compiling regex-syntax v0.6.6\r\n   Compiling walkdir v2.2.7\r\n   Compiling getopts v0.2.21\r\n   Compiling cmake v0.1.42\r\n   Compiling aho-corasick v0.7.3\r\n   Compiling bstr v0.1.3\r\n   Compiling quote v0.6.12\r\n   Compiling filetime v0.2.8\r\n   Compiling num_cpus v1.10.1\r\n   Compiling time v0.1.42\r\n   Compiling crossbeam-channel v0.4.0\r\n   Compiling globset v0.4.3\r\n   Compiling ignore v0.4.11\r\n   Compiling serde_derive v1.0.81\r\n   Compiling serde_json v1.0.40\r\n   Compiling toml v0.5.3\r\n   Compiling bootstrap v0.0.0 (/tmp/build/firefox/rustc-1.43.1-src/src/bootstrap)\r\n    Finished dev [unoptimized] target(s) in 7m 58s\r\nBuilding stage0 std artifacts (arm-unknown-linux-gnueabi -> arm-unknown-linux-gnueabi)\r\nwarning: config profiles require the `-Z config-profile` command-line option (found profile `release` in environment variable `CARGO_PROFILE_RELEASE`)\r\n   Compiling cc v1.0.50\r\n   Compiling core v0.0.0 (/tmp/build/firefox/rustc-1.43.1-src/src/libcore)\r\n   Compiling libc v0.2.66\r\n   Compiling autocfg v0.1.7\r\nerror: could not compile `libc`.\r\n\r\nCaused by:\r\n  process didn't exit successfully: `/tmp/build/firefox/rustc-1.43.1-src/build/bootstrap/debug/rustc --crate-name build_script_build /home/yugiohjcj/.cargo/registry/src/github.com-1ecc6299db9ec823/libc-0.2.66/build.rs --error-format=json --json=diagnostic-rendered-ansi --crate-type bin --emit=dep-info,link -C opt-level=3 --cfg 'feature=\"align\"' --cfg 'feature=\"rustc-dep-of-std\"' --cfg 'feature=\"rustc-std-workspace-core\"' -C metadata=f36d1b32dec4e3d4 -C extra-filename=-f36d1b32dec4e3d4 --out-dir /tmp/build/firefox/rustc-1.43.1-src/build/arm-unknown-linux-gnueabi/stage0-std/release/build/libc-f36d1b32dec4e3d4 -L dependency=/tmp/build/firefox/rustc-1.43.1-src/build/arm-unknown-linux-gnueabi/stage0-std/release/deps --cap-lints allow -Zbinary-dep-depinfo` (signal: 11, SIGSEGV: invalid memory reference)\r\nwarning: build failed, waiting for other jobs to finish...\r\nerror: could not compile `autocfg`.\r\n\r\nCaused by:\r\n  process didn't exit successfully: `/tmp/build/firefox/rustc-1.43.1-src/build/bootstrap/debug/rustc --crate-name autocfg /home/yugiohjcj/.cargo/registry/src/github.com-1ecc6299db9ec823/autocfg-0.1.7/src/lib.rs --error-format=json --json=diagnostic-rendered-ansi --crate-type lib --emit=dep-info,metadata,link -C opt-level=3 -C metadata=81380527f284506a -C extra-filename=-81380527f284506a --out-dir /tmp/build/firefox/rustc-1.43.1-src/build/arm-unknown-linux-gnueabi/stage0-std/release/deps -L dependency=/tmp/build/firefox/rustc-1.43.1-src/build/arm-unknown-linux-gnueabi/stage0-std/release/deps --cap-lints allow -Zbinary-dep-depinfo` (signal: 11, SIGSEGV: invalid memory reference)\r\nwarning: build failed, waiting for other jobs to finish...\r\nerror: failed to prepare thin LTO module: file doesn't start with bitcode header\r\n\r\nerror: aborting due to previous error\r\n\r\nerror: could not compile `cc`.\r\nwarning: build failed, waiting for other jobs to finish...\r\nerror: could not compile `core`.\r\n\r\nCaused by:\r\n  process didn't exit successfully: `/tmp/build/firefox/rustc-1.43.1-src/build/bootstrap/debug/rustc --crate-name core --edition=2018 src/libcore/lib.rs --error-format=json --json=diagnostic-rendered-ansi,artifacts --crate-type lib --emit=dep-info,metadata,link -C opt-level=3 -C metadata=173bec4aef4c7110 -C extra-filename=-173bec4aef4c7110 --out-dir /tmp/build/firefox/rustc-1.43.1-src/build/arm-unknown-linux-gnueabi/stage0-std/arm-unknown-linux-gnueabi/release/deps --target arm-unknown-linux-gnueabi -L dependency=/tmp/build/firefox/rustc-1.43.1-src/build/arm-unknown-linux-gnueabi/stage0-std/arm-unknown-linux-gnueabi/release/deps -L dependency=/tmp/build/firefox/rustc-1.43.1-src/build/arm-unknown-linux-gnueabi/stage0-std/release/deps -Zmacro-backtrace '-Clink-args=-Wl,-rpath,$ORIGIN/../lib' -Wrust_2018_idioms -Wunused_lifetimes -Dwarnings -Cprefer-dynamic -Zbinary-dep-depinfo` (signal: 11, SIGSEGV: invalid memory reference)\r\ncommand did not execute successfully: \"/tmp/build/firefox/rustc-1.43.1-src/rustc/bin/cargo\" \"build\" \"--target\" \"arm-unknown-linux-gnueabi\" \"-Zbinary-dep-depinfo\" \"-j\" \"4\" \"--release\" \"--features\" \"panic-unwind backtrace compiler-builtins-c\" \"--manifest-path\" \"/tmp/build/firefox/rustc-1.43.1-src/src/libtest/Cargo.toml\" \"--message-format\" \"json-render-diagnostics\"\r\nexpected success, got: exit code: 101\r\nfailed to run: /tmp/build/firefox/rustc-1.43.1-src/build/bootstrap/debug/bootstrap build\r\nBuild completed unsuccessfully in 0:10:39\r\nMakefile:18: recipe for target 'all' failed\r\nmake: *** [all] Error 1\r\n```", "closed_by": null, "reactions": {"url": "https://api.github.com/repos/rust-lang/rust/issues/73713/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rust-lang/rust/issues/73713/timeline", "performed_via_github_app": null, "state_reason": null}