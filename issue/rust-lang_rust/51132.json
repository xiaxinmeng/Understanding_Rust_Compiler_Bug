{"url": "https://api.github.com/repos/rust-lang/rust/issues/51132", "repository_url": "https://api.github.com/repos/rust-lang/rust", "labels_url": "https://api.github.com/repos/rust-lang/rust/issues/51132/labels{/name}", "comments_url": "https://api.github.com/repos/rust-lang/rust/issues/51132/comments", "events_url": "https://api.github.com/repos/rust-lang/rust/issues/51132/events", "html_url": "https://github.com/rust-lang/rust/issues/51132", "id": 327063120, "node_id": "MDU6SXNzdWUzMjcwNjMxMjA=", "number": 51132, "title": "Borrowing an immutable reference of a mutable reference through a function call in a loop is not accepted", "user": {"login": "shepmaster", "id": 174509, "node_id": "MDQ6VXNlcjE3NDUwOQ==", "avatar_url": "https://avatars.githubusercontent.com/u/174509?v=4", "gravatar_id": "", "url": "https://api.github.com/users/shepmaster", "html_url": "https://github.com/shepmaster", "followers_url": "https://api.github.com/users/shepmaster/followers", "following_url": "https://api.github.com/users/shepmaster/following{/other_user}", "gists_url": "https://api.github.com/users/shepmaster/gists{/gist_id}", "starred_url": "https://api.github.com/users/shepmaster/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/shepmaster/subscriptions", "organizations_url": "https://api.github.com/users/shepmaster/orgs", "repos_url": "https://api.github.com/users/shepmaster/repos", "events_url": "https://api.github.com/users/shepmaster/events{/privacy}", "received_events_url": "https://api.github.com/users/shepmaster/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 234902, "node_id": "MDU6TGFiZWwyMzQ5MDI=", "url": "https://api.github.com/repos/rust-lang/rust/labels/C-enhancement", "name": "C-enhancement", "color": "f5f1fd", "default": false, "description": "Category: An issue proposing an enhancement or a PR with one."}, {"id": 211668019, "node_id": "MDU6TGFiZWwyMTE2NjgwMTk=", "url": "https://api.github.com/repos/rust-lang/rust/labels/T-lang", "name": "T-lang", "color": "bfd4f2", "default": false, "description": "Relevant to the language team, which will review and decide on the PR/issue."}, {"id": 604489711, "node_id": "MDU6TGFiZWw2MDQ0ODk3MTE=", "url": "https://api.github.com/repos/rust-lang/rust/labels/A-NLL", "name": "A-NLL", "color": "f7e101", "default": false, "description": "Area: Non Lexical Lifetimes (NLL)"}, {"id": 1146616045, "node_id": "MDU6TGFiZWwxMTQ2NjE2MDQ1", "url": "https://api.github.com/repos/rust-lang/rust/labels/NLL-polonius", "name": "NLL-polonius", "color": "f799ea", "default": false, "description": "Issues related for using Polonius in the borrow checker"}], "state": "open", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 4, "created_at": "2018-05-28T15:35:01Z", "updated_at": "2022-05-05T10:26:50Z", "closed_at": null, "author_association": "MEMBER", "active_lock_reason": null, "body": "This code appears to be sound because `event` should either leave the loop or be thrown away before the next iteration:\r\n\r\n```rust\r\n#![feature(nll)]\r\n\r\nfn next<'buf>(buffer: &'buf mut String) -> &'buf str {\r\n    loop {\r\n        let event = parse(buffer);\r\n\r\n        if true {\r\n            return event;\r\n        }\r\n    }\r\n}\r\n\r\nfn parse<'buf>(_buffer: &'buf mut String) -> &'buf str {\r\n    unimplemented!()\r\n}\r\n\r\nfn main() {}\r\n```\r\n\r\nThe current (1.28.0-nightly 2018-05-25 990d8aa743b1dda3cc0f) implementation still marks this as an error:\r\n\r\n```\r\nerror[E0499]: cannot borrow `*buffer` as mutable more than once at a time\r\n --> src/main.rs:5:27\r\n  |\r\n5 |         let event = parse(buffer);\r\n  |                           ^^^^^^ mutable borrow starts here in previous iteration of loop\r\n  |\r\nnote: borrowed value must be valid for the lifetime 'buf as defined on the function body at 3:1...\r\n --> src/main.rs:3:1\r\n  |\r\n3 | fn next<'buf>(buffer: &'buf mut String) -> &'buf str {\r\n  | ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\r\n```\r\n\r\n@nikomatsakis said:\r\n\r\n>  this should throw an error (for now) but this error should eventually go away. This is precisely a case where \"Location sensitivity\" is needed, but we removed that feature in the name of performance \u2014 once polonius support lands, though, this code would be accepted. That may or may not be before the edition.", "closed_by": null, "reactions": {"url": "https://api.github.com/repos/rust-lang/rust/issues/51132/reactions", "total_count": 15, "+1": 14, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 1, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rust-lang/rust/issues/51132/timeline", "performed_via_github_app": null, "state_reason": null}