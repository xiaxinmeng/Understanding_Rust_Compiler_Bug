{"url": "https://api.github.com/repos/rust-lang/rust/issues/92929", "repository_url": "https://api.github.com/repos/rust-lang/rust", "labels_url": "https://api.github.com/repos/rust-lang/rust/issues/92929/labels{/name}", "comments_url": "https://api.github.com/repos/rust-lang/rust/issues/92929/comments", "events_url": "https://api.github.com/repos/rust-lang/rust/issues/92929/events", "html_url": "https://github.com/rust-lang/rust/issues/92929", "id": 1104680739, "node_id": "I_kwDOAAsO6M5B2Bcj", "number": 92929, "title": "Conversion of generated future fails, although it should succeed", "user": {"login": "oribenshir", "id": 5277274, "node_id": "MDQ6VXNlcjUyNzcyNzQ=", "avatar_url": "https://avatars.githubusercontent.com/u/5277274?v=4", "gravatar_id": "", "url": "https://api.github.com/users/oribenshir", "html_url": "https://github.com/oribenshir", "followers_url": "https://api.github.com/users/oribenshir/followers", "following_url": "https://api.github.com/users/oribenshir/following{/other_user}", "gists_url": "https://api.github.com/users/oribenshir/gists{/gist_id}", "starred_url": "https://api.github.com/users/oribenshir/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/oribenshir/subscriptions", "organizations_url": "https://api.github.com/users/oribenshir/orgs", "repos_url": "https://api.github.com/users/oribenshir/repos", "events_url": "https://api.github.com/users/oribenshir/events{/privacy}", "received_events_url": "https://api.github.com/users/oribenshir/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 650731663, "node_id": "MDU6TGFiZWw2NTA3MzE2NjM=", "url": "https://api.github.com/repos/rust-lang/rust/labels/C-bug", "name": "C-bug", "color": "f5f1fd", "default": false, "description": "Category: This is a bug."}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 1, "created_at": "2022-01-15T11:07:15Z", "updated_at": "2022-01-21T19:14:12Z", "closed_at": "2022-01-21T19:11:00Z", "author_association": "CONTRIBUTOR", "active_lock_reason": null, "body": "I've encountered a weird behavior around generated futures, and the trait bounds it satisfied.\r\nThe resulting behavior seems inconsistent.\r\n\r\nI tried this code:\r\n\r\n```rust\r\nlet _f1: Pin<Box<dyn Future<Output = bool> + Send + 'static>> = Box::new(async { true }).into();\r\n```\r\n\r\nI expected to see this happen: compilation succeeded.\r\n\r\nInstead, this happened: compilation failed due to unsatisfied trait bound. \r\n\r\n```rust\r\nerror[E0277]: the trait bound `Pin<Box<dyn Future<Output = bool> + Send>>: From<Box<impl Future<Output = [async output]>>>` is not satisfied\r\n  --> src\\main.rs:55:94\r\n   |\r\n55 |     let _f1: Pin<Box<dyn Future<Output = bool> + Send + 'static>> = Box::new(async { true }).into();\r\n   |                                                                                              ^^^^ the trait `From<Box<impl Future<Output = [async output]>>>` is not implemented for `Pin<Box<dyn Future<Output = bool> + Send>>`\r\n   |\r\n   = help: the following implementations were found:\r\n             <Pin<Box<T, A>> as From<Box<T, A>>>\r\n   = note: required because of the requirements on the impl of `Into<Pin<Box<dyn Future<Output = bool> + Send>>>` for `Box<impl Future<Output = [async output]>>`\r\n```\r\n\r\nI've continued with several other tests, the following two tests compiled successfully:\r\n```rust\r\nlet _f2: Pin<Box<_>> = Box::<_>::new(async { true }).into();\r\n```\r\n```rust\r\npub fn pin<T>(x: T) -> Pin<Box<T>>\r\n    where T : Future<Output = bool> + Send + 'static {\r\n    Box::new(x).into()\r\n}\r\n\r\nfn main() {\r\n    let _f3: Pin<Box<dyn Future<Output = bool> + Send + 'static>> = pin(async { true });\r\n}\r\n```\r\nThe next test failed again:\r\n\r\n```rust\r\nlet _f4: Box<dyn Future<Output = bool> + Send + 'static> = Box::<dyn Future<Output = bool> + Send + 'static>::new(async { true });\r\n```\r\n\r\nWith the following compilation error\r\n```rust\r\nerror[E0599]: the function or associated item `new` exists for struct `Box<(dyn Future<Output = bool> + Send + 'static)>`, but its trait bounds were not satisfied\r\n  --> src\\main.rs:60:115\r\n   |\r\n60 |     let _f4: Box<dyn Future<Output = bool> + Send + 'static> = Box::<dyn Future<Output = bool> + Send + 'static>::new(async { true });\r\n   |                                                                                                                   ^^^ function or associated item cannot be called on `Box<(dyn Future<Output = bool> + Send + 'static)>` due to unsatisfied trait bounds\r\n   |\r\n  ::: C:\\Users\\oribe\\.rustup\\toolchains\\nightly-x86_64-pc-windows-msvc\\lib/rustlib/src/rust\\library\\core\\src\\future\\future.rs:36:1\r\n   |\r\n36 | pub trait Future {\r\n   | ---------------- doesn't satisfy `dyn Future<Output = bool> + Send: Sized`\r\n   |\r\n   = note: the following trait bounds were not satisfied:\r\n           `dyn Future<Output = bool> + Send: Sized`\r\n```\r\n\r\nBackground:\r\nI got to this situation while trying to see if I could improve the diagnostic around unpinned futures.\r\n\r\n### Meta\r\n\r\n`rustc --version --verbose`:\r\n```\r\nrustc 1.59.0-nightly (cfa3fe5af 2021-12-31)\r\nbinary: rustc\r\ncommit-hash: cfa3fe5af339e724209b25715282adae0c61628f\r\ncommit-date: 2021-12-31\r\nhost: x86_64-pc-windows-msvc\r\nrelease: 1.59.0-nightly\r\nLLVM version: 13.0.0\r\n```\r\n</p>\r\n</details>\r\n", "closed_by": {"login": "oribenshir", "id": 5277274, "node_id": "MDQ6VXNlcjUyNzcyNzQ=", "avatar_url": "https://avatars.githubusercontent.com/u/5277274?v=4", "gravatar_id": "", "url": "https://api.github.com/users/oribenshir", "html_url": "https://github.com/oribenshir", "followers_url": "https://api.github.com/users/oribenshir/followers", "following_url": "https://api.github.com/users/oribenshir/following{/other_user}", "gists_url": "https://api.github.com/users/oribenshir/gists{/gist_id}", "starred_url": "https://api.github.com/users/oribenshir/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/oribenshir/subscriptions", "organizations_url": "https://api.github.com/users/oribenshir/orgs", "repos_url": "https://api.github.com/users/oribenshir/repos", "events_url": "https://api.github.com/users/oribenshir/events{/privacy}", "received_events_url": "https://api.github.com/users/oribenshir/received_events", "type": "User", "site_admin": false}, "reactions": {"url": "https://api.github.com/repos/rust-lang/rust/issues/92929/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rust-lang/rust/issues/92929/timeline", "performed_via_github_app": null, "state_reason": "completed"}