{"url": "https://api.github.com/repos/rust-lang/rust/issues/89006", "repository_url": "https://api.github.com/repos/rust-lang/rust", "labels_url": "https://api.github.com/repos/rust-lang/rust/issues/89006/labels{/name}", "comments_url": "https://api.github.com/repos/rust-lang/rust/issues/89006/comments", "events_url": "https://api.github.com/repos/rust-lang/rust/issues/89006/events", "html_url": "https://github.com/rust-lang/rust/issues/89006", "id": 998078169, "node_id": "I_kwDOAAsO6M47fXbZ", "number": 89006, "title": "Stabilize RFC 2345: Allow panicking in constants", "user": {"login": "oli-obk", "id": 332036, "node_id": "MDQ6VXNlcjMzMjAzNg==", "avatar_url": "https://avatars.githubusercontent.com/u/332036?v=4", "gravatar_id": "", "url": "https://api.github.com/users/oli-obk", "html_url": "https://github.com/oli-obk", "followers_url": "https://api.github.com/users/oli-obk/followers", "following_url": "https://api.github.com/users/oli-obk/following{/other_user}", "gists_url": "https://api.github.com/users/oli-obk/gists{/gist_id}", "starred_url": "https://api.github.com/users/oli-obk/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/oli-obk/subscriptions", "organizations_url": "https://api.github.com/users/oli-obk/orgs", "repos_url": "https://api.github.com/users/oli-obk/repos", "events_url": "https://api.github.com/users/oli-obk/events{/privacy}", "received_events_url": "https://api.github.com/users/oli-obk/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 211668019, "node_id": "MDU6TGFiZWwyMTE2NjgwMTk=", "url": "https://api.github.com/repos/rust-lang/rust/labels/T-lang", "name": "T-lang", "color": "bfd4f2", "default": false, "description": "Relevant to the language team, which will review and decide on the PR/issue."}, {"id": 919710011, "node_id": "MDU6TGFiZWw5MTk3MTAwMTE=", "url": "https://api.github.com/repos/rust-lang/rust/labels/disposition-merge", "name": "disposition-merge", "color": "008800", "default": false, "description": "This issue / PR is in PFCP or FCP with a disposition to merge it."}, {"id": 923282386, "node_id": "MDU6TGFiZWw5MjMyODIzODY=", "url": "https://api.github.com/repos/rust-lang/rust/labels/finished-final-comment-period", "name": "finished-final-comment-period", "color": "f9e189", "default": false, "description": "The final comment period is finished for this PR / Issue."}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 24, "created_at": "2021-09-16T11:03:05Z", "updated_at": "2021-10-07T15:20:47Z", "closed_at": "2021-10-05T00:45:15Z", "author_association": "CONTRIBUTOR", "active_lock_reason": null, "body": "# Stabilization report\r\n\r\n## Summary\r\n\r\nThis feature allows panicking within constants and reporting a custom message as a compile-time error.\r\n\r\nThe following code will become valid on stable:\r\n\r\n```rust\r\nconst fn foo(val: u8) {\r\n    assert!(val == 1, \"val is not 1\");\r\n}\r\n\r\n// can be also computed by manually creating a `&[u8]` and\r\n// from_utf8_unchecked.\r\nconst MSG: &str = \"custom message\";\r\n\r\nconst _: () = std::panic!(\"{}\", MSG);\r\nconst _: () = panic!(\"custom message\");\r\n```\r\n\r\nThe message looks like:\r\n\r\n```\r\nerror: any use of this value will cause an error\r\n --> src/main.rs:4:15\r\n  |\r\n4 | const _: () = std::panic!(\"{}\", MSG);\r\n  | --------------^^^^^^^^^^^^^^^^^^^^^^-\r\n  |               |\r\n  |               the evaluated program panicked at 'custom message', src/main.rs:4:15\r\n  |\r\n  = note: `#[deny(const_err)]` on by default\r\n  = warning: this was previously accepted by the compiler but is being phased out; it will become a hard error in a future release!\r\n  = note: for more information, see issue #71800 <https://github.com/rust-lang/rust/issues/71800>\r\n  = note: this error originates in a macro (in Nightly builds, run with -Z macro-backtrace for more info)\r\n```\r\n\r\nMotivation for this RFC can be found here: https://rust-lang.github.io/rfcs/2345-const-panic.html#motivation\r\n\r\nMore examples can be found here: https://github.com/rust-lang/rust/blob/673d0db5e393e9c64897005b470bfeb6d5aec61b/src/test/ui/consts/const-eval/const_panic.rs\r\n\r\n## Edge cases & tests\r\n\r\n- https://github.com/rust-lang/rust/blob/673d0db5e393e9c64897005b470bfeb6d5aec61b/src/test/ui/consts/const-eval/panic-never-type.rs\r\n- https://github.com/rust-lang/rust/blob/673d0db5e393e9c64897005b470bfeb6d5aec61b/src/test/ui/consts/const-eval/panic-assoc-never-type.rs\r\n- https://github.com/rust-lang/rust/blob/673d0db5e393e9c64897005b470bfeb6d5aec61b/src/test/ui/consts/issue-66693.rs\r\n- https://github.com/rust-lang/rust/blob/673d0db5e393e9c64897005b470bfeb6d5aec61b/src/test/ui/consts/control-flow/short-circuit-let.rs\r\n\r\n## Some questions which should be resolved in the future\r\n\r\nWe have some \"unresolved questions\" but they aren't an actual blocker.\r\n\r\n\r\n- Should there be some additional message in the error about this being a panic turned error?\r\n   Or do we just produce the exact message the panic would produce?\r\n- This change becomes really useful if `Result::unwrap` and `Option::unwrap` become `const fn`, doing both in one go might be a good idea.\r\n\r\nSee the brief summary comment here: https://github.com/rust-lang/rust/issues/51999#issuecomment-790543959\r\n\r\nPrevious attempt: https://github.com/rust-lang/rust/issues/85194 (This was blocked because it was not possible to use a generated panic message, only literal strings were allowed, which has been resolved in https://github.com/rust-lang/rust/pull/88954)\r\n\r\n_Originally posted by @JohnTitor in https://github.com/rust-lang/rust/issues/51999#issuecomment-826346762_\r\n\r\ncc @rust-lang/wg-const-eval ", "closed_by": {"login": "joshtriplett", "id": 162737, "node_id": "MDQ6VXNlcjE2MjczNw==", "avatar_url": "https://avatars.githubusercontent.com/u/162737?v=4", "gravatar_id": "", "url": "https://api.github.com/users/joshtriplett", "html_url": "https://github.com/joshtriplett", "followers_url": "https://api.github.com/users/joshtriplett/followers", "following_url": "https://api.github.com/users/joshtriplett/following{/other_user}", "gists_url": "https://api.github.com/users/joshtriplett/gists{/gist_id}", "starred_url": "https://api.github.com/users/joshtriplett/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/joshtriplett/subscriptions", "organizations_url": "https://api.github.com/users/joshtriplett/orgs", "repos_url": "https://api.github.com/users/joshtriplett/repos", "events_url": "https://api.github.com/users/joshtriplett/events{/privacy}", "received_events_url": "https://api.github.com/users/joshtriplett/received_events", "type": "User", "site_admin": false}, "reactions": {"url": "https://api.github.com/repos/rust-lang/rust/issues/89006/reactions", "total_count": 22, "+1": 4, "-1": 0, "laugh": 0, "hooray": 18, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rust-lang/rust/issues/89006/timeline", "performed_via_github_app": null, "state_reason": "completed"}