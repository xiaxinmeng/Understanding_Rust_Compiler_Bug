{"url": "https://api.github.com/repos/rust-lang/rust/issues/19978", "repository_url": "https://api.github.com/repos/rust-lang/rust", "labels_url": "https://api.github.com/repos/rust-lang/rust/issues/19978/labels{/name}", "comments_url": "https://api.github.com/repos/rust-lang/rust/issues/19978/comments", "events_url": "https://api.github.com/repos/rust-lang/rust/issues/19978/events", "html_url": "https://github.com/rust-lang/rust/issues/19978", "id": 52357004, "node_id": "MDU6SXNzdWU1MjM1NzAwNA==", "number": 19978, "title": "ICE in rustc::util::ppaux when trying to represent a TraitRef", "user": {"login": "Munksgaard", "id": 230613, "node_id": "MDQ6VXNlcjIzMDYxMw==", "avatar_url": "https://avatars.githubusercontent.com/u/230613?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Munksgaard", "html_url": "https://github.com/Munksgaard", "followers_url": "https://api.github.com/users/Munksgaard/followers", "following_url": "https://api.github.com/users/Munksgaard/following{/other_user}", "gists_url": "https://api.github.com/users/Munksgaard/gists{/gist_id}", "starred_url": "https://api.github.com/users/Munksgaard/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Munksgaard/subscriptions", "organizations_url": "https://api.github.com/users/Munksgaard/orgs", "repos_url": "https://api.github.com/users/Munksgaard/repos", "events_url": "https://api.github.com/users/Munksgaard/events{/privacy}", "received_events_url": "https://api.github.com/users/Munksgaard/received_events", "type": "User", "site_admin": false}, "labels": [], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 1, "created_at": "2014-12-18T12:10:41Z", "updated_at": "2014-12-22T02:53:12Z", "closed_at": "2014-12-22T02:53:12Z", "author_association": "CONTRIBUTOR", "active_lock_reason": null, "body": "The following code gives an ICE when compiled with \"RUST_LOG=rustc::middle::ty\"\n\n``` rust\n// foo.rs\nuse std::thunk::Invoke;\n\nfn foo(x: Box<for <'a>Invoke<&'a int, ()>>) {\n}\n\nfn bar() {\n    foo( box () (move |: _| () ))\n}\n\nfn main() {\n}\n```\n\nTerminal output:\n\n```\n$ RUST_LOG=rustc::middle::ty rustc foo.rs \n[snip]\nDEBUG:rustc::middle::ty_fold: RegionFolder.fold_region(ReLateBound(DebruijnIndex { depth: 1 }, BrNamed(DefId { krate: 0, node: 11 }, 'a))) folding free region (current_depth=1)\nDEBUG:rustc::middle::ty: region=ReLateBound(DebruijnIndex { depth: 1 }, BrNamed(DefId { krate: 0, node: 11 }, 'a))\nDEBUG:rustc::middle::ty_fold: RegionFolder.fold_region('_#1r) folding free region (current_depth=1)\nDEBUG:rustc::middle::ty: region='_#1r\nDEBUG:rustc::middle::ty: resulting map: {BrNamed(DefId { krate: 0, node: 11 }, \"'a\"(67)): ReInfer(ReSkolemized(1, BrNamed(DefId { krate: 0, node: 11 }, \"'a\"(67))))} value: <closure[ppaux-trait.rs:12:23: 12:33] : rustrt::thunk::Invoke<&'a int>>\nDEBUG:rustc::util::ppaux: In here?, strs: [_, _]\nerror: internal compiler error: unexpected panic\nnote: the compiler unexpectedly panicked. this is a bug.\nnote: we would appreciate a bug report: http://doc.rust-lang.org/complement-bugreport.html\nnote: run with `RUST_BACKTRACE=1` for a backtrace\ntask 'rustc' panicked at 'assertion failed: begin <= end', /home/munksgaard/src/rust/src/libcore/str.rs:1987\n\nstack backtrace:\n   1:     0x7f4e89d36bf0 - rt::backtrace::imp::write::h753c38a2430ca467LXx\n   2:     0x7f4e89d38ea0 - failure::on_fail::h19efc28aec0762558oy\n   3:     0x7f4e8998f130 - unwind::begin_unwind_inner::hf57a521c78af8176aNc\n   4:     0x7f4e8998ed40 - unwind::begin_unwind_fmt::h786920ac23251d41xKc\n   5:     0x7f4e8998ed00 - rust_begin_unwind\n   6:     0x7f4e899d61e0 - panicking::panic_fmt::ha079646168f8412dVul\n   7:     0x7f4e899d3ee0 - panicking::panic::h30cadc68e2188145lsl\n   8:     0x7f4e899dfdf0 - str::slice_error_fail::h169a2f1d1b3525edU2s\n   9:     0x7f4e86e871c0 - str::str.StrPrelude::slice::h871c83e51e3204cakat\n  10:     0x7f4e87314a30 - str::traits::str.ops..Slice<uint, str>::slice_or_fail::he2e6d7fdf110a1d3OSs\n  11:     0x7f4e873149a0 - string::String.ops..Slice<uint, str>::slice_or_fail::hb838c421a94a331dAjl\n  12:     0x7f4e8730ef00 - util::ppaux::parameterized::h0357a9c8dd2f0f65ZWz\n  13:     0x7f4e86c002c0 - util::ppaux::ty..TraitRef<'tcx>.Repr<'tcx>::repr::h36e5448c7a73849cQoA\n  14:     0x7f4e86cd94d0 - middle::ty::replace_late_bound_regions::h1531858869964127734\n  15:     0x7f4e86cd9450 - middle::infer::InferCtxt<'a, 'tcx>::replace_late_bound_regions_with_fresh_var::h12622384554465029402\n  16:     0x7f4e86cd7ae0 - middle::infer::higher_ranked::C.HigherRankedRelations<'tcx>::higher_ranked_sub::h13202814231754868156\n  17:     0x7f4e86b99ad0 - middle::infer::sub::Sub<'f, 'tcx>.Combine<'tcx>::trait_refs::h8f79251ad60f36b0FNy\n  18:     0x7f4e86cfeff0 - middle::infer::InferCtxt<'a, 'tcx>::sub_trait_refs::unboxed_closure.82051\n  19:     0x7f4e86cfeed0 - middle::infer::InferCtxt<'a, 'tcx>::commit_if_ok::unboxed_closure.82047\n  20:     0x7f4e86cfe8a0 - middle::infer::InferCtxt<'a, 'tcx>::try::h13041868228909284202\n  21:     0x7f4e86cfe810 - middle::infer::InferCtxt<'a, 'tcx>::commit_if_ok::unboxed_closure.82043\n  22:     0x7f4e86cfe4c0 - middle::infer::InferCtxt<'a, 'tcx>::commit_unconditionally::h9957937110058402482\n  23:     0x7f4e86cfe420 - middle::infer::InferCtxt<'a, 'tcx>::commit_if_ok::h18311147822187977066\n  24:     0x7f4e86cf1e70 - middle::infer::InferCtxt<'a, 'tcx>::sub_trait_refs::he0811510b107a039cgB\n  25:     0x7f4e86f773d0 - middle::traits::select::SelectionContext<'cx, 'tcx>::match_trait_refs::hf14282dc65e45a572o0\n  26:     0x7f4e86f62ae0 - middle::traits::select::SelectionContext<'cx, 'tcx>::match_impl::h05760caf93362a5cBm0\n  27:     0x7f4e86f7cdf0 - middle::traits::select::SelectionContext<'cx, 'tcx>::assemble_candidates_from_impls::unboxed_closure.87090\n  28:     0x7f4e86f7caf0 - middle::infer::InferCtxt<'a, 'tcx>::probe::h2528939993133769717\n  29:     0x7f4e86f72dc0 - middle::traits::select::SelectionContext<'cx, 'tcx>::assemble_candidates_from_impls::hb9747ff2e6f9d927MoZ\n  30:     0x7f4e86f67010 - middle::traits::select::SelectionContext<'cx, 'tcx>::assemble_candidates::h3a71044df78cef2eI7Y\n  31:     0x7f4e86f65990 - middle::traits::select::SelectionContext<'cx, 'tcx>::candidate_from_obligation_no_cache::hd8527b024bba7ec8KTY\n  32:     0x7f4e86f5a560 - middle::traits::select::SelectionContext<'cx, 'tcx>::candidate_from_obligation::h7ca9927d5d40cb08jLY\n  33:     0x7f4e86f4d7f0 - middle::traits::select::SelectionContext<'cx, 'tcx>::select::hae1bcf878e08d30d5qY\n  34:     0x7f4e86f44f30 - middle::traits::fulfill::process_predicate::h76dde3b8f41fc28bVXX\n  35:     0x7f4e86f44370 - middle::traits::fulfill::FulfillmentContext<'tcx>::select::unboxed_closure.86282\n  36:     0x7f4e86f44120 - vec::Vec<T>::retain::h12279568420075653578\n  37:     0x7f4e86f42590 - middle::traits::fulfill::FulfillmentContext<'tcx>::select::hc06be6e4b3591c31vQX\n  38:     0x7f4e86f42440 - middle::traits::fulfill::FulfillmentContext<'tcx>::select_new_obligations::h91c5682dcecb9c75JOX\n  39:     0x7f4e887a3310 - check::vtable::select_new_fcx_obligations::h26663844ebbab5d5qEb\n  40:     0x7f4e88afd0c0 - check::check_argument_types::he3bd55f5588b1cc173m\n  41:     0x7f4e88b11980 - check::check_expr_with_unifier::check_call::ha2d73a7c93c60093XEn\n  42:     0x7f4e88b51380 - check::check_expr_with_unifier::h14142777338591582923\n  43:     0x7f4e88b013c0 - check::check_expr_coercable_to_type::h544f7bae172a45e6Kqn\n  44:     0x7f4e88a45850 - check::check_block_with_expected::h812e5093bbaf2439uxp\n  45:     0x7f4e889ddf50 - check::check_fn::h7810879eb70097d16qk\n  46:     0x7f4e88a2bf90 - check::check_bare_fn::h139ac4d72cf0f50bxgk\n  47:     0x7f4e88a22b30 - check::check_item::haee6d627fb09d78aXzk\n  48:     0x7f4e88a22ad0 - check::CheckItemTypesVisitor<'a, 'tcx>.Visitor<'v>::visit_item::h9f212988ea8765dcwek\n  49:     0x7f4e88a29560 - visit::walk_mod::h8035559567414864198\n  50:     0x7f4e88a29510 - visit::Visitor::visit_mod::h11259418057042546077\n  51:     0x7f4e88a2b880 - visit::walk_crate::h14105224974318518012\n  52:     0x7f4e88a2b6d0 - check::check_item_types::h3a818764d13a5fc3Hfk\n  53:     0x7f4e891b71a0 - check_crate::unboxed_closure.42684\n  54:     0x7f4e891b6d60 - util::common::time::h12563125154392974828\n  55:     0x7f4e891b4070 - check_crate::h7b7df8bc37ab8e8ad7y\n  56:     0x7f4e8a18d270 - driver::phase_3_run_analysis_passes::h5a3f3baf975d5d5eEta\n  57:     0x7f4e8a164c30 - driver::compile_input::h8544a98e233f0cd0rba\n  58:     0x7f4e8a6bd350 - run_compiler::ha964b5661755640aAYb\n  59:     0x7f4e8a6a6450 - run::unboxed_closure.29622\n  60:     0x7f4e8a6a3a30 - task::TaskBuilder::try_future::unboxed_closure.29603\n  61:     0x7f4e8a6a39a0 - thunk::Thunk<(*, R>::new::unboxed_closure.29600\n  62:     0x7f4e8a6a38b0 - thunk::F.Invoke<A, R>::invoke::h5540669155237377224\n  63:     0x7f4e89d14760 - thunk::F.Invoke<A, R>::invoke::h8883895553215660696\n  64:     0x7f4e8998dd90 - task::Task::spawn_thunk::closure.5799\n  65:     0x7f4e899eaee0 - rust_try_inner\n  66:     0x7f4e899eaed0 - rust_try\n  67:     0x7f4e8998dc90 - task::Task::run::h45bc2e5c96c4ea9btNb\n  68:     0x7f4e8998d660 - thunk::F.Invoke<A, R>::invoke::h4673927346077986474\n  69:     0x7f4e8998e9c0 - thread::thread_start::h947b45e879731c8eM4b\n  70:     0x7f4e83150160 - start_thread\n  71:     0x7f4e8966dc69 - __clone\n  72:                0x0 - <unknown>\n```\n\nRust version:\n\n```\n$ rustc --version \nrustc 0.13.0-dev (22a9f250b 2014-12-17 21:33:15 +0000)\n```\n\nIt should be noted, that the above code still produces the ICE in #19919 when compiled without `RUST_LOG`.\n", "closed_by": {"login": "bors", "id": 3372342, "node_id": "MDQ6VXNlcjMzNzIzNDI=", "avatar_url": "https://avatars.githubusercontent.com/u/3372342?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors", "html_url": "https://github.com/bors", "followers_url": "https://api.github.com/users/bors/followers", "following_url": "https://api.github.com/users/bors/following{/other_user}", "gists_url": "https://api.github.com/users/bors/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors/subscriptions", "organizations_url": "https://api.github.com/users/bors/orgs", "repos_url": "https://api.github.com/users/bors/repos", "events_url": "https://api.github.com/users/bors/events{/privacy}", "received_events_url": "https://api.github.com/users/bors/received_events", "type": "User", "site_admin": false}, "reactions": {"url": "https://api.github.com/repos/rust-lang/rust/issues/19978/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rust-lang/rust/issues/19978/timeline", "performed_via_github_app": null, "state_reason": "completed"}