{"url": "https://api.github.com/repos/rust-lang/rust/issues/20480", "repository_url": "https://api.github.com/repos/rust-lang/rust", "labels_url": "https://api.github.com/repos/rust-lang/rust/issues/20480/labels{/name}", "comments_url": "https://api.github.com/repos/rust-lang/rust/issues/20480/comments", "events_url": "https://api.github.com/repos/rust-lang/rust/issues/20480/events", "html_url": "https://github.com/rust-lang/rust/issues/20480", "id": 53310613, "node_id": "MDU6SXNzdWU1MzMxMDYxMw==", "number": 20480, "title": "ICE on missing Target type in Deref implementation", "user": {"login": "swatteau", "id": 5521255, "node_id": "MDQ6VXNlcjU1MjEyNTU=", "avatar_url": "https://avatars.githubusercontent.com/u/5521255?v=4", "gravatar_id": "", "url": "https://api.github.com/users/swatteau", "html_url": "https://github.com/swatteau", "followers_url": "https://api.github.com/users/swatteau/followers", "following_url": "https://api.github.com/users/swatteau/following{/other_user}", "gists_url": "https://api.github.com/users/swatteau/gists{/gist_id}", "starred_url": "https://api.github.com/users/swatteau/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/swatteau/subscriptions", "organizations_url": "https://api.github.com/users/swatteau/orgs", "repos_url": "https://api.github.com/users/swatteau/repos", "events_url": "https://api.github.com/users/swatteau/events{/privacy}", "received_events_url": "https://api.github.com/users/swatteau/received_events", "type": "User", "site_admin": false}, "labels": [], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 3, "created_at": "2015-01-03T17:59:09Z", "updated_at": "2015-01-04T19:07:59Z", "closed_at": "2015-01-04T19:07:59Z", "author_association": "NONE", "active_lock_reason": null, "body": "_Version of Rust_: rustc 0.13.0-nightly (c89417130 2015-01-02 21:56:13 +0000)\n_Operating system_: Linux 3.16.0-4-686-pae #1 SMP Debian 3.16.7-ckt2-1 (2014-12-08) i686 GNU/Linux\n\nWhen the associated `Target` type is not defined in an `impl Deref`, this leads to an internal compiler error.\n\nHere is an example:\n\n```\n#![feature(associated_types)]\nuse std::ops::Deref;\n\nstruct Wrapper {\n    inner: int\n}\n\nimpl Deref for Wrapper {\n    //type Target = int;\n    fn deref(&self) -> &int {\n        &self.inner\n    }\n}\n\nfn main() {\n}\n```\n\nError message from the compiler:\n\n```\nsrc/main.rs:10:5: 12:6 error: internal compiler error: impl `VtableImpl(impl_def_id=DefId { krate: 0, node: 10 }:Wrapper.Deref, substs=Substs[types=[[];[];[]], regions=[[];[];[]]], nested=[[];[];[]])` did not contain projection for `Obligation(predicate=<Wrapper as TraitRef(Wrapper, core::ops::Deref)>::Target,depth=0)`\nsrc/main.rs:10     fn deref(&self) -> &int {\nsrc/main.rs:11         &self.inner\nsrc/main.rs:12     }\nnote: the compiler unexpectedly panicked. this is a bug.\nnote: we would appreciate a bug report: http://doc.rust-lang.org/complement-bugreport.html\nnote: run with `RUST_BACKTRACE=1` for a backtrace\n```\n\nBacktrace:\n\n```\nthread 'rustc' panicked at 'Box<Any>', /home/rustbuild/src/rust-buildbot/slave/nightly-dist-rustc-linux/build/src/libsyntax/diagnostic.rs:123\n\nstack backtrace:\n   1: 0xb7383f20 - sys::backtrace::write::h6d0a4417f4e5c493sit\n   2: 0xb73a8770 - failure::on_fail::h17e5357971ef1fadTuz\n   3: 0xb7310d00 - rt::unwind::begin_unwind_inner::h81966bf04c2cd1f4y9y\n   4: 0xb389edb0 - rt::unwind::begin_unwind::h12436254939101185090\n   5: 0xb389ed20 - diagnostic::SpanHandler::span_bug::h64fa6f5fbd27e941zFF\n   6: 0xb6326a10 - middle::traits::project::project_type::h85510b9af23c51a6UQP\n   7: 0xb6323b00 - middle::traits::project::opt_normalize_projection_type::h16b6e65a2aa8a5c1XIP\n   8: 0xb6312320 - middle::traits::project::normalize_projection_type::h4e3c940bec71651byHP\n   9: 0xb6324ea0 - middle::traits::project::AssociatedTypeNormalizer<'a, 'b, 'tcx>.TypeFolder<'tcx>::fold_ty::h3cbce0725be04edf9FP\n  10: 0xb6324ea0 - middle::traits::project::AssociatedTypeNormalizer<'a, 'b, 'tcx>.TypeFolder<'tcx>::fold_ty::h3cbce0725be04edf9FP\n  11: 0xb6dc4600 - middle::ty_fold::ty..FnSig<'tcx>.TypeFoldable<'tcx>::fold_with::h10991263838617593069\n  12: 0xb6e58690 - check::assoc::normalize_associated_types_in::h9980513805539501870\n  13: 0xb6e4eae0 - check::compare_impl_method::h37df9bd14bbfe837q4j\n  14: 0xb6e3aed0 - check::check_item::hda7b1175944bf853SGj\n  15: 0xb6ff1830 - check_crate::unboxed_closure.39847\n  16: 0xb6fec070 - check_crate::h5a3950962091692dVlx\n  17: 0xb76bf8b0 - driver::phase_3_run_analysis_passes::hf1b11de46876f77cTva\n  18: 0xb76ad980 - driver::compile_input::h567277daca5fdd24wba\n  19: 0xb777fa80 - thunk::F.Invoke<A, R>::invoke::h14467627679629470429\n  20: 0xb777e890 - rt::unwind::try::try_fn::h7264457252665277252\n  21: 0xb7418c90 - rust_try_inner\n  22: 0xb7418c60 - rust_try\n  23: 0xb777ebd0 - thunk::F.Invoke<A, R>::invoke::h428659666485879903\n  24: 0xb73956c0 - sys::thread::thread_start::haeae5d792ecbddcdy8v\n  25: 0xb36c4e30 - start_thread\n  26: 0xb71eddf2 - clone\n  27:        0x0 - <unknown>\n```\n", "closed_by": {"login": "alexcrichton", "id": 64996, "node_id": "MDQ6VXNlcjY0OTk2", "avatar_url": "https://avatars.githubusercontent.com/u/64996?v=4", "gravatar_id": "", "url": "https://api.github.com/users/alexcrichton", "html_url": "https://github.com/alexcrichton", "followers_url": "https://api.github.com/users/alexcrichton/followers", "following_url": "https://api.github.com/users/alexcrichton/following{/other_user}", "gists_url": "https://api.github.com/users/alexcrichton/gists{/gist_id}", "starred_url": "https://api.github.com/users/alexcrichton/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/alexcrichton/subscriptions", "organizations_url": "https://api.github.com/users/alexcrichton/orgs", "repos_url": "https://api.github.com/users/alexcrichton/repos", "events_url": "https://api.github.com/users/alexcrichton/events{/privacy}", "received_events_url": "https://api.github.com/users/alexcrichton/received_events", "type": "User", "site_admin": false}, "reactions": {"url": "https://api.github.com/repos/rust-lang/rust/issues/20480/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rust-lang/rust/issues/20480/timeline", "performed_via_github_app": null, "state_reason": "completed"}