{"url": "https://api.github.com/repos/rust-lang/rust/issues/5754", "repository_url": "https://api.github.com/repos/rust-lang/rust", "labels_url": "https://api.github.com/repos/rust-lang/rust/issues/5754/labels{/name}", "comments_url": "https://api.github.com/repos/rust-lang/rust/issues/5754/comments", "events_url": "https://api.github.com/repos/rust-lang/rust/issues/5754/events", "html_url": "https://github.com/rust-lang/rust/issues/5754", "id": 12868329, "node_id": "MDU6SXNzdWUxMjg2ODMyOQ==", "number": 5754, "title": "\"task failed at 'index out of bounds...\" when compiling", "user": {"login": "hdgarrood", "id": 1270186, "node_id": "MDQ6VXNlcjEyNzAxODY=", "avatar_url": "https://avatars.githubusercontent.com/u/1270186?v=4", "gravatar_id": "", "url": "https://api.github.com/users/hdgarrood", "html_url": "https://github.com/hdgarrood", "followers_url": "https://api.github.com/users/hdgarrood/followers", "following_url": "https://api.github.com/users/hdgarrood/following{/other_user}", "gists_url": "https://api.github.com/users/hdgarrood/gists{/gist_id}", "starred_url": "https://api.github.com/users/hdgarrood/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/hdgarrood/subscriptions", "organizations_url": "https://api.github.com/users/hdgarrood/orgs", "repos_url": "https://api.github.com/users/hdgarrood/repos", "events_url": "https://api.github.com/users/hdgarrood/events{/privacy}", "received_events_url": "https://api.github.com/users/hdgarrood/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 9618520, "node_id": "MDU6TGFiZWw5NjE4NTIw", "url": "https://api.github.com/repos/rust-lang/rust/labels/I-ICE", "name": "I-ICE", "color": "e10c02", "default": false, "description": "Issue: The compiler panicked, giving an Internal Compilation Error (ICE) \u2744\ufe0f"}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 0, "created_at": "2013-04-05T23:26:24Z", "updated_at": "2013-05-07T07:44:20Z", "closed_at": "2013-04-14T14:44:09Z", "author_association": "NONE", "active_lock_reason": null, "body": "rustc says this is a bug, so here goes:\n\nHere's the code I'm trying to compile:\n\n```\n// chipmunk.rs\npub mod ll {\n    struct cpVect {\n        x: float,\n        y: float\n    }\n\n    pub extern {\n        fn cpv(x: int, y: int) -> cpVect;\n        fn cpvadd(vec1: cpVect, vec2: cpVect) -> cpVect;\n        static cpvzero: cpVect;\n    }\n}\n\nfn main() {\n    unsafe {\n        let vec1 = ll::cpv(30, 40);\n        let vec2 = ll::cpv(-23, 35);\n\n        io::println(fmt!(\"vector sum is %?\", ll::cpvadd(vec1, vec2)));\n    }\n}\n```\n\nAnd here's what happens when I try to compile:\n\n```\n$ RUST_LOG=rustc=1,::rt::backtrace rustc chipmunk.rs\nchipmunk.rs:8:18: 8:21 warning: found rust type `int` in foreign module, while libc::c_int or libc::c_long should be used\nchipmunk.rs:8         fn cpv(x: int, y: int) -> cpVect;\n                                ^~~\nchipmunk.rs:8:26: 8:29 warning: found rust type `int` in foreign module, while libc::c_int or libc::c_long should be used\nchipmunk.rs:8         fn cpv(x: int, y: int) -> cpVect;\n                                        ^~~\nrust: task failed at 'index out of bounds: the len is 2 but the index is 2', /home/harry/build/rust/src/librustc/middle/trans/cabi_x86_64.rs:248\n/home/harry/.local/bin/../lib/librustrt.so(_ZN9rust_task13begin_failureEPKcS1_m+0x4b)[0x7fe683313c7b]\n/home/harry/.local/bin/../lib/librustrt.so(+0x2aa69)[0x7fe683324a69]\n/home/harry/.local/bin/../lib/librustrt.so(upcall_fail+0x1a8)[0x7fe683315a68]\n/home/harry/.local/bin/../lib/libcore-c3ca5d77d81b46c1-0.6.so(+0x1055fb)[0x7fe684e4a5fb]\n/home/harry/.local/bin/../lib/libcore-c3ca5d77d81b46c1-0.6.so(+0x4d1de)[0x7fe684d921de]\n/home/harry/.local/bin/../lib/libcore-c3ca5d77d81b46c1-0.6.so(_ZN8unstable4lang17fail_bounds_check16_6fb13a2fe60974b3_06E+0x22f)[0x7fe684d9b53f]\n/home/harry/.local/bin/../lib/librustc-c84825241471686d-0.6.so(+0x2f717c)[0x7fe68384d17c]\n/home/harry/.local/bin/../lib/librustc-c84825241471686d-0.6.so(_ZN6middle5trans11cabi_x86_6414__extensions__10meth_3425112compute_info16_ba1369f44fa5d573_06E+0x16e)[0x7fe68384dcbe]\n/home/harry/.local/bin/../lib/librustc-c84825241471686d-0.6.so(+0x8b8fb4)[0x7fe683e0efb4]\n/home/harry/.local/bin/../lib/librustc-c84825241471686d-0.6.so(+0x2faf53)[0x7fe683850f53]\n/home/harry/.local/bin/../lib/librustc-c84825241471686d-0.6.so(+0x2fc42d)[0x7fe68385242d]\n/home/harry/.local/bin/../lib/librustc-c84825241471686d-0.6.so(+0x2fc110)[0x7fe683852110]\n/home/harry/.local/bin/../lib/librustc-c84825241471686d-0.6.so(_ZN6middle5trans7foreign17trans_foreign_mod16_75c1b14fd3764383_06E+0x11e)[0x7fe6837ca1fe]\n/home/harry/.local/bin/../lib/librustc-c84825241471686d-0.6.so(_ZN6middle5trans4base10trans_item16_ed7df62f5f126563_06E+0x48d)[0x7fe68366280d]\n/home/harry/.local/bin/../lib/librustc-c84825241471686d-0.6.so(_ZN6middle5trans4base9trans_mod17_33f95ffa6ea6f19d3_06E+0xa3)[0x7fe6837c9fe3]\n/home/harry/.local/bin/../lib/librustc-c84825241471686d-0.6.so(_ZN6middle5trans4base10trans_item16_ed7df62f5f126563_06E+0x46e)[0x7fe6836627ee]\n/home/harry/.local/bin/../lib/librustc-c84825241471686d-0.6.so(_ZN6middle5trans4base9trans_mod17_33f95ffa6ea6f19d3_06E+0xa3)[0x7fe6837c9fe3]\n/home/harry/.local/bin/../lib/librustc-c84825241471686d-0.6.so(_ZN6middle5trans4base11trans_crate15_aa5d2b86af98143_06E+0x13c4)[0x7fe6837e9c94]\n/home/harry/.local/bin/../lib/librustc-c84825241471686d-0.6.so(+0x87a6d0)[0x7fe683dd06d0]\n/home/harry/.local/bin/../lib/librustc-c84825241471686d-0.6.so(_ZN6driver6driver12compile_rest17_b2b258b84b35f3533_06E+0x331e)[0x7fe683dcd6de]\n/home/harry/.local/bin/../lib/librustc-c84825241471686d-0.6.so(+0x8b8fb4)[0x7fe683e0efb4]\n/home/harry/.local/bin/../lib/librustc-c84825241471686d-0.6.so(_ZN6driver6driver12compile_upto17_12335154b455986e3_06E+0x108)[0x7fe683dd08e8]\n/home/harry/.local/bin/../lib/librustc-c84825241471686d-0.6.so(+0x8b8fb4)[0x7fe683e0efb4]\n/home/harry/.local/bin/../lib/librustc-c84825241471686d-0.6.so(_ZN6driver6driver13compile_input15_bb29edf7a232863_06E+0xca)[0x7fe683dd0d2a]\n/home/harry/.local/bin/../lib/librustc-c84825241471686d-0.6.so(_ZN12run_compiler17_64d52739a36d169c3_06E+0x20aa)[0x7fe683e0044a]\n/home/harry/.local/bin/../lib/librustc-c84825241471686d-0.6.so(+0x8b6a81)[0x7fe683e0ca81]\n/home/harry/.local/bin/../lib/librustc-c84825241471686d-0.6.so(+0x8b32ac)[0x7fe683e092ac]\n/home/harry/.local/bin/../lib/librustc-c84825241471686d-0.6.so(+0x8b8fb4)[0x7fe683e0efb4]\n/home/harry/.local/bin/../lib/libcore-c3ca5d77d81b46c1-0.6.so(+0xce0ae)[0x7fe684e130ae]\n/home/harry/.local/bin/../lib/libcore-c3ca5d77d81b46c1-0.6.so(+0x14dcd4)[0x7fe684e92cd4]\n/home/harry/.local/bin/../lib/librustrt.so(_Z18task_start_wrapperP10spawn_args+0x24)[0x7fe6833144c4]\nerror: internal compiler error: unexpected failure\nnote: the compiler hit an unexpected failure path. this is a bug\nnote: try running with RUST_LOG=rustc=1,::rt::backtrace to get further details and report the results to github.com/mozilla/rust/issues\nrust: task failed at 'explicit failure', /home/harry/build/rust/src/librustc/rustc.rc:357\n/home/harry/.local/bin/../lib/librustrt.so(_ZN9rust_task13begin_failureEPKcS1_m+0x4b)[0x7fe683313c7b]\n/home/harry/.local/bin/../lib/librustrt.so(+0x2aa69)[0x7fe683324a69]\n/home/harry/.local/bin/../lib/librustrt.so(upcall_fail+0x1a8)[0x7fe683315a68]\n/home/harry/.local/bin/../lib/libcore-c3ca5d77d81b46c1-0.6.so(+0x1055fb)[0x7fe684e4a5fb]\n/home/harry/.local/bin/../lib/libcore-c3ca5d77d81b46c1-0.6.so(+0x1055a2)[0x7fe684e4a5a2]\n/home/harry/.local/bin/../lib/libcore-c3ca5d77d81b46c1-0.6.so(_ZN3sys12begin_unwind17_61fe198059b9e3fc3_06E+0x71)[0x7fe684d92671]\n/home/harry/.local/bin/../lib/libcore-c3ca5d77d81b46c1-0.6.so(+0x14dcd4)[0x7fe684e92cd4]\n/home/harry/.local/bin/../lib/librustc-c84825241471686d-0.6.so(_ZN7monitor17_78935df9ff9e1afa3_06E+0x1577)[0x7fe683e02a77]\n/home/harry/.local/bin/../lib/librustc-c84825241471686d-0.6.so(+0x8b8fb4)[0x7fe683e0efb4]\n/home/harry/.local/bin/../lib/librustc-c84825241471686d-0.6.so(_ZN4main15_c4de63b748e03d3_06E+0x7e)[0x7fe683e0ebce]\n/home/harry/.local/bin/../lib/librustrt.so(_Z18task_start_wrapperP10spawn_args+0x24)[0x7fe6833144c4]\nrust: domain main @0xe283c0 root task failed\nexit code was 101\n```\n\nI built rust from the tag `release-0.6`:\n\n```\n$ rustc --version\nrustc 0.6 (00dbbd0 2013-04-02 11:07:11 -0700)\nhost: x86_64-unknown-linux-gnu\n```\n\nThe library I'm trying to link with is https://github.com/slembcke/Chipmunk-Physics at version 6.1.4. Also, on the off-chance that it's relevant:\n\n```\n$ cat /etc/lsb-release \nDISTRIB_ID=LinuxMint\nDISTRIB_RELEASE=14\nDISTRIB_CODENAME=nadia\nDISTRIB_DESCRIPTION=\"Linux Mint 14 Nadia\"\n```\n", "closed_by": {"login": "sanxiyn", "id": 45249, "node_id": "MDQ6VXNlcjQ1MjQ5", "avatar_url": "https://avatars.githubusercontent.com/u/45249?v=4", "gravatar_id": "", "url": "https://api.github.com/users/sanxiyn", "html_url": "https://github.com/sanxiyn", "followers_url": "https://api.github.com/users/sanxiyn/followers", "following_url": "https://api.github.com/users/sanxiyn/following{/other_user}", "gists_url": "https://api.github.com/users/sanxiyn/gists{/gist_id}", "starred_url": "https://api.github.com/users/sanxiyn/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/sanxiyn/subscriptions", "organizations_url": "https://api.github.com/users/sanxiyn/orgs", "repos_url": "https://api.github.com/users/sanxiyn/repos", "events_url": "https://api.github.com/users/sanxiyn/events{/privacy}", "received_events_url": "https://api.github.com/users/sanxiyn/received_events", "type": "User", "site_admin": false}, "reactions": {"url": "https://api.github.com/repos/rust-lang/rust/issues/5754/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rust-lang/rust/issues/5754/timeline", "performed_via_github_app": null, "state_reason": "completed"}