{"url": "https://api.github.com/repos/rust-lang/rust/issues/89973", "repository_url": "https://api.github.com/repos/rust-lang/rust", "labels_url": "https://api.github.com/repos/rust-lang/rust/issues/89973/labels{/name}", "comments_url": "https://api.github.com/repos/rust-lang/rust/issues/89973/comments", "events_url": "https://api.github.com/repos/rust-lang/rust/issues/89973/events", "html_url": "https://github.com/rust-lang/rust/issues/89973", "id": 1028209728, "node_id": "I_kwDOAAsO6M49STxA", "number": 89973, "title": "Incomplete/confusing description of unsatisfied trait bounds on function (plotters)", "user": {"login": "cr1901", "id": 6418027, "node_id": "MDQ6VXNlcjY0MTgwMjc=", "avatar_url": "https://avatars.githubusercontent.com/u/6418027?v=4", "gravatar_id": "", "url": "https://api.github.com/users/cr1901", "html_url": "https://github.com/cr1901", "followers_url": "https://api.github.com/users/cr1901/followers", "following_url": "https://api.github.com/users/cr1901/following{/other_user}", "gists_url": "https://api.github.com/users/cr1901/gists{/gist_id}", "starred_url": "https://api.github.com/users/cr1901/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/cr1901/subscriptions", "organizations_url": "https://api.github.com/users/cr1901/orgs", "repos_url": "https://api.github.com/users/cr1901/repos", "events_url": "https://api.github.com/users/cr1901/events{/privacy}", "received_events_url": "https://api.github.com/users/cr1901/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 235791, "node_id": "MDU6TGFiZWwyMzU3OTE=", "url": "https://api.github.com/repos/rust-lang/rust/labels/A-diagnostics", "name": "A-diagnostics", "color": "f7e101", "default": false, "description": "Area: Messages for errors, warnings, and lints"}, {"id": 211668100, "node_id": "MDU6TGFiZWwyMTE2NjgxMDA=", "url": "https://api.github.com/repos/rust-lang/rust/labels/T-compiler", "name": "T-compiler", "color": "bfd4f2", "default": false, "description": "Relevant to the compiler team, which will review and decide on the PR/issue."}], "state": "open", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 0, "created_at": "2021-10-17T04:05:35Z", "updated_at": "2021-10-17T04:05:35Z", "closed_at": null, "author_association": "CONTRIBUTOR", "active_lock_reason": null, "body": "When building a small script using the [plotters](https://github.com/38/plotters) library, I got several trait bound errors that took me a long time to actually diagnose. I've provided an [MCVE](https://github.com/cr1901/plotters-error) and perhaps additional error output that would've made the problem clearer.\r\n\r\n## Actual Error Output\r\nGiven the the linked [repository](https://github.com/cr1901/plotters-error) built with `cargo build`, the current error output is:\r\n\r\n```\r\nWilliam@DESKTOP-H0PMN4M MINGW64 ~/Projects/MCVE/plotters-error\r\n$ cargo build\r\n   Compiling plotters-error v0.1.0 (C:\\msys64\\home\\William\\Projects\\MCVE\\plotters-error)\r\nerror[E0277]: the trait bound `(): Ranged` is not satisfied\r\n  --> src\\main.rs:44:45\r\n   |\r\n44 |     let mut chart = ChartBuilder::on(&root).build_cartesian_2d((), 0u32..500u32)?;\r\n   |                                             ^^^^^^^^^^^^^^^^^^ the trait `Ranged` is not implemented for `()`\r\n   |\r\nnote: required by a bound in `Cartesian2d`\r\n  --> C:\\Users\\William\\.cargo\\registry\\src\\github.com-1ecc6299db9ec823\\plotters-0.3.1\\src\\coord\\ranged2d\\cartesian.rs:20:27\r\n   |\r\n20 | pub struct Cartesian2d<X: Ranged, Y: Ranged> {\r\n   |                           ^^^^^^ required by this bound in `Cartesian2d`\r\n\r\nerror[E0277]: the trait bound `Cartesian2d<(), RangedCoordu32>: CoordTranslate` is not satisfied\r\n  --> src\\main.rs:44:21\r\n   |\r\n44 |     let mut chart = ChartBuilder::on(&root).build_cartesian_2d((), 0u32..500u32)?;\r\n   |                     ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^ the trait `CoordTranslate` is not implemented for `Cartesian2d<(), RangedCoordu32>`\r\n   |\r\n   = help: the following implementations were found:\r\n             <Cartesian2d<X, Y> as CoordTranslate>\r\nnote: required by a bound in `ChartContext`\r\n  --> C:\\Users\\William\\.cargo\\registry\\src\\github.com-1ecc6299db9ec823\\plotters-0.3.1\\src\\chart\\context.rs:28:53\r\n   |\r\n28 | pub struct ChartContext<'a, DB: DrawingBackend, CT: CoordTranslate> {\r\n   |                                                     ^^^^^^^^^^^^^^ required by this bound in `ChartContext`\r\n\r\nerror[E0277]: the trait bound `(): Ranged` is not satisfied\r\n  --> src\\main.rs:44:21\r\n   |\r\n44 |     let mut chart = ChartBuilder::on(&root).build_cartesian_2d((), 0u32..500u32)?;\r\n   |                     ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^ the trait `Ranged` is not implemented for `()`\r\n   |\r\nnote: required by a bound in `Cartesian2d`\r\n  --> C:\\Users\\William\\.cargo\\registry\\src\\github.com-1ecc6299db9ec823\\plotters-0.3.1\\src\\coord\\ranged2d\\cartesian.rs:20:27\r\n   |\r\n20 | pub struct Cartesian2d<X: Ranged, Y: Ranged> {\r\n   |                           ^^^^^^ required by this bound in `Cartesian2d`\r\n\r\nerror[E0277]: the trait bound `Cartesian2d<(), RangedCoordu32>: CoordTranslate` is not satisfied\r\n  --> src\\main.rs:44:21\r\n   |\r\n44 |     let mut chart = ChartBuilder::on(&root).build_cartesian_2d((), 0u32..500u32)?;\r\n   |                     ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^ the trait `CoordTranslate` is not implemented for `Cartesian2d<(), RangedCoordu32>`\r\n   |\r\n   = help: the following implementations were found:\r\n             <Cartesian2d<X, Y> as CoordTranslate>\r\nnote: required by a bound in `ChartContext`\r\n  --> C:\\Users\\William\\.cargo\\registry\\src\\github.com-1ecc6299db9ec823\\plotters-0.3.1\\src\\chart\\context.rs:28:53\r\n   |\r\n28 | pub struct ChartContext<'a, DB: DrawingBackend, CT: CoordTranslate> {\r\n   |                                                     ^^^^^^^^^^^^^^ required by this bound in `ChartContext`\r\n\r\nerror[E0277]: the trait bound `(): Ranged` is not satisfied\r\n  --> src\\main.rs:44:21\r\n   |\r\n44 |     let mut chart = ChartBuilder::on(&root).build_cartesian_2d((), 0u32..500u32)?;\r\n   |                     ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^ the trait `Ranged` is not implemented for `()`\r\n   |\r\nnote: required by a bound in `Cartesian2d`\r\n  --> C:\\Users\\William\\.cargo\\registry\\src\\github.com-1ecc6299db9ec823\\plotters-0.3.1\\src\\coord\\ranged2d\\cartesian.rs:20:27\r\n   |\r\n20 | pub struct Cartesian2d<X: Ranged, Y: Ranged> {\r\n   |                           ^^^^^^ required by this bound in `Cartesian2d`\r\n\r\nFor more information about this error, try `rustc --explain E0277`.\r\nerror: could not compile `plotters-error` due to 5 previous errors\r\n```\r\n\r\n## Desired Error Output\r\n\r\n### `AsRangedCoord`\r\nIdeally the output should _include_ something like (please note my formatting of the arrows is not perfect):\r\n\r\n```\r\nerror[E0277]: the trait bound `(): Ranged` is not satisfied for `build_cartesian_2d`\r\n  --> src\\main.rs:44:45\r\n   |\r\n44 |     let mut chart = ChartBuilder::on(&root).build_cartesian_2d((), 0u32..500u32)?;\r\n   |                                                                       ^^^^^^^^^^^^^^^^^^\r\n   |\r\nnote: required by this bound in `build_cartesian_2d`\r\n  --> C:\\path\\to\\plotters\\chart\\builder.rs\r\n   |\r\n179 | pub fn build_cartesian_2d<X: AsRangedCoord, Y: AsRangedCoord>(\r\n   |                                                ^^^^^^ required by this bound in `build_cartesian_2d`\r\n```\r\n\r\n### `CoordTranslate`\r\nAdditionally, I do not find the help for \"`CoordTranslate` is not implemented\" helpful. The current help text:\r\n\r\n```\r\n= help: the following implementations were found:\r\n             <Cartesian2d<X, Y> as CoordTranslate>\r\n```\r\n\r\nloses information about _why_ the found trait implementations _cannot_ be used, although the reason _why_ the found trait impl can't be used is implied in an earlier error:\r\n\r\n```\r\n20 | pub struct Cartesian2d<X: Ranged, Y: Ranged> {\r\n   |                           ^^^^^^ required by this bound in `Cartesian2d`\r\n```\r\n\r\nPerhaps some extra context _in the error I'm currently focusing on_ would help?\r\n\r\n```\r\n= help: the following implementations were found:\r\n             <Cartesian2d<X: Ranged, Y: Ranged> as CoordTranslate>\r\n```\r\n\r\n## Reasoning\r\nThe errors reported are correct, but took me a long time to figure out that _all_ the errors boil down to \"`Ranged` isn't satisfied for ()\", including an error not reported for `AsRangedCoord`. I think what would've helped me most is reporting that `AsRangedCoord` requirements not being satisfied. The errors already report that _other_ trait bounds can't be satisfied because `Ranged` isn't satisfied (`Cartesian2d`).\r\n\r\nThe function signature for `build_cartesian_2d` in the [docs](https://docs.rs/plotters/0.3.1/plotters/chart/struct.ChartBuilder.html#method.build_cartesian_2d) looks like this:\r\n\r\n```\r\npub fn build_cartesian_2d<X: AsRangedCoord, Y: AsRangedCoord>(\r\n    &mut self,\r\n    x_spec: X,\r\n    y_spec: Y\r\n) -> Result<ChartContext<'a, DB, Cartesian2d<X::CoordDescType, Y::CoordDescType>>, DrawingAreaErrorKind<DB::ErrorType>>\r\n```\r\n\r\n### `AsRangedCoord`/`Cartesian2d`\r\nBecause `AsRangedCoord` is the first bounds you see when opening the crate docs, it seems reasonable that \"the inputs don't implement `AsRangedCoord`\" should be shown as part of the diagnostic, and why (because one of it's associated types is bound by `Ranged`) . The `Ranged` trait doesn't even directly appear in build_cartesian_2d's signature.  \r\n\r\nThe \"`Cartesian2d` does not implement `Ranged`\" error is fine as-is, but since my eyes errors starting at inputs first, it wasn't clear to me why `Cartesian2d` was reporting errors on a `Ranged` trait not even in the type signature while the similarly-named `AsRangedCoord` was unaffected. Until I understood how `Ranged` and `AsRangedCoord` are related- clear in retrospect, but not clear when looking at multiple errors at once- I thought this might mean I had to focus on two potential error sources instead of one.\r\n\r\n### `CoordTranslate`\r\nAt this point, I had to spend more time looking at the function outputs, cross-referencing the documentation of those types' trait bounds back to the function signature of `build_cartesian_2d`.  I got further confused by the `help` for \"`Cartesian2d<X, Y>` doesn't implement `CoordTranslate`\", whose help message claims that the trait `CoordTranslate` _is_ implemented for `Cartesian2d<X,Y>`.\r\n\r\nI can scroll up to the previous error to find more context why this implementation for `Cartesian2d<X,Y>` is unusable (I can't actually _make_ a `Cartesian2d<(), RangedCoordu32>`, so it can't possibly satisfy the trait bound `CoordTranslate`). But my eyes tend to focus on one error at a time. _Not understanding the help message immediately was another reason I was looking for hints with `AsRangedCoord` rather than the reported errors._\r\n\r\n## Additional Context\r\nI tried this MCVE with two Rust compilers and got the same error output (besides paths):\r\n\r\n```\r\nrustc 1.56.0-nightly (d3e2578c3 2021-08-21)\r\nbinary: rustc\r\ncommit-hash: d3e2578c31688619ddc0a10ddf8543bf4ebcba5b\r\ncommit-date: 2021-08-21\r\nhost: x86_64-pc-windows-gnu\r\nrelease: 1.56.0-nightly\r\nLLVM version: 13.0.0\r\n```\r\n\r\n```\r\nrustc 1.57.0-nightly (4e89811b4 2021-10-16)\r\nbinary: rustc\r\ncommit-hash: 4e89811b46323f432544f9c4006e40d5e5d7663f\r\ncommit-date: 2021-10-16\r\nhost: x86_64-unknown-linux-gnu\r\nrelease: 1.57.0-nightly\r\nLLVM version: 13.0.0\r\n```\r\n\r\nI also tried duplicating this message in the [playground](https://play.rust-lang.org/?version=stable&mode=debug&edition=2018&gist=9a1400f1796cbaeace2d3a6f26dd3360), but concluded that I needed to re-implement too much of the crate to trigger the error. @estebank [told me](https://twitter.com/ekuber/status/1447484249146380289) about the `-Z everybody_loops` option that I haven't tried yet, however. So perhaps I can minimize this further.\r\n", "closed_by": null, "reactions": {"url": "https://api.github.com/repos/rust-lang/rust/issues/89973/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rust-lang/rust/issues/89973/timeline", "performed_via_github_app": null, "state_reason": null}