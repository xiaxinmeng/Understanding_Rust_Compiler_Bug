{"url": "https://api.github.com/repos/rust-lang/rust/issues/46553", "repository_url": "https://api.github.com/repos/rust-lang/rust", "labels_url": "https://api.github.com/repos/rust-lang/rust/issues/46553/labels{/name}", "comments_url": "https://api.github.com/repos/rust-lang/rust/issues/46553/comments", "events_url": "https://api.github.com/repos/rust-lang/rust/issues/46553/events", "html_url": "https://github.com/rust-lang/rust/issues/46553", "id": 280046283, "node_id": "MDU6SXNzdWUyODAwNDYyODM=", "number": 46553, "title": "Incorrect constant evaluation warning on correct code", "user": {"login": "mooman219", "id": 865769, "node_id": "MDQ6VXNlcjg2NTc2OQ==", "avatar_url": "https://avatars.githubusercontent.com/u/865769?v=4", "gravatar_id": "", "url": "https://api.github.com/users/mooman219", "html_url": "https://github.com/mooman219", "followers_url": "https://api.github.com/users/mooman219/followers", "following_url": "https://api.github.com/users/mooman219/following{/other_user}", "gists_url": "https://api.github.com/users/mooman219/gists{/gist_id}", "starred_url": "https://api.github.com/users/mooman219/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/mooman219/subscriptions", "organizations_url": "https://api.github.com/users/mooman219/orgs", "repos_url": "https://api.github.com/users/mooman219/repos", "events_url": "https://api.github.com/users/mooman219/events{/privacy}", "received_events_url": "https://api.github.com/users/mooman219/received_events", "type": "User", "site_admin": false}, "labels": [], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 3, "created_at": "2017-12-07T08:45:36Z", "updated_at": "2017-12-13T01:44:49Z", "closed_at": "2017-12-13T01:44:49Z", "author_association": "NONE", "active_lock_reason": null, "body": "It looks like I'm incorrectly being warned of a constant evaluation error on valid code. The code runs just fine and is not violating the constant function requirements.\r\n\r\nOffending code:\r\n```rust\r\n#![feature(const_fn)]\r\n\r\npub struct Data<T> {\r\n    function: fn() -> T,\r\n}\r\n\r\nimpl<T> Data<T> {\r\n    pub const fn new(function: fn() -> T) -> Data<T> {\r\n        Data {\r\n            function: function,\r\n        }\r\n    }\r\n}\r\n\r\npub static DATA: Data<i32> = Data::new(|| {\r\n    413i32\r\n});\r\n\r\nfn main() {\r\n    print!(\"{:?}\", (DATA.function)());\r\n}\r\n```\r\nIncorrect error:\r\n```rust\r\nwarning: constant evaluation error: unsupported constant expr\r\n  --> src/main.rs:15:30\r\n   |\r\n15 |   pub static DATA: Data<i32> = Data::new(|| {\r\n   |  ______________________________^\r\n16 | |     413i32\r\n17 | | });\r\n   | |__^\r\n   |\r\n   = note: #[warn(const_err)] on by default\r\n```\r\n[Example of the issue on the playground in nightly](https://play.rust-lang.org/?gist=201319d1da5c170986d22d096d493f0d&version=nightly).\r\n\r\nPing #24111 ", "closed_by": {"login": "bors", "id": 3372342, "node_id": "MDQ6VXNlcjMzNzIzNDI=", "avatar_url": "https://avatars.githubusercontent.com/u/3372342?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors", "html_url": "https://github.com/bors", "followers_url": "https://api.github.com/users/bors/followers", "following_url": "https://api.github.com/users/bors/following{/other_user}", "gists_url": "https://api.github.com/users/bors/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors/subscriptions", "organizations_url": "https://api.github.com/users/bors/orgs", "repos_url": "https://api.github.com/users/bors/repos", "events_url": "https://api.github.com/users/bors/events{/privacy}", "received_events_url": "https://api.github.com/users/bors/received_events", "type": "User", "site_admin": false}, "reactions": {"url": "https://api.github.com/repos/rust-lang/rust/issues/46553/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rust-lang/rust/issues/46553/timeline", "performed_via_github_app": null, "state_reason": "completed"}