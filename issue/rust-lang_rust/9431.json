{"url": "https://api.github.com/repos/rust-lang/rust/issues/9431", "repository_url": "https://api.github.com/repos/rust-lang/rust", "labels_url": "https://api.github.com/repos/rust-lang/rust/issues/9431/labels{/name}", "comments_url": "https://api.github.com/repos/rust-lang/rust/issues/9431/comments", "events_url": "https://api.github.com/repos/rust-lang/rust/issues/9431/events", "html_url": "https://github.com/rust-lang/rust/issues/9431", "id": 19923463, "node_id": "MDU6SXNzdWUxOTkyMzQ2Mw==", "number": 9431, "title": "Statics' symbol names are susceptible to drift", "user": {"login": "alexcrichton", "id": 64996, "node_id": "MDQ6VXNlcjY0OTk2", "avatar_url": "https://avatars.githubusercontent.com/u/64996?v=4", "gravatar_id": "", "url": "https://api.github.com/users/alexcrichton", "html_url": "https://github.com/alexcrichton", "followers_url": "https://api.github.com/users/alexcrichton/followers", "following_url": "https://api.github.com/users/alexcrichton/following{/other_user}", "gists_url": "https://api.github.com/users/alexcrichton/gists{/gist_id}", "starred_url": "https://api.github.com/users/alexcrichton/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/alexcrichton/subscriptions", "organizations_url": "https://api.github.com/users/alexcrichton/orgs", "repos_url": "https://api.github.com/users/alexcrichton/repos", "events_url": "https://api.github.com/users/alexcrichton/events{/privacy}", "received_events_url": "https://api.github.com/users/alexcrichton/received_events", "type": "User", "site_admin": false}, "labels": [], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 4, "created_at": "2013-09-23T17:31:51Z", "updated_at": "2013-09-30T16:45:19Z", "closed_at": "2013-09-30T16:45:19Z", "author_association": "MEMBER", "active_lock_reason": null, "body": "Let's say you're a library author. You just published the following library file under the name `libbar`:\n\n``` rust\n// bar.rs\npub fn foo<T>() -> int {\n    static a: int = 4;  \n    return a;           \n}                       \n```\n\nSome innocent programmer then comes along and uses this file. They write the following program\n\n``` rust\n// foo.rs\nextern mod bar;       \n\nfn main() {           \n    bar::foo::<int>();\n}                    \n```\n\nBeing a responsible library developer, you then realize that your library has a security flaw, so you update it to:\n\n``` rust\n// updated bar.rs\nfn fix_the_bug() {}             \n\npub fn foo<T>() -> int {\n    static a: int = 4;  \n    return a;           \n}                       \n```\n\nYou realize that this change is ABI-compatible with your previous library version, so being a responsible library developer, you push out an updated version of your new library.\n\nAs a responsible application developer, the client using your library then updates their copy, only to result in the following terrible-ness. (this shell session assumes that I'm both the library and application developer).\n\n```\n// let's compile libbar for the first time\n$ ./x86_64-apple-darwin/stage2/bin/rustc --lib bar.rs\nwarning: missing crate link meta `name`, using `bar` as default\nwarning: missing crate link meta `vers`, using `0.0` as default\nwarning: no debug symbols in executable (-arch x86_64)\n\n// Now let's compile our application, link it against libbar, and run it\n$ ./x86_64-apple-darwin/stage2/bin/rustc foo.rs -L.\nwarning: no debug symbols in executable (-arch x86_64)\n$ ./foo\n\n// Awesome! now let's update libbar (with the bugfix), and recompile\n$ ./x86_64-apple-darwin/stage2/bin/rustc --lib bar.rs\nwarning: missing crate link meta `name`, using `bar` as default\nwarning: missing crate link meta `vers`, using `0.0` as default\nwarning: no debug symbols in executable (-arch x86_64)\n\n// The library didn't move, and it didn't change name, we shouldn't\n// have to recompile foo here.\n$ ./foo\ndyld: Symbol not found: __ZN3foo1a19hff345045bc2f6a3eaj4v0.0E\n  Referenced from: /Users/alex/code/rust3/./foo\n  Expected in: /Users/alex/code/rust3/./libbar-15fb3a718ea23983-0.0.dylib\n in /Users/alex/code/rust3/./foo\nzsh: trace trap  ./foo\n```\n\nThe reason for this is that 1da4488d8713a4190f110407470f57ddec42ec62 introduced the idea of a \"pretty name\" for statics which uses the `node_id` as the \"unique tidbit\" of information for a static in order to guarantee that they all have different names. This is very undesirable, and this should definitely be fixed.\n\nNominating for production-ready, and possibly the priority tag.\n\nAll credit for finding this goes to @cmr's eagle eyes.\n", "closed_by": {"login": "alexcrichton", "id": 64996, "node_id": "MDQ6VXNlcjY0OTk2", "avatar_url": "https://avatars.githubusercontent.com/u/64996?v=4", "gravatar_id": "", "url": "https://api.github.com/users/alexcrichton", "html_url": "https://github.com/alexcrichton", "followers_url": "https://api.github.com/users/alexcrichton/followers", "following_url": "https://api.github.com/users/alexcrichton/following{/other_user}", "gists_url": "https://api.github.com/users/alexcrichton/gists{/gist_id}", "starred_url": "https://api.github.com/users/alexcrichton/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/alexcrichton/subscriptions", "organizations_url": "https://api.github.com/users/alexcrichton/orgs", "repos_url": "https://api.github.com/users/alexcrichton/repos", "events_url": "https://api.github.com/users/alexcrichton/events{/privacy}", "received_events_url": "https://api.github.com/users/alexcrichton/received_events", "type": "User", "site_admin": false}, "reactions": {"url": "https://api.github.com/repos/rust-lang/rust/issues/9431/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rust-lang/rust/issues/9431/timeline", "performed_via_github_app": null, "state_reason": "completed"}