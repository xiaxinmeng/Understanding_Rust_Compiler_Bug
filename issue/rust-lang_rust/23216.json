{"url": "https://api.github.com/repos/rust-lang/rust/issues/23216", "repository_url": "https://api.github.com/repos/rust-lang/rust", "labels_url": "https://api.github.com/repos/rust-lang/rust/issues/23216/labels{/name}", "comments_url": "https://api.github.com/repos/rust-lang/rust/issues/23216/comments", "events_url": "https://api.github.com/repos/rust-lang/rust/issues/23216/events", "html_url": "https://github.com/rust-lang/rust/issues/23216", "id": 60324027, "node_id": "MDU6SXNzdWU2MDMyNDAyNw==", "number": 23216, "title": "rustc places an absolute address into a jump table for imported functions instead of a relative one", "user": {"login": "CtrlZvi", "id": 4283627, "node_id": "MDQ6VXNlcjQyODM2Mjc=", "avatar_url": "https://avatars.githubusercontent.com/u/4283627?v=4", "gravatar_id": "", "url": "https://api.github.com/users/CtrlZvi", "html_url": "https://github.com/CtrlZvi", "followers_url": "https://api.github.com/users/CtrlZvi/followers", "following_url": "https://api.github.com/users/CtrlZvi/following{/other_user}", "gists_url": "https://api.github.com/users/CtrlZvi/gists{/gist_id}", "starred_url": "https://api.github.com/users/CtrlZvi/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/CtrlZvi/subscriptions", "organizations_url": "https://api.github.com/users/CtrlZvi/orgs", "repos_url": "https://api.github.com/users/CtrlZvi/repos", "events_url": "https://api.github.com/users/CtrlZvi/events{/privacy}", "received_events_url": "https://api.github.com/users/CtrlZvi/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 37547, "node_id": "MDU6TGFiZWwzNzU0Nw==", "url": "https://api.github.com/repos/rust-lang/rust/labels/A-linkage", "name": "A-linkage", "color": "f7e101", "default": false, "description": "Area: linking into static, shared libraries and binaries"}, {"id": 123109, "node_id": "MDU6TGFiZWwxMjMxMDk=", "url": "https://api.github.com/repos/rust-lang/rust/labels/O-windows", "name": "O-windows", "color": "6e6ec0", "default": false, "description": "Operating system: Windows"}, {"id": 234956, "node_id": "MDU6TGFiZWwyMzQ5NTY=", "url": "https://api.github.com/repos/rust-lang/rust/labels/A-codegen", "name": "A-codegen", "color": "f7e101", "default": false, "description": "Area: Code generation"}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 10, "created_at": "2015-03-09T10:30:12Z", "updated_at": "2015-08-02T18:35:31Z", "closed_at": "2015-08-02T18:35:31Z", "author_association": "NONE", "active_lock_reason": null, "body": "This code:\n\n``` rust\n#![feature(libc, unicode)]\nextern crate libc;\nextern crate unicode;\n\n#[cfg(target_family = \"windows\")]\n#[allow(non_snake_case)]\n#[link(name = \"vccorlib\")]\nextern \"C\" {\n    #[link_name = \"?GetCmdArguments@Details@Platform@@YAPEAPEA_WPEAH@Z\"]\n    pub fn GetCmdArguments(argc : *mut libc::c_int) -> *const *const libc::wchar_t;\n}\n\n#[unstable]\npub fn get_command_arguments(argc : libc::c_int) -> (*const *const libc::wchar_t, libc::c_int) {\n    let mut argc = argc;\n    ( unsafe { GetCmdArguments(&mut argc) }, argc)\n}\n\n#[cfg(test)]\nmod tests {\n    use super::*;\n\n    #[test]\n    fn test_get_command_arguments() {\n        get_command_arguments(0);\n    }\n}\n```\n\n``` sh\nrustc minimumrepro.rs --crate-name minimumrepro --crate-type lib -g --test --emit=dep-info,link -L \"C:/Program Files (x86)/Microsoft Visual Studio 12.0/VC/lib/store/amd64\"\n```\n\nshould produce the following code (provided as a disassembly snippet):\n\n``` asm\n...\n000000000052CF18  jmp         qword ptr [6147d0h]  \n000000000052CF1E  nop  \n000000000052CF1F  nop  \n...\n```\n\nBut it instead produces the following code\n\n``` asm\n...\n000000000052CF18  jmp         qword ptr [0B416EEh]  \n000000000052CF1E  nop  \n000000000052CF1F  nop  \n...\n```\n\nThe difference is in the first entry of the jump table, which is the entry for the function explicitly mentioned in the source code. The incorrect value is caused by an absolute offset being written into the binary instead of a relative one. 0x52cf1e + 0x6147d0 = 0xb416ee.\n## Meta\n\n`rustc --version --verbose`:\nrustc 1.0.0-nightly (2fc8b1e7c 2015-03-07) (built 2015-03-08)\nbinary: rustc\ncommit-hash: 2fc8b1e7c4ca741e59b144c331d69bf189759452\ncommit-date: 2015-03-07\nbuild-date: 2015-03-08\nhost: x86_64-pc-windows-gnu\nrelease: 1.0.0-nightly\n\nBacktrace:\n\nN/A\n", "closed_by": {"login": "alexcrichton", "id": 64996, "node_id": "MDQ6VXNlcjY0OTk2", "avatar_url": "https://avatars.githubusercontent.com/u/64996?v=4", "gravatar_id": "", "url": "https://api.github.com/users/alexcrichton", "html_url": "https://github.com/alexcrichton", "followers_url": "https://api.github.com/users/alexcrichton/followers", "following_url": "https://api.github.com/users/alexcrichton/following{/other_user}", "gists_url": "https://api.github.com/users/alexcrichton/gists{/gist_id}", "starred_url": "https://api.github.com/users/alexcrichton/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/alexcrichton/subscriptions", "organizations_url": "https://api.github.com/users/alexcrichton/orgs", "repos_url": "https://api.github.com/users/alexcrichton/repos", "events_url": "https://api.github.com/users/alexcrichton/events{/privacy}", "received_events_url": "https://api.github.com/users/alexcrichton/received_events", "type": "User", "site_admin": false}, "reactions": {"url": "https://api.github.com/repos/rust-lang/rust/issues/23216/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rust-lang/rust/issues/23216/timeline", "performed_via_github_app": null, "state_reason": "completed"}