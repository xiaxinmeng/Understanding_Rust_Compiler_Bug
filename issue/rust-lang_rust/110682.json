{"url": "https://api.github.com/repos/rust-lang/rust/issues/110682", "repository_url": "https://api.github.com/repos/rust-lang/rust", "labels_url": "https://api.github.com/repos/rust-lang/rust/issues/110682/labels{/name}", "comments_url": "https://api.github.com/repos/rust-lang/rust/issues/110682/comments", "events_url": "https://api.github.com/repos/rust-lang/rust/issues/110682/events", "html_url": "https://github.com/rust-lang/rust/issues/110682", "id": 1679482287, "node_id": "I_kwDOAAsO6M5kGt2v", "number": 110682, "title": "ICE: Failed to normalize, maybe try to call `try_normalize_erasing_regions` instead", "user": {"login": "12101111", "id": 8438475, "node_id": "MDQ6VXNlcjg0Mzg0NzU=", "avatar_url": "https://avatars.githubusercontent.com/u/8438475?v=4", "gravatar_id": "", "url": "https://api.github.com/users/12101111", "html_url": "https://github.com/12101111", "followers_url": "https://api.github.com/users/12101111/followers", "following_url": "https://api.github.com/users/12101111/following{/other_user}", "gists_url": "https://api.github.com/users/12101111/gists{/gist_id}", "starred_url": "https://api.github.com/users/12101111/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/12101111/subscriptions", "organizations_url": "https://api.github.com/users/12101111/orgs", "repos_url": "https://api.github.com/users/12101111/repos", "events_url": "https://api.github.com/users/12101111/events{/privacy}", "received_events_url": "https://api.github.com/users/12101111/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 9618520, "node_id": "MDU6TGFiZWw5NjE4NTIw", "url": "https://api.github.com/repos/rust-lang/rust/labels/I-ICE", "name": "I-ICE", "color": "e10c02", "default": false, "description": "Issue: The compiler panicked, giving an Internal Compilation Error (ICE) \u2744\ufe0f"}, {"id": 211668100, "node_id": "MDU6TGFiZWwyMTE2NjgxMDA=", "url": "https://api.github.com/repos/rust-lang/rust/labels/T-compiler", "name": "T-compiler", "color": "bfd4f2", "default": false, "description": "Relevant to the compiler team, which will review and decide on the PR/issue."}, {"id": 650731663, "node_id": "MDU6TGFiZWw2NTA3MzE2NjM=", "url": "https://api.github.com/repos/rust-lang/rust/labels/C-bug", "name": "C-bug", "color": "f5f1fd", "default": false, "description": "Category: This is a bug."}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 13, "created_at": "2023-04-22T11:08:13Z", "updated_at": "2023-05-17T18:06:39Z", "closed_at": "2023-05-17T18:06:39Z", "author_association": "CONTRIBUTOR", "active_lock_reason": null, "body": "### Code\r\n\r\nI found this ICE while compiling `bitvec 0.19.6` in release mode.\r\n\r\nhttps://github.com/ferrilab/bitvec/tree/v0/19/6\r\n\r\n\r\n### Meta\r\n\r\n`rustc --version --verbose`:\r\n```\r\nrustc 1.71.0-nightly (fec9adcdb 2023-04-21)\r\nbinary: rustc\r\ncommit-hash: fec9adcdbc21469ef105162cc8cabf81c72d06be\r\ncommit-date: 2023-04-21\r\nhost: aarch64-apple-darwin\r\nrelease: 1.71.0-nightly\r\nLLVM version: 16.0.2\r\n```\r\n\r\n### Error output\r\n\r\n```\r\nerror: internal compiler error: compiler/rustc_middle/src/ty/normalize_erasing_regions.rs:195:90: Failed to normalize alloc::raw_vec::RawVec<<T as store::BitStore>::Mem>, maybe try to call `try_normalize_erasing_regions` instead\r\n\r\nthread 'rustc' panicked at 'Box<dyn Any>', /rustc/fec9adcdbc21469ef105162cc8cabf81c72d06be/compiler/rustc_errors/src/lib.rs:1643:9\r\n\r\nnote: we would appreciate a bug report: https://github.com/rust-lang/rust/issues/new?labels=C-bug%2C+I-ICE%2C+T-compiler&template=ice.md\r\n\r\nnote: rustc 1.71.0-nightly (fec9adcdb 2023-04-21) running on aarch64-apple-darwin\r\n\r\nnote: compiler flags: --crate-type lib -C opt-level=3 -C embed-bitcode=no -C target-cpu=apple-m1\r\n\r\nnote: some of the compiler flags provided by cargo are hidden\r\n\r\nquery stack during panic:\r\n#0 [mir_shims] generating MIR shim for `core::ptr::drop_in_place`\r\n#1 [optimized_mir] optimizing MIR for `vec::ops::<impl at src/vec/ops.rs:141:1: 141:33>::drop::{closure#0}`\r\nend of query stack\r\n```\r\n\r\n<details><summary><strong>Backtrace</strong></summary>\r\n<p>\r\n\r\n```\r\nstack backtrace:\r\n   0:        0x104a90738 - <std::sys_common::backtrace::_print::DisplayBacktrace as core::fmt::Display>::fmt::ha9e6c436959f1b8e\r\n   1:        0x104ae075c - core::fmt::write::h03620c265cda50c9\r\n   2:        0x104a86658 - std::io::Write::write_fmt::h4582733544e760df\r\n   3:        0x104a90598 - std::sys_common::backtrace::print::h52cbdd72190599ef\r\n   4:        0x104a92f38 - std::panicking::default_hook::{{closure}}::hbd7990be14834316\r\n   5:        0x104a92d3c - std::panicking::default_hook::hefa394ac64f6527f\r\n   6:        0x10cfb5b58 - rustc_driver_impl[9431cfa2328e8da]::DEFAULT_HOOK::{closure#0}::{closure#0}\r\n   7:        0x104a9352c - std::panicking::rust_panic_with_hook::h7504e9066f7b4f07\r\n   8:        0x110d6c2e8 - std[614eb408c5fa570d]::panicking::begin_panic::<rustc_errors[c2a69e08fcd2e8bf]::ExplicitBug>::{closure#0}\r\n   9:        0x110d69db0 - std[614eb408c5fa570d]::sys_common::backtrace::__rust_end_short_backtrace::<std[614eb408c5fa570d]::panicking::begin_panic<rustc_errors[c2a69e08fcd2e8bf]::ExplicitBug>::{closure#0}, !>\r\n  10:        0x1113a1b44 - std[614eb408c5fa570d]::panicking::begin_panic::<rustc_errors[c2a69e08fcd2e8bf]::ExplicitBug>\r\n  11:        0x110e2b5ac - <rustc_errors[c2a69e08fcd2e8bf]::HandlerInner>::bug::<&alloc[8ca104b1f3df9592]::string::String>\r\n  12:        0x110e2b270 - <rustc_errors[c2a69e08fcd2e8bf]::Handler>::bug::<&alloc[8ca104b1f3df9592]::string::String>\r\n  13:        0x110dd1124 - rustc_middle[662f54c0a25f7c56]::util::bug::opt_span_bug_fmt::<rustc_span[7733720cb78d73dd]::span_encoding::Span>::{closure#0}\r\n  14:        0x110dd0b34 - rustc_middle[662f54c0a25f7c56]::ty::context::tls::with_opt::<rustc_middle[662f54c0a25f7c56]::util::bug::opt_span_bug_fmt<rustc_span[7733720cb78d73dd]::span_encoding::Span>::{closure#0}, !>::{closure#0}\r\n  15:        0x110dd0b00 - rustc_middle[662f54c0a25f7c56]::ty::context::tls::with_context_opt::<rustc_middle[662f54c0a25f7c56]::ty::context::tls::with_opt<rustc_middle[662f54c0a25f7c56]::util::bug::opt_span_bug_fmt<rustc_span[7733720cb78d73dd]::span_encoding::Span>::{closure#0}, !>::{closure#0}, !>\r\n  16:        0x1113a18ac - rustc_middle[662f54c0a25f7c56]::util::bug::bug_fmt\r\n  17:        0x110dcdea8 - <rustc_middle[662f54c0a25f7c56]::ty::normalize_erasing_regions::NormalizeAfterErasingRegionsFolder>::normalize_generic_arg_after_erasing_regions\r\n  18:        0x110dcdee4 - <rustc_middle[662f54c0a25f7c56]::ty::normalize_erasing_regions::NormalizeAfterErasingRegionsFolder as rustc_type_ir[50bb8a969b2c53c]::fold::TypeFolder<rustc_middle[662f54c0a25f7c56]::ty::context::TyCtxt>>::fold_ty\r\n  19:        0x10f6d33cc - <core[dc40836e4f3e0da7]::iter::adapters::map::Map<core[dc40836e4f3e0da7]::iter::adapters::enumerate::Enumerate<core[dc40836e4f3e0da7]::slice::iter::Iter<rustc_middle[662f54c0a25f7c56]::ty::FieldDef>>, <rustc_mir_dataflow[2ace872dcdcb608a]::elaborate_drops::DropCtxt<rustc_mir_transform[c661f0a31a836e75]::shim::DropShimElaborator>>::move_paths_for_fields::{closure#0}> as core[dc40836e4f3e0da7]::iter::traits::iterator::Iterator>::fold::<(), core[dc40836e4f3e0da7]::iter::traits::iterator::Iterator::for_each::call<(rustc_middle[662f54c0a25f7c56]::mir::syntax::Place, core[dc40836e4f3e0da7]::option::Option<()>), <alloc[8ca104b1f3df9592]::vec::Vec<(rustc_middle[662f54c0a25f7c56]::mir::syntax::Place, core[dc40836e4f3e0da7]::option::Option<()>)>>::extend_trusted<core[dc40836e4f3e0da7]::iter::adapters::map::Map<core[dc40836e4f3e0da7]::iter::adapters::enumerate::Enumerate<core[dc40836e4f3e0da7]::slice::iter::Iter<rustc_middle[662f54c0a25f7c56]::ty::FieldDef>>, <rustc_mir_dataflow[2ace872dcdcb608a]::elaborate_drops::DropCtxt<rustc_mir_transform[c661f0a31a836e75]::shim::DropShimElaborator>>::move_paths_for_fields::{closure#0}>>::{closure#0}>::{closure#0}>\r\n  20:        0x10f7e0f04 - <alloc[8ca104b1f3df9592]::vec::Vec<(rustc_middle[662f54c0a25f7c56]::mir::syntax::Place, core[dc40836e4f3e0da7]::option::Option<()>)> as alloc[8ca104b1f3df9592]::vec::spec_from_iter::SpecFromIter<(rustc_middle[662f54c0a25f7c56]::mir::syntax::Place, core[dc40836e4f3e0da7]::option::Option<()>), core[dc40836e4f3e0da7]::iter::adapters::map::Map<core[dc40836e4f3e0da7]::iter::adapters::enumerate::Enumerate<core[dc40836e4f3e0da7]::slice::iter::Iter<rustc_middle[662f54c0a25f7c56]::ty::FieldDef>>, <rustc_mir_dataflow[2ace872dcdcb608a]::elaborate_drops::DropCtxt<rustc_mir_transform[c661f0a31a836e75]::shim::DropShimElaborator>>::move_paths_for_fields::{closure#0}>>>::from_iter\r\n  21:        0x10f6de998 - <rustc_mir_dataflow[2ace872dcdcb608a]::elaborate_drops::DropCtxt<rustc_mir_transform[c661f0a31a836e75]::shim::DropShimElaborator>>::open_drop_for_adt\r\n  22:        0x10f6de2e8 - <rustc_mir_dataflow[2ace872dcdcb608a]::elaborate_drops::DropCtxt<rustc_mir_transform[c661f0a31a836e75]::shim::DropShimElaborator>>::elaborate_drop\r\n  23:        0x10f800090 - rustc_mir_transform[c661f0a31a836e75]::shim::make_shim\r\n  24:        0x11027591c - <std[614eb408c5fa570d]::thread::local::LocalKey<core[dc40836e4f3e0da7]::cell::Cell<*const ()>>>::with::<rustc_middle[662f54c0a25f7c56]::ty::context::tls::enter_context<rustc_query_system[2ed44d2bc999b7a]::query::plumbing::execute_job_non_incr<rustc_query_impl[eba986b151bf483e]::queries::mir_shims, rustc_query_impl[eba986b151bf483e]::plumbing::QueryCtxt>::{closure#0}, rustc_middle[662f54c0a25f7c56]::query::erase::Erased<[u8; 8usize]>>::{closure#0}, rustc_middle[662f54c0a25f7c56]::query::erase::Erased<[u8; 8usize]>>\r\n  25:        0x11014ccd0 - rustc_query_system[2ed44d2bc999b7a]::query::plumbing::try_execute_query::<rustc_query_impl[eba986b151bf483e]::queries::mir_shims, rustc_query_impl[eba986b151bf483e]::plumbing::QueryCtxt>\r\n  26:        0x110347614 - <rustc_query_impl[eba986b151bf483e]::Queries as rustc_middle[662f54c0a25f7c56]::ty::query::QueryEngine>::mir_shims\r\n  27:        0x110eba434 - <rustc_middle[662f54c0a25f7c56]::ty::context::TyCtxt>::instance_mir\r\n  28:        0x10f7cb2c4 - <rustc_mir_transform[c661f0a31a836e75]::inline::Inliner>::try_inlining\r\n  29:        0x10f7cac2c - <rustc_mir_transform[c661f0a31a836e75]::inline::Inliner>::process_blocks\r\n  30:        0x10f7cad14 - <rustc_mir_transform[c661f0a31a836e75]::inline::Inliner>::process_blocks\r\n  31:        0x10f7ca6f0 - <rustc_mir_transform[c661f0a31a836e75]::inline::Inline as rustc_middle[662f54c0a25f7c56]::mir::MirPass>::run_pass\r\n  32:        0x10f7c3dd0 - rustc_mir_transform[c661f0a31a836e75]::pass_manager::run_passes_inner\r\n  33:        0x10f6f15a8 - rustc_mir_transform[c661f0a31a836e75]::optimized_mir\r\n  34:        0x1100dd060 - rustc_query_system[2ed44d2bc999b7a]::query::plumbing::try_execute_query::<rustc_query_impl[eba986b151bf483e]::queries::optimized_mir, rustc_query_impl[eba986b151bf483e]::plumbing::QueryCtxt>\r\n  35:        0x11033e7b8 - <rustc_query_impl[eba986b151bf483e]::Queries as rustc_middle[662f54c0a25f7c56]::ty::query::QueryEngine>::optimized_mir\r\n  36:        0x1106e1654 - <rustc_metadata[f2a84a8141f6c436]::rmeta::encoder::EncodeContext>::encode_crate_root\r\n  37:        0x1106eeb08 - rustc_metadata[f2a84a8141f6c436]::rmeta::encoder::encode_metadata_impl\r\n  38:        0x110695d88 - rustc_data_structures[240cd432e77d6b7b]::sync::join::<rustc_metadata[f2a84a8141f6c436]::rmeta::encoder::encode_metadata::{closure#0}, rustc_metadata[f2a84a8141f6c436]::rmeta::encoder::encode_metadata::{closure#1}, (), ()>\r\n  39:        0x1106ee348 - rustc_metadata[f2a84a8141f6c436]::rmeta::encoder::encode_metadata\r\n  40:        0x11068928c - rustc_metadata[f2a84a8141f6c436]::fs::encode_and_write_metadata\r\n  41:        0x10d066d9c - rustc_interface[5a3a908aa1aef180]::passes::start_codegen\r\n  42:        0x10d052850 - <rustc_middle[662f54c0a25f7c56]::ty::context::GlobalCtxt>::enter::<<rustc_interface[5a3a908aa1aef180]::queries::Queries>::ongoing_codegen::{closure#0}::{closure#0}, core[dc40836e4f3e0da7]::result::Result<alloc[8ca104b1f3df9592]::boxed::Box<dyn core[dc40836e4f3e0da7]::any::Any>, rustc_span[7733720cb78d73dd]::ErrorGuaranteed>>\r\n  43:        0x10d01ea18 - <rustc_interface[5a3a908aa1aef180]::queries::Queries>::ongoing_codegen\r\n  44:        0x10cf8ec74 - <rustc_interface[5a3a908aa1aef180]::interface::Compiler>::enter::<rustc_driver_impl[9431cfa2328e8da]::run_compiler::{closure#1}::{closure#2}, core[dc40836e4f3e0da7]::result::Result<core[dc40836e4f3e0da7]::option::Option<rustc_interface[5a3a908aa1aef180]::queries::Linker>, rustc_span[7733720cb78d73dd]::ErrorGuaranteed>>\r\n  45:        0x10cf52ca4 - rustc_span[7733720cb78d73dd]::set_source_map::<core[dc40836e4f3e0da7]::result::Result<(), rustc_span[7733720cb78d73dd]::ErrorGuaranteed>, rustc_interface[5a3a908aa1aef180]::interface::run_compiler<core[dc40836e4f3e0da7]::result::Result<(), rustc_span[7733720cb78d73dd]::ErrorGuaranteed>, rustc_driver_impl[9431cfa2328e8da]::run_compiler::{closure#1}>::{closure#0}::{closure#0}>\r\n  46:        0x10cf58250 - <scoped_tls[4e67b4d1df739e32]::ScopedKey<rustc_span[7733720cb78d73dd]::SessionGlobals>>::set::<rustc_interface[5a3a908aa1aef180]::interface::run_compiler<core[dc40836e4f3e0da7]::result::Result<(), rustc_span[7733720cb78d73dd]::ErrorGuaranteed>, rustc_driver_impl[9431cfa2328e8da]::run_compiler::{closure#1}>::{closure#0}, core[dc40836e4f3e0da7]::result::Result<(), rustc_span[7733720cb78d73dd]::ErrorGuaranteed>>\r\n  47:        0x10cf49a1c - std[614eb408c5fa570d]::sys_common::backtrace::__rust_begin_short_backtrace::<rustc_interface[5a3a908aa1aef180]::util::run_in_thread_pool_with_globals<rustc_interface[5a3a908aa1aef180]::interface::run_compiler<core[dc40836e4f3e0da7]::result::Result<(), rustc_span[7733720cb78d73dd]::ErrorGuaranteed>, rustc_driver_impl[9431cfa2328e8da]::run_compiler::{closure#1}>::{closure#0}, core[dc40836e4f3e0da7]::result::Result<(), rustc_span[7733720cb78d73dd]::ErrorGuaranteed>>::{closure#0}::{closure#0}, core[dc40836e4f3e0da7]::result::Result<(), rustc_span[7733720cb78d73dd]::ErrorGuaranteed>>\r\n  48:        0x10cf5d42c - <<std[614eb408c5fa570d]::thread::Builder>::spawn_unchecked_<rustc_interface[5a3a908aa1aef180]::util::run_in_thread_pool_with_globals<rustc_interface[5a3a908aa1aef180]::interface::run_compiler<core[dc40836e4f3e0da7]::result::Result<(), rustc_span[7733720cb78d73dd]::ErrorGuaranteed>, rustc_driver_impl[9431cfa2328e8da]::run_compiler::{closure#1}>::{closure#0}, core[dc40836e4f3e0da7]::result::Result<(), rustc_span[7733720cb78d73dd]::ErrorGuaranteed>>::{closure#0}::{closure#0}, core[dc40836e4f3e0da7]::result::Result<(), rustc_span[7733720cb78d73dd]::ErrorGuaranteed>>::{closure#1} as core[dc40836e4f3e0da7]::ops::function::FnOnce<()>>::call_once::{shim:vtable#0}\r\n  49:        0x104a9bcd0 - std::sys::unix::thread::Thread::new::thread_start::h02c2263b1a3b4fc6\r\n  50:        0x19840bfa8 - __pthread_joiner_wake\r\n```\r\n\r\n</p>\r\n</details>\r\n\r\nbisect command: \r\n\r\n```\r\ncargo bisect-rustc --start 2023-04-17 --end 2023-04-18 --without-cargo -- build --release\r\n```\r\n\r\nbisect result: https://github.com/rust-lang/rust/pull/109247\r\n\r\n********************************************************************************\r\nRegression in 5546cb64f6fbba70529582bbe58a40ba4a8ed9fc\r\n********************************************************************************\r\n", "closed_by": {"login": "bors", "id": 3372342, "node_id": "MDQ6VXNlcjMzNzIzNDI=", "avatar_url": "https://avatars.githubusercontent.com/u/3372342?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors", "html_url": "https://github.com/bors", "followers_url": "https://api.github.com/users/bors/followers", "following_url": "https://api.github.com/users/bors/following{/other_user}", "gists_url": "https://api.github.com/users/bors/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors/subscriptions", "organizations_url": "https://api.github.com/users/bors/orgs", "repos_url": "https://api.github.com/users/bors/repos", "events_url": "https://api.github.com/users/bors/events{/privacy}", "received_events_url": "https://api.github.com/users/bors/received_events", "type": "User", "site_admin": false}, "reactions": {"url": "https://api.github.com/repos/rust-lang/rust/issues/110682/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rust-lang/rust/issues/110682/timeline", "performed_via_github_app": null, "state_reason": "completed"}