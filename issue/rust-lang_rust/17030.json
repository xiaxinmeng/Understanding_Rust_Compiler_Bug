{"url": "https://api.github.com/repos/rust-lang/rust/issues/17030", "repository_url": "https://api.github.com/repos/rust-lang/rust", "labels_url": "https://api.github.com/repos/rust-lang/rust/issues/17030/labels{/name}", "comments_url": "https://api.github.com/repos/rust-lang/rust/issues/17030/comments", "events_url": "https://api.github.com/repos/rust-lang/rust/issues/17030/events", "html_url": "https://github.com/rust-lang/rust/issues/17030", "id": 42088654, "node_id": "MDU6SXNzdWU0MjA4ODY1NA==", "number": 17030, "title": "ICE: no type for node 30: local ref __self_0_0 (id=30)", "user": {"login": "JeffBelgum", "id": 4001770, "node_id": "MDQ6VXNlcjQwMDE3NzA=", "avatar_url": "https://avatars.githubusercontent.com/u/4001770?v=4", "gravatar_id": "", "url": "https://api.github.com/users/JeffBelgum", "html_url": "https://github.com/JeffBelgum", "followers_url": "https://api.github.com/users/JeffBelgum/followers", "following_url": "https://api.github.com/users/JeffBelgum/following{/other_user}", "gists_url": "https://api.github.com/users/JeffBelgum/gists{/gist_id}", "starred_url": "https://api.github.com/users/JeffBelgum/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/JeffBelgum/subscriptions", "organizations_url": "https://api.github.com/users/JeffBelgum/orgs", "repos_url": "https://api.github.com/users/JeffBelgum/repos", "events_url": "https://api.github.com/users/JeffBelgum/events{/privacy}", "received_events_url": "https://api.github.com/users/JeffBelgum/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 9618520, "node_id": "MDU6TGFiZWw5NjE4NTIw", "url": "https://api.github.com/repos/rust-lang/rust/labels/I-ICE", "name": "I-ICE", "color": "e10c02", "default": false, "description": "Issue: The compiler panicked, giving an Internal Compilation Error (ICE) \u2744\ufe0f"}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 1, "created_at": "2014-09-05T20:49:58Z", "updated_at": "2014-09-21T21:10:44Z", "closed_at": "2014-09-21T21:10:44Z", "author_association": "CONTRIBUTOR", "active_lock_reason": null, "body": "Trying to compile:\n\n``` rust\n#[deriving(Show)]\nstruct A { b: int }\nimpl A {}\nenum A {}\n```\n\nLeads to the following compiler error:\n\n``` ignore\nbug.rs:1:12: 1:16 error: mismatched types: expected `A`, found `A` [E0028]\nbug.rs:1 #[deriving(Show)]\n                    ^~~~\nnote: in expansion of #[deriving]\nbug.rs:1:1: 1:18 note: expansion site\nbug.rs:2:12: 2:18 error: the type of this value must be known in this context\nbug.rs:2 struct A { b: int }\n                    ^~~~~~\nnote: in expansion of #[deriving]\nbug.rs:1:1: 1:18 note: expansion site\nbug.rs:2:12: 2:18 error: cannot determine a type for this bounded type parameter: unconstrained type\nbug.rs:2 struct A { b: int }\n                    ^~~~~~\nnote: in expansion of #[deriving]\nbug.rs:1:1: 1:18 note: expansion site\nerror: internal compiler error: no type for node 30: local ref __self_0_0 (id=30) in fcx 0x10c5aaf90\nnote: the compiler hit an unexpected failure path. this is a bug.\nnote: we would appreciate a bug report: http://doc.rust-lang.org/complement-bugreport.html\nnote: run with `RUST_BACKTRACE=1` for a backtrace\ntask 'rustc' failed at 'Box<Any>', /Users/rustbuild/src/rust-buildbot/slave/nightly-mac/build/src/libsyntax/ast_util.rs:776\n```\n\nAnd the following stack backtrace\n\n``` ignore\nstack backtrace:\n   1:        0x10b0f1fd5 - rt::backtrace::imp::write::h8a16f0d6cc468cc2WUq\n   2:        0x10b0f5311 - failure::on_fail::h73f7991e2e18ff1aQbr\n   3:        0x10b3939a5 - unwind::begin_unwind_inner::h7563dbccbae0d69fb0d\n   4:        0x10a849f2a - unwind::begin_unwind::h15457849011356628111\n   5:        0x10a84a743 - diagnostic::Handler::bug::h1b12eda712d730dfufF\n   6:        0x107be5ed8 - driver::session::Session::bug::he94b475aa8c9efbbuKC\n   7:        0x1080e2b95 - middle::typeck::check::FnCtxt<'a>::node_ty::he1db56b2f6e38765UUW\n   8:        0x108106fc9 - middle::typeck::check::writeback::WritebackCx<'cx>::visit_node_id::h69cc4fac9776bb0f91N\n   9:        0x1081054ac - middle::typeck::check::writeback::WritebackCx<'cx>.Visitor<(*>::visit_pat::h52b3b9becfa5d6f9YSN\n  10:        0x1081056df - middle::typeck::check::writeback::WritebackCx<'cx>.Visitor<(*>::visit_pat::h52b3b9becfa5d6f9YSN\n  11:        0x10810c053 - visit::walk_arm::h9826119459230672094\n  12:        0x108103d43 - middle::typeck::check::writeback::WritebackCx<'cx>.Visitor<(*>::visit_expr::h46ccff77a586708aJQN\n  13:        0x10810c5b1 - visit::walk_block::h15035022899041750626\n  14:        0x108105247 - middle::typeck::check::writeback::resolve_type_vars_in_fn::h6470a04ae2a7f182QKN\n  15:        0x108159acb - middle::typeck::check::check_bare_fn::h3dc52015b58422b13HU\n  16:        0x108164456 - middle::typeck::check::check_method_body::h9cbff2c23b51dab6lzV\n  17:        0x108152b96 - middle::typeck::check::check_item::h18b70d8bf39d6f29MnV\n  18:        0x10815987d - middle::typeck::check::check_item_types::h1e56caee9458b8b62GU\n  19:        0x107bd3446 - util::common::time::h17392792334583830769\n  20:        0x10836bd0c - middle::typeck::check_crate::h4730e89ab2202064sjn\n  21:        0x108429a25 - driver::driver::phase_3_run_analysis_passes::h5ba3dde5cec5fc2dp1B\n  22:        0x108424c2c - driver::driver::compile_input::h05a21904a92e1503cNB\n  23:        0x1084b1bda - driver::run_compiler::hed4b6336d7803791CCF\n  24:        0x1084afe56 - driver::main_args::closure.141533\n  25:        0x1084c280b - task::TaskBuilder<S>::try_future::closure.142702\n  26:        0x1084c2713 - task::TaskBuilder<S>::spawn_internal::closure.142679\n  27:        0x107b8952c - task::spawn_opts::closure.8480\n  28:        0x10b3f5d2c - rust_try_inner\n  29:        0x10b3f5d16 - rust_try\n  30:        0x10b390ea7 - unwind::try::h5c767661da0124aclOd\n  31:        0x10b390d1c - task::Task::run::hbb8d1805a446205eL0c\n  32:        0x107b89372 - task::spawn_opts::closure.8425\n  33:        0x10b3928e6 - thread::thread_start::h7a1f59f7cbfcd0f2Sld\n  34:     0x7fff95565899 - _pthread_body\n  35:     0x7fff9556572a - _pthread_struct_init\n```\n\nI've stripped it down to the smallest example I can. The order and types of everything (except the struct's inner value and the trait to be derived) seems to matter.\n\nI've triggered the bug with rustc 0.12.0-pre-nightly (d59d97cbe 2014-09-04 01:11:04 +0000) on Mac OS X 10.9.4 and play.rust-lang.org on master, but not play.rust-lang.org on v0.11.0 or v0.10.0\n", "closed_by": {"login": "alexcrichton", "id": 64996, "node_id": "MDQ6VXNlcjY0OTk2", "avatar_url": "https://avatars.githubusercontent.com/u/64996?v=4", "gravatar_id": "", "url": "https://api.github.com/users/alexcrichton", "html_url": "https://github.com/alexcrichton", "followers_url": "https://api.github.com/users/alexcrichton/followers", "following_url": "https://api.github.com/users/alexcrichton/following{/other_user}", "gists_url": "https://api.github.com/users/alexcrichton/gists{/gist_id}", "starred_url": "https://api.github.com/users/alexcrichton/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/alexcrichton/subscriptions", "organizations_url": "https://api.github.com/users/alexcrichton/orgs", "repos_url": "https://api.github.com/users/alexcrichton/repos", "events_url": "https://api.github.com/users/alexcrichton/events{/privacy}", "received_events_url": "https://api.github.com/users/alexcrichton/received_events", "type": "User", "site_admin": false}, "reactions": {"url": "https://api.github.com/repos/rust-lang/rust/issues/17030/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rust-lang/rust/issues/17030/timeline", "performed_via_github_app": null, "state_reason": "completed"}