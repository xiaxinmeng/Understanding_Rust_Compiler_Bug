{"url": "https://api.github.com/repos/rust-lang/rust/issues/36701", "repository_url": "https://api.github.com/repos/rust-lang/rust", "labels_url": "https://api.github.com/repos/rust-lang/rust/issues/36701/labels{/name}", "comments_url": "https://api.github.com/repos/rust-lang/rust/issues/36701/comments", "events_url": "https://api.github.com/repos/rust-lang/rust/issues/36701/events", "html_url": "https://github.com/rust-lang/rust/issues/36701", "id": 179047928, "node_id": "MDU6SXNzdWUxNzkwNDc5Mjg=", "number": 36701, "title": "ICE, &mut nickel::Request was subtype but now is not", "user": {"login": "snargleplax", "id": 1844644, "node_id": "MDQ6VXNlcjE4NDQ2NDQ=", "avatar_url": "https://avatars.githubusercontent.com/u/1844644?v=4", "gravatar_id": "", "url": "https://api.github.com/users/snargleplax", "html_url": "https://github.com/snargleplax", "followers_url": "https://api.github.com/users/snargleplax/followers", "following_url": "https://api.github.com/users/snargleplax/following{/other_user}", "gists_url": "https://api.github.com/users/snargleplax/gists{/gist_id}", "starred_url": "https://api.github.com/users/snargleplax/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/snargleplax/subscriptions", "organizations_url": "https://api.github.com/users/snargleplax/orgs", "repos_url": "https://api.github.com/users/snargleplax/repos", "events_url": "https://api.github.com/users/snargleplax/events{/privacy}", "received_events_url": "https://api.github.com/users/snargleplax/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 9618520, "node_id": "MDU6TGFiZWw5NjE4NTIw", "url": "https://api.github.com/repos/rust-lang/rust/labels/I-ICE", "name": "I-ICE", "color": "e10c02", "default": false, "description": "Issue: The compiler panicked, giving an Internal Compilation Error (ICE) \u2744\ufe0f"}, {"id": 650731663, "node_id": "MDU6TGFiZWw2NTA3MzE2NjM=", "url": "https://api.github.com/repos/rust-lang/rust/labels/C-bug", "name": "C-bug", "color": "f5f1fd", "default": false, "description": "Category: This is a bug."}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 1, "created_at": "2016-09-24T19:38:20Z", "updated_at": "2017-11-13T20:15:00Z", "closed_at": "2017-11-13T20:15:00Z", "author_association": "NONE", "active_lock_reason": null, "body": "I'm getting an internal compiler error with this code.  \n\nMy repro involves a couple of other packages; here's the `Cargo.toml`:\n\n```\n[package]\nname = \"compiler-bug-repro\"\nversion = \"0.0.1\"\nauthors = [ \"Luke Meyers <n.luke.meyers@gmail.com>\" ]\n\n[dependencies]\nnickel = \"*\"\nplugin=\"*\"\ntypemap = \"*\"\n```\n\nAnd here's `main.rs`:\n\n```\nextern crate nickel;\nextern crate plugin;\nextern crate typemap;\n\nuse nickel::Request;\nuse plugin::{Plugin, Pluggable};\n\nstruct FooPlugin;\n\nimpl typemap::Key for FooPlugin {\n    type Value = u32;\n}\n\nimpl<'a, 'b> Plugin<Request<'a, 'b>> for FooPlugin {\n    type Error = ();\n    fn eval(request: &mut Request) -> Result<u32, ()> { Result::Err(()) }\n}\n\nfn foo<'a, 'b, D>(bar: &Request<'a, 'b, D>) {\n    bar.get::<FooPlugin>()\n}\n\nfn main() {}\n```\n\nI don't claim the code should compile cleanly (I encountered the bug originally when fiddling around with generic params I didn't fully understand), but I get a compiler panic.  Here's the output from `cargo run --verbose`:\n\n```\ncargo run --verbose\n       Fresh rustc-serialize v0.3.19\n       Fresh language-tags v0.2.2\n       Fresh libc v0.2.16\n       Fresh matches v0.1.2\n       Fresh winapi-build v0.1.1\n       Fresh unicode-normalization v0.1.2\n       Fresh groupable v0.2.0\n       Fresh log v0.3.6\n       Fresh traitobject v0.0.3\n       Fresh winapi v0.2.8\n       Fresh unicode-bidi v0.2.3\n       Fresh num_cpus v0.2.13\n       Fresh memchr v0.1.11\n       Fresh semver v0.1.20\n       Fresh mime v0.2.2\n       Fresh unsafe-any v0.4.1\n       Fresh utf8-ranges v0.1.3\n       Fresh idna v0.1.0\n       Fresh lazy_static v0.1.16\n       Fresh aho-corasick v0.5.3\n       Fresh regex-syntax v0.3.5\n       Fresh typeable v0.1.2\n       Fresh mustache v0.6.3\n       Fresh typemap v0.3.3\n       Fresh modifier v0.1.0\n       Fresh url v1.2.0\n       Fresh traitobject v0.0.1\n       Fresh hpack v0.2.0\n       Fresh httparse v1.1.2\n       Fresh rustc_version v0.1.7\n       Fresh plugin v0.2.6\n       Fresh solicit v0.4.4\n       Fresh kernel32-sys v0.2.2\n       Fresh thread-id v2.0.0\n       Fresh time v0.1.35\n       Fresh unicase v1.4.0\n       Fresh thread_local v0.2.6\n       Fresh cookie v0.2.5\n       Fresh regex v0.1.77\n       Fresh hyper v0.9.10\n       Fresh nickel v0.9.0\n   Compiling compiler-bug-repro v0.0.1 (file:///Users/luke/rust/workshop)\n     Running `rustc src/main.rs --crate-name compiler_bug_repro --crate-type bin -g -C metadata=041422aad2109b65 --out-dir /Users/luke/rust/workshop/target/debug --emit=dep-info,link -L dependency=/Users/luke/rust/workshop/target/debug/deps --extern nickel=/Users/luke/rust/workshop/target/debug/deps/libnickel-c8a48e533ebfcad5.rlib --extern plugin=/Users/luke/rust/workshop/target/debug/deps/libplugin-a6cf157fb041a4c2.rlib --extern typemap=/Users/luke/rust/workshop/target/debug/deps/libtypemap-deddc09802823f24.rlib`\nerror: internal compiler error: ../src/librustc_typeck/check/method/confirm.rs:361: &mut nickel::Request<'a, 'b, D> was a subtype of &mut nickel::Request<'_, '_, _> but now is not?\n  --> src/main.rs:20:9\n   |\n20 |     bar.get::<FooPlugin>()\n   |         ^^^\n\nnote: the compiler unexpectedly panicked. this is a bug.\n\nnote: we would appreciate a bug report: https://github.com/rust-lang/rust/blob/master/CONTRIBUTING.md#bug-reports\n\nthread 'rustc' panicked at 'Box<Any>', ../src/librustc_errors/lib.rs:590\nnote: Run with `RUST_BACKTRACE=1` for a backtrace.\n\nerror: Could not compile `compiler-bug-repro`.\n\nCaused by:\n  Process didn't exit successfully: `rustc src/main.rs --crate-name compiler_bug_repro --crate-type bin -g -C metadata=041422aad2109b65 --out-dir /Users/luke/rust/workshop/target/debug --emit=dep-info,link -L dependency=/Users/luke/rust/workshop/target/debug/deps --extern nickel=/Users/luke/rust/workshop/target/debug/deps/libnickel-c8a48e533ebfcad5.rlib --extern plugin=/Users/luke/rust/workshop/target/debug/deps/libplugin-a6cf157fb041a4c2.rlib --extern typemap=/Users/luke/rust/workshop/target/debug/deps/libtypemap-deddc09802823f24.rlib` (exit code: 101)\n```\n## Meta\n\n`rustc version --verbose`:\n\n```\nrustc 1.13.0-nightly (6ffdda1ba 2016-09-14)\nbinary: rustc\ncommit-hash: 6ffdda1ba183c981d57e63b59c88184be449eee4\ncommit-date: 2016-09-14\nhost: x86_64-apple-darwin\nrelease: 1.13.0-nightly\n```\n\nBacktrace:\n\n```\n   1:        0x11231723a - std::sys::backtrace::tracing::imp::write::h4b09e6e8c01db097\n   2:        0x11232594f - std::panicking::default_hook::{{closure}}::h1d3243f546573ff4\n   3:        0x112323fed - std::panicking::default_hook::h96c288d728df3ebf\n   4:        0x112324686 - std::panicking::rust_panic_with_hook::hb1322e5f2588b4db\n   5:        0x10e91fffb - std::panicking::begin_panic::hb7c71bbc491f561c\n   6:        0x10ea515d3 - rustc::session::opt_span_bug_fmt::{{closure}}::h6ad7caa20ac20c4b\n   7:        0x10e966279 - rustc::session::span_bug_fmt::heb3fdb6acac8d0c7\n   8:        0x10e9a9e6c - rustc_typeck::check::method::confirm::ConfirmContext::confirm::h6184703963035442\n   9:        0x10e9b7b03 - rustc_typeck::check::method::<impl rustc_typeck::check::FnCtxt<'a, 'gcx, 'tcx>>::lookup_method::hf46acac3437c7790\n  10:        0x10ea0951c - rustc_typeck::check::FnCtxt::check_expr_kind::h3deead7da823b578\n  11:        0x10ea06588 - rustc_typeck::check::FnCtxt::check_expr_with_expectation_and_lvalue_pref::he143ecfe673f135a\n  12:        0x10ea15416 - rustc_typeck::check::FnCtxt::check_block_with_expected::h3cbcd7af6c6dd8d8\n  13:        0x10e9e5a9b - rustc_typeck::check::check_fn::h248c6bcb73d27057\n  14:        0x10e9e4304 - rustc_typeck::check::check_bare_fn::haa7199476c92e826\n  15:        0x10e9e75f5 - rustc_typeck::check::check_item_body::h4df24fa6569eb6cd\n  16:        0x10e9e1d17 - rustc_typeck::check::check_item_bodies::h575d7e72333c5821\n  17:        0x10ea4e117 - rustc_typeck::check_crate::h56444fcd0efce52e\n  18:        0x10dec0d44 - rustc_driver::driver::phase_3_run_analysis_passes::{{closure}}::hcac3a2328cd9259a\n  19:        0x10de92257 - rustc_driver::driver::phase_3_run_analysis_passes::h9865057b323cad0e\n  20:        0x10de849df - rustc_driver::driver::compile_input::hc0edbed7edb3eb18\n  21:        0x10deae0c8 - rustc_driver::run_compiler::h22d678d32fb7c300\n  22:        0x10ddf1dd0 - std::panicking::try::do_call::h4d040997e2efdaf3\n  23:        0x112325f4a - __rust_maybe_catch_panic\n  24:        0x10de0fff4 - <F as alloc::boxed::FnBox<A>>::call_box::hba0b436c79e56b23\n  25:        0x112322e64 - std::sys::thread::Thread::new::thread_start::h022e3887023c6290\n  26:     0x7fff9ab9299c - _pthread_body\n  27:     0x7fff9ab92919 - _pthread_start\n```\n\nPossibly-related closed issues: #17033, #13847, #13202, #20791\n", "closed_by": {"login": "bors", "id": 3372342, "node_id": "MDQ6VXNlcjMzNzIzNDI=", "avatar_url": "https://avatars.githubusercontent.com/u/3372342?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors", "html_url": "https://github.com/bors", "followers_url": "https://api.github.com/users/bors/followers", "following_url": "https://api.github.com/users/bors/following{/other_user}", "gists_url": "https://api.github.com/users/bors/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors/subscriptions", "organizations_url": "https://api.github.com/users/bors/orgs", "repos_url": "https://api.github.com/users/bors/repos", "events_url": "https://api.github.com/users/bors/events{/privacy}", "received_events_url": "https://api.github.com/users/bors/received_events", "type": "User", "site_admin": false}, "reactions": {"url": "https://api.github.com/repos/rust-lang/rust/issues/36701/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rust-lang/rust/issues/36701/timeline", "performed_via_github_app": null, "state_reason": "completed"}