{"url": "https://api.github.com/repos/rust-lang/rust/issues/2053", "repository_url": "https://api.github.com/repos/rust-lang/rust", "labels_url": "https://api.github.com/repos/rust-lang/rust/issues/2053/labels{/name}", "comments_url": "https://api.github.com/repos/rust-lang/rust/issues/2053/comments", "events_url": "https://api.github.com/repos/rust-lang/rust/issues/2053/events", "html_url": "https://github.com/rust-lang/rust/issues/2053", "id": 3798505, "node_id": "MDU6SXNzdWUzNzk4NTA1", "number": 2053, "title": "segfault calling same function from two other functions (now reduced)", "user": {"login": "grahame", "id": 330805, "node_id": "MDQ6VXNlcjMzMDgwNQ==", "avatar_url": "https://avatars.githubusercontent.com/u/330805?v=4", "gravatar_id": "", "url": "https://api.github.com/users/grahame", "html_url": "https://github.com/grahame", "followers_url": "https://api.github.com/users/grahame/followers", "following_url": "https://api.github.com/users/grahame/following{/other_user}", "gists_url": "https://api.github.com/users/grahame/gists{/gist_id}", "starred_url": "https://api.github.com/users/grahame/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/grahame/subscriptions", "organizations_url": "https://api.github.com/users/grahame/orgs", "repos_url": "https://api.github.com/users/grahame/repos", "events_url": "https://api.github.com/users/grahame/events{/privacy}", "received_events_url": "https://api.github.com/users/grahame/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 100522, "node_id": "MDU6TGFiZWwxMDA1MjI=", "url": "https://api.github.com/repos/rust-lang/rust/labels/I-crash", "name": "I-crash", "color": "e10c02", "default": false, "description": "Issue: The compiler crashes (SIGSEGV, SIGABRT, etc). Use I-ICE instead when the compiler panics."}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 7, "created_at": "2012-03-25T14:11:56Z", "updated_at": "2014-06-16T21:56:32Z", "closed_at": "2012-04-18T15:23:31Z", "author_association": "CONTRIBUTOR", "active_lock_reason": null, "body": "Hi everyone\n\nI've tried for a couple of hours to reduce a segfault I'm seeing in pure rust code, but I can't manage it.\n\nI'm compiling these files together:\nhttps://raw.github.com/grahame/rust-csv/master/csv.rc\nhttps://raw.github.com/grahame/rust-csv/master/csv.rs\nhttps://raw.github.com/grahame/limerick/master/sim.rs\n\nThen running the program, eg:\n  `./sim data`\nwhere data is a directory containing a gtfs dataset, eg.\n  `http://www.transperth.wa.gov.au/TimetablePDFs/GoogleTransit/google_transit.zip`\n\nI'm seeing a segfault in the no_overwrite function (sim.rs):\n\n```\nfn no_overwrite<T: copy, U: copy>(m: map::hashmap<T, U>, k: T, v: U) {\n    //log(error, (k, v));\n    let ck = k;\n    let cv = v;\n    m.insert(ck, cv);\n}\n```\n\nbut only if I remove the \"let ck\" and \"let cv\" lines, and just use k and v directly. Those lines fix up the crash if present, as does chucking in a `log(error, (k, v));`.\n\nA traceback on my mac (using rust 1d7d5c16b375872):\n\n```\nrustc -g -L ../rust-csv/ ../rust-csv/csv.rc\nrustc -g -L ../rust-csv/ sim.rs\n(gdb) r ./data\nStarting program: /Users/grahame/code/limerick/sim ./data\nReading symbols for shared libraries ...+................................................................. done\nloading file: agency.txt\nloading file: stops.txt\nProgram received signal EXC_BAD_ACCESS, Could not access memory.\nReason: KERN_INVALID_ADDRESS at address: 0x0000000000000001\n[Switching to process 10651 thread 0x1f03]\n0x0000000100004080 in glue_take10 ()\n(gdb) bt\n#0  0x0000000100004080 in glue_take10 ()\n#1  0x0000000100516b00 in ?? ()\n#2  0x00000001000130fd in glue_take1407 ()\n#3  0x000000010000f333 in insert () at sim.rs:1\n#4  0x0000000100028b85 in __morestack ()\nPrevious frame inner to this frame (gdb could not unwind past this frame)\n```\n", "closed_by": {"login": "marijnh", "id": 144427, "node_id": "MDQ6VXNlcjE0NDQyNw==", "avatar_url": "https://avatars.githubusercontent.com/u/144427?v=4", "gravatar_id": "", "url": "https://api.github.com/users/marijnh", "html_url": "https://github.com/marijnh", "followers_url": "https://api.github.com/users/marijnh/followers", "following_url": "https://api.github.com/users/marijnh/following{/other_user}", "gists_url": "https://api.github.com/users/marijnh/gists{/gist_id}", "starred_url": "https://api.github.com/users/marijnh/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/marijnh/subscriptions", "organizations_url": "https://api.github.com/users/marijnh/orgs", "repos_url": "https://api.github.com/users/marijnh/repos", "events_url": "https://api.github.com/users/marijnh/events{/privacy}", "received_events_url": "https://api.github.com/users/marijnh/received_events", "type": "User", "site_admin": false}, "reactions": {"url": "https://api.github.com/repos/rust-lang/rust/issues/2053/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rust-lang/rust/issues/2053/timeline", "performed_via_github_app": null, "state_reason": "completed"}