{"url": "https://api.github.com/repos/rust-lang/rust/issues/107862", "repository_url": "https://api.github.com/repos/rust-lang/rust", "labels_url": "https://api.github.com/repos/rust-lang/rust/issues/107862/labels{/name}", "comments_url": "https://api.github.com/repos/rust-lang/rust/issues/107862/comments", "events_url": "https://api.github.com/repos/rust-lang/rust/issues/107862/events", "html_url": "https://github.com/rust-lang/rust/issues/107862", "id": 1578793418, "node_id": "I_kwDOAAsO6M5eGnnK", "number": 107862, "title": "Accidental colon results in mixed signaling of fixes and errors", "user": {"login": "edward-shen", "id": 6173958, "node_id": "MDQ6VXNlcjYxNzM5NTg=", "avatar_url": "https://avatars.githubusercontent.com/u/6173958?v=4", "gravatar_id": "", "url": "https://api.github.com/users/edward-shen", "html_url": "https://github.com/edward-shen", "followers_url": "https://api.github.com/users/edward-shen/followers", "following_url": "https://api.github.com/users/edward-shen/following{/other_user}", "gists_url": "https://api.github.com/users/edward-shen/gists{/gist_id}", "starred_url": "https://api.github.com/users/edward-shen/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/edward-shen/subscriptions", "organizations_url": "https://api.github.com/users/edward-shen/orgs", "repos_url": "https://api.github.com/users/edward-shen/repos", "events_url": "https://api.github.com/users/edward-shen/events{/privacy}", "received_events_url": "https://api.github.com/users/edward-shen/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 235791, "node_id": "MDU6TGFiZWwyMzU3OTE=", "url": "https://api.github.com/repos/rust-lang/rust/labels/A-diagnostics", "name": "A-diagnostics", "color": "f7e101", "default": false, "description": "Area: Messages for errors, warnings, and lints"}, {"id": 211668100, "node_id": "MDU6TGFiZWwyMTE2NjgxMDA=", "url": "https://api.github.com/repos/rust-lang/rust/labels/T-compiler", "name": "T-compiler", "color": "bfd4f2", "default": false, "description": "Relevant to the compiler team, which will review and decide on the PR/issue."}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 1, "created_at": "2023-02-10T00:03:54Z", "updated_at": "2023-05-03T07:51:28Z", "closed_at": "2023-05-03T07:51:27Z", "author_association": "CONTRIBUTOR", "active_lock_reason": null, "body": "### Code\n\n```Rust\nfn do_thing() -> Result<bool, ()> { unimplemented!() }\r\n\r\nfn t() -> Result<(), ()> {\r\n    let thing = do_thing()?:\r\n    Ok(())\r\n}\n```\n\n\n### Current output\n\n```Shell\nerror: expected `;`, found `}`\r\n --> src/lib.rs:5:11\r\n  |\r\n5 |     Ok(())\r\n  |           ^ help: add `;` here\r\n6 | }\r\n  | - unexpected token\r\n\r\nerror[E0573]: expected type, found variant `Ok`\r\n --> src/lib.rs:5:5\r\n  |\r\n5 |     Ok(())\r\n  |     ^^^^^^ expecting a type here because of type ascription\r\n  |\r\nhelp: maybe you meant to write `;` here\r\n  |\r\n4 |     let thing = do_thing()?;\r\n  |                            ~\r\nhelp: consider importing this struct instead\r\n  |\r\n1 | use futures_0_1_31::future::Ok;\r\n  |\r\n\r\nerror[E0308]: mismatched types\r\n --> src/lib.rs:3:11\r\n  |\r\n3 | fn t() -> Result<(), ()> {\r\n  |    -      ^^^^^^^^^^^^^^ expected `Result<(), ()>`, found `()`\r\n  |    |\r\n  |    implicitly returns `()` as its body has no tail or `return` expression\r\n  |\r\n  = note:   expected enum `Result<(), ()>`\r\n          found unit type `()`\r\n\r\nSome errors have detailed explanations: E0308, E0573.\r\nFor more information about an error, try `rustc --explain E0308`.\n```\n\n\n### Desired output\n\n```Shell\nerror[E0573]: expected type, found variant `Ok`\r\n --> src/lib.rs:5:5\r\n  |\r\n5 |     Ok(())\r\n  |     ^^^^^^ expecting a type here because of type ascription\r\n  |\r\nhelp: maybe you meant to write `;` here\r\n  |\r\n4 |     let thing = do_thing()?;\r\n  |                            ~\r\nhelp: consider importing this struct instead\r\n  |\r\n1 | use futures_0_1_31::future::Ok;\r\n  |\r\n\r\nFor more information about an error, try `rustc --explain E0573`.\n```\n\n\n### Rationale and extra context\n\n(If the error isn't clear, it's that the example code as a colon instead of a semi-colon.\r\n\r\nThis suggestion has two improvements to suggest:\r\n\r\n1. The first error's help is not helpful. The E0573 error reports the correct fix, but the preceding error first appears, making it less look like the compiler is suggesting two locations to add a `;` to fix the issue, of which only one is correct. Removing the first error might help reduce mix signaling.\r\n2. The second one is that E0308 shouldn't appear in this at all. E0573 suggests that the expression was likely a (semi-)colon issue, which from the user seems like Rust can infer pretty well what's going on and how to fix it. However, E0308 then shows up, complaining that the return type is `()`. This also is mixed signaling.\n\n### Other cases\n\n_No response_\n\n### Anything else?\n\nRepros on 1.69.0-nightly (2023-02-08 ef934d9b632b8ac00276): [playground](https://play.rust-lang.org/?version=nightly&mode=debug&edition=2021&gist=09001a48de4a3f1cad8f0a3064ba4c7b).", "closed_by": {"login": "chenyukang", "id": 230646, "node_id": "MDQ6VXNlcjIzMDY0Ng==", "avatar_url": "https://avatars.githubusercontent.com/u/230646?v=4", "gravatar_id": "", "url": "https://api.github.com/users/chenyukang", "html_url": "https://github.com/chenyukang", "followers_url": "https://api.github.com/users/chenyukang/followers", "following_url": "https://api.github.com/users/chenyukang/following{/other_user}", "gists_url": "https://api.github.com/users/chenyukang/gists{/gist_id}", "starred_url": "https://api.github.com/users/chenyukang/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/chenyukang/subscriptions", "organizations_url": "https://api.github.com/users/chenyukang/orgs", "repos_url": "https://api.github.com/users/chenyukang/repos", "events_url": "https://api.github.com/users/chenyukang/events{/privacy}", "received_events_url": "https://api.github.com/users/chenyukang/received_events", "type": "User", "site_admin": false}, "reactions": {"url": "https://api.github.com/repos/rust-lang/rust/issues/107862/reactions", "total_count": 1, "+1": 0, "-1": 0, "laugh": 1, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rust-lang/rust/issues/107862/timeline", "performed_via_github_app": null, "state_reason": "completed"}