{"url": "https://api.github.com/repos/rust-lang/rust/issues/49528", "repository_url": "https://api.github.com/repos/rust-lang/rust", "labels_url": "https://api.github.com/repos/rust-lang/rust/issues/49528/labels{/name}", "comments_url": "https://api.github.com/repos/rust-lang/rust/issues/49528/comments", "events_url": "https://api.github.com/repos/rust-lang/rust/issues/49528/events", "html_url": "https://github.com/rust-lang/rust/issues/49528", "id": 310193821, "node_id": "MDU6SXNzdWUzMTAxOTM4MjE=", "number": 49528, "title": "internal compiler error in rustc when compiling cretonne after running mypy", "user": {"login": "sunfishcode", "id": 4503403, "node_id": "MDQ6VXNlcjQ1MDM0MDM=", "avatar_url": "https://avatars.githubusercontent.com/u/4503403?v=4", "gravatar_id": "", "url": "https://api.github.com/users/sunfishcode", "html_url": "https://github.com/sunfishcode", "followers_url": "https://api.github.com/users/sunfishcode/followers", "following_url": "https://api.github.com/users/sunfishcode/following{/other_user}", "gists_url": "https://api.github.com/users/sunfishcode/gists{/gist_id}", "starred_url": "https://api.github.com/users/sunfishcode/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/sunfishcode/subscriptions", "organizations_url": "https://api.github.com/users/sunfishcode/orgs", "repos_url": "https://api.github.com/users/sunfishcode/repos", "events_url": "https://api.github.com/users/sunfishcode/events{/privacy}", "received_events_url": "https://api.github.com/users/sunfishcode/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 9618520, "node_id": "MDU6TGFiZWw5NjE4NTIw", "url": "https://api.github.com/repos/rust-lang/rust/labels/I-ICE", "name": "I-ICE", "color": "e10c02", "default": false, "description": "Issue: The compiler panicked, giving an Internal Compilation Error (ICE) \u2744\ufe0f"}, {"id": 211668100, "node_id": "MDU6TGFiZWwyMTE2NjgxMDA=", "url": "https://api.github.com/repos/rust-lang/rust/labels/T-compiler", "name": "T-compiler", "color": "bfd4f2", "default": false, "description": "Relevant to the compiler team, which will review and decide on the PR/issue."}, {"id": 262252628, "node_id": "MDU6TGFiZWwyNjIyNTI2Mjg=", "url": "https://api.github.com/repos/rust-lang/rust/labels/regression-from-stable-to-beta", "name": "regression-from-stable-to-beta", "color": "e4008a", "default": false, "description": "Performance or correctness regression from stable to beta."}, {"id": 307747675, "node_id": "MDU6TGFiZWwzMDc3NDc2NzU=", "url": "https://api.github.com/repos/rust-lang/rust/labels/A-incr-comp", "name": "A-incr-comp", "color": "f7e101", "default": false, "description": "Area: Incremental compilation"}, {"id": 650731663, "node_id": "MDU6TGFiZWw2NTA3MzE2NjM=", "url": "https://api.github.com/repos/rust-lang/rust/labels/C-bug", "name": "C-bug", "color": "f5f1fd", "default": false, "description": "Category: This is a bug."}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": {"url": "https://api.github.com/repos/rust-lang/rust/milestones/48", "html_url": "https://github.com/rust-lang/rust/milestone/48", "labels_url": "https://api.github.com/repos/rust-lang/rust/milestones/48/labels", "id": 3125374, "node_id": "MDk6TWlsZXN0b25lMzEyNTM3NA==", "number": 48, "title": "1.26", "description": "", "creator": {"login": "Mark-Simulacrum", "id": 5047365, "node_id": "MDQ6VXNlcjUwNDczNjU=", "avatar_url": "https://avatars.githubusercontent.com/u/5047365?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Mark-Simulacrum", "html_url": "https://github.com/Mark-Simulacrum", "followers_url": "https://api.github.com/users/Mark-Simulacrum/followers", "following_url": "https://api.github.com/users/Mark-Simulacrum/following{/other_user}", "gists_url": "https://api.github.com/users/Mark-Simulacrum/gists{/gist_id}", "starred_url": "https://api.github.com/users/Mark-Simulacrum/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Mark-Simulacrum/subscriptions", "organizations_url": "https://api.github.com/users/Mark-Simulacrum/orgs", "repos_url": "https://api.github.com/users/Mark-Simulacrum/repos", "events_url": "https://api.github.com/users/Mark-Simulacrum/events{/privacy}", "received_events_url": "https://api.github.com/users/Mark-Simulacrum/received_events", "type": "User", "site_admin": false}, "open_issues": 0, "closed_issues": 23, "state": "closed", "created_at": "2018-02-19T01:33:50Z", "updated_at": "2018-05-07T19:32:56Z", "due_on": "2018-05-10T07:00:00Z", "closed_at": "2018-05-07T19:32:56Z"}, "comments": 6, "created_at": "2018-03-30T23:51:23Z", "updated_at": "2018-05-03T15:23:55Z", "closed_at": "2018-05-03T15:23:55Z", "author_association": "MEMBER", "active_lock_reason": null, "body": "When building https://github.com/Cretonne/cretonne/tree/24c8e6524fb814577c93779a628ab536e667c3f0, \"cargo build\" succeeds in a fresh tree, but if I run mypy over some of the python source files, without changing anything, subsequent \"cargo build\" runs hit an internal compiler error in rustc.\r\n\r\nmypy doesn't seem to modify anything outside of its .mypy_cache directory, so I've not yet determined how mypy could be influencing rustc, but the error reproduces reliably for me.\r\n```terminal\r\n$ rustc --version\r\nrustc 1.26.0-nightly (ae544ee1c 2018-03-29)\r\n$ cargo clean\r\n$ cargo build\r\n   Compiling cc v1.0.9\r\n   Compiling unicode-xid v0.0.4\r\n[...]\r\n    Finished dev [unoptimized + debuginfo] target(s) in 35.81 secs\r\n$ cargo build\r\n    Finished dev [unoptimized + debuginfo] target(s) in 0.0 secs\r\n$ cargo build\r\n    Finished dev [unoptimized + debuginfo] target(s) in 0.0 secs\r\n$ cd lib/cretonne/meta/\r\n$ mypy --py2 build.py\r\n$ cd -\r\n/home/sunfish/cretonne\r\n$ cargo build\r\n   Compiling cretonne v0.4.1 (file:///home/sunfish/cretonne/lib/cretonne)\r\nthread 'rustc' panicked at 'assertion failed: this.interpret_alloc_cache.borrow_mut().insert(pos, alloc_id).is_none()', librustc/ty/maps/on_disk_cache.rs:600:17\r\nnote: Run with `RUST_BACKTRACE=1` for a backtrace.\r\n\r\nerror: internal compiler error: unexpected panic\r\n\r\nnote: the compiler unexpectedly panicked. this is a bug.\r\n\r\nnote: we would appreciate a bug report: https://github.com/rust-lang/rust/blob/master/CONTRIBUTING.md#bug-reports\r\n\r\nnote: rustc 1.26.0-nightly (ae544ee1c 2018-03-29) running on x86_64-unknown-linux-gnu\r\n\r\nnote: compiler flags: -C debuginfo=2 -C incremental --crate-type lib\r\n\r\nnote: some of the compiler flags provided by cargo are hidden\r\n\r\nerror: Could not compile `cretonne`.\r\n\r\nTo learn more, run the command again with --verbose.\r\n$\r\n```\r\n\r\nHere's the backtrace:\r\n```\r\n$ RUST_BACKTRACE=full cargo build --verbose\r\n       Fresh unicode-xid v0.0.4\r\n       Fresh cc v1.0.9\r\n       Fresh unicode-xid v0.1.0\r\n       Fresh quote v0.3.15\r\n       Fresh void v1.0.2\r\n       Fresh libc v0.2.40\r\n       Fresh rustc-demangle v0.1.7\r\n       Fresh ucd-util v0.1.1\r\n       Fresh lazy_static v1.0.0\r\n       Fresh gcc v0.3.54\r\n       Fresh cfg-if v0.1.2\r\n       Fresh utf8-ranges v1.0.0\r\n       Fresh bitflags v0.7.0\r\n       Fresh strsim v0.6.0\r\n       Fresh byteorder v1.2.1\r\n       Fresh remove_dir_all v0.5.0\r\n       Fresh serde v1.0.36\r\n       Fresh wasmparser v0.15.2\r\n       Fresh synom v0.11.3\r\n       Fresh proc-macro2 v0.2.3\r\n       Fresh unreachable v1.0.0\r\n       Fresh memchr v2.0.1\r\n       Fresh rand v0.4.2\r\n       Fresh num_cpus v1.8.0\r\n       Fresh regex-syntax v0.5.3\r\n       Fresh term v0.5.1\r\n       Fresh syn v0.11.11\r\n       Fresh quote v0.4.2\r\n       Fresh thread_local v0.3.5\r\n       Fresh aho-corasick v0.6.4\r\n       Fresh tempdir v0.3.7\r\n   Compiling cretonne v0.4.1 (file:///home/sunfish/cretonne/lib/cretonne)\r\n       Fresh synstructure v0.6.1\r\n       Fresh backtrace-sys v0.1.16\r\n     Running `rustc --crate-name cretonne lib/cretonne/src/lib.rs --crate-type lib --emit=dep-info,link -C debuginfo=2 -C metadata=07919c7425d7c112 -C extra-filename=-07919c7425d7c112 --out-dir /home/sunfish/cretonne/target/debug/deps -C incremental=/home/sunfish/cretonne/target/debug/incremental -L dependency=/home/sunfish/cretonne/target/debug/deps --cfg build_riscv --cfg build_intel --cfg build_arm32 --cfg build_arm64`\r\n       Fresh syn v0.12.15\r\n       Fresh regex v0.2.10\r\n       Fresh raw-cpuid v3.0.0\r\n       Fresh failure_derive v0.1.1\r\n       Fresh backtrace v0.3.5\r\n       Fresh serde_derive_internals v0.22.2\r\n       Fresh filecheck v0.2.1\r\n       Fresh failure v0.1.1\r\n       Fresh serde_derive v1.0.36\r\n       Fresh filecheck v0.3.0\r\n       Fresh docopt v0.8.3\r\nthread 'rustc' panicked at 'assertion failed: this.interpret_alloc_cache.borrow_mut().insert(pos, alloc_id).is_none()', librustc/ty/maps/on_disk_cache.rs:600:17\r\nstack backtrace:\r\n   0:     0x7ffbfc76185b - std::sys::unix::backtrace::tracing::imp::unwind_backtrace::he90736f0673c5957\r\n                               at libstd/sys/unix/backtrace/tracing/gcc_s.rs:49\r\n   1:     0x7ffbfc72f990 - std::sys_common::backtrace::print::h37226c664104fff7\r\n                               at libstd/sys_common/backtrace.rs:71\r\n                               at libstd/sys_common/backtrace.rs:59\r\n   2:     0x7ffbfc75529d - std::panicking::default_hook::{{closure}}::h5edcec13387dd2e3\r\n                               at libstd/panicking.rs:207\r\n   3:     0x7ffbfc754ffb - std::panicking::default_hook::ha0061cec4ea60cf2\r\n                               at libstd/panicking.rs:223\r\n   4:     0x7ffbf8d535bd - core::ops::function::Fn::call::hfbcf24185d298f84\r\n   5:     0x7ffbfc7557e9 - std::panicking::rust_panic_with_hook::hb876ad0773f5dc16\r\n                               at libstd/panicking.rs:403\r\n   6:     0x7ffbf88aa6d5 - std::panicking::begin_panic::h06c4bb1157cdb39b\r\n   7:     0x7ffbf89c1b29 - rustc::mir::interpret::specialized_decode_alloc_id::h2291847f4f3e799b\r\n   8:     0x7ffbf8b153e7 - <rustc::ty::maps::on_disk_cache::CacheDecoder<'a, 'tcx, 'x> as serialize::serialize::SpecializedDecoder<rustc::mir::interpret::AllocId>>::specialized_decode::h80c3dde4cadcaadd\r\n   9:     0x7ffbf89c1866 - rustc::mir::interpret::specialized_decode_alloc_id::h2291847f4f3e799b\r\n  10:     0x7ffbf8b153e7 - <rustc::ty::maps::on_disk_cache::CacheDecoder<'a, 'tcx, 'x> as serialize::serialize::SpecializedDecoder<rustc::mir::interpret::AllocId>>::specialized_decode::h80c3dde4cadcaadd\r\n  11:     0x7ffbf8aefbd2 - serialize::serialize::Decoder::read_map::h4c607091f848635c\r\n  12:     0x7ffbf8ae759a - serialize::serialize::Decoder::read_struct::h233b13e9fb65b522\r\n  13:     0x7ffbf89c179e - rustc::mir::interpret::specialized_decode_alloc_id::h2291847f4f3e799b\r\n  14:     0x7ffbf8b153e7 - <rustc::ty::maps::on_disk_cache::CacheDecoder<'a, 'tcx, 'x> as serialize::serialize::SpecializedDecoder<rustc::mir::interpret::AllocId>>::specialized_decode::h80c3dde4cadcaadd\r\n  15:     0x7ffbf8aefbd2 - serialize::serialize::Decoder::read_map::h4c607091f848635c\r\n  16:     0x7ffbf8ae759a - serialize::serialize::Decoder::read_struct::h233b13e9fb65b522\r\n  17:     0x7ffbf89c179e - rustc::mir::interpret::specialized_decode_alloc_id::h2291847f4f3e799b\r\n  18:     0x7ffbf8b153e7 - <rustc::ty::maps::on_disk_cache::CacheDecoder<'a, 'tcx, 'x> as serialize::serialize::SpecializedDecoder<rustc::mir::interpret::AllocId>>::specialized_decode::h80c3dde4cadcaadd\r\n  19:     0x7ffbf8aefbd2 - serialize::serialize::Decoder::read_map::h4c607091f848635c\r\n  20:     0x7ffbf8ae759a - serialize::serialize::Decoder::read_struct::h233b13e9fb65b522\r\n  21:     0x7ffbf89c179e - rustc::mir::interpret::specialized_decode_alloc_id::h2291847f4f3e799b\r\n  22:     0x7ffbf8b153e7 - <rustc::ty::maps::on_disk_cache::CacheDecoder<'a, 'tcx, 'x> as serialize::serialize::SpecializedDecoder<rustc::mir::interpret::AllocId>>::specialized_decode::h80c3dde4cadcaadd\r\n  23:     0x7ffbf8afd031 - serialize::serialize::Decoder::read_enum::hc04b5d0bc1636a64\r\n  24:     0x7ffbf8afe2af - serialize::serialize::Decoder::read_enum::heb95394f5ee7f74d\r\n  25:     0x7ffbf8afd925 - serialize::serialize::Decoder::read_enum::hdb508e49903b0e55\r\n  26:     0x7ffbf8b0eee5 - rustc::ty::maps::on_disk_cache::OnDiskCache::try_load_query_result::h271f3888101d51cf\r\n  27:     0x7ffbf8c6e6a0 - rustc::ty::maps::<impl rustc::ty::maps::queries::const_eval<'tcx>>::try_get::h23b58c87b8a638bd\r\n  28:     0x7ffbf8c172fa - rustc::ty::maps::TyCtxtAt::const_eval::h125e2e934614106c\r\n  29:     0x7ffbf8c13904 - rustc::ty::maps::<impl rustc::ty::context::TyCtxt<'a, 'tcx, 'lcx>>::const_eval::h4f04045e39323659\r\n  30:     0x7ffbf98cd50f - rustc_mir::monomorphize::collector::collect_items_rec::ha321e7245faddaa1\r\n  31:     0x7ffbf98cd9a5 - rustc_mir::monomorphize::collector::collect_items_rec::ha321e7245faddaa1\r\n  32:     0x7ffbf98cd9a5 - rustc_mir::monomorphize::collector::collect_items_rec::ha321e7245faddaa1\r\n  33:     0x7ffbf98cd9a5 - rustc_mir::monomorphize::collector::collect_items_rec::ha321e7245faddaa1\r\n  34:     0x7ffbf98cd9a5 - rustc_mir::monomorphize::collector::collect_items_rec::ha321e7245faddaa1\r\n  35:     0x7ffbf98cd9a5 - rustc_mir::monomorphize::collector::collect_items_rec::ha321e7245faddaa1\r\n  36:     0x7ffbf98cca7a - rustc_mir::monomorphize::collector::collect_crate_mono_items::h6c5c4d2f6be93974\r\n  37:     0x7ffbf10e6a06 - rustc::util::common::time::h2b188e3826a5ea0e\r\n  38:     0x7ffbf104cc78 - rustc_trans::base::collect_and_partition_translation_items::hc7f6051bb0ed2095\r\n  39:     0x7ffbf88d41f7 - rustc::dep_graph::graph::DepGraph::with_ignore::h1f92ffc35e15667c\r\n  40:     0x7ffbf8963835 - rustc_errors::Handler::track_diagnostics::h35f46c6f612e58b5\r\n  41:     0x7ffbf8be1bf7 - rustc::ty::maps::plumbing::<impl rustc::ty::context::TyCtxt<'a, 'gcx, 'tcx>>::cycle_check::hd962d3e6647f84f2\r\n  42:     0x7ffbf8ce3ac7 - rustc::ty::maps::<impl rustc::ty::maps::queries::collect_and_partition_translation_items<'tcx>>::try_get::h775812341537cb43\r\n  43:     0x7ffbf8c1c2f7 - rustc::ty::maps::TyCtxtAt::collect_and_partition_translation_items::h44c32ed0ec66ca14\r\n  44:     0x7ffbf8c14cbe - rustc::ty::maps::<impl rustc::ty::context::TyCtxt<'a, 'tcx, 'lcx>>::collect_and_partition_translation_items::h15854687a10ac9c6\r\n  45:     0x7ffbf104b032 - rustc_trans::base::trans_crate::h30b12ada34eb627c\r\n  46:     0x7ffbf1011917 - <rustc_trans::LlvmTransCrate as rustc_trans_utils::trans_crate::TransCrate>::trans_crate::h47c4210dd6cfea88\r\n  47:     0x7ffbfcaecfa5 - rustc::util::common::time::h516fe4fca915fefc\r\n  48:     0x7ffbfcae0764 - rustc_driver::driver::phase_4_translate_to_llvm::h3384ff9dbd6ca1ee\r\n  49:     0x7ffbfcb68f19 - rustc_driver::driver::compile_input::{{closure}}::h882b28e18bc8c2e8\r\n  50:     0x7ffbfcb5fcda - <std::thread::local::LocalKey<T>>::with::h4c767a532ca41fa3\r\n  51:     0x7ffbfcb66136 - <std::thread::local::LocalKey<T>>::with::he47cefd74ff28307\r\n  52:     0x7ffbfcbdc59e - rustc::ty::context::TyCtxt::create_and_enter::hd599c2d32b176ac6\r\n  53:     0x7ffbfcad9c37 - rustc_driver::driver::compile_input::hd12ba23060796bfe\r\n  54:     0x7ffbfcb8eadf - rustc_driver::run_compiler_impl::h8ab3a92625df6f67\r\n  55:     0x7ffbfcab3b18 - syntax::with_globals::h5b93a0cb73c64078\r\n  56:     0x7ffbfcaf488d - std::sys_common::backtrace::__rust_begin_short_backtrace::h353ee474fb03bf90\r\n  57:     0x7ffbfc76febe - __rust_maybe_catch_panic\r\n                               at libpanic_unwind/lib.rs:102\r\n  58:     0x7ffbfcb009ed - <F as alloc::boxed::FnBox<A>>::call_box::h7815eff9e835733f\r\n  59:     0x7ffbfc766f47 - std::sys_common::thread::start_thread::h5801fa5836ace044\r\n                               at /checkout/src/liballoc/boxed.rs:793\r\n                               at libstd/sys_common/thread.rs:24\r\n  60:     0x7ffbfc735fb8 - std::sys::unix::thread::Thread::new::thread_start::h9ffd4ead1288775a\r\n                               at libstd/sys/unix/thread.rs:90\r\n  61:     0x7ffbf6a9a7fb - start_thread\r\n  62:     0x7ffbfc40cb5e - clone\r\n  63:                0x0 - <unknown>\r\n\r\nerror: internal compiler error: unexpected panic\r\n\r\nnote: the compiler unexpectedly panicked. this is a bug.\r\n\r\nnote: we would appreciate a bug report: https://github.com/rust-lang/rust/blob/master/CONTRIBUTING.md#bug-reports\r\n\r\nnote: rustc 1.26.0-nightly (ae544ee1c 2018-03-29) running on x86_64-unknown-linux-gnu\r\n\r\nnote: compiler flags: -C debuginfo=2 -C incremental --crate-type lib\r\n\r\nnote: some of the compiler flags provided by cargo are hidden\r\n\r\nerror: Could not compile `cretonne`.\r\n\r\nCaused by:\r\n  process didn't exit successfully: `rustc --crate-name cretonne lib/cretonne/src/lib.rs --crate-type lib --emit=dep-info,link -C debuginfo=2 -C metadata=07919c7425d7c112 -C extra-filename=-07919c7425d7c112 --out-dir /home/sunfish/cretonne/target/debug/deps -C incremental=/home/sunfish/cretonne/target/debug/incremental -L dependency=/home/sunfish/cretonne/target/debug/deps --cfg build_riscv --cfg build_intel --cfg build_arm32 --cfg build_arm64` (exit code: 101)\r\n```", "closed_by": {"login": "sunfishcode", "id": 4503403, "node_id": "MDQ6VXNlcjQ1MDM0MDM=", "avatar_url": "https://avatars.githubusercontent.com/u/4503403?v=4", "gravatar_id": "", "url": "https://api.github.com/users/sunfishcode", "html_url": "https://github.com/sunfishcode", "followers_url": "https://api.github.com/users/sunfishcode/followers", "following_url": "https://api.github.com/users/sunfishcode/following{/other_user}", "gists_url": "https://api.github.com/users/sunfishcode/gists{/gist_id}", "starred_url": "https://api.github.com/users/sunfishcode/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/sunfishcode/subscriptions", "organizations_url": "https://api.github.com/users/sunfishcode/orgs", "repos_url": "https://api.github.com/users/sunfishcode/repos", "events_url": "https://api.github.com/users/sunfishcode/events{/privacy}", "received_events_url": "https://api.github.com/users/sunfishcode/received_events", "type": "User", "site_admin": false}, "reactions": {"url": "https://api.github.com/repos/rust-lang/rust/issues/49528/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rust-lang/rust/issues/49528/timeline", "performed_via_github_app": null, "state_reason": "completed"}