{"url": "https://api.github.com/repos/rust-lang/rust/issues/24196", "repository_url": "https://api.github.com/repos/rust-lang/rust", "labels_url": "https://api.github.com/repos/rust-lang/rust/issues/24196/labels{/name}", "comments_url": "https://api.github.com/repos/rust-lang/rust/issues/24196/comments", "events_url": "https://api.github.com/repos/rust-lang/rust/issues/24196/events", "html_url": "https://github.com/rust-lang/rust/issues/24196", "id": 67168438, "node_id": "MDU6SXNzdWU2NzE2ODQzOA==", "number": 24196, "title": "Collections or_insert_with Option<T>", "user": {"login": "WildCryptoFox", "id": 637155, "node_id": "MDQ6VXNlcjYzNzE1NQ==", "avatar_url": "https://avatars.githubusercontent.com/u/637155?v=4", "gravatar_id": "", "url": "https://api.github.com/users/WildCryptoFox", "html_url": "https://github.com/WildCryptoFox", "followers_url": "https://api.github.com/users/WildCryptoFox/followers", "following_url": "https://api.github.com/users/WildCryptoFox/following{/other_user}", "gists_url": "https://api.github.com/users/WildCryptoFox/gists{/gist_id}", "starred_url": "https://api.github.com/users/WildCryptoFox/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/WildCryptoFox/subscriptions", "organizations_url": "https://api.github.com/users/WildCryptoFox/orgs", "repos_url": "https://api.github.com/users/WildCryptoFox/repos", "events_url": "https://api.github.com/users/WildCryptoFox/events{/privacy}", "received_events_url": "https://api.github.com/users/WildCryptoFox/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 234902, "node_id": "MDU6TGFiZWwyMzQ5MDI=", "url": "https://api.github.com/repos/rust-lang/rust/labels/C-enhancement", "name": "C-enhancement", "color": "f5f1fd", "default": false, "description": "Category: An issue proposing an enhancement or a PR with one."}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 5, "created_at": "2015-04-08T16:30:42Z", "updated_at": "2019-06-21T09:00:33Z", "closed_at": "2015-08-15T13:38:56Z", "author_association": "CONTRIBUTOR", "active_lock_reason": null, "body": "After looking at the new or_insert/_with/ functions; I noticed that the _with function doesn't allow the child function to decide if the insert will occur.\n\nHere I request for an optional version that allows the function to make that decision.\n\nIt doesn't need to do the add manually; instead it is perfectly clean to use Option's `Some(inserted_value)` or `None`.\n\nThe following is an example using this method against the rustbyexample.com HashMap example.\nhttp://is.gd/myihhV\n\n``` rust\npub fn or_maybe_insert_with<F: FnOnce() -> V>(self, default: F) -> Option<&'a mut V> {\n    match self {\n        Occupied(entry) => entry.into_mut(),\n        Vacant(entry) => match default() {\n            Some(val) => Some(entry.insert(val)),\n            _         => None,\n        },\n    }\n}\n```\n\nExample usage: early return when the value neither already exists and wasn't added.\n\n``` rust\nlet value = match map.entry(key).or_maybe_insert_with(||{ Some(\"insert me!\") }) {\n    Some(v) => v,\n    _       => return, // early return\n}\n```\n", "closed_by": {"login": "WildCryptoFox", "id": 637155, "node_id": "MDQ6VXNlcjYzNzE1NQ==", "avatar_url": "https://avatars.githubusercontent.com/u/637155?v=4", "gravatar_id": "", "url": "https://api.github.com/users/WildCryptoFox", "html_url": "https://github.com/WildCryptoFox", "followers_url": "https://api.github.com/users/WildCryptoFox/followers", "following_url": "https://api.github.com/users/WildCryptoFox/following{/other_user}", "gists_url": "https://api.github.com/users/WildCryptoFox/gists{/gist_id}", "starred_url": "https://api.github.com/users/WildCryptoFox/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/WildCryptoFox/subscriptions", "organizations_url": "https://api.github.com/users/WildCryptoFox/orgs", "repos_url": "https://api.github.com/users/WildCryptoFox/repos", "events_url": "https://api.github.com/users/WildCryptoFox/events{/privacy}", "received_events_url": "https://api.github.com/users/WildCryptoFox/received_events", "type": "User", "site_admin": false}, "reactions": {"url": "https://api.github.com/repos/rust-lang/rust/issues/24196/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rust-lang/rust/issues/24196/timeline", "performed_via_github_app": null, "state_reason": "completed"}