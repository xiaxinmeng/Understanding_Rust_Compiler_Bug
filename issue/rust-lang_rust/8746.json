{"url": "https://api.github.com/repos/rust-lang/rust/issues/8746", "repository_url": "https://api.github.com/repos/rust-lang/rust", "labels_url": "https://api.github.com/repos/rust-lang/rust/issues/8746/labels{/name}", "comments_url": "https://api.github.com/repos/rust-lang/rust/issues/8746/comments", "events_url": "https://api.github.com/repos/rust-lang/rust/issues/8746/events", "html_url": "https://github.com/rust-lang/rust/issues/8746", "id": 18519406, "node_id": "MDU6SXNzdWUxODUxOTQwNg==", "number": 8746, "title": "Cross-crate enum struct variants exporting bug", "user": {"login": "nsf", "id": 12567, "node_id": "MDQ6VXNlcjEyNTY3", "avatar_url": "https://avatars.githubusercontent.com/u/12567?v=4", "gravatar_id": "", "url": "https://api.github.com/users/nsf", "html_url": "https://github.com/nsf", "followers_url": "https://api.github.com/users/nsf/followers", "following_url": "https://api.github.com/users/nsf/following{/other_user}", "gists_url": "https://api.github.com/users/nsf/gists{/gist_id}", "starred_url": "https://api.github.com/users/nsf/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/nsf/subscriptions", "organizations_url": "https://api.github.com/users/nsf/orgs", "repos_url": "https://api.github.com/users/nsf/repos", "events_url": "https://api.github.com/users/nsf/events{/privacy}", "received_events_url": "https://api.github.com/users/nsf/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 13242248, "node_id": "MDU6TGFiZWwxMzI0MjI0OA==", "url": "https://api.github.com/repos/rust-lang/rust/labels/A-metadata", "name": "A-metadata", "color": "f7e101", "default": false, "description": "Area: crate metadata"}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 3, "created_at": "2013-08-25T10:50:45Z", "updated_at": "2013-10-06T18:41:25Z", "closed_at": "2013-10-06T18:41:25Z", "author_association": "CONTRIBUTOR", "active_lock_reason": null, "body": "The bug occurs only in a cross-crate scenario, probably related to metadata encoding/decoding, have no idea. Here's a quick way to make a mockup:\n\ntest.rs:\n\n``` rust\nextern mod testenum;\n\nfn main() {\n        let x = testenum::A;\n        match x {\n                //test.rs:6:2: 6:13 error: `testenum::B` does not name a structure\n                //testenum::B{_} => println(\"oops\"),\n                testenum::B(_, _) => println(\"sweet\"),\n                _ => println(\"nothing\"),\n        }\n}\n```\n\n.rust/src/testenum/lib.rs\n\n``` rust\n#[link(name = \"testenum\",\n       vers = \"0.0\")];\n\npub enum Test {\n        A,\n        B{f1: int, f2: int},\n        C,\n}\n```\n\nThen build the crate: `rustpkg install testenum`. And compile the test.rs: `rustc -o test test.rs`. It compiles just fine, when it actually shouldn't. Because testenum::B is a struct variant, not a tuple. Uncommenting the struct variant and commenting out the tuple variant results in a compilation error:\n\n```\ntest.rs:7:2: 7:13 error: `testenum::B` does not name a structure\ntest.rs:7               testenum::B{_} => println(\"oops\"),\n                        ^~~~~~~~~~~\nerror: aborting due to previous error\n```\n", "closed_by": {"login": "alexcrichton", "id": 64996, "node_id": "MDQ6VXNlcjY0OTk2", "avatar_url": "https://avatars.githubusercontent.com/u/64996?v=4", "gravatar_id": "", "url": "https://api.github.com/users/alexcrichton", "html_url": "https://github.com/alexcrichton", "followers_url": "https://api.github.com/users/alexcrichton/followers", "following_url": "https://api.github.com/users/alexcrichton/following{/other_user}", "gists_url": "https://api.github.com/users/alexcrichton/gists{/gist_id}", "starred_url": "https://api.github.com/users/alexcrichton/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/alexcrichton/subscriptions", "organizations_url": "https://api.github.com/users/alexcrichton/orgs", "repos_url": "https://api.github.com/users/alexcrichton/repos", "events_url": "https://api.github.com/users/alexcrichton/events{/privacy}", "received_events_url": "https://api.github.com/users/alexcrichton/received_events", "type": "User", "site_admin": false}, "reactions": {"url": "https://api.github.com/repos/rust-lang/rust/issues/8746/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rust-lang/rust/issues/8746/timeline", "performed_via_github_app": null, "state_reason": "completed"}