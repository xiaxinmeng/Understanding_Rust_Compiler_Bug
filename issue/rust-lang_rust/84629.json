{"url": "https://api.github.com/repos/rust-lang/rust/issues/84629", "repository_url": "https://api.github.com/repos/rust-lang/rust", "labels_url": "https://api.github.com/repos/rust-lang/rust/issues/84629/labels{/name}", "comments_url": "https://api.github.com/repos/rust-lang/rust/issues/84629/comments", "events_url": "https://api.github.com/repos/rust-lang/rust/issues/84629/events", "html_url": "https://github.com/rust-lang/rust/issues/84629", "id": 869246029, "node_id": "MDU6SXNzdWU4NjkyNDYwMjk=", "number": 84629, "title": "cfg(test) is not set during integration tests", "user": {"login": "Timmmm", "id": 376842, "node_id": "MDQ6VXNlcjM3Njg0Mg==", "avatar_url": "https://avatars.githubusercontent.com/u/376842?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Timmmm", "html_url": "https://github.com/Timmmm", "followers_url": "https://api.github.com/users/Timmmm/followers", "following_url": "https://api.github.com/users/Timmmm/following{/other_user}", "gists_url": "https://api.github.com/users/Timmmm/gists{/gist_id}", "starred_url": "https://api.github.com/users/Timmmm/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Timmmm/subscriptions", "organizations_url": "https://api.github.com/users/Timmmm/orgs", "repos_url": "https://api.github.com/users/Timmmm/repos", "events_url": "https://api.github.com/users/Timmmm/events{/privacy}", "received_events_url": "https://api.github.com/users/Timmmm/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 650731663, "node_id": "MDU6TGFiZWw2NTA3MzE2NjM=", "url": "https://api.github.com/repos/rust-lang/rust/labels/C-bug", "name": "C-bug", "color": "f5f1fd", "default": false, "description": "Category: This is a bug."}], "state": "open", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 5, "created_at": "2021-04-27T20:40:54Z", "updated_at": "2023-02-13T13:12:28Z", "closed_at": null, "author_association": "CONTRIBUTOR", "active_lock_reason": null, "body": "`#[cfg(test)]` is not set when running [integration tests](https://doc.rust-lang.org/book/ch11-03-test-organization.html#integration-tests). That page says:\r\n\r\n> [Integration tests] use your library in the same way any other code would, which means they can only call functions that are part of your library\u2019s public API.\r\n\r\nBut that sounds to me more like it's talking about `pub`, `pub(crate)` and so on.\r\n\r\nThere's [an unsatisfying workaround](https://stackoverflow.com/a/47698997/265521) but it would be a lot simpler if `#[cfg(test)]` was simply enabled for integration tests. ([Here's another person tripping up on this.](https://users.rust-lang.org/t/cfg-test-does-not-work-with-integration-tests/36630))\r\n\r\nThe only reason not to do that seems to be a philosophical objection to using hidden APIs in integration tests. I don't agree with that. I'm sure others don't. But even if you subscribe to that philosophy you can simply not use the `#[cfg(test)]` functions in your integration tests (or don't export them). The situation for people who don't subscribe to that philosophy is much more awkward.\r\n\r\nChanging this behaviour would also fix #45599.", "closed_by": null, "reactions": {"url": "https://api.github.com/repos/rust-lang/rust/issues/84629/reactions", "total_count": 12, "+1": 10, "-1": 2, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rust-lang/rust/issues/84629/timeline", "performed_via_github_app": null, "state_reason": null}