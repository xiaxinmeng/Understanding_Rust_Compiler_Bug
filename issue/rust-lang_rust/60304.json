{"url": "https://api.github.com/repos/rust-lang/rust/issues/60304", "repository_url": "https://api.github.com/repos/rust-lang/rust", "labels_url": "https://api.github.com/repos/rust-lang/rust/issues/60304/labels{/name}", "comments_url": "https://api.github.com/repos/rust-lang/rust/issues/60304/comments", "events_url": "https://api.github.com/repos/rust-lang/rust/issues/60304/events", "html_url": "https://github.com/rust-lang/rust/issues/60304", "id": 437639954, "node_id": "MDU6SXNzdWU0Mzc2Mzk5NTQ=", "number": 60304, "title": "Display original source location for doc test failures", "user": {"login": "phrohdoh", "id": 4861023, "node_id": "MDQ6VXNlcjQ4NjEwMjM=", "avatar_url": "https://avatars.githubusercontent.com/u/4861023?v=4", "gravatar_id": "", "url": "https://api.github.com/users/phrohdoh", "html_url": "https://github.com/phrohdoh", "followers_url": "https://api.github.com/users/phrohdoh/followers", "following_url": "https://api.github.com/users/phrohdoh/following{/other_user}", "gists_url": "https://api.github.com/users/phrohdoh/gists{/gist_id}", "starred_url": "https://api.github.com/users/phrohdoh/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/phrohdoh/subscriptions", "organizations_url": "https://api.github.com/users/phrohdoh/orgs", "repos_url": "https://api.github.com/users/phrohdoh/repos", "events_url": "https://api.github.com/users/phrohdoh/events{/privacy}", "received_events_url": "https://api.github.com/users/phrohdoh/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 203738, "node_id": "MDU6TGFiZWwyMDM3Mzg=", "url": "https://api.github.com/repos/rust-lang/rust/labels/T-rustdoc", "name": "T-rustdoc", "color": "bfd4f2", "default": false, "description": "Relevant to the rustdoc team, which will review and decide on the PR/issue."}, {"id": 234902, "node_id": "MDU6TGFiZWwyMzQ5MDI=", "url": "https://api.github.com/repos/rust-lang/rust/labels/C-enhancement", "name": "C-enhancement", "color": "f5f1fd", "default": false, "description": "Category: An issue proposing an enhancement or a PR with one."}, {"id": 1118559391, "node_id": "MDU6TGFiZWwxMTE4NTU5Mzkx", "url": "https://api.github.com/repos/rust-lang/rust/labels/A-doctests", "name": "A-doctests", "color": "f7e101", "default": false, "description": "Area: Documentation tests, run by rustdoc"}, {"id": 1359848690, "node_id": "MDU6TGFiZWwxMzU5ODQ4Njkw", "url": "https://api.github.com/repos/rust-lang/rust/labels/E-needs-mcve", "name": "E-needs-mcve", "color": "02e10c", "default": false, "description": "Call for participation: This issue needs a Minimal Complete and Verifiable Example"}], "state": "open", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 3, "created_at": "2019-04-26T12:02:10Z", "updated_at": "2021-01-26T17:10:10Z", "closed_at": null, "author_association": "NONE", "active_lock_reason": null, "body": "I have the following file:\r\n\r\n```rust\r\n// This Source Code Form is subject to the terms of the Mozilla Public\r\n// License, v. 2.0. If a copy of the MPL was not distributed with this\r\n// file, You can obtain one at http://mozilla.org/MPL/2.0/.\r\n\r\nuse oraide_parser_miniyaml::{\r\n    ParserCtxExt,\r\n    ParserCtxStorage,\r\n};\r\n\r\n/// Entrypoint into MiniYaml parsing\r\n///\r\n/// Contains inputs and memoized computation results\r\n///\r\n/// # Example\r\n/// ```rust\r\n/// use oraide_parser_miniyaml::{Database,ParserCtx,ParserCtxExt,Tree};\r\n/// let mut db = Database::default();\r\n/// let file_id = db.add_file(\"example.yaml\", \"Hello:\\n\");\r\n/// let tree: Tree = db.file_tree(file_id);\r\n/// ```\r\n#[salsa::database(ParserCtxStorage)]\r\npub struct Database {\r\n    rt: salsa::Runtime<Self>,\r\n}\r\n```\r\n\r\nWhen I run `cargo test` for this package I get the following, valid, failure:\r\n\r\n```\r\nfailures:\r\n\r\n---- src/lib.rs - Database (line 6) stdout ----\r\nerror[E0432]: unresolved import `oraide_parser_miniyaml::Database`\r\n --> src/lib.rs:7:30\r\n  |\r\n3 | use oraide_parser_miniyaml::{Database,ParserCtx,ParserCtxExt,Tree};\r\n  |                              ^^^^^^^^ no `Database` in the root\r\n\r\nthread 'src/lib.rs - Database (line 6)' panicked at 'couldn't compile the test', src/librustdoc/test.rs:354:13\r\nnote: Run with `RUST_BACKTRACE=1` environment variable to display a backtrace.\r\n```\r\n\r\nUnfortunately the reported error location is from the generated (I assume) code that is actually tested and not the correct location in the original source.\r\n\r\nIt is indeed the 7th line in the doc but that isn't as helpful as it could be.\r\n\r\nIdeally I would see `src/lib.rs:16:30`.\r\n\r\nMapping these locations back to original source location would, IMO, be more useful because we could then see exactly where doc tests are failing (especially in a file with many doc tests) and, in some environments, can ctrl/cmd-click the `src/lib.rs:X:Y` output to take our editor directly to the failure.", "closed_by": null, "reactions": {"url": "https://api.github.com/repos/rust-lang/rust/issues/60304/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rust-lang/rust/issues/60304/timeline", "performed_via_github_app": null, "state_reason": null}