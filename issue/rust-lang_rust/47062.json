{"url": "https://api.github.com/repos/rust-lang/rust/issues/47062", "repository_url": "https://api.github.com/repos/rust-lang/rust", "labels_url": "https://api.github.com/repos/rust-lang/rust/issues/47062/labels{/name}", "comments_url": "https://api.github.com/repos/rust-lang/rust/issues/47062/comments", "events_url": "https://api.github.com/repos/rust-lang/rust/issues/47062/events", "html_url": "https://github.com/rust-lang/rust/issues/47062", "id": 285114586, "node_id": "MDU6SXNzdWUyODUxMTQ1ODY=", "number": 47062, "title": "Performance regression with nightly benchmarks.", "user": {"login": "pitdicker", "id": 6255050, "node_id": "MDQ6VXNlcjYyNTUwNTA=", "avatar_url": "https://avatars.githubusercontent.com/u/6255050?v=4", "gravatar_id": "", "url": "https://api.github.com/users/pitdicker", "html_url": "https://github.com/pitdicker", "followers_url": "https://api.github.com/users/pitdicker/followers", "following_url": "https://api.github.com/users/pitdicker/following{/other_user}", "gists_url": "https://api.github.com/users/pitdicker/gists{/gist_id}", "starred_url": "https://api.github.com/users/pitdicker/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/pitdicker/subscriptions", "organizations_url": "https://api.github.com/users/pitdicker/orgs", "repos_url": "https://api.github.com/users/pitdicker/repos", "events_url": "https://api.github.com/users/pitdicker/events{/privacy}", "received_events_url": "https://api.github.com/users/pitdicker/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 113376, "node_id": "MDU6TGFiZWwxMTMzNzY=", "url": "https://api.github.com/repos/rust-lang/rust/labels/I-slow", "name": "I-slow", "color": "e10c02", "default": false, "description": "Problems and improvements with respect to performance of generated code."}, {"id": 203429200, "node_id": "MDU6TGFiZWwyMDM0MjkyMDA=", "url": "https://api.github.com/repos/rust-lang/rust/labels/P-high", "name": "P-high", "color": "eb6420", "default": false, "description": "High priority"}, {"id": 211668100, "node_id": "MDU6TGFiZWwyMTE2NjgxMDA=", "url": "https://api.github.com/repos/rust-lang/rust/labels/T-compiler", "name": "T-compiler", "color": "bfd4f2", "default": false, "description": "Relevant to the compiler team, which will review and decide on the PR/issue."}, {"id": 262252628, "node_id": "MDU6TGFiZWwyNjIyNTI2Mjg=", "url": "https://api.github.com/repos/rust-lang/rust/labels/regression-from-stable-to-beta", "name": "regression-from-stable-to-beta", "color": "e4008a", "default": false, "description": "Performance or correctness regression from stable to beta."}, {"id": 650731663, "node_id": "MDU6TGFiZWw2NTA3MzE2NjM=", "url": "https://api.github.com/repos/rust-lang/rust/labels/C-bug", "name": "C-bug", "color": "f5f1fd", "default": false, "description": "Category: This is a bug."}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": {"url": "https://api.github.com/repos/rust-lang/rust/milestones/41", "html_url": "https://github.com/rust-lang/rust/milestone/41", "labels_url": "https://api.github.com/repos/rust-lang/rust/milestones/41/labels", "id": 2913233, "node_id": "MDk6TWlsZXN0b25lMjkxMzIzMw==", "number": 41, "title": "1.24", "description": "", "creator": {"login": "Mark-Simulacrum", "id": 5047365, "node_id": "MDQ6VXNlcjUwNDczNjU=", "avatar_url": "https://avatars.githubusercontent.com/u/5047365?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Mark-Simulacrum", "html_url": "https://github.com/Mark-Simulacrum", "followers_url": "https://api.github.com/users/Mark-Simulacrum/followers", "following_url": "https://api.github.com/users/Mark-Simulacrum/following{/other_user}", "gists_url": "https://api.github.com/users/Mark-Simulacrum/gists{/gist_id}", "starred_url": "https://api.github.com/users/Mark-Simulacrum/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Mark-Simulacrum/subscriptions", "organizations_url": "https://api.github.com/users/Mark-Simulacrum/orgs", "repos_url": "https://api.github.com/users/Mark-Simulacrum/repos", "events_url": "https://api.github.com/users/Mark-Simulacrum/events{/privacy}", "received_events_url": "https://api.github.com/users/Mark-Simulacrum/received_events", "type": "User", "site_admin": false}, "open_issues": 0, "closed_issues": 18, "state": "closed", "created_at": "2017-11-15T01:41:05Z", "updated_at": "2020-06-16T05:10:40Z", "due_on": "2018-02-15T08:00:00Z", "closed_at": "2018-02-19T01:32:45Z"}, "comments": 17, "created_at": "2017-12-29T15:54:01Z", "updated_at": "2018-01-25T19:59:49Z", "closed_at": "2018-01-25T15:43:45Z", "author_association": "CONTRIBUTOR", "active_lock_reason": null, "body": "The benchmarks for `rand` and for my crate [`small-rngs`](https://github.com/pitdicker/small-rngs) have regressed a lot with recent nightlies. A few extra branches are introduced at the end of the benchmark loop.\r\n\r\nRelevant assembly with nightly 0077d128d 2017-12-14:\r\n```\r\n       \u2502     \u2192 callq  std::time::Instant::now\r\n       \u2502       xor    %r8d,%r8d\r\n       \u2502       lea    0xb0(%rsp),%rdi\r\n       \u2502       lea    0x8(%rsp),%rcx\r\n       \u2502       nop\r\n       \u25024b0:   mov    $0x3e8,%esi\r\n       \u2502       data16 nopw %cs:0x0(%rax,%rax,1)\r\n 22,85 \u25024c0:   mov    %rbp,%rax\r\n  8,48 \u2502       mul    %r13\r\n       \u2502       xor    %rbp,%r14\r\n  1,01 \u2502       rol    $0x37,%rbp\r\n       \u2502       mov    %rbp,%rbx\r\n 23,14 \u2502       xor    %r14,%rbx\r\n       \u2502       mov    %r14,%rbp\r\n  1,29 \u2502       shl    $0xe,%rbp\r\n  2,06 \u2502       xor    %rbx,%rbp\r\n 20,55 \u2502       rol    $0x24,%r14\r\n  0,05 \u2502       shld   $0x20,%rax,%rdx\r\n  1,36 \u2502       mov    %rdx,0x8(%rsp)\r\n  3,13 \u2502       dec    %rsi\r\n       \u2502     \u2191 jne    4c0\r\n  0,03 \u2502       inc    %r8\r\n  0,02 \u2502       cmp    %r12,%r8\r\n       \u2502     \u2191 jne    4b0\r\n       \u2502       mov    %r15,%rsi\r\n       \u2502     \u2192 callq  std::time::Instant::elapsed\r\n```\r\n\r\nWith nightly 77efd6800 2017-12-15:\r\n```\r\n       \u2502     \u2192 callq  std::time::Instant::now\r\n       \u2502       mov    %rax,0x10(%rsp)\r\n       \u2502       mov    %rdx,0x18(%rsp)\r\n       \u2502       xor    %eax,%eax\r\n       \u2502       movabs $0x2545f4914f6cdd1d,%r9\r\n       \u2502       mov    %rsp,%r10\r\n       \u2502       cmp    %r14,%rax\r\n       \u2502     \u2193 jb     48\r\n       \u2502     \u2193 jmp    51\r\n       \u2502       data16 data16 nopw %cs:0x0(%rax,%rax,1)\r\n       \u2502 40:   mov    %r8,%rax\r\n       \u2502       cmp    %r14,%rax\r\n       \u2502     \u2193 jae    51\r\n  0,02 \u2502 48:   mov    %rax,%r8\r\n       \u2502       add    $0x1,%r8\r\n       \u2502     \u2193 jae    60\r\n       \u2502 51:   mov    %rax,%r8\r\n       \u2502       xor    %ecx,%ecx\r\n       \u2502       xor    %eax,%eax\r\n       \u2502     \u2193 jmp    6d\r\n       \u2502       nop\r\n       \u2502 60:   movq   $0x1,(%rsp)\r\n       \u2502       mov    $0x1,%ecx\r\n  0,02 \u2502 6d:   mov    %rax,(%rsp,%rcx,8)\r\n  0,01 \u2502       cmpq   $0x1,(%rsp)\r\n       \u2502     \u2193 jne    10d\r\n       \u2502       xor    %eax,%eax\r\n       \u2502       cmp    $0x3e7,%rax\r\n       \u2502     \u2193 jbe    d3\r\n       \u2502     \u2193 jmp    dc\r\n       \u2502       nop\r\n  0,00 \u2502 90:   mov    (%r15),%rdi\r\n  9,24 \u2502       mov    (%rdi),%rcx\r\n       \u2502       mov    %rcx,%rax\r\n  9,94 \u2502       mul    %r9\r\n  0,00 \u2502       mov    0x8(%rdi),%rsi\r\n  0,84 \u2502       xor    %rcx,%rsi\r\n  0,01 \u2502       rol    $0x37,%rcx\r\n 14,55 \u2502       xor    %rsi,%rcx\r\n       \u2502       mov    %rsi,%rbx\r\n  1,64 \u2502       shl    $0xe,%rbx\r\n  6,80 \u2502       xor    %rcx,%rbx\r\n  6,76 \u2502       mov    %rbx,(%rdi)\r\n  0,07 \u2502       rol    $0x24,%rsi\r\n  5,16 \u2502       mov    %rsi,0x8(%rdi)\r\n  0,22 \u2502       shld   $0x20,%rax,%rdx\r\n  6,97 \u2502       mov    %rdx,(%rsp)\r\n       \u2502       mov    %r11,%rax\r\n  5,33 \u2502       cmp    $0x3e7,%rax\r\n       \u2502     \u2193 ja     dc\r\n       \u2502 d3:   mov    %rax,%r11\r\n 13,70 \u2502       add    $0x1,%r11\r\n       \u2502     \u2193 jae    f0\r\n       \u2502 dc:   mov    %rax,%r11\r\n  0,02 \u2502       xor    %ecx,%ecx\r\n       \u2502       xor    %eax,%eax\r\n  0,01 \u2502     \u2193 jmp    fd\r\n       \u2502       data16 nopw %cs:0x0(%rax,%rax,1)\r\n       \u2502 f0:   movq   $0x1,(%rsp)\r\n  6,77 \u2502       mov    $0x1,%ecx\r\n  8,61 \u2502 fd:   mov    %rax,(%rsp,%rcx,8)\r\n  0,13 \u2502       cmpq   $0x1,(%rsp)\r\n  3,19 \u2502     \u2191 je     90\r\n       \u2502     \u2191 jmpq   40\r\n       \u250210d:   lea    0x10(%rsp),%rdi\r\n       \u2502     \u2192 callq  std::time::Instant::elapsed\r\n```", "closed_by": {"login": "eddyb", "id": 77424, "node_id": "MDQ6VXNlcjc3NDI0", "avatar_url": "https://avatars.githubusercontent.com/u/77424?v=4", "gravatar_id": "", "url": "https://api.github.com/users/eddyb", "html_url": "https://github.com/eddyb", "followers_url": "https://api.github.com/users/eddyb/followers", "following_url": "https://api.github.com/users/eddyb/following{/other_user}", "gists_url": "https://api.github.com/users/eddyb/gists{/gist_id}", "starred_url": "https://api.github.com/users/eddyb/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/eddyb/subscriptions", "organizations_url": "https://api.github.com/users/eddyb/orgs", "repos_url": "https://api.github.com/users/eddyb/repos", "events_url": "https://api.github.com/users/eddyb/events{/privacy}", "received_events_url": "https://api.github.com/users/eddyb/received_events", "type": "User", "site_admin": false}, "reactions": {"url": "https://api.github.com/repos/rust-lang/rust/issues/47062/reactions", "total_count": 1, "+1": 1, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rust-lang/rust/issues/47062/timeline", "performed_via_github_app": null, "state_reason": "completed"}