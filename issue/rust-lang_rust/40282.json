{"url": "https://api.github.com/repos/rust-lang/rust/issues/40282", "repository_url": "https://api.github.com/repos/rust-lang/rust", "labels_url": "https://api.github.com/repos/rust-lang/rust/issues/40282/labels{/name}", "comments_url": "https://api.github.com/repos/rust-lang/rust/issues/40282/comments", "events_url": "https://api.github.com/repos/rust-lang/rust/issues/40282/events", "html_url": "https://github.com/rust-lang/rust/issues/40282", "id": 211987114, "node_id": "MDU6SXNzdWUyMTE5ODcxMTQ=", "number": 40282, "title": "ICE on Windows: \"incorrect function\"", "user": {"login": "icylogic", "id": 2814357, "node_id": "MDQ6VXNlcjI4MTQzNTc=", "avatar_url": "https://avatars.githubusercontent.com/u/2814357?v=4", "gravatar_id": "", "url": "https://api.github.com/users/icylogic", "html_url": "https://github.com/icylogic", "followers_url": "https://api.github.com/users/icylogic/followers", "following_url": "https://api.github.com/users/icylogic/following{/other_user}", "gists_url": "https://api.github.com/users/icylogic/gists{/gist_id}", "starred_url": "https://api.github.com/users/icylogic/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/icylogic/subscriptions", "organizations_url": "https://api.github.com/users/icylogic/orgs", "repos_url": "https://api.github.com/users/icylogic/repos", "events_url": "https://api.github.com/users/icylogic/events{/privacy}", "received_events_url": "https://api.github.com/users/icylogic/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 123109, "node_id": "MDU6TGFiZWwxMjMxMDk=", "url": "https://api.github.com/repos/rust-lang/rust/labels/O-windows", "name": "O-windows", "color": "6e6ec0", "default": false, "description": "Operating system: Windows"}, {"id": 9618520, "node_id": "MDU6TGFiZWw5NjE4NTIw", "url": "https://api.github.com/repos/rust-lang/rust/labels/I-ICE", "name": "I-ICE", "color": "e10c02", "default": false, "description": "Issue: The compiler panicked, giving an Internal Compilation Error (ICE) \u2744\ufe0f"}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 9, "created_at": "2017-03-05T21:45:45Z", "updated_at": "2021-09-06T11:12:40Z", "closed_at": "2017-05-27T11:02:17Z", "author_association": "NONE", "active_lock_reason": null, "body": "It happens when I try to install xargo via `cargo install xargo`, but it's an internel compiler error so I think it should be reported here. I've searched for the error message \"incorrect function\", but there is no relevant issue. (#31178 seems to be related to VirtualBox)\r\n\r\n## Logs (with RUST_BACKTRACE=full)\r\n\r\nIf I run this command multiple times, the panic happens randomly on different packages.\r\n\r\nFailed on dbghelp-sys\r\n\r\n```\r\nD:\\Temp\\empty_dir>cargo install xargo\r\n    Updating registry `https://github.com/rust-lang/crates.io-index`\r\n  Installing xargo v0.3.5\r\n   Compiling winapi-build v0.1.1\r\n   Compiling gcc v0.3.43\r\n   Compiling libc v0.2.21\r\n   Compiling xargo v0.3.5\r\n   Compiling backtrace v0.3.0\r\n   Compiling dbghelp-sys v0.2.0\r\n   Compiling dtoa v0.2.2\r\nerror: internal compiler error: unexpected panic\r\n\r\n   Compiling semver v0.1.20\r\nnote: the compiler unexpectedly panicked. this is a bug.\r\n\r\nnote: we would appreciate a bug report: https://github.com/rust-lang/rust/blob/master/CONTRIBUTING.md#bug-reports\r\n\r\nnote: run with `RUST_BACKTRACE=1` for a backtrace\r\n\r\nthread 'rustc' panicked at 'called `Result::unwrap()` on an `Err` value: Error { repr: Os { code: 1, message: \"Incorrect function.\" } }', src\\libcore\\result.rs:860\r\nstack backtrace:\r\n   0:     0x7ff869012a1f - <std::time::SystemTimeError as core::fmt::Display>::fmt::h4979473f9576d1ed\r\n   1:     0x7ff869024bcc - std::panicking::Location::line::h170804a3d9d5008a\r\n   2:     0x7ff86902440d - std::panicking::Location::line::h170804a3d9d5008a\r\n   3:     0x7ff8690250f1 - std::panicking::rust_panic_with_hook::h616f04586b77efa9\r\n   4:     0x7ff869024fa8 - std::panicking::begin_panic_fmt::h028887a0b806a12e\r\n   5:     0x7ff869024ec4 - std::panicking::begin_panic_fmt::h028887a0b806a12e\r\n   6:     0x7ff869024e59 - rust_begin_unwind\r\n   7:     0x7ff8690372e7 - core::panicking::panic_fmt::h9303d733b4241e2b\r\n   8:     0x7ff874292568 - <unknown>\r\n   9:     0x7ff87433f0af - rustc_metadata::locator::Context::report_errs::hda477d168a30f72f\r\n  10:     0x7ff87432c071 - rustc_metadata::creader::CrateLoader::new::h7bf5da15849ecfc2\r\n  11:     0x7ff87432a628 - rustc_metadata::creader::CrateLoader::new::h7bf5da15849ecfc2\r\n  12:     0x7ff874333f26 - <rustc_metadata::creader::CrateLoader<'a> as rustc::middle::cstore::CrateLoader>::process_item::h258b2b401f5a9188\r\n  13:     0x7ff87e256c7e - rustc_resolve::build_reduced_graph::<impl rustc_resolve::ToNameBinding<'a> for (rustc::hir::def::Def, rustc::ty::Visibility, syntax_pos::Span, syntax::ext::hygiene::Mark)>::to_name_binding::hf7964fb6f9d14b15\r\n  14:     0x7ff87e25e5b3 - <rustc_resolve::build_reduced_graph::BuildReducedGraphVisitor<'a, 'b> as syntax::visit::Visitor<'a>>::visit_item::h70066d7c3e0a55b2\r\n  15:     0x7ff87e25e80e - <rustc_resolve::build_reduced_graph::BuildReducedGraphVisitor<'a, 'b> as syntax::visit::Visitor<'a>>::visit_item::h70066d7c3e0a55b2\r\n  16:     0x7ff87e24e68f - rustc_resolve::macros::<impl syntax::ext::base::Resolver for rustc_resolve::Resolver<'a>>::visit_expansion::h529069ee8f38fea8\r\n  17:     0x7ff85cfb400f - syntax::ext::expand::MacroExpander::expand_crate::h9c2ada897f8517ae\r\n  18:     0x7ff85cfad460 - syntax::ext::expand::MacroExpander::expand_crate::h9c2ada897f8517ae\r\n  19:     0x7ff85cfaccaa - syntax::ext::expand::MacroExpander::expand_crate::h9c2ada897f8517ae\r\n  20:     0x7ff879b6675f - rustc_driver::driver::count_nodes::h6cb58d80fe92ca42\r\n  21:     0x7ff879b5af72 - rustc_driver::driver::count_nodes::h6cb58d80fe92ca42\r\n  22:     0x7ff879b51e36 - rustc_driver::driver::compile_input::ha02e227e35183dfd\r\n  23:     0x7ff879bb3cd8 - rustc_driver::run_compiler::h4601882a3e07ab36\r\n  24:     0x7ff879aa9e5e - <unknown>\r\n  25:     0x7ff869028261 - _rust_maybe_catch_panic\r\n  26:     0x7ff879acb2b6 - <unknown>\r\n  27:     0x7ff86902244e - std::sys::imp::thread::Thread::new::hf457da10939bdcb7\r\n  28:     0x7ff8a5358363 - BaseThreadInitThunk\r\n\r\nerror: Could not compile `dbghelp-sys`.\r\nBuild failed, waiting for other jobs to finish...\r\nerror: failed to compile `xargo v0.3.5`, intermediate artifacts can be found at `R:\\Temp\\cargo-install.qv3ogdZnww8r`\r\n\r\nCaused by:\r\n  build failed\r\n```\r\n\r\nFailed on `rustc_version`\r\n```\r\nD:\\Temp\\empty_dir>cargo install xargo\r\n    Updating registry `https://github.com/rust-lang/crates.io-index`\r\n  Installing xargo v0.3.5\r\n   Compiling backtrace v0.3.0\r\n   Compiling rustc-serialize v0.3.22\r\n   Compiling itoa v0.1.1\r\n   Compiling serde v0.8.23\r\n   Compiling rustc-demangle v0.1.4\r\n   Compiling semver v0.1.20\r\n   Compiling num-traits v0.1.37\r\n   Compiling rustc_version v0.1.7\r\n   Compiling winapi v0.2.8\r\nerror: internal compiler error: unexpected panic\r\n\r\nnote: the compiler unexpectedly panicked. this is a bug.\r\n\r\nnote: we would appreciate a bug report: https://github.com/rust-lang/rust/blob/master/CONTRIBUTING.md#bug-reports\r\n\r\nnote: run with `RUST_BACKTRACE=1` for a backtrace\r\n\r\nthread 'rustc' panicked at 'called `Result::unwrap()` on an `Err` value: Error { repr: Os { code: 1, message: \"Incorrect function.\" } }', src\\libcore\\result.rs:860\r\nstack backtrace:\r\n   0:     0x7ff869012a1f - <std::time::SystemTimeError as core::fmt::Display>::fmt::h4979473f9576d1ed\r\n   1:     0x7ff869024bcc - std::panicking::Location::line::h170804a3d9d5008a\r\n   2:     0x7ff86902440d - std::panicking::Location::line::h170804a3d9d5008a\r\n   3:     0x7ff8690250f1 - std::panicking::rust_panic_with_hook::h616f04586b77efa9\r\n   4:     0x7ff869024fa8 - std::panicking::begin_panic_fmt::h028887a0b806a12e\r\n   5:     0x7ff869024ec4 - std::panicking::begin_panic_fmt::h028887a0b806a12e\r\n   6:     0x7ff869024e59 - rust_begin_unwind\r\n   7:     0x7ff8690372e7 - core::panicking::panic_fmt::h9303d733b4241e2b\r\n   8:     0x7ff868c12568 - <unknown>\r\n   9:     0x7ff868cbf0af - rustc_metadata::locator::Context::report_errs::hda477d168a30f72f\r\n  10:     0x7ff868cac071 - rustc_metadata::creader::CrateLoader::new::h7bf5da15849ecfc2\r\n  11:     0x7ff868caa628 - rustc_metadata::creader::CrateLoader::new::h7bf5da15849ecfc2\r\n  12:     0x7ff868cb3f26 - <rustc_metadata::creader::CrateLoader<'a> as rustc::middle::cstore::CrateLoader>::process_item::h258b2b401f5a9188\r\n  13:     0x7ff87e0c6c7e - rustc_resolve::build_reduced_graph::<impl rustc_resolve::ToNameBinding<'a> for (rustc::hir::def::Def, rustc::ty::Visibility, syntax_pos::Span, syntax::ext::hygiene::Mark)>::to_name_binding::hf7964fb6f9d14b15\r\n  14:     0x7ff87e0ce5b3 - <rustc_resolve::build_reduced_graph::BuildReducedGraphVisitor<'a, 'b> as syntax::visit::Visitor<'a>>::visit_item::h70066d7c3e0a55b2\r\n  15:     0x7ff87e0ce80e - <rustc_resolve::build_reduced_graph::BuildReducedGraphVisitor<'a, 'b> as syntax::visit::Visitor<'a>>::visit_item::h70066d7c3e0a55b2\r\n  16:     0x7ff87e0be68f - rustc_resolve::macros::<impl syntax::ext::base::Resolver for rustc_resolve::Resolver<'a>>::visit_expansion::h529069ee8f38fea8\r\n  17:     0x7ff863b1400f - syntax::ext::expand::MacroExpander::expand_crate::h9c2ada897f8517ae\r\n  18:     0x7ff863b0d460 - syntax::ext::expand::MacroExpander::expand_crate::h9c2ada897f8517ae\r\n  19:     0x7ff863b0ccaa - syntax::ext::expand::MacroExpander::expand_crate::h9c2ada897f8517ae\r\n  20:     0x7ff8742b675f - rustc_driver::driver::count_nodes::h6cb58d80fe92ca42\r\n  21:     0x7ff8742aaf72 - rustc_driver::driver::count_nodes::h6cb58d80fe92ca42\r\n  22:     0x7ff8742a1e36 - rustc_driver::driver::compile_input::ha02e227e35183dfd\r\n  23:     0x7ff874303cd8 - rustc_driver::run_compiler::h4601882a3e07ab36\r\n  24:     0x7ff8741f9e5e - <unknown>\r\n  25:     0x7ff869028261 - _rust_maybe_catch_panic\r\n  26:     0x7ff87421b2b6 - <unknown>\r\n  27:     0x7ff86902244e - std::sys::imp::thread::Thread::new::hf457da10939bdcb7\r\n  28:     0x7ff8a5358363 - BaseThreadInitThunk\r\n\r\nerror: Could not compile `rustc_version`.\r\nBuild failed, waiting for other jobs to finish...\r\nerror: failed to compile `xargo v0.3.5`, intermediate artifacts can be found at `R:\\Temp\\cargo-install.udJV5z3WDfuT`\r\n\r\nCaused by:\r\n  build failed\r\n```\r\n\r\n## Details\r\n\r\n- rustc version:\r\n  ```\r\n  rustc 1.17.0-nightly (691eba135 2017-03-01)\r\n  binary: rustc\r\n  commit-hash: 691eba1358fc3c9c7a8033314a4112d43680c128\r\n  commit-date: 2017-03-01 \r\n  host: x86_64-pc-windows-msvc\r\n  release: 1.17.0-nightly\r\n  LLVM version: 3.9\r\n  ```\r\n\r\n- The toolchain  `stable-x86_64-pc-windows-msvc (rustc 1.15.1)`, `nightly-x86_64-pc-windows-gnu` does not work either.\r\n- It also failed on `rand` and other packages.\r\n- When `RUST_LOG` is set to `debug`, the output has 618563 lines and i could not found any helpful information  different from the backtrace.\r\n- I've tried a different binary package from Cargo like gcc and it is installed without problem.\r\n- I've also managed to clone `rustc-version` from the repo (https://github.com/Kimundi/rustc-version-rs/tree/v0.1.7) and dbghelp-sys from the repo (https://github.com/retep998/winapi-rs) and build them using `cargo build`, `cargo build --release`. \r\n- The command runs successfully on Linux\r\n  ```\r\n  rustc 1.17.0-nightly (691eba135 2017-03-01)\r\n  binary: rustc\r\n  commit-hash: 691eba1358fc3c9c7a8033314a4112d43680c128\r\n  commit-date: 2017-03-01\r\n  host: x86_64-unknown-linux-gnu\r\n  release: 1.17.0-nightly\r\n  LLVM version: 3.9\r\n  ```\r\n", "closed_by": {"login": "Mark-Simulacrum", "id": 5047365, "node_id": "MDQ6VXNlcjUwNDczNjU=", "avatar_url": "https://avatars.githubusercontent.com/u/5047365?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Mark-Simulacrum", "html_url": "https://github.com/Mark-Simulacrum", "followers_url": "https://api.github.com/users/Mark-Simulacrum/followers", "following_url": "https://api.github.com/users/Mark-Simulacrum/following{/other_user}", "gists_url": "https://api.github.com/users/Mark-Simulacrum/gists{/gist_id}", "starred_url": "https://api.github.com/users/Mark-Simulacrum/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Mark-Simulacrum/subscriptions", "organizations_url": "https://api.github.com/users/Mark-Simulacrum/orgs", "repos_url": "https://api.github.com/users/Mark-Simulacrum/repos", "events_url": "https://api.github.com/users/Mark-Simulacrum/events{/privacy}", "received_events_url": "https://api.github.com/users/Mark-Simulacrum/received_events", "type": "User", "site_admin": false}, "reactions": {"url": "https://api.github.com/repos/rust-lang/rust/issues/40282/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rust-lang/rust/issues/40282/timeline", "performed_via_github_app": null, "state_reason": "completed"}