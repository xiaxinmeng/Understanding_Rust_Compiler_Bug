{"url": "https://api.github.com/repos/rust-lang/rust/issues/7348", "repository_url": "https://api.github.com/repos/rust-lang/rust", "labels_url": "https://api.github.com/repos/rust-lang/rust/issues/7348/labels{/name}", "comments_url": "https://api.github.com/repos/rust-lang/rust/issues/7348/comments", "events_url": "https://api.github.com/repos/rust-lang/rust/issues/7348/events", "html_url": "https://github.com/rust-lang/rust/issues/7348", "id": 15928917, "node_id": "MDU6SXNzdWUxNTkyODkxNw==", "number": 7348, "title": "Rustpkg doesn't expand macros in pkg.rs", "user": {"login": "dcolish", "id": 15602, "node_id": "MDQ6VXNlcjE1NjAy", "avatar_url": "https://avatars.githubusercontent.com/u/15602?v=4", "gravatar_id": "", "url": "https://api.github.com/users/dcolish", "html_url": "https://github.com/dcolish", "followers_url": "https://api.github.com/users/dcolish/followers", "following_url": "https://api.github.com/users/dcolish/following{/other_user}", "gists_url": "https://api.github.com/users/dcolish/gists{/gist_id}", "starred_url": "https://api.github.com/users/dcolish/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/dcolish/subscriptions", "organizations_url": "https://api.github.com/users/dcolish/orgs", "repos_url": "https://api.github.com/users/dcolish/repos", "events_url": "https://api.github.com/users/dcolish/events{/privacy}", "received_events_url": "https://api.github.com/users/dcolish/received_events", "type": "User", "site_admin": false}, "labels": [], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 4, "created_at": "2013-06-24T14:55:21Z", "updated_at": "2014-06-16T21:56:22Z", "closed_at": "2013-08-22T04:41:31Z", "author_association": "NONE", "active_lock_reason": null, "body": "With a custom pkg.rs that includes macros, the compiler will fail to expand macros correctly,\n\n```\nWARNING: The Rust package manager is experimental and may be unstable\nrust: task failed at 'attempted to analyze unexpanded stmt', /home/dcolish/workspace/rust/src/libsyntax/ast_util.rs:46\n/home/dcolish/local/rust/trunk/bin/../lib/librustrt.so(_ZN9rust_task13begin_failureEPKcS1_m+0x4b)[0x7f6a19c7405b]\n/home/dcolish/local/rust/trunk/bin/../lib/librustrt.so(+0x2d469)[0x7f6a19c85469]\n/home/dcolish/local/rust/trunk/bin/../lib/librustrt.so(upcall_fail+0x1a0)[0x7f6a19c760f0]\n/home/dcolish/local/rust/trunk/bin/../lib/libstd-6c65cf4b443341b1-0.7-pre.so(_ZN3sys13begin_unwind_16_89e154cd09156716_07preE+0x2e4)[0x7f6a1d3f9554]\n/home/dcolish/local/rust/trunk/bin/../lib/libstd-6c65cf4b443341b1-0.7-pre.so(+0x1166b2)[0x7f6a1d3f96b2]\n/home/dcolish/local/rust/trunk/bin/../lib/libstd-6c65cf4b443341b1-0.7-pre.so(+0x116191)[0x7f6a1d3f9191]\n/home/dcolish/local/rust/trunk/bin/../lib/libstd-6c65cf4b443341b1-0.7-pre.so(+0x11666c)[0x7f6a1d3f966c]\n/home/dcolish/local/rust/trunk/bin/../lib/libstd-6c65cf4b443341b1-0.7-pre.so(+0x116191)[0x7f6a1d3f9191]\n/home/dcolish/local/rust/trunk/bin/../lib/libstd-6c65cf4b443341b1-0.7-pre.so(+0x7d5e4)[0x7f6a1d3605e4]\n/home/dcolish/local/rust/trunk/bin/../lib/libsyntax-9c7e57a146ef6bf1-0.7-pre.so(_ZN7ast_map8map_stmt16_ca2ca8876527a9a6_07preE+0xe0)[0x7f6a1c8ccb10]\n/home/dcolish/local/rust/trunk/bin/../lib/libsyntax-9c7e57a146ef6bf1-0.7-pre.so(+0xe5d45)[0x7f6a1c8d3d45]\n/home/dcolish/local/rust/trunk/bin/../lib/libsyntax-9c7e57a146ef6bf1-0.7-pre.so(_ZN7ast_map9map_block17_8469195a50a296636_07preE+0x25e)[0x7f6a1c8cd50e]\n/home/dcolish/local/rust/trunk/bin/../lib/libsyntax-9c7e57a146ef6bf1-0.7-pre.so(+0xe9640)[0x7f6a1c8d7640]\n/home/dcolish/local/rust/trunk/bin/../lib/libsyntax-9c7e57a146ef6bf1-0.7-pre.so(_ZN7ast_map6map_fn17_67fd9b1b17822b2e6_07preE+0x233)[0x7f6a1c8cd093]\n/home/dcolish/local/rust/trunk/bin/../lib/libsyntax-9c7e57a146ef6bf1-0.7-pre.so(+0xe4727)[0x7f6a1c8d2727]\n/home/dcolish/local/rust/trunk/bin/../lib/libsyntax-9c7e57a146ef6bf1-0.7-pre.so(_ZN7ast_map8map_item17_dbfe9115952df58e6_07preE+0x11de)[0x7f6a1c8cbbce]\n/home/dcolish/local/rust/trunk/bin/../lib/libsyntax-9c7e57a146ef6bf1-0.7-pre.so(+0xe3ae2)[0x7f6a1c8d1ae2]\n/home/dcolish/local/rust/trunk/bin/../lib/libsyntax-9c7e57a146ef6bf1-0.7-pre.so(+0xeac9a)[0x7f6a1c8d8c9a]\n/home/dcolish/local/rust/trunk/bin/../lib/libsyntax-9c7e57a146ef6bf1-0.7-pre.so(_ZN7ast_map9map_crate17_9012abf71977f3fe6_07preE+0x1a5)[0x7f6a1c8d8545]\n/home/dcolish/local/rust/trunk/bin/../lib/librustc-ec14752a4b1d63-0.7-pre.so(+0x8059a0)[0x7f6a1c3019a0]\n/home/dcolish/local/rust/trunk/bin/../lib/librustc-ec14752a4b1d63-0.7-pre.so(+0x805383)[0x7f6a1c301383]\n/home/dcolish/local/rust/trunk/bin/../lib/librustc-ec14752a4b1d63-0.7-pre.so(_ZN6driver6driver12compile_rest15_9174bc134951036_07preE+0xa08)[0x7f6a1c2fea18]\n/home/dcolish/local/rust/trunk/bin/../lib/librustpkg-a039f7e3caed55f-0.7-pre.so(+0x81fc2)[0x7f6a1b8bcfc2]\n/home/dcolish/local/rust/trunk/bin/../lib/librustpkg-a039f7e3caed55f-0.7-pre.so(_ZN14__extensions__10meth_2106010run_custom17_a227f8cd2af32e166_07preE+0xee9)[0x7f6a1b8c7939]\n/home/dcolish/local/rust/trunk/bin/../lib/librustpkg-a039f7e3caed55f-0.7-pre.so(_ZN14__extensions__10meth_211435build17_a05a867e4ad98b906_07preE+0x733)[0x7f6a1b8cb0a3]\n/home/dcolish/local/rust/trunk/bin/../lib/librustpkg-a039f7e3caed55f-0.7-pre.so(+0x8f965)[0x7f6a1b8ca965]\n/home/dcolish/local/rust/trunk/bin/../lib/librustpkg-a039f7e3caed55f-0.7-pre.so(+0x88e1c)[0x7f6a1b8c3e1c]\n/home/dcolish/local/rust/trunk/bin/../lib/librustpkg-a039f7e3caed55f-0.7-pre.so(_ZN14__extensions__10meth_211383run17_2e1266d531cfa8b96_07preE+0x429)[0x7f6a1b8c97f9]\n/home/dcolish/local/rust/trunk/bin/../lib/librustpkg-a039f7e3caed55f-0.7-pre.so(+0x97668)[0x7f6a1b8d2668]\n/home/dcolish/local/rust/trunk/bin/../lib/librustpkg-a039f7e3caed55f-0.7-pre.so(_ZN4main17_952a9ee1229fd18b6_07preE+0x1a53)[0x7f6a1b8d0783]\n/home/dcolish/local/rust/trunk/bin/../lib/librustpkg-a039f7e3caed55f-0.7-pre.so(+0x97668)[0x7f6a1b8d2668]\nrustpkg(_rust_main+0x2e)[0x400d3e]\n/home/dcolish/local/rust/trunk/bin/../lib/librustrt.so(_Z18task_start_wrapperP10spawn_args+0x22)[0x7f6a19c74a32]\n```\n\nThis can be reproduced with a pkg.rs as simple as this\n\n```\nfn main() {\n    let s = \"Hello\";\n    debug!(\"This will break %s\", s);\n}\n```\n", "closed_by": {"login": "catamorphism", "id": 427212, "node_id": "MDQ6VXNlcjQyNzIxMg==", "avatar_url": "https://avatars.githubusercontent.com/u/427212?v=4", "gravatar_id": "", "url": "https://api.github.com/users/catamorphism", "html_url": "https://github.com/catamorphism", "followers_url": "https://api.github.com/users/catamorphism/followers", "following_url": "https://api.github.com/users/catamorphism/following{/other_user}", "gists_url": "https://api.github.com/users/catamorphism/gists{/gist_id}", "starred_url": "https://api.github.com/users/catamorphism/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/catamorphism/subscriptions", "organizations_url": "https://api.github.com/users/catamorphism/orgs", "repos_url": "https://api.github.com/users/catamorphism/repos", "events_url": "https://api.github.com/users/catamorphism/events{/privacy}", "received_events_url": "https://api.github.com/users/catamorphism/received_events", "type": "User", "site_admin": false}, "reactions": {"url": "https://api.github.com/repos/rust-lang/rust/issues/7348/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rust-lang/rust/issues/7348/timeline", "performed_via_github_app": null, "state_reason": "completed"}