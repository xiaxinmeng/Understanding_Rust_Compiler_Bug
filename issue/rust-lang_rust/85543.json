{"url": "https://api.github.com/repos/rust-lang/rust/issues/85543", "repository_url": "https://api.github.com/repos/rust-lang/rust", "labels_url": "https://api.github.com/repos/rust-lang/rust/issues/85543/labels{/name}", "comments_url": "https://api.github.com/repos/rust-lang/rust/issues/85543/comments", "events_url": "https://api.github.com/repos/rust-lang/rust/issues/85543/events", "html_url": "https://github.com/rust-lang/rust/issues/85543", "id": 897973474, "node_id": "MDU6SXNzdWU4OTc5NzM0NzQ=", "number": 85543, "title": "segfault running debug static musl hello world app on Linux", "user": {"login": "lukebond", "id": 3177600, "node_id": "MDQ6VXNlcjMxNzc2MDA=", "avatar_url": "https://avatars.githubusercontent.com/u/3177600?v=4", "gravatar_id": "", "url": "https://api.github.com/users/lukebond", "html_url": "https://github.com/lukebond", "followers_url": "https://api.github.com/users/lukebond/followers", "following_url": "https://api.github.com/users/lukebond/following{/other_user}", "gists_url": "https://api.github.com/users/lukebond/gists{/gist_id}", "starred_url": "https://api.github.com/users/lukebond/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/lukebond/subscriptions", "organizations_url": "https://api.github.com/users/lukebond/orgs", "repos_url": "https://api.github.com/users/lukebond/repos", "events_url": "https://api.github.com/users/lukebond/events{/privacy}", "received_events_url": "https://api.github.com/users/lukebond/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 650731663, "node_id": "MDU6TGFiZWw2NTA3MzE2NjM=", "url": "https://api.github.com/repos/rust-lang/rust/labels/C-bug", "name": "C-bug", "color": "f5f1fd", "default": false, "description": "Category: This is a bug."}], "state": "open", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 3, "created_at": "2021-05-21T11:54:59Z", "updated_at": "2021-05-23T11:22:07Z", "closed_at": null, "author_association": "NONE", "active_lock_reason": null, "body": "I'm trying to build a static binary of a Rust application on Linux and it segfaults, so I created a smaller test case.\r\n\r\nHere is my `main.rs` file:\r\n\r\n```rust\r\nfn main() {\r\n    println!(\"Hello World!\");\r\n}\r\n```\r\n\r\nI ran the following:\r\n\r\n```console\r\n$ rustup target add x86_64-unknown-linux-musl\r\n$ cargo init\r\n$ TARGET_CC=musl-gcc RUSTFLAGS=\"-Ctarget-feature=+crt-static\" cargo build --target=x86_64-unknown-linux-musl\r\n   Compiling helloworld v0.1.0 (/home/luke/Development/helloworld)\r\n    Finished dev [unoptimized + debuginfo] target(s) in 0.19s\r\n$ file target/x86_64-unknown-linux-musl/debug/helloworld\r\ntarget/x86_64-unknown-linux-musl/debug/helloworld: ELF 64-bit LSB pie executable, x86-64, version 1 (SYSV), dynamically linked, interpreter /lib/ld-musl-x86_64.so.1, with debug_info, not stripped\r\n$ ldd target/x86_64-unknown-linux-musl/debug/helloworld\r\n\tstatically linked\r\n$ ./target/x86_64-unknown-linux-musl/debug/helloworld\r\nSegmentation fault (core dumped)\r\n```\r\n\r\nI had previously installed musl-gcc on my system using the Arch package manager:\r\n\r\n```\r\n$ pacman -Qo /usr/bin/musl-gcc\r\n/usr/bin/musl-gcc is owned by musl 1.2.2-1\r\n```\r\n\r\nIf I make a release build, it doesn't segfault:\r\n\r\n```console\r\n$ TARGET_CC=musl-gcc RUSTFLAGS=\"-Ctarget-feature=+crt-static\" cargo build --target=x86_64-unknown-linux-musl --release\r\n   Compiling helloworld v0.1.0 (/home/luke/Development/helloworld)\r\n    Finished release [optimized] target(s) in 0.20s\r\n$ file target/x86_64-unknown-linux-musl/release/helloworld\r\ntarget/x86_64-unknown-linux-musl/release/helloworld: ELF 64-bit LSB pie executable, x86-64, version 1 (SYSV), dynamically linked, interpreter /lib/ld-musl-x86_64.so.1, with debug_info, not stripped\r\n$ ldd target/x86_64-unknown-linux-musl/release/helloworld\r\n\tstatically linked\r\n$ ./target/x86_64-unknown-linux-musl/release/helloworld\r\nHello World!\r\n```\r\n\r\n### Meta\r\n\r\nDetails of my system:\r\n\r\n```console\r\n$ uname -a\r\nLinux x1 5.10.36-2-MANJARO #1 SMP PREEMPT Tue May 11 19:38:44 UTC 2021 x86_64 GNU/Linux\r\n$ cargo --version --verbose\r\ncargo 1.52.0 (69767412a 2021-04-21)\r\nrelease: 1.52.0\r\ncommit-hash: 69767412acbf7f64773427b1fb53e45296712c3c\r\ncommit-date: 2021-04-21\r\n$ rustc --version --verbose\r\nrustc 1.52.1 (9bc8c42bb 2021-05-09)\r\nbinary: rustc\r\ncommit-hash: 9bc8c42bb2f19e745a63f3445f1ac248fb015e53\r\ncommit-date: 2021-05-09\r\nhost: x86_64-unknown-linux-gnu\r\nrelease: 1.52.1\r\nLLVM version: 12.0.0\r\n$ musl-gcc --version\r\ngcc (GCC) 10.2.0\r\nCopyright (C) 2020 Free Software Foundation, Inc.\r\nThis is free software; see the source for copying conditions.  There is NO\r\nwarranty; not even for MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.\r\n$ cat ~/.cargo/config \r\n# Configure cargo to use the \"x86_64-linux-musl-gcc\" binary for musl builds\r\n#\r\n# Replace the linker value if your musl compiler is named differently.\r\n[target.x86_64-unknown-linux-musl]\r\nlinker = \"musl-gcc\"\r\n$ cat Cargo.toml \r\n[package]\r\nname = \"helloworld\"\r\nversion = \"0.1.0\"\r\nauthors = [\"Luke Bond <redacted>\"]\r\nedition = \"2018\"\r\n\r\n# See more keys and their definitions at https://doc.rust-lang.org/cargo/reference/manifest.html\r\n\r\n[dependencies]\r\n\r\n[[bin]]\r\nname = \"helloworld\"\r\npath = \"main.rs\"\r\n```\r\n\r\nI expected to see this happen: No segfault and app prints \"Hello World!\".\r\n\r\nInstead, this happened: segfault in debug mode.\r\n\r\nLet me know if there is any other information I can share, or other tests I can run!", "closed_by": null, "reactions": {"url": "https://api.github.com/repos/rust-lang/rust/issues/85543/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rust-lang/rust/issues/85543/timeline", "performed_via_github_app": null, "state_reason": null}