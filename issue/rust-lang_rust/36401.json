{"url": "https://api.github.com/repos/rust-lang/rust/issues/36401", "repository_url": "https://api.github.com/repos/rust-lang/rust", "labels_url": "https://api.github.com/repos/rust-lang/rust/issues/36401/labels{/name}", "comments_url": "https://api.github.com/repos/rust-lang/rust/issues/36401/comments", "events_url": "https://api.github.com/repos/rust-lang/rust/issues/36401/events", "html_url": "https://github.com/rust-lang/rust/issues/36401", "id": 176260851, "node_id": "MDU6SXNzdWUxNzYyNjA4NTE=", "number": 36401, "title": "Regression in beta: unsafe-free, pure Rust pgm. with no deps segfaults", "user": {"login": "osa1", "id": 448274, "node_id": "MDQ6VXNlcjQ0ODI3NA==", "avatar_url": "https://avatars.githubusercontent.com/u/448274?v=4", "gravatar_id": "", "url": "https://api.github.com/users/osa1", "html_url": "https://github.com/osa1", "followers_url": "https://api.github.com/users/osa1/followers", "following_url": "https://api.github.com/users/osa1/following{/other_user}", "gists_url": "https://api.github.com/users/osa1/gists{/gist_id}", "starred_url": "https://api.github.com/users/osa1/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/osa1/subscriptions", "organizations_url": "https://api.github.com/users/osa1/orgs", "repos_url": "https://api.github.com/users/osa1/repos", "events_url": "https://api.github.com/users/osa1/events{/privacy}", "received_events_url": "https://api.github.com/users/osa1/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 256133398, "node_id": "MDU6TGFiZWwyNTYxMzMzOTg=", "url": "https://api.github.com/repos/rust-lang/rust/labels/A-mir", "name": "A-mir", "color": "f7e101", "default": false, "description": "Area: Mid-level IR (MIR) - https://blog.rust-lang.org/2016/04/19/MIR.html"}, {"id": 262252628, "node_id": "MDU6TGFiZWwyNjIyNTI2Mjg=", "url": "https://api.github.com/repos/rust-lang/rust/labels/regression-from-stable-to-beta", "name": "regression-from-stable-to-beta", "color": "e4008a", "default": false, "description": "Performance or correctness regression from stable to beta."}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 8, "created_at": "2016-09-11T19:34:58Z", "updated_at": "2016-09-12T14:44:06Z", "closed_at": "2016-09-12T14:44:06Z", "author_association": "CONTRIBUTOR", "active_lock_reason": null, "body": "``` rust\n#[derive(Clone, Debug, PartialEq, Eq)]\npub enum Key {\n    AltArrow(Arrow),\n    Arrow(Arrow),\n    Ctrl(char),\n    Char(char),\n    Esc,\n}\n\n#[derive(Clone, Debug, PartialEq, Eq)]\npub enum Arrow { Left, Right, Up, Down }\n\n#[derive(Clone, Debug, PartialEq, Eq)]\npub enum Event {\n    Key(Key),\n    String(String),\n    Resize,\n    Unknown(Vec<u8>),\n}\n\nstatic XTERM_SINGLE_BYTES : [(u8, Event); 5] =\n    [ (1,  Event::Key(Key::Ctrl('a'))),\n      (5,  Event::Key(Key::Ctrl('e'))),\n      (23, Event::Key(Key::Ctrl('w'))),\n      (11, Event::Key(Key::Ctrl('k'))),\n      (4,  Event::Key(Key::Ctrl('d'))),\n    ];\n\nfn main() {\n    println!(\"{:?}\", XTERM_SINGLE_BYTES);\n}\n```\n\n(can be tested here:  https://is.gd/EkJ3by)\n\nWhen run with beta or nightly, this program segfaults.\n\nI tried to simplify this a little bit, but my attempts either turned segfault into a stack overflow, or made it working. Here are some changes I've tried:\n- I tried `[(u8, char)]` for `XTERM_SINGLE_BYTES` and it worked fine.\n- I tried removing `Event::Key`s (e.g. `[(u8, Key)]`) and it worked.\n- I removed some of the constructors from `Event` enum, most of the time the error turned into a stack overflow.\n\nIn my original program I'm iterating the array, and for the `u8` part I'm getting random bytes instead of bytes I put in the array. I'm using rustc 1.13.0-nightly (70598e04f 2016-09-03).\n", "closed_by": {"login": "bors", "id": 3372342, "node_id": "MDQ6VXNlcjMzNzIzNDI=", "avatar_url": "https://avatars.githubusercontent.com/u/3372342?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors", "html_url": "https://github.com/bors", "followers_url": "https://api.github.com/users/bors/followers", "following_url": "https://api.github.com/users/bors/following{/other_user}", "gists_url": "https://api.github.com/users/bors/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors/subscriptions", "organizations_url": "https://api.github.com/users/bors/orgs", "repos_url": "https://api.github.com/users/bors/repos", "events_url": "https://api.github.com/users/bors/events{/privacy}", "received_events_url": "https://api.github.com/users/bors/received_events", "type": "User", "site_admin": false}, "reactions": {"url": "https://api.github.com/repos/rust-lang/rust/issues/36401/reactions", "total_count": 1, "+1": 1, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rust-lang/rust/issues/36401/timeline", "performed_via_github_app": null, "state_reason": "completed"}