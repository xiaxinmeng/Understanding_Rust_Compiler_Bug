{"url": "https://api.github.com/repos/rust-lang/rust/issues/60314", "repository_url": "https://api.github.com/repos/rust-lang/rust", "labels_url": "https://api.github.com/repos/rust-lang/rust/issues/60314/labels{/name}", "comments_url": "https://api.github.com/repos/rust-lang/rust/issues/60314/comments", "events_url": "https://api.github.com/repos/rust-lang/rust/issues/60314/events", "html_url": "https://github.com/rust-lang/rust/issues/60314", "id": 437742297, "node_id": "MDU6SXNzdWU0Mzc3NDIyOTc=", "number": 60314, "title": "`mir_borrowck` ICE with HRTB and lifetime in associated type", "user": {"login": "danielhenrymantilla", "id": 9920355, "node_id": "MDQ6VXNlcjk5MjAzNTU=", "avatar_url": "https://avatars.githubusercontent.com/u/9920355?v=4", "gravatar_id": "", "url": "https://api.github.com/users/danielhenrymantilla", "html_url": "https://github.com/danielhenrymantilla", "followers_url": "https://api.github.com/users/danielhenrymantilla/followers", "following_url": "https://api.github.com/users/danielhenrymantilla/following{/other_user}", "gists_url": "https://api.github.com/users/danielhenrymantilla/gists{/gist_id}", "starred_url": "https://api.github.com/users/danielhenrymantilla/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/danielhenrymantilla/subscriptions", "organizations_url": "https://api.github.com/users/danielhenrymantilla/orgs", "repos_url": "https://api.github.com/users/danielhenrymantilla/repos", "events_url": "https://api.github.com/users/danielhenrymantilla/events{/privacy}", "received_events_url": "https://api.github.com/users/danielhenrymantilla/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 9618520, "node_id": "MDU6TGFiZWw5NjE4NTIw", "url": "https://api.github.com/repos/rust-lang/rust/labels/I-ICE", "name": "I-ICE", "color": "e10c02", "default": false, "description": "Issue: The compiler panicked, giving an Internal Compilation Error (ICE) \u2744\ufe0f"}, {"id": 211668100, "node_id": "MDU6TGFiZWwyMTE2NjgxMDA=", "url": "https://api.github.com/repos/rust-lang/rust/labels/T-compiler", "name": "T-compiler", "color": "bfd4f2", "default": false, "description": "Relevant to the compiler team, which will review and decide on the PR/issue."}, {"id": 604489711, "node_id": "MDU6TGFiZWw2MDQ0ODk3MTE=", "url": "https://api.github.com/repos/rust-lang/rust/labels/A-NLL", "name": "A-NLL", "color": "f7e101", "default": false, "description": "Area: Non Lexical Lifetimes (NLL)"}, {"id": 650731663, "node_id": "MDU6TGFiZWw2NTA3MzE2NjM=", "url": "https://api.github.com/repos/rust-lang/rust/labels/C-bug", "name": "C-bug", "color": "f5f1fd", "default": false, "description": "Category: This is a bug."}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 1, "created_at": "2019-04-26T16:04:00Z", "updated_at": "2019-04-26T16:22:07Z", "closed_at": "2019-04-26T16:22:07Z", "author_association": "CONTRIBUTOR", "active_lock_reason": null, "body": "# Summary\r\n\r\nWhen `T` is **not** `: 'static`, calling a function of signature\r\n```rust\r\nfn foo<T> (_: &'_ T)\r\nwhere\r\n    for<'a> &'a T : Trait<AssociatedType = &'a ()>,\r\n{}\r\n```\r\n\r\nleads to an ICE.\r\n\r\n# Steps to reproduce\r\n\r\n```rust\r\ntrait Trait {\r\n    type AssociatedType;\r\n}\r\n\r\nimpl<'a, T : 'a> Trait for &'a T {\r\n    type AssociatedType = &'a ();\r\n}\r\n\r\n/// Calling this with some T when we don't have `T : 'static` leads to an ICE\r\nfn foo<T> (_: &'_ T)\r\nwhere\r\n    for<'a> &'a T : Trait<AssociatedType = &'a ()>,\r\n{}\r\n\r\n/// proof\r\nfn main ()\r\n{\r\n    use ::core::convert::identity as force_local;\r\n    match force_local(()) { ref not_static => {\r\n        foo(&not_static);\r\n    }}\r\n}\r\n```\r\n\r\n  - [Playground link](https://play.rust-lang.org/?version=stable&mode=debug&edition=2018&gist=0bed9a62f129cd68ac89ed5487f50a8d)\r\n\r\n# Tested on\r\n\r\n  - 1.33.0 nightly and stable\r\n\r\n  - 1.34.1 stable\r\n\r\n  - 1.36.0 nightly\r\n\r\n# ICE Backtrace\r\n\r\n```\r\nthread 'rustc' panicked at 'called `Option::unwrap()` on a `None` value', src/libcore/option.rs:347:21\r\nstack backtrace:\r\n   0:     0x7f017a77edf3 - std::sys::unix::backtrace::tracing::imp::unwind_backtrace::haf1a3ee7aa81178f\r\n                               at src/libstd/sys/unix/backtrace/tracing/gcc_s.rs:39\r\n   1:     0x7f017a776c7b - std::sys_common::backtrace::_print::h4025758c54fa4159\r\n                               at src/libstd/sys_common/backtrace.rs:71\r\n   2:     0x7f017a77b056 - std::panicking::default_hook::{{closure}}::h402d67f0ee8abb93\r\n                               at src/libstd/sys_common/backtrace.rs:59\r\n                               at src/libstd/panicking.rs:197\r\n   3:     0x7f017a77ade9 - std::panicking::default_hook::h5927269e5fe05d46\r\n                               at src/libstd/panicking.rs:211\r\n   4:     0x7f0177ae46f0 - rustc::util::common::panic_hook::hd3479589b6652967\r\n   5:     0x7f017a77b848 - std::panicking::rust_panic_with_hook::hd291985d6b07ecab\r\n                               at src/libstd/panicking.rs:478\r\n   6:     0x7f017a77b2e1 - std::panicking::continue_panic_fmt::h2ef8bba7dd53e0f9\r\n                               at src/libstd/panicking.rs:381\r\n   7:     0x7f017a77b1c5 - rust_begin_unwind\r\n                               at src/libstd/panicking.rs:308\r\n   8:     0x7f017a7a419c - core::panicking::panic_fmt::h4c9bb56fb9570ecd\r\n                               at src/libcore/panicking.rs:85\r\n   9:     0x7f017a7a40db - core::panicking::panic::hf6c74ec97f800281\r\n                               at src/libcore/panicking.rs:49\r\n  10:     0x7f017850adcf - rustc_mir::borrow_check::nll::region_infer::error_reporting::<impl rustc_mir::borrow_check::nll::region_infer::RegionInferenceContext>::free_region_constraint_info::hcd94121a44194da1\r\n  11:     0x7f01785a3cb7 - rustc_mir::borrow_check::nll::explain_borrow::<impl rustc_mir::borrow_check::MirBorrowckCtxt>::explain_why_borrow_contains_point::h0259947006b8657a\r\n  12:     0x7f0178599c8e - rustc_mir::borrow_check::error_reporting::<impl rustc_mir::borrow_check::MirBorrowckCtxt>::report_borrowed_value_does_not_live_long_enough::h2d9384c7c69018d4\r\n  13:     0x7f01785b174f - rustc_mir::borrow_check::MirBorrowckCtxt::check_for_invalidation_at_exit::h0d8d2b2111d9852b\r\n  14:     0x7f017878e44d - rustc_mir::borrow_check::flows::Flows::with_outgoing_borrows::h59cb62c081661925\r\n  15:     0x7f01785af4a1 - <rustc_mir::borrow_check::MirBorrowckCtxt as rustc_mir::dataflow::DataflowResultsConsumer>::visit_terminator_entry::he99447d412888dea\r\n  16:     0x7f01785ab31b - rustc_mir::borrow_check::do_mir_borrowck::he1e08ebff5e85c4c\r\n  17:     0x7f017865a98b - rustc::ty::context::GlobalCtxt::enter_local::h76697e7495d5de01\r\n  18:     0x7f01785a74b3 - rustc_mir::borrow_check::mir_borrowck::hd2a7c2c2a29481ea\r\n  19:     0x7f0179a2dde6 - rustc::ty::query::__query_compute::mir_borrowck::h0482b255069ce6d0\r\n  20:     0x7f017995fc24 - rustc::ty::query::<impl rustc::ty::query::config::QueryAccessors for rustc::ty::query::queries::mir_borrowck>::compute::h7d9d10d43f88afb6\r\n  21:     0x7f017995b350 - rustc::dep_graph::graph::DepGraph::with_task_impl::hd7a0b24f50278d9e\r\n  22:     0x7f01799781db - rustc::ty::query::plumbing::<impl rustc::ty::context::TyCtxt>::get_query::hbbcee6dbee76d90c\r\n  23:     0x7f017995fac2 - rustc::ty::<impl rustc::ty::context::TyCtxt>::par_body_owners::h89025f102a55b2f6\r\n  24:     0x7f0179a62257 - rustc::util::common::time::h3c154293cf490d17\r\n  25:     0x7f01799a14be - rustc_interface::passes::analysis::h8f84f9aac031a1ef\r\n  26:     0x7f017aa42b45 - rustc::ty::query::__query_compute::analysis::hf86c5ce02b4262be\r\n  27:     0x7f017aa94608 - rustc::ty::query::<impl rustc::ty::query::config::QueryAccessors for rustc::ty::query::queries::analysis>::compute::h8c5d64a327c7fda7\r\n  28:     0x7f017aa6635c - rustc::dep_graph::graph::DepGraph::with_task_impl::h18baf177dba4f515\r\n  29:     0x7f017aa95fb4 - rustc::ty::query::plumbing::<impl rustc::ty::context::TyCtxt>::get_query::h888080c742ef1585\r\n  30:     0x7f017aa43165 - rustc::ty::context::tls::enter_global::hec5e5d04ebea1ec5\r\n  31:     0x7f017aa5a586 - rustc_interface::passes::BoxedGlobalCtxt::access::{{closure}}::h76370eccdcbe3781\r\n  32:     0x7f01799e1c24 - rustc_interface::passes::create_global_ctxt::{{closure}}::h643f79b7fa277823\r\n  33:     0x7f017aa5b8e9 - rustc_interface::interface::run_compiler_in_existing_thread_pool::h03fd2a673a112391\r\n  34:     0x7f017aadb703 - std::thread::local::LocalKey<T>::with::hb4bfbaa8ed9297fa\r\n  35:     0x7f017aaa29e4 - scoped_tls::ScopedKey<T>::set::h8b358cd22c3a6454\r\n  36:     0x7f017aad6f4f - syntax::with_globals::h89e65f9b0993082f\r\n  37:     0x7f017aa35169 - std::sys_common::backtrace::__rust_begin_short_backtrace::he0297bc984d9026c\r\n  38:     0x7f017a78c619 - __rust_maybe_catch_panic\r\n                               at src/libpanic_unwind/lib.rs:85\r\n  39:     0x7f017aa4fde8 - core::ops::function::FnOnce::call_once{{vtable.shim}}::h734d38892498b477\r\n  40:     0x7f017a75d75e - <alloc::boxed::Box<F> as core::ops::function::FnOnce<A>>::call_once::hc7a06d37461455da\r\n                               at /rustc/3991285f55a4b7cd92b7ffcdc396a3023076f5cb/src/liballoc/boxed.rs:704\r\n  41:     0x7f017a78b28f - std::sys::unix::thread::Thread::new::thread_start::ha74a24b94eca0f79\r\n                               at /rustc/3991285f55a4b7cd92b7ffcdc396a3023076f5cb/src/liballoc/boxed.rs:704\r\n                               at src/libstd/sys_common/thread.rs:13\r\n                               at src/libstd/sys/unix/thread.rs:79\r\n  42:     0x7f017a4fc6b9 - start_thread\r\n  43:     0x7f0179e2641c - clone\r\n  44:                0x0 - <unknown>\r\nquery stack during panic:\r\n#0 [mir_borrowck] processing `main`\r\n#1 [analysis] running analysis passes on this crate\r\nend of query stack\r\n```\r\n___\r\n\r\n# Hypothesis\r\n\r\nMaybe `rustc` does not add the implicit\r\n\r\n```rust\r\nfor<'a> T : 'a\r\n```\r\n\r\nbound required for the other bound to make sense", "closed_by": {"login": "jonas-schievink", "id": 1786438, "node_id": "MDQ6VXNlcjE3ODY0Mzg=", "avatar_url": "https://avatars.githubusercontent.com/u/1786438?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jonas-schievink", "html_url": "https://github.com/jonas-schievink", "followers_url": "https://api.github.com/users/jonas-schievink/followers", "following_url": "https://api.github.com/users/jonas-schievink/following{/other_user}", "gists_url": "https://api.github.com/users/jonas-schievink/gists{/gist_id}", "starred_url": "https://api.github.com/users/jonas-schievink/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jonas-schievink/subscriptions", "organizations_url": "https://api.github.com/users/jonas-schievink/orgs", "repos_url": "https://api.github.com/users/jonas-schievink/repos", "events_url": "https://api.github.com/users/jonas-schievink/events{/privacy}", "received_events_url": "https://api.github.com/users/jonas-schievink/received_events", "type": "User", "site_admin": false}, "reactions": {"url": "https://api.github.com/repos/rust-lang/rust/issues/60314/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rust-lang/rust/issues/60314/timeline", "performed_via_github_app": null, "state_reason": "completed"}