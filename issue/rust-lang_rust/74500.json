{"url": "https://api.github.com/repos/rust-lang/rust/issues/74500", "repository_url": "https://api.github.com/repos/rust-lang/rust", "labels_url": "https://api.github.com/repos/rust-lang/rust/issues/74500/labels{/name}", "comments_url": "https://api.github.com/repos/rust-lang/rust/issues/74500/comments", "events_url": "https://api.github.com/repos/rust-lang/rust/issues/74500/events", "html_url": "https://github.com/rust-lang/rust/issues/74500", "id": 660571668, "node_id": "MDU6SXNzdWU2NjA1NzE2Njg=", "number": 74500, "title": "Linker error 'PC offset is too large' when building for specific target memory address", "user": {"login": "luojia65", "id": 40385009, "node_id": "MDQ6VXNlcjQwMzg1MDA5", "avatar_url": "https://avatars.githubusercontent.com/u/40385009?v=4", "gravatar_id": "", "url": "https://api.github.com/users/luojia65", "html_url": "https://github.com/luojia65", "followers_url": "https://api.github.com/users/luojia65/followers", "following_url": "https://api.github.com/users/luojia65/following{/other_user}", "gists_url": "https://api.github.com/users/luojia65/gists{/gist_id}", "starred_url": "https://api.github.com/users/luojia65/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/luojia65/subscriptions", "organizations_url": "https://api.github.com/users/luojia65/orgs", "repos_url": "https://api.github.com/users/luojia65/repos", "events_url": "https://api.github.com/users/luojia65/events{/privacy}", "received_events_url": "https://api.github.com/users/luojia65/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 650731663, "node_id": "MDU6TGFiZWw2NTA3MzE2NjM=", "url": "https://api.github.com/repos/rust-lang/rust/labels/C-bug", "name": "C-bug", "color": "f5f1fd", "default": false, "description": "Category: This is a bug."}], "state": "open", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 1, "created_at": "2020-07-19T04:06:38Z", "updated_at": "2020-07-19T05:37:27Z", "closed_at": null, "author_association": "CONTRIBUTOR", "active_lock_reason": null, "body": "<!--\r\nThank you for filing a bug report! \ud83d\udc1b Please provide a short summary of the bug,\r\nalong with any information you feel relevant to replicating the bug.\r\n-->\r\n\r\nTo illustrate this problem, I have minimized the code: https://github.com/luojia65/runtime-test. This project depends on riscv-rt crate 0.8.0.\r\n\r\nClone the project down and try to compile, I expected to see it compiles normally. However there is a strange error:\r\n\r\n```\r\n\u276f cargo build\r\n   Compiling runtime-test v0.1.0 (/Users/mac/2020/RustProjects/runtime-test)\r\nerror: linking with `rust-lld` failed: exit code: 1\r\n  |\r\n  = note: \"rust-lld\" \"-flavor\" \"gnu\" \"--eh-frame-hdr\" \"-L\" /* ... many rlib files ... */ \"-Tmemory.x\" \"-Tlink.x\" \"-Bdynamic\"\r\n  = note: rust-lld: error: .. /runtime-test/target/riscv64imac-unknown-none-elf/debug/deps/libriscv_rt-7ea7a4b3a0900dbe.rlib(riscv-rt.o):(.eh_frame): PC offset is too large: 0x80000018\r\n\r\nerror: aborting due to previous error\r\n\r\nerror: could not compile `runtime-test`.\r\n\r\nTo learn more, run the command again with --verbose.\r\n```\r\n\r\nI've uploaded full error message into ubuntu pastebin: https://paste.ubuntu.com/p/jdmhvmy3WS/. It shows that the linking process has some error like (.eh_frame): PC offset is too large: 0x80000018.\r\n\r\nIt's very strange. I configure the memory settings in memory.x. When SRAM base is 0x80000000, the error occurres. But when I set it to a slightly bigger value like 0x80000134, or sligntly smaller 0x7fffffe0, it compiles normally without any errors.\r\n\r\nMy target (embedded) platform has memory located exactly in 0x80000000 where I must flash my program into.\r\n\r\nWhat could be the problem?\r\n\r\nEdit: I tried on latest stable `rustc 1.45.0 (5c1f21c3b 2020-07-13)`, it compiles normally and the error does not occur again.\r\n\r\n### Meta\r\n<!--\r\nIf you're using the stable version of the compiler, you should also check if the\r\nbug also exists in the beta or nightly versions.\r\n-->\r\n\r\n`rustc --version --verbose`:\r\n```\r\nrustc 1.47.0-nightly (39d5a61f2 2020-07-17)\r\nbinary: rustc\r\ncommit-hash: 39d5a61f2e4e237123837f5162cc275c2fd7e625\r\ncommit-date: 2020-07-17\r\nhost: x86_64-apple-darwin\r\nrelease: 1.47.0-nightly\r\nLLVM version: 10.0\r\n```\r\n\r\nMy stable's `rustc --version --verbose`:\r\n```\r\nrustc 1.45.0 (5c1f21c3b 2020-07-13)\r\nbinary: rustc\r\ncommit-hash: 5c1f21c3b82297671ad3ae1e8c942d2ca92e84f2\r\ncommit-date: 2020-07-13\r\nhost: x86_64-apple-darwin\r\nrelease: 1.45.0\r\nLLVM version: 10.0\r\n```\r\n\r\n<!--\r\nInclude a backtrace in the code block by setting `RUST_BACKTRACE=1` in your\r\nenvironment. E.g. `RUST_BACKTRACE=1 cargo build`.\r\n-->\r\n<details><summary>`cargo build --verbose`</summary>\r\n<p>\r\n\r\n```\r\n\u276f cargo build --verbose\r\n       Fresh lazy_static v1.4.0\r\n       Fresh regex-syntax v0.6.18\r\n       Fresh semver-parser v0.7.0\r\n       Fresh unicode-xid v0.1.0\r\n       Fresh rand_core v0.4.2\r\n       Fresh bit_field v0.10.0\r\n       Fresh r0 v1.0.0\r\n   Compiling runtime-test v0.1.0 (/Users/mac/2020/RustProjects/runtime-test)\r\n     Running `rustc --crate-name build_script_build --edition=2018 build.rs --error-format=json --json=diagnostic-rendered-ansi --crate-type bin --emit=dep-info,link -Cembed-bitcode=no -C debuginfo=2 -C metadata=8291cbab5b6d7992 -C extra-filename=-8291cbab5b6d7992 --out-dir /Users/mac/2020/RustProjects/runtime-test/target/debug/build/runtime-test-8291cbab5b6d7992 -C incremental=/Users/mac/2020/RustProjects/runtime-test/target/debug/incremental -L dependency=/Users/mac/2020/RustProjects/runtime-test/target/debug/deps`\r\n       Fresh thread_local v1.0.1\r\n       Fresh semver v0.9.0\r\n       Fresh rand_core v0.3.1\r\n       Fresh rustc_version v0.2.3\r\n       Fresh rand v0.5.6\r\n       Fresh proc-macro2 v0.4.30\r\n       Fresh memchr v2.3.3\r\n       Fresh quote v0.6.13\r\n       Fresh aho-corasick v0.7.13\r\n       Fresh syn v0.15.44\r\n       Fresh regex v1.3.9\r\n       Fresh riscv-target v0.1.2\r\n       Fresh bare-metal v0.2.5\r\n       Fresh riscv-rt-macros v0.1.6\r\n       Fresh riscv v0.6.0\r\n       Fresh riscv-rt v0.8.0\r\n     Running `/Users/mac/2020/RustProjects/runtime-test/target/debug/build/runtime-test-8291cbab5b6d7992/build-script-build`\r\n     Running `rustc --crate-name runtime_test --edition=2018 src/main.rs --error-format=json --json=diagnostic-rendered-ansi --crate-type bin --emit=dep-info,link -Cembed-bitcode=no -C debuginfo=2 -C metadata=be5e44c8ddeac7cc -C extra-filename=-be5e44c8ddeac7cc --out-dir /Users/mac/2020/RustProjects/runtime-test/target/riscv64imac-unknown-none-elf/debug/deps --target riscv64imac-unknown-none-elf -C incremental=/Users/mac/2020/RustProjects/runtime-test/target/riscv64imac-unknown-none-elf/debug/incremental -L dependency=/Users/mac/2020/RustProjects/runtime-test/target/riscv64imac-unknown-none-elf/debug/deps -L dependency=/Users/mac/2020/RustProjects/runtime-test/target/debug/deps --extern riscv_rt=/Users/mac/2020/RustProjects/runtime-test/target/riscv64imac-unknown-none-elf/debug/deps/libriscv_rt-7ea7a4b3a0900dbe.rlib -C link-arg=-Tmemory.x -C link-arg=-Tlink.x -L /Users/mac/2020/RustProjects/runtime-test/target/riscv64imac-unknown-none-elf/debug/build/runtime-test-7effb8a5c1ae85fc/out -L /Users/mac/2020/RustProjects/runtime-test/target/riscv64imac-unknown-none-elf/debug/build/riscv-rt-89827235546695ae/out -L /Users/mac/2020/RustProjects/runtime-test/target/riscv64imac-unknown-none-elf/debug/build/riscv-rt-89827235546695ae/out -L /Users/mac/2020/RustProjects/runtime-test/target/riscv64imac-unknown-none-elf/debug/build/riscv-66332674181ce1ed/out`\r\nerror: linking with `rust-lld` failed: exit code: 1\r\n  |\r\n  = note: \"rust-lld\" \"-flavor\" \"gnu\" \"--eh-frame-hdr\" \"-L\" \"/Users/mac/.rustup/toolchains/nightly-x86_64-apple-darwin/lib/rustlib/riscv64imac-unknown-none-elf/lib\" \"/Users/mac/2020/RustProjects/runtime-test/target/riscv64imac-unknown-none-elf/debug/deps/runtime_test-be5e44c8ddeac7cc.5904ri43xt2mrhjm.rcgu.o\" \"-o\" \"/Users/mac/2020/RustProjects/runtime-test/target/riscv64imac-unknown-none-elf/debug/deps/runtime_test-be5e44c8ddeac7cc\" \"--gc-sections\" \"-L\" \"/Users/mac/2020/RustProjects/runtime-test/target/riscv64imac-unknown-none-elf/debug/deps\" \"-L\" \"/Users/mac/2020/RustProjects/runtime-test/target/debug/deps\" \"-L\" \"/Users/mac/2020/RustProjects/runtime-test/target/riscv64imac-unknown-none-elf/debug/build/runtime-test-7effb8a5c1ae85fc/out\" \"-L\" \"/Users/mac/2020/RustProjects/runtime-test/target/riscv64imac-unknown-none-elf/debug/build/riscv-rt-89827235546695ae/out\" \"-L\" \"/Users/mac/2020/RustProjects/runtime-test/target/riscv64imac-unknown-none-elf/debug/build/riscv-rt-89827235546695ae/out\" \"-L\" \"/Users/mac/2020/RustProjects/runtime-test/target/riscv64imac-unknown-none-elf/debug/build/riscv-66332674181ce1ed/out\" \"-L\" \"/Users/mac/.rustup/toolchains/nightly-x86_64-apple-darwin/lib/rustlib/riscv64imac-unknown-none-elf/lib\" \"-Bstatic\" \"/Users/mac/2020/RustProjects/runtime-test/target/riscv64imac-unknown-none-elf/debug/deps/libriscv_rt-7ea7a4b3a0900dbe.rlib\" \"/Users/mac/2020/RustProjects/runtime-test/target/riscv64imac-unknown-none-elf/debug/deps/libriscv-aaf1924c4d23cdd9.rlib\" \"/Users/mac/2020/RustProjects/runtime-test/target/riscv64imac-unknown-none-elf/debug/deps/libbit_field-e176a93850a57144.rlib\" \"/Users/mac/2020/RustProjects/runtime-test/target/riscv64imac-unknown-none-elf/debug/deps/libbare_metal-bbaa822c72da25c9.rlib\" \"/Users/mac/2020/RustProjects/runtime-test/target/riscv64imac-unknown-none-elf/debug/deps/libr0-406f343862937fa8.rlib\" \"/Users/mac/.rustup/toolchains/nightly-x86_64-apple-darwin/lib/rustlib/riscv64imac-unknown-none-elf/lib/librustc_std_workspace_core-28816ddbd527c2d7.rlib\" \"/Users/mac/.rustup/toolchains/nightly-x86_64-apple-darwin/lib/rustlib/riscv64imac-unknown-none-elf/lib/libcore-af7fd6dae6d1be55.rlib\" \"/Users/mac/.rustup/toolchains/nightly-x86_64-apple-darwin/lib/rustlib/riscv64imac-unknown-none-elf/lib/libcompiler_builtins-65c2e59034282182.rlib\" \"-Tmemory.x\" \"-Tlink.x\" \"-Bdynamic\"\r\n  = note: rust-lld: error: /Users/mac/2020/RustProjects/runtime-test/target/riscv64imac-unknown-none-elf/debug/deps/libriscv_rt-7ea7a4b3a0900dbe.rlib(riscv-rt.o):(.eh_frame): PC offset is too large: 0x80000018\r\n          \r\n\r\nerror: aborting due to previous error\r\n\r\nerror: could not compile `runtime-test`.\r\n\r\nCaused by:\r\n  process didn't exit successfully: `rustc --crate-name runtime_test --edition=2018 src/main.rs --error-format=json --json=diagnostic-rendered-ansi --crate-type bin --emit=dep-info,link -Cembed-bitcode=no -C debuginfo=2 -C metadata=be5e44c8ddeac7cc -C extra-filename=-be5e44c8ddeac7cc --out-dir /Users/mac/2020/RustProjects/runtime-test/target/riscv64imac-unknown-none-elf/debug/deps --target riscv64imac-unknown-none-elf -C incremental=/Users/mac/2020/RustProjects/runtime-test/target/riscv64imac-unknown-none-elf/debug/incremental -L dependency=/Users/mac/2020/RustProjects/runtime-test/target/riscv64imac-unknown-none-elf/debug/deps -L dependency=/Users/mac/2020/RustProjects/runtime-test/target/debug/deps --extern riscv_rt=/Users/mac/2020/RustProjects/runtime-test/target/riscv64imac-unknown-none-elf/debug/deps/libriscv_rt-7ea7a4b3a0900dbe.rlib -C link-arg=-Tmemory.x -C link-arg=-Tlink.x -L /Users/mac/2020/RustProjects/runtime-test/target/riscv64imac-unknown-none-elf/debug/build/runtime-test-7effb8a5c1ae85fc/out -L /Users/mac/2020/RustProjects/runtime-test/target/riscv64imac-unknown-none-elf/debug/build/riscv-rt-89827235546695ae/out -L /Users/mac/2020/RustProjects/runtime-test/target/riscv64imac-unknown-none-elf/debug/build/riscv-rt-89827235546695ae/out -L /Users/mac/2020/RustProjects/runtime-test/target/riscv64imac-unknown-none-elf/debug/build/riscv-66332674181ce1ed/out` (exit code: 1)\r\n\r\n```\r\n\r\n</p>\r\n</details>\r\n", "closed_by": null, "reactions": {"url": "https://api.github.com/repos/rust-lang/rust/issues/74500/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rust-lang/rust/issues/74500/timeline", "performed_via_github_app": null, "state_reason": null}