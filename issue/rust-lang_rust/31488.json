{"url": "https://api.github.com/repos/rust-lang/rust/issues/31488", "repository_url": "https://api.github.com/repos/rust-lang/rust", "labels_url": "https://api.github.com/repos/rust-lang/rust/issues/31488/labels{/name}", "comments_url": "https://api.github.com/repos/rust-lang/rust/issues/31488/comments", "events_url": "https://api.github.com/repos/rust-lang/rust/issues/31488/events", "html_url": "https://github.com/rust-lang/rust/issues/31488", "id": 132172263, "node_id": "MDU6SXNzdWUxMzIxNzIyNjM=", "number": 31488, "title": "File.read_to_end doesn't always read to the end", "user": {"login": "joelself", "id": 910662, "node_id": "MDQ6VXNlcjkxMDY2Mg==", "avatar_url": "https://avatars.githubusercontent.com/u/910662?v=4", "gravatar_id": "", "url": "https://api.github.com/users/joelself", "html_url": "https://github.com/joelself", "followers_url": "https://api.github.com/users/joelself/followers", "following_url": "https://api.github.com/users/joelself/following{/other_user}", "gists_url": "https://api.github.com/users/joelself/gists{/gist_id}", "starred_url": "https://api.github.com/users/joelself/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/joelself/subscriptions", "organizations_url": "https://api.github.com/users/joelself/orgs", "repos_url": "https://api.github.com/users/joelself/repos", "events_url": "https://api.github.com/users/joelself/events{/privacy}", "received_events_url": "https://api.github.com/users/joelself/received_events", "type": "User", "site_admin": false}, "labels": [], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 2, "created_at": "2016-02-08T15:27:57Z", "updated_at": "2016-02-08T17:17:40Z", "closed_at": "2016-02-08T17:17:40Z", "author_association": "NONE", "active_lock_reason": null, "body": "``` rust\nlet mut file = File::open(\"test.log\").unwrap();\nfile.seek(SeekFrom::End(0)).unwrap(); // seek to the end\n// elided, wait for file modified signal then read what was written\nlet bytes_read = file.read_to_end(& mut buffer).unwrap();\nmatch String::from_utf8(buffer.clone()) {\n    Ok(s) => println!(\"Read: {}, bytes: {}\", String::from_utf8(buffer.clone()).unwrap(), bytes_read),\n    _ => (),\n}\n```\n\nI elided the code where I wait on a signal that the file has changed. If you do something like\n\n``` shell\necho \"Hello World!\" >> test.log\n```\n\nIt works fine; gets the bytes and prints it out. However something like\n\n``` shell\nsed -i.bck '$s/$/GoodByeWorld/' test.log\n```\n\nWill modify the file, trigger the file modified signal I have in the code, but it won't read any bytes. This is definitely an unusual case as `tail -f` doesn't catch it either even if you later append normally like: `echo \"Hello World!\" >> test.log'`. `tail -F` however (after a very brief delay) _will_ pick it up.\n\nSo the file is being appended to and an event is being generated for the append, but the Rust File still thinks it is already at EOF.\n", "closed_by": {"login": "joelself", "id": 910662, "node_id": "MDQ6VXNlcjkxMDY2Mg==", "avatar_url": "https://avatars.githubusercontent.com/u/910662?v=4", "gravatar_id": "", "url": "https://api.github.com/users/joelself", "html_url": "https://github.com/joelself", "followers_url": "https://api.github.com/users/joelself/followers", "following_url": "https://api.github.com/users/joelself/following{/other_user}", "gists_url": "https://api.github.com/users/joelself/gists{/gist_id}", "starred_url": "https://api.github.com/users/joelself/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/joelself/subscriptions", "organizations_url": "https://api.github.com/users/joelself/orgs", "repos_url": "https://api.github.com/users/joelself/repos", "events_url": "https://api.github.com/users/joelself/events{/privacy}", "received_events_url": "https://api.github.com/users/joelself/received_events", "type": "User", "site_admin": false}, "reactions": {"url": "https://api.github.com/repos/rust-lang/rust/issues/31488/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rust-lang/rust/issues/31488/timeline", "performed_via_github_app": null, "state_reason": "completed"}