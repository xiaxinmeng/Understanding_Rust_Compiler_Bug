{"url": "https://api.github.com/repos/rust-lang/rust/issues/79410", "repository_url": "https://api.github.com/repos/rust-lang/rust", "labels_url": "https://api.github.com/repos/rust-lang/rust/issues/79410/labels{/name}", "comments_url": "https://api.github.com/repos/rust-lang/rust/issues/79410/comments", "events_url": "https://api.github.com/repos/rust-lang/rust/issues/79410/events", "html_url": "https://github.com/rust-lang/rust/issues/79410", "id": 750784350, "node_id": "MDU6SXNzdWU3NTA3ODQzNTA=", "number": 79410, "title": "Dummy Overlapping Line Program Range produced for WASM Target", "user": {"login": "mitsuhiko", "id": 7396, "node_id": "MDQ6VXNlcjczOTY=", "avatar_url": "https://avatars.githubusercontent.com/u/7396?v=4", "gravatar_id": "", "url": "https://api.github.com/users/mitsuhiko", "html_url": "https://github.com/mitsuhiko", "followers_url": "https://api.github.com/users/mitsuhiko/followers", "following_url": "https://api.github.com/users/mitsuhiko/following{/other_user}", "gists_url": "https://api.github.com/users/mitsuhiko/gists{/gist_id}", "starred_url": "https://api.github.com/users/mitsuhiko/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/mitsuhiko/subscriptions", "organizations_url": "https://api.github.com/users/mitsuhiko/orgs", "repos_url": "https://api.github.com/users/mitsuhiko/repos", "events_url": "https://api.github.com/users/mitsuhiko/events{/privacy}", "received_events_url": "https://api.github.com/users/mitsuhiko/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 203130, "node_id": "MDU6TGFiZWwyMDMxMzA=", "url": "https://api.github.com/repos/rust-lang/rust/labels/A-debuginfo", "name": "A-debuginfo", "color": "f7e101", "default": false, "description": "Area: Debugging information in compiled programs (DWARF, PDB, etc.)"}, {"id": 211668100, "node_id": "MDU6TGFiZWwyMTE2NjgxMDA=", "url": "https://api.github.com/repos/rust-lang/rust/labels/T-compiler", "name": "T-compiler", "color": "bfd4f2", "default": false, "description": "Relevant to the compiler team, which will review and decide on the PR/issue."}, {"id": 474645165, "node_id": "MDU6TGFiZWw0NzQ2NDUxNjU=", "url": "https://api.github.com/repos/rust-lang/rust/labels/O-wasm", "name": "O-wasm", "color": "6e6ec0", "default": false, "description": "Target: WASM (WebAssembly), http://webassembly.org/"}, {"id": 650731663, "node_id": "MDU6TGFiZWw2NTA3MzE2NjM=", "url": "https://api.github.com/repos/rust-lang/rust/labels/C-bug", "name": "C-bug", "color": "f5f1fd", "default": false, "description": "Category: This is a bug."}], "state": "open", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 3, "created_at": "2020-11-25T12:40:44Z", "updated_at": "2022-08-03T19:33:44Z", "closed_at": null, "author_association": "CONTRIBUTOR", "active_lock_reason": null, "body": "The following minimal WASM example:\r\n\r\n```rust\r\n#![no_std]\r\n\r\n#[panic_handler]\r\nfn panic(_info: &core::panic::PanicInfo) -> ! {\r\n    loop {}\r\n}\r\n\r\n#[no_mangle]\r\npub fn internal_func() {\r\n}\r\n```\r\n\r\nProduces a line number program in DWARF with what appears to decode to two overlapping ranges:\r\n\r\n```\r\nLine Number Rows:\r\n<pc>        [lno,col]\r\n0x00000000  [   4, 0] NS uri: \"src/lib.rs\"\r\n0x0000001d  [   5, 5] NS PE\r\n0x00000021  [   0, 5]\r\n0x00000023  [   0, 5] ET\r\n0x00000002  [   9, 0] NS\r\n0x00000003  [  10, 2] NS PE\r\n0x00000005  [  10, 2] NS ET\r\n```\r\n\r\nThe output here is from the gimli dwarfdump tool but you can basically see that from pc `0x00` a sequence is started and ends at `0x23` which is the end of the program. The actual function `internal_func` sits at `0x2` and ends at `0x5`. Since DWARF does not permit code at `0x0` it would appear that rustc pads out the file for two bytes and places \"nothing\" at `0x0`.\r\n\r\nDWARF does not talk much about overlapping sequences but it does talk about how sequences have to be contiguous:\r\n\r\n> A series of contiguous target machine instructions. One compilation unit may emit multiple sequences (that is, not all instructions within a compilation unit are assumed to be contiguous).  \r\n\r\nWe currently take advantage of this fact and only consider a single sequence per PC. Right now we accidentally pick up on the first sequence which starts at 0. We can work around this by skipping sequences at zero but it seems to be a bug that this dummy sequence is generated in the first place.\r\n\r\n### Meta\r\n\r\n```\r\n$ rustc --version --verbose\r\nrustc 1.48.0 (7eac88abb 2020-11-16)\r\nbinary: rustc\r\ncommit-hash: 7eac88abb2e57e752f3302f02be5f3ce3d7adfb4\r\ncommit-date: 2020-11-16\r\nhost: x86_64-apple-darwin\r\nrelease: 1.48.0\r\nLLVM version: 11.0\r\n```\r\n\r\nIt also happens on nightly:\r\n\r\n```\r\n$ rustc +nightly --version --verbose\r\nrustc 1.50.0-nightly (825637983 2020-11-18)\r\nbinary: rustc\r\ncommit-hash: 8256379832b5ecb7f71e8c5e2018446482223c12\r\ncommit-date: 2020-11-18\r\nhost: x86_64-apple-darwin\r\nrelease: 1.50.0-nightly\r\n```", "closed_by": null, "reactions": {"url": "https://api.github.com/repos/rust-lang/rust/issues/79410/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rust-lang/rust/issues/79410/timeline", "performed_via_github_app": null, "state_reason": null}