{"url": "https://api.github.com/repos/rust-lang/rust/issues/13373", "repository_url": "https://api.github.com/repos/rust-lang/rust", "labels_url": "https://api.github.com/repos/rust-lang/rust/issues/13373/labels{/name}", "comments_url": "https://api.github.com/repos/rust-lang/rust/issues/13373/comments", "events_url": "https://api.github.com/repos/rust-lang/rust/issues/13373/events", "html_url": "https://github.com/rust-lang/rust/issues/13373", "id": 30959631, "node_id": "MDU6SXNzdWUzMDk1OTYzMQ==", "number": 13373, "title": "Loop alignment uses inefficient single-byte NOPs on x86", "user": {"login": "kmcallister", "id": 444997, "node_id": "MDQ6VXNlcjQ0NDk5Nw==", "avatar_url": "https://avatars.githubusercontent.com/u/444997?v=4", "gravatar_id": "", "url": "https://api.github.com/users/kmcallister", "html_url": "https://github.com/kmcallister", "followers_url": "https://api.github.com/users/kmcallister/followers", "following_url": "https://api.github.com/users/kmcallister/following{/other_user}", "gists_url": "https://api.github.com/users/kmcallister/gists{/gist_id}", "starred_url": "https://api.github.com/users/kmcallister/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/kmcallister/subscriptions", "organizations_url": "https://api.github.com/users/kmcallister/orgs", "repos_url": "https://api.github.com/users/kmcallister/repos", "events_url": "https://api.github.com/users/kmcallister/events{/privacy}", "received_events_url": "https://api.github.com/users/kmcallister/received_events", "type": "User", "site_admin": false}, "labels": [], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 2, "created_at": "2014-04-07T05:53:04Z", "updated_at": "2014-04-07T13:52:12Z", "closed_at": "2014-04-07T13:50:15Z", "author_association": "CONTRIBUTOR", "active_lock_reason": null, "body": "So this is a pretty minor issue, and maybe LLVM's fault, but this code\n\n``` .rs\npub fn f(s: &str) -> bool {\n    for x in s.bytes() {\n        match x {\n            0x00 | 0x0A | 0x0D | 0x20 => return true,\n            _ => (),\n        }\n    }\n    false\n}\n```\n\ncompiles\n\n```\n$ rustc -v\nrustc 0.10-pre (68a4f7d 2014-02-24 12:42:02 -0800)\nhost: x86_64-unknown-linux-gnu\n\n$ rustc -O --crate-type dylib foo.rs\n```\n\nto something like\n\n```\n\u2026\n a7c:   48 be 01 24 00 00 01    movabs $0x100002401,%rsi\n a83:   00 00 00 \n a86:   90                      nop\n a87:   90                      nop\n a88:   90                      nop\n a89:   90                      nop\n a8a:   90                      nop\n a8b:   90                      nop\n a8c:   90                      nop\n a8d:   90                      nop\n a8e:   90                      nop\n a8f:   90                      nop\n a90:   31 c0                   xor    %eax,%eax\n\u2026\n aad:   48 0f a3 fe             bt     %rdi,%rsi\n ab1:   73 dd                   jae    a90 <_ZN1f20hac2b11ab71da6f75daa4v0.0E+0x40>\n\u2026\n```\n\nThe [_Intel\u00ae 64 and IA-32 Architectures Optimization Reference Manual_](http://www.intel.com/content/www/us/en/architecture-and-technology/64-ia-32-architectures-optimization-manual.html) section 3.5.1.10 \"Using NOPs\" gives examples of multi-byte NOPs and says\n\n> Because NOPs require hardware resources to decode and execute, use the fewest number to achieve the desired padding.\n\n`gcc -O2` (which implies `-falign-loops`) will emit instructions like\n\n```\n0f 1f 44 00 00                 nopl   0x0(%rax,%rax,1)\n66 0f 1f 84 00 00 00 00 00     nopw   0x0(%rax,%rax,1)\n```\n\nThe Linux kernel has [its own list](https://github.com/torvalds/linux/blob/master/arch/x86/include/asm/nops.h) of preferred NOPs.\n\nAnyway this is LLVM's job but maybe it needs some information / configuration from rustc?\n", "closed_by": {"login": "thestinger", "id": 1505226, "node_id": "MDQ6VXNlcjE1MDUyMjY=", "avatar_url": "https://avatars.githubusercontent.com/u/1505226?v=4", "gravatar_id": "", "url": "https://api.github.com/users/thestinger", "html_url": "https://github.com/thestinger", "followers_url": "https://api.github.com/users/thestinger/followers", "following_url": "https://api.github.com/users/thestinger/following{/other_user}", "gists_url": "https://api.github.com/users/thestinger/gists{/gist_id}", "starred_url": "https://api.github.com/users/thestinger/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/thestinger/subscriptions", "organizations_url": "https://api.github.com/users/thestinger/orgs", "repos_url": "https://api.github.com/users/thestinger/repos", "events_url": "https://api.github.com/users/thestinger/events{/privacy}", "received_events_url": "https://api.github.com/users/thestinger/received_events", "type": "User", "site_admin": false}, "reactions": {"url": "https://api.github.com/repos/rust-lang/rust/issues/13373/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rust-lang/rust/issues/13373/timeline", "performed_via_github_app": null, "state_reason": "completed"}