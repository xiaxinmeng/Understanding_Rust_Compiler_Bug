{"url": "https://api.github.com/repos/rust-lang/rust/issues/54999", "repository_url": "https://api.github.com/repos/rust-lang/rust", "labels_url": "https://api.github.com/repos/rust-lang/rust/issues/54999/labels{/name}", "comments_url": "https://api.github.com/repos/rust-lang/rust/issues/54999/comments", "events_url": "https://api.github.com/repos/rust-lang/rust/issues/54999/events", "html_url": "https://github.com/rust-lang/rust/issues/54999", "id": 369292140, "node_id": "MDU6SXNzdWUzNjkyOTIxNDA=", "number": 54999, "title": "aarch64-linux-musl fails to build from bootstrap", "user": {"login": "awilfox", "id": 303838, "node_id": "MDQ6VXNlcjMwMzgzOA==", "avatar_url": "https://avatars.githubusercontent.com/u/303838?v=4", "gravatar_id": "", "url": "https://api.github.com/users/awilfox", "html_url": "https://github.com/awilfox", "followers_url": "https://api.github.com/users/awilfox/followers", "following_url": "https://api.github.com/users/awilfox/following{/other_user}", "gists_url": "https://api.github.com/users/awilfox/gists{/gist_id}", "starred_url": "https://api.github.com/users/awilfox/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/awilfox/subscriptions", "organizations_url": "https://api.github.com/users/awilfox/orgs", "repos_url": "https://api.github.com/users/awilfox/repos", "events_url": "https://api.github.com/users/awilfox/events{/privacy}", "received_events_url": "https://api.github.com/users/awilfox/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 123110, "node_id": "MDU6TGFiZWwxMjMxMTA=", "url": "https://api.github.com/repos/rust-lang/rust/labels/O-linux", "name": "O-linux", "color": "6e6ec0", "default": false, "description": "Operating system: Linux"}, {"id": 55301954, "node_id": "MDU6TGFiZWw1NTMwMTk1NA==", "url": "https://api.github.com/repos/rust-lang/rust/labels/O-Arm", "name": "O-Arm", "color": "6e6ec0", "default": false, "description": "Target: 32-bit Arm processors (armv6, armv7, thumb...), including 64-bit Arm in AArch32 state"}, {"id": 325438536, "node_id": "MDU6TGFiZWwzMjU0Mzg1MzY=", "url": "https://api.github.com/repos/rust-lang/rust/labels/T-bootstrap", "name": "T-bootstrap", "color": "bfd4f2", "default": false, "description": "Relevant to the bootstrap subteam: Rust's build system (x.py and src/bootstrap)"}, {"id": 630662867, "node_id": "MDU6TGFiZWw2MzA2NjI4Njc=", "url": "https://api.github.com/repos/rust-lang/rust/labels/O-musl", "name": "O-musl", "color": "6e6ec0", "default": false, "description": "Target: The musl libc"}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 2, "created_at": "2018-10-11T20:28:31Z", "updated_at": "2019-02-20T16:20:15Z", "closed_at": "2019-02-20T16:20:15Z", "author_association": "NONE", "active_lock_reason": null, "body": "Hi there.  I'm the project lead of Ad\u00e9lie Linux, and we are attempting to port Rust to our distro.  We've successfully built Rust on our libre 64-bit PowerPC platform, and used that to generate cross bootstraps for our other architectures.\r\n\r\nAll of the cross bootstraps work correctly, except arm64, which won't build a native compiler.  While building stage1 std artifacts, the following error is seen:\r\n\r\n```\r\nAssembling stage1 compiler (aarch64-foxkit-linux-musl)\r\nBuilding stage1 std artifacts (aarch64-foxkit-linux-musl -> aarch64-foxkit-linux-musl)\r\n   Compiling cc v1.0.18                                                                                                                                                                                                                                                        \r\n   Compiling core v0.0.0 (file:///usr/src/packages/user/rust/src/rustc-1.29.1-src/src/libcore)\r\n   Compiling unwind v0.0.0 (file:///usr/src/packages/user/rust/src/rustc-1.29.1-src/src/libunwind)\r\n   Compiling panic_unwind v0.0.0 (file:///usr/src/packages/user/rust/src/rustc-1.29.1-src/src/libpanic_unwind)\r\n   Compiling build_helper v0.1.0 (file:///usr/src/packages/user/rust/src/rustc-1.29.1-src/src/build_helper)\r\nthread 'main' panicked at 'cannot access a scoped thread local variable without calling `set` first', vendor/scoped-tls/src/lib.rs:186:9\r\nstack backtrace:\r\n   0: std::sys::unix::backtrace::tracing::imp::unwind_backtrace\r\n             at libstd/sys/unix/backtrace/tracing/gcc_s.rs:49\r\n   1: std::sys_common::backtrace::_print\r\n             at libstd/sys_common/backtrace.rs:71\r\n   2: std::panicking::default_hook::{{closure}}\r\n             at libstd/sys_common/backtrace.rs:59\r\n             at libstd/panicking.rs:211\r\n   3: std::panicking::default_hook\r\n             at libstd/panicking.rs:227\r\n   4: rustc::util::common::panic_hook\r\n             at librustc/util/common.rs:53\r\n   5: std::panicking::rust_panic_with_hook\r\n             at libstd/panicking.rs:479\r\n   6: std::panicking::begin_panic\r\n             at ./libstd/panicking.rs:409\r\n   7: syntax_pos::symbol::Symbol::as_str\r\n             at ./<panic macros>:3\r\n             at libsyntax_pos/symbol.rs:484\r\n             at libsyntax_pos/symbol.rs:173\r\n   8: syntax::attr::<impl syntax::ast::Attribute>::check_name\r\n             at ./libsyntax_pos/symbol.rs:222\r\n             at libsyntax/ast.rs:76\r\n             at libsyntax/attr/mod.rs:208\r\n   9: <rustc::hir::check_attr::CheckAttrVisitor<'a, 'tcx> as rustc::hir::intravisit::Visitor<'tcx>>::visit_item\r\n             at librustc/hir/check_attr.rs:62\r\n             at ./libcore/iter/iterator.rs:1783\r\n             at ./libcore/iter/iterator.rs:1559\r\n             at ./libcore/slice/mod.rs:2440\r\n             at ./libcore/iter/iterator.rs:1559\r\n             at ./libcore/iter/iterator.rs:1782\r\n             at librustc/hir/check_attr.rs:62\r\n             at librustc/hir/check_attr.rs:296\r\n  10: rustc::hir::check_attr::check_crate\r\n             at librustc/hir/itemlikevisit.rs:80\r\n             at librustc/hir/mod.rs:699\r\n             at librustc/hir/check_attr.rs:314\r\n  11: rustc::ty::context::TyCtxt::create_and_enter\r\n             at librustc_driver/driver.rs:1263\r\n             at ./librustc/util/common.rs:165\r\n             at ./librustc/util/common.rs:159\r\n             at librustc_driver/driver.rs:1262\r\n             at ./librustc/ty/context.rs:1908\r\n             at ./librustc/ty/context.rs:1876\r\n             at ./librustc/ty/context.rs:1815\r\n             at ./librustc/ty/context.rs:1875\r\n             at ./librustc/ty/context.rs:1907\r\n             at ./librustc/ty/context.rs:1865\r\n             at ./libstd/thread/local.rs:294\r\n             at ./libstd/thread/local.rs:248\r\n             at ./librustc/ty/context.rs:1857\r\n             at ./libstd/thread/local.rs:294\r\n             at ./libstd/thread/local.rs:248\r\n             at ./librustc/ty/context.rs:1849\r\n             at ./librustc/ty/context.rs:1887\r\n             at ./librustc/ty/context.rs:1187\r\n  12: rustc_driver::driver::compile_input\r\n             at librustc_driver/driver.rs:1245\r\n             at librustc_driver/driver.rs:285\r\n  13: rustc_driver::run_compiler\r\n             at librustc_driver/lib.rs:562\r\n             at librustc_driver/lib.rs:483\r\n             at librustc_driver/driver.rs:74\r\n             at ./vendor/scoped-tls/src/lib.rs:155\r\n             at librustc_driver/driver.rs:73\r\n             at librustc_driver/lib.rs:482\r\n             at ./vendor/scoped-tls/src/lib.rs:155\r\n             at ./libsyntax/lib.rs:98\r\n             at ./vendor/scoped-tls/src/lib.rs:155\r\n             at ./libsyntax/lib.rs:97\r\n             at librustc_driver/lib.rs:473\r\n  14: rustc_driver::monitor::{{closure}}\r\n             at librustc_driver/lib.rs:1742\r\n             at librustc_driver/lib.rs:187\r\n             at librustc_driver/lib.rs:1657\r\n  15: __rust_maybe_catch_panic\r\n             at libpanic_unwind/lib.rs:105\r\n  16: rustc_driver::run\r\n             at ./libstd/panicking.rs:289\r\n             at ./libstd/panic.rs:392\r\n             at librustc_driver/lib.rs:1571\r\n             at librustc_driver/lib.rs:1582\r\n             at librustc_driver/lib.rs:1656\r\n             at librustc_driver/lib.rs:186\r\n  17: rustc_driver::main\r\n             at librustc_driver/lib.rs:1735\r\n  18: std::rt::lang_start::{{closure}}\r\n             at ./libstd/rt.rs:74\r\n  19: std::panicking::try::do_call\r\n             at libstd/rt.rs:59\r\n             at libstd/panicking.rs:310\r\n  20: __rust_maybe_catch_panic\r\n             at libpanic_unwind/lib.rs:105\r\n  21: std::rt::lang_start_internal\r\n             at libstd/panicking.rs:289\r\n             at libstd/panic.rs:392\r\n             at libstd/rt.rs:58\r\n  22: main\r\n  23: __libc_start_main\r\n             at src/env/__libc_start_main.c:76\r\nquery stack during panic:\r\nend of query stack\r\n\r\nerror: Could not compile `core`.\r\nwarning: build failed, waiting for other jobs to finish...\r\nerror: build failed\r\ncommand did not execute successfully: \"/usr/src/packages/user/rust/src/prebuilt/bin/cargo\" \"build\" \"--target\" \"aarch64-foxkit-linux-musl\" \"-j\" \"16\" \"--release\" \"--locked\" \"--frozen\" \"--features\" \"panic-unwind backtrace\" \"--manifest-path\" \"/usr/src/packages/user/rust/src/rustc-1.29.1-src/src/libstd/Cargo.toml\" \"--message-format\" \"json\"\r\nexpected success, got: exit code: 101\r\nthread 'main' panicked at 'cargo must succeed', bootstrap/compile.rs:1088:9\r\nstack backtrace:\r\n   0: std::sys::unix::backtrace::tracing::imp::unwind_backtrace\r\n   1: std::sys_common::backtrace::_print\r\n   2: std::panicking::default_hook::{{closure}}\r\n   3: std::panicking::default_hook\r\n   4: std::panicking::rust_panic_with_hook\r\n   5: std::panicking::begin_panic\r\n             at /usr/src/rust/src/libstd/panicking.rs:409\r\n   6: bootstrap::compile::run_cargo\r\n             at bootstrap/compile.rs:1088\r\n   7: <bootstrap::compile::Std as bootstrap::builder::Step>::run\r\n             at bootstrap/compile.rs:106\r\n   8: bootstrap::builder::Builder::ensure\r\n             at bootstrap/builder.rs:1134\r\n   9: <bootstrap::compile::Test as bootstrap::builder::Step>::run\r\n             at bootstrap/compile.rs:332\r\n  10: bootstrap::builder::Builder::ensure\r\n             at bootstrap/builder.rs:1134\r\n  11: <bootstrap::compile::Rustc as bootstrap::builder::Step>::run\r\n             at bootstrap/compile.rs:458\r\n  12: bootstrap::builder::Builder::ensure\r\n             at bootstrap/builder.rs:1134\r\n  13: <bootstrap::compile::Assemble as bootstrap::builder::Step>::run\r\n             at bootstrap/compile.rs:927\r\n  14: bootstrap::builder::Builder::ensure\r\n             at bootstrap/builder.rs:1134\r\n  15: bootstrap::builder::Builder::compiler\r\n             at bootstrap/builder.rs:579\r\n  16: <bootstrap::compile::Std as bootstrap::builder::Step>::make_run\r\n             at bootstrap/compile.rs:56\r\n  17: bootstrap::builder::StepDescription::maybe_run\r\n             at bootstrap/builder.rs:191\r\n  18: bootstrap::builder::StepDescription::run\r\n             at bootstrap/builder.rs:215\r\n  19: bootstrap::builder::Builder::run_step_descriptions\r\n             at bootstrap/builder.rs:571\r\n  20: bootstrap::builder::Builder::execute_cli\r\n             at bootstrap/builder.rs:561\r\n  21: bootstrap::Build::build\r\n             at bootstrap/lib.rs:471\r\n  22: bootstrap::main\r\n             at bootstrap/bin/main.rs:29\r\n  23: std::rt::lang_start::{{closure}}\r\n             at /usr/src/rust/src/libstd/rt.rs:74\r\n  24: std::panicking::try::do_call\r\n  25: __rust_maybe_catch_panic\r\n  26: std::rt::lang_start_internal\r\n  27: std::rt::lang_start\r\n             at /usr/src/rust/src/libstd/rt.rs:74\r\n  28: main\r\n  29: __libc_start_main\r\n             at src/env/__libc_start_main.c:76\r\nfailed to run: /usr/src/packages/user/rust/src/rustc-1.29.1-src/build/bootstrap/debug/bootstrap build -j 16\r\nBuild completed unsuccessfully in 1:55:57\r\n```\r\n\r\nI'm fairly new to Rust, having just bought the print edition of The Rust Programming Language (2018 ed) on Monday.  Therefore, I'm afraid I won't be too much help understanding the complexities of the compiler itself.  (One of our contributors is much more knowledgeable about Rust and is the one who helped us generate these toolchains.)  If this is beyond the scope of the Rust project, feel free to close this issue and we won't bother you again.", "closed_by": {"login": "awilfox", "id": 303838, "node_id": "MDQ6VXNlcjMwMzgzOA==", "avatar_url": "https://avatars.githubusercontent.com/u/303838?v=4", "gravatar_id": "", "url": "https://api.github.com/users/awilfox", "html_url": "https://github.com/awilfox", "followers_url": "https://api.github.com/users/awilfox/followers", "following_url": "https://api.github.com/users/awilfox/following{/other_user}", "gists_url": "https://api.github.com/users/awilfox/gists{/gist_id}", "starred_url": "https://api.github.com/users/awilfox/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/awilfox/subscriptions", "organizations_url": "https://api.github.com/users/awilfox/orgs", "repos_url": "https://api.github.com/users/awilfox/repos", "events_url": "https://api.github.com/users/awilfox/events{/privacy}", "received_events_url": "https://api.github.com/users/awilfox/received_events", "type": "User", "site_admin": false}, "reactions": {"url": "https://api.github.com/repos/rust-lang/rust/issues/54999/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rust-lang/rust/issues/54999/timeline", "performed_via_github_app": null, "state_reason": "completed"}